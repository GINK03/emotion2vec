{"context": "\n\n\u306f\u3058\u3081\u306b\nAzure(Hyper-V) Virtual Machine\u4e0a\u306eWindows\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068\u4eee\u60f3\u30de\u30b7\u30f3\u7d71\u5408\u30b5\u30fc\u30d3\u30b9\u306b\u3088\u3063\u3066\u3001\u30db\u30b9\u30c8\u306e\u6642\u523b\u3068\u540c\u671f\u304c\u53d6\u308c\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u3060\u3068\u3001Azure\u4e0a\u3067Active Directory\u306e\u30c9\u30e1\u30a4\u30f3\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9(DC)\u3092\u8a2d\u5b9a\u3059\u308b\u969b\u306a\u3069\u306b\u5dee\u3057\u652f\u3048\u304c\u3042\u308b\u306e\u3067\u3001\u30db\u30b9\u30c8\u306e\u6642\u8a08\u3092\u53c2\u7167\u305b\u305a\u306b\u3001\u5916\u90e8\u306eNTP\u30b5\u30fc\u30d0\u30fc\u3068\u540c\u671f\u3055\u305b\u308b\u65b9\u6cd5\u3067\u3059\u3002\n\n\u624b\u9806\n\n\u5916\u90e8\u306eNTP\u30b5\u30fc\u30d0\u30fc\u3092\u8a2d\u5b9a\u3059\u308b\n\u4eee\u60f3\u30de\u30b7\u30f3\u7d71\u5408\u30b5\u30fc\u30d3\u30b9\u306e\u6642\u523b\u540c\u671f\u3092\u6b62\u3081\u308b\nNTP\u540c\u671f\u3092\u958b\u59cb\n\n\n1. \u5916\u90e8\u306eNTP\u30b5\u30fc\u30d0\u30fc\u3092\u8a2d\u5b9a\u3059\u308b\nw32tm /config /update /manualpeerlist:\"ntp.nict.jp,0x8 jp.pool.ntp.org,0x8\" /syncfromflags:MANUAL /reliable:YES\n\n\n\u53c2\u7167\u3059\u308bNTP\u30b5\u30fc\u30d0\u30fc\u306f\u72b6\u6cc1\u3084\u6642\u4ee3\u306b\u3088\u3063\u3066\u5909\u308f\u308a\u307e\u3059\u306e\u3067\u9069\u5b9c\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002\n0x8\u3068\u304b\u306e\u610f\u5473\u306f\u3053\u3061\u3089\u3092\u53c2\u7167: Active Directory\u304a\u3088\u3073\u30ef\u30fc\u30af\u30b0\u30eb\u30fc\u30d7\u74b0\u5883\u3067\u306e\u6642\u523b\u540c\u671f\n\n\n\n2. \u4eee\u60f3\u30de\u30b7\u30f3\u7d71\u5408\u30b5\u30fc\u30d3\u30b9\u306e\u6642\u523b\u540c\u671f\u3092\u6b62\u3081\u308b\nreg add HKLM\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProviders\\VMICTimeProvider /v Enabled /t reg_dword /d 0\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u5024\u306f1(\u6709\u52b9)\u3067\u3059\u3002\u3053\u308c\u30920(\u7121\u52b9)\u306b\u8a2d\u5b9a\u3059\u308b\u3068\u3001\u30b2\u30b9\u30c8OS\u5074\u304b\u3089Hyper-V\u7d71\u5408\u30b5\u30fc\u30d3\u30b9\u306e\u6642\u523b\u540c\u671f\u3092\u7121\u52b9\u306b\u3067\u304d\u307e\u3059\u3002\nregedit\u7b49\u3067\u3082\u8a2d\u5b9a\u3067\u304d\u307e\u3059\u3002\n\n\u30ad\u30fc: HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProviders\\VMICTimeProvider\n\u540d\u524d: Enabled\n\u7a2e\u985e: REG_DWORD\n\u30c7\u30fc\u30bf: 0\n\n\n3. NTP\u540c\u671f\u3092\u958b\u59cb\n# w32tm\u3092\u518d\u8d77\u52d5\nnet stop w32time\nnet start w32time\n\n# NTP\u540c\u671f\u3092\u958b\u59cb\nw32tm /resync /force\n\n\n\u95a2\u9023\u3059\u308b\u30a4\u30d9\u30f3\u30c8\u30ed\u30b0\n\u30bd\u30fc\u30b9: Time-Service\n\u30a4\u30d9\u30f3\u30c8ID: 12\n\n\u30bf\u30a4\u30e0 \u30d7\u30ed\u30d0\u30a4\u30c0\u30fc NtpClient: \u3053\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u30fc\u306f\u3001\u30c9\u30e1\u30a4\u30f3\u968e\u5c64\u3092\u4f7f\u3063\u3066\u30bf\u30a4\u30e0\u30bd\u30fc\u30b9\u3092\u6c7a\u5b9a\u3059\u308b\u3088\u3046\u306b\u69cb\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u30d5\u30a9\u30ec\u30b9\u30c8\u306e\u30eb\u30fc\u30c8\u306b\u3042\u308b\u30c9\u30e1\u30a4\u30f3\u7528\u306e AD PDC \u30a8\u30df\u30e5\u30ec\u30fc\u30bf\u30fc\u3067\u3042\u308b\u305f\u3081\u3001\u30c9\u30e1\u30a4\u30f3\u968e\u5c64\u306e\u305d\u306e\u4e0a\u306b\u306f\u30bf\u30a4\u30e0 \u30bd\u30fc\u30b9\u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u30fc\u304c\u3042\u308a\u307e\u305b\u3093\u3002\u30eb\u30fc\u30c8 \u30c9\u30e1\u30a4\u30f3\u306e\u4fe1\u983c\u3067\u304d\u308b\u30bf\u30a4\u30e0 \u30b5\u30fc\u30d3\u30b9\u3092\u69cb\u6210\u3059\u308b\u304b\u3001\u307e\u305f\u306f\u624b\u52d5\u3067 AD PDC \u3092\u69cb\u6210\u3057\u3066\u5916\u90e8\u306e\u30bf\u30a4\u30e0 \u30bd\u30fc\u30b9\u3068\u540c\u671f\u3055\u305b\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002\u305d\u3046\u3067\u306a\u3044\u5834\u5408\u3001\u3053\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u30fc\u306f\u30c9\u30e1\u30a4\u30f3\u968e\u5c64\u5185\u306e\u6a29\u9650\u306e\u3042\u308b\u30bf\u30a4\u30e0 \u30bd\u30fc\u30b9\u3068\u3057\u3066\u6a5f\u80fd\u3057\u307e\u3059\u3002\u5916\u90e8\u306e\u30bf\u30a4\u30e0 \u30bd\u30fc\u30b9\u304c\u69cb\u6210\u3067\u304d\u306a\u3044\u5834\u5408\u3001\u307e\u305f\u3053\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u30fc\u3067\u4f7f\u7528\u3067\u304d\u306a\u3044\u5834\u5408\u306f\u3001NtpClient \u3092\u7121\u52b9\u306b\u3059\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002\n\n\n\u53c2\u8003\n\nTime Synchronization in Hyper-V\nTime Synchronization and Domain Controller VM\u2019s\n\n# \u306f\u3058\u3081\u306b\n\nAzure(Hyper-V) Virtual Machine\u4e0a\u306eWindows\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068\u4eee\u60f3\u30de\u30b7\u30f3\u7d71\u5408\u30b5\u30fc\u30d3\u30b9\u306b\u3088\u3063\u3066\u3001\u30db\u30b9\u30c8\u306e\u6642\u523b\u3068\u540c\u671f\u304c\u53d6\u308c\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u3060\u3068\u3001Azure\u4e0a\u3067Active Directory\u306e\u30c9\u30e1\u30a4\u30f3\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9(DC)\u3092\u8a2d\u5b9a\u3059\u308b\u969b\u306a\u3069\u306b\u5dee\u3057\u652f\u3048\u304c\u3042\u308b\u306e\u3067\u3001\u30db\u30b9\u30c8\u306e\u6642\u8a08\u3092\u53c2\u7167\u305b\u305a\u306b\u3001\u5916\u90e8\u306eNTP\u30b5\u30fc\u30d0\u30fc\u3068\u540c\u671f\u3055\u305b\u308b\u65b9\u6cd5\u3067\u3059\u3002\n\n\n# \u624b\u9806\n\n1. \u5916\u90e8\u306eNTP\u30b5\u30fc\u30d0\u30fc\u3092\u8a2d\u5b9a\u3059\u308b\n2. \u4eee\u60f3\u30de\u30b7\u30f3\u7d71\u5408\u30b5\u30fc\u30d3\u30b9\u306e\u6642\u523b\u540c\u671f\u3092\u6b62\u3081\u308b\n3. NTP\u540c\u671f\u3092\u958b\u59cb\n\n## 1. \u5916\u90e8\u306eNTP\u30b5\u30fc\u30d0\u30fc\u3092\u8a2d\u5b9a\u3059\u308b\n\n    w32tm /config /update /manualpeerlist:\"ntp.nict.jp,0x8 jp.pool.ntp.org,0x8\" /syncfromflags:MANUAL /reliable:YES\n\n* \u53c2\u7167\u3059\u308bNTP\u30b5\u30fc\u30d0\u30fc\u306f\u72b6\u6cc1\u3084\u6642\u4ee3\u306b\u3088\u3063\u3066\u5909\u308f\u308a\u307e\u3059\u306e\u3067\u9069\u5b9c\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002\n* 0x8\u3068\u304b\u306e\u610f\u5473\u306f\u3053\u3061\u3089\u3092\u53c2\u7167: [Active Directory\u304a\u3088\u3073\u30ef\u30fc\u30af\u30b0\u30eb\u30fc\u30d7\u74b0\u5883\u3067\u306e\u6642\u523b\u540c\u671f](http://www.atmarkit.co.jp/ait/articles/1205/17/news135_2.html)\n\n\n## 2. \u4eee\u60f3\u30de\u30b7\u30f3\u7d71\u5408\u30b5\u30fc\u30d3\u30b9\u306e\u6642\u523b\u540c\u671f\u3092\u6b62\u3081\u308b\n\n    reg add HKLM\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProviders\\VMICTimeProvider /v Enabled /t reg_dword /d 0\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u5024\u306f1(\u6709\u52b9)\u3067\u3059\u3002\u3053\u308c\u30920(\u7121\u52b9)\u306b\u8a2d\u5b9a\u3059\u308b\u3068\u3001\u30b2\u30b9\u30c8OS\u5074\u304b\u3089Hyper-V\u7d71\u5408\u30b5\u30fc\u30d3\u30b9\u306e\u6642\u523b\u540c\u671f\u3092\u7121\u52b9\u306b\u3067\u304d\u307e\u3059\u3002\n\nregedit\u7b49\u3067\u3082\u8a2d\u5b9a\u3067\u304d\u307e\u3059\u3002\n\n* \u30ad\u30fc: HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\W32Time\\TimeProviders\\VMICTimeProvider\n* \u540d\u524d: Enabled\n* \u7a2e\u985e: REG_DWORD\n* \u30c7\u30fc\u30bf: 0\n\n\n\n## 3. NTP\u540c\u671f\u3092\u958b\u59cb\n\n    # w32tm\u3092\u518d\u8d77\u52d5\n    net stop w32time\n    net start w32time\n    \n    # NTP\u540c\u671f\u3092\u958b\u59cb\n    w32tm /resync /force\n\n\n# \u95a2\u9023\u3059\u308b\u30a4\u30d9\u30f3\u30c8\u30ed\u30b0\n\n\u30bd\u30fc\u30b9: Time-Service\n\u30a4\u30d9\u30f3\u30c8ID: 12\n> \u30bf\u30a4\u30e0 \u30d7\u30ed\u30d0\u30a4\u30c0\u30fc NtpClient: \u3053\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u30fc\u306f\u3001\u30c9\u30e1\u30a4\u30f3\u968e\u5c64\u3092\u4f7f\u3063\u3066\u30bf\u30a4\u30e0\u30bd\u30fc\u30b9\u3092\u6c7a\u5b9a\u3059\u308b\u3088\u3046\u306b\u69cb\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u30d5\u30a9\u30ec\u30b9\u30c8\u306e\u30eb\u30fc\u30c8\u306b\u3042\u308b\u30c9\u30e1\u30a4\u30f3\u7528\u306e AD PDC \u30a8\u30df\u30e5\u30ec\u30fc\u30bf\u30fc\u3067\u3042\u308b\u305f\u3081\u3001\u30c9\u30e1\u30a4\u30f3\u968e\u5c64\u306e\u305d\u306e\u4e0a\u306b\u306f\u30bf\u30a4\u30e0 \u30bd\u30fc\u30b9\u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u30fc\u304c\u3042\u308a\u307e\u305b\u3093\u3002\u30eb\u30fc\u30c8 \u30c9\u30e1\u30a4\u30f3\u306e\u4fe1\u983c\u3067\u304d\u308b\u30bf\u30a4\u30e0 \u30b5\u30fc\u30d3\u30b9\u3092\u69cb\u6210\u3059\u308b\u304b\u3001\u307e\u305f\u306f\u624b\u52d5\u3067 AD PDC \u3092\u69cb\u6210\u3057\u3066\u5916\u90e8\u306e\u30bf\u30a4\u30e0 \u30bd\u30fc\u30b9\u3068\u540c\u671f\u3055\u305b\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002\u305d\u3046\u3067\u306a\u3044\u5834\u5408\u3001\u3053\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u30fc\u306f\u30c9\u30e1\u30a4\u30f3\u968e\u5c64\u5185\u306e\u6a29\u9650\u306e\u3042\u308b\u30bf\u30a4\u30e0 \u30bd\u30fc\u30b9\u3068\u3057\u3066\u6a5f\u80fd\u3057\u307e\u3059\u3002\u5916\u90e8\u306e\u30bf\u30a4\u30e0 \u30bd\u30fc\u30b9\u304c\u69cb\u6210\u3067\u304d\u306a\u3044\u5834\u5408\u3001\u307e\u305f\u3053\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u30fc\u3067\u4f7f\u7528\u3067\u304d\u306a\u3044\u5834\u5408\u306f\u3001NtpClient \u3092\u7121\u52b9\u306b\u3059\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002\n\n# \u53c2\u8003\n\n* [Time Synchronization in Hyper-V](https://blogs.msdn.microsoft.com/virtual_pc_guy/2010/11/19/time-synchronization-in-hyper-v/)\n* [Time Synchronization and Domain Controller VM\u2019s](https://blogs.msdn.microsoft.com/robertvi/2011/05/11/time-synchronization-and-domain-controller-vms/)\n", "tags": ["ntp", "Azure", "Hyper-V"]}