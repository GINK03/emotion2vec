{"context": " More than 1 year has passed since last update.\n\n\u80cc\u666f\n\u5225\u306bAngular\u3084SPA\u306b\u9650\u3063\u305f\u8a71\u3067\u306f\u306a\u3044\u304c, \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u958b\u767a\u3092\u3057\u3066\u3044\u305f\u3089\u958b\u767a/\u672c\u756a\u3067\u5e7e\u3064\u304b\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u5207\u308a\u66ff\u3048\u305f\u3044\u3001\u3068\u3044\u3063\u305f\u3088\u3046\u306a\u30d3\u30eb\u30c9\u306b\u95a2\u9023\u3059\u308b\u8981\u6c42\u306f\u73cd\u3057\u304f\u306a\u3044.\n\u4eca\u56de\u306f, AngularJS\u3068gulp\u3092\u4f7f\u3063\u3066\u3044\u308b\u958b\u767a\u306b\u304a\u3044\u3066, \u3053\u306e\u3088\u3046\u306a\u30d3\u30eb\u30c9\u8981\u6c42\u3092\u89e3\u6c7a\u3059\u308b\u305f\u3081\u306b, \u73fe\u6642\u70b9\u3067\u50d5\u304c\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3068\u8003\u3048\u3066\u3044\u308b\u65b9\u6cd5\u3092\u30e1\u30e2\u3082\u517c\u306d\u3066\u6b8b\u3057\u3066\u304a\u304f.\n\n\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\n\u30d3\u30eb\u30c9\u306b\u3088\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u5207\u66ff\u306e\u4f8b\u3068\u3057\u3066, \u771f\u3063\u5148\u306b\u601d\u3044\u3064\u304f\u306e\u306fAPI\u306e\u63a5\u7d9a\u5148\u5909\u66f4\u3067\u3042\u308b.\n\u4e0b\u8a18\u306e\u3088\u3046\u306a\u8981\u4ef6\u3060\u3063\u305f\u3068\u3057\u3088\u3046.\n\n\u958b\u767a\u6642: localhost:5080\u3092\u63a5\u7d9a\u5148\u306b\u3057\u305f\u3044\n\u672c\u756a\u6642: URL\u306ePrefix\u306b/apiContextRoot \u3092\u4ed8\u4e0e\u3057\u305f\u3044\n\n\u3053\u3093\u306a\u3068\u304d\u306f, \u6b21\u306e\u3088\u3046\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\u3092\u5207\u308a\u51fa\u3059.\n\n\u30a2\u30d7\u30ea\u672c\u4f53\u306e\u30b3\u30fc\u30c9(\u958b\u767a/\u672c\u756a\u3067\u5171\u7528)\n\n\nsrc/app/main.controller.js\nangular.module('sampleApp', ['sampleApp.Conf']);\n\nangular.module('sampleApp').controller('MainCtrl', function ($http, APP_CONF) {\n  var main = this;\n  $http.get({\n    url: APP_CONF.urlBase + 'someResourcePath'\n  }).then(function (data) {\n    //...\n  });\n});\n\n\n\n\u958b\u767a\u74b0\u5883\u7528\u306e\u8a2d\u5b9a\u30b3\u30fc\u30c9\n\n\nconfig_dev.js\nangular.module('sampleApp.Conf', []).constant('APP_CONF', {\n  urlBase: 'http://localhost:5080'\n});\n\n\n\n\u672c\u756a\u5411\u3051\u306e\u8a2d\u5b9a\u30b3\u30fc\u30c9\n\n\nconfig_prod.js\nangular.module('sampleApp.Conf', []).constant('APP_CONF', {\n  urlBase: '/apiContextRoot'\n});\n\n\nindex.html\u304b\u3089\u8aad\u307f\u8fbc\u3080\u30d5\u30a1\u30a4\u30eb\u3092\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u3067, \u74b0\u5883\u306e\u5dee\u306b\u5bfe\u5fdc\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u308f\u3051\u3060.\n\n\u958b\u767a\u6642: config_dev.js\n\n\u672c\u756a\u6642: config_prod.js\n\n\n\n\u5b9f\u4f8b\n\u3053\u3053\u304b\u3089\u306f, \u4e0a\u8ff0\u306e\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u3092\u4f8b\u306b, \u5b9f\u969b\u306b\u50d5\u304c\u666e\u6bb5\u4f7f\u3063\u3066\u3044\u308b\u958b\u767a\u74b0\u5883\u3092\u4e00\u90e8\u7c21\u7d20\u5316\u3057\u3066\u8aac\u660e\u3057\u3066\u307f\u308b.\n\nDirectory\u69cb\u6210\n\u30d3\u30eb\u30c9\u306e\u8a71\u306a\u306e\u3067\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\u306e\u8a71\u984c\u306f\u907f\u3051\u3066\u901a\u308c\u306a\u3044. \n\u3053\u3053\u3067\u306f, \u4ee5\u4e0b\u306e\u3088\u3046\u306a\u69cb\u6210\u3092\u524d\u63d0\u3068\u3057\u3066\u3044\u308b(Yeoman\u306egenerator-gulp-angular\u3067\u751f\u6210\u3059\u308b\u3053\u3068\u304c\u591a\u3044\u305f\u3081).\n(PROJECT ROOT)\n\u251c ng-config\n\u2502\u251c config_dev.json\n\u2502\u2514 config_prod.json\n\u251c src\n\u2502\u251c app\n\u2502\u2502\u251c main.controller.js\n\u2502\u2502\u251c (\u305d\u306e\u4ed6js, html\u8272\u3005)\n\u2502\u2502\u2514 index.js\n\u2502\u2514 index.html\n\u251c bower.json\n\u251c gulpfile.js\n\u251c package.json\n\u2514 (other files)\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u8a2d\u7f6e\n\u5148\u8ff0\u306econfig_dev.js\u3084config_prod.js\u306b\u3064\u3044\u3066, \u4ee5\u524d\u306f\u81ea\u5206\u3067\u4f5c\u6210\u30fb\u8a18\u8ff0\u3057\u3066\u3044\u305f\u306e\u3060\u304c, AngularJS\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u5b9a\u7fa9(angular.module(...).constant)\u304c\u5165\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u308b\u305f\u3081\u306b\u76f4\u63a5Node\u3084gulp\u304b\u3089\u8aad\u307f\u3065\u3089\u304f, \u4e0d\u90fd\u5408\u3092\u611f\u3058\u308b\u3053\u3068\u304c\u3042\u3063\u305f. \n\u3053\u306e\u305f\u3081, \u6700\u8fd1\u306f gulp-ng-config\u3067, config_***.json \u2192 config_***.js \u3092\u751f\u6210\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b.\n\u4f5c\u6210\u3059\u308bJSON\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308b. constant\u306e\u4e2d\u8eab\u3092JSON\u3068\u3057\u3066\u53d6\u308a\u51fa\u3059\u3060\u3051\u3060.\n\nng-config/config_dev.json\n{\n  \"APP_CONF\": {\n    \"urlBase\": \"http://localhost:5080\"\n  }\n}\n\n\n\nng-config/config_prod.json\n{\n  \"APP_CONF\": {\n    \"urlBase\": \"/apiContextRoot\"\n  }\n}\n\n\n\ngulp-plugin\n\u30d3\u30eb\u30c9\u306b\u5fc5\u8981\u306agulp\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u6b21\u306e\u901a\u308a:\nnpm install gulp gulp-load-plugins gulp-inject gulp-ng-config --save-dev\n\n\ngulp-ng-config\u3068gulp-inject\u306b\u3088\u308b\u8a2d\u5b9a\u306e\u6ce8\u5165\n\nsrc/index.html\n<html>\n  :\n  <!-- build:js({app,.tmp}) scripts/app.js -->\n\n  <!-- inject:js -->\n  <!-- endinject -->\n\n  <!-- endbuild -->\n  :\n</html>\n\n\n\u4eca\u56de\u3001\u89e3\u8aac\u3059\u308b\u306e\u306f<!-- inject:js --> \u306e\u90e8\u5206\u3067\u3042\u308b\u304c, \u5927\u6982\u306e\u30b1\u30fc\u30b9\u3067\u306f gulp-useref\u3084gulp-usemin\u3092\u3064\u304b\u3046\u305f\u3081\u306e<!-- build:js -->\u306e\u30d6\u30ed\u30c3\u30af\u5185\u306b\u8a2d\u7f6e\u3055\u308c\u308b\u3053\u3068\u3060\u308d\u3046.\n\ngulpfile\n\ngulpfile.js\nvar gulp = require('gulp');\nvar $ = require('gulp-load-plugins')();\n\n/** 1. Profile\u306e\u7279\u5b9a. \u74b0\u5883\u5909\u6570\u304b\u3089\u3082\u53d6\u5f97\u53ef\u80fd\u306b\u3057\u3066\u304a\u304f. **/\nvar profile = process.env.PROFILE || 'dev';\n\n/** 2. .json\u2192anuglar\u306e\u8a2d\u5b9a\u30e2\u30b8\u30e5\u30fc\u30eb\u751f\u6210\u30bf\u30b9\u30af **/\ngulp.task('ngconfig', function () {\n  return gulp.src(['ng-config/config_' + profile + '.json'])\n    .pipe($.ngConfig('sampleApp.Conf'))\n    .pipe(gulp.dest('.tmp'))\n    ;\n});\n\n/** 3. \u751f\u6210\u3057\u305f.js\u3068\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306ejs\u30bd\u30fc\u30b9\u3092html\u3078\u6ce8\u5165 **/\ngulp.task('injector:js', ['ngconfig'], function () {\n  return gulp.src(['src/index.html'])\n    .pipe($.inject(gulp.src([\n      '.tmp/config_' + profile + '.js',\n      'src/app/index.js',\n      'src/**/*.js'\n    ]), {\n      ignorePath: ['src', '.tmp'],\n      addRootSlash: false\n    }))\n    .pipe(gulp.dest('src/'))\n    ;\n});\n\n\n\n\u30dd\u30a4\u30f3\u30c8\u306f, $.ngConfig \u306b\u8a2d\u5b9a\u30e2\u30b8\u30e5\u30fc\u30eb\u540d('sampleApp.Conf')\u3092\u55b0\u308f\u305b\u308b\u3066pipe\u3059\u308b\u3053\u3068\u3067config_***.js\u304c .tmp \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u4f5c\u6210\u3055\u308c\u308b\u70b9\u3068, \u4f5c\u6210\u3057\u305fconfig_***.js\u3092gulp-inject\u3067\u6ce8\u5165\u3057\u3066\u3044\u308b\u70b9.\n\u306a\u304a\u3001gulp-inject\u306f\u300cgulpfile.js\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u8d77\u70b9\u3068\u3057\u305f\u76f8\u5bfe\u30d1\u30b9\u300d\u3092<script src=\"...\">\u306b\u57cb\u3081\u8fbc\u3093\u3067\u3044\u304f\u305f\u3081, index.html\u3068gulpfile.js\u304c\u5225\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u914d\u7f6e\u3055\u308c\u3066\u3044\u308b\u30b1\u30fc\u30b9\u3067\u306f, \u76f8\u5bfe\u30d1\u30b9\u306e\u57fa\u6e96\u8abf\u6574\u304c\u5fc5\u9808\u3068\u306a\u308b.\n\u3053\u3053\u3067\u306f, gulp-inject\u306e\u30aa\u30d7\u30b7\u30e7\u30f3ignorePath\u306b\u3066, .tmp/\u3068src/ \u3092\u5207\u308a\u53d6\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b.\n\u3053\u308c\u3067, \u6b21\u306e\u3088\u3046\u306bgulp\u3092\u53e9\u3051\u3070, \u30c7\u30d5\u30a9\u30eb\u30c8\u306eProfile\u3068\u3057\u3066config_dev.js\u304c\u6ce8\u5165\u3055\u308c\u308b.\ngulp injector:js\n\nsrc/index.html \u3092\u958b\u3044\u305f\u3089, \u4e0b\u8a18\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u6ce8\u5165\u3055\u308c\u3066\u3044\u308b\u306e\u3092\u78ba\u8a8d\u3067\u304d\u308b\u306f\u305a.\n\nsrc/index.html\n<html>\n  :\n  <!-- build:js({.tmp,src}) scripts/app.js -->\n  <!-- inject:js -->\n  <script src=\"config_dev.js\"></script>\n  <script src=\"src/app/index.js\"></script>\n  <script src=\"src/app/main.controller.js\"></script>\n  <!-- \u305d\u306e\u4ed6\u306ejs\u8272\u3005 -->\n  <!-- endinject -->\n  <!-- endbuild -->\n  :\n</html>\n\n\n\u307e\u305f, \u4e0b\u8a18\u306e\u3088\u3046\u306b\u74b0\u5883\u5909\u6570\u3067Profile\u3092\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u3067, \u672c\u756a\u7528\u306e\u30d3\u30eb\u30c9\u306b\u3082\u5bfe\u5fdc\u3067\u304d\u308b.\nexport PROFILE=prod\ngulp injector:js\n\n\u30ec\u30dd\u30b8\u30c8\u30ea\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u4e00\u5207\u624b\u3092\u52a0\u3048\u308b\u3053\u3068\u306a\u304f\u958b\u767a/\u672c\u756a\u306e\u5207\u66ff\u304c\u884c\u3048\u308b\u306e\u3067, Travis CI\u3084Jenkins\u7b49, CI\u306b\u7d44\u307f\u8fbc\u3080\u306e\u3082\u5bb9\u6613\u3060.\n\n\u307e\u3068\u3081\n\ngulp-ng-config, gulp-inject\u3067\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u6ce8\u5165\u306e\u4ed5\u7d44\u307f\u304c\u7c21\u5358\u306b\u4f5c\u308c\u308b.\n\n\u4ed6\u306b\u3082\u8272\u3005\u306a\u65b9\u6cd5\u304c\u3042\u308b\u3068\u601d\u3046\u306e\u3067, \u3088\u308a\u3088\u3044\u3084\u308a\u65b9\u3068\u304b\u3042\u3063\u305f\u3089\u6559\u3048\u3066\u307b\u3057\u3044\u306a\u30fc\u3002\n\n\u304a\u307e\u3051\ngulp-ng-config\u3092\u77e5\u308b\u524d\u306b, node.js\u3067\u3082AngularJS\u3067\u3082\u8aad\u307f\u8fbc\u3081\u308b(require/$inject)\u3088\u3046\u306b\u2193\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308b\u3001\u3068\u3044\u3046\u30d7\u30e9\u30f3\u3092\u8003\u3048\u305f\u3053\u3068\u3082\u3042\u308b\u304c, \u3042\u307e\u308a\u306b\u3082\u30a2\u30db\u304f\u3055\u3044\u306e\u3067\u3084\u3081\u305f\u3002\n\nsrc/config/config_dev.js\n'use strict';\n\n(function (factory) {\n  factory({\n    urlBase: 'http://localhost:5080'\n  });\n})(typeof angular !== 'undefined' ? function (config) {\n  return angular.module('sampleApp').constant('APP_CONF', config);\n} : function (config) {\n  module.exports = config;\n});\n\n\n## \u80cc\u666f\n\n\u5225\u306bAngular\u3084SPA\u306b\u9650\u3063\u305f\u8a71\u3067\u306f\u306a\u3044\u304c, \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u958b\u767a\u3092\u3057\u3066\u3044\u305f\u3089\u958b\u767a/\u672c\u756a\u3067\u5e7e\u3064\u304b\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u5207\u308a\u66ff\u3048\u305f\u3044\u3001\u3068\u3044\u3063\u305f\u3088\u3046\u306a\u30d3\u30eb\u30c9\u306b\u95a2\u9023\u3059\u308b\u8981\u6c42\u306f\u73cd\u3057\u304f\u306a\u3044.\n\n\u4eca\u56de\u306f, AngularJS\u3068gulp\u3092\u4f7f\u3063\u3066\u3044\u308b\u958b\u767a\u306b\u304a\u3044\u3066, \u3053\u306e\u3088\u3046\u306a\u30d3\u30eb\u30c9\u8981\u6c42\u3092\u89e3\u6c7a\u3059\u308b\u305f\u3081\u306b, \u73fe\u6642\u70b9\u3067\u50d5\u304c\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3068\u8003\u3048\u3066\u3044\u308b\u65b9\u6cd5\u3092\u30e1\u30e2\u3082\u517c\u306d\u3066\u6b8b\u3057\u3066\u304a\u304f.\n\n\n## \u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\n\n\u30d3\u30eb\u30c9\u306b\u3088\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u5207\u66ff\u306e\u4f8b\u3068\u3057\u3066, \u771f\u3063\u5148\u306b\u601d\u3044\u3064\u304f\u306e\u306fAPI\u306e\u63a5\u7d9a\u5148\u5909\u66f4\u3067\u3042\u308b.\n\n\u4e0b\u8a18\u306e\u3088\u3046\u306a\u8981\u4ef6\u3060\u3063\u305f\u3068\u3057\u3088\u3046.\n\n+ \u958b\u767a\u6642: `localhost:5080`\u3092\u63a5\u7d9a\u5148\u306b\u3057\u305f\u3044\n+ \u672c\u756a\u6642: URL\u306ePrefix\u306b`/apiContextRoot` \u3092\u4ed8\u4e0e\u3057\u305f\u3044\n\n\u3053\u3093\u306a\u3068\u304d\u306f, \u6b21\u306e\u3088\u3046\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\u3092\u5207\u308a\u51fa\u3059.\n\n+ \u30a2\u30d7\u30ea\u672c\u4f53\u306e\u30b3\u30fc\u30c9(\u958b\u767a/\u672c\u756a\u3067\u5171\u7528)\n\n```js:src/app/main.controller.js\nangular.module('sampleApp', ['sampleApp.Conf']);\n\nangular.module('sampleApp').controller('MainCtrl', function ($http, APP_CONF) {\n  var main = this;\n  $http.get({\n    url: APP_CONF.urlBase + 'someResourcePath'\n  }).then(function (data) {\n    //...\n  });\n});\n```\n\n+ \u958b\u767a\u74b0\u5883\u7528\u306e\u8a2d\u5b9a\u30b3\u30fc\u30c9\n\n```js:config_dev.js\nangular.module('sampleApp.Conf', []).constant('APP_CONF', {\n  urlBase: 'http://localhost:5080'\n});\n```\n\n+ \u672c\u756a\u5411\u3051\u306e\u8a2d\u5b9a\u30b3\u30fc\u30c9\n\n```js:config_prod.js\nangular.module('sampleApp.Conf', []).constant('APP_CONF', {\n  urlBase: '/apiContextRoot'\n});\n```\n\nindex.html\u304b\u3089\u8aad\u307f\u8fbc\u3080\u30d5\u30a1\u30a4\u30eb\u3092\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u3067, \u74b0\u5883\u306e\u5dee\u306b\u5bfe\u5fdc\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u308f\u3051\u3060.\n\n+ \u958b\u767a\u6642: `config_dev.js`\n+ \u672c\u756a\u6642: `config_prod.js`\n\n## \u5b9f\u4f8b\n\u3053\u3053\u304b\u3089\u306f, \u4e0a\u8ff0\u306e\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u3092\u4f8b\u306b, \u5b9f\u969b\u306b\u50d5\u304c\u666e\u6bb5\u4f7f\u3063\u3066\u3044\u308b\u958b\u767a\u74b0\u5883\u3092\u4e00\u90e8\u7c21\u7d20\u5316\u3057\u3066\u8aac\u660e\u3057\u3066\u307f\u308b.\n\n### Directory\u69cb\u6210\n\n\u30d3\u30eb\u30c9\u306e\u8a71\u306a\u306e\u3067\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\u306e\u8a71\u984c\u306f\u907f\u3051\u3066\u901a\u308c\u306a\u3044. \n\n\u3053\u3053\u3067\u306f, \u4ee5\u4e0b\u306e\u3088\u3046\u306a\u69cb\u6210\u3092\u524d\u63d0\u3068\u3057\u3066\u3044\u308b(Yeoman\u306e[generator-gulp-angular](https://github.com/Swiip/generator-gulp-angular)\u3067\u751f\u6210\u3059\u308b\u3053\u3068\u304c\u591a\u3044\u305f\u3081).\n\n```\n(PROJECT ROOT)\n\u251c ng-config\n\u2502\u251c config_dev.json\n\u2502\u2514 config_prod.json\n\u251c src\n\u2502\u251c app\n\u2502\u2502\u251c main.controller.js\n\u2502\u2502\u251c (\u305d\u306e\u4ed6js, html\u8272\u3005)\n\u2502\u2502\u2514 index.js\n\u2502\u2514 index.html\n\u251c bower.json\n\u251c gulpfile.js\n\u251c package.json\n\u2514 (other files)\n```\n\n### \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u8a2d\u7f6e\n\n\u5148\u8ff0\u306econfig_dev.js\u3084config_prod.js\u306b\u3064\u3044\u3066, \u4ee5\u524d\u306f\u81ea\u5206\u3067\u4f5c\u6210\u30fb\u8a18\u8ff0\u3057\u3066\u3044\u305f\u306e\u3060\u304c, AngularJS\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u5b9a\u7fa9(`angular.module(...).constant`)\u304c\u5165\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u308b\u305f\u3081\u306b\u76f4\u63a5Node\u3084gulp\u304b\u3089\u8aad\u307f\u3065\u3089\u304f, \u4e0d\u90fd\u5408\u3092\u611f\u3058\u308b\u3053\u3068\u304c\u3042\u3063\u305f. \n\u3053\u306e\u305f\u3081, \u6700\u8fd1\u306f [gulp-ng-config](https://www.npmjs.com/package/gulp-ng-config)\u3067, `config_***.json` \u2192 `config_***.js` \u3092\u751f\u6210\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b.\n\n\u4f5c\u6210\u3059\u308bJSON\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308b. constant\u306e\u4e2d\u8eab\u3092JSON\u3068\u3057\u3066\u53d6\u308a\u51fa\u3059\u3060\u3051\u3060.\n\n\n```json:ng-config/config_dev.json\n{\n  \"APP_CONF\": {\n    \"urlBase\": \"http://localhost:5080\"\n  }\n}\n```\n\n```json:ng-config/config_prod.json\n{\n  \"APP_CONF\": {\n    \"urlBase\": \"/apiContextRoot\"\n  }\n}\n```\n\n### gulp-plugin\n\u30d3\u30eb\u30c9\u306b\u5fc5\u8981\u306agulp\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u6b21\u306e\u901a\u308a:\n\n```sh\nnpm install gulp gulp-load-plugins gulp-inject gulp-ng-config --save-dev\n```\n\n### gulp-ng-config\u3068gulp-inject\u306b\u3088\u308b\u8a2d\u5b9a\u306e\u6ce8\u5165\n\n```html:src/index.html\n<html>\n  :\n  <!-- build:js({app,.tmp}) scripts/app.js -->\n  \n  <!-- inject:js -->\n  <!-- endinject -->\n  \n  <!-- endbuild -->\n  :\n</html>\n```\n\n\u4eca\u56de\u3001\u89e3\u8aac\u3059\u308b\u306e\u306f`<!-- inject:js -->` \u306e\u90e8\u5206\u3067\u3042\u308b\u304c, \u5927\u6982\u306e\u30b1\u30fc\u30b9\u3067\u306f gulp-useref\u3084gulp-usemin\u3092\u3064\u304b\u3046\u305f\u3081\u306e`<!-- build:js -->`\u306e\u30d6\u30ed\u30c3\u30af\u5185\u306b\u8a2d\u7f6e\u3055\u308c\u308b\u3053\u3068\u3060\u308d\u3046.\n\n\n### gulpfile\n\n```js:gulpfile.js\nvar gulp = require('gulp');\nvar $ = require('gulp-load-plugins')();\n\n/** 1. Profile\u306e\u7279\u5b9a. \u74b0\u5883\u5909\u6570\u304b\u3089\u3082\u53d6\u5f97\u53ef\u80fd\u306b\u3057\u3066\u304a\u304f. **/\nvar profile = process.env.PROFILE || 'dev';\n\n/** 2. .json\u2192anuglar\u306e\u8a2d\u5b9a\u30e2\u30b8\u30e5\u30fc\u30eb\u751f\u6210\u30bf\u30b9\u30af **/\ngulp.task('ngconfig', function () {\n  return gulp.src(['ng-config/config_' + profile + '.json'])\n    .pipe($.ngConfig('sampleApp.Conf'))\n    .pipe(gulp.dest('.tmp'))\n    ;\n});\n\n/** 3. \u751f\u6210\u3057\u305f.js\u3068\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306ejs\u30bd\u30fc\u30b9\u3092html\u3078\u6ce8\u5165 **/\ngulp.task('injector:js', ['ngconfig'], function () {\n  return gulp.src(['src/index.html'])\n    .pipe($.inject(gulp.src([\n      '.tmp/config_' + profile + '.js',\n      'src/app/index.js',\n      'src/**/*.js'\n    ]), {\n      ignorePath: ['src', '.tmp'],\n      addRootSlash: false\n    }))\n    .pipe(gulp.dest('src/'))\n    ;\n});\n\n```\n\n\u30dd\u30a4\u30f3\u30c8\u306f, `$.ngConfig` \u306b\u8a2d\u5b9a\u30e2\u30b8\u30e5\u30fc\u30eb\u540d(`'sampleApp.Conf'`)\u3092\u55b0\u308f\u305b\u308b\u3066pipe\u3059\u308b\u3053\u3068\u3067`config_***.js`\u304c `.tmp` \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u4f5c\u6210\u3055\u308c\u308b\u70b9\u3068, \u4f5c\u6210\u3057\u305f`config_***.js`\u3092gulp-inject\u3067\u6ce8\u5165\u3057\u3066\u3044\u308b\u70b9.\n\n\u306a\u304a\u3001gulp-inject\u306f\u300cgulpfile.js\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u8d77\u70b9\u3068\u3057\u305f\u76f8\u5bfe\u30d1\u30b9\u300d\u3092`<script src=\"...\">`\u306b\u57cb\u3081\u8fbc\u3093\u3067\u3044\u304f\u305f\u3081, index.html\u3068gulpfile.js\u304c\u5225\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u914d\u7f6e\u3055\u308c\u3066\u3044\u308b\u30b1\u30fc\u30b9\u3067\u306f, \u76f8\u5bfe\u30d1\u30b9\u306e\u57fa\u6e96\u8abf\u6574\u304c\u5fc5\u9808\u3068\u306a\u308b.\n\u3053\u3053\u3067\u306f, gulp-inject\u306e\u30aa\u30d7\u30b7\u30e7\u30f3`ignorePath`\u306b\u3066, `.tmp/`\u3068`src/` \u3092\u5207\u308a\u53d6\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b.\n\n\u3053\u308c\u3067, \u6b21\u306e\u3088\u3046\u306bgulp\u3092\u53e9\u3051\u3070, \u30c7\u30d5\u30a9\u30eb\u30c8\u306eProfile\u3068\u3057\u3066config_dev.js\u304c\u6ce8\u5165\u3055\u308c\u308b.\n\n```sh\ngulp injector:js\n```\n\n`src/index.html` \u3092\u958b\u3044\u305f\u3089, \u4e0b\u8a18\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u6ce8\u5165\u3055\u308c\u3066\u3044\u308b\u306e\u3092\u78ba\u8a8d\u3067\u304d\u308b\u306f\u305a.\n\n\n```html:src/index.html\n<html>\n  :\n  <!-- build:js({.tmp,src}) scripts/app.js -->\n  <!-- inject:js -->\n  <script src=\"config_dev.js\"></script>\n  <script src=\"src/app/index.js\"></script>\n  <script src=\"src/app/main.controller.js\"></script>\n  <!-- \u305d\u306e\u4ed6\u306ejs\u8272\u3005 -->\n  <!-- endinject -->\n  <!-- endbuild -->\n  :\n</html>\n```\n\n\n\u307e\u305f, \u4e0b\u8a18\u306e\u3088\u3046\u306b\u74b0\u5883\u5909\u6570\u3067Profile\u3092\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u3067, \u672c\u756a\u7528\u306e\u30d3\u30eb\u30c9\u306b\u3082\u5bfe\u5fdc\u3067\u304d\u308b.\n\n```sh\nexport PROFILE=prod\ngulp injector:js\n```\n\n\u30ec\u30dd\u30b8\u30c8\u30ea\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u4e00\u5207\u624b\u3092\u52a0\u3048\u308b\u3053\u3068\u306a\u304f\u958b\u767a/\u672c\u756a\u306e\u5207\u66ff\u304c\u884c\u3048\u308b\u306e\u3067, Travis CI\u3084Jenkins\u7b49, CI\u306b\u7d44\u307f\u8fbc\u3080\u306e\u3082\u5bb9\u6613\u3060.\n\n\n## \u307e\u3068\u3081\n\n+ gulp-ng-config, gulp-inject\u3067\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u6ce8\u5165\u306e\u4ed5\u7d44\u307f\u304c\u7c21\u5358\u306b\u4f5c\u308c\u308b.\n\n\u4ed6\u306b\u3082\u8272\u3005\u306a\u65b9\u6cd5\u304c\u3042\u308b\u3068\u601d\u3046\u306e\u3067, \u3088\u308a\u3088\u3044\u3084\u308a\u65b9\u3068\u304b\u3042\u3063\u305f\u3089\u6559\u3048\u3066\u307b\u3057\u3044\u306a\u30fc\u3002\n\n\n## \u304a\u307e\u3051\ngulp-ng-config\u3092\u77e5\u308b\u524d\u306b, node.js\u3067\u3082AngularJS\u3067\u3082\u8aad\u307f\u8fbc\u3081\u308b(require/$inject)\u3088\u3046\u306b\u2193\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308b\u3001\u3068\u3044\u3046\u30d7\u30e9\u30f3\u3092\u8003\u3048\u305f\u3053\u3068\u3082\u3042\u308b\u304c, \u3042\u307e\u308a\u306b\u3082\u30a2\u30db\u304f\u3055\u3044\u306e\u3067\u3084\u3081\u305f\u3002\n\n```js:src/config/config_dev.js\n'use strict';\n\n(function (factory) {\n  factory({\n    urlBase: 'http://localhost:5080'\n  });\n})(typeof angular !== 'undefined' ? function (config) {\n  return angular.module('sampleApp').constant('APP_CONF', config);\n} : function (config) {\n  module.exports = config;\n});\n```\n\n", "tags": ["AngularJS", "gulp", "JavaScript", "CI"]}