{"context": "OpenStack Liberty \u30d9\u30fc\u30b9\u3067\u3042\u308b Mirantis OpenStack\uff08\u4ee5\u4e0b\u3001MOS\uff098.0 \u3092\u30d9\u30fc\u30b9\u306b\nDVR \u306e\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u3053\u308c\u304b\u3089\u8907\u6570\u56de\u306b\u5206\u3051\u3066\u7d39\u4ecb\u3057\u3066\u3044\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u7b2c\u4e00\u56de\u306f\u3001DVR\u306e\u8aac\u660e\u3068\u74b0\u5883\u306e\u8aac\u660e\u3092\u3057\u3066\u304d\u307e\u3059\u3002\n\nDVR \u3068\u306f\n\u307e\u305a\u3001DVR \u3068\u306f\u4f55\u304b\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u3066\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u5f93\u6765\u306e Neutron \u3092\u4f7f\u7528\u3057\u305f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u306f\u3001\u5916\u90e8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3078\u306e\u901a\u4fe1\u3084\u7570\u306a\u308b\u30b5\u30d6\u30cd\u30c3\u30c8\u3078\u306e\u901a\u4fe1\u306f\u3001\n\u3059\u3079\u3066 Network Node \u4e0a\u306e\u4eee\u60f3\u30eb\u30fc\u30bf\u3092\u901a\u308b\u4ed5\u7d44\u307f\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u3057\u304b\u3057\u3001\u4e0a\u8a18\u306e\u69cb\u6210\u306e\u5834\u5408\u3001\nNetwork Node \u306e\u4eee\u60f3\u30eb\u30fc\u30bf\u304cSPOF\uff08Single Point of Failure, \u5358\u4e00\u969c\u5bb3\u70b9\uff09\u3068\u306a\u3063\u3066\u304a\u308a\u3001\n\u8ca0\u8377\u306e\u96c6\u4e2d\u306b\u3088\u308b\u30ec\u30b9\u30dd\u30f3\u30b9\u4f4e\u4e0b\u306a\u3069\u3082\u8d77\u3053\u308a\u3046\u308b\u72b6\u614b\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u305d\u306e\u554f\u984c\u3092\u89e3\u6d88\u3059\u308b\u305f\u3081\u3001DVR\u304c\u767b\u5834\u3057\u307e\u3057\u305f\u3002\nDVR\u3092\u4f7f\u7528\u3057\u305f\u5834\u5408\u3001\n\u5916\u90e8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3078\u306e\u901a\u4fe1\u3001\u7570\u306a\u308b\u30b5\u30d6\u30cd\u30c3\u30c8\u3078\u306e\u901a\u4fe1\u3068\u3082\u306b\u81ea\u30db\u30b9\u30c8\u306e\u4eee\u60f3\u30eb\u30fc\u30bf\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081\u3001\n\u8ca0\u8377\u304c\u5206\u6563\u3055\u308c\u3001\u4e07\u304c\u4e00\u4eee\u60f3\u30eb\u30fc\u30bf\u306b\u969c\u5bb3\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u306e\u5f71\u97ff\u7bc4\u56f2\u3092\u81ea\u30db\u30b9\u30c8\u306e\u307f\u306b\u6700\u5c0f\u5316\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u6ce8\uff1a\u305f\u3060\u3057\u3001North-South \u901a\u4fe1\u3067\u3001Floating IP \u3092\u4f7f\u7528\u305b\u305a NAT \u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u3001\nDVR \u69cb\u6210\u306e\u5834\u5408\u3067\u3082\u3001DVR \u3092\u4f7f\u7528\u3057\u306a\u3044\u5834\u5408\u3068\u540c\u69d8\u3001Network Node \u306e\u4eee\u60f3\u30eb\u30fc\u30bf\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n\n\n\u4f7f\u7528\u74b0\u5883\n\u307e\u305a\u691c\u8a3c\u3057\u305f\u74b0\u5883\u3092\u4ee5\u4e0b\u306b\u793a\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f\u3001Compute \u30ce\u30fc\u30c9\u3068 Storage \u30ce\u30fc\u30c9\u3092\uff11\u53f0\u306b\u96c6\u7d04\u3057\u3001\nOpenStack \u3068\u3057\u3066\u306f\u3001\u5408\u8a08\uff12\u53f0\u306e\u69cb\u6210\u3092\u53d6\u3063\u3066\u3044\u307e\u3059\u3002\n\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\n\u4ee5\u4e0b\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u3064\u3044\u3066\u7c21\u5358\u306a\u8aac\u660e\u3068\u306a\u308a\u307e\u3059\u3002\n\n\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u540d\n\u8aac\u660e\n\n\n\n\nPublic\n\u5916\u90e8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3078\u306e\u63a5\u7d9a\u306b\u4f7f\u7528\n\n\nManagement\nOpenStack \u306e\u7ba1\u7406\u7528\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\n\n\nPrivate\nOpenStack \u306e\u5185\u90e8\u901a\u4fe1\u7528\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\n\n\nStorage\n\u30b9\u30c8\u30ec\u30fc\u30b8\u7528\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\n\n\nAdmin(PXE)\nFuel Master(\u203b) \u3068\u5404\u30ce\u30fc\u30c9\u3068\u306e\u901a\u4fe1\u3067\u4f7f\u7528\n\n\n\n\n\u30c7\u30d7\u30ed\u30a4\u5f8c\u306e\u8a2d\u5b9a\u78ba\u8a8d\n\n\u5168\u4f53\u69cb\u6210\n\u4e0a\u8a18\u306e\u74b0\u5883\u3067\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u3068\u51fa\u6765\u4e0a\u304c\u3063\u305f\u74b0\u5883\u304c\u3053\u3061\u3089\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n\u9752\u80cc\u666f\uff1aUP \u3057\u3066\u3044\u308b NIC \u304a\u3088\u3073\u30b9\u30a4\u30c3\u30c1\n\u30b0\u30ec\u30fc\uff1aDOWN \u3057\u3066\u3044\u308b NIC \u304a\u3088\u3073\u30b9\u30a4\u30c3\u30c1\uff08br-int \u304a\u3088\u3073 br-tun \u306f\u30dd\u30fc\u30c8\u306e\u307f UP \u3057\u3066\u3044\u308b\u72b6\u614b\uff09\n\u5c11\u3005\u8907\u96d1\u306a\u306e\u3067\u3001\u6b21\u56de\u4ee5\u964d\u3001\u7c21\u7565\u5316\u3057\u305f\u4ee5\u4e0b\u306e\u56f3\u3092\u7528\u3044\u3066\u8aac\u660e\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n\nVRRP(L3HA) \u306b\u3064\u3044\u3066\u306f\u3001\u4eca\u56de\u7701\u7565\u3057\u307e\u3057\u305f\u3002\n\u5225\u306e\u8a18\u4e8b\u3067\u5225\u9014\u8a18\u8f09\u3055\u305b\u3066\u3044\u305f\u3060\u3053\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u8a73\u7d30\n\nLinux \u30d6\u30ea\u30c3\u30b8\n\ncontroller01 / compute01\n\n\n\n\u540d\u79f0\n\u8aac\u660e\n\n\n\n\nbr-fw-admin\nAdmin(PXE) \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u901a\u4fe1\u7528\u30d6\u30ea\u30c3\u30b8\n\n\nbr-mgmt\nManagement \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u901a\u4fe1\u7528\u30d6\u30ea\u30c3\u30b8\n\n\nbr-ex\nPublic \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u901a\u4fe1\u7528\u30d6\u30ea\u30c3\u30b8\n\n\nbr-mesh\nPrivate \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u901a\u4fe1\u7528\u30d6\u30ea\u30c3\u30b8\n\n\nbr-storage\nStorage \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u901a\u4fe1\u7528\u30d6\u30ea\u30c3\u30b8\n\n\nqbr***\n\u4eee\u60f3\u30de\u30b7\u30f3\u3068 br-int \u3092\u3064\u306a\u3050\u305f\u3081\u306e\u30d6\u30ea\u30c3\u30b8\n\n\n\n\nOVS \u30d6\u30ea\u30c3\u30b8\n\ncontroller01 / compute01\n\n\n\n\u540d\u79f0\n\u8aac\u660e\n\n\n\n\nbr-floating\nFloating IP \u4f7f\u7528\u6642\u3001\u304a\u3088\u3073\u5916\u90e8\u901a\u4fe1\u6642\u306b\u4f7f\u7528\u3055\u308c\u308b\u30d6\u30ea\u30c3\u30b8\n\n\nbr-tun\nVXLAN \u3084 GRE \u30c8\u30f3\u30cd\u30eb\u4f7f\u7528\u3057\u3066\u5185\u90e8\u30db\u30b9\u30c8\u9593\u3067\u306e\u901a\u4fe1\u306b\u4f7f\u7528\u3055\u308c\u308b\u30d6\u30ea\u30c3\u30b8\n\n\nbr-int\n\u5185\u90e8\u901a\u4fe1\u3067\u4e3b\u306b\u4f7f\u7528\u3055\u308c\u308b\u30d6\u30ea\u30c3\u30b8\n\n\n\n\nNameSpace\n\ncontroller01\n\n\n\n\u540d\u79f0\n\u8aac\u660e\n\n\n\n\nsnat-***\n\u4eee\u60f3 NAT\n\n\nqrouter-***\n\u4eee\u60f3\u30eb\u30fc\u30bf\n\n\nqdhcp-***\n\u4eee\u60f3 DHCP\n\n\nhaproxy-***\nHAProxy\n\n\n\n\ncompute01\n\n\n\n\u540d\u79f0\n\u8aac\u660e\n\n\n\n\nfip-***\nFloating IP\n\n\nqrouter-***\n\u4eee\u60f3\u30eb\u30fc\u30bf\n\n\n\n\nNeutron \u8a2d\u5b9a\n\n/etc/neutron/neutron.conf\uff08\u629c\u7c8b\uff09\n\ncontroller01\n[DEFAULT]\nrouter_distributed = True   # DVR\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081 'True' \u3092\u8a2d\u5b9a\ncore_plugin = neutron.plugins.ml2.plugin.Ml2Plugin\nservice_plugins =neutron.services.l3_router.l3_router_plugin.L3RouterPlugin,neutron.services.metering.metering_plugin.MeteringPlugin\nl3_ha = False\n# dvr_base_mac = fa:16:3f:00:00:00    # DVR\u3092\u4f7f\u7528\u3059\u308b\u969b\u3001\u4f7f\u7528\u3059\u308b\u81ea\u30db\u30b9\u30c8\u306eMAC\uff08\u5f8c\u8ff0\uff09\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u4f7f\u7528\n\n\ncompute01\n[DEFAULT]\ncore_plugin = neutron.plugins.ml2.plugin.Ml2Plugin\nservice_plugins =neutron.services.l3_router.l3_router_plugin.L3RouterPlugin,neutron.services.metering.metering_plugin.MeteringPlugin\nauth_strategy = keystone\n# dvr_base_mac = fa:16:3f:00:00:00    # DVR\u3092\u4f7f\u7528\u3059\u308b\u969b\u3001\u4f7f\u7528\u3059\u308b\u81ea\u30db\u30b9\u30c8\u306eMAC\uff08\u5f8c\u8ff0\uff09\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u4f7f\u7528\n\n\n/etc/neutron/l3_agent.ini\uff08\u629c\u7c8b\uff09\n\ncontroller01\n[DEFAULT]\nagent_mode = dvr_snat    # DVR\u304a\u3088\u3073NAT\u6a5f\u80fd\n\n\ncompute01\n[DEFAULT]\nagent_mode = dvr    # DVR\u6a5f\u80fd\n\n\n/etc/neutron/plugins/ml2/ml2_conf.ini\uff08\u629c\u7c8b\uff09\n\ncontroller01\n[ml2]\ntype_drivers = local,flat,vlan,gre,vxlan\ntenant_network_types = flat,vxlan\nmechanism_drivers =openvswitch,l2population\nextension_drivers =port_security\n[ml2_type_gre]\ntunnel_id_ranges =2:65535\n[ml2_type_vxlan]\nvni_ranges =2:65535\nvxlan_group =224.0.0.1\n[securitygroup]\nenable_security_group = True\n[ovs]\ntunnel_bridge=br-tun\nenable_tunneling=True\nintegration_bridge=br-int\nbridge_mappings=physnet1:br-floating\n[agent]\nenable_distributed_routing=True   # DVR\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081 'True' \u3092\u8a2d\u5b9a\nprevent_arp_spoofing=True\narp_responder=True\npolling_interval=2\ndrop_flows_on_start=False\nvxlan_udp_port=4789\nl2_population=True\ntunnel_types=vxlan\n\n\ncompute01\n[ovs]\ntunnel_bridge=br-tun\nenable_tunneling=True\nintegration_bridge=br-int\nbridge_mappings=physnet1:br-floating\n[agent]\nenable_distributed_routing=True   # DVR\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081 'True' \u3092\u8a2d\u5b9a\nprevent_arp_spoofing=True\narp_responder=True\npolling_interval=2\ndrop_flows_on_start=False\nvxlan_udp_port=4789\nl2_population=True\ntunnel_types=vxlan\n\n\n\u6ce8\u91c8\n\u203b Fuel Master \u30fb\u30fb\u30fb MOS \u306e\u30c7\u30d7\u30ed\u30a4\u304a\u3088\u3073\u7ba1\u7406\u7528\u30ce\u30fc\u30c9\nOpenStack Liberty \u30d9\u30fc\u30b9\u3067\u3042\u308b Mirantis OpenStack\uff08\u4ee5\u4e0b\u3001MOS\uff098.0 \u3092\u30d9\u30fc\u30b9\u306b\nDVR \u306e\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u3053\u308c\u304b\u3089\u8907\u6570\u56de\u306b\u5206\u3051\u3066\u7d39\u4ecb\u3057\u3066\u3044\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u7b2c\u4e00\u56de\u306f\u3001DVR\u306e\u8aac\u660e\u3068\u74b0\u5883\u306e\u8aac\u660e\u3092\u3057\u3066\u304d\u307e\u3059\u3002\n\n# DVR \u3068\u306f\n\u307e\u305a\u3001DVR \u3068\u306f\u4f55\u304b\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u3066\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u5f93\u6765\u306e Neutron \u3092\u4f7f\u7528\u3057\u305f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u306f\u3001\u5916\u90e8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3078\u306e\u901a\u4fe1\u3084\u7570\u306a\u308b\u30b5\u30d6\u30cd\u30c3\u30c8\u3078\u306e\u901a\u4fe1\u306f\u3001\n\u3059\u3079\u3066 Network Node \u4e0a\u306e\u4eee\u60f3\u30eb\u30fc\u30bf\u3092\u901a\u308b\u4ed5\u7d44\u307f\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n<img width=\"500px\" alt=\"\u30b9\u30e9\u30a4\u30c91.PNG\" src=\"https://qiita-image-store.s3.amazonaws.com/0/121387/8c679219-c18d-7f94-3b56-1ecc544bbcdf.png\"><br>\n\u3057\u304b\u3057\u3001\u4e0a\u8a18\u306e\u69cb\u6210\u306e\u5834\u5408\u3001\nNetwork Node \u306e\u4eee\u60f3\u30eb\u30fc\u30bf\u304cSPOF\uff08Single Point of Failure, \u5358\u4e00\u969c\u5bb3\u70b9\uff09\u3068\u306a\u3063\u3066\u304a\u308a\u3001\n\u8ca0\u8377\u306e\u96c6\u4e2d\u306b\u3088\u308b\u30ec\u30b9\u30dd\u30f3\u30b9\u4f4e\u4e0b\u306a\u3069\u3082\u8d77\u3053\u308a\u3046\u308b\u72b6\u614b\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u305d\u306e\u554f\u984c\u3092\u89e3\u6d88\u3059\u308b\u305f\u3081\u3001DVR\u304c\u767b\u5834\u3057\u307e\u3057\u305f\u3002\nDVR\u3092\u4f7f\u7528\u3057\u305f\u5834\u5408\u3001\n\u5916\u90e8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3078\u306e\u901a\u4fe1\u3001\u7570\u306a\u308b\u30b5\u30d6\u30cd\u30c3\u30c8\u3078\u306e\u901a\u4fe1\u3068\u3082\u306b\u81ea\u30db\u30b9\u30c8\u306e\u4eee\u60f3\u30eb\u30fc\u30bf\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081\u3001\n\u8ca0\u8377\u304c\u5206\u6563\u3055\u308c\u3001\u4e07\u304c\u4e00\u4eee\u60f3\u30eb\u30fc\u30bf\u306b\u969c\u5bb3\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u306e\u5f71\u97ff\u7bc4\u56f2\u3092\u81ea\u30db\u30b9\u30c8\u306e\u307f\u306b\u6700\u5c0f\u5316\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3059\u3002\n\n>\u6ce8\uff1a\u305f\u3060\u3057\u3001North-South \u901a\u4fe1\u3067\u3001Floating IP \u3092\u4f7f\u7528\u305b\u305a NAT \u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u3001\nDVR \u69cb\u6210\u306e\u5834\u5408\u3067\u3082\u3001DVR \u3092\u4f7f\u7528\u3057\u306a\u3044\u5834\u5408\u3068\u540c\u69d8\u3001Network Node \u306e\u4eee\u60f3\u30eb\u30fc\u30bf\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n<img width=\"400px\" alt=\"\u30b9\u30e9\u30a4\u30c92.PNG\" src=\"https://qiita-image-store.s3.amazonaws.com/0/121387/62f23969-283c-f85a-5088-bed1b492057a.png\">\n\n# \u4f7f\u7528\u74b0\u5883\n\u307e\u305a\u691c\u8a3c\u3057\u305f\u74b0\u5883\u3092\u4ee5\u4e0b\u306b\u793a\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f\u3001Compute \u30ce\u30fc\u30c9\u3068 Storage \u30ce\u30fc\u30c9\u3092\uff11\u53f0\u306b\u96c6\u7d04\u3057\u3001\nOpenStack \u3068\u3057\u3066\u306f\u3001\u5408\u8a08\uff12\u53f0\u306e\u69cb\u6210\u3092\u53d6\u3063\u3066\u3044\u307e\u3059\u3002\n![apc-env.png](https://qiita-image-store.s3.amazonaws.com/0/121387/f4928b9a-2fd4-a97d-9647-6963792d0d9f.png)\n\n## \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\n\u4ee5\u4e0b\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u3064\u3044\u3066\u7c21\u5358\u306a\u8aac\u660e\u3068\u306a\u308a\u307e\u3059\u3002\n\n|\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u540d|\u8aac\u660e|\n|---|---|\n|Public|\u5916\u90e8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3078\u306e\u63a5\u7d9a\u306b\u4f7f\u7528|\n|Management|OpenStack \u306e\u7ba1\u7406\u7528\u30cd\u30c3\u30c8\u30ef\u30fc\u30af|\n|Private|OpenStack \u306e\u5185\u90e8\u901a\u4fe1\u7528\u30cd\u30c3\u30c8\u30ef\u30fc\u30af|\n|Storage|\u30b9\u30c8\u30ec\u30fc\u30b8\u7528\u30cd\u30c3\u30c8\u30ef\u30fc\u30af|\n|Admin(PXE)|Fuel Master(\u203b) \u3068\u5404\u30ce\u30fc\u30c9\u3068\u306e\u901a\u4fe1\u3067\u4f7f\u7528| \n\n# \u30c7\u30d7\u30ed\u30a4\u5f8c\u306e\u8a2d\u5b9a\u78ba\u8a8d\n## \u5168\u4f53\u69cb\u6210\n\u4e0a\u8a18\u306e\u74b0\u5883\u3067\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u3068\u51fa\u6765\u4e0a\u304c\u3063\u305f\u74b0\u5883\u304c\u3053\u3061\u3089\u306b\u306a\u308a\u307e\u3059\u3002\n![blog_default_controller (1).png](https://qiita-image-store.s3.amazonaws.com/0/121387/e9c2696a-3880-705d-6539-e750c80809bf.png)\n![blog_default_compute (1).png](https://qiita-image-store.s3.amazonaws.com/0/121387/1a4a8ea7-df31-1638-0cad-a3f5b54057ea.png)\n\u9752\u80cc\u666f\uff1aUP \u3057\u3066\u3044\u308b NIC \u304a\u3088\u3073\u30b9\u30a4\u30c3\u30c1\n\u30b0\u30ec\u30fc\uff1aDOWN \u3057\u3066\u3044\u308b NIC \u304a\u3088\u3073\u30b9\u30a4\u30c3\u30c1\uff08br-int \u304a\u3088\u3073 br-tun \u306f\u30dd\u30fc\u30c8\u306e\u307f UP \u3057\u3066\u3044\u308b\u72b6\u614b\uff09\n\n\u5c11\u3005\u8907\u96d1\u306a\u306e\u3067\u3001\u6b21\u56de\u4ee5\u964d\u3001\u7c21\u7565\u5316\u3057\u305f\u4ee5\u4e0b\u306e\u56f3\u3092\u7528\u3044\u3066\u8aac\u660e\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n![simple_default_controller (1).png](https://qiita-image-store.s3.amazonaws.com/0/121387/c62bd700-96bb-b187-c5d9-ac48aaad9890.png)\n![simple_default_compute (1).png](https://qiita-image-store.s3.amazonaws.com/0/121387/8173d085-7359-5ae9-ae80-8a941969a358.png)\n\nVRRP(L3HA) \u306b\u3064\u3044\u3066\u306f\u3001\u4eca\u56de\u7701\u7565\u3057\u307e\u3057\u305f\u3002\n\u5225\u306e\u8a18\u4e8b\u3067\u5225\u9014\u8a18\u8f09\u3055\u305b\u3066\u3044\u305f\u3060\u3053\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n## \u8a73\u7d30\n### Linux \u30d6\u30ea\u30c3\u30b8\n#### controller01 / compute01\n|\u540d\u79f0|\u8aac\u660e|\n|---|---|\n|br-fw-admin|Admin(PXE) \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u901a\u4fe1\u7528\u30d6\u30ea\u30c3\u30b8|\n|br-mgmt|Management \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u901a\u4fe1\u7528\u30d6\u30ea\u30c3\u30b8|\n|br-ex|Public \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u901a\u4fe1\u7528\u30d6\u30ea\u30c3\u30b8|\n|br-mesh|Private \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u901a\u4fe1\u7528\u30d6\u30ea\u30c3\u30b8|\n|br-storage|Storage \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u901a\u4fe1\u7528\u30d6\u30ea\u30c3\u30b8|\n|qbr\\*\\*\\*|\u4eee\u60f3\u30de\u30b7\u30f3\u3068 br-int \u3092\u3064\u306a\u3050\u305f\u3081\u306e\u30d6\u30ea\u30c3\u30b8|\n\n### OVS \u30d6\u30ea\u30c3\u30b8\n#### controller01 / compute01\n|\u540d\u79f0|\u8aac\u660e|\n|---|---|\n|br-floating|Floating IP \u4f7f\u7528\u6642\u3001\u304a\u3088\u3073\u5916\u90e8\u901a\u4fe1\u6642\u306b\u4f7f\u7528\u3055\u308c\u308b\u30d6\u30ea\u30c3\u30b8|\n|br-tun|VXLAN \u3084 GRE \u30c8\u30f3\u30cd\u30eb\u4f7f\u7528\u3057\u3066\u5185\u90e8\u30db\u30b9\u30c8\u9593\u3067\u306e\u901a\u4fe1\u306b\u4f7f\u7528\u3055\u308c\u308b\u30d6\u30ea\u30c3\u30b8|\n|br-int|\u5185\u90e8\u901a\u4fe1\u3067\u4e3b\u306b\u4f7f\u7528\u3055\u308c\u308b\u30d6\u30ea\u30c3\u30b8|\n\n### NameSpace\n#### controller01\n|\u540d\u79f0|\u8aac\u660e|\n|---|---|\n|snat-\\*\\*\\*|\u4eee\u60f3 NAT|\n|qrouter-\\*\\*\\*|\u4eee\u60f3\u30eb\u30fc\u30bf|\n|qdhcp-\\*\\*\\*|\u4eee\u60f3 DHCP|\n|haproxy-\\*\\*\\*|HAProxy|\n\n#### compute01\n|\u540d\u79f0|\u8aac\u660e|\n|---|---|\n|fip-\\*\\*\\*|Floating IP|\n|qrouter-\\*\\*\\*|\u4eee\u60f3\u30eb\u30fc\u30bf|\n\n### Neutron \u8a2d\u5b9a\n\n#### /etc/neutron/neutron.conf\uff08\u629c\u7c8b\uff09\n##### controller01\n```bash\n[DEFAULT]\nrouter_distributed = True   # DVR\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081 'True' \u3092\u8a2d\u5b9a\ncore_plugin = neutron.plugins.ml2.plugin.Ml2Plugin\nservice_plugins =neutron.services.l3_router.l3_router_plugin.L3RouterPlugin,neutron.services.metering.metering_plugin.MeteringPlugin\nl3_ha = False\n# dvr_base_mac = fa:16:3f:00:00:00    # DVR\u3092\u4f7f\u7528\u3059\u308b\u969b\u3001\u4f7f\u7528\u3059\u308b\u81ea\u30db\u30b9\u30c8\u306eMAC\uff08\u5f8c\u8ff0\uff09\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u4f7f\u7528\n```\n##### compute01\n```bash\n[DEFAULT]\ncore_plugin = neutron.plugins.ml2.plugin.Ml2Plugin\nservice_plugins =neutron.services.l3_router.l3_router_plugin.L3RouterPlugin,neutron.services.metering.metering_plugin.MeteringPlugin\nauth_strategy = keystone\n# dvr_base_mac = fa:16:3f:00:00:00    # DVR\u3092\u4f7f\u7528\u3059\u308b\u969b\u3001\u4f7f\u7528\u3059\u308b\u81ea\u30db\u30b9\u30c8\u306eMAC\uff08\u5f8c\u8ff0\uff09\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u4f7f\u7528\n```\n\n#### /etc/neutron/l3_agent.ini\uff08\u629c\u7c8b\uff09\n##### controller01\n```bash\n[DEFAULT]\nagent_mode = dvr_snat    # DVR\u304a\u3088\u3073NAT\u6a5f\u80fd\n```\n##### compute01\n```bash\n[DEFAULT]\nagent_mode = dvr    # DVR\u6a5f\u80fd\n```\n\n#### /etc/neutron/plugins/ml2/ml2_conf.ini\uff08\u629c\u7c8b\uff09\n##### controller01\n```bash\n[ml2]\ntype_drivers = local,flat,vlan,gre,vxlan\ntenant_network_types = flat,vxlan\nmechanism_drivers =openvswitch,l2population\nextension_drivers =port_security\n[ml2_type_gre]\ntunnel_id_ranges =2:65535\n[ml2_type_vxlan]\nvni_ranges =2:65535\nvxlan_group =224.0.0.1\n[securitygroup]\nenable_security_group = True\n[ovs]\ntunnel_bridge=br-tun\nenable_tunneling=True\nintegration_bridge=br-int\nbridge_mappings=physnet1:br-floating\n[agent]\nenable_distributed_routing=True   # DVR\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081 'True' \u3092\u8a2d\u5b9a\nprevent_arp_spoofing=True\narp_responder=True\npolling_interval=2\ndrop_flows_on_start=False\nvxlan_udp_port=4789\nl2_population=True\ntunnel_types=vxlan\n```\n##### compute01\n```bash\n[ovs]\ntunnel_bridge=br-tun\nenable_tunneling=True\nintegration_bridge=br-int\nbridge_mappings=physnet1:br-floating\n[agent]\nenable_distributed_routing=True   # DVR\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081 'True' \u3092\u8a2d\u5b9a\nprevent_arp_spoofing=True\narp_responder=True\npolling_interval=2\ndrop_flows_on_start=False\nvxlan_udp_port=4789\nl2_population=True\ntunnel_types=vxlan\n```\n\n# \u6ce8\u91c8\n\u203b Fuel Master \u30fb\u30fb\u30fb MOS \u306e\u30c7\u30d7\u30ed\u30a4\u304a\u3088\u3073\u7ba1\u7406\u7528\u30ce\u30fc\u30c9\n", "tags": ["openstack", "mirantis", "DVR"]}