{"tags": ["Linux", "Ubuntu", "Cassandra"], "context": " \u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u65e5\u304b\u30891\u5e74\u4ee5\u4e0a\u304c\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002Cassandra\u306b\u3066\u30ce\u30fc\u30c9\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u9593\u306e\u901a\u4fe1\u3092\u6697\u53f7\u5316\u3059\u308b\u8a2d\u5b9a\u3092\u884c\u3063\u305f\u306e\u3067\u305d\u306e\u30e1\u30e2\u3067\u3059\u3002\n\n\u74b0\u5883\n\nVagrant 1.7.4\nUbuntu 14.04.3 LTS x 2\nCassandra 2.1.12\n\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVAGRANTFILE_API_VERSION = \"2\"\n\nVagrant.configure(VAGRANTFILE_API_VERSION) do |config|\n  config.vm.box = \"ubuntu/trusty64\"\n  config.vm.define \"client\" do |client|\n    client.vm.hostname = \"client\"\n    client.vm.network \"private_network\", ip: \"192.168.12.10\"\n    client.vm.provision \"shell\", inline: <<-SHELL\n      echo \"127.0.0.1     localhost\" >  /etc/hosts\n      echo \"192.168.12.10 client\"    >> /etc/hosts\n      echo \"192.168.12.11 node\"     >> /etc/hosts\n    SHELL\n  end\n  config.vm.define \"node\" do |node|\n    node.vm.hostname = \"node\"\n    node.vm.network \"private_network\", ip: \"192.168.12.11\"\n    node.vm.provision \"shell\", inline: <<-SHELL\n      echo \"127.0.0.1     localhost\" >  /etc/hosts\n      echo \"192.168.12.10 client\"    >> /etc/hosts\n      echo \"192.168.12.11 node\"     >> /etc/hosts\n    SHELL\n  end\nend\n\n\nCassandra \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb(node/client\u4e21\u65b9)\n\u8a18\u4e8b\u3068\u540c\u69d8\u306bCassandra\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002node/client\u4e21\u65b9\u306e\u30de\u30b7\u30f3\u3067\u884c\u3044\u307e\u3059\u3002\n$ vagrant ssh node\nvagrant@node:~$ sudo add-apt-repository -y ppa:openjdk-r/ppa\nvagrant@node:~$ sudo apt-get update\nvagrant@node:~$ sudo apt-get install -y openjdk-8-jdk\nvagrant@node:~$ echo 'JAVA_HOME=\"/usr/lib/jvm/java-8-openjdk-amd64\"' | sudo tee -a /etc/environment\nvagrant@node:~$ source /etc/environment\nvagrant@node:~$ echo 'deb http://www.apache.org/dist/cassandra/debian 21x main' | sudo tee -a /etc/apt/sources.list.d/cassandra.list\nvagrant@node:~$ echo 'deb-src http://www.apache.org/dist/cassandra/debian 21x main' | sudo tee -a /etc/apt/sources.list.d/cassandra.list\nvagrant@node:~$ sudo apt-get update\nvagrant@node:~$ gpg --keyserver pgp.mit.edu --recv-keys 749D6EEC0353B12C\nvagrant@node:~$ gpg --export --armor 749D6EEC0353B12C | sudo apt-key add -\nvagrant@node:~$ sudo apt-get update\nvagrant@node:~$ sudo apt-get install -y cassandra\n\n\n\u8a3c\u660e\u66f8\u3068\u9375\u306e\u6e96\u5099(node\u306e\u307f)\n\u6697\u53f7\u901a\u4fe1\u306b\u7528\u3044\u308b\u8a3c\u660e\u66f8\u3084\u9375\u3092\u6e96\u5099\u3057\u307e\u3059\u3002node\u30b5\u30fc\u30d0\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3001\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\nvagrant@node:~$ cd /etc/cassandra/\nvagrant@node:/etc/cassandra$ sudo mkdir conf\nvagrant@node:/etc/cassandra/conf$ sudo keytool -genkey -keyalg RSA -alias node -keystore .keystore -dname \"CN=Testuser, OU=Private, O=Company, C=JP\" -storepass cassandra -keypass cassandra\nvagrant@node:/etc/cassandra/conf$ sudo keytool -export -alias node -file /tmp/node.cer -keystore .keystore -storepass cassandra -keypass cassandra\nvagrant@node:/etc/cassandra/conf$ sudo keytool -import -v -trustcacerts -alias node -file /tmp/node.cer -keystore .truststore -storepass cassandra -keypass cassandra\nvagrant@node:/etc/cassandra/conf$ sudo keytool -importkeystore -srckeystore .keystore -destkeystore client.p12 -deststoretype PKCS12\nvagrant@node:/etc/cassandra/conf$ sudo openssl pkcs12 -in client.p12  -out /tmp/client.pem -nodes\nvagrant@node:/etc/cassandra/conf$ scp /tmp/client.pem client:/home/vagrant/\n\n\nCassandra\u306e\u8a2d\u5b9a(node\u306e\u307f)\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u3001\u8a2d\u5b9a\u3092\u884c\u3063\u3066\u3044\u304d\u307e\u3059\u3002\nvagrant@node:~$ sudo chmod 750 /var/run/cassandra\nvagrant@node:~$ sudo sed -i 's/CMD_PATT=.*/CMD_PATT=\"cassandra\"/' /etc/init.d/cassandra\nvagrant@node:~$ sudo sed -i 's/^#HEAP_NEWSIZE=.*/HEAP_NEWSIZE=\"40M\"/' /etc/cassandra/cassandra-env.sh  | grep HEAP_NEWSIZE\nvagrant@node:~$ sudo sed -i 's/^#MAX_HEAP_SIZE=.*/MAX_HEAP_SIZE=\"100M\"/' /etc/cassandra/cassandra-env.sh  | grep MAX_HEAP_SIZE\nvagrant@node:~$ sudo sed -i 's/127.0.0.1/192.168.12.11/' /etc/cassandra/cassandra.yaml\nvagrant@node:~$ sudo sed -i 's/localhost/192.168.12.11/' /etc/cassandra/cassandra.yaml\n\nclient_encryption_options \u3092\u4e0b\u8a18\u306e\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n# sudo vi /etc/cassandra/cassandra.yaml\nclient_encryption_options:\n    enabled: true\n    keystore: /etc/cassandra/conf/.keystore\n    keystore_password: cassandra\n    require_client_auth: false\n    truststore: /etc/cassandra/conf/.truststore\n    truststore_password: cassandra\n\n\u5fc5\u9808\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u30e6\u30fc\u30b6\u8a8d\u8a3c\u3092\u304b\u3051\u308b\u305f\u3081\u3001authenticator\u3068authorizer\u3092\u5909\u66f4\u3057\u307e\u3057\u305f\u3002\n# sudo vi /etc/cassandra/cassandra.yaml\nauthenticator: PasswordAuthenticator\nauthorizer: CassandraAuthorizer\n\n\n\u52d5\u4f5c\u78ba\u8a8d\nnode\u306b\u3066Cassandra\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\nvagrant@node:~$ sudo service cassandra start\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u3066\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\nvagrant@client:~$ SSL_CERTFILE=client.pem cqlsh node -ucassandra -pcassandra --ssl\nConnected to Test Cluster at node:9042.\n[cqlsh 5.0.1 | Cassandra 2.1.13 | CQL spec 3.2.1 | Native protocol v3]\nUse HELP for help.\ncassandra@cqlsh>\n\n\nCassandra\u306b\u3066\u30ce\u30fc\u30c9\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u9593\u306e\u901a\u4fe1\u3092\u6697\u53f7\u5316\u3059\u308b\u8a2d\u5b9a\u3092\u884c\u3063\u305f\u306e\u3067\u305d\u306e\u30e1\u30e2\u3067\u3059\u3002\n\n## \u74b0\u5883\n\n* Vagrant 1.7.4\n* Ubuntu 14.04.3 LTS x 2\n* Cassandra 2.1.12\n\n```\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVAGRANTFILE_API_VERSION = \"2\"\n\nVagrant.configure(VAGRANTFILE_API_VERSION) do |config|\n  config.vm.box = \"ubuntu/trusty64\"\n  config.vm.define \"client\" do |client|\n    client.vm.hostname = \"client\"\n    client.vm.network \"private_network\", ip: \"192.168.12.10\"\n    client.vm.provision \"shell\", inline: <<-SHELL\n      echo \"127.0.0.1     localhost\" >  /etc/hosts\n      echo \"192.168.12.10 client\"    >> /etc/hosts\n      echo \"192.168.12.11 node\"     >> /etc/hosts\n    SHELL\n  end\n  config.vm.define \"node\" do |node|\n    node.vm.hostname = \"node\"\n    node.vm.network \"private_network\", ip: \"192.168.12.11\"\n    node.vm.provision \"shell\", inline: <<-SHELL\n      echo \"127.0.0.1     localhost\" >  /etc/hosts\n      echo \"192.168.12.10 client\"    >> /etc/hosts\n      echo \"192.168.12.11 node\"     >> /etc/hosts\n    SHELL\n  end\nend\n```\n\n## Cassandra \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb(node/client\u4e21\u65b9)\n\n[\u8a18\u4e8b](http://qiita.com/noralife/items/47b5e6da6befbd8e0d10)\u3068\u540c\u69d8\u306bCassandra\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002node/client\u4e21\u65b9\u306e\u30de\u30b7\u30f3\u3067\u884c\u3044\u307e\u3059\u3002\n\n```\n$ vagrant ssh node\nvagrant@node:~$ sudo add-apt-repository -y ppa:openjdk-r/ppa\nvagrant@node:~$ sudo apt-get update\nvagrant@node:~$ sudo apt-get install -y openjdk-8-jdk\nvagrant@node:~$ echo 'JAVA_HOME=\"/usr/lib/jvm/java-8-openjdk-amd64\"' | sudo tee -a /etc/environment\nvagrant@node:~$ source /etc/environment\nvagrant@node:~$ echo 'deb http://www.apache.org/dist/cassandra/debian 21x main' | sudo tee -a /etc/apt/sources.list.d/cassandra.list\nvagrant@node:~$ echo 'deb-src http://www.apache.org/dist/cassandra/debian 21x main' | sudo tee -a /etc/apt/sources.list.d/cassandra.list\nvagrant@node:~$ sudo apt-get update\nvagrant@node:~$ gpg --keyserver pgp.mit.edu --recv-keys 749D6EEC0353B12C\nvagrant@node:~$ gpg --export --armor 749D6EEC0353B12C | sudo apt-key add -\nvagrant@node:~$ sudo apt-get update\nvagrant@node:~$ sudo apt-get install -y cassandra\n```\n\n## \u8a3c\u660e\u66f8\u3068\u9375\u306e\u6e96\u5099(node\u306e\u307f)\n\n\u6697\u53f7\u901a\u4fe1\u306b\u7528\u3044\u308b\u8a3c\u660e\u66f8\u3084\u9375\u3092\u6e96\u5099\u3057\u307e\u3059\u3002node\u30b5\u30fc\u30d0\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3001\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\nvagrant@node:~$ cd /etc/cassandra/\nvagrant@node:/etc/cassandra$ sudo mkdir conf\nvagrant@node:/etc/cassandra/conf$ sudo keytool -genkey -keyalg RSA -alias node -keystore .keystore -dname \"CN=Testuser, OU=Private, O=Company, C=JP\" -storepass cassandra -keypass cassandra\nvagrant@node:/etc/cassandra/conf$ sudo keytool -export -alias node -file /tmp/node.cer -keystore .keystore -storepass cassandra -keypass cassandra\nvagrant@node:/etc/cassandra/conf$ sudo keytool -import -v -trustcacerts -alias node -file /tmp/node.cer -keystore .truststore -storepass cassandra -keypass cassandra\nvagrant@node:/etc/cassandra/conf$ sudo keytool -importkeystore -srckeystore .keystore -destkeystore client.p12 -deststoretype PKCS12\nvagrant@node:/etc/cassandra/conf$ sudo openssl pkcs12 -in client.p12  -out /tmp/client.pem -nodes\nvagrant@node:/etc/cassandra/conf$ scp /tmp/client.pem client:/home/vagrant/\n```\n\n## Cassandra\u306e\u8a2d\u5b9a(node\u306e\u307f)\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u3001\u8a2d\u5b9a\u3092\u884c\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\n```\nvagrant@node:~$ sudo chmod 750 /var/run/cassandra\nvagrant@node:~$ sudo sed -i 's/CMD_PATT=.*/CMD_PATT=\"cassandra\"/' /etc/init.d/cassandra\nvagrant@node:~$ sudo sed -i 's/^#HEAP_NEWSIZE=.*/HEAP_NEWSIZE=\"40M\"/' /etc/cassandra/cassandra-env.sh  | grep HEAP_NEWSIZE\nvagrant@node:~$ sudo sed -i 's/^#MAX_HEAP_SIZE=.*/MAX_HEAP_SIZE=\"100M\"/' /etc/cassandra/cassandra-env.sh  | grep MAX_HEAP_SIZE\nvagrant@node:~$ sudo sed -i 's/127.0.0.1/192.168.12.11/' /etc/cassandra/cassandra.yaml\nvagrant@node:~$ sudo sed -i 's/localhost/192.168.12.11/' /etc/cassandra/cassandra.yaml\n```\n\n`client_encryption_options` \u3092\u4e0b\u8a18\u306e\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```\n# sudo vi /etc/cassandra/cassandra.yaml\nclient_encryption_options:\n    enabled: true\n    keystore: /etc/cassandra/conf/.keystore\n    keystore_password: cassandra\n    require_client_auth: false\n    truststore: /etc/cassandra/conf/.truststore\n    truststore_password: cassandra\n```\n\n\u5fc5\u9808\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u30e6\u30fc\u30b6\u8a8d\u8a3c\u3092\u304b\u3051\u308b\u305f\u3081\u3001`authenticator`\u3068`authorizer`\u3092\u5909\u66f4\u3057\u307e\u3057\u305f\u3002\n\n```\n# sudo vi /etc/cassandra/cassandra.yaml\nauthenticator: PasswordAuthenticator\nauthorizer: CassandraAuthorizer\n```\n\n## \u52d5\u4f5c\u78ba\u8a8d\nnode\u306b\u3066Cassandra\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```\nvagrant@node:~$ sudo service cassandra start\n```\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u3066\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\nvagrant@client:~$ SSL_CERTFILE=client.pem cqlsh node -ucassandra -pcassandra --ssl\nConnected to Test Cluster at node:9042.\n[cqlsh 5.0.1 | Cassandra 2.1.13 | CQL spec 3.2.1 | Native protocol v3]\nUse HELP for help.\ncassandra@cqlsh>\n```\n"}