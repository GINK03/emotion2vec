{"context": " More than 1 year has passed since last update.capistrano3\u3067RAILS_ENV\u3092\u6307\u5b9a\u3057\u3066rake\u3092\u5b9f\u884c\u3059\u308b\u306e\u306b\u624b\u9593\u53d6\u3063\u305f\u306e\u3067\u3001\u3053\u3053\u3067\u5171\u6709\u3057\u307e\u3059\u3002\n\n\u554f\u984c\u3000\u4e0b\u8a18\u306e\u65b9\u6cd5\u3067\u306frails_env\u304c\u547c\u3079\u306a\u3044\n\ndeploy.rb\nnamespace :deploy do\n  task :reset_db do\n    on roles(:app) do\n      execute \"cd #{deploy_to}/current && bundle exec rake db:seed RAILS_ENV=#{rails_env}\"\n    end\n  end\nend\n\n\n\u4e0a\u8a18\u306e\u65b9\u6cd5\u3060\u3068\u4e0b\u8a18\u306e\u3088\u3046\u306arails_env\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u306a\u3044\u3053\u3068\u3092\u793a\u3059\u30a8\u30e9\u30fc\u304c\u51fa\u307e\u3059\u3002\ncap aborted!\nundefined local variable or method 'rails_env' for #<SSHKit::Backend::Netssh:0x007f1cd58044b0>\n\n\n\u89e3\u6cd51\u3000fetch\u3092\u901a\u3057\u3066\u547c\u3076\n\ndeploy.rb\nnamespace :deploy do\n  task :reset_db do\n    on roles(:app) do\n      execute \"cd #{deploy_to}/current && bundle exec rake db:seed RAILS_ENV=#{fetch :rails_env}\"\n    end\n  end\nend\n\n\n\u3053\u3046\u3057\u3066\u66f8\u304f\u3068\u3001\u6587\u5b57\u5217\u5185\u3067rails_env\u3092\u547c\u3079\u307e\u3059\n\n\u89e3\u6cd52\u3000with\u3092\u4f7f\u3046\n\u4e0b\u306e\u4f8b\u3067\u306fcd #{deploy_to}/current\u3082\u7c21\u7d20\u5316\u3059\u308b\u305f\u3081\u306bwithin\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\n\ndeploy.rb\nnamespace :deploy do\n  task :reset_db do\n    on roles(:app) do\n      within release_path do\n        with rails_env: fetch(:rails_env) do\n          execute :rake, \"db:migrate:reset\"\n        end\n      end\n    end\n  end\nend\n\n\n\u3053\u3046\u3057\u3066\u66f8\u304f\u3068\u6307\u5b9a\u3057\u305fRAILS_ENV\u3067rake\u3092\u5b9f\u884c\u3067\u304d\u307e\u3059\n\u53c2\u8003\nhttp://blog.huangzhimin.com/2013/11/02/upgrade-to-capistrano3/\ncapistrano3\u3067`RAILS_ENV`\u3092\u6307\u5b9a\u3057\u3066`rake`\u3092\u5b9f\u884c\u3059\u308b\u306e\u306b\u624b\u9593\u53d6\u3063\u305f\u306e\u3067\u3001\u3053\u3053\u3067\u5171\u6709\u3057\u307e\u3059\u3002\n\n##\u554f\u984c\u3000\u4e0b\u8a18\u306e\u65b9\u6cd5\u3067\u306frails_env\u304c\u547c\u3079\u306a\u3044\n```deploy.rb\nnamespace :deploy do\n  task :reset_db do\n    on roles(:app) do\n      execute \"cd #{deploy_to}/current && bundle exec rake db:seed RAILS_ENV=#{rails_env}\"\n    end\n  end\nend\n```\n\n\u4e0a\u8a18\u306e\u65b9\u6cd5\u3060\u3068\u4e0b\u8a18\u306e\u3088\u3046\u306arails_env\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u306a\u3044\u3053\u3068\u3092\u793a\u3059\u30a8\u30e9\u30fc\u304c\u51fa\u307e\u3059\u3002\n\n```\ncap aborted!\nundefined local variable or method 'rails_env' for #<SSHKit::Backend::Netssh:0x007f1cd58044b0>\n```\n\n##\u89e3\u6cd51\u3000fetch\u3092\u901a\u3057\u3066\u547c\u3076\n\n```deploy.rb\nnamespace :deploy do\n  task :reset_db do\n    on roles(:app) do\n      execute \"cd #{deploy_to}/current && bundle exec rake db:seed RAILS_ENV=#{fetch :rails_env}\"\n    end\n  end\nend\n```\n\u3053\u3046\u3057\u3066\u66f8\u304f\u3068\u3001\u6587\u5b57\u5217\u5185\u3067`rails_env`\u3092\u547c\u3079\u307e\u3059\n\n##\u89e3\u6cd52\u3000with\u3092\u4f7f\u3046\n\u4e0b\u306e\u4f8b\u3067\u306f`cd #{deploy_to}/current`\u3082\u7c21\u7d20\u5316\u3059\u308b\u305f\u3081\u306b`within`\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\n\n```deploy.rb\nnamespace :deploy do\n  task :reset_db do\n    on roles(:app) do\n      within release_path do\n        with rails_env: fetch(:rails_env) do\n          execute :rake, \"db:migrate:reset\"\n        end\n      end\n    end\n  end\nend\n```\n\n\u3053\u3046\u3057\u3066\u66f8\u304f\u3068\u6307\u5b9a\u3057\u305f`RAILS_ENV`\u3067`rake`\u3092\u5b9f\u884c\u3067\u304d\u307e\u3059\n\n\u53c2\u8003\nhttp://blog.huangzhimin.com/2013/11/02/upgrade-to-capistrano3/\n", "tags": ["Rails3.2", "capistrano3.1", "Ruby2.0"]}