{"context": "\u6982\u8981\uff1acrond\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3067sendmail\u306e\u4ee3\u308f\u308a\u306b\u72ec\u81ea\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u30d1\u30b9\u3092\u6307\u5b9a\u3059\u308b\ncrond\u306b\u306fcronie, fcron, vixie-cron\u3068\u8272\u3005\u7a2e\u985e\u304c\u3042\u308a\u3001\u5bfe\u5fdc\u30aa\u30d7\u30b7\u30e7\u30f3\u3082\u9055\u3046\u3068\u601d\u3046\u3002\u3053\u3053\u3067\u306fcronie\u3092\u4f7f\u3063\u3066\u3044\u308b\u3082\u306e\u3068\u3059\u308b\u3002\nsendmail\u306e\u4ee3\u66ff\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\uff08url\u3092\u81ea\u5206\u306eIncoming Webhook\u306eURL\u3067\u7f6e\u304d\u63db\u3048\u308b\u3053\u3068\uff09\n\n/usr/bin/sendmail.slack\n#!/usr/bin/env ruby\n\nrequire \"json\"\nrequire \"faraday\"\n\nurl = \"***** Slack\u306eIncoming Webhook\u306eURL *****\"\n\nmessage = $stdin.read\n\npayload =\n{\n    \"channel\": \"#general\",\n    \"username\": \"sendmail.slack\",\n    \"text\": message,\n}\n\nres = Faraday.post url, JSON.generate(payload), content_type: \"application/json\"\nputs res.status\nputs res.body\n\n\nfaraday\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\ngem install faraday\n\n\u3068\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\nsystemctl edit cronie\n\n\n/etc/systemd/system/cronie.service.d/override.conf\n[Service]\n# \u2193\u65e2\u5b58\u306eExecStart=\u3092\u4e0a\u66f8\u304d\u3059\u308b\u306b\u306f\u3001\u3053\u308c\u3067\u30af\u30ea\u30a2\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\nExecStart=\nExecStart=/usr/bin/crond -n -m /usr/bin/sendmail.slack\n\n\nsystemctl daemon-reload\nsystemctl reload cronie\n\nps aux | grep crond\n\n### crond \u304c /usr/bin/crond -n -m /usr/bin/sendmail.slack \u3067\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\n\n\u4ee5\u4e0a\u3002\njournalctl -u cronie -f\u3057\u3064\u3064\u9069\u7528\u306bcron\u30b8\u30e7\u30d6\u3092\u8a2d\u5b9a\u3057\u3066\u52d5\u4f5c\u78ba\u8a8d\u3002\n\n\u8ffd\u8a18\n\u3088\u304f\u8003\u3048\u305f\u3089\u3001\u30b8\u30e7\u30d6\u306e\u6307\u5b9a\u3067\u672b\u5c3e\u306b\n2>&1 | /usr/bin/sendmail.slack\n\n\u3068\u3059\u308b\u65b9\u6cd5\u3067\u3082\u3088\u304b\u3063\u305f\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\u6982\u8981\uff1acrond\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3067sendmail\u306e\u4ee3\u308f\u308a\u306b\u72ec\u81ea\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u30d1\u30b9\u3092\u6307\u5b9a\u3059\u308b\n\ncrond\u306b\u306fcronie, fcron, vixie-cron\u3068\u8272\u3005\u7a2e\u985e\u304c\u3042\u308a\u3001\u5bfe\u5fdc\u30aa\u30d7\u30b7\u30e7\u30f3\u3082\u9055\u3046\u3068\u601d\u3046\u3002\u3053\u3053\u3067\u306fcronie\u3092\u4f7f\u3063\u3066\u3044\u308b\u3082\u306e\u3068\u3059\u308b\u3002\n\nsendmail\u306e\u4ee3\u66ff\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\uff08`url`\u3092\u81ea\u5206\u306eIncoming Webhook\u306eURL\u3067\u7f6e\u304d\u63db\u3048\u308b\u3053\u3068\uff09\n\n```/usr/bin/sendmail.slack\n#!/usr/bin/env ruby\n\nrequire \"json\"\nrequire \"faraday\"\n\nurl = \"***** Slack\u306eIncoming Webhook\u306eURL *****\"\n\nmessage = $stdin.read\n\npayload =\n{\n    \"channel\": \"#general\",\n    \"username\": \"sendmail.slack\",\n    \"text\": message,\n}\n\nres = Faraday.post url, JSON.generate(payload), content_type: \"application/json\"\nputs res.status\nputs res.body\n```\n\nfaraday\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\n\n```\ngem install faraday\n```\n\n\u3068\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\nsystemctl edit cronie\n```\n\n```/etc/systemd/system/cronie.service.d/override.conf\n[Service]\n# \u2193\u65e2\u5b58\u306eExecStart=\u3092\u4e0a\u66f8\u304d\u3059\u308b\u306b\u306f\u3001\u3053\u308c\u3067\u30af\u30ea\u30a2\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\nExecStart=\nExecStart=/usr/bin/crond -n -m /usr/bin/sendmail.slack\n```\n\n```\nsystemctl daemon-reload\nsystemctl reload cronie\n\nps aux | grep crond\n\n### crond \u304c /usr/bin/crond -n -m /usr/bin/sendmail.slack \u3067\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\n```\n\n\u4ee5\u4e0a\u3002\n\n`journalctl -u cronie -f`\u3057\u3064\u3064\u9069\u7528\u306bcron\u30b8\u30e7\u30d6\u3092\u8a2d\u5b9a\u3057\u3066\u52d5\u4f5c\u78ba\u8a8d\u3002\n\n\n## \u8ffd\u8a18\n\n\u3088\u304f\u8003\u3048\u305f\u3089\u3001\u30b8\u30e7\u30d6\u306e\u6307\u5b9a\u3067\u672b\u5c3e\u306b\n\n```\n2>&1 | /usr/bin/sendmail.slack\n```\n\n\u3068\u3059\u308b\u65b9\u6cd5\u3067\u3082\u3088\u304b\u3063\u305f\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n", "tags": ["cron", "Slack"]}