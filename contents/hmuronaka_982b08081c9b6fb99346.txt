{"context": " More than 1 year has passed since last update.\n\n\u3053\u306e\u8a18\u4e8b\u3067\u7d39\u4ecb\u3059\u308b\u3053\u3068\niOS\u30a2\u30d7\u30ea\u3067Facebook\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4ecb\u3057\u3066Cognito\u3067AWS\u3078\u30a2\u30af\u30bb\u30b9!!\n(AWS\u7d20\u4eba\u304c\u8abf\u3079\u305f\u5185\u5bb9\u306a\u306e\u3067\u8aa4\u308a\u304c\u3042\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\uff09\n\nFacebook App \u306e\u767b\u9332\nFacebook\u8a8d\u8a3c\u3092iOS\u30a2\u30d7\u30ea\u304b\u3089\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u3001\u305d\u306eiOS\u30a2\u30d7\u30ea\u3092Facebook App\u3068\u3057\u3066\u767b\u9332\u3059\u308b\u3002\n\n\u624b\u9806\n1 https://developers.facebook.com/ \u306b\u30a2\u30af\u30bb\u30b9\n2 My Apps \u304b\u3089Add a New App\u3092\u62bc\u3057\u3066\u3001AppID\u3092\u53d6\u5f97\u3059\u308b.\n\n3 Getting Started\u306e\u5185\u5bb9\u306b\u5f93\u3063\u3066\u3001iOS\u30a2\u30d7\u30ea\u304b\u3089Facebook\u306b\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002(\u624b\u9806\u306b\u5f93\u3048\u3070\u3001Facebook\u30ed\u30b0\u30a4\u30f3\u30dc\u30bf\u30f3\u307e\u3067\u7c21\u5358\u306b\u8ffd\u52a0\u3067\u304d\u308b\u306f\u305a\uff01\uff01\uff09\n\u203b\u3000\u3082\u3057\u624b\u9806\u3069\u304a\u308aInfo.plist\u306bURL schemes\u3082\u767b\u9332\u3057\u305f\u306e\u306b\u3001\u305d\u308c\u304c\u898b\u3064\u304b\u3089\u306a\u3044\uff01\uff01\u3063\u3066\u6012\u3089\u308c\u305f\u5834\u5408\u306f\u3001Info.plist\u3092\u30c6\u30ad\u30b9\u30c8\u5f62\u5f0f\u3067\u8868\u793a\u3057\u3066\u307f\u308b\u3068\u826f\u3044\u304b\u3082\u3002 FacebookAppID\u306e\u6700\u521d\u306b\u7a7a\u767d\u304c\u5165\u3063\u3066\u305f\u308a\u3059\u308b\u306e\u306b\u6c17\u3065\u3051\u308b\u304b\u3082\u3057\u308c\u306a\u3044...\n\n\nFacebookApp\u7528\u306e\u30c6\u30b9\u30c8\u30e6\u30fc\u30b6\u30fc\u306b\u3064\u3044\u3066\nFacebookApp\u306e\u30c6\u30b9\u30c8\u7528\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3059\u308b\u5834\u5408\u306f\u3001My Apps\u30da\u30fc\u30b8\u306eRoles\u304b\u3089TestUsers\u3092\u4f5c\u6210\u3067\u304d\u308b\u3002\n\n\n\u4ed6\u306eFacebook\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u8a8d\u8a3c\u3059\u308b\u306b\u306f\n\u4e00\u5ea6Facebook\u3078\u8a8d\u8a3c\u3057\u305f\u5f8c\u30ed\u30b0\u30a2\u30a6\u30c8\u3059\u308b\u3060\u3051\u3067\u306f\u3001\u4ed6\u306e\u30e6\u30fc\u30b6\u30fc\u3067\n\u8a8d\u8a3c\u3067\u304d\u306a\u3044\uff08\u8a8d\u8a3c\u6e08\u307f\u3068\u3057\u3066\u3001\u52dd\u624b\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3057\u307e\u3046\uff09\u3002\u305d\u306e\u5834\u5408\u306fFacebook\u30a2\u30d7\u30ea\u306e\u65b9\u3067\u4e00\u5ea6\u30ed\u30b0\u30a2\u30a6\u30c8\u3059\u308b\u3068\u3001\u4ed6\u306e\u30e6\u30fc\u30b6\u30fc\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\nAWS Cognito\n\nIdentity pool \u306e\u4f5c\u6210\n1  AWS Cognito\u306e\u30da\u30fc\u30b8\u306b\u30a2\u30af\u30bb\u30b9.(\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306f\u307e\u3060\u306a\u3044\uff09\n2  Create new Identity pool\u3092\u9078\u3076\n3  Identity pool name\u3092\u5165\u529b\u3059\u308b\u3002(\u30a2\u30d7\u30ea\u540d\u306a\u3069\uff09\n4  Unauthenticated identities\u3092\u6709\u52b9\u306b\u3059\u308b\u304b\u9078\u3076\u3002\uff08\u30a2\u30d7\u30ea\u304c\u672a\u8a8d\u8a3c\u306e\u30b2\u30b9\u30c8\u30e6\u30fc\u30b6\u30fc\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u306f\u6709\u52b9\u306b\u3059\u308b\u3002\u4eca\u56de\u306f\u7121\u52b9\u3002\uff09\n5  Authentication providers\u3092\u9078\u629e\u3059\u308b\u3002\u4eca\u56de\u306fFacebook\u3092\u9078\u3073\u3001FacebookApp\u306eApp ID\u3092\u5165\u529b\u3059\u308b\u3002\n\n6 \u8a8d\u8a3c\u7528\u306eIAM\u30ed\u30fc\u30eb\u3068\u672a\u8a8d\u8a3c\u7528\u306eIAM\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u3092\u8a31\u53ef\u3059\u308b\u3002\n\n\nIAM \u30ed\u30fc\u30eb \u30dd\u30ea\u30b7\u30fc\u306e\u7de8\u96c6.(\u5fc5\u8981\u3067\u3042\u308c\u3070\uff09\n1 IAM\u30da\u30fc\u30b8\u306b\u30a2\u30af\u30bb\u30b9.\n2 \u30ed\u30fc\u30eb\u3092\u9078\u629e.\n\n3 AWS Cognito Identity pool\u3067\u4f5c\u6210\u3057\u305f, XXXAuth_Role\u3092\u7de8\u96c6\u3059\u308b\u3002\n4 \u4f8b\u3048\u3070S3\u3078\u30e6\u30fc\u30b6\u30fc\u6bce\u306b\u30d5\u30a1\u30a4\u30eb\u8ffd\u52a0\u3068\u53d6\u5f97\u306e\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u3092\u51fa\u3059\u4f8b.\n\n\u524d\u63d0\nS3\u3078\u4fdd\u5b58\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u306f\u3001\u4ee5\u4e0b\u306e\u5f62\u5f0f.\nmybucket/cognito-identity/\u30d5\u30a1\u30a4\u30eb\u540d\n\u203b cognito-identity\u304c\u30e6\u30fc\u30b6\u30fc\u306eID.\n\n\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"s3:GetObject\",\n                \"s3:PutObject\"\n            ],\n            \"Resource\": [\n                \"arn:aws:s3:::mybucket/${cognito-identity.amazonaws.com:sub}\",\n                \"arn:aws:s3:::mybucket/${cognito-identity.amazonaws.com:sub}/*\"\n            ]\n        }\n    ]\n}\n\n\n\u30dd\u30ea\u30b7\u30fc\u5909\u6570\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u3001\"Version\": \"2012-10-17\"\u306f\u5fc5\u9808\u3002\n${cognito-identity.amazonaws.com:sub}\u306f\u3001cognito\u3067\u8a8d\u8a3c\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u306eID\u3092\u8868\u3059\u30dd\u30ea\u30b7\u30fc\u5909\u6570\u3002\n\n\u53c2\u8003\nAWS STS \u30a6\u30a7\u30d6 ID \u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u306b\u3064\u3044\u3066\nhttp://docs.aws.amazon.com/ja_jp/STS/latest/UsingSTS/web-identity-federation.html\n\nCognito\u3068Facebook\u30ed\u30b0\u30a4\u30f3\u306e\u9023\u643a\u4f8b\n\u624b\u9806: Facebook\u8a8d\u8a3c\u3067\u304d\u305f\u3089\u3001Cognito\u3078Facebook\u306etoken\u3092\u8a2d\u5b9a\u3057\u3066\u3001AWS\u3078\u8a8d\u8a3c\u3059\u308b.\n\nAppDelegate\n\n@implementation AppDelegate\n\n// Cognito\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3067\u306f\u3001Cognito\u306e\u8a8d\u8a3c\u3092\u304a\u3053\u306a\u3063\u3066\u3044\u308b\u3051\u3069\u3001\n// FacebookSDK\u306e\u51e6\u7406\u306e\u307f\u306b\u3059\u308b\u3002\n- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {\n    // Override point for customization after application launch.\n    return [[FBSDKApplicationDelegate sharedInstance] application:application\n                                    didFinishLaunchingWithOptions:launchOptions];\n\n}\n\n- (BOOL)application:(UIApplication *)application\n            openURL:(NSURL *)url\n  sourceApplication:(NSString *)sourceApplication\n         annotation:(id)annotation {\n    return [[FBSDKApplicationDelegate sharedInstance] application:application\n                                                          openURL:url\n                                                sourceApplication:sourceApplication\n                                                       annotation:annotation];\n}\n\n\n\nViewController(Facebook\u306e\u30ed\u30b0\u30a4\u30f3\u30dc\u30bf\u30f3\u3092\u8868\u793a\u3057\u3066\u3044\u308bController\uff09\n\u4fbf\u5b9c\u4e0aViewController\u3067Facebook\u30dc\u30bf\u30f3\u3092\u8868\u793a\u3057\u3066\u3044\u308b\u3068\u3059\u308b\u3002\n\n// \u30ed\u30b0\u30a4\u30f3/\u30ed\u30b0\u30a2\u30a6\u30c8\u7d50\u679c\u3092\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306bFBSDKLoginButtonDelegate\u3092\u8ffd\u52a0.\n@interface ViewController : <FBSDKLoginButtonDelegate>\n\n\n\u30ed\u30b0\u30a4\u30f3\u30dc\u30bf\u30f3\n\u53c2\u8003\nhttps://developers.facebook.com/docs/facebook-login/ios/v2.3\nhttps://developers.facebook.com/docs/facebook-login/permissions\n    FBSDKLoginButton *loginButton = [[FBSDKLoginButton alloc] init];\n    loginButton.center = self.view.center;\n    loginButton.readPermissions = @[@\"public_profile\", @\"email\"];\n    // delete\u8ffd\u52a0\n    loginButton.delegate = self;\n    [self.view addSubview:loginButton];\n\n\nFBSDKLoginButtonDelegate\u5b9f\u88c5\n-(void)loginButton:(FBSDKLoginButton *)loginButton didCompleteWithResult:(FBSDKLoginManagerLoginResult *)result error:(NSError *)error {\n  if( !error ) {\n    if( !result.isCancelled ) {\n        [self authorizeAWS];\n    }\n  }\n}\n\n-(void)authorizeAWS {\n     NSDictionary* logins = @{@\"graph.facebook.com\": [FBSDKAccessToken currentAccessToken].tokenString};\n\n    // AWS Cognito\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9.\n\n    AWSCognitoCredentialsProvider* credentialProvider =\n        [[AWSCognitoCredentialsProvider alloc] initWithRegionType:CognitoRegionType /* Cognito\u306e\u30ea\u30fc\u30b8\u30e7\u30f3 */\n    identityPoolId:CognitoIdentityPoolId /* Cognito\u306eIdentityPoolId */];\n\n    // \u3053\u3053\u3067Facebook\u306e\u30ed\u30b0\u30a4\u30f3\u60c5\u5831\u3092\u8a2d\u5b9a.\n    credentialProvider.logins = logins;\n\n    AWSServiceConfiguration* configuration =\n    [[AWSServiceConfiguration alloc] initWithRegion:DefaultServiceRegionType /* S3\u306a\u3069\u30b5\u30fc\u30d3\u30b9\u306e\u3042\u308b\u30ea\u30fc\u30b8\u30e7\u30f3 */ credentialsProvider:credentialProvider];\n    [AWSServiceManager defaultServiceManager].defaultServiceConfiguration = configuration;\n\n    self.credentialProvider = credentialProvider;\n\n\n\n\nCognito\u3067\u8a8d\u8a3c\u3057\u305f\u30e6\u30fc\u30b6\u30fcID\u306e\u53d6\u5f97.\nAWSCognitoCredentialsProvider::credentialProvider.getIdentityId \u3067\u53d6\u5f97\u3067\u304d\u308b\u304c\u3001 \u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3057\u306a\u3044\u3068nil\u304c\u8fd4\u3063\u3066\u304f\u308b\u3002\n\u203b\u3000\u9069\u5207\u306a\u633f\u5165\u7b87\u6240\u306f\u672a\u8abf\u67fb\u306a\u306e\u3067\u3001\u3068\u308a\u3042\u3048\u305a\u3001\u4e0a\u306eauthorizedAWS\u30e1\u30bd\u30c3\u30c9\u306e\u76f4\u5f8c\u306b\u5b9f\u884c\u3057\u3066\u307e\u3059\u3002\nstackoverflow\nhttp://stackoverflow.com/questions/25245236/aws-cognito-identity-null\n    // Cognito\u306e\u30e6\u30fc\u30b6\u30fc\u6bce\u306eID\u3092    \n    [[credentialProvider getIdentityId] continueWithBlock:^id(BFTask *task){\n\n        if (task.error == nil)\n        {\n            NSString* cognitoId = credentialProvider.identityId;\n            NSLog(@\"cognitoId: %@\", cognitoId);\n        }\n        else\n        {\n            NSLog(@\"Error : %@\", task.error);\n        }\n\n        return nil;\n    }];\n}\n\n\n\nViewController\u521d\u671f\u5316\u6642\n\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    // \u8868\u793a\u6642\u306b\u3059\u3067\u306b\u8a8d\u8a3c\u6e08\u307f\u306a\u3089\u3001\u81ea\u52d5\u7684\u306bAWS\u30d8\u30ed\u30b0\u30a4\u30f3\n    if( [FBSDKAccessToken currentAccessToken] ) {\n        [self authorizeAWS];\n    }\n}\n\n\n\u4ee5\u4e0a\u3067\u3001Facebook\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4ecb\u3057\u3066AWS\u3078\u30a2\u30af\u30bb\u30b9\u304c\u3067\u304d\u308b\u3002(\u9593\u9055\u3044\u304c\u3042\u308b\u53ef\u80fd\u6027\u306f\u5341\u5206\u3042\u308a\u307e\u3059\u3002\u6c17\u306b\u306a\u308b\u70b9\u304c\u3042\u308c\u3070\u6307\u6458\u304f\u3060\u3055\u3044.\uff09\n\n\u304a\u307e\u3051 Facebook\u304b\u3089\u30ed\u30b0\u30a2\u30a6\u30c8\nFacebook\u30ed\u30b0\u30a4\u30f3\u3068\u540c\u3058\u51e6\u7406\u3067\u3001\u30ed\u30b0\u30a2\u30a6\u30c8\u30dc\u30bf\u30f3\u3092\u8868\u793a\u3067\u304d\u308b\u3002\n    FBSDKLoginButton *loginButton = [[FBSDKLoginButton alloc] init];\n    loginButton.center = self.view.center;\n    loginButton.readPermissions = @[@\"public_profile\", @\"email\"];\n    loginButton.delegate = self;\n    [self.view addSubview:loginButton];\n\n\n-(void)loginButtonDidLogOut:(FBSDKLoginButton *)loginButton {\n    NSLog(@\"logout facebook result.\");\n    [self.tableView reloadData];\n    [loginButton removeFromSuperview];\n\n    [self logoutAws];\n}\n\n-(void)logout {\n    [self.credentialProvider clearCredentials];\n    self.credentialProvider = nil;\n}\n\n\n\n\u304a\u307e\u3051 Facebook profile\uff08\u30e6\u30fc\u30b6\u30fc\u540d\u306a\u3069\uff09\u306e\u53d6\u5f97.\nFacebook\u8a8d\u8a3c\u306b\u6210\u529f\u3057\u305f\u5f8c\u3001\u9045\u308c\u3066profile\u304c\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306a\u306e\u3067\u3001NSNotificationCenter\u3067Profile\u5909\u5316\u3092\u53d7\u4fe1\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    [FBSDKProfile enableUpdatesOnAccessTokenChange:YES];\n\n    if(  [FBSDKAccessToken currentAccessToken] ) {\n        [self authorizeAWS];\n    }\n\n    NSNotificationCenter* center = [NSNotificationCenter defaultCenter];\n    [center addObserver:self selector:@selector(fbSDKProfileDidChangeNotification:) name:FBSDKProfileDidChangeNotification object:nil];\n}\n\n\n-(void)fbSDKProfileDidChangeNotification:(NSNotificationCenter*)center {\n    NSLog(@\"something change...%@\", [FBSDKProfile currentProfile]);\n}\n\n\n\u53c2\u8003\nCognito\u3067\u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c:http://docs.aws.amazon.com/cognito/devguide/identity/?platform=ios\nAWS STS \u30a6\u30a7\u30d6 ID \u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u306b\u3064\u3044\u3066:\nhttp://docs.aws.amazon.com/ja_jp/STS/latest/UsingSTS/web-identity-federation.html\n\n# \u3053\u306e\u8a18\u4e8b\u3067\u7d39\u4ecb\u3059\u308b\u3053\u3068\n\niOS\u30a2\u30d7\u30ea\u3067Facebook\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4ecb\u3057\u3066Cognito\u3067AWS\u3078\u30a2\u30af\u30bb\u30b9!!\n(AWS\u7d20\u4eba\u304c\u8abf\u3079\u305f\u5185\u5bb9\u306a\u306e\u3067\u8aa4\u308a\u304c\u3042\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\uff09\n\n# Facebook App \u306e\u767b\u9332\n\nFacebook\u8a8d\u8a3c\u3092iOS\u30a2\u30d7\u30ea\u304b\u3089\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u3001\u305d\u306eiOS\u30a2\u30d7\u30ea\u3092Facebook App\u3068\u3057\u3066\u767b\u9332\u3059\u308b\u3002\n\n## \u624b\u9806\n\n1 https://developers.facebook.com/ \u306b\u30a2\u30af\u30bb\u30b9\n2 My Apps \u304b\u3089Add a New App\u3092\u62bc\u3057\u3066\u3001AppID\u3092\u53d6\u5f97\u3059\u308b.\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-05-22 17.56.13.png](https://qiita-image-store.s3.amazonaws.com/2116/37443/ea6cdddd-e96e-4b4e-1ca1-8466e1bb2766.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-05-22 17.56.13.png\")\n\n\n3 Getting Started\u306e\u5185\u5bb9\u306b\u5f93\u3063\u3066\u3001iOS\u30a2\u30d7\u30ea\u304b\u3089Facebook\u306b\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002(\u624b\u9806\u306b\u5f93\u3048\u3070\u3001Facebook\u30ed\u30b0\u30a4\u30f3\u30dc\u30bf\u30f3\u307e\u3067\u7c21\u5358\u306b\u8ffd\u52a0\u3067\u304d\u308b\u306f\u305a\uff01\uff01\uff09\n\n\u203b\u3000\u3082\u3057\u624b\u9806\u3069\u304a\u308aInfo.plist\u306bURL schemes\u3082\u767b\u9332\u3057\u305f\u306e\u306b\u3001\u305d\u308c\u304c\u898b\u3064\u304b\u3089\u306a\u3044\uff01\uff01\u3063\u3066\u6012\u3089\u308c\u305f\u5834\u5408\u306f\u3001Info.plist\u3092\u30c6\u30ad\u30b9\u30c8\u5f62\u5f0f\u3067\u8868\u793a\u3057\u3066\u307f\u308b\u3068\u826f\u3044\u304b\u3082\u3002 FacebookAppID\u306e\u6700\u521d\u306b\u7a7a\u767d\u304c\u5165\u3063\u3066\u305f\u308a\u3059\u308b\u306e\u306b\u6c17\u3065\u3051\u308b\u304b\u3082\u3057\u308c\u306a\u3044...\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-05-22 18.53.43.png](https://qiita-image-store.s3.amazonaws.com/2116/37443/f4392e23-f007-4fa4-267e-da4f88a85eca.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-05-22 18.53.43.png\")\n\n\n## FacebookApp\u7528\u306e\u30c6\u30b9\u30c8\u30e6\u30fc\u30b6\u30fc\u306b\u3064\u3044\u3066\nFacebookApp\u306e\u30c6\u30b9\u30c8\u7528\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3059\u308b\u5834\u5408\u306f\u3001My Apps\u30da\u30fc\u30b8\u306eRoles\u304b\u3089TestUsers\u3092\u4f5c\u6210\u3067\u304d\u308b\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-05-22 17.57.49.png](https://qiita-image-store.s3.amazonaws.com/2116/37443/07b1b0f9-9579-37a8-8f75-31af46eae402.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-05-22 17.57.49.png\")\n\n\n\n\n## \u4ed6\u306eFacebook\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u8a8d\u8a3c\u3059\u308b\u306b\u306f\n\n\u4e00\u5ea6Facebook\u3078\u8a8d\u8a3c\u3057\u305f\u5f8c\u30ed\u30b0\u30a2\u30a6\u30c8\u3059\u308b\u3060\u3051\u3067\u306f\u3001\u4ed6\u306e\u30e6\u30fc\u30b6\u30fc\u3067\n\u8a8d\u8a3c\u3067\u304d\u306a\u3044\uff08\u8a8d\u8a3c\u6e08\u307f\u3068\u3057\u3066\u3001\u52dd\u624b\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3057\u307e\u3046\uff09\u3002\u305d\u306e\u5834\u5408\u306fFacebook\u30a2\u30d7\u30ea\u306e\u65b9\u3067\u4e00\u5ea6\u30ed\u30b0\u30a2\u30a6\u30c8\u3059\u308b\u3068\u3001\u4ed6\u306e\u30e6\u30fc\u30b6\u30fc\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n# AWS Cognito\n\n## Identity pool \u306e\u4f5c\u6210\n\n1  AWS Cognito\u306e\u30da\u30fc\u30b8\u306b\u30a2\u30af\u30bb\u30b9.(\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306f\u307e\u3060\u306a\u3044\uff09\n2  Create new Identity pool\u3092\u9078\u3076\n3  Identity pool name\u3092\u5165\u529b\u3059\u308b\u3002(\u30a2\u30d7\u30ea\u540d\u306a\u3069\uff09\n4  Unauthenticated identities\u3092\u6709\u52b9\u306b\u3059\u308b\u304b\u9078\u3076\u3002\uff08\u30a2\u30d7\u30ea\u304c\u672a\u8a8d\u8a3c\u306e\u30b2\u30b9\u30c8\u30e6\u30fc\u30b6\u30fc\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u306f\u6709\u52b9\u306b\u3059\u308b\u3002\u4eca\u56de\u306f\u7121\u52b9\u3002\uff09\n5  Authentication providers\u3092\u9078\u629e\u3059\u308b\u3002\u4eca\u56de\u306fFacebook\u3092\u9078\u3073\u3001FacebookApp\u306eApp ID\u3092\u5165\u529b\u3059\u308b\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-05-22 18.00.02.png](https://qiita-image-store.s3.amazonaws.com/2116/37443/73c8e104-2f02-0dc8-d98f-bb5b767699c3.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-05-22 18.00.02.png\")\n\n6 \b\u8a8d\u8a3c\u7528\u306eIAM\u30ed\u30fc\u30eb\u3068\u672a\u8a8d\u8a3c\u7528\u306eIAM\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u3092\u8a31\u53ef\u3059\u308b\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-05-22 18.04.10.png](https://qiita-image-store.s3.amazonaws.com/2116/37443/377b8029-3e3d-1a29-d46f-241f3273b1cd.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-05-22 18.04.10.png\")\n\n\n## IAM \u30ed\u30fc\u30eb \u30dd\u30ea\u30b7\u30fc\u306e\u7de8\u96c6.(\u5fc5\u8981\u3067\u3042\u308c\u3070\uff09\n\n1 IAM\u30da\u30fc\u30b8\u306b\u30a2\u30af\u30bb\u30b9.\n2 \u30ed\u30fc\u30eb\u3092\u9078\u629e.\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-05-22 18.06.19.png](https://qiita-image-store.s3.amazonaws.com/2116/37443/daadab0f-6232-523f-4f2f-35c748f19a59.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-05-22 18.06.19.png\")\n\n3 AWS Cognito Identity pool\u3067\u4f5c\u6210\u3057\u305f, __XXX__Auth_Role\u3092\u7de8\u96c6\u3059\u308b\u3002\n\n4 \u4f8b\u3048\u3070S3\u3078\u30e6\u30fc\u30b6\u30fc\u6bce\u306b\u30d5\u30a1\u30a4\u30eb\u8ffd\u52a0\u3068\u53d6\u5f97\u306e\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u3092\u51fa\u3059\u4f8b.\n\n> \u524d\u63d0\n> S3\u3078\u4fdd\u5b58\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u306f\u3001\u4ee5\u4e0b\u306e\u5f62\u5f0f.\n> mybucket/cognito-identity/\u30d5\u30a1\u30a4\u30eb\u540d\n> \u203b cognito-identity\u304c\u30e6\u30fc\u30b6\u30fc\u306eID.\n\n```json\n\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"s3:GetObject\",\n                \"s3:PutObject\"\n            ],\n            \"Resource\": [\n                \"arn:aws:s3:::mybucket/${cognito-identity.amazonaws.com:sub}\",\n                \"arn:aws:s3:::mybucket/${cognito-identity.amazonaws.com:sub}/*\"\n            ]\n        }\n    ]\n}\n```\n\n- \u30dd\u30ea\u30b7\u30fc\u5909\u6570\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u3001\"Version\": \"2012-10-17\"\u306f\u5fc5\u9808\u3002\n- ${cognito-identity.amazonaws.com:sub}\u306f\u3001cognito\u3067\u8a8d\u8a3c\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u306eID\u3092\u8868\u3059\u30dd\u30ea\u30b7\u30fc\u5909\u6570\u3002\n\n\u53c2\u8003\n\nAWS STS \u30a6\u30a7\u30d6 ID \u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u306b\u3064\u3044\u3066\nhttp://docs.aws.amazon.com/ja_jp/STS/latest/UsingSTS/web-identity-federation.html\n\n## Cognito\u3068Facebook\u30ed\u30b0\u30a4\u30f3\u306e\u9023\u643a\u4f8b\n\n\b\u624b\u9806: Facebook\u8a8d\u8a3c\u3067\u304d\u305f\u3089\u3001Cognito\u3078Facebook\u306etoken\u3092\u8a2d\u5b9a\u3057\u3066\u3001AWS\u3078\u8a8d\u8a3c\u3059\u308b.\n\n### AppDelegate\n\n```Objc\n\n@implementation AppDelegate\n\n// Cognito\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3067\u306f\u3001Cognito\u306e\u8a8d\u8a3c\u3092\u304a\u3053\u306a\u3063\u3066\u3044\u308b\u3051\u3069\u3001\n// FacebookSDK\u306e\u51e6\u7406\u306e\u307f\u306b\u3059\u308b\u3002\n- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {\n    // Override point for customization after application launch.\n    return [[FBSDKApplicationDelegate sharedInstance] application:application\n                                    didFinishLaunchingWithOptions:launchOptions];\n    \n}\n\n- (BOOL)application:(UIApplication *)application\n            openURL:(NSURL *)url\n  sourceApplication:(NSString *)sourceApplication\n         annotation:(id)annotation {\n    return [[FBSDKApplicationDelegate sharedInstance] application:application\n                                                          openURL:url\n                                                sourceApplication:sourceApplication\n                                                       annotation:annotation];\n}\n\n```\n\n### ViewController(Facebook\u306e\u30ed\u30b0\u30a4\u30f3\u30dc\u30bf\u30f3\u3092\u8868\u793a\u3057\u3066\u3044\u308bController\uff09\n\n\u4fbf\u5b9c\b\u4e0aViewController\u3067Facebook\u30dc\u30bf\u30f3\u3092\u8868\u793a\u3057\u3066\u3044\u308b\u3068\u3059\u308b\u3002\n\n```Objc\n\n// \u30ed\u30b0\u30a4\u30f3/\u30ed\u30b0\u30a2\u30a6\u30c8\u7d50\u679c\u3092\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306bFBSDKLoginButtonDelegate\u3092\u8ffd\u52a0.\n@interface ViewController : <FBSDKLoginButtonDelegate>\n```\n\n### \u30ed\u30b0\u30a4\u30f3\u30dc\u30bf\u30f3\n\n\u53c2\u8003\nhttps://developers.facebook.com/docs/facebook-login/ios/v2.3\nhttps://developers.facebook.com/docs/facebook-login/permissions\n\n```objc\n    FBSDKLoginButton *loginButton = [[FBSDKLoginButton alloc] init];\n    loginButton.center = self.view.center;\n    loginButton.readPermissions = @[@\"public_profile\", @\"email\"];\n    // delete\u8ffd\u52a0\n    loginButton.delegate = self;\n    [self.view addSubview:loginButton];\n```\n\n### FBSDKLoginButtonDelegate\u5b9f\u88c5\n\n```Objc\n-(void)loginButton:(FBSDKLoginButton *)loginButton didCompleteWithResult:(FBSDKLoginManagerLoginResult *)result error:(NSError *)error {\n  if( !error ) {\n    if( !result.isCancelled ) {\n        [self authorizeAWS];\n    }\n  }\n}\n```\n\n```Objc\n-(void)authorizeAWS {\n     NSDictionary* logins = @{@\"graph.facebook.com\": [FBSDKAccessToken currentAccessToken].tokenString};\n\n    // AWS Cognito\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9.\n   \n    AWSCognitoCredentialsProvider* credentialProvider =\n        [[AWSCognitoCredentialsProvider alloc] initWithRegionType:CognitoRegionType /* Cognito\u306e\u30ea\u30fc\u30b8\u30e7\u30f3 */\n    identityPoolId:CognitoIdentityPoolId /* Cognito\u306eIdentityPoolId */];\n    \n    // \u3053\u3053\u3067Facebook\u306e\u30ed\u30b0\u30a4\u30f3\u60c5\u5831\u3092\u8a2d\u5b9a.\n    credentialProvider.logins = logins;\n    \n    AWSServiceConfiguration* configuration =\n    [[AWSServiceConfiguration alloc] initWithRegion:DefaultServiceRegionType /* S3\u306a\u3069\u30b5\u30fc\u30d3\u30b9\u306e\u3042\u308b\u30ea\u30fc\u30b8\u30e7\u30f3 */ credentialsProvider:credentialProvider];\n    [AWSServiceManager defaultServiceManager].defaultServiceConfiguration = configuration;\n    \n    self.credentialProvider = credentialProvider;\n\n\n```\n\n### Cognito\u3067\u8a8d\u8a3c\u3057\u305f\u30e6\u30fc\u30b6\u30fcID\u306e\u53d6\u5f97.\n\nAWSCognitoCredentialsProvider::credentialProvider.getIdentityId \u3067\u53d6\u5f97\u3067\u304d\u308b\u304c\u3001 \u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3057\u306a\u3044\u3068nil\u304c\u8fd4\u3063\u3066\u304f\u308b\u3002\n\n\u203b\u3000\u9069\u5207\u306a\u633f\u5165\u7b87\u6240\u306f\u672a\u8abf\u67fb\u306a\u306e\u3067\u3001\u3068\u308a\u3042\u3048\u305a\u3001\u4e0a\u306eauthorizedAWS\u30e1\u30bd\u30c3\u30c9\u306e\u76f4\u5f8c\u306b\u5b9f\u884c\u3057\u3066\u307e\u3059\u3002\n\nstackoverflow\nhttp://stackoverflow.com/questions/25245236/aws-cognito-identity-null\n\n\n```Objc\n    // Cognito\u306e\u30e6\u30fc\u30b6\u30fc\u6bce\u306eID\u3092    \n    [[credentialProvider getIdentityId] continueWithBlock:^id(BFTask *task){\n        \n        if (task.error == nil)\n        {\n            NSString* cognitoId = credentialProvider.identityId;\n            NSLog(@\"cognitoId: %@\", cognitoId);\n        }\n        else\n        {\n            NSLog(@\"Error : %@\", task.error);\n        }\n        \n        return nil;\n    }];\n}\n\n```\n\n\n### ViewController\u521d\u671f\u5316\u6642\n\n```Objc\n\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n\t// \u8868\u793a\u6642\u306b\u3059\u3067\u306b\u8a8d\u8a3c\u6e08\u307f\u306a\u3089\u3001\u81ea\u52d5\u7684\u306bAWS\u30d8\u30ed\u30b0\u30a4\u30f3\n    if( [FBSDKAccessToken currentAccessToken] ) {\n        [self authorizeAWS];\n    }\n}\n```\n\n----\n\n\u4ee5\u4e0a\u3067\u3001Facebook\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4ecb\u3057\u3066AWS\u3078\u30a2\u30af\u30bb\u30b9\u304c\u3067\u304d\u308b\u3002(\u9593\u9055\u3044\u304c\u3042\u308b\u53ef\u80fd\u6027\u306f\u5341\u5206\u3042\u308a\u307e\u3059\u3002\u6c17\u306b\u306a\u308b\u70b9\u304c\u3042\u308c\u3070\u6307\u6458\u304f\u3060\u3055\u3044.\uff09\n\n### \u304a\u307e\u3051 Facebook\u304b\u3089\u30ed\u30b0\u30a2\u30a6\u30c8\n\n Facebook\u30ed\u30b0\u30a4\u30f3\u3068\u540c\u3058\u51e6\u7406\u3067\u3001\u30ed\u30b0\u30a2\u30a6\u30c8\u30dc\u30bf\u30f3\u3092\u8868\u793a\u3067\u304d\u308b\u3002\n\n```Objc\n    FBSDKLoginButton *loginButton = [[FBSDKLoginButton alloc] init];\n    loginButton.center = self.view.center;\n    loginButton.readPermissions = @[@\"public_profile\", @\"email\"];\n    loginButton.delegate = self;\n    [self.view addSubview:loginButton];\n\n```\n\n```Objc\n-(void)loginButtonDidLogOut:(FBSDKLoginButton *)loginButton {\n    NSLog(@\"logout facebook result.\");\n    [self.tableView reloadData];\n    [loginButton removeFromSuperview];\n    \n    [self logoutAws];\n}\n\n-(void)logout {\n    [self.credentialProvider clearCredentials];\n    self.credentialProvider = nil;\n}\n\n```\n\n\n### \u304a\u307e\u3051 Facebook profile\uff08\u30e6\u30fc\u30b6\u30fc\u540d\u306a\u3069\uff09\u306e\u53d6\u5f97.\n\nFacebook\u8a8d\u8a3c\u306b\u6210\u529f\u3057\u305f\u5f8c\u3001\u9045\u308c\u3066profile\u304c\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306a\u306e\u3067\u3001NSNotificationCenter\u3067Profile\u5909\u5316\u3092\u53d7\u4fe1\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n```Objc\n\n\n- (void)viewDidLoad {\n    [super viewDidLoad];\n    \n    [FBSDKProfile enableUpdatesOnAccessTokenChange:YES];\n    \n    if(  [FBSDKAccessToken currentAccessToken] ) {\n        [self authorizeAWS];\n    }\n        \n    NSNotificationCenter* center = [NSNotificationCenter defaultCenter];\n    [center addObserver:self selector:@selector(fbSDKProfileDidChangeNotification:) name:FBSDKProfileDidChangeNotification object:nil];\n}\n\n\n-(void)fbSDKProfileDidChangeNotification:(NSNotificationCenter*)center {\n    NSLog(@\"something change...%@\", [FBSDKProfile currentProfile]);\n}\n```\n\n# \u53c2\u8003\n\nCognito\u3067\u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c:http://docs.aws.amazon.com/cognito/devguide/identity/?platform=ios\n\nAWS STS \u30a6\u30a7\u30d6 ID \u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u306b\u3064\u3044\u3066:\nhttp://docs.aws.amazon.com/ja_jp/STS/latest/UsingSTS/web-identity-federation.html\n", "tags": ["iOS", "AWS", "cognito", "S3", "Facebook"]}