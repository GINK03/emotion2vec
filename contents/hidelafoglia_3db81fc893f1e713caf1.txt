{"context": " More than 1 year has passed since last update.\n\nMQTT \u30b3\u30c8\u30cf\u30b8\u30e1 \u306e\u5199\u7d4c\n\n\nrabbitmq-server Debian Jessie Install\nvagrant@10:~$ sudo apt-get install rabbitmq-server\nReading package lists... Done\nBuilding dependency tree       \nReading state information... Done\nThe following extra packages will be installed:\n  erlang-asn1 erlang-base erlang-corba erlang-crypto erlang-diameter erlang-edoc erlang-eldap\n  erlang-erl-docgen erlang-eunit erlang-ic erlang-inets erlang-mnesia erlang-nox erlang-odbc erlang-os-mon\n  erlang-parsetools erlang-percept erlang-public-key erlang-runtime-tools erlang-snmp erlang-ssh erlang-ssl\n  erlang-syntax-tools erlang-tools erlang-webtool erlang-xmerl libodbc1 libsctp1 libsystemd0 lksctp-tools\nSuggested packages:\n  erlang erlang-manpages erlang-doc xsltproc fop erlang-ic-java erlang-observer libmyodbc odbc-postgresql\n  tdsodbc unixodbc-bin\nThe following NEW packages will be installed:\n  erlang-asn1 erlang-base erlang-corba erlang-crypto erlang-diameter erlang-edoc erlang-eldap\n  erlang-erl-docgen erlang-eunit erlang-ic erlang-inets erlang-mnesia erlang-nox erlang-odbc erlang-os-mon\n  erlang-parsetools erlang-percept erlang-public-key erlang-runtime-tools erlang-snmp erlang-ssh erlang-ssl\n  erlang-syntax-tools erlang-tools erlang-webtool erlang-xmerl libodbc1 libsctp1 libsystemd0 lksctp-tools\n  rabbitmq-server\n0 upgraded, 31 newly installed, 0 to remove and 290 not upgraded.\nNeed to get 24.0 MB of archives.\nAfter this operation, 39.6 MB of additional disk space will be used.\nDo you want to continue? [Y/n] \n\nAdding group `rabbitmq' (GID 111) ...\nDone.\nAdding system user `rabbitmq' (UID 106) ...\nAdding new user `rabbitmq' (UID 106) with group `rabbitmq' ...\nNot creating home directory `/var/lib/rabbitmq'.\nJob for rabbitmq-server.service failed. See 'systemctl status rabbitmq-server.service' and 'journalctl -xn' for details.\ninvoke-rc.d: initscript rabbitmq-server, action \"start\" failed.\ndpkg: error processing package rabbitmq-server (--configure):\n subprocess installed post-installation script returned error exit status 1\nProcessing triggers for libc-bin (2.19-7) ...\nErrors were encountered while processing:\n rabbitmq-server\nE: Sub-process /usr/bin/dpkg returned an error code (1)\n\n\nDebian Hostname \u5909\u66f4\nvagrant@10:~$ hostname\n10\n\nvagrant@10:~$ sudo hostname js1\nvagrant@10:~$ hostname\njs1\n\nvagrant@10:~$ sudo vim /etc/hosts\n\n\n127.0.1.1       js1   \n\nvagrant@10:~$ sudo vim /etc/hostname\n\njs1\n\nvagrant@10:~$ sudo /etc/init.d/hostname.sh restart\n\n\nrabbitmq restart\nvagrant@10:~$ sudo /etc/init.d/rabbitmq-server start\nStarting rabbitmq-server (via systemctl): rabbitmq-server.service.\n\n\nmqtt plugin\n\nvagrant@10:~$ sudo rabbitmq-plugins enable rabbitmq_mqtt\nThe following plugins have been enabled:\n  amqp_client\n  rabbitmq_mqtt\nPlugin configuration has changed. Restart RabbitMQ for changes to take effect.\nvagrant@10:~$ sudo /etc/init.d/rabbitmq-server start\nStarting rabbitmq-server (via systemctl): rabbitmq-server.service.\n\n\nmanagement plugin\nroot@js1:~# rabbitmq-plugins enable rabbitmq_management\nThe following plugins have been enabled:\n  mochiweb\n  webmachine\n  rabbitmq_web_dispatch\n  rabbitmq_management_agent\n  rabbitmq_management\nPlugin configuration has changed. Restart RabbitMQ for changes to take effect.\n\n\n/etc/rabbitmq/rabbitmq.config\n\n3.3 \u306f guest/guest\u306f \u30ed\u30fc\u30ab\u30eb\u30db\u30b9\u30c8\u304b\u3089\u306e\u307f\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\n\nroot@js1:~# zcat /usr/share/doc/rabbitmq-server/rabbitmq.config.example.gz  | sudo tee -a /etc/rabbitmq/rabbitmq.config\n\n\n\u7de8\u96c6:  erlang\u306e\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8(%%)\u3001\u30ea\u30b9\u30c8\u306e\u6700\u5f8c\u306e\u30a2\u30a4\u30c6\u30e0\u306f \",\"\u3067\u7d42\u308f\u308c\u306a\u3044\u307f\u305f\u3044\u306a\u306e\u3067\u6ce8\u610f\u3002\n\nroot@js1:~# vi /etc/rabbitmq/rabbitmq.config \n\n{loopback_users, []}         %%, \n\n\n\u518d\u8d77\u52d5\n\nroot@js1:~# sudo /etc/init.d/rabbitmq-server restart\nRestarting rabbitmq-server (via systemctl): rabbitmq-server.service.\n\n\nmqtt \u8a2d\u5b9a\n\n\u3053\u3061\u3089\nplugin\u6709\u52b9\u306b\u3057\u305f\u6642\u70b9\u3067\u52d5\u3044\u3066\u3044\u308b\u3068\u601d\u308f\u308c\n\n[{rabbit,        [{tcp_listeners,    [5672]}]},\n {rabbitmq_mqtt, [{default_user,     <<\"guest\">>},\n                  {default_pass,     <<\"guest\">>},\n                  {allow_anonymous,  true},\n                  {vhost,            <<\"/\">>},\n                  {exchange,         <<\"amq.topic\">>},\n                  {subscription_ttl, 1800000},\n                  {prefetch,         10},\n                  {ssl_listeners,    []},\n                  %% Default MQTT with TLS port is 8883\n                  %% {ssl_listeners,    [8883]}\n                  {tcp_listeners,    [1883]},\n                  {tcp_listen_options, [binary,\n                                        {packet,    raw},\n                                        {reuseaddr, true},\n                                        {backlog,   128},\n                                        {nodelay,   true}]}]}\n].\n\nroot@js1:~# lsof -i:1883\nCOMMAND  PID     USER   FD   TYPE DEVICE SIZE/OFF NODE NAME\nbeam    5651 rabbitmq   15u  IPv6  25954      0t0  TCP *:1883 (LISTEN)\n\n\n\u52d5\u4f5c\u78ba\u8a8d: paho-mqtt\n(sandbox)Peeko:messaging hide$ pip install paho-mqtt\nDownloading/unpacking paho-mqtt\n  Downloading paho-mqtt-1.0.tar.gz (40Kb): 40Kb downloaded\n  Running setup.py egg_info for package paho-mqtt\n\nInstalling collected packages: paho-mqtt\n  Running setup.py install for paho-mqtt\n\nSuccessfully installed paho-mqtt\nCleaning up...\n\n\npublisher/subscriber\n\n\nMQTT \u30b3\u30c8\u30cf\u30b8\u30e1\u306epaho\u306e\u30b3\u30fc\u30c9\u3067\u52d5\u3044\u305f\n\n(sandbox)Peeko:messaging hide$ for i in $(seq 1 10); do python paho_pub.py ;done\n\n(sandbox)Peeko:messaging hide$ python paho_sub.py \nrc: 0\nSubscribed: 1 (0,)\nSubscribed: 2 (0,)\n\nmy/topic/string 0 Hello Mon Oct 20 00:17:05 2014\nmy/topic/string 0 Hello Mon Oct 20 00:17:05 2014\nmy/topic/string 0 Hello Mon Oct 20 00:17:05 2014\nmy/topic/string 0 Hello Mon Oct 20 00:17:05 2014\nmy/topic/string 0 Hello Mon Oct 20 00:17:05 2014\nmy/topic/string 0 Hello Mon Oct 20 00:17:05 2014\nmy/topic/string 0 Hello Mon Oct 20 00:17:05 2014\nmy/topic/string 0 Hello Mon Oct 20 00:17:05 2014\nmy/topic/string 0 Hello Mon Oct 20 00:17:05 2014\nmy/topic/string 0 Hello Mon Oct 20 00:17:05 2014\n\n\namq.topic Exchange\n\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30ad\u30fc : my.topic.string\n\n\n\nRabbitMQ\u306e\u30de\u30cd\u30fc\u30b8\u30e3\u304b\u3089\u9001\u4fe1\n\nmy/topic/string 0 \u307b\u3052\u307b\u3052\n\n\n- [MQTT \u30b3\u30c8\u30cf\u30b8\u30e1](https://gist.github.com/voluntas/8238751) \u306e\u5199\u7d4c\n\n# rabbitmq-server Debian Jessie Install\n\n~~~\nvagrant@10:~$ sudo apt-get install rabbitmq-server\nReading package lists... Done\nBuilding dependency tree       \nReading state information... Done\nThe following extra packages will be installed:\n  erlang-asn1 erlang-base erlang-corba erlang-crypto erlang-diameter erlang-edoc erlang-eldap\n  erlang-erl-docgen erlang-eunit erlang-ic erlang-inets erlang-mnesia erlang-nox erlang-odbc erlang-os-mon\n  erlang-parsetools erlang-percept erlang-public-key erlang-runtime-tools erlang-snmp erlang-ssh erlang-ssl\n  erlang-syntax-tools erlang-tools erlang-webtool erlang-xmerl libodbc1 libsctp1 libsystemd0 lksctp-tools\nSuggested packages:\n  erlang erlang-manpages erlang-doc xsltproc fop erlang-ic-java erlang-observer libmyodbc odbc-postgresql\n  tdsodbc unixodbc-bin\nThe following NEW packages will be installed:\n  erlang-asn1 erlang-base erlang-corba erlang-crypto erlang-diameter erlang-edoc erlang-eldap\n  erlang-erl-docgen erlang-eunit erlang-ic erlang-inets erlang-mnesia erlang-nox erlang-odbc erlang-os-mon\n  erlang-parsetools erlang-percept erlang-public-key erlang-runtime-tools erlang-snmp erlang-ssh erlang-ssl\n  erlang-syntax-tools erlang-tools erlang-webtool erlang-xmerl libodbc1 libsctp1 libsystemd0 lksctp-tools\n  rabbitmq-server\n0 upgraded, 31 newly installed, 0 to remove and 290 not upgraded.\nNeed to get 24.0 MB of archives.\nAfter this operation, 39.6 MB of additional disk space will be used.\nDo you want to continue? [Y/n] \n~~~\n\n~~~\nAdding group `rabbitmq' (GID 111) ...\nDone.\nAdding system user `rabbitmq' (UID 106) ...\nAdding new user `rabbitmq' (UID 106) with group `rabbitmq' ...\nNot creating home directory `/var/lib/rabbitmq'.\nJob for rabbitmq-server.service failed. See 'systemctl status rabbitmq-server.service' and 'journalctl -xn' for details.\ninvoke-rc.d: initscript rabbitmq-server, action \"start\" failed.\ndpkg: error processing package rabbitmq-server (--configure):\n subprocess installed post-installation script returned error exit status 1\nProcessing triggers for libc-bin (2.19-7) ...\nErrors were encountered while processing:\n rabbitmq-server\nE: Sub-process /usr/bin/dpkg returned an error code (1)\n~~~\n\n## Debian Hostname \u5909\u66f4\n\n~~~\nvagrant@10:~$ hostname\n10\n~~~\n\n~~~\nvagrant@10:~$ sudo hostname js1\nvagrant@10:~$ hostname\njs1\n~~~\n\n\n~~~\nvagrant@10:~$ sudo vim /etc/hosts\n\n\n127.0.1.1       js1   \n~~~\n\n~~~~\nvagrant@10:~$ sudo vim /etc/hostname\n\njs1\n~~~~\n\n~~~\nvagrant@10:~$ sudo /etc/init.d/hostname.sh restart\n~~~\n\n## rabbitmq restart\n\n~~~\nvagrant@10:~$ sudo /etc/init.d/rabbitmq-server start\nStarting rabbitmq-server (via systemctl): rabbitmq-server.service.\n~~~\n\n# mqtt plugin\n\n~~~\n\nvagrant@10:~$ sudo rabbitmq-plugins enable rabbitmq_mqtt\nThe following plugins have been enabled:\n  amqp_client\n  rabbitmq_mqtt\nPlugin configuration has changed. Restart RabbitMQ for changes to take effect.\nvagrant@10:~$ sudo /etc/init.d/rabbitmq-server start\nStarting rabbitmq-server (via systemctl): rabbitmq-server.service.\n~~~\n\n## management plugin\n\n~~~\nroot@js1:~# rabbitmq-plugins enable rabbitmq_management\nThe following plugins have been enabled:\n  mochiweb\n  webmachine\n  rabbitmq_web_dispatch\n  rabbitmq_management_agent\n  rabbitmq_management\nPlugin configuration has changed. Restart RabbitMQ for changes to take effect.\n~~~\n\n## /etc/rabbitmq/rabbitmq.config\n\n- [3.3 \u306f guest/guest\u306f \u30ed\u30fc\u30ab\u30eb\u30db\u30b9\u30c8\u304b\u3089\u306e\u307f\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b](http://www.rabbitmq.com/access-control.html)\n\n~~~\nroot@js1:~# zcat /usr/share/doc/rabbitmq-server/rabbitmq.config.example.gz  | sudo tee -a /etc/rabbitmq/rabbitmq.config\n~~~\n\n- \u7de8\u96c6:  erlang\u306e\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8(%%)\u3001\u30ea\u30b9\u30c8\u306e\u6700\u5f8c\u306e\u30a2\u30a4\u30c6\u30e0\u306f \",\"\u3067\u7d42\u308f\u308c\u306a\u3044\u307f\u305f\u3044\u306a\u306e\u3067\u6ce8\u610f\u3002\n\n~~~\nroot@js1:~# vi /etc/rabbitmq/rabbitmq.config \n~~~\n~~~\n{loopback_users, []}         %%, \n~~~\n\n- \u518d\u8d77\u52d5\n\n~~~\nroot@js1:~# sudo /etc/init.d/rabbitmq-server restart\nRestarting rabbitmq-server (via systemctl): rabbitmq-server.service.\n~~~\n\n# mqtt \u8a2d\u5b9a\n\n- [\u3053\u3061\u3089](http://www.rabbitmq.com/mqtt.html)\n- plugin\u6709\u52b9\u306b\u3057\u305f\u6642\u70b9\u3067\u52d5\u3044\u3066\u3044\u308b\u3068\u601d\u308f\u308c\n\n~~~\n[{rabbit,        [{tcp_listeners,    [5672]}]},\n {rabbitmq_mqtt, [{default_user,     <<\"guest\">>},\n                  {default_pass,     <<\"guest\">>},\n                  {allow_anonymous,  true},\n                  {vhost,            <<\"/\">>},\n                  {exchange,         <<\"amq.topic\">>},\n                  {subscription_ttl, 1800000},\n                  {prefetch,         10},\n                  {ssl_listeners,    []},\n                  %% Default MQTT with TLS port is 8883\n                  %% {ssl_listeners,    [8883]}\n                  {tcp_listeners,    [1883]},\n                  {tcp_listen_options, [binary,\n                                        {packet,    raw},\n                                        {reuseaddr, true},\n                                        {backlog,   128},\n                                        {nodelay,   true}]}]}\n].\n~~~\n\n~~~\nroot@js1:~# lsof -i:1883\nCOMMAND  PID     USER   FD   TYPE DEVICE SIZE/OFF NODE NAME\nbeam    5651 rabbitmq   15u  IPv6  25954      0t0  TCP *:1883 (LISTEN)\n~~~\n\n# \u52d5\u4f5c\u78ba\u8a8d: paho-mqtt \n\n\n~~~\n(sandbox)Peeko:messaging hide$ pip install paho-mqtt\nDownloading/unpacking paho-mqtt\n  Downloading paho-mqtt-1.0.tar.gz (40Kb): 40Kb downloaded\n  Running setup.py egg_info for package paho-mqtt\n    \nInstalling collected packages: paho-mqtt\n  Running setup.py install for paho-mqtt\n    \nSuccessfully installed paho-mqtt\nCleaning up...\n~~~\n\n## publisher/subscriber\n\n- [MQTT \u30b3\u30c8\u30cf\u30b8\u30e1](https://gist.github.com/voluntas/8238751)\u306epaho\u306e\u30b3\u30fc\u30c9\u3067\u52d5\u3044\u305f\n\n~~~\n(sandbox)Peeko:messaging hide$ for i in $(seq 1 10); do python paho_pub.py ;done\n~~~\n\n~~~\n(sandbox)Peeko:messaging hide$ python paho_sub.py \nrc: 0\nSubscribed: 1 (0,)\nSubscribed: 2 (0,)\n\nmy/topic/string 0 Hello Mon Oct 20 00:17:05 2014\nmy/topic/string 0 Hello Mon Oct 20 00:17:05 2014\nmy/topic/string 0 Hello Mon Oct 20 00:17:05 2014\nmy/topic/string 0 Hello Mon Oct 20 00:17:05 2014\nmy/topic/string 0 Hello Mon Oct 20 00:17:05 2014\nmy/topic/string 0 Hello Mon Oct 20 00:17:05 2014\nmy/topic/string 0 Hello Mon Oct 20 00:17:05 2014\nmy/topic/string 0 Hello Mon Oct 20 00:17:05 2014\nmy/topic/string 0 Hello Mon Oct 20 00:17:05 2014\nmy/topic/string 0 Hello Mon Oct 20 00:17:05 2014\n~~~\n\n### amq.topic Exchange\n\n- \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30ad\u30fc : my.topic.string\n\n![image](https://raw.githubusercontent.com/hdknr/scriptogr.am/master/messaging/rabbitmq_mqtt.png)\n\n## RabbitMQ\u306e\u30de\u30cd\u30fc\u30b8\u30e3\u304b\u3089\u9001\u4fe1\n\n![image](https://raw.githubusercontent.com/hdknr/scriptogr.am/master/messaging/rabbitmq_mqtt_send.png)\n\n~~~\nmy/topic/string 0 \u307b\u3052\u307b\u3052\n~~~\n", "tags": ["RabbitMQ", "mqtt"]}