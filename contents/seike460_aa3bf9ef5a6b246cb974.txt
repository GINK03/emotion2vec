{"tags": ["PHP", "http2", "nginx", "php-fpm"], "context": "PHP Advent Calendar 2016\u306e17\u65e5\u76ee\u53ca\u3073\nFusic Advent Calendar 2016\u306e17\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\n\u81ea\u5df1\u7d39\u4ecb\n\u307f\u306a\u3055\u307ePHP\u3057\u3066\u307e\u3059\u304b\uff1f\u3000seike460\u3068\u7533\u3057\u307e\u3059\u3002\nPHP\u3092\u4f7f\u3063\u3066\u4ed5\u4e8b\u3057\u3066\u307e\u3059\u304c\u3001\u6700\u8fd1Python\u3082\u304a\u6c17\u306b\u5165\u308a\u3067\u3059\u3002\n\u3053\u3063\u3061\u3067Python\u306e\u8a18\u4e8b\u3082\u66f8\u3044\u3066\u308b\u3093\u3067\u8208\u5473\u3042\u308b\u65b9\u306f\u662f\u975e\u8997\u3044\u3066\u898b\u3066\u4e0b\u3055\u3044\u3002\n\u30a4\u30f3\u30d5\u30e9\u3082\u597d\u304d\u3067\u3001\u30b5\u30fc\u30d0\u30fc\u3082\u89e6\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u80cc\u666f\n\u7a81\u5982\u5f0a\u793e\u306eHICP(Hyper Infrastructure Creator Pudding)\u304c\u793e\u5185\u60c5\u5831\u5171\u6709\u30c4\u30fc\u30eb\u5185\u3067\u3053\u3093\u306a\u8a18\u4e8b\u3092\u66f8\u304d\u307e\u3057\u305f\u3002\n\u300c\u307e\u3060HTTP/1\u3067\u6d88\u8017\u3057\u3066\u308b\u306e\uff1f\u300d\n\u5b8c\u5168\u306b\u717d\u3089\u308c\u305f\u3002\n\u91e3\u308a\u30bf\u30a4\u30c8\u30eb\u3067\u3001\u8a18\u4e8b\u5185\u5bb9\u306f\u3061\u3083\u3093\u3068\u3057\u3066\u307e\u3057\u305f\u304c\u3001\u30a4\u30f3\u30d5\u30e9\u3092\u55dc\u3080\u30a8\u30f3\u30b8\u30cb\u30a2\u3068\u3057\u3066\u306f\n\u300c\u3048\uff1f\u6d88\u8017\u3057\u3066\u306a\u3044\u3067\u3059\u3002\u3082\u3046\u666e\u901a\u306b\u4f7f\u3063\u3066\u307e\u3059\u3088\uff1f\u300d(\u30c9\u30e4\u30a1)\n\u3068\u7b54\u3048\u305f\u3044\u3082\u306e\u3067\u3059\u3002\n\u30c9\u30e4\u30a1\u3059\u308b\u70ba\u306bHTTP/2\u5bfe\u5fdc\u3092\u9032\u3081\u308b\u4e8b\u306b\u3057\u307e\u3057\u305f\u3002\n\n\u30b4\u30fc\u30eb\u8a2d\u5b9a\n\nPHP\u3067HTTP/2\u3057\u3066\u307e\u3059\u3088(\u30c9\u30e4\u30a1)\u51fa\u6765\u308b\u72b6\u614b\u306b\u306a\u308b\n\u3069\u3046\u305b\u306a\u306e\u3067\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u56f3\u308b\nHTTP/2\u306e\u826f\u3055\u3092\u611f\u3058\u308b\n\n\n\u69cb\u6210\n\u307f\u3093\u306a\u304c\u5927\u597d\u304dApache\u3092\u4f7f\u3044\u305f\u3044\u3068\u3053\u308d\u3067\u3059\u304c\u3001\u306a\u3093\u304b\u8272\u3005\u8f9b\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u4eca\u56de\u306fNginx\u3092\u30e1\u30a4\u30f3\u306b\u691c\u8a3c\u3057\u307e\u3059\u3002\nDocker\u3060\u3068\u30b3\u30f3\u30c6\u30ca\u9593\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u304c\u6c17\u306b\u306a\u3063\u305f\u306e\u3067\u7d20\u76f4\u306bVagrant\u3092\u4f7f\u7528\u3059\u308b\u4e8b\u306b\u3057\u307e\u3057\u305f\u3002\nOS\u306fCentOs7\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\nNginx\uff08HTTP/1\uff09 + PHP7\n\u3072\u3068\u307e\u305aNginx(80)\u306b\u3066PHP\u52d5\u4f5c\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u9032\u3081\u307e\u3059\u3002\n\nNginx+PHP7\u74b0\u5883\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\u3010\u306a\u306b\u306f\u3068\u3082\u3042\u308c\u3011\n# yum update\n# systemctl stop firewalld\n\u3010\u4e00\u5fdc\u65e5\u672c\u8a9e\u5316\u3011\n# yum -y install ibus-kkc vlgothic-*\n# localectl set-locale LANG=ja_JP.UTF-8\n\u3010\u307f\u3093\u306a\u5927\u597d\u304dremi\u30ea\u30dd\u30b8\u30c8\u30ea\u3011\n# yum -y install epel-release\n# rpm -ivh http://rpms.famillecollet.com/enterprise/remi-release-7.rpm\n\u3010nginx\u3011\n# yum --enablerepo=epel install nginx\n\u3010php-fpm(\u3069\u3046\u305b\u3060\u304b\u3089php71!)\u3011\n# yum --enablerepo=remi install php71-php-fpm\n\u3010\u5b9f\u884c\u30e6\u30fc\u30b6\u30fc\u7b49\u5909\u66f4 *1\u3011\n# vim /etc/opt/remi/php71/php-fpm.d/www.conf\n\u3010php-fpm\u8d77\u52d5\u3011\n# systemctl start php71-php-fpm\n\u3010\u3072\u3068\u307e\u305aHTTP/1 *2\u3011\n# vim /etc/nginx/nginx.conf\n# systemctl start nginx\n# echo \"<?php phpinfo();\" > /usr/share/nginx/html/info.php\n\n\n\nphp-fpm\u306e\u8a2d\u5b9a *1\n\n\nwww.conf\n\u3010\u30e6\u30fc\u30b6\u30fc\u5909\u66f4\u3011\nuser = nginx\n\n\u3010\u30b0\u30eb\u30fc\u30d7\u5909\u66f4\u3011\ngroup = nginx \n\n\n\nnginx\u306e\u8a2d\u5b9a *2\n\n\nnginx.conf-80\u306eserver\u30bb\u30af\u30b7\u30e7\u30f3\u306b\u8ffd\u8a18\n\n\u3010php\u30d5\u30a1\u30a4\u30eb\u306fphp-fpm\u306b\u6d41\u3059\u3011\nlocation ~ .php$ {\n    fastcgi_pass   127.0.0.1:9000;\n    fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;\n    fastcgi_param  PATH_INFO $fastcgi_path_info;\n    include        fastcgi_params;\n}\n\n\n\nnginx\u518d\u8d77\u52d5\u3057\u3066\u30d6\u30e9\u30a6\u30b6\u306b\u3066info.php\u306b\u30a2\u30af\u30bb\u30b9\n\n\u3072\u3068\u307e\u305a\u52d5\u4f5c\u3057\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\n\n\nNginx\uff08HTTP/2\uff09 + PHP7\n\u30aa\u30ec\u30aa\u30ec\u8a3c\u660e\u66f8\u3092\u4f5c\u6210\u3057\u3066Nginx\u306b\u8aad\u307f\u8fbc\u307e\u305b\u307e\u3059\u3002\n\nserver.key-server.crt\u4f5c\u6210\n# mkdir /etc/pki/nginx/\n# cd /etc/pki/nginx/\n# openssl genrsa -out server.key 2048\nGenerating RSA private key, 2048 bit long modulus\n.....................+++\n.......................................+++\ne is 65537 (0x10001)\n# openssl req -new -key server.key -out server.csr\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [XX]:\nState or Province Name (full name) []:\nLocality Name (eg, city) [Default City]:\nOrganization Name (eg, company) [Default Company Ltd]:\nOrganizational Unit Name (eg, section) []:\nCommon Name (eg, your name or your server's hostname) []:example.seike460.com\u3000\u3010\u203b\u3053\u3053\u306f\u9069\u5f53\u306b\u540d\u524d\u3092\u6c7a\u3081\u3066\u307e\u3059\u203b\u3011\nEmail Address []:\n\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:\nAn optional company name []:\n\n# openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt\n\n\n\n\u81ea\u5206\u306ePC\u306ehosts\u30d5\u30a1\u30a4\u30eb\u306b\u3001\u8ffd\u8a18\uff08\u4eca\u56de\u306e\u5834\u5408\u3001example.seike460.com\uff09\n\n\nnginx.conf-443\u306eserver\u30bb\u30af\u30b7\u30e7\u30f3\u306b\u8ffd\u8a18\n    server {\n        listen       443 ssl http2 default_server;\n        listen       [::]:443 ssl http2 default_server;\n        server_name  example.seike460.com;\n        root         /usr/share/nginx/html;\n\n        ssl_certificate \"/etc/pki/nginx/server.crt\";\n        ssl_certificate_key \"/etc/pki/nginx/server.key\";\n        ssl_session_cache shared:SSL:1m;\n        ssl_session_timeout  10m;\n        ssl_ciphers HIGH:!aNULL:!MD5;\n        ssl_prefer_server_ciphers on;\n\n        # Load configuration files for the default server block.\n        include /etc/nginx/default.d/*.conf;\n\n        location / {\n        }\n\n        error_page 404 /404.html;\n            location = /40x.html {\n        }\n\n        error_page 500 502 503 504 /50x.html;\n            location = /50x.html {\n        }\n        location ~ .php$ {\n            fastcgi_pass   127.0.0.1:9000;\n            fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;\n            fastcgi_param  PATH_INFO $fastcgi_path_info;\n            include        fastcgi_params;\n        }\n    }\n\n\n\nnginx\u518d\u8d77\u52d5\u3057\u3066\u30d6\u30e9\u30a6\u30b6\u306b\u3066info.php\u306b\u30a2\u30af\u30bb\u30b9\n\nChrome\u306e\u62e1\u5f35\u6a5f\u80fd\u306e\u300cHTTP/2 and SPDY indicator\u300d\u304c\u53cd\u5fdc\u305b\u305a\u3050\u306c\u306c\u2026\u3068\u5538\u3063\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\n\u3069\u3046\u3082Chrome\u3060\u3068\u4eca\u56de\u306e\u8a2d\u5b9a\u3067\u306f\u53cd\u5fdc\u3057\u3066\u304f\u308c\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\u4eca\u56de\u306e\u672c\u8cea\u3068\u306f\u5225\u306e\u304a\u8a71\u3067\u3059\u306e\u3067\u3001\u7d20\u76f4\u306bFireFox\u306b\u3066\u53cd\u6620\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\npyonk\u3055\u3093\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u2193\nhttp://qiita.com/pyonk/items/45626c712e4a9938c980\nPHP\u3067HTTP/2\u3057\u3066\u307e\u3059\u3088(\u30c9\u30e4\u30a1)\u51fa\u6765\u308b\u4e8b\u3092\u78ba\u8a8d\n\n\n\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6e2c\u5b9a(ab)\nab\u30921000\u30ea\u30af\u30a8\u30b9\u30c8\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u657010\u3067\u5b9f\u884c\n\nHTTP/1\n# ab  -n 1000 -c 10 https://example.seike460.com/info.php\nThis is ApacheBench, Version 2.3 <$Revision: 1430300 $>\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking example.seike460.com (be patient)\nCompleted 100 requests\nCompleted 200 requests\nCompleted 300 requests\nCompleted 400 requests\nCompleted 500 requests\nCompleted 600 requests\nCompleted 700 requests\nCompleted 800 requests\nCompleted 900 requests\nCompleted 1000 requests\nFinished 1000 requests\n\n\nServer Software:        nginx/1.10.2\nServer Hostname:        example.seike460.com\nServer Port:            443\nSSL/TLS Protocol:       TLSv1.2,ECDHE-RSA-AES256-GCM-SHA384,2048,256\n\nDocument Path:          /info.php\nDocument Length:        891 bytes\n\nConcurrency Level:      10\nTime taken for tests:   2.121 seconds\nComplete requests:      1000\nFailed requests:        0\nWrite errors:           0\nTotal transferred:      1053000 bytes\nHTML transferred:       891000 bytes\nRequests per second:    471.55 [#/sec] (mean)\nTime per request:       21.207 [ms] (mean)\nTime per request:       2.121 [ms] (mean, across all concurrent requests)\nTransfer rate:          484.91 [Kbytes/sec] received\n\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:        4   15   5.3     14      39\nProcessing:     0    6   4.7      5      28\nWaiting:        0    6   4.7      5      28\nTotal:          7   21   6.9     20      54\n\nPercentage of the requests served within a certain time (ms)\n  50%     20\n  66%     23\n  75%     25\n  80%     26\n  90%     31\n  95%     34\n  98%     36\n  99%     39\n 100%     54 (longest request)\n\n\n\nHTTP/2\n# ab  -n 1000 -c 10 https://example.seike460.com/info.php\nThis is ApacheBench, Version 2.3 <$Revision: 1430300 $>\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking example.seike460.com (be patient)\nCompleted 100 requests\nCompleted 200 requests\nCompleted 300 requests\nCompleted 400 requests\nCompleted 500 requests\nCompleted 600 requests\nCompleted 700 requests\nCompleted 800 requests\nCompleted 900 requests\nCompleted 1000 requests\nFinished 1000 requests\n\n\nServer Software:        nginx/1.10.2\nServer Hostname:        example.seike460.com\nServer Port:            443\nSSL/TLS Protocol:       TLSv1.2,ECDHE-RSA-AES256-GCM-SHA384,2048,256\n\nDocument Path:          /info.php\nDocument Length:        891 bytes\n\nConcurrency Level:      10\nTime taken for tests:   2.172 seconds\nComplete requests:      1000\nFailed requests:        0\nWrite errors:           0\nTotal transferred:      1053000 bytes\nHTML transferred:       891000 bytes\nRequests per second:    460.44 [#/sec] (mean)\nTime per request:       21.719 [ms] (mean)\nTime per request:       2.172 [ms] (mean, across all concurrent requests)\nTransfer rate:          473.48 [Kbytes/sec] received\n\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:        5   15   5.0     14      32\nProcessing:     0    7   5.0      6      27\nWaiting:        0    6   5.1      5      27\nTotal:          5   22   7.0     21      50\n\nPercentage of the requests served within a certain time (ms)\n  50%     21\n  66%     24\n  75%     26\n  80%     27\n  90%     30\n  95%     34\n  98%     39\n  99%     42\n 100%     50 (longest request)\n\n\n\u5dee\u306f\u307b\u307c\u306a\u3044\u3067\u3059\u306d\u3002\u30ea\u30bd\u30fc\u30b9\u306b\u8907\u6570\u30a2\u30af\u30bb\u30b9\u51fa\u6765\u308b\u306e\u304c\u5f37\u307f\u3060\u3068\u601d\u3046\u306e\u3067\u3001\nPHP\u7d4c\u7531\u3067\u753b\u50cf\u3092\u8907\u6570\u30a2\u30af\u30bb\u30b9\u3059\u308bHTML\u4f5c\u6210\u3057\u3066\u691c\u8a3c\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6e2c\u5b9a(\u30d6\u30e9\u30a6\u30b6)\nimage\u30bf\u30b0\u3092\u591a\u304f\u751f\u6210\u3059\u308bPHP\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\nHTTP/1\n\nHTTP/2\u3000\n\n\n\u82e5\u5e72 HTTP/2\u306e\u65b9\u304c\u65e9\u3044\u7a0b\u5ea6\u3067\u3059\u306d\u3002\n\uff08\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5f85\u3061\u304c\u753b\u50cf\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5f85\u3061\u304c\u307b\u3068\u3093\u3069\u3067\u3059\u306e\u3067\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u898b\u76f4\u305b\u3070\u3082\u3063\u3068\u65e9\u304f\u306a\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\uff09\n\n\u611f\u60f3\n\u793e\u5185\u60c5\u5831\u5171\u6709\u30c4\u30fc\u30eb\u306b\u6295\u7a3f\u3055\u308c\u305f\u91e3\u308a\u30bf\u30a4\u30c8\u30eb\u306e\u8a18\u4e8b\u306b\u91e3\u3089\u308c\u3066HTTP/2\u3092PHP\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u7279\u306b\u5927\u304d\u306a\u969c\u58c1\u306a\u304f\u5c0e\u5165\u51fa\u6765\u305f\u306e\u3067\u3059\u304c\u3001\n\u6700\u4f4e\u9650\u306e\u5185\u5bb9\u3060\u3063\u305f\u4e8b\u3082\u3042\u308b\u306e\u304b\u5c11\u3057\u3060\u3051\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306b\u6ce8\u76ee\u3059\u308b\u3068\u4e0d\u5b8c\u5168\u71c3\u713c\u306a\u7d50\u679c\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\u3053\u306e\u307e\u307e\u3067\u306f\u30c9\u30e4\u30a1\u51fa\u6765\u307e\u305b\u3093\u3057\u3001HTTP/2\u306e\u6069\u6075\u3092\u3082\u3063\u3068\u611f\u3058\u305f\u3044\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u4eca\u5f8c\u3082\u3063\u3068\u6df1\u6398\u308a\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u3002\n[PHP Advent Calendar 2016](http://qiita.com/advent-calendar/2016/php)\u306e17\u65e5\u76ee\u53ca\u3073\n[Fusic Advent Calendar 2016](http://qiita.com/advent-calendar/2016/fusic)\u306e17\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\n# \u81ea\u5df1\u7d39\u4ecb\n\n\u307f\u306a\u3055\u307ePHP\u3057\u3066\u307e\u3059\u304b\uff1f\u3000seike460\u3068\u7533\u3057\u307e\u3059\u3002\nPHP\u3092\u4f7f\u3063\u3066\u4ed5\u4e8b\u3057\u3066\u307e\u3059\u304c\u3001\u6700\u8fd1Python\u3082\u304a\u6c17\u306b\u5165\u308a\u3067\u3059\u3002\n[\u3053\u3063\u3061\u3067Python\u306e\u8a18\u4e8b](http://qiita.com/seike460/items/1cd1f85dd2f782a48d6a)\u3082\u66f8\u3044\u3066\u308b\u3093\u3067\u8208\u5473\u3042\u308b\u65b9\u306f\u662f\u975e\u8997\u3044\u3066\u898b\u3066\u4e0b\u3055\u3044\u3002\n\u30a4\u30f3\u30d5\u30e9\u3082\u597d\u304d\u3067\u3001\u30b5\u30fc\u30d0\u30fc\u3082\u89e6\u3063\u3066\u3044\u307e\u3059\u3002\n\n# \u80cc\u666f\n\n\u7a81\u5982[\u5f0a\u793e](https://fusic.co.jp/)\u306e[HICP(Hyper Infrastructure Creator Pudding)](https://www.google.co.jp/search?q=fusic%20%E3%83%97%E3%83%AA%E3%83%B3&rct=j)\u304c\u793e\u5185\u60c5\u5831\u5171\u6709\u30c4\u30fc\u30eb\u5185\u3067\u3053\u3093\u306a\u8a18\u4e8b\u3092\u66f8\u304d\u307e\u3057\u305f\u3002\n\n\u300c\u307e\u3060HTTP/1\u3067\u6d88\u8017\u3057\u3066\u308b\u306e\uff1f\u300d\n\n**\u5b8c\u5168\u306b\u717d\u3089\u308c\u305f\u3002**\n\n\u91e3\u308a\u30bf\u30a4\u30c8\u30eb\u3067\u3001\u8a18\u4e8b\u5185\u5bb9\u306f\u3061\u3083\u3093\u3068\u3057\u3066\u307e\u3057\u305f\u304c\u3001\u30a4\u30f3\u30d5\u30e9\u3092\u55dc\u3080\u30a8\u30f3\u30b8\u30cb\u30a2\u3068\u3057\u3066\u306f\n\n\u300c\u3048\uff1f\u6d88\u8017\u3057\u3066\u306a\u3044\u3067\u3059\u3002\u3082\u3046\u666e\u901a\u306b\u4f7f\u3063\u3066\u307e\u3059\u3088\uff1f\u300d(\u30c9\u30e4\u30a1)\n\n\u3068\u7b54\u3048\u305f\u3044\u3082\u306e\u3067\u3059\u3002\n\u30c9\u30e4\u30a1\u3059\u308b\u70ba\u306bHTTP/2\u5bfe\u5fdc\u3092\u9032\u3081\u308b\u4e8b\u306b\u3057\u307e\u3057\u305f\u3002\n\n# \u30b4\u30fc\u30eb\u8a2d\u5b9a\n\n* PHP\u3067HTTP/2\u3057\u3066\u307e\u3059\u3088(\u30c9\u30e4\u30a1)\u51fa\u6765\u308b\u72b6\u614b\u306b\u306a\u308b\n* \u3069\u3046\u305b\u306a\u306e\u3067\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u56f3\u308b\n* HTTP/2\u306e\u826f\u3055\u3092\u611f\u3058\u308b\n\n# \u69cb\u6210\n\n\u307f\u3093\u306a\u304c\u5927\u597d\u304dApache\u3092\u4f7f\u3044\u305f\u3044\u3068\u3053\u308d\u3067\u3059\u304c\u3001~~\u306a\u3093\u304b\u8272\u3005\u8f9b\u305d\u3046\u3060\u3063\u305f\u306e\u3067~~\u4eca\u56de\u306fNginx\u3092\u30e1\u30a4\u30f3\u306b\u691c\u8a3c\u3057\u307e\u3059\u3002\nDocker\u3060\u3068\u30b3\u30f3\u30c6\u30ca\u9593\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u304c\u6c17\u306b\u306a\u3063\u305f\u306e\u3067\u7d20\u76f4\u306bVagrant\u3092\u4f7f\u7528\u3059\u308b\u4e8b\u306b\u3057\u307e\u3057\u305f\u3002\nOS\u306fCentOs7\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\n# Nginx\uff08HTTP/1\uff09 + PHP7\n\n\u3072\u3068\u307e\u305aNginx(80)\u306b\u3066PHP\u52d5\u4f5c\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u9032\u3081\u307e\u3059\u3002\n\n```zsh:Nginx+PHP7\u74b0\u5883\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\u3010\u306a\u306b\u306f\u3068\u3082\u3042\u308c\u3011\n# yum update\n# systemctl stop firewalld\n\u3010\u4e00\u5fdc\u65e5\u672c\u8a9e\u5316\u3011\n# yum -y install ibus-kkc vlgothic-*\n# localectl set-locale LANG=ja_JP.UTF-8\n\u3010\u307f\u3093\u306a\u5927\u597d\u304dremi\u30ea\u30dd\u30b8\u30c8\u30ea\u3011\n# yum -y install epel-release\n# rpm -ivh http://rpms.famillecollet.com/enterprise/remi-release-7.rpm\n\u3010nginx\u3011\n# yum --enablerepo=epel install nginx\n\u3010php-fpm(\u3069\u3046\u305b\u3060\u304b\u3089php71!)\u3011\n# yum --enablerepo=remi install php71-php-fpm\n\u3010\u5b9f\u884c\u30e6\u30fc\u30b6\u30fc\u7b49\u5909\u66f4 *1\u3011\n# vim /etc/opt/remi/php71/php-fpm.d/www.conf\n\u3010php-fpm\u8d77\u52d5\u3011\n# systemctl start php71-php-fpm\n\u3010\u3072\u3068\u307e\u305aHTTP/1 *2\u3011\n# vim /etc/nginx/nginx.conf\n# systemctl start nginx\n# echo \"<?php phpinfo();\" > /usr/share/nginx/html/info.php\n```\n* php-fpm\u306e\u8a2d\u5b9a *1\n\n```vim:www.conf\n\u3010\u30e6\u30fc\u30b6\u30fc\u5909\u66f4\u3011\nuser = nginx\n\n\u3010\u30b0\u30eb\u30fc\u30d7\u5909\u66f4\u3011\ngroup = nginx \n```\n\n* nginx\u306e\u8a2d\u5b9a *2\n\n```vim:nginx.conf-80\u306eserver\u30bb\u30af\u30b7\u30e7\u30f3\u306b\u8ffd\u8a18\n\n\u3010php\u30d5\u30a1\u30a4\u30eb\u306fphp-fpm\u306b\u6d41\u3059\u3011\nlocation ~ .php$ {\n    fastcgi_pass   127.0.0.1:9000;\n    fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;\n    fastcgi_param  PATH_INFO $fastcgi_path_info;\n    include        fastcgi_params;\n}\n```\n* nginx\u518d\u8d77\u52d5\u3057\u3066\u30d6\u30e9\u30a6\u30b6\u306b\u3066info.php\u306b\u30a2\u30af\u30bb\u30b9\n\n\u3072\u3068\u307e\u305a\u52d5\u4f5c\u3057\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\n\n<img width=\"950\" alt=\"80.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/120576/d997c8c3-c59a-3723-0e36-b87bb29750b8.png\">\n\n# Nginx\uff08HTTP/2\uff09 + PHP7\n\n\u30aa\u30ec\u30aa\u30ec\u8a3c\u660e\u66f8\u3092\u4f5c\u6210\u3057\u3066Nginx\u306b\u8aad\u307f\u8fbc\u307e\u305b\u307e\u3059\u3002\n\n```vim:server.key-server.crt\u4f5c\u6210\n# mkdir /etc/pki/nginx/\n# cd /etc/pki/nginx/\n# openssl genrsa -out server.key 2048\nGenerating RSA private key, 2048 bit long modulus\n.....................+++\n.......................................+++\ne is 65537 (0x10001)\n# openssl req -new -key server.key -out server.csr\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [XX]:\nState or Province Name (full name) []:\nLocality Name (eg, city) [Default City]:\nOrganization Name (eg, company) [Default Company Ltd]:\nOrganizational Unit Name (eg, section) []:\nCommon Name (eg, your name or your server's hostname) []:example.seike460.com\u3000\u3010\u203b\u3053\u3053\u306f\u9069\u5f53\u306b\u540d\u524d\u3092\u6c7a\u3081\u3066\u307e\u3059\u203b\u3011\nEmail Address []:\n\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:\nAn optional company name []:\n\n# openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt\n```\n* \u81ea\u5206\u306ePC\u306ehosts\u30d5\u30a1\u30a4\u30eb\u306b\u3001\u8ffd\u8a18\uff08\u4eca\u56de\u306e\u5834\u5408\u3001example.seike460.com\uff09\n\n```vim:nginx.conf-443\u306eserver\u30bb\u30af\u30b7\u30e7\u30f3\u306b\u8ffd\u8a18\n    server {\n        listen       443 ssl http2 default_server;\n        listen       [::]:443 ssl http2 default_server;\n        server_name  example.seike460.com;\n        root         /usr/share/nginx/html;\n\n        ssl_certificate \"/etc/pki/nginx/server.crt\";\n        ssl_certificate_key \"/etc/pki/nginx/server.key\";\n        ssl_session_cache shared:SSL:1m;\n        ssl_session_timeout  10m;\n        ssl_ciphers HIGH:!aNULL:!MD5;\n        ssl_prefer_server_ciphers on;\n\n        # Load configuration files for the default server block.\n        include /etc/nginx/default.d/*.conf;\n\n        location / {\n        }\n\n        error_page 404 /404.html;\n            location = /40x.html {\n        }\n\n        error_page 500 502 503 504 /50x.html;\n            location = /50x.html {\n        }\n        location ~ .php$ {\n            fastcgi_pass   127.0.0.1:9000;\n            fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;\n            fastcgi_param  PATH_INFO $fastcgi_path_info;\n            include        fastcgi_params;\n        }\n    }\n```\n\n* nginx\u518d\u8d77\u52d5\u3057\u3066\u30d6\u30e9\u30a6\u30b6\u306b\u3066info.php\u306b\u30a2\u30af\u30bb\u30b9\n\n\nChrome\u306e\u62e1\u5f35\u6a5f\u80fd\u306e\u300cHTTP/2 and SPDY indicator\u300d\u304c\u53cd\u5fdc\u305b\u305a\u3050\u306c\u306c\u2026\u3068\u5538\u3063\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\n\u3069\u3046\u3082Chrome\u3060\u3068\u4eca\u56de\u306e\u8a2d\u5b9a\u3067\u306f\u53cd\u5fdc\u3057\u3066\u304f\u308c\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\u4eca\u56de\u306e\u672c\u8cea\u3068\u306f\u5225\u306e\u304a\u8a71\u3067\u3059\u306e\u3067\u3001\u7d20\u76f4\u306bFireFox\u306b\u3066\u53cd\u6620\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\npyonk\u3055\u3093\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u2193\nhttp://qiita.com/pyonk/items/45626c712e4a9938c980\n\nPHP\u3067HTTP/2\u3057\u3066\u307e\u3059\u3088(\u30c9\u30e4\u30a1)\u51fa\u6765\u308b\u4e8b\u3092\u78ba\u8a8d\n\n<img width=\"963\" alt=\"443.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/120576/de309827-4fe4-30b9-9487-24671803a4a6.png\">\n\n# \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6e2c\u5b9a(ab)\n\nab\u30921000\u30ea\u30af\u30a8\u30b9\u30c8\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u657010\u3067\u5b9f\u884c\n\n```vim:HTTP/1\n# ab  -n 1000 -c 10 https://example.seike460.com/info.php\nThis is ApacheBench, Version 2.3 <$Revision: 1430300 $>\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking example.seike460.com (be patient)\nCompleted 100 requests\nCompleted 200 requests\nCompleted 300 requests\nCompleted 400 requests\nCompleted 500 requests\nCompleted 600 requests\nCompleted 700 requests\nCompleted 800 requests\nCompleted 900 requests\nCompleted 1000 requests\nFinished 1000 requests\n\n\nServer Software:        nginx/1.10.2\nServer Hostname:        example.seike460.com\nServer Port:            443\nSSL/TLS Protocol:       TLSv1.2,ECDHE-RSA-AES256-GCM-SHA384,2048,256\n\nDocument Path:          /info.php\nDocument Length:        891 bytes\n\nConcurrency Level:      10\nTime taken for tests:   2.121 seconds\nComplete requests:      1000\nFailed requests:        0\nWrite errors:           0\nTotal transferred:      1053000 bytes\nHTML transferred:       891000 bytes\nRequests per second:    471.55 [#/sec] (mean)\nTime per request:       21.207 [ms] (mean)\nTime per request:       2.121 [ms] (mean, across all concurrent requests)\nTransfer rate:          484.91 [Kbytes/sec] received\n\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:        4   15   5.3     14      39\nProcessing:     0    6   4.7      5      28\nWaiting:        0    6   4.7      5      28\nTotal:          7   21   6.9     20      54\n\nPercentage of the requests served within a certain time (ms)\n  50%     20\n  66%     23\n  75%     25\n  80%     26\n  90%     31\n  95%     34\n  98%     36\n  99%     39\n 100%     54 (longest request)\n```\n\n```vim:HTTP/2\n# ab  -n 1000 -c 10 https://example.seike460.com/info.php\nThis is ApacheBench, Version 2.3 <$Revision: 1430300 $>\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking example.seike460.com (be patient)\nCompleted 100 requests\nCompleted 200 requests\nCompleted 300 requests\nCompleted 400 requests\nCompleted 500 requests\nCompleted 600 requests\nCompleted 700 requests\nCompleted 800 requests\nCompleted 900 requests\nCompleted 1000 requests\nFinished 1000 requests\n\n\nServer Software:        nginx/1.10.2\nServer Hostname:        example.seike460.com\nServer Port:            443\nSSL/TLS Protocol:       TLSv1.2,ECDHE-RSA-AES256-GCM-SHA384,2048,256\n\nDocument Path:          /info.php\nDocument Length:        891 bytes\n\nConcurrency Level:      10\nTime taken for tests:   2.172 seconds\nComplete requests:      1000\nFailed requests:        0\nWrite errors:           0\nTotal transferred:      1053000 bytes\nHTML transferred:       891000 bytes\nRequests per second:    460.44 [#/sec] (mean)\nTime per request:       21.719 [ms] (mean)\nTime per request:       2.172 [ms] (mean, across all concurrent requests)\nTransfer rate:          473.48 [Kbytes/sec] received\n\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:        5   15   5.0     14      32\nProcessing:     0    7   5.0      6      27\nWaiting:        0    6   5.1      5      27\nTotal:          5   22   7.0     21      50\n\nPercentage of the requests served within a certain time (ms)\n  50%     21\n  66%     24\n  75%     26\n  80%     27\n  90%     30\n  95%     34\n  98%     39\n  99%     42\n 100%     50 (longest request)\n```\n\n\u5dee\u306f\u307b\u307c\u306a\u3044\u3067\u3059\u306d\u3002\u30ea\u30bd\u30fc\u30b9\u306b\u8907\u6570\u30a2\u30af\u30bb\u30b9\u51fa\u6765\u308b\u306e\u304c\u5f37\u307f\u3060\u3068\u601d\u3046\u306e\u3067\u3001\nPHP\u7d4c\u7531\u3067\u753b\u50cf\u3092\u8907\u6570\u30a2\u30af\u30bb\u30b9\u3059\u308bHTML\u4f5c\u6210\u3057\u3066\u691c\u8a3c\u3057\u3066\u307f\u307e\u3059\u3002\n\n# \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6e2c\u5b9a(\u30d6\u30e9\u30a6\u30b6)\nimage\u30bf\u30b0\u3092\u591a\u304f\u751f\u6210\u3059\u308bPHP\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n* HTTP/1\n<img width=\"932\" alt=\"firefoxhttp1.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/120576/57d7e1bb-f37c-bc58-d2d7-d3023277bcc0.png\">\n\n* HTTP/2\u3000\n<img width=\"934\" alt=\"firefoxhttp2.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/120576/b59e09c4-fbb3-1ea7-3268-df5255aaf0de.png\">\n\n\u82e5\u5e72 HTTP/2\u306e\u65b9\u304c\u65e9\u3044\u7a0b\u5ea6\u3067\u3059\u306d\u3002\n\uff08\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5f85\u3061\u304c\u753b\u50cf\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5f85\u3061\u304c\u307b\u3068\u3093\u3069\u3067\u3059\u306e\u3067\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u898b\u76f4\u305b\u3070\u3082\u3063\u3068\u65e9\u304f\u306a\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\uff09\n\n# \u611f\u60f3\n\u793e\u5185\u60c5\u5831\u5171\u6709\u30c4\u30fc\u30eb\u306b\u6295\u7a3f\u3055\u308c\u305f\u91e3\u308a\u30bf\u30a4\u30c8\u30eb\u306e\u8a18\u4e8b\u306b\u91e3\u3089\u308c\u3066HTTP/2\u3092PHP\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u7279\u306b\u5927\u304d\u306a\u969c\u58c1\u306a\u304f\u5c0e\u5165\u51fa\u6765\u305f\u306e\u3067\u3059\u304c\u3001\n\u6700\u4f4e\u9650\u306e\u5185\u5bb9\u3060\u3063\u305f\u4e8b\u3082\u3042\u308b\u306e\u304b\u5c11\u3057\u3060\u3051\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306b\u6ce8\u76ee\u3059\u308b\u3068\u4e0d\u5b8c\u5168\u71c3\u713c\u306a\u7d50\u679c\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\n\u3053\u306e\u307e\u307e\u3067\u306f\u30c9\u30e4\u30a1\u51fa\u6765\u307e\u305b\u3093\u3057\u3001HTTP/2\u306e\u6069\u6075\u3092\u3082\u3063\u3068\u611f\u3058\u305f\u3044\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u4eca\u5f8c\u3082\u3063\u3068\u6df1\u6398\u308a\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u3002\n"}