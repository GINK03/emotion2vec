{"context": " More than 1 year has passed since last update.\n\n\u6982\u8981\nRaspberry Pi\u3067USB\u30e2\u30c7\u30e0\u633f\u5165\u6642\u306bSORACOM\u3078\u81ea\u52d5\u63a5\u7d9a\u3059\u308b\u3067 RPi2 \u3092\u4f7f\u3063\u3066 SORACOM \u3078\u306e\u63a5\u7d9a\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u3067\u3001\u305d\u308c\u3092\u5197\u9577\u5316\u56de\u7dda\u3068\u3057\u3066\u4f7f\u3046\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\n\u4ed5\u69d8\n\n\u4e3b\u56de\u7dda\u3092\u65e2\u8a2d\u306e FTTH \u3001\u4e88\u5099\u56de\u7dda\u3092 SORACOM Air \u3068\u3057\u307e\u3059\n\u4e21\u56de\u7dda\u53cb\u306b\u30eb\u30fc\u30bf\u306b\u306f RPi2 \u3092\u4f7f\u3044\u307e\u3059\n\u4e3b\u56de\u7dda\u6642\u306f\u4e88\u5099\u56de\u7dda\u5074\u306b\u81ea\u52d5\u5207\u308a\u66ff\u3048\u3057\u3001\u56de\u5fa9\u6642\u306b\u306f\u5207\u308a\u623b\u3057\u307e\u3059\nSORACOM Air \u5074\u3082\u5e38\u6642\u63a5\u7d9a\u3068\u3057\u307e\u3059\n\n\nLAN \u304b\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u63a5\u7d9a\u306e\u5197\u9577\u5316\u3060\u3051\u3067\u3042\u308c\u3070\u969c\u5bb3\u6642\u3060\u3051\u30c0\u30a4\u30e4\u30eb\u30a2\u30c3\u30d7\u3059\u308c\u3070\u5341\u5206\u3067\u3059\u304c\u3001\u5225\u9014 VPN \u3092\u4f7f\u3063\u3066\u5916\u90e8\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u7d4c\u8def\u306e\u5197\u9577\u5316\u3082\u4e88\u5b9a\u3057\u3066\u3044\u308b\u305f\u3081\u5e38\u6642\u63a5\u7d9a\u3068\u3057\u307e\u3057\u305f\n\n\nSORACOM Air \u306e\u901f\u5ea6\u30af\u30e9\u30b9\u306f\u901a\u5e38 s1.minimum \u3068\u3057\u3001\u4e3b\u56de\u7dda\u969c\u5bb3\u6642\u306b\u306f s1.fast \u306b\u4e0a\u3052\u307e\u3059\n\u4e3b\u56de\u7dda\u306e\u969c\u5bb3\u306e\u6709\u7121\u306f\u7279\u5b9a\u30b5\u30a4\u30c8\u3078\u306e ping \u306e\u6210\u5426\u3067\u5224\u65ad\u3057\u307e\u3059\n\n\nppp \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u76e3\u8996\u3060\u3051\u3060\u3068\u30d7\u30ed\u30d0\u30a4\u30c0\u3068\u4e0a\u6d41\u9593\u3067\u306e\u969c\u5bb3\u3092\u691c\u77e5\u3067\u304d\u306a\u3044\u305f\u3081\n\n\n\u901a\u5e38\u6642\u306f sub \u3082 main \u3092\u30c7\u30d5\u30a9\u30eb\u30c8 GW \u3068\u3057\u307e\u3059\n\n\n\u306a\u308b\u3079\u304f SORACOM \u5074\u306b\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092\u751f\u3058\u3055\u305b\u306a\u3044\u305f\u3081\n\n\n\u4e3b\u56de\u7dda\u5074\u306b\u969c\u5bb3\u304c\u751f\u3058\u3066\u3082 main \u81ea\u4f53\u304c\u751f\u304d\u3066\u3044\u308c\u3070 sub \u3092\u30c7\u30d5\u30a9\u30eb\u30c8 GW \u3068\u3057\u3066 main \u3082\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a\u6027\u3092\u7dad\u6301\u3057\u307e\u3059\n\n\n\u69cb\u6210\n\n\u4e3b\u56de\u7dda\u5074\u30eb\u30fc\u30bf(main)\u306b 192.168.0.1 \u3001\u4e88\u5099\u56de\u7dda\u5074\u30eb\u30fc\u30bf(sub)\u306b 192.168.0.2 \u3092\u5272\u308a\u5f53\u3066\u307e\u3059\nVIP 192.168.0.254 \u3092 LAN \u5185\u306e\u30c7\u30d5\u30a9\u30eb\u30c8 GW \u3068\u3057\u3001\u56de\u7dda\u72b6\u6cc1\u306b\u3088\u3063\u3066\u4e3b\u56de\u7dda\u30fb\u4e88\u5099\u56de\u7dda\u306e\u3069\u3061\u3089\u304b\u306b\u5272\u308a\u5f53\u3066\u307e\u3059\n\n\n\u901a\u5e38\u6642\n            FTTH          SORACOM\n   ppp0(\u4e3b\u56de\u7dda)|              | ppp0(\u4e88\u5099\u56de\u7dda)\n          +---+---+      +---+---+\n          |  main |      |  sub  |\n          +-------+      +-------+\n  192.168.0.1 |eth0      eth0| 192.168.0.2\n192.168.0.254 +-------+------+\n                     |\n     ----------------+------------------ LAN\n\n\u969c\u5bb3\u6642\n            FTTH          SORACOM\n   ppp0(\u4e3b\u56de\u7dda)X              | ppp0(\u4e88\u5099\u56de\u7dda)\n          +---+---+      +---+---+\n          |  main |      |  sub  |\n          +-------+      +-------+\n  192.168.0.1 |eth0      eth0| 192.168.0.2\n              +-------+------+ 192.168.0.254\n                     |\n     ----------------+------------------ LAN\n\n\n\u6e96\u5099\n\n\u30eb\u30fc\u30bf\u3068 DHCP \u306e\u8a2d\u5b9a\nmain \u3068 sub \u305d\u308c\u305e\u308c\u304c NAT \u30eb\u30fc\u30bf\u306b\u306a\u308b\u3088\u3046\u306b iptables \u7b49\u306e\u8a2d\u5b9a\u3092\u6e08\u307e\u305b\u3066\u304a\u304d\u307e\u3059\u3002\n\u307e\u305f\u3001 VIP 192.168.0.254 \u304c LAN \u5185\u306e\u30c7\u30d5\u30a9\u30eb\u30c8 GW \u306b\u306a\u308b\u3088\u3046 DHCP \u30b5\u30fc\u30d0\u30fc\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u901f\u5ea6\u30af\u30e9\u30b9\u5909\u66f4\u5c02\u7528\u306e SORACOM \u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\n\u4e88\u5099\u56de\u7dda\u3078\u306e\u5207\u308a\u66ff\u3048\u6642\u306b SORACOM \u306e\u901f\u5ea6\u30af\u30e9\u30b9\u3092 s1.fast \u306b\u5909\u66f4\u3059\u308b\u306e\u3067\u5c02\u7528\u306e\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002 keepalived \u304b\u3089\u547c\u3073\u51fa\u3059\u306e\u3067\u30e6\u30fc\u30b6\u30fc\u540d\u3082 keepalived \u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\u4e88\u3081 SORACOM SDK for Ruby \u3092\u53c2\u7167\u3057\u3066 SORACOM \u306e\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\u3053\u306e\u4f5c\u696d\u306f sub \u5074\u3067\u884c\u3044\u307e\u3059\u3002\n\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210:\npi@sub:~ $ soracom user create_user --user-name=keepalived             \n{\n  \"result\": \"success\"\n}\n\n\u6a29\u9650\u4ed8\u4e0e:\npi@sub:~ $ soracom user update_permission --user_name=keepalived --permission=\"{\\\"statements\\\": [ {\\\"effect\\\": \\\"allow\\\", \\\"api\\\": \\\"Subscriber:updateSpeedClass\\\"} ] }\"\n{\n  \"result\": \"success\"\n}\n\n\u8a8d\u8a3c\u8a2d\u5b9a:\nkeepalived \u306f root \u3067\u52d5\u4f5c\u3059\u308b\u306e\u3067\u3059\u304c\u3001\u305d\u306e\u969b\u306e HOME \u306f / \u306b\u306a\u308b\u306e\u3067\u3001\u8a8d\u8a3c\u60c5\u5831\u306f /.soracom \u306b\u4fdd\u5b58\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\npi@sub:~ $ soracom user generate_auth_key --user-name=keepalived\n{\n  \"authKeyId\": \u201ckeyId-<\u7565>\",\n  \"authKey\": \"secret-<\u7565>\"\n}\npi@sub:~ $ soracom configure --profile=keepalived\n--- SORACOM CLI setup ---\nThis will create .soracom directory under /home/pi and place 'keepalived.json' in it.\n\nPlease select which authentication method to use.\n\n1. Input AuthKeyId and AuthKey *Recommended*\n2. Input Operator credentials (Operator Email and Password)\n3. Input SAM credentials (OperatorId and UserName and Password)\n\nselect(1-3)> 1\nauthKeyId: keyId-<\u7565>\nauthKey: \nwrote to /home/pi/.soracom/keepalived.json\npi@sub:~ $ sudo cp -r /home/pi/.soracom/keepalived.json /\n\n\n\u4e3b\u56de\u7dda\u5074(main)\n\nkeepalived \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\npi@main:~ $ sudo apt-get install -y keepalived\n\nmain \u304c\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u306b\u56de\u308b\u969b\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\n\n/etc/keepalived/backup.sh\n#!/bin/sh\nip route replace default via 192.168.0.254 dev eth0\n\n\nmain \u304c\u30de\u30b9\u30bf\u30fc\u306b\u623b\u308b\u969b\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\n\n/etc/keepalived/master.sh\n#!/bin/sh\nip route replace default dev ppp0\n\n\nkeepalived \u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n\n/etc/keepalived/keepalived.conf\nglobal_defs {\n        notification_email {\n# \u30e1\u30fc\u30eb\u8a2d\u5b9a\u306f\u7701\u7565\n        }\n}\n\nvrrp_script check_ftth {\n        script \"ping -n -s 0 -c 1 -I ppp0 <ping\u5bfe\u8c61\u306eIP\u30a2\u30c9\u30ec\u30b9>\"\n        interval 1\n        fall 3\n        raise 3\n}\n\nvrrp_instance VI_1 {\n        interface eth0\n        state MASTER\n        virtual_router_id 51\n        priority 100\n        advert_int 1\n        authentication {\n                auth_type PASS\n                auth_pass xxxxxxxx\n        }\n        virtual_ipaddress {\n                192.168.0.254/24 brd 192.168.0.255 dev eth0\n        }\n        track_script {\n                check_ftth\n        }\n        notify_master \"/etc/keepalived/master.sh\"\n        notify_backup \"/etc/keepalived/backup.sh\"\n        notify_fault \"/etc/keepalived/backup.sh\"\n} \n\n\nkeepalived \u3092\u8d77\u52d5\u3057\u307e\u3059\npi@main:~ $ sudo systemctl start keepalived\n\n\n\u4e88\u5099\u56de\u7dda\u5074(sub)\n\nSORACOM Air \u3078\u306e\u63a5\u7d9a\u8a2d\u5b9a\n\u4f8b\u3048\u3070Raspberry Pi\u3067USB\u30e2\u30c7\u30e0\u633f\u5165\u6642\u306bSORACOM\u3078\u81ea\u52d5\u63a5\u7d9a\u3059\u308b\u7b49\u306e\u8a2d\u5b9a\u306b\u3088\u308a\u3001 sub \u304b\u3089 SORACOM Air \u306b\u81ea\u52d5\u3067\u5e38\u6642\u63a5\u7d9a\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u307e\u305f\u3001\u4eca\u56de\u306e\u8a2d\u5b9a\u3067\u306f\u969c\u5bb3\u304c\u767a\u751f\u3057\u306a\u3044\u9650\u308a SORACOM Air \u306b\u4e00\u5207\u306e\u30d1\u30b1\u30c3\u30c8\u304c\u6d41\u308c\u307e\u305b\u3093\u3002 SORACOM Air \u3067\u306f1\u6642\u9593\u306e\u7121\u901a\u4fe1\u3067\u56de\u7dda\u304c\u5207\u65ad\u3055\u308c\u307e\u3059\u306e\u3067\u3001\u5207\u308c\u308b\u524d\u306b ppp \u5074\u306b ping \u3092\u6253\u3064\u3088\u3046\u306b crontab \u306b\u767b\u9332\u3057\u3066\u304a\u304d\u307e\u3059\u3002\npi@sub:~ $ sudo crontab -e\n<\u7565>\n0 * * * * ping -w 3 -n 10.64.64.64\n\n\nkeepalived \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\npi@sub:~ $ sudo apt-get install -y keepalived\n\nsub \u304c\u30de\u30b9\u30bf\u30fc\u306b\u306a\u308b\u5834\u5408\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\n\n/etc/keepalived/master.sh\n#!/bin/sh\nip route replace default dev ppp0\necho 1 > /proc/sys/net/ipv4/ip_forward\n/usr/local/bin/soracom sim update_speed_class \u2014-imsi=<SORACOM Air SIM \u306e IMSI> --speed-class=s1.fast --profile=keepalived > /dev/null 2>&1\n\n\nsub \u304c\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u306b\u623b\u308b\u969b\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\n\n/etc/keepalived/backup.sh\n#!/bin/sh\n/usr/local/bin/soracom sim update_speed_class \u2014imsi=<SORACOM Air SIM \u306e IMSI> --speed-class=s1.minimum --profile=keepalived > /dev/null 2>&1\necho 0 > /proc/sys/net/ipv4/ip_forward\nip route replace default via 192.168.0.254 dev eth0\n\n\nkeepalived \u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n\n/etc/keepalived/keepalived.conf\nglobal_defs {\n        notification_email {\n# \u30e1\u30fc\u30eb\u8a2d\u5b9a\u306f\u7701\u7565\n        }\n}\n\nvrrp_instance VI_1 {  \n        interface eth0  \n        state BACKUP  \n        virtual_router_id 51  \n        priority 50  \n        advert_int 1  \n        authentication {  \n                auth_type PASS  \n                auth_pass xxxxxxxx  \n        }  \n        virtual_ipaddress {  \n                192.168.0.254/24 brd 192.168.0.255 dev eth0  \n        }  \n        notify_master \"/etc/keepalived/master.sh\"  \n        notify_backup \"/etc/keepalived/backup.sh\"  \n        notify_fault \"/etc/keepalived/backup.sh\"  \n}  \n\n\nmain \u3068\u540c\u69d8\u306b keepalived \u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\npi@sub:~ $ sudo systemctl start keepalived\n\n\n\u52d5\u4f5c\u78ba\u8a8d\n\n\u901a\u5e38\u6642\nmain \u306b 192.168.0.254 \u304c\u5272\u308a\u5f53\u305f\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\npi@main:~ $ ip -f inet addr show eth0\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    inet 192.168.0.1/24 brd 192.168.0.255 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet 192.168.0.254/24 brd 192.168.0.255 scope global secondary eth0\n       valid_lft forever preferred_ft forever\n\nmain \u3067 FTTH \u56de\u7dda\u304c\u30c7\u30d5\u30a9\u30eb\u30c8 GW \u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\npi@main:~ $ ip route show \ndefault dev ppp0  scope link \n<FTTH\u304b\u3089\u5272\u308a\u5f53\u3066\u3089\u308c\u305f\u30a2\u30c9\u30ec\u30b9> dev ppp0  proto kernel  scope link  src <FTTH\u3067\u306e\u5bfe\u5411\u30a2\u30c9\u30ec\u30b9>\n192.168.0.0/24 dev eth0  proto kernel  scope link  src 192.168.0.1 \n\nLAN \u5185\u306e\u30db\u30b9\u30c8\u304b\u3089\u5916\u90e8\u3078\u306e traceroute \u304c main \u7d4c\u7531\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\ngimy@localhost ~ $ traceroute -n 8.8.8.8\ntraceroute to 8.8.8.8 (8.8.8.8), 64 hops max, 52 byte packets\n 1  192.168.0.1  2.234 ms  1.151 ms  1.173 ms\n<\u7565>\n 9  8.8.8.8  4.613 ms  5.948 ms  4.475 ms\n\n\n\u969c\u5bb3\u6642\n\u5916\u90e8\u30b5\u30a4\u30c8\u306b ping \u3092\u6253\u3061\u7d9a\u3051\u3066\u304a\u304d\u307e\u3059\u3002\ngimy@locahost ~ $ ping -n 8.8.8.8\nPING 8.8.8.8 (8.8.8.8): 56 data bytes\n64 bytes from 8.8.8.8: icmp_seq=0 ttl=56 time=5.142 ms\n64 bytes from 8.8.8.8: icmp_seq=1 ttl=56 time=6.954 ms\n64 bytes from 8.8.8.8: icmp_seq=2 ttl=56 time=8.226 ms\n64 bytes from 8.8.8.8: icmp_seq=3 ttl=56 time=7.622 ms\n<\u7565>\n\nmain \u5074\u306e ppp \u3092\u843d\u3068\u3057\u7591\u4f3c\u7684\u306b\u969c\u5bb3\u72b6\u614b\u3092\u4f5c\u308a\u307e\u3059\u3002\npi@main:~ $ sudo poff dsl-provider\n\n\u5148\u7a0b\u958b\u59cb\u3057\u305f ping \u304c\u9014\u4e2d\u3067\u901a\u3089\u306a\u304f\u306a\u308a\u3084\u304c\u3066\u56de\u5fa9\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n64 bytes from 8.8.8.8: icmp_seq=21 ttl=56 time=5.205 ms\n64 bytes from 8.8.8.8: icmp_seq=22 ttl=56 time=7.666 ms\n64 bytes from 8.8.8.8: icmp_seq=23 ttl=56 time=5.761 ms\n64 bytes from 8.8.8.8: icmp_seq=24 ttl=56 time=5.418 ms\n64 bytes from 8.8.8.8: icmp_seq=25 ttl=56 time=7.017 ms\n64 bytes from 8.8.8.8: icmp_seq=26 ttl=56 time=6.637 ms\n64 bytes from 8.8.8.8: icmp_seq=27 ttl=56 time=5.582 ms\n92 bytes from 192.168.0.1: Destination Net Unreachable\nVr HL TOS  Len   ID Flg  off TTL Pro  cks      Src      Dst\n 4  5  00 5400 8904   0 0000  40  01 2087 192.168.0.102  8.8.8.8 \n\nRequest timeout for icmp_seq 28\n92 bytes from 192.168.0.1: Destination Net Unreachable\nVr HL TOS  Len   ID Flg  off TTL Pro  cks      Src      Dst\n 4  5  00 5400 b0a6   0 0000  40  01 f8e4 192.168.0.102  8.8.8.8 \n\nRequest timeout for icmp_seq 29\n92 bytes from 192.168.0.1: Destination Net Unreachable\nVr HL TOS  Len   ID Flg  off TTL Pro  cks      Src      Dst\n 4  5  00 5400 23cd   0 0000  40  01 85be 192.168.0.102  8.8.8.8 \n\nRequest timeout for icmp_seq 30\n92 bytes from 192.168.0.1: Destination Net Unreachable\nVr HL TOS  Len   ID Flg  off TTL Pro  cks      Src      Dst\n 4  5  00 5400 6cb1   0 0000  40  01 3cda 192.168.0.102  8.8.8.8 \n\nRequest timeout for icmp_seq 31\nRequest timeout for icmp_seq 32\n92 bytes from 192.168.0.1: Redirect Host(New addr: 192.168.0.254)\nVr HL TOS  Len   ID Flg  off TTL Pro  cks      Src      Dst\n 4  5  00 0054 57b0   0 0000  3f  01 52db 192.168.0.102  8.8.8.8 \n\nRequest timeout for icmp_seq 33\n64 bytes from 8.8.8.8: icmp_seq=34 ttl=55 time=131.398 ms\n64 bytes from 8.8.8.8: icmp_seq=35 ttl=55 time=136.203 ms\n64 bytes from 8.8.8.8: icmp_seq=36 ttl=55 time=391.485 ms\n64 bytes from 8.8.8.8: icmp_seq=37 ttl=55 time=188.250 ms\n64 bytes from 8.8.8.8: icmp_seq=38 ttl=54 time=143.007 ms\n64 bytes from 8.8.8.8: icmp_seq=39 ttl=54 time=597.688 ms\n<\u7565>\n\nsub \u7d4c\u7531\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\ngimy@localhost ~ $ traceroute -n 8.8.8.8\ntraceroute to 8.8.8.8 (8.8.8.8), 64 hops max, 52 byte packets\n 1  192.168.0.2  2.949 ms  1.179 ms  1.152 ms\n<\u7565>\n    8.8.8.8  130.123 ms\n\nsub \u306b 192.168.0.254 \u304c\u5272\u308a\u5f53\u305f\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\npi@sub:~ $ ip -f inet addr show eth0\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    inet 192.168.0.2/24 brd 192.168.0.255 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet 192.168.0.254/24 brd 192.168.0.255 scope global secondary eth0\n       valid_lft forever preferred_ft forever\n\nsub \u3067 SORACOM \u5074\u304c\u30c7\u30d5\u30a9\u30eb\u30c8 GW \u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\ngimy@sub:~ $ ip route show\ndefault dev ppp0  scope link \n10.64.64.64 dev ppp0  proto kernel  scope link  src <SORACOM \u304b\u3089\u5272\u308a\u5f53\u3066\u3089\u308c\u305f\u30a2\u30c9\u30ec\u30b9>\n192.168.0.0/24 dev eth0  proto kernel  scope link  src 192.168.0.2 \n\n\n\u5207\u308a\u623b\u3057\nmain \u306e ppp \u63a5\u7d9a\u3092\u56de\u5fa9\u3055\u305b\u3001\u5207\u308a\u623b\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\npi@main:~ $ sudo pon dsl-provider\nPlugin rp-pppoe.so loaded.\n\n\u78ba\u8a8d\u5185\u5bb9\u306f\u901a\u5e38\u6642\u3068\u540c\u3058\u3067\u3059\u3002\n\n\u611f\u60f3\ns1.fast \u3067\u3042\u3063\u3066\u3082 2Mbps \u306a\u306e\u3067\u3001 SORACOM Air \u5074\u306b failover \u3057\u305f\u72b6\u614b\u3067 LAN \u5185\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u6a5f\u304b\u3089 Web \u30d6\u30e9\u30a6\u30ba\u3059\u308b\u3068\u3084\u306f\u308a\u30b9\u30c8\u30ec\u30b9\u3092\u611f\u3058\u307e\u3059\u3002\u3057\u304b\u3057\u3001\u6708\u984d300\u5186\u7a0b\u5ea6\u3067\u4e88\u5099\u56de\u7dda\u3092\u7dad\u6301\u3067\u304d\u308b\u3068\u3044\u3046\u306e\u306f\u305d\u308c\u306a\u308a\u306b\u610f\u5473\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u53c2\u8003\nSORACOM SDK for Ruby\n# \u6982\u8981\n\n[Raspberry Pi\u3067USB\u30e2\u30c7\u30e0\u633f\u5165\u6642\u306bSORACOM\u3078\u81ea\u52d5\u63a5\u7d9a\u3059\u308b](http://qiita.com/gimy/items/1d49f8e08210e9c9f20a)\u3067 RPi2 \u3092\u4f7f\u3063\u3066 SORACOM \u3078\u306e\u63a5\u7d9a\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u3067\u3001\u305d\u308c\u3092\u5197\u9577\u5316\u56de\u7dda\u3068\u3057\u3066\u4f7f\u3046\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\n# \u4ed5\u69d8\n\n* \u4e3b\u56de\u7dda\u3092\u65e2\u8a2d\u306e FTTH \u3001\u4e88\u5099\u56de\u7dda\u3092 SORACOM Air \u3068\u3057\u307e\u3059\n* \u4e21\u56de\u7dda\u53cb\u306b\u30eb\u30fc\u30bf\u306b\u306f RPi2 \u3092\u4f7f\u3044\u307e\u3059\n* \u4e3b\u56de\u7dda\u6642\u306f\u4e88\u5099\u56de\u7dda\u5074\u306b\u81ea\u52d5\u5207\u308a\u66ff\u3048\u3057\u3001\u56de\u5fa9\u6642\u306b\u306f\u5207\u308a\u623b\u3057\u307e\u3059\n* SORACOM Air \u5074\u3082\u5e38\u6642\u63a5\u7d9a\u3068\u3057\u307e\u3059\n    * LAN \u304b\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u63a5\u7d9a\u306e\u5197\u9577\u5316\u3060\u3051\u3067\u3042\u308c\u3070\u969c\u5bb3\u6642\u3060\u3051\u30c0\u30a4\u30e4\u30eb\u30a2\u30c3\u30d7\u3059\u308c\u3070\u5341\u5206\u3067\u3059\u304c\u3001\u5225\u9014 VPN \u3092\u4f7f\u3063\u3066\u5916\u90e8\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u7d4c\u8def\u306e\u5197\u9577\u5316\u3082\u4e88\u5b9a\u3057\u3066\u3044\u308b\u305f\u3081\u5e38\u6642\u63a5\u7d9a\u3068\u3057\u307e\u3057\u305f\n* SORACOM Air \u306e\u901f\u5ea6\u30af\u30e9\u30b9\u306f\u901a\u5e38 s1.minimum \u3068\u3057\u3001\u4e3b\u56de\u7dda\u969c\u5bb3\u6642\u306b\u306f s1.fast \u306b\u4e0a\u3052\u307e\u3059\n* \u4e3b\u56de\u7dda\u306e\u969c\u5bb3\u306e\u6709\u7121\u306f\u7279\u5b9a\u30b5\u30a4\u30c8\u3078\u306e ping \u306e\u6210\u5426\u3067\u5224\u65ad\u3057\u307e\u3059\n    * ppp \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u76e3\u8996\u3060\u3051\u3060\u3068\u30d7\u30ed\u30d0\u30a4\u30c0\u3068\u4e0a\u6d41\u9593\u3067\u306e\u969c\u5bb3\u3092\u691c\u77e5\u3067\u304d\u306a\u3044\u305f\u3081\n* \u901a\u5e38\u6642\u306f sub \u3082 main \u3092\u30c7\u30d5\u30a9\u30eb\u30c8 GW \u3068\u3057\u307e\u3059\n    * \u306a\u308b\u3079\u304f SORACOM \u5074\u306b\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092\u751f\u3058\u3055\u305b\u306a\u3044\u305f\u3081\n* \u4e3b\u56de\u7dda\u5074\u306b\u969c\u5bb3\u304c\u751f\u3058\u3066\u3082 main \u81ea\u4f53\u304c\u751f\u304d\u3066\u3044\u308c\u3070 sub \u3092\u30c7\u30d5\u30a9\u30eb\u30c8 GW \u3068\u3057\u3066 main \u3082\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a\u6027\u3092\u7dad\u6301\u3057\u307e\u3059\n\n# \u69cb\u6210\n\n* \u4e3b\u56de\u7dda\u5074\u30eb\u30fc\u30bf(main)\u306b 192.168.0.1 \u3001\u4e88\u5099\u56de\u7dda\u5074\u30eb\u30fc\u30bf(sub)\u306b 192.168.0.2 \u3092\u5272\u308a\u5f53\u3066\u307e\u3059\n* VIP 192.168.0.254 \u3092 LAN \u5185\u306e\u30c7\u30d5\u30a9\u30eb\u30c8 GW \u3068\u3057\u3001\u56de\u7dda\u72b6\u6cc1\u306b\u3088\u3063\u3066\u4e3b\u56de\u7dda\u30fb\u4e88\u5099\u56de\u7dda\u306e\u3069\u3061\u3089\u304b\u306b\u5272\u308a\u5f53\u3066\u307e\u3059\n\n## \u901a\u5e38\u6642\n\n```\n            FTTH          SORACOM\n   ppp0(\u4e3b\u56de\u7dda)|              | ppp0(\u4e88\u5099\u56de\u7dda)\n          +---+---+      +---+---+\n          |  main |      |  sub  |\n          +-------+      +-------+\n  192.168.0.1 |eth0      eth0| 192.168.0.2\n192.168.0.254 +-------+------+\n                     |\n     ----------------+------------------ LAN\n```\n\n\u969c\u5bb3\u6642\n\n```\n            FTTH          SORACOM\n   ppp0(\u4e3b\u56de\u7dda)X              | ppp0(\u4e88\u5099\u56de\u7dda)\n          +---+---+      +---+---+\n          |  main |      |  sub  |\n          +-------+      +-------+\n  192.168.0.1 |eth0      eth0| 192.168.0.2\n              +-------+------+ 192.168.0.254\n                     |\n     ----------------+------------------ LAN\n```\n\n# \u6e96\u5099\n\n## \u30eb\u30fc\u30bf\u3068 DHCP \u306e\u8a2d\u5b9a\n\nmain \u3068 sub \u305d\u308c\u305e\u308c\u304c NAT \u30eb\u30fc\u30bf\u306b\u306a\u308b\u3088\u3046\u306b iptables \u7b49\u306e\u8a2d\u5b9a\u3092\u6e08\u307e\u305b\u3066\u304a\u304d\u307e\u3059\u3002\n\u307e\u305f\u3001 VIP 192.168.0.254 \u304c LAN \u5185\u306e\u30c7\u30d5\u30a9\u30eb\u30c8 GW \u306b\u306a\u308b\u3088\u3046 DHCP \u30b5\u30fc\u30d0\u30fc\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n## \u901f\u5ea6\u30af\u30e9\u30b9\u5909\u66f4\u5c02\u7528\u306e SORACOM \u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\n\n\u4e88\u5099\u56de\u7dda\u3078\u306e\u5207\u308a\u66ff\u3048\u6642\u306b SORACOM \u306e\u901f\u5ea6\u30af\u30e9\u30b9\u3092 s1.fast \u306b\u5909\u66f4\u3059\u308b\u306e\u3067\u5c02\u7528\u306e\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002 keepalived \u304b\u3089\u547c\u3073\u51fa\u3059\u306e\u3067\u30e6\u30fc\u30b6\u30fc\u540d\u3082 keepalived \u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\u4e88\u3081 [SORACOM SDK for Ruby](https://dev.soracom.io/jp/tools/) \u3092\u53c2\u7167\u3057\u3066 SORACOM \u306e\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\u3053\u306e\u4f5c\u696d\u306f sub \u5074\u3067\u884c\u3044\u307e\u3059\u3002\n\n\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210:\n\n```shell-session\npi@sub:~ $ soracom user create_user --user-name=keepalived             \n{\n  \"result\": \"success\"\n}\n```\n\n\u6a29\u9650\u4ed8\u4e0e:\n\n```shell-session\npi@sub:~ $ soracom user update_permission --user_name=keepalived --permission=\"{\\\"statements\\\": [ {\\\"effect\\\": \\\"allow\\\", \\\"api\\\": \\\"Subscriber:updateSpeedClass\\\"} ] }\"\n{\n  \"result\": \"success\"\n}\n```\n\n\u8a8d\u8a3c\u8a2d\u5b9a:\nkeepalived \u306f root \u3067\u52d5\u4f5c\u3059\u308b\u306e\u3067\u3059\u304c\u3001\u305d\u306e\u969b\u306e HOME \u306f / \u306b\u306a\u308b\u306e\u3067\u3001\u8a8d\u8a3c\u60c5\u5831\u306f /.soracom \u306b\u4fdd\u5b58\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```shell-session\npi@sub:~ $ soracom user generate_auth_key --user-name=keepalived\n{\n  \"authKeyId\": \u201ckeyId-<\u7565>\",\n  \"authKey\": \"secret-<\u7565>\"\n}\npi@sub:~ $ soracom configure --profile=keepalived\n--- SORACOM CLI setup ---\nThis will create .soracom directory under /home/pi and place 'keepalived.json' in it.\n\nPlease select which authentication method to use.\n\n1. Input AuthKeyId and AuthKey *Recommended*\n2. Input Operator credentials (Operator Email and Password)\n3. Input SAM credentials (OperatorId and UserName and Password)\n\nselect(1-3)> 1\nauthKeyId: keyId-<\u7565>\nauthKey: \nwrote to /home/pi/.soracom/keepalived.json\npi@sub:~ $ sudo cp -r /home/pi/.soracom/keepalived.json /\n```\n\n# \u4e3b\u56de\u7dda\u5074(main)\n\n## keepalived \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\n\n```shell-session\npi@main:~ $ sudo apt-get install -y keepalived\n```\n\nmain \u304c\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u306b\u56de\u308b\u969b\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\n\n```bash:/etc/keepalived/backup.sh\n#!/bin/sh\nip route replace default via 192.168.0.254 dev eth0\n```\n\nmain \u304c\u30de\u30b9\u30bf\u30fc\u306b\u623b\u308b\u969b\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\n\n```bash:/etc/keepalived/master.sh\n#!/bin/sh\nip route replace default dev ppp0\n```\n\nkeepalived \u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n\n```:/etc/keepalived/keepalived.conf\nglobal_defs {\n        notification_email {\n# \u30e1\u30fc\u30eb\u8a2d\u5b9a\u306f\u7701\u7565\n        }\n}\n \nvrrp_script check_ftth {\n        script \"ping -n -s 0 -c 1 -I ppp0 <ping\u5bfe\u8c61\u306eIP\u30a2\u30c9\u30ec\u30b9>\"\n        interval 1\n        fall 3\n        raise 3\n}\n \nvrrp_instance VI_1 {\n        interface eth0\n        state MASTER\n        virtual_router_id 51\n        priority 100\n        advert_int 1\n        authentication {\n                auth_type PASS\n                auth_pass xxxxxxxx\n        }\n        virtual_ipaddress {\n                192.168.0.254/24 brd 192.168.0.255 dev eth0\n        }\n        track_script {\n                check_ftth\n        }\n        notify_master \"/etc/keepalived/master.sh\"\n        notify_backup \"/etc/keepalived/backup.sh\"\n        notify_fault \"/etc/keepalived/backup.sh\"\n} \n```\n\nkeepalived \u3092\u8d77\u52d5\u3057\u307e\u3059\n\n```shell-session\npi@main:~ $ sudo systemctl start keepalived\n```\n\n# \u4e88\u5099\u56de\u7dda\u5074(sub)\n\n## SORACOM Air \u3078\u306e\u63a5\u7d9a\u8a2d\u5b9a\n\n\u4f8b\u3048\u3070[Raspberry Pi\u3067USB\u30e2\u30c7\u30e0\u633f\u5165\u6642\u306bSORACOM\u3078\u81ea\u52d5\u63a5\u7d9a\u3059\u308b](http://qiita.com/gimy/items/1d49f8e08210e9c9f20a)\u7b49\u306e\u8a2d\u5b9a\u306b\u3088\u308a\u3001 sub \u304b\u3089 SORACOM Air \u306b\u81ea\u52d5\u3067\u5e38\u6642\u63a5\u7d9a\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u307e\u305f\u3001\u4eca\u56de\u306e\u8a2d\u5b9a\u3067\u306f\u969c\u5bb3\u304c\u767a\u751f\u3057\u306a\u3044\u9650\u308a SORACOM Air \u306b\u4e00\u5207\u306e\u30d1\u30b1\u30c3\u30c8\u304c\u6d41\u308c\u307e\u305b\u3093\u3002 SORACOM Air \u3067\u306f1\u6642\u9593\u306e\u7121\u901a\u4fe1\u3067\u56de\u7dda\u304c\u5207\u65ad\u3055\u308c\u307e\u3059\u306e\u3067\u3001\u5207\u308c\u308b\u524d\u306b ppp \u5074\u306b ping \u3092\u6253\u3064\u3088\u3046\u306b crontab \u306b\u767b\u9332\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```shell-session\npi@sub:~ $ sudo crontab -e\n<\u7565>\n0 * * * * ping -w 3 -n 10.64.64.64\n```\n\n## keepalived \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\n\n```shell-session\npi@sub:~ $ sudo apt-get install -y keepalived\n```\n\nsub \u304c\u30de\u30b9\u30bf\u30fc\u306b\u306a\u308b\u5834\u5408\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\n\n```bash:/etc/keepalived/master.sh\n#!/bin/sh\nip route replace default dev ppp0\necho 1 > /proc/sys/net/ipv4/ip_forward\n/usr/local/bin/soracom sim update_speed_class \u2014-imsi=<SORACOM Air SIM \u306e IMSI> --speed-class=s1.fast --profile=keepalived > /dev/null 2>&1\n```\n\nsub \u304c\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u306b\u623b\u308b\u969b\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\n\n```bash:/etc/keepalived/backup.sh\n#!/bin/sh\n/usr/local/bin/soracom sim update_speed_class \u2014imsi=<SORACOM Air SIM \u306e IMSI> --speed-class=s1.minimum --profile=keepalived > /dev/null 2>&1\necho 0 > /proc/sys/net/ipv4/ip_forward\nip route replace default via 192.168.0.254 dev eth0\n```\n\nkeepalived \u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n\n```:/etc/keepalived/keepalived.conf\nglobal_defs {\n        notification_email {\n# \u30e1\u30fc\u30eb\u8a2d\u5b9a\u306f\u7701\u7565\n        }\n}\n \nvrrp_instance VI_1 {  \n        interface eth0  \n        state BACKUP  \n        virtual_router_id 51  \n        priority 50  \n        advert_int 1  \n        authentication {  \n                auth_type PASS  \n                auth_pass xxxxxxxx  \n        }  \n        virtual_ipaddress {  \n                192.168.0.254/24 brd 192.168.0.255 dev eth0  \n        }  \n        notify_master \"/etc/keepalived/master.sh\"  \n        notify_backup \"/etc/keepalived/backup.sh\"  \n        notify_fault \"/etc/keepalived/backup.sh\"  \n}  \n```\n\nmain \u3068\u540c\u69d8\u306b keepalived \u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```shell-session\npi@sub:~ $ sudo systemctl start keepalived\n```\n\n# \u52d5\u4f5c\u78ba\u8a8d\n\n## \u901a\u5e38\u6642\n\nmain \u306b 192.168.0.254 \u304c\u5272\u308a\u5f53\u305f\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```shell-session\npi@main:~ $ ip -f inet addr show eth0\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    inet 192.168.0.1/24 brd 192.168.0.255 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet 192.168.0.254/24 brd 192.168.0.255 scope global secondary eth0\n       valid_lft forever preferred_ft forever\n```\n\nmain \u3067 FTTH \u56de\u7dda\u304c\u30c7\u30d5\u30a9\u30eb\u30c8 GW \u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```shell-session\npi@main:~ $ ip route show \ndefault dev ppp0  scope link \n<FTTH\u304b\u3089\u5272\u308a\u5f53\u3066\u3089\u308c\u305f\u30a2\u30c9\u30ec\u30b9> dev ppp0  proto kernel  scope link  src <FTTH\u3067\u306e\u5bfe\u5411\u30a2\u30c9\u30ec\u30b9>\n192.168.0.0/24 dev eth0  proto kernel  scope link  src 192.168.0.1 \n```\n\nLAN \u5185\u306e\u30db\u30b9\u30c8\u304b\u3089\u5916\u90e8\u3078\u306e traceroute \u304c main \u7d4c\u7531\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```shell-session\ngimy@localhost ~ $ traceroute -n 8.8.8.8\ntraceroute to 8.8.8.8 (8.8.8.8), 64 hops max, 52 byte packets\n 1  192.168.0.1  2.234 ms  1.151 ms  1.173 ms\n<\u7565>\n 9  8.8.8.8  4.613 ms  5.948 ms  4.475 ms\n```\n\n## \u969c\u5bb3\u6642\n\n\u5916\u90e8\u30b5\u30a4\u30c8\u306b ping \u3092\u6253\u3061\u7d9a\u3051\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\ngimy@locahost ~ $ ping -n 8.8.8.8\nPING 8.8.8.8 (8.8.8.8): 56 data bytes\n64 bytes from 8.8.8.8: icmp_seq=0 ttl=56 time=5.142 ms\n64 bytes from 8.8.8.8: icmp_seq=1 ttl=56 time=6.954 ms\n64 bytes from 8.8.8.8: icmp_seq=2 ttl=56 time=8.226 ms\n64 bytes from 8.8.8.8: icmp_seq=3 ttl=56 time=7.622 ms\n<\u7565>\n```\nmain \u5074\u306e ppp \u3092\u843d\u3068\u3057\u7591\u4f3c\u7684\u306b\u969c\u5bb3\u72b6\u614b\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n```shell-session\npi@main:~ $ sudo poff dsl-provider\n```\n\u5148\u7a0b\u958b\u59cb\u3057\u305f ping \u304c\u9014\u4e2d\u3067\u901a\u3089\u306a\u304f\u306a\u308a\u3084\u304c\u3066\u56de\u5fa9\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```shell-session\n64 bytes from 8.8.8.8: icmp_seq=21 ttl=56 time=5.205 ms\n64 bytes from 8.8.8.8: icmp_seq=22 ttl=56 time=7.666 ms\n64 bytes from 8.8.8.8: icmp_seq=23 ttl=56 time=5.761 ms\n64 bytes from 8.8.8.8: icmp_seq=24 ttl=56 time=5.418 ms\n64 bytes from 8.8.8.8: icmp_seq=25 ttl=56 time=7.017 ms\n64 bytes from 8.8.8.8: icmp_seq=26 ttl=56 time=6.637 ms\n64 bytes from 8.8.8.8: icmp_seq=27 ttl=56 time=5.582 ms\n92 bytes from 192.168.0.1: Destination Net Unreachable\nVr HL TOS  Len   ID Flg  off TTL Pro  cks      Src      Dst\n 4  5  00 5400 8904   0 0000  40  01 2087 192.168.0.102  8.8.8.8 \n\nRequest timeout for icmp_seq 28\n92 bytes from 192.168.0.1: Destination Net Unreachable\nVr HL TOS  Len   ID Flg  off TTL Pro  cks      Src      Dst\n 4  5  00 5400 b0a6   0 0000  40  01 f8e4 192.168.0.102  8.8.8.8 \n\nRequest timeout for icmp_seq 29\n92 bytes from 192.168.0.1: Destination Net Unreachable\nVr HL TOS  Len   ID Flg  off TTL Pro  cks      Src      Dst\n 4  5  00 5400 23cd   0 0000  40  01 85be 192.168.0.102  8.8.8.8 \n\nRequest timeout for icmp_seq 30\n92 bytes from 192.168.0.1: Destination Net Unreachable\nVr HL TOS  Len   ID Flg  off TTL Pro  cks      Src      Dst\n 4  5  00 5400 6cb1   0 0000  40  01 3cda 192.168.0.102  8.8.8.8 \n\nRequest timeout for icmp_seq 31\nRequest timeout for icmp_seq 32\n92 bytes from 192.168.0.1: Redirect Host(New addr: 192.168.0.254)\nVr HL TOS  Len   ID Flg  off TTL Pro  cks      Src      Dst\n 4  5  00 0054 57b0   0 0000  3f  01 52db 192.168.0.102  8.8.8.8 \n\nRequest timeout for icmp_seq 33\n64 bytes from 8.8.8.8: icmp_seq=34 ttl=55 time=131.398 ms\n64 bytes from 8.8.8.8: icmp_seq=35 ttl=55 time=136.203 ms\n64 bytes from 8.8.8.8: icmp_seq=36 ttl=55 time=391.485 ms\n64 bytes from 8.8.8.8: icmp_seq=37 ttl=55 time=188.250 ms\n64 bytes from 8.8.8.8: icmp_seq=38 ttl=54 time=143.007 ms\n64 bytes from 8.8.8.8: icmp_seq=39 ttl=54 time=597.688 ms\n<\u7565>\n```\n\nsub \u7d4c\u7531\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```shell-session\ngimy@localhost ~ $ traceroute -n 8.8.8.8\ntraceroute to 8.8.8.8 (8.8.8.8), 64 hops max, 52 byte packets\n 1  192.168.0.2  2.949 ms  1.179 ms  1.152 ms\n<\u7565>\n    8.8.8.8  130.123 ms\n```\n\nsub \u306b 192.168.0.254 \u304c\u5272\u308a\u5f53\u305f\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```shell-session\npi@sub:~ $ ip -f inet addr show eth0\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    inet 192.168.0.2/24 brd 192.168.0.255 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet 192.168.0.254/24 brd 192.168.0.255 scope global secondary eth0\n       valid_lft forever preferred_ft forever\n```\n\nsub \u3067 SORACOM \u5074\u304c\u30c7\u30d5\u30a9\u30eb\u30c8 GW \u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```shell-session\ngimy@sub:~ $ ip route show\ndefault dev ppp0  scope link \n10.64.64.64 dev ppp0  proto kernel  scope link  src <SORACOM \u304b\u3089\u5272\u308a\u5f53\u3066\u3089\u308c\u305f\u30a2\u30c9\u30ec\u30b9>\n192.168.0.0/24 dev eth0  proto kernel  scope link  src 192.168.0.2 \n```\n\n## \u5207\u308a\u623b\u3057\n\nmain \u306e ppp \u63a5\u7d9a\u3092\u56de\u5fa9\u3055\u305b\u3001\u5207\u308a\u623b\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```shell-session\npi@main:~ $ sudo pon dsl-provider\nPlugin rp-pppoe.so loaded.\n```\n\n\u78ba\u8a8d\u5185\u5bb9\u306f\u901a\u5e38\u6642\u3068\u540c\u3058\u3067\u3059\u3002\n\n# \u611f\u60f3\n\ns1.fast \u3067\u3042\u3063\u3066\u3082 2Mbps \u306a\u306e\u3067\u3001 SORACOM Air \u5074\u306b failover \u3057\u305f\u72b6\u614b\u3067 LAN \u5185\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u6a5f\u304b\u3089 Web \u30d6\u30e9\u30a6\u30ba\u3059\u308b\u3068\u3084\u306f\u308a\u30b9\u30c8\u30ec\u30b9\u3092\u611f\u3058\u307e\u3059\u3002\u3057\u304b\u3057\u3001\u6708\u984d300\u5186\u7a0b\u5ea6\u3067\u4e88\u5099\u56de\u7dda\u3092\u7dad\u6301\u3067\u304d\u308b\u3068\u3044\u3046\u306e\u306f\u305d\u308c\u306a\u308a\u306b\u610f\u5473\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n# \u53c2\u8003\n\n[SORACOM SDK for Ruby](https://dev.soracom.io/jp/tools/)\n", "tags": ["SORACOM", "raspbian", "RaspberryPi", "keepalived"]}