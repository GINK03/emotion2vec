{"context": "CodeIgniter3\uff08\u4ee5\u4e0bCI3\uff09\u3067\u30a8\u30e9\u30fc\u30fb\u4f8b\u5916\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u306e\u51e6\u7406\u306e\u6d41\u308c\u306b\u3064\u3044\u3066\u3067\u3059\u3002\n\u5bfe\u8c61\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306fCodeIgniter3.0.6\u3001PHP\u306f5.6.22\u3067\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\n\nCodeIgniter\u306b\u304a\u3051\u308b\u30a8\u30e9\u30fc\u30fb\u4f8b\u5916\u767a\u751f\u6642\u306e\u4ed5\u7d44\u307f\u3002\n\u307e\u305a\u524d\u63d0\u3068\u3057\u3066PHP\u3067\u306fset_error_handler\u7b49\u3092\u4f7f\u3046\u3053\u3068\u306b\u3088\u308a\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30e9\u30fb\u4f8b\u5916\u30cf\u30f3\u30c9\u30e9\u3092\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u30de\u30cb\u30e5\u30a2\u30eb\u3002\nhttp://php.net/manual/ja/function.set-error-handler.php\n\u305d\u3057\u3066CI3\u306b\u304a\u3044\u3066\u306fCodeIgniter.php\u3067\u3053\u308c\u3089\u306e\u30cf\u30f3\u30c9\u30e9\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\nCodeIgniter.php\nset_error_handler('_error_handler');\nset_exception_handler('_exception_handler');\nregister_shutdown_function('_shutdown_handler');\n\n\n\u305d\u3057\u3066Common.php\u306b\u3053\u308c\u3089\u306e\u95a2\u6570\u306b\u5b9a\u7fa9\u304c\u3042\u308a\u307e\u3059\u3002\n\u57fa\u672c\u7684\u306b\u306fException\u30af\u30e9\u30b9\u3092\u30ed\u30fc\u30c9\u3057\u3066\u3001\u5bfe\u5fdc\u3057\u305f\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u3002\u5177\u4f53\u7684\u306a\u51e6\u7406\u306fException\u30af\u30e9\u30b9\u306b\u307e\u3068\u3081\u3089\u308c\u3066\u3044\u307e\u3059\u3002\n\nCommon.php\nif ( ! function_exists('_error_handler'))\n{\n    function _error_handler($severity, $message, $filepath, $line)\n    {\n        $is_error = (((E_ERROR | E_COMPILE_ERROR | E_CORE_ERROR | E_USER_ERROR) & $severity) === $severity);\n\n        if ($is_error)\n        {\n            set_status_header(500);\n        }\n\n        if (($severity & error_reporting()) !== $severity)\n        {\n            return;\n        }\n\n        $_error =& load_class('Exceptions', 'core');\n        $_error->log_exception($severity, $message, $filepath, $line);\n\n        if (str_ireplace(array('off', 'none', 'no', 'false', 'null'), '', ini_get('display_errors')))\n        {\n            $_error->show_php_error($severity, $message, $filepath, $line);\n        }\n\n        if ($is_error)\n        {\n            exit(1); // EXIT_ERROR\n        }\n    }\n}\n\nif ( ! function_exists('_exception_handler'))\n{\n    function _exception_handler($exception)\n    {\n        $_error =& load_class('Exceptions', 'core');\n        $_error->log_exception('error', 'Exception: '.$exception->getMessage(), $exception->getFile(), $exception->getLine());\n\n        if (str_ireplace(array('off', 'none', 'no', 'false', 'null'), '', ini_get('display_errors')))\n        {\n            $_error->show_exception($exception);\n        }\n\n        exit(1); // EXIT_ERROR\n    }\n}\n\nif ( ! function_exists('_shutdown_handler'))\n{\n    function _shutdown_handler()\n    {\n        $last_error = error_get_last();\n        if (isset($last_error) &&\n            ($last_error['type'] & (E_ERROR | E_PARSE | E_CORE_ERROR | E_CORE_WARNING | E_COMPILE_ERROR | E_COMPILE_WARNING)))\n        {\n            _error_handler($last_error['type'], $last_error['message'], $last_error['file'], $last_error['line']);\n        }\n    }\n}\n\n\n\u305d\u3057\u3066Exception.php\u306b\u5b9f\u969b\u306e\u51e6\u7406\u304c\u66f8\u304b\u308c\u3066\u3044\u307e\u3059\u3002\n\u3053\u3053\u3067\u30d3\u30e5\u30fc\u304c\u8aad\u307f\u8fbc\u307e\u308c\u3001\u753b\u9762\u306b\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u8868\u793a\u3055\u308c\u308b\u5f62\u3067\u3059\u3002\n\nException.php\n    public function show_exception($exception)\n    {\n        $templates_path = config_item('error_views_path');\n        if (empty($templates_path))\n        {\n            $templates_path = VIEWPATH.'errors'.DIRECTORY_SEPARATOR;\n        }\n\n        $message = $exception->getMessage();\n        if (empty($message))\n        {\n            $message = '(null)';\n        }\n\n        if (is_cli())\n        {\n            $templates_path .= 'cli'.DIRECTORY_SEPARATOR;\n        }\n        else\n        {\n            set_status_header(500);\n            $templates_path .= 'html'.DIRECTORY_SEPARATOR;\n        }\n\n        if (ob_get_level() > $this->ob_level + 1)\n        {\n            ob_end_flush();\n        }\n\n        ob_start();\n        include($templates_path.'error_exception.php');\n        $buffer = ob_get_contents();\n        ob_end_clean();\n        echo $buffer;\n    }\n\n    public function show_php_error($severity, $message, $filepath, $line)\n    {\n        $templates_path = config_item('error_views_path');\n        if (empty($templates_path))\n        {\n            $templates_path = VIEWPATH.'errors'.DIRECTORY_SEPARATOR;\n        }\n\n        $severity = isset($this->levels[$severity]) ? $this->levels[$severity] : $severity;\n\n        // For safety reasons we don't show the full file path in non-CLI requests\n        if ( ! is_cli())\n        {\n            $filepath = str_replace('\\\\', '/', $filepath);\n            if (FALSE !== strpos($filepath, '/'))\n            {\n                $x = explode('/', $filepath);\n                $filepath = $x[count($x)-2].'/'.end($x);\n            }\n\n            $template = 'html'.DIRECTORY_SEPARATOR.'error_php';\n        }\n        else\n        {\n            $template = 'cli'.DIRECTORY_SEPARATOR.'error_php';\n        }\n\n        if (ob_get_level() > $this->ob_level + 1)\n        {\n            ob_end_flush();\n        }\n        ob_start();\n        include($templates_path.$template.'.php');\n        $buffer = ob_get_contents();\n        ob_end_clean();\n        echo $buffer;\n    }\n\n\n\n\u753b\u9762\u30a4\u30e1\u30fc\u30b8\nException\u3067\u547c\u3073\u51fa\u3055\u308c\u305f\u30e1\u30bd\u30c3\u30c9\u306b\u5fdc\u3058\u3066\u3001\u5b9f\u969b\u306b\u8868\u793a\u3055\u308c\u308b\u753b\u9762\u30a4\u30e1\u30fc\u30b8\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u5b9f\u884c\u3057\u305f\u30b3\u30fc\u30c9\u306f\u3053\u3061\u3089\u3002\n\ncontrollers/sample.php\n<?php\nclass Sample extends CI_Controller {\n\n    public function normal()\n    {\n        $this->load->view('view');\n    }\n\n    public function exception()\n    {\n        throw new Exception(\"\u4f8b\u5916\u767a\u751f\uff01\");\n        $this->load->view('view');\n    }\n\n    public function php_error()\n    {\n        throw new Exceptio();  //typo\n        $this->load->view('view');\n    }\n\n    public function error()\n    {\n        show_error(\"\u30a8\u30e9\u30fc\u8868\u793a\u95a2\u6570\u3092\u547c\u3093\u3060\");\n        $this->load->view('view');\n    }\n}\n?>\n\n\n\nviews/view.php\n<html>\n<head>\n<title>\u30bf\u30a4\u30c8\u30eb</title>\n</head>\n<body>\n    <h1>\u6b63\u5e38\u306b\u8868\u793a\u3055\u308c\u307e\u3057\u305f</h1>\n</body>\n</html>\n\n\n\u4e0a\u8a18\u3092\u305d\u308c\u305e\u308c\u5b9f\u884c\u3057\u305f\u753b\u9762\u306e\u30ad\u30e3\u30d7\u30c1\u30e3\u304c\u3053\u3061\u3089\u3002\n\u30a8\u30e9\u30fc\u306b\u95a2\u3057\u3066\u306f\u3001PHP\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u6642\u306e\u753b\u9762\u8868\u793a\u3068\u305d\u3046\u5927\u304d\u304f\u5909\u308f\u3089\u306a\u3044\u3067\u3059\u306d\u3002\n\nnormal\n\n\nexception\n\n\nphp_error\n\n\nerror(\u53c2\u8003)\n\n\n\u30ab\u30b9\u30bf\u30e0\u3059\u308b\u306b\u306f\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306eException.php\u3092\u7d99\u627f\u3057\u3066\u3001\u5bfe\u8c61\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3059\u308b\u3053\u3068\u3067\u4efb\u610f\u306e\u30a8\u30e9\u30fc\u30da\u30fc\u30b8\u306b\u9077\u79fb\u3055\u305b\u305f\u308a\u3001\u72ec\u81ea\u306e\u30ed\u30b0\u51fa\u529b\u306a\u3069\u5171\u901a\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\n\u3053\u308c\u306eExceptions\u3092\u7d99\u627f\u3059\u308b\u5f62\u3067\u3059\u3002\nhttp://www.codeigniter.com/user_guide/general/core_classes.html\n\u4ee5\u4e0a\u3002\n\nCodeIgniter3\uff08\u4ee5\u4e0bCI3\uff09\u3067\u30a8\u30e9\u30fc\u30fb\u4f8b\u5916\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u306e\u51e6\u7406\u306e\u6d41\u308c\u306b\u3064\u3044\u3066\u3067\u3059\u3002\n\n\u5bfe\u8c61\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306fCodeIgniter3.0.6\u3001PHP\u306f5.6.22\u3067\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\n\n\n## CodeIgniter\u306b\u304a\u3051\u308b\u30a8\u30e9\u30fc\u30fb\u4f8b\u5916\u767a\u751f\u6642\u306e\u4ed5\u7d44\u307f\u3002\n\n\u307e\u305a\u524d\u63d0\u3068\u3057\u3066PHP\u3067\u306fset_error_handler\u7b49\u3092\u4f7f\u3046\u3053\u3068\u306b\u3088\u308a\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30e9\u30fb\u4f8b\u5916\u30cf\u30f3\u30c9\u30e9\u3092\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30de\u30cb\u30e5\u30a2\u30eb\u3002\nhttp://php.net/manual/ja/function.set-error-handler.php\n\n\u305d\u3057\u3066CI3\u306b\u304a\u3044\u3066\u306fCodeIgniter.php\u3067\u3053\u308c\u3089\u306e\u30cf\u30f3\u30c9\u30e9\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n```CodeIgniter.php\nset_error_handler('_error_handler');\nset_exception_handler('_exception_handler');\nregister_shutdown_function('_shutdown_handler');\n```\n\n\u305d\u3057\u3066Common.php\u306b\u3053\u308c\u3089\u306e\u95a2\u6570\u306b\u5b9a\u7fa9\u304c\u3042\u308a\u307e\u3059\u3002\n\u57fa\u672c\u7684\u306b\u306fException\u30af\u30e9\u30b9\u3092\u30ed\u30fc\u30c9\u3057\u3066\u3001\u5bfe\u5fdc\u3057\u305f\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u3002\u5177\u4f53\u7684\u306a\u51e6\u7406\u306fException\u30af\u30e9\u30b9\u306b\u307e\u3068\u3081\u3089\u308c\u3066\u3044\u307e\u3059\u3002\n\n```Common.php\nif ( ! function_exists('_error_handler'))\n{\n\tfunction _error_handler($severity, $message, $filepath, $line)\n\t{\n\t\t$is_error = (((E_ERROR | E_COMPILE_ERROR | E_CORE_ERROR | E_USER_ERROR) & $severity) === $severity);\n\n\t\tif ($is_error)\n\t\t{\n\t\t\tset_status_header(500);\n\t\t}\n\n\t\tif (($severity & error_reporting()) !== $severity)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t$_error =& load_class('Exceptions', 'core');\n\t\t$_error->log_exception($severity, $message, $filepath, $line);\n\n\t\tif (str_ireplace(array('off', 'none', 'no', 'false', 'null'), '', ini_get('display_errors')))\n\t\t{\n\t\t\t$_error->show_php_error($severity, $message, $filepath, $line);\n\t\t}\n\n\t\tif ($is_error)\n\t\t{\n\t\t\texit(1); // EXIT_ERROR\n\t\t}\n\t}\n}\n\nif ( ! function_exists('_exception_handler'))\n{\n\tfunction _exception_handler($exception)\n\t{\n\t\t$_error =& load_class('Exceptions', 'core');\n\t\t$_error->log_exception('error', 'Exception: '.$exception->getMessage(), $exception->getFile(), $exception->getLine());\n\n\t\tif (str_ireplace(array('off', 'none', 'no', 'false', 'null'), '', ini_get('display_errors')))\n\t\t{\n\t\t\t$_error->show_exception($exception);\n\t\t}\n\n\t\texit(1); // EXIT_ERROR\n\t}\n}\n\nif ( ! function_exists('_shutdown_handler'))\n{\n\tfunction _shutdown_handler()\n\t{\n\t\t$last_error = error_get_last();\n\t\tif (isset($last_error) &&\n\t\t\t($last_error['type'] & (E_ERROR | E_PARSE | E_CORE_ERROR | E_CORE_WARNING | E_COMPILE_ERROR | E_COMPILE_WARNING)))\n\t\t{\n\t\t\t_error_handler($last_error['type'], $last_error['message'], $last_error['file'], $last_error['line']);\n\t\t}\n\t}\n}\n```\n\n\u305d\u3057\u3066Exception.php\u306b\u5b9f\u969b\u306e\u51e6\u7406\u304c\u66f8\u304b\u308c\u3066\u3044\u307e\u3059\u3002\n\u3053\u3053\u3067\u30d3\u30e5\u30fc\u304c\u8aad\u307f\u8fbc\u307e\u308c\u3001\u753b\u9762\u306b\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u8868\u793a\u3055\u308c\u308b\u5f62\u3067\u3059\u3002\n\n```Exception.php\n\tpublic function show_exception($exception)\n\t{\n\t\t$templates_path = config_item('error_views_path');\n\t\tif (empty($templates_path))\n\t\t{\n\t\t\t$templates_path = VIEWPATH.'errors'.DIRECTORY_SEPARATOR;\n\t\t}\n\n\t\t$message = $exception->getMessage();\n\t\tif (empty($message))\n\t\t{\n\t\t\t$message = '(null)';\n\t\t}\n\n\t\tif (is_cli())\n\t\t{\n\t\t\t$templates_path .= 'cli'.DIRECTORY_SEPARATOR;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tset_status_header(500);\n\t\t\t$templates_path .= 'html'.DIRECTORY_SEPARATOR;\n\t\t}\n\n\t\tif (ob_get_level() > $this->ob_level + 1)\n\t\t{\n\t\t\tob_end_flush();\n\t\t}\n\n\t\tob_start();\n\t\tinclude($templates_path.'error_exception.php');\n\t\t$buffer = ob_get_contents();\n\t\tob_end_clean();\n\t\techo $buffer;\n\t}\n\n\tpublic function show_php_error($severity, $message, $filepath, $line)\n\t{\n\t\t$templates_path = config_item('error_views_path');\n\t\tif (empty($templates_path))\n\t\t{\n\t\t\t$templates_path = VIEWPATH.'errors'.DIRECTORY_SEPARATOR;\n\t\t}\n\n\t\t$severity = isset($this->levels[$severity]) ? $this->levels[$severity] : $severity;\n\n\t\t// For safety reasons we don't show the full file path in non-CLI requests\n\t\tif ( ! is_cli())\n\t\t{\n\t\t\t$filepath = str_replace('\\\\', '/', $filepath);\n\t\t\tif (FALSE !== strpos($filepath, '/'))\n\t\t\t{\n\t\t\t\t$x = explode('/', $filepath);\n\t\t\t\t$filepath = $x[count($x)-2].'/'.end($x);\n\t\t\t}\n\n\t\t\t$template = 'html'.DIRECTORY_SEPARATOR.'error_php';\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$template = 'cli'.DIRECTORY_SEPARATOR.'error_php';\n\t\t}\n\n\t\tif (ob_get_level() > $this->ob_level + 1)\n\t\t{\n\t\t\tob_end_flush();\n\t\t}\n\t\tob_start();\n\t\tinclude($templates_path.$template.'.php');\n\t\t$buffer = ob_get_contents();\n\t\tob_end_clean();\n\t\techo $buffer;\n\t}\n```\n\n\n\n\n## \u753b\u9762\u30a4\u30e1\u30fc\u30b8\n\nException\u3067\u547c\u3073\u51fa\u3055\u308c\u305f\u30e1\u30bd\u30c3\u30c9\u306b\u5fdc\u3058\u3066\u3001\u5b9f\u969b\u306b\u8868\u793a\u3055\u308c\u308b\u753b\u9762\u30a4\u30e1\u30fc\u30b8\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u5b9f\u884c\u3057\u305f\u30b3\u30fc\u30c9\u306f\u3053\u3061\u3089\u3002\n\n```controllers/sample.php \n<?php\nclass Sample extends CI_Controller {\n\n    public function normal()\n    {\n        $this->load->view('view');\n    }\n\n    public function exception()\n    {\n        throw new Exception(\"\u4f8b\u5916\u767a\u751f\uff01\");\n        $this->load->view('view');\n    }\n\n    public function php_error()\n    {\n        throw new Exceptio();  //typo\n        $this->load->view('view');\n    }\n\n    public function error()\n    {\n        show_error(\"\u30a8\u30e9\u30fc\u8868\u793a\u95a2\u6570\u3092\u547c\u3093\u3060\");\n        $this->load->view('view');\n    }\n}\n?>\n```\n\n```views/view.php \n<html>\n<head>\n<title>\u30bf\u30a4\u30c8\u30eb</title>\n</head>\n<body>\n    <h1>\u6b63\u5e38\u306b\u8868\u793a\u3055\u308c\u307e\u3057\u305f</h1>\n</body>\n</html>\n```\n\n\u4e0a\u8a18\u3092\u305d\u308c\u305e\u308c\u5b9f\u884c\u3057\u305f\u753b\u9762\u306e\u30ad\u30e3\u30d7\u30c1\u30e3\u304c\u3053\u3061\u3089\u3002\n\u30a8\u30e9\u30fc\u306b\u95a2\u3057\u3066\u306f\u3001PHP\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u6642\u306e\u753b\u9762\u8868\u793a\u3068\u305d\u3046\u5927\u304d\u304f\u5909\u308f\u3089\u306a\u3044\u3067\u3059\u306d\u3002\n\n### normal\n![normal.png](https://qiita-image-store.s3.amazonaws.com/0/62574/557d87ca-2835-383a-357e-fd47490ceba3.png)\n\n### exception\n![exception.png](https://qiita-image-store.s3.amazonaws.com/0/62574/c61a9b60-7b27-fa7d-8065-a330eca4f15f.png)\n\n\n### php_error\n![php_error.png](https://qiita-image-store.s3.amazonaws.com/0/62574/1380b04a-c3a9-3292-8d3f-a23eb0db889f.png)\n\n\n### error(\u53c2\u8003)\n![error.png](https://qiita-image-store.s3.amazonaws.com/0/62574/177b6bb3-376b-2cab-b425-d7b09d0d296e.png)\n\n\n## \u30ab\u30b9\u30bf\u30e0\u3059\u308b\u306b\u306f\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306eException.php\u3092\u7d99\u627f\u3057\u3066\u3001\u5bfe\u8c61\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3059\u308b\u3053\u3068\u3067\u4efb\u610f\u306e\u30a8\u30e9\u30fc\u30da\u30fc\u30b8\u306b\u9077\u79fb\u3055\u305b\u305f\u308a\u3001\u72ec\u81ea\u306e\u30ed\u30b0\u51fa\u529b\u306a\u3069\u5171\u901a\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n\u3053\u308c\u306eExceptions\u3092\u7d99\u627f\u3059\u308b\u5f62\u3067\u3059\u3002\nhttp://www.codeigniter.com/user_guide/general/core_classes.html\n\n\u4ee5\u4e0a\u3002\n\n", "tags": ["PHP", "CodeIgniter"]}