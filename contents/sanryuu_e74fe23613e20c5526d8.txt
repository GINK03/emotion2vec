{"context": " More than 1 year has passed since last update.\n\n\u6982\u8981\nCarrierwave\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306f\u3001\u753b\u50cf\u306e\u51e6\u7406\u3068scaffold\u304c\u591a\u3044\u306e\u3067\u81ea\u529b\u3067\u30a2\u30c3\u30d7\u30ed\u30fc\u30c0\u3092\u4f5c\u3063\u3066\u307f\u308b\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\n\u6700\u4f4e\u9650Rails\u304c\u52d5\u304f\u72b6\u614b\u304b\u3089\u30b9\u30bf\u30fc\u30c8\u3059\u308b\u3053\u3068\u3092\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u5b9f\u88c5\u624b\u9806\n\n\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u6e96\u5099\u3059\u308b\nGemfile\u306b\u4ee5\u4e0b\u306e\u884c\u3092\u8ffd\u52a0\ngem 'carrierwave'\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nbundle install\n\n\n\u30e2\u30c7\u30eb\u3092\u6e96\u5099\u3059\u308b\ncarrierwave\u306euploader\u3092\u751f\u6210\u3059\u308b\nrails generate uploader UploadFile\n\nuploader\u306e\u7d30\u304b\u3044\u8a2d\u5b9a\u3092\u884c\u3044\u305f\u3044\u5834\u5408\u306b\u306f\u3001 /app/uploaders/upload_file_uploader.rb \u3092\u5909\u66f4\u3059\u308b\u3002\n\u30b3\u30de\u30f3\u30c9\u3067\u30d5\u30a1\u30a4\u30eb\u3092\u6271\u3046\u305f\u3081\u306e\u30e2\u30c7\u30eb\u3092\u4f5c\u6210\nrails generate model UploadFile name:string file:string\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067DB\u3092\u751f\u6210\nrake db:migrate\n\n\u751f\u6210\u3057\u305f\u30e2\u30c7\u30eb\u306b\u3001mount_uploader\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\u3053\u306e\u3068\u304d\u306b\u8ffd\u52a0\u3059\u308b\u306e\u306f\u3001rails generate uploader\u3067\u751f\u6210\u3057\u305fUploadFile\u306a\u306e\u3067\u3001\n\u672b\u5c3e\u306bUploader\u3092\u8ffd\u52a0\u3057\u3066\u3001UploadFileUploader\u306b\u306a\u308b\u3002\n\n/app/models/upload_file.rb\nclass UploadFile < ActiveRecord::Base\n+  mount_uploader :file, UploadFileUploader\nend\n\n\n\u3053\u308c\u3067\u30e2\u30c7\u30eb\u306b\u95a2\u3059\u308b\u90e8\u5206\u306f\u5b8c\u6210\u3002\n\nUI\u304b\u3089\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u305f\u3081\u306eWeb\u306e\u51e6\u7406\u3092\u4f5c\u6210\u3059\u308b\n\u5f8c\u304b\u3089\u4f7f\u3046download\u3084index\u3082\u540c\u6642\u306b\u751f\u6210\u3057\u3066\u304a\u304f\nrails generate controller uploader index form upload download\n\n\u30d5\u30a9\u30fc\u30e0\u3092\u7528\u610f\u3059\u308b\n\n/app/views/uploader/form.html.erb\n    <% @upload = UploadFile.new %>\n    <%= form_for @upload, :url => {:action => :upload} do |f| %>\n      <%= f.label :name, \"name\" %>\n      <%= f.text_field :name %>\n      <%= f.label :file %>\n      <%= f.file_field :file %>\n      <%= f.submit \"Upload\" %>\n    <% end %>\n\n\n\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306e\u751f\u6210\u6642\u306b\u81ea\u52d5\u7684\u306b\u751f\u6210\u3055\u308c\u305froutes.rb\u304cPOST\u3092\u53d7\u3051\u53d6\u308b\u3088\u3046\u306b\u624b\u76f4\u3057\u3059\u308b\u3002\n\n/config/routes.rb\n+  post 'uploader/upload'\n-  get 'uploader/upload'\n\n\n\u30d5\u30a1\u30a4\u30eb\u3092\u4fdd\u5b58\u3057\u3066index\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3059\u308b\u51e6\u7406\u3092\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306b\u8ffd\u52a0\n\n/app/controllers/uploader_controller.rb\n  def upload\n    @upload_file = UploadFile.new( params.require(:upload_file).permit(:name, :file) )\n    @upload_file.save\n    redirect_to action: 'index'\n  end\n\n\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u3092\u898b\u308c\u308b\u3088\u3046\u306b\u3059\u308b\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u4e00\u89a7\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n/app/views/uploader/index.html.erb\n    <%= link_to '\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306f\u3053\u3061\u3089', action: \"form\" %>\n    <ul>\n      <% UploadFile.all.reverse_order.each do |upload| %>\n        <li><%= link_to upload.name, action: \"download\", id: upload.id %>\n      <% end %>\n    </ul>\n\n\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306b\u306fRails\u306edownload\u7528\u306e\u30e1\u30bd\u30c3\u30c9send_file\u3092\u4f7f\u3046\nuploder\u306ecurrent_path\u3092\u6307\u5b9a\u3057\u3066\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n\n/app/controllers/uploader_controller.rb\n  def download\n+    @upload_file = UploadFile.find(params[:id].to_i)\n+    filepath = @upload_file.file.current_path\n+    stat = File::stat(filepath)\n+    send_file(filepath, :filename => @upload_file.file.url.gsub(/.*\\//,''), :length => stat.size)\n  end\n\n\n\u30c7\u30fc\u30bf\u30921\u3064\u4ee5\u4e0a\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u5f8c\u306bRails Console\u3092\u4f7f\u3063\u3066\u898b\u3066\u307f\u308b\u3068\u3001\n\u30e2\u30c7\u30eb\u306e\u4e2d\u304c\u3069\u3093\u306a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u304b\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\nrails console\n> UploadFile\n#=> UploadFile(id: integer, name: string, file: string, created_at: datetime, updated_at: datetime)\n\n> UploadFile.first.file.class\n#=> UploadFileUploader\n\n> ploadFile.first.file\n#=> #<UploadFileUploader:0x007fb75c6fc3e8 @model=#<UploadFile id: 1, name: \"hoge\", file: \"hoge.pdf\", created_at: \"2015-04-12 17:40:45\", updated_at: \"2015-04-12 17:40:45\">, @mounted_as=:file, @storage=#<CarrierWave::Storage::File:0x007fb75c6fc118 @uploader=#<UploadFileUploader:0x007fb75c6fc3e8 ...>>, @file=#<CarrierWave::SanitizedFile:0x007fb75ba16ca0 @file=\"/Users/user_name/app_name/public/uploads/upload_file/file/1/hoge.pdf\", @original_filename=nil, @content_type=nil>, @versions={}>\n\n\n\n\u53c2\u8003\u6587\u732e\n\n carrierwaveuploader/carrierwave\n\n Rails\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308bgem\u306eCarrierWave\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5 -\nRails\nWebook\n\n\n\n\u30e9\u30a4\u30bb\u30f3\u30b9\n\u3053\u3061\u3089\u306e\u30b3\u30fc\u30c9\u306fMIT\u30e9\u30a4\u30bb\u30f3\u30b9\u3067\u3059\u3002\n\u6982\u8981\n====\n\nCarrierwave\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306f\u3001\u753b\u50cf\u306e\u51e6\u7406\u3068scaffold\u304c\u591a\u3044\u306e\u3067\u81ea\u529b\u3067\u30a2\u30c3\u30d7\u30ed\u30fc\u30c0\u3092\u4f5c\u3063\u3066\u307f\u308b\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\n\u6700\u4f4e\u9650Rails\u304c\u52d5\u304f\u72b6\u614b\u304b\u3089\u30b9\u30bf\u30fc\u30c8\u3059\u308b\u3053\u3068\u3092\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u5b9f\u88c5\u624b\u9806\n========\n\n\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u6e96\u5099\u3059\u308b\n--------------------\n\nGemfile\u306b\u4ee5\u4e0b\u306e\u884c\u3092\u8ffd\u52a0\n\n``` {.ruby}\ngem 'carrierwave'\n```\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n``` {.ruby}\nbundle install\n```\n\n\u30e2\u30c7\u30eb\u3092\u6e96\u5099\u3059\u308b\n----------------\n\ncarrierwave\u306euploader\u3092\u751f\u6210\u3059\u308b\n\n``` {.bash}\nrails generate uploader UploadFile\n```\n\nuploader\u306e\u7d30\u304b\u3044\u8a2d\u5b9a\u3092\u884c\u3044\u305f\u3044\u5834\u5408\u306b\u306f\u3001 ```/app/uploaders/upload_file_uploader.rb``` \u3092\u5909\u66f4\u3059\u308b\u3002\n\n\n\u30b3\u30de\u30f3\u30c9\u3067\u30d5\u30a1\u30a4\u30eb\u3092\u6271\u3046\u305f\u3081\u306e\u30e2\u30c7\u30eb\u3092\u4f5c\u6210\n\n``` {.bash}\nrails generate model UploadFile name:string file:string\n```\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067DB\u3092\u751f\u6210\n\n``` {.bash}\nrake db:migrate\n```\n\n\u751f\u6210\u3057\u305f\u30e2\u30c7\u30eb\u306b\u3001mount_uploader\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\u3053\u306e\u3068\u304d\u306b\u8ffd\u52a0\u3059\u308b\u306e\u306f\u3001```rails generate uploader```\u3067\u751f\u6210\u3057\u305fUploadFile\u306a\u306e\u3067\u3001\n\u672b\u5c3e\u306b```Uploader```\u3092\u8ffd\u52a0\u3057\u3066\u3001```UploadFileUploader```\u306b\u306a\u308b\u3002\n\n``` {.diff:/app/models/upload_file.rb}\nclass UploadFile < ActiveRecord::Base\n+  mount_uploader :file, UploadFileUploader\nend\n```\n\u3053\u308c\u3067\u30e2\u30c7\u30eb\u306b\u95a2\u3059\u308b\u90e8\u5206\u306f\u5b8c\u6210\u3002\n\nUI\u304b\u3089\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n----------------------------------\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u305f\u3081\u306eWeb\u306e\u51e6\u7406\u3092\u4f5c\u6210\u3059\u308b\n\n\u5f8c\u304b\u3089\u4f7f\u3046download\u3084index\u3082\u540c\u6642\u306b\u751f\u6210\u3057\u3066\u304a\u304f\n\n``` {.bash}\nrails generate controller uploader index form upload download\n```\n\n\u30d5\u30a9\u30fc\u30e0\u3092\u7528\u610f\u3059\u308b\n\n``` {.erb:/app/views/uploader/form.html.erb}\n    <% @upload = UploadFile.new %>\n    <%= form_for @upload, :url => {:action => :upload} do |f| %>\n      <%= f.label :name, \"name\" %>\n      <%= f.text_field :name %>\n      <%= f.label :file %>\n      <%= f.file_field :file %>\n      <%= f.submit \"Upload\" %>\n    <% end %>\n```\n\n\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306e\u751f\u6210\u6642\u306b\u81ea\u52d5\u7684\u306b\u751f\u6210\u3055\u308c\u305froutes.rb\u304cPOST\u3092\u53d7\u3051\u53d6\u308b\u3088\u3046\u306b\u624b\u76f4\u3057\u3059\u308b\u3002\n\n``` {.diff:/config/routes.rb}\n+  post 'uploader/upload'\n-  get 'uploader/upload'\n```\n\n\u30d5\u30a1\u30a4\u30eb\u3092\u4fdd\u5b58\u3057\u3066index\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3059\u308b\u51e6\u7406\u3092\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306b\u8ffd\u52a0\n\n``` {.ruby:/app/controllers/uploader_controller.rb}\n  def upload\n    @upload_file = UploadFile.new( params.require(:upload_file).permit(:name, :file) )\n    @upload_file.save\n    redirect_to action: 'index'\n  end\n```\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u3092\u898b\u308c\u308b\u3088\u3046\u306b\u3059\u308b\n----------------------------------------------\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u4e00\u89a7\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n``` {.erb:/app/views/uploader/index.html.erb}\n    <%= link_to '\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306f\u3053\u3061\u3089', action: \"form\" %>\n    <ul>\n      <% UploadFile.all.reverse_order.each do |upload| %>\n        <li><%= link_to upload.name, action: \"download\", id: upload.id %>\n      <% end %>\n    </ul>\n```\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n----------------------------\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306b\u306fRails\u306edownload\u7528\u306e\u30e1\u30bd\u30c3\u30c9[send_file](http://railsdoc.com/references/send_file)\u3092\u4f7f\u3046\nuploder\u306ecurrent_path\u3092\u6307\u5b9a\u3057\u3066\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n\n``` {.diff:/app/controllers/uploader_controller.rb}\n  def download\n+    @upload_file = UploadFile.find(params[:id].to_i)\n+    filepath = @upload_file.file.current_path\n+    stat = File::stat(filepath)\n+    send_file(filepath, :filename => @upload_file.file.url.gsub(/.*\\//,''), :length => stat.size)\n  end\n```\n\n\u30c7\u30fc\u30bf\u30921\u3064\u4ee5\u4e0a\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u5f8c\u306bRails Console\u3092\u4f7f\u3063\u3066\u898b\u3066\u307f\u308b\u3068\u3001\n\u30e2\u30c7\u30eb\u306e\u4e2d\u304c\u3069\u3093\u306a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u304b\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n``` {.ruby:rails console}\n> UploadFile\n#=> UploadFile(id: integer, name: string, file: string, created_at: datetime, updated_at: datetime)\n\n> UploadFile.first.file.class\n#=> UploadFileUploader\n\n> ploadFile.first.file\n#=> #<UploadFileUploader:0x007fb75c6fc3e8 @model=#<UploadFile id: 1, name: \"hoge\", file: \"hoge.pdf\", created_at: \"2015-04-12 17:40:45\", updated_at: \"2015-04-12 17:40:45\">, @mounted_as=:file, @storage=#<CarrierWave::Storage::File:0x007fb75c6fc118 @uploader=#<UploadFileUploader:0x007fb75c6fc3e8 ...>>, @file=#<CarrierWave::SanitizedFile:0x007fb75ba16ca0 @file=\"/Users/user_name/app_name/public/uploads/upload_file/file/1/hoge.pdf\", @original_filename=nil, @content_type=nil>, @versions={}>\n```\n\n\u53c2\u8003\u6587\u732e\n========\n\n-   [carrierwaveuploader/carrierwave](https://github.com/carrierwaveuploader/carrierwave)\n-   [Rails\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308bgem\u306eCarrierWave\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5 -\n    Rails\n    Webook](http://ruby-rails.hatenadiary.com/entry/20141015/1413300088)\n\n\u30e9\u30a4\u30bb\u30f3\u30b9\n========\n\n\u3053\u3061\u3089\u306e\u30b3\u30fc\u30c9\u306fMIT\u30e9\u30a4\u30bb\u30f3\u30b9\u3067\u3059\u3002\n", "tags": ["Ruby2.0", "Rails44.1.6", "carrierwave0.10.0"]}