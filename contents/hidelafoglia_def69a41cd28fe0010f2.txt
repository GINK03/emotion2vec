{"context": " More than 1 year has passed since last update.\n\nWordpress\u3067\u3081\u3093\u3069\u304f\u3055\u3044\u696d\u52d9\u51e6\u7406\u3057\u305f\u304f\u306a\u3044\n\nPHP\u306a\u3089\u3073\u306bWordpress\u30d7\u30e9\u30b0\u30a4\u30f3\u3081\u3093\u3069\u304f\u3055\u3044\n\u696d\u52d9\u51e6\u7406\u306f\u5225\u9014\u30e1\u30b8\u30e3\u30fc\u306aWeb\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u4f7f\u3063\u305f\u30a2\u30d7\u30ea\u3067\u3084\u308a\u305f\u3044\n\u8a8d\u8a3c\u306e\u9023\u643a\u306f\u306a\u3093\u3068\u304b\u3057\u305f\u3044\n\n\n\u65b9\u91dd\n\nCookie\u5171\u6709\u30b5\u30a4\u30c8(nginx\u3068\u304b\u3067\u30db\u30b9\u30c8)\u306bWordpress\u3068\u30a2\u30d7\u30ea(Django\u3068\u304b)\u5171\u6709\u3055\u305b\u308b\n\u30a2\u30d7\u30ea\u5074\u3067Wordpress\u306e\u30e6\u30fc\u30b6\u30fc\u306e\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3092\u884c\u3046(wp_users)\nWordpress\u3068\u30a2\u30d7\u30ea\u3067Cookie\u3067\u5171\u6709\u30c7\u30fc\u30bf\u3092\u6e21\u3059\n\n\n\u30a2\u30d7\u30ea\u5074(Django)\n\nWordpress\u306eMySQL\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n\nsettings.DATABASES\u306b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u8ffd\u52a0\u3057\u3066\u3001 settings. DATABASE_ROUTERS \u3067\u30e2\u30c7\u30eb\u3068\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u9023\u643a\u3092\u5b9a\u7fa9\u3059\u308b (settings, DatabaseRouter)\ninspectdb \u3057\u3066\u30e2\u30c7\u30eb\u30af\u30e9\u30b9\u3092\u7528\u610f\u3059\u308b\n\n\n\n\u30e6\u30fc\u30b6\u30fc\u8ffd\u52a0, \u524a\u9664\u3067 wp_users\u3092\u64cd\u4f5c\u3059\u308b\n\n\nfrom django.db.models.signals import post_save, post_delete \u306e\u30b7\u30b0\u30ca\u30eb\u30cf\u30f3\u30c9\u30e9\u3092\u5b9a\u7fa9\u3057\u3066\u3001 WpUsers\u30e2\u30c7\u30eb(wp_users\u30c6\u30fc\u30d6\u30eb) \u306e\u8ffd\u52a0\u66f4\u65b0/\u524a\u9664\u3059\u308b (signals.py)\n\n\n\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u6642\u306b\u5171\u6709Cookie\u30c7\u30fc\u30bf\u3092\u8a2d\u5b9a\u3059\u308b\n\n\nfrom django.contrib.auth.signals import user_logged_in \u306e\u30b7\u30b0\u30ca\u30eb\u30cf\u30f3\u30c9\u30e9\u3067\u5171\u6709Cookie\u30c7\u30fc\u30bf\u3092\u7528\u610f\u3059\u308b\n\u4eca\u56de\u306f {{ wp_users.ID }}:{{ sha256(django_session_key + wp_users.id + shared_secret)}} \u3068\u3044\u3046\u6587\u5b57\u5217\u306b\u3057\u3066\u30bb\u30c3\u30b7\u30e7\u30f3\u30c7\u30fc\u30bf\u306b\u4fdd\u5b58(signals.py)\nHTTP\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u8fd4\u3059\u6642\u306bWP_USER\u3068\u3044\u3046Cookie\u306b\u30bb\u30c3\u30c8(middleware.py)\n\n\nWordpress\u5074(wp-authmod\u30d7\u30e9\u30b0\u30a4\u30f3)\n\n Django\u304c\u30bb\u30c3\u30c8\u3057\u305f sessionid\u3068 WP_USER\u3067\u30ed\u30b0\u30a4\u30f3/\u30ed\u30b0\u30a2\u30a6\u30c8\u306e\u51e6\u7406\u3092\u3059\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5b9f\u88c5\u3057\u3066\u307f\u305f(wp-authmod)\nWordpress\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u3088\u304f\u308f\u304b\u3089\u306a\u3044\n\n\nsend_headers \u30a2\u30af\u30b7\u30e7\u30f3\u3067\u51e6\u7406\n\nWordpress\u304c\u4f55\u304b\u3057\u304b\u30b9\u30c8\u30ea\u30fc\u30e0\u306b\u66f8\u3044\u3066\u3057\u307e\u3046\u3068\u3001Set-Cookie\u306a\u3069\u30d8\u30c3\u30c0\u30fc\u306e\u51e6\u7406\u3059\u308b\u3068Warning\u3067\u308b\u306e\u3067\u3001send_headers\u30a2\u30af\u30b7\u30e7\u30f3\u3067\u5f37\u5236\u30ed\u30b0\u30a4\u30f3/\u30ed\u30b0\u30a2\u30a6\u30c8\u51e6\u7406\u3092\u3084\u308b\u306e\u304c\u3044\u3044\u306e\u304b(\u3088\u304f\u308f\u304b\u3089\u306a\u3044)(Authmod/App.php)\n\u5358\u7d14\u306bCookie\u30c7\u30fc\u30bf\u3092\u8aad\u3093\u3067\u691c\u8a3c\u3057\u3001\u53d7\u3051\u53d6\u3063\u305fwp_users.ID\u3067 wp_set_current_user \u3068 wp_set_auth_cookie \u3059\u308c\u3070\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3063\u307d\u3044\u3002\nWP_USER\u30af\u30c3\u30ad\u30fc\u306b\u30c7\u30fc\u30bf\u304c\u306a\u304b\u3063\u305f\u3089\u30ed\u30b0\u30aa\u30d5\u3055\u308c\u305f\u3082\u306e\u3068\u3057\u3066 wp_logout \u3055\u305b\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u305f\n\n\n\u5171\u6709\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u306a\u3069\u306e\u8a2d\u5b9a\u60c5\u5831\n\n\nupdate_option / get_option \u3067\u6307\u5b9a\u3057\u305f\u30ad\u30fc\u3067PHP Array\u3092\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u3057\u3066wp_options\u3067\u8aad\u307f\u66f8\u304d\u3067\u304d\u308b\u3063\u307d\u3044(Authmod/Option.php)\n\n\n\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u304b\u3089\u306e\u8a2d\u5b9a\n\nWordpress\u306f\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u307f\u305f\u3044\u306a\u3082\u306e\u306f\u6a19\u6e96\u3067\u7121\u3044\u3088\u3046\u3067\u3059\n\nTimber \u3068\u3044\u3046\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u3042\u3063\u3066\u3001\u3053\u308c\u3067 Jinja2 \u3063\u307d\u3044 Twig \u3092\u4f7f\u3048\u308b\uff01\nTimber\u306f wp-content/plugins/timber-library \u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u3002\nTwig\u3068\u304b\u306fwp-content/plugins/timber-library/vendor\u306e\u4e0b\u306b Comoposer\u7ba1\u7406\u3067\u5165\u308c\u3089\u308c\u3066\u3044\u308b\u3002\nwp-content/plugins/timber-library/timber.php \u3067Timber\u95a2\u9023\u306e\u30aa\u30fc\u30c8\u30ed\u30fc\u30c9\u304c\u3055\u308c\u3066\u3044\u308b\u3002\n\nspl_autoload_register\u306f\u8907\u6570\u306e\u30aa\u30fc\u30c8\u30ed\u30fc\u30c9\u306e\u30cf\u30f3\u30c9\u30e9\u3092\u5b9a\u7fa9\u3067\u304d\u308b\u3063\u307d\u3044\u306e\u3067\u3001\u30b0\u30b0\u3063\u305f\u3084\u3064\u3092\u4fee\u6b63\u3057\u305f\u30aa\u30ec\u30aa\u30ec\u30aa\u30fc\u30c8\u30ed\u30fc\u30c0(bootstrap.php)\u3067require_once\u3057\u3066\u307f\u305f\u3089\u30a2\u30af\u30bb\u30b9\u3067\u304d\u305f\n\n$_GET \u3067 get_option, $_POST \u3067 update_option\u3059\u308b\u51e6\u7406\u3092\u3057\u3066\u3001Admin.html\u306bHTML\u30d5\u30a9\u30fc\u30e0\u3092Timber\u3067\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3059\u308b\u3088\u3046\u306b\u3057\u305f\u3089\u3067\u304d\u305f(Authmod/Admin.php)\n\n\nnginx\n\nvagrant box \u306e Debian Jessie \u3067\u52d5\u4f5c\u3055\u305b\u305f\nDjango \u306f /apps/ \u3067\u52d5\u304b\u3057\u305f\nPHP\u306f / \u304b\u3089\u52d5\u304f\u3088\u3046\u306b\u3057\u3066\u3044\u3066\u3001 Wordpress\u306f /wordpress \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\n\nupstream php-fpm-wordpress {\n  ip_hash;\n  server unix:/tmp/dev-php-fpm.sock;\n}\n\nupstream django-apps{\n  ip_hash;\n  server unix:/vagrant/projects/wpauth/djpress/sample/logs/gunicorn.sock;\n}\n\nserver {\n    listen 80;\n    listen [::]:80;\n\n    server_name wp.deb;\n\n    root /vagrant/projects/wpauth/www;\n    index index.php index.html;\n\n    access_log /vagrant/projects/wpauth/logs/access.log;\n    error_log  /vagrant/projects/wpauth/logs/error.log debug;\n\n\n    location /apps/assets {\n        alias /vagrant/projects/wpauth/djpress/sample/assets;\n    }\n\n    location /apps {\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $http_host;\n        proxy_set_header SCRIPT_NAME /apps;\n        proxy_redirect off;\n        if (!-f $request_filename) {\n            proxy_pass http://django-apps;\n            break;\n        }\n    }\n\n    location ~ \\.php$ {\n        fastcgi_pass  php-fpm-wordpress;\n        fastcgi_index  index.php;\n        fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;\n        fastcgi_buffer_size  128k;\n        fastcgi_buffers  256 16k;\n        fastcgi_busy_buffers_size  256k;\n        fastcgi_temp_file_write_size  256k;\n        include  fastcgi_params;\n    }\n}\n\n\nWP-CLI\n\n\nWP-CLI \u306f\u4f7f\u3048\u308b\u3002Wordpress\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3082\u3053\u308c\u304b\u3089\u3067\u304d\u308b\u3002\nwp-cli.yml \u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092 WP_CLI_CONFIG_PATH \u306b\u30bb\u30c3\u30c8\u3059\u308b\u3053\u3068!\nwp-cli.yml \u3092\u8aad\u3093\u3067\u3001nginx, php-fpm \u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\u306a\u3069\u3092\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3084\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u305f\nYAML\u304b\u3089\u30d1\u30e9\u30e1\u30fc\u30bf\u629c\u304d\u51fa\u3059\u306e\u306bshyaml\u3092PYPI\u304b\u3089\u3044\u308c\u3066\u307f\u305f\u3002Composer\u3067\u5165\u308bPHP\u306e\u30c4\u30fc\u30eb\u306f\u7121\u3044\u3082\u306e\u304b\u3002\n\nwp plugin saffold wp-authmod \u3067\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u96db\u5f62\u304c\u751f\u6210\u3055\u308c\u3066\u3001phpunit\u306e\u30c6\u30b9\u30c8\u30d7\u30ed\u30b0\u30e9\u30e0\u3082\u751f\u6210\u3055\u308c\u308b\uff01\nComposer \u3067 phpunit \u3044\u308c\u308b\u3068\u666e\u901a\u306b\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u5358\u4f53\u30c6\u30b9\u30c8\u3063\u307d\u3044\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n\n## Wordpress\u3067\u3081\u3093\u3069\u304f\u3055\u3044\u696d\u52d9\u51e6\u7406\u3057\u305f\u304f\u306a\u3044\n\n- PHP\u306a\u3089\u3073\u306bWordpress\u30d7\u30e9\u30b0\u30a4\u30f3\u3081\u3093\u3069\u304f\u3055\u3044\n- \u696d\u52d9\u51e6\u7406\u306f\u5225\u9014\u30e1\u30b8\u30e3\u30fc\u306aWeb\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u4f7f\u3063\u305f\u30a2\u30d7\u30ea\u3067\u3084\u308a\u305f\u3044\n- \u8a8d\u8a3c\u306e\u9023\u643a\u306f\u306a\u3093\u3068\u304b\u3057\u305f\u3044\n\n## \u65b9\u91dd\n\n- Cookie\u5171\u6709\u30b5\u30a4\u30c8(nginx\u3068\u304b\u3067\u30db\u30b9\u30c8)\u306bWordpress\u3068\u30a2\u30d7\u30ea(Django\u3068\u304b)\u5171\u6709\u3055\u305b\u308b\n- \u30a2\u30d7\u30ea\u5074\u3067Wordpress\u306e\u30e6\u30fc\u30b6\u30fc\u306e\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3092\u884c\u3046(wp_users)\n- Wordpress\u3068\u30a2\u30d7\u30ea\u3067Cookie\u3067\u5171\u6709\u30c7\u30fc\u30bf\u3092\u6e21\u3059\n\n\n## \u30a2\u30d7\u30ea\u5074(Django)\n\n### Wordpress\u306eMySQL\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n\n- settings.DATABASES\u306b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u8ffd\u52a0\u3057\u3066\u3001 settings. DATABASE_ROUTERS \u3067\u30e2\u30c7\u30eb\u3068\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u9023\u643a\u3092\u5b9a\u7fa9\u3059\u308b ([settings](https://github.com/hdknr/djpress/blob/master/sample/app/settings.py), [DatabaseRouter](https://github.com/hdknr/djpress/blob/master/sample/app/databases.py))\n- inspectdb \u3057\u3066\u30e2\u30c7\u30eb\u30af\u30e9\u30b9\u3092[\u7528\u610f\u3059\u308b](https://github.com/hdknr/djpress/blob/master/lib/djpress/wordpress.py)\n\n### \u30e6\u30fc\u30b6\u30fc\u8ffd\u52a0, \u524a\u9664\u3067 wp_users\u3092\u64cd\u4f5c\u3059\u308b\n\n- `from django.db.models.signals import post_save, post_delete` \u306e\u30b7\u30b0\u30ca\u30eb\u30cf\u30f3\u30c9\u30e9\u3092\u5b9a\u7fa9\u3057\u3066\u3001 WpUsers\u30e2\u30c7\u30eb(wp_users\u30c6\u30fc\u30d6\u30eb) \u306e\u8ffd\u52a0\u66f4\u65b0/\u524a\u9664\u3059\u308b ([signals.py](https://github.com/hdknr/djpress/blob/master/lib/djpress/signals.py))\n\n### \u30ed\u30b0\u30a4\u30f3\u3057\u305f\u6642\u306b\u5171\u6709Cookie\u30c7\u30fc\u30bf\u3092\u8a2d\u5b9a\u3059\u308b\n\n- `from django.contrib.auth.signals import user_logged_in` \u306e\u30b7\u30b0\u30ca\u30eb\u30cf\u30f3\u30c9\u30e9\u3067\u5171\u6709Cookie\u30c7\u30fc\u30bf\u3092\u7528\u610f\u3059\u308b\n- \u4eca\u56de\u306f `{{ wp_users.ID }}:{{ sha256(django_session_key + wp_users.id + shared_secret)}}` \u3068\u3044\u3046\u6587\u5b57\u5217\u306b\u3057\u3066\u30bb\u30c3\u30b7\u30e7\u30f3\u30c7\u30fc\u30bf\u306b\u4fdd\u5b58([signals.py](https://github.com/hdknr/djpress/blob/master/lib/djpress/signals.py))\n- HTTP\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u8fd4\u3059\u6642\u306b`WP_USER`\u3068\u3044\u3046Cookie\u306b\u30bb\u30c3\u30c8([middleware.py](https://github.com/hdknr/djpress/blob/master/lib/djpress/middleware.py))\n\n## Wordpress\u5074(wp-authmod\u30d7\u30e9\u30b0\u30a4\u30f3)\n\n-  Django\u304c\u30bb\u30c3\u30c8\u3057\u305f sessionid\u3068 WP_USER\u3067\u30ed\u30b0\u30a4\u30f3/\u30ed\u30b0\u30a2\u30a6\u30c8\u306e\u51e6\u7406\u3092\u3059\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5b9f\u88c5\u3057\u3066\u307f\u305f([wp-authmod](https://github.com/hdknr/wp-authmod))\n- Wordpress\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u3088\u304f\u308f\u304b\u3089\u306a\u3044\n\n### send_headers \u30a2\u30af\u30b7\u30e7\u30f3\u3067\u51e6\u7406\n\n- Wordpress\u304c\u4f55\u304b\u3057\u304b\u30b9\u30c8\u30ea\u30fc\u30e0\u306b\u66f8\u3044\u3066\u3057\u307e\u3046\u3068\u3001Set-Cookie\u306a\u3069\u30d8\u30c3\u30c0\u30fc\u306e\u51e6\u7406\u3059\u308b\u3068Warning\u3067\u308b\u306e\u3067\u3001send_headers\u30a2\u30af\u30b7\u30e7\u30f3\u3067\u5f37\u5236\u30ed\u30b0\u30a4\u30f3/\u30ed\u30b0\u30a2\u30a6\u30c8\u51e6\u7406\u3092\u3084\u308b\u306e\u304c\u3044\u3044\u306e\u304b(\u3088\u304f\u308f\u304b\u3089\u306a\u3044)([Authmod/App.php](https://github.com/hdknr/wp-authmod/blob/master/Authmod/App.php))\n- \u5358\u7d14\u306bCookie\u30c7\u30fc\u30bf\u3092\u8aad\u3093\u3067\u691c\u8a3c\u3057\u3001\u53d7\u3051\u53d6\u3063\u305f`wp_users.ID`\u3067 [wp_set_current_user](https://codex.wordpress.org/Function_Reference/wp_set_current_user) \u3068 [wp_set_auth_cookie](https://codex.wordpress.org/Function_Reference/wp_set_auth_cookie) \u3059\u308c\u3070\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3063\u307d\u3044\u3002\n- WP_USER\u30af\u30c3\u30ad\u30fc\u306b\u30c7\u30fc\u30bf\u304c\u306a\u304b\u3063\u305f\u3089\u30ed\u30b0\u30aa\u30d5\u3055\u308c\u305f\u3082\u306e\u3068\u3057\u3066 [wp_logout](https://codex.wordpress.org/Function_Reference/wp_logout) \u3055\u305b\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u305f\n\n### \u5171\u6709\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u306a\u3069\u306e\u8a2d\u5b9a\u60c5\u5831\n\n- [update_option](https://codex.wordpress.org/Function_Reference/update_option) / [get_option](https://codex.wordpress.org/Function_Reference/get_option) \u3067\u6307\u5b9a\u3057\u305f\u30ad\u30fc\u3067PHP Array\u3092\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u3057\u3066wp_options\u3067\u8aad\u307f\u66f8\u304d\u3067\u304d\u308b\u3063\u307d\u3044([Authmod/Option.php](https://github.com/hdknr/wp-authmod/blob/master/Authmod/Option.php))\n\n### \u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u304b\u3089\u306e\u8a2d\u5b9a\n\n- Wordpress\u306f\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u307f\u305f\u3044\u306a\u3082\u306e\u306f\u6a19\u6e96\u3067\u7121\u3044\u3088\u3046\u3067\u3059\n- [Timber](https://github.com/jarednova/timber/wiki) \u3068\u3044\u3046\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u3042\u3063\u3066\u3001\u3053\u308c\u3067 [Jinja2](http://jinja.pocoo.org/docs/dev/) \u3063\u307d\u3044 [Twig](http://twig.sensiolabs.org/documentation) \u3092\u4f7f\u3048\u308b\uff01\n- Timber\u306f wp-content/plugins/timber-library \u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u3002\n- Twig\u3068\u304b\u306fwp-content/plugins/timber-library/vendor\u306e\u4e0b\u306b [Comoposer](https://getcomposer.org/)\u7ba1\u7406\u3067\u5165\u308c\u3089\u308c\u3066\u3044\u308b\u3002\n- wp-content/plugins/timber-library/timber.php \u3067Timber\u95a2\u9023\u306e\u30aa\u30fc\u30c8\u30ed\u30fc\u30c9\u304c\u3055\u308c\u3066\u3044\u308b\u3002\n- [spl_autoload_register](https://secure.php.net/manual/ja/function.spl-autoload-register.php)\u306f\u8907\u6570\u306e\u30aa\u30fc\u30c8\u30ed\u30fc\u30c9\u306e\u30cf\u30f3\u30c9\u30e9\u3092\u5b9a\u7fa9\u3067\u304d\u308b\u3063\u307d\u3044\u306e\u3067\u3001\u30b0\u30b0\u3063\u305f\u3084\u3064\u3092\u4fee\u6b63\u3057\u305f\u30aa\u30ec\u30aa\u30ec\u30aa\u30fc\u30c8\u30ed\u30fc\u30c0([bootstrap.php](https://github.com/hdknr/wp-authmod/blob/master/bootstrap.php))\u3067require_once\u3057\u3066\u307f\u305f\u3089\u30a2\u30af\u30bb\u30b9\u3067\u304d\u305f\n- `$_GET` \u3067 `get_option`, `$_POST` \u3067 `update_option`\u3059\u308b\u51e6\u7406\u3092\u3057\u3066\u3001[Admin.html](https://github.com/hdknr/wp-authmod/blob/master/Authmod/Admin.html)\u306bHTML\u30d5\u30a9\u30fc\u30e0\u3092Timber\u3067\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3059\u308b\u3088\u3046\u306b\u3057\u305f\u3089\u3067\u304d\u305f([Authmod/Admin.php](https://github.com/hdknr/wp-authmod/blob/master/Authmod/Admin.php))\n\n## nginx\n\n- vagrant box \u306e Debian Jessie \u3067\u52d5\u4f5c\u3055\u305b\u305f\n- Django \u306f `/apps/` \u3067\u52d5\u304b\u3057\u305f\n- PHP\u306f `/` \u304b\u3089\u52d5\u304f\u3088\u3046\u306b\u3057\u3066\u3044\u3066\u3001 Wordpress\u306f `/wordpress` \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\n\n~~~\nupstream php-fpm-wordpress {\n  ip_hash;\n  server unix:/tmp/dev-php-fpm.sock;\n}\n\nupstream django-apps{\n  ip_hash;\n  server unix:/vagrant/projects/wpauth/djpress/sample/logs/gunicorn.sock;\n}\n\nserver {\n    listen 80;\n    listen [::]:80;\n\n    server_name wp.deb;\n\n    root /vagrant/projects/wpauth/www;\n    index index.php index.html;\n\n    access_log /vagrant/projects/wpauth/logs/access.log;\n    error_log  /vagrant/projects/wpauth/logs/error.log debug;\n\n\n    location /apps/assets {\n        alias /vagrant/projects/wpauth/djpress/sample/assets;\n    }\n\n    location /apps {\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $http_host;\n        proxy_set_header SCRIPT_NAME /apps;\n        proxy_redirect off;\n        if (!-f $request_filename) {\n            proxy_pass http://django-apps;\n            break;\n        }\n    }\n    \n    location ~ \\.php$ {\n        fastcgi_pass  php-fpm-wordpress;\n        fastcgi_index  index.php;\n        fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;\n        fastcgi_buffer_size  128k;\n        fastcgi_buffers  256 16k;\n        fastcgi_busy_buffers_size  256k;\n        fastcgi_temp_file_write_size  256k;\n        include  fastcgi_params;\n    }\n}\n~~~\n\n## WP-CLI\n\n- [WP-CLI](http://wp-cli.org/) \u306f\u4f7f\u3048\u308b\u3002Wordpress\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3082\u3053\u308c\u304b\u3089\u3067\u304d\u308b\u3002\n- wp-cli.yml \u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092 `WP_CLI_CONFIG_PATH` \u306b\u30bb\u30c3\u30c8\u3059\u308b\u3053\u3068!\n- wp-cli.yml \u3092\u8aad\u3093\u3067\u3001nginx, php-fpm \u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\u306a\u3069\u3092[\u30b9\u30af\u30ea\u30d7\u30c8](https://github.com/hdknr/wp-authmod/blob/master/dev/scaffold.bash)\u3067\u3084\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u305f\n- YAML\u304b\u3089\u30d1\u30e9\u30e1\u30fc\u30bf\u629c\u304d\u51fa\u3059\u306e\u306b[shyaml](https://github.com/0k/shyaml)\u3092PYPI\u304b\u3089\u3044\u308c\u3066\u307f\u305f\u3002Composer\u3067\u5165\u308bPHP\u306e\u30c4\u30fc\u30eb\u306f\u7121\u3044\u3082\u306e\u304b\u3002\n- `wp plugin saffold wp-authmod` \u3067\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u96db\u5f62\u304c\u751f\u6210\u3055\u308c\u3066\u3001[phpunit](https://phpunit.de/)\u306e\u30c6\u30b9\u30c8\u30d7\u30ed\u30b0\u30e9\u30e0\u3082\u751f\u6210\u3055\u308c\u308b\uff01\n- Composer \u3067 phpunit \u3044\u308c\u308b\u3068\u666e\u901a\u306b\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u5358\u4f53\u30c6\u30b9\u30c8\u3063\u307d\u3044\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n\n", "tags": ["Django", "WordPress"]}