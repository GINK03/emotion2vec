{"context": "\n\nBeats\u3068\u306f\uff1f\n\n\u516c\u5f0f\uff1ahttps://www.elastic.co/products/beats\nLogstash, Elasticsearch, Kibana\u3067\u77e5\u3089\u308c\u308belastic\u793e\u306e\u65b0\u30d7\u30ed\u30c0\u30af\u30c8\u3067\u3059\u3002\n\u4e00\u8a00\u3067\u8a00\u3048\u3070\u3001\u3055\u307e\u3056\u307e\u306a\u30c7\u30fc\u30bf\u3092\u53ce\u96c6\u30fb\u52a0\u5de5\u3057\u3066\u8ee2\u9001\u3059\u308b\u30c4\u30fc\u30eb\u306e\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3067\u3059\u3002\n\u300cfluentd\u300d\u3084\u300cLogstash\u300d\u306e\u3088\u3046\u306a\u3082\u306e\u3068\u3044\u3048\u3070\u30a4\u30e1\u30fc\u30b8\u304c\u6e67\u304f\u3067\u3057\u3087\u3046\u304b\u3002\n2015\u5e7411\u670824\u65e5\u306bv1.0.0\u304c\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u3001\u5f53\u8a18\u4e8b\u57f7\u7b46\u6642\u70b9\u3067v1.1.2\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u7279\u5fb4\n\n\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3068\u3057\u3066Elasticsearch, Logstash\u3092\u60f3\u5b9a\n\u6a5f\u80fd\u304c\u975e\u5e38\u306b\u30b7\u30f3\u30d7\u30eb\u3067\u8efd\u3044\nGo\u8a00\u8a9e\u5b9f\u88c5\n\n\n\u30de\u30eb\u30c1\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\n\u5225\u9014\u30e9\u30f3\u30bf\u30a4\u30e0\uff08JVM\u3068\u304b\uff09\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4e0d\u8981\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306fYAML\u5f62\u5f0f\n\n\n\u516c\u958b\u3055\u308c\u3066\u3044\u308bBeat\nelastic\u793e\u304b\u3089\u516c\u958b\u3055\u308c\u3066\u3044\u308bBeat\u306f\u6b21\u306e4\u3064\u3068\u306a\u308a\u307e\u3059\u3002\n\n\n\n\u540d\u79f0\n\u6982\u8981\n\n\n\n\nPacketbeat\n\u30d1\u30b1\u30c3\u30c8\u60c5\u5831\u3092\u53ce\u96c6\u3059\u308bBeat\n\n\nTopbeat\nCPU\u3084\u30e1\u30e2\u30ea\u306a\u3069\u306e\u30ea\u30bd\u30fc\u30b9\u60c5\u5831\u3092\u53ce\u96c6\u3059\u308bBeat\n\n\nFilebeat\n\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u53ce\u96c6\u3059\u308bBeat\n\n\nWinlogbeat\nWindows\u306e\u30a4\u30d9\u30f3\u30c8\u30ed\u30b0\u3092\u53ce\u96c6\u3059\u308bBeat\n\n\n\nOSS\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u304b\u3089\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308bBeat\u3082\u6570\u591a\u304f\u3042\u308a\u307e\u3059\u3002\nhttps://www.elastic.co/guide/en/beats/libbeat/current/community-beats.html\n\n\u69cb\u6210\n\nBeats\u306f\u300clibbeat\u300d\u3068\u3044\u3046\u5171\u901a\u6a5f\u80fd\uff08\u30c7\u30fc\u30bf\u9001\u4fe1\u3001\u8a2d\u5b9a\u7ba1\u7406\u3001\u30ed\u30ae\u30f3\u30b0 etc...\uff09\u3092\u63d0\u4f9b\u3059\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3068\n\u30c7\u30fc\u30bf\u306e\u7a2e\u985e\u306b\u5fdc\u3058\u3066\u53ce\u96c6\u30fb\u52a0\u5de5\u3092\u62c5\u3046\u500b\u3005\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\uff08\u4e0a\u56f3\u3067\u3044\u3046Packetbeat\u3084Topbeat\uff09\u304b\u3089\u69cb\u6210\u3055\u308c\u307e\u3059\u3002\n\u500b\u3005\u306eBeat\u306f1Beat\u306b\u3064\u304d1\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u306e\u69cb\u6210\u3068\u306a\u308a\u307e\u3059\u3002\n\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u306b\u5fdc\u3058\u3066Beat\u3092\u81ea\u4f5c\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\uff08\u5f8c\u8ff0\uff09\n\nBeats\u3068Logstash\u306e\u68f2\u307f\u5206\u3051\nelastic\u793e\u306e\u30c7\u30fc\u30bf\u53ce\u96c6\u30c4\u30fc\u30eb\u3068\u3057\u3066\u306fLogstash\u304c\u5b58\u5728\u3057\u307e\u3059\u304c\u3001Beats\u3068\u306e\u68f2\u307f\u5206\u3051\u306f\u3069\u3046\u306a\u308b\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\n\u4e0a\u56f3\u306e\u3068\u304a\u308a\u3001\u300c\u30c7\u30fc\u30bf\u306e\u53ce\u96c6\u300d\u306fBeats\u304c\u62c5\u5f53\u3057\u3001\u300c\u30c7\u30fc\u30bf\u306e\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3084\u52a0\u5de5\u51e6\u7406\u300d\u306fLogstash\u304c\u62c5\u5f53\u3059\u308b\u3068\u3044\u3046\u68f2\u307f\u5206\u3051\u306b\u306a\u308a\u305d\u3046\u3067\u3059\u3002\n\u307e\u305fBeats\u306fElasticsearch, Logstash, File, Console, Redis\uff08\u975e\u63a8\u5968\uff09\u306b\u5bfe\u3057\u3066\u3057\u304b\u30c7\u30fc\u30bf\u9023\u643a\u304c\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u305d\u306e\u4ed6\u306e\u5a92\u4f53\u306b\u30c7\u30fc\u30bf\u3092\u9023\u643a\u3057\u305f\u3044\u5834\u5408\u306f\u3001\u4e00\u65e6Logstash\u3092\u7d4c\u7531\u3059\u308b\u5f62\u306b\u306a\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\u4eca\u307e\u3067elastic\u793e\u306e\u30c7\u30fc\u30bf\u53ef\u8996\u5316\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3068\u3057\u3066\u5404\u30c4\u30fc\u30eb\u306e\u982d\u6587\u5b57\u3092\u3068\u3063\u3066\u300cELK\u300d\uff08Elasticsearch + Logstash + Kibana\uff09\u3068\u8a00\u308f\u308c\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u4eca\u5f8c\u306f\u300cBELK\u300d\uff08Beats + Elasticsearch + Logstash + Kibana\uff09\u306a\u3044\u3057\u300cBLK\u300d\uff08Beats + Logstash + Kibana\uff09\u306b\u306a\u3063\u3066\u3044\u304f\u3068\u3044\u3046\u611f\u3058\u3067\u3057\u3087\u3046\u304b\u3002\n\n\u4f7f\u3063\u3066\u307f\u305f\n\u4eca\u56de\u306f\u516c\u5f0f\u304b\u3089\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308bBeats\u306e\u4e2d\u304b\u3089\u300cTopbeat\u300d\u3092\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u74b0\u5883\u60c5\u5831\n\nOS\uff1aCentOS6.5 on VirtualBox + Vagrant\nBeats\uff1a1.1.2\nElasticsearch\uff1a2.1.0\nKibana\uff1a4.3.0\n\n\u203b Elasticsearch\u3068Kibana\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u524d\u63d0\u3068\u3057\u307e\u3059\u3002\n\nTopbeat\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nhttps://www.elastic.co/guide/en/beats/topbeat/current/topbeat-installation.html\napt\u3068yum\u3067\u5229\u7528\u53ef\u80fd\u306a\u30ea\u30dd\u30b8\u30c8\u30ea\u304c\u3042\u308a\u307e\u3059\u3002\u4eca\u56de\u306fyum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n1 . \u516c\u958b\u9375\u30a4\u30f3\u30dd\u30fc\u30c8\nrpm --import https://packages.elastic.co/GPG-KEY-elasticsearch\n\n2 . \u30ea\u30dd\u30b8\u30c8\u30ea\u8ffd\u52a0\n\n/etc/yum.repos.d/\n[beats]\nname=Elastic Beats Repository\nbaseurl=https://packages.elastic.co/beats/yum/el/$basearch\nenabled=1\ngpgkey=https://packages.elastic.co/GPG-KEY-elasticsearch\ngpgcheck=1\n\n\n3 . \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum install topbeat\n\n\u203bdeb, rpm, tgz, zip\u5f62\u5f0f\u3067\u3082\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u3002Windows\u306e\u5834\u5408\u306fZIP\u3092\u843d\u3068\u3057\u307e\u3057\u3087\u3046\u3002\n\nTopbeat\u8a2d\u5b9a\n\u6700\u4f4e\u9650\u306e\u8a2d\u5b9a\u3068\u3057\u3066\u30c7\u30fc\u30bf\u8ee2\u9001\u5148\uff08\u4eca\u56de\u306fElasticsearch\uff09\u306e\u30a2\u30c9\u30ec\u30b9\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n/etc/topbeat/topbeat.yml\noutput:\n\n  ### Elasticsearch as output\n  elasticsearch:\n    # Array of hosts to connect to.\n    # Scheme and port can be left out and will be set to the default (http and 9200)\n    # In case you specify and additional path, the scheme is required: http://localhost:9200/path\n    # IPv6 addresses should always be defined as: https://[2001:db8::1]:9200\n    hosts: [\"localhost:9200\"]\n\n\n\nElasticsearch\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u5b9a\u7fa9\ntopbeat.template.json \u3092Elasticsearch\u306b\u98df\u308f\u305b\u3066\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u5b9a\u7fa9\u3057\u3066\u304a\u304d\u307e\u3059\u3002\ncurl -XPUT 'http://localhost:9200/_template/topbeat' -d@/etc/topbeat/topbeat.template.json\n\n\nTopbeat\u8d77\u52d5\nservice topbeat start\n\n\n\u53ef\u8996\u5316\nKibana\u304b\u3089\u30c7\u30fc\u30bf\u304c\u9023\u643a\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u540d\u306f topbeat-* \u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u306a\u3093\u3068Topbeat\u7528\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306e\u30b5\u30f3\u30d7\u30eb\u307e\u3067\u3082github\u3067\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nhttps://github.com/elastic/beats-dashboards\n\u76f4\u4e0b\u306e\u30b7\u30a7\u30eb\u53e9\u3044\u3066Dashboard\u5b9a\u7fa9\u3092Elasticsearch\u306b\u98df\u308f\u305b\u308c\u3070OK\u3067\u3059\u3002\n./load.sh -url \"http://localhost:9200\"\n\nTopbeat\u7528\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u958b\u304f\u3068\u30de\u30b7\u30f3\u6bce/\u30d7\u30ed\u30bb\u30b9\u6bce\u306eCPU\u4f7f\u7528\u7387\u3084\u3089\u30e1\u30e2\u30ea\u4f7f\u7528\u7387\u3084\u3089\u304c\n\u53ef\u8996\u5316\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\n\u3053\u3053\u307e\u3067\n\u308f\u305a\u304b10\u5206\u7a0b\u5ea6\u3067\u4f5c\u696d\u3067\u304d\u307e\u3057\u305f\u3002\u7269\u51c4\u3044\u624b\u8efd\u3067\u3059\u306d\u3002\n\n\u4f5c\u3063\u3066\u307f\u305f\nDeveloper Guide\u304c\u63d0\u4f9b\u3055\u308c\u3066\u307e\u3059\u306e\u3067\u3001\u30aa\u30ea\u30b8\u30ca\u30eb\u306aBeat\u3092\u4f5c\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\nhttps://www.elastic.co/guide/en/beats/libbeat/current/new-beat.html\n\n\u4eca\u56de\u4f5c\u308bBeat\n\u4eca\u56de\u306fWindows\u306e\u8d77\u52d5\u3057\u3066\u3044\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30bf\u30b9\u30af\u4e00\u89a7\uff08\u30d7\u30ed\u30bb\u30b9\u3067\u306f\u306a\u3044\uff09\u3092\u53ce\u96c6\u3059\u308bBeat\n\u901a\u79f0\u300cWinappbeat\u300d\u3092\u4f5c\u6210\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u52d5\u6a5f\u306f\u3053\u308c\u3092\u5f8c\u8f29\u306ePC\u306b\u4ed5\u8fbc\u3093\u3067\u3001\u696d\u52d9\u4e2d\u4f55\u3084\u3063\u3066\u308b\u306e\u304b\u76e3\u8996\u3057\u305f\u3044\u306a\u30fc\u3068\u3044\u3046\u60aa\u5de7\u307f\u3067\u3059\u3002\n\u307e\u3042\u3001\u30cd\u30bf\u306f\u4f55\u3067\u3082\u3044\u3044\u3093\u3067\u3059\u3002(;^_^A\n\n\u69cb\u6210\n\n\u5148\u306b\u3082\u8aac\u660e\u3057\u307e\u3057\u305f\u304c\u3001Beat\u306f\u4e3b\u306b\u300c\u30c7\u30fc\u30bf\u53ce\u96c6\u3092\u306b\u62c5\u3046\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u300d\u3068\u300c\u30c7\u30fc\u30bf\u3092\u9001\u4fe1\u3059\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\uff08Publisher\uff09\u300d\u306e2\u3064\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304b\u3089\u69cb\u6210\u3055\u308c\u307e\u3059\u3002\n\u5f8c\u8005\u306e\u300cPublisher\u300d\u3092\u542b\u3080\u300c\u8a2d\u5b9a\u7ba1\u7406\u300d\u300c\u30ed\u30ae\u30f3\u30b0\u300d\u300c\u30c7\u30fc\u30e2\u30f3/\u30b5\u30fc\u30d3\u30b9\u300d\u3068\u3044\u3063\u305f\u57fa\u672c\u6a5f\u80fd\u306f\u300clibbeat\u300d\u3068\u3044\u3046\u5171\u901a\u6a5f\u80fd\u3068\u3057\u3066\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u958b\u767a\u3059\u308b\u5834\u5408\u306f\u300c\u30c7\u30fc\u30bf\u53ce\u96c6\u3092\u306b\u62c5\u3046\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\uff08Beat custom logic\uff09\u300d\u90e8\u5206\u3060\u3051\u3092\u5b9f\u88c5\u3059\u308c\u3070\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002\n\n\u74b0\u5883\u60c5\u5831\n\nOS\uff1aWindows7\nGo\uff1a1.6\n\n\u203bGo\u8a00\u8a9e\u3067\u958b\u767a\u3059\u308b\u305f\u3081\u306e\u57fa\u672c\u7684\u306a\u8a2d\u5b9a\u306f\u5b8c\u4e86\u3057\u3066\u3044\u308b\u524d\u63d0\u3068\u3057\u307e\u3059\u3002\n\nlibbeat\u53d6\u5f97\n\u516c\u5f0f\u3067\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308blibbeat\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092 go get \u3057\u307e\u3059\u3002\ngo get github.com/elastic/beats\n\n\nBeat\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u751f\u6210\n0\u304b\u3089\u4f5c\u3063\u3066\u3082\u3044\u3044\u306e\u3067\u3059\u304c\u3001\nbeat-generator\u3068\u3044\u3046\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u304c\u516c\u958b\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u5229\u7528\u3057\u307e\u3059\u3002\nhttps://github.com/elastic/beat-generator\n\u203bPython\u3001Cookiecutter\u304c\u4e8b\u524d\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\ncookiecutter https://github.com/elastic/beat-generator.git\n\nBeat\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\uff08projectname\u3092\u5c0b\u306d\u3089\u308c\u308b\u306e\u3067Winappbeat\u3092\u6307\u5b9a\uff09\nwinappbeat\n\u2502  .gitattributes\n\u2502  .gitignore\n\u2502  .travis.yml\n\u2502  CONTRIBUTING.md\n\u2502  glide.yaml\n\u2502  LICENSE\n\u2502  main.go\n\u2502  main_test.go\n\u2502  Makefile\n\u2502  README.md\n\u2502  winappbeat.yml       \u203b\n\u2502\n\u251c\u2500beater\n\u2502      winappbeat.go    \u203b\n\u2502\n\u251c\u2500config\n\u2502      config.go        \u203b\n\u2502\n\u251c\u2500docs\n\u2502      index.asciidoc\n\u2502\n\u251c\u2500etc\n\u2502      beat.yml\n\u2502      fields.yml\n\u2502      winappbeat.template.json\n\u2502\n\u2514\u2500tests\n   \u2514\u2500system\n       \u2502  requirements.txt\n       \u2502  test_base.py\n       \u2502  winappbeat.py\n       \u2502\n       \u2514\u2500config\n               winappbeat.yml.j2\n\n\u6700\u4f4e\u9650\u5b9f\u88c5\u3059\u3079\u304d\u30d5\u30a1\u30a4\u30eb\u306f\u300c\u203b\u300d\u3092\u4ed8\u4e0e\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3068\u306a\u308a\u307e\u3059\u3002\n\u9806\u3092\u8ffd\u3063\u3066\u898b\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n\u4eca\u56de\u306f\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u9593\u9694\uff08\u30df\u30ea\u79d2\uff09\u3092\u8a2d\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u307e\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u4e00\u89a7\u306fWindows\u306eEnumWindows\u95a2\u6570\u3092\u5229\u7528\u3057\u3066\u53d6\u5f97\u3057\u307e\u3059\u304c\u3001\n\u300c\u30a6\u30a3\u30f3\u30c9\u30a6\u540d\u304c\u7a7a\u306e\u30a6\u30a3\u30f3\u30c9\u30a6\u3092\u53d6\u5f97\u3059\u308b\u304b\u3069\u3046\u304b\u300d\u3068\u300c\u4e0d\u53ef\u8996\u30a6\u30a3\u30f3\u30c9\u30a6\u3092\u53d6\u5f97\u3059\u308b\u304b\u3069\u3046\u304b\u300d\u306f\u9078\u629e\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u4eca\u56de\u306f\u30a6\u30a3\u30f3\u30c9\u30a6\u540d\u304c\u7a7a\u3067\u306f\u306a\u3044\u53ef\u8996\u30a6\u30a3\u30f3\u30c9\u30a6\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\nwinappbeat.yml\ninput:\n  # Defines how often an event is sent to the output\n  period: 10s\n  # Whether to get only window that has name\n  onlyNotEmpty: true\n  # Whether to get only visible window\n  onlyVisible: true\n\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u5bfe\u5fdc\u3059\u308b\u69cb\u9020\u4f53\u3092\u5b9f\u88c5\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u5bfe\u5fdc\u3059\u308b\u69cb\u9020\u4f53\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\nconfig/config.go\npackage config\n\ntype Config struct {\n    Winappbeat WinappbeatConfig\n}\n\ntype WinappbeatConfig struct {\n    Period       string `yaml:\"period\"`\n    OnlyNotEmpty string `yaml:\"onlyNotEmpty\"`\n    OnlyVisible  string `yaml:\"onlyVisible\"`\n}\n\n\n\n\u30c7\u30fc\u30bf\u53d6\u5f97\u30fb\u8ee2\u9001\u30ed\u30b8\u30c3\u30af\u3092\u5b9f\u88c5\n\u3044\u308f\u3086\u308b\u30e1\u30a4\u30f3\u3068\u306a\u308b\u51e6\u7406\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\u958b\u767a\u8005\u306flibbeat\u304c\u63d0\u4f9b\u3059\u308bBeater\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u4ee5\u4e0b\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u88c5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\ntype Beater interface {\n    Config(*Beat) error\n    Setup(*Beat) error\n    Run(*Beat) error\n    Cleanup(*Beat) error\n    Stop()\n}\n\n\nConfig\u3000\u2026\u3000\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u6271\u3046\u30e1\u30bd\u30c3\u30c9\nSetup\u3000\u2026\u3000\u521d\u671f\u51e6\u7406\u3092\u884c\u3046\u30e1\u30bd\u30c3\u30c9\nRun\u3000\u2026\u3000\u30c7\u30fc\u30bf\u53ce\u96c6\u306e\u30e1\u30a4\u30f3\u51e6\u7406\u3092\u884c\u3046\u30e1\u30bd\u30c3\u30c9\nCleanup\u3000\u2026\u3000\u7d42\u4e86\u51e6\u7406\u3092\u884c\u3046\u30e1\u30bd\u30c3\u30c9\nStop\u3000\u2026\u3000\u505c\u6b62\u8981\u6c42\u304c\u3042\u3063\u305f\u5834\u5408\u306e\u51e6\u7406\u3092\u884c\u3046\u30e1\u30bd\u30c3\u30c9\n\n\nConfig\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\u3092\u884c\u3046\u51e6\u7406\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\nbeater/winappbeat.go\nfunc (bt *Winappbeat) Config(b *beat.Beat) error {\n    // Load beater configuration\n    err := cfgfile.Read(&bt.Configuration, \"\")\n    if err != nil {\n        return fmt.Errorf(\"Error reading config file: %v\", err)\n    }\n    return nil\n}\n\n\n\nSetup\n\u521d\u671f\u51e6\u7406\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u5024\u304c\u30bb\u30c3\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u30bb\u30c3\u30c8\u3057\u307e\u3059\u3002\n\nbeater/winappbeat.go\nfunc (bt *Winappbeat) Setup(b *beat.Beat) error {\n    // Setting default period if not set\n    if bt.Configuration.Winappbeat.Period == \"\" {\n        bt.Configuration.Winappbeat.Period = \"30s\"\n    }\n    var err error\n    bt.period, err = time.ParseDuration(bt.Configuration.Winappbeat.Period)\n    if err != nil {\n        return err\n    }\n    // Setting default onlyNotEmpty if not set\n    if bt.Configuration.Winappbeat.OnlyNotEmpty == \"\" {\n        bt.Configuration.Winappbeat.OnlyNotEmpty = \"true\"\n    }\n    bt.onlyNotEmpty, err = strconv.ParseBool(bt.Configuration.Winappbeat.OnlyNotEmpty)\n    if err != nil {\n        return err\n    }\n    // Setting default onlyVisible if not set\n    if bt.Configuration.Winappbeat.OnlyVisible == \"\" {\n        bt.Configuration.Winappbeat.OnlyVisible = \"true\"\n    }\n    bt.onlyVisible, err = strconv.ParseBool(bt.Configuration.Winappbeat.OnlyVisible)\n    if err != nil {\n        return err\n    }\n    return nil\n}\n\n\n\nRun\n\u30e1\u30a4\u30f3\u30ed\u30b8\u30c3\u30af\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u8a2d\u5b9a\u3057\u305f\u9593\u9694\u6bce\u306b\u3001Windows\u306e\u8d77\u52d5\u4e2d\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u53d6\u5f97\u3057\u3066\u3001\nElasticsearch\u306b\u9023\u643a\u3059\u308b\u51e6\u7406\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\nbeater/winappbeat.go\nfunc (bt *Winappbeat) Run(b *beat.Beat) error {\n    ticker := time.NewTicker(bt.period)\n    counter := 1\n    for {\n        select {\n        case <-bt.done:\n            return nil\n        case <-ticker.C:\n        }\n\n        list := listWindows(win.HWND(0))\n        for _, w := range list {\n            event := common.MapStr{\n                \"@timestamp\":     common.Time(time.Now()),\n                \"type\":           b.Name,\n                \"counter\":        counter,\n                \"windowname\":     w.name,\n                \"windowcategory\": w.nameCategory,\n                \"windowclass\":    w.class,\n                \"left\":           w.r.Left,\n                \"top\":            w.r.Top,\n                \"width\":          w.r.Right - w.r.Left,\n                \"height\":         w.r.Bottom - w.r.Top,\n            }\n            b.Events.PublishEvent(event)\n        }\n        counter++\n    }\n}\n\nfunc listWindows(hwnd win.HWND) []window {\n    var d cbData\n    d.list = make([]window, 0)\n    d.pid = make(map[uint32]string)\n    win.EnumChildWindows(hwnd, syscall.NewCallback(perWindow), uintptr(unsafe.Pointer(&d)))\n    return d.list\n}\n\nfunc perWindow(hwnd win.HWND, param uintptr) uintptr {\n    d := (*cbData)(unsafe.Pointer(param))\n    w := window{hwnd: hwnd}\n    w.visible = win.IsWindowVisible(hwnd)\n    win.GetWindowRect(hwnd, &w.r)\n    w.name = getWindowName(hwnd, getWindowText)\n    slice := strings.Split(w.name, \" - \")\n    w.nameCategory = slice[len(slice)-1]\n    w.hasChild = win.GetWindow(hwnd, win.GW_CHILD) != 0\n    if w.name != \"\" {\n        if w.visible {\n            d.list = append(d.list, w)\n        }\n    }\n    return 1\n}\n\nfunc getWindowName(hwnd win.HWND, get *syscall.LazyProc) string {\n\n    const bufSiz = 512\n\n    var buf [bufSiz]uint16\n    siz, _, _ := get.Call(uintptr(hwnd), uintptr(unsafe.Pointer(&buf[0])), uintptr(len(buf)))\n    if siz == 0 {\n        return \"\"\n    }\n    name := syscall.UTF16ToString(buf[:siz])\n    if siz == bufSiz-1 {\n        name = name + \"\\u22EF\"\n    }\n    return name\n}\n\n\n\u5c11\u3057\u9577\u304f\u306a\u3063\u3063\u3066\u307e\u3059\u304c\u3001\u809d\u306fevent\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u30c7\u30fc\u30bf\u3092\u8a2d\u5b9a\u3057\u3066PublishEvent\u3067\u9001\u4fe1\u3059\u308b\u90e8\u5206\u3067\u3059\u3002\n\nbeater/winappbeat.go\n            event := common.MapStr{\n                \"@timestamp\":     common.Time(time.Now()),\n                \"type\":           b.Name,\n                \"counter\":        counter,\n                \"windowname\":     w.name,\n                \"windowcategory\": w.nameCategory,\n                \"windowclass\":    w.class,\n                \"left\":           w.r.Left,\n                \"top\":            w.r.Top,\n                \"width\":          w.r.Right - w.r.Left,\n                \"height\":         w.r.Bottom - w.r.Top,\n            }\n            b.Events.PublishEvent(event)\n\n\n\nCleanup\n\u7d42\u4e86\u51e6\u7406\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\u4eca\u56de\u306f\u7279\u306b\u4f55\u3082\u3057\u307e\u305b\u3093\u3002\nfunc (bt *Winappbeat) Cleanup(b *beat.Beat) error {\n    return nil\n}\n\n\nSetup\n\u505c\u6b62\u8981\u6c42\u304c\u3042\u3063\u305f\u5834\u5408\u306e\u51e6\u7406\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\u30c1\u30e3\u30cd\u30eb\u3092\u30af\u30ed\u30fc\u30ba\u3057\u3066Run\u30e1\u30bd\u30c3\u30c9\u306e\u51e6\u7406\u3092\u7d42\u4e86\u3057\u307e\u3059\u3002\nfunc (bt *Winappbeat) Stop() {\n    close(bt.done)\n}\n\n\n\u30b3\u30f3\u30d1\u30a4\u30eb\ngo build \u3057\u3066\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u3092\u751f\u6210\u3057\u307e\u3059\u3002\ngo build -ldflags -H=windowsgui main.go\n\n\n\u5b9f\u884c\n\u751f\u6210\u3055\u308c\u305fwinappbeat.exe\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n\u9023\u643a\u78ba\u8a8d\nKibana\u304b\u3089\u30c7\u30fc\u30bf\u304c\u9023\u643a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\nevent\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u8a2d\u5b9a\u3057\u305f\u30c7\u30fc\u30bf\u304c\u9001\u3089\u308c\u3066\u304d\u3066\u307e\u3059\u306d\u3002\n\n\n\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u4f5c\u6210\n\u8d64\u88f8\u3005\u306a\u60c5\u5831\u304c\u53d6\u5f97\u3067\u304d\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u5272\u611b\u3055\u305b\u3066\u304f\u3060\u3055\u3044\u3002\n\u30cd\u30bf\u30d0\u30e9\u30b7\u3092\u3057\u305f\u3068\u304d\u306b\u5f8c\u8f29\u304b\u3089\u306f\u4e00\u7dda\u3092\u5f15\u304b\u308c\u305f\u6c17\u304c\u3057\u307e\u3059\u304c\u3001\u3057\u3063\u304b\u308a\u3068\u50cd\u3044\u3066\u307e\u3057\u305f\u3002\n\n\u307e\u3068\u3081\n\u3044\u304b\u304c\u3067\u3057\u305f\u3057\u3087\u3046\u304b\u3002\u7c21\u5358\u306b\u3067\u3059\u304cBeat\u306e\u4f7f\u3044\u65b9\u3068\u4f5c\u308a\u65b9\u3067\u3057\u305f\u3002\n\u500b\u4eba\u7684\u306b\u601d\u3046\u3068\u3053\u308d\u3068\u3057\u3066\u306f\u3001\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\nGo\u8a00\u8a9e\u5b9f\u88c5\u304cGood\n\u30af\u30ed\u30b9\u30b3\u30f3\u30d1\u30a4\u30eb\u3067\u304d\u308b\u306e\u3067\u5c55\u958b\u3057\u3084\u3059\u3044\u3001\u5b9f\u884c\u30e9\u30f3\u30bf\u30a4\u30e0\u3092\u5225\u9014\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5fc5\u8981\u304c\u306a\u3044\u306a\u3069\u3001\nBeat\u306e\u3088\u3046\u306a\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u578b\u306e\u30c4\u30fc\u30eb\u3068\u306e\u76f8\u6027\u3044\u3044\u306a\u3068\u611f\u3058\u307e\u3057\u305f\u3002\n\u3000\n\u500b\u3005\u306eBeats\u304c\u300c\u5c0f\u3055\u304f\u300d\u300c\u758e\u300d\u3067\u3042\u308b\u3053\u3068\u304cGood\n1\u3064\u306e\u30c9\u3067\u304b\u3044\u30d0\u30a4\u30ca\u30ea\u3067\u306f\u306a\u304f\u3001\u5fc5\u8981\u306a\u3082\u306e\u3092\u5fc5\u8981\u306a\u3060\u3051\u7d44\u307f\u5408\u308f\u305b\u3066\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n\u3000\n\u30c7\u30fc\u30bf\u5206\u6790\u57fa\u76e4\u3001\u53ef\u8996\u5316\u57fa\u76e4\uff08Elasticsearch + Kibana\uff09\u3068\u306e\u9023\u643a\u304c\u5bb9\u6613\u306a\u3068\u3053\u308d\u304cGood\n\u4eca\u56de\u306e\u3088\u3046\u306bKibana\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3082\u30bb\u30c3\u30c8\u3067\u914d\u5e03\u3059\u308c\u3070\u3001\u77ac\u6bba\u3067\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u307e\u3067\u3067\u304d\u307e\u3059\u3002\n\u3000\nElasticsearch, Logstash\u4ee5\u5916\u306b\u3082\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u30ec\u30d9\u30eb\u3067\u9023\u643a\u5148\u304c\u9078\u3079\u308b\u3068\u5b09\u3057\u3044\u3002\n\n\n\u53c2\u8003\n\nhttp://acro-engineer.hatenablog.com/entry/2015/12/20/215357\nhttp://dev.classmethod.jp/server-side/elasticsearch/develop-beats-by-beats-generator/\n\n# Beats\u3068\u306f\uff1f\n\n![beats-petals.png](https://qiita-image-store.s3.amazonaws.com/0/42275/a6b76df5-0e09-d2a7-271d-aaa35d2d3714.png)\n\u516c\u5f0f\uff1ahttps://www.elastic.co/products/beats\nLogstash, Elasticsearch, Kibana\u3067\u77e5\u3089\u308c\u308belastic\u793e\u306e\u65b0\u30d7\u30ed\u30c0\u30af\u30c8\u3067\u3059\u3002\n\u4e00\u8a00\u3067\u8a00\u3048\u3070\u3001\u3055\u307e\u3056\u307e\u306a\u30c7\u30fc\u30bf\u3092\u53ce\u96c6\u30fb\u52a0\u5de5\u3057\u3066\u8ee2\u9001\u3059\u308b\u30c4\u30fc\u30eb\u306e\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3067\u3059\u3002\n\u300cfluentd\u300d\u3084\u300cLogstash\u300d\u306e\u3088\u3046\u306a\u3082\u306e\u3068\u3044\u3048\u3070\u30a4\u30e1\u30fc\u30b8\u304c\u6e67\u304f\u3067\u3057\u3087\u3046\u304b\u3002\n\n\n2015\u5e7411\u670824\u65e5\u306bv1.0.0\u304c\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u3001\u5f53\u8a18\u4e8b\u57f7\u7b46\u6642\u70b9\u3067v1.1.2\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n## \u7279\u5fb4\n\n* \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3068\u3057\u3066Elasticsearch, Logstash\u3092\u60f3\u5b9a\n* \u6a5f\u80fd\u304c\u975e\u5e38\u306b\u30b7\u30f3\u30d7\u30eb\u3067\u8efd\u3044\n* Go\u8a00\u8a9e\u5b9f\u88c5\n * \u30de\u30eb\u30c1\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\n * \u5225\u9014\u30e9\u30f3\u30bf\u30a4\u30e0\uff08JVM\u3068\u304b\uff09\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4e0d\u8981\n* \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306fYAML\u5f62\u5f0f\n\n## \u516c\u958b\u3055\u308c\u3066\u3044\u308bBeat\n\nelastic\u793e\u304b\u3089\u516c\u958b\u3055\u308c\u3066\u3044\u308bBeat\u306f\u6b21\u306e4\u3064\u3068\u306a\u308a\u307e\u3059\u3002\n\n| \u540d\u79f0       | \u6982\u8981                                        |\n|------------|---------------------------------------------|\n| Packetbeat | \u30d1\u30b1\u30c3\u30c8\u60c5\u5831\u3092\u53ce\u96c6\u3059\u308bBeat                  |\n| Topbeat    | CPU\u3084\u30e1\u30e2\u30ea\u306a\u3069\u306e\u30ea\u30bd\u30fc\u30b9\u60c5\u5831\u3092\u53ce\u96c6\u3059\u308bBeat |\n| Filebeat   | \u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u53ce\u96c6\u3059\u308bBeat                  |\n| Winlogbeat | Windows\u306e\u30a4\u30d9\u30f3\u30c8\u30ed\u30b0\u3092\u53ce\u96c6\u3059\u308bBeat         |\n\nOSS\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u304b\u3089\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308bBeat\u3082\u6570\u591a\u304f\u3042\u308a\u307e\u3059\u3002\nhttps://www.elastic.co/guide/en/beats/libbeat/current/community-beats.html\n\n## \u69cb\u6210\n\n![beats-platform.png](https://qiita-image-store.s3.amazonaws.com/0/42275/a672ecfc-d17b-faf5-99ed-86b1e2447796.png)\n\nBeats\u306f\u300clibbeat\u300d\u3068\u3044\u3046\u5171\u901a\u6a5f\u80fd\uff08\u30c7\u30fc\u30bf\u9001\u4fe1\u3001\u8a2d\u5b9a\u7ba1\u7406\u3001\u30ed\u30ae\u30f3\u30b0 etc...\uff09\u3092\u63d0\u4f9b\u3059\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3068\n\u30c7\u30fc\u30bf\u306e\u7a2e\u985e\u306b\u5fdc\u3058\u3066\u53ce\u96c6\u30fb\u52a0\u5de5\u3092\u62c5\u3046\u500b\u3005\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\uff08\u4e0a\u56f3\u3067\u3044\u3046Packetbeat\u3084Topbeat\uff09\u304b\u3089\u69cb\u6210\u3055\u308c\u307e\u3059\u3002\n\u500b\u3005\u306eBeat\u306f1Beat\u306b\u3064\u304d1\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u306e\u69cb\u6210\u3068\u306a\u308a\u307e\u3059\u3002\n\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u306b\u5fdc\u3058\u3066Beat\u3092\u81ea\u4f5c\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\uff08\u5f8c\u8ff0\uff09\n\n## Beats\u3068Logstash\u306e\u68f2\u307f\u5206\u3051\n\nelastic\u793e\u306e\u30c7\u30fc\u30bf\u53ce\u96c6\u30c4\u30fc\u30eb\u3068\u3057\u3066\u306fLogstash\u304c\u5b58\u5728\u3057\u307e\u3059\u304c\u3001Beats\u3068\u306e\u68f2\u307f\u5206\u3051\u306f\u3069\u3046\u306a\u308b\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\n\u4e0a\u56f3\u306e\u3068\u304a\u308a\u3001\u300c\u30c7\u30fc\u30bf\u306e\u53ce\u96c6\u300d\u306fBeats\u304c\u62c5\u5f53\u3057\u3001\u300c\u30c7\u30fc\u30bf\u306e\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3084\u52a0\u5de5\u51e6\u7406\u300d\u306fLogstash\u304c\u62c5\u5f53\u3059\u308b\u3068\u3044\u3046\u68f2\u307f\u5206\u3051\u306b\u306a\u308a\u305d\u3046\u3067\u3059\u3002\n\u307e\u305fBeats\u306fElasticsearch, Logstash, File, Console, Redis\uff08\u975e\u63a8\u5968\uff09\u306b\u5bfe\u3057\u3066\u3057\u304b\u30c7\u30fc\u30bf\u9023\u643a\u304c\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u305d\u306e\u4ed6\u306e\u5a92\u4f53\u306b\u30c7\u30fc\u30bf\u3092\u9023\u643a\u3057\u305f\u3044\u5834\u5408\u306f\u3001\u4e00\u65e6Logstash\u3092\u7d4c\u7531\u3059\u308b\u5f62\u306b\u306a\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u4eca\u307e\u3067elastic\u793e\u306e\u30c7\u30fc\u30bf\u53ef\u8996\u5316\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3068\u3057\u3066\u5404\u30c4\u30fc\u30eb\u306e\u982d\u6587\u5b57\u3092\u3068\u3063\u3066\u300cELK\u300d\uff08Elasticsearch + Logstash + Kibana\uff09\u3068\u8a00\u308f\u308c\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u4eca\u5f8c\u306f\u300cBELK\u300d\uff08Beats + Elasticsearch + Logstash + Kibana\uff09\u306a\u3044\u3057\u300cBLK\u300d\uff08Beats + Logstash + Kibana\uff09\u306b\u306a\u3063\u3066\u3044\u304f\u3068\u3044\u3046\u611f\u3058\u3067\u3057\u3087\u3046\u304b\u3002\n\n# \u4f7f\u3063\u3066\u307f\u305f\n\n\u4eca\u56de\u306f\u516c\u5f0f\u304b\u3089\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308bBeats\u306e\u4e2d\u304b\u3089\u300cTopbeat\u300d\u3092\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\n## \u74b0\u5883\u60c5\u5831\n\n* OS\uff1aCentOS6.5 on VirtualBox + Vagrant\n* Beats\uff1a1.1.2\n* Elasticsearch\uff1a2.1.0\n* Kibana\uff1a4.3.0\n\n\u203b Elasticsearch\u3068Kibana\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u524d\u63d0\u3068\u3057\u307e\u3059\u3002\n\n## Topbeat\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nhttps://www.elastic.co/guide/en/beats/topbeat/current/topbeat-installation.html\napt\u3068yum\u3067\u5229\u7528\u53ef\u80fd\u306a\u30ea\u30dd\u30b8\u30c8\u30ea\u304c\u3042\u308a\u307e\u3059\u3002\u4eca\u56de\u306fyum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n1 . \u516c\u958b\u9375\u30a4\u30f3\u30dd\u30fc\u30c8\n\n```bash\nrpm --import https://packages.elastic.co/GPG-KEY-elasticsearch\n```\n\n2 . \u30ea\u30dd\u30b8\u30c8\u30ea\u8ffd\u52a0\n\n```yaml:/etc/yum.repos.d/:beats.repo\n[beats]\nname=Elastic Beats Repository\nbaseurl=https://packages.elastic.co/beats/yum/el/$basearch\nenabled=1\ngpgkey=https://packages.elastic.co/GPG-KEY-elasticsearch\ngpgcheck=1\n```\n\n3 . \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\nyum install topbeat\n```\n\n\u203bdeb, rpm, tgz, zip\u5f62\u5f0f\u3067\u3082\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u3002Windows\u306e\u5834\u5408\u306fZIP\u3092\u843d\u3068\u3057\u307e\u3057\u3087\u3046\u3002\n\n## Topbeat\u8a2d\u5b9a\n\n\u6700\u4f4e\u9650\u306e\u8a2d\u5b9a\u3068\u3057\u3066\u30c7\u30fc\u30bf\u8ee2\u9001\u5148\uff08\u4eca\u56de\u306fElasticsearch\uff09\u306e\u30a2\u30c9\u30ec\u30b9\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n```yaml:/etc/topbeat/topbeat.yml\noutput:\n\n  ### Elasticsearch as output\n  elasticsearch:\n    # Array of hosts to connect to.\n    # Scheme and port can be left out and will be set to the default (http and 9200)\n    # In case you specify and additional path, the scheme is required: http://localhost:9200/path\n    # IPv6 addresses should always be defined as: https://[2001:db8::1]:9200\n    hosts: [\"localhost:9200\"]\n```\n\n## Elasticsearch\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u5b9a\u7fa9\n\n `topbeat.template.json` \u3092Elasticsearch\u306b\u98df\u308f\u305b\u3066\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u5b9a\u7fa9\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\ncurl -XPUT 'http://localhost:9200/_template/topbeat' -d@/etc/topbeat/topbeat.template.json\n```\n\n## Topbeat\u8d77\u52d5\n\n```bash\nservice topbeat start\n```\n\n## \u53ef\u8996\u5316\n\nKibana\u304b\u3089\u30c7\u30fc\u30bf\u304c\u9023\u643a\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u540d\u306f `topbeat-*` \u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n![KibanaDiscover.png](https://qiita-image-store.s3.amazonaws.com/0/42275/afe18d52-935d-519c-0fb8-8d94fb9bc9ad.png)\n\n\u306a\u3093\u3068Topbeat\u7528\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306e\u30b5\u30f3\u30d7\u30eb\u307e\u3067\u3082github\u3067\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nhttps://github.com/elastic/beats-dashboards\n\n\u76f4\u4e0b\u306e\u30b7\u30a7\u30eb\u53e9\u3044\u3066Dashboard\u5b9a\u7fa9\u3092Elasticsearch\u306b\u98df\u308f\u305b\u308c\u3070OK\u3067\u3059\u3002\n\n```\n./load.sh -url \"http://localhost:9200\"\n```\n\nTopbeat\u7528\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u958b\u304f\u3068\u30de\u30b7\u30f3\u6bce/\u30d7\u30ed\u30bb\u30b9\u6bce\u306eCPU\u4f7f\u7528\u7387\u3084\u3089\u30e1\u30e2\u30ea\u4f7f\u7528\u7387\u3084\u3089\u304c\n\u53ef\u8996\u5316\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n![KibanaDashboard.png](https://qiita-image-store.s3.amazonaws.com/0/42275/ffdfe0c3-3585-0bf0-c731-666fbf4ff67e.png)\n\n## \u3053\u3053\u307e\u3067\n\n\u308f\u305a\u304b10\u5206\u7a0b\u5ea6\u3067\u4f5c\u696d\u3067\u304d\u307e\u3057\u305f\u3002\u7269\u51c4\u3044\u624b\u8efd\u3067\u3059\u306d\u3002\n\n# \u4f5c\u3063\u3066\u307f\u305f\n\nDeveloper Guide\u304c\u63d0\u4f9b\u3055\u308c\u3066\u307e\u3059\u306e\u3067\u3001\u30aa\u30ea\u30b8\u30ca\u30eb\u306aBeat\u3092\u4f5c\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\nhttps://www.elastic.co/guide/en/beats/libbeat/current/new-beat.html\n\n## \u4eca\u56de\u4f5c\u308bBeat\n\n\u4eca\u56de\u306fWindows\u306e\u8d77\u52d5\u3057\u3066\u3044\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30bf\u30b9\u30af\u4e00\u89a7\uff08\u30d7\u30ed\u30bb\u30b9\u3067\u306f\u306a\u3044\uff09\u3092\u53ce\u96c6\u3059\u308bBeat\n\u901a\u79f0\u300cWinappbeat\u300d\u3092\u4f5c\u6210\u3057\u3066\u307f\u307e\u3059\u3002\n\n![task.png](https://qiita-image-store.s3.amazonaws.com/0/42275/de61f6a6-ee31-c5e4-5e3d-1a0251b038ed.png)\n\n\u52d5\u6a5f\u306f\u3053\u308c\u3092\u5f8c\u8f29\u306ePC\u306b\u4ed5\u8fbc\u3093\u3067\u3001\u696d\u52d9\u4e2d\u4f55\u3084\u3063\u3066\u308b\u306e\u304b\u76e3\u8996\u3057\u305f\u3044\u306a\u30fc\u3068\u3044\u3046\u60aa\u5de7\u307f\u3067\u3059\u3002\n\u307e\u3042\u3001\u30cd\u30bf\u306f\u4f55\u3067\u3082\u3044\u3044\u3093\u3067\u3059\u3002(;^_^A\n\n## \u69cb\u6210\n\n![beat_overview.png](https://qiita-image-store.s3.amazonaws.com/0/42275/e43c7713-3407-1213-aa4d-99823fc1bfec.png)\n\n\u5148\u306b\u3082\u8aac\u660e\u3057\u307e\u3057\u305f\u304c\u3001Beat\u306f\u4e3b\u306b\u300c\u30c7\u30fc\u30bf\u53ce\u96c6\u3092\u306b\u62c5\u3046\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u300d\u3068\u300c\u30c7\u30fc\u30bf\u3092\u9001\u4fe1\u3059\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\uff08Publisher\uff09\u300d\u306e2\u3064\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304b\u3089\u69cb\u6210\u3055\u308c\u307e\u3059\u3002\n\u5f8c\u8005\u306e\u300cPublisher\u300d\u3092\u542b\u3080\u300c\u8a2d\u5b9a\u7ba1\u7406\u300d\u300c\u30ed\u30ae\u30f3\u30b0\u300d\u300c\u30c7\u30fc\u30e2\u30f3/\u30b5\u30fc\u30d3\u30b9\u300d\u3068\u3044\u3063\u305f\u57fa\u672c\u6a5f\u80fd\u306f\u300clibbeat\u300d\u3068\u3044\u3046\u5171\u901a\u6a5f\u80fd\u3068\u3057\u3066\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u958b\u767a\u3059\u308b\u5834\u5408\u306f\u300c\u30c7\u30fc\u30bf\u53ce\u96c6\u3092\u306b\u62c5\u3046\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\uff08Beat custom logic\uff09\u300d\u90e8\u5206\u3060\u3051\u3092\u5b9f\u88c5\u3059\u308c\u3070\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002\n\n## \u74b0\u5883\u60c5\u5831\n\n* OS\uff1aWindows7\n* Go\uff1a1.6\n\n\u203bGo\u8a00\u8a9e\u3067\u958b\u767a\u3059\u308b\u305f\u3081\u306e\u57fa\u672c\u7684\u306a\u8a2d\u5b9a\u306f\u5b8c\u4e86\u3057\u3066\u3044\u308b\u524d\u63d0\u3068\u3057\u307e\u3059\u3002\n\n## libbeat\u53d6\u5f97\n\n\u516c\u5f0f\u3067\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308blibbeat\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092 `go get` \u3057\u307e\u3059\u3002\n\n```\ngo get github.com/elastic/beats\n```\n\n## Beat\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u751f\u6210\n\n0\u304b\u3089\u4f5c\u3063\u3066\u3082\u3044\u3044\u306e\u3067\u3059\u304c\u3001\nbeat-generator\u3068\u3044\u3046\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u304c\u516c\u958b\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u5229\u7528\u3057\u307e\u3059\u3002\nhttps://github.com/elastic/beat-generator\n\u203bPython\u3001Cookiecutter\u304c\u4e8b\u524d\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\n\n```bat\ncookiecutter https://github.com/elastic/beat-generator.git\n```\n\nBeat\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\uff08projectname\u3092\u5c0b\u306d\u3089\u308c\u308b\u306e\u3067Winappbeat\u3092\u6307\u5b9a\uff09\n\n```\nwinappbeat\n\u2502  .gitattributes\n\u2502  .gitignore\n\u2502  .travis.yml\n\u2502  CONTRIBUTING.md\n\u2502  glide.yaml\n\u2502  LICENSE\n\u2502  main.go\n\u2502  main_test.go\n\u2502  Makefile\n\u2502  README.md\n\u2502  winappbeat.yml       \u203b\n\u2502\n\u251c\u2500beater\n\u2502      winappbeat.go    \u203b\n\u2502\n\u251c\u2500config\n\u2502      config.go        \u203b\n\u2502\n\u251c\u2500docs\n\u2502      index.asciidoc\n\u2502\n\u251c\u2500etc\n\u2502      beat.yml\n\u2502      fields.yml\n\u2502      winappbeat.template.json\n\u2502\n\u2514\u2500tests\n   \u2514\u2500system\n       \u2502  requirements.txt\n       \u2502  test_base.py\n       \u2502  winappbeat.py\n       \u2502\n       \u2514\u2500config\n               winappbeat.yml.j2\n```\n\n\u6700\u4f4e\u9650\u5b9f\u88c5\u3059\u3079\u304d\u30d5\u30a1\u30a4\u30eb\u306f\u300c\u203b\u300d\u3092\u4ed8\u4e0e\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3068\u306a\u308a\u307e\u3059\u3002\n\u9806\u3092\u8ffd\u3063\u3066\u898b\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\n\n## \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n\n\u4eca\u56de\u306f\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u9593\u9694\uff08\u30df\u30ea\u79d2\uff09\u3092\u8a2d\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u307e\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u4e00\u89a7\u306fWindows\u306e`EnumWindows`\u95a2\u6570\u3092\u5229\u7528\u3057\u3066\u53d6\u5f97\u3057\u307e\u3059\u304c\u3001\n\u300c\u30a6\u30a3\u30f3\u30c9\u30a6\u540d\u304c\u7a7a\u306e\u30a6\u30a3\u30f3\u30c9\u30a6\u3092\u53d6\u5f97\u3059\u308b\u304b\u3069\u3046\u304b\u300d\u3068\u300c\u4e0d\u53ef\u8996\u30a6\u30a3\u30f3\u30c9\u30a6\u3092\u53d6\u5f97\u3059\u308b\u304b\u3069\u3046\u304b\u300d\u306f\u9078\u629e\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u4eca\u56de\u306f\u30a6\u30a3\u30f3\u30c9\u30a6\u540d\u304c\u7a7a\u3067\u306f\u306a\u3044\u53ef\u8996\u30a6\u30a3\u30f3\u30c9\u30a6\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n```yaml:winappbeat.yml\ninput:\n  # Defines how often an event is sent to the output\n  period: 10s\n  # Whether to get only window that has name\n  onlyNotEmpty: true\n  # Whether to get only visible window\n  onlyVisible: true\n```\n\n## \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u5bfe\u5fdc\u3059\u308b\u69cb\u9020\u4f53\u3092\u5b9f\u88c5\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u5bfe\u5fdc\u3059\u308b\u69cb\u9020\u4f53\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\n```go:config/config.go\npackage config\n\ntype Config struct {\n\tWinappbeat WinappbeatConfig\n}\n\ntype WinappbeatConfig struct {\n\tPeriod       string `yaml:\"period\"`\n\tOnlyNotEmpty string `yaml:\"onlyNotEmpty\"`\n\tOnlyVisible  string `yaml:\"onlyVisible\"`\n}\n```\n\n## \u30c7\u30fc\u30bf\u53d6\u5f97\u30fb\u8ee2\u9001\u30ed\u30b8\u30c3\u30af\u3092\u5b9f\u88c5\n\n\u3044\u308f\u3086\u308b\u30e1\u30a4\u30f3\u3068\u306a\u308b\u51e6\u7406\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\u958b\u767a\u8005\u306flibbeat\u304c\u63d0\u4f9b\u3059\u308b`Beater`\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u4ee5\u4e0b\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u88c5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```go\ntype Beater interface {\n\tConfig(*Beat) error\n\tSetup(*Beat) error\n\tRun(*Beat) error\n\tCleanup(*Beat) error\n\tStop()\n}\n```\n\n* Config\u3000\u2026\u3000\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u6271\u3046\u30e1\u30bd\u30c3\u30c9\n* Setup\u3000\u2026\u3000\u521d\u671f\u51e6\u7406\u3092\u884c\u3046\u30e1\u30bd\u30c3\u30c9\n* Run\u3000\u2026\u3000\u30c7\u30fc\u30bf\u53ce\u96c6\u306e\u30e1\u30a4\u30f3\u51e6\u7406\u3092\u884c\u3046\u30e1\u30bd\u30c3\u30c9\n* Cleanup\u3000\u2026\u3000\u7d42\u4e86\u51e6\u7406\u3092\u884c\u3046\u30e1\u30bd\u30c3\u30c9\n* Stop\u3000\u2026\u3000\u505c\u6b62\u8981\u6c42\u304c\u3042\u3063\u305f\u5834\u5408\u306e\u51e6\u7406\u3092\u884c\u3046\u30e1\u30bd\u30c3\u30c9\n\n### Config\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\u3092\u884c\u3046\u51e6\u7406\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\n```go:beater/winappbeat.go\nfunc (bt *Winappbeat) Config(b *beat.Beat) error {\n\t// Load beater configuration\n\terr := cfgfile.Read(&bt.Configuration, \"\")\n\tif err != nil {\n\t\treturn fmt.Errorf(\"Error reading config file: %v\", err)\n\t}\n\treturn nil\n}\n```\n\n### Setup\n\n\u521d\u671f\u51e6\u7406\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u5024\u304c\u30bb\u30c3\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u30bb\u30c3\u30c8\u3057\u307e\u3059\u3002\n\n```go:beater/winappbeat.go\nfunc (bt *Winappbeat) Setup(b *beat.Beat) error {\n\t// Setting default period if not set\n\tif bt.Configuration.Winappbeat.Period == \"\" {\n\t\tbt.Configuration.Winappbeat.Period = \"30s\"\n\t}\n\tvar err error\n\tbt.period, err = time.ParseDuration(bt.Configuration.Winappbeat.Period)\n\tif err != nil {\n\t\treturn err\n\t}\n\t// Setting default onlyNotEmpty if not set\n\tif bt.Configuration.Winappbeat.OnlyNotEmpty == \"\" {\n\t\tbt.Configuration.Winappbeat.OnlyNotEmpty = \"true\"\n\t}\n\tbt.onlyNotEmpty, err = strconv.ParseBool(bt.Configuration.Winappbeat.OnlyNotEmpty)\n\tif err != nil {\n\t\treturn err\n\t}\n\t// Setting default onlyVisible if not set\n\tif bt.Configuration.Winappbeat.OnlyVisible == \"\" {\n\t\tbt.Configuration.Winappbeat.OnlyVisible = \"true\"\n\t}\n\tbt.onlyVisible, err = strconv.ParseBool(bt.Configuration.Winappbeat.OnlyVisible)\n\tif err != nil {\n\t\treturn err\n\t}\n\treturn nil\n}\n```\n\n### Run\n\n\u30e1\u30a4\u30f3\u30ed\u30b8\u30c3\u30af\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u8a2d\u5b9a\u3057\u305f\u9593\u9694\u6bce\u306b\u3001Windows\u306e\u8d77\u52d5\u4e2d\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u53d6\u5f97\u3057\u3066\u3001\nElasticsearch\u306b\u9023\u643a\u3059\u308b\u51e6\u7406\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\n```go:beater/winappbeat.go\nfunc (bt *Winappbeat) Run(b *beat.Beat) error {\n\tticker := time.NewTicker(bt.period)\n\tcounter := 1\n\tfor {\n\t\tselect {\n\t\tcase <-bt.done:\n\t\t\treturn nil\n\t\tcase <-ticker.C:\n\t\t}\n\n\t\tlist := listWindows(win.HWND(0))\n\t\tfor _, w := range list {\n\t\t\tevent := common.MapStr{\n\t\t\t\t\"@timestamp\":     common.Time(time.Now()),\n\t\t\t\t\"type\":           b.Name,\n\t\t\t\t\"counter\":        counter,\n\t\t\t\t\"windowname\":     w.name,\n\t\t\t\t\"windowcategory\": w.nameCategory,\n\t\t\t\t\"windowclass\":    w.class,\n\t\t\t\t\"left\":           w.r.Left,\n\t\t\t\t\"top\":            w.r.Top,\n\t\t\t\t\"width\":          w.r.Right - w.r.Left,\n\t\t\t\t\"height\":         w.r.Bottom - w.r.Top,\n\t\t\t}\n\t\t\tb.Events.PublishEvent(event)\n\t\t}\n\t\tcounter++\n\t}\n}\n\nfunc listWindows(hwnd win.HWND) []window {\n\tvar d cbData\n\td.list = make([]window, 0)\n\td.pid = make(map[uint32]string)\n\twin.EnumChildWindows(hwnd, syscall.NewCallback(perWindow), uintptr(unsafe.Pointer(&d)))\n\treturn d.list\n}\n\nfunc perWindow(hwnd win.HWND, param uintptr) uintptr {\n\td := (*cbData)(unsafe.Pointer(param))\n\tw := window{hwnd: hwnd}\n\tw.visible = win.IsWindowVisible(hwnd)\n\twin.GetWindowRect(hwnd, &w.r)\n\tw.name = getWindowName(hwnd, getWindowText)\n\tslice := strings.Split(w.name, \" - \")\n\tw.nameCategory = slice[len(slice)-1]\n\tw.hasChild = win.GetWindow(hwnd, win.GW_CHILD) != 0\n\tif w.name != \"\" {\n\t\tif w.visible {\n\t\t\td.list = append(d.list, w)\n\t\t}\n\t}\n\treturn 1\n}\n\nfunc getWindowName(hwnd win.HWND, get *syscall.LazyProc) string {\n\n\tconst bufSiz = 512\n\n\tvar buf [bufSiz]uint16\n\tsiz, _, _ := get.Call(uintptr(hwnd), uintptr(unsafe.Pointer(&buf[0])), uintptr(len(buf)))\n\tif siz == 0 {\n\t\treturn \"\"\n\t}\n\tname := syscall.UTF16ToString(buf[:siz])\n\tif siz == bufSiz-1 {\n\t\tname = name + \"\\u22EF\"\n\t}\n\treturn name\n}\n```\n\n\u5c11\u3057\u9577\u304f\u306a\u3063\u3063\u3066\u307e\u3059\u304c\u3001\u809d\u306f`event`\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u30c7\u30fc\u30bf\u3092\u8a2d\u5b9a\u3057\u3066`PublishEvent`\u3067\u9001\u4fe1\u3059\u308b\u90e8\u5206\u3067\u3059\u3002\n\n```go:beater/winappbeat.go\n\t\t\tevent := common.MapStr{\n\t\t\t\t\"@timestamp\":     common.Time(time.Now()),\n\t\t\t\t\"type\":           b.Name,\n\t\t\t\t\"counter\":        counter,\n\t\t\t\t\"windowname\":     w.name,\n\t\t\t\t\"windowcategory\": w.nameCategory,\n\t\t\t\t\"windowclass\":    w.class,\n\t\t\t\t\"left\":           w.r.Left,\n\t\t\t\t\"top\":            w.r.Top,\n\t\t\t\t\"width\":          w.r.Right - w.r.Left,\n\t\t\t\t\"height\":         w.r.Bottom - w.r.Top,\n\t\t\t}\n\t\t\tb.Events.PublishEvent(event)\n```\n\n### Cleanup\n\n\u7d42\u4e86\u51e6\u7406\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\u4eca\u56de\u306f\u7279\u306b\u4f55\u3082\u3057\u307e\u305b\u3093\u3002\n\n```go\nfunc (bt *Winappbeat) Cleanup(b *beat.Beat) error {\n\treturn nil\n}\n```\n\n### Setup\n\n\u505c\u6b62\u8981\u6c42\u304c\u3042\u3063\u305f\u5834\u5408\u306e\u51e6\u7406\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\u30c1\u30e3\u30cd\u30eb\u3092\u30af\u30ed\u30fc\u30ba\u3057\u3066`Run`\u30e1\u30bd\u30c3\u30c9\u306e\u51e6\u7406\u3092\u7d42\u4e86\u3057\u307e\u3059\u3002\n\n```go\nfunc (bt *Winappbeat) Stop() {\n\tclose(bt.done)\n}\n```\n\n## \u30b3\u30f3\u30d1\u30a4\u30eb\n\n`go build` \u3057\u3066\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u3092\u751f\u6210\u3057\u307e\u3059\u3002\n\n```bat\ngo build -ldflags -H=windowsgui main.go\n```\n\n## \u5b9f\u884c\n\n\u751f\u6210\u3055\u308c\u305fwinappbeat.exe\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n## \u9023\u643a\u78ba\u8a8d\n\nKibana\u304b\u3089\u30c7\u30fc\u30bf\u304c\u9023\u643a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n`event`\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u8a2d\u5b9a\u3057\u305f\u30c7\u30fc\u30bf\u304c\u9001\u3089\u308c\u3066\u304d\u3066\u307e\u3059\u306d\u3002\n\n![visualize.PNG](https://qiita-image-store.s3.amazonaws.com/0/42275/ad2b305f-2782-9ff2-f29c-7278505a13b4.png)\n\n## \u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u4f5c\u6210\n\n\u8d64\u88f8\u3005\u306a\u60c5\u5831\u304c\u53d6\u5f97\u3067\u304d\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u5272\u611b\u3055\u305b\u3066\u304f\u3060\u3055\u3044\u3002\n\u30cd\u30bf\u30d0\u30e9\u30b7\u3092\u3057\u305f\u3068\u304d\u306b\u5f8c\u8f29\u304b\u3089\u306f\u4e00\u7dda\u3092\u5f15\u304b\u308c\u305f\u6c17\u304c\u3057\u307e\u3059\u304c\u3001\u3057\u3063\u304b\u308a\u3068\u50cd\u3044\u3066\u307e\u3057\u305f\u3002\n\n# \u307e\u3068\u3081\n\n\u3044\u304b\u304c\u3067\u3057\u305f\u3057\u3087\u3046\u304b\u3002\u7c21\u5358\u306b\u3067\u3059\u304cBeat\u306e\u4f7f\u3044\u65b9\u3068\u4f5c\u308a\u65b9\u3067\u3057\u305f\u3002\n\u500b\u4eba\u7684\u306b\u601d\u3046\u3068\u3053\u308d\u3068\u3057\u3066\u306f\u3001\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n* Go\u8a00\u8a9e\u5b9f\u88c5\u304cGood\n\u30af\u30ed\u30b9\u30b3\u30f3\u30d1\u30a4\u30eb\u3067\u304d\u308b\u306e\u3067\u5c55\u958b\u3057\u3084\u3059\u3044\u3001\u5b9f\u884c\u30e9\u30f3\u30bf\u30a4\u30e0\u3092\u5225\u9014\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5fc5\u8981\u304c\u306a\u3044\u306a\u3069\u3001\nBeat\u306e\u3088\u3046\u306a\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u578b\u306e\u30c4\u30fc\u30eb\u3068\u306e\u76f8\u6027\u3044\u3044\u306a\u3068\u611f\u3058\u307e\u3057\u305f\u3002\n\u3000\n\n* \u500b\u3005\u306eBeats\u304c\u300c\u5c0f\u3055\u304f\u300d\u300c\u758e\u300d\u3067\u3042\u308b\u3053\u3068\u304cGood\n1\u3064\u306e\u30c9\u3067\u304b\u3044\u30d0\u30a4\u30ca\u30ea\u3067\u306f\u306a\u304f\u3001\u5fc5\u8981\u306a\u3082\u306e\u3092\u5fc5\u8981\u306a\u3060\u3051\u7d44\u307f\u5408\u308f\u305b\u3066\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n\u3000\n\n* \u30c7\u30fc\u30bf\u5206\u6790\u57fa\u76e4\u3001\u53ef\u8996\u5316\u57fa\u76e4\uff08Elasticsearch + Kibana\uff09\u3068\u306e\u9023\u643a\u304c\u5bb9\u6613\u306a\u3068\u3053\u308d\u304cGood\n\u4eca\u56de\u306e\u3088\u3046\u306bKibana\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3082\u30bb\u30c3\u30c8\u3067\u914d\u5e03\u3059\u308c\u3070\u3001\u77ac\u6bba\u3067\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u307e\u3067\u3067\u304d\u307e\u3059\u3002\n\u3000\n\n* Elasticsearch, Logstash\u4ee5\u5916\u306b\u3082\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u30ec\u30d9\u30eb\u3067\u9023\u643a\u5148\u304c\u9078\u3079\u308b\u3068\u5b09\u3057\u3044\u3002\n\n# \u53c2\u8003\n\n* http://acro-engineer.hatenablog.com/entry/2015/12/20/215357\n* http://dev.classmethod.jp/server-side/elasticsearch/develop-beats-by-beats-generator/\n", "tags": ["Go", "Elasticsearch", "beats", "golang", "kibana"]}