{"tags": ["CircleCI", "GitHub", "Electron"], "context": " More than 1 year has passed since last update.\n\n\u52d5\u6a5f\n\u6700\u8fd1\u3001Electron\u306e\u30a2\u30d7\u30ea\u3092\u4f5c\u308a\u59cb\u3081\u307e\u3057\u305f\u3002\n\u51fa\u6765\u4e0a\u304c\u3063\u305f\u6a5f\u80fd\u3092\u3059\u3050\u306b\u516c\u958b\u3057\u305f\u3044\u306e\u3067\u3001CircleCI\u3067mac\u7528\u306eapp\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3001GitHub\u306eRelease\u306b\u4e0a\u3052\u308b\u4e8b\u306b\u3057\u307e\u3057\u305f\u3002\n\u305f\u3060\u3001master\u306e\u5909\u66f4\u306e\u5ea6\u306b\u30d0\u30fc\u30b8\u30e7\u30f3\u756a\u53f7\u3092\u4e0a\u3052\u308b\u306e\u3082\u9762\u5012\u3060\u3057\u3001Release\u306e\u30bf\u30b0\u304c\u5927\u91cf\u306b\u3042\u308b\u306e\u3082\u5fae\u5999\u306a\u6c17\u304c\u3057\u307e\u3057\u305f\u3002\n\uff08\u306a\u306b\u3088\u308a\u3001\u6bce\u56detag\u3092\u624b\u52d5\u3067\u4f5c\u308b\u306e\u3082\u3081\u3093\u3069\u3044\uff09\n\u305d\u3053\u3067\u3001Release\u306f\u6bce\u56de\"\u66f4\u65b0\"\u3057\u3001package.json\u306eversion\u304c\u5909\u308f\u3063\u3066\u3044\u308b\u5834\u5408\u306e\u307fRelease\u3092\"\u8ffd\u52a0\"\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\u666e\u901a\u306f\u9006\u3068\u3044\u3046\u304b\u3001\u666e\u901a\u306e\u30d5\u30ed\u30fc\u3068\u306f\u9055\u3044\u307e\u3059\u306d\u3002\u3002\n\u4f8b\uff1a\n\nRelease\u306bv0.0.1\u304c\u5b58\u5728\u3059\u308b\u3068\u304d\u3001version\u304c0.0.1\u306e\u307e\u307emaster\u304c\u66f4\u65b0\n\u4ee5\u524d\u306e\u30bf\u30b0\u30fbRelease\u3092\u7834\u68c4\u3001\u6700\u65b0\u306emaster\u3067v0.0.1\u3092\u518d\u4f5c\u6210\u3002\nRelease\u306bv0.0.1\u304c\u5b58\u5728\u3059\u308b\u3068\u304d\u3001version\u30920.0.2\u306b\u3057\u3066master\u3092\u66f4\u65b0\nv0.0.1\u306f\u305d\u306e\u307e\u307e\u3067\u3001\u6700\u65b0\u306emaster\u3067v0.0.2\u3092\u4f5c\u6210\u3002\n\n\n\n\u624b\u9806\n\nCircleCI\u306e\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\nGitHub\u4e0a\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u5909\u66f4\u3059\u308b\u305f\u3081\u3001access token\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u3053\u3061\u3089\u3088\u308a\u3001repo\u306e\u6a29\u9650\u3092\u6301\u3064token\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\nCircleCI\u4e0a\u306eEnvironment variables\u306e\u8a2d\u5b9a\uff08 https://circleci.com/gh/:user/:repo/edit#env-vars \u5f62\u5f0f\u306eURL\uff09\u306b\u3066\u3001GITHUB_API_TOKEN\u3068\u3044\u3046key\u3067\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\nCircleCI\u306e\u9375\u3092\u66f4\u65b0\n\u5f8c\u8ff0\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3001remote\u306egit\u3088\u308a\u30bf\u30b0\u306e\u524a\u9664\u30fb\u8ffd\u52a0\u3092\u884c\u3046\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u3001CircleCI\u306e\u6301\u3064\u9375\u3092\u66f4\u65b0\u3057\u307e\u3059\u3002\uff08\u6a19\u6e96\u3067\u306fread\u6a29\u9650\u306e\u307f\uff09\nCheckout SSH keys\u306e\u8a2d\u5b9a\uff08 https://circleci.com/gh/:user/:repo/edit#checkout \u5f62\u5f0f\u306eURL\uff09\u306b\u3066\u3001\u73fe\u5728\u306e\u9375\u3092Remove\u3057\u3001\"Add deploy key\"\u3088\u308a\u65b0\u305f\u306a\u9375\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\uff08\u30dc\u30bf\u30f3\u3092\u30dd\u30c1\u30dd\u30c1\u3059\u308b\u3060\u3051\u3067\u51fa\u6765\u308b\u306e\u306f\u4fbf\u5229\u3067\u3059\u306d\u3002\uff09\n\u4e0a\u8a18\u306e\u8a2d\u5b9a\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001 https://github.com/settings/ssh \u306e\u30da\u30fc\u30b8\u306b\"CircleCI: :user/:repo\"\u3068\u3044\u3063\u305f\u9375\u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002\n\nscript\u306e\u4f5c\u6210\n\u6b21\u306b\u3001\u5b9f\u969b\u306b\u51e6\u7406\u3092\u884c\u3046\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3059\u3002\nuser\u3084repo\u3001\u4e2d\u306b\u3042\u308b\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306a\u3069\u306f\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\uff08user/repo\u3050\u3089\u3044\u306f\u3001CircleCI\u4e0a\u304b\u3089\u53d6\u308c\u307e\u3059\u306d\u3002\u3002\u624b\u629c\u304d\u3067\u3059\u3002\uff09\n\u4e0b\u8a18\u3092\u3001\u4eca\u56de\u306fbin/release\u3068\u3057\u3066\u7f6e\u304d\u307e\u3057\u305f\u3002\n\u307e\u305f\u3001chmod a+x bin/release\u3068\u3057\u3066\u5b9f\u884c\u6a29\u9650\u3092\u4e0e\u3048\u3066\u3042\u308a\u307e\u3059\u3002\n\nrelease\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n\nimport os\nimport sys\nimport subprocess\nimport httplib\nimport urllib2\nimport json\nimport copy\n\nuser = 'noboru-i'\nrepo = 'issue-hub'\ntoken = os.getenv('GITHUB_API_TOKEN')\nbranch = os.getenv('CIRCLE_BRANCH')\n\nhost = 'api.github.com'\n\nheaders = {\n    'Authorization' : 'token %s' % token,\n    'Content-Type' : 'application/json',\n    'User-Agent' : 'issue-hub release'\n}\n\n# get file name from arg\nargvs = sys.argv\nargc = len(argvs)\nif (argc != 2):\n    print 'Usage: # python %s filename' % argvs[0]\n    quit()\nfile_name = argvs[1]\n\n# get version from package.json\npackage_info = json.loads(open('package.json').read())\ntag_version = package_info['version']\n\n# get current release id or None\ndef get_release_id():\n    print 'get_release_id'\n    path = '/repos/%s/%s/releases/tags/v%s' % (user, repo, tag_version)\n    conn = httplib.HTTPSConnection(host)\n    conn.request('GET', path, None, headers)\n    resp = conn.getresponse()\n    print resp.status\n    if resp.status == 404:\n        return None\n    res = json.loads(resp.read())\n    return res['id']\n\n# delete current release by id\ndef delete_release(id):\n    print 'delete_release'\n    path = '/repos/%s/%s/releases/%s' % (user, repo, id)\n    conn = httplib.HTTPSConnection(host)\n    conn.request('DELETE', path, None, headers)\n    resp = conn.getresponse()\n    print resp.status\n\n    # delete tag\n    subprocess.call('git config --global user.email ishikura.noboru@gmail.com'.split(' '))\n    subprocess.call('git config --global user.name \"CircleCI\"'.split(' '))\n    subprocess.call(('git tag -d v%s' % tag_version).split(' '))\n    subprocess.call(('git push origin :v%s' % tag_version).split(' '))\n\n# create new release\ndef create_release():\n    print 'create_release'\n    path = '/repos/%s/%s/releases' % (user, repo)\n    params = {\n        'tag_name' : 'v%s' % tag_version,\n        'target_commitish' : branch,\n        'name' : 'v%s' % tag_version,\n        'prerelease' : True\n    }\n    conn = httplib.HTTPSConnection(host)\n    conn.request('POST', path, json.dumps(params), headers)\n    resp = conn.getresponse()\n    print resp.status\n    res = json.loads(resp.read())\n    return res\n\n# upload binary file\ndef upload_file(upload_url, file_name):\n    print 'upload_file'\n    name = os.path.basename(file_name)\n    url = upload_url.replace('{?name,label}', '?name=%s' % name)\n    print url\n    length = os.path.getsize(file_name)\n    data = open(file_name, 'rb')\n    req = urllib2.Request(url, data)\n    req.add_header('Content-Length', '%d' % length)\n    req.add_header('Content-Type', 'application/octet-stream')\n    req.add_header('Authorization', 'token %s' % token)\n    res = urllib2.urlopen(req).read()\n    return res\n\nid = get_release_id()\nprint id\n\nif id is not None:\n    delete_release(id)\n\n    # sometime create draft release\n    import time\n    time.sleep(5)\n\ncreate_result = create_release()\nprint create_result['id']\nprint create_result['upload_url']\n\nupload_result = upload_file(create_result['upload_url'], file_name)\n\n\n\ncircle.yml\u306e\u7de8\u96c6\n\u79c1\u306e\u5834\u5408\u306f\u3001npm\u306e\u30bf\u30b9\u30af\u3092\u53e9\u304d\u3001tar\u30b3\u30de\u30f3\u30c9\u3067dist/issue-hub-darwin-x64.tar.gz\u3092\u4f5c\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u5f15\u6570\u3068\u3057\u3066\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u79c1\u306e\u5b9f\u969b\u306ecircle.yml\u306f\u3053\u3061\u3089\u3067\u3059\u3002\ndeployment:\n  master:\n    branch: master\n    commands:\n      - # \u3053\u3053\u3067\u30d0\u30a4\u30ca\u30ea\u306e\u4f5c\u6210\n      - ./bin/release dist/issue-hub-darwin-x64.tar.gz\n\n\n## \u52d5\u6a5f\n\n\u6700\u8fd1\u3001[Electron\u306e\u30a2\u30d7\u30ea](https://github.com/noboru-i/issue-hub)\u3092\u4f5c\u308a\u59cb\u3081\u307e\u3057\u305f\u3002\n\n\u51fa\u6765\u4e0a\u304c\u3063\u305f\u6a5f\u80fd\u3092\u3059\u3050\u306b\u516c\u958b\u3057\u305f\u3044\u306e\u3067\u3001CircleCI\u3067mac\u7528\u306eapp\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3001GitHub\u306eRelease\u306b\u4e0a\u3052\u308b\u4e8b\u306b\u3057\u307e\u3057\u305f\u3002\n\n\u305f\u3060\u3001master\u306e\u5909\u66f4\u306e\u5ea6\u306b\u30d0\u30fc\u30b8\u30e7\u30f3\u756a\u53f7\u3092\u4e0a\u3052\u308b\u306e\u3082\u9762\u5012\u3060\u3057\u3001Release\u306e\u30bf\u30b0\u304c\u5927\u91cf\u306b\u3042\u308b\u306e\u3082\u5fae\u5999\u306a\u6c17\u304c\u3057\u307e\u3057\u305f\u3002\n\uff08\u306a\u306b\u3088\u308a\u3001\u6bce\u56detag\u3092\u624b\u52d5\u3067\u4f5c\u308b\u306e\u3082\u3081\u3093\u3069\u3044\uff09\n\n\u305d\u3053\u3067\u3001Release\u306f\u6bce\u56de\"\u66f4\u65b0\"\u3057\u3001package.json\u306e`version`\u304c\u5909\u308f\u3063\u3066\u3044\u308b\u5834\u5408\u306e\u307fRelease\u3092\"\u8ffd\u52a0\"\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\u666e\u901a\u306f\u9006\u3068\u3044\u3046\u304b\u3001\u666e\u901a\u306e\u30d5\u30ed\u30fc\u3068\u306f\u9055\u3044\u307e\u3059\u306d\u3002\u3002\n\n\u4f8b\uff1a\n\n- Release\u306b`v0.0.1`\u304c\u5b58\u5728\u3059\u308b\u3068\u304d\u3001`version`\u304c`0.0.1`\u306e\u307e\u307emaster\u304c\u66f4\u65b0  \n\u4ee5\u524d\u306e\u30bf\u30b0\u30fbRelease\u3092\u7834\u68c4\u3001\u6700\u65b0\u306emaster\u3067`v0.0.1`\u3092\u518d\u4f5c\u6210\u3002\n- Release\u306b`v0.0.1`\u304c\u5b58\u5728\u3059\u308b\u3068\u304d\u3001`version`\u3092`0.0.2`\u306b\u3057\u3066master\u3092\u66f4\u65b0  \n`v0.0.1`\u306f\u305d\u306e\u307e\u307e\u3067\u3001\u6700\u65b0\u306emaster\u3067`v0.0.2`\u3092\u4f5c\u6210\u3002\n\n![Kobito.ZaH3Rz.png](https://qiita-image-store.s3.amazonaws.com/0/8708/8f3799b0-3402-709a-73cf-55d41424a446.png \"Kobito.ZaH3Rz.png\")\n\n## \u624b\u9806\n\n### CircleCI\u306e\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\n\nGitHub\u4e0a\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u5909\u66f4\u3059\u308b\u305f\u3081\u3001access token\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n[\u3053\u3061\u3089](https://github.com/settings/tokens)\u3088\u308a\u3001`repo`\u306e\u6a29\u9650\u3092\u6301\u3064token\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\nCircleCI\u4e0a\u306eEnvironment variables\u306e\u8a2d\u5b9a\uff08 https://circleci.com/gh/:user/:repo/edit#env-vars \u5f62\u5f0f\u306eURL\uff09\u306b\u3066\u3001`GITHUB_API_TOKEN`\u3068\u3044\u3046key\u3067\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n### CircleCI\u306e\u9375\u3092\u66f4\u65b0\n\n\u5f8c\u8ff0\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3001remote\u306egit\u3088\u308a\u30bf\u30b0\u306e\u524a\u9664\u30fb\u8ffd\u52a0\u3092\u884c\u3046\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u3001CircleCI\u306e\u6301\u3064\u9375\u3092\u66f4\u65b0\u3057\u307e\u3059\u3002\uff08\u6a19\u6e96\u3067\u306fread\u6a29\u9650\u306e\u307f\uff09\n\nCheckout SSH keys\u306e\u8a2d\u5b9a\uff08 https://circleci.com/gh/:user/:repo/edit#checkout \u5f62\u5f0f\u306eURL\uff09\u306b\u3066\u3001\u73fe\u5728\u306e\u9375\u3092Remove\u3057\u3001\"Add deploy key\"\u3088\u308a\u65b0\u305f\u306a\u9375\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\uff08\u30dc\u30bf\u30f3\u3092\u30dd\u30c1\u30dd\u30c1\u3059\u308b\u3060\u3051\u3067\u51fa\u6765\u308b\u306e\u306f\u4fbf\u5229\u3067\u3059\u306d\u3002\uff09\n\n\u4e0a\u8a18\u306e\u8a2d\u5b9a\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001 https://github.com/settings/ssh \u306e\u30da\u30fc\u30b8\u306b\"CircleCI: :user/:repo\"\u3068\u3044\u3063\u305f\u9375\u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002\n\n### script\u306e\u4f5c\u6210\n\n\u6b21\u306b\u3001\u5b9f\u969b\u306b\u51e6\u7406\u3092\u884c\u3046\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3059\u3002\n`user`\u3084`repo`\u3001\u4e2d\u306b\u3042\u308b\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306a\u3069\u306f\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\uff08user/repo\u3050\u3089\u3044\u306f\u3001CircleCI\u4e0a\u304b\u3089\u53d6\u308c\u307e\u3059\u306d\u3002\u3002\u624b\u629c\u304d\u3067\u3059\u3002\uff09\n\n\u4e0b\u8a18\u3092\u3001\u4eca\u56de\u306f`bin/release`\u3068\u3057\u3066\u7f6e\u304d\u307e\u3057\u305f\u3002\n\u307e\u305f\u3001`chmod a+x bin/release`\u3068\u3057\u3066\u5b9f\u884c\u6a29\u9650\u3092\u4e0e\u3048\u3066\u3042\u308a\u307e\u3059\u3002\n\n```python:release\n#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n\nimport os\nimport sys\nimport subprocess\nimport httplib\nimport urllib2\nimport json\nimport copy\n\nuser = 'noboru-i'\nrepo = 'issue-hub'\ntoken = os.getenv('GITHUB_API_TOKEN')\nbranch = os.getenv('CIRCLE_BRANCH')\n\nhost = 'api.github.com'\n\nheaders = {\n    'Authorization' : 'token %s' % token,\n    'Content-Type' : 'application/json',\n    'User-Agent' : 'issue-hub release'\n}\n\n# get file name from arg\nargvs = sys.argv\nargc = len(argvs)\nif (argc != 2):\n    print 'Usage: # python %s filename' % argvs[0]\n    quit()\nfile_name = argvs[1]\n\n# get version from package.json\npackage_info = json.loads(open('package.json').read())\ntag_version = package_info['version']\n\n# get current release id or None\ndef get_release_id():\n    print 'get_release_id'\n    path = '/repos/%s/%s/releases/tags/v%s' % (user, repo, tag_version)\n    conn = httplib.HTTPSConnection(host)\n    conn.request('GET', path, None, headers)\n    resp = conn.getresponse()\n    print resp.status\n    if resp.status == 404:\n        return None\n    res = json.loads(resp.read())\n    return res['id']\n\n# delete current release by id\ndef delete_release(id):\n    print 'delete_release'\n    path = '/repos/%s/%s/releases/%s' % (user, repo, id)\n    conn = httplib.HTTPSConnection(host)\n    conn.request('DELETE', path, None, headers)\n    resp = conn.getresponse()\n    print resp.status\n\n    # delete tag\n    subprocess.call('git config --global user.email ishikura.noboru@gmail.com'.split(' '))\n    subprocess.call('git config --global user.name \"CircleCI\"'.split(' '))\n    subprocess.call(('git tag -d v%s' % tag_version).split(' '))\n    subprocess.call(('git push origin :v%s' % tag_version).split(' '))\n\n# create new release\ndef create_release():\n    print 'create_release'\n    path = '/repos/%s/%s/releases' % (user, repo)\n    params = {\n        'tag_name' : 'v%s' % tag_version,\n        'target_commitish' : branch,\n        'name' : 'v%s' % tag_version,\n        'prerelease' : True\n    }\n    conn = httplib.HTTPSConnection(host)\n    conn.request('POST', path, json.dumps(params), headers)\n    resp = conn.getresponse()\n    print resp.status\n    res = json.loads(resp.read())\n    return res\n\n# upload binary file\ndef upload_file(upload_url, file_name):\n    print 'upload_file'\n    name = os.path.basename(file_name)\n    url = upload_url.replace('{?name,label}', '?name=%s' % name)\n    print url\n    length = os.path.getsize(file_name)\n    data = open(file_name, 'rb')\n    req = urllib2.Request(url, data)\n    req.add_header('Content-Length', '%d' % length)\n    req.add_header('Content-Type', 'application/octet-stream')\n    req.add_header('Authorization', 'token %s' % token)\n    res = urllib2.urlopen(req).read()\n    return res\n\nid = get_release_id()\nprint id\n\nif id is not None:\n    delete_release(id)\n\n    # sometime create draft release\n    import time\n    time.sleep(5)\n\ncreate_result = create_release()\nprint create_result['id']\nprint create_result['upload_url']\n\nupload_result = upload_file(create_result['upload_url'], file_name)\n```\n\n### circle.yml\u306e\u7de8\u96c6\n\n\u79c1\u306e\u5834\u5408\u306f\u3001npm\u306e\u30bf\u30b9\u30af\u3092\u53e9\u304d\u3001tar\u30b3\u30de\u30f3\u30c9\u3067`dist/issue-hub-darwin-x64.tar.gz`\u3092\u4f5c\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u5f15\u6570\u3068\u3057\u3066\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u79c1\u306e\u5b9f\u969b\u306ecircle.yml\u306f[\u3053\u3061\u3089](https://github.com/noboru-i/issue-hub/blob/v0.0.1/circle.yml)\u3067\u3059\u3002\n\n```\ndeployment:\n  master:\n    branch: master\n    commands:\n      - # \u3053\u3053\u3067\u30d0\u30a4\u30ca\u30ea\u306e\u4f5c\u6210\n      - ./bin/release dist/issue-hub-darwin-x64.tar.gz\n```\n\n"}