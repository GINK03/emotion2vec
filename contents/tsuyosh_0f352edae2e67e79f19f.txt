{"context": " More than 1 year has passed since last update.Otto\u3092\u4f7f\u3044\u59cb\u3081\u3066\u968f\u5206\u7d4c\u3061\u307e\u3057\u305f\u3002\u7279\u306bActivity\u3068Fragment\u3068Service\u9593\u306e\u30a4\u30d9\u30f3\u30c8\u901a\u77e5\u624b\u6bb5\u3068\u3057\u3066\u5927\u5206\u52a9\u304b\u3063\u3066\u307e\u3059\u304c\u5e7e\u3064\u304b\u6c17\u3065\u3044\u305f\u70b9\u3082\u3042\u308a\u307e\u3057\u305f\u3002\n\n1. Android\u3067\u306f\u5b9f\u884c\u6642\u306e\u30b9\u30ec\u30c3\u30c9\u306b\u6ce8\u610f\n\u304a\u7d04\u675f\u3067\u3059\u304cUI\u306b\u5bfe\u3059\u308b\u5909\u66f4\u306fMain Thread\u4ee5\u5916\u3067\u306f\u51fa\u6765\u307e\u305b\u3093\u3002\nThreadEnforcer\u3067\u5b9f\u884c\u3067\u304d\u308b\u30b9\u30ec\u30c3\u30c9\u3092\u30c1\u30a7\u30c3\u30af\u3067\u304d\u307e\u3059\u304c\u9762\u5012\u304f\u3055\u3044\u5834\u5408\u306f\u4e0b\u306e\u3088\u3046\u306aBus\u306e\u62e1\u5f35\u30af\u30e9\u30b9(AndroidBus)\u3092\u4f7f\u3046\u3068\u3044\u3044\u3068\u601d\u3044\u307e\u3059\u3002(\u3053\u306e\u30b3\u30fc\u30c9\u306f\u3069\u3053\u304b\u304b\u3089\u306e\u30d1\u30af\u30ea\u3067\u3059\u304c\u5143\u30bd\u30fc\u30b9\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305fm(_ _)m)\n\nBusHolder.java\npublic class BusHolder {\n    private static final Bus sBus = new AndroidBus();\n\n    public static Bus getInstance() {\n        return sBus;\n    }\n}\n\n\n\nAndroidBus.java\npublic class AndroidBus extends Bus {\n    private final Handler mHandler = new Handler(Looper.getMainLooper());\n\n    @Override\n    public void post(final Object event) {\n        if (Looper.myLooper() == Looper.getMainLooper()) {\n            super.post(event);\n        } else {\n            // force to run post() on main thread\n            mHandler.post(new Runnable() {\n                @Override\n                public void run() {\n                    post(event);\n                }\n            });\n        }\n    }\n}\n\n\n\n\n2. \u89aa\u30af\u30e9\u30b9\u3067\u5b9a\u7fa9\u3057\u305f@Subscribe\u306f\u767b\u9332\u3055\u308c\u306a\u3044\n\u516c\u5f0f\u30b5\u30a4\u30c8\u306b\u3082\n\nUnlike the Guava event bus, Otto will not traverse the class hierarchy and add methods from base classes or interfaces that are annotated. This is an explicit design decision to improve performance of the library as well as keep your code simple and unambiguous.\n\n\u3063\u3066\u3042\u308a\u307e\u3059\u304c\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u6539\u5584\u3068\u308f\u304b\u308a\u3084\u3059\u3055\u3092\u76ee\u7684\u306b\u7d99\u627f\u3057\u3066\u3044\u308b\u30af\u30e9\u30b9\u3084\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u306f\u898b\u306a\u3044\u3088\u3046\u306b\u306a\u3063\u3066\u307e\u3059\u3002\n\u3068\u3044\u3063\u3066\u3082\u7279\u5b9a\u306eSubscriber\u306e\u51e6\u7406\u3092\u5171\u901a\u5316\u3059\u308b\u5834\u5408\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u306e\u3067\u305d\u306e\u5834\u5408\u306f\u4e0b\u306e\u3088\u3046\u306b\u3057\u3066\u56de\u907f\u3067\u304d\u307e\u3059\u3002\n\npublic class Foo extends Fragment {\n    public void onHoge(HogeEvent ev) {\n        // TODO implement\n    }\n}\n\npublic class Bar extends Foo {\n    protected void onStart() {\n        super.onStart();\n        // BusHolder is a singleton of a Bus instance\n        BusHolder.getInstance().register(this);\n    }\n\n    protected void onStop() {\n        BusHolder.getInstance().unregister(this);\n        super.onStop();\n    }\n\n    @Subscribe\n    @Override\n    public void onHoge(HogeEvent ev) {\n        super.onHoge(ev);\n    }\n}\n\n\n\n\n3. Subscriber\u5185\u3067FragmentTransaction#commit()\u3092\u5b9f\u884c\u3059\u308b\u3068IllegalStateException\u3067\u843d\u3061\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\nOtto\u306b\u9650\u3089\u305a\u3067\u3059\u304cFragment#onSaveInstanceState()\u4ee5\u964d\u306e\u72b6\u614b\u3067FragmentTransaction#commit()\u3092\u547c\u3076\u3068\n\nCaused by: java.lang.IllegalStateException: Can not perform this action after onSaveInstanceState\n\n\u3067\u843d\u3061\u307e\u3059\u3002\nOtto\u306e\u5834\u5408\u306fFragment#onStart()\u3067Bus#register()\u3057\u3066Fragment#onStop()\u3067Bus#unregister()\u3059\u308b\u306e\u304c\u4e00\u822c\u7684\u3067\u3059\u304conStop()\u306f onSaveInstanceState()\u306e\u5f8c \u306b\u5b9f\u884c\u3055\u308c\u308b\u306e\u3067\u904b\u304c\u60aa\u3044\u3068\u843d\u3061\u307e\u3059\u3002\n\u81ea\u5206\u3067\u306f\u6c17\u3065\u304b\u306a\u304f\u3066\u3082Crashlytics\u7b49\u3067\u30af\u30e9\u30c3\u30b7\u30e5\u3092\u53ce\u96c6\u3057\u3066\u3044\u308b\u3068\u601d\u3063\u305f\u4ee5\u4e0a\u306b\u51fa\u307e\u3059\u3002\nSubscriber\u5185\u3067\u306fFragmentTransaction#commitAllowingStateLoss() \u3092\u4f7f\u3046\u306e\u304c\u7121\u96e3\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\n4. \u5f15\u6570\u3092\u518d\u5229\u7528\u3059\u308b\n\u6700\u521d\u306f\nBusHolder.getInstance().post(new HogeEvent());\n\n\u307f\u305f\u3044\u306a\u4e8b\u3092\u3084\u3063\u3066\u305f\u3093\u3067\u3059\u304c\u308f\u3056\u308f\u3056\u7a7a\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u308b\u306e\u306f\u52ff\u4f53\u7121\u3044\u306e\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u53ef\u5909\u306e\u5909\u6570\u3092\u6301\u305f\u305b\u308b\u5fc5\u8981\u304c\u306a\u3044\u5834\u5408\u306fEnum\u3092\u4f7f\u3046\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\nenum HogeEvent {\n    FOO, BAR, BAZ\n\n    // \u5fc5\u8981\u306b\u5fdc\u3058\u3066\u56fa\u5b9a\u306e\u5909\u6570\u3092\u3082\u305f\u305b\u308b\u306e\u3082\u53ef\u80fd\n}\n\nBusHolder.getInstance().post(HogeEvent.FOO);\n\n\n[Otto](http://square.github.io/otto/)\u3092\u4f7f\u3044\u59cb\u3081\u3066\u968f\u5206\u7d4c\u3061\u307e\u3057\u305f\u3002\u7279\u306bActivity\u3068Fragment\u3068Service\u9593\u306e\u30a4\u30d9\u30f3\u30c8\u901a\u77e5\u624b\u6bb5\u3068\u3057\u3066\u5927\u5206\u52a9\u304b\u3063\u3066\u307e\u3059\u304c\u5e7e\u3064\u304b\u6c17\u3065\u3044\u305f\u70b9\u3082\u3042\u308a\u307e\u3057\u305f\u3002\n\n## 1. Android\u3067\u306f\u5b9f\u884c\u6642\u306e\u30b9\u30ec\u30c3\u30c9\u306b\u6ce8\u610f\n\n\u304a\u7d04\u675f\u3067\u3059\u304cUI\u306b\u5bfe\u3059\u308b\u5909\u66f4\u306fMain Thread\u4ee5\u5916\u3067\u306f\u51fa\u6765\u307e\u305b\u3093\u3002\n\nThreadEnforcer\u3067\u5b9f\u884c\u3067\u304d\u308b\u30b9\u30ec\u30c3\u30c9\u3092\u30c1\u30a7\u30c3\u30af\u3067\u304d\u307e\u3059\u304c\u9762\u5012\u304f\u3055\u3044\u5834\u5408\u306f\u4e0b\u306e\u3088\u3046\u306aBus\u306e\u62e1\u5f35\u30af\u30e9\u30b9(AndroidBus)\u3092\u4f7f\u3046\u3068\u3044\u3044\u3068\u601d\u3044\u307e\u3059\u3002(\u3053\u306e\u30b3\u30fc\u30c9\u306f\u3069\u3053\u304b\u304b\u3089\u306e\u30d1\u30af\u30ea\u3067\u3059\u304c\u5143\u30bd\u30fc\u30b9\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305fm(_ _)m)\n\n```BusHolder.java\npublic class BusHolder {\n\tprivate static final Bus sBus = new AndroidBus();\n\n\tpublic static Bus getInstance() {\n\t\treturn sBus;\n\t}\n}\n```\n\n```AndroidBus.java\npublic class AndroidBus extends Bus {\n\tprivate final Handler mHandler = new Handler(Looper.getMainLooper());\n\n\t@Override\n\tpublic void post(final Object event) {\n\t\tif (Looper.myLooper() == Looper.getMainLooper()) {\n\t\t\tsuper.post(event);\n\t\t} else {\n\t\t\t// force to run post() on main thread\n\t\t\tmHandler.post(new Runnable() {\n\t\t\t\t@Override\n\t\t\t\tpublic void run() {\n\t\t\t\t\tpost(event);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\n\n```\n\n\n## 2. \u89aa\u30af\u30e9\u30b9\u3067\u5b9a\u7fa9\u3057\u305f@Subscribe\u306f\u767b\u9332\u3055\u308c\u306a\u3044\n\n[\u516c\u5f0f\u30b5\u30a4\u30c8](http://square.github.io/otto/)\u306b\u3082\n\n>  Unlike the Guava event bus, Otto will not traverse the class hierarchy and add methods from base classes or interfaces that are annotated. This is an explicit design decision to improve performance of the library as well as keep your code simple and unambiguous.\n\n\u3063\u3066\u3042\u308a\u307e\u3059\u304c\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u6539\u5584\u3068\u308f\u304b\u308a\u3084\u3059\u3055\u3092\u76ee\u7684\u306b\u7d99\u627f\u3057\u3066\u3044\u308b\u30af\u30e9\u30b9\u3084\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u306f\u898b\u306a\u3044\u3088\u3046\u306b\u306a\u3063\u3066\u307e\u3059\u3002\n\n\u3068\u3044\u3063\u3066\u3082\u7279\u5b9a\u306eSubscriber\u306e\u51e6\u7406\u3092\u5171\u901a\u5316\u3059\u308b\u5834\u5408\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u306e\u3067\u305d\u306e\u5834\u5408\u306f\u4e0b\u306e\u3088\u3046\u306b\u3057\u3066\u56de\u907f\u3067\u304d\u307e\u3059\u3002\n\n```\n\npublic class Foo extends Fragment {\n\tpublic void onHoge(HogeEvent ev) {\n\t\t// TODO implement\n\t}\n}\n\npublic class Bar extends Foo {\n\tprotected void onStart() {\n\t\tsuper.onStart();\n\t\t// BusHolder is a singleton of a Bus instance\n\t\tBusHolder.getInstance().register(this);\n\t}\n\n\tprotected void onStop() {\n\t\tBusHolder.getInstance().unregister(this);\n\t\tsuper.onStop();\n\t}\n\n\t@Subscribe\n\t@Override\n\tpublic void onHoge(HogeEvent ev) {\n\t\tsuper.onHoge(ev);\n\t}\n}\n\n\n```\n\n## 3. Subscriber\u5185\u3067FragmentTransaction#commit()\u3092\u5b9f\u884c\u3059\u308b\u3068IllegalStateException\u3067\u843d\u3061\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\n\nOtto\u306b\u9650\u3089\u305a\u3067\u3059\u304cFragment#onSaveInstanceState()\u4ee5\u964d\u306e\u72b6\u614b\u3067FragmentTransaction#commit()\u3092\u547c\u3076\u3068\n\n> Caused by: java.lang.IllegalStateException: Can not perform this action after onSaveInstanceState\n\n\n\u3067\u843d\u3061\u307e\u3059\u3002\n\nOtto\u306e\u5834\u5408\u306fFragment#onStart()\u3067Bus#register()\u3057\u3066Fragment#onStop()\u3067Bus#unregister()\u3059\u308b\u306e\u304c\u4e00\u822c\u7684\u3067\u3059\u304conStop()\u306f **onSaveInstanceState()\u306e\u5f8c** \u306b\u5b9f\u884c\u3055\u308c\u308b\u306e\u3067\u904b\u304c\u60aa\u3044\u3068\u843d\u3061\u307e\u3059\u3002\n\n\u81ea\u5206\u3067\u306f\u6c17\u3065\u304b\u306a\u304f\u3066\u3082Crashlytics\u7b49\u3067\u30af\u30e9\u30c3\u30b7\u30e5\u3092\u53ce\u96c6\u3057\u3066\u3044\u308b\u3068\u601d\u3063\u305f\u4ee5\u4e0a\u306b\u51fa\u307e\u3059\u3002\n\nSubscriber\u5185\u3067\u306fFragmentTransaction#commitAllowingStateLoss() \u3092\u4f7f\u3046\u306e\u304c\u7121\u96e3\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\n## 4. \u5f15\u6570\u3092\u518d\u5229\u7528\u3059\u308b\n\n\u6700\u521d\u306f\n\n```\nBusHolder.getInstance().post(new HogeEvent());\n```\n\n\u307f\u305f\u3044\u306a\u4e8b\u3092\u3084\u3063\u3066\u305f\u3093\u3067\u3059\u304c\u308f\u3056\u308f\u3056\u7a7a\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u308b\u306e\u306f\u52ff\u4f53\u7121\u3044\u306e\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u53ef\u5909\u306e\u5909\u6570\u3092\u6301\u305f\u305b\u308b\u5fc5\u8981\u304c\u306a\u3044\u5834\u5408\u306fEnum\u3092\u4f7f\u3046\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\n\n```\nenum HogeEvent {\n\tFOO, BAR, BAZ\n\n\t// \u5fc5\u8981\u306b\u5fdc\u3058\u3066\u56fa\u5b9a\u306e\u5909\u6570\u3092\u3082\u305f\u305b\u308b\u306e\u3082\u53ef\u80fd\n}\n\nBusHolder.getInstance().post(HogeEvent.FOO);\n```\n", "tags": ["Android", "otto"]}