{"context": " More than 1 year has passed since last update.\u4eca\u90311\u9031\u9593\u306b\u65b0\u898f\u767b\u9332\u3057\u3066\u6628\u65e5\u30b3\u30f3\u30d0\u30fc\u30b8\u30e7\u30f3\u9054\u6210\u3057\u305f\u4eba\u306e\u3001\u4eca\u90311\u9031\u9593\u306e\u30a2\u30af\u30c6\u30a3\u30d3\u30c6\u30a3\u3092\u51fa\u3057\u305f\u3044\u3002\nselect * from\nactivity a\nLEFT SEMI JOIN\n  (select data_user_id from activity b \n  LEFT SEMI JOIN\n    (select data_user_id from activity\n      where TD_TIME_RANGE(time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-1d'), TD_SCHEDULED_TIME(), 'JST')\n      and data_type = 'premium_registration_complete'\n    ) c\n  ON b.data_user_id = c.data_user_id\n  where TD_TIME_RANGE(time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-7d'), TD_SCHEDULED_TIME(), 'JST')\n  and data_type = 'signup'\n  ) d\nON a.data_user_id = d.data_user_id\nWHERE TD_TIME_RANGE(time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-7d'), TD_SCHEDULED_TIME(), 'JST')\n;\n\n\u304b\u306a\u308a\u6642\u9593\u304b\u304b\u308b\u3002\n\n\u30b5\u30d6\u30af\u30a8\u30ea\u3060\u3051\u3067\u5b9f\u884c\nselect data_user_id from activity b \n  LEFT SEMI JOIN\n    (select data_user_id from activity\n      where TD_TIME_RANGE(time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-1d'), TD_SCHEDULED_TIME(), 'JST')\n      and data_type = 'premium_registration_complete'\n    ) c\n  ON b.data_user_id = c.data_user_id\n  where TD_TIME_RANGE(time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-7d'), TD_SCHEDULED_TIME(), 'JST')\n  and data_type = 'signup'\n;\n\nstarted at 2014-03-18T17:50:50Z\nHive history file=/mnt/hive/tmp/4080/hive_job_log__1622188538.txt\n**\n** WARNING: time index filtering is not set!\n** This query could be very slow as a result.\n** Please see http://docs.treasure-data.com/articles/performance-tuning#leveraging-time-based-partitioning\n**\nfinished at 2014-03-18T17:52:43Z\n\n\u51e6\u7406\u306f\u7d42\u308f\u308b\u3051\u3069\u8b66\u544a\u306f\u6b8b\u3063\u305f\u307e\u307e\u3002\n\nMAPJOIN\n\u4e0a\u306e\u30b1\u30fc\u30b9\u306f1\u65e5\u4ee5\u5185\u306b\u30d7\u30ec\u30df\u30a2\u30e0\u767b\u9332\u3057\u305f\u4eba\u3068\u3044\u3046\u5c0f\u3055\u306a\u30c6\u30fc\u30d6\u30eb\u3068JOIN\u3057\u3066\u3044\u308b\u306e\u3067\u3001MAPJOIN\u3092\u4f7f\u3063\u3066\u307f\u308b\u3002\nselect /*+ MAPJOIN(c) */ b.data_user_id from activity b \n  JOIN\n    (select data_user_id from activity\n      where TD_TIME_RANGE(time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-1d'), TD_SCHEDULED_TIME(), 'JST')\n      and data_type = 'premium_registration_complete'\n    ) c\n  ON b.data_user_id = c.data_user_id\n  where TD_TIME_RANGE(time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-7d'), TD_SCHEDULED_TIME(), 'JST')\n  and data_type = 'signup'\n;\n\nstarted at 2014-03-18T17:58:48Z\nHive history file=/mnt/hive/tmp/4080/hive_job_log__243448987.txt\nWARNING: org.apache.hadoop.metrics.jvm.EventCounter is deprecated. Please use org.apache.hadoop.log.metrics.EventCounter in all the log4j.properties files.\nExecution log at: /tmp/4080/4080_20140318175858_9bf02d3e-4672-46bb-9bdf-e2f4a6edef14.log\n2014-03-18 05:58:59 Starting to launch local task to process map join;  maximum memory = 763363328\n**\n** WARNING: time index filtering is not set!\n** This query could be very slow as a result.\n** Please see http://docs.treasure-data.com/articles/performance-tuning#leveraging-time-based-partitioning\n**\n2014-03-18 05:59:34 Processing rows:    1556    Hashtable size: 1556    Memory usage:   30751296    rate:   0.04\n2014-03-18 05:59:34 Dump the hashtable into file: file:/tmp/4080/hive_2014-03-18_17-58-56_440_7019263692592835974/-local-10002/HashTable-Stage-1/MapJoin-c-01--.hashtable\n2014-03-18 05:59:35 Upload 1 File to: file:/tmp/4080/hive_2014-03-18_17-58-56_440_7019263692592835974/-local-10002/HashTable-Stage-1/MapJoin-c-01--.hashtable File size: 60967\n2014-03-18 05:59:35 End of local task; Time Taken: 36.034 sec.\n**\n** Time indices:\n**    Time index: [2014-03-11 17:58:48 +0000, 2014-03-18 17:58:47 +0000)\n**\nfinished at 2014-03-18T18:00:40Z\n\n\u307e\u3060\u8b66\u544a\u51fa\u3066\u308b\u3051\u3069\u3001\u30af\u30a8\u30ea\u304c\u7d42\u308f\u3089\u306a\u3044\u3068\u3044\u3046\u3053\u3068\u306f\u306a\u304f\u306a\u3063\u305f\u3002\n\n\u66f4\u306b\u30b5\u30d6\u30af\u30a8\u30ea\u3060\u3051\u3067\u5b9f\u884c\nselect data_user_id from activity\n  where TD_TIME_RANGE(time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-1d'), TD_SCHEDULED_TIME(), 'JST')\n  and data_type = 'premium_registration_complete'\n;\n\n\u3053\u308c\u3060\u3068\u304d\u3061\u3093\u3068time\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f7f\u3063\u3066\u304f\u308c\u3066\u308b\u307f\u305f\u3044\u3002\nstarted at 2014-03-18T18:05:52Z\nHive history file=/mnt/hive/tmp/4080/hive_job_log__1081435809.txt\n**\n** Time indices:\n**    Time index: [2014-03-17 18:05:50 +0000, 2014-03-18 18:05:49 +0000)\n**\nfinished at 2014-03-18T18:06:33Z\n\n\nJOIN\u306e\u4e2d\u306bSELECT\u3092\u66f8\u304f\u306e\u3092\u3084\u3081\u3066\u307f\u308b\nselect b.data_user_id\nfrom activity b \nJOIN activity c\n  ON b.data_user_id = c.data_user_id\n  where b.data_type = 'signup'\n  and c.data_type = 'premium_registration_complete'\n  and TD_TIME_RANGE(b.time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-7d'), TD_SCHEDULED_TIME(), 'JST')\n  and TD_TIME_RANGE(c.time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-1d'), TD_SCHEDULED_TIME(), 'JST')\n;\n\nstarted at 2014-03-18T18:13:40Z\nHive history file=/mnt/hive/tmp/4080/hive_job_log__1362281004.txt\n**\n** WARNING: time index filtering is not set!\n** This query could be very slow as a result.\n** Please see http://docs.treasure-data.com/articles/performance-tuning#leveraging-time-based-partitioning\n**\nfinished at 2014-03-18T18:14:52Z\n\n\u3046\u30fc\u3080\u3002JOIN\u304c\u3060\u3081\u306a\u306e\u304b\u306a\u3002\n\n\u3053\u308c\u3092MAPJOIN\u306b\u3059\u308b\u3068\u2026\nselect /*+ MAPJOIN(c) */ b.data_user_id\nfrom activity b \nJOIN activity c\n  ON b.data_user_id = c.data_user_id\n  where b.data_type = 'signup'\n  and c.data_type = 'premium_registration_complete'\n  and TD_TIME_RANGE(b.time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-7d'), TD_SCHEDULED_TIME(), 'JST')\n  and TD_TIME_RANGE(c.time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-1d'), TD_SCHEDULED_TIME(), 'JST')\n;\n\nstarted at 2014-03-18T18:17:02Z\nHive history file=/mnt/hive/tmp/4080/hive_job_log__1019712899.txt\nWARNING: org.apache.hadoop.metrics.jvm.EventCounter is deprecated. Please use org.apache.hadoop.log.metrics.EventCounter in all the log4j.properties files.\nExecution log at: /tmp/4080/4080_20140318181717_7ccdbb60-39da-4c24-9a74-5cd8c8c852d4.log\n2014-03-18 06:17:13 Starting to launch local task to process map join;  maximum memory = 763363328\n**\n** WARNING: time index filtering is not set!\n** This query could be very slow as a result.\n** Please see http://docs.treasure-data.com/articles/performance-tuning#leveraging-time-based-partitioning\n**\n2014-03-18 06:17:31 Processing rows:    1560    Hashtable size: 1560    Memory usage:   17915440    rate:   0.023\n2014-03-18 06:17:31 Dump the hashtable into file: file:/tmp/4080/hive_2014-03-18_18-17-11_312_384746705393357863/-local-10002/HashTable-Stage-1/MapJoin-c-01--.hashtable\n2014-03-18 06:17:31 Upload 1 File to: file:/tmp/4080/hive_2014-03-18_18-17-11_312_384746705393357863/-local-10002/HashTable-Stage-1/MapJoin-c-01--.hashtable File size: 123562\n2014-03-18 06:17:31 End of local task; Time Taken: 17.905 sec.\n**\n** Time indices:\n**    Time index: [2014-03-11 18:17:00 +0000, 2014-03-18 18:16:59 +0000)\n**\nfinished at 2014-03-18T18:18:06Z\n\n\u306a\u3093\u304b\u5909\u308f\u3063\u305f\u3002b\u306e\u307b\u3046\u3060\u3051\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304c\u4f7f\u308f\u308c\u3066\u308b\u307f\u305f\u3044\u3002\n\nTD_TIME_ADD\u3092\u3084\u3081\u3066\u307f\u308b\nselect data_user_id from activity b \n  LEFT SEMI JOIN\n    (select data_user_id from activity\n      where TD_TIME_RANGE(time, '2013-03-17 00:00:00', '2013-03-18 00:00:00', 'JST')\n      and data_type = 'premium_registration_complete'\n    ) c\n  ON b.data_user_id = c.data_user_id\n  where TD_TIME_RANGE(time, '2013-03-11 00:00:00', '2013-03-18 00:00:00', 'JST')\n  and data_type = 'signup'\n;\n\nstarted at 2014-03-18T18:31:00Z\nHive history file=/mnt/hive/tmp/4080/hive_job_log__361703617.txt\n**\n** WARNING: time index filtering is not set!\n** This query could be very slow as a result.\n** Please see http://docs.treasure-data.com/articles/performance-tuning#leveraging-time-based-partitioning\n**\nfinished at 2014-03-18T18:32:07Z\n\n\u5909\u308f\u3089\u306a\u3044\u3002\n\n\u4eca\u90311\u9031\u9593\u306b\u65b0\u898f\u767b\u9332\u3057\u3066\u6628\u65e5\u30b3\u30f3\u30d0\u30fc\u30b8\u30e7\u30f3\u9054\u6210\u3057\u305f\u4eba\u306e\u3001\u4eca\u90311\u9031\u9593\u306e\u30a2\u30af\u30c6\u30a3\u30d3\u30c6\u30a3\u3092\u51fa\u3057\u305f\u3044\u3002\n\n```\nselect * from\nactivity a\nLEFT SEMI JOIN\n  (select data_user_id from activity b \n  LEFT SEMI JOIN\n    (select data_user_id from activity\n      where TD_TIME_RANGE(time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-1d'), TD_SCHEDULED_TIME(), 'JST')\n      and data_type = 'premium_registration_complete'\n    ) c\n  ON b.data_user_id = c.data_user_id\n  where TD_TIME_RANGE(time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-7d'), TD_SCHEDULED_TIME(), 'JST')\n  and data_type = 'signup'\n  ) d\nON a.data_user_id = d.data_user_id\nWHERE TD_TIME_RANGE(time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-7d'), TD_SCHEDULED_TIME(), 'JST')\n;\n```\n\n\u304b\u306a\u308a\u6642\u9593\u304b\u304b\u308b\u3002\n\n### \u30b5\u30d6\u30af\u30a8\u30ea\u3060\u3051\u3067\u5b9f\u884c\n\n```\nselect data_user_id from activity b \n  LEFT SEMI JOIN\n    (select data_user_id from activity\n      where TD_TIME_RANGE(time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-1d'), TD_SCHEDULED_TIME(), 'JST')\n      and data_type = 'premium_registration_complete'\n    ) c\n  ON b.data_user_id = c.data_user_id\n  where TD_TIME_RANGE(time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-7d'), TD_SCHEDULED_TIME(), 'JST')\n  and data_type = 'signup'\n;\n```\n\n```\nstarted at 2014-03-18T17:50:50Z\nHive history file=/mnt/hive/tmp/4080/hive_job_log__1622188538.txt\n**\n** WARNING: time index filtering is not set!\n** This query could be very slow as a result.\n** Please see http://docs.treasure-data.com/articles/performance-tuning#leveraging-time-based-partitioning\n**\nfinished at 2014-03-18T17:52:43Z\n```\n\n\u51e6\u7406\u306f\u7d42\u308f\u308b\u3051\u3069\u8b66\u544a\u306f\u6b8b\u3063\u305f\u307e\u307e\u3002\n\n### MAPJOIN\n\n\u4e0a\u306e\u30b1\u30fc\u30b9\u306f1\u65e5\u4ee5\u5185\u306b\u30d7\u30ec\u30df\u30a2\u30e0\u767b\u9332\u3057\u305f\u4eba\u3068\u3044\u3046\u5c0f\u3055\u306a\u30c6\u30fc\u30d6\u30eb\u3068JOIN\u3057\u3066\u3044\u308b\u306e\u3067\u3001MAPJOIN\u3092\u4f7f\u3063\u3066\u307f\u308b\u3002\n\n```\nselect /*+ MAPJOIN(c) */ b.data_user_id from activity b \n  JOIN\n    (select data_user_id from activity\n      where TD_TIME_RANGE(time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-1d'), TD_SCHEDULED_TIME(), 'JST')\n      and data_type = 'premium_registration_complete'\n    ) c\n  ON b.data_user_id = c.data_user_id\n  where TD_TIME_RANGE(time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-7d'), TD_SCHEDULED_TIME(), 'JST')\n  and data_type = 'signup'\n;\n```\n\n```\nstarted at 2014-03-18T17:58:48Z\nHive history file=/mnt/hive/tmp/4080/hive_job_log__243448987.txt\nWARNING: org.apache.hadoop.metrics.jvm.EventCounter is deprecated. Please use org.apache.hadoop.log.metrics.EventCounter in all the log4j.properties files.\nExecution log at: /tmp/4080/4080_20140318175858_9bf02d3e-4672-46bb-9bdf-e2f4a6edef14.log\n2014-03-18 05:58:59\tStarting to launch local task to process map join;\tmaximum memory = 763363328\n**\n** WARNING: time index filtering is not set!\n** This query could be very slow as a result.\n** Please see http://docs.treasure-data.com/articles/performance-tuning#leveraging-time-based-partitioning\n**\n2014-03-18 05:59:34\tProcessing rows:\t1556\tHashtable size:\t1556\tMemory usage:\t30751296\trate:\t0.04\n2014-03-18 05:59:34\tDump the hashtable into file: file:/tmp/4080/hive_2014-03-18_17-58-56_440_7019263692592835974/-local-10002/HashTable-Stage-1/MapJoin-c-01--.hashtable\n2014-03-18 05:59:35\tUpload 1 File to: file:/tmp/4080/hive_2014-03-18_17-58-56_440_7019263692592835974/-local-10002/HashTable-Stage-1/MapJoin-c-01--.hashtable File size: 60967\n2014-03-18 05:59:35\tEnd of local task; Time Taken: 36.034 sec.\n**\n** Time indices:\n**    Time index: [2014-03-11 17:58:48 +0000, 2014-03-18 17:58:47 +0000)\n**\nfinished at 2014-03-18T18:00:40Z\n```\n\n\u307e\u3060\u8b66\u544a\u51fa\u3066\u308b\u3051\u3069\u3001\u30af\u30a8\u30ea\u304c\u7d42\u308f\u3089\u306a\u3044\u3068\u3044\u3046\u3053\u3068\u306f\u306a\u304f\u306a\u3063\u305f\u3002\n\n### \u66f4\u306b\u30b5\u30d6\u30af\u30a8\u30ea\u3060\u3051\u3067\u5b9f\u884c\n\n```\nselect data_user_id from activity\n  where TD_TIME_RANGE(time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-1d'), TD_SCHEDULED_TIME(), 'JST')\n  and data_type = 'premium_registration_complete'\n;\n```\n\n\u3053\u308c\u3060\u3068\u304d\u3061\u3093\u3068time\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f7f\u3063\u3066\u304f\u308c\u3066\u308b\u307f\u305f\u3044\u3002\n\n```\nstarted at 2014-03-18T18:05:52Z\nHive history file=/mnt/hive/tmp/4080/hive_job_log__1081435809.txt\n**\n** Time indices:\n**    Time index: [2014-03-17 18:05:50 +0000, 2014-03-18 18:05:49 +0000)\n**\nfinished at 2014-03-18T18:06:33Z\n```\n\n### JOIN\u306e\u4e2d\u306bSELECT\u3092\u66f8\u304f\u306e\u3092\u3084\u3081\u3066\u307f\u308b\n\n```\nselect b.data_user_id\nfrom activity b \nJOIN activity c\n  ON b.data_user_id = c.data_user_id\n  where b.data_type = 'signup'\n  and c.data_type = 'premium_registration_complete'\n  and TD_TIME_RANGE(b.time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-7d'), TD_SCHEDULED_TIME(), 'JST')\n  and TD_TIME_RANGE(c.time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-1d'), TD_SCHEDULED_TIME(), 'JST')\n;\n```\n\n```\nstarted at 2014-03-18T18:13:40Z\nHive history file=/mnt/hive/tmp/4080/hive_job_log__1362281004.txt\n**\n** WARNING: time index filtering is not set!\n** This query could be very slow as a result.\n** Please see http://docs.treasure-data.com/articles/performance-tuning#leveraging-time-based-partitioning\n**\nfinished at 2014-03-18T18:14:52Z\n```\n\n\u3046\u30fc\u3080\u3002JOIN\u304c\u3060\u3081\u306a\u306e\u304b\u306a\u3002\n\n### \u3053\u308c\u3092MAPJOIN\u306b\u3059\u308b\u3068\u2026\n\n```\nselect /*+ MAPJOIN(c) */ b.data_user_id\nfrom activity b \nJOIN activity c\n  ON b.data_user_id = c.data_user_id\n  where b.data_type = 'signup'\n  and c.data_type = 'premium_registration_complete'\n  and TD_TIME_RANGE(b.time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-7d'), TD_SCHEDULED_TIME(), 'JST')\n  and TD_TIME_RANGE(c.time, TD_TIME_ADD(TD_SCHEDULED_TIME(), '-1d'), TD_SCHEDULED_TIME(), 'JST')\n;\n```\n\n```\nstarted at 2014-03-18T18:17:02Z\nHive history file=/mnt/hive/tmp/4080/hive_job_log__1019712899.txt\nWARNING: org.apache.hadoop.metrics.jvm.EventCounter is deprecated. Please use org.apache.hadoop.log.metrics.EventCounter in all the log4j.properties files.\nExecution log at: /tmp/4080/4080_20140318181717_7ccdbb60-39da-4c24-9a74-5cd8c8c852d4.log\n2014-03-18 06:17:13\tStarting to launch local task to process map join;\tmaximum memory = 763363328\n**\n** WARNING: time index filtering is not set!\n** This query could be very slow as a result.\n** Please see http://docs.treasure-data.com/articles/performance-tuning#leveraging-time-based-partitioning\n**\n2014-03-18 06:17:31\tProcessing rows:\t1560\tHashtable size:\t1560\tMemory usage:\t17915440\trate:\t0.023\n2014-03-18 06:17:31\tDump the hashtable into file: file:/tmp/4080/hive_2014-03-18_18-17-11_312_384746705393357863/-local-10002/HashTable-Stage-1/MapJoin-c-01--.hashtable\n2014-03-18 06:17:31\tUpload 1 File to: file:/tmp/4080/hive_2014-03-18_18-17-11_312_384746705393357863/-local-10002/HashTable-Stage-1/MapJoin-c-01--.hashtable File size: 123562\n2014-03-18 06:17:31\tEnd of local task; Time Taken: 17.905 sec.\n**\n** Time indices:\n**    Time index: [2014-03-11 18:17:00 +0000, 2014-03-18 18:16:59 +0000)\n**\nfinished at 2014-03-18T18:18:06Z\n```\n\n\u306a\u3093\u304b\u5909\u308f\u3063\u305f\u3002b\u306e\u307b\u3046\u3060\u3051\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304c\u4f7f\u308f\u308c\u3066\u308b\u307f\u305f\u3044\u3002\n\n### TD_TIME_ADD\u3092\u3084\u3081\u3066\u307f\u308b\n\n```\nselect data_user_id from activity b \n  LEFT SEMI JOIN\n    (select data_user_id from activity\n      where TD_TIME_RANGE(time, '2013-03-17 00:00:00', '2013-03-18 00:00:00', 'JST')\n      and data_type = 'premium_registration_complete'\n    ) c\n  ON b.data_user_id = c.data_user_id\n  where TD_TIME_RANGE(time, '2013-03-11 00:00:00', '2013-03-18 00:00:00', 'JST')\n  and data_type = 'signup'\n;\n```\n\n```\nstarted at 2014-03-18T18:31:00Z\nHive history file=/mnt/hive/tmp/4080/hive_job_log__361703617.txt\n**\n** WARNING: time index filtering is not set!\n** This query could be very slow as a result.\n** Please see http://docs.treasure-data.com/articles/performance-tuning#leveraging-time-based-partitioning\n**\nfinished at 2014-03-18T18:32:07Z\n```\n\n\u5909\u308f\u3089\u306a\u3044\u3002\n\n", "tags": ["hive"]}