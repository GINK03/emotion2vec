{"context": "\u30e1\u30ea\u30fc\u30af\u30ea\u30b9\u30de\u30b9\uff01  \n\u6700\u5f8c\u306f cap deploy \u3068\u304b\u306e\u524d\u5f8c\u306bChatWork\u306b\u6295\u7a3f\u3059\u308b\u305f\u3081\u306egem\u306e\u7d39\u4ecb\u3067\u3059\n\nhttps://github.com/sue445/capistrano-around_chatwork\nhttps://rubygems.org/gems/capistrano-around_chatwork\n\n\ncapistrano-chatwork\u3068\u306e\u9055\u3044\ncapistrano\u304b\u3089ChatWork\u306b\u6295\u7a3f\u3059\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3067 https://github.com/mitukiii/capistrano-chatwork \u304c\u3042\u308a\u307e\u3059\u304c\u3001capistrano-chatwork\u306f cap deploy \u306e\u524d\u5f8c\u306b\u6295\u7a3f\u3059\u308b\u306e\u306b\u5bfe\u3057\u3001capistrano-around_chatwork\u3067\u306f\u4efb\u610f\u306etask\u306e\u524d\u5f8c\u306bChatWork\u306b\u6295\u7a3f\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30b5\u30f3\u30d7\u30eb\n\ncap unicorn:start \u306e\u524d\u5f8c\u306bChatWork\u306b\u6295\u7a3f\u3057\u3066\u3044\u307e\u3059\u3002done\u306etask\u306e\u5b9f\u884c\u6642\u9593\u3082\u81ea\u52d5\u8a08\u7b97\u3055\u308c\u307e\u3059\n\n\u4f7f\u3044\u65b9\n\nCapfile\nrequire \"capistrano/around_chatwork\"\n\n\n\nconfig/deploy.rb\nset :chatwork_api_token, \"YOUR_API_TOKEN\"\nset :chatwork_room_id,   00000000\n\naround_chatwork \"unicorn:start\"\n\n\nChatWork\u306eAPI token\u3068\u901a\u77e5\u5148\u306e\u90e8\u5c4bID\u3092\u8a2d\u5b9a\u3057\u3001\u524d\u5f8c\u3092\u901a\u77e5\u3067\u56f2\u307f\u305f\u3044\u30bf\u30b9\u30af\u3092 around_chatwork \u306b\u66f8\u304f\u3060\u3051\u3067ok\u3067\u3059\u3002\nchatwork_api_token \u3068 chatwork_room_id \u306f capistrano-chatwork\u3068\u5168\u304f\u540c\u3058\u3082\u306e\u306a\u306e\u3067\u3001capistrano-chatwork\u3092\u5c0e\u5165\u3057\u3066\u308b\u5834\u5408\u306f\u540c\u3058\u8a2d\u5b9a\u3092\u5171\u6709\u3067\u304d\u307e\u3059\n\u901a\u77e5\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u7de8\u96c6\u3057\u305f\u3044\u5834\u5408\u306f starting_message \u3068 ending_message \u3092\u3044\u3044\u611f\u3058\u306b\u7de8\u96c6\u3057\u3066\u4e0b\u3055\u3044\u3002\n\nconfig/deploy.rb\nset :starting_message, -> {\n  \"[info][title][#{fetch(:stage)}] :task_name: @#{fetch(:user)}[/title]started[/info]\"\n}\n\nset :ending_message, -> {\n  \"[info][title][#{fetch(:stage)}] :task_name: @#{fetch(:user)}[/title]done (:elapsed_time: sec)[/info]\"\n}\n\n\n\u6587\u4e2d\u306e :task_name: \u3068 :elapsed_time: \u306f\u30d5\u30c3\u30af\u3057\u305f\u30bf\u30b9\u30af\u540d\u3068\u30bf\u30b9\u30af\u306e\u51e6\u7406\u6642\u9593\u306b\u7f6e\u63db\u3055\u308c\u307e\u3059\u3002\n\n\u8a73\u3057\u3044\u3053\u3068\n\ncap\u30bf\u30b9\u30af\u306e\u524d\u5f8c\u306b\u52d5\u7684\u306b\u30bf\u30b9\u30af\u3092\u8a2d\u5b9a\u3057\u305f\u3044\ncapistrano 3\u7cfb\u306e\u4ed5\u7d44\u307f\u306fRake task\u304c\u30d9\u30fc\u30b9\u306a\u306e\u3067\u4e0b\u8a18\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\nRake \u3067\u4efb\u610f\u306e\u30bf\u30b9\u30af\u306e\u524d\u5f8c\u306b\u5225\u306e\u30bf\u30b9\u30af\u3092\u5b9f\u884c\u3059\u308b - HsbtDiary(2012-02-10)\n\u5b9f\u969b\u306e\u30b3\u30fc\u30c9\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\nhttps://github.com/sue445/capistrano-around_chatwork/blob/v0.1.0/lib/capistrano/around_chatwork.rb#L17-L35\n\nlib/capistrano/around_chatwork.rb\ndef around_chatwork(task_name)\n  start_time = nil\n\n  before_task = Rake::Task.define_task(\"#{task_name}:__before__\") do\n    message = Capistrano::AroundChatwork.format_message(fetch(:starting_message), task_name)\n    Capistrano::AroundChatwork.post_chatwork(message)\n    start_time = Time.now\n  end\n\n  after_task = Rake::Task.define_task(\"#{task_name}:__after__\") do\n    elapsed_time = Time.now - start_time\n    message = Capistrano::AroundChatwork.format_message(fetch(:ending_message), task_name, elapsed_time)\n    Capistrano::AroundChatwork.post_chatwork(message)\n  end\n\n  Rake::Task[task_name].enhance([before_task]) do\n    Rake::Task[after_task].invoke\n  end\nend\n\n\n\u3061\u3087\u3063\u3068\u5f37\u5f15\u3067\u3059\u304c\u3001around_chatwork \u306b\u6e21\u3055\u308c\u305ftask\u540d\u306e\u524d\u5f8c\u306b\u5b9f\u884c\u3057\u305f\u3044task\u3092\u305d\u308c\u305e\u308c\u52d5\u7684\u751f\u6210\u3057\u3066\u3001enhance \u3068 invoke \u306b\u6e21\u3057\u3066\u3044\u307e\u3059\u3002\n\u3061\u306a\u307f\u306bcapistrano\u306ebefore/after\u3067\u3082\u540c\u3058\u3053\u3068\u3092\u3084\u3063\u3066\u3044\u307e\u3059 \nhttps://github.com/capistrano/capistrano/blob/v3.6.1/lib/capistrano/dsl/task_enhancements.rb#L5-L18\n\u30e1\u30ea\u30fc\u30af\u30ea\u30b9\u30de\u30b9\uff01 :santa: \n\n\u6700\u5f8c\u306f `cap deploy` \u3068\u304b\u306e\u524d\u5f8c\u306bChatWork\u306b\u6295\u7a3f\u3059\u308b\u305f\u3081\u306egem\u306e\u7d39\u4ecb\u3067\u3059\n\n* https://github.com/sue445/capistrano-around_chatwork\n* https://rubygems.org/gems/capistrano-around_chatwork\n\n# capistrano-chatwork\u3068\u306e\u9055\u3044\ncapistrano\u304b\u3089ChatWork\u306b\u6295\u7a3f\u3059\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3067 https://github.com/mitukiii/capistrano-chatwork \u304c\u3042\u308a\u307e\u3059\u304c\u3001capistrano-chatwork\u306f `cap deploy` \u306e\u524d\u5f8c\u306b\u6295\u7a3f\u3059\u308b\u306e\u306b\u5bfe\u3057\u3001capistrano-around_chatwork\u3067\u306f\u4efb\u610f\u306etask\u306e\u524d\u5f8c\u306bChatWork\u306b\u6295\u7a3f\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n# \u30b5\u30f3\u30d7\u30eb\n![20150603215100.png](https://qiita-image-store.s3.amazonaws.com/0/8059/77befe6d-33c4-2248-c7da-246a46e1dc0a.png)\n\n`cap unicorn:start` \u306e\u524d\u5f8c\u306bChatWork\u306b\u6295\u7a3f\u3057\u3066\u3044\u307e\u3059\u3002done\u306etask\u306e\u5b9f\u884c\u6642\u9593\u3082\u81ea\u52d5\u8a08\u7b97\u3055\u308c\u307e\u3059\n\n# \u4f7f\u3044\u65b9\n```ruby:Capfile\nrequire \"capistrano/around_chatwork\"\n```\n\n```ruby:config/deploy.rb\nset :chatwork_api_token, \"YOUR_API_TOKEN\"\nset :chatwork_room_id,   00000000\n\naround_chatwork \"unicorn:start\"\n```\n\nChatWork\u306eAPI token\u3068\u901a\u77e5\u5148\u306e\u90e8\u5c4bID\u3092\u8a2d\u5b9a\u3057\u3001\u524d\u5f8c\u3092\u901a\u77e5\u3067\u56f2\u307f\u305f\u3044\u30bf\u30b9\u30af\u3092 `around_chatwork` \u306b\u66f8\u304f\u3060\u3051\u3067ok\u3067\u3059\u3002\n\n`chatwork_api_token` \u3068 `chatwork_room_id` \u306f capistrano-chatwork\u3068\u5168\u304f\u540c\u3058\u3082\u306e\u306a\u306e\u3067\u3001capistrano-chatwork\u3092\u5c0e\u5165\u3057\u3066\u308b\u5834\u5408\u306f\u540c\u3058\u8a2d\u5b9a\u3092\u5171\u6709\u3067\u304d\u307e\u3059\n\n\n\u901a\u77e5\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u7de8\u96c6\u3057\u305f\u3044\u5834\u5408\u306f `starting_message` \u3068 `ending_message` \u3092\u3044\u3044\u611f\u3058\u306b\u7de8\u96c6\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n\n```ruby:config/deploy.rb\nset :starting_message, -> {\n  \"[info][title][#{fetch(:stage)}] :task_name: @#{fetch(:user)}[/title]started[/info]\"\n}\n\nset :ending_message, -> {\n  \"[info][title][#{fetch(:stage)}] :task_name: @#{fetch(:user)}[/title]done (:elapsed_time: sec)[/info]\"\n}\n```\n\n\u6587\u4e2d\u306e `:task_name:` \u3068 `:elapsed_time:` \u306f\u30d5\u30c3\u30af\u3057\u305f\u30bf\u30b9\u30af\u540d\u3068\u30bf\u30b9\u30af\u306e\u51e6\u7406\u6642\u9593\u306b\u7f6e\u63db\u3055\u308c\u307e\u3059\u3002\n\n# \u8a73\u3057\u3044\u3053\u3068\n## cap\u30bf\u30b9\u30af\u306e\u524d\u5f8c\u306b\u52d5\u7684\u306b\u30bf\u30b9\u30af\u3092\u8a2d\u5b9a\u3057\u305f\u3044\n\ncapistrano 3\u7cfb\u306e\u4ed5\u7d44\u307f\u306fRake task\u304c\u30d9\u30fc\u30b9\u306a\u306e\u3067\u4e0b\u8a18\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\n\n[Rake \u3067\u4efb\u610f\u306e\u30bf\u30b9\u30af\u306e\u524d\u5f8c\u306b\u5225\u306e\u30bf\u30b9\u30af\u3092\u5b9f\u884c\u3059\u308b - HsbtDiary(2012-02-10)](http://www.hsbt.org/diary/20120210.html)\n\n\u5b9f\u969b\u306e\u30b3\u30fc\u30c9\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\nhttps://github.com/sue445/capistrano-around_chatwork/blob/v0.1.0/lib/capistrano/around_chatwork.rb#L17-L35\n\n```ruby:lib/capistrano/around_chatwork.rb\ndef around_chatwork(task_name)\n  start_time = nil\n\n  before_task = Rake::Task.define_task(\"#{task_name}:__before__\") do\n    message = Capistrano::AroundChatwork.format_message(fetch(:starting_message), task_name)\n    Capistrano::AroundChatwork.post_chatwork(message)\n    start_time = Time.now\n  end\n\n  after_task = Rake::Task.define_task(\"#{task_name}:__after__\") do\n    elapsed_time = Time.now - start_time\n    message = Capistrano::AroundChatwork.format_message(fetch(:ending_message), task_name, elapsed_time)\n    Capistrano::AroundChatwork.post_chatwork(message)\n  end\n\n  Rake::Task[task_name].enhance([before_task]) do\n    Rake::Task[after_task].invoke\n  end\nend\n```\n\n\u3061\u3087\u3063\u3068\u5f37\u5f15\u3067\u3059\u304c\u3001`around_chatwork` \u306b\u6e21\u3055\u308c\u305ftask\u540d\u306e\u524d\u5f8c\u306b\u5b9f\u884c\u3057\u305f\u3044task\u3092\u305d\u308c\u305e\u308c\u52d5\u7684\u751f\u6210\u3057\u3066\u3001`enhance` \u3068 `invoke` \u306b\u6e21\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u3061\u306a\u307f\u306bcapistrano\u306ebefore/after\u3067\u3082\u540c\u3058\u3053\u3068\u3092\u3084\u3063\u3066\u3044\u307e\u3059 \nhttps://github.com/capistrano/capistrano/blob/v3.6.1/lib/capistrano/dsl/task_enhancements.rb#L5-L18\n", "tags": ["Ruby", "Gem", "chatwork"]}