{"context": " More than 1 year has passed since last update.Tomcat \u306e\u3069\u306e\u30af\u30e9\u30b9\u304c\u30e1\u30e2\u30ea\u30ea\u30fc\u30af\u3057\u3066\u3044\u308b\u304b\u3092\u78ba\u8a8d\u3057\u305f\u3044\u6642\u304c\u3042\u308a\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u3001fullGC \u3055\u308c\u3066\u3044\u308b\u306e\u306b\u5168\u7136\u30d2\u30fc\u30d7\u4f7f\u7528\u91cf\u304c\u6e1b\u3089\u306a\u3044\u3001\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u8aad\u3093\u3067\u3082\u691c\u8a0e\u304c\u3064\u304b\u306a\u3044\n\u4f55\u304b\u30ad\u30c3\u30ab\u30b1\u3060\u3051\u3067\u3082\u6b32\u3057\u3044\uff01\u306a\u3069\u306a\u3069\u3002\n\u3069\u306e\u30af\u30e9\u30b9\u304c\u73fe\u5728\u3069\u308c\u3060\u3051\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u5b58\u5728\u3057\u3066\u3044\u3066\u3001\n\u3069\u308c\u3060\u3051\u306e\u30e1\u30e2\u30ea\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u304b\u3092\u78ba\u8a8d\u3059\u308b\u306b\u306f\u4ee5\u4e0b\u306e\u69d8\u306a\u624b\u9806\u3067\n\u30d2\u30fc\u30d7\u306e\u7d71\u8a08\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u3067\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002\n\u4ee5\u4e0b\u306f Amazon Web Services(AWS) \u306e EC2 \u306b Tomcat 7 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u308b\u524d\u63d0\u3067\u3059\u3002\n\n\u6e96\u5099\n\n\n/etc/tomcat7/tomcat7.conf \u3092\u7de8\u96c6\u3059\u308b\n(\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u53d6\u308b\u306e\u3092\u5fd8\u308c\u305a\u306b\u30fb\u30fb\u30fb)\nsudo vi /etc/tomcat7/tomcat7.conf\nCATALINA_TMPDIR\u306e\u4e0b\u3042\u305f\u308a\u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\nCATALINA_OPTS=\"-XX:+PrintClassHistogram\"\n\n\u518d\u8d77\u52d5\u3059\u308b\nsudo service tomcat7 restart\n\n\n\u30d2\u30fc\u30d7\u306e\u7d71\u8a08\u60c5\u5831\u3092\u53d6\u5f97\n\nTomcat \u3092\u8d77\u52d5\u3057\u3066\u3044\u308b Java\u30d7\u30ed\u30bb\u30b9\u306b SIGQUIT \u3092\u9001\u4fe1\u3059\u308b\nps -ef | grep java | grep -v grep | awk '{print $2}' | xargs sudo kill -3\n\u30ed\u30b0\u306b\u30d2\u30fc\u30d7\u306e\u7d71\u8a08\u60c5\u5831\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\ntail -f /var/log/tomcat7/catalina.out\n\n\u30ed\u30b0\u306b\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u51fa\u529b\u3055\u308c\u307e\u3059\u2193\n num     #instances         #bytes  class name\n----------------------------------------------\n   1:         25100        3988192  <constMethodKlass>\n   2:         25100        3222400  <methodKlass>\n   3:          2091        2768360  <constantPoolKlass>\n   4:         21482        2353672  [C\n   5:          1813        1515712  <constantPoolCacheKlass>\n   6:          2091        1437248  <instanceKlassKlass>\n   7:          5346         860552  [B\n   8:           622         550584  [I\n   9:         21167         508008  java.lang.String\n  10:          4038         323040  java.lang.reflect.Method\n  11:          2339         283336  java.lang.Class\n  12:          8826         282432  java.util.HashMap$Entry\n  13:           456         230624  <methodDataKlass>\n  14:          3337         203528  [S\n  15:          3339         189808  [[I\n  16:           231         121968  <objArrayKlassKlass>\n  17:          2200         110024  [Ljava.lang.Object;\n  18:           533         103880  [Ljava.util.HashMap$Entry;\n  19:          2168          69376  java.util.concurrent.ConcurrentHashMap$HashEntry\n  20:          2989          62872  [Ljava.lang.Class;\n  21:          1306          52240  java.util.LinkedHashMap$Entry\n  22:          1418          45376  java.util.Hashtable$Entry\n  23:           909          43632  java.util.HashMap\n(\u4ee5\u4e0b \u5ef6\u3005\u3068\u7d9a\u304f\u306e\u3067\u7701\u7565)\n\n\u203b \u5f90\u3005\u306b\u30d2\u30fc\u30d7\u4f7f\u7528\u91cf\u304c\u5897\u3048\u3066\u3044\u304f\u306e\u3067\u30a2\u30ef\u30ea\u30fc\u3067\u7d71\u8a08\u53d6\u308a\u305f\u3044\u306a\u3093\u3066\u5834\u5408\u306f\u3001\n  cron \u306b SIGQUIT \u30b3\u30de\u30f3\u30c9\u3092\u9001\u4fe1\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u3051\u3070\u826f\u3044\u3067\u3059\nTomcat \u306e\u3069\u306e\u30af\u30e9\u30b9\u304c\u30e1\u30e2\u30ea\u30ea\u30fc\u30af\u3057\u3066\u3044\u308b\u304b\u3092\u78ba\u8a8d\u3057\u305f\u3044\u6642\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u4f8b\u3048\u3070\u3001fullGC \u3055\u308c\u3066\u3044\u308b\u306e\u306b\u5168\u7136\u30d2\u30fc\u30d7\u4f7f\u7528\u91cf\u304c\u6e1b\u3089\u306a\u3044\u3001\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u8aad\u3093\u3067\u3082\u691c\u8a0e\u304c\u3064\u304b\u306a\u3044\n\u4f55\u304b\u30ad\u30c3\u30ab\u30b1\u3060\u3051\u3067\u3082\u6b32\u3057\u3044\uff01\u306a\u3069\u306a\u3069\u3002\n\n\u3069\u306e\u30af\u30e9\u30b9\u304c\u73fe\u5728\u3069\u308c\u3060\u3051\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u5b58\u5728\u3057\u3066\u3044\u3066\u3001\n\u3069\u308c\u3060\u3051\u306e\u30e1\u30e2\u30ea\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u304b\u3092\u78ba\u8a8d\u3059\u308b\u306b\u306f\u4ee5\u4e0b\u306e\u69d8\u306a\u624b\u9806\u3067\n\u30d2\u30fc\u30d7\u306e\u7d71\u8a08\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u3067\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u306f Amazon Web Services(AWS) \u306e EC2 \u306b Tomcat 7 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u308b\u524d\u63d0\u3067\u3059\u3002\n\n##\u6e96\u5099\n1. /etc/tomcat7/tomcat7.conf \u3092\u7de8\u96c6\u3059\u308b\n    (\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u53d6\u308b\u306e\u3092\u5fd8\u308c\u305a\u306b\u30fb\u30fb\u30fb)\n    \n    `sudo vi /etc/tomcat7/tomcat7.conf`\n\n    CATALINA_TMPDIR\u306e\u4e0b\u3042\u305f\u308a\u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\n    `CATALINA_OPTS=\"-XX:+PrintClassHistogram\"`\n2. \u518d\u8d77\u52d5\u3059\u308b\n    ` sudo service tomcat7 restart`\n\n##\u30d2\u30fc\u30d7\u306e\u7d71\u8a08\u60c5\u5831\u3092\u53d6\u5f97\n1. Tomcat \u3092\u8d77\u52d5\u3057\u3066\u3044\u308b Java\u30d7\u30ed\u30bb\u30b9\u306b SIGQUIT \u3092\u9001\u4fe1\u3059\u308b\n`ps -ef | grep java | grep -v grep | awk '{print $2}' | xargs sudo kill -3`\n\n\n2. \u30ed\u30b0\u306b\u30d2\u30fc\u30d7\u306e\u7d71\u8a08\u60c5\u5831\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\n`tail -f /var/log/tomcat7/catalina.out`\n\n\u30ed\u30b0\u306b\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u51fa\u529b\u3055\u308c\u307e\u3059\u2193\n\n```\n num     #instances         #bytes  class name\n----------------------------------------------\n   1:         25100        3988192  <constMethodKlass>\n   2:         25100        3222400  <methodKlass>\n   3:          2091        2768360  <constantPoolKlass>\n   4:         21482        2353672  [C\n   5:          1813        1515712  <constantPoolCacheKlass>\n   6:          2091        1437248  <instanceKlassKlass>\n   7:          5346         860552  [B\n   8:           622         550584  [I\n   9:         21167         508008  java.lang.String\n  10:          4038         323040  java.lang.reflect.Method\n  11:          2339         283336  java.lang.Class\n  12:          8826         282432  java.util.HashMap$Entry\n  13:           456         230624  <methodDataKlass>\n  14:          3337         203528  [S\n  15:          3339         189808  [[I\n  16:           231         121968  <objArrayKlassKlass>\n  17:          2200         110024  [Ljava.lang.Object;\n  18:           533         103880  [Ljava.util.HashMap$Entry;\n  19:          2168          69376  java.util.concurrent.ConcurrentHashMap$HashEntry\n  20:          2989          62872  [Ljava.lang.Class;\n  21:          1306          52240  java.util.LinkedHashMap$Entry\n  22:          1418          45376  java.util.Hashtable$Entry\n  23:           909          43632  java.util.HashMap\n(\u4ee5\u4e0b \u5ef6\u3005\u3068\u7d9a\u304f\u306e\u3067\u7701\u7565)\n```\n\n\u203b \u5f90\u3005\u306b\u30d2\u30fc\u30d7\u4f7f\u7528\u91cf\u304c\u5897\u3048\u3066\u3044\u304f\u306e\u3067\u30a2\u30ef\u30ea\u30fc\u3067\u7d71\u8a08\u53d6\u308a\u305f\u3044\u306a\u3093\u3066\u5834\u5408\u306f\u3001\n  cron \u306b SIGQUIT \u30b3\u30de\u30f3\u30c9\u3092\u9001\u4fe1\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u3051\u3070\u826f\u3044\u3067\u3059\n\n ", "tags": ["Java", "Tomcat"]}