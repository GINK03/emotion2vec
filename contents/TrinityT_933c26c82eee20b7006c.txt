{"context": "\u30c6\u30b9\u30c8\u30b5\u30fc\u30d0(UbuntuLTS16.04)\u4e0a\u306b\u8907\u6570\u306eRedis\u3092\u7acb\u3066\u305f\u304b\u3063\u305f\u306e\u3067\u30e1\u30e2\n\u203b\u3053\u3053\u3067\u306f\u6a19\u6e96\u306e6379\u30dd\u30fc\u30c8\u306e\u8a2d\u5b9a\u3092\u3082\u3068\u306b\u30016380\u30dd\u30fc\u30c8\u3067\u7acb\u3066\u3066\u3044\u308b\n\nredis-6380\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\nsudo install -o redis -g root -m 755 -d /var/lib/redis-6380\nsudo install -o redis -g root -m 755 -d /var/log/redis-6380\nsudo install -o redis -g root -m 755 -d /var/run/redis-6380\nsudo chown -R redis:redis /var/lib/redis-6380\nsudo chown -R redis:redis /var/log/redis-6380\nsudo chown -R redis:redis /var/run/redis-6380\n\n\nconf\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\nsudo cp -rf /etc/redis /etc/redis-6380\nsudo sed -i 's/^pidfile .*$/pidfile \\/var\\/run\\/redis-6380\\/redis.pid/' /etc/redis-6380/redis.conf\nsudo sed -i 's/^port .*$/port 6380/' /etc/redis-6380/redis.conf\nsudo sed -i 's/^logfile .*$/logfile \\/var\\/log\\/redis-6380\\/redis.log/' /etc/redis-6380/redis.conf\nsudo chown -R redis:redis /etc/redis-6380/redis.conf\n\n\n\u8d77\u52d5\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\nsudo cp -p /etc/init.d/redis-server /etc/init.d/redis-server-6380\nsudo sed -i 's/^DAEMON=.*$/DAEMON=redis-server-6380/' /etc/init.d/redis-server-6380\nsudo sed -i 's/^DAEMON_ARGS=.*$/DAEMON_ARGS=\\/etc\\/redis-6380\\/redis.conf/' /etc/init.d/redis-server-6380\nsudo sed -i 's/^NAME=.*$/NAME=redis-server-6380/' /etc/init.d/redis-server-6380\nsudo sed -i 's/^DESC=.*$/DESC=redis-server-6380/' /etc/init.d/redis-server-6380\nsudo sed -i 's/^RUNDIR=.*$/RUNDIR=\\/var\\/run\\/redis-6380/' /etc/init.d/redis-server-6380\nsudo sed -i 's/^PIDFILE=.*$/PIDFILE=\\$RUNDIR\\/redis-server-6380.pid/' /etc/init.d/redis-server-6380\nsudo ln -s /usr/bin/redis-server /usr/bin/redis-server-6380\n\n\n\u30b5\u30fc\u30d3\u30b9\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\nsudo cp -p /lib/systemd/system/redis-server.service /lib/systemd/system/redis-server-6380.service\nsudo vi /lib/systemd/system/redis-server-6380.service\n\n\u2193\u4ee5\u4e0b\u3092\u53cd\u6620 \u203bsed\u3067\u3084\u308a\u305f\u304b\u3063\u305f\u3051\u3069\u529b\u5c3d\u304d\u305f\n[Service]\nType=forking\nExecStart=/usr/bin/redis-server-6380 /etc/redis-6380/redis.conf\nPIDFile=/var/run/redis-6380/redis-server-6380.pid\nTimeoutStopSec=0\nRestart=always\nUser=redis\nGroup=redis\n\nExecStartPre=-/bin/run-parts --verbose /etc/redis-6380/redis-server-6380.pre-up.d\nExecStartPost=-/bin/run-parts --verbose /etc/redis-6380/redis-server-6380.post-up.d\nExecStop=-/bin/run-parts --verbose /etc/redis-6380/redis-server-6380.pre-down.d\nExecStop=/bin/kill -s TERM $MAINPID\nExecStopPost=-/bin/run-parts --verbose /etc/redis-6380/redis-server-6380.post-down.d\n\nPrivateTmp=yes\nPrivateDevices=yes\nProtectHome=yes\nReadOnlyDirectories=/\nReadWriteDirectories=-/var/lib/redis-6380\nReadWriteDirectories=-/var/log/redis-6380\nReadWriteDirectories=-/var/run/redis-6380\nCapabilityBoundingSet=~CAP_SYS_PTRACE\n\n# redis-server writes its own config file when in cluster mode so we allow\n# writing there (NB. ProtectSystem=true over ProtectSystem=full)\nProtectSystem=true\nReadWriteDirectories=-/etc/redis-6380\n\n[Install]\nWantedBy=multi-user.target\nAlias=redis-6380.service\n\n\n\u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\nsudo service redis-server-6380 start\n\n\n\u30d7\u30ed\u30bb\u30b9\u78ba\u8a8d\nps aux | grep 6380\n\n\n\u30a2\u30af\u30bb\u30b9\u78ba\u8a8d\nredis-cli -p 6380\n\n\n\u53c2\u8003\u30b5\u30a4\u30c8\nhttp://infra.logdown.com/posts/175191-centos6-multiple-redis\n\u30c6\u30b9\u30c8\u30b5\u30fc\u30d0(UbuntuLTS16.04)\u4e0a\u306b\u8907\u6570\u306eRedis\u3092\u7acb\u3066\u305f\u304b\u3063\u305f\u306e\u3067\u30e1\u30e2\n\u203b\u3053\u3053\u3067\u306f\u6a19\u6e96\u306e6379\u30dd\u30fc\u30c8\u306e\u8a2d\u5b9a\u3092\u3082\u3068\u306b\u30016380\u30dd\u30fc\u30c8\u3067\u7acb\u3066\u3066\u3044\u308b\n\n# redis-6380\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\n```bash\nsudo install -o redis -g root -m 755 -d /var/lib/redis-6380\nsudo install -o redis -g root -m 755 -d /var/log/redis-6380\nsudo install -o redis -g root -m 755 -d /var/run/redis-6380\nsudo chown -R redis:redis /var/lib/redis-6380\nsudo chown -R redis:redis /var/log/redis-6380\nsudo chown -R redis:redis /var/run/redis-6380\n```\n\n# conf\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n```bash\nsudo cp -rf /etc/redis /etc/redis-6380\nsudo sed -i 's/^pidfile .*$/pidfile \\/var\\/run\\/redis-6380\\/redis.pid/' /etc/redis-6380/redis.conf\nsudo sed -i 's/^port .*$/port 6380/' /etc/redis-6380/redis.conf\nsudo sed -i 's/^logfile .*$/logfile \\/var\\/log\\/redis-6380\\/redis.log/' /etc/redis-6380/redis.conf\nsudo chown -R redis:redis /etc/redis-6380/redis.conf\n```\n\n# \u8d77\u52d5\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210 \n```bash\nsudo cp -p /etc/init.d/redis-server /etc/init.d/redis-server-6380\nsudo sed -i 's/^DAEMON=.*$/DAEMON=redis-server-6380/' /etc/init.d/redis-server-6380\nsudo sed -i 's/^DAEMON_ARGS=.*$/DAEMON_ARGS=\\/etc\\/redis-6380\\/redis.conf/' /etc/init.d/redis-server-6380\nsudo sed -i 's/^NAME=.*$/NAME=redis-server-6380/' /etc/init.d/redis-server-6380\nsudo sed -i 's/^DESC=.*$/DESC=redis-server-6380/' /etc/init.d/redis-server-6380\nsudo sed -i 's/^RUNDIR=.*$/RUNDIR=\\/var\\/run\\/redis-6380/' /etc/init.d/redis-server-6380\nsudo sed -i 's/^PIDFILE=.*$/PIDFILE=\\$RUNDIR\\/redis-server-6380.pid/' /etc/init.d/redis-server-6380\nsudo ln -s /usr/bin/redis-server /usr/bin/redis-server-6380\n```\n\n# \u30b5\u30fc\u30d3\u30b9\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n```bash\nsudo cp -p /lib/systemd/system/redis-server.service /lib/systemd/system/redis-server-6380.service\nsudo vi /lib/systemd/system/redis-server-6380.service\n```\n\n\u2193\u4ee5\u4e0b\u3092\u53cd\u6620 \u203bsed\u3067\u3084\u308a\u305f\u304b\u3063\u305f\u3051\u3069\u529b\u5c3d\u304d\u305f\n\n```shell-session\n[Service]\nType=forking\nExecStart=/usr/bin/redis-server-6380 /etc/redis-6380/redis.conf\nPIDFile=/var/run/redis-6380/redis-server-6380.pid\nTimeoutStopSec=0\nRestart=always\nUser=redis\nGroup=redis\n\nExecStartPre=-/bin/run-parts --verbose /etc/redis-6380/redis-server-6380.pre-up.d\nExecStartPost=-/bin/run-parts --verbose /etc/redis-6380/redis-server-6380.post-up.d\nExecStop=-/bin/run-parts --verbose /etc/redis-6380/redis-server-6380.pre-down.d\nExecStop=/bin/kill -s TERM $MAINPID\nExecStopPost=-/bin/run-parts --verbose /etc/redis-6380/redis-server-6380.post-down.d\n\nPrivateTmp=yes\nPrivateDevices=yes\nProtectHome=yes\nReadOnlyDirectories=/\nReadWriteDirectories=-/var/lib/redis-6380\nReadWriteDirectories=-/var/log/redis-6380\nReadWriteDirectories=-/var/run/redis-6380\nCapabilityBoundingSet=~CAP_SYS_PTRACE\n\n# redis-server writes its own config file when in cluster mode so we allow\n# writing there (NB. ProtectSystem=true over ProtectSystem=full)\nProtectSystem=true\nReadWriteDirectories=-/etc/redis-6380\n\n[Install]\nWantedBy=multi-user.target\nAlias=redis-6380.service\n```\n\n# \u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\n```bash\nsudo service redis-server-6380 start\n```\n\n# \u30d7\u30ed\u30bb\u30b9\u78ba\u8a8d\n```bash\nps aux | grep 6380\n```\n\n# \u30a2\u30af\u30bb\u30b9\u78ba\u8a8d\n```bash\nredis-cli -p 6380\n```\n\n\n# \u53c2\u8003\u30b5\u30a4\u30c8\nhttp://infra.logdown.com/posts/175191-centos6-multiple-redis\n", "tags": ["Redis", "ubuntu16.04", "Ubuntu"]}