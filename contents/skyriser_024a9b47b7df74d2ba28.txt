{"context": " More than 1 year has passed since last update.\n\nPacker \u3067 Docker \u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u308b\n\nPacker\nPacker\u3092\u4f7f\u3063\u3066Chef/Puppet/Ansible\u3067Docker\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u3064\u304f\u308b\n\nPacker\u3092\u4f7f\u3048\u3070Docker\u306e\u30a4\u30e1\u30fc\u30b8\u3092Dockerfile\u3092\u4f7f\u308f\u305a\u30d3\u30eb\u30c9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\n\u3064\u307e\u308a\uff0cDockerfile\u306e\u7279\u6709\u306a\u8a18\u8ff0\u3092\u4f7f\u308f\u305a\uff0c\u4eca\u307e\u3067\u6163\u308c\u89aa\u3057\u3093\u3067\u304d\u305fChef\u3084Puppet\uff0cAnsible\u306e\u3088\u3046\u306a\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u30c4\u30fc\u30eb\u3092\u4f7f\u3063\u3066Docker\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u30d3\u30eb\u30c9\u3067\u304d\u308b\uff0e\n\n\u3068\u306e\u3053\u3068\u306a\u306e\u3067 Dockerfile \u66f8\u304b\u306a\u304f\u3066\u3082\u826f\u3044\u3058\u3083\u3093?\n\u3068\u3044\u3046\u3002\n\nPacker \u30b5\u30f3\u30d7\u30eb\u8a66\u3057\u305f\nhttp://www.packer.io/intro/getting-started/build-image.html\n\u306e\u30b5\u30f3\u30d7\u30eb\u8a66\u3057\u3066\u307f\u308b\n\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u306fEC2\n$ packer build \\\n-var 'aws_access_key=XXXXXXXXXX' \\\n-var 'aws_secret_key=XXXXXXXXXX' \\\nexample.json\namazon-ebs output will be in this color.\n\n==> amazon-ebs: Creating temporary keypair: packer 538fe89a-d16c-59c9-7b95-9422d008f01e\n==> amazon-ebs: Creating temporary security group for this instance...\n==> amazon-ebs: Authorizing SSH access on the temporary security group...\n==> amazon-ebs: Launching a source AWS instance...\namazon-ebs: Instance ID: i-609c5332\n==> amazon-ebs: Waiting for instance (i-609c5332) to become ready...\n==> amazon-ebs: Waiting for SSH to become available...\n==> amazon-ebs: Connected to SSH!\n==> amazon-ebs: Stopping the source instance...\n==> amazon-ebs: Waiting for the instance to stop...\n==> amazon-ebs: Creating the AMI: packer-example 1401940122\namazon-ebs: AMI: ami-fa0eff92\n==> amazon-ebs: Waiting for AMI to become ready...\n==> amazon-ebs: Terminating the source AWS instance...\n==> amazon-ebs: Deleting temporary security group...\n==> amazon-ebs: Deleting temporary keypair...\nBuild 'amazon-ebs' finished.\n\n==> Builds finished. The artifacts of successful builds are:\n--> amazon-ebs: AMIs were created:\n\nus-east-1: ami-fa0eff92\n\n\nPacker \u306e\u8d77\u52d5\u52d5\u4f5c\u307e\u3068\u3081\nEC2\u306b\u9069\u7528\u3057\u305f\u5834\u5408\u3001\u4f5c\u3089\u308c\u308b\u306e\u306f AMI \u30a4\u30e1\u30fc\u30b8\u3002\nEC2\u306f\u51fa\u6765\u308b\u3051\u3069\u3001\u30a4\u30e1\u30fc\u30b8\u4f5c\u308a\u7d42\u308f\u3063\u305f\u3089 terminate \u3055\u308c\u308b\u3002\n\u4e0d\u8981\u306a AMI \u30a4\u30e1\u30fc\u30b8\u306f\u524a\u9664\u3059\u308b\u611f\u3058\u3002\nEC2\u306e\u8d77\u52d5\u306fAMI\u30a4\u30e1\u30fc\u30b8\u3092\u5143\u306b\u81ea\u5206\u3067\u884c\u3046\u611f\u3058\u3002\n\u6d41\u308c\u3068\u3057\u3066\u3001\n\nChef \u7528\u610f\u3059\u308b\nPacker \u3067 AMI \u30a4\u30e1\u30fc\u30b8\u4f5c\u308b / Docker \u30a4\u30e1\u30fc\u30b8\u4f5c\u308b\nAMI/Docker\u30a4\u30e1\u30fc\u30b8\u3092\u8d77\u52d5\u3059\u308b\n\n\u3063\u3066\u611f\u3058\u306b\u3067\u304d\u308b\u307d\u3044\u3002\n\nChef on Docker\n\nDOCKER BUILDER\n\n# docker-chef.json\n{\n  \"builders\":[{\n    \"type\": \"docker\",\n    \"image\": \"phusion/baseimage\",\n    \"export_path\": \"docker-image.tar\"\n  }],\n  \"provisioners\":[\n    {\n      inline: [\n        \"apt-get -y install curl\"\n      ],\n      \"type\": \"shell\"\n    },\n    {\n      \"type\": \"chef-solo\",\n      \"cookbook_paths\": [\"cookbooks\"],\n      \"run_list\": []\n    }\n  ],\n  \"post-processors\": [\n    {\n      \"type\": \"docker-import\",\n      \"repository\": \"skyriser/docker-test\",\n      \"tag\": \"0.1\"\n    }\n  ]\n}\n\n$ sudo -E packer build docker-chef.json\ndocker output will be in this color.\n\n\u3053\u308c\u3060\u3051\u3067 docker \u30a4\u30e1\u30fc\u30b8\u3067\u304d\u308b\u3002\npacker \u3063\u3066\u3044\u3046\u5225\u306e\u30d0\u30a4\u30ca\u30ea\u304c\u3044\u308b\u3053\u3068\u3082\u3042\u308b\u3088\u3046\u306a\u306e\u3067\u6ce8\u610f\u3002\n\u30d5\u30eb\u30d1\u30b9\u3067\u6307\u5b9a\u3059\u308b\u3068\u78ba\u5b9f\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n$ sudo docker run -t skyriser/docker-test\n\n# Packer \u3067 Docker \u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u308b\n\n- [Packer](http://www.packer.io/)\n- [Packer\u3092\u4f7f\u3063\u3066Chef/Puppet/Ansible\u3067Docker\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u3064\u304f\u308b](http://deeeet.com/writing/2014/03/02/build-docker-image-by-packer/)\n\n```\nPacker\u3092\u4f7f\u3048\u3070Docker\u306e\u30a4\u30e1\u30fc\u30b8\u3092Dockerfile\u3092\u4f7f\u308f\u305a\u30d3\u30eb\u30c9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\n\u3064\u307e\u308a\uff0cDockerfile\u306e\u7279\u6709\u306a\u8a18\u8ff0\u3092\u4f7f\u308f\u305a\uff0c\u4eca\u307e\u3067\u6163\u308c\u89aa\u3057\u3093\u3067\u304d\u305fChef\u3084Puppet\uff0cAnsible\u306e\u3088\u3046\u306a\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u30c4\u30fc\u30eb\u3092\u4f7f\u3063\u3066Docker\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u30d3\u30eb\u30c9\u3067\u304d\u308b\uff0e\n```\n\n\u3068\u306e\u3053\u3068\u306a\u306e\u3067 Dockerfile \u66f8\u304b\u306a\u304f\u3066\u3082\u826f\u3044\u3058\u3083\u3093?\n\u3068\u3044\u3046\u3002\n\n## Packer \u30b5\u30f3\u30d7\u30eb\u8a66\u3057\u305f\n\nhttp://www.packer.io/intro/getting-started/build-image.html\n\n\u306e\u30b5\u30f3\u30d7\u30eb\u8a66\u3057\u3066\u307f\u308b\n\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u306fEC2\n\n```\n$ packer build \\\n-var 'aws_access_key=XXXXXXXXXX' \\\n-var 'aws_secret_key=XXXXXXXXXX' \\\nexample.json\namazon-ebs output will be in this color.\n\n==> amazon-ebs: Creating temporary keypair: packer 538fe89a-d16c-59c9-7b95-9422d008f01e\n==> amazon-ebs: Creating temporary security group for this instance...\n==> amazon-ebs: Authorizing SSH access on the temporary security group...\n==> amazon-ebs: Launching a source AWS instance...\namazon-ebs: Instance ID: i-609c5332\n==> amazon-ebs: Waiting for instance (i-609c5332) to become ready...\n==> amazon-ebs: Waiting for SSH to become available...\n==> amazon-ebs: Connected to SSH!\n==> amazon-ebs: Stopping the source instance...\n==> amazon-ebs: Waiting for the instance to stop...\n==> amazon-ebs: Creating the AMI: packer-example 1401940122\namazon-ebs: AMI: ami-fa0eff92\n==> amazon-ebs: Waiting for AMI to become ready...\n==> amazon-ebs: Terminating the source AWS instance...\n==> amazon-ebs: Deleting temporary security group...\n==> amazon-ebs: Deleting temporary keypair...\nBuild 'amazon-ebs' finished.\n\n==> Builds finished. The artifacts of successful builds are:\n--> amazon-ebs: AMIs were created:\n\nus-east-1: ami-fa0eff92\n```\n\n## Packer \u306e\u8d77\u52d5\u52d5\u4f5c\u307e\u3068\u3081\n\nEC2\u306b\u9069\u7528\u3057\u305f\u5834\u5408\u3001\u4f5c\u3089\u308c\u308b\u306e\u306f AMI \u30a4\u30e1\u30fc\u30b8\u3002\nEC2\u306f\u51fa\u6765\u308b\u3051\u3069\u3001\u30a4\u30e1\u30fc\u30b8\u4f5c\u308a\u7d42\u308f\u3063\u305f\u3089 terminate \u3055\u308c\u308b\u3002\n\n\u4e0d\u8981\u306a AMI \u30a4\u30e1\u30fc\u30b8\u306f\u524a\u9664\u3059\u308b\u611f\u3058\u3002\nEC2\u306e\u8d77\u52d5\u306fAMI\u30a4\u30e1\u30fc\u30b8\u3092\u5143\u306b\u81ea\u5206\u3067\u884c\u3046\u611f\u3058\u3002\n\n\u6d41\u308c\u3068\u3057\u3066\u3001\n\n1. Chef \u7528\u610f\u3059\u308b\n2. Packer \u3067 AMI \u30a4\u30e1\u30fc\u30b8\u4f5c\u308b / Docker \u30a4\u30e1\u30fc\u30b8\u4f5c\u308b\n3. AMI/Docker\u30a4\u30e1\u30fc\u30b8\u3092\u8d77\u52d5\u3059\u308b\n\n\u3063\u3066\u611f\u3058\u306b\u3067\u304d\u308b\u307d\u3044\u3002\n\n## Chef on Docker\n\n- [DOCKER BUILDER](http://www.packer.io/docs/builders/docker.html)\n\n```json\n# docker-chef.json\n{\n  \"builders\":[{\n    \"type\": \"docker\",\n    \"image\": \"phusion/baseimage\",\n    \"export_path\": \"docker-image.tar\"\n  }],\n  \"provisioners\":[\n    {\n      inline: [\n        \"apt-get -y install curl\"\n      ],\n      \"type\": \"shell\"\n    },\n    {\n      \"type\": \"chef-solo\",\n      \"cookbook_paths\": [\"cookbooks\"],\n      \"run_list\": []\n    }\n  ],\n  \"post-processors\": [\n    {\n      \"type\": \"docker-import\",\n      \"repository\": \"skyriser/docker-test\",\n      \"tag\": \"0.1\"\n    }\n  ]\n}\n```\n\n```\n$ sudo -E packer build docker-chef.json\ndocker output will be in this color.\n```\n\n\u3053\u308c\u3060\u3051\u3067 docker \u30a4\u30e1\u30fc\u30b8\u3067\u304d\u308b\u3002\npacker \u3063\u3066\u3044\u3046\u5225\u306e\u30d0\u30a4\u30ca\u30ea\u304c\u3044\u308b\u3053\u3068\u3082\u3042\u308b\u3088\u3046\u306a\u306e\u3067\u6ce8\u610f\u3002\n\u30d5\u30eb\u30d1\u30b9\u3067\u6307\u5b9a\u3059\u308b\u3068\u78ba\u5b9f\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\n```\n$ sudo docker run -t skyriser/docker-test\n```\n", "tags": ["packer", "docker"]}