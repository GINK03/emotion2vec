{"tags": ["Java", "jpa2.1", "EclipseLink2.5.1"], "context": " More than 1 year has passed since last update.\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u69cb\u6210\u306f JUnit\u3067JPA\u306e\u30c6\u30b9\u30c8 \u3092\u53c2\u8003\u306b\u3001\u3053\u3061\u3089\u306e\u69cb\u6210\u3002\nsrc\n \u251c main\n \u2502  \u251c java\n \u2502  \u2502  \u251c ***\n \u2502  \u2514 resources\n \u2502     \u2514 META-INF\n \u2502        \u2514 persistence.xml\n \u2514 test\n    \u251c java\n    \u2502  \u2514 ***\n    \u2514 resources\n       \u2514 META-INF\n          \u2514 test-persistence.xml\n\n\u30c6\u30b9\u30c8\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\nHogeHogeTest.java\npublic class HogeHogeTest extends JerseyTest {\n\n    public static class TestBinder extends AbstractBinder {\n        @Override\n        protected void configure() {\n            // EntityManager\u3092\u4f5c\u6210\u3059\u308b\u969b\u306e\u5f15\u6570\u306b\n            // eclipselink.persistencexml={persistence.xml\u306e\u30af\u30e9\u30b9\u30d1\u30b9}\u3092\u6e21\u3059\n            final Map<String, String> map = new HashMap<>();\n            map.put(PersistenceUnitProperties.ECLIPSELINK_PERSISTENCE_XML, \"META-INF/test-persistence.xml\");\n            final EntityManager em = Persistence.createEntityManagerFactory(\"***JPA***\", em).createEntityManager();\n            final HogeHogeDaoImpl hogeHogeDao = new HogeHogeDaoImpl();\n            hogeHogeDao.setEntityManager(em);\n\n            bindAsContract(HogeHogeDaoImpl.class).in(Singleton.class);\n            bind(hogeHogeDao).to(HogeHogeDao.class);\n        }\n    }\n\n    @Override\n    protected Application configure() {\n        return new ApplicationConfig().register(new TestBinder());\n    }\n\n    @Test\n    public void testHogeHoge() throws Exception {\n        Response response = target(\"/\").request()\n                .buildGet()\n                .invoke();\n\n        assertThat(response.getStatus(), is(Response.Status.OK.getStatusCode()));\n    }\n}\n\n\n\n\u80cc\u666f\nMock\u4f7f\u3044\u305f\u304b\u3063\u305f\u306e\u3067Mockito\u3068\u304bObjenesis\u3068\u304bpom.xml\u306edependency\u306b\u7a81\u3063\u8fbc\u3093\u3067\u6c17\u4ed8\u3044\u305f\u3002\u4f55\u6545\u304bObjenesis\u3092\u8ffd\u52a0\u3055\u308c\u308b\u3068\u30c6\u30b9\u30c8\u6642\u306btest-persistence.xml\u3058\u3083\u306a\u304f\u3066persistence.xml\u306e\u65b9\u3092\u898b\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u3002\n\u3068\u308a\u3042\u3048\u305a\u30c7\u30d0\u30c3\u30b0\u3067\u8ffd\u3044\u304b\u3051\u305f\u3089 eclipselink.persistencexml \u3067\u5229\u7528\u3059\u308bpersistence.xml\u3092\u8a2d\u5b9a\u51fa\u6765\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u3002\u3002\u3002\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u69cb\u6210\u306f [JUnit\u3067JPA\u306e\u30c6\u30b9\u30c8](http://kokuzawa.github.io/blog/2013/11/03/unit-test-of-jpa/) \u3092\u53c2\u8003\u306b\u3001\u3053\u3061\u3089\u306e\u69cb\u6210\u3002\n\n```\nsrc\n \u251c main\n \u2502  \u251c java\n \u2502  \u2502  \u251c ***\n \u2502  \u2514 resources\n \u2502     \u2514 META-INF\n \u2502        \u2514 persistence.xml\n \u2514 test\n    \u251c java\n    \u2502  \u2514 ***\n    \u2514 resources\n       \u2514 META-INF\n          \u2514 test-persistence.xml\n```\n\n\n\u30c6\u30b9\u30c8\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n```java:HogeHogeTest.java\npublic class HogeHogeTest extends JerseyTest {\n\n    public static class TestBinder extends AbstractBinder {\n        @Override\n        protected void configure() {\n            // EntityManager\u3092\u4f5c\u6210\u3059\u308b\u969b\u306e\u5f15\u6570\u306b\n            // eclipselink.persistencexml={persistence.xml\u306e\u30af\u30e9\u30b9\u30d1\u30b9}\u3092\u6e21\u3059\n            final Map<String, String> map = new HashMap<>();\n            map.put(PersistenceUnitProperties.ECLIPSELINK_PERSISTENCE_XML, \"META-INF/test-persistence.xml\");\n            final EntityManager em = Persistence.createEntityManagerFactory(\"***JPA***\", em).createEntityManager();\n            final HogeHogeDaoImpl hogeHogeDao = new HogeHogeDaoImpl();\n            hogeHogeDao.setEntityManager(em);\n\n            bindAsContract(HogeHogeDaoImpl.class).in(Singleton.class);\n            bind(hogeHogeDao).to(HogeHogeDao.class);\n        }\n    }\n\n    @Override\n    protected Application configure() {\n        return new ApplicationConfig().register(new TestBinder());\n    }\n\n    @Test\n    public void testHogeHoge() throws Exception {\n        Response response = target(\"/\").request()\n                .buildGet()\n                .invoke();\n\n        assertThat(response.getStatus(), is(Response.Status.OK.getStatusCode()));\n    }\n}\n```\n\n\n#\u80cc\u666f\nMock\u4f7f\u3044\u305f\u304b\u3063\u305f\u306e\u3067Mockito\u3068\u304bObjenesis\u3068\u304bpom.xml\u306edependency\u306b\u7a81\u3063\u8fbc\u3093\u3067\u6c17\u4ed8\u3044\u305f\u3002\u4f55\u6545\u304bObjenesis\u3092\u8ffd\u52a0\u3055\u308c\u308b\u3068\u30c6\u30b9\u30c8\u6642\u306btest-persistence.xml\u3058\u3083\u306a\u304f\u3066persistence.xml\u306e\u65b9\u3092\u898b\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u3002\n\n\u3068\u308a\u3042\u3048\u305a\u30c7\u30d0\u30c3\u30b0\u3067\u8ffd\u3044\u304b\u3051\u305f\u3089 ***eclipselink.persistencexml*** \u3067\u5229\u7528\u3059\u308bpersistence.xml\u3092\u8a2d\u5b9a\u51fa\u6765\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u3002\u3002\u3002"}