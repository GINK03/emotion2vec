{"context": "\u30ed\u30b0\u306e\u5bb9\u91cf\u304c\u5897\u3048\u308b\u3068\u7ba1\u7406\u3057\u306b\u304f\u3044\u3053\u3068\u3068\u8ffd\u8de1\u304c\u96e3\u3057\u304f\u306a\u308b\u305f\u3081\u3001\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u3057\u305f\u3044\u3002\nrails\u95a2\u9023\u306e\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3092logrotate\u3067\u7ba1\u7406\u3059\u308b\u3002\n\nlogrotate\u306b\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3059\u308b\n\u307e\u305alogrotate.d\u914d\u4e0b\u306b\u3042\u308b\u3082\u306e\u3092\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3002\n$cd /etc/logrotate.d\n\n$ls -l\n\n\u5408\u8a08 36\n-rw-r--r-- 1 root root 103  9\u6708 14  2015 dracut\n-rw-r--r-- 1 root root 185  3\u6708  7 23:48 httpd\n-rw-r--r-- 1 root root 118  6\u6708 23 09:42 mackerel-agent\n-rw-r--r-- 1 root root 907 11\u6708 11  2015 mysqld\n-rw-r--r-- 1 root root 204  2\u6708 19 22:52 nginx\n-rw-r--r-- 1 root root 329  9\u6708 10  2014 psacct\n-rw-r--r-- 1 root root 210 11\u6708 11  2014 syslog\n-rw-r--r-- 1 root root 100 10\u6708 15  2015 yum\n\n\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\ntouch unicorn\n\n\u4f5c\u6210\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306b\u8a2d\u5b9a\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n$sudo vim unicorn\n\n/var/www/rails/app/current/log/*.log {\n  daily\n  missingok\n  rotate 7\n  dateext\n\n  compress\n  delaycompress\n  copytruncate\n\n  create 0666 ec2-user ec2-user\n\n  lastaction\n    pid=/var/www/app/current/tmp/pids/unicorn.pid\n    test -s $pid && kill -USR1 \"$(cat $pid)\"\n  endscript\n}\n\n\ndaily\uff1a\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u6bce\u65e5\u884c\u3046\nmissingok\uff1a\u6307\u5b9a\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u304c\u306a\u304f\u3066\u3082\u30a8\u30e9\u30fc\u3092\u51fa\u3055\u305a\u306b\u51e6\u7406\u3092\u7d9a\u884c\u3059\u308b\nrotate\uff1a\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30c8\u306e\u4e16\u4ee3\u7ba1\u7406\u306f7\ndateext\uff1a\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30c8\u3092\u65e5\u4ed8\u5f62\u5f0f\u306b\u3059\u308b\nlastaction~endscript\n\n\nunicorn\u306b\u306f\u3001USR1\u30b7\u30b0\u30ca\u30eb(\u30d7\u30ed\u30bb\u30b9\u306e\u52d5\u4f5c\u3092\u4e2d\u65ad\u3055\u305b\u305f\u308a\u3001\u518d\u958b\u3001\u5909\u66f4\u3068\u3044\u3063\u305f\u5408\u56f3\u3092\u9001\u308b\u305f\u3081\u306e\u6307\u5b9a)\u3092\u9001\u308b\u3068\u3001\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304d\u76f4\u3057\u3066\u304f\u308c\u308b\u6a5f\u80fd\u304c\u3042\u308a\u307e\u3059\u3002\ntest -s $pid\u300c\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3059\u308c\u3070\u300dkill -USR1 \"$(cat $pid)\"\u300cpid\u3092USR1\u3067kill\u3059\u308b\n\n\n\n\n\u30c6\u30b9\u30c8\n\u8a2d\u5b9a\u304c\u7d42\u4e86\u3057\u305f\u3089\u30c6\u30b9\u30c8\u3067\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n$cd /etc/logrotate.d\n\n$logrotate -df /etc/logrotate.d/unicorn\n\n\nd : \u30c7\u30d0\u30c3\u30b0\u30e2\u30fc\u30c9 \nf : \u5f37\u5236\u5b9f\u884c\n\n\n\u5b9f\u884c\uff08\u624b\u52d5\u3067\u9069\u7528\uff09\n$logrotate -f /etc/logrotate.d/unicorn\n\n$ls -l /var/www/rails/app/current/log\n\ntotal 652\n-rw-rw-r-- 1 vagrant vagrant 553843 Sep 20 12:19 development.log-20160213\n-rw-rw-r-- 1 vagrant vagrant  99141 Sep 20 12:19 unicorn.stderr.log-20160213\n-rw-rw-r-- 1 vagrant vagrant      0 Dec 21  2014 unicorn.stdout.log-20160213\n\nlogrotate\u306fcron\u304b\u3089\u8d77\u52d5\u3055\u308c\u308b\u306e\u3067\u3001\u4ee5\u4e0a\u3067\u8a2d\u5b9a\u5b8c\u4e86\u3067\u3059\u3002\u518d\u8d77\u52d5\u306f\u4e0d\u8981\u3067\u3059\u3002\n\u30ed\u30b0\u306e\u5bb9\u91cf\u304c\u5897\u3048\u308b\u3068\u7ba1\u7406\u3057\u306b\u304f\u3044\u3053\u3068\u3068\u8ffd\u8de1\u304c\u96e3\u3057\u304f\u306a\u308b\u305f\u3081\u3001\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u3057\u305f\u3044\u3002\n\nrails\u95a2\u9023\u306e\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3092logrotate\u3067\u7ba1\u7406\u3059\u308b\u3002\n\n##logrotate\u306b\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3059\u308b\n\n\u307e\u305alogrotate.d\u914d\u4e0b\u306b\u3042\u308b\u3082\u306e\u3092\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3002\n\n```\n$cd /etc/logrotate.d\n\n$ls -l\n\n\u5408\u8a08 36\n-rw-r--r-- 1 root root 103  9\u6708 14  2015 dracut\n-rw-r--r-- 1 root root 185  3\u6708  7 23:48 httpd\n-rw-r--r-- 1 root root 118  6\u6708 23 09:42 mackerel-agent\n-rw-r--r-- 1 root root 907 11\u6708 11  2015 mysqld\n-rw-r--r-- 1 root root 204  2\u6708 19 22:52 nginx\n-rw-r--r-- 1 root root 329  9\u6708 10  2014 psacct\n-rw-r--r-- 1 root root 210 11\u6708 11  2014 syslog\n-rw-r--r-- 1 root root 100 10\u6708 15  2015 yum\n```\n\n\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\ntouch unicorn\n```\n\n\u4f5c\u6210\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306b\u8a2d\u5b9a\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n```\n$sudo vim unicorn\n\n/var/www/rails/app/current/log/*.log {\n  daily\n  missingok\n  rotate 7\n  dateext\n\n  compress\n  delaycompress\n  copytruncate\n\n  create 0666 ec2-user ec2-user\n\n  lastaction\n    pid=/var/www/app/current/tmp/pids/unicorn.pid\n    test -s $pid && kill -USR1 \"$(cat $pid)\"\n  endscript\n}\n```\n\n- daily\uff1a\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u6bce\u65e5\u884c\u3046\n- missingok\uff1a\u6307\u5b9a\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u304c\u306a\u304f\u3066\u3082\u30a8\u30e9\u30fc\u3092\u51fa\u3055\u305a\u306b\u51e6\u7406\u3092\u7d9a\u884c\u3059\u308b\n- rotate\uff1a\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30c8\u306e\u4e16\u4ee3\u7ba1\u7406\u306f7\n- dateext\uff1a\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30c8\u3092\u65e5\u4ed8\u5f62\u5f0f\u306b\u3059\u308b\n- lastaction~endscript\n    - unicorn\u306b\u306f\u3001USR1\u30b7\u30b0\u30ca\u30eb(\u30d7\u30ed\u30bb\u30b9\u306e\u52d5\u4f5c\u3092\u4e2d\u65ad\u3055\u305b\u305f\u308a\u3001\u518d\u958b\u3001\u5909\u66f4\u3068\u3044\u3063\u305f\u5408\u56f3\u3092\u9001\u308b\u305f\u3081\u306e\u6307\u5b9a)\u3092\u9001\u308b\u3068\u3001\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304d\u76f4\u3057\u3066\u304f\u308c\u308b\u6a5f\u80fd\u304c\u3042\u308a\u307e\u3059\u3002\n    - test -s \\$pid\u300c\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3059\u308c\u3070\u300dkill -USR1 \"\\$(cat \\$pid)\"\u300cpid\u3092USR1\u3067kill\u3059\u308b\n\n##\u30c6\u30b9\u30c8\n\u8a2d\u5b9a\u304c\u7d42\u4e86\u3057\u305f\u3089\u30c6\u30b9\u30c8\u3067\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\n$cd /etc/logrotate.d\n\n$logrotate -df /etc/logrotate.d/unicorn\n```\n- d : \u30c7\u30d0\u30c3\u30b0\u30e2\u30fc\u30c9 \n- f : \u5f37\u5236\u5b9f\u884c\n\n##\u5b9f\u884c\uff08\u624b\u52d5\u3067\u9069\u7528\uff09\n\n```\n$logrotate -f /etc/logrotate.d/unicorn\n\n$ls -l /var/www/rails/app/current/log\n\ntotal 652\n-rw-rw-r-- 1 vagrant vagrant 553843 Sep 20 12:19 development.log-20160213\n-rw-rw-r-- 1 vagrant vagrant  99141 Sep 20 12:19 unicorn.stderr.log-20160213\n-rw-rw-r-- 1 vagrant vagrant      0 Dec 21  2014 unicorn.stdout.log-20160213\n```\n\nlogrotate\u306fcron\u304b\u3089\u8d77\u52d5\u3055\u308c\u308b\u306e\u3067\u3001\u4ee5\u4e0a\u3067\u8a2d\u5b9a\u5b8c\u4e86\u3067\u3059\u3002\u518d\u8d77\u52d5\u306f\u4e0d\u8981\u3067\u3059\u3002\n\n", "tags": ["Rails5", "unicorn", "nginx", "logrotate"]}