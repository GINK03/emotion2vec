{"context": "\n\n\u80cc\u666f\n\u4eca\u307e\u3067\u3082SES\u3092\u4f7f\u3063\u3066\u3044\u305f\u3002\n\u57fa\u672c\u306f\u3001SES\u3067\u3001Domain\u3092\u767b\u9332\u3057\u3066\u3001Create SMTP credentials\u3068\u3044\u3046\u306e\u3092\u30af\u30ea\u30c3\u30af\u3059\u308c\u3070\u3001\u305d\u306eUser\u3068Pass\u304c\u3082\u3089\u3048\u308b\u306e\u3067\u3001\u305d\u308c\u3092Rails\u306eSMTP\u306e\u8a2d\u5b9a\u306b\u66f8\u304f\n\u4f8b\u3048\u3070\u3001\u4ee5\u4e0b\u306e\u69d8\u306a\u306e\u3092\u66f8\u304d\u3001\n\nconfig/mail.yml\ndevelopment: \n  address: email-smtp.us-east-1.amazonaws.com\n  port: 587\n  domain: <yourdomain>\n  user_name: FIOHFOHFLUELFNUL <-\u307f\u305f\u3044\u306aCreate SMTP credentials\u3067\u767a\u884c\u3055\u308c\u305f\u3084\u3064\n  password: Afa832nfoa83... <- \u3053\u308c\u3082\u540c\u69d8\n  authentication: login\n  enable_starttls_auto: true\n\nproduction:\n  ...\n\n\n\u305d\u308c\u3092initializer\u3067\u8aad\u3093\u3067\u3001smtp_settings\u306b\u30bb\u30c3\u30c8\u3059\u308b\u3002\n\nconfig/initializers/mail.rb\nf = File.open(\"#{Rails.root}/config/mail.yml\")\nemail_settings = YAML.load(f)[Rails.env].map do |k, v|\n  [k.to_sym, v]\nend.to_h\nActionMailer::Base.smtp_settings = email_settings\n\n\n\u305d\u3057\u3066\u6700\u5f8c\u306b\u3001config/environments/development.rb \u306a\u3069\u3067\n\nconfig/environments/development.rb\nconfig.action_mailer.delivery_method = :smtp\n\n\n\u3068\u66f8\u3044\u3066\u304a\u3051\u3070\u3088\u3044\u3002\n\n\u4eca\u56de\u306f\u3001IAM user\u3068DKIM\u3092\u4f7f\u3046!\n\u3084\u3063\u305f\u3053\u3068\u306a\u3044\u306e\u3067\u3001\u3084\u3063\u3066\u307f\u308b\uff01\n\u53c2\u8003\u306b\u3059\u308b\u306e\u306f\u3001\nRails\u3067Amazon SES\u30fbRoute53\u3092\u7528\u3044\u3066\u30c9\u30e1\u30a4\u30f3\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\n\u304b\u306a\u308a\u308f\u304b\u308a\u3084\u3059\u3044\uff01\n\n\u307e\u305a\u306f\u3001IAM User\u4f5c\u6210\u304b\u3089\nhttps://console.aws.amazon.com/iam\n\u3067User\u3092\u4f5c\u6210\u3002\n\u4f5c\u6210\u3057\u305f\u6642\u306b\u3001AccessKeyId\u3068SecretAccessKey\u3092\u767a\u884c\u3059\u308b\u306e\u3067\u3001\u305d\u308c\u3092Download\u3057\u3066\u7121\u304f\u3055\u306a\u3044\u3088\u3046\u306b\u3059\u308b\uff01\uff01\uff01\n\u305d\u306e\u5f8c\u3001SES\u753b\u9762\u304b\u3089Policy\u3092\u8ffd\u52a0\u3059\u308b\u3002\u30dd\u30ea\u30b7\u30fc\u306b\u95a2\u3057\u3066\u306f\u3001https://docs.aws.amazon.com/ja_jp/ses/latest/DeveloperGuide/sending-authorization-policies.html?icmpid=docs_ses_console\n\u3092\u53c2\u7167\u3002\n\u5927\u4e8b\u306a\u306e\u306f\u3001resources(mail\u3092\u9001\u308bDomain\uff09,Principal\uff08\u6a29\u9650\u3092\u53d7\u3051\u308bIAM\u30e6\u30fc\u30b6\uff09\u3001Action\uff08\u4eca\u56de\u306fses:SendEmail, ses:SendRawEmail\uff09\u3002\n\u3053\u308c\u3092\u8a2d\u5b9a\u3057\u3066\u3059\u308b\u3002\n\n\u6b21\u306bRails\u3067Gem\u3092\u5165\u308c\u3066\u8a2d\u5b9a\u3059\u308b\naws-ses\u3068\u3044\u3046Gem(aws-ses)\u3092\u3044\u308c\u3066bundle install\ngem 'aws-ses', require: 'aws/ses'\n\n\u4e0a\u8a18\u3068\u540c\u3058\u3088\u3046\u306bconfig/mail.yml\u306b\u8a2d\u5b9a\u3092\u66f8\u304f\n\nconfig/mail.yml\ndevelopment:\n  access_key_id: <ACCESS_KEY_ID>\n  secret_access_key: <SECRET_ACCESS_KEY>\n\n\n\u4e0a\u306email.yml\u304b\u3089\u8aad\u307f\u8fbc\u3080\n\nconfig/initializers/mail.rb\nf = File.open(\"#{Rails.root}/config/mail.yml\")\nconfig = YAML.load(f)[Rails.env]\nnActionMailer::Base.add_delivery_method(:ses, AWS::SES::Base,\n                                       { access_key_id: config['access_key_id'],\n                                         secret_access_key: config['secret_access_key'] })\n\n\n\u3053\u308c\u3067\u3001rails console\u304b\u3089\u8a66\u3057\u3066\u307f\u308b\u3002\nrails g mailer MyMailer\u306a\u3069\u3067\u3064\u304f\u3063\u305fMailer\u3067\u3001\nclass MyMailer < ActionMailer\n  def hello\n    mail to: 'test@gmail.com', subject: 'subject'\n  end\nend\n\nMyMailer.hello.deliver_now\n\n\u3053\u308c\u3067\u6210\u529f\u3059\u308c\u3070\u30aa\u30c3\u30b1\u30fc\uff01\n\u304c\u3001\u3057\u304b\u3057\uff01\n\u30a8\u30e9\u30fc\u304c\u51fa\u308b\uff01\nAws::SES::Errors::AccessDenied: User `arn:aws:iam::<aws-id>:user/<username>' is not authorized to perform `ses:SendRawEmail' on resource `arn:aws:ses:<region>:<aws-id>:identity/<domain>'\n\nSES\u3067Policy \u3067\u6307\u5b9a\u3057\u3066\u3042\u3052\u305f\u306e\u306b\u3001\u4f55\u6545\uff1f\uff1f\uff1f\u304b\u306a\u308a\u8abf\u3079\u305f\u6319\u53e5\u3001\u308f\u304b\u3089\u306a\u3044\u306e\u3067\u3001\u3068\u308a\u3042\u3048\u305a\u76f4\u63a5IAM User\u306e\u65b9\u306bPolicy\u3092\u8ffd\u52a0\u3057\u3001FullSESAccess\u3092\u3042\u3052\u305f\u3089\u3001\u30e1\u30fc\u30eb\u304c\u9001\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002\n\u7406\u7531\u306f\u8b0e\u3002\u3002\uff08\u89e3\u6c7a\u7b56\u304c\u3042\u308a\u6b21\u7b2c\u66f4\u65b0\uff09\n\u307e\u3042\u3081\u3067\u305f\u304f\u3001\u300cRails\u304b\u3089SES\u306e\u30e1\u30fc\u30eb\u304cIAMUser\u3067\u9001\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u300d\n\n\u3000DKIM\nSES\u3068Route53\u3092\u4f7f\u3063\u3066\u308b\u3068\u52dd\u624b\u306b\u8a2d\u5b9a\u3055\u308c\u308b\u3063\u307d\u3044\uff08\uff1f\uff09\n# \u80cc\u666f\n\n\u4eca\u307e\u3067\u3082SES\u3092\u4f7f\u3063\u3066\u3044\u305f\u3002\n\n\u57fa\u672c\u306f\u3001SES\u3067\u3001Domain\u3092\u767b\u9332\u3057\u3066\u3001Create SMTP credentials\u3068\u3044\u3046\u306e\u3092\u30af\u30ea\u30c3\u30af\u3059\u308c\u3070\u3001\u305d\u306eUser\u3068Pass\u304c\u3082\u3089\u3048\u308b\u306e\u3067\u3001\u305d\u308c\u3092Rails\u306eSMTP\u306e\u8a2d\u5b9a\u306b\u66f8\u304f\n\n\u4f8b\u3048\u3070\u3001\u4ee5\u4e0b\u306e\u69d8\u306a\u306e\u3092\u66f8\u304d\u3001\n\n```config/mail.yml\ndevelopment: \n  address: email-smtp.us-east-1.amazonaws.com\n  port: 587\n  domain: <yourdomain>\n  user_name: FIOHFOHFLUELFNUL <-\u307f\u305f\u3044\u306aCreate SMTP credentials\u3067\u767a\u884c\u3055\u308c\u305f\u3084\u3064\n  password: Afa832nfoa83... <- \u3053\u308c\u3082\u540c\u69d8\n  authentication: login\n  enable_starttls_auto: true\n\nproduction:\n  ...\n```\n\n\u305d\u308c\u3092initializer\u3067\u8aad\u3093\u3067\u3001smtp_settings\u306b\u30bb\u30c3\u30c8\u3059\u308b\u3002\n\n```config/initializers/mail.rb\nf = File.open(\"#{Rails.root}/config/mail.yml\")\nemail_settings = YAML.load(f)[Rails.env].map do |k, v|\n  [k.to_sym, v]\nend.to_h\nActionMailer::Base.smtp_settings = email_settings\n```\n\n\u305d\u3057\u3066\u6700\u5f8c\u306b\u3001config/environments/development.rb \u306a\u3069\u3067\n\n```config/environments/development.rb\nconfig.action_mailer.delivery_method = :smtp\n```\n\n\u3068\u66f8\u3044\u3066\u304a\u3051\u3070\u3088\u3044\u3002\n\n\n#\u4eca\u56de\u306f\u3001IAM user\u3068DKIM\u3092\u4f7f\u3046!\n\n\u3084\u3063\u305f\u3053\u3068\u306a\u3044\u306e\u3067\u3001\u3084\u3063\u3066\u307f\u308b\uff01\n\n\u53c2\u8003\u306b\u3059\u308b\u306e\u306f\u3001\n[Rails\u3067Amazon SES\u30fbRoute53\u3092\u7528\u3044\u3066\u30c9\u30e1\u30a4\u30f3\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b](http://qiita.com/tanakaworld/items/94f1ba66801100f6a44f#%E6%96%B0%E8%A6%8F%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E4%BD%9C%E6%88%90)\n\n\u304b\u306a\u308a\u308f\u304b\u308a\u3084\u3059\u3044\uff01\n\n\n\n## \u307e\u305a\u306f\u3001IAM User\u4f5c\u6210\u304b\u3089\n\nhttps://console.aws.amazon.com/iam\n\u3067User\u3092\u4f5c\u6210\u3002\n\n\u4f5c\u6210\u3057\u305f\u6642\u306b\u3001AccessKeyId\u3068SecretAccessKey\u3092\u767a\u884c\u3059\u308b\u306e\u3067\u3001\u305d\u308c\u3092Download\u3057\u3066\u7121\u304f\u3055\u306a\u3044\u3088\u3046\u306b\u3059\u308b\uff01\uff01\uff01\n\n\n\u305d\u306e\u5f8c\u3001SES\u753b\u9762\u304b\u3089Policy\u3092\u8ffd\u52a0\u3059\u308b\u3002\u30dd\u30ea\u30b7\u30fc\u306b\u95a2\u3057\u3066\u306f\u3001https://docs.aws.amazon.com/ja_jp/ses/latest/DeveloperGuide/sending-authorization-policies.html?icmpid=docs_ses_console\n\u3092\u53c2\u7167\u3002\n\n\u5927\u4e8b\u306a\u306e\u306f\u3001resources(mail\u3092\u9001\u308bDomain\uff09,Principal\uff08\u6a29\u9650\u3092\u53d7\u3051\u308bIAM\u30e6\u30fc\u30b6\uff09\u3001Action\uff08\u4eca\u56de\u306fses:SendEmail, ses:SendRawEmail\uff09\u3002\n\n\u3053\u308c\u3092\u8a2d\u5b9a\u3057\u3066\u3059\u308b\u3002\n\n\n## \u6b21\u306bRails\u3067Gem\u3092\u5165\u308c\u3066\u8a2d\u5b9a\u3059\u308b\n\n\n\naws-ses\u3068\u3044\u3046Gem([aws-ses](https://github.com/drewblas/aws-ses))\u3092\u3044\u308c\u3066`bundle install`\n\n```Gemfile\ngem 'aws-ses', require: 'aws/ses'\n```\n\n\n\u4e0a\u8a18\u3068\u540c\u3058\u3088\u3046\u306bconfig/mail.yml\u306b\u8a2d\u5b9a\u3092\u66f8\u304f\n\n```config/mail.yml\ndevelopment:\n  access_key_id: <ACCESS_KEY_ID>\n  secret_access_key: <SECRET_ACCESS_KEY>\n```\n\n\u4e0a\u306email.yml\u304b\u3089\u8aad\u307f\u8fbc\u3080\n\n```config/initializers/mail.rb\nf = File.open(\"#{Rails.root}/config/mail.yml\")\nconfig = YAML.load(f)[Rails.env]\nnActionMailer::Base.add_delivery_method(:ses, AWS::SES::Base,\n                                       { access_key_id: config['access_key_id'],\n                                         secret_access_key: config['secret_access_key'] })\n```\n\n\u3053\u308c\u3067\u3001`rails console`\u304b\u3089\u8a66\u3057\u3066\u307f\u308b\u3002\n\n`rails g mailer MyMailer`\u306a\u3069\u3067\u3064\u304f\u3063\u305fMailer\u3067\u3001\n\n```\nclass MyMailer < ActionMailer\n  def hello\n    mail to: 'test@gmail.com', subject: 'subject'\n  end\nend\n```\n\n\n```rb\nMyMailer.hello.deliver_now\n```\n\n\u3053\u308c\u3067\u6210\u529f\u3059\u308c\u3070\u30aa\u30c3\u30b1\u30fc\uff01\n\n\u304c\u3001\u3057\u304b\u3057\uff01\n\n\u30a8\u30e9\u30fc\u304c\u51fa\u308b\uff01\n\n```\nAws::SES::Errors::AccessDenied: User `arn:aws:iam::<aws-id>:user/<username>' is not authorized to perform `ses:SendRawEmail' on resource `arn:aws:ses:<region>:<aws-id>:identity/<domain>'\n```\n\nSES\u3067Policy \u3067\u6307\u5b9a\u3057\u3066\u3042\u3052\u305f\u306e\u306b\u3001\u4f55\u6545\uff1f\uff1f\uff1f\u304b\u306a\u308a\u8abf\u3079\u305f\u6319\u53e5\u3001\u308f\u304b\u3089\u306a\u3044\u306e\u3067\u3001\u3068\u308a\u3042\u3048\u305a\u76f4\u63a5IAM User\u306e\u65b9\u306bPolicy\u3092\u8ffd\u52a0\u3057\u3001FullSESAccess\u3092\u3042\u3052\u305f\u3089\u3001\u30e1\u30fc\u30eb\u304c\u9001\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002\n\n\u7406\u7531\u306f\u8b0e\u3002\u3002\uff08\u89e3\u6c7a\u7b56\u304c\u3042\u308a\u6b21\u7b2c\u66f4\u65b0\uff09\n\n\n\u307e\u3042\u3081\u3067\u305f\u304f\u3001\u300cRails\u304b\u3089SES\u306e\u30e1\u30fc\u30eb\u304cIAMUser\u3067\u9001\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u300d\n\n\n#\u3000DKIM\n\nSES\u3068Route53\u3092\u4f7f\u3063\u3066\u308b\u3068\u52dd\u624b\u306b\u8a2d\u5b9a\u3055\u308c\u308b\u3063\u307d\u3044\uff08\uff1f\uff09\n\n\n\n\n\n\n", "tags": ["Rails", "email", "Rails4", "DKIM"]}