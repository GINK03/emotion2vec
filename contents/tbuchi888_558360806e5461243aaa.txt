{"context": "\n\nRe:dash \u306ePostgreSQL \u3078 CSV\u30d5\u30a1\u30a4\u30eb\u3092 Digdag * Embulk \u7d4c\u7531\u3067\u767b\u9332\u3059\u308b\n\n0.\u306f\u3058\u3081\u306b\n\u3053\u3061\u3089\u306fre:dash Advent Calendar 2016\u306e22\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\nAdvent Calendar\u306b\u3064\u3044\u3066\u51fa\u9045\u308c\u305f\u3068\u601d\u3063\u3066\u3044\u305f\u3068\u3053\u308d\u3001\u3001\u3001\n\u3053\u3061\u3089\u306f\u307e\u3060\u7a7a\u304d\u67a0\u304c\u3042\u308a\u307e\u3057\u305f\u306e\u3067\u53c2\u52a0\u3057\u307e\u3057\u305f\u3002\nMac\u4e0a\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u3067\nCSV\u30d5\u30a1\u30a4\u30eb\u3092 digdag -> embulk ->\u3000(Re:dash\u306e)PostgreSQL\u3078\u683c\u7d0d\u3057\u3066Re\uff1adash\u304b\u3089\u898b\u308b\u3068\u3053\u308d\u307e\u3067\u3092\u8a18\u4e8b\u306b\u3057\u307e\u3059\u3002\n\u30c7\u30e2\u3084\u7d20\u632f\u308a\u7528\u306a\u3069\u306e\u53c2\u8003\u306b\u3057\u3066\u9802\u3051\u308c\u3070\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u306f\u4eca\u56de\u672c\u8a18\u4e8b\u3067\u306f\u53d6\u308a\u6271\u3044\u307e\u305b\u3093\u304c\u4ee5\u524d\u66f8\u304d\u307e\u3057\u305f\u3053\u3061\u3089\u306e\u8a18\u4e8b\u3084\u3001\u3053\u3061\u3089\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u5fdc\u7528\u3059\u308b\u3068ChatOps\u7684\u306a\u611f\u3058\u3067\u30c7\u30fc\u30bf\u767b\u9332\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n\n1.\u74b0\u5883\n\nOSX Yosemite\nDocker version 1.13.0-rc3, build 4d92237\ndocker-compose version 1.9.0, build 2585387\n\n\u4ee5\u964d\u306f\u4eca\u56de\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3082\u306e\uff082016/12/21\u6642\u70b9\uff09\n\njava version \"1.8.0_111\"\nDigdag 0.9.1\nembulk 0.8.15\n\n\nembulk-output-postgresql (0.7.2, 0.6.3)\n\n\nRe:dash 0.11.1+b2095\n\n\nnginx/1.9.10\nRedis server v=2.8.23\npostgres (PostgreSQL) 9.3.14\n\n\n\n\n2.\u5404\u7a2e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n2.1.Java8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nDigdag\u3068Embulk\u306fJava \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5fc5\u8981\u3067\u3059\u3002\nmac\u306e\u5834\u5408\u306f\u3053\u3061\u3089\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n2.2.Didag\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nhttp://docs.digdag.io/getting_started.html#downloading-the-latest-version\n\u3088\u308a\u5f15\u7528\n\n\n1. Downloading the latest version\nDigdag is a single executable file. You can install the file to ~/bin using curl command as following:\n$ curl -o ~/bin/digdag --create-dirs -L \"https://dl.digdag.io/digdag-latest\"\nchmod+x\u00a0/bin/digdag chmod +x ~/bin/digdag \n echo 'export PATH=\"HOME/bin:HOME/bin:PATH\"' >> ~/.bashrc\nPlease reopen your terminal window or type following command so that the change of PATH takes effect.\n$ source ~/.bashrc\n\n\u306a\u304a\u3001mac\u306a\u306e\u3067.bashrc\u304b\u3089.bash_profile\u3078\u5909\u66f4\ncurl -o ~/bin/digdag --create-dirs -L \"https://dl.digdag.io/digdag-latest\"\nchmod +x ~/bin/digdag\necho 'export PATH=\"$HOME/bin:$PATH\"' >> ~/.bash_profile\nsource ~/.bash_profile\n\n\n2.3.Embulk\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nhttps://github.com/embulk/embulk#linux--mac--bsd\n\u3088\u308a\u5f15\u7528\n\ncurl --create-dirs -o ~/.embulk/bin/embulk -L \"http://dl.embulk.org/embulk-latest.jar\"\nchmod +x ~/.embulk/bin/embulk\necho 'export PATH=\"HOME/.embulk/bin:HOME/.embulk/bin:PATH\"' >> ~/.bashrc\nsource ~/.bashrc\n\nDigdag\u3067\u65e2\u306b~/bin/\u3078\u30d1\u30b9\u3092\u901a\u3057\u3066\u3044\u308b\u306e\u3067\nDigdag\u306b\u5408\u308f\u305b\u3066\u683c\u7d0d\u5148\u3092~/bin/\u914d\u4e0b\u306b\u30b3\u30d4\u30fc\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\ncurl --create-dirs -o ~/bin/embulk -L \"http://dl.embulk.org/embulk-latest.jar\"\nchmod +x ~/bin/embulk\n# digdag \u3067\u30d1\u30b9\u3092\u901a\u3057\u3066\u3044\u308b\u306e\u3067\u4ee5\u4e0b\uff12\u884c\u306f\u4e0d\u8981\n#echo 'export PATH=\"$HOME/bin:$PATH\"' >> ~/.bash_profile\n#source ~/.bash_profile\n\n# \u4eca\u56de\u5229\u7528\u3059\u308bPlugin\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nembulk gem install embulk-output-postgresql\n\n\n2.4.Re:dash\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nhttp://docs.redash.io/en/latest/setup.html#docker-compose\n\u3088\u308a\u5f15\u7528\n\nDocker Compose\n1.Make sure you have a Docker machine up and running.\n2.Make sure your current working directory is the root of this GitHub repository.\n3.Run docker-compose up postgres.\n4.Run ./setup/docker/create_database.sh. This will access the postgres container and set up the database.\n5.Run docker-compose up\n6.Run docker-machine ls, take note of the ip for the Docker machine you are using, and open the web browser.\n7.Visit that Docker machine IP at port 80, and you should see a Re:dash login screen.\nNow proceed to \u201cSetup\u201d.\n\nDocker for mac \u3092\u5229\u7528\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u304c\u3001\u516c\u5f0f\u306e\u307e\u307e\u3060\u3068mac\u7279\u6709\u554f\u984c\u306b\u3042\u305f\u308a\u307e\u3059\u306e\u3067\u4ee5\u4e0b\u624b\u9806\u3067\u884c\u3044\u307e\u3059\u3002\n\u8a73\u7d30\u306f\u4ee5\u524d\u66f8\u3044\u305f\u300cRe:dash\u300d\u3092\u300cDocker for Mac\u300d\u4e0a\u3067\u52d5\u304b\u3057\u3066\u307f\u305f\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n# 1.git clone \u3068\u3000\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u79fb\u52d5\ngit clone https://github.com/getredash/redash.git\ncd redash/\n\n# 2.docker-compose-example.yml\u3088\u308a\u3001docker-compose.yml\u3092\u4f5c\u6210\n#   Docker\u30db\u30b9\u30c8\u4e0a\u306ePostgreSQL\u306e\u30c7\u30fc\u30bf\u7f6e\u304d\u5834\u3092/opt/postgres-data\u304b\u3089\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b./postgres-data\u3078\u5909\u66f4\uff08\u74b0\u5883\u306b\u3088\u308a\u9069\u5b9c\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\uff09\n#   sed\u3092\u4f7f\u308f\u305a\u306b `mv docker-compose-example.yml docker-compose.yml`\u3057\u3066 `vi docker-compose.yml`\u3067\u3082OK\n# \u3000\u306a\u304a\u3001mac\u3067\u306f\u306a\u304f\u3001Linux\u3067\u3042\u308c\u3070`mv docker-compose-example.yml docker-compose.yml`\u3060\u3051\u3067\u554f\u984c\u3068\u601d\u3044\u307e\u3059\u3002\ncat docker-compose-example.yml | sed -e \"s/\\/opt\\/postgres-data/\\.\\/postgres-data/\" > docker-compose.yml\n\n\u307e\u305f\u4eca\u56de\u306f\nembulk\u304b\u3089PostgreSQL\u30b3\u30f3\u30c6\u30ca\u306e5432port\u3078\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u306a\u3088\u3046\u306b\ndocker-compose.yml\u306epostgres\u90e8\u5206\u3078ports:\u3000\u3000\u3000- \"5432:5432\"\u306e\u8a2d\u5b9a\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\u3053\u308c\u3092\u3084\u3063\u3066\u304a\u304b\u306a\u3044\u3068\u5f8c\u534a\u306edigdag/embulk\u90e8\u5206\u3067\u30a8\u30e9\u30fc\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u3000docker-compose.yml\nredash:\n  image: redash/redash:latest\n  ports:\n    - \"5000:5000\"\n  links:\n    - redis\n    - postgres\n  environment:\n    REDASH_LOG_LEVEL: \"INFO\"\n    REDASH_REDIS_URL: \"redis://redis:6379/0\"\n    REDASH_DATABASE_URL: \"postgresql://postgres@postgres/postgres\"\n    REDASH_COOKIE_SECRET: veryverysecret\nredis:\n  image: redis:2.8\npostgres:\n  image: postgres:9.3\n  ports:\n    - \"5432:5432\"\n  volumes:\n    - ./postgres-data:/var/lib/postgresql/data\nredash-nginx:\n  image: redash/nginx:latest\n  ports:\n    - \"80:80\"\n  links:\n    - redash\n\n\n# 3.`-d` \u30aa\u30d7\u30b7\u30e7\u30f3(\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u8d77\u52d5)\u3092\u3064\u3051\u3066PostgreSQL\u3060\u3051\u8d77\u52d5\ndocker-compose up -d postgres\n\n# 4.create_database.sh\u306e\u5b9f\u884c\n./setup/docker/create_database.sh\n\n# 5. \u6b8b\u308a\u3082`-d` \u30aa\u30d7\u30b7\u30e7\u30f3(\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u8d77\u52d5)\u3092\u3064\u3051\u3066\u8d77\u52d5\ndocker-compose up -d\n\n\n3.\u5404\u7a2e\u8a2d\u5b9a\n\n3.1.Digdag\n\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u6e96\u5099\u3057\u307e\u3059\u3002\n\ncsv2postgres.dig\ntimezone: Asia/Tokyo\n\n_export:\n  workflow_name: \"csv2postgres\"\n  start_msg:     \"digdag ${workflow_name} start\"\n  end_msg:       \"digdag ${workflow_name} finish\"\n  error_msg:     \"digdag ${workflow_name} error\"\n\n+strat:\n  echo>: ${start_msg}\n\n# make config file for embulk\n+guess_embulk:\n  sh>: embulk guess ./guess.yml -o ./config.yml\n\n+csv_to_db:\n  embulk>: ./config.yml\n\n## This is for _error confirmation. \n##+fail:\n##  fail>: \"fail!\"\n\n+end:\n  echo>: ${end_msg}\n\n_error:\n  echo>: ${error_msg}\n\n\n\n3.2.Embulk\n\u5143\u30c7\u30fc\u30bf\u306eCSV\u30d5\u30a1\u30a4\u30eb\uff08\u4eca\u56de\u306f./data/org_sample.csv\uff09\u3068guess.yml\u3092\u6e96\u5099\u3057\u307e\u3059\u3002\nEmbulk\u306eGuess\u3092\u4f7f\u3063\u3066\u3001csv\u30d5\u30a1\u30a4\u30eb\u304b\u3089Postgresql\u3078\u5165\u308c\u308b\u969b\u306eConfig\u30d5\u30a1\u30a4\u30eb\u3092\u81ea\u52d5\u751f\u6210\u3057\u307e\u3059\u3002\n\n\u3000./data/org_sample.csv\nyyyy/mm/dd,user,item,cost\n2016/12/21,user01,AAA,2000\n2016/12/22,user02,BBB,100\n2016/12/23,user03,AAA,2000\n2016/12/24,user01,BBB,100\n\n\nGuess\u6a5f\u80fd\u3067\u81ea\u52d5\u751f\u6210\u3055\u305b\u308b\u305f\u3081\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306bIn\u306eparser\u306ecolumns\uff1a\u914d\u4e0b\u3092\u7a7a\u884c\u306b\u3057\u307e\u3059\u3002\nin\u306ecsv-parser-plugin\u90e8\u5206\u306e\u8a73\u7d30\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f\u3053\u3061\u3089\u3092\nhttp://www.embulk.org/docs/built-in.html#csv-parser-plugin\n\u306a\u304a\u3001path_prefix:\u306b\u3064\u3044\u3066\u306f\u3001\u5bfe\u8c61\u30d5\u30a1\u30a4\u30eb\u7fa4\u306e\u5148\u982d\u306e\u4e00\u90e8\u6587\u5b57\u5217\u306e\u6307\u5b9a\u304c\u5fc5\u8981\u3067\u3059\u3002\nout\u306eembulk-output-postgresql\u90e8\u5206\u306e\u8a73\u7d30\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f\u3053\u3061\u3089\u3092\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002\nhttp://www.rubydoc.info/gems/embulk-output-postgresql/0.7.2\ntable: \u304c\u4eca\u56de\u4f5c\u6210\u3055\u308c\u308b\u30c6\u30fc\u30d6\u30eb\u540d\u3068\u306a\u308a\u307e\u3059\u3002\nPostgreSQL\u306eDB\u540d\u7b49\u306fdocker-compose\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u969b\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u304b\u3089\u5909\u66f4\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u81ea\u74b0\u5883\u306b\u5408\u308f\u305b\u305f\u8a2d\u5b9a\u3092\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n\nguess.yml\nin:\n  type: file\n  path_prefix: ./data/org_\n  parser:\n    charset: UTF-8\n    newline: CRLF\n    type: csv\n    delimiter: ','\n    quote: '\"'\n    escape: '\"'\n    trim_if_not_quoted: false\n    skip_header_lines: 1\n    allow_extra_columns: false\n    allow_optional_columns: false\n    columns:\nout:\n  type: postgresql\n  default_timezone: Japan\n  host: localhost\n  user: postgres\n  password: postgres\n  database: postgres\n  table: sampledata\n  options: {loglevel: 2}\n  mode: insert_direct\n\n\n\n3.3.Re:dash\u306eDataSource\u8a2d\u5b9a\nRe:dash\u3068\u4e00\u7dd2\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fPostgreSQL\u3092\u305d\u306e\u307e\u307e\u5229\u7528\u3059\u308b\u305f\u3081\u306bDATASOURCES\u3092\u4ee5\u4e0b\u306b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001PostgreSQL\u306eDB\u540d\u7b49\u306fdocker-compose\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u969b\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\u30d6\u30e9\u30a6\u30b6\u3067 http://127.0.0.1/ \u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3078\u30a2\u30af\u30bb\u30b9\u3057\nadmin/admin\uff08\u521d\u671f\u5024\uff09\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\n\u30ed\u30b0\u30a4\u30f3\u5f8c\u306b\u53f3\u4e0a\u306eDB\u30a2\u30a4\u30b3\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\n\n\uff0bNew Data Source\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\nName\u306b\u9069\u5f53\u306a\u540d\u524d\uff08\u4eca\u56de\u306ftest\uff09\u3092\u5165\u308c\u3066\u3001Type\u3068\u3057\u3066PostgreSQL\u3092\u9078\u629e\u3057\u307e\u3059\u3002\ndocker-compose\u3067redash\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u308b\u524d\u63d0\u3067\nDatabase Name,host,password,user\u306b\u5168\u3066postgres\u3092\u8a2d\u5b9a\u3057\u3066Save\u3057\u307e\u3059\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u304b\u3089\u5909\u66f4\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u81ea\u74b0\u5883\u306b\u5408\u308f\u305b\u305f\u8a2d\u5b9a\u3092\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n\n\u4e0a\u6bb5\u306eQueries\u304b\u3089New\u3000Query\u3092\u9078\u629e\n\nData Source\u306e\u30d7\u30eb\u30c0\u30a6\u30f3\u304b\u3089\u5148\u307b\u3069\u767b\u9332\u3057\u305ftest\u304c\u9078\u629e\u3067\u304d\u308c\u3070OK\u3067\u3059\u3002\n\n\n\n4.\u5b9f\u884c\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\u3057\n\u251c\u2500\u2500 csv2postgres.dig\n\u251c\u2500\u2500 data\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 org_sample.csv\n\u2514\u2500\u2500 guess.yml\n\nterminal\u304b\u3089Digdag\u3092\u5b9f\u884c\u3057\u3066CSV\u30c7\u30fc\u30bf\u3092PostgreSQL\u4e0a\u30c6\u30fc\u30d6\u30eb\u3078\u683c\u7d0d\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001\u4e0b\u306e\u4f8b\u3067\u306f\u3001\u7e70\u308a\u8fd4\u3057\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306b-a\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u3066\u3044\u307e\u3059\u3002\ndigdag run csv2postgres.dig -a\n\n\u5b9f\u884c\u7d50\u679c\u3068\u3057\u3066\u6700\u5f8c\u306b\nSuccess. Task state is saved at /Users/*********\n\u3068\u51fa\u308c\u3070\u6210\u529f\u3067\u3059\u3002\n\u306a\u304a\u3001PostgreSQL\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3067\u30a8\u30e9\u30fc\u3068\u306a\u308b\u5834\u5408\u4ee5\u4e0b\u3092\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002\n-\u3000postgresql\u306eid,passwaord\u306a\u3069\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u304b\u3089\u5909\u66f4\u3057\u3066\u3044\u306a\u3044\u304b\uff1f\n- \u4e0a\u8ff0\u306e2.4.Re:dash\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067docker\u2212compose.yml\u306b\u3064\u3044\u3066postgresql\u30b3\u30f3\u30c6\u30ca\u3078\u306e\uff15\uff14\uff13\uff12port\u306e\u30d0\u30a4\u30f3\u30c9\u3092\u5fd8\u308c\u3066\u3044\u306a\u3044\u304b\uff1f\n\u53c2\u8003\uff1a\u4ee5\u4e0b\u306fembulk\u306eGuess\u6a5f\u80fd\u3067\u81ea\u52d5\u751f\u6210\u3057\u305fEmbulk\u306econfig.yml\n\u4ee5\u4e0b\u306e\u3088\u3046\u306bcolumns:\u914d\u4e0b\u306b\u3064\u3044\u3066\u30a4\u30a4\u611f\u3058\u306b\u81ea\u52d5\u6027\u751f\u6210\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\nconfig.yml\nin:\n  type: file\n  path_prefix: ./data/org_\n  parser:\n    charset: UTF-8\n    newline: CRLF\n    type: csv\n    delimiter: ','\n    quote: '\"'\n    escape: '\"'\n    trim_if_not_quoted: false\n    skip_header_lines: 1\n    allow_extra_columns: false\n    allow_optional_columns: false\n    columns:\n    - {name: yyyy/mm/dd, type: timestamp, format: '%Y/%m/%d'}\n    - {name: user, type: string}\n    - {name: item, type: string}\n    - {name: cost, type: long}\nout:\n  type: postgresql\n  default_timezone: Japan\n  host: localhost\n  user: postgres\n  password: postgres\n  database: postgres\n  table: sampledata\n  options: {loglevel: 2}\n  mode: insert_direct\n\n\n\n5.\u78ba\u8a8d\n\u30d6\u30e9\u30a6\u30b6\u3088\u308aRe\uff1adash\u306e\u3000New\u3000Querry\u306b\u623b\u308a\u3001\u8ffd\u52a0\u3057\u305f\u30c6\u30fc\u30d6\u30eb\u304c\u5229\u7528\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\nDatastoretest\u3092\u9078\u629e\u3057\u3066\n\u4f8b\u3048\u3070select * from sampledata;\u306e\u3088\u3046\u306aSQL\u3092\u5165\u308c\u3066\nExcute\u30dc\u30bf\u30f3\u3092\u62bc\u4e0b\u3057\u307e\u3059\u3002\n\n\u4ee5\u4e0a\u3067\u3059\u3002\n# Re:dash \u306ePostgreSQL \u3078 CSV\u30d5\u30a1\u30a4\u30eb\u3092 Digdag * Embulk \u7d4c\u7531\u3067\u767b\u9332\u3059\u308b\n## 0.\u306f\u3058\u3081\u306b\n\u3053\u3061\u3089\u306f[re:dash Advent Calendar 2016](http://qiita.com/advent-calendar/2016/redash)\u306e22\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\nAdvent Calendar\u306b\u3064\u3044\u3066\u51fa\u9045\u308c\u305f\u3068\u601d\u3063\u3066\u3044\u305f\u3068\u3053\u308d\u3001\u3001\u3001\n\u3053\u3061\u3089\u306f\u307e\u3060\u7a7a\u304d\u67a0\u304c\u3042\u308a\u307e\u3057\u305f\u306e\u3067\u53c2\u52a0\u3057\u307e\u3057\u305f\u3002\n\nMac\u4e0a\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u3067\nCSV\u30d5\u30a1\u30a4\u30eb\u3092 digdag -> embulk ->\u3000(Re:dash\u306e)PostgreSQL\u3078\u683c\u7d0d\u3057\u3066Re\uff1adash\u304b\u3089\u898b\u308b\u3068\u3053\u308d\u307e\u3067\u3092\u8a18\u4e8b\u306b\u3057\u307e\u3059\u3002\n\u30c7\u30e2\u3084\u7d20\u632f\u308a\u7528\u306a\u3069\u306e\u53c2\u8003\u306b\u3057\u3066\u9802\u3051\u308c\u3070\u3068\u601d\u3044\u307e\u3059\u3002\n\n<img width=\"548\" alt=\"image_01.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/117986/42393438-277c-6f08-a49b-a857d6866dcb.png\">\n\n\u4ee5\u4e0b\u306f\u4eca\u56de\u672c\u8a18\u4e8b\u3067\u306f\u53d6\u308a\u6271\u3044\u307e\u305b\u3093\u304c\u4ee5\u524d\u66f8\u304d\u307e\u3057\u305f[\u3053\u3061\u3089\u306e\u8a18\u4e8b](http://qiita.com/tbuchi888/items/fa02a10728999520e1a0)\u3084\u3001[\u3053\u3061\u3089\u306e\u8a18\u4e8b](http://qiita.com/tbuchi888/items/66763a9af2e15fa74a3c)\u3092\u53c2\u8003\u306b\u5fdc\u7528\u3059\u308b\u3068ChatOps\u7684\u306a\u611f\u3058\u3067\u30c7\u30fc\u30bf\u767b\u9332\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n<img width=\"727\" alt=\"image_02.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/117986/7b8843e0-dbed-42b8-825c-c147566800eb.png\">\n\n## 1.\u74b0\u5883\n- OSX Yosemite\n- Docker version 1.13.0-rc3, build 4d92237\n- docker-compose version 1.9.0, build 2585387\n\n\u4ee5\u964d\u306f\u4eca\u56de\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3082\u306e\uff082016/12/21\u6642\u70b9\uff09\n\n- java version \"1.8.0_111\"\n- Digdag 0.9.1\n- embulk 0.8.15\n  - embulk-output-postgresql (0.7.2, 0.6.3)\n- Re:dash 0.11.1+b2095\n  - nginx/1.9.10\n  - Redis server v=2.8.23\n  - postgres (PostgreSQL) 9.3.14\n                   \n## 2.\u5404\u7a2e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n### 2.1.Java8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nDigdag\u3068Embulk\u306fJava \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5fc5\u8981\u3067\u3059\u3002\nmac\u306e\u5834\u5408\u306f[\u3053\u3061\u3089](https://www.java.com/en/download/mac_download.jsp)\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n### 2.2.Didag\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nhttp://docs.digdag.io/getting_started.html#downloading-the-latest-version\n\u3088\u308a\u5f15\u7528\n\n> # 1. Downloading the latest version\n> Digdag is a single executable file. You can install the file to ~/bin using curl command as following:\n> $ curl -o ~/bin/digdag --create-dirs -L \"https://dl.digdag.io/digdag-latest\"\n> $ chmod +x ~/bin/digdag\n> $ echo 'export PATH=\"$HOME/bin:$PATH\"' >> ~/.bashrc\n> Please reopen your terminal window or type following command so that the change of PATH takes effect.\n> $ source ~/.bashrc\n\n\u306a\u304a\u3001mac\u306a\u306e\u3067`.bashrc`\u304b\u3089`.bash_profile`\u3078\u5909\u66f4\n\n``` digdag\ncurl -o ~/bin/digdag --create-dirs -L \"https://dl.digdag.io/digdag-latest\"\nchmod +x ~/bin/digdag\necho 'export PATH=\"$HOME/bin:$PATH\"' >> ~/.bash_profile\nsource ~/.bash_profile\n```\n\n### 2.3.Embulk\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nhttps://github.com/embulk/embulk#linux--mac--bsd\n\u3088\u308a\u5f15\u7528\n\n> curl --create-dirs -o ~/.embulk/bin/embulk -L \"http://dl.embulk.org/embulk-latest.jar\"\n> chmod +x ~/.embulk/bin/embulk\n> echo 'export PATH=\"$HOME/.embulk/bin:$PATH\"' >> ~/.bashrc\n> source ~/.bashrc\n\nDigdag\u3067\u65e2\u306b`~/bin/`\u3078\u30d1\u30b9\u3092\u901a\u3057\u3066\u3044\u308b\u306e\u3067\nDigdag\u306b\u5408\u308f\u305b\u3066\u683c\u7d0d\u5148\u3092~/bin/\u914d\u4e0b\u306b\u30b3\u30d4\u30fc\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\n\n```\u3000embulk\ncurl --create-dirs -o ~/bin/embulk -L \"http://dl.embulk.org/embulk-latest.jar\"\nchmod +x ~/bin/embulk\n# digdag \u3067\u30d1\u30b9\u3092\u901a\u3057\u3066\u3044\u308b\u306e\u3067\u4ee5\u4e0b\uff12\u884c\u306f\u4e0d\u8981\n#echo 'export PATH=\"$HOME/bin:$PATH\"' >> ~/.bash_profile\n#source ~/.bash_profile\n\n\b# \u4eca\u56de\u5229\u7528\u3059\u308bPlugin\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nembulk gem install embulk-output-postgresql\n```\n\n### 2.4.Re:dash\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nhttp://docs.redash.io/en/latest/setup.html#docker-compose\n\u3088\u308a\u5f15\u7528\n\n> **Docker Compose**\n> 1.Make sure you have a Docker machine up and running.\n> 2.Make sure your current working directory is the root of this GitHub repository.\n> 3.Run docker-compose up postgres.\n> 4.Run ./setup/docker/create_database.sh. This will access the postgres container and set up the database.\n> 5.Run docker-compose up\n> 6.Run docker-machine ls, take note of the ip for the Docker machine you are using, and open the web browser.\n> 7.Visit that Docker machine IP at port 80, and you should see a Re:dash login screen.\n>\n> Now proceed to \u201cSetup\u201d.\n\nDocker for mac \u3092\u5229\u7528\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u304c\u3001\u516c\u5f0f\u306e\u307e\u307e\u3060\u3068mac\u7279\u6709\u554f\u984c\u306b\u3042\u305f\u308a\u307e\u3059\u306e\u3067\u4ee5\u4e0b\u624b\u9806\u3067\u884c\u3044\u307e\u3059\u3002\n\u8a73\u7d30\u306f\u4ee5\u524d\u66f8\u3044\u305f[\u300cRe:dash\u300d\u3092\u300cDocker for Mac\u300d\u4e0a\u3067\u52d5\u304b\u3057\u3066\u307f\u305f](http://qiita.com/tbuchi888/items/275bb2ed341c2936c9c3)\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n``` redash\n# 1.git clone \u3068\u3000\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u79fb\u52d5\ngit clone https://github.com/getredash/redash.git\ncd redash/\n\n# 2.docker-compose-example.yml\u3088\u308a\u3001docker-compose.yml\u3092\u4f5c\u6210\n#   Docker\u30db\u30b9\u30c8\u4e0a\u306ePostgreSQL\u306e\u30c7\u30fc\u30bf\u7f6e\u304d\u5834\u3092/opt/postgres-data\u304b\u3089\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b./postgres-data\u3078\u5909\u66f4\uff08\u74b0\u5883\u306b\u3088\u308a\u9069\u5b9c\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\uff09\n#   sed\u3092\u4f7f\u308f\u305a\u306b `mv docker-compose-example.yml docker-compose.yml`\u3057\u3066 `vi docker-compose.yml`\u3067\u3082OK\n# \u3000\u306a\u304a\u3001mac\u3067\u306f\u306a\u304f\u3001Linux\u3067\u3042\u308c\u3070`mv docker-compose-example.yml docker-compose.yml`\u3060\u3051\u3067\u554f\u984c\u3068\u601d\u3044\u307e\u3059\u3002\ncat docker-compose-example.yml | sed -e \"s/\\/opt\\/postgres-data/\\.\\/postgres-data/\" > docker-compose.yml\n```\n\n\u307e\u305f\u4eca\u56de\u306f\n**embulk\u304b\u3089`PostgreSQL`\u30b3\u30f3\u30c6\u30ca\u306e5432port\u3078\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u306a\u3088\u3046\u306b\n`docker-compose.yml`\u306epostgres\u90e8\u5206\u3078`ports:\u3000\u3000\u3000- \"5432:5432\"`\u306e\u8a2d\u5b9a\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002**\n\u3053\u308c\u3092\u3084\u3063\u3066\u304a\u304b\u306a\u3044\u3068\u5f8c\u534a\u306edigdag/embulk\u90e8\u5206\u3067\u30a8\u30e9\u30fc\u3068\u306a\u308a\u307e\u3059\u3002\n\n```\u3000docker-compose.yml \nredash:\n  image: redash/redash:latest\n  ports:\n    - \"5000:5000\"\n  links:\n    - redis\n    - postgres\n  environment:\n    REDASH_LOG_LEVEL: \"INFO\"\n    REDASH_REDIS_URL: \"redis://redis:6379/0\"\n    REDASH_DATABASE_URL: \"postgresql://postgres@postgres/postgres\"\n    REDASH_COOKIE_SECRET: veryverysecret\nredis:\n  image: redis:2.8\npostgres:\n  image: postgres:9.3\n  ports:\n    - \"5432:5432\"\n  volumes:\n    - ./postgres-data:/var/lib/postgresql/data\nredash-nginx:\n  image: redash/nginx:latest\n  ports:\n    - \"80:80\"\n  links:\n    - redash\n```\n\n```\n# 3.`-d` \u30aa\u30d7\u30b7\u30e7\u30f3(\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u8d77\u52d5)\u3092\u3064\u3051\u3066PostgreSQL\u3060\u3051\u8d77\u52d5\ndocker-compose up -d postgres\n\n# 4.create_database.sh\u306e\u5b9f\u884c\n./setup/docker/create_database.sh\n\n# 5. \u6b8b\u308a\u3082`-d` \u30aa\u30d7\u30b7\u30e7\u30f3(\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u8d77\u52d5)\u3092\u3064\u3051\u3066\u8d77\u52d5\ndocker-compose up -d\n```\n\n## 3.\u5404\u7a2e\u8a2d\u5b9a\n### 3.1.Digdag\n\n\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u6e96\u5099\u3057\u307e\u3059\u3002\n\n``` csv2postgres.dig \ntimezone: Asia/Tokyo\n\n_export:\n  workflow_name: \"csv2postgres\"\n  start_msg:     \"digdag ${workflow_name} start\"\n  end_msg:       \"digdag ${workflow_name} finish\"\n  error_msg:     \"digdag ${workflow_name} error\"\n\n+strat:\n  echo>: ${start_msg}\n\n# make config file for embulk\n+guess_embulk:\n  sh>: embulk guess ./guess.yml -o ./config.yml\n\n+csv_to_db:\n  embulk>: ./config.yml\n\n## This is for _error confirmation. \n##+fail:\n##  fail>: \"fail!\"\n\n+end:\n  echo>: ${end_msg}\n\n_error:\n  echo>: ${error_msg}\n```\n\n### 3.2.Embulk\n\u5143\u30c7\u30fc\u30bf\u306eCSV\u30d5\u30a1\u30a4\u30eb\uff08\u4eca\u56de\u306f./data/org_sample.csv\uff09\u3068guess.yml\u3092\u6e96\u5099\u3057\u307e\u3059\u3002\nEmbulk\u306eGuess\u3092\u4f7f\u3063\u3066\u3001csv\u30d5\u30a1\u30a4\u30eb\u304b\u3089Postgresql\u3078\u5165\u308c\u308b\u969b\u306eConfig\u30d5\u30a1\u30a4\u30eb\u3092\u81ea\u52d5\u751f\u6210\u3057\u307e\u3059\u3002\n\n```\u3000./data/org_sample.csv\nyyyy/mm/dd,user,item,cost\n2016/12/21,user01,AAA,2000\n2016/12/22,user02,BBB,100\n2016/12/23,user03,AAA,2000\n2016/12/24,user01,BBB,100\n```\n\nGuess\u6a5f\u80fd\u3067\u81ea\u52d5\u751f\u6210\u3055\u305b\u308b\u305f\u3081\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306bIn\u306eparser\u306e`columns\uff1a`\u914d\u4e0b\u3092\u7a7a\u884c\u306b\u3057\u307e\u3059\u3002\n\nin\u306ecsv-parser-plugin\u90e8\u5206\u306e\u8a73\u7d30\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f\u3053\u3061\u3089\u3092\nhttp://www.embulk.org/docs/built-in.html#csv-parser-plugin\n\n\u306a\u304a\u3001`path_prefix:`\u306b\u3064\u3044\u3066\u306f\u3001\u5bfe\u8c61\u30d5\u30a1\u30a4\u30eb\u7fa4\u306e\u5148\u982d\u306e\u4e00\u90e8\u6587\u5b57\u5217\u306e\u6307\u5b9a\u304c\u5fc5\u8981\u3067\u3059\u3002\n\nout\u306eembulk-output-postgresql\u90e8\u5206\u306e\u8a73\u7d30\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f\u3053\u3061\u3089\u3092\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002\nhttp://www.rubydoc.info/gems/embulk-output-postgresql/0.7.2\n\n`table:` \u304c\u4eca\u56de\u4f5c\u6210\u3055\u308c\u308b\u30c6\u30fc\u30d6\u30eb\u540d\u3068\u306a\u308a\u307e\u3059\u3002\nPostgreSQL\u306eDB\u540d\u7b49\u306fdocker-compose\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u969b\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u304b\u3089\u5909\u66f4\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u81ea\u74b0\u5883\u306b\u5408\u308f\u305b\u305f\u8a2d\u5b9a\u3092\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n\n``` guess.yml\nin:\n  type: file\n  path_prefix: ./data/org_\n  parser:\n    charset: UTF-8\n    newline: CRLF\n    type: csv\n    delimiter: ','\n    quote: '\"'\n    escape: '\"'\n    trim_if_not_quoted: false\n    skip_header_lines: 1\n    allow_extra_columns: false\n    allow_optional_columns: false\n    columns:\nout:\n  type: postgresql\n  default_timezone: Japan\n  host: localhost\n  user: postgres\n  password: postgres\n  database: postgres\n  table: sampledata\n  options: {loglevel: 2}\n  mode: insert_direct\n```\n\n### 3.3.Re:dash\u306eDataSource\u8a2d\u5b9a\nRe:dash\u3068\u4e00\u7dd2\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fPostgreSQL\u3092\u305d\u306e\u307e\u307e\u5229\u7528\u3059\u308b\u305f\u3081\u306bDATASOURCES\u3092\u4ee5\u4e0b\u306b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001PostgreSQL\u306eDB\u540d\u7b49\u306fdocker-compose\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u969b\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30d6\u30e9\u30a6\u30b6\u3067 http://127.0.0.1/ \u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3078\u30a2\u30af\u30bb\u30b9\u3057\nadmin/admin\uff08\u521d\u671f\u5024\uff09\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n<img width=\"853\" alt=\"redash01.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/117986/2245fbd2-2fb1-bb83-60a2-0ecbd5b19878.png\">\n\n\u30ed\u30b0\u30a4\u30f3\u5f8c\u306b\u53f3\u4e0a\u306eDB\u30a2\u30a4\u30b3\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\n<img width=\"888\" alt=\"redash02.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/117986/83b6e6e9-c416-caeb-6392-3b203225887f.png\">\n\n`\uff0bNew Data Source`\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n<img width=\"888\" alt=\"redash03.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/117986/a6ed712f-45ce-139d-999f-68434bb8d15e.png\">\n\nName\u306b\u9069\u5f53\u306a\u540d\u524d\uff08\u4eca\u56de\u306ftest\uff09\u3092\u5165\u308c\u3066\u3001`Type`\u3068\u3057\u3066`PostgreSQL`\u3092\u9078\u629e\u3057\u307e\u3059\u3002\ndocker-compose\u3067redash\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u308b\u524d\u63d0\u3067\n`Database Name`,`host`,`password`,`user`\u306b\u5168\u3066`postgres`\u3092\u8a2d\u5b9a\u3057\u3066`Save`\u3057\u307e\u3059\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u304b\u3089\u5909\u66f4\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u81ea\u74b0\u5883\u306b\u5408\u308f\u305b\u305f\u8a2d\u5b9a\u3092\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n\n<img width=\"888\" alt=\"redash04.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/117986/fd83fff3-abe1-ee99-1088-30153598c03c.png\">\n\n\u4e0a\u6bb5\u306e`Queries`\u304b\u3089`New\u3000Query`\u3092\u9078\u629e\n<img width=\"888\" alt=\"redash05.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/117986/abbe8d5a-0068-eaad-2591-3412e4d502f9.png\">\n\n`Data Source`\u306e\u30d7\u30eb\u30c0\u30a6\u30f3\u304b\u3089\u5148\u307b\u3069\u767b\u9332\u3057\u305f`test`\u304c\u9078\u629e\u3067\u304d\u308c\u3070OK\u3067\u3059\u3002\n<img width=\"888\" alt=\"redash06.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/117986/daab8279-d9d1-7cf1-1da0-43681158b2a1.png\">\n<img width=\"888\" alt=\"redash07.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/117986/aae75076-e669-a16a-592a-73f98784a283.png\">\n\n## 4.\u5b9f\u884c\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\u3057\n\n```\n\u251c\u2500\u2500 csv2postgres.dig\n\u251c\u2500\u2500 data\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 org_sample.csv\n\u2514\u2500\u2500 guess.yml\n```\n\nterminal\u304b\u3089Digdag\u3092\u5b9f\u884c\u3057\u3066CSV\u30c7\u30fc\u30bf\u3092PostgreSQL\u4e0a\u30c6\u30fc\u30d6\u30eb\u3078\u683c\u7d0d\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001\u4e0b\u306e\u4f8b\u3067\u306f\u3001\u7e70\u308a\u8fd4\u3057\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306b`-a`\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u3066\u3044\u307e\u3059\u3002\n\n```\ndigdag run csv2postgres.dig -a\n```\n\n\u5b9f\u884c\u7d50\u679c\u3068\u3057\u3066\u6700\u5f8c\u306b\n`Success. Task state is saved at /Users/*********`\n\u3068\u51fa\u308c\u3070\u6210\u529f\u3067\u3059\u3002\n\n\u306a\u304a\u3001PostgreSQL\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3067\u30a8\u30e9\u30fc\u3068\u306a\u308b\u5834\u5408\u4ee5\u4e0b\u3092\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002\n-\u3000postgresql\u306eid,passwaord\u306a\u3069\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u304b\u3089\u5909\u66f4\u3057\u3066\u3044\u306a\u3044\u304b\uff1f\n- \u4e0a\u8ff0\u306e`2.4.Re:dash\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb`\u3067`docker\u2212compose.yml`\u306b\u3064\u3044\u3066postgresql\u30b3\u30f3\u30c6\u30ca\u3078\u306e`\uff15\uff14\uff13\uff12port`\u306e\u30d0\u30a4\u30f3\u30c9\u3092\u5fd8\u308c\u3066\u3044\u306a\u3044\u304b\uff1f\n\n\u53c2\u8003\uff1a\u4ee5\u4e0b\u306fembulk\u306eGuess\u6a5f\u80fd\u3067\u81ea\u52d5\u751f\u6210\u3057\u305fEmbulk\u306e`config.yml`\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b`columns:`\u914d\u4e0b\u306b\u3064\u3044\u3066\u30a4\u30a4\u611f\u3058\u306b\u81ea\u52d5\u6027\u751f\u6210\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\n``` config.yml\nin:\n  type: file\n  path_prefix: ./data/org_\n  parser:\n    charset: UTF-8\n    newline: CRLF\n    type: csv\n    delimiter: ','\n    quote: '\"'\n    escape: '\"'\n    trim_if_not_quoted: false\n    skip_header_lines: 1\n    allow_extra_columns: false\n    allow_optional_columns: false\n    columns:\n    - {name: yyyy/mm/dd, type: timestamp, format: '%Y/%m/%d'}\n    - {name: user, type: string}\n    - {name: item, type: string}\n    - {name: cost, type: long}\nout:\n  type: postgresql\n  default_timezone: Japan\n  host: localhost\n  user: postgres\n  password: postgres\n  database: postgres\n  table: sampledata\n  options: {loglevel: 2}\n  mode: insert_direct\n```\n\n## 5.\u78ba\u8a8d\n\u30d6\u30e9\u30a6\u30b6\u3088\u308aRe\uff1adash\u306e\u3000New\u3000Querry\u306b\u623b\u308a\u3001\u8ffd\u52a0\u3057\u305f\u30c6\u30fc\u30d6\u30eb\u304c\u5229\u7528\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\nDatastore`test`\u3092\u9078\u629e\u3057\u3066\n\u4f8b\u3048\u3070`select * from sampledata;`\u306e\u3088\u3046\u306aSQL\u3092\u5165\u308c\u3066\n`Excute`\u30dc\u30bf\u30f3\u3092\u62bc\u4e0b\u3057\u307e\u3059\u3002\n\n<img width=\"1161\" alt=\"redash_query01.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/117986/e5d35e02-0dba-ac01-f230-4ce601740da5.png\">\n\n\u4ee5\u4e0a\u3067\u3059\u3002\n\n", "tags": ["redash", "Embulk", "digdag", "PostgreSQL", "AdventCalendar"]}