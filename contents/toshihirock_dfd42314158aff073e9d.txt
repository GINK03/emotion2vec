{"context": " More than 1 year has passed since last update.Amazon EC2 Container Service\u3092GUI\u304b\u3089\u8a66\u3057\u3066AWS\u5074\u3067\u7528\u610f\u3057\u305f\u30b5\u30f3\u30d7\u30ebWeb\u30a2\u30d7\u30ea\u3092\u52d5\u304b\u3057\u305f\u3068\u304d\u306e\u30e1\u30e2\u3002\n\u30b5\u30f3\u30d7\u30eb\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u30672\u3064\u306e\u30b3\u30f3\u30c6\u30ca(Docker)\u3067\u69cb\u6210\u3055\u308c\u305f\u9759\u7684\u306aWeb\u30a2\u30d7\u30ea\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u3057\u305f\u3002\n\n\u53c2\u8003\n\nAmazon EC2 Container Service-Getting Started\nEC2 Container Service\u3092\u4f7f\u3063\u3066\u307f\u308b\n\n\nGet Startted\n\n\u6700\u521d\u306e\u753b\u9762\u3067\u306f Get Started \u3092\u9078\u629e\u3057\u307e\u3059\n\nStep1 Welcome to Amazon ECS\n\n\u4eca\u56de\u306f\u72ec\u81ea\u306e\u8a2d\u5b9a\u3092\u3059\u308b\u308f\u3051\u3067\u306a\u304f\u3001AWS\u306e\u7528\u610f\u3057\u305f\u30b5\u30f3\u30d7\u30eb\u3092\u4f7f\u3046\u306e\u3067Amazon ECS sample\u3092\u9078\u629e\u3057\u307e\u3059\n\nStep2 Create Task Definition from sample\n\n\u6b21\u306e\u753b\u9762\u3067\u306f\u5229\u7528\u3059\u308b\u30b3\u30f3\u30c6\u30ca(docker)\u3068\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u30b5\u30f3\u30d7\u30eb\u3067\u306fsample-app\u3068\u3044\u3046httpd\u306e\u30b3\u30f3\u30c6\u30ca\u3068Web\u30a2\u30d7\u30ea\u306ehtml\u3092\u4fdd\u5b58\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u306ebusybox\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\u4ed5\u7d44\u307f\u306a\u3069\u306b\u3064\u3044\u3066\u306f\u4e0b\u8a18\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3057\u305f\u3002\nData Volume \u3068 Data Volume Container\nDocker \u3067\u30c7\u30fc\u30bf\u306e\u30dd\u30fc\u30bf\u30d3\u30ea\u30c6\u30a3\u3092\u3042\u3052\u6c38\u7d9a\u5316\u3057\u3088\u3046\n\u672c\u30b5\u30f3\u30d7\u30eb\u3067\u3067\u306f\u3069\u306e\u3088\u3046\u306ahtml\u3092\u914d\u7f6e\u3057\u3066\u3044\u308b\u304b\u306b\u3064\u3044\u3066\u306f\u4e0a\u8a18\u753b\u9762\u306eJSON\u30bf\u30d6\u3092\u8868\u793a\u3059\u308b\u3053\u3068\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\u3061\u306a\u307f\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n{\n  \"family\": \"console-sample-app-static\",\n  \"containerDefinitions\": [\n    {\n      \"name\": \"simple-app\",\n      \"image\": \"httpd:2.4\",\n      \"cpu\": \"10\",\n      \"memory\": \"300\",\n      \"environment\": [],\n      \"portMappings\": [\n        {\n          \"hostPort\": \"80\",\n          \"containerPort\": \"80\"\n        }\n      ],\n      \"volumesFrom\": [],\n      \"links\": [],\n      \"mountPoints\": [\n        {\n          \"sourceVolume\": \"my-vol\",\n          \"containerPath\": \"/usr/local/apache2/htdocs\"\n        }\n      ],\n      \"essential\": true\n    },\n    {\n      \"name\": \"busybox\",\n      \"image\": \"busybox\",\n      \"cpu\": \"10\",\n      \"memory\": \"200\",\n      \"entryPoint\": [\n        \"sh\",\n        \"-c\"\n      ],\n      \"environment\": [],\n      \"command\": [\n        \"/bin/sh -c \\\"while true; do echo '<html> <head> <title>Amazon ECS Sample App</title> <style>body {margin-top: 40px; background-color: #333;} </style> </head><body> <div style=color:white;text-align:center> <h1>Amazon ECS Sample App</h1> <h2>Congratulations!</h2> <p>Your application is now running on a container in Amazon ECS.</p>' > top; /bin/date > date ; echo '</div></body></html>' > bottom; cat top date bottom > /usr/local/apache2/htdocs/index.html ; sleep 1; done\\\"\"\n      ],\n      \"portMappings\": [],\n      \"volumesFrom\": [\n        {\n          \"sourceContainer\": \"simple-app\"\n        }\n      ],\n      \"links\": [],\n      \"mountPoints\": [],\n      \"essential\": false\n    }\n  ],\n  \"volumes\": [\n    {\n      \"name\": \"my-vol\",\n      \"host\": {}\n    }\n  ]\n}\n\n\nStep3 Schedule Tasks\n\n\u672c\u753b\u9762\u3067\u306f\u30bf\u30b9\u30af\u3092\u4ee5\u4e0b\u306e\u3044\u305a\u308c\u304b\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\nRun Tasks Once\nCreate a service\n\n\u30d0\u30c3\u30c1\u51e6\u7406\u306e\u3088\u3046\u306a1\u56de\u306e\u307f\u51e6\u7406\u3092\u884c\u3046\u5834\u5408\u306b\u306fRun Tasks Once\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u304c\u3001\u4eca\u56de\u306ehttpd\u306e\u3088\u3046\u306a\u6c38\u7d9a\u7684\u306b\u5b9f\u884c\u3055\u308c\u308b\u3082\u306e\u306e\u5834\u5408\u3001Create a service\u306e\u65b9\u3092\u9078\u3073\u307e\u3059\u3002\nDesired number of Tasks\u3068Service Name\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u307e\u307e\u3068\u3057\u307e\u3059\u3002\nElasticLoadBalance\u306b\u3064\u3044\u3066\u306fsimple-app:80\u3092\u9078\u629e\u3057\u3001\u305d\u308c\u4ee5\u5916\u306e\u8a2d\u5b9a\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3068\u3057\u307e\u3059\u3002\n\u3061\u306a\u307f\u306b\u6700\u521d\u306b\u4e0a\u8a18\u5024\u3067NoELB\u3092\u9078\u629e\u3057\u3001\u305d\u306e\u307e\u307e\u9032\u3081\u3066\u307f\u305f\u306e\u3067\u3059\u304c\u3001\u30af\u30e9\u30b9\u30bf\u306e\u4f5c\u6210\u6642\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u8868\u793a\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\u3002\u3002\n\nCreated Service sample-webapp failed\nA role was passed, but no load balancers were present.\n\n\u307e\u305f\u3001\u5b9f\u969b\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bSSH\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u78ba\u8a8d\u3057\u307e\u3057\u305f\u304c\u3001httpd\u3068busybox\u306edocker\u304c\u8d77\u52d5\u3057\u3066\u3044\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n$ docker ps -a\nCONTAINER ID        IMAGE                            COMMAND             CREATED             STATUS              PORTS                        NAMES\ne57e72e78e8f        amazon/amazon-ecs-agent:latest   \"/agent\"            11 minutes ago      Up 11 minutes       127.0.0.1:51678->51678/tcp   ecs-agent\n\n\nStep4 Configure Cluster\n\u30b3\u30f3\u30c6\u30ca(docker)\u3092\u5b9f\u884c\u3059\u308bEC2\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\u306f\u3058\u3081\u306b\u8d77\u52d5\u3059\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u6570\u3084\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30bf\u30a4\u30d7\u3001KeyPair\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n\u7279\u306b\u554f\u984c\u306a\u3051\u308c\u3070KeyPair\u306e\u307f\u5229\u7528\u3059\u308b\u3082\u306e\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n\u6b21\u306b\u30a2\u30af\u30bb\u30b9\u5143\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u6307\u5b9a\u3057\u305fIP\u30a2\u30c9\u30ec\u30b9\u304b\u3089\u306e\u307f\u8d77\u52d5\u3059\u308bhttpd\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u3059\u3002\u7279\u306b\u5236\u9650\u3092\u3057\u306a\u3044\u5834\u5408\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e0.0.0.0/0\u306e\u307e\u307e\u3068\u3057\u307e\u3059\u3002\n\u5bfe\u8c61\u306eEC2\u304b\u3089ECS\u306e\u64cd\u4f5c\u3092\u3059\u308b\u305f\u3081\u306bIAM\u30ed\u30fc\u30eb\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u521d\u3081\u3066ECS\u3092\u64cd\u4f5c\u3059\u308b\u5834\u5408\u3001Create IAM Roles\u30dc\u30bf\u30f3\u3092\u62bc\u4e0b\u3059\u308b\u3053\u3068\u3067ECS\u3092\u64cd\u4f5c\u3059\u308b\u305f\u3081\u306eIAM\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3067\u304d\u307e\u3059\u3002\n\nLaunch\n\u5168\u4f53\u306e\u69cb\u6210\u3092\u78ba\u8a8d\u3057\u3001\u554f\u984c\u306a\u3051\u308c\u3070Launch\u3057\u307e\u3059\u3002EC2\u306e\u8d77\u52d5\u3084\u8a2d\u5b9a\u306a\u3069\u3092CloudFormation\u3092\u4f7f\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3001\u8a73\u7d30\u3092\u78ba\u8a8d\u3057\u305f\u3044\u5834\u5408\u3001\u30ea\u30f3\u30af\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066CloudFormation\u306e\u753b\u9762\u3067\u5b9f\u65bd\u5185\u5bb9\u306a\u3069\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\u4ee5\u4e0b\u306fECS\u4e0a\u3067\u306e\u9032\u6357\u72b6\u6cc1\u306e\u78ba\u8a8d\u753b\u9762\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u8d77\u52d5\u304c\u5b8c\u4e86\u3059\u308b\u3068\u8d77\u52d5\u3057\u305fEC2\u3084ELB\u306e\u60c5\u5831\u306a\u3069\u69d8\u3005\u306a\u60c5\u5831\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\u8d77\u52d5\u76f4\u5f8c\u306fsample-webapp\u306eStatsu\u304cPENDING\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u5c11\u3057\u6642\u9593\u304c\u7d4c\u3064\u3068RUNNING\u306b\u5909\u308f\u308a\u307e\u3059\u3002\n\n\u307e\u305f\u3001\u4e0a\u8a18\u3088\u308aELB\u306e\u753b\u9762\u3092\u78ba\u8a8d\u3057\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304cELB\u306b\u30a2\u30bf\u30c3\u30c1\u3055\u308c\u3066\u3044\u308b\u306e\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u30a2\u30bf\u30c3\u30c1\u6e08\u307f\u3067\u3042\u308c\u3070ELB\u3067\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308bURL\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u307e\u3059\u3002\n\u554f\u984c\u306a\u3051\u308c\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n\n\u5bfe\u8c61\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bSSH\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u307f\u308b\n\u4e0a\u8a18\u306eGUI\u306b\u3088\u308b\u8a2d\u5b9a\u3092\u3057\u305f\u5834\u5408\u3001\u30b3\u30f3\u30c6\u30ca(docker)\u3092\u52d5\u304b\u3059EC2\u306bKeyPari\u306e\u8a2d\u5b9a\u306f\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001SecurityGroup\u306e\u8a2d\u5b9a\u306722\u306e\u8a31\u53ef\u304c\u3055\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u5bfe\u8c61\u306eEC2\u306b\u306f\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u307e\u305b\u3093\u3002ECS\u3092\u4f7f\u3048\u3070SSH\u3057\u306a\u304f\u3066\u3082\u5927\u4e08\u592b\u3068\u3044\u3046\u3053\u3068\u3060\u3068\u601d\u3046\u306e\u3067\u3059\u304c\u3001\u4f55\u304b\u3042\u3063\u3066\u8abf\u67fb\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u306bSSH\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3059\u3002\uff08\u904b\u7528\u3059\u308b\u5834\u5408\u306fSSH\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u306a\u3044\u72b6\u614b\u306e\u307e\u307e\u3068\u3059\u308b\u306e\u304c\u6b63\u3057\u3044\u3068\u601d\u3044\u307e\u3059\uff09\nECS\u306e\u753b\u9762\u304b\u3089docker\u3092\u52d5\u304b\u3059\u305f\u3081\u306b\u8d77\u52d5\u3055\u308c\u305fEC2\u304c\u78ba\u8a8d\u3067\u304d\u308b\u306e\u3067\u305d\u306eEC2\u306b\u8a2d\u5b9a\u3055\u308c\u305fSecurityGroup\u306e22\u30dd\u30fc\u30c8\u3092\u958b\u653e\u3059\u308c\u3070OK\u3067\u3059\u3002\n$ssh ec2-user@52.69.31.141 -i hogefugaKey.pem\n\n   __|  __|  __|\n   _|  (   \\__ \\   Amazon ECS-Optimized Amazon Linux AMI 2015.03.d\n ____|\\___|____/\n\nFor documentation visit, http://aws.amazon.com/documentation/ecs\n2 package(s) needed for security, out of 2 available\nRun \"sudo yum update\" to apply all updates.\n\ndocker ps\u30b3\u30de\u30f3\u30c9\u3092\u30bf\u30a4\u30d7\u3059\u308b\u3053\u3068\u3067GUI\u3067\u6307\u5b9a\u3057\u305f2\u3064\u306edocker\u3068ECS\u3068\u901a\u4fe1\u3092\u884c\u3046ecs-agent\u3068\u3044\u3046docker\u304c\u52d5\u4f5c\u3057\u3066\u3044\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n$docker ps\nCONTAINER ID        IMAGE                            COMMAND                CREATED             STATUS              PORTS                        NAMES\n1e292fd54f47        busybox:latest                   \"\\\"sh -c '/bin/sh -c   8 hours ago         Up 8 hours                                       ecs-console-sample-app-static-5-busybox-86f3a5c7add9d5fd4d00\n9c7dd2d8490b        httpd:2.4                        \"httpd-foreground\"     8 hours ago         Up 8 hours          0.0.0.0:80->80/tcp           ecs-console-sample-app-static-5-simple-app-9aefdfbc92fcbce23600\nb6cd81e19b7d        amazon/amazon-ecs-agent:latest   \"/agent\"               8 hours ago         Up 8 hours          127.0.0.1:51678->51678/tcp   ecs-agent\n\n\n\u304a\u6383\u9664\n\u4e00\u901a\u308a\u78ba\u8a8d\u304c\u7d42\u308f\u3063\u305f\u306e\u3067\u524a\u9664\u3057\u307e\u3059\u3002\nECS\u306e\u753b\u9762\u304b\u3089\u30af\u30e9\u30b9\u30bf\u3092\u524a\u9664\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u8868\u793a\u3055\u308c\u3001\u524a\u9664\u304c\u3067\u304d\u307e\u305b\u3093\u3002\u3002\u3002\u3002\n\nUnable to delete cluster\nThe Cluster cannot be deleted while Container Instances are active.\n\n\u524a\u9664\u3059\u308b\u3068\u304d\u306e\u6ce8\u610f\u753b\u9762\u3067\u300cCloudFormation\u4f7f\u3063\u3066Stack\u306e\u66f4\u65b0\u304b\u524a\u9664\u3092\u3057\u3066\u306d\u300d\u3068\u3042\u3063\u305f\u306e\u3067\u3001CloudFormation\u306e\u753b\u9762\u304b\u3089ECS\u4f5c\u6210\u6642\u306eStack\u3092\u9078\u629e\u3057\u3001delete stack\u3057\u307e\u3059\u3002stack\u540d\u306f EC2ContainerService-default-xxxxx\u3068\u3044\u3046\u5f62\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u306e\u3067\u305d\u306estack\u3092delete stack\u3057\u3066\u524a\u9664\u3057\u307e\u3059\u3002\nCloudFromation\u3067\u524a\u9664\u3057\u305f\u306e\u306f\u3042\u304f\u307e\u3067Stack\u3068\u95a2\u9023\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u306e\u307f(ELB,EC2,SecurityGroup etc...)\u3067ECS\u306e\u30af\u30e9\u30b9\u30bf\u3001\u30b5\u30fc\u30d3\u30b9\u306f\u6b8b\u3063\u3066\u3044\u308b\u306e\u3067ECS\u306e\u753b\u9762\u304b\u3089\u524a\u9664\u3057\u307e\u3059\u3002\n\u307e\u305a\u306f sample-webapp \u30b5\u30fc\u30d3\u30b9\u3092\u524a\u9664\u3057\u307e\u3059\u3002\n\u304cGUI\u304b\u3089\u524a\u9664\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u3002\u3002\n\nThe service cannot be stopped while the primary deployment is scaled above 0.\n\n\u691c\u7d22\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u8a18\u4e8b\u3092\u767a\u898b\u3002\nDelete a cluster : impossible ! (Via UI or CLI)\n\u4e0a\u8a18\u8a18\u4e8b\u306b\u5f93\u3063\u3066\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u65bd\u3057\u307e\u3059\u3002\n$aws ecs update-service --service sample-webapp --desired-count 0\n\n\u4e0a\u8a18\u5b9f\u65bd\u5f8c\u3001GUI\u304b\u3089\u30b5\u30fc\u30d3\u30b9\u3092\u524a\u9664\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3057\u305f\u3002\u3002\u3002\n\u307e\u305f\u3001\u30b5\u30fc\u30d3\u30b9\u524a\u9664\u5f8c\u3067\u3042\u308c\u3070GUI\u304b\u3089\u30af\u30e9\u30b9\u30bf\u306e\u524a\u9664\u3082\u53ef\u80fd\u3068\u306a\u308a\u307e\u3059\u3002\n[Amazon EC2 Container Service](https://aws.amazon.com/jp/ecs/)\u3092GUI\u304b\u3089\u8a66\u3057\u3066AWS\u5074\u3067\u7528\u610f\u3057\u305f\u30b5\u30f3\u30d7\u30ebWeb\u30a2\u30d7\u30ea\u3092\u52d5\u304b\u3057\u305f\u3068\u304d\u306e\u30e1\u30e2\u3002\n\n\u30b5\u30f3\u30d7\u30eb\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u30672\u3064\u306e\u30b3\u30f3\u30c6\u30ca(Docker)\u3067\u69cb\u6210\u3055\u308c\u305f\u9759\u7684\u306aWeb\u30a2\u30d7\u30ea\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u3057\u305f\u3002\n\n# \u53c2\u8003\n\n+ [Amazon EC2 Container Service-Getting Started](http://docs.aws.amazon.com/AmazonECS/latest/developerguide/ECS_GetStarted.html)\n+ [EC2 Container Service\u3092\u4f7f\u3063\u3066\u307f\u308b](http://qiita.com/con_mame/items/1df441d86c703a0e6fa6)\n\n\n# Get Startted\n\n![Screen Shot 2015-06-22 at 10.54.32 PM.png](https://qiita-image-store.s3.amazonaws.com/0/20193/9bf1abe2-9653-9acf-fe73-f65a0498a41c.png)\n\n\u6700\u521d\u306e\u753b\u9762\u3067\u306f **Get Started** \u3092\u9078\u629e\u3057\u307e\u3059\n\n# Step1 Welcome to Amazon ECS\n\n![Screen Shot 2015-06-22 at 10.57.12 PM.png](https://qiita-image-store.s3.amazonaws.com/0/20193/07fdabb2-f0bf-8b96-4f10-f6a12b4132a6.png)\n\n\u4eca\u56de\u306f\u72ec\u81ea\u306e\u8a2d\u5b9a\u3092\u3059\u308b\u308f\u3051\u3067\u306a\u304f\u3001AWS\u306e\u7528\u610f\u3057\u305f\u30b5\u30f3\u30d7\u30eb\u3092\u4f7f\u3046\u306e\u3067**Amazon ECS sample**\u3092\u9078\u629e\u3057\u307e\u3059\n\n# Step2 Create Task Definition from sample\n\n![Screen Shot 2015-06-22 at 10.59.21 PM.png](https://qiita-image-store.s3.amazonaws.com/0/20193/175a1a2d-3ac8-14d6-8eb8-70a4b85ec8a7.png)\n\n\n\n\u6b21\u306e\u753b\u9762\u3067\u306f\u5229\u7528\u3059\u308b\u30b3\u30f3\u30c6\u30ca(docker)\u3068\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u30b5\u30f3\u30d7\u30eb\u3067\u306f**sample-app**\u3068\u3044\u3046httpd\u306e\u30b3\u30f3\u30c6\u30ca\u3068Web\u30a2\u30d7\u30ea\u306ehtml\u3092\u4fdd\u5b58\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u306e**busybox**\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\u4ed5\u7d44\u307f\u306a\u3069\u306b\u3064\u3044\u3066\u306f\u4e0b\u8a18\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n[Data Volume \u3068 Data Volume Container](http://qiita.com/sokutou-metsu/items/b83b275198fc9594f5a4)\n\n[Docker \u3067\u30c7\u30fc\u30bf\u306e\u30dd\u30fc\u30bf\u30d3\u30ea\u30c6\u30a3\u3092\u3042\u3052\u6c38\u7d9a\u5316\u3057\u3088\u3046](http://qiita.com/mopemope/items/b05ff7f603a5ad74bf55)\n\n\u672c\u30b5\u30f3\u30d7\u30eb\u3067\u3067\u306f\u3069\u306e\u3088\u3046\u306ahtml\u3092\u914d\u7f6e\u3057\u3066\u3044\u308b\u304b\u306b\u3064\u3044\u3066\u306f\u4e0a\u8a18\u753b\u9762\u306eJSON\u30bf\u30d6\u3092\u8868\u793a\u3059\u308b\u3053\u3068\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n\u3061\u306a\u307f\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```\n{\n  \"family\": \"console-sample-app-static\",\n  \"containerDefinitions\": [\n    {\n      \"name\": \"simple-app\",\n      \"image\": \"httpd:2.4\",\n      \"cpu\": \"10\",\n      \"memory\": \"300\",\n      \"environment\": [],\n      \"portMappings\": [\n        {\n          \"hostPort\": \"80\",\n          \"containerPort\": \"80\"\n        }\n      ],\n      \"volumesFrom\": [],\n      \"links\": [],\n      \"mountPoints\": [\n        {\n          \"sourceVolume\": \"my-vol\",\n          \"containerPath\": \"/usr/local/apache2/htdocs\"\n        }\n      ],\n      \"essential\": true\n    },\n    {\n      \"name\": \"busybox\",\n      \"image\": \"busybox\",\n      \"cpu\": \"10\",\n      \"memory\": \"200\",\n      \"entryPoint\": [\n        \"sh\",\n        \"-c\"\n      ],\n      \"environment\": [],\n      \"command\": [\n        \"/bin/sh -c \\\"while true; do echo '<html> <head> <title>Amazon ECS Sample App</title> <style>body {margin-top: 40px; background-color: #333;} </style> </head><body> <div style=color:white;text-align:center> <h1>Amazon ECS Sample App</h1> <h2>Congratulations!</h2> <p>Your application is now running on a container in Amazon ECS.</p>' > top; /bin/date > date ; echo '</div></body></html>' > bottom; cat top date bottom > /usr/local/apache2/htdocs/index.html ; sleep 1; done\\\"\"\n      ],\n      \"portMappings\": [],\n      \"volumesFrom\": [\n        {\n          \"sourceContainer\": \"simple-app\"\n        }\n      ],\n      \"links\": [],\n      \"mountPoints\": [],\n      \"essential\": false\n    }\n  ],\n  \"volumes\": [\n    {\n      \"name\": \"my-vol\",\n      \"host\": {}\n    }\n  ]\n}\n```\n\n# Step3 Schedule Tasks\n\n![Screen Shot 2015-06-22 at 11.08.56 PM.png](https://qiita-image-store.s3.amazonaws.com/0/20193/0e34860d-a214-a0de-31c1-64302c759205.png)\n\n\u672c\u753b\u9762\u3067\u306f\u30bf\u30b9\u30af\u3092\u4ee5\u4e0b\u306e\u3044\u305a\u308c\u304b\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n+ Run Tasks Once\n+ Create a service\n\n\u30d0\u30c3\u30c1\u51e6\u7406\u306e\u3088\u3046\u306a1\u56de\u306e\u307f\u51e6\u7406\u3092\u884c\u3046\u5834\u5408\u306b\u306f**Run Tasks Once**\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u304c\u3001\u4eca\u56de\u306ehttpd\u306e\u3088\u3046\u306a\u6c38\u7d9a\u7684\u306b\u5b9f\u884c\u3055\u308c\u308b\u3082\u306e\u306e\u5834\u5408\u3001**Create a service**\u306e\u65b9\u3092\u9078\u3073\u307e\u3059\u3002\n\n**Desired number of Tasks**\u3068**Service Name**\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u307e\u307e\u3068\u3057\u307e\u3059\u3002\n\n**ElasticLoadBalance**\u306b\u3064\u3044\u3066\u306f**simple-app:80**\u3092\u9078\u629e\u3057\u3001\u305d\u308c\u4ee5\u5916\u306e\u8a2d\u5b9a\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3068\u3057\u307e\u3059\u3002\n\u3061\u306a\u307f\u306b\u6700\u521d\u306b\u4e0a\u8a18\u5024\u3067**NoELB**\u3092\u9078\u629e\u3057\u3001\u305d\u306e\u307e\u307e\u9032\u3081\u3066\u307f\u305f\u306e\u3067\u3059\u304c\u3001\u30af\u30e9\u30b9\u30bf\u306e\u4f5c\u6210\u6642\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u8868\u793a\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\u3002\u3002\n\n>Created Service sample-webapp failed\n> A role was passed, but no load balancers were present.\n\n\u307e\u305f\u3001\u5b9f\u969b\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bSSH\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u78ba\u8a8d\u3057\u307e\u3057\u305f\u304c\u3001httpd\u3068busybox\u306edocker\u304c\u8d77\u52d5\u3057\u3066\u3044\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n```\n$ docker ps -a\nCONTAINER ID        IMAGE                            COMMAND             CREATED             STATUS              PORTS                        NAMES\ne57e72e78e8f        amazon/amazon-ecs-agent:latest   \"/agent\"            11 minutes ago      Up 11 minutes       127.0.0.1:51678->51678/tcp   ecs-agent\n```\n\n# Step4 Configure Cluster\n\n\u30b3\u30f3\u30c6\u30ca(docker)\u3092\u5b9f\u884c\u3059\u308bEC2\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u306f\u3058\u3081\u306b\u8d77\u52d5\u3059\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u6570\u3084\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30bf\u30a4\u30d7\u3001KeyPair\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n![Screen Shot 2015-06-23 at 8.36.53 AM.png](https://qiita-image-store.s3.amazonaws.com/0/20193/98db0b5f-a7a5-00a5-cdd0-93051114fa9a.png)\n\n\u7279\u306b\u554f\u984c\u306a\u3051\u308c\u3070KeyPair\u306e\u307f\u5229\u7528\u3059\u308b\u3082\u306e\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n![Screen Shot 2015-06-22 at 11.40.12 PM.png](https://qiita-image-store.s3.amazonaws.com/0/20193/e55117de-372a-44e9-5db2-48473b39b588.png)\n\n\u6b21\u306b\u30a2\u30af\u30bb\u30b9\u5143\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u6307\u5b9a\u3057\u305fIP\u30a2\u30c9\u30ec\u30b9\u304b\u3089\u306e\u307f\u8d77\u52d5\u3059\u308bhttpd\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u3059\u3002\u7279\u306b\u5236\u9650\u3092\u3057\u306a\u3044\u5834\u5408\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e**0.0.0.0/0**\u306e\u307e\u307e\u3068\u3057\u307e\u3059\u3002\n\n\u5bfe\u8c61\u306eEC2\u304b\u3089ECS\u306e\u64cd\u4f5c\u3092\u3059\u308b\u305f\u3081\u306bIAM\u30ed\u30fc\u30eb\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u521d\u3081\u3066ECS\u3092\u64cd\u4f5c\u3059\u308b\u5834\u5408\u3001**Create IAM Roles**\u30dc\u30bf\u30f3\u3092\u62bc\u4e0b\u3059\u308b\u3053\u3068\u3067ECS\u3092\u64cd\u4f5c\u3059\u308b\u305f\u3081\u306eIAM\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3067\u304d\u307e\u3059\u3002\n\n# Launch\n\n\u5168\u4f53\u306e\u69cb\u6210\u3092\u78ba\u8a8d\u3057\u3001\u554f\u984c\u306a\u3051\u308c\u3070Launch\u3057\u307e\u3059\u3002EC2\u306e\u8d77\u52d5\u3084\u8a2d\u5b9a\u306a\u3069\u3092CloudFormation\u3092\u4f7f\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3001\u8a73\u7d30\u3092\u78ba\u8a8d\u3057\u305f\u3044\u5834\u5408\u3001\u30ea\u30f3\u30af\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066CloudFormation\u306e\u753b\u9762\u3067\u5b9f\u65bd\u5185\u5bb9\u306a\u3069\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\u4ee5\u4e0b\u306fECS\u4e0a\u3067\u306e\u9032\u6357\u72b6\u6cc1\u306e\u78ba\u8a8d\u753b\u9762\u3068\u306a\u308a\u307e\u3059\u3002\n\n![Screen Shot 2015-06-22 at 11.48.00 PM.png](https://qiita-image-store.s3.amazonaws.com/0/20193/62524a58-be5e-f746-0deb-4c2b0ba2d365.png)\n\n\u8d77\u52d5\u304c\u5b8c\u4e86\u3059\u308b\u3068\u8d77\u52d5\u3057\u305fEC2\u3084ELB\u306e\u60c5\u5831\u306a\u3069\u69d8\u3005\u306a\u60c5\u5831\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n\u8d77\u52d5\u76f4\u5f8c\u306f**sample-webapp**\u306eStatsu\u304cPENDING\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u5c11\u3057\u6642\u9593\u304c\u7d4c\u3064\u3068RUNNING\u306b\u5909\u308f\u308a\u307e\u3059\u3002\n\n![Screen Shot 2015-06-22 at 11.52.36 PM.png](https://qiita-image-store.s3.amazonaws.com/0/20193/6fc23caf-949d-36b7-0969-7a7c204649db.png)\n\n\u307e\u305f\u3001\u4e0a\u8a18\u3088\u308aELB\u306e\u753b\u9762\u3092\u78ba\u8a8d\u3057\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304cELB\u306b\u30a2\u30bf\u30c3\u30c1\u3055\u308c\u3066\u3044\u308b\u306e\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u30a2\u30bf\u30c3\u30c1\u6e08\u307f\u3067\u3042\u308c\u3070ELB\u3067\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308bURL\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u554f\u984c\u306a\u3051\u308c\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n![Screen Shot 2015-06-22 at 11.58.06 PM.png](https://qiita-image-store.s3.amazonaws.com/0/20193/b5e936d9-67a5-2df7-0efc-faa0bf2a4ddf.png)\n\n# \u5bfe\u8c61\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bSSH\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u307f\u308b\n\n\u4e0a\u8a18\u306eGUI\u306b\u3088\u308b\u8a2d\u5b9a\u3092\u3057\u305f\u5834\u5408\u3001\u30b3\u30f3\u30c6\u30ca(docker)\u3092\u52d5\u304b\u3059EC2\u306bKeyPari\u306e\u8a2d\u5b9a\u306f\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001SecurityGroup\u306e\u8a2d\u5b9a\u306722\u306e\u8a31\u53ef\u304c\u3055\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u5bfe\u8c61\u306eEC2\u306b\u306f\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u307e\u305b\u3093\u3002ECS\u3092\u4f7f\u3048\u3070SSH\u3057\u306a\u304f\u3066\u3082\u5927\u4e08\u592b\u3068\u3044\u3046\u3053\u3068\u3060\u3068\u601d\u3046\u306e\u3067\u3059\u304c\u3001\u4f55\u304b\u3042\u3063\u3066\u8abf\u67fb\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u306bSSH\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3059\u3002\uff08\u904b\u7528\u3059\u308b\u5834\u5408\u306fSSH\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u306a\u3044\u72b6\u614b\u306e\u307e\u307e\u3068\u3059\u308b\u306e\u304c\u6b63\u3057\u3044\u3068\u601d\u3044\u307e\u3059\uff09\n\nECS\u306e\u753b\u9762\u304b\u3089docker\u3092\u52d5\u304b\u3059\u305f\u3081\u306b\u8d77\u52d5\u3055\u308c\u305fEC2\u304c\u78ba\u8a8d\u3067\u304d\u308b\u306e\u3067\u305d\u306eEC2\u306b\u8a2d\u5b9a\u3055\u308c\u305fSecurityGroup\u306e22\u30dd\u30fc\u30c8\u3092\u958b\u653e\u3059\u308c\u3070OK\u3067\u3059\u3002\n\n```\n$ssh ec2-user@52.69.31.141 -i hogefugaKey.pem\n\n   __|  __|  __|\n   _|  (   \\__ \\   Amazon ECS-Optimized Amazon Linux AMI 2015.03.d\n ____|\\___|____/\n\nFor documentation visit, http://aws.amazon.com/documentation/ecs\n2 package(s) needed for security, out of 2 available\nRun \"sudo yum update\" to apply all updates.\n```\n\n`docker ps`\u30b3\u30de\u30f3\u30c9\u3092\u30bf\u30a4\u30d7\u3059\u308b\u3053\u3068\u3067GUI\u3067\u6307\u5b9a\u3057\u305f2\u3064\u306edocker\u3068ECS\u3068\u901a\u4fe1\u3092\u884c\u3046**ecs-agent**\u3068\u3044\u3046docker\u304c\u52d5\u4f5c\u3057\u3066\u3044\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n```\n$docker ps\nCONTAINER ID        IMAGE                            COMMAND                CREATED             STATUS              PORTS                        NAMES\n1e292fd54f47        busybox:latest                   \"\\\"sh -c '/bin/sh -c   8 hours ago         Up 8 hours                                       ecs-console-sample-app-static-5-busybox-86f3a5c7add9d5fd4d00\n9c7dd2d8490b        httpd:2.4                        \"httpd-foreground\"     8 hours ago         Up 8 hours          0.0.0.0:80->80/tcp           ecs-console-sample-app-static-5-simple-app-9aefdfbc92fcbce23600\nb6cd81e19b7d        amazon/amazon-ecs-agent:latest   \"/agent\"               8 hours ago         Up 8 hours          127.0.0.1:51678->51678/tcp   ecs-agent\n```\n\n# \u304a\u6383\u9664\n\n\u4e00\u901a\u308a\u78ba\u8a8d\u304c\u7d42\u308f\u3063\u305f\u306e\u3067\u524a\u9664\u3057\u307e\u3059\u3002\nECS\u306e\u753b\u9762\u304b\u3089\u30af\u30e9\u30b9\u30bf\u3092\u524a\u9664\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u8868\u793a\u3055\u308c\u3001\u524a\u9664\u304c\u3067\u304d\u307e\u305b\u3093\u3002\u3002\u3002\u3002\n\n> Unable to delete cluster\n> The Cluster cannot be deleted while Container Instances are active.\n\n\u524a\u9664\u3059\u308b\u3068\u304d\u306e\u6ce8\u610f\u753b\u9762\u3067\u300cCloudFormation\u4f7f\u3063\u3066Stack\u306e\u66f4\u65b0\u304b\u524a\u9664\u3092\u3057\u3066\u306d\u300d\u3068\u3042\u3063\u305f\u306e\u3067\u3001CloudFormation\u306e\u753b\u9762\u304b\u3089ECS\u4f5c\u6210\u6642\u306eStack\u3092\u9078\u629e\u3057\u3001delete stack\u3057\u307e\u3059\u3002stack\u540d\u306f **EC2ContainerService-default-xxxxx**\u3068\u3044\u3046\u5f62\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u306e\u3067\u305d\u306estack\u3092**delete stack**\u3057\u3066\u524a\u9664\u3057\u307e\u3059\u3002\n\nCloudFromation\u3067\u524a\u9664\u3057\u305f\u306e\u306f\u3042\u304f\u307e\u3067Stack\u3068\u95a2\u9023\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u306e\u307f(ELB,EC2,SecurityGroup etc...)\u3067ECS\u306e\u30af\u30e9\u30b9\u30bf\u3001\u30b5\u30fc\u30d3\u30b9\u306f\u6b8b\u3063\u3066\u3044\u308b\u306e\u3067ECS\u306e\u753b\u9762\u304b\u3089\u524a\u9664\u3057\u307e\u3059\u3002\n\n\u307e\u305a\u306f **sample-webapp** \u30b5\u30fc\u30d3\u30b9\u3092\u524a\u9664\u3057\u307e\u3059\u3002\n\u304cGUI\u304b\u3089\u524a\u9664\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u3002\u3002\n\n>The service cannot be stopped while the primary deployment is scaled above 0.\n\n\u691c\u7d22\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u8a18\u4e8b\u3092\u767a\u898b\u3002\n\n[Delete a cluster : impossible ! (Via UI or CLI)](https://forums.aws.amazon.com/thread.jspa?messageID=614116)\n\n\u4e0a\u8a18\u8a18\u4e8b\u306b\u5f93\u3063\u3066\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u65bd\u3057\u307e\u3059\u3002\n\n```\n$aws ecs update-service --service sample-webapp --desired-count 0\n```\n\n\u4e0a\u8a18\u5b9f\u65bd\u5f8c\u3001GUI\u304b\u3089\u30b5\u30fc\u30d3\u30b9\u3092\u524a\u9664\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3057\u305f\u3002\u3002\u3002\n\u307e\u305f\u3001\u30b5\u30fc\u30d3\u30b9\u524a\u9664\u5f8c\u3067\u3042\u308c\u3070GUI\u304b\u3089\u30af\u30e9\u30b9\u30bf\u306e\u524a\u9664\u3082\u53ef\u80fd\u3068\u306a\u308a\u307e\u3059\u3002\n", "tags": ["AWS", "ECS"]}