{"context": " More than 1 year has passed since last update.\n\n\u524d\u63d0\n\ncap\u3067\u30c7\u30d7\u30ed\u30a4\u3057\u3066\u3044\u308b\n\u672c\u756a\u30b5\u30fc\u30d0\u30fc\u3067sudo\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\ncron\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u30d7\u30ed\u30c0\u30af\u30c8\u306egit\u30ec\u30dd\u30b8\u30c8\u30ea\u5185\u306b\u542b\u3081\u3066\u3044\u308b\n\n\n\u554f\u984c\n\ncron\u3092\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3067/etc/cron.d/\u4ee5\u4e0b\u306b\u8a2d\u7f6e\u3057\u3066\u3082\u6a29\u9650\u306e\u554f\u984c\u3067\u7121\u8996\u3055\u308c\u308b\n\n\n\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\n\n\nowner\u306froot:root\n\npermissio\u306f644\n\n\n\n\ngit\u3067\u4e88\u3081chown root:root\u3057\u3066\u304a\u3051\u306a\u3044(\u3088\u306d\uff1f)\n\n\n\u89e3\u6c7a\u65b9\u6cd5\n\ncap\u3067\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u5ea6\u306b\u6a29\u9650\u3092\u5909\u66f4\u3059\u308b\n\n\n\u5b9f\u88c5\nsudo\u3092\u4f7f\u3046\u306e\u3067\u4ee5\u4e0b\u3092\u8a2d\u5b9a\u3057\u3066\u306a\u304b\u3063\u305f\u3089\u8ffd\u52a0\n\nconfig/deploy.rb\n+set :pty, true\n\n\ntask\u3092\u8ffd\u52a0\u3057\u305f\u3044\u5834\u5408\u306f\u3001Capfile\u306e\u4e2d\u8eab\u3092\u898b\u3066\u305d\u3053\u306b\u8a2d\u7f6e\u3059\u308b\n\nlib/capistrano/tasks/symlink_cron.rake\nnamespace :symlink_cron do\n  desc \"change owner to root\"\n  task :change_permission do\n    on roles(:app) do\n      execute :sudo, \"chmod 644 #{release_path}/misc/cron/sample\"\n      execute :sudo, \"chown root:root #{release_path}/misc/cron/sample\"\n    end\n  end\n  after 'deploy:published', 'symlink_cron:change_permission'\nend\n\n\n\u3061\u306a\u307f\u306b\u5b9f\u969b\u306b\u8a2d\u5b9a\u3059\u308bcron\u30d5\u30a1\u30a4\u30eb\u306e\u4f8b\u3092\u4ee5\u4e0b\u306b\u793a\u3059\n\nmisc/cron/sample\nAPP_DIR=/home/your_username/your_project_name/current\nLOG_DIR=/var/log/your_project_name/cron\n\n# \u6bce\u9031\u706b\u66dc10:00\u306b\u5b9f\u884c\n00 10 * * 2 root su your_username -l -c \"cd ${APP_DIR} && bundle exec rake sample:run RAILS_ENV=production\" >> ${LOG_DIR}/sample.log 2>&1\n\n\n\u203bmisc\u3063\u3066\u306e\u306f\u81ea\u5206\u306e\u30c1\u30fc\u30e0\u306e\u6c7a\u3081\u3067\u3064\u304f\u3063\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n\u3042\u3068\u306f\u3001cap\u3067\u3082Chef\u3067\u3082ansible\u3067\u3082\u3044\u3044\u3067\u3059\u304c\u3001\u4ee5\u4e0b\u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u8cbc\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u3051\u3070\u3001cron\u304c\u5b9f\u884c\u3055\u308c\u308b\u72b6\u614b\u306b\u306a\u308a\u307e\u3059\u3002\nln -s /home/your_username/your_project_name/current/misc/cron/sample /etc/cron.d/sample\n\n\n\u53c2\u8003\n\n\ntask\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3059\u308b\u3068\u304d\u306b\u5f79\u7acb\u3064\n\nCapistrano3\u306e\u30c7\u30d7\u30ed\u30a4\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306e\u4f7f\u3044\u65b9\n\n\n\n\u5225\u306e\u65b9\u6cd5\u3067\u306ecron\u306e\u8ffd\u52a0(crontab\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3044\u305f\u304f\u306a\u3044\u3068\u3044\u3046\u7406\u7531\u3067\u4eca\u56de\u306f\u4e0d\u63a1\u7528)\u3002\n\ncron\u95a2\u9023\u30d5\u30a1\u30a4\u30eb\u3092git\u3067\u7ba1\u7406\u3057\u305f\u3044\n\n\n\n\n## \u524d\u63d0\n\n- cap\u3067\u30c7\u30d7\u30ed\u30a4\u3057\u3066\u3044\u308b\n- \u672c\u756a\u30b5\u30fc\u30d0\u30fc\u3067sudo\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\n- cron\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u30d7\u30ed\u30c0\u30af\u30c8\u306egit\u30ec\u30dd\u30b8\u30c8\u30ea\u5185\u306b\u542b\u3081\u3066\u3044\u308b\n\n## \u554f\u984c\n\n- cron\u3092\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3067/etc/cron.d/\u4ee5\u4e0b\u306b\u8a2d\u7f6e\u3057\u3066\u3082\u6a29\u9650\u306e\u554f\u984c\u3067\u7121\u8996\u3055\u308c\u308b\n    - \u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\n        - owner\u306f`root:root`\n        - permissio\u306f644\n- git\u3067\u4e88\u3081`chown root:root`\u3057\u3066\u304a\u3051\u306a\u3044(\u3088\u306d\uff1f)\n\n## \u89e3\u6c7a\u65b9\u6cd5\n\n- cap\u3067\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u5ea6\u306b\u6a29\u9650\u3092\u5909\u66f4\u3059\u308b\n\n## \u5b9f\u88c5\n\nsudo\u3092\u4f7f\u3046\u306e\u3067\u4ee5\u4e0b\u3092\u8a2d\u5b9a\u3057\u3066\u306a\u304b\u3063\u305f\u3089\u8ffd\u52a0\n\n```diff:config/deploy.rb\n+set :pty, true\n```\n\ntask\u3092\u8ffd\u52a0\u3057\u305f\u3044\u5834\u5408\u306f\u3001Capfile\u306e\u4e2d\u8eab\u3092\u898b\u3066\u305d\u3053\u306b\u8a2d\u7f6e\u3059\u308b\n\n```ruby:lib/capistrano/tasks/symlink_cron.rake\nnamespace :symlink_cron do\n  desc \"change owner to root\"\n  task :change_permission do\n    on roles(:app) do\n      execute :sudo, \"chmod 644 #{release_path}/misc/cron/sample\"\n      execute :sudo, \"chown root:root #{release_path}/misc/cron/sample\"\n    end\n  end\n  after 'deploy:published', 'symlink_cron:change_permission'\nend\n```\n\n\u3061\u306a\u307f\u306b\u5b9f\u969b\u306b\u8a2d\u5b9a\u3059\u308bcron\u30d5\u30a1\u30a4\u30eb\u306e\u4f8b\u3092\u4ee5\u4e0b\u306b\u793a\u3059\n\n```cron:misc/cron/sample\nAPP_DIR=/home/your_username/your_project_name/current\nLOG_DIR=/var/log/your_project_name/cron\n\n# \u6bce\u9031\u706b\u66dc10:00\u306b\u5b9f\u884c\n00 10 * * 2 root su your_username -l -c \"cd ${APP_DIR} && bundle exec rake sample:run RAILS_ENV=production\" >> ${LOG_DIR}/sample.log 2>&1\n```\n\n\u203bmisc\u3063\u3066\u306e\u306f\u81ea\u5206\u306e\u30c1\u30fc\u30e0\u306e\u6c7a\u3081\u3067\u3064\u304f\u3063\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n\n\u3042\u3068\u306f\u3001cap\u3067\u3082Chef\u3067\u3082ansible\u3067\u3082\u3044\u3044\u3067\u3059\u304c\u3001\u4ee5\u4e0b\u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u8cbc\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u3051\u3070\u3001cron\u304c\u5b9f\u884c\u3055\u308c\u308b\u72b6\u614b\u306b\u306a\u308a\u307e\u3059\u3002\n\n```\nln -s /home/your_username/your_project_name/current/misc/cron/sample /etc/cron.d/sample\n```\n\n## \u53c2\u8003\n\n- task\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3059\u308b\u3068\u304d\u306b\u5f79\u7acb\u3064\n    - [Capistrano3\u306e\u30c7\u30d7\u30ed\u30a4\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306e\u4f7f\u3044\u65b9](http://qiita.com/yuku_t/items/01c0ec4389db143e27f5)\n\n- \u5225\u306e\u65b9\u6cd5\u3067\u306ecron\u306e\u8ffd\u52a0(crontab\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3044\u305f\u304f\u306a\u3044\u3068\u3044\u3046\u7406\u7531\u3067\u4eca\u56de\u306f\u4e0d\u63a1\u7528)\u3002\n    - [cron\u95a2\u9023\u30d5\u30a1\u30a4\u30eb\u3092git\u3067\u7ba1\u7406\u3057\u305f\u3044](http://qiita.com/kidachi_/items/ae968be3ea03976baa59)\n", "tags": ["Rails", "capistrano", "Git", "cron"]}