{"context": "CentOS7\u7cfb\u306e\u74b0\u5883\u306b\u3001Sensu\u3068Uchiwa\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u524d\u63d0\u6761\u4ef6\u3068\u3057\u3066\u3001\u300cSensu(\u30b5\u30fc\u30d0\u30fc\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8)\u3068Uchiwa\u306f1\u53f0\u306e\u30de\u30b7\u30f3\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u300d\u3068\u306a\u308a\u307e\u3059\u3002\n\nRedis\n# epel\u30ec\u30dd\u30b8\u30c8\u30ea\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum install -y epel-release\nyum update -y epel-release\n\n# Redis\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\u3001\u30b5\u30fc\u30d3\u30b9\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\nyum install -y redis\nsystemctl start redis\nsystemctl enable redis\n\n\nRabbitMQ\n# RabbitMQ\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\u3001\u30b5\u30fc\u30d3\u30b9\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\nyum install -y rabbitmq-server\nsystemctl start rabbitmq-server\nsystemctl enable rabbitmq-server\n\n# RabbitMQ\u306eSensu\u5411\u3051\u8a2d\u5b9a\n# Virtual Host(\u300c/sensu\u300d)\u306e\u8ffd\u52a0\nrabbitmqctl add_vhost /sensu\n# RabbitMQ\u306bsensu\u30e6\u30fc\u30b6\u30fc\u306e\u8ffd\u52a0(\u30d1\u30b9\u30ef\u30fc\u30c9\u306fsensu)\nrabbitmqctl add_user sensu sensu\n# sensu\u30e6\u30fc\u30b6\u30fc\u3078\u306e\u300c/sensu\u300d\u3078\u306e\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u4ed8\u4e0e\nrabbitmqctl set_permissions -p /sensu sensu \".*\" \".*\" \".*\"\n\n\nSensu&Uchiwa\n\nYum\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u8ffd\u52a0\ncat << \"_EOF_\" > /etc/yum.repos.d/sensu.repo\n[sensu]\nname=sensu\nbaseurl=http://sensu.global.ssl.fastly.net/yum/$basearch/\ngpgcheck=0\nenabled=1\n_EOF_\n\n\nSensu\u3068Uchiwa\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u521d\u671f\u8a2d\u5b9a\n# Sensu\u3068Uchiwa\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum install -y sensu uchiwa\n\n# Sensu\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u8a2d\u7f6e\ncp /etc/sensu/config.json.example /etc/sensu/config.json\n\n# Uchiwa\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u8a2d\u7f6e\nsed -i.original 's/Site 1/Sensu Server/;s/api1.example.com/127.0.0.1/' /etc/sensu/uchiwa.json\nsed -i '8,17d' /etc/sensu/uchiwa.json\n\n\nSensu\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# SNMP\u306e\u8a2d\u5b9a(\u6b7b\u6d3b\u76e3\u8996\u3067\u4f7f\u7528)\nyum install -y net-snmp net-snmp-utils\nsystemctl start snmpd\nsystemctl enable snmpd\n\n# Sensu\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u306b\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea(gcc, gcc-c++)\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum install -y gcc gcc-c++\n\n# Sensu\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb(\u4eca\u56de\u306f\u30c7\u30a3\u30b9\u30af\u30c1\u30a7\u30c3\u30af\u3068CPU\u30c1\u30a7\u30c3\u30af\u3001HTTP\u306e\u30c1\u30a7\u30c3\u30af\u3001SNMP\u306e\u30c1\u30a7\u30c3\u30af\u306e\u307f)\n/usr/bin/sensu-install -P disk-checks,cpu-checks,http, snmp\n\n\nSensu\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u8a2d\u5b9a\n\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u7fa4\u3092\u8a2d\u7f6e\n\n/etc/sensu/conf.d/check-cpu.json\n{\n  \"checks\": {\n    \"cpu\": {\n      \"command\": \"check-cpu.rb -w 80 -c 95\",\n      \"interval\": 10,\n      \"subscribers\": [\n        \"test\"\n      ]\n    }\n  }\n}\n\n\n\u203b10\u5206\u3054\u3068\u306bCPU\u4f7f\u7528\u7387\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3001CPU\u4f7f\u7528\u7387\u304c80%\u4ee5\u4e0a\u3067\u8b66\u544a\u300195%\u4ee5\u4e0a\u3067\u81f4\u547d\u7684\u72b6\u614b\u3092\u901a\u77e5\n\n/etc/sensu/conf.d/check-disk.json\n{\n  \"checks\": {\n    \"disk\": {\n      \"command\": \"check-disk-usage.rb -w 75 -c 90\",\n      \"interval\": 600,\n      \"subscribers\": [\n        \"test\"\n      ]\n    }\n  }\n}\n\n\n\u203b10\u5206\u3054\u3068\u306b\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3001\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u304c80%\u4ee5\u4e0a\u3067\u8b66\u544a\u300195%\u4ee5\u4e0a\u3067\u81f4\u547d\u7684\u72b6\u614b\u3092\u901a\u77e5\n\n/etc/sensu/conf.d/check-http.json\n{\n  \"checks\": {\n    \"http\": {\n      \"command\": \"check-http.rb -t 60 -u http://www.yahoo.co.jp\",\n      \"interval\": 600,\n      \"occurrences\": 3,\n      \"subscribers\": [\n        \"test\"\n      ]\n    }\n  }\n}\n\n\n\u203b10\u5206\u3054\u3068\u306b http://www.yahoo.co.jp \u306b\u5bfe\u3057\u3066\u758e\u901a\u3092\u3057\u30013\u56de\u4ee5\u4e0a\u758e\u901a\u304c\u3067\u304d\u306a\u304b\u3063\u305f\u5834\u5408\u3001\u81f4\u547d\u7684\u72b6\u614b\u3092\u901a\u77e5\n\nSensu\u3068Uchiwa\u306e\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\u3068\u8d77\u52d5\n/usr/bin/systemctl enable sensu-client sensu-server sensu-api uchiwa\n/usr/bin/systemctl start sensu-client sensu-server sensu-api uchiwa\n\n\nsensu-api\u306e\u52d5\u4f5c\u78ba\u8a8d\n\u4ee5\u4e0b\u306ecURL\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ curl -s http://AAA.BBB.CCC.DDD:4567/info | jq .\n{\n  \"sensu\": {\n    \"version\": \"0.26.3\"\n  },\n  \"transport\": {\n    \"keepalives\": {\n      \"messages\": 3,\n      \"consumers\": 1\n    },\n    \"results\": {\n      \"messages\": 0,\n      \"consumers\": 1\n    },\n    \"connected\": true\n  },\n  \"redis\": {\n    \"connected\": true\n  }\n}\n# \u3053\u308c\u306a\u3089OK\u3067\u3059\n\n\nUchiwa\u306e\u52d5\u4f5c\u78ba\u8a8d\n\u30d6\u30e9\u30a6\u30b6\u3067\u3001 http://AAA.BBB.CCC.DDD:3000/ \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u4ee5\u4e0b\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308c\u3070OK\u3067\u3059\u3002\n\n\u53c2\u8003\u30ea\u30f3\u30af\n\u30b5\u30fc\u30d0\u30fc\u76e3\u8996\u30c4\u30fc\u30eb Sensu\n\nSensu\u53c2\u8003\u60c5\u5831\n\nSlack\u7528\u901a\u77e5\u30cf\u30f3\u30c9\u30e9\nsensu-plugins/sensu-plugins-slack\u3092\u5229\u7528\n\n/opt/ansible/conf/slack-handler-notify.json\n{\n  \"handlers\": {\n    \"slack-notify\": {\n      \"type\": \"pipe\",\n      \"command\": \"handler-slack.rb -j slack-notify\"\n    }\n  },\n  \"slack-notify\": {\n    \"webhook_url\": \"https://hooks.slack.com/services/XXXXX\",\n    \"channel\": \"#any-channel\",\n    \"bot_name\": \"Sensu Bot\",\n    \"message_template\" : \"slack-template.erb\"\n  }\n}\n\n\n\nSensu\u306e\u76e3\u8996\u8a2d\u5b9a\n\n\u8a2d\u5b9a\u4f8b(check-cpu.json)\n{\n  \"checks\": {\n    \"cpu\": {\n      \"type\": \"standard\",\n      \"command\": \"check-cpu.rb -w 80 -c 95\",\n      \"interval\": 600,\n      \"occurrences\": 3,\n      \"subscribers\": [\n        \"common\"\n      ],\n      \"handlers\": [\n        \"slack\"\n      ]\n    }\n  }\n}\n\n\n\n\u76e3\u8996\u30bf\u30a4\u30d7(type)\n\u4ee5\u4e0b\u306e2\u30bf\u30a4\u30d7\u306e\u5185\u3044\u305a\u308c\u304b\u4f7f\u7528\u3059\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u306b\u5408\u81f4\u3057\u305f\u3082\u306e\u3092\u8a18\u8f09\u3059\u308b\n- standard\u30fb\u30fb\u30fb\u6a19\u6e96\u306echeck\u7528\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\n- metrics\u30fb\u30fb\u30fbmetircs\u7528\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\n\u6307\u5b9a\u306f\u3001\u300c\"metrics\"\u300d\u3067\u6307\u5b9a\u3059\u308b\n\u203b\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001\u300c\"standard\"\u300d\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\n\u203b\u7701\u529b\u3057\u305f\u5834\u5408\u306f\u3001\u300c\"standard\"\u300d\u304c\u6307\u5b9a\u3055\u308c\u308b\n\n\u8a2d\u5b9a\u540d\n\u8a2d\u5b9a\u306e\u540d\u79f0\u3092\u3064\u3051\u308b\n\u203b\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001\u300ccpu\u300d\n\u203b\u7701\u7565\u306f\u3067\u304d\u306a\u3044\n\n\u30b3\u30de\u30f3\u30c9(command)\n\u76e3\u8996\u306e\u969b\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u3066\u5b9f\u884c\u3055\u308c\u308b\u30b3\u30de\u30f3\u30c9\u3092\u6307\u5b9a\u3059\u308b\n\u203b\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001\u300ccheck-cpu.rb -w 80 -c 95\u300d\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\n\u203b\u7701\u7565\u306f\u3067\u304d\u306a\u3044(\u4f46\u3057\u3001\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u66f8\u3044\u3066\u3042\u308b\u901a\u308a\u300cextension\u300d\u3092\u6307\u5b9a\u3059\u308c\u3070\u7701\u7565\u306f\u3067\u304d\u308b)\n\n\u9593\u9694(interval)\n\u76e3\u8996\u304c\u5b9f\u884c\u3055\u308c\u308b\u9593\u9694\u3092\u79d2\u5358\u4f4d\u6307\u5b9a\u3059\u308b\n\u203b\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001\u300c600\u300d(=600\u79d2=10\u5206)\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\n\u203b\u7701\u7565\u306f\u3067\u304d\u306a\u3044\n\n\u95be\u5024(occurrences)\n\u76e3\u8996\u901a\u77e5\u306e\u95be\u5024\u3067\u3001\u95be\u5024\u56de\u6570\u7d99\u7d9a\u3057\u3066\u30a2\u30e9\u30fc\u30c8\u306e\u6761\u4ef6\u3092\u6e80\u305f\u3057\u305f\u5834\u5408\u306b\u30a2\u30e9\u30fc\u30c8\u901a\u77e5\u3055\u308c\u308b\n\u203b\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001\u300c3\u300d\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\n\u203b\u7701\u7565\u3057\u305f\u5834\u5408\u306f\u3001\u300c1\u300d\u304c\u6307\u5b9a\u3055\u308c\u308b\n\n\u5bfe\u8c61\u30af\u30e9\u30a4\u30a2\u30f3\u30c8(subscribers)\n\u6307\u5b9a\u3055\u308c\u305fsubscribers\u306b\u5c5e\u3059\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u307f\u76e3\u8996\u5bfe\u8c61\u3068\u3055\u308c\u308b\n\u8907\u6570\u306e\u6307\u5b9a\u304c\u3067\u304d\u308b\n\u203b\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001\u300ccommon\u300d\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\n\u203b\u7701\u7565\u306f\u3067\u304d\u306a\u3044(\u4f46\u3057\u3001\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u66f8\u3044\u3066\u3042\u308b\u901a\u308a\u300cstandalone\u300d\u3092\u300ctrue\u300d\u306b\u6307\u5b9a\u3059\u308c\u3070\u7701\u7565\u306f\u3067\u304d\u308b)\n\n\u901a\u77e5\u30cf\u30f3\u30c9\u30e9(handlers)\n\u901a\u77e5\u3092\u884c\u3046\u969b\u3001\u6307\u5b9a\u3055\u308c\u305f\u901a\u77e5\u30cf\u30f3\u30c9\u30e9\u3092\u4f7f\u7528\u3057\u3066\u901a\u77e5\u3055\u308c\u308b\n\u8907\u6570\u306e\u6307\u5b9a\u304c\u3067\u304d\u308b\n\u203b\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001\u300cslack\u300d\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\n\u203b\u7701\u7565\u3057\u305f\u5834\u5408\u306f\u3001/etc/sensu/config.json\u306e\u300chandlers\u300d\u306e\u300cdefault\u300d\u306e\u300chandlers\u300d\u306b\u8a2d\u5b9a\u3055\u308c\u305f\u901a\u77e5\u30cf\u30f3\u30c9\u30e9\u304c\u6307\u5b9a\u3055\u308c\u308b\n\u53c2\u8003\u30ea\u30f3\u30af\nSensu | Checks\nSensu | Plugins\nSensu\u306e\u76e3\u8996\u306e\u8a2d\u5b9a - \u3055\u3088\u306a\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\n\u7b2c361\u56de\u3000Sensu\u3067\u30b5\u30fc\u30d0\u30fc\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u53ef\u8996\u5316\u3057\u3088\u3046\uff1aUbuntu Weekly Recipe\uff5cgihyo.jp \u2026 \u6280\u8853\u8a55\u8ad6\u793e\nCentOS7\u7cfb\u306e\u74b0\u5883\u306b\u3001Sensu\u3068Uchiwa\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u524d\u63d0\u6761\u4ef6\u3068\u3057\u3066\u3001\u300cSensu(\u30b5\u30fc\u30d0\u30fc\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8)\u3068Uchiwa\u306f1\u53f0\u306e\u30de\u30b7\u30f3\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u300d\u3068\u306a\u308a\u307e\u3059\u3002\n\n## Redis\n\n```bash\n# epel\u30ec\u30dd\u30b8\u30c8\u30ea\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum install -y epel-release\nyum update -y epel-release\n\n# Redis\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\u3001\u30b5\u30fc\u30d3\u30b9\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\nyum install -y redis\nsystemctl start redis\nsystemctl enable redis\n```\n\n## RabbitMQ\n\n```bash\n# RabbitMQ\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\u3001\u30b5\u30fc\u30d3\u30b9\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\nyum install -y rabbitmq-server\nsystemctl start rabbitmq-server\nsystemctl enable rabbitmq-server\n\n# RabbitMQ\u306eSensu\u5411\u3051\u8a2d\u5b9a\n# Virtual Host(\u300c/sensu\u300d)\u306e\u8ffd\u52a0\nrabbitmqctl add_vhost /sensu\n# RabbitMQ\u306bsensu\u30e6\u30fc\u30b6\u30fc\u306e\u8ffd\u52a0(\u30d1\u30b9\u30ef\u30fc\u30c9\u306fsensu)\nrabbitmqctl add_user sensu sensu\n# sensu\u30e6\u30fc\u30b6\u30fc\u3078\u306e\u300c/sensu\u300d\u3078\u306e\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u4ed8\u4e0e\nrabbitmqctl set_permissions -p /sensu sensu \".*\" \".*\" \".*\"\n```\n\n##Sensu&Uchiwa\n\n###Yum\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u8ffd\u52a0\n\n```bash\ncat << \"_EOF_\" > /etc/yum.repos.d/sensu.repo\n[sensu]\nname=sensu\nbaseurl=http://sensu.global.ssl.fastly.net/yum/$basearch/\ngpgcheck=0\nenabled=1\n_EOF_\n```\n\n###Sensu\u3068Uchiwa\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u521d\u671f\u8a2d\u5b9a\n\n```bash\n# Sensu\u3068Uchiwa\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum install -y sensu uchiwa\n\n# Sensu\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u8a2d\u7f6e\ncp /etc/sensu/config.json.example /etc/sensu/config.json\n\n# Uchiwa\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u8a2d\u7f6e\nsed -i.original 's/Site 1/Sensu Server/;s/api1.example.com/127.0.0.1/' /etc/sensu/uchiwa.json\nsed -i '8,17d' /etc/sensu/uchiwa.json\n```\n\n###Sensu\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\n# SNMP\u306e\u8a2d\u5b9a(\u6b7b\u6d3b\u76e3\u8996\u3067\u4f7f\u7528)\nyum install -y net-snmp net-snmp-utils\nsystemctl start snmpd\nsystemctl enable snmpd\n\n# Sensu\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u306b\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea(gcc, gcc-c++)\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum install -y gcc gcc-c++\n\n# Sensu\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb(\u4eca\u56de\u306f\u30c7\u30a3\u30b9\u30af\u30c1\u30a7\u30c3\u30af\u3068CPU\u30c1\u30a7\u30c3\u30af\u3001HTTP\u306e\u30c1\u30a7\u30c3\u30af\u3001SNMP\u306e\u30c1\u30a7\u30c3\u30af\u306e\u307f)\n/usr/bin/sensu-install -P disk-checks,cpu-checks,http, snmp\n```\n\n###Sensu\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u8a2d\u5b9a\n\n\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u7fa4\u3092\u8a2d\u7f6e\n\n```json:/etc/sensu/conf.d/check-cpu.json\n{\n  \"checks\": {\n    \"cpu\": {\n      \"command\": \"check-cpu.rb -w 80 -c 95\",\n      \"interval\": 10,\n      \"subscribers\": [\n        \"test\"\n      ]\n    }\n  }\n}\n```\n\n\u203b10\u5206\u3054\u3068\u306bCPU\u4f7f\u7528\u7387\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3001CPU\u4f7f\u7528\u7387\u304c80%\u4ee5\u4e0a\u3067\u8b66\u544a\u300195%\u4ee5\u4e0a\u3067\u81f4\u547d\u7684\u72b6\u614b\u3092\u901a\u77e5\n\n```json:/etc/sensu/conf.d/check-disk.json\n{\n  \"checks\": {\n    \"disk\": {\n      \"command\": \"check-disk-usage.rb -w 75 -c 90\",\n      \"interval\": 600,\n      \"subscribers\": [\n        \"test\"\n      ]\n    }\n  }\n}\n```\n\n\u203b10\u5206\u3054\u3068\u306b\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3001\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u304c80%\u4ee5\u4e0a\u3067\u8b66\u544a\u300195%\u4ee5\u4e0a\u3067\u81f4\u547d\u7684\u72b6\u614b\u3092\u901a\u77e5\n\n```json:/etc/sensu/conf.d/check-http.json\n{\n  \"checks\": {\n    \"http\": {\n      \"command\": \"check-http.rb -t 60 -u http://www.yahoo.co.jp\",\n      \"interval\": 600,\n      \"occurrences\": 3,\n      \"subscribers\": [\n        \"test\"\n      ]\n    }\n  }\n}\n```\n\n\u203b10\u5206\u3054\u3068\u306b http://www.yahoo.co.jp \u306b\u5bfe\u3057\u3066\u758e\u901a\u3092\u3057\u30013\u56de\u4ee5\u4e0a\u758e\u901a\u304c\u3067\u304d\u306a\u304b\u3063\u305f\u5834\u5408\u3001\u81f4\u547d\u7684\u72b6\u614b\u3092\u901a\u77e5\n\n###Sensu\u3068Uchiwa\u306e\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\u3068\u8d77\u52d5\n\n```bash\n/usr/bin/systemctl enable sensu-client sensu-server sensu-api uchiwa\n/usr/bin/systemctl start sensu-client sensu-server sensu-api uchiwa\n```\n\n###sensu-api\u306e\u52d5\u4f5c\u78ba\u8a8d\n\n\u4ee5\u4e0b\u306ecURL\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash\n$ curl -s http://AAA.BBB.CCC.DDD:4567/info | jq .\n{\n  \"sensu\": {\n    \"version\": \"0.26.3\"\n  },\n  \"transport\": {\n    \"keepalives\": {\n      \"messages\": 3,\n      \"consumers\": 1\n    },\n    \"results\": {\n      \"messages\": 0,\n      \"consumers\": 1\n    },\n    \"connected\": true\n  },\n  \"redis\": {\n    \"connected\": true\n  }\n}\n# \u3053\u308c\u306a\u3089OK\u3067\u3059\n```\n\n###Uchiwa\u306e\u52d5\u4f5c\u78ba\u8a8d\n\n\u30d6\u30e9\u30a6\u30b6\u3067\u3001 http://AAA.BBB.CCC.DDD:3000/ \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u4ee5\u4e0b\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308c\u3070OK\u3067\u3059\u3002\n\n![uchiwa.png](https://qiita-image-store.s3.amazonaws.com/0/37506/c261e72d-5cda-df5c-ab5f-f4a57f385aa8.png)\n\n\u53c2\u8003\u30ea\u30f3\u30af\n[\u30b5\u30fc\u30d0\u30fc\u76e3\u8996\u30c4\u30fc\u30eb Sensu](http://qiita.com/bezeklik/items/d026e9db4d5305165273)\n\n##Sensu\u53c2\u8003\u60c5\u5831\n\n###Slack\u7528\u901a\u77e5\u30cf\u30f3\u30c9\u30e9\n[sensu-plugins/sensu-plugins-slack](https://github.com/sensu-plugins/sensu-plugins-slack)\u3092\u5229\u7528\n\n```json:/opt/ansible/conf/slack-handler-notify.json\n{\n  \"handlers\": {\n    \"slack-notify\": {\n      \"type\": \"pipe\",\n      \"command\": \"handler-slack.rb -j slack-notify\"\n    }\n  },\n  \"slack-notify\": {\n    \"webhook_url\": \"https://hooks.slack.com/services/XXXXX\",\n    \"channel\": \"#any-channel\",\n    \"bot_name\": \"Sensu Bot\",\n    \"message_template\" : \"slack-template.erb\"\n  }\n}\n```\n\n###Sensu\u306e\u76e3\u8996\u8a2d\u5b9a\n\n```json:\u8a2d\u5b9a\u4f8b(check-cpu.json)\n{\n  \"checks\": {\n    \"cpu\": {\n      \"type\": \"standard\",\n      \"command\": \"check-cpu.rb -w 80 -c 95\",\n      \"interval\": 600,\n      \"occurrences\": 3,\n      \"subscribers\": [\n        \"common\"\n      ],\n      \"handlers\": [\n        \"slack\"\n      ]\n    }\n  }\n}\n```\n\n####\u76e3\u8996\u30bf\u30a4\u30d7(type)\n\n\u4ee5\u4e0b\u306e2\u30bf\u30a4\u30d7\u306e\u5185\u3044\u305a\u308c\u304b\u4f7f\u7528\u3059\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u306b\u5408\u81f4\u3057\u305f\u3082\u306e\u3092\u8a18\u8f09\u3059\u308b\n- standard\u30fb\u30fb\u30fb\u6a19\u6e96\u306echeck\u7528\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\n- metrics\u30fb\u30fb\u30fbmetircs\u7528\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\n\u6307\u5b9a\u306f\u3001\u300c\"metrics\"\u300d\u3067\u6307\u5b9a\u3059\u308b\n\u203b\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001\u300c\"standard\"\u300d\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\n\u203b\u7701\u529b\u3057\u305f\u5834\u5408\u306f\u3001\u300c\"standard\"\u300d\u304c\u6307\u5b9a\u3055\u308c\u308b\n\n####\u8a2d\u5b9a\u540d\n\n\u8a2d\u5b9a\u306e\u540d\u79f0\u3092\u3064\u3051\u308b\n\u203b\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001\u300ccpu\u300d\n\u203b\u7701\u7565\u306f\u3067\u304d\u306a\u3044\n\n####\u30b3\u30de\u30f3\u30c9(command)\n\n\u76e3\u8996\u306e\u969b\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u3066\u5b9f\u884c\u3055\u308c\u308b\u30b3\u30de\u30f3\u30c9\u3092\u6307\u5b9a\u3059\u308b\n\u203b\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001\u300ccheck-cpu.rb -w 80 -c 95\u300d\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\n\u203b\u7701\u7565\u306f\u3067\u304d\u306a\u3044(\u4f46\u3057\u3001\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u66f8\u3044\u3066\u3042\u308b\u901a\u308a\u300cextension\u300d\u3092\u6307\u5b9a\u3059\u308c\u3070\u7701\u7565\u306f\u3067\u304d\u308b)\n\n####\u9593\u9694(interval)\n\n\u76e3\u8996\u304c\u5b9f\u884c\u3055\u308c\u308b\u9593\u9694\u3092**\u79d2\u5358\u4f4d**\u6307\u5b9a\u3059\u308b\n\u203b\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001\u300c600\u300d(=600\u79d2=10\u5206)\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\n\u203b\u7701\u7565\u306f\u3067\u304d\u306a\u3044\n\n####\u95be\u5024(occurrences)\n\n\u76e3\u8996\u901a\u77e5\u306e\u95be\u5024\u3067\u3001\u95be\u5024\u56de\u6570\u7d99\u7d9a\u3057\u3066\u30a2\u30e9\u30fc\u30c8\u306e\u6761\u4ef6\u3092\u6e80\u305f\u3057\u305f\u5834\u5408\u306b\u30a2\u30e9\u30fc\u30c8\u901a\u77e5\u3055\u308c\u308b\n\u203b\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001\u300c3\u300d\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\n\u203b\u7701\u7565\u3057\u305f\u5834\u5408\u306f\u3001\u300c1\u300d\u304c\u6307\u5b9a\u3055\u308c\u308b\n\n####\u5bfe\u8c61\u30af\u30e9\u30a4\u30a2\u30f3\u30c8(subscribers)\n\n\u6307\u5b9a\u3055\u308c\u305fsubscribers\u306b\u5c5e\u3059\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u307f\u76e3\u8996\u5bfe\u8c61\u3068\u3055\u308c\u308b\n\u8907\u6570\u306e\u6307\u5b9a\u304c\u3067\u304d\u308b\n\u203b\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001\u300ccommon\u300d\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\n\u203b\u7701\u7565\u306f\u3067\u304d\u306a\u3044(\u4f46\u3057\u3001\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u66f8\u3044\u3066\u3042\u308b\u901a\u308a\u300cstandalone\u300d\u3092\u300ctrue\u300d\u306b\u6307\u5b9a\u3059\u308c\u3070\u7701\u7565\u306f\u3067\u304d\u308b)\n\n####\u901a\u77e5\u30cf\u30f3\u30c9\u30e9(handlers)\n\n\u901a\u77e5\u3092\u884c\u3046\u969b\u3001\u6307\u5b9a\u3055\u308c\u305f\u901a\u77e5\u30cf\u30f3\u30c9\u30e9\u3092\u4f7f\u7528\u3057\u3066\u901a\u77e5\u3055\u308c\u308b\n\u8907\u6570\u306e\u6307\u5b9a\u304c\u3067\u304d\u308b\n\u203b\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001\u300cslack\u300d\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\n\u203b\u7701\u7565\u3057\u305f\u5834\u5408\u306f\u3001/etc/sensu/config.json\u306e\u300chandlers\u300d\u306e\u300cdefault\u300d\u306e\u300chandlers\u300d\u306b\u8a2d\u5b9a\u3055\u308c\u305f\u901a\u77e5\u30cf\u30f3\u30c9\u30e9\u304c\u6307\u5b9a\u3055\u308c\u308b\n\n\u53c2\u8003\u30ea\u30f3\u30af\n[Sensu | Checks](https://sensuapp.org/docs/0.26/reference/checks.html)\n[Sensu | Plugins](https://sensuapp.org/docs/latest/reference/plugins)\n[Sensu\u306e\u76e3\u8996\u306e\u8a2d\u5b9a - \u3055\u3088\u306a\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8](http://blog.kenjiskywalker.org/blog/2014/05/03/sensu-monitoring-setting/)\n[\u7b2c361\u56de\u3000Sensu\u3067\u30b5\u30fc\u30d0\u30fc\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u53ef\u8996\u5316\u3057\u3088\u3046\uff1aUbuntu Weekly Recipe\uff5cgihyo.jp \u2026 \u6280\u8853\u8a55\u8ad6\u793e](http://gihyo.jp/admin/serial/01/ubuntu-recipe/0361)\n", "tags": ["Sensu", "uchiwa", "\u76e3\u8996"]}