{"tags": ["APIGateway", "AWS"], "context": " More than 1 year has passed since last update.Amazon API Gateway \u306e Integration Type \u306b\u306f\u3001\n1. Lambda Function\n2. HTTP Proxy\n3. AWS Service Proxy (Advanced)\n\u306e\uff13\u3064\u304c\u3042\u308b\u3002\n\uff13\u3064\u76ee\u306b\u3064\u3044\u3066\u306f\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306eWalkthrough: API Gateway and an AWS Service Proxy \u3067\u89e6\u308c\u3089\u308c\u3066\u3044\u308b\u304c\u3001\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u6e21\u3055\u305a\u306b ListTopics \u3092\u3059\u308b\u3060\u3051\u306e\u30b5\u30f3\u30d7\u30eb\u3068\u306a\u308a\u3001\u6b63\u76f4\u3042\u307e\u308a\u53c2\u8003\u306b\u306a\u3089\u306a\u3044\u3002\nSNS \u306e Publish \u3092\u4f8b\u3068\u3057\u3066\u3001API \u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4e0e\u3048\u308b\u306b\u306f\u3069\u3046\u3059\u308c\u3070\u3044\u3044\u306e\u304b\u3092\u691c\u8a3c\u3057\u305f\u3002\n\nPOST\u30e1\u30bd\u30c3\u30c9\u3092\u4f5c\u308b\n\u5148\u307b\u3069\u306eWalkThrough\u3067\u3044\u3046\u3001Step 2: Create the GET Method\u3067\u30012. For the HTTP method, choose GET, and then save your choice.\u306e\u4ee3\u308f\u308a\u306b\u3001POST\u30e1\u30bd\u30c3\u30c9\u3092\u4f5c\u6210\u3059\u308b\u3002\nStep 4: Specify Method Settings and Test the Method\u306e 6. For Action, type ListTopics. \u306e\u4ee3\u308f\u308a\u306b\u3001Publish \u3068\u3057\u3066\u304a\u304f\u3002\n\n\u3068\u308a\u3042\u3048\u305a Save \u3057\u3066 Test \u3092\u62bc\u3059\u3068\n{\n  \"Error\": {\n    \"Code\": \"InvalidParameter\",\n    \"Message\": \"Invalid parameter: TopicArn or TargetArn Reason: no value for required parameter\",\n    \"Type\": \"Sender\"\n  },\n  \"RequestId\": \"d2612a98-55d9-50ae-989d-64a2a1812b1c\"\n}\n\n\u3068\u3044\u3046\u30a8\u30e9\u30fc\u306b\u306a\u308b(\u307e\u3041\u305d\u3046\u3067\u3057\u3087\u3046\u3001TopicArn\u306f\u5fc5\u9808\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u3059\u3057)\u3002\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8db3\u3059\n\u30ed\u30b0\u3092\u898b\u3066\u307f\u308b\u3068\u3001\n\nEndpoint request URI: https://sns.us-west-2.amazonaws.com/?Action=Publish\n\n\u3068\u3001QueryString\u3067\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u6e21\u3057\u3066\u3044\u308b\u3088\u3046\u306a\u306e\u3067\u3001TopicArn\u3068Message\u3092\u4e0e\u3048\u3089\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u308b\u3002\n\u307e\u305a\u5165\u529b\u90e8\u5206\u306e MethodRequest \u306e URL Query String Parameters \u306b topicArn \u3068 message \u3092\u8db3\u3059\u3002\n\n\u6b21\u306bAPI\u30b3\u30fc\u30eb\u3092\u3059\u308b\u8a2d\u5b9a Integration Request \u306e URL Query String Parameters \u306b\u3001 TopicArn \u3068 Message \u3092\u8db3\u3059\u3002\n\n\n\u30c6\u30b9\u30c8\n\u518d\u5ea6 Test \u753b\u9762\u306b\u884c\u304d\u3001Query String \u306e message \u3068 topicArn \u3092\u5165\u529b (Request Body\u306f\u7a7a)\u3001Test\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3002\n\n\u3059\u308b\u3068\u3001\n{\n  \"PublishResponse\": {\n    \"PublishResult\": {\n      \"MessageId\": \"44c1e791-6722-5dca-a4c1-a9ab91bbd63e\"\n    },\n    \"ResponseMetadata\": {\n      \"RequestId\": \"c2f22e0a-04c7-51fc-be50-6030f25eca08\"\n    }\n  }\n}\n\n\u306e\u3088\u3046\u306a\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u8fd4\u308a\u3001SNS\u30e1\u30c3\u30bb\u30fc\u30b8\u304cPublish\u3055\u308c\u305f\u3002\nDeploy\u3057\u3066\u3001curl\u3067\u3082\u78ba\u304b\u3081\u308b\u3002\n$ curl -X POST 'https://xxxxxxxx.execute-api.us-west-2.amazonaws.com/dev/mydemoawsproxy?topicArn=arn:aws:sns:us-west-2:123456789012:apigw&message=HelloFromCurl'\n{\"PublishResponse\":{\"PublishResult\":{\"MessageId\":\"83f40b1c-82a6-550e-a542-4526758fc6a0\"},\"ResponseMetadata\":{\"RequestId\":\"d92f2d00-a890-5612-85a4-633a5fb9a5bc\"}}}\n\n\u7121\u4e8b\u306bPublish\u3059\u308b\u4e8b\u304c\u51fa\u6765\u305f\u3002\n\u3061\u306a\u307f\u306b\u30b9\u30da\u30fc\u30b9\u3092\u5165\u308c\u308b\u3068\u304d\u306f\u3001\uff13\u56de\u30a8\u30b9\u30b1\u30fc\u30d7\u3057\u306a\u304f\u3066\u306f\u3044\u3051\u306a\u3044\u3088\u3046\u3067\u3001\u30b9\u30da\u30fc\u30b9\uff11\u3064\u304c %252520 (-> %2520 -> %20 -> ' ') \u3068\u306a\u308b\u3002\n$ curl -X POST 'https://xxxxxxxx.execute-api.us-west-2.amazonaws.com/dev/mydemoawsproxy?topicArn=arn:aws:sns:us-west-2:123456789012:apigw&message=Hello%252520From%252520Curl'\n\n\nQueryString \u3058\u3083\u306a\u304f\u3066 Request Body \u3067\u6e21\u3057\u305f\u3044\uff1f\nAWS CLI\u3060\u3068\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306aJSON \u3092 Request Body \u3068\u3057\u3066 / \u306bPOST\u3057\u3066\u3044\u308b\u3088\u3046\u306a\u306e\u3067\u3001\u540c\u3058\u3088\u3046\u306b\u3084\u308a\u305f\u3044\u3002\n{'Action': u'Publish', u'Message': u'Hello from AWS CLI', 'Version': u'2010-03-31', u'TopicArn': u'arn:aws:sns:us-west-2:123456789012:apigw'}\n\u3068\u3053\u308d\u304c Integration Request \u306e Action Type \u304c Use action name \u3060\u3068 Action \u4ee5\u5916\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092JSON\u306b\u5165\u308c\u3066 Request Body\u306b\u5165\u308c\u3066\u9001\u3063\u3066\u3082\u7121\u8996\u3055\u308c\u3066\u3057\u307e\u3046\u3002\n\u305d\u3053\u3067 Use path override \u306b\u3057\u3066\u3001Path override \u3092 / \u306b\u3059\u308b\u3068\u3001\n\nEndpoint request URI: https://sns.us-west-2.amazonaws.com//\n\n\u306b POST \u3057\u3088\u3046\u3068\u3057\u3066\u3057\u307e\u3046\u3002\nPath override \u3092 ? \u306b\u3059\u308b\u3068\n\nEndpoint request URI: https://sns.us-west-2.amazonaws.com/?\n\n\u306b POST \u3067\u304d\u308b\u304c\u3001Signature\u304c\u30df\u30b9\u30de\u30c3\u30c1\u3068\u306a\u308b\u3002\nPath override \u3092\u7a7a\u6b04\u306b\u3059\u308b\u3068\n\nEndpoint request URI: https://sns.us-west-2.amazonaws.com/null\n\n\u306b POST \u3057\u3088\u3046\u3068\u3057\u3066\u3057\u307e\u3046\u3002\n\u3064\u307e\u308a\u3001 / \u306bPOST\u3059\u308b\u4e8b\u304c\u51fa\u6765\u306a\u3044 \uff1e\uff1c\n\u3069\u3046\u3059\u308c\u3070\u3044\u3044\u3093\u3067\u3057\u3087\u3046\u304b\u306d...\u30b3\u30ec\u3002\nPath override \u3092\u7a7a\u6b04\u306b\u3057\u305f\u3068\u304d\u306b https://sns.us-west-2.amazonaws.com/ \u306bPOST\u51fa\u6765\u308c\u3070\u3088\u3044\u306e\u3067\u3059\u304c\u3002\n\nAmazon API Gateway \u306e Integration Type \u306b\u306f\u3001\n1. Lambda Function\n2. HTTP Proxy\n3. AWS Service Proxy (Advanced)\n\n\u306e\uff13\u3064\u304c\u3042\u308b\u3002\n\uff13\u3064\u76ee\u306b\u3064\u3044\u3066\u306f\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e[Walkthrough: API Gateway and an AWS Service Proxy](https://docs.aws.amazon.com/apigateway/latest/developerguide/getting-started-aws-proxy.html) \u3067\u89e6\u308c\u3089\u308c\u3066\u3044\u308b\u304c\u3001\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u6e21\u3055\u305a\u306b ListTopics \u3092\u3059\u308b\u3060\u3051\u306e\u30b5\u30f3\u30d7\u30eb\u3068\u306a\u308a\u3001\u6b63\u76f4\u3042\u307e\u308a\u53c2\u8003\u306b\u306a\u3089\u306a\u3044\u3002\n\nSNS \u306e Publish \u3092\u4f8b\u3068\u3057\u3066\u3001API \u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4e0e\u3048\u308b\u306b\u306f\u3069\u3046\u3059\u308c\u3070\u3044\u3044\u306e\u304b\u3092\u691c\u8a3c\u3057\u305f\u3002\n\n## POST\u30e1\u30bd\u30c3\u30c9\u3092\u4f5c\u308b\n[\u5148\u307b\u3069\u306eWalkThrough](https://docs.aws.amazon.com/apigateway/latest/developerguide/getting-started-aws-proxy.html)\u3067\u3044\u3046\u3001[Step 2: Create the GET Method](https://docs.aws.amazon.com/apigateway/latest/developerguide/getting-started-aws-proxy.html#getting-started-aws-proxy-add-methods)\u3067\u3001```2. For the HTTP method, choose GET, and then save your choice.```\u306e\u4ee3\u308f\u308a\u306b\u3001POST\u30e1\u30bd\u30c3\u30c9\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n[Step 4: Specify Method Settings and Test the Method](https://docs.aws.amazon.com/apigateway/latest/developerguide/getting-started-aws-proxy.html#getting-started-aws-proxy-set-methods)\u306e ``` 6. For Action, type ListTopics. ``` \u306e\u4ee3\u308f\u308a\u306b\u3001Publish \u3068\u3057\u3066\u304a\u304f\u3002\n\n![screenshot](http://g.s3w.jp/aa3f0e1a)\n\n\u3068\u308a\u3042\u3048\u305a Save \u3057\u3066 Test \u3092\u62bc\u3059\u3068\n\n```json\n{\n  \"Error\": {\n    \"Code\": \"InvalidParameter\",\n    \"Message\": \"Invalid parameter: TopicArn or TargetArn Reason: no value for required parameter\",\n    \"Type\": \"Sender\"\n  },\n  \"RequestId\": \"d2612a98-55d9-50ae-989d-64a2a1812b1c\"\n}\n```\n\n\u3068\u3044\u3046\u30a8\u30e9\u30fc\u306b\u306a\u308b(\u307e\u3041\u305d\u3046\u3067\u3057\u3087\u3046\u3001TopicArn\u306f\u5fc5\u9808\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u3059\u3057)\u3002\n\n## \u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8db3\u3059\n\u30ed\u30b0\u3092\u898b\u3066\u307f\u308b\u3068\u3001\n> Endpoint request URI: https://sns.us-west-2.amazonaws.com/?Action=Publish\n\n\u3068\u3001QueryString\u3067\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u6e21\u3057\u3066\u3044\u308b\u3088\u3046\u306a\u306e\u3067\u3001TopicArn\u3068Message\u3092\u4e0e\u3048\u3089\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u308b\u3002\n\n\u307e\u305a\u5165\u529b\u90e8\u5206\u306e MethodRequest \u306e URL Query String Parameters \u306b topicArn \u3068 message \u3092\u8db3\u3059\u3002\n![screenshot](http://g.s3w.jp/aa3f0d14)\n\n\u6b21\u306bAPI\u30b3\u30fc\u30eb\u3092\u3059\u308b\u8a2d\u5b9a Integration Request \u306e URL Query String Parameters \u306b\u3001 TopicArn \u3068 Message \u3092\u8db3\u3059\u3002\n![screenshot](http://g.s3w.jp/aa3f0bf9)\n\n## \u30c6\u30b9\u30c8\n\n\u518d\u5ea6 Test \u753b\u9762\u306b\u884c\u304d\u3001Query String \u306e message \u3068 topicArn \u3092\u5165\u529b (Request Body\u306f\u7a7a)\u3001Test\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3002\n![screenshot](http://g.s3w.jp/aa3f0bb1)\n\n\u3059\u308b\u3068\u3001\n\n```json\n{\n  \"PublishResponse\": {\n    \"PublishResult\": {\n      \"MessageId\": \"44c1e791-6722-5dca-a4c1-a9ab91bbd63e\"\n    },\n    \"ResponseMetadata\": {\n      \"RequestId\": \"c2f22e0a-04c7-51fc-be50-6030f25eca08\"\n    }\n  }\n}\n```\n\n\u306e\u3088\u3046\u306a\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u8fd4\u308a\u3001SNS\u30e1\u30c3\u30bb\u30fc\u30b8\u304cPublish\u3055\u308c\u305f\u3002\n\nDeploy\u3057\u3066\u3001curl\u3067\u3082\u78ba\u304b\u3081\u308b\u3002\n\n```\n$ curl -X POST 'https://xxxxxxxx.execute-api.us-west-2.amazonaws.com/dev/mydemoawsproxy?topicArn=arn:aws:sns:us-west-2:123456789012:apigw&message=HelloFromCurl'\n{\"PublishResponse\":{\"PublishResult\":{\"MessageId\":\"83f40b1c-82a6-550e-a542-4526758fc6a0\"},\"ResponseMetadata\":{\"RequestId\":\"d92f2d00-a890-5612-85a4-633a5fb9a5bc\"}}}\n```\n\n\u7121\u4e8b\u306bPublish\u3059\u308b\u4e8b\u304c\u51fa\u6765\u305f\u3002\n\n\u3061\u306a\u307f\u306b\u30b9\u30da\u30fc\u30b9\u3092\u5165\u308c\u308b\u3068\u304d\u306f\u3001\uff13\u56de\u30a8\u30b9\u30b1\u30fc\u30d7\u3057\u306a\u304f\u3066\u306f\u3044\u3051\u306a\u3044\u3088\u3046\u3067\u3001\u30b9\u30da\u30fc\u30b9\uff11\u3064\u304c %252520 (-> %2520 -> %20 -> ' ') \u3068\u306a\u308b\u3002\n\n```\n$ curl -X POST 'https://xxxxxxxx.execute-api.us-west-2.amazonaws.com/dev/mydemoawsproxy?topicArn=arn:aws:sns:us-west-2:123456789012:apigw&message=Hello%252520From%252520Curl'\n```\n\n## QueryString \u3058\u3083\u306a\u304f\u3066 Request Body \u3067\u6e21\u3057\u305f\u3044\uff1f\nAWS CLI\u3060\u3068\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306aJSON \u3092 Request Body \u3068\u3057\u3066 / \u306bPOST\u3057\u3066\u3044\u308b\u3088\u3046\u306a\u306e\u3067\u3001\u540c\u3058\u3088\u3046\u306b\u3084\u308a\u305f\u3044\u3002\n\n```{'Action': u'Publish', u'Message': u'Hello from AWS CLI', 'Version': u'2010-03-31', u'TopicArn': u'arn:aws:sns:us-west-2:123456789012:apigw'}```\n\n\u3068\u3053\u308d\u304c Integration Request \u306e Action Type \u304c Use action name \u3060\u3068 Action \u4ee5\u5916\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092JSON\u306b\u5165\u308c\u3066 Request Body\u306b\u5165\u308c\u3066\u9001\u3063\u3066\u3082\u7121\u8996\u3055\u308c\u3066\u3057\u307e\u3046\u3002\n\u305d\u3053\u3067 Use path override \u306b\u3057\u3066\u3001Path override \u3092 / \u306b\u3059\u308b\u3068\u3001\n\n> Endpoint request URI: https://sns.us-west-2.amazonaws.com//\n\n\u306b POST \u3057\u3088\u3046\u3068\u3057\u3066\u3057\u307e\u3046\u3002\n\nPath override \u3092 ? \u306b\u3059\u308b\u3068\n> Endpoint request URI: https://sns.us-west-2.amazonaws.com/?\n\n\u306b POST \u3067\u304d\u308b\u304c\u3001Signature\u304c\u30df\u30b9\u30de\u30c3\u30c1\u3068\u306a\u308b\u3002\n\nPath override \u3092\u7a7a\u6b04\u306b\u3059\u308b\u3068\n> Endpoint request URI: https://sns.us-west-2.amazonaws.com/null\n\n\u306b POST \u3057\u3088\u3046\u3068\u3057\u3066\u3057\u307e\u3046\u3002\n\n\u3064\u307e\u308a\u3001 / \u306bPOST\u3059\u308b\u4e8b\u304c\u51fa\u6765\u306a\u3044 \uff1e\uff1c\n\u3069\u3046\u3059\u308c\u3070\u3044\u3044\u3093\u3067\u3057\u3087\u3046\u304b\u306d...\u30b3\u30ec\u3002\n\nPath override \u3092\u7a7a\u6b04\u306b\u3057\u305f\u3068\u304d\u306b https://sns.us-west-2.amazonaws.com/ \u306bPOST\u51fa\u6765\u308c\u3070\u3088\u3044\u306e\u3067\u3059\u304c\u3002\n"}