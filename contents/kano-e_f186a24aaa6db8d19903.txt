{"tags": ["Rails", "Rails5"], "context": " More than 1 year has passed since last update.\u540c\u6642\u5b9f\u884c\u306b\u306a\u3063\u305f\u6642\u306b\u304a\u304b\u3057\u304f\u306a\u3063\u3061\u3083\u3046\u3001\u3068\u3044\u3046\u305d\u306e\u70b9\u3067\u305a\u3063\u3068\u4f7f\u3048\u306a\u304b\u3063\u305f #increment! \u304c\u540c\u6642\u5b9f\u884c\u3092\u610f\u8b58\u3057\u305f\u51e6\u7406\u306b\u306a\u3063\u305f\u3088\uff01\n\u5b09\u3057\u3044\uff01 \u7d20\u6575\uff01\n\nrails4\n\nrails4\nirb(main):001:0> counter = Counter.create\n   (0.1ms)  begin transaction\n  SQL (0.4ms)  INSERT INTO \"counters\" (\"created_at\", \"updated_at\") VALUES (?, ?)  [[\"created_at\", \"2016-02-22 11:39:38.966295\"], [\"updated_at\", \"2016-02-22 11:39:38.966295\"]]\n   (1.9ms)  commit transaction\n=> #<Counter id: 4, value: nil, created_at: \"2016-02-22 11:39:38\", updated_at: \"2016-02-22 11:39:38\">\n\n\ndefault \u8a2d\u5b9a\u3057\u5fd8\u308c\u3066 nil \u306b\u306a\u3063\u3066\u3044\u308b\u3051\u308c\u3069\u3082 value \u306f integer \u3067\u3059\u3002\n\u3053\u306e value \u3092 #increment! \u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nrails4\nirb(main):004:0> counter.increment!(:value)\n   (0.1ms)  begin transaction\n  SQL (0.3ms)  UPDATE \"counters\" SET \"value\" = ?, \"updated_at\" = ? WHERE \"counters\".\"id\" = ?  [[\"value\", 1], [\"updated_at\", \"2016-02-22 11:40:48.595257\"], [\"id\", 4]]\n   (2.7ms)  commit transaction\n=> true\n\n\n\u5b9f\u884c\u3055\u308c\u305f SQL \u3092\u898b\u308b\u3068 value \u306b 1 \u304c\u6307\u5b9a\u3055\u308c\u3066\u308b\u306e\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\u3053\u306e 1 \u306f\u3001\u3069\u3053\u304b\u3089\u304d\u305f\u304b\u3063\u3066\u3044\u3046\u3068\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3066\u3044\u308b value \u306e\u5024\u3092\u5143\u306b\u8a08\u7b97\u3055\u308c\u3066\u308b\u3093\u3067\u3059\u306d\u3002\n\u3064\u307e\u308a\u3053\u308c\u306f\u3069\u3046\u3044\u3046\u3053\u3068\u304b\u3063\u3066\u3044\u3046\u3068\u3001\n\nrails4\nirb(main):005:0> counter1 = Counter.find(4)\n  Counter Load (0.2ms)  SELECT  \"counters\".* FROM \"counters\" WHERE \"counters\".\"id\" = ? LIMIT 1  [[\"id\", 4]]\n=> #<Counter id: 4, value: 1, created_at: \"2016-02-22 11:39:38\", updated_at: \"2016-02-22 11:40:48\">\nirb(main):006:0> counter2 = Counter.find(4)\n  Counter Load (0.1ms)  SELECT  \"counters\".* FROM \"counters\" WHERE \"counters\".\"id\" = ? LIMIT 1  [[\"id\", 4]]\n=> #<Counter id: 4, value: 1, created_at: \"2016-02-22 11:39:38\", updated_at: \"2016-02-22 11:40:48\">\n\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u3001\u540c\u4e00\u30ec\u30b3\u30fc\u30c9\u304b\u3089\u751f\u6210\u3055\u308c\u305f\u5225\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u3044\u308b\u6642\u306b\u3001\u305d\u308c\u305e\u308c\u3067\u540c\u6642\u306b #increment! \u3057\u305f\u3089\u3069\u3046\u306a\u308b\u304b\u3063\u3066\u3053\u3068\u3067\u3059\u3002\n\nrails4\nirb(main):007:0> counter1.increment!(:value)\n   (0.1ms)  begin transaction\n  SQL (0.3ms)  UPDATE \"counters\" SET \"value\" = ?, \"updated_at\" = ? WHERE \"counters\".\"id\" = ?  [[\"value\", 2], [\"updated_at\", \"2016-02-22 11:43:39.842789\"], [\"id\", 4]]\n   (1.8ms)  commit transaction\n=> true\nirb(main):008:0> counter2.increment!(:value)\n   (0.1ms)  begin transaction\n  SQL (0.3ms)  UPDATE \"counters\" SET \"value\" = ?, \"updated_at\" = ? WHERE \"counters\".\"id\" = ?  [[\"value\", 2], [\"updated_at\", \"2016-02-22 11:43:45.706247\"], [\"id\", 4]]\n   (1.7ms)  commit transaction\n=> true\n\n\nvalue \u304c 1 \u306e\u72b6\u614b\u304b\u3089 #increment! \u306f 2\u56de\u547c\u3070\u308c\u307e\u3057\u305f\u3002\nvalue \u304c 3 \u306b\u306a\u3063\u3066\u3044\u3066\u6b32\u3057\u3044\u306e\u3067\u3059\u304c\u3001\u5b9f\u969b\u306b\u306f 2 \u3067\u3059  \nirb(main):011:0> Counter.find(4).value\n  Counter Load (0.1ms)  SELECT  \"counters\".* FROM \"counters\" WHERE \"counters\".\"id\" = ? LIMIT 1  [[\"id\", 4]]\n=> 2\n\n\u3053\u306e\u540c\u6642\u5b9f\u884c\u306b #decrement! \u304c\u6df7\u3056\u3063\u3066\u304f\u308b\u3068\u3001\u3082\u3046\u4f55\u304c\u4f55\u3084\u3089\u3067\u3059\u3002\n\nrails4\nirb(main):024:0> counter1.increment!(:value, 10)\n   (0.1ms)  begin transaction\n  SQL (0.3ms)  UPDATE \"counters\" SET \"value\" = ?, \"updated_at\" = ? WHERE \"counters\".\"id\" = ?  [[\"value\", 12], [\"updated_at\", \"2016-02-22 11:50:37.442805\"], [\"id\", 4]]\n   (1.8ms)  commit transaction\n=> true\nirb(main):025:0> counter2.increment!(:value, 20)\n   (0.1ms)  begin transaction\n  SQL (0.3ms)  UPDATE \"counters\" SET \"value\" = ?, \"updated_at\" = ? WHERE \"counters\".\"id\" = ?  [[\"value\", 22], [\"updated_at\", \"2016-02-22 11:50:52.249161\"], [\"id\", 4]]\n   (1.7ms)  commit transaction\n=> true\nirb(main):026:0> counter1.decrement!(:value, 10)\n   (0.1ms)  begin transaction\n  SQL (0.3ms)  UPDATE \"counters\" SET \"value\" = ?, \"updated_at\" = ? WHERE \"counters\".\"id\" = ?  [[\"value\", 2], [\"updated_at\", \"2016-02-22 11:51:04.072007\"], [\"id\", 4]]\n   (2.7ms)  commit transaction\n=> true\nirb(main):027:0> Counter.find(4).value\n  Counter Load (0.1ms)  SELECT  \"counters\".* FROM \"counters\" WHERE \"counters\".\"id\" = ? LIMIT 1  [[\"id\", 4]]\n=> 2\n\n\n20 \u306f\u3069\u3053\u306b\u6d88\u3048\u305f  \n\nrails5\n\u3055\u3042\u3001\u540c\u3058\u3088\u3046\u306b Counter \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\n\nrails5\nirb(main):001:0> counter = Counter.create\n   (0.1ms)  begin transaction\n  SQL (0.4ms)  INSERT INTO \"counters\" (\"created_at\", \"updated_at\") VALUES (?, ?)  [[\"created_at\", 2016-02-22 11:47:23 UTC], [\"updated_at\", 2016-02-22 11:47:23 UTC]]\n   (2.9ms)  commit transaction\n=> #<Counter id: 5, value: nil, created_at: \"2016-02-22 11:47:23\", updated_at: \"2016-02-22 11:47:23\">\n\n\n\u304a\u3082\u3080\u308d\u306b #increment! \u3057\u307e\u3057\u3087\u3046\u3002\n\nrails5\nirb(main):002:0> counter.increment!(:value)\n  SQL (3.2ms)  UPDATE \"counters\" SET \"value\" = COALESCE(\"value\", 0) + 1 WHERE \"counters\".\"id\" = ?  [[\"id\", 5]]\n=> #<Counter id: 5, value: 1, created_at: \"2016-02-22 11:47:23\", updated_at: \"2016-02-22 11:47:23\">\n\n\n\u767a\u884c\u3055\u308c\u305f SQL \u3092\u898b\u308b\u3068 UPDATE \u6587\u304c\u5909\u308f\u3063\u305f\u306e\u304c\u308f\u304b\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\"value\" = COALESCE(\"value\", 0) + 1 \u3068\u306a\u3063\u3066\u3044\u307e\u3059\u306d(\u5b09\n\u5148\u307b\u3069\u3068\u540c\u3058\u3088\u3046\u306b\u3001\u540c\u4e00\u306e\u30ec\u30b3\u30fc\u30c9\u304b\u3089\u751f\u6210\u3055\u308c\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8907\u6570\u4f5c\u3063\u3066\u64cd\u4f5c\u3057\u3066\u307f\u307e\u3059\u3002\n\nrails5\nirb(main):003:0> counter1 = Counter.find(5)\n  Counter Load (0.2ms)  SELECT  \"counters\".* FROM \"counters\" WHERE \"counters\".\"id\" = ? LIMIT ?  [[\"id\", 5], [\"LIMIT\", 1]]\n=> #<Counter id: 5, value: 1, created_at: \"2016-02-22 11:47:23\", updated_at: \"2016-02-22 11:47:23\">\nirb(main):004:0> counter2 = Counter.find(5)\n  Counter Load (0.2ms)  SELECT  \"counters\".* FROM \"counters\" WHERE \"counters\".\"id\" = ? LIMIT ?  [[\"id\", 5], [\"LIMIT\", 1]]\n=> #<Counter id: 5, value: 1, created_at: \"2016-02-22 11:47:23\", updated_at: \"2016-02-22 11:47:23\">\n\nirb(main):005:0> counter1.increment!(:value)\n  SQL (2.1ms)  UPDATE \"counters\" SET \"value\" = COALESCE(\"value\", 0) + 1 WHERE \"counters\".\"id\" = ?  [[\"id\", 5]]\n=> #<Counter id: 5, value: 2, created_at: \"2016-02-22 11:47:23\", updated_at: \"2016-02-22 11:47:23\">\nirb(main):006:0> counter2.increment!(:value)\n  SQL (2.1ms)  UPDATE \"counters\" SET \"value\" = COALESCE(\"value\", 0) + 1 WHERE \"counters\".\"id\" = ?  [[\"id\", 5]]\n=> #<Counter id: 5, value: 2, created_at: \"2016-02-22 11:47:23\", updated_at: \"2016-02-22 11:47:23\">\nirb(main):007:0> Counter.find(5).value\n  Counter Load (0.2ms)  SELECT  \"counters\".* FROM \"counters\" WHERE \"counters\".\"id\" = ? LIMIT ?  [[\"id\", 5], [\"LIMIT\", 1]]\n=> 3\n\n\n\u4eca\u5ea6\u306f\u3061\u3083\u3093\u3068 value \u304c 3 \u306b\u306a\u3063\u3066\u3044\u307e\u3059  \n#decrement! \u3060\u3063\u3066\u5927\u4e08\u592b\uff01\n\nrails5\nirb(main):008:0> counter1.increment!(:value, 10)\n  SQL (2.2ms)  UPDATE \"counters\" SET \"value\" = COALESCE(\"value\", 0) + 10 WHERE \"counters\".\"id\" = ?  [[\"id\", 5]]\n=> #<Counter id: 5, value: 12, created_at: \"2016-02-22 11:47:23\", updated_at: \"2016-02-22 11:47:23\">\nirb(main):009:0> counter2.increment!(:value, 20)\n  SQL (2.2ms)  UPDATE \"counters\" SET \"value\" = COALESCE(\"value\", 0) + 20 WHERE \"counters\".\"id\" = ?  [[\"id\", 5]]\n=> #<Counter id: 5, value: 22, created_at: \"2016-02-22 11:47:23\", updated_at: \"2016-02-22 11:47:23\">\nirb(main):010:0> counter1.decrement!(:value, 10)\n  SQL (2.2ms)  UPDATE \"counters\" SET \"value\" = COALESCE(\"value\", 0) - 10 WHERE \"counters\".\"id\" = ?  [[\"id\", 5]]\n=> #<Counter id: 5, value: 2, created_at: \"2016-02-22 11:47:23\", updated_at: \"2016-02-22 11:47:23\">\nirb(main):011:0> Counter.find(5).value\n  Counter Load (0.2ms)  SELECT  \"counters\".* FROM \"counters\" WHERE \"counters\".\"id\" = ? LIMIT ?  [[\"id\", 5], [\"LIMIT\", 1]]\n=> 23\n\n\n\u305f\u3060\u3057 #increment! \u3084 #decrement! \u3057\u305f\u5f8c\u306f\u3001\u300c\u5b9f\u969b\u306b DB \u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\u5024\u300d\u3068\u300c\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u300d\u306b\u30ba\u30ec\u304c\u51fa\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u3068\u3044\u3046\u306e\u306f\u3001\u610f\u8b58\u3057\u3066\u304a\u3044\u305f\u65b9\u304c\u826f\u3055\u305d\u3046\u3067\u3059\u3002\n\nrails5\nirb(main):012:0> counter1.value\n=> 2\nirb(main):013:0> counter2.value\n=> 22\n\n\n\u540c\u6642\u5b9f\u884c\u306b\u306a\u3063\u305f\u6642\u306b\u304a\u304b\u3057\u304f\u306a\u3063\u3061\u3083\u3046\u3001\u3068\u3044\u3046\u305d\u306e\u70b9\u3067\u305a\u3063\u3068\u4f7f\u3048\u306a\u304b\u3063\u305f `#increment!` \u304c\u540c\u6642\u5b9f\u884c\u3092\u610f\u8b58\u3057\u305f\u51e6\u7406\u306b\u306a\u3063\u305f\u3088\uff01\n\u5b09\u3057\u3044\uff01 \u7d20\u6575\uff01\n\n## rails4\n\n```irb:rails4\nirb(main):001:0> counter = Counter.create\n   (0.1ms)  begin transaction\n  SQL (0.4ms)  INSERT INTO \"counters\" (\"created_at\", \"updated_at\") VALUES (?, ?)  [[\"created_at\", \"2016-02-22 11:39:38.966295\"], [\"updated_at\", \"2016-02-22 11:39:38.966295\"]]\n   (1.9ms)  commit transaction\n=> #<Counter id: 4, value: nil, created_at: \"2016-02-22 11:39:38\", updated_at: \"2016-02-22 11:39:38\">\n```\n\ndefault \u8a2d\u5b9a\u3057\u5fd8\u308c\u3066 nil \u306b\u306a\u3063\u3066\u3044\u308b\u3051\u308c\u3069\u3082 `value` \u306f `integer` \u3067\u3059\u3002\n\u3053\u306e `value` \u3092 `#increment!` \u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n```irb:rails4\nirb(main):004:0> counter.increment!(:value)\n   (0.1ms)  begin transaction\n  SQL (0.3ms)  UPDATE \"counters\" SET \"value\" = ?, \"updated_at\" = ? WHERE \"counters\".\"id\" = ?  [[\"value\", 1], [\"updated_at\", \"2016-02-22 11:40:48.595257\"], [\"id\", 4]]\n   (2.7ms)  commit transaction\n=> true\n```\n\n\u5b9f\u884c\u3055\u308c\u305f SQL \u3092\u898b\u308b\u3068 value \u306b 1 \u304c\u6307\u5b9a\u3055\u308c\u3066\u308b\u306e\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\u3053\u306e `1` \u306f\u3001\u3069\u3053\u304b\u3089\u304d\u305f\u304b\u3063\u3066\u3044\u3046\u3068\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3066\u3044\u308b value \u306e\u5024\u3092\u5143\u306b\u8a08\u7b97\u3055\u308c\u3066\u308b\u3093\u3067\u3059\u306d\u3002\n\n\u3064\u307e\u308a\u3053\u308c\u306f\u3069\u3046\u3044\u3046\u3053\u3068\u304b\u3063\u3066\u3044\u3046\u3068\u3001\n\n```irb:rails4\nirb(main):005:0> counter1 = Counter.find(4)\n  Counter Load (0.2ms)  SELECT  \"counters\".* FROM \"counters\" WHERE \"counters\".\"id\" = ? LIMIT 1  [[\"id\", 4]]\n=> #<Counter id: 4, value: 1, created_at: \"2016-02-22 11:39:38\", updated_at: \"2016-02-22 11:40:48\">\nirb(main):006:0> counter2 = Counter.find(4)\n  Counter Load (0.1ms)  SELECT  \"counters\".* FROM \"counters\" WHERE \"counters\".\"id\" = ? LIMIT 1  [[\"id\", 4]]\n=> #<Counter id: 4, value: 1, created_at: \"2016-02-22 11:39:38\", updated_at: \"2016-02-22 11:40:48\">\n```\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u3001\u540c\u4e00\u30ec\u30b3\u30fc\u30c9\u304b\u3089\u751f\u6210\u3055\u308c\u305f\u5225\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u3044\u308b\u6642\u306b\u3001\u305d\u308c\u305e\u308c\u3067\u540c\u6642\u306b `#increment!` \u3057\u305f\u3089\u3069\u3046\u306a\u308b\u304b\u3063\u3066\u3053\u3068\u3067\u3059\u3002\n\n```irb:rails4\nirb(main):007:0> counter1.increment!(:value)\n   (0.1ms)  begin transaction\n  SQL (0.3ms)  UPDATE \"counters\" SET \"value\" = ?, \"updated_at\" = ? WHERE \"counters\".\"id\" = ?  [[\"value\", 2], [\"updated_at\", \"2016-02-22 11:43:39.842789\"], [\"id\", 4]]\n   (1.8ms)  commit transaction\n=> true\nirb(main):008:0> counter2.increment!(:value)\n   (0.1ms)  begin transaction\n  SQL (0.3ms)  UPDATE \"counters\" SET \"value\" = ?, \"updated_at\" = ? WHERE \"counters\".\"id\" = ?  [[\"value\", 2], [\"updated_at\", \"2016-02-22 11:43:45.706247\"], [\"id\", 4]]\n   (1.7ms)  commit transaction\n=> true\n```\n\n`value` \u304c 1 \u306e\u72b6\u614b\u304b\u3089 `#increment!` \u306f 2\u56de\u547c\u3070\u308c\u307e\u3057\u305f\u3002\n`value` \u304c 3 \u306b\u306a\u3063\u3066\u3044\u3066\u6b32\u3057\u3044\u306e\u3067\u3059\u304c\u3001\u5b9f\u969b\u306b\u306f 2 \u3067\u3059 :worried: \n\n```\nirb(main):011:0> Counter.find(4).value\n  Counter Load (0.1ms)  SELECT  \"counters\".* FROM \"counters\" WHERE \"counters\".\"id\" = ? LIMIT 1  [[\"id\", 4]]\n=> 2\n```\n\n\u3053\u306e\u540c\u6642\u5b9f\u884c\u306b `#decrement!` \u304c\u6df7\u3056\u3063\u3066\u304f\u308b\u3068\u3001\u3082\u3046\u4f55\u304c\u4f55\u3084\u3089\u3067\u3059\u3002\n\n```irb:rails4\nirb(main):024:0> counter1.increment!(:value, 10)\n   (0.1ms)  begin transaction\n  SQL (0.3ms)  UPDATE \"counters\" SET \"value\" = ?, \"updated_at\" = ? WHERE \"counters\".\"id\" = ?  [[\"value\", 12], [\"updated_at\", \"2016-02-22 11:50:37.442805\"], [\"id\", 4]]\n   (1.8ms)  commit transaction\n=> true\nirb(main):025:0> counter2.increment!(:value, 20)\n   (0.1ms)  begin transaction\n  SQL (0.3ms)  UPDATE \"counters\" SET \"value\" = ?, \"updated_at\" = ? WHERE \"counters\".\"id\" = ?  [[\"value\", 22], [\"updated_at\", \"2016-02-22 11:50:52.249161\"], [\"id\", 4]]\n   (1.7ms)  commit transaction\n=> true\nirb(main):026:0> counter1.decrement!(:value, 10)\n   (0.1ms)  begin transaction\n  SQL (0.3ms)  UPDATE \"counters\" SET \"value\" = ?, \"updated_at\" = ? WHERE \"counters\".\"id\" = ?  [[\"value\", 2], [\"updated_at\", \"2016-02-22 11:51:04.072007\"], [\"id\", 4]]\n   (2.7ms)  commit transaction\n=> true\nirb(main):027:0> Counter.find(4).value\n  Counter Load (0.1ms)  SELECT  \"counters\".* FROM \"counters\" WHERE \"counters\".\"id\" = ? LIMIT 1  [[\"id\", 4]]\n=> 2\n```\n\n20 \u306f\u3069\u3053\u306b\u6d88\u3048\u305f :worried: \n\n## rails5\n\n\u3055\u3042\u3001\u540c\u3058\u3088\u3046\u306b Counter \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n```irb:rails5\nirb(main):001:0> counter = Counter.create\n   (0.1ms)  begin transaction\n  SQL (0.4ms)  INSERT INTO \"counters\" (\"created_at\", \"updated_at\") VALUES (?, ?)  [[\"created_at\", 2016-02-22 11:47:23 UTC], [\"updated_at\", 2016-02-22 11:47:23 UTC]]\n   (2.9ms)  commit transaction\n=> #<Counter id: 5, value: nil, created_at: \"2016-02-22 11:47:23\", updated_at: \"2016-02-22 11:47:23\">\n```\n\n\u304a\u3082\u3080\u308d\u306b `#increment!` \u3057\u307e\u3057\u3087\u3046\u3002\n\n```irb:rails5\nirb(main):002:0> counter.increment!(:value)\n  SQL (3.2ms)  UPDATE \"counters\" SET \"value\" = COALESCE(\"value\", 0) + 1 WHERE \"counters\".\"id\" = ?  [[\"id\", 5]]\n=> #<Counter id: 5, value: 1, created_at: \"2016-02-22 11:47:23\", updated_at: \"2016-02-22 11:47:23\">\n```\n\n\u767a\u884c\u3055\u308c\u305f SQL \u3092\u898b\u308b\u3068 UPDATE \u6587\u304c\u5909\u308f\u3063\u305f\u306e\u304c\u308f\u304b\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n`\"value\" = COALESCE(\"value\", 0) + 1` \u3068\u306a\u3063\u3066\u3044\u307e\u3059\u306d(\u5b09\n\n\u5148\u307b\u3069\u3068\u540c\u3058\u3088\u3046\u306b\u3001\u540c\u4e00\u306e\u30ec\u30b3\u30fc\u30c9\u304b\u3089\u751f\u6210\u3055\u308c\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8907\u6570\u4f5c\u3063\u3066\u64cd\u4f5c\u3057\u3066\u307f\u307e\u3059\u3002\n\n```irb:rails5\nirb(main):003:0> counter1 = Counter.find(5)\n  Counter Load (0.2ms)  SELECT  \"counters\".* FROM \"counters\" WHERE \"counters\".\"id\" = ? LIMIT ?  [[\"id\", 5], [\"LIMIT\", 1]]\n=> #<Counter id: 5, value: 1, created_at: \"2016-02-22 11:47:23\", updated_at: \"2016-02-22 11:47:23\">\nirb(main):004:0> counter2 = Counter.find(5)\n  Counter Load (0.2ms)  SELECT  \"counters\".* FROM \"counters\" WHERE \"counters\".\"id\" = ? LIMIT ?  [[\"id\", 5], [\"LIMIT\", 1]]\n=> #<Counter id: 5, value: 1, created_at: \"2016-02-22 11:47:23\", updated_at: \"2016-02-22 11:47:23\">\n\nirb(main):005:0> counter1.increment!(:value)\n  SQL (2.1ms)  UPDATE \"counters\" SET \"value\" = COALESCE(\"value\", 0) + 1 WHERE \"counters\".\"id\" = ?  [[\"id\", 5]]\n=> #<Counter id: 5, value: 2, created_at: \"2016-02-22 11:47:23\", updated_at: \"2016-02-22 11:47:23\">\nirb(main):006:0> counter2.increment!(:value)\n  SQL (2.1ms)  UPDATE \"counters\" SET \"value\" = COALESCE(\"value\", 0) + 1 WHERE \"counters\".\"id\" = ?  [[\"id\", 5]]\n=> #<Counter id: 5, value: 2, created_at: \"2016-02-22 11:47:23\", updated_at: \"2016-02-22 11:47:23\">\nirb(main):007:0> Counter.find(5).value\n  Counter Load (0.2ms)  SELECT  \"counters\".* FROM \"counters\" WHERE \"counters\".\"id\" = ? LIMIT ?  [[\"id\", 5], [\"LIMIT\", 1]]\n=> 3\n```\n\n\u4eca\u5ea6\u306f\u3061\u3083\u3093\u3068 value \u304c 3 \u306b\u306a\u3063\u3066\u3044\u307e\u3059 :smile: \n\n`#decrement!` \u3060\u3063\u3066\u5927\u4e08\u592b\uff01\n\n```irb:rails5\nirb(main):008:0> counter1.increment!(:value, 10)\n  SQL (2.2ms)  UPDATE \"counters\" SET \"value\" = COALESCE(\"value\", 0) + 10 WHERE \"counters\".\"id\" = ?  [[\"id\", 5]]\n=> #<Counter id: 5, value: 12, created_at: \"2016-02-22 11:47:23\", updated_at: \"2016-02-22 11:47:23\">\nirb(main):009:0> counter2.increment!(:value, 20)\n  SQL (2.2ms)  UPDATE \"counters\" SET \"value\" = COALESCE(\"value\", 0) + 20 WHERE \"counters\".\"id\" = ?  [[\"id\", 5]]\n=> #<Counter id: 5, value: 22, created_at: \"2016-02-22 11:47:23\", updated_at: \"2016-02-22 11:47:23\">\nirb(main):010:0> counter1.decrement!(:value, 10)\n  SQL (2.2ms)  UPDATE \"counters\" SET \"value\" = COALESCE(\"value\", 0) - 10 WHERE \"counters\".\"id\" = ?  [[\"id\", 5]]\n=> #<Counter id: 5, value: 2, created_at: \"2016-02-22 11:47:23\", updated_at: \"2016-02-22 11:47:23\">\nirb(main):011:0> Counter.find(5).value\n  Counter Load (0.2ms)  SELECT  \"counters\".* FROM \"counters\" WHERE \"counters\".\"id\" = ? LIMIT ?  [[\"id\", 5], [\"LIMIT\", 1]]\n=> 23\n```\n\n\u305f\u3060\u3057 `#increment!` \u3084 `#decrement!` \u3057\u305f\u5f8c\u306f\u3001\u300c\u5b9f\u969b\u306b DB \u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\u5024\u300d\u3068\u300c\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u300d\u306b\u30ba\u30ec\u304c\u51fa\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u3068\u3044\u3046\u306e\u306f\u3001\u610f\u8b58\u3057\u3066\u304a\u3044\u305f\u65b9\u304c\u826f\u3055\u305d\u3046\u3067\u3059\u3002\n\n```irb:rails5\nirb(main):012:0> counter1.value\n=> 2\nirb(main):013:0> counter2.value\n=> 22\n```\n"}