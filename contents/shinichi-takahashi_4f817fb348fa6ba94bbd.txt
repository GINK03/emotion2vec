{"context": "\u3053\u3093\u3061\u3083\u3002\n\nCodeCommit\u3063\u3066\u306a\u306b\uff1f\nAWS\u306eGit\u30b5\u30fc\u30d3\u30b9\u3002\u4eca\u306e\u3068\u3053\u308dus-east-1\u3067\u3057\u304b\u4f7f\u3048\u306a\u3044\u3002\n\nTriggers\u3063\u3066\u306a\u306b\uff1f\n\u3044\u308f\u3086\u308bWebHooks\n\u524d\u8abf\u3079\u305f\u3068\u304d\u306f\u4f7f\u3048\u306a\u304b\u3063\u305f\u6a5f\u80fd\u3060\u3051\u30693\u6708\u304f\u3089\u3044\u306b\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3089\u3057\u3044\nhttps://aws.amazon.com/jp/blogs/aws/new-notifications-for-aws-codecommit/\n\n\u3084\u3063\u305f\u3053\u3068\n\nTrigger\u306e\u53d7\u3051\u53e3\u306eLambda\u3064\u304f\u308b\n\u6a29\u9650\u5468\u308a\u30b3\u30cd\u30b3\u30cd\u3059\u308b\nCodeCommit\u3067Repository\u305f\u3066\u308b\nCodeCommit\u3067Trigger\u8a2d\u5b9a\u3059\u308b\nCloudWatchLogs\u898b\u308b\n\n\nTrigger\u306e\u53d7\u3051\u53e3\u306eLambda\u3064\u304f\u308b\nWebHooks\u52d5\u304f\u306e\u304b\u898b\u305f\u3044\u3060\u3051\u306a\u306e\u3067\u3068\u308a\u3042\u3048\u305a\u53d7\u3051\u53d6\u3063\u305f\u30a4\u30d9\u30f3\u30c8\u5f15\u6570\u3092\u8fd4\u3059\u3060\u3051\u306e\u5b58\u5728\u3059\u308b\u4fa1\u5024\u306e\u306a\u3044\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u6210\u3002\u4e2d\u8eab\u304c\u898b\u308c\u308c\u3070\u306a\u3093\u3067\u3082\u3044\u3044\u3002\ndef lambda_handler(event, context):\n    print event\n    return event\n\n\n\u6a29\u9650\u5468\u308a\u30b3\u30cd\u30b3\u30cd\u3059\u308b\naws cli\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\uff8e\uff9f\uff81\uff70\n${Hoge}\u306f\u3001\u9069\u5b9c\u66f8\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\u306d\naws lambda add-permission \\\n--region us-east-1 \\\n--function-name ${LambdaFunctionName} \\\n--statement-id 1 \\\n--principal codecommit.amazonaws.com \\\n--action lambda:InvokeFunction \\\n--source-arn arn:aws:codecommit:us-east-1:${Account}:${Repository} \\\n--source-account ${Account} \\\n--profile default\n\n\nLambda\u306eRole\u306f\u3053\u3093\u306a\u611f\u3058\u306b\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"Stmt1462604551000\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"codecommit:*\"\n            ],\n            \"Resource\": [\n                \"arn:aws:codecommit:us-east-1:${Account}:${Repository}\"\n            ]\n        }\n    ]\n}\n\n\u3076\u3063\u3061\u3083\u3051\u3053\u306e\u8fba\u3088\u304f\u308f\u304b\u3063\u3066\u306a\u3044\n\nCodeCommit\u3067Repository\u305f\u3066\u308b\nRepository\u540d\u5165\u529b\u3057\u3066\u9069\u5f53\u306b\u3064\u304f\u3063\u3066\u304f\u3060\u3055\u3044\u3002\n\u5b8c\n\nCodeCommit\u3067Trigger\u8a2d\u5b9a\u3059\u308b\n\u4f5c\u6210\u3057\u305fRepository\u306e\u5de6\u30e1\u30cb\u30e5\u30fc\u304b\u3089 Triggers -> Create Trigger \u3092\u30dd\u30c1\u30c3\n\n\nTrigger name: \u30c8\u30ea\u30ac\u30fc\u306e\u540d\u524d\u3002\u304a\u597d\u304d\u306b\u3002\nEvents: \u5f15\u3063\u639b\u3051\u305f\u3044\u30a4\u30d9\u30f3\u30c8\u3092\u6307\u5b9a\u3002\u4ee5\u4e0b\u304b\u3089\u9078\u3076\u3002\n\n\u5168\u30a4\u30d9\u30f3\u30c8\n\u65e2\u5b58\u30d6\u30e9\u30f3\u30c1\u306b\u30d7\u30c3\u30b7\u30e5\n\u65b0\u898f\u30d6\u30e9\u30f3\u30c1\u30fb\u30bf\u30b0\u306e\u4f5c\u6210\n\u30d6\u30e9\u30f3\u30c1\u30fb\u30bf\u30b0\u306e\u524a\u9664\n\n\nBranch names: \u53cd\u5fdc\u3055\u305b\u305f\u3044\u30d6\u30e9\u30f3\u30c1\u3092\u6307\u5b9a\u3002dev\u30d6\u30e9\u30f3\u30c1\u3060\u3051\u3001\u307f\u305f\u3044\u306a\u4f7f\u3044\u65b9\u3059\u308b\u3093\u3061\u3083\u3046\u3093\u3059\u304b\u306d\nSend to: \u4eca\u56de\u306f AWS Lambda \u3092\u9078\u629e\u3002\nLambda function: \u3055\u3063\u304d\u4f5c\u3063\u305fLambdaFunction\u304c\u51fa\u3066\u304d\u3066\u308b\u306f\u305a\u306a\u306e\u3067\u3001\u305d\u308c\u3092\u9078\u3076\nCustom data: \u4ed6\u306eTrigger\u3068\u533a\u5225\u3059\u308b\u305f\u3081\u306e\u8b58\u5225\u5b50\u3084\u3089\u3092\u4efb\u610f\u3067\u5165\u308c\u3089\u308c\u308b\u3088\u3063\u3066\u3084\u3064\u3002\u7a7a\u3067\u30e8\u30b7\u3002\n\n\u758e\u901a\u78ba\u8a8d\u3057\u305f\u3044\u306e\u3067 Test Trigger \u3092\uff8e\uff9f\uff81\uff70\u3002\n\nCloudWatchLogs\u898b\u308b\n\u7d50\u679c\uff57\uff57\uff57\uff57\uff57\uff57\uff57\uff57\uff57\uff57\uff57\uff57\uff57\nSTART RequestId: 5831de43-1424-11e6-a926-b725522dd65d Version: $LATEST \n{\n  'Records': [\n    {\n      'eventId': '2b769d5c-5b57-4356-xxxx-33561479a38a',\n      'eventVersion': '1.0',\n      'eventTime': '2016-05-07T07:21:41.177+0000',\n      'eventTriggerName': 'SampleNotification', \n      'eventPartNumber': 1,\n      'codecommit': {\n        'references': [\n          {\n            'commit': '0000000000000000000000000000000000000000',\n            'ref': 'refs/heads/TestReference'\n          }\n        ]\n      },\n      'eventName': 'TriggerEventTest',\n      'eventTriggerConfigId': '2b769d5c-5b57-4356-8d15-33561479a38a',\n      'eventSourceARN': 'arn:aws:codecommit:us-east-1:XXXXXXXXXXXXXX:oreno-repository',\n      'userIdentityARN': 'arn:aws:iam::XXXXXXXXXXXXXX:root',\n      'eventSource': 'aws:codecommit',\n      'awsRegion': 'us-east-1',\n      'eventTotalParts': 1\n    }\n  ]\n} \nEND RequestId: 5831de43-1424-11e6-a926-b725522dd65d \nREPORT RequestId: 5831de43-1424-11e6-a926-b725522dd65d  Duration: 0.57 ms   Billed Duration: 100 ms Memory Size: 128 MB Max Memory Used: 43 MB\n\n\u3061\u3083\u3093\u3068\u53d6\u308c\u3066\u308b\n\u3053\u3053\u307e\u3067\u3067\u304d\u308c\u3070\u3042\u3068\u306f\u5922\u5e83\u304c\u308a\u307e\u3059\u3088\u306d\u3002\u3067\u306f\u3002\n\u3053\u3093\u3061\u3083\u3002\n\n# CodeCommit\u3063\u3066\u306a\u306b\uff1f\nAWS\u306eGit\u30b5\u30fc\u30d3\u30b9\u3002\u4eca\u306e\u3068\u3053\u308dus-east-1\u3067\u3057\u304b\u4f7f\u3048\u306a\u3044\u3002\n\n\n# Triggers\u3063\u3066\u306a\u306b\uff1f\n\u3044\u308f\u3086\u308bWebHooks\n\u524d\u8abf\u3079\u305f\u3068\u304d\u306f\u4f7f\u3048\u306a\u304b\u3063\u305f\u6a5f\u80fd\u3060\u3051\u30693\u6708\u304f\u3089\u3044\u306b\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3089\u3057\u3044\nhttps://aws.amazon.com/jp/blogs/aws/new-notifications-for-aws-codecommit/\n\n\n# \u3084\u3063\u305f\u3053\u3068\n* Trigger\u306e\u53d7\u3051\u53e3\u306eLambda\u3064\u304f\u308b\n* \u6a29\u9650\u5468\u308a\u30b3\u30cd\u30b3\u30cd\u3059\u308b\n* CodeCommit\u3067Repository\u305f\u3066\u308b\n* CodeCommit\u3067Trigger\u8a2d\u5b9a\u3059\u308b\n* CloudWatchLogs\u898b\u308b\n\n\n## Trigger\u306e\u53d7\u3051\u53e3\u306eLambda\u3064\u304f\u308b\nWebHooks\u52d5\u304f\u306e\u304b\u898b\u305f\u3044\u3060\u3051\u306a\u306e\u3067\u3068\u308a\u3042\u3048\u305a\u53d7\u3051\u53d6\u3063\u305f\u30a4\u30d9\u30f3\u30c8\u5f15\u6570\u3092\u8fd4\u3059\u3060\u3051\u306e\u5b58\u5728\u3059\u308b\u4fa1\u5024\u306e\u306a\u3044\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u6210\u3002\u4e2d\u8eab\u304c\u898b\u308c\u308c\u3070\u306a\u3093\u3067\u3082\u3044\u3044\u3002\n\n```py\ndef lambda_handler(event, context):\n    print event\n    return event\n```\n\n\n## \u6a29\u9650\u5468\u308a\u30b3\u30cd\u30b3\u30cd\u3059\u308b\naws cli\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\uff8e\uff9f\uff81\uff70\n_${Hoge}\u306f\u3001\u9069\u5b9c\u66f8\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\u306d_\n\n```\naws lambda add-permission \\\n--region us-east-1 \\\n--function-name ${LambdaFunctionName} \\\n--statement-id 1 \\\n--principal codecommit.amazonaws.com \\\n--action lambda:InvokeFunction \\\n--source-arn arn:aws:codecommit:us-east-1:${Account}:${Repository} \\\n--source-account ${Account} \\\n--profile default\n\n```\n\nLambda\u306eRole\u306f\u3053\u3093\u306a\u611f\u3058\u306b\n\n```\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"Stmt1462604551000\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"codecommit:*\"\n            ],\n            \"Resource\": [\n                \"arn:aws:codecommit:us-east-1:${Account}:${Repository}\"\n            ]\n        }\n    ]\n}\n```\n\n_\u3076\u3063\u3061\u3083\u3051\u3053\u306e\u8fba\u3088\u304f\u308f\u304b\u3063\u3066\u306a\u3044_\n\n\n\n## CodeCommit\u3067Repository\u305f\u3066\u308b\nRepository\u540d\u5165\u529b\u3057\u3066\u9069\u5f53\u306b\u3064\u304f\u3063\u3066\u304f\u3060\u3055\u3044\u3002\n**\u5b8c**\n\n\n## CodeCommit\u3067Trigger\u8a2d\u5b9a\u3059\u308b\n\u4f5c\u6210\u3057\u305fRepository\u306e\u5de6\u30e1\u30cb\u30e5\u30fc\u304b\u3089 `Triggers` -> `Create Trigger` \u3092\u30dd\u30c1\u30c3\n![AWS_CodeCommit_Management.png](https://qiita-image-store.s3.amazonaws.com/0/73113/3dbc0712-552e-3ab1-4722-159a75a66144.png)\n\n* Trigger name: \u30c8\u30ea\u30ac\u30fc\u306e\u540d\u524d\u3002\u304a\u597d\u304d\u306b\u3002\n* Events: \u5f15\u3063\u639b\u3051\u305f\u3044\u30a4\u30d9\u30f3\u30c8\u3092\u6307\u5b9a\u3002\u4ee5\u4e0b\u304b\u3089\u9078\u3076\u3002  \n  + \u5168\u30a4\u30d9\u30f3\u30c8\n  + \u65e2\u5b58\u30d6\u30e9\u30f3\u30c1\u306b\u30d7\u30c3\u30b7\u30e5\n  + \u65b0\u898f\u30d6\u30e9\u30f3\u30c1\u30fb\u30bf\u30b0\u306e\u4f5c\u6210\n  + \u30d6\u30e9\u30f3\u30c1\u30fb\u30bf\u30b0\u306e\u524a\u9664\n* Branch names: \u53cd\u5fdc\u3055\u305b\u305f\u3044\u30d6\u30e9\u30f3\u30c1\u3092\u6307\u5b9a\u3002dev\u30d6\u30e9\u30f3\u30c1\u3060\u3051\u3001\u307f\u305f\u3044\u306a\u4f7f\u3044\u65b9\u3059\u308b\u3093\u3061\u3083\u3046\u3093\u3059\u304b\u306d\n* Send to: \u4eca\u56de\u306f `AWS Lambda` \u3092\u9078\u629e\u3002\n* Lambda function: \u3055\u3063\u304d\u4f5c\u3063\u305fLambdaFunction\u304c\u51fa\u3066\u304d\u3066\u308b\u306f\u305a\u306a\u306e\u3067\u3001\u305d\u308c\u3092\u9078\u3076\n* Custom data: \u4ed6\u306eTrigger\u3068\u533a\u5225\u3059\u308b\u305f\u3081\u306e\u8b58\u5225\u5b50\u3084\u3089\u3092\u4efb\u610f\u3067\u5165\u308c\u3089\u308c\u308b\u3088\u3063\u3066\u3084\u3064\u3002\u7a7a\u3067\u30e8\u30b7\u3002\n\n\u758e\u901a\u78ba\u8a8d\u3057\u305f\u3044\u306e\u3067 `Test Trigger` \u3092\uff8e\uff9f\uff81\uff70\u3002\n\n\n## CloudWatchLogs\u898b\u308b\n\n\u7d50\u679c\uff57\uff57\uff57\uff57\uff57\uff57\uff57\uff57\uff57\uff57\uff57\uff57\uff57\n\n```\nSTART RequestId: 5831de43-1424-11e6-a926-b725522dd65d Version: $LATEST \n{\n  'Records': [\n    {\n      'eventId': '2b769d5c-5b57-4356-xxxx-33561479a38a',\n      'eventVersion': '1.0',\n      'eventTime': '2016-05-07T07:21:41.177+0000',\n      'eventTriggerName': 'SampleNotification', \n      'eventPartNumber': 1,\n      'codecommit': {\n        'references': [\n          {\n            'commit': '0000000000000000000000000000000000000000',\n            'ref': 'refs/heads/TestReference'\n          }\n        ]\n      },\n      'eventName': 'TriggerEventTest',\n      'eventTriggerConfigId': '2b769d5c-5b57-4356-8d15-33561479a38a',\n      'eventSourceARN': 'arn:aws:codecommit:us-east-1:XXXXXXXXXXXXXX:oreno-repository',\n      'userIdentityARN': 'arn:aws:iam::XXXXXXXXXXXXXX:root',\n      'eventSource': 'aws:codecommit',\n      'awsRegion': 'us-east-1',\n      'eventTotalParts': 1\n    }\n  ]\n} \nEND RequestId: 5831de43-1424-11e6-a926-b725522dd65d \nREPORT RequestId: 5831de43-1424-11e6-a926-b725522dd65d\tDuration: 0.57 ms\tBilled Duration: 100 ms Memory Size: 128 MB\tMax Memory Used: 43 MB\n```\n\n**\u3061\u3083\u3093\u3068\u53d6\u308c\u3066\u308b**\n\n\n\n\u3053\u3053\u307e\u3067\u3067\u304d\u308c\u3070\u3042\u3068\u306f\u5922\u5e83\u304c\u308a\u307e\u3059\u3088\u306d\u3002\u3067\u306f\u3002\n", "tags": ["AWS", "CodeCommit", "lambda"]}