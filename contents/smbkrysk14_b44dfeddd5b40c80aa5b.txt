{"context": "\n\n\u306f\u3058\u3081\u306b\n\u672c\u7a3f\u306fWPF\u88fd\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u30a2\u30d7\u30ea\u304b\u3089\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4e0a\u306eMP3\u30d5\u30a1\u30a4\u30eb\u3092\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u518d\u751f\u3059\u308b\u65b9\u6cd5\u3092\u8a18\u8f09\u3057\u305f\u8a18\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002\nWPF\u3068\u3044\u3048\u3070MVVM\u30e2\u30c7\u30eb\u3067\u3059\u306e\u3067\u898f\u6a21\u304c\u5c0f\u3055\u3044\u30a2\u30d7\u30ea\u3067\u3059\u304cMVVM\u30e2\u30c7\u30eb\u306b\u5f93\u3044\u307e\u3059\u3002\nC#\u3067\u30aa\u30fc\u30c7\u30a3\u30aa\u518d\u751f\u3068\u3044\u3048\u3070NAudio\u304c\u6709\u540d\u307f\u305f\u3044\u3067\u3059\u306d\u3002\u672c\u7a3f\u3067\u3082NAudio\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\u30b3\u30fc\u30c9\u306fGithub\u306b\u304a\u3044\u3066\u3044\u308b\u306e\u3067\u3088\u304b\u3063\u305f\u3089\u843d\u3068\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\nhttps://github.com/smbkrysk14/WpfStreaming\n\n\u518d\u751f\u3059\u308bMP3\u30d5\u30a1\u30a4\u30eb\n\u518d\u751f\u3059\u308bMP3\u30d5\u30a1\u30a4\u30eb\u306f\u307f\u3093\u306a\u5927\u597d\u304dRebuid.fm\u306eMP3\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002\n\nView\nView\u3067\u3059\u3002\u30b7\u30f3\u30d7\u30eb\u306bMP3\u30d5\u30a1\u30a4\u30eb\u307e\u3067\u306eURL\u3092\u30c6\u30ad\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u306b\u5165\u529b\u3057\u3066\u305d\u308c\u3092\u300c\u518d\u751f\u300d\u300c\u505c\u6b62\u300d\u300c\u4e00\u6642\u505c\u6b62\u300d\u3067\u304d\u308b\u3088\u3046\u306b\u305d\u308c\u305e\u308c\u30dc\u30bf\u30f3\u3092\u7f6e\u3044\u305f\u3060\u3051\u3067\u3059\u3002\n\nMainWindow.xaml\n<Window x:Class=\"WpfStreaming.MainWindow\"\n        xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n        xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n        xmlns:d=\"http://schemas.microsoft.com/expression/blend/2008\"\n        xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"\n        xmlns:local=\"clr-namespace:WpfStreaming\"\n        mc:Ignorable=\"d\"\n        Title=\"MainWindow\" Height=\"350\" Width=\"525\">\n    <Grid>\n        <TextBox x:Name=\"textBox\" HorizontalAlignment=\"Left\" Height=\"25\" Margin=\"10,10,0,0\" TextWrapping=\"Wrap\" Text=\"{Binding EnclosureUrl}\" VerticalAlignment=\"Top\" Width=\"500\"/>\n        <Button x:Name=\"Play\" Content=\"\u518d\u751f\" HorizontalAlignment=\"Left\" Margin=\"10,40,0,0\" VerticalAlignment=\"Top\" Width=\"75\" Command=\"{Binding PlayCommand}\"/>\n        <Button x:Name=\"Stop\" Content=\"\u505c\u6b62\" HorizontalAlignment=\"Left\" Margin=\"90,40,0,0\" VerticalAlignment=\"Top\" Width=\"75\" Command=\"{Binding StopCommand}\"/>\n        <Button x:Name=\"Pause\" Content=\"\u4e00\u6642\u505c\u6b62\" HorizontalAlignment=\"Left\" Margin=\"170,40,0,0\" VerticalAlignment=\"Top\" Width=\"75\" Command=\"{Binding PauseCommand}\"/>\n    </Grid>\n</Window>\n\n\n\n\nViewModel\n\u3053\u308c\u3082\u81f3\u3063\u3066\u30b7\u30f3\u30d7\u30eb\u3002\n\u30c6\u30ad\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u306b\u5165\u529b\u3055\u308c\u305fURL\u3092\u3082\u3068\u306b\u518d\u751f\u3055\u305b\u308b\u51e6\u7406\u3068\u505c\u6b62\u3001\u4e00\u6642\u505c\u6b62\u3055\u305b\u308b\u51e6\u7406\u306e\u307f\u3067\u3059\u3002\nhttp://cache.rebuild.fm/podcast-ep162a.mp3\n\u304c\u4eca\u56de\u4f7f\u3046MP3\u30d5\u30a1\u30a4\u30eb\u307e\u3067\u306eURL\u3067\u3059\u306d\u3002\n\u6bce\u56de\u30c6\u30ad\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u306b\u5165\u529b\u3059\u308b\u306e\u304c\u9762\u5012\u3060\u3063\u305f\u306e\u3067\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3067\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\nMainWindowViewModel.cs\n\npublic class MainWindowViewModel:ViewModelBase\n    {\n\n        AudioPlayer audio = new AudioPlayer();\n\n        public MainWindowViewModel()\n        {\n            this.EnclosureUrl = \"http://cache.rebuild.fm/podcast-ep162a.mp3\";\n        }\n\n\n        private async void Play()\n        {\n            string enclosureUrl = this.EnclosureUrl;\n\n            await Task.Run(() =>\n            {\n                audio.Play(enclosureUrl);\n            });\n        }\n\n        private void Stop()\n        {\n            audio.Stop();\n        }\n\n        private void Pause()\n        {\n            audio.Pause();\n        }\n\n\n        private string _enclosureUrl;\n        public string EnclosureUrl\n        {\n            get\n            {\n                return this._enclosureUrl;\n            }\n            set\n            {\n                this._enclosureUrl = value;\n                base.RaisePropertyChanged(\"EnclosureUrl\");\n            }\n        }\n\n     // \u4e2d\u7565\n\n\n\nModel\n\u3042\u308a\u307e\u305b\u3093\u3002\n\n\u518d\u751f\u7528\u30af\u30e9\u30b9\n\u3053\u306e\u30af\u30e9\u30b9\u304c\u809d\u3067\u3059\u3002\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3068\u518d\u751f\u3092\u4e26\u5217\u3067\u51e6\u7406\u3055\u305b\u308b\u305f\u3081\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u90e8\u5206\u306f\u5225\u30b9\u30ec\u30c3\u30c9\u3067\u51e6\u7406\u3055\u305b\u307e\u3059\u3002\n\u505c\u6b62\u3057\u305f\u3068\u304dMemoryStream\u306ePosition\u306b0\u3092\u8a2d\u5b9a\u3057\u5148\u982d\u306b\u623b\u3059\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u3092\u5fd8\u308c\u308b\u3068\u505c\u6b62\u3067\u306f\u306a\u304f\u3066\u4e00\u6642\u505c\u6b62\u306e\u52d5\u304d\u306b\u306a\u308a\u307e\u3059\u3002\n\nAudioPlayer.cs\nsealed class AudioPlayer\n    {\n        private IWavePlayer _waveOut;\n        private Stream ms = new MemoryStream();\n\n        /// <summary>\n        /// \u518d\u751f\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n        /// </summary>\n        public void Play(string url)\n        {\n            if (_waveOut == null)\n            {\n                new Thread(delegate (object o)\n                {\n                    var response = WebRequest.Create(url).GetResponse();\n                    using (var stream = response.GetResponseStream())\n                    {\n\n                        byte[] buffer = new byte[65536]; // 64KB chunks\n\n                        int read;\n\n                        while ((read = stream.Read(buffer, 0, buffer.Length)) > 0)\n                        {\n                            var pos = ms.Position;\n                            ms.Position = ms.Length;\n                            ms.Write(buffer, 0, read);\n                            ms.Position = pos;\n                        }\n\n                    }\n                }).Start();\n            }\n\n\n            // Pre-buffering some data to allow NAudio to start playing\n            while (ms.Length < 65536 * 10)\n                Thread.Sleep(1000);\n\n\n            using (Mp3FileReader reader = new Mp3FileReader(ms))\n            using (WaveStream pcm = WaveFormatConversionStream.CreatePcmStream(reader))\n            using (WaveStream blockAlignedStream = new BlockAlignReductionStream(pcm))\n            {\n                using (_waveOut = new WaveOut(WaveCallbackInfo.FunctionCallback()))\n                {\n                    _waveOut.Init(blockAlignedStream);\n\n                    _waveOut.Play();\n                    while (_waveOut != null && _waveOut.PlaybackState == PlaybackState.Playing)\n                    {\n                        System.Threading.Thread.Sleep(100);\n                    }\n                }\n            }\n        }\n\n        /// <summary>\n        /// \u518d\u751f\u3092\u4e00\u6642\u505c\u6b62\u3057\u307e\u3059\u3002\n        /// </summary>\n        public void Pause()\n        {\n            this._waveOut.Pause();\n        }\n\n        /// <summary>\n        /// \u518d\u751f\u3092\u505c\u6b62\u3057\u307e\u3059\u3002\n        /// </summary>\n        public void Stop()\n        {\n            this._waveOut.Stop();\n            this.ms.Position = 0;\n        }\n    }\n\n\n\n\n\u6700\u5f8c\u306b\nThread\u4f7f\u3063\u3066\u3044\u308b\u306e\u304c\u3042\u308c\u3067\u3059\u304c\u306a\u3093\u3068\u304b\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u518d\u751f\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\u53c2\u8003\u306b\u3057\u305f\u30b5\u30a4\u30c8\nhttp://stackoverflow.com/questions/184683/play-audio-from-a-stream-using-c-sharp\n## \u306f\u3058\u3081\u306b\n\u672c\u7a3f\u306fWPF\u88fd\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u30a2\u30d7\u30ea\u304b\u3089\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4e0a\u306eMP3\u30d5\u30a1\u30a4\u30eb\u3092\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u518d\u751f\u3059\u308b\u65b9\u6cd5\u3092\u8a18\u8f09\u3057\u305f\u8a18\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002\nWPF\u3068\u3044\u3048\u3070MVVM\u30e2\u30c7\u30eb\u3067\u3059\u306e\u3067\u898f\u6a21\u304c\u5c0f\u3055\u3044\u30a2\u30d7\u30ea\u3067\u3059\u304cMVVM\u30e2\u30c7\u30eb\u306b\u5f93\u3044\u307e\u3059\u3002\nC#\u3067\u30aa\u30fc\u30c7\u30a3\u30aa\u518d\u751f\u3068\u3044\u3048\u3070NAudio\u304c\u6709\u540d\u307f\u305f\u3044\u3067\u3059\u306d\u3002\u672c\u7a3f\u3067\u3082NAudio\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\u30b3\u30fc\u30c9\u306fGithub\u306b\u304a\u3044\u3066\u3044\u308b\u306e\u3067\u3088\u304b\u3063\u305f\u3089\u843d\u3068\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\nhttps://github.com/smbkrysk14/WpfStreaming\n\n## \u518d\u751f\u3059\u308bMP3\u30d5\u30a1\u30a4\u30eb\n\u518d\u751f\u3059\u308bMP3\u30d5\u30a1\u30a4\u30eb\u306f\u307f\u3093\u306a\u5927\u597d\u304dRebuid.fm\u306eMP3\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002\n\n## View\nView\u3067\u3059\u3002\u30b7\u30f3\u30d7\u30eb\u306bMP3\u30d5\u30a1\u30a4\u30eb\u307e\u3067\u306eURL\u3092\u30c6\u30ad\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u306b\u5165\u529b\u3057\u3066\u305d\u308c\u3092\u300c\u518d\u751f\u300d\u300c\u505c\u6b62\u300d\u300c\u4e00\u6642\u505c\u6b62\u300d\u3067\u304d\u308b\u3088\u3046\u306b\u305d\u308c\u305e\u308c\u30dc\u30bf\u30f3\u3092\u7f6e\u3044\u305f\u3060\u3051\u3067\u3059\u3002\n\n```xml:MainWindow.xaml\n<Window x:Class=\"WpfStreaming.MainWindow\"\n        xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n        xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n        xmlns:d=\"http://schemas.microsoft.com/expression/blend/2008\"\n        xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"\n        xmlns:local=\"clr-namespace:WpfStreaming\"\n        mc:Ignorable=\"d\"\n        Title=\"MainWindow\" Height=\"350\" Width=\"525\">\n    <Grid>\n        <TextBox x:Name=\"textBox\" HorizontalAlignment=\"Left\" Height=\"25\" Margin=\"10,10,0,0\" TextWrapping=\"Wrap\" Text=\"{Binding EnclosureUrl}\" VerticalAlignment=\"Top\" Width=\"500\"/>\n        <Button x:Name=\"Play\" Content=\"\u518d\u751f\" HorizontalAlignment=\"Left\" Margin=\"10,40,0,0\" VerticalAlignment=\"Top\" Width=\"75\" Command=\"{Binding PlayCommand}\"/>\n        <Button x:Name=\"Stop\" Content=\"\u505c\u6b62\" HorizontalAlignment=\"Left\" Margin=\"90,40,0,0\" VerticalAlignment=\"Top\" Width=\"75\" Command=\"{Binding StopCommand}\"/>\n        <Button x:Name=\"Pause\" Content=\"\u4e00\u6642\u505c\u6b62\" HorizontalAlignment=\"Left\" Margin=\"170,40,0,0\" VerticalAlignment=\"Top\" Width=\"75\" Command=\"{Binding PauseCommand}\"/>\n    </Grid>\n</Window>\n\n```\n\n## ViewModel\n\u3053\u308c\u3082\u81f3\u3063\u3066\u30b7\u30f3\u30d7\u30eb\u3002\n\u30c6\u30ad\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u306b\u5165\u529b\u3055\u308c\u305fURL\u3092\u3082\u3068\u306b\u518d\u751f\u3055\u305b\u308b\u51e6\u7406\u3068\u505c\u6b62\u3001\u4e00\u6642\u505c\u6b62\u3055\u305b\u308b\u51e6\u7406\u306e\u307f\u3067\u3059\u3002\nhttp://cache.rebuild.fm/podcast-ep162a.mp3\n\u304c\u4eca\u56de\u4f7f\u3046MP3\u30d5\u30a1\u30a4\u30eb\u307e\u3067\u306eURL\u3067\u3059\u306d\u3002\n\u6bce\u56de\u30c6\u30ad\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u306b\u5165\u529b\u3059\u308b\u306e\u304c\u9762\u5012\u3060\u3063\u305f\u306e\u3067\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3067\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n```csharp:MainWindowViewModel.cs\n\npublic class MainWindowViewModel:ViewModelBase\n    {\n\n        AudioPlayer audio = new AudioPlayer();\n\n        public MainWindowViewModel()\n        {\n            this.EnclosureUrl = \"http://cache.rebuild.fm/podcast-ep162a.mp3\";\n        }\n\n        \n        private async void Play()\n        {\n            string enclosureUrl = this.EnclosureUrl;\n\n            await Task.Run(() =>\n            {\n                audio.Play(enclosureUrl);\n            });\n        }\n\n        private void Stop()\n        {\n            audio.Stop();\n        }\n\n        private void Pause()\n        {\n            audio.Pause();\n        }\n\n\n        private string _enclosureUrl;\n        public string EnclosureUrl\n        {\n            get\n            {\n                return this._enclosureUrl;\n            }\n            set\n            {\n                this._enclosureUrl = value;\n                base.RaisePropertyChanged(\"EnclosureUrl\");\n            }\n        }\n\n     // \u4e2d\u7565\n```\n\n## Model\n\u3042\u308a\u307e\u305b\u3093\u3002\n\n## \u518d\u751f\u7528\u30af\u30e9\u30b9\n\u3053\u306e\u30af\u30e9\u30b9\u304c\u809d\u3067\u3059\u3002\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3068\u518d\u751f\u3092\u4e26\u5217\u3067\u51e6\u7406\u3055\u305b\u308b\u305f\u3081\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u90e8\u5206\u306f\u5225\u30b9\u30ec\u30c3\u30c9\u3067\u51e6\u7406\u3055\u305b\u307e\u3059\u3002\n\u505c\u6b62\u3057\u305f\u3068\u304dMemoryStream\u306ePosition\u306b0\u3092\u8a2d\u5b9a\u3057\u5148\u982d\u306b\u623b\u3059\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u3092\u5fd8\u308c\u308b\u3068\u505c\u6b62\u3067\u306f\u306a\u304f\u3066\u4e00\u6642\u505c\u6b62\u306e\u52d5\u304d\u306b\u306a\u308a\u307e\u3059\u3002\n\n```csharp:AudioPlayer.cs\nsealed class AudioPlayer\n    {\n        private IWavePlayer _waveOut;\n        private Stream ms = new MemoryStream();\n\n        /// <summary>\n        /// \u518d\u751f\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n        /// </summary>\n        public void Play(string url)\n        {\n            if (_waveOut == null)\n            {\n                new Thread(delegate (object o)\n                {\n                    var response = WebRequest.Create(url).GetResponse();\n                    using (var stream = response.GetResponseStream())\n                    {\n\n                        byte[] buffer = new byte[65536]; // 64KB chunks\n\n                        int read;\n\n                        while ((read = stream.Read(buffer, 0, buffer.Length)) > 0)\n                        {\n                            var pos = ms.Position;\n                            ms.Position = ms.Length;\n                            ms.Write(buffer, 0, read);\n                            ms.Position = pos;\n                        }\n\n                    }\n                }).Start();\n            }\n\n\n            // Pre-buffering some data to allow NAudio to start playing\n            while (ms.Length < 65536 * 10)\n                Thread.Sleep(1000);\n\n            \n            using (Mp3FileReader reader = new Mp3FileReader(ms))\n            using (WaveStream pcm = WaveFormatConversionStream.CreatePcmStream(reader))\n            using (WaveStream blockAlignedStream = new BlockAlignReductionStream(pcm))\n            {\n                using (_waveOut = new WaveOut(WaveCallbackInfo.FunctionCallback()))\n                {\n                    _waveOut.Init(blockAlignedStream);\n\n                    _waveOut.Play();\n                    while (_waveOut != null && _waveOut.PlaybackState == PlaybackState.Playing)\n                    {\n                        System.Threading.Thread.Sleep(100);\n                    }\n                }\n            }\n        }\n\n        /// <summary>\n        /// \u518d\u751f\u3092\u4e00\u6642\u505c\u6b62\u3057\u307e\u3059\u3002\n        /// </summary>\n        public void Pause()\n        {\n            this._waveOut.Pause();\n        }\n\n        /// <summary>\n        /// \u518d\u751f\u3092\u505c\u6b62\u3057\u307e\u3059\u3002\n        /// </summary>\n        public void Stop()\n        {\n            this._waveOut.Stop();\n            this.ms.Position = 0;\n        }\n    }\n\n```\n\n## \u6700\u5f8c\u306b\nThread\u4f7f\u3063\u3066\u3044\u308b\u306e\u304c\u3042\u308c\u3067\u3059\u304c\u306a\u3093\u3068\u304b\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u518d\u751f\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\n### \u53c2\u8003\u306b\u3057\u305f\u30b5\u30a4\u30c8\nhttp://stackoverflow.com/questions/184683/play-audio-from-a-stream-using-c-sharp\n", "tags": ["WPF", "C#", "podcast"]}