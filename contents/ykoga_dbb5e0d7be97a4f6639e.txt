{"context": " More than 1 year has passed since last update.\u672c\u8a18\u4e8b\u306fTIS Engineer Advent Calendar 2015\u306e21\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\n\u3084\u3063\u305f\u3053\u3068\nDocker v1.9\u304b\u3089\u3001Docker\u30cd\u30a4\u30c6\u30a3\u30d6\u3067\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30ad\u30f3\u30b0\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002\u305d\u3053\u3067\u3001\uff12\u53f0\u306e\u30db\u30b9\u30c8\u3067ROS\u306e\u5165\u3063\u305f\u30b3\u30f3\u30c6\u30ca\u3092\u7528\u610f\u3057\u3066\u3001ROS\u901a\u4fe1\u304c\u53ef\u80fd\u304b\u3069\u3046\u304b\u691c\u8a3c\u3057\u307e\u3057\u305f\u3002\nROS\u306e\u901a\u4fe1\u30d7\u30ed\u30c8\u30b3\u30eb\u306fXML-RPC\u3068TCP(+UDP)\u306a\u306e\u3067\u30b3\u30f3\u30c6\u30ca\u9593\u901a\u4fe1\u81ea\u4f53\u306f\u554f\u984c\u306a\u3044\u306f\u305a\u306a\u306e\u3067\u3059\u304c\u3001\u4eca\u5f8c\u3001ROS\u306e\u5206\u6563\u51e6\u7406\u306b\u3082Docker\u306e\u65b0\u3057\u3044\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u6a5f\u80fd\u304c\u4f7f\u3048\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u305f\u3081\u3001\u305d\u306e\u624b\u9806\u3092\u6700\u521d\u304b\u3089\u307e\u3068\u3081\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u691c\u8a3c\u306e\u6982\u8981\n\u6982\u8981\u306f\u4e0b\u56f3\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002  \n\n\u691c\u8a3c\u306e\u305f\u3081\u306b\u3001AWS\u4e0a\u306b\uff12\u3064\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u4e21\u65b9\u306bDocker\u3092\u5165\u308c\u3001\u7247\u65b9\u306fROS\u306e\u307f\u3001\u3082\u3046\u4e00\u65b9\u306fROS\uff0bCaffe\u304c\u5165\u3063\u305fDocker\u30b3\u30f3\u30c6\u30ca\u3092\u7acb\u3061\u4e0a\u3052\u307e\u3059\u3002\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u30b5\u30fc\u30d0\u3078\u753b\u50cf\u3092\u9001\u308a\u3001\u30b5\u30fc\u30d0\u3067\u306fCaffe\u3067\u753b\u50cf\u8b58\u5225\uff08\u5206\u985e\uff09\u3057\u3001\u8b58\u5225\u5019\u88dc\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u8fd4\u3057\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067\u8868\u793a\u3059\u308b\u3001\u3068\u3044\u3046\u3053\u3068\u3092\u3084\u308a\u307e\u3059\u3002   \n\u3061\u306a\u307f\u306bCaffe\u3068\u306f\u3001\u4e3b\u306b\u753b\u50cf\u5206\u985e\u3067\u3088\u304f\u7528\u3044\u3089\u308c\u308b\u30c7\u30a3\u30fc\u30d7\u30e9\u30fc\u30cb\u30f3\u30b0\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u3059\u3002\u4eca\u56de\u306fCaffenet\u3068\u3044\u3046\u5b66\u7fd2\u6e08\u307f\u30e2\u30c7\u30eb\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u5b66\u7fd2\u30c7\u30fc\u30bf\u306f\u3053\u3061\u3089\u306b\u3042\u308a\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3084\u30b7\u30fc\u30f3\u306a\u3069\uff11\uff10\uff10\uff10\u30ab\u30c6\u30b4\u30ea\u306b\u5206\u985e\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u74b0\u5883\n\u5404\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\u8aac\u660e\u306e\u305f\u3081\u306b\u3001\u5404\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u5f79\u5272\u3082\u8f09\u305b\u3066\u3044\u307e\u3059\u3002\n\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u540d\n\u5f79\u5272\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30bf\u30a4\u30d7\n\u30b9\u30c8\u30ec\u30fc\u30b8\uff08GB\uff09\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\n\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\uff08\u4f8b\uff09\n\n\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9A\nCaffe\u3067\u753b\u50cf\u5206\u985e\uff08\u30b5\u30fc\u30d0\uff09\nt2.medium\n12\n\u3059\u3079\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\n172.31.2.38\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9B\n\u4e8b\u524d\u306b\u9332\u753b\u3057\u3066\u304a\u3044\u305f\u52d5\u753b\u306e\u518d\u751f\u3001\u7d50\u679c\u8868\u793a\uff08\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\uff09\nt2.micro\n8\n\u3059\u3079\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\n172.31.11.163\n\n\n\n\n\u624b\u9806\n\u5927\u304d\u304f\u5206\u3051\u3066\u3001\u524d\u5f8c\u534a\u306b\u5206\u304b\u308c\u307e\u3059\n- \u524d\u534a\uff1aDocker\u306e\u74b0\u5883\u69cb\u7bc9\uff5e\u30b3\u30f3\u30c6\u30ca\u306e\u30aa\u30fc\u30d0\u30ec\u30a4\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4f5c\u6210\n- \u5f8c\u534a\uff1a\u4e8c\u3064\u306e\u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\u3068\u3001\u30b3\u30f3\u30c6\u30ca\u9593\u306e\u63a5\u7d9a\u691c\u8a3c\u3001\u753b\u50cf\u5206\u985e\nDocker v1.9\u306e\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u3064\u3044\u3066\u306f\u3053\u3061\u3089\u304c\u8a73\u3057\u3044\u3067\u3059\u3002Docker1.9\u306e\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\n\u4ee5\u4e0b\u306e\u624b\u9806\u306f\u3001\u3053\u3061\u3089\u306e\u30da\u30fc\u30b8\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\nDocker : \u30de\u30eb\u30c1\u30db\u30b9\u30c8\u9593\u3067\u306e\u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\n\n\uff08\u524d\u534a\uff09EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u63a5\u7d9a\nssh\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u63a5\u7d9a\u3057\u307e\u3059\u3002\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9A,B\u305d\u308c\u305e\u308c\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u3066\u63a5\u7d9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nssh -i \"\u30ad\u30fc\uff08.pem\uff09\u306e\u30d5\u30a1\u30a4\u30eb\u540d\" ubuntu@\u63a5\u7d9a\u5148\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\u30a2\u30c9\u30ec\u30b9\n\n\nDocker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u307e\u305a\u306fDocker v1.9\u3092\u305d\u308c\u305e\u308c\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e0a\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002Docker v1.9\u306f\u30ab\u30fc\u30cd\u30eb\u304c\u300c3.16\u300d\u4ee5\u4e0a\u304c\u5fc5\u8981\u3067\u3059\u304c\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f3.13\u3060\u3063\u305f\u306e\u3067\u3001\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u3057\u307e\u3059\u3002\nsudo apt-get update\n\n# \u30ab\u30fc\u30cd\u30eb\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\nsudo apt-get install linux-image-3.19.0-39-generic\n\n# \u518d\u8d77\u52d5\nsudo shutdown -r now\n\n\u518d\u8d77\u52d5\u5f8c\u3001\u3082\u3046\u4e00\u5ea6EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bssh\u3067\u63a5\u7d9a\u3057\u307e\u3059\u3002\u305d\u306e\u5f8cDocker\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n# Docker v1.9\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# \u516c\u5f0f\u30b5\u30a4\u30c8\uff1ahttps://docs.docker.com/engine/installation/ubuntulinux/\n\n# \u30ad\u30fc\u3092\u8ffd\u52a0\u3059\u308b\nsudo apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D\n\n# /etc/apt/sources.list.d/docker.list\u3092\u4f5c\u6210\u30fb\u66f4\u65b0\nsudo touch /etc/apt/sources.list.d/docker.list\nsudo sh -c 'echo \"deb https://apt.dockerproject.org/repo ubuntu-trusty main\" >> /etc/apt/sources.list.d/docker.list'\n\n# \u30d1\u30c3\u30b1\u30fc\u30b8\u30ea\u30b9\u30c8\u306e\u66f4\u65b0\nsudo apt-get update\n\n# Docker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo apt-get install docker-engine\n\n# Docker\u30c7\u30fc\u30e2\u30f3\u8d77\u52d5\nservice docker start\n\n# \u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u78ba\u8a8d\ndocker --version\n\n# Docker\u30c7\u30fc\u30e2\u30f3\u505c\u6b62\nservice docker stop\n\n\nConsul\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# wget, unzip\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo apt-get install wget unzip\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nwget https://dl.bintray.com/mitchellh/consul/0.5.0_linux_amd64.zip\n\n# \u89e3\u51cd\nunzip 0.5.0_linux_amd64.zip\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo mv consul /usr/local/bin/\n\n\n\u30b3\u30f3\u30c6\u30ca\u9593\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\n\u3067\u306f\u3001\u307e\u305a\u306f\u4e21\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067Consul\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\u3053\u306e\u3068\u304d\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9A\u5074\u3092\u30b5\u30fc\u30d0\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9B\u5074\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068\u3057\u3066\u30af\u30e9\u30b9\u30bf\u3092\u7d44\u307f\u307e\u3059\u3002\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9A\n# \u30b3\u30f3\u30b5\u30eb\u8d77\u52d5\uff08\u30b5\u30fc\u30d0\uff09\n# \u4f8b\uff09consul agent -server -bootstrap-expect 1 -data-dir /tmp/consul\u3000-bind 172.31.2.38\n$ consul agent -server -bootstrap-expect 1 -data-dir /tmp/consul\u3000-bind \u30b5\u30fc\u30d0\u306eeth0\u306eIP\u30a2\u30c9\u30ec\u30b9\n\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9B\n# \u30b3\u30f3\u30b5\u30eb\u8d77\u52d5\uff08\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\uff09\n# \u4f8b\uff09consul agent -data-dir /tmp/consul -bind 172.31.11.163 -join 172.31.2.38\n$ consul agent -data-dir /tmp/consul -bind \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306eeth0\u306eIP\u30a2\u30c9\u30ec\u30b9 -join \u30b5\u30fc\u30d0\u306eeth0\u306eIP\u30a2\u30c9\u30ec\u30b9\n\n\n\n\u6b21\u306b\u3001Docker\u30c7\u30fc\u30e2\u30f3\u3092\u305d\u308c\u305e\u308c\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9A\n# Docker\u30c7\u30fc\u30e2\u30f3\u8d77\u52d5\uff08\u30b5\u30fc\u30d0\uff09\n# \u4f8b\uff09docker daemon --cluster-store=consul://localhost:8500 --cluster-advertise=172.31.2.38:2376\n$ docker daemon --cluster-store=consul://localhost:8500 --cluster-advertise=\u30b5\u30fc\u30d0\u306eeth0\u306eIP\u30a2\u30c9\u30ec\u30b9:2376\n\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9B\n# Docker\u30c7\u30fc\u30e2\u30f3\u8d77\u52d5\uff08\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\uff09\n# \u4f8b\uff09docker daemon --cluster-store=consul://localhost:8500 --cluster-advertise=172.31.11.163:2376\n$ docker daemon --cluster-store=consul://localhost:8500 --cluster-advertise=\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306eeth0\u306eIP\u30a2\u30c9\u30ec\u30b9:2376\n\n\n\u3067\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3059\u308b\u6e96\u5099\u304c\u6574\u3044\u307e\u3057\u305f\u3002Docker\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\u3002TestNetwork\u3068\u3044\u3046\u540d\u524d\u306e\u30aa\u30fc\u30d0\u30ec\u30a4\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n# Docker\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4f5c\u6210\uff08\u30b5\u30fc\u30d0\u307e\u305f\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3069\u3061\u3089\u304b\u4e00\u65b9\u3067\u3088\u3044\uff09\ndocker network create -d overlay TestNetwork\n\n\u3067\u306f\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n# \u30b5\u30fc\u30d0\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u4e21\u65b9\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u8868\u793a\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\ndocker network ls\n\nNETWORK ID          NAME                DRIVER\n81adcdfa8a2c        TestNetwork         overlay             \n1841a25b8ac4        docker_gwbridge     bridge              \ne56f819e681e        bridge              bridge              \na0bae70d0364        none                null                \n97a57a078ed1        host                host\n\n\n\uff08\u5f8c\u534a\uff09\u30b5\u30fc\u30d0\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\n\u30b5\u30fc\u30d0\u30b3\u30f3\u30c6\u30ca\u3067\u306f\u3001\u753b\u50cf\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b3\u30f3\u30c6\u30ca\u304b\u3089\u53d7\u3051\u53d6\u308a\u3001Caffe\u3067\u753b\u50cf\u8b58\u5225\u3057\u3066\u7d50\u679c\u3092\u30bf\u30fc\u30df\u30ca\u30eb\u306b\u8868\u793a\u3057\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u306b\u3001ROS\u3068Caffe\u672c\u4f53\u3001Caffe\u306eROS\u30d6\u30ea\u30c3\u30b8\u304c\u5165\u3063\u305fDocker\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u3044\u307e\u3059\u3002\n\u3067\u306f\u3001\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066\u3086\u304d\u307e\u3059\u3002\n# ROS\u30d5\u30eb\u30d1\u30c3\u30b1\u30fc\u30b8 \uff0b Caffe\uff08CPU\u30d3\u30eb\u30c9\u6e08\u307f\uff09\uff0b Caffe\u306eROS\u30d6\u30ea\u30c3\u30b8\u304c\u5165\u3063\u305fDocker\u30a4\u30e1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\ndocker pull ykoga/ros_caffe_cpu\n\n# \u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\uff08\u30b5\u30fc\u30d0\u30b3\u30f3\u30c6\u30ca\uff09\ndocker run -it --rm \\\n               --net=TestNetwork \\\n               --name caffe \\\n               --hostname caffe \\\n               --env ROS_HOSTNAME=caffe \\\n               --env ROS_MASTER_URI=http://caffe:11311 \\\n               ykoga/ros_caffe_cpu \\\n               /bin/bash\n\n\u4e2d\u306b\u5165\u3063\u305f\u3089\u3001\u4e00\u5fdcifconfig\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u60c5\u5831\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u304a\u305d\u3089\u304f\u3001\"eth\u6570\u5b57  10.0.0.x\" \u3068\u3044\u3046\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u304c\u5b58\u5728\u3059\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u3053\u308c\u304c\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30aa\u30fc\u30d0\u30fc\u30ec\u30a4\u3067\u751f\u6210\u3055\u308c\u305f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u3059\u3002\n\u3067\u306fROS\u30de\u30b9\u30bf\u30fc\u3068Caffe\u30ce\u30fc\u30c9\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n\u30b5\u30fc\u30d0\u30b3\u30f3\u30c6\u30ca\u5185\n# ROS\u30de\u30b9\u30bf\u30fc\u306e\u8d77\u52d5\nroscore &\n\n# \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u753b\u50cf\u3092\u53d7\u3051\u53d6\u3063\u3066Caffe\u3067\u8b58\u5225\u3059\u308b\nroslaunch ros_caffe ros_caffe.launch image:=/image_raw\n\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b3\u30f3\u30c6\u30ca\u3067\u306f\u3001\u30c6\u30b9\u30c8\u7528\u306b\u4e8b\u524d\u306bROS bag\u30d5\u30a1\u30a4\u30eb\u306b\u30ab\u30e1\u30e9\u753b\u50cf\u3092\u9332\u753b\u3057\u3066\u304a\u3044\u305f\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u4f7f\u3063\u3066\u30ab\u30e1\u30e9\u753b\u50cf\u3092Publish\u3057\u307e\u3059\u3002\n\u3067\u306f\u3001\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066\u3086\u304d\u307e\u3059\u3002\u307e\u305a\u306fROS\u306e\u57fa\u672c\u6a5f\u80fd\u306e\u307f\u304c\u5165\u3063\u305f\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n# ROS\u306e\u57fa\u672c\u30a4\u30e1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\ndocker pull ros:indigo-ros-base\n\n# \u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\uff08\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\uff09\ndocker run -it --rm \\\n               --net=TestNetwork \\\n               --name image_pub \\\n               --hostname image_pub \\\n               --env ROS_HOSTNAME=image_pub \\\n               --env ROS_MASTER_URI=http://caffe:11311 \\\n               ros:indigo-ros-base \\\n               /bin/bash\n\n\u4eca\u56de\u306e\u691c\u8a3c\u3067\u4f7f\u3046\u305f\u3081\u306b\u3001\u4e8b\u524d\u306bROS bag\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nbag\u30d5\u30a1\u30a4\u30eb\u306b\u306f\u3001\u4e8b\u524d\u306bWeb\u30ab\u30e1\u30e9\u3067\u64ae\u3063\u305f\u52d5\u753b\u304c\u5165\u3063\u3066\u3044\u307e\u3059\u3002\u4e2d\u8eab\u306f\u4e0b\u56f3\u306e\u3088\u3046\u306a\u3082\u306e\u3067\u3059\u3002\uff08\u3082\u3057\u624b\u5143\u306bROS\u74b0\u5883\u304c\u30ed\u30fc\u30ab\u30ebPC\u306b\u3082\u3042\u308b\u65b9\u306a\u3089rosrun rqt_image_view rqt_image_view\u3067\u30d3\u30e5\u30fc\u30a2\u3092\u8d77\u52d5\u3059\u308c\u3070\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff09\n\n\u3067\u306fbag\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3001\u518d\u751f\u3057\u307e\u3059\u3002\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b3\u30f3\u30c6\u30ca\u5185\napt-get update\napt-get install wget\n\n# bag\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nwget https://raw.githubusercontent.com/ykoga-kyutech/ros_caffe_cpu/master/test_webcam.bag\n\n# \u8b58\u5225\u7d50\u679c\u3092\u8868\u793a\nrostopic echo /ros_caffe/predictions &\n\n# ROS bag\u30d5\u30a1\u30a4\u30eb\uff08\u9332\u753b\u3057\u305f\u52d5\u753b\uff09\u306e\u518d\u751f\nrosbag play --loop test_webcam.bag\n\n\n\u6700\u5f8c\u306e\u884c\u307e\u3067\u6253\u3061\u8fbc\u3080\u3068\u3001Caffe\u306e\u8b58\u5225\u304c\u59cb\u307e\u308a\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b3\u30f3\u30c6\u30ca\u5074\u306b\u8b58\u5225\u7d50\u679c\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u7d50\u679c\u306f\u4f8b\u3048\u3070\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u7d50\u679c\u306e\u898b\u65b9\u3067\u3059\u304c\u3001\u7d50\u679c\u306f\u4e0a\u4f4d\uff15\u4ef6\u305a\u3064\u5019\u88dc\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u30b9\u30b3\u30a2\u306f\uff10\uff5e\uff11\u3092\u3068\u308a\u3001\uff11\u306e\u3082\u306e\u307b\u3069\u78ba\u4fe1\u5ea6\u304c\u9ad8\u3044\u3053\u3068\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u4f8b\u3060\u3068\u3001notebook, notebook computer\u304c\u6700\u3082\u78ba\u4fe1\u5ea6\u306e\u9ad8\u3044\u8b58\u5225\u7d50\u679c\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u307e\u3068\u3081\nDocker v1.9\u304b\u3089\u306e\u65b0\u6a5f\u80fd\u3067\u3042\u308b\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u6a5f\u80fd\u3092\u4f7f\u3063\u3066\uff12\u53f0\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u9593\u3067\u753b\u50cf\u306e\u3084\u308a\u3068\u308a\u3092\u884c\u3046\u3053\u3068\u3067\u3001ROS\u901a\u4fe1\u304c\u554f\u984c\u306a\u304f\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\n\n\u308f\u304b\u3089\u306a\u304b\u3063\u305f\u3053\u3068\n\n\u4e0a\u8a18\u306e\u3084\u308a\u65b9\u3067AWS\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u9593\u3067\u306e\u901a\u4fe1\u306fOK\u3060\u3063\u305f\u304c\u3001AWS\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3068\u81ea\u5b85PC\u9593\u306eROS\u901a\u4fe1\u306f\u3067\u304d\u306a\u304b\u3063\u305f\u3002\u3068\u3044\u3046\u304bConsul\u3067\u30af\u30e9\u30b9\u30bf\u3092\u7d44\u3080\u6240\u304b\u3089\u3067\u304d\u306a\u304b\u3063\u305f\u3002VPN\u3068\u304b\u3067\u4e21\u8005\u3092\u63a5\u7d9a\u3057\u306a\u3044\u3068\u3060\u3081\u306a\u306e\u304b\u306a\u3002\nROS\u306e\u901a\u4fe1\u30d7\u30ed\u30c8\u30b3\u30eb\u306fXML-RPC\u3068TCP(+UDP)\u306e\u306f\u305a\u306a\u306e\u3067\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u8272\u3005\u3044\u3058\u3063\u3066\u307f\u305f\u304c\u3001\u7d50\u5c40\u3001\u8a2d\u5b9a\u65b9\u6cd5\u304c\u300c\u3059\u3079\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u300d\u3057\u304b\u901a\u4fe1\u3067\u304d\u306a\u304b\u3063\u305f\u3002ROS\u901a\u4fe1\u3067\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u8a2d\u5b9a\u304c\u4e0d\u660e\u3002\n\n\u672c\u8a18\u4e8b\u306f[TIS Engineer Advent Calendar 2015](http://qiita.com/advent-calendar/2015/tis)\u306e21\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\n#\u3084\u3063\u305f\u3053\u3068\nDocker v1.9\u304b\u3089\u3001Docker\u30cd\u30a4\u30c6\u30a3\u30d6\u3067\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30ad\u30f3\u30b0\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002\u305d\u3053\u3067\u3001\uff12\u53f0\u306e\u30db\u30b9\u30c8\u3067ROS\u306e\u5165\u3063\u305f\u30b3\u30f3\u30c6\u30ca\u3092\u7528\u610f\u3057\u3066\u3001ROS\u901a\u4fe1\u304c\u53ef\u80fd\u304b\u3069\u3046\u304b\u691c\u8a3c\u3057\u307e\u3057\u305f\u3002\n\nROS\u306e\u901a\u4fe1\u30d7\u30ed\u30c8\u30b3\u30eb\u306fXML-RPC\u3068TCP(+UDP)\u306a\u306e\u3067\u30b3\u30f3\u30c6\u30ca\u9593\u901a\u4fe1\u81ea\u4f53\u306f\u554f\u984c\u306a\u3044\u306f\u305a\u306a\u306e\u3067\u3059\u304c\u3001\u4eca\u5f8c\u3001ROS\u306e\u5206\u6563\u51e6\u7406\u306b\u3082Docker\u306e\u65b0\u3057\u3044\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u6a5f\u80fd\u304c\u4f7f\u3048\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u305f\u3081\u3001\u305d\u306e\u624b\u9806\u3092\u6700\u521d\u304b\u3089\u307e\u3068\u3081\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n# \u691c\u8a3c\u306e\u6982\u8981\n\u6982\u8981\u306f\u4e0b\u56f3\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002  \n\n![image](https://qiita-image-store.s3.amazonaws.com/0/60470/e8235d70-5697-79bf-9abd-972eca3657c0.png)\n\n\u691c\u8a3c\u306e\u305f\u3081\u306b\u3001AWS\u4e0a\u306b\uff12\u3064\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u4e21\u65b9\u306bDocker\u3092\u5165\u308c\u3001\u7247\u65b9\u306fROS\u306e\u307f\u3001\u3082\u3046\u4e00\u65b9\u306fROS\uff0bCaffe\u304c\u5165\u3063\u305fDocker\u30b3\u30f3\u30c6\u30ca\u3092\u7acb\u3061\u4e0a\u3052\u307e\u3059\u3002\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u30b5\u30fc\u30d0\u3078\u753b\u50cf\u3092\u9001\u308a\u3001\u30b5\u30fc\u30d0\u3067\u306fCaffe\u3067\u753b\u50cf\u8b58\u5225\uff08\u5206\u985e\uff09\u3057\u3001\u8b58\u5225\u5019\u88dc\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u8fd4\u3057\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067\u8868\u793a\u3059\u308b\u3001\u3068\u3044\u3046\u3053\u3068\u3092\u3084\u308a\u307e\u3059\u3002   \n\n\n\u3061\u306a\u307f\u306bCaffe\u3068\u306f\u3001\u4e3b\u306b\u753b\u50cf\u5206\u985e\u3067\u3088\u304f\u7528\u3044\u3089\u308c\u308b\u30c7\u30a3\u30fc\u30d7\u30e9\u30fc\u30cb\u30f3\u30b0\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u3059\u3002\u4eca\u56de\u306f[Caffenet](https://github.com/BVLC/caffe/tree/master/models/bvlc_reference_caffenet)\u3068\u3044\u3046\u5b66\u7fd2\u6e08\u307f\u30e2\u30c7\u30eb\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u5b66\u7fd2\u30c7\u30fc\u30bf\u306f[\u3053\u3061\u3089](http://image-net.org/challenges/LSVRC/2012/browse-synsets)\u306b\u3042\u308a\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3084\u30b7\u30fc\u30f3\u306a\u3069\uff11\uff10\uff10\uff10\u30ab\u30c6\u30b4\u30ea\u306b\u5206\u985e\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n#\u74b0\u5883\n\u5404\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\u8aac\u660e\u306e\u305f\u3081\u306b\u3001\u5404\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u5f79\u5272\u3082\u8f09\u305b\u3066\u3044\u307e\u3059\u3002\n\n|\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u540d|\u5f79\u5272|\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30bf\u30a4\u30d7|\u30b9\u30c8\u30ec\u30fc\u30b8\uff08GB\uff09|\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7|\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\uff08\u4f8b\uff09|\n|-----|-----|-----|-----|-----|-----|-----|\n|\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9A|Caffe\u3067\u753b\u50cf\u5206\u985e\uff08\u30b5\u30fc\u30d0\uff09|t2.medium|12|\u3059\u3079\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af|172.31.2.38|\n|\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9B|\u4e8b\u524d\u306b\u9332\u753b\u3057\u3066\u304a\u3044\u305f\u52d5\u753b\u306e\u518d\u751f\u3001\u7d50\u679c\u8868\u793a\uff08\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\uff09|t2.micro|8|\u3059\u3079\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af|172.31.11.163|\n\n#\u624b\u9806\n\u5927\u304d\u304f\u5206\u3051\u3066\u3001\u524d\u5f8c\u534a\u306b\u5206\u304b\u308c\u307e\u3059\n- \u524d\u534a\uff1aDocker\u306e\u74b0\u5883\u69cb\u7bc9\uff5e\u30b3\u30f3\u30c6\u30ca\u306e\u30aa\u30fc\u30d0\u30ec\u30a4\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4f5c\u6210\n- \u5f8c\u534a\uff1a\u4e8c\u3064\u306e\u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\u3068\u3001\u30b3\u30f3\u30c6\u30ca\u9593\u306e\u63a5\u7d9a\u691c\u8a3c\u3001\u753b\u50cf\u5206\u985e\n\nDocker v1.9\u306e\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u3064\u3044\u3066\u306f\u3053\u3061\u3089\u304c\u8a73\u3057\u3044\u3067\u3059\u3002[Docker1.9\u306e\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af](https://thinkit.co.jp/article/8414)\n\n\u4ee5\u4e0b\u306e\u624b\u9806\u306f\u3001\u3053\u3061\u3089\u306e\u30da\u30fc\u30b8\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\n[Docker : \u30de\u30eb\u30c1\u30db\u30b9\u30c8\u9593\u3067\u306e\u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af](http://qiita.com/Arturias/items/dd7f9e2365626dd4ad51)\n\n## \uff08\u524d\u534a\uff09EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u63a5\u7d9a\nssh\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u63a5\u7d9a\u3057\u307e\u3059\u3002\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9A,B\u305d\u308c\u305e\u308c\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u3066\u63a5\u7d9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```bash\nssh -i \"\u30ad\u30fc\uff08.pem\uff09\u306e\u30d5\u30a1\u30a4\u30eb\u540d\" ubuntu@\u63a5\u7d9a\u5148\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\u30a2\u30c9\u30ec\u30b9\n```\n\n#Docker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u307e\u305a\u306fDocker v1.9\u3092\u305d\u308c\u305e\u308c\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e0a\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002Docker v1.9\u306f\u30ab\u30fc\u30cd\u30eb\u304c\u300c3.16\u300d\u4ee5\u4e0a\u304c\u5fc5\u8981\u3067\u3059\u304c\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f3.13\u3060\u3063\u305f\u306e\u3067\u3001\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n```bash\nsudo apt-get update\n\n# \u30ab\u30fc\u30cd\u30eb\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\nsudo apt-get install linux-image-3.19.0-39-generic\n\n# \u518d\u8d77\u52d5\nsudo shutdown -r now\n```\n\n\u518d\u8d77\u52d5\u5f8c\u3001\u3082\u3046\u4e00\u5ea6EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bssh\u3067\u63a5\u7d9a\u3057\u307e\u3059\u3002\u305d\u306e\u5f8cDocker\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```bash\n# Docker v1.9\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# \u516c\u5f0f\u30b5\u30a4\u30c8\uff1ahttps://docs.docker.com/engine/installation/ubuntulinux/\n\n# \u30ad\u30fc\u3092\u8ffd\u52a0\u3059\u308b\nsudo apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D\n\n# /etc/apt/sources.list.d/docker.list\u3092\u4f5c\u6210\u30fb\u66f4\u65b0\nsudo touch /etc/apt/sources.list.d/docker.list\nsudo sh -c 'echo \"deb https://apt.dockerproject.org/repo ubuntu-trusty main\" >> /etc/apt/sources.list.d/docker.list'\n\n# \u30d1\u30c3\u30b1\u30fc\u30b8\u30ea\u30b9\u30c8\u306e\u66f4\u65b0\nsudo apt-get update\n\n# Docker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo apt-get install docker-engine\n\n# Docker\u30c7\u30fc\u30e2\u30f3\u8d77\u52d5\nservice docker start\n\n# \u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u78ba\u8a8d\ndocker --version\n\n# Docker\u30c7\u30fc\u30e2\u30f3\u505c\u6b62\nservice docker stop\n```\n\n#Consul\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\n# wget, unzip\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo apt-get install wget unzip\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nwget https://dl.bintray.com/mitchellh/consul/0.5.0_linux_amd64.zip\n\n# \u89e3\u51cd\nunzip 0.5.0_linux_amd64.zip\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo mv consul /usr/local/bin/\n```\n\n#\u30b3\u30f3\u30c6\u30ca\u9593\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\n\u3067\u306f\u3001\u307e\u305a\u306f\u4e21\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067Consul\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\u3053\u306e\u3068\u304d\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9A\u5074\u3092\u30b5\u30fc\u30d0\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9B\u5074\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068\u3057\u3066\u30af\u30e9\u30b9\u30bf\u3092\u7d44\u307f\u307e\u3059\u3002\n\n```bash:\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9A\n# \u30b3\u30f3\u30b5\u30eb\u8d77\u52d5\uff08\u30b5\u30fc\u30d0\uff09\n# \u4f8b\uff09consul agent -server -bootstrap-expect 1 -data-dir /tmp/consul\u3000-bind 172.31.2.38\n$ consul agent -server -bootstrap-expect 1 -data-dir /tmp/consul\u3000-bind \u30b5\u30fc\u30d0\u306eeth0\u306eIP\u30a2\u30c9\u30ec\u30b9\n```\n\n```bash:\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9B\n# \u30b3\u30f3\u30b5\u30eb\u8d77\u52d5\uff08\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\uff09\n# \u4f8b\uff09consul agent -data-dir /tmp/consul -bind 172.31.11.163 -join 172.31.2.38\n$ consul agent -data-dir /tmp/consul -bind \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306eeth0\u306eIP\u30a2\u30c9\u30ec\u30b9 -join \u30b5\u30fc\u30d0\u306eeth0\u306eIP\u30a2\u30c9\u30ec\u30b9\n\n```\n\n\u6b21\u306b\u3001Docker\u30c7\u30fc\u30e2\u30f3\u3092\u305d\u308c\u305e\u308c\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash:\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9A\n# Docker\u30c7\u30fc\u30e2\u30f3\u8d77\u52d5\uff08\u30b5\u30fc\u30d0\uff09\n# \u4f8b\uff09docker daemon --cluster-store=consul://localhost:8500 --cluster-advertise=172.31.2.38:2376\n$ docker daemon --cluster-store=consul://localhost:8500 --cluster-advertise=\u30b5\u30fc\u30d0\u306eeth0\u306eIP\u30a2\u30c9\u30ec\u30b9:2376\n```\n\n```bash:\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9B\n# Docker\u30c7\u30fc\u30e2\u30f3\u8d77\u52d5\uff08\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\uff09\n# \u4f8b\uff09docker daemon --cluster-store=consul://localhost:8500 --cluster-advertise=172.31.11.163:2376\n$ docker daemon --cluster-store=consul://localhost:8500 --cluster-advertise=\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306eeth0\u306eIP\u30a2\u30c9\u30ec\u30b9:2376\n```\n\n\u3067\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3059\u308b\u6e96\u5099\u304c\u6574\u3044\u307e\u3057\u305f\u3002Docker\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\u3002TestNetwork\u3068\u3044\u3046\u540d\u524d\u306e\u30aa\u30fc\u30d0\u30ec\u30a4\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash\n# Docker\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4f5c\u6210\uff08\u30b5\u30fc\u30d0\u307e\u305f\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3069\u3061\u3089\u304b\u4e00\u65b9\u3067\u3088\u3044\uff09\ndocker network create -d overlay TestNetwork\n```\n\n\u3067\u306f\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n\n```bash\n# \u30b5\u30fc\u30d0\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u4e21\u65b9\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u8868\u793a\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\ndocker network ls\n\nNETWORK ID          NAME                DRIVER\n81adcdfa8a2c        TestNetwork         overlay             \n1841a25b8ac4        docker_gwbridge     bridge              \ne56f819e681e        bridge              bridge              \na0bae70d0364        none                null                \n97a57a078ed1        host                host\n```\n\n## \uff08\u5f8c\u534a\uff09\u30b5\u30fc\u30d0\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\n\u30b5\u30fc\u30d0\u30b3\u30f3\u30c6\u30ca\u3067\u306f\u3001\u753b\u50cf\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b3\u30f3\u30c6\u30ca\u304b\u3089\u53d7\u3051\u53d6\u308a\u3001Caffe\u3067\u753b\u50cf\u8b58\u5225\u3057\u3066\u7d50\u679c\u3092\u30bf\u30fc\u30df\u30ca\u30eb\u306b\u8868\u793a\u3057\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u306b\u3001ROS\u3068Caffe\u672c\u4f53\u3001Caffe\u306eROS\u30d6\u30ea\u30c3\u30b8\u304c\u5165\u3063\u305fDocker\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n\u3067\u306f\u3001\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066\u3086\u304d\u307e\u3059\u3002\n\n```bash\n# ROS\u30d5\u30eb\u30d1\u30c3\u30b1\u30fc\u30b8 \uff0b Caffe\uff08CPU\u30d3\u30eb\u30c9\u6e08\u307f\uff09\uff0b Caffe\u306eROS\u30d6\u30ea\u30c3\u30b8\u304c\u5165\u3063\u305fDocker\u30a4\u30e1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\ndocker pull ykoga/ros_caffe_cpu\n\n# \u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\uff08\u30b5\u30fc\u30d0\u30b3\u30f3\u30c6\u30ca\uff09\ndocker run -it --rm \\\n               --net=TestNetwork \\\n               --name caffe \\\n               --hostname caffe \\\n               --env ROS_HOSTNAME=caffe \\\n               --env ROS_MASTER_URI=http://caffe:11311 \\\n               ykoga/ros_caffe_cpu \\\n               /bin/bash\n```\n\n\u4e2d\u306b\u5165\u3063\u305f\u3089\u3001\u4e00\u5fdcifconfig\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u60c5\u5831\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u304a\u305d\u3089\u304f\u3001\"eth\u6570\u5b57  10.0.0.x\" \u3068\u3044\u3046\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u304c\u5b58\u5728\u3059\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u3053\u308c\u304c\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30aa\u30fc\u30d0\u30fc\u30ec\u30a4\u3067\u751f\u6210\u3055\u308c\u305f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u3059\u3002\n\n\u3067\u306fROS\u30de\u30b9\u30bf\u30fc\u3068Caffe\u30ce\u30fc\u30c9\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash:\u30b5\u30fc\u30d0\u30b3\u30f3\u30c6\u30ca\u5185\n# ROS\u30de\u30b9\u30bf\u30fc\u306e\u8d77\u52d5\nroscore &\n\n# \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u753b\u50cf\u3092\u53d7\u3051\u53d6\u3063\u3066Caffe\u3067\u8b58\u5225\u3059\u308b\nroslaunch ros_caffe ros_caffe.launch image:=/image_raw\n```\n\n##\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b3\u30f3\u30c6\u30ca\u3067\u306f\u3001\u30c6\u30b9\u30c8\u7528\u306b\u4e8b\u524d\u306bROS bag\u30d5\u30a1\u30a4\u30eb\u306b\u30ab\u30e1\u30e9\u753b\u50cf\u3092\u9332\u753b\u3057\u3066\u304a\u3044\u305f\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u4f7f\u3063\u3066\u30ab\u30e1\u30e9\u753b\u50cf\u3092Publish\u3057\u307e\u3059\u3002\n\n\u3067\u306f\u3001\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066\u3086\u304d\u307e\u3059\u3002\u307e\u305a\u306fROS\u306e\u57fa\u672c\u6a5f\u80fd\u306e\u307f\u304c\u5165\u3063\u305f\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash\n# ROS\u306e\u57fa\u672c\u30a4\u30e1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\ndocker pull ros:indigo-ros-base\n\n# \u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\uff08\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\uff09\ndocker run -it --rm \\\n               --net=TestNetwork \\\n               --name image_pub \\\n               --hostname image_pub \\\n               --env ROS_HOSTNAME=image_pub \\\n               --env ROS_MASTER_URI=http://caffe:11311 \\\n               ros:indigo-ros-base \\\n               /bin/bash\n```\n\n\u4eca\u56de\u306e\u691c\u8a3c\u3067\u4f7f\u3046\u305f\u3081\u306b\u3001\u4e8b\u524d\u306bROS bag\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\nbag\u30d5\u30a1\u30a4\u30eb\u306b\u306f\u3001\u4e8b\u524d\u306bWeb\u30ab\u30e1\u30e9\u3067\u64ae\u3063\u305f\u52d5\u753b\u304c\u5165\u3063\u3066\u3044\u307e\u3059\u3002\u4e2d\u8eab\u306f\u4e0b\u56f3\u306e\u3088\u3046\u306a\u3082\u306e\u3067\u3059\u3002\uff08\u3082\u3057\u624b\u5143\u306bROS\u74b0\u5883\u304c\u30ed\u30fc\u30ab\u30ebPC\u306b\u3082\u3042\u308b\u65b9\u306a\u3089rosrun rqt_image_view rqt_image_view\u3067\u30d3\u30e5\u30fc\u30a2\u3092\u8d77\u52d5\u3059\u308c\u3070\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff09\n![caffe_result_image.png](https://qiita-image-store.s3.amazonaws.com/0/60470/3b07efe5-5e09-c9be-00ce-a1a0708fa051.png)\n\n\n\u3067\u306fbag\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3001\u518d\u751f\u3057\u307e\u3059\u3002\n\n```bash:\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b3\u30f3\u30c6\u30ca\u5185\napt-get update\napt-get install wget\n\n# bag\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nwget https://raw.githubusercontent.com/ykoga-kyutech/ros_caffe_cpu/master/test_webcam.bag\n\n# \u8b58\u5225\u7d50\u679c\u3092\u8868\u793a\nrostopic echo /ros_caffe/predictions &\n\n# ROS bag\u30d5\u30a1\u30a4\u30eb\uff08\u9332\u753b\u3057\u305f\u52d5\u753b\uff09\u306e\u518d\u751f\nrosbag play --loop test_webcam.bag\n```\n\n\u6700\u5f8c\u306e\u884c\u307e\u3067\u6253\u3061\u8fbc\u3080\u3068\u3001Caffe\u306e\u8b58\u5225\u304c\u59cb\u307e\u308a\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b3\u30f3\u30c6\u30ca\u5074\u306b\u8b58\u5225\u7d50\u679c\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u7d50\u679c\u306f\u4f8b\u3048\u3070\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n![client-result.png](https://qiita-image-store.s3.amazonaws.com/0/60470/b0b09595-d640-fb7a-efde-fea5ebd7d0e0.png)\n\n\n\u7d50\u679c\u306e\u898b\u65b9\u3067\u3059\u304c\u3001\u7d50\u679c\u306f\u4e0a\u4f4d\uff15\u4ef6\u305a\u3064\u5019\u88dc\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u30b9\u30b3\u30a2\u306f\uff10\uff5e\uff11\u3092\u3068\u308a\u3001\uff11\u306e\u3082\u306e\u307b\u3069\u78ba\u4fe1\u5ea6\u304c\u9ad8\u3044\u3053\u3068\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u4f8b\u3060\u3068\u3001notebook, notebook computer\u304c\u6700\u3082\u78ba\u4fe1\u5ea6\u306e\u9ad8\u3044\u8b58\u5225\u7d50\u679c\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n# \u307e\u3068\u3081\nDocker v1.9\u304b\u3089\u306e\u65b0\u6a5f\u80fd\u3067\u3042\u308b\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u6a5f\u80fd\u3092\u4f7f\u3063\u3066\uff12\u53f0\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u9593\u3067\u753b\u50cf\u306e\u3084\u308a\u3068\u308a\u3092\u884c\u3046\u3053\u3068\u3067\u3001ROS\u901a\u4fe1\u304c\u554f\u984c\u306a\u304f\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\n\n\n#\u308f\u304b\u3089\u306a\u304b\u3063\u305f\u3053\u3068\n- \u4e0a\u8a18\u306e\u3084\u308a\u65b9\u3067AWS\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u9593\u3067\u306e\u901a\u4fe1\u306fOK\u3060\u3063\u305f\u304c\u3001AWS\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3068\u81ea\u5b85PC\u9593\u306eROS\u901a\u4fe1\u306f\u3067\u304d\u306a\u304b\u3063\u305f\u3002\u3068\u3044\u3046\u304bConsul\u3067\u30af\u30e9\u30b9\u30bf\u3092\u7d44\u3080\u6240\u304b\u3089\u3067\u304d\u306a\u304b\u3063\u305f\u3002VPN\u3068\u304b\u3067\u4e21\u8005\u3092\u63a5\u7d9a\u3057\u306a\u3044\u3068\u3060\u3081\u306a\u306e\u304b\u306a\u3002\n- ROS\u306e\u901a\u4fe1\u30d7\u30ed\u30c8\u30b3\u30eb\u306fXML-RPC\u3068TCP(+UDP)\u306e\u306f\u305a\u306a\u306e\u3067\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u8272\u3005\u3044\u3058\u3063\u3066\u307f\u305f\u304c\u3001\u7d50\u5c40\u3001\u8a2d\u5b9a\u65b9\u6cd5\u304c\u300c\u3059\u3079\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u300d\u3057\u304b\u901a\u4fe1\u3067\u304d\u306a\u304b\u3063\u305f\u3002ROS\u901a\u4fe1\u3067\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u8a2d\u5b9a\u304c\u4e0d\u660e\u3002\n", "tags": ["docker", "ROS", "AWS", "Caffe"]}