{"context": " More than 1 year has passed since last update.\u6700\u8fd1\u3001Apache Solr\u3092\u89e6\u308b\u6a5f\u4f1a\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u500b\u4eba\u7684\u306b\u3082\u3044\u3058\u3063\u3066\u307f\u3066\u3044\u307e\u3059\u3002\nPostgres\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30b3\u30f3\u30c6\u30f3\u30c4\u3092Solr\u306b\u6d41\u3057\u8fbc\u3080\u5fc5\u8981\u304c\u3042\u3063\u305f\u306e\u3067\u3059\u304c\u3001Solr5\u3067\u306ePostgres\u3068\u306e\u9023\u643a\u306b\u3064\u3044\u3066\u306f\u65e5\u672c\u8a9e\u6587\u732e\u304c\u898b\u5f53\u305f\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u3084\u3063\u3066\u307f\u305f\u30e1\u30e2\u3092\u6b8b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nSolr5\u306b\u306a\u3063\u3066\u304b\u3089\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5468\u308a\u304c\u7d50\u69cb\u5909\u308f\u3063\u3066\u304a\u308a\u3001\u5c11\u3057\u624b\u9593\u53d6\u308a\u307e\u3057\u305f\u3002\u3002\n\n1. \u74b0\u5883\n\nCentOS 6.6 (32bit)\nOracle JDK 8 Update 65\nApache Solr 5.3.1\npostgresql-server 8.4.20-4.el6_7\n\n\n2. Solr\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nApache\u306e\u30da\u30fc\u30b8\u304b\u3089Solr\u306e\u30d0\u30a4\u30ca\u30ea\u3092\u74b0\u5883\u306b\u6301\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\u3053\u306e\u3068\u304d\u3001\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3082\u4e00\u7dd2\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304f\u3068\u3001\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u8a70\u307e\u3063\u305f\u3068\u304d\u306b\u30b5\u30af\u3063\u3068\u8abf\u3079\u3089\u308c\u307e\u3059\u3002(\u89e3\u6c7a\u3067\u304d\u308b\u304b\u3069\u3046\u304b\u306f\u5225\u554f\u984c\u3060\u3051\u3069)\n\u30d0\u30a4\u30ca\u30ea\u3092\u5c55\u958b\u3002\n\u4f7f\u3063\u3066\u307f\u308b\u3002\nSolr Quick Start\u3067\u6848\u5185\u3055\u308c\u3066\u3044\u308b\u65b9\u6cd5\u3060\u3068\u3001\u30af\u30e9\u30b9\u30bf\u69cb\u6210(SolrCloud)\u3067\u8d77\u52d5\u3055\u308c\u307e\u3059\u3002\n$ bin/solr start -e cloud -noprompt\n\nWelcome to the SolrCloud example!\n\n  --- (snip) ---\n\n\u505c\u6b62\u3002\n$ bin/solr stop -all ; rm -Rf example/cloud/\n\n\u4eca\u56de\u306f\u30af\u30e9\u30b9\u30bf\u69cb\u6210\u3067\u306a\u304f\u30b7\u30f3\u30d7\u30eb\u306b\u7acb\u3061\u4e0a\u3052\u307e\u3059\u3002\n\n3. Postgres\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nSolr + PostgreSQL\u9023\u643a(Solr4.9)\u3067\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308b\u65b9\u6cd5\u3092\u305d\u306e\u307e\u307e\u4f7f\u308f\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\nPostgres\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n# yum install postgresql-server\n\nPostgres\u3092\u7acb\u3061\u4e0a\u3052\u307e\u3059\u3002\n$ sudo service postgresql initdb\n[sudo] password for hashiwa:\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u521d\u671f\u5316\u4e2d:                                    [  OK  ]\n\n$ sudo service postgresql start\npostgresql \u30b5\u30fc\u30d3\u30b9\u3092\u958b\u59cb\u4e2d:                               [  OK  ]\n\nSolr\u304b\u3089\u63a5\u7d9a\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002(\u30b9\u30fc\u30d1\u30fc\u30e6\u30fc\u30b6\u30fc\u3058\u3083\u306a\u3044\u307b\u3046\u304c\u826f\u304b\u3063\u305f\u304b\u3082)\n$ sudo su - postgres\n-bash-4.1$ createuser solruser\n\u65b0\u3057\u3044\u30ed\u30fc\u30eb\u3092\u30b9\u30fc\u30d1\u30fc\u30e6\u30fc\u30b6\u3068\u3057\u307e\u3059\u304b?  (y/n)y\n-bash-4.1$ createdb postdb -O solruser\n\n\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n-bash-4.1$ psql\npsql (8.4.20)\n\"help\" \u3067\u30d8\u30eb\u30d7\u3092\u8868\u793a\u3057\u307e\u3059.\n\npostgres=# alter user solruser encrypted password 'solrpassword';\nALTER ROLE\npostgres=# alter user postgres encrypted password 'postgrespassword';\nALTER ROLE\npostgres-# \\q\n\n\u8a8d\u8a3cMETHOD\u3092md5\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n$ vim /var/lib/pgsql/data/pg_hba.conf\n\n 67 # TYPE  DATABASE    USER        CIDR-ADDRESS          METHOD\n 68\n 69 # \"local\" is for Unix domain socket connections only\n 70 local   all         all                               md5\n 71 # IPv4 local connections:\n 72 host    all         all         127.0.0.1/32          md5\n 73 # IPv6 local connections:\n 74 host    all         all         ::1/128               md5\n\nPostgres\u30b5\u30fc\u30d3\u30b9\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n# service postgresql restart\npostgresql \u30b5\u30fc\u30d3\u30b9\u3092\u505c\u6b62\u4e2d:                               [  OK  ]\npostgresql \u30b5\u30fc\u30d3\u30b9\u3092\u958b\u59cb\u4e2d:                               [  OK  ]\n\nforum\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ psql -U solruser -d postdb\n\u30e6\u30fc\u30b6 solruser \u306e\u30d1\u30b9\u30ef\u30fc\u30c9:\npsql (8.4.20)\n\"help\" \u3067\u30d8\u30eb\u30d7\u3092\u8868\u793a\u3057\u307e\u3059.\n\npostdb=# create table forum (\npostdb(# id serial primary key,\npostdb(# name varchar(32),\npostdb(# body varchar(1024),\npostdb(# updated timestamp(0) not null default current_timestamp);\nNOTICE:  CREATE TABLE\u306f\u30b7\u30ea\u30a2\u30eb\u5217\"forum.id\"\u7528\u306b\u6697\u9ed9\u7684\u306a\u30b7\u30fc\u30b1\u30f3\u30b9\"forum_id_seq\"\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nNOTICE:  CREATE TABLE / PRIMARY KEY\u306f\u30c6\u30fc\u30d6\u30eb\"forum\"\u306b\u6697\u9ed9\u7684\u306a\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\"forum_pkey\"\u3092\u4f5c\u6210\u3057\u307e\u3059\nCREATE TABLE\n\n\u5dee\u5206\u30a4\u30f3\u30dd\u30fc\u30c8\u7528\u306e\u95a2\u6570\u3068\u30c8\u30ea\u30ac\u30fc\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\npostdb=# CREATE LANGUAGE plpgsql;\nCREATE LANGUAGE\n\npostdb=# create function set_update_time() returns opaque as '\npostdb'#   begin\npostdb'#     new.updated := ''now'';\npostdb'#     return new;\npostdb'#   end;\npostdb'# ' language 'plpgsql';\nCREATE FUNCTION\n\npostdb=# create trigger update_tri before update on forum for each row\npostdb=#   execute procedure set_update_time();\n\n\u3053\u306e\u3068\u304d\u3001\u30c6\u30fc\u30d6\u30eb\u306f\u4ee5\u4e0b\u306e\u72b6\u614b\u3067\u3059\u3002\npostdb=# \\d forum\n                                     \u30c6\u30fc\u30d6\u30eb \"public.forum\"\n \u30ab\u30e9\u30e0  |               \u578b               |                        \u4fee\u98fe\u8a9e\n---------+--------------------------------+-------------------------------------------------------\n id      | integer                        | not null \u30c7\u30d5\u30a9\u30eb\u30c8 nextval('forum_id_seq'::regclass)\n name    | character varying(32)          |\n body    | character varying(1024)        |\n updated | timestamp(0) without time zone | not null \u30c7\u30d5\u30a9\u30eb\u30c8 now()\n\u30a4\u30f3\u30c7\u30c3\u30af\u30b9:\n    \"forum_pkey\" PRIMARY KEY, btree (id)\n\u30c8\u30ea\u30ac:\n    update_tri BEFORE UPDATE ON forum FOR EACH ROW EXECUTE PROCEDURE set_update_time()\n\nSolr\u304b\u3089\u691c\u7d22\u3055\u308c\u308b\u30c7\u30fc\u30bf\u30923\u3064\u633f\u5165\u3057\u3066\u304a\u304d\u307e\u3059\u3002\npostdb=# insert into forum (name, body) values ('Bobbie Waterbury', 'Daddy!My Daddy!');\nINSERT 0 1\npostdb=# insert into forum (name, body) values ('James Bond', 'Do I look like I give a damn?');\nINSERT 0 1\npostdb=# insert into forum (name, body) values ('Andy Dufresne', 'Get busy living, or get busy dying.');\nINSERT 0 1\n\n\u30c7\u30fc\u30bf\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u633f\u5165\u3055\u308c\u307e\u3057\u305f\u3002\n$ psql -h localhost -U solruser -d postdb -t -c 'select * from forum;';\n\u30e6\u30fc\u30b6 solruser \u306e\u30d1\u30b9\u30ef\u30fc\u30c9:\n  1 | Bobbie Waterbury | Daddy!My Daddy!                     | 2015-12-26 18:02:10\n  2 | James Bond       | Do I look like I give a damn?       | 2015-12-26 18:02:18\n  3 | Andy Dufresne    | Get busy living, or get busy dying. | 2015-12-26 18:02:28\n\n\n4. JDBC\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nPostgres\u7528\u306eJDBC\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n$ curl https://jdbc.postgresql.org/download/postgresql-9.4.1207.jre6.jar > postgresql-9.4.1207.jre6.jar\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100  593k  100  593k    0     0  93681      0  0:00:06  0:00:06 --:--:--  129k\n\n\n5. Solr\u306e\u8a2d\u5b9a\nSolr\u306e\u8a2d\u5b9a\u3082\u3001Solr + PostgreSQL\u9023\u643a(Solr4.9)\u3092\u304b\u306a\u308a\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\u305f\u3060\u3001Solr5\u306b\u306a\u3063\u305f\u3053\u3068\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u306a\u3068\u3053\u308d\u304c\u3042\u308a\u307e\u3059\u3002\n\u5ff5\u306e\u305f\u3081\u3001\u30b5\u30fc\u30d0\u30fc\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30b3\u30d4\u30fc\u3057\u3066\u3001\u305d\u3061\u3089\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u30b5\u30fc\u30d0\u30fc\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068server\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3068\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001server\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u540d\u3067\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n$ cp -r server/ hsw_server\n\n\u4eca\u56de\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3067\u3042\u308bcollection1\u3092\u4f7f\u7528\u3057\u307e\u3059\u30021\n\u30b3\u30d4\u30fc\u3057\u305f\u30b5\u30fc\u30d0\u30fc\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u3001collection1\u306esolrconfig.xml\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u8a2d\u5b9a\u3002\n\nhsw_server/solr/collection1/conf/solrconfig.xml\n  <lib dir=\"/home/hashiwa/solr/solr-5.3.1-bin/hsw_server/lib/\" regex=\"postgresql-\\d.*\\.jar\" />\n  <lib dir=\"/home/hashiwa/solr/solr-5.3.1-bin/dist/\" regex=\"solr-dataimporthandler-\\d.*\\.jar\" />\n  <lib dir=\"/home/hashiwa/solr/solr-5.3.1-bin/contrib/dataimporthandler-extras/lib/\" regex=\".*\\.jar\" />\n\n\n\u307e\u305f\u3001Solr5\u3067\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u30b9\u30ad\u30fc\u30de\u30ec\u30b9\u30e2\u30fc\u30c9\u306b\u306a\u3063\u3066\u304a\u308a\u3001schema.xml\u3067\u30b9\u30ad\u30fc\u30de\u3092\u6307\u5b9a\u3067\u304d\u306a\u3044\u3088\u3046\u3067\u3059\u3002\nREST\u3067\u30b9\u30ad\u30fc\u30de\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u304c\u3001\u30b9\u30ad\u30eb\u304c\u306a\u3044\u306e\u3067\u30af\u30e9\u30b7\u30c3\u30af\u306aschema.xml\u3067\u306e\u6307\u5b9a\u3092\u4f7f\u3046\u3053\u3068\u306b\u3057\u307e\u3059\u3002\nSchemaFactory\u306e\u5909\u66f4\u3002\n\nhsw_server/solr/collection1/conf/solrconfig.xml\n  <!--\n  <schemaFactory class=\"ManagedIndexSchemaFactory\">\n    <bool name=\"mutable\">true</bool>\n    <str name=\"managedSchemaResourceName\">managed-schema</str>\n  </schemaFactory>\n  -->\n  <schemaFactory class=\"ClassicIndexSchemaFactory\"/>\n\n\nAddSchemaFieldsUpdateProcessorFactory\u306e\u8a2d\u5b9a\u306e\u524a\u9664\u3002\n\nhsw_server/solr/collection1/conf/solrconfig.xml\n    <!--\n    <processor class=\"solr.AddSchemaFieldsUpdateProcessorFactory\">\n      <str name=\"defaultFieldType\">strings</str>\n      <lst name=\"typeMapping\">\n        <str name=\"valueClass\">java.lang.Boolean</str>\n        <str name=\"fieldType\">booleans</str>\n      </lst>\n      <lst name=\"typeMapping\">\n        <str name=\"valueClass\">java.util.Date</str>\n        <str name=\"fieldType\">tdates</str>\n      </lst>\n      <lst name=\"typeMapping\">\n        <str name=\"valueClass\">java.lang.Long</str>\n        <str name=\"valueClass\">java.lang.Integer</str>\n        <str name=\"fieldType\">tlongs</str>\n      </lst>\n      <lst name=\"typeMapping\">\n        <str name=\"valueClass\">java.lang.Number</str>\n        <str name=\"fieldType\">tdoubles</str>\n      </lst>\n    </processor>\n    -->\n\n\n\u30ea\u30af\u30a8\u30b9\u30c8\u30cf\u30f3\u30c9\u30e9\u306e\u8a2d\u5b9a\u3002\n\u3053\u308c\u306fData Import Handler\u3068\u3044\u3046\u6a5f\u80fd\u3092\u4f7f\u3046\u305f\u3081\u306e\u8a2d\u5b9a\u3067\u3001\u8a2d\u5b9a\u81ea\u4f53\u306fdataconfig.xml\u306b\u8a18\u8f09\u3057\u307e\u3059\u3002\n\nhsw_server/solr/collection1/conf/solrconfig.xml\n  <requestHandler name=\"/dataimport-hswtest\" class=\"org.apache.solr.handler.dataimport.DataImportHandler\" >\n    <lst name=\"defaults\">\n      <str name=\"config\">dataconfig.xml</str>\n    </lst>\n  </requestHandler>\n\n\ndataconfig.xml\u306e\u8a2d\u5b9a\u3002\nPostgres\u3067\u8a2d\u5b9a\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u3084\u3089\u30d1\u30b9\u30ef\u30fc\u30c9\u3084\u3089\u30c6\u30fc\u30d6\u30eb\u3084\u3089\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\nhsw_server/solr/collection1/conf/dataconfig.xml\n<dataConfig>\n  <dataSource name=\"ratings\"\n              driver=\"org.postgresql.Driver\"\n              url=\"jdbc:postgresql://localhost:5432/postdb\"\n              user=\"solruser\"\n              password=\"solrpassword\" />\n\n  <document>\n    <entity name=\"forum\"\n            query=\"select * from forum\"\n            deltaQuery=\"select id from forum where updated >= '${dataimporter.last_index_time}'\"\n            deltaImportQuery=\"select * from forum where id=${dataimporter.delta.id}\">\n      <field column=\"id\" name=\"id\" />\n      <field column=\"name\" name=\"name\" />\n      <field column=\"body\" name=\"body\" />\n      <field column=\"updated\" name=\"updated\" />\n    </entity>\n  </document>\n</dataConfig>\n\n\n\u307e\u305f\u3001\u5fd8\u308c\u305a\u306bJDBC\u306ejar\u3082solrconfig.xml\u3067\u6307\u5b9a\u3057\u305f\u5834\u6240\u306b\u7f6e\u3044\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n$ cp postgresql-9.4.1207.jre6.jar /home/hashiwa/solr/solr-5.3.1-bin/hsw_server/lib/\n\nschema.xml\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nhsw_server/solr/collection1/conf/schema.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<schema name=\"hsw-example\" version=\"1.5\">\n   <field name=\"id\" type=\"string\" indexed=\"true\" stored=\"true\" required=\"true\" />\n   <field name=\"name\" type=\"text_en\" indexed=\"true\" stored=\"true\" termVectors=\"true\" termPositions=\"true\" />\n   <field name=\"body\" type=\"text_en\" indexed=\"true\" stored=\"true\" termVectors=\"true\" termPositions=\"true\" />\n   <field name=\"updated\" type=\"timestamp\" indexed=\"true\" stored=\"true\" termVectors=\"true\" termPositions=\"true\" />\n   <field name=\"_version_\" type=\"long\" indexed=\"true\" stored=\"true\"/>\n\n   <fieldType name=\"long\" class=\"solr.TrieLongField\" precisionStep=\"0\" positionIncrementGap=\"0\"/>\n   <fieldType name=\"string\" class=\"solr.StrField\" sortMissingLast=\"true\" />\n   <fieldType name=\"timestamp\" class=\"solr.TrieDateField\" />\n   <fieldType name=\"text_en\" class=\"solr.TextField\">\n     <analyzer>\n       <tokenizer class=\"solr.StandardTokenizerFactory\"/>\n       <filter class=\"solr.LowerCaseFilterFactory\"/>\n       <filter class=\"solr.StopFilterFactory\" ignoreCase=\"true\" words=\"lang/stopwords_en.txt\" />\n     </analyzer>\n   </fieldType>\n\n   <uniqueKey>id</uniqueKey>\n <!-- depricated\n   <defaultSearchField>body</defaultSearchField>\n   <solrQueryParser defaultOperator=\"AND\" />\n -->\n</schema>\n\n\n\u6ce8\u610f\u70b9\uff1a\n\nsolr.LongField\u304c\u306a\u304f\u306a\u3063\u3066\u3044\u308b\u3089\u3057\u304f\u3001solr.TrieLongField\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\nid\u3092long\u306b\u3059\u308b\u3068\u3001elevate.xml\u3067id=MA147LL/A\u3068\u3057\u3066\u3044\u308b\u304b\u3089\u304b\u30a8\u30e9\u30fc\u306b\u306a\u308b\u305f\u3081\u3001string\u306b\u3059\u308b\n\n\n6. Solr\u306e\u8d77\u52d5\u30fb\u30c7\u30fc\u30bf\u30a4\u30f3\u30dd\u30fc\u30c8\n\u3044\u3088\u3044\u3088Solr\u3092\u89e6\u3063\u3066\u3044\u304d\u307e\u3059\u3002\nSolr\u3092\u8d77\u52d5\u3002\u3053\u306e\u3068\u304d\u3001\u8a2d\u5b9a\u3057\u305f\u30b5\u30fc\u30d0\u30fc\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n$ bin/solr start -d hsw_server/\nWaiting up to 30 seconds to see Solr running on port 8983 [/]\nStarted Solr server on port 8983 (pid=20468). Happy searching!\n\nSolr\u306e\u30b3\u30f3\u30bd\u30fc\u30eb( http://localhost:8983/solr/ )\u306b\u30a2\u30af\u30bb\u30b9\u3002\n\n[Core Selector]\u304b\u3089collection1\u3092\u9078\u629e\u3057\u3001[DataImport]\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u3053\u3053\u3067\u3001forum\u3092\u9078\u3093\u3067Execute\u3059\u308b\u3068\u3001solrconfig.xml\u3067\u8a2d\u5b9a\u3057\u305fData Import Handler\u3092\u5b9f\u884c\u3057\u3066\u3001Postgres\u304b\u3089\u30c7\u30fc\u30bf\u3092Solr\u306b\u30a4\u30f3\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002\n(\u3044\u304f\u3089\u5f85\u3063\u3066\u3082\u753b\u9762\u304c\u66f4\u65b0\u3055\u308c\u306a\u3044\u5834\u5408\u306f\u3001[Reflesh Status]\u3092\u62bc\u3057\u3066\u307f\u308b)\n\n\u6210\u529f\u3057\u3066\u3044\u305f\u3089\u3001[Query]\u3067\u691c\u7d22\u3057\u3066\u307f\u307e\u3059\u3002\n\u3061\u3083\u3093\u3068Postgres\u306b\u5165\u308c\u305f3\u3064\u306e\u30c7\u30fc\u30bf\u304c\u691c\u7d22\u3055\u308c\u307e\u3057\u305f\uff01\n\n\n\u53c2\u8003\u8cc7\u6599\n\nSolr + PostgreSQL\u9023\u643a(Solr4.9)\nApache Solr 5.3.0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nIndex a DB table directly into Solr\n\n\n\n\n\n2015/12/30\u8ffd\u8a18 collection1\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u5b58\u5728\u3057\u306a\u304b\u3063\u305f\u304b\u3082\u3002\u306a\u3051\u308c\u3070\u3001Solr\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u306a\u3069\u3067\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u00a0\u21a9\n\n\n\n\u6700\u8fd1\u3001[Apache Solr](http://lucene.apache.org/solr/)\u3092\u89e6\u308b\u6a5f\u4f1a\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u500b\u4eba\u7684\u306b\u3082\u3044\u3058\u3063\u3066\u307f\u3066\u3044\u307e\u3059\u3002\n\nPostgres\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30b3\u30f3\u30c6\u30f3\u30c4\u3092Solr\u306b\u6d41\u3057\u8fbc\u3080\u5fc5\u8981\u304c\u3042\u3063\u305f\u306e\u3067\u3059\u304c\u3001Solr5\u3067\u306ePostgres\u3068\u306e\u9023\u643a\u306b\u3064\u3044\u3066\u306f\u65e5\u672c\u8a9e\u6587\u732e\u304c\u898b\u5f53\u305f\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u3084\u3063\u3066\u307f\u305f\u30e1\u30e2\u3092\u6b8b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nSolr5\u306b\u306a\u3063\u3066\u304b\u3089\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5468\u308a\u304c\u7d50\u69cb\u5909\u308f\u3063\u3066\u304a\u308a\u3001\u5c11\u3057\u624b\u9593\u53d6\u308a\u307e\u3057\u305f\u3002\u3002\n\n# 1. \u74b0\u5883\n- CentOS 6.6 (32bit)\n- Oracle JDK 8 Update 65\n- Apache Solr 5.3.1\n- postgresql-server 8.4.20-4.el6_7\n\n# 2. Solr\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n[Apache\u306e\u30da\u30fc\u30b8](http://lucene.apache.org/solr/mirrors-solr-latest-redir.html)\u304b\u3089Solr\u306e\u30d0\u30a4\u30ca\u30ea\u3092\u74b0\u5883\u306b\u6301\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\u3053\u306e\u3068\u304d\u3001\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3082\u4e00\u7dd2\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304f\u3068\u3001\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u8a70\u307e\u3063\u305f\u3068\u304d\u306b\u30b5\u30af\u3063\u3068\u8abf\u3079\u3089\u308c\u307e\u3059\u3002(\u89e3\u6c7a\u3067\u304d\u308b\u304b\u3069\u3046\u304b\u306f\u5225\u554f\u984c\u3060\u3051\u3069)\n\n\u30d0\u30a4\u30ca\u30ea\u3092\u5c55\u958b\u3002\n\n\u4f7f\u3063\u3066\u307f\u308b\u3002\n[Solr Quick Start](http://lucene.apache.org/solr/quickstart.html)\u3067\u6848\u5185\u3055\u308c\u3066\u3044\u308b\u65b9\u6cd5\u3060\u3068\u3001\u30af\u30e9\u30b9\u30bf\u69cb\u6210(SolrCloud)\u3067\u8d77\u52d5\u3055\u308c\u307e\u3059\u3002\n\n```\n$ bin/solr start -e cloud -noprompt\n\nWelcome to the SolrCloud example!\n\n  --- (snip) ---\n```\n\n\u505c\u6b62\u3002\n\n```\n$ bin/solr stop -all ; rm -Rf example/cloud/\n```\n\n\u4eca\u56de\u306f\u30af\u30e9\u30b9\u30bf\u69cb\u6210\u3067\u306a\u304f\u30b7\u30f3\u30d7\u30eb\u306b\u7acb\u3061\u4e0a\u3052\u307e\u3059\u3002\n\n# 3. Postgres\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n[Solr + PostgreSQL\u9023\u643a(Solr4.9)](http://open-groove.net/solr/solr4-postgresql/)\u3067\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308b\u65b9\u6cd5\u3092\u305d\u306e\u307e\u307e\u4f7f\u308f\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\n\nPostgres\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n# yum install postgresql-server\n```\n\nPostgres\u3092\u7acb\u3061\u4e0a\u3052\u307e\u3059\u3002\n\n```\n$ sudo service postgresql initdb\n[sudo] password for hashiwa:\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u521d\u671f\u5316\u4e2d:                                    [  OK  ]\n\n$ sudo service postgresql start\npostgresql \u30b5\u30fc\u30d3\u30b9\u3092\u958b\u59cb\u4e2d:                               [  OK  ]\n```\n\nSolr\u304b\u3089\u63a5\u7d9a\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002(\u30b9\u30fc\u30d1\u30fc\u30e6\u30fc\u30b6\u30fc\u3058\u3083\u306a\u3044\u307b\u3046\u304c\u826f\u304b\u3063\u305f\u304b\u3082)\n\n```\n$ sudo su - postgres\n-bash-4.1$ createuser solruser\n\u65b0\u3057\u3044\u30ed\u30fc\u30eb\u3092\u30b9\u30fc\u30d1\u30fc\u30e6\u30fc\u30b6\u3068\u3057\u307e\u3059\u304b?  (y/n)y\n-bash-4.1$ createdb postdb -O solruser\n```\n\n\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```\n-bash-4.1$ psql\npsql (8.4.20)\n\"help\" \u3067\u30d8\u30eb\u30d7\u3092\u8868\u793a\u3057\u307e\u3059.\n\npostgres=# alter user solruser encrypted password 'solrpassword';\nALTER ROLE\npostgres=# alter user postgres encrypted password 'postgrespassword';\nALTER ROLE\npostgres-# \\q\n```\n\n\u8a8d\u8a3cMETHOD\u3092md5\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```\n$ vim /var/lib/pgsql/data/pg_hba.conf\n\n 67 # TYPE  DATABASE    USER        CIDR-ADDRESS          METHOD\n 68\n 69 # \"local\" is for Unix domain socket connections only\n 70 local   all         all                               md5\n 71 # IPv4 local connections:\n 72 host    all         all         127.0.0.1/32          md5\n 73 # IPv6 local connections:\n 74 host    all         all         ::1/128               md5\n```\n\nPostgres\u30b5\u30fc\u30d3\u30b9\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```\n# service postgresql restart\npostgresql \u30b5\u30fc\u30d3\u30b9\u3092\u505c\u6b62\u4e2d:                               [  OK  ]\npostgresql \u30b5\u30fc\u30d3\u30b9\u3092\u958b\u59cb\u4e2d:                               [  OK  ]\n```\n\nforum\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\n$ psql -U solruser -d postdb\n\u30e6\u30fc\u30b6 solruser \u306e\u30d1\u30b9\u30ef\u30fc\u30c9:\npsql (8.4.20)\n\"help\" \u3067\u30d8\u30eb\u30d7\u3092\u8868\u793a\u3057\u307e\u3059.\n\npostdb=# create table forum (\npostdb(# id serial primary key,\npostdb(# name varchar(32),\npostdb(# body varchar(1024),\npostdb(# updated timestamp(0) not null default current_timestamp);\nNOTICE:  CREATE TABLE\u306f\u30b7\u30ea\u30a2\u30eb\u5217\"forum.id\"\u7528\u306b\u6697\u9ed9\u7684\u306a\u30b7\u30fc\u30b1\u30f3\u30b9\"forum_id_seq\"\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nNOTICE:  CREATE TABLE / PRIMARY KEY\u306f\u30c6\u30fc\u30d6\u30eb\"forum\"\u306b\u6697\u9ed9\u7684\u306a\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\"forum_pkey\"\u3092\u4f5c\u6210\u3057\u307e\u3059\nCREATE TABLE\n```\n\n\u5dee\u5206\u30a4\u30f3\u30dd\u30fc\u30c8\u7528\u306e\u95a2\u6570\u3068\u30c8\u30ea\u30ac\u30fc\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n```\npostdb=# CREATE LANGUAGE plpgsql;\nCREATE LANGUAGE\n\npostdb=# create function set_update_time() returns opaque as '\npostdb'#   begin\npostdb'#     new.updated := ''now'';\npostdb'#     return new;\npostdb'#   end;\npostdb'# ' language 'plpgsql';\nCREATE FUNCTION\n\npostdb=# create trigger update_tri before update on forum for each row\npostdb=#   execute procedure set_update_time();\n```\n\n\u3053\u306e\u3068\u304d\u3001\u30c6\u30fc\u30d6\u30eb\u306f\u4ee5\u4e0b\u306e\u72b6\u614b\u3067\u3059\u3002\n\n```\npostdb=# \\d forum\n                                     \u30c6\u30fc\u30d6\u30eb \"public.forum\"\n \u30ab\u30e9\u30e0  |               \u578b               |                        \u4fee\u98fe\u8a9e\n---------+--------------------------------+-------------------------------------------------------\n id      | integer                        | not null \u30c7\u30d5\u30a9\u30eb\u30c8 nextval('forum_id_seq'::regclass)\n name    | character varying(32)          |\n body    | character varying(1024)        |\n updated | timestamp(0) without time zone | not null \u30c7\u30d5\u30a9\u30eb\u30c8 now()\n\u30a4\u30f3\u30c7\u30c3\u30af\u30b9:\n    \"forum_pkey\" PRIMARY KEY, btree (id)\n\u30c8\u30ea\u30ac:\n    update_tri BEFORE UPDATE ON forum FOR EACH ROW EXECUTE PROCEDURE set_update_time()\n```\n\nSolr\u304b\u3089\u691c\u7d22\u3055\u308c\u308b\u30c7\u30fc\u30bf\u30923\u3064\u633f\u5165\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\npostdb=# insert into forum (name, body) values ('Bobbie Waterbury', 'Daddy!My Daddy!');\nINSERT 0 1\npostdb=# insert into forum (name, body) values ('James Bond', 'Do I look like I give a damn?');\nINSERT 0 1\npostdb=# insert into forum (name, body) values ('Andy Dufresne', 'Get busy living, or get busy dying.');\nINSERT 0 1\n```\n\n\u30c7\u30fc\u30bf\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u633f\u5165\u3055\u308c\u307e\u3057\u305f\u3002\n\n```\n$ psql -h localhost -U solruser -d postdb -t -c 'select * from forum;';\n\u30e6\u30fc\u30b6 solruser \u306e\u30d1\u30b9\u30ef\u30fc\u30c9:\n  1 | Bobbie Waterbury | Daddy!My Daddy!                     | 2015-12-26 18:02:10\n  2 | James Bond       | Do I look like I give a damn?       | 2015-12-26 18:02:18\n  3 | Andy Dufresne    | Get busy living, or get busy dying. | 2015-12-26 18:02:28\n```\n\n# 4. JDBC\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\nPostgres\u7528\u306eJDBC\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n$ curl https://jdbc.postgresql.org/download/postgresql-9.4.1207.jre6.jar > postgresql-9.4.1207.jre6.jar\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100  593k  100  593k    0     0  93681      0  0:00:06  0:00:06 --:--:--  129k\n```\n\n# 5. Solr\u306e\u8a2d\u5b9a\nSolr\u306e\u8a2d\u5b9a\u3082\u3001[Solr + PostgreSQL\u9023\u643a(Solr4.9)](http://open-groove.net/solr/solr4-postgresql/)\u3092\u304b\u306a\u308a\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\u305f\u3060\u3001Solr5\u306b\u306a\u3063\u305f\u3053\u3068\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u306a\u3068\u3053\u308d\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u5ff5\u306e\u305f\u3081\u3001\u30b5\u30fc\u30d0\u30fc\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30b3\u30d4\u30fc\u3057\u3066\u3001\u305d\u3061\u3089\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u30b5\u30fc\u30d0\u30fc\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068server\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3068\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001server\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u540d\u3067\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\n```\n$ cp -r server/ hsw_server\n```\n\n\u4eca\u56de\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3067\u3042\u308bcollection1\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002[^1]\n\u30b3\u30d4\u30fc\u3057\u305f\u30b5\u30fc\u30d0\u30fc\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u3001collection1\u306esolrconfig.xml\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u8a2d\u5b9a\u3002\n\n```xml:hsw_server/solr/collection1/conf/solrconfig.xml\n  <lib dir=\"/home/hashiwa/solr/solr-5.3.1-bin/hsw_server/lib/\" regex=\"postgresql-\\d.*\\.jar\" />\n  <lib dir=\"/home/hashiwa/solr/solr-5.3.1-bin/dist/\" regex=\"solr-dataimporthandler-\\d.*\\.jar\" />\n  <lib dir=\"/home/hashiwa/solr/solr-5.3.1-bin/contrib/dataimporthandler-extras/lib/\" regex=\".*\\.jar\" />\n```\n\n\u307e\u305f\u3001Solr5\u3067\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u30b9\u30ad\u30fc\u30de\u30ec\u30b9\u30e2\u30fc\u30c9\u306b\u306a\u3063\u3066\u304a\u308a\u3001schema.xml\u3067\u30b9\u30ad\u30fc\u30de\u3092\u6307\u5b9a\u3067\u304d\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\n[REST\u3067\u30b9\u30ad\u30fc\u30de\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b](http://blog.johtani.info/blog/2013/07/04/schemaless-example/)\u3088\u3046\u3067\u3059\u304c\u3001\u30b9\u30ad\u30eb\u304c\u306a\u3044\u306e\u3067\u30af\u30e9\u30b7\u30c3\u30af\u306aschema.xml\u3067\u306e\u6307\u5b9a\u3092\u4f7f\u3046\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\nSchemaFactory\u306e\u5909\u66f4\u3002\n\n```xml:hsw_server/solr/collection1/conf/solrconfig.xml\n  <!--\n  <schemaFactory class=\"ManagedIndexSchemaFactory\">\n    <bool name=\"mutable\">true</bool>\n    <str name=\"managedSchemaResourceName\">managed-schema</str>\n  </schemaFactory>\n  -->\n  <schemaFactory class=\"ClassicIndexSchemaFactory\"/>\n```\n\nAddSchemaFieldsUpdateProcessorFactory\u306e\u8a2d\u5b9a\u306e\u524a\u9664\u3002\n\n```xml:hsw_server/solr/collection1/conf/solrconfig.xml\n    <!--\n    <processor class=\"solr.AddSchemaFieldsUpdateProcessorFactory\">\n      <str name=\"defaultFieldType\">strings</str>\n      <lst name=\"typeMapping\">\n        <str name=\"valueClass\">java.lang.Boolean</str>\n        <str name=\"fieldType\">booleans</str>\n      </lst>\n      <lst name=\"typeMapping\">\n        <str name=\"valueClass\">java.util.Date</str>\n        <str name=\"fieldType\">tdates</str>\n      </lst>\n      <lst name=\"typeMapping\">\n        <str name=\"valueClass\">java.lang.Long</str>\n        <str name=\"valueClass\">java.lang.Integer</str>\n        <str name=\"fieldType\">tlongs</str>\n      </lst>\n      <lst name=\"typeMapping\">\n        <str name=\"valueClass\">java.lang.Number</str>\n        <str name=\"fieldType\">tdoubles</str>\n      </lst>\n    </processor>\n    -->\n```\n\n\u30ea\u30af\u30a8\u30b9\u30c8\u30cf\u30f3\u30c9\u30e9\u306e\u8a2d\u5b9a\u3002\n\u3053\u308c\u306fData Import Handler\u3068\u3044\u3046\u6a5f\u80fd\u3092\u4f7f\u3046\u305f\u3081\u306e\u8a2d\u5b9a\u3067\u3001\u8a2d\u5b9a\u81ea\u4f53\u306fdataconfig.xml\u306b\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n```xml:hsw_server/solr/collection1/conf/solrconfig.xml\n  <requestHandler name=\"/dataimport-hswtest\" class=\"org.apache.solr.handler.dataimport.DataImportHandler\" >\n    <lst name=\"defaults\">\n      <str name=\"config\">dataconfig.xml</str>\n    </lst>\n  </requestHandler>\n```\n\ndataconfig.xml\u306e\u8a2d\u5b9a\u3002\nPostgres\u3067\u8a2d\u5b9a\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u3084\u3089\u30d1\u30b9\u30ef\u30fc\u30c9\u3084\u3089\u30c6\u30fc\u30d6\u30eb\u3084\u3089\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```xml:hsw_server/solr/collection1/conf/dataconfig.xml\n<dataConfig>\n  <dataSource name=\"ratings\"\n              driver=\"org.postgresql.Driver\"\n              url=\"jdbc:postgresql://localhost:5432/postdb\"\n              user=\"solruser\"\n              password=\"solrpassword\" />\n\n  <document>\n    <entity name=\"forum\"\n            query=\"select * from forum\"\n            deltaQuery=\"select id from forum where updated >= '${dataimporter.last_index_time}'\"\n            deltaImportQuery=\"select * from forum where id=${dataimporter.delta.id}\">\n      <field column=\"id\" name=\"id\" />\n      <field column=\"name\" name=\"name\" />\n      <field column=\"body\" name=\"body\" />\n      <field column=\"updated\" name=\"updated\" />\n    </entity>\n  </document>\n</dataConfig>\n```\n\n\u307e\u305f\u3001\u5fd8\u308c\u305a\u306bJDBC\u306ejar\u3082solrconfig.xml\u3067\u6307\u5b9a\u3057\u305f\u5834\u6240\u306b\u7f6e\u3044\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```\n$ cp postgresql-9.4.1207.jre6.jar /home/hashiwa/solr/solr-5.3.1-bin/hsw_server/lib/\n```\n\nschema.xml\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```xml:hsw_server/solr/collection1/conf/schema.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<schema name=\"hsw-example\" version=\"1.5\">\n   <field name=\"id\" type=\"string\" indexed=\"true\" stored=\"true\" required=\"true\" />\n   <field name=\"name\" type=\"text_en\" indexed=\"true\" stored=\"true\" termVectors=\"true\" termPositions=\"true\" />\n   <field name=\"body\" type=\"text_en\" indexed=\"true\" stored=\"true\" termVectors=\"true\" termPositions=\"true\" />\n   <field name=\"updated\" type=\"timestamp\" indexed=\"true\" stored=\"true\" termVectors=\"true\" termPositions=\"true\" />\n   <field name=\"_version_\" type=\"long\" indexed=\"true\" stored=\"true\"/>\n\n   <fieldType name=\"long\" class=\"solr.TrieLongField\" precisionStep=\"0\" positionIncrementGap=\"0\"/>\n   <fieldType name=\"string\" class=\"solr.StrField\" sortMissingLast=\"true\" />\n   <fieldType name=\"timestamp\" class=\"solr.TrieDateField\" />\n   <fieldType name=\"text_en\" class=\"solr.TextField\">\n     <analyzer>\n       <tokenizer class=\"solr.StandardTokenizerFactory\"/>\n       <filter class=\"solr.LowerCaseFilterFactory\"/>\n       <filter class=\"solr.StopFilterFactory\" ignoreCase=\"true\" words=\"lang/stopwords_en.txt\" />\n     </analyzer>\n   </fieldType>\n\n   <uniqueKey>id</uniqueKey>\n <!-- depricated\n   <defaultSearchField>body</defaultSearchField>\n   <solrQueryParser defaultOperator=\"AND\" />\n -->\n</schema>\n```\n\n\u6ce8\u610f\u70b9\uff1a\n\n- solr.LongField\u304c\u306a\u304f\u306a\u3063\u3066\u3044\u308b\u3089\u3057\u304f\u3001solr.TrieLongField\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\n- id\u3092long\u306b\u3059\u308b\u3068\u3001elevate.xml\u3067id=MA147LL/A\u3068\u3057\u3066\u3044\u308b\u304b\u3089\u304b\u30a8\u30e9\u30fc\u306b\u306a\u308b\u305f\u3081\u3001string\u306b\u3059\u308b\n\n# 6. Solr\u306e\u8d77\u52d5\u30fb\u30c7\u30fc\u30bf\u30a4\u30f3\u30dd\u30fc\u30c8\n\n\u3044\u3088\u3044\u3088Solr\u3092\u89e6\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\nSolr\u3092\u8d77\u52d5\u3002\u3053\u306e\u3068\u304d\u3001\u8a2d\u5b9a\u3057\u305f\u30b5\u30fc\u30d0\u30fc\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```\n$ bin/solr start -d hsw_server/\nWaiting up to 30 seconds to see Solr running on port 8983 [/]\nStarted Solr server on port 8983 (pid=20468). Happy searching!\n```\n\nSolr\u306e\u30b3\u30f3\u30bd\u30fc\u30eb( http://localhost:8983/solr/ )\u306b\u30a2\u30af\u30bb\u30b9\u3002\n\n![solr-01.jpg](https://qiita-image-store.s3.amazonaws.com/0/107431/accbe6d8-b616-5210-0008-7f3ad491e6a1.jpeg)\n\n[Core Selector]\u304b\u3089collection1\u3092\u9078\u629e\u3057\u3001[DataImport]\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n![solr-02.jpg](https://qiita-image-store.s3.amazonaws.com/0/107431/1b0ee970-8ce1-e9e8-5a83-f3160969e583.jpeg)\n\n\u3053\u3053\u3067\u3001forum\u3092\u9078\u3093\u3067Execute\u3059\u308b\u3068\u3001solrconfig.xml\u3067\u8a2d\u5b9a\u3057\u305fData Import Handler\u3092\u5b9f\u884c\u3057\u3066\u3001Postgres\u304b\u3089\u30c7\u30fc\u30bf\u3092Solr\u306b\u30a4\u30f3\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002\n(\u3044\u304f\u3089\u5f85\u3063\u3066\u3082\u753b\u9762\u304c\u66f4\u65b0\u3055\u308c\u306a\u3044\u5834\u5408\u306f\u3001[Reflesh Status]\u3092\u62bc\u3057\u3066\u307f\u308b)\n\n![solr-03.jpg](https://qiita-image-store.s3.amazonaws.com/0/107431/126e86bf-16ea-eea4-e2ed-e401b15b53fb.jpeg)\n\n\u6210\u529f\u3057\u3066\u3044\u305f\u3089\u3001[Query]\u3067\u691c\u7d22\u3057\u3066\u307f\u307e\u3059\u3002\n\u3061\u3083\u3093\u3068Postgres\u306b\u5165\u308c\u305f3\u3064\u306e\u30c7\u30fc\u30bf\u304c\u691c\u7d22\u3055\u308c\u307e\u3057\u305f\uff01\n\n![solr-04.jpg](https://qiita-image-store.s3.amazonaws.com/0/107431/5e987b7d-fc82-fcf2-1ada-7a31f44f8a62.jpeg)\n\n\n# \u53c2\u8003\u8cc7\u6599\n- [Solr + PostgreSQL\u9023\u643a(Solr4.9)](http://open-groove.net/solr/solr4-postgresql/)\n- [Apache Solr 5.3.0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b](http://d.hatena.ne.jp/Kazuhira/20150905/1441462251)\n- [Index a DB table directly into Solr](https://wiki.apache.org/solr/DIHQuickStart)\n\n[^1]: 2015/12/30\u8ffd\u8a18 collection1\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u5b58\u5728\u3057\u306a\u304b\u3063\u305f\u304b\u3082\u3002\u306a\u3051\u308c\u3070\u3001Solr\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u306a\u3069\u3067\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n", "tags": ["solr", "PostgreSQL"]}