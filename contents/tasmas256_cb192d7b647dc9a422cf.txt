{"context": "Amazon Linux \u306b WEB\u30b5\u30fc\u30d0 (Nginx + Tomcat + Let's Encrypt) \u3092\u69cb\u7bc9\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\nAmazon Linux \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\nAmazon Linux AMI 2016.09.0 (HVM), SSD Volume Type - ami-0c11b26d\n\u3092\u4f7f\u7528\u3057\u3066\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u69cb\u7bc9\u3059\u308b\u3002\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u8a2d\u5b9a\u3067Http/Https\u3067\u306e\u901a\u4fe1\u3092\u53ef\u80fd\u306b\u3057\u3066\u304a\u304f\u3002\nTomcat\u306e\u8d77\u52d5\u78ba\u8a8d\u7528\u306b8080\u3082\u901a\u4fe1\u53ef\u80fd\u306b\u3057\u3066\u304a\u304f\u3002\nElastic IP\u3092\u5272\u308a\u5f53\u3066\u3001DNS\u306e\u8a2d\u5b9a\u3092\u884c\u3063\u3066\u304a\u304f\u3002\n\n\nNginx \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3092\u3057\u305f\u4e0a\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3046\u3002\nsudo yum update -y\nsudo yum install -y nginx\n\nnginx\u3092\u8d77\u52d5\u3057\u3001\u81ea\u52d5\u8d77\u52d5\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3002\nsudo service nginx start\nsudo chkconfig nginx on\n\nnginx\u306eWelcome\u753b\u9762\u304c\u958b\u3051\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\nhttp://xxx.example.com\n\nJava \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\njdk1.8\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\nsudo yum install -y java-1.8.0-openjdk-devel\n\n\u65e2\u306b1.7\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001alternatives \u3067Java\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u5207\u308a\u66ff\u3048\u308b\u3002\nsudo alternatives --config java\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u30012\u3092\u9078\u629e\u3059\u308b\u3002\n2 \u30d7\u30ed\u30b0\u30e9\u30e0\u304c\u3042\u308a 'java' \u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002\n\n  \u9078\u629e       \u30b3\u30de\u30f3\u30c9\n-----------------------------------------------\n*+ 1           /usr/lib/jvm/jre-1.7.0-openjdk.x86_64/bin/java\n   2           /usr/lib/jvm/jre-1.8.0-openjdk.x86_64/bin/java\n\nEnter \u3092\u62bc\u3057\u3066\u73fe\u5728\u306e\u9078\u629e [+] \u3092\u4fdd\u6301\u3059\u308b\u304b\u3001\u9078\u629e\u756a\u53f7\u3092\u5165\u529b\u3057\u307e\u3059:\n\n\nTomcat \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\uff08tomcat8.5\u3067\u306f\u306a\u304ftomcat8\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u305f\u3081\u30018.5\u304c\u3088\u3044\u5834\u5408\u306f\u8abf\u3079\u3066\u5bfe\u5fdc\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff09\nsudo yum install -y tomcat8 tomcat8-webapps\n\n\u203btomcat8-webapps \u306f\u8d77\u52d5\u78ba\u8a8d\u7528\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u308b\u3002\u7701\u7565\u53ef\u3002\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3057\u3001\u81ea\u52d5\u8d77\u52d5\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3002\nsudo service tomcat8 start\nsudo chkconfig tomcat8 on\n\ntomcat\u306e\u753b\u9762\u304c\u958b\u3051\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\uff08tomcat8-webapps\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u5834\u5408\uff09\u3002\nhttp://xxx.example.com:8080\n\nCertbot\u30af\u30e9\u30a4\u30a2\u30f3\u30c8 (\u65e7\u79f0\uff1aLet's Enrypt\u30af\u30e9\u30a4\u30a2\u30f3\u30c8)\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nwget https://dl.eff.org/certbot-auto\nchmod a+x certbot-auto\n./certbot-auto --debug\n\n\u53c2\u7167\nhttps://letsencrypt.jp/usage/install-certbot.html#OtherUNIX\nAmazon Linux \u306f\u6b63\u5f0f\u5bfe\u5fdc\u304c\u6e08\u3093\u3067\u3044\u306a\u3044\u306e\u3067 --debug \u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u5fc5\u8981\u3002\n\nSSL/TLS\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u3092\u53d6\u5f97\n./certbot certonly --standalone -d \u30c9\u30e1\u30a4\u30f3\u540d\n\n\u9014\u4e2d\u3001\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u6c42\u3081\u3089\u308c\u308b\u3002\n\u4f5c\u6210\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u306f\u4ee5\u4e0b\u306b\u4fdd\u5b58\u3055\u308c\u308b\u3002\n/etc/letsencrypt/live/\n\nNginx \u306e\u8a2d\u5b9a\n/etc/nginx/nginx.conf \u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3002\nuser nginx;\nworker_processes auto;\nerror_log /var/log/nginx/error.log;\npid /var/run/nginx.pid;\n\ninclude /usr/share/nginx/modules/*.conf;\n\nevents {\n    worker_connections 1024;\n}\n\nhttp {\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    access_log  /var/log/nginx/access.log  main;\n\n    sendfile            on;\n    tcp_nopush          on;\n    tcp_nodelay         on;\n    keepalive_timeout   65;\n    types_hash_max_size 2048;\n\n    include             /etc/nginx/mime.types;\n    default_type        application/octet-stream;\n\n    include /etc/nginx/conf.d/*.conf;\n\n    index   index.html index.htm;\n\n    upstream tomcat {\n        server 127.0.0.1:8080 fail_timeout=0;\n    }\n\n    server {\n        listen       80;\n        server_name  xxx.example.com;\n        return 301 https://$host$request_uri;\n    }\n\n    server {\n        listen       443 ssl;\n        server_name  xxx.example.com;\n        ssl_certificate /etc/letsencrypt/live/xxx.example.com/fullchain.pem;\n        ssl_certificate_key /etc/letsencrypt/live/xxx.example.com/privkey.pem;\n\n        location / {\n            proxy_set_header X-Forwarded-Host $host;\n            proxy_set_header X-Forwarded-Server $host;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto https;\n            proxy_redirect http:// https://;\n            proxy_pass http://tomcat/;\n        }\n\n    }\n}\n\nnginx \u3092\u518d\u8d77\u52d5\u3059\u308b\u3002\nsudo service nginx restart\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068https\u3067\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u3066tomcat\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u3002\nhttp://xxx.example.com\nAmazon Linux \u306b WEB\u30b5\u30fc\u30d0 (Nginx + Tomcat + Let's Encrypt) \u3092\u69cb\u7bc9\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n## Amazon Linux \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\n\nAmazon Linux AMI 2016.09.0 (HVM), SSD Volume Type - ami-0c11b26d\n\u3092\u4f7f\u7528\u3057\u3066\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u69cb\u7bc9\u3059\u308b\u3002\n\n- \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u8a2d\u5b9a\u3067Http/Https\u3067\u306e\u901a\u4fe1\u3092\u53ef\u80fd\u306b\u3057\u3066\u304a\u304f\u3002\n- Tomcat\u306e\u8d77\u52d5\u78ba\u8a8d\u7528\u306b8080\u3082\u901a\u4fe1\u53ef\u80fd\u306b\u3057\u3066\u304a\u304f\u3002\n- Elastic IP\u3092\u5272\u308a\u5f53\u3066\u3001DNS\u306e\u8a2d\u5b9a\u3092\u884c\u3063\u3066\u304a\u304f\u3002\n\n## Nginx \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nyum\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3092\u3057\u305f\u4e0a\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3046\u3002\n\n```sh\nsudo yum update -y\nsudo yum install -y nginx\n```\n\nnginx\u3092\u8d77\u52d5\u3057\u3001\u81ea\u52d5\u8d77\u52d5\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\n```sh\nsudo service nginx start\nsudo chkconfig nginx on\n```\n\nnginx\u306eWelcome\u753b\u9762\u304c\u958b\u3051\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\nhttp://_xxx.example.com_\n\n## Java \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\njdk1.8\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\n```sh\nsudo yum install -y java-1.8.0-openjdk-devel\n```\n\n\u65e2\u306b1.7\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001alternatives \u3067Java\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u5207\u308a\u66ff\u3048\u308b\u3002\n\n```sh\nsudo alternatives --config java\n```\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u30012\u3092\u9078\u629e\u3059\u308b\u3002\n\n```sh\n2 \u30d7\u30ed\u30b0\u30e9\u30e0\u304c\u3042\u308a 'java' \u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002\n\n  \u9078\u629e       \u30b3\u30de\u30f3\u30c9\n-----------------------------------------------\n*+ 1           /usr/lib/jvm/jre-1.7.0-openjdk.x86_64/bin/java\n   2           /usr/lib/jvm/jre-1.8.0-openjdk.x86_64/bin/java\n   \nEnter \u3092\u62bc\u3057\u3066\u73fe\u5728\u306e\u9078\u629e [+] \u3092\u4fdd\u6301\u3059\u308b\u304b\u3001\u9078\u629e\u756a\u53f7\u3092\u5165\u529b\u3057\u307e\u3059:\n```\n\n## Tomcat \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nyum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\uff08tomcat8.5\u3067\u306f\u306a\u304ftomcat8\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u305f\u3081\u30018.5\u304c\u3088\u3044\u5834\u5408\u306f\u8abf\u3079\u3066\u5bfe\u5fdc\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff09\n\n```sh\nsudo yum install -y tomcat8 tomcat8-webapps\n```\n\n\u203btomcat8-webapps \u306f\u8d77\u52d5\u78ba\u8a8d\u7528\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u308b\u3002\u7701\u7565\u53ef\u3002\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3057\u3001\u81ea\u52d5\u8d77\u52d5\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\n```sh\nsudo service tomcat8 start\nsudo chkconfig tomcat8 on\n```\n\ntomcat\u306e\u753b\u9762\u304c\u958b\u3051\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\uff08tomcat8-webapps\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u5834\u5408\uff09\u3002\n\nhttp://_xxx.example.com_:8080\n\n## Certbot\u30af\u30e9\u30a4\u30a2\u30f3\u30c8 (\u65e7\u79f0\uff1aLet's Enrypt\u30af\u30e9\u30a4\u30a2\u30f3\u30c8)\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```sh\nwget https://dl.eff.org/certbot-auto\nchmod a+x certbot-auto\n./certbot-auto --debug\n```\n\n\u53c2\u7167\nhttps://letsencrypt.jp/usage/install-certbot.html#OtherUNIX\n\nAmazon Linux \u306f\u6b63\u5f0f\u5bfe\u5fdc\u304c\u6e08\u3093\u3067\u3044\u306a\u3044\u306e\u3067 --debug \u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u5fc5\u8981\u3002\n\n## SSL/TLS\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u3092\u53d6\u5f97\n\n```sh\n./certbot certonly --standalone -d \u30c9\u30e1\u30a4\u30f3\u540d\n```\n\n\u9014\u4e2d\u3001\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u6c42\u3081\u3089\u308c\u308b\u3002\n\n\u4f5c\u6210\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u306f\u4ee5\u4e0b\u306b\u4fdd\u5b58\u3055\u308c\u308b\u3002\n\n/etc/letsencrypt/live/\n\n## Nginx \u306e\u8a2d\u5b9a\n\n/etc/nginx/nginx.conf \u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n\n```conf\nuser nginx;\nworker_processes auto;\nerror_log /var/log/nginx/error.log;\npid /var/run/nginx.pid;\n\ninclude /usr/share/nginx/modules/*.conf;\n\nevents {\n    worker_connections 1024;\n}\n\nhttp {\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    access_log  /var/log/nginx/access.log  main;\n\n    sendfile            on;\n    tcp_nopush          on;\n    tcp_nodelay         on;\n    keepalive_timeout   65;\n    types_hash_max_size 2048;\n\n    include             /etc/nginx/mime.types;\n    default_type        application/octet-stream;\n\n    include /etc/nginx/conf.d/*.conf;\n\n    index   index.html index.htm;\n\n    upstream tomcat {\n        server 127.0.0.1:8080 fail_timeout=0;\n    }\n\n    server {\n        listen       80;\n        server_name  xxx.example.com;\n        return 301 https://$host$request_uri;\n    }\n\n    server {\n        listen       443 ssl;\n        server_name  xxx.example.com;\n        ssl_certificate /etc/letsencrypt/live/xxx.example.com/fullchain.pem;\n        ssl_certificate_key /etc/letsencrypt/live/xxx.example.com/privkey.pem;\n\n        location / {\n            proxy_set_header X-Forwarded-Host $host;\n            proxy_set_header X-Forwarded-Server $host;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto https;\n            proxy_redirect http:// https://;\n            proxy_pass http://tomcat/;\n        }\n\n    }\n}\n```\n\nnginx \u3092\u518d\u8d77\u52d5\u3059\u308b\u3002\n\n```sh\nsudo service nginx restart\n```\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068https\u3067\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u3066tomcat\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\nhttp://_xxx.example.com_\n", "tags": ["nginx", "Tomcat", "AmazonLinux", "certbot"]}