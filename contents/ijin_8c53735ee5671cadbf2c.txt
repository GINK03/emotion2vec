{"tags": ["AWS", "IAM", "vpc"], "context": " More than 1 year has passed since last update.\u4e3b\u306b\u8aa4\u64cd\u4f5c\u9632\u6b62\u7528\u306b\u3002\n\n\u6ce8\u610f\nRDS\u306e\u306fIAM Policy Simulator\u3067\u306f\u901a\u308b\u306b\u3082\u95a2\u308f\u3089\u305a\u3001\u4f55\u6545\u304bManaged Policy\u306b\u3059\u308b\u3068\u52d5\u304b\u306a\u3044\u3068\u3044\u3046\u8b0e\u306e\u6319\u52d5\u3002Inline Policy\u3060\u3068\u52d5\u304f\u3002\u30d0\u30b0\uff1f\uff082015/7/3\u73fe\u5728\uff09\n\nEC2\n\n\u8d77\u52d5\u306fvpc-abcd1234\u3067VPC ID\u3092\u6307\u5b9a\u3057\u3066\u9650\u5b9a\u53ef\u80fd\n\u505c\u6b62\u7b49\u306fec2:Vpc\u306eresource level permission\u304c\u4f7f\u3048\u306a\u3044\u306e\u3067 Vpc: myvpc\u7b49\u306e\u30bf\u30b0\u3067\u9650\u5b9a\uff08ec2:CreateTags\u306f\u305d\u3082\u305d\u3082\u5236\u9650\u4e0d\u53ef\u80fd\u306a\u306e\u3067\u3042\u307e\u308a\u53b3\u5bc6\u3067\u306f\u306a\u3044\u304c\uff09\n\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"UnsupportedResourceLevelPermissions\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"ec2:Describe*\",\n                \"ec2:*Tags\",\n                \"ec2:Get*\",\n                \"ec2:*KeyPair\",\n                \"ec2:AllocateAddress\",\n                \"ec2:AssociateAddress\",\n                \"ec2:AttachNetworkInterface\",\n                \"ec2:AttachVolume\",\n                \"ec2:CancelSpotInstanceRequests\",\n                \"ec2:CopyImage\",\n                \"ec2:CopySnapshot\",\n                \"ec2:CreateImage\",\n                \"ec2:CreateSnapshot\",\n                \"ec2:CreateVolume\",\n                \"ec2:DeleteSnapshot\",\n                \"ec2:DeleteVolume\",\n                \"ec2:DetachNetworkInterface\",\n                \"ec2:DetachVolume\",\n                \"ec2:DisassociateAddress\",\n                \"ec2:EnableVolumeIO\",\n                \"ec2:ModifyImageAttribute\",\n                \"ec2:ModifyInstanceAttribute\",\n                \"ec2:ModifyNetworkInterfaceAttribute\",\n                \"ec2:ModifySnapshotAttribute\",\n                \"ec2:ModifyVolumeAttribute\",\n                \"ec2:MonitorInstances\",\n                \"ec2:ReleaseAddress\",\n                \"ec2:ReportInstanceStatus\",\n                \"ec2:RequestSpotInstances\",\n                \"ec2:UnmonitorInstances\"\n            ],\n            \"Resource\": \"*\"\n        },\n        {\n            \"Sid\": \"LaunchInstanceInSubnetMyVpc\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"ec2:RunInstances\"\n            ],\n            \"Resource\": \"arn:aws:ec2:ap-northeast-1:123456789000:subnet/*\",\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"ec2:Vpc\": \"arn:aws:ec2:ap-northeast-1:123456789000:vpc/vpc-abcd1234\"\n                }\n            }\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": \"ec2:RunInstances\",\n            \"Resource\": [\n                \"arn:aws:ec2:ap-northeast-1::image/*\",\n                \"arn:aws:ec2:ap-northeast-1:123456789000:instance/*\",\n                \"arn:aws:ec2:ap-northeast-1:123456789000:volume/*\",\n                \"arn:aws:ec2:ap-northeast-1:123456789000:network-interface/*\",\n                \"arn:aws:ec2:ap-northeast-1:123456789000:key-pair/*\",\n                \"arn:aws:ec2:ap-northeast-1:123456789000:security-group/*\"\n            ]\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"ec2:TerminateInstances\",\n                \"ec2:StopInstances\",\n                \"ec2:StartInstances\",\n                \"ec2:RebootInstances\"\n            ],\n            \"Resource\": [\n                \"arn:aws:ec2:ap-northeast-1:123456789000:instance/*\"\n            ],\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"ec2:ResourceTag/Vpc\": \"myvpc\"\n                }\n            }\n        }\n    ]\n}\n\n\nDB\n\n\u8d77\u52d5\u306b\u95a2\u3057\u3066\u306fVPC ID\u306e\u6307\u5b9a\u304c\u4f7f\u3048\u306a\u3044\u306e\u3067VPC\u306b\u7d10\u4ed8\u3044\u305fdb subnet group\u306epredefined key\uff08rds:subgrp-tag\uff09\u306b\u30bf\u30b0\u3092\u4ed8\u3051\u3066\u9650\u5b9a\uff08\u4e00\u898brds:Vpc\u3067\u51fa\u6765\u308b\u3088\u3046\u306b\u898b\u3048\u308b\u304c\u3001\u3053\u3061\u3089\u306fVPC\u5185\u3067\u5b9f\u884c\u3059\u308b\u304b\u5426\u304b\u306ekey\uff09\n\u524a\u9664\u306fEC2\u540c\u69d8\u3001\u30bf\u30b0\u3067\u9650\u5b9a\u3002\uff08rds:db-tag\u306epredefined key\uff09\n\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"UnsupportedResourceLevelPermissions\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"ec2:Describe*\"\n            ],\n            \"Resource\": \"*\"\n        },\n        {\n            \"Sid\": \"LaunchRDSInSubnetMyVpc\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"rds:CreateDBInstanc*\",\n                \"rds:RestoreDBInstanc*\"\n            ],\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringLike\": {\n                    \"rds:subgrp-tag/Vpc\": [\n                        \"myvpc\"\n                    ]\n                }\n            }\n        },\n        {\n            \"Sid\": \"DeleteRDSWithTag\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"rds:DeleteDBInstance\"\n            ],\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringLike\": {\n                    \"rds:db-tag/Vpc\": [\n                        \"myvpc\"\n                    ]\n                }\n            }\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"rds:A*\",\n                \"rds:Copy*\",\n                \"rds:CreateDB*Group\",\n                \"rds:CreateDBSnapshot\",\n                \"rds:EventSubscription\",\n                \"rds:DeleteDB*Group\",\n                \"rds:DeleteDBSnapshot\",\n                \"rds:Describe*\",\n                \"rds:DownloadDBLogFilePortion\",\n                \"rds:ListTagsForResource\",\n                \"rds:Modify*\",\n                \"rds:PromoteReadReplica\",\n                \"rds:RebootDBInstance\",\n                \"rds:Remove*\",\n                \"rds:ResetDBParameterGroup\",\n                \"rds:RevokeDBSecurityGroupIngress\"\n            ],\n            \"Resource\": \"*\"\n        }\n    ]\n}\n\n\n\u53c2\u8003\nhttp://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-supported-iam-actions-resources.html\nhttp://docs.aws.amazon.com/AWSEC2/latest/APIReference/ec2-api-permissions.html#ec2-api-unsupported-resource-permissions\nhttp://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.IAM.html\nhttp://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.IAM.ResourcePermissions.html\n\u4e3b\u306b\u8aa4\u64cd\u4f5c\u9632\u6b62\u7528\u306b\u3002\n\n## \u6ce8\u610f\nRDS\u306e\u306fIAM Policy Simulator\u3067\u306f\u901a\u308b\u306b\u3082\u95a2\u308f\u3089\u305a\u3001\u4f55\u6545\u304bManaged Policy\u306b\u3059\u308b\u3068\u52d5\u304b\u306a\u3044\u3068\u3044\u3046\u8b0e\u306e\u6319\u52d5\u3002Inline Policy\u3060\u3068\u52d5\u304f\u3002\u30d0\u30b0\uff1f\uff082015/7/3\u73fe\u5728\uff09\n\n## EC2\n\n* \u8d77\u52d5\u306f`vpc-abcd1234`\u3067VPC ID\u3092\u6307\u5b9a\u3057\u3066\u9650\u5b9a\u53ef\u80fd\n* \u505c\u6b62\u7b49\u306f`ec2:Vpc`\u306eresource level permission\u304c\u4f7f\u3048\u306a\u3044\u306e\u3067 `Vpc: myvpc`\u7b49\u306e\u30bf\u30b0\u3067\u9650\u5b9a\uff08`ec2:CreateTags`\u306f\u305d\u3082\u305d\u3082\u5236\u9650\u4e0d\u53ef\u80fd\u306a\u306e\u3067\u3042\u307e\u308a\u53b3\u5bc6\u3067\u306f\u306a\u3044\u304c\uff09\n\n```json\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"UnsupportedResourceLevelPermissions\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"ec2:Describe*\",\n                \"ec2:*Tags\",\n                \"ec2:Get*\",\n                \"ec2:*KeyPair\",\n                \"ec2:AllocateAddress\",\n                \"ec2:AssociateAddress\",\n                \"ec2:AttachNetworkInterface\",\n                \"ec2:AttachVolume\",\n                \"ec2:CancelSpotInstanceRequests\",\n                \"ec2:CopyImage\",\n                \"ec2:CopySnapshot\",\n                \"ec2:CreateImage\",\n                \"ec2:CreateSnapshot\",\n                \"ec2:CreateVolume\",\n                \"ec2:DeleteSnapshot\",\n                \"ec2:DeleteVolume\",\n                \"ec2:DetachNetworkInterface\",\n                \"ec2:DetachVolume\",\n                \"ec2:DisassociateAddress\",\n                \"ec2:EnableVolumeIO\",\n                \"ec2:ModifyImageAttribute\",\n                \"ec2:ModifyInstanceAttribute\",\n                \"ec2:ModifyNetworkInterfaceAttribute\",\n                \"ec2:ModifySnapshotAttribute\",\n                \"ec2:ModifyVolumeAttribute\",\n                \"ec2:MonitorInstances\",\n                \"ec2:ReleaseAddress\",\n                \"ec2:ReportInstanceStatus\",\n                \"ec2:RequestSpotInstances\",\n                \"ec2:UnmonitorInstances\"\n            ],\n            \"Resource\": \"*\"\n        },\n        {\n            \"Sid\": \"LaunchInstanceInSubnetMyVpc\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"ec2:RunInstances\"\n            ],\n            \"Resource\": \"arn:aws:ec2:ap-northeast-1:123456789000:subnet/*\",\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"ec2:Vpc\": \"arn:aws:ec2:ap-northeast-1:123456789000:vpc/vpc-abcd1234\"\n                }\n            }\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": \"ec2:RunInstances\",\n            \"Resource\": [\n                \"arn:aws:ec2:ap-northeast-1::image/*\",\n                \"arn:aws:ec2:ap-northeast-1:123456789000:instance/*\",\n                \"arn:aws:ec2:ap-northeast-1:123456789000:volume/*\",\n                \"arn:aws:ec2:ap-northeast-1:123456789000:network-interface/*\",\n                \"arn:aws:ec2:ap-northeast-1:123456789000:key-pair/*\",\n                \"arn:aws:ec2:ap-northeast-1:123456789000:security-group/*\"\n            ]\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"ec2:TerminateInstances\",\n                \"ec2:StopInstances\",\n                \"ec2:StartInstances\",\n                \"ec2:RebootInstances\"\n            ],\n            \"Resource\": [\n                \"arn:aws:ec2:ap-northeast-1:123456789000:instance/*\"\n            ],\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"ec2:ResourceTag/Vpc\": \"myvpc\"\n                }\n            }\n        }\n    ]\n}\n```\n\n## DB\n\n* \u8d77\u52d5\u306b\u95a2\u3057\u3066\u306fVPC ID\u306e\u6307\u5b9a\u304c\u4f7f\u3048\u306a\u3044\u306e\u3067VPC\u306b\u7d10\u4ed8\u3044\u305fdb subnet group\u306epredefined key\uff08`rds:subgrp-tag`\uff09\u306b\u30bf\u30b0\u3092\u4ed8\u3051\u3066\u9650\u5b9a\uff08\u4e00\u898b`rds:Vpc`\u3067\u51fa\u6765\u308b\u3088\u3046\u306b\u898b\u3048\u308b\u304c\u3001\u3053\u3061\u3089\u306fVPC\u5185\u3067\u5b9f\u884c\u3059\u308b\u304b\u5426\u304b\u306ekey\uff09\n* \u524a\u9664\u306fEC2\u540c\u69d8\u3001\u30bf\u30b0\u3067\u9650\u5b9a\u3002\uff08`rds:db-tag`\u306epredefined key\uff09\n\n```json\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"UnsupportedResourceLevelPermissions\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"ec2:Describe*\"\n            ],\n            \"Resource\": \"*\"\n        },\n        {\n            \"Sid\": \"LaunchRDSInSubnetMyVpc\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"rds:CreateDBInstanc*\",\n                \"rds:RestoreDBInstanc*\"\n            ],\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringLike\": {\n                    \"rds:subgrp-tag/Vpc\": [\n                        \"myvpc\"\n                    ]\n                }\n            }\n        },\n        {\n            \"Sid\": \"DeleteRDSWithTag\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"rds:DeleteDBInstance\"\n            ],\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringLike\": {\n                    \"rds:db-tag/Vpc\": [\n                        \"myvpc\"\n                    ]\n                }\n            }\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"rds:A*\",\n                \"rds:Copy*\",\n                \"rds:CreateDB*Group\",\n                \"rds:CreateDBSnapshot\",\n                \"rds:EventSubscription\",\n                \"rds:DeleteDB*Group\",\n                \"rds:DeleteDBSnapshot\",\n                \"rds:Describe*\",\n                \"rds:DownloadDBLogFilePortion\",\n                \"rds:ListTagsForResource\",\n                \"rds:Modify*\",\n                \"rds:PromoteReadReplica\",\n                \"rds:RebootDBInstance\",\n                \"rds:Remove*\",\n                \"rds:ResetDBParameterGroup\",\n                \"rds:RevokeDBSecurityGroupIngress\"\n            ],\n            \"Resource\": \"*\"\n        }\n    ]\n}\n```\n\n\n## \u53c2\u8003\nhttp://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-supported-iam-actions-resources.html\nhttp://docs.aws.amazon.com/AWSEC2/latest/APIReference/ec2-api-permissions.html#ec2-api-unsupported-resource-permissions\nhttp://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.IAM.html\nhttp://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.IAM.ResourcePermissions.html\n"}