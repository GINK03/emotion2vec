{"tags": ["fluentd", "S3"], "context": "\n\nTL;DR\n\n\u2460 td-agent\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u2461 td-agent\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u8abf\u6574\n\u2462 td-agent\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u8a2d\u5b9a\n\n\n\u6e96\u5099\n\u4e0b\u8a18\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092td-agent\u7d4c\u7531\u3067\u3001AWS S3\u3078\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u3002\n\u306a\u304a\u3001apache\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u3001AWS S3\u3078\u306eAMI\u8a2d\u5b9a\u304c\u6e08\u3093\u3067\u3044\u308b\u72b6\u614b\u3068\u3059\u308b\u3002\n/var/log/httpd/access_log\n/var/log/httpd/error_log\n\n\n\u64cd\u4f5c\u624b\u9806\n\u2460 td-agent\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ntd-agent \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\ncurl -L https://toolbelt.treasuredata.com/sh/install-redhat-td-agent2.sh | sh\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n\ntd-agent -v                                                                                           \n\nPlugin \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb   \n\ntd-agent-gem install fluent-plugin-s3\ntd-agent-gem install fluent-plugin-forest\n\n\u2461 td-agent\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u8abf\u6574\n\u30ed\u30b0\u914d\u7f6e\u5834\u6240\u4f5c\u6210    \n\nmkdir /var/log/td-agent/s3\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u8ffd\u8a18    \n\nvi /etc/td-agent/td-agent.conf\n\n\u5bfe\u8c61\u30ed\u30b0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6a29\u9650\u5909\u66f4   \n\nchmod o+x /var/log/httpd\n\n\u2462 td-agent\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u8a2d\u5b9a\n\nvi /etc/td-agent/td-agent.conf\n\n#Apache\n<source>\n type tail\n format none\n path /var/log/httpd/access_log\n pos_file /var/log/td-agent/httpd.access.pos\n tag td.httpd.access\n</source>\n\n<source>\n type tail\n format none\n path /var/log/httpd/error_log\n pos_file /var/log/td-agent/httpd.error.pos\n tag td.httpd.error\n</source>\n\n<match td.httpd.**>\n type forest\n subtype s3\n <template>\n  aws_key_id (your-aws-key)\n  aws_sec_key (your-aws-secretkey)\n  s3_bucket test-backup\n  s3_region ap-northeast-1\n  s3_enpoint s3-ap-northeast-1.amazonaws.com\n </template>\n  <case *.httpd.access>\n   buffer_type file\n   buffer_path /var/log/td-agent/buffer/httpd.access\n   path log/httpd/access_log/${hostname}/access_log_\n  </case>\n  <case *.httpd.error>\n   buffer_type file\n   buffer_path /var/log/td-agent/buffer/httpd.error\n   path log/httpd/error_log/${hostname}/error_log_\n  </case>\n</match>\n\n\n\u4e0b\u8a18\u8a2d\u5b9a\u9805\u76ee\u304c\u3042\u308c\u3070\u3001\u30ed\u30fc\u30ab\u30eb\u30d0\u30c3\u30d5\u30a1\u304b\u3089S3\u3078\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5f85\u6a5f\u6642\u9593\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3002\ntime_slice_format %Y%m%d\ntime_slice_wait 10m\n\ntd-agent\u505c\u6b62\u6642\u306b\u30d5\u30a1\u30a4\u30eb\u30d0\u30c3\u30d5\u30a1\u3092S3\u3078\u30a2\u30c3\u30d7\u3059\u308b\u304b\u3001\u30a2\u30c3\u30d7\u305b\u305a\u306b\u6b8b\u3057\u3066\u304a\u304f\u306f\u4e0b\u8a18\u3067\u9078\u629e\u53ef\u80fd\u3002\n\nflush_at_shutdown true\n\n\n\u53c2\u7167\n\nfluentd\u306eoutput_s3\u30d7\u30e9\u30b0\u30a4\u30f3\nhttp://qiita.com/munazo/items/d665e2c4e86f42d06cf7\n\u3053\u308c\u306f\u4fbf\u5229\uff01fluentd\u304c\u66f4\u306b\u4fbf\u5229\u306b\u306a\u308bfluent-plugin-forest\nhttp://tech-sketch.jp/2014/03/%E3%81%93%E3%82%8C%E3%81%AF%E4%BE%BF%E5%88%A9%EF%BC%81fluentd%E3%81%8C%E6%9B%B4%E3%81%AB%E4%BE%BF%E5%88%A9%E3%81%AB%E3%81%AA%E3%82%8Bfluent-plugin-forest.html\nFluentd\u306e\u4ed5\u7d44\u307f -\u30d0\u30c3\u30d5\u30a1\u6a5f\u80fd\u3067\u30ed\u30b0\u53ce\u96c6\u6f0f\u308c\u3092\u9632\u3050-\nhttp://tech-sketch.jp/2013/05/fluentd-buffer.html\n\n## TL;DR\n\n- \u2460 td-agent\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n- \u2461 td-agent\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u8abf\u6574\n- \u2462 td-agent\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u8a2d\u5b9a\n\n## \u6e96\u5099\n\n\u4e0b\u8a18\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092td-agent\u7d4c\u7531\u3067\u3001AWS S3\u3078\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u3002\n\u306a\u304a\u3001apache\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u3001AWS S3\u3078\u306eAMI\u8a2d\u5b9a\u304c\u6e08\u3093\u3067\u3044\u308b\u72b6\u614b\u3068\u3059\u308b\u3002\n\n```\n/var/log/httpd/access_log\n/var/log/httpd/error_log\n```\n\n## \u64cd\u4f5c\u624b\u9806\n\n\u2460 td-agent\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\ntd-agent \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n> curl -L https://toolbelt.treasuredata.com/sh/install-redhat-td-agent2.sh | sh\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n> td-agent -v\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\nPlugin \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\t\n> td-agent-gem install fluent-plugin-s3\n> td-agent-gem install fluent-plugin-forest\n\n\u2461 td-agent\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u8abf\u6574\n\n\u30ed\u30b0\u914d\u7f6e\u5834\u6240\u4f5c\u6210\t\n> mkdir /var/log/td-agent/s3\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u8ffd\u8a18\t\n> vi /etc/td-agent/td-agent.conf\n\n\u5bfe\u8c61\u30ed\u30b0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6a29\u9650\u5909\u66f4\t\n> chmod o+x /var/log/httpd\n\n\u2462 td-agent\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u8a2d\u5b9a\n\n> vi /etc/td-agent/td-agent.conf\n\n```\n#Apache\n<source>\n type tail\n format none\n path /var/log/httpd/access_log\n pos_file /var/log/td-agent/httpd.access.pos\n tag td.httpd.access\n</source>\n\n<source>\n type tail\n format none\n path /var/log/httpd/error_log\n pos_file /var/log/td-agent/httpd.error.pos\n tag td.httpd.error\n</source>\n\n<match td.httpd.**>\n type forest\n subtype s3\n <template>\n  aws_key_id (your-aws-key)\n  aws_sec_key (your-aws-secretkey)\n  s3_bucket test-backup\n  s3_region ap-northeast-1\n  s3_enpoint s3-ap-northeast-1.amazonaws.com\n </template>\n  <case *.httpd.access>\n   buffer_type file\n   buffer_path /var/log/td-agent/buffer/httpd.access\n   path log/httpd/access_log/${hostname}/access_log_\n  </case>\n  <case *.httpd.error>\n   buffer_type file\n   buffer_path /var/log/td-agent/buffer/httpd.error\n   path log/httpd/error_log/${hostname}/error_log_\n  </case>\n</match>\n\n```\n\n\u4e0b\u8a18\u8a2d\u5b9a\u9805\u76ee\u304c\u3042\u308c\u3070\u3001\u30ed\u30fc\u30ab\u30eb\u30d0\u30c3\u30d5\u30a1\u304b\u3089S3\u3078\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5f85\u6a5f\u6642\u9593\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3002\n\n```\ntime_slice_format %Y%m%d\ntime_slice_wait 10m\n```\n\ntd-agent\u505c\u6b62\u6642\u306b\u30d5\u30a1\u30a4\u30eb\u30d0\u30c3\u30d5\u30a1\u3092S3\u3078\u30a2\u30c3\u30d7\u3059\u308b\u304b\u3001\u30a2\u30c3\u30d7\u305b\u305a\u306b\u6b8b\u3057\u3066\u304a\u304f\u306f\u4e0b\u8a18\u3067\u9078\u629e\u53ef\u80fd\u3002\n```\nflush_at_shutdown true\n```\n\n\n### \u53c2\u7167\n\n- fluentd\u306eoutput_s3\u30d7\u30e9\u30b0\u30a4\u30f3\nhttp://qiita.com/munazo/items/d665e2c4e86f42d06cf7\n\n- \u3053\u308c\u306f\u4fbf\u5229\uff01fluentd\u304c\u66f4\u306b\u4fbf\u5229\u306b\u306a\u308bfluent-plugin-forest\nhttp://tech-sketch.jp/2014/03/%E3%81%93%E3%82%8C%E3%81%AF%E4%BE%BF%E5%88%A9%EF%BC%81fluentd%E3%81%8C%E6%9B%B4%E3%81%AB%E4%BE%BF%E5%88%A9%E3%81%AB%E3%81%AA%E3%82%8Bfluent-plugin-forest.html\n\n- Fluentd\u306e\u4ed5\u7d44\u307f -\u30d0\u30c3\u30d5\u30a1\u6a5f\u80fd\u3067\u30ed\u30b0\u53ce\u96c6\u6f0f\u308c\u3092\u9632\u3050-\nhttp://tech-sketch.jp/2013/05/fluentd-buffer.html\n"}