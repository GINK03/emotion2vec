{"context": "\n\n\u306f\u3058\u3081\u306b\n\u5927\u4f53\u63a2\u3057\u3064\u304f\u306e\u306f\u3001\u4ee5\u4e0b\u306e\u3082\u306e\u3067\u3042\u308b\n#182 Cropping Images \n#182 Cropping Images (revised)\n\u554f\u984c\u306f\u3001\u3053\u308c\u3089\u306f\u3068\u3066\u3082\u4f7f\u3048\u308b\u304c\u3059\u3067\u306b5\u5e74\u524d\u306e\u305f\u3081\u306b\u3001\u53e4\u304f\u3066Rails4\u3067\u305d\u306e\u307e\u307e\u4f7f\u3046\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3002\n\u4f5c\u8005\u3082\u3053\u306e\u307e\u307e\u3067\u6311\u6226\u3057\u305f\u304c\u3001Infinite loop\u304c\u8d77\u3053\u3063\u305f\u3002\n\u4ee5\u4e0b\u306e\u69d8\u306aStack Overflow\u306b\u3042\u305f\u308b\u3053\u3068\u306b\u306a\u308b\u3002\npaperclip jcrop and rails 4 infinite loop fix\n\u4eca\u56de\u3055\u4f5c\u8005\u304c\u3001\u3044\u308d\u3044\u308d\u8abf\u3079\u3001\u6700\u7d42\u7684\u306b\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u307e\u3067\u6642\u9593\u304c\u304b\u304b\u3063\u305f\u306e\u3067\u3001\u3053\u3053\u306b\u66f8\u3044\u3066\u4ed6\u306e\u4eba\u306e\u53c2\u8003\u306b\u306a\u308c\u3070\u3068\u601d\u3044\u3001\u8a18\u3059\u3002\n\u57fa\u672c\u7684\u306b\u3001\u4e0a\u8a18\u306e\u30b3\u30fc\u30c9\u3092\u305d\u306e\u307e\u307e\u4f7f\u3046\u304c\u3001\u4e00\u90e8\u5909\u66f4\u304c\u3042\u308b\u3002\u6d41\u308c\u3092\u7406\u89e3\u3059\u308b\u305f\u3081\u306b\u3001\u4e0a\u306e\u30d3\u30c7\u30aa\u3092\u898b\u308b\u3053\u3068\u3092\u5968\u52b1\u3059\u308b\u3002\n\n\u524d\u63d0\n\u3059\u3067\u306bPaperclip\u3067\u753b\u50cf\u3092\u4fdd\u5b58\u3067\u304d\u308b\u72b6\u614b\u3060\u3068\u3059\u308b\u3002\n\u4eca\u56de\u4f5c\u8005\u306e\u6761\u4ef6\u306f\u3001User\u30e2\u30c7\u30eb\u306b\u3001image\u3068\u3044\u3046\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u3092\u4fdd\u5b58\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n\u672c\u984c\n\n1. Jcrop\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3001Rails\u3067\u8aad\u307f\u8fbc\u3080\nJcrop \u00bb the jQuery Image Cropping Plugin\n\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3001jquery.Jcrop.js\u3068jquery.Jcrop.min.css\u3092\u305d\u308c\u305e\u308c\u3001vendor/assets/javascripts/\u3068 vendor/assets/stylesheets/\u306b\u7f6e\u304f\n\u3053\u308c\u3092app/assets/javascripts/application.js\u3067\u4ee5\u4e0b\u306e\u69d8\u306b\u8aad\u307f\u8fbc\u3080\n//= require jquery.Jcrop\n\napp/assets/javascripts/application.css\n*= require jquery.Jcrop.min\n\n\n\u3053\u308c\u3067jcrop\u3092\u8aad\u307f\u8fbc\u3080\u3053\u3068\u304c\u3067\u304d\u305f\uff01\n\n2. crop\u3059\u308b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f5c\u308a\u3001\u305d\u3053\u306b\u98db\u3070\u3059\u3088\u3046\u306b\u3059\u308b\u3002\napp/views/users/crop.haml\n:javascript\n  $(function(){\n    $(\"#cropbox\").Jcrop({//\u30b5\u30a4\u30ba\u5909\u66f4\u304c\u3042\u3063\u305f\u3089\u3001\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3059\u308b\n      onChange: update_crop,\n      onSelect: update_crop,\n      setSelect: [0,0,300,300],\n      aspectRatio: 1\n    });\n  });\n  function update_crop(coords){//\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3059\u308b\u95a2\u6570\u3067\u3001\n    var rx = 100/coords.w;\n    var ry = 100/coords.h;\n    $(\"#preview\").css({//\u30d7\u30ec\u30d3\u30e5\u30fc\u3092\u66f4\u65b0\u3059\u308b\u3002\n      width: Math.round(rx * #{ @user.image_geometry(:medium).width }) + 'px',\n      height: Math.round(ry * #{ @user.image_geometry(:medium).height }) + 'px',\n      marginLeft: '-' + Math.round(rx * coords.x) + 'px',\n      marginTop: '-' + Math.round(ry * coords.y) + 'px'\n    });\n    var ratio = #{@user.image_geometry(:original).width}/#{@user.image_geometry(:medium).width};\n    $(\"#crop_x\").val(coords.x * ratio);//\u30af\u30ed\u30c3\u30d7\u3059\u308b\u305f\u3081\u306e4\u3064\u306e\u5909\u6570\u3092form\u306e\u4e2d\u3067\u66f4\u65b0\u3059\u308b\u3002\n    $(\"#crop_y\").val(coords.y * ratio);//\n    $(\"#crop_w\").val(coords.w * ratio);//\n    $(\"#crop_h\").val(coords.h * ratio);//\n  }\n= image_tag @user.image.url(:medium), id: \"cropbox\"\n\n%h4 \u30d7\u30ec\u30d3\u30e5\u30fc\n%div{style: \"width:100px; height:100px; overflow:hidden\"}\n  = image_tag @user.image.url(:medium), id: \"preview\"\n\n\n= form_for @user do |f|\n  .form-group\n    - for attribute in [:crop_x, :crop_y, :crop_w, :crop_h]\n      = f.hidden_field attribute, id: attribute\n\n  %p= f.submit '\u9001\u4fe1', class: 'btn btn-primary'\n\n\nusers_controller.rb\u306eupdate\uff08create\u3067\u3082\uff09\u3067\u3001\u753b\u50cf\u304c\u66f4\u65b0\u3055\u308c\u308b\u3068\u304d\u306b\u3001crop\u306b\u98db\u3076\u3088\u3046\u306b\u3059\u308b\u3002\n  def update\n    @user = User.find_by(account: params[:id])\n    if @user.update_attributes(user_params)\n      if params[:user][:image].blank?#\u753b\u50cf\u304c\u306a\u3044\u3068\u304d\u306f\u3001\u4eca\u307e\u3067\u3069\u304a\u308a\u66f4\u65b0\n        flash[:success] = \"\u66f4\u65b0\u3055\u308c\u307e\u3057\u305f\"\n        redirect_to @user\n      else#\u753b\u50cf\u304c\u3042\u308b\u3068\u304d\u306f\u3001Crop\u306b\u98db\u3070\u3059\u3002\n        render :crop\n      end\n    else\n      render :edit\n    end\n  end\n\n\n3. user\u30e2\u30c7\u30eb\u3067\u3001\u66f4\u65b0\u3057\u305f\u6642\u306b\u3001\u753b\u50cf\u3092\u5909\u66f4\u3059\u308b\u3088\u3046\u306b\u30b3\u30fc\u30c9\u3092\u8db3\u3059\napp/models/user.rb\nattr_accessor .... , :crop_x, :crop_y, :crop_w, :crop_h\nafter_update :reprocess_image, if: :cropping?#\u30af\u30ed\u30c3\u30d7\u3059\u308b\u305f\u3081\u306e\u4f4d\u7f6e\u60c5\u5831\u304c\u9001\u3089\u308c\u3066\u304d\u305f\u3089\u3001update\u306e\u5f8c\u306b\u3001reprocess_image\u3068\u3044\u3046Private\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3076\n\n...\n\nhas_attached_file :image, styles: {medium: \"300x300>\", thumb: \"100x100#\", icon: \"40x40#\"}, processors: [:cropper]\n# medium\u3092\u4f7f\u3063\u3066Crop\u3059\u308b\u306e\u3067\u3001\u201d>\u201d\u3092\u4f7f\u3046\u3002\"#\"\u3092\u4f7f\u3046\u3068\u76f4\u63a5\u771f\u3093\u4e2d\u90e8\u5206\u3092\u6b63\u65b9\u5f62\u306b\u5207\u308a\u53d6\u3063\u3066\u3001\u4fdd\u5b58\u3055\u308c\u3066\u3057\u307e\u3046\u305f\u3081\u3001\u5207\u308a\u53d6\u308a\u4f5c\u696d\u3092\u884c\u3046\u3068\u304d\u306b\u3001\u3059\u3067\u306b\u6b63\u65b9\u5f62\u306e\u3082\u306e\u304b\u3089\u3057\u304b\u5207\u308a\u53d6\u308c\u306a\u304f\u306a\u308b\uff01\n# processors: [:cropper]\u306f4\u306b\u66f8\u304f\u3001paperclip\u3092override\u3059\u308bClass\u540d\u3067\u3042\u308b\u3002\uff08\u3053\u306e\u540d\u524d\u306f\u4efb\u610f\uff09\n\ndef cropping?# \u30af\u30ed\u30c3\u30d7\u3059\u308b\u305f\u3081\u306e\u4f4d\u7f6e\u60c5\u5831\u304c\u9001\u3089\u308c\u3066\u304d\u305f\u304b\u30c1\u30a7\u30c3\u30af\n  crop_x && crop_y && crop_w && crop_h\nend\n\ndef image_geometry(style=:original)\n  @geometry ||= {}\n  @geometry[style] ||= Paperclip::Geometry.from_file(image.path(style))\nend\n\n...\n\nprivate\n\ndef reprocess_image # \u3053\u3053\u304c\u3001RailsCast\u3068\u9055\u3046\uff01\uff01\n  image.assign(image)\n  image.save\nend\n\n\n4. \u6700\u5f8c\u306b\u3001Paperclip\u3092Override\u3059\u308b(railscast\u3068\u7570\u306a\u308b\u90e8\u5206)\nconfig/initializers/cropper.rb\u306b\u4ee5\u4e0b\u3092\u66f8\u304f(railscast\u3067\u306f\u3001lib/processors/cropper.rb\u3068\u3057\u3066\u3044\u305f\u3002)\nmodule Paperclip\n  class Cropper < Thumbnail\n    def transformation_command\n      if crop_command\n        crop_command + super.join(' ').sub(/ -crop \\S+/, '').split(\" \")\n      else\n        super\n      end\n    end\n\n    def crop_command\n      target = @attachment.instance\n      if target.cropping?\n        [\" -crop\", \"#{target.crop_w}x#{target.crop_h}+#{target.crop_x}+#{target.crop_y}\"]\n      end\n    end\n  end\nend\n\n\u3001paperclip\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306bimagemagick\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u306e\u3067\u3001\u4e0a\u306e\u30b3\u30fc\u30c9\u306f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5909\u6570@user\u304b\u3089\u5f62\u3092\u6574\u3048\u3066\u3044\u308b\u3068\u601d\u3048\u3070\u3044\u3044\u3002\nconvert input.png -crop 100x100+0+10 output.png\n\n\u5b8c\u6210\uff01\n\n\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u5834\u5408\u306e\u30c1\u30a7\u30c3\u30af\u70b9\u3002\n\n\u5207\u308a\u51fa\u3057\u306eJcrop\u304c\u52d5\u3044\u3066\u3044\u308b\u304b\uff1f\nhidden_field\u3068\u306a\u3063\u3066\u3044\u308b\u3001crop_x, crop_y, crop_w, crop_h\u3092text_field\u306b\u5909\u3048\u308b\u3053\u3068\u3067\u3001\u5909\u6570\u304c\u3061\u3083\u3093\u3068\u3046\u3054\u3044\u3066\u3044\u308b\u304b\u3092\u30c1\u30a7\u30c3\u30af\u3067\u304d\u308b\n\noverride\u3057\u305ftransformation_command\u304c\u547c\u3070\u308c\u3066\u3044\u308b\u304b\u3002\nputs \"transformation_command\"\u306a\u3069\u3092\u5165\u308c\u3001\u78ba\u8a8d\u3002\nrailscast\u306e\u6307\u5b9a\u3059\u308b\u5834\u6240\u3060\u3068\u547c\u3070\u308c\u306a\u3044\u306e\u3067\u3001\u3053\u308c\u304c\u7d50\u69cb\u91cd\u8981\n\n\u53c2\u8003\nhow to allow users to crop images in rails 4\n#\u306f\u3058\u3081\u306b\n\u5927\u4f53\u63a2\u3057\u3064\u304f\u306e\u306f\u3001\u4ee5\u4e0b\u306e\u3082\u306e\u3067\u3042\u308b\n\n[#182 Cropping Images ](http://railscasts.com/episodes/182-cropping-images)\n[#182 Cropping Images (revised)](http://railscasts.com/episodes/182-cropping-images-revised)\n\n\u554f\u984c\u306f\u3001\u3053\u308c\u3089\u306f\u3068\u3066\u3082\u4f7f\u3048\u308b\u304c\u3059\u3067\u306b5\u5e74\u524d\u306e\u305f\u3081\u306b\u3001\u53e4\u304f\u3066Rails4\u3067\u305d\u306e\u307e\u307e\u4f7f\u3046\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3002\n\n\u4f5c\u8005\u3082\u3053\u306e\u307e\u307e\u3067\u6311\u6226\u3057\u305f\u304c\u3001Infinite loop\u304c\u8d77\u3053\u3063\u305f\u3002\n\n\u4ee5\u4e0b\u306e\u69d8\u306aStack Overflow\u306b\u3042\u305f\u308b\u3053\u3068\u306b\u306a\u308b\u3002\n[paperclip jcrop and rails 4 infinite loop fix](http://stackoverflow.com/questions/20033053/paperclip-jcrop-and-rails-4-infinite-loop-fix)\n\n\u4eca\u56de\u3055\u4f5c\u8005\u304c\u3001\u3044\u308d\u3044\u308d\u8abf\u3079\u3001\u6700\u7d42\u7684\u306b\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u307e\u3067\u6642\u9593\u304c\u304b\u304b\u3063\u305f\u306e\u3067\u3001\u3053\u3053\u306b\u66f8\u3044\u3066\u4ed6\u306e\u4eba\u306e\u53c2\u8003\u306b\u306a\u308c\u3070\u3068\u601d\u3044\u3001\u8a18\u3059\u3002\n\n\u57fa\u672c\u7684\u306b\u3001\u4e0a\u8a18\u306e\u30b3\u30fc\u30c9\u3092\u305d\u306e\u307e\u307e\u4f7f\u3046\u304c\u3001\u4e00\u90e8\u5909\u66f4\u304c\u3042\u308b\u3002\u6d41\u308c\u3092\u7406\u89e3\u3059\u308b\u305f\u3081\u306b\u3001\u4e0a\u306e\u30d3\u30c7\u30aa\u3092\u898b\u308b\u3053\u3068\u3092\u5968\u52b1\u3059\u308b\u3002\n\n#\u524d\u63d0\n\n\u3059\u3067\u306bPaperclip\u3067\u753b\u50cf\u3092\u4fdd\u5b58\u3067\u304d\u308b\u72b6\u614b\u3060\u3068\u3059\u308b\u3002\n\n\u4eca\u56de\u4f5c\u8005\u306e\u6761\u4ef6\u306f\u3001User\u30e2\u30c7\u30eb\u306b\u3001image\u3068\u3044\u3046\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u3092\u4fdd\u5b58\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n\n#\u672c\u984c\n\n##1. Jcrop\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3001Rails\u3067\u8aad\u307f\u8fbc\u3080\n\n[Jcrop \u00bb the jQuery Image Cropping Plugin](http://deepliquid.com/content/Jcrop.html)\n\n\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3001jquery.Jcrop.js\u3068jquery.Jcrop.min.css\u3092\u305d\u308c\u305e\u308c\u3001vendor/assets/javascripts/\u3068 vendor/assets/stylesheets/\u306b\u7f6e\u304f\n\n\u3053\u308c\u3092app/assets/javascripts/application.js\u3067\u4ee5\u4e0b\u306e\u69d8\u306b\u8aad\u307f\u8fbc\u3080\n\n```rb\n//= require jquery.Jcrop\n```\n\napp/assets/javascripts/application.css\n\n```rb\n*= require jquery.Jcrop.min\n\n```\n\u3053\u308c\u3067jcrop\u3092\u8aad\u307f\u8fbc\u3080\u3053\u3068\u304c\u3067\u304d\u305f\uff01\n\n##2. crop\u3059\u308b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f5c\u308a\u3001\u305d\u3053\u306b\u98db\u3070\u3059\u3088\u3046\u306b\u3059\u308b\u3002\n\napp/views/users/crop.haml\n\n```haml\n:javascript\n  $(function(){\n    $(\"#cropbox\").Jcrop({//\u30b5\u30a4\u30ba\u5909\u66f4\u304c\u3042\u3063\u305f\u3089\u3001\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3059\u308b\n      onChange: update_crop,\n      onSelect: update_crop,\n      setSelect: [0,0,300,300],\n      aspectRatio: 1\n    });\n  });\n  function update_crop(coords){//\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3059\u308b\u95a2\u6570\u3067\u3001\n    var rx = 100/coords.w;\n    var ry = 100/coords.h;\n    $(\"#preview\").css({//\u30d7\u30ec\u30d3\u30e5\u30fc\u3092\u66f4\u65b0\u3059\u308b\u3002\n      width: Math.round(rx * #{ @user.image_geometry(:medium).width }) + 'px',\n      height: Math.round(ry * #{ @user.image_geometry(:medium).height }) + 'px',\n      marginLeft: '-' + Math.round(rx * coords.x) + 'px',\n      marginTop: '-' + Math.round(ry * coords.y) + 'px'\n    });\n    var ratio = #{@user.image_geometry(:original).width}/#{@user.image_geometry(:medium).width};\n    $(\"#crop_x\").val(coords.x * ratio);//\u30af\u30ed\u30c3\u30d7\u3059\u308b\u305f\u3081\u306e4\u3064\u306e\u5909\u6570\u3092form\u306e\u4e2d\u3067\u66f4\u65b0\u3059\u308b\u3002\n    $(\"#crop_y\").val(coords.y * ratio);//\n    $(\"#crop_w\").val(coords.w * ratio);//\n    $(\"#crop_h\").val(coords.h * ratio);//\n  }\n= image_tag @user.image.url(:medium), id: \"cropbox\"\n\n%h4 \u30d7\u30ec\u30d3\u30e5\u30fc\n%div{style: \"width:100px; height:100px; overflow:hidden\"}\n  = image_tag @user.image.url(:medium), id: \"preview\"\n\n\n= form_for @user do |f|\n  .form-group\n    - for attribute in [:crop_x, :crop_y, :crop_w, :crop_h]\n      = f.hidden_field attribute, id: attribute\n\n  %p= f.submit '\u9001\u4fe1', class: 'btn btn-primary'\n\n```\n\nusers_controller.rb\u306eupdate\uff08create\u3067\u3082\uff09\u3067\u3001\u753b\u50cf\u304c\u66f4\u65b0\u3055\u308c\u308b\u3068\u304d\u306b\u3001crop\u306b\u98db\u3076\u3088\u3046\u306b\u3059\u308b\u3002\n\n```rb\n  def update\n    @user = User.find_by(account: params[:id])\n    if @user.update_attributes(user_params)\n      if params[:user][:image].blank?#\u753b\u50cf\u304c\u306a\u3044\u3068\u304d\u306f\u3001\u4eca\u307e\u3067\u3069\u304a\u308a\u66f4\u65b0\n        flash[:success] = \"\u66f4\u65b0\u3055\u308c\u307e\u3057\u305f\"\n        redirect_to @user\n      else#\u753b\u50cf\u304c\u3042\u308b\u3068\u304d\u306f\u3001Crop\u306b\u98db\u3070\u3059\u3002\n        render :crop\n      end\n    else\n      render :edit\n    end\n  end\n```\n\n## 3. user\u30e2\u30c7\u30eb\u3067\u3001\u66f4\u65b0\u3057\u305f\u6642\u306b\u3001\u753b\u50cf\u3092\u5909\u66f4\u3059\u308b\u3088\u3046\u306b\u30b3\u30fc\u30c9\u3092\u8db3\u3059\n\napp/models/user.rb\n\n```rb\nattr_accessor .... , :crop_x, :crop_y, :crop_w, :crop_h\nafter_update :reprocess_image, if: :cropping?#\u30af\u30ed\u30c3\u30d7\u3059\u308b\u305f\u3081\u306e\u4f4d\u7f6e\u60c5\u5831\u304c\u9001\u3089\u308c\u3066\u304d\u305f\u3089\u3001update\u306e\u5f8c\u306b\u3001reprocess_image\u3068\u3044\u3046Private\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3076\n\n...\n\nhas_attached_file :image, styles: {medium: \"300x300>\", thumb: \"100x100#\", icon: \"40x40#\"}, processors: [:cropper]\n# medium\u3092\u4f7f\u3063\u3066Crop\u3059\u308b\u306e\u3067\u3001\u201d>\u201d\u3092\u4f7f\u3046\u3002\"#\"\u3092\u4f7f\u3046\u3068\u76f4\u63a5\u771f\u3093\u4e2d\u90e8\u5206\u3092\u6b63\u65b9\u5f62\u306b\u5207\u308a\u53d6\u3063\u3066\u3001\u4fdd\u5b58\u3055\u308c\u3066\u3057\u307e\u3046\u305f\u3081\u3001\u5207\u308a\u53d6\u308a\u4f5c\u696d\u3092\u884c\u3046\u3068\u304d\u306b\u3001\u3059\u3067\u306b\u6b63\u65b9\u5f62\u306e\u3082\u306e\u304b\u3089\u3057\u304b\u5207\u308a\u53d6\u308c\u306a\u304f\u306a\u308b\uff01\n# processors: [:cropper]\u306f4\u306b\u66f8\u304f\u3001paperclip\u3092override\u3059\u308bClass\u540d\u3067\u3042\u308b\u3002\uff08\u3053\u306e\u540d\u524d\u306f\u4efb\u610f\uff09\n\ndef cropping?# \u30af\u30ed\u30c3\u30d7\u3059\u308b\u305f\u3081\u306e\u4f4d\u7f6e\u60c5\u5831\u304c\u9001\u3089\u308c\u3066\u304d\u305f\u304b\u30c1\u30a7\u30c3\u30af\n  crop_x && crop_y && crop_w && crop_h\nend\n\ndef image_geometry(style=:original)\n  @geometry ||= {}\n  @geometry[style] ||= Paperclip::Geometry.from_file(image.path(style))\nend\n\n...\n\nprivate\n\ndef reprocess_image # \u3053\u3053\u304c\u3001RailsCast\u3068\u9055\u3046\uff01\uff01\n  image.assign(image)\n  image.save\nend\n```\n\n\n\n## 4. \u6700\u5f8c\u306b\u3001Paperclip\u3092Override\u3059\u308b(railscast\u3068\u7570\u306a\u308b\u90e8\u5206)\n\nconfig/initializers/cropper.rb\u306b\u4ee5\u4e0b\u3092\u66f8\u304f(railscast\u3067\u306f\u3001lib/processors/cropper.rb\u3068\u3057\u3066\u3044\u305f\u3002)\n\n```rb\nmodule Paperclip\n  class Cropper < Thumbnail\n    def transformation_command\n      if crop_command\n        crop_command + super.join(' ').sub(/ -crop \\S+/, '').split(\" \")\n      else\n        super\n      end\n    end\n\n    def crop_command\n      target = @attachment.instance\n      if target.cropping?\n        [\" -crop\", \"#{target.crop_w}x#{target.crop_h}+#{target.crop_x}+#{target.crop_y}\"]\n      end\n    end\n  end\nend\n```\n\n\u3001paperclip\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306bimagemagick\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u306e\u3067\u3001\u4e0a\u306e\u30b3\u30fc\u30c9\u306f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5909\u6570@user\u304b\u3089\u5f62\u3092\u6574\u3048\u3066\u3044\u308b\u3068\u601d\u3048\u3070\u3044\u3044\u3002\n\n```bash\nconvert input.png -crop 100x100+0+10 output.png\n```\n\n\n\n\u5b8c\u6210\uff01\n\n## \u3046\u307e\u304f\u3044\u304b\u306a\u3044\u5834\u5408\u306e\u30c1\u30a7\u30c3\u30af\u70b9\u3002\n\n###\u5207\u308a\u51fa\u3057\u306eJcrop\u304c\u52d5\u3044\u3066\u3044\u308b\u304b\uff1f\n hidden_field\u3068\u306a\u3063\u3066\u3044\u308b\u3001crop_x, crop_y, crop_w, crop_h\u3092text_field\u306b\u5909\u3048\u308b\u3053\u3068\u3067\u3001\u5909\u6570\u304c\u3061\u3083\u3093\u3068\u3046\u3054\u3044\u3066\u3044\u308b\u304b\u3092\u30c1\u30a7\u30c3\u30af\u3067\u304d\u308b\n\n###override\u3057\u305ftransformation_command\u304c\u547c\u3070\u308c\u3066\u3044\u308b\u304b\u3002\nputs \"transformation_command\"\u306a\u3069\u3092\u5165\u308c\u3001\u78ba\u8a8d\u3002\nrailscast\u306e\u6307\u5b9a\u3059\u308b\u5834\u6240\u3060\u3068\u547c\u3070\u308c\u306a\u3044\u306e\u3067\u3001\u3053\u308c\u304c\u7d50\u69cb\u91cd\u8981\n\n\n#\u53c2\u8003\n[how to allow users to crop images in rails 4](http://andowebsit.es/blog/noteslog.com/post/how-to-allow-users-to-crop-images-in-rails-4/)\n\n", "tags": ["Rails4", "Rails", "paperclip", "Jcrop"]}