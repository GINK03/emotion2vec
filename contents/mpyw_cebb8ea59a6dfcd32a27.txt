{"context": " More than 1 year has passed since last update.\u4eca\u65e5\u81ea\u5206\u304c\u8a95\u751f\u65e5\u306a\u306e\u3067\u4f55\u3068\u306a\u304f\u3084\u308a\u305f\u304f\u306a\u3063\u305f\u3001\u305f\u3060\u305d\u308c\u3060\u3051\u306e\u7406\u7531\uff57\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n\n\u300c\u30e9\u30a4\u30d6\u30e9\u30ea\u306b\u983c\u3089\u306a\u3044TwitterAPI\u5165\u9580\u300d \u304b\u3089\u3044\u304f\u3089\u304b\u5f15\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n<?php\n\n/* \u8a2d\u5b9a */\nconst CONSUMER_KEY        = '';\nconst CONSUMER_SECRET     = '';\nconst ACCESS_TOKEN        = '';\nconst ACCESS_TOKEN_SECRET = '';\ndate_default_timezone_get('Asia/Tokyo');\n\n/* OAuth\u30ea\u30af\u30a8\u30b9\u30c8\u7528\u95a2\u6570(\u624b\u629c\u304d) */\nfunction twitter_get($url, array $params = []) { \n    // \u5fc5\u9808\u30d1\u30e9\u30e1\u30fc\u30bf\n    $oauth = [\n        'oauth_consumer_key'     => CONSUMER_KEY,\n        'oauth_signature_method' => 'HMAC-SHA1',\n        'oauth_timestamp'        => time(),\n        'oauth_version'          => '1.0a',\n        'oauth_nonce'            => md5(mt_rand()),\n        'oauth_token'            => ACCESS_TOKEN,\n    ];\n    // \u8ffd\u52a0\u30d1\u30e9\u30e1\u30fc\u30bf\n    $base = $oauth + $params;\n    // \u81ea\u7136\u9806\u30bd\u30fc\u30c8\n    uksort($base, 'strnatcmp');\n    // \u30b7\u30b0\u30cd\u30c1\u30e3\u3092\u751f\u6210\u3057\u3066\u5fc5\u9808\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u8ffd\u52a0\n    $oauth['oauth_signature'] = base64_encode(hash_hmac(\n        'sha1',\n        implode('&', array_map('rawurlencode', [\n            'GET',\n            $url,\n            http_build_query($base, '', '&', PHP_QUERY_RFC3986)\n        ])),\n        implode('&', array_map('rawurlencode', [\n            CONSUMER_SECRET,\n            ACCESS_TOKEN_SECRET\n        ])),\n        true\n    ));\n    // \u30d8\u30c3\u30c0\u30fc\u3092\u751f\u6210\n    foreach ($oauth as $name => $value) {\n        $items[] = sprintf('%s=\"%s\"', urlencode($name), urlencode($value));\n    }\n    $header = 'Authorization: OAuth ' . implode(', ', $items);\n    // cURL\u3067GET\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u3001JSON\u30c7\u30b3\u30fc\u30c9\u3057\u3066\u8fd4\u3059\n    $ch = curl_init();\n    curl_setopt_array($ch, [\n        CURLOPT_URL            => $url . '?' . http_build_query($params, '', '&'),\n        CURLOPT_HTTPHEADER     => array($header),\n        CURLOPT_SSL_VERIFYPEER => false,\n        CURLOPT_RETURNTRANSFER => true,\n        CURLOPT_ENCODING       => 'gzip',\n    ]);\n    return json_decode(curl_exec($ch));\n}\n\n/* \u8a95\u751f\u65e5\u3063\u307d\u3044\u4eba\u3005\u306eID\u3092\u53d6\u5f97 */\n$max_id = null;\n// 10\u30da\u30fc\u30b8\u5206\u691c\u7d22\u3059\u308b\nfor ($i = 0; $i < 10; ++$i) {\n    $result = twitter_get(\n        'https://api.twitter.com/1.1/search/tweets.json',\n        [\n            'q'      => '\u8a95\u751f\u65e5 \u304a\u3081\u3067\u3068\u3046 -\u5148 -\u65e9 -\u9045',\n            'count'  => 100,\n            'max_id' => $max_id,\n        ]\n    );\n    if (empty($result->statuses)) {\n        // \u30d2\u30c3\u30c8\u4ef6\u6570\u304c\u30bc\u30ed\u3082\u3057\u304f\u306f\u30a8\u30e9\u30fc\u306e\u5834\u5408\u305d\u3053\u3067\u7d42\u4e86\u3059\u308b\n        break;\n    }\n    foreach ($result->statuses as $status) {\n        // \u4eca\u65e5\u306e\u30c4\u30a4\u30fc\u30c8\u3067\u4e14\u3064\u30e1\u30f3\u30b7\u30e7\u30f3\u304c\u3042\u308b\u3082\u306e\u306b\u9650\u5b9a\n        if (\n            date('Y/m/d') === date('Y/m/d', strtotime($status->created_at)) &&\n            !empty($status->entities->user_mentions)\n        ) {\n            // 1\u3064\u76ee\u306e\u30e1\u30f3\u30b7\u30e7\u30f3\u306e\u30bf\u30fc\u30b2\u30c3\u30c8\u30e6\u30fc\u30b6\u30fcID\u3092\u914d\u5217\u306b\u8ffd\u52a0\n            $ids[] = $status->entities->user_mentions[0]->id_str;\n        }\n    }\n    // \u30da\u30fc\u30b8\u30cd\u30fc\u30b7\u30e7\u30f3\u7528\u30d1\u30e9\u30e1\u30fc\u30bf\n    $max_id = bcsub($status->id_str, 1);\n}\n\n/* ID\u304b\u3089\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u53d6\u5f97 */\nif (!empty($ids)) {\n    $users = [];\n    // 100\u4ef6\u305a\u3064\u5b9f\u884c\n    foreach (array_chunk($ids, 100) as $group) {\n        $result = twitter_get(\n            'https://api.twitter.com/1.1/users/lookup.json',\n            ['user_id' => implode(',', $group)]\n        );\n        if (is_array($result)) {\n            $users = array_merge($users, $result);\n        }\n    }\n}\n\n/* \u30d8\u30c3\u30c0\u30fc\u3092\u9001\u51fa */\nheader('Content-Type: application/xhtml+xml; charset=utf-8');\n\n?>\n<!DOCTYPE html>\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n  <head>\n    <title>\u672c\u65e5\u8a95\u751f\u65e5\u3092\u8fce\u3048\u3089\u308c\u305f\u4eba\u3005(\u304b\u3082\u3057\u308c\u306a\u3044)</title>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css\" />\n  </head>\n  <body>\n    <div class=\"container\">\n      <p class=\"page-header\">\n        <h1>\u672c\u65e5<code><?=date('Y\u5e74n\u6708j\u65e5')?></code>\u306b\u8a95\u751f\u65e5\u3092\u8fce\u3048\u3089\u308c\u305f(\u304b\u3082\u3057\u308c\u306a\u3044)\u4eba\u3005</h1>\n      </p>\n<?php if (!empty($users)): ?>\n      <p>\n<?php foreach ($users as $u): ?>\n          <?=sprintf(\n            '<a href=\"https://twitter.com/%1$s\" title=\"%1$s\"><img src=\"%2$s\" alt=\"%1$s\" /></a>' . \"\\n\",\n            $u->screen_name,\n            $u->profile_image_url\n          )?>\n<?php endforeach; ?>\n      </p>\n<?php endif; ?>\n    </div>\n  </body>\n</html>\n\n\n\u5b9f\u884c\u7d50\u679c\n\n\u307f\u3082\u308a\u3093 \u3068\u8a95\u751f\u65e5\u540c\u3058\u3060\u3063\u305f\u306e\u3092\u4eca\u306b\u306a\u3063\u3066\u77e5\u308b\n\n\uff082014\u6708\u306b\u306a\u3063\u3066\u308b\u306e\u306f\u6700\u521dtypo\u3057\u3066\u305f\u304b\u3089\u306a\u306e\u3067\u6c17\u306b\u3057\u306a\u3044\u3067\uff09\n\u4eca\u65e5\u81ea\u5206\u304c\u8a95\u751f\u65e5\u306a\u306e\u3067\u4f55\u3068\u306a\u304f\u3084\u308a\u305f\u304f\u306a\u3063\u305f\u3001\u305f\u3060\u305d\u308c\u3060\u3051\u306e\u7406\u7531\uff57\n\n# **\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9**\n\n**[\u300c\u30e9\u30a4\u30d6\u30e9\u30ea\u306b\u983c\u3089\u306a\u3044TwitterAPI\u5165\u9580\u300d](http://qiita.com/mpyw/items/b59d3ce03f08be126000)** \u304b\u3089\u3044\u304f\u3089\u304b\u5f15\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\n```php\n<?php\n\n/* \u8a2d\u5b9a */\nconst CONSUMER_KEY        = '';\nconst CONSUMER_SECRET     = '';\nconst ACCESS_TOKEN        = '';\nconst ACCESS_TOKEN_SECRET = '';\ndate_default_timezone_get('Asia/Tokyo');\n\n/* OAuth\u30ea\u30af\u30a8\u30b9\u30c8\u7528\u95a2\u6570(\u624b\u629c\u304d) */\nfunction twitter_get($url, array $params = []) { \n    // \u5fc5\u9808\u30d1\u30e9\u30e1\u30fc\u30bf\n    $oauth = [\n        'oauth_consumer_key'     => CONSUMER_KEY,\n        'oauth_signature_method' => 'HMAC-SHA1',\n        'oauth_timestamp'        => time(),\n        'oauth_version'          => '1.0a',\n        'oauth_nonce'            => md5(mt_rand()),\n        'oauth_token'            => ACCESS_TOKEN,\n    ];\n    // \u8ffd\u52a0\u30d1\u30e9\u30e1\u30fc\u30bf\n    $base = $oauth + $params;\n    // \u81ea\u7136\u9806\u30bd\u30fc\u30c8\n    uksort($base, 'strnatcmp');\n    // \u30b7\u30b0\u30cd\u30c1\u30e3\u3092\u751f\u6210\u3057\u3066\u5fc5\u9808\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u8ffd\u52a0\n    $oauth['oauth_signature'] = base64_encode(hash_hmac(\n        'sha1',\n        implode('&', array_map('rawurlencode', [\n            'GET',\n            $url,\n            http_build_query($base, '', '&', PHP_QUERY_RFC3986)\n        ])),\n        implode('&', array_map('rawurlencode', [\n            CONSUMER_SECRET,\n            ACCESS_TOKEN_SECRET\n        ])),\n        true\n    ));\n    // \u30d8\u30c3\u30c0\u30fc\u3092\u751f\u6210\n    foreach ($oauth as $name => $value) {\n        $items[] = sprintf('%s=\"%s\"', urlencode($name), urlencode($value));\n    }\n    $header = 'Authorization: OAuth ' . implode(', ', $items);\n    // cURL\u3067GET\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u3001JSON\u30c7\u30b3\u30fc\u30c9\u3057\u3066\u8fd4\u3059\n    $ch = curl_init();\n    curl_setopt_array($ch, [\n        CURLOPT_URL            => $url . '?' . http_build_query($params, '', '&'),\n        CURLOPT_HTTPHEADER     => array($header),\n        CURLOPT_SSL_VERIFYPEER => false,\n        CURLOPT_RETURNTRANSFER => true,\n        CURLOPT_ENCODING       => 'gzip',\n    ]);\n    return json_decode(curl_exec($ch));\n}\n\n/* \u8a95\u751f\u65e5\u3063\u307d\u3044\u4eba\u3005\u306eID\u3092\u53d6\u5f97 */\n$max_id = null;\n// 10\u30da\u30fc\u30b8\u5206\u691c\u7d22\u3059\u308b\nfor ($i = 0; $i < 10; ++$i) {\n    $result = twitter_get(\n        'https://api.twitter.com/1.1/search/tweets.json',\n        [\n            'q'      => '\u8a95\u751f\u65e5 \u304a\u3081\u3067\u3068\u3046 -\u5148 -\u65e9 -\u9045',\n            'count'  => 100,\n            'max_id' => $max_id,\n        ]\n    );\n    if (empty($result->statuses)) {\n        // \u30d2\u30c3\u30c8\u4ef6\u6570\u304c\u30bc\u30ed\u3082\u3057\u304f\u306f\u30a8\u30e9\u30fc\u306e\u5834\u5408\u305d\u3053\u3067\u7d42\u4e86\u3059\u308b\n        break;\n    }\n    foreach ($result->statuses as $status) {\n        // \u4eca\u65e5\u306e\u30c4\u30a4\u30fc\u30c8\u3067\u4e14\u3064\u30e1\u30f3\u30b7\u30e7\u30f3\u304c\u3042\u308b\u3082\u306e\u306b\u9650\u5b9a\n        if (\n            date('Y/m/d') === date('Y/m/d', strtotime($status->created_at)) &&\n            !empty($status->entities->user_mentions)\n        ) {\n            // 1\u3064\u76ee\u306e\u30e1\u30f3\u30b7\u30e7\u30f3\u306e\u30bf\u30fc\u30b2\u30c3\u30c8\u30e6\u30fc\u30b6\u30fcID\u3092\u914d\u5217\u306b\u8ffd\u52a0\n            $ids[] = $status->entities->user_mentions[0]->id_str;\n        }\n    }\n    // \u30da\u30fc\u30b8\u30cd\u30fc\u30b7\u30e7\u30f3\u7528\u30d1\u30e9\u30e1\u30fc\u30bf\n    $max_id = bcsub($status->id_str, 1);\n}\n\n/* ID\u304b\u3089\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u53d6\u5f97 */\nif (!empty($ids)) {\n    $users = [];\n    // 100\u4ef6\u305a\u3064\u5b9f\u884c\n    foreach (array_chunk($ids, 100) as $group) {\n        $result = twitter_get(\n            'https://api.twitter.com/1.1/users/lookup.json',\n            ['user_id' => implode(',', $group)]\n        );\n        if (is_array($result)) {\n            $users = array_merge($users, $result);\n        }\n    }\n}\n\n/* \u30d8\u30c3\u30c0\u30fc\u3092\u9001\u51fa */\nheader('Content-Type: application/xhtml+xml; charset=utf-8');\n\n?>\n<!DOCTYPE html>\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n  <head>\n    <title>\u672c\u65e5\u8a95\u751f\u65e5\u3092\u8fce\u3048\u3089\u308c\u305f\u4eba\u3005(\u304b\u3082\u3057\u308c\u306a\u3044)</title>\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css\" />\n  </head>\n  <body>\n    <div class=\"container\">\n      <p class=\"page-header\">\n        <h1>\u672c\u65e5<code><?=date('Y\u5e74n\u6708j\u65e5')?></code>\u306b\u8a95\u751f\u65e5\u3092\u8fce\u3048\u3089\u308c\u305f(\u304b\u3082\u3057\u308c\u306a\u3044)\u4eba\u3005</h1>\n      </p>\n<?php if (!empty($users)): ?>\n      <p>\n<?php foreach ($users as $u): ?>\n          <?=sprintf(\n            '<a href=\"https://twitter.com/%1$s\" title=\"%1$s\"><img src=\"%2$s\" alt=\"%1$s\" /></a>' . \"\\n\",\n            $u->screen_name,\n            $u->profile_image_url\n          )?>\n<?php endforeach; ?>\n      </p>\n<?php endif; ?>\n    </div>\n  </body>\n</html>\n```\n\n# **\u5b9f\u884c\u7d50\u679c**\n\n**[\u307f\u3082\u308a\u3093](http://mimorin.com/)** \u3068\u8a95\u751f\u65e5\u540c\u3058\u3060\u3063\u305f\u306e\u3092\u4eca\u306b\u306a\u3063\u3066\u77e5\u308b\n\n![\u8a95\u751f\u65e5](https://qiita-image-store.s3.amazonaws.com/0/25060/cd9e7df9-b993-8394-1885-aeb2eaf9b35d.png)\n\n\uff082014\u6708\u306b\u306a\u3063\u3066\u308b\u306e\u306f\u6700\u521dtypo\u3057\u3066\u305f\u304b\u3089\u306a\u306e\u3067\u6c17\u306b\u3057\u306a\u3044\u3067\uff09\n\n", "tags": ["PHP", "Twitter", "TwitterAPI", "\u8a95\u751f\u65e5"]}