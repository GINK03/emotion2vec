{"context": " More than 1 year has passed since last update.Scotch.io\u3067\u53d6\u308a\u4e0a\u3052\u3089\u308c\u3066\u3044\u305fprerender-node#1.2.1\u3067\u306f\u3001angular-ui-router#0.2.13\u306e\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u7d50\u679c\u3092\u3046\u307e\u304f\u53d6\u5f97\u3067\u304d\u306a\u304b\u3063\u305f\u306e\u3067\u3001DIY\u3067\u89e3\u6c7a\u3059\u308b\u624b\u9806\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\u5fd9\u3057\u3044\u4eba\u306fexpress-turnout#0.0.4-alpha\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\nPhantomjs 2.0.0 \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ phantomjs -v\u30672.0.0\u304c\u8fd4\u308b\u74b0\u5883\u3092\u7528\u610f\u3057\u307e\u3059\u3002\n\nWin (cmder)\n\u03bb curl -OL https://bitbucket.org/ariya/phantomjs/downloads/phantomjs-2.0.0-windows.zip\n\u03bb unzip phantomjs-2.0.0-windows.zip\n\u03bb mv %cd%\\phantomjs-2.0.0-windows\\bin\\phantomjs.exe %CMDER_ROOT%\\bin\\phantomjs.exe\n\u03bb phantomjs -v\n2.0.0\n\n\nMac (Terminal/Homebrew)\n$ brew install phantomjs\n$ phantomjs -v\n2.0.0\n\n\nLinux\n\u3053\u3061\u3089\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3001CentOS 5.9\u3067\u30d3\u30eb\u30c9\u306b\u6210\u529f\u3057\u307e\u3057\u305f\uff08\u7d42\u4e86\u307e\u3067\uff12\u6642\u9593\u8d85\u639b\u304b\u308a\u307e\u3059\uff09\u3002\n\nCompiling phantomJS 2.0 for AWS EC2 linux image\n\n\nnodejs\u304b\u3089phantomjs\u3092\u5b9f\u884c\u3059\u308b\n\u540c\u69d8\u306b\u3001node.js\u7d4c\u7531\u3067phantomjs\u304c\u5b9f\u884c\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ node\n\nvar exec= require('child_process').exec;\nexec('phantomjs -v',function(error,stdout){\n  console.log(stdout);// 2.0.0\n});\n\n\n\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u7528\u306e\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\n$ phantomjs render.js url\u30b3\u30de\u30f3\u30c9\u3067\u3001\u30af\u30ed\u30fc\u30e9\u30fc\u306e\u4ee3\u308f\u308a\u306b\u30da\u30fc\u30b8\u3092\u8a2a\u554f\u3057\u3001\u4efb\u610f\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u307e\u3067\u5f85\u3063\u3066\u304b\u3089\u3001\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u7d50\u679c\u3092\u53d6\u5f97\u3059\u308b\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n./render.js\n// Dependencies\nvar system= require('system');\nvar webpage= require('webpage');\n\n// Environment\nvar url= system.args[1];\n\n// Setup webpage\nvar page= webpage.create();\npage.open(url);\npage.onCallback= function(html){\n  system.stdout.write(html);\n  phantom.exit(0);\n};\n\n\n\u3053\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u3001\u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\u3067\u52d5\u4f5c\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n./index.html\n<script>\nif(window.callPhantom){\n  window.callPhantom(document.documentElement.outerHTML);\n}\n</script>\n\n\n$ phantomjs render.js index.html\n# <html><head><script>if(window.callPhantom){window.callPhantom(document.documentElement.outerHTML);}</script></head></html>\n\nwebpage\u5185\u306b\u306f\u3001window.callPhantom\u30e1\u30bd\u30c3\u30c9\u304c\u7528\u610f\u3055\u308c\u3066\u304a\u308a\u3001render.js\u306epage.onCallback\u3067\u7d50\u679c\u3092\u53d7\u3051\u53d6\u308a\u307e\u3059\u3002\n\u3053\u308c\u3092\u5229\u7528\u3057\u3066\u3001\u4efb\u610f\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u3001\u30af\u30ed\u30fc\u30e9\u30fc\u306b\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u7d50\u679c\u3092\u6e21\u3059\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n./index.html\n<!DOCTYPE html>\n<html lang=\"en\" ng-app=\"myApp\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>{{meta['og:site_name'] + ' | ' + title}}</title>\n  <meta content=\"{{value}}\" property=\"{{key}}\" ng-repeat=\"(key,value) in meta\">\n\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.15/angular.js\"></script>\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.14/angular-ui-router.js\"></script>\n\n  <script>\nangular.module('myApp',['ui.router'])\n.run(function($rootScope,$window,$location,$state){\n  $rootScope.$on('$viewContentLoaded',function(){\n    var renderedTemplate= $window.document.body.innerHTML.trim().length>0\n    if(renderedTemplate){\n      $rootScope.title= 'Welcome clawlers!';\n      $rootScope.meta= {\n        'og:site_name':$state.current.name,\n        'og:title':$rootScope.title,\n        'og:url':$location.absUrl(),\n        'og:type':'article',\n        'og:description':angular.element($window.document.body).text(),\n      }\n\n      if(window.callPhantom){\n        setTimeout(function(){\n          window.callPhantom(document.documentElement.outerHTML);\n        },0);\n      }\n    }\n  });\n})\n.config(function($stateProvider){\n  $stateProvider.state('private',{\n    url:'/private',\n    template:'<h1>private</h1>',\n  });\n  $stateProvider.state('second',{\n    url:'/second',\n    template:'<h1>second</h1><a ui-sref=\"first\">first</a>',\n  });\n  $stateProvider.state('first',{\n    url:'*path',\n    template:'<h1>first</h1><a ui-sref=\"second\">second</a>',\n  });\n})\n;\n  </script>\n</head>\n<body ui-view></body>\n</html>\n\n\n$ phantomjs render.js index.html\n# <html lang=\"en\" ng-app=\"myApp\" class=\"ng-scope\"><head><style type=\"text/css\">@charset \"UTF-8\";[ng\\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide:not(.ng-hide-animate){display:none !important;}ng\\:form{display:block;}</style>\n#   <meta charset=\"UTF-8\">\n#   <title class=\"ng-binding\">first | Welcome clawlers!</title>\n#   <!-- ngRepeat: (key,value) in meta --><meta content=\"firstsecond\" property=\"og:description\" ng-repeat=\"(key,value) in meta\" class=\"ng-scope\"><!-- end ngRepeat: (key,value) in meta --><meta content=\"first\" property=\"og:site_name\" ng-repeat=\"(key,value) in meta\" class=\"ng-scope\"><!-- end ngRepeat: (key,value) in meta --><meta content=\"Welcome clawlers!\" property=\"og:title\" ng-repeat=\"(key,value) in meta\" class=\"ng-scope\"><!-- end ngRepeat: (key,value) in meta --><meta content=\"article\" property=\"og:type\" ng-repeat=\"(key,value) in meta\" class=\"ng-scope\"><!-- end ngRepeat: (key,value) in meta --><meta content=\"file:///Users/59naga/Downloads/hoge.html\" property=\"og:url\" ng-repeat=\"(key,value) in meta\" class=\"ng-scope\"><!-- end ngRepeat: (key,value) in meta -->\n# \n#   <script src=\"https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.15/angular.js\"></script>\n#   <script src=\"https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.14/angular-ui-router.js\"></script>\n# \n#   <script>\n# angular.module('myApp',['ui.router'])\n# //...\n#   </script>\n# </head>\n# <!-- uiView:  --><body ui-view=\"\" class=\"ng-scope\"><h1 class=\"ng-scope\">first</h1><a ui-sref=\"second\" class=\"ng-scope\" href=\"#/second\">second</a></body></html>\n\n<meta>, <title>, <body>\u3092\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3057\u305f\u72b6\u614b\u3067\u3001\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u53d6\u5f97\u3067\u304d\u307e\u3057\u305f\u3002\n\n\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u5b9f\u884c\u3059\u308b\n\u4e0a\u8a18\u3092Express4\u304b\u3089\u4f7f\u7528\u3059\u308b\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002\n$ npm install express\n$ node app\n# listening at 59798\n$ curl -A Googlebot http://localhost:59798/\n# Prerendered source-code\n\n\n./app.js\n// Environment\nvar port= 59798;\n\n// Dependencies\nvar express= require('express');\nvar exec= require('child_process').exec;\n\n// Setup prerender\nvar prerender= express.Router();\nprerender.use(function(req,res,next){\n  var ua= req.headers['user-agent'] || '';\n  if(ua.match('Googlebot')==null){\n    return next();\n  }\n\n  var scriptFile= require.resolve('./render.js');\n  var uri= req.protocol+'://'+req.get('host')+req.originalUrl;\n  var script= 'phantomjs '+scriptFile+' '+uri;\n  exec(script,function(error,stdout,stderr){\n    if(error){\n      res.status(403);\n      res.end(stderr);\n      return;\n    }\n    res.set('Content-Type','text/html');\n    res.end(stdout);\n  });\n});\n\n// Setup express\nvar app= express();\napp.use(prerender);\napp.use(function(req, res) {\n  res.sendFile(__dirname + '/index.html');\n});\n\n// Boot\napp.listen(port, function() {\n  console.log('listening at %s', port);\n});\n\n\n\n\u6ce8\u610f\n\n\u8a18\u4e8b\u5185\u306e\u30b3\u30fc\u30c9\u306f\u3001\u4f8b\u5916\u51e6\u7406\u3092\u7701\u3044\u305f\u6700\u4f4e\u9650\u306e\u30b3\u30fc\u30c9\u3067\u3059\u3002\n\u5b9f\u884c\u30b3\u30b9\u30c8\u304c\u9ad8\u304f\u3001\u30ec\u30b9\u30dd\u30f3\u30b9\u306b\uff11\u79d2\u4ee5\u4e0a\u639b\u304b\u308b\u3053\u3068\u3082\u5c11\u306a\u304f\u3042\u308a\u307e\u305b\u3093\u3002\u5b9f\u969b\u306b\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u3001\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3001\u30d6\u30e9\u30c3\u30af\u30ea\u30b9\u30c8\u30fb\u30db\u30ef\u30a4\u30c8\u30ea\u30b9\u30c8\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u5fc5\u8981\u306b\u306a\u308b\u3067\u3057\u3087\u3046\u3002\n\u524d\uff12\u6a5f\u80fd\u306fexpress-turnout\u3068\u3044\u3046\u30e9\u30a4\u30d6\u30e9\u30ea\u306b\u5b9f\u88c5\u3057\u307e\u3057\u305f\u3002ui-router\u3092\u4f7f\u3063\u305f\u30da\u30fc\u30b8\u306b\u4f7f\u7528\u3057\u3066\u3001Google\u304c\u8a2a\u554f\u3057\u305f\u5f8c\u306e\u691c\u7d22\u7d50\u679c\u304c\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n\n\u53c2\u8003\n\nGoogle \u30a6\u30a7\u30d6\u30de\u30b9\u30bf\u30fc \u30c4\u30fc\u30eb\nTwitter Developers | Twitter\u30ab\u30fc\u30c9 \u6982\u8981\n\n[Scotch.io](https://scotch.io/tutorials/angularjs-seo-with-prerender-io)\u3067\u53d6\u308a\u4e0a\u3052\u3089\u308c\u3066\u3044\u305f[prerender-node#1.2.1](https://github.com/prerender/prerender-node.git)\u3067\u306f\u3001[angular-ui-router#0.2.13](https://github.com/angular-ui/ui-router)\u306e\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u7d50\u679c\u3092\u3046\u307e\u304f\u53d6\u5f97\u3067\u304d\u306a\u304b\u3063\u305f\u306e\u3067\u3001DIY\u3067\u89e3\u6c7a\u3059\u308b\u624b\u9806\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\u5fd9\u3057\u3044\u4eba\u306f[express-turnout#0.0.4-alpha](https://github.com/59naga/express-turnout)\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\n## Phantomjs 2.0.0 \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n`$ phantomjs -v`\u3067`2.0.0`\u304c\u8fd4\u308b\u74b0\u5883\u3092\u7528\u610f\u3057\u307e\u3059\u3002\n\n### Win ([cmder](http://gooseberrycreative.com/cmder/))\n```\n\u03bb curl -OL https://bitbucket.org/ariya/phantomjs/downloads/phantomjs-2.0.0-windows.zip\n\u03bb unzip phantomjs-2.0.0-windows.zip\n\u03bb mv %cd%\\phantomjs-2.0.0-windows\\bin\\phantomjs.exe %CMDER_ROOT%\\bin\\phantomjs.exe\n\u03bb phantomjs -v\n2.0.0\n```\n\n### Mac (Terminal/Homebrew)\n```bash\n$ brew install phantomjs\n$ phantomjs -v\n2.0.0\n```\n\n### Linux\n\u3053\u3061\u3089\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3001CentOS 5.9\u3067\u30d3\u30eb\u30c9\u306b\u6210\u529f\u3057\u307e\u3057\u305f\uff08\u7d42\u4e86\u307e\u3067\uff12\u6642\u9593\u8d85\u639b\u304b\u308a\u307e\u3059\uff09\u3002\n> [Compiling phantomJS 2.0 for AWS EC2 linux image](http://blog.rampinteractive.co.uk/compiling-phantomjs-2-0-for-aws-ec2-linux-image/)\n\n## nodejs\u304b\u3089phantomjs\u3092\u5b9f\u884c\u3059\u308b\n\u540c\u69d8\u306b\u3001node.js\u7d4c\u7531\u3067phantomjs\u304c\u5b9f\u884c\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash\n$ node\n```\n\n```js\nvar exec= require('child_process').exec;\nexec('phantomjs -v',function(error,stdout){\n  console.log(stdout);// 2.0.0\n});\n```\n\n## \u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u7528\u306e\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\n`$ phantomjs render.js url`\u30b3\u30de\u30f3\u30c9\u3067\u3001\u30af\u30ed\u30fc\u30e9\u30fc\u306e\u4ee3\u308f\u308a\u306b\u30da\u30fc\u30b8\u3092\u8a2a\u554f\u3057\u3001__\u4efb\u610f\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u307e\u3067\u5f85\u3063\u3066\u304b\u3089__\u3001\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u7d50\u679c\u3092\u53d6\u5f97\u3059\u308b\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```js:./render.js\n// Dependencies\nvar system= require('system');\nvar webpage= require('webpage');\n\n// Environment\nvar url= system.args[1];\n\n// Setup webpage\nvar page= webpage.create();\npage.open(url);\npage.onCallback= function(html){\n  system.stdout.write(html);\n  phantom.exit(0);\n};\n```\n\n\u3053\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u3001\u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\u3067\u52d5\u4f5c\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n```html:./index.html\n<script>\nif(window.callPhantom){\n  window.callPhantom(document.documentElement.outerHTML);\n}\n</script>\n```\n\n```bash\n$ phantomjs render.js index.html\n# <html><head><script>if(window.callPhantom){window.callPhantom(document.documentElement.outerHTML);}</script></head></html>\n```\n\nwebpage\u5185\u306b\u306f\u3001[window.callPhantom\u30e1\u30bd\u30c3\u30c9\u304c\u7528\u610f\u3055\u308c\u3066\u304a\u308a](http://phantomjs.org/api/webpage/handler/on-callback.html)\u3001render.js\u306e`page.onCallback`\u3067\u7d50\u679c\u3092\u53d7\u3051\u53d6\u308a\u307e\u3059\u3002\n\n\u3053\u308c\u3092\u5229\u7528\u3057\u3066\u3001\u4efb\u610f\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u3001\u30af\u30ed\u30fc\u30e9\u30fc\u306b\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u7d50\u679c\u3092\u6e21\u3059\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n```html:./index.html\n<!DOCTYPE html>\n<html lang=\"en\" ng-app=\"myApp\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>{{meta['og:site_name'] + ' | ' + title}}</title>\n  <meta content=\"{{value}}\" property=\"{{key}}\" ng-repeat=\"(key,value) in meta\">\n\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.15/angular.js\"></script>\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.14/angular-ui-router.js\"></script>\n  \n  <script>\nangular.module('myApp',['ui.router'])\n.run(function($rootScope,$window,$location,$state){\n  $rootScope.$on('$viewContentLoaded',function(){\n    var renderedTemplate= $window.document.body.innerHTML.trim().length>0\n    if(renderedTemplate){\n      $rootScope.title= 'Welcome clawlers!';\n      $rootScope.meta= {\n        'og:site_name':$state.current.name,\n        'og:title':$rootScope.title,\n        'og:url':$location.absUrl(),\n        'og:type':'article',\n        'og:description':angular.element($window.document.body).text(),\n      }\n\n      if(window.callPhantom){\n        setTimeout(function(){\n          window.callPhantom(document.documentElement.outerHTML);\n        },0);\n      }\n    }\n  });\n})\n.config(function($stateProvider){\n  $stateProvider.state('private',{\n    url:'/private',\n    template:'<h1>private</h1>',\n  });\n  $stateProvider.state('second',{\n    url:'/second',\n    template:'<h1>second</h1><a ui-sref=\"first\">first</a>',\n  });\n  $stateProvider.state('first',{\n    url:'*path',\n    template:'<h1>first</h1><a ui-sref=\"second\">second</a>',\n  });\n})\n;\n  </script>\n</head>\n<body ui-view></body>\n</html>\n```\n\n```bash\n$ phantomjs render.js index.html\n# <html lang=\"en\" ng-app=\"myApp\" class=\"ng-scope\"><head><style type=\"text/css\">@charset \"UTF-8\";[ng\\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide:not(.ng-hide-animate){display:none !important;}ng\\:form{display:block;}</style>\n#   <meta charset=\"UTF-8\">\n#   <title class=\"ng-binding\">first | Welcome clawlers!</title>\n#   <!-- ngRepeat: (key,value) in meta --><meta content=\"firstsecond\" property=\"og:description\" ng-repeat=\"(key,value) in meta\" class=\"ng-scope\"><!-- end ngRepeat: (key,value) in meta --><meta content=\"first\" property=\"og:site_name\" ng-repeat=\"(key,value) in meta\" class=\"ng-scope\"><!-- end ngRepeat: (key,value) in meta --><meta content=\"Welcome clawlers!\" property=\"og:title\" ng-repeat=\"(key,value) in meta\" class=\"ng-scope\"><!-- end ngRepeat: (key,value) in meta --><meta content=\"article\" property=\"og:type\" ng-repeat=\"(key,value) in meta\" class=\"ng-scope\"><!-- end ngRepeat: (key,value) in meta --><meta content=\"file:///Users/59naga/Downloads/hoge.html\" property=\"og:url\" ng-repeat=\"(key,value) in meta\" class=\"ng-scope\"><!-- end ngRepeat: (key,value) in meta -->\n# \n#   <script src=\"https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.15/angular.js\"></script>\n#   <script src=\"https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.14/angular-ui-router.js\"></script>\n# \n#   <script>\n# angular.module('myApp',['ui.router'])\n# //...\n#   </script>\n# </head>\n# <!-- uiView:  --><body ui-view=\"\" class=\"ng-scope\"><h1 class=\"ng-scope\">first</h1><a ui-sref=\"second\" class=\"ng-scope\" href=\"#/second\">second</a></body></html>\n```\n\n&lt;meta&gt;, &lt;title&gt;, &lt;body&gt;\u3092\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3057\u305f\u72b6\u614b\u3067\u3001\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u53d6\u5f97\u3067\u304d\u307e\u3057\u305f\u3002\n\n## \u30b5\u30fc\u30d0\u30fc\u304b\u3089\u5b9f\u884c\u3059\u308b\n\u4e0a\u8a18\u3092[Express4](http://expressjs.com/4x/api.html#router)\u304b\u3089\u4f7f\u7528\u3059\u308b\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002\n\n```bash\n$ npm install express\n$ node app\n# listening at 59798\n$ curl -A Googlebot http://localhost:59798/\n# Prerendered source-code\n```\n\n```js:./app.js\n// Environment\nvar port= 59798;\n\n// Dependencies\nvar express= require('express');\nvar exec= require('child_process').exec;\n\n// Setup prerender\nvar prerender= express.Router();\nprerender.use(function(req,res,next){\n  var ua= req.headers['user-agent'] || '';\n  if(ua.match('Googlebot')==null){\n    return next();\n  }\n\n  var scriptFile= require.resolve('./render.js');\n  var uri= req.protocol+'://'+req.get('host')+req.originalUrl;\n  var script= 'phantomjs '+scriptFile+' '+uri;\n  exec(script,function(error,stdout,stderr){\n    if(error){\n      res.status(403);\n      res.end(stderr);\n      return;\n    }\n    res.set('Content-Type','text/html');\n    res.end(stdout);\n  });\n});\n\n// Setup express\nvar app= express();\napp.use(prerender);\napp.use(function(req, res) {\n  res.sendFile(__dirname + '/index.html');\n});\n\n// Boot\napp.listen(port, function() {\n  console.log('listening at %s', port);\n});\n```\n\n## \u6ce8\u610f\n* \u8a18\u4e8b\u5185\u306e\u30b3\u30fc\u30c9\u306f\u3001\u4f8b\u5916\u51e6\u7406\u3092\u7701\u3044\u305f\u6700\u4f4e\u9650\u306e\u30b3\u30fc\u30c9\u3067\u3059\u3002\n* \u5b9f\u884c\u30b3\u30b9\u30c8\u304c\u9ad8\u304f\u3001\u30ec\u30b9\u30dd\u30f3\u30b9\u306b\uff11\u79d2\u4ee5\u4e0a\u639b\u304b\u308b\u3053\u3068\u3082\u5c11\u306a\u304f\u3042\u308a\u307e\u305b\u3093\u3002\u5b9f\u969b\u306b\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u3001\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3001\u30d6\u30e9\u30c3\u30af\u30ea\u30b9\u30c8\u30fb\u30db\u30ef\u30a4\u30c8\u30ea\u30b9\u30c8\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u5fc5\u8981\u306b\u306a\u308b\u3067\u3057\u3087\u3046\u3002\n* \u524d\uff12\u6a5f\u80fd\u306f[express-turnout](https://github.com/59naga/express-turnout)\u3068\u3044\u3046\u30e9\u30a4\u30d6\u30e9\u30ea\u306b\u5b9f\u88c5\u3057\u307e\u3057\u305f\u3002ui-router\u3092\u4f7f\u3063\u305f\u30da\u30fc\u30b8\u306b\u4f7f\u7528\u3057\u3066\u3001Google\u304c\u8a2a\u554f\u3057\u305f\u5f8c\u306e\u691c\u7d22\u7d50\u679c\u304c[\u3053\u3093\u306a\u611f\u3058\u3067\u3059](https://google.com/search?q=site%3Aedgy.black)\u3002\n\n## \u53c2\u8003\n* [Google \u30a6\u30a7\u30d6\u30de\u30b9\u30bf\u30fc \u30c4\u30fc\u30eb](https://www.google.com/webmasters/tools/home?hl=ja)\n* [Twitter Developers | Twitter\u30ab\u30fc\u30c9 \u6982\u8981](https://dev.twitter.com/ja/cards/overview)\n", "tags": ["PhantomJS", "Express", "AngularJS", "Node.js"]}