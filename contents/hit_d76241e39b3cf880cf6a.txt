{"tags": ["MySQL", "mariadb", "\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3", "\u30ed\u30fc\u30eb\u30d0\u30c3\u30af", "rollback"], "context": " More than 1 year has passed since last update.DB\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3063\u3066\u305d\u3046\u3044\u3046\u3082\u306e\u3067\u3057\u3087\uff1f\u3068\u3044\u3046\u8a8d\u8b58\u306f\u3042\u308a\u3064\u3064\u3082\u5b9f\u969b\u3084\u3063\u305f\u3053\u3068\u304c\u306a\u304b\u3063\u305f\u306e\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u3053\u3053\u3067\u306e\u691c\u8a3c\u306f\u3001\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u304b\u3051\u3066\u3001\u30aa\u30fc\u30c8NO\u578b\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u304c\u3069\u306e\u3088\u3046\u306b\u6271\u308f\u308c\u308b\u306e\u304b\uff1f\u3092\u691c\u8a3c\u3057\u305f\u7d50\u679c\u3067\u3059\u3002\n\n\u691c\u8a3c\u30c6\u30fc\u30d6\u30eb\n\u4eca\u56de\u4ee5\u4e0b\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u691c\u8a3c\u306b\u3064\u304b\u3063\u3066\u307f\u307e\u3057\u305f\u3002\u3053\u3053\u3067\u6c17\u306b\u3057\u3066\u3044\u308b\u306e\u306f\u3001id \u30d5\u30a3\u30fc\u30eb\u30c9\u3067\u3059\u3002\u3053\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u306f\u3001AUTO_INCREMENT\u3067\u8a2d\u5b9a\u3055\u308c\u3066\u304a\u308a\u307e\u3059\nCREATE TABLE `test_ptable` (\n  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,\n  `updated_at` datetime NOT NULL DEFAULT '0000-00-00 00:00:00' COMMENT 'UTC-DATE',\n  `domain` varchar(128) DEFAULT NULL COMMENT 'ex: www.yourdomain.com',\n  PRIMARY KEY (`id`,`updated_at`)\n) ENGINE=InnoDB AUTO_INCREMENT=8177590 DEFAULT CHARSET=utf8\n/*!50500 PARTITION BY RANGE  COLUMNS(updated_at)\n(PARTITION p20140901 VALUES LESS THAN ('2014-09-01') ENGINE = InnoDB,\n PARTITION p20141001 VALUES LESS THAN ('2014-10-01') ENGINE = InnoDB,\n PARTITION p20141101 VALUES LESS THAN ('2014-11-01') ENGINE = InnoDB) */\n\n\n\u30c6\u30fc\u30d6\u30eb\u306b\u30a4\u30f3\u30b5\u30fc\u30c8\u3057\u3066\u307f\u308b\uff08\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u306e\u6319\u52d5\uff09\n\n\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u304b\u3051\u3066\u3001\u30c6\u30fc\u30d6\u30eb\u306b\u30a4\u30f3\u30b5\u30fc\u30c8\u3057\u3066\u307f\u307e\u3059\u3001\u305f\u3060\u3057\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3057\u307e\u3059\nMariaDB [knowledge]> begin ;                                                                                                                                 \nQuery OK, 0 rows affected (0.00 sec)\n\nMariaDB [knowledge]> insert into test_ptable (updated_at) values (current_timestamp) ;                                                                       \nQuery OK, 1 row affected (0.00 sec)\n\n\n\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u524d\u306b\u3001\u72b6\u614b\u3092\u78ba\u8a8d\nid\u306b8177588\u304c\u5272\u308a\u3042\u305f\u3063\u3066\u3044\u307e\u3059\nMariaDB [knowledge]> select * from test_ptable ;                                                                                                             \n+---------+---------------------+--------+\n| id      | updated_at          | domain |\n+---------+---------------------+--------+\n| 8177588 | 2014-10-09 20:17:28 | NULL   |\n+---------+---------------------+--------+\n1 row in set (0.00 sec)\n\n\n\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3057\u307e\u3059\nMariaDB [knowledge]> rollback ;\nQuery OK, 0 rows affected (0.03 sec)\n\n\n\n\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u5f8c\u306e\u72b6\u614b\n\u5f53\u305f\u308a\u524d\u3067\u3059\u304c\u3001\u30c7\u30fc\u30bf\u306f\u306a\u3044\u3067\u3059\nMariaDB [knowledge]> select * from test_ptable ;\nEmpty set (0.00 sec)\n\n\n\u30c6\u30fc\u30d6\u30eb\u306b\u30a4\u30f3\u30b5\u30fc\u30c8\u3057\u3066\u307f\u308b\uff08\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u304b\u3051\u306a\u3044\uff09\n\u3053\u3053\u3067\u3001\u91cd\u8981\u306a\u3053\u3068\u306f\u3001\u518d\u5ea6\u30a4\u30f3\u30b5\u30fc\u30c8\u3092\u8a66\u307f\u305f\u6642\u306b\u3001\u524d\u56de\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3057\u305f\u969b\u306eid\u3092\u518d\u3073\u3082\u3063\u3066\u3053\u306a\u3044\u3088\u306d\uff1f\u3068\u3044\u3046\u3068\u3053\u308d\u3067\u3059\n\n\u3055\u3063\u305d\u304f\u30a4\u30f3\u30b5\u30fc\u30c8\u3057\u307e\u3059\n\u3053\u3093\u3069\u306f\u3001\u30aa\u30fc\u30c8\u30b3\u30df\u30c3\u30c8\u3067\u3059\nMariaDB [knowledge]> insert into test_ptable (updated_at) values (current_timestamp) ;\nQuery OK, 1 row affected (0.00 sec)\n\n\n\u30a4\u30f3\u30b5\u30fc\u30c8\u306e\u7d50\u679c\nMariaDB [knowledge]> select * from test_ptable ;\n+---------+---------------------+--------+\n| id      | updated_at          | domain |\n+---------+---------------------+--------+\n| 8177589 | 2014-10-09 20:18:06 | NULL   |\n+---------+---------------------+--------+\n1 row in set (0.00 sec)\n\n\u304a\u3049\u304a\u304a\u3001\u3001\u3088\u304b\u3063\u305f\u3001\u524d\u56de\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u524d\u306b\u53d6\u5f97\u3057\u305fid 8177588 \u306f\u6b20\u756a\u306b\u306a\u308a\u3001\u65b0\u305f\u306b8177589\u304c\u5272\u5f53\u305f\u308a\u307e\u3057\u305f\uff01\uff01\uff01\uff01\n\u3068\u308a\u3042\u3048\u305a\u3001\u5b89\u5fc3\uff1f\uff1f\uff1f\nDB\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3063\u3066\u305d\u3046\u3044\u3046\u3082\u306e\u3067\u3057\u3087\uff1f\u3068\u3044\u3046\u8a8d\u8b58\u306f\u3042\u308a\u3064\u3064\u3082\u5b9f\u969b\u3084\u3063\u305f\u3053\u3068\u304c\u306a\u304b\u3063\u305f\u306e\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u3053\u3053\u3067\u306e\u691c\u8a3c\u306f\u3001\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u304b\u3051\u3066\u3001\u30aa\u30fc\u30c8NO\u578b\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u304c\u3069\u306e\u3088\u3046\u306b\u6271\u308f\u308c\u308b\u306e\u304b\uff1f\u3092\u691c\u8a3c\u3057\u305f\u7d50\u679c\u3067\u3059\u3002\n\n## \u691c\u8a3c\u30c6\u30fc\u30d6\u30eb\n\n\u4eca\u56de\u4ee5\u4e0b\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u691c\u8a3c\u306b\u3064\u304b\u3063\u3066\u307f\u307e\u3057\u305f\u3002\u3053\u3053\u3067\u6c17\u306b\u3057\u3066\u3044\u308b\u306e\u306f\u3001id \u30d5\u30a3\u30fc\u30eb\u30c9\u3067\u3059\u3002\u3053\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u306f\u3001AUTO_INCREMENT\u3067\u8a2d\u5b9a\u3055\u308c\u3066\u304a\u308a\u307e\u3059\n\n```sql\nCREATE TABLE `test_ptable` (\n  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,\n  `updated_at` datetime NOT NULL DEFAULT '0000-00-00 00:00:00' COMMENT 'UTC-DATE',\n  `domain` varchar(128) DEFAULT NULL COMMENT 'ex: www.yourdomain.com',\n  PRIMARY KEY (`id`,`updated_at`)\n) ENGINE=InnoDB AUTO_INCREMENT=8177590 DEFAULT CHARSET=utf8\n/*!50500 PARTITION BY RANGE  COLUMNS(updated_at)\n(PARTITION p20140901 VALUES LESS THAN ('2014-09-01') ENGINE = InnoDB,\n PARTITION p20141001 VALUES LESS THAN ('2014-10-01') ENGINE = InnoDB,\n PARTITION p20141101 VALUES LESS THAN ('2014-11-01') ENGINE = InnoDB) */\n```\n\n## \u30c6\u30fc\u30d6\u30eb\u306b\u30a4\u30f3\u30b5\u30fc\u30c8\u3057\u3066\u307f\u308b\uff08\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u306e\u6319\u52d5\uff09\n\n### \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u304b\u3051\u3066\u3001\u30c6\u30fc\u30d6\u30eb\u306b\u30a4\u30f3\u30b5\u30fc\u30c8\u3057\u3066\u307f\u307e\u3059\u3001\u305f\u3060\u3057\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3057\u307e\u3059\n\n```sql\nMariaDB [knowledge]> begin ;                                                                                                                                 \nQuery OK, 0 rows affected (0.00 sec)\n\nMariaDB [knowledge]> insert into test_ptable (updated_at) values (current_timestamp) ;                                                                       \nQuery OK, 1 row affected (0.00 sec)\n```\n\n### \u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u524d\u306b\u3001\u72b6\u614b\u3092\u78ba\u8a8d\n\nid\u306b8177588\u304c\u5272\u308a\u3042\u305f\u3063\u3066\u3044\u307e\u3059\n\n```\nMariaDB [knowledge]> select * from test_ptable ;                                                                                                             \n+---------+---------------------+--------+\n| id      | updated_at          | domain |\n+---------+---------------------+--------+\n| 8177588 | 2014-10-09 20:17:28 | NULL   |\n+---------+---------------------+--------+\n1 row in set (0.00 sec)\n```\n\n### \u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3057\u307e\u3059\n\n```\nMariaDB [knowledge]> rollback ;\nQuery OK, 0 rows affected (0.03 sec)\n\n```\n### \u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u5f8c\u306e\u72b6\u614b\n\n\u5f53\u305f\u308a\u524d\u3067\u3059\u304c\u3001\u30c7\u30fc\u30bf\u306f\u306a\u3044\u3067\u3059\n\n```\nMariaDB [knowledge]> select * from test_ptable ;\nEmpty set (0.00 sec)\n```\n\n## \u30c6\u30fc\u30d6\u30eb\u306b\u30a4\u30f3\u30b5\u30fc\u30c8\u3057\u3066\u307f\u308b\uff08\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u304b\u3051\u306a\u3044\uff09\n\n\u3053\u3053\u3067\u3001\u91cd\u8981\u306a\u3053\u3068\u306f\u3001\u518d\u5ea6\u30a4\u30f3\u30b5\u30fc\u30c8\u3092\u8a66\u307f\u305f\u6642\u306b\u3001\u524d\u56de\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3057\u305f\u969b\u306eid\u3092\u518d\u3073\u3082\u3063\u3066\u3053\u306a\u3044\u3088\u306d\uff1f\u3068\u3044\u3046\u3068\u3053\u308d\u3067\u3059\n\n### \u3055\u3063\u305d\u304f\u30a4\u30f3\u30b5\u30fc\u30c8\u3057\u307e\u3059\n\n\u3053\u3093\u3069\u306f\u3001\u30aa\u30fc\u30c8\u30b3\u30df\u30c3\u30c8\u3067\u3059\n\n```\nMariaDB [knowledge]> insert into test_ptable (updated_at) values (current_timestamp) ;\nQuery OK, 1 row affected (0.00 sec)\n````\n\n### \u30a4\u30f3\u30b5\u30fc\u30c8\u306e\u7d50\u679c\n\n```\nMariaDB [knowledge]> select * from test_ptable ;\n+---------+---------------------+--------+\n| id      | updated_at          | domain |\n+---------+---------------------+--------+\n| 8177589 | 2014-10-09 20:18:06 | NULL   |\n+---------+---------------------+--------+\n1 row in set (0.00 sec)\n```\n\n\u304a\u3049\u304a\u304a\u3001\u3001\u3088\u304b\u3063\u305f\u3001\u524d\u56de\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u524d\u306b\u53d6\u5f97\u3057\u305fid 8177588 \u306f\u6b20\u756a\u306b\u306a\u308a\u3001\u65b0\u305f\u306b8177589\u304c\u5272\u5f53\u305f\u308a\u307e\u3057\u305f\uff01\uff01\uff01\uff01\n\n\n\u3068\u308a\u3042\u3048\u305a\u3001\u5b89\u5fc3\uff1f\uff1f\uff1f\n"}