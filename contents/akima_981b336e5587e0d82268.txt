{"context": " More than 1 year has passed since last update.\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u60c5\u5831\n\nElasticsearch 1.7.4\n\n\u672c\u8a18\u4e8b\u304c\u6271\u3046ElasticsearchIntegrationTest\u306f\u30d0\u30fc\u30b8\u30e7\u30f32\u7cfb\u304b\u3089ESIntegTestCase\u3078\u3068\u540d\u524d\u304c\u5909\u308f\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3059. \u4f34\u3063\u3066\u5927\u304d\u306a\u5909\u66f4\u304c\u5165\u3063\u3066\u3044\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u306e\u3067, \u3054\u6ce8\u610f\u304f\u3060\u3055\u3044.\n\n\u306f\u3058\u3081\u306b\n\n\u6982\u8981\n\u3053\u306e\u8a18\u4e8b\u306fElasticsearch Advent Calendar 2015\u306e3\u65e5\u76ee\u306e\u30a8\u30f3\u30c8\u30ea\u3067\u3059\u3002\n\u5b9f\u306fElasticsearch\u306fJava\u3067\u30c6\u30b9\u30c8\u3092\u66f8\u304f\u305f\u3081\u306e, ElasticsearchIntegrationTest\u3068\u3044\u3046\u30af\u30e9\u30b9\u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059. \u304c, \u65e5\u672c\u8a9e\u306e\u8cc7\u6599\u304c\u3081\u3063\u3061\u3083\u5c11\u306a\u3044\uff01\uff08\u3068\u3044\u3046\u304b\u7121\u3044\uff1f\uff09\u306e\u3067, \u79c1\u304c\u5c0e\u5165\u307e\u3067\u306b\u8abf\u3079\u305f\u3053\u3068\u3068\u304b\u3092\u307e\u3068\u3081\u3066\u307f\u307e\u3057\u305f.\n\u3053\u308c\u3092\u4f7f\u3046\u3068, \u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u305f\u30de\u30b7\u30f3\u4e0a\u3067\u7c21\u6613Elasticsearch\u30af\u30e9\u30b9\u30bf\u304c\u7acb\u3061\u4e0a\u304c\u308a, \u305d\u306e\u30af\u30e9\u30b9\u30bf\u306b\u5bfe\u3057\u3066\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u5185\u304b\u3089\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u6295\u5165\u3057\u305f\u308a, \u691c\u7d22\u3057\u305f\u308a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059. \u30c6\u30b9\u30c8\u7528\u306b\u308f\u3056\u308f\u3056Elasticsearch\u30b5\u30fc\u30d0\u30fc\u3092\u7acb\u3061\u4e0a\u3052\u308b\u5fc5\u8981\u304c\u306a\u304f\u306a\u308a\u307e\u3059\u3088\uff01\n\n\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 (Elasticsearch 1.7)\nElasticsearch\u516c\u5f0f\u3067\u89e6\u308c\u3066\u3044\u308b\u306e\u306f\u3053\u306e\u3042\u305f\u308a\u306e\u8a18\u4e8b\u306b\u306a\u308a\u307e\u3059.\n\nJava Testing Framework\nUsing the elasticsearch test classes\nintegration tests\n\n\n\u30c6\u30b9\u30c8\u306b\u5fc5\u8981\u306a\u4f9d\u5b58\u95a2\u4fc2\n\u672c\u8a18\u4e8b\u3067\u306fMaven\u3092\u4f7f\u3044\u307e\u3059. \u3068\u308a\u3042\u3048\u305aelasticsearch 1.7.4\u3067ElasticsearchIntegrationTest\u3092\u8a66\u3057\u3066\u307f\u308b\u305f\u3081\u306e\u4f9d\u5b58\u306e\u8a18\u8ff0\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059.\n\npom.xml\n<dependencies>\n    <dependency>\n        <groupId>org.apache.lucene</groupId>\n        <artifactId>lucene-test-framework</artifactId>\n        <version>4.10.4</version>\n        <scope>test</scope>\n    </dependency>\n    <dependency>\n        <groupId>com.carrotsearch.randomizedtesting</groupId>\n        <artifactId>randomizedtesting-runner</artifactId>\n        <version>2.1.17</version>\n        <scope>test</scope>\n    </dependency>\n    <dependency>\n        <groupId>org.elasticsearch</groupId>\n        <artifactId>elasticsearch</artifactId>\n        <version>1.7.3</version>\n        <type>test-jar</type>\n        <scope>test</scope>\n    </dependency>\n    <dependency>\n        <groupId>org.elasticsearch</groupId>\n        <artifactId>elasticsearch</artifactId>\n        <version>1.7.3</version>\n        <scope>test</scope>\n    </dependency>\n    <dependency>\n        <groupId>junit</groupId>\n        <artifactId>junit</artifactId>\n        <version>4.12</version>\n        <scope>test</scope>\n    </dependency>\n    <dependency>\n        <groupId>org.hamcrest</groupId>\n        <artifactId>hamcrest-all</artifactId>\n        <version>1.3</version>\n        <scope>test</scope>\n    </dependency>\n  </dependencies>\n\n\n\u8a18\u8ff0\u9806\u5e8f\u304c\u5909\u308f\u308b\u3068\u52d5\u304b\u306a\u304f\u306a\u3063\u305f\u308a\u3059\u308b\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044.\n\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u6c7a\u3081\u65b9\u3068\u3057\u3066\u306f, \u307e\u305aelasticsearch\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u81ea\u5206\u304c\u4f7f\u3063\u3066\u3044\u308b\u3082\u306e\u3092\u6307\u5b9a\u3057\u307e\u3059. <type>test-jar</type>\u306e\u65b9\u3082\u542b\u3081\u308b\u30682\u7b87\u6240\u3067\u3059. \u4eca\u56de\u306f1.7.3\u3092\u6307\u5b9a\u3057\u307e\u3057\u305f.\n\u6b21\u306b, \u4f7f\u3063\u3066\u3044\u308bElasticsearch\u304c\u4f9d\u5b58\u3057\u3066\u3044\u308bLucene\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u8abf\u3079, lucene-test-framework\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u6c7a\u3081\u307e\u3059. Eclipse\u306eMaven POM \u30a8\u30c7\u30a3\u30bf\u30fc\u3067\u4f9d\u5b58\u95a2\u4fc2\u3092\u8abf\u3079\u305f\u308a, Maven Repository\u306e\u5f53\u8a72\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u30da\u30fc\u30b8\u3092\u898b\u305f\u308a\u3059\u308b\u306e\u304c\u3044\u3044\u3093\u3058\u3083\u306a\u3044\u304b\u3068\u601d\u3044\u307e\u3059. \u4eca\u56de\u306f4.10.4\u3092\u4f7f\u3048\u3070\u3088\u3044\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059.\n\u6700\u5f8c\u306b, randomizedtesting-runner\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u6c7a\u5b9a\u3059\u308b\u306e\u3067\u3059\u304c, \u3053\u308c\u306f\u8abf\u3079\u65b9\u304c\u5206\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f.\nlucene-test-framework 4.10.4\u304c\u4f9d\u5b58\u3057\u3066\u3044\u308brandomizedtesting-runner 2.1.6\u3092\u4f7f\u3048\u3070\u3088\u3044\u306e\u304b\u3068\u601d\u3044\u304d\u3084, \u306a\u3093\u304b\u52d5\u304d\u307e\u305b\u3093\u3067\u3057\u305f. 2.1\u7cfb\u306e\u6700\u65b0\u7248\u3067\u3042\u308b2.1.17\u3092\u6307\u5b9a\u3057\u305f\u3089\u52d5\u304d\u307e\u3057\u305f. \u672c\u5f53\u306f lucene-test-framework \u3067 randomizedtesting-runner \u3092Exclude\u3057\u305f\u65b9\u304c\u826f\u3044\u306e\u304b\u3082\u3057\u308c\u306a\u3044.\n\n\u30c6\u30b9\u30c8\u5bfe\u8c61\u30b3\u30fc\u30c9\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a, Elasticsearch\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3067\u53d7\u3051\u53d6\u308a, search\u30e1\u30bd\u30c3\u30c9\u3067\u3054\u304f\u7c21\u5358\u306a\u691c\u7d22\u3092\u884c\u3046\u30af\u30e9\u30b9\u3092\u30c6\u30b9\u30c8\u5bfe\u8c61\u3068\u3057\u307e\u3059.\n\nsrc/main/java/jp/akimateras/elasticsearch/esintegtest/service/SimpleSearch.java\npackage jp.akimateras.elasticsearch.esintegtest.service;\n\nimport java.io.IOException;\nimport java.util.Arrays;\nimport java.util.Collection;\nimport java.util.stream.Collectors;\n\nimport org.elasticsearch.action.search.SearchResponse;\nimport org.elasticsearch.client.Client;\nimport org.elasticsearch.index.query.MatchQueryBuilder.Operator;\nimport org.elasticsearch.index.query.MultiMatchQueryBuilder;\nimport org.elasticsearch.index.query.QueryBuilders;\nimport org.elasticsearch.search.SearchHit;\n\npublic class SimpleSearch {\n    // \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u30fb\u30bf\u30a4\u30d7\u540d\u5b9a\u7fa9.\n    public static final String INDEX_NAME = \"simple-search\";\n    public static final String TYPE_NAME = \"documents\";\n\n    // \u30d5\u30a3\u30fc\u30eb\u30c9\u540d\u5b9a\u7fa9.\n    public static final String TITLE_FIELD_NAME = \"title\";\n    public static final String TEXT_FIELD_NAME = \"text\";\n\n    // \u691c\u7d22\u7d50\u679c\u306e\u8fd4\u5374\u578b.\n    public static class Document {\n        public final String title;\n        public final String text;\n\n        Document(String title, String text) {\n            this.title = title;\n            this.text = text;\n        }\n    }\n\n    // Elasticsearch\u30af\u30e9\u30a4\u30a2\u30f3\u30c8.\n    private final Client client;\n\n    /**\n     * \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf.\n     * \n     * @param client \u691c\u7d22\u306b\u4f7f\u7528\u3059\u308bElasticsearch\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\n     */\n    public SimpleSearch(Client client) {\n        this.client = client;\n    }\n\n    /**\n     * \u691c\u7d22\u30e1\u30bd\u30c3\u30c9\n     * \n     * @param keywords \u691c\u7d22\u30ad\u30fc\u30ef\u30fc\u30c9. \u30b9\u30da\u30fc\u30b9\u533a\u5207\u308a\u3067\u8907\u6570\u306e\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u306fAND\u691c\u7d22\u3068\u3059\u308b.\n     * @return \u691c\u7d22\u7d50\u679c.\n     */\n    public Collection<Document> search(String keywords) throws IOException {\n        try {\n            // \u691c\u7d22\u30af\u30a8\u30ea\u306e\u7d44\u307f\u7acb\u3066.\n            MultiMatchQueryBuilder query = QueryBuilders\n                .multiMatchQuery(keywords, TITLE_FIELD_NAME, TEXT_FIELD_NAME)\n                .operator(Operator.AND);\n\n            // \u691c\u7d22\u306e\u5b9f\u884c.\n            SearchResponse response = client.prepareSearch(INDEX_NAME)\n                .setTypes(TYPE_NAME)\n                .setQuery(query)\n                .execute()\n                .get();\n\n            // \u691c\u7d22\u7d50\u679c\u3092 Collection<Document> \u306b\u8a70\u3081\u66ff\u3048\u3066return\u3059\u308b.\n            return Arrays.stream(response.getHits().hits())\n                .map(SearchHit::sourceAsMap)\n                .map(source -> new Document(\n                    (String) source.get(TITLE_FIELD_NAME),\n                    (String) source.get(TEXT_FIELD_NAME)\n                    ))\n                .collect(Collectors.toList());\n        } catch(Exception e) {\n            throw new IOException(e);\n        }\n    }\n}\n\n\n\n\u30b7\u30f3\u30d7\u30eb\u306a\u30c6\u30b9\u30c8\n\u4e0a\u3067\u4f5c\u3063\u305fSimpleSearch\u30af\u30e9\u30b9\u3092\u96d1\u306b\u30c6\u30b9\u30c8\u3057\u3066\u307f\u307e\u3057\u3087\u3046.\nElasticsearchIntegrationTest\u3067\u30c6\u30b9\u30c8\u3092\u66f8\u304f\u305f\u3081\u306b\u306f, \n\n\u30c6\u30b9\u30c8\u30af\u30e9\u30b9\u306bElasticsearchIntegrationTest\u3092\u7d99\u627f\u3055\u305b\u308b.\n\u30c6\u30b9\u30c8\u30e1\u30bd\u30c3\u30c9\u5185\u3067client()\u3092\u547c\u3073\u51fa\u3059\u3068Elasticsearch\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u53d6\u308c\u308b.\n\n\u306e2\u70b9\u3060\u3051\u62bc\u3055\u3048\u3066\u304a\u3051\u3070OK\u3067\u3059.\n\nsrc/test/java/jp/akimateras/elasticsearch/esintegtest/service/SimpleSearchTest.java\npackage jp.akimateras.elasticsearch.esintegtest.service;\n\nimport static org.hamcrest.Matchers.is;\n\nimport org.elasticsearch.common.settings.ImmutableSettings;\nimport org.elasticsearch.common.settings.Settings;\nimport org.elasticsearch.common.xcontent.XContentBuilder;\nimport org.elasticsearch.common.xcontent.XContentFactory;\nimport org.elasticsearch.test.ElasticsearchIntegrationTest;\nimport org.junit.Before;\nimport org.junit.Test;\n\n@ElasticsearchIntegrationTest.ClusterScope(numDataNodes = 1 /* \u30c6\u30b9\u30c8\u6642\u306b\u7acb\u3061\u4e0a\u3052\u308b\u30ce\u30fc\u30c9\u6570 */)\npublic class SimpleSearchTest extends ElasticsearchIntegrationTest {\n    // \u30c6\u30b9\u30c8\u7528\u30ce\u30fc\u30c9\u306b\u8a2d\u5b9a\u3057\u305f\u3044\u5185\u5bb9\u306f\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u306e\u8fd4\u5374\u5024\u3068\u3057\u3066\u8868\u73fe\u3059\u308b.\n    @Override\n    protected Settings nodeSettings(int nodeOrdinal) {\n        return ImmutableSettings.settingsBuilder()\n            .put(super.nodeSettings(nodeOrdinal))\n            .build();\n    }\n\n    // \u3053\u3053\u3067\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f5c\u6210\u3059\u308b.\n    @Before\n    public void initializeIndex() throws Exception {\n        // \u30de\u30c3\u30d4\u30f3\u30b0\u5b9a\u7fa9.\n        // \u5916\u90e8JSON\u30d5\u30a1\u30a4\u30eb\u3068\u304b\u3067\u30de\u30c3\u30d4\u30f3\u30b0\u5b9a\u7fa9\u3092\u3057\u3066\u3044\u308b\u306a\u3089, \u305d\u3063\u3061\u304b\u3089\u8aad\u3093\u3060\u65b9\u304c\u826f\u3044\u3068\u601d\u3046.\n        XContentBuilder mapping = XContentFactory.jsonBuilder()\n            .startObject()\n                .startObject(SimpleSearch.TYPE_NAME)\n                    .startObject(\"properties\")\n                        .startObject(SimpleSearch.TITLE_FIELD_NAME)\n                            .field(\"type\", \"string\")\n                            .field(\"source\", true)\n                        .endObject()\n                        .startObject(SimpleSearch.TEXT_FIELD_NAME)\n                            .field(\"type\", \"string\")\n                            .field(\"source\", true)\n                        .endObject()\n                    .endObject()\n                .endObject()\n            .endObject();\n\n        // \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210.\n        admin().indices() // admin()\u3067\u30a2\u30c9\u30df\u30f3\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u53d6\u308c\u308b\uff01\n            .prepareCreate(SimpleSearch.INDEX_NAME)\n            .addMapping(SimpleSearch.TYPE_NAME, mapping)\n            .execute()\n            .actionGet();\n\n        // \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u5b8c\u4e86\u306e\u5f85\u6a5f.\n        ensureGreen();\n    }\n\n    // \u30c6\u30b9\u30c8\u672c\u4f53\n    @Test\n    public void testSearch() throws Exception {\n        // \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u6295\u5165.\n        // \u3053\u308c\u3082\u5916\u90e8JSON\u30d5\u30a1\u30a4\u30eb\u306a\u3069\u3092\u7528\u610f\u3057\u3066, Bulk API\u3067\u6295\u5165\u3057\u305f\u65b9\u304c\u826f\u3044\u3068\u601d\u3046.\n        index(SimpleSearch.INDEX_NAME, SimpleSearch.TYPE_NAME, XContentFactory.jsonBuilder()\n            .startObject()\n                .field(SimpleSearch.TITLE_FIELD_NAME, \"Alpaca\")\n                .field(SimpleSearch.TEXT_FIELD_NAME, \"An alpaca is a domesticated species of South American camelid.\")\n            .endObject());\n\n        index(SimpleSearch.INDEX_NAME, SimpleSearch.TYPE_NAME, XContentFactory.jsonBuilder()\n            .startObject()\n                .field(SimpleSearch.TITLE_FIELD_NAME, \"Llama\")\n                .field(SimpleSearch.TEXT_FIELD_NAME, \"A llama is a domesticated species of South American camelid.\")\n            .endObject());\n\n        index(SimpleSearch.INDEX_NAME, SimpleSearch.TYPE_NAME, XContentFactory.jsonBuilder()\n            .startObject()\n                .field(SimpleSearch.TITLE_FIELD_NAME, \"Vicugna\")\n                .field(SimpleSearch.TEXT_FIELD_NAME, \"A vicugna is a kind of herbivorous mammals that inhabit the Andes of South America.\")\n            .endObject());\n\n        // \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u6295\u5165\u5b8c\u4e86\u306e\u5f85\u6a5f.\n        flushAndRefresh();\n        ensureGreen();\n\n        // \u30c6\u30b9\u30c8\u7528\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u5bfe\u3057\u3066SimpleSearch\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210.\n        SimpleSearch service = new SimpleSearch(client()); // client()\u3067\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u53d6\u308c\u308b\uff01\n\n        // \u30c6\u30b9\u30c8\u5b9f\u65bd.\n        // \u305b\u3063\u304b\u304f\u306a\u306e\u3067, \u4f9d\u5b58\u306e\u304a\u307e\u3051\u3067\u4ed8\u3044\u3066\u304d\u305fhamcrest\u3092\u4f7f\u304a\u3046.\n        assertThat(service.search(\"alpaca\").size(), is(1));\n        assertThat(service.search(\"llama\").size(), is(1));\n        assertThat(service.search(\"vicugna\").size(), is(1));\n        assertThat(service.search(\"lama\").size(), is(0));\n\n        assertThat(service.search(\"domesticated\").size(), is(2));\n        assertThat(service.search(\"alpaca domesticated\").size(), is(1));\n        assertThat(service.search(\"llama domesticated\").size(), is(1));\n        assertThat(service.search(\"vicugna domesticated\").size(), is(0));\n    }\n}\n\n\nclient()\u3067Elasticsearch\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u53d6\u308c\u308b\u306e\u3067, \u57fa\u672c\u7684\u306b\u306f\u3082\u3046\u4f55\u3067\u3082\u3067\u304d\u307e\u3059\u306d. \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u306a\u3069\u306b\u30a2\u30c9\u30df\u30f3\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u5fc5\u8981\u306a\u5834\u5408\u306fclient().admin()\u307e\u305f\u306f, admin()\u3067\u53d6\u5f97\u3057\u3066\u304f\u3060\u3055\u3044. \n@Before\u3067\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f5c\u6210\u3057\u3066\u3044\u307e\u3059\u304c, @After\u3067\u81ea\u524d\u3067\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u524a\u9664\u3059\u308b\u5fc5\u8981\u306f\u306a\u304f, \u30c6\u30b9\u30c8\u30e1\u30bd\u30c3\u30c9\u6bce\u306b\u81ea\u52d5\u7684\u306b\u307e\u3063\u3055\u3089\u306b\u3057\u3066\u304f\u308c\u308b\u307f\u305f\u3044\u3067\u3059. \u4fbf\u5229.\nensureGreen()\u3084flushAndRefresh()\u306a\u3069, \u666e\u6bb5\u898b\u304b\u3051\u306a\u3044\u30e1\u30bd\u30c3\u30c9\u304c\u767b\u5834\u3057\u3066\u3044\u307e\u3059\u304c, \u3053\u308c\u3089\u306fElasticsearchIntegrationTest\u304c\u63d0\u4f9b\u3057\u3066\u304f\u308c\u308b\u4fbf\u5229\u30e1\u30bd\u30c3\u30c9\u3067\u3059. \u305f\u3068\u3048\u3070 ensureGreen() \u3092\u81ea\u524d\u3067\u66f8\u304f\u3068\u3059\u308b\u3068,\nclient().admin().cluster().prepareHealth()\n    .setWaitForGreenStatus()\n    .execute()\n    .actionGet();\n\n\u307f\u305f\u3044\u306b\u3061\u3087\u3063\u3068\u9577\u304f\u306a\u308a\u307e\u3059. \u3082\u3061\u308d\u3093, \u3053\u306e\u624b\u306e\u64cd\u4f5c\u3092\u30c6\u30b9\u30c8\u3059\u308b\u305f\u3081\u306b, \u81ea\u524d\u3067\u66f8\u3044\u3066\u3082OK\u3067\u3059. \u4fbf\u5229\u30e1\u30bd\u30c3\u30c9\u306e\u4e00\u89a7\u306f\u516c\u5f0f: integration tests (1.7)\u3092\u53c2\u7167.\n\n\u3053\u3053\u307e\u3067\u3067\u52d5\u304b\u306a\u3044\u3068\u304d\n\u79c1\u304c\u8e0f\u3093\u3060\u30a8\u30e9\u30fc\u306e\u30ed\u30b0\u3068\u305d\u306e\u5bfe\u51e6\u3092\u66f8\u3044\u3066\u304a\u304d\u307e\u3059.\n\n\u578b <\u30af\u30e9\u30b9\u540d> \u306e\u968e\u5c64\u306f\u4e0d\u6574\u5408\u3067\u3059\n\nEclipse\u30a8\u30e9\u30fc\n\u578b <\u30af\u30e9\u30b9\u540d> \u306e\u968e\u5c64\u306f\u4e0d\u6574\u5408\u3067\u3059\nThe hierarchy of the type '<Class Name>' is inconsistent\n\n\nElasticsearch\u306e\u30c6\u30b9\u30c8\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306ejar\u306f\u898b\u3048\u3066\u304a\u308a, \u304b\u3064, randomizedtesting-runner\u306ejar\u304c\u898b\u3048\u3066\u3044\u306a\u3044\u6642\u306b\u51fa\u305f\u30a8\u30e9\u30fc\u3067\u3059. Eclipse\u3067ElasticsearchIntegrationTest\u3092extends\u3057\u305f\u30c6\u30b9\u30c8\u30af\u30e9\u30b9\u306b\u8d64\u7dda\u304c\u5f15\u304b\u308c, \u4e0a\u8a18\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u307e\u3059. \u4f9d\u5b58\u304c\u6b63\u3057\u304f\u66f8\u3051\u3066\u3044\u308b\u304b\u306e\u78ba\u8a8d\u3084, \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30ea\u30d5\u30ec\u30c3\u30b7\u30e5/\u30af\u30ea\u30fc\u30f3\u306a\u3069\u8a66\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044.\n\nTest class requires enabled assertions\n\n\u5b9f\u884c\u6642\u51fa\u529b\njava.lang.Exception: Test class requires enabled assertions, enable globally (-ea) or for Solr/Lucene subpackages only: jp.akimateras.elasticsearch.esintegtest.test.SampleTest\n    __randomizedtesting.SeedInfo.seed([E05E1B5BAB0E8E6]:0)\n    org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:38)\n    org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n    org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)\n    org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:55)\n    [...com.carrotsearch.randomizedtesting.*]\n    java.lang.Thread.run(Unknown Source)\n\n\nElasticsearchIntegrationTest\u3092\u4f7f\u3046\u5834\u5408, \u30c6\u30b9\u30c8\u5b9f\u884c\u6642\u306b\u30a2\u30b5\u30fc\u30b7\u30e7\u30f3\u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u306a\u3044\u3068\u99c4\u76ee\u306a\u3088\u3046\u3067\u3059. JVM\u306e\u8d77\u52d5\u30aa\u30d7\u30b7\u30e7\u30f3\u306b-ea\u3092\u4ed8\u3051\u3066\u3042\u3052\u3066\u304f\u3060\u3055\u3044.\nEclipse\u304b\u3089\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u5834\u5408\u306f, [\u5b9f\u884c\u306e\u69cb\u6210]\u3067\u5bfe\u8c61\u306e\u69cb\u6210\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u958b\u304d, [\u5f15\u6570]\u30bf\u30d6\u306e[VM \u5f15\u6570]\u30c6\u30ad\u30b9\u30c8\u30a8\u30ea\u30a2\u306b-ea\u3068\u66f8\u3044\u3066\u3042\u3052\u308c\u3070OK\u3067\u3059.\n\ntests-framework.jar\u3068lucene-core.jar\u304c\u3069\u3046\u306e\u3053\u3046\u306e\n\n\u5b9f\u884c\u6642\u51fa\u529b\njava.lang.AssertionError: fix your classpath to have tests-framework.jar before lucene-core.jar\n    __randomizedtesting.SeedInfo.seed([C7B320FCEA3DEB94]:0)\n    org.apache.lucene.util.TestRuleSetupAndRestoreClassEnv.before(TestRuleSetupAndRestoreClassEnv.java:211)\n    org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n    org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:42)\n    [...com.carrotsearch.randomizedtesting.*]\n    org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:43)\n    org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n    org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)\n    org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:55)\n    [...com.carrotsearch.randomizedtesting.*]\n    java.lang.Thread.run(Unknown Source)\n\n\npom.xml\u306e\u8a18\u8ff0\u9806\u5e8f\u304c\u9593\u9055\u3063\u3066\u3044\u307e\u3059. Java\u306e\u30af\u30e9\u30b9\u30d1\u30b9\u306e\u9806\u5e8f\u304c\u554f\u984c\u306b\u306a\u308b\u306e\u304b\u306a...\uff1f\nrandomizedtesting-runner\u3078\u306e\u4f9d\u5b58\u306e\u524d\u306bElasticsearch\u3078\u306e\u4f9d\u5b58\u3092\u66f8\u304f\u3068\u767a\u751f\u3059\u308b\u3088\u3046\u3067\u3059. Java\u306b\u8a73\u3057\u304f\u306a\u3044\u306e\u3067\u7406\u7531\u306f\u3088\u304f\u5206\u304b\u308a\u307e\u305b\u3093\u304c, \u8a18\u8ff0\u9806\u5e8f\u3067\u52d5\u304b\u306a\u3044\u3053\u3068\u304c\u3042\u308b\u306e\u306f\u3061\u3087\u3063\u3068\u5acc\u306a\u611f\u3058\u3067\u3059\u306d.\n\nrandomizedtesting\u3067NoSuchMethodError\u304c\u51fa\u308b\n\n\u5b9f\u884c\u6642\u51fa\u529b\njava.lang.NoSuchMethodError: com.carrotsearch.randomizedtesting.RandomizedContext.runWithPrivateRandomness(Lcom/carrotsearch/randomizedtesting/Randomness;Ljava/util/concurrent/Callable;)Ljava/lang/Object;\n    __randomizedtesting.SeedInfo.seed([173369D720B9A36A:9F67560D8E45CE92]:0)\n    org.elasticsearch.test.ElasticsearchIntegrationTest.buildWithPrivateContext(ElasticsearchIntegrationTest.java:583)\n    org.elasticsearch.test.ElasticsearchIntegrationTest.buildAndPutCluster(ElasticsearchIntegrationTest.java:598)\n    org.elasticsearch.test.ElasticsearchIntegrationTest.beforeInternal(ElasticsearchIntegrationTest.java:283)\n    org.elasticsearch.test.ElasticsearchIntegrationTest.before(ElasticsearchIntegrationTest.java:1946)\n    [...sun.*, org.junit.*, java.lang.reflect.*, com.carrotsearch.randomizedtesting.*]\n    org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:50)\n    org.apache.lucene.util.TestRuleFieldCacheSanity$1.evaluate(TestRuleFieldCacheSanity.java:51)\n    org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:46)\n    [...com.carrotsearch.randomizedtesting.*]\n    org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:49)\n    org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)\n    org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n    [...com.carrotsearch.randomizedtesting.*]\n    org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:46)\n    org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:42)\n    [...com.carrotsearch.randomizedtesting.*]\n    org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:43)\n    org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n    org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)\n    org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:55)\n    [...com.carrotsearch.randomizedtesting.*]\n    java.lang.Thread.run(Unknown Source)\n\n\n\u5358\u7d14\u306brandomizedtesting-runner\u3078\u306e\u4f9d\u5b58\u3092\u66f8\u304d\u5fd8\u308c\u3066\u3044\u308b\u5834\u5408\u306b\u52a0\u3048, randomizedtesting-runner\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u6307\u5b9a\u304c\u53e4\u3044\u5834\u5408\u306b\u3082\u767a\u751f\u3059\u308b\u3088\u3046\u3067\u3059. elasticsearch 1.7.3\u3092\u4f7f\u3063\u305f\u969b\u306f, randomizedtesting 2.1.6\u3067\u306f\u3053\u306e\u30a8\u30e9\u30fc\u306b\u306a\u308a, randomizedtesting 2.1.17\u3067\u306f\u6b63\u5e38\u306b\u52d5\u304d\u307e\u3057\u305f.\n\nhamcrest\u3067NoClassDefFoundError\u304c\u51fa\u308b\n\n\u5b9f\u884c\u6642\u51fa\u529b\njava.lang.NoClassDefFoundError: org/hamcrest/Matchers\n    __randomizedtesting.SeedInfo.seed([3F50D3975E9C4C58:B704EC4DF06021A0]:0)\n    org.elasticsearch.test.ElasticsearchIntegrationTest.afterInternal(ElasticsearchIntegrationTest.java:628)\n    org.elasticsearch.test.ElasticsearchIntegrationTest.after(ElasticsearchIntegrationTest.java:1954)\n    [...sun.*, org.junit.*, java.lang.reflect.*, com.carrotsearch.randomizedtesting.*]\n    org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:50)\n    org.apache.lucene.util.TestRuleFieldCacheSanity$1.evaluate(TestRuleFieldCacheSanity.java:51)\n    org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:46)\n    [...com.carrotsearch.randomizedtesting.*]\n    org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:49)\n    org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)\n    org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n    [...com.carrotsearch.randomizedtesting.*]\n    org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:46)\n    org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:42)\n    [...com.carrotsearch.randomizedtesting.*]\n    org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:43)\n    org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n    org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)\n    org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:55)\n    [...com.carrotsearch.randomizedtesting.*]\n    java.lang.Thread.run(Unknown Source)\n\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306f\u66f8\u304b\u308c\u3066\u3044\u306a\u304b\u3063\u305f\u3068\u601d\u3046\u306e\u3067\u3059\u304c, hamcrest\u304c\u5fc5\u8981\u306a\u3088\u3046\u3067\u3059. elasticsearch 1.7.3\u3092\u4f7f\u3063\u305f\u969b\u306f, hamcrest 1.3\u3067\u52d5\u304d\u307e\u3057\u305f.\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u5fc5\u8981\u306a\u6a5f\u80fd\u306e\u30c6\u30b9\u30c8\n\u30b7\u30f3\u30d7\u30eb\u306a\u30c6\u30b9\u30c8\u306f\u52d5\u3044\u305f\u3067\u3057\u3087\u3046\u304b. \u5b9f\u306f, \u3053\u3053\u304b\u3089\u304c\u672c\u756a\u3067\u3059.\nElasticsearch\u3067\u65e5\u672c\u8a9e\u3092\u6271\u304a\u3046\u3068\u3057\u305f\u5834\u5408, \u65e5\u672c\u8a9e\u30a2\u30ca\u30e9\u30a4\u30b6\u306a\u3069\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u306a\u3044\u3068\u4f55\u3082\u59cb\u307e\u308a\u307e\u305b\u3093. \u30c6\u30b9\u30c8\u3092\u8d70\u3089\u305b\u308b\u305f\u3081\u306b\u81ea\u524d\u3067Elasticsearch\u30b5\u30fc\u30d0\u30fc\u3092\u7acb\u3061\u4e0a\u3052\u3066\u3044\u308b\u3068, \u30d7\u30e9\u30b0\u30a4\u30f3\u5468\u308a\u306e\u7ba1\u7406\u304c\u9762\u5012\u3060\u3063\u305f\u308a\u3059\u308b\u306e\u3067, \u3053\u306e\u3042\u305f\u308a\u304b\u3089ElasticsearchIntegrationTest\u306e\u3042\u308a\u304c\u305f\u307f\u304c\u51fa\u3066\u304d\u307e\u3059.\n\u30b5\u30fc\u30d0\u30fc\u3068\u3057\u3066\u7acb\u3061\u4e0a\u304c\u3063\u3066\u3044\u308bElasticsearch\u306e\u4e2d\u3067\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f7f\u304a\u3046\u3068\u3057\u305f\u5834\u5408, $ bin/plugin --install <\u4f7f\u7528\u3057\u305f\u3044\u30d7\u30e9\u30b0\u30a4\u30f3> \u3068\u304b\u3092\u5b9f\u884c\u3057\u305f\u3068\u601d\u3044\u307e\u3059. \u4e00\u65b9\u3067, ElasticsearchIntegrationTest\u306e\u4e2d\u3067\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f7f\u3046\u5834\u5408\u306f,\n\n\u4f7f\u7528\u3057\u305f\u3044\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f9d\u5b58\u95a2\u4fc2\u306b\u8ffd\u52a0\u3059\u308b.\n\nElasticsearchIntegrationTest\u30af\u30e9\u30b9\u304b\u3089\u7d99\u627f\u3057\u305fnodeSettings\u30e1\u30bd\u30c3\u30c9\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066, \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f7f\u7528\u3059\u308b\u65e8\u3092\u8a18\u8ff0\u3059\u308b.\n\n\u306e2\u3064\u3092\u3084\u308c\u3070OK\u3067\u3059.\n\n\u4f7f\u7528\u3057\u305f\u3044\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f9d\u5b58\u95a2\u4fc2\u306b\u8ffd\u52a0\u3059\u308b\n\u4eca\u56de\u306f\u65e5\u672c\u8a9e\u30a2\u30ca\u30e9\u30a4\u30b6\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u3057\u3066\u304a\u99b4\u67d3\u307f\u306eelasticsearch-analysis-kuromoji\u3092\u4f7f\u3063\u3066\u307f\u307e\u3057\u3087\u3046. pom.xml\u306b\u6b21\u306e\u4f9d\u5b58\u3092\u8ffd\u52a0\u3057\u307e\u3059.\n\npom.xml\n<dependency>\n    <groupId>org.elasticsearch</groupId>\n    <artifactId>elasticsearch-analysis-kuromoji</artifactId>\n    <version>2.7.0</version>\n</dependency>\n\n\nElasticsearch\u3068kuromoji\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u5bfe\u5fdc\u306f, \u30b5\u30fc\u30d0\u30fc\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068\u304d\u3068\u540c\u69d8\u306b, elasticsearch-analysis-kuromoji\u306eGitHub\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059. \u4eca\u56de\u306fes-1.7\u306b\u5bfe\u5fdc\u3059\u308belasticsearch-analysis-kuromoji 2.7.0\u3092\u4f7f\u3048\u3070\u3088\u3044\u3068\u5206\u304b\u308a\u307e\u3059.\n\nnodeSettings\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f7f\u7528\u3059\u308b\u65e8\u3092\u8a18\u8ff0\u3059\u308b\n\u3053\u308c\u306b\u306f2\u901a\u308a\u3084\u308a\u65b9\u304c\u3042\u308a\u307e\u3059.\n\n\u30af\u30e9\u30b9\u30d1\u30b9\u306b\u5b58\u5728\u3059\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u3059\u3079\u3066\u8aad\u307f\u8fbc\u3080\n\njava\n    @Override\n    protected Settings nodeSettings(int nodeOrdinal) {\n        return ImmutableSettings.settingsBuilder()\n            .put(super.nodeSettings(nodeOrdinal))\n            .put(\"plugins.\" + PluginsService.LOAD_PLUGIN_FROM_CLASSPATH, true)\n            .build();\n    }\n\n\n\"plugins.\"\u306b\u7d9a\u3051\u3066org.elasticsearch.plugins.PluginsService.LOAD_PLUGIN_FROM_CLASSPATH\u3067\u6307\u5b9a\u3055\u308c\u308b\u6587\u5b57\u5217\u5b9a\u6570\u3092\u9023\u7d50\u3057\u305f\u8a2d\u5b9a\u540d\u306b\u5bfe\u3057\u3066true\u3092\u4e0e\u3048\u308b\u3068, \u30af\u30e9\u30b9\u30d1\u30b9\u4e0a\u306b\u5b58\u5728\u3059\u308b\u3059\u3079\u3066\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u8aad\u307f\u306b\u884c\u304f\u3088\u3046\u306b\u306a\u308a\u307e\u3059.\n\u3061\u306a\u307f\u306b, elasticsearch 1.7.3\u3067\u306f\u3053\u306e\u8a2d\u5b9a\u540d\u306f\"plugins.load_classpath_plugins\"\u3068\u5c55\u958b\u3055\u308c\u308b\u3088\u3046\u3067\u3059.\n\n\u8aad\u307f\u8fbc\u3080\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u6307\u5b9a\u3059\u308b\n\njava\n    @Override\n    protected Settings nodeSettings(int nodeOrdinal) {\n        return ImmutableSettings.settingsBuilder()\n            .put(super.nodeSettings(nodeOrdinal))\n            .put(\"plugin.types\", AnalysisKuromojiPlugin.class.getName())\n            .build();\n    }\n\n\n\"plugin.types\"\u306b\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30af\u30e9\u30b9\u540d\u3092\u4e0e\u3048\u308b\u3068, \u4e0e\u3048\u305f\u540d\u524d\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u8aad\u307f\u8fbc\u307e\u308c\u307e\u3059. \u30c6\u30b9\u30c8\u6642\u306b\u4f55\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u5fc5\u8981\u306a\u306e\u304b\u304c\u660e\u793a\u3055\u308c\u308b\u306e\u3067, \u500b\u4eba\u7684\u306b\u306f\u3053\u3063\u3061\u306e\u65b9\u304c\u597d\u304d\u3067\u3059.\n\u8907\u6570\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u8aad\u307f\u8fbc\u307e\u305b\u305f\u3044\u5834\u5408\u306f, put\u30e1\u30bd\u30c3\u30c9\u306e\u4ee3\u308f\u308a\u306bputArray\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3063\u3066\u6b21\u306e\u3088\u3046\u306b\u66f8\u304d\u307e\u3059.\n\njava\n    @Override\n    protected Settings nodeSettings(int nodeOrdinal) {\n        return ImmutableSettings.settingsBuilder()\n            .put(super.nodeSettings(nodeOrdinal))\n            .putArray(\"plugin.types\",\n                AnalysisKuromojiPlugin.class.getName(),\n                AnalysisICUPlugin.class.getName()) // elasticsearch-analysis-icu \u30d7\u30e9\u30b0\u30a4\u30f3\n            .build();\n    }\n\n\n\u306a\u304a, elasticsearch 2.1\u304b\u3089\u306fnodePlugins\u3068\u3044\u3046\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u6307\u5b9a\u3059\u308b\u305f\u3081\u306e\u5c02\u7528\u30e1\u30bd\u30c3\u30c9\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u3067\u3059( \u516c\u5f0f: integration tests (2.1) ).\n\n\u65e5\u672c\u8a9e\u3092\u4f7f\u3063\u305f\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\n\u5b9f\u969b\u306bkuromoji\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u8aad\u307f\u8fbc\u3081\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046.\n\nsrc/main/java/jp/akimateras/elasticsearch/esintegtest/service/SimpleSearch.java\npackage jp.akimateras.elasticsearch.esintegtest.service;\n\nimport static org.hamcrest.Matchers.is;\n\nimport org.elasticsearch.common.settings.ImmutableSettings;\nimport org.elasticsearch.common.settings.Settings;\nimport org.elasticsearch.common.xcontent.XContentBuilder;\nimport org.elasticsearch.common.xcontent.XContentFactory;\nimport org.elasticsearch.plugin.analysis.kuromoji.AnalysisKuromojiPlugin;\nimport org.elasticsearch.test.ElasticsearchIntegrationTest;\nimport org.junit.Before;\nimport org.junit.Test;\n\n@ElasticsearchIntegrationTest.ClusterScope(numDataNodes = 1)\npublic class SimpleSearchTest extends ElasticsearchIntegrationTest {\n    @Override\n    protected Settings nodeSettings(int nodeOrdinal) {\n        return ImmutableSettings.settingsBuilder()\n            .put(super.nodeSettings(nodeOrdinal))\n            .put(\"plugin.types\", AnalysisKuromojiPlugin.class.getName())\n            .build();\n    }\n\n    @Before\n    public void initializeIndex() throws Exception {\n        // \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210.\n        XContentBuilder mapping = XContentFactory.jsonBuilder()\n            .startObject()\n                .startObject(SimpleSearch.TYPE_NAME)\n                    .startObject(\"properties\")\n                        .startObject(SimpleSearch.TITLE_FIELD_NAME)\n                            .field(\"type\", \"string\")\n                            .field(\"source\", true)\n                            .field(\"analyzer\", \"kuromoji\") // kuromoji\u304c\u306a\u3044\u3068\u3053\u308c\u304c\u30a8\u30e9\u30fc\u306b\u306a\u308b.\n                        .endObject()\n                        .startObject(SimpleSearch.TEXT_FIELD_NAME)\n                            .field(\"type\", \"string\")\n                            .field(\"source\", true)\n                            .field(\"analyzer\", \"kuromoji\")\n                        .endObject()\n                    .endObject()\n                .endObject()\n            .endObject();\n\n        admin().indices().prepareCreate(SimpleSearch.INDEX_NAME)\n            .addMapping(SimpleSearch.TYPE_NAME, mapping)\n            .execute()\n            .actionGet();\n\n        // \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u5b8c\u4e86\u306e\u5f85\u6a5f.\n        ensureGreen();\n    }\n\n    @Test\n    public void testSearch() throws Exception {\n        // \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u6295\u5165. \u65e5\u672c\u8a9e\u3092\u4f7f\u3044\u307e\u3059.\n        index(SimpleSearch.INDEX_NAME, SimpleSearch.TYPE_NAME, XContentFactory.jsonBuilder()\n            .startObject()\n                .field(SimpleSearch.TITLE_FIELD_NAME, \"\u30a2\u30eb\u30d1\u30ab\")\n                .field(SimpleSearch.TEXT_FIELD_NAME, \"\u30a2\u30eb\u30d1\u30ab\u306f, \u5357\u30a2\u30e1\u30ea\u30ab\u306e\u30e9\u30af\u30c0\u79d1\u52d5\u7269\u306e\u5bb6\u755c\u3067\u3059.\")\n            .endObject());\n\n        index(SimpleSearch.INDEX_NAME, SimpleSearch.TYPE_NAME, XContentFactory.jsonBuilder()\n            .startObject()\n                .field(SimpleSearch.TITLE_FIELD_NAME, \"\u30ea\u30e3\u30de\")\n                .field(SimpleSearch.TEXT_FIELD_NAME, \"\u30ea\u30e3\u30de\u306f, \u5357\u30a2\u30e1\u30ea\u30ab\u306e\u30e9\u30af\u30c0\u79d1\u52d5\u7269\u306e\u5bb6\u755c\u3067\u3059.\")\n            .endObject());\n\n        index(SimpleSearch.INDEX_NAME, SimpleSearch.TYPE_NAME, XContentFactory.jsonBuilder()\n            .startObject()\n                .field(SimpleSearch.TITLE_FIELD_NAME, \"\u30d3\u30af\u30fc\u30cb\u30e3\")\n                .field(SimpleSearch.TEXT_FIELD_NAME, \"\u30d3\u30af\u30fc\u30cb\u30e3\u306f, \u5357\u30a2\u30e1\u30ea\u30ab\u306e\u30a2\u30f3\u30c7\u30b9\u5c71\u8108\u306b\u751f\u606f\u3059\u308b\u8349\u98df\u54fa\u4e73\u985e\u3067\u3059.\")\n            .endObject());\n\n        // \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u6295\u5165\u5b8c\u4e86\u306e\u5f85\u6a5f.\n        flushAndRefresh();\n        ensureGreen();\n\n        // \u30c6\u30b9\u30c8\u7528 client \u3092\u4f7f\u3063\u3066SimpleSearch\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210.\n        SimpleSearch service = new SimpleSearch(client());\n\n        // \u30c6\u30b9\u30c8\u5b9f\u65bd\n        assertThat(service.search(\"\u30a2\u30eb\u30d1\u30ab\").size(), is(1));\n        assertThat(service.search(\"\u30ea\u30e3\u30de\").size(), is(1));\n        assertThat(service.search(\"\u30d3\u30af\u30fc\u30cb\u30e3\").size(), is(1));\n        assertThat(service.search(\"\u30e9\u30de\").size(), is(0));\n\n        assertThat(service.search(\"\u5bb6\u755c\").size(), is(2));\n        assertThat(service.search(\"\u30a2\u30eb\u30d1\u30ab \u5bb6\u755c\").size(), is(1));\n        assertThat(service.search(\"\u30ea\u30e3\u30de \u5bb6\u755c\").size(), is(1));\n        assertThat(service.search(\"\u30d3\u30af\u30fc\u30cb\u30e3 \u5bb6\u755c\").size(), is(0));\n    }\n}\n\n\n\u3069\u3046\u3067\u3082\u3044\u3044\u3093\u3067\u3059\u304c, \u3053\u306e\u30c6\u30b9\u30c8, kuromoji\u3092\u4f7f\u308f\u305a\u3068\u3082\u30c7\u30d5\u30a9\u30eb\u30c8\u306estandard analyzer\u3067\u3082\u5168\u90e8\u901a\u308a\u307e\u3059...\u306a\u304b\u306a\u304b\u512a\u79c0\u3067\u3059\u306d.\n\u6295\u5165\u6587\u66f8\u306e\u30bf\u30a4\u30c8\u30eb\u3068\u30c6\u30ad\u30b9\u30c8\u4e21\u65b9\u306e\"\u30a2\u30eb\u30d1\u30ab\"\u3092\"\u30a2\u30eb\u30d1\u30ab\u30a2\u30eb\u30d1\u30ab\"\u3068\u304b\u306b\u5909\u3048\u3066\u3042\u3052\u308b\u3068, standard analyzer\u306f\u3053\u308c\u30921\u8a9e\u3068\u3057\u3066\u8a8d\u8b58\u3059\u308b\u306e\u3067, \"\u30a2\u30eb\u30d1\u30ab\"\u3067\u691c\u7d22\u3057\u3066\u3082\u5f15\u3063\u304b\u304b\u3089\u306a\u304f\u306a\u308a\u307e\u3059. kuromoji\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u306f\"\u30a2\u30eb\u30d1\u30ab\"x2\u3068\u8a8d\u8b58\u3059\u308b\u306e\u3067, \"\u30a2\u30eb\u30d1\u30ab\"\u3067\u691c\u7d22\u3067\u304d\u307e\u3059.\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u5fc5\u8981\u306a\u6a5f\u80fd\u306e\u30c6\u30b9\u30c8\n\u6700\u5f8c\u306bgroovy\u3068\u304b\u306e\u30c7\u30a3\u30b9\u30af\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5fc5\u8981\u3068\u3059\u308b\u6a5f\u80fd\u306e\u30c6\u30b9\u30c8\u65b9\u6cd5\u3092\u7d39\u4ecb\u3057\u307e\u3059.\nElasticsearch\u306e\u30c7\u30a3\u30b9\u30af\u30b9\u30af\u30ea\u30d7\u30c8\u306f, \u30b5\u30fc\u30d0\u30fc\u3068\u3057\u3066\u8d77\u52d5\u3059\u308b\u5834\u5408\u306f/etc/elasticsearch/scripts\u306e\u3088\u3046\u306a\u5834\u6240\u306b\u7f6e\u304f\u3068\u81ea\u52d5\u7684\u306b\u8aad\u307f\u8fbc\u307e\u308c\u308b\u3082\u306e\u3067\u3057\u305f. \nElasticsearchIntegrationTest\u304b\u3089\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u898b\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u306b\u306f, \u30b5\u30fc\u30d0\u30fc\u306e\u3068\u304d\u3068\u540c\u69d8\u306b\u7279\u5b9a\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30b9\u30af\u30ea\u30d7\u30c8\u7fa4\u3092\u8a2d\u7f6e\u3057, nodeSettings\u30e1\u30bd\u30c3\u30c9\u3067\u8a2d\u7f6e\u5834\u6240\u3092\u8a18\u8ff0\u3059\u308c\u3070OK\u3067\u3059.\n\u305f\u3060\u3057, elasticsearch 1.7.3\u3067\u306f\u30b9\u30af\u30ea\u30d7\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u76f4\u63a5\u6307\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093. \"path.conf\"\u3067\u6307\u5b9a\u3067\u304d\u308b\u8a2d\u5b9a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u76f4\u4e0b\u306escripts\u3068\u3044\u3046\u540d\u524d\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6c7a\u3081\u6253\u3061\u3067\u63a2\u3057\u306b\u884c\u304d\u307e\u3059.\n\u305d\u306e\u305f\u3081, \u4f8b\u3048\u3070src/test/resources/scripts\u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u8aad\u307f\u306b\u884c\u304b\u305b\u305f\u3044\u5834\u5408\u306f, \"path.conf\"\u306b\"src/test/resources\"\u3092\u6307\u5b9a\u3059\u308b, \u3068\u3044\u3063\u305f\u3084\u308a\u65b9\u306b\u306a\u308a\u307e\u3059.\n\nsrc/test/java/jp/akimateras/elasticsearch/esintegtest/service/SimpleSearchTest.java\n    @Override\n    protected Settings nodeSettings(int nodeOrdinal) {\n        return ImmutableSettings.settingsBuilder()\n            .put(super.nodeSettings(nodeOrdinal))\n            .put(\"plugin.types\", AnalysisKuromojiPlugin.class.getName())\n            .put(\"path.conf\", \"src/test/resources\")\n            .build();\n    }\n\n\n\u306a\u304a. elasticsearch 2.1\u304b\u3089\u306f\"path.script\"\u3068\u3044\u3046\u8a2d\u5b9a\u540d\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u76f4\u63a5\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u6539\u5584\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u3067\u3059( \u516c\u5f0f: Directory Layout (2.1) ).\n\n\u304a\u308f\u308a\u306b\n\u56db\u82e6\u516b\u82e6\u3057\u3066\u30c6\u30b9\u30c8\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u304c\u3084\u3063\u3068\u52d5\u3044\u305f\u3088\u3068\u3044\u3046\u8a18\u4e8b\u3067\u3059\u306e\u3067, \u9593\u9055\u3044\u306a\u3069\u3042\u308a\u307e\u3057\u305f\u3089\u3054\u6307\u6458\u3092\u5b9c\u3057\u304f\u304a\u9858\u3044\u81f4\u3057\u307e\u3059...\n\u82e6\u52b4\u306f\u3057\u305f\u3082\u306e\u306e, \u3053\u308c\u306e\u304a\u304b\u3052\u3067\u30c6\u30b9\u30c8\u7528Elasticsearch\u30b5\u30fc\u30d0\u30fc\u306e\u7ba1\u7406\u304c\u4e0d\u8981\u306b\u306a\u3063\u305f\u306e\u306f\u304b\u306a\u308a\u5b09\u3057\u304f, \u5c0e\u5165\u3057\u305f\u7532\u6590\u306f\u3042\u3063\u305f\u3068\u611f\u3058\u3066\u3044\u307e\u3059.\n\u660e\u65e5\u306f, takakiku\u3055\u3093\u306eMySQL\u30b9\u30ed\u30fc\u30ed\u30b0\u53ef\u8996\u5316\u306e\u8a18\u4e8b\u3067\u3059\uff01\n# \u30d0\u30fc\u30b8\u30e7\u30f3\u60c5\u5831\n* Elasticsearch 1.7.4\n\n\u672c\u8a18\u4e8b\u304c\u6271\u3046`ElasticsearchIntegrationTest`\u306f\u30d0\u30fc\u30b8\u30e7\u30f32\u7cfb\u304b\u3089`ESIntegTestCase`\u3078\u3068\u540d\u524d\u304c\u5909\u308f\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3059. \u4f34\u3063\u3066\u5927\u304d\u306a\u5909\u66f4\u304c\u5165\u3063\u3066\u3044\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u306e\u3067, \u3054\u6ce8\u610f\u304f\u3060\u3055\u3044.\n\n# \u306f\u3058\u3081\u306b\n## \u6982\u8981\n\u3053\u306e\u8a18\u4e8b\u306f[Elasticsearch Advent Calendar 2015](http://qiita.com/advent-calendar/2015/elasticsearch)\u306e3\u65e5\u76ee\u306e\u30a8\u30f3\u30c8\u30ea\u3067\u3059\u3002\n\n\u5b9f\u306fElasticsearch\u306fJava\u3067\u30c6\u30b9\u30c8\u3092\u66f8\u304f\u305f\u3081\u306e, `ElasticsearchIntegrationTest`\u3068\u3044\u3046\u30af\u30e9\u30b9\u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059. \u304c, \u65e5\u672c\u8a9e\u306e\u8cc7\u6599\u304c\u3081\u3063\u3061\u3083\u5c11\u306a\u3044\uff01\uff08\u3068\u3044\u3046\u304b\u7121\u3044\uff1f\uff09\u306e\u3067, \u79c1\u304c\u5c0e\u5165\u307e\u3067\u306b\u8abf\u3079\u305f\u3053\u3068\u3068\u304b\u3092\u307e\u3068\u3081\u3066\u307f\u307e\u3057\u305f.\n\n\u3053\u308c\u3092\u4f7f\u3046\u3068, \u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u305f\u30de\u30b7\u30f3\u4e0a\u3067\u7c21\u6613Elasticsearch\u30af\u30e9\u30b9\u30bf\u304c\u7acb\u3061\u4e0a\u304c\u308a, \u305d\u306e\u30af\u30e9\u30b9\u30bf\u306b\u5bfe\u3057\u3066\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u5185\u304b\u3089\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u6295\u5165\u3057\u305f\u308a, \u691c\u7d22\u3057\u305f\u308a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059. \u30c6\u30b9\u30c8\u7528\u306b\u308f\u3056\u308f\u3056Elasticsearch\u30b5\u30fc\u30d0\u30fc\u3092\u7acb\u3061\u4e0a\u3052\u308b\u5fc5\u8981\u304c\u306a\u304f\u306a\u308a\u307e\u3059\u3088\uff01\n\n## \u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 (Elasticsearch 1.7)\nElasticsearch\u516c\u5f0f\u3067\u89e6\u308c\u3066\u3044\u308b\u306e\u306f\u3053\u306e\u3042\u305f\u308a\u306e\u8a18\u4e8b\u306b\u306a\u308a\u307e\u3059.\n\n* [Java Testing Framework](https://www.elastic.co/guide/en/elasticsearch/reference/1.7/testing-framework.html)\n* [Using the elasticsearch test classes](https://www.elastic.co/guide/en/elasticsearch/reference/1.7/using-elasticsearch-test-classes.html)\n* [integration tests](https://www.elastic.co/guide/en/elasticsearch/reference/1.7/integration-tests.html)\n\n# \u30c6\u30b9\u30c8\u306b\u5fc5\u8981\u306a\u4f9d\u5b58\u95a2\u4fc2\n\u672c\u8a18\u4e8b\u3067\u306fMaven\u3092\u4f7f\u3044\u307e\u3059. \u3068\u308a\u3042\u3048\u305a`elasticsearch 1.7.4`\u3067`ElasticsearchIntegrationTest`\u3092\u8a66\u3057\u3066\u307f\u308b\u305f\u3081\u306e\u4f9d\u5b58\u306e\u8a18\u8ff0\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059.\n\n```xml:pom.xml\n<dependencies>\n    <dependency>\n        <groupId>org.apache.lucene</groupId>\n        <artifactId>lucene-test-framework</artifactId>\n        <version>4.10.4</version>\n        <scope>test</scope>\n    </dependency>\n    <dependency>\n        <groupId>com.carrotsearch.randomizedtesting</groupId>\n        <artifactId>randomizedtesting-runner</artifactId>\n        <version>2.1.17</version>\n        <scope>test</scope>\n    </dependency>\n    <dependency>\n        <groupId>org.elasticsearch</groupId>\n        <artifactId>elasticsearch</artifactId>\n        <version>1.7.3</version>\n        <type>test-jar</type>\n        <scope>test</scope>\n    </dependency>\n    <dependency>\n        <groupId>org.elasticsearch</groupId>\n        <artifactId>elasticsearch</artifactId>\n        <version>1.7.3</version>\n        <scope>test</scope>\n    </dependency>\n    <dependency>\n        <groupId>junit</groupId>\n        <artifactId>junit</artifactId>\n        <version>4.12</version>\n        <scope>test</scope>\n    </dependency>\n    <dependency>\n        <groupId>org.hamcrest</groupId>\n        <artifactId>hamcrest-all</artifactId>\n        <version>1.3</version>\n        <scope>test</scope>\n    </dependency>\n  </dependencies>\n```\n\n\u8a18\u8ff0\u9806\u5e8f\u304c\u5909\u308f\u308b\u3068\u52d5\u304b\u306a\u304f\u306a\u3063\u305f\u308a\u3059\u308b\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044.\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u6c7a\u3081\u65b9\u3068\u3057\u3066\u306f, \u307e\u305a`elasticsearch`\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u81ea\u5206\u304c\u4f7f\u3063\u3066\u3044\u308b\u3082\u306e\u3092\u6307\u5b9a\u3057\u307e\u3059. `<type>test-jar</type>`\u306e\u65b9\u3082\u542b\u3081\u308b\u30682\u7b87\u6240\u3067\u3059. \u4eca\u56de\u306f`1.7.3`\u3092\u6307\u5b9a\u3057\u307e\u3057\u305f.\n\n\u6b21\u306b, \u4f7f\u3063\u3066\u3044\u308bElasticsearch\u304c\u4f9d\u5b58\u3057\u3066\u3044\u308bLucene\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u8abf\u3079, `lucene-test-framework`\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u6c7a\u3081\u307e\u3059. Eclipse\u306eMaven POM \u30a8\u30c7\u30a3\u30bf\u30fc\u3067\u4f9d\u5b58\u95a2\u4fc2\u3092\u8abf\u3079\u305f\u308a, [Maven Repository\u306e\u5f53\u8a72\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u30da\u30fc\u30b8](http://mvnrepository.com/artifact/org.elasticsearch/elasticsearch/1.7.3)\u3092\u898b\u305f\u308a\u3059\u308b\u306e\u304c\u3044\u3044\u3093\u3058\u3083\u306a\u3044\u304b\u3068\u601d\u3044\u307e\u3059. \u4eca\u56de\u306f`4.10.4`\u3092\u4f7f\u3048\u3070\u3088\u3044\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059.\n\n\u6700\u5f8c\u306b, `randomizedtesting-runner`\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u6c7a\u5b9a\u3059\u308b\u306e\u3067\u3059\u304c, \u3053\u308c\u306f\u8abf\u3079\u65b9\u304c\u5206\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f.\n`lucene-test-framework 4.10.4`\u304c\u4f9d\u5b58\u3057\u3066\u3044\u308b`randomizedtesting-runner 2.1.6`\u3092\u4f7f\u3048\u3070\u3088\u3044\u306e\u304b\u3068\u601d\u3044\u304d\u3084, \u306a\u3093\u304b\u52d5\u304d\u307e\u305b\u3093\u3067\u3057\u305f. `2.1`\u7cfb\u306e\u6700\u65b0\u7248\u3067\u3042\u308b`2.1.17`\u3092\u6307\u5b9a\u3057\u305f\u3089\u52d5\u304d\u307e\u3057\u305f. \u672c\u5f53\u306f `lucene-test-framework` \u3067 `randomizedtesting-runner` \u3092Exclude\u3057\u305f\u65b9\u304c\u826f\u3044\u306e\u304b\u3082\u3057\u308c\u306a\u3044.\n\n# \u30c6\u30b9\u30c8\u5bfe\u8c61\u30b3\u30fc\u30c9\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a, Elasticsearch\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3067\u53d7\u3051\u53d6\u308a, `search`\u30e1\u30bd\u30c3\u30c9\u3067\u3054\u304f\u7c21\u5358\u306a\u691c\u7d22\u3092\u884c\u3046\u30af\u30e9\u30b9\u3092\u30c6\u30b9\u30c8\u5bfe\u8c61\u3068\u3057\u307e\u3059.\n\n```java:src/main/java/jp/akimateras/elasticsearch/esintegtest/service/SimpleSearch.java\npackage jp.akimateras.elasticsearch.esintegtest.service;\n\nimport java.io.IOException;\nimport java.util.Arrays;\nimport java.util.Collection;\nimport java.util.stream.Collectors;\n\nimport org.elasticsearch.action.search.SearchResponse;\nimport org.elasticsearch.client.Client;\nimport org.elasticsearch.index.query.MatchQueryBuilder.Operator;\nimport org.elasticsearch.index.query.MultiMatchQueryBuilder;\nimport org.elasticsearch.index.query.QueryBuilders;\nimport org.elasticsearch.search.SearchHit;\n\npublic class SimpleSearch {\n    // \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u30fb\u30bf\u30a4\u30d7\u540d\u5b9a\u7fa9.\n    public static final String INDEX_NAME = \"simple-search\";\n    public static final String TYPE_NAME = \"documents\";\n\n    // \u30d5\u30a3\u30fc\u30eb\u30c9\u540d\u5b9a\u7fa9.\n    public static final String TITLE_FIELD_NAME = \"title\";\n    public static final String TEXT_FIELD_NAME = \"text\";\n\n    // \u691c\u7d22\u7d50\u679c\u306e\u8fd4\u5374\u578b.\n    public static class Document {\n        public final String title;\n        public final String text;\n\n        Document(String title, String text) {\n            this.title = title;\n            this.text = text;\n        }\n    }\n\n    // Elasticsearch\u30af\u30e9\u30a4\u30a2\u30f3\u30c8.\n    private final Client client;\n\n    /**\n     * \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf.\n     * \n     * @param client \u691c\u7d22\u306b\u4f7f\u7528\u3059\u308bElasticsearch\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\n     */\n    public SimpleSearch(Client client) {\n        this.client = client;\n    }\n\n    /**\n     * \u691c\u7d22\u30e1\u30bd\u30c3\u30c9\n     * \n     * @param keywords \u691c\u7d22\u30ad\u30fc\u30ef\u30fc\u30c9. \u30b9\u30da\u30fc\u30b9\u533a\u5207\u308a\u3067\u8907\u6570\u306e\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u306fAND\u691c\u7d22\u3068\u3059\u308b.\n     * @return \u691c\u7d22\u7d50\u679c.\n     */\n    public Collection<Document> search(String keywords) throws IOException {\n        try {\n            // \u691c\u7d22\u30af\u30a8\u30ea\u306e\u7d44\u307f\u7acb\u3066.\n            MultiMatchQueryBuilder query = QueryBuilders\n                .multiMatchQuery(keywords, TITLE_FIELD_NAME, TEXT_FIELD_NAME)\n                .operator(Operator.AND);\n\n            // \u691c\u7d22\u306e\u5b9f\u884c.\n            SearchResponse response = client.prepareSearch(INDEX_NAME)\n                .setTypes(TYPE_NAME)\n                .setQuery(query)\n                .execute()\n                .get();\n\n            // \u691c\u7d22\u7d50\u679c\u3092 Collection<Document> \u306b\u8a70\u3081\u66ff\u3048\u3066return\u3059\u308b.\n            return Arrays.stream(response.getHits().hits())\n                .map(SearchHit::sourceAsMap)\n                .map(source -> new Document(\n                    (String) source.get(TITLE_FIELD_NAME),\n                    (String) source.get(TEXT_FIELD_NAME)\n                    ))\n                .collect(Collectors.toList());\n        } catch(Exception e) {\n            throw new IOException(e);\n        }\n    }\n}\n```\n\n# \u30b7\u30f3\u30d7\u30eb\u306a\u30c6\u30b9\u30c8\n\u4e0a\u3067\u4f5c\u3063\u305f`SimpleSearch`\u30af\u30e9\u30b9\u3092\u96d1\u306b\u30c6\u30b9\u30c8\u3057\u3066\u307f\u307e\u3057\u3087\u3046.\n\n`ElasticsearchIntegrationTest`\u3067\u30c6\u30b9\u30c8\u3092\u66f8\u304f\u305f\u3081\u306b\u306f, \n\n1. \u30c6\u30b9\u30c8\u30af\u30e9\u30b9\u306b`ElasticsearchIntegrationTest`\u3092\u7d99\u627f\u3055\u305b\u308b.\n2. \u30c6\u30b9\u30c8\u30e1\u30bd\u30c3\u30c9\u5185\u3067`client()`\u3092\u547c\u3073\u51fa\u3059\u3068Elasticsearch\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u53d6\u308c\u308b.\n\n\u306e2\u70b9\u3060\u3051\u62bc\u3055\u3048\u3066\u304a\u3051\u3070OK\u3067\u3059.\n\n```java:src/test/java/jp/akimateras/elasticsearch/esintegtest/service/SimpleSearchTest.java\npackage jp.akimateras.elasticsearch.esintegtest.service;\n\nimport static org.hamcrest.Matchers.is;\n\nimport org.elasticsearch.common.settings.ImmutableSettings;\nimport org.elasticsearch.common.settings.Settings;\nimport org.elasticsearch.common.xcontent.XContentBuilder;\nimport org.elasticsearch.common.xcontent.XContentFactory;\nimport org.elasticsearch.test.ElasticsearchIntegrationTest;\nimport org.junit.Before;\nimport org.junit.Test;\n\n@ElasticsearchIntegrationTest.ClusterScope(numDataNodes = 1 /* \u30c6\u30b9\u30c8\u6642\u306b\u7acb\u3061\u4e0a\u3052\u308b\u30ce\u30fc\u30c9\u6570 */)\npublic class SimpleSearchTest extends ElasticsearchIntegrationTest {\n    // \u30c6\u30b9\u30c8\u7528\u30ce\u30fc\u30c9\u306b\u8a2d\u5b9a\u3057\u305f\u3044\u5185\u5bb9\u306f\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u306e\u8fd4\u5374\u5024\u3068\u3057\u3066\u8868\u73fe\u3059\u308b.\n    @Override\n    protected Settings nodeSettings(int nodeOrdinal) {\n        return ImmutableSettings.settingsBuilder()\n            .put(super.nodeSettings(nodeOrdinal))\n            .build();\n    }\n\n\t// \u3053\u3053\u3067\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f5c\u6210\u3059\u308b.\n    @Before\n    public void initializeIndex() throws Exception {\n        // \u30de\u30c3\u30d4\u30f3\u30b0\u5b9a\u7fa9.\n        // \u5916\u90e8JSON\u30d5\u30a1\u30a4\u30eb\u3068\u304b\u3067\u30de\u30c3\u30d4\u30f3\u30b0\u5b9a\u7fa9\u3092\u3057\u3066\u3044\u308b\u306a\u3089, \u305d\u3063\u3061\u304b\u3089\u8aad\u3093\u3060\u65b9\u304c\u826f\u3044\u3068\u601d\u3046.\n        XContentBuilder mapping = XContentFactory.jsonBuilder()\n            .startObject()\n                .startObject(SimpleSearch.TYPE_NAME)\n                    .startObject(\"properties\")\n                        .startObject(SimpleSearch.TITLE_FIELD_NAME)\n                            .field(\"type\", \"string\")\n                            .field(\"source\", true)\n                        .endObject()\n                        .startObject(SimpleSearch.TEXT_FIELD_NAME)\n                            .field(\"type\", \"string\")\n                            .field(\"source\", true)\n                        .endObject()\n                    .endObject()\n                .endObject()\n            .endObject();\n\n        // \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210.\n        admin().indices() // admin()\u3067\u30a2\u30c9\u30df\u30f3\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u53d6\u308c\u308b\uff01\n            .prepareCreate(SimpleSearch.INDEX_NAME)\n            .addMapping(SimpleSearch.TYPE_NAME, mapping)\n            .execute()\n            .actionGet();\n\n        // \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u5b8c\u4e86\u306e\u5f85\u6a5f.\n        ensureGreen();\n    }\n\n\t// \u30c6\u30b9\u30c8\u672c\u4f53\n    @Test\n    public void testSearch() throws Exception {\n        // \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u6295\u5165.\n        // \u3053\u308c\u3082\u5916\u90e8JSON\u30d5\u30a1\u30a4\u30eb\u306a\u3069\u3092\u7528\u610f\u3057\u3066, Bulk API\u3067\u6295\u5165\u3057\u305f\u65b9\u304c\u826f\u3044\u3068\u601d\u3046.\n        index(SimpleSearch.INDEX_NAME, SimpleSearch.TYPE_NAME, XContentFactory.jsonBuilder()\n            .startObject()\n                .field(SimpleSearch.TITLE_FIELD_NAME, \"Alpaca\")\n                .field(SimpleSearch.TEXT_FIELD_NAME, \"An alpaca is a domesticated species of South American camelid.\")\n            .endObject());\n\n        index(SimpleSearch.INDEX_NAME, SimpleSearch.TYPE_NAME, XContentFactory.jsonBuilder()\n            .startObject()\n                .field(SimpleSearch.TITLE_FIELD_NAME, \"Llama\")\n                .field(SimpleSearch.TEXT_FIELD_NAME, \"A llama is a domesticated species of South American camelid.\")\n            .endObject());\n\n        index(SimpleSearch.INDEX_NAME, SimpleSearch.TYPE_NAME, XContentFactory.jsonBuilder()\n            .startObject()\n                .field(SimpleSearch.TITLE_FIELD_NAME, \"Vicugna\")\n                .field(SimpleSearch.TEXT_FIELD_NAME, \"A vicugna is a kind of herbivorous mammals that inhabit the Andes of South America.\")\n            .endObject());\n\n        // \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u6295\u5165\u5b8c\u4e86\u306e\u5f85\u6a5f.\n        flushAndRefresh();\n        ensureGreen();\n\n        // \u30c6\u30b9\u30c8\u7528\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u5bfe\u3057\u3066SimpleSearch\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210.\n        SimpleSearch service = new SimpleSearch(client()); // client()\u3067\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u53d6\u308c\u308b\uff01\n        \n        // \u30c6\u30b9\u30c8\u5b9f\u65bd.\n        // \u305b\u3063\u304b\u304f\u306a\u306e\u3067, \u4f9d\u5b58\u306e\u304a\u307e\u3051\u3067\u4ed8\u3044\u3066\u304d\u305fhamcrest\u3092\u4f7f\u304a\u3046.\n        assertThat(service.search(\"alpaca\").size(), is(1));\n        assertThat(service.search(\"llama\").size(), is(1));\n        assertThat(service.search(\"vicugna\").size(), is(1));\n        assertThat(service.search(\"lama\").size(), is(0));\n\n        assertThat(service.search(\"domesticated\").size(), is(2));\n        assertThat(service.search(\"alpaca domesticated\").size(), is(1));\n        assertThat(service.search(\"llama domesticated\").size(), is(1));\n        assertThat(service.search(\"vicugna domesticated\").size(), is(0));\n    }\n}\n```\n\n`client()`\u3067Elasticsearch\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u53d6\u308c\u308b\u306e\u3067, \u57fa\u672c\u7684\u306b\u306f\u3082\u3046\u4f55\u3067\u3082\u3067\u304d\u307e\u3059\u306d. \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u306a\u3069\u306b\u30a2\u30c9\u30df\u30f3\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u5fc5\u8981\u306a\u5834\u5408\u306f`client().admin()`\u307e\u305f\u306f, `admin()`\u3067\u53d6\u5f97\u3057\u3066\u304f\u3060\u3055\u3044. \n\n`@Before`\u3067\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f5c\u6210\u3057\u3066\u3044\u307e\u3059\u304c, `@After`\u3067\u81ea\u524d\u3067\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u524a\u9664\u3059\u308b\u5fc5\u8981\u306f\u306a\u304f, \u30c6\u30b9\u30c8\u30e1\u30bd\u30c3\u30c9\u6bce\u306b\u81ea\u52d5\u7684\u306b\u307e\u3063\u3055\u3089\u306b\u3057\u3066\u304f\u308c\u308b\u307f\u305f\u3044\u3067\u3059. \u4fbf\u5229.\n\n`ensureGreen()`\u3084`flushAndRefresh()`\u306a\u3069, \u666e\u6bb5\u898b\u304b\u3051\u306a\u3044\u30e1\u30bd\u30c3\u30c9\u304c\u767b\u5834\u3057\u3066\u3044\u307e\u3059\u304c, \u3053\u308c\u3089\u306f`ElasticsearchIntegrationTest`\u304c\u63d0\u4f9b\u3057\u3066\u304f\u308c\u308b\u4fbf\u5229\u30e1\u30bd\u30c3\u30c9\u3067\u3059. \u305f\u3068\u3048\u3070 `ensureGreen()` \u3092\u81ea\u524d\u3067\u66f8\u304f\u3068\u3059\u308b\u3068,\n\n```java\nclient().admin().cluster().prepareHealth()\n    .setWaitForGreenStatus()\n    .execute()\n    .actionGet();\n```\n\n\u307f\u305f\u3044\u306b\u3061\u3087\u3063\u3068\u9577\u304f\u306a\u308a\u307e\u3059. \u3082\u3061\u308d\u3093, \u3053\u306e\u624b\u306e\u64cd\u4f5c\u3092\u30c6\u30b9\u30c8\u3059\u308b\u305f\u3081\u306b, \u81ea\u524d\u3067\u66f8\u3044\u3066\u3082OK\u3067\u3059. \u4fbf\u5229\u30e1\u30bd\u30c3\u30c9\u306e\u4e00\u89a7\u306f[\u516c\u5f0f: integration tests (1.7)](https://www.elastic.co/guide/en/elasticsearch/reference/1.7/integration-tests.html#helper-methods)\u3092\u53c2\u7167.\n\n# \u3053\u3053\u307e\u3067\u3067\u52d5\u304b\u306a\u3044\u3068\u304d\n\u79c1\u304c\u8e0f\u3093\u3060\u30a8\u30e9\u30fc\u306e\u30ed\u30b0\u3068\u305d\u306e\u5bfe\u51e6\u3092\u66f8\u3044\u3066\u304a\u304d\u307e\u3059.\n\n## \u578b <\u30af\u30e9\u30b9\u540d> \u306e\u968e\u5c64\u306f\u4e0d\u6574\u5408\u3067\u3059\n```text:Eclipse\u30a8\u30e9\u30fc\n\u578b <\u30af\u30e9\u30b9\u540d> \u306e\u968e\u5c64\u306f\u4e0d\u6574\u5408\u3067\u3059\nThe hierarchy of the type '<Class Name>' is inconsistent\n```\nElasticsearch\u306e\u30c6\u30b9\u30c8\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306ejar\u306f\u898b\u3048\u3066\u304a\u308a, \u304b\u3064, `randomizedtesting-runner`\u306ejar\u304c\u898b\u3048\u3066\u3044\u306a\u3044\u6642\u306b\u51fa\u305f\u30a8\u30e9\u30fc\u3067\u3059. Eclipse\u3067`ElasticsearchIntegrationTest`\u3092extends\u3057\u305f\u30c6\u30b9\u30c8\u30af\u30e9\u30b9\u306b\u8d64\u7dda\u304c\u5f15\u304b\u308c, \u4e0a\u8a18\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u307e\u3059. \u4f9d\u5b58\u304c\u6b63\u3057\u304f\u66f8\u3051\u3066\u3044\u308b\u304b\u306e\u78ba\u8a8d\u3084, \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30ea\u30d5\u30ec\u30c3\u30b7\u30e5/\u30af\u30ea\u30fc\u30f3\u306a\u3069\u8a66\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044.\n\n## Test class requires enabled assertions\n```text:\u5b9f\u884c\u6642\u51fa\u529b\njava.lang.Exception: Test class requires enabled assertions, enable globally (-ea) or for Solr/Lucene subpackages only: jp.akimateras.elasticsearch.esintegtest.test.SampleTest\n    __randomizedtesting.SeedInfo.seed([E05E1B5BAB0E8E6]:0)\n    org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:38)\n    org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n    org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)\n    org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:55)\n    [...com.carrotsearch.randomizedtesting.*]\n    java.lang.Thread.run(Unknown Source)\n```\n\n`ElasticsearchIntegrationTest`\u3092\u4f7f\u3046\u5834\u5408, \u30c6\u30b9\u30c8\u5b9f\u884c\u6642\u306b\u30a2\u30b5\u30fc\u30b7\u30e7\u30f3\u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u306a\u3044\u3068\u99c4\u76ee\u306a\u3088\u3046\u3067\u3059. JVM\u306e\u8d77\u52d5\u30aa\u30d7\u30b7\u30e7\u30f3\u306b`-ea`\u3092\u4ed8\u3051\u3066\u3042\u3052\u3066\u304f\u3060\u3055\u3044.\nEclipse\u304b\u3089\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u5834\u5408\u306f, `[\u5b9f\u884c\u306e\u69cb\u6210]`\u3067\u5bfe\u8c61\u306e\u69cb\u6210\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u958b\u304d, `[\u5f15\u6570]`\u30bf\u30d6\u306e`[VM \u5f15\u6570]`\u30c6\u30ad\u30b9\u30c8\u30a8\u30ea\u30a2\u306b`-ea`\u3068\u66f8\u3044\u3066\u3042\u3052\u308c\u3070OK\u3067\u3059.\n\n## tests-framework.jar\u3068lucene-core.jar\u304c\u3069\u3046\u306e\u3053\u3046\u306e\n```text:\u5b9f\u884c\u6642\u51fa\u529b\njava.lang.AssertionError: fix your classpath to have tests-framework.jar before lucene-core.jar\n    __randomizedtesting.SeedInfo.seed([C7B320FCEA3DEB94]:0)\n    org.apache.lucene.util.TestRuleSetupAndRestoreClassEnv.before(TestRuleSetupAndRestoreClassEnv.java:211)\n    org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)\n    org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:42)\n    [...com.carrotsearch.randomizedtesting.*]\n    org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:43)\n    org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n    org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)\n    org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:55)\n    [...com.carrotsearch.randomizedtesting.*]\n    java.lang.Thread.run(Unknown Source)\n```\n\n`pom.xml`\u306e\u8a18\u8ff0\u9806\u5e8f\u304c\u9593\u9055\u3063\u3066\u3044\u307e\u3059. Java\u306e\u30af\u30e9\u30b9\u30d1\u30b9\u306e\u9806\u5e8f\u304c\u554f\u984c\u306b\u306a\u308b\u306e\u304b\u306a...\uff1f\n`randomizedtesting-runner`\u3078\u306e\u4f9d\u5b58\u306e\u524d\u306bElasticsearch\u3078\u306e\u4f9d\u5b58\u3092\u66f8\u304f\u3068\u767a\u751f\u3059\u308b\u3088\u3046\u3067\u3059. Java\u306b\u8a73\u3057\u304f\u306a\u3044\u306e\u3067\u7406\u7531\u306f\u3088\u304f\u5206\u304b\u308a\u307e\u305b\u3093\u304c, \u8a18\u8ff0\u9806\u5e8f\u3067\u52d5\u304b\u306a\u3044\u3053\u3068\u304c\u3042\u308b\u306e\u306f\u3061\u3087\u3063\u3068\u5acc\u306a\u611f\u3058\u3067\u3059\u306d.\n\n## randomizedtesting\u3067NoSuchMethodError\u304c\u51fa\u308b\n```text:\u5b9f\u884c\u6642\u51fa\u529b\njava.lang.NoSuchMethodError: com.carrotsearch.randomizedtesting.RandomizedContext.runWithPrivateRandomness(Lcom/carrotsearch/randomizedtesting/Randomness;Ljava/util/concurrent/Callable;)Ljava/lang/Object;\n    __randomizedtesting.SeedInfo.seed([173369D720B9A36A:9F67560D8E45CE92]:0)\n    org.elasticsearch.test.ElasticsearchIntegrationTest.buildWithPrivateContext(ElasticsearchIntegrationTest.java:583)\n    org.elasticsearch.test.ElasticsearchIntegrationTest.buildAndPutCluster(ElasticsearchIntegrationTest.java:598)\n    org.elasticsearch.test.ElasticsearchIntegrationTest.beforeInternal(ElasticsearchIntegrationTest.java:283)\n    org.elasticsearch.test.ElasticsearchIntegrationTest.before(ElasticsearchIntegrationTest.java:1946)\n    [...sun.*, org.junit.*, java.lang.reflect.*, com.carrotsearch.randomizedtesting.*]\n    org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:50)\n    org.apache.lucene.util.TestRuleFieldCacheSanity$1.evaluate(TestRuleFieldCacheSanity.java:51)\n    org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:46)\n    [...com.carrotsearch.randomizedtesting.*]\n    org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:49)\n    org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)\n    org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n    [...com.carrotsearch.randomizedtesting.*]\n    org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:46)\n    org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:42)\n    [...com.carrotsearch.randomizedtesting.*]\n    org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:43)\n    org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n    org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)\n    org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:55)\n    [...com.carrotsearch.randomizedtesting.*]\n    java.lang.Thread.run(Unknown Source)\n```\n\n\u5358\u7d14\u306b`randomizedtesting-runner`\u3078\u306e\u4f9d\u5b58\u3092\u66f8\u304d\u5fd8\u308c\u3066\u3044\u308b\u5834\u5408\u306b\u52a0\u3048, `randomizedtesting-runner`\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u6307\u5b9a\u304c\u53e4\u3044\u5834\u5408\u306b\u3082\u767a\u751f\u3059\u308b\u3088\u3046\u3067\u3059. `elasticsearch 1.7.3`\u3092\u4f7f\u3063\u305f\u969b\u306f, `randomizedtesting 2.1.6`\u3067\u306f\u3053\u306e\u30a8\u30e9\u30fc\u306b\u306a\u308a, `randomizedtesting 2.1.17`\u3067\u306f\u6b63\u5e38\u306b\u52d5\u304d\u307e\u3057\u305f.\n\n## hamcrest\u3067NoClassDefFoundError\u304c\u51fa\u308b\n```text:\u5b9f\u884c\u6642\u51fa\u529b\njava.lang.NoClassDefFoundError: org/hamcrest/Matchers\n    __randomizedtesting.SeedInfo.seed([3F50D3975E9C4C58:B704EC4DF06021A0]:0)\n    org.elasticsearch.test.ElasticsearchIntegrationTest.afterInternal(ElasticsearchIntegrationTest.java:628)\n    org.elasticsearch.test.ElasticsearchIntegrationTest.after(ElasticsearchIntegrationTest.java:1954)\n    [...sun.*, org.junit.*, java.lang.reflect.*, com.carrotsearch.randomizedtesting.*]\n    org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:50)\n    org.apache.lucene.util.TestRuleFieldCacheSanity$1.evaluate(TestRuleFieldCacheSanity.java:51)\n    org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:46)\n    [...com.carrotsearch.randomizedtesting.*]\n    org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:49)\n    org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)\n    org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n    [...com.carrotsearch.randomizedtesting.*]\n    org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:46)\n    org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:42)\n    [...com.carrotsearch.randomizedtesting.*]\n    org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:43)\n    org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\n    org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)\n    org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:55)\n    [...com.carrotsearch.randomizedtesting.*]\n    java.lang.Thread.run(Unknown Source)\n```\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306f\u66f8\u304b\u308c\u3066\u3044\u306a\u304b\u3063\u305f\u3068\u601d\u3046\u306e\u3067\u3059\u304c, hamcrest\u304c\u5fc5\u8981\u306a\u3088\u3046\u3067\u3059. `elasticsearch 1.7.3`\u3092\u4f7f\u3063\u305f\u969b\u306f, `hamcrest 1.3`\u3067\u52d5\u304d\u307e\u3057\u305f.\n\n# \u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u5fc5\u8981\u306a\u6a5f\u80fd\u306e\u30c6\u30b9\u30c8\n\u30b7\u30f3\u30d7\u30eb\u306a\u30c6\u30b9\u30c8\u306f\u52d5\u3044\u305f\u3067\u3057\u3087\u3046\u304b. \u5b9f\u306f, \u3053\u3053\u304b\u3089\u304c\u672c\u756a\u3067\u3059.\nElasticsearch\u3067\u65e5\u672c\u8a9e\u3092\u6271\u304a\u3046\u3068\u3057\u305f\u5834\u5408, \u65e5\u672c\u8a9e\u30a2\u30ca\u30e9\u30a4\u30b6\u306a\u3069\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u306a\u3044\u3068\u4f55\u3082\u59cb\u307e\u308a\u307e\u305b\u3093. \u30c6\u30b9\u30c8\u3092\u8d70\u3089\u305b\u308b\u305f\u3081\u306b\u81ea\u524d\u3067Elasticsearch\u30b5\u30fc\u30d0\u30fc\u3092\u7acb\u3061\u4e0a\u3052\u3066\u3044\u308b\u3068, \u30d7\u30e9\u30b0\u30a4\u30f3\u5468\u308a\u306e\u7ba1\u7406\u304c\u9762\u5012\u3060\u3063\u305f\u308a\u3059\u308b\u306e\u3067, \u3053\u306e\u3042\u305f\u308a\u304b\u3089`ElasticsearchIntegrationTest`\u306e\u3042\u308a\u304c\u305f\u307f\u304c\u51fa\u3066\u304d\u307e\u3059.\n\n\u30b5\u30fc\u30d0\u30fc\u3068\u3057\u3066\u7acb\u3061\u4e0a\u304c\u3063\u3066\u3044\u308bElasticsearch\u306e\u4e2d\u3067\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f7f\u304a\u3046\u3068\u3057\u305f\u5834\u5408, `$ bin/plugin --install <\u4f7f\u7528\u3057\u305f\u3044\u30d7\u30e9\u30b0\u30a4\u30f3>` \u3068\u304b\u3092\u5b9f\u884c\u3057\u305f\u3068\u601d\u3044\u307e\u3059. \u4e00\u65b9\u3067, `ElasticsearchIntegrationTest`\u306e\u4e2d\u3067\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f7f\u3046\u5834\u5408\u306f,\n\n1. \u4f7f\u7528\u3057\u305f\u3044\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f9d\u5b58\u95a2\u4fc2\u306b\u8ffd\u52a0\u3059\u308b.\n2. `ElasticsearchIntegrationTest`\u30af\u30e9\u30b9\u304b\u3089\u7d99\u627f\u3057\u305f`nodeSettings`\u30e1\u30bd\u30c3\u30c9\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066, \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f7f\u7528\u3059\u308b\u65e8\u3092\u8a18\u8ff0\u3059\u308b.\n\n\u306e2\u3064\u3092\u3084\u308c\u3070OK\u3067\u3059.\n\n## \u4f7f\u7528\u3057\u305f\u3044\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f9d\u5b58\u95a2\u4fc2\u306b\u8ffd\u52a0\u3059\u308b\n\u4eca\u56de\u306f\u65e5\u672c\u8a9e\u30a2\u30ca\u30e9\u30a4\u30b6\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u3057\u3066\u304a\u99b4\u67d3\u307f\u306e`elasticsearch-analysis-kuromoji`\u3092\u4f7f\u3063\u3066\u307f\u307e\u3057\u3087\u3046. `pom.xml`\u306b\u6b21\u306e\u4f9d\u5b58\u3092\u8ffd\u52a0\u3057\u307e\u3059.\n\n```xml:pom.xml\n<dependency>\n    <groupId>org.elasticsearch</groupId>\n    <artifactId>elasticsearch-analysis-kuromoji</artifactId>\n    <version>2.7.0</version>\n</dependency>\n```\n\nElasticsearch\u3068kuromoji\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u5bfe\u5fdc\u306f, \u30b5\u30fc\u30d0\u30fc\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068\u304d\u3068\u540c\u69d8\u306b, [elasticsearch-analysis-kuromoji\u306eGitHub](https://github.com/elastic/elasticsearch-analysis-kuromoji)\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059. \u4eca\u56de\u306f`es-1.7`\u306b\u5bfe\u5fdc\u3059\u308b`elasticsearch-analysis-kuromoji 2.7.0`\u3092\u4f7f\u3048\u3070\u3088\u3044\u3068\u5206\u304b\u308a\u307e\u3059.\n\n## nodeSettings\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f7f\u7528\u3059\u308b\u65e8\u3092\u8a18\u8ff0\u3059\u308b\n\u3053\u308c\u306b\u306f2\u901a\u308a\u3084\u308a\u65b9\u304c\u3042\u308a\u307e\u3059.\n\n### \u30af\u30e9\u30b9\u30d1\u30b9\u306b\u5b58\u5728\u3059\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u3059\u3079\u3066\u8aad\u307f\u8fbc\u3080\n```java:java:src/test/java/jp/akimateras/elasticsearch/esintegtest/service/SimpleSearchTest.java\n    @Override\n    protected Settings nodeSettings(int nodeOrdinal) {\n        return ImmutableSettings.settingsBuilder()\n            .put(super.nodeSettings(nodeOrdinal))\n            .put(\"plugins.\" + PluginsService.LOAD_PLUGIN_FROM_CLASSPATH, true)\n            .build();\n    }\n```\n\n`\"plugins.\"`\u306b\u7d9a\u3051\u3066`org.elasticsearch.plugins.PluginsService.LOAD_PLUGIN_FROM_CLASSPATH`\u3067\u6307\u5b9a\u3055\u308c\u308b\u6587\u5b57\u5217\u5b9a\u6570\u3092\u9023\u7d50\u3057\u305f\u8a2d\u5b9a\u540d\u306b\u5bfe\u3057\u3066`true`\u3092\u4e0e\u3048\u308b\u3068, \u30af\u30e9\u30b9\u30d1\u30b9\u4e0a\u306b\u5b58\u5728\u3059\u308b\u3059\u3079\u3066\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u8aad\u307f\u306b\u884c\u304f\u3088\u3046\u306b\u306a\u308a\u307e\u3059.\n\u3061\u306a\u307f\u306b, `elasticsearch 1.7.3`\u3067\u306f\u3053\u306e\u8a2d\u5b9a\u540d\u306f`\"plugins.load_classpath_plugins\"`\u3068\u5c55\u958b\u3055\u308c\u308b\u3088\u3046\u3067\u3059.\n\n### \u8aad\u307f\u8fbc\u3080\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u6307\u5b9a\u3059\u308b\n```java:java:src/test/java/jp/akimateras/elasticsearch/esintegtest/service/SimpleSearchTest.java\n    @Override\n    protected Settings nodeSettings(int nodeOrdinal) {\n        return ImmutableSettings.settingsBuilder()\n            .put(super.nodeSettings(nodeOrdinal))\n            .put(\"plugin.types\", AnalysisKuromojiPlugin.class.getName())\n            .build();\n    }\n```\n\n`\"plugin.types\"`\u306b\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30af\u30e9\u30b9\u540d\u3092\u4e0e\u3048\u308b\u3068, \u4e0e\u3048\u305f\u540d\u524d\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u8aad\u307f\u8fbc\u307e\u308c\u307e\u3059. \u30c6\u30b9\u30c8\u6642\u306b\u4f55\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u5fc5\u8981\u306a\u306e\u304b\u304c\u660e\u793a\u3055\u308c\u308b\u306e\u3067, \u500b\u4eba\u7684\u306b\u306f\u3053\u3063\u3061\u306e\u65b9\u304c\u597d\u304d\u3067\u3059.\n\n\u8907\u6570\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u8aad\u307f\u8fbc\u307e\u305b\u305f\u3044\u5834\u5408\u306f, `put`\u30e1\u30bd\u30c3\u30c9\u306e\u4ee3\u308f\u308a\u306b`putArray`\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3063\u3066\u6b21\u306e\u3088\u3046\u306b\u66f8\u304d\u307e\u3059.\n\n```java:java:src/test/java/jp/akimateras/elasticsearch/esintegtest/service/SimpleSearchTest.java\n    @Override\n    protected Settings nodeSettings(int nodeOrdinal) {\n        return ImmutableSettings.settingsBuilder()\n            .put(super.nodeSettings(nodeOrdinal))\n            .putArray(\"plugin.types\",\n                AnalysisKuromojiPlugin.class.getName(),\n                AnalysisICUPlugin.class.getName()) // elasticsearch-analysis-icu \u30d7\u30e9\u30b0\u30a4\u30f3\n            .build();\n    }\n```\n\n\u306a\u304a, `elasticsearch 2.1`\u304b\u3089\u306f`nodePlugins`\u3068\u3044\u3046\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u6307\u5b9a\u3059\u308b\u305f\u3081\u306e\u5c02\u7528\u30e1\u30bd\u30c3\u30c9\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u3067\u3059( [\u516c\u5f0f: integration tests (2.1)](https://www.elastic.co/guide/en/elasticsearch/reference/2.1/integration-tests.html#changing-node-configuration) ).\n\n## \u65e5\u672c\u8a9e\u3092\u4f7f\u3063\u305f\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\n\u5b9f\u969b\u306bkuromoji\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u8aad\u307f\u8fbc\u3081\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046.\n\n```java:src/main/java/jp/akimateras/elasticsearch/esintegtest/service/SimpleSearch.java\npackage jp.akimateras.elasticsearch.esintegtest.service;\n\nimport static org.hamcrest.Matchers.is;\n\nimport org.elasticsearch.common.settings.ImmutableSettings;\nimport org.elasticsearch.common.settings.Settings;\nimport org.elasticsearch.common.xcontent.XContentBuilder;\nimport org.elasticsearch.common.xcontent.XContentFactory;\nimport org.elasticsearch.plugin.analysis.kuromoji.AnalysisKuromojiPlugin;\nimport org.elasticsearch.test.ElasticsearchIntegrationTest;\nimport org.junit.Before;\nimport org.junit.Test;\n\n@ElasticsearchIntegrationTest.ClusterScope(numDataNodes = 1)\npublic class SimpleSearchTest extends ElasticsearchIntegrationTest {\n    @Override\n    protected Settings nodeSettings(int nodeOrdinal) {\n        return ImmutableSettings.settingsBuilder()\n            .put(super.nodeSettings(nodeOrdinal))\n            .put(\"plugin.types\", AnalysisKuromojiPlugin.class.getName())\n            .build();\n    }\n\n    @Before\n    public void initializeIndex() throws Exception {\n        // \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210.\n        XContentBuilder mapping = XContentFactory.jsonBuilder()\n            .startObject()\n                .startObject(SimpleSearch.TYPE_NAME)\n                    .startObject(\"properties\")\n                        .startObject(SimpleSearch.TITLE_FIELD_NAME)\n                            .field(\"type\", \"string\")\n                            .field(\"source\", true)\n                            .field(\"analyzer\", \"kuromoji\") // kuromoji\u304c\u306a\u3044\u3068\u3053\u308c\u304c\u30a8\u30e9\u30fc\u306b\u306a\u308b.\n                        .endObject()\n                        .startObject(SimpleSearch.TEXT_FIELD_NAME)\n                            .field(\"type\", \"string\")\n                            .field(\"source\", true)\n                            .field(\"analyzer\", \"kuromoji\")\n                        .endObject()\n                    .endObject()\n                .endObject()\n            .endObject();\n\n        admin().indices().prepareCreate(SimpleSearch.INDEX_NAME)\n            .addMapping(SimpleSearch.TYPE_NAME, mapping)\n            .execute()\n            .actionGet();\n\n        // \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u5b8c\u4e86\u306e\u5f85\u6a5f.\n        ensureGreen();\n    }\n\n    @Test\n    public void testSearch() throws Exception {\n        // \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u6295\u5165. \u65e5\u672c\u8a9e\u3092\u4f7f\u3044\u307e\u3059.\n        index(SimpleSearch.INDEX_NAME, SimpleSearch.TYPE_NAME, XContentFactory.jsonBuilder()\n            .startObject()\n                .field(SimpleSearch.TITLE_FIELD_NAME, \"\u30a2\u30eb\u30d1\u30ab\")\n                .field(SimpleSearch.TEXT_FIELD_NAME, \"\u30a2\u30eb\u30d1\u30ab\u306f, \u5357\u30a2\u30e1\u30ea\u30ab\u306e\u30e9\u30af\u30c0\u79d1\u52d5\u7269\u306e\u5bb6\u755c\u3067\u3059.\")\n            .endObject());\n\n        index(SimpleSearch.INDEX_NAME, SimpleSearch.TYPE_NAME, XContentFactory.jsonBuilder()\n            .startObject()\n                .field(SimpleSearch.TITLE_FIELD_NAME, \"\u30ea\u30e3\u30de\")\n                .field(SimpleSearch.TEXT_FIELD_NAME, \"\u30ea\u30e3\u30de\u306f, \u5357\u30a2\u30e1\u30ea\u30ab\u306e\u30e9\u30af\u30c0\u79d1\u52d5\u7269\u306e\u5bb6\u755c\u3067\u3059.\")\n            .endObject());\n\n        index(SimpleSearch.INDEX_NAME, SimpleSearch.TYPE_NAME, XContentFactory.jsonBuilder()\n            .startObject()\n                .field(SimpleSearch.TITLE_FIELD_NAME, \"\u30d3\u30af\u30fc\u30cb\u30e3\")\n                .field(SimpleSearch.TEXT_FIELD_NAME, \"\u30d3\u30af\u30fc\u30cb\u30e3\u306f, \u5357\u30a2\u30e1\u30ea\u30ab\u306e\u30a2\u30f3\u30c7\u30b9\u5c71\u8108\u306b\u751f\u606f\u3059\u308b\u8349\u98df\u54fa\u4e73\u985e\u3067\u3059.\")\n            .endObject());\n\n        // \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u6295\u5165\u5b8c\u4e86\u306e\u5f85\u6a5f.\n        flushAndRefresh();\n        ensureGreen();\n\n        // \u30c6\u30b9\u30c8\u7528 client \u3092\u4f7f\u3063\u3066SimpleSearch\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210.\n        SimpleSearch service = new SimpleSearch(client());\n        \n        // \u30c6\u30b9\u30c8\u5b9f\u65bd\n        assertThat(service.search(\"\u30a2\u30eb\u30d1\u30ab\").size(), is(1));\n        assertThat(service.search(\"\u30ea\u30e3\u30de\").size(), is(1));\n        assertThat(service.search(\"\u30d3\u30af\u30fc\u30cb\u30e3\").size(), is(1));\n        assertThat(service.search(\"\u30e9\u30de\").size(), is(0));\n\n        assertThat(service.search(\"\u5bb6\u755c\").size(), is(2));\n        assertThat(service.search(\"\u30a2\u30eb\u30d1\u30ab \u5bb6\u755c\").size(), is(1));\n        assertThat(service.search(\"\u30ea\u30e3\u30de \u5bb6\u755c\").size(), is(1));\n        assertThat(service.search(\"\u30d3\u30af\u30fc\u30cb\u30e3 \u5bb6\u755c\").size(), is(0));\n    }\n}\n```\n\n\u3069\u3046\u3067\u3082\u3044\u3044\u3093\u3067\u3059\u304c, \u3053\u306e\u30c6\u30b9\u30c8, `kuromoji`\u3092\u4f7f\u308f\u305a\u3068\u3082\u30c7\u30d5\u30a9\u30eb\u30c8\u306e`standard analyzer`\u3067\u3082\u5168\u90e8\u901a\u308a\u307e\u3059...\u306a\u304b\u306a\u304b\u512a\u79c0\u3067\u3059\u306d.\n\u6295\u5165\u6587\u66f8\u306e\u30bf\u30a4\u30c8\u30eb\u3068\u30c6\u30ad\u30b9\u30c8\u4e21\u65b9\u306e`\"\u30a2\u30eb\u30d1\u30ab\"`\u3092`\"\u30a2\u30eb\u30d1\u30ab\u30a2\u30eb\u30d1\u30ab\"`\u3068\u304b\u306b\u5909\u3048\u3066\u3042\u3052\u308b\u3068, `standard analyzer`\u306f\u3053\u308c\u30921\u8a9e\u3068\u3057\u3066\u8a8d\u8b58\u3059\u308b\u306e\u3067, `\"\u30a2\u30eb\u30d1\u30ab\"`\u3067\u691c\u7d22\u3057\u3066\u3082\u5f15\u3063\u304b\u304b\u3089\u306a\u304f\u306a\u308a\u307e\u3059. `kuromoji`\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u306f`\"\u30a2\u30eb\u30d1\u30ab\"``x2`\u3068\u8a8d\u8b58\u3059\u308b\u306e\u3067, `\"\u30a2\u30eb\u30d1\u30ab\"`\u3067\u691c\u7d22\u3067\u304d\u307e\u3059.\n\n# \u30b9\u30af\u30ea\u30d7\u30c8\u304c\u5fc5\u8981\u306a\u6a5f\u80fd\u306e\u30c6\u30b9\u30c8\n\u6700\u5f8c\u306bgroovy\u3068\u304b\u306e\u30c7\u30a3\u30b9\u30af\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5fc5\u8981\u3068\u3059\u308b\u6a5f\u80fd\u306e\u30c6\u30b9\u30c8\u65b9\u6cd5\u3092\u7d39\u4ecb\u3057\u307e\u3059.\n\nElasticsearch\u306e\u30c7\u30a3\u30b9\u30af\u30b9\u30af\u30ea\u30d7\u30c8\u306f, \u30b5\u30fc\u30d0\u30fc\u3068\u3057\u3066\u8d77\u52d5\u3059\u308b\u5834\u5408\u306f`/etc/elasticsearch/scripts`\u306e\u3088\u3046\u306a\u5834\u6240\u306b\u7f6e\u304f\u3068\u81ea\u52d5\u7684\u306b\u8aad\u307f\u8fbc\u307e\u308c\u308b\u3082\u306e\u3067\u3057\u305f. \n`ElasticsearchIntegrationTest`\u304b\u3089\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u898b\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u306b\u306f, \u30b5\u30fc\u30d0\u30fc\u306e\u3068\u304d\u3068\u540c\u69d8\u306b\u7279\u5b9a\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30b9\u30af\u30ea\u30d7\u30c8\u7fa4\u3092\u8a2d\u7f6e\u3057, `nodeSettings`\u30e1\u30bd\u30c3\u30c9\u3067\u8a2d\u7f6e\u5834\u6240\u3092\u8a18\u8ff0\u3059\u308c\u3070OK\u3067\u3059.\n\n\u305f\u3060\u3057, `elasticsearch 1.7.3`\u3067\u306f\u30b9\u30af\u30ea\u30d7\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u76f4\u63a5\u6307\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093. `\"path.conf\"`\u3067\u6307\u5b9a\u3067\u304d\u308b\u8a2d\u5b9a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u76f4\u4e0b\u306e`scripts`\u3068\u3044\u3046\u540d\u524d\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6c7a\u3081\u6253\u3061\u3067\u63a2\u3057\u306b\u884c\u304d\u307e\u3059.\n\u305d\u306e\u305f\u3081, \u4f8b\u3048\u3070`src/test/resources/scripts`\u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u8aad\u307f\u306b\u884c\u304b\u305b\u305f\u3044\u5834\u5408\u306f, `\"path.conf\"`\u306b`\"src/test/resources\"`\u3092\u6307\u5b9a\u3059\u308b, \u3068\u3044\u3063\u305f\u3084\u308a\u65b9\u306b\u306a\u308a\u307e\u3059.\n\n```java:src/test/java/jp/akimateras/elasticsearch/esintegtest/service/SimpleSearchTest.java\n    @Override\n    protected Settings nodeSettings(int nodeOrdinal) {\n        return ImmutableSettings.settingsBuilder()\n            .put(super.nodeSettings(nodeOrdinal))\n            .put(\"plugin.types\", AnalysisKuromojiPlugin.class.getName())\n            .put(\"path.conf\", \"src/test/resources\")\n            .build();\n    }\n```\n\n\u306a\u304a. `elasticsearch 2.1`\u304b\u3089\u306f`\"path.script\"`\u3068\u3044\u3046\u8a2d\u5b9a\u540d\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u76f4\u63a5\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u6539\u5584\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u3067\u3059( [\u516c\u5f0f: Directory Layout (2.1)](https://www.elastic.co/guide/en/elasticsearch/reference/2.1/setup-dir-layout.html) ).\n\n# \u304a\u308f\u308a\u306b\n\u56db\u82e6\u516b\u82e6\u3057\u3066\u30c6\u30b9\u30c8\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u304c\u3084\u3063\u3068\u52d5\u3044\u305f\u3088\u3068\u3044\u3046\u8a18\u4e8b\u3067\u3059\u306e\u3067, \u9593\u9055\u3044\u306a\u3069\u3042\u308a\u307e\u3057\u305f\u3089\u3054\u6307\u6458\u3092\u5b9c\u3057\u304f\u304a\u9858\u3044\u81f4\u3057\u307e\u3059...\n\u82e6\u52b4\u306f\u3057\u305f\u3082\u306e\u306e, \u3053\u308c\u306e\u304a\u304b\u3052\u3067\u30c6\u30b9\u30c8\u7528Elasticsearch\u30b5\u30fc\u30d0\u30fc\u306e\u7ba1\u7406\u304c\u4e0d\u8981\u306b\u306a\u3063\u305f\u306e\u306f\u304b\u306a\u308a\u5b09\u3057\u304f, \u5c0e\u5165\u3057\u305f\u7532\u6590\u306f\u3042\u3063\u305f\u3068\u611f\u3058\u3066\u3044\u307e\u3059.\n\n\u660e\u65e5\u306f, [takakiku](http://qiita.com/takakiku)\u3055\u3093\u306eMySQL\u30b9\u30ed\u30fc\u30ed\u30b0\u53ef\u8996\u5316\u306e\u8a18\u4e8b\u3067\u3059\uff01\n", "tags": ["Elasticsearch", "Java", "JUnit"]}