{"context": "\n\n\u306f\u3058\u3081\u306b\n\u307f\u306a\u3055\u3093\u3001\u5f37\u5316\u5b66\u7fd2\u3057\u3066\u307e\u3059\u304b\uff1f\n\u5f37\u5316\u5b66\u7fd2\u306f\u30ed\u30dc\u30c3\u30c8\u3084\u3001\u56f2\u7881\u3084\u5c06\u68cb\u306e\u3088\u3046\u306a\u30b2\u30fc\u30e0\u3001\u5bfe\u8a71\u30b7\u30b9\u30c6\u30e0\u7b49\u306b\u5fdc\u7528\u3067\u304d\u308b\u697d\u3057\u3044\u6280\u8853\u3067\u3059\u3002\n\u5f37\u5316\u5b66\u7fd2\u3068\u306f\u3001\u8a66\u884c\u932f\u8aa4\u3092\u901a\u3058\u3066\u74b0\u5883\u306b\u9069\u5fdc\u3059\u308b\u5b66\u7fd2\u5236\u5fa1\u306e\u67a0\u7d44\u307f\u3067\u3059\u3002\u6559\u5e2b\u3042\u308a\u5b66\u7fd2\u3067\u306f\u5165\u529b\u306b\u5bfe\u3059\u308b\u6b63\u3057\u3044\u51fa\u529b\u3092\u4e0e\u3048\u3066\u5b66\u7fd2\u3055\u305b\u307e\u3057\u305f\u3002\u5f37\u5316\u5b66\u7fd2\u3067\u306f\u3001\u5165\u529b\u306b\u5bfe\u3059\u308b\u6b63\u3057\u3044\u51fa\u529b\u3092\u4e0e\u3048\u308b\u4ee3\u308f\u308a\u306b\u3001\u4e00\u9023\u306e\u884c\u52d5\u306b\u5bfe\u3059\u308b\u826f\u3057\u60aa\u3057\u3092\u8a55\u4fa1\u3059\u308b\u300c\u5831\u916c\u300d\u3068\u3044\u3046\u30b9\u30ab\u30e9\u30fc\u306e\u8a55\u4fa1\u5024\u304c\u4e0e\u3048\u3001\u3053\u308c\u3092\u624b\u304c\u304b\u308a\u306b\u5b66\u7fd2\u3092\u884c\u3044\u307e\u3059\u3002\u4ee5\u4e0b\u306b\u5f37\u5316\u5b66\u7fd2\u306e\u67a0\u7d44\u307f\u3092\u793a\u3057\u307e\u3059\u3002\n\n\n\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u6642\u523b ttt \u306b\u304a\u3044\u3066\u74b0\u5883\u306e\u72b6\u614b ststs_t \u3092\u89b3\u6e2c\n\u89b3\u6e2c\u3057\u305f\u72b6\u614b\u304b\u3089\u884c\u52d5 atata_t \u3092\u6c7a\u5b9a\n\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u884c\u52d5\u3092\u5b9f\u884c\n\u74b0\u5883\u306f\u65b0\u3057\u3044\u72b6\u614b st+1st+1s_{t+1} \u306b\u9077\u79fb\n\u9077\u79fb\u306b\u5fdc\u3058\u305f\u5831\u916c rt+1rt+1r_{t+1} \u3092\u7372\u5f97\n\u5b66\u7fd2\u3059\u308b\n\u30b9\u30c6\u30c3\u30d71\u304b\u3089\u7e70\u308a\u8fd4\u3059\n\n\u5f37\u5316\u5b66\u7fd2\u306e\u76ee\u7684\u306f\u3001\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u53d6\u5f97\u3059\u308b\u5229\u5f97\uff08\u7d2f\u7a4d\u5831\u916c\uff09\u3092\u6700\u5927\u5316\u3059\u308b\u3088\u3046\u306a\u3001\u72b6\u614b\u304b\u3089\u884c\u52d5\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0\uff08\u653f\u7b56\uff09\u3092\u7372\u5f97\u3059\u308b\u3053\u3068\u3067\u3059\u3002\n\u5f37\u5316\u5b66\u7fd2\u3067\u306f\u4e0a\u8a18\u306e\u67a0\u7d44\u307f\u3092\u30de\u30eb\u30b3\u30d5\u6c7a\u5b9a\u904e\u7a0b(Markov decision processes: MDP)\u306b\u3088\u3063\u3066\u30e2\u30c7\u30eb\u5316\u3057\u3001\u5b66\u7fd2\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u8003\u3048\u308b\u3068\u3044\u3063\u305f\u3053\u3068\u304c\u884c\u308f\u308c\u307e\u3059\u3002\u672c\u7a3f\u3067\u306f\u3001\u5f37\u5316\u5b66\u7fd2\u306b\u3064\u3044\u3066\u7406\u8ad6\u7de8\u3068\u5b9f\u8df5\u7de8\u306b\u5206\u3051\u3066\u89e3\u8aac\u3057\u307e\u3059\u3002\u7406\u8ad6\u7de8\u3067\u306f\u3001MDP\u304a\u3088\u3073\u5b66\u7fd2\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u3001\u5b9f\u8df5\u7de8\u3067\u306f\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u8a00\u8a9ePython\u3092\u7528\u3044\u3066\u7406\u8ad6\u7de8\u3067\u8aac\u660e\u3057\u305f\u3053\u3068\u3092\u5b9f\u88c5\u3057\u3066\u3044\u304d\u307e\u3059\u3002\u9806\u756a\u306b\u8aad\u3080\u3053\u3068\u3092\u304a\u3059\u3059\u3081\u3057\u307e\u3059\u304c\u3001\u300c\u3053\u307e\u3051\u3047\u3053\u305f\u3041\u3044\u3044\u3093\u3060\u3088\uff01\u300d\u3068\u3044\u3046\u65b9\u306f\u7406\u8ad6\u7de8\u3092\u98db\u3070\u3057\u3066\u5b9f\u8df5\u7de8\u3092\u8aad\u3093\u3067\u304f\u3060\u3055\u3044\u3002\n\n\u7406\u8ad6\u7de8\n\u307e\u305a\u3001\u5f37\u5316\u5b66\u7fd2\u306e\u7406\u8ad6\u3092\u4f8b\u3092\u4ea4\u3048\u3066\u8aac\u660e\u3057\u3066\u3044\u304d\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u4f8b\u984c\u306e\u554f\u984c\u8a2d\u5b9a\u3092\u8aac\u660e\u3057\u305f\u5f8c\u3001\u30de\u30eb\u30b3\u30d5\u6c7a\u5b9a\u904e\u7a0b\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\u30de\u30eb\u30b3\u30d5\u6c7a\u5b9a\u904e\u7a0b\u306b\u3064\u3044\u3066\u7406\u89e3\u3067\u304d\u305f\u3068\u3053\u308d\u3067\u3001\u305d\u306e\u5b66\u7fd2\u65b9\u6cd5\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\n\n\u554f\u984c\u8a2d\u5b9a\n\u3055\u3066\u3001MDP\u3092\u8aac\u660e\u3059\u308b\u306b\u3042\u305f\u3063\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8ff7\u8def\u306e\u4e16\u754c\u3092\u8003\u3048\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u8ff7\u8def\u306e\u4e16\u754c\u306e\u30eb\u30fc\u30eb\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\n\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u3042\u308b\u30b0\u30ea\u30c3\u30c9\u306e\u4e2d\u306b\u3044\u307e\u3059\n\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u58c1(\u7070\u8272)\u3092\u8d8a\u3048\u3089\u308c\u307e\u305b\u3093\n\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u81ea\u5206\u304c\u601d\u3063\u305f\u901a\u308a\u306b\u52d5\u3051\u308b\u3068\u306f\u9650\u308a\u307e\u305b\u3093\n\n\n80%\u306e\u78ba\u7387\u3067\u6b63\u3057\u304f\u52d5\u3051\u307e\u3059\u304c\u300110%\u306e\u78ba\u7387\u3067\u52d5\u3053\u3046\u3068\u601d\u3063\u3066\u3044\u305f\u65b9\u5411\u306e\u5de6\u5074\u3078\u52d5\u304d\u3001\u3082\u304610%\u306e\u78ba\u7387\u3067\u53f3\u5074\u3078\u52d5\u304d\u307e\u3059\n\n\n\u52d5\u3053\u3046\u3068\u601d\u3063\u305f\u5834\u6240\u306b\u58c1\u304c\u3042\u3063\u305f\u5834\u5408\u306f\u3001\u305d\u306e\u5834\u306b\u3068\u3069\u307e\u308a\u307e\u3059\n\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u5404\u6642\u523b\u306b\u5831\u916c\u3092\u53d7\u3051\u53d6\u308a\u307e\u3059\n\u30b4\u30fc\u30eb(\u5b9d\u7bb1)\u3084\u30c8\u30e9\u30c3\u30d7(\u7206\u767a)\u306b\u305f\u3069\u308a\u7740\u304f\u3068\u30b2\u30fc\u30e0\u7d42\u4e86\u3057\u3001\u30b9\u30bf\u30fc\u30c8\u4f4d\u7f6e\u306b\u623b\u308a\u307e\u3059\n\n\u78ba\u7387\u7684\u306a\u9077\u79fb\u306b\u3064\u3044\u3066\u4ee5\u4e0b\u306e\u56f3\u3092\u7528\u3044\u3066\u3082\u3046\u5c11\u3057\u8a73\u3057\u304f\u8aac\u660e\u3057\u307e\u3059\u3002\n\n\u3053\u3053\u3067\u306f\u30ed\u30dc\u30c3\u30c8\u306f\u4e0a\u306b\u52d5\u3053\u3046\u3068\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u3068\u304d80%\u306e\u78ba\u7387\u3067\u4e0a\u306b\u52d5\u3051\u307e\u3059\u304c\u300110%\u306e\u78ba\u7387\u3067\u5de6\u5074\u306b\u52d5\u304d\u3001\u6b8b\u308a\u306e10%\u306e\u78ba\u7387\u3067\u53f3\u5074\u306b\u52d5\u3044\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u9077\u79fb\u78ba\u7387\u306f\u4ee5\u4e0b\u306e\u8868\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n\ns\u2032s'\nP(s\u2032\u2223s1,a)P(s' \\mid s_1, a)\n\n\n\n\ns2s_2\n0.1\n\n\ns3s_3\n0.8\n\n\ns4s_4\n0.1\n\n\n\n\n\u30de\u30eb\u30b3\u30d5\u6c7a\u5b9a\u904e\u7a0b(Markov decision processes: MDP)\n\u3055\u3066\u3001\u554f\u984c\u8a2d\u5b9a\u306f\u308f\u304b\u3063\u305f\u3067\u3057\u3087\u3046\u304b\uff1f\u308f\u304b\u3063\u305f\u3068\u3053\u308d\u3067\u3001\u554f\u984c\u3092MDP\u3067\u30e2\u30c7\u30eb\u5316\u3057\u307e\u3059\u3002\nMDP\u306f\u4ee5\u4e0b\u306e4\u9805\u7d44\u3067\u5b9a\u7fa9\u3055\u308c\u307e\u3059\nM = (S, A, T, R)\nM=(S,A,T,R){M = (S, A, T, R)\n}\n\u305d\u308c\u305e\u308c\u4f55\u306a\u306e\u304b\u3068\u3044\u3046\u3068\u3001\n\n\u72b6\u614b\u96c6\u5408: s\u2208Ss \\in S\n\u884c\u52d5\u96c6\u5408: a\u2208Aa \\in A\n\u9077\u79fb\u95a2\u6570: T(s,a,s\u2032)\u223cP(s\u2032\u2223s,a)T(s, a, s') \\sim P(s' \\mid s, a)\n\u5831\u916c\u95a2\u6570: R(s)R(s), R(s,a)R(s, a), R(s,a,s\u2032)R(s,a,s')\n\n\u305d\u308c\u305e\u308c\u4e0a\u3067\u8aac\u660e\u3057\u305f\u554f\u984c\u8a2d\u5b9a\u306b\u5f53\u3066\u306f\u3081\u3066\u8003\u3048\u3066\u307f\u307e\u3059\u3002\n\n\u72b6\u614b\u96c6\u5408\u306f\u74b0\u5883\u304c\u3068\u308a\u3046\u308b\u72b6\u614b\u306e\u96c6\u5408\u3092\u8868\u3057\u3066\u304a\u308a\u3001\u4f8b\u984c\u306e\u5834\u5408\u306f\u30b0\u30ea\u30c3\u30c9\u306e\u3059\u3079\u3066\u306e\u30bb\u30eb\u3092\u8868\u3057\u3066\u3044\u307e\u3059\u3002\n\u884c\u52d5\u96c6\u5408\u306f\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u3068\u308a\u3046\u308b\u884c\u52d5\u306e\u7a2e\u985e\u306e\u3053\u3068\u3067\u3059\u3002\u4f8b\u984c\u306e\u5834\u5408\u3001\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u4e0a\u4e0b\u5de6\u53f3\u306b\u52d5\u304f\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u30674\u7a2e\u985e\u3067\u3059\u3002\n\u9077\u79fb\u95a2\u6570\u3068\u306f\u3001\u3042\u308b\u72b6\u614b ss \u3067\u884c\u52d5 aa \u3092\u53d6\u3063\u305f\u6642\u306b\u6b21\u306e\u72b6\u614b s\u2032s' \u3078\u3069\u306e\u304f\u3089\u3044\u306e\u78ba\u7387\u3067\u9077\u79fb\u3059\u308b\u304b\u3068\u3044\u3046\u3053\u3068\u3092\u8868\u3057\u3066\u3044\u307e\u3059\u3002\u4e0a\u306e\u56f3\u3067\u8aac\u660e\u3057\u305f\u901a\u308a\u3067\u3059\u3002\n\u5831\u916c\u306f\u89b3\u6e2c\u3057\u305f\u72b6\u614b\u304b\u3089\u53d6\u308b\u3079\u304d\u884c\u52d5\u3092\u6c7a\u5b9a\u3057\u3001\u65b0\u305f\u306b\u9077\u79fb\u3057\u305f\u7d50\u679c\u3068\u3057\u3066\u74b0\u5883\u304b\u3089\u53d7\u3051\u53d6\u308b\u5024\u306e\u3053\u3068\u3067\u3059\u3002\u5f8c\u3067\u8a73\u3057\u304f\u8aac\u660e\u3057\u307e\u3059\u3002\n\n\u3053\u306eMDP\u306e\u76ee\u7684\u306f\u5229\u5f97(=\u7d2f\u7a4d\u5831\u916c)\u3092\u6700\u5927\u5316\u3059\u308b\u884c\u52d5\u6226\u7565\u3092\u5b66\u7fd2\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u3053\u306e\u884c\u52d5\u6226\u7565\u306e\u3053\u3068\u3092\u653f\u7b56\u3068\u547c\u3073\u307e\u3059\u3002\n\n\u653f\u7b56\u306b\u3064\u3044\u3066\u3082\u3046\u5c11\u3057\u8a73\u3057\u304f\nMDP\u3067\u306f\u6700\u9069\u306a\u653f\u7b56 \u03c0\u2217:S\u2192A\\pi^*: S \\rightarrow A \u3092\u5f97\u308b\u3053\u3068\u304c\u76ee\u7684\u3067\u3059\u3002\u653f\u7b56\u306f\u72b6\u614b\u304b\u3089\u884c\u52d5\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0\u3092\u884c\u3046\u95a2\u6570\u3068\u307f\u306a\u305b\u307e\u3059\u3002\n\u653f\u7b56\u306f\u5404\u72b6\u614b\u3067\u53d6\u308b\u3079\u304d\u884c\u52d5\u3092\u6559\u3048\u3066\u304f\u308c\u307e\u3059\u3002\u307e\u305f\u3001\u6700\u9069\u306a\u653f\u7b56\u306f\u671f\u5f85\u5229\u5f97\u3092\u6700\u5927\u5316\u3057\u307e\u3059\u3002\n\u9077\u79fb\u3057\u305f\u6642\u306b\u5f97\u3089\u308c\u308b\u5831\u916c\u3092\u5909\u5316\u3055\u305b\u305f\u3068\u304d\u306e\u6700\u9069\u306a\u653f\u7b56\u306e\u5909\u5316\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u3053\u306e\u56f3\u3067\u306f\u72b6\u614b\u9077\u79fb\u3067\u5f97\u3089\u308c\u308b\u5831\u916c\u3092\u3060\u3093\u3060\u3093\u5c0f\u3055\u304f\uff08\u30da\u30ca\u30eb\u30c6\u30a3\u3092\u5927\u304d\u304f\uff09\u3057\u305f\u6642\u306b\u304a\u3051\u308b\u653f\u7b56\u306e\u5909\u5316\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002\u653f\u7b56\u306f\u5f97\u3089\u308c\u308b\u671f\u5f85\u5229\u5f97\u3092\u6700\u5927\u5316\u3059\u308b\u3068\u3044\u3046\u8003\u3048\u65b9\u304b\u3089\u5b66\u7fd2\u3057\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001\u72b6\u614b\u9077\u79fb\u306b\u3088\u308b\u30da\u30ca\u30eb\u30c6\u30a3\u304c\u5c0f\u3055\u3051\u308c\u3070\u9060\u56de\u308a\u3057\u3066\u3067\u3082\u30b4\u30fc\u30eb\u3092\u76ee\u6307\u305d\u3046\u3068\u3057\u3001\u30da\u30ca\u30eb\u30c6\u30a3\u304c\u5927\u304d\u3051\u308c\u3070\u901f\u3084\u304b\u306b\u30b2\u30fc\u30e0\u3092\u7d42\u4e86\u3055\u305b\u308b\u6226\u7565\u3092\u53d6\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u6bd4\u8f03\u3057\u3084\u3059\u3044\u3088\u3046\u306b\u9759\u6b62\u753b\u3082\u7528\u610f\u3057\u307e\u3057\u305f\u3002\n\n\n\u5831\u916c\u306b\u3064\u3044\u3066\u3082\u3046\u5c11\u3057\u8a73\u3057\u304f\n\u3055\u3066\u3001\u3053\u3053\u307e\u3067\u3067\u653f\u7b56\u3092\u5b66\u7fd2\u3059\u308b\u305f\u3081\u306b\u306f\u7d2f\u7a4d\u5831\u916c\u3092\u6700\u5927\u5316\u3059\u308b\u3068\u8ff0\u3079\u307e\u3057\u305f\u3002\n\u5404\u6642\u523b\u306b\u5831\u916c R(st)R(s_t) \u3092\u5f97\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u3067\u3001\u7d2f\u7a4d\u5831\u916c\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u305b\u307e\u3059\u3002\n\\begin{align}\nU([s_0, s_1, s_2,\\ldots]) &= R(s_0) + R(s_1) + R(s_2) + \\cdots \\\\\n    &= \\sum_{t=0}^{\\infty}R(s_t)\n\\end{align}\nU([s0,s1,s2,\u2026])=R(s0)+R(s1)+R(s2)+\u22ef=\u221e\u2211t=0R(st){\\begin{align}\nU([s_0, s_1, s_2,\\ldots]) &= R(s_0) + R(s_1) + R(s_2) + \\cdots \\\\\n    &= \\sum_{t=0}^{\\infty}R(s_t)\n\\end{align}\n}\n\u3053\u306e\u3088\u3046\u306b\u5358\u7d14\u306a\u7d2f\u7a4d\u5831\u916c\u3092\u4f7f\u3063\u3066\u3082\u3044\u3044\u306e\u3067\u3059\u304c\u3001\u3044\u304f\u3064\u304b\u306e\u7406\u7531\u304b\u3089\u4ee5\u4e0b\u306e\u5f0f\u306e\u3088\u3046\u306b\u5c06\u6765\u5f97\u3089\u308c\u308b\u5831\u916c\u3092\u5272\u5f15\u4fc2\u6570 \u03b3(0\u2264\u03b3<1)\\gamma (0 \\leq \\gamma < 1) \u3067\u5272\u308a\u5f15\u3044\u305f\u7d2f\u7a4d\u5831\u916c\u304c\u4f7f\u308f\u308c\u307e\u3059\u3002\u3053\u3046\u3059\u308b\u3053\u3068\u3067\u3001\u5c06\u6765\u5f97\u3089\u308c\u308b\u5831\u916c\u3088\u308a\u73fe\u5728\u5f97\u3089\u308c\u308b\u5831\u916c\u3092\u91cd\u8996\u3059\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\\begin{align}\nU([s_0, s_1, s_2,\\ldots]) &= R(s_0) + \\gamma R(s_1) + \\gamma^2 R(s_2) + \\cdots \\\\\n    &= \\sum_{t=0}^{\\infty}\\gamma^t R(s_t)\n\\end{align}\nU([s0,s1,s2,\u2026])=R(s0)+\u03b3R(s1)+\u03b32R(s2)+\u22ef=\u221e\u2211t=0\u03b3tR(st){\\begin{align}\nU([s_0, s_1, s_2,\\ldots]) &= R(s_0) + \\gamma R(s_1) + \\gamma^2 R(s_2) + \\cdots \\\\\n    &= \\sum_{t=0}^{\\infty}\\gamma^t R(s_t)\n\\end{align}\n}\n\u3053\u306e\u3088\u3046\u306a\u5272\u5f15\u5831\u916c\u3092\u4f7f\u3046\u7406\u7531\u3068\u3057\u3066\u306f\u4ee5\u4e0b\u304c\u3042\u3052\u3089\u308c\u307e\u3059\u3002\n\n\u8a08\u7b97\u7684\u306b\u5024\u304c\u767a\u6563\u3057\u306a\u3044\n\u5b9f\u969b\u306e\u74b0\u5883\u3067\u306f\u3001\u6642\u9593\u304c\u305f\u3064\u3068\u74b0\u5883\u304c\u5909\u5316\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u305f\u3081\u3001\u6642\u7cfb\u5217\u306e\u3059\u3079\u3066\u306e\u5831\u916c\u3092\u540c\u3058\u91cd\u307f\u3067\u8003\u616e\u3059\u308b\u306e\u306f\u59a5\u5f53\u3067\u306f\u306a\u3044\n\n\n\u6700\u9069\u306a\u653f\u7b56\u306e\u898b\u3064\u3051\u65b9\n\u3053\u3053\u307e\u3067\u3067MDP\u3068\u3044\u3046\u30e2\u30c7\u30eb\u306b\u3064\u3044\u3066\u306f\u308f\u304b\u308a\u307e\u3057\u305f\u3002\u6b8b\u3055\u308c\u305f\u554f\u984c\u306f\u3069\u3046\u3084\u3063\u3066\u6700\u9069\u306a\u653f\u7b56\u3092\u898b\u3064\u3051\u308b\u304b\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002\u4ee5\u4e0b\u3067\u306f\u6700\u9069\u306a\u653f\u7b56\u3092\u898b\u3064\u3051\u308b\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3068\u3057\u3066\u3001\u4fa1\u5024\u53cd\u5fa9\u6cd5\u3068Q-Learning\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\n\n\u4fa1\u5024\u53cd\u5fa9\u6cd5(Value Iteration)\n\u4fa1\u5024\u53cd\u5fa9\u6cd5\u3067\u306f\u3001\u72b6\u614b ss \u304b\u3089\u6700\u9069\u306a\u884c\u52d5\u3092\u3068\u308a\u7d9a\u3051\u305f\u6642\u306e\u671f\u5f85\u5229\u5f97\u3092\u8a08\u7b97\u3057\u307e\u3059\u3002\u5f97\u3089\u308c\u308b\u5229\u5f97\u306e\u671f\u5f85\u5024\u3092\u8003\u3048\u308b\u306e\u306f\u78ba\u7387\u7684\u306a\u9077\u79fb\u304c\u884c\u308f\u308c\u308b\u305f\u3081\u3067\u3059\u3002\n\u3053\u306e\u671f\u5f85\u5229\u5f97\u304c\u308f\u304b\u308c\u3070\u3001\u73fe\u5728\u306e\u72b6\u614b ss \u304b\u3089\u5c06\u6765\u306b\u308f\u305f\u3063\u3066\u5f97\u3089\u308c\u308b\u4fa1\u5024\u304c\u308f\u304b\u308b\u306e\u3067\u3001\u305d\u306e\u4fa1\u5024\u3092\u6700\u5927\u5316\u3059\u308b\u3088\u3046\u306a\u884c\u52d5\u3092\u9078\u629e\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308c\u3070\u3044\u3044\u306f\u305a\u3067\u3059\u3002\u4fa1\u5024\u306f\u4ee5\u4e0b\u306e\u72b6\u614b\u4fa1\u5024\u95a2\u6570\u3067\u6c42\u3081\u3089\u308c\u307e\u3059\u3002\u8907\u96d1\u306b\u898b\u3048\u307e\u3059\u304c\u3001\u8981\u3059\u308b\u306b(\u671f\u5f85)\u5272\u5f15\u7d2f\u7a4d\u5831\u916c\u3092\u8a08\u7b97\u3057\u3066\u3044\u308b\u3060\u3051\u3067\u3059\u3002\nU(s) = R(s) + \\gamma \\max_a\\sum_{s'} P(s' \\mid s,a) U(s')\nU(s)=R(s)+\u03b3maxa\u2211s\u2032P(s\u2032\u2223s,a)U(s\u2032){U(s) = R(s) + \\gamma \\max_a\\sum_{s'} P(s' \\mid s,a) U(s')\n}\n\u3053\u306e\u5f0f\u306e\u4e2d\u306b\u306fmax\u3068\u3044\u3046\u975e\u7dda\u5f62\u8a08\u7b97\u304c\u3042\u308a\u884c\u5217\u7b49\u3067\u89e3\u304f\u3053\u3068\u306f\u56f0\u96e3\u3067\u3059\u3002\u305d\u306e\u305f\u3081\u53cd\u5fa9\u7684\u306b\u8a08\u7b97\u3092\u884c\u3063\u3066\u4fa1\u5024\u3092\u5f90\u3005\u306b\u66f4\u65b0\u3057\u3066\u3044\u304d\u307e\u3059\u3002\u3053\u308c\u304c\u4fa1\u5024\u53cd\u5fa9\u6cd5\u306e\u540d\u524d\u306e\u6240\u4ee5\u3067\u3059\u3002\u4ee5\u4e0b\u306b\u4fa1\u5024\u53cd\u5fa9\u6cd5\u306e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u793a\u3057\u307e\u3059\u3002\u8a08\u7b97\u91cf\u306fO(|S|2|A|)O(|S|^2 |A|)\u3067\u3059\u3002\n\n1.\u3059\u3079\u3066\u306e\u72b6\u614b ss \u306b\u3064\u3044\u3066 U(s)U(s) \u3092\u9069\u5f53\u306a\u5024(\u30bc\u30ed\u306a\u3069)\u306b\u521d\u671f\u5316\n2.\u3059\u3079\u3066\u306e U(s)U(s) \u306b\u3064\u3044\u3066\u4ee5\u4e0b\u306e\u5f0f\u3092\u8a08\u7b97\u3057\u3066\u5024\u3092\u66f4\u65b0\nU(s) \\leftarrow R(s) + \\gamma \\max_a\\sum_{s'} P(s' \\mid s,a) U(s')\nU(s)\u2190R(s)+\u03b3maxa\u2211s\u2032P(s\u2032\u2223s,a)U(s\u2032){U(s) \\leftarrow R(s) + \\gamma \\max_a\\sum_{s'} P(s' \\mid s,a) U(s')\n}\n3.\u30b9\u30c6\u30c3\u30d72\u3092\u5024\u304c\u53ce\u675f\u3059\u308b\u307e\u3067\u7e70\u308a\u8fd4\u3059\n\n\u4e0a\u8a18\u306e\u5f0f\u306b\u306fmax\u8a08\u7b97\u3092\u3059\u308b\u90e8\u5206\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u305d\u306e\u5024\u304c\u6700\u5927\u5024\u3068\u306a\u308b\u884c\u52d5a\u3092\u8a18\u9332\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u306e\u305f\u3081 U(s)U(s) \u3060\u3051\u3067\u306f\u6700\u9069\u306a\u653f\u7b56(\u884c\u52d5)\u304c\u308f\u304b\u308a\u306b\u304f\u3044\u3068\u3044\u3046\u554f\u984c\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u3053\u3067\u4ee5\u4e0b\u306eQ\u95a2\u6570\u3092\u5c0e\u5165\u3057\u307e\u3059\u3002\u884c\u52d5\u4fa1\u5024\u95a2\u6570\u3068\u3082\u547c\u3070\u308c\u307e\u3059\u3002\nQ^*(s,a) = R(s) + \\gamma \\sum_{s'} P(s' \\mid s,a) \\max_{a'}Q^*(s', a')\nQ\u2217(s,a)=R(s)+\u03b3\u2211s\u2032P(s\u2032\u2223s,a)maxa\u2032Q\u2217(s\u2032,a\u2032){Q^*(s,a) = R(s) + \\gamma \\sum_{s'} P(s' \\mid s,a) \\max_{a'}Q^*(s', a')\n}\nQ\u2217(s,a)Q^*(s,a)\u306f\u3001\u72b6\u614bss\u3067\u884c\u52d5a\u3092\u9078\u629e\u5f8c\u306f\u305a\u3063\u3068\u6700\u9069\u306a\u653f\u7b56\u3092\u53d6\u308a\u7d9a\u3051\u308b\u5834\u5408\u306e\u5272\u5f15\u7d2f\u7a4d\u5831\u916c\u306e\u671f\u5f85\u5024\u3092\u8868\u3057\u3066\u3044\u307e\u3059\u3002\nU(s)U(s) \u3068 Q\u2217(s,a)Q^*(s,a) \u306b\u306f\u3001\u5404\u72b6\u614b\u306b\u304a\u3051\u308b\u6700\u5927\u306e\u5024\u3060\u3051\u4fdd\u6301\u3059\u308b\u306e\u304b\u3001\u305d\u308c\u3068\u3082\u5404\u884c\u52d5\u306b\u5bfe\u3057\u3066\u5024\u3092\u4fdd\u6301\u3059\u308b\u306e\u304b\u306e\u9055\u3044\u304c\u3042\u308a\u307e\u3059\u3002\u3057\u305f\u304c\u3063\u3066\u3001\u72b6\u614bs\u306b\u304a\u3051\u308b\u6700\u5927\u306eQ\u5024\u306f U(s)U(s) \u306b\u7b49\u3057\u304f\u306a\u308a\u3001\u3053\u306eQ\u5024\u3092\u6301\u3064\u884c\u52d5a\u304c\u6700\u9069\u306a\u884c\u52d5\u3068\u306a\u308a\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u56f3\u304c\u305d\u306e\u30a4\u30e1\u30fc\u30b8\u3067\u3059\u3002\n\nQ\u95a2\u6570\u3092\u7528\u3044\u305f\u5834\u5408\u306e\u4fa1\u5024\u53cd\u5fa9\u6cd5\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n1.\u3059\u3079\u3066\u306e\u72b6\u614b ss \u306b\u3064\u3044\u3066 Q\u2217(s,a)Q^*(s,a) \u3092\u9069\u5f53\u306a\u5024(\u30bc\u30ed\u306a\u3069)\u306b\u521d\u671f\u5316\n2.\u3059\u3079\u3066\u306e Q\u2217(s,a)Q^*(s,a) \u306b\u3064\u3044\u3066\u4ee5\u4e0b\u306e\u5f0f\u3092\u8a08\u7b97\u3057\u3066\u5024\u3092\u66f4\u65b0\nQ^*(s,a) \\leftarrow R(s) + \\gamma \\sum_{s'} P(s' \\mid s,a) \\max_{a'}Q^*(s', a')\nQ\u2217(s,a)\u2190R(s)+\u03b3\u2211s\u2032P(s\u2032\u2223s,a)maxa\u2032Q\u2217(s\u2032,a\u2032){Q^*(s,a) \\leftarrow R(s) + \\gamma \\sum_{s'} P(s' \\mid s,a) \\max_{a'}Q^*(s', a')\n}\n3.\u30b9\u30c6\u30c3\u30d72\u3092\u5024\u304c\u53ce\u675f\u3059\u308b\u307e\u3067\u7e70\u308a\u8fd4\u3059\n\n\u3053\u3053\u307e\u3067\u304f\u308c\u3070\u6700\u9069\u306a\u653f\u7b56\u03c0\u2217(s)\\pi ^*(s)\u3092\u898b\u3064\u3051\u308b\u306e\u306f\u7c21\u5358\u3067\u3059\u3002\u4ee5\u4e0b\u3067\u6c42\u3081\u3089\u308c\u307e\u3059\u3002\n\\pi^*(s) = arg\\max_{a}Q^*(s,a)\n\u03c0\u2217(s)=argmaxaQ\u2217(s,a){\\pi^*(s) = arg\\max_{a}Q^*(s,a)\n}\n\n\u8a08\u7b97\u4f8b\n\u305b\u3063\u304b\u304f\u306a\u306e\u3067\u8a66\u3057\u306b\u4ee5\u4e0b\u306e\u8d64\u3044\u5834\u6240\u306e\u4fa1\u5024\u3092\u8a08\u7b97\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u8a08\u7b97\u306b\u306f\u4ee5\u4e0b\u306e\u5f0f\u3092\u4f7f\u3044\u307e\u3059\u3002\nU(s) \\leftarrow R(s) + \\gamma \\max_a\\sum_{s'} P(s' \\mid s,a) U(s')\nU(s)\u2190R(s)+\u03b3maxa\u2211s\u2032P(s\u2032\u2223s,a)U(s\u2032){U(s) \\leftarrow R(s) + \\gamma \\max_a\\sum_{s'} P(s' \\mid s,a) U(s')\n}\n\u03b3=0.5\\gamma = 0.5\u3001 R(s)=\u22120.04R(s) = -0.04\u3001\u9077\u79fb\u78ba\u7387\u306f\u9032\u307f\u305f\u3044\u65b9\u5411\u306b0.8\u3001\u305d\u306e\u5de6\u53f3\u306b0.1\u305a\u3064\u3068\u3057\u307e\u3059\u3002\n\u4ee5\u4e0a\u306e\u6761\u4ef6\u306e\u3068\u304d\u3001\u8d64\u3044\u5834\u6240\u306e\u5024\u306f\u30fb\u30fb\u30fb\n\\begin{align}\nU(s) &= -0.04 + 0.5 \\cdot (0.8 \\cdot 1 + 0.1 \\cdot 0 + 0.1 \\cdot 0)\\\\\n&= -0.04 + 0.4\\\\\n&= 0.36\n\\end{align}\nU(s)=\u22120.04+0.5\u22c5(0.8\u22c51+0.1\u22c50+0.1\u22c50)=\u22120.04+0.4=0.36{\\begin{align}\nU(s) &= -0.04 + 0.5 \\cdot (0.8 \\cdot 1 + 0.1 \\cdot 0 + 0.1 \\cdot 0)\\\\\n&= -0.04 + 0.4\\\\\n&= 0.36\n\\end{align}\n}\n\u3068\u6c42\u3081\u3089\u308c\u307e\u3059\u3002\n\nQ-Learning\n\u3055\u3066\u3001\u4fa1\u5024\u53cd\u5fa9\u6cd5\u3067\u6700\u9069\u306a\u653f\u7b56\u304c\u6c42\u3081\u3089\u308c\u3066\u4e00\u5b89\u5fc3\u3002\u305d\u3046\u306f\u554f\u5c4b\u304c\u304a\u308d\u3057\u307e\u305b\u3093\u3002\u4f55\u304c\u554f\u984c\u306a\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\n\u4eca\u307e\u3067\u306f\u72b6\u614b\u9077\u79fb\u78ba\u7387\u306b\u3064\u3044\u3066\u308f\u304b\u3063\u3066\u3044\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u73fe\u5b9f\u306e\u554f\u984c\u3092\u8003\u3048\u308b\u3068\u72b6\u614b\u9077\u79fb\u78ba\u7387\u304c\u308f\u304b\u3063\u3066\u3044\u308b\u3053\u3068\u306f\u73cd\u3057\u3044\u3067\u3059\u3002\u30c1\u30a7\u30b9\u3084\u5c06\u68cb\u3092\u601d\u3044\u6d6e\u304b\u3079\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\u3042\u308b\u76e4\u9762\uff08\u72b6\u614b\uff09\u304b\u3089\u5225\u306e\u76e4\u9762\uff08\u5225\u306e\u72b6\u614b\uff09\u3078\u9077\u79fb\u3059\u308b\u78ba\u7387\u306f\u3042\u3089\u304b\u3058\u3081\u4e0e\u3048\u3089\u308c\u3066\u3044\u308b\u3067\u3057\u3087\u3046\u304b\uff1f\u4e0e\u3048\u3089\u308c\u3066\u3044\u307e\u305b\u3093\u3088\u306d\uff1f\u305d\u306e\u3088\u3046\u306a\u5834\u5408\u306f\u4fa1\u5024\u53cd\u5fa9\u6cd5\u306f\u4f7f\u3048\u307e\u305b\u3093\u3002\n\u305d\u3053\u3067\u51fa\u3066\u304f\u308b\u306e\u304c\u4fa1\u5024\u53cd\u5fa9\u6cd5\u306e\u5f37\u5316\u5b66\u7fd2\u7248\u3068\u3082\u3044\u3048\u308bQ-Learning\u3067\u3059\u3002Q-Learning\u3067\u306f\n\u02c6Q\u2217(s,a)\\hat{Q}^{*}(s,a)\u306e\u63a8\u5b9a\u5024\u02c6Q\u2217(st,at)\\hat{Q}^{*}(s_t, a_t)\u3092\u8a08\u7b97\u3057\u307e\u3059\u3002Q-Learning\u3092\u4f7f\u3046\u3053\u3068\u3067\u3001\u9077\u79fb\u78ba\u7387\u304c\u308f\u304b\u3089\u306a\u3044\u72b6\u6cc1\u3067\u3082\u6700\u9069\u306a\u653f\u7b56\u306e\u5b66\u7fd2\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002Q-Learning\u306e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\n1.\u9069\u5f53\u306a\u5024\u3067 \u02c6Q\u2217(st,at)\\hat Q^*(s_t, a_t) \u3092\u521d\u671f\u5316\n2.\u4ee5\u4e0b\u306e\u5f0f\u3092\u7528\u3044\u3066\u884c\u52d5\u4fa1\u5024\u306e\u63a8\u5b9a\u5024\u3092\u66f4\u65b0\u3002\u305f\u3060\u3057 \u03b1\\alpha \u306f\u5b66\u7fd2\u7387\u3067 0\u2264\u03b1\u226410 \\leq \\alpha \\leq 1\u3002\n\\hat Q^*(s_t, a_t) \\leftarrow \\hat Q^*(s_t, a_t) + \\alpha \\Bigl[ r_{t+1} + \\gamma \\max_{a \\in A}\\hat Q^*(s_{t+1}, a) - \\hat Q^*(s_t, a_t) \\Bigr]\n\u02c6Q\u2217(st,at)\u2190\u02c6Q\u2217(st,at)+\u03b1[rt+1+\u03b3maxa\u2208A\u02c6Q\u2217(st+1,a)\u2212\u02c6Q\u2217(st,at)]{\\hat Q^*(s_t, a_t) \\leftarrow \\hat Q^*(s_t, a_t) + \\alpha \\Bigl[ r_{t+1} + \\gamma \\max_{a \\in A}\\hat Q^*(s_{t+1}, a) - \\hat Q^*(s_t, a_t) \\Bigr]\n}\n3.\u6642\u9593\u30b9\u30c6\u30c3\u30d7 tt \u3092 t+1t+1 \u3078\u9032\u3081\u30662\u3078\u623b\u308b\n\n\u3053\u306e\u8a08\u7b97\u3092\u7e70\u308a\u8fd4\u3059\u3053\u3068\u3067\u6700\u9069\u306a Q\u2217(s,a)Q^*(s,a) \u3092\u5f97\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u5b9f\u8df5\u7de8\n\u4e0a\u3067\u8aac\u660e\u3057\u305f\u3053\u3068\u3092Python\u3067\u3084\u3063\u305f\u3089\u3069\u3046\u306a\u308b\u304b\u306b\u3064\u3044\u3066\u898b\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\n\n\u4fa1\u5024\u53cd\u5fa9\u6cd5\n\u307e\u305a\u306f\u4fa1\u5024\u53cd\u5fa9\u6cd5\u304b\u3089\u3067\u3059\u3002\n\u4fa1\u5024\u53cd\u5fa9\u6cd5\u306fUC Berkeley\u306e\u30b3\u30fc\u30c9(mdp.py)\u304c\u304d\u308c\u3044\u3060\u3063\u305f\u306e\u3067\u3001\u305d\u308c\u3092\u57fa\u306b\u8aac\u660e\u3057\u307e\u3059\u3002\n\nMDP\u30af\u30e9\u30b9\n\u307e\u305a\u306f\u57fa\u5e95\u30af\u30e9\u30b9\u3068\u306a\u308bMDP\u304b\u3089\u3002\u3053\u308c\u3092\u7d99\u627f\u3057\u3066GridMDP\u30af\u30e9\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\nclass MDP:\n\n    def __init__(self, init, actlist, terminals, gamma=.9):\n        self.init = init\n        self.actlist = actlist\n        self.terminals = terminals\n        if not (0 <= gamma < 1):\n            raise ValueError(\"An MDP must have 0 <= gamma < 1\")\n        self.gamma = gamma\n        self.states = set()\n        self.reward = {}\n\n    def R(self, state):\n    return self.reward[state]\n\n    def T(self, state, action):\n        raise NotImplementedError\n\n    def actions(self, state):\n        if state in self.terminals:\n            return [None]\n        else:\n            return self.actlist\n\n__init__\u30e1\u30bd\u30c3\u30c9\u3067\u306f\u4ee5\u4e0b\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u53d7\u3051\u53d6\u308a\u307e\u3059:\n\ninit: \u521d\u671f\u72b6\u614b.\nactlist: \u5404\u72b6\u614b\u3067\u3068\u308c\u308b\u884c\u52d5.\nterminals: \u7d42\u4e86\u72b6\u614b\u306e\u30ea\u30b9\u30c8\ngamma: \u5272\u5f15\u4fc2\u6570\n\nR\u30e1\u30bd\u30c3\u30c9\u306f\u5404\u72b6\u614b\u3067\u306e\u5831\u916c\u3092\u8fd4\u3057\u307e\u3059\u3002\nT\u30e1\u30bd\u30c3\u30c9\u306f\u9077\u79fb\u30e2\u30c7\u30eb\u3067\u3059\u3002\u3053\u3053\u3067\u306f\u62bd\u8c61\u30e1\u30bd\u30c3\u30c9\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u72b6\u614b ss \u3067\u884c\u52d5 aa \u3092\u53d6\u3063\u305f\u6642\u306b\u3001\u6b21\u72b6\u614b\u3078\u306e\u9077\u79fb\u78ba\u7387\u3068\u6b21\u72b6\u614b\u306e\u30bf\u30d7\u30eb(probability, s')\u306e\u30ea\u30b9\u30c8\u3092\u8fd4\u3057\u307e\u3059\u3002GridMDP\u3067\u5b9f\u88c5\u3057\u3066\u3044\u304d\u307e\u3059\u3002\nactions\u30e1\u30bd\u30c3\u30c9\u306f\u5404\u72b6\u614b\u3067\u3068\u308c\u308b\u884c\u52d5\u306e\u30ea\u30b9\u30c8\u3092\u8fd4\u3057\u307e\u3059\u3002\n\nGridMDP\u30af\u30e9\u30b9\nGridMDP\u30af\u30e9\u30b9\u306f\u57fa\u5e95\u30af\u30e9\u30b9MDP\u306e\u5177\u8c61\u30af\u30e9\u30b9\u3067\u3059\u3002\u4f8b\u984c\u3067\u8aac\u660e\u3057\u305f\u8ff7\u8def\u306e\u4e16\u754c\u3092\u8868\u73fe\u3059\u308b\u305f\u3081\u306e\u30af\u30e9\u30b9\u3067\u3059\u3002\nclass GridMDP(MDP):\n\n    def __init__(self, grid, terminals, init=(0, 0), gamma=.9):\n        grid.reverse()  # because we want row 0 on bottom, not on top                                                                                                  \n        MDP.__init__(self, init, actlist=orientations,\n                     terminals=terminals, gamma=gamma)\n        self.grid = grid\n        self.rows = len(grid)\n        self.cols = len(grid[0])\n        for x in range(self.cols):\n            for y in range(self.rows):\n                self.reward[x, y] = grid[y][x]\n                if grid[y][x] is not None:\n                    self.states.add((x, y))\n\n    def T(self, state, action):\n        if action is None:\n            return [(0.0, state)]\n        else:\n            return [(0.8, self.go(state, action)),\n                    (0.1, self.go(state, turn_right(action))),\n                    (0.1, self.go(state, turn_left(action)))]\n\n    def go(self, state, direction):\n        state1 = vector_add(state, direction)\n        return state1 if state1 in self.states else state\n\n    def to_grid(self, mapping):\n        return list(reversed([[mapping.get((x, y), None)\n                               for x in range(self.cols)]\n                              for y in range(self.rows)]))\n\n    def to_arrows(self, policy):\n        chars = {(1, 0): '>', (0, 1): '^', (-1, 0): '<', (0, -1): 'v', None: '.'}\n        return self.to_grid({s: chars[a] for (s, a) in policy.items()})\n\n__init__\u30e1\u30bd\u30c3\u30c9\u304c\u53d7\u3051\u53d6\u308b\u5f15\u6570\u306f\u307b\u307cMDP\u30af\u30e9\u30b9\u3068\u540c\u3058\u3067\u3059\u304c\u3001grid\u5f15\u6570\u3092\u53d7\u3051\u53d6\u308b\u70b9\u304c\u9055\u3044\u307e\u3059\u3002grid\u306b\u306f\u5404\u72b6\u614b\u3067\u306e\u5831\u916c\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u6e21\u3057\u307e\u3059\u3002None\u306f\u58c1\u3092\u8868\u3057\u3066\u3044\u307e\u3059\u3002\nGridMDP([[-0.04, -0.04, -0.04, +1],\n        [-0.04, None,  -0.04, -1],\n        [-0.04, -0.04, -0.04, -0.04]],\n        terminals=[(3, 2), (3, 1)])\n\ngo\u30e1\u30bd\u30c3\u30c9\u306f\u6307\u5b9a\u3057\u305f\u65b9\u5411\u306b\u79fb\u52d5\u3057\u305f\u5834\u5408\u306e\u72b6\u614b\u3092\u8fd4\u3057\u307e\u3059\u3002\nT\u30e1\u30bd\u30c3\u30c9\u306fMDP\u3067\u8aac\u660e\u3057\u305f\u3068\u304a\u308a\u3067\u3059\u3002\u3053\u3053\u3067\u306f\u5b9f\u969b\u306b\u5b9f\u88c5\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nto_grid\u3084to_arrows \u30e1\u30bd\u30c3\u30c9\u306f\u8868\u793a\u7528\u306e\u30e1\u30bd\u30c3\u30c9\u3067\u3059\u3002\n\n\u4fa1\u5024\u53cd\u5fa9\u6cd5\u306e\u5b9f\u88c5\ndef value_iteration(mdp, epsilon=0.001):\n    U1 = {s: 0 for s in mdp.states}\n    R, T, gamma = mdp.R, mdp.T, mdp.gamma\n    while True:\n        U = U1.copy()\n        delta = 0\n        for s in mdp.states:\n            U1[s] = R(s) + gamma * max([sum([p * U[s1] for (p, s1) in T(s, a)])\n                                        for a in mdp.actions(s)])\n            delta = max(delta, abs(U1[s] - U[s]))\n        if delta < epsilon * (1 - gamma) / gamma:\n            return U\n\n\ndef best_policy(mdp, U):\n    pi = {}\n    for s in mdp.states:\n        pi[s] = argmax(mdp.actions(s), key=lambda a: expected_utility(a, s, U, mdp))\n    return pi\n\n\ndef expected_utility(a, s, U, mdp):\n    return sum([p * U[s1] for (p, s1) in mdp.T(s, a)])\n\nvalue_iteration\u95a2\u6570\u306f\u5165\u529b\u3068\u3057\u3066GridMDP\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3068\u5c0f\u3055\u306a\u5024epsilon\u3092\u53d7\u3051\u53d6\u308a\u3001\u51fa\u529b\u3068\u3057\u3066\u5404\u72b6\u614b\u306b\u304a\u3051\u308bU(s)\u3092\u8fd4\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u3059\u3002\n>> value_iteration(sequential_decision_environment)\n{(0, 0): 0.2962883154554812,\n (0, 1): 0.3984432178350045,\n (0, 2): 0.5093943765842497,\n (1, 0): 0.25386699846479516,\n (1, 2): 0.649585681261095,\n (2, 0): 0.3447542300124158,\n (2, 1): 0.48644001739269643,\n (2, 2): 0.7953620878466678,\n (3, 0): 0.12987274656746342,\n (3, 1): -1.0,\n (3, 2): 1.0}\n\n\u305d\u3057\u3066\u3001value_iteration\u95a2\u6570\u3067\u8a08\u7b97\u3057\u305f\u7d50\u679c\u3092best_policy\u95a2\u6570\u306b\u6e21\u3057\u3066\u3042\u3052\u308b\u3053\u3068\u3067\u3001\u6700\u9069\u306a\u653f\u7b56\u3092\u6c42\u3081\u307e\u3059\u3002\n\n\u5b9f\u884c\n\u4ee5\u4e0b\u304c\u8a66\u3059\u305f\u3081\u306e\u30b3\u30fc\u30c9\u3067\u3059\u3002\u305f\u3060\u3057\u3001\u3053\u306e\u307e\u307e\u3067\u306f\u5fc5\u8981\u306a\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u3044\u304f\u3064\u304bimport\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u52d5\u304d\u307e\u305b\u3093\u3002\u305d\u306e\u305f\u3081\u5b9f\u969b\u306b\u52d5\u304b\u3057\u305f\u3044\u5834\u5408\u306f\u3053\u3053\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u30af\u30ed\u30fc\u30f3\u3057\u3066\u52d5\u304b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nsequential_decision_environment = GridMDP([[-0.04, -0.04, -0.04, +1],\n                                           [-0.04, None,  -0.04, -1],\n                                           [-0.04, -0.04, -0.04, -0.04]],\n                                          terminals=[(3, 2), (3, 1)])\n\npi = best_policy(sequential_decision_environment, value_iteration(sequential_decision_environment, .01))\n\nprint_table(sequential_decision_environment.to_arrows(pi))\n\n\u5b9f\u884c\u7d50\u679c\u3068\u3057\u3066\u3001\u4ee5\u4e0b\u306e\u653f\u7b56\u3092\u5f97\u3089\u308c\u307e\u3059\u3002\n>   >      >   .\n^   None   ^   .\n^   >      ^   <\n\n\nQ-Learning\n\u3078\u3093\u3058\u304c\u306a\u3044\u3001\u305f\u3060\u306e\u3057\u304b\u3070\u306d\u306e\u3088\u3046\u3060\nQ-Learning\u306f\u4f53\u529b\u306e\u3042\u308b\u6642\u306b\u66f8\u304b\u305b\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u53c2\u8003\u8cc7\u6599\nUdacity\u306e\u8b1b\u7fa9\u52d5\u753b\u3002\u6587\u5b57\u306f\u8aad\u307f\u306b\u304f\u3044\u304c\u3001\u8a71\u306f\u5206\u304b\u308a\u3084\u3059\u3044\u3002\n\nMachine Learning: Reinforcement Learning\n\n\u65e5\u672c\u8a9e\u306e\u8cc7\u6599\n\n\u5f37\u5316\u5b66\u7fd2\n\u5f37\u5316\u5b66\u7fd2\u306e\u57fa\u790e\n\u5f37\u5316\u5b66\u7fd2\u306e\u57fa\u790e\n\u5f37\u5316\u5b66\u7fd2\u306b\u3064\u3044\u3066\u5b66\u3093\u3067\u307f\u305f\u3002\n\u60c5\u5831\u610f\u5473\u8ad6(12)\u5f37\u5316\u5b66\u7fd2\nEmergent Computation\nQ\u5b66\u7fd2\u306b\u3088\u308b\u6700\u77ed\u7d4c\u8def\u5b66\u7fd2\n\n\u82f1\u8a9e\u306e\u8cc7\u6599\n\nReinforcement Learning: A User\u2019s Guide\nIntroduction to Reinforcement Learning\nIntroduction Reinforcement Learning\n\nValue Iteration\u306b\u95a2\u3057\u3066\u56f3\u3092\u4ea4\u3048\u3066\u308f\u304b\u308a\u3084\u3059\u304f\u89e3\u8aac\u3057\u3066\u3044\u308b\u8cc7\u6599\n\nMarkov Decision Processes and Exact Solution Methods: \nMarkov Decision Processes Value Iteration\nMarkov Decision Processes\n\nValue Iteration\u5b9f\u88c5\u3059\u308b\u3068\u304d\u306b\u53c2\u8003\u306b\u306a\u308b\u8cc7\u6599\n\nArtificial Intelligence: Markov Decision Process\nArtificial Intelligence: A Modern Approach\nValue Iteration\nPythonic Markov Decision Process (MDP)\n\n\u4fa1\u5024\u95a2\u6570\u306e\u6570\u5f0f\u5c55\u958b\u304c\u4e01\u5be7\n\nReinforcement Learning Searching for optimal policies I:Bellman equations and optimal policies\n\n# \u306f\u3058\u3081\u306b\n\u307f\u306a\u3055\u3093\u3001\u5f37\u5316\u5b66\u7fd2\u3057\u3066\u307e\u3059\u304b\uff1f\n\u5f37\u5316\u5b66\u7fd2\u306f\u30ed\u30dc\u30c3\u30c8\u3084\u3001\u56f2\u7881\u3084\u5c06\u68cb\u306e\u3088\u3046\u306a\u30b2\u30fc\u30e0\u3001\u5bfe\u8a71\u30b7\u30b9\u30c6\u30e0\u7b49\u306b\u5fdc\u7528\u3067\u304d\u308b\u697d\u3057\u3044\u6280\u8853\u3067\u3059\u3002\n\n\u5f37\u5316\u5b66\u7fd2\u3068\u306f\u3001\u8a66\u884c\u932f\u8aa4\u3092\u901a\u3058\u3066\u74b0\u5883\u306b\u9069\u5fdc\u3059\u308b\u5b66\u7fd2\u5236\u5fa1\u306e\u67a0\u7d44\u307f\u3067\u3059\u3002\u6559\u5e2b\u3042\u308a\u5b66\u7fd2\u3067\u306f\u5165\u529b\u306b\u5bfe\u3059\u308b\u6b63\u3057\u3044\u51fa\u529b\u3092\u4e0e\u3048\u3066\u5b66\u7fd2\u3055\u305b\u307e\u3057\u305f\u3002\u5f37\u5316\u5b66\u7fd2\u3067\u306f\u3001\u5165\u529b\u306b\u5bfe\u3059\u308b\u6b63\u3057\u3044\u51fa\u529b\u3092\u4e0e\u3048\u308b\u4ee3\u308f\u308a\u306b\u3001\u4e00\u9023\u306e\u884c\u52d5\u306b\u5bfe\u3059\u308b\u826f\u3057\u60aa\u3057\u3092\u8a55\u4fa1\u3059\u308b\u300c\u5831\u916c\u300d\u3068\u3044\u3046\u30b9\u30ab\u30e9\u30fc\u306e\u8a55\u4fa1\u5024\u304c\u4e0e\u3048\u3001\u3053\u308c\u3092\u624b\u304c\u304b\u308a\u306b\u5b66\u7fd2\u3092\u884c\u3044\u307e\u3059\u3002\u4ee5\u4e0b\u306b\u5f37\u5316\u5b66\u7fd2\u306e\u67a0\u7d44\u307f\u3092\u793a\u3057\u307e\u3059\u3002\n![rl_concept.png](https://qiita-image-store.s3.amazonaws.com/0/77079/800cdce3-132d-87f2-5472-532261a5b13c.png)\n\n1. \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u6642\u523b $t$ \u306b\u304a\u3044\u3066\u74b0\u5883\u306e\u72b6\u614b $s_t$ \u3092\u89b3\u6e2c\n2. \u89b3\u6e2c\u3057\u305f\u72b6\u614b\u304b\u3089\u884c\u52d5 $a_t$ \u3092\u6c7a\u5b9a\n3. \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u884c\u52d5\u3092\u5b9f\u884c\n4. \u74b0\u5883\u306f\u65b0\u3057\u3044\u72b6\u614b $s_{t+1}$ \u306b\u9077\u79fb\n5. \u9077\u79fb\u306b\u5fdc\u3058\u305f\u5831\u916c $r_{t+1}$ \u3092\u7372\u5f97\n6. \u5b66\u7fd2\u3059\u308b\n7. \u30b9\u30c6\u30c3\u30d71\u304b\u3089\u7e70\u308a\u8fd4\u3059\n\n\u5f37\u5316\u5b66\u7fd2\u306e\u76ee\u7684\u306f\u3001\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u53d6\u5f97\u3059\u308b\u5229\u5f97\uff08\u7d2f\u7a4d\u5831\u916c\uff09\u3092\u6700\u5927\u5316\u3059\u308b\u3088\u3046\u306a\u3001\u72b6\u614b\u304b\u3089\u884c\u52d5\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0\uff08\u653f\u7b56\uff09\u3092\u7372\u5f97\u3059\u308b\u3053\u3068\u3067\u3059\u3002\n\n<!--\n\u5f37\u5316\u5b66\u7fd2\u3068\u306f\u3001\u8a66\u884c\u932f\u8aa4\u3092\u901a\u3058\u3066\u74b0\u5883\u306b\u9069\u5fdc\u3059\u308b\u5b66\u7fd2\u5236\u5fa1\u306e\u67a0\u7d44\u307f\u3067\u3059\u3002\u6559\u5e2b\u3042\u308a\u5b66\u7fd2\u3068\u7570\u306a\u308a\u3001\u72b6\u614b\u5165\u529b\u306b\u5bfe\u3059\u308b\u6b63\u3057\u3044\u884c\u52d5\u51fa\u529b\u3092\u660e\u793a\u7684\u306b\u793a\u3059\u6559\u5e2b\u304c\u5b58\u5728\u3057\u306a\u3044\u4ee3\u308f\u308a\u306b\u3001\u4e00\u9023\u306e\u884c\u52d5\u306b\u5bfe\u3057\u3066\u7d50\u679c\u3068\u3057\u3066\u306e\u826f\u3057\u60aa\u3057\u3092\u8a55\u4fa1\u3059\u308b\u300c\u5831\u916c\u300d\u3068\u3044\u3046\u30b9\u30ab\u30e9\u30fc\u306e\u8a55\u4fa1\u5024\u304c\u4e0e\u3048\u3089\u308c\u3001\u3053\u308c\u3092\u624b\u304c\u304b\u308a\u306b\u5b66\u7fd2\u3092\u884c\u3044\u307e\u3059\u3002\u3057\u304b\u3057\u3001\u5831\u916c\u3084\u72b6\u614b\u9077\u79fb\u306b\u306f\u4e0d\u78ba\u5b9f\u6027\u3084\u6642\u9593\u7684\u9045\u308c\u304c\u3042\u308b\u305f\u3081\u3001\u4e00\u822c\u306b\u884c\u52d5\u3092\u5b9f\u884c\u3057\u305f\u76f4\u5f8c\u306e\u5831\u916c\u3092\u898b\u308b\u3060\u3051\u3067\u306f\u3001\u5b66\u7fd2\u4e3b\u4f53\u306f\u305d\u306e\u884c\u52d5\u304c\u6b63\u3057\u304b\u3063\u305f\u304b\u3069\u3046\u304b\u3092\u5224\u65ad\u3067\u304d\u306a\u3044\u3068\u3044\u3046\u56f0\u96e3\u3092\u4f34\u3044\u307e\u3059\u3002\n\n\u5f37\u5316\u5b66\u7fd2\u306e\u67a0\u7d44\u307f\u3092\u4ee5\u4e0b\u306b\u793a\u3057\u307e\u3059\u3002\n![rl_framework1.png](https://qiita-image-store.s3.amazonaws.com/0/77079/913066da-3bda-8e73-88a2-a5cfadcac58d.png)\n\n![rl_framework2.png](https://qiita-image-store.s3.amazonaws.com/0/77079/193f6d15-df91-b74d-33d8-6d3285d79b05.png)\n\n1. \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u6642\u523b $t$ \u306b\u304a\u3044\u3066\u74b0\u5883\u306e\u72b6\u614b\u89b3\u6e2c $s_t$ \u306b\u5fdc\u3058\u3066\u610f\u601d\u6c7a\u5b9a\u3092\u884c\u3044\u884c\u52d5 $a_t$ \u3092\u51fa\u529b\n2. \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u884c\u52d5\u306b\u3088\u308a\u74b0\u5883\u306f $s_{t+1}$ \u306b\u72b6\u614b\u9077\u79fb\u3057\u3001\u305d\u306e\u9077\u79fb\u306b\u5fdc\u3058\u305f\u5831\u916c $r_t$ \u3092\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3078\u4e0e\u3048\u308b\n3. \u6642\u523b $t$ \u3092 $t+1$ \u306b\u9032\u3081\u3066\u30b9\u30c6\u30c3\u30d71\u3078\u623b\u308b\n-->\n\n\u5f37\u5316\u5b66\u7fd2\u3067\u306f\u4e0a\u8a18\u306e\u67a0\u7d44\u307f\u3092\u30de\u30eb\u30b3\u30d5\u6c7a\u5b9a\u904e\u7a0b(Markov decision processes: MDP)\u306b\u3088\u3063\u3066\u30e2\u30c7\u30eb\u5316\u3057\u3001\u5b66\u7fd2\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u8003\u3048\u308b\u3068\u3044\u3063\u305f\u3053\u3068\u304c\u884c\u308f\u308c\u307e\u3059\u3002\u672c\u7a3f\u3067\u306f\u3001\u5f37\u5316\u5b66\u7fd2\u306b\u3064\u3044\u3066\u7406\u8ad6\u7de8\u3068\u5b9f\u8df5\u7de8\u306b\u5206\u3051\u3066\u89e3\u8aac\u3057\u307e\u3059\u3002\u7406\u8ad6\u7de8\u3067\u306f\u3001MDP\u304a\u3088\u3073\u5b66\u7fd2\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u3001\u5b9f\u8df5\u7de8\u3067\u306f\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u8a00\u8a9ePython\u3092\u7528\u3044\u3066\u7406\u8ad6\u7de8\u3067\u8aac\u660e\u3057\u305f\u3053\u3068\u3092\u5b9f\u88c5\u3057\u3066\u3044\u304d\u307e\u3059\u3002\u9806\u756a\u306b\u8aad\u3080\u3053\u3068\u3092\u304a\u3059\u3059\u3081\u3057\u307e\u3059\u304c\u3001\u300c\u3053\u307e\u3051\u3047\u3053\u305f\u3041\u3044\u3044\u3093\u3060\u3088\uff01\u300d\u3068\u3044\u3046\u65b9\u306f\u7406\u8ad6\u7de8\u3092\u98db\u3070\u3057\u3066\u5b9f\u8df5\u7de8\u3092\u8aad\u3093\u3067\u304f\u3060\u3055\u3044\u3002\n\n# \u7406\u8ad6\u7de8\n\u307e\u305a\u3001\u5f37\u5316\u5b66\u7fd2\u306e\u7406\u8ad6\u3092\u4f8b\u3092\u4ea4\u3048\u3066\u8aac\u660e\u3057\u3066\u3044\u304d\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u4f8b\u984c\u306e\u554f\u984c\u8a2d\u5b9a\u3092\u8aac\u660e\u3057\u305f\u5f8c\u3001\u30de\u30eb\u30b3\u30d5\u6c7a\u5b9a\u904e\u7a0b\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\u30de\u30eb\u30b3\u30d5\u6c7a\u5b9a\u904e\u7a0b\u306b\u3064\u3044\u3066\u7406\u89e3\u3067\u304d\u305f\u3068\u3053\u308d\u3067\u3001\u305d\u306e\u5b66\u7fd2\u65b9\u6cd5\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\n\n## \u554f\u984c\u8a2d\u5b9a\n\u3055\u3066\u3001MDP\u3092\u8aac\u660e\u3059\u308b\u306b\u3042\u305f\u3063\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8ff7\u8def\u306e\u4e16\u754c\u3092\u8003\u3048\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n![grid.png](https://qiita-image-store.s3.amazonaws.com/0/77079/d2631adc-c8f2-016e-a5ba-9f9c09c4ff7c.png)\n\n\n\u8ff7\u8def\u306e\u4e16\u754c\u306e\u30eb\u30fc\u30eb\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\n* \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u3042\u308b\u30b0\u30ea\u30c3\u30c9\u306e\u4e2d\u306b\u3044\u307e\u3059\n* \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u58c1(\u7070\u8272)\u3092\u8d8a\u3048\u3089\u308c\u307e\u305b\u3093\n* \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u81ea\u5206\u304c\u601d\u3063\u305f\u901a\u308a\u306b\u52d5\u3051\u308b\u3068\u306f\u9650\u308a\u307e\u305b\u3093\n * 80%\u306e\u78ba\u7387\u3067\u6b63\u3057\u304f\u52d5\u3051\u307e\u3059\u304c\u300110%\u306e\u78ba\u7387\u3067\u52d5\u3053\u3046\u3068\u601d\u3063\u3066\u3044\u305f\u65b9\u5411\u306e\u5de6\u5074\u3078\u52d5\u304d\u3001\u3082\u304610%\u306e\u78ba\u7387\u3067\u53f3\u5074\u3078\u52d5\u304d\u307e\u3059\n* \u52d5\u3053\u3046\u3068\u601d\u3063\u305f\u5834\u6240\u306b\u58c1\u304c\u3042\u3063\u305f\u5834\u5408\u306f\u3001\u305d\u306e\u5834\u306b\u3068\u3069\u307e\u308a\u307e\u3059\n* \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u5404\u6642\u523b\u306b\u5831\u916c\u3092\u53d7\u3051\u53d6\u308a\u307e\u3059\n* \u30b4\u30fc\u30eb(\u5b9d\u7bb1)\u3084\u30c8\u30e9\u30c3\u30d7(\u7206\u767a)\u306b\u305f\u3069\u308a\u7740\u304f\u3068\u30b2\u30fc\u30e0\u7d42\u4e86\u3057\u3001\u30b9\u30bf\u30fc\u30c8\u4f4d\u7f6e\u306b\u623b\u308a\u307e\u3059\n\n\u78ba\u7387\u7684\u306a\u9077\u79fb\u306b\u3064\u3044\u3066\u4ee5\u4e0b\u306e\u56f3\u3092\u7528\u3044\u3066\u3082\u3046\u5c11\u3057\u8a73\u3057\u304f\u8aac\u660e\u3057\u307e\u3059\u3002\n![transition2.png](https://qiita-image-store.s3.amazonaws.com/0/77079/ba75a1b4-63a6-f796-794a-d40c9e380a3e.png)\n\n\u3053\u3053\u3067\u306f\u30ed\u30dc\u30c3\u30c8\u306f\u4e0a\u306b\u52d5\u3053\u3046\u3068\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u3068\u304d80%\u306e\u78ba\u7387\u3067\u4e0a\u306b\u52d5\u3051\u307e\u3059\u304c\u300110%\u306e\u78ba\u7387\u3067\u5de6\u5074\u306b\u52d5\u304d\u3001\u6b8b\u308a\u306e10%\u306e\u78ba\u7387\u3067\u53f3\u5074\u306b\u52d5\u3044\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u9077\u79fb\u78ba\u7387\u306f\u4ee5\u4e0b\u306e\u8868\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n| $s'$  | $P(s' \\mid s_1, a)$  |\n|---|---|\n| $s_2$  | 0.1  |\n| $s_3$  | 0.8  |\n| $s_4$  | 0.1  |\n\n\n## \u30de\u30eb\u30b3\u30d5\u6c7a\u5b9a\u904e\u7a0b(Markov decision processes: MDP)\n\u3055\u3066\u3001\u554f\u984c\u8a2d\u5b9a\u306f\u308f\u304b\u3063\u305f\u3067\u3057\u3087\u3046\u304b\uff1f\u308f\u304b\u3063\u305f\u3068\u3053\u308d\u3067\u3001\u554f\u984c\u3092MDP\u3067\u30e2\u30c7\u30eb\u5316\u3057\u307e\u3059\u3002\n\nMDP\u306f\u4ee5\u4e0b\u306e4\u9805\u7d44\u3067\u5b9a\u7fa9\u3055\u308c\u307e\u3059\n\n```math\nM = (S, A, T, R)\n```\n\n\u305d\u308c\u305e\u308c\u4f55\u306a\u306e\u304b\u3068\u3044\u3046\u3068\u3001\n\n* \u72b6\u614b\u96c6\u5408: $s \\in S$\n* \u884c\u52d5\u96c6\u5408: $a \\in A$\n* \u9077\u79fb\u95a2\u6570: $T(s, a, s') \\sim P(s' \\mid s, a)$\n* \u5831\u916c\u95a2\u6570: $R(s)$, $R(s, a)$, $R(s,a,s')$\n\n\u305d\u308c\u305e\u308c\u4e0a\u3067\u8aac\u660e\u3057\u305f\u554f\u984c\u8a2d\u5b9a\u306b\u5f53\u3066\u306f\u3081\u3066\u8003\u3048\u3066\u307f\u307e\u3059\u3002\n\n* \u72b6\u614b\u96c6\u5408\u306f\u74b0\u5883\u304c\u3068\u308a\u3046\u308b\u72b6\u614b\u306e\u96c6\u5408\u3092\u8868\u3057\u3066\u304a\u308a\u3001\u4f8b\u984c\u306e\u5834\u5408\u306f\u30b0\u30ea\u30c3\u30c9\u306e\u3059\u3079\u3066\u306e\u30bb\u30eb\u3092\u8868\u3057\u3066\u3044\u307e\u3059\u3002\n* \u884c\u52d5\u96c6\u5408\u306f\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u3068\u308a\u3046\u308b\u884c\u52d5\u306e\u7a2e\u985e\u306e\u3053\u3068\u3067\u3059\u3002\u4f8b\u984c\u306e\u5834\u5408\u3001\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u4e0a\u4e0b\u5de6\u53f3\u306b\u52d5\u304f\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u30674\u7a2e\u985e\u3067\u3059\u3002\n* \u9077\u79fb\u95a2\u6570\u3068\u306f\u3001\u3042\u308b\u72b6\u614b $s$ \u3067\u884c\u52d5 $a$ \u3092\u53d6\u3063\u305f\u6642\u306b\u6b21\u306e\u72b6\u614b $s'$ \u3078\u3069\u306e\u304f\u3089\u3044\u306e\u78ba\u7387\u3067\u9077\u79fb\u3059\u308b\u304b\u3068\u3044\u3046\u3053\u3068\u3092\u8868\u3057\u3066\u3044\u307e\u3059\u3002\u4e0a\u306e\u56f3\u3067\u8aac\u660e\u3057\u305f\u901a\u308a\u3067\u3059\u3002\n* \u5831\u916c\u306f\u89b3\u6e2c\u3057\u305f\u72b6\u614b\u304b\u3089\u53d6\u308b\u3079\u304d\u884c\u52d5\u3092\u6c7a\u5b9a\u3057\u3001\u65b0\u305f\u306b\u9077\u79fb\u3057\u305f\u7d50\u679c\u3068\u3057\u3066\u74b0\u5883\u304b\u3089\u53d7\u3051\u53d6\u308b\u5024\u306e\u3053\u3068\u3067\u3059\u3002\u5f8c\u3067\u8a73\u3057\u304f\u8aac\u660e\u3057\u307e\u3059\u3002\n\n\u3053\u306eMDP\u306e\u76ee\u7684\u306f\u5229\u5f97(=\u7d2f\u7a4d\u5831\u916c)\u3092\u6700\u5927\u5316\u3059\u308b\u884c\u52d5\u6226\u7565\u3092\u5b66\u7fd2\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u3053\u306e\u884c\u52d5\u6226\u7565\u306e\u3053\u3068\u3092**\u653f\u7b56**\u3068\u547c\u3073\u307e\u3059\u3002\n\n### \u653f\u7b56\u306b\u3064\u3044\u3066\u3082\u3046\u5c11\u3057\u8a73\u3057\u304f\nMDP\u3067\u306f\u6700\u9069\u306a\u653f\u7b56 $\\pi^*: S \\rightarrow A$ \u3092\u5f97\u308b\u3053\u3068\u304c\u76ee\u7684\u3067\u3059\u3002\u653f\u7b56\u306f\u72b6\u614b\u304b\u3089\u884c\u52d5\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0\u3092\u884c\u3046\u95a2\u6570\u3068\u307f\u306a\u305b\u307e\u3059\u3002\n\u653f\u7b56\u306f\u5404\u72b6\u614b\u3067\u53d6\u308b\u3079\u304d\u884c\u52d5\u3092\u6559\u3048\u3066\u304f\u308c\u307e\u3059\u3002\u307e\u305f\u3001\u6700\u9069\u306a\u653f\u7b56\u306f\u671f\u5f85\u5229\u5f97\u3092\u6700\u5927\u5316\u3057\u307e\u3059\u3002\n\n\u9077\u79fb\u3057\u305f\u6642\u306b\u5f97\u3089\u308c\u308b\u5831\u916c\u3092\u5909\u5316\u3055\u305b\u305f\u3068\u304d\u306e\u6700\u9069\u306a\u653f\u7b56\u306e\u5909\u5316\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n![reward_policy.gif](https://qiita-image-store.s3.amazonaws.com/0/77079/16122f4e-712b-4e70-2597-5b900bef0f33.gif)\n\u3053\u306e\u56f3\u3067\u306f\u72b6\u614b\u9077\u79fb\u3067\u5f97\u3089\u308c\u308b\u5831\u916c\u3092\u3060\u3093\u3060\u3093\u5c0f\u3055\u304f\uff08\u30da\u30ca\u30eb\u30c6\u30a3\u3092\u5927\u304d\u304f\uff09\u3057\u305f\u6642\u306b\u304a\u3051\u308b\u653f\u7b56\u306e\u5909\u5316\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002\u653f\u7b56\u306f\u5f97\u3089\u308c\u308b\u671f\u5f85\u5229\u5f97\u3092\u6700\u5927\u5316\u3059\u308b\u3068\u3044\u3046\u8003\u3048\u65b9\u304b\u3089\u5b66\u7fd2\u3057\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001\u72b6\u614b\u9077\u79fb\u306b\u3088\u308b\u30da\u30ca\u30eb\u30c6\u30a3\u304c\u5c0f\u3055\u3051\u308c\u3070\u9060\u56de\u308a\u3057\u3066\u3067\u3082\u30b4\u30fc\u30eb\u3092\u76ee\u6307\u305d\u3046\u3068\u3057\u3001\u30da\u30ca\u30eb\u30c6\u30a3\u304c\u5927\u304d\u3051\u308c\u3070\u901f\u3084\u304b\u306b\u30b2\u30fc\u30e0\u3092\u7d42\u4e86\u3055\u305b\u308b\u6226\u7565\u3092\u53d6\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u6bd4\u8f03\u3057\u3084\u3059\u3044\u3088\u3046\u306b\u9759\u6b62\u753b\u3082\u7528\u610f\u3057\u307e\u3057\u305f\u3002\n![rewards_policy.png](https://qiita-image-store.s3.amazonaws.com/0/77079/0137ccc8-fdd1-825b-46e8-bc70710689f6.png)\n\n\n### \u5831\u916c\u306b\u3064\u3044\u3066\u3082\u3046\u5c11\u3057\u8a73\u3057\u304f\n\u3055\u3066\u3001\u3053\u3053\u307e\u3067\u3067\u653f\u7b56\u3092\u5b66\u7fd2\u3059\u308b\u305f\u3081\u306b\u306f\u7d2f\u7a4d\u5831\u916c\u3092\u6700\u5927\u5316\u3059\u308b\u3068\u8ff0\u3079\u307e\u3057\u305f\u3002\n\u5404\u6642\u523b\u306b\u5831\u916c $R(s_t)$ \u3092\u5f97\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u3067\u3001\u7d2f\u7a4d\u5831\u916c\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u305b\u307e\u3059\u3002\n\n```math\n\\begin{align}\nU([s_0, s_1, s_2,\\ldots]) &= R(s_0) + R(s_1) + R(s_2) + \\cdots \\\\\n    &= \\sum_{t=0}^{\\infty}R(s_t)\n\\end{align}\n```\n\n\u3053\u306e\u3088\u3046\u306b\u5358\u7d14\u306a\u7d2f\u7a4d\u5831\u916c\u3092\u4f7f\u3063\u3066\u3082\u3044\u3044\u306e\u3067\u3059\u304c\u3001\u3044\u304f\u3064\u304b\u306e\u7406\u7531\u304b\u3089\u4ee5\u4e0b\u306e\u5f0f\u306e\u3088\u3046\u306b\u5c06\u6765\u5f97\u3089\u308c\u308b\u5831\u916c\u3092\u5272\u5f15\u4fc2\u6570 $\\gamma (0 \\leq \\gamma < 1)$ \u3067\u5272\u308a\u5f15\u3044\u305f\u7d2f\u7a4d\u5831\u916c\u304c\u4f7f\u308f\u308c\u307e\u3059\u3002\u3053\u3046\u3059\u308b\u3053\u3068\u3067\u3001\u5c06\u6765\u5f97\u3089\u308c\u308b\u5831\u916c\u3088\u308a\u73fe\u5728\u5f97\u3089\u308c\u308b\u5831\u916c\u3092\u91cd\u8996\u3059\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```math\n\\begin{align}\nU([s_0, s_1, s_2,\\ldots]) &= R(s_0) + \\gamma R(s_1) + \\gamma^2 R(s_2) + \\cdots \\\\\n    &= \\sum_{t=0}^{\\infty}\\gamma^t R(s_t)\n\\end{align}\n```\n\n\u3053\u306e\u3088\u3046\u306a\u5272\u5f15\u5831\u916c\u3092\u4f7f\u3046\u7406\u7531\u3068\u3057\u3066\u306f\u4ee5\u4e0b\u304c\u3042\u3052\u3089\u308c\u307e\u3059\u3002\n\n* \u8a08\u7b97\u7684\u306b\u5024\u304c\u767a\u6563\u3057\u306a\u3044\n* \u5b9f\u969b\u306e\u74b0\u5883\u3067\u306f\u3001\u6642\u9593\u304c\u305f\u3064\u3068\u74b0\u5883\u304c\u5909\u5316\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u305f\u3081\u3001\u6642\u7cfb\u5217\u306e\u3059\u3079\u3066\u306e\u5831\u916c\u3092\u540c\u3058\u91cd\u307f\u3067\u8003\u616e\u3059\u308b\u306e\u306f\u59a5\u5f53\u3067\u306f\u306a\u3044\n\n## \u6700\u9069\u306a\u653f\u7b56\u306e\u898b\u3064\u3051\u65b9\n\u3053\u3053\u307e\u3067\u3067MDP\u3068\u3044\u3046\u30e2\u30c7\u30eb\u306b\u3064\u3044\u3066\u306f\u308f\u304b\u308a\u307e\u3057\u305f\u3002\u6b8b\u3055\u308c\u305f\u554f\u984c\u306f\u3069\u3046\u3084\u3063\u3066\u6700\u9069\u306a\u653f\u7b56\u3092\u898b\u3064\u3051\u308b\u304b\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002\u4ee5\u4e0b\u3067\u306f\u6700\u9069\u306a\u653f\u7b56\u3092\u898b\u3064\u3051\u308b\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3068\u3057\u3066\u3001\u4fa1\u5024\u53cd\u5fa9\u6cd5\u3068Q-Learning\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\n\n### \u4fa1\u5024\u53cd\u5fa9\u6cd5(Value Iteration)\n\u4fa1\u5024\u53cd\u5fa9\u6cd5\u3067\u306f\u3001\u72b6\u614b $s$ \u304b\u3089\u6700\u9069\u306a\u884c\u52d5\u3092\u3068\u308a\u7d9a\u3051\u305f\u6642\u306e\u671f\u5f85\u5229\u5f97\u3092\u8a08\u7b97\u3057\u307e\u3059\u3002\u5f97\u3089\u308c\u308b\u5229\u5f97\u306e\u671f\u5f85\u5024\u3092\u8003\u3048\u308b\u306e\u306f\u78ba\u7387\u7684\u306a\u9077\u79fb\u304c\u884c\u308f\u308c\u308b\u305f\u3081\u3067\u3059\u3002\n\n\u3053\u306e\u671f\u5f85\u5229\u5f97\u304c\u308f\u304b\u308c\u3070\u3001\u73fe\u5728\u306e\u72b6\u614b $s$ \u304b\u3089\u5c06\u6765\u306b\u308f\u305f\u3063\u3066\u5f97\u3089\u308c\u308b\u4fa1\u5024\u304c\u308f\u304b\u308b\u306e\u3067\u3001\u305d\u306e\u4fa1\u5024\u3092\u6700\u5927\u5316\u3059\u308b\u3088\u3046\u306a\u884c\u52d5\u3092\u9078\u629e\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308c\u3070\u3044\u3044\u306f\u305a\u3067\u3059\u3002\u4fa1\u5024\u306f\u4ee5\u4e0b\u306e\u72b6\u614b\u4fa1\u5024\u95a2\u6570\u3067\u6c42\u3081\u3089\u308c\u307e\u3059\u3002\u8907\u96d1\u306b\u898b\u3048\u307e\u3059\u304c\u3001\u8981\u3059\u308b\u306b(\u671f\u5f85)\u5272\u5f15\u7d2f\u7a4d\u5831\u916c\u3092\u8a08\u7b97\u3057\u3066\u3044\u308b\u3060\u3051\u3067\u3059\u3002\n\n```math\nU(s) = R(s) + \\gamma \\max_a\\sum_{s'} P(s' \\mid s,a) U(s')\n```\n\n\u3053\u306e\u5f0f\u306e\u4e2d\u306b\u306fmax\u3068\u3044\u3046\u975e\u7dda\u5f62\u8a08\u7b97\u304c\u3042\u308a\u884c\u5217\u7b49\u3067\u89e3\u304f\u3053\u3068\u306f\u56f0\u96e3\u3067\u3059\u3002\u305d\u306e\u305f\u3081\u53cd\u5fa9\u7684\u306b\u8a08\u7b97\u3092\u884c\u3063\u3066\u4fa1\u5024\u3092\u5f90\u3005\u306b\u66f4\u65b0\u3057\u3066\u3044\u304d\u307e\u3059\u3002\u3053\u308c\u304c\u4fa1\u5024\u53cd\u5fa9\u6cd5\u306e\u540d\u524d\u306e\u6240\u4ee5\u3067\u3059\u3002\u4ee5\u4e0b\u306b\u4fa1\u5024\u53cd\u5fa9\u6cd5\u306e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u793a\u3057\u307e\u3059\u3002\u8a08\u7b97\u91cf\u306f$O(|S|^2 |A|)$\u3067\u3059\u3002\n\n>1.\u3059\u3079\u3066\u306e\u72b6\u614b $s$ \u306b\u3064\u3044\u3066 $U(s)$ \u3092\u9069\u5f53\u306a\u5024(\u30bc\u30ed\u306a\u3069)\u306b\u521d\u671f\u5316\n\n>2.\u3059\u3079\u3066\u306e $U(s)$ \u306b\u3064\u3044\u3066\u4ee5\u4e0b\u306e\u5f0f\u3092\u8a08\u7b97\u3057\u3066\u5024\u3092\u66f4\u65b0\n\n>```math\nU(s) \\leftarrow R(s) + \\gamma \\max_a\\sum_{s'} P(s' \\mid s,a) U(s')\n```\n>3.\u30b9\u30c6\u30c3\u30d72\u3092\u5024\u304c\u53ce\u675f\u3059\u308b\u307e\u3067\u7e70\u308a\u8fd4\u3059\n\n\u4e0a\u8a18\u306e\u5f0f\u306b\u306fmax\u8a08\u7b97\u3092\u3059\u308b\u90e8\u5206\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u305d\u306e\u5024\u304c\u6700\u5927\u5024\u3068\u306a\u308b\u884c\u52d5a\u3092\u8a18\u9332\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u306e\u305f\u3081 $U(s)$ \u3060\u3051\u3067\u306f\u6700\u9069\u306a\u653f\u7b56(\u884c\u52d5)\u304c\u308f\u304b\u308a\u306b\u304f\u3044\u3068\u3044\u3046\u554f\u984c\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u3053\u3067\u4ee5\u4e0b\u306eQ\u95a2\u6570\u3092\u5c0e\u5165\u3057\u307e\u3059\u3002\u884c\u52d5\u4fa1\u5024\u95a2\u6570\u3068\u3082\u547c\u3070\u308c\u307e\u3059\u3002\n\n```math\nQ^*(s,a) = R(s) + \\gamma \\sum_{s'} P(s' \\mid s,a) \\max_{a'}Q^*(s', a')\n```\n\n**$Q^*(s,a)$**\u306f\u3001**\u72b6\u614b$s$\u3067\u884c\u52d5a\u3092\u9078\u629e\u5f8c\u306f\u305a\u3063\u3068\u6700\u9069\u306a\u653f\u7b56\u3092\u53d6\u308a\u7d9a\u3051\u308b\u5834\u5408**\u306e\u5272\u5f15\u7d2f\u7a4d\u5831\u916c\u306e\u671f\u5f85\u5024\u3092\u8868\u3057\u3066\u3044\u307e\u3059\u3002\n$U(s)$ \u3068 $Q^*(s,a)$ \u306b\u306f\u3001\u5404\u72b6\u614b\u306b\u304a\u3051\u308b\u6700\u5927\u306e\u5024\u3060\u3051\u4fdd\u6301\u3059\u308b\u306e\u304b\u3001\u305d\u308c\u3068\u3082\u5404\u884c\u52d5\u306b\u5bfe\u3057\u3066\u5024\u3092\u4fdd\u6301\u3059\u308b\u306e\u304b\u306e\u9055\u3044\u304c\u3042\u308a\u307e\u3059\u3002\u3057\u305f\u304c\u3063\u3066\u3001\u72b6\u614bs\u306b\u304a\u3051\u308b\u6700\u5927\u306eQ\u5024\u306f $U(s)$ \u306b\u7b49\u3057\u304f\u306a\u308a\u3001\u3053\u306eQ\u5024\u3092\u6301\u3064\u884c\u52d5a\u304c\u6700\u9069\u306a\u884c\u52d5\u3068\u306a\u308a\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u56f3\u304c\u305d\u306e\u30a4\u30e1\u30fc\u30b8\u3067\u3059\u3002\n![v_and_q.png](https://qiita-image-store.s3.amazonaws.com/0/77079/35041da9-4449-c8c6-59a2-cd0a796105d1.png)\n\nQ\u95a2\u6570\u3092\u7528\u3044\u305f\u5834\u5408\u306e\u4fa1\u5024\u53cd\u5fa9\u6cd5\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n>1.\u3059\u3079\u3066\u306e\u72b6\u614b $s$ \u306b\u3064\u3044\u3066 $Q^*(s,a)$ \u3092\u9069\u5f53\u306a\u5024(\u30bc\u30ed\u306a\u3069)\u306b\u521d\u671f\u5316\n\n>2.\u3059\u3079\u3066\u306e $Q^*(s,a)$ \u306b\u3064\u3044\u3066\u4ee5\u4e0b\u306e\u5f0f\u3092\u8a08\u7b97\u3057\u3066\u5024\u3092\u66f4\u65b0\n\n>```math\nQ^*(s,a) \\leftarrow R(s) + \\gamma \\sum_{s'} P(s' \\mid s,a) \\max_{a'}Q^*(s', a')\n```\n\n>3.\u30b9\u30c6\u30c3\u30d72\u3092\u5024\u304c\u53ce\u675f\u3059\u308b\u307e\u3067\u7e70\u308a\u8fd4\u3059\n\n\n\u3053\u3053\u307e\u3067\u304f\u308c\u3070\u6700\u9069\u306a\u653f\u7b56$\\pi ^*(s)$\u3092\u898b\u3064\u3051\u308b\u306e\u306f\u7c21\u5358\u3067\u3059\u3002\u4ee5\u4e0b\u3067\u6c42\u3081\u3089\u308c\u307e\u3059\u3002\n\n```math\n\\pi^*(s) = arg\\max_{a}Q^*(s,a)\n```\n\n### \u8a08\u7b97\u4f8b\n\u305b\u3063\u304b\u304f\u306a\u306e\u3067\u8a66\u3057\u306b\u4ee5\u4e0b\u306e\u8d64\u3044\u5834\u6240\u306e\u4fa1\u5024\u3092\u8a08\u7b97\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n![value_func_example.png](https://qiita-image-store.s3.amazonaws.com/0/77079/dac84db0-422a-3dba-f530-f38b61328473.png)\n\u8a08\u7b97\u306b\u306f\u4ee5\u4e0b\u306e\u5f0f\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n```math\nU(s) \\leftarrow R(s) + \\gamma \\max_a\\sum_{s'} P(s' \\mid s,a) U(s')\n```\n<!--\n\n```math\nV^*(s) \\leftarrow \\max_{a \\in A} \\sum_{s' \\in S}P(s'|s,a) \\Bigl[R(s,a,s') + \\gamma V^*(s') \\Bigr]\n```\n-->\n$\\gamma = 0.5$\u3001 $R(s) = -0.04$\u3001\u9077\u79fb\u78ba\u7387\u306f\u9032\u307f\u305f\u3044\u65b9\u5411\u306b0.8\u3001\u305d\u306e\u5de6\u53f3\u306b0.1\u305a\u3064\u3068\u3057\u307e\u3059\u3002\n\n\u4ee5\u4e0a\u306e\u6761\u4ef6\u306e\u3068\u304d\u3001\u8d64\u3044\u5834\u6240\u306e\u5024\u306f\u30fb\u30fb\u30fb\n\n```math\n\\begin{align}\nU(s) &= -0.04 + 0.5 \\cdot (0.8 \\cdot 1 + 0.1 \\cdot 0 + 0.1 \\cdot 0)\\\\\n&= -0.04 + 0.4\\\\\n&= 0.36\n\\end{align}\n```\n<!--\n\n```math\n\\begin{align}\nV^*(s) &= 0.8 \\cdot (-0.04 + 0.5 \\cdot 1) + 0.1 \\cdot (-0.04 + 0.5 \\cdot 0) + 0.1 \\cdot (-0.04 + 0.5 \\cdot 0)\\\\\n&= 0.8 \\cdot 0.46 + (-0.004) \\cdot 2\\\\\n&= 0.36\n\\end{align}\n```\n-->\n\u3068\u6c42\u3081\u3089\u308c\u307e\u3059\u3002\n\n### Q-Learning\n\u3055\u3066\u3001\u4fa1\u5024\u53cd\u5fa9\u6cd5\u3067\u6700\u9069\u306a\u653f\u7b56\u304c\u6c42\u3081\u3089\u308c\u3066\u4e00\u5b89\u5fc3\u3002\u305d\u3046\u306f\u554f\u5c4b\u304c\u304a\u308d\u3057\u307e\u305b\u3093\u3002\u4f55\u304c\u554f\u984c\u306a\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\n\n\u4eca\u307e\u3067\u306f\u72b6\u614b\u9077\u79fb\u78ba\u7387\u306b\u3064\u3044\u3066\u308f\u304b\u3063\u3066\u3044\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u73fe\u5b9f\u306e\u554f\u984c\u3092\u8003\u3048\u308b\u3068\u72b6\u614b\u9077\u79fb\u78ba\u7387\u304c\u308f\u304b\u3063\u3066\u3044\u308b\u3053\u3068\u306f\u73cd\u3057\u3044\u3067\u3059\u3002\u30c1\u30a7\u30b9\u3084\u5c06\u68cb\u3092\u601d\u3044\u6d6e\u304b\u3079\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\u3042\u308b\u76e4\u9762\uff08\u72b6\u614b\uff09\u304b\u3089\u5225\u306e\u76e4\u9762\uff08\u5225\u306e\u72b6\u614b\uff09\u3078\u9077\u79fb\u3059\u308b\u78ba\u7387\u306f\u3042\u3089\u304b\u3058\u3081\u4e0e\u3048\u3089\u308c\u3066\u3044\u308b\u3067\u3057\u3087\u3046\u304b\uff1f\u4e0e\u3048\u3089\u308c\u3066\u3044\u307e\u305b\u3093\u3088\u306d\uff1f\u305d\u306e\u3088\u3046\u306a\u5834\u5408\u306f\u4fa1\u5024\u53cd\u5fa9\u6cd5\u306f\u4f7f\u3048\u307e\u305b\u3093\u3002\n\n\u305d\u3053\u3067\u51fa\u3066\u304f\u308b\u306e\u304c\u4fa1\u5024\u53cd\u5fa9\u6cd5\u306e\u5f37\u5316\u5b66\u7fd2\u7248\u3068\u3082\u3044\u3048\u308bQ-Learning\u3067\u3059\u3002Q-Learning\u3067\u306f\n$\\hat{Q}^{\\*}(s,a)$\u306e\u63a8\u5b9a\u5024$\\hat{Q}^{\\*}(s_t, a_t)$\u3092\u8a08\u7b97\u3057\u307e\u3059\u3002Q-Learning\u3092\u4f7f\u3046\u3053\u3068\u3067\u3001\u9077\u79fb\u78ba\u7387\u304c\u308f\u304b\u3089\u306a\u3044\u72b6\u6cc1\u3067\u3082\u6700\u9069\u306a\u653f\u7b56\u306e\u5b66\u7fd2\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002Q-Learning\u306e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\n>1.\u9069\u5f53\u306a\u5024\u3067 $\\hat Q^*(s_t, a_t)$ \u3092\u521d\u671f\u5316\n\n>2.\u4ee5\u4e0b\u306e\u5f0f\u3092\u7528\u3044\u3066\u884c\u52d5\u4fa1\u5024\u306e\u63a8\u5b9a\u5024\u3092\u66f4\u65b0\u3002\u305f\u3060\u3057 $\\alpha$ \u306f\u5b66\u7fd2\u7387\u3067 $0 \\leq \\alpha \\leq 1$\u3002\n\n>```math\n\\hat Q^*(s_t, a_t) \\leftarrow \\hat Q^*(s_t, a_t) + \\alpha \\Bigl[ r_{t+1} + \\gamma \\max_{a \\in A}\\hat Q^*(s_{t+1}, a) - \\hat Q^*(s_t, a_t) \\Bigr]\n```\n>3.\u6642\u9593\u30b9\u30c6\u30c3\u30d7 $t$ \u3092 $t+1$ \u3078\u9032\u3081\u30662\u3078\u623b\u308b\n\n\u3053\u306e\u8a08\u7b97\u3092\u7e70\u308a\u8fd4\u3059\u3053\u3068\u3067\u6700\u9069\u306a $Q^*(s,a)$ \u3092\u5f97\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n<!--\n\u5b9f\u969b\u306b\u4fa1\u5024\u53cd\u5fa9\u6cd5\u306e\u66f4\u65b0\u5f0f(Q\u95a2\u6570\u7248)\u3068Q-Learning\u306e\u66f4\u65b0\u5f0f\u3092\u6bd4\u3079\u3066\u307f\u308b\u3068\u3001\u4fa1\u5024\u53cd\u5fa9\u6cd5\u3067\u306fQ\u95a2\u6570\u306e\u8a08\u7b97\u306b\u9077\u79fb\u78ba\u7387 $P(s' \\mid s,a)$\u3092\u7528\u3044\u3066\u3044\u308b\u306e\u306b\u5bfe\u3057\u3001Q-Learning\u3092\u4f7f\u3046\u72b6\u6cc1\u3067\u306f\u672a\u77e5\u306a\u306e\u3067\u4f7f\u7528\u3057\u3066\u3044\u306a\u3044\u3002\u7e70\u308a\u8fd4\u3057\u8a08\u7b97\u3092\u884c\u3046\u3053\u3068\u3067\n-->\n\n# \u5b9f\u8df5\u7de8\n\u4e0a\u3067\u8aac\u660e\u3057\u305f\u3053\u3068\u3092Python\u3067\u3084\u3063\u305f\u3089\u3069\u3046\u306a\u308b\u304b\u306b\u3064\u3044\u3066\u898b\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\n\n## \u4fa1\u5024\u53cd\u5fa9\u6cd5\n\u307e\u305a\u306f\u4fa1\u5024\u53cd\u5fa9\u6cd5\u304b\u3089\u3067\u3059\u3002\n\u4fa1\u5024\u53cd\u5fa9\u6cd5\u306f[UC Berkeley](https://github.com/aimacode/aima-python)\u306e\u30b3\u30fc\u30c9(mdp.py)\u304c\u304d\u308c\u3044\u3060\u3063\u305f\u306e\u3067\u3001\u305d\u308c\u3092\u57fa\u306b\u8aac\u660e\u3057\u307e\u3059\u3002\n\n### MDP\u30af\u30e9\u30b9\n\u307e\u305a\u306f\u57fa\u5e95\u30af\u30e9\u30b9\u3068\u306a\u308bMDP\u304b\u3089\u3002\u3053\u308c\u3092\u7d99\u627f\u3057\u3066GridMDP\u30af\u30e9\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n```py3\nclass MDP:\n\n    def __init__(self, init, actlist, terminals, gamma=.9):\n        self.init = init\n        self.actlist = actlist\n        self.terminals = terminals\n        if not (0 <= gamma < 1):\n            raise ValueError(\"An MDP must have 0 <= gamma < 1\")\n        self.gamma = gamma\n        self.states = set()\n        self.reward = {}\n\n    def R(self, state):\n\treturn self.reward[state]\n\n    def T(self, state, action):\n        raise NotImplementedError\n\n    def actions(self, state):\n        if state in self.terminals:\n            return [None]\n        else:\n            return self.actlist\n```\n\\_\\_init\\_\\_\u30e1\u30bd\u30c3\u30c9\u3067\u306f\u4ee5\u4e0b\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u53d7\u3051\u53d6\u308a\u307e\u3059:\n\n* init: \u521d\u671f\u72b6\u614b.\n* actlist: \u5404\u72b6\u614b\u3067\u3068\u308c\u308b\u884c\u52d5.\n* terminals: \u7d42\u4e86\u72b6\u614b\u306e\u30ea\u30b9\u30c8\n* gamma: \u5272\u5f15\u4fc2\u6570\n\n**R**\u30e1\u30bd\u30c3\u30c9\u306f\u5404\u72b6\u614b\u3067\u306e\u5831\u916c\u3092\u8fd4\u3057\u307e\u3059\u3002\n**T**\u30e1\u30bd\u30c3\u30c9\u306f\u9077\u79fb\u30e2\u30c7\u30eb\u3067\u3059\u3002\u3053\u3053\u3067\u306f\u62bd\u8c61\u30e1\u30bd\u30c3\u30c9\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u72b6\u614b $s$ \u3067\u884c\u52d5 $a$ \u3092\u53d6\u3063\u305f\u6642\u306b\u3001\u6b21\u72b6\u614b\u3078\u306e\u9077\u79fb\u78ba\u7387\u3068\u6b21\u72b6\u614b\u306e\u30bf\u30d7\u30eb(probability, s')\u306e\u30ea\u30b9\u30c8\u3092\u8fd4\u3057\u307e\u3059\u3002GridMDP\u3067\u5b9f\u88c5\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n**actions**\u30e1\u30bd\u30c3\u30c9\u306f\u5404\u72b6\u614b\u3067\u3068\u308c\u308b\u884c\u52d5\u306e\u30ea\u30b9\u30c8\u3092\u8fd4\u3057\u307e\u3059\u3002\n\n### GridMDP\u30af\u30e9\u30b9\nGridMDP\u30af\u30e9\u30b9\u306f\u57fa\u5e95\u30af\u30e9\u30b9MDP\u306e\u5177\u8c61\u30af\u30e9\u30b9\u3067\u3059\u3002\u4f8b\u984c\u3067\u8aac\u660e\u3057\u305f\u8ff7\u8def\u306e\u4e16\u754c\u3092\u8868\u73fe\u3059\u308b\u305f\u3081\u306e\u30af\u30e9\u30b9\u3067\u3059\u3002\n\n```py3\nclass GridMDP(MDP):\n\n    def __init__(self, grid, terminals, init=(0, 0), gamma=.9):\n        grid.reverse()  # because we want row 0 on bottom, not on top                                                                                                  \n        MDP.__init__(self, init, actlist=orientations,\n                     terminals=terminals, gamma=gamma)\n        self.grid = grid\n        self.rows = len(grid)\n        self.cols = len(grid[0])\n        for x in range(self.cols):\n            for y in range(self.rows):\n                self.reward[x, y] = grid[y][x]\n                if grid[y][x] is not None:\n                    self.states.add((x, y))\n\n    def T(self, state, action):\n        if action is None:\n            return [(0.0, state)]\n        else:\n            return [(0.8, self.go(state, action)),\n                    (0.1, self.go(state, turn_right(action))),\n                    (0.1, self.go(state, turn_left(action)))]\n\n    def go(self, state, direction):\n        state1 = vector_add(state, direction)\n        return state1 if state1 in self.states else state\n\n    def to_grid(self, mapping):\n        return list(reversed([[mapping.get((x, y), None)\n                               for x in range(self.cols)]\n                              for y in range(self.rows)]))\n\n    def to_arrows(self, policy):\n        chars = {(1, 0): '>', (0, 1): '^', (-1, 0): '<', (0, -1): 'v', None: '.'}\n        return self.to_grid({s: chars[a] for (s, a) in policy.items()})\n```\n\\_\\_init\\_\\_\u30e1\u30bd\u30c3\u30c9\u304c\u53d7\u3051\u53d6\u308b\u5f15\u6570\u306f\u307b\u307cMDP\u30af\u30e9\u30b9\u3068\u540c\u3058\u3067\u3059\u304c\u3001grid\u5f15\u6570\u3092\u53d7\u3051\u53d6\u308b\u70b9\u304c\u9055\u3044\u307e\u3059\u3002grid\u306b\u306f\u5404\u72b6\u614b\u3067\u306e\u5831\u916c\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u6e21\u3057\u307e\u3059\u3002None\u306f\u58c1\u3092\u8868\u3057\u3066\u3044\u307e\u3059\u3002\n\n```py\nGridMDP([[-0.04, -0.04, -0.04, +1],\n        [-0.04, None,  -0.04, -1],\n        [-0.04, -0.04, -0.04, -0.04]],\n        terminals=[(3, 2), (3, 1)])\n```\n\n**go**\u30e1\u30bd\u30c3\u30c9\u306f\u6307\u5b9a\u3057\u305f\u65b9\u5411\u306b\u79fb\u52d5\u3057\u305f\u5834\u5408\u306e\u72b6\u614b\u3092\u8fd4\u3057\u307e\u3059\u3002\n**T**\u30e1\u30bd\u30c3\u30c9\u306fMDP\u3067\u8aac\u660e\u3057\u305f\u3068\u304a\u308a\u3067\u3059\u3002\u3053\u3053\u3067\u306f\u5b9f\u969b\u306b\u5b9f\u88c5\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n**to_grid**\u3084**to_arrows** \u30e1\u30bd\u30c3\u30c9\u306f\u8868\u793a\u7528\u306e\u30e1\u30bd\u30c3\u30c9\u3067\u3059\u3002\n\n### \u4fa1\u5024\u53cd\u5fa9\u6cd5\u306e\u5b9f\u88c5\n\n```py\ndef value_iteration(mdp, epsilon=0.001):\n    U1 = {s: 0 for s in mdp.states}\n    R, T, gamma = mdp.R, mdp.T, mdp.gamma\n    while True:\n        U = U1.copy()\n        delta = 0\n        for s in mdp.states:\n            U1[s] = R(s) + gamma * max([sum([p * U[s1] for (p, s1) in T(s, a)])\n                                        for a in mdp.actions(s)])\n            delta = max(delta, abs(U1[s] - U[s]))\n        if delta < epsilon * (1 - gamma) / gamma:\n            return U\n\n\ndef best_policy(mdp, U):\n    pi = {}\n    for s in mdp.states:\n        pi[s] = argmax(mdp.actions(s), key=lambda a: expected_utility(a, s, U, mdp))\n    return pi\n\n\ndef expected_utility(a, s, U, mdp):\n    return sum([p * U[s1] for (p, s1) in mdp.T(s, a)])\n```\n\n**value_iteration**\u95a2\u6570\u306f\u5165\u529b\u3068\u3057\u3066GridMDP\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3068\u5c0f\u3055\u306a\u5024epsilon\u3092\u53d7\u3051\u53d6\u308a\u3001\u51fa\u529b\u3068\u3057\u3066\u5404\u72b6\u614b\u306b\u304a\u3051\u308bU(s)\u3092\u8fd4\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u3059\u3002\n\n```py\n>> value_iteration(sequential_decision_environment)\n{(0, 0): 0.2962883154554812,\n (0, 1): 0.3984432178350045,\n (0, 2): 0.5093943765842497,\n (1, 0): 0.25386699846479516,\n (1, 2): 0.649585681261095,\n (2, 0): 0.3447542300124158,\n (2, 1): 0.48644001739269643,\n (2, 2): 0.7953620878466678,\n (3, 0): 0.12987274656746342,\n (3, 1): -1.0,\n (3, 2): 1.0}\n```\n\n\u305d\u3057\u3066\u3001value_iteration\u95a2\u6570\u3067\u8a08\u7b97\u3057\u305f\u7d50\u679c\u3092**best_policy**\u95a2\u6570\u306b\u6e21\u3057\u3066\u3042\u3052\u308b\u3053\u3068\u3067\u3001\u6700\u9069\u306a\u653f\u7b56\u3092\u6c42\u3081\u307e\u3059\u3002\n\n### \u5b9f\u884c\n\u4ee5\u4e0b\u304c\u8a66\u3059\u305f\u3081\u306e\u30b3\u30fc\u30c9\u3067\u3059\u3002\u305f\u3060\u3057\u3001\u3053\u306e\u307e\u307e\u3067\u306f\u5fc5\u8981\u306a\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u3044\u304f\u3064\u304bimport\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u52d5\u304d\u307e\u305b\u3093\u3002\u305d\u306e\u305f\u3081\u5b9f\u969b\u306b\u52d5\u304b\u3057\u305f\u3044\u5834\u5408\u306f[\u3053\u3053](https://github.com/aimacode/aima-python)\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u30af\u30ed\u30fc\u30f3\u3057\u3066\u52d5\u304b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```py\nsequential_decision_environment = GridMDP([[-0.04, -0.04, -0.04, +1],\n                                           [-0.04, None,  -0.04, -1],\n                                           [-0.04, -0.04, -0.04, -0.04]],\n                                          terminals=[(3, 2), (3, 1)])\n\npi = best_policy(sequential_decision_environment, value_iteration(sequential_decision_environment, .01))\n\nprint_table(sequential_decision_environment.to_arrows(pi))\n```\n\n\u5b9f\u884c\u7d50\u679c\u3068\u3057\u3066\u3001\u4ee5\u4e0b\u306e\u653f\u7b56\u3092\u5f97\u3089\u308c\u307e\u3059\u3002\n\n```py\n>   >      >   .\n^   None   ^   .\n^   >      ^   <\n```\n\n## Q-Learning\n\u3078\u3093\u3058\u304c\u306a\u3044\u3001\u305f\u3060\u306e\u3057\u304b\u3070\u306d\u306e\u3088\u3046\u3060\n\nQ-Learning\u306f\u4f53\u529b\u306e\u3042\u308b\u6642\u306b\u66f8\u304b\u305b\u3066\u304f\u3060\u3055\u3044\u3002\n\n# \u53c2\u8003\u8cc7\u6599\nUdacity\u306e\u8b1b\u7fa9\u52d5\u753b\u3002\u6587\u5b57\u306f\u8aad\u307f\u306b\u304f\u3044\u304c\u3001\u8a71\u306f\u5206\u304b\u308a\u3084\u3059\u3044\u3002\n\n* [Machine Learning: Reinforcement Learning](https://www.udacity.com/course/machine-learning-reinforcement-learning--ud820)\n\n\u65e5\u672c\u8a9e\u306e\u8cc7\u6599\n\n* [\u5f37\u5316\u5b66\u7fd2](http://www.sist.ac.jp/~kanakubo/research/reinforcement_learning.html)\n* [\u5f37\u5316\u5b66\u7fd2\u306e\u57fa\u790e](http://sysplan.nams.kyushu-u.ac.jp/gen/papers/paper2012/A_BasisOfRL.pdf)\n* [\u5f37\u5316\u5b66\u7fd2\u306e\u57fa\u790e](http://www.jnns.org/niss/2000/lecturenote/lecturenote_koike.pdf)\n* [\u5f37\u5316\u5b66\u7fd2\u306b\u3064\u3044\u3066\u5b66\u3093\u3067\u307f\u305f\u3002](http://yamaimo.hatenablog.jp/entry/2015/09/03/200000)\n* [\u60c5\u5831\u610f\u5473\u8ad6(12)\u5f37\u5316\u5b66\u7fd2](http://www.sakurai.comp.ae.keio.ac.jp/classes/infosem-class/2009/12RL.pdf)\n* [Emergent Computation](http://mikilab.doshisha.ac.jp/dia/seminar/2001/pdf/ec_03.pdf)\n* [Q\u5b66\u7fd2\u306b\u3088\u308b\u6700\u77ed\u7d4c\u8def\u5b66\u7fd2](http://d.hatena.ne.jp/poor_code/20090628/1246176165)\n\n\u82f1\u8a9e\u306e\u8cc7\u6599\n\n* [Reinforcement Learning: A User\u2019s Guide](http://www2.econ.iastate.edu/tesfatsi/RLUsersGuide.ICAC2005.pdf)\n* [Introduction to Reinforcement Learning](https://cs.uwaterloo.ca/~ppoupart/ICML-07-tutorial-slides/icml07-brl-tutorial-part2-intro-ghavamzadeh.pdf)\n* [Introduction Reinforcement Learning](http://ssll.cecs.anu.edu.au/files/slides/sanner.pdf)\n\nValue Iteration\u306b\u95a2\u3057\u3066\u56f3\u3092\u4ea4\u3048\u3066\u308f\u304b\u308a\u3084\u3059\u304f\u89e3\u8aac\u3057\u3066\u3044\u308b\u8cc7\u6599\n\n* [Markov Decision Processes and Exact Solution Methods: ](http://people.eecs.berkeley.edu/~pabbeel/cs287-fa12/slides/mdps-exact-methods.pdf)\n* [Markov Decision Processes Value Iteration](http://people.eecs.berkeley.edu/~pabbeel/cs287-fa11/slides/mdps-intro-value-iteration.pdf)\n* [Markov Decision Processes](http://www.ccs.neu.edu/home/rplatt/cs5100_2015/slides/mdps.pdf)\n\n\nValue Iteration\u5b9f\u88c5\u3059\u308b\u3068\u304d\u306b\u53c2\u8003\u306b\u306a\u308b\u8cc7\u6599\n\n* [Artificial Intelligence: Markov Decision Process](http://miromannino.com/artificial-intelligence-markov-decision-process/)\n* [Artificial Intelligence: A Modern Approach](http://aima.cs.berkeley.edu/python/mdp.html)\n* [Value Iteration](http://artint.info/html/ArtInt_227.html)\n* [Pythonic Markov Decision Process (MDP)](https://vrde.wordpress.com/2008/01/13/pythonic-markov-decision-process-mdp/)\n\n\u4fa1\u5024\u95a2\u6570\u306e\u6570\u5f0f\u5c55\u958b\u304c\u4e01\u5be7\n\n* [Reinforcement Learning Searching for optimal policies I:Bellman equations and optimal policies](http://www.cs.upc.edu/~mmartin/Ag4-4x.pdf)\n\n<!--\n\n* https://www.cs.tcd.ie/~luzs/t/cs7032/mdps-notes.pdf\n* http://mas.cs.umass.edu/classes/cs683/lectures-2010/Lec13_MDP2-F2010-4up.pdf\n* http://chercheurs.lille.inria.fr/~lazaric/Webpage/MVA-RL_Course14_files/slides-lecture-02-handout.pdf\n* http://castlelab.princeton.edu/ORF569papers/Powell_ADP_2ndEdition_Chapter%203.pdf\n* http://www.cs.cmu.edu/~guestrin/Class/10701/slides/mdps-rl.pdf\n\n-->\n", "tags": ["Python", "\u5f37\u5316\u5b66\u7fd2", "\u6a5f\u68b0\u5b66\u7fd2"]}