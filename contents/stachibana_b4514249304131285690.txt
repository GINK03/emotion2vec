{"context": "\nLINE Bot Awards\u306e\u7de0\u3081\u5207\u308a\u3082\u9593\u3082\u306a\u304f\u3067\u3059\u306d\u3002\nLINE Bot Awards\n\u4f55\u304b\u3044\u3044\u5bfe\u8a71API\u304c\u306a\u3044\u304b\u8abf\u3079\u3066\u3044\u305f\u6240\u3001Watson Conversation\u304c\u304b\u306a\u308a\u3044\u3044\u7cbe\u5ea6\u3067\u5b66\u7fd2\u6a5f\u80fd\u3082\u3042\u308b\u306e\u3067\u3001LINE BOT\u306b\u7d44\u307f\u8fbc\u3093\u3067\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\nWatson Conversation\u306e\u7279\u5fb4\n\n\u5bfe\u8a71\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u73fe\u3059\u308b\u30b7\u30b9\u30c6\u30e0\n\u81ea\u7136\u8a00\u8a9e\u51e6\u7406\u80fd\u529b\u3092\u5099\u3048\u3066\u3044\u308b\n\u30a4\u30f3\u30c6\u30f3\u30c8(\u610f\u56f3)\u3001\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3(\u5bfe\u8c61)\u3001\u30c0\u30a4\u30a2\u30ed\u30b0(\u30c8\u30ea\u30ac\u30fc+\u30ec\u30b9\u30dd\u30f3\u30b9)\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u5bfe\u8a71\u30b7\u30ca\u30ea\u30aa\u3092\u4f5c\u308b\n\u5bfe\u8a71\u306e\u30b7\u30ca\u30ea\u30aa\u306f\u30d6\u30e9\u30a6\u30b6\u3067\u3002\u5272\u308a\u3068\u4f7f\u3044\u3084\u3059\u3044\u3002\u5c02\u9580\u77e5\u8b58\u4e0d\u8981\n\u5b66\u7fd2\u3082\u540c\u3058\u304f\u3001\u30df\u30b9\u3063\u3066\u308b\u3068\u3053\u308d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u4fee\u6b63\u3057\u3066\u3084\u308c\u3070\u3059\u3050\u306b\u53cd\u6620\n\u30b9\u30af\u30ea\u30d7\u30c8\u66f8\u3044\u3066\u5236\u5fa1\u3059\u308b\u3088\u3046\u306a\u3053\u3068\u3082\u53ef\u80fd\u3002\n\n\n\u767b\u9332\nBluemix\n\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u3063\u3066\u304b\u3089\u3001\u30b5\u30fc\u30d3\u30b9\u306e1\u3064\u3068\u3057\u3066Conversation\u3092\u7d10\u4ed8\u3051\u308b\u5f62\u3002\n\u300c\u7d44\u7e54\u300d\u3092\u4f5c\u308b\u6642\u306b\u7c73\u56fd\u5357\u90e8\u3092\u9078\u629e\u3057\u3066\u304a\u304b\u306a\u3044\u3068\u5f8c\u3067\u30b5\u30fc\u30d3\u30b9\u304c\u884c\u65b9\u4e0d\u660e\u306b\u306a\u308b\u306e\u3067\u6c17\u3092\u3064\u3051\u308b\u3002\n\u7d50\u69cb\u9762\u5012\u304f\u3055\u3044\u3002\n\n\u5bfe\u8a71\u30b7\u30ca\u30ea\u30aa\u306e\u4f5c\u6210\n\u3053\u3053\u306b\u5b8c\u74a7\u306b\u307e\u3068\u307e\u3063\u3066\u3044\u308b\u306e\u3067\u3053\u306e\u901a\u308a\u306b\u3059\u308c\u3070\u7c21\u5358\u3067\u3059\u3002\u611f\u8b1d\u3002\n\nLINE BOT\u3068\u306e\u63a5\u7d9a\nLINE BOT\u3092Heroku\u3068PHP\u3067\u4f5c\u3063\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001Watson Conversation\u306b\u306fPHP\u306eSDK\u304c\u3042\u308a\u307e\u305b\u3093\u3002Java\u3068\u304b\u306f\u3042\u308a\u307e\u3059\u3002\n\u3067\u3059\u304cREST API\u304c\u3042\u308b\u306e\u3067\u3053\u308c\u3092\u4f7f\u3063\u3066\u53e9\u304d\u307e\u3059\u3002\n\u3053\u3093\u306a\u611f\u3058\u3002\n\nindex.php\n<?php\n\nrequire_once __DIR__ . '/vendor/autoload.php';\n\n$httpClient = new \\LINE\\LINEBot\\HTTPClient\\CurlHTTPClient('YOUR_LINEBOT_ACCESS_TOKEN');\n$bot = new \\LINE\\LINEBot($httpClient, ['channelSecret' => 'YOUR_LINEBOT_CHANNEL_SECRET']);\n\n$signature = $_SERVER['HTTP_' . \\LINE\\LINEBot\\Constant\\HTTPHeader::LINE_SIGNATURE];\ntry {\n  $events = $bot->parseEventRequest(file_get_contents('php://input'), $signature);\n} catch(\\LINE\\LINEBot\\Exception\\InvalidSignatureException $e) {\n  error_log('parseEventRequest failed. InvalidSignatureException => '.var_export($e, true));\n} catch(\\LINE\\LINEBot\\Exception\\UnknownEventTypeException $e) {\n  error_log('parseEventRequest failed. UnknownEventTypeException => '.var_export($e, true));\n} catch(\\LINE\\LINEBot\\Exception\\UnknownMessageTypeException $e) {\n  error_log('parseEventRequest failed. UnknownMessageTypeException => '.var_export($e, true));\n} catch(\\LINE\\LINEBot\\Exception\\InvalidEventRequestException $e) {\n  error_log('parseEventRequest failed. InvalidEventRequestException => '.var_export($e, true));\n}\n\nforeach ($events as $event) {\n  if (!($event instanceof \\LINE\\LINEBot\\Event\\MessageEvent)) {\n    error_log('Non message event has come');\n    continue;\n  }\n  if (!($event instanceof \\LINE\\LINEBot\\Event\\MessageEvent\\TextMessage)) {\n    error_log('Non text message has come');\n    continue;\n  }\n\n  $data = array('input' => array(\"text\" => $event->getText()));\n\n  if(getLastConversationData($event->getUserId()) !== PDO::PARAM_NULL) {\n    $lastConversationData = getLastConversationData($event->getUserId());\n\n    $data[\"context\"] = array(\"conversation_id\" => $lastConversationData[\"conversation_id\"],\n      \"system\" => array(\"dialog_stack\" => array(array(\"dialog_node\" => $lastConversationData[\"dialog_node\"])), \n      \"dialog_turn_counter\" => 1,\n      \"dialog_request_counter\" => 1));\n  }\n\n  // https://www.ibmwatsonconversation.com \u3067\u53d6\u5f97\u53ef\u80fd\n  $url = 'https://gateway.watsonplatform.net/conversation/api/v1/workspaces/' . 'YOUR_CONVERSATION_WORKSPACE_ID' . '/message?version=2016-09-20';\n  $curl = curl_init($url);\n\n  $options = array(\n    CURLOPT_HTTPHEADER => array(\n      'Content-Type: application/json',\n    ),\n    // https://console.ng.bluemix.net/ \u3067\u53d6\u5f97\u53ef\u80fd\n    CURLOPT_USERPWD => 'YOUR_BLUEMIX_USERNAME' . ':' . 'YOUR_BLUEMIX_PASSWORD',\n    CURLOPT_POST => true,\n    CURLOPT_POSTFIELDS => json_encode($data),\n    CURLOPT_RETURNTRANSFER => true,\n  );\n\n  curl_setopt_array($curl, $options);\n  $jsonString = curl_exec($curl);\n  $json = json_decode($jsonString, true);\n\n  $conversationId = $json[\"context\"][\"conversation_id\"];\n  $dialogNode = $json[\"context\"][\"system\"][\"dialog_stack\"][0][\"dialog_node\"];\n\n  $conversationData = array('conversation_id' => $conversationId, 'dialog_node' => $dialogNode);\n  setLastConversationData($event->getUserId(), $conversationData);\n\n  $outputText = $json['output']['text'][count($json['output']['text']) - 1];\n\n  replyTextMessage($bot, $event->getReplyToken(), $outputText);\n}\n\nfunction setLastConversationData($userId, $lastConversationData) {\n  $conversationId = $lastConversationData['conversation_id'];\n  $dialogNode = $lastConversationData['dialog_node'];\n\n  // conversation_id\u3068dialog_node\u3092DB\u3068\u304b\u306b\u4fdd\u5b58\n}\n\nfunction getLastConversationData($userId) {\n  // \u4fdd\u5b58\u3057\u3066\u304a\u3044\u305fconversation_id\u3068dialog_node\u3092\u53d6\u5f97\n}\n\n?>\n\n\nconversation_id\u3068dialog_node\u304c\u306a\u3044\u3068\u904e\u53bb\u306e\u4f1a\u8a71\u30c7\u30fc\u30bf\u304c\u53d6\u308c\u306a\u3044\u306e\u3067\u968e\u5c64\u3092\u307e\u305f\u3050\u4f1a\u8a71\u304c\u51fa\u6765\u307e\u305b\u3093\u3002\n\n\u7d50\u679c\n\nLINE BOT\u304b\u3089\u81ea\u5206\u304c\u4f5c\u6210\u3057\u305fWatson Conversation\u306e\u30ef\u30fc\u30af\u30b9\u30da\u30fc\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3001\u5bfe\u8a71\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\u307e\u3068\u3081\n\u30b7\u30ca\u30ea\u30aa\u5bfe\u8a71\u578b\u306e\u30c1\u30e3\u30c3\u30c8\u30dc\u30c3\u30c8\u306f\u3001\u7279\u306b\u96e3\u3057\u3044\u3053\u3068\u3084\u3089\u306a\u304f\u3066\u3082\u30b3\u30f3\u30c6\u30f3\u30c4\u3084\u30bb\u30f3\u30b9\u6b21\u7b2c\u3067\u9762\u767d\u3044\u30dc\u30c3\u30c8\u304c\u4f5c\u308c\u308b\u3068\u601d\u3046\u306e\u3067\u3001\u4f55\u304b\u4f5c\u3063\u3066\u307f\u305f\u3044\u65b9\u306b\u306f\u304a\u3059\u3059\u3081\u3067\u3059\u3002\n\u5c1a\u3001Bot Awards\u306b\u3082\u5bfe\u8a71\u30a8\u30f3\u30b8\u30f3\u90e8\u9580\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n<img src=\"https://cl.ly/201f1k0f410X/8_55.png\" width=50%>\n\nLINE Bot Awards\u306e\u7de0\u3081\u5207\u308a\u3082\u9593\u3082\u306a\u304f\u3067\u3059\u306d\u3002\n[LINE Bot Awards](https://botawards.line.me/ja/)\n\n\u4f55\u304b\u3044\u3044\u5bfe\u8a71API\u304c\u306a\u3044\u304b\u8abf\u3079\u3066\u3044\u305f\u6240\u3001Watson Conversation\u304c\u304b\u306a\u308a\u3044\u3044\u7cbe\u5ea6\u3067\u5b66\u7fd2\u6a5f\u80fd\u3082\u3042\u308b\u306e\u3067\u3001LINE BOT\u306b\u7d44\u307f\u8fbc\u3093\u3067\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\n# Watson Conversation\u306e\u7279\u5fb4\n+ \u5bfe\u8a71\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u73fe\u3059\u308b\u30b7\u30b9\u30c6\u30e0\n+ \u81ea\u7136\u8a00\u8a9e\u51e6\u7406\u80fd\u529b\u3092\u5099\u3048\u3066\u3044\u308b\n+ \u30a4\u30f3\u30c6\u30f3\u30c8(\u610f\u56f3)\u3001\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3(\u5bfe\u8c61)\u3001\u30c0\u30a4\u30a2\u30ed\u30b0(\u30c8\u30ea\u30ac\u30fc+\u30ec\u30b9\u30dd\u30f3\u30b9)\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u5bfe\u8a71\u30b7\u30ca\u30ea\u30aa\u3092\u4f5c\u308b\n+ \u5bfe\u8a71\u306e\u30b7\u30ca\u30ea\u30aa\u306f\u30d6\u30e9\u30a6\u30b6\u3067\u3002\u5272\u308a\u3068\u4f7f\u3044\u3084\u3059\u3044\u3002\u5c02\u9580\u77e5\u8b58\u4e0d\u8981\n+ \u5b66\u7fd2\u3082\u540c\u3058\u304f\u3001\u30df\u30b9\u3063\u3066\u308b\u3068\u3053\u308d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u4fee\u6b63\u3057\u3066\u3084\u308c\u3070\u3059\u3050\u306b\u53cd\u6620\n+ \u30b9\u30af\u30ea\u30d7\u30c8\u66f8\u3044\u3066\u5236\u5fa1\u3059\u308b\u3088\u3046\u306a\u3053\u3068\u3082\u53ef\u80fd\u3002\n\n# \u767b\u9332\n\n[Bluemix](https://console.ng.bluemix.net/)\n\n\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u3063\u3066\u304b\u3089\u3001\u30b5\u30fc\u30d3\u30b9\u306e1\u3064\u3068\u3057\u3066Conversation\u3092\u7d10\u4ed8\u3051\u308b\u5f62\u3002\n\u300c\u7d44\u7e54\u300d\u3092\u4f5c\u308b\u6642\u306b\u7c73\u56fd\u5357\u90e8\u3092\u9078\u629e\u3057\u3066\u304a\u304b\u306a\u3044\u3068\u5f8c\u3067\u30b5\u30fc\u30d3\u30b9\u304c\u884c\u65b9\u4e0d\u660e\u306b\u306a\u308b\u306e\u3067\u6c17\u3092\u3064\u3051\u308b\u3002\n\n\u7d50\u69cb\u9762\u5012\u304f\u3055\u3044\u3002\n\n# \u5bfe\u8a71\u30b7\u30ca\u30ea\u30aa\u306e\u4f5c\u6210\n\n[\u3053\u3053](https://www.ibm.com/developerworks/community/wikis/home?lang=ja#!/wiki/%E3%81%93%E3%81%BF%E3%81%AD%E3%81%AE%E6%8A%80%E8%A1%93%E3%83%A1%E3%83%A2/page/Conversation%20%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%A7%E3%81%AE%E4%BC%9A%E8%A9%B1%E3%83%95%E3%83%AD%E3%83%BC%E4%BD%9C%E6%88%90%E5%AE%9F%E7%BF%92)\u306b\u5b8c\u74a7\u306b\u307e\u3068\u307e\u3063\u3066\u3044\u308b\u306e\u3067\u3053\u306e\u901a\u308a\u306b\u3059\u308c\u3070\u7c21\u5358\u3067\u3059\u3002\u611f\u8b1d\u3002\n\n# LINE BOT\u3068\u306e\u63a5\u7d9a\n\nLINE BOT\u3092Heroku\u3068PHP\u3067\u4f5c\u3063\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001Watson Conversation\u306b\u306fPHP\u306eSDK\u304c\u3042\u308a\u307e\u305b\u3093\u3002Java\u3068\u304b\u306f\u3042\u308a\u307e\u3059\u3002\n\n\u3067\u3059\u304cREST API\u304c\u3042\u308b\u306e\u3067\u3053\u308c\u3092\u4f7f\u3063\u3066\u53e9\u304d\u307e\u3059\u3002\n\n\u3053\u3093\u306a\u611f\u3058\u3002\n\n```php:index.php\n<?php\n\nrequire_once __DIR__ . '/vendor/autoload.php';\n\n$httpClient = new \\LINE\\LINEBot\\HTTPClient\\CurlHTTPClient('YOUR_LINEBOT_ACCESS_TOKEN');\n$bot = new \\LINE\\LINEBot($httpClient, ['channelSecret' => 'YOUR_LINEBOT_CHANNEL_SECRET']);\n\n$signature = $_SERVER['HTTP_' . \\LINE\\LINEBot\\Constant\\HTTPHeader::LINE_SIGNATURE];\ntry {\n  $events = $bot->parseEventRequest(file_get_contents('php://input'), $signature);\n} catch(\\LINE\\LINEBot\\Exception\\InvalidSignatureException $e) {\n  error_log('parseEventRequest failed. InvalidSignatureException => '.var_export($e, true));\n} catch(\\LINE\\LINEBot\\Exception\\UnknownEventTypeException $e) {\n  error_log('parseEventRequest failed. UnknownEventTypeException => '.var_export($e, true));\n} catch(\\LINE\\LINEBot\\Exception\\UnknownMessageTypeException $e) {\n  error_log('parseEventRequest failed. UnknownMessageTypeException => '.var_export($e, true));\n} catch(\\LINE\\LINEBot\\Exception\\InvalidEventRequestException $e) {\n  error_log('parseEventRequest failed. InvalidEventRequestException => '.var_export($e, true));\n}\n\nforeach ($events as $event) {\n  if (!($event instanceof \\LINE\\LINEBot\\Event\\MessageEvent)) {\n    error_log('Non message event has come');\n    continue;\n  }\n  if (!($event instanceof \\LINE\\LINEBot\\Event\\MessageEvent\\TextMessage)) {\n    error_log('Non text message has come');\n    continue;\n  }\n  \n  $data = array('input' => array(\"text\" => $event->getText()));\n  \n  if(getLastConversationData($event->getUserId()) !== PDO::PARAM_NULL) {\n    $lastConversationData = getLastConversationData($event->getUserId());\n    \n    $data[\"context\"] = array(\"conversation_id\" => $lastConversationData[\"conversation_id\"],\n      \"system\" => array(\"dialog_stack\" => array(array(\"dialog_node\" => $lastConversationData[\"dialog_node\"])), \n      \"dialog_turn_counter\" => 1,\n      \"dialog_request_counter\" => 1));\n  }\n\n  // https://www.ibmwatsonconversation.com \u3067\u53d6\u5f97\u53ef\u80fd\n  $url = 'https://gateway.watsonplatform.net/conversation/api/v1/workspaces/' . 'YOUR_CONVERSATION_WORKSPACE_ID' . '/message?version=2016-09-20';\n  $curl = curl_init($url);\n\n  $options = array(\n    CURLOPT_HTTPHEADER => array(\n      'Content-Type: application/json',\n    ),\n    // https://console.ng.bluemix.net/ \u3067\u53d6\u5f97\u53ef\u80fd\n    CURLOPT_USERPWD => 'YOUR_BLUEMIX_USERNAME' . ':' . 'YOUR_BLUEMIX_PASSWORD',\n    CURLOPT_POST => true,\n    CURLOPT_POSTFIELDS => json_encode($data),\n    CURLOPT_RETURNTRANSFER => true,\n  );\n\n  curl_setopt_array($curl, $options);\n  $jsonString = curl_exec($curl);\n  $json = json_decode($jsonString, true);\n\n  $conversationId = $json[\"context\"][\"conversation_id\"];\n  $dialogNode = $json[\"context\"][\"system\"][\"dialog_stack\"][0][\"dialog_node\"];\n  \n  $conversationData = array('conversation_id' => $conversationId, 'dialog_node' => $dialogNode);\n  setLastConversationData($event->getUserId(), $conversationData);\n  \n  $outputText = $json['output']['text'][count($json['output']['text']) - 1];\n  \n  replyTextMessage($bot, $event->getReplyToken(), $outputText);\n}\n\nfunction setLastConversationData($userId, $lastConversationData) {\n  $conversationId = $lastConversationData['conversation_id'];\n  $dialogNode = $lastConversationData['dialog_node'];\n\n  // conversation_id\u3068dialog_node\u3092DB\u3068\u304b\u306b\u4fdd\u5b58\n}\n\nfunction getLastConversationData($userId) {\n  // \u4fdd\u5b58\u3057\u3066\u304a\u3044\u305fconversation_id\u3068dialog_node\u3092\u53d6\u5f97\n}\n\n?>\n```\n\nconversation_id\u3068dialog_node\u304c\u306a\u3044\u3068\u904e\u53bb\u306e\u4f1a\u8a71\u30c7\u30fc\u30bf\u304c\u53d6\u308c\u306a\u3044\u306e\u3067\u968e\u5c64\u3092\u307e\u305f\u3050\u4f1a\u8a71\u304c\u51fa\u6765\u307e\u305b\u3093\u3002\n\n# \u7d50\u679c\n\n<img src=\"https://cl.ly/201f1k0f410X/8_55.png\" width=50%>\n\nLINE BOT\u304b\u3089\u81ea\u5206\u304c\u4f5c\u6210\u3057\u305fWatson Conversation\u306e\u30ef\u30fc\u30af\u30b9\u30da\u30fc\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3001\u5bfe\u8a71\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n# \u307e\u3068\u3081\n\n\u30b7\u30ca\u30ea\u30aa\u5bfe\u8a71\u578b\u306e\u30c1\u30e3\u30c3\u30c8\u30dc\u30c3\u30c8\u306f\u3001\u7279\u306b\u96e3\u3057\u3044\u3053\u3068\u3084\u3089\u306a\u304f\u3066\u3082\u30b3\u30f3\u30c6\u30f3\u30c4\u3084\u30bb\u30f3\u30b9\u6b21\u7b2c\u3067\u9762\u767d\u3044\u30dc\u30c3\u30c8\u304c\u4f5c\u308c\u308b\u3068\u601d\u3046\u306e\u3067\u3001\u4f55\u304b\u4f5c\u3063\u3066\u307f\u305f\u3044\u65b9\u306b\u306f\u304a\u3059\u3059\u3081\u3067\u3059\u3002\n\n\u5c1a\u3001Bot Awards\u306b\u3082\u5bfe\u8a71\u30a8\u30f3\u30b8\u30f3\u90e8\u9580\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n", "tags": ["PHP", "Line", "linebot", "LINEmessagingAPI", "Watson"]}