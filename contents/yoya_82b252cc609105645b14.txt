{"context": " More than 1 year has passed since last update.PHP \u81ea\u4f5c TypedArray \u306e\u95c7\u7248\u3067\u3059\u3002\nPHP \u306e\u914d\u5217\u304c\u6ca2\u5c71\u30e1\u30e2\u30ea\u3092\u4f7f\u3046\u306e\u306f\u4f55\u6545\uff1f\u3068\u3044\u3046\u8a71\u3002(\u30bf\u30a4\u30c8\u30eb\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3002)\n\u95c7\u3068\u3044\u3063\u3066\u3082\u30c0\u30fc\u30af\u30b5\u30a4\u30c9\u3067\u306f\u306a\u304f\u3001\u88cf\u65b9\u3067\u3042\u308b PHP\u5185\u90e8\u5b9f\u88c5(C\u8a00\u8a9e)\u306e\u8a71\u3067\u3059\u3002\u3042\u3068\u3001\u3042\u304f\u307e\u3067 PHP5 \u306e\u8a71\u3067\u3059\u3002PHP7 \u306f\u8272\u3005\u3068\u9055\u3044\u307e\u3059\u3002\n\n\u306f\u3058\u3081\u306b\nPHP \u306e array \u306f\u5358\u306b\u756a\u53f7\u3092\u6307\u5b9a\u3057\u3066\u5024\u3092\u683c\u7d0d\u51fa\u6765\u308b\u3060\u3051\u3067\u306a\u304f\u3002\u6587\u5b57\u5217\u3092\u30ad\u30fc\u306b\u683c\u7d0d\u3057\u3066\u9023\u60f3\u914d\u5217\u3068\u3057\u3066\u4f7f\u3063\u305f\u308a\u3001\u304b\u3064\u683c\u7d0d\u3057\u305f\u9806\u756a\u3067\u53d6\u308a\u51fa\u305b\u305f\u308a\u3068\u3001\u3084\u308a\u3059\u304e\u3068\u3044\u3063\u3066\u826f\u3044\u307b\u3069\u9ad8\u6027\u80fd\u306a\u4ee3\u7269\u3067\u3059\u3002\nC\u8a00\u8a9e\u3067\u306f\u5ba3\u8a00\u3057\u305f\u578b\u306e\u5024\u3092\u756a\u53f7\u6307\u5b9a\u3067\u683c\u7d0d\u3059\u308b\u4e8b\u3057\u304b\u51fa\u6765\u306a\u3044\u306e\u3067\u3001\u305d\u308c\u3089\u3092\u5b9f\u73fe\u3059\u308b\u70ba\u306b\u76f8\u5f53\u9811\u5f35\u3063\u3066\u3044\u307e\u3059\u3002\n\u53c2\u8003\u306e\u70ba\u306b\u3001array \u306e\u7ba1\u7406\u30c7\u30fc\u30bf\u3067\u3042\u308b HashTable \u306e\u69cb\u9020\u4f53\u3092\u5f15\u7528\u3057\u307e\u3059\u3002\n\nHashTable\n\nc\ntypedef struct bucket {\n        ulong h;                                                /* Used for nume\nric indexing */\n        uint nKeyLength;\n        void *pData;\n        void *pDataPtr;\n        struct bucket *pListNext;\n        struct bucket *pListLast;\n        struct bucket *pNext;\n        struct bucket *pLast;\n        const char *arKey;\n} Bucket;\n\ntypedef struct _hashtable {\n        uint nTableSize;\n        uint nTableMask;\n        uint nNumOfElements;\n        ulong nNextFreeElement;\n        Bucket *pInternalPointer;       /* Used for element traversal */\n        Bucket *pListHead;\n        Bucket *pListTail;\n        Bucket **arBuckets;\n        dtor_func_t pDestructor;\n        zend_bool persistent;\n        unsigned char nApplyCount;\n        zend_bool bApplyProtection;\n#if ZEND_DEBUG\n        int inconsistent;\n#endif\n} HashTable;\n\n\n\u56f3\u306b\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u3059\u3002\n\n\u5f15\u7528\u5143) https://drive.google.com/file/d/0B3UKOMH_4lgBUTdjUGxIZ3l1Ukk/view\n\u3086\u308b\u3075\u308f\u306b\u7c21\u7565\u5316\u3057\u305f\u5206\u304b\u308a\u3084\u3059\u3044\u56f3\u3082\u898b\u3064\u3051\u307e\u3057\u305f\u3002\n\n\u5f15\u7528\u5143) https://catchy.io/slides/PHP-Data-Structures-and-the-impact-of-PHP-7-on-them.html\n\u306a\u3093\u3060\u304b\u8272\u3005\u7d61\u307f\u5408\u3063\u3066\u307e\u3059\u3002\u30e1\u30e2\u30ea\u3092\u6ca2\u5c71\u4f7f\u3046\u306e\u306f\u4f55\u3068\u306a\u304f\u30a4\u30e1\u30fc\u30b8\u51fa\u6765\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u3057\u3066\u3001PHP5.3 \u3067\u5c0e\u5165\u3055\u308c\u305f SplFixedArray \u306f\u9577\u3055\u3092\u56fa\u5b9a\u9577\u306b\u3057\u3066\u771f\u3093\u4e2d\u306e\u69cb\u9020\u3092\u3070\u3055\u3063\u3068\u7701\u7565\u3057\u3066\u3001\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u304c\u534a\u5206\u4f4d\u307e\u3067\u6e1b\u3089\u3057\u3066\u307e\u3059\u3002\n\u3067\u3059\u3051\u3069\u6240\u8a6e\u305d\u308c\u3067\u3082\u534a\u5206\u3067\u3059\u3002PHP \u306e\u6a19\u6e96array \u3082 SplFixedArray \u3082\u8981\u7d20\u3068\u3057\u3066\u3069\u3093\u306a\u578b\u3067\u3082\u5165\u308b\u5909\u6570\u30b3\u30f3\u30c6\u30ca\u3068\u3057\u3066\u4fdd\u5b58\u3059\u308b\u70ba\u3067\u3059\u3002\n\nZval \u69cb\u9020\u4f53\nPHP\u306e\u5909\u6570\u30b3\u30f3\u30c6\u30ca\u306f\u3001\u7686\u3055\u3093\u3001\u304a\u99b4\u67d3\u307f\u306e Zval \u69cb\u9020\u4f53\u3068\u3057\u3066\u8868\u73fe\u3055\u308c\u307e\u3059\u3002\n\nphp-5.5.28/Zend/zend.h\ntypedef union _zvalue_value {\n        long lval;                                      /* long value */\n        double dval;                            /* double value */\n        struct {\n                char *val;\n                int len;\n        } str;\n        HashTable *ht;                          /* hash table value */\n        zend_object_value obj;\n} zvalue_value;\n\nstruct _zval_struct {\n        /* Variable information */\n        zvalue_value value;             /* value */\n        zend_uint refcount__gc;\n        zend_uchar type;        /* active type */\n        zend_uchar is_ref__gc;\n};\n\n\nzvalue_value \u306e C\u8a00\u8a9e union(\u5171\u7528\u4f53) \u306f\u5185\u90e8\u3067\u5ba3\u8a00\u3057\u305f\u3069\u306e\u578b\u3067\u3082\u4f7f\u3048\u308b\u3088\u3046\u306b\u3001\u305d\u306e\u4e2d\u3067\u4e00\u756a\u5927\u304d\u306a\u578b\u306b\u5408\u308f\u305b\u3066\u30e1\u30e2\u30ea\u3092\u78ba\u4fdd\u3057\u307e\u3059\u3002\u305d\u306e\u4e0a zval_struct \u306e\u7ba1\u7406\u30c7\u30fc\u30bf\u91cf\u3082\u99ac\u9e7f\u306b\u306a\u308a\u307e\u305b\u3093\u3002\n\n\u5f15\u7528\u5143) http://www.slideshare.net/hnw/yamiphp-20140315/13\n\u3064\u307e\u308a\u3001\u914d\u5217\u8981\u7d20\u306b\u3069\u3093\u306a\u5c0f\u3055\u306a(\u30ec\u30f3\u30b8\u306e)\u5024\u3092\u4fdd\u5b58\u3057\u3066\u3082\u3001\u5909\u6570\u3072\u3068\u3064\u3042\u305f\u308a 24byte(Zval\u69cb\u9020\u4f53) + 8byte(\u30ea\u30b9\u30c8\u304b\u3089\u306e\u30dd\u30a4\u30f3\u30bf)\u306734byte\u304c\u5fc5\u8981\u3068\u3044\u3046\u4e8b\u3067\u3059\u3002\n\nstring (\u6587\u5b57\u5217\u578b)\n\u4e00\u65b9\u3001PHP \u306e string \u306f\u6240\u8a6e zvalue_value \u306e\u4e2d\u306e struct str \u3060\u3051\u3067\u3042\u3063\u3066\u3001char* \u3068 len \u3068\u3044\u3046\u30d9\u30bf\u306a\u69cb\u9020\u3067\u3059\u3002\n\nphp-5.5.28/Zend/zend.h\ntypedef union _zvalue_value {\n\uff1c\u7565\uff1e\n        struct {\n                char *val;\n                int len;\n        } str;\n\n} zvalue_value;\n\n\n\u4fdd\u5b58\u3057\u305f\u3044\u5024\u304c byte \u5358\u4f4d\u3067\u3042\u308c\u3070\u3001\u8907\u6570\u306e byte \u3092 pack \u3057\u3066\u3053\u306e string \u3068\u3057\u3066\u4fdd\u5b58\u3059\u308c\u3070\u30011byte \u306e\u30c7\u30fc\u30bf\u306f 1byte \u5206\u3057\u304b\u6d88\u8cbb\u3057\u307e\u305b\u3093\u3002\narray \u3092\u4f7f\u308f\u305a\u306b string \u3068\u3057\u3066\u683c\u7d0d\u3057\u3066\u7701\u30e1\u30e2\u30ea\u3068\u3044\u3046\u306e\u306f\u4ee5\u524d\u304b\u3089\u3084\u3063\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u914d\u5217\u98a8\u306b\u30a2\u30af\u30bb\u30b9\u51fa\u6765\u308b class \u3092\u4f5c\u3063\u3066\u307f\u305f\u3002\u3068\u3044\u3046\u306e\u304c\u300cPHP \u81ea\u4f5c TypedArray\u300d\u306e\u30cd\u30bf\u3067\u3057\u305f\u3002\nP.S. \u3053\u308c\u306ePHP\u62e1\u5f35\u3092\u4f5c\u3063\u3066\u30a8\u30f3\u30c8\u30ea\u306b\u3059\u308b\u3064\u3082\u308a\u3067\u3057\u305f\u304c\u3001\u3042\u307e\u308a\u9700\u8981\u304c\u306a\u3044\u306e\u3067(\u4eca\u306e\u3068\u3053\u308d\u30b3\u30e1\u30f3\u30c8\u8cb0\u3048\u305f\u306e\u304c2\u540d)\u3001\u305d\u306e\u3046\u3061\u6687\u306b\u306a\u3063\u305f\u3089\u3084\u308a\u307e\u3059\u3002\u3082\u3057\u304f\u306f\u8ab0\u304b\u3084\u3063\u3066\u304f\u3060\u3055\u3044\u3002:-)\n\n[PHP \u81ea\u4f5c TypedArray](http://qiita.com/yoya/items/68634ab031145860938b) \u306e\u95c7\u7248\u3067\u3059\u3002\nPHP \u306e\u914d\u5217\u304c\u6ca2\u5c71\u30e1\u30e2\u30ea\u3092\u4f7f\u3046\u306e\u306f\u4f55\u6545\uff1f\u3068\u3044\u3046\u8a71\u3002(\u30bf\u30a4\u30c8\u30eb\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3002)\n\n\u95c7\u3068\u3044\u3063\u3066\u3082\u30c0\u30fc\u30af\u30b5\u30a4\u30c9\u3067\u306f\u306a\u304f\u3001\u88cf\u65b9\u3067\u3042\u308b PHP\u5185\u90e8\u5b9f\u88c5(C\u8a00\u8a9e)\u306e\u8a71\u3067\u3059\u3002\u3042\u3068\u3001\u3042\u304f\u307e\u3067 PHP5 \u306e\u8a71\u3067\u3059\u3002PHP7 \u306f\u8272\u3005\u3068\u9055\u3044\u307e\u3059\u3002\n\n## \u306f\u3058\u3081\u306b\n\n\n\nPHP \u306e array \u306f\u5358\u306b\u756a\u53f7\u3092\u6307\u5b9a\u3057\u3066\u5024\u3092\u683c\u7d0d\u51fa\u6765\u308b\u3060\u3051\u3067\u306a\u304f\u3002\u6587\u5b57\u5217\u3092\u30ad\u30fc\u306b\u683c\u7d0d\u3057\u3066\u9023\u60f3\u914d\u5217\u3068\u3057\u3066\u4f7f\u3063\u305f\u308a\u3001\u304b\u3064\u683c\u7d0d\u3057\u305f\u9806\u756a\u3067\u53d6\u308a\u51fa\u305b\u305f\u308a\u3068\u3001\u3084\u308a\u3059\u304e\u3068\u3044\u3063\u3066\u826f\u3044\u307b\u3069\u9ad8\u6027\u80fd\u306a\u4ee3\u7269\u3067\u3059\u3002\n\nC\u8a00\u8a9e\u3067\u306f\u5ba3\u8a00\u3057\u305f\u578b\u306e\u5024\u3092\u756a\u53f7\u6307\u5b9a\u3067\u683c\u7d0d\u3059\u308b\u4e8b\u3057\u304b\u51fa\u6765\u306a\u3044\u306e\u3067\u3001\u305d\u308c\u3089\u3092\u5b9f\u73fe\u3059\u308b\u70ba\u306b\u76f8\u5f53\u9811\u5f35\u3063\u3066\u3044\u307e\u3059\u3002\n\u53c2\u8003\u306e\u70ba\u306b\u3001array \u306e\u7ba1\u7406\u30c7\u30fc\u30bf\u3067\u3042\u308b HashTable \u306e\u69cb\u9020\u4f53\u3092\u5f15\u7528\u3057\u307e\u3059\u3002\n\n## HashTable\n\n```c:c:php-5.5.28/Zend/zend_hash.h\ntypedef struct bucket {\n        ulong h;                                                /* Used for nume\nric indexing */\n        uint nKeyLength;\n        void *pData;\n        void *pDataPtr;\n        struct bucket *pListNext;\n        struct bucket *pListLast;\n        struct bucket *pNext;\n        struct bucket *pLast;\n        const char *arKey;\n} Bucket;\n\ntypedef struct _hashtable {\n        uint nTableSize;\n        uint nTableMask;\n        uint nNumOfElements;\n        ulong nNextFreeElement;\n        Bucket *pInternalPointer;       /* Used for element traversal */\n        Bucket *pListHead;\n        Bucket *pListTail;\n        Bucket **arBuckets;\n        dtor_func_t pDestructor;\n        zend_bool persistent;\n        unsigned char nApplyCount;\n        zend_bool bApplyProtection;\n#if ZEND_DEBUG\n        int inconsistent;\n#endif\n} HashTable;\n```\n\n\u56f3\u306b\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u3059\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/1798/9d563e49-471a-f512-dd0e-5e2626fdd0ce.png)\n\u5f15\u7528\u5143) https://drive.google.com/file/d/0B3UKOMH_4lgBUTdjUGxIZ3l1Ukk/view\n\n\u3086\u308b\u3075\u308f\u306b\u7c21\u7565\u5316\u3057\u305f\u5206\u304b\u308a\u3084\u3059\u3044\u56f3\u3082\u898b\u3064\u3051\u307e\u3057\u305f\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/1798/657db0d0-32d0-d3ee-c860-196f8a734972.png)\n\u5f15\u7528\u5143) https://catchy.io/slides/PHP-Data-Structures-and-the-impact-of-PHP-7-on-them.html\n\n\u306a\u3093\u3060\u304b\u8272\u3005\u7d61\u307f\u5408\u3063\u3066\u307e\u3059\u3002\u30e1\u30e2\u30ea\u3092\u6ca2\u5c71\u4f7f\u3046\u306e\u306f\u4f55\u3068\u306a\u304f\u30a4\u30e1\u30fc\u30b8\u51fa\u6765\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u3057\u3066\u3001PHP5.3 \u3067\u5c0e\u5165\u3055\u308c\u305f SplFixedArray \u306f\u9577\u3055\u3092\u56fa\u5b9a\u9577\u306b\u3057\u3066\u771f\u3093\u4e2d\u306e\u69cb\u9020\u3092\u3070\u3055\u3063\u3068\u7701\u7565\u3057\u3066\u3001\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u304c\u534a\u5206\u4f4d\u307e\u3067\u6e1b\u3089\u3057\u3066\u307e\u3059\u3002\n\n\u3067\u3059\u3051\u3069\u6240\u8a6e\u305d\u308c\u3067\u3082\u534a\u5206\u3067\u3059\u3002PHP \u306e\u6a19\u6e96array \u3082 SplFixedArray \u3082\u8981\u7d20\u3068\u3057\u3066\u3069\u3093\u306a\u578b\u3067\u3082\u5165\u308b\u5909\u6570\u30b3\u30f3\u30c6\u30ca\u3068\u3057\u3066\u4fdd\u5b58\u3059\u308b\u70ba\u3067\u3059\u3002\n\n## Zval \u69cb\u9020\u4f53\n\nPHP\u306e\u5909\u6570\u30b3\u30f3\u30c6\u30ca\u306f\u3001\u7686\u3055\u3093\u3001\u304a\u99b4\u67d3\u307f\u306e Zval \u69cb\u9020\u4f53\u3068\u3057\u3066\u8868\u73fe\u3055\u308c\u307e\u3059\u3002\n\n```c:php-5.5.28/Zend/zend.h\ntypedef union _zvalue_value {\n        long lval;                                      /* long value */\n        double dval;                            /* double value */\n        struct {\n                char *val;\n                int len;\n        } str;\n        HashTable *ht;                          /* hash table value */\n        zend_object_value obj;\n} zvalue_value;\n\nstruct _zval_struct {\n        /* Variable information */\n        zvalue_value value;             /* value */\n        zend_uint refcount__gc;\n        zend_uchar type;        /* active type */\n        zend_uchar is_ref__gc;\n};\n```\n\nzvalue_value \u306e C\u8a00\u8a9e union(\u5171\u7528\u4f53) \u306f\u5185\u90e8\u3067\u5ba3\u8a00\u3057\u305f\u3069\u306e\u578b\u3067\u3082\u4f7f\u3048\u308b\u3088\u3046\u306b\u3001\u305d\u306e\u4e2d\u3067\u4e00\u756a\u5927\u304d\u306a\u578b\u306b\u5408\u308f\u305b\u3066\u30e1\u30e2\u30ea\u3092\u78ba\u4fdd\u3057\u307e\u3059\u3002\u305d\u306e\u4e0a zval_struct \u306e\u7ba1\u7406\u30c7\u30fc\u30bf\u91cf\u3082\u99ac\u9e7f\u306b\u306a\u308a\u307e\u305b\u3093\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/1798/08437545-c275-7f85-2ecc-3e17ac8a1c63.png)\n\u5f15\u7528\u5143) http://www.slideshare.net/hnw/yamiphp-20140315/13\n\n\u3064\u307e\u308a\u3001\u914d\u5217\u8981\u7d20\u306b\u3069\u3093\u306a\u5c0f\u3055\u306a(\u30ec\u30f3\u30b8\u306e)\u5024\u3092\u4fdd\u5b58\u3057\u3066\u3082\u3001\u5909\u6570\u3072\u3068\u3064\u3042\u305f\u308a 24byte(Zval\u69cb\u9020\u4f53) + 8byte(\u30ea\u30b9\u30c8\u304b\u3089\u306e\u30dd\u30a4\u30f3\u30bf)\u306734byte\u304c\u5fc5\u8981\u3068\u3044\u3046\u4e8b\u3067\u3059\u3002\n\n## string (\u6587\u5b57\u5217\u578b)\n\n\u4e00\u65b9\u3001PHP \u306e string \u306f\u6240\u8a6e zvalue_value \u306e\u4e2d\u306e struct str \u3060\u3051\u3067\u3042\u3063\u3066\u3001char* \u3068 len \u3068\u3044\u3046\u30d9\u30bf\u306a\u69cb\u9020\u3067\u3059\u3002\n\n```c:php-5.5.28/Zend/zend.h\ntypedef union _zvalue_value {\n\uff1c\u7565\uff1e\n        struct {\n                char *val;\n                int len;\n        } str;\n\n} zvalue_value;\n```\n\n\u4fdd\u5b58\u3057\u305f\u3044\u5024\u304c byte \u5358\u4f4d\u3067\u3042\u308c\u3070\u3001\u8907\u6570\u306e byte \u3092 pack \u3057\u3066\u3053\u306e string \u3068\u3057\u3066\u4fdd\u5b58\u3059\u308c\u3070\u30011byte \u306e\u30c7\u30fc\u30bf\u306f 1byte \u5206\u3057\u304b\u6d88\u8cbb\u3057\u307e\u305b\u3093\u3002\n\narray \u3092\u4f7f\u308f\u305a\u306b string \u3068\u3057\u3066\u683c\u7d0d\u3057\u3066\u7701\u30e1\u30e2\u30ea\u3068\u3044\u3046\u306e\u306f\u4ee5\u524d\u304b\u3089\u3084\u3063\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u914d\u5217\u98a8\u306b\u30a2\u30af\u30bb\u30b9\u51fa\u6765\u308b class \u3092\u4f5c\u3063\u3066\u307f\u305f\u3002\u3068\u3044\u3046\u306e\u304c\u300cPHP \u81ea\u4f5c TypedArray\u300d\u306e\u30cd\u30bf\u3067\u3057\u305f\u3002\n\nP.S. \u3053\u308c\u306ePHP\u62e1\u5f35\u3092\u4f5c\u3063\u3066\u30a8\u30f3\u30c8\u30ea\u306b\u3059\u308b\u3064\u3082\u308a\u3067\u3057\u305f\u304c\u3001\u3042\u307e\u308a\u9700\u8981\u304c\u306a\u3044\u306e\u3067(\u4eca\u306e\u3068\u3053\u308d\u30b3\u30e1\u30f3\u30c8\u8cb0\u3048\u305f\u306e\u304c2\u540d)\u3001\u305d\u306e\u3046\u3061\u6687\u306b\u306a\u3063\u305f\u3089\u3084\u308a\u307e\u3059\u3002\u3082\u3057\u304f\u306f\u8ab0\u304b\u3084\u3063\u3066\u304f\u3060\u3055\u3044\u3002:-)\n", "tags": ["PHP", "array", "\u914d\u5217"]}