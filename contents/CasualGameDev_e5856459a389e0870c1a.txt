{"tags": ["Android", "Lua", "iOS", "cocos2d-x"], "context": " More than 1 year has passed since last update.\n\n\u76ee\u6b21\n1 \u306f\u3058\u3081\u306b\n2 Android\u3068iOS\u306e\u5834\u5408\u3067\u51e6\u7406\u3092\u5206\u3051\u308b\n3 Lua\u304b\u3089Java\u3084Objective-C\u306eAPI\u3092\u547c\u3076\n4 Java\u3084Objective-C\u304b\u3089Lua\u306e\u95a2\u6570\u3092\u547c\u3076\n5 \u4eca\u5f8c\u306e\u4e88\u5b9a\n\n\u306f\u3058\u3081\u306b\n\u672c\u8a18\u4e8b\u306f\u3001cocos2d-x\u304a\u3088\u3073Cocos Code IDE\u3092\u5c0e\u5165\u3057\u3001Android\u3084iPhone\u306e\u5b9f\u6a5f\u7aef\u672b\u3067\u52d5\u304b\u3057\u305f\u4eba\u3067\u3001Android\u3001iOS\u3068\u3044\u3063\u305f\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u6bce\u306b\u51e6\u7406\u3092\u5206\u3051\u305f\u3044\u4eba\u5411\u3051\u306e\u3001\u899a\u66f8\u304d\u3067\u3059\u3002\u4f8b\u3048\u30703rd\u30d1\u30fc\u30c6\u30a3\u306e\u30e9\u30f3\u30ad\u30f3\u30b0\u30b5\u30fc\u30d3\u30b9\u3068\u306e\u7d50\u5408\u3067\u3001Android\u3068iOS\u3067API\u304c\u7570\u306a\u3063\u3066\u304a\u308a\u3001Lua\u304b\u3089\u306f\u76f4\u63a5\u30a2\u30af\u30bb\u30b9\u3067\u304d\u306a\u3044\u5834\u5408\u306b\u6709\u52b9\u3067\u3059\u3002\n\nAndroid\u3068iOS\u3067Lua\u306e\u51e6\u7406\u3092\u5206\u5c90\u3059\u308b\n\nGameScene.lua\n...             \n                if cc.Application:getInstance():getTargetPlatform() == cc.PLATFORM_OS_ANDROID then\n                    -- Android\u306e\u5834\u5408\u306e\u51e6\u7406\u3092\u3053\u3053\u306b\u66f8\u304f\n\n                elseif cc.Application:getInstance():getTargetPlatform() == cc.PLATFORM_OS_IPHONE or \n                    cc.Application:getInstance():getTargetPlatform() == cc.PLATFORM_OS_IPAD then\n                    -- iOS(iPhone\u3001iPad)\u306e\u5834\u5408\u306e\u51e6\u7406\u3092\u3053\u3053\u306b\u66f8\u304f\n\n                end\n...\n\n\n\nLua\u304b\u3089Java\u3084Objective-C\u306eAPI\u3092\u547c\u3076\nCocos Code IDE\n\nGameScene.lua\n... \n                -- \n                self.point = 100\n\n                -- Android\u306e\u5834\u5408\n                if cc.Application:getInstance():getTargetPlatform() == cc.PLATFORM_OS_ANDROID then\n                    -- Lua->Java\u30d6\u30ea\u30c3\u30b8\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8aad\u307f\u8fbc\u3080\n                    local luaj = require \"src/cocos/cocos2d/luaj\"\n                    -- \u547c\u3073\u51fa\u3059\u5bfe\u8c61\u306eJava\u95a2\u6570\u304c\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u30af\u30e9\u30b9\u3092\u8a2d\u5b9a\n                    local className = \"org/cocos2dx/lua/AppActivity\"\n                    -- \u5bfe\u8c61\u306eJava\u95a2\u6570\u3078\u6e21\u3059\u5f15\u6570\u30c7\u30fc\u30bf\u3092\u8a2d\u5b9a\n                    local args ={ self.point }\n                    -- \u547c\u3073\u51fa\u3059Java\u95a2\u6570\u540d\u3092\u6307\u5b9a\u3057\u3066\u3001(I)\u6574\u6570\u578b\u5f15\u6570\u3001V\u623b\u308a\u5024\u306a\u3057\u3067\u547c\u3073\u51fa\u3059\n                    luaj.callStaticMethod(className, \"setScoreJava\", args, '(I)V')\n\n                -- iOS(iPhone\u3001iPad)\u306e\u5834\u5408\n                elseif cc.Application:getInstance():getTargetPlatform() == cc.PLATFORM_OS_IPHONE or \n                    cc.Application:getInstance():getTargetPlatform() == cc.PLATFORM_OS_IPAD then\n                    -- Lua->Objective-C\u30d6\u30ea\u30c3\u30b8\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8aad\u307f\u8fbc\u3080                    \n                    local luaoc = require \"src/cocos/cocos2d/luaoc\"\n                    -- \u5bfe\u8c61\u306eObjC\u95a2\u6570\u3078\u6e21\u3059\u5f15\u6570\u30c7\u30fc\u30bf\u3092\u8a2d\u5b9a\n                    local args = { score = self.point }\n                    -- \u547c\u3073\u51fa\u3059ObjC\u95a2\u6570\u540d\u3092\u6307\u5b9a\u3057\u3066\u547c\u3073\u51fa\u3059\n                    luaoc.callStaticMethod(\"AppController\", \"setScoreObjC\", args ) \n                end\n...\n\n\n(Lua\u2192)Android Java\n\n\nAppActivity.java\n...\nimport org.cocos2dx.lib.Cocos2dxLuaJavaBridge;\n...\npublic class AppActivity extends Cocos2dxActivity{\n...\n    public static void setScoreJava(final int type) {\n             //call 3rd party Ranking API here, but do not forget runOnUiThread IF running into UI thread \n    }\n}\n\n\n(Lua\u2192)iOS ObjC\n\nAppController.h\n...\n// Cocos2dx\u304b\u3089\u30b3\u30fc\u30eb\u3055\u308c\u308b\u95a2\u6570\n+ (void)setScoreObjC:(NSDictionary *)dict;\n...\n\n\n\nAppController.mm\n...\n+ (void)setScoreObjC:(NSDictionary *)dict{\n    if ([dict objectForKey:@\"score\"])\n    {\n        int input = [[dict objectForKey:@\"score\"] intValue];\n        //call 3rd party Ranking API here\n    }\n}\n...\n\n\n\nJava\u3084Objective-C\u304b\u3089Lua\u306e\u95a2\u6570\u3092\u547c\u3076\nCocos Code IDE\n\nGameScene.lua\n...\n    -- Java/ObjC\u304b\u3089\u30ab\u30b9\u30bf\u30e0\u30a4\u30d9\u30f3\u30c8\u3092\u4f7f\u3063\u3066\u547c\u3073\u51fa\u3055\u308c\u308b\n    local listener = cc.EventListenerCustom:create(\"callLuaFunc\",\n        function(event)\n            ...\n        end)\n    local eventDispatcher = layer:getEventDispatcher()\n    eventDispatcher:addEventListenerWithSceneGraphPriority(listener, layer)\n...\n\n-- Java\u304b\u3089\u547c\u3073\u51fa\u3055\u308c\u308b\u30b0\u30ed\u30fc\u30d0\u30eb\u306aLua\u95a2\u6570\nfunction callLuaFunc(param)\n    local evt = cc.EventCustom:new(\"callLuaFunc\")\n    cc.Director:getInstance():getEventDispatcher():dispatchEvent(evt)\nend\n\nreturn GameScene\n\n\nAndroid Java(\u2192Lua)\n\nAppActivity.java\n// Java->Lua\nCocos2dxLuaJavaBridge.callLuaGlobalFunctionWithString(\"callLuaFunc\", \"callLuaFunc\");\n\n\niOS ObjC(\u2192Lua)\n\nAppController.mm\n// ObjC->Lua\ncocos2d::Director::getInstance()->getEventDispatcher()->dispatchCustomEvent(\"callLuaFunc\");\n\n\n\n\u4eca\u5f8c\u306e\u4e88\u5b9a\n\u30df\u30cb\u30b2\u30fc\u30e0\u3067\u4f7f\u3048\u308b\u521d\u671f\u5316\u3001\u30b2\u30fc\u30e0\u958b\u59cb\u3001\u30b2\u30fc\u30e0\u30aa\u30fc\u30d0\u30fc\u3001\u518d\u958b\u3068\u3044\u3063\u305f\u72b6\u614b\u5909\u5316\u306e\u5b9f\u88c5\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\n#\u76ee\u6b21\n1 \u306f\u3058\u3081\u306b\n2 Android\u3068iOS\u306e\u5834\u5408\u3067\u51e6\u7406\u3092\u5206\u3051\u308b\n3 Lua\u304b\u3089Java\u3084Objective-C\u306eAPI\u3092\u547c\u3076\n4 Java\u3084Objective-C\u304b\u3089Lua\u306e\u95a2\u6570\u3092\u547c\u3076\n5 \u4eca\u5f8c\u306e\u4e88\u5b9a\n\n#\u306f\u3058\u3081\u306b\n\u672c\u8a18\u4e8b\u306f\u3001cocos2d-x\u304a\u3088\u3073Cocos Code IDE\u3092\u5c0e\u5165\u3057\u3001Android\u3084iPhone\u306e\u5b9f\u6a5f\u7aef\u672b\u3067\u52d5\u304b\u3057\u305f\u4eba\u3067\u3001Android\u3001iOS\u3068\u3044\u3063\u305f\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u6bce\u306b\u51e6\u7406\u3092\u5206\u3051\u305f\u3044\u4eba\u5411\u3051\u306e\u3001\u899a\u66f8\u304d\u3067\u3059\u3002\u4f8b\u3048\u30703rd\u30d1\u30fc\u30c6\u30a3\u306e\u30e9\u30f3\u30ad\u30f3\u30b0\u30b5\u30fc\u30d3\u30b9\u3068\u306e\u7d50\u5408\u3067\u3001Android\u3068iOS\u3067API\u304c\u7570\u306a\u3063\u3066\u304a\u308a\u3001Lua\u304b\u3089\u306f\u76f4\u63a5\u30a2\u30af\u30bb\u30b9\u3067\u304d\u306a\u3044\u5834\u5408\u306b\u6709\u52b9\u3067\u3059\u3002\n\n#Android\u3068iOS\u3067Lua\u306e\u51e6\u7406\u3092\u5206\u5c90\u3059\u308b\n\n```GameScene.lua\n...             \n                if cc.Application:getInstance():getTargetPlatform() == cc.PLATFORM_OS_ANDROID then\n                    -- Android\u306e\u5834\u5408\u306e\u51e6\u7406\u3092\u3053\u3053\u306b\u66f8\u304f\n\n                elseif cc.Application:getInstance():getTargetPlatform() == cc.PLATFORM_OS_IPHONE or \n                    cc.Application:getInstance():getTargetPlatform() == cc.PLATFORM_OS_IPAD then\n                    -- iOS(iPhone\u3001iPad)\u306e\u5834\u5408\u306e\u51e6\u7406\u3092\u3053\u3053\u306b\u66f8\u304f\n\n                end\n...\n```\n\n#Lua\u304b\u3089Java\u3084Objective-C\u306eAPI\u3092\u547c\u3076\n\nCocos Code IDE\n\n```GameScene.lua\n... \n                -- \n                self.point = 100\n                \n                -- Android\u306e\u5834\u5408\n                if cc.Application:getInstance():getTargetPlatform() == cc.PLATFORM_OS_ANDROID then\n                    -- Lua->Java\u30d6\u30ea\u30c3\u30b8\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8aad\u307f\u8fbc\u3080\n                    local luaj = require \"src/cocos/cocos2d/luaj\"\n                    -- \u547c\u3073\u51fa\u3059\u5bfe\u8c61\u306eJava\u95a2\u6570\u304c\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u30af\u30e9\u30b9\u3092\u8a2d\u5b9a\n                    local className = \"org/cocos2dx/lua/AppActivity\"\n                    -- \u5bfe\u8c61\u306eJava\u95a2\u6570\u3078\u6e21\u3059\u5f15\u6570\u30c7\u30fc\u30bf\u3092\u8a2d\u5b9a\n                    local args ={ self.point }\n                    -- \u547c\u3073\u51fa\u3059Java\u95a2\u6570\u540d\u3092\u6307\u5b9a\u3057\u3066\u3001(I)\u6574\u6570\u578b\u5f15\u6570\u3001V\u623b\u308a\u5024\u306a\u3057\u3067\u547c\u3073\u51fa\u3059\n                    luaj.callStaticMethod(className, \"setScoreJava\", args, '(I)V')\n                \n                -- iOS(iPhone\u3001iPad)\u306e\u5834\u5408\n                elseif cc.Application:getInstance():getTargetPlatform() == cc.PLATFORM_OS_IPHONE or \n                    cc.Application:getInstance():getTargetPlatform() == cc.PLATFORM_OS_IPAD then\n                    -- Lua->Objective-C\u30d6\u30ea\u30c3\u30b8\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8aad\u307f\u8fbc\u3080                    \n                    local luaoc = require \"src/cocos/cocos2d/luaoc\"\n                    -- \u5bfe\u8c61\u306eObjC\u95a2\u6570\u3078\u6e21\u3059\u5f15\u6570\u30c7\u30fc\u30bf\u3092\u8a2d\u5b9a\n                    local args = { score = self.point }\n                    -- \u547c\u3073\u51fa\u3059ObjC\u95a2\u6570\u540d\u3092\u6307\u5b9a\u3057\u3066\u547c\u3073\u51fa\u3059\n                    luaoc.callStaticMethod(\"AppController\", \"setScoreObjC\", args ) \n                end\n...\n```\n\n(Lua\u2192)Android Java\n\n![9-1 AppActivity.png](https://qiita-image-store.s3.amazonaws.com/0/90495/b0cd8c75-fc9e-d8d7-a090-583fd07dd79a.png)\n\n```AppActivity.java\n...\nimport org.cocos2dx.lib.Cocos2dxLuaJavaBridge;\n...\npublic class AppActivity extends Cocos2dxActivity{\n...\n\tpublic static void setScoreJava(final int type) {\n             //call 3rd party Ranking API here, but do not forget runOnUiThread IF running into UI thread \n\t}\n}\n```\n\n(Lua\u2192)iOS ObjC\n\n```AppController.h\n...\n// Cocos2dx\u304b\u3089\u30b3\u30fc\u30eb\u3055\u308c\u308b\u95a2\u6570\n+ (void)setScoreObjC:(NSDictionary *)dict;\n...\n```\n\n```AppController.mm\n...\n+ (void)setScoreObjC:(NSDictionary *)dict{\n    if ([dict objectForKey:@\"score\"])\n    {\n        int input = [[dict objectForKey:@\"score\"] intValue];\n        //call 3rd party Ranking API here\n    }\n}\n...\n```\n\n#Java\u3084Objective-C\u304b\u3089Lua\u306e\u95a2\u6570\u3092\u547c\u3076\n\nCocos Code IDE\n\n```GameScene.lua\n...\n    -- Java/ObjC\u304b\u3089\u30ab\u30b9\u30bf\u30e0\u30a4\u30d9\u30f3\u30c8\u3092\u4f7f\u3063\u3066\u547c\u3073\u51fa\u3055\u308c\u308b\n    local listener = cc.EventListenerCustom:create(\"callLuaFunc\",\n        function(event)\n            ...\n        end)\n    local eventDispatcher = layer:getEventDispatcher()\n    eventDispatcher:addEventListenerWithSceneGraphPriority(listener, layer)\n...\n\n-- Java\u304b\u3089\u547c\u3073\u51fa\u3055\u308c\u308b\u30b0\u30ed\u30fc\u30d0\u30eb\u306aLua\u95a2\u6570\nfunction callLuaFunc(param)\n    local evt = cc.EventCustom:new(\"callLuaFunc\")\n    cc.Director:getInstance():getEventDispatcher():dispatchEvent(evt)\nend\n\nreturn GameScene\n```\n\nAndroid Java(\u2192Lua)\n\n```AppActivity.java\n// Java->Lua\nCocos2dxLuaJavaBridge.callLuaGlobalFunctionWithString(\"callLuaFunc\", \"callLuaFunc\");\n```\n\niOS ObjC(\u2192Lua)\n\n```AppController.mm\n// ObjC->Lua\ncocos2d::Director::getInstance()->getEventDispatcher()->dispatchCustomEvent(\"callLuaFunc\");\n```\n\n#\u4eca\u5f8c\u306e\u4e88\u5b9a\n\u30df\u30cb\u30b2\u30fc\u30e0\u3067\u4f7f\u3048\u308b\u521d\u671f\u5316\u3001\u30b2\u30fc\u30e0\u958b\u59cb\u3001\u30b2\u30fc\u30e0\u30aa\u30fc\u30d0\u30fc\u3001\u518d\u958b\u3068\u3044\u3063\u305f\u72b6\u614b\u5909\u5316\u306e\u5b9f\u88c5\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\n"}