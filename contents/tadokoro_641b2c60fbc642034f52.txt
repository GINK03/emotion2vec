{"tags": ["Erlang", "\u6700\u9069\u5316"], "context": "\n\n\u5148\u306b\u7d50\u8ad6\n\u4f55\u3082\u8003\u3048\u305aErlang\u306e\u8efd\u91cf\u30d7\u30ed\u30bb\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u307e\u304f\u308b\u3068\u901f\u5ea6\u304c\u51fa\u306b\u304f\u3044\u3002\naccept \u3067\u8907\u6570\u5f85\u3061\u53d7\u3051\u305f\u308a\u3001gen_tcp:...\u306a\u3069\u306e\u9ad8\u30ec\u30d9\u30eb\u306a\u547d\u4ee4\u3092\u4f7f\u308f\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u3068\u9ad8\u901f\u5316\u3067\u304d\u308b\u3002\n\n\n\n\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u5bfe\u8c61\nRequest/sec\n\n\n\n\n\u5143\u30d7\u30ed\u30b0\u30e9\u30e0\n15,380\n\n\n\u6700\u9069\u5316\u30d7\u30ed\u30b0\u30e9\u30e0\n64,369\n\n\n\n\u4ee5\u4e0b\u3067\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u306e\u904e\u7a0b\u3092\u898b\u3066\u3044\u304d\u307e\u3059\u3002\n\n\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u5bfe\u8c61\u306e\u5b9f\u88c5\nErlang\u958b\u767a\u74b0\u5883\u304c\u624b\u5143\u306b\u307e\u3060\u306a\u3044\u65b9\u306f\u3053\u3061\u3089\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u74b0\u5883\u3092\u4f5c\u3063\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\nsrc/httpd_tcp_listener.erl\n-module(httpd_tcp_listener).\n\n-export([start_link/0]).\n\nstart_link() ->\n    Pid = spawn_link(fun init/0),\n    {ok, Pid}.\n\ninit() ->\n    Port = 8888,\n    Backlog = 10244,\n    Options = [binary,\n              inet6, % support both ipv4 and ipv6\n              {active, false},\n              {reuseaddr, true},\n              {backlog, Backlog}\n             ],\n    {ok, Listen} = gen_tcp:listen(Port, Options),\n    accept(Listen).\n\naccept(Listen) ->\n    case gen_tcp:accept(Listen) of\n        {ok, Socket} ->\n            {ok, Pid} = httpd_tcp_worker_sup:start_child(Socket),\n            gen_tcp:controlling_process(Socket, Pid);\n        {error, Reason} ->\n            io:format(\"fail accept ~p~n\", [Reason])\n    end,\n    accept(Listen).\n\n\n\nsrc/httpd_tcp_worker.erl\n-module(httpd_tcp_worker).\n\n-export([start_link/1]).\n\nstart_link(Socket)->\n    Pid = spawn_link(fun() -> process(Socket, 0, 30 * 1000) end),\n    {ok, Pid}.\n\nprocess(Socket, Size, Timeout) ->\n    case gen_tcp:recv(Socket, Size, Timeout) of\n        {ok, Packet} ->\n            Response = response(Packet),\n            gen_tcp:send(Socket, Response),\n            gen_tcp:close(Socket);\n        {error, Reason} ->\n            io:format(\"fail recv ~p~n\", [Reason]),\n            gen_tcp:close(Socket)\n    end.\n\nresponse(_Request) ->\n    <<\"HTTP/1.0 200 OK\\r\\nDate: Tue, 25 Oct 2016 10:21:33 GMT\\r\\nConnection: close\\r\\nContent-Type: text/plain; charset=utf-8\\r\\nContent-Length: 11\\r\\n\\r\\nhello world\">>.\n\n\n\nsrc/httpd_tcp_worker_sup.erl\n-module(httpd_tcp_worker_sup).\n\n-export([start_link/0, start_child/1, init/1]).\n\nstart_link() ->\n    supervisor:start_link({local, ?MODULE}, ?MODULE, []).\n\nstart_child(Socket) ->\n    supervisor:start_child(?MODULE, [Socket]).\n\ninit([]) ->\n    Children = [\n                {\"httpd_tcp_worker\", {httpd_tcp_worker, start_link, []}, temporary, 5, worker, []}\n               ],\n    {ok, {{simple_one_for_one, 0, 1}, Children}}.\n\n\n\nsrc/httpd_sup.erl\n%% ...(\u7701\u7565)...\ninit([]) ->\n    Children = [\n                {\"httpd_tcp_listener\", {httpd_tcp_listener, start_link, []}, permanent, 5, worker, []},\n                {\"httpd_tcp_worker_sup\", {httpd_tcp_worker_sup, start_link, []}, permanent, 5, supervisor, []}\n               ],\n    {ok, { {one_for_all, 0, 1}, Children} }.\n\n\n\n\u30d9\u30f3\u30c1\u30de\u30fc\u30af\nHTTP\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u30c4\u30fc\u30ebwrk\u3067\u8a08\u6e2c\u3057\u3066\u307f\u307e\u3059\u3002\n\nwrk\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo apt-get install wrk\n\n\n\nerlang\u30d9\u30f3\u30c1\u30de\u30fc\u30af\nwrk -c 100 -d 10 -t 10 http://localhost/\n#Running 10s test @ http://localhost/\n#  10 threads and 100 connections\n#  Thread Stats   Avg      Stdev     Max   +/- Stdev\n#    Latency     7.32ms   16.20ms 261.95ms   91.41%\n#    Req/Sec     9.09k     2.86k   29.55k    75.05%\n#  910073 requests in 10.10s, 213.46MB read\n#Requests/sec:  90107.61\n#Transfer/sec:     21.14MB\n\n\n\nnginx\u30d9\u30f3\u30c1\u30de\u30fc\u30af\nwrk -c 100 -d 10 -t 10 http://localhost:8888/\n#Running 10s test @ http://localhost:8888/\n#  10 threads and 100 connections\n#  Thread Stats   Avg      Stdev     Max   +/- Stdev\n#    Latency     6.43ms  815.17us  21.68ms   84.57%\n#    Req/Sec     1.56k   184.27     5.17k    98.60%\n#  155320 requests in 10.10s, 21.77MB read\n#Requests/sec:  15380.09\n#Transfer/sec:      2.16MB\n\n\n\n\n\n\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u5bfe\u8c61\nRequest/sec\n\n\n\n\nnginx(\u53c2\u8003)\n90,107\n\n\nerlang\u5b9f\u88c5\n15,380\n\n\n\n\u3059\u308b\u3068\u3001erlang\u306f15,380/\u79d2\u306b\u5bfe\u3057\u3066nginx\u304c90,107/\u79d2\u3067\u3057\u305f\u3002nginx\u306e\u65b9\u304c5.8\u500d\u7a0b\u65e9\u3044\u3088\u3046\u3067\u3059\u3002\n\u6094\u3057\u3044\u306e\u3067\u3053\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u9ad8\u901f\u5316\u3059\u308b\u305f\u3081\u30d7\u30ed\u30d5\u30a1\u30a4\u30ea\u30f3\u30b0\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30ea\u30f3\u30b0\u306e\u4ed5\u65b9\nprofile\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nsrc/httpd_profile.erl\n-module(httpd_profile).                                                                   \n\n-export([run/0]).\n\nrun() ->\n    eprof:start_profiling(processes()),\n    httpd_sup:start_link(),\n\n    timer:sleep(10 * 1000), % \u3053\u3053\u3067\u5f85\u3063\u3066\u3044\u308b\u9593\u306bwrk\u3067\u8ca0\u8377\u3092\u304b\u3051\u307e\u3059\n\n    eprof:stop_profiling(),\n    eprof:analyze(total).\n\n\n\u30b5\u30fc\u30d0\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n../rebar3 compile && erl -pa _build/default/lib/*/ebin -eval 'httpd_profile:run(),init:stop().' -noshell \n\n\u5225\u306eshell\u3067wrk\u3067\u8ca0\u8377\u3092\u304b\u3051\u307e\u3059\u3002\nwrk -c 100 -d 10 -t 1 http://localhost:8888/\n\n\nProfile\u7d50\u679c\u306e\u629c\u7c8b\nFUNCTION                                       CALLS        %   TIME  [uS / CALLS]\n--------                                       -----  -------   ----  [----------]\nhttpd_tcp_worker:process/3                       253     0.03     11  [      0.04]\nhttpd_tcp_worker:response/1                      252     0.06     23  [      0.09]\nhttpd_tcp_worker:'-start_link/1-fun-0-'/1        253     0.06     24  [      0.09]\nhttpd_tcp_listener:accept/1                      254     0.15     59  [      0.23]\nhttpd_tcp_worker:start_link/1                    253     0.21     83  [      0.33]\nhttpd_tcp_worker_sup:start_child/1               254     4.99   2010  [      7.91]\n\n\nstart_child() \u304c\u30cd\u30c3\u30af\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001accept\u3057\u3066spawn\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u4e8b\u524d\u306b\u8907\u6570accept\u3059\u308b\u3088\u3046\u5909\u66f4\u3057\u307e\u3059\u3002\n\nsrc/httpd_tcp_listener.erl\n-module(httpd_tcp_listener).\n\n-export([start_link/0]).\n\nstart_link() ->\n    Pid = spawn_link(fun init/0),\n    {ok, Pid}.\n\ninit() ->\n    Port = 8888,\n    Backlog = 10244,\n    Options = [binary,\n              inet6, % support both ipv4 and ipv6\n              {active, false},\n              {reuseaddr, true},\n              {backlog, Backlog}\n             ],\n    {ok, Listen} = gen_tcp:listen(Port, Options),\n    lists:foreach(fun(_) -> spawn(fun() -> accept(Listen) end) end,  lists:seq(1, 100)),\n    accept(Listen).\n\naccept(Listen) ->\n    case gen_tcp:accept(Listen) of\n        {ok, Socket} ->\n            %{ok, Pid} = httpd_tcp_worker_sup:start_child(Socket),\n            %gen_tcp:controlling_process(Socket, Pid),\n            process(Socket, 0, 10 * 1000),\n            accept(Listen);\n        {error, closed} ->\n            ok;\n        {error, Reason} ->\n            io:format(\"fail accept ~p~n\", [Reason])\n    end.\n\nprocess(Socket, Size, Timeout) ->\n    case gen_tcp:recv(Socket, Size, Timeout) of\n        {ok, Packet} ->\n            Response = response(Packet),\n            gen_tcp:send(Socket, Response),\n            gen_tcp:close(Socket);\n        {error, closed} ->\n            gen_tcp:close(Socket);\n        {error, Reason} ->\n            io:format(\"fail recv ~p~n\", [Reason]),\n            gen_tcp:close(Socket)\n    end.\n\nresponse(_Request) ->\n    <<\"HTTP/1.0 200 OK\\r\\nDate: Tue, 25 Oct 2016 10:21:33 GMT\\r\\nConnection: close\\r\\nContent-Type: text/plain; charset=utf-8\\r\\nContent-Length: 11\\r\\n\\r\\nhello world\">>.   \n\n\n\u3053\u306e\u72b6\u614b\u3067\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u53d6\u3063\u3066\u307f\u307e\u3059\u3002\n\n\u8907\u6570accept\u30d9\u30f3\u30c1\u30de\u30fc\u30af\nwrk -c 100 -d 10 -t 10 http://localhost:8888/\nRunning 10s test @ http://localhost:8888/\n  10 threads and 100 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency     2.22ms    1.69ms  39.34ms   82.43%\n    Req/Sec     4.76k   471.03     8.46k    77.71%\n  475838 requests in 10.09s, 66.71MB read\nRequests/sec:  47155.42\nTransfer/sec:      6.61MB\n\n\n15,380/\u79d2\u304b\u308947,155/\u79d2\u30683\u500d\u8fd1\u304f\u65e9\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n\u307e\u305f\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3057\u3066\u307f\u307e\u3059\u3002\n\nProfile\u7d50\u679c\u306e\u629c\u7c8b\nFUNCTION                                          CALLS        %      TIME  [uS / CALLS]\n--------                                          -----  -------      ----  [----------]\nhttpd_tcp_listener:accept/1                      143313     0.17     32754  [      0.23]\nhttpd_tcp_listener:response/1                    143191     0.30     57481  [      0.40]\nhttpd_tcp_listener:process/3                     143212     0.33     62697  [      0.44]\nprim_inet:type_opt/2                            3293861     5.41   1020978  [      0.31]\nerts_internal:port_close/1                       143228     8.21   1549668  [     10.82]\nerts_internal:port_control/3                    1145802    12.69   2396415  [      2.09]\nerts_internal:port_command/3                     143207    17.96   3390508  [     23.68]\n\n\n\u30a2\u30d7\u30ea\u90e8\u5206\u3068\u306b\u6642\u9593\u304c\u304b\u304b\u3063\u3066\u305d\u3046\u306a\u90e8\u5206\u3068\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u90e8\u5206\u3092\u629c\u7c8b\u3057\u307e\u3057\u305f\u3002\nerts_internal:port_... \u304c\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u3067\u3059\u3002\nport_close\u3068port_command\u306f\u56de\u6570\u304c\u540c\u3058\u3067\u3059\u304c\u3001port_control\u306f\u547c\u3073\u51fa\u3055\u308c\u3066\u3044\u308b\u56de\u6570\u304c10\u500d\u4ee5\u4e0a\u591a\u3044\u306e\u304c\u6c17\u306b\u306a\u308a\u307e\u3059\u3002\ngen_tcp:accept \u304c\u5965\u306e\u65b9\u3067\u5b9f\u884c\u3057\u3066\u3044\u308b prim_inet:async_accept \u3092\u76f4\u63a5\u4f7f\u3063\u3066port_control\u306e\u547c\u3073\u51fa\u3057\u56de\u6570\u3092\u6291\u3048\u307e\u3059\u3002\n\nsrc/httpd_tcp_listener.erl\n-module(httpd_tcp_listener).\n\n-export([start_link/0]).\n\nstart_link() ->\n    Pid = spawn_link(fun init/0),\n    {ok, Pid}.\n\ninit() ->\n    Port = 8888,\n    Backlog = 10244,\n    Options = [binary,\n              inet6, % support both ipv4 and ipv6\n              {active, false},\n              {reuseaddr, true},\n              {backlog, Backlog}\n             ],\n    {ok, Listen} = gen_tcp:listen(Port, Options),\n    lists:foreach(fun(_) -> spawn(fun() -> accept(Listen) end) end,  lists:seq(1, 100)),\n    accept(Listen).\n\naccept(Listen) ->\n    {ok, Ref} = prim_inet:async_accept(Listen, -1),\n    receive\n        {inet_async, Listen, Ref, {ok, Socket}} ->\n            inet_db:register_socket(Socket, inet6_tcp),\n            process(Socket, 0, 10 * 1000),\n            accept(Listen);\n        {inet_async, Listen, Ref,{error,closed}} ->\n            ok;                                                                                                                                                            \n        X -> \n            io:format(\"fail accept ~p~n\", [X])\n    end.\n\nprocess(Socket, Size, Timeout) ->\n    case gen_tcp:recv(Socket, Size, Timeout) of\n        {ok, Packet} ->\n            Response = response(Packet),\n            gen_tcp:send(Socket, Response),\n            gen_tcp:close(Socket);\n        {error, closed} ->\n            gen_tcp:close(Socket);\n        {error, Reason} ->\n            io:format(\"fail recv ~p~n\", [Reason]),\n            gen_tcp:close(Socket)\n    end.\n\nresponse(_Request) ->\n    <<\"HTTP/1.0 200 OK\\r\\nDate: Tue, 25 Oct 2016 10:21:33 GMT\\r\\nConnection: close\\r\\nContent-Type: text/plain; charset=utf-8\\r\\nContent-Length: 11\\r\\n\\r\\nhello world\">>.\n\n\n\u518d\u5ea6\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3002\n\nacync_accept()\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u7d50\u679c\nwrk -c 100 -d 10 -t 10 http://localhost:8888/\n# Running 10s test @ http://localhost:8888/\n#   10 threads and 100 connections\n#   Thread Stats   Avg      Stdev     Max   +/- Stdev\n#     Latency     1.76ms  447.03us  23.40ms   89.45%\n#     Req/Sec     5.63k   483.33    11.85k    88.94%\n#   562511 requests in 10.10s, 78.86MB read\n# Requests/sec:  55704.12\n# Transfer/sec:      7.81MB\n\n\n47,155/\u79d2\u304b\u308955704/\u79d2\u3068\u5c11\u3057\u65e9\u304f\u306a\u308a\u307e\u3057\u305f\u3002\ngen_tcp:close() \u304b\u3089\u3082 erts_internal:port_control() \u304c\u547c\u3070\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u4ee3\u308f\u308a\u306b erlang:port_close() \u3092\u76f4\u63a5\u4f7f\u3046\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\nsrc/httpd_tcp_listener.erl\n-module(httpd_tcp_listener).\n\n-export([start_link/0]).\n\nstart_link() ->\n    Pid = spawn_link(fun init/0),\n    {ok, Pid}.\n\ninit() ->\n    Port = 8888,\n    Backlog = 10244,\n    Options = [binary,\n              inet6, % support both ipv4 and ipv6\n              {active, false},\n              {reuseaddr, true},\n              {backlog, Backlog}\n             ],\n    {ok, Listen} = gen_tcp:listen(Port, Options),\n    lists:foreach(fun(_) -> spawn(fun() -> accept(Listen) end) end,  lists:seq(1, 100)),\n    accept(Listen).\n\naccept(Listen) ->\n    {ok, Ref} = prim_inet:async_accept(Listen, -1),\n    receive\n        {inet_async, Listen, Ref, {ok, Socket}} ->\n            inet_db:register_socket(Socket, inet6_tcp),\n            process(Socket, 0, 10 * 1000),\n            accept(Listen);\n        {inet_async, Listen, Ref,{error,closed}} ->\n            ok;\n        X -> \n            io:format(\"fail accept ~p~n\", [X])\n    end.\n\nprocess(Socket, Size, Timeout) ->\n    case gen_tcp:recv(Socket, Size, Timeout) of\n        {ok, Packet} ->\n            Response = response(Packet),\n            gen_tcp:send(Socket, Response);\n        {error, closed} ->\n            ok;\n        {error, Reason} ->\n            io:format(\"fail recv ~p~n\", [Reason])\n    end,\n    catch erlang:port_close(Socket).\n\nresponse(_Request) ->\n    <<\"HTTP/1.0 200 OK\\r\\nDate: Tue, 25 Oct 2016 10:21:33 GMT\\r\\nConnection: close\\r\\nContent-Type: text/plain; charset=utf-8\\r\\nContent-Length: 11\\r\\n\\r\\nhello world\">>.\n\n\n\u307e\u305f\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3002\n\nport_close\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u7d50\u679c\nwrk -c 100 -d 10 -t 10 http://localhost:8888/\n# Running 10s test @ http://localhost:8888/\n#   10 threads and 100 connections\n#   Thread Stats   Avg      Stdev     Max   +/- Stdev\n#     Latency     1.63ms    1.23ms  26.66ms   88.33%\n#     Req/Sec     6.51k   766.23    18.27k    88.05%\n#   650089 requests in 10.10s, 91.14MB read\n# Requests/sec:  64369.12\n# Transfer/sec:      9.02MB\n\n\n55704/\u79d2\u304b\u308964,369/\u79d2\u3068\u3055\u3089\u306b\u5c11\u3057\u65e9\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n\u3053\u306e\u8fba\u308a\u3067\u6700\u9069\u5316\u306f\u6b62\u3081\u3066\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u7d50\u679c\u3092\u307e\u3068\u3081\u3066\u307f\u307e\u3059\u3002\n\n\n\n\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u5bfe\u8c61\nRequest/sec\n\n\n\n\nnginx(\u53c2\u8003)\n90,107\n\n\naccept\u6bce\u306bspawn\n15,380\n\n\n\u8907\u6570accept\n47,155\n\n\ngen_tcp:accept() \u306e\u4ee3\u308f\u308a\u306b prim_inet:acync_accept()\n55,704\n\n\ngen_tcp:close() \u306e\u4ee3\u308f\u308a\u306b erlang:port_close\n64,369\n\n\n\n\n\u307e\u3068\u3081\nErlang\u8a00\u8a9e\u3092\u4f7f\u3048\u3070\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30b5\u30fc\u30d0\u304c\u6bd4\u8f03\u7684\u7c21\u5358\u306b\u66f8\u3051\u308b\u3088\u3046\u3067\u3059\u3002\n\u307e\u305f\u30d7\u30ed\u30d5\u30a1\u30a4\u30ea\u30f3\u30b0\u3068\u6539\u5584\u3092\u7e70\u308a\u8fd4\u305b\u3070C\u8a00\u8a9e\u3067\u5b9f\u88c5\u3055\u308c\u305fnginx\u306b\u8feb\u308b\u6027\u80fd\u304c\u3067\u308b\u3053\u3068\u3082\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\u6700\u5f8c\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3067HTTP\u30ea\u30af\u30a8\u30b9\u30c8\u3092100\u56de\u5b9f\u884c\u3057\u305f\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u7d50\u679c\u3092\u8f09\u305b\u3066\u304a\u304d\u307e\u3059\u3002\n\nProfile\u7d50\u679c\nFUNCTION                                       CALLS        %  TIME  [uS / CALLS]\n--------                                       -----  -------  ----  [----------]\ngen:start/6                                        2     0.00     0  [      0.00]\ngen:do_spawn/6                                     2     0.00     0  [      0.00]\ngen:init_it/7                                      2     0.00     0  [      0.00]\ngen:init_it2/7                                     2     0.00     0  [      0.00]\ngen:call/4                                         1     0.00     0  [      0.00]\ngen:do_call/4                                      1     0.00     0  [      0.00]\ngen:do_for_proc/2                                  1     0.00     0  [      0.00]\ngen:where/1                                        2     0.00     0  [      0.00]\ngen:register_name/1                                2     0.00     0  [      0.00]\ngen:name/1                                         2     0.00     0  [      0.00]\ngen:spawn_opts/1                                   2     0.00     0  [      0.00]\ngen:debug_options/2                                2     0.00     0  [      0.00]\ngen:'-call/4-fun-0-'/4                             1     0.00     0  [      0.00]\napplication:get_env/2                              1     0.00     0  [      0.00]\nprim_file:get_cwd/0                                3     0.00     0  [      0.00]\nprim_file:get_cwd_int/1                            3     0.00     0  [      0.00]\nprim_file:handle_fname_response/1                  3     0.00     0  [      0.00]\nprim_file:'-get_cwd_int/2-fun-0-'/1                3     0.00     0  [      0.00]\nlists:reverse/1                                    7     0.00     0  [      0.00]\nlists:seq/2                                        1     0.00     0  [      0.00]\nlists:keydelete/3                                  3     0.00     0  [      0.00]\ncode_server:call/1                                 6     0.00     0  [      0.00]\ncode_server:try_load_module_2/6                    6     0.00     0  [      0.00]\ncode_server:load_file_1/3                          6     0.00     0  [      0.00]\ncode_server:absname/1                              3     0.00     0  [      0.00]\ncode_server:absname/2                              3     0.00     0  [      0.00]\ncode_server:'-ensure_loaded/3-fun-0-'/4            6     0.00     0  [      0.00]\nhttpd_sup:start_link/0                             1     0.00     0  [      0.00]\nhttpd_sup:init/1                                   1     0.00     0  [      0.00]\nfilename:absname_join/2                            3     0.00     0  [      0.00]\nfilename:join/2                                    3     0.00     0  [      0.00]\nfilename:maybe_remove_dirsep/2                     3     0.00     0  [      0.00]\nfilename:major_os_type/0                           3     0.00     0  [      0.00]\nfilename:flatten/1                                 3     0.00     0  [      0.00]\ncode:ensure_loaded/1                               6     0.00     0  [      0.00]\ncode:call/1                                        6     0.00     0  [      0.00]\ninet6_tcp:getserv/1                                1     0.00     0  [      0.00]\ninet6_tcp:translate_ip/1                           1     0.00     0  [      0.00]\ninet6_tcp:send/2                                 100     0.00     0  [      0.00]\ninet6_tcp:listen/2                                 1     0.00     0  [      0.00]\nhttpd_tcp_worker_sup:start_link/0                  1     0.00     0  [      0.00]\nhttpd_tcp_worker_sup:init/1                        1     0.00     0  [      0.00]\nerror_logger_tty_h:handle_event/2                  2     0.00     0  [      0.00]\nerror_logger_tty_h:tag_event/1                     2     0.00     0  [      0.00]\nerror_logger_tty_h:do_write_event/2                2     0.00     0  [      0.00]\ngen_event:notify/2                                 2     0.00     0  [      0.00]\ngen_event:loop/5                                   2     0.00     0  [      0.00]\ngen_event:fetch_msg/5                              2     0.00     0  [      0.00]\ngen_event:handle_msg/5                             2     0.00     0  [      0.00]\nprim_inet:open/4                                   1     0.00     0  [      0.00]\nprim_inet:open/6                                   1     0.00     0  [      0.00]\nprim_inet:enc_family/1                             1     0.00     0  [      0.00]\nprim_inet:enc_type/1                               1     0.00     0  [      0.00]\nprim_inet:protocol2drv/1                           1     0.00     0  [      0.00]\nprim_inet:bind/3                                   2     0.00     0  [      0.00]\nprim_inet:listen/2                                 1     0.00     0  [      0.00]\nprim_inet:recv/3                                 102     0.00     0  [      0.00]\nprim_inet:setopts/2                                2     0.00     0  [      0.00]\nprim_inet:is_sockopt_val/2                         3     0.00     0  [      0.00]\nprim_inet:enc_opt/1                                3     0.00     0  [      0.00]\nprim_inet:type_value_default/3                     7     0.00     0  [      0.00]\nprim_inet:type_value_1/3                           7     0.00     0  [      0.00]\nprim_inet:enc_value/3                              4     0.00     0  [      0.00]\nprim_inet:enc_value_default/3                      4     0.00     0  [      0.00]\nprim_inet:enc_value_1/3                            4     0.00     0  [      0.00]\nprim_inet:enc_value_2/2                            4     0.00     0  [      0.00]\nprim_inet:encode_opt_val/1                         2     0.00     0  [      0.00]\nprim_inet:enc_opt_val/2                            5     0.00     0  [      0.00]\nprim_inet:enc_opt_val/4                            3     0.00     0  [      0.00]\nprim_inet:ip6_to_bytes/1                           1     0.00     0  [      0.00]\nhttpd_tcp_listener:start_link/0                    1     0.00     0  [      0.00]\nhttpd_tcp_listener:init/0                          1     0.00     0  [      0.00]\nhttpd_tcp_listener:response/1                    100     0.00     0  [      0.00]\nhttpd_tcp_listener:'-init/0-fun-0-'/1            100     0.00     0  [      0.00]\nhttpd_tcp_listener:'-start_link/0-fun-0-'/0        1     0.00     0  [      0.00]\nerlang:spawn_link/1                                1     0.00     0  [      0.00]\nerlang:spawn_opt/4                                 2     0.00     0  [      0.00]\ninet:listen_options/0                              1     0.00     0  [      0.00]\ninet:listen_options/2                              1     0.00     0  [      0.00]\ninet:list_add/5                                    3     0.00     0  [      0.00]\ninet:tcp_module/1                                  1     0.00     0  [      0.00]\ninet:tcp_module_1/2                                1     0.00     0  [      0.00]\ninet:add_opt/4                                     3     0.00     0  [      0.00]\ninet:translate_ip/2                                1     0.00     0  [      0.00]\ninet:mod/4                                         1     0.00     0  [      0.00]\ninet:mod/7                                         1     0.00     0  [      0.00]\ninet:open/8                                        1     0.00     0  [      0.00]\ninet:bind/3                                        1     0.00     0  [      0.00]\nproc_lib:spawn_opt/4                               2     0.00     0  [      0.00]\nproc_lib:check_for_monitor/1                       2     0.00     0  [      0.00]\nproc_lib:ensure_link/1                             2     0.00     0  [      0.00]\nproc_lib:init_p/5                                  2     0.00     0  [      0.00]\nproc_lib:init_p_do_apply/3                         2     0.00     0  [      0.00]\nproc_lib:start_link/5                              2     0.00     0  [      0.00]\nproc_lib:sync_wait/2                               2     0.00     0  [      0.00]\nproc_lib:init_ack/2                                2     0.00     0  [      0.00]\nproc_lib:trans_init/3                              2     0.00     0  [      0.00]\nproc_lib:get_my_name/0                             2     0.00     0  [      0.00]\nproc_lib:get_ancestors/0                           2     0.00     0  [      0.00]\nproc_lib:proc_info/2                               2     0.00     0  [      0.00]\ngen_server:start_link/4                            2     0.00     0  [      0.00]\ngen_server:call/3                                  1     0.00     0  [      0.00]\ngen_server:init_it/6                               2     0.00     0  [      0.00]\ngen_server:loop/6                                  2     0.00     0  [      0.00]\nerror_logger:info_report/2                         2     0.00     0  [      0.00]\nerror_logger:notify/1                              2     0.00     0  [      0.00]\napplication_controller:get_env/2                   1     0.00     0  [      0.00]\nsupervisor:start_link/3                            2     0.00     0  [      0.00]\nsupervisor:init/1                                  2     0.00     0  [      0.00]\nsupervisor:init_children/2                         1     0.00     0  [      0.00]\nsupervisor:init_dynamic/2                          1     0.00     0  [      0.00]\nsupervisor:start_children/2                        1     0.00     0  [      0.00]\nsupervisor:start_children/3                        3     0.00     0  [      0.00]\nsupervisor:init_state/4                            2     0.00     0  [      0.00]\nsupervisor:set_flags/2                             2     0.00     0  [      0.00]\nsupervisor:check_flags/1                           4     0.00     0  [      0.00]\nsupervisor:do_check_flags/1                        2     0.00     0  [      0.00]\nsupervisor:validStrategy/1                         2     0.00     0  [      0.00]\nsupervisor:validIntensity/1                        2     0.00     0  [      0.00]\nsupervisor:validPeriod/1                           2     0.00     0  [      0.00]\nsupervisor:supname/2                               2     0.00     0  [      0.00]\nsupervisor:check_startspec/1                       2     0.00     0  [      0.00]\nsupervisor:check_startspec/2                       5     0.00     0  [      0.00]\nsupervisor:do_check_childspec/1                    3     0.00     0  [      0.00]\nsupervisor:validChildType/1                        3     0.00     0  [      0.00]\nsupervisor:validName/1                             3     0.00     0  [      0.00]\nsupervisor:validFunc/1                             3     0.00     0  [      0.00]\nsupervisor:validRestartType/1                      3     0.00     0  [      0.00]\nsupervisor:validShutdown/1                         3     0.00     0  [      0.00]\nsupervisor:report_progress/2                       2     0.00     0  [      0.00]\nerl_prim_loader:get_cwd/0                          3     0.00     0  [      0.00]\nerl_prim_loader:handle_get_cwd/2                   3     0.00     0  [      0.00]\nerl_prim_loader:efile_get_cwd/2                    3     0.00     0  [      0.00]\nerl_prim_loader:'-handle_get_cwd/2-fun-0-'/2       3     0.00     0  [      0.00]\ngen_tcp:listen/2                                   1     0.00     0  [      0.00]\nlists:keymember/3                                  3     0.00     0  [      0.00]\nlists:member/2                                     7     0.00     0  [      0.00]\nerlang:put/2                                       4     0.00     0  [      0.00]\nerlang:process_info/2                              2     0.00     0  [      0.00]\nerlang:process_flag/2                              2     0.00     0  [      0.00]\nerlang:group_leader/0                              2     0.00     0  [      0.00]\nprim_file:get_cwd_int/2                            3     0.02     1  [      0.33]\nlists:keydelete3/3                                 7     0.02     1  [      0.14]\nerror_handler:undefined_function/3                 6     0.02     1  [      0.17]\nerror_handler:ensure_loaded/1                      6     0.02     1  [      0.17]\ncode_server:is_sticky/2                            6     0.02     1  [      0.17]\ncode_server:try_load_module_1/5                    6     0.02     1  [      0.17]\ncode_server:try_load_module_3/6                    6     0.02     1  [      0.17]\ncode_server:post_beam_load/3                       6     0.02     1  [      0.17]\ncode_server:ensure_loaded/3                        6     0.02     1  [      0.17]\ncode_server:handle_pending_on_load/4               6     0.02     1  [      0.17]\ncode_server:'-try_load_module_3/6-fun-0-'/5        6     0.02     1  [      0.17]\nfilename:unix_pathtype/1                          12     0.02     1  [      0.08]\nerror_logger_tty_h:parse_event/1                   2     0.02     1  [      0.50]\ngen_event:server_notify/4                          6     0.02     1  [      0.17]\ngen_event:server_update/4                          4     0.02     1  [      0.25]\nprim_inet:type_opt/2                               6     0.02     1  [      0.17]\nprim_inet:type_opt_1/1                             6     0.02     1  [      0.17]\nprim_inet:type_value/3                             7     0.02     1  [      0.14]\ninet:list_opt/3                                    6     0.02     1  [      0.17]\ninet:mod/6                                         6     0.02     1  [      0.17]\ninit:objfile_extension/0                          13     0.02     1  [      0.08]\ntimer:sleep/1                                      1     0.02     1  [      1.00]\nerror_logger:handle_event/2                        2     0.02     1  [      0.50]\nsupervisor:do_start_child/2                        2     0.02     1  [      0.50]\nsupervisor:check_childspec/1                       6     0.02     1  [      0.17]\nsupervisor:extract_child/1                         2     0.02     1  [      0.50]\nerl_prim_loader:prim_get_cwd/2                     3     0.02     1  [      0.33]\nmaps:merge/2                                       5     0.02     1  [      0.20]\nprim_file:internal_native2name/1                   3     0.02     1  [      0.33]\nlists:keyfind/3                                   12     0.02     1  [      0.08]\nets:lookup/2                                       1     0.02     1  [      1.00]\nerlang:universaltime/0                             2     0.02     1  [      0.50]\nerlang:spawn_link/3                                1     0.02     1  [      1.00]\nerlang:register/2                                  2     0.02     1  [      0.50]\nerlang:function_exported/3                         6     0.02     1  [      0.17]\ngen:timeout/1                                      2     0.04     2  [      1.00]\nprim_file:drv_command/3                           16     0.04     2  [      0.13]\ncode_server:handle_on_load/5                       6     0.04     2  [      0.33]\ngen_event:send/2                                   2     0.04     2  [      1.00]\nprim_inet:recv0/3                                102     0.04     2  [      0.02]\nprim_inet:enum_val/2                               9     0.04     2  [      0.22]\nerlang:load_module/2                               6     0.04     2  [      0.33]\ninit:archive_extension/0                          13     0.04     2  [      0.15]\nsupervisor:validMods/1                             3     0.04     2  [      0.67]\nerl_prim_loader:check_file_result/3               16     0.04     2  [      0.13]\nerl_prim_loader:efile_get_file_from_port2/2       13     0.04     2  [      0.15]\nerl_prim_loader:'-handle_get_file/3-fun-0-'/3     13     0.04     2  [      0.15]\nprim_file:close/1                                 13     0.06     3  [      0.23]\nprim_file:drv_close/1                             16     0.06     3  [      0.19]\nprim_file:drv_command/2                           13     0.06     3  [      0.23]\nprim_file:drv_get_response/1                      16     0.06     3  [      0.19]\nprim_file:'-drv_command/4-after$^0/0-0-'/1        16     0.06     3  [      0.19]\nprim_file:'-drv_close/1-after$^0/0-0-'/1          16     0.06     3  [      0.19]\nfilename:append/2                                 13     0.06     3  [      0.23]\nerl_prim_loader:handle_get_file/3                 13     0.06     3  [      0.23]\nerl_prim_loader:efile_get_file_from_port/3        13     0.06     3  [      0.23]\nerl_prim_loader:is_basename/1                     13     0.06     3  [      0.23]\nerlang:iolist_size/1                              13     0.06     3  [      0.23]\nlists:reverse/2                                   18     0.06     3  [      0.17]\nerlang:port_get_data/1                           202     0.06     3  [      0.01]\nerlang:list_to_atom/1                              7     0.06     3  [      0.43]\nprim_file:read_file/2                             13     0.08     4  [      0.31]\nprim_file:drv_command/4                           19     0.08     4  [      0.21]\nprim_file:drv_get_response/2                      16     0.08     4  [      0.25]\nprim_file:translate_response/2                    16     0.08     4  [      0.25]\nprim_file:pathname/1                              13     0.08     4  [      0.31]\ncode_server:handle_call/3                          6     0.08     4  [      0.67]\ncode_server:mod_to_bin/2                          13     0.08     4  [      0.31]\ncode_server:objfile_extension/0                   13     0.08     4  [      0.31]\nfilename:pathtype/1                               12     0.08     4  [      0.33]\nos:type/0                                         15     0.08     4  [      0.27]\nprim_inet:type_value_2/2                           9     0.08     4  [      0.44]\nerlang:open_port/2                                17     0.08     4  [      0.24]\nerlang:port_command/2                             16     0.08     4  [      0.25]\nerl_prim_loader:get_file/1                        13     0.08     4  [      0.31]\nerl_prim_loader:request/1                         16     0.08     4  [      0.25]\nerl_prim_loader:prim_get_file/2                   13     0.08     4  [      0.31]\nerl_prim_loader:reverse/1                         13     0.08     4  [      0.31]\nerl_prim_loader:name_split/2                      13     0.08     4  [      0.31]\nprim_file:internal_name2native/1                  13     0.08     4  [      0.31]\nerlang:spawn_opt/1                                 2     0.08     4  [      2.00]\nerlang:setelement/3                               34     0.08     4  [      0.12]\nerlang:atom_to_list/1                             13     0.08     4  [      0.31]\nprim_file:drv_open/2                              16     0.10     5  [      0.31]\nlists:seq_loop/3                                  26     0.10     5  [      0.19]\nerlang:port_command/3                            100     0.10     5  [      0.05]\nerlang:system_info/1                              21     0.10     5  [      0.24]\nerlang:'++'/2                                     26     0.12     6  [      0.23]\nerlang:port_set_data/2                           103     0.12     6  [      0.06]\nerlang:module_loaded/1                            18     0.12     6  [      0.33]\nhttpd_tcp_listener:process/3                     102     0.14     7  [      0.07]\nerlang:port_close/1                              118     0.14     7  [      0.06]\nerl_prim_loader:deep_member/2                     52     0.14     7  [      0.13]\nerlang:demonitor/2                                 7     0.14     7  [      1.00]\nprim_inet:send/3                                 100     0.17     9  [      0.09]\ngen_tcp:send/2                                   100     0.17     9  [      0.09]\ninet6_tcp:recv/3                                 102     0.19    10  [      0.10]\nerlang:spawn/1                                   100     0.19    10  [      0.10]\nprim_file:read_file/1                             13     0.21    11  [      0.85]\ngen_tcp:recv/3                                   102     0.21    11  [      0.11]\nets:insert/2                                       6     0.21    11  [      1.83]\ncode_server:reply/2                                6     0.25    13  [      2.17]\ninet_db:register_socket/2                        103     0.27    14  [      0.14]\nerl_prim_loader:handle_request/3                  16     0.27    14  [      0.88]\nerlang:monitor/2                                   7     0.27    14  [      2.00]\nerlang:send/3                                      1     0.29    15  [     15.00]\nerlang:whereis/1                                  25     0.35    18  [      0.72]\nerl_prim_loader:debug/2                           32     0.37    19  [      0.59]\nerlang:bump_reductions/1                          16     0.37    19  [      1.19]\nlists:foreach/2                                  104     0.39    20  [      0.19]\nhttpd_tcp_listener:'-init/0-fun-1-'/2            100     0.41    21  [      0.21]\nprim_inet:async_recv/3                           102     0.52    27  [      0.26]\ninet_db:lookup_socket/1                          202     0.56    29  [      0.14]\nerl_prim_loader:loop/3                            16     0.58    30  [      1.88]\nfilename:join1/4                                 302     0.60    31  [      0.10]\nerl_prim_loader:is_prefix/2                       78     0.64    33  [      0.42]\nerlang:apply/2                                   101     0.66    34  [      0.34]\nerts_internal:open_port/2                         17     0.70    36  [      2.12]\nfilename:do_flatten/2                            155     1.05    54  [      0.35]\nerl_prim_loader:archive_split/3                  567     1.28    66  [      0.12]\nprim_inet:ctl_cmd/3                              310     1.44    74  [      0.24]\nerlang:spawn/3                                   100     1.55    80  [      0.80]\nprim_inet:enc_time/1                             305     1.63    84  [      0.28]\nerlang:port_control/3                            310     2.39   123  [      0.40]\nhttpd_tcp_listener:accept/1                      203     2.42   125  [      0.62]\ncode_server:loop/1                                 6     3.43   177  [     29.50]\nprim_inet:async_accept/2                         203     3.59   185  [      0.91]\nerts_internal:port_close/1                       118    10.88   561  [      4.75]\nerlang:prepare_loading/2                           6    12.30   634  [    105.67]\nerts_internal:port_control/3                     310    12.70   655  [      2.11]\nerlang:finish_loading/1                            6    13.91   717  [    119.50]\nerts_internal:port_command/3                     116    17.61   908  [      7.83]\n---------------------------------------------  -----  -------  ----  [----------]\nTotal:                                          6854  100.00%  5156  [      0.75]\n\n\n\n\n## \u5148\u306b\u7d50\u8ad6\n\u4f55\u3082\u8003\u3048\u305aErlang\u306e\u8efd\u91cf\u30d7\u30ed\u30bb\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u307e\u304f\u308b\u3068\u901f\u5ea6\u304c\u51fa\u306b\u304f\u3044\u3002\naccept \u3067\u8907\u6570\u5f85\u3061\u53d7\u3051\u305f\u308a\u3001gen_tcp:...\u306a\u3069\u306e\u9ad8\u30ec\u30d9\u30eb\u306a\u547d\u4ee4\u3092\u4f7f\u308f\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u3068\u9ad8\u901f\u5316\u3067\u304d\u308b\u3002\n\n| \u30d9\u30f3\u30c1\u30de\u30fc\u30af\u5bfe\u8c61                                     | Request/sec   |\n|------------------------------------------------------|---------------|\n| \u5143\u30d7\u30ed\u30b0\u30e9\u30e0                                      | 15,380        |\n| \u6700\u9069\u5316\u30d7\u30ed\u30b0\u30e9\u30e0         | 64,369        |\n\n\n\u4ee5\u4e0b\u3067\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u306e\u904e\u7a0b\u3092\u898b\u3066\u3044\u304d\u307e\u3059\u3002\n\n## \u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u5bfe\u8c61\u306e\u5b9f\u88c5\nErlang\u958b\u767a\u74b0\u5883\u304c\u624b\u5143\u306b\u307e\u3060\u306a\u3044\u65b9\u306f[\u3053\u3061\u3089\u306e\u8a18\u4e8b](http://qiita.com/tadokoro/items/27fca7dd136d10e05f1e)\u3092\u53c2\u8003\u306b\u74b0\u5883\u3092\u4f5c\u3063\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\n```erlang:src/httpd_tcp_listener.erl\n-module(httpd_tcp_listener).\n\n-export([start_link/0]).\n\nstart_link() ->\n    Pid = spawn_link(fun init/0),\n    {ok, Pid}.\n\ninit() ->\n    Port = 8888,\n    Backlog = 10244,\n    Options = [binary,\n              inet6, % support both ipv4 and ipv6\n              {active, false},\n              {reuseaddr, true},\n              {backlog, Backlog}\n             ],\n    {ok, Listen} = gen_tcp:listen(Port, Options),\n    accept(Listen).\n\naccept(Listen) ->\n    case gen_tcp:accept(Listen) of\n        {ok, Socket} ->\n            {ok, Pid} = httpd_tcp_worker_sup:start_child(Socket),\n            gen_tcp:controlling_process(Socket, Pid);\n        {error, Reason} ->\n            io:format(\"fail accept ~p~n\", [Reason])\n    end,\n    accept(Listen).\n```\n\n```erlang:src/httpd_tcp_worker.erl\n-module(httpd_tcp_worker).\n\n-export([start_link/1]).\n\nstart_link(Socket)->\n    Pid = spawn_link(fun() -> process(Socket, 0, 30 * 1000) end),\n    {ok, Pid}.\n\nprocess(Socket, Size, Timeout) ->\n    case gen_tcp:recv(Socket, Size, Timeout) of\n        {ok, Packet} ->\n            Response = response(Packet),\n            gen_tcp:send(Socket, Response),\n            gen_tcp:close(Socket);\n        {error, Reason} ->\n            io:format(\"fail recv ~p~n\", [Reason]),\n            gen_tcp:close(Socket)\n    end.\n\nresponse(_Request) ->\n    <<\"HTTP/1.0 200 OK\\r\\nDate: Tue, 25 Oct 2016 10:21:33 GMT\\r\\nConnection: close\\r\\nContent-Type: text/plain; charset=utf-8\\r\\nContent-Length: 11\\r\\n\\r\\nhello world\">>.\n```\n\n```erlang:src/httpd_tcp_worker_sup.erl\n-module(httpd_tcp_worker_sup).\n\n-export([start_link/0, start_child/1, init/1]).\n\nstart_link() ->\n    supervisor:start_link({local, ?MODULE}, ?MODULE, []).\n\nstart_child(Socket) ->\n    supervisor:start_child(?MODULE, [Socket]).\n\ninit([]) ->\n    Children = [\n                {\"httpd_tcp_worker\", {httpd_tcp_worker, start_link, []}, temporary, 5, worker, []}\n               ],\n    {ok, {{simple_one_for_one, 0, 1}, Children}}.\n```\n\n```erlang:src/httpd_sup.erl\n%% ...(\u7701\u7565)...\ninit([]) ->\n    Children = [\n                {\"httpd_tcp_listener\", {httpd_tcp_listener, start_link, []}, permanent, 5, worker, []},\n                {\"httpd_tcp_worker_sup\", {httpd_tcp_worker_sup, start_link, []}, permanent, 5, supervisor, []}\n               ],\n    {ok, { {one_for_all, 0, 1}, Children} }.\n```\n\n\n## \u30d9\u30f3\u30c1\u30de\u30fc\u30af\nHTTP\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u30c4\u30fc\u30ebwrk\u3067\u8a08\u6e2c\u3057\u3066\u307f\u307e\u3059\u3002\n\n```shell-session:wrk\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo apt-get install wrk\n```\n\n```shell-session:erlang\u30d9\u30f3\u30c1\u30de\u30fc\u30af\nwrk -c 100 -d 10 -t 10 http://localhost/\n#Running 10s test @ http://localhost/\n#  10 threads and 100 connections\n#  Thread Stats   Avg      Stdev     Max   +/- Stdev\n#    Latency     7.32ms   16.20ms 261.95ms   91.41%\n#    Req/Sec     9.09k     2.86k   29.55k    75.05%\n#  910073 requests in 10.10s, 213.46MB read\n#Requests/sec:  90107.61\n#Transfer/sec:     21.14MB\n```\n\n```shell-session:nginx\u30d9\u30f3\u30c1\u30de\u30fc\u30af\nwrk -c 100 -d 10 -t 10 http://localhost:8888/\n#Running 10s test @ http://localhost:8888/\n#  10 threads and 100 connections\n#  Thread Stats   Avg      Stdev     Max   +/- Stdev\n#    Latency     6.43ms  815.17us  21.68ms   84.57%\n#    Req/Sec     1.56k   184.27     5.17k    98.60%\n#  155320 requests in 10.10s, 21.77MB read\n#Requests/sec:  15380.09\n#Transfer/sec:      2.16MB\n```\n\n| \u30d9\u30f3\u30c1\u30de\u30fc\u30af\u5bfe\u8c61                                     | Request/sec   |\n|------------------------------------------------------|---------------|\n| nginx(\u53c2\u8003)                                                | 90,107        |\n| erlang\u5b9f\u88c5                                      | 15,380        |\n\n\n\u3059\u308b\u3068\u3001erlang\u306f15,380/\u79d2\u306b\u5bfe\u3057\u3066nginx\u304c90,107/\u79d2\u3067\u3057\u305f\u3002nginx\u306e\u65b9\u304c5.8\u500d\u7a0b\u65e9\u3044\u3088\u3046\u3067\u3059\u3002\n\u6094\u3057\u3044\u306e\u3067\u3053\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u9ad8\u901f\u5316\u3059\u308b\u305f\u3081\u30d7\u30ed\u30d5\u30a1\u30a4\u30ea\u30f3\u30b0\u3057\u3066\u307f\u307e\u3059\u3002\n\n\n## \u30d7\u30ed\u30d5\u30a1\u30a4\u30ea\u30f3\u30b0\u306e\u4ed5\u65b9\n\nprofile\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```erlang:src/httpd_profile.erl\n-module(httpd_profile).                                                                   \n\n-export([run/0]).\n\nrun() ->\n    eprof:start_profiling(processes()),\n    httpd_sup:start_link(),\n\n    timer:sleep(10 * 1000), % \u3053\u3053\u3067\u5f85\u3063\u3066\u3044\u308b\u9593\u306bwrk\u3067\u8ca0\u8377\u3092\u304b\u3051\u307e\u3059\n    \n    eprof:stop_profiling(),\n    eprof:analyze(total).\n```\n\n\u30b5\u30fc\u30d0\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```shell-session\n../rebar3 compile && erl -pa _build/default/lib/*/ebin -eval 'httpd_profile:run(),init:stop().' -noshell \n```\n\n\u5225\u306eshell\u3067wrk\u3067\u8ca0\u8377\u3092\u304b\u3051\u307e\u3059\u3002\n\n```shell-session\nwrk -c 100 -d 10 -t 1 http://localhost:8888/\n```\n\n```text:Profile\u7d50\u679c\u306e\u629c\u7c8b\nFUNCTION                                       CALLS        %   TIME  [uS / CALLS]\n--------                                       -----  -------   ----  [----------]\nhttpd_tcp_worker:process/3                       253     0.03     11  [      0.04]\nhttpd_tcp_worker:response/1                      252     0.06     23  [      0.09]\nhttpd_tcp_worker:'-start_link/1-fun-0-'/1        253     0.06     24  [      0.09]\nhttpd_tcp_listener:accept/1                      254     0.15     59  [      0.23]\nhttpd_tcp_worker:start_link/1                    253     0.21     83  [      0.33]\nhttpd_tcp_worker_sup:start_child/1               254     4.99   2010  [      7.91]\n```\n\nstart_child() \u304c\u30cd\u30c3\u30af\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001accept\u3057\u3066spawn\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u4e8b\u524d\u306b\u8907\u6570accept\u3059\u308b\u3088\u3046\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```erlang:src/httpd_tcp_listener.erl\n-module(httpd_tcp_listener).\n\n-export([start_link/0]).\n\nstart_link() ->\n    Pid = spawn_link(fun init/0),\n    {ok, Pid}.\n\ninit() ->\n    Port = 8888,\n    Backlog = 10244,\n    Options = [binary,\n              inet6, % support both ipv4 and ipv6\n              {active, false},\n              {reuseaddr, true},\n              {backlog, Backlog}\n             ],\n    {ok, Listen} = gen_tcp:listen(Port, Options),\n    lists:foreach(fun(_) -> spawn(fun() -> accept(Listen) end) end,  lists:seq(1, 100)),\n    accept(Listen).\n\naccept(Listen) ->\n    case gen_tcp:accept(Listen) of\n        {ok, Socket} ->\n            %{ok, Pid} = httpd_tcp_worker_sup:start_child(Socket),\n            %gen_tcp:controlling_process(Socket, Pid),\n            process(Socket, 0, 10 * 1000),\n            accept(Listen);\n        {error, closed} ->\n            ok;\n        {error, Reason} ->\n            io:format(\"fail accept ~p~n\", [Reason])\n    end.\n\nprocess(Socket, Size, Timeout) ->\n    case gen_tcp:recv(Socket, Size, Timeout) of\n        {ok, Packet} ->\n            Response = response(Packet),\n            gen_tcp:send(Socket, Response),\n            gen_tcp:close(Socket);\n        {error, closed} ->\n            gen_tcp:close(Socket);\n        {error, Reason} ->\n            io:format(\"fail recv ~p~n\", [Reason]),\n            gen_tcp:close(Socket)\n    end.\n\nresponse(_Request) ->\n    <<\"HTTP/1.0 200 OK\\r\\nDate: Tue, 25 Oct 2016 10:21:33 GMT\\r\\nConnection: close\\r\\nContent-Type: text/plain; charset=utf-8\\r\\nContent-Length: 11\\r\\n\\r\\nhello world\">>.   \n```\n\n\u3053\u306e\u72b6\u614b\u3067\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u53d6\u3063\u3066\u307f\u307e\u3059\u3002\n\n```shell-session:\u8907\u6570accept\u30d9\u30f3\u30c1\u30de\u30fc\u30af\nwrk -c 100 -d 10 -t 10 http://localhost:8888/\nRunning 10s test @ http://localhost:8888/\n  10 threads and 100 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency     2.22ms    1.69ms  39.34ms   82.43%\n    Req/Sec     4.76k   471.03     8.46k    77.71%\n  475838 requests in 10.09s, 66.71MB read\nRequests/sec:  47155.42\nTransfer/sec:      6.61MB\n```\n\n15,380/\u79d2\u304b\u308947,155/\u79d2\u30683\u500d\u8fd1\u304f\u65e9\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n\u307e\u305f\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3057\u3066\u307f\u307e\u3059\u3002\n\n```text:Profile\u7d50\u679c\u306e\u629c\u7c8b\nFUNCTION                                          CALLS        %      TIME  [uS / CALLS]\n--------                                          -----  -------      ----  [----------]\nhttpd_tcp_listener:accept/1                      143313     0.17     32754  [      0.23]\nhttpd_tcp_listener:response/1                    143191     0.30     57481  [      0.40]\nhttpd_tcp_listener:process/3                     143212     0.33     62697  [      0.44]\nprim_inet:type_opt/2                            3293861     5.41   1020978  [      0.31]\nerts_internal:port_close/1                       143228     8.21   1549668  [     10.82]\nerts_internal:port_control/3                    1145802    12.69   2396415  [      2.09]\nerts_internal:port_command/3                     143207    17.96   3390508  [     23.68]\n```\n\n\u30a2\u30d7\u30ea\u90e8\u5206\u3068\u306b\u6642\u9593\u304c\u304b\u304b\u3063\u3066\u305d\u3046\u306a\u90e8\u5206\u3068\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u90e8\u5206\u3092\u629c\u7c8b\u3057\u307e\u3057\u305f\u3002\nerts_internal:port_... \u304c\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u3067\u3059\u3002\nport_close\u3068port_command\u306f\u56de\u6570\u304c\u540c\u3058\u3067\u3059\u304c\u3001port_control\u306f\u547c\u3073\u51fa\u3055\u308c\u3066\u3044\u308b\u56de\u6570\u304c10\u500d\u4ee5\u4e0a\u591a\u3044\u306e\u304c\u6c17\u306b\u306a\u308a\u307e\u3059\u3002\ngen_tcp:accept \u304c\u5965\u306e\u65b9\u3067\u5b9f\u884c\u3057\u3066\u3044\u308b prim_inet:async_accept \u3092\u76f4\u63a5\u4f7f\u3063\u3066port_control\u306e\u547c\u3073\u51fa\u3057\u56de\u6570\u3092\u6291\u3048\u307e\u3059\u3002\n\n```erlang:src/httpd_tcp_listener.erl \n-module(httpd_tcp_listener).\n\n-export([start_link/0]).\n\nstart_link() ->\n    Pid = spawn_link(fun init/0),\n    {ok, Pid}.\n\ninit() ->\n    Port = 8888,\n    Backlog = 10244,\n    Options = [binary,\n              inet6, % support both ipv4 and ipv6\n              {active, false},\n              {reuseaddr, true},\n              {backlog, Backlog}\n             ],\n    {ok, Listen} = gen_tcp:listen(Port, Options),\n    lists:foreach(fun(_) -> spawn(fun() -> accept(Listen) end) end,  lists:seq(1, 100)),\n    accept(Listen).\n\naccept(Listen) ->\n    {ok, Ref} = prim_inet:async_accept(Listen, -1),\n    receive\n        {inet_async, Listen, Ref, {ok, Socket}} ->\n            inet_db:register_socket(Socket, inet6_tcp),\n            process(Socket, 0, 10 * 1000),\n            accept(Listen);\n        {inet_async, Listen, Ref,{error,closed}} ->\n            ok;                                                                                                                                                            \n        X -> \n            io:format(\"fail accept ~p~n\", [X])\n    end.\n        \nprocess(Socket, Size, Timeout) ->\n    case gen_tcp:recv(Socket, Size, Timeout) of\n        {ok, Packet} ->\n            Response = response(Packet),\n            gen_tcp:send(Socket, Response),\n            gen_tcp:close(Socket);\n        {error, closed} ->\n            gen_tcp:close(Socket);\n        {error, Reason} ->\n            io:format(\"fail recv ~p~n\", [Reason]),\n            gen_tcp:close(Socket)\n    end.\n            \nresponse(_Request) ->\n    <<\"HTTP/1.0 200 OK\\r\\nDate: Tue, 25 Oct 2016 10:21:33 GMT\\r\\nConnection: close\\r\\nContent-Type: text/plain; charset=utf-8\\r\\nContent-Length: 11\\r\\n\\r\\nhello world\">>.\n```\n\n\u518d\u5ea6\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3002\n\n```shell-session:acync_accept()\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u7d50\u679c\nwrk -c 100 -d 10 -t 10 http://localhost:8888/\n# Running 10s test @ http://localhost:8888/\n#   10 threads and 100 connections\n#   Thread Stats   Avg      Stdev     Max   +/- Stdev\n#     Latency     1.76ms  447.03us  23.40ms   89.45%\n#     Req/Sec     5.63k   483.33    11.85k    88.94%\n#   562511 requests in 10.10s, 78.86MB read\n# Requests/sec:  55704.12\n# Transfer/sec:      7.81MB\n```\n\n47,155/\u79d2\u304b\u308955704/\u79d2\u3068\u5c11\u3057\u65e9\u304f\u306a\u308a\u307e\u3057\u305f\u3002\ngen_tcp:close() \u304b\u3089\u3082 erts_internal:port_control() \u304c\u547c\u3070\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u4ee3\u308f\u308a\u306b erlang:port_close() \u3092\u76f4\u63a5\u4f7f\u3046\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```erlang:src/httpd_tcp_listener.erl\n-module(httpd_tcp_listener).\n\n-export([start_link/0]).\n\nstart_link() ->\n    Pid = spawn_link(fun init/0),\n    {ok, Pid}.\n\ninit() ->\n    Port = 8888,\n    Backlog = 10244,\n    Options = [binary,\n              inet6, % support both ipv4 and ipv6\n              {active, false},\n              {reuseaddr, true},\n              {backlog, Backlog}\n             ],\n    {ok, Listen} = gen_tcp:listen(Port, Options),\n    lists:foreach(fun(_) -> spawn(fun() -> accept(Listen) end) end,  lists:seq(1, 100)),\n    accept(Listen).\n\naccept(Listen) ->\n    {ok, Ref} = prim_inet:async_accept(Listen, -1),\n\treceive\n\t\t{inet_async, Listen, Ref, {ok, Socket}} ->\n\t\t\tinet_db:register_socket(Socket, inet6_tcp),\n\t\t\tprocess(Socket, 0, 10 * 1000),\n\t\t\taccept(Listen);\n\t\t{inet_async, Listen, Ref,{error,closed}} ->\n\t\t\tok;\n\t\tX -> \n            io:format(\"fail accept ~p~n\", [X])\n\tend.\n\nprocess(Socket, Size, Timeout) ->\n    case gen_tcp:recv(Socket, Size, Timeout) of\n        {ok, Packet} ->\n            Response = response(Packet),\n            gen_tcp:send(Socket, Response);\n        {error, closed} ->\n\t\t\tok;\n        {error, Reason} ->\n            io:format(\"fail recv ~p~n\", [Reason])\n    end,\n\tcatch erlang:port_close(Socket).\n\nresponse(_Request) ->\n    <<\"HTTP/1.0 200 OK\\r\\nDate: Tue, 25 Oct 2016 10:21:33 GMT\\r\\nConnection: close\\r\\nContent-Type: text/plain; charset=utf-8\\r\\nContent-Length: 11\\r\\n\\r\\nhello world\">>.\n```\n\n\u307e\u305f\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3002\n\n```shell-session:port_close\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u7d50\u679c\nwrk -c 100 -d 10 -t 10 http://localhost:8888/\n# Running 10s test @ http://localhost:8888/\n#   10 threads and 100 connections\n#   Thread Stats   Avg      Stdev     Max   +/- Stdev\n#     Latency     1.63ms    1.23ms  26.66ms   88.33%\n#     Req/Sec     6.51k   766.23    18.27k    88.05%\n#   650089 requests in 10.10s, 91.14MB read\n# Requests/sec:  64369.12\n# Transfer/sec:      9.02MB\n```\n\n55704/\u79d2\u304b\u308964,369/\u79d2\u3068\u3055\u3089\u306b\u5c11\u3057\u65e9\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n\u3053\u306e\u8fba\u308a\u3067\u6700\u9069\u5316\u306f\u6b62\u3081\u3066\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u7d50\u679c\u3092\u307e\u3068\u3081\u3066\u307f\u307e\u3059\u3002\n\n| \u30d9\u30f3\u30c1\u30de\u30fc\u30af\u5bfe\u8c61                                     | Request/sec   |\n|------------------------------------------------------|---------------|\n| nginx(\u53c2\u8003)                                                | 90,107        |\n| accept\u6bce\u306bspawn                                      | 15,380        |\n| \u8907\u6570accept                                           | 47,155        |\n| gen_tcp:accept() \u306e\u4ee3\u308f\u308a\u306b prim_inet:acync_accept() | 55,704        |\n| gen_tcp:close() \u306e\u4ee3\u308f\u308a\u306b erlang:port_close         | 64,369        |\n\n\n## \u307e\u3068\u3081\nErlang\u8a00\u8a9e\u3092\u4f7f\u3048\u3070\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30b5\u30fc\u30d0\u304c\u6bd4\u8f03\u7684\u7c21\u5358\u306b\u66f8\u3051\u308b\u3088\u3046\u3067\u3059\u3002\n\u307e\u305f\u30d7\u30ed\u30d5\u30a1\u30a4\u30ea\u30f3\u30b0\u3068\u6539\u5584\u3092\u7e70\u308a\u8fd4\u305b\u3070C\u8a00\u8a9e\u3067\u5b9f\u88c5\u3055\u308c\u305fnginx\u306b\u8feb\u308b\u6027\u80fd\u304c\u3067\u308b\u3053\u3068\u3082\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\n\u6700\u5f8c\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3067HTTP\u30ea\u30af\u30a8\u30b9\u30c8\u3092100\u56de\u5b9f\u884c\u3057\u305f\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u7d50\u679c\u3092\u8f09\u305b\u3066\u304a\u304d\u307e\u3059\u3002\n\n```text:Profile\u7d50\u679c\nFUNCTION                                       CALLS        %  TIME  [uS / CALLS]\n--------                                       -----  -------  ----  [----------]\ngen:start/6                                        2     0.00     0  [      0.00]\ngen:do_spawn/6                                     2     0.00     0  [      0.00]\ngen:init_it/7                                      2     0.00     0  [      0.00]\ngen:init_it2/7                                     2     0.00     0  [      0.00]\ngen:call/4                                         1     0.00     0  [      0.00]\ngen:do_call/4                                      1     0.00     0  [      0.00]\ngen:do_for_proc/2                                  1     0.00     0  [      0.00]\ngen:where/1                                        2     0.00     0  [      0.00]\ngen:register_name/1                                2     0.00     0  [      0.00]\ngen:name/1                                         2     0.00     0  [      0.00]\ngen:spawn_opts/1                                   2     0.00     0  [      0.00]\ngen:debug_options/2                                2     0.00     0  [      0.00]\ngen:'-call/4-fun-0-'/4                             1     0.00     0  [      0.00]\napplication:get_env/2                              1     0.00     0  [      0.00]\nprim_file:get_cwd/0                                3     0.00     0  [      0.00]\nprim_file:get_cwd_int/1                            3     0.00     0  [      0.00]\nprim_file:handle_fname_response/1                  3     0.00     0  [      0.00]\nprim_file:'-get_cwd_int/2-fun-0-'/1                3     0.00     0  [      0.00]\nlists:reverse/1                                    7     0.00     0  [      0.00]\nlists:seq/2                                        1     0.00     0  [      0.00]\nlists:keydelete/3                                  3     0.00     0  [      0.00]\ncode_server:call/1                                 6     0.00     0  [      0.00]\ncode_server:try_load_module_2/6                    6     0.00     0  [      0.00]\ncode_server:load_file_1/3                          6     0.00     0  [      0.00]\ncode_server:absname/1                              3     0.00     0  [      0.00]\ncode_server:absname/2                              3     0.00     0  [      0.00]\ncode_server:'-ensure_loaded/3-fun-0-'/4            6     0.00     0  [      0.00]\nhttpd_sup:start_link/0                             1     0.00     0  [      0.00]\nhttpd_sup:init/1                                   1     0.00     0  [      0.00]\nfilename:absname_join/2                            3     0.00     0  [      0.00]\nfilename:join/2                                    3     0.00     0  [      0.00]\nfilename:maybe_remove_dirsep/2                     3     0.00     0  [      0.00]\nfilename:major_os_type/0                           3     0.00     0  [      0.00]\nfilename:flatten/1                                 3     0.00     0  [      0.00]\ncode:ensure_loaded/1                               6     0.00     0  [      0.00]\ncode:call/1                                        6     0.00     0  [      0.00]\ninet6_tcp:getserv/1                                1     0.00     0  [      0.00]\ninet6_tcp:translate_ip/1                           1     0.00     0  [      0.00]\ninet6_tcp:send/2                                 100     0.00     0  [      0.00]\ninet6_tcp:listen/2                                 1     0.00     0  [      0.00]\nhttpd_tcp_worker_sup:start_link/0                  1     0.00     0  [      0.00]\nhttpd_tcp_worker_sup:init/1                        1     0.00     0  [      0.00]\nerror_logger_tty_h:handle_event/2                  2     0.00     0  [      0.00]\nerror_logger_tty_h:tag_event/1                     2     0.00     0  [      0.00]\nerror_logger_tty_h:do_write_event/2                2     0.00     0  [      0.00]\ngen_event:notify/2                                 2     0.00     0  [      0.00]\ngen_event:loop/5                                   2     0.00     0  [      0.00]\ngen_event:fetch_msg/5                              2     0.00     0  [      0.00]\ngen_event:handle_msg/5                             2     0.00     0  [      0.00]\nprim_inet:open/4                                   1     0.00     0  [      0.00]\nprim_inet:open/6                                   1     0.00     0  [      0.00]\nprim_inet:enc_family/1                             1     0.00     0  [      0.00]\nprim_inet:enc_type/1                               1     0.00     0  [      0.00]\nprim_inet:protocol2drv/1                           1     0.00     0  [      0.00]\nprim_inet:bind/3                                   2     0.00     0  [      0.00]\nprim_inet:listen/2                                 1     0.00     0  [      0.00]\nprim_inet:recv/3                                 102     0.00     0  [      0.00]\nprim_inet:setopts/2                                2     0.00     0  [      0.00]\nprim_inet:is_sockopt_val/2                         3     0.00     0  [      0.00]\nprim_inet:enc_opt/1                                3     0.00     0  [      0.00]\nprim_inet:type_value_default/3                     7     0.00     0  [      0.00]\nprim_inet:type_value_1/3                           7     0.00     0  [      0.00]\nprim_inet:enc_value/3                              4     0.00     0  [      0.00]\nprim_inet:enc_value_default/3                      4     0.00     0  [      0.00]\nprim_inet:enc_value_1/3                            4     0.00     0  [      0.00]\nprim_inet:enc_value_2/2                            4     0.00     0  [      0.00]\nprim_inet:encode_opt_val/1                         2     0.00     0  [      0.00]\nprim_inet:enc_opt_val/2                            5     0.00     0  [      0.00]\nprim_inet:enc_opt_val/4                            3     0.00     0  [      0.00]\nprim_inet:ip6_to_bytes/1                           1     0.00     0  [      0.00]\nhttpd_tcp_listener:start_link/0                    1     0.00     0  [      0.00]\nhttpd_tcp_listener:init/0                          1     0.00     0  [      0.00]\nhttpd_tcp_listener:response/1                    100     0.00     0  [      0.00]\nhttpd_tcp_listener:'-init/0-fun-0-'/1            100     0.00     0  [      0.00]\nhttpd_tcp_listener:'-start_link/0-fun-0-'/0        1     0.00     0  [      0.00]\nerlang:spawn_link/1                                1     0.00     0  [      0.00]\nerlang:spawn_opt/4                                 2     0.00     0  [      0.00]\ninet:listen_options/0                              1     0.00     0  [      0.00]\ninet:listen_options/2                              1     0.00     0  [      0.00]\ninet:list_add/5                                    3     0.00     0  [      0.00]\ninet:tcp_module/1                                  1     0.00     0  [      0.00]\ninet:tcp_module_1/2                                1     0.00     0  [      0.00]\ninet:add_opt/4                                     3     0.00     0  [      0.00]\ninet:translate_ip/2                                1     0.00     0  [      0.00]\ninet:mod/4                                         1     0.00     0  [      0.00]\ninet:mod/7                                         1     0.00     0  [      0.00]\ninet:open/8                                        1     0.00     0  [      0.00]\ninet:bind/3                                        1     0.00     0  [      0.00]\nproc_lib:spawn_opt/4                               2     0.00     0  [      0.00]\nproc_lib:check_for_monitor/1                       2     0.00     0  [      0.00]\nproc_lib:ensure_link/1                             2     0.00     0  [      0.00]\nproc_lib:init_p/5                                  2     0.00     0  [      0.00]\nproc_lib:init_p_do_apply/3                         2     0.00     0  [      0.00]\nproc_lib:start_link/5                              2     0.00     0  [      0.00]\nproc_lib:sync_wait/2                               2     0.00     0  [      0.00]\nproc_lib:init_ack/2                                2     0.00     0  [      0.00]\nproc_lib:trans_init/3                              2     0.00     0  [      0.00]\nproc_lib:get_my_name/0                             2     0.00     0  [      0.00]\nproc_lib:get_ancestors/0                           2     0.00     0  [      0.00]\nproc_lib:proc_info/2                               2     0.00     0  [      0.00]\ngen_server:start_link/4                            2     0.00     0  [      0.00]\ngen_server:call/3                                  1     0.00     0  [      0.00]\ngen_server:init_it/6                               2     0.00     0  [      0.00]\ngen_server:loop/6                                  2     0.00     0  [      0.00]\nerror_logger:info_report/2                         2     0.00     0  [      0.00]\nerror_logger:notify/1                              2     0.00     0  [      0.00]\napplication_controller:get_env/2                   1     0.00     0  [      0.00]\nsupervisor:start_link/3                            2     0.00     0  [      0.00]\nsupervisor:init/1                                  2     0.00     0  [      0.00]\nsupervisor:init_children/2                         1     0.00     0  [      0.00]\nsupervisor:init_dynamic/2                          1     0.00     0  [      0.00]\nsupervisor:start_children/2                        1     0.00     0  [      0.00]\nsupervisor:start_children/3                        3     0.00     0  [      0.00]\nsupervisor:init_state/4                            2     0.00     0  [      0.00]\nsupervisor:set_flags/2                             2     0.00     0  [      0.00]\nsupervisor:check_flags/1                           4     0.00     0  [      0.00]\nsupervisor:do_check_flags/1                        2     0.00     0  [      0.00]\nsupervisor:validStrategy/1                         2     0.00     0  [      0.00]\nsupervisor:validIntensity/1                        2     0.00     0  [      0.00]\nsupervisor:validPeriod/1                           2     0.00     0  [      0.00]\nsupervisor:supname/2                               2     0.00     0  [      0.00]\nsupervisor:check_startspec/1                       2     0.00     0  [      0.00]\nsupervisor:check_startspec/2                       5     0.00     0  [      0.00]\nsupervisor:do_check_childspec/1                    3     0.00     0  [      0.00]\nsupervisor:validChildType/1                        3     0.00     0  [      0.00]\nsupervisor:validName/1                             3     0.00     0  [      0.00]\nsupervisor:validFunc/1                             3     0.00     0  [      0.00]\nsupervisor:validRestartType/1                      3     0.00     0  [      0.00]\nsupervisor:validShutdown/1                         3     0.00     0  [      0.00]\nsupervisor:report_progress/2                       2     0.00     0  [      0.00]\nerl_prim_loader:get_cwd/0                          3     0.00     0  [      0.00]\nerl_prim_loader:handle_get_cwd/2                   3     0.00     0  [      0.00]\nerl_prim_loader:efile_get_cwd/2                    3     0.00     0  [      0.00]\nerl_prim_loader:'-handle_get_cwd/2-fun-0-'/2       3     0.00     0  [      0.00]\ngen_tcp:listen/2                                   1     0.00     0  [      0.00]\nlists:keymember/3                                  3     0.00     0  [      0.00]\nlists:member/2                                     7     0.00     0  [      0.00]\nerlang:put/2                                       4     0.00     0  [      0.00]\nerlang:process_info/2                              2     0.00     0  [      0.00]\nerlang:process_flag/2                              2     0.00     0  [      0.00]\nerlang:group_leader/0                              2     0.00     0  [      0.00]\nprim_file:get_cwd_int/2                            3     0.02     1  [      0.33]\nlists:keydelete3/3                                 7     0.02     1  [      0.14]\nerror_handler:undefined_function/3                 6     0.02     1  [      0.17]\nerror_handler:ensure_loaded/1                      6     0.02     1  [      0.17]\ncode_server:is_sticky/2                            6     0.02     1  [      0.17]\ncode_server:try_load_module_1/5                    6     0.02     1  [      0.17]\ncode_server:try_load_module_3/6                    6     0.02     1  [      0.17]\ncode_server:post_beam_load/3                       6     0.02     1  [      0.17]\ncode_server:ensure_loaded/3                        6     0.02     1  [      0.17]\ncode_server:handle_pending_on_load/4               6     0.02     1  [      0.17]\ncode_server:'-try_load_module_3/6-fun-0-'/5        6     0.02     1  [      0.17]\nfilename:unix_pathtype/1                          12     0.02     1  [      0.08]\nerror_logger_tty_h:parse_event/1                   2     0.02     1  [      0.50]\ngen_event:server_notify/4                          6     0.02     1  [      0.17]\ngen_event:server_update/4                          4     0.02     1  [      0.25]\nprim_inet:type_opt/2                               6     0.02     1  [      0.17]\nprim_inet:type_opt_1/1                             6     0.02     1  [      0.17]\nprim_inet:type_value/3                             7     0.02     1  [      0.14]\ninet:list_opt/3                                    6     0.02     1  [      0.17]\ninet:mod/6                                         6     0.02     1  [      0.17]\ninit:objfile_extension/0                          13     0.02     1  [      0.08]\ntimer:sleep/1                                      1     0.02     1  [      1.00]\nerror_logger:handle_event/2                        2     0.02     1  [      0.50]\nsupervisor:do_start_child/2                        2     0.02     1  [      0.50]\nsupervisor:check_childspec/1                       6     0.02     1  [      0.17]\nsupervisor:extract_child/1                         2     0.02     1  [      0.50]\nerl_prim_loader:prim_get_cwd/2                     3     0.02     1  [      0.33]\nmaps:merge/2                                       5     0.02     1  [      0.20]\nprim_file:internal_native2name/1                   3     0.02     1  [      0.33]\nlists:keyfind/3                                   12     0.02     1  [      0.08]\nets:lookup/2                                       1     0.02     1  [      1.00]\nerlang:universaltime/0                             2     0.02     1  [      0.50]\nerlang:spawn_link/3                                1     0.02     1  [      1.00]\nerlang:register/2                                  2     0.02     1  [      0.50]\nerlang:function_exported/3                         6     0.02     1  [      0.17]\ngen:timeout/1                                      2     0.04     2  [      1.00]\nprim_file:drv_command/3                           16     0.04     2  [      0.13]\ncode_server:handle_on_load/5                       6     0.04     2  [      0.33]\ngen_event:send/2                                   2     0.04     2  [      1.00]\nprim_inet:recv0/3                                102     0.04     2  [      0.02]\nprim_inet:enum_val/2                               9     0.04     2  [      0.22]\nerlang:load_module/2                               6     0.04     2  [      0.33]\ninit:archive_extension/0                          13     0.04     2  [      0.15]\nsupervisor:validMods/1                             3     0.04     2  [      0.67]\nerl_prim_loader:check_file_result/3               16     0.04     2  [      0.13]\nerl_prim_loader:efile_get_file_from_port2/2       13     0.04     2  [      0.15]\nerl_prim_loader:'-handle_get_file/3-fun-0-'/3     13     0.04     2  [      0.15]\nprim_file:close/1                                 13     0.06     3  [      0.23]\nprim_file:drv_close/1                             16     0.06     3  [      0.19]\nprim_file:drv_command/2                           13     0.06     3  [      0.23]\nprim_file:drv_get_response/1                      16     0.06     3  [      0.19]\nprim_file:'-drv_command/4-after$^0/0-0-'/1        16     0.06     3  [      0.19]\nprim_file:'-drv_close/1-after$^0/0-0-'/1          16     0.06     3  [      0.19]\nfilename:append/2                                 13     0.06     3  [      0.23]\nerl_prim_loader:handle_get_file/3                 13     0.06     3  [      0.23]\nerl_prim_loader:efile_get_file_from_port/3        13     0.06     3  [      0.23]\nerl_prim_loader:is_basename/1                     13     0.06     3  [      0.23]\nerlang:iolist_size/1                              13     0.06     3  [      0.23]\nlists:reverse/2                                   18     0.06     3  [      0.17]\nerlang:port_get_data/1                           202     0.06     3  [      0.01]\nerlang:list_to_atom/1                              7     0.06     3  [      0.43]\nprim_file:read_file/2                             13     0.08     4  [      0.31]\nprim_file:drv_command/4                           19     0.08     4  [      0.21]\nprim_file:drv_get_response/2                      16     0.08     4  [      0.25]\nprim_file:translate_response/2                    16     0.08     4  [      0.25]\nprim_file:pathname/1                              13     0.08     4  [      0.31]\ncode_server:handle_call/3                          6     0.08     4  [      0.67]\ncode_server:mod_to_bin/2                          13     0.08     4  [      0.31]\ncode_server:objfile_extension/0                   13     0.08     4  [      0.31]\nfilename:pathtype/1                               12     0.08     4  [      0.33]\nos:type/0                                         15     0.08     4  [      0.27]\nprim_inet:type_value_2/2                           9     0.08     4  [      0.44]\nerlang:open_port/2                                17     0.08     4  [      0.24]\nerlang:port_command/2                             16     0.08     4  [      0.25]\nerl_prim_loader:get_file/1                        13     0.08     4  [      0.31]\nerl_prim_loader:request/1                         16     0.08     4  [      0.25]\nerl_prim_loader:prim_get_file/2                   13     0.08     4  [      0.31]\nerl_prim_loader:reverse/1                         13     0.08     4  [      0.31]\nerl_prim_loader:name_split/2                      13     0.08     4  [      0.31]\nprim_file:internal_name2native/1                  13     0.08     4  [      0.31]\nerlang:spawn_opt/1                                 2     0.08     4  [      2.00]\nerlang:setelement/3                               34     0.08     4  [      0.12]\nerlang:atom_to_list/1                             13     0.08     4  [      0.31]\nprim_file:drv_open/2                              16     0.10     5  [      0.31]\nlists:seq_loop/3                                  26     0.10     5  [      0.19]\nerlang:port_command/3                            100     0.10     5  [      0.05]\nerlang:system_info/1                              21     0.10     5  [      0.24]\nerlang:'++'/2                                     26     0.12     6  [      0.23]\nerlang:port_set_data/2                           103     0.12     6  [      0.06]\nerlang:module_loaded/1                            18     0.12     6  [      0.33]\nhttpd_tcp_listener:process/3                     102     0.14     7  [      0.07]\nerlang:port_close/1                              118     0.14     7  [      0.06]\nerl_prim_loader:deep_member/2                     52     0.14     7  [      0.13]\nerlang:demonitor/2                                 7     0.14     7  [      1.00]\nprim_inet:send/3                                 100     0.17     9  [      0.09]\ngen_tcp:send/2                                   100     0.17     9  [      0.09]\ninet6_tcp:recv/3                                 102     0.19    10  [      0.10]\nerlang:spawn/1                                   100     0.19    10  [      0.10]\nprim_file:read_file/1                             13     0.21    11  [      0.85]\ngen_tcp:recv/3                                   102     0.21    11  [      0.11]\nets:insert/2                                       6     0.21    11  [      1.83]\ncode_server:reply/2                                6     0.25    13  [      2.17]\ninet_db:register_socket/2                        103     0.27    14  [      0.14]\nerl_prim_loader:handle_request/3                  16     0.27    14  [      0.88]\nerlang:monitor/2                                   7     0.27    14  [      2.00]\nerlang:send/3                                      1     0.29    15  [     15.00]\nerlang:whereis/1                                  25     0.35    18  [      0.72]\nerl_prim_loader:debug/2                           32     0.37    19  [      0.59]\nerlang:bump_reductions/1                          16     0.37    19  [      1.19]\nlists:foreach/2                                  104     0.39    20  [      0.19]\nhttpd_tcp_listener:'-init/0-fun-1-'/2            100     0.41    21  [      0.21]\nprim_inet:async_recv/3                           102     0.52    27  [      0.26]\ninet_db:lookup_socket/1                          202     0.56    29  [      0.14]\nerl_prim_loader:loop/3                            16     0.58    30  [      1.88]\nfilename:join1/4                                 302     0.60    31  [      0.10]\nerl_prim_loader:is_prefix/2                       78     0.64    33  [      0.42]\nerlang:apply/2                                   101     0.66    34  [      0.34]\nerts_internal:open_port/2                         17     0.70    36  [      2.12]\nfilename:do_flatten/2                            155     1.05    54  [      0.35]\nerl_prim_loader:archive_split/3                  567     1.28    66  [      0.12]\nprim_inet:ctl_cmd/3                              310     1.44    74  [      0.24]\nerlang:spawn/3                                   100     1.55    80  [      0.80]\nprim_inet:enc_time/1                             305     1.63    84  [      0.28]\nerlang:port_control/3                            310     2.39   123  [      0.40]\nhttpd_tcp_listener:accept/1                      203     2.42   125  [      0.62]\ncode_server:loop/1                                 6     3.43   177  [     29.50]\nprim_inet:async_accept/2                         203     3.59   185  [      0.91]\nerts_internal:port_close/1                       118    10.88   561  [      4.75]\nerlang:prepare_loading/2                           6    12.30   634  [    105.67]\nerts_internal:port_control/3                     310    12.70   655  [      2.11]\nerlang:finish_loading/1                            6    13.91   717  [    119.50]\nerts_internal:port_command/3                     116    17.61   908  [      7.83]\n---------------------------------------------  -----  -------  ----  [----------]\nTotal:                                          6854  100.00%  5156  [      0.75]\n```\n"}