{"context": "docker swarm\u304c\u3061\u3087\u3063\u3068\u524d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304b\u3089docker\u672c\u4f53\u306b\u53d6\u308a\u8fbc\u307e\u308c\u305f\u3068\u306e\u3053\u3068\u30fb\u30fb\u30fb\nKubernates\u3088\u308a\u3082\u3053\u3061\u3089\u306e\u65b9\u304c\u8a2d\u5b9a\u304c\u7c21\u5358\u306a\u306e\u3067\u3001\u8a66\u3057\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\u307e\u305a\u306f\u3001Manager\u30ce\u30fc\u30c9\u306e\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u74b0\u5883\n\nCentOS7.3(CentOS Linux release 7.3.1611\u3092\u6700\u5c0f\u69cb\u6210\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3001firewall\u505c\u6b62\u3001selinux-disabled) 3\u30ce\u30fc\u30c9\n\n\nmanager01 - 192.168.28.180(\u7ba1\u7406LAN) 192.168.100.180(\u30b5\u30fc\u30d3\u30b9LAN)\nmanager02 - 192.168.28.181(\u7ba1\u7406LAN) 192.168.100.181(\u30b5\u30fc\u30d3\u30b9LAN)\nmanager03 - 192.168.28.182(\u7ba1\u7406LAN) 192.168.100.182(\u30b5\u30fc\u30d3\u30b9LAN)\nworker01 - 192.168.28.183(\u7ba1\u7406LAN) 192.168.100.183(\u30b5\u30fc\u30d3\u30b9LAN)\n\n\nDocker version 1.13.0-rc7, build 48a9e53\n\n\ndokcer\u306f\u81ea\u52d5\u8d77\u52d5\u306b\u8a2d\u5b9a\u3057\u3066\u3042\u308a\u307e\u3059\u3002\n\n\n\n\ndocker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n1\u53f0\u76ee\u306e\u307f\u8a18\u8f09\u3057\u3066\u3044\u307e\u3059\u304c\u3001\uff13\u53f0\u3068\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002(\u5f53\u7136\u3001\u30af\u30ed\u30fc\u30f3\u3067\u3082\u53ef\u80fd)\n\u6700\u65b0\u306e\u3064\u3082\u308a\u3067\u3059\u304c\u3001rc7\u306e\u3088\u3046\u3067\u3057\u305f\u3002\n[root@manager01 ~]#  curl -fsSL https://test.docker.com/ | sh\n+ sh -c 'sleep 3; yum -y -q install docker-engine'\nwarning: /var/cache/yum/x86_64/7/docker-testing-repo/packages/docker-engine-selinux-1.13.0-0.7.rc7.el7.centos.noarch.rpm: Header V4 RSA/SHA512 Signature, key ID 2c52609d: NOKEY\ndocker-engine-selinux-1.13.0-0.7.rc7.el7.centos.noarch.rpm \u306e\u516c\u958b\u9375\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u307e\u305b\u3093\n\nImporting GPG key 0x2C52609D:\n Userid     : \"Docker Release Tool (releasedocker) <docker@docker.com>\"\n Fingerprint: 5811 8e89 f3a9 1289 7c07 0adb f762 2157 2c52 609d\n From       : https://yum.dockerproject.org/gpg\nsetsebool:  SELinux is disabled.\nlibsemanage.semanage_direct_install_info: Overriding docker module at lower priority 100 with module at priority 400.\n\n(snip)\n[root@manager01 ~]# systemctl enable docker\nCreated symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.\n[root@manager01 ~]# systemctl start docker\n[root@manager01 ~]# systemctl status docker\n\u25cf docker.service - Docker Application Container Engine\n   Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled; vendor preset: disabled)\n   Active: active (running) since \u91d1 2017-01-27 22:54:53 JST; 6s ago\n     Docs: https://docs.docker.com\n Main PID: 1065 (dockerd)\n   Memory: 17.7M\n   CGroup: /system.slice/docker.service\n           \u251c\u25001065 /usr/bin/dockerd\n           \u2514\u25001071 docker-containerd -l unix:///var/run/docker/libcontainerd/docker-containerd.sock --metrics-interval=0 --start-timeout 2m --state-dir /var/run/docker/libcontainerd/containerd -...\n\n 1\u6708 27 22:54:51 manager01 dockerd[1065]: time=\"2017-01-27T22:54:51.067403331+09:00\" level=info msg=\"libcontainerd: new containerd process, pid: 1071\"\n(snip)\n[root@manager01 ~]# docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n\n\n3\u53f0\u306emanager\u3067\u521d\u671f\u69cb\u6210\n\uff11\u53f0\u76ee\u3092manager\u3067swarm init\u3057\u307e\u3059\u304c\u3001worker\u30ce\u30fc\u30c9\u306ejoin\u30c8\u30fc\u30af\u30f3\u306f\u8868\u793a\u3055\u308c\u307e\u3059\u304c\u3001manager\u306e\u30c8\u30fc\u30af\u30f3\u306f\u8868\u793a\u3055\u308c\u307e\u305b\u3093\u3002\n[root@manager01 ~]# docker swarm init --listen-addr 0.0.0.0:2377 --advertise-addr 192.168.28.180\nSwarm initialized: current node (rpt29x1yxumnj7ivl4fx68g3l) is now a manager.\n\nTo add a worker to this swarm, run the following command:\n\n    docker swarm join \\\n    --token SWMTKN-1-0dl2572g16uadcs332rvywgxiakuhj8qjy1h73wy3xbdy7sl6k-bs79rdoougdc7ry1lk8k5yuv0 \\\n    192.168.28.180:2377\n\nTo add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.\n\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001manager\u7528\u306ejoin\u30c8\u30fc\u30af\u30f3\u3092swarm init\u3092\u5b9f\u884c\u3057\u305f1\u53f0\u76ee\u3067\u8868\u793a\u3055\u305b\u307e\u3059\u3002\n[root@manager01 ~]# docker swarm join-token manager \nTo add a manager to this swarm, run the following command:\n\n    docker swarm join \\\n    --token SWMTKN-1-0dl2572g16uadcs332rvywgxiakuhj8qjy1h73wy3xbdy7sl6k-3ex2di1vcarstw0m02ut476rs \\\n    192.168.28.180:2377\n\n\u3053\u306e\u6642\u70b9\u3067\u306f\u3001manager01\u306e\u307f\u304c\u53c2\u52a0\u3057\u3066\u3044\u3066\u3001\u4ee5\u4e0b\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n[root@manager01 ~]# docker node ls\nID                           HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS\nrpt29x1yxumnj7ivl4fx68g3l *  manager01  Ready   Active        Leader\n\n\n\n2\u53f0\u76ee\u30013\u53f0\u76ee\u3092manager\u3068\u3057\u3066\u8d77\u52d5\n1\u53f0\u76ee\u3067\u78ba\u8a8d\u3057\u305fmanager\u3078\u306ejoin\u30c8\u30fc\u30af\u30f3\u3092\u4f7f\u3063\u3066\u30012\u53f0\u76ee\u30013\u53f0\u76ee\u3092\u53c2\u52a0\u3055\u305b\u307e\u3059\u3002\n\u307e\u305a\u306f\u30012\u53f0\u76ee\n[root@manager02 ~]# docker swarm join \\\n>     --token SWMTKN-1-0dl2572g16uadcs332rvywgxiakuhj8qjy1h73wy3xbdy7sl6k-3ex2di1vcarstw0m02ut476rs \\\n>     192.168.28.180:2377\nThis node joined a swarm as a manager.\n\n\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002manager02\u304cReachable\u3067\u53c2\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\n[root@manager01 ~]# docker node ls\nID                           HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS\nrpt29x1yxumnj7ivl4fx68g3l *  manager01  Ready   Active        Leader\nt4ri8ng3bagn8jlmpq1fx8vbq    manager02  Ready   Active        Reachable\n\n\u3055\u3089\u306b\u30013\u53f0\u76ee\n[root@manager03 ~]# docker swarm join \\\n>     --token SWMTKN-1-0dl2572g16uadcs332rvywgxiakuhj8qjy1h73wy3xbdy7sl6k-3ex2di1vcarstw0m02ut476rs \\\n>     192.168.28.180:2377\nThis node joined a swarm as a manager.\n\n\u3059\u308b\u3068\u3002\u3002\u3002manager03\u3082Reachable\u3067\u53c2\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\n[root@manager01 ~]# docker node ls\nID                           HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS\n53n8pcstw7sgwgcvklj1m8u84    manager03  Ready   Active        Reachable\nrpt29x1yxumnj7ivl4fx68g3l *  manager01  Ready   Active        Leader\nt4ri8ng3bagn8jlmpq1fx8vbq    manager02  Ready   Active        Reachable\n\n\u3069\u3046\u3084\u3089\u30013\u53f0\u3067manager\u304c\u69cb\u6210\u3067\u304d\u305f\u3088\u3046\u3067\u3059\u3002\nmanager\u306e\uff11\u53f0\u76ee(manager01)\u304cLeader\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\nmanager(Leader)\u3092\u6545\u969c(\u30c0\u30a6\u30f3)\u3055\u305b\u3066\u307f\u308b\nmanager01(Leader)\u3092\u6545\u969c(\u30c0\u30a6\u30f3)\u3057\u3066\u307f\u307e\u3059\u3002\n[root@manager01 ~]# poweroff -nf\n\n\u3069\u3046\u3084\u3089\u3001manager03\u304cLeader\u3078\u3046\u307e\u304f\u6607\u683c\u3057\u305f\u3088\u3046\u3067\u3059\u3002\n[root@manager02 ~]# docker node ls\nID                           HOSTNAME   STATUS   AVAILABILITY  MANAGER STATUS\n53n8pcstw7sgwgcvklj1m8u84    manager03  Ready    Active        Leader\nrpt29x1yxumnj7ivl4fx68g3l    manager01  Unknown  Active        Unreachable\nt4ri8ng3bagn8jlmpq1fx8vbq *  manager02  Ready    Active        Reachable\n\n[root@manager03 ~]# docker node ls\nID                           HOSTNAME   STATUS   AVAILABILITY  MANAGER STATUS\n53n8pcstw7sgwgcvklj1m8u84 *  manager03  Ready    Active        Leader\nrpt29x1yxumnj7ivl4fx68g3l    manager01  Unknown  Active        Unreachable\nt4ri8ng3bagn8jlmpq1fx8vbq    manager02  Ready    Active        Reachable\n\n\n\u3055\u3089\u306b\u6545\u969c\u3092\u767a\u751f\u3055\u305b\u3066\u307f\u308b\n\u3055\u3089\u306b\u3001manager03(Leader)\u3092\u6545\u969c(\u30c0\u30a6\u30f3)\u3055\u305b\u3066\u307f\u307e\u3059\nmanager02\u306e\u307f\u306e\u69cb\u6210\u3068\u306a\u308b\u306f\u305a\u3067\u3059\u304c\u3001\u3069\u3046\u3084\u3089\u3001\u69cb\u6210\u30ce\u30fc\u30c9\u304c\uff11\u53f0\u306b\u306a\u308b\u3068\u30b3\u30de\u30f3\u30c9\u3092\u53d7\u3051\u3064\u3051\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\u78ba\u304b\u30de\u30cb\u30e5\u30a2\u30eb\u306e\u3069\u3053\u304b\u306b\u8a18\u8f09\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u3053\u308c\u306f\u6b63\u3057\u3044\u52d5\u4f5c\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n[root@manager03 ~]# poweroff -nf\n\n[root@manager02 ~]# docker node ls\nError response from daemon: rpc error: code = 4 desc = context deadline exceeded\n\n\u3053\u3053\u3067\u3001manager01\u3092\u518d\u8d77\u52d5\u3059\u308b\u3068\u3001\u69cb\u6210\u30ce\u30fc\u30c9\u304c\uff11\u53f0\u304b\u3089\u5fa9\u5e30\u3059\u308b\u306e\u3067\u3001\u30b3\u30de\u30f3\u30c9\u3092\u53d7\u3051\u4ed8\u3051\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\n[root@manager02 ~]# docker node ls\nID                           HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS\n53n8pcstw7sgwgcvklj1m8u84    manager03  Ready   Active        Unreachable\nrpt29x1yxumnj7ivl4fx68g3l    manager01  Down    Active        Reachable\nt4ri8ng3bagn8jlmpq1fx8vbq *  manager02  Ready   Active        Leader\n\n\u3068\u3044\u3046\u3053\u3068\u306f\u3001\u4e00\u7aef\u3001\uff13\u53f0\u3067\u69cb\u6210\u3057\u305f\u5f8c\u3001\u5168\u90e8\u505c\u6b62\u3057\u305f\u5f8c\u3001\uff11\u53f0\u3060\u3051\u8d77\u52d5\u3057\u3066\u3082\u30b3\u30de\u30f3\u30c9\u306f\u53d7\u3051\u4ed8\u3051\u306a\u3044\uff1f\uff1f\u30fb\u30fb\u30fb\u30fb\n\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\u4e00\u65e6\u3001\uff13\u53f0\u3067\u6b63\u3057\u304f\u69cb\u6210\u3055\u305b\u307e\u3059\u3002\n[root@manager02 ~]# docker node ls\nID                           HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS\n53n8pcstw7sgwgcvklj1m8u84    manager03  Ready   Active        Reachable\nrpt29x1yxumnj7ivl4fx68g3l    manager01  Ready   Active        Reachable\nt4ri8ng3bagn8jlmpq1fx8vbq *  manager02  Ready   Active        Leader\n\n\uff13\u53f0\u3092\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u3067\u505c\u6b62\u3057\u3001manager02\u306e\u307f\u3092\u8d77\u52d5\u3057\u3066\u307f\u307e\u3059\u3002\n[root@manager02 ~]# docker node ls\nError response from daemon: rpc error: code = 4 desc = context deadline exceeded\n[root@manager02 ~]# systemctl status docker\n\u25cf docker.service - Docker Application Container Engine\n   Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled; vendor preset: disabled)\n   Active: active (running) since \u91d1 2017-01-27 23:28:17 JST; 24s ago\n     Docs: https://docs.docker.com\n Main PID: 897 (dockerd)\n   Memory: 55.4M\n   CGroup: /system.slice/docker.service\n           \u251c\u2500897 /usr/bin/dockerd\n           \u2514\u2500909 docker-containerd -l unix:///var/run/docker/libcontainerd/docker-containerd.sock --metrics-interval=0 --start-timeout 2m --state-dir /var/run/docker/libcontainerd/containerd --...\n\n 1\u6708 27 23:28:36 manager02 dockerd[897]: time=\"2017-01-27T23:28:36.722357627+09:00\" level=info msg=\"6b703cf843000f40 received vote from 6b703cf843000f40 at term 46\"\n 1\u6708 27 23:28:36 manager02 dockerd[897]: time=\"2017-01-27T23:28:36.722380099+09:00\" level=info msg=\"6b703cf843000f40 [logterm: 37, index: 42] sent vote request to 774941a439e05ca9 at term 46\"\n 1\u6708 27 23:28:36 manager02 dockerd[897]: time=\"2017-01-27T23:28:36.722406174+09:00\" level=info msg=\"6b703cf843000f40 [logterm: 37, index: 42] sent vote request to 5d0a9a8ae474065d at term 46\"\n 1\u6708 27 23:28:37 manager02 dockerd[897]: time=\"2017-01-27T23:28:37.663305003+09:00\" level=error msg=\"Error getting nodes: rpc error: code = 4 desc = context deadline exceeded\"\n 1\u6708 27 23:28:37 manager02 dockerd[897]: time=\"2017-01-27T23:28:37.663367503+09:00\" level=error msg=\"Handler for GET /v1.25/nodes returned error: rpc error: code = 4 desc = contex...ine exceeded\"\n 1\u6708 27 23:28:40 manager02 dockerd[897]: time=\"2017-01-27T23:28:40.722241813+09:00\" level=info msg=\"6b703cf843000f40 is starting a new election at term 46\"\n 1\u6708 27 23:28:40 manager02 dockerd[897]: time=\"2017-01-27T23:28:40.722317671+09:00\" level=info msg=\"6b703cf843000f40 became candidate at term 47\"\n 1\u6708 27 23:28:40 manager02 dockerd[897]: time=\"2017-01-27T23:28:40.722334987+09:00\" level=info msg=\"6b703cf843000f40 received vote from 6b703cf843000f40 at term 47\"\n 1\u6708 27 23:28:40 manager02 dockerd[897]: time=\"2017-01-27T23:28:40.722364236+09:00\" level=info msg=\"6b703cf843000f40 [logterm: 37, index: 42] sent vote request to 5d0a9a8ae474065d at term 47\"\n 1\u6708 27 23:28:40 manager02 dockerd[897]: time=\"2017-01-27T23:28:40.722390737+09:00\" level=info msg=\"6b703cf843000f40 [logterm: 37, index: 42] sent vote request to 774941a439e05ca9 at term 47\"\nHint: Some lines were ellipsized, use -l to show in full.\n\ndocker\u306f\u8d77\u52d5\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u3084\u306f\u308a\u3001\u69cb\u6210\u30ce\u30fc\u30c9\u304c\uff11\u53f0\u306b\u306a\u308b\u3068\u30b3\u30de\u30f3\u30c9\u3092\u53d7\u3051\u3064\u3051\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\u30ed\u30b0\u304cvote...\u304c\u3046\u3093\u305f\u3089\u51fa\u3066\u307e\u3059\u306e\u3067\u3001\u3084\u306f\u308a\u3001\u69cb\u6210\u30ce\u30fc\u30c9\u304c\u8db3\u308a\u306a\u3044\u3063\u3066\u3053\u3068\u3067\u3057\u3087\u3046\u304b\u306d\u266a\n\u6700\u5f8c\u306e\uff11\u53f0\u306e\u5834\u5408\u3001\u30b5\u30fc\u30d3\u30b9\u306e\u5236\u5fa1(create\u306a\u3069)\u306f\u3067\u304d\u306a\u3044\u304b\u3082\u3057\u307e\u305b\u3093\u304c\u3001\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\u7d9a\u304f\u30fb\u30fb\u30fb\n\n\u53c2\u8003\u30ea\u30f3\u30af\n\nhttps://docs.docker.com/engine/swarm/join-nodes/\nhttps://docs.docker.com/engine/reference/commandline/swarm_join_token/\n\ndocker swarm\u304c\u3061\u3087\u3063\u3068\u524d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304b\u3089docker\u672c\u4f53\u306b\u53d6\u308a\u8fbc\u307e\u308c\u305f\u3068\u306e\u3053\u3068\u30fb\u30fb\u30fb\nKubernates\u3088\u308a\u3082\u3053\u3061\u3089\u306e\u65b9\u304c\u8a2d\u5b9a\u304c\u7c21\u5358\u306a\u306e\u3067\u3001\u8a66\u3057\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\u307e\u305a\u306f\u3001Manager\u30ce\u30fc\u30c9\u306e\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n#\u74b0\u5883\n * CentOS7.3(CentOS Linux release 7.3.1611\u3092\u6700\u5c0f\u69cb\u6210\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3001firewall\u505c\u6b62\u3001selinux-disabled) 3\u30ce\u30fc\u30c9\n  * manager01 - 192.168.28.180(\u7ba1\u7406LAN) 192.168.100.180(\u30b5\u30fc\u30d3\u30b9LAN)\n  * manager02 - 192.168.28.181(\u7ba1\u7406LAN) 192.168.100.181(\u30b5\u30fc\u30d3\u30b9LAN)\n  * manager03 - 192.168.28.182(\u7ba1\u7406LAN) 192.168.100.182(\u30b5\u30fc\u30d3\u30b9LAN)\n  * worker01 - 192.168.28.183(\u7ba1\u7406LAN) 192.168.100.183(\u30b5\u30fc\u30d3\u30b9LAN)\n * Docker version 1.13.0-rc7, build 48a9e53\n  * dokcer\u306f\u81ea\u52d5\u8d77\u52d5\u306b\u8a2d\u5b9a\u3057\u3066\u3042\u308a\u307e\u3059\u3002\n\n#docker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n1\u53f0\u76ee\u306e\u307f\u8a18\u8f09\u3057\u3066\u3044\u307e\u3059\u304c\u3001\uff13\u53f0\u3068\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002(\u5f53\u7136\u3001\u30af\u30ed\u30fc\u30f3\u3067\u3082\u53ef\u80fd)\n\u6700\u65b0\u306e\u3064\u3082\u308a\u3067\u3059\u304c\u3001rc7\u306e\u3088\u3046\u3067\u3057\u305f\u3002\n\n```\n[root@manager01 ~]#  curl -fsSL https://test.docker.com/ | sh\n+ sh -c 'sleep 3; yum -y -q install docker-engine'\nwarning: /var/cache/yum/x86_64/7/docker-testing-repo/packages/docker-engine-selinux-1.13.0-0.7.rc7.el7.centos.noarch.rpm: Header V4 RSA/SHA512 Signature, key ID 2c52609d: NOKEY\ndocker-engine-selinux-1.13.0-0.7.rc7.el7.centos.noarch.rpm \u306e\u516c\u958b\u9375\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u307e\u305b\u3093\n\nImporting GPG key 0x2C52609D:\n Userid     : \"Docker Release Tool (releasedocker) <docker@docker.com>\"\n Fingerprint: 5811 8e89 f3a9 1289 7c07 0adb f762 2157 2c52 609d\n From       : https://yum.dockerproject.org/gpg\nsetsebool:  SELinux is disabled.\nlibsemanage.semanage_direct_install_info: Overriding docker module at lower priority 100 with module at priority 400.\n\n(snip)\n[root@manager01 ~]# systemctl enable docker\nCreated symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.\n[root@manager01 ~]# systemctl start docker\n[root@manager01 ~]# systemctl status docker\n\u25cf docker.service - Docker Application Container Engine\n   Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled; vendor preset: disabled)\n   Active: active (running) since \u91d1 2017-01-27 22:54:53 JST; 6s ago\n     Docs: https://docs.docker.com\n Main PID: 1065 (dockerd)\n   Memory: 17.7M\n   CGroup: /system.slice/docker.service\n           \u251c\u25001065 /usr/bin/dockerd\n           \u2514\u25001071 docker-containerd -l unix:///var/run/docker/libcontainerd/docker-containerd.sock --metrics-interval=0 --start-timeout 2m --state-dir /var/run/docker/libcontainerd/containerd -...\n\n 1\u6708 27 22:54:51 manager01 dockerd[1065]: time=\"2017-01-27T22:54:51.067403331+09:00\" level=info msg=\"libcontainerd: new containerd process, pid: 1071\"\n(snip)\n[root@manager01 ~]# docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n```\n\n#3\u53f0\u306emanager\u3067\u521d\u671f\u69cb\u6210\n\uff11\u53f0\u76ee\u3092manager\u3067swarm init\u3057\u307e\u3059\u304c\u3001worker\u30ce\u30fc\u30c9\u306ejoin\u30c8\u30fc\u30af\u30f3\u306f\u8868\u793a\u3055\u308c\u307e\u3059\u304c\u3001manager\u306e\u30c8\u30fc\u30af\u30f3\u306f\u8868\u793a\u3055\u308c\u307e\u305b\u3093\u3002\n\n```\n[root@manager01 ~]# docker swarm init --listen-addr 0.0.0.0:2377 --advertise-addr 192.168.28.180\nSwarm initialized: current node (rpt29x1yxumnj7ivl4fx68g3l) is now a manager.\n\nTo add a worker to this swarm, run the following command:\n\n    docker swarm join \\\n    --token SWMTKN-1-0dl2572g16uadcs332rvywgxiakuhj8qjy1h73wy3xbdy7sl6k-bs79rdoougdc7ry1lk8k5yuv0 \\\n    192.168.28.180:2377\n\nTo add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.\n\n```\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001manager\u7528\u306ejoin\u30c8\u30fc\u30af\u30f3\u3092swarm init\u3092\u5b9f\u884c\u3057\u305f1\u53f0\u76ee\u3067\u8868\u793a\u3055\u305b\u307e\u3059\u3002\n\n```\n[root@manager01 ~]# docker swarm join-token manager \nTo add a manager to this swarm, run the following command:\n\n    docker swarm join \\\n    --token SWMTKN-1-0dl2572g16uadcs332rvywgxiakuhj8qjy1h73wy3xbdy7sl6k-3ex2di1vcarstw0m02ut476rs \\\n    192.168.28.180:2377\n```\n\n\u3053\u306e\u6642\u70b9\u3067\u306f\u3001manager01\u306e\u307f\u304c\u53c2\u52a0\u3057\u3066\u3044\u3066\u3001\u4ee5\u4e0b\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n```\n[root@manager01 ~]# docker node ls\nID                           HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS\nrpt29x1yxumnj7ivl4fx68g3l *  manager01  Ready   Active        Leader\n\n```\n\n#2\u53f0\u76ee\u30013\u53f0\u76ee\u3092manager\u3068\u3057\u3066\u8d77\u52d5\n1\u53f0\u76ee\u3067\u78ba\u8a8d\u3057\u305fmanager\u3078\u306ejoin\u30c8\u30fc\u30af\u30f3\u3092\u4f7f\u3063\u3066\u30012\u53f0\u76ee\u30013\u53f0\u76ee\u3092\u53c2\u52a0\u3055\u305b\u307e\u3059\u3002\n\n\u307e\u305a\u306f\u30012\u53f0\u76ee\n\n```\n[root@manager02 ~]# docker swarm join \\\n>     --token SWMTKN-1-0dl2572g16uadcs332rvywgxiakuhj8qjy1h73wy3xbdy7sl6k-3ex2di1vcarstw0m02ut476rs \\\n>     192.168.28.180:2377\nThis node joined a swarm as a manager.\n```\n\n\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002manager02\u304cReachable\u3067\u53c2\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\n\n```\n[root@manager01 ~]# docker node ls\nID                           HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS\nrpt29x1yxumnj7ivl4fx68g3l *  manager01  Ready   Active        Leader\nt4ri8ng3bagn8jlmpq1fx8vbq    manager02  Ready   Active        Reachable\n```\n\n\u3055\u3089\u306b\u30013\u53f0\u76ee\n\n```\n[root@manager03 ~]# docker swarm join \\\n>     --token SWMTKN-1-0dl2572g16uadcs332rvywgxiakuhj8qjy1h73wy3xbdy7sl6k-3ex2di1vcarstw0m02ut476rs \\\n>     192.168.28.180:2377\nThis node joined a swarm as a manager.\n```\n\n\u3059\u308b\u3068\u3002\u3002\u3002manager03\u3082Reachable\u3067\u53c2\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\n\n```\n[root@manager01 ~]# docker node ls\nID                           HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS\n53n8pcstw7sgwgcvklj1m8u84    manager03  Ready   Active        Reachable\nrpt29x1yxumnj7ivl4fx68g3l *  manager01  Ready   Active        Leader\nt4ri8ng3bagn8jlmpq1fx8vbq    manager02  Ready   Active        Reachable\n```\n\n\u3069\u3046\u3084\u3089\u30013\u53f0\u3067manager\u304c\u69cb\u6210\u3067\u304d\u305f\u3088\u3046\u3067\u3059\u3002\nmanager\u306e\uff11\u53f0\u76ee(manager01)\u304cLeader\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n#manager(Leader)\u3092\u6545\u969c(\u30c0\u30a6\u30f3)\u3055\u305b\u3066\u307f\u308b\nmanager01(Leader)\u3092\u6545\u969c(\u30c0\u30a6\u30f3)\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\n[root@manager01 ~]# poweroff -nf\n```\n\n\u3069\u3046\u3084\u3089\u3001manager03\u304cLeader\u3078\u3046\u307e\u304f\u6607\u683c\u3057\u305f\u3088\u3046\u3067\u3059\u3002\n\n```\n[root@manager02 ~]# docker node ls\nID                           HOSTNAME   STATUS   AVAILABILITY  MANAGER STATUS\n53n8pcstw7sgwgcvklj1m8u84    manager03  Ready    Active        Leader\nrpt29x1yxumnj7ivl4fx68g3l    manager01  Unknown  Active        Unreachable\nt4ri8ng3bagn8jlmpq1fx8vbq *  manager02  Ready    Active        Reachable\n\n[root@manager03 ~]# docker node ls\nID                           HOSTNAME   STATUS   AVAILABILITY  MANAGER STATUS\n53n8pcstw7sgwgcvklj1m8u84 *  manager03  Ready    Active        Leader\nrpt29x1yxumnj7ivl4fx68g3l    manager01  Unknown  Active        Unreachable\nt4ri8ng3bagn8jlmpq1fx8vbq    manager02  Ready    Active        Reachable\n```\n\n# \u3055\u3089\u306b\u6545\u969c\u3092\u767a\u751f\u3055\u305b\u3066\u307f\u308b\n\u3055\u3089\u306b\u3001manager03(Leader)\u3092\u6545\u969c(\u30c0\u30a6\u30f3)\u3055\u305b\u3066\u307f\u307e\u3059\nmanager02\u306e\u307f\u306e\u69cb\u6210\u3068\u306a\u308b\u306f\u305a\u3067\u3059\u304c\u3001\u3069\u3046\u3084\u3089\u3001\u69cb\u6210\u30ce\u30fc\u30c9\u304c\uff11\u53f0\u306b\u306a\u308b\u3068\u30b3\u30de\u30f3\u30c9\u3092\u53d7\u3051\u3064\u3051\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\u78ba\u304b\u30de\u30cb\u30e5\u30a2\u30eb\u306e\u3069\u3053\u304b\u306b\u8a18\u8f09\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u3053\u308c\u306f\u6b63\u3057\u3044\u52d5\u4f5c\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n```\n[root@manager03 ~]# poweroff -nf\n\n[root@manager02 ~]# docker node ls\nError response from daemon: rpc error: code = 4 desc = context deadline exceeded\n```\n\n\u3053\u3053\u3067\u3001manager01\u3092\u518d\u8d77\u52d5\u3059\u308b\u3068\u3001\u69cb\u6210\u30ce\u30fc\u30c9\u304c\uff11\u53f0\u304b\u3089\u5fa9\u5e30\u3059\u308b\u306e\u3067\u3001\u30b3\u30de\u30f3\u30c9\u3092\u53d7\u3051\u4ed8\u3051\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\n\n```\n[root@manager02 ~]# docker node ls\nID                           HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS\n53n8pcstw7sgwgcvklj1m8u84    manager03  Ready   Active        Unreachable\nrpt29x1yxumnj7ivl4fx68g3l    manager01  Down    Active        Reachable\nt4ri8ng3bagn8jlmpq1fx8vbq *  manager02  Ready   Active        Leader\n```\n\n\u3068\u3044\u3046\u3053\u3068\u306f\u3001\u4e00\u7aef\u3001\uff13\u53f0\u3067\u69cb\u6210\u3057\u305f\u5f8c\u3001\u5168\u90e8\u505c\u6b62\u3057\u305f\u5f8c\u3001\uff11\u53f0\u3060\u3051\u8d77\u52d5\u3057\u3066\u3082\u30b3\u30de\u30f3\u30c9\u306f\u53d7\u3051\u4ed8\u3051\u306a\u3044\uff1f\uff1f\u30fb\u30fb\u30fb\u30fb\n\n\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u4e00\u65e6\u3001\uff13\u53f0\u3067\u6b63\u3057\u304f\u69cb\u6210\u3055\u305b\u307e\u3059\u3002\n\n```\n[root@manager02 ~]# docker node ls\nID                           HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS\n53n8pcstw7sgwgcvklj1m8u84    manager03  Ready   Active        Reachable\nrpt29x1yxumnj7ivl4fx68g3l    manager01  Ready   Active        Reachable\nt4ri8ng3bagn8jlmpq1fx8vbq *  manager02  Ready   Active        Leader\n```\n\n\uff13\u53f0\u3092\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u3067\u505c\u6b62\u3057\u3001manager02\u306e\u307f\u3092\u8d77\u52d5\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\n[root@manager02 ~]# docker node ls\nError response from daemon: rpc error: code = 4 desc = context deadline exceeded\n[root@manager02 ~]# systemctl status docker\n\u25cf docker.service - Docker Application Container Engine\n   Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled; vendor preset: disabled)\n   Active: active (running) since \u91d1 2017-01-27 23:28:17 JST; 24s ago\n     Docs: https://docs.docker.com\n Main PID: 897 (dockerd)\n   Memory: 55.4M\n   CGroup: /system.slice/docker.service\n           \u251c\u2500897 /usr/bin/dockerd\n           \u2514\u2500909 docker-containerd -l unix:///var/run/docker/libcontainerd/docker-containerd.sock --metrics-interval=0 --start-timeout 2m --state-dir /var/run/docker/libcontainerd/containerd --...\n\n 1\u6708 27 23:28:36 manager02 dockerd[897]: time=\"2017-01-27T23:28:36.722357627+09:00\" level=info msg=\"6b703cf843000f40 received vote from 6b703cf843000f40 at term 46\"\n 1\u6708 27 23:28:36 manager02 dockerd[897]: time=\"2017-01-27T23:28:36.722380099+09:00\" level=info msg=\"6b703cf843000f40 [logterm: 37, index: 42] sent vote request to 774941a439e05ca9 at term 46\"\n 1\u6708 27 23:28:36 manager02 dockerd[897]: time=\"2017-01-27T23:28:36.722406174+09:00\" level=info msg=\"6b703cf843000f40 [logterm: 37, index: 42] sent vote request to 5d0a9a8ae474065d at term 46\"\n 1\u6708 27 23:28:37 manager02 dockerd[897]: time=\"2017-01-27T23:28:37.663305003+09:00\" level=error msg=\"Error getting nodes: rpc error: code = 4 desc = context deadline exceeded\"\n 1\u6708 27 23:28:37 manager02 dockerd[897]: time=\"2017-01-27T23:28:37.663367503+09:00\" level=error msg=\"Handler for GET /v1.25/nodes returned error: rpc error: code = 4 desc = contex...ine exceeded\"\n 1\u6708 27 23:28:40 manager02 dockerd[897]: time=\"2017-01-27T23:28:40.722241813+09:00\" level=info msg=\"6b703cf843000f40 is starting a new election at term 46\"\n 1\u6708 27 23:28:40 manager02 dockerd[897]: time=\"2017-01-27T23:28:40.722317671+09:00\" level=info msg=\"6b703cf843000f40 became candidate at term 47\"\n 1\u6708 27 23:28:40 manager02 dockerd[897]: time=\"2017-01-27T23:28:40.722334987+09:00\" level=info msg=\"6b703cf843000f40 received vote from 6b703cf843000f40 at term 47\"\n 1\u6708 27 23:28:40 manager02 dockerd[897]: time=\"2017-01-27T23:28:40.722364236+09:00\" level=info msg=\"6b703cf843000f40 [logterm: 37, index: 42] sent vote request to 5d0a9a8ae474065d at term 47\"\n 1\u6708 27 23:28:40 manager02 dockerd[897]: time=\"2017-01-27T23:28:40.722390737+09:00\" level=info msg=\"6b703cf843000f40 [logterm: 37, index: 42] sent vote request to 774941a439e05ca9 at term 47\"\nHint: Some lines were ellipsized, use -l to show in full.\n```\n\ndocker\u306f\u8d77\u52d5\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u3084\u306f\u308a\u3001\u69cb\u6210\u30ce\u30fc\u30c9\u304c\uff11\u53f0\u306b\u306a\u308b\u3068\u30b3\u30de\u30f3\u30c9\u3092\u53d7\u3051\u3064\u3051\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\u30ed\u30b0\u304cvote...\u304c\u3046\u3093\u305f\u3089\u51fa\u3066\u307e\u3059\u306e\u3067\u3001\u3084\u306f\u308a\u3001\u69cb\u6210\u30ce\u30fc\u30c9\u304c\u8db3\u308a\u306a\u3044\u3063\u3066\u3053\u3068\u3067\u3057\u3087\u3046\u304b\u306d\u266a\n\n**\u6700\u5f8c\u306e\uff11\u53f0\u306e\u5834\u5408\u3001\u30b5\u30fc\u30d3\u30b9\u306e\u5236\u5fa1(create\u306a\u3069)\u306f\u3067\u304d\u306a\u3044\u304b\u3082\u3057\u307e\u305b\u3093\u304c\u3001\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002**\n\n\u7d9a\u304f\u30fb\u30fb\u30fb\n\n#\u53c2\u8003\u30ea\u30f3\u30af\n * https://docs.docker.com/engine/swarm/join-nodes/\n * https://docs.docker.com/engine/reference/commandline/swarm_join_token/\n\n\n\n\n\n\n\n\n\n\n\n", "tags": ["docker", "swarm"]}