{"tags": ["Rails", "unicorn", "nginx"], "context": " More than 1 year has passed since last update.\n\n1.\u30b5\u30f3\u30d7\u30eb\u30a2\u30d7\u30ea\u4f5c\u6210\n\nrails\u30b5\u30f3\u30d7\u30eb\u30a2\u30d7\u30ea\u306e\u4f5c\u6210\u306b\u3064\u3044\u3066\u306f\u4ee5\u4e0b\u53c2\u7167\nrails\u74b0\u5883\u69cb\u7bc9\uff08CentOS + ruby on rails\uff09\n\n2.nginx\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n# \u30ea\u30dd\u30b8\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n$ sudo vim /etc/yum.repos.d/nginx.repo\n\n# \u4ee5\u4e0b\u3092\u8a18\u8f09\u3057\u4fdd\u5b58\n[nginx]\nname=nginx repo\nbaseurl=http://nginx.org/packages/centos/6/$basearch/\ngpgcheck=0\nenabled=0\n\n# nginx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo yum --enablerepo=nginx install nginx\n\n# \u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n$ nginx -v\n\n3.unicorn <-> nginx\u9023\u643a\n\nunicorn\u5074\u306e\u8a2d\u5b9a\n\n# \u30a2\u30d7\u30ea\u7528\u30e6\u30fc\u30b6\u306b\u5207\u308a\u66ff\u3048\n$ su - rails\n\n# Gemfile\u306e\u8a2d\u5b9a\uff08unicorn\u306e\u884c\u3092\u30b3\u30e1\u30f3\u30c8\u30a4\u30f3\uff09\n$ cd ~/sample/\n$ vim Gemfile\n\n# Gemfile\u3088\u308a\u8a72\u5f53unicorn\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ bundle install --path=~/sample/vendor/bundle\n\n# unicorn\u7528\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n$ vim ~/sample/config/unicorn.rb\n\n# \u4ee5\u4e0b\u3092\u8a18\u8f09\u3057\u4fdd\u5b58\nrails_root = File.expand_path('../../', __FILE__)\n\u3000\nworker_processes 2\nworking_directory rails_root\n\u3000\nlisten \"#{rails_root}/tmp/unicorn.sock\"\npid \"#{rails_root}/tmp/unicorn.pid\"\n\u3000\nstderr_path \"#{rails_root}/log/unicorn_error.log\"\nstdout_path \"#{rails_root}/log/unicorn.log\"\n\nnginx\u5074\u306e\u8a2d\u5b9a\n\n# nginx\u7528\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n$ sudo cp /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/sample.conf\n$ vim /etc/nginx/conf.d/sample.conf\n\n# \u4ee5\u4e0b\u306e\u3068\u304a\u308a\u306b\u8a18\u8f09\u3057\u4fdd\u5b58\nupstream unicorn {\n  \u3000# nginx\u3068unicorn\u306e\u9023\u643a\n  \u3000# \u2191\u3067\u4f5c\u6210\u3057\u305funicorn.rb\u3067\u8a2d\u5b9a\u3057\u305funicorn.sock\u3092\u6307\u5b9a\n\u3000server unix:/home/rails/sample/tmp/unicorn.sock;\n}\n\u3000\nserver {\n\u3000\u3000listen 80;\n\u3000\u3000server_name <\u30b5\u30fc\u30d0\u540d>;\n\u3000\n\u3000\u3000root /home/rails/sample/public;\n\u3000\n\u3000\u3000access_log /var/log/nginx/sample_access.log;\n\u3000\u3000error_log /var/log/nginx/sample_error.log;\n\u3000\n\u3000\u3000client_max_body_size 100m;\n\u3000\u3000error_page 500 502 503 504 /500.html;\n\u3000\u3000\u3000\n\u3000\u3000try_files $uri/index.html $uri @unicorn;\n\u3000\n\u3000\u3000location @unicorn {\n\u3000\u3000\u3000proxy_set_header X-Real-IP $remote_addr;\n\u3000\u3000\u3000proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\u3000\u3000\u3000proxy_set_header Host $http_host;\n\u3000\u3000\u3000proxy_pass http://unicorn;\n  \u3000}\n}\n\n# nginx\u306e\u8d77\u52d5\n$ sudo /etc/init.d/nginx start\n\n# unicorn\u306e\u8d77\u52d5\n$ su - rails\n$ cd ~/sample/\n$ bundle exec unicorn_rails -c config/unicorn.rb -p 3000 -E development -D\n\n# unicorn\u8d77\u52d5\u78ba\u8a8d\n$ ps -ef | grep unicorn | grep -v grep\n\n# \u30d6\u30e9\u30a6\u30b6\u306b\u3066\u78ba\u8a8d\nhttp://<\u30b5\u30fc\u30d0\u540d>\n\n# unicorn\u306e\u505c\u6b62\n$ kill -QUIT <pid(tmp/unicorn.pid\u306b\u8a18\u8f09\u3055\u308c\u3066\u308b)>\n#1.\u30b5\u30f3\u30d7\u30eb\u30a2\u30d7\u30ea\u4f5c\u6210\n###### rails\u30b5\u30f3\u30d7\u30eb\u30a2\u30d7\u30ea\u306e\u4f5c\u6210\u306b\u3064\u3044\u3066\u306f\u4ee5\u4e0b\u53c2\u7167\n[rails\u74b0\u5883\u69cb\u7bc9\uff08CentOS + ruby on rails\uff09](http://qiita.com/shinyashikis@github/items/3501c5f7f71a8e345c3d)\n\n\n#2.nginx\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n####### \u30ea\u30dd\u30b8\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n`$ sudo vim /etc/yum.repos.d/nginx.repo`\n\n####### \u4ee5\u4e0b\u3092\u8a18\u8f09\u3057\u4fdd\u5b58\n`[nginx]\nname=nginx repo\nbaseurl=http://nginx.org/packages/centos/6/$basearch/\ngpgcheck=0\nenabled=0`\n\n####### nginx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n`$ sudo yum --enablerepo=nginx install nginx`\n\n####### \u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n`$ nginx -v`\n\n\n#3.unicorn <-> nginx\u9023\u643a\n### unicorn\u5074\u306e\u8a2d\u5b9a\n####### \u30a2\u30d7\u30ea\u7528\u30e6\u30fc\u30b6\u306b\u5207\u308a\u66ff\u3048\n`$ su - rails`\n####### Gemfile\u306e\u8a2d\u5b9a\uff08unicorn\u306e\u884c\u3092\u30b3\u30e1\u30f3\u30c8\u30a4\u30f3\uff09\n`$ cd ~/sample/\n$ vim Gemfile`\n####### Gemfile\u3088\u308a\u8a72\u5f53unicorn\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n`$ bundle install --path=~/sample/vendor/bundle`\n####### unicorn\u7528\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n`$ vim ~/sample/config/unicorn.rb`\n####### \u4ee5\u4e0b\u3092\u8a18\u8f09\u3057\u4fdd\u5b58\n`rails_root = File.expand_path('../../', __FILE__)\n\u3000\nworker_processes 2\nworking_directory rails_root\n\u3000\nlisten \"#{rails_root}/tmp/unicorn.sock\"\npid \"#{rails_root}/tmp/unicorn.pid\"\n\u3000\nstderr_path \"#{rails_root}/log/unicorn_error.log\"\nstdout_path \"#{rails_root}/log/unicorn.log\"`\n\n### nginx\u5074\u306e\u8a2d\u5b9a\n####### nginx\u7528\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n`$ sudo cp /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/sample.conf\n$ vim /etc/nginx/conf.d/sample.conf`\n####### \u4ee5\u4e0b\u306e\u3068\u304a\u308a\u306b\u8a18\u8f09\u3057\u4fdd\u5b58\n`upstream unicorn {\n  \u3000# nginx\u3068unicorn\u306e\u9023\u643a\n  \u3000# \u2191\u3067\u4f5c\u6210\u3057\u305funicorn.rb\u3067\u8a2d\u5b9a\u3057\u305funicorn.sock\u3092\u6307\u5b9a\n\u3000server unix:/home/rails/sample/tmp/unicorn.sock;\n}\n\u3000\nserver {\n\u3000\u3000listen 80;\n\u3000\u3000server_name <\u30b5\u30fc\u30d0\u540d>;\n\u3000\n\u3000\u3000root /home/rails/sample/public;\n\u3000\n\u3000\u3000access_log /var/log/nginx/sample_access.log;\n\u3000\u3000error_log /var/log/nginx/sample_error.log;\n\u3000\n\u3000\u3000client_max_body_size 100m;\n\u3000\u3000error_page 500 502 503 504 /500.html;\n\u3000\u3000\u3000\n\u3000\u3000try_files $uri/index.html $uri @unicorn;\n\u3000\n\u3000\u3000location @unicorn {\n\u3000\u3000\u3000proxy_set_header X-Real-IP $remote_addr;\n\u3000\u3000\u3000proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\u3000\u3000\u3000proxy_set_header Host $http_host;\n\u3000\u3000\u3000proxy_pass http://unicorn;\n  \u3000}\n}`\n\n####### nginx\u306e\u8d77\u52d5\n`$ sudo /etc/init.d/nginx start`\n\n####### unicorn\u306e\u8d77\u52d5\n`$ su - rails\n$ cd ~/sample/\n$ bundle exec unicorn_rails -c config/unicorn.rb -p 3000 -E development -D`\n\n####### unicorn\u8d77\u52d5\u78ba\u8a8d\n`$ ps -ef | grep unicorn | grep -v grep`\n####### \u30d6\u30e9\u30a6\u30b6\u306b\u3066\u78ba\u8a8d\n`http://<\u30b5\u30fc\u30d0\u540d>`\n\n####### unicorn\u306e\u505c\u6b62\n`$ kill -QUIT <pid(tmp/unicorn.pid\u306b\u8a18\u8f09\u3055\u308c\u3066\u308b)>`\n"}