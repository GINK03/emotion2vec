{"context": "Docker\u3092\u5c0e\u5165\u3059\u308b\u306b\u3042\u305f\u308a\u3001\u30b3\u30f3\u30c6\u30ca\u3067\u52d5\u304fTomcat\u306e\u5404\u7a2e\u30e1\u30c8\u30ea\u30af\u30b9\u3092Zabbix\u304b\u3089\u53c2\u7167\u3059\u308b\u305f\u3081\u306b\u884c\u3063\u305f\u691c\u8a3c\u306e\u30e1\u30e2\u3002\n\nZabbix\u306e\u8a2d\u5b9a\n\u5229\u7528\u3057\u305fZabbix\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f3.0\u3002\u3053\u308c\u3082Docker\u30b3\u30f3\u30c6\u30ca\u3067\u52d5\u304b\u3057\u3066\u3044\u308b\u3002\n\u4ee5\u4e0b\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u74b0\u5883\u3092\u7528\u610f\u3057\u305f\u3002\n\n[docker]1\u5206\u3067\u30c6\u30b9\u30c8\u7528\u306eZabbix\u74b0\u5883\u3092\u7528\u610f\u3059\u308b\nhttp://dev.classmethod.jp/cloud/dockerized-zabbix-test/\n\nZabbix Java Gateway\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u3001\n\nZS_JavaGateway\nZS_JavaGatewayPort\nZS_StartJavaPollers\n\n\u306e3\u3064\u3092\u8ffd\u52a0\u3067\u6307\u5b9a\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066\u3044\u308b\u3002\ndocker run \\\n    -d \\\n    --name zabbix \\\n    -p 10081:80 \\\n    -p 10051:10051 \\\n    -p 10052:10052 \\\n    -v /etc/localtime:/etc/localtime:ro \\\n    --link zabbix-db:zabbix.db \\\n    --env=\"ZS_DBHost=zabbix.db\" \\\n    --env=\"ZS_DBUser=zabbix\" \\\n    --env=\"ZS_DBPassword=my_password\" \\\n    --env=\"ZS_JavaGateway=127.0.0.1\" \\\n    --env=\"ZS_JavaGatewayPort=10052\" \\\n    --env=\"ZS_StartJavaPollers=5\" \\\n    zabbix/zabbix-3.0:latest\n\n\u6700\u5f8c\u306b\u3001\u30b3\u30f3\u30c6\u30ca\u3078\u30a2\u30af\u30bb\u30b9\u3057\u3066Zabbix Java Gateway\u3092\u8d77\u52d5\u3059\u308b\u3002\n\uff08\u6700\u521d\u3001\u3053\u308c\u3092\u884c\u308f\u305a\u30cf\u30de\u3063\u305f\uff09\n[root@xxxx ~]# docker exec -it zabbix bash\n[root@yyyy /]# /usr/local/sbin/zabbix_java/startup.sh\n\n\nTomcat\u306e\u8a2d\u5b9a\nJMX\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u3001CATALINA_OPS\u3078\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3059\u308b\u3002\nCATALINA_OPTS=\"${CATALINA_OPTS} \\\n  -server \\\n  -Xmx512m \\\n  -Xms512m \\\n  -XX:PermSize=32m \\\n  -XX:MaxPermSize=128m \\\n  -Xloggc:/usr/local/tomca/logs/gc.txt \\\n  -XX:+PrintGCDetails \\\n  -XX:+PrintGCDateStamps \\\n  -Dorg.apache.jasper.compiler.Parser.STRICT_QUOTE_ESCAPING=false \\\n  -Dcom.sun.management.jmxremote \\\n  -Dcom.sun.management.jmxremote.port=12345 \\\n  -Dcom.sun.management.jmxremote.rmi.port=12345 \\\n  -Dcom.sun.management.jmxremote.local.only=false \\\n  -Dcom.sun.management.jmxremote.authenticate=false \\\n  -Dcom.sun.management.jmxremote.ssl=false \\\n  -Djava.rmi.server.hostname=${HOST_IP_ADDRESS}\"\n\n\"-Dcom.sun.management.jmxremote\"\u4ee5\u964d\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u305f\u3002\n\"-Djava.rmi.server.hostname\"\u306b\u95a2\u3057\u3066\u306f\u3001\u30ed\u30fc\u30ab\u30ebIP\u3067\u306f\u306a\u304f\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u305fDocker\u30db\u30b9\u30c8\u306eIP\u30a2\u30c9\u30ec\u30b9\u304c\u5fc5\u8981\u3068\u306a\u308b\u3063\u307d\u3044\u3002\nTomcat\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\u305f\u3081\u306b\u7528\u610f\u3057\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u74b0\u5883\u5909\u6570\u3092\u6307\u5b9a\u3057\u305f\u3002\n\u307e\u305f\u3001Zabbix Java Gateway\u304b\u3089\u53c2\u7167\u3059\u308b\u305f\u308112345\u756a\u30dd\u30fc\u30c8\u3092\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c9\u3057\u3066\u3044\u308b\u3002\nIP_ADDRESS=`ip -f inet -o addr | grep -v \"127.0.0.1\" | cut -d\\  -f 7 | cut -d/ -f 1 | awk 'NR == 1'`\n\ndocker run -d -p 8080:8080 -p 8009:8009 -p 12345:12345 \\\n  -v /etc/localtime:/etc/localtime:ro \\\n  --name tomcat_xxx \\\n  --env CATALINA_OPTS=\"-Dorg.apache.catalina.SESSION_PARAMETER_NAME=JSESSIONID -Dorg.apache.jasper.compiler.Parser.STRICT_QUOTE_ESCAPING=false -DjvmRoute=xxx\" \\\n  --env HOST_IP_ADDRESS=${IP_ADDRESS} \\\n  ...\n\n\u4ee5\u4e0a\u306e\u8a2d\u5b9a\u3067\u3001Zabbix\u304b\u3089Tomcat\u306eConnector worker\u7b49\u3092\u53c2\u7167\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002\nDocker\u3092\u5c0e\u5165\u3059\u308b\u306b\u3042\u305f\u308a\u3001\u30b3\u30f3\u30c6\u30ca\u3067\u52d5\u304fTomcat\u306e\u5404\u7a2e\u30e1\u30c8\u30ea\u30af\u30b9\u3092Zabbix\u304b\u3089\u53c2\u7167\u3059\u308b\u305f\u3081\u306b\u884c\u3063\u305f\u691c\u8a3c\u306e\u30e1\u30e2\u3002\n\n# Zabbix\u306e\u8a2d\u5b9a\n\n\u5229\u7528\u3057\u305fZabbix\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f3.0\u3002\u3053\u308c\u3082Docker\u30b3\u30f3\u30c6\u30ca\u3067\u52d5\u304b\u3057\u3066\u3044\u308b\u3002\n\u4ee5\u4e0b\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u74b0\u5883\u3092\u7528\u610f\u3057\u305f\u3002\n\n> [docker]1\u5206\u3067\u30c6\u30b9\u30c8\u7528\u306eZabbix\u74b0\u5883\u3092\u7528\u610f\u3059\u308b\n> http://dev.classmethod.jp/cloud/dockerized-zabbix-test/\n\nZabbix Java Gateway\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u3001\n\n* ZS_JavaGateway\n* ZS_JavaGatewayPort\n* ZS_StartJavaPollers\n\n\u306e3\u3064\u3092\u8ffd\u52a0\u3067\u6307\u5b9a\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066\u3044\u308b\u3002\n\n```\ndocker run \\\n    -d \\\n    --name zabbix \\\n    -p 10081:80 \\\n    -p 10051:10051 \\\n    -p 10052:10052 \\\n    -v /etc/localtime:/etc/localtime:ro \\\n    --link zabbix-db:zabbix.db \\\n    --env=\"ZS_DBHost=zabbix.db\" \\\n    --env=\"ZS_DBUser=zabbix\" \\\n    --env=\"ZS_DBPassword=my_password\" \\\n    --env=\"ZS_JavaGateway=127.0.0.1\" \\\n    --env=\"ZS_JavaGatewayPort=10052\" \\\n    --env=\"ZS_StartJavaPollers=5\" \\\n    zabbix/zabbix-3.0:latest\n```\n\n\u6700\u5f8c\u306b\u3001\u30b3\u30f3\u30c6\u30ca\u3078\u30a2\u30af\u30bb\u30b9\u3057\u3066Zabbix Java Gateway\u3092\u8d77\u52d5\u3059\u308b\u3002\n\uff08\u6700\u521d\u3001\u3053\u308c\u3092\u884c\u308f\u305a\u30cf\u30de\u3063\u305f\uff09\n\n```\n[root@xxxx ~]# docker exec -it zabbix bash\n[root@yyyy /]# /usr/local/sbin/zabbix_java/startup.sh\n```\n\n# Tomcat\u306e\u8a2d\u5b9a\nJMX\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u3001CATALINA_OPS\u3078\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n```\nCATALINA_OPTS=\"${CATALINA_OPTS} \\\n  -server \\\n  -Xmx512m \\\n  -Xms512m \\\n  -XX:PermSize=32m \\\n  -XX:MaxPermSize=128m \\\n  -Xloggc:/usr/local/tomca/logs/gc.txt \\\n  -XX:+PrintGCDetails \\\n  -XX:+PrintGCDateStamps \\\n  -Dorg.apache.jasper.compiler.Parser.STRICT_QUOTE_ESCAPING=false \\\n  -Dcom.sun.management.jmxremote \\\n  -Dcom.sun.management.jmxremote.port=12345 \\\n  -Dcom.sun.management.jmxremote.rmi.port=12345 \\\n  -Dcom.sun.management.jmxremote.local.only=false \\\n  -Dcom.sun.management.jmxremote.authenticate=false \\\n  -Dcom.sun.management.jmxremote.ssl=false \\\n  -Djava.rmi.server.hostname=${HOST_IP_ADDRESS}\"\n```\n\n\"-Dcom.sun.management.jmxremote\"\u4ee5\u964d\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u305f\u3002\n\"-Djava.rmi.server.hostname\"\u306b\u95a2\u3057\u3066\u306f\u3001\u30ed\u30fc\u30ab\u30ebIP\u3067\u306f\u306a\u304f\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u305fDocker\u30db\u30b9\u30c8\u306eIP\u30a2\u30c9\u30ec\u30b9\u304c\u5fc5\u8981\u3068\u306a\u308b\u3063\u307d\u3044\u3002\nTomcat\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\u305f\u3081\u306b\u7528\u610f\u3057\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u74b0\u5883\u5909\u6570\u3092\u6307\u5b9a\u3057\u305f\u3002\n\u307e\u305f\u3001Zabbix Java Gateway\u304b\u3089\u53c2\u7167\u3059\u308b\u305f\u308112345\u756a\u30dd\u30fc\u30c8\u3092\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c9\u3057\u3066\u3044\u308b\u3002\n\n```\nIP_ADDRESS=`ip -f inet -o addr | grep -v \"127.0.0.1\" | cut -d\\  -f 7 | cut -d/ -f 1 | awk 'NR == 1'`\n\ndocker run -d -p 8080:8080 -p 8009:8009 -p 12345:12345 \\\n  -v /etc/localtime:/etc/localtime:ro \\\n  --name tomcat_xxx \\\n  --env CATALINA_OPTS=\"-Dorg.apache.catalina.SESSION_PARAMETER_NAME=JSESSIONID -Dorg.apache.jasper.compiler.Parser.STRICT_QUOTE_ESCAPING=false -DjvmRoute=xxx\" \\\n  --env HOST_IP_ADDRESS=${IP_ADDRESS} \\\n  ...\n```\n\n\u4ee5\u4e0a\u306e\u8a2d\u5b9a\u3067\u3001Zabbix\u304b\u3089Tomcat\u306eConnector worker\u7b49\u3092\u53c2\u7167\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002\n", "tags": ["docker", "Tomcat", "zabbix-java-gateway", "zabbix"]}