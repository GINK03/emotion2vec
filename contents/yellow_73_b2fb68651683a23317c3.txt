{"context": "\n\n\u306f\u3058\u3081\u306b\n\u4e8c\u3064\u306e\u7dda\u5206\u304c\u30af\u30ed\u30b9\u3059\u308b\u304b\u3092\u5224\u5b9a\u3059\u308b \u3067\u306f\u3001\u4e8c\u3064\u306e\u7dda\u5206\u304c\u300c\u30af\u30ed\u30b9\u300d\u3059\u308b\u304b\u3092\u5224\u5b9a\u3057\u307e\u3057\u305f\u3002\u3053\u3053\u3067\u8a00\u3046\u30af\u30ed\u30b9\u306f\u3001\u4e8c\u3064\u306e\u7dda\u5206\u306e\u5171\u6709\u90e8\u5206\u304c\u3042\u308a\u3001\u304b\u3064\u5171\u6709\u90e8\u5206\u304c\u70b9\u3067\u3042\u308b\u5834\u5408\u3001\u3068\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u969b\u3001\u89e3\u4e0d\u5b9a\u3068\u306a\u308b\u5834\u5408\u306f\u3001\u5e38\u306b\u30af\u30ed\u30b9\u3057\u306a\u3044\u3068\u5224\u5b9a\u3057\u307e\u3057\u305f\u3002\n\u4eca\u56de\u306f\u3001\u3082\u3046\u5c11\u3057\u6761\u4ef6\u3092\u7de9\u304f\u3057\u3066\u3001\u30a4\u30f3\u30bf\u30bb\u30af\u30c8\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5224\u5b9a\u3057\u3066\u307f\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u3001\u5171\u6709\u90e8\u5206\u304c\u3042\u308b\u5834\u5408\u3001\u3068\u3057\u307e\u3059\u3002\n\u3053\u306e\u969b\u3001\u30af\u30ed\u30b9\u3057\u3066\u3044\u308b\u306a\u3089\u5fc5\u305a\u30a4\u30f3\u30bf\u30bb\u30af\u30c8\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u3053\u306f\u3044\u3044\u306e\u3067\u3059\u304c\u3001\u89e3\u4e0d\u80fd\u3068\u89e3\u4e0d\u5b9a\u3068\u306e\u5224\u5225\u304c\u5fc5\u8981\u3067\u3059\u3057\u3001\u89e3\u4e0d\u5b9a\u306e\u5834\u5408\u306b\u306f\u7dda\u5206\u306e\u533a\u9593\u5185\u3067\u5171\u6709\u90e8\u5206\u304c\u3042\u308b\u304b\u3092\u5224\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u524d\u56de\u306e\u304a\u3055\u3089\u3044\n\u7dda\u5206$s_1 = \\overline{(x_{11},y_{11}),(x_{12},y_{12})}$\u3068$s_2 = \\overline{(x_{21},y_{21}),(x_{22},y_{22})}$\u3068\u304c\u30af\u30ed\u30b9\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u8003\u3048\u307e\u3057\u305f\u3002\n$s_1$, $s_2$\u4e0a\u306e\u4efb\u610f\u306e\u70b9\u3092$t$\u3067\u8868\u3059\u3068\n\\begin{align}\np_1(t)&=( (t(x_{12}-x_{11})+x_{11}, t(y_{12}-y_{11})+y_{11} ) \\\\\np_2(t)&=( (t(x_{22}-x_{21})+x_{21}, t(y_{22}-y_{21})+y_{21} ) \\\\\n\\end{align}\n\n\u305f\u3060\u3057 $0 \\le t \\le 1$ \u3067\u3059\u3002\n\\begin{align}\ndx_{1} &= x_{12}-x_{11} \\\\\ndx_{2} &= x_{22}-x_{21} \\\\\ndx_{a} &= x_{21}-x_{11}\n\\end{align}\n\n\u3068\u304a\u304f\u3068\n\\begin{align}\np_1(t)&=(t \\cdot dx_{1} + x_{11}, t \\cdot dy_{1}+y_{11} ) \\\\\np_2(t)&=(t \\cdot dx_{2} + x_{21}, t \\cdot dy_{2}+y_{21} ) \\\\\n\\end{align}\n\n\u3068\u306a\u308a\u307e\u3059\u3002\n\u89e3\u4e0d\u80fd\u307e\u305f\u306f\u89e3\u4e0d\u5b9a\u306b\u306a\u308b\u6761\u4ef6\u306f\u3001\ndx_{2} \\cdot dy_{1} = dx_{1} \\cdot dy_{2}\n\n\u3067\u3059\u3002\n\u3053\u308c\u4ee5\u5916\u306f\u30af\u30ed\u30b9\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u3001$t$\u306e\u5024\u306e\u691c\u8a0e\u306b\u3064\u306a\u304c\u3063\u3066\u3044\u304d\u307e\u3059\uff08\u524d\u56de\u306e\u8a18\u4e8b\u306b\u66f8\u3044\u3066\u3044\u307e\u3059\uff09\u3002\n\n\u89e3\u4e0d\u80fd\u304b\u89e3\u4e0d\u5b9a\u304b\u306e\u5224\u5b9a\n\u89e3\u4e0d\u80fd\u306e\u5834\u5408\u306f\u3001\u5171\u6709\u90e8\u5206\u304c\u5168\u304f\u306a\u3044\u306e\u3067\u3001\u30a4\u30f3\u30bf\u30bb\u30af\u30c8\u3057\u307e\u305b\u3093\u3002\u89e3\u4e0d\u5b9a\u306e\u5834\u5408\u306f\u3001\u30a4\u30f3\u30bf\u30bb\u30af\u30c8\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\uff08\u533a\u9593\u306b\u3064\u3044\u3066\u306f\u5f8c\u8ff0\uff09\u3002\n$p_1(t_1)=p_2(t_2)$\u3068\u306a\u308b$t_1$, $t_2$\u3092\u6c42\u3081\u308b\u9014\u4e2d\u3067\u3001$t_2$\u306b\u3064\u3044\u3066\u89e3\u3044\u305f\u5f0f\u304c\u51fa\u307e\u3057\u305f\u3002\n\\begin{align}\nt_2 &= \\frac{t_1 \\cdot dx_{1}-dx_{a}}{dx_{2}} \\\\\nt_2 &= \\frac{t_1 \\cdot dy_{1}-dy_{a}}{dy_{2}}\n\\end{align}\n\n\u3053\u3053\u304b\u3089\n\\begin{align}\n\\frac{t_1 \\cdot dx_{1}-dx_{a}}{dx_{2}} &= \\frac{t_1 \\cdot dy_{1}-dy_{a}}{dy_{2}} \\\\\nt_1 \\cdot dx_{1} \\cdot dy_{2} - dx_{a} \\cdot dy_{2} &= t_1 \\cdot dx_{2} \\cdot dy_{1} - dx_{2} \\cdot dy_{a}\n\\end{align}\n\n\u89e3\u4e0d\u80fd\u307e\u305f\u306f\u89e3\u4e0d\u5b9a\u306b\u306a\u308b\u6761\u4ef6\u306f $dx_{2} \\cdot dy_{1} = dx_{1} \\cdot dy_{2}$ \u3067\u3042\u308b\u3068\u793a\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u5165\u308c\u8fbc\u307f\u307e\u3059\u3002\ndx_{2} \\cdot dy_{a} = dx_{a} \\cdot dy_{2}\n\n\u3053\u3053\u3067$t_1$\u304c\u6d88\u3048\u307e\u3057\u305f\u3002\u4e0a\u306e\u7b49\u5f0f\u304c\u6e80\u305f\u3055\u308c\u308b\u3068\u89e3\u4e0d\u5b9a\uff08\u30a4\u30f3\u30bf\u30bb\u30af\u30c8\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\uff09\u3001\u305d\u3046\u3067\u306a\u3044\u306a\u3089\u89e3\u4e0d\u80fd\uff08\u30a4\u30f3\u30bf\u30bb\u30af\u30c8\u3057\u306a\u3044\uff09\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u533a\u9593\u306e\u5224\u5b9a\n\u7dda\u5206\u3067\u306a\u304f\u7121\u9650\u9060\u306b\u4f38\u3073\u308b\u76f4\u7dda\u306e\u5834\u5408\u306b\u306f\u3001\u3055\u304d\u307b\u3069\u5c0e\u3044\u305f$dx_{2} \\cdot dy_{a} = dx_{a} \\cdot dy_{2}$\u3092\u6e80\u305f\u3059\u3068\u3001\u3044\u305f\u308b\u3068\u3053\u308d\u3067\u5171\u6709\u90e8\u5206\u304c\u5b58\u5728\u3057\u307e\u3059\u3002\n\u3057\u304b\u3057\u3001\u3053\u3053\u3067\u6271\u3063\u3066\u3044\u308b\u306e\u306f\u7dda\u5206\u3067\u3059\u306e\u3067\u3001\u304a\u4e92\u3044\u306e\u533a\u9593\u5185\u306b\u5165\u3089\u306a\u3051\u308c\u3070\u3001\u5171\u6709\u90e8\u5206\u306f\u5b58\u5728\u3057\u307e\u305b\u3093\u3002\u3053\u3053\u304b\u3089\u306f\u3001\u533a\u9593\u306b\u3064\u3044\u3066\u691c\u8a0e\u3057\u307e\u3059\u3002\n$s_1 = \\overline{(x_{11},y_{11}),(x_{12},y_{12})}$\u306e\u533a\u9593\u5185\u306b$(x_{21}, y_{21})$\u307e\u305f\u306f$(x_{22}, y_{22})$\u304c\u5b58\u5728\u3059\u308c\u3070\u3001''ST_Overlaps(s1,s2)\uff08\u3069\u3061\u3089\u304b\u4e00\u65b9\u304c\u5b58\u5728\uff09\u304bST_Covers(s1,s2)``\uff08\u4e21\u65b9\u5b58\u5728\uff09\u304c\u6210\u308a\u7acb\u3061\u307e\u3059\u3002\n\u305f\u3060\u3057\u3001ST_Within(s1,s2)\u306b\u3064\u3044\u3066\u306f\u691c\u8a0e\u3057\u3066\u3044\u307e\u305b\u3093\u3002\u3053\u308c\u3092\u30ab\u30d0\u30fc\u3059\u308b\u306b\u306fST_Covers(s2,s1)\u306e\u30c1\u30a7\u30c3\u30af\u3092\u3059\u308c\u3070\u3044\u3044\u306e\u3067\u3001$s_2$\u306e\u533a\u9593\u5185\u306b$p_{11}$\u307e\u305f\u306f$p_{12}$\u304c\u3042\u308c\u3070\u3088\u3044\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n$s_1$\u306e\u533a\u9593\u5185\u306b$(x_{21}, y_{21})$\u304c\u3042\u308b\u304b\u3069\u3046\u304b\u306f\u3001\n\\begin{align}\nx_{21} &= t \\cdot dx_{1} + x_{11} \\\\\nt &= \\frac{x_{21}-x_{11}}{dx_{1}} \\\\\nt &= \\frac{dx_{a}}{dx_{1}}\n\\end{align}\n\n\u3067\u3001\n0 \\le t \\le 1\n\n\u3068\u306a\u308c\u3070\u3088\u3044\u3067\u3059\u3002\n\u307e\u305f\u306f\u3001y\u306b\u3064\u3044\u3066\u8a08\u7b97\u3057\u3066\u3001\nt=\\frac{dy_{a}}{dy_{1}}\n\n\u3092\u4f7f\u3063\u3066\u3082\u3088\u3044\u3067\u3059\u3002\n$s_1$\u306e\u533a\u9593\u5185\u306b$(x_{22}, y_{22})$\u304c\u3042\u308b\u304b\u3069\u3046\u304b\u306f\u3001\n\\begin{align}\nt &= \\frac{x_{22}-x_{11}}{dx_{1}} \\\\\nt &= \\frac{y_{22}-y_{11}}{dy_{1}}\n\\end{align}\n\n\u306e\u3044\u305a\u308c\u304b\u3067\u3001\n0 \\le t \\le 1\n\n\u3068\u306a\u308c\u3070\u3088\u3044\u3067\u3059\u3002\n$s_2$\u306e\u533a\u9593\u5185\u306b$(x_{11}, y_{11})$\u307e\u305f\u306f$(x_{12}, y_{12})$\u304c\u3042\u308b\u304b\u3069\u3046\u304b\u306f\u3001\n\\begin{align}\nt &= \\frac{-x_{a}}{dx_{2}} \\\\\nt &=\\frac{-y_{a}}{dx_{2}} \\\\\nt &=\\frac{x_{12}-x_{21}}{dx_{2}} \\\\\nt &=\\frac{y_{12}-y_{21}}{dy_{2}}\n\\end{align}\n\n\u306e\u3044\u305a\u308c\u304b\u3067\u3001\n0 \\le t \\le 1\n\n\u3068\u306a\u308c\u3070\u3088\u3044\u3067\u3059\u3002 \n\u3053\u3053\u3067\u306f\u3001$t$\u306b\u95a2\u3057\u3066\u5408\u8a088\u3064\u306e\u5f0f\u304c\u51fa\u3066\u304d\u307e\u3057\u305f\u3002\u3053\u308c\u3089\u306e\u3046\u3061\u4e00\u3064\u3067\u3082\u6761\u4ef6\u3092\u6e80\u305f\u305b\u3070\u3001\u30a4\u30f3\u30bf\u30bb\u30af\u30c8\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u5206\u6bcd\u304c\u30bc\u30ed\u3068\u306a\u308b\u5834\u5408\u306e\u691c\u8a0e\u306f\u4e0d\u8981\n\u672c\u6765\u306a\u3089\u5206\u6bcd\u304c0\u306e\u3068\u304d\u306e\u5834\u5408\u5206\u3051\u304c\u5fc5\u8981\u3068\u306a\u308a\u307e\u3059\u304c\u3001\u5206\u6bcd\u304c0\u306e\u3068\u304d\u306f$t$\u306fNaN\u306b\u306a\u308a\u307e\u3059\u3002$0 \\le t \\le 1$\u306f\u5fc5\u305a\u6e80\u305f\u3057\u307e\u305b\u3093\u306e\u3067\u3001\u653e\u7f6e\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30b3\u30fc\u30c9\nfunction between01(v) {\n  return v >= 0 && v <= 1;\n}\n\nfunction intersects_ss(s1, s2) {\n  var p11 = s1[0];\n  var p12 = s1[1];\n  var p21 = s2[0];\n  var p22 = s2[1];\n  var x11 = p11[0];\n  var y11 = p11[1];\n  var x12 = p12[0];\n  var y12 = p12[1];\n  var x21 = p21[0];\n  var y21 = p21[1];\n  var x22 = p22[0];\n  var y22 = p22[1];\n  var dx1 = x12 - x11;\n  var dy1 = y12 - y11;\n  var dx2 = x22 - x21;\n  var dy2 = y22 - y21;\n  var dxa = x21 - x11;\n  var dya = y21 - y11;\n\n  var denom = dx1*dy2-dx2*dy1;\n  if( denom != 0 ) {\n    // crosses ?\n    var t1 = ( dxa*dy2-dya*dx2)/( dx1*dy2-dx2*dy1);\n    var t2 = (-dxa*dy1+dya*dx1)/(-dx1*dy2+dx2*dy1);\n    return t1 >= 0 && t1 <= 1 && t2 >= 0 && t2 <= 1;\n  }\n  else {\n    if( dx2*dya != dxa*dy2 ) {\n      // impossible\n      return false;\n    }\n    else {\n      // indefinite\n      return between01(dxa/dx1) ||\n        between01(dya/dy1) ||\n        between01((x22-x11)/dx1) ||\n        between01((y22-y11)/dy1) ||\n        between01(-dxa/dx2) ||\n        between01(-dya/dy2) ||\n        between01((x12-x21)/dx2) ||\n        between01((y12-y21)/dy2);\n    }\n  }\n}\n\nalert(intersects_ss([[10,10],[20,20]], [[20,10],[10,20]]));\nalert(intersects_ss([[10,10],[20,20]], [[0,0],[5,0]]));\nalert(intersects_ss([[10,10],[20,20]], [[110,110],[120,120]]));\nalert(intersects_ss([[11,11],[12,12]], [[10,10],[20,20]]));\nalert(intersects_ss([[10,10],[20,20]], [[20,20],[22,22]]));\nalert(intersects_ss([[10,10],[20,20]], [[21,21],[22,22]]));\n\n# \u306f\u3058\u3081\u306b\n\n[\u4e8c\u3064\u306e\u7dda\u5206\u304c\u30af\u30ed\u30b9\u3059\u308b\u304b\u3092\u5224\u5b9a\u3059\u308b](http://qiita.com/yellow_73/items/1e254b69ee84554b9d37) \u3067\u306f\u3001\u4e8c\u3064\u306e\u7dda\u5206\u304c\u300c\u30af\u30ed\u30b9\u300d\u3059\u308b\u304b\u3092\u5224\u5b9a\u3057\u307e\u3057\u305f\u3002\u3053\u3053\u3067\u8a00\u3046\u30af\u30ed\u30b9\u306f\u3001\u4e8c\u3064\u306e\u7dda\u5206\u306e\u5171\u6709\u90e8\u5206\u304c\u3042\u308a\u3001\u304b\u3064\u5171\u6709\u90e8\u5206\u304c\u70b9\u3067\u3042\u308b\u5834\u5408\u3001\u3068\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u969b\u3001\u89e3\u4e0d\u5b9a\u3068\u306a\u308b\u5834\u5408\u306f\u3001\u5e38\u306b\u30af\u30ed\u30b9\u3057\u306a\u3044\u3068\u5224\u5b9a\u3057\u307e\u3057\u305f\u3002\n\n\u4eca\u56de\u306f\u3001\u3082\u3046\u5c11\u3057\u6761\u4ef6\u3092\u7de9\u304f\u3057\u3066\u3001[\u30a4\u30f3\u30bf\u30bb\u30af\u30c8](http://qiita.com/yellow_73/items/dc7c5e1ebe95625aee60#st_intersects)\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5224\u5b9a\u3057\u3066\u307f\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u3001\u5171\u6709\u90e8\u5206\u304c\u3042\u308b\u5834\u5408\u3001\u3068\u3057\u307e\u3059\u3002\n\n\u3053\u306e\u969b\u3001\u30af\u30ed\u30b9\u3057\u3066\u3044\u308b\u306a\u3089\u5fc5\u305a\u30a4\u30f3\u30bf\u30bb\u30af\u30c8\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u3053\u306f\u3044\u3044\u306e\u3067\u3059\u304c\u3001\u89e3\u4e0d\u80fd\u3068\u89e3\u4e0d\u5b9a\u3068\u306e\u5224\u5225\u304c\u5fc5\u8981\u3067\u3059\u3057\u3001\u89e3\u4e0d\u5b9a\u306e\u5834\u5408\u306b\u306f\u7dda\u5206\u306e\u533a\u9593\u5185\u3067\u5171\u6709\u90e8\u5206\u304c\u3042\u308b\u304b\u3092\u5224\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n# \u524d\u56de\u306e\u304a\u3055\u3089\u3044\n\n\u7dda\u5206$s_1 = \\overline{(x_{11},y_{11}),(x_{12},y_{12})}$\u3068$s_2 = \\overline{(x_{21},y_{21}),(x_{22},y_{22})}$\u3068\u304c\u30af\u30ed\u30b9\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u8003\u3048\u307e\u3057\u305f\u3002\n\n$s_1$, $s_2$\u4e0a\u306e\u4efb\u610f\u306e\u70b9\u3092$t$\u3067\u8868\u3059\u3068\n\n```math\n\\begin{align}\np_1(t)&=( (t(x_{12}-x_{11})+x_{11}, t(y_{12}-y_{11})+y_{11} ) \\\\\np_2(t)&=( (t(x_{22}-x_{21})+x_{21}, t(y_{22}-y_{21})+y_{21} ) \\\\\n\\end{align}\n```\n\n\u305f\u3060\u3057 $0 \\le t \\le 1$ \u3067\u3059\u3002\n\n```math\n\\begin{align}\ndx_{1} &= x_{12}-x_{11} \\\\\ndx_{2} &= x_{22}-x_{21} \\\\\ndx_{a} &= x_{21}-x_{11}\n\\end{align}\n```\n\n\u3068\u304a\u304f\u3068\n\n```math\n\\begin{align}\np_1(t)&=(t \\cdot dx_{1} + x_{11}, t \\cdot dy_{1}+y_{11} ) \\\\\np_2(t)&=(t \\cdot dx_{2} + x_{21}, t \\cdot dy_{2}+y_{21} ) \\\\\n\\end{align}\n```\n\n\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u89e3\u4e0d\u80fd\u307e\u305f\u306f\u89e3\u4e0d\u5b9a\u306b\u306a\u308b\u6761\u4ef6\u306f\u3001\n\n```math\ndx_{2} \\cdot dy_{1} = dx_{1} \\cdot dy_{2}\n```\n\n\u3067\u3059\u3002\n\n\u3053\u308c\u4ee5\u5916\u306f\u30af\u30ed\u30b9\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u3001$t$\u306e\u5024\u306e\u691c\u8a0e\u306b\u3064\u306a\u304c\u3063\u3066\u3044\u304d\u307e\u3059\uff08\u524d\u56de\u306e\u8a18\u4e8b\u306b\u66f8\u3044\u3066\u3044\u307e\u3059\uff09\u3002\n\n## \u89e3\u4e0d\u80fd\u304b\u89e3\u4e0d\u5b9a\u304b\u306e\u5224\u5b9a\n\n\u89e3\u4e0d\u80fd\u306e\u5834\u5408\u306f\u3001\u5171\u6709\u90e8\u5206\u304c\u5168\u304f\u306a\u3044\u306e\u3067\u3001\u30a4\u30f3\u30bf\u30bb\u30af\u30c8\u3057\u307e\u305b\u3093\u3002\u89e3\u4e0d\u5b9a\u306e\u5834\u5408\u306f\u3001\u30a4\u30f3\u30bf\u30bb\u30af\u30c8\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\uff08\u533a\u9593\u306b\u3064\u3044\u3066\u306f\u5f8c\u8ff0\uff09\u3002\n\n$p_1(t_1)=p_2(t_2)$\u3068\u306a\u308b$t_1$, $t_2$\u3092\u6c42\u3081\u308b\u9014\u4e2d\u3067\u3001$t_2$\u306b\u3064\u3044\u3066\u89e3\u3044\u305f\u5f0f\u304c\u51fa\u307e\u3057\u305f\u3002\n\n```math\n\\begin{align}\nt_2 &= \\frac{t_1 \\cdot dx_{1}-dx_{a}}{dx_{2}} \\\\\nt_2 &= \\frac{t_1 \\cdot dy_{1}-dy_{a}}{dy_{2}}\n\\end{align}\n```\n\n\u3053\u3053\u304b\u3089\n\n```math\n\\begin{align}\n\\frac{t_1 \\cdot dx_{1}-dx_{a}}{dx_{2}} &= \\frac{t_1 \\cdot dy_{1}-dy_{a}}{dy_{2}} \\\\\nt_1 \\cdot dx_{1} \\cdot dy_{2} - dx_{a} \\cdot dy_{2} &= t_1 \\cdot dx_{2} \\cdot dy_{1} - dx_{2} \\cdot dy_{a}\n\\end{align}\n```\n\n\u89e3\u4e0d\u80fd\u307e\u305f\u306f\u89e3\u4e0d\u5b9a\u306b\u306a\u308b\u6761\u4ef6\u306f $dx_{2} \\cdot dy_{1} = dx_{1} \\cdot dy_{2}$ \u3067\u3042\u308b\u3068\u793a\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u5165\u308c\u8fbc\u307f\u307e\u3059\u3002\n\n```math\ndx_{2} \\cdot dy_{a} = dx_{a} \\cdot dy_{2}\n```\n\n\u3053\u3053\u3067$t_1$\u304c\u6d88\u3048\u307e\u3057\u305f\u3002\u4e0a\u306e\u7b49\u5f0f\u304c\u6e80\u305f\u3055\u308c\u308b\u3068\u89e3\u4e0d\u5b9a\uff08\u30a4\u30f3\u30bf\u30bb\u30af\u30c8\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\uff09\u3001\u305d\u3046\u3067\u306a\u3044\u306a\u3089\u89e3\u4e0d\u80fd\uff08\u30a4\u30f3\u30bf\u30bb\u30af\u30c8\u3057\u306a\u3044\uff09\u3068\u306a\u308a\u307e\u3059\u3002\n\n## \u533a\u9593\u306e\u5224\u5b9a\n\n\u7dda\u5206\u3067\u306a\u304f\u7121\u9650\u9060\u306b\u4f38\u3073\u308b\u76f4\u7dda\u306e\u5834\u5408\u306b\u306f\u3001\u3055\u304d\u307b\u3069\u5c0e\u3044\u305f$dx_{2} \\cdot dy_{a} = dx_{a} \\cdot dy_{2}$\u3092\u6e80\u305f\u3059\u3068\u3001\u3044\u305f\u308b\u3068\u3053\u308d\u3067\u5171\u6709\u90e8\u5206\u304c\u5b58\u5728\u3057\u307e\u3059\u3002\n\n\u3057\u304b\u3057\u3001\u3053\u3053\u3067\u6271\u3063\u3066\u3044\u308b\u306e\u306f\u7dda\u5206\u3067\u3059\u306e\u3067\u3001\u304a\u4e92\u3044\u306e\u533a\u9593\u5185\u306b\u5165\u3089\u306a\u3051\u308c\u3070\u3001\u5171\u6709\u90e8\u5206\u306f\u5b58\u5728\u3057\u307e\u305b\u3093\u3002\u3053\u3053\u304b\u3089\u306f\u3001\u533a\u9593\u306b\u3064\u3044\u3066\u691c\u8a0e\u3057\u307e\u3059\u3002\n\n$s_1 = \\overline{(x_{11},y_{11}),(x_{12},y_{12})}$\u306e\u533a\u9593\u5185\u306b$(x_{21}, y_{21})$\u307e\u305f\u306f$(x_{22}, y_{22})$\u304c\u5b58\u5728\u3059\u308c\u3070\u3001''ST_Overlaps(s1,s2)``\uff08\u3069\u3061\u3089\u304b\u4e00\u65b9\u304c\u5b58\u5728\uff09\u304b``ST_Covers(s1,s2)``\uff08\u4e21\u65b9\u5b58\u5728\uff09\u304c\u6210\u308a\u7acb\u3061\u307e\u3059\u3002\n\n\u305f\u3060\u3057\u3001``ST_Within(s1,s2)``\u306b\u3064\u3044\u3066\u306f\u691c\u8a0e\u3057\u3066\u3044\u307e\u305b\u3093\u3002\u3053\u308c\u3092\u30ab\u30d0\u30fc\u3059\u308b\u306b\u306f``ST_Covers(s2,s1)``\u306e\u30c1\u30a7\u30c3\u30af\u3092\u3059\u308c\u3070\u3044\u3044\u306e\u3067\u3001$s_2$\u306e\u533a\u9593\u5185\u306b$p_{11}$\u307e\u305f\u306f$p_{12}$\u304c\u3042\u308c\u3070\u3088\u3044\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n$s_1$\u306e\u533a\u9593\u5185\u306b$(x_{21}, y_{21})$\u304c\u3042\u308b\u304b\u3069\u3046\u304b\u306f\u3001\n\n```math\n\\begin{align}\nx_{21} &= t \\cdot dx_{1} + x_{11} \\\\\nt &= \\frac{x_{21}-x_{11}}{dx_{1}} \\\\\nt &= \\frac{dx_{a}}{dx_{1}}\n\\end{align}\n```\n\n\u3067\u3001\n\n```math\n0 \\le t \\le 1\n```\n\n\u3068\u306a\u308c\u3070\u3088\u3044\u3067\u3059\u3002\n\n\u307e\u305f\u306f\u3001y\u306b\u3064\u3044\u3066\u8a08\u7b97\u3057\u3066\u3001\n\n```math\nt=\\frac{dy_{a}}{dy_{1}}\n```\n\n\u3092\u4f7f\u3063\u3066\u3082\u3088\u3044\u3067\u3059\u3002\n\n$s_1$\u306e\u533a\u9593\u5185\u306b$(x_{22}, y_{22})$\u304c\u3042\u308b\u304b\u3069\u3046\u304b\u306f\u3001\n\n```math\n\\begin{align}\nt &= \\frac{x_{22}-x_{11}}{dx_{1}} \\\\\nt &= \\frac{y_{22}-y_{11}}{dy_{1}}\n\\end{align}\n```\n\n\u306e\u3044\u305a\u308c\u304b\u3067\u3001\n\n```math\n0 \\le t \\le 1\n```\n\n\u3068\u306a\u308c\u3070\u3088\u3044\u3067\u3059\u3002\n\n\n$s_2$\u306e\u533a\u9593\u5185\u306b$(x_{11}, y_{11})$\u307e\u305f\u306f$(x_{12}, y_{12})$\u304c\u3042\u308b\u304b\u3069\u3046\u304b\u306f\u3001\n\n```math\n\\begin{align}\nt &= \\frac{-x_{a}}{dx_{2}} \\\\\nt &=\\frac{-y_{a}}{dx_{2}} \\\\\nt &=\\frac{x_{12}-x_{21}}{dx_{2}} \\\\\nt &=\\frac{y_{12}-y_{21}}{dy_{2}}\n\\end{align}\n```\n\n\n\u306e\u3044\u305a\u308c\u304b\u3067\u3001\n\n```math\n0 \\le t \\le 1\n```\n\n\u3068\u306a\u308c\u3070\u3088\u3044\u3067\u3059\u3002 \n\n\u3053\u3053\u3067\u306f\u3001$t$\u306b\u95a2\u3057\u3066\u5408\u8a088\u3064\u306e\u5f0f\u304c\u51fa\u3066\u304d\u307e\u3057\u305f\u3002\u3053\u308c\u3089\u306e\u3046\u3061\u4e00\u3064\u3067\u3082\u6761\u4ef6\u3092\u6e80\u305f\u305b\u3070\u3001\u30a4\u30f3\u30bf\u30bb\u30af\u30c8\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n# \u5206\u6bcd\u304c\u30bc\u30ed\u3068\u306a\u308b\u5834\u5408\u306e\u691c\u8a0e\u306f\u4e0d\u8981\n\n\u672c\u6765\u306a\u3089\u5206\u6bcd\u304c0\u306e\u3068\u304d\u306e\u5834\u5408\u5206\u3051\u304c\u5fc5\u8981\u3068\u306a\u308a\u307e\u3059\u304c\u3001\u5206\u6bcd\u304c0\u306e\u3068\u304d\u306f$t$\u306f``NaN``\u306b\u306a\u308a\u307e\u3059\u3002$0 \\le t \\le 1$\u306f\u5fc5\u305a\u6e80\u305f\u3057\u307e\u305b\u3093\u306e\u3067\u3001\u653e\u7f6e\u3057\u3066\u3044\u307e\u3059\u3002\n\n# \u30b3\u30fc\u30c9\n\n```javascript\nfunction between01(v) {\n  return v >= 0 && v <= 1;\n}\n\nfunction intersects_ss(s1, s2) {\n  var p11 = s1[0];\n  var p12 = s1[1];\n  var p21 = s2[0];\n  var p22 = s2[1];\n  var x11 = p11[0];\n  var y11 = p11[1];\n  var x12 = p12[0];\n  var y12 = p12[1];\n  var x21 = p21[0];\n  var y21 = p21[1];\n  var x22 = p22[0];\n  var y22 = p22[1];\n  var dx1 = x12 - x11;\n  var dy1 = y12 - y11;\n  var dx2 = x22 - x21;\n  var dy2 = y22 - y21;\n  var dxa = x21 - x11;\n  var dya = y21 - y11;\n\n  var denom = dx1*dy2-dx2*dy1;\n  if( denom != 0 ) {\n    // crosses ?\n    var t1 = ( dxa*dy2-dya*dx2)/( dx1*dy2-dx2*dy1);\n    var t2 = (-dxa*dy1+dya*dx1)/(-dx1*dy2+dx2*dy1);\n    return t1 >= 0 && t1 <= 1 && t2 >= 0 && t2 <= 1;\n  }\n  else {\n    if( dx2*dya != dxa*dy2 ) {\n      // impossible\n      return false;\n    }\n    else {\n      // indefinite\n      return between01(dxa/dx1) ||\n        between01(dya/dy1) ||\n        between01((x22-x11)/dx1) ||\n        between01((y22-y11)/dy1) ||\n        between01(-dxa/dx2) ||\n        between01(-dya/dy2) ||\n        between01((x12-x21)/dx2) ||\n        between01((y12-y21)/dy2);\n    }\n  }\n}\n\nalert(intersects_ss([[10,10],[20,20]], [[20,10],[10,20]]));\nalert(intersects_ss([[10,10],[20,20]], [[0,0],[5,0]]));\nalert(intersects_ss([[10,10],[20,20]], [[110,110],[120,120]]));\nalert(intersects_ss([[11,11],[12,12]], [[10,10],[20,20]]));\nalert(intersects_ss([[10,10],[20,20]], [[20,20],[22,22]]));\nalert(intersects_ss([[10,10],[20,20]], [[21,21],[22,22]]));\n```\n", "tags": ["JavaScript", "\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0"]}