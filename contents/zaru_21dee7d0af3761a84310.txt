{"context": " More than 1 year has passed since last update.\u65e5\u4ed8\u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u305d\u306e\u65e5\u4ed8\u306b\u66f4\u65b0\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u6839\u3053\u305d\u304e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3002\u6307\u5b9a\u3057\u306a\u3044\u3068\u524d\u65e5\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3063\u3066\u3044\u3046\u611f\u3058\u306b\u52d5\u304f\u3002getObject()\u30671\u500b\u305a\u3064\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u3044\u308b\u3051\u3069\u3001\u3082\u3063\u3068\u3046\u307e\u3044\u3053\u3068\u307e\u3068\u3081\u3066\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u65b9\u6cd5\u306a\u3044\u306e\u304b\u306a\u3002downloadBucket()\u304c\u3044\u3044\u611f\u3058\u306b\u3067\u304d\u305d\u3046\u3060\u3051\u3069\u3001\u6761\u4ef6\u691c\u7d22\u3067\u304d\u306a\u3044\u2026\u3002\n$ get.php 2014-08-01\n\n\nget.php\n<?php\n\ninclude './aws.phar';\n\nuse Aws\\S3\\S3Client;\nuse Aws\\Common\\Enum\\Region;\n\n$bucketName = '\u30d0\u30b1\u30c3\u30c8\u540d';\n\n// \u65e5\u4ed8\u3092\u76f4\u63a5\u6307\u5b9a\u3057\u305f\u5834\u5408\nif (isset($argv['1']) && preg_match(\"/^[0-9]{4}\\-[0-9]{2}\\-[0-9]{2}$/\", $argv['1'])) {\n    $targetDate = $argv['1'];\n} else {\n    // \u524d\u65e5\u306e\u65e5\u4ed8\u3092\u8a2d\u5b9a\n    $currentDate = new DateTime('-1day');\n    $targetDate = $currentDate->format('Y-m-d');\n}\nif (!file_exists($targetDate)) {\n    mkdir($targetDate);\n}\necho $targetDate . \"\\n\";\n\n// \u30ad\u30fc\u3001\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u3001\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\n$client = S3Client::factory(array(\n    'key' => '\u30ad\u30fc',\n    'secret' => '\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc',\n    'region' => Region::AP_NORTHEAST_1\n));\n\n$result = $client->listObjects(array(\n    'Bucket' => $bucketName,\n    // 'Prefix' => 'hoge', // \u3053\u3053\u3067\u5bfe\u8c61\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3067\u304d\u308b\n));\n\n// \u30d5\u30a1\u30a4\u30eb\u306e\u4e00\u89a7\nforeach ($result['Contents'] as $object) {\n    $date = date('Y-m-d', strtotime($object['LastModified']));\n\n    // \u6307\u5b9a\u65e5\u306e\u753b\u50cf\u3092\u5bfe\u8c61\u306b\u3059\u308b\n    if ($date == $targetDate && $object['Size'] > 0) {\n        echo $object['Key'] . \"\\t\" . $object['LastModified'] . \"\\n\";\n\n        // \u306a\u3093\u304b\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u51e6\u7406\u3057\u305f\u308a\u3068\u304b\u2026\n        $fileName = $object['Key'];\n\n        // \u5bfe\u8c61\u30d5\u30a1\u30a4\u30eb\u306e\u60c5\u5831\u3092\u53d6\u5f97\n        $content = $client->getObject(array(\n            'Bucket' => $bucketName,\n            'Key'    => $object['Key'],\n        ));\n        $content['Body']->rewind();\n\n        // \u30d5\u30a1\u30a4\u30eb\u306e\u4fdd\u5b58\n        $fp = fopen($fileName, 'w');\n        fputs($fp, $content['Body']->read($content['ContentLength']));\n        fclose($fp);\n    }\n}\n\n\n\n\u65e5\u4ed8\u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u305d\u306e\u65e5\u4ed8\u306b\u66f4\u65b0\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u6839\u3053\u305d\u304e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3002\u6307\u5b9a\u3057\u306a\u3044\u3068\u524d\u65e5\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3063\u3066\u3044\u3046\u611f\u3058\u306b\u52d5\u304f\u3002getObject()\u30671\u500b\u305a\u3064\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u3044\u308b\u3051\u3069\u3001\u3082\u3063\u3068\u3046\u307e\u3044\u3053\u3068\u307e\u3068\u3081\u3066\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u65b9\u6cd5\u306a\u3044\u306e\u304b\u306a\u3002downloadBucket()\u304c\u3044\u3044\u611f\u3058\u306b\u3067\u304d\u305d\u3046\u3060\u3051\u3069\u3001\u6761\u4ef6\u691c\u7d22\u3067\u304d\u306a\u3044\u2026\u3002\n\n```\n$ get.php 2014-08-01\n```\n\n```get.php\n<?php\n\ninclude './aws.phar';\n\nuse Aws\\S3\\S3Client;\nuse Aws\\Common\\Enum\\Region;\n\n$bucketName = '\u30d0\u30b1\u30c3\u30c8\u540d';\n\n// \u65e5\u4ed8\u3092\u76f4\u63a5\u6307\u5b9a\u3057\u305f\u5834\u5408\nif (isset($argv['1']) && preg_match(\"/^[0-9]{4}\\-[0-9]{2}\\-[0-9]{2}$/\", $argv['1'])) {\n\t$targetDate = $argv['1'];\n} else {\n\t// \u524d\u65e5\u306e\u65e5\u4ed8\u3092\u8a2d\u5b9a\n\t$currentDate = new DateTime('-1day');\n\t$targetDate = $currentDate->format('Y-m-d');\n}\nif (!file_exists($targetDate)) {\n\tmkdir($targetDate);\n}\necho $targetDate . \"\\n\";\n\n// \u30ad\u30fc\u3001\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u3001\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\n$client = S3Client::factory(array(\n\t'key' => '\u30ad\u30fc',\n\t'secret' => '\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc',\n\t'region' => Region::AP_NORTHEAST_1\n));\n\n$result = $client->listObjects(array(\n\t'Bucket' => $bucketName,\n\t// 'Prefix' => 'hoge', // \u3053\u3053\u3067\u5bfe\u8c61\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3067\u304d\u308b\n));\n\n// \u30d5\u30a1\u30a4\u30eb\u306e\u4e00\u89a7\nforeach ($result['Contents'] as $object) {\n\t$date = date('Y-m-d', strtotime($object['LastModified']));\n\n\t// \u6307\u5b9a\u65e5\u306e\u753b\u50cf\u3092\u5bfe\u8c61\u306b\u3059\u308b\n\tif ($date == $targetDate && $object['Size'] > 0) {\n\t\techo $object['Key'] . \"\\t\" . $object['LastModified'] . \"\\n\";\n\n\t\t// \u306a\u3093\u304b\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u51e6\u7406\u3057\u305f\u308a\u3068\u304b\u2026\n\t\t$fileName = $object['Key'];\n\n\t\t// \u5bfe\u8c61\u30d5\u30a1\u30a4\u30eb\u306e\u60c5\u5831\u3092\u53d6\u5f97\n\t\t$content = $client->getObject(array(\n\t\t    'Bucket' => $bucketName,\n\t\t    'Key'    => $object['Key'],\n\t\t));\n\t\t$content['Body']->rewind();\n\n\t\t// \u30d5\u30a1\u30a4\u30eb\u306e\u4fdd\u5b58\n\t\t$fp = fopen($fileName, 'w');\n\t\tfputs($fp, $content['Body']->read($content['ContentLength']));\n\t\tfclose($fp);\n\t}\n}\n```\n", "tags": ["PHP", "AWS", "S3"]}