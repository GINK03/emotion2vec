{"context": " More than 1 year has passed since last update.\n\n\u8981\u7d04\n\nnodejs\u3067\u753b\u50cf\u751f\u6210\u3059\u308b\u306a\u3089\u3001\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u306eCanvas\u3068\u8a00\u3046\u624b\u6bb5\u304c\u3042\u308b\u3088\nhapijs\u3060\u3068path\u306e\u4f5c\u6210\u304c\u697d\u3060\u3088\nredis\u306b\u30d0\u30a4\u30ca\u30ea\u4fdd\u5b58\u3059\u308b\u3068\u304d\u306foption\u8a2d\u5b9a\u304c\u3044\u308b\u3088\n\n\n\u3053\u3068\u306e\u306f\u3058\u307e\u308a\n\u307f\u306a\u3055\u3093\u3069\u3046\u3084\u3063\u3066\u5927\u91cf\u306e\u30c7\u30fc\u30bf\u3092\u4eba\u306e\u76ee\u3067\u78ba\u8a8d\u3059\u308b\u3067\u3057\u3087\u3046\u304b\u3002\n\u30c6\u30fc\u30d6\u30eb\u751f\u6210\u3057\u3066\u76ee\u8996?\u3000\u306a\u308b\u307b\u3069\u3001\u3044\u3044\u3067\u3059\u306d\u3002\u3067\u3059\u304c\u3059\u3079\u3066\u306e\u30e6\u30fc\u30b6\u304c\u773cgrep\u3092\u5f97\u610f\u3068\u3059\u308b\u4eba\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u30c7\u30fc\u30bf\u304c\u3042\u308b\u7a0b\u5ea6\u5897\u3048\u3066\u304f\u308b\u3068\u3001\u30c1\u30e3\u30fc\u30c8\u3084\u753b\u50cf\u306e\u65b9\u304c\u305a\u3063\u3068\u5206\u304b\u308a\u3084\u3059\u3044\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002\n\u4eca\u56de\u306fnodejs\u3067\u753b\u50cf\u751f\u6210\u3064\u3044\u3067\u306bhapi\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3068redis\u3067\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u753b\u50cf\u751f\u6210Server\n\u6700\u521d\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u3067canvas\u3092\u4f7f\u3046\u3068\u8a00\u3046\u624b\u3082\u8003\u3048\u307e\u3057\u305f\u3002\n\u30d6\u30e9\u30a6\u30b6\u4e0a\u3067\u8868\u793a\u304c\u5236\u5fa1\u3067\u304d\u308c\u3070\u3044\u3044\u3093\u3058\u3083\u306a\u3044\u304b\u3068\u8a00\u3046\u306e\u3082\u3042\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u64cd\u4f5c\u304c\u5897\u3048\u308b\u306e\u304c\u5acc\u7159\u3055\u308c\u3066\u3044\u305f\u306e\u3067\u5374\u4e0b\u3002\n\u3057\u304b\u3057\u5bfe\u8c61\u306e\u753b\u50cf\u3092\u3059\u3079\u3066\u8868\u793a\u3057\u3088\u3046\u3068\u601d\u3046\u30681page\u3042\u305f\u308a100-300\u679a\u307b\u3069\u3042\u308a\u3001\u5168\u90e8\u3092\u30d6\u30e9\u30a6\u30b6\u3067\u3068\u8a00\u3046\u306e\u306f\u73fe\u5b9f\u7684\u3067\u306a\u3044\u305f\u3081\u30b5\u30fc\u30d0\u3067\u753b\u50cf\u751f\u6210\u3092\u884c\u3044\u5f8c\u8ff0\u3059\u308b\u3088\u3046\u306b\u4e00\u90e8\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u3059\u308b\u3068\u8a00\u3046\u65b9\u5f0f\u3092\u53d6\u308a\u307e\u3057\u305f\u3002\n\u5e78\u3044\u306a\u3053\u3068\u306bcanvas module\u304c\u5b58\u5728\u3057\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u3067\u3084\u308b\u306e\u3068\u307b\u3068\u3093\u3069\u5909\u308f\u3089\u305a\u306b\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\nCanvas Install\nCanvas\u306fNative module\u306a\u306e\u3067build\u3059\u308b\u305f\u3081\u306b\u30e9\u30a4\u30d6\u30e9\u30ea\u3084VS\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5fc5\u8981\u3067\u3059\u3002\n\u672c\u5bb6\u89e3\u8aac\u306b\u30ea\u30f3\u30af\u5148\u304c\u8cbc\u3063\u3066\u3042\u308b\u306e\u3067\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u4eca\u56de\u306fWindows\u3092\u60f3\u5b9a\u3057\u3066\u9032\u3081\u307e\u3059\u3002\n\nPython2.7\u7cfb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nVisual Studio 2013\u3092install\u3059\u308b\nGTK 2\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\n\n\nC:\\GTK \u306a\u3069\u9069\u5f53\u306a\u30d5\u30a9\u30eb\u30c0\u306bzip\u3092\u89e3\u51cd\npath\u3092\u901a\u3059\n\n\nlibjpeg-turbo\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\nnpm install canvas \u304c\u6210\u529f\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n\nOS\u3068nodejs(\u305f\u3076\u3093\u6b63\u78ba\u306b\u306fV8)\u306eversion\u304c\u3042\u3063\u3066\u3044\u308c\u3070\u30d3\u30eb\u30c9\u6e08\u307f\u306e\u30d0\u30a4\u30ca\u30ea\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u3044\u56de\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u3067\u3001\n\u8907\u6570\u7acb\u3066\u308b\u3068\u304d\u306b\u306f\u4e00\u53f0\u3067\u30d3\u30eb\u30c9\u3057\u3066\u305d\u308c\u3092\u30b3\u30d4\u30fc\u3059\u308b\u306e\u304c\u697d\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\nCanvas\u3092\u3064\u304b\u3046\n\u4f7f\u3044\u65b9\u306f\u30d6\u30e9\u30a6\u30b6\u3068\u540c\u3058\u3067Context\u3092\u751f\u6210\u3057\u3066\u63cf\u753b\u3092\u884c\u3044\u3001png\u304bjpeg\u3092buffer/DataURL\u3067\u66f8\u304d\u51fa\u3057\u3066\u4f7f\u3044\u307e\u3059\u3002\n\n\n\nMethod\ndescription\n\n\n\n\npngStream()\npng\u5f62\u5f0f\u3067Stream\u66f8\u304d\u51fa\u3057\n\n\njpegStream(opt)\njpeg\u5f62\u5f0f\u3067Stream\u66f8\u304d\u51fa\u3057\n\n\ntoBuffer()\npng\u5f62\u5f0f\u3067\u540c\u671f\u66f8\u304d\u51fa\u3057\n\n\ntoBuffer(callback(err, buf))\npng\u5f62\u5f0f\u3067\u975e\u540c\u671f\u66f8\u304d\u51fa\u3057\n\n\ntoDataURL(['image/png'])\nDataURL\u3067\u540c\u671f\u66f8\u304d\u51fa\u3057\n\n\ntoDataURL('image/png', [opt], callback(err, img))\nDataURL\u3067\u975e\u540c\u671f\u66f8\u304d\u51fa\u3057\n\n\n\n\u63cf\u753b\u4f8b\nconst Canvas = require('canvas');\n\n// Context\u751f\u6210\nlet image = Canvas.image;\nlet canvas = new Canvas(200,200);\nlet ctx = canvas.getContext('2d');\n\n// \u6587\u5b57\u63cf\u753b\nctx.font = \"30px Lato\"\nctx.rotate(.1);\nctx.fillText('Canvas', 50, 100);\n\n// \u30e9\u30a4\u30f3\u63cf\u753b\nlet te = ctx.measureText('Canvas');\nctx.stroke.style = 'rgba(0,0,0,0.7)'\nctx.beginPath();\nctx.lineTo(50,102);\nctx.lineTo(50 + te.width, 102);\nctx.stroke();\n\n// \u66f8\u304d\u51fa\u3057\ncanvas.toBuffer((err, buf)=>{\n  fs.writeFile(\"image.png\", buf);\n})\n\n\nimage.png\n\n\nhapijs\nhttp\u30b5\u30fc\u30d0\u30fc\u3068\u3044\u3048\u3070express\u304c\u3068\u3066\u3082\u4f5c\u308a\u3084\u3059\u3044\u3067\u3059\u304c\u4eca\u56de\u306fhapijs\u3092\u9078\u629e\u3002\n\u306a\u305c\u9078\u3093\u3060\u304b\u3068\u3044\u3046\u3068\n\nHapi.js\u3067Happy Coding - Part1: \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3068Swagger\u30d7\u30e9\u30b0\u30a4\u30f3(masato\u3055\u3093)\n\n\u3067hapi-swagger\u306e\u5b58\u5728\u304c\u6c17\u306b\u306a\u3063\u305f\u304b\u3089\u3068\u8a00\u3046\u3082\u306e\u3067\u3059\u304c\u5b9f\u969b\u3001\n\nrouting\u306e\u7ba1\u7406\u304c\u3057\u3084\u3059\u3044\n\njoi\u3092\u3064\u304b\u3063\u305fparam/query\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u304c\u697d\n\n\u3068\u8a00\u3046\u3042\u305f\u308a\u304c\u5b09\u3057\u3044\u611f\u304c\u3042\u308b\u3002\n\u3057\u304b\u3057\u79fb\u884c\u3059\u308b\u306b\u306fplugin\u3082\u4f7f\u3044\u65b9\u3082\u5927\u304d\u304f\u5909\u308f\u308b\u306e\u3067\u8a2d\u5b9a\u65b9\u6cd5\u306a\u3069\u5b66\u3076\u3053\u3068\u304c\u591a\u304f\n\u307e\u3060\u628a\u63e1\u3057\u304d\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u8a9e\u308c\u307e\u305b\u3093\u3002\n\u3068\u308a\u3042\u3048\u305aID\u3068number\u30671URL=1\u753b\u50cf\u751f\u6210\u306b\u306a\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3002\nconst lib = require('../lib/image');\n\nserver.route({\n    method: 'GET',\n    path: '/image/{id}/{num}',\n\n    // config \u306btags\u3068validate\u3092\u8a2d\u5b9a\u3002swagger\u306b\u3082\u53cd\u6620\u3055\u308c\u308b\n    config: {\n        tags: [\"api\", \"image\"],\n        validate: {\n            params: {\n                id: Joi.string().regex(/^[a-zA-Z0-9]{3,20}$/),\n                num: Joi.number().integer().min(10).max(1000),\n            }\n        }\n    }\n    handler: (req, rep)=>{\n        lib(req.params,(err, buf)~>{\n            rep(buf).type('image/png');\n        })\n    }\n});\n\n\n\nredis\u3067\u30ad\u30e3\u30c3\u30b7\u30e5\n\u753b\u50cf\u751f\u6210\u30b5\u30fc\u30d0\u306f\u3067\u304d\u307e\u3057\u305f\u304c\u672c\u756a\u74b0\u5883\u306e\u5b9f\u6e2c\u3067\u306f\u751f\u6210\u306b1\u679a\u3042\u305f\u308a100-200ms\u7a0b\u5ea6\u304b\u304b\u3063\u3066\u304a\u308a\u30011page(200\u679a\u524d\u5f8c)\u306710-20sec...\u5e38\u6642\u3053\u308c\u3067\u306f\u4f7f\u3044\u7269\u306b\u306a\u308a\u307e\u305b\u3093\u3002\u751f\u6210\u30b5\u30fc\u30d0\u30fc\u3092\u4e26\u5217\u306b\u3057\u3066\u5358\u4f4d\u6642\u9593\u3042\u305f\u308a\u306e\u751f\u6210\u6570\u3092\u5897\u3084\u3057\u3001\u751f\u6210\u5f8c\u306fredis\u306b\u4e00\u5b9a\u6642\u9593\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n\u4f7f\u3044\u65b9\u4e91\u3005\u306f\u307b\u304b\u3092\u898b\u3066\u3082\u3089\u3046\u3068\u3057\u3066\u8e93\u3044\u305f\u70b9\n\n\u66f8\u304d\u8fbc\u3093\u3060\u30d0\u30a4\u30ca\u30ea\u304c\u58ca\u308c\u3066\u3044\u308b\nredis\u304c\u6b7b\u3093\u3060\u3089App\u3082\u6b7b\u306c\n\n\u306b\u5bfe\u3059\u308b\u5bfe\u5fdc\u306b\u3064\u3044\u3066\u3060\u3051\u8a71\u3057\u307e\u3059\u3002\u30d1\u30c3\u30b1\u30fc\u30b8\u306fnode redis\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n\u30d0\u30a4\u30ca\u30ea\u304c\u58ca\u308c\u308b\nredis-cli\u3067\u898b\u305f\u3089\u5b58\u5728\u3059\u308b\u306e\u306bnodejs\u3067\u8aad\u307f\u51fa\u3057\u3066\u307f\u305f\u3089\u58ca\u308c\u3066\u3044\u308b\u3068\u3044\u3046\u306e\u306b\u30cf\u30de\u308a\u307e\u3057\u305f\u3002\n\u5b9f\u969bdata.length\u3092\u898b\u308b\u3068\u5c0f\u3055\u304f\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u5148\u4eba\u304c\u8a18\u9332\u3092\u6b8b\u3057\u3066\u304f\u308c\u3066\u3044\u307e\u3057\u305f\u3002\n\nnode_redis\u3067\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u304c\u4e0a\u624b\u304f\u8aad\u307f\u53d6\u308c\u306a\u3044\n\nnode redis\u3067\u30d0\u30a4\u30ca\u30ea\u3092\u8aad\u307f\u66f8\u304d\u3059\u308b\u5834\u5408\u306foption\u306e\u8a2d\u5b9a\u306b detect_buffers \u3092\u8ffd\u52a0\u3057\u3001key\u306ebuffer\u3067\u5165\u529b\u3059\u308b\u3068Buffer\u306e\u30c7\u30fc\u30bf\u5f62\u5f0f\u304c\u3068\u308c\u307e\u3057\u305f\u3002\u3061\u306a\u307f\u306breturn_buffers\u3092true\u306b\u3059\u308c\u3070\u3059\u3079\u3066\u30d0\u30a4\u30ca\u30ea\u3067\u8fd4\u3063\u3066\u304f\u308b\u3088\u3046\u3067\u3059\u3002\nconst redis = require('redis');\nconst client = redis.createClient({detect_buffers:true});  // detect_buffes\u3092true\u306b\u3059\u308b\n\n// client.setex(\"key\", exipre, data) // \u6587\u5b57\u5217\u3084\u6570\u5b57\u306a\u3069\u306f\u6587\u5b57\u5217\u3067\u3088\u3044\nclient.setex(new Buffer(\"key\"), exipre, data) // key\u3092Buffer\u306b\u5909\u63db\n\n\nredis\u304c\u6b7b\u3093\u3060\u3089App\u3082\u843d\u3061\u308b\n\u5358\u7d14\u306bcllient\u3092\u4f5c\u3063\u305f\u3060\u3051\u3060\u3068redis\u304c\u6b7b\u3093\u3060\u3068\u304d\u306b\u4e00\u7dd2\u306b\u843d\u3061\u307e\u3059\u3002\n\u9053\u9023\u308c\u306b\u3055\u308c\u308b\u3088\u308a\u306f\u9045\u304f\u3066\u3082\u751f\u6210\u3067\u304d\u308b\u65b9\u304c\u30de\u30b7\u306a\u306e\u3067\u5bfe\u5fdc\u3002\n\u4e00\u3064\u306fClient.on('error',(err))\u3092\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u3053\u3068\u3002\u30ea\u30b9\u30ca\u30fc\u304c\u3044\u306a\u3044\u3068\u4f8b\u5916\u304c\u98db\u3093\u3067\u843d\u3061\u307e\u3059\u3002\n\u3082\u3046\u4e00\u3064\u306fget\u306e\u524d\u306b\u751f\u5b58\u78ba\u8a8d\u3092\u631f\u3093\u3067\u3001\u6b7b\u3093\u3067\u308b\u5834\u5408\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u5468\u308a\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059\u3002\nclient.on(\"error\", function (err) {\n    console.error(\"Error \" + err);\n});\n\n\nif(!client.connected) return fn(cb); // \u672a\u63a5\u7d9a\u306a\u3089cache\u306e\u78ba\u8a8d\u3092\u305b\u305a\u306b\u751f\u6210\u3057\u3066\u8fd4\u3059\u306a\u3069\nclient.get(key,(err, buf)=>{\n    // hoeghoge\n})\n\n\n\u3055\u3044\u3054\u306b\nhapijs\u306f\u6c17\u304c\u52b9\u3044\u3066\u3044\u3044\u3088\u3068\u3044\u3046\u8a71\u3067\u3057\u305f\u3002\n\u307e\u3060\u4f7f\u3044\u3053\u306a\u305b\u3066\u306a\u3044\u306e\u3067(\u7279\u306b\u30ed\u30b0\u5468\u308a\u306e\u30b1\u30a2\u304c...)\u3057\u3070\u3089\u304f\u5b9f\u9a13\u304c\u5fc5\u8981\u3002\n\u4eca\u56de\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3068heroku\u3092\u7528\u610f\u3057\u3066\u3044\u308b\u306e\u3067\u4e0b\u8a18\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u4eca\u56de\u521d\u3081\u3066\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u304cheroku\u306e\u30c7\u30d7\u30ed\u30a4\u3063\u3066\u3059\u3054\u304f\u697d\u3067\u3059\u306d!\nredis\u306f\u30bf\u30c0\u3067\u7528\u610f\u3059\u308b\u65b9\u6cd5\u304c\u3059\u3050\u306b\u898b\u3064\u304b\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u672a\u9069\u7528\u3002\n\nheroku\nRepository\n\n\n## \u8981\u7d04\n\n1. nodejs\u3067\u753b\u50cf\u751f\u6210\u3059\u308b\u306a\u3089\u3001\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u306eCanvas\u3068\u8a00\u3046\u624b\u6bb5\u304c\u3042\u308b\u3088\n2. hapijs\u3060\u3068path\u306e\u4f5c\u6210\u304c\u697d\u3060\u3088\n3. redis\u306b\u30d0\u30a4\u30ca\u30ea\u4fdd\u5b58\u3059\u308b\u3068\u304d\u306foption\u8a2d\u5b9a\u304c\u3044\u308b\u3088\n\n\n## \u3053\u3068\u306e\u306f\u3058\u307e\u308a\n\n\u307f\u306a\u3055\u3093\u3069\u3046\u3084\u3063\u3066\u5927\u91cf\u306e\u30c7\u30fc\u30bf\u3092\u4eba\u306e\u76ee\u3067\u78ba\u8a8d\u3059\u308b\u3067\u3057\u3087\u3046\u304b\u3002\n\u30c6\u30fc\u30d6\u30eb\u751f\u6210\u3057\u3066\u76ee\u8996?\u3000\u306a\u308b\u307b\u3069\u3001\u3044\u3044\u3067\u3059\u306d\u3002\u3067\u3059\u304c\u3059\u3079\u3066\u306e\u30e6\u30fc\u30b6\u304c\u773cgrep\u3092\u5f97\u610f\u3068\u3059\u308b\u4eba\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u30c7\u30fc\u30bf\u304c\u3042\u308b\u7a0b\u5ea6\u5897\u3048\u3066\u304f\u308b\u3068\u3001\u30c1\u30e3\u30fc\u30c8\u3084\u753b\u50cf\u306e\u65b9\u304c\u305a\u3063\u3068\u5206\u304b\u308a\u3084\u3059\u3044\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002\n\u4eca\u56de\u306fnodejs\u3067\u753b\u50cf\u751f\u6210\u3064\u3044\u3067\u306bhapi\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3068redis\u3067\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\n## \u753b\u50cf\u751f\u6210Server\n\n\u6700\u521d\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u3067canvas\u3092\u4f7f\u3046\u3068\u8a00\u3046\u624b\u3082\u8003\u3048\u307e\u3057\u305f\u3002\n\u30d6\u30e9\u30a6\u30b6\u4e0a\u3067\u8868\u793a\u304c\u5236\u5fa1\u3067\u304d\u308c\u3070\u3044\u3044\u3093\u3058\u3083\u306a\u3044\u304b\u3068\u8a00\u3046\u306e\u3082\u3042\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u64cd\u4f5c\u304c\u5897\u3048\u308b\u306e\u304c\u5acc\u7159\u3055\u308c\u3066\u3044\u305f\u306e\u3067\u5374\u4e0b\u3002\n\u3057\u304b\u3057\u5bfe\u8c61\u306e\u753b\u50cf\u3092\u3059\u3079\u3066\u8868\u793a\u3057\u3088\u3046\u3068\u601d\u3046\u30681page\u3042\u305f\u308a100-300\u679a\u307b\u3069\u3042\u308a\u3001\u5168\u90e8\u3092\u30d6\u30e9\u30a6\u30b6\u3067\u3068\u8a00\u3046\u306e\u306f\u73fe\u5b9f\u7684\u3067\u306a\u3044\u305f\u3081\u30b5\u30fc\u30d0\u3067\u753b\u50cf\u751f\u6210\u3092\u884c\u3044\u5f8c\u8ff0\u3059\u308b\u3088\u3046\u306b\u4e00\u90e8\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u3059\u308b\u3068\u8a00\u3046\u65b9\u5f0f\u3092\u53d6\u308a\u307e\u3057\u305f\u3002\n\u5e78\u3044\u306a\u3053\u3068\u306b[canvas module](https://www.npmjs.com/package/canvas)\u304c\u5b58\u5728\u3057\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u3067\u3084\u308b\u306e\u3068\u307b\u3068\u3093\u3069\u5909\u308f\u3089\u305a\u306b\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n### Canvas Install\n\nCanvas\u306fNative module\u306a\u306e\u3067build\u3059\u308b\u305f\u3081\u306b\u30e9\u30a4\u30d6\u30e9\u30ea\u3084VS\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5fc5\u8981\u3067\u3059\u3002\n[\u672c\u5bb6\u89e3\u8aac](https://github.com/Automattic/node-canvas/wiki/Installation---Windows)\u306b\u30ea\u30f3\u30af\u5148\u304c\u8cbc\u3063\u3066\u3042\u308b\u306e\u3067\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u4eca\u56de\u306fWindows\u3092\u60f3\u5b9a\u3057\u3066\u9032\u3081\u307e\u3059\u3002\n\n1. Python2.7\u7cfb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n2. Visual Studio 2013\u3092install\u3059\u308b\n3. GTK 2\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n  * `C:\\GTK` \u306a\u3069\u9069\u5f53\u306a\u30d5\u30a9\u30eb\u30c0\u306bzip\u3092\u89e3\u51cd\n  * path\u3092\u901a\u3059\n4. libjpeg-turbo\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n5. `npm install canvas` \u304c\u6210\u529f\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n\nOS\u3068nodejs(\u305f\u3076\u3093\u6b63\u78ba\u306b\u306fV8)\u306eversion\u304c\u3042\u3063\u3066\u3044\u308c\u3070\u30d3\u30eb\u30c9\u6e08\u307f\u306e\u30d0\u30a4\u30ca\u30ea\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u3044\u56de\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u3067\u3001\n\u8907\u6570\u7acb\u3066\u308b\u3068\u304d\u306b\u306f\u4e00\u53f0\u3067\u30d3\u30eb\u30c9\u3057\u3066\u305d\u308c\u3092\u30b3\u30d4\u30fc\u3059\u308b\u306e\u304c\u697d\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n### Canvas\u3092\u3064\u304b\u3046\n\n\u4f7f\u3044\u65b9\u306f\u30d6\u30e9\u30a6\u30b6\u3068\u540c\u3058\u3067Context\u3092\u751f\u6210\u3057\u3066\u63cf\u753b\u3092\u884c\u3044\u3001png\u304bjpeg\u3092buffer/DataURL\u3067\u66f8\u304d\u51fa\u3057\u3066\u4f7f\u3044\u307e\u3059\u3002\n\n|Method|description|\n|:---|:---|\n|pngStream()|png\u5f62\u5f0f\u3067Stream\u66f8\u304d\u51fa\u3057|\n|jpegStream(opt)|jpeg\u5f62\u5f0f\u3067Stream\u66f8\u304d\u51fa\u3057|\n|toBuffer()|png\u5f62\u5f0f\u3067\u540c\u671f\u66f8\u304d\u51fa\u3057|\n|toBuffer(callback(err, buf))|png\u5f62\u5f0f\u3067\u975e\u540c\u671f\u66f8\u304d\u51fa\u3057|\n|toDataURL(['image/png'])|DataURL\u3067\u540c\u671f\u66f8\u304d\u51fa\u3057|\n|toDataURL('image/png', [opt], callback(err, img))|DataURL\u3067\u975e\u540c\u671f\u66f8\u304d\u51fa\u3057|\n\n\u63cf\u753b\u4f8b\n\n```\nconst Canvas = require('canvas');\n\n// Context\u751f\u6210\nlet image = Canvas.image;\nlet canvas = new Canvas(200,200);\nlet ctx = canvas.getContext('2d');\n\n// \u6587\u5b57\u63cf\u753b\nctx.font = \"30px Lato\"\nctx.rotate(.1);\nctx.fillText('Canvas', 50, 100);\n\n// \u30e9\u30a4\u30f3\u63cf\u753b\nlet te = ctx.measureText('Canvas');\nctx.stroke.style = 'rgba(0,0,0,0.7)'\nctx.beginPath();\nctx.lineTo(50,102);\nctx.lineTo(50 + te.width, 102);\nctx.stroke();\n\n// \u66f8\u304d\u51fa\u3057\ncanvas.toBuffer((err, buf)=>{\n  fs.writeFile(\"image.png\", buf);\n})\n\n```\nimage.png\n![test.png](https://qiita-image-store.s3.amazonaws.com/0/92809/f22714c6-8db2-999f-8ad9-8c91cb316795.png)\n\n\n## hapijs\n\nhttp\u30b5\u30fc\u30d0\u30fc\u3068\u3044\u3048\u3070[express](https://www.npmjs.com/package/express)\u304c\u3068\u3066\u3082\u4f5c\u308a\u3084\u3059\u3044\u3067\u3059\u304c\u4eca\u56de\u306fhapijs\u3092\u9078\u629e\u3002\n\u306a\u305c\u9078\u3093\u3060\u304b\u3068\u3044\u3046\u3068\n>[Hapi.js\u3067Happy Coding - Part1: \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3068Swagger\u30d7\u30e9\u30b0\u30a4\u30f3(masato\u3055\u3093)](http://qiita.com/masato/items/87c2bbcf506a729b706b)\n\n\u3067[hapi-swagger](https://www.npmjs.com/package/hapi-swagger)\u306e\u5b58\u5728\u304c\u6c17\u306b\u306a\u3063\u305f\u304b\u3089\u3068\u8a00\u3046\u3082\u306e\u3067\u3059\u304c\u5b9f\u969b\u3001\n\n1. routing\u306e\u7ba1\u7406\u304c\u3057\u3084\u3059\u3044\n2. [joi](https://www.npmjs.com/package/joi)\u3092\u3064\u304b\u3063\u305fparam/query\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u304c\u697d\n\n\u3068\u8a00\u3046\u3042\u305f\u308a\u304c\u5b09\u3057\u3044\u611f\u304c\u3042\u308b\u3002\n\u3057\u304b\u3057\u79fb\u884c\u3059\u308b\u306b\u306fplugin\u3082\u4f7f\u3044\u65b9\u3082\u5927\u304d\u304f\u5909\u308f\u308b\u306e\u3067\u8a2d\u5b9a\u65b9\u6cd5\u306a\u3069\u5b66\u3076\u3053\u3068\u304c\u591a\u304f\n\u307e\u3060\u628a\u63e1\u3057\u304d\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u8a9e\u308c\u307e\u305b\u3093\u3002\n\n\u3068\u308a\u3042\u3048\u305aID\u3068number\u30671URL=1\u753b\u50cf\u751f\u6210\u306b\u306a\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3002\n\n```\nconst lib = require('../lib/image');\n\nserver.route({\n\tmethod: 'GET',\n\tpath: '/image/{id}/{num}',\n\n\t// config \u306btags\u3068validate\u3092\u8a2d\u5b9a\u3002swagger\u306b\u3082\u53cd\u6620\u3055\u308c\u308b\n\tconfig: {\n\t\ttags: [\"api\", \"image\"],\n\t\tvalidate: {\n\t\t\tparams: {\n\t\t\t\tid: Joi.string().regex(/^[a-zA-Z0-9]{3,20}$/),\n\t\t\t\tnum: Joi.number().integer().min(10).max(1000),\n\t\t\t}\n\t\t}\n\t}\n\thandler: (req, rep)=>{\n\t\tlib(req.params,(err, buf)~>{\n\t\t\trep(buf).type('image/png');\n\t\t})\n\t}\n});\n\n```\n## redis\u3067\u30ad\u30e3\u30c3\u30b7\u30e5\n\n\u753b\u50cf\u751f\u6210\u30b5\u30fc\u30d0\u306f\u3067\u304d\u307e\u3057\u305f\u304c\u672c\u756a\u74b0\u5883\u306e\u5b9f\u6e2c\u3067\u306f\u751f\u6210\u306b1\u679a\u3042\u305f\u308a100-200ms\u7a0b\u5ea6\u304b\u304b\u3063\u3066\u304a\u308a\u30011page(200\u679a\u524d\u5f8c)\u306710-20sec...\u5e38\u6642\u3053\u308c\u3067\u306f\u4f7f\u3044\u7269\u306b\u306a\u308a\u307e\u305b\u3093\u3002\u751f\u6210\u30b5\u30fc\u30d0\u30fc\u3092\u4e26\u5217\u306b\u3057\u3066\u5358\u4f4d\u6642\u9593\u3042\u305f\u308a\u306e\u751f\u6210\u6570\u3092\u5897\u3084\u3057\u3001\u751f\u6210\u5f8c\u306fredis\u306b\u4e00\u5b9a\u6642\u9593\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n![system.dot.png](https://qiita-image-store.s3.amazonaws.com/0/92809/086c9d8f-b500-0e3c-510d-f87cad52ade6.png)\n\n\u4f7f\u3044\u65b9\u4e91\u3005\u306f\u307b\u304b\u3092\u898b\u3066\u3082\u3089\u3046\u3068\u3057\u3066\u8e93\u3044\u305f\u70b9\n\n1. \u66f8\u304d\u8fbc\u3093\u3060\u30d0\u30a4\u30ca\u30ea\u304c\u58ca\u308c\u3066\u3044\u308b\n2. redis\u304c\u6b7b\u3093\u3060\u3089App\u3082\u6b7b\u306c\n\n\u306b\u5bfe\u3059\u308b\u5bfe\u5fdc\u306b\u3064\u3044\u3066\u3060\u3051\u8a71\u3057\u307e\u3059\u3002\u30d1\u30c3\u30b1\u30fc\u30b8\u306f[node redis](https://www.npmjs.com/package/redis)\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n#### \u30d0\u30a4\u30ca\u30ea\u304c\u58ca\u308c\u308b\n\nredis-cli\u3067\u898b\u305f\u3089\u5b58\u5728\u3059\u308b\u306e\u306bnodejs\u3067\u8aad\u307f\u51fa\u3057\u3066\u307f\u305f\u3089\u58ca\u308c\u3066\u3044\u308b\u3068\u3044\u3046\u306e\u306b\u30cf\u30de\u308a\u307e\u3057\u305f\u3002\n\u5b9f\u969bdata.length\u3092\u898b\u308b\u3068\u5c0f\u3055\u304f\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u5148\u4eba\u304c\u8a18\u9332\u3092\u6b8b\u3057\u3066\u304f\u308c\u3066\u3044\u307e\u3057\u305f\u3002\n\n> [node_redis\u3067\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u304c\u4e0a\u624b\u304f\u8aad\u307f\u53d6\u308c\u306a\u3044](http://takeswim.hateblo.jp/entry/2013/05/10/111306)\n\nnode redis\u3067\u30d0\u30a4\u30ca\u30ea\u3092\u8aad\u307f\u66f8\u304d\u3059\u308b\u5834\u5408\u306foption\u306e\u8a2d\u5b9a\u306b `detect_buffers` \u3092\u8ffd\u52a0\u3057\u3001key\u306ebuffer\u3067\u5165\u529b\u3059\u308b\u3068Buffer\u306e\u30c7\u30fc\u30bf\u5f62\u5f0f\u304c\u3068\u308c\u307e\u3057\u305f\u3002\u3061\u306a\u307f\u306b`return_buffers`\u3092true\u306b\u3059\u308c\u3070\u3059\u3079\u3066\u30d0\u30a4\u30ca\u30ea\u3067\u8fd4\u3063\u3066\u304f\u308b\u3088\u3046\u3067\u3059\u3002\n\n```\nconst redis = require('redis');\nconst client = redis.createClient({detect_buffers:true});  // detect_buffes\u3092true\u306b\u3059\u308b\n\n// client.setex(\"key\", exipre, data) // \u6587\u5b57\u5217\u3084\u6570\u5b57\u306a\u3069\u306f\u6587\u5b57\u5217\u3067\u3088\u3044\nclient.setex(new Buffer(\"key\"), exipre, data) // key\u3092Buffer\u306b\u5909\u63db\n```\n\n#### redis\u304c\u6b7b\u3093\u3060\u3089App\u3082\u843d\u3061\u308b\n\n\u5358\u7d14\u306bcllient\u3092\u4f5c\u3063\u305f\u3060\u3051\u3060\u3068redis\u304c\u6b7b\u3093\u3060\u3068\u304d\u306b\u4e00\u7dd2\u306b\u843d\u3061\u307e\u3059\u3002\n\u9053\u9023\u308c\u306b\u3055\u308c\u308b\u3088\u308a\u306f\u9045\u304f\u3066\u3082\u751f\u6210\u3067\u304d\u308b\u65b9\u304c\u30de\u30b7\u306a\u306e\u3067\u5bfe\u5fdc\u3002\n\u4e00\u3064\u306f`Client.on('error',(err))`\u3092\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u3053\u3068\u3002\u30ea\u30b9\u30ca\u30fc\u304c\u3044\u306a\u3044\u3068\u4f8b\u5916\u304c\u98db\u3093\u3067\u843d\u3061\u307e\u3059\u3002\n\u3082\u3046\u4e00\u3064\u306fget\u306e\u524d\u306b\u751f\u5b58\u78ba\u8a8d\u3092\u631f\u3093\u3067\u3001\u6b7b\u3093\u3067\u308b\u5834\u5408\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u5468\u308a\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059\u3002\n\n```\nclient.on(\"error\", function (err) {\n\tconsole.error(\"Error \" + err);\n});\n\n\nif(!client.connected) return fn(cb); // \u672a\u63a5\u7d9a\u306a\u3089cache\u306e\u78ba\u8a8d\u3092\u305b\u305a\u306b\u751f\u6210\u3057\u3066\u8fd4\u3059\u306a\u3069\nclient.get(key,(err, buf)=>{\n\t// hoeghoge\n})\n```\n\n\n### \u3055\u3044\u3054\u306b\n\nhapijs\u306f\u6c17\u304c\u52b9\u3044\u3066\u3044\u3044\u3088\u3068\u3044\u3046\u8a71\u3067\u3057\u305f\u3002\n\u307e\u3060\u4f7f\u3044\u3053\u306a\u305b\u3066\u306a\u3044\u306e\u3067(\u7279\u306b\u30ed\u30b0\u5468\u308a\u306e\u30b1\u30a2\u304c...)\u3057\u3070\u3089\u304f\u5b9f\u9a13\u304c\u5fc5\u8981\u3002\n\n\u4eca\u56de\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3068heroku\u3092\u7528\u610f\u3057\u3066\u3044\u308b\u306e\u3067\u4e0b\u8a18\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u4eca\u56de\u521d\u3081\u3066\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u304cheroku\u306e\u30c7\u30d7\u30ed\u30a4\u3063\u3066\u3059\u3054\u304f\u697d\u3067\u3059\u306d!\nredis\u306f\u30bf\u30c0\u3067\u7528\u610f\u3059\u308b\u65b9\u6cd5\u304c\u3059\u3050\u306b\u898b\u3064\u304b\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u672a\u9069\u7528\u3002\n\n* [heroku](https://frozen-atoll-99368.herokuapp.com/documentation)\n* [Repository](https://github.com/uzuna/hapi-training/tree/redis)\n", "tags": ["Redis", "nodejs", "canvas", "Hapi.js"]}