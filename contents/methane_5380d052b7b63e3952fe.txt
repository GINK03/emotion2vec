{"context": " More than 1 year has passed since last update.h2o Advent Calendar \u306e2\u65e5\u76ee\u3067\u3059\u3002\nh2o \u306f\u30b9\u30bf\u30f3\u30c9\u30a2\u30ed\u30f3\u306e HTTP \u30b5\u30fc\u30d0\u30fc\u3060\u3051\u3067\u306a\u304f\u3001 libh2o \u3068\u3044\u3046\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u3057\u3066\u30d3\u30eb\u30c9\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\u4eca\u56de\u306f libh2o \u3092\u30d3\u30eb\u30c9\u3057\u3066\u3001 hello world \u30b5\u30fc\u30d0\u30fc\u3092\u4f5c\u308b\u307e\u3067\u3084\u3063\u3066\u307f\u307e\u3059\u3002\n\u74b0\u5883\u306f Ubuntu \u3068 Mac OS X \u3092\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\ncmake\nh2o \u306f\u30d3\u30eb\u30c9\u30b7\u30b9\u30c6\u30e0\u306b cmake \u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002 brew \u306a\u308a apt-get \u306a\u308a\u3067 cmake \u3092\u7528\u610f\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\u4ed6\u306b\u3001\u5f8c\u8ff0\u3059\u308b libuv \u306e\u305f\u3081\u306b automake, libtool \u304c\u5fc5\u8981\u3067\u3059\u3002 C++ \u3082\u5165\u3063\u3066\u306a\u304b\u3063\u305f\u3089\u7528\u610f\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\nlibuv\nh2o \u306e\u30b9\u30bf\u30f3\u30c9\u30a2\u30ed\u30f3\u7248\u3067\u306f libuv 1.0.x \u3078\u306e\u4f9d\u5b58\u304c optional \u306a\u306e\u3067\u3059\u304c\u3001 libh2o \u3067\u306f\u5fc5\u9808\u306b\u306a\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3059\uff08\u5c11\u306a\u304f\u3068\u3082\u50d5\u306f libuv \u7121\u3057\u3067\u306e\u30d3\u30eb\u30c9\u306b\u306f\u5931\u6557\u3057\u307e\u3057\u305f\uff09\u3002\u307e\u305a\u306f libuv \u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3057\u3087\u3046\u3002\nlibuv \u306e 1.0 \u7cfb\u306f\u6700\u8fd1\u51fa\u305f\u3070\u304b\u308a\u306a\u306e\u3067\u3001\u30bd\u30fc\u30b9\u304b\u3089\u30d3\u30eb\u30c9\u3057\u3066\u3044\u304d\u307e\u3059\u3002 libuv \u306e\u30b5\u30a4\u30c8 \u306f\u3068\u3066\u3082\u30b7\u30f3\u30d7\u30eb\u3067\u3001\u3059\u3050\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30ea\u30f3\u30af\u304c\u898b\u3064\u304b\u308b\u306f\u305a\u3067\u3059\u3002\n\u4ee5\u4e0b\u306e\u624b\u9806\u3067\u306f\u3001 preifx=$HOME/local/stow/libuv-1.0.x \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3064\u3064\u3001 stow \u3067 $HOME/local \u914d\u4e0b\u306b symlink \u3092\u8cbc\u308a\u307e\u3059\u3002\n\u3053\u306e\u3078\u3093\u306f\u597d\u307f\u3067\u76f4\u63a5\u5171\u901a\u306e prefix \u914d\u4e0b\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306a\u308a\u3001 paco \u3067 uninstall \u53ef\u80fd\u306b\u3059\u308b\u306a\u308a\u3001\u500b\u5225\u306e prefix \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u5404\u7a2ePATH\u30921\u30641\u3064\u8a2d\u5b9a\u3059\u308b\u306a\u308a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n$ wget http://libuv.org/dist/v1.0.1/libuv-v1.0.1.tar.gz\n$ tar xf libuv-v1.0.1.tar.gz\n$ cd libuv-v1.0.1/\n$ ./autogen.sh\n$ ./configure --prefix=$HOME/local/stow/libuv-1.0.1\n$ make -j4\n$ make install\n$ cd ~/local/stow\n$ stow libuv-1.0.1/\n$ ls ../lib\nlibuv.1.dylib libuv.a       libuv.dylib   libuv.la      pkgconfig\n\n\nlibh2o \u306e\u30d3\u30eb\u30c9\nlibuv \u3092 cmake \u306b\u898b\u3064\u3051\u3055\u305b\u308b\u305f\u3081\u3068\u3001 libuv \u306e\u52d5\u7684\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30ea\u30f3\u30af\u3059\u308b\u305f\u3081\u306e\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n$ export CMAKE_INCLUDE_PATH=$HOME/local/include\n$ export CMAKE_LIBRARY_PATH=$HOME/local/lib\n$ export LD_LIBRARY_PATH=$HOME/local/lib\n\nlibh2o \u3092\u30c1\u30a7\u30c3\u30af\u30a2\u30a6\u30c8\u3057\u307e\u3059\u3002\n$ git clone git@github.com:h2o/h2o.git\n$ cd h2o\n$ git submodule init\nSubmodule 'deps/klib' (https://github.com/attractivechaos/klib.git) registered for path 'deps/klib'\nSubmodule 'deps/picohttpparser' (https://github.com/h2o/picohttpparser.git) registered for path 'deps/picohttpparser'\nSubmodule 'deps/picotest' (https://github.com/h2o/picotest.git) registered for path 'deps/picotest'\nSubmodule 'deps/yoml' (https://github.com/h2o/yoml.git) registered for path 'deps/yoml'\n$ git submodule update\n\n\u30d3\u30eb\u30c9\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u3063\u3066\u305d\u3053\u3067\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u308b\u306e\u306f\u5fc5\u9808\u3067\u306f\u306a\u3044\u3067\u3059\u304c\u3001 CLion (JetBrains \u306e\u65b0\u3057\u3044 C/C++ \u7528IDE) \u3092\u4f7f\u3046\u3068\u304d\u306b\u7121\u3044\u3068\u8b66\u544a\u3055\u308c\u307e\u3059\u3057\u3001\u5b9f\u969b cmake \u304c1\u767a\u3067\u901a\u3089\u306a\u304b\u3063\u305f\u6642\u306b\u30d3\u30eb\u30c9\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6d88\u3059\u3060\u3051\u3067\u30ea\u30bb\u30c3\u30c8\u3067\u304d\u308b\u306e\u306f\u4fbf\u5229\u3067\u3059\u3002\n$ mkdir build\n$ cd build\n$ cmake ..\n$ make libh2o\n$ ls\nCMakeCache.txt      CMakeFiles          Makefile            cmake_install.cmake libh2o.a\n$ install libh2o.a ~/local/lib\n\n\nhello world\n\u3055\u3066\u3001 libh2o \u3092\u4f7f\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002 examples/libh2o \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4e2d\u306b simple.c \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u306e\u3067\u3001 cp simple.c hello.c \u3057\u3066\u3001 hello world \u3092\u66f8\u304d\u307e\u3059\u3002\n\u6539\u9020\u3057\u305f\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f gist \u306b\u7f6e\u304d\u307e\u3057\u305f\u3002\nhello world \u306e\u30cf\u30f3\u30c9\u30e9\u306b\u306a\u3063\u3066\u3044\u308b\u95a2\u6570\u3060\u3051\u5f35\u3063\u3066\u304a\u304d\u307e\u3059\u3002\nstatic int hello(h2o_handler_t *self, h2o_req_t *req)\n{\n    static h2o_generator_t generator = { NULL, NULL };\n    static h2o_iovec_t body = {H2O_STRLIT(\"Hello, World!\\n\")};\n    req->res.status = 200;\n    req->res.reason = \"OK\";\n    req->res.content_length = body.len;\n    h2o_add_header(&req->pool, &req->res.headers, H2O_TOKEN_CONTENT_TYPE, H2O_STRLIT(\"text/plain; charset=utf-8\"));\n    h2o_start_response(req, &generator);\n    h2o_send(req, &body, 1, 1);\n    return 0;\n}\n\nh2o_start_response \u306f\u307e\u3060\u4f55\u3092\u3057\u3066\u3044\u308b\u306e\u304b\u628a\u63e1\u3057\u3066\u306a\u304f\u3066\u3001\u30b3\u30d4\u30da\u306e\u307e\u307e\u3067\u3059\u3002\nh2o_send \u306e\u7b2c\u4e8c\u5f15\u6570\u306f h2o_iovec_t \u306e\u914d\u5217\u3067\u3059\u304c\u3001\u3053\u308c\u306f char* \u3068 size_t \u306e\u69cb\u9020\u4f53\u306b\u306a\u3063\u3066\u3044\u3066\u3001\u6587\u5b57\u5217\u30ea\u30c6\u30e9\u30eb\u304b\u3089\u4f5c\u308b\u5834\u5408\u306f H2O_STRLIT \u30de\u30af\u30ed\u304c\u4fbf\u5229\u3067\u3059\u3002\n\u7b2c\u4e09\u5f15\u6570\u306f\u7b2c\u4e8c\u5f15\u6570\u306e\u914d\u5217\u306e\u9577\u3055\u3001\u7b2c\u56db\u5f15\u6570\u306f\u6700\u5f8c\u306e h2o_send \u304b\u3069\u3046\u304b\u3001\u3067\u3059\u3002\n\u6700\u521d\u306b\u8a66\u3057\u305f\u6642\u306f transfer-encoding: chunked \u3060\u3063\u305f\u306e\u3067\u3001 req->res \u306b\u5f53\u305f\u308a\u3092\u3064\u3051\u3066 Clion \u3067 . \u3092\u30bf\u30a4\u30d7\u3057\u305f\u3089\u3059\u3050\u306b content_length \u304c\u88dc\u5b8c\u5019\u88dc\u306b\u898b\u3064\u304b\u3063\u305f\u306e\u3067\u3001 body.len \u3092\u7a81\u3063\u8fbc\u3093\u3067\u30b7\u30f3\u30d7\u30eb\u306a\u30ec\u30b9\u30dd\u30f3\u30b9\u306b\u3057\u307e\u3059\u3002\n\u3053\u308c\u3092\u30d3\u30eb\u30c9\u3057\u3066\u307f\u307e\u3059\u3002\u3044\u3044\u30d3\u30eb\u30c9\u65b9\u6cd5\u304c\u898b\u3064\u304b\u3089\u306a\u304b\u3063\u305f\u306e\u3067C\u30b3\u30f3\u30d1\u30a4\u30e9\u3092\u76f4\u63a5\u53e9\u3044\u3066\u3044\u307e\u3059\u3002 Mac \u3067\u30d3\u30eb\u30c9\u3059\u308b\u3068\u52dd\u624b\u306b\u30b7\u30b9\u30c6\u30e0\u306e openssl \u3092\u898b\u3064\u3051\u3089\u308c\u305f\u306e\u3067 -lssl -lcrypto \u3092\u3064\u3051\u3066\u3044\u307e\u3059\u304c\u3001 Ubuntu \u306a\u3069\u3067 openssl \u7121\u3057\u3067\u30d3\u30eb\u30c9\u3059\u308b\u5834\u5408\u306f\u5916\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n$ cc -O2 -I ../../include -I ../../deps/picohttpparser  -I ../../deps/yoml  -I $HOME/local/include -L $HOME/local/lib hello.c -lh2o -luv -lcrypto -lssl -o hello\n\n\u8d77\u52d5\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n$ ./hello\n\n\u5225\u30bb\u30c3\u30b7\u30e7\u30f3\u304b\u3089\u53e9\u3044\u3066\u307f\u307e\u3059\u3002\n$ curl -vv http://localhost:7890/\n* Adding handle: conn: 0x7fc0b9004000\n* Adding handle: send: 0\n* Adding handle: recv: 0\n* Curl_addHandleToPipeline: length: 1\n* - Conn 0 (0x7fc0b9004000) send_pipe: 1, recv_pipe: 0\n* About to connect() to localhost port 7890 (#0)\n*   Trying ::1...\n*   Trying 127.0.0.1...\n* Connected to localhost (127.0.0.1) port 7890 (#0)\n> GET / HTTP/1.1\n> User-Agent: curl/7.30.0\n> Host: localhost:7890\n> Accept: */*\n>\n< HTTP/1.1 200 OK\n< date: Mon, 01 Dec 2014 15:49:34 GMT\n* Server h2o/0.1 is not blacklisted\n< server: h2o/0.1\n< connection: keep-alive\n< content-length: 14\n< content-type: text/plain; charset=utf-8\n<\nHello, World!\n* Connection #0 to host localhost left intact\n\n$ wrk http://localhost:7890/\nRunning 10s test @ http://localhost:7890/\n  2 threads and 10 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency   206.67us  206.17us   6.16ms   95.23%\n    Req/Sec    24.35k     5.45k   30.78k    78.49%\n  461496 requests in 10.00s, 75.70MB read\nRequests/sec:  46153.12\nTransfer/sec:      7.57MB\n\n\u3069\u3046\u3084\u3089\u3061\u3083\u3093\u3068\u52d5\u3044\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\n[h2o Advent Calendar](http://qiita.com/advent-calendar/2014/h2o) \u306e2\u65e5\u76ee\u3067\u3059\u3002\n\nh2o \u306f\u30b9\u30bf\u30f3\u30c9\u30a2\u30ed\u30f3\u306e HTTP \u30b5\u30fc\u30d0\u30fc\u3060\u3051\u3067\u306a\u304f\u3001 libh2o \u3068\u3044\u3046\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u3057\u3066\u30d3\u30eb\u30c9\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\u4eca\u56de\u306f libh2o \u3092\u30d3\u30eb\u30c9\u3057\u3066\u3001 hello world \u30b5\u30fc\u30d0\u30fc\u3092\u4f5c\u308b\u307e\u3067\u3084\u3063\u3066\u307f\u307e\u3059\u3002\n\n\u74b0\u5883\u306f Ubuntu \u3068 Mac OS X \u3092\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n## cmake\n\nh2o \u306f\u30d3\u30eb\u30c9\u30b7\u30b9\u30c6\u30e0\u306b cmake \u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002 brew \u306a\u308a apt-get \u306a\u308a\u3067 cmake \u3092\u7528\u610f\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n\u4ed6\u306b\u3001\u5f8c\u8ff0\u3059\u308b libuv \u306e\u305f\u3081\u306b automake, libtool \u304c\u5fc5\u8981\u3067\u3059\u3002 C++ \u3082\u5165\u3063\u3066\u306a\u304b\u3063\u305f\u3089\u7528\u610f\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n## libuv\n\nh2o \u306e\u30b9\u30bf\u30f3\u30c9\u30a2\u30ed\u30f3\u7248\u3067\u306f libuv 1.0.x \u3078\u306e\u4f9d\u5b58\u304c optional \u306a\u306e\u3067\u3059\u304c\u3001 libh2o \u3067\u306f\u5fc5\u9808\u306b\u306a\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3059\uff08\u5c11\u306a\u304f\u3068\u3082\u50d5\u306f libuv \u7121\u3057\u3067\u306e\u30d3\u30eb\u30c9\u306b\u306f\u5931\u6557\u3057\u307e\u3057\u305f\uff09\u3002\u307e\u305a\u306f libuv \u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3057\u3087\u3046\u3002\n\nlibuv \u306e 1.0 \u7cfb\u306f\u6700\u8fd1\u51fa\u305f\u3070\u304b\u308a\u306a\u306e\u3067\u3001\u30bd\u30fc\u30b9\u304b\u3089\u30d3\u30eb\u30c9\u3057\u3066\u3044\u304d\u307e\u3059\u3002 [libuv \u306e\u30b5\u30a4\u30c8](http://libuv.org/) \u306f\u3068\u3066\u3082\u30b7\u30f3\u30d7\u30eb\u3067\u3001\u3059\u3050\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30ea\u30f3\u30af\u304c\u898b\u3064\u304b\u308b\u306f\u305a\u3067\u3059\u3002\n\n\u4ee5\u4e0b\u306e\u624b\u9806\u3067\u306f\u3001 preifx=`$HOME/local/stow/libuv-1.0.x` \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3064\u3064\u3001 stow \u3067 `$HOME/local` \u914d\u4e0b\u306b symlink \u3092\u8cbc\u308a\u307e\u3059\u3002\n\n\u3053\u306e\u3078\u3093\u306f\u597d\u307f\u3067\u76f4\u63a5\u5171\u901a\u306e prefix \u914d\u4e0b\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306a\u308a\u3001 paco \u3067 uninstall \u53ef\u80fd\u306b\u3059\u308b\u306a\u308a\u3001\u500b\u5225\u306e prefix \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u5404\u7a2ePATH\u30921\u30641\u3064\u8a2d\u5b9a\u3059\u308b\u306a\u308a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\n$ wget http://libuv.org/dist/v1.0.1/libuv-v1.0.1.tar.gz\n$ tar xf libuv-v1.0.1.tar.gz\n$ cd libuv-v1.0.1/\n$ ./autogen.sh\n$ ./configure --prefix=$HOME/local/stow/libuv-1.0.1\n$ make -j4\n$ make install\n$ cd ~/local/stow\n$ stow libuv-1.0.1/\n$ ls ../lib\nlibuv.1.dylib libuv.a       libuv.dylib   libuv.la      pkgconfig\n```\n\n## libh2o \u306e\u30d3\u30eb\u30c9\n\nlibuv \u3092 cmake \u306b\u898b\u3064\u3051\u3055\u305b\u308b\u305f\u3081\u3068\u3001 libuv \u306e\u52d5\u7684\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30ea\u30f3\u30af\u3059\u308b\u305f\u3081\u306e\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n$ export CMAKE_INCLUDE_PATH=$HOME/local/include\n$ export CMAKE_LIBRARY_PATH=$HOME/local/lib\n$ export LD_LIBRARY_PATH=$HOME/local/lib\n```\n\nlibh2o \u3092\u30c1\u30a7\u30c3\u30af\u30a2\u30a6\u30c8\u3057\u307e\u3059\u3002\n\n```\n$ git clone git@github.com:h2o/h2o.git\n$ cd h2o\n$ git submodule init\nSubmodule 'deps/klib' (https://github.com/attractivechaos/klib.git) registered for path 'deps/klib'\nSubmodule 'deps/picohttpparser' (https://github.com/h2o/picohttpparser.git) registered for path 'deps/picohttpparser'\nSubmodule 'deps/picotest' (https://github.com/h2o/picotest.git) registered for path 'deps/picotest'\nSubmodule 'deps/yoml' (https://github.com/h2o/yoml.git) registered for path 'deps/yoml'\n$ git submodule update\n```\n\n\u30d3\u30eb\u30c9\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u3063\u3066\u305d\u3053\u3067\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u308b\u306e\u306f\u5fc5\u9808\u3067\u306f\u306a\u3044\u3067\u3059\u304c\u3001 CLion (JetBrains \u306e\u65b0\u3057\u3044 C/C++ \u7528IDE) \u3092\u4f7f\u3046\u3068\u304d\u306b\u7121\u3044\u3068\u8b66\u544a\u3055\u308c\u307e\u3059\u3057\u3001\u5b9f\u969b cmake \u304c1\u767a\u3067\u901a\u3089\u306a\u304b\u3063\u305f\u6642\u306b\u30d3\u30eb\u30c9\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6d88\u3059\u3060\u3051\u3067\u30ea\u30bb\u30c3\u30c8\u3067\u304d\u308b\u306e\u306f\u4fbf\u5229\u3067\u3059\u3002\n\n```\n$ mkdir build\n$ cd build\n$ cmake ..\n$ make libh2o\n$ ls\nCMakeCache.txt      CMakeFiles          Makefile            cmake_install.cmake libh2o.a\n$ install libh2o.a ~/local/lib\n```\n\n## hello world\n\n\u3055\u3066\u3001 libh2o \u3092\u4f7f\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002 examples/libh2o \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4e2d\u306b simple.c \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u306e\u3067\u3001 cp simple.c hello.c \u3057\u3066\u3001 hello world \u3092\u66f8\u304d\u307e\u3059\u3002\n\u6539\u9020\u3057\u305f\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f [gist](https://gist.github.com/methane/2e35cf585a939c1dfa3e) \u306b\u7f6e\u304d\u307e\u3057\u305f\u3002\n\nhello world \u306e\u30cf\u30f3\u30c9\u30e9\u306b\u306a\u3063\u3066\u3044\u308b\u95a2\u6570\u3060\u3051\u5f35\u3063\u3066\u304a\u304d\u307e\u3059\u3002\n\n```c\nstatic int hello(h2o_handler_t *self, h2o_req_t *req)\n{\n    static h2o_generator_t generator = { NULL, NULL };\n    static h2o_iovec_t body = {H2O_STRLIT(\"Hello, World!\\n\")};\n    req->res.status = 200;\n    req->res.reason = \"OK\";\n    req->res.content_length = body.len;\n    h2o_add_header(&req->pool, &req->res.headers, H2O_TOKEN_CONTENT_TYPE, H2O_STRLIT(\"text/plain; charset=utf-8\"));\n    h2o_start_response(req, &generator);\n    h2o_send(req, &body, 1, 1);\n    return 0;\n}\n```\n\nh2o_start_response \u306f\u307e\u3060\u4f55\u3092\u3057\u3066\u3044\u308b\u306e\u304b\u628a\u63e1\u3057\u3066\u306a\u304f\u3066\u3001\u30b3\u30d4\u30da\u306e\u307e\u307e\u3067\u3059\u3002\n\nh2o_send \u306e\u7b2c\u4e8c\u5f15\u6570\u306f h2o_iovec_t \u306e\u914d\u5217\u3067\u3059\u304c\u3001\u3053\u308c\u306f `char*` \u3068 `size_t` \u306e\u69cb\u9020\u4f53\u306b\u306a\u3063\u3066\u3044\u3066\u3001\u6587\u5b57\u5217\u30ea\u30c6\u30e9\u30eb\u304b\u3089\u4f5c\u308b\u5834\u5408\u306f `H2O_STRLIT` \u30de\u30af\u30ed\u304c\u4fbf\u5229\u3067\u3059\u3002\n\u7b2c\u4e09\u5f15\u6570\u306f\u7b2c\u4e8c\u5f15\u6570\u306e\u914d\u5217\u306e\u9577\u3055\u3001\u7b2c\u56db\u5f15\u6570\u306f\u6700\u5f8c\u306e h2o_send \u304b\u3069\u3046\u304b\u3001\u3067\u3059\u3002\n\n\u6700\u521d\u306b\u8a66\u3057\u305f\u6642\u306f transfer-encoding: chunked \u3060\u3063\u305f\u306e\u3067\u3001 `req->res` \u306b\u5f53\u305f\u308a\u3092\u3064\u3051\u3066 Clion \u3067 . \u3092\u30bf\u30a4\u30d7\u3057\u305f\u3089\u3059\u3050\u306b content_length \u304c\u88dc\u5b8c\u5019\u88dc\u306b\u898b\u3064\u304b\u3063\u305f\u306e\u3067\u3001 body.len \u3092\u7a81\u3063\u8fbc\u3093\u3067\u30b7\u30f3\u30d7\u30eb\u306a\u30ec\u30b9\u30dd\u30f3\u30b9\u306b\u3057\u307e\u3059\u3002\n\n\u3053\u308c\u3092\u30d3\u30eb\u30c9\u3057\u3066\u307f\u307e\u3059\u3002\u3044\u3044\u30d3\u30eb\u30c9\u65b9\u6cd5\u304c\u898b\u3064\u304b\u3089\u306a\u304b\u3063\u305f\u306e\u3067C\u30b3\u30f3\u30d1\u30a4\u30e9\u3092\u76f4\u63a5\u53e9\u3044\u3066\u3044\u307e\u3059\u3002 Mac \u3067\u30d3\u30eb\u30c9\u3059\u308b\u3068\u52dd\u624b\u306b\u30b7\u30b9\u30c6\u30e0\u306e openssl \u3092\u898b\u3064\u3051\u3089\u308c\u305f\u306e\u3067 `-lssl -lcrypto` \u3092\u3064\u3051\u3066\u3044\u307e\u3059\u304c\u3001 Ubuntu \u306a\u3069\u3067 openssl \u7121\u3057\u3067\u30d3\u30eb\u30c9\u3059\u308b\u5834\u5408\u306f\u5916\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\n$ cc -O2 -I ../../include -I ../../deps/picohttpparser  -I ../../deps/yoml  -I $HOME/local/include -L $HOME/local/lib hello.c -lh2o -luv -lcrypto -lssl -o hello\n```\n\n\u8d77\u52d5\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```\n$ ./hello\n```\n\n\u5225\u30bb\u30c3\u30b7\u30e7\u30f3\u304b\u3089\u53e9\u3044\u3066\u307f\u307e\u3059\u3002\n\n```\n$ curl -vv http://localhost:7890/\n* Adding handle: conn: 0x7fc0b9004000\n* Adding handle: send: 0\n* Adding handle: recv: 0\n* Curl_addHandleToPipeline: length: 1\n* - Conn 0 (0x7fc0b9004000) send_pipe: 1, recv_pipe: 0\n* About to connect() to localhost port 7890 (#0)\n*   Trying ::1...\n*   Trying 127.0.0.1...\n* Connected to localhost (127.0.0.1) port 7890 (#0)\n> GET / HTTP/1.1\n> User-Agent: curl/7.30.0\n> Host: localhost:7890\n> Accept: */*\n>\n< HTTP/1.1 200 OK\n< date: Mon, 01 Dec 2014 15:49:34 GMT\n* Server h2o/0.1 is not blacklisted\n< server: h2o/0.1\n< connection: keep-alive\n< content-length: 14\n< content-type: text/plain; charset=utf-8\n<\nHello, World!\n* Connection #0 to host localhost left intact\n\n$ wrk http://localhost:7890/\nRunning 10s test @ http://localhost:7890/\n  2 threads and 10 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency   206.67us  206.17us   6.16ms   95.23%\n    Req/Sec    24.35k     5.45k   30.78k    78.49%\n  461496 requests in 10.00s, 75.70MB read\nRequests/sec:  46153.12\nTransfer/sec:      7.57MB\n```\n\n\u3069\u3046\u3084\u3089\u3061\u3083\u3093\u3068\u52d5\u3044\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n", "tags": ["h2o"]}