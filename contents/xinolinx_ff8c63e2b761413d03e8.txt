{"context": "\n\n\u4eca\u56de\u306e\u76ee\u7684\nInfiniBand Architecture\u306b\u95a2\u3059\u308b\u30c7\u30d0\u30a4\u30b9\u306f\u975e\u5e38\u306b\u9ad8\u4fa1\u3067\u3001\u306a\u304b\u306a\u304b\u624b\u304c\u51fa\u306b\u304f\u3044\u3082\u306e\u3067\u3059\u304c\u3001\u5bb6\u304b\u3089\u51fa\u305a\u306b\u624b\u5143\u3067\u304a\u91d1\u3092\u304b\u3051\u305a\u306b\u8a66\u3057\u3066\u307f\u308b\u65b9\u6cd5\u3092\u307e\u3068\u3081\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\u5b9f\u884c\u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u4e0d\u8db3\u304c\u3042\u308b\u3068\u3001\u6df7\u4e71\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u306e\u3067\u3001Linux(CentOS)\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304b\u3089\u66f8\u3044\u3066\u3044\u307e\u3059\u304c\u3001\u65e2\u306bLinux\u30de\u30b7\u30f3\u304c\u624b\u5143\u306b\u3042\u308b\u3088\u3001\u3068\u3044\u3046\u65b9\u306f\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u3001\u659c\u3081\u8aad\u307f\u3057\u3066\u9802\u3051\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\n\n\u4f55\u6545\u304a\u91d1\u304c\u304b\u304b\u3089\u306a\u3044\u306e\u304b\n\n\u30de\u30b7\u30f3\u306fVirtual-Box\u3092\u4f7f\u3063\u305f\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u4f7f\u3046\nInfiniBand\u306f\u4e2d\u6751\u5b9f\u69d8\u4f5c\u6210\u306e\u4eee\u60f3InfiniBand\u3092\u4f7f\u3046\n\u4ed6\u3001\u5fc5\u8981\u306a\u6a5f\u80fd\u306fCentOS\u306eLinux\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u5229\u7528\u3067\u304d\u308b\n\n\n\n\nInfiniBand\u3063\u3066\uff1f\nInfiniBand\u306b\u3064\u3044\u3066\u306f\u3001\u73fe\u5728xinolinx\u3067\u4e00\u4eba\u52c9\u5f37\u4f1a\u3092\u5b9f\u65bd\u4e2d\u3067\u3059\u3002\u53c2\u8003\u306b\u306a\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\nInfiniBand\u3056\u3063\u304f\u308a\u307e\u3068\u3081\n\n\n\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(1)\n\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(2)\n\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(3)\n\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(3)+1\n\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(3)+2\n\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(4)\n\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(5)\n\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(6)-1\n\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(6)\n\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(7)\n\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(8)\n\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(9)\n\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(10)\n\n\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u3068OS\u306e\u6e96\u5099(CentOS 7)\n\u4eca\u56de\u306fOracle VM VirtualBox(5.1.10 Windows 64bit)\u3092\u5229\u7528\u3057\u307e\u3057\u305f\u3002\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u4f5c\u6210\n\n\u300c\u65b0\u898f\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u4f5c\u6210\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\u300c\u540d\u524d\u300d\u306b\u9069\u5f53\u306a\u540d\u524d(\u4eca\u56de\u306fCentOS7_test)\u3068\u3057\u3001\u300cRed Hat(64-bit)\u300d\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\u30e1\u30e2\u30ea\u3092\u9069\u5ea6\u306b\u5272\u308a\u5f53\u3066\u3066\u304f\u3060\u3055\u3044\u3001\u4eca\u56de\u306f4096MB\u5272\u308a\u5f53\u3066\u307e\u3057\u305f\u3002\n\u4eee\u60f3\u30cf\u30fc\u30c9\u30c7\u30a3\u30b9\u30af\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u300cVDI\u300d\u306e\u300c\u53ef\u5909\u30b5\u30a4\u30ba\u300d\u3067\u300c2TB\u300d\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u9078\u629e\u3057\u3066\u300c\u8a2d\u5b9a\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u300c\u30b9\u30c8\u30ec\u30fc\u30b8\u300d\u3067\u300cDVD\u30de\u30fc\u30af\u300d\u306e\u4e2d\u306e\u300c\u4eee\u60f3\u5149\u5b66\u30c7\u30a3\u30b9\u30af\u30d5\u30a1\u30a4\u30eb\u3092\u9078\u629e\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\nOS\u3068\u3057\u3066CentOS-7-x86_64-LiveGNOME-1511.iso\u3092\u4f7f\u3044\u307e\u3059\u3002\n\u300c\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u300d\u3067\u300c\u30a2\u30c0\u30d7\u30bf\u30fc1\u300d\u306e\u5272\u308a\u5f53\u3066\u3092\u300c\u30d6\u30ea\u30c3\u30b8\u30a2\u30c0\u30d7\u30bf\u30fc\u300d\u306b\u3057\u307e\u3059\u3002\n\u300cOK\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u8a2d\u5b9a\u753b\u9762\u3092\u9589\u3058\u307e\u3059\u3002\n\n\n\nCentOS7\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u300c\u8d77\u52d5\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001\u4eee\u60f3\u30e2\u30cb\u30bf\u5185\u306e\u300cStart CentOS Linux\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059(\u30d5\u30a9\u30fc\u30ab\u30b9\u3092\u5916\u3059\u5834\u5408\u306f\u53f3Ctrl\u3067\u3059)\u3002\n\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u306e\u3067\u3001\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u4e0a\u306e\u300cInstall toHard Drive\u300d\u3092\u958b\u304d\u307e\u3059\u3002\n\u300cEnglish\u300d\u300cEnglish(United States)\u300d\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\u300cKEYBOARD\u300d\u3067\u300cJapanese\u300d\u3092\u8ffd\u52a0\u3057\u3066\u300cUS\u300d\u3092\u524a\u9664\u3057\u307e\u3059\uff08\u203bUS\u30ad\u30fc\u30dc\u30fc\u30c9\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u65b9\u306f\u5909\u66f4\u4e0d\u8981\u3067\u3059\uff09\u3002\n\u300cINSTALL DESTINATION\u300d\u3067\u300cATA VBOX HARDDISK\u300d\u3092\u9078\u629e\u3057\u3066\u300cDone\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u300cBegin Instration\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\u300cROOT PASSWORD\u300d\u3068\u300cUSER CREATION\u300d\u306f\u9069\u5b9c\u884c\u3063\u3066\u304f\u3060\u3055\u3044\u3002\n\u7d42\u308f\u3063\u305f\u3089\u3001\u53f3\u4e0a\u306e\u96fb\u6e90\u30a2\u30a4\u30b3\u30f3\u304b\u3089\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u96fb\u6e90\u3092\u5207\u308a\u307e\u3059\u3002\n\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u9078\u629e\u3057\u3066\u300c\u8a2d\u5b9a\u300d\u304b\u3089\u300c\u30b9\u30c8\u30ec\u30fc\u30b8\u300d\u3067\u4eee\u60f3\u5149\u5b66\u30c7\u30a3\u30b9\u30af\u30d5\u30a1\u30a4\u30eb\u306e\u5272\u308a\u5f53\u3066\u3092\u89e3\u9664\u3057\u307e\u3059\u3002\n\n\u4ee5\u4e0a\u3067\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u6e96\u5099\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\nLinux\u306e\u4e8b\u524d\u6e96\u5099\n\nsshd\u306e\u8d77\u52d5\n\u958b\u767a\u306b\u5fc5\u8981\u30b5\u30fc\u30d3\u30b9\u306e\u6709\u52b9\u5316\u3001\u8a2d\u5b9a\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3044\u307e\u3059\u3002\nApllication\u306e\u4e2d\u304b\u3089\u300cTerminal\u300d\u3092\u63a2\u3057\u3066\u958b\u304d\u3001\u6700\u4f4e\u9650\u306e\u8a2d\u5b9a\u3092\u3057\u305f\u5f8c\u3001\nputty\u7b49\u3067\u30ea\u30e2\u30fc\u30c8\u4f5c\u696d\u3059\u308b\u3068\u697d\u3067\u3059\u3002\n$ ifconfig\n<IP address \u304c\u8868\u793a\u3055\u308c\u307e\u3059>\n$ su\nPassword: \n# systemctl enable sshd\n# systemctl start sshd\n# systemctl set-default multi-user.target\n# reboot\n\n\n\n\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nsudo\u3092\u7c21\u5358\u306b\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3059(\u4efb\u610f)\n$ su\nPassword:\n# vi /etc/sudoers\n...\n## Allow root to run any commands anywhere\nroot    ALL=(ALL)       ALL\nshino   ALL=(ALL)       ALL # Add this Line\n...\n## Allows people in group wheel to run all commands\n#%wheel ALL=(ALL)       ALL # Comment Out this line \n\n## Same thing without a password\n%wheel  ALL=(ALL)       NOPASSWD: ALL # Enable this line\n...\n# exit\n$\n\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u66f4\u65b0\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb(\u5fc5\u9808)\n$ sudo yum update -y\n$ sudo reboot\n\n...<REBOOTING:Kernel\u304c\u5909\u308f\u308b\u305f\u3081>...\n\n$ sudo yum install -y git\n$ sudo yum install -y gcc\n$ sudo yum install -y libibverbs*\n$ sudo yum install -y rdma*\n$ sudo yum install -y opensm\n$ sudo yum install -y opensm-libs\n$ sudo yum install -y rpm-build\n$ sudo yum install -y kernel-devel\n$ cd ~/\n$ mkdir -p rpmbuild/SOURCES/\n\n\u307e\u305f\u95a2\u9023\u3059\u308b\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n$ sudo systemctl enable rdma\n$ sudo systemctl start rdma\n\n\n\u4eee\u60f3InfiniBand\u30c7\u30d0\u30a4\u30b9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nInfiniBand\u30c7\u30d0\u30a4\u30b9\u306fAmazon\u3067\u8cfc\u5165\u3057\u3066\u3082\u975e\u5e38\u306b\u9ad8\u4fa1\u3067\u3059\u306e\u3067\u3001\u4eca\u56de\u306fnminoru\u69d8\u306epib\u3092\u5229\u7528\u3057\u307e\u3059\u3002\u3053\u3061\u3089\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306fEthernet\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4e0a\u3001\u307e\u305f\u306f\u3001\u30b7\u30f3\u30b0\u30eb\u30ce\u30fc\u30c9(\u4eca\u56de\u306e\u8a18\u4e8b\u306f\u3053\u308c)\u306bInfiniBand\u30c7\u30d0\u30a4\u30b9\u3092\u4eee\u60f3\u7684\u306b\u642d\u8f09\u3057\u3001InfiniBand\u306eVerbs(InfiniBand Host-Channel-Adabter\u306e\u63d0\u4f9b\u3059\u308b\u6a5f\u80fd)\u3092Kick\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u7fa4\u3068\u306a\u308a\u307e\u3059\u3002\n\u672c\u5f53\u306f\u3001\u672c\u5bb6\u3092\u5229\u7528\u3057\u305f\u3044\u3068\u3053\u308d\u306a\u306e\u3067\u3059\u304c\u3001CentOS 7\u306eKernel3.10.0-514.6.1.el7.x86_64\u306f\u3001define\u5468\u308a\u304c\u5909\u308f\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001CentOS7\u7528\u306b\u6539\u5909\u3057\u305f\u30b3\u30fc\u30c9\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\u3053\u3061\u3089\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306bfork\u3057\u3001CentOS7\u7528\u306b\u4fee\u6b63\u3092\u304b\u3051\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f(\u5dee\u5206)\u306e\u3067\u3001\u3053\u3061\u3089\u3092\u672c\u8a18\u4e8b\u3067\u306f\u4f7f\u3044\u307e\u3059\u3002\n$ cd ./~\n$ git clone https://github.com/xinolinx/pib.git\n\n\n\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\u307e\u305a\u306f\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u4e0b\u8a18\u306e\u624b\u9806\u3068\u306a\u308a\u307e\u3059\u3002\n$ cp -r pib/driver pib-0.4.6\n$ tar czvf ./rpmbuild/SOURCES/pib-0.4.6.tar.gz pib-0.4.6/\n$ cp pib/driver/pib.conf ./rpmbuild/SOURCES/\n$ cp pib/driver/pib.files ./rpmbuild/SOURCES/\n$ rpmbuild -bs pib/driver/pib.spec\n$ rpmbuild --rebuild ./rpmbuild/SRPMS/pib-0.4.6-1.el7.centos.src.rpm\n$ sudo rpm -ihv ./rpmbuild/RPMS/x86_64/kmod-pib-0.4.6-1.el7.centos.x86_64.rpm\n\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u9023\u643a\u7528\u306eVerbs\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nInfiniBand\u306f\u30e6\u30fc\u30b6\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089Verbs\u3068\u3044\u3046\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u4ecb\u3057\u3066\u5236\u5fa1\u3055\u308c\u307e\u3059\u304c\u3001Verbs\u3092\u6700\u521d\u306b\u51e6\u7406\u3059\u308b\u306e\u306f\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u3067\u306f\u306a\u304f\u3001\u5171\u6709\u30e9\u30a4\u30d6\u30e9\u30ea\u306b\u306a\u308a\u307e\u3059\u3002pib\u3067\u306flibpib\u3068\u3044\u3046\u5171\u6709\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u4eee\u60f3InfiniBand\u306eVerbs\u3092\u53d7\u3051\u53d6\u3063\u3066\u51e6\u7406\u3057\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u306b\u52a0\u3048\u3066libpib\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ cp -r pib/libpib libpib-0.0.6\n$ tar czvf ./rpmbuild/SOURCES/libpib-0.0.6.tar.gz libpib-0.0.6/\n$ rpmbuild -bs pib/libpib/libpib.spec\n$ rpmbuild --rebuild ./rpmbuild/SRPMS/libpib-0.0.6-1.el7.centos.src.rpm\n$ sudo rpm -ihv ./rpmbuild/RPMS/x86_64/libpib-0.0.6-1.el7.centos.x86_64.rpm\n\n\n\u3044\u3088\u3044\u3088InfiniBand\u3092\u8a66\u3057\u3066\u307f\u308b\n\u4ee5\u4e0a\u3067\u6e96\u5099\u306f\u5b8c\u4e86\u3057\u307e\u3057\u305f\u306e\u3067\u65e9\u901f\u8a66\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u4eee\u60f3InfiniBand\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30ed\u30fc\u30c9\n\u65e9\u901f\u3001kmod-pib-0.4.6-1.el7.centos.x86_64.rpm\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30ebpib.ko\u3092\u30ed\u30fc\u30c9\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n$ lsmod | grep pib\n$ sudo modprobe pib\n$ lsmod | grep pib\npib                   120119  0\nib_core               210381  14 pib,rdma_cm,ib_cm,iw_cm,rpcrdma,ib_srp,ib_ucm,ib_iser,ib_srpt,ib_umad,ib_uverbs,rdma_ucm,ib_ipoib,ib_isert\n\n\u30ed\u30fc\u30c9\u3067\u304d\u307e\u3057\u305f\u306d\uff01\u30c7\u30d0\u30a4\u30b9\u304c\u5b58\u5728\u3059\u308b\u304b\u3082\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n$ ls /dev/infiniband/\nissm0  issm2  rdma_cm  ucm1   umad1  umad3    uverbs1\nissm1  issm3  ucm0     umad0  umad2  uverbs0\n\nInifiniBand\u30c7\u30d0\u30a4\u30b9\u306e\u7ba1\u7406\u306b\u306flibibverbs-utils\u304c\u4fbf\u5229\u3067\u3059\u3002libibverbs-utils\u306e\u63d0\u4f9b\u3059\u308bibv_devinfo(InfiniBand_Verbs-DEVice_INFO)\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066\u3001\u65e9\u901f\u30c7\u30d0\u30a4\u30b9\u60c5\u5831\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u4e0b\u8a18\u306e\u3088\u3046\u306b2\u500b\u306eInfiniBand\u30c7\u30d0\u30a4\u30b9\u304c\u898b\u3048\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n$ ibv_devinfo\nhca_id: pib_1\n        transport:                      InfiniBand (0)\n        fw_ver:                         0.4.006\n        node_guid:                      0800:278f:d669:0400\n        sys_image_guid:                 0800:278f:d669:0200\n        vendor_id:                      0x0001\n        vendor_part_id:                 1\n        hw_ver:                         0x0\n        phys_port_cnt:                  2\n                port:   1\n                        state:                  PORT_INIT (2)\n                        max_mtu:                4096 (5)\n                        active_mtu:             256 (1)\n                        sm_lid:                 0\n                        port_lid:               0\n                        port_lmc:               0x00\n                        link_layer:             InfiniBand\n\n                port:   2\n                        state:                  PORT_INIT (2)\n                        max_mtu:                4096 (5)\n                        active_mtu:             256 (1)\n                        sm_lid:                 0\n                        port_lid:               0\n                        port_lmc:               0x00\n                        link_layer:             InfiniBand\n\nhca_id: pib_0\n        transport:                      InfiniBand (0)\n        fw_ver:                         0.4.006\n        node_guid:                      0800:278f:d669:0300\n        sys_image_guid:                 0800:278f:d669:0200\n        vendor_id:                      0x0001\n        vendor_part_id:                 1\n        hw_ver:                         0x0\n        phys_port_cnt:                  2\n                port:   1\n                        state:                  PORT_INIT (2)\n                        max_mtu:                4096 (5)\n                        active_mtu:             256 (1)\n                        sm_lid:                 0\n                        port_lid:               0\n                        port_lmc:               0x00\n                        link_layer:             InfiniBand\n\n                port:   2\n                        state:                  PORT_INIT (2)\n                        max_mtu:                4096 (5)\n                        active_mtu:             256 (1)\n                        sm_lid:                 0\n                        port_lid:               0\n                        port_lmc:               0x00\n                        link_layer:             InfiniBand\n\n\u304a\u3084\u3001port\u306e\u72b6\u614b\u304cINIT\u72b6\u614b\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u306d\u3002\u3053\u308c\u306f\u3001InfiniBand Architecture\u3067\u306f\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5185(Subnet\u5185)\u306e\u30ea\u30bd\u30fc\u30b9\u306f\u3001Subnet-Manager\u304c\u7ba1\u7406\u3059\u308b\u3053\u3068\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001Subnet-Manager\u304c\u4e0d\u5728\u306a\u72b6\u614b\u3067\u306f\u3001\u521d\u671f\u5316\u4e2d(INIT\u72b6\u614b)\u3067\u5f85\u3061\u72b6\u614b\u3068\u306a\u308a\u307e\u3059\u3002\u305d\u3053\u3067\u3001Linux\u306eopensm(Open-Subnet-Manager)\u3092\u8d77\u52d5\u3057\u3001\u518d\u5ea6\u30c7\u30d0\u30a4\u30b9\u60c5\u5831\u3092\u898b\u308b\u3068\u3001\u4eca\u5ea6\u306fACTIVE(\u901a\u4fe1\u53ef\u80fd\u72b6\u614b)\u306b\u306a\u3063\u305f\u3068\u601d\u3044\u307e\u3059\u3002\n$ sudo systemctl start opensm\n$ ibv_devinfo | grep state\n                        state:                  PORT_ACTIVE (4)\n                        state:                  PORT_ACTIVE (4)\n                        state:                  PORT_ACTIVE (4)\n                        state:                  PORT_ACTIVE (4)\n\n\n\n\n\u53c2\u8003 http://buyya.com/superstorage/chap42.pdf\n\n\n\u4ee5\u4e0a\u3067\u3001\u901a\u4fe1\u6e96\u5099\u304c\u3067\u304d\u307e\u3057\u305f\u3002\u30ef\u30af\u30ef\u30af\u3057\u3066\u304d\u307e\u3057\u305f\u3002\n\nInfiniBand Test\n\u305d\u308c\u3067\u306f\u3001InfiniBand\u3067\u6709\u540d\u306amellanox\u793e\u306e\u516c\u958b\u3057\u3066\u3044\u308b\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u300cRDMA Aware Programming user manual\u300d\u306b\u3042\u308b\u901a\u4fe1\u30d7\u30ed\u30b0\u30e9\u30e0\u4f8b(7.2\u7bc0)\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\nInfiniBand Test\u306e\u6e96\u5099\n\u305d\u308c\u3067\u306f\u3001\u65e9\u901fInfiniBand\u3092\u4f7f\u3063\u3066\u901a\u4fe1\u3092\u884c\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u5fc5\u8981\u306aInfiniBand Test\u3092\u3053\u3061\u3089\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u53d6\u5f97\u3057\u3001\u30d3\u30eb\u30c9\u3057\u307e\u3059(\u3053\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306f\u3001\u300cRDMA Aware Programming user manual\u300d\u306e7.2\u7ae0\u306b\u3042\u308b\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u305d\u306e\u307e\u307e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306b\u5909\u63db\u3057\u305f\u3082\u306e\u3067\u3059)\u3002\u305d\u3057\u3066\u3001\u4eee\u60f3InfiniBand\u30c7\u30d0\u30a4\u30b9pib_0\u3068pib_1\u306e\u9593\u3067\u901a\u4fe1\u3092\u8a66\u3057\u3066\u307f\u305f\u3044\u306e\u3067\u3001start_server.sh\u306b-d pib_0\u3092\u3001start_client.sh\u306b-d pib_1\u3092\u4ed8\u52a0\u3057\u307e\u3059\u3002\n$ cd ~/\n$ git clone https://github.com/xinolinx/infiniband_verbs_test.git\n$ cd ./infiniband_verbs_test\n$ cd ./mellanox\n$ cd ./RDMA_Prog_Ch7_IBVVerbs\n$ make\n$ ls\nmain.c  main.o  Makefile  RDMA_RC_example  start_client.sh  start_server.sh\n$ vi ./start_server.sh\n..\n./RDMA_RC_example -d pib_0    # add \"-d pib_0\"\n$ vi ./start_client.sh\n..\n./RDMA_RC_example -d pib_1 $1 # add \"-d pib_1\"\n\n\nInfiniBand Test\u306e\u5b9f\u884c\n\u307e\u305a\u3001Server\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ ./start_server.sh\nInfiniband hardware address can be incorrect! Please read BUGS section in ifconfig(8).\nInfiniband hardware address can be incorrect! Please read BUGS section in ifconfig(8).\nInfiniband hardware address can be incorrect! Please read BUGS section in ifconfig(8).\nInfiniband hardware address can be incorrect! Please read BUGS section in ifconfig(8).\n        inet 192.168.0.17  netmask 255.255.255.0  broadcast 192.168.0.255\n ------------------------------------------------\n Device name : \"pib_0\"\n IB port : 1\n TCP port : 19875\n ------------------------------------------------\n\nwaiting on port 19875 for TCP connection\npib: sock_connect: set servername=(null):19875\n\n\u6b21\u306bclient\u3092\u8d77\u52d5\u3057\u3001\u8a66\u9a13\u3092\u6d41\u3057\u307e\u3059\u3002\n$ ./start_client.sh 127.0.0.1\n ------------------------------------------------\n Device name : \"pib_1\"\n IB port : 1\n IP : 127.0.0.1\n TCP port : 19875\n ------------------------------------------------\n\npib: sock_connect: set servername=127.0.0.1:19875\nTCP connection was established\nsearching for IB devices in host\nfound 2 device(s)\nMR was registered with addr=0xf68450, lkey=0xb1d00000, rkey=0xb1e00000, flags=0x7\nQP was created, QP number=0x38e24c\n\nLocal LID = 0x3\nRemote address = 0xc10450\nRemote rkey = 0xc1c00000\nRemote QP number = 0x3b2350\nRemote LID = 0x1\nClient - first post_receive().\nReceive Request was posted\nQP state was change to RTS\nWait both sides we expect to get a completion.\ncompletion was found in CQ with status 0x0\nMessage is: 'SEND operation '\nClient - post_send(IBV_WR_RDMA_READ).\nRDMA Read Request was posted\ncompletion was found in CQ with status 0x0\nContents of server's buffer: 'RDMA read operatuverbs1'\nNow replacing it with: 'RDMA write operation'\nClient - post_send(IBV_WR_RDMA_WRITE).\nRDMA Write Request was posted\ncompletion was found in CQ with status 0x0\n\ntest result is 0\n\nServer\u5074\u3082\u901a\u4fe1\u30ed\u30b0\u304c\u51fa\u529b\u3055\u308c\u3001\u901a\u4fe1\u304c\u6210\u529f\u3057\u305f\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\nTCP connection was established\nsearching for IB devices in host\nfound 2 device(s)\ngoing to send the message: 'SEND operation '\nMR was registered with addr=0xc10450, lkey=0xc2300000, rkey=0xc1c00000, flags=0x7\nQP was created, QP number=0x3b2350\n\nLocal LID = 0x1\nRemote address = 0xf68450\nRemote rkey = 0xb1e00000\nRemote QP number = 0x38e24c\nRemote LID = 0x3\nQP state was change to RTS\nServer - first post_send(IBV_WR_SEND).\nSend Request was posted\nWait both sides we expect to get a completion.\ncompletion was found in CQ with status 0x0\nContents of server buffer: 'RDMA write operaion '\n\ntest result is 0\n\n\u51fa\u6765\u307e\u3057\u305f\u306d\uff01\uff01\u304a\u3064\u304b\u308c\u3055\u307e\u3067\u3057\u305f\u3001\u7121\u4e8b\u5b8c\u4e86\u3067\u3059\u3002\n\u4eca\u56de\u306e\u307e\u3068\u3081\u3092\u6539\u3081\u3066\u66f8\u3044\u3066\u307f\u305f\u3053\u3068\u3067\u3001\u6ca2\u5c71\u306eSoftware\u3084\u30de\u30cb\u30e5\u30a2\u30eb\u304c\u6574\u5099\u3055\u308c\u3066\u3044\u308b\u304a\u9670\u3067\u3001\u672c\u5f53\u306b\u8eab\u8fd1\u306b\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3053\u3068\u306f\u7d20\u6674\u3089\u3057\u3044\u4e8b\u3068\u611f\u3058\u307e\u3057\u305f\u3002\u672c\u5f53\u306b\u3001\u95a2\u4fc2\u5404\u6240\u3055\u307e\u65b9\u3005\u3001\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\n\u305d\u308c\u3067\u306f\u3001\u7d20\u6575\u306a InfiniBand Life\u3092\u304a\u904e\u3054\u3057\u304f\u3060\u3055\u3044\u3002\n# \u4eca\u56de\u306e\u76ee\u7684\n\nInfiniBand Architecture\u306b\u95a2\u3059\u308b\u30c7\u30d0\u30a4\u30b9\u306f\u975e\u5e38\u306b\u9ad8\u4fa1\u3067\u3001\u306a\u304b\u306a\u304b\u624b\u304c\u51fa\u306b\u304f\u3044\u3082\u306e\u3067\u3059\u304c\u3001**\u5bb6\u304b\u3089\u51fa\u305a\u306b\u624b\u5143\u3067\u304a\u91d1\u3092\u304b\u3051\u305a\u306b\u8a66\u3057\u3066\u307f\u308b\u65b9\u6cd5**\u3092\u307e\u3068\u3081\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\u5b9f\u884c\u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u4e0d\u8db3\u304c\u3042\u308b\u3068\u3001\u6df7\u4e71\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u306e\u3067\u3001Linux(CentOS)\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304b\u3089\u66f8\u3044\u3066\u3044\u307e\u3059\u304c\u3001\u65e2\u306bLinux\u30de\u30b7\u30f3\u304c\u624b\u5143\u306b\u3042\u308b\u3088\u3001\u3068\u3044\u3046\u65b9\u306f\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u3001\u659c\u3081\u8aad\u307f\u3057\u3066\u9802\u3051\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\n- **\u4f55\u6545\u304a\u91d1\u304c\u304b\u304b\u3089\u306a\u3044\u306e\u304b**\n - \u30de\u30b7\u30f3\u306fVirtual-Box\u3092\u4f7f\u3063\u305f\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u4f7f\u3046\n - InfiniBand\u306f[\u4e2d\u6751\u5b9f](https://github.com/nminoru)\u69d8\u4f5c\u6210\u306e[\u4eee\u60f3InfiniBand](https://github.com/nminoru/pib)\u3092\u4f7f\u3046\n - \u4ed6\u3001\u5fc5\u8981\u306a\u6a5f\u80fd\u306fCentOS\u306eLinux\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u5229\u7528\u3067\u304d\u308b\n\n## InfiniBand\u3063\u3066\uff1f\n\nInfiniBand\u306b\u3064\u3044\u3066\u306f\u3001\u73fe\u5728xinolinx\u3067\u4e00\u4eba\u52c9\u5f37\u4f1a\u3092\u5b9f\u65bd\u4e2d\u3067\u3059\u3002\u53c2\u8003\u306b\u306a\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\n- InfiniBand\u3056\u3063\u304f\u308a\u307e\u3068\u3081\n - [\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(1)](https://xinolinx.github.io/001-InfiniBand-Reading-for-me-001/)\n - [\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(2)](https://xinolinx.github.io/002-InfiniBand-Reading-for-me-002/)\n - [\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(3)](https://xinolinx.github.io/003-InfiniBand-Reading-for-me-003/)\n - [\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(3)+1](https://xinolinx.github.io/005-InfiniBand-Reading-for-me-005/)\n - [\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(3)+2](https://xinolinx.github.io/007-InfiniBand-Reading-for-me-006/)\n - [\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(4)](https://xinolinx.github.io/004-InfiniBand-Reading-for-me-004/)\n - [\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(5)](https://xinolinx.github.io/001-InfiniBand-Reading-for-me-007/)\n - [\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(6)-1](https://xinolinx.github.io/002-InfiniBand-Reading-for-me-008/)\n - [\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(6)](https://xinolinx.github.io/006-InfiniBand-Reading-for-me-009/)\n - [\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(7)](https://xinolinx.github.io/003-InfiniBand-Reading-for-me-010/)\n - [\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(8)](https://xinolinx.github.io/001-InfiniBand-Reading-for-me-011/)\n - [\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(9)](https://xinolinx.github.io/002-InfiniBand-Reading-for-me-012/)\n - [\u3072\u3068\u308aInfiniBand\u52c9\u5f37\u4f1a(10)](https://xinolinx.github.io/003-InfiniBand-Reading-for-me-013/)\n\n\n\n# \u4eee\u60f3\u30de\u30b7\u30f3\u3068OS\u306e\u6e96\u5099(CentOS 7)\n\n\n\u4eca\u56de\u306f[Oracle VM VirtualBox(5.1.10 Windows 64bit)](http://www.oracle.com/technetwork/server-storage/virtualbox/downloads/index.html)\u3092\u5229\u7528\u3057\u307e\u3057\u305f\u3002\n\n![vbox_001.png](https://qiita-image-store.s3.amazonaws.com/0/162006/b7ca3a19-a7e6-00e8-7cc7-2962a53fe5d1.png)\n\n## \u4eee\u60f3\u30de\u30b7\u30f3\u306e\u4f5c\u6210\n\n1. \u300c\u65b0\u898f\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u4f5c\u6210\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n1. \u300c\u540d\u524d\u300d\u306b\u9069\u5f53\u306a\u540d\u524d(\u4eca\u56de\u306fCentOS7_test)\u3068\u3057\u3001\u300cRed Hat(64-bit)\u300d\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n1. \u30e1\u30e2\u30ea\u3092\u9069\u5ea6\u306b\u5272\u308a\u5f53\u3066\u3066\u304f\u3060\u3055\u3044\u3001\u4eca\u56de\u306f4096MB\u5272\u308a\u5f53\u3066\u307e\u3057\u305f\u3002\n1. \u4eee\u60f3\u30cf\u30fc\u30c9\u30c7\u30a3\u30b9\u30af\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u300cVDI\u300d\u306e\u300c\u53ef\u5909\u30b5\u30a4\u30ba\u300d\u3067\u300c2TB\u300d\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n1. \u4eee\u60f3\u30de\u30b7\u30f3\u3092\u9078\u629e\u3057\u3066\u300c\u8a2d\u5b9a\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n1. \u300c\u30b9\u30c8\u30ec\u30fc\u30b8\u300d\u3067\u300cDVD\u30de\u30fc\u30af\u300d\u306e\u4e2d\u306e\u300c\u4eee\u60f3\u5149\u5b66\u30c7\u30a3\u30b9\u30af\u30d5\u30a1\u30a4\u30eb\u3092\u9078\u629e\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n1. OS\u3068\u3057\u3066[CentOS-7-x86_64-LiveGNOME-1511.iso](http://ftp.riken.jp/Linux/centos/7/isos/x86_64/)\u3092\u4f7f\u3044\u307e\u3059\u3002\n1. \u300c\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u300d\u3067\u300c\u30a2\u30c0\u30d7\u30bf\u30fc1\u300d\u306e\u5272\u308a\u5f53\u3066\u3092\u300c\u30d6\u30ea\u30c3\u30b8\u30a2\u30c0\u30d7\u30bf\u30fc\u300d\u306b\u3057\u307e\u3059\u3002\n1. \u300cOK\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u8a2d\u5b9a\u753b\u9762\u3092\u9589\u3058\u307e\u3059\u3002\n\n![vbox_002.png](https://qiita-image-store.s3.amazonaws.com/0/162006/544c05f2-5e00-f892-d8a7-ac15eab20998.png)\n\n## CentOS7\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n1. \u300c\u8d77\u52d5\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001\u4eee\u60f3\u30e2\u30cb\u30bf\u5185\u306e\u300cStart CentOS Linux\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059(*\u30d5\u30a9\u30fc\u30ab\u30b9\u3092\u5916\u3059\u5834\u5408\u306f\u53f3Ctrl\u3067\u3059*)\u3002\n1. \u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u306e\u3067\u3001\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u4e0a\u306e\u300cInstall toHard Drive\u300d\u3092\u958b\u304d\u307e\u3059\u3002\n1. \u300cEnglish\u300d\u300cEnglish(United States)\u300d\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n1. \u300cKEYBOARD\u300d\u3067\u300cJapanese\u300d\u3092\u8ffd\u52a0\u3057\u3066\u300cUS\u300d\u3092\u524a\u9664\u3057\u307e\u3059\uff08\u203bUS\u30ad\u30fc\u30dc\u30fc\u30c9\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u65b9\u306f\u5909\u66f4\u4e0d\u8981\u3067\u3059\uff09\u3002\n1. \u300cINSTALL DESTINATION\u300d\u3067\u300cATA VBOX HARDDISK\u300d\u3092\u9078\u629e\u3057\u3066\u300cDone\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n1. \u300cBegin Instration\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n1. \u300cROOT PASSWORD\u300d\u3068\u300cUSER CREATION\u300d\u306f\u9069\u5b9c\u884c\u3063\u3066\u304f\u3060\u3055\u3044\u3002\n1. \u7d42\u308f\u3063\u305f\u3089\u3001\u53f3\u4e0a\u306e\u96fb\u6e90\u30a2\u30a4\u30b3\u30f3\u304b\u3089\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u96fb\u6e90\u3092\u5207\u308a\u307e\u3059\u3002\n1. \u4eee\u60f3\u30de\u30b7\u30f3\u3092\u9078\u629e\u3057\u3066\u300c\u8a2d\u5b9a\u300d\u304b\u3089\u300c\u30b9\u30c8\u30ec\u30fc\u30b8\u300d\u3067\u4eee\u60f3\u5149\u5b66\u30c7\u30a3\u30b9\u30af\u30d5\u30a1\u30a4\u30eb\u306e\u5272\u308a\u5f53\u3066\u3092\u89e3\u9664\u3057\u307e\u3059\u3002\n\n\u4ee5\u4e0a\u3067\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u6e96\u5099\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n\n# Linux\u306e\u4e8b\u524d\u6e96\u5099\n\n## sshd\u306e\u8d77\u52d5\n\n\u958b\u767a\u306b\u5fc5\u8981\u30b5\u30fc\u30d3\u30b9\u306e\u6709\u52b9\u5316\u3001\u8a2d\u5b9a\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3044\u307e\u3059\u3002\nApllication\u306e\u4e2d\u304b\u3089\u300cTerminal\u300d\u3092\u63a2\u3057\u3066\u958b\u304d\u3001\u6700\u4f4e\u9650\u306e\u8a2d\u5b9a\u3092\u3057\u305f\u5f8c\u3001\n[putty](http://hp.vector.co.jp/authors/VA024651/PuTTYkj.html)\u7b49\u3067\u30ea\u30e2\u30fc\u30c8\u4f5c\u696d\u3059\u308b\u3068\u697d\u3067\u3059\u3002\n\n```bash\n$ ifconfig\n<IP address \u304c\u8868\u793a\u3055\u308c\u307e\u3059>\n$ su\nPassword: \n# systemctl enable sshd\n# systemctl start sshd\n# systemctl set-default multi-user.target\n# reboot\n```\n\n![vbox_003.png](https://qiita-image-store.s3.amazonaws.com/0/162006/e81b19b7-1180-c1c3-d4ef-dd635a8fb09a.png)\n\n\n\n## \u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n### sudo\u3092\u7c21\u5358\u306b\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3059(\u4efb\u610f)\n\n```bash\n$ su\nPassword:\n# vi /etc/sudoers\n...\n## Allow root to run any commands anywhere\nroot    ALL=(ALL)       ALL\nshino   ALL=(ALL)       ALL # Add this Line\n...\n## Allows people in group wheel to run all commands\n#%wheel ALL=(ALL)       ALL # Comment Out this line \n\n## Same thing without a password\n%wheel  ALL=(ALL)       NOPASSWD: ALL # Enable this line\n...\n# exit\n$\n```\n\n### \u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u66f4\u65b0\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb(\u5fc5\u9808)\n\n```bash\n$ sudo yum update -y\n$ sudo reboot\n\n...<REBOOTING:Kernel\u304c\u5909\u308f\u308b\u305f\u3081>...\n\n$ sudo yum install -y git\n$ sudo yum install -y gcc\n$ sudo yum install -y libibverbs*\n$ sudo yum install -y rdma*\n$ sudo yum install -y opensm\n$ sudo yum install -y opensm-libs\n$ sudo yum install -y rpm-build\n$ sudo yum install -y kernel-devel\n$ cd ~/\n$ mkdir -p rpmbuild/SOURCES/\n```\n\n\u307e\u305f\u95a2\u9023\u3059\u308b\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```bash\n$ sudo systemctl enable rdma\n$ sudo systemctl start rdma\n```\n\n# \u4eee\u60f3InfiniBand\u30c7\u30d0\u30a4\u30b9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\nInfiniBand\u30c7\u30d0\u30a4\u30b9\u306fAmazon\u3067\u8cfc\u5165\u3057\u3066\u3082\u975e\u5e38\u306b\u9ad8\u4fa1\u3067\u3059\u306e\u3067\u3001\u4eca\u56de\u306f[nminoru\u69d8\u306epib](https://github.com/nminoru/pib)\u3092\u5229\u7528\u3057\u307e\u3059\u3002\u3053\u3061\u3089\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306fEthernet\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4e0a\u3001\u307e\u305f\u306f\u3001*\u30b7\u30f3\u30b0\u30eb\u30ce\u30fc\u30c9(\u4eca\u56de\u306e\u8a18\u4e8b\u306f\u3053\u308c)*\u306bInfiniBand\u30c7\u30d0\u30a4\u30b9\u3092\u4eee\u60f3\u7684\u306b\u642d\u8f09\u3057\u3001InfiniBand\u306eVerbs(InfiniBand Host-Channel-Adabter\u306e\u63d0\u4f9b\u3059\u308b\u6a5f\u80fd)\u3092Kick\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u7fa4\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u672c\u5f53\u306f\u3001\u672c\u5bb6\u3092\u5229\u7528\u3057\u305f\u3044\u3068\u3053\u308d\u306a\u306e\u3067\u3059\u304c\u3001CentOS 7\u306eKernel`3.10.0-514.6.1.el7.x86_64`\u306f\u3001define\u5468\u308a\u304c\u5909\u308f\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001CentOS7\u7528\u306b\u6539\u5909\u3057\u305f\u30b3\u30fc\u30c9\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002[\u3053\u3061\u3089\u306e\u30ea\u30dd\u30b8\u30c8\u30ea](https://github.com/xinolinx/pib)\u306bfork\u3057\u3001CentOS7\u7528\u306b\u4fee\u6b63\u3092\u304b\u3051\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f([\u5dee\u5206](https://github.com/xinolinx/pib/commit/3352be9ef376144c6fcba07295c8215a39cfc166))\u306e\u3067\u3001\u3053\u3061\u3089\u3092\u672c\u8a18\u4e8b\u3067\u306f\u4f7f\u3044\u307e\u3059\u3002\n\n```bash\n$ cd ./~\n$ git clone https://github.com/xinolinx/pib.git\n```\n\n## \u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\n\u307e\u305a\u306f\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u4e0b\u8a18\u306e\u624b\u9806\u3068\u306a\u308a\u307e\u3059\u3002\n\n```bash\n$ cp -r pib/driver pib-0.4.6\n$ tar czvf ./rpmbuild/SOURCES/pib-0.4.6.tar.gz pib-0.4.6/\n$ cp pib/driver/pib.conf ./rpmbuild/SOURCES/\n$ cp pib/driver/pib.files ./rpmbuild/SOURCES/\n$ rpmbuild -bs pib/driver/pib.spec\n$ rpmbuild --rebuild ./rpmbuild/SRPMS/pib-0.4.6-1.el7.centos.src.rpm\n$ sudo rpm -ihv ./rpmbuild/RPMS/x86_64/kmod-pib-0.4.6-1.el7.centos.x86_64.rpm\n```\n\n## \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u9023\u643a\u7528\u306eVerbs\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\nInfiniBand\u306f\u30e6\u30fc\u30b6\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089Verbs\u3068\u3044\u3046\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u4ecb\u3057\u3066\u5236\u5fa1\u3055\u308c\u307e\u3059\u304c\u3001Verbs\u3092\u6700\u521d\u306b\u51e6\u7406\u3059\u308b\u306e\u306f\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u3067\u306f\u306a\u304f\u3001\u5171\u6709\u30e9\u30a4\u30d6\u30e9\u30ea\u306b\u306a\u308a\u307e\u3059\u3002pib\u3067\u306f`libpib`\u3068\u3044\u3046\u5171\u6709\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u4eee\u60f3InfiniBand\u306eVerbs\u3092\u53d7\u3051\u53d6\u3063\u3066\u51e6\u7406\u3057\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u306b\u52a0\u3048\u3066`libpib`\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```bash\n$ cp -r pib/libpib libpib-0.0.6\n$ tar czvf ./rpmbuild/SOURCES/libpib-0.0.6.tar.gz libpib-0.0.6/\n$ rpmbuild -bs pib/libpib/libpib.spec\n$ rpmbuild --rebuild ./rpmbuild/SRPMS/libpib-0.0.6-1.el7.centos.src.rpm\n$ sudo rpm -ihv ./rpmbuild/RPMS/x86_64/libpib-0.0.6-1.el7.centos.x86_64.rpm\n```\n\n# \u3044\u3088\u3044\u3088InfiniBand\u3092\u8a66\u3057\u3066\u307f\u308b\n\n\u4ee5\u4e0a\u3067\u6e96\u5099\u306f\u5b8c\u4e86\u3057\u307e\u3057\u305f\u306e\u3067\u65e9\u901f\u8a66\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n## \u4eee\u60f3InfiniBand\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30ed\u30fc\u30c9\n\n\u65e9\u901f\u3001`kmod-pib-0.4.6-1.el7.centos.x86_64.rpm`\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb`pib.ko`\u3092\u30ed\u30fc\u30c9\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```bash\n$ lsmod | grep pib\n$ sudo modprobe pib\n$ lsmod | grep pib\npib                   120119  0\nib_core               210381  14 pib,rdma_cm,ib_cm,iw_cm,rpcrdma,ib_srp,ib_ucm,ib_iser,ib_srpt,ib_umad,ib_uverbs,rdma_ucm,ib_ipoib,ib_isert\n```\n\n\u30ed\u30fc\u30c9\u3067\u304d\u307e\u3057\u305f\u306d\uff01\u30c7\u30d0\u30a4\u30b9\u304c\u5b58\u5728\u3059\u308b\u304b\u3082\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```bash\n$ ls /dev/infiniband/\nissm0  issm2  rdma_cm  ucm1   umad1  umad3    uverbs1\nissm1  issm3  ucm0     umad0  umad2  uverbs0\n```\n\nInifiniBand\u30c7\u30d0\u30a4\u30b9\u306e\u7ba1\u7406\u306b\u306f`libibverbs-utils`\u304c\u4fbf\u5229\u3067\u3059\u3002`libibverbs-utils`\u306e\u63d0\u4f9b\u3059\u308b`ibv_devinfo`(*InfiniBand_Verbs-DEVice_INFO*)\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066\u3001\u65e9\u901f\u30c7\u30d0\u30a4\u30b9\u60c5\u5831\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u4e0b\u8a18\u306e\u3088\u3046\u306b2\u500b\u306eInfiniBand\u30c7\u30d0\u30a4\u30b9\u304c\u898b\u3048\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n```bash\n$ ibv_devinfo\nhca_id: pib_1\n        transport:                      InfiniBand (0)\n        fw_ver:                         0.4.006\n        node_guid:                      0800:278f:d669:0400\n        sys_image_guid:                 0800:278f:d669:0200\n        vendor_id:                      0x0001\n        vendor_part_id:                 1\n        hw_ver:                         0x0\n        phys_port_cnt:                  2\n                port:   1\n                        state:                  PORT_INIT (2)\n                        max_mtu:                4096 (5)\n                        active_mtu:             256 (1)\n                        sm_lid:                 0\n                        port_lid:               0\n                        port_lmc:               0x00\n                        link_layer:             InfiniBand\n\n                port:   2\n                        state:                  PORT_INIT (2)\n                        max_mtu:                4096 (5)\n                        active_mtu:             256 (1)\n                        sm_lid:                 0\n                        port_lid:               0\n                        port_lmc:               0x00\n                        link_layer:             InfiniBand\n\nhca_id: pib_0\n        transport:                      InfiniBand (0)\n        fw_ver:                         0.4.006\n        node_guid:                      0800:278f:d669:0300\n        sys_image_guid:                 0800:278f:d669:0200\n        vendor_id:                      0x0001\n        vendor_part_id:                 1\n        hw_ver:                         0x0\n        phys_port_cnt:                  2\n                port:   1\n                        state:                  PORT_INIT (2)\n                        max_mtu:                4096 (5)\n                        active_mtu:             256 (1)\n                        sm_lid:                 0\n                        port_lid:               0\n                        port_lmc:               0x00\n                        link_layer:             InfiniBand\n\n                port:   2\n                        state:                  PORT_INIT (2)\n                        max_mtu:                4096 (5)\n                        active_mtu:             256 (1)\n                        sm_lid:                 0\n                        port_lid:               0\n                        port_lmc:               0x00\n                        link_layer:             InfiniBand\n```\n\n\u304a\u3084\u3001**port\u306e\u72b6\u614b\u304cINIT\u72b6\u614b\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u306d**\u3002\u3053\u308c\u306f\u3001InfiniBand Architecture\u3067\u306f\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5185(Subnet\u5185)\u306e\u30ea\u30bd\u30fc\u30b9\u306f\u3001*Subnet-Manager*\u304c\u7ba1\u7406\u3059\u308b\u3053\u3068\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001*Subnet-Manager*\u304c\u4e0d\u5728\u306a\u72b6\u614b\u3067\u306f\u3001\u521d\u671f\u5316\u4e2d(INIT\u72b6\u614b)\u3067\u5f85\u3061\u72b6\u614b\u3068\u306a\u308a\u307e\u3059\u3002\u305d\u3053\u3067\u3001Linux\u306e`opensm`(*Open-Subnet-Manager*)\u3092\u8d77\u52d5\u3057\u3001\u518d\u5ea6\u30c7\u30d0\u30a4\u30b9\u60c5\u5831\u3092\u898b\u308b\u3068\u3001\u4eca\u5ea6\u306f**ACTIVE(\u901a\u4fe1\u53ef\u80fd\u72b6\u614b)**\u306b\u306a\u3063\u305f\u3068\u601d\u3044\u307e\u3059\u3002\n\n```bash\n$ sudo systemctl start opensm\n$ ibv_devinfo | grep state\n                        state:                  PORT_ACTIVE (4)\n                        state:                  PORT_ACTIVE (4)\n                        state:                  PORT_ACTIVE (4)\n                        state:                  PORT_ACTIVE (4)\n```\n\n![inifiniband_fig_001.png](https://qiita-image-store.s3.amazonaws.com/0/162006/ddc91e02-c253-0021-72b8-e98b7b4393dc.png)\n\n- **\u53c2\u8003** [http://buyya.com/superstorage/chap42.pdf](http://buyya.com/superstorage/chap42.pdf)\n\n\u4ee5\u4e0a\u3067\u3001\u901a\u4fe1\u6e96\u5099\u304c\u3067\u304d\u307e\u3057\u305f\u3002\u30ef\u30af\u30ef\u30af\u3057\u3066\u304d\u307e\u3057\u305f\u3002\n\n\n# InfiniBand Test\n\n\u305d\u308c\u3067\u306f\u3001InfiniBand\u3067\u6709\u540d\u306amellanox\u793e\u306e\u516c\u958b\u3057\u3066\u3044\u308b\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u300c[RDMA Aware Programming user manual](mellanox.com/related-docs/prod_software/RDMA_Aware_Programming_user_manual.pdf)\u300d\u306b\u3042\u308b\u901a\u4fe1\u30d7\u30ed\u30b0\u30e9\u30e0\u4f8b(7.2\u7bc0)\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n## InfiniBand Test\u306e\u6e96\u5099\n\n\u305d\u308c\u3067\u306f\u3001\u65e9\u901fInfiniBand\u3092\u4f7f\u3063\u3066\u901a\u4fe1\u3092\u884c\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u5fc5\u8981\u306aInfiniBand Test\u3092[\u3053\u3061\u3089](https://github.com/xinolinx/infiniband_verbs_test)\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u53d6\u5f97\u3057\u3001\u30d3\u30eb\u30c9\u3057\u307e\u3059(\u3053\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306f\u3001\u300c[RDMA Aware Programming user manual](mellanox.com/related-docs/prod_software/RDMA_Aware_Programming_user_manual.pdf)\u300d\u306e7.2\u7ae0\u306b\u3042\u308b\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u305d\u306e\u307e\u307e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306b\u5909\u63db\u3057\u305f\u3082\u306e\u3067\u3059)\u3002\u305d\u3057\u3066\u3001\u4eee\u60f3InfiniBand\u30c7\u30d0\u30a4\u30b9`pib_0`\u3068`pib_1`\u306e\u9593\u3067\u901a\u4fe1\u3092\u8a66\u3057\u3066\u307f\u305f\u3044\u306e\u3067\u3001`start_server.sh`\u306b`-d pib_0`\u3092\u3001`start_client.sh`\u306b`-d pib_1`\u3092\u4ed8\u52a0\u3057\u307e\u3059\u3002\n\n```bash\n$ cd ~/\n$ git clone https://github.com/xinolinx/infiniband_verbs_test.git\n$ cd ./infiniband_verbs_test\n$ cd ./mellanox\n$ cd ./RDMA_Prog_Ch7_IBVVerbs\n$ make\n$ ls\nmain.c  main.o  Makefile  RDMA_RC_example  start_client.sh  start_server.sh\n$ vi ./start_server.sh\n..\n./RDMA_RC_example -d pib_0    # add \"-d pib_0\"\n$ vi ./start_client.sh\n..\n./RDMA_RC_example -d pib_1 $1 # add \"-d pib_1\"\n```\n\n## InfiniBand Test\u306e\u5b9f\u884c\n\n\u307e\u305a\u3001Server\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash\n$ ./start_server.sh\nInfiniband hardware address can be incorrect! Please read BUGS section in ifconfig(8).\nInfiniband hardware address can be incorrect! Please read BUGS section in ifconfig(8).\nInfiniband hardware address can be incorrect! Please read BUGS section in ifconfig(8).\nInfiniband hardware address can be incorrect! Please read BUGS section in ifconfig(8).\n        inet 192.168.0.17  netmask 255.255.255.0  broadcast 192.168.0.255\n ------------------------------------------------\n Device name : \"pib_0\"\n IB port : 1\n TCP port : 19875\n ------------------------------------------------\n\nwaiting on port 19875 for TCP connection\npib: sock_connect: set servername=(null):19875\n```\n\n\u6b21\u306bclient\u3092\u8d77\u52d5\u3057\u3001\u8a66\u9a13\u3092\u6d41\u3057\u307e\u3059\u3002\n\n```bash\n$ ./start_client.sh 127.0.0.1\n ------------------------------------------------\n Device name : \"pib_1\"\n IB port : 1\n IP : 127.0.0.1\n TCP port : 19875\n ------------------------------------------------\n\npib: sock_connect: set servername=127.0.0.1:19875\nTCP connection was established\nsearching for IB devices in host\nfound 2 device(s)\nMR was registered with addr=0xf68450, lkey=0xb1d00000, rkey=0xb1e00000, flags=0x7\nQP was created, QP number=0x38e24c\n\nLocal LID = 0x3\nRemote address = 0xc10450\nRemote rkey = 0xc1c00000\nRemote QP number = 0x3b2350\nRemote LID = 0x1\nClient - first post_receive().\nReceive Request was posted\nQP state was change to RTS\nWait both sides we expect to get a completion.\ncompletion was found in CQ with status 0x0\nMessage is: 'SEND operation '\nClient - post_send(IBV_WR_RDMA_READ).\nRDMA Read Request was posted\ncompletion was found in CQ with status 0x0\nContents of server's buffer: 'RDMA read operatuverbs1'\nNow replacing it with: 'RDMA write operation'\nClient - post_send(IBV_WR_RDMA_WRITE).\nRDMA Write Request was posted\ncompletion was found in CQ with status 0x0\n\ntest result is 0\n```\n\nServer\u5074\u3082\u901a\u4fe1\u30ed\u30b0\u304c\u51fa\u529b\u3055\u308c\u3001\u901a\u4fe1\u304c\u6210\u529f\u3057\u305f\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n```bash\nTCP connection was established\nsearching for IB devices in host\nfound 2 device(s)\ngoing to send the message: 'SEND operation '\nMR was registered with addr=0xc10450, lkey=0xc2300000, rkey=0xc1c00000, flags=0x7\nQP was created, QP number=0x3b2350\n\nLocal LID = 0x1\nRemote address = 0xf68450\nRemote rkey = 0xb1e00000\nRemote QP number = 0x38e24c\nRemote LID = 0x3\nQP state was change to RTS\nServer - first post_send(IBV_WR_SEND).\nSend Request was posted\nWait both sides we expect to get a completion.\ncompletion was found in CQ with status 0x0\nContents of server buffer: 'RDMA write operaion '\n\ntest result is 0\n```\n\n**\u51fa\u6765\u307e\u3057\u305f\u306d\uff01\uff01\u304a\u3064\u304b\u308c\u3055\u307e\u3067\u3057\u305f\u3001\u7121\u4e8b\u5b8c\u4e86\u3067\u3059\u3002**\n\n\u4eca\u56de\u306e\u307e\u3068\u3081\u3092\u6539\u3081\u3066\u66f8\u3044\u3066\u307f\u305f\u3053\u3068\u3067\u3001\u6ca2\u5c71\u306eSoftware\u3084\u30de\u30cb\u30e5\u30a2\u30eb\u304c\u6574\u5099\u3055\u308c\u3066\u3044\u308b\u304a\u9670\u3067\u3001\u672c\u5f53\u306b\u8eab\u8fd1\u306b\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3053\u3068\u306f\u7d20\u6674\u3089\u3057\u3044\u4e8b\u3068\u611f\u3058\u307e\u3057\u305f\u3002\u672c\u5f53\u306b\u3001\u95a2\u4fc2\u5404\u6240\u3055\u307e\u65b9\u3005\u3001\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\n\n\u305d\u308c\u3067\u306f\u3001\u7d20\u6575\u306a InfiniBand Life\u3092\u304a\u904e\u3054\u3057\u304f\u3060\u3055\u3044\u3002\n", "tags": ["Linux", "kernel", "infiniband", "CentOS", "driver"]}