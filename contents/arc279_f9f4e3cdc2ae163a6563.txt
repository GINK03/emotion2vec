{"context": " More than 1 year has passed since last update.\n\nutf32\u30b3\u30fc\u30c9\u30dd\u30a4\u30f3\u30c8\u3092utf16\u30b5\u30ed\u30b2\u30fc\u30c8\u30da\u30a2\u306b\u5909\u63db\u3059\u308b\n\u3061\u3087\u3063\u3068\u5fc5\u8981\u306b\u306a\u3063\u3066\u8abf\u3079\u305f\u306e\u3067\u30e1\u30e2\u66f8\u304d\u3002\nruby\u306e Array#pack(\"U*\") \u7684\u306a\u3084\u3064\u3002\n#!/bin/bash\n\nfunction utf8Esc() {\n    # \"\\xXX\" \u5f62\u5f0f\u306b\u3059\u308b\n    fold -s2 | xargs -i echo -n \"\\x{}\"\n}\n\nfunction unicodeEsc() {\n    # \"\\uXXXX\" \u5f62\u5f0f\u306b\u3059\u308b\n    fold -s4 | xargs -i echo -n \"\\u{}\"\n}\n\n\nfunction packUtf32() {\n    # utf32be \u306e\u30b3\u30fc\u30c9\u30dd\u30a4\u30f3\u30c8\u3092 utf8 \u306b\u3059\u308b\n    xargs printf \"%08X\" | xxd -r -p | \\\n    iconv -f utf32be -t utf8\n}\n\nfunction utf32ToEscapedUtf16() {\n    # utf32be \u306e\u30b3\u30fc\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u30b5\u30ed\u30b2\u30fc\u30c8\u30da\u30a2\u306e utf16be \u306b\u3059\u308b\n    xargs printf \"%08X\" | xxd -r -p | \\\n    iconv -f utf32be -t utf16be | \\\n    xxd -p | unicodeEsc\n}\n\n\nVAL=0x2000B  # \ud840\udc0b\n\necho \"bash ---------------------------\"\necho $VAL | packUtf32 | xxd -p\necho $VAL | packUtf32\necho\necho $VAL | utf32ToEscapedUtf16\necho\necho\n\necho \"ruby ---------------------------\"\necho \"print [$VAL].pack('U*')\" | ruby | xxd -p\necho \"print [$VAL].pack('U*')\" | ruby\necho\ncat <<EOD | ruby\nrequire \"json/pure\"\nputs JSON.utf8_to_json_ascii([$VAL].pack(\"U*\"))\nEOD\n\n\noutput\nbash ---------------------------\nf0a0808b\n\ud840\udc0b\n\\ud840\\udc0b\n\nruby ---------------------------\nf0a0808b\n\ud840\udc0b\n\\ud840\\udc0b\n\n\n\n\u6700\u521d\u304b\u3089ruby\u3067\u3084\u308c\u3070\u3044\u3044\u3058\u3083\u3093\n\u3068\u304b\u8a00\u308f\u306a\u3044\u3002\necho 0x2000B | ruby -r \"json/pure\" -e \"print JSON.utf8_to_json_ascii([ STDIN.read.hex ].pack('U*'))\"\n\n\n\u4e3b\u306b\u53c2\u8003\u306b\u3057\u305f\u3068\u3053\nhttp://0xcc.net/blog/archives/000183.html\n# utf32\u30b3\u30fc\u30c9\u30dd\u30a4\u30f3\u30c8\u3092utf16\u30b5\u30ed\u30b2\u30fc\u30c8\u30da\u30a2\u306b\u5909\u63db\u3059\u308b\n\n\u3061\u3087\u3063\u3068\u5fc5\u8981\u306b\u306a\u3063\u3066\u8abf\u3079\u305f\u306e\u3067\u30e1\u30e2\u66f8\u304d\u3002\nruby\u306e `Array#pack(\"U*\")` \u7684\u306a\u3084\u3064\u3002\n\n```bash\n#!/bin/bash\n\nfunction utf8Esc() {\n    # \"\\xXX\" \u5f62\u5f0f\u306b\u3059\u308b\n    fold -s2 | xargs -i echo -n \"\\x{}\"\n}\n\nfunction unicodeEsc() {\n    # \"\\uXXXX\" \u5f62\u5f0f\u306b\u3059\u308b\n    fold -s4 | xargs -i echo -n \"\\u{}\"\n}\n\n\nfunction packUtf32() {\n    # utf32be \u306e\u30b3\u30fc\u30c9\u30dd\u30a4\u30f3\u30c8\u3092 utf8 \u306b\u3059\u308b\n    xargs printf \"%08X\" | xxd -r -p | \\\n    iconv -f utf32be -t utf8\n}\n\nfunction utf32ToEscapedUtf16() {\n    # utf32be \u306e\u30b3\u30fc\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u30b5\u30ed\u30b2\u30fc\u30c8\u30da\u30a2\u306e utf16be \u306b\u3059\u308b\n    xargs printf \"%08X\" | xxd -r -p | \\\n    iconv -f utf32be -t utf16be | \\\n    xxd -p | unicodeEsc\n}\n\n\nVAL=0x2000B  # \ud840\udc0b\n\necho \"bash ---------------------------\"\necho $VAL | packUtf32 | xxd -p\necho $VAL | packUtf32\necho\necho $VAL | utf32ToEscapedUtf16\necho\necho\n\necho \"ruby ---------------------------\"\necho \"print [$VAL].pack('U*')\" | ruby | xxd -p\necho \"print [$VAL].pack('U*')\" | ruby\necho\ncat <<EOD | ruby\nrequire \"json/pure\"\nputs JSON.utf8_to_json_ascii([$VAL].pack(\"U*\"))\nEOD\n```\n\n```txt:output\nbash ---------------------------\nf0a0808b\n\ud840\udc0b\n\\ud840\\udc0b\n\nruby ---------------------------\nf0a0808b\n\ud840\udc0b\n\\ud840\\udc0b\n```\n\n## \u6700\u521d\u304b\u3089ruby\u3067\u3084\u308c\u3070\u3044\u3044\u3058\u3083\u3093\n\n\u3068\u304b\u8a00\u308f\u306a\u3044\u3002\n\n```rb\necho 0x2000B | ruby -r \"json/pure\" -e \"print JSON.utf8_to_json_ascii([ STDIN.read.hex ].pack('U*'))\"\n```\n\n\n## \u4e3b\u306b\u53c2\u8003\u306b\u3057\u305f\u3068\u3053\n\nhttp://0xcc.net/blog/archives/000183.html\n", "tags": ["Bash", "unicode"]}