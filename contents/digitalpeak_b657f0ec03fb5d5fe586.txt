{"context": " More than 1 year has passed since last update.\n\n\u76ee\u7684\n\nAZ\u3092\u8de8\u3044\u3060\u5197\u9577\u69cb\u6210\uff08Active-Standby\uff09\n\u6d6e\u52d5ip\u3067\u306e\u904b\u7528\u3067\u306a\u304f\u3001ELB\u306e\u30d8\u30eb\u30b9\u30c1\u30a7\u30c3\u30af\u306b\u4f9d\u5b58\u3055\u305b\u308b\n\n\n\u6700\u8fd1Update\u3055\u308c\u305f\u6a5f\u80fd\u306b\u3088\u308a\u3001\u904b\u7528\u304c\u53ef\u80fd\n\n\nRegister or De-Register EC2 Instances for Your Load Balancer\n\n\n\n\n\u30aa\u30fc\u30c8\u30c7\u30a3\u30b9\u30ab\u30d0\u30ea\u306f\u7121\u52b9\u306b\u3057\u3001Zabbix-agent\uff08\u30a2\u30af\u30c6\u30a3\u30d6\uff09\u306bInternal-ELB\u3092\u8a18\u8ff0\u3057\u3001\u30ce\u30fc\u30c9\u306e\u81ea\u52d5\u767b\u9332\u3092\u884c\u3046\n\n\n\u30a4\u30e1\u30fc\u30b8\n\n\n\u74b0\u5883\n\nt2-micro(\u904b\u7528\u3057\u3066\u3044\u304f\u306b\u306fC4\u4ee5\u4e0a\u304c\u597d\u307e\u3057\u3044)\nActive/Standby\u69cb\u6210\uff08Standby\u306f\u30b5\u30fc\u30d0\u306f\u8d77\u52d5\u3057\u3066\u3044\u308b\u304c\u3001F/O\u306e\u30c8\u30ea\u30ac\u30fc\u3068\u306a\u308b\u30d7\u30ed\u30bb\u30b9\u3092\u505c\u6b62\u3055\u305b\u3066\u3044\u308b\uff09\nF/O\u306e\u30c8\u30ea\u30ac\u30fc\u306fzabbix-server\u306e\u505c\u6b62\n\u30af\u30e9\u30b9\u30bf\u5236\u5fa1\u306b\u306fCorosync\u3001\u30ea\u30bd\u30fc\u30b9\u5236\u5fa1\u306fPacemaker\u3092\u4f7f\u7528\n\n\nRundeck -\u69cb\u7bc9\uff08H/A\uff09-\n\n\n\n\n\u69cb\u7bc9\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo rpm -ivh http://repo.zabbix.com/zabbix/2.4/rhel/6/x86_64/zabbix-release-2.4-1.el6.noarch.rpm\n$ sudo yum install zabbix-server-mysql zabbix-web-mysql zabbix-web-japanese zabbix-agent\n\n\n\u8a2d\u5b9a\n\nMySQL\n\u6587\u5b57\u5316\u3051\u3057\u306a\u3044\u3088\u3046\u306b\u4e8b\u524d\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u308a\u3001character_set_client\u3068character_set_server\u306e\u5024\u3092utf-8\u306b\u3057\u3066\u304a\u304f\u3002\n\n$ mysql -h <rds-endpoint> -u <user> -p\nmysql> grant all privileges on <dbname>.* to <user>@localhost identified by '<password>';\n\n#\u521d\u671f\u30b9\u30ad\u30fc\u30de\u3068\u30c7\u30fc\u30bf\u3092\u30a4\u30f3\u30dd\u30fc\u30c8\n$ cd /usr/share/doc/zabbix-server-mysql-2.4.7/create\n$ mysql -h <rds-endpoint> <db> -u <user> -p < schema.sql\n$ mysql -h <rds-endpoint> <db> -u <user> -p < images.sql\n$ mysql -h <rds-endpoint> <db> -u <user> -p < data.sql\n\n\nzabbix-server\n\nzabbix_server.conf\n### Option: ListenPort\n#       Listen port for trapper.\n#\n# Mandatory: no\n# Range: 1024-32767\n# Default\n# ListenPort=10051\n\n### Option: DBHost\n#       Database host name.\n#       If set to localhost, socket is used for MySQL.\n#       If set to empty string, socket is used for PostgreSQL.\n#\n# Mandatory: no\n# Default:\n# DBHost=localhost\nDBHost=<rds-endpoint>\n### Option: DBName\n#       Database name.\n#       For SQLite3 path to database file must be provided. DBUser and DBPassword are ignored.\n#\n# Mandatory: yes\n# Default:\n# DBName=\n\nDBName=<DBName>\n\n### Option: DBSchema\n#       Schema name. Used for IBM DB2 and PostgreSQL.\n#\n# Mandatory: no\n# Default:\n# DBSchema=\n\n### Option: DBUser\n#       Database user. Ignored for SQLite.\n#\n# Mandatory: no\n# Default:\n# DBUser=\n\nDBUser=<user>\n\n### Option: DBPassword\n#       Database password. Ignored for SQLite.\n#       Comment this line if no password is used.\n#\n# Mandatory: no\n# Default:\n# DBPassword=\nDBPassword=********\n### Option: DBSocket\n#       Path to MySQL socket.\n#\n# Mandatory: no\n# Default:\n# DBSocket=/tmp/mysql.sock\n\nDBSocket=/var/lib/mysql/mysql.sock\n\n\n\nzabbix_agent.conf\n### Option: Server\n#       List of comma delimited IP addresses (or hostnames) of Zabbix servers.\n#       Incoming connections will be accepted only from the hosts listed here.\n#       If IPv6 support is enabled then '127.0.0.1', '::127.0.0.1', '::ffff:127.0.0.1' are treated equally.\n#\n# Mandatory: no\n# Default:\n# Server=\n\nServer=10.0.1.23,10.0.3.60\n\n### Option: ListenPort\n#       Agent will listen on this port for connections from the server.\n#\n# Mandatory: no\n# Range: 1024-32767\n# Default:\nListenPort=10050\n\n### Option: ServerActive\n#       List of comma delimited IP:port (or hostname:port) pairs of Zabbix servers for active checks.\n#       If port is not specified, default port is used.\n#       IPv6 addresses must be enclosed in square brackets if port for that host is specified.\n#       If port is not specified, square brackets for IPv6 addresses are optional.\n#       If this parameter is not specified, active checks are disabled.\n#       Example: ServerActive=127.0.0.1:20051,zabbix.domain,[::1]:30051,::1,[12fc::1]\n#\n# Mandatory: no\n# Default:\n# ServerActive=\n\nServerActive=<internal ELB A\u30ec\u30b3\u30fc\u30c9>or<internal ELB CNAME>\n\n### Option: Hostname\n#       Unique, case sensitive hostname.\n#       Required for active checks and must match hostname as configured on the server.\n#       Value is acquired from HostnameItem if undefined.\n#\n# Mandatory: no\n# Default:\n# Hostname=\n\n#Hostname=Zabbix server\n\n### Option: HostnameItem\n#       Item used for generating Hostname if it is undefined. Ignored if Hostname is defined.\n#       Does not support UserParameters or aliases.\n#\n# Mandatory: no\n# Default:\nHostnameItem=system.hostname\n\n\n\nApache/PHP\n\nhttpd.conf\n$ sudo vim /etc/httpd/conf/httpd.conf\n# DocumentRoot: The directory out of which you will serve your\n# documents. By default, all requests are taken from this directory, but\n# symbolic links and aliases may be used to point to other locations.\n#\nDocumentRoot \"/var/www/zabbix\"\n\n\n$ cd /var/www\n$ sudo ln -s /usr/share/zabbix zabbix\n\n$ sudo vim /etc/php.ini\npost_max_size = 16M\nmax_execution_time = 300\nmax_input_time = 300\ndate.timezone = Asia/Tokyo\nalways_populate_raw_post_data = -1\n\n\n\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\n$ sudo service httpd start&&sudo chkconfig httpd on\n$ sudo service zabbix-server start&&sudo chkconfig zabbix-server on\n$ sudo service zabbix-agent start&&sudo chkconfig zabbix-agent on\n\n\n\n\n\n\n\n\u81ea\u52d5\u767b\u9332\u30a2\u30af\u30b7\u30e7\u30f3\n\nAction\u306b\u306e\u307f\u8868\u793a\u3055\u305b\u308b\u30db\u30b9\u30c8\u60c5\u5831\u3092\u8a18\u8ff0\n\n\nConditions\u8a18\u8ff0\u4e0d\u8981\u3002Operations\u306f\u300c\u30db\u30b9\u30c8\u8ffd\u52a0\u300d\u300c\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3068\u30ea\u30f3\u30af\u300d\n\n\n\n\n\n\n\n\nzabbix-agent\n\n\u76e3\u8996\u5bfe\u8c61\u30ce\u30fc\u30c9\u306b\u8a2d\u5b9a\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo rpm -ivh http://repo.zabbix.com/zabbix/2.4/rhel/6/x86_64/zabbix-release-2.4-1.el6.noarch.rpm\n$ sudo yum -y install zabbix-agent\n\n\nzabbix_agent.conf\n### Option: SourceIP\n#   Source IP address for outgoing connections.\n#\n# Mandatory: no\n# Default:\n# SourceIP=\nSourceIP=10.0.3.6\n\n### Option: Server\n#       List of comma delimited IP addresses (or hostnames) of Zabbix servers.\n#       Incoming connections will be accepted only from the hosts listed here.\n#       If IPv6 support is enabled then '127.0.0.1', '::127.0.0.1', '::ffff:127.0.0.1' are treated equally.\n#\n# Mandatory: no\n# Default:\n# Server=\n\nServer=10.0.1.23,10.0.3.60\n\n### Option: ListenPort\n#       Agent will listen on this port for connections from the server.\n#\n# Mandatory: no\n# Range: 1024-32767\n# Default:\nListenPort=10050\n\n### Option: ServerActive\n#       List of comma delimited IP:port (or hostname:port) pairs of Zabbix servers for active checks.\n#       If port is not specified, default port is used.\n#       IPv6 addresses must be enclosed in square brackets if port for that host is specified.\n#       If port is not specified, square brackets for IPv6 addresses are optional.\n#       If this parameter is not specified, active checks are disabled.\n#       Example: ServerActive=127.0.0.1:20051,zabbix.domain,[::1]:30051,::1,[12fc::1]\n#\n# Mandatory: no\n# Default:\n# ServerActive=\n\nServerActive=<internal ELB A\u30ec\u30b3\u30fc\u30c9>or<internal ELB CNAME>\n\n### Option: Hostname\n#       Unique, case sensitive hostname.\n#       Required for active checks and must match hostname as configured on the server.\n#       Value is acquired from HostnameItem if undefined.\n#\n# Mandatory: no\n# Default:\n# Hostname=\n\n#Hostname=Zabbix server\n\n### Option: HostnameItem\n#       Item used for generating Hostname if it is undefined. Ignored if Hostname is defined.\n#       Does not support UserParameters or aliases.\n#\n# Mandatory: no\n# Default:\nHostnameItem=system.hostname\n\n\n\n\u30a8\u30e9\u30fc\n$ sudo service zabbix-agent start\nStarting Zabbix agent:                                     [  OK  ]\n$ sudo tail -f /var/log/zabbix/zabbix_agentd.log\n  2709:20151228:150932.183 Starting Zabbix Agent [ip-10-0-3-6]. Zabbix 2.4.7 (revision 56694).\n  2709:20151228:150932.183 using configuration file: /etc/zabbix/zabbix_agentd.conf\n  2709:20151228:150932.183 agent #0 started [main process]\n  2714:20151228:150932.183 agent #5 started [active checks #1]\n  2713:20151228:150932.183 agent #4 started [listener #3]\n  2712:20151228:150932.184 agent #3 started [listener #2]\n  2711:20151228:150932.184 agent #2 started [listener #1]\n  2710:20151228:150932.184 agent #1 started [collector]\n  2714:20151228:150932.217 no active checks on server [******.elb.amazonaws.com:10051]: host [ip-10-0-3-6] not found\n\n\n\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u3067\u306f\u30ce\u30fc\u30c9\u306e\u81ea\u52d5\u767b\u9332\u304c\u6210\u529f\u3057\u3066\u3044\u308b\u3088\u3046\u306b\u898b\u3048\u308b\u304c\u3001Zabbix-server\u3068Zabbix-agent\u3068\u306e\u901a\u4fe1\u304c\u5931\u6557\u3057\u3066\u3044\u308b\u3002\n\n\nAgent interfaces\u3067\u53d6\u5f97\u3057\u3066\u3044\u308bIP\u304c\u4e0d\u660e\n\nInternal-ELB\u306eIP\u3060\u3063\u305f\n\n$ dig internal-******.elb.amazonaws.com\n\n; <<>> DiG 9.8.2rc1-RedHat-9.8.2-0.37.rc1.42.amzn1 <<>> internal-******.elb.amazonaws.com\n;; global options: +cmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 38512\n;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 0\n\n;; QUESTION SECTION:\n;internal-******.elb.amazonaws.com. IN A\n\n;; ANSWER SECTION:\ninternal-******.elb.amazonaws.com. 60 IN A 10.0.2.62\ninternal-******.elb.amazonaws.com. 60 IN A 10.0.2.58\n\n;; Query time: 5 msec\n;; SERVER: 10.0.0.2#53(10.0.0.2)\n;; WHEN: Mon Dec 28 15:13:25 2015\n;; MSG SIZE  rcvd: 116\n\n\n\u5bfe\u7b56\u3068\u3057\u3066\u306f\u3001zabbix-agent.conf\u306eListenIP\u306b\u81ea\u8eab\u306eIP\u3092\u8a18\u8ff0\u3059\u308b\u3053\u3068\u3067\u3001Agent interfaces\u3067\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n### Option: ListenIP\n#       List of comma delimited IP addresses that the agent should listen on.\n#       First IP address is sent to Zabbix server if connecting to it to retrieve list of active checks.\n#\n# Mandatory: no\n# Default:\nListenIP=10.0.3.6\n\n# \u76ee\u7684\n* AZ\u3092\u8de8\u3044\u3060\u5197\u9577\u69cb\u6210\uff08Active-Standby\uff09\n* \u6d6e\u52d5ip\u3067\u306e\u904b\u7528\u3067\u306a\u304f\u3001ELB\u306e\u30d8\u30eb\u30b9\u30c1\u30a7\u30c3\u30af\u306b\u4f9d\u5b58\u3055\u305b\u308b\n    * \u6700\u8fd1Update\u3055\u308c\u305f\u6a5f\u80fd\u306b\u3088\u308a\u3001\u904b\u7528\u304c\u53ef\u80fd\n        * [Register or De-Register EC2 Instances for Your Load Balancer](http://docs.aws.amazon.com/ElasticLoadBalancing/latest/DeveloperGuide/elb-deregister-register-instances.html)\n* \u30aa\u30fc\u30c8\u30c7\u30a3\u30b9\u30ab\u30d0\u30ea\u306f\u7121\u52b9\u306b\u3057\u3001Zabbix-agent\uff08\u30a2\u30af\u30c6\u30a3\u30d6\uff09\u306bInternal-ELB\u3092\u8a18\u8ff0\u3057\u3001\u30ce\u30fc\u30c9\u306e\u81ea\u52d5\u767b\u9332\u3092\u884c\u3046\n\n\n# \u30a4\u30e1\u30fc\u30b8\n![cloudcraft - Zabbix_H-A 1.png](https://qiita-image-store.s3.amazonaws.com/0/58788/a906266d-2ec6-ab76-a859-2d45f19d4526.png)\n\n# \u74b0\u5883\n* t2-micro(\u904b\u7528\u3057\u3066\u3044\u304f\u306b\u306fC4\u4ee5\u4e0a\u304c\u597d\u307e\u3057\u3044)\n* Active/Standby\u69cb\u6210\uff08Standby\u306f\u30b5\u30fc\u30d0\u306f\u8d77\u52d5\u3057\u3066\u3044\u308b\u304c\u3001F/O\u306e\u30c8\u30ea\u30ac\u30fc\u3068\u306a\u308b\u30d7\u30ed\u30bb\u30b9\u3092\u505c\u6b62\u3055\u305b\u3066\u3044\u308b\uff09\n* F/O\u306e\u30c8\u30ea\u30ac\u30fc\u306fzabbix-server\u306e\u505c\u6b62\n* \u30af\u30e9\u30b9\u30bf\u5236\u5fa1\u306b\u306fCorosync\u3001\u30ea\u30bd\u30fc\u30b9\u5236\u5fa1\u306fPacemaker\u3092\u4f7f\u7528\n    * [Rundeck -\u69cb\u7bc9\uff08H/A\uff09-](http://qiita.com/digitalpeak/items/836c79c00fc8289f372e)\n\n# \u69cb\u7bc9\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```bash\n$ sudo rpm -ivh http://repo.zabbix.com/zabbix/2.4/rhel/6/x86_64/zabbix-release-2.4-1.el6.noarch.rpm\n$ sudo yum install zabbix-server-mysql zabbix-web-mysql zabbix-web-japanese zabbix-agent\n```\n## \u8a2d\u5b9a\n### MySQL\n\u6587\u5b57\u5316\u3051\u3057\u306a\u3044\u3088\u3046\u306b\u4e8b\u524d\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u308a\u3001character_set_client\u3068character_set_server\u306e\u5024\u3092utf-8\u306b\u3057\u3066\u304a\u304f\u3002\n![Screenshot from 2016-01-27 13:25:04.png](https://qiita-image-store.s3.amazonaws.com/0/58788/790f9ff5-dbf1-36ae-4a06-baac0bddc2b3.png)\n\n```bash\n$ mysql -h <rds-endpoint> -u <user> -p\nmysql> grant all privileges on <dbname>.* to <user>@localhost identified by '<password>';\n\n#\u521d\u671f\u30b9\u30ad\u30fc\u30de\u3068\u30c7\u30fc\u30bf\u3092\u30a4\u30f3\u30dd\u30fc\u30c8\n$ cd /usr/share/doc/zabbix-server-mysql-2.4.7/create\n$ mysql -h <rds-endpoint> <db> -u <user> -p < schema.sql\n$ mysql -h <rds-endpoint> <db> -u <user> -p < images.sql\n$ mysql -h <rds-endpoint> <db> -u <user> -p < data.sql\n```\n\n### zabbix-server\n```bash:zabbix_server.conf\n### Option: ListenPort\n#       Listen port for trapper.\n#\n# Mandatory: no\n# Range: 1024-32767\n# Default\n# ListenPort=10051\n\n### Option: DBHost\n#       Database host name.\n#       If set to localhost, socket is used for MySQL.\n#       If set to empty string, socket is used for PostgreSQL.\n#\n# Mandatory: no\n# Default:\n# DBHost=localhost\nDBHost=<rds-endpoint>\n### Option: DBName\n#       Database name.\n#       For SQLite3 path to database file must be provided. DBUser and DBPassword are ignored.\n#\n# Mandatory: yes\n# Default:\n# DBName=\n\nDBName=<DBName>\n\n### Option: DBSchema\n#       Schema name. Used for IBM DB2 and PostgreSQL.\n#\n# Mandatory: no\n# Default:\n# DBSchema=\n\n### Option: DBUser\n#       Database user. Ignored for SQLite.\n#\n# Mandatory: no\n# Default:\n# DBUser=\n\nDBUser=<user>\n\n### Option: DBPassword\n#       Database password. Ignored for SQLite.\n#       Comment this line if no password is used.\n#\n# Mandatory: no\n# Default:\n# DBPassword=\nDBPassword=********\n### Option: DBSocket\n#       Path to MySQL socket.\n#\n# Mandatory: no\n# Default:\n# DBSocket=/tmp/mysql.sock\n\nDBSocket=/var/lib/mysql/mysql.sock\n```\n```bash:zabbix_agent.conf\n### Option: Server\n#       List of comma delimited IP addresses (or hostnames) of Zabbix servers.\n#       Incoming connections will be accepted only from the hosts listed here.\n#       If IPv6 support is enabled then '127.0.0.1', '::127.0.0.1', '::ffff:127.0.0.1' are treated equally.\n#\n# Mandatory: no\n# Default:\n# Server=\n\nServer=10.0.1.23,10.0.3.60\n\n### Option: ListenPort\n#       Agent will listen on this port for connections from the server.\n#\n# Mandatory: no\n# Range: 1024-32767\n# Default:\nListenPort=10050\n\n### Option: ServerActive\n#       List of comma delimited IP:port (or hostname:port) pairs of Zabbix servers for active checks.\n#       If port is not specified, default port is used.\n#       IPv6 addresses must be enclosed in square brackets if port for that host is specified.\n#       If port is not specified, square brackets for IPv6 addresses are optional.\n#       If this parameter is not specified, active checks are disabled.\n#       Example: ServerActive=127.0.0.1:20051,zabbix.domain,[::1]:30051,::1,[12fc::1]\n#\n# Mandatory: no\n# Default:\n# ServerActive=\n\nServerActive=<internal ELB A\u30ec\u30b3\u30fc\u30c9>or<internal ELB CNAME>\n\n### Option: Hostname\n#       Unique, case sensitive hostname.\n#       Required for active checks and must match hostname as configured on the server.\n#       Value is acquired from HostnameItem if undefined.\n#\n# Mandatory: no\n# Default:\n# Hostname=\n\n#Hostname=Zabbix server\n\n### Option: HostnameItem\n#       Item used for generating Hostname if it is undefined. Ignored if Hostname is defined.\n#       Does not support UserParameters or aliases.\n#\n# Mandatory: no\n# Default:\nHostnameItem=system.hostname\n```\n\n### Apache/PHP\n```bash:httpd.conf\n$ sudo vim /etc/httpd/conf/httpd.conf\n# DocumentRoot: The directory out of which you will serve your\n# documents. By default, all requests are taken from this directory, but\n# symbolic links and aliases may be used to point to other locations.\n#\nDocumentRoot \"/var/www/zabbix\"\n```\n```bash\n$ cd /var/www\n$ sudo ln -s /usr/share/zabbix zabbix\n\n$ sudo vim /etc/php.ini\npost_max_size = 16M\nmax_execution_time = 300\nmax_input_time = 300\ndate.timezone = Asia/Tokyo\nalways_populate_raw_post_data = -1\n```\n\n### \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\n\n```bash\n$ sudo service httpd start&&sudo chkconfig httpd on\n$ sudo service zabbix-server start&&sudo chkconfig zabbix-server on\n$ sudo service zabbix-agent start&&sudo chkconfig zabbix-agent on\n```\n![Screenshot from 2015-12-28 17:27:16.png](https://qiita-image-store.s3.amazonaws.com/0/58788/3df788f7-7af0-0a16-34a2-2d454d042846.png)\n![Screenshot from 2015-12-28 17:27:53.png](https://qiita-image-store.s3.amazonaws.com/0/58788/96dd276a-eca1-4009-61b8-7b6bfd6ec479.png)\n![Screenshot from 2015-12-28 17:29:44.png](https://qiita-image-store.s3.amazonaws.com/0/58788/873f62eb-0bfa-8ecd-b4a8-e4408f479b44.png)\n![Screenshot from 2015-12-28 17:30:40.png](https://qiita-image-store.s3.amazonaws.com/0/58788/c31f4eb3-6e0d-8264-474a-af7728f100b0.png)\n![Screenshot from 2015-12-28 17:31:13.png](https://qiita-image-store.s3.amazonaws.com/0/58788/411a7d8c-51e1-433c-c891-1871276a2178.png)\n\n#### \u81ea\u52d5\u767b\u9332\u30a2\u30af\u30b7\u30e7\u30f3\n* Action\u306b\u306e\u307f\u8868\u793a\u3055\u305b\u308b\u30db\u30b9\u30c8\u60c5\u5831\u3092\u8a18\u8ff0\n    * Conditions\u8a18\u8ff0\u4e0d\u8981\u3002Operations\u306f\u300c\u30db\u30b9\u30c8\u8ffd\u52a0\u300d\u300c\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3068\u30ea\u30f3\u30af\u300d\n\n![Screenshot from 2015-12-28 23:48:34.png](https://qiita-image-store.s3.amazonaws.com/0/58788/b8800320-aeaf-56ca-9884-d5b778eee3fb.png)\n![Screenshot from 2015-12-29 13:30:06.png](https://qiita-image-store.s3.amazonaws.com/0/58788/14320531-ce6b-00aa-1342-272f9f10ca0d.png)\n![Screenshot from 2015-12-29 13:30:49.png](https://qiita-image-store.s3.amazonaws.com/0/58788/6cda057d-8d24-4a95-6627-2ad2e7fbdbf4.png)\n![Screenshot from 2015-12-29 13:29:09.png](https://qiita-image-store.s3.amazonaws.com/0/58788/750a74c9-391d-79cb-282a-64752e903791.png)\n\n\n### zabbix-agent\n* \u76e3\u8996\u5bfe\u8c61\u30ce\u30fc\u30c9\u306b\u8a2d\u5b9a\n\n#### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```bash\n$ sudo rpm -ivh http://repo.zabbix.com/zabbix/2.4/rhel/6/x86_64/zabbix-release-2.4-1.el6.noarch.rpm\n$ sudo yum -y install zabbix-agent\n```\n\n```bash:zabbix_agent.conf\n### Option: SourceIP\n#\tSource IP address for outgoing connections.\n#\n# Mandatory: no\n# Default:\n# SourceIP=\nSourceIP=10.0.3.6\n\n### Option: Server\n#       List of comma delimited IP addresses (or hostnames) of Zabbix servers.\n#       Incoming connections will be accepted only from the hosts listed here.\n#       If IPv6 support is enabled then '127.0.0.1', '::127.0.0.1', '::ffff:127.0.0.1' are treated equally.\n#\n# Mandatory: no\n# Default:\n# Server=\n\nServer=10.0.1.23,10.0.3.60\n\n### Option: ListenPort\n#       Agent will listen on this port for connections from the server.\n#\n# Mandatory: no\n# Range: 1024-32767\n# Default:\nListenPort=10050\n\n### Option: ServerActive\n#       List of comma delimited IP:port (or hostname:port) pairs of Zabbix servers for active checks.\n#       If port is not specified, default port is used.\n#       IPv6 addresses must be enclosed in square brackets if port for that host is specified.\n#       If port is not specified, square brackets for IPv6 addresses are optional.\n#       If this parameter is not specified, active checks are disabled.\n#       Example: ServerActive=127.0.0.1:20051,zabbix.domain,[::1]:30051,::1,[12fc::1]\n#\n# Mandatory: no\n# Default:\n# ServerActive=\n\nServerActive=<internal ELB A\u30ec\u30b3\u30fc\u30c9>or<internal ELB CNAME>\n\n### Option: Hostname\n#       Unique, case sensitive hostname.\n#       Required for active checks and must match hostname as configured on the server.\n#       Value is acquired from HostnameItem if undefined.\n#\n# Mandatory: no\n# Default:\n# Hostname=\n\n#Hostname=Zabbix server\n\n### Option: HostnameItem\n#       Item used for generating Hostname if it is undefined. Ignored if Hostname is defined.\n#       Does not support UserParameters or aliases.\n#\n# Mandatory: no\n# Default:\nHostnameItem=system.hostname\n```\n##### \u30a8\u30e9\u30fc\n\n```bash\n$ sudo service zabbix-agent start\nStarting Zabbix agent:                                     [  OK  ]\n$ sudo tail -f /var/log/zabbix/zabbix_agentd.log\n  2709:20151228:150932.183 Starting Zabbix Agent [ip-10-0-3-6]. Zabbix 2.4.7 (revision 56694).\n  2709:20151228:150932.183 using configuration file: /etc/zabbix/zabbix_agentd.conf\n  2709:20151228:150932.183 agent #0 started [main process]\n  2714:20151228:150932.183 agent #5 started [active checks #1]\n  2713:20151228:150932.183 agent #4 started [listener #3]\n  2712:20151228:150932.184 agent #3 started [listener #2]\n  2711:20151228:150932.184 agent #2 started [listener #1]\n  2710:20151228:150932.184 agent #1 started [collector]\n  2714:20151228:150932.217 no active checks on server [******.elb.amazonaws.com:10051]: host [ip-10-0-3-6] not found\n```\n\n* \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u3067\u306f\u30ce\u30fc\u30c9\u306e\u81ea\u52d5\u767b\u9332\u304c\u6210\u529f\u3057\u3066\u3044\u308b\u3088\u3046\u306b\u898b\u3048\u308b\u304c\u3001Zabbix-server\u3068Zabbix-agent\u3068\u306e\u901a\u4fe1\u304c\u5931\u6557\u3057\u3066\u3044\u308b\u3002\n![Screenshot from 2015-12-29 00:13:00.png](https://qiita-image-store.s3.amazonaws.com/0/58788/bcb147e2-fb23-cab0-b464-315daf7c788f.png)\n* Agent interfaces\u3067\u53d6\u5f97\u3057\u3066\u3044\u308bIP\u304c\u4e0d\u660e\n![Screenshot from 2015-12-28 22:55:10.png](https://qiita-image-store.s3.amazonaws.com/0/58788/b61a2c2f-f3b4-20e9-e0d0-2c8aaee7ebf6.png)\n\n* Internal-ELB\u306eIP\u3060\u3063\u305f\n\n```bash\n$ dig internal-******.elb.amazonaws.com\n\n; <<>> DiG 9.8.2rc1-RedHat-9.8.2-0.37.rc1.42.amzn1 <<>> internal-******.elb.amazonaws.com\n;; global options: +cmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 38512\n;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 0\n\n;; QUESTION SECTION:\n;internal-******.elb.amazonaws.com. IN A\n\n;; ANSWER SECTION:\ninternal-******.elb.amazonaws.com. 60 IN A 10.0.2.62\ninternal-******.elb.amazonaws.com. 60 IN A 10.0.2.58\n\n;; Query time: 5 msec\n;; SERVER: 10.0.0.2#53(10.0.0.2)\n;; WHEN: Mon Dec 28 15:13:25 2015\n;; MSG SIZE  rcvd: 116\n```\n* \u5bfe\u7b56\u3068\u3057\u3066\u306f\u3001zabbix-agent.conf\u306eListenIP\u306b\u81ea\u8eab\u306eIP\u3092\u8a18\u8ff0\u3059\u308b\u3053\u3068\u3067\u3001Agent interfaces\u3067\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n```bash\n### Option: ListenIP\n#       List of comma delimited IP addresses that the agent should listen on.\n#       First IP address is sent to Zabbix server if connecting to it to retrieve list of active checks.\n#\n# Mandatory: no\n# Default:\nListenIP=10.0.3.6\n```\n", "tags": ["zabbix", "corosync", "pacemaker"]}