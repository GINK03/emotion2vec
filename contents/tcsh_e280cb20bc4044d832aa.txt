{"context": "\u30c0\u30df\u30fc\u30c7\u30d0\u30a4\u30b9\u3068\u3057\u3066\u52d5\u4f5c\u3059\u308bEC2\u4e0a\u3067\u4f5c\u696d\u3057\u307e\u3059\u3002\n\n\u524d\u63d0\u6761\u4ef6\n\nIoT\u3078\u306e\u6a29\u9650\nAWS IoT\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\nAWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\nAWS CLI 1.11.2\n\n\n\u30b3\u30de\u30f3\u30c9\naws --version\n\n\n\n\u7d50\u679c(\u4f8b)\n      aws-cli/1.11.14 Python/2.7.10 Darwin/15.6.0 botocore/1.4.71\n\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u53e4\u3044\u5834\u5408\u306f\u6700\u65b0\u7248\u306b\u66f4\u65b0\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u30b3\u30de\u30f3\u30c9\nsudo -H pip install -U awscli\n\n\n\n0. \u6e96\u5099\n\n0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u6c7a\u5b9a\n\u69cb\u7bc9\u3059\u308b\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u6c7a\u3081\u307e\u3059\u3002 (\u30ab\u30ec\u30f3\u30c8\u30e6\u30fc\u30b6\u304c\u5229\u7528\u3059\u308b\u30ab\u30ec\u30f3\u30c8\u30ea\u30fc\u30b8\n\u30e7\u30f3\u3082\u5207\u308a\u5909\u308f\u308a\u307e\u3059\u3002)\n\n\u30b3\u30de\u30f3\u30c9(\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u5834\u5408)\nexport AWS_DEFAULT_REGION='ap-northeast-1'\n\n\n\n0.2. \u5909\u6570\u306e\u78ba\u8a8d\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u304c\u60f3\u5b9a\u306e\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws configure list\n\n\n\n\u7d50\u679c(\u4f8b)\n            Name                    Value             Type    Location\n            ----                    -----             ----    --------\n         profile         administrator-prjz-mbp13        env    AWS_DEFAULT_PROFILE\n      access_key     ****************XXXX shared-credentials-file\n      secret_key     ****************XXXX shared-credentials-file\n          region                         ap-northeast-1  env    AWS_DEFAULT_REGION\n\n\nAssumeRole\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u306fprofile\u304c ''\u3068\u8868\u793a\u3055\u308c\u307e\u3059\u3002 \u305d\n\u308c\u4ee5\u5916\u306e\u3068\u304d\u306bprofile\u304c '' \u3068\u8868\u793a\u3055\u308c\u308b\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u3092\u5b9f\u884c\u3057\u3066\n\u304f\u3060\u3055\u3044\u3002\n\u5909\u6570\u306e\u8a2d\u5b9a:\n     export AWS_DEFAULT_PROFILE=<IAM\u30e6\u30fc\u30b6\u540d>\n\n\n1. \u4e8b\u524d\u4f5c\u696d\n\n1.1. SDK\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u30b3\u30de\u30f3\u30c9(EC2)\nsudo pip install AWSIoTPythonSDK\n\n\n\n\u7d50\u679c(\u4f8b)\n      (\u7565)\n      Successfully installed AWSIoTPythonSDK-1.1.1\n\n\n\n1.2. dummy \u30c7\u30d0\u30a4\u30b9\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4f5c\u696d\u306f\u30ed\u30af\u3099\u30a4\u30f3\u3057\u305f\u30c6\u3099\u30a3\u30ec\u30af\u30c8\u30ea /home/ec2-user \u3066\u3099\u5b9f\u884c\u3057\u3066\u4e0b\u3055\u3044\u3002 (\n\u5909\u66f4\u3059\u308b\u5834\u5408\u306fsetup.json\u3066\u3099\u306eCERT_PATH\u306e\u8a2d\u5b9a\u304b\u3099\u5fc5\u8981)\n\n\u30b3\u30de\u30f3\u30c9(EC2)\npwd\n\n\n\n\u7d50\u679c\n      /home/ec2-user\n\n\n\n\u30b3\u30de\u30f3\u30c9(EC2)\nwget http://bit.ly/2eP3uEl > dummy.zip\n\n\n\n\u7d50\u679c\n      (\u7565)\n      2016-11-17 03:24:57 (125 MB/s) - `2eP3uEl' \u3078\u4fdd\u5b58\u5b8c\u4e86 [4208/4208]\n\n\n\n\u30b3\u30de\u30f3\u30c9(EC2)\nmv 2eP3uEl dummy.zip \\\n        && unzip dummy.zip\n\n\n\n\u7d50\u679c\n      Archive:  dummy.zip\n         creating: dummy_python/\n        inflating: dummy_python/.DS_Store\n         creating: dummy_python/certs/\n        inflating: dummy_python/certs/root.pem\n        inflating: dummy_python/dummy.py\n        inflating: dummy_python/setup.json\n\n\n\n\u30b3\u30de\u30f3\u30c9(EC2)\ncd dummy_python \\\n        && ls\n\n\n\n\u7d50\u679c\n      certs  dummy.py  setup.json\n\n\n\n1.3. setup.json\u306e\u7de8\u96c6\n\n\u30b3\u30de\u30f3\u30c9(EC2)\ncp setup.json setup.json.origin\n\n\n/home/ec2-user/dummy_python/setup.json:\n  {\n    \"AWSIoT\": {\n      \"ENDPOINT\":\"YOUR_DOMAIN.amazonaws.com\",\n      \"CERT_PATH\":\"/home/ec2-user/Dummy_device/fake_device/certs/\",\n      \"KEYS\":[\"cert.pem\", \"private.pem\", \"root.pem\"]\n    },\n    \"DEVICE\":{\n      \"NAME\":\"tmp01\",\n      \"TOPIC\":\"/device/room01/tmp01\"\n    }\n  }\n\n\nYOUR_DOMAIN\u3092AWS IoT\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8URL\u306b\u66f8\u304d\u66ff\u3048\u307e\u3059\u3002\n\nCERT_PATH\u3092\u4e0b\u8a18\u306e\u901a\u308a\u66f8\u304d\u66ff\u3048\u307e\u3059\u3002\n\n(\u5909\u66f4\u524d): /home/ec2-user/Dummy_device/fake_device/certs/\n(\u5909\u66f4\u5f8c): /home/ec2-user/dummy_python/certs/\n\n\n\n'https://'\u306e\u90e8\u5206\u306f\u4e0d\u8981\u3067\u3059\u3002\n\n1.4. \u8a3c\u660e\u66f8\u306e\u8a2d\u5b9a\nIoT\u74b0\u5883\u69cb\u7bc9\u6642\u306b\u53d6\u5f97\u3057\u305f\u8a3c\u660e\u66f8\u3068\u79d8\u5bc6\u9375\u3092\n/home/ec2-user/dummy_python/certs/\u4e0b\u306b\u4e0b\u8a18\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u3067\u7f6e\u304d\u307e\u3059\u3002\n\n\u8a3c\u660e\u66f8(\u4f5c\u6210\u6642\u306e\u540d\u79f0:handson-20161117.cert): cert.pem\n\u79d8\u5bc6\u9375(\u4f5c\u6210\u6642\u306e\u540d\u79f0:handson-20161117.pem): private.pem\n\n\n\u30b3\u30de\u30f3\u30c9(Local)\nscp -i ${FILE_SSH_KEY} handson-20161117.cert ec2-user@${EC2_PUBLIC_IP}:/home/ec2-user/dummy_python/certs/cert.pem\n\n\n\n\u30b3\u30de\u30f3\u30c9(Local)\nscp -i ${FILE_SSH_KEY} handson-20161117.pem ec2-user@${EC2_PUBLIC_IP}:/home/ec2-user/dummy_python/certs/private.pem\n\n\n\n2. \u30c0\u30df\u30fc\u30c7\u30d0\u30a4\u30b9\u306e\u5b9f\u884c\n\n\u30b3\u30de\u30f3\u30c9(EC2)\ncd /home/ec2-user/dummy_python/\n\n\n\n\u30b3\u30de\u30f3\u30c9(EC2)\npython dummy.py &\n\n\n\n\u7d50\u679c(\u4f8b)\n      start readConfig func\n      Start MQTT init\n      start Init MQTT func\n      -------start connect--------\n      Success:Connect to MsgBroker\n      {\"Tmp\": 13, \"TimeStamp\": 1479360340720, \"Name\": \"tmp01\"}\n\n\nS3\u306e\u30d0\u30b1\u30c3\u30c8\u306b\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u304c\u66f8\u304d\u8fbc\u307e\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9(Local)\naws s3 ls s3://${S3_BUCKET_NAME}/\n\n\n\n\u7d50\u679c(\u4f8b)\n      2016-11-17 19:26:15         56 handson-1479360373778\n\n\n\n3. \u4e8b\u5f8c\u4f5c\u696d\n\n3.1. \u30c0\u30df\u30fc\u30c7\u30d0\u30a4\u30b9\u306e\u505c\u6b62\n\n\u30b3\u30de\u30f3\u30c9(EC2)\nkill -9 $( ps -ef | grep dumm[y] | awk '{print $2}' )\n\n\n\n\u7d50\u679c\n      [1]+  \u5f37\u5236\u7d42\u4e86            python dummy.py\n\n\n\n\u30b3\u30de\u30f3\u30c9(EC2)\nps -ef | grep dumm[y]\n\n\n\n\u7d50\u679c\n      (\u623b\u308a\u5024\u306a\u3057)\n\n\n\n3.2. \u30ed\u30b0\u30a2\u30a6\u30c8\n\n\u30b3\u30de\u30f3\u30c9(EC2)\nexit\n\n\n\n\u5b8c\u4e86\n\u30c0\u30df\u30fc\u30c7\u30d0\u30a4\u30b9\u3068\u3057\u3066\u52d5\u4f5c\u3059\u308bEC2\u4e0a\u3067\u4f5c\u696d\u3057\u307e\u3059\u3002\n\n\n\u524d\u63d0\u6761\u4ef6\n========\n\n\nIoT\u3078\u306e\u6a29\u9650\n-----------\n\nAWS IoT\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\n\nAWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n-------------------\n\n\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\n- AWS CLI 1.11.2\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws --version\n```\n\n```text:\u7d50\u679c(\u4f8b):\n      aws-cli/1.11.14 Python/2.7.10 Darwin/15.6.0 botocore/1.4.71\n```\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u53e4\u3044\u5834\u5408\u306f\u6700\u65b0\u7248\u306b\u66f4\u65b0\u3057\u307e\u3057\u3087\u3046\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nsudo -H pip install -U awscli\n```\n\n\n0. \u6e96\u5099\n=======\n\n\n0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u6c7a\u5b9a\n---------------------\n\n\u69cb\u7bc9\u3059\u308b\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u6c7a\u3081\u307e\u3059\u3002 (\u30ab\u30ec\u30f3\u30c8\u30e6\u30fc\u30b6\u304c\u5229\u7528\u3059\u308b\u30ab\u30ec\u30f3\u30c8\u30ea\u30fc\u30b8\n\u30e7\u30f3\u3082\u5207\u308a\u5909\u308f\u308a\u307e\u3059\u3002)\n\n```bash:\u30b3\u30de\u30f3\u30c9(\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u5834\u5408):\nexport AWS_DEFAULT_REGION='ap-northeast-1'\n```\n\n\n0.2. \u5909\u6570\u306e\u78ba\u8a8d\n---------------\n\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u304c\u60f3\u5b9a\u306e\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws configure list\n```\n\n```text:\u7d50\u679c(\u4f8b)\n            Name                    Value             Type    Location\n            ----                    -----             ----    --------\n         profile         administrator-prjz-mbp13        env    AWS_DEFAULT_PROFILE\n      access_key     ****************XXXX shared-credentials-file\n      secret_key     ****************XXXX shared-credentials-file\n          region                         ap-northeast-1  env    AWS_DEFAULT_REGION\n```\n\nAssumeRole\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u306fprofile\u304c '<not set>'\u3068\u8868\u793a\u3055\u308c\u307e\u3059\u3002 \u305d\n\u308c\u4ee5\u5916\u306e\u3068\u304d\u306bprofile\u304c '<not set>' \u3068\u8868\u793a\u3055\u308c\u308b\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u3092\u5b9f\u884c\u3057\u3066\n\u304f\u3060\u3055\u3044\u3002\n\n   \u5909\u6570\u306e\u8a2d\u5b9a:\n\n         export AWS_DEFAULT_PROFILE=<IAM\u30e6\u30fc\u30b6\u540d>\n\n\n1. \u4e8b\u524d\u4f5c\u696d\n===========\n\n\n1.1. SDK\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n----------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9(EC2):\nsudo pip install AWSIoTPythonSDK\n```\n\n```text:\u7d50\u679c(\u4f8b):\n      (\u7565)\n      Successfully installed AWSIoTPythonSDK-1.1.1\n```\n\n\n1.2. dummy \u30c7\u30d0\u30a4\u30b9\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n--------------------------------\n\n\u4f5c\u696d\u306f\u30ed\u30af\u3099\u30a4\u30f3\u3057\u305f\u30c6\u3099\u30a3\u30ec\u30af\u30c8\u30ea /home/ec2-user \u3066\u3099\u5b9f\u884c\u3057\u3066\u4e0b\u3055\u3044\u3002 (\n\u5909\u66f4\u3059\u308b\u5834\u5408\u306fsetup.json\u3066\u3099\u306eCERT_PATH\u306e\u8a2d\u5b9a\u304b\u3099\u5fc5\u8981)\n\n```bash:\u30b3\u30de\u30f3\u30c9(EC2):\npwd\n```\n\n```text:\u7d50\u679c:\n      /home/ec2-user\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9(EC2):\nwget http://bit.ly/2eP3uEl > dummy.zip\n```\n\n```text:\u7d50\u679c:\n      (\u7565)\n      2016-11-17 03:24:57 (125 MB/s) - `2eP3uEl' \u3078\u4fdd\u5b58\u5b8c\u4e86 [4208/4208]\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9(EC2):\nmv 2eP3uEl dummy.zip \\\n        && unzip dummy.zip\n```\n\n```text:\u7d50\u679c:\n      Archive:  dummy.zip\n         creating: dummy_python/\n        inflating: dummy_python/.DS_Store\n         creating: dummy_python/certs/\n        inflating: dummy_python/certs/root.pem\n        inflating: dummy_python/dummy.py\n        inflating: dummy_python/setup.json\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9(EC2):\ncd dummy_python \\\n        && ls\n```\n\n```text:\u7d50\u679c:\n      certs  dummy.py  setup.json\n```\n\n\n1.3. setup.json\u306e\u7de8\u96c6\n---------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9(EC2):\ncp setup.json setup.json.origin\n```\n\n/home/ec2-user/dummy_python/setup.json:\n\n      {\n        \"AWSIoT\": {\n          \"ENDPOINT\":\"YOUR_DOMAIN.amazonaws.com\",\n          \"CERT_PATH\":\"/home/ec2-user/Dummy_device/fake_device/certs/\",\n          \"KEYS\":[\"cert.pem\", \"private.pem\", \"root.pem\"]\n        },\n        \"DEVICE\":{\n          \"NAME\":\"tmp01\",\n          \"TOPIC\":\"/device/room01/tmp01\"\n        }\n      }\n\n- YOUR_DOMAIN\u3092AWS IoT\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8URL\u306b\u66f8\u304d\u66ff\u3048\u307e\u3059\u3002\n\n- CERT_PATH\u3092\u4e0b\u8a18\u306e\u901a\u308a\u66f8\u304d\u66ff\u3048\u307e\u3059\u3002\n\n  - (\u5909\u66f4\u524d): /home/ec2-user/Dummy_device/fake_device/certs/\n\n  - (\u5909\u66f4\u5f8c): /home/ec2-user/dummy_python/certs/\n\n'https://'\u306e\u90e8\u5206\u306f\u4e0d\u8981\u3067\u3059\u3002\n\n\n1.4. \u8a3c\u660e\u66f8\u306e\u8a2d\u5b9a\n-----------------\n\nIoT\u74b0\u5883\u69cb\u7bc9\u6642\u306b\u53d6\u5f97\u3057\u305f\u8a3c\u660e\u66f8\u3068\u79d8\u5bc6\u9375\u3092\n/home/ec2-user/dummy_python/certs/\u4e0b\u306b\u4e0b\u8a18\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u3067\u7f6e\u304d\u307e\u3059\u3002\n\n- \u8a3c\u660e\u66f8(\u4f5c\u6210\u6642\u306e\u540d\u79f0:handson-20161117.cert): cert.pem\n\n- \u79d8\u5bc6\u9375(\u4f5c\u6210\u6642\u306e\u540d\u79f0:handson-20161117.pem): private.pem\n\n```bash:\u30b3\u30de\u30f3\u30c9(Local):\nscp -i ${FILE_SSH_KEY} handson-20161117.cert ec2-user@${EC2_PUBLIC_IP}:/home/ec2-user/dummy_python/certs/cert.pem\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9(Local):\nscp -i ${FILE_SSH_KEY} handson-20161117.pem ec2-user@${EC2_PUBLIC_IP}:/home/ec2-user/dummy_python/certs/private.pem\n```\n\n\n2. \u30c0\u30df\u30fc\u30c7\u30d0\u30a4\u30b9\u306e\u5b9f\u884c\n=======================\n\n```bash:\u30b3\u30de\u30f3\u30c9(EC2):\ncd /home/ec2-user/dummy_python/\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9(EC2):\npython dummy.py &\n```\n\n```text:\u7d50\u679c(\u4f8b):\n      start readConfig func\n      Start MQTT init\n      start Init MQTT func\n      -------start connect--------\n      Success:Connect to MsgBroker\n      {\"Tmp\": 13, \"TimeStamp\": 1479360340720, \"Name\": \"tmp01\"}\n```\n\nS3\u306e\u30d0\u30b1\u30c3\u30c8\u306b\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u304c\u66f8\u304d\u8fbc\u307e\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9(Local):\naws s3 ls s3://${S3_BUCKET_NAME}/\n```\n\n```text:\u7d50\u679c(\u4f8b):\n      2016-11-17 19:26:15         56 handson-1479360373778\n```\n\n\n3. \u4e8b\u5f8c\u4f5c\u696d\n===========\n\n\n3.1. \u30c0\u30df\u30fc\u30c7\u30d0\u30a4\u30b9\u306e\u505c\u6b62\n-------------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9(EC2):\nkill -9 $( ps -ef | grep dumm[y] | awk '{print $2}' )\n```\n\n```text:\u7d50\u679c:\n      [1]+  \u5f37\u5236\u7d42\u4e86            python dummy.py\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9(EC2):\nps -ef | grep dumm[y]\n```\n\n```text:\u7d50\u679c:\n      (\u623b\u308a\u5024\u306a\u3057)\n```\n\n\n3.2. \u30ed\u30b0\u30a2\u30a6\u30c8\n---------------\n\n```bash:\u30b3\u30de\u30f3\u30c9(EC2):\nexit\n```\n\n\n\u5b8c\u4e86\n====\n", "tags": ["AWS", "aws-cli", "IoT"]}