{"context": "\u65e5\u5831\u3092\u66f8\u304f\u306e\u3063\u3066\u9762\u5012\u3067\u3059\u3088\u306d\u3002\n\u81ea\u5206\u306e\u5834\u5408\u306fGaroon\u306e\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3092\u30b3\u30d4\u30da\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u591a\u3044\u306e\u3067\u3001\u30ef\u30f3\u30af\u30ea\u30c3\u30af\u3067Garoon\u306e\u65e5\u4e88\u5b9a\u3092kintone\u306b\u53d6\u308a\u8fbc\u3080\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\u4eca\u56de\u306fGaroon\u306eAPI\u3068kintone\u306eAPI\u306e\u4e21\u65b9\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u3084\u3063\u305f\u3053\u3068\nGaroon\u306e\u4e88\u5b9a\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\nkintone\u306e\u767b\u9332\u3001\u7de8\u96c6\u753b\u9762\u3067\n\n\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3068\n\n4\u67085\u65e5\u306b\u5909\u66f4\u3057\u3066\u3001\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3068\u30fb\u30fb\u30fb\n\nGaroon\u3068kintone\u306e\u4e21\u65b9\u3092\u4f7f\u3063\u3066\u3044\u308b\u65b9\u306f\u662f\u975e\u4f7f\u3063\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3092\u8a66\u3057\u3066\u307f\u308b\u5834\u5408\u306f\u958b\u767a\u8005\u30e9\u30a4\u30bb\u30f3\u30b9\u304c\u304a\u52e7\u3081\u3067\u3059\uff01\n\n\u524d\u63d0\n\nGaroon\u306f\u30af\u30e9\u30a6\u30c9\u7248\n\n\n\n\n\u30d5\u30a3\u30fc\u30eb\u30c9\u540d\n\u30d5\u30a3\u30fc\u30eb\u30c9\u30bf\u30a4\u30d7\n\u30d5\u30a3\u30fc\u30eb\u30c9\u30b3\u30fc\u30c9\n\u5099\u8003\n\n\n\n\n\n\u30b9\u30da\u30fc\u30b9\nbutton\n\u30dc\u30bf\u30f3\u3092\u8868\u793a\u3059\u308b\u305f\u3081\u306e\u30b9\u30da\u30fc\u30b9\n\n\n\u65e5\u4ed8\n\u65e5\u4ed8\ndate\n\n\n\n\u65e5\u5831\n\u6587\u5b57\u5217\uff08\u8907\u6570\u884c\uff09\ndaily_report\n\n\n\n\n\nJS/CSS\u8a2d\u5b9a\u306f\u4ee5\u4e0b\n\n\nhttps://js.cybozu.com/jquery/2.2.1/jquery.min.js\nhttps://js.cybozu.com/momentjs/2.12.0/moment.min.js\n\u2193\u306eJS\u30d5\u30a1\u30a4\u30eb\u3001CSS\u30d5\u30a1\u30a4\u30eb\n\n\n\n\ndaily_report.js\n(function() {\n    'use strict';\n\n    kintone.events.on(['app.record.create.show', 'app.record.edit.show'], function(event) {\n        var space = kintone.app.record.getSpaceElement('button');\n        $(space).append('<button type=\"button\" id=\"my-button\">Garoon\u306e\u4e88\u5b9a\u3092\u53d6\u5f97\u3059\u308b</button>');\n\n        $('#my-button').on('click', function() {\n            var record = kintone.app.record.get();\n            var date = record.record.date.value;\n\n            getSchedule(date).done(function(xml) {\n                var scheduleList = [];\n                $(xml).find('schedule_event').each(function() {\n                    scheduleList.push($(this));\n                });\n\n                var daliyReport = '';\n                $(scheduleList).each(function() {\n                    var title = $(this).attr('detail');\n                    var allday = $(this).attr('allday');\n                    var eventType = $(this).attr('event_type');\n\n                    var prefix = '', diff = '';\n                    var startDateTime = '', endDateTime = '';\n                    if (allday === 'false') {\n                        if (eventType === 'normal') {\n                            startDateTime = $(this).find('datetime').attr('start');\n                            endDateTime = $(this).find('datetime').attr('end');\n\n                            diff = moment(endDateTime).diff(moment(startDateTime), 'hours', true);\n                            prefix = diff + '\u6642\u9593: ';\n                        } else if (eventType === 'repeat') {\n                            var startDate = $(this).find('condition').attr('start_date');\n                            var startTime = $(this).find('condition').attr('start_time');\n                            var endTime = $(this).find('condition').attr('end_time');\n\n                            startDateTime = startDate + ' ' + startTime;\n                            // end_date\u306f\u7e70\u308a\u8fd4\u3057\u4e88\u5b9a\u306e\u7d42\u4e86\u65e5\u306a\u306e\u3067start_date\u3092\u5229\u7528\n                            endDateTime = startDate + ' ' + endTime;\n\n                            diff = moment(endDateTime).diff(moment(startDateTime), 'hours', true);\n                            // 24\u6642\u524d\u958b\u59cb\u300124\u6642\u904e\u304e\u7d42\u4e86\u306e\u5834\u5408\n                            if (diff < 0) {\n                                diff += 24;\n                            }\n                            prefix = diff + '\u6642\u9593: ';\n                        } else if (eventType === 'banner') {\n                            prefix = '\u671f\u9593\u4e88\u5b9a: ';\n                        }\n                    } else {\n                        prefix = '\u7d42\u65e5\u4e88\u5b9a: ';\n                    }\n\n                    daliyReport += prefix + title + '\\r\\n';\n                });\n\n                setDailyReport(record, daliyReport);\n            });\n        });\n    });\n\n    function setDailyReport(record, daliyReport) {\n        record.record.daily_report.value = daliyReport;\n        kintone.app.record.set(record);\n    }\n\n    function getSchedule(date) {\n        var m = moment(date).utc();\n        var start_datetime = m.format('YYYY-MM-DDTHH:mm:ssZ');\n        var end_datetime = m.add(1, 'days').add(-1, 'seconds').format('YYYY-MM-DDTHH:mm:ssZ');\n\n        var data = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>';\n        data += '<soap:Envelope xmlns:soap=\"http://www.w3.org/2003/05/soap-envelope\">';\n        data += '  <soap:Header>';\n        data += '    <Action>';\n        data += '      ScheduleGetEvents';\n        data += '    </Action>';\n        data += '    <Security>';\n        data += '      <UsernameToken>';\n        data += '        <Username></Username>';\n        data += '        <Password></Password>';\n        data += '      </UsernameToken>';\n        data += '    </Security>';\n        data += '    <Timestamp>';\n        data += '      <Created>2010-08-12T14:45:00Z</Created>';\n        data += '      <Expires>2037-08-12T14:45:00Z</Expires>';\n        data += '    </Timestamp>';\n        data += '    <Locale>jp</Locale>';\n        data += '  </soap:Header>';\n        data += '  <soap:Body>';\n        data += '    <ScheduleGetEvents>';\n        data += '      <parameters start=\\\"' + start_datetime + '\\\" end=\\\"' + end_datetime + '\\\"> </parameters>';\n        data += '    </ScheduleGetEvents>';\n        data += '  </soap:Body>';\n        data += '</soap:Envelope>';\n\n        return $.ajax({\n            method: 'POST',\n            url: '/g/cbpapi/schedule/api?',\n            data: data,\n            dataType: 'xml',\n            contentType: 'text/xml'\n        });\n    }\n\n})();\n\n\n\u65e5\u5831\u3092\u66f8\u304f\u306e\u3063\u3066\u9762\u5012\u3067\u3059\u3088\u306d\u3002\n\u81ea\u5206\u306e\u5834\u5408\u306f[Garoon](https://garoon.cybozu.co.jp/)\u306e\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3092\u30b3\u30d4\u30da\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u591a\u3044\u306e\u3067\u3001\u30ef\u30f3\u30af\u30ea\u30c3\u30af\u3067Garoon\u306e\u65e5\u4e88\u5b9a\u3092[kintone](https://kintone.cybozu.com/jp/)\u306b\u53d6\u308a\u8fbc\u3080\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\n\u4eca\u56de\u306f[Garoon\u306eAPI](https://cybozudev.zendesk.com/hc/ja/categories/200157760)\u3068[kintone\u306eAPI](https://cybozudev.zendesk.com/hc/ja/categories/200147600)\u306e\u4e21\u65b9\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\n# \u3084\u3063\u305f\u3053\u3068\nGaroon\u306e\u4e88\u5b9a\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n![Gr1.jpg](https://qiita-image-store.s3.amazonaws.com/0/102790/f22796f6-a2d1-9f44-747f-2bbb1b41cd9b.jpeg)\n\nkintone\u306e\u767b\u9332\u3001\u7de8\u96c6\u753b\u9762\u3067\n![kin1.jpg](https://qiita-image-store.s3.amazonaws.com/0/102790/02821ca1-d807-249a-8697-35cb1e679648.jpeg)\n\n\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3068\n![kin2.jpg](https://qiita-image-store.s3.amazonaws.com/0/102790/7483078e-c089-31ad-5a2c-9cd5f97bd8b2.jpeg)\n\n4\u67085\u65e5\u306b\u5909\u66f4\u3057\u3066\u3001\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3068\u30fb\u30fb\u30fb\n![kin3.jpg](https://qiita-image-store.s3.amazonaws.com/0/102790/2d14acd5-b79c-32f3-57d1-80041b98b267.jpeg)\n\nGaroon\u3068kintone\u306e\u4e21\u65b9\u3092\u4f7f\u3063\u3066\u3044\u308b\u65b9\u306f\u662f\u975e\u4f7f\u3063\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3092\u8a66\u3057\u3066\u307f\u308b\u5834\u5408\u306f[\u958b\u767a\u8005\u30e9\u30a4\u30bb\u30f3\u30b9](https://cybozudev.zendesk.com/hc/ja/articles/200929540#step2)\u304c\u304a\u52e7\u3081\u3067\u3059\uff01\n\n# \u524d\u63d0\n- Garoon\u306f\u30af\u30e9\u30a6\u30c9\u7248\n\n| \u30d5\u30a3\u30fc\u30eb\u30c9\u540d | \u30d5\u30a3\u30fc\u30eb\u30c9\u30bf\u30a4\u30d7 | \u30d5\u30a3\u30fc\u30eb\u30c9\u30b3\u30fc\u30c9 | \u5099\u8003 |\n|----------|----------------|------------------|------------------|\n|  | \u30b9\u30da\u30fc\u30b9 | button | \u30dc\u30bf\u30f3\u3092\u8868\u793a\u3059\u308b\u305f\u3081\u306e\u30b9\u30da\u30fc\u30b9 |\n| \u65e5\u4ed8 | \u65e5\u4ed8 | date |  |\n| \u65e5\u5831 | \u6587\u5b57\u5217\uff08\u8907\u6570\u884c\uff09 | daily_report |  |\n\n- JS/CSS\u8a2d\u5b9a\u306f\u4ee5\u4e0b\n - https://js.cybozu.com/jquery/2.2.1/jquery.min.js\n - https://js.cybozu.com/momentjs/2.12.0/moment.min.js\n - \u2193\u306eJS\u30d5\u30a1\u30a4\u30eb\u3001CSS\u30d5\u30a1\u30a4\u30eb\n\n```js:daily_report.js\n(function() {\n    'use strict';\n\n    kintone.events.on(['app.record.create.show', 'app.record.edit.show'], function(event) {\n        var space = kintone.app.record.getSpaceElement('button');\n        $(space).append('<button type=\"button\" id=\"my-button\">Garoon\u306e\u4e88\u5b9a\u3092\u53d6\u5f97\u3059\u308b</button>');\n\n        $('#my-button').on('click', function() {\n            var record = kintone.app.record.get();\n            var date = record.record.date.value;\n\n            getSchedule(date).done(function(xml) {\n                var scheduleList = [];\n                $(xml).find('schedule_event').each(function() {\n                    scheduleList.push($(this));\n                });\n\n                var daliyReport = '';\n                $(scheduleList).each(function() {\n                    var title = $(this).attr('detail');\n                    var allday = $(this).attr('allday');\n                    var eventType = $(this).attr('event_type');\n\n                    var prefix = '', diff = '';\n                    var startDateTime = '', endDateTime = '';\n                    if (allday === 'false') {\n                        if (eventType === 'normal') {\n                            startDateTime = $(this).find('datetime').attr('start');\n                            endDateTime = $(this).find('datetime').attr('end');\n\n                            diff = moment(endDateTime).diff(moment(startDateTime), 'hours', true);\n                            prefix = diff + '\u6642\u9593: ';\n                        } else if (eventType === 'repeat') {\n                            var startDate = $(this).find('condition').attr('start_date');\n                            var startTime = $(this).find('condition').attr('start_time');\n                            var endTime = $(this).find('condition').attr('end_time');\n\n                            startDateTime = startDate + ' ' + startTime;\n                            // end_date\u306f\u7e70\u308a\u8fd4\u3057\u4e88\u5b9a\u306e\u7d42\u4e86\u65e5\u306a\u306e\u3067start_date\u3092\u5229\u7528\n                            endDateTime = startDate + ' ' + endTime;\n\n                            diff = moment(endDateTime).diff(moment(startDateTime), 'hours', true);\n                            // 24\u6642\u524d\u958b\u59cb\u300124\u6642\u904e\u304e\u7d42\u4e86\u306e\u5834\u5408\n                            if (diff < 0) {\n                                diff += 24;\n                            }\n                            prefix = diff + '\u6642\u9593: ';\n                        } else if (eventType === 'banner') {\n                            prefix = '\u671f\u9593\u4e88\u5b9a: ';\n                        }\n                    } else {\n                        prefix = '\u7d42\u65e5\u4e88\u5b9a: ';\n                    }\n\n                    daliyReport += prefix + title + '\\r\\n';\n                });\n\n                setDailyReport(record, daliyReport);\n            });\n        });\n    });\n\n    function setDailyReport(record, daliyReport) {\n        record.record.daily_report.value = daliyReport;\n        kintone.app.record.set(record);\n    }\n\n    function getSchedule(date) {\n        var m = moment(date).utc();\n        var start_datetime = m.format('YYYY-MM-DDTHH:mm:ssZ');\n        var end_datetime = m.add(1, 'days').add(-1, 'seconds').format('YYYY-MM-DDTHH:mm:ssZ');\n\n        var data = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>';\n        data += '<soap:Envelope xmlns:soap=\"http://www.w3.org/2003/05/soap-envelope\">';\n        data += '  <soap:Header>';\n        data += '    <Action>';\n        data += '      ScheduleGetEvents';\n        data += '    </Action>';\n        data += '    <Security>';\n        data += '      <UsernameToken>';\n        data += '        <Username></Username>';\n        data += '        <Password></Password>';\n        data += '      </UsernameToken>';\n        data += '    </Security>';\n        data += '    <Timestamp>';\n        data += '      <Created>2010-08-12T14:45:00Z</Created>';\n        data += '      <Expires>2037-08-12T14:45:00Z</Expires>';\n        data += '    </Timestamp>';\n        data += '    <Locale>jp</Locale>';\n        data += '  </soap:Header>';\n        data += '  <soap:Body>';\n        data += '    <ScheduleGetEvents>';\n        data += '      <parameters start=\\\"' + start_datetime + '\\\" end=\\\"' + end_datetime + '\\\"> </parameters>';\n        data += '    </ScheduleGetEvents>';\n        data += '  </soap:Body>';\n        data += '</soap:Envelope>';\n\n        return $.ajax({\n            method: 'POST',\n            url: '/g/cbpapi/schedule/api?',\n            data: data,\n            dataType: 'xml',\n            contentType: 'text/xml'\n        });\n    }\n\n})();\n```\n", "tags": ["kintone", "JavaScript", "garoon"]}