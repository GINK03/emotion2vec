{"context": "\n\n\u57f7\u7b46\u6642\u70b9\u306e\u74b0\u5883\n\nWindows 10 \u3092\u4f7f\u7528\nVisualStudio Community 2015 (\u7565\u79f0 VS) \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\nMicrosoft SQL Server Data Tools \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f (VS\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u306b\u4ed8\u968f)\n.NET Core 1.0.0\nEntityFrameworkCore 1.0\n\n\nCodeFirst\u3068\u306f\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u5148\u306b\u66f8\u304d\u3001\u305d\u308c\u3092\u5143\u306bEntityFramework\u306bDB\u30fb\u30c6\u30fc\u30d6\u30eb\u3092\u751f\u6210\u3055\u305b\u308b\u3088\u3046\u306a\u30b9\u30bf\u30a4\u30eb\u3002\u30eb\u30fc\u30eb\u306b\u5247\u3063\u3066\u30b3\u30fc\u30c9\u8a18\u8ff0\u3092\u884c\u3046\u3053\u3068\u3067DB\u3084\u30c6\u30fc\u30d6\u30eb\u306e\u751f\u6210\u306f\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u5074\u304c\u884c\u3063\u3066\u304f\u308c\u308b\u3002\n\u57fa\u672c\u30eb\u30fc\u30eb\n\n\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u30af\u30e9\u30b9:\n\u6271\u3046\u30c7\u30fc\u30bf\u3092\u8868\u73fe\u3059\u308b\u30af\u30e9\u30b9\u3002DB\u306e\u30ec\u30b3\u30fc\u30c9\u3068\u5bfe\u5fdc\u3059\u308b\u3002\u4f55\u3082\u7d99\u627f\u3059\u308b\u5fc5\u8981\u306f\u7121\u304f\u3001\u30ab\u30e9\u30e0\u3068\u5bfe\u5fdc\u3059\u308b\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u6301\u3064\u3002\n\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u30af\u30e9\u30b9:\nDbContext\u3092\u7d99\u627f\u3055\u305b\u308b\u3002\u7ba1\u7406\u3059\u308b\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u30af\u30e9\u30b9\u3092DbSet<T>\u578b\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3068\u3057\u3066\u4fdd\u6301\u3055\u305b\u308b\u3002\u30ec\u30b3\u30fc\u30c9\u53d6\u5f97\u3084\u30ec\u30b3\u30fc\u30c9\u4fdd\u5b58\u306f\u3053\u306e\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u901a\u3057\u3066\u884c\u3046\u3002\n\n\n\u4f7f\u3063\u3066\u307f\u308b\n\nVisualStudio \u3067\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u300c.NET Core\u300d-\u300cConsole Application (.NET Core)\u300d\u3067\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\n(\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d\u306fHelloCore\u3068\u3059\u308b)\n\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u65e5\u672c\u8a9e\u3092\u51fa\u529b\u3059\u308b\u3068\u6587\u5b57\u5316\u3051\u3059\u308b\u3002\n.NET Core\u306f\u6a19\u6e96\u3067\u306fUnicode, ASCII, CodePage 28591 \u4ee5\u5916\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u4e00\u65b9\u3001Windows\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u306fShift-JIS\u3067\u3042\u308b\u4e8b\u304c\u539f\u56e0\u3002NuGet\u7d4c\u7531\u3067Shift-JIS\u3078\u5bfe\u5fdc\u3055\u305b\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5c0e\u5165\u3059\u308c\u3070\u65e5\u672c\u8a9e\u8868\u793a\u53ef\u80fd\u3002\u4ee5\u4e0b\u306e\u4f5c\u696d\u3067\u5bfe\u5fdc\u3055\u305b\u308b\u3002\nNuGet\u304b\u3089\u30d1\u30c3\u30b1\u30fc\u30b8\u300cSystem.Text.Encoding.CodePages\u300d\u3092\u30a4\u30f3\u30b9\u30fc\u30eb\nMain\u30e1\u30bd\u30c3\u30c9\u5148\u982d\u306b\u4ee5\u4e0b\u306e\u8a18\u8ff0\u3092\u8ffd\u52a0  \n\nProgram.cs\n\n        public static void Main(string[] args)\n        {\n+           //\u767b\u9332\u3059\u308c\u3070\u5fc5\u8981\u306a\u5834\u9762(Win\u4e0a\u3067\u5b9f\u884c\u3057\u305f\u6642)\u3067\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002\n+           System.Text.Encoding.RegisterProvider(System.Text.CodePagesEncodingProvider.Instance);\n\n\n\nEntityFrameworkCore\u3092\u4f7f\u3046\nSQL Server\u3068\u7d44\u5408\u305b\u3001\u6307\u5b9a\u3057\u305f\u30d5\u30a3\u30fc\u30c9\u304b\u3089\u8a18\u4e8b\u30bf\u30a4\u30c8\u30eb\u3068\u629c\u7c8b\u3092\u53d6\u5f97\u3057DB\u3078\u4fdd\u5b58\u3059\u308b\u30a2\u30d7\u30ea\u3092\u4f5c\u6210\u3059\u308b\u3002\n\nNuGet\u3067\u5fc5\u8981\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\nMicrosoft.EntityFrameworkCore\nMicrosoft.EntityFrameworkCore.Design\nMicrosoft.EntityFrameworkCore.SqlServer\nMicrosoft.EntityFrameworkCore.Tools\n(\u57f7\u7b46\u6642\u70b9\u3067\u306f\u300c\u30d7\u30ec\u30ea\u30ea\u30fc\u30b9\u3092\u542b\u3081\u308b\u300d\u3078\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u308b\u5fc5\u8981\u6709\u308a)\n\n\nproject.json\u3092\u7de8\u96c6\u3002\n\u30bb\u30af\u30b7\u30e7\u30f3\u300ctools\u300d\u3092\u4f5c\u6210\u3002\n\u30bb\u30af\u30b7\u30e7\u30f3\u300cdependencies\u300d\u306b\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u4ee5\u4e0b\u3092\u300ctools\u300d\u3078\u79fb\u52d5\u3002\n\n\"Microsoft.EntityFrameworkCore.Tools\": \"\u307b\u306b\u3083\u3089\u3089\"\n\n\nproject.json\n{\n  \"version\": \"1.0.0-*\",\n  \"buildOptions\": {\n    \"emitEntryPoint\": true\n  },\n\n  \"dependencies\": {\n    \"Microsoft.EntityFrameworkCore.Design\": \"1.0.0-preview2-final\",\n    \"Microsoft.EntityFrameworkCore.SqlServer\": \"1.0.1\",\n-   \"Microsoft.EntityFrameworkCore.Tools\": \"1.0.0-preview2-final\"\n    \"Microsoft.NETCore.App\": {\n      \"type\": \"platform\",\n      \"version\": \"1.0.1\"\n    },\n    \"System.Text.Encoding.CodePages\": \"4.0.1\"\n  },\n+ \"tools\": {\n+   \"Microsoft.EntityFrameworkCore.Tools\": \"1.0.0-preview2-final\"\n+ },\n\n  \"frameworks\": {\n    \"netcoreapp1.0\": {\n      \"imports\": \"dnxcore50\"\n    }\n  }\n}\n\n\n\n\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u30af\u30e9\u30b9\u3092\u4f5c\u6210\n\u30c7\u30fc\u30bf\u306e\u53d7\u3051\u76bf\u3068\u306a\u308b\u30af\u30e9\u30b9\u3068\u3057\u3066Article, AppDbContext\u3092\u4f5c\u6210\u3002\n\nProgram.cs\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Threading.Tasks;\nusing Microsoft.EntityFrameworkCore;\n\nnamespace HelloCore\n{\n    public class Program\n    {\n        public static void Main(string[] args)\n        {\n            //\u767b\u9332\u3059\u308c\u3070\u5fc5\u8981\u306a\u5834\u9762(Win\u4e0a\u3067\u5b9f\u884c\u3057\u305f\u6642)\u3067\u4f7f\u7528\u3055\u308c\u308b\u3002\n            System.Text.Encoding.RegisterProvider(System.Text.CodePagesEncodingProvider.Instance);\n        }\n    }\n    //\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u30af\u30e9\u30b9\n    public class Article\n    {\n        public int Id { get; set; }\n        public string LinkUrl { get; set; }\n        public string Title { get; set; }\n        public string Description { get; set; }\n        public string ChannelTitle { get; set; }\n    }\n    //\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u30af\u30e9\u30b9\n    public class AppDbContext : DbContext\n    {\n        protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)\n        {\n            base.OnConfiguring(optionsBuilder);\n            //\u3053\u3053\u3067\u306f\u63a5\u7d9a\u5148\u306eDB\u540d\u306fhellocoredb\u3068\u3059\u308b\n            optionsBuilder.UseSqlServer(@\"Data Source=(localdb)\\MSSQLLocalDB;Initial Catalog=hellocoredb;\");\n        }\n        public DbSet<Article> Article { get; set; }\n    }\n}\n\n\n\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u958b\u304f(\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306fHelloCore\u30d7\u30ed\u30b8\u30a7\u30af\u30c8)\u3002\ndotnet ef\u30b3\u30de\u30f3\u30c9\u3067AppDbContext\u30af\u30e9\u30b9\u304c\u5ba3\u8a00\u3057\u305fDB\u30fb\u30c6\u30fc\u30d6\u30eb\u306e\u751f\u6210\u3092\u884c\u3046\u3002\n\ncmd\n...\\HelloCore\\src\\HelloCore> dotnet ef migrations add \u9069\u5f53\u306a\u540d\u524d\n...\\HelloCore\\src\\HelloCore> dotnet ef database update\n\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306eData/Migrations/\u4e0b\u306b\"\u9069\u5f53\u306a\u540d\u524d\"\u306eMigration\u6d3e\u751f\u30af\u30e9\u30b9\u304c\u751f\u6210\u3055\u308c\u308b\u3002\u3053\u306e\u30af\u30e9\u30b9\u306e\u5185\u5bb9\u304c\u5b9f\u884c\u3055\u308c\u308b\u3053\u3068\u3067DB\u64cd\u4f5c\u304c\u884c\u308f\u308c\u308b\u3002\u4e0a\u306e\u30b3\u30de\u30f3\u30c9\u3067\u306fmigration add\u3067\u6d3e\u751f\u30af\u30e9\u30b9\u751f\u6210\u3001database update\u3067\u751f\u6210\u30af\u30e9\u30b9\u3092\u5143\u306bDB\u64cd\u4f5c\u304c\u884c\u308f\u308c\u3066\u3044\u308b\u3002\n\u5099\u8003\n\ndotnet ef\u30b3\u30de\u30f3\u30c9\u306fproject.json\u306etools\u30bb\u30af\u30b7\u30e7\u30f3\u3078\u8ffd\u52a0\u3057\u305f\"Microsoft.EntityFrameworkCore.Tools\"\u304c\u6e90\nDB\u751f\u6210\u3092\u9593\u9055\u3048\u305f\u6642\u306f\u3001\u4e0b\u8a18\u64cd\u4f5c\u3092\u884c\u3046\u3068\u3084\u308a\u76f4\u3057\u53ef\u80fd\u3002\n\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3078\u8ffd\u52a0\u3055\u308c\u305f\"Migrations\"\u30d5\u30a9\u30eb\u30c0\u3092\u524a\u9664\n...\\HelloCore\\src\\HelloCore> dotnet ef database drop\n\n\n\n\nMain\u30e1\u30bd\u30c3\u30c9\u3067\u4f7f\u3063\u3066\u307f\u308b\nDB\u306e\u6e96\u5099\u306f\u5b8c\u4e86\u3002\u5b9f\u969b\u306bDB\u3092\u4f7f\u7528\u3057\u3066\u307f\u308b\u3002Main\u30e1\u30bd\u30c3\u30c9\u306bDB\u3092\u4f7f\u7528\u3059\u308b\u30b3\u30fc\u30c9\u3092\u8a18\u8ff0\u3059\u308b\u3002\n\nProgram.cs\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Threading.Tasks;\nusing Microsoft.EntityFrameworkCore;\n\nnamespace HelloCore\n{\n    public class Program\n    {\n        public static void Main(string[] args)\n        {\n            System.Text.Encoding.RegisterProvider(System.Text.CodePagesEncodingProvider.Instance);\n            Console.WriteLine(\"\u958b\u59cb\");\n\n            var db = new AppDbContext();\n            var http = new System.Net.Http.HttpClient();\n\n            //\u30d5\u30a3\u30fc\u30c9\u3092\u9069\u5f53\u306a\u30b5\u30a4\u30c8\u304b\u3089\u53d6\u5f97\n            foreach (var targetUrl in\n                new[] {\n                    \"http://www3.asahi.com/rss/index.rdf\",\n                    \"http://rss.rssad.jp/rss/codezine/new/20/index.xml\",\n                })\n            {\n                //\u30d5\u30a3\u30fc\u30c9xml\u3092DL & Parse\n                //xml\u306f\u540d\u524d\u7a7a\u9593\u3067\u9762\u5012\u304c\u751f\u3058\u306a\u3044\u3088\u3046\u540d\u524d\u7a7a\u9593\u60c5\u5831\u3092\u9664\u67d3\n                var rssTxt = http.GetStringAsync(targetUrl).Result;\n                var rss = System.Xml.Linq.XElement.Parse(rssTxt);\n                foreach (var item in rss.Descendants())\n                    item.Name = item.Name.LocalName;\n\n                //\u30d5\u30a3\u30fc\u30c9\u306e\u8a18\u4e8b\u3092Model\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3078\u79fb\u3057\u66ff\u3048\u308b\n                var articles = rss\n                    .Descendants(\"item\")\n                    .Select(item =>\n                        new Article()\n                        {\n                            Title = item.Element(\"title\").Value,\n                            LinkUrl = item.Element(\"link\").Value,\n                            Description = item.Element(\"description\").Value,\n                            ChannelTitle = rss.Element(\"channel\").Element(\"title\").Value,\n                        });\n\n                //DB\u306b\u672a\u8ffd\u52a0\u306e\u8a18\u4e8b\u3092DB\u3078\u4fdd\u5b58\u3059\u308b\n                foreach (var item in articles)\n                {\n                    if (db.Article.Any(_ => _.LinkUrl == item.LinkUrl))\n                        continue;\n\n                    Console.WriteLine(item.Title);\n                    db.Article.Add(item);\n                }\n            }\n            //DB\u3078\u306e\u4fdd\u5b58\u3092\u78ba\u5b9a\n            db.SaveChanges();\n            Console.WriteLine(\"\u7d42\u4e86\");\n            Console.Read();\n        }\n    }\n    //\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u30af\u30e9\u30b9\n    public class Article\n    {\n        public int Id { get; set; }\n        public string LinkUrl { get; set; }\n        public string Title { get; set; }\n        public string Description { get; set; }\n        public string ChannelTitle { get; set; }\n    }\n    //\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u30af\u30e9\u30b9\n    public class AppDbContext : DbContext\n    {\n        protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)\n        {\n            base.OnConfiguring(optionsBuilder);\n            //\u3053\u3053\u3067\u306f\u63a5\u7d9a\u5148\u306eDB\u540d\u306fhellocoredb\u3068\u3059\u308b\n            optionsBuilder.UseSqlServer(@\"Data Source=(localdb)\\MSSQLLocalDB;Initial Catalog=hellocoredb;\");\n        }\n        public DbSet<Article> Article { get; set; }\n    }\n}\n\n\nVisualStudio\u3067\u5b9f\u884c\u3002\n\u30d5\u30a3\u30fc\u30c9\u304c\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u8868\u793a\u3055\u308c\u3001VS\u306e\u300cSQL Server \u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u30a8\u30af\u30b9\u30d7\u30ed\u30fc\u30e9\u300d\u304b\u3089hellocoredb\u306eArticle\u30c6\u30fc\u30d6\u30eb\u304c\u66f4\u65b0\u3055\u308c\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3067\u304d\u308c\u3070\u6210\u529f\u3002\n\n\u305d\u306e\u4ed6\u306e\u64cd\u4f5c\n\n\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u30af\u30e9\u30b9\u306e\u30e1\u30f3\u30d0\u3092\u7de8\u96c6\u3057\u305f\u3044\u6642\n\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u30af\u30e9\u30b9\u3078\u30e1\u30f3\u30d0\u3092\u7de8\u96c6\u5f8c\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u53e9\u304f\n\ncmd\n...\\HelloCore\\src\\HelloCore> dotnet ef migrations add \u52a0\u3048\u305f\u5909\u66f4\u304c\u5206\u304b\u308b\u540d\u79f0\n...\\HelloCore\\src\\HelloCore> dotnet ef database update\n\n\n\n\u76f4\u524d\u306e\u7de8\u96c6\u3092\u53d6\u308a\u6d88\u3057\u305f\u3044\u6642 (DB\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u524d)\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u53e9\u304f\u3002DB\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u5f8c\u3060\u3063\u305f\u5834\u5408\u306b\u306f\u53d6\u6d88\u3057\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3068\u3057\u3066\u4e0a\u306e\u8ffd\u52a0\u6642\u306e\u64cd\u4f5c\u3092\u884c\u3046\u3002\n\ncmd\n...\\HelloCore\\src\\HelloCore> dotnet ef migrations remove\n\n\n\nDB\u3092\u6d88\u3057\u305f\u3044\u6642\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u53e9\u304f\u3002\u53e9\u3044\u305f\u5f8c\u306b\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306eMigrations\u30d5\u30a9\u30eb\u30c0\u3092\u524a\u9664\n\ncmd\n...\\HelloCore\\src\\HelloCore> dotnet ef database drop\n\n\n\n\u304a\u307e\u3051\n\n\u4f7f\u7528DB\u3092SQLite\u306b\u5207\u66ff\u3048\u3066\u307f\u308b\n\nNuGet\u304b\u3089\u5fc5\u8981\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30fc\u30eb\n\nMicrosoft.EntityFrameworkCore.Sqlite\n\n\nAppDbContext\u3092\u66f8\u304d\u63db\u3048\u308b\n\nProgram.cs\npublic class AppDbContext : DbContext\n{\n    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)\n    {\n        base.OnConfiguring(optionsBuilder);\n        //\u3053\u3053\u3067\u306f\u63a5\u7d9a\u5148\u306eDB\u540d\u306fhellocoredb\u3068\u3059\u308b\n-       optionsBuilder.UseSqlServer(@\"Data Source=(localdb)\\MSSQLLocalDB;Initial Catalog=hellocoredb;\");\n+       optionsBuilder.UseSqlite(@\"Data Source='hello.db'\");\n    }\n    public DbSet<Article> Article { get; set; }\n}\n\n\n\nSQLite\u3067DB\u3092\u4f5c\u6210\u3059\u308b\n\ncmd\n...\\HelloCore\\src\\HelloCore> dotnet ef database update\n\n\n\n\u307e\u3068\u3081\n\n\u898f\u7d04\u3092\u5b88\u3063\u305f\u8a18\u8ff0\u3092\u884c\u3063\u3066\u3044\u308c\u3070DB\u69cb\u7bc9\u306f\u30b3\u30de\u30f3\u30c9\u4e00\u672c\nEntityFrameworkCore + SQL Server\u3067\u6700\u4f4e\u9650\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u7121\u5370, Desgin, SqlServer, Tools\nSQLite\u3082\u516c\u5f0f\u5bfe\u5fdc\u3002SqlServer\u306e\u4ee3\u308f\u308a\u306bSqlite\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5165\u308c\u308b\n\n\n\u53c2\u8003\u8cc7\u6599\n\nEntity Framework Core\nhttps://docs.efproject.net/en/latest/index.html\n\n.NET Core \u3067\u306e \u30b3\u30f3\u30bd\u30fc\u30eb\u30a2\u30d7\u30ea\u306e\u6587\u5b57\u5316\u3051\u3092\u76f4\u3059\nhttp://aquasoftware.net/blog/?p=895\n\n\n# \u57f7\u7b46\u6642\u70b9\u306e\u74b0\u5883\n* Windows 10 \u3092\u4f7f\u7528\n* VisualStudio Community 2015 (\u7565\u79f0 VS) \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\n* Microsoft SQL Server Data Tools \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f (VS\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u306b\u4ed8\u968f)\n* .NET Core 1.0.0\n* EntityFrameworkCore 1.0\n\n# CodeFirst\u3068\u306f\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u5148\u306b\u66f8\u304d\u3001\u305d\u308c\u3092\u5143\u306bEntityFramework\u306bDB\u30fb\u30c6\u30fc\u30d6\u30eb\u3092\u751f\u6210\u3055\u305b\u308b\u3088\u3046\u306a\u30b9\u30bf\u30a4\u30eb\u3002\u30eb\u30fc\u30eb\u306b\u5247\u3063\u3066\u30b3\u30fc\u30c9\u8a18\u8ff0\u3092\u884c\u3046\u3053\u3068\u3067DB\u3084\u30c6\u30fc\u30d6\u30eb\u306e\u751f\u6210\u306f\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u5074\u304c\u884c\u3063\u3066\u304f\u308c\u308b\u3002\n\n\u57fa\u672c\u30eb\u30fc\u30eb\n\n* \u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u30af\u30e9\u30b9:  \n  \u6271\u3046\u30c7\u30fc\u30bf\u3092\u8868\u73fe\u3059\u308b\u30af\u30e9\u30b9\u3002DB\u306e\u30ec\u30b3\u30fc\u30c9\u3068\u5bfe\u5fdc\u3059\u308b\u3002\u4f55\u3082\u7d99\u627f\u3059\u308b\u5fc5\u8981\u306f\u7121\u304f\u3001\u30ab\u30e9\u30e0\u3068\u5bfe\u5fdc\u3059\u308b\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u6301\u3064\u3002\n* \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u30af\u30e9\u30b9:  \n  DbContext\u3092\u7d99\u627f\u3055\u305b\u308b\u3002\u7ba1\u7406\u3059\u308b\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u30af\u30e9\u30b9\u3092DbSet\\<T\\>\u578b\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3068\u3057\u3066\u4fdd\u6301\u3055\u305b\u308b\u3002\u30ec\u30b3\u30fc\u30c9\u53d6\u5f97\u3084\u30ec\u30b3\u30fc\u30c9\u4fdd\u5b58\u306f\u3053\u306e\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u901a\u3057\u3066\u884c\u3046\u3002\n\n# \u4f7f\u3063\u3066\u307f\u308b\n## VisualStudio \u3067\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u300c.NET Core\u300d-\u300cConsole Application (.NET Core)\u300d\u3067\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\n(\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d\u306fHelloCore\u3068\u3059\u308b)\n\n\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u65e5\u672c\u8a9e\u3092\u51fa\u529b\u3059\u308b\u3068\u6587\u5b57\u5316\u3051\u3059\u308b\u3002\n.NET Core\u306f\u6a19\u6e96\u3067\u306fUnicode, ASCII, CodePage 28591 \u4ee5\u5916\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u4e00\u65b9\u3001Windows\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u306fShift-JIS\u3067\u3042\u308b\u4e8b\u304c\u539f\u56e0\u3002NuGet\u7d4c\u7531\u3067Shift-JIS\u3078\u5bfe\u5fdc\u3055\u305b\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5c0e\u5165\u3059\u308c\u3070\u65e5\u672c\u8a9e\u8868\u793a\u53ef\u80fd\u3002\u4ee5\u4e0b\u306e\u4f5c\u696d\u3067\u5bfe\u5fdc\u3055\u305b\u308b\u3002\n\nNuGet\u304b\u3089\u30d1\u30c3\u30b1\u30fc\u30b8\u300cSystem.Text.Encoding.CodePages\u300d\u3092\u30a4\u30f3\u30b9\u30fc\u30eb\nMain\u30e1\u30bd\u30c3\u30c9\u5148\u982d\u306b\u4ee5\u4e0b\u306e\u8a18\u8ff0\u3092\u8ffd\u52a0  \n\n```diff:Program.cs\n\n        public static void Main(string[] args)\n        {\n+           //\u767b\u9332\u3059\u308c\u3070\u5fc5\u8981\u306a\u5834\u9762(Win\u4e0a\u3067\u5b9f\u884c\u3057\u305f\u6642)\u3067\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002\n+           System.Text.Encoding.RegisterProvider(System.Text.CodePagesEncodingProvider.Instance);\n```\n\n## EntityFrameworkCore\u3092\u4f7f\u3046\nSQL Server\u3068\u7d44\u5408\u305b\u3001\u6307\u5b9a\u3057\u305f\u30d5\u30a3\u30fc\u30c9\u304b\u3089\u8a18\u4e8b\u30bf\u30a4\u30c8\u30eb\u3068\u629c\u7c8b\u3092\u53d6\u5f97\u3057DB\u3078\u4fdd\u5b58\u3059\u308b\u30a2\u30d7\u30ea\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n### NuGet\u3067\u5fc5\u8981\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\n* Microsoft.EntityFrameworkCore\n* Microsoft.EntityFrameworkCore.Design\n* Microsoft.EntityFrameworkCore.SqlServer\n* Microsoft.EntityFrameworkCore.Tools  \n  (\u57f7\u7b46\u6642\u70b9\u3067\u306f\u300c\u30d7\u30ec\u30ea\u30ea\u30fc\u30b9\u3092\u542b\u3081\u308b\u300d\u3078\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u308b\u5fc5\u8981\u6709\u308a)\n\n### project.json\u3092\u7de8\u96c6\u3002\n\n\u30bb\u30af\u30b7\u30e7\u30f3\u300ctools\u300d\u3092\u4f5c\u6210\u3002\n\u30bb\u30af\u30b7\u30e7\u30f3\u300cdependencies\u300d\u306b\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u4ee5\u4e0b\u3092\u300ctools\u300d\u3078\u79fb\u52d5\u3002\n\n* \"Microsoft.EntityFrameworkCore.Tools\": \"\u307b\u306b\u3083\u3089\u3089\"\n\n```diff:project.json\n{\n  \"version\": \"1.0.0-*\",\n  \"buildOptions\": {\n    \"emitEntryPoint\": true\n  },\n\n  \"dependencies\": {\n    \"Microsoft.EntityFrameworkCore.Design\": \"1.0.0-preview2-final\",\n    \"Microsoft.EntityFrameworkCore.SqlServer\": \"1.0.1\",\n-   \"Microsoft.EntityFrameworkCore.Tools\": \"1.0.0-preview2-final\"\n    \"Microsoft.NETCore.App\": {\n      \"type\": \"platform\",\n      \"version\": \"1.0.1\"\n    },\n    \"System.Text.Encoding.CodePages\": \"4.0.1\"\n  },\n+ \"tools\": {\n+   \"Microsoft.EntityFrameworkCore.Tools\": \"1.0.0-preview2-final\"\n+ },\n\n  \"frameworks\": {\n    \"netcoreapp1.0\": {\n      \"imports\": \"dnxcore50\"\n    }\n  }\n}\n```\n\n### \u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u30af\u30e9\u30b9\u3092\u4f5c\u6210\n\u30c7\u30fc\u30bf\u306e\u53d7\u3051\u76bf\u3068\u306a\u308b\u30af\u30e9\u30b9\u3068\u3057\u3066Article, AppDbContext\u3092\u4f5c\u6210\u3002\n\n```csharp:Program.cs\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Threading.Tasks;\nusing Microsoft.EntityFrameworkCore;\n\nnamespace HelloCore\n{\n    public class Program\n    {\n        public static void Main(string[] args)\n        {\n            //\u767b\u9332\u3059\u308c\u3070\u5fc5\u8981\u306a\u5834\u9762(Win\u4e0a\u3067\u5b9f\u884c\u3057\u305f\u6642)\u3067\u4f7f\u7528\u3055\u308c\u308b\u3002\n            System.Text.Encoding.RegisterProvider(System.Text.CodePagesEncodingProvider.Instance);\n        }\n    }\n    //\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u30af\u30e9\u30b9\n    public class Article\n    {\n        public int Id { get; set; }\n        public string LinkUrl { get; set; }\n        public string Title { get; set; }\n        public string Description { get; set; }\n        public string ChannelTitle { get; set; }\n    }\n    //\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u30af\u30e9\u30b9\n    public class AppDbContext : DbContext\n    {\n        protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)\n        {\n            base.OnConfiguring(optionsBuilder);\n            //\u3053\u3053\u3067\u306f\u63a5\u7d9a\u5148\u306eDB\u540d\u306fhellocoredb\u3068\u3059\u308b\n            optionsBuilder.UseSqlServer(@\"Data Source=(localdb)\\MSSQLLocalDB;Initial Catalog=hellocoredb;\");\n        }\n        public DbSet<Article> Article { get; set; }\n    }\n}\n```\n\n\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u958b\u304f(\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306fHelloCore\u30d7\u30ed\u30b8\u30a7\u30af\u30c8)\u3002\ndotnet ef\u30b3\u30de\u30f3\u30c9\u3067AppDbContext\u30af\u30e9\u30b9\u304c\u5ba3\u8a00\u3057\u305fDB\u30fb\u30c6\u30fc\u30d6\u30eb\u306e\u751f\u6210\u3092\u884c\u3046\u3002\n\n```shell-session:cmd\n...\\HelloCore\\src\\HelloCore> dotnet ef migrations add \u9069\u5f53\u306a\u540d\u524d\n...\\HelloCore\\src\\HelloCore> dotnet ef database update\n```\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306eData/Migrations/\u4e0b\u306b\"\u9069\u5f53\u306a\u540d\u524d\"\u306eMigration\u6d3e\u751f\u30af\u30e9\u30b9\u304c\u751f\u6210\u3055\u308c\u308b\u3002\u3053\u306e\u30af\u30e9\u30b9\u306e\u5185\u5bb9\u304c\u5b9f\u884c\u3055\u308c\u308b\u3053\u3068\u3067DB\u64cd\u4f5c\u304c\u884c\u308f\u308c\u308b\u3002\u4e0a\u306e\u30b3\u30de\u30f3\u30c9\u3067\u306fmigration add\u3067\u6d3e\u751f\u30af\u30e9\u30b9\u751f\u6210\u3001database update\u3067\u751f\u6210\u30af\u30e9\u30b9\u3092\u5143\u306bDB\u64cd\u4f5c\u304c\u884c\u308f\u308c\u3066\u3044\u308b\u3002\n\n\u5099\u8003\n\n* dotnet ef\u30b3\u30de\u30f3\u30c9\u306fproject.json\u306etools\u30bb\u30af\u30b7\u30e7\u30f3\u3078\u8ffd\u52a0\u3057\u305f\"Microsoft.EntityFrameworkCore.Tools\"\u304c\u6e90\n* DB\u751f\u6210\u3092\u9593\u9055\u3048\u305f\u6642\u306f\u3001\u4e0b\u8a18\u64cd\u4f5c\u3092\u884c\u3046\u3068\u3084\u308a\u76f4\u3057\u53ef\u80fd\u3002\n  1. \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3078\u8ffd\u52a0\u3055\u308c\u305f\"Migrations\"\u30d5\u30a9\u30eb\u30c0\u3092\u524a\u9664\n  2. ...\\HelloCore\\src\\HelloCore> dotnet ef database drop\n\n### Main\u30e1\u30bd\u30c3\u30c9\u3067\u4f7f\u3063\u3066\u307f\u308b\nDB\u306e\u6e96\u5099\u306f\u5b8c\u4e86\u3002\u5b9f\u969b\u306bDB\u3092\u4f7f\u7528\u3057\u3066\u307f\u308b\u3002Main\u30e1\u30bd\u30c3\u30c9\u306bDB\u3092\u4f7f\u7528\u3059\u308b\u30b3\u30fc\u30c9\u3092\u8a18\u8ff0\u3059\u308b\u3002\n\n```csharp:Program.cs\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Threading.Tasks;\nusing Microsoft.EntityFrameworkCore;\n\nnamespace HelloCore\n{\n    public class Program\n    {\n        public static void Main(string[] args)\n        {\n            System.Text.Encoding.RegisterProvider(System.Text.CodePagesEncodingProvider.Instance);\n            Console.WriteLine(\"\u958b\u59cb\");\n\n            var db = new AppDbContext();\n            var http = new System.Net.Http.HttpClient();\n\n            //\u30d5\u30a3\u30fc\u30c9\u3092\u9069\u5f53\u306a\u30b5\u30a4\u30c8\u304b\u3089\u53d6\u5f97\n            foreach (var targetUrl in\n                new[] {\n                    \"http://www3.asahi.com/rss/index.rdf\",\n                    \"http://rss.rssad.jp/rss/codezine/new/20/index.xml\",\n                })\n            {\n                //\u30d5\u30a3\u30fc\u30c9xml\u3092DL & Parse\n                //xml\u306f\u540d\u524d\u7a7a\u9593\u3067\u9762\u5012\u304c\u751f\u3058\u306a\u3044\u3088\u3046\u540d\u524d\u7a7a\u9593\u60c5\u5831\u3092\u9664\u67d3\n                var rssTxt = http.GetStringAsync(targetUrl).Result;\n                var rss = System.Xml.Linq.XElement.Parse(rssTxt);\n                foreach (var item in rss.Descendants())\n                    item.Name = item.Name.LocalName;\n\n                //\u30d5\u30a3\u30fc\u30c9\u306e\u8a18\u4e8b\u3092Model\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3078\u79fb\u3057\u66ff\u3048\u308b\n                var articles = rss\n                    .Descendants(\"item\")\n                    .Select(item =>\n                        new Article()\n                        {\n                            Title = item.Element(\"title\").Value,\n                            LinkUrl = item.Element(\"link\").Value,\n                            Description = item.Element(\"description\").Value,\n                            ChannelTitle = rss.Element(\"channel\").Element(\"title\").Value,\n                        });\n\n                //DB\u306b\u672a\u8ffd\u52a0\u306e\u8a18\u4e8b\u3092DB\u3078\u4fdd\u5b58\u3059\u308b\n                foreach (var item in articles)\n                {\n                    if (db.Article.Any(_ => _.LinkUrl == item.LinkUrl))\n                        continue;\n\n                    Console.WriteLine(item.Title);\n                    db.Article.Add(item);\n                }\n            }\n            //DB\u3078\u306e\u4fdd\u5b58\u3092\u78ba\u5b9a\n            db.SaveChanges();\n            Console.WriteLine(\"\u7d42\u4e86\");\n            Console.Read();\n        }\n    }\n    //\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u30af\u30e9\u30b9\n    public class Article\n    {\n        public int Id { get; set; }\n        public string LinkUrl { get; set; }\n        public string Title { get; set; }\n        public string Description { get; set; }\n        public string ChannelTitle { get; set; }\n    }\n    //\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u30af\u30e9\u30b9\n    public class AppDbContext : DbContext\n    {\n        protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)\n        {\n            base.OnConfiguring(optionsBuilder);\n            //\u3053\u3053\u3067\u306f\u63a5\u7d9a\u5148\u306eDB\u540d\u306fhellocoredb\u3068\u3059\u308b\n            optionsBuilder.UseSqlServer(@\"Data Source=(localdb)\\MSSQLLocalDB;Initial Catalog=hellocoredb;\");\n        }\n        public DbSet<Article> Article { get; set; }\n    }\n}\n```\n\nVisualStudio\u3067\u5b9f\u884c\u3002\n\u30d5\u30a3\u30fc\u30c9\u304c\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u8868\u793a\u3055\u308c\u3001VS\u306e\u300cSQL Server \u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u30a8\u30af\u30b9\u30d7\u30ed\u30fc\u30e9\u300d\u304b\u3089hellocoredb\u306eArticle\u30c6\u30fc\u30d6\u30eb\u304c\u66f4\u65b0\u3055\u308c\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3067\u304d\u308c\u3070\u6210\u529f\u3002\n\n# \u305d\u306e\u4ed6\u306e\u64cd\u4f5c\n## \u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u30af\u30e9\u30b9\u306e\u30e1\u30f3\u30d0\u3092\u7de8\u96c6\u3057\u305f\u3044\u6642\n\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u30af\u30e9\u30b9\u3078\u30e1\u30f3\u30d0\u3092\u7de8\u96c6\u5f8c\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u53e9\u304f\n\n```shell-session:cmd\n...\\HelloCore\\src\\HelloCore> dotnet ef migrations add \u52a0\u3048\u305f\u5909\u66f4\u304c\u5206\u304b\u308b\u540d\u79f0\n...\\HelloCore\\src\\HelloCore> dotnet ef database update\n```\n\n## \u76f4\u524d\u306e\u7de8\u96c6\u3092\u53d6\u308a\u6d88\u3057\u305f\u3044\u6642 (DB\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u524d)\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u53e9\u304f\u3002DB\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u5f8c\u3060\u3063\u305f\u5834\u5408\u306b\u306f\u53d6\u6d88\u3057\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3068\u3057\u3066\u4e0a\u306e\u8ffd\u52a0\u6642\u306e\u64cd\u4f5c\u3092\u884c\u3046\u3002\n\n```shell-session:cmd\n...\\HelloCore\\src\\HelloCore> dotnet ef migrations remove\n```\n\n## DB\u3092\u6d88\u3057\u305f\u3044\u6642\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u53e9\u304f\u3002\u53e9\u3044\u305f\u5f8c\u306b\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306eMigrations\u30d5\u30a9\u30eb\u30c0\u3092\u524a\u9664\n\n```shell-session:cmd\n...\\HelloCore\\src\\HelloCore> dotnet ef database drop\n```\n\n# \u304a\u307e\u3051\n## \u4f7f\u7528DB\u3092SQLite\u306b\u5207\u66ff\u3048\u3066\u307f\u308b\n\n### NuGet\u304b\u3089\u5fc5\u8981\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30fc\u30eb\n* Microsoft.EntityFrameworkCore.Sqlite\n\n### AppDbContext\u3092\u66f8\u304d\u63db\u3048\u308b\n```diff:Program.cs\npublic class AppDbContext : DbContext\n{\n    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)\n    {\n        base.OnConfiguring(optionsBuilder);\n        //\u3053\u3053\u3067\u306f\u63a5\u7d9a\u5148\u306eDB\u540d\u306fhellocoredb\u3068\u3059\u308b\n-       optionsBuilder.UseSqlServer(@\"Data Source=(localdb)\\MSSQLLocalDB;Initial Catalog=hellocoredb;\");\n+       optionsBuilder.UseSqlite(@\"Data Source='hello.db'\");\n    }\n    public DbSet<Article> Article { get; set; }\n}\n```\n\n### SQLite\u3067DB\u3092\u4f5c\u6210\u3059\u308b\n```shell-session:cmd\n...\\HelloCore\\src\\HelloCore> dotnet ef database update\n```\n\n# \u307e\u3068\u3081\n\n* \u898f\u7d04\u3092\u5b88\u3063\u305f\u8a18\u8ff0\u3092\u884c\u3063\u3066\u3044\u308c\u3070DB\u69cb\u7bc9\u306f\u30b3\u30de\u30f3\u30c9\u4e00\u672c\n* EntityFrameworkCore + SQL Server\u3067\u6700\u4f4e\u9650\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u7121\u5370, Desgin, SqlServer, Tools\n* SQLite\u3082\u516c\u5f0f\u5bfe\u5fdc\u3002SqlServer\u306e\u4ee3\u308f\u308a\u306bSqlite\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5165\u308c\u308b\n\n# \u53c2\u8003\u8cc7\u6599\n* Entity Framework Core  \n  https://docs.efproject.net/en/latest/index.html\n* .NET Core \u3067\u306e \u30b3\u30f3\u30bd\u30fc\u30eb\u30a2\u30d7\u30ea\u306e\u6587\u5b57\u5316\u3051\u3092\u76f4\u3059  \n  http://aquasoftware.net/blog/?p=895\n", "tags": [".NET", ".NETCore", "Windows", "EntityFramework"]}