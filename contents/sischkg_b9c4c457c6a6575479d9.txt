{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\nDNS Advent Calendar 2015 \u306e15\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\nRFC 7706(Decreasing Access Time to Root Servers by Running One on Loopback) \u306f\u3001DNS\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u306eloopback\u306b\u3066\u30eb\u30fc\u30c8\u30b5\u30fc\u30d0\uff08\u30b9\u30ec\u30fc\u30d6\uff09\u3092\u52d5\u304b\u3059\u3053\u3068\u306b\u3064\u3044\u3066\u8a18\u8f09\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306eRFC\u306eAppendix B\u306b\u306f\u3001\n\nBind\nUnbound/NSD\nMicrosoft Windows Server 2012\n\n\u306e\u8a2d\u5b9a\u4f8b\u304c\u3042\u308a\u307e\u3059\u304c\u3001PowerDNS\u306e\u8a2d\u5b9a\u4f8b\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u3053\u3053\u3067\u306fPowerDNS\u3067RFC7706\u3092\u8a2d\u5b9a\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u8a2d\u5b9a\u65b9\u6cd5\n\n\u74b0\u5883\n\u3053\u3053\u3067\u306f\u4ee5\u4e0b\u306e\u74b0\u5883\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\nCentOS 6.7\nPowerDNS Authoritative Server 3.4.7\nPowerDNS Recursor 3.7.3\nMySQL 5.1.73\n192.167.33.0/24\u306b\u5bfe\u3057\u3066\u3001\u30d5\u30eb\u30ea\u30be\u30eb\u30d0\u3092\u63d0\u4f9b\u3059\u308b\u3002\n\n\nMySQL\nRPM\u306eMySQL\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001mysqld\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ sudo yum install mysql-server\n$ sudo service mysqld start\n$ sudo chkconfig mysqld on\n\nPowerDNS\u7528\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ mysql -uroot \n> CREATE DATABASE pdns;\n> GRANT ALL ON pdns.* TO pdns@127.0.0.1 identified by 'pdns_password';\n> quit\n\nGeneric MySQL and PostgreSQL backends(doc.powerdns.com)\u306e\"The default setup conforms to the following schema:\"\u3092\u5165\u529b\u3057\u307e\u3059\u3002powerdns_mysql_backend_schema.sql\u306f\u3053\u3053(gist)\u306b\u3042\u308a\u307e\u3059\u3002\n$ mysql -h127.0.0.1 -updns -p pdns < powerdns_mysql_backend_schema.sql\n\n\u30eb\u30fc\u30c8\u30be\u30fc\u30f3\u306e\u8a2d\u5b9a\u3092domains\u30c6\u30fc\u30d6\u30eb\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\u3053\u306e\u6642\u3001\n\n\u30de\u30b9\u30bf\u30fc\u30b5\u30fc\u30d0\u306b\u306f\u3001\u30eb\u30fc\u30c8\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u30ab\u30f3\u30de\u533a\u5207\u308a\u3067\u6307\u5b9a\nname\u306f\".\"\u3067\u306f\u306a\u304f\"\"\uff08\u7a7a\u6587\u5b57\u5217\uff09\u3092\u6307\u5b9a\n\n\nname\u306b\".\"\u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u30eb\u30fc\u30c8\u30b5\u30fc\u30d0\u304b\u3089\u30be\u30fc\u30f3\u8ee2\u9001\u3067\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3066\u304d\u307e\u3059\u304c\u3001\u30be\u30fc\u30f3\u5916\u306e\u30c7\u30fc\u30bf\u3068\u3057\u3066\u7121\u8996\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n\n\n\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n$ mysql -h127.0.0.1 -updns -p pdns\n> INSERT INTO domains\n    (name,type,master)\n    values('',\n           'SLAVE',\n           '192.228.79.201,192.33.4.12,192.5.5.241,192.112.36.4,193.0.14.129,192.0.47.132,192.0.32.132');\n> quit\n\n\nPowerDNS Authoritative Server\n\u307e\u305a\u3001PowerDNS Authoritative Server\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u305f\u3081\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ sudo yum install boost-devel mysql-devel\n\nPowerDNS.com\u304b\u3089PowerDNS Authoritative Server\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n$ wget https://downloads.powerdns.com/releases/pdns-3.4.7.tar.bz2\n\ntarball\u3092\u5c55\u958b\u3057\u3001\u30b3\u30f3\u30d1\u30a4\u30eb\u30fb\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ tar xjf pdns-3.4.7.tar.bz2\n$ cd pdns-3.4.7\n$ ./configure\n$ make\n$ sudo make install\n$ sudo cp pdns/pdns /etc/init.d/\n$ sudo chkconfiig --add pdns\n\nPowerDNS\u7528\u306e\u30e6\u30fc\u30b6\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n$ sudo groupadd pdns\n$ sudo useradd -g pdns pdns\n\nPowerDNS Authoritative Server\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ sudo cp /usr/local/etc/pdns.conf-dist /usr/local/etc/pdns.conf\n$ sudo vi /usr/local/etc/pdns.conf\n\n\u6b21\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\ndaemon\u3068\u3057\u3066\u52d5\u4f5c\nloopback 127.12.12.12\u3092bind\ngid\u306fpdns\nuid\u306fpdns\nslave\u6a5f\u80fd\u3092\u6709\u52b9\n\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306fMySQL\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u306f\u4ee5\u4e0b\u306e\u884c\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\ndaemon=yes\nlocal-address=127.12.12.12\nsetgid=pdns\nsetuid=pdns\nslave=yes\n\nlaunch=gmysql\ngmysql-host=127.0.0.1\ngmysql-user=pdns\ngmysql-dbname=pdns\ngmysql-password=pdns_password\n\npdns\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ sudo service pdns start\n$ sudo chkconfig pdns on\n\npdns\u306f\u8d77\u52d5\u5f8c\u306b\u30eb\u30fc\u30c8\u30be\u30fc\u30f3\u306e\u30be\u30fc\u30f3\u8ee2\u9001\u3092\u884c\u3044\u3001\u6210\u529f\u3059\u308c\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30ed\u30b0\u3092\u51fa\u529b\u3057\u307e\u3059\u3002\n$ less /var/log/messagges\n\nDec 13 13:20:36 localhost pdns[13016]: 1 slave domain needs checking, 0 queued for AXFR\nDec 13 13:20:37 localhost pdns[13016]: Received serial number updates for 1 zones, had 0 timeouts\nDec 13 13:20:37 localhost pdns[13016]: Domain '' is stale, master serial 2015121300, our serial 0\nDec 13 13:20:37 localhost pdns[13016]: Initiating transfer of '' from remote '193.0.14.129'\nDec 13 13:20:37 localhost pdns[13016]: Done launching threads, ready to distributequestions\nDec 13 13:20:37 localhost pdns[13016]: AXFR started for ''\nDec 13 13:20:37 localhost pdns[13016]: Transaction started for ''\nDec 13 13:20:39 localhost pdns[13016]: AXFR done for '', zone committed with serial number 2015121300\n\n\nPowerDNS Recursor\nPowerDNS.com\u304b\u3089PowerDNS Recursor\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n$ wget https://downloads.powerdns.com/releases/pdns-recursor-3.7.3.tar.bz2\n\ntarball\u3092\u5c55\u958b\u3057\u3001\u30b3\u30f3\u30d1\u30a4\u30eb\u30fb\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ tar xjf pdns-recursor-3.7.3.tar.bz2\n$ cd pdns-recursor-3.7.3\n$ ./configure\n$ make\n$ sudo make install\n$ sudo chkconfig --add pdns-recursor\n\nPowerDNS Recursor\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ sudo cp /etc/powerdns/recursor.conf-dist /etc/powerdns/recursor.conf\n$ sudo vi /etc/powerdns/recursor.conf\n\n\u6b21\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n127.0.0.0/8, 192.168.33.0/24\u304b\u3089\u306e\u554f\u3044\u5408\u308f\u305b\u3092\u8a31\u53ef\u3059\u308b\u3002\n\u30eb\u30fc\u30c8\u30be\u30fc\u30f3(\".\")\u306f127.12.12.12\u3078\u554f\u3044\u5408\u308f\u305b\u308b\u3002\n127.0.0.1\u3068192.168.33.254\u3092bind\ngid\u306fpdns\nuid\u306fpdns\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u306f\u4ee5\u4e0b\u306e\u884c\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\nallow-from=127.0.0.0/8, 192.168.33.0/24\nforward-zones=.=127.12.12.12\nlocal-address=127.0.0.1,192.168.33.254\nsetgid=pdns\nsetuid=pdns\n\nPowerDNS Recursor\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ sudo service pdns-recursor start\n$ sudo chkconfig pdns-recursor on\n\n\n\u52d5\u4f5c\u78ba\u8a8d\ndig\u306b\u3066\u30d5\u30eb\u30ea\u30be\u30eb\u30d0\u306e\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ dig @127.0.0.1 qiita.com a\n\n; <<>> DiG 9.8.2rc1-RedHat-9.8.2-0.37.rc1.el6_7.4 <<>> @127.0.0.1 qiita.com a\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 50249\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0\n\n;; QUESTION SECTION:\n;qiita.com.         IN  A\n\n;; ANSWER SECTION:\nqiita.com.      60  IN  A   176.34.54.212\n\n;; Query time: 555 msec\n;; SERVER: 127.0.0.1#53(127.0.0.1)\n;; WHEN: Sun Dec 13 14:20:41 2015\n;; MSG SIZE  rcvd: 43\n\ntcpdump\u306b\u3066loopback\u306eDNS\u30b5\u30fc\u30d0\u3078\u554f\u3044\u5408\u308f\u305b\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ sudo tcpdump -i lo -n port 53\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on lo, link-type EN10MB (Ethernet), capture size 65535 bytes\n14:20:40.867466 IP 127.0.0.1.56788 > 127.0.0.1.domain: 50249+ A? qiita.com. (27)\n14:20:40.867654 IP 127.12.12.12.11423 > 127.12.12.12.domain: 64624 A? qiita.com. (27)\n14:20:40.872687 IP 127.12.12.12.domain > 127.12.12.12.11423: 64624- 0/13/13 (483)\n14:20:41.151102 IP 127.12.12.12.45802 > 127.12.12.12.domain: 46524 A? ns-1049.awsdns-03.org. (39)\n14:20:41.154018 IP 127.12.12.12.domain > 127.12.12.12.45802: 46524- 0/6/12 (441)\n14:20:41.422804 IP 127.0.0.1.domain > 127.0.0.1.56788: 50249 1/0/0 A 176.34.54.212 (43)\n\n\n\u6700\u5f8c\u306b\n\u3053\u308c\u3067\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u3068\u3057\u3066\u5229\u7528\u3067\u304d\u307e\u3059\u3002\u305f\u3060\u3057\u3001PowerDNS Recursor 3.7.3\u306b\u306fDNSSEC Validation\u306e\u6a5f\u80fd\u306f\u3042\u308a\u307e\u305b\u3093\u306e\u3067\u3001\u5fc5\u8981\u306a\u5834\u5408\u306funbound\u306a\u3069\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n## \u306f\u3058\u3081\u306b\n\nDNS Advent Calendar 2015 \u306e15\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\n[RFC 7706(Decreasing Access Time to Root Servers by Running One on Loopback)](\"https://tools.ietf.org/html/rfc7706\") \u306f\u3001DNS\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u306eloopback\u306b\u3066\u30eb\u30fc\u30c8\u30b5\u30fc\u30d0\uff08\u30b9\u30ec\u30fc\u30d6\uff09\u3092\u52d5\u304b\u3059\u3053\u3068\u306b\u3064\u3044\u3066\u8a18\u8f09\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306eRFC\u306eAppendix B\u306b\u306f\u3001\n\n* Bind\n* Unbound/NSD\n* Microsoft Windows Server 2012\n\n\u306e\u8a2d\u5b9a\u4f8b\u304c\u3042\u308a\u307e\u3059\u304c\u3001PowerDNS\u306e\u8a2d\u5b9a\u4f8b\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u3053\u3053\u3067\u306fPowerDNS\u3067RFC7706\u3092\u8a2d\u5b9a\u3057\u3066\u307f\u307e\u3059\u3002\n\n## \u8a2d\u5b9a\u65b9\u6cd5\n\n### \u74b0\u5883\n\n\u3053\u3053\u3067\u306f\u4ee5\u4e0b\u306e\u74b0\u5883\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n* CentOS 6.7\n* PowerDNS Authoritative Server 3.4.7\n* PowerDNS Recursor 3.7.3\n* MySQL 5.1.73\n* 192.167.33.0/24\u306b\u5bfe\u3057\u3066\u3001\u30d5\u30eb\u30ea\u30be\u30eb\u30d0\u3092\u63d0\u4f9b\u3059\u308b\u3002\n\n### MySQL\n\nRPM\u306eMySQL\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001mysqld\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n    $ sudo yum install mysql-server\n    $ sudo service mysqld start\n    $ sudo chkconfig mysqld on\n\nPowerDNS\u7528\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n    $ mysql -uroot \n    > CREATE DATABASE pdns;\n    > GRANT ALL ON pdns.* TO pdns@127.0.0.1 identified by 'pdns_password';\n    > quit\n\n[Generic MySQL and PostgreSQL backends(doc.powerdns.com)](\"https://doc.powerdns.com/md/authoritative/backend-generic-mypgsql/\")\u306e\"The default setup conforms to the following schema:\"\u3092\u5165\u529b\u3057\u307e\u3059\u3002powerdns_mysql_backend_schema.sql\u306f[\u3053\u3053(gist)](http://gist.githubusercontent.com/sischkg/981870b44c7555648a03/raw/31e53d69fe84349ac29ad43b18ece29bc2576733/powerdns_mysql_backend_schema.sql)\u306b\u3042\u308a\u307e\u3059\u3002\n\n    $ mysql -h127.0.0.1 -updns -p pdns < powerdns_mysql_backend_schema.sql\n\n\u30eb\u30fc\u30c8\u30be\u30fc\u30f3\u306e\u8a2d\u5b9a\u3092domains\u30c6\u30fc\u30d6\u30eb\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\u3053\u306e\u6642\u3001\n\n* \u30de\u30b9\u30bf\u30fc\u30b5\u30fc\u30d0\u306b\u306f\u3001\u30eb\u30fc\u30c8\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u30ab\u30f3\u30de\u533a\u5207\u308a\u3067\u6307\u5b9a\n* name\u306f\".\"\u3067\u306f\u306a\u304f*\"\"\uff08\u7a7a\u6587\u5b57\u5217\uff09*\u3092\u6307\u5b9a\n  + name\u306b\".\"\u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u30eb\u30fc\u30c8\u30b5\u30fc\u30d0\u304b\u3089\u30be\u30fc\u30f3\u8ee2\u9001\u3067\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3066\u304d\u307e\u3059\u304c\u3001\u30be\u30fc\u30f3\u5916\u306e\u30c7\u30fc\u30bf\u3068\u3057\u3066\u7121\u8996\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n \n    $ mysql -h127.0.0.1 -updns -p pdns\n    > INSERT INTO domains\n        (name,type,master)\n        values('',\n               'SLAVE',\n               '192.228.79.201,192.33.4.12,192.5.5.241,192.112.36.4,193.0.14.129,192.0.47.132,192.0.32.132');\n    > quit\n\n### PowerDNS Authoritative Server\n\n\u307e\u305a\u3001PowerDNS Authoritative Server\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u305f\u3081\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n    $ sudo yum install boost-devel mysql-devel\n\n[PowerDNS.com](\"https://www.powerdns.com/downloads.html\")\u304b\u3089PowerDNS Authoritative Server\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n    $ wget https://downloads.powerdns.com/releases/pdns-3.4.7.tar.bz2\n\ntarball\u3092\u5c55\u958b\u3057\u3001\u30b3\u30f3\u30d1\u30a4\u30eb\u30fb\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n    $ tar xjf pdns-3.4.7.tar.bz2\n    $ cd pdns-3.4.7\n    $ ./configure\n    $ make\n    $ sudo make install\n    $ sudo cp pdns/pdns /etc/init.d/\n    $ sudo chkconfiig --add pdns\n\nPowerDNS\u7528\u306e\u30e6\u30fc\u30b6\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n    $ sudo groupadd pdns\n    $ sudo useradd -g pdns pdns\n\nPowerDNS Authoritative Server\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n    $ sudo cp /usr/local/etc/pdns.conf-dist /usr/local/etc/pdns.conf\n    $ sudo vi /usr/local/etc/pdns.conf\n\n\u6b21\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n* daemon\u3068\u3057\u3066\u52d5\u4f5c\n* loopback 127.12.12.12\u3092bind\n* gid\u306fpdns\n* uid\u306fpdns\n* slave\u6a5f\u80fd\u3092\u6709\u52b9\n* \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306fMySQL\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u306f\u4ee5\u4e0b\u306e\u884c\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n    daemon=yes\n    local-address=127.12.12.12\n    setgid=pdns\n    setuid=pdns\n    slave=yes\n    \n    launch=gmysql\n    gmysql-host=127.0.0.1\n    gmysql-user=pdns\n    gmysql-dbname=pdns\n    gmysql-password=pdns_password\n\npdns\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n    $ sudo service pdns start\n    $ sudo chkconfig pdns on\n\npdns\u306f\u8d77\u52d5\u5f8c\u306b\u30eb\u30fc\u30c8\u30be\u30fc\u30f3\u306e\u30be\u30fc\u30f3\u8ee2\u9001\u3092\u884c\u3044\u3001\u6210\u529f\u3059\u308c\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30ed\u30b0\u3092\u51fa\u529b\u3057\u307e\u3059\u3002\n\n    $ less /var/log/messagges\n\n    Dec 13 13:20:36 localhost pdns[13016]: 1 slave domain needs checking, 0 queued for AXFR\n    Dec 13 13:20:37 localhost pdns[13016]: Received serial number updates for 1 zones, had 0 timeouts\n    Dec 13 13:20:37 localhost pdns[13016]: Domain '' is stale, master serial 2015121300, our serial 0\n    Dec 13 13:20:37 localhost pdns[13016]: Initiating transfer of '' from remote '193.0.14.129'\n    Dec 13 13:20:37 localhost pdns[13016]: Done launching threads, ready to distributequestions\n    Dec 13 13:20:37 localhost pdns[13016]: AXFR started for ''\n    Dec 13 13:20:37 localhost pdns[13016]: Transaction started for ''\n    Dec 13 13:20:39 localhost pdns[13016]: AXFR done for '', zone committed with serial number 2015121300\n\n\n### PowerDNS Recursor\n\n[PowerDNS.com](\"https://www.powerdns.com/downloads.html\")\u304b\u3089PowerDNS Recursor\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n    $ wget https://downloads.powerdns.com/releases/pdns-recursor-3.7.3.tar.bz2\n\ntarball\u3092\u5c55\u958b\u3057\u3001\u30b3\u30f3\u30d1\u30a4\u30eb\u30fb\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n    $ tar xjf pdns-recursor-3.7.3.tar.bz2\n    $ cd pdns-recursor-3.7.3\n    $ ./configure\n    $ make\n    $ sudo make install\n    $ sudo chkconfig --add pdns-recursor\n\nPowerDNS Recursor\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n    $ sudo cp /etc/powerdns/recursor.conf-dist /etc/powerdns/recursor.conf\n    $ sudo vi /etc/powerdns/recursor.conf\n\n\u6b21\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n* 127.0.0.0/8, 192.168.33.0/24\u304b\u3089\u306e\u554f\u3044\u5408\u308f\u305b\u3092\u8a31\u53ef\u3059\u308b\u3002\n* \u30eb\u30fc\u30c8\u30be\u30fc\u30f3(\".\")\u306f127.12.12.12\u3078\u554f\u3044\u5408\u308f\u305b\u308b\u3002\n* 127.0.0.1\u3068192.168.33.254\u3092bind\n* gid\u306fpdns\n* uid\u306fpdns\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u306f\u4ee5\u4e0b\u306e\u884c\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n    allow-from=127.0.0.0/8, 192.168.33.0/24\n    forward-zones=.=127.12.12.12\n    local-address=127.0.0.1,192.168.33.254\n    setgid=pdns\n    setuid=pdns\n\nPowerDNS Recursor\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n    $ sudo service pdns-recursor start\n    $ sudo chkconfig pdns-recursor on\n\n## \u52d5\u4f5c\u78ba\u8a8d\n\ndig\u306b\u3066\u30d5\u30eb\u30ea\u30be\u30eb\u30d0\u306e\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n    $ dig @127.0.0.1 qiita.com a\n    \n    ; <<>> DiG 9.8.2rc1-RedHat-9.8.2-0.37.rc1.el6_7.4 <<>> @127.0.0.1 qiita.com a\n    ; (1 server found)\n    ;; global options: +cmd\n    ;; Got answer:\n    ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 50249\n    ;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0\n    \n    ;; QUESTION SECTION:\n    ;qiita.com.\t\t\tIN\tA\n    \n    ;; ANSWER SECTION:\n    qiita.com.\t\t60\tIN\tA\t176.34.54.212\n    \n    ;; Query time: 555 msec\n    ;; SERVER: 127.0.0.1#53(127.0.0.1)\n    ;; WHEN: Sun Dec 13 14:20:41 2015\n    ;; MSG SIZE  rcvd: 43\n\n\ntcpdump\u306b\u3066loopback\u306eDNS\u30b5\u30fc\u30d0\u3078\u554f\u3044\u5408\u308f\u305b\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n    $ sudo tcpdump -i lo -n port 53\n    tcpdump: verbose output suppressed, use -v or -vv for full protocol decode\n    listening on lo, link-type EN10MB (Ethernet), capture size 65535 bytes\n    14:20:40.867466 IP 127.0.0.1.56788 > 127.0.0.1.domain: 50249+ A? qiita.com. (27)\n    14:20:40.867654 IP 127.12.12.12.11423 > 127.12.12.12.domain: 64624 A? qiita.com. (27)\n    14:20:40.872687 IP 127.12.12.12.domain > 127.12.12.12.11423: 64624- 0/13/13 (483)\n    14:20:41.151102 IP 127.12.12.12.45802 > 127.12.12.12.domain: 46524 A? ns-1049.awsdns-03.org. (39)\n    14:20:41.154018 IP 127.12.12.12.domain > 127.12.12.12.45802: 46524- 0/6/12 (441)\n    14:20:41.422804 IP 127.0.0.1.domain > 127.0.0.1.56788: 50249 1/0/0 A 176.34.54.212 (43)\n\n## \u6700\u5f8c\u306b\n\n\u3053\u308c\u3067\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u3068\u3057\u3066\u5229\u7528\u3067\u304d\u307e\u3059\u3002\u305f\u3060\u3057\u3001PowerDNS Recursor 3.7.3\u306b\u306fDNSSEC Validation\u306e\u6a5f\u80fd\u306f\u3042\u308a\u307e\u305b\u3093\u306e\u3067\u3001\u5fc5\u8981\u306a\u5834\u5408\u306funbound\u306a\u3069\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n", "tags": ["PowerDNS", "dns"]}