{"context": "Win32API\u3092\u4f7f\u3063\u3066VBA\u3067\u30ab\u30e9\u30fc\u30c0\u30a4\u30a2\u30ed\u30b0\u30dc\u30c3\u30af\u30b9\u3092\u8868\u793a\u3057\u3066\u307f\u305f\u3002\n\n\nMicrosoft\u516c\u5f0f\u3088\u308a\n\nVBA\u7528\u8a18\u8ff0\nVBA 7.x \u7528\u306e\u8a18\u8ff0 \u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u306eWin32API_PtrSafe.TXT\u518515426-15448\u884c\u76ee\u3088\u308a\u629c\u7c8b\u3002\n\nType CHOOSECOLOR\n        lStructSize As Long\n        hwndOwner As LongPtr\n        hInstance As LongPtr\n        rgbResult As Long\n        lpCustColors As LongPtr\n        flags As Long\n        lCustData As LongPtr\n        lpfnHook As LongPtr\n        lpTemplateName As String\nEnd Type\nDeclare PtrSafe Function ChooseColor Lib \"comdlg32.dll\" Alias \"ChooseColorA\" (pChoosecolor As CHOOSECOLOR) As Long\nConst CC_RGBINIT = &H1\nConst CC_FULLOPEN = &H2\nConst CC_PREVENTFULLOPEN = &H4\nConst CC_SHOWHELP = &H8\nConst CC_ENABLEHOOK = &H10\nConst CC_ENABLETEMPLATE = &H20\nConst CC_ENABLETEMPLATEHANDLE = &H40\nConst CC_SOLIDCOLOR = &H80\nConst CC_ANYCOLOR = &H100\n\n\n\nMSDN\n\nAPI\u95a2\u6570\nChooseColor\n\u69cb\u9020\u4f53+\u5b9a\u6570\uff08\u82f1\u8a9e\uff09\nCHOOSECOLOR structure\n\n\n\u30e9\u30c3\u30d7\u3057\u3066\u307f\u308b\nVBA\u3067\u3082\u6271\u3044\u3084\u3059\u3044\u3088\u3046\u306b\u30e9\u30c3\u30d7\u3057\u305fShowColorDialog\u95a2\u6570\u3092\u4f5c\u6210\u3057\u305f\u3002\n\n\u52d5\u4f5c\u74b0\u5883\nVBA7\u4ee5\u4e0a\uff08MSOffice\u3067\u306f2010\u4ee5\u964d\uff09\u5fc5\u9808\u3002\nWindows\u7248 MSOffice 2013 32bit / MSOffice 2016 64bit \u3067\u52d5\u4f5c\u78ba\u8a8d\u3002\n\n\u30e9\u30c3\u30d7\u3057\u305f\u30b3\u30fc\u30c9\n\nAPI_ColorDialog.bas\nOption Explicit\n\n'WinAPIChooseColor\u8868\u793a\u72b6\u614b\u8a2d\u5b9a\u7528\u30d5\u30e9\u30b0\n'\u666e\u6bb5\u4f7f\u308f\u306a\u305d\u3046\u306a\u3082\u306e\u306f\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\nPublic Enum CColor\n    CC_RGBINIT = &H1                '\u958b\u3044\u305f\u3068\u304d\u306b\u6700\u3082\u8fd1\u3044\u8272\u3092\u9078\u629e\u3057\u3066\u304a\u304f\u3002\u672a\u6307\u5b9a\u3067\u306f\u9ed2\u3002\n    CC_FULLOPEN = &H2               '\u6700\u521d\u304b\u3089\"\u8272\u306e\u4f5c\u6210\"\u3092\u62bc\u3057\u305f\u72b6\u614b\u3067\u958b\u304f\u3002\n    CC_PREVENTFULLOPEN = &H4        '\"\u8272\u306e\u4f5c\u6210\"\u3092\u62bc\u305b\u306a\u304f\u306a\u308b\u3002CC_FULLOPEN\u304c\u512a\u5148\u3002\n    'CC_SHOWHELP = &H8               '\u30d8\u30eb\u30d7\u30dc\u30bf\u30f3\u3092\u8868\u793a\u3002\n    'CC_ENABLEHOOK = &H10            '\u52d5\u4f5c\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u7528\u3002\n    'CC_ENABLETEMPLATE = &H20        '\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u6307\u5b9a\u7528\u3002\n    'CC_ENABLETEMPLATEHANDLE = &H40  '\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u6307\u5b9a\u7528\u3002\n    'CC_SOLIDCOLOR = &H80            'CC_ANYCOLOR\u3068\u95a2\u9023\uff1f\u3002\u9055\u3044\u304c\u4e0d\u660e\u3002\n    'CC_ANYCOLOR = &H100             'CC_SOLIDCOLOR\u3068\u95a2\u9023\uff1f\u9055\u3044\u304c\u4e0d\u660e\u3002\u8272\u306e\u3068\u3053\u308d\u306b\u7d14\u8272\u304c\u8868\u793a\u3055\u308c\u308b\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\uff09\u3002\nEnd Enum\n\n'WinAPIChooseColor\u7528\u69cb\u9020\u4f53\nPrivate Type CHOOSECOLOR\n    lStructSize As Long         '\u69cb\u9020\u4f53\u306e\u5927\u304d\u3055\uff08\u30d0\u30a4\u30c8\u5358\u4f4d\uff09\u3002\n    hwndOwner As LongPtr        '\u89aa\u30a6\u30a3\u30f3\u30c9\u30a6\u306e\u30cf\u30f3\u30c9\u30eb\u30020\u53ef\u3002\n    hInstance As LongPtr        '\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u95a2\u9023\u3002\n    rgbResult As Long           '\u30c0\u30a4\u30a2\u30ed\u30b0\u3092\u958b\u3044\u305f\u3068\u304d\u306e\u521d\u671f\u8272\uff06\u623b\u308a\u5024\u306e\u8272\u3002\n    lpCustColors As LongPtr     '\u300c\u4f5c\u6210\u3057\u305f\u8272\u300d\u306b\u8868\u793a\u3059\u308b\u8272\u3092\u5165\u308c\u305f\u914d\u5217\u306e\u30dd\u30a4\u30f3\u30bf\u3002\n    flags As CColor             '\u5404\u7a2e\u30d5\u30e9\u30b0\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3002\n    lCustData As LongPtr        'CC_ENABLEHOOK\u95a2\u9023\u3002\n    lpfnHook As LongPtr         'CC_ENABLEHOOK\u95a2\u9023\u3002\n    lpTemplateName As String    '\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u95a2\u9023\u3002\nEnd Type\n\nPrivate Declare PtrSafe Function _\n    WinAPIChooseColor Lib \"comdlg32.dll\" Alias \"ChooseColorA\" ( _\n        ByRef pChoosecolor As CHOOSECOLOR) _\n        As Long\n\n'Win32API\u306e\u30ab\u30e9\u30fc\u30c0\u30a4\u30a2\u30ed\u30b0\u3092\u8868\u793a\u3002\n'\u5f15\u6570\n    'oPickedColor   \uff1a\u623b\u308a\u5024\u7528\u3002\u9078\u629e\u3055\u308c\u305f\u8272\u304c\u5165\u308b\u3002\u30ad\u30e3\u30f3\u30bb\u30eb\u6642\u306f\u5909\u66f4\u7121\u3057\u3002\n    'Hwnd           \uff1a\u7701\u7565\u53ef\u3002\u89aa\u30a6\u30a3\u30f3\u30c9\u30a6\u306e\u30cf\u30f3\u30c9\u30eb\u3002Excel\u306a\u3089Excel.Application.Hwnd\u3067\u53d6\u5f97\u53ef\u80fd\u3002\n    'Flag           \uff1a\u7701\u7565\u53ef\u3002\u30c0\u30a4\u30a2\u30ed\u30b0\u306e\u8868\u793a\u72b6\u614b\u3002\n\n'\u623b\u308a\u5024\n    '\u30c0\u30a4\u30a2\u30ed\u30b0\u3067OK\u304c\u62bc\u3055\u308c\u305f\u6642\u306fTrue\u3001\u30ad\u30e3\u30f3\u30bb\u30eb\u6642\u306fFalse\u3002\n\nPublic Function ShowColorDialog( _\n        ByRef oPickedColor As Long, _\n        Optional ByVal Hwnd As LongPtr = 0, _\n        Optional ByVal Flag As CColor = CC_RGBINIT + CC_FULLOPEN) As Boolean\n\n    '\u300c\u4f5c\u6210\u3057\u305f\u8272\u300d\u306b\u8868\u793a\u3059\u308b\u7528\u306e\u8272\u306e\u914d\u5217\u3002\n        '\u30e6\u30fc\u30b6\u30fc\u304c\u4f5c\u6210\u3057\u305f\u8272\u3092\u4fdd\u5b58\u3059\u308b\u305f\u3081\u3001\u9759\u7684\u5909\u6570\u3067\u5ba3\u8a00\u3002\n    Static makedColors(0 To 15) As Long\n\n    '\u300c\u4f5c\u6210\u3057\u305f\u8272\u300d\u306e5\u8272\u76ee\uff5e16\u8272\u76ee\u306b\n    'MS Office\u306e\u4eca\u958b\u3044\u3066\u3044\u308b\u30d5\u30a1\u30a4\u30eb\u30c6\u30fc\u30de\u30ab\u30e9\u30fc\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n    'Word\u30fbExcel\u30fbPowerPoint\u3067\u78ba\u8a8d\u3002\u30db\u30b9\u30c8\u304c\u305d\u308c\u4ee5\u5916\u306e\u5834\u5408\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u63a8\u5968\u3002\n    On Error Resume Next\n        Call SetThemeColors(makedColors, ActiveOfficeFileTheme(Application))\n    On Error GoTo 0\n\n    Dim ccStruct As CHOOSECOLOR\n    With ccStruct\n        .lStructSize = LenB(ccStruct)   'VBA.LenB\u4e0d\u53ef\n        .hwndOwner = Hwnd\n        .rgbResult = oPickedColor\n        .lpCustColors = VBA.VarPtr(makedColors(LBound(makedColors)))\n        .flags = Flag\n    End With    'ccStruct\n\n    If WinAPIChooseColor(ccStruct) = 0 Then\n        Let ShowColorDialog = False\n    Else\n        Let oPickedColor = ccStruct.rgbResult\n        Let ShowColorDialog = True\n    End If\nEnd Function\n\n\nPrivate Sub SetThemeColors(ByRef oColors() As Long, ByVal iTheme As Office.OfficeTheme)\n    Dim arrSize As Long\n    arrSize = UBound(oColors) - LBound(oColors) + 1\n\n    Dim myThemeColorScheme As Office.ThemeColorScheme\n    Set myThemeColorScheme = iTheme.ThemeColorScheme\n\n    If arrSize < myThemeColorScheme.Count Then\n        Call Err.Raise(vbObjectError, \"SetThemeColors\", \"\u914d\u5217\u304c\u5c0f\u3055\u3059\u304e\u307e\u3059\u3002\")\n    End If\n\n    Dim i As Long\n    Dim colorIndex As Long: colorIndex = 0\n    For i = UBound(oColors) - myThemeColorScheme.Count + 1 To UBound(oColors)\n        colorIndex = colorIndex + 1\n        oColors(i) = myThemeColorScheme.Colors(colorIndex).RGB\n    Next i\nEnd Sub\n\nPrivate Function ActiveOfficeFileTheme(ByVal OfficeApp As Object) As Office.OfficeTheme\n\n    If VBA.TypeName(OfficeApp) <> \"Application\" Then GoTo Fail\n\n    On Error GoTo Fail\n        Select Case OfficeApp.Name\n            Case \"Microsoft Excel\"\n                Set ActiveOfficeFileTheme = OfficeApp.ActiveWorkbook.Theme\n            Case \"Microsoft PowerPoint\"\n                Set ActiveOfficeFileTheme = OfficeApp.ActivePresentation.SlideMaster.Theme\n            Case \"Microsoft Word\"\n                Set ActiveOfficeFileTheme = OfficeApp.ActiveDocument.DocumentTheme\n            Case Else\n                GoTo Fail\n        End Select\n    On Error GoTo 0\nExit Function\nFail:\n    On Error GoTo 0\nCall Err.Raise(vbObjectError, , \"\u975e\u5bfe\u5fdc\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u3059\u3002\")\nExit Function\n\nEnd Function\n\n\n\n\u78ba\u8a8d\u7528\u30b3\u30fc\u30c9\nSub TestShowColorDialog()\n    Dim getColor As Long\n    getColor = VBA.RGB(64, 255, 64)\n    If ShowColorDialog(getColor) Then\n        Debug.Print VBA.Hex$(getColor)\n    End If\nEnd Sub\n\n\n\u6ce8\u610f\u70b9\nSetThemeColors\u53ca\u3073\u3001ActiveOfficeFileTheme\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u3092\u4f7f\u7528\u3057\u3066\u4eca\u958b\u3044\u3066\u3044\u308bOffice\u30d5\u30a1\u30a4\u30eb\u306e\u30c6\u30fc\u30de\u30ab\u30e9\u30fc\u3092\u53d6\u5f97\u3057\u3066\u3044\u308b\u304c\u3001Word\u30fbExcel\u30fbPowerPoint\u4ee5\u5916\u3067\u306f\u52d5\u4f5c\u3057\u306a\u3044\u3002\n\u305d\u306e\u305f\u3081\u305d\u308c\u4ee5\u5916\u306e\u30db\u30b9\u30c8\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u3001\u8a72\u5f53\u7b87\u6240\u306e\u524a\u9664\u3092\u63a8\u5968\u3002\n\n\u30cf\u30de\u3063\u305f\u3068\u3053\u308d\n\nCHOOSECOLOR\u69cb\u9020\u4f53\u306elpCustColors\u306b\u6307\u5b9a\u3059\u308b\u3082\u306e\n\u3044\u304f\u3064\u304b\u306b\u53c2\u8003\u306b\u3057\u305f\u30b5\u30a4\u30c8\u304c\u306a\u305c\u304bString\u578b\u3067\u5ba3\u8a00\u3057\u3066\u3044\u3066\u9762\u98df\u3089\u3063\u305f\uff08\u300c\u4f5c\u6210\u3057\u305f\u8272\u300d\u914d\u5217\u3078\u306e\u30dd\u30a4\u30f3\u30bf\u3092\u6307\u5b9a\u3059\u308b\u7b87\u6240\uff09\u3002\nVBA\u306eString\u578b\u306fByte\u914d\u5217\u3078\u306e\u30dd\u30a4\u30f3\u30bf\u306e\u306f\u305a\u306a\u306e\u3067\u3001\u7d50\u679c\u7684\u306b\u914d\u5217\u3078\u306e\u30dd\u30a4\u30f3\u30bf\u3068\u3057\u3066\u6a5f\u80fd\u3055\u305b\u305f\u3001\u3068\u3044\u3046\u4e8b\u306a\u306e\u3060\u3068\u601d\u308f\u308c\u308b\u3002\nC\u8a00\u8a9e\u306e\u914d\u5217\u306e\u30dd\u30a4\u30f3\u30bf\u306f\u3001\u914d\u5217\u5148\u982d\u8981\u7d20\u3078\u306e\u30dd\u30a4\u30f3\u30bf\u306e\u306f\u305a\u306a\u306e\u3067\u3001\nVBA\u3067\u306fVBA.VarPtr(makedColors(LBound(makedColors)))\u3068\u3059\u308c\u3070\u5fc5\u8981\u306a\u30dd\u30a4\u30f3\u30bf\u304c\u53d6\u5f97\u3067\u304d\u308b\u3002\n\nLenB\u95a2\u6570\nVBA.\uff5e\u306e\u3088\u3046\u306b\u30d7\u30ea\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u5b9f\u884c\u3067\u304d\u306a\u3044\u3002\n\u30d7\u30ea\u30d5\u30a3\u30c3\u30af\u30b9\u7121\u3057\u306a\u3089\u554f\u984c\u7121\u304f\u30e6\u30fc\u30b6\u30fc\u5b9a\u7fa9\u578b\u306e\u5927\u304d\u3055\u3092\u53d6\u5f97\u3067\u304d\u308b\u3002\n\n\u5ba3\u4f1d\n\u8272\u95a2\u9023\u3067\u3053\u3061\u3089\u3082\u3069\u3046\u305e\n24bit\u30ab\u30e9\u30fc\u3092RGB\u306b\u5206\u89e3\u3059\u308b\n\n\u53c2\u8003\n\nMSDN\n\nAPI\u95a2\u6570\nChooseColor\n\u69cb\u9020\u4f53+\u5b9a\u6570\uff08\u82f1\u8a9e\uff09\nCHOOSECOLOR structure\n\n\n\u305d\u306e\u4ed6\n\nVBA32bit\u7528\n\u30ab\u30e9\u30fc\u30c0\u30a4\u30a2\u30ed\u30b0\uff08API\uff09\u306e\u4f7f\u7528 \uff1a Excel(\u30a8\u30af\u30bb\u30eb)\nC\u8a00\u8a9e\u3067\u4f7f\u7528\u3059\u308b\u5834\u5408\u306e\u89e3\u8aac\nUNICODE \u7248\u30ab\u30ec\u30f3\u30c0\u30fc\u30bd\u30d5\u30c8\u3092\uff11\u304b\u3089\u4f5c\u308b \u7b2c21\u7ae0  \u30b3\u30e2\u30f3\u30c0\u30a4\u30a2\u30ed\u30b0\u3092\u4f7f\u3063\u3066\u80cc\u666f\u8272\u3092\u5909\u66f4\u3059\u308b\nstackoverflow \uff08\u82f1\u8a9e\uff0964bit\u3067\u4f7f\u7528\u3059\u308b\u5834\u5408\u306e\u30e6\u30fc\u30b6\u30fc\u5b9a\u7fa9\u578b\u306e\u5927\u304d\u3055\u306b\u3064\u3044\u3066\u3002\nExcel 64-bit and comdlg32.dll custom colours\n\nWin32API\u3092\u4f7f\u3063\u3066VBA\u3067\u30ab\u30e9\u30fc\u30c0\u30a4\u30a2\u30ed\u30b0\u30dc\u30c3\u30af\u30b9\u3092\u8868\u793a\u3057\u3066\u307f\u305f\u3002\n\n![ccdialog.PNG](https://qiita-image-store.s3.amazonaws.com/0/142842/3d0cc3ae-8ee3-465e-dc9c-179dec64d9c2.png)\n\n# Microsoft\u516c\u5f0f\u3088\u308a\n\n## VBA\u7528\u8a18\u8ff0\n\n[VBA 7.x \u7528\u306e\u8a18\u8ff0 \u30ea\u30d5\u30a1\u30ec\u30f3\u30b9](http://qiita.com/nukie_53/items/6a88ce82565e238a3c71#vba-7x-%E7%94%A8%E3%81%AE%E8%A8%98%E8%BF%B0-%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9 \"VBA 7.x \u7528\u306e\u8a18\u8ff0 \u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\")\u306eWin32API_PtrSafe.TXT\u518515426-15448\u884c\u76ee\u3088\u308a\u629c\u7c8b\u3002\n\n>```vbnet\nType CHOOSECOLOR\n        lStructSize As Long\n        hwndOwner As LongPtr\n        hInstance As LongPtr\n        rgbResult As Long\n        lpCustColors As LongPtr\n        flags As Long\n        lCustData As LongPtr\n        lpfnHook As LongPtr\n        lpTemplateName As String\nEnd Type\nDeclare PtrSafe Function ChooseColor Lib \"comdlg32.dll\" Alias \"ChooseColorA\" (pChoosecolor As CHOOSECOLOR) As Long\nConst CC_RGBINIT = &H1\nConst CC_FULLOPEN = &H2\nConst CC_PREVENTFULLOPEN = &H4\nConst CC_SHOWHELP = &H8\nConst CC_ENABLEHOOK = &H10\nConst CC_ENABLETEMPLATE = &H20\nConst CC_ENABLETEMPLATEHANDLE = &H40\nConst CC_SOLIDCOLOR = &H80\nConst CC_ANYCOLOR = &H100\n```\n\n## MSDN\n\n>API\u95a2\u6570\n[ChooseColor][ChooseColor]\n\n>\u69cb\u9020\u4f53+\u5b9a\u6570\uff08\u82f1\u8a9e\uff09\n[CHOOSECOLOR structure][CHOOSECOLOR structure]\n\n\n[ChooseColor]:https://msdn.microsoft.com/ja-jp/library/cc410660.aspx \"ChooseColor\"\n[CHOOSECOLOR structure]:https://msdn.microsoft.com/ja-jp/library/ms646830.aspx \"CHOOSECOLOR structure\"\n\n\n# \u30e9\u30c3\u30d7\u3057\u3066\u307f\u308b\n\nVBA\u3067\u3082\u6271\u3044\u3084\u3059\u3044\u3088\u3046\u306b\u30e9\u30c3\u30d7\u3057\u305f`ShowColorDialog`\u95a2\u6570\u3092\u4f5c\u6210\u3057\u305f\u3002\n\n## \u52d5\u4f5c\u74b0\u5883\nVBA7\u4ee5\u4e0a\uff08MSOffice\u3067\u306f2010\u4ee5\u964d\uff09\u5fc5\u9808\u3002\nWindows\u7248 MSOffice 2013 32bit / MSOffice 2016 64bit \u3067\u52d5\u4f5c\u78ba\u8a8d\u3002\n\n## \u30e9\u30c3\u30d7\u3057\u305f\u30b3\u30fc\u30c9\n\n```vbnet:API_ColorDialog.bas\nOption Explicit\n\n'WinAPIChooseColor\u8868\u793a\u72b6\u614b\u8a2d\u5b9a\u7528\u30d5\u30e9\u30b0\n'\u666e\u6bb5\u4f7f\u308f\u306a\u305d\u3046\u306a\u3082\u306e\u306f\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\nPublic Enum CColor\n    CC_RGBINIT = &H1                '\u958b\u3044\u305f\u3068\u304d\u306b\u6700\u3082\u8fd1\u3044\u8272\u3092\u9078\u629e\u3057\u3066\u304a\u304f\u3002\u672a\u6307\u5b9a\u3067\u306f\u9ed2\u3002\n    CC_FULLOPEN = &H2               '\u6700\u521d\u304b\u3089\"\u8272\u306e\u4f5c\u6210\"\u3092\u62bc\u3057\u305f\u72b6\u614b\u3067\u958b\u304f\u3002\n    CC_PREVENTFULLOPEN = &H4        '\"\u8272\u306e\u4f5c\u6210\"\u3092\u62bc\u305b\u306a\u304f\u306a\u308b\u3002CC_FULLOPEN\u304c\u512a\u5148\u3002\n    'CC_SHOWHELP = &H8               '\u30d8\u30eb\u30d7\u30dc\u30bf\u30f3\u3092\u8868\u793a\u3002\n    'CC_ENABLEHOOK = &H10            '\u52d5\u4f5c\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u7528\u3002\n    'CC_ENABLETEMPLATE = &H20        '\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u6307\u5b9a\u7528\u3002\n    'CC_ENABLETEMPLATEHANDLE = &H40  '\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u6307\u5b9a\u7528\u3002\n    'CC_SOLIDCOLOR = &H80            'CC_ANYCOLOR\u3068\u95a2\u9023\uff1f\u3002\u9055\u3044\u304c\u4e0d\u660e\u3002\n    'CC_ANYCOLOR = &H100             'CC_SOLIDCOLOR\u3068\u95a2\u9023\uff1f\u9055\u3044\u304c\u4e0d\u660e\u3002\u8272\u306e\u3068\u3053\u308d\u306b\u7d14\u8272\u304c\u8868\u793a\u3055\u308c\u308b\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\uff09\u3002\nEnd Enum\n\n'WinAPIChooseColor\u7528\u69cb\u9020\u4f53\nPrivate Type CHOOSECOLOR\n    lStructSize As Long         '\u69cb\u9020\u4f53\u306e\u5927\u304d\u3055\uff08\u30d0\u30a4\u30c8\u5358\u4f4d\uff09\u3002\n    hwndOwner As LongPtr        '\u89aa\u30a6\u30a3\u30f3\u30c9\u30a6\u306e\u30cf\u30f3\u30c9\u30eb\u30020\u53ef\u3002\n    hInstance As LongPtr        '\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u95a2\u9023\u3002\n    rgbResult As Long           '\u30c0\u30a4\u30a2\u30ed\u30b0\u3092\u958b\u3044\u305f\u3068\u304d\u306e\u521d\u671f\u8272\uff06\u623b\u308a\u5024\u306e\u8272\u3002\n    lpCustColors As LongPtr     '\u300c\u4f5c\u6210\u3057\u305f\u8272\u300d\u306b\u8868\u793a\u3059\u308b\u8272\u3092\u5165\u308c\u305f\u914d\u5217\u306e\u30dd\u30a4\u30f3\u30bf\u3002\n    flags As CColor             '\u5404\u7a2e\u30d5\u30e9\u30b0\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3002\n    lCustData As LongPtr        'CC_ENABLEHOOK\u95a2\u9023\u3002\n    lpfnHook As LongPtr         'CC_ENABLEHOOK\u95a2\u9023\u3002\n    lpTemplateName As String    '\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u95a2\u9023\u3002\nEnd Type\n\nPrivate Declare PtrSafe Function _\n    WinAPIChooseColor Lib \"comdlg32.dll\" Alias \"ChooseColorA\" ( _\n        ByRef pChoosecolor As CHOOSECOLOR) _\n        As Long\n\n'Win32API\u306e\u30ab\u30e9\u30fc\u30c0\u30a4\u30a2\u30ed\u30b0\u3092\u8868\u793a\u3002\n'\u5f15\u6570\n    'oPickedColor   \uff1a\u623b\u308a\u5024\u7528\u3002\u9078\u629e\u3055\u308c\u305f\u8272\u304c\u5165\u308b\u3002\u30ad\u30e3\u30f3\u30bb\u30eb\u6642\u306f\u5909\u66f4\u7121\u3057\u3002\n    'Hwnd           \uff1a\u7701\u7565\u53ef\u3002\u89aa\u30a6\u30a3\u30f3\u30c9\u30a6\u306e\u30cf\u30f3\u30c9\u30eb\u3002Excel\u306a\u3089Excel.Application.Hwnd\u3067\u53d6\u5f97\u53ef\u80fd\u3002\n    'Flag           \uff1a\u7701\u7565\u53ef\u3002\u30c0\u30a4\u30a2\u30ed\u30b0\u306e\u8868\u793a\u72b6\u614b\u3002\n    \n'\u623b\u308a\u5024\n    '\u30c0\u30a4\u30a2\u30ed\u30b0\u3067OK\u304c\u62bc\u3055\u308c\u305f\u6642\u306fTrue\u3001\u30ad\u30e3\u30f3\u30bb\u30eb\u6642\u306fFalse\u3002\n\nPublic Function ShowColorDialog( _\n        ByRef oPickedColor As Long, _\n        Optional ByVal Hwnd As LongPtr = 0, _\n        Optional ByVal Flag As CColor = CC_RGBINIT + CC_FULLOPEN) As Boolean\n    \n    '\u300c\u4f5c\u6210\u3057\u305f\u8272\u300d\u306b\u8868\u793a\u3059\u308b\u7528\u306e\u8272\u306e\u914d\u5217\u3002\n        '\u30e6\u30fc\u30b6\u30fc\u304c\u4f5c\u6210\u3057\u305f\u8272\u3092\u4fdd\u5b58\u3059\u308b\u305f\u3081\u3001\u9759\u7684\u5909\u6570\u3067\u5ba3\u8a00\u3002\n    Static makedColors(0 To 15) As Long\n    \n    '\u300c\u4f5c\u6210\u3057\u305f\u8272\u300d\u306e5\u8272\u76ee\uff5e16\u8272\u76ee\u306b\n    'MS Office\u306e\u4eca\u958b\u3044\u3066\u3044\u308b\u30d5\u30a1\u30a4\u30eb\u30c6\u30fc\u30de\u30ab\u30e9\u30fc\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n    'Word\u30fbExcel\u30fbPowerPoint\u3067\u78ba\u8a8d\u3002\u30db\u30b9\u30c8\u304c\u305d\u308c\u4ee5\u5916\u306e\u5834\u5408\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u63a8\u5968\u3002\n    On Error Resume Next\n        Call SetThemeColors(makedColors, ActiveOfficeFileTheme(Application))\n    On Error GoTo 0\n    \n    Dim ccStruct As CHOOSECOLOR\n    With ccStruct\n        .lStructSize = LenB(ccStruct)   'VBA.LenB\u4e0d\u53ef\n        .hwndOwner = Hwnd\n        .rgbResult = oPickedColor\n        .lpCustColors = VBA.VarPtr(makedColors(LBound(makedColors)))\n        .flags = Flag\n    End With    'ccStruct\n    \n    If WinAPIChooseColor(ccStruct) = 0 Then\n        Let ShowColorDialog = False\n    Else\n        Let oPickedColor = ccStruct.rgbResult\n        Let ShowColorDialog = True\n    End If\nEnd Function\n\n\nPrivate Sub SetThemeColors(ByRef oColors() As Long, ByVal iTheme As Office.OfficeTheme)\n    Dim arrSize As Long\n    arrSize = UBound(oColors) - LBound(oColors) + 1\n    \n    Dim myThemeColorScheme As Office.ThemeColorScheme\n    Set myThemeColorScheme = iTheme.ThemeColorScheme\n    \n    If arrSize < myThemeColorScheme.Count Then\n        Call Err.Raise(vbObjectError, \"SetThemeColors\", \"\u914d\u5217\u304c\u5c0f\u3055\u3059\u304e\u307e\u3059\u3002\")\n    End If\n    \n    Dim i As Long\n    Dim colorIndex As Long: colorIndex = 0\n    For i = UBound(oColors) - myThemeColorScheme.Count + 1 To UBound(oColors)\n        colorIndex = colorIndex + 1\n        oColors(i) = myThemeColorScheme.Colors(colorIndex).RGB\n    Next i\nEnd Sub\n\nPrivate Function ActiveOfficeFileTheme(ByVal OfficeApp As Object) As Office.OfficeTheme\n    \n    If VBA.TypeName(OfficeApp) <> \"Application\" Then GoTo Fail\n    \n    On Error GoTo Fail\n        Select Case OfficeApp.Name\n            Case \"Microsoft Excel\"\n                Set ActiveOfficeFileTheme = OfficeApp.ActiveWorkbook.Theme\n            Case \"Microsoft PowerPoint\"\n                Set ActiveOfficeFileTheme = OfficeApp.ActivePresentation.SlideMaster.Theme\n            Case \"Microsoft Word\"\n                Set ActiveOfficeFileTheme = OfficeApp.ActiveDocument.DocumentTheme\n            Case Else\n                GoTo Fail\n        End Select\n    On Error GoTo 0\nExit Function\nFail:\n    On Error GoTo 0\nCall Err.Raise(vbObjectError, , \"\u975e\u5bfe\u5fdc\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u3059\u3002\")\nExit Function\n    \nEnd Function\n```\n\n## \u78ba\u8a8d\u7528\u30b3\u30fc\u30c9\n\n```vbnet\nSub TestShowColorDialog()\n    Dim getColor As Long\n    getColor = VBA.RGB(64, 255, 64)\n    If ShowColorDialog(getColor) Then\n        Debug.Print VBA.Hex$(getColor)\n    End If\nEnd Sub\n```\n\n## \u6ce8\u610f\u70b9\n\n`SetThemeColors`\u53ca\u3073\u3001`ActiveOfficeFileTheme`\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u3092\u4f7f\u7528\u3057\u3066\u4eca\u958b\u3044\u3066\u3044\u308bOffice\u30d5\u30a1\u30a4\u30eb\u306e\u30c6\u30fc\u30de\u30ab\u30e9\u30fc\u3092\u53d6\u5f97\u3057\u3066\u3044\u308b\u304c\u3001Word\u30fbExcel\u30fbPowerPoint\u4ee5\u5916\u3067\u306f\u52d5\u4f5c\u3057\u306a\u3044\u3002\n\n\u305d\u306e\u305f\u3081\u305d\u308c\u4ee5\u5916\u306e\u30db\u30b9\u30c8\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u3001\u8a72\u5f53\u7b87\u6240\u306e\u524a\u9664\u3092\u63a8\u5968\u3002\n\n## \u30cf\u30de\u3063\u305f\u3068\u3053\u308d\n\n### CHOOSECOLOR\u69cb\u9020\u4f53\u306e`lpCustColors`\u306b\u6307\u5b9a\u3059\u308b\u3082\u306e\n\n\u3044\u304f\u3064\u304b\u306b\u53c2\u8003\u306b\u3057\u305f\u30b5\u30a4\u30c8\u304c\u306a\u305c\u304bString\u578b\u3067\u5ba3\u8a00\u3057\u3066\u3044\u3066\u9762\u98df\u3089\u3063\u305f\uff08\u300c\u4f5c\u6210\u3057\u305f\u8272\u300d\u914d\u5217\u3078\u306e\u30dd\u30a4\u30f3\u30bf\u3092\u6307\u5b9a\u3059\u308b\u7b87\u6240\uff09\u3002\nVBA\u306eString\u578b\u306fByte\u914d\u5217\u3078\u306e\u30dd\u30a4\u30f3\u30bf\u306e\u306f\u305a\u306a\u306e\u3067\u3001\u7d50\u679c\u7684\u306b\u914d\u5217\u3078\u306e\u30dd\u30a4\u30f3\u30bf\u3068\u3057\u3066\u6a5f\u80fd\u3055\u305b\u305f\u3001\u3068\u3044\u3046\u4e8b\u306a\u306e\u3060\u3068\u601d\u308f\u308c\u308b\u3002\n\nC\u8a00\u8a9e\u306e\u914d\u5217\u306e\u30dd\u30a4\u30f3\u30bf\u306f\u3001\u914d\u5217\u5148\u982d\u8981\u7d20\u3078\u306e\u30dd\u30a4\u30f3\u30bf\u306e\u306f\u305a\u306a\u306e\u3067\u3001\nVBA\u3067\u306f`VBA.VarPtr(makedColors(LBound(makedColors)))`\u3068\u3059\u308c\u3070\u5fc5\u8981\u306a\u30dd\u30a4\u30f3\u30bf\u304c\u53d6\u5f97\u3067\u304d\u308b\u3002\n\n### LenB\u95a2\u6570\n\n`VBA.\uff5e`\u306e\u3088\u3046\u306b\u30d7\u30ea\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u5b9f\u884c\u3067\u304d\u306a\u3044\u3002\n\u30d7\u30ea\u30d5\u30a3\u30c3\u30af\u30b9\u7121\u3057\u306a\u3089\u554f\u984c\u7121\u304f\u30e6\u30fc\u30b6\u30fc\u5b9a\u7fa9\u578b\u306e\u5927\u304d\u3055\u3092\u53d6\u5f97\u3067\u304d\u308b\u3002\n\n## \u5ba3\u4f1d\n\n\u8272\u95a2\u9023\u3067\u3053\u3061\u3089\u3082\u3069\u3046\u305e\n[24bit\u30ab\u30e9\u30fc\u3092RGB\u306b\u5206\u89e3\u3059\u308b](http://qiita.com/nukie_53/items/4fd224e6931673801757 \"24bit\u30ab\u30e9\u30fc\u3092RGB\u306b\u5206\u89e3\u3059\u308b\")\n\n\n# \u53c2\u8003\n\n## MSDN\n\n>API\u95a2\u6570\n[ChooseColor][ChooseColor]\n\n>\u69cb\u9020\u4f53+\u5b9a\u6570\uff08\u82f1\u8a9e\uff09\n[CHOOSECOLOR structure][CHOOSECOLOR structure]\n\n## \u305d\u306e\u4ed6\n> VBA32bit\u7528\n> [\u30ab\u30e9\u30fc\u30c0\u30a4\u30a2\u30ed\u30b0\uff08API\uff09\u306e\u4f7f\u7528 \uff1a Excel(\u30a8\u30af\u30bb\u30eb)](http://www.excel-excel.com/tips/vba_70.html \"\u30ab\u30e9\u30fc\u30c0\u30a4\u30a2\u30ed\u30b0\uff08API\uff09\u306e\u4f7f\u7528 \uff1a Excel(\u30a8\u30af\u30bb\u30eb)\")\n\n> C\u8a00\u8a9e\u3067\u4f7f\u7528\u3059\u308b\u5834\u5408\u306e\u89e3\u8aac\n>[UNICODE \u7248\u30ab\u30ec\u30f3\u30c0\u30fc\u30bd\u30d5\u30c8\u3092\uff11\u304b\u3089\u4f5c\u308b \u7b2c21\u7ae0  \u30b3\u30e2\u30f3\u30c0\u30a4\u30a2\u30ed\u30b0\u3092\u4f7f\u3063\u3066\u80cc\u666f\u8272\u3092\u5909\u66f4\u3059\u308b](http://www.geocities.jp/midorinopage/Beginner/beginner21.html \"UNICODE \u7248\u30ab\u30ec\u30f3\u30c0\u30fc\u30bd\u30d5\u30c8\u3092\uff11\u304b\u3089\u4f5c\u308b\n\u7b2c21\u7ae0  \u30b3\u30e2\u30f3\u30c0\u30a4\u30a2\u30ed\u30b0\u3092\u4f7f\u3063\u3066\u80cc\u666f\u8272\u3092\u5909\u66f4\u3059\u308b\")\n\n> stackoverflow \uff08\u82f1\u8a9e\uff0964bit\u3067\u4f7f\u7528\u3059\u308b\u5834\u5408\u306e\u30e6\u30fc\u30b6\u30fc\u5b9a\u7fa9\u578b\u306e\u5927\u304d\u3055\u306b\u3064\u3044\u3066\u3002\n> [Excel 64-bit and comdlg32.dll custom colours](http://stackoverflow.com/questions/5724396/excel-64-bit-and-comdlg32-dll-custom-colours \"Excel 64-bit and comdlg32.dll custom colours\")\n", "tags": ["VBA", "Win32API"]}