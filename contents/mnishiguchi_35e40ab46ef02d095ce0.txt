{"context": "\n\n\u65e2\u5b58\u306e\u30e2\u30c7\u30eb\n\nMoving\nRoom\n\n\u4e0a\u8a18\u306e\u30e2\u30c7\u30eb\u9593\u306bhas_many & belongs_to\u95a2\u4fc2\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n\u3084\u308a\u65b9\n\n\u5404\u30e2\u30c7\u30eb\u306e\u30c6\u30fc\u30d6\u30eb\u306b\u304a\u4e92\u3044\u306eid\u3092foreign_key\u3068\u3057\u3066\u8ffd\u52a0\u3057\u3001\u30de\u30a4\u30b0\u30ec\u30fc\u30c8\u3059\u308b\n$ rails g migration add_room_to_movings room:references\n\u4e0b\u8a18\u306e\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u304c\u751f\u6210\u3055\u308c\u308b\u3002\u9593\u9055\u3044\u304c\u306a\u3044\u304b\u78ba\u8a8d\u3002\n\n20150725142417_add_room_to_movings.rb\nclass AddRoomToMovings < ActiveRecord::Migration\n  def change\n    add_reference :movings, :room, index: true, foreign_key: true\n  end\nend\n\n\n$ rails g migration add_moving_to_rooms moving:references\n\u4e0b\u8a18\u306e\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u304c\u751f\u6210\u3055\u308c\u308b\u3002\u9593\u9055\u3044\u304c\u306a\u3044\u304b\u78ba\u8a8d\u3002\n\n20150725142845_add_moving_to_rooms.rb\nclass AddMovingToRooms < ActiveRecord::Migration\n  def change\n    add_reference :rooms, :moving, index: true, foreign_key: true\n  end\nend\n\n\n$ rake db:migrate\n\nhas_many\u3001belongs_to\u3092\u95a2\u4fc2\u3059\u308b\u30e2\u30c7\u30eb\u306e\u30af\u30e9\u30b9\u306b\u8ffd\u52a0\n\nmoving.rb\nclass Moving < ActiveRecord::Base\n  ...\n  has_many :rooms, dependent: :destroy\n  ...\n\n\n\nroom.rb\nclass Room < ActiveRecord::Base\n  ...\n  belongs_to :moving\n  ...\n\n\n\u3053\u308c\u3067\u5b8c\u4e86\u3002\n\n\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u601d\u3044\u901a\u308a\u306e\u632f\u308b\u821e\u3044\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u78ba\u8a8d\n$ rails console --sandbox\n\u8272\u3005\u8a66\u3059\u3002\u672c\u5f53\u306b\u3053\u308c\u3067\u826f\u3044\u306e\u304b\u3053\u3053\u3067\u3088\u304f\u8003\u3048\u308b\u3002\u5834\u5408\u306b\u3088\u3063\u3066\u306fhas_many, through\u3092\u4f7f\u3048\u3070\u3082\u3063\u3068\u52b9\u7387\u3088\u304f\u30c7\u30fc\u30bf\u306e\u7ba1\u7406\u304c\u3067\u304d\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\n\u6c17\u304c\u5909\u308f\u3063\u305f\u3089\u3001\u65e9\u3044\u3046\u3061\u306b\u3084\u308a\u76f4\u3059\uff08\u8a31\u3055\u308c\u308b\u306a\u3089\uff09\n$ rails destroy migration add_moving_to_rooms moving:references\n      invoke  active_record\n      remove    db/migrate/20150725142845_add_moving_to_rooms.rb\n\n$ rails destroy  migration add_room_to_movings room:references\n      invoke  active_record\n      remove    db/migrate/20150725142417_add_room_to_movings.rb\n\n\u5fd8\u308c\u305a\u306bhas_many\u3001belongs_to\u3092\u30e2\u30c7\u30eb\u306e\u30af\u30e9\u30b9\u304b\u3089\u53d6\u308a\u9664\u304f\u3053\u3068\u3002\n\u4ee5\u4e0b\u306e\u30bf\u30b9\u30af\u3067schema\u3092\u66f4\u65b0\u3059\u308b\u3002\n$ bundle exec rake db:drop\n$ bundle exec rake db:create\n$ bundle exec rake db:migrate\n$ bundle exec rake db:seed\n\n\nhas_many, through\u306b\u5909\u66f4\u3059\u308b\u3053\u3068\u306b\u3057\u305f\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u4e2d\u9593\u30c6\u30fc\u30d6\u30eb\u306e\u30af\u30e9\u30b9\u3068\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u3064\u304f\u308b\u3002\nrails g model MovingRoom moving_id:integer room_id:integer\n\n\n20150725172522_create_moving_rooms.rb\nclass CreateMovingRooms < ActiveRecord::Migration\n  def change\n    create_table :moving_rooms do |t|\n      t.integer :moving_id\n      t.integer :room_id\n\n      t.timestamps null: false\n    end\n  end\nend\n\n\n\nmoving_room.rb\nclass MovingRoom < ActiveRecord::Base\nend\n\n\n\u4e2d\u9593\u30c6\u30fc\u30d6\u30eb\u306e\u30af\u30e9\u30b9\u306bbelongs_to\u3092\u8ffd\u52a0\u3057\u3001\u30e2\u30c7\u30eb\u3092\u95a2\u9023\u3055\u305b\u308b\u3002\n\nmoving_room.rb\nclass MovingRoom < ActiveRecord::Base\n  belongs_to :moving\n  belongs_to :room\nend\n\n\n\u5404\u30e2\u30c7\u30eb\u30af\u30e9\u30b9\u306bhas_many...through...\u3092\u8ffd\u52a0\u3057\u3001\u4e2d\u9593\u30c6\u30fc\u30d6\u30eb\u7d4c\u7531\u3067\u304a\u4e92\u3044\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\nclass Moving < ActiveRecord::Base\n  ...\n  has_many :moving_rooms, dependent: :destroy\n  has_many :rooms, through: :moving_rooms\n  ...\n\nclass Room < ActiveRecord::Base\n  ...\n  has_many :moving_rooms, dependent: :destroy\n  has_many :movings, through: :moving_rooms\n  ...\n\n\u52b9\u7387\u3088\u304f\u30af\u30a8\u30ea\u3067\u304d\u308b\u3088\u3046Index\u3092\u8ffd\u52a0\n\n20150726014749_add_index_to_moving_rooms.rb\nclass AddIndexToMovingRooms < ActiveRecord::Migration\n  def change\n    add_index :moving_rooms, :moving_id\n    add_index :moving_rooms, :room_id\n    add_index :moving_rooms, [:moving_id, :room_id], unique: true\n  end\nend\n\n\n\u4ee5\u4e0a\u3002\n\n\u53c2\u8003\u8cc7\u6599\n\n\nRails4\u306ehas_many through\u3067\u591a\u5bfe\u591a\u306e\u30ea\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u88c5\u3059\u308b by @samurairunner\n\nhttp://stackoverflow.com/questions/10301794/difference-between-rake-dbmigrate-dbreset-and-dbschemaload\n\n#\u65e2\u5b58\u306e\u30e2\u30c7\u30eb\n\n- `Moving`\n- `Room`\n\n\u4e0a\u8a18\u306e\u30e2\u30c7\u30eb\u9593\u306b`has_many` & `belongs_to`\u95a2\u4fc2\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n#\u3084\u308a\u65b9\n\n##\u5404\u30e2\u30c7\u30eb\u306e\u30c6\u30fc\u30d6\u30eb\u306b\u304a\u4e92\u3044\u306eid\u3092`foreign_key`\u3068\u3057\u3066\u8ffd\u52a0\u3057\u3001\u30de\u30a4\u30b0\u30ec\u30fc\u30c8\u3059\u308b\n\n`$ rails g migration add_room_to_movings room:references`\n\u4e0b\u8a18\u306e\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u304c\u751f\u6210\u3055\u308c\u308b\u3002\u9593\u9055\u3044\u304c\u306a\u3044\u304b\u78ba\u8a8d\u3002\n\n```ruby:20150725142417_add_room_to_movings.rb\nclass AddRoomToMovings < ActiveRecord::Migration\n  def change\n    add_reference :movings, :room, index: true, foreign_key: true\n  end\nend\n```\n\n`$ rails g migration add_moving_to_rooms moving:references`\n\u4e0b\u8a18\u306e\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u304c\u751f\u6210\u3055\u308c\u308b\u3002\u9593\u9055\u3044\u304c\u306a\u3044\u304b\u78ba\u8a8d\u3002\n\n```ruby:20150725142845_add_moving_to_rooms.rb\nclass AddMovingToRooms < ActiveRecord::Migration\n  def change\n    add_reference :rooms, :moving, index: true, foreign_key: true\n  end\nend\n```\n\n`$ rake db:migrate`\n\n##`has_many`\u3001`belongs_to`\u3092\u95a2\u4fc2\u3059\u308b\u30e2\u30c7\u30eb\u306e\u30af\u30e9\u30b9\u306b\u8ffd\u52a0\n\n```ruby:moving.rb\nclass Moving < ActiveRecord::Base\n  ...\n  has_many :rooms, dependent: :destroy\n  ...\n```\n\n```ruby:room.rb\nclass Room < ActiveRecord::Base\n  ...\n  belongs_to :moving\n  ...\n```\n\n\u3053\u308c\u3067\u5b8c\u4e86\u3002\n\n##\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u601d\u3044\u901a\u308a\u306e\u632f\u308b\u821e\u3044\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u78ba\u8a8d\n`$ rails console --sandbox`\n\u8272\u3005\u8a66\u3059\u3002\u672c\u5f53\u306b\u3053\u308c\u3067\u826f\u3044\u306e\u304b\u3053\u3053\u3067\u3088\u304f\u8003\u3048\u308b\u3002\u5834\u5408\u306b\u3088\u3063\u3066\u306f`has_many`, `through`\u3092\u4f7f\u3048\u3070\u3082\u3063\u3068\u52b9\u7387\u3088\u304f\u30c7\u30fc\u30bf\u306e\u7ba1\u7406\u304c\u3067\u304d\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\n##\u6c17\u304c\u5909\u308f\u3063\u305f\u3089\u3001\u65e9\u3044\u3046\u3061\u306b\u3084\u308a\u76f4\u3059\uff08\u8a31\u3055\u308c\u308b\u306a\u3089\uff09\n\n```\n$ rails destroy migration add_moving_to_rooms moving:references\n      invoke  active_record\n      remove    db/migrate/20150725142845_add_moving_to_rooms.rb\n```\n\n```\n$ rails destroy  migration add_room_to_movings room:references\n      invoke  active_record\n      remove    db/migrate/20150725142417_add_room_to_movings.rb\n```\n\n\u5fd8\u308c\u305a\u306b`has_many`\u3001`belongs_to`\u3092\u30e2\u30c7\u30eb\u306e\u30af\u30e9\u30b9\u304b\u3089\u53d6\u308a\u9664\u304f\u3053\u3068\u3002\n\n\u4ee5\u4e0b\u306e\u30bf\u30b9\u30af\u3067schema\u3092\u66f4\u65b0\u3059\u308b\u3002\n\n```\n$ bundle exec rake db:drop\n$ bundle exec rake db:create\n$ bundle exec rake db:migrate\n$ bundle exec rake db:seed\n```\n\n##`has_many, through`\u306b\u5909\u66f4\u3059\u308b\u3053\u3068\u306b\u3057\u305f\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u4e2d\u9593\u30c6\u30fc\u30d6\u30eb\u306e\u30af\u30e9\u30b9\u3068\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u3064\u304f\u308b\u3002\n\n```\nrails g model MovingRoom moving_id:integer room_id:integer\n```\n\n```ruby:20150725172522_create_moving_rooms.rb\nclass CreateMovingRooms < ActiveRecord::Migration\n  def change\n    create_table :moving_rooms do |t|\n      t.integer :moving_id\n      t.integer :room_id\n\n      t.timestamps null: false\n    end\n  end\nend\n```\n\n```ruby:moving_room.rb\nclass MovingRoom < ActiveRecord::Base\nend\n```\n\n\u4e2d\u9593\u30c6\u30fc\u30d6\u30eb\u306e\u30af\u30e9\u30b9\u306b`belongs_to`\u3092\u8ffd\u52a0\u3057\u3001\u30e2\u30c7\u30eb\u3092\u95a2\u9023\u3055\u305b\u308b\u3002\n\n```ruby:moving_room.rb\nclass MovingRoom < ActiveRecord::Base\n  belongs_to :moving\n  belongs_to :room\nend\n```\n\n\u5404\u30e2\u30c7\u30eb\u30af\u30e9\u30b9\u306b`has_many...through...`\u3092\u8ffd\u52a0\u3057\u3001\u4e2d\u9593\u30c6\u30fc\u30d6\u30eb\u7d4c\u7531\u3067\u304a\u4e92\u3044\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n```ruby\nclass Moving < ActiveRecord::Base\n  ...\n  has_many :moving_rooms, dependent: :destroy\n  has_many :rooms, through: :moving_rooms\n  ...\n```\n```ruby\nclass Room < ActiveRecord::Base\n  ...\n  has_many :moving_rooms, dependent: :destroy\n  has_many :movings, through: :moving_rooms\n  ...\n```\n\n\u52b9\u7387\u3088\u304f\u30af\u30a8\u30ea\u3067\u304d\u308b\u3088\u3046Index\u3092\u8ffd\u52a0\n\n```ruby:20150726014749_add_index_to_moving_rooms.rb\nclass AddIndexToMovingRooms < ActiveRecord::Migration\n  def change\n    add_index :moving_rooms, :moving_id\n    add_index :moving_rooms, :room_id\n    add_index :moving_rooms, [:moving_id, :room_id], unique: true\n  end\nend\n```\n\u4ee5\u4e0a\u3002\n\n#\u53c2\u8003\u8cc7\u6599\n\n- [Rails4\u306ehas_many through\u3067\u591a\u5bfe\u591a\u306e\u30ea\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u88c5\u3059\u308b](http://qiita.com/samurairunner/items/cbd91bb9e3f8b0433b99) by @samurairunner\n- http://stackoverflow.com/questions/10301794/difference-between-rake-dbmigrate-dbreset-and-dbschemaload\n", "tags": ["Rails4", "migration", "Database", "Rails"]}