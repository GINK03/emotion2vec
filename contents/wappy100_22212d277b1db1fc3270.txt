{"context": " More than 1 year has passed since last update.\n\nrpm(mongo-10gen)\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3089\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30c8\u5165\u3063\u3066\u306a\u304b\u3063\u305f\n\u3042\u3063\u30fb\u30fb\u30fb\n$ ll -h /var/log/mongo/\n\u5408\u8a08 651M\n-rw-r----- 1 mongod mongod 651M  7\u6708 27 16:02 2015 mongod.log\n\n\nlogrotate\u3067\u3084\u3063\u3066\u307f\u308b\n\u9069\u5f53\u306b\u3084\u3063\u3066\u307f\u308b\n$ cat /etc/logrotate.d/mongo\n/var/log/mongo/mongod.log\n{\n        rotate 4\n        daily\n        missingok\n        create 0644 mongod mongod\n}\n$ logrotate -f /etc/logrotate.conf\n\n\u30ed\u30fc\u30c6\u30fc\u30c8\u5f8c\u306e 1196765 \u306e inode \u898b\u3061\u3083\u3063\u3066\u308b\n$ lsof | grep mongod.log\nmongod    28392    mongod    1w      REG                8,3        71    1196765 /var/log/mongo/mongod.log-20150727\n$ ls -li /var/log/mongo/\n\u5408\u8a08 8\n1196912 -rw-r--r-- 1 mongod mongod   0  7\u6708 27 15:11 2015 mongod.log\n1196765 -rw-r--r-- 1 mongod mongod 210  7\u6708 27 15:12 2015 mongod.log-20150727\n\n\n\u516c\u5f0f\nhttp://docs.mongodb.org/manual/tutorial/rotate-log-files/\nSIGUSR1 \u3067\u3084\u308b\u307f\u305f\u3044\u3067\u3059\n\n\u76f4\u3057\u305f\npid\u51fa\u3059\u3088\u3046\u306b\u3057\u3066\u306a\u3044\u306e\u3067killall\u3067\u3002\u51fa\u3057\u3068\u3051\u3070\u3088\u304b\u3063\u305f(\u00b4\u0414\uff40)\n$ cat /etc/logrotate.d/mongo\n/var/log/mongo/mongod.log\n{\n        rotate 4\n        daily\n        missingok\n        nocreate\n        sharedscripts\n        postrotate\n                killall -SIGUSR1 mongod >/dev/null 2>&1 || true\n        endscript\n}\n\n\n\u3082\u3046\uff11\u56de\u78ba\u8a8d\n1188640 \u306e inode \u898b\u3066\u308b\u3002\n$ ls -li /var/log/mongo/\n\u5408\u8a08 8\n1188640 -rw-r--r-- 1 mongod mongod 584  7\u6708 27 15:26 2015 mongod.log\n$ lsof | grep mongod.log\nmongod    32353    mongod    1w      REG                8,3       584    1188640 /var/log/mongo/mongod.log\n\n\u30ed\u30fc\u30c6\u30fc\u30c8\u5b9f\u884c\n$ logrotate -f /etc/logrotate.conf\n\n\u6b63\u3057\u304f\u30ed\u30fc\u30c6\u30fc\u30c8\u3067\u304d\u305f\u3002\uff081196912 \u306e inode \u3092\u898b\u3066\u308b\uff09\n$ ls -li /var/log/mongo/\n\u5408\u8a08 12\n1196912 -rw-r--r-- 1 mongod mongod  71  7\u6708 27 15:26 2015 mongod.log\n1188640 -rw-r--r-- 1 mongod mongod 584  7\u6708 27 15:26 2015 mongod.log-20150727\n$ lsof | grep mongod.log\nmongod    32353    mongod    1w      REG                8,3        71    1196912 /var/log/mongo/mongod.log\n\n\n\u53c2\u8003\u30b5\u30a4\u30c8\n\nhttp://dayafterneet.blogspot.jp/2011/07/mongodb.html\nhttp://sa3g.blogspot.jp/2011/06/mongodblogorotate.html\n\n## rpm(mongo-10gen)\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3089\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30c8\u5165\u3063\u3066\u306a\u304b\u3063\u305f\n\u3042\u3063\u30fb\u30fb\u30fb\n\n```bash\n$ ll -h /var/log/mongo/\n\u5408\u8a08 651M\n-rw-r----- 1 mongod mongod 651M  7\u6708 27 16:02 2015 mongod.log\n```\n\n## logrotate\u3067\u3084\u3063\u3066\u307f\u308b\n\n\u9069\u5f53\u306b\u3084\u3063\u3066\u307f\u308b\n\n```bash\n$ cat /etc/logrotate.d/mongo\n/var/log/mongo/mongod.log\n{\n        rotate 4\n        daily\n        missingok\n        create 0644 mongod mongod\n}\n$ logrotate -f /etc/logrotate.conf\n```\n\n\u30ed\u30fc\u30c6\u30fc\u30c8\u5f8c\u306e 1196765 \u306e inode \u898b\u3061\u3083\u3063\u3066\u308b\n\n```bash\n$ lsof | grep mongod.log\nmongod    28392    mongod    1w      REG                8,3        71    1196765 /var/log/mongo/mongod.log-20150727\n$ ls -li /var/log/mongo/\n\u5408\u8a08 8\n1196912 -rw-r--r-- 1 mongod mongod   0  7\u6708 27 15:11 2015 mongod.log\n1196765 -rw-r--r-- 1 mongod mongod 210  7\u6708 27 15:12 2015 mongod.log-20150727\n```\n\n## \u516c\u5f0f\n\nhttp://docs.mongodb.org/manual/tutorial/rotate-log-files/\nSIGUSR1 \u3067\u3084\u308b\u307f\u305f\u3044\u3067\u3059\n\n## \u76f4\u3057\u305f\n\npid\u51fa\u3059\u3088\u3046\u306b\u3057\u3066\u306a\u3044\u306e\u3067`killall`\u3067\u3002\u51fa\u3057\u3068\u3051\u3070\u3088\u304b\u3063\u305f(\u00b4\u0414\uff40)\n\n```bash\n$ cat /etc/logrotate.d/mongo\n/var/log/mongo/mongod.log\n{\n        rotate 4\n        daily\n        missingok\n        nocreate\n        sharedscripts\n        postrotate\n                killall -SIGUSR1 mongod >/dev/null 2>&1 || true\n        endscript\n}\n```\n\n## \u3082\u3046\uff11\u56de\u78ba\u8a8d\n1188640 \u306e inode \u898b\u3066\u308b\u3002\n\n```bash\n$ ls -li /var/log/mongo/\n\u5408\u8a08 8\n1188640 -rw-r--r-- 1 mongod mongod 584  7\u6708 27 15:26 2015 mongod.log\n$ lsof | grep mongod.log\nmongod    32353    mongod    1w      REG                8,3       584    1188640 /var/log/mongo/mongod.log\n```\n\n\u30ed\u30fc\u30c6\u30fc\u30c8\u5b9f\u884c\n\n```bash\n$ logrotate -f /etc/logrotate.conf\n```\n\n\u6b63\u3057\u304f\u30ed\u30fc\u30c6\u30fc\u30c8\u3067\u304d\u305f\u3002\uff081196912 \u306e inode \u3092\u898b\u3066\u308b\uff09\n\n```bash\n$ ls -li /var/log/mongo/\n\u5408\u8a08 12\n1196912 -rw-r--r-- 1 mongod mongod  71  7\u6708 27 15:26 2015 mongod.log\n1188640 -rw-r--r-- 1 mongod mongod 584  7\u6708 27 15:26 2015 mongod.log-20150727\n$ lsof | grep mongod.log\nmongod    32353    mongod    1w      REG                8,3        71    1196912 /var/log/mongo/mongod.log\n```\n\n## \u53c2\u8003\u30b5\u30a4\u30c8\n\n- http://dayafterneet.blogspot.jp/2011/07/mongodb.html\n- http://sa3g.blogspot.jp/2011/06/mongodblogorotate.html\n", "tags": ["MongoDB", "logrotate"]}