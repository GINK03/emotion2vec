{"context": "kernel module \u306e\u30d3\u30eb\u30c9\u3068\u30ed\u30fc\u30c9\u3092\u3084\u3063\u3066\u307f\u305f\u30e1\u30e2\ndump_stack() \u3067stacktrace\u304c\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\ntestmod.c\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/kernel.h>\n\nMODULE_LICENSE(\"MIT\");\n\nstatic int testmod_init(void)\n{\n    printk(KERN_INFO \"driver loaded\\n\");\n    dump_stack();\n    return 0;\n}\n\nstatic void testmod_exit(void)\n{\n    printk(KERN_INFO \"driver unloaded\\n\");\n}\n\nmodule_init(testmod_init);\nmodule_exit(testmod_exit);\n\n\n\nkernel_module\u306e\u30d3\u30eb\u30c9\u7528Makefile\nKERNELSRCDIR = /lib/modules/$(shell uname -r)/build\nARCH=x86\n#ARCH=arm\n#CROSS_COMPILE=arm-none-linux-gnueabi-\nVERBOSE = 0\n\nobj-m := testmod.o\n\nall:\n    make -C $(KERNELSRCDIR) \\\n        M=$(PWD) \\\n        KBUILD_VERBOSE=$(VERBOSE) \\\n        ARCH=$(ARCH) \\\n        CROSS_COMPILE=$(CROSS_COMPILE) \\\n        modules\n\nclean:\n    make -C $(KERNELSRCDIR) M=$(PWD) KBUILD_VERBOSE=$(VERBOSE) ARCH=$(ARCH) clean\n\n\n\ninsmod\u3057\u3066\u52d5\u4f5c\u3092\u78ba\u8a8d\n$ make\n$ sudo insmod testmod.ko\n$ sudo rmmod testmod\n$ dmesg\n[20487.308696] testmod: module license 'MIT' taints kernel.\n[20487.308709] Disabling lock debugging due to kernel taint\n[20487.310110] driver loaded\n[20487.310116] Pid: 32263, comm: insmod Tainted: P           O XXXXX.x86_64 #1\n[20487.310121] Call Trace:\n[20487.310130]  [<ffffffffa00f8000>] ? 0xffffffffa00f7fff\n[20487.310138]  [<ffffffffa00f801c>] testmod_init+0x1c/0x20 [testmod]\n[20487.310146]  [<ffffffff8100212a>] do_one_initcall+0x12a/0x180\n[20487.310213]  [<ffffffff810b60a6>] sys_init_module+0x10f6/0x20b0\n[20487.310220]  [<ffffffff815f38e9>] system_call_fastpath+0x16/0x1b\n[20487.383930] driver unloaded\n\n\n\n\u95a2\u9023\n\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u60c5\u5831\u3092\u78ba\u8a8d\u3059\u308b\u65b9\u6cd5\u307e\u3068\u3081 - Qiita\n\n\u53c2\u8003\nCompiling Kernel Modules\nARM\u7528Linux\u306e\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f5c\u6210\u3059\u308b - \u3072\u307e\u3058\u3081\nmakefile - Cross compiling a kernel module - Stack Overflow\nkernel module \u306e\u30d3\u30eb\u30c9\u3068\u30ed\u30fc\u30c9\u3092\u3084\u3063\u3066\u307f\u305f\u30e1\u30e2\n`dump_stack()` \u3067stacktrace\u304c\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\n```c:testmod.c\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/kernel.h>\n\nMODULE_LICENSE(\"MIT\");\n\nstatic int testmod_init(void)\n{\n\tprintk(KERN_INFO \"driver loaded\\n\");\n\tdump_stack();\n\treturn 0;\n}\n\nstatic void testmod_exit(void)\n{\n\tprintk(KERN_INFO \"driver unloaded\\n\");\n}\n\nmodule_init(testmod_init);\nmodule_exit(testmod_exit);\n```\n\n```mf:kernel_module\u306e\u30d3\u30eb\u30c9\u7528Makefile\nKERNELSRCDIR = /lib/modules/$(shell uname -r)/build\nARCH=x86\n#ARCH=arm\n#CROSS_COMPILE=arm-none-linux-gnueabi-\nVERBOSE = 0\n\nobj-m := testmod.o\n\nall:\n\tmake -C $(KERNELSRCDIR) \\\n\t\tM=$(PWD) \\\n\t\tKBUILD_VERBOSE=$(VERBOSE) \\\n\t\tARCH=$(ARCH) \\\n\t\tCROSS_COMPILE=$(CROSS_COMPILE) \\\n\t\tmodules\n\nclean:\n\tmake -C $(KERNELSRCDIR) M=$(PWD) KBUILD_VERBOSE=$(VERBOSE) ARCH=$(ARCH) clean\n```\n\n```console:insmod\u3057\u3066\u52d5\u4f5c\u3092\u78ba\u8a8d\n$ make\n$ sudo insmod testmod.ko\n$ sudo rmmod testmod\n$ dmesg\n[20487.308696] testmod: module license 'MIT' taints kernel.\n[20487.308709] Disabling lock debugging due to kernel taint\n[20487.310110] driver loaded\n[20487.310116] Pid: 32263, comm: insmod Tainted: P           O XXXXX.x86_64 #1\n[20487.310121] Call Trace:\n[20487.310130]  [<ffffffffa00f8000>] ? 0xffffffffa00f7fff\n[20487.310138]  [<ffffffffa00f801c>] testmod_init+0x1c/0x20 [testmod]\n[20487.310146]  [<ffffffff8100212a>] do_one_initcall+0x12a/0x180\n[20487.310213]  [<ffffffff810b60a6>] sys_init_module+0x10f6/0x20b0\n[20487.310220]  [<ffffffff815f38e9>] system_call_fastpath+0x16/0x1b\n[20487.383930] driver unloaded\n```\n\n# \u95a2\u9023\n\n[\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u60c5\u5831\u3092\u78ba\u8a8d\u3059\u308b\u65b9\u6cd5\u307e\u3068\u3081 - Qiita](http://qiita.com/koara-local/items/309aec36352f113d4519)\n\n# \u53c2\u8003\n[Compiling Kernel Modules](http://www.tldp.org/LDP/lkmpg/2.6/html/x181.html)\n[ARM\u7528Linux\u306e\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f5c\u6210\u3059\u308b - \u3072\u307e\u3058\u3081](http://www.oidon.net/linux/build-arm-linux-kernel-module)\n[makefile - Cross compiling a kernel module - Stack Overflow](http://stackoverflow.com/questions/3467850/cross-compiling-a-kernel-module)\n", "tags": ["Linux", "kernel", "C"]}