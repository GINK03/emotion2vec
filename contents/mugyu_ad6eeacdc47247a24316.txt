{"context": " More than 1 year has passed since last update.Gauche \u306e\u52c9\u5f37\u3067\u66f8\u3044\u3066\u307f\u305f\u30cb\u30b3\u52d5\u306e\u30bf\u30a4\u30c8\u30eb\u3084\u30b5\u30e0\u30cd\u753b\u50cfURL\u3092\u53d6\u5f97\u3059\u308b\u51e6\u7406\u3002\n\u6b63\u76f4\u3001Scheme\u3084Gauche\u306e\u6d41\u5100\u3068\u304b\u3092\u77e5\u3089\u305a\u306b\u66f8\u3044\u305f\u3051\u3069\u3001\u53d6\u308a\u6562\u3048\u305a\u52d5\u304f\u3002\n(use rfc.http)\n(use rfc.uri)\n\n(define-constant *getthumbinfo-url* \"http://ext.nicovideo.jp/api/getthumbinfo\")\n(define-constant *ok-string*   \"<nicovideo_thumb_response status=\\\"ok\\\">\")\n(define-constant *fail-string* \"<nicovideo_thumb_response status=\\\"fail\\\">\")\n(define-constant *elements* '(title description thumbnail_url watch_url))\n\n(define (getthumbinfo video-id)\n  (receive (code status body)\n    (http-getthumbinfo video-id)\n    (if (rxmatch (string->regexp *ok-string*) body)\n      (map (lambda (element) \n             (rxmatch-substring ((element->regexp element) body) 1))\n        *elements*)\n      #f)))\n\n(define (http-getthumbinfo video-id)\n  (receive (scheme user-info hostname port path query frament)\n    (uri-parse #`\",|*getthumbinfo-url*|/,video-id\")\n    (http-get hostname path)))\n\n(define (element->regexp element)\n  (string->regexp #`\"<,|element|>(.*?)<\\/,|element|>\"))\n\n(receive (title description thumbnail_url watch_url)\n  (apply values (getthumbinfo 'sm9))\n  (print title)             ;=> \u65b0\u30fb\u8c6a\u8840\u5bfa\u4e00\u65cf -\u7169\u60a9\u89e3\u653e - \u30ec\u30c3\u30c4\u30b4\u30fc\uff01\u9670\u967d\u5e2b\n  (print description)       ;=> \u30ec\u30c3\u30c4\u30b4\u30fc\uff01\u9670\u967d\u5e2b\uff08\u30d5\u30eb\u30b3\u30fc\u30e9\u30b9\u30d0\u30fc\u30b8\u30e7\u30f3\uff09\n  (print thumbnail_url)     ;=> http://tn-skr2.smilevideo.jp/smile?i=9\n  (print watch_url))        ;=> http://www.nicovideo.jp/watch/sm9\n(print (getthumbinfo 'smx)) ;=> #f\n\n\u6b21\u306f Gauche \u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u7684\u306b\u30af\u30e9\u30b9\u5b9a\u7fa9\u3057\u305f\u308a\u3068\u304b\u3002\n\u305f\u3060\u3001\u3053\u306e\u307e\u307e\u3060\u3068\u5185\u81d3\u304c\u30c8\u30c3\u30d7\u30ec\u30d9\u30eb\u306b\u99c4\u3005\u6f0f\u308c\u306a\u306e\u3067\n\u306a\u3093\u3068\u304b\u3057\u305f\u65b9\u304c\u3044\u3044\u3068\u601d\u3044\u3064\u3064\u3082\u9014\u4e2d\u8f9e\u3081\u3002\n(define-class <nicovideo> ()\n  ((videoid :init-keyword :videoid :accessor videoid-of)\n   (title :init-value #f)\n   (description :init-value #f)\n   (thumbnail_url :init-value #f)\n   (watch_url :init-value #f)))\n\n(define-method write-object ((nicovideo <nicovideo>) port)\n  (format port \"#<<nicovideo> (~a)>\"\n          (slot-ref nicovideo 'videoid)))\n\n(define-method getthumbinfo ((nicovideo <nicovideo>))\n  (let ((result (getthumbinfo (slot-ref nicovideo 'videoid)))) \n    (if (list? result)\n      (receive (title description thumbnail_url watch_url)\n        (apply values result)\n        (set! (slot-ref nicovideo 'title) title)\n        (set! (slot-ref nicovideo 'description) description)\n        (set! (slot-ref nicovideo 'thumbnail_url) thumbnail_url)\n        (set! (slot-ref nicovideo 'watch_url) watch_url))\n      #f)))\n\n(define sm9 (make <nicovideo> :videoid 'sm9))\n(getthumbinfo sm9)\n(print sm9)                           ; => #<<nicovideo> (sm9)>\n(print (slot-ref sm9 'title))         ; => \u65b0\u30fb\u8c6a\u8840\u5bfa\u4e00\u65cf -\u7169\u60a9\u89e3\u653e - \u30ec\u30c3\u30c4\u30b4\u30fc\uff01\u9670\u967d\u5e2b\n(print (slot-ref sm9 'description))   ; => \u30ec\u30c3\u30c4\u30b4\u30fc\uff01\u9670\u967d\u5e2b\uff08\u30d5\u30eb\u30b3\u30fc\u30e9\u30b9\u30d0\u30fc\u30b8\u30e7\u30f3\uff09\n(print (slot-ref sm9 'thumbnail_url)) ; => http://tn-skr2.smilevideo.jp/smile?i=9\n(print (slot-ref sm9 'watch_url))     ; => http://www.nicovideo.jp/watch/sm9\n\n(define smx (make <nicovideo> :videoid 'smx))\n(print (getthumbinfo smx))            ; => #f\n(print smx)                           ; => #<<nicovideo> (smx)>\n\nGauche \u306e\u52c9\u5f37\u3067\u66f8\u3044\u3066\u307f\u305f\u30cb\u30b3\u52d5\u306e\u30bf\u30a4\u30c8\u30eb\u3084\u30b5\u30e0\u30cd\u753b\u50cfURL\u3092\u53d6\u5f97\u3059\u308b\u51e6\u7406\u3002\n\u6b63\u76f4\u3001Scheme\u3084Gauche\u306e\u6d41\u5100\u3068\u304b\u3092\u77e5\u3089\u305a\u306b\u66f8\u3044\u305f\u3051\u3069\u3001\u53d6\u308a\u6562\u3048\u305a\u52d5\u304f\u3002\n\n\n```scheme:\n(use rfc.http)\n(use rfc.uri)\n\n(define-constant *getthumbinfo-url* \"http://ext.nicovideo.jp/api/getthumbinfo\")\n(define-constant *ok-string*   \"<nicovideo_thumb_response status=\\\"ok\\\">\")\n(define-constant *fail-string* \"<nicovideo_thumb_response status=\\\"fail\\\">\")\n(define-constant *elements* '(title description thumbnail_url watch_url))\n\n(define (getthumbinfo video-id)\n  (receive (code status body)\n    (http-getthumbinfo video-id)\n    (if (rxmatch (string->regexp *ok-string*) body)\n      (map (lambda (element) \n             (rxmatch-substring ((element->regexp element) body) 1))\n        *elements*)\n      #f)))\n\n(define (http-getthumbinfo video-id)\n  (receive (scheme user-info hostname port path query frament)\n    (uri-parse #`\",|*getthumbinfo-url*|/,video-id\")\n    (http-get hostname path)))\n\n(define (element->regexp element)\n  (string->regexp #`\"<,|element|>(.*?)<\\/,|element|>\"))\n      \n(receive (title description thumbnail_url watch_url)\n  (apply values (getthumbinfo 'sm9))\n  (print title)             ;=> \u65b0\u30fb\u8c6a\u8840\u5bfa\u4e00\u65cf -\u7169\u60a9\u89e3\u653e - \u30ec\u30c3\u30c4\u30b4\u30fc\uff01\u9670\u967d\u5e2b\n  (print description)       ;=> \u30ec\u30c3\u30c4\u30b4\u30fc\uff01\u9670\u967d\u5e2b\uff08\u30d5\u30eb\u30b3\u30fc\u30e9\u30b9\u30d0\u30fc\u30b8\u30e7\u30f3\uff09\n  (print thumbnail_url)     ;=> http://tn-skr2.smilevideo.jp/smile?i=9\n  (print watch_url))        ;=> http://www.nicovideo.jp/watch/sm9\n(print (getthumbinfo 'smx)) ;=> #f\n```\n\n\u6b21\u306f Gauche \u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u7684\u306b\u30af\u30e9\u30b9\u5b9a\u7fa9\u3057\u305f\u308a\u3068\u304b\u3002\n\u305f\u3060\u3001\u3053\u306e\u307e\u307e\u3060\u3068\u5185\u81d3\u304c\u30c8\u30c3\u30d7\u30ec\u30d9\u30eb\u306b\u99c4\u3005\u6f0f\u308c\u306a\u306e\u3067\n\u306a\u3093\u3068\u304b\u3057\u305f\u65b9\u304c\u3044\u3044\u3068\u601d\u3044\u3064\u3064\u3082\u9014\u4e2d\u8f9e\u3081\u3002\n\n```scheme:\n(define-class <nicovideo> ()\n  ((videoid :init-keyword :videoid :accessor videoid-of)\n   (title :init-value #f)\n   (description :init-value #f)\n   (thumbnail_url :init-value #f)\n   (watch_url :init-value #f)))\n\n(define-method write-object ((nicovideo <nicovideo>) port)\n  (format port \"#<<nicovideo> (~a)>\"\n          (slot-ref nicovideo 'videoid)))\n\n(define-method getthumbinfo ((nicovideo <nicovideo>))\n  (let ((result (getthumbinfo (slot-ref nicovideo 'videoid)))) \n    (if (list? result)\n      (receive (title description thumbnail_url watch_url)\n        (apply values result)\n        (set! (slot-ref nicovideo 'title) title)\n        (set! (slot-ref nicovideo 'description) description)\n        (set! (slot-ref nicovideo 'thumbnail_url) thumbnail_url)\n        (set! (slot-ref nicovideo 'watch_url) watch_url))\n      #f)))\n\n(define sm9 (make <nicovideo> :videoid 'sm9))\n(getthumbinfo sm9)\n(print sm9)                           ; => #<<nicovideo> (sm9)>\n(print (slot-ref sm9 'title))         ; => \u65b0\u30fb\u8c6a\u8840\u5bfa\u4e00\u65cf -\u7169\u60a9\u89e3\u653e - \u30ec\u30c3\u30c4\u30b4\u30fc\uff01\u9670\u967d\u5e2b\n(print (slot-ref sm9 'description))   ; => \u30ec\u30c3\u30c4\u30b4\u30fc\uff01\u9670\u967d\u5e2b\uff08\u30d5\u30eb\u30b3\u30fc\u30e9\u30b9\u30d0\u30fc\u30b8\u30e7\u30f3\uff09\n(print (slot-ref sm9 'thumbnail_url)) ; => http://tn-skr2.smilevideo.jp/smile?i=9\n(print (slot-ref sm9 'watch_url))     ; => http://www.nicovideo.jp/watch/sm9\n\n(define smx (make <nicovideo> :videoid 'smx))\n(print (getthumbinfo smx))            ; => #f\n(print smx)                           ; => #<<nicovideo> (smx)>\n```\n", "tags": ["Scheme", "Gauche"]}