{"tags": ["Imagick", "memcache", "PHP", "ImageMagick"], "context": " \u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u65e5\u304b\u30891\u5e74\u4ee5\u4e0a\u304c\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u74b0\u5883\n\nCentOS 7.X\nImagick\n\n\nImageMagick\n\n\nMemcached\n\n\u3053\u306e\u69cb\u6210\u3067\u3084\u308b\u3068\u304d\u306b\u3001\u3044\u3064\u3082\u540d\u524d\u3067\u6df7\u4e71\u3059\u308b\u3002\n\nImageMagick\u306f\u3001\u30b5\u30fc\u30d0\u30fc\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\nImagick\u306f\u3001ImageMagick\u3092PHP\u304b\u3089\u4f7f\u3046\u3068\u304d\u306e\u30e9\u30c3\u30d1\u30fc\u30e9\u30a4\u30d6\u30e9\u30ea\nMemcached\u306f\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u30fc\nmemcache\u306f\u3001PHP\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3060\u3051\u3069\u3001memcached\u3068\u3044\u3046\u30e9\u30a4\u30d6\u30e9\u30ea\u3082\u3042\u308b\u2026\u2026\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nMemcached\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\nMemcached\n# yum install memcached\n# systemctl enable memcached.service\n# systemctl start memcached.service\n\n\n\nmemcache\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\nmemcache\n# yum -y install php-pecl-memcache\n\n# yum install php-pear\n# yum install php-devel\n\n\n\nImageMagick\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\nImageMagick\n# yum install ImageMagick*\n\n\n\nImagick\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\nImagick\n# pecl install Imagick\n# php -i | grep Imagick\n\n\n\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n\nimage-proxy.php\n<?php\n/**\n * \u753b\u50cf\u30b5\u30e0\u30cd\u30a4\u30eb\uff06\u30ad\u30e3\u30c3\u30b7\u30e5\n * @use \n * http://{your_domain}/scripts/image-proxy.php?url=http://upload.wikimedia.org/wikipedia/commons/2/2a/2008_ZB_Viper_SRT-10_blue.jpg\n */\ndefine('THUMB_WIDTH',   160);\ndefine('THUMB_QUARITY', 80);\n\n$url = $_GET['url'];\n\n$imagick = new Imagick();\n\n// URL\u3092\u30ad\u30fc\u3068\u3057\u3066\u753b\u50cf\u3092\u4fdd\u5b58\n$memcached = new Memcached();\nif ($memcached) {\n    $memcached->setOption(Memcached::OPT_BINARY_PROTOCOL, true);\n\n    $memcached->addServer('127.0.0.1', 11211);\n\n    $blob = $memcached->get($url);\n    if ($blob) {\n        // \u30ad\u30e3\u30c3\u30b7\u30e5\u3042\u308a\n        trigger_error(\"Stored Cache : YES\");\n        $imagick->readimageblob($blob);\n    } else {\n        // \u30ad\u30e3\u30c3\u30b7\u30e5\u306a\u3057\n        trigger_error(\"Stored Cache : NO\");\n        $handle = fopen($url, 'rb');\n        $imagick->readImageFile($handle);\n        $imagick->resizeImage(THUMB_WIDTH, 0, 0, 0);\n        $imagick->setImageFormat('jpeg');\n        $imagick->setImageCompressionQuality(THUMB_QUARITY);\n        // \u30ad\u30e3\u30c3\u30b7\u30e5\u30bb\u30c3\u30c8\n        if (!$memcached->set($url, $imagick->getimageblob())) {\n            trigger_error(\"Could not set Blob.\"); //  \u30b5\u30fc\u30d0\u30fc\u304c\u843d\u3061\u3066\u3044\u308b\n        }\n    }\n}\n\n// \u51fa\u529b\nheader(\"Content-Type: image/jpeg\");\nexit($imagick->getImageBlob());\n?>\n\n\n\u3053\u306e\u5f8c\u3001\u6700\u65b0\u306e\u74b0\u5883\uff08Laravel + GD + Intervention Image\uff09\u3067\u4f5c\u308a\u305d\u3046\u306a\u96f0\u56f2\u6c17\u306a\u306e\u3067\u3001Pear\u3068\u304bPecl\u306e\u5168\u76db\u671f\u306b\u66f8\u3044\u305f\u65e7\u7248\u3092\u8f09\u305b\u3066\u307f\u308b\u3002\n\n## \u74b0\u5883\n * CentOS 7.X\n * Imagick\n  * ImageMagick\n * Memcached\n\n\u3053\u306e\u69cb\u6210\u3067\u3084\u308b\u3068\u304d\u306b\u3001\u3044\u3064\u3082\u540d\u524d\u3067\u6df7\u4e71\u3059\u308b\u3002\n\n 1. ImageMagick\u306f\u3001\u30b5\u30fc\u30d0\u30fc\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\n 1. Imagick\u306f\u3001ImageMagick\u3092PHP\u304b\u3089\u4f7f\u3046\u3068\u304d\u306e\u30e9\u30c3\u30d1\u30fc\u30e9\u30a4\u30d6\u30e9\u30ea\n 1. Memcached\u306f\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u30fc\n 1. memcache\u306f\u3001PHP\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3060\u3051\u3069\u3001memcached\u3068\u3044\u3046\u30e9\u30a4\u30d6\u30e9\u30ea\u3082\u3042\u308b\u2026\u2026\n\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n * Memcached\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash:Memcached\n# yum install memcached\n# systemctl enable memcached.service\n# systemctl start memcached.service\n```\n\n* memcache\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash:memcache\n# yum -y install php-pecl-memcache\n\n# yum install php-pear\n# yum install php-devel\n```\n\n* ImageMagick\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash:ImageMagick\n# yum install ImageMagick*\n```\n\n* Imagick\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash:Imagick\n# pecl install Imagick\n# php -i | grep Imagick\n```\n\n\n## \u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n```php:image-proxy.php\n<?php\n/**\n * \u753b\u50cf\u30b5\u30e0\u30cd\u30a4\u30eb\uff06\u30ad\u30e3\u30c3\u30b7\u30e5\n * @use \n * http://{your_domain}/scripts/image-proxy.php?url=http://upload.wikimedia.org/wikipedia/commons/2/2a/2008_ZB_Viper_SRT-10_blue.jpg\n */\ndefine('THUMB_WIDTH',\t160);\ndefine('THUMB_QUARITY', 80);\n\n$url = $_GET['url'];\n\n$imagick = new Imagick();\n\n// URL\u3092\u30ad\u30fc\u3068\u3057\u3066\u753b\u50cf\u3092\u4fdd\u5b58\n$memcached = new Memcached();\nif ($memcached) {\n    $memcached->setOption(Memcached::OPT_BINARY_PROTOCOL, true);\n\t\n    $memcached->addServer('127.0.0.1', 11211);\n\t\n\t$blob = $memcached->get($url);\n\tif ($blob) {\n\t\t// \u30ad\u30e3\u30c3\u30b7\u30e5\u3042\u308a\n\t\ttrigger_error(\"Stored Cache : YES\");\n\t\t$imagick->readimageblob($blob);\n\t} else {\n\t\t// \u30ad\u30e3\u30c3\u30b7\u30e5\u306a\u3057\n\t\ttrigger_error(\"Stored Cache : NO\");\n\t\t$handle = fopen($url, 'rb');\n\t\t$imagick->readImageFile($handle);\n\t\t$imagick->resizeImage(THUMB_WIDTH, 0, 0, 0);\n\t\t$imagick->setImageFormat('jpeg');\n\t\t$imagick->setImageCompressionQuality(THUMB_QUARITY);\n\t\t// \u30ad\u30e3\u30c3\u30b7\u30e5\u30bb\u30c3\u30c8\n\t    if (!$memcached->set($url, $imagick->getimageblob())) {\n\t    \ttrigger_error(\"Could not set Blob.\"); //  \u30b5\u30fc\u30d0\u30fc\u304c\u843d\u3061\u3066\u3044\u308b\n\t    }\n\t}\n}\n\n// \u51fa\u529b\nheader(\"Content-Type: image/jpeg\");\nexit($imagick->getImageBlob());\n?>\n```\n\u3053\u306e\u5f8c\u3001\u6700\u65b0\u306e\u74b0\u5883\uff08Laravel + GD + Intervention Image\uff09\u3067\u4f5c\u308a\u305d\u3046\u306a\u96f0\u56f2\u6c17\u306a\u306e\u3067\u3001Pear\u3068\u304bPecl\u306e\u5168\u76db\u671f\u306b\u66f8\u3044\u305f\u65e7\u7248\u3092\u8f09\u305b\u3066\u307f\u308b\u3002\n"}