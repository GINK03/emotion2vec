{"context": " More than 1 year has passed since last update.Zulip \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u8aad\u3093\u3060 (1/2) \u306e\u7d9a\u304d\u3067\u3059\u3002\nREADME.prod.md \u306b\u3088\u308b\u3068\u3001Zulip \u306f\u4e0b\u8a18\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u3068\u306e\u3053\u3068\u3002\n\npostgresql\nrabbitmq-server\nnginx\nredis\nmemcached\n\n\u4eca\u56de\u306f zulip/puppet/zulip/manifests/voyager.pp \u304c\u30a4\u30f3\u30af\u30eb\u30fc\u30c9\u3059\u308b\u6b21\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u3093\u3067\u3044\u304d\u307e\u3059\u3002\n\nzulip/puppet/zulip/manifests/base.pp\nzulip/puppet/zulip/manifests/app_frontend.pp\n\nzulip/puppet/zulip/manifests/postgres_appdb.pp\nzulip/puppet/zulip/manifests/redis.pp\n\n\nzulip/puppet/zulip/manifests/base.pp\n\nclass zulip::base {\n  include apt\n  $base_packages = [ # Basic requirements for effective operation of a server\n                     \"ntp\",\n                     # This is just good practice\n                     \"molly-guard\",\n                     # Dependencies of our API\n                     \"python-requests\",\n                     \"python-simplejson\",\n                     # For development/debugging convenience\n                     \"ipython\",\n                     \"screen\",\n                     \"strace\",\n                     \"vim\",\n                     \"moreutils\",\n                     \"emacs23-nox\",\n                     \"git\",\n                     \"puppet-el\",\n                     \"host\",\n                     ]\n  package { $base_packages: ensure => \"installed\" }\n\n\u30b5\u30fc\u30d0\u30fc\u64cd\u4f5c\u3001\u958b\u767a\uff0f\u30c7\u30d0\u30c3\u30b0\u7528\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n  user { 'zulip':\n    ensure     => present,\n    require    => Group['zulip'],\n    gid        => 'zulip',\n    shell      => '/bin/bash',\n    home       => '/home/zulip',\n    managehome => true,\n  }\n\n  file { '/etc/zulip':\n    ensure     => 'directory',\n    mode       => 644,\n    owner      => 'zulip',\n    group      => 'zulip',\n  }\n\n  file { '/etc/security/limits.conf':\n    ensure     => file,\n    mode       => 640,\n    owner      => \"root\",\n    group      => \"root\",\n    source     => 'puppet:///modules/zulip/limits.conf',\n  }\n\n\u30fb\u30fb\u30fb\u4e2d\u7565\u30fb\u30fb\u30fb\n\n    source     => 'puppet:///modules/zulip/limits.conf',\n  }\n\nZulip \u306e\u30b0\u30eb\u30fc\u30d7\u3001\u30e6\u30fc\u30b6\u30fc\u3001\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n\nzulip/puppet/zulip/files/limits.conf\n\n  # This directory is written to by cron jobs for reading by Nagios\n  file { '/var/lib/nagios_state/':\n    ensure     => directory,\n    group      => 'zulip',\n    mode       => 774,\n  }\n\n\u30fb\u30fb\u30fb\u4ee5\u4e0b\u7701\u7565\u30fb\u30fb\u30fb\n\nNagios\u3001\u30ed\u30b0\uff0f\u30ad\u30e5\u30fc\u30a8\u30e9\u30fc\u51fa\u529b\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\u3002\n\nzulip/puppet/zulip/manifests/app_frontend.pp\n\nclass zulip::app_frontend {\n  include zulip::rabbit\n  include zulip::nginx\n  include zulip::supervisor\n\n\u30a2\u30d7\u30ea\u306e\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\u6b21\u306e\u30af\u30e9\u30b9\u3092\u30a4\u30f3\u30af\u30eb\u30fc\u30c9\u3059\u308b\u3002\n\nzulip/puppet/zulip/manifests/rabbit.pp\nzulip/puppet/zulip/manifests/nginx.pp\nzulip/puppet/zulip/manifests/supervisor.pp\n\n\nzulip/puppet/zulip/manifests/rabbit.pp\n\nclass zulip::rabbit {\n  $rabbit_packages = [# Needed to run rabbitmq\n                      \"erlang-base\",\n                      \"rabbitmq-server\",\n                      ]\n  package { $rabbit_packages: ensure => \"installed\" }\n\n  file { \"/etc/cron.d/rabbitmq-queuesize\":\n    require => Package[rabbitmq-server],\n    ensure => file,\n    owner  => \"root\",\n    group  => \"root\",\n    mode => 644,\n    source => \"puppet:///modules/zulip/cron.d/rabbitmq-queuesize\",\n  }\n\n\u30fb\u30fb\u30fb\u4e2d\u7565\u30fb\u30fb\u30fb\n\n  # epmd doesn't have an init script.  This won't leak epmd processes\n  # because epmd checks if one is already running and exits if so.\n  #\n  # TODO: Ideally we'd still check if it's already running to keep the\n  # puppet log for what is being changed clean\n  exec { \"epmd\":\n    command => \"epmd -daemon\",\n    require => Package[erlang-base],\n    path    => \"/usr/bin/:/bin/\",\n  }\n\n  service { \"rabbitmq-server\":\n    ensure => running,\n    require => Exec[\"epmd\"],\n  }\n\n  # TODO: Should also call exactly once \"configure-rabbitmq\"\n}\n\nRabbitMQ \u306b\u3064\u3044\u3066\u306e TODO \u304c2\u3064\u30fb\u30fb\u30fb\n\n\nzulip/puppet/zulip/files/cron.d/rabbitmq-queuesize\n\nzulip/bots/check-rabbitmq-queue\n\n\n\nzulip/puppet/zulip/files/cron.d/rabbitmq-numconsumers\n\nzulip/bin/write-rabbitmq-consumers-state-file\n\n\nzulip/puppet/zulip/files/rabbitmq/rabbitmq-server\nzulip/puppet/zulip/files/rabbitmq/rabbitmq.config\n\n[{kernel, [{inet_dist_use_interface, {127,0,0,1}}]},\n {rabbit, [{tcp_listeners, [{\"127.0.0.1\", 5672}]}]},\n {rabbitmq_mochiweb, [{listeners, [{mgmt, [{ip, \"127.0.0.1\"},\n                                           {port, 55672}]}]}]}].\n\n\nzulip/puppet/zulip/manifests/nginx.pp\n\nclass zulip::nginx {\n  $web_packages = [# Needed to run nginx with the modules we use\n                   \"nginx-full\",\n\n\u30fb\u30fb\u30fb\u4ee5\u4e0b\u7701\u7565\u30fb\u30fb\u30fb\n\n\nzulip/puppet/zulip/files/nginx/zulip-include-common/\nzulip/puppet/zulip/files/nginx/nginx.conf\nzulip/puppet/zulip/files/nginx/fastcgi_params\n\n\nzulip/puppet/zulip/manifests/supervisor.pp\n\nclass zulip::supervisor {\n  $supervisor_packages = [# Needed to run supervisor\n                          \"supervisor\",\n\n\u30fb\u30fb\u30fb\u4e2d\u7565\u30fb\u30fb\u30fb\n\n    # The \"restart\" option in the init script does not work.  We could\n    # tell Puppet to fall back to stop/start, which does work, but the\n    # better option is to tell supervisord to reread its config via\n    # supervisorctl and then to \"update\".  You need to do both --\n    # after a \"reread\", supervisor won't actually take actual based on\n    # the changed configuration until you do an \"update\" (I assume\n    # this is so you can check if your config file parses without\n    # doing anything, but it's really confusing)\n    hasrestart => true,\n    restart => \"bash -c 'supervisorctl reread && supervisorctl update'\"\n  }\n\u30fb\u30fb\u30fb\u4ee5\u4e0b\u7701\u7565\u30fb\u30fb\u30fb\n\n\nzulip/puppet/zulip/files/supervisor/supervisord.conf\n\n\nzulip/puppet/zulip/manifests/app_frontend.pp\uff08\u7d9a\u304d\uff09\n  $web_packages = [ # Needed for memcached usage\n                    \"memcached\",\n                    \"python-pylibmc\",\n                    # Fast JSON parser\n                    \"python-ujson\",\n\n\u30fb\u30fb\u30fb\u4e2d\u7565\u30fb\u30fb\u30fb\n\n                    ]\n  define safepackage ( $ensure = present ) {\n    if !defined(Package[$title]) {\n      package { $title: ensure => $ensure }\n    }\n  }\n  safepackage { $web_packages: ensure => \"installed\" }\n\n  file { \"/etc/nginx/zulip-include/app\":\n    require => Package[\"nginx-full\"],\n    owner  => \"root\",\n    group  => \"root\",\n    mode => 644,\n    source => \"puppet:///modules/zulip/nginx/zulip-include-frontend/app\",\n    notify => Service[\"nginx\"],\n  }\n\n\u30fb\u30fb\u30fb\u4ee5\u4e0b\u7701\u7565\u30fb\u30fb\u30fb\n\nzulip/puppet/zulip/files/nginx/zulip-include-frontend/app\nzulip/puppet/zulip/files/nginx/zulip-include-frontend/upstreams\nzulip/puppet/zulip/files/nginx/zulip-include-frontend/uploads.types\nzulip/puppet/zulip/files/memcached.conf\nzulip/puppet/zulip/files/supervisor/conf.d/zulip.conf\n\nzulip/puppet/zulip/files/nginx/zulip-include-frontend/app\n\naccess_log /var/log/nginx/access.log;\nerror_log /var/log/nginx/error.log;\n\n# Enable HSTS: tell browsers to always use HTTPS\nadd_header Strict-Transport-Security max-age=15768000;\n\n# Serve a custom error page when the app is down\nerror_page 502 503 504 /static/html/5xx.html;\n\n# Serve static files directly\nlocation /static/ {\n    alias /home/zulip/prod-static/;\n    error_page 404 /static/html/404.html;\n}\n\n\u30fb\u30fb\u30fb\u4e2d\u7565\u30fb\u30fb\u30fb\n\ninclude /etc/nginx/zulip-include/app.d/*.conf;\n\n\nzulip/puppet/zulip/files/nginx/zulip-include-frontend/upstreams\n\nupstream django {\n    server unix:/home/zulip/deployments/fastcgi-socket;\n}\n\nupstream tornado {\n    server localhost:9993;\n    keepalive 10000;\n}\n\nupstream localhost_sso {\n    server localhost:8888;\n}\n\n\nzulip/puppet/zulip/files/nginx/zulip-include-frontend/uploads.types\n\ntypes {\n    text/plain                            txt;\n\n    image/gif                             gif;\n    image/jpeg                            jpeg jpg;\n    image/png                             png;\n    image/tiff                            tif tiff;\n    image/webp                            webp;\n\n    video/3gpp                            3gpp 3gp;\n    video/mp4                             mp4;\n    video/mpeg                            mpeg mpg;\n    video/quicktime                       mov;\n    video/webm                            webm;\n    video/x-flv                           flv;\n    video/x-m4v                           m4v;\n    video/x-mng                           mng;\n    video/x-ms-asf                        asx asf;\n    video/x-ms-wmv                        wmv;\n    video/x-msvideo                       avi;\n}\n\n\nzulip/puppet/zulip/files/memcached.conf\n\n-d\n-m 512\n-p 11211\n-u nobody\n\n\nzulip/puppet/zulip/files/supervisor/conf.d/zulip.conf\n\nsupervisor\n\uff08\u53c2\u8003\uff09Supervisor - Configuration File\n\nfcgi-program:zulip-django\nprogram:zulip-tornado\nprogram:zulip-events-user-activity\nprogram:zulip-events-user-activity-interval\nprogram:zulip-events-user-presence\nprogram:zulip-events-signups\nprogram:zulip-events-confirmation-emails\nprogram:zulip-events-missedmessage_reminders\nprogram:zulip-events-missedmessage_mobile_notifications\nprogram:zulip-events-slowqueries\nprogram:zulip-events-message_sender\nprogram:zulip-events-feedback_messages\nprogram:zulip-events-error_reports\nprogram:zulip-events-digest_emails\nprogram:zulip-events-email_mirror\nprogram:zulip-deliver-enqueued-emails\ngroup:zulip-workers\ngroup:zulip-senders\n\n\nzulip/puppet/zulip/manifests/postgres_appdb.pp\n\nclass zulip::postgres_appdb {\n  include zulip::postgres_common\n  include zulip::supervisor\n\n\nzulip/puppet/zulip/manifests/postgres_common.pp\n\nulip/puppet/zulip/manifests/supervisor.pp \uff08\u524d\u8ff0\uff09\n\n\nzulip/puppet/zulip/manifests/postgres_common.pp\n\nclass zulip::postgres_common {\n\n\u30fb\u30fb\u30fb\u4e2d\u7565\u30fb\u30fb\u30fb\n\n  exec { \"disable_logrotate\":\n    command => \"/usr/bin/dpkg-divert --rename --divert /etc/logrotate.d/postgresql-common.disabled --add /etc/logrotate.d/postgresql-common\",\n    creates => '/etc/logrotate.d/postgresql-common.disabled',\n  }\n}\n\n\nzulip/puppet/zulip/manifests/postgres_appdb.pp\uff08\u7d9a\u304d\uff09\n\nzulip/puppet/zulip/files/postgresql/process_fts_updates\nzulip/puppet/zulip/files/supervisor/conf.d/zulip_db.conf\nzulip/puppet/zulip/files/postgresql/zulip_english.stop\n\nsupervisor\n\nprogram:process-fts-updates\n\n\nzulip/puppet/zulip/manifests/redis.pp\n\nclass zulip::redis {\n  $redis_packages = [ # The server itself\n                      \"redis-server\",\n                      ]\n\n  package { $redis_packages: ensure => \"installed\" }\n\n  file { \"/etc/redis/redis.conf\":\n    require => Package[redis-server],\n    ensure => file,\n    owner  => \"root\",\n    group  => \"root\",\n    mode => 644,\n    source => \"puppet:///modules/zulip/redis/redis.conf\",\n  }\n\n  service { 'redis-server':\n    ensure     => running,\n    subscribe  => File['/etc/redis/redis.conf'],\n  }\n}\n\n\nzulip/puppet/zulip/files/redis/redis.conf\n\n################################ GENERAL  #####################################\ndaemonize yes\nport 6379\nbind 127.0.0.1\ntimeout 0\ntcp-keepalive 0\nloglevel notice\nlogfile /var/log/redis/redis-server.log\ndatabases 16\n################################ SNAPSHOTTING  ################################\nsave 900 1\nsave 300 10\nsave 60 10000\nstop-writes-on-bgsave-error yes\nrdbcompression yes\nrdbchecksum yes\ndbfilename dump.rdb\ndir /var/lib/redis\n################################# REPLICATION #################################\nslave-serve-stale-data yes\nslave-read-only yes\nrepl-disable-tcp-nodelay no\nslave-priority 100\n############################## APPEND ONLY MODE ###############################\nappendonly no\nappendfilename \"appendonly.aof\"\nappendfsync everysec\nno-appendfsync-on-rewrite no\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\n################################ LUA SCRIPTING  ###############################\nlua-time-limit 5000\n################################## SLOW LOG ###################################\nslowlog-log-slower-than 10000\nslowlog-max-len 128\n############################# Event notification ##############################\nnotify-keyspace-events \"\"\n############################### ADVANCED CONFIG ###############################\nhash-max-ziplist-entries 512\nhash-max-ziplist-value 64\nlist-max-ziplist-entries 512\nlist-max-ziplist-value 64\nset-max-intset-entries 512\nzset-max-ziplist-entries 128\nzset-max-ziplist-value 64\nactiverehashing yes\nclient-output-buffer-limit normal 0 0 0\nclient-output-buffer-limit slave 256mb 64mb 60\nclient-output-buffer-limit pubsub 32mb 8mb 60\nhz 10\naof-rewrite-incremental-fsync yes\nsave \"\"\n\n[Zulip \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u8aad\u3093\u3060 (1/2)](http://qiita.com/usutani/items/b46388306dbf197223f8#zulippuppetzulipmanifestsvoyagerpp) \u306e\u7d9a\u304d\u3067\u3059\u3002\n\nREADME.prod.md \u306b\u3088\u308b\u3068\u3001Zulip \u306f\u4e0b\u8a18\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u3068\u306e\u3053\u3068\u3002\n\n- [postgresql](http://www.postgresql.org)\n- [rabbitmq-server](https://www.rabbitmq.com/download.html)\n- [nginx](http://nginx.org/en/)\n- [redis](http://redis.io)\n- [memcached](http://memcached.org)\n\n\u4eca\u56de\u306f [zulip/puppet/zulip/manifests/voyager.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/voyager.pp) \u304c\u30a4\u30f3\u30af\u30eb\u30fc\u30c9\u3059\u308b\u6b21\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u3093\u3067\u3044\u304d\u307e\u3059\u3002\n\n- [zulip/puppet/zulip/manifests/base.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/base.pp)\n- [zulip/puppet/zulip/manifests/app_frontend.pp\n](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/app_frontend.pp)\n- [zulip/puppet/zulip/manifests/postgres_appdb.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/postgres_appdb.pp)\n- [zulip/puppet/zulip/manifests/redis.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/redis.pp)\n\n# [zulip/puppet/zulip/manifests/base.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/base.pp)\n\n```pp\nclass zulip::base {\n  include apt\n  $base_packages = [ # Basic requirements for effective operation of a server\n                     \"ntp\",\n                     # This is just good practice\n                     \"molly-guard\",\n                     # Dependencies of our API\n                     \"python-requests\",\n                     \"python-simplejson\",\n                     # For development/debugging convenience\n                     \"ipython\",\n                     \"screen\",\n                     \"strace\",\n                     \"vim\",\n                     \"moreutils\",\n                     \"emacs23-nox\",\n                     \"git\",\n                     \"puppet-el\",\n                     \"host\",\n                     ]\n  package { $base_packages: ensure => \"installed\" }\n```\n\n\u30b5\u30fc\u30d0\u30fc\u64cd\u4f5c\u3001\u958b\u767a\uff0f\u30c7\u30d0\u30c3\u30b0\u7528\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\n```pp\n  user { 'zulip':\n    ensure     => present,\n    require    => Group['zulip'],\n    gid        => 'zulip',\n    shell      => '/bin/bash',\n    home       => '/home/zulip',\n    managehome => true,\n  }\n\n  file { '/etc/zulip':\n    ensure     => 'directory',\n    mode       => 644,\n    owner      => 'zulip',\n    group      => 'zulip',\n  }\n\n  file { '/etc/security/limits.conf':\n    ensure     => file,\n    mode       => 640,\n    owner      => \"root\",\n    group      => \"root\",\n    source     => 'puppet:///modules/zulip/limits.conf',\n  }\n\n\u30fb\u30fb\u30fb\u4e2d\u7565\u30fb\u30fb\u30fb\n\n    source     => 'puppet:///modules/zulip/limits.conf',\n  }\n```\n\nZulip \u306e\u30b0\u30eb\u30fc\u30d7\u3001\u30e6\u30fc\u30b6\u30fc\u3001\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n- [zulip/puppet/zulip/files/limits.conf](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/limits.conf)\n\n```pp\n  # This directory is written to by cron jobs for reading by Nagios\n  file { '/var/lib/nagios_state/':\n    ensure     => directory,\n    group      => 'zulip',\n    mode       => 774,\n  }\n\n\u30fb\u30fb\u30fb\u4ee5\u4e0b\u7701\u7565\u30fb\u30fb\u30fb\n```\n\n[Nagios](https://www.nagios.org)\u3001\u30ed\u30b0\uff0f\u30ad\u30e5\u30fc\u30a8\u30e9\u30fc\u51fa\u529b\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n# [zulip/puppet/zulip/manifests/app_frontend.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/app_frontend.pp)\n\n```pp\nclass zulip::app_frontend {\n  include zulip::rabbit\n  include zulip::nginx\n  include zulip::supervisor\n```\n\n\u30a2\u30d7\u30ea\u306e\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\u6b21\u306e\u30af\u30e9\u30b9\u3092\u30a4\u30f3\u30af\u30eb\u30fc\u30c9\u3059\u308b\u3002\n\n- [zulip/puppet/zulip/manifests/rabbit.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/rabbit.pp)\n- [zulip/puppet/zulip/manifests/nginx.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/nginx.pp)\n- [zulip/puppet/zulip/manifests/supervisor.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/supervisor.pp)\n\n## [zulip/puppet/zulip/manifests/rabbit.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/rabbit.pp)\n\n```pp\nclass zulip::rabbit {\n  $rabbit_packages = [# Needed to run rabbitmq\n                      \"erlang-base\",\n                      \"rabbitmq-server\",\n                      ]\n  package { $rabbit_packages: ensure => \"installed\" }\n\n  file { \"/etc/cron.d/rabbitmq-queuesize\":\n    require => Package[rabbitmq-server],\n    ensure => file,\n    owner  => \"root\",\n    group  => \"root\",\n    mode => 644,\n    source => \"puppet:///modules/zulip/cron.d/rabbitmq-queuesize\",\n  }\n\n\u30fb\u30fb\u30fb\u4e2d\u7565\u30fb\u30fb\u30fb\n\n  # epmd doesn't have an init script.  This won't leak epmd processes\n  # because epmd checks if one is already running and exits if so.\n  #\n  # TODO: Ideally we'd still check if it's already running to keep the\n  # puppet log for what is being changed clean\n  exec { \"epmd\":\n    command => \"epmd -daemon\",\n    require => Package[erlang-base],\n    path    => \"/usr/bin/:/bin/\",\n  }\n\n  service { \"rabbitmq-server\":\n    ensure => running,\n    require => Exec[\"epmd\"],\n  }\n\n  # TODO: Should also call exactly once \"configure-rabbitmq\"\n}\n```\n\n**RabbitMQ \u306b\u3064\u3044\u3066\u306e TODO \u304c2\u3064\u30fb\u30fb\u30fb**\n\n- [zulip/puppet/zulip/files/cron.d/rabbitmq-queuesize](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/cron.d/rabbitmq-queuesize)\n - [zulip/bots/check-rabbitmq-queue](https://github.com/zulip/zulip/blob/1.3.7/bots/check-rabbitmq-queue)\n- [zulip/puppet/zulip/files/cron.d/rabbitmq-numconsumers](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/cron.d/rabbitmq-numconsumers)\n - [zulip/bin/write-rabbitmq-consumers-state-file](https://github.com/zulip/zulip/blob/1.3.7/bin/write-rabbitmq-consumers-state-file)\n- [zulip/puppet/zulip/files/rabbitmq/rabbitmq-server](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/rabbitmq/rabbitmq-server)\n- [zulip/puppet/zulip/files/rabbitmq/rabbitmq.config](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/rabbitmq/rabbitmq.config)\n\n```erlang\n[{kernel, [{inet_dist_use_interface, {127,0,0,1}}]},\n {rabbit, [{tcp_listeners, [{\"127.0.0.1\", 5672}]}]},\n {rabbitmq_mochiweb, [{listeners, [{mgmt, [{ip, \"127.0.0.1\"},\n                                           {port, 55672}]}]}]}].\n```\n\n## [zulip/puppet/zulip/manifests/nginx.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/nginx.pp)\n\n```pp\nclass zulip::nginx {\n  $web_packages = [# Needed to run nginx with the modules we use\n                   \"nginx-full\",\n\n\u30fb\u30fb\u30fb\u4ee5\u4e0b\u7701\u7565\u30fb\u30fb\u30fb\n```\n\n- [zulip/puppet/zulip/files/nginx/zulip-include-common/](https://github.com/zulip/zulip/tree/1.3.7/puppet/zulip/files/nginx/zulip-include-common)\n- [zulip/puppet/zulip/files/nginx/nginx.conf](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/nginx/nginx.conf)\n- [zulip/puppet/zulip/files/nginx/fastcgi_params](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/nginx/fastcgi_params)\n\n## [zulip/puppet/zulip/manifests/supervisor.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/supervisor.pp)\n\n```pp\nclass zulip::supervisor {\n  $supervisor_packages = [# Needed to run supervisor\n                          \"supervisor\",\n\n\u30fb\u30fb\u30fb\u4e2d\u7565\u30fb\u30fb\u30fb\n\n    # The \"restart\" option in the init script does not work.  We could\n    # tell Puppet to fall back to stop/start, which does work, but the\n    # better option is to tell supervisord to reread its config via\n    # supervisorctl and then to \"update\".  You need to do both --\n    # after a \"reread\", supervisor won't actually take actual based on\n    # the changed configuration until you do an \"update\" (I assume\n    # this is so you can check if your config file parses without\n    # doing anything, but it's really confusing)\n    hasrestart => true,\n    restart => \"bash -c 'supervisorctl reread && supervisorctl update'\"\n  }\n\u30fb\u30fb\u30fb\u4ee5\u4e0b\u7701\u7565\u30fb\u30fb\u30fb\n```\n\n- [zulip/puppet/zulip/files/supervisor/supervisord.conf](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/supervisor/supervisord.conf)\n\n# [zulip/puppet/zulip/manifests/app_frontend.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/app_frontend.pp)\uff08\u7d9a\u304d\uff09\n\n```pp\n  $web_packages = [ # Needed for memcached usage\n                    \"memcached\",\n                    \"python-pylibmc\",\n                    # Fast JSON parser\n                    \"python-ujson\",\n\n\u30fb\u30fb\u30fb\u4e2d\u7565\u30fb\u30fb\u30fb\n\n                    ]\n  define safepackage ( $ensure = present ) {\n    if !defined(Package[$title]) {\n      package { $title: ensure => $ensure }\n    }\n  }\n  safepackage { $web_packages: ensure => \"installed\" }\n```\n\n```pp\n  file { \"/etc/nginx/zulip-include/app\":\n    require => Package[\"nginx-full\"],\n    owner  => \"root\",\n    group  => \"root\",\n    mode => 644,\n    source => \"puppet:///modules/zulip/nginx/zulip-include-frontend/app\",\n    notify => Service[\"nginx\"],\n  }\n\n\u30fb\u30fb\u30fb\u4ee5\u4e0b\u7701\u7565\u30fb\u30fb\u30fb\n```\n\n[zulip/puppet/zulip/files/nginx/zulip-include-frontend/app](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/nginx/zulip-include-frontend/app)\n[zulip/puppet/zulip/files/nginx/zulip-include-frontend/upstreams](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/nginx/zulip-include-frontend/upstreams)\n[zulip/puppet/zulip/files/nginx/zulip-include-frontend/uploads.types](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/nginx/zulip-include-frontend/uploads.types)\n[zulip/puppet/zulip/files/memcached.conf](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/memcached.conf)\n[zulip/puppet/zulip/files/supervisor/conf.d/zulip.conf](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/supervisor/conf.d/zulip.conf)\n\n## [zulip/puppet/zulip/files/nginx/zulip-include-frontend/app](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/nginx/zulip-include-frontend/app)\n\n```\naccess_log /var/log/nginx/access.log;\nerror_log /var/log/nginx/error.log;\n\n# Enable HSTS: tell browsers to always use HTTPS\nadd_header Strict-Transport-Security max-age=15768000;\n\n# Serve a custom error page when the app is down\nerror_page 502 503 504 /static/html/5xx.html;\n\n# Serve static files directly\nlocation /static/ {\n    alias /home/zulip/prod-static/;\n    error_page 404 /static/html/404.html;\n}\n\n\u30fb\u30fb\u30fb\u4e2d\u7565\u30fb\u30fb\u30fb\n\ninclude /etc/nginx/zulip-include/app.d/*.conf;\n```\n\n## [zulip/puppet/zulip/files/nginx/zulip-include-frontend/upstreams](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/nginx/zulip-include-frontend/upstreams)\n\n```upstreams\nupstream django {\n    server unix:/home/zulip/deployments/fastcgi-socket;\n}\n\nupstream tornado {\n    server localhost:9993;\n    keepalive 10000;\n}\n\nupstream localhost_sso {\n    server localhost:8888;\n}\n```\n\n## [zulip/puppet/zulip/files/nginx/zulip-include-frontend/uploads.types](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/nginx/zulip-include-frontend/uploads.types)\n\n```\ntypes {\n    text/plain                            txt;\n\n    image/gif                             gif;\n    image/jpeg                            jpeg jpg;\n    image/png                             png;\n    image/tiff                            tif tiff;\n    image/webp                            webp;\n\n    video/3gpp                            3gpp 3gp;\n    video/mp4                             mp4;\n    video/mpeg                            mpeg mpg;\n    video/quicktime                       mov;\n    video/webm                            webm;\n    video/x-flv                           flv;\n    video/x-m4v                           m4v;\n    video/x-mng                           mng;\n    video/x-ms-asf                        asx asf;\n    video/x-ms-wmv                        wmv;\n    video/x-msvideo                       avi;\n}\n```\n\n## [zulip/puppet/zulip/files/memcached.conf](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/memcached.conf)\n\n```\n-d\n-m 512\n-p 11211\n-u nobody\n```\n\n## [zulip/puppet/zulip/files/supervisor/conf.d/zulip.conf](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/supervisor/conf.d/zulip.conf)\n\nsupervisor\n[\uff08\u53c2\u8003\uff09Supervisor - Configuration File](http://supervisord.org/configuration.html)\n\n- fcgi-program:zulip-django\n- program:zulip-tornado\n- program:zulip-events-user-activity\n- program:zulip-events-user-activity-interval\n- program:zulip-events-user-presence\n- program:zulip-events-signups\n- program:zulip-events-confirmation-emails\n- program:zulip-events-missedmessage_reminders\n- program:zulip-events-missedmessage_mobile_notifications\n- program:zulip-events-slowqueries\n- program:zulip-events-message_sender\n- program:zulip-events-feedback_messages\n- program:zulip-events-error_reports\n- program:zulip-events-digest_emails\n- program:zulip-events-email_mirror\n- program:zulip-deliver-enqueued-emails\n- group:zulip-workers\n- group:zulip-senders\n\n# [zulip/puppet/zulip/manifests/postgres_appdb.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/postgres_appdb.pp)\n\n```pp\nclass zulip::postgres_appdb {\n  include zulip::postgres_common\n  include zulip::supervisor\n```\n\n- [zulip/puppet/zulip/manifests/postgres_common.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/postgres_common.pp)\n- [ulip/puppet/zulip/manifests/supervisor.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/supervisor.pp) \uff08\u524d\u8ff0\uff09\n\n### [zulip/puppet/zulip/manifests/postgres_common.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/postgres_common.pp)\n\n```pp\nclass zulip::postgres_common {\n\n\u30fb\u30fb\u30fb\u4e2d\u7565\u30fb\u30fb\u30fb\n\n  exec { \"disable_logrotate\":\n    command => \"/usr/bin/dpkg-divert --rename --divert /etc/logrotate.d/postgresql-common.disabled --add /etc/logrotate.d/postgresql-common\",\n    creates => '/etc/logrotate.d/postgresql-common.disabled',\n  }\n}\n```\n\n# [zulip/puppet/zulip/manifests/postgres_appdb.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/postgres_appdb.pp)\uff08\u7d9a\u304d\uff09\n\n- [zulip/puppet/zulip/files/postgresql/process_fts_updates](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/postgresql/process_fts_updates)\n- [zulip/puppet/zulip/files/supervisor/conf.d/zulip_db.conf](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/supervisor/conf.d/zulip_db.conf)\n- [zulip/puppet/zulip/files/postgresql/zulip_english.stop](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/postgresql/zulip_english.stop)\n\nsupervisor\n\n- program:process-fts-updates\n\n# [zulip/puppet/zulip/manifests/redis.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/redis.pp)\n\n```pp\nclass zulip::redis {\n  $redis_packages = [ # The server itself\n                      \"redis-server\",\n                      ]\n\n  package { $redis_packages: ensure => \"installed\" }\n\n  file { \"/etc/redis/redis.conf\":\n    require => Package[redis-server],\n    ensure => file,\n    owner  => \"root\",\n    group  => \"root\",\n    mode => 644,\n    source => \"puppet:///modules/zulip/redis/redis.conf\",\n  }\n\n  service { 'redis-server':\n    ensure     => running,\n    subscribe  => File['/etc/redis/redis.conf'],\n  }\n}\n```\n\n- [zulip/puppet/zulip/files/redis/redis.conf](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/redis/redis.conf)\n\n```\n################################ GENERAL  #####################################\ndaemonize yes\nport 6379\nbind 127.0.0.1\ntimeout 0\ntcp-keepalive 0\nloglevel notice\nlogfile /var/log/redis/redis-server.log\ndatabases 16\n################################ SNAPSHOTTING  ################################\nsave 900 1\nsave 300 10\nsave 60 10000\nstop-writes-on-bgsave-error yes\nrdbcompression yes\nrdbchecksum yes\ndbfilename dump.rdb\ndir /var/lib/redis\n################################# REPLICATION #################################\nslave-serve-stale-data yes\nslave-read-only yes\nrepl-disable-tcp-nodelay no\nslave-priority 100\n############################## APPEND ONLY MODE ###############################\nappendonly no\nappendfilename \"appendonly.aof\"\nappendfsync everysec\nno-appendfsync-on-rewrite no\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\n################################ LUA SCRIPTING  ###############################\nlua-time-limit 5000\n################################## SLOW LOG ###################################\nslowlog-log-slower-than 10000\nslowlog-max-len 128\n############################# Event notification ##############################\nnotify-keyspace-events \"\"\n############################### ADVANCED CONFIG ###############################\nhash-max-ziplist-entries 512\nhash-max-ziplist-value 64\nlist-max-ziplist-entries 512\nlist-max-ziplist-value 64\nset-max-intset-entries 512\nzset-max-ziplist-entries 128\nzset-max-ziplist-value 64\nactiverehashing yes\nclient-output-buffer-limit normal 0 0 0\nclient-output-buffer-limit slave 256mb 64mb 60\nclient-output-buffer-limit pubsub 32mb 8mb 60\nhz 10\naof-rewrite-incremental-fsync yes\nsave \"\"\n```\n", "tags": ["Zulip", "Puppet"]}