{"context": " More than 1 year has passed since last update.\u3053\u3093\u3070\u3093\u306f\u3001cloudpack \u306e @dz_ \u3053\u3068\u5927\u5e73\u304b\u3065\u307f \u3067\u3059\u3002\n\nPrologue - \u306f\u3058\u3081\u306b\n\u524d\u56de\u306b\u5f15\u304d\u7d9a\u304d\u3001Serf \u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8aad\u307f\u9032\u3081\u307e\u3059\u3088\uff01\n\nSerf: \u30af\u30e9\u30b9\u30bf\u3078\u306e\u53c2\u52a0\nJoin a Cluster \u3092\u8aad\u307f\u307e\u3059\u3002\n\nIn the previous page, we started our first agent. While it showed how easy it is to run Serf, it wasn't very exciting since we simply made a cluster of one member. In this page, we'll create a real cluster with multiple members.\n\n\"\u524d\u30da\u30fc\u30b8\u3067\u306f\u3001\u6700\u521d\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u8d77\u52d5\u3057\u307e\u3057\u305f\u3002Serf\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3069\u3093\u3060\u306b\u7c21\u5358\u304b\u304a\u898b\u305b\u3067\u304d\u305f\u3068\u601d\u3044\u307e\u3059\u304c\u30011\u30af\u30e9\u30b9\u30bf\u306b1\u30e1\u30f3\u30d0\u30fc\u3068\u3044\u3046\u30b7\u30f3\u30d7\u30eb\u306a\u3082\u306e\u306a\u306e\u3067\u3001\u975e\u5e38\u306b\u8208\u596e\u3059\u308b\u3068\u3044\u3046\u307b\u3069\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u306d\u3002\u3053\u306e\u30da\u30fc\u30b8\u3067\u306f\u3001\u8907\u6570\u30e1\u30f3\u30d0\u30fc\u3092\u6301\u3064\u30ea\u30a2\u30eb\u306a\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u308a\u307e\u3057\u3087\u3046\u3002\"\n\nWhen starting a Serf agent, it begins without knowledge of any other node, and is an isolated cluster of one. To learn about other cluster members, the agent must join an existing cluster. To join an existing cluster, Serf only needs to know about a single existing member. After it joins, the agent will gossip with this member and quickly discover the other members in the cluster.\n\n\"1\u3064\u306eSerf\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u8d77\u52d5\u3059\u308b\u3068\u304d\u3001\u4ed6\u306e\u30ce\u30fc\u30c9\u306b\u95a2\u3059\u308b\u60c5\u5831\u306f\u6301\u3061\u5408\u308f\u305b\u3066\u304a\u3089\u305a\u3001\u4e00\u4eba\u304d\u308a\u306e\u5b64\u7acb\u3057\u305f\u30af\u30e9\u30b9\u30bf\u3067\u3059\u3002\u30af\u30e9\u30b9\u30bf\u306e\u4ed6\u306e\u30e1\u30f3\u30d0\u30fc\u306b\u3064\u3044\u3066\u628a\u63e1\u3059\u308b\u305f\u3081\u306b\u306f\u3001\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u5b58\u5728\u3059\u308b\u30af\u30e9\u30b9\u30bf\u306b \u53c2\u52a0 \u3057\u306a\u3044\u3068\u306a\u308a\u307e\u305b\u3093\u3002\u65e2\u5b58\u306e\u30af\u30e9\u30b9\u30bf\u306b\u53c2\u52a0\u3059\u308b\u306b\u306f\u3001Serf\u306f\u305f\u3060\u30011\u4eba\u306e\u5b58\u5728\u3059\u308b\u30e1\u30f3\u30d0\u30fc\u306e\u3053\u3068\u3092\u77e5\u308c\u3070\u3088\u3044\u306e\u3067\u3059\u3002\u53c2\u52a0\u3057\u305f\u5f8c\u306f\u3001\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u3053\u306e\u30e1\u30f3\u30d0\u30fc\u3068gossip\u3067\u901a\u4fe1\u3092\u59cb\u3081\u3001\u30af\u30e9\u30b9\u30bf\u306e\u307b\u304b\u306e\u30e1\u30f3\u30d0\u30fc\u304c\u3059\u3050\u306b\u6c17\u3065\u304d\u307e\u3059\u3002\"\n\n\u8907\u6570\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u8d77\u52d5\n\nStarting the Agents\nTo simulate a more realistic cluster, we are using a two node cluster in Vagrant. The Vagrantfile can be found in the demo section of the repo [here][repo has vagrantfile].\n\n\u3088\u308a\u672c\u7269\u306b\u8fd1\u3044\u30af\u30e9\u30b9\u30bf\u3092\u30b7\u30df\u30e5\u30ec\u30fc\u30c8\u3059\u308b\u306b\u306f\u30012\u3064\u306e\u30ce\u30fc\u30c9\u30af\u30e9\u30b9\u30bf\u3092 Vagrant \u3092\u4f7f\u3063\u3066\u4f5c\u308a\u307e\u3059\u3002Vagrantfile \u306f[\u3053\u306e\u30ea\u30dd\u30b8\u30c8\u30ea][repo has vagranfile]\u306e\u30c7\u30e2\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u3092\u3054\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\nWe start the first agent on our first node and also specify a node name. The node name must be unique and is how a machine is uniquely identified. By default it is the hostname of the machine, but we'll manually override it. We are also providing a bind address. This is the address that Serf listens on, and it must be accessible by all other nodes in the cluster.\n\n\"\u79c1\u305f\u3061\u306f\u6700\u521d\u306e\u30ce\u30fc\u30c9\u306e\u6700\u521d\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u8d77\u52d5\u3057\u3001\u30ce\u30fc\u30c9\u540d\u3092\u6307\u5b9a\u3057\u307e\u3057\u3087\u3046\u3002\u30ce\u30fc\u30c9\u540d\u306f\u30e6\u30cb\u30fc\u30af\u3067\u306a\u3051\u308c\u3070\u306a\u3089\u305a\u3001\u3053\u308c\u304c\u30de\u30b7\u30f3\u304c\u4e00\u610f\u3067\u8b58\u5225\u3067\u304d\u308b\u6240\u4ee5\u3067\u3059\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001\u30de\u30b7\u30f3\u306e\u30db\u30b9\u30c8\u30cd\u30fc\u30e0\u304c\u5272\u308a\u5f53\u3066\u3089\u308c\u307e\u3059\u304c\u3001\u624b\u52d5\u3067\u4e0a\u66f8\u304d\u3067\u304d\u307e\u3059\u3002\u307e\u305f\u3001\u30d0\u30a4\u30f3\u30c9\u3059\u308b\u30a2\u30c9\u30ec\u30b9\u3082\u4e0e\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u306fSerf\u304cListen\u3059\u308b\u30a2\u30c9\u30ec\u30b9\u3067\u3042\u308a\u3001\u30af\u30e9\u30b9\u30bf\u306e\u3059\u3079\u3066\u306e\u307b\u304b\u306e\u30ce\u30fc\u30c9\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\"\n$ serf agent -node=agent-one -bind=172.20.20.10\n...\n\n\nThen, in another terminal, start the second agent on the new node. This time, we set the bind address to match the IP of the second node as specified in the Vagrantfile. In production, you will generally want to provide a bind address or interface as well.\n\n\"\u305d\u308c\u304b\u3089\u3001\u5225\u306e\u30bf\u30fc\u30df\u30ca\u30eb\u3067\u3001\u65b0\u3057\u3044\u30ce\u30fc\u30c9\u4e0a\u30672\u756a\u76ee\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\u3053\u306e\u3068\u304d\u3001\u30d0\u30a4\u30f3\u30c9\u30a2\u30c9\u30ec\u30b9\u3092\u3001Vagrantfile\u306e\u4e2d\u3067\u6307\u5b9a\u3057\u3066\u3044\u308b\u30012\u756a\u76ee\u306e\u30ce\u30fc\u30c9\u306eIP\u3068\u5408\u3046\u3082\u306e\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u672c\u756a\u74b0\u5883\u3067\u306f\u3001\u540c\u69d8\u306b\u3001\u4e00\u822c\u7684\u306b\u30d0\u30a4\u30f3\u30c9\u30a2\u30c9\u30ec\u30b9\u3084\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u4e0e\u3048\u305f\u3044\u3060\u308d\u3046(?)\u3002\"\n$ serf agent -node=agent-two -bind=172.20.20.11\n...\n\n\nAt this point, you have two Serf agents running. The two Serf agents still don't know anything about each other, and are each part of their own clusters (of one member). You can verify this by running serf members against each agent and noting that only one member is a part of each.\n\n\"\u3053\u306e\u6bb5\u968e\u3067\u306f\u30012\u3064\u306eSerf\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u7a3c\u50cd\u3057\u3066\u3044\u308b\u72b6\u614b\u3067\u3059\u3002\u3053\u306e2\u3064\u306eSerf\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u307e\u3060\u4e92\u3044\u306e\u3053\u3068\u3092\u4f55\u3082\u77e5\u3089\u305a\u3001\u305d\u308c\u305e\u308c\u306e\u30af\u30e9\u30b9\u30bf(\u30e1\u30f3\u30d0\u30fc\u306f1\u4eba)\u306b\u5c5e\u3057\u3066\u3044\u308b\u72b6\u614b\u3067\u3059\u3002\u305d\u308c\u305e\u308c\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306b\u5bfe\u3057\u3066 serf membars \u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067\u3001\u3042\u306a\u305f\u306f\u3053\u308c\u3092\u78ba\u304b\u3081\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u305d\u308c\u305e\u308c\u304c1\u4eba\u306e\u30e1\u30f3\u30d0\u30fc\u3067\u3042\u308b\u3053\u3068\u3082\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\"\n\n\u30af\u30e9\u30b9\u30bf\u3078\u306e\u53c2\u52a0\n\nNow, let's tell the first agent to join the second agent by running the following command in a new terminal:\n\n\"\u305d\u308c\u3067\u306f\u3001\u65b0\u3057\u3044\u30bf\u30fc\u30df\u30ca\u30eb\u304b\u3089\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u3001\u6700\u521d\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306b2\u756a\u76ee\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30af\u30e9\u30b9\u30bf\u306b\u53c2\u52a0\u3092\u901a\u77e5\u3057\u3066\u307f\u307e\u3057\u3087\u3046\"\n$ serf join 172.20.20.11\nSuccessfully joined cluster by contacting 1 nodes.\n\n\nYou should see some log output in each of the agent logs. If you read carefully, you'll see that they received join information. If you run serf members against each agent, you'll see that both agents now know about each other:\n\n\"\u305d\u308c\u305e\u308c\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30ed\u30b0\u3067\u3001\u3042\u306a\u305f\u306f\u30ed\u30b0\u51fa\u529b\u3092\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3067\u3057\u3087\u3046\u3002\u6ce8\u610f\u6df1\u304f\u8aad\u3093\u3067\u307f\u308b\u3068\u3001\u305d\u308c\u3089\u304c\u53c2\u52a0\u306e\u60c5\u5831\u3092\u53d7\u4fe1\u3057\u305f\u306e\u3060\u3068\u308f\u304b\u308b\u3067\u3057\u3087\u3046\u3002\u3042\u306a\u305f\u306f\u305d\u308c\u305e\u308c\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306b\u5bfe\u3057\u3066 serf members \u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u4eca\u3084\u4e92\u3044\u306e\u3053\u3068\u3092\u77e5\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3067\u3057\u3087\u3046:\"\n$ serf members\nagent-one     172.20.20.10:7946    alive\nagent-two     172.20.20.11:7946    alive\n\n\nNote: To join a cluster, a Serf agent needs to only learn about one existing member. After joining the cluster, the agents gossip with each other to propagate full membership information.\n\n\"\u30af\u30e9\u30b9\u30bf\u306b\u53c2\u52a0\u3059\u308b\u306b\u306f\u3001Serf\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u305f\u3060\u3072\u3068\u308a\u306e\u30e1\u30f3\u30d0\u30fc\u3092\u77e5\u3063\u3066\u3055\u3048\u3044\u308c\u3070\u3088\u3044\u306e\u3067\u3059\u3002\u30af\u30e9\u30b9\u30bf\u3078\u53c2\u52a0\u3057\u305f\u5f8c\u306f\u3001\u30e1\u30f3\u30d0\u30fc\u30b7\u30c3\u30d7\u306e\u5b8c\u5168\u306a\u60c5\u5831\u3092\u5e83\u3081\u308b\u305f\u3081\u306b\u3001\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u4e92\u3044\u306bgossip\u3067\u901a\u4fe1\u3092\u3057\u307e\u3059\u3002\"\n\nIn addition to using serf join you can use the -join flag on serf agent to join a cluster as part of starting up the agent.\n\n\"serf join \u3092\u4f7f\u3046\u4ed6\u306b\u3001serf agent \u3067 -join \u30d5\u30e9\u30b0\u3092\u3064\u3051\u308b\u3053\u3068\u3067\u3001\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u8d77\u52d5\u6bb5\u968e\u306e\u4e00\u90e8\u3068\u3057\u3066\u30af\u30e9\u30b9\u30bf\u3078\u306e\u53c2\u52a0\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\"\n\n\u30af\u30e9\u30b9\u30bf\u304b\u3089\u96e2\u8131\u3059\u308b\n\nTo leave the cluster, you can either gracefully quit an agent (using Ctrl-C) or force kill one of the agents. Gracefully leaving allows the node to transition into the left state, otherwise other nodes will detect it as having failed. The difference is covered in more detail [here][https://serfdom.io/intro/getting-started/agent.html#toc_3 \"Run the Agent - Serf by HashiCorp\"].\n\n\"\u30af\u30e9\u30b9\u30bf\u304b\u3089\u96e2\u8131\u3059\u308b\u306b\u306f\u3001\u6b63\u5e38\u306b\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u7d42\u4e86\u3059\u308b \n(Ctrl-C \u3092\u7528\u3044\u3066) \u304b\u3001\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u3072\u3068\u3064\u3092\u5f37\u5236\u7684\u306b\u7d42\u4e86\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u6b63\u5e38\u306a\u96e2\u8131\u306f\u3001\u305d\u306e\u30ce\u30fc\u30c9\u3092 \u96e2\u8131\u3057\u305f \u72b6\u614b\u306b\u9077\u79fb\u3055\u305b\u307e\u3059\u3002\u3082\u3046\u4e00\u65b9\u3067\u306f\u3001\u4ed6\u306e\u30ce\u30fc\u30c9\u306f \u969c\u5bb3\u304c\u767a\u751f\u3057\u305f \u3068\u691c\u77e5\u3059\u308b\u3067\u3057\u3087\u3046\u3002\u3053\u306e\u9055\u3044\u306b\u3064\u3044\u3066\u306f\u3001\u3053\u3061\u3089 \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\"\n\nEpilogue -\u3000\u304a\u308f\u308a\u306b\n\u5b9f\u306f\u3001\u3053\u306e\u8a33\u3092\u3057\u306a\u304c\u3089\u3001 Amazon EC2 \u3067\u5b9f\u8df5\u3057\u3088\u3046\u3068\u3057\u305f\u3093\u3067\u3059\u304c\u2026\nAmazon EC2 \u4e0a\u3067\u306f Vagrant \u304c\u52d5\u304b\u306a\u3044\u3053\u3068\u3092\u77e5\u308a\u307e\u3057\u305f\u2026orz\n\u7406\u5c48\u306f\u5468\u308a\u306b\u6559\u3048\u3066\u3082\u3089\u3063\u3066\u7406\u89e3\u3067\u304d\u307e\u3057\u305f\u3002\n\u7121\u7406\u77e2\u7406 VirtualBox \u8f09\u305b\u3088\u3046\u304b\u3068\u601d\u3044\u307e\u3057\u305f\u304c\u3001\u3082\u3046\u5c11\u3057\u8aad\u307f\u9032\u3081\u3066\u3001\u5916\u90e8\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3068\u901a\u4fe1\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u5b9f\u9a13\u3057\u3088\u3046\u304b\u3068\u8003\u3048\u3066\u3044\u307e\u3059\u3002\n\u521d\u5fc3\u8005\u3067\u306f\u3084\u306f\u308a\u884c\u304d\u8a70\u307e\u308b\u3068\u3053\u308d\u304c\u51fa\u3066\u304d\u307e\u3057\u305f\u304c\u3001\u3086\u3063\u304f\u308a\u3057\u3063\u304b\u308a\u89e3\u6c7a\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\nQiita \u3067\u306e Serf \u95a2\u9023\u8a18\u4e8b\u306f\u3053\u3061\u3089\u3067\u3059\u3002\n\nSerf - Getting Started \uff5e \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8aad\u3093\u3067\u307f\u307e\u3059\nCheck! Serf - \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u3064\u3044\u3066\nCheck! Serf - \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u5b9f\u884c\u3068\u7d42\u4e86\n\nSerf \u307e\u3068\u3081\u3001Amazon Lambda \u306b\u3064\u3044\u3066\u3001\u3053\u3061\u3089\u3067\u8a18\u4e8b\u66f8\u3044\u3066\u3044\u308b\u306e\u3067\u3082\u3057\u3054\u8208\u5473\u3042\u308c\u3070\u3069\u3046\u305e\uff01\n\nSerf \u306f\u3058\u3081\u3066\u306e\u904b\u7528\u30c4\u30fc\u30eb \u301c \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u8d77\u52d5\n\u5927\u5e73 \u304b\u3065\u307f \u306e\u8a18\u4e8b\u4e00\u89a7\n\n\u3053\u3093\u3070\u3093\u306f\u3001[cloudpack][] \u306e @dz_ \u3053\u3068[\u5927\u5e73\u304b\u3065\u307f][] \u3067\u3059\u3002\n\nPrologue - \u306f\u3058\u3081\u306b\n====================================================\n\u524d\u56de\u306b\u5f15\u304d\u7d9a\u304d\u3001[Serf][] \u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8aad\u307f\u9032\u3081\u307e\u3059\u3088\uff01\n\n[Serf]:https://serfdom.io/ \"Serf by HashiCorp\"\n\nSerf: \u30af\u30e9\u30b9\u30bf\u3078\u306e\u53c2\u52a0\n====================================================\n[Join a Cluster][] \u3092\u8aad\u307f\u307e\u3059\u3002\n[Join a Cluster]:https://serfdom.io/intro/getting-started/join.html \"Join a Cluster - Serf by HashiCorp\"\n\n> In the previous page, we started our first agent. While it showed how easy it is to run Serf, it wasn't very exciting since we simply made a cluster of one member. In this page, we'll create a real cluster with multiple members.\n\n&quot;\u524d\u30da\u30fc\u30b8\u3067\u306f\u3001\u6700\u521d\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u8d77\u52d5\u3057\u307e\u3057\u305f\u3002Serf\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3069\u3093\u3060\u306b\u7c21\u5358\u304b\u304a\u898b\u305b\u3067\u304d\u305f\u3068\u601d\u3044\u307e\u3059\u304c\u30011\u30af\u30e9\u30b9\u30bf\u306b1\u30e1\u30f3\u30d0\u30fc\u3068\u3044\u3046\u30b7\u30f3\u30d7\u30eb\u306a\u3082\u306e\u306a\u306e\u3067\u3001\u975e\u5e38\u306b\u8208\u596e\u3059\u308b\u3068\u3044\u3046\u307b\u3069\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u306d\u3002\u3053\u306e\u30da\u30fc\u30b8\u3067\u306f\u3001\u8907\u6570\u30e1\u30f3\u30d0\u30fc\u3092\u6301\u3064\u30ea\u30a2\u30eb\u306a\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u308a\u307e\u3057\u3087\u3046\u3002&quot;\n\n> When starting a Serf agent, it begins without knowledge of any other node, and is an isolated cluster of one. To learn about other cluster members, the agent must *join* an existing cluster. To join an existing cluster, Serf only needs to know about a single existing member. After it joins, the agent will gossip with this member and quickly discover the other members in the cluster.\n\n&quot;1\u3064\u306eSerf\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u8d77\u52d5\u3059\u308b\u3068\u304d\u3001\u4ed6\u306e\u30ce\u30fc\u30c9\u306b\u95a2\u3059\u308b\u60c5\u5831\u306f\u6301\u3061\u5408\u308f\u305b\u3066\u304a\u3089\u305a\u3001\u4e00\u4eba\u304d\u308a\u306e\u5b64\u7acb\u3057\u305f\u30af\u30e9\u30b9\u30bf\u3067\u3059\u3002\u30af\u30e9\u30b9\u30bf\u306e\u4ed6\u306e\u30e1\u30f3\u30d0\u30fc\u306b\u3064\u3044\u3066\u628a\u63e1\u3059\u308b\u305f\u3081\u306b\u306f\u3001\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u5b58\u5728\u3059\u308b\u30af\u30e9\u30b9\u30bf\u306b *\u53c2\u52a0* \u3057\u306a\u3044\u3068\u306a\u308a\u307e\u305b\u3093\u3002\u65e2\u5b58\u306e\u30af\u30e9\u30b9\u30bf\u306b\u53c2\u52a0\u3059\u308b\u306b\u306f\u3001Serf\u306f\u305f\u3060\u30011\u4eba\u306e\u5b58\u5728\u3059\u308b\u30e1\u30f3\u30d0\u30fc\u306e\u3053\u3068\u3092\u77e5\u308c\u3070\u3088\u3044\u306e\u3067\u3059\u3002\u53c2\u52a0\u3057\u305f\u5f8c\u306f\u3001\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u3053\u306e\u30e1\u30f3\u30d0\u30fc\u3068gossip\u3067\u901a\u4fe1\u3092\u59cb\u3081\u3001\u30af\u30e9\u30b9\u30bf\u306e\u307b\u304b\u306e\u30e1\u30f3\u30d0\u30fc\u304c\u3059\u3050\u306b\u6c17\u3065\u304d\u307e\u3059\u3002&quot;\n\n\u8907\u6570\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u8d77\u52d5\n----------------------------------------------------\n\n> Starting the Agents\n> To simulate a more realistic cluster, we are using a two node cluster in Vagrant. The Vagrantfile can be found in the demo section of the repo [here][repo has vagrantfile].\n\n\u3088\u308a\u672c\u7269\u306b\u8fd1\u3044\u30af\u30e9\u30b9\u30bf\u3092\u30b7\u30df\u30e5\u30ec\u30fc\u30c8\u3059\u308b\u306b\u306f\u30012\u3064\u306e\u30ce\u30fc\u30c9\u30af\u30e9\u30b9\u30bf\u3092 Vagrant \u3092\u4f7f\u3063\u3066\u4f5c\u308a\u307e\u3059\u3002Vagrantfile \u306f[\u3053\u306e\u30ea\u30dd\u30b8\u30c8\u30ea][repo has vagranfile]\u306e\u30c7\u30e2\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u3092\u3054\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\n[repo has Avagrantfile]:https://github.com/hashicorp/serf/tree/master/demo/vagrant-cluster \"serf/demo/vagrant-cluster at master \u00b7 hashicorp/serf\"\n\n> We start the first agent on our first node and also specify a node name. The node name must be unique and is how a machine is uniquely identified. By default it is the hostname of the machine, but we'll manually override it. We are also providing a bind address. This is the address that Serf listens on, and it must be accessible by all other nodes in the cluster.\n\n&quot;\u79c1\u305f\u3061\u306f\u6700\u521d\u306e\u30ce\u30fc\u30c9\u306e\u6700\u521d\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u8d77\u52d5\u3057\u3001\u30ce\u30fc\u30c9\u540d\u3092\u6307\u5b9a\u3057\u307e\u3057\u3087\u3046\u3002\u30ce\u30fc\u30c9\u540d\u306f\u30e6\u30cb\u30fc\u30af\u3067\u306a\u3051\u308c\u3070\u306a\u3089\u305a\u3001\u3053\u308c\u304c\u30de\u30b7\u30f3\u304c\u4e00\u610f\u3067\u8b58\u5225\u3067\u304d\u308b\u6240\u4ee5\u3067\u3059\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001\u30de\u30b7\u30f3\u306e\u30db\u30b9\u30c8\u30cd\u30fc\u30e0\u304c\u5272\u308a\u5f53\u3066\u3089\u308c\u307e\u3059\u304c\u3001\u624b\u52d5\u3067\u4e0a\u66f8\u304d\u3067\u304d\u307e\u3059\u3002\u307e\u305f\u3001\u30d0\u30a4\u30f3\u30c9\u3059\u308b\u30a2\u30c9\u30ec\u30b9\u3082\u4e0e\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u306fSerf\u304cListen\u3059\u308b\u30a2\u30c9\u30ec\u30b9\u3067\u3042\u308a\u3001\u30af\u30e9\u30b9\u30bf\u306e\u3059\u3079\u3066\u306e\u307b\u304b\u306e\u30ce\u30fc\u30c9\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002&quot;\n\n```bash\n$ serf agent -node=agent-one -bind=172.20.20.10\n...\n```\n\n> Then, in another terminal, start the second agent on the new node. This time, we set the bind address to match the IP of the second node as specified in the Vagrantfile. In production, you will generally want to provide a bind address or interface as well.\n\n&quot;\u305d\u308c\u304b\u3089\u3001\u5225\u306e\u30bf\u30fc\u30df\u30ca\u30eb\u3067\u3001\u65b0\u3057\u3044\u30ce\u30fc\u30c9\u4e0a\u30672\u756a\u76ee\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\u3053\u306e\u3068\u304d\u3001\u30d0\u30a4\u30f3\u30c9\u30a2\u30c9\u30ec\u30b9\u3092\u3001Vagrantfile\u306e\u4e2d\u3067\u6307\u5b9a\u3057\u3066\u3044\u308b\u30012\u756a\u76ee\u306e\u30ce\u30fc\u30c9\u306eIP\u3068\u5408\u3046\u3082\u306e\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u672c\u756a\u74b0\u5883\u3067\u306f\u3001\u540c\u69d8\u306b\u3001\u4e00\u822c\u7684\u306b\u30d0\u30a4\u30f3\u30c9\u30a2\u30c9\u30ec\u30b9\u3084\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u4e0e\u3048\u305f\u3044\u3060\u308d\u3046(?)\u3002&quot;\n\n```bash\n$ serf agent -node=agent-two -bind=172.20.20.11\n...\n```\n\n> At this point, you have two Serf agents running. The two Serf agents still don't know anything about each other, and are each part of their own clusters (of one member). You can verify this by running serf members against each agent and noting that only one member is a part of each.\n\n&quot;\u3053\u306e\u6bb5\u968e\u3067\u306f\u30012\u3064\u306eSerf\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u7a3c\u50cd\u3057\u3066\u3044\u308b\u72b6\u614b\u3067\u3059\u3002\u3053\u306e2\u3064\u306eSerf\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u307e\u3060\u4e92\u3044\u306e\u3053\u3068\u3092\u4f55\u3082\u77e5\u3089\u305a\u3001\u305d\u308c\u305e\u308c\u306e\u30af\u30e9\u30b9\u30bf(\u30e1\u30f3\u30d0\u30fc\u306f1\u4eba)\u306b\u5c5e\u3057\u3066\u3044\u308b\u72b6\u614b\u3067\u3059\u3002\u305d\u308c\u305e\u308c\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306b\u5bfe\u3057\u3066 `serf membars` \u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067\u3001\u3042\u306a\u305f\u306f\u3053\u308c\u3092\u78ba\u304b\u3081\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u305d\u308c\u305e\u308c\u304c1\u4eba\u306e\u30e1\u30f3\u30d0\u30fc\u3067\u3042\u308b\u3053\u3068\u3082\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002&quot;\n\n\u30af\u30e9\u30b9\u30bf\u3078\u306e\u53c2\u52a0\n-----------------------------------------------------\n\n> Now, let's tell the first agent to join the second agent by running the following command in a new terminal:\n\n&quot;\u305d\u308c\u3067\u306f\u3001\u65b0\u3057\u3044\u30bf\u30fc\u30df\u30ca\u30eb\u304b\u3089\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u3001\u6700\u521d\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306b2\u756a\u76ee\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30af\u30e9\u30b9\u30bf\u306b\u53c2\u52a0\u3092\u901a\u77e5\u3057\u3066\u307f\u307e\u3057\u3087\u3046&quot;\n\n```bash\n$ serf join 172.20.20.11\nSuccessfully joined cluster by contacting 1 nodes.\n```\n\n> You should see some log output in each of the agent logs. If you read carefully, you'll see that they received join information. If you run `serf members` against each agent, you'll see that both agents now know about each other:\n\n&quot;\u305d\u308c\u305e\u308c\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30ed\u30b0\u3067\u3001\u3042\u306a\u305f\u306f\u30ed\u30b0\u51fa\u529b\u3092\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3067\u3057\u3087\u3046\u3002\u6ce8\u610f\u6df1\u304f\u8aad\u3093\u3067\u307f\u308b\u3068\u3001\u305d\u308c\u3089\u304c\u53c2\u52a0\u306e\u60c5\u5831\u3092\u53d7\u4fe1\u3057\u305f\u306e\u3060\u3068\u308f\u304b\u308b\u3067\u3057\u3087\u3046\u3002\u3042\u306a\u305f\u306f\u305d\u308c\u305e\u308c\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306b\u5bfe\u3057\u3066 `serf members` \u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u4eca\u3084\u4e92\u3044\u306e\u3053\u3068\u3092\u77e5\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3067\u3057\u3087\u3046:&quot;\n\n```bash\n$ serf members\nagent-one     172.20.20.10:7946    alive\nagent-two     172.20.20.11:7946    alive\n```\n\n> Note: To join a cluster, a Serf agent needs to only learn about *one existing member*. After joining the cluster, the agents gossip with each other to propagate full membership information.\n\n&quot;\u30af\u30e9\u30b9\u30bf\u306b\u53c2\u52a0\u3059\u308b\u306b\u306f\u3001Serf\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u305f\u3060\u3072\u3068\u308a\u306e\u30e1\u30f3\u30d0\u30fc\u3092\u77e5\u3063\u3066\u3055\u3048\u3044\u308c\u3070\u3088\u3044\u306e\u3067\u3059\u3002\u30af\u30e9\u30b9\u30bf\u3078\u53c2\u52a0\u3057\u305f\u5f8c\u306f\u3001\u30e1\u30f3\u30d0\u30fc\u30b7\u30c3\u30d7\u306e\u5b8c\u5168\u306a\u60c5\u5831\u3092\u5e83\u3081\u308b\u305f\u3081\u306b\u3001\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u4e92\u3044\u306bgossip\u3067\u901a\u4fe1\u3092\u3057\u307e\u3059\u3002&quot;\n\n> In addition to using `serf join` you can use the `-join` flag on `serf agent` to join a cluster as part of starting up the agent.\n\n&quot;`serf join` \u3092\u4f7f\u3046\u4ed6\u306b\u3001`serf agent` \u3067 `-join` \u30d5\u30e9\u30b0\u3092\u3064\u3051\u308b\u3053\u3068\u3067\u3001\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u8d77\u52d5\u6bb5\u968e\u306e\u4e00\u90e8\u3068\u3057\u3066\u30af\u30e9\u30b9\u30bf\u3078\u306e\u53c2\u52a0\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002&quot;\n\n\u30af\u30e9\u30b9\u30bf\u304b\u3089\u96e2\u8131\u3059\u308b\n---------------------------------------------------\n\n> To leave the cluster, you can either gracefully quit an agent (using `Ctrl-C`) or force kill one of the agents. Gracefully leaving allows the node to transition into the left state, otherwise other nodes will detect it as having failed. The difference is covered in more detail [here][https://serfdom.io/intro/getting-started/agent.html#toc_3 \"Run the Agent - Serf by HashiCorp\"].\n\n&quot;\u30af\u30e9\u30b9\u30bf\u304b\u3089\u96e2\u8131\u3059\u308b\u306b\u306f\u3001\u6b63\u5e38\u306b\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u7d42\u4e86\u3059\u308b \n(`Ctrl-C` \u3092\u7528\u3044\u3066) \u304b\u3001\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u3072\u3068\u3064\u3092\u5f37\u5236\u7684\u306b\u7d42\u4e86\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u6b63\u5e38\u306a\u96e2\u8131\u306f\u3001\u305d\u306e\u30ce\u30fc\u30c9\u3092 *\u96e2\u8131\u3057\u305f* \u72b6\u614b\u306b\u9077\u79fb\u3055\u305b\u307e\u3059\u3002\u3082\u3046\u4e00\u65b9\u3067\u306f\u3001\u4ed6\u306e\u30ce\u30fc\u30c9\u306f *\u969c\u5bb3\u304c\u767a\u751f\u3057\u305f* \u3068\u691c\u77e5\u3059\u308b\u3067\u3057\u3087\u3046\u3002\u3053\u306e\u9055\u3044\u306b\u3064\u3044\u3066\u306f\u3001[\u3053\u3061\u3089](http://qiita.com/dz_/items/65f5cde8a09fa84ac88e \"Check! Serf - \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u5b9f\u884c\u3068\u7d42\u4e86\") \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002&quot;\n\nEpilogue -\u3000\u304a\u308f\u308a\u306b\n====================================================\n\n\u5b9f\u306f\u3001\u3053\u306e\u8a33\u3092\u3057\u306a\u304c\u3089\u3001 Amazon EC2 \u3067\u5b9f\u8df5\u3057\u3088\u3046\u3068\u3057\u305f\u3093\u3067\u3059\u304c\u2026\nAmazon EC2 \u4e0a\u3067\u306f Vagrant \u304c\u52d5\u304b\u306a\u3044\u3053\u3068\u3092\u77e5\u308a\u307e\u3057\u305f\u2026orz\n\u7406\u5c48\u306f\u5468\u308a\u306b\u6559\u3048\u3066\u3082\u3089\u3063\u3066\u7406\u89e3\u3067\u304d\u307e\u3057\u305f\u3002\n\u7121\u7406\u77e2\u7406 VirtualBox \u8f09\u305b\u3088\u3046\u304b\u3068\u601d\u3044\u307e\u3057\u305f\u304c\u3001\u3082\u3046\u5c11\u3057\u8aad\u307f\u9032\u3081\u3066\u3001\u5916\u90e8\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3068\u901a\u4fe1\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u5b9f\u9a13\u3057\u3088\u3046\u304b\u3068\u8003\u3048\u3066\u3044\u307e\u3059\u3002\n\n\u521d\u5fc3\u8005\u3067\u306f\u3084\u306f\u308a\u884c\u304d\u8a70\u307e\u308b\u3068\u3053\u308d\u304c\u51fa\u3066\u304d\u307e\u3057\u305f\u304c\u3001\u3086\u3063\u304f\u308a\u3057\u3063\u304b\u308a\u89e3\u6c7a\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n----\n\nQiita \u3067\u306e Serf \u95a2\u9023\u8a18\u4e8b\u306f\u3053\u3061\u3089\u3067\u3059\u3002\n\n- [Serf - Getting Started \uff5e \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8aad\u3093\u3067\u307f\u307e\u3059](http://qiita.com/dz_/items/9b0aacc1b86eff2a1147)\n- [Check! Serf - \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u3064\u3044\u3066](http://qiita.com/dz_/items/16a3bc72dfabe05294c5 \"Check! Serf - \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u3064\u3044\u3066\")\n- [Check! Serf - \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u5b9f\u884c\u3068\u7d42\u4e86](http://qiita.com/dz_/items/65f5cde8a09fa84ac88e \"Check! Serf - \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u5b9f\u884c\u3068\u7d42\u4e86\")\n\nSerf \u307e\u3068\u3081\u3001Amazon Lambda \u306b\u3064\u3044\u3066\u3001\u3053\u3061\u3089\u3067\u8a18\u4e8b\u66f8\u3044\u3066\u3044\u308b\u306e\u3067\u3082\u3057\u3054\u8208\u5473\u3042\u308c\u3070\u3069\u3046\u305e\uff01\n\n- <a href=\"http://blog.cloudpack.jp/2014/12/19/serf-my-first-orchestration-tool-vol1-install-launch-agent/\" title=\"Serf \u306f\u3058\u3081\u3066\u306e\u904b\u7528\u30c4\u30fc\u30eb \u301c \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u8d77\u52d5\" target=\"_balnk\">Serf \u306f\u3058\u3081\u3066\u306e\u904b\u7528\u30c4\u30fc\u30eb \u301c \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u8d77\u52d5</a>\n- <a href=\"http://blog.cloudpack.jp/author/oohira/\" title=\"\u5927\u5e73 \u304b\u3065\u307f \u306e\u8a18\u4e8b\u4e00\u89a7 | cloudpack\u6280\u8853\u60c5\u5831\u30b5\u30a4\u30c8\"\u3000target=\"_blank\">\u5927\u5e73 \u304b\u3065\u307f \u306e\u8a18\u4e8b\u4e00\u89a7</a>\n\n\n[cloudpack]:https://cloudpack.jp/ \"cloudpack\uff08\u30af\u30e9\u30a6\u30c9\u30d1\u30c3\u30af\uff09 400\u793e\u3092\u8d85\u3048\u308b\u5c0e\u5165\u5b9f\u7e3e! EC2\u306a\u3069AWS\u30af\u30e9\u30a6\u30c9\u306e\u5c0e\u5165\u8a2d\u8a08\u3001\u69cb\u7bc9\u3001\u904b\u7528\u4fdd\u5b88\u30b5\u30fc\u30d3\u30b9\"\n[\u5927\u5e73\u304b\u3065\u307f]:http://blog.cloudpack.jp/author/oohira/ \"\u5927\u5e73\u304b\u3065\u307f\u306e\u8a18\u4e8b\u4e00\u89a7\"\n\n", "tags": ["serf", "\u904b\u7528"]}