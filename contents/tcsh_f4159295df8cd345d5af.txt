{"tags": ["AWS", "aws-cli", "CloudFront"], "context": "cloudfront\u306e\u66f4\u65b0\u306b\u306f15\u5206\u304f\u3089\u3044\u304b\u304b\u308a\u307e\u3059...\nCLI\u306f\u3001\u30d7\u30ec\u30d3\u30e5\u30fc\u7248\u306e\u305f\u3081\u5225\u9014\u8a2d\u5b9a\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n\u524d\u63d0\u6761\u4ef6\n\nCloudFront\u3078\u306e\u6a29\u9650\nCloudFront\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\nAWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\nAWS CLI 1.10.11\n\n\n\u30b3\u30de\u30f3\u30c9\naws --version\n\n\n\n\u7d50\u679c(\u4f8b)\naws-cli/1.10.11 Python/2.7.5 Darwin/13.4.0 botocore/1.4.2\n\n\n\n0. \u6e96\u5099\n\n0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u6c7a\u5b9a\n\n0.2. \u5909\u6570\u306e\u78ba\u8a8d\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u304c\u60f3\u5b9a\u306e\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws configure list\n\n\n\n\u7d50\u679c(\u4f8b)\n\n            Name                    Value             Type    Location\n            ----                    -----             ----    --------\n         profile         s3Full-prjZ-mbp13        env    AWS_DEFAULT_PROFILE\n      access_key     ****************XXXX shared-credentials-file\n      secret_key     ****************XXXX shared-credentials-file\n          region                         ap-northeast-1  env    AWS_DEFAULT_REGION\n\n\nAssumeRole\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u306fprofile\u304c ''\u3068\u8868\u793a\u3055\u308c\u307e\u3059\u3002 \u305d\n\u308c\u4ee5\u5916\u306e\u3068\u304d\u306bprofile\u304c '' \u3068\u8868\u793a\u3055\u308c\u308b\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u3092\u5b9f\u884c\u3057\u3066\n\u304f\u3060\u3055\u3044\u3002\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nexport AWS_DEFAULT_PROFILE=<IAM\u30e6\u30fc\u30b6\u540d>\n\n\n\n1. \u4e8b\u524d\u4f5c\u696d\n\n\u30aa\u30ea\u30b8\u30f3\u306e\u6307\u5b9a\n\u30aa\u30ea\u30b8\u30f3\u30b5\u30fc\u30d0\u3068\u306a\u308bS3\u30d0\u30b1\u30c3\u30c8\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nCFRONT_ORIGIN_NAME=\"${S3_BUCKET_ENDPOINT}\" \\\n  && echo ${CFRONT_ORIGIN_NAME}\n\n\n\n\u914d\u4fe1\u7528\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u540d\u306e\u6307\u5b9a\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nCFRONT_DIST_NAME=\"handson-$(date +%Y%m%d)\" \\\n        && echo ${CFRONT_DIST_NAME}\n\n\n\u540c\u540d\u306e\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u304c\u5b58\u5728\u3057\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws cloudfront list-distributions \\\n        --query \"DistributionList.Items[].Origins.Items[?contains(DomainName, \\`${CFRONT_ORIGIN_NAME}\\`)]\"\n\n\n\n\u7d50\u679c\n(\u623b\u308a\u5024\u306a\u3057)\n\n\n\n\u30eb\u30fc\u30c8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u6307\u5b9a\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nCFRONT_ROOT_OBJECT=\"index.html\"\n\n\n\n2. \u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n        CFRONT_ORIGIN_NAME: ${CFRONT_ORIGIN_NAME}\n        CFRONT_ROOT_OBJECT: ${CFRONT_ROOT_OBJECT}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws cloudfront create-distribution \\\n        --origin-domain-name ${CFRONT_ORIGIN_NAME} \\\n        --default-root-object ${CFRONT_ROOT_OBJECT}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n\n\n3. \u4e8b\u5f8c\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws cloudfront list-distributions \n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"DistributionList\": {\n          \"Items\": [\n              {\n                  \"Status\": \"InProgress\",\n                  \"CacheBehaviors\": {\n                      \"Quantity\": 0\n                  },\n                  \"WebACLId\": \"\",\n                  \"Origins\": {\n                      \"Items\": [\n                          {\n                              \"S3OriginConfig\": {\n                                  \"OriginAccessIdentity\": \"\"\n                              },\n                              \"OriginPath\": \"\",\n                              \"CustomHeaders\": {\n                                  \"Items\": [],\n                                  \"Quantity\": 0\n                              },\n                              \"Id\": \"S3-handson-20160314\",\n                              \"DomainName\": \"handson-20160314.s3.amazonaws.com\"\n                          }\n                      ],\n                      \"Quantity\": 1\n                  },\n                  \"DomainName\": \"xxxxxxxxxxxxxx.cloudfront.net\",\n                  \"PriceClass\": \"PriceClass_200\",\n                  \"Enabled\": true,\n                  \"DefaultCacheBehavior\": {\n                      \"TrustedSigners\": {\n                          \"Enabled\": false,\n                          \"Quantity\": 0\n                      },\n                      \"TargetOriginId\": \"S3-handson-20160314\",\n                      \"ViewerProtocolPolicy\": \"allow-all\",\n                      \"ForwardedValues\": {\n                          \"Headers\": {\n                              \"Quantity\": 0\n                          },\n                          \"Cookies\": {\n                              \"Forward\": \"none\"\n                          },\n                          \"QueryString\": false\n                      },\n                      \"MaxTTL\": 31536000,\n                      \"SmoothStreaming\": false,\n                      \"DefaultTTL\": 86400,\n                      \"AllowedMethods\": {\n                          \"Items\": [\n                              \"HEAD\",\n                              \"GET\"\n                          ],\n                          \"CachedMethods\": {\n                              \"Items\": [\n                                  \"HEAD\",\n                                  \"GET\"\n                              ],\n                              \"Quantity\": 2\n                          },\n                          \"Quantity\": 2\n                      },\n                      \"MinTTL\": 0,\n                      \"Compress\": false\n                  },\n                  \"Comment\": \"sample distribution\",\n                  \"ViewerCertificate\": {\n                      \"CloudFrontDefaultCertificate\": true,\n                      \"MinimumProtocolVersion\": \"SSLv3\",\n                      \"CertificateSource\": \"cloudfront\"\n                  },\n                  \"CustomErrorResponses\": {\n                      \"Quantity\": 0\n                  },\n                  \"LastModifiedTime\": \"2016-03-14T07:51:02.752Z\",\n                  \"Id\": \"EUTXXXXXXXXXX\",\n                  \"Restrictions\": {\n                      \"GeoRestriction\": {\n                          \"RestrictionType\": \"none\",\n                          \"Quantity\": 0\n                      }\n                  },\n                  \"Aliases\": {\n                      \"Quantity\": 0\n                  }\n              }\n          ]\n        }\n      }\n\n\n\n\u30b3\u30de\u30f3\u30c9\nCFRONT_DIST_ID=$( \\\n        aws cloudfront list-distributions \\\n          --query \"DistributionList.Items[?contains(Origins.Items[].DomainName, \\`$CFRONT_ORIGIN_NAME\\`)].Id\" \\\n          --output text \\\n) \\\n        && echo ${CFRONT_DIST_ID}\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws cloudfront get-distribution \\\n        --id ${CFRONT_DIST_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"Distribution\": {\n          \"Status\": \"Deployed\",\n          \"DomainName\": \"d2yhs6oup1drdc.cloudfront.net\",\n          \"InProgressInvalidationBatches\": 0,\n          \"DistributionConfig\": {\n              \"Comment\": \"sample distribution\",\n              \"CacheBehaviors\": {\n                  \"Quantity\": 0\n              },\n              \"Logging\": {\n                  \"Bucket\": \"accesslog-opelab-handson-2016031016.s3.amazonaws.com\",\n                  \"Prefix\": \"cfLogs/\",\n                  \"Enabled\": true,\n                  \"IncludeCookies\": false\n              },\n              \"WebACLId\": \"\",\n              \"Origins\": {\n                  \"Items\": [\n                      {\n                          \"S3OriginConfig\": {\n                              \"OriginAccessIdentity\": \"\"\n                          },\n                          \"OriginPath\": \"\",\n                          \"CustomHeaders\": {\n                              \"Items\": [],\n                              \"Quantity\": 0\n                          },\n                          \"Id\": \"S3-opelab-handson-2016031016\",\n                          \"DomainName\": \"opelab-handson-2016031016.s3.amazonaws.com\"\n                      }\n                  ],\n                  \"Quantity\": 1\n              },\n              \"DefaultRootObject\": \"index.html\",\n              \"PriceClass\": \"PriceClass_200\",\n              \"Enabled\": true,\n              \"DefaultCacheBehavior\": {\n                  \"TrustedSigners\": {\n                      \"Enabled\": false,\n                      \"Quantity\": 0\n                  },\n                  \"TargetOriginId\": \"S3-opelab-handson-2016031016\",\n                  \"ViewerProtocolPolicy\": \"allow-all\",\n                  \"ForwardedValues\": {\n                      \"Headers\": {\n                          \"Quantity\": 0\n                      },\n                      \"Cookies\": {\n                          \"Forward\": \"none\"\n                      },\n                      \"QueryString\": false\n                  },\n                  \"MaxTTL\": 31536000,\n                  \"SmoothStreaming\": false,\n                  \"DefaultTTL\": 86400,\n                  \"AllowedMethods\": {\n                      \"Items\": [\n                          \"HEAD\",\n                          \"GET\"\n                      ],\n                      \"CachedMethods\": {\n                          \"Items\": [\n                              \"HEAD\",\n                              \"GET\"\n                          ],\n                          \"Quantity\": 2\n                      },\n                      \"Quantity\": 2\n                  },\n                  \"MinTTL\": 0,\n                  \"Compress\": false\n              },\n              \"CallerReference\": \"1457596264125\",\n              \"ViewerCertificate\": {\n                  \"CloudFrontDefaultCertificate\": true,\n                  \"MinimumProtocolVersion\": \"SSLv3\",\n                  \"CertificateSource\": \"cloudfront\"\n              },\n              \"CustomErrorResponses\": {\n                  \"Quantity\": 0\n              },\n              \"Restrictions\": {\n                  \"GeoRestriction\": {\n                      \"RestrictionType\": \"none\",\n                      \"Quantity\": 0\n                  }\n              },\n              \"Aliases\": {\n                  \"Quantity\": 0\n              }\n          },\n          \"ActiveTrustedSigners\": {\n              \"Enabled\": false,\n              \"Quantity\": 0\n          },\n          \"LastModifiedTime\": \"2016-03-10T09:52:52.418Z\",\n          \"Id\": \"EUTX0MFN0TQHP\"\n        },\n        \"ETag\": \"E1QO82W6C0PLFV\"\n      }\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws cloudfront get-distribution-config \\\n        --id ${CFRONT_DIST_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n        \"ETag\": \"E1QO82W6C0PLFV\",\n        \"DistributionConfig\": {\n          \"Comment\": \"sample distribution\",\n          \"CacheBehaviors\": {\n              \"Quantity\": 0\n          },\n          \"Logging\": {\n              \"Bucket\": \"accesslog-opelab-handson-2016031016.s3.amazonaws.com\",\n              \"Prefix\": \"cfLogs/\",\n              \"Enabled\": true,\n              \"IncludeCookies\": false\n          },\n          \"WebACLId\": \"\",\n          \"Origins\": {\n              \"Items\": [\n                  {\n                      \"S3OriginConfig\": {\n                          \"OriginAccessIdentity\": \"\"\n                      },\n                      \"OriginPath\": \"\",\n                      \"CustomHeaders\": {\n                          \"Items\": [],\n                          \"Quantity\": 0\n                      },\n                      \"Id\": \"S3-opelab-handson-2016031016\",\n                      \"DomainName\": \"opelab-handson-2016031016.s3.amazonaws.com\"\n                  }\n              ],\n              \"Quantity\": 1\n          },\n          \"DefaultRootObject\": \"index.html\",\n          \"PriceClass\": \"PriceClass_200\",\n          \"Enabled\": true,\n          \"DefaultCacheBehavior\": {\n              \"TrustedSigners\": {\n                  \"Enabled\": false,\n                  \"Quantity\": 0\n              },\n              \"TargetOriginId\": \"S3-opelab-handson-2016031016\",\n              \"ViewerProtocolPolicy\": \"allow-all\",\n              \"ForwardedValues\": {\n                  \"Headers\": {\n                      \"Quantity\": 0\n                  },\n                  \"Cookies\": {\n                      \"Forward\": \"none\"\n                  },\n                  \"QueryString\": false\n              },\n              \"MaxTTL\": 31536000,\n              \"SmoothStreaming\": false,\n              \"DefaultTTL\": 86400,\n              \"AllowedMethods\": {\n                  \"Items\": [\n                      \"HEAD\",\n                      \"GET\"\n                  ],\n                  \"CachedMethods\": {\n                      \"Items\": [\n                          \"HEAD\",\n                          \"GET\"\n                      ],\n                      \"Quantity\": 2\n                  },\n                  \"Quantity\": 2\n              },\n              \"MinTTL\": 0,\n              \"Compress\": false\n          },\n          \"CallerReference\": \"1457596264125\",\n          \"ViewerCertificate\": {\n              \"CloudFrontDefaultCertificate\": true,\n              \"MinimumProtocolVersion\": \"SSLv3\",\n              \"CertificateSource\": \"cloudfront\"\n          },\n          \"CustomErrorResponses\": {\n              \"Quantity\": 0\n          },\n          \"Restrictions\": {\n              \"GeoRestriction\": {\n                  \"RestrictionType\": \"none\",\n                  \"Quantity\": 0\n              }\n          },\n          \"Aliases\": {\n              \"Quantity\": 0\n          }\n        }\n      }\n\n\n\n\u30b3\u30de\u30f3\u30c9\nCFRONT_DIST_STATUS=$( \\\n   aws cloudfront list-distributions \\\n     --query \"DistributionList.Items[?contains(Origins.Items[].DomainName, \\`$CFRONT_ORIGIN_NAME\\`)].Status\" \\\n     --output text \\\n) \\\n  && echo ${CFRONT_DIST_STATUS}\n\n\n\n\n\u30b3\u30de\u30f3\u30c9\nCFRONT_DIST_URL=$( \\\n   aws cloudfront list-distributions \\\n     --query \"DistributionList.Items[?contains(Origins.Items[].DomainName, \\`$CFRONT_ORIGIN_NAME\\`)].DomainName\" \\\n     --output text \\\n) \\\n  && echo ${CFRONT_DIST_URL}\n\n\n\n\n4. \u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u306e\u524a\u9664\n\n4.1. \u4e8b\u524d\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws cloudfront get-distribution-config \\\n     --id ${CFRONT_DIST_ID} \\\n     > distconfig-disabled.json\n\n\n\"Enabled\": true\u3092\"Enabled\": false\u306b\u3059\u308b\u3002\n\n\u30b3\u30de\u30f3\u30c9\nCFRONT_ETAG=$( \\\n     aws cloudfront get-distribution-config \\\n       --id ${CFRONT_DIST_ID} \\\n       --query 'ETag' \\\n       --output text \\\n) \\\n     && echo ${CFRONT_ETAG}\n\n\n\n\u30b3\u30de\u30f3\u30c9(\u52d5\u304b\u306a\u304b\u3063\u305f)\naws cloudfront update-distribution \\\n     --id ${CFRONT_DIST_ID} \\\n     --distribution-config file://distconfig-disabled.json \\\n     --if-match ${CFRONT_ETAG}\n\n\n\n4.2. \u524a\u9664\n\n\u30b3\u30de\u30f3\u30c9\nCFRONT_ETAG=$( \\\n     aws cloudfront get-distribution-config \\\n       --id ${CFRONT_DIST_ID} \\\n       --query 'ETag' \\\n       --output text \\\n) \\\n     && echo ${CFRONT_ETAG}\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws cloudfront delete-distribution \\\n     --id ${CFRONT_DIST_ID} \\\n     --if-match ${CFRONT_ETAG}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n\n\n4.3. \u4e8b\u5f8c\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws cloudfront get-distribution \\\n        --id ${CFRONT_DIST_ID}\n\n\n\n\u5b8c\u4e86\ncloudfront\u306e\u66f4\u65b0\u306b\u306f15\u5206\u304f\u3089\u3044\u304b\u304b\u308a\u307e\u3059...\n\nCLI\u306f\u3001\u30d7\u30ec\u30d3\u30e5\u30fc\u7248\u306e\u305f\u3081\u5225\u9014\u8a2d\u5b9a\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n\n\u524d\u63d0\u6761\u4ef6\n========\n\nCloudFront\u3078\u306e\u6a29\u9650\n------------------\n\nCloudFront\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\n\nAWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n-------------------\n\n\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\n* AWS CLI 1.10.11\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws --version\n```\n\n```bash:\u7d50\u679c(\u4f8b):\naws-cli/1.10.11 Python/2.7.5 Darwin/13.4.0 botocore/1.4.2\n```\n\n\n0. \u6e96\u5099\n=======\n\n\n0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u6c7a\u5b9a\n---------------------\n\n\n0.2. \u5909\u6570\u306e\u78ba\u8a8d\n---------------\n\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u304c\u60f3\u5b9a\u306e\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws configure list\n```\n\n```bash:\u7d50\u679c(\u4f8b)\n\n            Name                    Value             Type    Location\n            ----                    -----             ----    --------\n         profile         s3Full-prjZ-mbp13        env    AWS_DEFAULT_PROFILE\n      access_key     ****************XXXX shared-credentials-file\n      secret_key     ****************XXXX shared-credentials-file\n          region                         ap-northeast-1  env    AWS_DEFAULT_REGION\n```\n\nAssumeRole\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u306fprofile\u304c '<not set>'\u3068\u8868\u793a\u3055\u308c\u307e\u3059\u3002 \u305d\n\u308c\u4ee5\u5916\u306e\u3068\u304d\u306bprofile\u304c '<not set>' \u3068\u8868\u793a\u3055\u308c\u308b\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u3092\u5b9f\u884c\u3057\u3066\n\u304f\u3060\u3055\u3044\u3002\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nexport AWS_DEFAULT_PROFILE=<IAM\u30e6\u30fc\u30b6\u540d>\n```\n\n\n1. \u4e8b\u524d\u4f5c\u696d\n===========\n\n\u30aa\u30ea\u30b8\u30f3\u306e\u6307\u5b9a\n--------------\n\n\u30aa\u30ea\u30b8\u30f3\u30b5\u30fc\u30d0\u3068\u306a\u308bS3\u30d0\u30b1\u30c3\u30c8\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nCFRONT_ORIGIN_NAME=\"${S3_BUCKET_ENDPOINT}\" \\\n  && echo ${CFRONT_ORIGIN_NAME}\n```\n\n\n\n\u914d\u4fe1\u7528\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u540d\u306e\u6307\u5b9a\n------------------------------------\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nCFRONT_DIST_NAME=\"handson-$(date +%Y%m%d)\" \\\n        && echo ${CFRONT_DIST_NAME}\n```\n\n\u540c\u540d\u306e\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u304c\u5b58\u5728\u3057\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws cloudfront list-distributions \\\n        --query \"DistributionList.Items[].Origins.Items[?contains(DomainName, \\`${CFRONT_ORIGIN_NAME}\\`)]\"\n```\n\n```bash:\u7d50\u679c:\n(\u623b\u308a\u5024\u306a\u3057)\n```\n\n\n\n\n\u30eb\u30fc\u30c8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u6307\u5b9a\n------------------------\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nCFRONT_ROOT_OBJECT=\"index.html\"\n```\n\n\n2. \u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\n===============================\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n        CFRONT_ORIGIN_NAME: ${CFRONT_ORIGIN_NAME}\n        CFRONT_ROOT_OBJECT: ${CFRONT_ROOT_OBJECT}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws cloudfront create-distribution \\\n        --origin-domain-name ${CFRONT_ORIGIN_NAME} \\\n        --default-root-object ${CFRONT_ROOT_OBJECT}\n```\n\n```bash:\u7d50\u679c(\u4f8b):\n```\n\n\n\n3. \u4e8b\u5f8c\u78ba\u8a8d\n===========\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws cloudfront list-distributions \n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n        \"DistributionList\": {\n          \"Items\": [\n              {\n                  \"Status\": \"InProgress\",\n                  \"CacheBehaviors\": {\n                      \"Quantity\": 0\n                  },\n                  \"WebACLId\": \"\",\n                  \"Origins\": {\n                      \"Items\": [\n                          {\n                              \"S3OriginConfig\": {\n                                  \"OriginAccessIdentity\": \"\"\n                              },\n                              \"OriginPath\": \"\",\n                              \"CustomHeaders\": {\n                                  \"Items\": [],\n                                  \"Quantity\": 0\n                              },\n                              \"Id\": \"S3-handson-20160314\",\n                              \"DomainName\": \"handson-20160314.s3.amazonaws.com\"\n                          }\n                      ],\n                      \"Quantity\": 1\n                  },\n                  \"DomainName\": \"xxxxxxxxxxxxxx.cloudfront.net\",\n                  \"PriceClass\": \"PriceClass_200\",\n                  \"Enabled\": true,\n                  \"DefaultCacheBehavior\": {\n                      \"TrustedSigners\": {\n                          \"Enabled\": false,\n                          \"Quantity\": 0\n                      },\n                      \"TargetOriginId\": \"S3-handson-20160314\",\n                      \"ViewerProtocolPolicy\": \"allow-all\",\n                      \"ForwardedValues\": {\n                          \"Headers\": {\n                              \"Quantity\": 0\n                          },\n                          \"Cookies\": {\n                              \"Forward\": \"none\"\n                          },\n                          \"QueryString\": false\n                      },\n                      \"MaxTTL\": 31536000,\n                      \"SmoothStreaming\": false,\n                      \"DefaultTTL\": 86400,\n                      \"AllowedMethods\": {\n                          \"Items\": [\n                              \"HEAD\",\n                              \"GET\"\n                          ],\n                          \"CachedMethods\": {\n                              \"Items\": [\n                                  \"HEAD\",\n                                  \"GET\"\n                              ],\n                              \"Quantity\": 2\n                          },\n                          \"Quantity\": 2\n                      },\n                      \"MinTTL\": 0,\n                      \"Compress\": false\n                  },\n                  \"Comment\": \"sample distribution\",\n                  \"ViewerCertificate\": {\n                      \"CloudFrontDefaultCertificate\": true,\n                      \"MinimumProtocolVersion\": \"SSLv3\",\n                      \"CertificateSource\": \"cloudfront\"\n                  },\n                  \"CustomErrorResponses\": {\n                      \"Quantity\": 0\n                  },\n                  \"LastModifiedTime\": \"2016-03-14T07:51:02.752Z\",\n                  \"Id\": \"EUTXXXXXXXXXX\",\n                  \"Restrictions\": {\n                      \"GeoRestriction\": {\n                          \"RestrictionType\": \"none\",\n                          \"Quantity\": 0\n                      }\n                  },\n                  \"Aliases\": {\n                      \"Quantity\": 0\n                  }\n              }\n          ]\n        }\n      }\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nCFRONT_DIST_ID=$( \\\n        aws cloudfront list-distributions \\\n          --query \"DistributionList.Items[?contains(Origins.Items[].DomainName, \\`$CFRONT_ORIGIN_NAME\\`)].Id\" \\\n          --output text \\\n) \\\n        && echo ${CFRONT_DIST_ID}\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws cloudfront get-distribution \\\n        --id ${CFRONT_DIST_ID}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n        \"Distribution\": {\n          \"Status\": \"Deployed\",\n          \"DomainName\": \"d2yhs6oup1drdc.cloudfront.net\",\n          \"InProgressInvalidationBatches\": 0,\n          \"DistributionConfig\": {\n              \"Comment\": \"sample distribution\",\n              \"CacheBehaviors\": {\n                  \"Quantity\": 0\n              },\n              \"Logging\": {\n                  \"Bucket\": \"accesslog-opelab-handson-2016031016.s3.amazonaws.com\",\n                  \"Prefix\": \"cfLogs/\",\n                  \"Enabled\": true,\n                  \"IncludeCookies\": false\n              },\n              \"WebACLId\": \"\",\n              \"Origins\": {\n                  \"Items\": [\n                      {\n                          \"S3OriginConfig\": {\n                              \"OriginAccessIdentity\": \"\"\n                          },\n                          \"OriginPath\": \"\",\n                          \"CustomHeaders\": {\n                              \"Items\": [],\n                              \"Quantity\": 0\n                          },\n                          \"Id\": \"S3-opelab-handson-2016031016\",\n                          \"DomainName\": \"opelab-handson-2016031016.s3.amazonaws.com\"\n                      }\n                  ],\n                  \"Quantity\": 1\n              },\n              \"DefaultRootObject\": \"index.html\",\n              \"PriceClass\": \"PriceClass_200\",\n              \"Enabled\": true,\n              \"DefaultCacheBehavior\": {\n                  \"TrustedSigners\": {\n                      \"Enabled\": false,\n                      \"Quantity\": 0\n                  },\n                  \"TargetOriginId\": \"S3-opelab-handson-2016031016\",\n                  \"ViewerProtocolPolicy\": \"allow-all\",\n                  \"ForwardedValues\": {\n                      \"Headers\": {\n                          \"Quantity\": 0\n                      },\n                      \"Cookies\": {\n                          \"Forward\": \"none\"\n                      },\n                      \"QueryString\": false\n                  },\n                  \"MaxTTL\": 31536000,\n                  \"SmoothStreaming\": false,\n                  \"DefaultTTL\": 86400,\n                  \"AllowedMethods\": {\n                      \"Items\": [\n                          \"HEAD\",\n                          \"GET\"\n                      ],\n                      \"CachedMethods\": {\n                          \"Items\": [\n                              \"HEAD\",\n                              \"GET\"\n                          ],\n                          \"Quantity\": 2\n                      },\n                      \"Quantity\": 2\n                  },\n                  \"MinTTL\": 0,\n                  \"Compress\": false\n              },\n              \"CallerReference\": \"1457596264125\",\n              \"ViewerCertificate\": {\n                  \"CloudFrontDefaultCertificate\": true,\n                  \"MinimumProtocolVersion\": \"SSLv3\",\n                  \"CertificateSource\": \"cloudfront\"\n              },\n              \"CustomErrorResponses\": {\n                  \"Quantity\": 0\n              },\n              \"Restrictions\": {\n                  \"GeoRestriction\": {\n                      \"RestrictionType\": \"none\",\n                      \"Quantity\": 0\n                  }\n              },\n              \"Aliases\": {\n                  \"Quantity\": 0\n              }\n          },\n          \"ActiveTrustedSigners\": {\n              \"Enabled\": false,\n              \"Quantity\": 0\n          },\n          \"LastModifiedTime\": \"2016-03-10T09:52:52.418Z\",\n          \"Id\": \"EUTX0MFN0TQHP\"\n        },\n        \"ETag\": \"E1QO82W6C0PLFV\"\n      }\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws cloudfront get-distribution-config \\\n        --id ${CFRONT_DIST_ID}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n      {\n        \"ETag\": \"E1QO82W6C0PLFV\",\n        \"DistributionConfig\": {\n          \"Comment\": \"sample distribution\",\n          \"CacheBehaviors\": {\n              \"Quantity\": 0\n          },\n          \"Logging\": {\n              \"Bucket\": \"accesslog-opelab-handson-2016031016.s3.amazonaws.com\",\n              \"Prefix\": \"cfLogs/\",\n              \"Enabled\": true,\n              \"IncludeCookies\": false\n          },\n          \"WebACLId\": \"\",\n          \"Origins\": {\n              \"Items\": [\n                  {\n                      \"S3OriginConfig\": {\n                          \"OriginAccessIdentity\": \"\"\n                      },\n                      \"OriginPath\": \"\",\n                      \"CustomHeaders\": {\n                          \"Items\": [],\n                          \"Quantity\": 0\n                      },\n                      \"Id\": \"S3-opelab-handson-2016031016\",\n                      \"DomainName\": \"opelab-handson-2016031016.s3.amazonaws.com\"\n                  }\n              ],\n              \"Quantity\": 1\n          },\n          \"DefaultRootObject\": \"index.html\",\n          \"PriceClass\": \"PriceClass_200\",\n          \"Enabled\": true,\n          \"DefaultCacheBehavior\": {\n              \"TrustedSigners\": {\n                  \"Enabled\": false,\n                  \"Quantity\": 0\n              },\n              \"TargetOriginId\": \"S3-opelab-handson-2016031016\",\n              \"ViewerProtocolPolicy\": \"allow-all\",\n              \"ForwardedValues\": {\n                  \"Headers\": {\n                      \"Quantity\": 0\n                  },\n                  \"Cookies\": {\n                      \"Forward\": \"none\"\n                  },\n                  \"QueryString\": false\n              },\n              \"MaxTTL\": 31536000,\n              \"SmoothStreaming\": false,\n              \"DefaultTTL\": 86400,\n              \"AllowedMethods\": {\n                  \"Items\": [\n                      \"HEAD\",\n                      \"GET\"\n                  ],\n                  \"CachedMethods\": {\n                      \"Items\": [\n                          \"HEAD\",\n                          \"GET\"\n                      ],\n                      \"Quantity\": 2\n                  },\n                  \"Quantity\": 2\n              },\n              \"MinTTL\": 0,\n              \"Compress\": false\n          },\n          \"CallerReference\": \"1457596264125\",\n          \"ViewerCertificate\": {\n              \"CloudFrontDefaultCertificate\": true,\n              \"MinimumProtocolVersion\": \"SSLv3\",\n              \"CertificateSource\": \"cloudfront\"\n          },\n          \"CustomErrorResponses\": {\n              \"Quantity\": 0\n          },\n          \"Restrictions\": {\n              \"GeoRestriction\": {\n                  \"RestrictionType\": \"none\",\n                  \"Quantity\": 0\n              }\n          },\n          \"Aliases\": {\n              \"Quantity\": 0\n          }\n        }\n      }\n```\n\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nCFRONT_DIST_STATUS=$( \\\n   aws cloudfront list-distributions \\\n     --query \"DistributionList.Items[?contains(Origins.Items[].DomainName, \\`$CFRONT_ORIGIN_NAME\\`)].Status\" \\\n     --output text \\\n) \\\n  && echo ${CFRONT_DIST_STATUS}\n\n```\n\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nCFRONT_DIST_URL=$( \\\n   aws cloudfront list-distributions \\\n     --query \"DistributionList.Items[?contains(Origins.Items[].DomainName, \\`$CFRONT_ORIGIN_NAME\\`)].DomainName\" \\\n     --output text \\\n) \\\n  && echo ${CFRONT_DIST_URL}\n\n```\n\n\n4. \u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u306e\u524a\u9664\n===============================\n\n\n4.1. \u4e8b\u524d\u78ba\u8a8d\n-------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws cloudfront get-distribution-config \\\n     --id ${CFRONT_DIST_ID} \\\n     > distconfig-disabled.json\n```\n\n\"Enabled\": true\u3092\"Enabled\": false\u306b\u3059\u308b\u3002\n\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nCFRONT_ETAG=$( \\\n     aws cloudfront get-distribution-config \\\n       --id ${CFRONT_DIST_ID} \\\n       --query 'ETag' \\\n       --output text \\\n) \\\n     && echo ${CFRONT_ETAG}\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9(\u52d5\u304b\u306a\u304b\u3063\u305f):\naws cloudfront update-distribution \\\n     --id ${CFRONT_DIST_ID} \\\n     --distribution-config file://distconfig-disabled.json \\\n     --if-match ${CFRONT_ETAG}\n```\n\n\n\n4.2. \u524a\u9664\n---------\n\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nCFRONT_ETAG=$( \\\n     aws cloudfront get-distribution-config \\\n       --id ${CFRONT_DIST_ID} \\\n       --query 'ETag' \\\n       --output text \\\n) \\\n     && echo ${CFRONT_ETAG}\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws cloudfront delete-distribution \\\n     --id ${CFRONT_DIST_ID} \\\n     --if-match ${CFRONT_ETAG}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n```\n\n\n\n4.3. \u4e8b\u5f8c\u78ba\u8a8d\n-------------\n\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws cloudfront get-distribution \\\n        --id ${CFRONT_DIST_ID}\n```\n\n\n\u5b8c\u4e86\n====\n"}