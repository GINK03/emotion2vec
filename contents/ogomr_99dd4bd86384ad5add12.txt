{"tags": ["Elixir", "Rails", "Phoenix", "Ruby", "Node.js"], "context": " More than 1 year has passed since last update.WebSocket \u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u53cc\u65b9\u5411\u901a\u4fe1\u306e\u898f\u683c\u3067\u3001\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u901a\u4fe1\u306e\u7528\u9014\u3067\u5229\u7528\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nWeb Application Framework \u306e Phoenix \u306f WebSocket \u3092\u6a19\u6e96\u3067\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\nRails \u3082 Action Cable \u3067 WebSocket \u306e\u5229\u7528\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u305d\u3053\u3067 Express \u3092\u5408\u308f\u305b\u3066\uff13\u3064\u306e Framework \u3067 WebSocket \u306e\u30b5\u30f3\u30d7\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n( bash \u30b3\u30de\u30f3\u30c9\u306e brew \u306f  Mac OS X \u3067\u5229\u7528\u3067\u304d\u307e\u3059\u3002\u4ed6OS\u306f\u9069\u5b9c\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002 )\n\n\nNode.js on Express\n\nExpress \u306f JavaScript \u304c\u8a00\u8a9e\u306e Web Application Framework \u3067\u3059\u3002\nSocket.IO \u3068\u3044\u3046 WebSocket \u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u6709\u540d\u3067\u3059\u3002\n\nSetup\n\n\nNode.js \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068 npm \u306e\u30b3\u30de\u30f3\u30c9\u304c\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n\nnpm \u30b3\u30de\u30f3\u30c9\u3067 Express \u306e Generator \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n$ brew install node\n$ npm install express-generator -g\n\n\n\nexpress \u30b3\u30de\u30f3\u30c9\u3067 Web Application \u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nnpm \u30b3\u30de\u30f3\u30c9\u3067 Socket.IO \u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n$ express express-socketio-example\n$ cd express-socketio-example && npm install\n$ npm install socket.io --save\n\n\nMaking\nSocket.IO \u306e\u5b9f\u88c5\u306f\u3053\u3061\u3089\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\u3002\n\nServer\n\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u306b WebSocket \u306e\u63a5\u7d9a\u51e6\u7406\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n\nExpress \u306e\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u306e\u6700\u5f8c\u306b Socket.IO \u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\n\nio.on \u306f\u63a5\u7d9a\u306e\u51e6\u7406\u3067\u3059\u3002\n\nio.emit \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n\nsocket.on \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u53d7\u4fe1\u3055\u308c\u307e\u3059\u3002\n\n\n\nbin/www:\nvar io = require('socket.io')(server);\nio.on('connection', function(socket){\n  socket.on('message from client', function(message){\n    io.emit('message from server', message);\n  });\n});\n\n\nClient\n\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u306b\u3082 WebSocket \u306e\u63a5\u7d9a\u51e6\u7406\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n\nView \u306e\u30d5\u30a1\u30a4\u30eb\u306b Socket.IO \u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\n\nsocket = io \u3067 Socket \u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\nsocket.emit \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n\nsocket.on \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u53d7\u4fe1\u3055\u308c\u307e\u3059\u3002\n\n\n\nDOM \u306e\u64cd\u4f5c\u306f JQuery \u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\u30e1\u30c3\u30bb\u30fc\u30b8\u306f <div id=\"messages\"></div> \u306b\u51fa\u529b\u3057\u307e\u3059\u3002\n\nviews/index.jade:\nextends layout\n\nblock content\n  form\n    input#content\n    button Send\n  #messages\n  script(src='/socket.io/socket.io.js')\n  script(src='http://code.jquery.com/jquery-1.11.3.min.js')\n  script().\n    var socket = io();\n    $('form').submit(function(){\n      socket.emit('message from client', $('#content').val());\n      $('#content').val('');\n      return false;\n    });\n    socket.on('message from server', function(message){\n      $('#messages').append($('<p>').text(message));\n    });\n\n\nStart\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n$ DEBUG=express-socketio-example:* npm start\n\n\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n\u3053\u308c\u3060\u3051\u3067\u7c21\u5358\u306a\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u3067\u304d\u307e\u3059\u3002\n\n\nElixir on Phoenix\n\nPhoenix \u306f Elixir \u304c\u8a00\u8a9e\u306e Web Application Framework \u3067\u3059\u3002\nWebSocket \u304c\u6a19\u6e96\u306e\u6a5f\u80fd\u3067\u5229\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nElixir \u306f Erlang VM \u3067\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\u5916\u90e8DSL\u304c\u7c21\u5358\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002\n\nSetup\n\n\nElixir \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068 mix \u306e\u30b3\u30de\u30f3\u30c9\u304c\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n\nmix \u30b3\u30de\u30f3\u30c9\u3067 Phoenix \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nmix archive.install \u306f\u3053\u3053\u304b\u3089 [URL] \u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n$ brew install elixir\n$ mix local.hex\n$ mix archive.install https://[URL]/phoenix_new-x.x.x.ez\n\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b PostgreSQL \u304c\u5229\u7528\u3055\u308c\u307e\u3059\u3002\n\n$ brew install postgresql\n$ createuser -d -P postgres\n$ postgres -D /usr/local/var/postgres\n\n\n\nmix phoenix.new \u30b3\u30de\u30f3\u30c9\u3067 Web Application \u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nmix phoenix.gen.html \u30b3\u30de\u30f3\u30c9\u3067 Message \u306e Generator \u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n$ mix phoenix.new phoenix_channel_example\n$ cd phoenix_channel_example\n$ mix ecto.create\n$ mix phoenix.gen.html Message messages content:text\n\n\n\nRouter \u306b Message \u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\uff08\u3088\u304f\u5fd8\u308c\u307e\u3059\u3002\uff09\n\nweb/router.ex:\nresources \"/messages\", MessageController\n\n\nMaking\nChannels \u306e\u5b9f\u88c5\u306f\u3053\u3061\u3089\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\u3002\n\nServer\n\n\nChannels \u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\nweb/channels/user_socket.ex:\nchannel \"rooms:*\", PhoenixChannelExample.RoomChannel\n\n\n\nChannels \u306e\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\n\njoin \u3067\u30c1\u30e3\u30f3\u30cd\u30eb\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\nhandle_out \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n\nhandle_in \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u53d7\u4fe1\u3055\u308c\u307e\u3059\u3002\n\n\n\nweb/channels/room_channel.ex:\ndefmodule PhoenixChannelExample.RoomChannel do\n  use Phoenix.Channel\n\n  def join(\"rooms:lobby\", auth_msg, socket) do\n    {:ok, socket}\n  end\n\n  def join(\"rooms:\" <> _private_room_id, _auth_msg, socket) do\n    {:error, %{reason: \"unauthorized\"}}\n  end\n\n  def handle_in(\"new_msg\", %{\"body\" => body}, socket) do\n    broadcast! socket, \"new_msg\", %{body: body}\n    {:noreply, socket}\n  end\n\n  def handle_out(\"new_msg\", payload, socket) do\n    push socket, \"new_msg\", payload\n    {:noreply, socket}\n  end\nend\n\n\nClient\n\n\nChannels \u306e\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\n\nchan = socket.channel \u3067\u30c1\u30e3\u30f3\u30cd\u30eb\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\nchan.push \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n\nchan.on \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u53d7\u4fe1\u3055\u308c\u307e\u3059\u3002\n\n\n\nweb/static/js/app.js:\nimport {Socket} from \"deps/phoenix/web/static/js/phoenix\"\n\nlet message_content   = $(\"#message_content\")\nlet messagesContainer = $(\"#messages\")\n\nlet socket = new Socket(\"/socket\")\nsocket.connect()\nlet chan = socket.channel(\"rooms:lobby\", {})\n\nmessage_content.on(\"keypress\", event => {\n  if(event.keyCode === 13){\n    chan.push(\"new_msg\", {body: message_content.val()})\n    message_content.val(\"\")\n    return false\n  }\n})\n\nchan.on(\"new_msg\", payload => {\n  messagesContainer.append(`<br/>${payload.body}`)\n})\n\nchan.join().receive(\"ok\", chan => {\n  console.log(\"Welcome to Phoenix Chat!\")\n})\n\n\n\nDOM \u306e\u64cd\u4f5c\u306f JQuery \u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\nweb/templates/layout/app.html.eex:\n<script src=\"//code.jquery.com/jquery-1.11.2.min.js\"></script>\n\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u306f <div id=\"messages\"></div> \u306b\u51fa\u529b\u3057\u307e\u3059\u3002\n\nweb/templates/message/new.html.eex:\n<div id=\"messages\"></div>\n\n\nRun\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n$ mix ecto.migrate\n$ mix phoenix.server\n\n\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n\u624b\u9806\u306f\u5897\u3048\u307e\u3057\u305f\u304c\u3001\u9ad8\u5ea6\u306a\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u7c21\u5358\u306b\u3067\u304d\u307e\u3059\u3002\n\n\nRuby on Rails\n\nRails \u306f Ruby \u304c\u8a00\u8a9e\u306e Web Application Framework \u3067\u3059\u3002\nWebSocket \u306f ActionCable \u306e\u6a5f\u80fd\u3067\u5229\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nRuby \u306f\u3082\u3061\u308d\u3093\u3001\u5916\u90e8DSL\u304c\u7c21\u5358\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002\n\nSetup\n\n\nRuby \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068 gem \u306e\u30b3\u30de\u30f3\u30c9\u304c\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n\u4eca\u56de\u306f gem \u30b3\u30de\u30f3\u30c9\u3067 Rails \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u305b\u3093\u3002\n\ngem \u30b3\u30de\u30f3\u30c9\u3067 Bundler \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n$ brew install ruby\n$ gem install bundler\n\n\n\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u306e Rails \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nrails \u30b3\u30de\u30f3\u30c9\u3067 Web Application \u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n--edge \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b\u3068 Gemfile \u304c GitHub \u3092\u53c2\u7167\u3057\u307e\u3059\u3002\n\n$ git clone https://github.com/rails/rails.git\n$ cd rails\n$ bundle install\n$ cd ..\n$ rails/railties/exe/rails new rails-actioncable-example --edge\n$ cd rails-actioncable-example\n\n\n\nActionCable \u3067 Redis \u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n$ brew install redis\n\n\n\nRails \u3067\u5229\u7528\u3059\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u3092 Gemfile \u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\nGemfile:\ngem 'actioncable', github: 'rails/actioncable'\ngem 'puma'\ngem 'foreman', require: false\n\n\n\nrails generate \u30b3\u30de\u30f3\u30c9\u3067 Message \u306e Generator \u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n$ bundle\n$ bundle exec rails generate scaffold Message content:text\n\n\nMaking\nActionCable \u306e\u5b9f\u88c5\u306f\u3053\u3061\u3089\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\u3002\n\nServer\n\n\u63a5\u7d9a\u306e\u30b9\u30fc\u30d1\u30fc\u30af\u30e9\u30b9\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\uff08\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u30fc\u307e\u3060\u304b\u306a\u3041\uff09\n\napp/channels/application_cable/connection.rb:\nmodule ApplicationCable\n  class Connection < ActionCable::Connection::Base\n  end\nend\n\n\n\u30c1\u30e3\u30f3\u30cd\u30eb\u306e\u30b9\u30fc\u30d1\u30fc\u30af\u30e9\u30b9\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\uff08\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u30fc\u307e\u3060\u304b\u306a\u3041\uff09\n\napp/channels/application_cable/channel.rb:\nmodule ApplicationCable\n  class Channel < ActionCable::Channel::Base\n  end\nend\n\n\n\u30c1\u30e3\u30f3\u30cd\u30eb\u306eSubscribe(\u8cfc\u8aad)\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\napp/channels/messages_channel.rb:\nclass MessagesChannel < ApplicationCable::Channel\n  def subscribed\n    stream_from \"messages\"\n  end\nend\n\n\n\nPOST /messages \u306e server.broadcast \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n\napp/controllers/messages_controller.rb:\ndef create\n  ActionCable.server.broadcast 'messages', message: params[:message][:content]\n  head :ok\nend\n\n\n\nActionCable \u306e Rack \u306e\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\nconfig/racks/cable.ru:\nrequire ::File.expand_path('../../environment',  __FILE__)\nRails.application.eager_load!\n\nrequire \"action_cable/process/logging\"\n\nrun ActionCable.server\n\n\n\nActionCable \u8a2d\u5b9a\u3092 yml \u8a18\u8ff0\u3057\u307e\u3059\u3002\n\nconfig/redis/cable.yml:\nproduction: &base\n  :url: redis://localhost:6379\n  :host: localhost\n  :port: 6379\n  :timeout: 1\n  :inline: true\ndevelopment: *base\ntest: *base\n\n\n\nRails \u3068 ActionCable \u306e\u5b9f\u884c\u30b3\u30de\u30f3\u30c9\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\nProcfile:\nweb: bundle exec rails server\ncable: bundle exec puma -p 28080 config/racks/cable.ru\n\n\nClient\n\n\nApp.cable = Cable.createConsumer \u3067\u30c1\u30e3\u30f3\u30cd\u30eb\u3092\u8a2d\u5b9a\u307e\u3059\u3002\n\napp/assets/javascripts/channels/index.coffee:\n#= require cable\n#= require_self\n#= require_tree .\n\n@App = {}\nApp.cable = Cable.createConsumer \"ws://localhost:28080\"\n\n\n\nreceived \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u53d7\u4fe1\u3055\u308c\u307e\u3059\u3002\n\nDOM \u306e\u64cd\u4f5c\u306f JQuery \u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\napp/assets/javascripts/messages.coffee:\nApp.messages = App.cable.subscriptions.create 'MessagesChannel',\n  received: (data) ->\n    $('#messages').append($('<p>').text(data.message))\n\n\n\nform_for \u306e remote: true \u3067\u30da\u30fc\u30b8\u30ea\u30ed\u30fc\u30c9\u3092\u6291\u5236\u3057\u307e\u3059\u3002\n\nSubmit \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n\napp/views/messages/_form.html.erb:\n<%= form_for(message, remote: true) do |f| %>\n\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u306f <div id=\"messages\"></div> \u306b\u51fa\u529b\u3057\u307e\u3059\u3002\n\napp/views/messages/new.html.erb:\n<div id='messages'></div>\n\n\nRun\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n$ rake db:migrate\n$ bundle exec foreman start\n\n\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n\u304b\u306a\u308a\u624b\u9806\u306f\u5897\u3048\u307e\u3057\u305f\u304c\u3001\u3053\u306e\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\n\nTips\n\nActionCable with ActiveJob\nNode.js \u3084 Elixir \u306f\u975e\u540c\u671f\u51e6\u7406\u306e\u30e1\u30ab\u30cb\u30ba\u30e0\u304c\u3042\u308a\u3001\u591a\u304f\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u51e6\u7406\u3059\u308b\u306e\u306b\u5411\u3044\u3066\u3044\u307e\u3059\u3002\nRuby \u3067\u975e\u540c\u671f\u51e6\u7406\u3092\u5b9f\u88c5\u3059\u308b\u306b\u306f EventMachine \u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u5229\u7528\u3059\u308b\u306e\u3067\u3059\u304c\u3001\u3055\u3089\u306b Rails \u3067\u306f ActiveJob \u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u5229\u7528\u3057\u305f\u308a\u3001 Redis \u306e Pub/Sub \u3092\u5229\u7528\u3057\u3066\u975e\u540c\u671f\u51e6\u7406\u3092\u5b9f\u73fe\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u307e\u305a\u3001 sidekiq \u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092 Gemfile \u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\nGemfile:\ngem 'sidekiq'\n\n\n\u6b21\u306b\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\u51e6\u7406\u3092 Job \u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\napp/jobs/message_job.rb\nclass MessageJob < ApplicationJob\n  queue_as :default\n\n  def perform(*args)\n    ActionCable.server.broadcast 'messages', message: args[0]\n  end\nend\n\n\n\u3055\u304d\u307b\u3069\u306e POST /messages \u306b\u975e\u540c\u671f\u306e\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\napp/controllers/messages_controller.rb:\ndef create\n  MessageJob.perform_later(params[:message][:content])\n  head :ok\nend\n\nEnjoy WebSocket\n\n[WebSocket](https://tools.ietf.org/html/rfc6455) \u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u53cc\u65b9\u5411\u901a\u4fe1\u306e\u898f\u683c\u3067\u3001\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u901a\u4fe1\u306e\u7528\u9014\u3067\u5229\u7528\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n**Web Application Framework** \u306e [Phoenix](http://www.phoenixframework.org) \u306f **WebSocket** \u3092\u6a19\u6e96\u3067\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\n[Rails](http://rubyonrails.org) \u3082 [Action Cable](https://github.com/rails/actioncable) \u3067 **WebSocket** \u306e\u5229\u7528\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u305d\u3053\u3067 [Express](http://expressjs.com/) \u3092\u5408\u308f\u305b\u3066\uff13\u3064\u306e **Framework** \u3067 **WebSocket** \u306e\u30b5\u30f3\u30d7\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n( *bash* \u30b3\u30de\u30f3\u30c9\u306e `brew` \u306f  **Mac OS X** \u3067\u5229\u7528\u3067\u304d\u307e\u3059\u3002\u4ed6OS\u306f\u9069\u5b9c\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002 )\n\n---\n\n## Node.js on Express\n\n![logo-express](https://dl.dropboxusercontent.com/u/14690051/images/notes/lang/framework/websocket/logo/express.png)\n\n**Express** \u306f JavaScript \u304c\u8a00\u8a9e\u306e **Web Application Framework** \u3067\u3059\u3002\n[Socket.IO](http://socket.io/) \u3068\u3044\u3046 **WebSocket** \u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u6709\u540d\u3067\u3059\u3002\n\n### Setup\n\n* [Node.js](https://nodejs.org) \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068 `npm` \u306e\u30b3\u30de\u30f3\u30c9\u304c\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n* `npm` \u30b3\u30de\u30f3\u30c9\u3067 **Express** \u306e **Generator** \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```bash\n$ brew install node\n$ npm install express-generator -g\n```\n\n* `express` \u30b3\u30de\u30f3\u30c9\u3067 **Web Application** \u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n* `npm` \u30b3\u30de\u30f3\u30c9\u3067 **Socket.IO** \u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```bash\n$ express express-socketio-example\n$ cd express-socketio-example && npm install\n$ npm install socket.io --save\n```\n\n### Making\n\n**Socket.IO** \u306e\u5b9f\u88c5\u306f[\u3053\u3061\u3089](http://socket.io/docs/#using-with-express-3/4)\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\u3002\n\n#### Server\n\n\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u306b **WebSocket** \u306e\u63a5\u7d9a\u51e6\u7406\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n* **Express** \u306e\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u306e\u6700\u5f8c\u306b **Socket.IO** \u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n    * `io.on` \u306f\u63a5\u7d9a\u306e\u51e6\u7406\u3067\u3059\u3002\n    * `io.emit` \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n    * `socket.on` \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u53d7\u4fe1\u3055\u308c\u307e\u3059\u3002\n\n`bin/www`:\n\n```\nvar io = require('socket.io')(server);\nio.on('connection', function(socket){\n  socket.on('message from client', function(message){\n    io.emit('message from server', message);\n  });\n});\n```\n\n#### Client\n\n\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u306b\u3082 **WebSocket** \u306e\u63a5\u7d9a\u51e6\u7406\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n* *View* \u306e\u30d5\u30a1\u30a4\u30eb\u306b **Socket.IO** \u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n    * `socket = io` \u3067 **Socket** \u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n    * `socket.emit` \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n    * `socket.on` \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u53d7\u4fe1\u3055\u308c\u307e\u3059\u3002\n* *DOM* \u306e\u64cd\u4f5c\u306f **JQuery** \u3092\u5229\u7528\u3057\u307e\u3059\u3002\n* \u30e1\u30c3\u30bb\u30fc\u30b8\u306f `<div id=\"messages\"></div>` \u306b\u51fa\u529b\u3057\u307e\u3059\u3002\n\n`views/index.jade`:\n\n```\nextends layout\n\nblock content\n  form\n    input#content\n    button Send\n  #messages\n  script(src='/socket.io/socket.io.js')\n  script(src='http://code.jquery.com/jquery-1.11.3.min.js')\n  script().\n    var socket = io();\n    $('form').submit(function(){\n      socket.emit('message from client', $('#content').val());\n      $('#content').val('');\n      return false;\n    });\n    socket.on('message from server', function(message){\n      $('#messages').append($('<p>').text(message));\n    });\n```\n\n### Start\n\n* \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash\n$ DEBUG=express-socketio-example:* npm start\n```\n\n![express](https://dl.dropboxusercontent.com/u/14690051/images/notes/lang/framework/websocket/example/express.png)\n[\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9](https://github.com/dddrb/express-socketio-example)\n\n\u3053\u308c\u3060\u3051\u3067\u7c21\u5358\u306a\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u3067\u304d\u307e\u3059\u3002\n\n---\n\n## Elixir on Phoenix\n\n![logo-phoenix](https://dl.dropboxusercontent.com/u/14690051/images/notes/lang/framework/websocket/logo/phoenix.png)\n\n**Phoenix** \u306f [Elixir](http://elixir-lang.org) \u304c\u8a00\u8a9e\u306e **Web Application Framework** \u3067\u3059\u3002\n**WebSocket** \u304c\u6a19\u6e96\u306e\u6a5f\u80fd\u3067\u5229\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n**Elixir** \u306f Erlang VM \u3067\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\u5916\u90e8DSL\u304c\u7c21\u5358\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002\n\n### Setup\n\n* **Elixir** \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068 `mix` \u306e\u30b3\u30de\u30f3\u30c9\u304c\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n* `mix` \u30b3\u30de\u30f3\u30c9\u3067 **Phoenix** \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n* `mix archive.install` \u306f[\u3053\u3053](https://github.com/phoenixframework/phoenix/releases/)\u304b\u3089 *[URL]* \u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n```bash\n$ brew install elixir\n$ mix local.hex\n$ mix archive.install https://[URL]/phoenix_new-x.x.x.ez\n```\n\n* \u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b **PostgreSQL** \u304c\u5229\u7528\u3055\u308c\u307e\u3059\u3002\n\n```bash\n$ brew install postgresql\n$ createuser -d -P postgres\n$ postgres -D /usr/local/var/postgres\n```\n\n* `mix phoenix.new` \u30b3\u30de\u30f3\u30c9\u3067 **Web Application** \u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n* `mix phoenix.gen.html` \u30b3\u30de\u30f3\u30c9\u3067 *Message* \u306e **Generator** \u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```bash\n$ mix phoenix.new phoenix_channel_example\n$ cd phoenix_channel_example\n$ mix ecto.create\n$ mix phoenix.gen.html Message messages content:text\n```\n\n* **Router** \u306b *Message* \u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\uff08\u3088\u304f\u5fd8\u308c\u307e\u3059\u3002\uff09\n\n`web/router.ex`:\n\n```\nresources \"/messages\", MessageController\n```\n\n### Making\n\n**Channels** \u306e\u5b9f\u88c5\u306f[\u3053\u3061\u3089](http://www.phoenixframework.org/docs/channels)\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\u3002\n\n#### Server\n\n* **Channels** \u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n`web/channels/user_socket.ex`:\n\n```\nchannel \"rooms:*\", PhoenixChannelExample.RoomChannel\n```\n\n* **Channels** \u306e\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n    * `join` \u3067\u30c1\u30e3\u30f3\u30cd\u30eb\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n    * `handle_out` \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n    * `handle_in` \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u53d7\u4fe1\u3055\u308c\u307e\u3059\u3002\n\n`web/channels/room_channel.ex`:\n\n```\ndefmodule PhoenixChannelExample.RoomChannel do\n  use Phoenix.Channel\n\n  def join(\"rooms:lobby\", auth_msg, socket) do\n    {:ok, socket}\n  end\n\n  def join(\"rooms:\" <> _private_room_id, _auth_msg, socket) do\n    {:error, %{reason: \"unauthorized\"}}\n  end\n\n  def handle_in(\"new_msg\", %{\"body\" => body}, socket) do\n    broadcast! socket, \"new_msg\", %{body: body}\n    {:noreply, socket}\n  end\n\n  def handle_out(\"new_msg\", payload, socket) do\n    push socket, \"new_msg\", payload\n    {:noreply, socket}\n  end\nend\n```\n\n#### Client\n\n* **Channels** \u306e\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n    * `chan = socket.channel` \u3067\u30c1\u30e3\u30f3\u30cd\u30eb\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n    * `chan.push` \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n    * `chan.on` \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u53d7\u4fe1\u3055\u308c\u307e\u3059\u3002\n\n`web/static/js/app.js`:\n\n```\nimport {Socket} from \"deps/phoenix/web/static/js/phoenix\"\n\nlet message_content   = $(\"#message_content\")\nlet messagesContainer = $(\"#messages\")\n\nlet socket = new Socket(\"/socket\")\nsocket.connect()\nlet chan = socket.channel(\"rooms:lobby\", {})\n\nmessage_content.on(\"keypress\", event => {\n  if(event.keyCode === 13){\n    chan.push(\"new_msg\", {body: message_content.val()})\n    message_content.val(\"\")\n    return false\n  }\n})\n\nchan.on(\"new_msg\", payload => {\n  messagesContainer.append(`<br/>${payload.body}`)\n})\n\nchan.join().receive(\"ok\", chan => {\n  console.log(\"Welcome to Phoenix Chat!\")\n})\n```\n\n* *DOM* \u306e\u64cd\u4f5c\u306f **JQuery** \u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n`web/templates/layout/app.html.eex`:\n\n```\n<script src=\"//code.jquery.com/jquery-1.11.2.min.js\"></script>\n```\n\n* \u30e1\u30c3\u30bb\u30fc\u30b8\u306f `<div id=\"messages\"></div>` \u306b\u51fa\u529b\u3057\u307e\u3059\u3002\n\n`web/templates/message/new.html.eex`:\n\n```\n<div id=\"messages\"></div>\n```\n\n### Run\n\n* \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash\n$ mix ecto.migrate\n$ mix phoenix.server\n```\n\n![phoenix](https://dl.dropboxusercontent.com/u/14690051/images/notes/lang/framework/websocket/example/phoenix.png)\n[\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9](https://github.com/dddrb/phoenix-channel-example)\n\n\u624b\u9806\u306f\u5897\u3048\u307e\u3057\u305f\u304c\u3001\u9ad8\u5ea6\u306a\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u7c21\u5358\u306b\u3067\u304d\u307e\u3059\u3002\n\n---\n\n## Ruby on Rails\n\n![logo-rails](https://dl.dropboxusercontent.com/u/14690051/images/notes/lang/framework/websocket/logo/rails.png)\n\n**Rails** \u306f [Ruby](https://www.ruby-lang.org) \u304c\u8a00\u8a9e\u306e **Web Application Framework** \u3067\u3059\u3002\n**WebSocket** \u306f **ActionCable** \u306e\u6a5f\u80fd\u3067\u5229\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n**Ruby** \u306f\u3082\u3061\u308d\u3093\u3001\u5916\u90e8DSL\u304c\u7c21\u5358\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002\n\n### Setup\n\n* **Ruby** \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068 `gem` \u306e\u30b3\u30de\u30f3\u30c9\u304c\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n* \u4eca\u56de\u306f `gem` \u30b3\u30de\u30f3\u30c9\u3067 **Rails** \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u305b\u3093\u3002\n* `gem` \u30b3\u30de\u30f3\u30c9\u3067 [Bundler](http://bundler.io/) \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```bash\n$ brew install ruby\n$ gem install bundler\n```\n\n* \u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u306e **Rails** \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n* `rails` \u30b3\u30de\u30f3\u30c9\u3067 **Web Application** \u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n* `--edge` \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b\u3068 *Gemfile* \u304c **GitHub** \u3092\u53c2\u7167\u3057\u307e\u3059\u3002\n\n```bash\n$ git clone https://github.com/rails/rails.git\n$ cd rails\n$ bundle install\n$ cd ..\n$ rails/railties/exe/rails new rails-actioncable-example --edge\n$ cd rails-actioncable-example\n```\n\n* **ActionCable** \u3067 **Redis** \u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n```bash\n$ brew install redis\n```\n\n* **Rails** \u3067\u5229\u7528\u3059\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u3092 `Gemfile` \u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n`Gemfile`:\n\n```\ngem 'actioncable', github: 'rails/actioncable'\ngem 'puma'\ngem 'foreman', require: false\n```\n\n* `rails generate` \u30b3\u30de\u30f3\u30c9\u3067 *Message* \u306e **Generator** \u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\n$ bundle\n$ bundle exec rails generate scaffold Message content:text\n```\n\n### Making\n\n*ActionCable* \u306e\u5b9f\u88c5\u306f[\u3053\u3061\u3089](https://github.com/rails/actioncable-examples)\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\u3002\n\n#### Server\n\n* \u63a5\u7d9a\u306e\u30b9\u30fc\u30d1\u30fc\u30af\u30e9\u30b9\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\uff08\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u30fc\u307e\u3060\u304b\u306a\u3041\uff09\n\n`app/channels/application_cable/connection.rb`:\n\n```\nmodule ApplicationCable\n  class Connection < ActionCable::Connection::Base\n  end\nend\n```\n\n* \u30c1\u30e3\u30f3\u30cd\u30eb\u306e\u30b9\u30fc\u30d1\u30fc\u30af\u30e9\u30b9\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\uff08\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u30fc\u307e\u3060\u304b\u306a\u3041\uff09\n\n`app/channels/application_cable/channel.rb`:\n\n```\nmodule ApplicationCable\n  class Channel < ActionCable::Channel::Base\n  end\nend\n```\n\n* \u30c1\u30e3\u30f3\u30cd\u30eb\u306eSubscribe(\u8cfc\u8aad)\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n`app/channels/messages_channel.rb`:\n\n```\nclass MessagesChannel < ApplicationCable::Channel\n  def subscribed\n    stream_from \"messages\"\n  end\nend\n```\n\n* `POST /messages` \u306e `server.broadcast` \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n\n`app/controllers/messages_controller.rb`:\n\n```\ndef create\n  ActionCable.server.broadcast 'messages', message: params[:message][:content]\n  head :ok\nend\n```\n\n* **ActionCable** \u306e **Rack** \u306e\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n`config/racks/cable.ru`:\n\n```\nrequire ::File.expand_path('../../environment',  __FILE__)\nRails.application.eager_load!\n\nrequire \"action_cable/process/logging\"\n\nrun ActionCable.server\n```\n\n* **ActionCable** \u8a2d\u5b9a\u3092 **yml** \u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n`config/redis/cable.yml`:\n\n```\nproduction: &base\n  :url: redis://localhost:6379\n  :host: localhost\n  :port: 6379\n  :timeout: 1\n  :inline: true\ndevelopment: *base\ntest: *base\n```\n\n* **Rails** \u3068 **ActionCable** \u306e\u5b9f\u884c\u30b3\u30de\u30f3\u30c9\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n`Procfile`:\n\n```\nweb: bundle exec rails server\ncable: bundle exec puma -p 28080 config/racks/cable.ru\n```\n\n#### Client\n\n* `App.cable = Cable.createConsumer` \u3067\u30c1\u30e3\u30f3\u30cd\u30eb\u3092\u8a2d\u5b9a\u307e\u3059\u3002\n\n`app/assets/javascripts/channels/index.coffee`:\n\n```\n#= require cable\n#= require_self\n#= require_tree .\n\n@App = {}\nApp.cable = Cable.createConsumer \"ws://localhost:28080\"\n```\n\n* `received` \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u53d7\u4fe1\u3055\u308c\u307e\u3059\u3002\n* *DOM* \u306e\u64cd\u4f5c\u306f **JQuery** \u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n`app/assets/javascripts/messages.coffee`:\n\n```\nApp.messages = App.cable.subscriptions.create 'MessagesChannel',\n  received: (data) ->\n    $('#messages').append($('<p>').text(data.message))\n```\n\n* `form_for` \u306e `remote: true` \u3067\u30da\u30fc\u30b8\u30ea\u30ed\u30fc\u30c9\u3092\u6291\u5236\u3057\u307e\u3059\u3002\n* `Submit` \u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n\n`app/views/messages/_form.html.erb`:\n\n```\n<%= form_for(message, remote: true) do |f| %>\n```\n\n* \u30e1\u30c3\u30bb\u30fc\u30b8\u306f `<div id=\"messages\"></div>` \u306b\u51fa\u529b\u3057\u307e\u3059\u3002\n\n`app/views/messages/new.html.erb`:\n\n```\n<div id='messages'></div>\n```\n\n### Run\n\n* \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash\n$ rake db:migrate\n$ bundle exec foreman start\n```\n\n![rails](https://dl.dropboxusercontent.com/u/14690051/images/notes/lang/framework/websocket/example/rails.png)\n[\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9](https://github.com/dddrb/rails-actioncable-example)\n\n\u304b\u306a\u308a\u624b\u9806\u306f\u5897\u3048\u307e\u3057\u305f\u304c\u3001\u3053\u306e\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\n\n## Tips\n\n### ActionCable with ActiveJob\n\n**Node.js** \u3084 **Elixir** \u306f\u975e\u540c\u671f\u51e6\u7406\u306e\u30e1\u30ab\u30cb\u30ba\u30e0\u304c\u3042\u308a\u3001\u591a\u304f\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u51e6\u7406\u3059\u308b\u306e\u306b\u5411\u3044\u3066\u3044\u307e\u3059\u3002\n**Ruby** \u3067\u975e\u540c\u671f\u51e6\u7406\u3092\u5b9f\u88c5\u3059\u308b\u306b\u306f **EventMachine** \u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u5229\u7528\u3059\u308b\u306e\u3067\u3059\u304c\u3001\u3055\u3089\u306b **Rails** \u3067\u306f **ActiveJob** \u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u5229\u7528\u3057\u305f\u308a\u3001 **Redis** \u306e `Pub/Sub` \u3092\u5229\u7528\u3057\u3066\u975e\u540c\u671f\u51e6\u7406\u3092\u5b9f\u73fe\u3057\u3066\u3044\u307e\u3059\u3002\n\n* \u307e\u305a\u3001 **sidekiq** \u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092 `Gemfile` \u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n`Gemfile`:\n\n```\ngem 'sidekiq'\n```\n\n* \u6b21\u306b\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\u51e6\u7406\u3092 `Job` \u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n`app/jobs/message_job.rb`\n\n```\nclass MessageJob < ApplicationJob\n  queue_as :default\n\n  def perform(*args)\n    ActionCable.server.broadcast 'messages', message: args[0]\n  end\nend\n```\n\n* \u3055\u304d\u307b\u3069\u306e `POST /messages` \u306b\u975e\u540c\u671f\u306e\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n`app/controllers/messages_controller.rb`:\n\n```\ndef create\n  MessageJob.perform_later(params[:message][:content])\n  head :ok\nend\n```\n\n*Enjoy WebSocket*\n"}