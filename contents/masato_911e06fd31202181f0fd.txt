{"context": " More than 1 year has passed since last update.\n\n\u3053\u306e\u30b7\u30ea\u30fc\u30ba\n\nApache Zeppelin\u3067\u30c7\u30fc\u30bf\u5206\u6790\u3092\u5206\u6563\u51e6\u7406\u3059\u308b - Part 1: \u30c7\u30fc\u30bf\u5206\u6790\u306e\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\nApache Zeppelin\u3067\u30c7\u30fc\u30bf\u5206\u6790\u3092\u5206\u6563\u51e6\u7406\u3059\u308b - Part 2: Ambari on Docker\u306bZeppelin\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3059\u308b\nApache Zeppelin\u3067\u30c7\u30fc\u30bf\u5206\u6790\u3092\u5206\u6563\u51e6\u7406\u3059\u308b - Part 3: Zeppelin\u3067Hive\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\nApache Zeppelin\u3067\u30c7\u30fc\u30bf\u5206\u6790\u3092\u5206\u6563\u51e6\u7406\u3059\u308b - Part 4: Ambari on Docker\u306eambari-functions\u3092\u4f7f\u3063\u3066\u307f\u308b\n\n\nAmbari on Docker\n\u3000Apache Ambari\u3067Hadoop\u30af\u30e9\u30b9\u30bf\u3092Docker\u4e0a\u306b\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u3066\u307f\u307e\u3059\u3002Ambari\u306fHadoop\u7ba1\u7406\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3067\u3059\u3002\u30d6\u30e9\u30a6\u30b6\u306e\u7ba1\u7406\u753b\u9762\u304b\u3089Hadoop\u306e\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3084\u76e3\u8996\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u304c\u3001\u4eca\u56de\u306fAmbari Shell\u306eCLI\u304b\u3089HDP\u3092\u30af\u30e9\u30b9\u30bf\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u3066\u307f\u307e\u3059\u3002\n\u3000SequenceIQ\u304c\u516c\u958b\u3057\u3066\u3044\u308bsequenceiq/ambari\u306eDocker\u30a4\u30e1\u30fc\u30b8\u3092pull\u3057\u307e\u3059\u3002\u30ea\u30dd\u30b8\u30c8\u30ea\u306fdocker-ambari\u3067\u3059\u3002\n$ docker pull sequenceiq/ambari\n\n\u3000docker-ambari\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002\n$ git clone https://github.com/sequenceiq/docker-ambari\n$ cd docker-ambari\n$ source ambari-functions\n\n\u3000ambari-functions\u306b\u306famb-*\u95a2\u6570\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002Ambari on Docker\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u524d\u306b\u74b0\u5883\u5909\u6570\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n$ amb-settings\n  NODE_PREFIX=amb\n  CLUSTER_SIZE=3\n  AMBARI_SERVER_NAME=amb-server\n  IMAGE=sequenceiq/ambari:2.1.2-v1\n  DOCKER_OPTS=\n  AMBARI_SERVER_IP=\n  CONSUL=amb-consul\n  CONSUL_IMAGE=sequenceiq/consul:v0.5.0-v6\n  DRY_RUN=false\n\n\u3000Docker\u306b4\u30ce\u30fc\u30c9\u306e\u30af\u30e9\u30b9\u30bf\u3092\u69cb\u7bc9\u3057\u307e\u3059\u30024\u30ce\u30fc\u30c9\u306e\u3046\u30611\u30ce\u30fc\u30c9\u306fAmbari Server\u306b\u306a\u308a\u307e\u3059\u3002\u305d\u306e\u305f\u3081Hadoop\u30af\u30e9\u30b9\u30bf\u306f3\u30ce\u30fc\u30c9\u306e\u30b3\u30f3\u30c6\u30ca\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\u3002\n$ amb-start-cluster 4\n\n\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3059\u308b\u3068AMBARI_SERVER_IP\u74b0\u5883\u5909\u6570\u306bAmbari Server\u30b3\u30f3\u30c6\u30ca\u306eIP\u30a2\u30c9\u30ec\u30b9\u304c\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u3002\n$ amb-settings\n  NODE_PREFIX=amb\n  CLUSTER_SIZE=3\n  AMBARI_SERVER_NAME=amb-server\n  IMAGE=sequenceiq/ambari:2.1.2-v1\n  DOCKER_OPTS=\n  AMBARI_SERVER_IP=172.17.0.3\n  CONSUL=amb-consul\n  CONSUL_IMAGE=sequenceiq/consul:v0.5.0-v6\n  DRY_RUN=false\n\n\u3000Ambari\u306eREST API\u3092curl\u30b3\u30de\u30f3\u30c9\u304b\u3089Ambari\u304c\u7ba1\u7406\u3057\u3066\u3044\u308b\u30db\u30b9\u30c8\u306e\u60c5\u5831\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n$ curl -u admin:admin  http://$AMBARI_SERVER_IP:8080/api/v1/hosts\n{\n  \"href\" : \"http://172.17.0.3:8080/api/v1/hosts\",\n  \"items\" : [\n    {\n      \"href\" : \"http://172.17.0.3:8080/api/v1/hosts/amb1.service.consul\",\n      \"Hosts\" : {\n        \"host_name\" : \"amb1.service.consul\"\n      }\n    },\n    {\n      \"href\" : \"http://172.17.0.3:8080/api/v1/hosts/amb2.service.consul\",\n      \"Hosts\" : {\n        \"host_name\" : \"amb2.service.consul\"\n      }\n    },\n    {\n      \"href\" : \"http://172.17.0.3:8080/api/v1/hosts/amb3.service.consul\",\n      \"Hosts\" : {\n        \"host_name\" : \"amb3.service.consul\"\n      }\n    }\n  ]\n}\n\n\u3000\u5225\u306e\u30b7\u30a7\u30eb\u304b\u3089\u5b9f\u884c\u3059\u308b\u306a\u3069AMBARI_SERVER_IP\u74b0\u5883\u5909\u6570\u304c\u8aad\u307f\u8fbc\u307e\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u624b\u52d5\u3067\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n$ AMBARI_SERVER_IP=$(docker inspect --format=\"{{ .NetworkSettings.IPAddress }}\" amb-server)\n\n\nAmbari Shell\nAmbari Shell\u306b\u3082sequenceiq/ambari-shellDocker\u30a4\u30e1\u30fc\u30b8\u304c\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u30ea\u30dd\u30b8\u30c8\u30ea\u306fdocker-ambari-shell\u3067\u3059\u3002\u4eca\u56de\u306fsequenceiq/ambari\u306b\u5165\u3063\u3066\u3044\u308bambari-shell.sh\u304b\u3089Ambari Shell\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ docker run -it --rm \\\n  --link amb-server:ambariserver \\\n  --entrypoint /bin/sh \\\n  sequenceiq/ambari \\\n  ./ambari-shell.sh\n\n\u3000Ambari Shell\u304c\u8d77\u52d5\u3057\u307e\u3057\u305f\u3002\nAMBARI_HOST=172.17.0.3\n[DEBUG] waits for ambari server: 172.17.0.3 RUNNING ...\n\n[DEBUG] waits until 1 hosts connected to server ...\n[DEBUG] connected hosts: 3\n    _                _                   _  ____   _            _  _\n   / \\    _ __ ___  | |__    __ _  _ __ (_)/ ___| | |__    ___ | || |\n  / _ \\  | '_ ` _ \\ | '_ \\  / _` || '__|| |\\___ \\ | '_ \\  / _ \\| || |\n / ___ \\ | | | | | || |_) || (_| || |   | | ___) || | | ||  __/| || |\n/_/   \\_\\|_| |_| |_||_.__/  \\__,_||_|   |_||____/ |_| |_| \\___||_||_|\n\nWelcome to Ambari Shell. For command and param completion press TAB, for assistance type 'hint'.\nambari-shell>\n\n\nBlueprint\nBlueprint\u306fHadoop\u30af\u30e9\u30b9\u30bf\u3092JSON\u5f62\u5f0f\u3067\u5b9a\u7fa9\u3057\u307e\u3059\u3002Web\u753b\u9762\u306e\u30a6\u30a3\u30b6\u30fc\u30c9\u3092\u4f7f\u308f\u306a\u304f\u3066\u3082REST API\u3084Ambari Shell\u304b\u3089\u30af\u30e9\u30b9\u30bf\u306e\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\nCloudbreak\u306eBlueprint\n\u3000SequenceIQ\u306eCloudbreakBlueprints\u306b\u3044\u304f\u3064\u304bBlueprint\u306e\u4f8b\u304c\u63b2\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u3002Cloudbreak\u306fAmbari\u3092\u30d9\u30fc\u30b9\u306b\u3057\u305f\u30af\u30e9\u30a6\u30c9\u5411\u3051\u306eHadoop\u7ba1\u7406\u30c4\u30fc\u30eb\u3067\u3059\u3002Azure\u3001AWS\u3001GCP\u3001OpenStack\u306e\u30af\u30e9\u30a6\u30c9\u3068Docker\u306b\u3082\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8aad\u3080\u3068Ambari Blueprint\u3060\u3051\u3067\u3082\u4f7f\u3048\u305d\u3046\u3067\u3059\u3002\n\ndatascientist\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\u3000Cloudbreak\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089datascientist.bp\u304b\u3089\u3001Docker\u30b3\u30f3\u30c6\u30ca\u3067\u69cb\u6210\u3057\u305fAmbari\u30ce\u30fc\u30c9\u306bHDP\u30af\u30e9\u30b9\u30bf\u3092\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3057\u307e\u3059\u3002\n\u3000\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u767b\u9332\u3055\u308c\u3066\u3044\u308bsingle-node-hdfs-yarn\u3092\u9069\u7528\u3057\u305f\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u306e\u6d41\u308c\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\nblueprint defaults\nblueprint list\ncluster build --blueprint single-node-hdfs-yarn\ncluster autoAssign\ncluster create\ntasks\n\n\u3000\u5148\u307b\u3069\u8d77\u52d5\u3057\u305fAmbari Shell\u306e\u4e2d\u3067datascientist\u306eBlueprint\u306eURL\u3092\u767b\u9332\u3057\u307e\u3059\u3002\nambari-shell> blueprint add --url https://raw.githubusercontent.com/sequenceiq/cloudbreak/master/core/src/main/resources/defaults/blueprints/datascientist.bp\nBlueprint: 'datascientist' has been added\n\n\u3000\u767b\u9332\u3057\u305fdatascientist\u3092\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002Ambari\u30db\u30b9\u30c8\u306e\u60c5\u5831\u3068Blueprint\u306b\u3066\u7591\u7fa9\u3055\u308c\u305f\u30db\u30b9\u30c8\u30b0\u30eb\u30fc\u30d7\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\nambari-shell> cluster build --blueprint datascientist\n  HOSTNAME             STATE\n  -------------------  -------------------\n  amb3.service.consul  amb3.service.consul\n  amb1.service.consul  amb1.service.consul\n  amb2.service.consul  amb2.service.consul\n\n  HOSTGROUP  COMPONENT\n  ---------  ----------------------\n  client     TEZ_CLIENT\n  client     YARN_CLIENT\n  client     HIVE_CLIENT\n  client     HDFS_CLIENT\n  client     PIG\n  client     MAPREDUCE2_CLIENT\n  client     ZOOKEEPER_CLIENT\n  client     HCAT\n  client     METRICS_COLLECTOR\n  client     SPARK_CLIENT\n  client     METRICS_MONITOR\n  client     HBASE_CLIENT\n  slave_1    HBASE_REGIONSERVER\n  slave_1    NODEMANAGER\n  slave_1    DATANODE\n  slave_1    METRICS_MONITOR\n  master_1   RESOURCEMANAGER\n  master_1   JOURNALNODE\n  master_1   WEBHCAT_SERVER\n  master_1   MYSQL_SERVER\n  master_1   ZOOKEEPER_CLIENT\n  master_1   HISTORYSERVER\n  master_1   SECONDARY_NAMENODE\n  master_1   METRICS_MONITOR\n  master_1   NAMENODE\n  master_1   ZEPPELIN_MASTER\n  master_1   TEZ_CLIENT\n  master_1   YARN_CLIENT\n  master_1   MAPREDUCE2_CLIENT\n  master_1   HDFS_CLIENT\n  master_1   HIVE_SERVER\n  master_1   HBASE_MASTER\n  master_1   PIG\n  master_1   SPARK_JOBHISTORYSERVER\n  master_1   HIVE_METASTORE\n  master_1   ZOOKEEPER_SERVER\n  master_1   APP_TIMELINE_SERVER\n\n\u3000cluster autoAssign\u3092\u5b9f\u884c\u3059\u308b\u3068\u30db\u30b9\u30c8\u30b0\u30eb\u30fc\u30d7\u306e\u5b9a\u7fa9\u306b\u5fdc\u3058\u3066\u81ea\u52d5\u7684\u306bAmbari\u30db\u30b9\u30c8\u304c\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u307e\u3059\u3002\u4eca\u56de\u306f3\u3064\u306e\u30db\u30b9\u30c8\u30b0\u30eb\u30fc\u30d7\u306b1\u3064\u305a\u3064\u624b\u52d5\u3067\u30db\u30b9\u30c8\u3092\u30a2\u30b5\u30a4\u30f3\u3057\u3066\u3044\u304d\u307e\u3059\u3002\nCLUSTER_BUILD:datascientist> cluster assign --hostGroup master_1 --host amb1.service.consul\namb1.service.consul has been added to master_1\nCLUSTER_BUILD:datascientist> cluster assign --hostGroup slave_1 --host amb2.service.consul\namb2.service.consul has been added to slave_1\nCLUSTER_BUILD:datascientist> cluster assign --hostGroup client --host amb3.service.consul\namb3.service.consul has been added to client\n\n\u3000\u6700\u5f8c\u306bcluster create\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066HDP\u30af\u30e9\u30b9\u30bf\u306e\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\nCLUSTER_BUILD:datascientist> cluster create --exitOnFinish true\n\n\u3000tasks\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u5404\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u72b6\u6cc1\u304c\u308f\u304b\u308a\u307e\u3059\u3002\u307e\u305f\u30b7\u30a7\u30eb\u306e\u53f3\u4e0a\u306b\u5b8c\u4e86\u307e\u3067\u306e\u5168\u4f53\u306e\u30d1\u30fc\u30bb\u30f3\u30c8\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002IDCF\u30af\u30e9\u30a6\u30c9\u306estandard.L16 (4 CPU x 2.4 GHz 16 GB RAM)\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u3067\u306f13\u5206\u307b\u3069\u304b\u304b\u308a\u307e\u3057\u305f\u3002\n\nConsul\u3068Nginx\u306e\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\n\u3000Hadoop\u30af\u30e9\u30b9\u30bf\u306e\u30b5\u30fc\u30d3\u30b9\u30c7\u30a3\u30b9\u30ab\u30d0\u30ea\u306b\u306fConsul\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002Docker\u30a4\u30e1\u30fc\u30b8\u306fsequenceiq/consul\u3001\u30ea\u30dd\u30b8\u30c8\u30ea\u306fgliderlabs/docker-consul\u304b\u3089fork\u3057\u305fsequenceiq/docker-consul\u3067\u3059\u3002\nps\u30b3\u30de\u30f3\u30c9\u3067\u30b3\u30f3\u30c6\u30ca\u306e\u30dd\u30fc\u30c8\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ docker ps\nCONTAINER ID        IMAGE                         COMMAND                  CREATED             STATUS              PORTS                                                              NAMES\nce146ebf73f1        sequenceiq/ambari:2.1.2-v1    \"/start-agent\"           12 minutes ago      Up 12 minutes       8080/tcp                                                           amb3\n9c23d449cb83        sequenceiq/ambari:2.1.2-v1    \"/start-agent\"           12 minutes ago      Up 12 minutes       8080/tcp                                                           amb2\n162662822eb1        sequenceiq/ambari:2.1.2-v1    \"/start-agent\"           12 minutes ago      Up 12 minutes       8080/tcp                                                           amb1\n6729936f59f8        sequenceiq/ambari:2.1.2-v1    \"/start-server\"          12 minutes ago      Up 12 minutes       8080/tcp                                                           amb-server\n02ee7f29a74e        sequenceiq/consul:v0.5.0-v6   \"/bin/start -server -\"   12 minutes ago      Up 12 minutes       53/tcp, 53/udp, 8300-8302/tcp, 8400/tcp, 8500/tcp, 8301-8302/udp   amb-consul\n\n\u3000\u4e0a\u8a18\u306e\u3088\u3046\u306bDocker\u30b3\u30f3\u30c6\u30ca\u306e\u30dd\u30fc\u30c8\u306fDocker\u30db\u30b9\u30c8\u306b\u30de\u30c3\u30d7\u3057\u3066\u3044\u307e\u305b\u3093\u3002\u305d\u306e\u305f\u3081Docker\u30db\u30b9\u30c8\u304b\u3089\u3057\u304bDocker\u30b3\u30f3\u30c6\u30ca\u306eIP\u30a2\u30c9\u30ec\u30b9\u3078\u30a2\u30af\u30bb\u30b9\u304c\u3067\u304d\u307e\u305b\u3093\u3002\u4eca\u56de\u306e\u74b0\u5883\u306fIDCF\u30af\u30e9\u30a6\u30c9\u4e0a\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u306a\u306e\u3067\u3001\u30d1\u30d6\u30ea\u30c3\u30afIP\u30a2\u30c9\u30ec\u30b9\u304b\u3089Ambari\u3068Zeppelin\u306e\u7ba1\u7406\u753b\u9762\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306bNignx\u30b3\u30f3\u30c6\u30ca\u3067\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3092\u4f5c\u308a\u307e\u3059\u3002\n\nConsul\n\u3000Ambari Server\u306eREST API\u306eJSON\u3092\u898b\u3084\u3059\u304f\u3059\u308b\u305f\u3081\u306bjq\u3092Docker\u30db\u30b9\u30c8\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ wget -P /usr/local/bin jq http://stedolan.github.io/jq/download/linux64/jq\n$ chmod u+x /usr/local/bin/jq\n$ which jq\n/usr/local/bin/jq\n\nConsul\u30af\u30e9\u30b9\u30bf\u306e\u30ce\u30fc\u30c9\u3092\u8868\u793a\u3057\u3066\u307f\u307e\u3059\u3002\n$ AMB_CONSUL=$(docker inspect --format=\"{{ .NetworkSettings.IPAddress }}\" amb-consul)\n$ echo $AMB_CONSUL\n172.17.0.2\n$ curl -s $AMB_CONSUL:8500/v1/catalog/nodes | jq .\n[\n  {\n    \"Node\": \"amb-consul.service.consul\",\n    \"Address\": \"172.17.0.2\"\n  },\n  {\n    \"Node\": \"amb-server\",\n    \"Address\": \"172.17.0.3\"\n  },\n  {\n    \"Node\": \"amb1\",\n    \"Address\": \"172.17.0.4\"\n  },\n  {\n    \"Node\": \"amb2\",\n    \"Address\": \"172.17.0.5\"\n  },\n  {\n    \"Node\": \"amb3\",\n    \"Address\": \"172.17.0.6\"\n  },\n  {\n    \"Node\": \"ambari-8080\",\n    \"Address\": \"172.17.0.3\"\n  }\n]\n\n\u3000Consul\u306b\u767b\u9332\u3055\u308c\u305f\u30b5\u30fc\u30d3\u30b9\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n$ curl -s $AMB_CONSUL:8500/v1/catalog/services | jq .\n{\n  \"amb-server\": [],\n  \"amb1\": [],\n  \"amb2\": [],\n  \"amb3\": [],\n  \"ambari-8080\": [],\n  \"consul\": []\n}\n\n\u3000amb-consul\u30b5\u30fc\u30d3\u30b9\u306e\u8a73\u7d30\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n$ curl -s $AMB_CONSUL:8500/v1/catalog/service/consul | jq .\n[\n  {\n    \"Node\": \"amb-consul.service.consul\",\n    \"Address\": \"172.17.0.2\",\n    \"ServiceID\": \"consul\",\n    \"ServiceName\": \"consul\",\n    \"ServiceTags\": [],\n    \"ServiceAddress\": \"\",\n    \"ServicePort\": 8300\n  }\n]\n\n\u3000dig\u30b3\u30de\u30f3\u30c9\u3067Consul\u306eDNS\u30b5\u30fc\u30d3\u30b9\u3092\u898b\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\n$ dig @$AMB_CONSUL -p 53 amb-consul.service.consul\n\n; <<>> DiG 9.9.5-9+deb8u3-Debian <<>> @172.17.0.2 -p 53 amb-consul.service.consul\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NXDOMAIN, id: 65241\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 0\n\n;; QUESTION SECTION:\n;amb-consul.service.consul.     IN      A\n\n;; Query time: 1 msec\n;; SERVER: 172.17.0.2#53(172.17.0.2)\n;; WHEN: Sat Dec 05 21:47:03 JST 2015\n;; MSG SIZE  rcvd: 43\n\n\nConsul Tempate\u3068Nginx\n\u3000Consul Template\u3092\u4f7f\u3044Docker\u30b3\u30f3\u30c6\u30ca\u306e\u60c5\u5831\u304b\u3089Nginx\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u751f\u6210\u3057\u307e\u3059\u3002jlordiales/nginx-consul\u306eDocker\u30a4\u30e1\u30fc\u30b8\u304c\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u4eca\u56de\u306fAmbari\u7528\u306b\u30ea\u30dd\u30b8\u30c8\u30ea\u3092fork\u3057\u307e\u3057\u305f\u3002\n\u4ee5\u4e0b\u306e\u3088\u3046\u306aDockerfile\u304b\u3089Docker\u30a4\u30e1\u30fc\u30b8\u3092\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\nFROM nginx:latest\n\nENV CONSUL_TEMPLATE_VERSION 0.11.0\nENV CONSUL_URL consul:8500\n\nADD start.sh /bin/start.sh\nRUN rm -v /etc/nginx/conf.d/*.conf\n\nADD https://github.com/hashicorp/consul-template/releases/download/v${CONSUL_TEMPLATE_VERSION}/consul_template_${CONSUL_TEMPLATE_VERSION}_linux_amd64.zip /tmp/consul-template.zip\n\nRUN apt-get update && apt-get install unzip -y && \\\n    unzip -j -d /usr/local/bin /tmp/consul-template.zip\n\nEXPOSE 8080 9995 9996\nVOLUME /templates\n\nCMD [\"/bin/start.sh\"]\nRUN apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n\nConsul Template\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306fservice.ctmpl\u3067\u3059\u30029995\u30689996\u306fZeppelin\u30b5\u30fc\u30d0\u30fc\u304c\u8d77\u52d5\u3057\u3066\u3044\u308bamb1\u30ce\u30fc\u30c9\u306b\u30d7\u30ed\u30ad\u30b7\u30fc\u3057\u307e\u3059\u30029996\u30dd\u30fc\u30c8\u306fWebSocket\u7528\u306b\u30d8\u30c3\u30c0\u30fc\u3082\u8ffd\u52a0\u3057\u307e\u3059\u30028080\u30dd\u30fc\u30c8\u306fAmb Server\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3057\u3066\u3044\u308bamb-server\u30ce\u30fc\u30c9\u306b\u30d7\u30ed\u30ad\u30b7\u30fc\u3057\u307e\u3059\u3002\nserver {\n  listen 9995;\n\n  location / {\n    proxy_set_header   Host $host;\n    proxy_set_header   X-Real-IP $remote_addr;\n    proxy_set_header   X-Forwarded-Host $host;\n    proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header   X-Forwarded-Proto $scheme;\n    proxy_pass         http://{{with node \"amb1\"}}{{.Node.Address}}{{end}}:9995;\n  }\n}\n\nserver {\n  listen 9996;\n\n  location / {\n    proxy_set_header   Host $host;\n    proxy_set_header   X-Real-IP $remote_addr;\n    proxy_set_header   X-Forwarded-Host $host;\n    proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header   X-Forwarded-Proto $scheme;\n    proxy_pass         http://{{with node \"amb1\"}}{{.Node.Address}}{{end}}:9996;\n    proxy_http_version 1.1;\n    proxy_set_header   Upgrade $http_upgrade;\n    proxy_set_header   Connection \"upgrade\";\n    proxy_read_timeout 86400;\n  }\n}\n\nserver {\n  listen 8080;\n\n  location / {\n    proxy_set_header   Host $host;\n    proxy_set_header   X-Real-IP $remote_addr;\n    proxy_set_header   X-Forwarded-Host $host;\n    proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header   X-Forwarded-Proto $scheme;\n    proxy_pass         http://{{with node \"amb-server\"}}{{.Node.Address}}{{end}}:8080;\n  }\n}\n\n\u3000fork\u3057\u305f\u30ea\u30dd\u30b8\u30c8\u30ea\u3092clone\u3057\u3066Docker\u30a4\u30e1\u30fc\u30b8\u3092\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\n$ git clone https://github.com/masato/docker-nginx-consul.git\n$ cd docker-nginx-consul\n$ docker build -t nginx-consul .\n\n\u3000--dns\u3068--dns-search\u30d5\u30e9\u30b0\u3092\u3064\u3051\u3066Nginx\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002--dns\u30d5\u30e9\u30b0\u306e\u9806\u756a\u306fDocker\u30db\u30b9\u30c8\u3001Google DNS\u306e\u524d\u306bConsul\u30b3\u30f3\u30c6\u30ca\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\u3068Nginx\u30b3\u30f3\u30c6\u30ca\u306e/etc/resolv.conf\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n/etc/resolv.conf\nsearch service.consul\nnameserver 172.17.0.2\nnameserver 172.17.0.1\nnameserver 8.8.8.8\n\n\n\u3000Ambari Server\u306e\u7ba1\u7406\u753b\u9762\u3067\u4f7f\u30468080\u3001Zeppelin\u306eNotebook\u306b\u4f7f\u30469995\u30689996\u30dd\u30fc\u30c8\u3092Docker\u30db\u30b9\u30c8\u306b\u30de\u30c3\u30d7\u3057\u3066\u5916\u90e8\u304b\u3089\u63a5\u7d9a\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n$ AMB_CONSUL=$(docker inspect --format=\"{{.NetworkSettings.IPAddress}}\" amb-consul)\n$ echo $AMB_CONSUL\n172.17.0.2\n$ docker run \\\n  --name nginx \\\n  -d \\\n  -p 8080:8080 -p 9995:9995 -p 9996:9996 \\\n  --volume $PWD/service.ctmpl:/templates/service.ctmpl \\\n  --dns $AMB_CONSUL \\\n  --dns 172.17.0.1 \\\n  --dns 8.8.8.8 \\\n  --dns-search service.consul \\\n  nginx-consul\n\n\u3000Nginx\u30b3\u30f3\u30c6\u30ca\u306b\u5165\u308a\u540d\u524d\u89e3\u6c7a\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ docker exec -it nginx bash\n$ echo $CONSUL_URL\nconsul:8500\n$ ping -c 1 amb1\nPING amb1.service.consul (172.17.0.4): 56 data bytes\n64 bytes from 172.17.0.4: icmp_seq=0 ttl=64 time=0.049 ms\n--- amb1.service.consul ping statistics ---\n1 packets transmitted, 1 packets received, 0% packet loss\nround-trip min/avg/max/stddev = 0.049/0.049/0.049/0.000 ms\n\n\u3000\n\u3000\u6700\u5f8c\u306bps\u30b3\u30de\u30f3\u30c9\u3067\u4eca\u56de\u4f5c\u6210\u3057\u305fDocker\u30b3\u30f3\u30c6\u30ca\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ docker ps\nCONTAINER ID        IMAGE                         COMMAND                  CREATED             STATUS              PORTS                                                                       NAMES\n48df8cfdd49f        nginx-consul                  \"/bin/start.sh\"          29 minutes ago      Up 29 minutes       80/tcp, 0.0.0.0:8080->8080/tcp, 443/tcp, 0.0.0.0:9995-9996->9995-9996/tcp   nginx\nce146ebf73f1        sequenceiq/ambari:2.1.2-v1    \"/start-agent\"           2 hours ago         Up 2 hours          8080/tcp                                                                    amb3\n9c23d449cb83        sequenceiq/ambari:2.1.2-v1    \"/start-agent\"           2 hours ago         Up 2 hours          8080/tcp                                                                    amb2\n162662822eb1        sequenceiq/ambari:2.1.2-v1    \"/start-agent\"           2 hours ago         Up 2 hours          8080/tcp                                                                    amb1\n6729936f59f8        sequenceiq/ambari:2.1.2-v1    \"/start-server\"          2 hours ago         Up 2 hours          8080/tcp                                                                    amb-server\n02ee7f29a74e        sequenceiq/consul:v0.5.0-v6   \"/bin/start -server -\"   2 hours ago         Up 2 hours          53/tcp, 53/udp, 8300-8302/tcp, 8400/tcp, 8301-8302/udp, 8500/tcp            amb-consul\n\n\nHDFS\n\u3000Zeppelin\u306e\u5b9f\u884c\u3092\u3059\u308b\u524d\u306bHDFS\u306broot\u30e6\u30fc\u30b6\u30fc\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002hdfs\u30e6\u30fc\u30b6\u30fc\u306b\u30b9\u30a4\u30c3\u30c1\u3057\u3066/user/root\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ docker exec -it amb1 bash\n$ hadoop fs -ls /user\nFound 4 items\ndrwxrwx---   - ambari-qa hdfs          0 2015-12-05 12:08 /user/ambari-qa\ndrwxr-xr-x   - hcat      hdfs          0 2015-12-05 12:09 /user/hcat\ndrwx------   - hive      hdfs          0 2015-12-05 12:09 /user/hive\ndrwxrwxr-x   - spark     hdfs          0 2015-12-05 12:08 /user/spark\n$ su hdfs \n$ hadoop fs -mkdir /user/root\n$ hadoop fs -chown root /user/root\n\n\n\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u518d\u8d77\u52d5\n\u3000\u7406\u7531\u306f\u3088\u304f\u308f\u304b\u308a\u307e\u305b\u3093\u304cmaster_1\u30b0\u30eb\u30fc\u30d7\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u518d\u8d77\u52d5\u3057\u306a\u3044\u3068Zeppelin\u306e\u5b9f\u884c\u306b\u5931\u6557\u3057\u3066\u3057\u307e\u3046\u3088\u3046\u3067\u3059\u3002\n\u3000Ambari\u306e\u7ba1\u7406\u753b\u9762\u3092\u30d1\u30d6\u30ea\u30c3\u30afIP\u30a2\u30c9\u30ec\u30b9\u304b\u3089\u30d6\u30e9\u30a6\u30b6\u3067\u958b\u304d\u307e\u3059\u3002\n\nHosts\u30e1\u30cb\u30e5\u30fc\u304b\u3089amb1.service.consul\u3092\u958b\u3044\u3066Restart All Components\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n\u3000\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u518d\u8d77\u52d5\u304c\u7d42\u4e86\u3059\u308b\u3068\u3088\u3046\u3084\u304fZeppelin\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u30029995\u30dd\u30fc\u30c8\u3092\u30d6\u30e9\u30a6\u30b6\u3067\u958b\u304d\u307e\u3059\u3002\n\n\n\u53c2\u8003\n\nData Science in the Cloud with Spark, Zeppelin, and Cloudbreak\nMulti-node Hadoop cluster on Docker\n\n## \u3053\u306e\u30b7\u30ea\u30fc\u30ba\n\n* [Apache Zeppelin\u3067\u30c7\u30fc\u30bf\u5206\u6790\u3092\u5206\u6563\u51e6\u7406\u3059\u308b - Part 1: \u30c7\u30fc\u30bf\u5206\u6790\u306e\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb](http://qiita.com/masato/items/b66930a2ab8d888df5ff)\n* [Apache Zeppelin\u3067\u30c7\u30fc\u30bf\u5206\u6790\u3092\u5206\u6563\u51e6\u7406\u3059\u308b - Part 2: Ambari on Docker\u306bZeppelin\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3059\u308b](http://qiita.com/masato/items/911e06fd31202181f0fd)\n* [Apache Zeppelin\u3067\u30c7\u30fc\u30bf\u5206\u6790\u3092\u5206\u6563\u51e6\u7406\u3059\u308b - Part 3: Zeppelin\u3067Hive\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b](http://qiita.com/masato/items/78a45cf9b6984552d4d9)\n* [Apache Zeppelin\u3067\u30c7\u30fc\u30bf\u5206\u6790\u3092\u5206\u6563\u51e6\u7406\u3059\u308b - Part 4: Ambari on Docker\u306eambari-functions\u3092\u4f7f\u3063\u3066\u307f\u308b](http://qiita.com/masato/items/b879b84486aeb7d3d6d8)\n\n\n## Ambari on Docker\n\u3000[Apache Ambari](https://ambari.apache.org/)\u3067Hadoop\u30af\u30e9\u30b9\u30bf\u3092Docker\u4e0a\u306b\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u3066\u307f\u307e\u3059\u3002Ambari\u306fHadoop\u7ba1\u7406\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3067\u3059\u3002\u30d6\u30e9\u30a6\u30b6\u306e\u7ba1\u7406\u753b\u9762\u304b\u3089Hadoop\u306e\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3084\u76e3\u8996\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u304c\u3001\u4eca\u56de\u306f[Ambari Shell](https://github.com/sequenceiq/ambari-shell)\u306eCLI\u304b\u3089[HDP](http://jp.hortonworks.com/hdp/)\u3092\u30af\u30e9\u30b9\u30bf\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u3000[SequenceIQ](http://sequenceiq.com/)\u304c\u516c\u958b\u3057\u3066\u3044\u308b[sequenceiq/ambari](https://hub.docker.com/r/sequenceiq/ambari/)\u306eDocker\u30a4\u30e1\u30fc\u30b8\u3092pull\u3057\u307e\u3059\u3002\u30ea\u30dd\u30b8\u30c8\u30ea\u306f[docker-ambari](https://github.com/sequenceiq/docker-ambari)\u3067\u3059\u3002\n\n```bash\n$ docker pull sequenceiq/ambari\n```\n\n\u3000[docker-ambari](https://github.com/sequenceiq/docker-ambari)\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002\n\n```bash\n$ git clone https://github.com/sequenceiq/docker-ambari\n$ cd docker-ambari\n$ source ambari-functions\n```\n\n\u3000[ambari-functions](https://github.com/sequenceiq/docker-ambari/blob/master/ambari-functions)\u306b\u306f`amb-*`\u95a2\u6570\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002Ambari on Docker\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u524d\u306b\u74b0\u5883\u5909\u6570\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n```bash\n$ amb-settings\n  NODE_PREFIX=amb\n  CLUSTER_SIZE=3\n  AMBARI_SERVER_NAME=amb-server\n  IMAGE=sequenceiq/ambari:2.1.2-v1\n  DOCKER_OPTS=\n  AMBARI_SERVER_IP=\n  CONSUL=amb-consul\n  CONSUL_IMAGE=sequenceiq/consul:v0.5.0-v6\n  DRY_RUN=false\n```\n\n\u3000Docker\u306b4\u30ce\u30fc\u30c9\u306e\u30af\u30e9\u30b9\u30bf\u3092\u69cb\u7bc9\u3057\u307e\u3059\u30024\u30ce\u30fc\u30c9\u306e\u3046\u30611\u30ce\u30fc\u30c9\u306fAmbari Server\u306b\u306a\u308a\u307e\u3059\u3002\u305d\u306e\u305f\u3081Hadoop\u30af\u30e9\u30b9\u30bf\u306f3\u30ce\u30fc\u30c9\u306e\u30b3\u30f3\u30c6\u30ca\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\u3002\n\n```bash\n$ amb-start-cluster 4\n```\n\n \u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3059\u308b\u3068`AMBARI_SERVER_IP`\u74b0\u5883\u5909\u6570\u306bAmbari Server\u30b3\u30f3\u30c6\u30ca\u306eIP\u30a2\u30c9\u30ec\u30b9\u304c\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u3002\n\n```bash\n$ amb-settings\n  NODE_PREFIX=amb\n  CLUSTER_SIZE=3\n  AMBARI_SERVER_NAME=amb-server\n  IMAGE=sequenceiq/ambari:2.1.2-v1\n  DOCKER_OPTS=\n  AMBARI_SERVER_IP=172.17.0.3\n  CONSUL=amb-consul\n  CONSUL_IMAGE=sequenceiq/consul:v0.5.0-v6\n  DRY_RUN=false\n```\n\n\u3000Ambari\u306e[REST API](https://github.com/apache/ambari/blob/trunk/ambari-server/docs/api/v1/index.md)\u3092curl\u30b3\u30de\u30f3\u30c9\u304b\u3089Ambari\u304c\u7ba1\u7406\u3057\u3066\u3044\u308b\u30db\u30b9\u30c8\u306e\u60c5\u5831\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n```bash\n$ curl -u admin:admin  http://$AMBARI_SERVER_IP:8080/api/v1/hosts\n{\n  \"href\" : \"http://172.17.0.3:8080/api/v1/hosts\",\n  \"items\" : [\n    {\n      \"href\" : \"http://172.17.0.3:8080/api/v1/hosts/amb1.service.consul\",\n      \"Hosts\" : {\n        \"host_name\" : \"amb1.service.consul\"\n      }\n    },\n    {\n      \"href\" : \"http://172.17.0.3:8080/api/v1/hosts/amb2.service.consul\",\n      \"Hosts\" : {\n        \"host_name\" : \"amb2.service.consul\"\n      }\n    },\n    {\n      \"href\" : \"http://172.17.0.3:8080/api/v1/hosts/amb3.service.consul\",\n      \"Hosts\" : {\n        \"host_name\" : \"amb3.service.consul\"\n      }\n    }\n  ]\n}\n```\n\n\u3000\u5225\u306e\u30b7\u30a7\u30eb\u304b\u3089\u5b9f\u884c\u3059\u308b\u306a\u3069`AMBARI_SERVER_IP`\u74b0\u5883\u5909\u6570\u304c\u8aad\u307f\u8fbc\u307e\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u624b\u52d5\u3067\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```bash\n$ AMBARI_SERVER_IP=$(docker inspect --format=\"{{ .NetworkSettings.IPAddress }}\" amb-server)\n```\n\n\n\n## Ambari Shell\n\n [Ambari Shell](https://github.com/sequenceiq/ambari-shell)\u306b\u3082[sequenceiq/ambari-shell](https://hub.docker.com/r/sequenceiq/ambari-shell/)Docker\u30a4\u30e1\u30fc\u30b8\u304c\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u30ea\u30dd\u30b8\u30c8\u30ea\u306f[docker-ambari-shell](https://github.com/sequenceiq/docker-ambari-shell)\u3067\u3059\u3002\u4eca\u56de\u306f[sequenceiq/ambari](https://hub.docker.com/r/sequenceiq/ambari/)\u306b\u5165\u3063\u3066\u3044\u308b[ambari-shell.sh](https://github.com/sequenceiq/docker-ambari/blob/master/ambari-server/ambari-shell.sh)\u304b\u3089Ambari Shell\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash\n$ docker run -it --rm \\\n  --link amb-server:ambariserver \\\n  --entrypoint /bin/sh \\\n  sequenceiq/ambari \\\n  ./ambari-shell.sh\n```\n\n\u3000Ambari Shell\u304c\u8d77\u52d5\u3057\u307e\u3057\u305f\u3002\n\n```bash\nAMBARI_HOST=172.17.0.3\n[DEBUG] waits for ambari server: 172.17.0.3 RUNNING ...\n\n[DEBUG] waits until 1 hosts connected to server ...\n[DEBUG] connected hosts: 3\n    _                _                   _  ____   _            _  _\n   / \\    _ __ ___  | |__    __ _  _ __ (_)/ ___| | |__    ___ | || |\n  / _ \\  | '_ ` _ \\ | '_ \\  / _` || '__|| |\\___ \\ | '_ \\  / _ \\| || |\n / ___ \\ | | | | | || |_) || (_| || |   | | ___) || | | ||  __/| || |\n/_/   \\_\\|_| |_| |_||_.__/  \\__,_||_|   |_||____/ |_| |_| \\___||_||_|\n\nWelcome to Ambari Shell. For command and param completion press TAB, for assistance type 'hint'.\nambari-shell>\n```\n\n### Blueprint\n\n [Blueprint](https://cwiki.apache.org/confluence/display/AMBARI/Blueprints)\u306fHadoop\u30af\u30e9\u30b9\u30bf\u3092JSON\u5f62\u5f0f\u3067\u5b9a\u7fa9\u3057\u307e\u3059\u3002Web\u753b\u9762\u306e\u30a6\u30a3\u30b6\u30fc\u30c9\u3092\u4f7f\u308f\u306a\u304f\u3066\u3082REST API\u3084Ambari Shell\u304b\u3089\u30af\u30e9\u30b9\u30bf\u306e\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\n### Cloudbreak\u306eBlueprint\n\n\u3000[SequenceIQ](http://sequenceiq.com/)\u306e[Cloudbreak](http://hortonworks.com/hadoop/cloudbreak/)[Blueprints](http://sequenceiq.com/cloudbreak-docs/latest/blueprints/)\u306b\u3044\u304f\u3064\u304bBlueprint\u306e\u4f8b\u304c\u63b2\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u3002Cloudbreak\u306fAmbari\u3092\u30d9\u30fc\u30b9\u306b\u3057\u305f\u30af\u30e9\u30a6\u30c9\u5411\u3051\u306eHadoop\u7ba1\u7406\u30c4\u30fc\u30eb\u3067\u3059\u3002Azure\u3001AWS\u3001GCP\u3001OpenStack\u306e\u30af\u30e9\u30a6\u30c9\u3068Docker\u306b\u3082\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8aad\u3080\u3068Ambari Blueprint\u3060\u3051\u3067\u3082\u4f7f\u3048\u305d\u3046\u3067\u3059\u3002\n\n\n### datascientist\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\n\u3000Cloudbreak\u306e[\u30ea\u30dd\u30b8\u30c8\u30ea](https://github.com/sequenceiq/cloudbreak/tree/master/core/src/main/resources/defaults/blueprints)\u304b\u3089[datascientist.bp](https://github.com/sequenceiq/cloudbreak/blob/master/core/src/main/resources/defaults/blueprints/datascientist.bp)\u304b\u3089\u3001Docker\u30b3\u30f3\u30c6\u30ca\u3067\u69cb\u6210\u3057\u305fAmbari\u30ce\u30fc\u30c9\u306bHDP\u30af\u30e9\u30b9\u30bf\u3092\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3057\u307e\u3059\u3002\n\n\u3000\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u767b\u9332\u3055\u308c\u3066\u3044\u308b`single-node-hdfs-yarn`\u3092\u9069\u7528\u3057\u305f\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u306e\u6d41\u308c\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```bash\nblueprint defaults\nblueprint list\ncluster build --blueprint single-node-hdfs-yarn\ncluster autoAssign\ncluster create\ntasks\n```\n\n\u3000\u5148\u307b\u3069\u8d77\u52d5\u3057\u305fAmbari Shell\u306e\u4e2d\u3067`datascientist`\u306eBlueprint\u306eURL\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n\n```bash\nambari-shell> blueprint add --url https://raw.githubusercontent.com/sequenceiq/cloudbreak/master/core/src/main/resources/defaults/blueprints/datascientist.bp\nBlueprint: 'datascientist' has been added\n```\n\n\u3000\u767b\u9332\u3057\u305f`datascientist`\u3092\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002Ambari\u30db\u30b9\u30c8\u306e\u60c5\u5831\u3068Blueprint\u306b\u3066\u7591\u7fa9\u3055\u308c\u305f\u30db\u30b9\u30c8\u30b0\u30eb\u30fc\u30d7\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n```bash\nambari-shell> cluster build --blueprint datascientist\n  HOSTNAME             STATE\n  -------------------  -------------------\n  amb3.service.consul  amb3.service.consul\n  amb1.service.consul  amb1.service.consul\n  amb2.service.consul  amb2.service.consul\n\n  HOSTGROUP  COMPONENT\n  ---------  ----------------------\n  client     TEZ_CLIENT\n  client     YARN_CLIENT\n  client     HIVE_CLIENT\n  client     HDFS_CLIENT\n  client     PIG\n  client     MAPREDUCE2_CLIENT\n  client     ZOOKEEPER_CLIENT\n  client     HCAT\n  client     METRICS_COLLECTOR\n  client     SPARK_CLIENT\n  client     METRICS_MONITOR\n  client     HBASE_CLIENT\n  slave_1    HBASE_REGIONSERVER\n  slave_1    NODEMANAGER\n  slave_1    DATANODE\n  slave_1    METRICS_MONITOR\n  master_1   RESOURCEMANAGER\n  master_1   JOURNALNODE\n  master_1   WEBHCAT_SERVER\n  master_1   MYSQL_SERVER\n  master_1   ZOOKEEPER_CLIENT\n  master_1   HISTORYSERVER\n  master_1   SECONDARY_NAMENODE\n  master_1   METRICS_MONITOR\n  master_1   NAMENODE\n  master_1   ZEPPELIN_MASTER\n  master_1   TEZ_CLIENT\n  master_1   YARN_CLIENT\n  master_1   MAPREDUCE2_CLIENT\n  master_1   HDFS_CLIENT\n  master_1   HIVE_SERVER\n  master_1   HBASE_MASTER\n  master_1   PIG\n  master_1   SPARK_JOBHISTORYSERVER\n  master_1   HIVE_METASTORE\n  master_1   ZOOKEEPER_SERVER\n  master_1   APP_TIMELINE_SERVER\n```\n\n\u3000`cluster autoAssign`\u3092\u5b9f\u884c\u3059\u308b\u3068\u30db\u30b9\u30c8\u30b0\u30eb\u30fc\u30d7\u306e\u5b9a\u7fa9\u306b\u5fdc\u3058\u3066\u81ea\u52d5\u7684\u306bAmbari\u30db\u30b9\u30c8\u304c\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u307e\u3059\u3002\u4eca\u56de\u306f3\u3064\u306e\u30db\u30b9\u30c8\u30b0\u30eb\u30fc\u30d7\u306b1\u3064\u305a\u3064\u624b\u52d5\u3067\u30db\u30b9\u30c8\u3092\u30a2\u30b5\u30a4\u30f3\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n```bash\nCLUSTER_BUILD:datascientist> cluster assign --hostGroup master_1 --host amb1.service.consul\namb1.service.consul has been added to master_1\nCLUSTER_BUILD:datascientist> cluster assign --hostGroup slave_1 --host amb2.service.consul\namb2.service.consul has been added to slave_1\nCLUSTER_BUILD:datascientist> cluster assign --hostGroup client --host amb3.service.consul\namb3.service.consul has been added to client\n```\n\n\u3000\u6700\u5f8c\u306b`cluster create`\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066HDP\u30af\u30e9\u30b9\u30bf\u306e\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\n```bash\nCLUSTER_BUILD:datascientist> cluster create --exitOnFinish true\n```\n\n\u3000`tasks`\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u5404\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u72b6\u6cc1\u304c\u308f\u304b\u308a\u307e\u3059\u3002\u307e\u305f\u30b7\u30a7\u30eb\u306e\u53f3\u4e0a\u306b\u5b8c\u4e86\u307e\u3067\u306e\u5168\u4f53\u306e\u30d1\u30fc\u30bb\u30f3\u30c8\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002IDCF\u30af\u30e9\u30a6\u30c9\u306e`standard.L16` (4 CPU x 2.4 GHz 16 GB RAM)\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u3067\u306f13\u5206\u307b\u3069\u304b\u304b\u308a\u307e\u3057\u305f\u3002\n\n\n## Consul\u3068Nginx\u306e\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\n\n\u3000Hadoop\u30af\u30e9\u30b9\u30bf\u306e\u30b5\u30fc\u30d3\u30b9\u30c7\u30a3\u30b9\u30ab\u30d0\u30ea\u306b\u306f[Consul](https://www.consul.io/)\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002Docker\u30a4\u30e1\u30fc\u30b8\u306f[sequenceiq/consul](https://hub.docker.com/r/sequenceiq/consul/)\u3001\u30ea\u30dd\u30b8\u30c8\u30ea\u306f[gliderlabs/docker-consul](https://github.com/gliderlabs/docker-consul)\u304b\u3089fork\u3057\u305f[sequenceiq/docker-consul](https://github.com/sequenceiq/docker-consul)\u3067\u3059\u3002\n \n\nps\u30b3\u30de\u30f3\u30c9\u3067\u30b3\u30f3\u30c6\u30ca\u306e\u30dd\u30fc\u30c8\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash\n$ docker ps\nCONTAINER ID        IMAGE                         COMMAND                  CREATED             STATUS              PORTS                                                              NAMES\nce146ebf73f1        sequenceiq/ambari:2.1.2-v1    \"/start-agent\"           12 minutes ago      Up 12 minutes       8080/tcp                                                           amb3\n9c23d449cb83        sequenceiq/ambari:2.1.2-v1    \"/start-agent\"           12 minutes ago      Up 12 minutes       8080/tcp                                                           amb2\n162662822eb1        sequenceiq/ambari:2.1.2-v1    \"/start-agent\"           12 minutes ago      Up 12 minutes       8080/tcp                                                           amb1\n6729936f59f8        sequenceiq/ambari:2.1.2-v1    \"/start-server\"          12 minutes ago      Up 12 minutes       8080/tcp                                                           amb-server\n02ee7f29a74e        sequenceiq/consul:v0.5.0-v6   \"/bin/start -server -\"   12 minutes ago      Up 12 minutes       53/tcp, 53/udp, 8300-8302/tcp, 8400/tcp, 8500/tcp, 8301-8302/udp   amb-consul\n```\n\n\u3000\u4e0a\u8a18\u306e\u3088\u3046\u306bDocker\u30b3\u30f3\u30c6\u30ca\u306e\u30dd\u30fc\u30c8\u306fDocker\u30db\u30b9\u30c8\u306b\u30de\u30c3\u30d7\u3057\u3066\u3044\u307e\u305b\u3093\u3002\u305d\u306e\u305f\u3081Docker\u30db\u30b9\u30c8\u304b\u3089\u3057\u304bDocker\u30b3\u30f3\u30c6\u30ca\u306eIP\u30a2\u30c9\u30ec\u30b9\u3078\u30a2\u30af\u30bb\u30b9\u304c\u3067\u304d\u307e\u305b\u3093\u3002\u4eca\u56de\u306e\u74b0\u5883\u306fIDCF\u30af\u30e9\u30a6\u30c9\u4e0a\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u306a\u306e\u3067\u3001\u30d1\u30d6\u30ea\u30c3\u30afIP\u30a2\u30c9\u30ec\u30b9\u304b\u3089Ambari\u3068Zeppelin\u306e\u7ba1\u7406\u753b\u9762\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306bNignx\u30b3\u30f3\u30c6\u30ca\u3067\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n\n### Consul\n\n\u3000Ambari Server\u306eREST API\u306eJSON\u3092\u898b\u3084\u3059\u304f\u3059\u308b\u305f\u3081\u306b[jq](https://stedolan.github.io/jq/)\u3092Docker\u30db\u30b9\u30c8\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```bash\n$ wget -P /usr/local/bin jq http://stedolan.github.io/jq/download/linux64/jq\n$ chmod u+x /usr/local/bin/jq\n$ which jq\n/usr/local/bin/jq\n```\n\n Consul\u30af\u30e9\u30b9\u30bf\u306e\u30ce\u30fc\u30c9\u3092\u8868\u793a\u3057\u3066\u307f\u307e\u3059\u3002\n\n```bash\n$ AMB_CONSUL=$(docker inspect --format=\"{{ .NetworkSettings.IPAddress }}\" amb-consul)\n$ echo $AMB_CONSUL\n172.17.0.2\n$ curl -s $AMB_CONSUL:8500/v1/catalog/nodes | jq .\n[\n  {\n    \"Node\": \"amb-consul.service.consul\",\n    \"Address\": \"172.17.0.2\"\n  },\n  {\n    \"Node\": \"amb-server\",\n    \"Address\": \"172.17.0.3\"\n  },\n  {\n    \"Node\": \"amb1\",\n    \"Address\": \"172.17.0.4\"\n  },\n  {\n    \"Node\": \"amb2\",\n    \"Address\": \"172.17.0.5\"\n  },\n  {\n    \"Node\": \"amb3\",\n    \"Address\": \"172.17.0.6\"\n  },\n  {\n    \"Node\": \"ambari-8080\",\n    \"Address\": \"172.17.0.3\"\n  }\n]\n```\n\n\u3000Consul\u306b\u767b\u9332\u3055\u308c\u305f\u30b5\u30fc\u30d3\u30b9\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\n```bash\n$ curl -s $AMB_CONSUL:8500/v1/catalog/services | jq .\n{\n  \"amb-server\": [],\n  \"amb1\": [],\n  \"amb2\": [],\n  \"amb3\": [],\n  \"ambari-8080\": [],\n  \"consul\": []\n}\n```\n\n\u3000amb-consul\u30b5\u30fc\u30d3\u30b9\u306e\u8a73\u7d30\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\n```bash\n$ curl -s $AMB_CONSUL:8500/v1/catalog/service/consul | jq .\n[\n  {\n    \"Node\": \"amb-consul.service.consul\",\n    \"Address\": \"172.17.0.2\",\n    \"ServiceID\": \"consul\",\n    \"ServiceName\": \"consul\",\n    \"ServiceTags\": [],\n    \"ServiceAddress\": \"\",\n    \"ServicePort\": 8300\n  }\n]\n```\n\n\u3000dig\u30b3\u30de\u30f3\u30c9\u3067Consul\u306eDNS\u30b5\u30fc\u30d3\u30b9\u3092\u898b\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\n\n```bash\n$ dig @$AMB_CONSUL -p 53 amb-consul.service.consul\n\n; <<>> DiG 9.9.5-9+deb8u3-Debian <<>> @172.17.0.2 -p 53 amb-consul.service.consul\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NXDOMAIN, id: 65241\n;; flags: qr aa rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 0\n\n;; QUESTION SECTION:\n;amb-consul.service.consul.     IN      A\n\n;; Query time: 1 msec\n;; SERVER: 172.17.0.2#53(172.17.0.2)\n;; WHEN: Sat Dec 05 21:47:03 JST 2015\n;; MSG SIZE  rcvd: 43\n```\n\n### Consul Tempate\u3068Nginx\n\n\u3000[Consul Template](https://github.com/hashicorp/consul-template)\u3092\u4f7f\u3044Docker\u30b3\u30f3\u30c6\u30ca\u306e\u60c5\u5831\u304b\u3089Nginx\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u751f\u6210\u3057\u307e\u3059\u3002[jlordiales/nginx-consul](https://hub.docker.com/r/jlordiales/nginx-consul/)\u306eDocker\u30a4\u30e1\u30fc\u30b8\u304c\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u4eca\u56de\u306fAmbari\u7528\u306b\u30ea\u30dd\u30b8\u30c8\u30ea\u3092[fork](https://github.com/masato/docker-nginx-consul)\u3057\u307e\u3057\u305f\u3002\n\n \u4ee5\u4e0b\u306e\u3088\u3046\u306a[Dockerfile](https://github.com/masato/docker-nginx-consul/blob/master/Dockerfile)\u304b\u3089Docker\u30a4\u30e1\u30fc\u30b8\u3092\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\n\n```bash\nFROM nginx:latest\n\nENV CONSUL_TEMPLATE_VERSION 0.11.0\nENV CONSUL_URL consul:8500\n\nADD start.sh /bin/start.sh\nRUN rm -v /etc/nginx/conf.d/*.conf\n\nADD https://github.com/hashicorp/consul-template/releases/download/v${CONSUL_TEMPLATE_VERSION}/consul_template_${CONSUL_TEMPLATE_VERSION}_linux_amd64.zip /tmp/consul-template.zip\n\nRUN apt-get update && apt-get install unzip -y && \\\n    unzip -j -d /usr/local/bin /tmp/consul-template.zip\n\nEXPOSE 8080 9995 9996\nVOLUME /templates\n\nCMD [\"/bin/start.sh\"]\nRUN apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n```\n\n Consul Template\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306f[service.ctmpl](https://github.com/masato/docker-nginx-consul/blob/master/service.ctmpl)\u3067\u3059\u30029995\u30689996\u306fZeppelin\u30b5\u30fc\u30d0\u30fc\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b`amb1`\u30ce\u30fc\u30c9\u306b\u30d7\u30ed\u30ad\u30b7\u30fc\u3057\u307e\u3059\u30029996\u30dd\u30fc\u30c8\u306fWebSocket\u7528\u306b\u30d8\u30c3\u30c0\u30fc\u3082\u8ffd\u52a0\u3057\u307e\u3059\u30028080\u30dd\u30fc\u30c8\u306fAmb Server\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b`amb-server`\u30ce\u30fc\u30c9\u306b\u30d7\u30ed\u30ad\u30b7\u30fc\u3057\u307e\u3059\u3002\n \n```bash\nserver {\n  listen 9995;\n \n  location / {\n    proxy_set_header   Host $host;\n    proxy_set_header   X-Real-IP $remote_addr;\n    proxy_set_header   X-Forwarded-Host $host;\n    proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header   X-Forwarded-Proto $scheme;\n    proxy_pass         http://{{with node \"amb1\"}}{{.Node.Address}}{{end}}:9995;\n  }\n}\n\nserver {\n  listen 9996;\n\n  location / {\n    proxy_set_header   Host $host;\n    proxy_set_header   X-Real-IP $remote_addr;\n    proxy_set_header   X-Forwarded-Host $host;\n    proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header   X-Forwarded-Proto $scheme;\n    proxy_pass         http://{{with node \"amb1\"}}{{.Node.Address}}{{end}}:9996;\n    proxy_http_version 1.1;\n    proxy_set_header   Upgrade $http_upgrade;\n    proxy_set_header   Connection \"upgrade\";\n    proxy_read_timeout 86400;\n  }\n}\n\nserver {\n  listen 8080;\n\n  location / {\n    proxy_set_header   Host $host;\n    proxy_set_header   X-Real-IP $remote_addr;\n    proxy_set_header   X-Forwarded-Host $host;\n    proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header   X-Forwarded-Proto $scheme;\n    proxy_pass         http://{{with node \"amb-server\"}}{{.Node.Address}}{{end}}:8080;\n  }\n}\n```\n\n\u3000fork\u3057\u305f\u30ea\u30dd\u30b8\u30c8\u30ea\u3092clone\u3057\u3066Docker\u30a4\u30e1\u30fc\u30b8\u3092\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\n\n```bash\n$ git clone https://github.com/masato/docker-nginx-consul.git\n$ cd docker-nginx-consul\n$ docker build -t nginx-consul .\n```\n\n\n\u3000`--dns`\u3068`--dns-search`\u30d5\u30e9\u30b0\u3092\u3064\u3051\u3066Nginx\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002`--dns`\u30d5\u30e9\u30b0\u306e\u9806\u756a\u306fDocker\u30db\u30b9\u30c8\u3001Google DNS\u306e\u524d\u306bConsul\u30b3\u30f3\u30c6\u30ca\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\u3068Nginx\u30b3\u30f3\u30c6\u30ca\u306e`/etc/resolv.conf`\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n```bash:/etc/resolv.conf\nsearch service.consul\nnameserver 172.17.0.2\nnameserver 172.17.0.1\nnameserver 8.8.8.8\n```\n\n\u3000Ambari Server\u306e\u7ba1\u7406\u753b\u9762\u3067\u4f7f\u30468080\u3001Zeppelin\u306eNotebook\u306b\u4f7f\u30469995\u30689996\u30dd\u30fc\u30c8\u3092Docker\u30db\u30b9\u30c8\u306b\u30de\u30c3\u30d7\u3057\u3066\u5916\u90e8\u304b\u3089\u63a5\u7d9a\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```bash\n$ AMB_CONSUL=$(docker inspect --format=\"{{.NetworkSettings.IPAddress}}\" amb-consul)\n$ echo $AMB_CONSUL\n172.17.0.2\n$ docker run \\\n  --name nginx \\\n  -d \\\n  -p 8080:8080 -p 9995:9995 -p 9996:9996 \\\n  --volume $PWD/service.ctmpl:/templates/service.ctmpl \\\n  --dns $AMB_CONSUL \\\n  --dns 172.17.0.1 \\\n  --dns 8.8.8.8 \\\n  --dns-search service.consul \\\n  nginx-consul\n```\n\n\u3000Nginx\u30b3\u30f3\u30c6\u30ca\u306b\u5165\u308a\u540d\u524d\u89e3\u6c7a\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash\n$ docker exec -it nginx bash\n$ echo $CONSUL_URL\nconsul:8500\n$ ping -c 1 amb1\nPING amb1.service.consul (172.17.0.4): 56 data bytes\n64 bytes from 172.17.0.4: icmp_seq=0 ttl=64 time=0.049 ms\n--- amb1.service.consul ping statistics ---\n1 packets transmitted, 1 packets received, 0% packet loss\nround-trip min/avg/max/stddev = 0.049/0.049/0.049/0.000 ms\n```\n\n\u3000\n\n\u3000\u6700\u5f8c\u306bps\u30b3\u30de\u30f3\u30c9\u3067\u4eca\u56de\u4f5c\u6210\u3057\u305fDocker\u30b3\u30f3\u30c6\u30ca\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash\n$ docker ps\nCONTAINER ID        IMAGE                         COMMAND                  CREATED             STATUS              PORTS                                                                       NAMES\n48df8cfdd49f        nginx-consul                  \"/bin/start.sh\"          29 minutes ago      Up 29 minutes       80/tcp, 0.0.0.0:8080->8080/tcp, 443/tcp, 0.0.0.0:9995-9996->9995-9996/tcp   nginx\nce146ebf73f1        sequenceiq/ambari:2.1.2-v1    \"/start-agent\"           2 hours ago         Up 2 hours          8080/tcp                                                                    amb3\n9c23d449cb83        sequenceiq/ambari:2.1.2-v1    \"/start-agent\"           2 hours ago         Up 2 hours          8080/tcp                                                                    amb2\n162662822eb1        sequenceiq/ambari:2.1.2-v1    \"/start-agent\"           2 hours ago         Up 2 hours          8080/tcp                                                                    amb1\n6729936f59f8        sequenceiq/ambari:2.1.2-v1    \"/start-server\"          2 hours ago         Up 2 hours          8080/tcp                                                                    amb-server\n02ee7f29a74e        sequenceiq/consul:v0.5.0-v6   \"/bin/start -server -\"   2 hours ago         Up 2 hours          53/tcp, 53/udp, 8300-8302/tcp, 8400/tcp, 8301-8302/udp, 8500/tcp            amb-consul\n```\n\n## HDFS\n\n\u3000Zeppelin\u306e\u5b9f\u884c\u3092\u3059\u308b\u524d\u306bHDFS\u306broot\u30e6\u30fc\u30b6\u30fc\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002`hdfs`\u30e6\u30fc\u30b6\u30fc\u306b\u30b9\u30a4\u30c3\u30c1\u3057\u3066`/user/root`\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash\n$ docker exec -it amb1 bash\n$ hadoop fs -ls /user\nFound 4 items\ndrwxrwx---   - ambari-qa hdfs          0 2015-12-05 12:08 /user/ambari-qa\ndrwxr-xr-x   - hcat      hdfs          0 2015-12-05 12:09 /user/hcat\ndrwx------   - hive      hdfs          0 2015-12-05 12:09 /user/hive\ndrwxrwxr-x   - spark     hdfs          0 2015-12-05 12:08 /user/spark\n$ su hdfs \n$ hadoop fs -mkdir /user/root\n$ hadoop fs -chown root /user/root\n```\n\n## \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u518d\u8d77\u52d5\n\n\u3000\u7406\u7531\u306f\u3088\u304f\u308f\u304b\u308a\u307e\u305b\u3093\u304c`master_1`\u30b0\u30eb\u30fc\u30d7\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u518d\u8d77\u52d5\u3057\u306a\u3044\u3068Zeppelin\u306e\u5b9f\u884c\u306b\u5931\u6557\u3057\u3066\u3057\u307e\u3046\u3088\u3046\u3067\u3059\u3002\n\n\n\u3000Ambari\u306e\u7ba1\u7406\u753b\u9762\u3092\u30d1\u30d6\u30ea\u30c3\u30afIP\u30a2\u30c9\u30ec\u30b9\u304b\u3089\u30d6\u30e9\u30a6\u30b6\u3067\u958b\u304d\u307e\u3059\u3002\n\n<img width=\"512\" alt=\"ambari-server.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/43745/ebdaba89-9a43-991d-5d54-4aebe57f8556.png\">\n\n Hosts\u30e1\u30cb\u30e5\u30fc\u304b\u3089`amb1.service.consul`\u3092\u958b\u3044\u3066`Restart All Components`\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n\n<img width=\"512\" alt=\"ambari-restart.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/43745/289a5598-a7ff-6910-9921-580d1f064d4f.png\">\n\n\n\u3000\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u518d\u8d77\u52d5\u304c\u7d42\u4e86\u3059\u308b\u3068\u3088\u3046\u3084\u304fZeppelin\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u30029995\u30dd\u30fc\u30c8\u3092\u30d6\u30e9\u30a6\u30b6\u3067\u958b\u304d\u307e\u3059\u3002\n\n<img width=\"1047\" alt=\"zeppelin-9995.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/43745/f46db625-e404-1605-3bd3-64a7cb252468.png\">\n\n\n\n\n\n\n\n## \u53c2\u8003\n\n* [Data Science in the Cloud with Spark, Zeppelin, and Cloudbreak](http://www.slideshare.net/Hadoop_Summit/data-science-in-the-cloud-with-spark-zeppelin-and-cloudbreak)\n* [Multi-node Hadoop cluster on Docker](http://blog.sequenceiq.com/blog/2014/06/19/multinode-hadoop-cluster-on-docker/)\n", "tags": ["Zeppelin0.5.0", "Ambari2.1.2", "consul0.5.0", "docker1.9.1", "AmbariShell1.6.0"]}