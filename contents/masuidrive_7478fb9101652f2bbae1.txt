{"tags": ["docker", "Rails", "docker-compose"], "context": "\n\nDocker\u4e0a\u306bRails\u306e\u958b\u767a\u74b0\u5883\u3092\u4f5c\u308b\n\u30ed\u30fc\u30ab\u30eb\u306b\u306fRails\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u305b\u305a\u306bDocker\u4e0a\u3060\u3051\u3067Rails\u306e\u958b\u767a\u74b0\u5883\u3092\u4f5c\u3063\u3066\u307f\u307e\u3059\u3002\n\nOne liner\n\u4e0b\u8a18\u306e\u4f5c\u696d\u306f\u3053\u306e\u30b3\u30de\u30f3\u30c9\u4e00\u767a\u3067\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002\ncurl https://gist.githubusercontent.com/masuidrive/3f8707336ffb286ad212/raw/45907996a8f0f17c02639a1f03b737b5c3580339/docker_rails.sh | RAILS_VERSION=5.0.0 RUBY_VERSION=2.3 sh\n\n\u3053\u308c\u3067\u4e0b\u8a18\u306b\u66f8\u304b\u308c\u305f\u4f5c\u696d\u304c\u4e00\u6c17\u306b\u884c\u308f\u308c\u307e\u3059\u3002\n\nrails new\n\u307e\u305a\u306frails new\u3067\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u308a\u307e\u3059\u3002\ndocker run --rm -v `pwd`:/usr/src/app rails:4.2.6 rails new /usr/src/app --database mysql --git --force\n\n\n\u958b\u767a\u7528docker-compose.yml\n\u6b21\u306b\u3053\u306eRails\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u52d5\u304b\u3059\u305f\u3081\u306eDockerfile\u3001docker-compose.yml\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u306fRails\u3068MySQL\u3092\u8d77\u52d5\u3055\u305b\u307e\u3059\u3002\n\n./Dockerfile\nFROM ruby:2.3\nENV LANG C.UTF-8\n\nRUN apt-get update && \\\n    apt-get install -y nodejs mysql-client --no-install-recommends && \\\n    rm -rf /var/lib/apt/lists/* && \\\n    mkdir -p /usr/src/app\nWORKDIR /usr/src/app\n\nCOPY Gemfile /usr/src/app/\nCOPY Gemfile.lock /usr/src/app/\nRUN bundle install\n\nCOPY . /usr/src/app\n\nEXPOSE 3000\nCMD [\"./bin/rails\", \"server\", \"-b\", \"0.0.0.0\"]\n\n\n./docker-compose.yml\nrails:\n  build: .\n  command:\n    [ \"bash\", \"-c\", \"rm -f tmp/pids/server.pid; ./bin/rails server -b 0.0.0.0\" ]\n  mem_limit: 384m\n  environment:\n    DISABLE_SPRING: \"1\"\n  ports:\n    - \"3000:3000\"\n  volumes:\n    - \".:/usr/src/app\"\n  links:\n    - \"mysql\"\n\nmysql:\n  image: mysql:5.6\n  environment:\n    MYSQL_ROOT_PASSWORD: \"passwd\"\n\ndocker-compose\u3067\u30d7\u30ed\u30bb\u30b9\u3092\u5f37\u5236\u7d42\u4e86\u3055\u305b\u308b\u3068pid\u30d5\u30a1\u30a4\u30eb\u304c\u6b8b\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u884c\u5100\u306f\u826f\u304f\u306a\u3044\u3051\u3069\u8d77\u52d5\u6642\u306b\u6d88\u3057\u3066\u3044\u307e\u3059\u3002\u958b\u767a\u7528\u306eyml\u3060\u3057\u826f\u3044\u304b\u306a\u3068\u3002\n\u3053\u306e\uff12\u3064\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u3063\u305f\u3089\u3001docker image\u3092build\u3057\u307e\u3059\u3002\ndocker-compose build\n\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u8a2d\u5b9a\n\u6b21\u306bmysql\u306e\u63a5\u7d9a\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002config/database.yml\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092passwd\u306b\u3057\u3066\u63a5\u7d9a\u5148\u3092mysql\u306b\u3057\u307e\u3059\u3002\n\u30a8\u30c7\u30a3\u30bf\u4f7f\u3046\u306e\u306f\u9762\u5012\u306a\u306e\u3067sed\u3092\u4f7f\u3044\u307e\u3059\u3002\nsed -i \"\" -e 's/password:$/password: \"passwd\"/;s/localhost/mysql/' config/database.yml\n\n\nDocker\u5411\u3051\u8a2d\u5b9a\n\u305d\u306e\u307e\u307e\u3060\u3068\u958b\u767a\u74b0\u5883\u3067web-console\u304c\u4f7f\u3048\u306a\u3044\u306e\u3067\u3001Docker\u3067Rails\u306e\u958b\u767a\u74b0\u5883\u3064\u304f\u3063\u305f\u3089web-console\u52d5\u304b\u306a\u3044\u3092\u53c2\u8003\u306bweb-console\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\nsed -i \"\" -e \"s|^end|  config.web_console.whitelisted_ips = %w( 0.0.0.0/0 ::/0 )\"\\\\$'\\n'\"end|\" config/environments/development.rb\n\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u4f5c\u6210\n\u3055\u3066docker-compose\u30b3\u30de\u30f3\u30c9\u3067Rails\u3068MySQL\u3092\u8d77\u52d5\u3057\u3066\u7a7a\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\ndocker-compose start\ndocker-compose run rails ./bin/rake db:create\ndocker-compose run rails ./bin/rake db:create RAILS_ENV=test\ndocker-compose stop\n\n\n\u8d77\u52d5\ndocker-machine ip\u3067IP\u30a2\u30c9\u30ec\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u3001docker-compose\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\ndocker-machine ip\ndocker-compose up\n\n\u78ba\u8a8d\u3057\u305fIP:3000\u3092\u30d6\u30e9\u30a6\u30b6\u3067\u958b\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n\n\u53c2\u8003\n\nhttps://github.com/docker-library/rails/blob/master/Dockerfile\nhttps://github.com/docker-library/rails/blob/master/onbuild/Dockerfile\n\n\n\u5ba3\u4f1d\n\u3088\u3051\u308c\u3070\u3001\u30c8\u30ec\u30bf\u30e1\u30f3\u30d0\u30fc\u306eQiita\u3082\u898b\u3066\u3044\u3063\u3066\u4e0b\u3055\u3044\u3002\n# Docker\u4e0a\u306bRails\u306e\u958b\u767a\u74b0\u5883\u3092\u4f5c\u308b\n\n\u30ed\u30fc\u30ab\u30eb\u306b\u306fRails\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u305b\u305a\u306bDocker\u4e0a\u3060\u3051\u3067Rails\u306e\u958b\u767a\u74b0\u5883\u3092\u4f5c\u3063\u3066\u307f\u307e\u3059\u3002\n\n## One liner\n\n\u4e0b\u8a18\u306e\u4f5c\u696d\u306f\u3053\u306e\u30b3\u30de\u30f3\u30c9\u4e00\u767a\u3067\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002\n\n```\ncurl https://gist.githubusercontent.com/masuidrive/3f8707336ffb286ad212/raw/45907996a8f0f17c02639a1f03b737b5c3580339/docker_rails.sh | RAILS_VERSION=5.0.0 RUBY_VERSION=2.3 sh\n```\n\n\u3053\u308c\u3067\u4e0b\u8a18\u306b\u66f8\u304b\u308c\u305f\u4f5c\u696d\u304c\u4e00\u6c17\u306b\u884c\u308f\u308c\u307e\u3059\u3002\n\n## rails new\n\n\u307e\u305a\u306f`rails new`\u3067\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n```\ndocker run --rm -v `pwd`:/usr/src/app rails:4.2.6 rails new /usr/src/app --database mysql --git --force\n```\n\n## \u958b\u767a\u7528docker-compose.yml\n\n\u6b21\u306b\u3053\u306eRails\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u52d5\u304b\u3059\u305f\u3081\u306eDockerfile\u3001docker-compose.yml\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u306fRails\u3068MySQL\u3092\u8d77\u52d5\u3055\u305b\u307e\u3059\u3002\n\n### ./Dockerfile\n```Dockerfile\nFROM ruby:2.3\nENV LANG C.UTF-8\n\nRUN apt-get update && \\\n    apt-get install -y nodejs mysql-client --no-install-recommends && \\\n    rm -rf /var/lib/apt/lists/* && \\\n    mkdir -p /usr/src/app\nWORKDIR /usr/src/app\n\nCOPY Gemfile /usr/src/app/\nCOPY Gemfile.lock /usr/src/app/\nRUN bundle install\n\nCOPY . /usr/src/app\n\nEXPOSE 3000\nCMD [\"./bin/rails\", \"server\", \"-b\", \"0.0.0.0\"]\n```\n\n### ./docker-compose.yml\n```yaml\nrails:\n  build: .\n  command:\n    [ \"bash\", \"-c\", \"rm -f tmp/pids/server.pid; ./bin/rails server -b 0.0.0.0\" ]\n  mem_limit: 384m\n  environment:\n    DISABLE_SPRING: \"1\"\n  ports:\n    - \"3000:3000\"\n  volumes:\n    - \".:/usr/src/app\"\n  links:\n    - \"mysql\"\n\nmysql:\n  image: mysql:5.6\n  environment:\n    MYSQL_ROOT_PASSWORD: \"passwd\"\n```\n\ndocker-compose\u3067\u30d7\u30ed\u30bb\u30b9\u3092\u5f37\u5236\u7d42\u4e86\u3055\u305b\u308b\u3068`pid\u30d5\u30a1\u30a4\u30eb`\u304c\u6b8b\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u884c\u5100\u306f\u826f\u304f\u306a\u3044\u3051\u3069\u8d77\u52d5\u6642\u306b\u6d88\u3057\u3066\u3044\u307e\u3059\u3002\u958b\u767a\u7528\u306eyml\u3060\u3057\u826f\u3044\u304b\u306a\u3068\u3002\n\n\u3053\u306e\uff12\u3064\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u3063\u305f\u3089\u3001docker image\u3092build\u3057\u307e\u3059\u3002\n\n```sh\ndocker-compose build\n```\n\n\n### \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u8a2d\u5b9a\n\n\u6b21\u306bmysql\u306e\u63a5\u7d9a\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002`config/database.yml`\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092`passwd`\u306b\u3057\u3066\u63a5\u7d9a\u5148\u3092`mysql`\u306b\u3057\u307e\u3059\u3002\n\n\u30a8\u30c7\u30a3\u30bf\u4f7f\u3046\u306e\u306f\u9762\u5012\u306a\u306e\u3067`sed`\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n```sh\nsed -i \"\" -e 's/password:$/password: \"passwd\"/;s/localhost/mysql/' config/database.yml\n```\n\n### Docker\u5411\u3051\u8a2d\u5b9a\n\n\u305d\u306e\u307e\u307e\u3060\u3068\u958b\u767a\u74b0\u5883\u3067web-console\u304c\u4f7f\u3048\u306a\u3044\u306e\u3067\u3001[Docker\u3067Rails\u306e\u958b\u767a\u74b0\u5883\u3064\u304f\u3063\u305f\u3089web-console\u52d5\u304b\u306a\u3044](http://qiita.com/kazukgw@github/items/5e08ce893b709e16e1e1)\u3092\u53c2\u8003\u306bweb-console\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```\nsed -i \"\" -e \"s|^end|  config.web_console.whitelisted_ips = %w( 0.0.0.0/0 ::/0 )\"\\\\$'\\n'\"end|\" config/environments/development.rb\n```\n\n### \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u4f5c\u6210\n\n\u3055\u3066`docker-compose`\u30b3\u30de\u30f3\u30c9\u3067Rails\u3068MySQL\u3092\u8d77\u52d5\u3057\u3066\u7a7a\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n```sh\ndocker-compose start\ndocker-compose run rails ./bin/rake db:create\ndocker-compose run rails ./bin/rake db:create RAILS_ENV=test\ndocker-compose stop\n```\n\n### \u8d77\u52d5\n\n`docker-machine ip`\u3067IP\u30a2\u30c9\u30ec\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u3001`docker-compose`\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```\ndocker-machine ip\ndocker-compose up\n```\n\n`\u78ba\u8a8d\u3057\u305fIP:3000`\u3092\u30d6\u30e9\u30a6\u30b6\u3067\u958b\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n<img width=\"786\" alt=\"Screen Shot 2016-03-23 at 11.56.54.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/4471/2484ee18-8479-b783-3e21-53e8e5baa5d0.png\">\n\n\n## \u53c2\u8003\n- https://github.com/docker-library/rails/blob/master/Dockerfile\n- https://github.com/docker-library/rails/blob/master/onbuild/Dockerfile\n\n## \u5ba3\u4f1d\n\n\u3088\u3051\u308c\u3070\u3001[\u30c8\u30ec\u30bf\u30e1\u30f3\u30d0\u30fc\u306eQiita](http://qiita.com/organizations/toreta)\u3082\u898b\u3066\u3044\u3063\u3066\u4e0b\u3055\u3044\u3002\n"}