{"context": " More than 1 year has passed since last update.RDS(PostgreSQL) \u3067\u5229\u7528\u3067\u304d\u308b copy \u30b3\u30de\u30f3\u30c9\u306f Not \"copy\" \u3067\u3042\u308b \"\\copy\" \u306b\u306a\u308b\u3002\n\u3053\u308c\u306f RDS \u3067\u306f\u7ba1\u7406\u8005\u6a29\u9650\u304c\u306a\u3044\u304b\u3089\u3067\u3042\u308b\u3002\n\u3053\u306e\u7ba1\u7406\u8005\u6a29\u9650\u304c\u306a\u3044\u3068\u3044\u3046\u72b6\u6cc1\u306f\u3001\u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u3067\u51fa\u6765\u3066\u3044\u305f\u3053\u3068\u304c\u3067\u304d\u306a\u304f\u306a\u308b\u306e\u3067\u3001\u4e8b\u524d\u306b\u78ba\u8a8d\u3059\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3059\u308b\u3002\n\u3053\u308c\u306f\u4f8b\u3048\u3070\u3001\u4e0a\u8a18\u306e copy \u30b3\u30de\u30f3\u30c9\u3084\u5171\u6709\u30ab\u30bf\u30ed\u30b0\u306b\u5bfe\u3059\u308b\u64cd\u4f5c\u304c\u3067\u304d\u306a\u3044(\u624b\u52d5\u3067 VACUUM \u306a\u3069\u304c\u5b9f\u884c\u3067\u304d\u306a\u3044\u306a\u3069)\u306a\u3069\u304c\u3042\u308b\u3002\n\u3000\nRDS(PostgreSQL) \u3067\u6ce8\u610f\u3059\u308b\u3053\u3068\n\n\u30fb\\copy \u30b3\u30de\u30f3\u30c9\u306f\u5229\u7528\u3067\u304d\u308b\n\u901a\u5e38\u306e copy \u30b3\u30de\u30f3\u30c9\u306f\u5229\u7528\u3067\u304d\u306a\u3044\u3002\ncopy * from stdin \u306f\u5229\u7528\u3067\u304d\u308b\u304c\u3001\u5927\u91cf\u30c7\u30fc\u30bf\u306e copy \u306b\u306f\u5411\u304b\u306a\u3044\u306e\u3067\u5229\u7528\u4fa1\u5024\u306f\u4f4e\u3044\u3002\nUsing COPY\nUsing the \\copy Command to Import Data to a Table on a PostgreSQL DB Instance\n--\n\u6ce8\u610f\u70b9\n\u5927\u91cf\u30c7\u30fc\u30bf\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u304b\u3089 psql-c \u3067 copy \u3059\u308b\u5834\u5408\u3001\u6b63\u5e38\u306b\u7d42\u4e86\u3057\u306a\u3044\u3053\u3068\u304c\u7a00\u306b\u3042\u308b\u3002\n\u3053\u308c\u306f\u30d7\u30ed\u30f3\u30d7\u30c8\u306e\u53cd\u5fdc\u304c\u7121\u304f\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u308a\u3001\"SSL error: sslv3 alert handshake failure\"\u3000\u3068\u8868\u793a\u3055\u308c\u3066\u63a5\u7d9a\u304c\u5207\u65ad\u3055\u308c\u308b\u3053\u3068\u304c\u539f\u56e0\u306e\u3088\u3046\u3002\n\u305f\u3060\u3057\u4e0a\u8a18\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u3053\u3068\u306f\u7a00\u3067\u3001\u4e3b\u306b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u753b\u9762\u304c\u56fa\u307e\u308b\u3053\u3068\u304c\u591a\u3044\u3002\n\u3053\u306e\u5834\u5408\u3001\"ssl_renegotiation_limit \" \u3092\u4f7f\u7528\u3057\u306a\u3044\u3053\u3068\u3067\u554f\u984c\u3092\u56de\u907f\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u5834\u5408\u304c\u3042\u308b\u3002\nssl_renegotiation_limit\n\u3053\u306e\u6a5f\u80fd\u306f\u540d\u524d\u306e\u901a\u308a\u3001\u3069\u308c\u3050\u3089\u3044\u3067\u65e2\u306b SSL \u3067\u63a5\u7d9a\u3055\u308c\u305f\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u518d\u30cd\u30b4\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u3059\u308b\u304b\u8a2d\u5b9a\u3059\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u3042\u308b\u3002\n\n\u30fbParameter Group \u306e effective_cache_size \u306e\u8a08\u7b97\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306f\u4ee5\u4e0b\u306e\u5185\u5bb9\u304c\u8a18\u8f09\u3057\u3066\u3042\u308b\u3002\nIf you set the memory settings too large for max_connections, shared_buffers, or effective_cache_size, you will prevent the PostgreSQL instance from starting up. Note that some parameters use units that you might not be familiar with; for example, shared_buffers sets the number of 8 KB shared memory buffers used by the server. \n\u308f\u304b\u308a\u96e3\u3044\u3002\nWorking with PostgreSQL Parameters\n\u5b9f\u969b\u306e\u8a08\u7b97\u5f0f\u306f\nMemory 15GB \u306e db.r3.large \u3067\u306f \neffective_cache_size\n{DBInstanceClassMemory/16384}\n1-2147483647 Allow Values\n(8kB) Sets the planners assumption about the size of the disk cache.\n15GB memory\n15000000000/16384 = 915527 *8 = 7324216 /  (1024 * 1024) =  \u7d047GB\n--\n\n\u30fbdblink \u306e\u4f7f\u7528\nPostgreSQL on Amazon RDS\n1.RDS \u3068\u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u306e DBLINK \u306b\u3088\u308b\u5229\u7528  \u2192\u3000\u53ef\u80fd\u306f\u305a(\u691c\u8a3c\u306f\u3057\u3066\u3044\u306a\u3044)\nRDS \u304b\u3089\u3001\u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u74b0\u5883\u306e DB \u30b5\u30fc\u30d0\u3078\u306f\u3001 \u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u74b0\u5883\u306e DB \u30b5\u30fc\u30d0\u306e IP \u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3002\n\u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u74b0\u5883\u304b\u3089\u3001RDS \u3078\u306f\u3001DNS \u540d\u3067\u63a5\u7d9a\u3092\u884c\u306a\u3046\u3002\uff08\u3053\u306e\u5834\u5408 DNS \u540d\u306f\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8 IP \u306b\u89e3\u6c7a\uff09\n2.EC2 \u4e0a PostgreSQL \u3068 RDS \u306e DBLINK \u306b\u3088\u308b\u5229\u7528  \u2192\u3000\u53ef\u80fd\n\u305f\u3060\u3057\u3001RDS \u304b\u3089 EC2(PostgreSQL)\u3078 dblink \u3092\u884c\u306a\u3046\u5834\u5408\u306f\u3001EC2(PostgreSQL) \u306e\u8a8d\u8a3c\u65b9\u5f0f\u306fMD5 \u3002\n\u30fbEC2 \u2192 RDS\nlocal ec2----.us-west-2.compute.amazonaws.com\nremote test22.c9s7xcs7qwj5.us-west-2.rds.amazonaws.com\ntest=> create extension dblink;\ntest=> select dblink_connect('conn1','host=test22.c9s7xcs7qwj5.us-west-2.rds.amazonaws.com port=5432 dbname=test user=test password=*****'); \ntest=> select * from dblink('conn1','select * from t_test') AS t(a int, b int);\n\n\n\na\nb\n\n\n\n\n1\n20\n\n\n2\n25\n\n\n\n(2 rows)\n\u30fbRDS \u2192 EC2\nlocal  test22.c9s7xcs7qwj5.us-west-2.rds.amazonaws.com\nremote ec2----.us-west-2.compute.amazonaws.com\nt_test=> create extension dblink;\nt_test=> select dblink_connect('conn2','host=ec2----.us-west-2.compute.amazonaws.com port=5432 dbname=t_test user=postgres password=*******'); \nt_test=> select * from dblink('conn2','select * from t_test') AS t(a int, b int);\n\n\n\na\nb\n\n\n\n\n1\n20\n\n\n2\n25\n\n\n\n(2 rows)\n*EC2\u5074\npg_hba.conf\nhost    all             all            0.0.0.0/0 \u3000\u2190\u9069\u6642VPC\u306esubnet\u3067        md5\n3.RDS \u540c\u58eb\u306e DBLINK \u306b\u3088\u308b\u5229\u7528\u3000\u2192\u3000\u53ef\u80fd\nlocal test0616.c9s7xcs7qwj5.us-west-2.rds.amazonaws.com  us-west-2a\nremote DB test22.c9s7xcs7qwj5.us-west-2.rds.amazonaws.com  us-west-2c\ntest=> create extension dblink;\ntest=> select dblink_connect('conn1','host=test23.c9s7xcs7qwj5.us-west-2.rds.amazonaws.com port=5432 dbname=test user=test password=****'); \ntest=> select * from dblink('conn1','select * from t_test') AS t(a int, b int);\n\n\n\na\nb\n\n\n\n\n1\n20\n\n\n2\n25\n\n\n\n(2 rows)\n--\n\u6ce8\u610f\u70b9\n\"dblink_connect_u\" \u306fNG\ntest=> select dblink_connect_u('conn1','host=test23.c9s7xcs7qwj5.us-west-2.rds.a\nmazonaws.com port=5432 dbname=test user=test password=******');\nERROR:  permission denied for function dblink_connect_u\n\u3053\u308c\u306f\u975e\u30b9\u30fc\u30d1\u30fc\u30e6\u30fc\u30b6\u3067\u306e\u300c\u30e6\u30fc\u30b6\uff0f\u30d1\u30b9\u300d\u7701\u7565\u306b\u3064\u3044\u3066\u306f\u3001 dblink_connect_u \u306e EXECUTE \u6a29\u9650\u304c\u306a\u3044\u304b\u3089\u3060\u3068\u601d\u308f\u308c\u308b\u3002\n\u5b9f\u969b\u306b\u78ba\u8a8d\ntest=>  SELECT proname,proacl FROM pg_proc WHERE proname = 'dblink_connect_u';\n     proname      |        proacl\n------------------+-----------------------\n dblink_connect_u | {rdsadmin=X/rdsadmin}\n dblink_connect_u | {rdsadmin=X/rdsadmin}\n\u78ba\u304b\u306b\u306a\u3044\n\u901a\u5e38\u306e\u53ef\u80fd\u306a\u3082\u306e\u3002\ntest=>  SELECT proname,proacl FROM pg_proc WHERE proname = 'dblink_connect';\n    proname     | proacl\n----------------+--------\n dblink_connect |\n dblink_connect |\n(2 rows)\ndblink_connect_u\n\u307e\u3042\u4ed6\u306b\u3082\u3042\u308b\u304c\u3001\u3042\u3068\u306f\u9069\u6642\u691c\u8a3c\u3067\u3002\nRDS(PostgreSQL) \u3067\u5229\u7528\u3067\u304d\u308b copy \u30b3\u30de\u30f3\u30c9\u306f Not \"copy\" \u3067\u3042\u308b \"\\copy\" \u306b\u306a\u308b\u3002\n\u3053\u308c\u306f RDS \u3067\u306f\u7ba1\u7406\u8005\u6a29\u9650\u304c\u306a\u3044\u304b\u3089\u3067\u3042\u308b\u3002\n\u3053\u306e\u7ba1\u7406\u8005\u6a29\u9650\u304c\u306a\u3044\u3068\u3044\u3046\u72b6\u6cc1\u306f\u3001\u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u3067\u51fa\u6765\u3066\u3044\u305f\u3053\u3068\u304c\u3067\u304d\u306a\u304f\u306a\u308b\u306e\u3067\u3001\u4e8b\u524d\u306b\u78ba\u8a8d\u3059\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3059\u308b\u3002\n\u3053\u308c\u306f\u4f8b\u3048\u3070\u3001\u4e0a\u8a18\u306e copy \u30b3\u30de\u30f3\u30c9\u3084\u5171\u6709\u30ab\u30bf\u30ed\u30b0\u306b\u5bfe\u3059\u308b\u64cd\u4f5c\u304c\u3067\u304d\u306a\u3044(\u624b\u52d5\u3067 VACUUM \u306a\u3069\u304c\u5b9f\u884c\u3067\u304d\u306a\u3044\u306a\u3069)\u306a\u3069\u304c\u3042\u308b\u3002\n\u3000\nRDS(PostgreSQL) \u3067\u6ce8\u610f\u3059\u308b\u3053\u3068\n\n\u30fb\\copy \u30b3\u30de\u30f3\u30c9\u306f\u5229\u7528\u3067\u304d\u308b\n--\n\u901a\u5e38\u306e copy \u30b3\u30de\u30f3\u30c9\u306f\u5229\u7528\u3067\u304d\u306a\u3044\u3002\ncopy * from stdin \u306f\u5229\u7528\u3067\u304d\u308b\u304c\u3001\u5927\u91cf\u30c7\u30fc\u30bf\u306e copy \u306b\u306f\u5411\u304b\u306a\u3044\u306e\u3067\u5229\u7528\u4fa1\u5024\u306f\u4f4e\u3044\u3002\n\n[Using COPY]\n(http://www.postgresql.org/docs/9.2/static/sql-copy.html)\n\n[Using the \\copy Command to Import Data to a Table on a PostgreSQL DB Instance](http://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/PostgreSQL.Procedural.Importing.html)\n\n--\n\n\u6ce8\u610f\u70b9\n\u5927\u91cf\u30c7\u30fc\u30bf\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u304b\u3089 psql-c \u3067 copy \u3059\u308b\u5834\u5408\u3001\u6b63\u5e38\u306b\u7d42\u4e86\u3057\u306a\u3044\u3053\u3068\u304c\u7a00\u306b\u3042\u308b\u3002\n\u3053\u308c\u306f\u30d7\u30ed\u30f3\u30d7\u30c8\u306e\u53cd\u5fdc\u304c\u7121\u304f\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u308a\u3001\"SSL error: sslv3 alert handshake failure\"\u3000\u3068\u8868\u793a\u3055\u308c\u3066\u63a5\u7d9a\u304c\u5207\u65ad\u3055\u308c\u308b\u3053\u3068\u304c\u539f\u56e0\u306e\u3088\u3046\u3002\n\u305f\u3060\u3057\u4e0a\u8a18\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u3053\u3068\u306f\u7a00\u3067\u3001\u4e3b\u306b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u753b\u9762\u304c\u56fa\u307e\u308b\u3053\u3068\u304c\u591a\u3044\u3002\n\u3053\u306e\u5834\u5408\u3001\"ssl_renegotiation_limit \" \u3092\u4f7f\u7528\u3057\u306a\u3044\u3053\u3068\u3067\u554f\u984c\u3092\u56de\u907f\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u5834\u5408\u304c\u3042\u308b\u3002\n\n[ssl_renegotiation_limit]\n(http://www.postgresql.org/docs/9.1/static/runtime-config-connection.html)\n\n\u3053\u306e\u6a5f\u80fd\u306f\u540d\u524d\u306e\u901a\u308a\u3001\u3069\u308c\u3050\u3089\u3044\u3067\u65e2\u306b SSL \u3067\u63a5\u7d9a\u3055\u308c\u305f\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u518d\u30cd\u30b4\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u3059\u308b\u304b\u8a2d\u5b9a\u3059\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u3042\u308b\u3002\n\n\u30fbParameter Group \u306e effective_cache_size \u306e\u8a08\u7b97\n--\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306f\u4ee5\u4e0b\u306e\u5185\u5bb9\u304c\u8a18\u8f09\u3057\u3066\u3042\u308b\u3002\n\nIf you set the memory settings too large for max_connections, shared_buffers, or effective_cache_size, you will prevent the PostgreSQL instance from starting up. Note that some parameters use units that you might not be familiar with; for example, shared_buffers sets the number of 8 KB shared memory buffers used by the server. \n\n\u308f\u304b\u308a\u96e3\u3044\u3002\n\n[Working with PostgreSQL Parameters]\n(http://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Appendix.PostgreSQL.CommonDBATasks.html)\n\n\u5b9f\u969b\u306e\u8a08\u7b97\u5f0f\u306f\n\nMemory 15GB \u306e db.r3.large \u3067\u306f \n\neffective_cache_size\n{DBInstanceClassMemory/16384}\n1-2147483647 Allow Values\n(8kB) Sets the planners assumption about the size of the disk cache.\n\n15GB memory\n15000000000/16384 = 915527 *8 = 7324216 /  (1024 * 1024) =  \u7d047GB\n\n--\n\n\n\u30fbdblink \u306e\u4f7f\u7528\n--\n\n[PostgreSQL on Amazon RDS]\n(http://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_PostgreSQL.html)\n\n1.RDS \u3068\u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u306e DBLINK \u306b\u3088\u308b\u5229\u7528  \u2192\u3000\u53ef\u80fd\u306f\u305a(\u691c\u8a3c\u306f\u3057\u3066\u3044\u306a\u3044)\nRDS \u304b\u3089\u3001\u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u74b0\u5883\u306e DB \u30b5\u30fc\u30d0\u3078\u306f\u3001 \u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u74b0\u5883\u306e DB \u30b5\u30fc\u30d0\u306e IP \u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3002\n\u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u74b0\u5883\u304b\u3089\u3001RDS \u3078\u306f\u3001DNS \u540d\u3067\u63a5\u7d9a\u3092\u884c\u306a\u3046\u3002\uff08\u3053\u306e\u5834\u5408 DNS \u540d\u306f\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8 IP \u306b\u89e3\u6c7a\uff09\n\n\n2.EC2 \u4e0a PostgreSQL \u3068 RDS \u306e DBLINK \u306b\u3088\u308b\u5229\u7528  \u2192\u3000\u53ef\u80fd\n\u305f\u3060\u3057\u3001RDS \u304b\u3089 EC2(PostgreSQL)\u3078 dblink \u3092\u884c\u306a\u3046\u5834\u5408\u306f\u3001EC2(PostgreSQL) \u306e\u8a8d\u8a3c\u65b9\u5f0f\u306f_MD5_ \u3002\n\n\u30fbEC2 \u2192 RDS\nlocal ec2-**-**-**-**.us-west-2.compute.amazonaws.com\nremote test22.c9s7xcs7qwj5.us-west-2.rds.amazonaws.com\n\ntest=> create extension dblink;\ntest=> select dblink_connect('conn1','host=test22.c9s7xcs7qwj5.us-west-2.rds.amazonaws.com port=5432 dbname=test user=test password=*****'); \n\ntest=> select * from dblink('conn1','select * from t_test') AS t(a int, b int);\n\n a | b\n---+----\n 1 | 20\n 2 | 25\n(2 rows)\n\n\u30fbRDS \u2192 EC2\nlocal  test22.c9s7xcs7qwj5.us-west-2.rds.amazonaws.com\nremote ec2-**-**-**-**.us-west-2.compute.amazonaws.com\n\nt_test=> create extension dblink;\nt_test=> select dblink_connect('conn2','host=ec2-**-**-**-**.us-west-2.compute.amazonaws.com port=5432 dbname=t_test user=postgres password=*******'); \nt_test=> select * from dblink('conn2','select * from t_test') AS t(a int, b int);\n\n a | b\n---+----\n 1 | 20\n 2 | 25\n(2 rows)\n\n\n*EC2\u5074\npg_hba.conf\nhost    all             all            0.0.0.0/0 \u3000\u2190\u9069\u6642VPC\u306esubnet\u3067\t\tmd5\n\n3.RDS \u540c\u58eb\u306e DBLINK \u306b\u3088\u308b\u5229\u7528\u3000\u2192\u3000\u53ef\u80fd\n\nlocal test0616.c9s7xcs7qwj5.us-west-2.rds.amazonaws.com  us-west-2a\nremote DB test22.c9s7xcs7qwj5.us-west-2.rds.amazonaws.com  us-west-2c\n\ntest=> create extension dblink;\ntest=> select dblink_connect('conn1','host=test23.c9s7xcs7qwj5.us-west-2.rds.amazonaws.com port=5432 dbname=test user=test password=****'); \ntest=> select * from dblink('conn1','select * from t_test') AS t(a int, b int);\n\n a | b\n---+----\n 1 | 20\n 2 | 25\n(2 rows)\n\n--\n\n\u6ce8\u610f\u70b9\n\"dblink_connect_u\" \u306f_NG_\n\ntest=> select dblink_connect_u('conn1','host=test23.c9s7xcs7qwj5.us-west-2.rds.a\nmazonaws.com port=5432 dbname=test user=test password=******');\nERROR:  permission denied for function dblink_connect_u\n\n\u3053\u308c\u306f\u975e\u30b9\u30fc\u30d1\u30fc\u30e6\u30fc\u30b6\u3067\u306e\u300c\u30e6\u30fc\u30b6\uff0f\u30d1\u30b9\u300d\u7701\u7565\u306b\u3064\u3044\u3066\u306f\u3001 dblink_connect_u \u306e EXECUTE \u6a29\u9650\u304c\u306a\u3044\u304b\u3089\u3060\u3068\u601d\u308f\u308c\u308b\u3002\n\n\u5b9f\u969b\u306b\u78ba\u8a8d\ntest=>  SELECT proname,proacl FROM pg_proc WHERE proname = 'dblink_connect_u';\n     proname      |        proacl\n------------------+-----------------------\n dblink_connect_u | {rdsadmin=X/rdsadmin}\n dblink_connect_u | {rdsadmin=X/rdsadmin}\n \n\u78ba\u304b\u306b\u306a\u3044\n\n\u901a\u5e38\u306e\u53ef\u80fd\u306a\u3082\u306e\u3002\ntest=>  SELECT proname,proacl FROM pg_proc WHERE proname = 'dblink_connect';\n    proname     | proacl\n----------------+--------\n dblink_connect |\n dblink_connect |\n(2 rows)\n\n[dblink_connect_u]\n(http://www.postgresql.jp/document/8.4/html/contrib-dblink-connect-u.html)\n\n\n\u307e\u3042\u4ed6\u306b\u3082\u3042\u308b\u304c\u3001\u3042\u3068\u306f\u9069\u6642\u691c\u8a3c\u3067\u3002\n", "tags": ["AWS", "RDS", "PostgreSQL"]}