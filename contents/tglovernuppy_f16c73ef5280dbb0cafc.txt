{"context": "Ubuntu MAAS/Juju 2.0 \u3067 OpenStack Mitaka \u69cb\u7bc9 (\u305d\u306e1) \u306e\u7d9a\u304d\u306e\u899a\u3048\u66f8\u304d.\n\n1. OpenStack CLI \u64cd\u4f5c\u30b3\u30de\u30f3\u30c9\u306e\u5c0e\u5165\nMAAS \u3092\u52d5\u304b\u3057\u3066\u3044\u308b controller \u30ce\u30fc\u30c9\u4e0a\u3067 OpenStack \u3092\u64cd\u4f5c\u3067\u304d\u308b\u3088\u3046\uff0cCLI \u64cd\u4f5c\u30c4\u30fc\u30eb\u3092\u5c0e\u5165\u3059\u308b.\n$ sudo apt install python-novaclient python-keystoneclient python-glanceclient python-neutronclient\n\n\u524d\u56de\u306e\u8a18\u4e8b\u306e3.2\u7bc0\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f openstack-base \u306e Juju-charm \u306b\u540c\u5c01\u3055\u308c\u305f\u74b0\u5883\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u3046.\n$ source novarc\n$ keystone catalog\n\n\n2. Glance \u3078\u306e OS \u30a4\u30e1\u30fc\u30b8\u306e\u8ffd\u52a0\nUbuntu trusty (14.04) \u304a\u3088\u3073 xenial (16.04) \u306e\u30a4\u30e1\u30fc\u30b8\u3092 OpenStack \u306b\u53d6\u308a\u8fbc\u3080.\n$ mkdir ~/images\n$ wget -O ~/images/trusty-server-cloudimg-amd64-disk1.img \\\n    http://cloud-images.ubuntu.com/trusty/current/trusty-server-cloudimg-amd64-disk1.img\n$ wget -O ~/images/xenial-server-cloudimg-amd64-disk1.img \\\n    http://cloud-images.ubuntu.com/xenial/current/xenial-server-cloudimg-amd64-disk1.img\n$ glance image-create --name=\"trusty\" --visibility public --progress \\\n    --container-format=bare --disk-format=qcow2 \\\n    < ~/images/trusty-server-cloudimg-amd64-disk1.img\n$ glance image-create --name=\"xenial\" --visibility public --progress \\\n    --container-format=bare --disk-format=qcow2 \\\n    < ~/images/xenial-server-cloudimg-amd64-disk1.img\n\n\n3. \u30d5\u30ec\u30fc\u30d0\u30fc\u306e\u8ffd\u52a0\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30d5\u30ec\u30fc\u30d0\u30fc\u304c\u4f5c\u3089\u308c\u306a\u304b\u3063\u305f\u306e\u3067\u624b\u52d5\u3067\u4f5c\u6210\u3059\u308b.\n$ nova flavor-create m1.tiny 1 512 1 1\n$ nova flavor-create m1.small 2 2048 20 1\n$ nova flavor-create m1.medium 3 4096 40 2\n$ nova flavor-create m1.large 4 8192 80 4\n$ nova flavor-create m1.xlarge 5 16384 160 8\n\n\n4. \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u6709\u52b9\u5316\nJuju GUI \u3088\u308a nova-cloud-controller \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\u3092\u958b\u304d\uff0c\u8d64\u67a0\u3067\u56f2\u3063\u305f\u7b87\u6240\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b.\n\n\n\n\u9805\u76ee\n\u8a2d\u5b9a\u5024\n\n\n\n\nconsole-access-protocol\nnovnc\n\n\nconsole-proxy-ip\n(controller \u30ce\u30fc\u30c9\u306e Public IP)\n\n\n\n\n\u305d\u306e\u5f8c\uff0c \"Save changes\" \u3092\u3057\u3066 \"Commit changes\" \u3092\u884c\u3046.\n\u6700\u5f8c\u306b iptables \u3067 controller \u30ce\u30fc\u30c9\u304b\u3089 nova-cloud-controller (10.1.0.15) \u3078\u306e\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u884c\u3046.\n$ sudo iptables -t nat -A PREROUTING -p tcp -m tcp --dport 6080 -j DNAT --to-destination 10.1.0.15:6080\n$ sudo iptables-save -c > iptables.rules && sudo mv iptables.rules /etc/iptables.rules\n\n\u4ee5\u5f8c OpenStack \u4e0a\u3067\u4f5c\u6210\u3055\u308c\u305f nova \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f vnc \u30a2\u30af\u30bb\u30b9\u304c\u53ef\u80fd\u3068\u306a\u308b.\n\n5. \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4f5c\u6210\n\u524d\u56de\u306e\u8a18\u4e8b\u306e3.2\u7bc0\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f openstack-base \u306e Juju-charm \u306b\u540c\u5c01\u3055\u308c\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u3046.\n\u5916\u90e8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af ext_net (133.68.xxx.0/24) \u3068 admin \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u7528\u3044\u308b\u5185\u90e8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af admin_net (10.5.5.0/24) \u3092\u4f5c\u6210\u3059\u308b.\n$ ./neutron-ext-net -g 133.68.xxx.1 -c 133.68.xxx.0/24 -f 133.68.xxx.2:133.68.xxx.254 ext_net\n$ ./neutron-tenant-net -t admin -r provider-router admin_net 10.5.5.0/24\n\n\u3053\u308c\u3067\u4e00\u901a\u308a\u306e\u69cb\u7bc9\u4f5c\u696d\u306f\u5b8c\u4e86.\n\n\u53c2\u8003\u6587\u732e\n\u30fbopenstack base | Juju\n\u30fbnova cloud controller | Juju\n\u30fbgnuoy: OpenStack Guest Console Access with Juju\n[Ubuntu MAAS/Juju 2.0 \u3067 OpenStack Mitaka \u69cb\u7bc9 (\u305d\u306e1)](http://qiita.com/tglovernuppy/items/f85f2ee8594493370109) \u306e\u7d9a\u304d\u306e\u899a\u3048\u66f8\u304d.\n\n## 1. OpenStack CLI \u64cd\u4f5c\u30b3\u30de\u30f3\u30c9\u306e\u5c0e\u5165\nMAAS \u3092\u52d5\u304b\u3057\u3066\u3044\u308b controller \u30ce\u30fc\u30c9\u4e0a\u3067 OpenStack \u3092\u64cd\u4f5c\u3067\u304d\u308b\u3088\u3046\uff0cCLI \u64cd\u4f5c\u30c4\u30fc\u30eb\u3092\u5c0e\u5165\u3059\u308b.\n\n```\n$ sudo apt install python-novaclient python-keystoneclient python-glanceclient python-neutronclient\n```\n\n[\u524d\u56de\u306e\u8a18\u4e8b\u306e3.2\u7bc0\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f](http://qiita.com/tglovernuppy/items/f85f2ee8594493370109) openstack-base \u306e Juju-charm \u306b\u540c\u5c01\u3055\u308c\u305f\u74b0\u5883\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u3046.\n\n```\n$ source novarc\n$ keystone catalog\n```\n\n## 2. Glance \u3078\u306e OS \u30a4\u30e1\u30fc\u30b8\u306e\u8ffd\u52a0\n\nUbuntu trusty (14.04) \u304a\u3088\u3073 xenial (16.04) \u306e\u30a4\u30e1\u30fc\u30b8\u3092 OpenStack \u306b\u53d6\u308a\u8fbc\u3080.\n\n```\n$ mkdir ~/images\n$ wget -O ~/images/trusty-server-cloudimg-amd64-disk1.img \\\n\thttp://cloud-images.ubuntu.com/trusty/current/trusty-server-cloudimg-amd64-disk1.img\n$ wget -O ~/images/xenial-server-cloudimg-amd64-disk1.img \\\n\thttp://cloud-images.ubuntu.com/xenial/current/xenial-server-cloudimg-amd64-disk1.img\n$ glance image-create --name=\"trusty\" --visibility public --progress \\\n    --container-format=bare --disk-format=qcow2 \\\n    < ~/images/trusty-server-cloudimg-amd64-disk1.img\n$ glance image-create --name=\"xenial\" --visibility public --progress \\\n    --container-format=bare --disk-format=qcow2 \\\n    < ~/images/xenial-server-cloudimg-amd64-disk1.img\n```\n\n## 3. \u30d5\u30ec\u30fc\u30d0\u30fc\u306e\u8ffd\u52a0\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30d5\u30ec\u30fc\u30d0\u30fc\u304c\u4f5c\u3089\u308c\u306a\u304b\u3063\u305f\u306e\u3067\u624b\u52d5\u3067\u4f5c\u6210\u3059\u308b.\n\n```\n$ nova flavor-create m1.tiny 1 512 1 1\n$ nova flavor-create m1.small 2 2048 20 1\n$ nova flavor-create m1.medium 3 4096 40 2\n$ nova flavor-create m1.large 4 8192 80 4\n$ nova flavor-create m1.xlarge 5 16384 160 8\n```\n\n## 4. \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u6709\u52b9\u5316\n\nJuju GUI \u3088\u308a `nova-cloud-controller` \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\u3092\u958b\u304d\uff0c\u8d64\u67a0\u3067\u56f2\u3063\u305f\u7b87\u6240\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b.\n\n|\u9805\u76ee|\u8a2d\u5b9a\u5024|\n|---|---|\n|console-access-protocol|novnc|\n|console-proxy-ip|(controller \u30ce\u30fc\u30c9\u306e Public IP)|\n\n![enable-novnc.png](https://qiita-image-store.s3.amazonaws.com/0/38708/58af5a07-8377-7dba-2188-a3a731312105.png)\n\n\n\u305d\u306e\u5f8c\uff0c \"Save changes\" \u3092\u3057\u3066 \"Commit changes\" \u3092\u884c\u3046.\n\n\u6700\u5f8c\u306b `iptables` \u3067 controller \u30ce\u30fc\u30c9\u304b\u3089 nova-cloud-controller (10.1.0.15) \u3078\u306e\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u884c\u3046.\n\n```\n$ sudo iptables -t nat -A PREROUTING -p tcp -m tcp --dport 6080 -j DNAT --to-destination 10.1.0.15:6080\n$ sudo iptables-save -c > iptables.rules && sudo mv iptables.rules /etc/iptables.rules\n```\n\n\u4ee5\u5f8c OpenStack \u4e0a\u3067\u4f5c\u6210\u3055\u308c\u305f nova \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f vnc \u30a2\u30af\u30bb\u30b9\u304c\u53ef\u80fd\u3068\u306a\u308b.\n\n## 5. \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4f5c\u6210\n\n[\u524d\u56de\u306e\u8a18\u4e8b\u306e3.2\u7bc0\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f](http://qiita.com/tglovernuppy/items/f85f2ee8594493370109) openstack-base \u306e Juju-charm \u306b\u540c\u5c01\u3055\u308c\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u3046.\n\n\u5916\u90e8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af `ext_net` (133.68.xxx.0/24) \u3068 admin \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u7528\u3044\u308b\u5185\u90e8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af `admin_net` (10.5.5.0/24) \u3092\u4f5c\u6210\u3059\u308b.\n\n```\n$ ./neutron-ext-net -g 133.68.xxx.1 -c 133.68.xxx.0/24 -f 133.68.xxx.2:133.68.xxx.254 ext_net\n$ ./neutron-tenant-net -t admin -r provider-router admin_net 10.5.5.0/24\n```\n\n\u3053\u308c\u3067\u4e00\u901a\u308a\u306e\u69cb\u7bc9\u4f5c\u696d\u306f\u5b8c\u4e86.\n\n\n## \u53c2\u8003\u6587\u732e\n\u30fb[openstack base | Juju](https://jujucharms.com/openstack-base/)\n\u30fb[nova cloud controller | Juju](https://jujucharms.com/nova-cloud-controller/)\n\u30fb[gnuoy: OpenStack Guest Console Access with Juju](http://blog.gnuoy.eu/2014/09/openstack-guest-console-access-with-juju.html)\n", "tags": ["MAAS", "Juju", "openstack", "Ubuntu", "Cloud"]}