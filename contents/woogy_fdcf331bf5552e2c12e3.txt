{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u6d88\u8cbb\u30ab\u30ed\u30ea\u30fc\u3084\u5fc3\u62cd\u6570\u3092\u96c6\u8a08\u3059\u308b\u4ed5\u7d44\u307f\u3092\u4f5c\u308a\u305f\u3044\u3002\u3068\u3044\u3046\u3053\u3068\u3067\nFitbit\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3066Web\u30a2\u30d7\u30ea\u304b\u3089\u4f7f\u7528\u3059\u308b\u305f\u3081\u306e\u6e96\u5099\u3092\u884c\u3046\u3002\n\nDeveloper\u767b\u9332\nFitbit API \u3092https://dev.fitbit.com/jp \u304b\u3089\u3001Developer\u767b\u9332\u3092\u884c\u3046\u3002\n\n\u30a2\u30d7\u30ea\u3092\u767b\u9332\n\u5fc5\u8981\u4e8b\u9805\u3092\u8a18\u8f09\u3057\u3066\u3001\u767b\u9332\u3059\u308b\u3002callback URL\u306f\u3001\u5b9f\u969b\u306eCallback\u5148\u3067\u306a\u3044\u3068\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u6642\u306b\u8e74\u3089\u308c\u308b\u306e\u3067\u6ce8\u610f\nhttp://localhost:3000/auth/fitbit_oauth2/callback\n\u306e\u3088\u3046\u306b\u767b\u9332\u3057\u305f\n\nsinatra\u306e\u6e96\u5099\n\u7701\u7565\n\nGemfile\u4f5c\u6210\nbundle init\n\u3057\u3066\u3001\u3072\u306a\u5f62\u3092\u4f5c\u3063\u305f\u5f8c\ngem 'sinatra'\ngem 'omniauth'\ngem 'omniauth-oauth2'\ngem 'omniauth-fitbit-oauth2'\ngem 'multi_json'\ngem 'rest-client'\n\n\u3092\u8ffd\u52a0\u3002OAuth\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u3057\u3066omniauth\u3092\u4f7f\u3046\u3002\u4fbf\u5229\u3002\nbundle install\n\u3092\u5b9f\u884c\n\n\u30a2\u30d7\u30ea\u4f5c\u6210\n\u3053\u3093\u306a\u611f\u3058\nrequire 'rubygems'\nrequire 'bundler'\nBundler.require\n\nclass HRMonitorApp < Sinatra::Base\n  configure do\n    use OmniAuth::Builder do\n      provider :fitbit_oauth2, '#{OAuth 2.0 Client ID}','#{Client (Consumer) Secret}',\n      scope: 'profile',\n      expires_in: '2592000'\n    end\n    enable :sessions\n    enable :inline_templates\n    set :bind, '0.0.0.0'\n    set :port, 3000\n  end\n\n  helpers do\n    def get_profile\n      res = JSON.parse RestClient.get \"https://api.fitbit.com/1/user/-/profile.json\", Authorization: \"Bearer #{session[:token]}\"\n      warn \"#{res}\"\n      \"<body><h1><code>#{res}</code></h1></body>\"\n    rescue => e\n      warn e\n    end\n  end\n\n  get '/' do\n    if session[:token]\n      get_profile\n    else\n      redirect to '/auth/fitbit_oauth2'\n    end\n  end\n\n  get '/auth/fitbit_oauth2/callback' do\n    session[:token] = env['omniauth.auth']['credentials'].token\n    redirect to '/'\n  end\nend\n\nHRMonitorApp.run!\n\n\n\u306f\u307e\u3063\u305f\u30dd\u30a4\u30f3\u30c8\n\nconfigure\u30d6\u30ed\u30c3\u30af\u3067\u3001enable :sessions\u3092\u3084\u3089\u306a\u3044\u3068\u3001\u30bb\u30c3\u30b7\u30e7\u30f3\u304c\u306a\u3044\u3068OmniAuth\u306b\u6012\u3089\u308c\u308b\n\nHRMonitor.App.run! run\u306b\u3057\u3066\u305f\u3002\nOmniAuth\u3092\u4f7f\u3046\u5834\u5408\u3001\u8a8d\u8a3c\u7528\u306eURL\u306f\u56fa\u5b9a\u3002omniauth-*(\u4eca\u56de\u306fomniauth-fitbit-oauth2)\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b:name\u3092\u4f7f\u3063\u305f /auth/:name \u304c\u8a8d\u8a3c\u7528\u306eURL\u3068\u306a\u308b\u3002 \n\nhttps://github.com/codebender/omniauth-fitbit-oauth2/tree/master/lib/omniauth/strategies/fitbit_oauth2.rb\n\u3060\u3068\u3001:name => fitbit_oauth2 \u306a\u306e\u3067 /auth/fitbit_oauth2 \u306b\u98db\u3070\u3059\u5fc5\u8981\u304c\u3042\u308b\u3002\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u306f\u3053\u308c\u306b/callback\u3092\u3064\u3051\u305f\u3082\u306e\u3002\u306a\u306e\u3067\u3001\u7d50\u5c40\u30a2\u30d7\u30ea\u767b\u9332\u3059\u308b\u969b\u306b\u6307\u5b9a\u3059\u308b\u3079\u304d\u30b3\u30fc\u30eb\u30d0\u30c3\u30afURL\u306f\u81ea\u52d5\u7684\u306b\u6c7a\u307e\u308b\u3002\n\u30b9\u30b3\u30fc\u30d7\u306f https://dev.fitbit.com/docs/oauth2/#scope \u3092\u53c2\u7167\n\n\n\u4eca\u5f8c\u306e\u4e88\u5b9a\n\u5fc3\u62cd\u6570\u304c\u4e00\u5b9a\u4ee5\u4e0a\u306b\u306a\u3063\u3066\u3044\u308b\u6642\u9593\u3092\u5217\u6319\u3057\u305f\u308a\u3001\u7761\u7720\u6642\u9593\u3092\u7ba1\u7406\u3057\u305f\u308a\n# \u306f\u3058\u3081\u306b\n\u6d88\u8cbb\u30ab\u30ed\u30ea\u30fc\u3084\u5fc3\u62cd\u6570\u3092\u96c6\u8a08\u3059\u308b\u4ed5\u7d44\u307f\u3092\u4f5c\u308a\u305f\u3044\u3002\u3068\u3044\u3046\u3053\u3068\u3067\n[Fitbit](https://www.fitbit.com/)\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3066Web\u30a2\u30d7\u30ea\u304b\u3089\u4f7f\u7528\u3059\u308b\u305f\u3081\u306e\u6e96\u5099\u3092\u884c\u3046\u3002\n\n# Developer\u767b\u9332\nFitbit API \u3092https://dev.fitbit.com/jp \u304b\u3089\u3001Developer\u767b\u9332\u3092\u884c\u3046\u3002\n\n# \u30a2\u30d7\u30ea\u3092\u767b\u9332\n\u5fc5\u8981\u4e8b\u9805\u3092\u8a18\u8f09\u3057\u3066\u3001\u767b\u9332\u3059\u308b\u3002callback URL\u306f\u3001\u5b9f\u969b\u306eCallback\u5148\u3067\u306a\u3044\u3068\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u6642\u306b\u8e74\u3089\u308c\u308b\u306e\u3067\u6ce8\u610f\n`http://localhost:3000/auth/fitbit_oauth2/callback`\n\u306e\u3088\u3046\u306b\u767b\u9332\u3057\u305f\n\n# sinatra\u306e\u6e96\u5099\n\u7701\u7565\n\n# Gemfile\u4f5c\u6210\n`bundle init`\n\u3057\u3066\u3001\u3072\u306a\u5f62\u3092\u4f5c\u3063\u305f\u5f8c\n\n```\ngem 'sinatra'\ngem 'omniauth'\ngem 'omniauth-oauth2'\ngem 'omniauth-fitbit-oauth2'\ngem 'multi_json'\ngem 'rest-client'\n```\n\u3092\u8ffd\u52a0\u3002OAuth\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u3057\u3066omniauth\u3092\u4f7f\u3046\u3002\u4fbf\u5229\u3002\n`bundle install`\n\u3092\u5b9f\u884c\n\n# \u30a2\u30d7\u30ea\u4f5c\u6210\n\u3053\u3093\u306a\u611f\u3058\n\n```rb\nrequire 'rubygems'\nrequire 'bundler'\nBundler.require\n\nclass HRMonitorApp < Sinatra::Base\n  configure do\n    use OmniAuth::Builder do\n      provider :fitbit_oauth2, '#{OAuth 2.0 Client ID}','#{Client (Consumer) Secret}',\n      scope: 'profile',\n      expires_in: '2592000'\n    end\n    enable :sessions\n    enable :inline_templates\n    set :bind, '0.0.0.0'\n    set :port, 3000\n  end\n  \n  helpers do\n    def get_profile\n      res = JSON.parse RestClient.get \"https://api.fitbit.com/1/user/-/profile.json\", Authorization: \"Bearer #{session[:token]}\"\n      warn \"#{res}\"\n      \"<body><h1><code>#{res}</code></h1></body>\"\n    rescue => e\n      warn e\n    end\n  end\n  \n  get '/' do\n    if session[:token]\n      get_profile\n    else\n      redirect to '/auth/fitbit_oauth2'\n    end\n  end\n  \n  get '/auth/fitbit_oauth2/callback' do\n    session[:token] = env['omniauth.auth']['credentials'].token\n    redirect to '/'\n  end\nend\n\nHRMonitorApp.run!\n```\n## \u306f\u307e\u3063\u305f\u30dd\u30a4\u30f3\u30c8\n\n1. configure\u30d6\u30ed\u30c3\u30af\u3067\u3001`enable :sessions`\u3092\u3084\u3089\u306a\u3044\u3068\u3001\u30bb\u30c3\u30b7\u30e7\u30f3\u304c\u306a\u3044\u3068OmniAuth\u306b\u6012\u3089\u308c\u308b\n2. `HRMonitor.App.run!` run\u306b\u3057\u3066\u305f\u3002\n3. OmniAuth\u3092\u4f7f\u3046\u5834\u5408\u3001\u8a8d\u8a3c\u7528\u306eURL\u306f\u56fa\u5b9a\u3002omniauth-*(\u4eca\u56de\u306fomniauth-fitbit-oauth2)\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b:name\u3092\u4f7f\u3063\u305f /auth/:name \u304c\u8a8d\u8a3c\u7528\u306eURL\u3068\u306a\u308b\u3002 \n- https://github.com/codebender/omniauth-fitbit-oauth2/tree/master/lib/omniauth/strategies/fitbit_oauth2.rb\n\u3060\u3068\u3001:name => fitbit_oauth2 \u306a\u306e\u3067 /auth/fitbit_oauth2 \u306b\u98db\u3070\u3059\u5fc5\u8981\u304c\u3042\u308b\u3002\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u306f\u3053\u308c\u306b/callback\u3092\u3064\u3051\u305f\u3082\u306e\u3002\u306a\u306e\u3067\u3001\u7d50\u5c40\u30a2\u30d7\u30ea\u767b\u9332\u3059\u308b\u969b\u306b\u6307\u5b9a\u3059\u308b\u3079\u304d\u30b3\u30fc\u30eb\u30d0\u30c3\u30afURL\u306f\u81ea\u52d5\u7684\u306b\u6c7a\u307e\u308b\u3002\n4. \u30b9\u30b3\u30fc\u30d7\u306f https://dev.fitbit.com/docs/oauth2/#scope \u3092\u53c2\u7167\n\n# \u4eca\u5f8c\u306e\u4e88\u5b9a\n\u5fc3\u62cd\u6570\u304c\u4e00\u5b9a\u4ee5\u4e0a\u306b\u306a\u3063\u3066\u3044\u308b\u6642\u9593\u3092\u5217\u6319\u3057\u305f\u308a\u3001\u7761\u7720\u6642\u9593\u3092\u7ba1\u7406\u3057\u305f\u308a\n", "tags": ["Sinatra", "Ruby"]}