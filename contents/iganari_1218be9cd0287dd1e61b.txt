{"context": "\n\n\u69cb\u6210\n\npart 1\n\nMac\u4e0a\u306eVB\u306bCoreOS\u3092\u5165\u308c\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\nprat 2\n\nCoreOS\u306e\u57fa\u672c\u8a2d\u5b9a\u3068docker\u306e\u57fa\u672c\u8a2d\u5b9a\u3092\u3059\u308b\u3002 --> \u3053\u306e\u8a18\u4e8b\n\npart 3\n\nalpine\u30d9\u30fc\u30b9\u306edocker\u3092\u697d\u3057\u3080\u3002\n\nCoreOS\u306e\u8a2d\u5b9a\u3067\u3042\u308b\u3001cloud-config.yml\u3092\u4f5c\u3063\u3066\u3044\u304f\n\u4ed6\u306e\u8a18\u4e8b\u3092\u898b\u3066\u4e0b\u3055\u3044!!!\n\n\u6700\u7d42\u7684\u306aconfig\n\n\u307e\u305a\u306fcloud-config.yml\u3092HOME\u306b\u7f6e\u304f\n\n\ncloud-config.yml\n#cloud-config\n\nhostname: coreos-host01\n\ncoreos:\n  update:\n    reboot-strategy: best-effort\n  etcd:\n    discovery: https://discovery.etcd.io/{HASH}\n    addr: 192.168.59.101:4001\n    peer-addr: 192.168.59.101:7001\n    bind-addr: 0.0.0.0\n  fleet:\n    public_ip: 192.168.59.101\n  units:\n    - name: etcd.service\n      command: start\n    - name: fleet.service\n      command: start\n    - name: docker.service\n      command: start\n    - name: timezone.service\n      command: start\n      content: |\n        [Unit]\n        Description=timezone\n        [Service]\n        Type=oneshot\n        RemainAfterExit=yes\n        ExecStart=/usr/bin/ln -sf ../usr/share/zoneinfo/Japan /etc/localtime\n    - name: 10-static.network\n      runtime: no\n      content: |\n        [Match]\n        Name=eth0\n\n        [Network]\n        Address=192.168.59.101/24\n        Gateway=192.168.59.1\n        DNS=8.8.8.8\n        DNS=8.8.4.4\n\nusers:\n  - name: coreuser\n    passwd: `openssl passwd -1`\u3067\u751f\u6210\u3057\u305f\u30d1\u30b9\u30ef\u30fc\u30c9\n    groups:\n      - sudo\n      - docker\n    ssh-authorized-keys:\n      - ssh-rsa ***\u3067\u8a18\u3055\u305b\u308b\u516c\u958b\u9375\n\n\n\ncloud-config\u306e\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u30c1\u30a7\u30c3\u30af\n\n# coreos-cloudinit -validate=true -from-file=./cloud-config.yml\n\n\n\u521d\u56de\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\n\u30b3\u30de\u30f3\u30c9\u4e2d\u306estable\u306f\u81ea\u5206\u304c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u30d0\u30fc\u30b8\u30e7\u30f3{Stable | Beta | Alpha}\u306b\u3088\u3063\u3066\u66f8\u304d\u76f4\u3059\n\n\n\n\n$ sudo coreos-install -d /dev/sda -C stable -c ./cloud-config.yml\n\u2026\n\u5272\u611b\n\u2026\ngpg: key 93D2DCB4 marked as ultimately trusted\ngpg: checking the trustdb\ngpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model\ngpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u\ngpg: Good signature from \"CoreOS Buildbot (Offical Builds) <buildbot@coreos.com>\" [ultimate]\nInstalling cloud-config...\nSuccess! CoreOS stable 835.13.0 is installed on /dev/sda\n\n\n\u3053\u3053\u307e\u3067\u6765\u305f\u3089\u3001\u4e00\u65e6VM\u3092\u843d\u3068\u3059\n\n$ sudo shutdown -h now\n\n\nVM\u306eStorage\u304b\u3089CoreOS\u3092\u629c\u304f\n\n\n\n\u305d\u306e\u5f8c\u3001\u8d77\u52d5\u3002\n\n\nVN\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u5165\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\n\n\n\n\n\nMAC\u306eCLI\u304b\u3089\u3001\u9375\u3067ssh\u51fa\u6765\u308b\u3053\u3068\u3082\u78ba\u8a8d\u3002\n\n$ ssh -i id_rsa-try-docker coreuser@192.168.59.100 -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null\nWarning: Permanently added '192.168.59.100' (ED25519) to the list of known hosts.\nLast login: Tue May 17 17:44:23 2016\nCoreOS stable (835.13.0)\ncoreuser@coreos-host01 ~ $\n\n\n\u5148\u307b\u3069\u306ecloud-config.yml\u306f\u4ee5\u4e0b\u306b\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\n\n\nPATH\n/var/lib/coreos-install/user_data\n\n\n\n\u6700\u5f8c\u306ecoreos\u306eupdate\u3092\u3057\u3066\u304a\u304f\n\n$ sudo update_engine_client -update\n\n\n\u53c2\u8003\u8cc7\u6599\n\u3010CoreOS\u3011cloud-config\u89e3\u8aac\u301c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nDocker\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u304f\n\n\u73fe\u72b6\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d(2016/05/17)\n\n$ docker -v                   \nDocker version 1.9.1, build 9894698\n\n### \u69cb\u6210\n+ [part 1](Mac\u306eVB\u4e0a\u3067CoreOS\u3092\u30db\u30b9\u30c8\u306b\u4f7f\u3044\u3001alpine\u30d9\u30fc\u30b9\u306edocker\u74b0\u5883\u3092\u4f5c\u308b part 1)\n\nMac\u4e0a\u306eVB\u306bCoreOS\u3092\u5165\u308c\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\n+ prat 2\n\nCoreOS\u306e\u57fa\u672c\u8a2d\u5b9a\u3068docker\u306e\u57fa\u672c\u8a2d\u5b9a\u3092\u3059\u308b\u3002 --> \u3053\u306e\u8a18\u4e8b\n\n+ part 3\n\nalpine\u30d9\u30fc\u30b9\u306edocker\u3092\u697d\u3057\u3080\u3002\n\n# CoreOS\u306e\u8a2d\u5b9a\u3067\u3042\u308b\u3001cloud-config.yml\u3092\u4f5c\u3063\u3066\u3044\u304f\n\n\u4ed6\u306e\u8a18\u4e8b\u3092\u898b\u3066\u4e0b\u3055\u3044!!!\n\n### \u6700\u7d42\u7684\u306aconfig\n\n+ \u307e\u305a\u306fcloud-config.yml\u3092HOME\u306b\u7f6e\u304f\n\n```text:cloud-config.yml \n#cloud-config\n\nhostname: coreos-host01\n\ncoreos:\n  update:\n    reboot-strategy: best-effort\n  etcd:\n    discovery: https://discovery.etcd.io/{HASH}\n    addr: 192.168.59.101:4001\n    peer-addr: 192.168.59.101:7001\n    bind-addr: 0.0.0.0\n  fleet:\n    public_ip: 192.168.59.101\n  units:\n    - name: etcd.service\n      command: start\n    - name: fleet.service\n      command: start\n    - name: docker.service\n      command: start\n    - name: timezone.service\n      command: start\n      content: |\n        [Unit]\n        Description=timezone\n        [Service]\n        Type=oneshot\n        RemainAfterExit=yes\n        ExecStart=/usr/bin/ln -sf ../usr/share/zoneinfo/Japan /etc/localtime\n    - name: 10-static.network\n      runtime: no\n      content: |\n        [Match]\n        Name=eth0\n\n        [Network]\n        Address=192.168.59.101/24\n        Gateway=192.168.59.1\n        DNS=8.8.8.8\n        DNS=8.8.4.4\n\nusers:\n  - name: coreuser\n    passwd: `openssl passwd -1`\u3067\u751f\u6210\u3057\u305f\u30d1\u30b9\u30ef\u30fc\u30c9\n    groups:\n      - sudo\n      - docker\n    ssh-authorized-keys:\n      - ssh-rsa ***\u3067\u8a18\u3055\u305b\u308b\u516c\u958b\u9375\n```\n\n\n+ cloud-config\u306e\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u30c1\u30a7\u30c3\u30af\n\n```\n# coreos-cloudinit -validate=true -from-file=./cloud-config.yml\n```\n\n+ \u521d\u56de\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n    + \u30b3\u30de\u30f3\u30c9\u4e2d\u306estable\u306f\u81ea\u5206\u304c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u30d0\u30fc\u30b8\u30e7\u30f3{Stable | Beta | Alpha}\u306b\u3088\u3063\u3066\u66f8\u304d\u76f4\u3059  \n\n```\n$ sudo coreos-install -d /dev/sda -C stable -c ./cloud-config.yml\n\u2026\n\u5272\u611b\n\u2026\ngpg: key 93D2DCB4 marked as ultimately trusted\ngpg: checking the trustdb\ngpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model\ngpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u\ngpg: Good signature from \"CoreOS Buildbot (Offical Builds) <buildbot@coreos.com>\" [ultimate]\nInstalling cloud-config...\nSuccess! CoreOS stable 835.13.0 is installed on /dev/sda\n```\n\n+ \u3053\u3053\u307e\u3067\u6765\u305f\u3089\u3001\u4e00\u65e6VM\u3092\u843d\u3068\u3059\n\n```\n$ sudo shutdown -h now\n```\n\n+ VM\u306eStorage\u304b\u3089CoreOS\u3092\u629c\u304f\n\n![Screen Shot 2016-05-17 at 17.42.01.png](https://qiita-image-store.s3.amazonaws.com/0/25582/f82ea19c-d02e-fd67-a6cd-ad98d634fae7.png)\n\n+ \u305d\u306e\u5f8c\u3001\u8d77\u52d5\u3002\n    + VN\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u5165\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\n\n![Screen Shot 2016-05-17 at 17.44.42.png](https://qiita-image-store.s3.amazonaws.com/0/25582/a2d8e4c3-74e4-3c53-3f7c-1d190bfcd2c4.png)\n\n\n+ MAC\u306eCLI\u304b\u3089\u3001\u9375\u3067ssh\u51fa\u6765\u308b\u3053\u3068\u3082\u78ba\u8a8d\u3002\n\n```\n$ ssh -i id_rsa-try-docker coreuser@192.168.59.100 -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null\nWarning: Permanently added '192.168.59.100' (ED25519) to the list of known hosts.\nLast login: Tue May 17 17:44:23 2016\nCoreOS stable (835.13.0)\ncoreuser@coreos-host01 ~ $\n```\n\n+ \u5148\u307b\u3069\u306ecloud-config.yml\u306f\u4ee5\u4e0b\u306b\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\n\n```text:PATH\n/var/lib/coreos-install/user_data\n```\n\n+ \u6700\u5f8c\u306ecoreos\u306eupdate\u3092\u3057\u3066\u304a\u304f\n\n```\n$ sudo update_engine_client -update\n```\n\n### \u53c2\u8003\u8cc7\u6599\n\n[\u3010CoreOS\u3011cloud-config\u89e3\u8aac\u301c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb](http://qiita.com/xshsaku/items/1ba3f930ff80bef685a6)\n\n# Docker\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u304f\n\n+ \u73fe\u72b6\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d(2016/05/17)\n\n```\n$ docker -v                   \nDocker version 1.9.1, build 9894698\n```\n", "tags": ["alpine", "CoreOS", "vagrant"]}