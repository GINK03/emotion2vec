{"context": " More than 1 year has passed since last update.\n\n\u7528\u9014\n\u30b5\u30a4\u30c8\u5168\u4f53\u306ePV\u3092\u81ea\u52d5\u3067\u629c\u3044\u3066\u304f\u308b\u3050\u3089\u3044\u306a\u3089\u3001\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u306e\u30a2\u30c9\u30aa\u30f3\u3067GA\u306e\u3084\u3064\u3044\u308c\u308c\u3070\u826f\u3044\u3093\u3067\u3059\u304c\u3001\n\uff08\u53c2\u7167\uff1ahttp://bnbrd.net/automation-by-google-analytics-and-spreadsheet/\uff09\n\u500b\u5225\u306eURL\u306e\u3082\u306e\u3092\u53d6\u3063\u3066\u304f\u308b\u3060\u3068\u304b\u3001\u30a4\u30d9\u30f3\u30c8\u30e9\u30d9\u30eb\u306e\u3082\u306e\u3092\u3068\u3063\u3066\u304f\u308b\u3060\u3068\u304b\u306f\u3001\u3044\u3061\u3044\u3061\u66f8\u3044\u3066\u308b\u3068Report Configuration\u304c\u3081\u3063\u3061\u3083\u4e71\u96d1\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u4e00\u62ec\u3067\u3068\u3063\u3066\u304d\u3061\u3083\u3044\u307e\u3057\u3087\u3046\u3002\n\n\u5b8c\u6210\u30a4\u30e1\u30fc\u30b8\n\u3053\u306e\u30ea\u30b9\u30c8\u306b\u8a18\u4e8b\u306e\u76f8\u5bfe\u30d1\u30b9\uff08GA\u304c\u76f8\u5bfe\u30d1\u30b9\u3067\u898b\u3066\u308b\u306e\u3067\uff09\u3092\u66f8\u3044\u3066\u3042\u3052\u308b\u3068\n\n\u3053\u3046\u306a\u3063\u3066\u307b\u3057\u3044\uff01\n\n\n\u4f5c\u308a\u65b9\n\nAnalytics API\u3092\u6709\u52b9\u306b\u3057\u3066\u3042\u3052\u308b\n\n\n\n\u753b\u50cf\u306e\u9806\u306b\u305f\u3069\u3063\u3066\u3044\u3063\u305f\u5148\u3067\u3001AnalyticsAPI\u3092\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\n\n\u30b3\u30fc\u30c9\n\nanalytics.gs\nfunction analytics() {\n  var PROFILE_ID = \"ga:hoge\"; // GA\u306eID\n  var END_DATE_OFFSET = 1; // \u4f55\u65e5\u524d\u307e\u3067\u306e\u30c7\u30fc\u30bf\u3068\u3063\u3066\u304f\u308b\u304b\n  var SHEET_URL = \"https://docs.google.com/spreadsheets/d/hogehoge\"; // \u5bfe\u8c61\u306e\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u306eURL\n  var SHEET_ID = \"0\"; // \u5bfe\u8c61\u306e\u30b7\u30fc\u30c8\u306eid\uff08\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u306e\u672b\u5c3e\u306b\u3064\u3044\u3066\u308b\u3084\u3064\uff09\n\n  var spreadsheet = SpreadsheetApp.getActiveSpreadsheet();\n  var dsheet = spreadsheet.getSheetByName(\"hoge\"); // URL\u3092\u66f8\u304d\u8fbc\u3080\u307b\u3046\u306e\u30b7\u30fc\u30c8\u540d\n  var nsheet = spreadsheet.getSheetByName(\"hoge\"); // PV\u3092\u66f8\u304d\u51fa\u3059\u307b\u3046\u306e\u30b7\u30fc\u30c8\u540d\n\n  var startrow = 2;\n  var startcol = 1;\n  var lastrow = dsheet.getLastRow();\n  var lastcol = 1;\n\n  var metrics = \"ga:pageviews\";\n  var today = new Date();\n  var yesterday = new Date(today.getTime() - 24 * 60 * 60 * 1000);\n  var startDate =  \"2015-11-01\"; // \u3044\u3064\u306e\u65e5\u304b\u3089\u306e\u6570\u5024\u53d6\u3063\u3066\u304f\u308b\u304b\n  var endDate = Utilities.formatDate(yesterday, Session.getTimeZone(), 'yyyy-MM-dd');\n\n  var sheetdata = dsheet.getSheetValues(startrow, startcol, lastrow-1, lastcol);\n\n  for ( var i in sheetdata ) {\n    if ( sheetdata[i][0] == \"\" ) break;   \n    var fil = \"ga:pagePath=~\" + sheetdata[i][0];\n    var optArgs = {\n      'dimensions': 'ga:date',\n      'filters': fil,\n    };\n\n    var ga = Analytics.Data.Ga.get(PROFILE_ID, startDate, endDate, metrics, optArgs).rows;\n    var header = [\"\u65e5\u4ed8\", sheetdata[i][0]]; // \u5f8c\u304b\u3089\u4ed8\u3051\u3066\u3082\u3044\u3044\n    ga.unshift(header);\n\n    for ( var j in ga ) {\n      ga[j].reverse().pop();\n    }     \n    var trans_ga = transpose(ga); // \u884c\u5217\u5909\u63db\n\n    nsheet.getRange(2+Number(i), 1, 1, ga.length).setValues(trans_ga);\n  }\n}\n\n// \u884c\u5217\u3092\u5909\u63db\u3057\u3066\u308b\uff08\u6a2a\u5411\u304d\u306b\u6570\u5024\u3092\u51fa\u3057\u3066\u307b\u3057\u3044\u3089\u3057\u3044\u306e\u3067\uff09\nfunction transpose(a) {\n  return Object.keys(a[0]).map(function (c) {\n    return a.map(function (r) {\n      return r[c];\n    });\n  });\n}\n\n\n\n\u30c8\u30ea\u30ac\u30fc\u306e\u30bb\u30c3\u30c8\n\u4f55\u3092\u3057\u305f\u3068\u304d\u306b\u3001\u3053\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u53e9\u304b\u308c\u308b\u306e\u304b\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\n\n\u3061\u306a\u307f\u306b\n\u5c11\u3057\u3044\u3058\u308b\u3068\u30a4\u30d9\u30f3\u30c8\u30e9\u30d9\u30eb\u306e\u6570\u5b57\u3082\u3068\u3063\u3066\u3053\u308c\u307e\u3059\u3002\n\uff08metrics\u3092totalEvents\u306b\u3057\u3066\u3001\u30e9\u30d9\u30eb\u540d\u3067\u30d5\u30a3\u30eb\u30bf\u30fc\u304b\u3051\u3066\u307e\u3059\u3002\uff09\n\n\n# \u7528\u9014\n\n\u30b5\u30a4\u30c8\u5168\u4f53\u306ePV\u3092\u81ea\u52d5\u3067\u629c\u3044\u3066\u304f\u308b\u3050\u3089\u3044\u306a\u3089\u3001\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u306e\u30a2\u30c9\u30aa\u30f3\u3067GA\u306e\u3084\u3064\u3044\u308c\u308c\u3070\u826f\u3044\u3093\u3067\u3059\u304c\u3001\n\uff08\u53c2\u7167\uff1a[http://bnbrd.net/automation-by-google-analytics-and-spreadsheet/](http://bnbrd.net/automation-by-google-analytics-and-spreadsheet/)\uff09\n\u500b\u5225\u306eURL\u306e\u3082\u306e\u3092\u53d6\u3063\u3066\u304f\u308b\u3060\u3068\u304b\u3001\u30a4\u30d9\u30f3\u30c8\u30e9\u30d9\u30eb\u306e\u3082\u306e\u3092\u3068\u3063\u3066\u304f\u308b\u3060\u3068\u304b\u306f\u3001\u3044\u3061\u3044\u3061\u66f8\u3044\u3066\u308b\u3068Report Configuration\u304c\u3081\u3063\u3061\u3083\u4e71\u96d1\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u4e00\u62ec\u3067\u3068\u3063\u3066\u304d\u3061\u3083\u3044\u307e\u3057\u3087\u3046\u3002\n\n\n# \u5b8c\u6210\u30a4\u30e1\u30fc\u30b8\n\n\u3053\u306e\u30ea\u30b9\u30c8\u306b\u8a18\u4e8b\u306e\u76f8\u5bfe\u30d1\u30b9\uff08GA\u304c\u76f8\u5bfe\u30d1\u30b9\u3067\u898b\u3066\u308b\u306e\u3067\uff09\u3092\u66f8\u3044\u3066\u3042\u3052\u308b\u3068\n<img width=\"277\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-11-17 23.18.28.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/41622/ccd3fabc-0ee1-f79f-576d-3a6b07a08c47.png\">\n\n\n\u3053\u3046\u306a\u3063\u3066\u307b\u3057\u3044\uff01\n<img width=\"1013\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2015-11-17_23_18_58.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/41622/5a177c1e-6d9f-e98c-a7b6-a79b775704a4.png\">\n\n\n# \u4f5c\u308a\u65b9\n## Analytics API\u3092\u6709\u52b9\u306b\u3057\u3066\u3042\u3052\u308b\n<img width=\"881\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2015-11-18_10_21_08.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/41622/3285d17b-4757-b988-0617-4657f632dd6d.png\">\n\n\n<img width=\"883\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2015-11-18_10_21_58.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/41622/63d67246-5cfb-7e4a-03cc-91325c219256.png\">\n\n\n<img width=\"1410\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2015-11-18_10_22_45.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/41622/737523a0-dc51-13d9-50d2-208539ec82ca.png\">\n\n\u753b\u50cf\u306e\u9806\u306b\u305f\u3069\u3063\u3066\u3044\u3063\u305f\u5148\u3067\u3001AnalyticsAPI\u3092\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\n\n## \u30b3\u30fc\u30c9\n```js:analytics.gs\nfunction analytics() {\n  var PROFILE_ID = \"ga:hoge\"; // GA\u306eID\n  var END_DATE_OFFSET = 1; // \u4f55\u65e5\u524d\u307e\u3067\u306e\u30c7\u30fc\u30bf\u3068\u3063\u3066\u304f\u308b\u304b\n  var SHEET_URL = \"https://docs.google.com/spreadsheets/d/hogehoge\"; // \u5bfe\u8c61\u306e\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u306eURL\n  var SHEET_ID = \"0\"; // \u5bfe\u8c61\u306e\u30b7\u30fc\u30c8\u306eid\uff08\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u306e\u672b\u5c3e\u306b\u3064\u3044\u3066\u308b\u3084\u3064\uff09\n  \n  var spreadsheet = SpreadsheetApp.getActiveSpreadsheet();\n  var dsheet = spreadsheet.getSheetByName(\"hoge\"); // URL\u3092\u66f8\u304d\u8fbc\u3080\u307b\u3046\u306e\u30b7\u30fc\u30c8\u540d\n  var nsheet = spreadsheet.getSheetByName(\"hoge\"); // PV\u3092\u66f8\u304d\u51fa\u3059\u307b\u3046\u306e\u30b7\u30fc\u30c8\u540d\n  \n  var startrow = 2;\n  var startcol = 1;\n  var lastrow = dsheet.getLastRow();\n  var lastcol = 1;\n  \n  var metrics = \"ga:pageviews\";\n  var today = new Date();\n  var yesterday = new Date(today.getTime() - 24 * 60 * 60 * 1000);\n  var startDate =  \"2015-11-01\"; // \u3044\u3064\u306e\u65e5\u304b\u3089\u306e\u6570\u5024\u53d6\u3063\u3066\u304f\u308b\u304b\n  var endDate = Utilities.formatDate(yesterday, Session.getTimeZone(), 'yyyy-MM-dd');\n  \n  var sheetdata = dsheet.getSheetValues(startrow, startcol, lastrow-1, lastcol);\n  \n  for ( var i in sheetdata ) {\n    if ( sheetdata[i][0] == \"\" ) break;   \n    var fil = \"ga:pagePath=~\" + sheetdata[i][0];\n    var optArgs = {\n      'dimensions': 'ga:date',\n      'filters': fil,\n    };\n    \n    var ga = Analytics.Data.Ga.get(PROFILE_ID, startDate, endDate, metrics, optArgs).rows;\n    var header = [\"\u65e5\u4ed8\", sheetdata[i][0]]; // \u5f8c\u304b\u3089\u4ed8\u3051\u3066\u3082\u3044\u3044\n    ga.unshift(header);\n    \n    for ( var j in ga ) {\n      ga[j].reverse().pop();\n    }     \n    var trans_ga = transpose(ga); // \u884c\u5217\u5909\u63db\n\n    nsheet.getRange(2+Number(i), 1, 1, ga.length).setValues(trans_ga);\n  }\n}\n\n// \u884c\u5217\u3092\u5909\u63db\u3057\u3066\u308b\uff08\u6a2a\u5411\u304d\u306b\u6570\u5024\u3092\u51fa\u3057\u3066\u307b\u3057\u3044\u3089\u3057\u3044\u306e\u3067\uff09\nfunction transpose(a) {\n  return Object.keys(a[0]).map(function (c) {\n\treturn a.map(function (r) {\n\t  return r[c];\n\t});\n  });\n}\n```\n\n# \u30c8\u30ea\u30ac\u30fc\u306e\u30bb\u30c3\u30c8\n\u4f55\u3092\u3057\u305f\u3068\u304d\u306b\u3001\u3053\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u53e9\u304b\u308c\u308b\u306e\u304b\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\n<img width=\"1129\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2015-11-18_10_34_13.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/41622/bdf624f4-21b7-a6c6-25ab-2ba7aa7285ab.png\">\n\n\n<img width=\"1130\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2015-11-18_10_34_40.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/41622/fd028bdb-b21c-90c6-5e5f-1de70769fc91.png\">\n\n# \u3061\u306a\u307f\u306b\n\u5c11\u3057\u3044\u3058\u308b\u3068\u30a4\u30d9\u30f3\u30c8\u30e9\u30d9\u30eb\u306e\u6570\u5b57\u3082\u3068\u3063\u3066\u3053\u308c\u307e\u3059\u3002\n\uff08metrics\u3092totalEvents\u306b\u3057\u3066\u3001\u30e9\u30d9\u30eb\u540d\u3067\u30d5\u30a3\u30eb\u30bf\u30fc\u304b\u3051\u3066\u307e\u3059\u3002\uff09\n\n<img width=\"424\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-11-18 10.40.17.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/41622/f99e8003-f52b-6ec2-842b-a175253d298d.png\">\n\n\n<img width=\"809\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2015-11-18_10_40_25.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/41622/b4fa14c7-58b2-eb2c-a0ca-c13b2f53b5a0.png\">\n", "tags": ["GoogleAppsScript", "GoogleAnalytics"]}