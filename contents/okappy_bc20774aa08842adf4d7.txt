{"context": " More than 1 year has passed since last update.D3.js(http://d3js.org/ )\u306a\u3069\u3067\u51fa\u529b\u3055\u308c\u308bsvg\u8981\u7d20\u3092\u753b\u50cf\u3068\u3057\u3066\u4f7f\u3044\u305f\u304f\u306a\u3063\u305f\u306e\u3067\u3001d3.js\u3067svg\u3068\u3057\u3066\u8868\u793a\u3057\u3001javascript\u3067svg\u30c7\u30fc\u30bf\u3092base64\u5f62\u5f0f\u306b\u3057\u3066\u4fdd\u5b58\u3057\u3001base64\u5f62\u5f0f\u306e\u753b\u50cf\u30c7\u30fc\u30bf\u3092\u753b\u9762\u4e0a\u306b\u8868\u793a\u3059\u308b\u65b9\u6cd5\u3092\u307e\u3068\u3081\u307e\u3057\u305f\u3002\n\n\n\u3010\u624b\u9806\u3011\n\n\u30c7\u30fc\u30bf\u3092D3.js\u3092\u4f7f\u3063\u3066\u30b0\u30e9\u30b0\u30d5\u30a3\u30ab\u30eb\u306b\u8868\u793a\u3059\u308b\n\u51fa\u529b\u3055\u308c\u305fsvg\u8981\u7d20\u3092\u753b\u50cf\u306b\u5909\u63db\u3057\u3066\u4fdd\u5b58\u3059\u308b(\u203b\u4eca\u56de\u306fbase64\u306b\u3057\u3066\u4fdd\u5b58\u306b\u3057\u307e\u3057\u305f)\n\u753b\u50cf\u3068\u3057\u3066\u4fdd\u5b58\u3057\u305f\u30c7\u30fc\u30bf\u3092\u8868\u793a\u3059\u308b\n\n\u3068\u3044\u3046\u4e09\u6bb5\u968e\u3067\u3084\u308a\u65b9\u3092\u307e\u3068\u3081\u3066\u307f\u307e\u3057\u305f\u3002\n\n\n1.\u306b\u3064\u3044\u3066\u306f\u3001\u305f\u304f\u3055\u3093\u7a2e\u985e\u304c\u3042\u308b\u306e\u3067D3.js\u306eexample\u30da\u30fc\u30b8\u3092\u53c2\u8003\u306b\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\nhttps://github.com/mbostock/d3/wiki/Gallery\n\n2.\u51fa\u529b\u3055\u308c\u305fsvg\u8981\u7d20\u3092\u753b\u50cf\u306b\u5909\u63db\u3057\u3066\u4fdd\u5b58\u3059\u308b\n\nsvg_to_png.js\n\nvar svg = document.querySelector( \"svg\" );\nvar svgData = new XMLSerializer().serializeToString( svg );\nvar canvas = document.createElement( \"canvas\" );\ncanvas.width = 970;\ncanvas.height = 600;\n\nvar ctx = canvas.getContext( \"2d\" );\nimgsrc = \"data:image/svg+xml;charset=utf-8;base64,\" + btoa(unescape(encodeURIComponent(svgData))); //svg\u30c7\u30fc\u30bf\u3092base64\u306b\u5909\u63db\nimg.attr( \"src\", imgsrc );\nvar image = new Image;\nimage.src = imgsrc;\nimage.onload = function() {\n  ctx.drawImage( image, 0, 0 );\n  var canvasdata = canvas.toDataURL(\"image/png\");\n\n  $.ajax({\n    method: \"post\",\n    url: \"/api/save_photo_as_png\",\n    data: \"data=\"+canvasdata.replace(/^.*,/, ''),\n    success: function(data,status){\n      //\u3053\u3053\u306b\u306f\u4fdd\u5b58\u306b\u6210\u529f\u3057\u305f\u3068\u304d\u306e\u52d5\u304d\u3092\u5b9f\u88c5\n    }                                                                                                                           \n  });\n};\n\n\n\n\napp/controllers/api_controller.rb\n\ndef save_photo_as_png\n  photo = Photo.create(user_id: user.id, data: params[:data].gsub(\" \",\"+\"))\n  render :json => { success: true, photo_id: photo.id }\n  #ajax\u306esuccess\u6642\u306b\u4fdd\u5b58\u3057\u305fphoto_id\u3092\u4f7f\u3044\u305f\u3044\u306e\u3067photo_id\u3092callback\u3068\u3057\u3066\u8fd4\u3059\u3002\nend\n\n\n\n\n3.\u753b\u50cf\u3068\u3057\u3066\u4fdd\u5b58\u3057\u305f\u30c7\u30fc\u30bf\u3092\u753b\u50cf\u3068\u3057\u3066\u8868\u793a\u3059\u308b\n\napp/controllers/photo_controller.rb\n\ndef show\n  @user = User.find(params[:id])\n  @photo = Photo.find(params[:photo_id])\nend\n\n\n\n\napp/controllers/api_controller.rb\n\ndef get_photo_as_base64\n  @image = Photo.find(params[:id])\n  send_data @image.data.unpack('m')[0], :type => 'image/png', :disposition => \"inline\"\nend\n\n\n\n\napp/views/photo/show.html.erb\n  <%= image_tag url_for(:controller => '/api', :action => 'get_photo_as_base64', :id => @photo.id) %>\n\n\n\u3053\u308c\u3067\u3001svg\u8981\u7d20\u3092base64\u5f62\u5f0f\u306b\u5909\u63db\u3057\u3066\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u4fdd\u5b58\u3057\u3066\u3001\u305d\u308c\u3092\u8aad\u307f\u8fbc\u3093\u3067\u753b\u50cf\u3068\u3057\u3066\u8868\u793a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\nD3.js(http://d3js.org/ )\u306a\u3069\u3067\u51fa\u529b\u3055\u308c\u308bsvg\u8981\u7d20\u3092\u753b\u50cf\u3068\u3057\u3066\u4f7f\u3044\u305f\u304f\u306a\u3063\u305f\u306e\u3067\u3001d3.js\u3067svg\u3068\u3057\u3066\u8868\u793a\u3057\u3001javascript\u3067svg\u30c7\u30fc\u30bf\u3092base64\u5f62\u5f0f\u306b\u3057\u3066\u4fdd\u5b58\u3057\u3001base64\u5f62\u5f0f\u306e\u753b\u50cf\u30c7\u30fc\u30bf\u3092\u753b\u9762\u4e0a\u306b\u8868\u793a\u3059\u308b\u65b9\u6cd5\u3092\u307e\u3068\u3081\u307e\u3057\u305f\u3002\n\n![d3_image.png](https://qiita-image-store.s3.amazonaws.com/0/1418/69dc1d74-8b77-5bf8-0d86-91b50ab12615.png \"d3_image.png\")\n\n\n##\u3010\u624b\u9806\u3011\n1. \u30c7\u30fc\u30bf\u3092D3.js\u3092\u4f7f\u3063\u3066\u30b0\u30e9\u30b0\u30d5\u30a3\u30ab\u30eb\u306b\u8868\u793a\u3059\u308b\n2. \u51fa\u529b\u3055\u308c\u305fsvg\u8981\u7d20\u3092\u753b\u50cf\u306b\u5909\u63db\u3057\u3066\u4fdd\u5b58\u3059\u308b(\u203b\u4eca\u56de\u306fbase64\u306b\u3057\u3066\u4fdd\u5b58\u306b\u3057\u307e\u3057\u305f)\n3. \u753b\u50cf\u3068\u3057\u3066\u4fdd\u5b58\u3057\u305f\u30c7\u30fc\u30bf\u3092\u8868\u793a\u3059\u308b\n\n\u3068\u3044\u3046\u4e09\u6bb5\u968e\u3067\u3084\u308a\u65b9\u3092\u307e\u3068\u3081\u3066\u307f\u307e\u3057\u305f\u3002\n***\n\n\n## 1.\u306b\u3064\u3044\u3066\u306f\u3001\u305f\u304f\u3055\u3093\u7a2e\u985e\u304c\u3042\u308b\u306e\u3067D3.js\u306eexample\u30da\u30fc\u30b8\u3092\u53c2\u8003\u306b\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\nhttps://github.com/mbostock/d3/wiki/Gallery\n\n\n## 2.\u51fa\u529b\u3055\u308c\u305fsvg\u8981\u7d20\u3092\u753b\u50cf\u306b\u5909\u63db\u3057\u3066\u4fdd\u5b58\u3059\u308b\n\n```svg_to_png.js\n\nvar svg = document.querySelector( \"svg\" );\nvar svgData = new XMLSerializer().serializeToString( svg );\nvar canvas = document.createElement( \"canvas\" );\ncanvas.width = 970;\ncanvas.height = 600;\n\nvar ctx = canvas.getContext( \"2d\" );\nimgsrc = \"data:image/svg+xml;charset=utf-8;base64,\" + btoa(unescape(encodeURIComponent(svgData))); //svg\u30c7\u30fc\u30bf\u3092base64\u306b\u5909\u63db\nimg.attr( \"src\", imgsrc );\nvar image = new Image;\nimage.src = imgsrc;\nimage.onload = function() {\n  ctx.drawImage( image, 0, 0 );\n  var canvasdata = canvas.toDataURL(\"image/png\");\n\n  $.ajax({\n\tmethod: \"post\",\n\turl: \"/api/save_photo_as_png\",\n\tdata: \"data=\"+canvasdata.replace(/^.*,/, ''),\n\tsuccess: function(data,status){\n      //\u3053\u3053\u306b\u306f\u4fdd\u5b58\u306b\u6210\u529f\u3057\u305f\u3068\u304d\u306e\u52d5\u304d\u3092\u5b9f\u88c5\n\t}                                                                                                                           \n  });\n};\n\n```\n\n```app/controllers/api_controller.rb\n\ndef save_photo_as_png\n  photo = Photo.create(user_id: user.id, data: params[:data].gsub(\" \",\"+\"))\n  render :json => { success: true, photo_id: photo.id }\n  #ajax\u306esuccess\u6642\u306b\u4fdd\u5b58\u3057\u305fphoto_id\u3092\u4f7f\u3044\u305f\u3044\u306e\u3067photo_id\u3092callback\u3068\u3057\u3066\u8fd4\u3059\u3002\nend\n\n```\n\n\n## 3.\u753b\u50cf\u3068\u3057\u3066\u4fdd\u5b58\u3057\u305f\u30c7\u30fc\u30bf\u3092\u753b\u50cf\u3068\u3057\u3066\u8868\u793a\u3059\u308b\n\n```app/controllers/photo_controller.rb\n\ndef show\n  @user = User.find(params[:id])\n  @photo = Photo.find(params[:photo_id])\nend\n\n```\n\n```app/controllers/api_controller.rb\n\ndef get_photo_as_base64\n  @image = Photo.find(params[:id])\n  send_data @image.data.unpack('m')[0], :type => 'image/png', :disposition => \"inline\"\nend\n\n```\n\n```app/views/photo/show.html.erb\n  <%= image_tag url_for(:controller => '/api', :action => 'get_photo_as_base64', :id => @photo.id) %>\n```\n\n\n\u3053\u308c\u3067\u3001svg\u8981\u7d20\u3092base64\u5f62\u5f0f\u306b\u5909\u63db\u3057\u3066\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u4fdd\u5b58\u3057\u3066\u3001\u305d\u308c\u3092\u8aad\u307f\u8fbc\u3093\u3067\u753b\u50cf\u3068\u3057\u3066\u8868\u793a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\n", "tags": ["Ruby", "d3.js", "SVG", "Rails", "JavaScript"]}