{"context": " More than 1 year has passed since last update.\n\n\u3010 \u30b3\u30fc\u30c9\u5199\u7d4c\u5143 \u30a6\u30a7\u30d6\u30da\u30fc\u30b8 \u3011\n\n\n\u7b2c3\u90e8 \u30d0\u30c3\u30af\u30c8\u30e9\u30c3\u30af\u554f\u984c 13. \u30ca\u30c3\u30d7\u30b5\u30c3\u30af\u554f\u984c\n\n\n\u30ca\u30c3\u30d7\u30b5\u30c3\u30af\u554f\u984c\u3092\u89e3\u3044\u3066\u307f\u307e\u3059\u3002\n\u6700\u5927\u306720kg\u307e\u3067\u306e\u8377\u7269\u3092\u6301\u3066\u308b\u3068\u3057\u3066\u3001Val\u304c\u6700\u5927\u306b\u306a\u308bID\u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u6c42\u3081\u307e\u3059\u3002\n\n\n\u3010 \u5199\u7d4c\u3057\u305f pl/pgsql \u30b3\u30fc\u30c9 \u3011\n\n\npostgresql\ncreate table nimotu(ID,Val,Kg) as\nvalues(1, 7,10),\n      (2, 2, 4),\n      (3, 9, 5),\n      (4, 4, 1),\n      (5, 9, 7),\n      (6, 7, 3),\n      (7, 4, 6),\n      (8, 5, 3);\n\n\n\n\n\n\n\npl/pgsql\nwith recursive rec(ID,IDList,sumVal,SumKg) as(\nselect ID,array[ID],Val,Kg\n  from nimotu\nunion all\nselect b.ID,a.IDList || b.ID,\na.sumVal+b.Val,a.SumKg+b.Kg\n  from rec a,nimotu b\n where a.ID < b.ID\n   and a.SumKg+b.Kg <= 20)\nselect ID,IDList,sumVal,sumKg\nfrom (select ID,IDList,sumVal,sumKg,\n      max(sumVal) over() as maxSumVal\n      from rec) a\n where sumVal = maxSumVal\n ;\n\n\n\n\u3010 \u5b9f\u884c\u7d50\u679c \u3011\n\n\n\n\n\n\n\n#### __\u3010 \u30b3\u30fc\u30c9\u5199\u7d4c\u5143 \u30a6\u30a7\u30d6\u30da\u30fc\u30b8 \u3011__\n\n* [\u7b2c3\u90e8 \u30d0\u30c3\u30af\u30c8\u30e9\u30c3\u30af\u554f\u984c 13. \u30ca\u30c3\u30d7\u30b5\u30c3\u30af\u554f\u984c](http://www.geocities.jp/oraclesqlpuzzle/postgresql-rec-with.html#13)\n\n> \u30ca\u30c3\u30d7\u30b5\u30c3\u30af\u554f\u984c\u3092\u89e3\u3044\u3066\u307f\u307e\u3059\u3002\n>\n> \u6700\u5927\u306720kg\u307e\u3067\u306e\u8377\u7269\u3092\u6301\u3066\u308b\u3068\u3057\u3066\u3001Val\u304c\u6700\u5927\u306b\u306a\u308bID\u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u6c42\u3081\u307e\u3059\u3002\n\n\n#### __\u3010 \u5199\u7d4c\u3057\u305f pl/pgsql \u30b3\u30fc\u30c9 \u3011__\n\n```{sql:postgresql}\ncreate table nimotu(ID,Val,Kg) as\nvalues(1, 7,10),\n      (2, 2, 4),\n      (3, 9, 5),\n      (4, 4, 1),\n      (5, 9, 7),\n      (6, 7, 3),\n      (7, 4, 6),\n      (8, 5, 3);\n```\n\n![1.PNG](https://qiita-image-store.s3.amazonaws.com/0/43487/3ed9a1c3-d0e2-c1e7-cf0b-cb1f9a53b2e5.png)\n\n___\n\n![2.PNG](https://qiita-image-store.s3.amazonaws.com/0/43487/d3100038-e551-5df9-2bda-d0ebeb1a7845.png)\n\n___\n\n\n```{sql:pl/pgsql}\nwith recursive rec(ID,IDList,sumVal,SumKg) as(\nselect ID,array[ID],Val,Kg\n  from nimotu\nunion all\nselect b.ID,a.IDList || b.ID,\na.sumVal+b.Val,a.SumKg+b.Kg\n  from rec a,nimotu b\n where a.ID < b.ID\n   and a.SumKg+b.Kg <= 20)\nselect ID,IDList,sumVal,sumKg\nfrom (select ID,IDList,sumVal,sumKg,\n      max(sumVal) over() as maxSumVal\n      from rec) a\n where sumVal = maxSumVal\n ;\n```\n\n#### __\u3010 \u5b9f\u884c\u7d50\u679c \u3011__\n\n![3.PNG](https://qiita-image-store.s3.amazonaws.com/0/43487/aa137cb9-259a-a763-f607-4a3fe628cd09.png)\n\n\n\n```\n\n\n\n", "tags": ["PLpgSQL", "SQL", "\u30ca\u30c3\u30d7\u30b6\u30c3\u30af\u554f\u984c", "\u5165\u9580", "PostgreSQL"]}