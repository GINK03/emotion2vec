{"context": "\u30d6\u30e9\u30a6\u30b6\u4e0a\u306e JavaScript \u5185 SQL \u304c\u305d\u308c\u306a\u308a\u306b\u52d5\u3044\u305f\u306e\u3067\u3001kintone \u3067\u3082\u8a66\u3057\u3066\u307f\u305f\u3002\n\u7d50\u679c\u3001\u7528\u9014\u306b\u3088\u308c\u3070\u3001kintone \u3067\u3082 SQL \u304c\u4f7f\u3048\u305d\u3046\u3060\uff01\n\u203balasql \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u899a\u66f8 \u53c2\u7167\n\u3053\u3093\u306a SQL \u3067\u96c6\u8a08\u3067\u304d\u307e\u3057\u305f\u3002\nalasql(\n\"SELECT cust.[\u4f1a\u793e\u540d], cust.[\u9867\u5ba2\u30e9\u30f3\u30af], SUM(orders.[\u53d7\u6ce8\u91d1\u984d]) as [\u53d7\u6ce8\u91d1\u984d] \\\nFROM ? AS cust JOIN ? AS orders ON cust.[\u4f1a\u793e\u540d] = orders.[\u9867\u5ba2\u540d] \\\nGROUP BY cust.[\u4f1a\u793e\u540d], cust.[\u9867\u5ba2\u30e9\u30f3\u30af] \\\nORDER BY cust.[\u4f1a\u793e\u540d]\", [obj.rs1, obj.rs2]);\n\n\n\u96c6\u8a08\u5143\u30a2\u30d7\u30ea\n\u3068\u308a\u3042\u3048\u305a\u3001\u9867\u5ba2\u3068\u53d7\u6ce8\u91d1\u984d\u3092\u96c6\u8a08\u3057\u307e\u3059\u3002\n\n\n\u96c6\u8a08\u7d50\u679c\n\u96c6\u8a08\u306f\u3001\u30b0\u30ea\u30c3\u30c9\u8868\u793a\u306b\u3057\u307e\u3057\u305f\u3002\n\u3071\u3063\u3068\u898b\u3001\u96c6\u8a08\u3055\u308c\u3066\u3044\u305d\u3046\u3067\u3059\u3002\n\n\n\u5fc5\u8981\u30e9\u30a4\u30d6\u30e9\u30ea\n\n\nalasql.min.js : JavaScript \u3067 SQL \u304c\u4f7f\u3048\u307e\u3059\u3002\n\nhandsontable : \u30b0\u30ea\u30c3\u30c9\u8868\u793a\u7528\n\n\n\u96c6\u8a08\u30b3\u30fc\u30c9\n\u51e6\u7406\u6982\u8981\n\n\u9867\u5ba2\u60c5\u5831\u30a2\u30d7\u30ea\u3068\u6848\u4ef6\u30a2\u30d7\u30ea\u306e\u30ec\u30b3\u30fc\u30c9\u3092\u53d6\u5f97\njson \u69cb\u9020\u3092\u7c21\u5358\u5316\nSQL \u3067\u7d50\u5408(Join)\u3068\u96c6\u8a08\uff08Group By\uff09\n\nSQL \u3067\u3001\u666e\u901a\u306bJoin, Group By \u304c\u4f7f\u3048\u308b\u306e\u304c\u3059\u3070\u3089\u3057\u3044\uff01\n////////////////////////////////////////////////////////////////////////////\n// kintone JavaScript: Summary of kintone records by alasql.\n//  2017.02.14 by rex0220\n////////////////////////////////////////////////////////////////////////////\n(function() {\n    \"use strict\";\n\n    // \u4e00\u89a7\u8868\u793a\n    kintone.events.on(\"app.record.index.show\", function(event) {\n        if (event.viewId !== 5332577) return event;\n\n        var obj = {};\n        var custApp = 433;\n\n        // \u9867\u5ba2\u60c5\u5831\u53d6\u5f97\n        fetchRecords(custApp, '', ['\u4f1a\u793e\u540d', '\u9867\u5ba2\u30e9\u30f3\u30af']).then(function(records) {\n            obj.rs1 = convertToRows(records);\n            console.log('rs1', JSON.stringify(obj.rs1));\n\n            // \u6ce8\u6587\u60c5\u5831\u53d6\u5f97\n            return fetchRecords(event.appId, '', ['\u9867\u5ba2\u540d', '\u53d7\u6ce8\u91d1\u984d']);\n\n        }).then(function(records) {\n            obj.rs2 = convertToRows(records);\n            console.log('rs2', JSON.stringify(obj.rs2));\n\n            // \u9867\u5ba2\u60c5\u5831\u3068\u6ce8\u6587\u60c5\u5831\u3092\u96c6\u8a08\n            var result1 = \n                alasql(\n                \"SELECT cust.[\u4f1a\u793e\u540d], cust.[\u9867\u5ba2\u30e9\u30f3\u30af], SUM(orders.[\u53d7\u6ce8\u91d1\u984d]) as [\u53d7\u6ce8\u91d1\u984d] \\\n                FROM ? AS cust JOIN ? AS orders ON cust.[\u4f1a\u793e\u540d] = orders.[\u9867\u5ba2\u540d] \\\n                GROUP BY cust.[\u4f1a\u793e\u540d], cust.[\u9867\u5ba2\u30e9\u30f3\u30af] \\\n                ORDER BY cust.[\u4f1a\u793e\u540d]\", [obj.rs1, obj.rs2]);\n\n            console.log('result3', JSON.stringify(result1));\n\n            // grid \u8868\u793a\n            var grid = document.getElementById('xp-grid');\n            new Handsontable(grid, { \n                data: result1, \n                colWidths: [150, 100, 200],\n                colHeaders: ['\u4f1a\u793e\u540d', '\u9867\u5ba2\u30e9\u30f3\u30af', '\u53d7\u6ce8\u91d1\u984d'], \n                columns: [\n                    { data: '\u4f1a\u793e\u540d' },\n                    { data: '\u9867\u5ba2\u30e9\u30f3\u30af' },\n                    { data: '\u53d7\u6ce8\u91d1\u984d', type: 'numeric', format: '0,0' },\n                ],\n                readOnly: true \n            });\n\n        });\n\n        return event;\n    });\n\n\n    // get records\n    function fetchRecords(appId, opt_query, opt_fields, opt_offset, opt_limit, opt_records) {\n        var query = opt_query || '';\n        var offset = opt_offset || 0;\n        var limit = opt_limit || 500;\n        var allRecords = opt_records || [];\n        var params = {app: appId, query: query + ' limit ' + limit + ' offset ' + offset };\n        if (opt_fields) params.fields = opt_fields;\n        return kintone.api(kintone.api.url('/k/v1/records', true), 'GET', params).then(function(resp) {\n            allRecords = allRecords.concat(resp.records);\n            if (resp.records.length === limit) {\n                return fetchRecords(appId, query, opt_fields, offset + limit, limit, allRecords);\n            }\n            return allRecords;\n        });\n    }\n\n    // records convert to table rows \n    function convertToRows(records) {\n        var rows = records.map(function(record){\n            var keys = Object.keys(record);\n            var row = {};\n            keys.map(function(key){\n                row[key] = record[key].type === 'NUMBER' ? Number(record[key].value) : record[key].value;\n            });\n            return row;\n        });\n        return rows;\n    }\n\n})();\n\n\n\u53c2\u8003\nAlasql JavaScript SQL Database Library: User Manual\n\n\u3042\u3068\u304c\u304d\n\u5bfe\u8c61\u30ec\u30b3\u30fc\u30c9\u6570\u304c\u5c11\u306a\u3051\u308c\u3070\u3001\u554f\u984c\u306a\u304f\u4f7f\u3048\u305d\u3046\u3067\u3059\u3002\n\u3042\u3068\u306f\u3001\u30ec\u30b3\u30fc\u30c9\u4ef6\u6570\u304c\u591a\u3044\u5834\u5408\u306b\u3069\u306e\u7a0b\u5ea6\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306b\u306a\u308b\u304b\u691c\u8a3c\u8981\u3067\u3059\u3002\nkintone \u3067SQL\u3092\u4f7f\u3046\uff08\u305d\u306e\uff12\uff09\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u691c\u8a3c \u306b\u7d9a\u304f\nkintone \u3067SQL\u3092\u4f7f\u3046\uff08\u305d\u306e\uff13\uff09\u30b5\u30d6\u30af\u30a8\u30ea\u30fc \n\u30d6\u30e9\u30a6\u30b6\u4e0a\u306e JavaScript \u5185 SQL \u304c\u305d\u308c\u306a\u308a\u306b\u52d5\u3044\u305f\u306e\u3067\u3001kintone \u3067\u3082\u8a66\u3057\u3066\u307f\u305f\u3002\n**\u7d50\u679c\u3001\u7528\u9014\u306b\u3088\u308c\u3070\u3001kintone \u3067\u3082 SQL \u304c\u4f7f\u3048\u305d\u3046\u3060\uff01**\n\n\u203b[alasql \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u899a\u66f8](http://qiita.com/rex0220/items/d1030b293c1021d28750) \u53c2\u7167\n\n\u3053\u3093\u306a SQL \u3067\u96c6\u8a08\u3067\u304d\u307e\u3057\u305f\u3002\n\n```\nalasql(\n\"SELECT cust.[\u4f1a\u793e\u540d], cust.[\u9867\u5ba2\u30e9\u30f3\u30af], SUM(orders.[\u53d7\u6ce8\u91d1\u984d]) as [\u53d7\u6ce8\u91d1\u984d] \\\nFROM ? AS cust JOIN ? AS orders ON cust.[\u4f1a\u793e\u540d] = orders.[\u9867\u5ba2\u540d] \\\nGROUP BY cust.[\u4f1a\u793e\u540d], cust.[\u9867\u5ba2\u30e9\u30f3\u30af] \\\nORDER BY cust.[\u4f1a\u793e\u540d]\", [obj.rs1, obj.rs2]);\n```\n\n# \u96c6\u8a08\u5143\u30a2\u30d7\u30ea\n\n\u3068\u308a\u3042\u3048\u305a\u3001\u9867\u5ba2\u3068\u53d7\u6ce8\u91d1\u984d\u3092\u96c6\u8a08\u3057\u307e\u3059\u3002\n\n\n![2017-02-14_21h04_38.png](https://qiita-image-store.s3.amazonaws.com/0/100572/fead128b-a2d5-0a82-e2ab-475c96d710f7.png)\n\n\n# \u96c6\u8a08\u7d50\u679c\n\n\u96c6\u8a08\u306f\u3001\u30b0\u30ea\u30c3\u30c9\u8868\u793a\u306b\u3057\u307e\u3057\u305f\u3002\n\u3071\u3063\u3068\u898b\u3001\u96c6\u8a08\u3055\u308c\u3066\u3044\u305d\u3046\u3067\u3059\u3002\n\n![2017-02-14_21h09_02.png](https://qiita-image-store.s3.amazonaws.com/0/100572/66fd9026-9c31-d1ef-2777-6db892fbdb1d.png)\n\n\n# \u5fc5\u8981\u30e9\u30a4\u30d6\u30e9\u30ea\n\n- [alasql.min.js](http://alasql.org/) : JavaScript \u3067 SQL \u304c\u4f7f\u3048\u307e\u3059\u3002\n- [handsontable](https://handsontable.com/?_ga=1.73131861.714310381.1484906350) : \u30b0\u30ea\u30c3\u30c9\u8868\u793a\u7528\n\n# \u96c6\u8a08\u30b3\u30fc\u30c9\n\n\u51e6\u7406\u6982\u8981\n\n- \u9867\u5ba2\u60c5\u5831\u30a2\u30d7\u30ea\u3068\u6848\u4ef6\u30a2\u30d7\u30ea\u306e\u30ec\u30b3\u30fc\u30c9\u3092\u53d6\u5f97\n- json \u69cb\u9020\u3092\u7c21\u5358\u5316\n- SQL \u3067\u7d50\u5408(Join)\u3068\u96c6\u8a08\uff08Group By\uff09\n\n**SQL \u3067\u3001\u666e\u901a\u306bJoin, Group By \u304c\u4f7f\u3048\u308b\u306e\u304c\u3059\u3070\u3089\u3057\u3044\uff01**\n\n```\n////////////////////////////////////////////////////////////////////////////\n// kintone JavaScript: Summary of kintone records by alasql.\n//  2017.02.14 by rex0220\n////////////////////////////////////////////////////////////////////////////\n(function() {\n    \"use strict\";\n\n    // \u4e00\u89a7\u8868\u793a\n    kintone.events.on(\"app.record.index.show\", function(event) {\n        if (event.viewId !== 5332577) return event;\n\n        var obj = {};\n        var custApp = 433;\n\n        // \u9867\u5ba2\u60c5\u5831\u53d6\u5f97\n        fetchRecords(custApp, '', ['\u4f1a\u793e\u540d', '\u9867\u5ba2\u30e9\u30f3\u30af']).then(function(records) {\n            obj.rs1 = convertToRows(records);\n            console.log('rs1', JSON.stringify(obj.rs1));\n\n            // \u6ce8\u6587\u60c5\u5831\u53d6\u5f97\n            return fetchRecords(event.appId, '', ['\u9867\u5ba2\u540d', '\u53d7\u6ce8\u91d1\u984d']);\n\n        }).then(function(records) {\n            obj.rs2 = convertToRows(records);\n            console.log('rs2', JSON.stringify(obj.rs2));\n\n            // \u9867\u5ba2\u60c5\u5831\u3068\u6ce8\u6587\u60c5\u5831\u3092\u96c6\u8a08\n            var result1 = \n                alasql(\n                \"SELECT cust.[\u4f1a\u793e\u540d], cust.[\u9867\u5ba2\u30e9\u30f3\u30af], SUM(orders.[\u53d7\u6ce8\u91d1\u984d]) as [\u53d7\u6ce8\u91d1\u984d] \\\n                FROM ? AS cust JOIN ? AS orders ON cust.[\u4f1a\u793e\u540d] = orders.[\u9867\u5ba2\u540d] \\\n                GROUP BY cust.[\u4f1a\u793e\u540d], cust.[\u9867\u5ba2\u30e9\u30f3\u30af] \\\n                ORDER BY cust.[\u4f1a\u793e\u540d]\", [obj.rs1, obj.rs2]);\n\n            console.log('result3', JSON.stringify(result1));\n\n            // grid \u8868\u793a\n            var grid = document.getElementById('xp-grid');\n            new Handsontable(grid, { \n                data: result1, \n                colWidths: [150, 100, 200],\n                colHeaders: ['\u4f1a\u793e\u540d', '\u9867\u5ba2\u30e9\u30f3\u30af', '\u53d7\u6ce8\u91d1\u984d'], \n                columns: [\n                    { data: '\u4f1a\u793e\u540d' },\n                    { data: '\u9867\u5ba2\u30e9\u30f3\u30af' },\n                    { data: '\u53d7\u6ce8\u91d1\u984d', type: 'numeric', format: '0,0' },\n                ],\n                readOnly: true \n            });\n\n        });\n\n        return event;\n    });\n\n\n    // get records\n    function fetchRecords(appId, opt_query, opt_fields, opt_offset, opt_limit, opt_records) {\n        var query = opt_query || '';\n        var offset = opt_offset || 0;\n        var limit = opt_limit || 500;\n        var allRecords = opt_records || [];\n        var params = {app: appId, query: query + ' limit ' + limit + ' offset ' + offset };\n        if (opt_fields) params.fields = opt_fields;\n        return kintone.api(kintone.api.url('/k/v1/records', true), 'GET', params).then(function(resp) {\n            allRecords = allRecords.concat(resp.records);\n            if (resp.records.length === limit) {\n                return fetchRecords(appId, query, opt_fields, offset + limit, limit, allRecords);\n            }\n            return allRecords;\n        });\n    }\n\n    // records convert to table rows \n    function convertToRows(records) {\n        var rows = records.map(function(record){\n            var keys = Object.keys(record);\n            var row = {};\n            keys.map(function(key){\n                row[key] = record[key].type === 'NUMBER' ? Number(record[key].value) : record[key].value;\n            });\n            return row;\n        });\n        return rows;\n    }\n\n})();\n```\n\n# \u53c2\u8003\n\n[Alasql JavaScript SQL Database Library: User Manual](http://www.slideshare.net/AndreyGershun/alasql-manual-141220-1?next_slideshow=1)\n\n# \u3042\u3068\u304c\u304d\n\n\u5bfe\u8c61\u30ec\u30b3\u30fc\u30c9\u6570\u304c\u5c11\u306a\u3051\u308c\u3070\u3001\u554f\u984c\u306a\u304f\u4f7f\u3048\u305d\u3046\u3067\u3059\u3002\n\u3042\u3068\u306f\u3001\u30ec\u30b3\u30fc\u30c9\u4ef6\u6570\u304c\u591a\u3044\u5834\u5408\u306b\u3069\u306e\u7a0b\u5ea6\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306b\u306a\u308b\u304b\u691c\u8a3c\u8981\u3067\u3059\u3002\n\n[kintone \u3067SQL\u3092\u4f7f\u3046\uff08\u305d\u306e\uff12\uff09\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u691c\u8a3c](http://qiita.com/rex0220/items/4db795a920d75c9e4643) \u306b\u7d9a\u304f\n[kintone \u3067SQL\u3092\u4f7f\u3046\uff08\u305d\u306e\uff13\uff09\u30b5\u30d6\u30af\u30a8\u30ea\u30fc](http://qiita.com/rex0220/items/0c0516d6f08bd47c1a1d) \n\n", "tags": ["kintone", "alasql", "JavaScript"]}