{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u7af6\u99ac\u306b\u306fPOG\u3068\u3044\u3046\u904a\u3073\u304c\u3042\u308b\u3002\n\u3053\u308c\u306f\u67b6\u7a7a\u306e\u99ac\u4e3b\u3068\u306a\u3063\u3066\u6240\u6709\u99ac\u306e\u6d3b\u8e8d\u5ea6\u3092\u7af6\u3046\u3082\u306e\u3067\u3042\u308b\u3002\u4e00\u822c\u7684\u306b\u306f\u30c7\u30d3\u30e5\u30fc\u304b\u3089\u30c0\u30fc\u30d3\u30fc\u307e\u3067\u306e\u671f\u9593\u306e\u7372\u5f97\u8cde\u91d1\u3092\u6d3b\u8e8d\u5ea6\u306e\u6307\u6a19\u3068\u3059\u308b\u3053\u3068\u304c\u591a\u3044\u3002\n\u7b46\u8005\u306f\u304b\u308c\u3053\u308c5\u5e74\u307b\u3069POG\u3092\u7d9a\u3051\u3066\u3044\u308b\u3002\n\u3053\u308c\u307e\u3067\u306f\u3001\u6bce\u5e744\u6708\u9803\u306b\u306a\u308b\u3068\u767a\u58f2\u3055\u308c\u308b\u9752\u672c\u3092\u983c\u308a\u306b\u3001\u306a\u3093\u3068\u306a\u304f\u826f\u3055\u6c17\u306a\u99ac\u3092\u9078\u3093\u3067\u304d\u305f\u3002\n\u3057\u304b\u3057\u306a\u304c\u3089\u6210\u7e3e\u306f\u71e6\u3005\u305f\u308b\u3082\u306e\u3067\u4eca\u5e74\u306b\u81f3\u3063\u3066\u306f10\u982d\u4e2d\u307e\u30602\u982d\u3057\u304b\u52dd\u3061\u4e0a\u304c\u3063\u3066\u3044\u306a\u3044\u3002\n\u3053\u306e\u3046\u3060\u3064\u306e\u3042\u304c\u3089\u306a\u3044\u72b6\u6cc1\u3092\u6253\u7834\u3059\u3079\u304f\u3001\u30c7\u30fc\u30bf\u89e3\u6790\u306b\u672c\u8170\u3092\u5165\u308c\u308b\u4e8b\u306b\u3057\u305f\u3002\u305f\u3060\u3057\u7b46\u8005\u306b\u306f\u6700\u8fd1\u6d41\u884c\u308a\u306e\u6a5f\u68b0\u5b66\u7fd2\u3092\u81ea\u5728\u306b\u64cd\u308b\u307b\u3069\u306e\u30b9\u30ad\u30eb\u304c\u306a\u3044\u3002\u305d\u3053\u3067\u3001\u3053\u3053\u3067\u306f\u99ac\u306e\u57fa\u672c\u60c5\u5831\uff08\u53a9\u820e\u3001\u751f\u7523\u8005\u3001\u8840\u7d71\uff09\u3068POG\u671f\u9593\u4e2d\u306e\u7372\u5f97\u8cde\u91d1\u3068\u306e\u9593\u306b\u3042\u308b\u56e0\u679c\u95a2\u4fc2\u3092\u898b\u51fa\u3059\u3053\u3068\u3092\u5f53\u9762\u306e\u76ee\u6a19\u3068\u3057\u305f\u3044\u3002\n\u3053\u3053\u3067\u91cd\u8981\u306a\u306e\u304c\u300cPOG\u671f\u9593\u4e2d\u306e\u7372\u5f97\u8cde\u91d1\u300d\u3067\u3042\u308b\u3002\u7b46\u8005\u306e\u77e5\u308b\u9650\u308a\u3001\u3053\u306e\u60c5\u5831\u3092\u516c\u958b\u3057\u3066\u3044\u308bweb\u30b5\u30a4\u30c8\u306f\u5b58\u5728\u3057\u306a\u3044\u3002\u3082\u3057\u304b\u3057\u305f\u3089\u6709\u6599\u3067\u63d0\u4f9b\u3057\u3066\u3044\u308b\u6a5f\u95a2\u306f\u3042\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u304c\u3001\u8cbb\u7528\u306b\u898b\u5408\u3046\u52b9\u679c\u304c\u3042\u308b\u304b\u4e0d\u660e\u306a\u72b6\u6cc1\u3067\u306f\u624b\u3092\u51fa\u3057\u305f\u304f\u306a\u3044\u3002\n\u3088\u3063\u3066\u3001\u3053\u3053\u3067\u306fnetkeiba\u304b\u3089\u99ac\u306e\u57fa\u672c\u60c5\u5831\u3084\u51fa\u8d70\u6b74\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3001\u51fa\u8d70\u6b74\u30c7\u30fc\u30bf\u3092\u4f7f\u3063\u3066POG\u671f\u9593\u4e2d\u306e\u8cde\u91d1\u3092\u8a08\u7b97\u3059\u308b\u3000\u3068\u3044\u3046\u624b\u6bb5\u3092\u53d6\u308b\u3053\u3068\u3068\u3057\u305f\u3002\n\u307e\u305f\u3001\u4f7f\u7528\u3057\u305f\u8a00\u8a9e\u306fPython\u3067\u3042\u308b\u3002\u3053\u308c\u306f\u5358\u306b\u7b46\u8005\u304c\u4f7f\u3044\u6163\u308c\u3066\u3044\u308b\u3060\u3051\u3067\u3042\u308b\u3002\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n2010\u5e74\u301c2013\u5e74\u307e\u3067\u306e4\u5e74\u9593\u306e\u9593\u306b\u751f\u307e\u308c\u305f\u99ac\u306e\u30c7\u30fc\u30bf\u3092\u53ce\u96c6\u3059\u308b\u3002\n\u3053\u3053\u3067\u306f4\u30b3\u30a2\u306e\u4e26\u5217\u51e6\u7406\u306b\u3088\u3063\u3066\u30014\u5e74\u5206\u306e\u30c7\u30fc\u30bf\u3092\u540c\u6642\u306b\u53d6\u5f97\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n\u30de\u30b7\u30f3\u30b9\u30da\u30c3\u30af\u306b\u3082\u3088\u308b\u3060\u308d\u3046\u304c\u3001\u7b46\u8005\u306eMBA\u3067\u306f\u7d041\u6642\u9593\u307b\u3069\u3067\u30c7\u30fc\u30bf\u3092\u53d6\u308a\u7d42\u3048\u305f\u3002\n\u203b2015/12/30\u7de8\u96c6\n\u30b5\u30fc\u30d0\u30a2\u30af\u30bb\u30b9\u51e6\u7406\u306e\u4e2d\u306b10\u79d2\u9593\u306e\u6642\u9593\u5f85\u3061\u95a2\u6570\u3092\u633f\u5165\u3057\u305f\u3002\n\u3053\u308c\u306a\u3089\u4eba\u529b\u3067\u30b5\u30a4\u30c8\u3092\u95b2\u89a7\u3059\u308b\u7a0b\u5ea6\u306e\u983b\u5ea6\u306b\u6291\u3048\u3089\u308c\u308b\u306e\u3067\u904e\u5ea6\u306a\u30a2\u30af\u30bb\u30b9\u306b\u306f\u306a\u3089\u306a\u3044\u3060\u308d\u3046\u3002\n\nMakeUmaDB_151229.py\n#!/usr/bin/env python\n# encoding: utf-8\n\nimport urllib2 as ul\nimport pandas as pd\nimport os\nimport time\nimport datetime\nfrom lxml import html\nimport multiprocessing as mp\n\n__PROC__ = 4\n\ndef MakeDir(dname):\n    if not os.path.exists(dname):\n        os.mkdir(dname)\n        print 'Make directory:%s' % dname\n    else:\n        print '%s is exist' % dname\n\n    return 0\n\ndef subMakeHorseDB(year):\n    # Set Directory\n    o_dname = 'horse_db'\n    MakeDir(o_dname)\n\n    # horse_prof\n    prof_keys = [\n        u'\u99ac\u540d',\n        u'\u751f\u5e74\u6708\u65e5',\n        u'\u8abf\u6559\u5e2b',\n        u'\u99ac\u4e3b',\n        u'\u751f\u7523\u8005',\n        u'\u7523\u5730',\n        u'\u30bb\u30ea\u53d6\u5f15\u4fa1\u683c',\n        u'\u7236',\n        u'\u6bcd',\n        u'\u6bcd\u7236',\n        u'POG\u671f\u9593\u8cde\u91d1_\u534a\u671f',\n        u'POG\u671f\u9593\u8cde\u91d1_\u901a\u5e74'\n    ]\n\n    # get Uma data from web site\n    base_url = 'http://db.netkeiba.com/horse/'\n    idx_from = 100000\n    idx_to = 111000\n\n    masta_d = {}\n    for idx in range(idx_from, idx_to + 1):\n        try:\n            # get html from web\n            time.sleep(10)\n            s_idx = str(year)+str(idx).zfill(6)\n            url = base_url + s_idx\n            src_html = ul.urlopen(url).read()# get html from url\n            root = html.fromstring(src_html)\n\n            # show progress\n            print 'idx: %s, (%d, %d/%d)' % (s_idx, year, idx, idx_to)\n\n            # not found db\n            if root.xpath('//title')[0].text.startswith(u'\uff5c'):\n                #print 'DB not found'\n                continue\n\n            # html parse\n            masta_d[s_idx] = {}\n\n            for prof in prof_keys:\n                if prof == u'\u99ac\u540d':\n                    horse_name = root.xpath('//div[@class=\"horse_title\"]')[0].text_content().split('\\n')[1]\n                    masta_d[s_idx][prof] = horse_name\n\n                elif prof == u'\u7236':\n                    masta_d[s_idx][prof] = root.xpath('//td[@rowspan=\"2\"][@class=\"b_ml\"]')[0].text_content().split('\\n')[1]\n\n                elif prof == u'\u6bcd':\n                    masta_d[s_idx][prof] = root.xpath('//td[@rowspan=\"2\"][@class=\"b_fml\"]')[0].text_content().split('\\n')[1]\n                elif prof == u'\u6bcd\u7236':\n                    masta_d[s_idx][prof] = root.xpath('//td[@class=\"b_ml\"]')[2].text_content().split('\\n')[1]\n                elif prof == u'POG\u671f\u9593\u8cde\u91d1_\u534a\u671f' or prof == u'POG\u671f\u9593\u8cde\u91d1_\u901a\u5e74':\n                    continue\n                elif prof == u'\u751f\u5e74\u6708\u65e5':\n                    masta_d[s_idx][prof] = root.xpath('//table[@class=\"db_prof_table\"]/tr/td')[0].text_content()\n                elif prof == u'\u8abf\u6559\u5e2b':\n                    masta_d[s_idx][prof] = root.xpath('//table[@class=\"db_prof_table\"]/tr/td')[1].text_content()\n                elif prof == u'\u99ac\u4e3b':\n                    masta_d[s_idx][prof] = root.xpath('//table[@class=\"db_prof_table\"]/tr/td')[2].text_content()\n                elif prof == u'\u751f\u7523\u8005':\n                    masta_d[s_idx][prof] = root.xpath('//table[@class=\"db_prof_table\"]/tr/td')[3].text_content()\n                elif prof == u'\u7523\u5730':\n                    masta_d[s_idx][prof] = root.xpath('//table[@class=\"db_prof_table\"]/tr/td')[4].text_content()\n                elif prof == u'\u30bb\u30ea\u53d6\u5f15\u4fa1\u683c':\n                    masta_d[s_idx][prof] = root.xpath('//table[@class=\"db_prof_table\"]/tr/td')[5].text_content()\n\n            # calc POG prize\n            prize_all = 0.0\n            prize_half = 0.0\n            deadline_all = datetime.datetime.strptime('%d-07-01'%(year+3), '%Y-%m-%d')\n            deadline_half = datetime.datetime.strptime('%d-01-01'%(year+3), '%Y-%m-%d')\n\n            r_hist = root.xpath('//table[@class=\"db_h_race_results nk_tb_common\"]')\n            if len(r_hist) == 0:\n                masta_d[s_idx][u'POG\u671f\u9593\u8cde\u91d1_\u534a\u671f'] = '%d' % prize_half\n                masta_d[s_idx][u'POG\u671f\u9593\u8cde\u91d1_\u901a\u5e74'] = '%d' % prize_all\n            else:\n                r_hist_l = root.xpath('//table[@class=\"db_h_race_results nk_tb_common\"]/tbody/tr')\n                for race in r_hist_l:\n                    r_date = datetime.datetime.strptime(race.text_content().split('\\n')[1],'%Y/%m/%d')\n                    try:\n                        prize = float(race.text_content().split('\\n')[-2].replace(',',''))\n                    except:\n                        prize = 0.0\n\n                    if r_date < deadline_all:\n                        prize_all += prize\n                    if r_date < deadline_half:\n                        prize_half += prize\n\n                masta_d[s_idx][u'POG\u671f\u9593\u8cde\u91d1_\u534a\u671f'] = '%.2f' % prize_half\n                masta_d[s_idx][u'POG\u671f\u9593\u8cde\u91d1_\u901a\u5e74'] = '%.2f' % prize_all\n        except:\n            pass\n\n    # make data frame\n    df = pd.DataFrame(masta_d).T\n    o_df = pd.DataFrame()\n\n    # sort columns\n    for prof in prof_keys:\n        o_df = pd.concat([o_df, df[prof]], axis=1)\n    o_df.index.name = 'Index'\n\n    o_fname = 'horse_prof_%d.csv' % year\n    o_fpath = os.path.join(o_dname, o_fname)\n    o_df.to_csv(o_fpath, encoding='utf-8')\n\ndef main():\n\n    year_l = [2010, 2011, 2012, 2013]\n    pool = mp.Pool(__PROC__)\n    pool.map(subMakeHorseDB, year_l)\n\nif __name__ == '__main__':\n    main()\n    raw_input('Press Enter to Exit\u00a5n')\n\n\n\n\n\u4eca\u5f8c\n\u5410\u304d\u51fa\u3055\u308c\u305fcsv\u30d5\u30a1\u30a4\u30eb\u3092\u3053\u306d\u304f\u308a\u56de\u3057\u3066POG\u5fc5\u52dd\u306e\u6cd5\u5247\u3092\u898b\u51fa\u3057\u305f\u3044\u3002\n#\u306f\u3058\u3081\u306b\n\u7af6\u99ac\u306b\u306fPOG\u3068\u3044\u3046\u904a\u3073\u304c\u3042\u308b\u3002\n\u3053\u308c\u306f\u67b6\u7a7a\u306e\u99ac\u4e3b\u3068\u306a\u3063\u3066\u6240\u6709\u99ac\u306e\u6d3b\u8e8d\u5ea6\u3092\u7af6\u3046\u3082\u306e\u3067\u3042\u308b\u3002\u4e00\u822c\u7684\u306b\u306f\u30c7\u30d3\u30e5\u30fc\u304b\u3089\u30c0\u30fc\u30d3\u30fc\u307e\u3067\u306e\u671f\u9593\u306e\u7372\u5f97\u8cde\u91d1\u3092\u6d3b\u8e8d\u5ea6\u306e\u6307\u6a19\u3068\u3059\u308b\u3053\u3068\u304c\u591a\u3044\u3002\n\n\u7b46\u8005\u306f\u304b\u308c\u3053\u308c5\u5e74\u307b\u3069POG\u3092\u7d9a\u3051\u3066\u3044\u308b\u3002\n\u3053\u308c\u307e\u3067\u306f\u3001\u6bce\u5e744\u6708\u9803\u306b\u306a\u308b\u3068\u767a\u58f2\u3055\u308c\u308b\u9752\u672c\u3092\u983c\u308a\u306b\u3001\u306a\u3093\u3068\u306a\u304f\u826f\u3055\u6c17\u306a\u99ac\u3092\u9078\u3093\u3067\u304d\u305f\u3002\n\n\u3057\u304b\u3057\u306a\u304c\u3089\u6210\u7e3e\u306f\u71e6\u3005\u305f\u308b\u3082\u306e\u3067\u4eca\u5e74\u306b\u81f3\u3063\u3066\u306f10\u982d\u4e2d\u307e\u30602\u982d\u3057\u304b\u52dd\u3061\u4e0a\u304c\u3063\u3066\u3044\u306a\u3044\u3002\n\n\u3053\u306e\u3046\u3060\u3064\u306e\u3042\u304c\u3089\u306a\u3044\u72b6\u6cc1\u3092\u6253\u7834\u3059\u3079\u304f\u3001\u30c7\u30fc\u30bf\u89e3\u6790\u306b\u672c\u8170\u3092\u5165\u308c\u308b\u4e8b\u306b\u3057\u305f\u3002\u305f\u3060\u3057\u7b46\u8005\u306b\u306f\u6700\u8fd1\u6d41\u884c\u308a\u306e\u6a5f\u68b0\u5b66\u7fd2\u3092\u81ea\u5728\u306b\u64cd\u308b\u307b\u3069\u306e\u30b9\u30ad\u30eb\u304c\u306a\u3044\u3002\u305d\u3053\u3067\u3001\u3053\u3053\u3067\u306f\u99ac\u306e\u57fa\u672c\u60c5\u5831\uff08\u53a9\u820e\u3001\u751f\u7523\u8005\u3001\u8840\u7d71\uff09\u3068POG\u671f\u9593\u4e2d\u306e\u7372\u5f97\u8cde\u91d1\u3068\u306e\u9593\u306b\u3042\u308b\u56e0\u679c\u95a2\u4fc2\u3092\u898b\u51fa\u3059\u3053\u3068\u3092\u5f53\u9762\u306e\u76ee\u6a19\u3068\u3057\u305f\u3044\u3002\n\n\u3053\u3053\u3067\u91cd\u8981\u306a\u306e\u304c\u300cPOG\u671f\u9593\u4e2d\u306e\u7372\u5f97\u8cde\u91d1\u300d\u3067\u3042\u308b\u3002\u7b46\u8005\u306e\u77e5\u308b\u9650\u308a\u3001\u3053\u306e\u60c5\u5831\u3092\u516c\u958b\u3057\u3066\u3044\u308bweb\u30b5\u30a4\u30c8\u306f\u5b58\u5728\u3057\u306a\u3044\u3002\u3082\u3057\u304b\u3057\u305f\u3089\u6709\u6599\u3067\u63d0\u4f9b\u3057\u3066\u3044\u308b\u6a5f\u95a2\u306f\u3042\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u304c\u3001\u8cbb\u7528\u306b\u898b\u5408\u3046\u52b9\u679c\u304c\u3042\u308b\u304b\u4e0d\u660e\u306a\u72b6\u6cc1\u3067\u306f\u624b\u3092\u51fa\u3057\u305f\u304f\u306a\u3044\u3002\n\n\u3088\u3063\u3066\u3001\u3053\u3053\u3067\u306fnetkeiba\u304b\u3089\u99ac\u306e\u57fa\u672c\u60c5\u5831\u3084\u51fa\u8d70\u6b74\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3001\u51fa\u8d70\u6b74\u30c7\u30fc\u30bf\u3092\u4f7f\u3063\u3066POG\u671f\u9593\u4e2d\u306e\u8cde\u91d1\u3092\u8a08\u7b97\u3059\u308b\u3000\u3068\u3044\u3046\u624b\u6bb5\u3092\u53d6\u308b\u3053\u3068\u3068\u3057\u305f\u3002\n\n\u307e\u305f\u3001\u4f7f\u7528\u3057\u305f\u8a00\u8a9e\u306fPython\u3067\u3042\u308b\u3002\u3053\u308c\u306f\u5358\u306b\u7b46\u8005\u304c\u4f7f\u3044\u6163\u308c\u3066\u3044\u308b\u3060\u3051\u3067\u3042\u308b\u3002\n\n#\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n2010\u5e74\u301c2013\u5e74\u307e\u3067\u306e4\u5e74\u9593\u306e\u9593\u306b\u751f\u307e\u308c\u305f\u99ac\u306e\u30c7\u30fc\u30bf\u3092\u53ce\u96c6\u3059\u308b\u3002\n\u3053\u3053\u3067\u306f4\u30b3\u30a2\u306e\u4e26\u5217\u51e6\u7406\u306b\u3088\u3063\u3066\u30014\u5e74\u5206\u306e\u30c7\u30fc\u30bf\u3092\u540c\u6642\u306b\u53d6\u5f97\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n~~\u30de\u30b7\u30f3\u30b9\u30da\u30c3\u30af\u306b\u3082\u3088\u308b\u3060\u308d\u3046\u304c\u3001\u7b46\u8005\u306eMBA\u3067\u306f\u7d041\u6642\u9593\u307b\u3069\u3067\u30c7\u30fc\u30bf\u3092\u53d6\u308a\u7d42\u3048\u305f\u3002~~\n\n\u203b2015/12/30\u7de8\u96c6\n\u30b5\u30fc\u30d0\u30a2\u30af\u30bb\u30b9\u51e6\u7406\u306e\u4e2d\u306b10\u79d2\u9593\u306e\u6642\u9593\u5f85\u3061\u95a2\u6570\u3092\u633f\u5165\u3057\u305f\u3002\n\u3053\u308c\u306a\u3089\u4eba\u529b\u3067\u30b5\u30a4\u30c8\u3092\u95b2\u89a7\u3059\u308b\u7a0b\u5ea6\u306e\u983b\u5ea6\u306b\u6291\u3048\u3089\u308c\u308b\u306e\u3067\u904e\u5ea6\u306a\u30a2\u30af\u30bb\u30b9\u306b\u306f\u306a\u3089\u306a\u3044\u3060\u308d\u3046\u3002\n\n```python:MakeUmaDB_151229.py\n#!/usr/bin/env python\n# encoding: utf-8\n\nimport urllib2 as ul\nimport pandas as pd\nimport os\nimport time\nimport datetime\nfrom lxml import html\nimport multiprocessing as mp\n\n__PROC__ = 4\n\ndef MakeDir(dname):\n    if not os.path.exists(dname):\n        os.mkdir(dname)\n        print 'Make directory:%s' % dname\n    else:\n        print '%s is exist' % dname\n\n    return 0\n\ndef subMakeHorseDB(year):\n    # Set Directory\n    o_dname = 'horse_db'\n    MakeDir(o_dname)\n\n    # horse_prof\n    prof_keys = [\n        u'\u99ac\u540d',\n        u'\u751f\u5e74\u6708\u65e5',\n        u'\u8abf\u6559\u5e2b',\n        u'\u99ac\u4e3b',\n        u'\u751f\u7523\u8005',\n        u'\u7523\u5730',\n        u'\u30bb\u30ea\u53d6\u5f15\u4fa1\u683c',\n        u'\u7236',\n        u'\u6bcd',\n        u'\u6bcd\u7236',\n        u'POG\u671f\u9593\u8cde\u91d1_\u534a\u671f',\n        u'POG\u671f\u9593\u8cde\u91d1_\u901a\u5e74'\n    ]\n\n    # get Uma data from web site\n    base_url = 'http://db.netkeiba.com/horse/'\n    idx_from = 100000\n    idx_to = 111000\n\n    masta_d = {}\n    for idx in range(idx_from, idx_to + 1):\n        try:\n            # get html from web\n            time.sleep(10)\n            s_idx = str(year)+str(idx).zfill(6)\n            url = base_url + s_idx\n            src_html = ul.urlopen(url).read()# get html from url\n            root = html.fromstring(src_html)\n\n            # show progress\n            print 'idx: %s, (%d, %d/%d)' % (s_idx, year, idx, idx_to)\n\n            # not found db\n            if root.xpath('//title')[0].text.startswith(u'\uff5c'):\n                #print 'DB not found'\n                continue\n\n            # html parse\n            masta_d[s_idx] = {}\n\n            for prof in prof_keys:\n                if prof == u'\u99ac\u540d':\n                    horse_name = root.xpath('//div[@class=\"horse_title\"]')[0].text_content().split('\\n')[1]\n                    masta_d[s_idx][prof] = horse_name\n\n                elif prof == u'\u7236':\n                    masta_d[s_idx][prof] = root.xpath('//td[@rowspan=\"2\"][@class=\"b_ml\"]')[0].text_content().split('\\n')[1]\n\n                elif prof == u'\u6bcd':\n                    masta_d[s_idx][prof] = root.xpath('//td[@rowspan=\"2\"][@class=\"b_fml\"]')[0].text_content().split('\\n')[1]\n                elif prof == u'\u6bcd\u7236':\n                    masta_d[s_idx][prof] = root.xpath('//td[@class=\"b_ml\"]')[2].text_content().split('\\n')[1]\n                elif prof == u'POG\u671f\u9593\u8cde\u91d1_\u534a\u671f' or prof == u'POG\u671f\u9593\u8cde\u91d1_\u901a\u5e74':\n                    continue\n                elif prof == u'\u751f\u5e74\u6708\u65e5':\n                    masta_d[s_idx][prof] = root.xpath('//table[@class=\"db_prof_table\"]/tr/td')[0].text_content()\n                elif prof == u'\u8abf\u6559\u5e2b':\n                    masta_d[s_idx][prof] = root.xpath('//table[@class=\"db_prof_table\"]/tr/td')[1].text_content()\n                elif prof == u'\u99ac\u4e3b':\n                    masta_d[s_idx][prof] = root.xpath('//table[@class=\"db_prof_table\"]/tr/td')[2].text_content()\n                elif prof == u'\u751f\u7523\u8005':\n                    masta_d[s_idx][prof] = root.xpath('//table[@class=\"db_prof_table\"]/tr/td')[3].text_content()\n                elif prof == u'\u7523\u5730':\n                    masta_d[s_idx][prof] = root.xpath('//table[@class=\"db_prof_table\"]/tr/td')[4].text_content()\n                elif prof == u'\u30bb\u30ea\u53d6\u5f15\u4fa1\u683c':\n                    masta_d[s_idx][prof] = root.xpath('//table[@class=\"db_prof_table\"]/tr/td')[5].text_content()\n\n            # calc POG prize\n            prize_all = 0.0\n            prize_half = 0.0\n            deadline_all = datetime.datetime.strptime('%d-07-01'%(year+3), '%Y-%m-%d')\n            deadline_half = datetime.datetime.strptime('%d-01-01'%(year+3), '%Y-%m-%d')\n\n            r_hist = root.xpath('//table[@class=\"db_h_race_results nk_tb_common\"]')\n            if len(r_hist) == 0:\n                masta_d[s_idx][u'POG\u671f\u9593\u8cde\u91d1_\u534a\u671f'] = '%d' % prize_half\n                masta_d[s_idx][u'POG\u671f\u9593\u8cde\u91d1_\u901a\u5e74'] = '%d' % prize_all\n            else:\n                r_hist_l = root.xpath('//table[@class=\"db_h_race_results nk_tb_common\"]/tbody/tr')\n                for race in r_hist_l:\n                    r_date = datetime.datetime.strptime(race.text_content().split('\\n')[1],'%Y/%m/%d')\n                    try:\n                        prize = float(race.text_content().split('\\n')[-2].replace(',',''))\n                    except:\n                        prize = 0.0\n\n                    if r_date < deadline_all:\n                        prize_all += prize\n                    if r_date < deadline_half:\n                        prize_half += prize\n\n                masta_d[s_idx][u'POG\u671f\u9593\u8cde\u91d1_\u534a\u671f'] = '%.2f' % prize_half\n                masta_d[s_idx][u'POG\u671f\u9593\u8cde\u91d1_\u901a\u5e74'] = '%.2f' % prize_all\n        except:\n            pass\n\n    # make data frame\n    df = pd.DataFrame(masta_d).T\n    o_df = pd.DataFrame()\n\n    # sort columns\n    for prof in prof_keys:\n        o_df = pd.concat([o_df, df[prof]], axis=1)\n    o_df.index.name = 'Index'\n\n    o_fname = 'horse_prof_%d.csv' % year\n    o_fpath = os.path.join(o_dname, o_fname)\n    o_df.to_csv(o_fpath, encoding='utf-8')\n\ndef main():\n\n    year_l = [2010, 2011, 2012, 2013]\n    pool = mp.Pool(__PROC__)\n    pool.map(subMakeHorseDB, year_l)\n\nif __name__ == '__main__':\n    main()\n    raw_input('Press Enter to Exit\u00a5n')\n\n```\n#\u4eca\u5f8c\n\u5410\u304d\u51fa\u3055\u308c\u305fcsv\u30d5\u30a1\u30a4\u30eb\u3092\u3053\u306d\u304f\u308a\u56de\u3057\u3066POG\u5fc5\u52dd\u306e\u6cd5\u5247\u3092\u898b\u51fa\u3057\u305f\u3044\u3002\n", "tags": ["Python", "\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0", "\u7af6\u99ac"]}