{"tags": ["serverspec", "Ruby"], "context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u8981\u4ef6\u5909\u66f4\u306b\u3088\u308a\u5927\u5e45\u306b\u8a2d\u5b9a\u5909\u66f4\u304c\u3042\u3063\u305f\u6642\u306b\u3001\u8a2d\u8a08\u66f8\u304b\u3089\u30ab\u30c3\u30c8\uff06\u30da\u30fc\u30b9\u3067\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3092\u4fee\u6b63\u3067\u304d\u306a\u3044\u304b\u8003\u3048\u3066\u307f\u307e\u3057\u305f\u3002\n\nhelper\u30e1\u30bd\u30c3\u30c9\n\u3042\u307e\u308a\u683c\u597d\u826f\u3044\u30bd\u30fc\u30b9\u3067\u306f\u306a\u3044\u3067\u3059\u304c\u30a8\u30b9\u30b1\u30fc\u30d7\u51e6\u7406\u3092\u65bd\u3059\u30e1\u30bd\u30c3\u30c9\u7b49\u3092\u7528\u610f\u3057\u307e\u3059\u3002\n\nC\uff1a\\serverspec\\sample\\lib\\CustomHelper.rb\nclass CustomHelper\n  @my_name       = 'CustomHelper'\n\n  def initialize()\n  end\n\n  def convCheckStr(arg = {})\n    arg['str']   = \"#{arg['str']}\".gsub(/\\\\/,\"__YEN__\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"\\\"\",\"__DQ__\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"(\",\"__PARENTHESES_S__\")\n    arg['str']   = \"#{arg['str']}\".gsub(\")\",\"__PARENTHESES_E__\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"{\",\"__BRACES_S__\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"}\",\"__BRACES_E__\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"[\",\"__BOX_BRACKETS_S__\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"]\",\"__BOX_BRACKETS_E__\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"|\",\"__PIPE__\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"?\",\"__HATENA__\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"-\",\"__MINUS__\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"+\",\"__PLUS__\")\n    if ! arg['blnIsUseRegex']\n      arg['str'] = \"#{arg['str']}\".gsub(\".\",\"__DOT__\")\n      arg['str'] = \"#{arg['str']}\".gsub(\"*\",\"__STAR__\")\n      arg['str'] = \"#{arg['str']}\".gsub(\"^\",\"__CARET__\")\n      arg['str'] = \"#{arg['str']}\".gsub(\"$\",\"__DOLLAR__\")\n    end\n    arg['str']   = \"#{arg['str']}\".gsub(\"__YEN____YEN__\",\"\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__YEN__\",\"\\\\\\\\\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__DQ__\",\"\\\\\\\"\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__PARENTHESES_S__\",\"\\\\(\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__PARENTHESES_E__\",\"\\\\)\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__BOX_BRACKETS_S__\",\"\\\\[\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__BOX_BRACKETS_E__\",\"\\\\]\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__BRACES_S__\",\"\\\\{\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__BRACES_E__\",\"\\\\}\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__PIPE__\",\"\\\\|\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__HATENA__\",\"\\\\?\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__MINUS__\",\"\\\\-\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__DOT__\",\"\\\\.\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__STAR__\",\"\\\\*\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__CARET__\",\"\\\\^\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__DOLLAR__\",\"\\\\$\")\n    if arg['blnIsUseRegex']\n      arg['str'] = \"#{arg['str']}\".gsub(\"__PLUS__\",\"+\")\n    else\n      arg['str'] = \"#{arg['str']}\".gsub(\"__PLUS__\",\"\\\\\\\\+\")\n    end\n    arg['str']   = \"#{arg['str']}\".gsub(/\\s+/,\"\\\\s+\")   if arg['blnIsIgnoreSpaces']\n    return arg['str']\n  end\nend\n\n\nspec\u30d5\u30a1\u30a4\u30eb\u3067\u306f\u30ed\u30b8\u30c3\u30af\u304b\u3089\u78ba\u8a8d\u3057\u305f\u3044\u5185\u5bb9\u3092\u5206\u96e2\u3057\u307e\u3059\u3002\nrequire 'spec_helper'\nrequire 'CustomHelper'\nobjHelper = CustomHelper.new\n\n# \u78ba\u8a8d\u5185\u5bb9\ntarget = \"C:\\\\serverspec\\\\test.cmd\"\nincludes = []\nincludes << \"\u3042\u3044\u3046\u3048\u304a\".encode(\"Windows-31J\")\nincludes << \"exit 0\"\nexcludes = []\nexcludes << \"\u304b\u304d\u304f\u3051\u3053\".encode(\"Windows-31J\")\nexcludes << \"exit 20\".encode(\"Windows-31J\")\n\n# \u30ed\u30b8\u30c3\u30af\ndescribe file(\"#{target}\") do\n  includes.each do |test_case|\n    test_case = objHelper.convCheckStr({\"str\" => \"#{test_case}\".strip, \"blnIsUseRegex\" => false, \"blnIsIgnoreSpaces\" => true})\n    its(:content) { should match /#{test_case}/ }\n  end\n  excludes.each do |test_case|\n    test_case = objHelper.convCheckStr({\"str\" => \"#{test_case}\".strip, \"blnIsUseRegex\" => false, \"blnIsIgnoreSpaces\" => true})\n    its(:content) { should_not match /#{test_case}/ }\n  end\nend\n\nPS C:\\serverspec\\sample> rake\n\n##################################################\nHOST: REMOTEHOST : development : winrm_client = 4\n##################################################\n\nFile \"C:\\serverspec\\test.cmd\"\n  content\n    should match /\u3042\u3044\u3046\u3048\u304a/\n  content\n    should match /exit\\s+0/\n  content\n    should not match /\u304b\u304d\u304f\u3051\u3053/\n  content\n    should not match /exit\\s+20/\n\nFinished in 1.62 seconds (files took 1.31 seconds to load)\n4 examples, 0 failures\n\nPS C:\\serverspec\\sample>\n\n\n\u307e\u3068\u3081\nincludes\u3001excludes\u3092\u5916\u90e8\u30d5\u30a1\u30a4\u30eb\uff08\u3068\u308a\u3042\u3048\u305aYAML\u3001\u3044\u305a\u308c\u306fExcel\uff09\u3078\u5206\u96e2\u3059\u308c\u3070\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u306e\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u304c\u697d\u306b\u306a\u308a\u305d\u3046\u3067\u3059\u3002\n# \u306f\u3058\u3081\u306b\n\n\u8981\u4ef6\u5909\u66f4\u306b\u3088\u308a\u5927\u5e45\u306b\u8a2d\u5b9a\u5909\u66f4\u304c\u3042\u3063\u305f\u6642\u306b\u3001\u8a2d\u8a08\u66f8\u304b\u3089\u30ab\u30c3\u30c8\uff06\u30da\u30fc\u30b9\u3067\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3092\u4fee\u6b63\u3067\u304d\u306a\u3044\u304b\u8003\u3048\u3066\u307f\u307e\u3057\u305f\u3002\n\n# helper\u30e1\u30bd\u30c3\u30c9\n\n\u3042\u307e\u308a\u683c\u597d\u826f\u3044\u30bd\u30fc\u30b9\u3067\u306f\u306a\u3044\u3067\u3059\u304c\u30a8\u30b9\u30b1\u30fc\u30d7\u51e6\u7406\u3092\u65bd\u3059\u30e1\u30bd\u30c3\u30c9\u7b49\u3092\u7528\u610f\u3057\u307e\u3059\u3002\n\n```ruby:C\uff1a\\serverspec\\sample\\lib\\CustomHelper.rb\nclass CustomHelper\n  @my_name       = 'CustomHelper'\n\n  def initialize()\n  end\n\n  def convCheckStr(arg = {})\n    arg['str']   = \"#{arg['str']}\".gsub(/\\\\/,\"__YEN__\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"\\\"\",\"__DQ__\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"(\",\"__PARENTHESES_S__\")\n    arg['str']   = \"#{arg['str']}\".gsub(\")\",\"__PARENTHESES_E__\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"{\",\"__BRACES_S__\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"}\",\"__BRACES_E__\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"[\",\"__BOX_BRACKETS_S__\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"]\",\"__BOX_BRACKETS_E__\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"|\",\"__PIPE__\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"?\",\"__HATENA__\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"-\",\"__MINUS__\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"+\",\"__PLUS__\")\n    if ! arg['blnIsUseRegex']\n      arg['str'] = \"#{arg['str']}\".gsub(\".\",\"__DOT__\")\n      arg['str'] = \"#{arg['str']}\".gsub(\"*\",\"__STAR__\")\n      arg['str'] = \"#{arg['str']}\".gsub(\"^\",\"__CARET__\")\n      arg['str'] = \"#{arg['str']}\".gsub(\"$\",\"__DOLLAR__\")\n    end\n    arg['str']   = \"#{arg['str']}\".gsub(\"__YEN____YEN__\",\"\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__YEN__\",\"\\\\\\\\\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__DQ__\",\"\\\\\\\"\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__PARENTHESES_S__\",\"\\\\(\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__PARENTHESES_E__\",\"\\\\)\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__BOX_BRACKETS_S__\",\"\\\\[\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__BOX_BRACKETS_E__\",\"\\\\]\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__BRACES_S__\",\"\\\\{\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__BRACES_E__\",\"\\\\}\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__PIPE__\",\"\\\\|\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__HATENA__\",\"\\\\?\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__MINUS__\",\"\\\\-\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__DOT__\",\"\\\\.\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__STAR__\",\"\\\\*\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__CARET__\",\"\\\\^\")\n    arg['str']   = \"#{arg['str']}\".gsub(\"__DOLLAR__\",\"\\\\$\")\n    if arg['blnIsUseRegex']\n      arg['str'] = \"#{arg['str']}\".gsub(\"__PLUS__\",\"+\")\n    else\n      arg['str'] = \"#{arg['str']}\".gsub(\"__PLUS__\",\"\\\\\\\\+\")\n    end\n    arg['str']   = \"#{arg['str']}\".gsub(/\\s+/,\"\\\\s+\")   if arg['blnIsIgnoreSpaces']\n    return arg['str']\n  end\nend\n```\n\nspec\u30d5\u30a1\u30a4\u30eb\u3067\u306f\u30ed\u30b8\u30c3\u30af\u304b\u3089\u78ba\u8a8d\u3057\u305f\u3044\u5185\u5bb9\u3092\u5206\u96e2\u3057\u307e\u3059\u3002\n\n```ruby\nrequire 'spec_helper'\nrequire 'CustomHelper'\nobjHelper = CustomHelper.new\n\n# \u78ba\u8a8d\u5185\u5bb9\ntarget = \"C:\\\\serverspec\\\\test.cmd\"\nincludes = []\nincludes << \"\u3042\u3044\u3046\u3048\u304a\".encode(\"Windows-31J\")\nincludes << \"exit 0\"\nexcludes = []\nexcludes << \"\u304b\u304d\u304f\u3051\u3053\".encode(\"Windows-31J\")\nexcludes << \"exit 20\".encode(\"Windows-31J\")\n\n# \u30ed\u30b8\u30c3\u30af\ndescribe file(\"#{target}\") do\n  includes.each do |test_case|\n    test_case = objHelper.convCheckStr({\"str\" => \"#{test_case}\".strip, \"blnIsUseRegex\" => false, \"blnIsIgnoreSpaces\" => true})\n    its(:content) { should match /#{test_case}/ }\n  end\n  excludes.each do |test_case|\n    test_case = objHelper.convCheckStr({\"str\" => \"#{test_case}\".strip, \"blnIsUseRegex\" => false, \"blnIsIgnoreSpaces\" => true})\n    its(:content) { should_not match /#{test_case}/ }\n  end\nend\n```\n\n```serverspec\nPS C:\\serverspec\\sample> rake\n\n##################################################\nHOST: REMOTEHOST : development : winrm_client = 4\n##################################################\n\nFile \"C:\\serverspec\\test.cmd\"\n  content\n    should match /\u3042\u3044\u3046\u3048\u304a/\n  content\n    should match /exit\\s+0/\n  content\n    should not match /\u304b\u304d\u304f\u3051\u3053/\n  content\n    should not match /exit\\s+20/\n\nFinished in 1.62 seconds (files took 1.31 seconds to load)\n4 examples, 0 failures\n\nPS C:\\serverspec\\sample>\n```\n\n# \u307e\u3068\u3081\n\nincludes\u3001excludes\u3092\u5916\u90e8\u30d5\u30a1\u30a4\u30eb\uff08\u3068\u308a\u3042\u3048\u305aYAML\u3001\u3044\u305a\u308c\u306fExcel\uff09\u3078\u5206\u96e2\u3059\u308c\u3070\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u306e\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u304c\u697d\u306b\u306a\u308a\u305d\u3046\u3067\u3059\u3002\n"}