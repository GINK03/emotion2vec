{"context": " More than 1 year has passed since last update.AWS\u306e\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u30c7\u30fc\u30bf\u30b9\u30c8\u30ea\u30fc\u30e0\u3068\u3044\u3048\u3070Kinesis\u3068\u3044\u3046\u3053\u3068\u306a\u306e\u3067\u3001Python\u306eAWS\u30e9\u30a4\u30d6\u30e9\u30eaboto\u3067\u3053\u308c\u3068\u3057\u3083\u3079\u3063\u3066\u307f\u308b\u3002\n\nboto-kinesis\n\n\u4f8b\u306b\u3088\u3063\u3066Docker\u3092\u4f7f\u3063\u3066\u307f\u308b\u3002\nDocker\u3067\u3042\u308b\u5fc5\u8981\u306f\u306a\u3044\u304c\u3001\u958b\u767a\u74b0\u5883\u3067\u30df\u30cb\u30de\u30e0\u306a\u624b\u9806\u307e\u3067\u8a66\u884c\u932f\u8aa4\u3059\u308b\u306e\u306b\u4fbf\u5229\u306a\u306e\u3067\u3001\u52c9\u5f37\u304c\u3066\u3089\u4f7f\u3063\u3066\u307f\u3066\u3044\u308b\u3002\n\nDockerfile\n\nDockerfile\nFROM centos:centos7\n\nRUN yum -y install epel-release\nRUN yum -y install python-boto\n\nRUN useradd -m aws\n\nCOPY files/* /home/aws/\nRUN chown -R aws:aws /home/aws/\n\nUSER aws\nENV HOME /home/aws/\nWORKDIR $HOME\n\n\n\nPython\u30e2\u30b8\u30e5\u30fc\u30eb\u7ba1\u7406\u306fpyenv\u3084virtualenv\u306a\u3069\u304c\u3088\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\npython-boto 2.34.0-4.el7\u3092\u542b\u3080\u65b0\u3057\u3044EPEL\u3092\u601d\u3044\u5207\u3063\u3066\u3068\u308a\u3053\u3093\u3060\u3002\n\nCentOS7\u306e\u6700\u65b0\u3067\u5165\u308bpython-boto 2.25.0-2.el7.centos\u3060\u3068\u3001\u306a\u305c\u304bKinesis\u306fnot found in endpoints\u3068\u3044\u308f\u308c\u3066\u3057\u307e\u3063\u305f(import\u306f\u3067\u304d\u308b)\n\n\n\n\n\u307b\u304b\u306e\u30d5\u30a1\u30a4\u30eb\n\u30b3\u30f3\u30c6\u30ca\u5185\u3067\u5fc5\u8981\u306b\u306a\u308b\u30d5\u30a1\u30a4\u30eb\u3092COPY\u3067\u30b3\u30f3\u30c6\u30ca\u5185\u306b\u30b3\u30d4\u30fc\u3059\u308b\u3002\n\n\u89e3\u51cd\u304c\u5fc5\u8981\u306a\u3089ADD\u306b\u306a\u308b\u304c\u3001\u305d\u3046\u3067\u306a\u3051\u308c\u3070COPY\u3067\u3002\n\u30dc\u30ea\u30e5\u30fc\u30e0\u306a\u3069\u3092\u4f7f\u3046\u307b\u3046\u304c\u3088\u3044\u304b\u3082\u3002\n\n$ tree -a\n.\n\u251c\u2500\u2500 Dockerfile\n\u2514\u2500\u2500 files\n    \u251c\u2500\u2500 .boto\n    \u2514\u2500\u2500 kinesis-sample.py\n\nIAM\u3067\u767a\u884c\u3057\u305f\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u3002\n\n.boto\n[Credentials]\naws_access_key_id     = YOUR-ACCESS-KEY-ID\naws_secret_access_key = YOUR-SECRET-ACCESS-KEY\n\n\nKinesis\u306b\u63a5\u7d9a\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u672c\u4f53\u3002\n\n\u30b9\u30c8\u30ea\u30fc\u30e0\u306b\u9069\u5f53\u306bput\u3057\u305f\u30c7\u30fc\u30bf\u309210\u79d2\u5f8c\u306bget\u3059\u308b\u3002\n\u9069\u5f53\u306a\u540d\u524d\u3092\u3064\u3051\u305f\u30b9\u30c8\u30ea\u30fc\u30e0\u3092API\u3082\u3057\u304f\u306fGUI\u3067\u5148\u306b\u4f5c\u3063\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n\nkinesis-sample.py\nfrom boto import kinesis\nimport time\n\nstream_name = 'iot'\n\nconn = kinesis.connect_to_region(region_name = \"ap-northeast-1\")\nshard = conn.put_record(\n  stream_name,\n  data = 'DATA',\n  partition_key = 'partition_key'\n)\ntime.sleep(10)\n\nshard_iterator = conn.get_shard_iterator(\n  stream_name,\n  shard_id                 = shard['ShardId'],\n  shard_iterator_type      = 'AT_SEQUENCE_NUMBER',\n  starting_sequence_number = shard['SequenceNumber']\n)['ShardIterator']\n\nprint conn.get_records(shard_iterator)['Records'][0]['Data']\n\n\n\n\u30b3\u30f3\u30c6\u30ca\u4f5c\u6210\ndocker attach\u3060\u3068\u540c\u4e00\u30b3\u30f3\u30c6\u30ca\u306b\u5bfe\u3057\u3066\u8907\u6570\u30bb\u30c3\u30b7\u30e7\u30f3(?)\u8cbc\u308c\u306a\u3044\u306e\u3067docker exec\u3092\u4f7f\u3046\u3002\n$ docker build .\n..\nSuccessfully built 4132428e3b84\n\n\n$ docker run -t -d -i 4132428e3b84 bash\n20be91d870f7ce4c0712954689981962af6e92f6aeb23efe1fe3acf31f3e6338\n$ docker exec -it 20be91d870f7ce4c0712954689981962af6e92f6aeb23efe1fe3acf31f3e6338 bash\n\n\n[aws@20be91d870f7 aws]$ ls -a\n.  ..  .bash_logout  .bash_profile  .bashrc  .boto  kinesis-sample.py\n\n\n\u52d5\u4f5c\u78ba\u8a8d\n[aws@20be91d870f7 aws]$ python kinesis-sample.py \nDATA\n\n\n\u3068\u308a\u3042\u3048\u305a\u3001put\u3057\u305f\u30ec\u30b3\u30fc\u30c9\u304c\u3068\u308c\u305f\u3002\n\nAWS\u306e\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u30c7\u30fc\u30bf\u30b9\u30c8\u30ea\u30fc\u30e0\u3068\u3044\u3048\u3070Kinesis\u3068\u3044\u3046\u3053\u3068\u306a\u306e\u3067\u3001Python\u306eAWS\u30e9\u30a4\u30d6\u30e9\u30ea`boto`\u3067\u3053\u308c\u3068\u3057\u3083\u3079\u3063\u3066\u307f\u308b\u3002\n\n- [`boto-kinesis`](http://boto.readthedocs.org/en/latest/ref/kinesis.html?highlight=kinesis#module-boto.kinesis)\n\n\n\u4f8b\u306b\u3088\u3063\u3066Docker\u3092\u4f7f\u3063\u3066\u307f\u308b\u3002\n\nDocker\u3067\u3042\u308b\u5fc5\u8981\u306f\u306a\u3044\u304c\u3001\u958b\u767a\u74b0\u5883\u3067\u30df\u30cb\u30de\u30e0\u306a\u624b\u9806\u307e\u3067\u8a66\u884c\u932f\u8aa4\u3059\u308b\u306e\u306b\u4fbf\u5229\u306a\u306e\u3067\u3001\u52c9\u5f37\u304c\u3066\u3089\u4f7f\u3063\u3066\u307f\u3066\u3044\u308b\u3002\n\n\n\n### Dockerfile\n\n```Dockerfile:Dockerfile\nFROM centos:centos7\n\nRUN yum -y install epel-release\nRUN yum -y install python-boto\n\nRUN useradd -m aws\n\nCOPY files/* /home/aws/\nRUN chown -R aws:aws /home/aws/\n\nUSER aws\nENV HOME /home/aws/\nWORKDIR $HOME\n```\n\n- Python\u30e2\u30b8\u30e5\u30fc\u30eb\u7ba1\u7406\u306f`pyenv`\u3084`virtualenv`\u306a\u3069\u304c\u3088\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\n- `python-boto 2.34.0-4.el7`\u3092\u542b\u3080\u65b0\u3057\u3044EPEL\u3092\u601d\u3044\u5207\u3063\u3066\u3068\u308a\u3053\u3093\u3060\u3002\n - CentOS7\u306e\u6700\u65b0\u3067\u5165\u308b`python-boto 2.25.0-2.el7.centos`\u3060\u3068\u3001\u306a\u305c\u304bKinesis\u306f`not found in endpoints`\u3068\u3044\u308f\u308c\u3066\u3057\u307e\u3063\u305f(import\u306f\u3067\u304d\u308b)\n\n### \u307b\u304b\u306e\u30d5\u30a1\u30a4\u30eb\n\u30b3\u30f3\u30c6\u30ca\u5185\u3067\u5fc5\u8981\u306b\u306a\u308b\u30d5\u30a1\u30a4\u30eb\u3092`COPY`\u3067\u30b3\u30f3\u30c6\u30ca\u5185\u306b\u30b3\u30d4\u30fc\u3059\u308b\u3002\n\n- \u89e3\u51cd\u304c\u5fc5\u8981\u306a\u3089`ADD`\u306b\u306a\u308b\u304c\u3001\u305d\u3046\u3067\u306a\u3051\u308c\u3070`COPY`\u3067\u3002\n- \u30dc\u30ea\u30e5\u30fc\u30e0\u306a\u3069\u3092\u4f7f\u3046\u307b\u3046\u304c\u3088\u3044\u304b\u3082\u3002\n\n```console:\n$ tree -a\n.\n\u251c\u2500\u2500 Dockerfile\n\u2514\u2500\u2500 files\n    \u251c\u2500\u2500 .boto\n    \u2514\u2500\u2500 kinesis-sample.py\n```\n\n IAM\u3067\u767a\u884c\u3057\u305f\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u3002\n\n```python:.boto\n[Credentials]\naws_access_key_id     = YOUR-ACCESS-KEY-ID\naws_secret_access_key = YOUR-SECRET-ACCESS-KEY\n```\n\nKinesis\u306b\u63a5\u7d9a\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u672c\u4f53\u3002\n\n- \u30b9\u30c8\u30ea\u30fc\u30e0\u306b\u9069\u5f53\u306bput\u3057\u305f\u30c7\u30fc\u30bf\u309210\u79d2\u5f8c\u306bget\u3059\u308b\u3002\n- \u9069\u5f53\u306a\u540d\u524d\u3092\u3064\u3051\u305f\u30b9\u30c8\u30ea\u30fc\u30e0\u3092API\u3082\u3057\u304f\u306fGUI\u3067\u5148\u306b\u4f5c\u3063\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n```python:kinesis-sample.py\nfrom boto import kinesis\nimport time\n\nstream_name = 'iot'\n\nconn = kinesis.connect_to_region(region_name = \"ap-northeast-1\")\nshard = conn.put_record(\n  stream_name,\n  data = 'DATA',\n  partition_key = 'partition_key'\n)\ntime.sleep(10)\n\nshard_iterator = conn.get_shard_iterator(\n  stream_name,\n  shard_id                 = shard['ShardId'],\n  shard_iterator_type      = 'AT_SEQUENCE_NUMBER',\n  starting_sequence_number = shard['SequenceNumber']\n)['ShardIterator']\n\nprint conn.get_records(shard_iterator)['Records'][0]['Data']\n```\n\n\n\n### \u30b3\u30f3\u30c6\u30ca\u4f5c\u6210\n`docker attach`\u3060\u3068\u540c\u4e00\u30b3\u30f3\u30c6\u30ca\u306b\u5bfe\u3057\u3066\u8907\u6570\u30bb\u30c3\u30b7\u30e7\u30f3(?)\u8cbc\u308c\u306a\u3044\u306e\u3067`docker exec`\u3092\u4f7f\u3046\u3002\n\n\n```console:\n$ docker build .\n..\nSuccessfully built 4132428e3b84\n\n\n$ docker run -t -d -i 4132428e3b84 bash\n20be91d870f7ce4c0712954689981962af6e92f6aeb23efe1fe3acf31f3e6338\n$ docker exec -it 20be91d870f7ce4c0712954689981962af6e92f6aeb23efe1fe3acf31f3e6338 bash\n\n\n[aws@20be91d870f7 aws]$ ls -a\n.  ..  .bash_logout  .bash_profile  .bashrc  .boto  kinesis-sample.py\n```\n\n### \u52d5\u4f5c\u78ba\u8a8d\n\n```console:\n[aws@20be91d870f7 aws]$ python kinesis-sample.py \nDATA\n\n```\n\n\u3068\u308a\u3042\u3048\u305a\u3001put\u3057\u305f\u30ec\u30b3\u30fc\u30c9\u304c\u3068\u308c\u305f\u3002\n", "tags": ["boto2.34", "Kinesis", "dockerfile", "AWS"]}