{"tags": ["Linux", "Nagios"], "context": " More than 1 year has passed since last update.\u3053\u3093\u306a\u611f\u3058\u3067\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002\n\u30c7\u30d7\u30ed\u30a4\u65b9\u6cd5\u306f\u3053\u3061\u3089\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\n#!/bin/bash -e\n##-------------------------------------------------------------------\n## File: check_memory_procs\n## Author : Yutaka Hiroyama\n## Description :\n## --\n##\n## Created : <2015-08-05>\n## Updated: Time-stamp: \n##-------------------------------------------------------------------\nif [ \"$1\" = \"-w\" ] && [ \"$2\" -gt \"0\" ] && \\\n    [ \"$3\" = \"-c\" ] && [ \"$4\" -gt \"0\" ]; then\n\n    procpattern=${5}\n\n    total=`grep \"MemTotal\" /proc/meminfo | awk  -F' ' '{print $2}'`\n    memVmSize=`ps aux | grep \"$procpattern\" | grep -v grep | grep -v check_proc_mem.sh | awk '{sum += $6} END {print sum}'`\n    per=$((($memVmSize*100)/$total))\n\n    memVmSize=$(($memVmSize/1024))\n\n    if [ \"$per\" -ge \"$4\" ]; then\n        echo \"Memory: CRITICAL - $procpattern using $memVmSize MB ($per %)\"\n        $(exit 2)\n    elif [ \"$per\" -ge \"$2\" ]; then\n        echo \"Memory: WARNING - $procpattern using $memVmSize MB ($per %)\"\n        $(exit 1)\n    else\n        echo \"Memory: OK - $procpattern using $memVmSize MB ($per %)\"\n        $(exit 0)\n    fi\n\nelse\n    echo \"check_memory_procs v1.0\"\n    echo \"\"\n    echo \"Usage:\"\n    echo \"check_memory_procs -w <warn_%> -c <criti_%> <pattern_proc>\"\n    echo \"\"\n    echo \"Copyright (C) 2015 Yutaka Hiroyama\"\n    exit\nfi\n\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u30c7\u30d7\u30ed\u30a4\u65b9\u6cd5\u306f[\u3053\u3061\u3089](http://qiita.com/Hiroyama-Yutaka/items/880ee506f185441a7e85)\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\n\n\n```check_memory_procs\n#!/bin/bash -e\n##-------------------------------------------------------------------\n## File: check_memory_procs\n## Author : Yutaka Hiroyama\n## Description :\n## --\n##\n## Created : <2015-08-05>\n## Updated: Time-stamp: \n##-------------------------------------------------------------------\nif [ \"$1\" = \"-w\" ] && [ \"$2\" -gt \"0\" ] && \\\n    [ \"$3\" = \"-c\" ] && [ \"$4\" -gt \"0\" ]; then\n\n    procpattern=${5}\n\n    total=`grep \"MemTotal\" /proc/meminfo | awk  -F' ' '{print $2}'`\n    memVmSize=`ps aux | grep \"$procpattern\" | grep -v grep | grep -v check_proc_mem.sh | awk '{sum += $6} END {print sum}'`\n    per=$((($memVmSize*100)/$total))\n\n    memVmSize=$(($memVmSize/1024))\n\n    if [ \"$per\" -ge \"$4\" ]; then\n        echo \"Memory: CRITICAL - $procpattern using $memVmSize MB ($per %)\"\n        $(exit 2)\n    elif [ \"$per\" -ge \"$2\" ]; then\n        echo \"Memory: WARNING - $procpattern using $memVmSize MB ($per %)\"\n        $(exit 1)\n    else\n        echo \"Memory: OK - $procpattern using $memVmSize MB ($per %)\"\n        $(exit 0)\n    fi\n\nelse\n    echo \"check_memory_procs v1.0\"\n    echo \"\"\n    echo \"Usage:\"\n    echo \"check_memory_procs -w <warn_%> -c <criti_%> <pattern_proc>\"\n    echo \"\"\n    echo \"Copyright (C) 2015 Yutaka Hiroyama\"\n    exit\nfi\n```\n\n"}