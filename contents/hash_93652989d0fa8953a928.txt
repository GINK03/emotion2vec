{"context": " More than 1 year has passed since last update.ref: How To: Redirect to a specific page when the user can not be authenticated \u00b7 plataformatec/devise Wiki\nDevise::FailureApp\u3092\u7d99\u627f\u3057\u305fCustomFailure\u3092\u4f5c\u6210, respond\u30e1\u30bd\u30c3\u30c9\u3092\u66f8\u304d\u63db\u3048\u3066content type\u304capplication/json\u3060\u3063\u305f\u3089json\u8fd4\u3059\u3088\u3046\u306b\u3057\u305f. \u30b3\u30ec\u81ea\u4f53\u304cRack app\u306a\u306e\u304b, self.status = 401, \u3068\u3044\u3046\u66f8\u304d\u63db\u3048\u65b9\u3067\u9762\u767d\u3044. body\u306f\u3068\u308a\u3042\u3048\u305a\u3068\u3044\u3046\u611f\u3058.\n\nlib/custom_failure.rb\nclass CustomFailure < Devise::FailureApp\n  def respond\n    if http_auth?\n      http_auth\n    # \u3053\u3053\u306eelsif\u53e5\u3092\u8ffd\u52a0\n    elsif request.content_type == \"application/json\"\n      self.status = 401\n      self.content_type = \"application/json\"\n      self.response_body = {success: false, error: \"Unauthorized\"}.to_json\n    else\n      redirect\n    end\n  end\nend\n\n\n\u3042\u3068lib\u306e\u8aad\u307f\u8fbc\u307f\u9806\u3092\u5148\u306b\u3057\u3066,\n\nconfig/application.rb\nconfig.autoload_paths += %W(#{config.root}/lib)\n\n\ndevise\u306e\u8a2d\u5b9a\u306b\u52a0\u3048\u308c\u3070ok\n\nconfig/initializers/devise.rb\n  config.warden do |manager|\n    manager.failure_app = CustomFailure\n  end\n\n\n\nref: [How To: Redirect to a specific page when the user can not be authenticated \u00b7 plataformatec/devise Wiki](https://github.com/plataformatec/devise/wiki/How-To:-Redirect-to-a-specific-page-when-the-user-can-not-be-authenticated)\n\n`Devise::FailureApp`\u3092\u7d99\u627f\u3057\u305f`CustomFailure`\u3092\u4f5c\u6210, respond\u30e1\u30bd\u30c3\u30c9\u3092\u66f8\u304d\u63db\u3048\u3066content type\u304capplication/json\u3060\u3063\u305f\u3089json\u8fd4\u3059\u3088\u3046\u306b\u3057\u305f. \u30b3\u30ec\u81ea\u4f53\u304cRack app\u306a\u306e\u304b, self.status = 401, \u3068\u3044\u3046\u66f8\u304d\u63db\u3048\u65b9\u3067\u9762\u767d\u3044. body\u306f\u3068\u308a\u3042\u3048\u305a\u3068\u3044\u3046\u611f\u3058.\n\n```ruby:lib/custom_failure.rb\nclass CustomFailure < Devise::FailureApp\n  def respond\n    if http_auth?\n      http_auth\n    # \u3053\u3053\u306eelsif\u53e5\u3092\u8ffd\u52a0\n    elsif request.content_type == \"application/json\"\n      self.status = 401\n      self.content_type = \"application/json\"\n      self.response_body = {success: false, error: \"Unauthorized\"}.to_json\n    else\n      redirect\n    end\n  end\nend\n```\n\n\u3042\u3068lib\u306e\u8aad\u307f\u8fbc\u307f\u9806\u3092\u5148\u306b\u3057\u3066,\n\n```ruby:config/application.rb\nconfig.autoload_paths += %W(#{config.root}/lib)\n```\n\ndevise\u306e\u8a2d\u5b9a\u306b\u52a0\u3048\u308c\u3070ok\n\n```ruby:config/initializers/devise.rb\n  config.warden do |manager|\n    manager.failure_app = CustomFailure\n  end\n```\n", "tags": ["Rails", "devise", "api"]}