{"context": " More than 1 year has passed since last update.\n\n\u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u304b\u30891\u5e74\u4ee5\u4e0a\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002 \u6c17\u3092\u3064\u3051\u3066\u306d\u3002\n\n\u30d7\u30ed\u30bb\u30b9\u306e\u6b7b\u6d3b\u76e3\u8996\u306f\u591a\u304f\u304cpolling\u30d9\u30fc\u30b9\u3067\u52d5\u4f5c\u3059\u308b\u3001monit\u306e\u3088\u3046\u306b\u25cb\u5206\u304a\u304d\u306b\u30c1\u30a7\u30c3\u30af\u3068\u304b\u3002\nrubygems\u306e\u30d7\u30ed\u30bb\u30b9\u76e3\u8996\u30c7\u30fc\u30e2\u30f3\u3001god\u306f\u5bfe\u8c61\u30d7\u30ed\u30bb\u30b9\u306e\u72b6\u614b\u5909\u5316\u3092\u30a4\u30d9\u30f3\u30c8\u30b7\u30b9\u30c6\u30e0\u3067\u8ffd\u3046\u3084\u308a\u65b9\u3092\u63d0\u4f9b\u3057\u3066\u3044\u308b\u3002\n\ngod\u304c\u30a4\u30d9\u30f3\u30c8\u30b7\u30b9\u30c6\u30e0\u5bfe\u5fdc\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\n$ god check\nusing event system: netlink\n-- snip --\n\nevent system\u304cnone\u3067\u306a\u3051\u308c\u3070\u4f7f\u3048\u308b\u3002\n\n\u30b5\u30f3\u30d7\u30eb\u306e\u76e3\u8996\u5bfe\u8c61\u30d7\u30ed\u30bb\u30b9\u3092\u7528\u610f\u3059\u308b\n\u5358\u7d14\u306b\u7d42\u308f\u3089\u306a\u3044\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u7528\u610f\u3002\n\nsample.rb\n#!/usr/bin/env ruby\nloop do\n  puts 'Hello'\n  sleep 10\nend\n\n\n\ngod\u306e\u30b3\u30f3\u30d5\u30a3\u30b0\n\u76e3\u8996\u5bfe\u8c61\u3092\u8d77\u52d5\u3057\u3064\u3064\u3001process_exits\u3092\u691c\u77e5\u3057\u305f\u3089start\u3092\u5b9f\u884c\u3057\u3066up\u72b6\u614b\u3092\u4fdd\u3066\u3068\u3044\u3046\u8a2d\u5b9a\u3002\n\ngod.conf\nGod.watch do |w|\n  w.name = \"sample\"\n  w.start = \"/root/sandbox/god/sample.rb\"\n  w.keepalive\n\n  # \u72b6\u614b\u76e3\u8996\u306e\u30b8\u30e7\u30d6\n  w.transition(:up, :start) do |on|\n    on.condition(:process_exits)\n  end\nend\n\n\n\ngod\u304c\u691c\u77e5\u3059\u308b\u69d8\u5b50\n\u773a\u3081\u308b\u305f\u3081\u306b\u30d5\u30a9\u30a2\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u8d77\u52d5\u3002\n# god -D -c god.conf\nI [2012-08-09 20:03:36]  INFO: Loading god.conf\nI [2012-08-09 20:03:36]  INFO: Syslog enabled.\nI [2012-08-09 20:03:36]  INFO: Using pid file directory: /var/run/god\nI [2012-08-09 20:03:36]  INFO: Started on drbunix:///tmp/god.17165.sock\nI [2012-08-09 20:03:36]  INFO: sample move 'unmonitored' to 'init'\nI [2012-08-09 20:03:36]  INFO: sample moved 'unmonitored' to 'init'\nI [2012-08-09 20:03:36]  INFO: sample [trigger] process is running (ProcessRunning)\nI [2012-08-09 20:03:36]  INFO: sample move 'init' to 'up'\nI [2012-08-09 20:03:36]  INFO: sample registered 'proc_exit' event for pid 21539\nI [2012-08-09 20:03:36]  INFO: sample registered 'proc_exit' event for pid 21539\nI [2012-08-09 20:03:36]  INFO: sample moved 'init' to 'up'\n\n\u5148\u307b\u3069\u306e\u30d7\u30ed\u30bb\u30b9\u3092kill\u3002\n# date && kill 21539\nWed Aug  9 20:05:21 PDT 2012\n\ngod\u306fprocess\u306eexit\u3092\u691c\u77e5\u3057\u3066\u3001\u30b3\u30f3\u30c7\u30a3\u30b7\u30e7\u30f3\u3092start\u306b\u5909\u66f4\u3059\u308b\u3002\n[2012-08-09 20:05:21]  INFO: sample [trigger] process 21539 exited {:pid=>21539, :exit_code=>15, :exit_signal=>17, :thread_group_id=>21539} (ProcessExits)\nI [2012-08-09 20:05:21]  INFO: sample move 'up' to 'start'\nI [2012-08-09 20:05:21]  INFO: sample deregistered 'proc_exit' event for pid 21539\nI [2012-08-09 20:05:21]  INFO: sample deregistered 'proc_exit' event for pid 21539\nI [2012-08-09 20:05:21]  INFO: sample start: /root/sandbox/god/sample.rb\nI [2012-08-09 20:05:21]  INFO: sample moved 'up' to 'start'\nI [2012-08-09 20:05:21]  INFO: sample [trigger] process is running (ProcessRunning)\nI [2012-08-09 20:05:21]  INFO: sample move 'start' to 'up'\nI [2012-08-09 20:05:21]  INFO: sample registered 'proc_exit' event for pid 22979\nI [2012-08-09 20:05:21]  INFO: sample registered 'proc_exit' event for pid 22979\nI [2012-08-09 20:05:21]  INFO: sample moved 'start' to 'up'\n\n\u30d7\u30ed\u30bb\u30b9\u306e\u7d42\u4e86\u304b\u3089\u518d\u958b\u307e\u3067\u306f\u4e00\u79d2\u672a\u6e80\u3001polling\u3067\u306f\u30a4\u30f3\u30bf\u30fc\u30d0\u30eb\u5206\u306e\u30ea\u30fc\u30c9\u30bf\u30a4\u30e0\u304c\u3042\u308b\u306e\u3067\u3001\u72b6\u6cc1\u306b\u3088\u3063\u3066\u4f7f\u3044\u5206\u3051\u304c\u3067\u304d\u308b\u3002\n<!-- too_old -->\n> **\u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u304b\u30891\u5e74\u4ee5\u4e0a\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002** \u6c17\u3092\u3064\u3051\u3066\u306d\u3002\n\n\n\u30d7\u30ed\u30bb\u30b9\u306e\u6b7b\u6d3b\u76e3\u8996\u306f\u591a\u304f\u304cpolling\u30d9\u30fc\u30b9\u3067\u52d5\u4f5c\u3059\u308b\u3001monit\u306e\u3088\u3046\u306b\u25cb\u5206\u304a\u304d\u306b\u30c1\u30a7\u30c3\u30af\u3068\u304b\u3002\n\nrubygems\u306e\u30d7\u30ed\u30bb\u30b9\u76e3\u8996\u30c7\u30fc\u30e2\u30f3\u3001[god](http://godrb.com/)\u306f\u5bfe\u8c61\u30d7\u30ed\u30bb\u30b9\u306e\u72b6\u614b\u5909\u5316\u3092\u30a4\u30d9\u30f3\u30c8\u30b7\u30b9\u30c6\u30e0\u3067\u8ffd\u3046\u3084\u308a\u65b9\u3092\u63d0\u4f9b\u3057\u3066\u3044\u308b\u3002\n\n## god\u304c\u30a4\u30d9\u30f3\u30c8\u30b7\u30b9\u30c6\u30e0\u5bfe\u5fdc\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\n\n```\n$ god check\nusing event system: netlink\n-- snip --\n```\n\n`event system`\u304c`none`\u3067\u306a\u3051\u308c\u3070\u4f7f\u3048\u308b\u3002\n\n\n## \u30b5\u30f3\u30d7\u30eb\u306e\u76e3\u8996\u5bfe\u8c61\u30d7\u30ed\u30bb\u30b9\u3092\u7528\u610f\u3059\u308b\n\n\u5358\u7d14\u306b\u7d42\u308f\u3089\u306a\u3044\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u7528\u610f\u3002\n\n```ruby:sample.rb \n#!/usr/bin/env ruby\nloop do\n  puts 'Hello'\n  sleep 10\nend\n```\n\n\n## god\u306e\u30b3\u30f3\u30d5\u30a3\u30b0\n\n\u76e3\u8996\u5bfe\u8c61\u3092\u8d77\u52d5\u3057\u3064\u3064\u3001`process_exits`\u3092\u691c\u77e5\u3057\u305f\u3089start\u3092\u5b9f\u884c\u3057\u3066up\u72b6\u614b\u3092\u4fdd\u3066\u3068\u3044\u3046\u8a2d\u5b9a\u3002\n\n```ruby:god.conf \nGod.watch do |w|\n  w.name = \"sample\"\n  w.start = \"/root/sandbox/god/sample.rb\"\n  w.keepalive\n\n  # \u72b6\u614b\u76e3\u8996\u306e\u30b8\u30e7\u30d6\n  w.transition(:up, :start) do |on|\n    on.condition(:process_exits)\n  end\nend\n```\n\n\n\n## god\u304c\u691c\u77e5\u3059\u308b\u69d8\u5b50\n\n\u773a\u3081\u308b\u305f\u3081\u306b\u30d5\u30a9\u30a2\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u8d77\u52d5\u3002\n\n```\n# god -D -c god.conf\nI [2012-08-09 20:03:36]  INFO: Loading god.conf\nI [2012-08-09 20:03:36]  INFO: Syslog enabled.\nI [2012-08-09 20:03:36]  INFO: Using pid file directory: /var/run/god\nI [2012-08-09 20:03:36]  INFO: Started on drbunix:///tmp/god.17165.sock\nI [2012-08-09 20:03:36]  INFO: sample move 'unmonitored' to 'init'\nI [2012-08-09 20:03:36]  INFO: sample moved 'unmonitored' to 'init'\nI [2012-08-09 20:03:36]  INFO: sample [trigger] process is running (ProcessRunning)\nI [2012-08-09 20:03:36]  INFO: sample move 'init' to 'up'\nI [2012-08-09 20:03:36]  INFO: sample registered 'proc_exit' event for pid 21539\nI [2012-08-09 20:03:36]  INFO: sample registered 'proc_exit' event for pid 21539\nI [2012-08-09 20:03:36]  INFO: sample moved 'init' to 'up'\n```\n\n\u5148\u307b\u3069\u306e\u30d7\u30ed\u30bb\u30b9\u3092kill\u3002\n\n```\n# date && kill 21539\nWed Aug  9 20:05:21 PDT 2012\n```\n\ngod\u306fprocess\u306eexit\u3092\u691c\u77e5\u3057\u3066\u3001\u30b3\u30f3\u30c7\u30a3\u30b7\u30e7\u30f3\u3092start\u306b\u5909\u66f4\u3059\u308b\u3002\n\n```\n[2012-08-09 20:05:21]  INFO: sample [trigger] process 21539 exited {:pid=>21539, :exit_code=>15, :exit_signal=>17, :thread_group_id=>21539} (ProcessExits)\nI [2012-08-09 20:05:21]  INFO: sample move 'up' to 'start'\nI [2012-08-09 20:05:21]  INFO: sample deregistered 'proc_exit' event for pid 21539\nI [2012-08-09 20:05:21]  INFO: sample deregistered 'proc_exit' event for pid 21539\nI [2012-08-09 20:05:21]  INFO: sample start: /root/sandbox/god/sample.rb\nI [2012-08-09 20:05:21]  INFO: sample moved 'up' to 'start'\nI [2012-08-09 20:05:21]  INFO: sample [trigger] process is running (ProcessRunning)\nI [2012-08-09 20:05:21]  INFO: sample move 'start' to 'up'\nI [2012-08-09 20:05:21]  INFO: sample registered 'proc_exit' event for pid 22979\nI [2012-08-09 20:05:21]  INFO: sample registered 'proc_exit' event for pid 22979\nI [2012-08-09 20:05:21]  INFO: sample moved 'start' to 'up'\n```\n\n\n\u30d7\u30ed\u30bb\u30b9\u306e\u7d42\u4e86\u304b\u3089\u518d\u958b\u307e\u3067\u306f\u4e00\u79d2\u672a\u6e80\u3001polling\u3067\u306f\u30a4\u30f3\u30bf\u30fc\u30d0\u30eb\u5206\u306e\u30ea\u30fc\u30c9\u30bf\u30a4\u30e0\u304c\u3042\u308b\u306e\u3067\u3001\u72b6\u6cc1\u306b\u3088\u3063\u3066\u4f7f\u3044\u5206\u3051\u304c\u3067\u304d\u308b\u3002\n\n", "tags": ["operation", "monitoring", "Ruby"]}