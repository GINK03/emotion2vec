{"context": " More than 1 year has passed since last update.\n\n\u308d\u30fc\u3061\u3083\u3093\u3068\u3089\u305a\u3071\u3044\u3082\u304d\u3085\u3082\u304d\u3085\u301c\u301c\u301c\u301c\u301c\u301c\n\nBLE 6LoWPAN\u3067MQTT\u306ePublisher/Subscriber\u3092\u5b9f\u969b\u306b\u52d5\u304b\u3059\u3068\u3001\u52d5\u753b\u7528\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u7247\u3063\u307d\u306eTY51822r3\u306e\u30dc\u30bf\u30f3\uff08\u30bf\u30af\u30c8\u30b9\u30a4\u30c3\u30c1\u3067\u4ee3\u7528\uff09\u3092\u62bc\u3059\u3068\u3001\u96a3\u306eTY51822r3\u306eLED\u304cON / OFF\u3057\u307e\u3059\u3002\n\u52d5\u753b\u306b\u306f\u6620\u3063\u3066\u3044\u307e\u305b\u3093\u304c\u3001MQTT Broker\u306fRaspberry pi\u304c\u62c5\u3063\u3066\u3044\u307e\u3059\u3002\nMQTT Broker\u306fRaspberry pi / mosquitto\u4f7f\u3044\u307e\u3059\u3002\nMQTT Pub / Sub \u306f nRF51 IoT SDK\u3067\u3001\u306b\u3085\u30fc\u3064\u307c\u3079\u3063\u3069(mbed TY51822r3)\uff12\u53f0\u306b\u9811\u5f35\u3063\u3066\u3082\u3089\u3044\u307e\u3057\u305f\u3002\n\u3053\u308c\u3092\u9811\u5f35\u308b\u3068\u3001\u3054\u8912\u7f8e\u306b\u308d\u30fc\u3061\u3083\u3093\u3068\u4e00\u7dd2\u306b\u3089\u305a\u3079\u308a\u30fc\u3071\u3044\u3092\u30e2\u30ad\u30e5\u3063\u3068\u98df\u3079\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\uff01\n\u7f8e\u5473\u3057\u3044\u3067\u3059\uff01\n\nnRF51 IoT SDK\n\nhttp://developer.nordicsemi.com\n\u304b\u3089nRF51 IoT SDK\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066zip\u3092\u89e3\u51cd\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\nhttps://www.keil.com/\nKeil ARM-MDK\u3082\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3059\u3002\n\u307e\u3041\u3001\u30d3\u30eb\u30c9\u3059\u308b\u3068\u5206\u304b\u308b\u306e\u3067\u3059\u304c\u30fb\u30fb\u30fb\u30fb\u4eca\u56de\u306f32KB\u5236\u9650\u3092\u5927\u304d\u304f\u8d85\u3048\u3066\u3057\u307e\u3046\u306e\u3067\u3001Keil ARM-MDK\u3067\u30d3\u30eb\u30c9\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u305b\u3093\u3002\n\u3088\u3063\u3066\u3001ARM-GCC\u3068GNU Make for Windows\u306e\u304a\u4e16\u8a71\u306b\u306a\u308a\u307e\u3059\u3002\nhttp://gnuwin32.sourceforge.net/packages/make.htm\n\n\u8aad\u3093\u3067\u304a\u304f\u8cc7\u6599\nnRF51 IoT SDK\nIoT_SDK_step_by_step.pdf\n\u3053\u306e\uff12\u3064\u306f\u5fc5\u8aad\u3067\u3059\u3002\u8aad\u3093\u3067\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\nmbed TY51822r3\u306f\u5916\u90e8\u30af\u30ea\u30b9\u30bf\u30eb\u304c32MHz\u3067\u3042\u308b\u70b9\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u3010mbed TY51822 \u3067 MQTT Subscribe\u3011\u306e\u8a18\u4e8b\u306b\u4e00\u901a\u308a\u307e\u3068\u3081\u307e\u3057\u305f\u3002\nPublisher\u3082\u540c\u69d8\u306e\u5909\u66f4\u304c\u5fc5\u8981\u3067\u3059\u3002\n\u3053\u3053\u898b\u305a\u306b\u52d5\u304b\u3093\u301c\u301c\u301c\u3063\u3066\u8a00\u308f\u308c\u3066\u3082\u77e5\u3089\u3093\u3067\u3059\u3088\u30fc\u3002\n\u4eca\u56de\u3001Publisher / Subscriber \u305d\u308c\u305e\u308c\u306b\u7e4b\u3050\u306e\u306f\u30bf\u30af\u30c8\u30b9\u30a4\u30c3\u30c1\uff08\u30dc\u30bf\u30f3\uff09\u3092\uff13\u3064\u3002\nLED\u3092\uff14\u3064\u3002 \uff08Publisher / Subscriber\u305d\u308c\u305e\u308c\u306b\uff09 TY51822r3\u306ePinout\u306b\u5f93\u3063\u3066\u7e4b\u304e\u307e\u3059\u3002\n\u5168\u3066GPIO\u3067\u3059\u306e\u3067\u3001I2C\u306a\u3069\u306f\u6271\u3044\u307e\u305b\u3093\u3002\nLED\u306fFET\u3067\u30c9\u30e9\u30a4\u30d6\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001SwitchScience\u306e2ch FET\u4ed8\u304dLED\u30dc\u30fc\u30c9\u3092\uff12\u3064\u4f7f\u7528\u3057\u305f\u65b9\u304c\u4fbf\u5229\u3067\u3059\u3002\n\u30dc\u30bf\u30f3\u3068\u306a\u308b\u30bf\u30af\u30c8\u30b9\u30a4\u30c3\u30c1\u306f\u666e\u901a\u306e\u3082\u306e\u3067\u5927\u4e08\u592b\u3067\u3059\u3002\n\u5185\u90e8\u30d7\u30eb\u30a2\u30c3\u30d7\u3092\u4f7f\u7528\u3059\u308b\u306e\u3067\u3001\u62b5\u6297\u306f\u5fc5\u8981\u3042\u308a\u307e\u305b\u3093\u3002GPIO\u306eBTN1\u301c3\u3068GND\u3092\u7e4b\u3044\u3067\u304f\u3060\u3055\u3044(nRF51 IoT SDK\u306e\u30b5\u30f3\u30d7\u30eb\u3082\u5185\u90e8\u30d7\u30eb\u30a2\u30c3\u30d7\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059)\u3002\n\u30bf\u30af\u30c8\u30b9\u30a4\u30c3\u30c1\u306f\u30d6\u30ec\u30c3\u30c9\u30dc\u30fc\u30c9\u306b\u523a\u3059\u5411\u304d\u306b\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002\u3061\u3083\u3093\u3068ON/OFF\u3067\u304d\u308b\u304b\u3069\u3046\u304bmbed\u306e\u30aa\u30f3\u30e9\u30a4\u30f3\u30b3\u30f3\u30d1\u30a4\u30e9\u30fc\u3067\u78ba\u8a8d\u3092\u53d6\u3063\u305f\u65b9\u304c\uff11\u756a\u65e9\u3044\u3067\u3059\uff08\u3053\u3053\u3067\u30cf\u30de\u308a\u307e\u3057\u305f\uff09\u3002\n\n\u3010\u30bf\u30af\u30c8\u30b9\u30a4\u30c3\u30c1\u78ba\u8a8d\u30b3\u30fc\u30c9 mbed \u30aa\u30f3\u30e9\u30a4\u30f3\u30b3\u30f3\u30d1\u30a4\u30e9\u30fc\u4f7f\u7528\u3011\n#include \"mbed.h\"\n\nDigitalOut led1(LED1);\nDigitalOut led2(LED2);\nDigitalOut led3(LED3);\nDigitalOut led4(LED4);\n\nDigitalIn  Button1(p17);\nDigitalIn  Button2(p18);\nDigitalIn  Button3(p19);\n\nSerial pc(USBTX, USBRX);\n\nint main() {\n    Button1.mode(PullUp);\n    Button2.mode(PullUp);\n    Button3.mode(PullUp);\n\n\n    while(1) {\n        pc.printf(\"%d, %d, %d\\r\\n\", Button1.read(), Button2.read(), Button3.read());\n        led1=Button1;\n        led2=Button2;\n        led3=Button3;\n\n        wait(0.5);\n}\n\n\nMQTT Broker\u306eIPv6\u30a2\u30c9\u30ec\u30b9\u306e\u6307\u5b9a\n\nMQTT Broker (Raspberry pi\u306b\u5272\u308a\u5f53\u3066\u308b)IPv6\u306e\u30a2\u30c9\u30ec\u30b9\u306f 2001:db8::1/64 \u3068\u3057\u307e\u3057\u305f\u3002\n\u307e\u3041\u3001\u30b0\u30b0\u3063\u305f\u3089Nordic\u306e\u30d5\u30a9\u30fc\u30e9\u30e0\u304c\u51fa\u3066\u304d\u305f\u306e\u3067\u3001\u305d\u3053\u306b\u66f8\u3044\u3066\u3042\u3063\u305f\u3084\u3064\u3067\u3059\u3002\nPublisher / Subscriber \u305d\u308c\u305e\u308c m_broker_addr \u306e\u30c8\u30b3\u3092\u4fee\u6b63\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u4fee\u6b63\u304c\u7d42\u308f\u3063\u305f\u3089make\u3057\u3066mergehex\u3057\u3066MBED\u30c9\u30e9\u30a4\u30d6\u3078\u653e\u308a\u8fbc\u3081\u3070\u826f\u3044\u3067\u3059\u3002\nmergehex\u3057\u305fhex\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304d\u8fbc\u3080\u3068LED1\u304c\u30c1\u30ab\u30c1\u30ab\u70b9\u6ec5\u3057\u3066\u3044\u308c\u3070\u826f\u3044\u3067\u3059\u3002\n\nRaspberry pi\nRaspberry pi\u30676LoWPAN\u51fa\u6765\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\nRaspbian Jessie\u3067\u3084\u308a\u307e\u3059\u3002\u3084\u308a\u65b9\u306f\u3053\u3063\u3061\u898b\u3066\u304f\u3060\u3055\u3044\u3002\nrbi-update\u3067\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u3066\u304a\u304f\u306e\u3068\u3001BlueZ\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\nRadvd\u3068Mosquitto\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\nsudo apt-get\u3000install \u3059\u308b\u3060\u3051\u306a\u306e\u3067\u3001\u5272\u611b\u3057\u307e\u3059\u3002\npi@raspberrypi:~ $ sudo modprobe bluetooth_6lowpan\n\n\u30676LoWPAN\u3092\u6709\u52b9\u306b\u3002\npi@raspberrypi:~ $ sudo vi /etc/radvd.conf \n\nradvd.conf\u3092\u65b0\u898f\u306b\u4f5c\u6210\u3057\u307e\u3059\u3002\n interface bt0\n {\n     AdvSendAdvert on;\n     prefix 2001:db8::/64 {\n         AdvOnLink off;\n         AdvAutonomous on;\n         AdvRouterAddr on;\n    };\n };\n\n\u7de8\u96c6\u304c\u7d42\u308f\u3063\u305f\u3089\u3001\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n  root@raspberrypi:~#   echo 1 > /proc/sys/net/ipv6/conf/all/forwarding \n  root@raspberrypi:~#   hcitool lescan\n  root@raspberrypi:~#   echo \"connect 00:B8:81:E0:10:BD 1\" > /sys/kernel/debug/bluetooth/6lowpan_control \n  root@raspberrypi:~#   echo \"connect 00:61:10:EE:EE:F0 1\" > /sys/kernel/debug/bluetooth/6lowpan_control \n  root@raspberrypi:~#   ifconfig bt0 add 2001:db8::1/64\n  root@raspberrypi:~#   ifconfig bt0  #bt0\u306ev6\u30a2\u30c9\u30ec\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\n  root@raspberrypi:~#   service radvd restart\n  root@raspberrypi:~#   ping6 -I bt0 2001:db8::0261:10ff:feEE:EEF0\n  root@raspberrypi:~#   ping6 -I bt0 2001:db8::02B8:81ff:feE0:10BD\n  root@raspberrypi:~#   mosquitto -v -p 1883\n\nhcitool lescan \u3067MAC\u30a2\u30c9\u30ec\u30b9\u304c\u8fd4\u3063\u3066\u304f\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u3053\u308c\u3092\u57fa\u306bv6\u306e\u30a2\u30c9\u30ec\u30b9\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\necho \"connect \u301c\" \u3068\u3059\u308b\u3068\u3001Publisher / Subscriber\u306eLED1\u304c\u6d88\u3048\u307e\u3059\u3002\nifconfig bt0 add \u3067v6\u306e\u30a2\u30c9\u30ec\u30b9\u3092\u5272\u308a\u5f53\u3066\u307e\u3059\u3002\nping6 \u3067\u305d\u308c\u305e\u308c\u306eTY51822r3\u3068ICMP\u304c\u901a\u308b\u3053\u3068\u3082\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u306d\u3002\nmosquitto \u306f\u30b5\u30fc\u30d3\u30b9\u3067\u8d77\u52d5\u3057\u3066\u3044\u308c\u3070\u30b3\u30de\u30f3\u30c9\u53e9\u304f\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\nMQTT\u3067\u63a5\u7d9a\necho \"connect \u301c\" \u3068\u3059\u308b\u3068 Publisher / Subscriber\u306eLED1\u304c\u6d88\u3048\u3001 6LoWPAN\u3067\u63a5\u7d9a\u3067\u304d\u305f\u72b6\u614b\u3067\u3059\u3002\n\u305d\u3053\u304b\u3089 Subscriber / Publisher\u306e BTN1 \u3092\u62bc\u3057\u307e\u3059\u3002\n\u305d\u3046\u3059\u308b\u3068\u3001LED2\u304c\u6d88\u3048\u3066LED1\u304c\u70b9\u706f\u3057\u307e\u3059\u3002\n\u3053\u308c\u3067MQTT\u3067\u306econnect\u72b6\u614b\u306b\u306a\u308a\u307e\u3059\u3002\n\u6b21\u306bSubscriber\u306eBTN2\u3092\u62bc\u3057\u307e\u3059\u3002\n\u3053\u308c\u3067Publisher\u304b\u3089\u306e\u5f85\u3061\u53d7\u3051\u72b6\u614b\u306b\u306a\u308a\u307e\u3059\u3002\nPublisher\u306eBTN2\u3092\u62bc\u3059\u3068Subscriber\u306eLED4\u304c\u70b9\u3044\u305f\u308a\u6d88\u3048\u305f\u308a\u3057\u307e\u3059\u3002\n\uff08Publisher\u306eLED4\u3082\u6d88\u3048\u3066\u3001\u540c\u3058LED\u306e\u72b6\u614b\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\uff09\nBTN3 \u3092\u62bc\u3059\u3068 MQTT\u306edisconnect\u72b6\u614b\u306b\u306a\u3063\u3066\u3001LED1\u304c\u6d88\u3048\u3066LED2\u304c\u70b9\u706f\u3057\u307e\u3059\u3002\n   root@raspberrypi:~# echo \"disconnect 00:B8:81:E0:10:BD 1\" > /sys/kernel/debug/bluetooth/6lowpan_control \n   root@raspberrypi:~# echo \"disconnect 00:61:10:EE:EE:F0 1\" > /sys/kernel/debug/bluetooth/6lowpan_control \n\n\u3068\u3059\u308b\u30686LoWPAN\u306e\u63a5\u7d9a\u304c\u89e3\u9664\u3055\u308c\u307e\u3059\u3002\n\u304a\u75b2\u308c\u3055\u307e\u3067\u3057\u305f\u3002\n\u3082\u3063\u304d\u3085\u3082\u304d\u3085\u301c\u301c\u301c\u301c\u301c\u301c\u301c\u301c\u301c\u301c\u301c\u3002\n\n#\u308d\u30fc\u3061\u3083\u3093\u3068\u3089\u305a\u3071\u3044\u3082\u304d\u3085\u3082\u304d\u3085\u301c\u301c\u301c\u301c\u301c\u301c\n\n[![TY51822r3 MQTT Example](http://img.youtube.com/vi/qXwlmfD7RxM/0.jpg)](http://www.youtube.com/watch?v=qXwlmfD7RxM)\n\nBLE 6LoWPAN\u3067MQTT\u306ePublisher/Subscriber\u3092\u5b9f\u969b\u306b\u52d5\u304b\u3059\u3068\u3001\u52d5\u753b\u7528\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u7247\u3063\u307d\u306eTY51822r3\u306e\u30dc\u30bf\u30f3\uff08\u30bf\u30af\u30c8\u30b9\u30a4\u30c3\u30c1\u3067\u4ee3\u7528\uff09\u3092\u62bc\u3059\u3068\u3001\u96a3\u306eTY51822r3\u306eLED\u304cON / OFF\u3057\u307e\u3059\u3002\n\u52d5\u753b\u306b\u306f\u6620\u3063\u3066\u3044\u307e\u305b\u3093\u304c\u3001MQTT Broker\u306fRaspberry pi\u304c\u62c5\u3063\u3066\u3044\u307e\u3059\u3002\n\nMQTT Broker\u306fRaspberry pi / mosquitto\u4f7f\u3044\u307e\u3059\u3002\nMQTT Pub / Sub \u306f nRF51 IoT SDK\u3067\u3001\u306b\u3085\u30fc\u3064\u307c\u3079\u3063\u3069(mbed TY51822r3)\uff12\u53f0\u306b\u9811\u5f35\u3063\u3066\u3082\u3089\u3044\u307e\u3057\u305f\u3002\n\n\u3053\u308c\u3092\u9811\u5f35\u308b\u3068\u3001\u3054\u8912\u7f8e\u306b\u308d\u30fc\u3061\u3083\u3093\u3068\u4e00\u7dd2\u306b\u3089\u305a\u3079\u308a\u30fc\u3071\u3044\u3092\u30e2\u30ad\u30e5\u3063\u3068\u98df\u3079\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\uff01\n\u7f8e\u5473\u3057\u3044\u3067\u3059\uff01\n\n#nRF51 IoT SDK\n\n<img width=\"1044\" alt=\"mqtt_pub.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/34212/3093e06e-4202-3ff6-1fc5-33dcda7e988b.png\">\n\nhttp://developer.nordicsemi.com\n\u304b\u3089nRF51 IoT SDK\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066zip\u3092\u89e3\u51cd\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\nhttps://www.keil.com/\nKeil ARM-MDK\u3082\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3059\u3002\n\n\u307e\u3041\u3001\u30d3\u30eb\u30c9\u3059\u308b\u3068\u5206\u304b\u308b\u306e\u3067\u3059\u304c\u30fb\u30fb\u30fb\u30fb\u4eca\u56de\u306f32KB\u5236\u9650\u3092\u5927\u304d\u304f\u8d85\u3048\u3066\u3057\u307e\u3046\u306e\u3067\u3001Keil ARM-MDK\u3067\u30d3\u30eb\u30c9\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u305b\u3093\u3002\n\u3088\u3063\u3066\u3001ARM-GCC\u3068GNU Make for Windows\u306e\u304a\u4e16\u8a71\u306b\u306a\u308a\u307e\u3059\u3002\nhttp://gnuwin32.sourceforge.net/packages/make.htm\n\n##\u8aad\u3093\u3067\u304a\u304f\u8cc7\u6599\n[nRF51 IoT SDK](https://developer.nordicsemi.com/nRF5_IoT_SDK/doc/0.8.0/iot/html/index.html)\n[IoT_SDK_step_by_step.pdf](https://devzone.nordicsemi.com/attachment/a6d73275210f61de0c12f20385ccf734)\n\n\u3053\u306e\uff12\u3064\u306f\u5fc5\u8aad\u3067\u3059\u3002\u8aad\u3093\u3067\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n\n##mbed TY51822r3\u306f\u5916\u90e8\u30af\u30ea\u30b9\u30bf\u30eb\u304c32MHz\u3067\u3042\u308b\u70b9\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n[\u3010mbed TY51822 \u3067 MQTT Subscribe\u3011](http://qiita.com/tw_hoehoe/items/dc97d11012aab0e0a306)\u306e\u8a18\u4e8b\u306b\u4e00\u901a\u308a\u307e\u3068\u3081\u307e\u3057\u305f\u3002\nPublisher\u3082\u540c\u69d8\u306e\u5909\u66f4\u304c\u5fc5\u8981\u3067\u3059\u3002\n\u3053\u3053\u898b\u305a\u306b\u52d5\u304b\u3093\u301c\u301c\u301c\u3063\u3066\u8a00\u308f\u308c\u3066\u3082\u77e5\u3089\u3093\u3067\u3059\u3088\u30fc\u3002\n\n\u4eca\u56de\u3001Publisher / Subscriber \u305d\u308c\u305e\u308c\u306b\u7e4b\u3050\u306e\u306f\u30bf\u30af\u30c8\u30b9\u30a4\u30c3\u30c1\uff08\u30dc\u30bf\u30f3\uff09\u3092\uff13\u3064\u3002\nLED\u3092\uff14\u3064\u3002 \uff08Publisher / Subscriber\u305d\u308c\u305e\u308c\u306b\uff09 [TY51822r3\u306ePinout](https://developer.mbed.org/platforms/Switch-Science-mbed-TY51822r3/#pinout)\u306b\u5f93\u3063\u3066\u7e4b\u304e\u307e\u3059\u3002\n\n\u5168\u3066GPIO\u3067\u3059\u306e\u3067\u3001I2C\u306a\u3069\u306f\u6271\u3044\u307e\u305b\u3093\u3002\nLED\u306fFET\u3067\u30c9\u30e9\u30a4\u30d6\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001SwitchScience\u306e[2ch FET\u4ed8\u304dLED\u30dc\u30fc\u30c9](https://www.switch-science.com/catalog/2397/)\u3092\uff12\u3064\u4f7f\u7528\u3057\u305f\u65b9\u304c\u4fbf\u5229\u3067\u3059\u3002\n\u30dc\u30bf\u30f3\u3068\u306a\u308b\u30bf\u30af\u30c8\u30b9\u30a4\u30c3\u30c1\u306f\u666e\u901a\u306e\u3082\u306e\u3067\u5927\u4e08\u592b\u3067\u3059\u3002\n\u5185\u90e8\u30d7\u30eb\u30a2\u30c3\u30d7\u3092\u4f7f\u7528\u3059\u308b\u306e\u3067\u3001\u62b5\u6297\u306f\u5fc5\u8981\u3042\u308a\u307e\u305b\u3093\u3002GPIO\u306eBTN1\u301c3\u3068GND\u3092\u7e4b\u3044\u3067\u304f\u3060\u3055\u3044(nRF51 IoT SDK\u306e\u30b5\u30f3\u30d7\u30eb\u3082\u5185\u90e8\u30d7\u30eb\u30a2\u30c3\u30d7\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059)\u3002\n\n\u30bf\u30af\u30c8\u30b9\u30a4\u30c3\u30c1\u306f\u30d6\u30ec\u30c3\u30c9\u30dc\u30fc\u30c9\u306b\u523a\u3059\u5411\u304d\u306b\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002\u3061\u3083\u3093\u3068ON/OFF\u3067\u304d\u308b\u304b\u3069\u3046\u304bmbed\u306e\u30aa\u30f3\u30e9\u30a4\u30f3\u30b3\u30f3\u30d1\u30a4\u30e9\u30fc\u3067\u78ba\u8a8d\u3092\u53d6\u3063\u305f\u65b9\u304c\uff11\u756a\u65e9\u3044\u3067\u3059\uff08\u3053\u3053\u3067\u30cf\u30de\u308a\u307e\u3057\u305f\uff09\u3002\n\n    \n###\u3010\u30bf\u30af\u30c8\u30b9\u30a4\u30c3\u30c1\u78ba\u8a8d\u30b3\u30fc\u30c9 mbed \u30aa\u30f3\u30e9\u30a4\u30f3\u30b3\u30f3\u30d1\u30a4\u30e9\u30fc\u4f7f\u7528\u3011\n\n    #include \"mbed.h\"\n\n    DigitalOut led1(LED1);\n    DigitalOut led2(LED2);\n    DigitalOut led3(LED3);\n    DigitalOut led4(LED4);\n\n    DigitalIn  Button1(p17);\n    DigitalIn  Button2(p18);\n    DigitalIn  Button3(p19);\n\n    Serial pc(USBTX, USBRX);\n\n    int main() {\n        Button1.mode(PullUp);\n        Button2.mode(PullUp);\n        Button3.mode(PullUp);\n    \n    \n        while(1) {\n            pc.printf(\"%d, %d, %d\\r\\n\", Button1.read(), Button2.read(), Button3.read());\n            led1=Button1;\n            led2=Button2;\n            led3=Button3;\n                \n            wait(0.5);\n    }\n\n##MQTT Broker\u306eIPv6\u30a2\u30c9\u30ec\u30b9\u306e\u6307\u5b9a\n\n<img width=\"738\" alt=\"broker_v6_address.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/34212/196f67cf-08aa-daec-b9d7-0fce347af9ca.png\">\n\nMQTT Broker (Raspberry pi\u306b\u5272\u308a\u5f53\u3066\u308b)IPv6\u306e\u30a2\u30c9\u30ec\u30b9\u306f 2001:db8::1/64 \u3068\u3057\u307e\u3057\u305f\u3002\n\u307e\u3041\u3001\u30b0\u30b0\u3063\u305f\u3089Nordic\u306e\u30d5\u30a9\u30fc\u30e9\u30e0\u304c\u51fa\u3066\u304d\u305f\u306e\u3067\u3001\u305d\u3053\u306b\u66f8\u3044\u3066\u3042\u3063\u305f\u3084\u3064\u3067\u3059\u3002\nPublisher / Subscriber \u305d\u308c\u305e\u308c m_broker_addr \u306e\u30c8\u30b3\u3092\u4fee\u6b63\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u4fee\u6b63\u304c\u7d42\u308f\u3063\u305f\u3089make\u3057\u3066mergehex\u3057\u3066MBED\u30c9\u30e9\u30a4\u30d6\u3078\u653e\u308a\u8fbc\u3081\u3070\u826f\u3044\u3067\u3059\u3002\nmergehex\u3057\u305fhex\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304d\u8fbc\u3080\u3068LED1\u304c\u30c1\u30ab\u30c1\u30ab\u70b9\u6ec5\u3057\u3066\u3044\u308c\u3070\u826f\u3044\u3067\u3059\u3002\n\n#Raspberry pi\n\nRaspberry pi\u30676LoWPAN\u51fa\u6765\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\nRaspbian Jessie\u3067\u3084\u308a\u307e\u3059\u3002\u3084\u308a\u65b9\u306f[\u3053\u3063\u3061](http://qiita.com/tw_hoehoe/items/e42cc6362056d9029a8d#raspbian-jessie\u3067\u3084\u308b\u5834\u5408)\u898b\u3066\u304f\u3060\u3055\u3044\u3002\nrbi-update\u3067\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u3066\u304a\u304f\u306e\u3068\u3001BlueZ\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\nRadvd\u3068Mosquitto\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\nsudo apt-get\u3000install \u3059\u308b\u3060\u3051\u306a\u306e\u3067\u3001\u5272\u611b\u3057\u307e\u3059\u3002\n\n    pi@raspberrypi:~ $ sudo modprobe bluetooth_6lowpan\n\n\u30676LoWPAN\u3092\u6709\u52b9\u306b\u3002\n\n    pi@raspberrypi:~ $ sudo vi /etc/radvd.conf \n\nradvd.conf\u3092\u65b0\u898f\u306b\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n     interface bt0\n     {\n         AdvSendAdvert on;\n         prefix 2001:db8::/64 {\n             AdvOnLink off;\n             AdvAutonomous on;\n             AdvRouterAddr on;\n        };\n     };\n\n\u7de8\u96c6\u304c\u7d42\u308f\u3063\u305f\u3089\u3001\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n      root@raspberrypi:~#   echo 1 > /proc/sys/net/ipv6/conf/all/forwarding \n      root@raspberrypi:~#   hcitool lescan\n      root@raspberrypi:~#   echo \"connect 00:B8:81:E0:10:BD 1\" > /sys/kernel/debug/bluetooth/6lowpan_control \n      root@raspberrypi:~#   echo \"connect 00:61:10:EE:EE:F0 1\" > /sys/kernel/debug/bluetooth/6lowpan_control \n      root@raspberrypi:~#   ifconfig bt0 add 2001:db8::1/64\n      root@raspberrypi:~#   ifconfig bt0  #bt0\u306ev6\u30a2\u30c9\u30ec\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\n      root@raspberrypi:~#   service radvd restart\n      root@raspberrypi:~#   ping6 -I bt0 2001:db8::0261:10ff:feEE:EEF0\n      root@raspberrypi:~#   ping6 -I bt0 2001:db8::02B8:81ff:feE0:10BD\n      root@raspberrypi:~#   mosquitto -v -p 1883\n\n\nhcitool lescan \u3067MAC\u30a2\u30c9\u30ec\u30b9\u304c\u8fd4\u3063\u3066\u304f\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u3053\u308c\u3092\u57fa\u306bv6\u306e\u30a2\u30c9\u30ec\u30b9\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\necho \"connect \u301c\" \u3068\u3059\u308b\u3068\u3001Publisher / Subscriber\u306eLED1\u304c\u6d88\u3048\u307e\u3059\u3002\nifconfig bt0 add \u3067v6\u306e\u30a2\u30c9\u30ec\u30b9\u3092\u5272\u308a\u5f53\u3066\u307e\u3059\u3002\nping6 \u3067\u305d\u308c\u305e\u308c\u306eTY51822r3\u3068ICMP\u304c\u901a\u308b\u3053\u3068\u3082\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u306d\u3002\nmosquitto \u306f\u30b5\u30fc\u30d3\u30b9\u3067\u8d77\u52d5\u3057\u3066\u3044\u308c\u3070\u30b3\u30de\u30f3\u30c9\u53e9\u304f\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n\n#MQTT\u3067\u63a5\u7d9a\n\necho \"connect \u301c\" \u3068\u3059\u308b\u3068 Publisher / Subscriber\u306eLED1\u304c\u6d88\u3048\u3001 6LoWPAN\u3067\u63a5\u7d9a\u3067\u304d\u305f\u72b6\u614b\u3067\u3059\u3002\n\u305d\u3053\u304b\u3089 Subscriber / Publisher\u306e BTN1 \u3092\u62bc\u3057\u307e\u3059\u3002\n\u305d\u3046\u3059\u308b\u3068\u3001LED2\u304c\u6d88\u3048\u3066LED1\u304c\u70b9\u706f\u3057\u307e\u3059\u3002\n\u3053\u308c\u3067MQTT\u3067\u306econnect\u72b6\u614b\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u6b21\u306bSubscriber\u306eBTN2\u3092\u62bc\u3057\u307e\u3059\u3002\n\u3053\u308c\u3067Publisher\u304b\u3089\u306e\u5f85\u3061\u53d7\u3051\u72b6\u614b\u306b\u306a\u308a\u307e\u3059\u3002\n\nPublisher\u306eBTN2\u3092\u62bc\u3059\u3068Subscriber\u306eLED4\u304c\u70b9\u3044\u305f\u308a\u6d88\u3048\u305f\u308a\u3057\u307e\u3059\u3002\n\uff08Publisher\u306eLED4\u3082\u6d88\u3048\u3066\u3001\u540c\u3058LED\u306e\u72b6\u614b\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\uff09\n\nBTN3 \u3092\u62bc\u3059\u3068 MQTT\u306edisconnect\u72b6\u614b\u306b\u306a\u3063\u3066\u3001LED1\u304c\u6d88\u3048\u3066LED2\u304c\u70b9\u706f\u3057\u307e\u3059\u3002\n\n\n       root@raspberrypi:~# echo \"disconnect 00:B8:81:E0:10:BD 1\" > /sys/kernel/debug/bluetooth/6lowpan_control \n       root@raspberrypi:~# echo \"disconnect 00:61:10:EE:EE:F0 1\" > /sys/kernel/debug/bluetooth/6lowpan_control \n\n\u3068\u3059\u308b\u30686LoWPAN\u306e\u63a5\u7d9a\u304c\u89e3\u9664\u3055\u308c\u307e\u3059\u3002\n\n\u304a\u75b2\u308c\u3055\u307e\u3067\u3057\u305f\u3002\n\n\u3082\u3063\u304d\u3085\u3082\u304d\u3085\u301c\u301c\u301c\u301c\u301c\u301c\u301c\u301c\u301c\u301c\u301c\u3002\n", "tags": ["BLE", "6lowpan", "mqtt", "IoT", "TY51822r3"]}