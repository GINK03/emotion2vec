{"tags": ["Live2D", "Unity"], "context": " More than 1 year has passed since last update.\u524d\u306b\u66f8\u3044\u305fLive2D\u306e\u30e2\u30fc\u30b7\u30e7\u30f3\u3092Mecanim\u5236\u5fa1\u3059\u308b\u3067\u3059\u304c\u3001\u3061\u3087\u3063\u3068\u30d0\u30b0\u3063\u3066\u307e\u3057\u305f\u3002\n\nMecanim\u306eparameter\u5024\u3092\u5909\u3048\u305f\u77ac\u9593\u306b\u306f\u3001\u6b21\u306e\u30e2\u30fc\u30b7\u30e7\u30f3\u30d5\u30a1\u30a4\u30eb\u540d\u304c\u53d6\u5f97\u3067\u304d\u3066\u304a\u3089\u305a\u524d\u306e\u30e2\u30fc\u30b7\u30e7\u30f3\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u53d6\u5f97\u3057\u3066\u305f...\u3002\n\u3053\u306e\u554f\u984c\u3067\u3059\u304c\u3001Unity5\u304b\u3089\u8ffd\u52a0\u3055\u308c\u305fState Machine Behaviours\u3067\u89e3\u6c7a\u3067\u304d\u307e\u3057\u305f\u3002\nState Machine Behaviours\u306f\u3001\u30b3\u30fc\u30c9\u304b\u3089Mecanim\u306eState\u4f5c\u6210\u3067\u304d\u305f\u308a\u3001\u72b6\u614b\u9077\u79fb\u30bf\u30a4\u30df\u30f3\u30b0\u3092\u7d30\u304b\u304f\u53d6\u5f97\u3067\u304d\u308b\u3082\u306e\u3067\u3059\u3002\n\nState Machine Behaviours\u3067\u5236\u5fa1\u3059\u308b\u624b\u9806\n\u4eca\u56de\u3082Live2D Unity SDK\u306eMotion\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f7f\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\uff08sample\\Motion\\Assets\\Scene\\Sample.unity\uff09\n\uff11\uff09Live2D\u30e2\u30c7\u30eb\u306bAnimator\u3092\u8ffd\u52a0\u3057\u307e\u3059\n\n\uff12\uff09[Assets]-[Create]\u304b\u3089Animator Controller\u3092\u4f5c\u6210\u3057\u3001\u30a2\u30bf\u30c3\u30c1\u3059\u308b\n\n\uff13\uff09Hirarchy\u3067Live2DModel\u3092\u9078\u629e\u3057\u305f\u72b6\u614b\u3067\u3001[Window]-[Animation]\u3092\u958b\u304d[Create New Clip]\u3067\u65b0\u898fAnimation\u30922\u3064\u4f5c\u308b\u3002\n\n1\u3064\u306fidle.anim\u3001\u3082\u30461\u3064\u306fmotion1.anim\u3068\u3057\u3066\u304a\u304f\u3002\n\uff14\uff09Add Property\u30dc\u30bf\u30f3\u62bc\u4e0b\u3057\u3001Motion File\u306e+\u30dc\u30bf\u30f3\u62bc\u4e0b\u3059\u308b\n\n\uff15\uff091:00\u306e\u30ad\u30fc\u30d5\u30ec\u30fc\u30e0\u306fDelete\u3057\u30010:00\u306e\u65b9\u3092\u9078\u629e\u3057\u3001Inspector\u306eMotion File\u3092\u6307\u5b9a\u3057\u307e\u3059\n\n\n\uff16\uff09\u3082\u30461\u3064\u306e\u30e2\u30fc\u30b7\u30e7\u30f3\u3082\u540c\u69d8\u306b\u3059\u308b\n\n\n\uff17\uff09MakeTransition\u3067\u3064\u306a\u3044\u3067\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4f5c\u308b\n\n\uff18\uff09Transition\u306e\u77e2\u5370\u3092\u9078\u629e\u3057\u3001Motion=1\u306e\u6642\u306fmotion1\u3078\u3001Motion=0\u306e\u6642\u306fidle\u3078\u884c\u304f\u3088\u3046\u306b\u3059\u308b\n\n\n\uff19\uff09Animator\u306eBase Layer\u306eInspector\u3067Add Behaviour\u30dc\u30bf\u30f3\u62bc\u4e0b\u3057\u3001Script\u3092\u4f5c\u308b\n\n\uff11\uff10\uff09SteteMachine\u30bd\u30fc\u30b9\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3059\u308b\n\nMotionBehaviour.cs\nusing UnityEngine;\nusing System.Collections;\n\npublic class MotionBehaviour : StateMachineBehaviour {\n\n    public bool changeflg = false;   // \u30e2\u30fc\u30b7\u30e7\u30f3\u30c1\u30a7\u30f3\u30b8\u30d5\u30e9\u30b0\n\n    // \u6b21\u306e\u30b9\u30c6\u30fc\u30c8\u306b\u79fb\u308a\u5909\u308f\u308b\u76f4\u524d\u306b\u5b9f\u884c\u3055\u308c\u308b\n    public override void OnStateExit(Animator animator, AnimatorStateInfo stateInfo, int layerIndex)\n    {\n        changeflg = true;\n    }\n}\n\n\n\uff11\uff11\uff09\u30e1\u30a4\u30f3\u306e\u30bd\u30fc\u30b9\u3082\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u4fee\u6b63\u3059\u308b\n\nSimpleModel.cs\nusing UnityEngine;\nusing System;\nusing System.IO;\nusing System.Collections;\nusing live2d;\n\n[ExecuteInEditMode]\npublic class SimpleModel: MonoBehaviour \n{\n    private Live2DModelUnity live2DModel;\n    private Live2DMotion motion;\n    private MotionQueueManager motionMgr;\n\n    private Matrix4x4 live2DCanvasPos;\n\n    public TextAsset mocFile ;\n    public Texture2D[] textureFiles ;\n    public TextAsset motionFile;\n\n    private Animator anim;    // Animator\n    private MotionBehaviour mtnBehaviour;    // MotionBehaviour\n\n    void Start () \n    {\n        Live2D.init();\n        // Animator\u3092\u53d6\u5f97\n        anim = GetComponent<Animator>();\n        // State Machine Behaviours\u3092\u53d6\u5f97\n        mtnBehaviour = anim.GetBehaviour<MotionBehaviour>();\n\n        live2DModel = Live2DModelUnity.loadModel(mocFile.bytes);\n\n        for (int i = 0; i < textureFiles.Length; i++)\n        {\n            live2DModel.setTexture(i, textureFiles[i]);\n        }\n\n        float modelWidth = live2DModel.getCanvasWidth();\n        live2DCanvasPos = Matrix4x4.Ortho(0, modelWidth, modelWidth, 0, -50.0f, 50.0f);\n\n        motionMgr = new MotionQueueManager();\n        motion = Live2DMotion.loadMotion(motionFile.bytes);\n    }\n\n\n    void OnRenderObject()\n    {\n        if (live2DModel == null) return;\n        live2DModel.setMatrix(transform.localToWorldMatrix * live2DCanvasPos);\n\n        if ( ! Application.isPlaying)\n        {\n            live2DModel.update();\n            live2DModel.draw();\n            return;\n        }\n\n        // \u30e2\u30fc\u30b7\u30e7\u30f3\u304c\u7d42\u4e86\u3057\u3066\u3044\u305f\u3089 or \u30d5\u30e9\u30b0\u304c\u66f4\u65b0\u3055\u308c\u3066\u3044\u305f\u3089\n        if (motionMgr.isFinished() || mtnBehaviour.changeflg == true)\n        {\n            // \u30e2\u30fc\u30b7\u30e7\u30f3\u306e\u30ed\u30fc\u30c9\n            motion = Live2DMotion.loadMotion(motionFile.bytes);\n            // \u30e2\u30fc\u30b7\u30e7\u30f3\u30b9\u30bf\u30fc\u30c8\n            motionMgr.startMotion(motion);\n            // \u30d5\u30e9\u30b0\u3092OFF\u306b\u3059\u308b\n            mtnBehaviour.changeflg = false;\n        }\n\n        motionMgr.updateParam(live2DModel);\n\n        live2DModel.update();\n        live2DModel.draw();\n    }\n}\n\n\n\uff11\uff12\uff09\u3053\u308c\u3067\u77ac\u6642\u306b\u30e2\u30fc\u30b7\u30e7\u30f3\u304c\u5207\u308a\u66ff\u308f\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\uff01\n\n\n\u53c2\u8003\u306b\u3057\u305f\u30da\u30fc\u30b8\n\u30fbUnity Document - State Machine Behaviour\u3068\u306f\n\u30fbUnity Document - State Machine Behaviour\n\u30fbUnity5.0\u306e\u65b0\u3057\u3044\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u6a5f\u80fd\n\u30fbMecanim\u3092\u4f7f\u3063\u3066\u30e6\u30cb\u30c6\u30a3\u3061\u3083\u3093\u3092\u52d5\u304b\u3057\u3066\u307f\u305f\u3001\u3067\u51fa\u305f\u7591\u554f\u70b9\u3092\u89e3\u6d88\u3057\u3066\u3044\u304f\n\u30fbUnity5 Mecanim\u306eStateMachineBehaviour\u3068\u622f\u308c\u308b\n\u524d\u306b\u66f8\u3044\u305f[Live2D\u306e\u30e2\u30fc\u30b7\u30e7\u30f3\u3092Mecanim\u5236\u5fa1\u3059\u308b](http://qiita.com/naotaro0123/items/f32e9655f78c91b27a0f)\u3067\u3059\u304c\u3001\u3061\u3087\u3063\u3068\u30d0\u30b0\u3063\u3066\u307e\u3057\u305f\u3002\n![01.png](https://qiita-image-store.s3.amazonaws.com/0/15028/5b61c2ca-a934-129e-58a7-07d2477d961e.png)\n\n\nMecanim\u306eparameter\u5024\u3092\u5909\u3048\u305f\u77ac\u9593\u306b\u306f\u3001\u6b21\u306e\u30e2\u30fc\u30b7\u30e7\u30f3\u30d5\u30a1\u30a4\u30eb\u540d\u304c\u53d6\u5f97\u3067\u304d\u3066\u304a\u3089\u305a\u524d\u306e\u30e2\u30fc\u30b7\u30e7\u30f3\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u53d6\u5f97\u3057\u3066\u305f...\u3002\n\n\u3053\u306e\u554f\u984c\u3067\u3059\u304c\u3001Unity5\u304b\u3089\u8ffd\u52a0\u3055\u308c\u305fState Machine Behaviours\u3067\u89e3\u6c7a\u3067\u304d\u307e\u3057\u305f\u3002\nState Machine Behaviours\u306f\u3001\u30b3\u30fc\u30c9\u304b\u3089Mecanim\u306eState\u4f5c\u6210\u3067\u304d\u305f\u308a\u3001\u72b6\u614b\u9077\u79fb\u30bf\u30a4\u30df\u30f3\u30b0\u3092\u7d30\u304b\u304f\u53d6\u5f97\u3067\u304d\u308b\u3082\u306e\u3067\u3059\u3002\n\n# State Machine Behaviours\u3067\u5236\u5fa1\u3059\u308b\u624b\u9806\n\u4eca\u56de\u3082Live2D Unity SDK\u306eMotion\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f7f\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\uff08sample\\Motion\\Assets\\Scene\\Sample.unity\uff09\n\n\uff11\uff09Live2D\u30e2\u30c7\u30eb\u306bAnimator\u3092\u8ffd\u52a0\u3057\u307e\u3059\n![02.png](https://qiita-image-store.s3.amazonaws.com/0/15028/edcda125-a603-2242-9741-53fa80237985.png)\n\n\uff12\uff09[Assets]-[Create]\u304b\u3089Animator Controller\u3092\u4f5c\u6210\u3057\u3001\u30a2\u30bf\u30c3\u30c1\u3059\u308b\n![03.png](https://qiita-image-store.s3.amazonaws.com/0/15028/df9cf6e1-dae3-0972-084b-9f977294d5c2.png)\n\n\uff13\uff09Hirarchy\u3067Live2DModel\u3092\u9078\u629e\u3057\u305f\u72b6\u614b\u3067\u3001[Window]-[Animation]\u3092\u958b\u304d[Create New Clip]\u3067\u65b0\u898fAnimation\u30922\u3064\u4f5c\u308b\u3002\n![04.png](https://qiita-image-store.s3.amazonaws.com/0/15028/fcb75ef1-5712-a498-328a-aa4d2bdb0e31.png)\n\n1\u3064\u306fidle.anim\u3001\u3082\u30461\u3064\u306fmotion1.anim\u3068\u3057\u3066\u304a\u304f\u3002\n\n\uff14\uff09Add Property\u30dc\u30bf\u30f3\u62bc\u4e0b\u3057\u3001Motion File\u306e+\u30dc\u30bf\u30f3\u62bc\u4e0b\u3059\u308b\n![05.png](https://qiita-image-store.s3.amazonaws.com/0/15028/d37593d9-da52-4460-a12d-08f4f60a57e0.png)\n\n\uff15\uff091:00\u306e\u30ad\u30fc\u30d5\u30ec\u30fc\u30e0\u306fDelete\u3057\u30010:00\u306e\u65b9\u3092\u9078\u629e\u3057\u3001Inspector\u306eMotion File\u3092\u6307\u5b9a\u3057\u307e\u3059\n![06.png](https://qiita-image-store.s3.amazonaws.com/0/15028/3c0c8ddc-41a4-4926-622d-0c035ce3a39d.png)\n\n![07.png](https://qiita-image-store.s3.amazonaws.com/0/15028/d0ef2ece-3554-e0e3-fc89-858d5141360a.png)\n\n\uff16\uff09\u3082\u30461\u3064\u306e\u30e2\u30fc\u30b7\u30e7\u30f3\u3082\u540c\u69d8\u306b\u3059\u308b\n![08.png](https://qiita-image-store.s3.amazonaws.com/0/15028/fb25f106-ece4-e814-38a1-0deacba84e7b.png)\n\n![09.png](https://qiita-image-store.s3.amazonaws.com/0/15028/8a769e21-cd15-5847-fcf0-875a147c7fb5.png)\n\n\uff17\uff09MakeTransition\u3067\u3064\u306a\u3044\u3067\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4f5c\u308b\n![10.png](https://qiita-image-store.s3.amazonaws.com/0/15028/83ed7869-8211-fabc-02fa-a05931c46485.png)\n\n\uff18\uff09Transition\u306e\u77e2\u5370\u3092\u9078\u629e\u3057\u3001Motion=1\u306e\u6642\u306fmotion1\u3078\u3001Motion=0\u306e\u6642\u306fidle\u3078\u884c\u304f\u3088\u3046\u306b\u3059\u308b\n![11.png](https://qiita-image-store.s3.amazonaws.com/0/15028/2daad75d-59e0-6167-28da-183199dc06c4.png)\n\n![12.png](https://qiita-image-store.s3.amazonaws.com/0/15028/641b088e-1d71-050c-cca3-e60042bc7b74.png)\n\n\uff19\uff09Animator\u306eBase Layer\u306eInspector\u3067Add Behaviour\u30dc\u30bf\u30f3\u62bc\u4e0b\u3057\u3001Script\u3092\u4f5c\u308b\n![13.png](https://qiita-image-store.s3.amazonaws.com/0/15028/6c0d0049-c640-36cc-392b-01b6213032ad.png)\n\n\uff11\uff10\uff09SteteMachine\u30bd\u30fc\u30b9\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3059\u308b\n\n```csharp:MotionBehaviour.cs\nusing UnityEngine;\nusing System.Collections;\n\npublic class MotionBehaviour : StateMachineBehaviour {\n\n\tpublic bool changeflg = false;   // \u30e2\u30fc\u30b7\u30e7\u30f3\u30c1\u30a7\u30f3\u30b8\u30d5\u30e9\u30b0\n\n\t// \u6b21\u306e\u30b9\u30c6\u30fc\u30c8\u306b\u79fb\u308a\u5909\u308f\u308b\u76f4\u524d\u306b\u5b9f\u884c\u3055\u308c\u308b\n\tpublic override void OnStateExit(Animator animator, AnimatorStateInfo stateInfo, int layerIndex)\n\t{\n\t\tchangeflg = true;\n\t}\n}\n```\n\n\uff11\uff11\uff09\u30e1\u30a4\u30f3\u306e\u30bd\u30fc\u30b9\u3082\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u4fee\u6b63\u3059\u308b\n\n```csharp:SimpleModel.cs\nusing UnityEngine;\nusing System;\nusing System.IO;\nusing System.Collections;\nusing live2d;\n\n[ExecuteInEditMode]\npublic class SimpleModel: MonoBehaviour \n{\n\tprivate Live2DModelUnity live2DModel;\n    private Live2DMotion motion;\n    private MotionQueueManager motionMgr;\n\n    private Matrix4x4 live2DCanvasPos;\n\n    public TextAsset mocFile ;\n    public Texture2D[] textureFiles ;\n    public TextAsset motionFile;\n\n\tprivate Animator anim;    // Animator\n\tprivate MotionBehaviour mtnBehaviour;    // MotionBehaviour\n\n\tvoid Start () \n\t{\n        Live2D.init();\n\t\t// Animator\u3092\u53d6\u5f97\n\t\tanim = GetComponent<Animator>();\n\t\t// State Machine Behaviours\u3092\u53d6\u5f97\n\t\tmtnBehaviour = anim.GetBehaviour<MotionBehaviour>();\n\n        live2DModel = Live2DModelUnity.loadModel(mocFile.bytes);\n\n        for (int i = 0; i < textureFiles.Length; i++)\n        {\n            live2DModel.setTexture(i, textureFiles[i]);\n        }\n\n        float modelWidth = live2DModel.getCanvasWidth();\n        live2DCanvasPos = Matrix4x4.Ortho(0, modelWidth, modelWidth, 0, -50.0f, 50.0f);\n\n        motionMgr = new MotionQueueManager();\n        motion = Live2DMotion.loadMotion(motionFile.bytes);\n\t}\n\t\n\t\n\tvoid OnRenderObject()\n\t{\n        if (live2DModel == null) return;\n        live2DModel.setMatrix(transform.localToWorldMatrix * live2DCanvasPos);\n\n        if ( ! Application.isPlaying)\n        {\n            live2DModel.update();\n            live2DModel.draw();\n            return;\n        }\n\n\t\t// \u30e2\u30fc\u30b7\u30e7\u30f3\u304c\u7d42\u4e86\u3057\u3066\u3044\u305f\u3089 or \u30d5\u30e9\u30b0\u304c\u66f4\u65b0\u3055\u308c\u3066\u3044\u305f\u3089\n\t\tif (motionMgr.isFinished() || mtnBehaviour.changeflg == true)\n\t\t{\n\t\t\t// \u30e2\u30fc\u30b7\u30e7\u30f3\u306e\u30ed\u30fc\u30c9\n\t\t\tmotion = Live2DMotion.loadMotion(motionFile.bytes);\n\t\t\t// \u30e2\u30fc\u30b7\u30e7\u30f3\u30b9\u30bf\u30fc\u30c8\n\t\t\tmotionMgr.startMotion(motion);\n\t\t\t// \u30d5\u30e9\u30b0\u3092OFF\u306b\u3059\u308b\n\t\t\tmtnBehaviour.changeflg = false;\n\t\t}\n\n        motionMgr.updateParam(live2DModel);\n\t\t\n\t\tlive2DModel.update();\n\t\tlive2DModel.draw();\n\t}\n}\n```\n\n\uff11\uff12\uff09\u3053\u308c\u3067\u77ac\u6642\u306b\u30e2\u30fc\u30b7\u30e7\u30f3\u304c\u5207\u308a\u66ff\u308f\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\uff01\n![motion.gif](https://qiita-image-store.s3.amazonaws.com/0/15028/da04d3c5-d6d1-a8b6-8a35-03421f233d37.gif)\n\n###\u53c2\u8003\u306b\u3057\u305f\u30da\u30fc\u30b8\n\u30fb[Unity Document - State Machine Behaviour\u3068\u306f](http://docs.unity3d.com/ja/current/Manual/StateMachineBehaviours.html)\n\u30fb[Unity Document - State Machine Behaviour](http://unity3d.com/jp/learn/tutorials/modules/beginner/5-pre-order-beta/state-machine-behaviours)\n\u30fb[Unity5.0\u306e\u65b0\u3057\u3044\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u6a5f\u80fd](http://japan.unity3d.com/blog/?p=1672)\n\u30fb[Mecanim\u3092\u4f7f\u3063\u3066\u30e6\u30cb\u30c6\u30a3\u3061\u3083\u3093\u3092\u52d5\u304b\u3057\u3066\u307f\u305f\u3001\u3067\u51fa\u305f\u7591\u554f\u70b9\u3092\u89e3\u6d88\u3057\u3066\u3044\u304f](http://kikikiroku.session.jp/unity5-mecanim-animation-study/)\n\u30fb[Unity5 Mecanim\u306eStateMachineBehaviour\u3068\u622f\u308c\u308b](http://tsubakit1.hateblo.jp/entry/2015/05/01/032208)\n"}