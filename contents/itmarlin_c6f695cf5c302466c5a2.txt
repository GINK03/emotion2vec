{"context": " More than 1 year has passed since last update.SenchaTouch\u306e\u65e2\u5b58\u30d5\u30a9\u30fc\u30e0\u9001\u4fe1\u6a5f\u80fd\u304c\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u305f\u3081\u3001\u5225\u306e\u65b9\u6cd5\u3067\u5bfe\u5fdc\u3057\u305f\u3002\n\n\u5c02\u7528\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u5b9f\u88c5\n// \u5199\u771f\u7528\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\nExt.define('MomBaby.view.common.CapturePicture', {\n    extend: 'Ext.Component',\n    xtype: 'capturepicture',\n\n    config: {\n        captured: false,\n        cls: 'picture-capture-area',\n        html: [\n            '<div class=\"picture-capture\">',\n                '<div class=\"icon\"><i class=\"icon-camera\"></i> \u5199\u771f\u9078\u629e</div>',\n                '<img class=\"image-tns\" />',\n                '<input type=\"file\" accept=\"image/*;capture=camera\" />', //Step 1\n            '</div>',\n        ].join('')\n    },\n\n    initialize: function() {\n        this.callParent(arguments);\n\n        this.file = this.element.down('input[type=file]');\n        this.img = this.element.down('img');\n        this.inputImg = new Image();\n        this.isChange = false;\n\n        this.file.on('change', this.setPicture, this); //Step 2\n\n        //FIX for webkit\n        this.createObjectURL = (window.webkitURL && window.webkitURL.createObjectURL) ? function(file) {\n            return window.webkitURL.createObjectURL(file);\n        } : (window.URL && window.URL.createObjectURL) ? function(file) {\n            return window.URL.createObjectURL(file);\n        } : undefined;\n    },\n\n    setPicture: function(event) {\n        this.isChange = true;\n        var files = event.target.files;\n        if (files.length === 1) {\n            var file = files[0];\n            if ( file.size == 0 ){\n                // \u30a2\u30e9\u30fc\u30c8\n                Ext.Msg.alert('\u30a2\u30e9\u30fc\u30c8', '\u9078\u629e\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u304c\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u307e\u305b\u3093\u3002');\n                return;\n            }\n\n            // \u753b\u50cf\u8868\u793a\n            var src = this.createObjectURL(file);\n            this.img.setStyle('display', 'block');\n            this.img.set({\n                src: src //Step 4\n            });\n            this.inputImg.src = src;\n            this.setCaptured(true);\n        }\n    },\n\n    setPictureWithUrl: function(url){\n        this.img.setStyle('display', 'block');\n        this.img.set({\n            src: url\n        });\n        this.inputImg.src = url;\n        this.setCaptured(true);\n    },\n\n    reset: function() {\n        this.img.setStyle('display', 'none');\n        this.img.set({\n            src: ''\n        });\n        this.inputImg.src = '';\n        this.isChange = false;\n        this.setCaptured(false);\n    },\n\n    getImageDataUrl: function() { //Step 6\n        var imgCanvas = document.createElement(\"canvas\"),\n            imgContext = imgCanvas.getContext(\"2d\");\n\n        if (this.getCaptured()) {\n            var num = this.inputImg.width / 320;\n            this.inputImg.width = 320;\n            this.inputImg.height = this.inputImg.height / num;\n\n            // Make sure canvas is as big as the picture\n            imgCanvas.width = this.inputImg.width;\n            imgCanvas.height = this.inputImg.height;\n\n            // Draw image into canvas element\n            imgContext.drawImage(this.inputImg, 0, 0, this.inputImg.width, this.inputImg.height);\n\n            // Return the image as a data URL\n            var url = imgCanvas.toDataURL(\"image/png\");\n            imgCanvas = null;\n            imgContext = null;\n            return url;\n        }\n    }\n});\n\n\n\u30b9\u30bf\u30a4\u30eb\n/* \u5199\u771f\u9078\u629e */\n.picture-capture-area {\n    background: #fff;\n    padding: 20px 0;\n    border-bottom: 1px solid #f0f0f0;\n}\n.picture-capture {\n    background-image: -webkit-linear-gradient(top, #d11966 0%, #a2134f 3%, #750d38 100%);\n    border-radius: 5px;\n    border:1px solid #750d38;\n    border-width:1px;\n    overflow: hidden;\n    margin: 0px auto;\n    width: 100px;\n    height: 100px;\n    position: relative;\n}\n.picture-capture input {\n    border: 0;\n    position: absolute;\n    cursor: pointer;\n    top: -2px;\n    right: -2px;\n    filter: alpha(opacity=0);\n    opacity: 0;\n    font-size: 1000px;\n}\n.picture-capture img {\n    position: absolute;\n    border-radius: 5px;\n    width: 100%;\n    height: 100%;\n    display:none;\n    background: #fff;\n}\n.picture-capture .icon {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    color:#fff;\n    text-align: center;\n    font-size: 16px;\n}\n.picture-capture .icon i { display:block; font-size: 50px; color:#fff; height: 61px; }\n.picture-capture .icon-camera {}\n.picture-capture .icon-camera:before {\n    font-style: normal;\n    text-align: center;\n    font-family: 'Pictos';\n    content: \"v\";\n}\n\n\n\u30c7\u30fc\u30bf\u3092Ajax\u3067\u9001\u4fe1\u3059\u308b\n\u4e0b\u8a18\u306e\u30b3\u30fc\u30c9\u3067\u753b\u50cf\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3001\u9001\u4fe1\u3059\u308b\n// form\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304b\u3089\u53d6\u5f97\u3059\u308b\nvar capture = form.down('capturepicture');\nvar data = capture.getImageDataUrl();\n\n// Ajax\u9001\u4fe1\nExt.Ajax.request({\n    url: 'xxx',\n    method: 'POST',\n    params: { image: data },\n    success: function(response, opts){\n    },\n    failure: function(response, opts) {\n    },\n    scope: this\n});\n\n\n\u5b9f\u88c5\u6e08\u307f\u30a2\u30d7\u30ea\n\n\nMomBaby - \u598a\u5a20\u4e2d\u306e\u30de\u30de\u3068\u5b50\u80b2\u3066\u306e\u30de\u30de\u306b\u5f79\u7acb\u3064\u30a2\u30d7\u30ea : [\u5404\u7a2e\u8a2d\u5b9a]-[\u89aa\u60c5\u5831\u753b\u9762]\u306a\u3069\n\n\nSenchaTouch\u306e\u65e2\u5b58\u30d5\u30a9\u30fc\u30e0\u9001\u4fe1\u6a5f\u80fd\u304c\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u305f\u3081\u3001\u5225\u306e\u65b9\u6cd5\u3067\u5bfe\u5fdc\u3057\u305f\u3002\n\n\n## \u5c02\u7528\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u5b9f\u88c5\n```javascript\n// \u5199\u771f\u7528\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\nExt.define('MomBaby.view.common.CapturePicture', {\n    extend: 'Ext.Component',\n    xtype: 'capturepicture',\n\n    config: {\n        captured: false,\n        cls: 'picture-capture-area',\n        html: [\n            '<div class=\"picture-capture\">',\n                '<div class=\"icon\"><i class=\"icon-camera\"></i> \u5199\u771f\u9078\u629e</div>',\n                '<img class=\"image-tns\" />',\n                '<input type=\"file\" accept=\"image/*;capture=camera\" />', //Step 1\n            '</div>',\n        ].join('')\n    },\n\n    initialize: function() {\n        this.callParent(arguments);\n\n        this.file = this.element.down('input[type=file]');\n        this.img = this.element.down('img');\n        this.inputImg = new Image();\n        this.isChange = false;\n\n        this.file.on('change', this.setPicture, this); //Step 2\n\n        //FIX for webkit\n        this.createObjectURL = (window.webkitURL && window.webkitURL.createObjectURL) ? function(file) {\n            return window.webkitURL.createObjectURL(file);\n        } : (window.URL && window.URL.createObjectURL) ? function(file) {\n            return window.URL.createObjectURL(file);\n        } : undefined;\n    },\n\n    setPicture: function(event) {\n        this.isChange = true;\n        var files = event.target.files;\n        if (files.length === 1) {\n            var file = files[0];\n            if ( file.size == 0 ){\n                // \u30a2\u30e9\u30fc\u30c8\n                Ext.Msg.alert('\u30a2\u30e9\u30fc\u30c8', '\u9078\u629e\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u304c\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u307e\u305b\u3093\u3002');\n                return;\n            }\n\n            // \u753b\u50cf\u8868\u793a\n            var src = this.createObjectURL(file);\n            this.img.setStyle('display', 'block');\n            this.img.set({\n                src: src //Step 4\n            });\n            this.inputImg.src = src;\n            this.setCaptured(true);\n        }\n    },\n\n    setPictureWithUrl: function(url){\n        this.img.setStyle('display', 'block');\n        this.img.set({\n            src: url\n        });\n        this.inputImg.src = url;\n        this.setCaptured(true);\n    },\n\n    reset: function() {\n        this.img.setStyle('display', 'none');\n        this.img.set({\n            src: ''\n        });\n        this.inputImg.src = '';\n        this.isChange = false;\n        this.setCaptured(false);\n    },\n\n    getImageDataUrl: function() { //Step 6\n        var imgCanvas = document.createElement(\"canvas\"),\n            imgContext = imgCanvas.getContext(\"2d\");\n\n        if (this.getCaptured()) {\n            var num = this.inputImg.width / 320;\n            this.inputImg.width = 320;\n            this.inputImg.height = this.inputImg.height / num;\n\n            // Make sure canvas is as big as the picture\n            imgCanvas.width = this.inputImg.width;\n            imgCanvas.height = this.inputImg.height;\n\n            // Draw image into canvas element\n            imgContext.drawImage(this.inputImg, 0, 0, this.inputImg.width, this.inputImg.height);\n\n            // Return the image as a data URL\n            var url = imgCanvas.toDataURL(\"image/png\");\n            imgCanvas = null;\n            imgContext = null;\n            return url;\n        }\n    }\n});\n```\n\n\n## \u30b9\u30bf\u30a4\u30eb\n```css\n/* \u5199\u771f\u9078\u629e */\n.picture-capture-area {\n    background: #fff;\n    padding: 20px 0;\n    border-bottom: 1px solid #f0f0f0;\n}\n.picture-capture {\n    background-image: -webkit-linear-gradient(top, #d11966 0%, #a2134f 3%, #750d38 100%);\n    border-radius: 5px;\n    border:1px solid #750d38;\n    border-width:1px;\n    overflow: hidden;\n    margin: 0px auto;\n    width: 100px;\n    height: 100px;\n    position: relative;\n}\n.picture-capture input {\n    border: 0;\n    position: absolute;\n    cursor: pointer;\n    top: -2px;\n    right: -2px;\n    filter: alpha(opacity=0);\n    opacity: 0;\n    font-size: 1000px;\n}\n.picture-capture img {\n    position: absolute;\n    border-radius: 5px;\n    width: 100%;\n    height: 100%;\n    display:none;\n    background: #fff;\n}\n.picture-capture .icon {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    color:#fff;\n    text-align: center;\n    font-size: 16px;\n}\n.picture-capture .icon i { display:block; font-size: 50px; color:#fff; height: 61px; }\n.picture-capture .icon-camera {}\n.picture-capture .icon-camera:before {\n    font-style: normal;\n    text-align: center;\n    font-family: 'Pictos';\n    content: \"v\";\n}\n```\n\n\n## \u30c7\u30fc\u30bf\u3092Ajax\u3067\u9001\u4fe1\u3059\u308b\n\n\u4e0b\u8a18\u306e\u30b3\u30fc\u30c9\u3067\u753b\u50cf\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3001\u9001\u4fe1\u3059\u308b\n\n```javascript\n// form\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304b\u3089\u53d6\u5f97\u3059\u308b\nvar capture = form.down('capturepicture');\nvar data = capture.getImageDataUrl();\n\n// Ajax\u9001\u4fe1\nExt.Ajax.request({\n    url: 'xxx',\n    method: 'POST',\n    params: { image: data },\n    success: function(response, opts){\n    },\n    failure: function(response, opts) {\n    },\n    scope: this\n});\n```\n\n\n## \u5b9f\u88c5\u6e08\u307f\u30a2\u30d7\u30ea\n* [MomBaby - \u598a\u5a20\u4e2d\u306e\u30de\u30de\u3068\u5b50\u80b2\u3066\u306e\u30de\u30de\u306b\u5f79\u7acb\u3064\u30a2\u30d7\u30ea](http://www.itmarlin.com/page-mom-baby.html) : [\u5404\u7a2e\u8a2d\u5b9a]-[\u89aa\u60c5\u5831\u753b\u9762]\u306a\u3069\n\n\n", "tags": ["Android", "Cordova", "SenchaTouch", "iOS", "JavaScript"]}