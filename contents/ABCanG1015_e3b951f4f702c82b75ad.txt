{"tags": ["JavaScript", "canvas", "HTML5"], "context": " More than 1 year has passed since last update.\u3044\u308d\u3044\u308d\u691c\u7d22\u3057\u3066\u307f\u305f\u3051\u3069\u3001canvas\u3067\u534a\u900f\u660e\u306a\u7dda\u3092\u66f8\u304f\u65b9\u6cd5\u304c\u898b\u3064\u304b\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u900f\u660e\u306a\u7dda\u304c\u5f15\u3051\u308b\u304a\u7d75\u304b\u304d\u30c4\u30fc\u30eb\u306e\u30bd\u30fc\u30b9\u3092\u8aad\u3093\u3067\u307e\u3068\u3081\u307e\u3057\u305f\u3002\n\n\u65b9\u6cd5\u305d\u306e1\nvar last_image, pos, down = false;\nvar canvas;\nvar ctx = canvas.getContext('2d');\nvar getPos =  function(evt) {\n    var rect = canvas.getBoundingClientRect();\n    return {\n        x: (evt.clientX - rect.left),\n        y: (evt.clientY - rect.top)\n    };\n};\n\ncanvas.addEventListener('mousedown', function (e) {\n    down = true;\n    last_image = ctx.getImageData(0, 0, canvas.width, canvas.height);\n    ctx.beginPath();\n    pos = getPos(e);\n    ctx.moveTo(pos.x, pos.y);\n}, false);\nwindow.addEventListener('mousemove', function (e) {\n    if (!down) return;\n    ctx.putImageData(last_image, 0, 0);\n    pos = getPos(e);\n    ctx.lineTo(pos.x, pos.y);\n    ctx.stroke();\n}, false);\nwindow.addEventListener('mouseup', function (e) {\n    if (!down) return;\n    ctx.putImageData(last_image, 0, 0);\n    pos = getPos(e);\n    ctx.lineTo(pos.x, pos.y);\n    ctx.stroke();\n    ctx.closePath();\n    down = false;\n}, false);\n\n\u3053\u306e\u65b9\u6cd5\u306f\u3001canvas\u306e\u72b6\u614b\u3092\u4fdd\u5b58\u3057\u3066\u304a\u3044\u3066\u3001mousemove\u3067\u6b21\u306e\u7dda\u3092\u5f15\u304f\u6642\u306b\u4fdd\u5b58\u3057\u3066\u304a\u3044\u305fcanvas\u306b\u623b\u3057\u3066\u304b\u3089\u5f15\u304d\u76f4\u3059\u3068\u3044\u3063\u305f\u65b9\u6cd5\u3067\u3059\u3002\ncanvas\u3092\u5143\u306e\u72b6\u614b\u306b\u623b\u3057\u3066\u3082\u3001path\u306f\u305d\u306e\u307e\u307e\u306a\u306e\u3067\u63cf\u304d\u59cb\u3081\u304b\u3089\u534a\u900f\u660e\u3067\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\ncanvas\u3092\u4e00\u3064\u3057\u304b\u4f7f\u3044\u305f\u304f\u306a\u3044\u5834\u5408\u306f\u3053\u306e\u65b9\u6cd5\u304c\u30aa\u30b9\u30b9\u30e1\u3067\u3059\u3002\n\n\u65b9\u6cd5\u305d\u306e2\nvar last_image, pos, down = false, last_pos;\nvar myCanvas, mainCanvas;\nvar myCtx = myCanvas.getContext('2d');\nvar mainCtx = mainCanvas.getContext('2d');\n\nvar getPos =  function(evt) {\n    var rect = mainCanvas.getBoundingClientRect();\n    return {\n        x: (evt.clientX - rect.left),\n        y: (evt.clientY - rect.top)\n    };\n};\n\nmainCanvas.addEventListener('mousedown', function (e) {\n    down = true;\n    myCtx.clearRect(0, 0, myCanvas.width, myCanvas.height);\n    myCtx.save();\n    last_image = mainCtx.getImageData(0, 0, mainCanvas.width, mainCanvas.height);\n\n    last_pos = getPos(e);\n    mainCtx.globalAlpha = myCtx.globalAlpha;\n    myCtx.globalAlpha = 1.0;\n}, false);\nwindow.addEventListener('mousemove', function (e) {\n    if (!down) return;\n    myCtx.beginPath();\n    myCtx.moveTo(last_pos.x, last_pos.y);\n    last_pos = getPos(e);\n    myCtx.lineTo(last_pos.x, last_pos.y);\n    myCtx.closePath();\n    myCtx.stroke();\n\n    mainCtx.putImageData(last_image, 0, 0);\n    mainCtx.drawImage(myCanvas, 0, 0);\n}, false);\nwindow.addEventListener('mouseup', function (e) {\n    if (!down) return;\n    myCtx.beginPath();\n    myCtx.moveTo(last_pos.x, last_pos.y);\n    last_pos = getPos(e);\n    myCtx.lineTo(last_pos.x, last_pos.y);\n    myCtx.stroke();\n    myCtx.closePath();\n    myCtx.restore();\n\n    mainCtx.save();\n    mainCtx.putImageData(last_image, 0, 0);\n    mainCtx.drawImage(myCanvas, 0, 0);\n    mainCtx.restore();\n\n    down = false;\n}, false);\n\n\u3053\u306e\u65b9\u6cd5\u306f\u3001\u305d\u306e1\u3092\u5c11\u3057\u5fdc\u7528\u3057\u305f\u3082\u306e\u3067\u3001\u63cf\u753b\u7528\u306ecanvas\u306b\u63cf\u3044\u3066\u3001\u305d\u308c\u3092\u8868\u793a\u7528\u306b\u534a\u900f\u660e\u306b\u3057\u3066\u30b3\u30d4\u30fc\u3059\u308b\u3068\u3044\u3063\u305f\u611f\u3058\u3067\u3059\u3002\ncanvas\u304c2\u3064\u5fc5\u8981\u3067\u3059\u304c\u3001\u4e00\u7b46\u306e\u9593\u306b\u8272\u3084\u592a\u3055\u3092\u5e30\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u30e1\u30ea\u30c3\u30c8\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u307e\u3068\u3081\n\u4e00\u7b46\u3067\u534a\u900f\u660e\u306a\u7dda\u3092\u66f8\u304f\u306b\u306f\u3001\u4e00\u65e6canvas\u3092\u4fdd\u5b58\u3057\u3066\u304a\u3044\u3066\u3001\u63cf\u753b\u3059\u308b\u305f\u3073\u306b\u5143\u306b\u623b\u3059\u4f5c\u696d\u304c\u5fc5\u8981\u307f\u305f\u3044\u3067\u3059\u3002(?)\n\u3044\u308d\u3044\u308d\u691c\u7d22\u3057\u3066\u307f\u305f\u3051\u3069\u3001canvas\u3067\u534a\u900f\u660e\u306a\u7dda\u3092\u66f8\u304f\u65b9\u6cd5\u304c\u898b\u3064\u304b\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u900f\u660e\u306a\u7dda\u304c\u5f15\u3051\u308b\u304a\u7d75\u304b\u304d\u30c4\u30fc\u30eb\u306e\u30bd\u30fc\u30b9\u3092\u8aad\u3093\u3067\u307e\u3068\u3081\u307e\u3057\u305f\u3002\n\n# \u65b9\u6cd5\u305d\u306e1\n\n```js\nvar last_image, pos, down = false;\nvar canvas;\nvar ctx = canvas.getContext('2d');\nvar getPos =  function(evt) {\n    var rect = canvas.getBoundingClientRect();\n    return {\n        x: (evt.clientX - rect.left),\n        y: (evt.clientY - rect.top)\n    };\n};\n\ncanvas.addEventListener('mousedown', function (e) {\n    down = true;\n    last_image = ctx.getImageData(0, 0, canvas.width, canvas.height);\n    ctx.beginPath();\n    pos = getPos(e);\n    ctx.moveTo(pos.x, pos.y);\n}, false);\nwindow.addEventListener('mousemove', function (e) {\n    if (!down) return;\n    ctx.putImageData(last_image, 0, 0);\n    pos = getPos(e);\n    ctx.lineTo(pos.x, pos.y);\n    ctx.stroke();\n}, false);\nwindow.addEventListener('mouseup', function (e) {\n    if (!down) return;\n    ctx.putImageData(last_image, 0, 0);\n    pos = getPos(e);\n    ctx.lineTo(pos.x, pos.y);\n    ctx.stroke();\n    ctx.closePath();\n    down = false;\n}, false);\n```\n\n\u3053\u306e\u65b9\u6cd5\u306f\u3001canvas\u306e\u72b6\u614b\u3092\u4fdd\u5b58\u3057\u3066\u304a\u3044\u3066\u3001mousemove\u3067\u6b21\u306e\u7dda\u3092\u5f15\u304f\u6642\u306b\u4fdd\u5b58\u3057\u3066\u304a\u3044\u305fcanvas\u306b\u623b\u3057\u3066\u304b\u3089\u5f15\u304d\u76f4\u3059\u3068\u3044\u3063\u305f\u65b9\u6cd5\u3067\u3059\u3002\ncanvas\u3092\u5143\u306e\u72b6\u614b\u306b\u623b\u3057\u3066\u3082\u3001path\u306f\u305d\u306e\u307e\u307e\u306a\u306e\u3067\u63cf\u304d\u59cb\u3081\u304b\u3089\u534a\u900f\u660e\u3067\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\ncanvas\u3092\u4e00\u3064\u3057\u304b\u4f7f\u3044\u305f\u304f\u306a\u3044\u5834\u5408\u306f\u3053\u306e\u65b9\u6cd5\u304c\u30aa\u30b9\u30b9\u30e1\u3067\u3059\u3002\n\n# \u65b9\u6cd5\u305d\u306e2\n\n```js\nvar last_image, pos, down = false, last_pos;\nvar myCanvas, mainCanvas;\nvar myCtx = myCanvas.getContext('2d');\nvar mainCtx = mainCanvas.getContext('2d');\n\nvar getPos =  function(evt) {\n    var rect = mainCanvas.getBoundingClientRect();\n    return {\n        x: (evt.clientX - rect.left),\n        y: (evt.clientY - rect.top)\n    };\n};\n\nmainCanvas.addEventListener('mousedown', function (e) {\n    down = true;\n    myCtx.clearRect(0, 0, myCanvas.width, myCanvas.height);\n    myCtx.save();\n    last_image = mainCtx.getImageData(0, 0, mainCanvas.width, mainCanvas.height);\n\n    last_pos = getPos(e);\n    mainCtx.globalAlpha = myCtx.globalAlpha;\n    myCtx.globalAlpha = 1.0;\n}, false);\nwindow.addEventListener('mousemove', function (e) {\n    if (!down) return;\n    myCtx.beginPath();\n    myCtx.moveTo(last_pos.x, last_pos.y);\n    last_pos = getPos(e);\n    myCtx.lineTo(last_pos.x, last_pos.y);\n    myCtx.closePath();\n    myCtx.stroke();\n\n    mainCtx.putImageData(last_image, 0, 0);\n    mainCtx.drawImage(myCanvas, 0, 0);\n}, false);\nwindow.addEventListener('mouseup', function (e) {\n    if (!down) return;\n    myCtx.beginPath();\n    myCtx.moveTo(last_pos.x, last_pos.y);\n    last_pos = getPos(e);\n    myCtx.lineTo(last_pos.x, last_pos.y);\n    myCtx.stroke();\n    myCtx.closePath();\n    myCtx.restore();\n\n    mainCtx.save();\n    mainCtx.putImageData(last_image, 0, 0);\n    mainCtx.drawImage(myCanvas, 0, 0);\n    mainCtx.restore();\n\n    down = false;\n}, false);\n```\n\n\u3053\u306e\u65b9\u6cd5\u306f\u3001\u305d\u306e1\u3092\u5c11\u3057\u5fdc\u7528\u3057\u305f\u3082\u306e\u3067\u3001\u63cf\u753b\u7528\u306ecanvas\u306b\u63cf\u3044\u3066\u3001\u305d\u308c\u3092\u8868\u793a\u7528\u306b\u534a\u900f\u660e\u306b\u3057\u3066\u30b3\u30d4\u30fc\u3059\u308b\u3068\u3044\u3063\u305f\u611f\u3058\u3067\u3059\u3002\ncanvas\u304c2\u3064\u5fc5\u8981\u3067\u3059\u304c\u3001\u4e00\u7b46\u306e\u9593\u306b\u8272\u3084\u592a\u3055\u3092\u5e30\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u30e1\u30ea\u30c3\u30c8\u304c\u3042\u308a\u307e\u3059\u3002\n\n# \u307e\u3068\u3081\n\n\u4e00\u7b46\u3067\u534a\u900f\u660e\u306a\u7dda\u3092\u66f8\u304f\u306b\u306f\u3001\u4e00\u65e6canvas\u3092\u4fdd\u5b58\u3057\u3066\u304a\u3044\u3066\u3001\u63cf\u753b\u3059\u308b\u305f\u3073\u306b\u5143\u306b\u623b\u3059\u4f5c\u696d\u304c\u5fc5\u8981\u307f\u305f\u3044\u3067\u3059\u3002(?)\n\n"}