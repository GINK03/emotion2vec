{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\nLinux\u30b5\u30fc\u30d0\u4e0a\u306b\u69cb\u7bc9\u3057\u305fOracle 11g\u30b5\u30fc\u30d0(11.1.0.7.2)\u306b\u304a\u3044\u3066\u3001Oracle\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u63a5\u7d9a\u3057\u3066\u3044\u308b\u5404\u30bb\u30c3\u30b7\u30e7\u30f3\u306eCPU\u4f7f\u7528\u7387\u3092\u8868\u793a\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u3064\u3044\u3066\u8a18\u8f09\u81f4\u3057\u307e\u3059\u3002\n\n\u6982\u8981\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u904b\u7528\u3059\u308b\u4e0a\u3067\u3001CPU\u30ea\u30bd\u30fc\u30b9\u3084\u30c7\u30a3\u30b9\u30afI/O\u3084\u30e1\u30e2\u30ea\u7b49\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u591a\u3081\u306b\u5360\u6709\u3057\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u52d5\u4f5c\u306b\u652f\u969c\u3092\u53ca\u307c\u3059\u3088\u3046\u306a\u3001\u9ad8\u8ca0\u8377\u306aSQL\u304c\u306a\u3044\u304b\u8abf\u67fb\u3057\u3066\u3044\u304f\u4e8b\u306f\u91cd\u8981\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\u5f8c\u8ff0\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u30b9\u30af\u30ea\u30d7\u30c8\u5b9f\u884c\u6642\u70b9\u3067\u3001Oracle\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u63a5\u7d9a\u4e2d\u306e\u5404\u30bb\u30c3\u30b7\u30e7\u30f3\u306eCPU\u4f7f\u7528\u7387\u3092\u8868\u793a\u51fa\u6765\u307e\u3059\u3002\nOracle\u306eStatspack\u3084AWR\u30ec\u30dd\u30fc\u30c8\u3067Oracle\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u7d71\u8a08\u60c5\u5831\u3092\u78ba\u8a8d\u3057\u3064\u3064\u3001Oracle\u30b5\u30fc\u30d0\u306e\u30ed\u30fc\u30c9\u30a2\u30d9\u30ec\u30fc\u30b8\u304c\u4e0a\u304c\u3063\u3066\u304d\u305f\u5834\u5408\u306a\u3069\u3001\u77ac\u9593\u7684\u306b\u3069\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u304cCPU\u3092\u5360\u6709\u3057\u3066\u3044\u308b\u304b\u3001\u624b\u8efd\u306b\u78ba\u8a8d\u3057\u305f\u3044\u6642\u306b\u5229\u7528\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u74b0\u5883\n\u30fbOracle 11g (11.1.0.7.2)\n\nOracle\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u4e2d\u306e\u5404\u30bb\u30c3\u30b7\u30e7\u30f3\u306eCPU\u4f7f\u7528\u7387\u3092\u8868\u793a\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\nOracle 11g\u30b5\u30fc\u30d0\u306e\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u5909\u6570\u306e\u5024\u306f\u30b5\u30f3\u30d7\u30eb\u7528\u306b\u4fee\u6b63\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n[oracle@example-oracle-11g-active ~]$ vi show_oracle_session_cpu.sh\n\n\nshow_oracle_session_cpu.sh\n#!/bin/sh\n\nSQL_TEXT=\"/\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea/show_oracle_session_cpu.sql\"\nREPORT_DATE=`date \"+%Y%m%d_%H%M%S\"`\nREPORT_FNAME=\"/tmp/show_oracle_session_cpu_report.txt\"\n\nif [ -r ${SQL_TEXT} ] ; then\n\n        sqlplus -S / as sysdba @${SQL_TEXT}\n\nfi\n\necho \"\"\nhostname\n\necho \"\"\ndate\n\nif [ -r \"${REPORT_FNAME}\" ] ; then\n        mv ${REPORT_FNAME} ${REPORT_FNAME}.${REPORT_DATE}\nfi\n\necho \"\"\necho \"more ${REPORT_FNAME}.${REPORT_DATE}\"\n\nif [ -r \"${REPORT_FNAME}.${REPORT_DATE}\" ] ; then\n        # SQL_ID\u307e\u3067\u8868\u793a\u3059\u308b\n#       awk 'BEGIN{FS=\"|\"}{print $1,$2,$3, $5, $7, $8, $11, $12, $15}' ${REPORT_FNAME}.${REPORT_DATE} | grep -v ^$ | more\n\n        # SQL_ID\u306f\u7701\u7565\u3057\u3066\u8868\u793a\u3059\u308b\n        awk 'BEGIN{FS=\"|\"}{print $1,$2,$3, $5, $7, $8, $11, $12}' ${REPORT_FNAME}.${REPORT_DATE} | grep -v ^$ | more\nfi\n\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u5b9f\u884c\u6a29\u9650\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n[oracle@example-oracle-11g-active ~]$ chmod 754 show_oracle_session_cpu.sh\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u5185\u3067\u5b9f\u884c\u3059\u308bSQL\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nSQL\u30d5\u30a1\u30a4\u30eb\u306b\u306fchmod 754\u306e\u3088\u3046\u306a\u5b9f\u884c\u6a29\u9650\u4ed8\u4e0e\u306f\u4e0d\u8981\u3067\u3059\u3002\n[oracle@example-oracle-11g-active ~]$ vi /\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea/show_oracle_session_cpu.sql\n\n\nshow_oracle_session_cpu.sql\nspool /tmp/show_oracle_session_cpu_report.txt\nSET echo off\nSET LINESIZE 300\nSET PAGESIZE 50;\nSET COLSEP |;\nSET FEEDBACK OFF;\nSET TERM OFF;\nCOLUMN USERNAME FORMAT A10;\nCOLUMN \"SID/SERIAL\" FORMAT A15;\nCOLUMN OSUSER FORMAT A10;\nCOLUMN MACHINE FORMAT A30;\nCOLUMN TERMINAL FORMAT A10;\nCOLUMN PROGRAM FORMAT A50;\nCOLUMN TYPE FORMAT A10;\nCOLUMN COMMAND FORMAT A20;\nCOLUMN \"\u7d4c\u904e\u6642\u9593(sec)\u3000\" FORMAT 9,999,999,990;\nCOLUMN \"CPU\u4f7f\u7528\u6642\u9593(sec)\" FORMAT 9,999,990.000;\nCOLUMN \"CPU\u5360\u6709\u7387(%)\" FORMAT 990.000;\nCOLUMN \"\u30d6\u30ed\u30c3\u30af\u53d6\u5f97\u56de\u6570\" FORMAT 9,999,999,990;\nCOLUMN \"\u7269\u7406\u8aad\u307f\u8fbc\u307f\u56de\u6570\" FORMAT 9,999,999,990;\nCOLUMN SQL_ID format a20\nTTITLE LEFT '\u3010 \u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u78ba\u8a8d \u3011' SKIP 1 LINE ;\nSELECT  A.SID || ',' || A.SERIAL# \"SID/SERIAL\",\n        A.OSUSER,\n        A.MACHINE,\n        A.TERMINAL,\n        A.PROGRAM,\n        A.TYPE,\n        A.USERNAME,\n        A.STATUS,\n        DECODE(A.COMMAND ,1,'CREATE TABLE' ,2,'INSERT' ,3,'SELECT' ,4,'CREATE CLUSTER' ,5,'ALTER CLUSTER' ,6,'UPDATE' ,7,'DELETE' ,8,'DROP CLUSTER' ,9,'CREATE INDEX' ,10,'DROP INDEX' ,11,'ALTER INDEX' ,12,'DROP TABLE' ,13,'CREATE SEQUENCE' ,14,'ALTER SEQUENCE' ,15,'ALTER TABLE' ,16,'DROP SEQUENCE' ,17,'GRANT' ,18,'REVOKE' ,19,'CREATE SYNONYM' ,20,'DROP SYNONYM' ,21,'CREATE VIEW' ,22,'DROP VIEW' ,23,'VALIDATE INDEX' ,24,'CREATE PROCEDURE' ,25,'ALTER PROCEDURE' ,26,'LOCK TABLE' ,27,'NO OPERATION' ,28,'RENAME' ,29,'COMMENT' ,30,'AUDIT' ,31,'NOAUDIT' ,32,'CREATE DATABASE LINK' ,33,'DROP DATABASE LINK' ,34,'CREATE DATABASE' ,35,'ALTER DATABASE' ,36,'CREATE ROLLBACK SEG' ,37,'ALTER ROLLBACK SEGM' ,38,'DROP ROLLBACK SEGME' ,39,'CREATE TABLESPACE' ,40,'ALTER TABLESPACE' ,41,'DROP TABLESPACE' ,42,'ALTER SESSION' ,43,'ALTER USE' ,44,'COMMIT' ,45,'ROLLBACK' ,46,'SAVEPOINT' ,47,'PL/SQL EXECUTE' ,48,'SET TRANSACTION' ,49,'ALTER SYSTEM SWITCH' ,50,'EXPLAIN' ,51,'CREATE USER' ,52,'CREATE ROLE' ,53,\n        'DROP USER' ,54,'DROP ROLE' ,55,'SET ROLE' ,56,'CREATE SCHEMA' ,57,'CREATE CONTROL FILE' ,58,'ALTER TRACING' ,59,'CREATE TRIGGER' ,60,'ALTER TRIGGER' ,61,'DROP TRIGGER' ,62,'ANALYZE TABLE' ,63,'ANALYZE INDEX' ,64,'ANALYZE CLUSTER' ,65,'CREATE PROFILE' ,66,'DROP PROFILE' ,67,'ALTER PROFILE' ,68,'DROP PROCEDURE' ,69,'DROP PROCEDURE' ,70,'ALTER RESOURCE COST' ,71,'CREATE SNAPSHOT LOG' ,72,'ALTER SNAPSHOT LOG' ,73,'DROP SNAPSHOT LOG' ,74,'CREATE SNAPSHOT' ,75,'ALTER SNAPSHOT' ,76,'DROP SNAPSHOT' ,79,'ALTER SESSION' ,85,'TRUNCATE TABLE' ,86,'TRUNCATE COUSTER' ,88,'ALTER VIEW' ,91,'CREATE FUNCTION' ,92,'ALTER FUNCTION' ,93,'DROP FUNCTION' ,94,'CREATE PACKAGE' ,95,'ALTER PACKAGE' ,96,'DROP PACKAGE' ,97,'CREATE PACKAGE BODY' ,98,'ALTER PACKAGE BODY' ,99,'DROP PACKAGE BODY' ,'\u5f85\u6a5f\u4e2d') COMMAND ,\n        (sysdate - a.logon_time)*86400 \"\u7d4c\u904e\u6642\u9593(sec)\",\n        b.value  /100 \"CPU\u4f7f\u7528\u6642\u9593(sec)\",\n        b.value  /((sysdate - a.logon_time)*86400+1) \"CPU\u5360\u6709\u7387(%)\",\n        c.block_gets \"\u30d6\u30ed\u30c3\u30af\u53d6\u5f97\u56de\u6570\",\n        c.physical_reads \"\u7269\u7406\u8aad\u307f\u8fbc\u307f\u56de\u6570\",\n        A.SQL_ID\nFROM    v$session a,\n        v$sesstat b,\n        v$sess_io c,\n        v$statname d\nWHERE   a.sid        = b.sid\n    AND b.sid        = c.sid\n    AND b.statistic# = d.statistic#\n    AND d.name like '%CPU%session'\nORDER BY\n        \"CPU\u5360\u6709\u7387(%)\" desc\n;\nspool off\nexit\n\n\n\nOracle 11g\u30b5\u30fc\u30d0\u3067\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u5b9f\u884c\u4f8b\nOralce 11g\u30b5\u30fc\u30d0\u306boracle\u30e6\u30fc\u30b6\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3001\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u3088\u3046\u306bOracle\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u63a5\u7d9a\u4e2d\u306e\u5404\u30bb\u30c3\u30b7\u30e7\u30f3\u306eCPU\u4f7f\u7528\u7387\u3092\u8868\u793a\u51fa\u6765\u307e\u3059\u3002\n\u3010 \u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u78ba\u8a8d \u3011\u90e8\u5206\u306b\u3001\u5404\u30bb\u30c3\u30b7\u30e7\u30f3\u306eCPU\u4f7f\u7528\u7387(CPU\u5360\u6709\u7387)\u3068CPU\u4f7f\u7528\u6642\u9593\u3092\u8868\u793a\u3057\u3001Oracle\u3078\u63a5\u7d9a\u3057\u3066\u3044\u308b\u30b5\u30fc\u30d0\u306e\u4e2d\u3067\u3001\u3069\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u304cCPU\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\u306e\u306b\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\u306a\u304a\u3001\u4ee5\u4e0b\u306b\u8a18\u8f09\u3057\u3066\u3044\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u5b9f\u884c\u7d50\u679c\u306e\u30e6\u30fc\u30b6\u540d\u7b49\u306f\u30b5\u30f3\u30d7\u30eb\u7528\u306b\u4fee\u6b63\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n[oracle@example-oracle-11g-active ~]$ ./show_oracle_session_cpu.sh\n\nexample-oracle-11g-active\n\n2015\u5e74  X\u6708 XX\u65e5 X\u66dc\u65e5 XX:XX:XX JST\n\nmore /tmp/show_oracle_session_cpu_report.txt.XXXXXXXX_XXXXXX\n\n\u3010 \u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u78ba\u8a8d \u3011\n\n\n\nSID/SERIAL      OSUSER     MACHINE                        PROGRAM                                            USERNAME          STATUS   CPU\u4f7f\u7528\u6642\u9593(sec) CPU\u5360\u6709\u7387(%)\n--------------- ---------- ------------------------------ -------------------------------------------------- ----------------- -------- ---------------- ------------\n8389,3669       example1   server1.example.com            httpd@server1.example.com (TNS V1-V3)              EXAMPLE_USER      ACTIVE              0.520       26.000\n4262,68         example2   server2.example.com            httpd@server2.example.com (TNS V1-V3)              EXAMPLE_USER      ACTIVE              0.970       24.250\n8662,45860      example3   server3.example.com            php@server3.example.com (TNS V1-V3)                EXAMPLE_USER      INACTIVE            5.450       20.185\n6465,59209      example3   server3.example.com            php@server3.example.com (TNS V1-V3)                EXAMPLE_USER      ACTIVE              0.490       16.333\n7994,51606      example4   server4.example.com            ruby@server4.example.com (TNS V1-V3)               EXAMPLE_USER      INACTIVE           98.400       15.871\n8643,669        example5   server5.example.com            ruby@server5.example.com (TNS V1-V3)               EXAMPLE_USER      ACTIVE        207,200.380        8.163\n\u3000\u3000(\u7701\u7565)\n\n\u9ad8\u8ca0\u8377\u306aSQL\u3092\u63a2\u3059\u6642\u306e\u53c2\u8003\u60c5\u5831\u3068\u3057\u3066\u3001\u3054\u53c2\u8003\u306b\u306a\u308a\u307e\u3057\u305f\u3089\u5e78\u3044\u3067\u3059\u3002\n\u4ee5\u4e0a\u306b\u306a\u308a\u307e\u3059\u3002\n\u306f\u3058\u3081\u306b\n===\n\nLinux\u30b5\u30fc\u30d0\u4e0a\u306b\u69cb\u7bc9\u3057\u305fOracle 11g\u30b5\u30fc\u30d0(11.1.0.7.2)\u306b\u304a\u3044\u3066\u3001Oracle\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u63a5\u7d9a\u3057\u3066\u3044\u308b\u5404\u30bb\u30c3\u30b7\u30e7\u30f3\u306eCPU\u4f7f\u7528\u7387\u3092\u8868\u793a\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u3064\u3044\u3066\u8a18\u8f09\u81f4\u3057\u307e\u3059\u3002\n\n\u6982\u8981\n===\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u904b\u7528\u3059\u308b\u4e0a\u3067\u3001CPU\u30ea\u30bd\u30fc\u30b9\u3084\u30c7\u30a3\u30b9\u30afI/O\u3084\u30e1\u30e2\u30ea\u7b49\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u591a\u3081\u306b\u5360\u6709\u3057\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u52d5\u4f5c\u306b\u652f\u969c\u3092\u53ca\u307c\u3059\u3088\u3046\u306a\u3001\u9ad8\u8ca0\u8377\u306aSQL\u304c\u306a\u3044\u304b\u8abf\u67fb\u3057\u3066\u3044\u304f\u4e8b\u306f\u91cd\u8981\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u5f8c\u8ff0\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u30b9\u30af\u30ea\u30d7\u30c8\u5b9f\u884c\u6642\u70b9\u3067\u3001Oracle\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u63a5\u7d9a\u4e2d\u306e\u5404\u30bb\u30c3\u30b7\u30e7\u30f3\u306eCPU\u4f7f\u7528\u7387\u3092\u8868\u793a\u51fa\u6765\u307e\u3059\u3002\n\nOracle\u306eStatspack\u3084AWR\u30ec\u30dd\u30fc\u30c8\u3067Oracle\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u7d71\u8a08\u60c5\u5831\u3092\u78ba\u8a8d\u3057\u3064\u3064\u3001Oracle\u30b5\u30fc\u30d0\u306e\u30ed\u30fc\u30c9\u30a2\u30d9\u30ec\u30fc\u30b8\u304c\u4e0a\u304c\u3063\u3066\u304d\u305f\u5834\u5408\u306a\u3069\u3001\u77ac\u9593\u7684\u306b\u3069\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u304cCPU\u3092\u5360\u6709\u3057\u3066\u3044\u308b\u304b\u3001\u624b\u8efd\u306b\u78ba\u8a8d\u3057\u305f\u3044\u6642\u306b\u5229\u7528\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u74b0\u5883\n===\n\n\u30fbOracle 11g (11.1.0.7.2)\n\nOracle\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u4e2d\u306e\u5404\u30bb\u30c3\u30b7\u30e7\u30f3\u306eCPU\u4f7f\u7528\u7387\u3092\u8868\u793a\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\n===\n\nOracle 11g\u30b5\u30fc\u30d0\u306e\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u5909\u6570\u306e\u5024\u306f\u30b5\u30f3\u30d7\u30eb\u7528\u306b\u4fee\u6b63\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n\n```\n[oracle@example-oracle-11g-active ~]$ vi show_oracle_session_cpu.sh\n```\n\n```shell-session:show_oracle_session_cpu.sh\n#!/bin/sh\n\nSQL_TEXT=\"/\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea/show_oracle_session_cpu.sql\"\nREPORT_DATE=`date \"+%Y%m%d_%H%M%S\"`\nREPORT_FNAME=\"/tmp/show_oracle_session_cpu_report.txt\"\n\nif [ -r ${SQL_TEXT} ] ; then\n\n        sqlplus -S / as sysdba @${SQL_TEXT}\n\nfi\n\necho \"\"\nhostname\n\necho \"\"\ndate\n\nif [ -r \"${REPORT_FNAME}\" ] ; then\n        mv ${REPORT_FNAME} ${REPORT_FNAME}.${REPORT_DATE}\nfi\n\necho \"\"\necho \"more ${REPORT_FNAME}.${REPORT_DATE}\"\n\nif [ -r \"${REPORT_FNAME}.${REPORT_DATE}\" ] ; then\n        # SQL_ID\u307e\u3067\u8868\u793a\u3059\u308b\n#       awk 'BEGIN{FS=\"|\"}{print $1,$2,$3, $5, $7, $8, $11, $12, $15}' ${REPORT_FNAME}.${REPORT_DATE} | grep -v ^$ | more\n\n        # SQL_ID\u306f\u7701\u7565\u3057\u3066\u8868\u793a\u3059\u308b\n        awk 'BEGIN{FS=\"|\"}{print $1,$2,$3, $5, $7, $8, $11, $12}' ${REPORT_FNAME}.${REPORT_DATE} | grep -v ^$ | more\nfi\n```\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u5b9f\u884c\u6a29\u9650\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```\n[oracle@example-oracle-11g-active ~]$ chmod 754 show_oracle_session_cpu.sh\n```\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u5185\u3067\u5b9f\u884c\u3059\u308bSQL\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nSQL\u30d5\u30a1\u30a4\u30eb\u306b\u306fchmod 754\u306e\u3088\u3046\u306a\u5b9f\u884c\u6a29\u9650\u4ed8\u4e0e\u306f\u4e0d\u8981\u3067\u3059\u3002\n\n```\n[oracle@example-oracle-11g-active ~]$ vi /\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea/show_oracle_session_cpu.sql\n```\n\n```sql:show_oracle_session_cpu.sql\nspool /tmp/show_oracle_session_cpu_report.txt\nSET echo off\nSET LINESIZE 300\nSET PAGESIZE 50;\nSET COLSEP |;\nSET FEEDBACK OFF;\nSET TERM OFF;\nCOLUMN USERNAME FORMAT A10;\nCOLUMN \"SID/SERIAL\" FORMAT A15;\nCOLUMN OSUSER FORMAT A10;\nCOLUMN MACHINE FORMAT A30;\nCOLUMN TERMINAL FORMAT A10;\nCOLUMN PROGRAM FORMAT A50;\nCOLUMN TYPE FORMAT A10;\nCOLUMN COMMAND FORMAT A20;\nCOLUMN \"\u7d4c\u904e\u6642\u9593(sec)\u3000\" FORMAT 9,999,999,990;\nCOLUMN \"CPU\u4f7f\u7528\u6642\u9593(sec)\" FORMAT 9,999,990.000;\nCOLUMN \"CPU\u5360\u6709\u7387(%)\" FORMAT 990.000;\nCOLUMN \"\u30d6\u30ed\u30c3\u30af\u53d6\u5f97\u56de\u6570\" FORMAT 9,999,999,990;\nCOLUMN \"\u7269\u7406\u8aad\u307f\u8fbc\u307f\u56de\u6570\" FORMAT 9,999,999,990;\nCOLUMN SQL_ID format a20\nTTITLE LEFT '\u3010 \u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u78ba\u8a8d \u3011' SKIP 1 LINE ;\nSELECT  A.SID || ',' || A.SERIAL# \"SID/SERIAL\",\n        A.OSUSER,\n        A.MACHINE,\n        A.TERMINAL,\n        A.PROGRAM,\n        A.TYPE,\n        A.USERNAME,\n        A.STATUS,\n        DECODE(A.COMMAND ,1,'CREATE TABLE' ,2,'INSERT' ,3,'SELECT' ,4,'CREATE CLUSTER' ,5,'ALTER CLUSTER' ,6,'UPDATE' ,7,'DELETE' ,8,'DROP CLUSTER' ,9,'CREATE INDEX' ,10,'DROP INDEX' ,11,'ALTER INDEX' ,12,'DROP TABLE' ,13,'CREATE SEQUENCE' ,14,'ALTER SEQUENCE' ,15,'ALTER TABLE' ,16,'DROP SEQUENCE' ,17,'GRANT' ,18,'REVOKE' ,19,'CREATE SYNONYM' ,20,'DROP SYNONYM' ,21,'CREATE VIEW' ,22,'DROP VIEW' ,23,'VALIDATE INDEX' ,24,'CREATE PROCEDURE' ,25,'ALTER PROCEDURE' ,26,'LOCK TABLE' ,27,'NO OPERATION' ,28,'RENAME' ,29,'COMMENT' ,30,'AUDIT' ,31,'NOAUDIT' ,32,'CREATE DATABASE LINK' ,33,'DROP DATABASE LINK' ,34,'CREATE DATABASE' ,35,'ALTER DATABASE' ,36,'CREATE ROLLBACK SEG' ,37,'ALTER ROLLBACK SEGM' ,38,'DROP ROLLBACK SEGME' ,39,'CREATE TABLESPACE' ,40,'ALTER TABLESPACE' ,41,'DROP TABLESPACE' ,42,'ALTER SESSION' ,43,'ALTER USE' ,44,'COMMIT' ,45,'ROLLBACK' ,46,'SAVEPOINT' ,47,'PL/SQL EXECUTE' ,48,'SET TRANSACTION' ,49,'ALTER SYSTEM SWITCH' ,50,'EXPLAIN' ,51,'CREATE USER' ,52,'CREATE ROLE' ,53,\n        'DROP USER' ,54,'DROP ROLE' ,55,'SET ROLE' ,56,'CREATE SCHEMA' ,57,'CREATE CONTROL FILE' ,58,'ALTER TRACING' ,59,'CREATE TRIGGER' ,60,'ALTER TRIGGER' ,61,'DROP TRIGGER' ,62,'ANALYZE TABLE' ,63,'ANALYZE INDEX' ,64,'ANALYZE CLUSTER' ,65,'CREATE PROFILE' ,66,'DROP PROFILE' ,67,'ALTER PROFILE' ,68,'DROP PROCEDURE' ,69,'DROP PROCEDURE' ,70,'ALTER RESOURCE COST' ,71,'CREATE SNAPSHOT LOG' ,72,'ALTER SNAPSHOT LOG' ,73,'DROP SNAPSHOT LOG' ,74,'CREATE SNAPSHOT' ,75,'ALTER SNAPSHOT' ,76,'DROP SNAPSHOT' ,79,'ALTER SESSION' ,85,'TRUNCATE TABLE' ,86,'TRUNCATE COUSTER' ,88,'ALTER VIEW' ,91,'CREATE FUNCTION' ,92,'ALTER FUNCTION' ,93,'DROP FUNCTION' ,94,'CREATE PACKAGE' ,95,'ALTER PACKAGE' ,96,'DROP PACKAGE' ,97,'CREATE PACKAGE BODY' ,98,'ALTER PACKAGE BODY' ,99,'DROP PACKAGE BODY' ,'\u5f85\u6a5f\u4e2d') COMMAND ,\n        (sysdate - a.logon_time)*86400 \"\u7d4c\u904e\u6642\u9593(sec)\",\n        b.value  /100 \"CPU\u4f7f\u7528\u6642\u9593(sec)\",\n        b.value  /((sysdate - a.logon_time)*86400+1) \"CPU\u5360\u6709\u7387(%)\",\n        c.block_gets \"\u30d6\u30ed\u30c3\u30af\u53d6\u5f97\u56de\u6570\",\n        c.physical_reads \"\u7269\u7406\u8aad\u307f\u8fbc\u307f\u56de\u6570\",\n        A.SQL_ID\nFROM    v$session a,\n        v$sesstat b,\n        v$sess_io c,\n        v$statname d\nWHERE   a.sid        = b.sid\n    AND b.sid        = c.sid\n    AND b.statistic# = d.statistic#\n    AND d.name like '%CPU%session'\nORDER BY\n        \"CPU\u5360\u6709\u7387(%)\" desc\n;\nspool off\nexit\n```\n\nOracle 11g\u30b5\u30fc\u30d0\u3067\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u5b9f\u884c\u4f8b\n===\n\nOralce 11g\u30b5\u30fc\u30d0\u306boracle\u30e6\u30fc\u30b6\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3001\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u3088\u3046\u306bOracle\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u63a5\u7d9a\u4e2d\u306e\u5404\u30bb\u30c3\u30b7\u30e7\u30f3\u306eCPU\u4f7f\u7528\u7387\u3092\u8868\u793a\u51fa\u6765\u307e\u3059\u3002\n\n\u3010 \u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u78ba\u8a8d \u3011\u90e8\u5206\u306b\u3001\u5404\u30bb\u30c3\u30b7\u30e7\u30f3\u306eCPU\u4f7f\u7528\u7387(CPU\u5360\u6709\u7387)\u3068CPU\u4f7f\u7528\u6642\u9593\u3092\u8868\u793a\u3057\u3001Oracle\u3078\u63a5\u7d9a\u3057\u3066\u3044\u308b\u30b5\u30fc\u30d0\u306e\u4e2d\u3067\u3001\u3069\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u304cCPU\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\u306e\u306b\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u306a\u304a\u3001\u4ee5\u4e0b\u306b\u8a18\u8f09\u3057\u3066\u3044\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u5b9f\u884c\u7d50\u679c\u306e\u30e6\u30fc\u30b6\u540d\u7b49\u306f\u30b5\u30f3\u30d7\u30eb\u7528\u306b\u4fee\u6b63\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n\n```\n[oracle@example-oracle-11g-active ~]$ ./show_oracle_session_cpu.sh\n\nexample-oracle-11g-active\n\n2015\u5e74  X\u6708 XX\u65e5 X\u66dc\u65e5 XX:XX:XX JST\n\nmore /tmp/show_oracle_session_cpu_report.txt.XXXXXXXX_XXXXXX\n\n\u3010 \u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u78ba\u8a8d \u3011\n\n\n\nSID/SERIAL      OSUSER     MACHINE                        PROGRAM                                            USERNAME          STATUS   CPU\u4f7f\u7528\u6642\u9593(sec) CPU\u5360\u6709\u7387(%)\n--------------- ---------- ------------------------------ -------------------------------------------------- ----------------- -------- ---------------- ------------\n8389,3669       example1   server1.example.com            httpd@server1.example.com (TNS V1-V3)              EXAMPLE_USER      ACTIVE              0.520       26.000\n4262,68         example2   server2.example.com            httpd@server2.example.com (TNS V1-V3)              EXAMPLE_USER      ACTIVE              0.970       24.250\n8662,45860      example3   server3.example.com            php@server3.example.com (TNS V1-V3)                EXAMPLE_USER      INACTIVE            5.450       20.185\n6465,59209      example3   server3.example.com            php@server3.example.com (TNS V1-V3)                EXAMPLE_USER      ACTIVE              0.490       16.333\n7994,51606      example4   server4.example.com            ruby@server4.example.com (TNS V1-V3)               EXAMPLE_USER      INACTIVE           98.400       15.871\n8643,669        example5   server5.example.com            ruby@server5.example.com (TNS V1-V3)               EXAMPLE_USER      ACTIVE        207,200.380        8.163\n\u3000\u3000(\u7701\u7565)\n```\n\n\u9ad8\u8ca0\u8377\u306aSQL\u3092\u63a2\u3059\u6642\u306e\u53c2\u8003\u60c5\u5831\u3068\u3057\u3066\u3001\u3054\u53c2\u8003\u306b\u306a\u308a\u307e\u3057\u305f\u3089\u5e78\u3044\u3067\u3059\u3002\n\n\u4ee5\u4e0a\u306b\u306a\u308a\u307e\u3059\u3002\n", "tags": ["oracle", "ShellScript", "SQL"]}