{"context": " More than 1 year has passed since last update.Sensu\u306e\u7ba1\u7406\u3092Chef\u3067\u884c\u3046\u5834\u5408\u3001subscriptions\u306e\u8a2d\u5b9a\u3092\u3069\u3046\u3059\u308b\u304b\u8003\u3048\u305f\u7d50\u679c\n\u4e0b\u8a18\u306e\u3088\u3046\u306btemplate\u5074\u3067\u307e\u3068\u3081\u308b\u3068\u3044\u3046\u65b9\u6cd5\u304c\u3042\u308b\u306e\u304b\u306a\u3068\u601d\u3063\u305f\u306e\u3067\u3059\u304c\n(attributes\u306frole to role\u306e\u307fmerge\u3055\u308c\u308b\u3002\u305d\u306e\u969b\u306bnode\u306eattributes\u306f\u7834\u68c4\u3055\u308c\u3066\u3057\u307e\u3046\u306e\u3067)\n\u4ed6\u306b\u4f55\u304b\u826f\u3044\u65b9\u6cd5\u3042\u308a\u307e\u3059\u304b\u306d\u3002\n\u3082\u3057\u304f\u306f\u305d\u3082\u305d\u3082\u79c1\u306e\u8a8d\u8b58\u306b\u8aa4\u308a\u304c\u3042\u308b\u53ef\u80fd\u6027\u304c\u9ad8\u3044\u306e\u3067\u3001\n\u3054\u6307\u6458\u9802\u3051\u308c\u3070\u3042\u308a\u304c\u305f\u3044\u3067\u3059\u3002\n\nroles/web_foo.json\n\n  \"sensu\": {\n      \"node_subscriptions\": [ \n          \"web_foo\"\n      ]\n  },\n  \"run_list\": [ \"role[web]\" ]\n\n\n/roles/web.json\n\n{\n  \"name\": \"web\",\n  \"description\": \"web\",\n  \"json_class\": \"Chef::Role\",\n  \"override_attributes\": {\n      \"sensu\": {\n        \"role_subscriptions\": [ \"web\" ]\n      }\n  },\n  \"default_attributes\": {\n  },\n  \"chef_type\": \"role\",\n  \"run_list\": [\n    \"role[base]\"\n  ]\n}\n\n\nroles/base.json\n\n{\n  \"name\": \"base\",\n  \"description\": \"base\",\n  \"json_class\": \"Chef::Role\",\n  \"override_attributes\": {\n      \"sensu\": {\n        \"role_subscriptions\": [ \"all\" ]\n      }\n  },\n  \"default_attributes\": {\n  },\n  \"chef_type\": \"role\",\n  \"run_list\": [\n    \"recipe[sensu-settings]\"\n  ]\n}\n\n\nsensu-settings/recipes/default.rb\n\ntemplate \"/etc/sensu/conf.d/client.json\" do\n  owner \"root\"\n  mode  0644\n  source \"client.json.erb\"\nend\n\n\nclient.json.erb\n\n{\n  \"client\": {\n    \"name\": \"<%= node[:hostname] %>\",\n    \"address\": \"<%= node[:ipaddress] %>\",\n<% _subscription = Array.new %>\n<% _subscription += node[:sensu][:node_subscriptions]  %>\n<% _subscription += node[:sensu][:role_subscriptions]  %>\n    \"subscriptions\": <%= _subscription %>\n  }\n}\n\n\nclient.json\n\n{\n  \"client\": {\n    \"name\": \"HOSTNAME\",\n    \"address\": \"IPADDR\",\n    \"subscriptions\": [\"web_foo\", \"all\", \"web\"]\n  }\n}\n\nSensu\u306e\u7ba1\u7406\u3092Chef\u3067\u884c\u3046\u5834\u5408\u3001`subscriptions`\u306e\u8a2d\u5b9a\u3092\u3069\u3046\u3059\u308b\u304b\u8003\u3048\u305f\u7d50\u679c\n\u4e0b\u8a18\u306e\u3088\u3046\u306btemplate\u5074\u3067\u307e\u3068\u3081\u308b\u3068\u3044\u3046\u65b9\u6cd5\u304c\u3042\u308b\u306e\u304b\u306a\u3068\u601d\u3063\u305f\u306e\u3067\u3059\u304c\n(attributes\u306frole to role\u306e\u307fmerge\u3055\u308c\u308b\u3002\u305d\u306e\u969b\u306bnode\u306eattributes\u306f\u7834\u68c4\u3055\u308c\u3066\u3057\u307e\u3046\u306e\u3067)\n\u4ed6\u306b\u4f55\u304b\u826f\u3044\u65b9\u6cd5\u3042\u308a\u307e\u3059\u304b\u306d\u3002\n\n\u3082\u3057\u304f\u306f\u305d\u3082\u305d\u3082\u79c1\u306e\u8a8d\u8b58\u306b\u8aa4\u308a\u304c\u3042\u308b\u53ef\u80fd\u6027\u304c\u9ad8\u3044\u306e\u3067\u3001\n\u3054\u6307\u6458\u9802\u3051\u308c\u3070\u3042\u308a\u304c\u305f\u3044\u3067\u3059\u3002\n\n- roles/web_foo.json\n\n```json\n  \"sensu\": {\n      \"node_subscriptions\": [ \n          \"web_foo\"\n      ]\n  },\n  \"run_list\": [ \"role[web]\" ]\n```\n\n- /roles/web.json\n\n```json\n{\n  \"name\": \"web\",\n  \"description\": \"web\",\n  \"json_class\": \"Chef::Role\",\n  \"override_attributes\": {\n      \"sensu\": {\n        \"role_subscriptions\": [ \"web\" ]\n      }\n  },\n  \"default_attributes\": {\n  },\n  \"chef_type\": \"role\",\n  \"run_list\": [\n    \"role[base]\"\n  ]\n}\n```\n\n- roles/base.json\n\n```json\n{\n  \"name\": \"base\",\n  \"description\": \"base\",\n  \"json_class\": \"Chef::Role\",\n  \"override_attributes\": {\n      \"sensu\": {\n        \"role_subscriptions\": [ \"all\" ]\n      }\n  },\n  \"default_attributes\": {\n  },\n  \"chef_type\": \"role\",\n  \"run_list\": [\n    \"recipe[sensu-settings]\"\n  ]\n}\n```\n\n- sensu-settings/recipes/default.rb\n\n```rb\ntemplate \"/etc/sensu/conf.d/client.json\" do\n  owner \"root\"\n  mode  0644\n  source \"client.json.erb\"\nend\n```\n\n\n- client.json.erb\n\n```erb\n{\n  \"client\": {\n    \"name\": \"<%= node[:hostname] %>\",\n    \"address\": \"<%= node[:ipaddress] %>\",\n<% _subscription = Array.new %>\n<% _subscription += node[:sensu][:node_subscriptions]  %>\n<% _subscription += node[:sensu][:role_subscriptions]  %>\n    \"subscriptions\": <%= _subscription %>\n  }\n}\n```\n\n- client.json\n\n```json\n{\n  \"client\": {\n    \"name\": \"HOSTNAME\",\n    \"address\": \"IPADDR\",\n    \"subscriptions\": [\"web_foo\", \"all\", \"web\"]\n  }\n}\n```\n", "tags": ["Sensu0.12", "chef11.4.4"]}