{"tags": ["serverless", "AWS", "APIGateway", "Node.js"], "context": "\n\n\u306f\u3058\u3081\u306b\n\u7686\u3055\u3093\u3054\u5b58\u77e5\u3001SERVERLESS\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3002\u50d5\u306f\u6700\u8fd1\u3069\u3063\u3077\u308a\u3053\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306b\u6d78\u304b\u3063\u3066\u304a\u308a\u307e\u3059\u3002\u9032\u5316\u304c\u65e9\u304f\u3066\u3064\u3044\u3066\u3044\u304f\u306e\u304c\u5927\u5909\u3067\u3059\u3002\nSERVERLESS\u3063\u3066API Gateway\u4f5c\u308b\u3088\u306d\uff1f\u3063\u3066\u3053\u3068\u306fHTTP\u30d7\u30ed\u30ad\u30b7\u3068\u3057\u3066\u3082\u4f5c\u308c\u308b\u3093\u3058\u3083\u306d\uff1f\u3063\u3066\u306a\u3063\u3066\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u524d\u7de8\uff1a\u30d1\u30b9\u3084\u30af\u30a8\u30ea\u30b9\u30c8\u30ea\u30f3\u30b0\u304c\u6c7a\u307e\u3063\u3066\u3044\u308b\u5834\u5408\u306eHTTP\u30d7\u30ed\u30ad\u30b7\u306e\u4f5c\u308a\u65b9\n\u5f8c\u7de8\uff1a\u6d41\u884c\u308a\u306e{proxy+}\uff08\u30aa\u30fc\u30eb\u30b9\u30eb\u30fc\uff09\u306eHTTP\u30d7\u30ed\u30ad\u30b7\u306e\u4f5c\u308a\u65b9\n\n\u3053\u3093\u306a\u611f\u3058\u306e\u69cb\u6210\u3067\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u8a18\u4e8b\u306f\u5f8c\u7de8\u306b\u306a\u308a\u307e\u3059\u3002\u524d\u7de8\u3067\u4f5c\u3063\u305fService\u3092\u66f8\u304d\u63db\u3048\u3066\u4f5c\u3063\u3066\u3044\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u5b9f\u65bd\u74b0\u5883\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3067\u3059\u3002\u5b9f\u65bd\u3055\u308c\u308b\u65b9\u306f\u3001\u5fc5\u8981\u306a\u3082\u306e\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nAWS\u30a2\u30ab\u30a6\u30f3\u30c8\naws-cli v1.10.47\nserverless v1.1.0\n\n\u307e\u305f\u3001\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9\u306f\u4e0b\u8a18\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nSERVERLESS\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30afv1.0\u6b63\u5f0f\u30ea\u30ea\u30fc\u30b9\u7248\u3092\u89e6\u3063\u3066\u307f\u305f\n\n\u30aa\u30fc\u30eb\u30b9\u30eb\u30fcHTTP\u30d7\u30ed\u30ad\u30b7\u3092\u4f5c\u308b\n\n\u3053\u306e\u8a18\u4e8b\u306e\u30b4\u30fc\u30eb\n\u4eca\u56de\u306e\u30d7\u30ed\u30ad\u30b7\u5148\u3082\u3001\u56f3\u66f8\u9928\u306e\u691c\u7d22\u304c\u3067\u304d\u308bAPI \u30ab\u30fc\u30ea\u30eb\u3092\u4f7f\u308f\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3059\u3002\u3053\u306eAPI\u306f\u3001/library\u3067\u56f3\u66f8\u9928\u691c\u7d22\u3001/check\u3067\u305d\u306e\u56f3\u66f8\u9928\u306b\u6307\u5b9a\u3057\u305f\u672c\u304c\u5b58\u5728\u3057\u3066\u3044\u308b\u304b\u304c\u308f\u304b\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u3092\u3001\u4eca\u56de\u4f5c\u6210\u3059\u308bAPIGW\u304b\u3089\u30d1\u30b9\u3084\u30af\u30a8\u30ea\u30b9\u30c8\u30ea\u30f3\u30b0\u3092\u305d\u306e\u307e\u307e\u306b\u3001\u30ab\u30fc\u30ea\u30eb\u3078\u6295\u3052\u3066\u304f\u308c\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u5b8c\u6210\u30a4\u30e1\u30fc\u30b8\u306f\u3053\u3093\u306a\u611f\u3058\u3002\u4eca\u56de\u306fCORS\u306e\u8a2d\u5b9a\u307e\u3067\u3057\u307e\u3057\u3087\u3046\uff08\u672c\u5f53\u306bCORS\u304c\u52b9\u3044\u3066\u3044\u308b\u304b\u306f\u672a\u691c\u8a3c\u3067\u3059\uff09\u3002\n\n\u5177\u4f53\u7684\u306b\u306f\u3001\n\nhttps://~~~~.amazonaws.com/library?appkey=hogehoge&pref=\u6771\u4eac \u306eGET\u30a2\u30af\u30bb\u30b9\u304c\u6765\u305f\u5834\u5408\n\n\n\nhttps://api.calil.jp/library?appkey=hogehoge&pref=\u6771\u4eac \u3092APIGW\u304c\u6295\u3052\u308b\n\n\nhttps://~~~~.amazonaws.com/check?appkey=hogehoge&isbn=4834000826&systemid=Aomori_Pref&format=json \u306eGET\u30a2\u30af\u30bb\u30b9\u304c\u6765\u305f\u5834\u5408\n\n\n\nhttps://api.calil.jp/check?appkey=hogehoge&isbn=4834000826&systemid=Aomori_Pref&format=json \u3092APIGW\u304c\u6295\u3052\u308b\n\n\n\n\u3068\u3044\u3046\u611f\u3058\u3067\u3059\u3002\u3053\u308c\u3092\u30011\u30641\u3064\u30d1\u30b9\u3084\u30af\u30a8\u30ea\u30b9\u30c8\u30ea\u30f3\u30b0\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u306a\u304f\u5b9f\u73fe\u3057\u307e\u3059\u3002\u67d4\u8edf\u306b\u5bfe\u5fdc\u3057\u3066\u304f\u308c\u308bHTTP\u30d7\u30ed\u30ad\u30b7\u3063\u3066\u611f\u3058\u3067\u3059\u306d\u3002\n\nHTTP\u30d7\u30ed\u30ad\u30b7\u306e\u69cb\u7bc9\n\u3055\u3066\u3001\u4eca\u56de\u306f\u3055\u3063\u305d\u304f\u30e1\u30a4\u30f3\u90e8\u5206\u3092\u89e6\u3063\u3066\u3044\u304d\u307e\u3059\u3002\u5b8c\u6210\u3057\u305fserverless.yml\u306f\u3053\u3093\u306a\u611f\u3058\u306b\u306a\u308a\u307e\u3059\uff08CORS\u306f\u3042\u3068\u3067\uff09\u3002\n\nserverless.yml\nframeworkVersion: \"=1.1.0\"\nservice: httpproxyonly\nprovider:\n    name: aws\n    runtime: nodejs4.3\nfunctions:\n  hello:\n    handler: handler.hello\n    events:\n        - http:\n            path: trash\n            method: get\n\n# resources\u306fCloudFormation\u3092YAML\u3067\u66f8\u304f\u611f\u3058\u3002\n# \u3053\u3053\u306bAPI Gateway\u3092HTTP\u30d7\u30ed\u30ad\u30b7\u3068\u3057\u3066\u4f5c\u308b\u8a2d\u5b9a\u3092\u66f8\u304d\u307e\u3059\u3002\nresources:\n    Resources:\n        CatchAllTestResource: # {proxy+}\u306e\u30ea\u30bd\u30fc\u30b9ID\uff08Method\u304b\u3089\u53c2\u7167\u3055\u308c\u308b\uff09\n            Type: AWS::ApiGateway::Resource\n            Properties:\n                ParentId:\n                    Fn::GetAtt:\n                        - ApiGatewayRestApi # SERVERLESS\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u4f5c\u6210\u3055\u308c\u308bAPI Gateway\u306eID\uff08\u3060\u3068\u601d\u3046\uff09\n                        - RootResourceId\n                PathPart: \"{proxy+}\" # \u30d7\u30ed\u30ad\u30b7\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\n                RestApiId:\n                    Ref: ApiGatewayRestApi\n        CatchAllTestMethod: # {proxy+}\u306e\u30e1\u30bd\u30c3\u30c9ID\n            Type: AWS::ApiGateway::Method\n            Properties:\n                AuthorizationType: NONE\n                ResourceId:\n                    Ref: CatchAllTestResource\n                RestApiId:\n                    Ref: ApiGatewayRestApi\n                HttpMethod: ANY # \u3053\u306e\u30d7\u30ed\u30ad\u30b7\u306b\u5165\u3063\u3066\u304f\u308b\u3068\u304d\u306e\u30e1\u30bd\u30c3\u30c9\n                RequestParameters: # \u5fc5\u9808\u304b\u3069\u3046\u304b\u306e\u5224\u65ad\n                    method.request.path.proxy: false\n                MethodResponses: # \u30d7\u30ed\u30ad\u30b7\u306e\u547c\u3073\u51fa\u3057\u5143\u3078\u8fd4\u3059HTTP\u30b9\u30c6\u30fc\u30bf\u30b9\u30b3\u30fc\u30c9\u306e\u3046\u3061\u3001\u3042\u308a\u5f97\u308b\u3082\u306e\n                    - StatusCode: 200\n                    - StatusCode: 400\n                    - StatusCode: 403\n                    - StatusCode: 500\n                Integration:\n                    IntegrationHttpMethod: ANY # \u30d7\u30ed\u30ad\u30b7\u5148\u306b\u6295\u3052\u308b\u3068\u304d\u306e\u30e1\u30bd\u30c3\u30c9\n                    Type: HTTP_PROXY # HTTP or HTTP_PROXY\n                    Uri: https://api.calil.jp/{proxy} # \u30d7\u30ed\u30ad\u30b7\u5148\u306eURL\uff08\u30d1\u30e9\u30e1\u30fc\u30bf\u4e0d\u8981\uff09\n                    RequestParameters:\n                        integration.request.path.proxy: method.request.path.proxy\n                    IntegrationResponses: # \u30d7\u30ed\u30ad\u30b7\u5148\u304b\u3089\u306e\u30ec\u30b9\u30dd\u30f3\u30b9HTTP\u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u30de\u30c3\u30d4\u30f3\u30b0\n                        - StatusCode: 200\n                        -\n                            StatusCode: 400\n                            SelectionPattern: \"400\" # \u30ec\u30b9\u30dd\u30f3\u30b9\u306eHTTP\u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u6b63\u898f\u8868\u73fe\n                        -\n                            StatusCode: 403\n                            SelectionPattern: \"403\"\n                        -\n                            StatusCode: 500\n                            SelectionPattern: \"500\"\n\n\n\u4eca\u56de\u3001\u91cd\u8981\u306a\u306e\u306f\u4ee5\u4e0b\u306e\u70b9\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u30ea\u30bd\u30fc\u30b9(CatchAllTestResource)\u306ePathPart\n\u30e1\u30bd\u30c3\u30c9(CatchAllTestMethod)\u306eRequestParameters(Integration\u5185\u306e\u3082\u542b\u3080)\nIntegration\u306eType\nIntegration\u306eUri\n\n\u9806\u756a\u306b\u898b\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\n\nPathPart\n\u3053\u306e\u90e8\u5206\u306f\u3001\u7279\u306b\u96e3\u3057\u304f\u3042\u308a\u307e\u305b\u3093\u3002APIGW\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u3067{proxy+}\u306b\u3059\u308b\u5834\u5408\u306f2016/11/09\u73fe\u5728\u3067\u306f\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u3092ON\u306b\u3059\u308c\u3070\u52dd\u624b\u306b\u30ea\u30bd\u30fc\u30b9\u306b{proxy+}\u3068\u306a\u308a\u307e\u3059\u3002\u5bfe\u3057\u3066\u3001CloudFormation\u3067\u306fPathPart\u3092{proxy+}\u3068\u8a2d\u5b9a\u3059\u308c\u3070\u52dd\u624b\u306bCloudFormation\u304c\u89e3\u91c8\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u3067\u3059\u3002\u4fbf\u5229\u3067\u3059\u306d\u3002\n\nRequestParameters\n\u3053\u306e\u90e8\u5206\u306f\u5c11\u3057\u30cf\u30de\u308a\u307e\u3057\u305f\u3002\n\u3053\u308c\u3092\u3084\u308a\u59cb\u3081\u305f\u3068\u304d\u306f\u3001{proxy+}\u306b\u3057\u3066\u3044\u308c\u3070\u30d1\u30b9\u306f\u3044\u3044\u611f\u3058\u306bAPIGW\u304c\u3084\u3063\u3066\u304f\u308c\u308b\u3068\u601d\u3063\u3066\u3044\u3066\u3001RequestParameters\u306b\u306f\u4f55\u3082\u8a2d\u5b9a\u3057\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u305d\u3046\u3057\u3066\u3044\u308b\u3068\u3001\u4f8b\u3048\u3070\u3001http://~~~.amazonawz.com/dev/library?appkey=hogehoge&pref=\u6c96\u7e04\u306bGET\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001APIGW\u306fhttps://api.calil.jp/{proxy}?appkey=hogehoge&pref=\u6c96\u7e04\u3068\u3044\u3046URL\u306bGET\u30ea\u30af\u30a8\u30b9\u30c8\u3057\u3066\u3044\u307e\u3057\u305f\u3002\u3053\u308c\u306f\u3001{proxy}\u3068\u3044\u3046\u6587\u5b57\u5217\u304cURL\u306b\u5165\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u3066\u3001library\u304c{proxy}\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3055\u308c\u3066\u3044\u306a\u3044\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\u3088\u3063\u3066\u3001\u4e0a\u8a18(serverless.yml)\u306e\u3088\u3046\u306bpath\u306eproxy\u3068\u3044\u3046\u5909\u6570\u3092\u30de\u30c3\u30d4\u30f3\u30b0\u3059\u308b\u8a2d\u5b9a\u3092\u8a18\u8ff0\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nIntegration\u306eType\n\u4ed6\u306eWeb\u30b5\u30fc\u30d0\u3078\u306eHTTP\u30d7\u30ed\u30ad\u30b7\u3092\u69cb\u7bc9\u3059\u308b\u5834\u5408\u3001\u3053\u3053\u306e\u8a2d\u5b9a\u306fHTTP\u304bHTTP_PROXY\u306e2\u629e\u306b\u306a\u308a\u307e\u3059\uff08\u3068\u601d\u3046\uff09\u3002\n\u524d\u7de8\u3067\u3082\u66f8\u304d\u307e\u3057\u305f\u304c\u3001HTTP\u306e\u5834\u5408\u306f\u30af\u30a8\u30ea\u30b9\u30c8\u30ea\u30f3\u30b0\u306e\u30de\u30c3\u30d4\u30f3\u30b0\u3092\u660e\u793a\u7684\u306b\u8a18\u8ff0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u8a00\u3044\u63db\u3048\u308b\u3068\u3001\u4e88\u3081\u66f8\u3044\u3066\u304a\u3044\u305f\u30af\u30a8\u30ea\u30b9\u30c8\u30ea\u30f3\u30b0\u306e\u307f\u30de\u30c3\u30d4\u30f3\u30b0\u3057\u3066\u304f\u308c\u308b\u305f\u3081\u3001\u958b\u767a\u8005\u306e\u610f\u56f3\u901a\u308a\u306e\u52d5\u304d\u3092\u3055\u305b\u3084\u3059\u3044\u3067\u3059\u3002\n\u5bfe\u3057\u3066HTTP_PROXY\u306e\u5834\u5408\u306f\u3001\u30af\u30a8\u30ea\u30b9\u30c8\u30ea\u30f3\u30b0\u306f\u3059\u3079\u3066\u305d\u306e\u307e\u307e\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u540d\u306e\u307e\u307e\u3001Web\u30b5\u30fc\u30d0\u3078\u6e21\u3057\u3066\u304f\u308c\u307e\u3059\u3002\u3053\u308c\u306f\u975e\u5e38\u306b\u4fbf\u5229\u3067\u3059\u304c\u3001\u4f8b\u3048\u3070\u30d7\u30ed\u30ad\u30b7\u5148\u306eAPI\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u540d\u3092\u79d8\u533f\u3057\u305f\u3044\u5834\u5408\uff08\u3053\u3093\u306a\u3053\u3068\u3042\u308b\u306e\u304b\u306a\uff1f\uff09\u306b\u306f\u3053\u308c\u306f\u4f7f\u3048\u306a\u3044\u3053\u3068\u306b\u306a\u308a\u305d\u3046\u3067\u3059\u3002\n\nIntegration\u306eUri\n\u3053\u3053\u306b\u306f\u3001\u30d7\u30ed\u30ad\u30b7\u5148\u306eURL\u3068\u3057\u3066\u5fc5\u305a{proxy}(proxy+\u3067\u306f\u306a\u3044)\u3092\u542b\u3081\u305fURL\u306b\u3057\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002APIGW\u306e\u30d1\u30b9\u306e{proxy+}\u306b\u5f53\u305f\u308b\u90e8\u5206\u304c{proxy}\u3078\u3068\u30de\u30c3\u30d4\u30f3\u30b0\u3055\u308c\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u8003\u616e\u3057\u305f\u8a2d\u5b9a\u3092\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u9577\u304f\u306a\u308a\u307e\u3057\u305f\u304c\u3001\u4e0a\u8a18serverless.yml\u306e\u3088\u3046\u306b\u66f8\u3051\u305f\u3089\u3001\u30c7\u30d7\u30ed\u30a4\u3057\u307e\u3057\u3087\u3046\u3002\u4e0a\u306b\u8f09\u305b\u305f\u753b\u50cf\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u306b\u306a\u3063\u3066\u3044\u308b\u306f\u305a\u3067\u3059\uff08OPTIONS\u30e1\u30bd\u30c3\u30c9\u306f\u307e\u3060\u4f5c\u3089\u308c\u3066\u3044\u306a\u3044\u306f\u305a\uff09\u3002\n\nAPI\u3092\u53e9\u3044\u3066\u307f\u308b\n\nhttps://[\u4eba\u306b\u3088\u308b].execute-api.us-east-1.amazonaws.com/dev/library?appkey=[\u4eba\u306b\u3088\u308b]&pref=\u6c96\u7e04\nhttps://[\u4eba\u306b\u3088\u308b].execute-api.us-east-1.amazonaws.com/dev/check?appkey=[\u4eba\u306b\u3088\u308b]&isbn=4834000826&systemid=Aomori_Pref&format=json\n\n\u3053\u306e2\u3064\u306b\u30d6\u30e9\u30a6\u30b6\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u30021\u3064\u76ee\u306fXML\u5f62\u5f0f\u306e\u56f3\u66f8\u9928\u4e00\u89a7\u30012\u3064\u76ee\u306fJSON\u5f62\u5f0f\u306e\u66f8\u7c4d\u8cb8\u51fa\u60c5\u5831\u3089\u3057\u304d\u3082\u306e\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308c\u3070\u6b63\u3057\u304f\u69cb\u7bc9\u3067\u304d\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\nCORS\u306e\u8a2d\u5b9a\uff08\u672a\u691c\u8a3c\uff09\n\u3055\u3066\u3001API\u3092Ajax\u3092\u4f7f\u3063\u3066\u53e9\u3051\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u306b\u306fCORS\u306e\u8a2d\u5b9a\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002APIGW\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089CORS\u306e\u8a2d\u5b9a\u3092\u3059\u308b\u306e\u306f\u975e\u5e38\u306b\u7c21\u5358\u30672\u301c3\u30af\u30ea\u30c3\u30af\u3067\u3067\u304d\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u3057\u304b\u3057\u3001\u3057\u304b\u3057\u3001\u3057\u304b\u30fc\u3057\u3001CloudFormation\u3067\u69cb\u7bc9\u3057\u305fAPI\u306bCORS\u3092\u8a2d\u5b9a\u3059\u308b\u306b\u306f\u9762\u5012\u306a\u8a2d\u5b9a\u3092\u30ea\u30bd\u30fc\u30b9\u3054\u3068\u306b\u66f8\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\uff08Allow-Origin\u306e\u8a2d\u5b9a\u3092\u7d30\u304b\u304f\u3059\u308b\u306e\u304c\u6b63\u3057\u3044\u306e\u3067\u3001\u4ed5\u65b9\u306a\u3044\u3093\u3067\u3059\u3051\u3069\u306d\u2026\u3002SERVERLESS\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067Lambda\u3068\u3064\u306a\u3050\u969b\u306eCORS\u306eAllow-Origin\u3092*\u306b\u3059\u308b\u5834\u5408\u306f\u3001true\u3068\u66f8\u304f\u3060\u3051\u3067\u3044\u3044\u306e\u3067\u4f59\u8a08\u306b\u9762\u5012\u306b\u611f\u3058\u3066\u3057\u307e\u3044\u307e\u3059\u3002\uff09\nCORS\u306e\u8a2d\u5b9a\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u884c\u3044\u307e\u3059\u3002\n\nserverless.yml\nframeworkVersion: \"=1.1.0\"\nservice: httpproxytest\nprovider:\n    name: aws\n    runtime: nodejs4.3\nfunctions:\n    # \u7701\u7565\n\nresources:\n    Resources:\n        CatchAllTestResource: # {proxy+}\u306e\u30ea\u30bd\u30fc\u30b9ID\uff08Method\u304b\u3089\u53c2\u7167\u3055\u308c\u308b\uff09\n            # \u7701\u7565\n        CatchAllTestMethod: # {proxy+}\u306e\u30e1\u30bd\u30c3\u30c9ID\n            # \u7701\u7565\n        OptionsMethod:\n            Type: AWS::ApiGateway::Method\n            Properties:\n                AuthorizationType: NONE\n                RestApiId:\n                    Ref: ApiGatewayRestApi\n                ResourceId:\n                    Ref: CatchAllTestResource # \u3053\u3053\u306bCORS\u3092\u9069\u7528\u3057\u305f\u3044\u30ea\u30bd\u30fc\u30b9ID\n                HttpMethod: OPTIONS # CORS\u306e\u8a2d\u5b9a\u306fOPTIONS\u30e1\u30bd\u30c3\u30c9\n                Integration:\n                    IntegrationResponses:\n                        -\n                            StatusCode: 200\n                            ResponseParameters: # Methods\u3084Origin\u306f\u9069\u5b9c\u5909\u66f4\u304c\u5fc5\u8981\u304b\u3068\n                                method.response.header.Access-Control-Allow-Headers: \"'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'\"\n                                method.response.header.Access-Control-Allow-Methods: \"'DELETE, GET, HEAD, OPTIONS, PATCH, POST, PUT'\"\n                                method.response.header.Access-Control-Allow-Origin: \"'*'\"\n                            ResponseTemplates:\n                                application/json: ''\n                    PassthroughBehavior: WHEN_NO_MATCH\n                    RequestTemplates:\n                        application/json: '{\"statusCode\": 200}'\n                    Type: MOCK\n                MethodResponses:\n                    -\n                        StatusCode: 200\n                        ResponseModels:\n                            application/json: 'Empty'\n                        ResponseParameters:\n                            method.response.header.Access-Control-Allow-Headers: false\n                            method.response.header.Access-Control-Allow-Methods: false\n                            method.response.header.Access-Control-Allow-Origin: false\n\n\n\u7c21\u5358\u306b\u4f7f\u3044\u305f\u3044\u65b9\u306f\u30b3\u30d4\u30da\u3057\u3066\u4f7f\u3063\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\u5927\u5909\u7533\u3057\u8a33\u7121\u3044\u3067\u3059\u304c\u3001Ajax\u304b\u3089\u53e9\u3051\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u304b\u306f\u672a\u691c\u8a3c\u3067\u3059\u3001\u3054\u3081\u3093\u306a\u3055\u3044\u3002\u3069\u306a\u305f\u304b\u5831\u544a\u3092\u3044\u305f\u3060\u3051\u308b\u3068\u52a9\u304b\u308a\u307e\u3059\u3002\n\n\u756a\u5916\u7de8\uff1aResource\u3092\u5916\u90e8\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304f\nserverless.yml\u304c\u3084\u305f\u3089\u3068\u80a5\u5927\u5316\u3057\u3066\u3057\u307e\u3046\u73fe\u5b9f\u304c\u3042\u308a\u307e\u3059\u3002\u5b09\u3057\u3044\u3053\u3068\u306bSERVERLESS\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u306f\u3001\u8a2d\u5b9a\u5185\u5bb9\u3092\u5916\u90e8\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u66f8\u304d\u65b9\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5f62\u3067\u3059\u3002\n\nserverless.yml\nframeworkVersion: \"=1.1.0\"\nservice: httpproxytest\nprovider:\n    name: aws\n    runtime: nodejs4.3\nfunctions:\n    # \u7701\u7565\n\nresources: ${file(./resource.yml)}\n\n\n\nresource.yml\nResources:\n    CatchAllTestResource:\n        # \u7701\u7565\n    CatchAllTestMethod:\n        # \u7701\u7565\n    OptionsMethod:\n        # \u7701\u7565\n\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u3001\u5225\u30d5\u30a1\u30a4\u30eb\u306b\u3057\u3066\u3057\u307e\u3048\u3070\u975e\u5e38\u306b\u898b\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u306d\u3002\u3053\u3046\u3057\u3066\u304a\u304f\u3068\u3001resource.yml\u30d5\u30a1\u30a4\u30eb\u3092JSON\u5f62\u5f0f\u306b\u5909\u66f4\u3057\u3066CloudFormation\u30d5\u30a1\u30a4\u30eb\u306b\u3059\u308b\u3053\u3068\u3082\u7c21\u5358\u306b\u3067\u304d\u307e\u3059\u3057\u3001\u9006\u306b\u3059\u3067\u306b\u3042\u308bCloudFormation\u30d5\u30a1\u30a4\u30eb\u3092SERVERLESS\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u4f7f\u3044\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u306d\u3002\n\n\u307e\u3068\u3081\n\n\u524d\u7de8\uff1a\u30d1\u30b9\u3084\u30af\u30a8\u30ea\u30b9\u30c8\u30ea\u30f3\u30b0\u304c\u6c7a\u307e\u3063\u3066\u3044\u308b\u5834\u5408\u306eHTTP\u30d7\u30ed\u30ad\u30b7\u306e\u4f5c\u308a\u65b9\n\u5f8c\u7de8\uff1a\u6d41\u884c\u308a\u306e{proxy+}\uff08\u30aa\u30fc\u30eb\u30b9\u30eb\u30fc\uff09\u306eHTTP\u30d7\u30ed\u30ad\u30b7\u306e\u4f5c\u308a\u65b9\n\n\u3068\u3057\u3066\u66f8\u3044\u3066\u304d\u307e\u3057\u305f\u3002AWS\u3084SERVERLESS\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306e\u9032\u5316\u306f\u975e\u5e38\u306b\u65e9\u304f\u3066\u3064\u3044\u3066\u3044\u304f\u306e\u304c\u5927\u5909\u3067\u3059\u304c\u3001\u958b\u767a\u8005\u3068\u3057\u3066\u306f\u975e\u5e38\u306b\u30ef\u30af\u30ef\u30af\u3057\u307e\u3059\u3002\u975e\u5e38\u306b\u4fbf\u5229\u306b\u65e9\u304f\u3001\u305d\u3057\u3066\u4f55\u3088\u308a\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u5074\u306e\u69cb\u7bc9\u304c\u7c21\u5358\u306b\u3067\u304d\u308b\u304a\u304b\u3052\u3067\u3001\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u306e\u958b\u767a\u306b\u6ce8\u529b\u3067\u304d\u308b\u3053\u3068\u304c\u306a\u306b\u3088\u308a\u3042\u308a\u304c\u305f\u3044\u3067\u3059\u3002\n\u3053\u306e\u8a18\u4e8b\u304c\u4f55\u304b\u306e\u5f79\u306b\u7acb\u3066\u3070\u5e78\u3044\u3067\u3059\u3002\n\u304a\u308f\u308a\n# \u306f\u3058\u3081\u306b\n\u7686\u3055\u3093\u3054\u5b58\u77e5\u3001[SERVERLESS\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af](https://serverless.com/)\u3002\u50d5\u306f\u6700\u8fd1\u3069\u3063\u3077\u308a\u3053\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306b\u6d78\u304b\u3063\u3066\u304a\u308a\u307e\u3059\u3002\u9032\u5316\u304c\u65e9\u304f\u3066\u3064\u3044\u3066\u3044\u304f\u306e\u304c\u5927\u5909\u3067\u3059\u3002\n\nSERVERLESS\u3063\u3066API Gateway\u4f5c\u308b\u3088\u306d\uff1f\u3063\u3066\u3053\u3068\u306fHTTP\u30d7\u30ed\u30ad\u30b7\u3068\u3057\u3066\u3082\u4f5c\u308c\u308b\u3093\u3058\u3083\u306d\uff1f\u3063\u3066\u306a\u3063\u3066\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n- [\u524d\u7de8\uff1a\u30d1\u30b9\u3084\u30af\u30a8\u30ea\u30b9\u30c8\u30ea\u30f3\u30b0\u304c\u6c7a\u307e\u3063\u3066\u3044\u308b\u5834\u5408\u306eHTTP\u30d7\u30ed\u30ad\u30b7\u306e\u4f5c\u308a\u65b9](http://qiita.com/seiya_orz/items/5fbfd81a7a6ec92945fa)\n- \u5f8c\u7de8\uff1a\u6d41\u884c\u308a\u306e{proxy+}\uff08\u30aa\u30fc\u30eb\u30b9\u30eb\u30fc\uff09\u306eHTTP\u30d7\u30ed\u30ad\u30b7\u306e\u4f5c\u308a\u65b9\n\n\u3053\u3093\u306a\u611f\u3058\u306e\u69cb\u6210\u3067\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u8a18\u4e8b\u306f\u5f8c\u7de8\u306b\u306a\u308a\u307e\u3059\u3002\u524d\u7de8\u3067\u4f5c\u3063\u305fService\u3092\u66f8\u304d\u63db\u3048\u3066\u4f5c\u3063\u3066\u3044\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u5b9f\u65bd\u74b0\u5883\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3067\u3059\u3002\u5b9f\u65bd\u3055\u308c\u308b\u65b9\u306f\u3001\u5fc5\u8981\u306a\u3082\u306e\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n- AWS\u30a2\u30ab\u30a6\u30f3\u30c8\n- aws-cli v1.10.47\n- serverless v1.1.0\n\n\u307e\u305f\u3001\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9\u306f\u4e0b\u8a18\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n[SERVERLESS\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30afv1.0\u6b63\u5f0f\u30ea\u30ea\u30fc\u30b9\u7248\u3092\u89e6\u3063\u3066\u307f\u305f](http://qiita.com/seiya_orz/items/4bd7cc1010fafdbb8fd0)\n\n# \u30aa\u30fc\u30eb\u30b9\u30eb\u30fcHTTP\u30d7\u30ed\u30ad\u30b7\u3092\u4f5c\u308b\n## \u3053\u306e\u8a18\u4e8b\u306e\u30b4\u30fc\u30eb\n\u4eca\u56de\u306e\u30d7\u30ed\u30ad\u30b7\u5148\u3082\u3001\u56f3\u66f8\u9928\u306e\u691c\u7d22\u304c\u3067\u304d\u308bAPI [\u30ab\u30fc\u30ea\u30eb](https://calil.jp/doc/api_ref.html)\u3092\u4f7f\u308f\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3059\u3002\u3053\u306eAPI\u306f\u3001/library\u3067\u56f3\u66f8\u9928\u691c\u7d22\u3001/check\u3067\u305d\u306e\u56f3\u66f8\u9928\u306b\u6307\u5b9a\u3057\u305f\u672c\u304c\u5b58\u5728\u3057\u3066\u3044\u308b\u304b\u304c\u308f\u304b\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u3092\u3001\u4eca\u56de\u4f5c\u6210\u3059\u308bAPIGW\u304b\u3089\u30d1\u30b9\u3084\u30af\u30a8\u30ea\u30b9\u30c8\u30ea\u30f3\u30b0\u3092\u305d\u306e\u307e\u307e\u306b\u3001\u30ab\u30fc\u30ea\u30eb\u3078\u6295\u3052\u3066\u304f\u308c\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n\u5b8c\u6210\u30a4\u30e1\u30fc\u30b8\u306f\u3053\u3093\u306a\u611f\u3058\u3002\u4eca\u56de\u306fCORS\u306e\u8a2d\u5b9a\u307e\u3067\u3057\u307e\u3057\u3087\u3046\uff08\u672c\u5f53\u306bCORS\u304c\u52b9\u3044\u3066\u3044\u308b\u304b\u306f\u672a\u691c\u8a3c\u3067\u3059\uff09\u3002\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-11-08 16.28.49.png](https://qiita-image-store.s3.amazonaws.com/0/74853/a8e0b25d-77da-56e9-db21-c7d5d6bec39a.png)\n\n\u5177\u4f53\u7684\u306b\u306f\u3001\n\n- https://~~~~.amazonaws.com/library?appkey=hogehoge&pref=\u6771\u4eac \u306eGET\u30a2\u30af\u30bb\u30b9\u304c\u6765\u305f\u5834\u5408\n  - https://api.calil.jp/library?appkey=hogehoge&pref=\u6771\u4eac \u3092APIGW\u304c\u6295\u3052\u308b\n- https://~~~~.amazonaws.com/check?appkey=hogehoge&isbn=4834000826&systemid=Aomori_Pref&format=json \u306eGET\u30a2\u30af\u30bb\u30b9\u304c\u6765\u305f\u5834\u5408\n  - https://api.calil.jp/check?appkey=hogehoge&isbn=4834000826&systemid=Aomori_Pref&format=json \u3092APIGW\u304c\u6295\u3052\u308b\n\n\u3068\u3044\u3046\u611f\u3058\u3067\u3059\u3002\u3053\u308c\u3092\u30011\u30641\u3064\u30d1\u30b9\u3084\u30af\u30a8\u30ea\u30b9\u30c8\u30ea\u30f3\u30b0\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u306a\u304f\u5b9f\u73fe\u3057\u307e\u3059\u3002\u67d4\u8edf\u306b\u5bfe\u5fdc\u3057\u3066\u304f\u308c\u308bHTTP\u30d7\u30ed\u30ad\u30b7\u3063\u3066\u611f\u3058\u3067\u3059\u306d\u3002\n\n## HTTP\u30d7\u30ed\u30ad\u30b7\u306e\u69cb\u7bc9\n\u3055\u3066\u3001\u4eca\u56de\u306f\u3055\u3063\u305d\u304f\u30e1\u30a4\u30f3\u90e8\u5206\u3092\u89e6\u3063\u3066\u3044\u304d\u307e\u3059\u3002\u5b8c\u6210\u3057\u305fserverless.yml\u306f\u3053\u3093\u306a\u611f\u3058\u306b\u306a\u308a\u307e\u3059\uff08CORS\u306f\u3042\u3068\u3067\uff09\u3002\n\n```yaml:serverless.yml\nframeworkVersion: \"=1.1.0\"\nservice: httpproxyonly\nprovider:\n    name: aws\n    runtime: nodejs4.3\nfunctions:\n  hello:\n    handler: handler.hello\n    events:\n        - http:\n            path: trash\n            method: get\n\n# resources\u306fCloudFormation\u3092YAML\u3067\u66f8\u304f\u611f\u3058\u3002\n# \u3053\u3053\u306bAPI Gateway\u3092HTTP\u30d7\u30ed\u30ad\u30b7\u3068\u3057\u3066\u4f5c\u308b\u8a2d\u5b9a\u3092\u66f8\u304d\u307e\u3059\u3002\nresources:\n    Resources:\n        CatchAllTestResource: # {proxy+}\u306e\u30ea\u30bd\u30fc\u30b9ID\uff08Method\u304b\u3089\u53c2\u7167\u3055\u308c\u308b\uff09\n            Type: AWS::ApiGateway::Resource\n            Properties:\n                ParentId:\n                    Fn::GetAtt:\n                        - ApiGatewayRestApi # SERVERLESS\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u4f5c\u6210\u3055\u308c\u308bAPI Gateway\u306eID\uff08\u3060\u3068\u601d\u3046\uff09\n                        - RootResourceId\n                PathPart: \"{proxy+}\" # \u30d7\u30ed\u30ad\u30b7\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\n                RestApiId:\n                    Ref: ApiGatewayRestApi\n        CatchAllTestMethod: # {proxy+}\u306e\u30e1\u30bd\u30c3\u30c9ID\n            Type: AWS::ApiGateway::Method\n            Properties:\n                AuthorizationType: NONE\n                ResourceId:\n                    Ref: CatchAllTestResource\n                RestApiId:\n                    Ref: ApiGatewayRestApi\n                HttpMethod: ANY # \u3053\u306e\u30d7\u30ed\u30ad\u30b7\u306b\u5165\u3063\u3066\u304f\u308b\u3068\u304d\u306e\u30e1\u30bd\u30c3\u30c9\n                RequestParameters: # \u5fc5\u9808\u304b\u3069\u3046\u304b\u306e\u5224\u65ad\n                    method.request.path.proxy: false\n                MethodResponses: # \u30d7\u30ed\u30ad\u30b7\u306e\u547c\u3073\u51fa\u3057\u5143\u3078\u8fd4\u3059HTTP\u30b9\u30c6\u30fc\u30bf\u30b9\u30b3\u30fc\u30c9\u306e\u3046\u3061\u3001\u3042\u308a\u5f97\u308b\u3082\u306e\n                    - StatusCode: 200\n                    - StatusCode: 400\n                    - StatusCode: 403\n                    - StatusCode: 500\n                Integration:\n                    IntegrationHttpMethod: ANY # \u30d7\u30ed\u30ad\u30b7\u5148\u306b\u6295\u3052\u308b\u3068\u304d\u306e\u30e1\u30bd\u30c3\u30c9\n                    Type: HTTP_PROXY # HTTP or HTTP_PROXY\n                    Uri: https://api.calil.jp/{proxy} # \u30d7\u30ed\u30ad\u30b7\u5148\u306eURL\uff08\u30d1\u30e9\u30e1\u30fc\u30bf\u4e0d\u8981\uff09\n                    RequestParameters:\n                        integration.request.path.proxy: method.request.path.proxy\n                    IntegrationResponses: # \u30d7\u30ed\u30ad\u30b7\u5148\u304b\u3089\u306e\u30ec\u30b9\u30dd\u30f3\u30b9HTTP\u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u30de\u30c3\u30d4\u30f3\u30b0\n                        - StatusCode: 200\n                        -\n                            StatusCode: 400\n                            SelectionPattern: \"400\" # \u30ec\u30b9\u30dd\u30f3\u30b9\u306eHTTP\u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u6b63\u898f\u8868\u73fe\n                        -\n                            StatusCode: 403\n                            SelectionPattern: \"403\"\n                        -\n                            StatusCode: 500\n                            SelectionPattern: \"500\"\n```\n\n\u4eca\u56de\u3001\u91cd\u8981\u306a\u306e\u306f\u4ee5\u4e0b\u306e\u70b9\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\n- \u30ea\u30bd\u30fc\u30b9(CatchAllTestResource)\u306ePathPart\n- \u30e1\u30bd\u30c3\u30c9(CatchAllTestMethod)\u306eRequestParameters(Integration\u5185\u306e\u3082\u542b\u3080)\n- Integration\u306eType\n- Integration\u306eUri\n\n\u9806\u756a\u306b\u898b\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\n\n### PathPart\n\u3053\u306e\u90e8\u5206\u306f\u3001\u7279\u306b\u96e3\u3057\u304f\u3042\u308a\u307e\u305b\u3093\u3002APIGW\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u3067{proxy+}\u306b\u3059\u308b\u5834\u5408\u306f2016/11/09\u73fe\u5728\u3067\u306f\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u3092ON\u306b\u3059\u308c\u3070\u52dd\u624b\u306b\u30ea\u30bd\u30fc\u30b9\u306b{proxy+}\u3068\u306a\u308a\u307e\u3059\u3002\u5bfe\u3057\u3066\u3001CloudFormation\u3067\u306fPathPart\u3092{proxy+}\u3068\u8a2d\u5b9a\u3059\u308c\u3070\u52dd\u624b\u306bCloudFormation\u304c\u89e3\u91c8\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u3067\u3059\u3002\u4fbf\u5229\u3067\u3059\u306d\u3002\n\n### RequestParameters\n\u3053\u306e\u90e8\u5206\u306f\u5c11\u3057\u30cf\u30de\u308a\u307e\u3057\u305f\u3002\n\n\u3053\u308c\u3092\u3084\u308a\u59cb\u3081\u305f\u3068\u304d\u306f\u3001{proxy+}\u306b\u3057\u3066\u3044\u308c\u3070\u30d1\u30b9\u306f\u3044\u3044\u611f\u3058\u306bAPIGW\u304c\u3084\u3063\u3066\u304f\u308c\u308b\u3068\u601d\u3063\u3066\u3044\u3066\u3001RequestParameters\u306b\u306f\u4f55\u3082\u8a2d\u5b9a\u3057\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u305d\u3046\u3057\u3066\u3044\u308b\u3068\u3001\u4f8b\u3048\u3070\u3001`http://~~~.amazonawz.com/dev/library?appkey=hogehoge&pref=\u6c96\u7e04`\u306bGET\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001APIGW\u306f`https://api.calil.jp/{proxy}?appkey=hogehoge&pref=\u6c96\u7e04`\u3068\u3044\u3046URL\u306bGET\u30ea\u30af\u30a8\u30b9\u30c8\u3057\u3066\u3044\u307e\u3057\u305f\u3002\u3053\u308c\u306f\u3001{proxy}\u3068\u3044\u3046\u6587\u5b57\u5217\u304cURL\u306b\u5165\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u3066\u3001library\u304c{proxy}\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3055\u308c\u3066\u3044\u306a\u3044\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u3088\u3063\u3066\u3001\u4e0a\u8a18(serverless.yml)\u306e\u3088\u3046\u306bpath\u306eproxy\u3068\u3044\u3046\u5909\u6570\u3092\u30de\u30c3\u30d4\u30f3\u30b0\u3059\u308b\u8a2d\u5b9a\u3092\u8a18\u8ff0\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n### Integration\u306eType\n\u4ed6\u306eWeb\u30b5\u30fc\u30d0\u3078\u306eHTTP\u30d7\u30ed\u30ad\u30b7\u3092\u69cb\u7bc9\u3059\u308b\u5834\u5408\u3001\u3053\u3053\u306e\u8a2d\u5b9a\u306fHTTP\u304bHTTP_PROXY\u306e2\u629e\u306b\u306a\u308a\u307e\u3059\uff08\u3068\u601d\u3046\uff09\u3002\n\n\u524d\u7de8\u3067\u3082\u66f8\u304d\u307e\u3057\u305f\u304c\u3001HTTP\u306e\u5834\u5408\u306f\u30af\u30a8\u30ea\u30b9\u30c8\u30ea\u30f3\u30b0\u306e\u30de\u30c3\u30d4\u30f3\u30b0\u3092\u660e\u793a\u7684\u306b\u8a18\u8ff0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u8a00\u3044\u63db\u3048\u308b\u3068\u3001\u4e88\u3081\u66f8\u3044\u3066\u304a\u3044\u305f\u30af\u30a8\u30ea\u30b9\u30c8\u30ea\u30f3\u30b0\u306e\u307f\u30de\u30c3\u30d4\u30f3\u30b0\u3057\u3066\u304f\u308c\u308b\u305f\u3081\u3001\u958b\u767a\u8005\u306e\u610f\u56f3\u901a\u308a\u306e\u52d5\u304d\u3092\u3055\u305b\u3084\u3059\u3044\u3067\u3059\u3002\n\n\u5bfe\u3057\u3066HTTP_PROXY\u306e\u5834\u5408\u306f\u3001\u30af\u30a8\u30ea\u30b9\u30c8\u30ea\u30f3\u30b0\u306f\u3059\u3079\u3066\u305d\u306e\u307e\u307e\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u540d\u306e\u307e\u307e\u3001Web\u30b5\u30fc\u30d0\u3078\u6e21\u3057\u3066\u304f\u308c\u307e\u3059\u3002\u3053\u308c\u306f\u975e\u5e38\u306b\u4fbf\u5229\u3067\u3059\u304c\u3001\u4f8b\u3048\u3070\u30d7\u30ed\u30ad\u30b7\u5148\u306eAPI\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u540d\u3092\u79d8\u533f\u3057\u305f\u3044\u5834\u5408\uff08\u3053\u3093\u306a\u3053\u3068\u3042\u308b\u306e\u304b\u306a\uff1f\uff09\u306b\u306f\u3053\u308c\u306f\u4f7f\u3048\u306a\u3044\u3053\u3068\u306b\u306a\u308a\u305d\u3046\u3067\u3059\u3002\n\n### Integration\u306eUri\n\u3053\u3053\u306b\u306f\u3001\u30d7\u30ed\u30ad\u30b7\u5148\u306eURL\u3068\u3057\u3066\u5fc5\u305a**`{proxy}(proxy+\u3067\u306f\u306a\u3044)`**\u3092\u542b\u3081\u305fURL\u306b\u3057\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002APIGW\u306e\u30d1\u30b9\u306e{proxy+}\u306b\u5f53\u305f\u308b\u90e8\u5206\u304c{proxy}\u3078\u3068\u30de\u30c3\u30d4\u30f3\u30b0\u3055\u308c\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u8003\u616e\u3057\u305f\u8a2d\u5b9a\u3092\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\n\u9577\u304f\u306a\u308a\u307e\u3057\u305f\u304c\u3001\u4e0a\u8a18serverless.yml\u306e\u3088\u3046\u306b\u66f8\u3051\u305f\u3089\u3001\u30c7\u30d7\u30ed\u30a4\u3057\u307e\u3057\u3087\u3046\u3002\u4e0a\u306b\u8f09\u305b\u305f\u753b\u50cf\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u306b\u306a\u3063\u3066\u3044\u308b\u306f\u305a\u3067\u3059\uff08OPTIONS\u30e1\u30bd\u30c3\u30c9\u306f\u307e\u3060\u4f5c\u3089\u308c\u3066\u3044\u306a\u3044\u306f\u305a\uff09\u3002\n\n\n## API\u3092\u53e9\u3044\u3066\u307f\u308b\n- [https://[\u4eba\u306b\u3088\u308b].execute-api.us-east-1.amazonaws.com/dev/library?appkey=[\u4eba\u306b\u3088\u308b]&pref=\u6c96\u7e04](https://[\u4eba\u306b\u3088\u308b].execute-api.us-east-1.amazonaws.com/dev/library?appkey=[\u4eba\u306b\u3088\u308b]&pref=\u6c96\u7e04)\n- [https://[\u4eba\u306b\u3088\u308b].execute-api.us-east-1.amazonaws.com/dev/check?appkey=[\u4eba\u306b\u3088\u308b]&isbn=4834000826&systemid=Aomori_Pref&format=json](https://[\u4eba\u306b\u3088\u308b].execute-api.us-east-1.amazonaws.com/dev/library?appkey=[\u4eba\u306b\u3088\u308b]&isbn=4834000826&systemid=Aomori_Pref&format=json)\n\n\u3053\u306e2\u3064\u306b\u30d6\u30e9\u30a6\u30b6\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u30021\u3064\u76ee\u306fXML\u5f62\u5f0f\u306e\u56f3\u66f8\u9928\u4e00\u89a7\u30012\u3064\u76ee\u306fJSON\u5f62\u5f0f\u306e\u66f8\u7c4d\u8cb8\u51fa\u60c5\u5831\u3089\u3057\u304d\u3082\u306e\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308c\u3070\u6b63\u3057\u304f\u69cb\u7bc9\u3067\u304d\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n## CORS\u306e\u8a2d\u5b9a\uff08\u672a\u691c\u8a3c\uff09\n\u3055\u3066\u3001API\u3092Ajax\u3092\u4f7f\u3063\u3066\u53e9\u3051\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u306b\u306fCORS\u306e\u8a2d\u5b9a\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002APIGW\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089CORS\u306e\u8a2d\u5b9a\u3092\u3059\u308b\u306e\u306f\u975e\u5e38\u306b\u7c21\u5358\u30672\u301c3\u30af\u30ea\u30c3\u30af\u3067\u3067\u304d\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u3057\u304b\u3057\u3001\u3057\u304b\u3057\u3001\u3057\u304b\u30fc\u3057\u3001CloudFormation\u3067\u69cb\u7bc9\u3057\u305fAPI\u306bCORS\u3092\u8a2d\u5b9a\u3059\u308b\u306b\u306f\u9762\u5012\u306a\u8a2d\u5b9a\u3092\u30ea\u30bd\u30fc\u30b9\u3054\u3068\u306b\u66f8\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\uff08Allow-Origin\u306e\u8a2d\u5b9a\u3092\u7d30\u304b\u304f\u3059\u308b\u306e\u304c\u6b63\u3057\u3044\u306e\u3067\u3001\u4ed5\u65b9\u306a\u3044\u3093\u3067\u3059\u3051\u3069\u306d\u2026\u3002SERVERLESS\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067Lambda\u3068\u3064\u306a\u3050\u969b\u306eCORS\u306eAllow-Origin\u3092*\u306b\u3059\u308b\u5834\u5408\u306f\u3001true\u3068\u66f8\u304f\u3060\u3051\u3067\u3044\u3044\u306e\u3067\u4f59\u8a08\u306b\u9762\u5012\u306b\u611f\u3058\u3066\u3057\u307e\u3044\u307e\u3059\u3002\uff09\n\nCORS\u306e\u8a2d\u5b9a\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u884c\u3044\u307e\u3059\u3002\n\n```yaml:serverless.yml\nframeworkVersion: \"=1.1.0\"\nservice: httpproxytest\nprovider:\n    name: aws\n    runtime: nodejs4.3\nfunctions:\n    # \u7701\u7565\n\nresources:\n    Resources:\n        CatchAllTestResource: # {proxy+}\u306e\u30ea\u30bd\u30fc\u30b9ID\uff08Method\u304b\u3089\u53c2\u7167\u3055\u308c\u308b\uff09\n            # \u7701\u7565\n        CatchAllTestMethod: # {proxy+}\u306e\u30e1\u30bd\u30c3\u30c9ID\n            # \u7701\u7565\n        OptionsMethod:\n            Type: AWS::ApiGateway::Method\n            Properties:\n                AuthorizationType: NONE\n                RestApiId:\n                    Ref: ApiGatewayRestApi\n                ResourceId:\n                    Ref: CatchAllTestResource # \u3053\u3053\u306bCORS\u3092\u9069\u7528\u3057\u305f\u3044\u30ea\u30bd\u30fc\u30b9ID\n                HttpMethod: OPTIONS # CORS\u306e\u8a2d\u5b9a\u306fOPTIONS\u30e1\u30bd\u30c3\u30c9\n                Integration:\n                    IntegrationResponses:\n                        -\n                            StatusCode: 200\n                            ResponseParameters: # Methods\u3084Origin\u306f\u9069\u5b9c\u5909\u66f4\u304c\u5fc5\u8981\u304b\u3068\n                                method.response.header.Access-Control-Allow-Headers: \"'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'\"\n                                method.response.header.Access-Control-Allow-Methods: \"'DELETE, GET, HEAD, OPTIONS, PATCH, POST, PUT'\"\n                                method.response.header.Access-Control-Allow-Origin: \"'*'\"\n                            ResponseTemplates:\n                                application/json: ''\n                    PassthroughBehavior: WHEN_NO_MATCH\n                    RequestTemplates:\n                        application/json: '{\"statusCode\": 200}'\n                    Type: MOCK\n                MethodResponses:\n                    -\n                        StatusCode: 200\n                        ResponseModels:\n                            application/json: 'Empty'\n                        ResponseParameters:\n                            method.response.header.Access-Control-Allow-Headers: false\n                            method.response.header.Access-Control-Allow-Methods: false\n                            method.response.header.Access-Control-Allow-Origin: false\n```\n\n\u7c21\u5358\u306b\u4f7f\u3044\u305f\u3044\u65b9\u306f\u30b3\u30d4\u30da\u3057\u3066\u4f7f\u3063\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\u5927\u5909\u7533\u3057\u8a33\u7121\u3044\u3067\u3059\u304c\u3001Ajax\u304b\u3089\u53e9\u3051\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u304b\u306f\u672a\u691c\u8a3c\u3067\u3059\u3001\u3054\u3081\u3093\u306a\u3055\u3044\u3002\u3069\u306a\u305f\u304b\u5831\u544a\u3092\u3044\u305f\u3060\u3051\u308b\u3068\u52a9\u304b\u308a\u307e\u3059\u3002\n\n## \u756a\u5916\u7de8\uff1aResource\u3092\u5916\u90e8\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304f\nserverless.yml\u304c\u3084\u305f\u3089\u3068\u80a5\u5927\u5316\u3057\u3066\u3057\u307e\u3046\u73fe\u5b9f\u304c\u3042\u308a\u307e\u3059\u3002\u5b09\u3057\u3044\u3053\u3068\u306bSERVERLESS\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u306f\u3001\u8a2d\u5b9a\u5185\u5bb9\u3092\u5916\u90e8\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u66f8\u304d\u65b9\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5f62\u3067\u3059\u3002\n\n```yaml:serverless.yml\nframeworkVersion: \"=1.1.0\"\nservice: httpproxytest\nprovider:\n    name: aws\n    runtime: nodejs4.3\nfunctions:\n    # \u7701\u7565\n\nresources: ${file(./resource.yml)}\n```\n\n```yaml:resource.yml\nResources:\n    CatchAllTestResource:\n        # \u7701\u7565\n    CatchAllTestMethod:\n        # \u7701\u7565\n    OptionsMethod:\n        # \u7701\u7565\n```\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u3001\u5225\u30d5\u30a1\u30a4\u30eb\u306b\u3057\u3066\u3057\u307e\u3048\u3070\u975e\u5e38\u306b\u898b\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u306d\u3002\u3053\u3046\u3057\u3066\u304a\u304f\u3068\u3001resource.yml\u30d5\u30a1\u30a4\u30eb\u3092JSON\u5f62\u5f0f\u306b\u5909\u66f4\u3057\u3066CloudFormation\u30d5\u30a1\u30a4\u30eb\u306b\u3059\u308b\u3053\u3068\u3082\u7c21\u5358\u306b\u3067\u304d\u307e\u3059\u3057\u3001\u9006\u306b\u3059\u3067\u306b\u3042\u308bCloudFormation\u30d5\u30a1\u30a4\u30eb\u3092SERVERLESS\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u4f7f\u3044\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u306d\u3002\n\n# \u307e\u3068\u3081\n\n- [\u524d\u7de8\uff1a\u30d1\u30b9\u3084\u30af\u30a8\u30ea\u30b9\u30c8\u30ea\u30f3\u30b0\u304c\u6c7a\u307e\u3063\u3066\u3044\u308b\u5834\u5408\u306eHTTP\u30d7\u30ed\u30ad\u30b7\u306e\u4f5c\u308a\u65b9](http://qiita.com/seiya_orz/items/5fbfd81a7a6ec92945fa)\n- \u5f8c\u7de8\uff1a\u6d41\u884c\u308a\u306e{proxy+}\uff08\u30aa\u30fc\u30eb\u30b9\u30eb\u30fc\uff09\u306eHTTP\u30d7\u30ed\u30ad\u30b7\u306e\u4f5c\u308a\u65b9\n\n\u3068\u3057\u3066\u66f8\u3044\u3066\u304d\u307e\u3057\u305f\u3002AWS\u3084SERVERLESS\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306e\u9032\u5316\u306f\u975e\u5e38\u306b\u65e9\u304f\u3066\u3064\u3044\u3066\u3044\u304f\u306e\u304c\u5927\u5909\u3067\u3059\u304c\u3001\u958b\u767a\u8005\u3068\u3057\u3066\u306f\u975e\u5e38\u306b\u30ef\u30af\u30ef\u30af\u3057\u307e\u3059\u3002\u975e\u5e38\u306b\u4fbf\u5229\u306b\u65e9\u304f\u3001\u305d\u3057\u3066\u4f55\u3088\u308a\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u5074\u306e\u69cb\u7bc9\u304c\u7c21\u5358\u306b\u3067\u304d\u308b\u304a\u304b\u3052\u3067\u3001\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u306e\u958b\u767a\u306b\u6ce8\u529b\u3067\u304d\u308b\u3053\u3068\u304c\u306a\u306b\u3088\u308a\u3042\u308a\u304c\u305f\u3044\u3067\u3059\u3002\n\n\u3053\u306e\u8a18\u4e8b\u304c\u4f55\u304b\u306e\u5f79\u306b\u7acb\u3066\u3070\u5e78\u3044\u3067\u3059\u3002\n\n\u304a\u308f\u308a\n"}