{"tags": ["openstack"], "context": "OpenStack\u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u57fa\u672c\u52d5\u4f5c\u3092\u4f53\u9a13\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u25a0 \u3084\u3063\u3066\u307f\u305f\u3053\u3068\nOpenStaxk\u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u3001\u8a66\u3057\u3066\u307f\u305f\u3053\u3068\u306f\u3001\n\n\u30b5\u30fc\u30d0\u6a5f\u5668\uff12\u53f0\u3092\u3001HUB\u63a5\u7d9a\u3059\u308b\n\u30b5\u30fc\u30d0\u6a5f\u5668\u306b\u3001IP\u30a2\u30c9\u30ec\u30b9\u3092\u4ed8\u4e0e\u3059\u308b\n\u30b5\u30fc\u30d0\u6a5f\u5668\u306e\u9593\u3067\u3001ping\u901a\u4fe1\u3057\u3066\u307f\u308b\n\n\u3068\u3044\u3046\u3001\u975e\u5e38\u306b\u30b7\u30f3\u30d7\u30eb\u306a\u5185\u5bb9\u3067\u3059\u3002\n\n\n\u25a0 OpenStack\u5b9f\u9a13\u74b0\u5883\n\"Nested KVM\u74b0\u5883\u3067\u306eNewton\u7248OpenStack\u69cb\u7bc9\u30e1\u30e2\"\u3067\u4f5c\u6210\u3057\u305fOpenStack\u74b0\u5883\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\nnova\u4eee\u60f3\u30de\u30b7\u30f3\u4e00\u89a7\n\n[root@newton ~(keystone_demo)]# nova list\n+--------------------------------------+---------+--------+------------+-------------+----------------------------------+\n| ID                                   | Name    | Status | Task State | Power State | Networks                         |\n+--------------------------------------+---------+--------+------------+-------------+----------------------------------+\n| ab70f784-385d-44a8-b010-1322e7be94a7 | server1 | ACTIVE | -          | Running     | admin_net=10.0.0.4, 10.79.5.191  |\n| 06521269-bddb-4def-8369-3f92fd2f4622 | server2 | ACTIVE | -          | Running     | admin_net=10.0.0.11, 10.79.5.195 |\n+--------------------------------------+---------+--------+------------+-------------+----------------------------------+\n\n\nneutron\u30d5\u30ed\u30fc\u30c6\u30a3\u30f3\u30b0IP\u4e00\u89a7\n\n[root@newton ~(keystone_demo)]# neutron floatingip-list\n+--------------------------------------+------------------+---------------------+--------------------------------------+\n| id                                   | fixed_ip_address | floating_ip_address | port_id                              |\n+--------------------------------------+------------------+---------------------+--------------------------------------+\n| affd1370-760d-4148-9d48-5afb9f97eaf5 | 10.0.0.4         | 10.79.5.191         | 3155cbf3-ddcb-4acd-b5a1-dc37f4a49a4c |\n| cb83e8bc-47c2-438a-8c74-2f1654ddc09c | 10.0.0.11        | 10.79.5.195         | 75f7e4ac-600b-4a45-9948-d45b3ec7169b |\n+--------------------------------------+------------------+---------------------+--------------------------------------+\n\n\nOpenStack\u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\u30a4\u30e1\u30fc\u30b8\n\n\n\n\u25a0 \u5b9f\u9a13\uff11\u300c\u30b5\u30fc\u30d0\u6a5f\u5668\uff12\u53f0\u3092\u3001HUB\u63a5\u7d9a\u3057\u3066\u307f\u308b\u300d\nuser\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u914d\u5099\u3057\u3066\u3001ping\u758e\u901a\u78ba\u8a8d\u3092\u884c\u3063\u3066\u307f\u307e\u3059\u3002\n\n(1) user\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7528\u30dd\u30fc\u30c8\u3092\u4f5c\u6210\u3059\u308b\n\n\u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u7528\u30dd\u30fc\u30c8\u306e\u4f5c\u6210\n\n[root@newton ~(keystone_demo)]# neutron port-create --name user_port1 user_net\nCreated a new port:\n+-----------------------+------------------------------------------------------------------------------------+\n| Field                 | Value                                                                              |\n+-----------------------+------------------------------------------------------------------------------------+\n| admin_state_up        | True                                                                               |\n| allowed_address_pairs |                                                                                    |\n| binding:vnic_type     | normal                                                                             |\n| created_at            | 2017-02-03T00:29:03Z                                                               |\n| description           |                                                                                    |\n| device_id             |                                                                                    |\n| device_owner          |                                                                                    |\n| extra_dhcp_opts       |                                                                                    |\n| fixed_ips             | {\"subnet_id\": \"9f0e59df-d6c8-4c2d-9de5-8979798e5350\", \"ip_address\": \"172.16.0.11\"} |\n| id                    | 4fbca26b-95bd-4d74-8f56-20b1acfa8e89                                               |\n| mac_address           | fa:16:3e:b3:33:ae                                                                  |\n| name                  | user_port1                                                                         |\n| network_id            | 80feacbb-6bd5-4a3a-adff-a715b78c5d3e                                               |\n| project_id            | 67d85efd952f4b6a8c03c6f86fecb8ea                                                   |\n| revision_number       | 4                                                                                  |\n| security_groups       | bff315ad-0f08-45f8-8b14-5d19a9f95aa6                                               |\n| status                | DOWN                                                                               |\n| tenant_id             | 67d85efd952f4b6a8c03c6f86fecb8ea                                                   |\n| updated_at            | 2017-02-03T00:29:04Z                                                               |\n+-----------------------+------------------------------------------------------------------------------------+\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\"server2\"\u7528\u30dd\u30fc\u30c8\u306e\u4f5c\u6210\n\n[root@newton ~(keystone_demo)]# neutron port-create --name user_port2 user_net\nCreated a new port:\n+-----------------------+------------------------------------------------------------------------------------+\n| Field                 | Value                                                                              |\n+-----------------------+------------------------------------------------------------------------------------+\n| admin_state_up        | True                                                                               |\n| allowed_address_pairs |                                                                                    |\n| binding:vnic_type     | normal                                                                             |\n| created_at            | 2017-02-03T00:29:12Z                                                               |\n| description           |                                                                                    |\n| device_id             |                                                                                    |\n| device_owner          |                                                                                    |\n| extra_dhcp_opts       |                                                                                    |\n| fixed_ips             | {\"subnet_id\": \"9f0e59df-d6c8-4c2d-9de5-8979798e5350\", \"ip_address\": \"172.16.0.12\"} |\n| id                    | e1776e0d-9f64-4684-b050-c8749f8c9a88                                               |\n| mac_address           | fa:16:3e:38:dc:ef                                                                  |\n| name                  | user_port2                                                                         |\n| network_id            | 80feacbb-6bd5-4a3a-adff-a715b78c5d3e                                               |\n| project_id            | 67d85efd952f4b6a8c03c6f86fecb8ea                                                   |\n| revision_number       | 4                                                                                  |\n| security_groups       | bff315ad-0f08-45f8-8b14-5d19a9f95aa6                                               |\n| status                | DOWN                                                                               |\n| tenant_id             | 67d85efd952f4b6a8c03c6f86fecb8ea                                                   |\n| updated_at            | 2017-02-03T00:29:13Z                                                               |\n+-----------------------+------------------------------------------------------------------------------------+\n\n\n\u767b\u9332\u6e08\u307f\u306eport\u4e00\u89a7\u306e\u78ba\u8a8d\n\n[root@newton ~(keystone_demo)]# neutron port-list \n+--------------------------------------+------------+-------------------+---------------------------------------------------+\n| id                                   | name       | mac_address       | fixed_ips                                         |\n+--------------------------------------+------------+-------------------+---------------------------------------------------+\n| 3155cbf3-ddcb-4acd-b5a1-dc37f4a49a4c |            | fa:16:3e:49:48:8e | {\"subnet_id\": \"31a40092-042b-4f27-a00c-           |\n|                                      |            |                   | 54c9324db2ac\", \"ip_address\": \"10.0.0.4\"}          |\n| 3c173d98-c714-492d-8c6f-ef330c0e5d12 |            | fa:16:3e:6a:16:02 | {\"subnet_id\": \"31a40092-042b-4f27-a00c-           |\n|                                      |            |                   | 54c9324db2ac\", \"ip_address\": \"10.0.0.2\"}          |\n| 4fbca26b-95bd-4d74-8f56-20b1acfa8e89 | user_port1 | fa:16:3e:b3:33:ae | {\"subnet_id\": \"9f0e59df-d6c8-4c2d-                |\n|                                      |            |                   | 9de5-8979798e5350\", \"ip_address\": \"172.16.0.11\"}  |\n| 5da3eb5e-d1ff-41ec-a583-0cefc19e7973 |            | fa:16:3e:4e:58:bc | {\"subnet_id\": \"31a40092-042b-4f27-a00c-           |\n|                                      |            |                   | 54c9324db2ac\", \"ip_address\": \"10.0.0.1\"}          |\n| 680fcfb5-2e04-4ec5-a77c-3c6fd29d9ea9 |            | fa:16:3e:0f:0d:f1 | {\"subnet_id\": \"9f0e59df-d6c8-4c2d-                |\n|                                      |            |                   | 9de5-8979798e5350\", \"ip_address\": \"172.16.0.2\"}   |\n| 75f7e4ac-600b-4a45-9948-d45b3ec7169b |            | fa:16:3e:7c:92:60 | {\"subnet_id\": \"31a40092-042b-4f27-a00c-           |\n|                                      |            |                   | 54c9324db2ac\", \"ip_address\": \"10.0.0.11\"}         |\n| e1776e0d-9f64-4684-b050-c8749f8c9a88 | user_port2 | fa:16:3e:38:dc:ef | {\"subnet_id\": \"9f0e59df-d6c8-4c2d-                |\n|                                      |            |                   | 9de5-8979798e5350\", \"ip_address\": \"172.16.0.12\"}  |\n+--------------------------------------+------------+-------------------+---------------------------------------------------+\n\n\n(2) \u4eee\u60f3\u30de\u30b7\u30f3\u306b\u3001user\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7528\u30dd\u30fc\u30c8\u3092\u53d6\u308a\u4ed8\u3051\u308b\n\n\u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u5074\u3067\u306e\u30dd\u30fc\u30c8\u53d6\u308a\u4ed8\u3051\n\n[root@newton ~(keystone_demo)]# nova interface-attach --port-id 4fbca26b-95bd-4d74-8f56-20b1acfa8e89 server1\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\"server2\"\u5074\u3067\u306e\u30dd\u30fc\u30c8\u53d6\u308a\u4ed8\u3051\n\n[root@newton ~(keystone_demo)]# nova interface-attach --port-id e1776e0d-9f64-4684-b050-c8749f8c9a88 server2\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u5074\u3067\u306e\u767b\u9332\u6e08\u307f\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u4e00\u89a7\u306e\u78ba\u8a8d\n\n[root@newton ~(keystone_demo)]# nova interface-list server1\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n| Port State | Port ID                              | Net ID                               | IP addresses | MAC Addr          |\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n| ACTIVE     | 3155cbf3-ddcb-4acd-b5a1-dc37f4a49a4c | 9ea97f2d-7ead-44b1-91e1-afc7ca22e21e | 10.0.0.4     | fa:16:3e:49:48:8e |\n| ACTIVE     | 4fbca26b-95bd-4d74-8f56-20b1acfa8e89 | 80feacbb-6bd5-4a3a-adff-a715b78c5d3e | 172.16.0.11  | fa:16:3e:b3:33:ae |\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\"server2\"\u5074\u3067\u306e\u767b\u9332\u6e08\u307f\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u4e00\u89a7\u306e\u78ba\u8a8d\n\n[root@newton ~(keystone_demo)]# nova interface-list server2\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n| Port State | Port ID                              | Net ID                               | IP addresses | MAC Addr          |\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n| ACTIVE     | 75f7e4ac-600b-4a45-9948-d45b3ec7169b | 9ea97f2d-7ead-44b1-91e1-afc7ca22e21e | 10.0.0.11    | fa:16:3e:7c:92:60 |\n| ACTIVE     | e1776e0d-9f64-4684-b050-c8749f8c9a88 | 80feacbb-6bd5-4a3a-adff-a715b78c5d3e | 172.16.0.12  | fa:16:3e:38:dc:ef |\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n\n\n(3) \u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u4e0a\u3067\u3001\u53d6\u308a\u4ed8\u3051\u6e08\u307f\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u6709\u52b9\u306b\u3059\u308b\n\n\u73fe\u5728\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u72b6\u614b\u306e\u78ba\u8a8d\uff08 \"ens6\" \u304c\u65b0\u305f\u306b\u8ffd\u52a0\u306b\u306a\u3063\u305f\uff09\n\nubuntu@server1:~$ ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: ens3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether fa:16:3e:49:48:8e brd ff:ff:ff:ff:ff:ff\n    inet 10.0.0.4/24 brd 10.0.0.255 scope global ens3\n       valid_lft forever preferred_lft forever\n    inet6 fe80::f816:3eff:fe49:488e/64 scope link \n       valid_lft forever preferred_lft forever\n3: ens6: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether fa:16:3e:b3:33:ae brd ff:ff:ff:ff:ff:ff\n\n\nPCI\u63a5\u7d9a\u30c7\u30d0\u30a4\u30b9\u306e\u78ba\u8a8d\n\nroot@server1:~# lspci |grep Ether\n00:03.0 Ethernet controller: Red Hat, Inc Virtio network device\n00:06.0 Ethernet controller: Red Hat, Inc Virtio network device\n\n\n\u66ab\u5b9a\u3068\u3057\u3066\u3001IP\u30a2\u30c9\u30ec\u30b9\u5024\u3092\u4ed8\u4e0e\n\nubuntu@server1:~$ sudo -i\nroot@server1:~# ip addr add 172.16.0.11/24 dev ens6\nroot@server1:~# ip link set ens6 up\n\n\n\u518d\u5ea6\u3001\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u72b6\u614b\u306e\u78ba\u8a8d\n\nroot@server1:~# ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: ens3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether fa:16:3e:49:48:8e brd ff:ff:ff:ff:ff:ff\n    inet 10.0.0.4/24 brd 10.0.0.255 scope global ens3\n       valid_lft forever preferred_lft forever\n    inet6 fe80::f816:3eff:fe49:488e/64 scope link \n       valid_lft forever preferred_lft forever\n3: ens6: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether fa:16:3e:b3:33:ae brd ff:ff:ff:ff:ff:ff\n    inet 172.16.0.11/24 scope global ens6\n       valid_lft forever preferred_lft forever\n    inet6 fe80::f816:3eff:feb3:33ae/64 scope link \n       valid_lft forever preferred_lft forever\n\n\n(4) \u4eee\u60f3\u30de\u30b7\u30f3\"server2\"\u4e0a\u3067\u3001\u53d6\u308a\u4ed8\u3051\u6e08\u307f\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u6709\u52b9\u306b\u3059\u308b\n\n\u73fe\u5728\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u72b6\u614b\u306e\u78ba\u8a8d\uff08\"eth1\"\u304c\u65b0\u305f\u306b\u8ffd\u52a0\u306b\u306a\u3063\u305f\uff09\n\n$ ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 16436 qdisc noqueue \n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc pfifo_fast qlen 1000\n    link/ether fa:16:3e:7c:92:60 brd ff:ff:ff:ff:ff:ff\n    inet 10.0.0.11/24 brd 10.0.0.255 scope global eth0\n    inet6 fe80::f816:3eff:fe7c:9260/64 scope link \n       valid_lft forever preferred_lft forever\n3: eth1: <BROADCAST,MULTICAST> mtu 1500 qdisc noop qlen 1000\n    link/ether fa:16:3e:38:dc:ef brd ff:ff:ff:ff:ff:ff\n\n\n\u66ab\u5b9a\u3068\u3057\u3066\u3001IP\u30a2\u30c9\u30ec\u30b9\u5024\u3092\u4ed8\u4e0e\n\n$ sudo -i\n# ip addr add 172.16.0.12/24 dev eth1\n# ip link set eth1 up\n\n\n\u518d\u5ea6\u3001\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u72b6\u614b\u306e\u78ba\u8a8d\n\n# ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 16436 qdisc noqueue \n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc pfifo_fast qlen 1000\n    link/ether fa:16:3e:7c:92:60 brd ff:ff:ff:ff:ff:ff\n    inet 10.0.0.11/24 brd 10.0.0.255 scope global eth0\n    inet6 fe80::f816:3eff:fe7c:9260/64 scope link \n       valid_lft forever preferred_lft forever\n3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast qlen 1000\n    link/ether fa:16:3e:38:dc:ef brd ff:ff:ff:ff:ff:ff\n    inet 172.16.0.12/24 scope global eth1\n    inet6 fe80::f816:3eff:fe38:dcef/64 scope link \n       valid_lft forever preferred_lft forever\n\n\n(4) \u4eee\u60f3\u30de\u30b7\u30f3\u9593\u3067\u306e\u758e\u901a\u6027\u3092\u78ba\u8a8d\u3057\u3066\u307f\u308b\n\n\u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u4e0a\u3067\u3001\u5bfe\u5411\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u5b9b\u3066\u306b\u3001ping\u3092\u6253\u3063\u3066\u307f\u308b\n\nroot@server1:~# ping 172.16.0.12\nPING 172.16.0.12 (172.16.0.12) 56(84) bytes of data.\n64 bytes from 172.16.0.12: icmp_seq=1 ttl=64 time=2.28 ms\n64 bytes from 172.16.0.12: icmp_seq=2 ttl=64 time=2.19 ms\n64 bytes from 172.16.0.12: icmp_seq=3 ttl=64 time=0.708 ms\n^C\n--- 172.16.0.12 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2003ms\nrtt min/avg/max/mdev = 0.708/1.730/2.288/0.724 ms\n\n\n\u6700\u7d42\u7684\u306b\u3001\u4f5c\u6210\u3057\u305f\u30c8\u30dd\u30ed\u30b8\u69cb\u6210\n\n\n\n\u3053\u3053\u307e\u3067\u306f\u3001\u9806\u8abf\u306b\u3001OpenStack\u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u4f5c\u6210\u3067\u304d\u307e\u3057\u305f\u3002\n\n\u25a0 \u5b9f\u9a13\uff12\u300cHUB\u63a5\u7d9a\u3057\u305f\u30b5\u30fc\u30d0\u6a5f\u5668\u306eLAN\u30b1\u30fc\u30d6\u30eb\u3092\u629c\u304d\u5dee\u3057\u3057\u3066\u307f\u308b\u300d\n\u7d9a\u3044\u3066\u3001\u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u5074\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u53d6\u308a\u5916\u3057/\u53d6\u308a\u4ed8\u3051\u3092\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\n\n(1) neuton\u4e0a\u3067\u306e\u30dd\u30fc\u30c8\u53d6\u308a\u5916\u3057/\u53d6\u308a\u4ed8\u3051\n\n\u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u5074\u3067\u306e\u767b\u9332\u6e08\u307f\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u4e00\u89a7\u306e\u78ba\u8a8d\n\n[root@newton ~(keystone_demo)]# nova interface-list server1\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n| Port State | Port ID                              | Net ID                               | IP addresses | MAC Addr          |\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n| ACTIVE     | 3155cbf3-ddcb-4acd-b5a1-dc37f4a49a4c | 9ea97f2d-7ead-44b1-91e1-afc7ca22e21e | 10.0.0.4     | fa:16:3e:49:48:8e |\n| ACTIVE     | 4fbca26b-95bd-4d74-8f56-20b1acfa8e89 | 80feacbb-6bd5-4a3a-adff-a715b78c5d3e | 172.16.0.11  | fa:16:3e:b3:33:ae |\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u5074\u306e\u30dd\u30fc\u30c8\u53d6\u308a\u5916\u3057\n\n[root@newton ~(keystone_demo)]# nova interface-detach server1 4fbca26b-95bd-4d74-8f56-20b1acfa8e89\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u5074\u3067\u306e\u767b\u9332\u6e08\u307f\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u4e00\u89a7\u306e\u78ba\u8a8d\n\n[root@newton ~(keystone_demo)]# nova interface-list server1\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n| Port State | Port ID                              | Net ID                               | IP addresses | MAC Addr          |\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n| ACTIVE     | 3155cbf3-ddcb-4acd-b5a1-dc37f4a49a4c | 9ea97f2d-7ead-44b1-91e1-afc7ca22e21e | 10.0.0.4     | fa:16:3e:49:48:8e |\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n\n\n\u518d\u5ea6\u3001\u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u5074\u3067\u306e\u30dd\u30fc\u30c8\u53d6\u308a\u4ed8\u3051\n\n[root@newton ~(keystone_demo)]# nova interface-attach --port-id 4fbca26b-95bd-4d74-8f56-20b1acfa8e89 server1\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u5074\u3067\u306e\u767b\u9332\u6e08\u307f\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u4e00\u89a7\u306e\u78ba\u8a8d\n\n[root@newton ~(keystone_demo)]# nova interface-list server1\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n| Port State | Port ID                              | Net ID                               | IP addresses | MAC Addr          |\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n| ACTIVE     | 3155cbf3-ddcb-4acd-b5a1-dc37f4a49a4c | 9ea97f2d-7ead-44b1-91e1-afc7ca22e21e | 10.0.0.4     | fa:16:3e:49:48:8e |\n| ACTIVE     | 4fbca26b-95bd-4d74-8f56-20b1acfa8e89 | 80feacbb-6bd5-4a3a-adff-a715b78c5d3e | 172.16.0.11  | fa:16:3e:b3:33:ae |\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n\n\n(2) \u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u4e0a\u3067\u306e\u78ba\u8a8d\n\n\u73fe\u5728\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u72b6\u614b\u306e\u78ba\u8a8d\uff08 \"ens7\" \u306bNIC\u540d\u304c\u5909\u308f\u3063\u3066\u3057\u307e\u3063\u305f\uff09\n\nroot@server1:~# ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: ens3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether fa:16:3e:49:48:8e brd ff:ff:ff:ff:ff:ff\n    inet 10.0.0.4/24 brd 10.0.0.255 scope global ens3\n       valid_lft forever preferred_lft forever\n    inet6 fe80::f816:3eff:fe49:488e/64 scope link \n       valid_lft forever preferred_lft forever\n4: ens7: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether fa:16:3e:b3:33:ae brd ff:ff:ff:ff:ff:ff\n\n\nPCI\u63a5\u7d9a\u30c7\u30d0\u30a4\u30b9\u306e\u78ba\u8a8d\n\nroot@server1:~# lspci |grep Ether\n00:03.0 Ethernet controller: Red Hat, Inc Virtio network device\n00:07.0 Ethernet controller: Red Hat, Inc Virtio network device\n\n[\u5b9f\u9a13\u7d50\u679c]\nneuton\u4e0a\u3067\u306e\u30dd\u30fc\u30c8\u53d6\u308a\u5916\u3057/\u53d6\u308a\u4ed8\u3051\u3092\u884c\u3046\u3068\u3001\u66ab\u5b9a\u3067\u8a2d\u5b9a\u3057\u3066\u3044\u305fIP\u30a2\u30c9\u30ec\u30b9\u5024\u304c\u7121\u52b9\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\u3055\u3089\u306b\u3001Ether\u30c7\u30d0\u30a4\u30b9\u30ab\u30fc\u30c9\u306e\u63a5\u7d9aPCI\u30dd\u30fc\u30c8\u304c\u5909\u66f4\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\u3061\u306a\u307f\u306b\u3001MAC\u30a2\u30c9\u30ec\u30b9\u306f\u3001\u7279\u306b\u3001\u5909\u5316\u3057\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n\n\u25a0 \u7d42\u308f\u308a\u306b\n\u4eca\u56de\u306f\u3001\u5b9f\u74b0\u5883\u3067\u306f\u3001\u767a\u751f\u3057\u3048\u306a\u3044\u52d5\u4f5c\u3092\u3001\u7d4c\u9a13\u3059\u308b\u3053\u3068\u3068\u306a\u308a\u307e\u3057\u305f\u3002\nOpenStack\u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\u306f\u3001\u4e8c\u3064\u306e\u7570\u306a\u308bOpenStack\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u3092\u57fa\u76e4\u3068\u3057\u3066\u69cb\u6210\u3055\u308c\u308b\u305f\u3081\u3067\u3059\u304c\u3001\u3044\u307e\u3044\u3061\u3001\u6709\u52b9\u306a\u89e3\u6c7a\u65b9\u6cd5\u304c\u898b\u3064\u304b\u3063\u3066\u3044\u306a\u3044\u73fe\u72b6\u3067\u3059\u3002\nOpenStack\u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u6d3b\u7528\u3057\u3066\u3001\u30af\u30e9\u30a6\u30c9\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u81ea\u52d5\u5316\u304c\u4e00\u822c\u5316\u3057\u3064\u3064\u3042\u308a\u307e\u3059\u3057\u3001NFV\u306e\u3088\u3046\u306a\u67d4\u8edf\u306a\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u5236\u5fa1\u3092\u5b9f\u73fe\u3059\u308b\u969b\u306b\u306f\u3001\u963b\u5bb3\u8981\u56e0\u306b\u306a\u308a\u305d\u3046\u306a\u6c17\u304c\u3057\u307e\u3059\u3002\u307f\u306a\u3055\u3093\u3001\u3069\u3046\u3084\u3063\u3066\u3001\u89e3\u6c7a\u3057\u3066\u3044\u308b\u304b\u6c17\u306b\u306a\u308b\u3068\u3053\u308d\u3067\u3059\u3002\nOpenStack\u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u57fa\u672c\u52d5\u4f5c\u3092\u4f53\u9a13\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\n## \u25a0 \u3084\u3063\u3066\u307f\u305f\u3053\u3068\nOpenStaxk\u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u3001\u8a66\u3057\u3066\u307f\u305f\u3053\u3068\u306f\u3001\n\n- \u30b5\u30fc\u30d0\u6a5f\u5668\uff12\u53f0\u3092\u3001HUB\u63a5\u7d9a\u3059\u308b\n- \u30b5\u30fc\u30d0\u6a5f\u5668\u306b\u3001IP\u30a2\u30c9\u30ec\u30b9\u3092\u4ed8\u4e0e\u3059\u308b\n- \u30b5\u30fc\u30d0\u6a5f\u5668\u306e\u9593\u3067\u3001ping\u901a\u4fe1\u3057\u3066\u307f\u308b\n\n\u3068\u3044\u3046\u3001\u975e\u5e38\u306b\u30b7\u30f3\u30d7\u30eb\u306a\u5185\u5bb9\u3067\u3059\u3002\n\n![Openstack.001.jpeg](https://qiita-image-store.s3.amazonaws.com/0/103595/2b8ef004-205d-62f2-0770-fbd295e4d943.jpeg)\n\n\n## \u25a0 OpenStack\u5b9f\u9a13\u74b0\u5883\n[\"Nested KVM\u74b0\u5883\u3067\u306eNewton\u7248OpenStack\u69cb\u7bc9\u30e1\u30e2\"](http://qiita.com/ttsubo/items/8eeb047c2a87d605a6ef)\u3067\u4f5c\u6210\u3057\u305fOpenStack\u74b0\u5883\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n- nova\u4eee\u60f3\u30de\u30b7\u30f3\u4e00\u89a7\n\n```\n[root@newton ~(keystone_demo)]# nova list\n+--------------------------------------+---------+--------+------------+-------------+----------------------------------+\n| ID                                   | Name    | Status | Task State | Power State | Networks                         |\n+--------------------------------------+---------+--------+------------+-------------+----------------------------------+\n| ab70f784-385d-44a8-b010-1322e7be94a7 | server1 | ACTIVE | -          | Running     | admin_net=10.0.0.4, 10.79.5.191  |\n| 06521269-bddb-4def-8369-3f92fd2f4622 | server2 | ACTIVE | -          | Running     | admin_net=10.0.0.11, 10.79.5.195 |\n+--------------------------------------+---------+--------+------------+-------------+----------------------------------+\n```\n- neutron\u30d5\u30ed\u30fc\u30c6\u30a3\u30f3\u30b0IP\u4e00\u89a7\n\n```\n[root@newton ~(keystone_demo)]# neutron floatingip-list\n+--------------------------------------+------------------+---------------------+--------------------------------------+\n| id                                   | fixed_ip_address | floating_ip_address | port_id                              |\n+--------------------------------------+------------------+---------------------+--------------------------------------+\n| affd1370-760d-4148-9d48-5afb9f97eaf5 | 10.0.0.4         | 10.79.5.191         | 3155cbf3-ddcb-4acd-b5a1-dc37f4a49a4c |\n| cb83e8bc-47c2-438a-8c74-2f1654ddc09c | 10.0.0.11        | 10.79.5.195         | 75f7e4ac-600b-4a45-9948-d45b3ec7169b |\n+--------------------------------------+------------------+---------------------+--------------------------------------+\n```\n- OpenStack\u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\u30a4\u30e1\u30fc\u30b8\n\n![topology1.png](https://qiita-image-store.s3.amazonaws.com/0/103595/247e9f0d-ecee-90b6-b5e8-ce2c9d0bef0c.png)\n\n\n\n\n## \u25a0 \u5b9f\u9a13\uff11\u300c\u30b5\u30fc\u30d0\u6a5f\u5668\uff12\u53f0\u3092\u3001HUB\u63a5\u7d9a\u3057\u3066\u307f\u308b\u300d\nuser\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u914d\u5099\u3057\u3066\u3001ping\u758e\u901a\u78ba\u8a8d\u3092\u884c\u3063\u3066\u307f\u307e\u3059\u3002\n\n### (1) user\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7528\u30dd\u30fc\u30c8\u3092\u4f5c\u6210\u3059\u308b\n- \u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u7528\u30dd\u30fc\u30c8\u306e\u4f5c\u6210\n\n```\n[root@newton ~(keystone_demo)]# neutron port-create --name user_port1 user_net\nCreated a new port:\n+-----------------------+------------------------------------------------------------------------------------+\n| Field                 | Value                                                                              |\n+-----------------------+------------------------------------------------------------------------------------+\n| admin_state_up        | True                                                                               |\n| allowed_address_pairs |                                                                                    |\n| binding:vnic_type     | normal                                                                             |\n| created_at            | 2017-02-03T00:29:03Z                                                               |\n| description           |                                                                                    |\n| device_id             |                                                                                    |\n| device_owner          |                                                                                    |\n| extra_dhcp_opts       |                                                                                    |\n| fixed_ips             | {\"subnet_id\": \"9f0e59df-d6c8-4c2d-9de5-8979798e5350\", \"ip_address\": \"172.16.0.11\"} |\n| id                    | 4fbca26b-95bd-4d74-8f56-20b1acfa8e89                                               |\n| mac_address           | fa:16:3e:b3:33:ae                                                                  |\n| name                  | user_port1                                                                         |\n| network_id            | 80feacbb-6bd5-4a3a-adff-a715b78c5d3e                                               |\n| project_id            | 67d85efd952f4b6a8c03c6f86fecb8ea                                                   |\n| revision_number       | 4                                                                                  |\n| security_groups       | bff315ad-0f08-45f8-8b14-5d19a9f95aa6                                               |\n| status                | DOWN                                                                               |\n| tenant_id             | 67d85efd952f4b6a8c03c6f86fecb8ea                                                   |\n| updated_at            | 2017-02-03T00:29:04Z                                                               |\n+-----------------------+------------------------------------------------------------------------------------+\n```\n- \u4eee\u60f3\u30de\u30b7\u30f3\"server2\"\u7528\u30dd\u30fc\u30c8\u306e\u4f5c\u6210\n\n```\n[root@newton ~(keystone_demo)]# neutron port-create --name user_port2 user_net\nCreated a new port:\n+-----------------------+------------------------------------------------------------------------------------+\n| Field                 | Value                                                                              |\n+-----------------------+------------------------------------------------------------------------------------+\n| admin_state_up        | True                                                                               |\n| allowed_address_pairs |                                                                                    |\n| binding:vnic_type     | normal                                                                             |\n| created_at            | 2017-02-03T00:29:12Z                                                               |\n| description           |                                                                                    |\n| device_id             |                                                                                    |\n| device_owner          |                                                                                    |\n| extra_dhcp_opts       |                                                                                    |\n| fixed_ips             | {\"subnet_id\": \"9f0e59df-d6c8-4c2d-9de5-8979798e5350\", \"ip_address\": \"172.16.0.12\"} |\n| id                    | e1776e0d-9f64-4684-b050-c8749f8c9a88                                               |\n| mac_address           | fa:16:3e:38:dc:ef                                                                  |\n| name                  | user_port2                                                                         |\n| network_id            | 80feacbb-6bd5-4a3a-adff-a715b78c5d3e                                               |\n| project_id            | 67d85efd952f4b6a8c03c6f86fecb8ea                                                   |\n| revision_number       | 4                                                                                  |\n| security_groups       | bff315ad-0f08-45f8-8b14-5d19a9f95aa6                                               |\n| status                | DOWN                                                                               |\n| tenant_id             | 67d85efd952f4b6a8c03c6f86fecb8ea                                                   |\n| updated_at            | 2017-02-03T00:29:13Z                                                               |\n+-----------------------+------------------------------------------------------------------------------------+\n```\n- \u767b\u9332\u6e08\u307f\u306eport\u4e00\u89a7\u306e\u78ba\u8a8d\n\n```\n[root@newton ~(keystone_demo)]# neutron port-list \n+--------------------------------------+------------+-------------------+---------------------------------------------------+\n| id                                   | name       | mac_address       | fixed_ips                                         |\n+--------------------------------------+------------+-------------------+---------------------------------------------------+\n| 3155cbf3-ddcb-4acd-b5a1-dc37f4a49a4c |            | fa:16:3e:49:48:8e | {\"subnet_id\": \"31a40092-042b-4f27-a00c-           |\n|                                      |            |                   | 54c9324db2ac\", \"ip_address\": \"10.0.0.4\"}          |\n| 3c173d98-c714-492d-8c6f-ef330c0e5d12 |            | fa:16:3e:6a:16:02 | {\"subnet_id\": \"31a40092-042b-4f27-a00c-           |\n|                                      |            |                   | 54c9324db2ac\", \"ip_address\": \"10.0.0.2\"}          |\n| 4fbca26b-95bd-4d74-8f56-20b1acfa8e89 | user_port1 | fa:16:3e:b3:33:ae | {\"subnet_id\": \"9f0e59df-d6c8-4c2d-                |\n|                                      |            |                   | 9de5-8979798e5350\", \"ip_address\": \"172.16.0.11\"}  |\n| 5da3eb5e-d1ff-41ec-a583-0cefc19e7973 |            | fa:16:3e:4e:58:bc | {\"subnet_id\": \"31a40092-042b-4f27-a00c-           |\n|                                      |            |                   | 54c9324db2ac\", \"ip_address\": \"10.0.0.1\"}          |\n| 680fcfb5-2e04-4ec5-a77c-3c6fd29d9ea9 |            | fa:16:3e:0f:0d:f1 | {\"subnet_id\": \"9f0e59df-d6c8-4c2d-                |\n|                                      |            |                   | 9de5-8979798e5350\", \"ip_address\": \"172.16.0.2\"}   |\n| 75f7e4ac-600b-4a45-9948-d45b3ec7169b |            | fa:16:3e:7c:92:60 | {\"subnet_id\": \"31a40092-042b-4f27-a00c-           |\n|                                      |            |                   | 54c9324db2ac\", \"ip_address\": \"10.0.0.11\"}         |\n| e1776e0d-9f64-4684-b050-c8749f8c9a88 | user_port2 | fa:16:3e:38:dc:ef | {\"subnet_id\": \"9f0e59df-d6c8-4c2d-                |\n|                                      |            |                   | 9de5-8979798e5350\", \"ip_address\": \"172.16.0.12\"}  |\n+--------------------------------------+------------+-------------------+---------------------------------------------------+\n```\n\n### (2) \u4eee\u60f3\u30de\u30b7\u30f3\u306b\u3001user\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7528\u30dd\u30fc\u30c8\u3092\u53d6\u308a\u4ed8\u3051\u308b\n\n- \u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u5074\u3067\u306e\u30dd\u30fc\u30c8\u53d6\u308a\u4ed8\u3051\n\n```\n[root@newton ~(keystone_demo)]# nova interface-attach --port-id 4fbca26b-95bd-4d74-8f56-20b1acfa8e89 server1\n```\n- \u4eee\u60f3\u30de\u30b7\u30f3\"server2\"\u5074\u3067\u306e\u30dd\u30fc\u30c8\u53d6\u308a\u4ed8\u3051\n\n```\n[root@newton ~(keystone_demo)]# nova interface-attach --port-id e1776e0d-9f64-4684-b050-c8749f8c9a88 server2\n```\n- \u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u5074\u3067\u306e\u767b\u9332\u6e08\u307f\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u4e00\u89a7\u306e\u78ba\u8a8d\n\n```\n[root@newton ~(keystone_demo)]# nova interface-list server1\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n| Port State | Port ID                              | Net ID                               | IP addresses | MAC Addr          |\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n| ACTIVE     | 3155cbf3-ddcb-4acd-b5a1-dc37f4a49a4c | 9ea97f2d-7ead-44b1-91e1-afc7ca22e21e | 10.0.0.4     | fa:16:3e:49:48:8e |\n| ACTIVE     | 4fbca26b-95bd-4d74-8f56-20b1acfa8e89 | 80feacbb-6bd5-4a3a-adff-a715b78c5d3e | 172.16.0.11  | fa:16:3e:b3:33:ae |\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n```\n- \u4eee\u60f3\u30de\u30b7\u30f3\"server2\"\u5074\u3067\u306e\u767b\u9332\u6e08\u307f\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u4e00\u89a7\u306e\u78ba\u8a8d\n\n```\n[root@newton ~(keystone_demo)]# nova interface-list server2\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n| Port State | Port ID                              | Net ID                               | IP addresses | MAC Addr          |\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n| ACTIVE     | 75f7e4ac-600b-4a45-9948-d45b3ec7169b | 9ea97f2d-7ead-44b1-91e1-afc7ca22e21e | 10.0.0.11    | fa:16:3e:7c:92:60 |\n| ACTIVE     | e1776e0d-9f64-4684-b050-c8749f8c9a88 | 80feacbb-6bd5-4a3a-adff-a715b78c5d3e | 172.16.0.12  | fa:16:3e:38:dc:ef |\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n```\n### (3) \u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u4e0a\u3067\u3001\u53d6\u308a\u4ed8\u3051\u6e08\u307f\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u6709\u52b9\u306b\u3059\u308b\n- \u73fe\u5728\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u72b6\u614b\u306e\u78ba\u8a8d\uff08 **\"ens6\"** \u304c\u65b0\u305f\u306b\u8ffd\u52a0\u306b\u306a\u3063\u305f\uff09\n\n```\nubuntu@server1:~$ ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: ens3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether fa:16:3e:49:48:8e brd ff:ff:ff:ff:ff:ff\n    inet 10.0.0.4/24 brd 10.0.0.255 scope global ens3\n       valid_lft forever preferred_lft forever\n    inet6 fe80::f816:3eff:fe49:488e/64 scope link \n       valid_lft forever preferred_lft forever\n3: ens6: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether fa:16:3e:b3:33:ae brd ff:ff:ff:ff:ff:ff\n```\n- PCI\u63a5\u7d9a\u30c7\u30d0\u30a4\u30b9\u306e\u78ba\u8a8d\n\n```\nroot@server1:~# lspci |grep Ether\n00:03.0 Ethernet controller: Red Hat, Inc Virtio network device\n00:06.0 Ethernet controller: Red Hat, Inc Virtio network device\n```\n\n- \u66ab\u5b9a\u3068\u3057\u3066\u3001IP\u30a2\u30c9\u30ec\u30b9\u5024\u3092\u4ed8\u4e0e\n\n```\nubuntu@server1:~$ sudo -i\nroot@server1:~# ip addr add 172.16.0.11/24 dev ens6\nroot@server1:~# ip link set ens6 up\n```\n- \u518d\u5ea6\u3001\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u72b6\u614b\u306e\u78ba\u8a8d\n\n```\nroot@server1:~# ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: ens3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether fa:16:3e:49:48:8e brd ff:ff:ff:ff:ff:ff\n    inet 10.0.0.4/24 brd 10.0.0.255 scope global ens3\n       valid_lft forever preferred_lft forever\n    inet6 fe80::f816:3eff:fe49:488e/64 scope link \n       valid_lft forever preferred_lft forever\n3: ens6: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether fa:16:3e:b3:33:ae brd ff:ff:ff:ff:ff:ff\n    inet 172.16.0.11/24 scope global ens6\n       valid_lft forever preferred_lft forever\n    inet6 fe80::f816:3eff:feb3:33ae/64 scope link \n       valid_lft forever preferred_lft forever\n```\n\n### (4) \u4eee\u60f3\u30de\u30b7\u30f3\"server2\"\u4e0a\u3067\u3001\u53d6\u308a\u4ed8\u3051\u6e08\u307f\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u6709\u52b9\u306b\u3059\u308b\n- \u73fe\u5728\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u72b6\u614b\u306e\u78ba\u8a8d\uff08\"eth1\"\u304c\u65b0\u305f\u306b\u8ffd\u52a0\u306b\u306a\u3063\u305f\uff09\n\n```\n$ ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 16436 qdisc noqueue \n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc pfifo_fast qlen 1000\n    link/ether fa:16:3e:7c:92:60 brd ff:ff:ff:ff:ff:ff\n    inet 10.0.0.11/24 brd 10.0.0.255 scope global eth0\n    inet6 fe80::f816:3eff:fe7c:9260/64 scope link \n       valid_lft forever preferred_lft forever\n3: eth1: <BROADCAST,MULTICAST> mtu 1500 qdisc noop qlen 1000\n    link/ether fa:16:3e:38:dc:ef brd ff:ff:ff:ff:ff:ff\n```\n- \u66ab\u5b9a\u3068\u3057\u3066\u3001IP\u30a2\u30c9\u30ec\u30b9\u5024\u3092\u4ed8\u4e0e\n\n```\n$ sudo -i\n# ip addr add 172.16.0.12/24 dev eth1\n# ip link set eth1 up\n```\n- \u518d\u5ea6\u3001\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u72b6\u614b\u306e\u78ba\u8a8d\n\n```\n# ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 16436 qdisc noqueue \n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc pfifo_fast qlen 1000\n    link/ether fa:16:3e:7c:92:60 brd ff:ff:ff:ff:ff:ff\n    inet 10.0.0.11/24 brd 10.0.0.255 scope global eth0\n    inet6 fe80::f816:3eff:fe7c:9260/64 scope link \n       valid_lft forever preferred_lft forever\n3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast qlen 1000\n    link/ether fa:16:3e:38:dc:ef brd ff:ff:ff:ff:ff:ff\n    inet 172.16.0.12/24 scope global eth1\n    inet6 fe80::f816:3eff:fe38:dcef/64 scope link \n       valid_lft forever preferred_lft forever\n```\n\n### (4) \u4eee\u60f3\u30de\u30b7\u30f3\u9593\u3067\u306e\u758e\u901a\u6027\u3092\u78ba\u8a8d\u3057\u3066\u307f\u308b\n- \u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u4e0a\u3067\u3001\u5bfe\u5411\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u5b9b\u3066\u306b\u3001ping\u3092\u6253\u3063\u3066\u307f\u308b\n\n```\nroot@server1:~# ping 172.16.0.12\nPING 172.16.0.12 (172.16.0.12) 56(84) bytes of data.\n64 bytes from 172.16.0.12: icmp_seq=1 ttl=64 time=2.28 ms\n64 bytes from 172.16.0.12: icmp_seq=2 ttl=64 time=2.19 ms\n64 bytes from 172.16.0.12: icmp_seq=3 ttl=64 time=0.708 ms\n^C\n--- 172.16.0.12 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2003ms\nrtt min/avg/max/mdev = 0.708/1.730/2.288/0.724 ms\n```\n\n- \u6700\u7d42\u7684\u306b\u3001\u4f5c\u6210\u3057\u305f\u30c8\u30dd\u30ed\u30b8\u69cb\u6210\n![topology.png](https://qiita-image-store.s3.amazonaws.com/0/103595/46417795-f800-db69-de5c-22cf1f40e63c.png)\n\n\u3053\u3053\u307e\u3067\u306f\u3001\u9806\u8abf\u306b\u3001OpenStack\u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u4f5c\u6210\u3067\u304d\u307e\u3057\u305f\u3002\n\n## \u25a0 \u5b9f\u9a13\uff12\u300cHUB\u63a5\u7d9a\u3057\u305f\u30b5\u30fc\u30d0\u6a5f\u5668\u306eLAN\u30b1\u30fc\u30d6\u30eb\u3092\u629c\u304d\u5dee\u3057\u3057\u3066\u307f\u308b\u300d\n\u7d9a\u3044\u3066\u3001\u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u5074\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u53d6\u308a\u5916\u3057/\u53d6\u308a\u4ed8\u3051\u3092\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\n![Openstack.002.jpeg](https://qiita-image-store.s3.amazonaws.com/0/103595/b7851886-d8ae-f8c6-b880-689f0fddb15f.jpeg)\n\n\n### (1) neuton\u4e0a\u3067\u306e\u30dd\u30fc\u30c8\u53d6\u308a\u5916\u3057/\u53d6\u308a\u4ed8\u3051\n- \u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u5074\u3067\u306e\u767b\u9332\u6e08\u307f\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u4e00\u89a7\u306e\u78ba\u8a8d\n\n```\n[root@newton ~(keystone_demo)]# nova interface-list server1\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n| Port State | Port ID                              | Net ID                               | IP addresses | MAC Addr          |\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n| ACTIVE     | 3155cbf3-ddcb-4acd-b5a1-dc37f4a49a4c | 9ea97f2d-7ead-44b1-91e1-afc7ca22e21e | 10.0.0.4     | fa:16:3e:49:48:8e |\n| ACTIVE     | 4fbca26b-95bd-4d74-8f56-20b1acfa8e89 | 80feacbb-6bd5-4a3a-adff-a715b78c5d3e | 172.16.0.11  | fa:16:3e:b3:33:ae |\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n```\n- \u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u5074\u306e\u30dd\u30fc\u30c8\u53d6\u308a\u5916\u3057\n\n```\n[root@newton ~(keystone_demo)]# nova interface-detach server1 4fbca26b-95bd-4d74-8f56-20b1acfa8e89\n```\n- \u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u5074\u3067\u306e\u767b\u9332\u6e08\u307f\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u4e00\u89a7\u306e\u78ba\u8a8d\n\n```\n[root@newton ~(keystone_demo)]# nova interface-list server1\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n| Port State | Port ID                              | Net ID                               | IP addresses | MAC Addr          |\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n| ACTIVE     | 3155cbf3-ddcb-4acd-b5a1-dc37f4a49a4c | 9ea97f2d-7ead-44b1-91e1-afc7ca22e21e | 10.0.0.4     | fa:16:3e:49:48:8e |\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n```\n- \u518d\u5ea6\u3001\u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u5074\u3067\u306e\u30dd\u30fc\u30c8\u53d6\u308a\u4ed8\u3051\n\n```\n[root@newton ~(keystone_demo)]# nova interface-attach --port-id 4fbca26b-95bd-4d74-8f56-20b1acfa8e89 server1\n```\n- \u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u5074\u3067\u306e\u767b\u9332\u6e08\u307f\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u4e00\u89a7\u306e\u78ba\u8a8d\n\n```\n[root@newton ~(keystone_demo)]# nova interface-list server1\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n| Port State | Port ID                              | Net ID                               | IP addresses | MAC Addr          |\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n| ACTIVE     | 3155cbf3-ddcb-4acd-b5a1-dc37f4a49a4c | 9ea97f2d-7ead-44b1-91e1-afc7ca22e21e | 10.0.0.4     | fa:16:3e:49:48:8e |\n| ACTIVE     | 4fbca26b-95bd-4d74-8f56-20b1acfa8e89 | 80feacbb-6bd5-4a3a-adff-a715b78c5d3e | 172.16.0.11  | fa:16:3e:b3:33:ae |\n+------------+--------------------------------------+--------------------------------------+--------------+-------------------+\n```\n### (2) \u4eee\u60f3\u30de\u30b7\u30f3\"server1\"\u4e0a\u3067\u306e\u78ba\u8a8d\n- \u73fe\u5728\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u72b6\u614b\u306e\u78ba\u8a8d\uff08 **\"ens7\"** \u306bNIC\u540d\u304c\u5909\u308f\u3063\u3066\u3057\u307e\u3063\u305f\uff09\n\n```\nroot@server1:~# ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: ens3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether fa:16:3e:49:48:8e brd ff:ff:ff:ff:ff:ff\n    inet 10.0.0.4/24 brd 10.0.0.255 scope global ens3\n       valid_lft forever preferred_lft forever\n    inet6 fe80::f816:3eff:fe49:488e/64 scope link \n       valid_lft forever preferred_lft forever\n4: ens7: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether fa:16:3e:b3:33:ae brd ff:ff:ff:ff:ff:ff\n```\n- PCI\u63a5\u7d9a\u30c7\u30d0\u30a4\u30b9\u306e\u78ba\u8a8d\n\n```\nroot@server1:~# lspci |grep Ether\n00:03.0 Ethernet controller: Red Hat, Inc Virtio network device\n00:07.0 Ethernet controller: Red Hat, Inc Virtio network device\n```\n\n[\u5b9f\u9a13\u7d50\u679c]\nneuton\u4e0a\u3067\u306e\u30dd\u30fc\u30c8\u53d6\u308a\u5916\u3057/\u53d6\u308a\u4ed8\u3051\u3092\u884c\u3046\u3068\u3001\u66ab\u5b9a\u3067\u8a2d\u5b9a\u3057\u3066\u3044\u305fIP\u30a2\u30c9\u30ec\u30b9\u5024\u304c\u7121\u52b9\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\u3055\u3089\u306b\u3001Ether\u30c7\u30d0\u30a4\u30b9\u30ab\u30fc\u30c9\u306e\u63a5\u7d9aPCI\u30dd\u30fc\u30c8\u304c\u5909\u66f4\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\u3061\u306a\u307f\u306b\u3001MAC\u30a2\u30c9\u30ec\u30b9\u306f\u3001\u7279\u306b\u3001\u5909\u5316\u3057\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n![OpenStack.003.jpeg](https://qiita-image-store.s3.amazonaws.com/0/103595/0f1fdda1-86e9-c189-57e4-24337545e254.jpeg)\n\n### \u25a0 \u7d42\u308f\u308a\u306b\n\u4eca\u56de\u306f\u3001\u5b9f\u74b0\u5883\u3067\u306f\u3001\u767a\u751f\u3057\u3048\u306a\u3044\u52d5\u4f5c\u3092\u3001\u7d4c\u9a13\u3059\u308b\u3053\u3068\u3068\u306a\u308a\u307e\u3057\u305f\u3002\nOpenStack\u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\u306f\u3001\u4e8c\u3064\u306e\u7570\u306a\u308bOpenStack\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u3092\u57fa\u76e4\u3068\u3057\u3066\u69cb\u6210\u3055\u308c\u308b\u305f\u3081\u3067\u3059\u304c\u3001\u3044\u307e\u3044\u3061\u3001\u6709\u52b9\u306a\u89e3\u6c7a\u65b9\u6cd5\u304c\u898b\u3064\u304b\u3063\u3066\u3044\u306a\u3044\u73fe\u72b6\u3067\u3059\u3002\n\nOpenStack\u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u6d3b\u7528\u3057\u3066\u3001\u30af\u30e9\u30a6\u30c9\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u81ea\u52d5\u5316\u304c\u4e00\u822c\u5316\u3057\u3064\u3064\u3042\u308a\u307e\u3059\u3057\u3001NFV\u306e\u3088\u3046\u306a\u67d4\u8edf\u306a\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u5236\u5fa1\u3092\u5b9f\u73fe\u3059\u308b\u969b\u306b\u306f\u3001\u963b\u5bb3\u8981\u56e0\u306b\u306a\u308a\u305d\u3046\u306a\u6c17\u304c\u3057\u307e\u3059\u3002\u307f\u306a\u3055\u3093\u3001\u3069\u3046\u3084\u3063\u3066\u3001\u89e3\u6c7a\u3057\u3066\u3044\u308b\u304b\u6c17\u306b\u306a\u308b\u3068\u3053\u308d\u3067\u3059\u3002\n"}