{"tags": ["redash", "AmazonAthena"], "context": "2016/12/01\u306b\u3001Amazon S3\u4e0a\u306e\u30c7\u30fc\u30bf\u306b\u30a2\u30c9\u30db\u30c3\u30af\u306bSQL\u30af\u30a8\u30ea\u3092\u6295\u3052\u3089\u308c\u308b\u30b5\u30fc\u30d3\u30b9\u3067\u3042\u308bAmazon Athena\u304c\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u307e\u3057\u305f\u3002\nAthena\u306e\u6982\u8981\u306b\u95a2\u3057\u3066\u306f\u4ee5\u4e0b\u3092\u3069\u3046\u305e\u3002\nAmazon Athena \u2013 Amazon S3\u4e0a\u306e\u30c7\u30fc\u30bf\u306b\u5bfe\u8a71\u7684\u306bSQL\u30af\u30a8\u30ea\u3092\nAmazon Athena\u3092\u4f7f\u3063\u3066\u307f\u307e\u3057\u305f #reinvent\nAmazon Athena\u3092BigQuery\u3068\u6bd4\u8f03\u3057\u3066\u307f\u305f\n\u81ea\u5206\u3067\u8efd\u304f\u4f7f\u3063\u3066\u307f\u305f\u611f\u3058\u3060\u3068\u3001SaaS\u306a\u306e\u3067\u7ba1\u7406\u30b3\u30b9\u30c8\u304c\u4f4e\u3044\u4e0a\u306b\u30af\u30a8\u30ea\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3082\u304b\u306a\u308a\u826f\u304f\u3001\u975e\u5e38\u306b\u53ef\u80fd\u6027\u3092\u611f\u3058\u308b\u30b5\u30fc\u30d3\u30b9\u3060\u3068\u3044\u3046\u5370\u8c61\u3067\u3059\u3002\n\u3068\u3044\u3046\u308f\u3051\u3067Amazon Athena\u3092\u3082\u3063\u3068\u4f7f\u3063\u3066\u3044\u304d\u305f\u3044\u306e\u3067\u3001OSS\u306eBI\u30c4\u30fc\u30eb\u3067\u3042\u308bre:dash\u304b\u3089Amazon Athena\u306b\u30af\u30a8\u30ea\u3092\u6295\u3052\u3089\u308c\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\u7686\u3055\u3093\u3082\u826f\u304b\u3063\u305f\u3089\u3084\u3063\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\u30b3\u30e1\u30f3\u30c8\u6b04\u306b\u3082\u3042\u308a\u307e\u3059\u304c\u3001re:dash\u4f5c\u8005\u306e@arikfr\u3055\u3093\u304c\u65e2\u306b\u516c\u5f0f\u3067\u306eAthena\u30b5\u30dd\u30fc\u30c8\u3092\u4f5c\u6210\u4e2d\u3060\u305d\u3046\u3067\u3059\uff01\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u307e\u3057\u305f\u3089\u305d\u3061\u3089\u3092\u4f7f\u3063\u305f\u65b9\u304c\u697d\u3067\u3059\u306d\u3002\n\n\u74b0\u5883\n\nUbuntu14.04\nPython 2.7.6\n\n\n\u4f5c\u696d\u624b\u9806\n\npy4j\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nAthena\u306f\u73fe\u72b6\u3067\u306fJDBC\u7d4c\u7531\u306e\u63a5\u7d9a\u3057\u304b\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001python\u304b\u3089\u63a5\u7d9a\u3059\u308b\u306b\u306f\u4e00\u624b\u9593\u3044\u308a\u307e\u3059\u3002\n\u4eca\u56de\u306fPython\u304b\u3089jar\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306b\u3001\u5225\u30d7\u30ed\u30bb\u30b9\u3067\u8d77\u52d5\u3057\u3066\u3044\u308bjava\u3068\u30bd\u30b1\u30c3\u30c8\u901a\u4fe1\u7d4c\u7531\u3067\u9023\u643a\u3059\u308bpy4j\u3092\u4f7f\u3046\u4e8b\u306b\u3057\u307e\u3057\u305f\u3002pip\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u307e\u3059\u3002\n$ sudo pip install py4j\n\n\nJava8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nAthena\u3068\u306e\u63a5\u7d9a\u3092\u884c\u3046\u305f\u3081\u306b\u306fJava8\u4ee5\u4e0a\u304c\u5fc5\u9808\u3067\u3059\u3002\nUbuntu 14.04\u306bOpen JDK 8\u3092\u5c0e\u5165\u3059\u308b\n$ sudo apt-add-repository ppa:openjdk-r/ppa\n$ sudo apt-get update\n$ sudo apt-get install openjdk-8-jdk\n$ java -version\nopenjdk version \"1.8.0_111\"\nOpenJDK Runtime Environment (build 1.8.0_111-8u111-b14-3~14.04.1-b14)\nOpenJDK 64-Bit Server VM (build 25.111-b14, mixed mode)\n\n\u307e\u305f\u3001\u81ea\u5206\u306fSSL\u95a2\u4fc2\u3067\u3064\u307e\u3065\u304d\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3082\u5b9f\u884c\u3057\u307e\u3057\u305f\u3002\n$ sudo dpkg --purge --force-depends ca-certificates-java\n$ sudo apt-get install ca-certificates-java\n$ sudo /var/lib/dpkg/info/ca-certificates-java.postinst configure\n\n\nJava\u30b5\u30fc\u30d0\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4f5c\u6210\nAthena\u3068\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3092\u78ba\u7acb\u3059\u308b\u305f\u3081\u306eJava\u306e\u30b5\u30fc\u30d0\u30fc\u7528\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\nCPython\u304b\u3089Java\u306e\u30af\u30e9\u30b9\u3092\u547c\u3073\u51fa\u3059(Py4J)\nAccessing Amazon Athena with JDBC\n\nJ4Py.java\n\npublic class J4Py {\n  public static void main(String[] args) {\n    J4Py app = new J4Py();\n    GatewayServer server = new GatewayServer(app);\n    server.start();\n  }\n}\n\n\n\nAthenaJDBCConnector.java\n\npublic class AthenaJDBCConnector {\n\n    Properties info;\n    String url;\n\n    public AthenaJDBCConnector(Properties info, String url) {\n        this.info = info;\n        this.url = url;\n    }\n\n    public Connection getConnection() {     \n        try {\n            Class.forName(\"com.amazonaws.athena.jdbc.AthenaDriver\");\n            Connection conn = DriverManager.getConnection(this.url, this.info);\n            return conn;\n        } catch (Exception ex) {\n            ex.printStackTrace();   \n        }\n\n        return null;\n    }\n\n}\n\n\n\nJar\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n\u5148\u307b\u3069\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u304b\u3089Jar\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nAthenaJDBC41-1.0.0.jar\u306f\u516c\u5f0f\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u307e\u3059\u3002\n$ javac -cp AthenaJDBC41-1.0.0.jar AthenaJDBCConnector.java\n$ jar cvf AthenaJDBCConnector.jar AthenaJDBCConnector.class\n\npy4j0.10.4.jar\u306fpy4j\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u306b\u4ed8\u3044\u3066\u304d\u307e\u3059\u3002\n\nmanifest.fm\nMain-Class: J4Py\nClass-Path: py4j0.10.4.jar AthenaJDBC41-1.0.0.jar\n\n\n$ javac -cp py4j0.10.4.jar:AthenaJDBCConnector.jar:AthenaJDBC41-1.0.0.jar J4Py.java\n$ jar cvfm J4Py.jar manifest.mf J4Py.class\n\nJ4Py.jar\u306e\u4f5c\u6210\u304c\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002\u30b5\u30d6\u30d7\u30ed\u30bb\u30b9\u3067J4Py.jar\u3092\u7acb\u3061\u4e0a\u3052\u308c\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u3066python\u304b\u3089Athena\u306e\u30af\u30a8\u30ea\u304c\u6295\u3052\u3089\u308c\u307e\u3059\u3002\n$ java -jar J4Py.jar\n\n\ntest_connection.py\nfrom py4j.java_gateway import JavaGateway\n\ngateway = JavaGateway()\ninfo = gateway.jvm.java.util.Properties()\ninfo.setProperty(\"s3_staging_dir\", 'xxx')\ninfo.setProperty(\"user\", 'yyy')\ninfo.setProperty(\"password\", 'zzz')\nhost = 'jdbc:awsathena://athena.us-west-2.amazonaws.com:443/'\nconnector = gateway.jvm.AthenaJDBCConnector(info, host)\nconn = connector.getConnection()\nstatement = conn.createStatement()\nrs = statement.executeQuery(query)\n\n\n\nre:dash\u3078\u306e\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u8ffd\u52a0\nre:dash\u306f\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3092\u30d7\u30e9\u30ac\u30d6\u30eb\u306b\u8ffd\u52a0\u53ef\u80fd\u3067\u3059\u3002\u5148\u307b\u3069\u306epython\u30d5\u30a1\u30a4\u30eb\u306e\u8981\u9818\u3067BaseQueryRunner\u3092\u7d99\u627f\u3057\u305f\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u5c11\u3057\u9577\u304f\u306a\u3063\u305f\u306e\u3067\u5916\u90e8\u306b\u7f6e\u304d\u307e\u3059\u3002\nathena.py\n\u4f5c\u6210\u3057\u305f\u30af\u30e9\u30b9\u3092query_runner/\u76f4\u4e0b\u306b\u8ffd\u52a0\u3057\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b/opt/redash/.env\u306b\u8ffd\u8a18\u3057\u3066re:dash\u3092\u518d\u8d77\u52d5\u3059\u308c\u3070OK\u3067\u3059\u3002\u4e8b\u524d\u306bJ4Py.jar\u30d7\u30ed\u30bb\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u308b\u306e\u3092\u5fd8\u308c\u306a\u3044\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002(re:dash\u306fsupervisord\u3067\u7ba1\u7406\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u3053\u306b\u76f8\u4e57\u308a\u3055\u305b\u308b\u3068\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093)\nexport REDASH_ADDITIONAL_QUERY_RUNNERS=redash.query_runner.athena\n\n\n\u30af\u30a8\u30ea\u5b9f\u884c\n\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3092\u8ffd\u52a0\u3057\u305f\u3089\u753b\u9762\u4e0a\u304b\u3089\u8a2d\u5b9a\u304c\u884c\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u306e\u3067\u3001\u5fc5\u8981\u306a\u9805\u76ee\u3092\u5165\u529b\u3057\u3066\u30af\u30a8\u30ea\u3092\u6295\u3052\u3066\u307f\u307e\u3059\u3002\n\n\u9805\u76ee\u306e\u5165\u529b\n\n\n\u30af\u30a8\u30ea\u5b9f\u884c\n\n\u7121\u4e8b\u306b\u30af\u30a8\u30ea\u304c\u6295\u3052\u3089\u308c\u307e\u3057\u305f\uff01\n\n\u7d42\u308f\u308a\nre:dash\u3068Athena\u3092\u4f7f\u3048\u3070\u4f4e\u30b3\u30b9\u30c8\u3067\u7c21\u5358\u306b\u30c7\u30fc\u30bf\u306e\u53ef\u8996\u5316\u304c\u884c\u3048\u307e\u3059\u306e\u3067\u3001\u662f\u975e\u8a66\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\uff01\n\u4eca\u56de\u306e\u30bd\u30fc\u30b9\u306f\nhttps://github.com/kakakazuma/redash/tree/feature/athena\n\u306b\u30b3\u30df\u30c3\u30c8\u3057\u3066\u3042\u308a\u307e\u3059\u3002\nAthena\u306e\u9700\u8981\u306f\u3042\u308b\u3068\u601d\u3046\u306e\u3067\u30d7\u30eb\u30ea\u30af\u3092\u51fa\u3057\u305f\u3044\u306e\u3067\u3059\u304c\u3001Java8\u304c\u5fc5\u9808\u3060\u3063\u305f\u308a\u5225\u30d7\u30ed\u30bb\u30b9\u3067Java\u3092\u8d70\u3089\u305b\u308b\u5fc5\u8981\u304c\u3042\u3063\u305f\u308a\u3068\u5c11\u3057\u8907\u96d1\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u30d5\u30a9\u30fc\u30e9\u30e0\u3067\u76f8\u8ac7\u3057\u3066\u307f\u307e\u3059\u3002\n\u516c\u5f0f\u3067\u65e2\u306b\u4f5c\u6210\u4e2d\u306e\u3088\u3046\u306a\u306e\u3067\u3001\u554f\u984c\u306a\u3055\u305d\u3046\u3067\u3059\uff01\n2016/12/01\u306b\u3001Amazon S3\u4e0a\u306e\u30c7\u30fc\u30bf\u306b\u30a2\u30c9\u30db\u30c3\u30af\u306bSQL\u30af\u30a8\u30ea\u3092\u6295\u3052\u3089\u308c\u308b\u30b5\u30fc\u30d3\u30b9\u3067\u3042\u308b**Amazon Athena**\u304c\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u307e\u3057\u305f\u3002\nAthena\u306e\u6982\u8981\u306b\u95a2\u3057\u3066\u306f\u4ee5\u4e0b\u3092\u3069\u3046\u305e\u3002\n\n[Amazon Athena \u2013 Amazon S3\u4e0a\u306e\u30c7\u30fc\u30bf\u306b\u5bfe\u8a71\u7684\u306bSQL\u30af\u30a8\u30ea\u3092](https://aws.amazon.com/jp/blogs/news/amazon-athena-interactive-sql-queries-for-data-in-amazon-s3/)\n[Amazon Athena\u3092\u4f7f\u3063\u3066\u307f\u307e\u3057\u305f #reinvent](http://dev.classmethod.jp/cloud/aws/try-aws-athena/)\n[Amazon Athena\u3092BigQuery\u3068\u6bd4\u8f03\u3057\u3066\u307f\u305f](http://data.gunosy.io/entry/aws-athena-vs-bigquery)\n\n\u81ea\u5206\u3067\u8efd\u304f\u4f7f\u3063\u3066\u307f\u305f\u611f\u3058\u3060\u3068\u3001SaaS\u306a\u306e\u3067\u7ba1\u7406\u30b3\u30b9\u30c8\u304c\u4f4e\u3044\u4e0a\u306b\u30af\u30a8\u30ea\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3082\u304b\u306a\u308a\u826f\u304f\u3001**\u975e\u5e38\u306b\u53ef\u80fd\u6027\u3092\u611f\u3058\u308b\u30b5\u30fc\u30d3\u30b9**\u3060\u3068\u3044\u3046\u5370\u8c61\u3067\u3059\u3002\n\n\u3068\u3044\u3046\u308f\u3051\u3067Amazon Athena\u3092\u3082\u3063\u3068\u4f7f\u3063\u3066\u3044\u304d\u305f\u3044\u306e\u3067\u3001OSS\u306eBI\u30c4\u30fc\u30eb\u3067\u3042\u308b**re:dash**\u304b\u3089Amazon Athena\u306b\u30af\u30a8\u30ea\u3092\u6295\u3052\u3089\u308c\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\u7686\u3055\u3093\u3082\u826f\u304b\u3063\u305f\u3089\u3084\u3063\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\n**\u30b3\u30e1\u30f3\u30c8\u6b04\u306b\u3082\u3042\u308a\u307e\u3059\u304c\u3001re:dash\u4f5c\u8005\u306e@arikfr\u3055\u3093\u304c\u65e2\u306b\u516c\u5f0f\u3067\u306eAthena\u30b5\u30dd\u30fc\u30c8\u3092\u4f5c\u6210\u4e2d\u3060\u305d\u3046\u3067\u3059\uff01\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u307e\u3057\u305f\u3089\u305d\u3061\u3089\u3092\u4f7f\u3063\u305f\u65b9\u304c\u697d\u3067\u3059\u306d\u3002**\n\n##\u74b0\u5883\n* Ubuntu14.04\n* Python 2.7.6\n\n##\u4f5c\u696d\u624b\u9806\n\n###py4j\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nAthena\u306f\u73fe\u72b6\u3067\u306fJDBC\u7d4c\u7531\u306e\u63a5\u7d9a\u3057\u304b\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001python\u304b\u3089\u63a5\u7d9a\u3059\u308b\u306b\u306f\u4e00\u624b\u9593\u3044\u308a\u307e\u3059\u3002\n\n\u4eca\u56de\u306fPython\u304b\u3089jar\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306b\u3001\u5225\u30d7\u30ed\u30bb\u30b9\u3067\u8d77\u52d5\u3057\u3066\u3044\u308bjava\u3068\u30bd\u30b1\u30c3\u30c8\u901a\u4fe1\u7d4c\u7531\u3067\u9023\u643a\u3059\u308b**py4j**\u3092\u4f7f\u3046\u4e8b\u306b\u3057\u307e\u3057\u305f\u3002pip\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u307e\u3059\u3002\n\n```sh\n$ sudo pip install py4j\n```\n\n###Java8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nAthena\u3068\u306e\u63a5\u7d9a\u3092\u884c\u3046\u305f\u3081\u306b\u306f**Java8\u4ee5\u4e0a\u304c\u5fc5\u9808**\u3067\u3059\u3002\n\n[Ubuntu 14.04\u306bOpen JDK 8\u3092\u5c0e\u5165\u3059\u308b](http://note.kurodigi.com/ubuntu1404-openjava8)\n\n```sh\n$ sudo apt-add-repository ppa:openjdk-r/ppa\n$ sudo apt-get update\n$ sudo apt-get install openjdk-8-jdk\n$ java -version\nopenjdk version \"1.8.0_111\"\nOpenJDK Runtime Environment (build 1.8.0_111-8u111-b14-3~14.04.1-b14)\nOpenJDK 64-Bit Server VM (build 25.111-b14, mixed mode)\n```\n\n\u307e\u305f\u3001\u81ea\u5206\u306fSSL\u95a2\u4fc2\u3067\u3064\u307e\u3065\u304d\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3082\u5b9f\u884c\u3057\u307e\u3057\u305f\u3002\n\n```sh\n$ sudo dpkg --purge --force-depends ca-certificates-java\n$ sudo apt-get install ca-certificates-java\n$ sudo /var/lib/dpkg/info/ca-certificates-java.postinst configure\n```\n\n###Java\u30b5\u30fc\u30d0\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4f5c\u6210\nAthena\u3068\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3092\u78ba\u7acb\u3059\u308b\u305f\u3081\u306eJava\u306e\u30b5\u30fc\u30d0\u30fc\u7528\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\n\n[CPython\u304b\u3089Java\u306e\u30af\u30e9\u30b9\u3092\u547c\u3073\u51fa\u3059(Py4J)](http://qiita.com/mojaie/items/f16b97b1388f73e56b86)\n[Accessing Amazon Athena with JDBC](http://docs.aws.amazon.com/athena/latest/ug/connect-with-jdbc.html)\n\n\n```java:J4Py.java\n\npublic class J4Py {\n  public static void main(String[] args) {\n    J4Py app = new J4Py();\n    GatewayServer server = new GatewayServer(app);\n    server.start();\n  }\n}\n```\n\n```java:AthenaJDBCConnector.java\n\npublic class AthenaJDBCConnector {\n\n\tProperties info;\n\tString url;\n\n\tpublic AthenaJDBCConnector(Properties info, String url) {\n\t\tthis.info = info;\n\t\tthis.url = url;\n\t}\n\n\tpublic Connection getConnection() {\t\t\n\t\ttry {\n\t\t\tClass.forName(\"com.amazonaws.athena.jdbc.AthenaDriver\");\n\t\t\tConnection conn = DriverManager.getConnection(this.url, this.info);\n\t\t\treturn conn;\n\t\t} catch (Exception ex) {\n\t\t\tex.printStackTrace();\t\n\t\t}\n\n\t\treturn null;\n\t}\n\n}\n```\n\n###Jar\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n\u5148\u307b\u3069\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u304b\u3089Jar\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n`AthenaJDBC41-1.0.0.jar`\u306f\u516c\u5f0f\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u307e\u3059\u3002\n\n```sh\n$ javac -cp AthenaJDBC41-1.0.0.jar AthenaJDBCConnector.java\n$ jar cvf AthenaJDBCConnector.jar AthenaJDBCConnector.class\n```\n\n`py4j0.10.4.jar`\u306fpy4j\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u306b\u4ed8\u3044\u3066\u304d\u307e\u3059\u3002\n\n```manifest.fm\nMain-Class: J4Py\nClass-Path: py4j0.10.4.jar AthenaJDBC41-1.0.0.jar\n```\n\n```sh\n$ javac -cp py4j0.10.4.jar:AthenaJDBCConnector.jar:AthenaJDBC41-1.0.0.jar J4Py.java\n$ jar cvfm J4Py.jar manifest.mf J4Py.class\n```\n\n`J4Py.jar`\u306e\u4f5c\u6210\u304c\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002\u30b5\u30d6\u30d7\u30ed\u30bb\u30b9\u3067`J4Py.jar`\u3092\u7acb\u3061\u4e0a\u3052\u308c\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u3066python\u304b\u3089Athena\u306e\u30af\u30a8\u30ea\u304c\u6295\u3052\u3089\u308c\u307e\u3059\u3002\n\n```sh\n$ java -jar J4Py.jar\n```\n\n```python:test_connection.py\nfrom py4j.java_gateway import JavaGateway\n\ngateway = JavaGateway()\ninfo = gateway.jvm.java.util.Properties()\ninfo.setProperty(\"s3_staging_dir\", 'xxx')\ninfo.setProperty(\"user\", 'yyy')\ninfo.setProperty(\"password\", 'zzz')\nhost = 'jdbc:awsathena://athena.us-west-2.amazonaws.com:443/'\nconnector = gateway.jvm.AthenaJDBCConnector(info, host)\nconn = connector.getConnection()\nstatement = conn.createStatement()\nrs = statement.executeQuery(query)\n```\n\n###re:dash\u3078\u306e\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u8ffd\u52a0\nre:dash\u306f**\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3092\u30d7\u30e9\u30ac\u30d6\u30eb\u306b\u8ffd\u52a0\u53ef\u80fd**\u3067\u3059\u3002\u5148\u307b\u3069\u306epython\u30d5\u30a1\u30a4\u30eb\u306e\u8981\u9818\u3067BaseQueryRunner\u3092\u7d99\u627f\u3057\u305f\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u5c11\u3057\u9577\u304f\u306a\u3063\u305f\u306e\u3067\u5916\u90e8\u306b\u7f6e\u304d\u307e\u3059\u3002\n\n[athena.py](https://github.com/kakakazuma/redash/blob/0d47c900f7ac86f0769faeb5769fc9e781948d6e/redash/query_runner/athena.py\n)\n\n\u4f5c\u6210\u3057\u305f\u30af\u30e9\u30b9\u3092query_runner/\u76f4\u4e0b\u306b\u8ffd\u52a0\u3057\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b`/opt/redash/.env`\u306b\u8ffd\u8a18\u3057\u3066re:dash\u3092\u518d\u8d77\u52d5\u3059\u308c\u3070OK\u3067\u3059\u3002\u4e8b\u524d\u306b`J4Py.jar`\u30d7\u30ed\u30bb\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u308b\u306e\u3092\u5fd8\u308c\u306a\u3044\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002(re:dash\u306fsupervisord\u3067\u7ba1\u7406\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u3053\u306b\u76f8\u4e57\u308a\u3055\u305b\u308b\u3068\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093)\n\n```\nexport REDASH_ADDITIONAL_QUERY_RUNNERS=redash.query_runner.athena\n```\n\n###\u30af\u30a8\u30ea\u5b9f\u884c\n\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3092\u8ffd\u52a0\u3057\u305f\u3089\u753b\u9762\u4e0a\u304b\u3089\u8a2d\u5b9a\u304c\u884c\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u306e\u3067\u3001\u5fc5\u8981\u306a\u9805\u76ee\u3092\u5165\u529b\u3057\u3066\u30af\u30a8\u30ea\u3092\u6295\u3052\u3066\u307f\u307e\u3059\u3002\n\n####\u9805\u76ee\u306e\u5165\u529b\n<img width=\"822\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-12-09 17.28.27.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/49019/48aeb7a9-8f5c-5aca-43df-f7255a0fb4e1.png\">\n\n####\u30af\u30a8\u30ea\u5b9f\u884c\n<img width=\"1336\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-12-09 17.29.38.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/49019/53d8efab-f29b-e3e0-31cc-89812302051a.png\">\n\n\n\u7121\u4e8b\u306b\u30af\u30a8\u30ea\u304c\u6295\u3052\u3089\u308c\u307e\u3057\u305f\uff01\n\n##\u7d42\u308f\u308a\nre:dash\u3068Athena\u3092\u4f7f\u3048\u3070\u4f4e\u30b3\u30b9\u30c8\u3067\u7c21\u5358\u306b\u30c7\u30fc\u30bf\u306e\u53ef\u8996\u5316\u304c\u884c\u3048\u307e\u3059\u306e\u3067\u3001\u662f\u975e\u8a66\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\uff01\n\n\u4eca\u56de\u306e\u30bd\u30fc\u30b9\u306f\nhttps://github.com/kakakazuma/redash/tree/feature/athena\n\u306b\u30b3\u30df\u30c3\u30c8\u3057\u3066\u3042\u308a\u307e\u3059\u3002\n\n~~Athena\u306e\u9700\u8981\u306f\u3042\u308b\u3068\u601d\u3046\u306e\u3067\u30d7\u30eb\u30ea\u30af\u3092\u51fa\u3057\u305f\u3044\u306e\u3067\u3059\u304c\u3001Java8\u304c\u5fc5\u9808\u3060\u3063\u305f\u308a\u5225\u30d7\u30ed\u30bb\u30b9\u3067Java\u3092\u8d70\u3089\u305b\u308b\u5fc5\u8981\u304c\u3042\u3063\u305f\u308a\u3068\u5c11\u3057\u8907\u96d1\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u30d5\u30a9\u30fc\u30e9\u30e0\u3067\u76f8\u8ac7\u3057\u3066\u307f\u307e\u3059\u3002~~\n**\u516c\u5f0f\u3067\u65e2\u306b\u4f5c\u6210\u4e2d\u306e\u3088\u3046\u306a\u306e\u3067\u3001\u554f\u984c\u306a\u3055\u305d\u3046\u3067\u3059\uff01**\n\n\n"}