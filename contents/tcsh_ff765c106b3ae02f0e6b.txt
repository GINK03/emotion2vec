{"context": " More than 1 year has passed since last update.\n\n\u524d\u63d0\u6761\u4ef6\n\nECS\u3078\u306e\u6a29\u9650\n\nECS\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\n\nEC2\u3078\u306e\u6a29\u9650\n\nEC2\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\n\nAWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\n\n\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\nAWS CLI 1.7.36\n\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws --version\n\n\n\n\u7d50\u679c(\u4f8b)\n      aws-cli/1.7.28 Python/2.7.5 Darwin/13.4.0\n\n\n\n0. \u6e96\u5099\n\n0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u6c7a\u5b9a\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nexport AWS_DEFAULT_REGION='ap-northeast-1'\n\n\n\n0.2. \u5909\u6570\u306e\u78ba\u8a8d\n\n\u5909\u6570\u306e\u78ba\u8a8d\naws configure list\n\n\n\n\u7d50\u679c(\u4f8b)\n            Name                    Value             Type    Location\n            ----                    -----             ----    --------\n         profile   ec2ecs_full-prjZ-mbp13              env    AWS_DEFAULT_PROFILE\n      access_key     ****************LOAQ shared-credentials-file\n      secret_key     ****************I1O1 shared-credentials-file\n          region           ap-northeast-1              env    AWS_DEFAULT_REGION\n\n\n\n0.3. ECS\u30af\u30e9\u30b9\u30bf\u540d\u306e\u6307\u5b9a\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nECS_CLUSTER_NAME='handson-cluster'\n\n\n\n1. ECS\u30b3\u30f3\u30c6\u30ca\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u767b\u9332\u524a\u9664\n\n1.1. ECS\u30af\u30e9\u30b9\u30bf\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ecs describe-clusters \\\n        --clusters ${ECS_CLUSTER_NAME}\n\n\n\n\u7d50\u679c(\u4f8b)\n       {\n         \"clusters\": [\n           {\n             \"status\": \"ACTIVE\",\n             \"clusterName\": \"handson-cluster\",\n             \"registeredContainerInstancesCount\": 1,\n             \"pendingTasksCount\": 0,\n             \"runningTasksCount\": 0,\n             \"activeServicesCount\": 0,\n             \"clusterArn\": \"arn:aws:ecs:ap-northeast-1:XXXXXXXXXXXX:cluster/handson-cluster\"\n           }\n         ],\n         \"failures\": []\n      }\n\n\n\n1.2. ECS\u30b3\u30f3\u30c6\u30ca\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u72b6\u614b\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\nECS_INSTANCES=$( \\\n        aws ecs list-container-instances \\\n          --cluster ${ECS_CLUSTER_NAME} \\\n          --query 'containerInstanceArns[]' \\\n          --output text | \\\n        sed 's|^arn:aws:ecs:.*:container-instance/||' \\\n      ) \\\n        && echo ${ECS_INSTANCES}\n\n\n\n\u7d50\u679c(\u4f8b)\n      xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\n\n\n\n\u30b3\u30de\u30f3\u30c9\nARRAY_ECS_INSTANCE_STATUS=$( \\\n        aws ecs describe-container-instances \\\n          --cluster ${ECS_CLUSTER_NAME} \\\n          --container-instances \"${ECS_INSTANCES}\" \\\n          --query 'containerInstances[].status' \\\n          --output text \\\n      ) \\\n        && echo ${ARRAY_ECS_INSTANCE_STATUS}\n\n\n\n\u7d50\u679c\n      ACTIVE\n\n\n\n1.3. EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\u306e\u53d6\u5f97\n\n\u30b3\u30de\u30f3\u30c9\nARRAY_EC2_INSTANCE_ID=$( \\\n        aws ecs describe-container-instances \\\n          --cluster ${ECS_CLUSTER_NAME} \\\n          --container-instances \"${ECS_INSTANCES}\" \\\n          --query 'containerInstances[].ec2InstanceId' \\\n          --output text \\\n      ) \\\n        && echo ${ARRAY_EC2_INSTANCE_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\n      i-xxxxxxxx\n\n\n\n1.4. ECS\u30b3\u30f3\u30c6\u30ca\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u767b\u9332\u524a\u9664\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n        ECS_CLUSTER_NAME: ${ECS_CLUSTER_NAME}\n        ECS_INSTANCES:    ${ECS_INSTANCES}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws ecs deregister-container-instance \\\n        --cluster ${ECS_CLUSTER_NAME} \\\n        --container-instance ${ECS_INSTANCES}\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n        \"containerInstance\": {\n          \"status\": \"INACTIVE\",\n          \"registeredResources\": [\n              {\n                  \"integerValue\": 1024,\n                  \"longValue\": 0,\n                  \"type\": \"INTEGER\",\n                  \"name\": \"CPU\",\n                  \"doubleValue\": 0.0\n              },\n              {\n                  \"integerValue\": 996,\n                  \"longValue\": 0,\n                  \"type\": \"INTEGER\",\n                  \"name\": \"MEMORY\",\n                  \"doubleValue\": 0.0\n              },\n              {\n                  \"name\": \"PORTS\",\n                  \"longValue\": 0,\n                  \"doubleValue\": 0.0,\n                  \"stringSetValue\": [\n                      \"22\",\n                      \"2376\",\n                      \"2375\",\n                      \"51678\"\n                  ],\n                  \"type\": \"STRINGSET\",\n                  \"integerValue\": 0\n              },\n              {\n                  \"name\": \"PORTS_UDP\",\n                  \"longValue\": 0,\n                  \"doubleValue\": 0.0,\n                  \"stringSetValue\": [],\n                  \"type\": \"STRINGSET\",\n                  \"integerValue\": 0\n              }\n          ],\n          \"ec2InstanceId\": \"i-xxxxxxxx\",\n          \"agentConnected\": true,\n          \"containerInstanceArn\": \"arn:aws:ecs:ap-northeast-1:XXXXXXXXXXXX:container-instance/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\",\n          \"pendingTasksCount\": 0,\n          \"remainingResources\": [\n              {\n                  \"integerValue\": 1024,\n                  \"longValue\": 0,\n                  \"type\": \"INTEGER\",\n                  \"name\": \"CPU\",\n                  \"doubleValue\": 0.0\n              },\n              {\n                  \"integerValue\": 996,\n                  \"longValue\": 0,\n                  \"type\": \"INTEGER\",\n                  \"name\": \"MEMORY\",\n                  \"doubleValue\": 0.0\n              },\n              {\n                  \"name\": \"PORTS\",\n                  \"longValue\": 0,\n                  \"doubleValue\": 0.0,\n                  \"stringSetValue\": [\n                      \"22\",\n                      \"2376\",\n                      \"2375\",\n                      \"51678\"\n                  ],\n                  \"type\": \"STRINGSET\",\n                  \"integerValue\": 0\n              },\n              {\n                  \"name\": \"PORTS_UDP\",\n                  \"longValue\": 0,\n                  \"doubleValue\": 0.0,\n                  \"stringSetValue\": [],\n                  \"type\": \"STRINGSET\",\n                  \"integerValue\": 0\n              }\n          ],\n          \"runningTasksCount\": 0,\n          \"versionInfo\": {\n              \"agentVersion\": \"1.2.1\",\n              \"agentHash\": \"5da1555\",\n              \"dockerVersion\": \"DockerVersion: 1.6.2\"\n          }\n        }\n      }\n\n\n\n1.5. ECS\u30b3\u30f3\u30c6\u30ca\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u72b6\u614b\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\nARRAY_ECS_INSTANCE_STATUS=$( \\\n        aws ecs describe-container-instances \\\n          --cluster ${ECS_CLUSTER_NAME} \\\n          --container-instances \"${ECS_INSTANCES}\" \\\n          --query 'containerInstances[].status' \\\n          --output text \\\n      ) \\\n        && echo ${ARRAY_ECS_INSTANCE_STATUS}\n\n\n\n\u7d50\u679c\n      INACTIVE\n\n\n\n1.6. ECS\u30af\u30e9\u30b9\u30bf\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ecs describe-clusters \\\n        --clusters ${ECS_CLUSTER_NAME}\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n        \"clusters\": [\n          {\n              \"status\": \"ACTIVE\",\n              \"clusterName\": \"handson-cluster\",\n              \"registeredContainerInstancesCount\": 0,\n              \"pendingTasksCount\": 0,\n              \"runningTasksCount\": 0,\n              \"activeServicesCount\": 0,\n              \"clusterArn\": \"arn:aws:ecs:ap-northeast-1:XXXXXXXXXXXX:cluster/handson-cluster\"\n          }\n        ],\n        \"failures\": []\n      }\n\n\n\n2. EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u524a\u9664\n\n2.1. EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u524a\u9664\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nEC2_INSTANCE_ID=$(echo ${ARRAY_EC2_INSTANCE_ID} | sed 's/ .*$//') \\\n        && echo ${EC2_INSTANCE_ID}\n\n\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n        EC2_INSTANCE_ID: ${EC2_INSTANCE_ID}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 terminate-instances --instance-ids ${EC2_INSTANCE_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n        \"TerminatingInstances\": [\n          {\n              \"InstanceId\": \"i-xxxxxxxx\",\n              \"CurrentState\": {\n                  \"Code\": 32,\n                  \"Name\": \"shutting-down\"\n              },\n              \"PreviousState\": {\n                  \"Code\": 16,\n                  \"Name\": \"running\"\n              }\n          }\n        ]\n      }\n\n\n\n2.2. EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u72b6\u614b\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\nEC2_INSTANCE_STATE=` \\\n        aws ec2 describe-instances \\\n        --instance-ids ${EC2_INSTANCE_ID} \\\n        --query 'Reservations[].Instances[].State.Name' \\\n        --output text \\\n      ` \\\n        && echo ${EC2_INSTANCE_STATE}\n\n\n\n\u7d50\u679c\n      terminated\n\n\n\u540c\u4e00\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u8d77\u52d5\u3057\u3066\u3044\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\nARRAY_EC2_INSTANCE_ID=` \\\n        aws ec2 describe-instances \\\n          --filters Name=instance-state-name,Values=running \\\n          --query 'Reservations[].Instances[].InstanceId' \\\n          --output text \\\n      ` \\\n        && echo ${ARRAY_EC2_INSTANCE_ID}\n\n\n\n\u7d50\u679c\n      (\u623b\u308a\u5024\u306a\u3057)\n\n\n\n3. ECS\u30af\u30e9\u30b9\u30bf\u306e\u524a\u9664\n\n3.1. ECS\u30af\u30e9\u30b9\u30bf\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ecs describe-clusters \\\n        --clusters ${ECS_CLUSTER_NAME}\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n        \"clusters\": [\n          {\n              \"status\": \"ACTIVE\",\n              \"clusterName\": \"handson-cluster\",\n              \"registeredContainerInstancesCount\": 0,\n              \"pendingTasksCount\": 0,\n              \"runningTasksCount\": 0,\n              \"activeServicesCount\": 0,\n              \"clusterArn\": \"arn:aws:ecs:ap-northeast-1:XXXXXXXXXXXX:cluster/handson-cluster\"\n          }\n        ],\n        \"failures\": []\n      }\n\n\n\n3.2. ECS\u30af\u30e9\u30b9\u30bf\u306e\u524a\u9664\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n        ECS_CLUSTER_NAME: ${ECS_CLUSTER_NAME}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws ecs delete-cluster \\\n        --cluster ${ECS_CLUSTER_NAME}\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n        \"cluster\": {\n          \"status\": \"INACTIVE\",\n          \"clusterName\": \"handson-cluster\",\n          \"registeredContainerInstancesCount\": 0,\n          \"pendingTasksCount\": 0,\n          \"runningTasksCount\": 0,\n          \"activeServicesCount\": 0,\n          \"clusterArn\": \"arn:aws:ecs:ap-northeast-1:XXXXXXXXXXXX:cluster/handson-cluster\"\n        }\n      }\n\n\n\n3.3. ECS\u30af\u30e9\u30b9\u30bf\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ecs describe-clusters \\\n        --clusters ${ECS_CLUSTER_NAME}\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n        \"clusters\": [],\n        \"failures\": [\n          {\n              \"reason\": \"MISSING\",\n              \"arn\": \"arn:aws:ecs:ap-northeast-1:XXXXXXXXXXXX:cluster/handson-cluster\"\n          }\n        ]\n      }\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws ecs list-clusters \n\n\n\n\u7d50\u679c\n      {\n          \"clusterArns\": []\n      }\n\n\n\n\u5b8c\u4e86\n\u524d\u63d0\u6761\u4ef6\n========\n\n\nECS\u3078\u306e\u6a29\u9650\n-----------\n\n* ECS\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\n\nEC2\u3078\u306e\u6a29\u9650\n-----------\n\n* EC2\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\n\nAWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n-------------------\n\n* \u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\n  * AWS CLI 1.7.36\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws --version\n```\n\n```text:\u7d50\u679c(\u4f8b):\n      aws-cli/1.7.28 Python/2.7.5 Darwin/13.4.0\n```\n\n\n0. \u6e96\u5099\n=======\n\n\n0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u6c7a\u5b9a\n---------------------\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nexport AWS_DEFAULT_REGION='ap-northeast-1'\n```\n\n\n0.2. \u5909\u6570\u306e\u78ba\u8a8d\n---------------\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\naws configure list\n```\n\n```text:\u7d50\u679c(\u4f8b):\n            Name                    Value             Type    Location\n            ----                    -----             ----    --------\n         profile   ec2ecs_full-prjZ-mbp13              env    AWS_DEFAULT_PROFILE\n      access_key     ****************LOAQ shared-credentials-file\n      secret_key     ****************I1O1 shared-credentials-file\n          region           ap-northeast-1              env    AWS_DEFAULT_REGION\n```\n\n\n0.3. ECS\u30af\u30e9\u30b9\u30bf\u540d\u306e\u6307\u5b9a\n------------------------\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nECS_CLUSTER_NAME='handson-cluster'\n```\n\n\n1. ECS\u30b3\u30f3\u30c6\u30ca\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u767b\u9332\u524a\u9664\n====================================\n\n\n1.1. ECS\u30af\u30e9\u30b9\u30bf\u306e\u78ba\u8a8d\n----------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws ecs describe-clusters \\\n        --clusters ${ECS_CLUSTER_NAME}\n```\n\n```json:\u7d50\u679c(\u4f8b)\n       {\n         \"clusters\": [\n           {\n             \"status\": \"ACTIVE\",\n             \"clusterName\": \"handson-cluster\",\n             \"registeredContainerInstancesCount\": 1,\n             \"pendingTasksCount\": 0,\n             \"runningTasksCount\": 0,\n             \"activeServicesCount\": 0,\n             \"clusterArn\": \"arn:aws:ecs:ap-northeast-1:XXXXXXXXXXXX:cluster/handson-cluster\"\n           }\n         ],\n         \"failures\": []\n      }\n```\n\n\n1.2. ECS\u30b3\u30f3\u30c6\u30ca\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u72b6\u614b\u78ba\u8a8d\n--------------------------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nECS_INSTANCES=$( \\\n        aws ecs list-container-instances \\\n          --cluster ${ECS_CLUSTER_NAME} \\\n          --query 'containerInstanceArns[]' \\\n          --output text | \\\n        sed 's|^arn:aws:ecs:.*:container-instance/||' \\\n      ) \\\n        && echo ${ECS_INSTANCES}\n```\n\n```text:\u7d50\u679c(\u4f8b):\n      xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nARRAY_ECS_INSTANCE_STATUS=$( \\\n        aws ecs describe-container-instances \\\n          --cluster ${ECS_CLUSTER_NAME} \\\n          --container-instances \"${ECS_INSTANCES}\" \\\n          --query 'containerInstances[].status' \\\n          --output text \\\n      ) \\\n        && echo ${ARRAY_ECS_INSTANCE_STATUS}\n```\n\n```text:\u7d50\u679c:\n      ACTIVE\n```\n\n\n1.3. EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\u306e\u53d6\u5f97\n----------------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nARRAY_EC2_INSTANCE_ID=$( \\\n        aws ecs describe-container-instances \\\n          --cluster ${ECS_CLUSTER_NAME} \\\n          --container-instances \"${ECS_INSTANCES}\" \\\n          --query 'containerInstances[].ec2InstanceId' \\\n          --output text \\\n      ) \\\n        && echo ${ARRAY_EC2_INSTANCE_ID}\n```\n\n```text:\u7d50\u679c(\u4f8b):\n      i-xxxxxxxx\n```\n\n\n1.4. ECS\u30b3\u30f3\u30c6\u30ca\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u767b\u9332\u524a\u9664\n--------------------------------------\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n        ECS_CLUSTER_NAME: ${ECS_CLUSTER_NAME}\n        ECS_INSTANCES:    ${ECS_INSTANCES}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws ecs deregister-container-instance \\\n        --cluster ${ECS_CLUSTER_NAME} \\\n        --container-instance ${ECS_INSTANCES}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n      {\n        \"containerInstance\": {\n          \"status\": \"INACTIVE\",\n          \"registeredResources\": [\n              {\n                  \"integerValue\": 1024,\n                  \"longValue\": 0,\n                  \"type\": \"INTEGER\",\n                  \"name\": \"CPU\",\n                  \"doubleValue\": 0.0\n              },\n              {\n                  \"integerValue\": 996,\n                  \"longValue\": 0,\n                  \"type\": \"INTEGER\",\n                  \"name\": \"MEMORY\",\n                  \"doubleValue\": 0.0\n              },\n              {\n                  \"name\": \"PORTS\",\n                  \"longValue\": 0,\n                  \"doubleValue\": 0.0,\n                  \"stringSetValue\": [\n                      \"22\",\n                      \"2376\",\n                      \"2375\",\n                      \"51678\"\n                  ],\n                  \"type\": \"STRINGSET\",\n                  \"integerValue\": 0\n              },\n              {\n                  \"name\": \"PORTS_UDP\",\n                  \"longValue\": 0,\n                  \"doubleValue\": 0.0,\n                  \"stringSetValue\": [],\n                  \"type\": \"STRINGSET\",\n                  \"integerValue\": 0\n              }\n          ],\n          \"ec2InstanceId\": \"i-xxxxxxxx\",\n          \"agentConnected\": true,\n          \"containerInstanceArn\": \"arn:aws:ecs:ap-northeast-1:XXXXXXXXXXXX:container-instance/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\",\n          \"pendingTasksCount\": 0,\n          \"remainingResources\": [\n              {\n                  \"integerValue\": 1024,\n                  \"longValue\": 0,\n                  \"type\": \"INTEGER\",\n                  \"name\": \"CPU\",\n                  \"doubleValue\": 0.0\n              },\n              {\n                  \"integerValue\": 996,\n                  \"longValue\": 0,\n                  \"type\": \"INTEGER\",\n                  \"name\": \"MEMORY\",\n                  \"doubleValue\": 0.0\n              },\n              {\n                  \"name\": \"PORTS\",\n                  \"longValue\": 0,\n                  \"doubleValue\": 0.0,\n                  \"stringSetValue\": [\n                      \"22\",\n                      \"2376\",\n                      \"2375\",\n                      \"51678\"\n                  ],\n                  \"type\": \"STRINGSET\",\n                  \"integerValue\": 0\n              },\n              {\n                  \"name\": \"PORTS_UDP\",\n                  \"longValue\": 0,\n                  \"doubleValue\": 0.0,\n                  \"stringSetValue\": [],\n                  \"type\": \"STRINGSET\",\n                  \"integerValue\": 0\n              }\n          ],\n          \"runningTasksCount\": 0,\n          \"versionInfo\": {\n              \"agentVersion\": \"1.2.1\",\n              \"agentHash\": \"5da1555\",\n              \"dockerVersion\": \"DockerVersion: 1.6.2\"\n          }\n        }\n      }\n```\n\n\n1.5. ECS\u30b3\u30f3\u30c6\u30ca\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u72b6\u614b\u78ba\u8a8d\n--------------------------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nARRAY_ECS_INSTANCE_STATUS=$( \\\n        aws ecs describe-container-instances \\\n          --cluster ${ECS_CLUSTER_NAME} \\\n          --container-instances \"${ECS_INSTANCES}\" \\\n          --query 'containerInstances[].status' \\\n          --output text \\\n      ) \\\n        && echo ${ARRAY_ECS_INSTANCE_STATUS}\n```\n\n```text:\u7d50\u679c:\n      INACTIVE\n```\n\n\n1.6. ECS\u30af\u30e9\u30b9\u30bf\u306e\u78ba\u8a8d\n----------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws ecs describe-clusters \\\n        --clusters ${ECS_CLUSTER_NAME}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n      {\n        \"clusters\": [\n          {\n              \"status\": \"ACTIVE\",\n              \"clusterName\": \"handson-cluster\",\n              \"registeredContainerInstancesCount\": 0,\n              \"pendingTasksCount\": 0,\n              \"runningTasksCount\": 0,\n              \"activeServicesCount\": 0,\n              \"clusterArn\": \"arn:aws:ecs:ap-northeast-1:XXXXXXXXXXXX:cluster/handson-cluster\"\n          }\n        ],\n        \"failures\": []\n      }\n```\n\n\n2. EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u524a\u9664\n======================\n\n\n2.1. EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u524a\u9664\n------------------------\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nEC2_INSTANCE_ID=$(echo ${ARRAY_EC2_INSTANCE_ID} | sed 's/ .*$//') \\\n        && echo ${EC2_INSTANCE_ID}\n```\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n        EC2_INSTANCE_ID: ${EC2_INSTANCE_ID}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws ec2 terminate-instances --instance-ids ${EC2_INSTANCE_ID}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n      {\n        \"TerminatingInstances\": [\n          {\n              \"InstanceId\": \"i-xxxxxxxx\",\n              \"CurrentState\": {\n                  \"Code\": 32,\n                  \"Name\": \"shutting-down\"\n              },\n              \"PreviousState\": {\n                  \"Code\": 16,\n                  \"Name\": \"running\"\n              }\n          }\n        ]\n      }\n```\n\n\n2.2. EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u72b6\u614b\u78ba\u8a8d\n------------------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nEC2_INSTANCE_STATE=` \\\n        aws ec2 describe-instances \\\n        --instance-ids ${EC2_INSTANCE_ID} \\\n        --query 'Reservations[].Instances[].State.Name' \\\n        --output text \\\n      ` \\\n        && echo ${EC2_INSTANCE_STATE}\n```\n\n```text:\u7d50\u679c:\n      terminated\n```\n\n\u540c\u4e00\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u8d77\u52d5\u3057\u3066\u3044\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nARRAY_EC2_INSTANCE_ID=` \\\n        aws ec2 describe-instances \\\n          --filters Name=instance-state-name,Values=running \\\n          --query 'Reservations[].Instances[].InstanceId' \\\n          --output text \\\n      ` \\\n        && echo ${ARRAY_EC2_INSTANCE_ID}\n```\n\n```text:\u7d50\u679c:\n      (\u623b\u308a\u5024\u306a\u3057)\n```\n\n\n3. ECS\u30af\u30e9\u30b9\u30bf\u306e\u524a\u9664\n====================\n\n\n3.1. ECS\u30af\u30e9\u30b9\u30bf\u306e\u78ba\u8a8d\n----------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws ecs describe-clusters \\\n        --clusters ${ECS_CLUSTER_NAME}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n      {\n        \"clusters\": [\n          {\n              \"status\": \"ACTIVE\",\n              \"clusterName\": \"handson-cluster\",\n              \"registeredContainerInstancesCount\": 0,\n              \"pendingTasksCount\": 0,\n              \"runningTasksCount\": 0,\n              \"activeServicesCount\": 0,\n              \"clusterArn\": \"arn:aws:ecs:ap-northeast-1:XXXXXXXXXXXX:cluster/handson-cluster\"\n          }\n        ],\n        \"failures\": []\n      }\n```\n\n\n3.2. ECS\u30af\u30e9\u30b9\u30bf\u306e\u524a\u9664\n----------------------\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n        ECS_CLUSTER_NAME: ${ECS_CLUSTER_NAME}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws ecs delete-cluster \\\n        --cluster ${ECS_CLUSTER_NAME}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n      {\n        \"cluster\": {\n          \"status\": \"INACTIVE\",\n          \"clusterName\": \"handson-cluster\",\n          \"registeredContainerInstancesCount\": 0,\n          \"pendingTasksCount\": 0,\n          \"runningTasksCount\": 0,\n          \"activeServicesCount\": 0,\n          \"clusterArn\": \"arn:aws:ecs:ap-northeast-1:XXXXXXXXXXXX:cluster/handson-cluster\"\n        }\n      }\n```\n\n\n3.3. ECS\u30af\u30e9\u30b9\u30bf\u306e\u78ba\u8a8d\n----------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws ecs describe-clusters \\\n        --clusters ${ECS_CLUSTER_NAME}\n```\n\n```json:\u7d50\u679c(\u4f8b)\n      {\n        \"clusters\": [],\n        \"failures\": [\n          {\n              \"reason\": \"MISSING\",\n              \"arn\": \"arn:aws:ecs:ap-northeast-1:XXXXXXXXXXXX:cluster/handson-cluster\"\n          }\n        ]\n      }\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws ecs list-clusters \n```\n\n```json:\u7d50\u679c:\n      {\n          \"clusterArns\": []\n      }\n```\n\n\n\u5b8c\u4e86\n====\n", "tags": ["AWS", "aws-cli", "ECS"]}