{"tags": ["cppBuilder", "TThread"], "context": "\n\u52d5\u4f5c\u78ba\u8a8d\nC++ Builder XE4\n\n\n\u30e1\u30a4\u30f3\u30b9\u30ec\u30c3\u30c9\u304c\u30a8\u30e9\u30fc\u3067\u7d42\u4e86\u3057\u305f\u6642\u306b\u30bd\u30d5\u30c8\u3092\u7d42\u4e86\u3055\u305b\u308b\u5b9f\u88c5\u3092\u8003\u3048\u305f\u3002\n\nMain.cpp\n\nMain.cpp\n//---------------------------------------------------------------------------\n\n#include <vcl.h>\n#pragma hdrstop\n\n#include \"Main.h\"\n//---------------------------------------------------------------------------\n#pragma package(smart_init)\n#pragma resource \"*.dfm\"\nTForm1 *Form1;\n//---------------------------------------------------------------------------\n__fastcall TForm1::TForm1(TComponent* Owner)\n    : TForm(Owner)\n{\n    m_terminate = false;\n}\n//---------------------------------------------------------------------------\nvoid __fastcall TForm1::Timer1Timer(TObject *Sender)\n{\n    String msg = DateTimeToStr(Now());\n    OutputDebugString(msg.c_str());\n\n    if (m_terminate) {\n        Close();\n    }\n}\n//---------------------------------------------------------------------------\nvoid __fastcall TForm1::FormShow(TObject *Sender)\n{\n    m_thr_main = new TThreadMain(/* CreateSuspend=*/false);\n}\n//---------------------------------------------------------------------------\n\n__fastcall TForm1::~TForm1()\n{\n    if (m_thr_main != NULL) {\n        m_thr_main->Terminate();\n        for(int idx=0; idx<5; idx++) {\n            Sleep(200);\n            Application->ProcessMessages();\n        }\n    }\n}\n\nvoid __fastcall TForm1::SetTerminate()\n{\n    m_terminate = true;\n}\n\n\n\nMain.h\n\nMain.h\n//---------------------------------------------------------------------------\n\n#ifndef MainH\n#define MainH\n//---------------------------------------------------------------------------\n#include <System.Classes.hpp>\n#include <Vcl.Controls.hpp>\n#include <Vcl.StdCtrls.hpp>\n#include <Vcl.Forms.hpp>\n#include <Vcl.ExtCtrls.hpp>\n#include \"ThreadMain.h\"\n//---------------------------------------------------------------------------\nclass TForm1 : public TForm\n{\n__published:    // IDE \u3067\u7ba1\u7406\u3055\u308c\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\n    TTimer *Timer1;\n    void __fastcall Timer1Timer(TObject *Sender);\n    void __fastcall FormShow(TObject *Sender);\nprivate:    // \u30e6\u30fc\u30b6\u30fc\u5ba3\u8a00\n    bool m_terminate;\n    TThreadMain *m_thr_main;\npublic:     // \u30e6\u30fc\u30b6\u30fc\u5ba3\u8a00\n    void __fastcall SetTerminate();\n\n    __fastcall TForm1(TComponent* Owner);\n    __fastcall ~TForm1();\n};\n//---------------------------------------------------------------------------\nextern PACKAGE TForm1 *Form1;\n//---------------------------------------------------------------------------\n#endif\n\n\n\nThreadMain.cpp\n\nThreadMain.cpp\n//---------------------------------------------------------------------------\n\n#include <vcl.h>\n#pragma hdrstop\n\n#include \"ThreadMain.h\"\n#include \"Main.h\"\n\n#pragma package(smart_init)\n//---------------------------------------------------------------------------\n\n//   \u91cd\u8981: VCL \u306b\u304a\u3051\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30e1\u30bd\u30c3\u30c9\u3068\u30d7\u30ed\u30d1\u30c6\u30a3\u306f\u3001Synchronize \u3092\u4f7f\u3063\u3066\n//   \u547c\u3073\u51fa\u3055\u308c\u308b\u30e1\u30bd\u30c3\u30c9\u3067\u306e\u307f\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002\u305f\u3068\u3048\u3070\u3001\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n//\n//      Synchronize(&UpdateCaption);\n//\n//   \u3053\u3053\u3067\u3001UpdateCaption \u306f \u6b21\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u306b\u306a\u308a\u307e\u3059\u3002\n//\n//      void __fastcall TThreadMain::UpdateCaption()\n//      {\n//        Form1->Caption = \"\u30b9\u30ec\u30c3\u30c9\u3067\u66f4\u65b0\u3055\u308c\u307e\u3057\u305f\";\n//      }\n//---------------------------------------------------------------------------\n\n__fastcall TThreadMain::TThreadMain(bool CreateSuspended)\n    : TThread(CreateSuspended)\n{\n    FreeOnTerminate = true;\n\n}\n//---------------------------------------------------------------------------\nvoid __fastcall TThreadMain::Execute()\n{\n    for(int idx = 0; idx < 5; idx++) {\n        Sleep(1000);\n    }\n\n    Form1->SetTerminate();\n\n    String msg = L\"finish Execute()\";\n    OutputDebugString(msg.c_str());\n}\n//---------------------------------------------------------------------------\n\n\n\nThreadMain.h\n\nThreadMain.h\n//---------------------------------------------------------------------------\n\n#ifndef ThreadMainH\n#define ThreadMainH\n//---------------------------------------------------------------------------\n#include <System.Classes.hpp>\n//---------------------------------------------------------------------------\nclass TThreadMain : public TThread\n{\nprivate:\nprotected:\n    void __fastcall Execute();\npublic:\n    __fastcall TThreadMain(bool CreateSuspended);\n};\n//---------------------------------------------------------------------------\n#endif\n\n\n\u30b9\u30ec\u30c3\u30c9\u304cExecute()\u3092\u629c\u3051\u308b\u6642\u306bForm1\u306eSetTerminate()\u3092\u30b3\u30fc\u30eb\u3059\u308b\u3088\u3046\u306b\u3057\u305f\u3002\n\u30b9\u30ec\u30c3\u30c9\u304cForm1\u306b\u4f9d\u5b58\u3057\u3066\u3057\u307e\u3046\u3002\nclosure\u3092\u4f7f\u3046\u306e\u3082\u624b\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\u30b9\u30ec\u30c3\u30c9\u304c\u843d\u3061\u305f\u6642\u306b\u30bd\u30d5\u30c8\u3092\u7d42\u4e86\u3067\u306a\u304f\u3001\u30b9\u30ec\u30c3\u30c9\u3092\u518d\u8d77\u52d5\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u305d\u3046\u3002\n```txt:\u52d5\u4f5c\u78ba\u8a8d\nC++ Builder XE4\n```\n\n\u30e1\u30a4\u30f3\u30b9\u30ec\u30c3\u30c9\u304c\u30a8\u30e9\u30fc\u3067\u7d42\u4e86\u3057\u305f\u6642\u306b\u30bd\u30d5\u30c8\u3092\u7d42\u4e86\u3055\u305b\u308b\u5b9f\u88c5\u3092\u8003\u3048\u305f\u3002\n\n## Main.cpp\n\n```Main.cpp\n//---------------------------------------------------------------------------\n\n#include <vcl.h>\n#pragma hdrstop\n\n#include \"Main.h\"\n//---------------------------------------------------------------------------\n#pragma package(smart_init)\n#pragma resource \"*.dfm\"\nTForm1 *Form1;\n//---------------------------------------------------------------------------\n__fastcall TForm1::TForm1(TComponent* Owner)\n\t: TForm(Owner)\n{\n\tm_terminate = false;\n}\n//---------------------------------------------------------------------------\nvoid __fastcall TForm1::Timer1Timer(TObject *Sender)\n{\n\tString msg = DateTimeToStr(Now());\n\tOutputDebugString(msg.c_str());\n\n\tif (m_terminate) {\n        Close();\n\t}\n}\n//---------------------------------------------------------------------------\nvoid __fastcall TForm1::FormShow(TObject *Sender)\n{\n\tm_thr_main = new TThreadMain(/* CreateSuspend=*/false);\n}\n//---------------------------------------------------------------------------\n\n__fastcall TForm1::~TForm1()\n{\n\tif (m_thr_main != NULL) {\n\t\tm_thr_main->Terminate();\n\t\tfor(int idx=0; idx<5; idx++) {\n\t\t\tSleep(200);\n\t\t\tApplication->ProcessMessages();\n\t\t}\n\t}\n}\n\nvoid __fastcall TForm1::SetTerminate()\n{\n    m_terminate = true;\n}\n```\n\n## Main.h\n\n```Main.h\n//---------------------------------------------------------------------------\n\n#ifndef MainH\n#define MainH\n//---------------------------------------------------------------------------\n#include <System.Classes.hpp>\n#include <Vcl.Controls.hpp>\n#include <Vcl.StdCtrls.hpp>\n#include <Vcl.Forms.hpp>\n#include <Vcl.ExtCtrls.hpp>\n#include \"ThreadMain.h\"\n//---------------------------------------------------------------------------\nclass TForm1 : public TForm\n{\n__published:\t// IDE \u3067\u7ba1\u7406\u3055\u308c\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\n\tTTimer *Timer1;\n\tvoid __fastcall Timer1Timer(TObject *Sender);\n\tvoid __fastcall FormShow(TObject *Sender);\nprivate:\t// \u30e6\u30fc\u30b6\u30fc\u5ba3\u8a00\n\tbool m_terminate;\n\tTThreadMain *m_thr_main;\npublic:\t\t// \u30e6\u30fc\u30b6\u30fc\u5ba3\u8a00\n\tvoid __fastcall SetTerminate();\n\n\t__fastcall TForm1(TComponent* Owner);\n\t__fastcall ~TForm1();\n};\n//---------------------------------------------------------------------------\nextern PACKAGE TForm1 *Form1;\n//---------------------------------------------------------------------------\n#endif\n```\n\n## ThreadMain.cpp\n\n```ThreadMain.cpp\n//---------------------------------------------------------------------------\n\n#include <vcl.h>\n#pragma hdrstop\n\n#include \"ThreadMain.h\"\n#include \"Main.h\"\n\n#pragma package(smart_init)\n//---------------------------------------------------------------------------\n\n//   \u91cd\u8981: VCL \u306b\u304a\u3051\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30e1\u30bd\u30c3\u30c9\u3068\u30d7\u30ed\u30d1\u30c6\u30a3\u306f\u3001Synchronize \u3092\u4f7f\u3063\u3066\n//   \u547c\u3073\u51fa\u3055\u308c\u308b\u30e1\u30bd\u30c3\u30c9\u3067\u306e\u307f\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002\u305f\u3068\u3048\u3070\u3001\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n//\n//      Synchronize(&UpdateCaption);\n//\n//   \u3053\u3053\u3067\u3001UpdateCaption \u306f \u6b21\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u306b\u306a\u308a\u307e\u3059\u3002\n//\n//      void __fastcall TThreadMain::UpdateCaption()\n//      {\n//        Form1->Caption = \"\u30b9\u30ec\u30c3\u30c9\u3067\u66f4\u65b0\u3055\u308c\u307e\u3057\u305f\";\n//      }\n//---------------------------------------------------------------------------\n\n__fastcall TThreadMain::TThreadMain(bool CreateSuspended)\n\t: TThread(CreateSuspended)\n{\n\tFreeOnTerminate = true;\n\n}\n//---------------------------------------------------------------------------\nvoid __fastcall TThreadMain::Execute()\n{\n\tfor(int idx = 0; idx < 5; idx++) {\n\t\tSleep(1000);\n\t}\n\n\tForm1->SetTerminate();\n\n\tString msg = L\"finish Execute()\";\n\tOutputDebugString(msg.c_str());\n}\n//---------------------------------------------------------------------------\n```\n\n## ThreadMain.h\n\n```ThreadMain.h\n//---------------------------------------------------------------------------\n\n#ifndef ThreadMainH\n#define ThreadMainH\n//---------------------------------------------------------------------------\n#include <System.Classes.hpp>\n//---------------------------------------------------------------------------\nclass TThreadMain : public TThread\n{\nprivate:\nprotected:\n\tvoid __fastcall Execute();\npublic:\n\t__fastcall TThreadMain(bool CreateSuspended);\n};\n//---------------------------------------------------------------------------\n#endif\n```\n\n\u30b9\u30ec\u30c3\u30c9\u304cExecute()\u3092\u629c\u3051\u308b\u6642\u306bForm1\u306eSetTerminate()\u3092\u30b3\u30fc\u30eb\u3059\u308b\u3088\u3046\u306b\u3057\u305f\u3002\n\n\u30b9\u30ec\u30c3\u30c9\u304cForm1\u306b\u4f9d\u5b58\u3057\u3066\u3057\u307e\u3046\u3002\nclosure\u3092\u4f7f\u3046\u306e\u3082\u624b\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\n\u30b9\u30ec\u30c3\u30c9\u304c\u843d\u3061\u305f\u6642\u306b\u30bd\u30d5\u30c8\u3092\u7d42\u4e86\u3067\u306a\u304f\u3001\u30b9\u30ec\u30c3\u30c9\u3092\u518d\u8d77\u52d5\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u305d\u3046\u3002\n"}