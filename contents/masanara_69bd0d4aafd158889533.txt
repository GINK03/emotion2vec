{"context": " More than 1 year has passed since last update.\n\nTL;DR\nPhoton Controller\u306e\u30ea\u30ea\u30fc\u30b9\u3068\u540c\u6642\u306b\u516c\u958b\u3055\u308c\u305fDevBox\u3092\u5229\u7528\u3057\u3066\u3001Nested ESXi\u74b0\u5883\u306bSwarm\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u4f5c\u6210\u3057\u3066\u3001Windows\u30ef\u30fc\u30af\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u306edocker\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u5229\u7528\u3057\u3066\u307f\u305f\u3002\n\nPhoton Controller\u3068\u306f\n\u30af\u30e9\u30a6\u30c9\u30cd\u30a4\u30c6\u30a3\u30d6\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3084\u30b3\u30f3\u30c6\u30ca\u306e\u5b9f\u884c\u74b0\u5883\u3068\u3057\u3066\u6700\u9069\u5316\u3055\u308c\u305f\u3001VMware\u306ePhotoon Platform\u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u3002\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u3068\u3057\u3066\u516c\u958b\u3055\u308c\u3066\u3044\u308b\u3002\nVMware ESXi\u30cf\u30a4\u30d1\u30fc\u30d0\u30a4\u30b6\u30fc\u3092\u4e0a\u306bMesos/Kubernetes/Swarm\u306e\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u7c21\u5358\u306b\u69cb\u6210\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\nPhoton Controller\u306e\u8a73\u7d30\u306fVMware\u306eJapan Cloud Infrastructure Blog\u306b\u8a73\u3057\u304f\u66f8\u304b\u308c\u3066\u3044\u308b\u3002\n\nDevBox\u3068\u306f\nPhoton Platform\u306e\u6a5f\u80fd\u3092\u30e9\u30c3\u30d7\u30c8\u30c3\u30d7\u3084PC\u306a\u3069\u306e\u6700\u4f4e\u9650(16GB RAM + 50GB HDD)\u306e\u74b0\u5883\u3067\u8a66\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u3002DevBox\u306fOVA\u3068\u3057\u3066\u63d0\u4f9b\u3055\u308c\u3066\u304a\u308a\u3001Photon OS\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u3002\n\nDevBox\u74b0\u5883\u306e\u30c7\u30d7\u30ed\u30a4\u65b9\u6cd5\nGetting Started Guide\u3067\u306fVMware Fusion\u3082\u3057\u304f\u306fVMware Workstation\u306e\u5229\u7528\u65b9\u6cd5\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u304c\u300116GB RAM\u306850GB HDD\u3092\u30e9\u30c3\u30d7\u30c8\u30c3\u30d7\u3067\u7528\u610f\u3059\u308b\u306e\u306f\u96e3\u3057\u3044\u306e\u3067\u3001vSphere + NSX\u74b0\u5883\u3067\u4f5c\u3063\u3066\u307f\u305f\u3002DNS\u3084DHCP\u30b5\u30fc\u30d3\u30b9\u306fNSX\u304c\u3042\u308b\u3068Edge Service Gateway\u3067\u7c21\u5358\u306b\u7528\u610f\u3067\u304d\u308b\u3002\n\nDevBox\u306b\u5fc5\u8981\u306a\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\nDevBox\u306f\u4e88\u3081IP\u30a2\u30c9\u30ec\u30b9\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u304a\u308a\u3001Photon Controller\u3092\u69cb\u6210\u3059\u308b\u5404\u7a2e\u30b5\u30fc\u30d3\u30b9\u3082IP\u30a2\u30c9\u30ec\u30b9\u304c\u69cb\u6210\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u4ee5\u4e0b\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4e0a\u3067\u69cb\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\nNetwork : 192.168.209.0/24\nDefault Gateway : 192.168.209.2\nDNS : 192.168.209.2\nDHCP Pool : 192.168.209.129\u00ad - 192.168.209.254\n\n\nNSX\u3092\u4f7f\u3063\u3066\u69cb\u6210\u3059\u308b\u5834\u5408\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\u4f8b\n\n\nDevBox\u306e\u30c7\u30d7\u30ed\u30a4\nDevBox\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u3001vSphere\u74b0\u5883\u306b\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u3002IP\u30a2\u30c9\u30ec\u30b9\u306f\u4e8b\u524d\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u30c7\u30d7\u30ed\u30a4\u6642\u306b\u306fIP\u30a2\u30c9\u30ec\u30b9\u306a\u3069\u306eOVF\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u6307\u5b9a\u306f\u4e0d\u8981\u3002PhotonControllerDevbox-11-12-15.ova\u306f\u30014vCPU/3GB RAM/80GB HDD\u3002\n\nNested ESXi\u306e\u7528\u610f\nPhoton Controller\u306b\u3088\u3063\u3066\u7ba1\u7406\u3059\u308bESXi\u30db\u30b9\u30c8\u3092Nested ESXi\u3068\u3057\u3066\u7528\u610f\u3059\u308b\u3002\u30e1\u30e2\u30ea\u5272\u308a\u5f53\u3066\u306f8GB\u4ee5\u4e0a\u3002\u5927\u304d\u3044\u307b\u3046\u304c\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u305f\u304f\u3055\u3093\u4f5c\u308c\u308b\u306e\u3067\u300116GB\u7a0b\u5ea6\u5272\u308a\u5f53\u3066\u308b\u306e\u304c\u671b\u307e\u3057\u3044\u3002\nNested ESXi\u3092\u63a5\u7d9a\u3059\u308b\u30dd\u30fc\u30c8\u30b0\u30eb\u30fc\u30d7\u306fpromiscuous\u306b\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u6ce8\u610f\u3002\n\nPhoton Controller CLI\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nPhoton Controller CLI\u306fDevBox\u4e0a\u3067\u52d5\u4f5c\u3059\u308bPhoton Controller\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8CLI\u3002Windows\u7528\u3068Mac\u7248\u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308b\u3002(\u30d3\u30eb\u30c9\u6e08\u307f\u306eLinux\u5411\u3051\u30d0\u30a4\u30ca\u30ea\u306f\u516c\u958b\u3055\u308c\u3066\u3044\u306a\u3044\u6a21\u69d8)\n- Mac\u7528\n- Windows\u7528\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u5f8c\u3001PATH\u304c\u901a\u3063\u3066\u3044\u308b\u5834\u6240\u306b\u79fb\u52d5\u3059\u308b\u3053\u3068\u3002(C:\u00a5Windows\u00a5system32 \u7b49)\n\nPhoton Platform\u306e\u6e96\u5099\n\nPhoton Controller CLI\u306e\u63a5\u7d9a\u5148\u6307\u5b9a\nPhoton Controller CLI\u306e\u63a5\u7d9a\u5148\u3068\u3057\u3066DevBox\u306ePhoton Controller\u3092\u6307\u5b9a\u3059\u308b\nPS C:\\> photon target set https://192.168.209.29:443\nAPI target set to 'https://192.168.209.29:443'\nCertificate (with below fingerprint) presented by server (192.168.209.29:443) isn't trusted.\nMD5 = B9D1D2C1B764B5CB415D00457A7A7312\nSHA1  = 433A5D8736000E39EADFF4F700BF37D8DDE307F1\nDo you trust this certificate for future communication? (yes/no): yes\n\nSaved your preference for future communicaition with 192.168.209.29:443\n\n\nESXi\u30db\u30b9\u30c8\u306e\u767b\u9332\nPhoton Controller\u306bNested ESXi\u3092\u767b\u9332\u3059\u308b\u3002\nPS C:\\> photon host create --username root --password [esxpassword] --tag CLOUD --address 192.168.209.31\nHost Metadata ({'key':'value'}. required by host of 'MGMT' tag):\nUsing target 'https://192.168.209.29:443'\n\n\nHost with ip '192.168.209.31' created: ID = ef86128a-140f-4325-a474-4236fa07cc32\n\n\n\u767b\u9332\u3057\u305f\u30db\u30b9\u30c8\u306e\u78ba\u8a8d\nPS C:\\> photon host list\nUsing target 'https://192.168.209.29:443'\nID                                    State  IP              Tags\nef86128a-140f-4325-a474-4236fa07cc32  READY  192.168.209.31  CLOUD\n\nTotal: 1\n\nESXi\u30db\u30b9\u30c8\u306b\u306fPhoton Controller\u306eLeaf Scheduler\u304cVIB\u3068\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3001\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u306b\u5fc5\u8981\u306a\u30d5\u30a9\u30eb\u30c0\u304c\u4f5c\u6210\u3055\u308c\u308b\u3002\n[root@esxi:~] esxcli software vib list | grep Community\nphoton-controller-agent        0.1.0.dev-5.5.0                       VMware  CommunitySupported  2015-11-16\n\n\n\u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u306e\u767b\u9332\nVMDK\u3068\u3057\u3066\u914d\u5e03\u3055\u308c\u308bMesos/Kubernetes/Swarm\u306e\u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u3092\u767b\u9332\u3059\u308b\u3002\u767b\u9332\u3057\u305f\u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u306fESXi\u306e\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2(datastore1)\u306b\u4fdd\u5b58\u3055\u308c\u308b\u3002\nPS C:\\> photon image create C:\\photon-kubernetes-vm-disk1.vmdk -n photon-kubernetes-vm.vmdk -i EAGER\nUsing target 'https://192.168.209.29:443'\nCreated image 'photon-kubernetes-vm.vmdk' ID: 32daa1e4-0a71-4326-a24d-59fc6489eb14\n\nPS C:\\> photon image create C:\\photon-swarm-vm-disk1.vmdk -n photon-swarm-vm.vmdk -i EAGER\nUsing target 'https://192.168.209.29:443'\nCreated image 'photon-swarm-vm.vmdk' ID: 612d079e-e166-4fb5-870e-e74d9f9ea78e\n\nPS C:\\> photon image create C:\\photon-mesos-vm-disk1.vmdk -n photon-mesos-vm.vmdk -i EAGER\nUsing target 'https://192.168.209.29:443'\nCreated image 'photon-mesos-vm.vmdk' ID: 45217e98-ddbf-4999-b449-45b4e9ca1d65\n\nPS C:\\> photon image list\nUsing target 'https://192.168.209.29:443'\nID                                    Name                       State  Size(Byte)   Replication_type\n32daa1e4-0a71-4326-a24d-59fc6489eb14  photon-kubernetes-vm.vmdk  READY  85899345968  EAGER\n45217e98-ddbf-4999-b449-45b4e9ca1d65  photon-mesos-vm.vmdk       READY  85899345968  EAGER\n612d079e-e166-4fb5-870e-e74d9f9ea78e  photon-swarm-vm.vmdk       READY  85899345968  EAGER\n\nTotal: 3\n\n\nPhoton Platform\u306e\u5229\u7528\nSwarm\u3001Kubernetes\u3001Mesos\u306e\u30af\u30e9\u30b9\u30bf\u30fc\u4f5c\u6210\u304c\u53ef\u80fd\u3002\n\nSwarm\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u4f5c\u6210\nSwarm\u30af\u30e9\u30b9\u30bf\u30fc\u3092Slave2\u53f0\u3067\u4f5c\u6210\u3059\u308b\u3002Swarm\u30af\u30e9\u30b9\u30bf\u30fc\u306fmaster\u3068etcd\u3001\u8907\u6570\u53f0\u306eSlave\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u3067\u69cb\u6210\u3055\u308c\u308b\u3002\nPS C:\\> photon cluster create -n Swarm2 -k Swarm --dns 192.168.209.2 --gateway 192.168.209.2 --netmask 255.255.255.0 --etcd1 192.168.209.55 -s 2\nUsing target 'https://192.168.209.29:443'\netcd server 2 static IP address (leave blank for none):\n\nCreating cluster: Swarm2 (SWARM)\n  Slave count: 2\n\n\n\u4f5c\u6210\u3057\u305f\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u78ba\u8a8d\n\u4f5c\u6210\u3057\u305f\u30af\u30e9\u30b9\u30bf\u30fc\u304c\u8868\u793a\u3055\u308c\u308b\u3002\nPS C:\\> photon cluster list\nUsing target 'https://192.168.209.29:443'\nID                                    Name    Type   State  Slave Count\n0db6bb43-5537-4ece-98c2-d0ae17a0e54a  Swarm2  SWARM  READY  2\n\nTotal: 1\nREADY: 1\n\n\n\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u8a73\u7d30\u60c5\u5831\n\u300cmaster-xxxx\u300d(192.168.209.173)\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u304cSwarm\u306emaster\u3068\u306a\u3063\u3066\u3044\u308b\u3002\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u30ce\u30fc\u30c9(master/slave)\u306fDHCP\u3067IP\u30a2\u30c9\u30ec\u30b9\u3092\u53d6\u5f97\u3059\u308b\u3002\nPS C:\\> photon cluster show 0db6bb43-5537-4ece-98c2-d0ae17a0e54a\nUsing target 'https://192.168.209.29:443'\nCluster ID:     0db6bb43-5537-4ece-98c2-d0ae17a0e54a\n  Name:         Swarm2\n  State:        READY\n  Type:         SWARM\n  Slave count:  2\n\nVM ID                                 VM Name                                      VM IP\nd28726ff-ebd4-46a5-acf6-ba54e59a7508  master-505f1abd-3950-4e2a-abf2-a76d08324aac  192.168.209.173\n91025592-362b-4c63-9040-0ade0b3d7fbf  etcd-097b3dd1-4e8b-4a0c-bf84-95ad3ab8fb00    192.168.209.55\n\n\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u69cb\u6210\u3059\u308bVM\u306e\u78ba\u8a8d\nPS C:\\> photon cluster list_vms 0db6bb43-5537-4ece-98c2-d0ae17a0e54a\nUsing target 'https://192.168.209.29:443'\nID                                    Name                                         State\nd28726ff-ebd4-46a5-acf6-ba54e59a7508  master-505f1abd-3950-4e2a-abf2-a76d08324aac  STARTED\n51d6e7d1-3652-4c42-987d-38c58e3425cf  slave-3eaa99ae-ee0f-46ac-a0ed-bca2e5af7a85   STARTED\nbda835f9-e223-495e-a660-0a6252c6437b  slave-f9102f1a-7acf-4f07-9b57-b79eb0c0402e   STARTED\n91025592-362b-4c63-9040-0ade0b3d7fbf  etcd-097b3dd1-4e8b-4a0c-bf84-95ad3ab8fb00    STARTED\n\nTotal: 4\nSTARTED: 4\n\nmaster\u306bssh(\u30e6\u30fc\u30b6\u30fc\u540d:root/\u30d1\u30b9\u30ef\u30fc\u30c9:vmware)\u3057\u3066\u78ba\u8a8d\u3059\u308b\u3068\u3001\u4f5c\u6210\u3055\u308c\u305fSwarm\u30af\u30e9\u30b9\u30bf\u30fc\u306fSwarm 0.4.0\u3001Docker version 1.8.1\u3002\nroot@master-505f1abd-3950-4e2a-abf2-a76d08324aac [ ~ ]# export DOCKER_HOST=\"tcp://localhost:2375\"\nroot@master-505f1abd-3950-4e2a-abf2-a76d08324aac [ ~ ]# docker version\nClient:\n Version:      1.8.1\n API version:  1.20\n Go version:   go1.4.2\n Git commit:   d12ea79\n Built:        Thu Aug 13 02:49:29 UTC 2015\n OS/Arch:      linux/amd64\n\nServer:\n Version:      1.8.1\n API version:  1.20\n Go version:   go1.4.2\n Git commit:   d12ea79\n Built:        Thu Aug 13 02:49:29 UTC 2015\n OS/Arch:      linux/amd64\nroot@master-505f1abd-3950-4e2a-abf2-a76d08324aac [ ~ ]# docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES\n0effdfd20fdb        swarm:0.4.0         \"/swarm manage etcd:/\"   21 minutes ago      Up 21 minutes       0.0.0.0:8333->2375/tcp   clever_mestorf\n0af98e8449df        swarm:0.4.0         \"/swarm join --addr=1\"   21 minutes ago      Up 21 minutes       2375/tcp                 goofy_archimedes\n\n\nDocker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u30ef\u30fc\u30af\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u306bDocker\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\u6700\u65b0\u306eDocker 1.9.x\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3057\u307e\u3046\u3068API\u30df\u30b9\u30de\u30c3\u30c1\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u3057\u307e\u3046\u306e\u3067\u6ce8\u610f\u3002\nError response from daemon: client is newer than server (client API version: 1.21, server API version: 1.20)\n\nWindows\u306e\u5834\u5408\u306f\u3053\u3053\u304b\u3089Docker Toolbox\u306e1.8.x\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\nSwarm\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u5229\u7528\nDOCKER_HOST\u3068\u3057\u3066Swarm Master(\u30dd\u30fc\u30c8\u756a\u53f7\u306f8333)\u3092\u6307\u5b9a\u3057\u3066\u5229\u7528\u53ef\u80fd\u3002\nPS C:\\> $env:DOCKER_HOST=\"tcp://192.168.209.173:8333\"\n\n\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u72b6\u614b\u3092\u898b\u3066\u307f\u308b\u3002\u6307\u5b9a\u3057\u305f\u901a\u308aMaster\u3068Slave\u304c2\u53f0\u3067\u304d\u3066\u3044\u308b\u3002\nPS C:\\> docker info\nContainers: 4\nImages: 6\nRole: primary\nStrategy: spread\nFilters: affinity, health, constraint, port, dependency\nNodes: 3\n master-505f1abd-3950-4e2a-abf2-a76d08324aac: 192.168.209.173:2375\n  \u2514 Containers: 2\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 513.9 MiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=4.0.9, operatingsystem=VMware Photon/Linux, storagedriver=overlay\n\n slave-3eaa99ae-ee0f-46ac-a0ed-bca2e5af7a85: 192.168.209.174:2375\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 249.5 MiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=4.0.9, operatingsystem=VMware Photon/Linux, storagedriver=overlay\n\n slave-f9102f1a-7acf-4f07-9b57-b79eb0c0402e: 192.168.209.175:2375\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 249.5 MiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=4.0.9, operatingsystem=VMware Photon/Linux, storagedriver=overlay\n\nCPUs: 4\nTotal Memory: 1013 MiB\nName: 3e44d2b43116\n\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u78ba\u8a8d\n3\u53f0\u306eVM\u4e0a\u3067Swarm\u7528\u306e\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u3002\nPS C:\\> docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                            NAMES\n09bf640d2360        swarm:0.4.0         \"/swarm join --addr=1\"   About an hour ago   Up About an hour    2375/tcp                         slave-f9102f1a-7acf-4f07-9b57-b79eb0c0402e/high_einstein\nf7357b931ea7        swarm:0.4.0         \"/swarm join --addr=1\"   About an hour ago   Up About an hour    2375/tcp                         slave-3eaa99ae-ee0f-46ac-a0ed-bca2e5af7a85/lonely_mahavira\n3e44d2b43116        swarm:0.4.0         \"/swarm manage etcd:/\"   About an hour ago   Up About an hour    192.168.209.173:8333->2375/tcp   master-505f1abd-3950-4e2a-abf2-a76d08324aac/cocky_varahamihira\n0a1498b816a2        swarm:0.4.0         \"/swarm join --addr=1\"   About an hour ago   Up About an hour    2375/tcp                         master-505f1abd-3950-4e2a-abf2-a76d08324aac/hungry_mestorf\n\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\nSwarm\u7d4c\u7531\u3067nginx\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066\u307f\u308b\u3002\nPS C:\\> docker run -itd --name nginx -p 8000:80 nginx\nba8ba9590796a88bcd49b0ac6ddca6ea381fc60dd3a1b1b330b71619e61fae87\n\n\u8d77\u52d5\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u306e\u78ba\u8a8d\u3002nginx\u30b3\u30f3\u30c6\u30ca\u306fslave-3eaa99ae-ee0f-46ac-a0ed-bca2e5af7a85(192.168.207.174)\u306e8000\u756a\u3067\u8d77\u52d5\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u30d6\u30e9\u30a6\u30b6\u3067\u63a5\u7d9a\u53ef\u80fd\u3002\nPS C:\\> docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                   NAMES\nba8ba9590796        nginx               \"nginx -g 'daemon off\"   5 seconds ago       Up 2 seconds        443/tcp, 192.168.209.174:8000->80/tcp   slave-3eaa99ae-ee0f-46ac-a0ed-bca2e5af7a85/nginx\n09bf640d2360        swarm:0.4.0         \"/swarm join --addr=1\"   About an hour ago   Up About an hour    2375/tcp                                slave-f9102f1a-7acf-4f07-9b57-b79eb0c0402e/high_einstein\nf7357b931ea7        swarm:0.4.0         \"/swarm join --addr=1\"   About an hour ago   Up About an hour    2375/tcp                                slave-3eaa99ae-ee0f-46ac-a0ed-bca2e5af7a85/lonely_mahavira\n3e44d2b43116        swarm:0.4.0         \"/swarm manage etcd:/\"   About an hour ago   Up About an hour    192.168.209.173:8333->2375/tcp          master-505f1abd-3950-4e2a-abf2-a76d08324aac/cocky_varahamihira\n0a1498b816a2        swarm:0.4.0         \"/swarm join --addr=1\"   About an hour ago   Up About an hour    2375/tcp                                master-505f1abd-3950-4e2a-abf2-a76d08324aac/hungry_mestorf\n\n\n\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\n\u4e00\u5ea6\u4f5c\u3063\u305f\u30af\u30e9\u30b9\u30bf\u30fc\u306eSlave\u53f0\u6570\u306f\u5f8c\u304b\u3089\u5909\u66f4\u53ef\u80fd\u3002Slave\u53f0\u6570\u30923\u53f0\u306b\u5897\u3084\u3057\u3066\u307f\u308b\u3002\nPS C:\\> photon cluster resize 0db6bb43-5537-4ece-98c2-d0ae17a0e54a 3\nUsing target 'https://192.168.209.29:443'\n\nResizing cluster 0db6bb43-5537-4ece-98c2-d0ae17a0e54a to slave count 3\nAre you sure [y/n]? y\nCluster resized: ID = 0db6bb43-5537-4ece-98c2-d0ae17a0e54a\nNote: A background task is running to gradually resize the cluster to its target capacity.\nYou may continue to use the cluster. You can run 'cluster show '\nto see the state of the cluster. If the resize operation is still in progress, the cluster state\nwill show as RESIZING. Once the cluster is resized, the cluster state will show as READY.\n\n\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3002\u300cRESIZING\u300d\u3068\u306a\u3063\u3066\u3044\u308b\u3002\nPS C:\\> photon cluster show 0db6bb43-5537-4ece-98c2-d0ae17a0e54a\nUsing target 'https://192.168.209.29:443'\nCluster ID:     0db6bb43-5537-4ece-98c2-d0ae17a0e54a\n  Name:         Swarm2\n  State:        RESIZING\n  Type:         SWARM\n  Slave count:  3\n\nVM ID                                 VM Name                                      VM IP\nd28726ff-ebd4-46a5-acf6-ba54e59a7508  master-505f1abd-3950-4e2a-abf2-a76d08324aac  192.168.209.173\n91025592-362b-4c63-9040-0ade0b3d7fbf  etcd-097b3dd1-4e8b-4a0c-bf84-95ad3ab8fb00    192.168.209.55\n\n\u3057\u3070\u3089\u304f\u5f85\u3063\u3066\u3082\u3046\u4e00\u5ea6\u78ba\u8a8d\u3059\u308b\u3068\u3001\u300cREADY\u300d\u306b\u306a\u308b\u3002\nPS C:\\> photon cluster show 0db6bb43-5537-4ece-98c2-d0ae17a0e54a\nUsing target 'https://192.168.209.29:443'\nCluster ID:     0db6bb43-5537-4ece-98c2-d0ae17a0e54a\n  Name:         Swarm2\n  State:        READY\n  Type:         SWARM\n  Slave count:  3\n\nVM ID                                 VM Name                                      VM IP\nd28726ff-ebd4-46a5-acf6-ba54e59a7508  master-505f1abd-3950-4e2a-abf2-a76d08324aac  192.168.209.173\n91025592-362b-4c63-9040-0ade0b3d7fbf  etcd-097b3dd1-4e8b-4a0c-bf84-95ad3ab8fb00    192.168.209.55\n\ndocker info\u3067\u78ba\u8a8d\u3059\u308b\u3068\u3001slave\u304c3\u53f0\u306b\u5897\u3048\u3066\u3044\u308b\u3002\nPS C:\\> docker info\nContainers: 5\nImages: 12\nRole: primary\nStrategy: spread\nFilters: affinity, health, constraint, port, dependency\nNodes: 4\n master-505f1abd-3950-4e2a-abf2-a76d08324aac: 192.168.209.173:2375\n  \u2514 Containers: 2\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 513.9 MiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=4.0.9, operatingsystem=VMware Photon/Linux, storagedriver=overlay\n\n slave-3eaa99ae-ee0f-46ac-a0ed-bca2e5af7a85: 192.168.209.174:2375\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 249.5 MiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=4.0.9, operatingsystem=VMware Photon/Linux, storagedriver=overlay\n\n slave-f9102f1a-7acf-4f07-9b57-b79eb0c0402e: 192.168.209.175:2375\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 249.5 MiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=4.0.9, operatingsystem=VMware Photon/Linux, storagedriver=overlay\n\n slave-f93ca2e3-74a2-467a-b416-f5beb4b08463: 192.168.209.183:2375\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 249.5 MiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=4.0.9, operatingsystem=VMware Photon/Linux, storagedriver=overlay\n\nCPUs: 5\nTotal Memory: 1.233 GiB\nName: 3e44d2b43116\n\n\n\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u30b9\u30b1\u30fc\u30eb\u30a4\u30f3\n\u6b8b\u5ff5\u306a\u304c\u3089\u4eca\u306e\u3068\u3053\u308d\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u6a21\u69d8\u3002\nPS C:\\> photon cluster resize 0db6bb43-5537-4ece-98c2-d0ae17a0e54a 2\nUsing target 'https://192.168.209.29:443'\n\nResizing cluster 0db6bb43-5537-4ece-98c2-d0ae17a0e54a to slave count 2\nAre you sure [y/n]? y\n2015/11/20 12:42:28 esxcloud: Task '5f9046cd-3754-4323-aeb2-ea6f82953d02' is in error state. Examine task for full details.\nAPI Errors: [esxcloud: { HTTP status: '0', code: 'InternalError', message: 'Reducing cluster size is not supported. Current cluster size: 3. New cluster size: 2.', data: 'map[]' }]\n\n\n#TL;DR\nPhoton Controller\u306e\u30ea\u30ea\u30fc\u30b9\u3068\u540c\u6642\u306b\u516c\u958b\u3055\u308c\u305fDevBox\u3092\u5229\u7528\u3057\u3066\u3001Nested ESXi\u74b0\u5883\u306bSwarm\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u4f5c\u6210\u3057\u3066\u3001Windows\u30ef\u30fc\u30af\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u306edocker\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u5229\u7528\u3057\u3066\u307f\u305f\u3002\n\n#Photon Controller\u3068\u306f\n\u30af\u30e9\u30a6\u30c9\u30cd\u30a4\u30c6\u30a3\u30d6\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3084\u30b3\u30f3\u30c6\u30ca\u306e\u5b9f\u884c\u74b0\u5883\u3068\u3057\u3066\u6700\u9069\u5316\u3055\u308c\u305f\u3001VMware\u306ePhotoon Platform\u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u3002[\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u3068\u3057\u3066\u516c\u958b](https://github.com/vmware/photon-controller)\u3055\u308c\u3066\u3044\u308b\u3002\nVMware ESXi\u30cf\u30a4\u30d1\u30fc\u30d0\u30a4\u30b6\u30fc\u3092\u4e0a\u306bMesos/Kubernetes/Swarm\u306e\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u7c21\u5358\u306b\u69cb\u6210\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\nPhoton Controller\u306e\u8a73\u7d30\u306f[VMware\u306eJapan Cloud Infrastructure Blog](https://blogs.vmware.com/jp-cim/2015/11/photon-controller.html)\u306b\u8a73\u3057\u304f\u66f8\u304b\u308c\u3066\u3044\u308b\u3002\n\n#DevBox\u3068\u306f\nPhoton Platform\u306e\u6a5f\u80fd\u3092\u30e9\u30c3\u30d7\u30c8\u30c3\u30d7\u3084PC\u306a\u3069\u306e\u6700\u4f4e\u9650(16GB RAM + 50GB HDD)\u306e\u74b0\u5883\u3067\u8a66\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u3002DevBox\u306fOVA\u3068\u3057\u3066\u63d0\u4f9b\u3055\u308c\u3066\u304a\u308a\u3001[Photon OS](https://github.com/vmware/photon)\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u3002\n\n##DevBox\u74b0\u5883\u306e\u30c7\u30d7\u30ed\u30a4\u65b9\u6cd5\n[Getting Started Guide](http://blogs.vmware.com/cloudnative/files/2015/11/Photon-Controller-Getting-Started-Guide-20151116.pdf)\u3067\u306fVMware Fusion\u3082\u3057\u304f\u306fVMware Workstation\u306e\u5229\u7528\u65b9\u6cd5\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u304c\u300116GB RAM\u306850GB HDD\u3092\u30e9\u30c3\u30d7\u30c8\u30c3\u30d7\u3067\u7528\u610f\u3059\u308b\u306e\u306f\u96e3\u3057\u3044\u306e\u3067\u3001vSphere + NSX\u74b0\u5883\u3067\u4f5c\u3063\u3066\u307f\u305f\u3002DNS\u3084DHCP\u30b5\u30fc\u30d3\u30b9\u306fNSX\u304c\u3042\u308b\u3068Edge Service Gateway\u3067\u7c21\u5358\u306b\u7528\u610f\u3067\u304d\u308b\u3002\n\n##DevBox\u306b\u5fc5\u8981\u306a\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\nDevBox\u306f\u4e88\u3081IP\u30a2\u30c9\u30ec\u30b9\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u304a\u308a\u3001Photon Controller\u3092\u69cb\u6210\u3059\u308b\u5404\u7a2e\u30b5\u30fc\u30d3\u30b9\u3082IP\u30a2\u30c9\u30ec\u30b9\u304c\u69cb\u6210\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u4ee5\u4e0b\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4e0a\u3067\u69cb\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n- Network : 192.168.209.0/24\n- Default Gateway : 192.168.209.2\n- DNS : 192.168.209.2\n- DHCP Pool : 192.168.209.129\u00ad - 192.168.209.254\n\n###NSX\u3092\u4f7f\u3063\u3066\u69cb\u6210\u3059\u308b\u5834\u5408\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\u4f8b\n![network.png](https://qiita-image-store.s3.amazonaws.com/0/27668/8dc30198-2310-56f0-858c-202fcf56dd3a.png)\n\n##DevBox\u306e\u30c7\u30d7\u30ed\u30a4\n[DevBox](https://bintray.com/artifact/download/photon-controller/public/UserWorkflow/PhotonControllerDevbox-11-12-15.ova)\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u3001vSphere\u74b0\u5883\u306b\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u3002IP\u30a2\u30c9\u30ec\u30b9\u306f\u4e8b\u524d\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u30c7\u30d7\u30ed\u30a4\u6642\u306b\u306fIP\u30a2\u30c9\u30ec\u30b9\u306a\u3069\u306eOVF\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u6307\u5b9a\u306f\u4e0d\u8981\u3002PhotonControllerDevbox-11-12-15.ova\u306f\u30014vCPU/3GB RAM/80GB HDD\u3002\n\n##Nested ESXi\u306e\u7528\u610f\nPhoton Controller\u306b\u3088\u3063\u3066\u7ba1\u7406\u3059\u308bESXi\u30db\u30b9\u30c8\u3092Nested ESXi\u3068\u3057\u3066\u7528\u610f\u3059\u308b\u3002\u30e1\u30e2\u30ea\u5272\u308a\u5f53\u3066\u306f8GB\u4ee5\u4e0a\u3002\u5927\u304d\u3044\u307b\u3046\u304c\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u305f\u304f\u3055\u3093\u4f5c\u308c\u308b\u306e\u3067\u300116GB\u7a0b\u5ea6\u5272\u308a\u5f53\u3066\u308b\u306e\u304c\u671b\u307e\u3057\u3044\u3002\nNested ESXi\u3092\u63a5\u7d9a\u3059\u308b\u30dd\u30fc\u30c8\u30b0\u30eb\u30fc\u30d7\u306fpromiscuous\u306b\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u6ce8\u610f\u3002\n\n##Photon Controller CLI\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nPhoton Controller CLI\u306fDevBox\u4e0a\u3067\u52d5\u4f5c\u3059\u308bPhoton Controller\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8CLI\u3002Windows\u7528\u3068Mac\u7248\u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308b\u3002(\u30d3\u30eb\u30c9\u6e08\u307f\u306eLinux\u5411\u3051\u30d0\u30a4\u30ca\u30ea\u306f\u516c\u958b\u3055\u308c\u3066\u3044\u306a\u3044\u6a21\u69d8)\n- [Mac\u7528](https://bintray.com/artifact/download/photon-controller/public/UserWorkflow/photon)\n- [Windows\u7528](https://bintray.com/artifact/download/photon-controller/public/UserWorkflow/photon.exe)\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u5f8c\u3001PATH\u304c\u901a\u3063\u3066\u3044\u308b\u5834\u6240\u306b\u79fb\u52d5\u3059\u308b\u3053\u3068\u3002(C:\u00a5Windows\u00a5system32 \u7b49)\n\n#Photon Platform\u306e\u6e96\u5099\n\n##Photon Controller CLI\u306e\u63a5\u7d9a\u5148\u6307\u5b9a\nPhoton Controller CLI\u306e\u63a5\u7d9a\u5148\u3068\u3057\u3066DevBox\u306ePhoton Controller\u3092\u6307\u5b9a\u3059\u308b\n\n```\nPS C:\\> photon target set https://192.168.209.29:443\nAPI target set to 'https://192.168.209.29:443'\nCertificate (with below fingerprint) presented by server (192.168.209.29:443) isn't trusted.\nMD5 = B9D1D2C1B764B5CB415D00457A7A7312\nSHA1  = 433A5D8736000E39EADFF4F700BF37D8DDE307F1\nDo you trust this certificate for future communication? (yes/no): yes\n\nSaved your preference for future communicaition with 192.168.209.29:443\n```\n\n##ESXi\u30db\u30b9\u30c8\u306e\u767b\u9332\nPhoton Controller\u306bNested ESXi\u3092\u767b\u9332\u3059\u308b\u3002\n\n```\nPS C:\\> photon host create --username root --password [esxpassword] --tag CLOUD --address 192.168.209.31\nHost Metadata ({'key':'value'}. required by host of 'MGMT' tag):\nUsing target 'https://192.168.209.29:443'\n\n\nHost with ip '192.168.209.31' created: ID = ef86128a-140f-4325-a474-4236fa07cc32\n```\n\n###\u767b\u9332\u3057\u305f\u30db\u30b9\u30c8\u306e\u78ba\u8a8d\n\n```\nPS C:\\> photon host list\nUsing target 'https://192.168.209.29:443'\nID                                    State  IP              Tags\nef86128a-140f-4325-a474-4236fa07cc32  READY  192.168.209.31  CLOUD\n\nTotal: 1\n```\n\nESXi\u30db\u30b9\u30c8\u306b\u306fPhoton Controller\u306eLeaf Scheduler\u304cVIB\u3068\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3001\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u306b\u5fc5\u8981\u306a\u30d5\u30a9\u30eb\u30c0\u304c\u4f5c\u6210\u3055\u308c\u308b\u3002\n\n```\n[root@esxi:~] esxcli software vib list | grep Community\nphoton-controller-agent        0.1.0.dev-5.5.0                       VMware  CommunitySupported  2015-11-16\n```\n\n##\u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u306e\u767b\u9332\nVMDK\u3068\u3057\u3066\u914d\u5e03\u3055\u308c\u308bMesos/Kubernetes/Swarm\u306e\u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u3092\u767b\u9332\u3059\u308b\u3002\u767b\u9332\u3057\u305f\u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u306fESXi\u306e\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2(datastore1)\u306b\u4fdd\u5b58\u3055\u308c\u308b\u3002\n\n```\nPS C:\\> photon image create C:\\photon-kubernetes-vm-disk1.vmdk -n photon-kubernetes-vm.vmdk -i EAGER\nUsing target 'https://192.168.209.29:443'\nCreated image 'photon-kubernetes-vm.vmdk' ID: 32daa1e4-0a71-4326-a24d-59fc6489eb14\n\nPS C:\\> photon image create C:\\photon-swarm-vm-disk1.vmdk -n photon-swarm-vm.vmdk -i EAGER\nUsing target 'https://192.168.209.29:443'\nCreated image 'photon-swarm-vm.vmdk' ID: 612d079e-e166-4fb5-870e-e74d9f9ea78e\n\nPS C:\\> photon image create C:\\photon-mesos-vm-disk1.vmdk -n photon-mesos-vm.vmdk -i EAGER\nUsing target 'https://192.168.209.29:443'\nCreated image 'photon-mesos-vm.vmdk' ID: 45217e98-ddbf-4999-b449-45b4e9ca1d65\n\nPS C:\\> photon image list\nUsing target 'https://192.168.209.29:443'\nID                                    Name                       State  Size(Byte)   Replication_type\n32daa1e4-0a71-4326-a24d-59fc6489eb14  photon-kubernetes-vm.vmdk  READY  85899345968  EAGER\n45217e98-ddbf-4999-b449-45b4e9ca1d65  photon-mesos-vm.vmdk       READY  85899345968  EAGER\n612d079e-e166-4fb5-870e-e74d9f9ea78e  photon-swarm-vm.vmdk       READY  85899345968  EAGER\n\nTotal: 3\n```\n\n\n#Photon Platform\u306e\u5229\u7528\nSwarm\u3001Kubernetes\u3001Mesos\u306e\u30af\u30e9\u30b9\u30bf\u30fc\u4f5c\u6210\u304c\u53ef\u80fd\u3002\n\n##Swarm\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u4f5c\u6210\nSwarm\u30af\u30e9\u30b9\u30bf\u30fc\u3092Slave2\u53f0\u3067\u4f5c\u6210\u3059\u308b\u3002Swarm\u30af\u30e9\u30b9\u30bf\u30fc\u306fmaster\u3068etcd\u3001\u8907\u6570\u53f0\u306eSlave\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u3067\u69cb\u6210\u3055\u308c\u308b\u3002\n\n```\nPS C:\\> photon cluster create -n Swarm2 -k Swarm --dns 192.168.209.2 --gateway 192.168.209.2 --netmask 255.255.255.0 --etcd1 192.168.209.55 -s 2\nUsing target 'https://192.168.209.29:443'\netcd server 2 static IP address (leave blank for none):\n\nCreating cluster: Swarm2 (SWARM)\n  Slave count: 2\n```\n\n##\u4f5c\u6210\u3057\u305f\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u78ba\u8a8d\n\u4f5c\u6210\u3057\u305f\u30af\u30e9\u30b9\u30bf\u30fc\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\n```\nPS C:\\> photon cluster list\nUsing target 'https://192.168.209.29:443'\nID                                    Name    Type   State  Slave Count\n0db6bb43-5537-4ece-98c2-d0ae17a0e54a  Swarm2  SWARM  READY  2\n\nTotal: 1\nREADY: 1\n```\n\n###\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u8a73\u7d30\u60c5\u5831\n\u300cmaster-xxxx\u300d(192.168.209.173)\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u304cSwarm\u306emaster\u3068\u306a\u3063\u3066\u3044\u308b\u3002\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u30ce\u30fc\u30c9(master/slave)\u306fDHCP\u3067IP\u30a2\u30c9\u30ec\u30b9\u3092\u53d6\u5f97\u3059\u308b\u3002\n\n```\nPS C:\\> photon cluster show 0db6bb43-5537-4ece-98c2-d0ae17a0e54a\nUsing target 'https://192.168.209.29:443'\nCluster ID:     0db6bb43-5537-4ece-98c2-d0ae17a0e54a\n  Name:         Swarm2\n  State:        READY\n  Type:         SWARM\n  Slave count:  2\n\nVM ID                                 VM Name                                      VM IP\nd28726ff-ebd4-46a5-acf6-ba54e59a7508  master-505f1abd-3950-4e2a-abf2-a76d08324aac  192.168.209.173\n91025592-362b-4c63-9040-0ade0b3d7fbf  etcd-097b3dd1-4e8b-4a0c-bf84-95ad3ab8fb00    192.168.209.55\n```\n\n\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u69cb\u6210\u3059\u308bVM\u306e\u78ba\u8a8d\n\n```\nPS C:\\> photon cluster list_vms 0db6bb43-5537-4ece-98c2-d0ae17a0e54a\nUsing target 'https://192.168.209.29:443'\nID                                    Name                                         State\nd28726ff-ebd4-46a5-acf6-ba54e59a7508  master-505f1abd-3950-4e2a-abf2-a76d08324aac  STARTED\n51d6e7d1-3652-4c42-987d-38c58e3425cf  slave-3eaa99ae-ee0f-46ac-a0ed-bca2e5af7a85   STARTED\nbda835f9-e223-495e-a660-0a6252c6437b  slave-f9102f1a-7acf-4f07-9b57-b79eb0c0402e   STARTED\n91025592-362b-4c63-9040-0ade0b3d7fbf  etcd-097b3dd1-4e8b-4a0c-bf84-95ad3ab8fb00    STARTED\n\nTotal: 4\nSTARTED: 4\n```\n\nmaster\u306bssh(\u30e6\u30fc\u30b6\u30fc\u540d:root/\u30d1\u30b9\u30ef\u30fc\u30c9:vmware)\u3057\u3066\u78ba\u8a8d\u3059\u308b\u3068\u3001\u4f5c\u6210\u3055\u308c\u305fSwarm\u30af\u30e9\u30b9\u30bf\u30fc\u306fSwarm 0.4.0\u3001Docker version 1.8.1\u3002\n\n```\nroot@master-505f1abd-3950-4e2a-abf2-a76d08324aac [ ~ ]# export DOCKER_HOST=\"tcp://localhost:2375\"\nroot@master-505f1abd-3950-4e2a-abf2-a76d08324aac [ ~ ]# docker version\nClient:\n Version:      1.8.1\n API version:  1.20\n Go version:   go1.4.2\n Git commit:   d12ea79\n Built:        Thu Aug 13 02:49:29 UTC 2015\n OS/Arch:      linux/amd64\n\nServer:\n Version:      1.8.1\n API version:  1.20\n Go version:   go1.4.2\n Git commit:   d12ea79\n Built:        Thu Aug 13 02:49:29 UTC 2015\n OS/Arch:      linux/amd64\nroot@master-505f1abd-3950-4e2a-abf2-a76d08324aac [ ~ ]# docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES\n0effdfd20fdb        swarm:0.4.0         \"/swarm manage etcd:/\"   21 minutes ago      Up 21 minutes       0.0.0.0:8333->2375/tcp   clever_mestorf\n0af98e8449df        swarm:0.4.0         \"/swarm join --addr=1\"   21 minutes ago      Up 21 minutes       2375/tcp                 goofy_archimedes\n```\n\n\n##Docker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u30ef\u30fc\u30af\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u306bDocker\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\u6700\u65b0\u306eDocker 1.9.x\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3057\u307e\u3046\u3068API\u30df\u30b9\u30de\u30c3\u30c1\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u3057\u307e\u3046\u306e\u3067\u6ce8\u610f\u3002\n\n```\nError response from daemon: client is newer than server (client API version: 1.21, server API version: 1.20)\n```\n\nWindows\u306e\u5834\u5408\u306f[\u3053\u3053](https://github.com/docker/toolbox/releases)\u304b\u3089Docker Toolbox\u306e1.8.x\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\n\n#Swarm\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u5229\u7528\nDOCKER_HOST\u3068\u3057\u3066Swarm Master(\u30dd\u30fc\u30c8\u756a\u53f7\u306f8333)\u3092\u6307\u5b9a\u3057\u3066\u5229\u7528\u53ef\u80fd\u3002\n\n```\nPS C:\\> $env:DOCKER_HOST=\"tcp://192.168.209.173:8333\"\n```\n\n\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u72b6\u614b\u3092\u898b\u3066\u307f\u308b\u3002\u6307\u5b9a\u3057\u305f\u901a\u308aMaster\u3068Slave\u304c2\u53f0\u3067\u304d\u3066\u3044\u308b\u3002\n\n```\nPS C:\\> docker info\nContainers: 4\nImages: 6\nRole: primary\nStrategy: spread\nFilters: affinity, health, constraint, port, dependency\nNodes: 3\n master-505f1abd-3950-4e2a-abf2-a76d08324aac: 192.168.209.173:2375\n  \u2514 Containers: 2\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 513.9 MiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=4.0.9, operatingsystem=VMware Photon/Linux, storagedriver=overlay\n\n slave-3eaa99ae-ee0f-46ac-a0ed-bca2e5af7a85: 192.168.209.174:2375\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 249.5 MiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=4.0.9, operatingsystem=VMware Photon/Linux, storagedriver=overlay\n\n slave-f9102f1a-7acf-4f07-9b57-b79eb0c0402e: 192.168.209.175:2375\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 249.5 MiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=4.0.9, operatingsystem=VMware Photon/Linux, storagedriver=overlay\n\nCPUs: 4\nTotal Memory: 1013 MiB\nName: 3e44d2b43116\n```\n\n##\u30b3\u30f3\u30c6\u30ca\u306e\u78ba\u8a8d\n3\u53f0\u306eVM\u4e0a\u3067Swarm\u7528\u306e\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u3002\n\n```\nPS C:\\> docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                            NAMES\n09bf640d2360        swarm:0.4.0         \"/swarm join --addr=1\"   About an hour ago   Up About an hour    2375/tcp                         slave-f9102f1a-7acf-4f07-9b57-b79eb0c0402e/high_einstein\nf7357b931ea7        swarm:0.4.0         \"/swarm join --addr=1\"   About an hour ago   Up About an hour    2375/tcp                         slave-3eaa99ae-ee0f-46ac-a0ed-bca2e5af7a85/lonely_mahavira\n3e44d2b43116        swarm:0.4.0         \"/swarm manage etcd:/\"   About an hour ago   Up About an hour    192.168.209.173:8333->2375/tcp   master-505f1abd-3950-4e2a-abf2-a76d08324aac/cocky_varahamihira\n0a1498b816a2        swarm:0.4.0         \"/swarm join --addr=1\"   About an hour ago   Up About an hour    2375/tcp                         master-505f1abd-3950-4e2a-abf2-a76d08324aac/hungry_mestorf\n```\n\n\n##\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\nSwarm\u7d4c\u7531\u3067nginx\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066\u307f\u308b\u3002\n\n```\nPS C:\\> docker run -itd --name nginx -p 8000:80 nginx\nba8ba9590796a88bcd49b0ac6ddca6ea381fc60dd3a1b1b330b71619e61fae87\n```\n\n\u8d77\u52d5\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u306e\u78ba\u8a8d\u3002nginx\u30b3\u30f3\u30c6\u30ca\u306fslave-3eaa99ae-ee0f-46ac-a0ed-bca2e5af7a85(192.168.207.174)\u306e8000\u756a\u3067\u8d77\u52d5\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u30d6\u30e9\u30a6\u30b6\u3067\u63a5\u7d9a\u53ef\u80fd\u3002\n\n```\nPS C:\\> docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                   NAMES\nba8ba9590796        nginx               \"nginx -g 'daemon off\"   5 seconds ago       Up 2 seconds        443/tcp, 192.168.209.174:8000->80/tcp   slave-3eaa99ae-ee0f-46ac-a0ed-bca2e5af7a85/nginx\n09bf640d2360        swarm:0.4.0         \"/swarm join --addr=1\"   About an hour ago   Up About an hour    2375/tcp                                slave-f9102f1a-7acf-4f07-9b57-b79eb0c0402e/high_einstein\nf7357b931ea7        swarm:0.4.0         \"/swarm join --addr=1\"   About an hour ago   Up About an hour    2375/tcp                                slave-3eaa99ae-ee0f-46ac-a0ed-bca2e5af7a85/lonely_mahavira\n3e44d2b43116        swarm:0.4.0         \"/swarm manage etcd:/\"   About an hour ago   Up About an hour    192.168.209.173:8333->2375/tcp          master-505f1abd-3950-4e2a-abf2-a76d08324aac/cocky_varahamihira\n0a1498b816a2        swarm:0.4.0         \"/swarm join --addr=1\"   About an hour ago   Up About an hour    2375/tcp                                master-505f1abd-3950-4e2a-abf2-a76d08324aac/hungry_mestorf\n```\n\n\n##\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\n\u4e00\u5ea6\u4f5c\u3063\u305f\u30af\u30e9\u30b9\u30bf\u30fc\u306eSlave\u53f0\u6570\u306f\u5f8c\u304b\u3089\u5909\u66f4\u53ef\u80fd\u3002Slave\u53f0\u6570\u30923\u53f0\u306b\u5897\u3084\u3057\u3066\u307f\u308b\u3002\n\n```\nPS C:\\> photon cluster resize 0db6bb43-5537-4ece-98c2-d0ae17a0e54a 3\nUsing target 'https://192.168.209.29:443'\n\nResizing cluster 0db6bb43-5537-4ece-98c2-d0ae17a0e54a to slave count 3\nAre you sure [y/n]? y\nCluster resized: ID = 0db6bb43-5537-4ece-98c2-d0ae17a0e54a\nNote: A background task is running to gradually resize the cluster to its target capacity.\nYou may continue to use the cluster. You can run 'cluster show '\nto see the state of the cluster. If the resize operation is still in progress, the cluster state\nwill show as RESIZING. Once the cluster is resized, the cluster state will show as READY.\n```\n\n\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3002\u300cRESIZING\u300d\u3068\u306a\u3063\u3066\u3044\u308b\u3002\n\n```\nPS C:\\> photon cluster show 0db6bb43-5537-4ece-98c2-d0ae17a0e54a\nUsing target 'https://192.168.209.29:443'\nCluster ID:     0db6bb43-5537-4ece-98c2-d0ae17a0e54a\n  Name:         Swarm2\n  State:        RESIZING\n  Type:         SWARM\n  Slave count:  3\n\nVM ID                                 VM Name                                      VM IP\nd28726ff-ebd4-46a5-acf6-ba54e59a7508  master-505f1abd-3950-4e2a-abf2-a76d08324aac  192.168.209.173\n91025592-362b-4c63-9040-0ade0b3d7fbf  etcd-097b3dd1-4e8b-4a0c-bf84-95ad3ab8fb00    192.168.209.55\n```\n\u3057\u3070\u3089\u304f\u5f85\u3063\u3066\u3082\u3046\u4e00\u5ea6\u78ba\u8a8d\u3059\u308b\u3068\u3001\u300cREADY\u300d\u306b\u306a\u308b\u3002\n\n```\nPS C:\\> photon cluster show 0db6bb43-5537-4ece-98c2-d0ae17a0e54a\nUsing target 'https://192.168.209.29:443'\nCluster ID:     0db6bb43-5537-4ece-98c2-d0ae17a0e54a\n  Name:         Swarm2\n  State:        READY\n  Type:         SWARM\n  Slave count:  3\n\nVM ID                                 VM Name                                      VM IP\nd28726ff-ebd4-46a5-acf6-ba54e59a7508  master-505f1abd-3950-4e2a-abf2-a76d08324aac  192.168.209.173\n91025592-362b-4c63-9040-0ade0b3d7fbf  etcd-097b3dd1-4e8b-4a0c-bf84-95ad3ab8fb00    192.168.209.55\n```\n\ndocker info\u3067\u78ba\u8a8d\u3059\u308b\u3068\u3001slave\u304c3\u53f0\u306b\u5897\u3048\u3066\u3044\u308b\u3002\n\n```\nPS C:\\> docker info\nContainers: 5\nImages: 12\nRole: primary\nStrategy: spread\nFilters: affinity, health, constraint, port, dependency\nNodes: 4\n master-505f1abd-3950-4e2a-abf2-a76d08324aac: 192.168.209.173:2375\n  \u2514 Containers: 2\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 513.9 MiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=4.0.9, operatingsystem=VMware Photon/Linux, storagedriver=overlay\n\n slave-3eaa99ae-ee0f-46ac-a0ed-bca2e5af7a85: 192.168.209.174:2375\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 249.5 MiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=4.0.9, operatingsystem=VMware Photon/Linux, storagedriver=overlay\n\n slave-f9102f1a-7acf-4f07-9b57-b79eb0c0402e: 192.168.209.175:2375\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 249.5 MiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=4.0.9, operatingsystem=VMware Photon/Linux, storagedriver=overlay\n\n slave-f93ca2e3-74a2-467a-b416-f5beb4b08463: 192.168.209.183:2375\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 249.5 MiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=4.0.9, operatingsystem=VMware Photon/Linux, storagedriver=overlay\n\nCPUs: 5\nTotal Memory: 1.233 GiB\nName: 3e44d2b43116\n```\n\n##\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u30b9\u30b1\u30fc\u30eb\u30a4\u30f3\n\u6b8b\u5ff5\u306a\u304c\u3089\u4eca\u306e\u3068\u3053\u308d\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u6a21\u69d8\u3002\n\n```\nPS C:\\> photon cluster resize 0db6bb43-5537-4ece-98c2-d0ae17a0e54a 2\nUsing target 'https://192.168.209.29:443'\n\nResizing cluster 0db6bb43-5537-4ece-98c2-d0ae17a0e54a to slave count 2\nAre you sure [y/n]? y\n2015/11/20 12:42:28 esxcloud: Task '5f9046cd-3754-4323-aeb2-ea6f82953d02' is in error state. Examine task for full details.\nAPI Errors: [esxcloud: { HTTP status: '0', code: 'InternalError', message: 'Reducing cluster size is not supported. Current cluster size: 3. New cluster size: 2.', data: 'map[]' }]\n```\n\n\n", "tags": ["Photon", "vmware", "swarm", "docker"]}