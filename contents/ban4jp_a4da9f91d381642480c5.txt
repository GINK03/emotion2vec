{"context": " More than 1 year has passed since last update.IFTTT\u306eMakerChannel\u3092\u4f7f\u7528\u3057\u3066\u3001ESP-WROOM-02\u304b\u3089\u30ec\u30b7\u30d4\u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u3002\nMakerChannel\u306eREST-API\u306f\u975e\u5e38\u306b\u30b7\u30f3\u30d7\u30eb\u3067\u6271\u3044\u3084\u3059\u3044\u306e\u3067\u3059\u304c\u3001http\u3067\u306f\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u304c\u30d0\u30ec\u30d0\u30ec\u3067\u3059\u3002https(SSL/TLS)\u3092\u4f7f\u7528\u3057\u3066\u901a\u4fe1\u3092\u6697\u53f7\u5316\u3057\u3001\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u3092\u96a0\u3057\u307e\u3057\u3087\u3046\u3002\n\u25a0 \u6ce8\u610f \u25a0\n\u3000\u7d39\u4ecb\u3057\u3066\u3044\u308b\u624b\u9806\u3067\u901a\u4fe1\u306f\u6697\u53f7\u5316\u3055\u308c\u307e\u3059\u304c\u3001\u306a\u308a\u3059\u307e\u3057\u7b49\u306e\u653b\u6483\u306f\u9632\u3050\u4e8b\u306f\u3067\u304d\u307e\u305b\u3093\u3002\n\u3000SSL\u8a3c\u660e\u66f8\u306e\u691c\u8a3c\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u7121\u52b9\u5316\u3055\u308c\u3066\u3044\u308b\u304b\u3089\u3067\u3059\u3002\n\u3000\u305d\u306e\u305f\u3081\u3001\u5b89\u5168\u6027\u306f\u300c\u5e73\u6587\u3067\u30ad\u30fc\u3092\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u6d41\u3059\u3088\u308a\u30de\u30b7\u300d\u306a\u30ec\u30d9\u30eb\u3067\u3042\u308b\u4e8b\u306b\u3054\u6ce8\u610f\u304f\u3060\u3055\u3044\u3002\n\n\n\u4e8b\u524d\u6e96\u5099\n\nArduino IDE \u306b\u3066ESP-WROOM-02(ESP8266)\u306e\u958b\u767a\u304c\u3067\u304d\u308b\u6e96\u5099\u304c\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u3002\n\u4e8b\u524d\u306b\"L\u30c1\u30ab\"\u3059\u308b\u4e8b\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002\nIFTTT\u3067MakerChannel\u3092\u30c8\u30ea\u30ac\u30fc\u3068\u3059\u308b\u30ec\u30b7\u30d4\u3092\u7528\u610f\u3057\u3066\u3042\u308b\u3053\u3068\u3002\n\u901a\u77e5\u7cfb\u306e\u30ec\u30b7\u30d4\u304c\u304a\u30b9\u30b9\u30e1\u3067\u3059\u3002\uff08iOS Notification\u3001Android Notification\uff09\n\n\nSSL\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u6709\u52b9\u5316\n2015\u5e748\u67087\u65e5\u6642\u70b9\u3067\u306f\u3001SSL\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u30d3\u30eb\u30c9\u6642\u306b\u30ea\u30f3\u30af\u3055\u308c\u306a\u3044\u8a2d\u5b9a\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u624b\u9806\u3067\u30ea\u30f3\u30af\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\u307e\u305f\u3001\u516c\u5f0fSDK\u306e\u30d5\u30a9\u30fc\u30e9\u30e0\u306b\u3066SSL\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u4fee\u6b63\u30d1\u30c3\u30c1\u304c\u51fa\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u5dee\u3057\u66ff\u3048\u3092\u884c\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u624b\u9806\uff11\uff1a\u8a2d\u5b9a\u30d5\u30a9\u30eb\u30c0\u3092\u958b\u304d\u3001\u30dc\u30fc\u30c9\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30ea\u30d3\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u7b46\u8005\u304c\u691c\u8a3c\u3057\u305f\u30ea\u30d3\u30b8\u30e7\u30f3\u306f 1.6.5-947-g39819f0 \u3067\u3059\u3002\u540c\u3058\u3067\u3042\u308c\u3070\u826f\u3044\u306e\u3067\u3059\u304c\u3001\u65b0\u3057\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u4ed5\u69d8\u304c\u5909\u308f\u3063\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nArduino IDE \u306e\u8a2d\u5b9a\u753b\u9762\u304b\u3089\u3001\u8a2d\u5b9a\u30d5\u30a9\u30eb\u30c0\u3092\u958b\u304d\u307e\u3059\u3002\n\\packages\\esp8266\\hardware\\esp8266 \u3068\u8fbf\u308a\u3001 1.6.5-947-g39819f0 \u3068\u3044\u3046\u30d5\u30a9\u30eb\u30c0\u304c\u5b58\u5728\u3059\u308c\u3070\u540c\u3058\u30ea\u30d3\u30b8\u30e7\u30f3\u3067\u3059\u3002\n\n\n\u624b\u9806\uff12\uff1aSSL\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30d1\u30c3\u30c1\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u3092\u5dee\u3057\u66ff\u3048\u307e\u3059\u3002\n\u3053\u306e\u624b\u9806\u306f\u304a\u305d\u3089\u304f\u6b21\u306eSDK\u306b\u542b\u307e\u308c\u308b\u4e8b\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u65b0\u3057\u3044\u30ea\u30d3\u30b8\u30e7\u30f3\u306e\u30dc\u30fc\u30c9\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u4e00\u65e6\u3053\u306e\u624b\u9806\u3092\u98db\u3070\u3057\u3066\u30b9\u30b1\u30c3\u30c1\u306e\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\u516c\u5f0f\u30b5\u30a4\u30c8\u304b\u3089\u300cSDK v1.2.0 Patch for SSL\u300d\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\nhttp://bbs.espressif.com/viewtopic.php?f=5&t=708\n\u3088\u304f\u8aad\u3080\u3068\u3001\u4fee\u6b63\u30d1\u30c3\u30c1\u3092\u518d\u30ea\u30ea\u30fc\u30b9\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\uff12\u3064\u76ee\u306e\u30d5\u30a1\u30a4\u30eb( libssl.zip )\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002zip\u30d5\u30a1\u30a4\u30eb\u3092\u89e3\u51cd\u3059\u308b\u3068\u3001libssl.a \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u304c\uff11\u3064\u3060\u3051\u5165\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u6b21\u306e\u30d5\u30a9\u30eb\u30c0\u306b\u5165\u3063\u3066\u3044\u308b\u540c\u540d\u30d5\u30a1\u30a4\u30eb\u306b\u4e0a\u66f8\u304d\u3057\u3066\u5dee\u3057\u66ff\u3048\u307e\u3059\u3002\n\\packages\\esp8266\\hardware\\esp8266\\1.6.5-947-g39819f0\\tools\\sdk\\lib\n\n\u624b\u9806\uff13\uff1a\u30d3\u30eb\u30c9\u6642\u306bSSL\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u30ea\u30f3\u30af\u3055\u308c\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u6b21\u306e\u30d5\u30a9\u30eb\u30c0\u3092\u8fbf\u308a\u3001platform.txt \u3092\u958b\u304d\u307e\u3059\u3002\n\\packages\\esp8266\\hardware\\esp8266\\1.6.5-947-g39819f0\n\u4e0b\u8a18\u306e\u3088\u3046\u306a\u8a18\u8ff0\u3092\u63a2\u3057\u3001\u30ea\u30f3\u30af\u3059\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u306b -lssl \u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\uff0827\u884c\u76ee\u4ed8\u8fd1\u3067\u3059\u3002\uff09\n\nplatform.txt\u300027\u884c\u76ee\n\u5909\u66f4\u524d\ncompiler.c.elf.libs=-lm -lgcc -lhal -lphy -lnet80211 -llwip -lwpa -lmain -lpp -lsmartconfig -lwps -lcrypto\n\n\u5909\u66f4\u5f8c\ncompiler.c.elf.libs=-lm -lgcc -lhal -lphy -lnet80211 -llwip -lwpa -lmain -lpp -lsmartconfig -lwps -lcrypto -lssl\n\n\n\n\u30b5\u30f3\u30d7\u30eb\u30b9\u30b1\u30c3\u30c1\u3068\u56de\u8def\u56f3\n\nESP-WROOM-02\u306e17\u756a\u30d4\u30f3\u306b\u30bf\u30af\u30c8\u30b9\u30a4\u30c3\u30c1\u3092\u7e4b\u3044\u3067\u300110K\u03a9\u7a0b\u5ea6\u3067\u30d7\u30eb\u30a2\u30c3\u30d7\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u30b9\u30b1\u30c3\u30c1\u5185\u306eWiFi\u30a2\u30af\u30bb\u30b9\u30dd\u30a4\u30f3\u30c8\u306e\u8a2d\u5b9a\u3084\u3001MakerChannel\u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u306e\u5909\u66f4\u3092\u5fd8\u308c\u305a\u306b\u884c\u3063\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u30b9\u30b1\u30c3\u30c1\u304c\u6b63\u3057\u304f\u66f8\u304d\u8fbc\u307e\u308c\u308b\u3068\u3001WiFi\u30a2\u30af\u30bb\u30b9\u30dd\u30a4\u30f3\u30c8\u306b\u63a5\u7d9a\u3057\u305f\u306e\u3061\u3001\uff11\u5ea6\u3060\u3051MakerChannel\u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u3002\u305d\u306e\u5f8c\u3001\u30bf\u30af\u30c8\u30b9\u30a4\u30c3\u30c1\u304c\u62bc\u3055\u308c\u308b\u307e\u3067\u5f85\u6a5f\u3057\u3001\u62bc\u3055\u308c\u305f\u3089MakerChannel\u3092\u547c\u3073\u51fa\u3059\u52d5\u4f5c\u3092\u7e70\u308a\u8fd4\u3057\u307e\u3059\u3002\n\nIFTTT_with_SSL.ino\n/**\n *  ESP-WROOM-02\n *  SSL/TLS\u3067\u3001IFTTT MakerChannel\u3092\u547c\u3073\u51fa\u3059\u30b9\u30b1\u30c3\u30c1\n *  \n *  \u6ce8\u610f\n *  \u30fbDNS\u304b\u3089IP\u30a2\u30c9\u30ec\u30b9\u3092\u53d6\u5f97\u305b\u305a\u3001\u76f4\u63a5IP\u30a2\u30c9\u30ec\u30b9\u3092\u30b9\u30b1\u30c3\u30c1\u306b\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\n *  \u30fbSSL/TLS\u30b9\u30bf\u30c3\u30af\u306b\u30db\u30b9\u30c8\u540d\u3092\u6e21\u3057\u3066\u3001\u8a3c\u660e\u66f8\u3092\u691c\u8a3c\u3059\u308b\u65b9\u6cd5\u304c\u5206\u304b\u3063\u3066\u3044\u307e\u305b\u3093\u3002\n *  \u30fb\u305d\u306e\u305f\u3081\u3001\u304b\u306a\u308a\u9069\u5f53\u306a\u30aa\u30ec\u30aa\u30ec\u8a3c\u660e\u66f8\u3067\u3082\u96e3\u306a\u304f\u901a\u904e\u3057\u3066\u3057\u307e\u3046\u3067\u3057\u3087\u3046\u3002(^_^;)\n */\n\n#ifdef ESP8266\nextern \"C\" {\n#include \"ip_addr.h\"\n#include \"espconn.h\"\n#include \"user_interface.h\"\n}\n#endif\n\n#include <ESP8266WiFi.h>\n\n// \u8a3c\u660e\u66f8\u30b9\u30c8\u30a2\nunsigned char default_certificate[] = {};\nunsigned int  default_certificate_len = 0;\nunsigned char default_private_key[] = {};\nunsigned int  default_private_key_len = 0;\n\n// WiFi\u30a2\u30af\u30bb\u30b9\u30dd\u30a4\u30f3\u30c8\u306e\u8a2d\u5b9a\nconst char* ssid     = \"mbed_ap\";\nconst char* password = \"password1234\";\n\n// IFTTT MakerChannel\u306e\u8a2d\u5b9a\nconst char* host        = \"maker.ifttt.com\";\nconst char* secret_key  = \"dummyaXaYaRalatafa8ava\";\n\n// \u6295\u7a3f\u30dc\u30bf\u30f3\u306e\u8a2d\u5b9a = IO16\n//  ESP-WROOM-02\u306e\u30d4\u30f3\u3067\u306f 17\u756a \u306a\u306e\u3067\u6ce8\u610f\u3002\nconst int buttonPin = 16;\n\n// \u30c7\u30fc\u30bf\u53d7\u4fe1\u30d0\u30c3\u30d5\u30a1\u3068\u30dd\u30a4\u30f3\u30bf\nchar  recvbuffer[2048];\nchar* recvbuffer_pos;\n\nLOCAL struct espconn esp;\nLOCAL struct _esp_tcp tcp;\n\nvoid setup() {\n  Serial.begin(115200);\n  delay(10);\n\n  // \u6295\u7a3f\u30dc\u30bf\u30f3\u306e\u8a2d\u5b9a\n  pinMode(buttonPin, INPUT);\n\n  Serial.print(\"Connecting to \");\n  Serial.println(ssid);\n\n  // \u30a2\u30af\u30bb\u30b9\u30dd\u30a4\u30f3\u30c8\u306b\u63a5\u7d9a\n  WiFi.begin(ssid, password);\n  while (WiFi.status() != WL_CONNECTED) {\n    delay(500);\n    Serial.print(\".\");\n  }\n\n  Serial.println(\"connected\");  \n  Serial.print(\"IP address: \");\n  Serial.println(WiFi.localIP());\n}\n\nvoid connect_cb(void *arg) {\n  Serial.println(\"connect_cb\");\n}\nvoid reconnect_cb(void *arg, sint8 err) {\n  Serial.print(\"reconnect_cb: \");\n  Serial.println(err);\n}\nvoid disconnect_cb(void *arg) {\n  Serial.println(\"disconnect_cb\");\n}\n\nvoid recv_cb(void *arg, char *pdata, unsigned short len) {\n  Serial.print(\"recv_cb:\");\n  Serial.println(len);\n  memcpy(recvbuffer_pos, pdata, len);\n  recvbuffer_pos += len;\n}\nvoid sent_cb(void *arg) {\n  Serial.println(\"sent_cb\");\n}\n\nvoid loop() {\n  Serial.print(\"connecting to \");\n  Serial.println(host);\n\n  tcp.local_ip[0] = 0;\n  tcp.local_ip[1] = 0;\n  tcp.local_ip[2] = 0;\n  tcp.local_ip[3] = 0;\n  tcp.local_port = espconn_port();\n\n  tcp.remote_ip[0] = 54;   //maker.ifttt.com = 54.243.120.63\n  tcp.remote_ip[1] = 243;\n  tcp.remote_ip[2] = 120;\n  tcp.remote_ip[3] = 63;\n  tcp.remote_port = 443;\n\n  esp.type  = ESPCONN_TCP;\n  esp.state = ESPCONN_NONE;\n  esp.proto.tcp = &tcp;\n\n  // \u63a5\u7d9a\u30fb\u5207\u65ad\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3092\u8a2d\u5b9a\n  espconn_regist_connectcb(&esp, connect_cb);\n  espconn_regist_reconcb(&esp, reconnect_cb);\n  espconn_regist_disconcb(&esp, disconnect_cb);\n\n  // \u30c7\u30fc\u30bf\u9001\u53d7\u4fe1\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3092\u8a2d\u5b9a\n  espconn_regist_recvcb(&esp, recv_cb);\n  espconn_regist_sentcb(&esp, sent_cb);\n\n  // SSL/TLS\u3067\u4f7f\u7528\u3059\u308b\u30d0\u30c3\u30d5\u30a1\u30b5\u30a4\u30ba\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u4e0d\u8db3\u3059\u308b\u305f\u3081\u30b5\u30a4\u30ba\u3092\u5909\u66f4\n  //  http://bbs.espressif.com/viewtopic.php?t=548\n  espconn_secure_set_size(ESPCONN_CLIENT, 5120);\n\n  // \u30b5\u30fc\u30d0\u306b\u63a5\u7d9a\n  Serial.print( \"espconn_secure_connect = \");\n  Serial.println(espconn_secure_connect(&esp));\n\n  // \u63a5\u7d9a\u5f85\u3061\n  while(esp.state != ESPCONN_CONNECT) {\n    delay(100);\n  }\n\n  String url = String(\"/trigger/test/with/key/\") + secret_key + \"?value1=0&value2=0&value3=0\";\n\n  Serial.print(\"Requesting URL: \");\n  Serial.println(url);\n\n  String data = String(\"GET \") + url + \" HTTP/1.1\\r\\n\" +\n               \"Host: \" + host + \"\\r\\n\" + \n               \"Connection: close\\r\\n\\r\\n\";\n\n  char senddata[512];\n  data.toCharArray(senddata, sizeof(senddata));\n  Serial.println(senddata);\n\n  // \u53d7\u4fe1\u30d0\u30c3\u30d5\u30a1\u3092\u521d\u671f\u5316\n  recvbuffer_pos = recvbuffer;\n\n  // \u30c7\u30fc\u30bf\u9001\u4fe1\n  Serial.print( \"espconn_secure_sent = \");\n  Serial.println(espconn_secure_sent(&esp, (uint8*)senddata, strlen(senddata)));\n  delay(10);\n\n  // \u5fdc\u7b54\u306e\u53d7\u4fe1\u5b8c\u4e86\u5f85\u3061\n  while(esp.state != ESPCONN_CLOSE) {\n    delay(100);\n  }\n\n  // \u53d7\u4fe1\u3057\u305f\u30c7\u30fc\u30bf\u3092\u51fa\u529b\n  recvbuffer_pos = '\\0';\n  Serial.println(recvbuffer);\n\n  // \uff08\u904e\u5ea6\u306a\u9023\u7d9a\u6295\u7a3f\u3092\u907f\u3051\u308b\u305f\u3081\u3001\u5c11\u3057\u30a6\u30a7\u30a4\u30c8\u3092\u5165\u308c\u308b\uff09\n  Serial.println(\"delay wait ...\");\n  delay(5000);\n\n  // \u5b9f\u884c\u30dc\u30bf\u30f3\u304c\u62bc\u3055\u308c\u308b\u307e\u3067\u5f85\u6a5f\n  Serial.println(\"button wait ...\");\n  while(digitalRead(buttonPin) == HIGH) {\n    delay(10);\n  }\n}\n\n\n\n\u6700\u5f8c\u306b\u30fb\u30fb\u30fb\nWDT\u304c\u53b3\u3057\u3044\u306e\u3067\u3001\u3061\u3087\u3063\u3068\u9577\u3081\u306e\u51e6\u7406\u3092\u884c\u3046\u3068\u30b9\u30bf\u30c3\u30af\u3092\u30c0\u30f3\u30d7\u3057\u3066\u843d\u3061\u307e\u3059\u3002\u51e6\u7406\u3092\u77ed\u3081\u306b\u5de5\u592b\u3057\u305f\u308a\u3001delay(1);\u3092\u633f\u5165\u3059\u308b\u306a\u3069\u3067\u5bfe\u51e6\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff08\u7279\u306bfor\u3084while\u3092\u4f7f\u3046\u3068WDT\u306b\u565b\u307e\u308c\u3084\u3059\u3044\u3067\u3059\u3002\uff09\nIFTTT\u306eMakerChannel\u3092\u4f7f\u7528\u3057\u3066\u3001ESP-WROOM-02\u304b\u3089\u30ec\u30b7\u30d4\u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u3002\n\nMakerChannel\u306eREST-API\u306f\u975e\u5e38\u306b\u30b7\u30f3\u30d7\u30eb\u3067\u6271\u3044\u3084\u3059\u3044\u306e\u3067\u3059\u304c\u3001http\u3067\u306f\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u304c\u30d0\u30ec\u30d0\u30ec\u3067\u3059\u3002https(SSL/TLS)\u3092\u4f7f\u7528\u3057\u3066\u901a\u4fe1\u3092\u6697\u53f7\u5316\u3057\u3001\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u3092\u96a0\u3057\u307e\u3057\u3087\u3046\u3002\n\n```\n\u25a0 \u6ce8\u610f \u25a0\n\u3000\u7d39\u4ecb\u3057\u3066\u3044\u308b\u624b\u9806\u3067\u901a\u4fe1\u306f\u6697\u53f7\u5316\u3055\u308c\u307e\u3059\u304c\u3001\u306a\u308a\u3059\u307e\u3057\u7b49\u306e\u653b\u6483\u306f\u9632\u3050\u4e8b\u306f\u3067\u304d\u307e\u305b\u3093\u3002\n\u3000SSL\u8a3c\u660e\u66f8\u306e\u691c\u8a3c\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u7121\u52b9\u5316\u3055\u308c\u3066\u3044\u308b\u304b\u3089\u3067\u3059\u3002\n\u3000\u305d\u306e\u305f\u3081\u3001\u5b89\u5168\u6027\u306f\u300c\u5e73\u6587\u3067\u30ad\u30fc\u3092\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u6d41\u3059\u3088\u308a\u30de\u30b7\u300d\u306a\u30ec\u30d9\u30eb\u3067\u3042\u308b\u4e8b\u306b\u3054\u6ce8\u610f\u304f\u3060\u3055\u3044\u3002\n```\n\n# \u4e8b\u524d\u6e96\u5099\n\n* Arduino IDE \u306b\u3066ESP-WROOM-02(ESP8266)\u306e\u958b\u767a\u304c\u3067\u304d\u308b\u6e96\u5099\u304c\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u3002\n\u4e8b\u524d\u306b\"L\u30c1\u30ab\"\u3059\u308b\u4e8b\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002\n\n* IFTTT\u3067MakerChannel\u3092\u30c8\u30ea\u30ac\u30fc\u3068\u3059\u308b\u30ec\u30b7\u30d4\u3092\u7528\u610f\u3057\u3066\u3042\u308b\u3053\u3068\u3002\n\u901a\u77e5\u7cfb\u306e\u30ec\u30b7\u30d4\u304c\u304a\u30b9\u30b9\u30e1\u3067\u3059\u3002\uff08iOS Notification\u3001Android Notification\uff09\n\n# SSL\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u6709\u52b9\u5316\n\n2015\u5e748\u67087\u65e5\u6642\u70b9\u3067\u306f\u3001SSL\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u30d3\u30eb\u30c9\u6642\u306b\u30ea\u30f3\u30af\u3055\u308c\u306a\u3044\u8a2d\u5b9a\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u624b\u9806\u3067\u30ea\u30f3\u30af\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\u307e\u305f\u3001\u516c\u5f0fSDK\u306e\u30d5\u30a9\u30fc\u30e9\u30e0\u306b\u3066SSL\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u4fee\u6b63\u30d1\u30c3\u30c1\u304c\u51fa\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u5dee\u3057\u66ff\u3048\u3092\u884c\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n## \u624b\u9806\uff11\uff1a\u8a2d\u5b9a\u30d5\u30a9\u30eb\u30c0\u3092\u958b\u304d\u3001\u30dc\u30fc\u30c9\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30ea\u30d3\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u7b46\u8005\u304c\u691c\u8a3c\u3057\u305f\u30ea\u30d3\u30b8\u30e7\u30f3\u306f 1.6.5-947-g39819f0 \u3067\u3059\u3002\u540c\u3058\u3067\u3042\u308c\u3070\u826f\u3044\u306e\u3067\u3059\u304c\u3001\u65b0\u3057\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u4ed5\u69d8\u304c\u5909\u308f\u3063\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n* Arduino IDE \u306e\u8a2d\u5b9a\u753b\u9762\u304b\u3089\u3001\u8a2d\u5b9a\u30d5\u30a9\u30eb\u30c0\u3092\u958b\u304d\u307e\u3059\u3002\n\n* \\packages\\esp8266\\hardware\\esp8266 \u3068\u8fbf\u308a\u3001 1.6.5-947-g39819f0 \u3068\u3044\u3046\u30d5\u30a9\u30eb\u30c0\u304c\u5b58\u5728\u3059\u308c\u3070\u540c\u3058\u30ea\u30d3\u30b8\u30e7\u30f3\u3067\u3059\u3002\n\n## \u624b\u9806\uff12\uff1aSSL\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30d1\u30c3\u30c1\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u3092\u5dee\u3057\u66ff\u3048\u307e\u3059\u3002\n\n\u3053\u306e\u624b\u9806\u306f\u304a\u305d\u3089\u304f\u6b21\u306eSDK\u306b\u542b\u307e\u308c\u308b\u4e8b\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u65b0\u3057\u3044\u30ea\u30d3\u30b8\u30e7\u30f3\u306e\u30dc\u30fc\u30c9\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u4e00\u65e6\u3053\u306e\u624b\u9806\u3092\u98db\u3070\u3057\u3066\u30b9\u30b1\u30c3\u30c1\u306e\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u516c\u5f0f\u30b5\u30a4\u30c8\u304b\u3089\u300cSDK v1.2.0 Patch for SSL\u300d\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\nhttp://bbs.espressif.com/viewtopic.php?f=5&t=708\n\n\u3088\u304f\u8aad\u3080\u3068\u3001\u4fee\u6b63\u30d1\u30c3\u30c1\u3092\u518d\u30ea\u30ea\u30fc\u30b9\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\uff12\u3064\u76ee\u306e\u30d5\u30a1\u30a4\u30eb( libssl.zip )\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002zip\u30d5\u30a1\u30a4\u30eb\u3092\u89e3\u51cd\u3059\u308b\u3068\u3001libssl.a \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u304c\uff11\u3064\u3060\u3051\u5165\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u6b21\u306e\u30d5\u30a9\u30eb\u30c0\u306b\u5165\u3063\u3066\u3044\u308b\u540c\u540d\u30d5\u30a1\u30a4\u30eb\u306b\u4e0a\u66f8\u304d\u3057\u3066\u5dee\u3057\u66ff\u3048\u307e\u3059\u3002\n\n\\packages\\esp8266\\hardware\\esp8266\\1.6.5-947-g39819f0\\tools\\sdk\\lib\n\n\n\n## \u624b\u9806\uff13\uff1a\u30d3\u30eb\u30c9\u6642\u306bSSL\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u30ea\u30f3\u30af\u3055\u308c\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\u6b21\u306e\u30d5\u30a9\u30eb\u30c0\u3092\u8fbf\u308a\u3001platform.txt \u3092\u958b\u304d\u307e\u3059\u3002\n\n\\packages\\esp8266\\hardware\\esp8266\\1.6.5-947-g39819f0\n\n\u4e0b\u8a18\u306e\u3088\u3046\u306a\u8a18\u8ff0\u3092\u63a2\u3057\u3001\u30ea\u30f3\u30af\u3059\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u306b -lssl \u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\uff0827\u884c\u76ee\u4ed8\u8fd1\u3067\u3059\u3002\uff09\n\n```text:platform.txt\u300027\u884c\u76ee\n\u5909\u66f4\u524d\ncompiler.c.elf.libs=-lm -lgcc -lhal -lphy -lnet80211 -llwip -lwpa -lmain -lpp -lsmartconfig -lwps -lcrypto\n\n\u5909\u66f4\u5f8c\ncompiler.c.elf.libs=-lm -lgcc -lhal -lphy -lnet80211 -llwip -lwpa -lmain -lpp -lsmartconfig -lwps -lcrypto -lssl\n```\n\n# \u30b5\u30f3\u30d7\u30eb\u30b9\u30b1\u30c3\u30c1\u3068\u56de\u8def\u56f3\n\n* ESP-WROOM-02\u306e17\u756a\u30d4\u30f3\u306b\u30bf\u30af\u30c8\u30b9\u30a4\u30c3\u30c1\u3092\u7e4b\u3044\u3067\u300110K\u03a9\u7a0b\u5ea6\u3067\u30d7\u30eb\u30a2\u30c3\u30d7\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n* \u30b9\u30b1\u30c3\u30c1\u5185\u306eWiFi\u30a2\u30af\u30bb\u30b9\u30dd\u30a4\u30f3\u30c8\u306e\u8a2d\u5b9a\u3084\u3001MakerChannel\u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u306e\u5909\u66f4\u3092\u5fd8\u308c\u305a\u306b\u884c\u3063\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u30b9\u30b1\u30c3\u30c1\u304c\u6b63\u3057\u304f\u66f8\u304d\u8fbc\u307e\u308c\u308b\u3068\u3001WiFi\u30a2\u30af\u30bb\u30b9\u30dd\u30a4\u30f3\u30c8\u306b\u63a5\u7d9a\u3057\u305f\u306e\u3061\u3001\uff11\u5ea6\u3060\u3051MakerChannel\u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u3002\u305d\u306e\u5f8c\u3001\u30bf\u30af\u30c8\u30b9\u30a4\u30c3\u30c1\u304c\u62bc\u3055\u308c\u308b\u307e\u3067\u5f85\u6a5f\u3057\u3001\u62bc\u3055\u308c\u305f\u3089MakerChannel\u3092\u547c\u3073\u51fa\u3059\u52d5\u4f5c\u3092\u7e70\u308a\u8fd4\u3057\u307e\u3059\u3002\n\n\n```c:IFTTT_with_SSL.ino\n/**\n *  ESP-WROOM-02\n *  SSL/TLS\u3067\u3001IFTTT MakerChannel\u3092\u547c\u3073\u51fa\u3059\u30b9\u30b1\u30c3\u30c1\n *  \n *  \u6ce8\u610f\n *  \u30fbDNS\u304b\u3089IP\u30a2\u30c9\u30ec\u30b9\u3092\u53d6\u5f97\u305b\u305a\u3001\u76f4\u63a5IP\u30a2\u30c9\u30ec\u30b9\u3092\u30b9\u30b1\u30c3\u30c1\u306b\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\n *  \u30fbSSL/TLS\u30b9\u30bf\u30c3\u30af\u306b\u30db\u30b9\u30c8\u540d\u3092\u6e21\u3057\u3066\u3001\u8a3c\u660e\u66f8\u3092\u691c\u8a3c\u3059\u308b\u65b9\u6cd5\u304c\u5206\u304b\u3063\u3066\u3044\u307e\u305b\u3093\u3002\n *  \u30fb\u305d\u306e\u305f\u3081\u3001\u304b\u306a\u308a\u9069\u5f53\u306a\u30aa\u30ec\u30aa\u30ec\u8a3c\u660e\u66f8\u3067\u3082\u96e3\u306a\u304f\u901a\u904e\u3057\u3066\u3057\u307e\u3046\u3067\u3057\u3087\u3046\u3002(^_^;)\n */\n\n#ifdef ESP8266\nextern \"C\" {\n#include \"ip_addr.h\"\n#include \"espconn.h\"\n#include \"user_interface.h\"\n}\n#endif\n\n#include <ESP8266WiFi.h>\n\n// \u8a3c\u660e\u66f8\u30b9\u30c8\u30a2\nunsigned char default_certificate[] = {};\nunsigned int  default_certificate_len = 0;\nunsigned char default_private_key[] = {};\nunsigned int  default_private_key_len = 0;\n\n// WiFi\u30a2\u30af\u30bb\u30b9\u30dd\u30a4\u30f3\u30c8\u306e\u8a2d\u5b9a\nconst char* ssid     = \"mbed_ap\";\nconst char* password = \"password1234\";\n\n// IFTTT MakerChannel\u306e\u8a2d\u5b9a\nconst char* host        = \"maker.ifttt.com\";\nconst char* secret_key  = \"dummyaXaYaRalatafa8ava\";\n\n// \u6295\u7a3f\u30dc\u30bf\u30f3\u306e\u8a2d\u5b9a = IO16\n//  ESP-WROOM-02\u306e\u30d4\u30f3\u3067\u306f 17\u756a \u306a\u306e\u3067\u6ce8\u610f\u3002\nconst int buttonPin = 16;\n\n// \u30c7\u30fc\u30bf\u53d7\u4fe1\u30d0\u30c3\u30d5\u30a1\u3068\u30dd\u30a4\u30f3\u30bf\nchar  recvbuffer[2048];\nchar* recvbuffer_pos;\n\nLOCAL struct espconn esp;\nLOCAL struct _esp_tcp tcp;\n\nvoid setup() {\n  Serial.begin(115200);\n  delay(10);\n\n  // \u6295\u7a3f\u30dc\u30bf\u30f3\u306e\u8a2d\u5b9a\n  pinMode(buttonPin, INPUT);\n\n  Serial.print(\"Connecting to \");\n  Serial.println(ssid);\n\n  // \u30a2\u30af\u30bb\u30b9\u30dd\u30a4\u30f3\u30c8\u306b\u63a5\u7d9a\n  WiFi.begin(ssid, password);\n  while (WiFi.status() != WL_CONNECTED) {\n    delay(500);\n    Serial.print(\".\");\n  }\n\n  Serial.println(\"connected\");  \n  Serial.print(\"IP address: \");\n  Serial.println(WiFi.localIP());\n}\n\nvoid connect_cb(void *arg) {\n  Serial.println(\"connect_cb\");\n}\nvoid reconnect_cb(void *arg, sint8 err) {\n  Serial.print(\"reconnect_cb: \");\n  Serial.println(err);\n}\nvoid disconnect_cb(void *arg) {\n  Serial.println(\"disconnect_cb\");\n}\n\nvoid recv_cb(void *arg, char *pdata, unsigned short len) {\n  Serial.print(\"recv_cb:\");\n  Serial.println(len);\n  memcpy(recvbuffer_pos, pdata, len);\n  recvbuffer_pos += len;\n}\nvoid sent_cb(void *arg) {\n  Serial.println(\"sent_cb\");\n}\n\nvoid loop() {\n  Serial.print(\"connecting to \");\n  Serial.println(host);\n\n  tcp.local_ip[0] = 0;\n  tcp.local_ip[1] = 0;\n  tcp.local_ip[2] = 0;\n  tcp.local_ip[3] = 0;\n  tcp.local_port = espconn_port();\n\n  tcp.remote_ip[0] = 54;   //maker.ifttt.com = 54.243.120.63\n  tcp.remote_ip[1] = 243;\n  tcp.remote_ip[2] = 120;\n  tcp.remote_ip[3] = 63;\n  tcp.remote_port = 443;\n\n  esp.type  = ESPCONN_TCP;\n  esp.state = ESPCONN_NONE;\n  esp.proto.tcp = &tcp;\n\n  // \u63a5\u7d9a\u30fb\u5207\u65ad\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3092\u8a2d\u5b9a\n  espconn_regist_connectcb(&esp, connect_cb);\n  espconn_regist_reconcb(&esp, reconnect_cb);\n  espconn_regist_disconcb(&esp, disconnect_cb);\n\n  // \u30c7\u30fc\u30bf\u9001\u53d7\u4fe1\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3092\u8a2d\u5b9a\n  espconn_regist_recvcb(&esp, recv_cb);\n  espconn_regist_sentcb(&esp, sent_cb);\n\n  // SSL/TLS\u3067\u4f7f\u7528\u3059\u308b\u30d0\u30c3\u30d5\u30a1\u30b5\u30a4\u30ba\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u4e0d\u8db3\u3059\u308b\u305f\u3081\u30b5\u30a4\u30ba\u3092\u5909\u66f4\n  //  http://bbs.espressif.com/viewtopic.php?t=548\n  espconn_secure_set_size(ESPCONN_CLIENT, 5120);\n\n  // \u30b5\u30fc\u30d0\u306b\u63a5\u7d9a\n  Serial.print( \"espconn_secure_connect = \");\n  Serial.println(espconn_secure_connect(&esp));\n\n  // \u63a5\u7d9a\u5f85\u3061\n  while(esp.state != ESPCONN_CONNECT) {\n    delay(100);\n  }\n\n  String url = String(\"/trigger/test/with/key/\") + secret_key + \"?value1=0&value2=0&value3=0\";\n\n  Serial.print(\"Requesting URL: \");\n  Serial.println(url);\n  \n  String data = String(\"GET \") + url + \" HTTP/1.1\\r\\n\" +\n               \"Host: \" + host + \"\\r\\n\" + \n               \"Connection: close\\r\\n\\r\\n\";\n               \n  char senddata[512];\n  data.toCharArray(senddata, sizeof(senddata));\n  Serial.println(senddata);\n\n  // \u53d7\u4fe1\u30d0\u30c3\u30d5\u30a1\u3092\u521d\u671f\u5316\n  recvbuffer_pos = recvbuffer;\n\n  // \u30c7\u30fc\u30bf\u9001\u4fe1\n  Serial.print( \"espconn_secure_sent = \");\n  Serial.println(espconn_secure_sent(&esp, (uint8*)senddata, strlen(senddata)));\n  delay(10);\n\n  // \u5fdc\u7b54\u306e\u53d7\u4fe1\u5b8c\u4e86\u5f85\u3061\n  while(esp.state != ESPCONN_CLOSE) {\n    delay(100);\n  }\n\n  // \u53d7\u4fe1\u3057\u305f\u30c7\u30fc\u30bf\u3092\u51fa\u529b\n  recvbuffer_pos = '\\0';\n  Serial.println(recvbuffer);\n\n  // \uff08\u904e\u5ea6\u306a\u9023\u7d9a\u6295\u7a3f\u3092\u907f\u3051\u308b\u305f\u3081\u3001\u5c11\u3057\u30a6\u30a7\u30a4\u30c8\u3092\u5165\u308c\u308b\uff09\n  Serial.println(\"delay wait ...\");\n  delay(5000);\n\n  // \u5b9f\u884c\u30dc\u30bf\u30f3\u304c\u62bc\u3055\u308c\u308b\u307e\u3067\u5f85\u6a5f\n  Serial.println(\"button wait ...\");\n  while(digitalRead(buttonPin) == HIGH) {\n    delay(10);\n  }\n}\n```\n\n# \u6700\u5f8c\u306b\u30fb\u30fb\u30fb\n\nWDT\u304c\u53b3\u3057\u3044\u306e\u3067\u3001\u3061\u3087\u3063\u3068\u9577\u3081\u306e\u51e6\u7406\u3092\u884c\u3046\u3068\u30b9\u30bf\u30c3\u30af\u3092\u30c0\u30f3\u30d7\u3057\u3066\u843d\u3061\u307e\u3059\u3002\u51e6\u7406\u3092\u77ed\u3081\u306b\u5de5\u592b\u3057\u305f\u308a\u3001delay(1);\u3092\u633f\u5165\u3059\u308b\u306a\u3069\u3067\u5bfe\u51e6\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff08\u7279\u306bfor\u3084while\u3092\u4f7f\u3046\u3068WDT\u306b\u565b\u307e\u308c\u3084\u3059\u3044\u3067\u3059\u3002\uff09\n\n", "tags": ["ESP-WROOM-02", "ESP8266", "SSL"]}