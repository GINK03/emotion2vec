{"context": "\n\ndgl\u3063\u3066\u4f55\uff1f\nGitHub\u306e\u30da\u30fc\u30b8\u306f\u3053\u3061\u3089\nhttps://github.com/gecko0307/dgl\nD\u8a00\u8a9e\u3067\u5b9f\u88c5\u3055\u308c\u305f\u3001OpenGL\u3092\u4f7f\u3063\u305f\u30b0\u30e9\u30d5\u30a3\u30c3\u30af\u30b9\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002\n\u4eca\u306e\u30b2\u30fc\u30e0\u696d\u754c\u3067\u306f\u4e00\u822c\u7684\u306b\u306a\u3063\u3066\u3044\u308b\u7269\u7406\u30d9\u30fc\u30b9\u3068\u547c\u3070\u308c\u308b\u8003\u3048\u65b9\u3067\u3001\u7d20\u6750\u3084\u5149\u6e90\u306a\u3069\u3092\u8a08\u7b97\u3057\u3066\u63cf\u753b\u3057\u307e\u3059\u3002\nGithub\u306eREADME\u306b\u66f8\u304b\u308c\u3066\u3044\u308b\u7279\u5fb4\u3068\u3057\u3066\u306f\u4ee5\u4e0b\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u5b8c\u5168\u306bGC\u30d5\u30ea\u30fc\nWindows, Linux, OSX and FreeBSD\u3092\u30b5\u30dd\u30fc\u30c8\n\u30e6\u30fc\u30b6\u30fc\u5b9a\u7fa9\u306e\u30a4\u30d9\u30f3\u30c8\u30b7\u30b9\u30c6\u30e0\u3068Unicode\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u305f\u30ad\u30fc\u30dc\u30fc\u30c9\u5165\u529b\n\u30b9\u30ec\u30c3\u30c9\u3067\u30ed\u30fc\u30c9\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u30de\u30cd\u30fc\u30b8\u30e3\u30fc\n\u72ec\u81ea\u30b7\u30fc\u30f3\u30d5\u30a1\u30a4\u30eb\u30d5\u30a9\u30fc\u30de\u30c3\u30c8(DGL3) \u3092Blender\u304b\u3089\u306e\u51fa\u529b\u306b\u5bfe\u5fdc\n\u30c6\u30af\u30b9\u30c1\u30e3\u3092PNG\u5f62\u5f0f\u3067\u30ed\u30fc\u30c9\n\u30de\u30c6\u30ea\u30a2\u30eb\u60c5\u5831\u306f\u4eba\u306e\u8aad\u307f\u3084\u3059\u3044\u5f62\u306e\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3067\u30ed\u30fc\u30c9\n\u52d5\u7684\u30bd\u30d5\u30c8\u30b7\u30e3\u30c9\u30a6\n\u7121\u5236\u9650\u306e\u52d5\u7684\u5149\u6e90\nGLSL shaders\n\u30ce\u30fc\u30de\u30eb\u30de\u30c3\u30d7\u3068\u8996\u5dee\u30de\u30c3\u30d7\u3092\u30b5\u30dd\u30fc\u30c8\n\u30a4\u30e1\u30fc\u30b8\u30d9\u30fc\u30b9\u30e9\u30a4\u30c6\u30a3\u30f3\u30b0\n\u7269\u7406\u30d9\u30fc\u30b9\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0 (PBR)\n2D,3D\u306e\u7121\u5236\u9650\u306e\u30ec\u30f3\u30c0\u30fc\u30d1\u30b9\n\u30ec\u30f3\u30c0\u30fc\u30c6\u30af\u30b9\u30c1\u30e3\u30fc\u306e\u30b5\u30dd\u30fc\u30c8\n\u30a2\u30f3\u30c1\u30a8\u30a4\u30ea\u30a2\u30b9\n\u8ffd\u5c3e\u30ab\u30e1\u30e9\u3092\u6a19\u6e96\u88c5\u5099\n3D geometric shapes\n\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u3059\u308b2D\u30b9\u30d7\u30e9\u30a4\u30c8\n\u30e6\u30cb\u30b3\u30fc\u30c9\u30b5\u30dd\u30fc\u30c8\u3057\u305fTTF\u30d5\u30a9\u30f3\u30c8\u306e2D\u30c6\u30ad\u30b9\u30c8\u63cf\u753b\nVFS\n\u8a2d\u5b9a\u30b3\u30f3\u30d5\u30a3\u30b0\u642d\u8f09\n\n\n\u30b5\u30f3\u30d7\u30eb\u306e\u30d3\u30eb\u30c9\n\u30b5\u30f3\u30d7\u30eb\u306b\n\nminimal.d\npbr.d\ntexio.d\n\n\u304c\u3042\u308a\u307e\u3059\u304c\u3001pbr.d\u304c\u30e2\u30c7\u30eb\u3092\u8868\u793a\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u306e\u306a\u306e\u3067\u3001\u3053\u3061\u3089\u3092\u30d3\u30eb\u30c9\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u30a4\u30ab\u30b9\u9283\u304c\u8868\u793a\u3055\u308c\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u5143\u306bD\u8a00\u8a9e\u304f\u3093\u3092\u8868\u793a\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u305d\u308c\u306b\u306f\u307e\u305a\u3001D\u8a00\u8a9e\u304f\u3093\u3092dgl\u3067\u8aad\u3081\u308b\u5f62\u5f0f\u3067\u51fa\u529b\u3057\u76f4\u3059\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u30e2\u30c7\u30eb\u30c7\u30fc\u30bf\u306e\u4f5c\u6210\ndgl\u306fOBJ\u3084FBX\u306e\u3088\u3046\u306a\u4e00\u822c\u7684\u306a\u30e2\u30c7\u30eb\u30c7\u30fc\u30bf\u306f\u8aad\u307f\u8fbc\u3081\u307e\u305b\u3093\u3002\nBlender\u304b\u3089\u306e\u30a8\u30af\u30b9\u30dd\u30fc\u30bf\u30fc\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u307e\u305a\u306fD\u8a00\u8a9e\u304f\u3093\u306e\u30e2\u30c7\u30eb\u30c7\u30fc\u30bf\u3092Blender\u3067\u8aad\u307f\u8fbc\u3081\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u30c7\u30fc\u30bf\u306f\uff72\u4e94\u3055\u3093\u306e\u4f5c\u3089\u308c\u305f\u30e2\u30c7\u30eb\nhttps://onedrive.live.com/?cid=F7E340CFC6666A27&id=F7E340CFC6666A27%21574\n\u3092\u304a\u501f\u308a\u3057\u307e\u3059\u3002\nD\u8a00\u8a9e\u304f\u3093\u306e\u30e2\u30c7\u30eb\u30c7\u30fc\u30bf\u306f\u3001pmd\u5f62\u5f0f\u3068FBX\u5f62\u5f0f\u3068mqo\u5f62\u5f0f\u3067\u914d\u5e03\u3055\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u3053\u308c\u3092\u306a\u3093\u3068\u304b\u3057\u3066Blender\u306b\u8aad\u307f\u8fbc\u307e\u305b\u308b\u3068\u3044\u3046\u3001D\u8a00\u8a9e\u3068\u306f\u307e\u3063\u305f\u304f\u95a2\u4fc2\u306a\u3044\u6240\u3067\u9811\u5f35\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nFBX\u3067\u8aad\u307f\u8fbc\u3080\nFBX\u306e\u30c7\u30fc\u30bf\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c6.1\u3068\u53e4\u304f\u3066\u8aad\u307f\u8fbc\u3081\u306a\u304b\u3063\u305f\u3002\nFBX Converter\u3067\u51fa\u529b\u3057\u76f4\u3057\u3066\u307f\u307e\u3057\u305f\u304c\u3001\u305d\u306e\u30c7\u30fc\u30bf\u3092Blender\u3067\u8aad\u307f\u8fbc\u3080\u3068\u3001\u4f55\u6545\u304bBlender\u304c\u30d5\u30ea\u30fc\u30ba\u3057\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u4eca\u306e\u3068\u3053\u308d\u89e3\u6c7a\u65b9\u6cd5\u304c\u898b\u3064\u304b\u3063\u3066\u307e\u305b\u3093\u3002\n\nmqo\u3067\u8aad\u307f\u8fbc\u3080\n\u30e1\u30bf\u30bb\u30b3\u30a4\u30a2\u5f62\u5f0f\u3092Blender\u3067\u8aad\u307f\u8fbc\u3080\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u3001\u3053\u3061\u3089\nhttp://nullorempry.jimdo.com/work-list/blender2-5-2-7/mqo/\n\u3067\u516c\u958b\u3055\u308c\u3066\u3044\u305f\u306e\u3067\u3092\u4f7f\u3063\u3066\u307f\u305f\u306e\u3067\u3059\u304c\u3001\u6b63\u3057\u304f\u8aad\u307f\u8fbc\u307e\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u3063\u3066\u304b\u3001\u541b\u306f\u8ab0\uff1f\n\n\npmd\u3067\u8aad\u307f\u8fbc\u3080\n\u3053\u3061\u3089\u306e\u30c4\u30fc\u30eb\nhttps://github.com/sugiany/blender_mmd_tools\n\u3092\u4f7f\u3046\u3068\u6b63\u3057\u304f\u30a4\u30f3\u30dd\u30fc\u30c8\u51fa\u6765\u307e\u3057\u305f\u3002\n\uff08\u696d\u754c\u6a19\u6e96\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306efbx\u3068\u306f\u4e00\u4f53\u30fb\u30fb\u30fb\uff09\n\u305f\u3060\u3001\u30c6\u30af\u30b9\u30c1\u30e3\u30fc\u304c\u8cbc\u3089\u308c\u3066\u3044\u306a\u3044\u3088\u3046\u306a\u306e\u3067\u3059\u304c\u3001\u30de\u30c6\u30ea\u30a2\u30eb\u60c5\u5831\u306f\u5225\u306b\u30c6\u30ad\u30b9\u30c8\u3067\u66f8\u304f\u306e\u3067\u3001\u4eca\u56de\u306f\u554f\u984c\u7121\u3055\u305d\u3046\u3067\u3059\u3002\n\n\u30e2\u30c7\u30eb\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u8fbc\u307f\npbr.d\u3092\u6539\u9020\u3057\u3066\u3001D\u8a00\u8a9e\u304f\u3093\u3092\u8aad\u307f\u8fbc\u3081\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\ndata\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4ee5\u4e0b\u306b\u3001d_man\u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001\u51fa\u529b\u3055\u308c\u305fd_man.dgl3\u3068\u30c6\u30af\u30b9\u30c1\u30e3\u306ed_man.png\u3092\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\u30de\u30c6\u30ea\u30a2\u30eb\u60c5\u5831\u306f\u30c6\u30ad\u30b9\u30c8\u306a\u306e\u3067\u3001Material0.mat\u3068\u3044\u3046\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308a\u3001\u3068\u308a\u3042\u3048\u305a\nname: \"Material0\";\nambientColor: [0.3, 0.4, 0.5, 1.0];\ndiffuseColor: [1.0, 1.0, 1.0, 1.0];\nspecularColor: [1.0, 1.0, 1.0, 1.0];\nemissionColor: [0.0, 0.0, 0.0, 1.0];\nroughness: 0.5;\nspecularity: 0.7;\ndiffuseTexture: \"d_man.png\"; \n\u3068\u8a18\u5165\u3057\u3066\u304f\u3060\u3055\u3044\u3002\ndgl\u306f\u4eee\u60f3\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306e\u4ed5\u7d44\u307f\u304c\u3042\u308a\u3001\u30a2\u30bb\u30c3\u30c8\u306e\u8aad\u307f\u8fbc\u307f\u6642\u306b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u6307\u5b9a\u3092\u7701\u7565\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u308b\u306e\u3067\u3001\u5148\u7a0b\u4f5c\u6210\u3057\u305fd_man\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3082\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\npbr.d\n    mountDirectory(\"data\");\n    mountDirectory(\"data/cerberus\");\n    mountDirectory(\"data/d_man\");//\u8ffd\u52a0\n\n\n\u305d\u3057\u3066\u3001cerberus.dgl3\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u308b\u6240\u3092d\u8a00\u8a9e\u304f\u3093\u3092\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\npbr.d\n//  model = addModelResource(\"cerberus.dgl3\");\n    model = addModelResource(\"d_man.dgl3\");\n\n\n\u3053\u308c\u3067\u30d3\u30eb\u30c9\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u30db\u30a4\u30fc\u30eb\u3067\u30ab\u30e1\u30e9\u3092\u8fd1\u3065\u3051\u3089\u308c\u308b\u306e\u3067\u3001\u597d\u304d\u306a\u3060\u3051D\u8a00\u8a9e\u304f\u3093\u3092\u611b\u3067\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\n\u3082\u3063\u3068\u7269\u7406\u30d9\u30fc\u30b9\u3063\u307d\u304f\n\u305b\u3063\u304b\u304f\u7269\u7406\u30d9\u30fc\u30b9\u306e\u63cf\u753b\u30b7\u30b9\u30c6\u30e0\u304c\u4f7f\u308f\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u624b\u3092\u52a0\u3048\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\u304a\u624b\u8efd\u306a\u6240\u3067\u3001\u30c6\u30af\u30b9\u30c1\u30e3\u3092\u8ffd\u52a0\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\nd_man.png\u3092\u30b3\u30d4\u30fc\u3057\u3066\u3001d_man_2.png\u3068\u3044\u3046\u540d\u524d\u306b\u3057\u3066\u30da\u30a4\u30f3\u30c8\u3067\u958b\u304d\u3001\u4e2d\u8eab\u3092\u5168\u90e8\u767d\u306b\u3057\u3066\u3057\u307e\u3044\u307e\u3057\u3087\u3046\u3002\n\u5148\u7a0b\u4f5c\u6210\u3057\u305fMaterial0.mat\u306b\u3001\nmetallicTexture: \"d_man_2.png\";\n\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\nmetallicTexture\u3068\u3044\u3046\u306e\u306f\u3001\u3069\u308c\u304f\u3089\u3044\u91d1\u5c5e\u7684\u304b\u3092\u8868\u3059\u30c7\u30fc\u30bf\u3092\u5165\u308c\u305f\u30c6\u30af\u30b9\u30c1\u30e3\u3067\u3001\u3069\u308c\u304f\u3089\u3044\u5149\u3092\u53cd\u5c04\u3059\u308b\u304b\u306e\u60c5\u5831\u306b\u306a\u308a\u307e\u3059\u3002\n\u5148\u7a0b\u771f\u3063\u767d\u306b\u3057\u305f\u306e\u3067\u3001\u53cd\u5c04\u7387\u304c1.0\u306e\u5168\u53cd\u5c04\u306b\u306a\u308a\u307e\u3059\u3002\n\u3053\u306e\u72b6\u614b\u3067\u3001\u3082\u3046\u4e00\u5ea6\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u306f\u3044\u3001\u5468\u308a\u306e\u666f\u8272\u304c\u5199\u308a\u8fbc\u3093\u3067\u3001\u3064\u3084\u3064\u3084\u30e1\u30bf\u30ea\u30c3\u30af\u306aD\u8a00\u8a9e\u304f\u3093\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\u5149\u6e90\u3092\u7f6e\u3044\u3066\u307f\u3088\u3046\n\u7121\u5236\u9650\u306b\u52d5\u7684\u5149\u6e90\u304c\u7f6e\u3051\u308b\u306e\u304c\u30a6\u30ea\u306e\u4e00\u3064\u306a\u306e\u3067\u3001\u305b\u3063\u304b\u304f\u3060\u304b\u3089\u70b9\u5149\u6e90\u3092\u7f6e\u3044\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u30e9\u30a4\u30c8\u306e\u8ffd\u52a0\npointLight\u3092\u4f5c\u6210\u3057\u3066\u3001Application3D\u304c\u6301\u3063\u3066\u3044\u308bLightManager\u306b\u8ffd\u52a0\u3059\u308b\u3068\u3001\u70b9\u5149\u6e90\u304c\u30b7\u30fc\u30f3\u306b\u53cd\u6620\u3055\u308c\u307e\u3059\u3002\npointLight\u306e\u7b2c\u4e00\u5f15\u6570\u306f\u4f4d\u7f6e\u3067\u3001\u7b2c\u4e8c\u306f\u62e1\u6563\u5149\u3001\u7b2c\u4e09\u306f\u74b0\u5883\u5149\u306e\u8272\u306b\u306a\u308a\u307e\u3059\u3002\n\u70b9\u5149\u6e90\u306a\u306e\u306b\u74b0\u5883\u5149\u306e\u8a2d\u5b9a\u304c\u3042\u308b\u306e\u304c\u3088\u304f\u5206\u304b\u3089\u306a\u3044\u3068\u3053\u308d\u3067\u3059\u304c\u3001\u5e73\u884c\u5149\u6e90\u3068\u540c\u3058\u5f15\u6570\u3092\u4f7f\u3063\u3066\u308b\u3060\u3051\u306a\u306e\u304b\u3082\uff1f\n\n\u30a4\u30d9\u30f3\u30c8\ndgl\u306f\u5185\u90e8\u3067SDL\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u306e\u3067\u3001SDL\u306e\u30a4\u30d9\u30f3\u30c8\u3092\u4f7f\u3046\u3053\u3068\u304c\u51fa\u6765\u308b\u30af\u30e9\u30b9\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nApplication3D\u304c\u6301\u3063\u3066\u3044\u308bEventManager\u306bEventListener\u3092\u6d3e\u751f\u3057\u305f\u30af\u30e9\u30b9\u3092\u767b\u9332\u3057\u3001\u305d\u306e\u30af\u30e9\u30b9\u3067\u30a4\u30f3\u30d9\u30f3\u30c8\u3092\u51e6\u7406\u3057\u307e\u3059\u3002\n\u5177\u4f53\u7684\u306a\u4f8b\u3068\u3057\u3066\u3001\u30b9\u30da\u30fc\u30b9\u30ad\u30fc\u304c\u70b9\u5149\u6e90\u306e\u4f4d\u7f6e\u304cY\u65b9\u5411\u306b\uff11\uff10\u5ea6\u79fb\u52d5\u3059\u308b\u30af\u30e9\u30b9\u306f\u4ee5\u4e0b\u306b\u306a\u308a\u307e\u3059\u3002\n\npbr.d\nclass LightListener: EventListener\n{\n    Light light;\n    Vector3f pos;\n    float degree = 0.0f;\n    this(EventManager emngr, LightManager lightManager, Vector3f in_pos, Color4f in_col)\n    {\n        super(emngr);\n        pos = in_pos;\n        light = lightManager.addLight(pointLight(in_pos, in_col, Color4f(0.1f, 0.1f, 0.1f, 1.0f)));\n    }\n\n    ~this()\n    {\n        Delete(light);\n    }\n\n    override void onKeyDown(int key)\n    {\n        if (key == SDLK_SPACE)\n        {\n            degree += 10.0f;\n            float rad = degree*3.14f/180.0f;\n            light.position = Vector3f(pos.x, pos.y*std.math.cos(rad), pos.z);\n        }\n    }\n}\n\n\n\u3053\u308c\u3092\u767b\u9332\u3059\u308b\u30ea\u30b9\u30c8\u3092Simple3DApp\u306e\u30e1\u30f3\u30d0\u30fc\u306b\u6301\u305f\u305b\u307e\u3059\u3002\n\u305b\u3063\u304b\u304f\u306a\u3093\u3067\u3001\u30e9\u30a4\u30d6\u30e9\u30ea\u5074\u3067\u7528\u610f\u3057\u3066\u308b\u30ea\u30b9\u30c8\u3092\u4f7f\u3044\u307e\u3059\u3002\nDynamicArray!LightListener pointLights;\n\u3053\u308c\u306b\u5bfe\u3057\u3066\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5f62\u3067\u3001\u30e9\u30a4\u30c8\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\npbr.d\n        LightListener light1 = New!LightListener(eventManager, lightManager, Vector3f(0.0, -5.0, 0.0), Color4f(0.0f, 1.0f, 1.0f, 1.0f));\n        LightListener light2 = New!LightListener(eventManager, lightManager, Vector3f(0.0, 5.0, 0.0), Color4f(0.0f, 1.0f, 1.0f, 1.0f));\n        pointLights.append(light1);\n        pointLights.append(light2);\n\n\n\u3042\u3068\u306f\u3001onUpdate\u95a2\u6570\u306e\u4e2d\u3067\u3001\u5404\u30e9\u30a4\u30c8\u306b\u5bfe\u3057\u3066\u30a4\u30d9\u30f3\u30c8\u51e6\u7406\u3092\u5b9f\u884c\u3059\u308b\u3088\u3046\u306bprocessEvents\u95a2\u6570\u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u3002\n\npbr.d\n        foreach(light;pointLights)\n        {\n            light.processEvents();\n        }\n\n\n\u3053\u308c\u3067\u3001\u30b9\u30da\u30fc\u30b9\u30ad\u30fc\u3092\u62bc\u3057\u305f\u30a4\u30d9\u30f3\u30c8\u304c\u51e6\u7406\u3055\u308c\u3066\u3001\u5149\u6e90\u304c\u52d5\u304f\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n\u307e\u3068\u3081\n\u30c7\u30fc\u30bf\u306e\u51fa\u529b\u3068\u3044\u3046D\u8a00\u8a9e\u3068\u5168\u7136\u95a2\u4fc2\u306a\u3044\u6240\u3067\u6642\u9593\u304c\u53d6\u3089\u308c\u3066\u3057\u307e\u3044\u3001\u3042\u307e\u308a\u8a73\u3057\u3044\u8aac\u660e\u304c\u66f8\u3051\u306a\u304f\u3066\u3001\u3054\u3081\u3093\u306a\u3055\u3044\u3002\ndgl\u306f\u3001\u540c\u3058\u4f5c\u8005\u304c\u4f5c\u3063\u305fdlib\u3068\u3044\u3046\u30e9\u30a4\u30d6\u30e9\u30ea\u7fa4\u304c\u4f7f\u308f\u308c\u3066\u3044\u307e\u3059\u3002\n\u7d50\u69cb\u306a\u91cf\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3001GC\u30d5\u30ea\u30fc\u306e\u30b3\u30f3\u30c6\u30ca\u3084\u8a08\u7b97\u30e9\u30a4\u30d6\u30e9\u30ea\u3084\u753b\u50cf\u30ed\u30fc\u30c0\u30fc\u7b49\u63c3\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u8aad\u3093\u3067\u307f\u308b\u3068\u9762\u767d\u3044\u3068\u601d\u3044\u307e\u3059\u3002\ndgl\u306b\u306f\u307e\u3060\u30e2\u30fc\u30b7\u30e7\u30f3\u518d\u751f\u306a\u3069\u7121\u3044\u3067\u3059\u304c\u3001\u5c06\u6765\u306fIQM(Inter-Quake Model \uff09\u3068\u3044\u3046\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3001\u30e2\u30fc\u30b7\u30e7\u30f3\u518d\u751f\u3092\u3059\u308b\u4e88\u5b9a\u307f\u305f\u3044\u3067\u3059\u3002\n\u3042\u3068\u306f\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u307b\u307c\u7121\u3044\u306e\u3067\u3001\u4f55\u3092\u3084\u308b\u306b\u3082\u30b3\u30fc\u30c9\u3092\u8aad\u307e\u306a\u304d\u3083\u3044\u3051\u306a\u3044\u306e\u304c\u3001\u7d50\u69cb\u5927\u5909\u3067\u3059\u3002\n\u540c\u3058\u4f5c\u8005\u304cdmech\u3044\u3046\u7269\u7406\u30a8\u30f3\u30b8\u30f3\u30e9\u30a4\u30d6\u30e9\u30ea\u3082\u4f5c\u3063\u3066\u3044\u3066\u3001\u305d\u308c\u3068dgl\u3092\u7d44\u307f\u5408\u308f\u305b\u305f\u3001atrium\u3068\u3044\u3046\u30b2\u30fc\u30e0\n\u3092\u4f5c\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u3061\u3089\u3092\u53c2\u8003\u306b\u3059\u308b\u3068\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\u6a5f\u80fd\u306f\u305d\u308c\u306a\u308a\u306b\u63c3\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u30e2\u30fc\u30b7\u30e7\u30f3\u518d\u751f\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u305f\u3089\u3001\u5272\u308a\u3068\u4f7f\u3048\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u306b\u306a\u308a\u305d\u3046\u306a\u6c17\u304c\u3057\u307e\u3059\u3002\n\u305f\u3060\u3001\u5b8c\u5168\u306bGC\u30d5\u30ea\u30fc\u306a\u306e\u3092\u30a6\u30ea\u306b\u3057\u3066\u308b\u306e\u3067\u3001\u958b\u653e\u306f\u5e38\u306b\u81ea\u5206\u3067\u3084\u3089\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u306e\u3067\u3001\u6163\u308c\u304c\u5fc5\u8981\u306b\u306a\u308a\u305d\u3046\u3067\u3059\u3002\n\u6700\u5f8c\u306b\u3001\u6700\u7d42\u7684\u306a\u30b3\u30fc\u30c9\u3092\u8cbc\u3063\u3066\u304a\u304d\u307e\u3059\u3002\n\npbr.d\n/*\nCopyright (c) 2016 Timur Gafarov \n\nBoost Software License - Version 1.0 - August 17th, 2003\n\nPermission is hereby granted, free of charge, to any person or organization\nobtaining a copy of the software and accompanying documentation covered by\nthis license (the \"Software\") to use, reproduce, display, distribute,\nexecute, and transmit the Software, and to prepare derivative works of the\nSoftware, and to permit third-parties to whom the Software is furnished to\ndo so, all subject to the following:\n\nThe copyright notices in the Software and this entire statement, including\nthe above license grant, this restriction and the following disclaimer,\nmust be included in all copies of the Software, in whole or in part, and\nall derivative works of the Software, unless such copies or derivative\nworks are solely in the form of machine-executable object code generated by\na source language processor.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE, TITLE AND NON-INFRINGEMENT. IN NO EVENT\nSHALL THE COPYRIGHT HOLDERS OR ANYONE DISTRIBUTING THE SOFTWARE BE LIABLE\nFOR ANY DAMAGES OR OTHER LIABILITY, WHETHER IN CONTRACT, TORT OR OTHERWISE,\nARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\nDEALINGS IN THE SOFTWARE.\n*/\n\nmodule pbr;\n\nimport std.stdio;\nimport std.math;\n\nimport dlib.core.memory;\nimport dlib.core.stream;\nimport dlib.math.vector;\nimport dlib.math.affine;\nimport dlib.math.quaternion;\nimport dlib.math.utils;\nimport dlib.image.color;\nimport dlib.filesystem.filesystem;\n\nimport dgl.core.api;\nimport dgl.core.event;\nimport dgl.core.application;\nimport dgl.core.interfaces;\n\nimport dgl.templates.app3d;\nimport dgl.templates.freeview;\n\nimport dgl.graphics.entity;\nimport dgl.graphics.camera;\nimport dgl.graphics.shapes;\nimport dgl.graphics.material;\nimport dgl.graphics.texture;\nimport dgl.graphics.shader;\nimport dgl.graphics.shadow;\nimport dgl.graphics.state;\nimport dgl.graphics.light;\nimport dgl.graphics.pbrshader;\n\nimport dgl.asset.dgl3;\nimport dgl.asset.envtexture;\n\nimport dlib.container.array;\n\nclass EnvironmentSphere: Drawable\n{\n    Camera camera;\n    ShapeSphere sphere;\n    float radius = 50.0f;\n\n    this(Camera cam)\n    {\n        camera = cam;\n        sphere = New!ShapeSphere(1);\n    }\n\n    void draw(double dt)\n    {\n        glPushMatrix();\n        Vector3f pos = camera.getTransformation.translation;\n        glTranslatef(pos.x, pos.y, pos.z);\n        glRotatef(180.0f, 0, 1, 0);\n        glRotatef(-90.0f, 1, 0, 0);\n        glScalef(-radius, -radius, -radius);\n        glDisable(GL_LIGHTING);\n        glDepthMask(GL_FALSE);\n        sphere.draw(dt);\n        glDepthMask(GL_TRUE);\n        glEnable(GL_LIGHTING);\n        glPopMatrix();\n    }\n\n    ~this()\n    {\n        Delete(sphere);\n    }\n}\n\nclass LightListener: EventListener\n{\n    Light light;\n    Vector3f pos;\n    float degree = 0.0f;\n    this(EventManager emngr, LightManager lightManager, Vector3f in_pos, Color4f in_col)\n    {\n        super(emngr);\n        pos = in_pos;\n        light = lightManager.addLight(pointLight(in_pos, in_col, Color4f(0.1f, 0.1f, 0.1f, 1.0f)));\n    }\n\n    ~this()\n    {\n        Delete(light);\n    }\n\n    override void onKeyDown(int key)\n    {\n        if (key == SDLK_SPACE)\n        {\n            degree += 10.0f;\n            float rad = degree*3.14f/180.0f;\n            light.position = Vector3f(pos.x, pos.y*std.math.cos(rad), pos.z);\n        }\n    }\n}\n\nenum SHADOW_GROUP = 100;\n\nclass Simple3DApp: Application3D\n{\n    Freeview freeview;\n    DGL3Resource model;\n\n    ShadowMapPass shadow; \n\n    PBRShader pbrShader;\n\n    EnvironmentSphere envSphere;\n    Material envMat;\n\n    EnvTextureResource ambTexRes;\n\n    DynamicArray!LightListener pointLights;\n\n    this()\n    {\n        super();\n\n        Quaternionf sunLightRot = \n            rotationQuaternion(1, degtorad(0.0f)) *\n            rotationQuaternion(0, degtorad(-30.0f));\n\n        if (useShadows)\n        {\n            PipelineState.shadowMapSize = 2048;\n            shadow = New!ShadowMapPass(PipelineState.shadowMapSize, scene3d, SHADOW_GROUP, eventManager);\n            addPass3D(shadow);\n            shadow.lightRotation = sunLightRot;\n            shadow.projectionSize = 20;\n        }\n\n        LightManager.sunEnabled = true;\n        LightManager.sunPosition = Vector4f(sunLightRot.rotate(Vector3f(0, 0, 1)));\n        LightManager.sunPosition.w = 0.0f;\n        LightManager.sunColor = Color4f(0.9, 0.9, 0.8, 1);\n\n        Material.setFogDistance(50, 200);\n        Material.setFogColor(Color4f(0.5, 0.8, 1.0, 1.0));\n\n        setDefaultLoadingImage(\"data/loading.png\");\n\n        mountDirectory(\"data\");\n        mountDirectory(\"data/cerberus\");\n        mountDirectory(\"data/d_man\");\n\n        ambTexRes = addEnvironmentTexureResource(\"zion-sunsetpeek.png\");\n        //model = addModelResource(\"cerberus.dgl3\");\n        model = addModelResource(\"d_man.dgl3\");\n\n        loadResources();\n\n        freeview = New!Freeview(eventManager);\n\n        envSphere = New!EnvironmentSphere(freeview.camera);\n        auto envSphereEntity = createEntity3D(envSphere);\n        envMat = New!Material();\n        envMat.textures[0] = ambTexRes.texture;\n        envSphereEntity.material = envMat;\n\n        pbrShader = New!PBRShader;\n\n        addEntitiesFromModel(model);\n\n        LightListener light1 = New!LightListener(eventManager, lightManager, Vector3f(0.0, -5.0, 0.0), Color4f(0.0f, 1.0f, 1.0f, 1.0f));\n        LightListener light2 = New!LightListener(eventManager, lightManager, Vector3f(0.0, 5.0, 0.0), Color4f(0.0f, 1.0f, 1.0f, 1.0f));\n        pointLights.append(light1);\n        pointLights.append(light2);\n    }\n\n    EnvTextureResource addEnvironmentTexureResource(string filename)\n    {\n        EnvTextureResource res = New!EnvTextureResource(resourceManager.imageFactory);\n        resourceManager.addResource(filename, res);\n        return res;\n    }\n\n    ~this()\n    {\n        foreach(light; pointLights.data)\n        {\n            Delete(light);\n        }\n        pointLights.free();\n\n        Delete(pbrShader);\n        Delete(freeview);\n        Delete(envSphere);\n        Delete(envMat);\n    }\n\n    override void onUpdate(double dt)\n    {\n        super.onUpdate(dt);\n\n        foreach(light;pointLights)\n        {\n            light.processEvents();\n        }\n\n        freeview.update();\n        setCameraMatrix(freeview.getCameraMatrix());\n\n        if (Material.uberShader)\n            Material.uberShader.setViewMatrix(freeview.camera);\n        if (pbrShader)\n            pbrShader.setViewMatrix(freeview.camera);\n\n        if (shadow)\n            shadow.update(dt);\n    }\n\n    override void onRedraw(double dt)\n    {\n        if (shadow)\n            shadow.bind(freeview.camera.getTransformation());       \n        super.onRedraw(dt);\n        if (shadow)\n            shadow.unbind();\n    }\n\n    void addEntitiesFromModel(DGL3Resource model)\n    {\n        foreach(e; model.entities)\n        {\n            if (useShadows)\n                e.groupID = SHADOW_GROUP;\n\n            addEntity3D(e);\n\n            if (e.material)\n            {\n                if (useShaders)\n                {\n                    e.material.setShader(pbrShader);                    \n                    ambTexRes.applyToMaterial(e.material);\n                }\n                else\n                {\n                    e.material.textures[1] = null;\n                    e.material.textures[2] = null;\n                    e.material.textures[3] = null;\n                    e.material.textures[4] = null;\n                }\n            }\n        }\n    }\n\n    override void onKeyDown(int key)\n    {\n        if (key == SDLK_ESCAPE)\n        {\n            exit();\n        }\n    }\n}\n\nvoid main()\n{\n    writefln(\"Allocated memory: %s byte(s)\", allocatedMemory);\n    initDGL();\n    auto app = New!Simple3DApp();\n    app.run();\n    Delete(app);\n    deinitDGL();\n    writefln(\"Allocated memory: %s byte(s)\", allocatedMemory);\n}\n\n\n# dgl\u3063\u3066\u4f55\uff1f\nGitHub\u306e\u30da\u30fc\u30b8\u306f\u3053\u3061\u3089\nhttps://github.com/gecko0307/dgl\n\nD\u8a00\u8a9e\u3067\u5b9f\u88c5\u3055\u308c\u305f\u3001OpenGL\u3092\u4f7f\u3063\u305f\u30b0\u30e9\u30d5\u30a3\u30c3\u30af\u30b9\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002\n\u4eca\u306e\u30b2\u30fc\u30e0\u696d\u754c\u3067\u306f\u4e00\u822c\u7684\u306b\u306a\u3063\u3066\u3044\u308b\u7269\u7406\u30d9\u30fc\u30b9\u3068\u547c\u3070\u308c\u308b\u8003\u3048\u65b9\u3067\u3001\u7d20\u6750\u3084\u5149\u6e90\u306a\u3069\u3092\u8a08\u7b97\u3057\u3066\u63cf\u753b\u3057\u307e\u3059\u3002\n\nGithub\u306eREADME\u306b\u66f8\u304b\u308c\u3066\u3044\u308b\u7279\u5fb4\u3068\u3057\u3066\u306f\u4ee5\u4e0b\u306b\u306a\u308a\u307e\u3059\u3002\n\n- \u5b8c\u5168\u306bGC\u30d5\u30ea\u30fc\n- Windows, Linux, OSX and FreeBSD\u3092\u30b5\u30dd\u30fc\u30c8\n- \u30e6\u30fc\u30b6\u30fc\u5b9a\u7fa9\u306e\u30a4\u30d9\u30f3\u30c8\u30b7\u30b9\u30c6\u30e0\u3068Unicode\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u305f\u30ad\u30fc\u30dc\u30fc\u30c9\u5165\u529b\n- \u30b9\u30ec\u30c3\u30c9\u3067\u30ed\u30fc\u30c9\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u30de\u30cd\u30fc\u30b8\u30e3\u30fc\n- \u72ec\u81ea\u30b7\u30fc\u30f3\u30d5\u30a1\u30a4\u30eb\u30d5\u30a9\u30fc\u30de\u30c3\u30c8(DGL3) \u3092Blender\u304b\u3089\u306e\u51fa\u529b\u306b\u5bfe\u5fdc\n- \u30c6\u30af\u30b9\u30c1\u30e3\u3092PNG\u5f62\u5f0f\u3067\u30ed\u30fc\u30c9\n- \u30de\u30c6\u30ea\u30a2\u30eb\u60c5\u5831\u306f\u4eba\u306e\u8aad\u307f\u3084\u3059\u3044\u5f62\u306e\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3067\u30ed\u30fc\u30c9\n- \u52d5\u7684\u30bd\u30d5\u30c8\u30b7\u30e3\u30c9\u30a6\n- \u7121\u5236\u9650\u306e\u52d5\u7684\u5149\u6e90\n- GLSL shaders\n- \u30ce\u30fc\u30de\u30eb\u30de\u30c3\u30d7\u3068\u8996\u5dee\u30de\u30c3\u30d7\u3092\u30b5\u30dd\u30fc\u30c8\n- \u30a4\u30e1\u30fc\u30b8\u30d9\u30fc\u30b9\u30e9\u30a4\u30c6\u30a3\u30f3\u30b0\n- \u7269\u7406\u30d9\u30fc\u30b9\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0 (PBR)\n- 2D,3D\u306e\u7121\u5236\u9650\u306e\u30ec\u30f3\u30c0\u30fc\u30d1\u30b9\n- \u30ec\u30f3\u30c0\u30fc\u30c6\u30af\u30b9\u30c1\u30e3\u30fc\u306e\u30b5\u30dd\u30fc\u30c8\n- \u30a2\u30f3\u30c1\u30a8\u30a4\u30ea\u30a2\u30b9\n- \u8ffd\u5c3e\u30ab\u30e1\u30e9\u3092\u6a19\u6e96\u88c5\u5099\n- 3D geometric shapes\n- \u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u3059\u308b2D\u30b9\u30d7\u30e9\u30a4\u30c8\n- \u30e6\u30cb\u30b3\u30fc\u30c9\u30b5\u30dd\u30fc\u30c8\u3057\u305fTTF\u30d5\u30a9\u30f3\u30c8\u306e2D\u30c6\u30ad\u30b9\u30c8\u63cf\u753b\n- VFS\n- \u8a2d\u5b9a\u30b3\u30f3\u30d5\u30a3\u30b0\u642d\u8f09\n\n# \u30b5\u30f3\u30d7\u30eb\u306e\u30d3\u30eb\u30c9\n\u30b5\u30f3\u30d7\u30eb\u306b\n\n- minimal.d\n- pbr.d\n- texio.d\n\n\u304c\u3042\u308a\u307e\u3059\u304c\u3001pbr.d\u304c\u30e2\u30c7\u30eb\u3092\u8868\u793a\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u306e\u306a\u306e\u3067\u3001\u3053\u3061\u3089\u3092\u30d3\u30eb\u30c9\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n![dgl_1.jpg](https://qiita-image-store.s3.amazonaws.com/0/65434/7384b2bd-9eac-c00e-15c1-ac1bfc96c86a.jpeg)\n\n\u30a4\u30ab\u30b9\u9283\u304c\u8868\u793a\u3055\u308c\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u5143\u306bD\u8a00\u8a9e\u304f\u3093\u3092\u8868\u793a\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u305d\u308c\u306b\u306f\u307e\u305a\u3001D\u8a00\u8a9e\u304f\u3093\u3092dgl\u3067\u8aad\u3081\u308b\u5f62\u5f0f\u3067\u51fa\u529b\u3057\u76f4\u3059\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n# \u30e2\u30c7\u30eb\u30c7\u30fc\u30bf\u306e\u4f5c\u6210\ndgl\u306fOBJ\u3084FBX\u306e\u3088\u3046\u306a\u4e00\u822c\u7684\u306a\u30e2\u30c7\u30eb\u30c7\u30fc\u30bf\u306f\u8aad\u307f\u8fbc\u3081\u307e\u305b\u3093\u3002\nBlender\u304b\u3089\u306e\u30a8\u30af\u30b9\u30dd\u30fc\u30bf\u30fc\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u307e\u305a\u306fD\u8a00\u8a9e\u304f\u3093\u306e\u30e2\u30c7\u30eb\u30c7\u30fc\u30bf\u3092Blender\u3067\u8aad\u307f\u8fbc\u3081\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n\u30c7\u30fc\u30bf\u306f\uff72\u4e94\u3055\u3093\u306e\u4f5c\u3089\u308c\u305f\u30e2\u30c7\u30eb\nhttps://onedrive.live.com/?cid=F7E340CFC6666A27&id=F7E340CFC6666A27%21574\n\u3092\u304a\u501f\u308a\u3057\u307e\u3059\u3002\n\nD\u8a00\u8a9e\u304f\u3093\u306e\u30e2\u30c7\u30eb\u30c7\u30fc\u30bf\u306f\u3001pmd\u5f62\u5f0f\u3068FBX\u5f62\u5f0f\u3068mqo\u5f62\u5f0f\u3067\u914d\u5e03\u3055\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u3053\u308c\u3092\u306a\u3093\u3068\u304b\u3057\u3066Blender\u306b\u8aad\u307f\u8fbc\u307e\u305b\u308b\u3068\u3044\u3046\u3001D\u8a00\u8a9e\u3068\u306f\u307e\u3063\u305f\u304f\u95a2\u4fc2\u306a\u3044\u6240\u3067\u9811\u5f35\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n## FBX\u3067\u8aad\u307f\u8fbc\u3080\nFBX\u306e\u30c7\u30fc\u30bf\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c6.1\u3068\u53e4\u304f\u3066\u8aad\u307f\u8fbc\u3081\u306a\u304b\u3063\u305f\u3002\nFBX Converter\u3067\u51fa\u529b\u3057\u76f4\u3057\u3066\u307f\u307e\u3057\u305f\u304c\u3001\u305d\u306e\u30c7\u30fc\u30bf\u3092Blender\u3067\u8aad\u307f\u8fbc\u3080\u3068\u3001\u4f55\u6545\u304bBlender\u304c\u30d5\u30ea\u30fc\u30ba\u3057\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u4eca\u306e\u3068\u3053\u308d\u89e3\u6c7a\u65b9\u6cd5\u304c\u898b\u3064\u304b\u3063\u3066\u307e\u305b\u3093\u3002\n## mqo\u3067\u8aad\u307f\u8fbc\u3080\n\u30e1\u30bf\u30bb\u30b3\u30a4\u30a2\u5f62\u5f0f\u3092Blender\u3067\u8aad\u307f\u8fbc\u3080\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u3001\u3053\u3061\u3089\nhttp://nullorempry.jimdo.com/work-list/blender2-5-2-7/mqo/\n\u3067\u516c\u958b\u3055\u308c\u3066\u3044\u305f\u306e\u3067\u3092\u4f7f\u3063\u3066\u307f\u305f\u306e\u3067\u3059\u304c\u3001\u6b63\u3057\u304f\u8aad\u307f\u8fbc\u307e\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u3063\u3066\u304b\u3001\u541b\u306f\u8ab0\uff1f\n![d_man.jpg](https://dl.dropboxusercontent.com/u/148889/d_man.jpg)\n\n## pmd\u3067\u8aad\u307f\u8fbc\u3080\n\u3053\u3061\u3089\u306e\u30c4\u30fc\u30eb\nhttps://github.com/sugiany/blender_mmd_tools\n\u3092\u4f7f\u3046\u3068\u6b63\u3057\u304f\u30a4\u30f3\u30dd\u30fc\u30c8\u51fa\u6765\u307e\u3057\u305f\u3002\n\uff08\u696d\u754c\u6a19\u6e96\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306efbx\u3068\u306f\u4e00\u4f53\u30fb\u30fb\u30fb\uff09\n\u305f\u3060\u3001\u30c6\u30af\u30b9\u30c1\u30e3\u30fc\u304c\u8cbc\u3089\u308c\u3066\u3044\u306a\u3044\u3088\u3046\u306a\u306e\u3067\u3059\u304c\u3001\u30de\u30c6\u30ea\u30a2\u30eb\u60c5\u5831\u306f\u5225\u306b\u30c6\u30ad\u30b9\u30c8\u3067\u66f8\u304f\u306e\u3067\u3001\u4eca\u56de\u306f\u554f\u984c\u7121\u3055\u305d\u3046\u3067\u3059\u3002\n\n# \u30e2\u30c7\u30eb\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u8fbc\u307f\npbr.d\u3092\u6539\u9020\u3057\u3066\u3001D\u8a00\u8a9e\u304f\u3093\u3092\u8aad\u307f\u8fbc\u3081\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\ndata\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4ee5\u4e0b\u306b\u3001d_man\u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001\u51fa\u529b\u3055\u308c\u305fd_man.dgl3\u3068\u30c6\u30af\u30b9\u30c1\u30e3\u306ed_man.png\u3092\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\u30de\u30c6\u30ea\u30a2\u30eb\u60c5\u5831\u306f\u30c6\u30ad\u30b9\u30c8\u306a\u306e\u3067\u3001Material0.mat\u3068\u3044\u3046\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308a\u3001\u3068\u308a\u3042\u3048\u305a\n` name: \"Material0\";\nambientColor: [0.3, 0.4, 0.5, 1.0];\ndiffuseColor: [1.0, 1.0, 1.0, 1.0];\nspecularColor: [1.0, 1.0, 1.0, 1.0];\nemissionColor: [0.0, 0.0, 0.0, 1.0];\nroughness: 0.5;\nspecularity: 0.7;\ndiffuseTexture: \"d_man.png\";` \n\u3068\u8a18\u5165\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\ndgl\u306f\u4eee\u60f3\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306e\u4ed5\u7d44\u307f\u304c\u3042\u308a\u3001\u30a2\u30bb\u30c3\u30c8\u306e\u8aad\u307f\u8fbc\u307f\u6642\u306b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u6307\u5b9a\u3092\u7701\u7565\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u308b\u306e\u3067\u3001\u5148\u7a0b\u4f5c\u6210\u3057\u305fd_man\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3082\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```d:pbr.d\n    mountDirectory(\"data\");\n    mountDirectory(\"data/cerberus\");\n    mountDirectory(\"data/d_man\");//\u8ffd\u52a0\n```\n\n\u305d\u3057\u3066\u3001cerberus.dgl3\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u308b\u6240\u3092d\u8a00\u8a9e\u304f\u3093\u3092\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```d:pbr.d\n//  model = addModelResource(\"cerberus.dgl3\");\n    model = addModelResource(\"d_man.dgl3\");\n```\n\n\u3053\u308c\u3067\u30d3\u30eb\u30c9\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u30db\u30a4\u30fc\u30eb\u3067\u30ab\u30e1\u30e9\u3092\u8fd1\u3065\u3051\u3089\u308c\u308b\u306e\u3067\u3001\u597d\u304d\u306a\u3060\u3051D\u8a00\u8a9e\u304f\u3093\u3092\u611b\u3067\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n![dgl_2.jpg](https://dl.dropboxusercontent.com/u/148889/dgl_2.jpg)\n\n# \u3082\u3063\u3068\u7269\u7406\u30d9\u30fc\u30b9\u3063\u307d\u304f\n\u305b\u3063\u304b\u304f\u7269\u7406\u30d9\u30fc\u30b9\u306e\u63cf\u753b\u30b7\u30b9\u30c6\u30e0\u304c\u4f7f\u308f\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u624b\u3092\u52a0\u3048\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\u304a\u624b\u8efd\u306a\u6240\u3067\u3001\u30c6\u30af\u30b9\u30c1\u30e3\u3092\u8ffd\u52a0\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\nd_man.png\u3092\u30b3\u30d4\u30fc\u3057\u3066\u3001d_man_2.png\u3068\u3044\u3046\u540d\u524d\u306b\u3057\u3066\u30da\u30a4\u30f3\u30c8\u3067\u958b\u304d\u3001\u4e2d\u8eab\u3092\u5168\u90e8\u767d\u306b\u3057\u3066\u3057\u307e\u3044\u307e\u3057\u3087\u3046\u3002\n\u5148\u7a0b\u4f5c\u6210\u3057\u305fMaterial0.mat\u306b\u3001\n`metallicTexture: \"d_man_2.png\";`\n\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\nmetallicTexture\u3068\u3044\u3046\u306e\u306f\u3001\u3069\u308c\u304f\u3089\u3044\u91d1\u5c5e\u7684\u304b\u3092\u8868\u3059\u30c7\u30fc\u30bf\u3092\u5165\u308c\u305f\u30c6\u30af\u30b9\u30c1\u30e3\u3067\u3001\u3069\u308c\u304f\u3089\u3044\u5149\u3092\u53cd\u5c04\u3059\u308b\u304b\u306e\u60c5\u5831\u306b\u306a\u308a\u307e\u3059\u3002\n\u5148\u7a0b\u771f\u3063\u767d\u306b\u3057\u305f\u306e\u3067\u3001\u53cd\u5c04\u7387\u304c1.0\u306e\u5168\u53cd\u5c04\u306b\u306a\u308a\u307e\u3059\u3002\n\u3053\u306e\u72b6\u614b\u3067\u3001\u3082\u3046\u4e00\u5ea6\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n![dgl_3.jpg](https://dl.dropboxusercontent.com/u/148889/dgl_3.jpg)\n\n\u306f\u3044\u3001\u5468\u308a\u306e\u666f\u8272\u304c\u5199\u308a\u8fbc\u3093\u3067\u3001\u3064\u3084\u3064\u3084\u30e1\u30bf\u30ea\u30c3\u30af\u306aD\u8a00\u8a9e\u304f\u3093\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n# \u5149\u6e90\u3092\u7f6e\u3044\u3066\u307f\u3088\u3046\n\u7121\u5236\u9650\u306b\u52d5\u7684\u5149\u6e90\u304c\u7f6e\u3051\u308b\u306e\u304c\u30a6\u30ea\u306e\u4e00\u3064\u306a\u306e\u3067\u3001\u305b\u3063\u304b\u304f\u3060\u304b\u3089\u70b9\u5149\u6e90\u3092\u7f6e\u3044\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n## \u30e9\u30a4\u30c8\u306e\u8ffd\u52a0\npointLight\u3092\u4f5c\u6210\u3057\u3066\u3001Application3D\u304c\u6301\u3063\u3066\u3044\u308bLightManager\u306b\u8ffd\u52a0\u3059\u308b\u3068\u3001\u70b9\u5149\u6e90\u304c\u30b7\u30fc\u30f3\u306b\u53cd\u6620\u3055\u308c\u307e\u3059\u3002\npointLight\u306e\u7b2c\u4e00\u5f15\u6570\u306f\u4f4d\u7f6e\u3067\u3001\u7b2c\u4e8c\u306f\u62e1\u6563\u5149\u3001\u7b2c\u4e09\u306f\u74b0\u5883\u5149\u306e\u8272\u306b\u306a\u308a\u307e\u3059\u3002\n\u70b9\u5149\u6e90\u306a\u306e\u306b\u74b0\u5883\u5149\u306e\u8a2d\u5b9a\u304c\u3042\u308b\u306e\u304c\u3088\u304f\u5206\u304b\u3089\u306a\u3044\u3068\u3053\u308d\u3067\u3059\u304c\u3001\u5e73\u884c\u5149\u6e90\u3068\u540c\u3058\u5f15\u6570\u3092\u4f7f\u3063\u3066\u308b\u3060\u3051\u306a\u306e\u304b\u3082\uff1f\n\n## \u30a4\u30d9\u30f3\u30c8\ndgl\u306f\u5185\u90e8\u3067SDL\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u306e\u3067\u3001SDL\u306e\u30a4\u30d9\u30f3\u30c8\u3092\u4f7f\u3046\u3053\u3068\u304c\u51fa\u6765\u308b\u30af\u30e9\u30b9\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nApplication3D\u304c\u6301\u3063\u3066\u3044\u308bEventManager\u306bEventListener\u3092\u6d3e\u751f\u3057\u305f\u30af\u30e9\u30b9\u3092\u767b\u9332\u3057\u3001\u305d\u306e\u30af\u30e9\u30b9\u3067\u30a4\u30f3\u30d9\u30f3\u30c8\u3092\u51e6\u7406\u3057\u307e\u3059\u3002\n\u5177\u4f53\u7684\u306a\u4f8b\u3068\u3057\u3066\u3001\u30b9\u30da\u30fc\u30b9\u30ad\u30fc\u304c\u70b9\u5149\u6e90\u306e\u4f4d\u7f6e\u304cY\u65b9\u5411\u306b\uff11\uff10\u5ea6\u79fb\u52d5\u3059\u308b\u30af\u30e9\u30b9\u306f\u4ee5\u4e0b\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n```d:pbr.d\nclass LightListener: EventListener\n{\n\tLight light;\n\tVector3f pos;\n\tfloat degree = 0.0f;\n\tthis(EventManager emngr, LightManager lightManager, Vector3f in_pos, Color4f in_col)\n\t{\n        super(emngr);\n\t\tpos = in_pos;\n\t\tlight = lightManager.addLight(pointLight(in_pos, in_col, Color4f(0.1f, 0.1f, 0.1f, 1.0f)));\n\t}\n\n    ~this()\n    {\n        Delete(light);\n    }\n\n    override void onKeyDown(int key)\n    {\n        if (key == SDLK_SPACE)\n\t\t{\n\t\t\tdegree += 10.0f;\n\t\t\tfloat rad = degree*3.14f/180.0f;\n\t\t\tlight.position = Vector3f(pos.x, pos.y*std.math.cos(rad), pos.z);\n\t\t}\n    }\n}\n```\n\u3053\u308c\u3092\u767b\u9332\u3059\u308b\u30ea\u30b9\u30c8\u3092Simple3DApp\u306e\u30e1\u30f3\u30d0\u30fc\u306b\u6301\u305f\u305b\u307e\u3059\u3002\n\u305b\u3063\u304b\u304f\u306a\u3093\u3067\u3001\u30e9\u30a4\u30d6\u30e9\u30ea\u5074\u3067\u7528\u610f\u3057\u3066\u308b\u30ea\u30b9\u30c8\u3092\u4f7f\u3044\u307e\u3059\u3002\n`    DynamicArray!LightListener pointLights;`\n\u3053\u308c\u306b\u5bfe\u3057\u3066\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5f62\u3067\u3001\u30e9\u30a4\u30c8\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```d:pbr.d\n\t\tLightListener light1 = New!LightListener(eventManager, lightManager, Vector3f(0.0, -5.0, 0.0), Color4f(0.0f, 1.0f, 1.0f, 1.0f));\n\t\tLightListener light2 = New!LightListener(eventManager, lightManager, Vector3f(0.0, 5.0, 0.0), Color4f(0.0f, 1.0f, 1.0f, 1.0f));\n\t\tpointLights.append(light1);\n\t\tpointLights.append(light2);\n```\n\n\u3042\u3068\u306f\u3001onUpdate\u95a2\u6570\u306e\u4e2d\u3067\u3001\u5404\u30e9\u30a4\u30c8\u306b\u5bfe\u3057\u3066\u30a4\u30d9\u30f3\u30c8\u51e6\u7406\u3092\u5b9f\u884c\u3059\u308b\u3088\u3046\u306bprocessEvents\u95a2\u6570\u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u3002\n\n```d:pbr.d\n\t\tforeach(light;pointLights)\n\t\t{\n\t\t\tlight.processEvents();\n\t\t}\n```\n\n\u3053\u308c\u3067\u3001\u30b9\u30da\u30fc\u30b9\u30ad\u30fc\u3092\u62bc\u3057\u305f\u30a4\u30d9\u30f3\u30c8\u304c\u51e6\u7406\u3055\u308c\u3066\u3001\u5149\u6e90\u304c\u52d5\u304f\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n![dgl_4.jpg](https://dl.dropboxusercontent.com/u/148889/dgl_4.jpg)\n\n# \u307e\u3068\u3081\n\u30c7\u30fc\u30bf\u306e\u51fa\u529b\u3068\u3044\u3046D\u8a00\u8a9e\u3068\u5168\u7136\u95a2\u4fc2\u306a\u3044\u6240\u3067\u6642\u9593\u304c\u53d6\u3089\u308c\u3066\u3057\u307e\u3044\u3001\u3042\u307e\u308a\u8a73\u3057\u3044\u8aac\u660e\u304c\u66f8\u3051\u306a\u304f\u3066\u3001\u3054\u3081\u3093\u306a\u3055\u3044\u3002\ndgl\u306f\u3001\u540c\u3058\u4f5c\u8005\u304c\u4f5c\u3063\u305f[dlib](https://github.com/gecko0307/dlib)\u3068\u3044\u3046\u30e9\u30a4\u30d6\u30e9\u30ea\u7fa4\u304c\u4f7f\u308f\u308c\u3066\u3044\u307e\u3059\u3002\n\u7d50\u69cb\u306a\u91cf\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3001GC\u30d5\u30ea\u30fc\u306e\u30b3\u30f3\u30c6\u30ca\u3084\u8a08\u7b97\u30e9\u30a4\u30d6\u30e9\u30ea\u3084\u753b\u50cf\u30ed\u30fc\u30c0\u30fc\u7b49\u63c3\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u8aad\u3093\u3067\u307f\u308b\u3068\u9762\u767d\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\ndgl\u306b\u306f\u307e\u3060\u30e2\u30fc\u30b7\u30e7\u30f3\u518d\u751f\u306a\u3069\u7121\u3044\u3067\u3059\u304c\u3001\u5c06\u6765\u306fIQM(Inter-Quake Model \uff09\u3068\u3044\u3046\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3001\u30e2\u30fc\u30b7\u30e7\u30f3\u518d\u751f\u3092\u3059\u308b\u4e88\u5b9a\u307f\u305f\u3044\u3067\u3059\u3002\n\u3042\u3068\u306f\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u307b\u307c\u7121\u3044\u306e\u3067\u3001\u4f55\u3092\u3084\u308b\u306b\u3082\u30b3\u30fc\u30c9\u3092\u8aad\u307e\u306a\u304d\u3083\u3044\u3051\u306a\u3044\u306e\u304c\u3001\u7d50\u69cb\u5927\u5909\u3067\u3059\u3002\n\u540c\u3058\u4f5c\u8005\u304c[dmech](https://github.com/gecko0307/dmech)\u3044\u3046\u7269\u7406\u30a8\u30f3\u30b8\u30f3\u30e9\u30a4\u30d6\u30e9\u30ea\u3082\u4f5c\u3063\u3066\u3044\u3066\u3001\u305d\u308c\u3068dgl\u3092\u7d44\u307f\u5408\u308f\u305b\u305f\u3001[atrium](https://github.com/gecko0307/atrium)\u3068\u3044\u3046\u30b2\u30fc\u30e0\n\u3092\u4f5c\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u3061\u3089\u3092\u53c2\u8003\u306b\u3059\u308b\u3068\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\u6a5f\u80fd\u306f\u305d\u308c\u306a\u308a\u306b\u63c3\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u30e2\u30fc\u30b7\u30e7\u30f3\u518d\u751f\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u305f\u3089\u3001\u5272\u308a\u3068\u4f7f\u3048\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u306b\u306a\u308a\u305d\u3046\u306a\u6c17\u304c\u3057\u307e\u3059\u3002\n\u305f\u3060\u3001\u5b8c\u5168\u306bGC\u30d5\u30ea\u30fc\u306a\u306e\u3092\u30a6\u30ea\u306b\u3057\u3066\u308b\u306e\u3067\u3001\u958b\u653e\u306f\u5e38\u306b\u81ea\u5206\u3067\u3084\u3089\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u306e\u3067\u3001\u6163\u308c\u304c\u5fc5\u8981\u306b\u306a\u308a\u305d\u3046\u3067\u3059\u3002\n\n\u6700\u5f8c\u306b\u3001\u6700\u7d42\u7684\u306a\u30b3\u30fc\u30c9\u3092\u8cbc\u3063\u3066\u304a\u304d\u307e\u3059\u3002\n\n```d:pbr.d\n/*\nCopyright (c) 2016 Timur Gafarov \n\nBoost Software License - Version 1.0 - August 17th, 2003\n\nPermission is hereby granted, free of charge, to any person or organization\nobtaining a copy of the software and accompanying documentation covered by\nthis license (the \"Software\") to use, reproduce, display, distribute,\nexecute, and transmit the Software, and to prepare derivative works of the\nSoftware, and to permit third-parties to whom the Software is furnished to\ndo so, all subject to the following:\n\nThe copyright notices in the Software and this entire statement, including\nthe above license grant, this restriction and the following disclaimer,\nmust be included in all copies of the Software, in whole or in part, and\nall derivative works of the Software, unless such copies or derivative\nworks are solely in the form of machine-executable object code generated by\na source language processor.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE, TITLE AND NON-INFRINGEMENT. IN NO EVENT\nSHALL THE COPYRIGHT HOLDERS OR ANYONE DISTRIBUTING THE SOFTWARE BE LIABLE\nFOR ANY DAMAGES OR OTHER LIABILITY, WHETHER IN CONTRACT, TORT OR OTHERWISE,\nARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\nDEALINGS IN THE SOFTWARE.\n*/\n\nmodule pbr;\n\nimport std.stdio;\nimport std.math;\n\nimport dlib.core.memory;\nimport dlib.core.stream;\nimport dlib.math.vector;\nimport dlib.math.affine;\nimport dlib.math.quaternion;\nimport dlib.math.utils;\nimport dlib.image.color;\nimport dlib.filesystem.filesystem;\n\nimport dgl.core.api;\nimport dgl.core.event;\nimport dgl.core.application;\nimport dgl.core.interfaces;\n\nimport dgl.templates.app3d;\nimport dgl.templates.freeview;\n\nimport dgl.graphics.entity;\nimport dgl.graphics.camera;\nimport dgl.graphics.shapes;\nimport dgl.graphics.material;\nimport dgl.graphics.texture;\nimport dgl.graphics.shader;\nimport dgl.graphics.shadow;\nimport dgl.graphics.state;\nimport dgl.graphics.light;\nimport dgl.graphics.pbrshader;\n\nimport dgl.asset.dgl3;\nimport dgl.asset.envtexture;\n\nimport dlib.container.array;\n\nclass EnvironmentSphere: Drawable\n{\n    Camera camera;\n    ShapeSphere sphere;\n    float radius = 50.0f;\n    \n    this(Camera cam)\n    {\n        camera = cam;\n        sphere = New!ShapeSphere(1);\n    }\n    \n    void draw(double dt)\n    {\n        glPushMatrix();\n        Vector3f pos = camera.getTransformation.translation;\n        glTranslatef(pos.x, pos.y, pos.z);\n        glRotatef(180.0f, 0, 1, 0);\n        glRotatef(-90.0f, 1, 0, 0);\n        glScalef(-radius, -radius, -radius);\n        glDisable(GL_LIGHTING);\n        glDepthMask(GL_FALSE);\n        sphere.draw(dt);\n        glDepthMask(GL_TRUE);\n        glEnable(GL_LIGHTING);\n        glPopMatrix();\n    }\n    \n    ~this()\n    {\n        Delete(sphere);\n    }\n}\n\nclass LightListener: EventListener\n{\n\tLight light;\n\tVector3f pos;\n\tfloat degree = 0.0f;\n\tthis(EventManager emngr, LightManager lightManager, Vector3f in_pos, Color4f in_col)\n\t{\n        super(emngr);\n\t\tpos = in_pos;\n\t\tlight = lightManager.addLight(pointLight(in_pos, in_col, Color4f(0.1f, 0.1f, 0.1f, 1.0f)));\n\t}\n\n    ~this()\n    {\n        Delete(light);\n    }\n\n    override void onKeyDown(int key)\n    {\n        if (key == SDLK_SPACE)\n\t\t{\n\t\t\tdegree += 10.0f;\n\t\t\tfloat rad = degree*3.14f/180.0f;\n\t\t\tlight.position = Vector3f(pos.x, pos.y*std.math.cos(rad), pos.z);\n\t\t}\n    }\n}\n\nenum SHADOW_GROUP = 100;\n\nclass Simple3DApp: Application3D\n{\n    Freeview freeview;\n    DGL3Resource model;\n    \n    ShadowMapPass shadow; \n    \n    PBRShader pbrShader;\n    \n    EnvironmentSphere envSphere;\n    Material envMat;\n    \n    EnvTextureResource ambTexRes;\n    \n    DynamicArray!LightListener pointLights;\n\n    this()\n    {\n        super();\n\n        Quaternionf sunLightRot = \n            rotationQuaternion(1, degtorad(0.0f)) *\n            rotationQuaternion(0, degtorad(-30.0f));\n\n        if (useShadows)\n        {\n            PipelineState.shadowMapSize = 2048;\n            shadow = New!ShadowMapPass(PipelineState.shadowMapSize, scene3d, SHADOW_GROUP, eventManager);\n            addPass3D(shadow);\n            shadow.lightRotation = sunLightRot;\n            shadow.projectionSize = 20;\n        }\n\n        LightManager.sunEnabled = true;\n        LightManager.sunPosition = Vector4f(sunLightRot.rotate(Vector3f(0, 0, 1)));\n        LightManager.sunPosition.w = 0.0f;\n        LightManager.sunColor = Color4f(0.9, 0.9, 0.8, 1);\n        \n        Material.setFogDistance(50, 200);\n        Material.setFogColor(Color4f(0.5, 0.8, 1.0, 1.0));\n        \n        setDefaultLoadingImage(\"data/loading.png\");\n        \n        mountDirectory(\"data\");\n        mountDirectory(\"data/cerberus\");\n        mountDirectory(\"data/d_man\");\n\n        ambTexRes = addEnvironmentTexureResource(\"zion-sunsetpeek.png\");\n        //model = addModelResource(\"cerberus.dgl3\");\n        model = addModelResource(\"d_man.dgl3\");\n        \n        loadResources();\n        \n        freeview = New!Freeview(eventManager);\n        \n        envSphere = New!EnvironmentSphere(freeview.camera);\n        auto envSphereEntity = createEntity3D(envSphere);\n        envMat = New!Material();\n        envMat.textures[0] = ambTexRes.texture;\n        envSphereEntity.material = envMat;\n        \n        pbrShader = New!PBRShader;\n                \n        addEntitiesFromModel(model);\n\n\t\tLightListener light1 = New!LightListener(eventManager, lightManager, Vector3f(0.0, -5.0, 0.0), Color4f(0.0f, 1.0f, 1.0f, 1.0f));\n\t\tLightListener light2 = New!LightListener(eventManager, lightManager, Vector3f(0.0, 5.0, 0.0), Color4f(0.0f, 1.0f, 1.0f, 1.0f));\n\t\tpointLights.append(light1);\n\t\tpointLights.append(light2);\n    }\n    \n    EnvTextureResource addEnvironmentTexureResource(string filename)\n    {\n        EnvTextureResource res = New!EnvTextureResource(resourceManager.imageFactory);\n        resourceManager.addResource(filename, res);\n        return res;\n    }\n\n    ~this()\n    {\n        foreach(light; pointLights.data)\n\t\t{\n            Delete(light);\n\t\t}\n        pointLights.free();\n\n        Delete(pbrShader);\n        Delete(freeview);\n        Delete(envSphere);\n        Delete(envMat);\n    }\n    \n    override void onUpdate(double dt)\n    {\n        super.onUpdate(dt);\n\n\t\tforeach(light;pointLights)\n\t\t{\n\t\t\tlight.processEvents();\n\t\t}\n\n        freeview.update();\n        setCameraMatrix(freeview.getCameraMatrix());\n        \n        if (Material.uberShader)\n            Material.uberShader.setViewMatrix(freeview.camera);\n        if (pbrShader)\n            pbrShader.setViewMatrix(freeview.camera);\n        \n        if (shadow)\n            shadow.update(dt);\n    }\n    \n    override void onRedraw(double dt)\n    {\n        if (shadow)\n            shadow.bind(freeview.camera.getTransformation());       \n        super.onRedraw(dt);\n        if (shadow)\n            shadow.unbind();\n    }\n\n    void addEntitiesFromModel(DGL3Resource model)\n    {\n        foreach(e; model.entities)\n        {\n            if (useShadows)\n                e.groupID = SHADOW_GROUP;\n\n            addEntity3D(e);\n\n            if (e.material)\n            {\n                if (useShaders)\n                {\n                    e.material.setShader(pbrShader);                    \n                    ambTexRes.applyToMaterial(e.material);\n                }\n                else\n                {\n                    e.material.textures[1] = null;\n                    e.material.textures[2] = null;\n                    e.material.textures[3] = null;\n                    e.material.textures[4] = null;\n                }\n            }\n        }\n    }\n\n    override void onKeyDown(int key)\n    {\n        if (key == SDLK_ESCAPE)\n        {\n            exit();\n        }\n    }\n}\n\nvoid main()\n{\n    writefln(\"Allocated memory: %s byte(s)\", allocatedMemory);\n    initDGL();\n    auto app = New!Simple3DApp();\n    app.run();\n    Delete(app);\n    deinitDGL();\n    writefln(\"Allocated memory: %s byte(s)\", allocatedMemory);\n}\n```\n", "tags": ["D\u8a00\u8a9e"]}