{"tags": ["centos7", "ss", "TCP"], "context": "\n\n1 SS\u30b3\u30de\u30f3\u30c9\u3068\u306f?\nTCP\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3084\u30bd\u30b1\u30c3\u30c8\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3002\n\n2 \u74b0\u5883\n[root@master ~]# cat /etc/redhat-release\nCentOS Linux release 7.2.1511 (Core)\n\n\n\n3 \u30aa\u30d7\u30b7\u30e7\u30f3\u4e00\u89a7\n\n[root@master ~]# ss -help\nUsage: ss [ OPTIONS ]\n       ss [ OPTIONS ] [ FILTER ]\n   -h, --help          this message\n   -V, --version       output version information\n   -n, --numeric       don't resolve service names\n   -r, --resolve       resolve host names\n   -a, --all           display all sockets\n   -l, --listening     display listening sockets\n   -o, --options       show timer information\n   -e, --extended      show detailed socket information\n   -m, --memory        show socket memory usage\n   -p, --processes     show process using socket\n   -i, --info          show internal TCP information\n   -s, --summary       show socket usage summary\n   -b, --bpf           show bpf filter socket information\n   -Z, --context       display process SELinux security contexts\n   -z, --contexts      display process and socket SELinux security contexts\n   -N, --net           switch to the specified network namespace name\n\n   -4, --ipv4          display only IP version 4 sockets\n   -6, --ipv6          display only IP version 6 sockets\n   -0, --packet        display PACKET sockets\n   -t, --tcp           display only TCP sockets\n   -u, --udp           display only UDP sockets\n   -d, --dccp          display only DCCP sockets\n   -w, --raw           display only RAW sockets\n   -x, --unix          display only Unix domain sockets\n   -f, --family=FAMILY display sockets of type FAMILY\n\n   -A, --query=QUERY, --socket=QUERY\n       QUERY := {all|inet|tcp|udp|raw|unix|unix_dgram|unix_stream|unix_seqpacket|packet|netlink}[,QUERY]\n\n   -D, --diag=FILE     Dump raw information about TCP sockets to FILE\n   -F, --filter=FILE   read filter information from FILE\n       FILTER := [ state STATE-FILTER ] [ EXPRESSION ]\n       STATE-FILTER := {all|connected|synchronized|bucket|big|TCP-STATES}\n         TCP-STATES := {established|syn-sent|syn-recv|fin-wait-{1,2}|time-wait|closed|close-wait|last-ack|listen|closing}\n          connected := {established|syn-sent|syn-recv|fin-wait-{1,2}|time-wait|close-wait|last-ack|closing}\n       synchronized := {established|syn-recv|fin-wait-{1,2}|time-wait|close-wait|last-ack|closing}\n             bucket := {syn-recv|time-wait}\n                big := {established|syn-sent|fin-wait-{1,2}|closed|close-wait|last-ack|listen|closing}\n\n\n\n4 TCP\u95a2\u9023(-t)\n\n4.1 \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u78ba\u7acb\u6e08\u30bd\u30b1\u30c3\u30c8\u306e\u8abf\u3079\u65b9\n[root@master ~]# ss -t\nState       Recv-Q Send-Q           Local Address:Port                            Peer Address:Port\nESTAB       0      96                192.168.0.10:ssh                              192.168.0.6:50031\nESTAB       0      0                 192.168.0.10:ssh                              192.168.0.6:51740\n\n\n\n\n4.2 \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u78ba\u7acb\u6e08\u30bd\u30b1\u30c3\u30c8\u306e\u8abf\u3079\u65b9(\u6570\u5024\u3067\u8868\u793a)\n\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u30b5\u30fc\u30d3\u30b9\u540d\u3067\u306f\u306a\u304f\u6570\u5024\u3067\u8868\u793a\u3059\u308b(-n)\u3002\n[root@master ~]# ss -nt\nState       Recv-Q Send-Q                                 Local Address:Port                                                Peer Address:Port\nESTAB       0      0                                       192.168.0.10:22                                                   192.168.0.6:50031\nESTAB       0      96                                      192.168.0.10:22                                                   192.168.0.6:51740\n\n\n\n4.3 \u30ea\u30b9\u30cb\u30f3\u30b0\u30bd\u30b1\u30c3\u30c8(-l)\u306e\u8abf\u3079\u65b9\n[root@master ~]# ss -lnt|grep 22\nState      Recv-Q Send-Q     Local Address:Port         Peer Address:Port\nLISTEN     0      128          *:22                       *:*\nLISTEN     0      128         :::22                      :::*\n\n\n\n4.4 \u30bd\u30b1\u30c3\u30c8\u3092\u4f7f\u3063\u3066\u3044\u308b\u30d7\u30ed\u30bb\u30b9\u306e\u8abf\u3079\u65b9(-p)\n[root@master ~]# ss -lnpt|grep 22\n\nLISTEN     0      128          *:22                 *:*                 users:((\"sshd\",pid=1039,fd=3))\nLISTEN     0      128         :::22                :::*                 users:((\"sshd\",pid=1039,fd=4))\n\n\n\n4.5 TIME-WAIT\u72b6\u614b\u306e\u30bd\u30b1\u30c3\u30c8\u306e\u8abf\u3079\u65b9(state time-wait)\n\u30b5\u30fc\u30d0\u3067nc\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u300211111\u756a\u30dd\u30fc\u30c8\u3067\u30ea\u30c3\u30b9\u30f3\u3059\u308b\u3002\n[root@master ~]# nc -l 11111\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067nc\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3002Ctrl+c\u3092\u62bc\u4e0b\u3057\u3066TCP\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3092\u5207\u65ad\u3059\u308b\u3002\n[root@node1 ~]# nc master 11111\n^C\n\nTIME-WAIT\u72b6\u614b\u306e\u30bd\u30b1\u30c3\u30c8\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u5207\u65ad\u76f4\u5f8c\u306a\u306e\u3067\u3001\u30bf\u30a4\u30de\u304c59\u79d2\u306b\u306a\u3063\u3066\u3044\u308b(\u2605\u5370)\u3002\n[root@node1 ~]# ss -not state time-wait\nRecv-Q Send-Q             Local Address:Port            Peer Address:Port\n0      0                  192.168.0.20:53691            192.168.0.10:11111         timer:(timewait,\u260559sec,0)\n\n-\u4e2d\u7565-\n\nTIME-WAIT\u72b6\u614b\u306e\u30bd\u30b1\u30c3\u30c8\u306e\u30bf\u30a4\u30de\u304c\u6b8b\u308a515\u30df\u30ea\u79d2\u3067\u3042\u308b\u3053\u3068\u304c\u308f\u304b\u308b(\u2605\u5370)\u3002\n[root@node1 ~]# ss -not state time-wait\nRecv-Q Send-Q             Local Address:Port            Peer Address:Port\n0      0                  192.168.0.20:53691            192.168.0.10:11111         timer:(timewait,\u2605515ms,0)\n\n60\u79d2\u7d4c\u904e\u3057\u305f\u306e\u3067\u3001TIME-WAIT\u72b6\u614b\u306e\u30bd\u30b1\u30c3\u30c8\u304c\u6d88\u3048\u305f\u3002\n[root@node1 ~]# ss -not state time-wait\nRecv-Q Send-Q             Local Address:Port            Peer Address:Port\n[root@node1 ~]#\n\n\n\n\n4.6 SYS-SENT\u72b6\u614b\u306e\u30bd\u30b1\u30c3\u30c8\u306e\u8abf\u3079\u65b9(state syn-sent)\n\n\n\n               \u30af\u30e9\u30a4\u30a2\u30f3\u30c8                        \u30b5\u30fc\u30d0\n                 (node1)                           (master)\n                    |                                 |\n                    |                                 | <- iptables -A INPUT -p tcp --dport 11111 -j DROP\n                    |                                 |\n                    |                                 | <- nc -l 11111\n                    |                                 |\n nc master 11111 -> |                                 |\n             -*-    |------------- SYN -------------->| <- \u5ec3\u68c4\n              |     |                                 |\n           SYS-SENT |------------- SYN -------------->| <- \u5ec3\u68c4\n              |     |                                 |\n             -*-    |------------- SYN -------------->| <- \u5ec3\u68c4\n                    |                                 |\n\n\n--------------------------\n1. \u30b5\u30fc\u30d0(master)\u5074\u306e\u8a2d\u5b9a\n--------------------------\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8(node1)\u304b\u3089\u5230\u7740\u3059\u308b11111\u756a\u30dd\u30fc\u30c8\u5b9b\u3066\u306e\u30d1\u30b1\u30c3\u30c8\u3092\u5ec3\u68c4\u3059\u308b\u3002\n[root@master ~]# iptables -A INPUT -p tcp --dport 11111 -j DROP\n\n\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# iptables -nvL INPUT --line-numbers\nChain INPUT (policy ACCEPT 13 packets, 1400 bytes)\nnum   pkts bytes target     prot opt in     out     source               destination\n1        0     0 DROP       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:11111\n[root@master ~]#\n\nnc\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u300211111\u756a\u30dd\u30fc\u30c8\u3067TCP\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u78ba\u7acb\u3092\u5f85\u3064\u3002\n[root@master ~]# nc -l 11111\n\n-----------------------------\n2. \u30af\u30e9\u30a4\u30a2\u30f3\u30c8(node1)\u306e\u8a2d\u5b9a\n-----------------------------\n\u30b5\u30fc\u30d0\u306e11111\u756a\u30dd\u30fc\u30c8\u306bTCP\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3092\u78ba\u7acb\u3059\u308b\u3002\n[root@node1 ~]# nc master 11111\nNcat: Connection timed out.\n\n\n\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u958b\u3044\u3066\u3001\u30bd\u30b1\u30c3\u30c8\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002SYS-SENT\u72b6\u614b\u306e\u30bd\u30b1\u30c3\u30c8\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n[root@node1 ~]# ss -not state syn-sent\nRecv-Q Send-Q                             Local Address:Port         Peer Address:Port\n0      1                                   192.168.0.20:53698        192.168.0.10:11111        timer:(on,1.569ms,1)\n[root@node1 ~]# ss -not state syn-sent\nRecv-Q Send-Q                             Local Address:Port         Peer Address:Port\n0      1                                   192.168.0.20:53698        192.168.0.10:11111        timer:(on,198ms,1)\n[root@node1 ~]# ss -not state syn-sent\nRecv-Q Send-Q                             Local Address:Port         Peer Address:Port\n0      1                                   192.168.0.20:53698        192.168.0.10:11111        timer:(on,2.636ms,2)\n[root@node1 ~]# ss -not state syn-sent\nRecv-Q Send-Q                             Local Address:Port         Peer Address:Port\n0      1                                   192.168.0.20:53698        192.168.0.10:11111        timer:(on,1.364ms,2)\n[root@node1 ~]# ss -not state syn-sent\nRecv-Q Send-Q                             Local Address:Port         Peer Address:Port\n0      1                                   192.168.0.20:53698        192.168.0.10:11111        timer:(on,163ms,2)\n[root@node1 ~]# ss -not state syn-sent\nRecv-Q Send-Q                             Local Address:Port         Peer Address:Port\n0      1                                   192.168.0.20:53698        192.168.0.10:11111        timer:(on,6.894ms,3)\n[root@node1 ~]# ss -not state syn-sent\nRecv-Q Send-Q                             Local Address:Port         Peer Address:Port\n0      1                                   192.168.0.20:53698        192.168.0.10:11111        timer:(on,5.783ms,3)\n[root@node1 ~]# ss -not state syn-sent\nRecv-Q Send-Q                             Local Address:Port         Peer Address:Port\n[root@node1 ~]#\n\n-------------\n3. \u3042\u3068\u59cb\u672b\n-------------\n[root@master ~]# iptables -D INPUT 1\n[root@master ~]# iptables -nvL INPUT --line-numbers\nChain INPUT (policy ACCEPT 5 packets, 488 bytes)\nnum   pkts bytes target     prot opt in     out     source               destination\n[root@master ~]#\n\n\n\n4.7 SYS-RECV\u72b6\u614b\u306e\u30bd\u30b1\u30c3\u30c8\u306e\u8abf\u3079\u65b9(state syn-recv)\n-----------------------------\n1. \u30af\u30e9\u30a4\u30a2\u30f3\u30c8(node1)\u306e\u8a2d\u5b9a\n-----------------------------\n\u30b5\u30fc\u30d0(master)\u304b\u3089\u306eSYN+ACK\u3092\u5ec3\u68c4\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n[root@node1 ~]# iptables -A INPUT -p tcp --sport 11111 -j DROP\n\n\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@node1 ~]# iptables -nvL INPUT --line-numbers\nChain INPUT (policy ACCEPT 42 packets, 4080 bytes)\nnum   pkts bytes target     prot opt in     out     source               destination\n1        0     0 DROP       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp spt:11111\n[root@node1 ~]#\n\n\n-----------------------------\n2. \u30b5\u30fc\u30d0(master)\u306e\u8a2d\u5b9a\n-----------------------------\n[root@master ~]# nc -l 11111\n\n\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u958b\u304f\u3002\u30bd\u30b1\u30c3\u30c8\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# ss -not state syn-recv\nRecv-Q Send-Q                      Local Address:Port          Peer Address:Port\n[root@master ~]# ss -not state syn-recv\nRecv-Q Send-Q                           Local Address:Port          Peer Address:Port\n0      0                                 192.168.0.10:11111         192.168.0.20:53702     timer:(on,451ms,0)\n[root@master ~]# ss -not state syn-recv\nRecv-Q Send-Q                           Local Address:Port          Peer Address:Port\n0      0                                 192.168.0.10:11111         192.168.0.20:53702     timer:(on,608ms,2)\n[root@master ~]# ss -not state syn-recv\nRecv-Q Send-Q                           Local Address:Port          Peer Address:Port\n0      0                                 192.168.0.10:11111         192.168.0.20:53702     timer:(on,,3)\n[root@master ~]# ss -not state syn-recv\nRecv-Q Send-Q                           Local Address:Port          Peer Address:Port\n0      0                                 192.168.0.10:11111         192.168.0.20:53702     timer:(on,3.264ms,4)\n[root@master ~]# ss -not state syn-recv\nRecv-Q Send-Q                           Local Address:Port          Peer Address:Port\n0      0                                 192.168.0.10:11111         192.168.0.20:53702     timer:(on,1.125ms,5)\n[root@master ~]# ss -not state syn-recv\nRecv-Q Send-Q                           Local Address:Port          Peer Address:Port\n0      0                                 192.168.0.10:11111         192.168.0.20:53702     timer:(on,,5)\n[root@master ~]# \n\n\n\nx \u53c2\u8003\u60c5\u5831\n10 examples of Linux ss command to monitor network connections\n#1 SS\u30b3\u30de\u30f3\u30c9\u3068\u306f?\nTCP\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3084\u30bd\u30b1\u30c3\u30c8\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3002\n\n#2 \u74b0\u5883\n\n```\n[root@master ~]# cat /etc/redhat-release\nCentOS Linux release 7.2.1511 (Core)\n\n```\n\n#3 \u30aa\u30d7\u30b7\u30e7\u30f3\u4e00\u89a7\n\n```\n\n[root@master ~]# ss -help\nUsage: ss [ OPTIONS ]\n       ss [ OPTIONS ] [ FILTER ]\n   -h, --help          this message\n   -V, --version       output version information\n   -n, --numeric       don't resolve service names\n   -r, --resolve       resolve host names\n   -a, --all           display all sockets\n   -l, --listening     display listening sockets\n   -o, --options       show timer information\n   -e, --extended      show detailed socket information\n   -m, --memory        show socket memory usage\n   -p, --processes     show process using socket\n   -i, --info          show internal TCP information\n   -s, --summary       show socket usage summary\n   -b, --bpf           show bpf filter socket information\n   -Z, --context       display process SELinux security contexts\n   -z, --contexts      display process and socket SELinux security contexts\n   -N, --net           switch to the specified network namespace name\n\n   -4, --ipv4          display only IP version 4 sockets\n   -6, --ipv6          display only IP version 6 sockets\n   -0, --packet        display PACKET sockets\n   -t, --tcp           display only TCP sockets\n   -u, --udp           display only UDP sockets\n   -d, --dccp          display only DCCP sockets\n   -w, --raw           display only RAW sockets\n   -x, --unix          display only Unix domain sockets\n   -f, --family=FAMILY display sockets of type FAMILY\n\n   -A, --query=QUERY, --socket=QUERY\n       QUERY := {all|inet|tcp|udp|raw|unix|unix_dgram|unix_stream|unix_seqpacket|packet|netlink}[,QUERY]\n\n   -D, --diag=FILE     Dump raw information about TCP sockets to FILE\n   -F, --filter=FILE   read filter information from FILE\n       FILTER := [ state STATE-FILTER ] [ EXPRESSION ]\n       STATE-FILTER := {all|connected|synchronized|bucket|big|TCP-STATES}\n         TCP-STATES := {established|syn-sent|syn-recv|fin-wait-{1,2}|time-wait|closed|close-wait|last-ack|listen|closing}\n          connected := {established|syn-sent|syn-recv|fin-wait-{1,2}|time-wait|close-wait|last-ack|closing}\n       synchronized := {established|syn-recv|fin-wait-{1,2}|time-wait|close-wait|last-ack|closing}\n             bucket := {syn-recv|time-wait}\n                big := {established|syn-sent|fin-wait-{1,2}|closed|close-wait|last-ack|listen|closing}\n\n```\n\n\n#4 TCP\u95a2\u9023(-t)\n\n##4.1 \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u78ba\u7acb\u6e08\u30bd\u30b1\u30c3\u30c8\u306e\u8abf\u3079\u65b9\n\n```\n[root@master ~]# ss -t\nState       Recv-Q Send-Q           Local Address:Port                            Peer Address:Port\nESTAB       0      96                192.168.0.10:ssh                              192.168.0.6:50031\nESTAB       0      0                 192.168.0.10:ssh                              192.168.0.6:51740\n\n\n```\n\n##4.2 \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u78ba\u7acb\u6e08\u30bd\u30b1\u30c3\u30c8\u306e\u8abf\u3079\u65b9(\u6570\u5024\u3067\u8868\u793a)\n\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u30b5\u30fc\u30d3\u30b9\u540d\u3067\u306f\u306a\u304f\u6570\u5024\u3067\u8868\u793a\u3059\u308b(-n)\u3002\n\n```\n[root@master ~]# ss -nt\nState       Recv-Q Send-Q                                 Local Address:Port                                                Peer Address:Port\nESTAB       0      0                                       192.168.0.10:22                                                   192.168.0.6:50031\nESTAB       0      96                                      192.168.0.10:22                                                   192.168.0.6:51740\n\n```\n\n##4.3 \u30ea\u30b9\u30cb\u30f3\u30b0\u30bd\u30b1\u30c3\u30c8(-l)\u306e\u8abf\u3079\u65b9\n\n```\n[root@master ~]# ss -lnt|grep 22\nState      Recv-Q Send-Q     Local Address:Port         Peer Address:Port\nLISTEN     0      128          *:22                       *:*\nLISTEN     0      128         :::22                      :::*\n\n```\n\n\n##4.4 \u30bd\u30b1\u30c3\u30c8\u3092\u4f7f\u3063\u3066\u3044\u308b\u30d7\u30ed\u30bb\u30b9\u306e\u8abf\u3079\u65b9(-p)\n\n```\n[root@master ~]# ss -lnpt|grep 22\n\nLISTEN     0      128          *:22                 *:*                 users:((\"sshd\",pid=1039,fd=3))\nLISTEN     0      128         :::22                :::*                 users:((\"sshd\",pid=1039,fd=4))\n\n```\n\n\n\n\n##4.5 TIME-WAIT\u72b6\u614b\u306e\u30bd\u30b1\u30c3\u30c8\u306e\u8abf\u3079\u65b9(state time-wait)\n\n```\n\u30b5\u30fc\u30d0\u3067nc\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u300211111\u756a\u30dd\u30fc\u30c8\u3067\u30ea\u30c3\u30b9\u30f3\u3059\u308b\u3002\n[root@master ~]# nc -l 11111\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067nc\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3002Ctrl+c\u3092\u62bc\u4e0b\u3057\u3066TCP\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3092\u5207\u65ad\u3059\u308b\u3002\n[root@node1 ~]# nc master 11111\n^C\n\nTIME-WAIT\u72b6\u614b\u306e\u30bd\u30b1\u30c3\u30c8\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u5207\u65ad\u76f4\u5f8c\u306a\u306e\u3067\u3001\u30bf\u30a4\u30de\u304c59\u79d2\u306b\u306a\u3063\u3066\u3044\u308b(\u2605\u5370)\u3002\n[root@node1 ~]# ss -not state time-wait\nRecv-Q Send-Q             Local Address:Port            Peer Address:Port\n0      0                  192.168.0.20:53691            192.168.0.10:11111         timer:(timewait,\u260559sec,0)\n\n-\u4e2d\u7565-\n\nTIME-WAIT\u72b6\u614b\u306e\u30bd\u30b1\u30c3\u30c8\u306e\u30bf\u30a4\u30de\u304c\u6b8b\u308a515\u30df\u30ea\u79d2\u3067\u3042\u308b\u3053\u3068\u304c\u308f\u304b\u308b(\u2605\u5370)\u3002\n[root@node1 ~]# ss -not state time-wait\nRecv-Q Send-Q             Local Address:Port            Peer Address:Port\n0      0                  192.168.0.20:53691            192.168.0.10:11111         timer:(timewait,\u2605515ms,0)\n\n60\u79d2\u7d4c\u904e\u3057\u305f\u306e\u3067\u3001TIME-WAIT\u72b6\u614b\u306e\u30bd\u30b1\u30c3\u30c8\u304c\u6d88\u3048\u305f\u3002\n[root@node1 ~]# ss -not state time-wait\nRecv-Q Send-Q             Local Address:Port            Peer Address:Port\n[root@node1 ~]#\n\n\n```\n\n##4.6 SYS-SENT\u72b6\u614b\u306e\u30bd\u30b1\u30c3\u30c8\u306e\u8abf\u3079\u65b9(state syn-sent)\n\n```\n\n\n\n               \u30af\u30e9\u30a4\u30a2\u30f3\u30c8                        \u30b5\u30fc\u30d0\n                 (node1)                           (master)\n                    |                                 |\n                    |                                 | <- iptables -A INPUT -p tcp --dport 11111 -j DROP\n                    |                                 |\n                    |                                 | <- nc -l 11111\n                    |                                 |\n nc master 11111 -> |                                 |\n             -*-    |------------- SYN -------------->| <- \u5ec3\u68c4\n              |     |                                 |\n           SYS-SENT |------------- SYN -------------->| <- \u5ec3\u68c4\n              |     |                                 |\n             -*-    |------------- SYN -------------->| <- \u5ec3\u68c4\n                    |                                 |\n\n\n--------------------------\n1. \u30b5\u30fc\u30d0(master)\u5074\u306e\u8a2d\u5b9a\n--------------------------\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8(node1)\u304b\u3089\u5230\u7740\u3059\u308b11111\u756a\u30dd\u30fc\u30c8\u5b9b\u3066\u306e\u30d1\u30b1\u30c3\u30c8\u3092\u5ec3\u68c4\u3059\u308b\u3002\n[root@master ~]# iptables -A INPUT -p tcp --dport 11111 -j DROP\n\n\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# iptables -nvL INPUT --line-numbers\nChain INPUT (policy ACCEPT 13 packets, 1400 bytes)\nnum   pkts bytes target     prot opt in     out     source               destination\n1        0     0 DROP       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:11111\n[root@master ~]#\n\nnc\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u300211111\u756a\u30dd\u30fc\u30c8\u3067TCP\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u78ba\u7acb\u3092\u5f85\u3064\u3002\n[root@master ~]# nc -l 11111\n\n-----------------------------\n2. \u30af\u30e9\u30a4\u30a2\u30f3\u30c8(node1)\u306e\u8a2d\u5b9a\n-----------------------------\n\u30b5\u30fc\u30d0\u306e11111\u756a\u30dd\u30fc\u30c8\u306bTCP\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3092\u78ba\u7acb\u3059\u308b\u3002\n[root@node1 ~]# nc master 11111\nNcat: Connection timed out.\n\n\n\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u958b\u3044\u3066\u3001\u30bd\u30b1\u30c3\u30c8\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002SYS-SENT\u72b6\u614b\u306e\u30bd\u30b1\u30c3\u30c8\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n[root@node1 ~]# ss -not state syn-sent\nRecv-Q Send-Q                             Local Address:Port         Peer Address:Port\n0      1                                   192.168.0.20:53698        192.168.0.10:11111        timer:(on,1.569ms,1)\n[root@node1 ~]# ss -not state syn-sent\nRecv-Q Send-Q                             Local Address:Port         Peer Address:Port\n0      1                                   192.168.0.20:53698        192.168.0.10:11111        timer:(on,198ms,1)\n[root@node1 ~]# ss -not state syn-sent\nRecv-Q Send-Q                             Local Address:Port         Peer Address:Port\n0      1                                   192.168.0.20:53698        192.168.0.10:11111        timer:(on,2.636ms,2)\n[root@node1 ~]# ss -not state syn-sent\nRecv-Q Send-Q                             Local Address:Port         Peer Address:Port\n0      1                                   192.168.0.20:53698        192.168.0.10:11111        timer:(on,1.364ms,2)\n[root@node1 ~]# ss -not state syn-sent\nRecv-Q Send-Q                             Local Address:Port         Peer Address:Port\n0      1                                   192.168.0.20:53698        192.168.0.10:11111        timer:(on,163ms,2)\n[root@node1 ~]# ss -not state syn-sent\nRecv-Q Send-Q                             Local Address:Port         Peer Address:Port\n0      1                                   192.168.0.20:53698        192.168.0.10:11111        timer:(on,6.894ms,3)\n[root@node1 ~]# ss -not state syn-sent\nRecv-Q Send-Q                             Local Address:Port         Peer Address:Port\n0      1                                   192.168.0.20:53698        192.168.0.10:11111        timer:(on,5.783ms,3)\n[root@node1 ~]# ss -not state syn-sent\nRecv-Q Send-Q                             Local Address:Port         Peer Address:Port\n[root@node1 ~]#\n\n-------------\n3. \u3042\u3068\u59cb\u672b\n-------------\n[root@master ~]# iptables -D INPUT 1\n[root@master ~]# iptables -nvL INPUT --line-numbers\nChain INPUT (policy ACCEPT 5 packets, 488 bytes)\nnum   pkts bytes target     prot opt in     out     source               destination\n[root@master ~]#\n\n```\n\n##4.7 SYS-RECV\u72b6\u614b\u306e\u30bd\u30b1\u30c3\u30c8\u306e\u8abf\u3079\u65b9(state syn-recv)\n\n```\n-----------------------------\n1. \u30af\u30e9\u30a4\u30a2\u30f3\u30c8(node1)\u306e\u8a2d\u5b9a\n-----------------------------\n\u30b5\u30fc\u30d0(master)\u304b\u3089\u306eSYN+ACK\u3092\u5ec3\u68c4\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n[root@node1 ~]# iptables -A INPUT -p tcp --sport 11111 -j DROP\n\n\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@node1 ~]# iptables -nvL INPUT --line-numbers\nChain INPUT (policy ACCEPT 42 packets, 4080 bytes)\nnum   pkts bytes target     prot opt in     out     source               destination\n1        0     0 DROP       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp spt:11111\n[root@node1 ~]#\n\n\n-----------------------------\n2. \u30b5\u30fc\u30d0(master)\u306e\u8a2d\u5b9a\n-----------------------------\n[root@master ~]# nc -l 11111\n\n\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u958b\u304f\u3002\u30bd\u30b1\u30c3\u30c8\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# ss -not state syn-recv\nRecv-Q Send-Q                      Local Address:Port          Peer Address:Port\n[root@master ~]# ss -not state syn-recv\nRecv-Q Send-Q                           Local Address:Port          Peer Address:Port\n0      0                                 192.168.0.10:11111         192.168.0.20:53702     timer:(on,451ms,0)\n[root@master ~]# ss -not state syn-recv\nRecv-Q Send-Q                           Local Address:Port          Peer Address:Port\n0      0                                 192.168.0.10:11111         192.168.0.20:53702     timer:(on,608ms,2)\n[root@master ~]# ss -not state syn-recv\nRecv-Q Send-Q                           Local Address:Port          Peer Address:Port\n0      0                                 192.168.0.10:11111         192.168.0.20:53702     timer:(on,,3)\n[root@master ~]# ss -not state syn-recv\nRecv-Q Send-Q                           Local Address:Port          Peer Address:Port\n0      0                                 192.168.0.10:11111         192.168.0.20:53702     timer:(on,3.264ms,4)\n[root@master ~]# ss -not state syn-recv\nRecv-Q Send-Q                           Local Address:Port          Peer Address:Port\n0      0                                 192.168.0.10:11111         192.168.0.20:53702     timer:(on,1.125ms,5)\n[root@master ~]# ss -not state syn-recv\nRecv-Q Send-Q                           Local Address:Port          Peer Address:Port\n0      0                                 192.168.0.10:11111         192.168.0.20:53702     timer:(on,,5)\n[root@master ~]# \n\n```\n\n\n#x \u53c2\u8003\u60c5\u5831\n[10 examples of Linux ss command to monitor network connections](http://www.binarytides.com/linux-ss-command/)\n\n\n"}