{"context": "\u5bc2\u3057\u3044\u5fc3\u3092\u7d1b\u3089\u308f\u3059\u305f\u3081\u306b\u6614\u4f5c\u3063\u305f\u3084\u3064\u3092\u4f9b\u990a\u3059\u308b\uff08\u5f8c\u4ed8\u306e\u53e3\u4e0a\uff09\nServerman@VPS\u3067CentOS6\u4ee5\u4e0b\u3092\u60f3\u5b9a\u3001\u53e4\u3044\u306e\u3067\u9069\u5b9crpm\u306e\u53d6\u5f97\u5148\u306a\u3069\u3092\u5909\u66f4\u3059\u308b\u5fc5\u8981\u3082\u3042\u308b\u306f\u305a\u3002\u3068\u3044\u3046\u304b\u4eca\u52d5\u304f\u304b\u308f\u304b\u3089\u3093\u3002sudo\u3067\u3046\u3054\u304f\u30e4\u30d0\u30b2\u306abash script\u306e\u53c2\u8003\u306b\u3067\u3082\u3057\u3066\u304f\u308c\u3084\u2026\n$ sudo ./openvpninstaller.sh yourusername yourpassword\n\u3061\u306a\u307f\u306bVPN\u306e\u4f7f\u7528\u7bc4\u56f2\u306a\u3069\u306b\u3064\u3044\u3066\u306f\u3001DTI\u306e\u5229\u7528\u898f\u7d04\u7b49\u306b\u5f93\u3046\u3088\u3046\u306b\u3057\u3088\u3046\u306d\u3002\n#!/bin/bash\n\ncat <<__EOC__\nOpenVPN install script for Serversman@VPS\n\n__EOC__\n\n# \u5b9f\u884c\u6642\u306b\u6307\u5b9a\u3055\u308c\u305f\u5f15\u6570\u306e\u6570\u3001\u3064\u307e\u308a\u5909\u6570 $# \u306e\u5024\u304c 2 \u3067\u306a\u3051\u308c\u3070\u30a8\u30e9\u30fc\u7d42\u4e86\u3002\nif [ $# -ne 2 ]; then\n  echo \"\u5f15\u6570\u304c\u305f\u308a\u307e\u305b\u3093\"\n  echo \"sudo ./openvpninstaller.sh [SetUsername] [SetPassword]\" \n  exit 1\nfi\n\n#ip\u306e\u53d6\u5f97\nip=`grep IPADDR /etc/sysconfig/network-scripts/ifcfg-venet0:0 | awk -F= '{print $2}'`\n\n#\u53d6\u5f97\u7d50\u679c\u3092\u51fa\u3059\ncat <<__EOT__\n    Set Username: $1\n    Set Password: $2\n    IP Address: $ip\n__EOT__\n\n#\u30b9\u30bf\u30fc\u30c8\u3057\u3066\u826f\u3044\u304b\u5224\u5b9a\necho -n \"Start? [Y/n]:\"\nread start\ncase \"$start\" in\n    y | yes | Y   ) echo \"OK Starting.\" ;;\n    *             ) exit ;;\nesac\n\n#\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\nuseradd $1\necho \"Created user account [$1]\"\necho $1\":\"$2 | chpasswd\n\n#lzo\u3068rpmforge\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306a\u3069\nyum install -y zip yum-cron gcc make rpm-build autoconf.noarch zlib-devel pam-devel openssl-devel bridge-utils\nwget http://openvpn.net/release/lzo-1.08-4.rf.src.rpm\nwget http://pkgs.repoforge.org/rpmforge-release/rpmforge-release-0.5.2-2.el6.rf.x86_64.rpm\nrpmbuild --rebuild lzo-1.08-4.rf.src.rpm\nrpm -Uvh lzo-*.rpm\nrpm -Uvh rpmforge-release*\n\n#\u5fc5\u8981\u306a\u3082\u306e\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fb\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\nyum update -y\nyum install -y dnsmasq openvpn\n\n#OpenVPN\u8a2d\u5b9a\ncp -R /usr/share/doc/openvpn-2.2.2/easy-rsa/ /etc/openvpn/\nsed -i -e 's;KEY_CONFIG=.$EASY_RSA/whichopensslcnf $EASY_RSA.;KEY_CONFIG=/etc/openvpn/easy-rsa/2\\.0/openssl-1\\.0\\.0\\.cnf;g' /etc/openvpn/easy-rsa/2.0/vars\ncd /etc/openvpn/easy-rsa/2.0\nchmod 755 *\nsource ./vars\n./vars\n./clean-all\n./build-ca\n./build-key-server server\n./build-dh\n\n#\u30b5\u30fc\u30d0\u30fc\u30b3\u30f3\u30d5\u30a3\u30b0\nserverconf='    port 1194\n    proto udp\n    dev tun\n    tun-mtu 1500\n    tun-mtu-extra 32\n    mssfix 1450\n    reneg-sec 0\n    ca /etc/openvpn/easy-rsa/2.0/keys/ca.crt\n    cert /etc/openvpn/easy-rsa/2.0/keys/server.crt\n    key /etc/openvpn/easy-rsa/2.0/keys/server.key\n    dh /etc/openvpn/easy-rsa/2.0/keys/dh1024.pem\n    plugin /usr/share/openvpn/plugin/lib/openvpn-auth-pam.so /etc/pam.d/login\n    client-cert-not-required\n    username-as-common-name\n    ifconfig-pool-persist ipp.txt\n    server 10.8.0.0 255.255.255.0\n    push \"route 10.8.0.0 255.255.255.0\"\n    push \"redirect-gateway def1 bypass-dhcp\"\n    push \"dhcp-option DNS 8.8.8.8\"\n    push \"dhcp-option DNS 8.8.4.4\"\n    keepalive 5 30\n    client-to-client\n    duplicate-cn\n    comp-lzo\n    persist-key\n    persist-tun\n    status 1194.log\n    verb 3'\necho \"$serverconf\" > /etc/openvpn/server.conf\n\n#sysctl\u66f8\u304d\u63db\u3048\nsed -i -e 's/net.ipv4.ip_forward = 0/net.ipv4.ip_forward = 1/g' /etc/sysctl.conf\necho 'net.ipv4.conf.all.send_redirects = 0' >> /etc/sysctl.conf\necho 'net.ipv4.conf.all.accept_redirects = 0' >> /etc/sysctl.conf\nsysctl -p\n\n#iptables\u66f8\u304d\u63db\u3048\niptables -A FORWARD -s 10.8.0.0/255.255.255.0 -j ACCEPT\niptables -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT \niptables -t nat -A POSTROUTING -s 10.8.0.0/255.255.255.0 -j SNAT --to-source ${ip}\niptables-save > /etc/sysconfig/iptables\nsed -i 's/eth0/venet0/g' /etc/sysconfig/iptables\n\n#.ca .ovpn\u306e\u66f8\u304d\u51fa\u3057\ncd ~\nvpndir=vpn-${1}\nmkdir $vpndir\necho \"Make directory [${vpndir}]\"\ncp /etc/openvpn/easy-rsa/2.0/keys/ca.crt ${vpndir}/ca-${1}.crt\necho \"Copy certification file: [${vpndir}/ca-${1}.crt]\"\nvpnfile='   client\n    dev tun\n    proto udp\n    remote '${ip}' 1194\n    resolv-retry infinite\n    nobind\n    tun-mtu 1500\n    tun-mtu-extra 32\n    mssfix 1450\n    persist-key\n    persist-tun\n    ca ca-'${1}'.crt\n    auth-user-pass\n    comp-lzo\n    reneg-sec 0\n    verb 3'\necho \"${vpnfile}\" > ${vpndir}/vpn-${1}.ovpn\necho \"Make OpenVPN config file: [${vpndir}/vpn-${1}.ovpn]\"\nzip -r ~/${vpndir}.zip ${vpndir}\n\n#\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u30b5\u30fc\u30d3\u30b9\u306eON\nservice yum-cron start\nchkconfig yum-cron on\nservice openvpn start\nchkconfig openvpn on\nservice dnsmasq start\nchkconfig dnsmasq on\n\ncat <<__EOC__\nFinished install OpenVPN!\n\n__EOC__\n\n\n\u3061\u306a\u307f\u306b5\u5e74\u307b\u3069\u5f7c\u5973\u304a\u3089\u3093\n\u5bc2\u3057\u3044\u5fc3\u3092\u7d1b\u3089\u308f\u3059\u305f\u3081\u306b\u6614\u4f5c\u3063\u305f\u3084\u3064\u3092\u4f9b\u990a\u3059\u308b\uff08\u5f8c\u4ed8\u306e\u53e3\u4e0a\uff09\n\nServerman@VPS\u3067CentOS6\u4ee5\u4e0b\u3092\u60f3\u5b9a\u3001\u53e4\u3044\u306e\u3067\u9069\u5b9crpm\u306e\u53d6\u5f97\u5148\u306a\u3069\u3092\u5909\u66f4\u3059\u308b\u5fc5\u8981\u3082\u3042\u308b\u306f\u305a\u3002\u3068\u3044\u3046\u304b\u4eca\u52d5\u304f\u304b\u308f\u304b\u3089\u3093\u3002sudo\u3067\u3046\u3054\u304f\u30e4\u30d0\u30b2\u306abash script\u306e\u53c2\u8003\u306b\u3067\u3082\u3057\u3066\u304f\u308c\u3084\u2026\n\n`$ sudo ./openvpninstaller.sh yourusername yourpassword`\n\n\u3061\u306a\u307f\u306bVPN\u306e\u4f7f\u7528\u7bc4\u56f2\u306a\u3069\u306b\u3064\u3044\u3066\u306f\u3001DTI\u306e\u5229\u7528\u898f\u7d04\u7b49\u306b\u5f93\u3046\u3088\u3046\u306b\u3057\u3088\u3046\u306d\u3002\n\n```bash\n#!/bin/bash\n\ncat <<__EOC__\nOpenVPN install script for Serversman@VPS\n\n__EOC__\n\n# \u5b9f\u884c\u6642\u306b\u6307\u5b9a\u3055\u308c\u305f\u5f15\u6570\u306e\u6570\u3001\u3064\u307e\u308a\u5909\u6570 $# \u306e\u5024\u304c 2 \u3067\u306a\u3051\u308c\u3070\u30a8\u30e9\u30fc\u7d42\u4e86\u3002\nif [ $# -ne 2 ]; then\n  echo \"\u5f15\u6570\u304c\u305f\u308a\u307e\u305b\u3093\"\n  echo \"sudo ./openvpninstaller.sh [SetUsername] [SetPassword]\" \n  exit 1\nfi\n\n#ip\u306e\u53d6\u5f97\nip=`grep IPADDR /etc/sysconfig/network-scripts/ifcfg-venet0:0 | awk -F= '{print $2}'`\n\n#\u53d6\u5f97\u7d50\u679c\u3092\u51fa\u3059\ncat <<__EOT__\n\tSet Username: $1\n\tSet Password: $2\n\tIP Address: $ip\n__EOT__\n\n#\u30b9\u30bf\u30fc\u30c8\u3057\u3066\u826f\u3044\u304b\u5224\u5b9a\necho -n \"Start? [Y/n]:\"\nread start\ncase \"$start\" in\n\ty | yes | Y   ) echo \"OK Starting.\" ;;\n\t*             ) exit ;;\nesac\n\n#\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\nuseradd $1\necho \"Created user account [$1]\"\necho $1\":\"$2 | chpasswd\n\n#lzo\u3068rpmforge\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306a\u3069\nyum install -y zip yum-cron gcc make rpm-build autoconf.noarch zlib-devel pam-devel openssl-devel bridge-utils\nwget http://openvpn.net/release/lzo-1.08-4.rf.src.rpm\nwget http://pkgs.repoforge.org/rpmforge-release/rpmforge-release-0.5.2-2.el6.rf.x86_64.rpm\nrpmbuild --rebuild lzo-1.08-4.rf.src.rpm\nrpm -Uvh lzo-*.rpm\nrpm -Uvh rpmforge-release*\n\n#\u5fc5\u8981\u306a\u3082\u306e\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fb\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\nyum update -y\nyum install -y dnsmasq openvpn\n\n#OpenVPN\u8a2d\u5b9a\ncp -R /usr/share/doc/openvpn-2.2.2/easy-rsa/ /etc/openvpn/\nsed -i -e 's;KEY_CONFIG=.$EASY_RSA/whichopensslcnf $EASY_RSA.;KEY_CONFIG=/etc/openvpn/easy-rsa/2\\.0/openssl-1\\.0\\.0\\.cnf;g' /etc/openvpn/easy-rsa/2.0/vars\ncd /etc/openvpn/easy-rsa/2.0\nchmod 755 *\nsource ./vars\n./vars\n./clean-all\n./build-ca\n./build-key-server server\n./build-dh\n\n#\u30b5\u30fc\u30d0\u30fc\u30b3\u30f3\u30d5\u30a3\u30b0\nserverconf='\tport 1194\n\tproto udp\n\tdev tun\n\ttun-mtu 1500\n\ttun-mtu-extra 32\n\tmssfix 1450\n\treneg-sec 0\n\tca /etc/openvpn/easy-rsa/2.0/keys/ca.crt\n\tcert /etc/openvpn/easy-rsa/2.0/keys/server.crt\n\tkey /etc/openvpn/easy-rsa/2.0/keys/server.key\n\tdh /etc/openvpn/easy-rsa/2.0/keys/dh1024.pem\n\tplugin /usr/share/openvpn/plugin/lib/openvpn-auth-pam.so /etc/pam.d/login\n\tclient-cert-not-required\n\tusername-as-common-name\n\tifconfig-pool-persist ipp.txt\n\tserver 10.8.0.0 255.255.255.0\n\tpush \"route 10.8.0.0 255.255.255.0\"\n\tpush \"redirect-gateway def1 bypass-dhcp\"\n\tpush \"dhcp-option DNS 8.8.8.8\"\n\tpush \"dhcp-option DNS 8.8.4.4\"\n\tkeepalive 5 30\n\tclient-to-client\n\tduplicate-cn\n\tcomp-lzo\n\tpersist-key\n\tpersist-tun\n\tstatus 1194.log\n\tverb 3'\necho \"$serverconf\" > /etc/openvpn/server.conf\n\n#sysctl\u66f8\u304d\u63db\u3048\nsed -i -e 's/net.ipv4.ip_forward = 0/net.ipv4.ip_forward = 1/g' /etc/sysctl.conf\necho 'net.ipv4.conf.all.send_redirects = 0' >> /etc/sysctl.conf\necho 'net.ipv4.conf.all.accept_redirects = 0' >> /etc/sysctl.conf\nsysctl -p\n\n#iptables\u66f8\u304d\u63db\u3048\niptables -A FORWARD -s 10.8.0.0/255.255.255.0 -j ACCEPT\niptables -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT \niptables -t nat -A POSTROUTING -s 10.8.0.0/255.255.255.0 -j SNAT --to-source ${ip}\niptables-save > /etc/sysconfig/iptables\nsed -i 's/eth0/venet0/g' /etc/sysconfig/iptables\n\n#.ca .ovpn\u306e\u66f8\u304d\u51fa\u3057\ncd ~\nvpndir=vpn-${1}\nmkdir $vpndir\necho \"Make directory [${vpndir}]\"\ncp /etc/openvpn/easy-rsa/2.0/keys/ca.crt ${vpndir}/ca-${1}.crt\necho \"Copy certification file: [${vpndir}/ca-${1}.crt]\"\nvpnfile='\tclient\n\tdev tun\n\tproto udp\n\tremote '${ip}' 1194\n\tresolv-retry infinite\n\tnobind\n\ttun-mtu 1500\n\ttun-mtu-extra 32\n\tmssfix 1450\n\tpersist-key\n\tpersist-tun\n\tca ca-'${1}'.crt\n\tauth-user-pass\n\tcomp-lzo\n\treneg-sec 0\n\tverb 3'\necho \"${vpnfile}\" > ${vpndir}/vpn-${1}.ovpn\necho \"Make OpenVPN config file: [${vpndir}/vpn-${1}.ovpn]\"\nzip -r ~/${vpndir}.zip ${vpndir}\n\n#\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u30b5\u30fc\u30d3\u30b9\u306eON\nservice yum-cron start\nchkconfig yum-cron on\nservice openvpn start\nchkconfig openvpn on\nservice dnsmasq start\nchkconfig dnsmasq on\n\ncat <<__EOC__\nFinished install OpenVPN!\n\n__EOC__\n\n```\n\n\u3061\u306a\u307f\u306b5\u5e74\u307b\u3069\u5f7c\u5973\u304a\u3089\u3093\n", "tags": ["Bash", "OpenVPN"]}