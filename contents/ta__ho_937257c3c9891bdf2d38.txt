{"context": "\n\n\u3084\u308a\u305f\u3044\u3053\u3068\nweb\u30da\u30fc\u30b8\u304c\u975e\u8868\u793a\u306b\u306a\u3063\u305f\u3053\u3068\u3092\u691c\u77e5\u3057\u3066\u3001\u51e6\u7406\u3092\u884c\u3044\u305f\u3044\n\n\u691c\u8a3c\n\n\u691c\u8a3c\u74b0\u5883\n\niOS : iPhone6 (9.3.1)\nAndroid : Xperia501SO (5.1.1)\nProxy : BurpSuite (1.6.32)\n\n\n\u691c\u8a3c\u5185\u5bb9\uff08\u305d\u306e1\uff09\nbeforeunload / pagehide / unload\u30a4\u30d9\u30f3\u30c8\u3092\u4ed5\u8fbc\u3093\u3067\u3084\u3063\u3066\u307f\u305f\n\n\u691c\u8a3c\u7d50\u679c\uff08\u305d\u306e1\uff09\n[iOS]\n\n\n\n\u52d5\u4f5c\n\u767a\u751f\u30a4\u30d9\u30f3\u30c8\n\n\n\n\n\u30da\u30fc\u30b8\u30ea\u30ed\u30fc\u30c9\npagehide  unload\n\n\n\u30ea\u30f3\u30af\u30bf\u30c3\u30d7\npagehide  unload\n\n\n\u30ea\u30f3\u30af\u30bf\u30c3\u30d7(target blunk)\n-\n\n\n\u30d6\u30e9\u30a6\u30b6\u30d0\u30c3\u30af\npagehide  unload\n\n\n\u96fb\u6e90\u30dc\u30bf\u30f3\u30bf\u30c3\u30d7\n-\n\n\n\u30db\u30fc\u30e0\u30dc\u30bf\u30f3\n-\n\n\n\u30db\u30fc\u30e0\u30dc\u30bf\u30f3\uff08\u30c0\u30d6\u30eb\u30bf\u30c3\u30d7\uff09\n-\n\n\n\n[Android]\n\n\n\n\u52d5\u4f5c\n\u767a\u751f\u30a4\u30d9\u30f3\u30c8\n\n\n\n\n\u30da\u30fc\u30b8\u30ea\u30ed\u30fc\u30c9\nbeforeunload  pagehide  unload\n\n\n\u30ea\u30f3\u30af\u30bf\u30c3\u30d7\nbeforeunload  pagehide  unload\n\n\n\u30ea\u30f3\u30af\u30bf\u30c3\u30d7(target blunk)\n-\n\n\n\u30d6\u30e9\u30a6\u30b6\u30d0\u30c3\u30af\nbeforeunload  pagehide  unload\n\n\n\u96fb\u6e90\u30dc\u30bf\u30f3\u30bf\u30c3\u30d7\n-\n\n\n\u30db\u30fc\u30e0\u30dc\u30bf\u30f3\n-\n\n\n\u30a2\u30d7\u30ea\u5c65\u6b74\u30dc\u30bf\u30f3\u30bf\u30c3\u30d7\n-\n\n\n\n\n\u8003\u5bdf\uff08\u305d\u306e1\uff09\n\u7d50\u679c\u304b\u3089\u308f\u304b\u308b\u901a\u308a\u3001\u30c7\u30d0\u30a4\u30b9\u306b\u5099\u308f\u3063\u3066\u3044\u308b\u30dc\u30bf\u30f3\u3092\u30bf\u30c3\u30d7\u3057\u305f\u6642\u306e\u30a4\u30d9\u30f3\u30c8\u304c\u62fe\u3048\u3066\u3044\u306a\u3044\niOS\u306f\u3001beforeunload\u304c\u547c\u3070\u308c\u306a\u3044\u307f\u305f\u3044\n\n\u691c\u8a3c\u5185\u5bb9\uff08\u305d\u306e2\uff09\n\u6b21\u306b\u3001Page Visibility API\u3092\u4ed5\u8fbc\u3093\u3067\u3084\u3063\u3066\u307f\u305f\n\n\u691c\u8a3c\u7d50\u679c\uff08\u305d\u306e2\uff09\n[iOS]\n\n\n\n\u52d5\u4f5c\n\u767a\u751f\u30a4\u30d9\u30f3\u30c8\n\n\n\n\n\u30da\u30fc\u30b8\u30ea\u30ed\u30fc\u30c9\n-\n\n\n\u30ea\u30f3\u30af\u30bf\u30c3\u30d7\n-\n\n\n\u30ea\u30f3\u30af\u30bf\u30c3\u30d7(target blunk)\n-\n\n\n\u30d6\u30e9\u30a6\u30b6\u30d0\u30c3\u30af\n-\n\n\n\u96fb\u6e90\u30dc\u30bf\u30f3\u30bf\u30c3\u30d7\nvisibilityChange\n\n\n\u30db\u30fc\u30e0\u30dc\u30bf\u30f3\nvisibilityChange\n\n\n\u30db\u30fc\u30e0\u30dc\u30bf\u30f3\uff08\u30c0\u30d6\u30eb\u30bf\u30c3\u30d7\uff09\n-\n\n\n\u30db\u30fc\u30e0\u30dc\u30bf\u30f3\uff08\u30c0\u30d6\u30eb\u30bf\u30c3\u30d7\uff09\u2192\u96fb\u6e90\u30dc\u30bf\u30f3\nvisibilityChange\n\n\n\n[Android]\n\n\n\n\u52d5\u4f5c\n\u767a\u751f\u30a4\u30d9\u30f3\u30c8\n\n\n\n\n\u30da\u30fc\u30b8\u30ea\u30ed\u30fc\u30c9\n-\n\n\n\u30ea\u30f3\u30af\u30bf\u30c3\u30d7\n-\n\n\n\u30ea\u30f3\u30af\u30bf\u30c3\u30d7(target blunk)\nvisibilityChange\n\n\n\u30d6\u30e9\u30a6\u30b6\u30d0\u30c3\u30af\n-\n\n\n\u96fb\u6e90\u30dc\u30bf\u30f3\u30bf\u30c3\u30d7\nvisibilityChange\n\n\n\u30db\u30fc\u30e0\u30dc\u30bf\u30f3\nvisibilityChange\n\n\n\u30a2\u30d7\u30ea\u5c65\u6b74\u30dc\u30bf\u30f3\u30bf\u30c3\u30d7\nvisibilityChange\n\n\n\n\n\u8003\u5bdf\uff08\u305d\u306e2\uff09\n\u5404\u7a2e\u30c7\u30d0\u30a4\u30b9\u306e\u30dc\u30bf\u30f3\u30a4\u30d9\u30f3\u30c8\u5f8c\u306b\u3001visibilityChange\u30a4\u30d9\u30f3\u30c8\u304c\u547c\u3070\u308c\u30da\u30fc\u30b8\u304c\u975e\u8868\u793a\u306b\u306a\u3063\u305f\u3053\u3068\u306f\u691c\u77e5\u3067\u304d\u305f\n\u305f\u3060\u3057\u3001\u3069\u306e\u52d5\u4f5c\u304c\u884c\u308f\u308c\u305f\u304b\u306f\u3001\u691c\u77e5\u3067\u304d\u306a\u3044\u307f\u305f\u3044\niOS\u306e\u5834\u5408\u3001\u30db\u30fc\u30e0\u30dc\u30bf\u30f3\u306e\u30c0\u30d6\u30eb\u30bf\u30c3\u30d7\u3067\u306f\u3001visibilityChange\u30a4\u30d9\u30f3\u30c8\u304c\u547c\u3070\u308c\u305a\u3001\u305d\u306e\u5f8c\u3001\u96fb\u6e90\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u307f\u305f\u3068\u3053\u308d\u3001visibilityChange\u30a4\u30d9\u30f3\u30c8\u304c\u547c\u3070\u308c\u305f\n\n\u7d50\u679c\u307e\u3068\u3081\n\u4ee5\u4e0a\u306e\u691c\u8a3c\u7d50\u679c\u304b\u3089beforeunload / pagehide / unload\u30a4\u30d9\u30f3\u30c8\u3068Page Visibility API\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3068\u30da\u30fc\u30b8\u304c\u975e\u8868\u793a\u306b\u306a\u308b\u52d5\u4f5c\u3092\u5927\u4f53\u6349\u3048\u3089\u308c\u308b\u3053\u3068\u304c\u308f\u304b\u3063\u305f\n\u30da\u30fc\u30b8\u9077\u79fb\u7cfb\u306e\u30a4\u30d9\u30f3\u30c8\u306f\u3001\u3068\u308a\u3042\u3048\u305a\u3001pagehide\u304bunload\u3092\u8aad\u3093\u3067\u304a\u3051\u3070\u5927\u4e08\u592b\niOS8\u3068\u304bAndroid 4/6\u7cfb\u3067\u3069\u3046\u52d5\u304f\u304b\u306f\u3001\u78ba\u8a8d\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u305d\u306e\u3046\u3061\u78ba\u8a8d\u3059\u308b\u4e88\u5b9a\n\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n\nsample.js\n// \u30c7\u30d0\u30a4\u30b9\u306e\u30dc\u30bf\u30f3\u30a4\u30d9\u30f3\u30c8\u3092\u691c\u77e5\u3059\u308b\u305f\u3081\u306e\u30ea\u30b9\u30ca\u30fc\nfunction setVisibilityEvent(){\n  var hidden, visibilityChange;\n  if (typeof document.hidden !== \"undefined\") {\n    hidden = \"hidden\";\n    visibilityChange = \"visibilitychange\";\n  } else if (typeof document.mozHidden !== \"undefined\") {\n    hidden = \"mozHidden\";\n    visibilityChange = \"mozvisibilitychange\";\n  } else if (typeof document.msHidden !== \"undefined\") {\n    hidden = \"msHidden\";\n    visibilityChange = \"msvisibilitychange\";\n  } else if (typeof document.webkitHidden !== \"undefined\") {\n    hidden = \"webkitHidden\";\n    visibilityChange = \"webkitvisibilitychange\";\n  }\n  document.addEventListener(visibilityChange, function(){\n    // \u30da\u30fc\u30b8\u975e\u8868\u793a\u3068\u8868\u793a\u6642\u306b\u547c\u3070\u308c\u308b\u305f\u3081\u3001\u8868\u793a\u304b\u3089\u975e\u8868\u793a\u306b\u306a\u3063\u305f\u6642\u3060\u3051\u547c\u3070\u308c\u308b\u3088\u3046\u306b\n    // document.hidden\u6761\u4ef6\u3092\u8ffd\u52a0\n    if(document.hidden){\n      request(\"visibilitychange\");\n    }\n  }, false);\n}\n\n// \u30da\u30fc\u30b8\u9077\u79fb\u30a4\u30d9\u30f3\u30c8\u3092\u691c\u77e5\u3059\u308b\u305f\u3081\u306e\u30ea\u30b9\u30ca\u30fc\nfunction setPageTransitionListener(){\n  window.addEventListener(\"pagehide\", function(){\n    request(\"pagehide\");\n  }, false);\n}\n\n// \u975e\u8868\u793a\u6642\u306e\u51e6\u7406\n// \u4ee5\u4e0b\u306e\u5834\u5408\u3001\u30b5\u30fc\u30d0\u306b\u901a\u77e5\u3059\u308b\u51e6\u7406\nfunction request(event){\n  var id = 'test_'+window.btoa(event);\n  var img = document.createElement('img');\n  var endPoint = 'http://...';\n  img.src = endPoint + query;\n  img.id = id;\n  body.appendChild(img);\n  img.parentNode.removeChild(img);\n}\n\nfunction main(){\n  setVisibilityEvent();\n  setPageTransitionListener();\n}\n\nmain();\n\n\n## \u3084\u308a\u305f\u3044\u3053\u3068\nweb\u30da\u30fc\u30b8\u304c\u975e\u8868\u793a\u306b\u306a\u3063\u305f\u3053\u3068\u3092\u691c\u77e5\u3057\u3066\u3001\u51e6\u7406\u3092\u884c\u3044\u305f\u3044\n\n## \u691c\u8a3c\n### \u691c\u8a3c\u74b0\u5883\n* iOS : iPhone6 (9.3.1)\n* Android : Xperia501SO (5.1.1)\n* Proxy : BurpSuite (1.6.32)\n\n\n### \u691c\u8a3c\u5185\u5bb9\uff08\u305d\u306e1\uff09\n[beforeunload](https://developer.mozilla.org/ja/docs/Web/Reference/Events/beforeunload) / [pagehide](https://developer.mozilla.org/ja/docs/Web/Events/pagehide) / [unload](https://developer.mozilla.org/ja/docs/Web/Events/unload)\u30a4\u30d9\u30f3\u30c8\u3092\u4ed5\u8fbc\u3093\u3067\u3084\u3063\u3066\u307f\u305f\n\n### \u691c\u8a3c\u7d50\u679c\uff08\u305d\u306e1\uff09\n\n[iOS]\n\n| \u52d5\u4f5c | \u767a\u751f\u30a4\u30d9\u30f3\u30c8 |\n|:------|:------|\n| \u30da\u30fc\u30b8\u30ea\u30ed\u30fc\u30c9            | pagehide <br> unload |\n| \u30ea\u30f3\u30af\u30bf\u30c3\u30d7              | pagehide <br> unload |\n| \u30ea\u30f3\u30af\u30bf\u30c3\u30d7(target blunk) | - |\n| \u30d6\u30e9\u30a6\u30b6\u30d0\u30c3\u30af            | pagehide <br> unload |\n| \u96fb\u6e90\u30dc\u30bf\u30f3\u30bf\u30c3\u30d7          | - |\n| \u30db\u30fc\u30e0\u30dc\u30bf\u30f3              | - |\n| \u30db\u30fc\u30e0\u30dc\u30bf\u30f3\uff08\u30c0\u30d6\u30eb\u30bf\u30c3\u30d7\uff09 | - |\n\n[Android]\n\n| \u52d5\u4f5c | \u767a\u751f\u30a4\u30d9\u30f3\u30c8 |\n|:------|:------|\n| \u30da\u30fc\u30b8\u30ea\u30ed\u30fc\u30c9            | beforeunload <br> pagehide <br> unload |\n| \u30ea\u30f3\u30af\u30bf\u30c3\u30d7              | beforeunload <br> pagehide <br> unload |\n| \u30ea\u30f3\u30af\u30bf\u30c3\u30d7(target blunk) | - |\n| \u30d6\u30e9\u30a6\u30b6\u30d0\u30c3\u30af            | beforeunload <br> pagehide <br> unload |\n| \u96fb\u6e90\u30dc\u30bf\u30f3\u30bf\u30c3\u30d7          | - |\n| \u30db\u30fc\u30e0\u30dc\u30bf\u30f3              | - |\n| \u30a2\u30d7\u30ea\u5c65\u6b74\u30dc\u30bf\u30f3\u30bf\u30c3\u30d7     | - |\n\n### \u8003\u5bdf\uff08\u305d\u306e1\uff09\n\u7d50\u679c\u304b\u3089\u308f\u304b\u308b\u901a\u308a\u3001\u30c7\u30d0\u30a4\u30b9\u306b\u5099\u308f\u3063\u3066\u3044\u308b\u30dc\u30bf\u30f3\u3092\u30bf\u30c3\u30d7\u3057\u305f\u6642\u306e\u30a4\u30d9\u30f3\u30c8\u304c\u62fe\u3048\u3066\u3044\u306a\u3044\niOS\u306f\u3001beforeunload\u304c\u547c\u3070\u308c\u306a\u3044\u307f\u305f\u3044\n\n### \u691c\u8a3c\u5185\u5bb9\uff08\u305d\u306e2\uff09\n\u6b21\u306b\u3001[Page Visibility API](https://developer.mozilla.org/ja/docs/Web/Guide/User_experience/Using_the_Page_Visibility_API)\u3092\u4ed5\u8fbc\u3093\u3067\u3084\u3063\u3066\u307f\u305f\n\n### \u691c\u8a3c\u7d50\u679c\uff08\u305d\u306e2\uff09\n\n[iOS]\n\n| \u52d5\u4f5c | \u767a\u751f\u30a4\u30d9\u30f3\u30c8 |\n|:------|:------|\n| \u30da\u30fc\u30b8\u30ea\u30ed\u30fc\u30c9            | - |\n| \u30ea\u30f3\u30af\u30bf\u30c3\u30d7              | - |\n| \u30ea\u30f3\u30af\u30bf\u30c3\u30d7(target blunk) | - |\n| \u30d6\u30e9\u30a6\u30b6\u30d0\u30c3\u30af            | - |\n| \u96fb\u6e90\u30dc\u30bf\u30f3\u30bf\u30c3\u30d7          | visibilityChange |\n| \u30db\u30fc\u30e0\u30dc\u30bf\u30f3              | visibilityChange |\n| \u30db\u30fc\u30e0\u30dc\u30bf\u30f3\uff08\u30c0\u30d6\u30eb\u30bf\u30c3\u30d7\uff09 | - |\n| \u30db\u30fc\u30e0\u30dc\u30bf\u30f3\uff08\u30c0\u30d6\u30eb\u30bf\u30c3\u30d7\uff09\u2192\u96fb\u6e90\u30dc\u30bf\u30f3 | visibilityChange |\n\n[Android]\n\n| \u52d5\u4f5c | \u767a\u751f\u30a4\u30d9\u30f3\u30c8 |\n|:------|:------|\n| \u30da\u30fc\u30b8\u30ea\u30ed\u30fc\u30c9            | - |\n| \u30ea\u30f3\u30af\u30bf\u30c3\u30d7              | - |\n| \u30ea\u30f3\u30af\u30bf\u30c3\u30d7(target blunk) | visibilityChange |\n| \u30d6\u30e9\u30a6\u30b6\u30d0\u30c3\u30af            | - |\n| \u96fb\u6e90\u30dc\u30bf\u30f3\u30bf\u30c3\u30d7          | visibilityChange |\n| \u30db\u30fc\u30e0\u30dc\u30bf\u30f3              | visibilityChange |\n| \u30a2\u30d7\u30ea\u5c65\u6b74\u30dc\u30bf\u30f3\u30bf\u30c3\u30d7     | visibilityChange |\n\n### \u8003\u5bdf\uff08\u305d\u306e2\uff09\n\u5404\u7a2e\u30c7\u30d0\u30a4\u30b9\u306e\u30dc\u30bf\u30f3\u30a4\u30d9\u30f3\u30c8\u5f8c\u306b\u3001visibilityChange\u30a4\u30d9\u30f3\u30c8\u304c\u547c\u3070\u308c\u30da\u30fc\u30b8\u304c\u975e\u8868\u793a\u306b\u306a\u3063\u305f\u3053\u3068\u306f\u691c\u77e5\u3067\u304d\u305f\n\u305f\u3060\u3057\u3001\u3069\u306e\u52d5\u4f5c\u304c\u884c\u308f\u308c\u305f\u304b\u306f\u3001\u691c\u77e5\u3067\u304d\u306a\u3044\u307f\u305f\u3044\niOS\u306e\u5834\u5408\u3001\u30db\u30fc\u30e0\u30dc\u30bf\u30f3\u306e\u30c0\u30d6\u30eb\u30bf\u30c3\u30d7\u3067\u306f\u3001visibilityChange\u30a4\u30d9\u30f3\u30c8\u304c\u547c\u3070\u308c\u305a\u3001\u305d\u306e\u5f8c\u3001\u96fb\u6e90\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u307f\u305f\u3068\u3053\u308d\u3001visibilityChange\u30a4\u30d9\u30f3\u30c8\u304c\u547c\u3070\u308c\u305f\n\n## \u7d50\u679c\u307e\u3068\u3081\n\u4ee5\u4e0a\u306e\u691c\u8a3c\u7d50\u679c\u304b\u3089[beforeunload](https://developer.mozilla.org/ja/docs/Web/Reference/Events/beforeunload) / [pagehide](https://developer.mozilla.org/ja/docs/Web/Events/pagehide) / [unload](https://developer.mozilla.org/ja/docs/Web/Events/unload)\u30a4\u30d9\u30f3\u30c8\u3068[Page Visibility API](https://developer.mozilla.org/ja/docs/Web/Guide/User_experience/Using_the_Page_Visibility_API)\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3068\u30da\u30fc\u30b8\u304c\u975e\u8868\u793a\u306b\u306a\u308b\u52d5\u4f5c\u3092\u5927\u4f53\u6349\u3048\u3089\u308c\u308b\u3053\u3068\u304c\u308f\u304b\u3063\u305f\n\n\u30da\u30fc\u30b8\u9077\u79fb\u7cfb\u306e\u30a4\u30d9\u30f3\u30c8\u306f\u3001\u3068\u308a\u3042\u3048\u305a\u3001`pagehide`\u304b`unload`\u3092\u8aad\u3093\u3067\u304a\u3051\u3070\u5927\u4e08\u592b\niOS8\u3068\u304bAndroid 4/6\u7cfb\u3067\u3069\u3046\u52d5\u304f\u304b\u306f\u3001\u78ba\u8a8d\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u305d\u306e\u3046\u3061\u78ba\u8a8d\u3059\u308b\u4e88\u5b9a\n\n## \u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n\n```sample.js\n// \u30c7\u30d0\u30a4\u30b9\u306e\u30dc\u30bf\u30f3\u30a4\u30d9\u30f3\u30c8\u3092\u691c\u77e5\u3059\u308b\u305f\u3081\u306e\u30ea\u30b9\u30ca\u30fc\nfunction setVisibilityEvent(){\n  var hidden, visibilityChange;\n  if (typeof document.hidden !== \"undefined\") {\n    hidden = \"hidden\";\n    visibilityChange = \"visibilitychange\";\n  } else if (typeof document.mozHidden !== \"undefined\") {\n    hidden = \"mozHidden\";\n    visibilityChange = \"mozvisibilitychange\";\n  } else if (typeof document.msHidden !== \"undefined\") {\n    hidden = \"msHidden\";\n    visibilityChange = \"msvisibilitychange\";\n  } else if (typeof document.webkitHidden !== \"undefined\") {\n    hidden = \"webkitHidden\";\n    visibilityChange = \"webkitvisibilitychange\";\n  }\n  document.addEventListener(visibilityChange, function(){\n    // \u30da\u30fc\u30b8\u975e\u8868\u793a\u3068\u8868\u793a\u6642\u306b\u547c\u3070\u308c\u308b\u305f\u3081\u3001\u8868\u793a\u304b\u3089\u975e\u8868\u793a\u306b\u306a\u3063\u305f\u6642\u3060\u3051\u547c\u3070\u308c\u308b\u3088\u3046\u306b\n    // document.hidden\u6761\u4ef6\u3092\u8ffd\u52a0\n    if(document.hidden){\n      request(\"visibilitychange\");\n    }\n  }, false);\n}\n\n// \u30da\u30fc\u30b8\u9077\u79fb\u30a4\u30d9\u30f3\u30c8\u3092\u691c\u77e5\u3059\u308b\u305f\u3081\u306e\u30ea\u30b9\u30ca\u30fc\nfunction setPageTransitionListener(){\n  window.addEventListener(\"pagehide\", function(){\n    request(\"pagehide\");\n  }, false);\n}\n\n// \u975e\u8868\u793a\u6642\u306e\u51e6\u7406\n// \u4ee5\u4e0b\u306e\u5834\u5408\u3001\u30b5\u30fc\u30d0\u306b\u901a\u77e5\u3059\u308b\u51e6\u7406\nfunction request(event){\n  var id = 'test_'+window.btoa(event);\n  var img = document.createElement('img');\n  var endPoint = 'http://...';\n  img.src = endPoint + query;\n  img.id = id;\n  body.appendChild(img);\n  img.parentNode.removeChild(img);\n}\n\nfunction main(){\n  setVisibilityEvent();\n  setPageTransitionListener();\n}\n\nmain();\n```\n", "tags": ["iOS9", "Android", "Safari", "Chrome", "JavaScript"]}