{"context": "\n\n\u80cc\u666f\nDart\u3067Chrome\u62e1\u5f35\u6a5f\u80fd\u3092\u4f5c\u308b\u3068\u304d\u306b\u306fchrome\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f7f\u3046\u3068\u601d\u3044\u307e\u3059\u304c\nsendMessageAPI\u5468\u308a\u304c\u6b63\u3057\u304f\u52d5\u304b\u306a\u3044\u306e\u3067\u3042\u304d\u3089\u3081\u3066dart:js\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f7f\u3063\u3066\u624b\u52d5\u3067\u89e3\u6c7a\u3059\u308b\u65b9\u6cd5\u3067\u3059\u3002\n\n\u6b63\u3057\u304f\u52d5\u304b\u306a\u3044\u30b3\u30fc\u30c9\n\ncontent.dart\nmain() async {\n  var res = await chrome.runtime.sendMessage('soy source');\n  print(res);\n}\n\n\n\nbackground.dart\nmain() async* {\n  await for (var msgEvent in chrome.runtime.onMessage) {\n    print(msgEvent.message);\n    msgEvent.sendResponse('hello' + msgEvent.message);\n  }\n}\n\n\nUncaught Error: Could not establish connection. Receiving end does not exist.(...)\u3068\u3044\u3046\u30a8\u30e9\u30fc\u304c\u51fa\u307e\u3059\u3002\n\n\n\u52d5\u304f\u30b3\u30fc\u30c9\ncontext[\"chrome\"]\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u30f3\u30b0\u7528\u306eAPI\u3092\u53d6\u308a\u51fa\u3057\u3066\u4f7f\u3044\u307e\u3059\u3002\n\nContent Script -> Background -> Content Script\n\ncontent2.dart\nvoid main() {\n  context['chrome']['runtime'].callMethod('sendMessage',\n      [ \"soy source\", (result) => print(result)]);//\u4e8c\u79d2\u5f8c\u306b \"hello tab: xxx name:soy source\" \u3068\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n}\n\n\n\nbackground2.dart\nvoid main() {\n  var jsObject = context['chrome']['runtime']['onMessage'];\n  (jsObject is JsObject ? jsObject : new JsObject.fromBrowserObject(jsObject))\n      .callMethod('addListener', [onMessage]);\n}\n\nbool onMessage(request, sender,JsFunction response) {\n  var tabID = new JsObject.fromBrowserObject(sender)[\"tab\"][\"id\"];\n  new Timer(new Duration(seconds: 2), () {\n    response.apply([\"hello tab: $tabID name:$request\"]);\n  });\n  return true; //true\u306b\u3057\u306a\u3044\u3068\u975e\u540c\u671f\u3067\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u8fd4\u305b\u307e\u305b\u3093\u3002\n}\n\n\n\n\nBackground -> Content Script -> Background\n\ncontent3.dart\nvoid main(){\n  var jsObject = context['chrome']['runtime']['onMessage'];\n  (jsObject is JsObject ? jsObject : new JsObject.fromBrowserObject(jsObject))\n      .callMethod('addListener', [onMessage]);\n\n\n}\n\nvoid onMessage(request, sender,JsFunction sendResponse) {\n  print(\"request $request\");\n  sendResponse.apply([\"hey $request\"]);\n}\n\n\n\nbackground3.dart\nvoid main() {\n  new Timer(new Duration(seconds: 5),(){ //\u62e1\u5f35\u6a5f\u80fd\u3092\u30ea\u30ed\u30fc\u30c9\u3057\u3066\u304b\u3089\u4e94\u79d2\u4ee5\u5185\u306bContent Script\u304c\u633f\u5165\u3055\u308c\u3066\u3044\u308b\u30da\u30fc\u30b8\u3092\u30ea\u30ed\u30fc\u30c9\u3057\u306a\u3044\u3068\u3046\u307e\u304f\u52d5\u304d\u307e\u305b\u3093\u3002\n    context['chrome']['tabs'].callMethod( \n        'sendMessage', [ 376, \"\u30de\u30e8\u30cd\u30fc\u30ba\",(result) => print(result)]); //\"hey \u30de\u30e8\u30cd\u30fc\u30ba\"\u3068\u8868\u793a\u3055\u308c\u307e\u3059\n  });\n}\n\n\n# \u80cc\u666f \nDart\u3067Chrome\u62e1\u5f35\u6a5f\u80fd\u3092\u4f5c\u308b\u3068\u304d\u306b\u306f[chrome](https://pub.dartlang.org/packages/chrome)\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f7f\u3046\u3068\u601d\u3044\u307e\u3059\u304c\nsendMessageAPI\u5468\u308a\u304c\u6b63\u3057\u304f\u52d5\u304b\u306a\u3044\u306e\u3067\u3042\u304d\u3089\u3081\u3066dart:js\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f7f\u3063\u3066\u624b\u52d5\u3067\u89e3\u6c7a\u3059\u308b\u65b9\u6cd5\u3067\u3059\u3002\n\n# \u6b63\u3057\u304f\u52d5\u304b\u306a\u3044\u30b3\u30fc\u30c9\n\n```content.dart\nmain() async {\n  var res = await chrome.runtime.sendMessage('soy source');\n  print(res);\n}\n```\n\n```background.dart\nmain() async* {\n  await for (var msgEvent in chrome.runtime.onMessage) {\n    print(msgEvent.message);\n    msgEvent.sendResponse('hello' + msgEvent.message);\n  }\n}\n```\nUncaught Error: Could not establish connection. Receiving end does not exist.(...)\u3068\u3044\u3046\u30a8\u30e9\u30fc\u304c\u51fa\u307e\u3059\u3002\n<img width=\"532\" alt=\"error.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/100021/a6ee2170-2e36-2272-802d-a920143f05ef.png\">\n\n# \u52d5\u304f\u30b3\u30fc\u30c9\ncontext[\"chrome\"]\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u30f3\u30b0\u7528\u306eAPI\u3092\u53d6\u308a\u51fa\u3057\u3066\u4f7f\u3044\u307e\u3059\u3002\n## Content Script -> Background -> Content Script\n```content2.dart\nvoid main() {\n  context['chrome']['runtime'].callMethod('sendMessage',\n      [ \"soy source\", (result) => print(result)]);//\u4e8c\u79d2\u5f8c\u306b \"hello tab: xxx name:soy source\" \u3068\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n}\n```\n\n```background2.dart\nvoid main() {\n  var jsObject = context['chrome']['runtime']['onMessage'];\n  (jsObject is JsObject ? jsObject : new JsObject.fromBrowserObject(jsObject))\n      .callMethod('addListener', [onMessage]);\n}\n\nbool onMessage(request, sender,JsFunction response) {\n  var tabID = new JsObject.fromBrowserObject(sender)[\"tab\"][\"id\"];\n  new Timer(new Duration(seconds: 2), () {\n    response.apply([\"hello tab: $tabID name:$request\"]);\n  });\n  return true; //true\u306b\u3057\u306a\u3044\u3068\u975e\u540c\u671f\u3067\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u8fd4\u305b\u307e\u305b\u3093\u3002\n}\n\n```\n\n## Background -> Content Script -> Background\n```content3.dart\nvoid main(){\n  var jsObject = context['chrome']['runtime']['onMessage'];\n  (jsObject is JsObject ? jsObject : new JsObject.fromBrowserObject(jsObject))\n      .callMethod('addListener', [onMessage]);\n\n\n}\n\nvoid onMessage(request, sender,JsFunction sendResponse) {\n  print(\"request $request\");\n  sendResponse.apply([\"hey $request\"]);\n}\n```\n\n```background3.dart\nvoid main() {\n  new Timer(new Duration(seconds: 5),(){ //\u62e1\u5f35\u6a5f\u80fd\u3092\u30ea\u30ed\u30fc\u30c9\u3057\u3066\u304b\u3089\u4e94\u79d2\u4ee5\u5185\u306bContent Script\u304c\u633f\u5165\u3055\u308c\u3066\u3044\u308b\u30da\u30fc\u30b8\u3092\u30ea\u30ed\u30fc\u30c9\u3057\u306a\u3044\u3068\u3046\u307e\u304f\u52d5\u304d\u307e\u305b\u3093\u3002\n    context['chrome']['tabs'].callMethod( \n        'sendMessage', [ 376, \"\u30de\u30e8\u30cd\u30fc\u30ba\",(result) => print(result)]); //\"hey \u30de\u30e8\u30cd\u30fc\u30ba\"\u3068\u8868\u793a\u3055\u308c\u307e\u3059\n  });\n}\n```\n\n", "tags": ["Dart", "ChromeExtension"]}