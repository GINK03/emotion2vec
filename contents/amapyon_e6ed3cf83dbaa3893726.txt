{"tags": ["Java", "EV3", "leJOS", "bluetooth"], "context": "NXT\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u3082\u3068\u306b\u3001EV3\u7528\u306b\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\u30c7\u30d0\u30a4\u30b9\u9593\u3067\u4e8b\u524d\u306b\u30da\u30a2\u30ea\u30f3\u30b0\u304c\u6e08\u3093\u3067\u3044\u308b\u3053\u3068\u3002\n\u30b5\u30fc\u30d0\u30fc\u5074\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5148\u306b\u8d77\u52d5\u3057\u3066\u304b\u3089\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3092\u8d77\u52d5\u3059\u308b\u3053\u3068\u3002\n\n\u30b5\u30fc\u30d0\u30fc\u5074\n\nBluetoothServer.java\nimport lejos.hardware.Bluetooth;\nimport lejos.hardware.Button;\nimport lejos.hardware.Sound;\nimport lejos.hardware.lcd.LCD;\nimport lejos.remote.nxt.NXTCommConnector;\nimport lejos.remote.nxt.NXTConnection;\n\npublic class BluetoothServer {\n\n    public static void main(String[] args) {\n        int recvMessageNo = 2;  //\u53d7\u4fe1\u3059\u308b\u756a\u53f7\n        int sendMessageNo = 3;  //\u9001\u4fe1\u3059\u308b\u756a\u53f7\n\n        System.out.println(\"Waiting...\");\n\n        //\u9001\u4fe1\u5148\u304b\u3089\u306e\u63a5\u7d9a\u3092\u5f85\u3064\n        NXTCommConnector connector = Bluetooth.getNXTCommConnector();\n        NXTConnection connection = connector.waitForConnection(0, NXTConnection.RAW);\n\n        System.out.println(\"Connected\");\n\n        //\u53d7\u4fe1\u756a\u53f7\u304c\u6b63\u3057\u3051\u308c\u3070\u97f3\u3092\u9cf4\u3089\u3059\n        if(isReceived(connection, recvMessageNo)){\n            Sound.systemSound(false, 2);\n        } else {\n            Sound.buzz();\n        }\n\n        // \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\n        send(connection, sendMessageNo);\n\n        //\u901a\u4fe1\u3092\u5207\u65ad\u3059\u308b\n        System.out.println(\"Closing...\");\n        try {\n            if (null != connection) {\n                connection.close();\n            }\n        } catch (Exception ioe) {\n        }\n\n        System.out.println(\"Finished\");\n\n        Button.waitForAnyPress();\n    }\n\n    static boolean isReceived(NXTConnection connection, int messageNo) {\n        byte[] recvBuff = new byte[16];\n\n        //\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u304b\u3001ESCAPE\u30dc\u30bf\u30f3\u304c\u62bc\u3055\u308c\u308b\u307e\u3067\u5f85\u3064\n        while(recvBuff[0] == 0 && Button.ESCAPE.isUp()){\n            connection.read(recvBuff, recvBuff.length);\n        }\n\n        //\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u6b63\u3057\u3044\u304b\u30c1\u30a7\u30c3\u30af\u3059\u308b\n        for (int i = 0; i < recvBuff.length; i++) {\n            System.out.print(recvBuff[i]);\n            if (recvBuff[i] != messageNo) {\n                System.out.println();\n                return false;\n            }\n        }\n        System.out.println();\n        return true;\n    }\n\n    static void send(NXTConnection connection, int messageNo) {\n        byte[] sendBuff = new byte[16];\n        for (int i = 0; i < sendBuff.length; i++) {\n            sendBuff[i] = (byte)messageNo;\n        }\n        connection.write(sendBuff, sendBuff.length);\n    }\n\n}\n\n\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\n\nBluetoothClient.java\npackage ev3;\n\nimport lejos.hardware.Bluetooth;\nimport lejos.hardware.Button;\nimport lejos.hardware.Sound;\nimport lejos.remote.nxt.NXTCommConnector;\nimport lejos.remote.nxt.NXTConnection;\n\npublic class BluetoothClient {\n    public static void main(String[] args) {\n        int sendMessageNo = 2; // \u9001\u4fe1\u3059\u308b\u756a\u53f7\n        int recvMessageNo = 3; // \u53d7\u4fe1\u3059\u308b\u756a\u53f7\n\n        String server = \"00:16:53:99:99:99\"; // \u30b5\u30fc\u30d0\u5074\u30c7\u30d0\u30a4\u30b9\u306eMAC\u30a2\u30c9\u30ec\u30b9\n\n        System.out.println(\"Connecting...\");\n\n        // \u30b5\u30fc\u30d0\u30fc\u5074\u306e\u30c7\u30d0\u30a4\u30b9\u304b\u3089\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3092\u53d6\u5f97\u3059\u308b\n        NXTCommConnector connector = Bluetooth.getNXTCommConnector();\n        NXTConnection connection = connector.connect(server, NXTConnection.RAW);\n        if (connection == null) {\n            System.out.println(\"Connect fail\");\n            Button.waitForAnyPress();\n            System.exit(1);\n        }\n        System.out.println(\"Connected\");\n\n        // \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\n        System.out.println(\"Sending...\");\n        send(connection, sendMessageNo);\n        Sound.systemSound(false, 3);\n\n        // \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\n        System.out.println(\"Receivng...\");\n        isReceived(connection, recvMessageNo);\n\n        // \u901a\u4fe1\u306e\u5207\u65ad\u3092\u884c\u3046\n        System.out.println(\"Closing...\");\n        try {\n            if (null != connection) {\n                connection.close();\n            }\n        } catch (Exception ioe) {\n        }\n\n        System.out.println(\"Finished\");\n\n        Button.waitForAnyPress();\n    }\n\n    static boolean isReceived(NXTConnection connection, int messageNo) {\n        byte[] recvBuff = new byte[16];\n\n        //\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u304b\u3001ESCAPE\u30dc\u30bf\u30f3\u304c\u62bc\u3055\u308c\u308b\u307e\u3067\u5f85\u3064\n        while(recvBuff[0] == 0 && Button.ESCAPE.isUp()){\n            connection.read(recvBuff, recvBuff.length);\n        }\n\n        //\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u6b63\u3057\u3044\u304b\u30c1\u30a7\u30c3\u30af\u3059\u308b\n        for (int i = 0; i < recvBuff.length; i++) {\n            System.out.print(recvBuff[i]);\n            if (recvBuff[i] != messageNo) {\n                System.out.println();\n                return false;\n            }\n        }\n        System.out.println();\n        return true;\n    }\n\n    static void send(NXTConnection connection, int messageNo) {\n        // \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u30d0\u30c3\u30d5\u30a1\u306b\u8a2d\u5b9a\u3059\u308b\n        byte[] sendBuff = new byte[16];\n        for (int i = 0; i < sendBuff.length; i++) {\n            sendBuff[i] = (byte) messageNo;\n        }\n\n        // \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\n        connection.write(sendBuff, sendBuff.length);\n    }\n}\n\n\n\nNXT\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u3082\u3068\u306b\u3001EV3\u7528\u306b\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\u30c7\u30d0\u30a4\u30b9\u9593\u3067\u4e8b\u524d\u306b\u30da\u30a2\u30ea\u30f3\u30b0\u304c\u6e08\u3093\u3067\u3044\u308b\u3053\u3068\u3002\n\u30b5\u30fc\u30d0\u30fc\u5074\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5148\u306b\u8d77\u52d5\u3057\u3066\u304b\u3089\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3092\u8d77\u52d5\u3059\u308b\u3053\u3068\u3002\n\n# \u30b5\u30fc\u30d0\u30fc\u5074\n```BluetoothServer.java\nimport lejos.hardware.Bluetooth;\nimport lejos.hardware.Button;\nimport lejos.hardware.Sound;\nimport lejos.hardware.lcd.LCD;\nimport lejos.remote.nxt.NXTCommConnector;\nimport lejos.remote.nxt.NXTConnection;\n\npublic class BluetoothServer {\n\n\tpublic static void main(String[] args) {\n\t\tint recvMessageNo = 2;  //\u53d7\u4fe1\u3059\u308b\u756a\u53f7\n\t\tint sendMessageNo = 3;\t//\u9001\u4fe1\u3059\u308b\u756a\u53f7\n\n\t\tSystem.out.println(\"Waiting...\");\n\n\t\t//\u9001\u4fe1\u5148\u304b\u3089\u306e\u63a5\u7d9a\u3092\u5f85\u3064\n\t\tNXTCommConnector connector = Bluetooth.getNXTCommConnector();\n\t\tNXTConnection connection = connector.waitForConnection(0, NXTConnection.RAW);\n\n\t\tSystem.out.println(\"Connected\");\n\n\t\t//\u53d7\u4fe1\u756a\u53f7\u304c\u6b63\u3057\u3051\u308c\u3070\u97f3\u3092\u9cf4\u3089\u3059\n\t\tif(isReceived(connection, recvMessageNo)){\n\t\t\tSound.systemSound(false, 2);\n\t\t} else {\n\t\t\tSound.buzz();\n\t\t}\n\t\t\n\t\t// \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\n\t\tsend(connection, sendMessageNo);\n\n\t\t//\u901a\u4fe1\u3092\u5207\u65ad\u3059\u308b\n\t\tSystem.out.println(\"Closing...\");\n\t\ttry {\n\t\t\tif (null != connection) {\n\t\t\t\tconnection.close();\n\t\t\t}\n\t\t} catch (Exception ioe) {\n\t\t}\n\n\t\tSystem.out.println(\"Finished\");\n\n\t\tButton.waitForAnyPress();\n\t}\n\t\n\tstatic boolean isReceived(NXTConnection connection, int messageNo) {\n\t\tbyte[] recvBuff = new byte[16];\n\n\t\t//\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u304b\u3001ESCAPE\u30dc\u30bf\u30f3\u304c\u62bc\u3055\u308c\u308b\u307e\u3067\u5f85\u3064\n\t\twhile(recvBuff[0] == 0 && Button.ESCAPE.isUp()){\n\t\t\tconnection.read(recvBuff, recvBuff.length);\n\t\t}\n\n\t\t//\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u6b63\u3057\u3044\u304b\u30c1\u30a7\u30c3\u30af\u3059\u308b\n\t\tfor (int i = 0; i < recvBuff.length; i++) {\n\t\t\tSystem.out.print(recvBuff[i]);\n\t\t\tif (recvBuff[i] != messageNo) {\n\t\t\t\tSystem.out.println();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\tSystem.out.println();\n\t\treturn true;\n\t}\n\t\n\tstatic void send(NXTConnection connection, int messageNo) {\n\t\tbyte[] sendBuff = new byte[16];\n\t\tfor (int i = 0; i < sendBuff.length; i++) {\n\t\t\tsendBuff[i] = (byte)messageNo;\n\t\t}\n\t\tconnection.write(sendBuff, sendBuff.length);\n\t}\n\n}\n\n```\n\n#\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\n```BluetoothClient.java\npackage ev3;\n\nimport lejos.hardware.Bluetooth;\nimport lejos.hardware.Button;\nimport lejos.hardware.Sound;\nimport lejos.remote.nxt.NXTCommConnector;\nimport lejos.remote.nxt.NXTConnection;\n\npublic class BluetoothClient {\n\tpublic static void main(String[] args) {\n\t\tint sendMessageNo = 2; // \u9001\u4fe1\u3059\u308b\u756a\u53f7\n\t\tint recvMessageNo = 3; // \u53d7\u4fe1\u3059\u308b\u756a\u53f7\n\n\t\tString server = \"00:16:53:99:99:99\"; // \u30b5\u30fc\u30d0\u5074\u30c7\u30d0\u30a4\u30b9\u306eMAC\u30a2\u30c9\u30ec\u30b9\n\n\t\tSystem.out.println(\"Connecting...\");\n\n\t\t// \u30b5\u30fc\u30d0\u30fc\u5074\u306e\u30c7\u30d0\u30a4\u30b9\u304b\u3089\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3092\u53d6\u5f97\u3059\u308b\n\t\tNXTCommConnector connector = Bluetooth.getNXTCommConnector();\n\t\tNXTConnection connection = connector.connect(server, NXTConnection.RAW);\n\t\tif (connection == null) {\n\t\t\tSystem.out.println(\"Connect fail\");\n\t\t\tButton.waitForAnyPress();\n\t\t\tSystem.exit(1);\n\t\t}\n\t\tSystem.out.println(\"Connected\");\n\n\t\t// \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\n\t\tSystem.out.println(\"Sending...\");\n\t\tsend(connection, sendMessageNo);\n\t\tSound.systemSound(false, 3);\n\t\t\n\t\t// \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\n\t\tSystem.out.println(\"Receivng...\");\n\t\tisReceived(connection, recvMessageNo);\n\n\t\t// \u901a\u4fe1\u306e\u5207\u65ad\u3092\u884c\u3046\n\t\tSystem.out.println(\"Closing...\");\n\t\ttry {\n\t\t\tif (null != connection) {\n\t\t\t\tconnection.close();\n\t\t\t}\n\t\t} catch (Exception ioe) {\n\t\t}\n\n\t\tSystem.out.println(\"Finished\");\n\n\t\tButton.waitForAnyPress();\n\t}\n\n\tstatic boolean isReceived(NXTConnection connection, int messageNo) {\n\t\tbyte[] recvBuff = new byte[16];\n\n\t\t//\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u304b\u3001ESCAPE\u30dc\u30bf\u30f3\u304c\u62bc\u3055\u308c\u308b\u307e\u3067\u5f85\u3064\n\t\twhile(recvBuff[0] == 0 && Button.ESCAPE.isUp()){\n\t\t\tconnection.read(recvBuff, recvBuff.length);\n\t\t}\n\n\t\t//\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u6b63\u3057\u3044\u304b\u30c1\u30a7\u30c3\u30af\u3059\u308b\n\t\tfor (int i = 0; i < recvBuff.length; i++) {\n\t\t\tSystem.out.print(recvBuff[i]);\n\t\t\tif (recvBuff[i] != messageNo) {\n\t\t\t\tSystem.out.println();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\tSystem.out.println();\n\t\treturn true;\n\t}\n\t\n\tstatic void send(NXTConnection connection, int messageNo) {\n\t\t// \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u30d0\u30c3\u30d5\u30a1\u306b\u8a2d\u5b9a\u3059\u308b\n\t\tbyte[] sendBuff = new byte[16];\n\t\tfor (int i = 0; i < sendBuff.length; i++) {\n\t\t\tsendBuff[i] = (byte) messageNo;\n\t\t}\n\n\t\t// \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\n\t\tconnection.write(sendBuff, sendBuff.length);\n\t}\n}\n\n```\n"}