{"tags": ["Unity", "ffmpeg", "iOS", "OpenCV", "OpenCVforUnity"], "context": "Unity\u3067\u30d7\u30ec\u30a4\u753b\u9762\u3092\u52d5\u753b\u3068\u3057\u3066\u4fdd\u5b58\u3059\u308b\u6a5f\u80fd\u304c\u6b32\u3057\u304b\u3063\u305f\u306e\u3067\u8abf\u3079\u307e\u3057\u305f\u3002\n\u691c\u8a3c\u3057\u305f\u304c\u3001\u52d5\u4f5c\u3057\u306a\u3044\u3082\u306e\u3082\u3042\u308a\u307e\u3057\u305f\u306e\u3067\u3069\u3053\u304c\u3044\u3051\u306a\u304b\u3063\u305f\u304b\u3054\u6307\u6458\u304f\u3060\u3055\u3044\u3002\n\n\u57fa\u672c\u7684\u306b\u30b9\u30af\u30ea\u30fc\u30f3\u30ad\u30e3\u30d7\u30c1\u30e3\u306e\u9023\u756a\u753b\u50cf\u3092\u4f5c\u6210\u3057\u3001\u52d5\u753b\u3078\u5909\u63db\u306e\u6d41\u308c\u3067\u3059\u3002\n\u9332\u753b\u4e2d\u306e\u30d7\u30ec\u30a4\u97f3\u58f0\u3084\u30de\u30a4\u30af\u97f3\u58f0\u306f\u542b\u3093\u3067\u304a\u308a\u307e\u305b\u3093\u3002\n\u5404\u65b9\u6cd5\u306b\u753b\u8cea\u3084\u901f\u5ea6\u306a\u3069\u3092\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\n\n\n\u753b\u8cea,\u901f\u5ea6\u306b\u95a2\u3057\u3066\u306f\u5143\u753b\u50cf\u306e\u753b\u8cea\u3084\u30b5\u30a4\u30ba\u306b\u5bfe\u3057\u3066\u306e\u6bd4\u8f03\u3067\u3059\u3002\n\u691c\u8a3c\u74b0\u5883\u306b\u5165\u3063\u3066\u3044\u308b\u304c\u9805\u76ee\u304c\u300c...\u300d\u306e\u3082\u306e\u306f\u52d5\u4f5c\u3059\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u304c\u5b9f\u969b\u306b\u78ba\u8a8d\u3057\u3066\u3044\u306a\u3044\u3082\u306e\u3067\u3059\u3002\n\n\n\n\nffmpeg\uff08Windows\u52d5\u4f5c\u78ba\u8a8d\u6e08\u307f\uff09\n\u3000ffmpeg\u3068\u3044\u3046\u30a2\u30d7\u30ea\u3092\u5229\u7528\u3057\u3066\u306e\u52d5\u753b\u5909\u63db\u3067\u3059\u3002\n\u5916\u90e8\u30a2\u30d7\u30ea\u3068\u3057\u3066\u975e\u8868\u793a\u3067\u52d5\u4f5c\u3055\u305b\u5f15\u6570\u3092\u6e21\u3057\u5909\u63db\u3057\u3066\u3082\u3089\u3046\u4f5c\u308a\u3002\nWindows\u3067\u306f\u52d5\u4f5c\u78ba\u8a8d\u3057\u307e\u3057\u305f\u304cMac\u7248\u3082\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306f\u3067\u304d\u307e\u3057\u305f\u304c\u672a\u691c\u8a3c\u3067\u3059\u3002\niOS\u3084Android\u306a\u3069\u306b\u95a2\u3057\u3066\u306f.exe\u3084.app\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u306e\u3067\u5229\u7528\u4e0d\u53ef\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001.mp4\u304b\u3089.mov\u3084.gif\u3078\u306e\u5909\u63db\u306a\u3069\u3082\u53ef\u80fd\u3067\u3059\u304c\u3053\u3053\u3067\u306f\u5272\u611b\u3057\u307e\u3059\u3002\n\n\u691c\u8a3c\u7d50\u679c\n\n\n\n\u691c\u8a3c\u74b0\u5883\n\u52d5\u4f5c\n\u753b\u8cea\n\u901f\u5ea6\n\n\n\n\nWindows(.exe)\n\u6210\u529f\n\u60aa\u3044\n\u9045\u3044\n\n\nMac(.app)\n...\n...\n...\n\n\n\n\n\u691c\u8a3c\u5185\u5bb9\n\nffmpeg\npublic void movieConvert()\n{\n    int framerate = (int)(\u3010\u30ad\u30e3\u30d7\u30c1\u30e3\u679a\u6570\u3011 / 5);\n    var arguments = string.Format(\"-r {2} -i {0}screenshot_%d.png -vcodec libx264 -pix_fmt yuv420p \\\"{1}\\\"\", \u3010\u30ad\u30e3\u30d7\u30c1\u30e3\u753b\u50cf\u306e\u30d5\u30a9\u30eb\u30c0\u30d1\u30b9\u3011, \u3010\u52d5\u753b\u306e\u66f8\u304d\u51fa\u3057\u5148\u30d5\u30a9\u30eb\u30c0\u30d1\u30b9\u3011 + \"movie.mp4\", framerate);\n    exProcess = new Process();\n    exProcess.StartInfo.CreateNoWindow = true;\n    exProcess.StartInfo.WindowStyle = ProcessWindowStyle.Hidden;\n    exProcess.StartInfo.FileName = \u3010ffmpeg\u306e\u30d1\u30b9\u3011;\n    exProcess.StartInfo.Arguments = arguments;\n    exProcess.EnableRaisingEvents = true;\n\n    //\u5916\u90e8\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u5b9f\u884c\u3059\u308b\n    exProcess.Start();\n    exProcess.WaitForExit();\n\n    \u3010\u5909\u63db\u5f8c\u306e\u51e6\u7406\u3011\n}\n\n\n\n\u8aac\u660e\n\n\n\u3010\u3011\u306e\u4e2d\u3092\u66f8\u304d\u63db\u3048\u3066\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u3010\u30ad\u30e3\u30d7\u30c1\u30e3\u753b\u50cf\u306e\u30d5\u30a9\u30eb\u30c0\u30d1\u30b9\u3011\u306b\u306fscreenshot_0.png\u304b\u3089\u59cb\u307e\u308b\u9023\u756a\u753b\u50cf\u304c\u5165\u3063\u3066\u3044\u307e\u3059\u3002\n\n\nRead and Write\u306a\u30d5\u30a9\u30eb\u30c0\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\n\u3010\u30ad\u30e3\u30d7\u30c1\u30e3\u679a\u6570\u3011\u306b\u306f\u9023\u756a\u753b\u50cf\u306e\u4e00\u756a\u5927\u304d\u3044\u6570\u5b57\u304c\u5165\u308a\u307e\u3059\u30020~40\u307e\u3067\u30ad\u30e3\u30d7\u30c1\u30e3\u3057\u305f\u6642\u306f40\u3067\u3059\u3002\n\u3010\u52d5\u753b\u306e\u66f8\u304d\u51fa\u3057\u5148\u30d5\u30a9\u30eb\u30c0\u30d1\u30b9\u3011\u306bmovie.mp4\u3068\u3044\u3046\u52d5\u753b\u30d5\u30a1\u30a4\u30eb\u304c\u66f8\u304d\u51fa\u3055\u308c\u307e\u3059\u3002\n\n\nRead and Write\u306a\u30d5\u30a9\u30eb\u30c0\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\n\u3010ffmpeg\u306e\u30d1\u30b9\u3011\u306fffmpeg\u306e\u30a2\u30d7\u30ea\u306e\u30d1\u30b9\u3067\u3059\u3002\n\n\n\u30d3\u30eb\u30c9\u5f8c\u3082\u5909\u308f\u3089\u306a\u3044\u3088\u3046\u306b\u6ce8\u610f\u3002\n\n\n\n\n\n\nAForge.Video.VFW\uff08\u5931\u6557..\uff09\nAForge.NET\u306eAForge.Video.VFW.dll\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f7f\u7528\u3057\u3066.avi\u306e\u52d5\u753b\u3092\u4f5c\u6210\u3059\u308b\u3002\nMac\u3067\u3084\u3063\u3066\u307f\u305f\u304cavifil32.dll\u304c\u306a\u3044\u3068\u6012\u3089\u308c\u8abf\u3079\u308b\u3068Windows\u306edll\u306a\u306e\u3067MacOS\u306f\u975e\u5bfe\u5fdc\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\u3082\u3057\u304b\u3057\u305f\u3089AForge.NET\u306e\u516c\u958b\u3057\u3066\u3044\u308b\u30bd\u30fc\u30b9\u3092Mac\u74b0\u5883\u3067\u30d3\u30eb\u30c9\u3059\u308b\u3053\u3068\u3067\u4f7f\u7528\u53ef\u80fd\u306b\u306a\u308b\u53ef\u80fd\u6027\u306f\u3042\u308b\n\n\u691c\u8a3c\u7d50\u679c\n\n\n\n\u52d5\u4f5c\u74b0\u5883\n\u52d5\u4f5c\n\u753b\u8cea\n\u901f\u5ea6\n\n\n\n\nWindows\n...\n...\n...\n\n\nMac\n\u5931\u6557\n\n\n\n\nAndroid\n...\n...\n...\n\n\niOS\n...\n...\n...\n\n\n\n\n\u691c\u8a3c\u5185\u5bb9\n\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u4f7f\u7528\u53ef\u80fd\u306b\u3059\u308b\u307e\u3067\n\n\u30c8\u30c3\u30d7\u30da\u30fc\u30b8\u306e\u753b\u9762\u5de6\u306e\u30ea\u30b9\u30c8\u306bDownloads\u304c\u3042\u308b\u306e\u3067\u30af\u30ea\u30c3\u30af\n\n\n[ Download Full ZIP Archive ]\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305fZIP\u3092\u89e3\u51cd\u3057\u3066Release\u30d5\u30a9\u30eb\u30c0\u5185\u306eAForge.dll\u3001AForge.Video.dll\u3001AForge.Video.VFW.dll\u3092\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e/Assets/Plugins/\u306b\u30b3\u30d4\u30fc\u3059\u308b\u3002\n\n\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f7f\u7528\u3057\u3066\u5b9f\u88c5\u3057\u305fAForgeMovieConvert\u30af\u30e9\u30b9\n\nAVIWriter()\u306e\u90e8\u5206\u3067avifil32.dll\u304c\u306a\u3044\u3068\u30a8\u30e9\u30fc\n\u305d\u306e\u5148\u306e\u51e6\u7406\u306b\u3064\u3044\u3066\u306f\u4eee\u5b9f\u88c5...\n\n\n\n\nAForgeMovieConvert.cs\nusing UnityEngine;\nusing AForge.Video.VFW;\n\npublic class AForgeMovieConvert : MonoBehaviour {\n\n    public delegate void movieConvertCallback(bool success, string error);\n    private movieConvertCallback convertCallback = null;\n\n    public void movieConvert(string savePath, string sourcePath, int width, int height, int second, movieConvertCallback callback) {\n        if (callback != null) {\n            convertCallback = callback;\n            if (savePath != null && savePath != \"\") {\n                if (sourcePath != null && sourcePath != \"\") {\n                    if (width > 0) {\n                        if (height > 0) {\n                            if (second > 0) {\n                                var writer = new AVIWriter();\n                                writer.Codec = \"MSVC\"; //4\u6587\u5b57\u306e\u30b3\u30fc\u30c7\u30c3\u30af\n                                writer.FrameRate = 15; //FrameRate = sourcePath\u5185\u306e\u9023\u756a\u753b\u50cf\u306e\u679a\u6570 / second(\u52d5\u753b\u306e\u8868\u793a\u79d2\u6570)\n                                writer.Open(savePath + \"movie.avi\", width, height); //savePath\u306bmovie.avi\u3092\u4f5c\u6210\n\n                                //\u4f5c\u3063\u305fmovie.avi\u306b\u30d5\u30ec\u30fc\u30e0\u753b\u50cf\u3092\u63cf\u753b\u3057\u3066\u3044\u304f\n                                for (int i = 0; i < 10; i++) {\n                                    //bitmap\u306fsourcePath\u5185\u306e\u9023\u756a\u753b\u50cf\u3092\u4f7f\u7528\u3059\u308b\u3001\u73fe\u5728\u306f\u4eee\n                                    System.Drawing.Bitmap bitmap = new System.Drawing.Bitmap(width, height);\n                                    writer.AddFrame (bitmap);\n                                }\n                                writer.Close();\n\n                                //\u3053\u3053\u3067\u52d5\u753b\u304c\u4f5c\u6210\u5b8c\u4e86\u3001\u52d5\u753b\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u3044\u305f\u308a\u3057\u305f\u3044\u306a\u3089Close\u5f8c\n                            } else {\n                                convertCallback (false, \"movie second is 0\");\n                            }\n                        } else {\n                            convertCallback (false, \"movie height is 0\");\n                        }\n                    } else {\n                        convertCallback (false, \"movie width is 0\");\n                    }\n                } else {\n                    convertCallback (false, \"Notfound:sourcePath\");\n                }\n            } else {\n                convertCallback (false, \"Notfound:savePath\");\n            }\n        } else {\n            Debug.Log (\"callback not found\");\n        }\n    }\n}\n\n\n\n\u8aac\u660e\n\n\n\u30b3\u30fc\u30c7\u30c3\u30af\u306f\u52d5\u753b\u306e\u66f8\u304d\u51fa\u3057\u65b9\u6cd5\u307f\u305f\u3044\u306a\u3082\u306e...Video Codecs by FOURCC\n\n\n\n\n\niOS - AVAssetWriter\uff08\u5931\u6557..\uff09\n\u3000iOS\u306b\u95a2\u3057\u3066\u306f\u30cd\u30a4\u30c6\u30a3\u30d6\u3067\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u66f8\u3044\u3066\u3084\u308d\u3046\u3068\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u691c\u8a3c\u7d50\u679c\n\n\n\n\u52d5\u4f5c\u74b0\u5883\n\u52d5\u4f5c\n\u753b\u8cea\n\u901f\u5ea6\n\n\n\n\niOS\n\u5931\u6557\n\n\n\n\n\n\u7d50\u679c\u3068\u3057\u3066\u306fautoreleasepool\u3067\u56f2\u3063\u3066\u3044\u308bfor\u6587\u306e\u4e2d\u307e\u3067\u306f\u304f\u308b\u304c\u52d5\u753b\u751f\u6210\u7d42\u4e86\u306e\u30cf\u30f3\u30c9\u30e9\u30fc\u304c\u547c\u3070\u308c\u305a...\n\ntkyaji\u69d8\u3088\u308a\u52a9\u8a00 - 2016-11-17 00:05\nAVAssetWriter#finishWritingWithCompletionHandler\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u306f\u3001\niOS8\u3060\u3068iOS\u306e\u30d0\u30b0\u3067\u547c\u3070\u308c\u306a\u304b\u3063\u305f\u6c17\u304c\u3057\u307e\u3059\u3002\uff08iOS7\u3082\uff1f\uff09\niOS9\u306e\u5834\u5408\u306f\u547c\u3070\u308c\u305f\u3088\u3046\u306a\u3002\u3002\u3002\n\n\n\u691c\u8a3c\u5185\u5bb9\n\niOSMovieConvert.mm\n#import <Foundation/Foundation.h>\n#import <AVFoundation/AVFoundation.h>\n\n//\u6307\u5b9a\u3057\u305f\u30d1\u30b9\u306e\u753b\u50cf\u3092\u30ab\u30e1\u30e9\u30ed\u30fc\u30eb\u306b\u4fdd\u5b58\u3059\u308b\u3002\nextern \"C\" void _MovieConvert (const char* savePath, const char* sourcePath , const int width, const int height, const int second, const char* gameObjectName, const char* callbackMethodName)\n{\n    //char\u3092NSString\u306b\u5909\u63db\n    NSString *save_path = [NSString stringWithCString:savePath encoding:NSUTF8StringEncoding];\n    NSString *source_path = [NSString stringWithCString:sourcePath encoding:NSUTF8StringEncoding];\n\n    if (save_path && source_path && ![save_path isEqual:@\"\"] && ![source_path isEqual:@\"\"]) {\n        //\u52d5\u753b\u306e\u7d20\u6750\u306b\u3059\u308b\u9023\u756a\u753b\u50cf\u306e\u53d6\u5f97\n        NSMutableArray *images = [[NSMutableArray alloc] init];\n        for (int i = 0; true; i++) {\n            //\u753b\u50cf\u306e\u30d1\u30b9\u751f\u6210\n            NSString *imagePath = [NSString stringWithFormat:@\"%@screenshot_%d.png\", source_path, i];\n            if (![[NSFileManager defaultManager] fileExistsAtPath:imagePath]) {\n                NSData *image_data = [NSData dataWithContentsOfURL:[NSURL URLWithString:imagePath]];\n                if (image_data) {\n                    UIImage *image = [UIImage imageWithData:image_data];\n                    if (image) {\n                        [images addObject:image];\n                    } else {\n                        break;\n                    }\n                } else {\n                    break;\n                }\n            } else {\n                break;\n            }\n        }\n\n        if ([images count] > 0) {\n            //\u4fdd\u5b58\u5148URL\u3068\u52d5\u753b\u306e\u5f62\u5f0f\u3092\u6307\u5b9a(.mov)\u3000AVFileTypeMPEG4 = .mp4\n            NSURL *url = [NSURL fileURLWithPath:save_path];\n            AVAssetWriter *videoWriter = [[AVAssetWriter alloc] initWithURL:url fileType:AVFileTypeQuickTimeMovie error:nil];\n\n            //\u30b3\u30fc\u30c7\u30c3\u30af\u3068\u52d5\u753b\u63cf\u753b\u30b5\u30a4\u30ba\u306e\u6307\u5b9a\n            NSDictionary *outputSettings = @{\n                AVVideoCodecKey : AVVideoCodecH264,\n                AVVideoWidthKey : @(width),\n                AVVideoHeightKey: @(height)\n            };\n            AVAssetWriterInput *writerInput = [AVAssetWriterInput assetWriterInputWithMediaType:AVMediaTypeVideo\n                                                                                 outputSettings:outputSettings];\n            [videoWriter addInput:writerInput];\n\n            //\u52d5\u753b\u306e\u7d20\u6750\u306b\u3059\u308b\u9023\u756a\u753b\u50cf\u306e\u8a2d\u5b9a\n            NSDictionary *sourcePixelBufferAttributes = @{\n                (NSString *)kCVPixelBufferPixelFormatTypeKey: @(kCVPixelFormatType_32ARGB),\n                (NSString *)kCVPixelBufferWidthKey: @(width),\n                (NSString *)kCVPixelBufferHeightKey: @(height)\n            };\n            AVAssetWriterInputPixelBufferAdaptor *adaptor = [AVAssetWriterInputPixelBufferAdaptor assetWriterInputPixelBufferAdaptorWithAssetWriterInput:writerInput\n                                                                                                                             sourcePixelBufferAttributes:sourcePixelBufferAttributes];\n            writerInput.expectsMediaDataInRealTime = YES;\n\n            //\u751f\u6210\u958b\u59cb\u3067\u304d\u308b\u304b\u78ba\u8a8d\n            if ([videoWriter startWriting]) {\n                //\u52d5\u753b\u751f\u6210\u958b\u59cb\n                [videoWriter startSessionAtSourceTime:kCMTimeZero];\n\n                //\u5168\u753b\u50cf\u3092\u30d0\u30c3\u30d5\u30a1\u306b\u8caf\u3081\u3053\u3080\n                CVPixelBufferRef buffer = NULL;\n                int frameCount = 0;\n                float durationForEachImage = [images count]/second; //\u753b\u50cf1\u679a\u306e\u8868\u793a\u6642\u9593\n                int32_t fps = 24; //FPS\n                for (UIImage *image in images) {\n                    @autoreleasepool {\n                        if (!adaptor.assetWriterInput.readyForMoreMediaData) {\n                            break;\n                        }\n\n                        // \u52d5\u753b\u306e\u6642\u9593\u3092\u751f\u6210\uff08\u305d\u306e\u753b\u50cf\u306e\u8868\u793a\u3059\u308b\u6642\u9593\u3002\u958b\u59cb\u6642\u70b9\u3068\u8868\u793a\u6642\u9593\u3092\u6e21\u3059\uff09\n                        CMTime frameTime = CMTimeMake((int64_t)frameCount * fps * durationForEachImage, fps);\n\n                        // CGImage\u304b\u3089\u30d0\u30c3\u30d5\u30a1\u3092\u751f\u6210\uff08\u5f8c\u8ff0\uff09\n                        NSDictionary *options = @{ (NSString *)kCVPixelBufferCGImageCompatibilityKey: @YES,\n                                                   (NSString *)kCVPixelBufferCGBitmapContextCompatibilityKey: @YES, };\n\n                        buffer = NULL;\n\n                        CGFloat width  = CGImageGetWidth(image.CGImage);\n                        CGFloat height = CGImageGetHeight(image.CGImage);\n                        CVPixelBufferCreate(kCFAllocatorDefault,\n                                            width,\n                                            height,\n                                            kCVPixelFormatType_32ARGB,\n                                            (__bridge CFDictionaryRef)options,\n                                            &buffer);\n\n                        CVPixelBufferLockBaseAddress(buffer, 0);\n                        void *pxdata = CVPixelBufferGetBaseAddress(buffer);\n\n                        size_t bitsPerComponent       = 8;\n                        size_t bytesPerRow            = 4 * width;\n                        CGColorSpaceRef rgbColorSpace = CGColorSpaceCreateDeviceRGB();\n                        CGContextRef context = CGBitmapContextCreate(pxdata,\n                                                                     width,\n                                                                     height,\n                                                                     bitsPerComponent,\n                                                                     bytesPerRow,\n                                                                     rgbColorSpace,\n                                                                     (CGBitmapInfo)kCGImageAlphaNoneSkipFirst);\n\n                        CGContextDrawImage(context, CGRectMake(0, 0, width, height), image.CGImage);\n                        CGColorSpaceRelease(rgbColorSpace);\n                        CGContextRelease(context);\n\n                        CVPixelBufferUnlockBaseAddress(buffer, 0);\n\n                        // \u751f\u6210\u3057\u305f\u30d0\u30c3\u30d5\u30a1\u3092\u8ffd\u52a0\n                        if (![adaptor appendPixelBuffer:buffer withPresentationTime:frameTime]) {\n                            // Error!\n                        }\n\n                        if (buffer) {\n                            CVBufferRelease(buffer);\n                        }\n\n                        frameCount++;\n                    }\n                }\n\n                // \u52d5\u753b\u751f\u6210\u7d42\u4e86\n                [writerInput markAsFinished];\n                [videoWriter endSessionAtSourceTime:CMTimeMake((int64_t)(frameCount - 1) * fps * durationForEachImage, fps)];\n                [videoWriter finishWritingWithCompletionHandler:^{\n                    //\u52d5\u753b\u306e\u751f\u6210\u304c\u7d42\u4e86\u3057\u305f\u3053\u3068\u3092Unity\u3078\u5831\u544a\n                    UnitySendMessage(gameObjectName, callbackMethodName, nil);\n                }];\n\n                // \u5f8c\u7247\u4ed8\u3051\n                CVPixelBufferPoolRelease(adaptor.pixelBufferPool);\n            } else {\n                //\u52d5\u753b\u306e\u751f\u6210\u304c\u3067\u304d\u306a\u3044\u72b6\u614b\u3092Unity\u3078\u5831\u544a\n                UnitySendMessage(gameObjectName, callbackMethodName, \"AVAssetWriter startWriting is false\");\n            }\n        } else {\n            //\u52d5\u753b\u306e\u7d20\u6750\u306b\u3059\u308b\u9023\u756a\u753b\u50cf\u304c\u53d6\u5f97\u3067\u304d\u306a\u3044\u72b6\u614b\u3092Unity\u3078\u5831\u544a\n            UnitySendMessage(gameObjectName, callbackMethodName, \"Source Images is Not found\");\n        }\n    } else {\n        //savePath,sourcePath\u304c\u4e0d\u6b63\u3067\u3042\u308b\u3053\u3068\u3092Unity\u3078\u5831\u544a\n        UnitySendMessage(gameObjectName, callbackMethodName, \"savePath,sourcePath is null\");\n    }\n}\n\n\n\n\u8aac\u660e\n\n\n_MovieConvert\u30e1\u30bd\u30c3\u30c9\u306e\u5f15\u6570\u8aac\u660e\n\n\nsavePath\u2026\u52d5\u753b\u3092\u4fdd\u5b58\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\n\n\nRead and Write\u306a\u30d5\u30a9\u30eb\u30c0\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\nsourcePath\u2026screenshot_0.png\u304b\u3089\u59cb\u307e\u308b\u9023\u756a\u753b\u50cf\u306e\u30d1\u30b9\n\n\nRead and Write\u306a\u30d5\u30a9\u30eb\u30c0\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\nwidth\u2026\u52d5\u753b\u306e\u6a2a\u30b5\u30a4\u30ba\nheight\u2026\u52d5\u753b\u306e\u7e26\u30b5\u30a4\u30ba\nsecond\u2026\u52d5\u753b\u306e\u518d\u751f\u79d2\u6570\ngameObjectName\u2026\u3053\u306e\u51e6\u7406\u3092\u547c\u3073\u51fa\u3057\u305fScript\u306eGameObject\u306e\u540d\u524d\ncallbackMethodName\u2026\u51e6\u7406\u5f8c\u306bUnity\u306b\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3059\u308b\u30e1\u30bd\u30c3\u30c9\u540d\n\n\nAVFileTypeQuickTimeMovie\u3067\u52d5\u753b\u306e\u66f8\u304d\u51fa\u3057\u5f62\u5f0f\u3092\u6307\u5b9a\nUnitySendMessage\u3084\u30cd\u30a4\u30c6\u30a3\u30d6\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u4f7f\u7528\u65b9\u6cd5\u306f\u4ee5\u4e0b\u3092\u53c2\u7167\n\n\nUnity\u3067\u30cd\u30a4\u30c6\u30a3\u30d6\u306e\u6a5f\u80fd\u3092\u547c\u3073\u51fa\u3057\u3066\u51e6\u7406\u5f8c\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3092\u53d7\u3051\u53d6\u308b\n\n\n\n\n\n\nOpenCV\uff08\u73fe\u5728\u691c\u8a3c\u4e2d\uff09\n\u3000OpenCV\u306b\u306fVideoWriter\u3068\u3044\u3046\u30af\u30e9\u30b9\u304c\u3042\u308b\u3089\u3057\u304f\u9023\u756a\u753b\u50cf\u3092\u52d5\u753b\u306b\u3067\u304d\u308b\u3053\u3068\u3092\u77e5\u308a\u307e\u3057\u305f\u3002\n\u3053\u3053\u3067\u306fC++\u306eOpenCV\u3092\u5143\u306b\u4f5c\u3089\u308c\u305fAsset\u3001OpenCVForUnity\u3092\u4f7f\u3063\u3066\u5b9f\u88c5\u3057\u3066\u3044\u304d\u307e\u3059\u3002\nOpenCVForUnity\u306e\u958b\u767a\u958b\u59cb\u307e\u3067\u306e\u624b\u9806\u306b\u95a2\u3057\u3066\u306fOpenCVForUnity\u3092Import\u3059\u308b\u307e\u3067\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\nOpenCVForUnity\u306fMac\u3084Window,Android,iOS\u306b\u3082\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u306e\u3067\u6709\u529b\u3067\u3059\u3002\n\n\n\n\u52d5\u4f5c\u74b0\u5883\n\u52d5\u4f5c\n\u753b\u8cea\n\u901f\u5ea6\n\n\n\n\nWindows\n...\n...\n...\n\n\nMac\n\u691c\u8a3c\u4e2d\n...\n...\n\n\nAndroid\n...\n...\n...\n\n\niOS\n...\n...\n...\n\n\n\n\nCVVideoConvert.cs\nusing UnityEngine;\nusing System;\nusing OpenCVForUnity;\n\npublic class CVVideoConvert : MonoBehaviour {\n    \u691c\u8a3c\u4e2d...\u304a\u5f85\u3061\u304f\u3060\u3055\u3044\u3002\n}\n\n\nUnity\u3067\u30d7\u30ec\u30a4\u753b\u9762\u3092\u52d5\u753b\u3068\u3057\u3066\u4fdd\u5b58\u3059\u308b\u6a5f\u80fd\u304c\u6b32\u3057\u304b\u3063\u305f\u306e\u3067\u8abf\u3079\u307e\u3057\u305f\u3002\n\u691c\u8a3c\u3057\u305f\u304c\u3001\u52d5\u4f5c\u3057\u306a\u3044\u3082\u306e\u3082\u3042\u308a\u307e\u3057\u305f\u306e\u3067\u3069\u3053\u304c\u3044\u3051\u306a\u304b\u3063\u305f\u304b\u3054\u6307\u6458\u304f\u3060\u3055\u3044\u3002\n\n- \u57fa\u672c\u7684\u306b\u30b9\u30af\u30ea\u30fc\u30f3\u30ad\u30e3\u30d7\u30c1\u30e3\u306e\u9023\u756a\u753b\u50cf\u3092\u4f5c\u6210\u3057\u3001\u52d5\u753b\u3078\u5909\u63db\u306e\u6d41\u308c\u3067\u3059\u3002\n- \u9332\u753b\u4e2d\u306e\u30d7\u30ec\u30a4\u97f3\u58f0\u3084\u30de\u30a4\u30af\u97f3\u58f0\u306f\u542b\u3093\u3067\u304a\u308a\u307e\u305b\u3093\u3002\n- \u5404\u65b9\u6cd5\u306b\u753b\u8cea\u3084\u901f\u5ea6\u306a\u3069\u3092\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\n    - \u753b\u8cea,\u901f\u5ea6\u306b\u95a2\u3057\u3066\u306f\u5143\u753b\u50cf\u306e\u753b\u8cea\u3084\u30b5\u30a4\u30ba\u306b\u5bfe\u3057\u3066\u306e\u6bd4\u8f03\u3067\u3059\u3002\n    - \u691c\u8a3c\u74b0\u5883\u306b\u5165\u3063\u3066\u3044\u308b\u304c\u9805\u76ee\u304c\u300c...\u300d\u306e\u3082\u306e\u306f\u52d5\u4f5c\u3059\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u304c\u5b9f\u969b\u306b\u78ba\u8a8d\u3057\u3066\u3044\u306a\u3044\u3082\u306e\u3067\u3059\u3002\n\n#ffmpeg\uff08Windows\u52d5\u4f5c\u78ba\u8a8d\u6e08\u307f\uff09\n<img width=\"30\" alt=\"ffmpeg_logo\" src=\"https://qiita-image-store.s3.amazonaws.com/0/82938/6d82eb93-55b8-6b49-2a25-e95cd9e05a92.png\">\u3000[ffmpeg](https://www.ffmpeg.org)\u3068\u3044\u3046\u30a2\u30d7\u30ea\u3092\u5229\u7528\u3057\u3066\u306e\u52d5\u753b\u5909\u63db\u3067\u3059\u3002\n\u5916\u90e8\u30a2\u30d7\u30ea\u3068\u3057\u3066\u975e\u8868\u793a\u3067\u52d5\u4f5c\u3055\u305b\u5f15\u6570\u3092\u6e21\u3057\u5909\u63db\u3057\u3066\u3082\u3089\u3046\u4f5c\u308a\u3002\nWindows\u3067\u306f\u52d5\u4f5c\u78ba\u8a8d\u3057\u307e\u3057\u305f\u304cMac\u7248\u3082\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306f\u3067\u304d\u307e\u3057\u305f\u304c\u672a\u691c\u8a3c\u3067\u3059\u3002\niOS\u3084Android\u306a\u3069\u306b\u95a2\u3057\u3066\u306f.exe\u3084.app\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u306e\u3067\u5229\u7528\u4e0d\u53ef\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001.mp4\u304b\u3089.mov\u3084.gif\u3078\u306e\u5909\u63db\u306a\u3069\u3082\u53ef\u80fd\u3067\u3059\u304c\u3053\u3053\u3067\u306f\u5272\u611b\u3057\u307e\u3059\u3002\n\n###\u691c\u8a3c\u7d50\u679c\n| \u691c\u8a3c\u74b0\u5883 | \u52d5\u4f5c | \u753b\u8cea | \u901f\u5ea6 |\n|:--|:-:|:-:|:-:|\n| Windows(.exe) | \u6210\u529f | \u60aa\u3044 | \u9045\u3044 |\n| Mac(.app) | ... | ... | ... |\n\n###\u691c\u8a3c\u5185\u5bb9\n```csharp:ffmpeg\npublic void movieConvert()\n{\n    int framerate = (int)(\u3010\u30ad\u30e3\u30d7\u30c1\u30e3\u679a\u6570\u3011 / 5);\n    var arguments = string.Format(\"-r {2} -i {0}screenshot_%d.png -vcodec libx264 -pix_fmt yuv420p \\\"{1}\\\"\", \u3010\u30ad\u30e3\u30d7\u30c1\u30e3\u753b\u50cf\u306e\u30d5\u30a9\u30eb\u30c0\u30d1\u30b9\u3011, \u3010\u52d5\u753b\u306e\u66f8\u304d\u51fa\u3057\u5148\u30d5\u30a9\u30eb\u30c0\u30d1\u30b9\u3011 + \"movie.mp4\", framerate);\n    exProcess = new Process();\n    exProcess.StartInfo.CreateNoWindow = true;\n    exProcess.StartInfo.WindowStyle = ProcessWindowStyle.Hidden;\n    exProcess.StartInfo.FileName = \u3010ffmpeg\u306e\u30d1\u30b9\u3011;\n    exProcess.StartInfo.Arguments = arguments;\n    exProcess.EnableRaisingEvents = true;\n\n    //\u5916\u90e8\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u5b9f\u884c\u3059\u308b\n    exProcess.Start();\n    exProcess.WaitForExit();\n\n    \u3010\u5909\u63db\u5f8c\u306e\u51e6\u7406\u3011\n}\n```\n- \u8aac\u660e\n    - \u3010\u3011\u306e\u4e2d\u3092\u66f8\u304d\u63db\u3048\u3066\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n    - \u3010\u30ad\u30e3\u30d7\u30c1\u30e3\u753b\u50cf\u306e\u30d5\u30a9\u30eb\u30c0\u30d1\u30b9\u3011\u306b\u306fscreenshot_0.png\u304b\u3089\u59cb\u307e\u308b\u9023\u756a\u753b\u50cf\u304c\u5165\u3063\u3066\u3044\u307e\u3059\u3002\n        - Read and Write\u306a\u30d5\u30a9\u30eb\u30c0\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n    - \u3010\u30ad\u30e3\u30d7\u30c1\u30e3\u679a\u6570\u3011\u306b\u306f\u9023\u756a\u753b\u50cf\u306e\u4e00\u756a\u5927\u304d\u3044\u6570\u5b57\u304c\u5165\u308a\u307e\u3059\u30020~40\u307e\u3067\u30ad\u30e3\u30d7\u30c1\u30e3\u3057\u305f\u6642\u306f40\u3067\u3059\u3002\n    - \u3010\u52d5\u753b\u306e\u66f8\u304d\u51fa\u3057\u5148\u30d5\u30a9\u30eb\u30c0\u30d1\u30b9\u3011\u306bmovie.mp4\u3068\u3044\u3046\u52d5\u753b\u30d5\u30a1\u30a4\u30eb\u304c\u66f8\u304d\u51fa\u3055\u308c\u307e\u3059\u3002\n        - Read and Write\u306a\u30d5\u30a9\u30eb\u30c0\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n    - \u3010ffmpeg\u306e\u30d1\u30b9\u3011\u306fffmpeg\u306e\u30a2\u30d7\u30ea\u306e\u30d1\u30b9\u3067\u3059\u3002\n        - \u30d3\u30eb\u30c9\u5f8c\u3082\u5909\u308f\u3089\u306a\u3044\u3088\u3046\u306b\u6ce8\u610f\u3002\n\n#AForge.Video.VFW\uff08\u5931\u6557..\uff09\n[AForge.NET](http://www.aforgenet.com/framework/)\u306eAForge.Video.VFW.dll\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f7f\u7528\u3057\u3066.avi\u306e\u52d5\u753b\u3092\u4f5c\u6210\u3059\u308b\u3002\nMac\u3067\u3084\u3063\u3066\u307f\u305f\u304cavifil32.dll\u304c\u306a\u3044\u3068\u6012\u3089\u308c\u8abf\u3079\u308b\u3068Windows\u306edll\u306a\u306e\u3067MacOS\u306f\u975e\u5bfe\u5fdc\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\u3082\u3057\u304b\u3057\u305f\u3089AForge.NET\u306e\u516c\u958b\u3057\u3066\u3044\u308b\u30bd\u30fc\u30b9\u3092Mac\u74b0\u5883\u3067\u30d3\u30eb\u30c9\u3059\u308b\u3053\u3068\u3067\u4f7f\u7528\u53ef\u80fd\u306b\u306a\u308b\u53ef\u80fd\u6027\u306f\u3042\u308b\n\n###\u691c\u8a3c\u7d50\u679c\n| \u52d5\u4f5c\u74b0\u5883 | \u52d5\u4f5c | \u753b\u8cea | \u901f\u5ea6 |\n|:-:|:-:|:-:|:-:|\n| Windows | ... | ... | ... |\n| Mac | \u5931\u6557 |   |   |\n| Android | ... | ... | ... |\n| iOS | ... | ... | ... |\n\n###\u691c\u8a3c\u5185\u5bb9\n- \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u4f7f\u7528\u53ef\u80fd\u306b\u3059\u308b\u307e\u3067\n    - \u30c8\u30c3\u30d7\u30da\u30fc\u30b8\u306e\u753b\u9762\u5de6\u306e\u30ea\u30b9\u30c8\u306bDownloads\u304c\u3042\u308b\u306e\u3067\u30af\u30ea\u30c3\u30af<br>\n      <img width=\"300\" alt=\"toppage\" src=\"https://qiita-image-store.s3.amazonaws.com/0/82938/228813a0-dc8c-9c81-0e41-29689a118099.png\">\n\n    - [ Download Full ZIP Archive ]\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9<br>\n      <img width=\"300\" alt=\"downloads\" src=\"https://qiita-image-store.s3.amazonaws.com/0/82938/f8fd24f1-a693-9c8a-842f-1ec34d688522.png\">\n\n    - \u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305fZIP\u3092\u89e3\u51cd\u3057\u3066Release\u30d5\u30a9\u30eb\u30c0\u5185\u306eAForge.dll\u3001AForge.Video.dll\u3001AForge.Video.VFW.dll\u3092\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e/Assets/Plugins/\u306b\u30b3\u30d4\u30fc\u3059\u308b\u3002\n\n- \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f7f\u7528\u3057\u3066\u5b9f\u88c5\u3057\u305fAForgeMovieConvert\u30af\u30e9\u30b9\n    - AVIWriter()\u306e\u90e8\u5206\u3067avifil32.dll\u304c\u306a\u3044\u3068\u30a8\u30e9\u30fc\n    - \u305d\u306e\u5148\u306e\u51e6\u7406\u306b\u3064\u3044\u3066\u306f\u4eee\u5b9f\u88c5...\n\n```csharp:AForgeMovieConvert.cs\nusing UnityEngine;\nusing AForge.Video.VFW;\n\npublic class AForgeMovieConvert : MonoBehaviour {\n\t\n\tpublic delegate void movieConvertCallback(bool success, string error);\n\tprivate movieConvertCallback convertCallback = null;\n\n\tpublic void movieConvert(string savePath, string sourcePath, int width, int height, int second, movieConvertCallback callback) {\n\t\tif (callback != null) {\n\t\t\tconvertCallback = callback;\n\t\t\tif (savePath != null && savePath != \"\") {\n\t\t\t\tif (sourcePath != null && sourcePath != \"\") {\n\t\t\t\t\tif (width > 0) {\n\t\t\t\t\t\tif (height > 0) {\n\t\t\t\t\t\t\tif (second > 0) {\n\t\t\t\t\t\t\t\tvar writer = new AVIWriter();\n\t\t\t\t\t\t\t\twriter.Codec = \"MSVC\"; //4\u6587\u5b57\u306e\u30b3\u30fc\u30c7\u30c3\u30af\n\t\t\t\t\t\t\t\twriter.FrameRate = 15; //FrameRate = sourcePath\u5185\u306e\u9023\u756a\u753b\u50cf\u306e\u679a\u6570 / second(\u52d5\u753b\u306e\u8868\u793a\u79d2\u6570)\n\t\t\t\t\t\t\t\twriter.Open(savePath + \"movie.avi\", width, height); //savePath\u306bmovie.avi\u3092\u4f5c\u6210\n\n\t\t\t\t\t\t\t\t//\u4f5c\u3063\u305fmovie.avi\u306b\u30d5\u30ec\u30fc\u30e0\u753b\u50cf\u3092\u63cf\u753b\u3057\u3066\u3044\u304f\n\t\t\t\t\t\t\t\tfor (int i = 0; i < 10; i++) {\n\t\t\t\t\t\t\t\t\t//bitmap\u306fsourcePath\u5185\u306e\u9023\u756a\u753b\u50cf\u3092\u4f7f\u7528\u3059\u308b\u3001\u73fe\u5728\u306f\u4eee\n\t\t\t\t\t\t\t\t\tSystem.Drawing.Bitmap bitmap = new System.Drawing.Bitmap(width, height);\n\t\t\t\t\t\t\t\t\twriter.AddFrame (bitmap);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\twriter.Close();\n\n\t\t\t\t\t\t\t\t//\u3053\u3053\u3067\u52d5\u753b\u304c\u4f5c\u6210\u5b8c\u4e86\u3001\u52d5\u753b\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u3044\u305f\u308a\u3057\u305f\u3044\u306a\u3089Close\u5f8c\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconvertCallback (false, \"movie second is 0\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconvertCallback (false, \"movie height is 0\");\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconvertCallback (false, \"movie width is 0\");\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconvertCallback (false, \"Notfound:sourcePath\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconvertCallback (false, \"Notfound:savePath\");\n\t\t\t}\n\t\t} else {\n\t\t\tDebug.Log (\"callback not found\");\n\t\t}\n\t}\n}\n```\n\n- \u8aac\u660e\n    - \u30b3\u30fc\u30c7\u30c3\u30af\u306f\u52d5\u753b\u306e\u66f8\u304d\u51fa\u3057\u65b9\u6cd5\u307f\u305f\u3044\u306a\u3082\u306e...[Video Codecs by FOURCC](http://www.fourcc.org/codecs.php)\n\n#iOS - AVAssetWriter\uff08\u5931\u6557..\uff09\n<img width=\"30\" alt=\"apple_logo\" src=\"https://qiita-image-store.s3.amazonaws.com/0/82938/8dd9e7b6-9f70-8a74-7b14-da8f8ac3c428.png\">\u3000iOS\u306b\u95a2\u3057\u3066\u306f\u30cd\u30a4\u30c6\u30a3\u30d6\u3067\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u66f8\u3044\u3066\u3084\u308d\u3046\u3068\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n###\u691c\u8a3c\u7d50\u679c\n| \u52d5\u4f5c\u74b0\u5883 | \u52d5\u4f5c | \u753b\u8cea | \u901f\u5ea6 |\n|:--|:-:|:-:|:-:|\n| iOS | \u5931\u6557 |   |   |\n\n\u7d50\u679c\u3068\u3057\u3066\u306fautoreleasepool\u3067\u56f2\u3063\u3066\u3044\u308bfor\u6587\u306e\u4e2d\u307e\u3067\u306f\u304f\u308b\u304c\u52d5\u753b\u751f\u6210\u7d42\u4e86\u306e\u30cf\u30f3\u30c9\u30e9\u30fc\u304c\u547c\u3070\u308c\u305a...\n\n> **tkyaji\u69d8\u3088\u308a\u52a9\u8a00 - 2016-11-17 00:05**\nAVAssetWriter#finishWritingWithCompletionHandler\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u306f\u3001\niOS8\u3060\u3068iOS\u306e\u30d0\u30b0\u3067\u547c\u3070\u308c\u306a\u304b\u3063\u305f\u6c17\u304c\u3057\u307e\u3059\u3002\uff08iOS7\u3082\uff1f\uff09\niOS9\u306e\u5834\u5408\u306f\u547c\u3070\u308c\u305f\u3088\u3046\u306a\u3002\u3002\u3002\n\n###\u691c\u8a3c\u5185\u5bb9\n```objc:iOSMovieConvert.mm\n#import <Foundation/Foundation.h>\n#import <AVFoundation/AVFoundation.h>\n\n//\u6307\u5b9a\u3057\u305f\u30d1\u30b9\u306e\u753b\u50cf\u3092\u30ab\u30e1\u30e9\u30ed\u30fc\u30eb\u306b\u4fdd\u5b58\u3059\u308b\u3002\nextern \"C\" void _MovieConvert (const char* savePath, const char* sourcePath , const int width, const int height, const int second, const char* gameObjectName, const char* callbackMethodName)\n{\n    //char\u3092NSString\u306b\u5909\u63db\n    NSString *save_path = [NSString stringWithCString:savePath encoding:NSUTF8StringEncoding];\n    NSString *source_path = [NSString stringWithCString:sourcePath encoding:NSUTF8StringEncoding];\n    \n    if (save_path && source_path && ![save_path isEqual:@\"\"] && ![source_path isEqual:@\"\"]) {\n        //\u52d5\u753b\u306e\u7d20\u6750\u306b\u3059\u308b\u9023\u756a\u753b\u50cf\u306e\u53d6\u5f97\n        NSMutableArray *images = [[NSMutableArray alloc] init];\n        for (int i = 0; true; i++) {\n            //\u753b\u50cf\u306e\u30d1\u30b9\u751f\u6210\n            NSString *imagePath = [NSString stringWithFormat:@\"%@screenshot_%d.png\", source_path, i];\n            if (![[NSFileManager defaultManager] fileExistsAtPath:imagePath]) {\n                NSData *image_data = [NSData dataWithContentsOfURL:[NSURL URLWithString:imagePath]];\n                if (image_data) {\n                    UIImage *image = [UIImage imageWithData:image_data];\n                    if (image) {\n                        [images addObject:image];\n                    } else {\n                        break;\n                    }\n                } else {\n                    break;\n                }\n            } else {\n                break;\n            }\n        }\n        \n        if ([images count] > 0) {\n            //\u4fdd\u5b58\u5148URL\u3068\u52d5\u753b\u306e\u5f62\u5f0f\u3092\u6307\u5b9a(.mov)\u3000AVFileTypeMPEG4 = .mp4\n            NSURL *url = [NSURL fileURLWithPath:save_path];\n            AVAssetWriter *videoWriter = [[AVAssetWriter alloc] initWithURL:url fileType:AVFileTypeQuickTimeMovie error:nil];\n            \n            //\u30b3\u30fc\u30c7\u30c3\u30af\u3068\u52d5\u753b\u63cf\u753b\u30b5\u30a4\u30ba\u306e\u6307\u5b9a\n            NSDictionary *outputSettings = @{\n                AVVideoCodecKey : AVVideoCodecH264,\n                AVVideoWidthKey : @(width),\n                AVVideoHeightKey: @(height)\n            };\n            AVAssetWriterInput *writerInput = [AVAssetWriterInput assetWriterInputWithMediaType:AVMediaTypeVideo\n                                                                                 outputSettings:outputSettings];\n            [videoWriter addInput:writerInput];\n            \n            //\u52d5\u753b\u306e\u7d20\u6750\u306b\u3059\u308b\u9023\u756a\u753b\u50cf\u306e\u8a2d\u5b9a\n            NSDictionary *sourcePixelBufferAttributes = @{\n                (NSString *)kCVPixelBufferPixelFormatTypeKey: @(kCVPixelFormatType_32ARGB),\n                (NSString *)kCVPixelBufferWidthKey: @(width),\n                (NSString *)kCVPixelBufferHeightKey: @(height)\n            };\n            AVAssetWriterInputPixelBufferAdaptor *adaptor = [AVAssetWriterInputPixelBufferAdaptor assetWriterInputPixelBufferAdaptorWithAssetWriterInput:writerInput\n                                                                                                                             sourcePixelBufferAttributes:sourcePixelBufferAttributes];\n            writerInput.expectsMediaDataInRealTime = YES;\n            \n            //\u751f\u6210\u958b\u59cb\u3067\u304d\u308b\u304b\u78ba\u8a8d\n            if ([videoWriter startWriting]) {\n                //\u52d5\u753b\u751f\u6210\u958b\u59cb\n                [videoWriter startSessionAtSourceTime:kCMTimeZero];\n                \n                //\u5168\u753b\u50cf\u3092\u30d0\u30c3\u30d5\u30a1\u306b\u8caf\u3081\u3053\u3080\n                CVPixelBufferRef buffer = NULL;\n                int frameCount = 0;\n                float durationForEachImage = [images count]/second; //\u753b\u50cf1\u679a\u306e\u8868\u793a\u6642\u9593\n                int32_t fps = 24; //FPS\n                for (UIImage *image in images) {\n                    @autoreleasepool {\n                        if (!adaptor.assetWriterInput.readyForMoreMediaData) {\n                            break;\n                        }\n                        \n                        // \u52d5\u753b\u306e\u6642\u9593\u3092\u751f\u6210\uff08\u305d\u306e\u753b\u50cf\u306e\u8868\u793a\u3059\u308b\u6642\u9593\u3002\u958b\u59cb\u6642\u70b9\u3068\u8868\u793a\u6642\u9593\u3092\u6e21\u3059\uff09\n                        CMTime frameTime = CMTimeMake((int64_t)frameCount * fps * durationForEachImage, fps);\n                        \n                        // CGImage\u304b\u3089\u30d0\u30c3\u30d5\u30a1\u3092\u751f\u6210\uff08\u5f8c\u8ff0\uff09\n                        NSDictionary *options = @{ (NSString *)kCVPixelBufferCGImageCompatibilityKey: @YES,\n                                                   (NSString *)kCVPixelBufferCGBitmapContextCompatibilityKey: @YES, };\n                        \n                        buffer = NULL;\n                        \n                        CGFloat width  = CGImageGetWidth(image.CGImage);\n                        CGFloat height = CGImageGetHeight(image.CGImage);\n                        CVPixelBufferCreate(kCFAllocatorDefault,\n                                            width,\n                                            height,\n                                            kCVPixelFormatType_32ARGB,\n                                            (__bridge CFDictionaryRef)options,\n                                            &buffer);\n                        \n                        CVPixelBufferLockBaseAddress(buffer, 0);\n                        void *pxdata = CVPixelBufferGetBaseAddress(buffer);\n                        \n                        size_t bitsPerComponent       = 8;\n                        size_t bytesPerRow            = 4 * width;\n                        CGColorSpaceRef rgbColorSpace = CGColorSpaceCreateDeviceRGB();\n                        CGContextRef context = CGBitmapContextCreate(pxdata,\n                                                                     width,\n                                                                     height,\n                                                                     bitsPerComponent,\n                                                                     bytesPerRow,\n                                                                     rgbColorSpace,\n                                                                     (CGBitmapInfo)kCGImageAlphaNoneSkipFirst);\n                        \n                        CGContextDrawImage(context, CGRectMake(0, 0, width, height), image.CGImage);\n                        CGColorSpaceRelease(rgbColorSpace);\n                        CGContextRelease(context);\n                        \n                        CVPixelBufferUnlockBaseAddress(buffer, 0);\n                        \n                        // \u751f\u6210\u3057\u305f\u30d0\u30c3\u30d5\u30a1\u3092\u8ffd\u52a0\n                        if (![adaptor appendPixelBuffer:buffer withPresentationTime:frameTime]) {\n                            // Error!\n                        }\n                        \n                        if (buffer) {\n                            CVBufferRelease(buffer);\n                        }\n                        \n                        frameCount++;\n                    }\n                }\n                \n                // \u52d5\u753b\u751f\u6210\u7d42\u4e86\n                [writerInput markAsFinished];\n                [videoWriter endSessionAtSourceTime:CMTimeMake((int64_t)(frameCount - 1) * fps * durationForEachImage, fps)];\n                [videoWriter finishWritingWithCompletionHandler:^{\n                    //\u52d5\u753b\u306e\u751f\u6210\u304c\u7d42\u4e86\u3057\u305f\u3053\u3068\u3092Unity\u3078\u5831\u544a\n                    UnitySendMessage(gameObjectName, callbackMethodName, nil);\n                }];\n                \n                // \u5f8c\u7247\u4ed8\u3051\n                CVPixelBufferPoolRelease(adaptor.pixelBufferPool);\n            } else {\n                //\u52d5\u753b\u306e\u751f\u6210\u304c\u3067\u304d\u306a\u3044\u72b6\u614b\u3092Unity\u3078\u5831\u544a\n                UnitySendMessage(gameObjectName, callbackMethodName, \"AVAssetWriter startWriting is false\");\n            }\n        } else {\n            //\u52d5\u753b\u306e\u7d20\u6750\u306b\u3059\u308b\u9023\u756a\u753b\u50cf\u304c\u53d6\u5f97\u3067\u304d\u306a\u3044\u72b6\u614b\u3092Unity\u3078\u5831\u544a\n            UnitySendMessage(gameObjectName, callbackMethodName, \"Source Images is Not found\");\n        }\n    } else {\n        //savePath,sourcePath\u304c\u4e0d\u6b63\u3067\u3042\u308b\u3053\u3068\u3092Unity\u3078\u5831\u544a\n        UnitySendMessage(gameObjectName, callbackMethodName, \"savePath,sourcePath is null\");\n    }\n}\n```\n\n- \u8aac\u660e\n    - _MovieConvert\u30e1\u30bd\u30c3\u30c9\u306e\u5f15\u6570\u8aac\u660e\n        - savePath\u2026\u52d5\u753b\u3092\u4fdd\u5b58\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\n            - Read and Write\u306a\u30d5\u30a9\u30eb\u30c0\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n        - sourcePath\u2026screenshot_0.png\u304b\u3089\u59cb\u307e\u308b\u9023\u756a\u753b\u50cf\u306e\u30d1\u30b9\n            - Read and Write\u306a\u30d5\u30a9\u30eb\u30c0\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n        - width\u2026\u52d5\u753b\u306e\u6a2a\u30b5\u30a4\u30ba\n        - height\u2026\u52d5\u753b\u306e\u7e26\u30b5\u30a4\u30ba\n        - second\u2026\u52d5\u753b\u306e\u518d\u751f\u79d2\u6570\n        - gameObjectName\u2026\u3053\u306e\u51e6\u7406\u3092\u547c\u3073\u51fa\u3057\u305fScript\u306eGameObject\u306e\u540d\u524d\n        - callbackMethodName\u2026\u51e6\u7406\u5f8c\u306bUnity\u306b\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3059\u308b\u30e1\u30bd\u30c3\u30c9\u540d\n    - AVFileTypeQuickTimeMovie\u3067\u52d5\u753b\u306e\u66f8\u304d\u51fa\u3057\u5f62\u5f0f\u3092\u6307\u5b9a\n    - UnitySendMessage\u3084\u30cd\u30a4\u30c6\u30a3\u30d6\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u4f7f\u7528\u65b9\u6cd5\u306f\u4ee5\u4e0b\u3092\u53c2\u7167\n        - [Unity\u3067\u30cd\u30a4\u30c6\u30a3\u30d6\u306e\u6a5f\u80fd\u3092\u547c\u3073\u51fa\u3057\u3066\u51e6\u7406\u5f8c\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3092\u53d7\u3051\u53d6\u308b](http://qiita.com/nanokanato/items/d6ebfcd69086c3fc5e79)\n\n#OpenCV\uff08\u73fe\u5728\u691c\u8a3c\u4e2d\uff09\n<img width=\"30\" alt=\"ffmpeg_logo\" src=\"https://qiita-image-store.s3.amazonaws.com/0/82938/cce384f5-2aa9-dc10-88d3-be226278c35f.png\">\u3000OpenCV\u306b\u306fVideoWriter\u3068\u3044\u3046\u30af\u30e9\u30b9\u304c\u3042\u308b\u3089\u3057\u304f\u9023\u756a\u753b\u50cf\u3092\u52d5\u753b\u306b\u3067\u304d\u308b\u3053\u3068\u3092\u77e5\u308a\u307e\u3057\u305f\u3002\n\n\u3053\u3053\u3067\u306fC++\u306eOpenCV\u3092\u5143\u306b\u4f5c\u3089\u308c\u305fAsset\u3001OpenCVForUnity\u3092\u4f7f\u3063\u3066\u5b9f\u88c5\u3057\u3066\u3044\u304d\u307e\u3059\u3002\nOpenCVForUnity\u306e\u958b\u767a\u958b\u59cb\u307e\u3067\u306e\u624b\u9806\u306b\u95a2\u3057\u3066\u306f[OpenCVForUnity\u3092Import\u3059\u308b\u307e\u3067](http://qiita.com/nanokanato/items/acc7fa6927b5a71755c1)\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\nOpenCVForUnity\u306fMac\u3084Window,Android,iOS\u306b\u3082\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u306e\u3067\u6709\u529b\u3067\u3059\u3002\n\n| \u52d5\u4f5c\u74b0\u5883 | \u52d5\u4f5c | \u753b\u8cea | \u901f\u5ea6 |\n|:-:|:-:|:-:|:-:|\n| Windows | ... | ... | ... |\n| Mac | \u691c\u8a3c\u4e2d | ... | ... |\n| Android | ... | ... | ... |\n| iOS | ... | ... | ... |\n\n```csharp:CVVideoConvert.cs\nusing UnityEngine;\nusing System;\nusing OpenCVForUnity;\n\npublic class CVVideoConvert : MonoBehaviour {\n    \u691c\u8a3c\u4e2d...\u304a\u5f85\u3061\u304f\u3060\u3055\u3044\u3002\n}\n```\n"}