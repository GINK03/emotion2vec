{"context": " More than 1 year has passed since last update.\n\n\u5404\u7a2e\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u5225 munin \u30d7\u30e9\u30b0\u30a4\u30f3\u8a2d\u5b9a\u624b\u9806\n\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u306b\u3088\u3063\u3066\u3001munin\u3078\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5\u304c\u5909\u308f\u3063\u3066\u304d\u307e\u3059\u306e\u3067\u3001\u5099\u5fd8\u9332\u7684\u306b\u30e1\u30e2\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nmunin\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff08\u30b5\u30fc\u30d0\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\uff09\u306b\u3064\u3044\u3066\u306f\u3001AWS EC2\u3067munin \u697d\u3005\u30ea\u30bd\u30fc\u30b9\u76e3\u8996 \u3057\u3088\u3046\uff01\u306b\u8a18\u8f09\u3057\u307e\u3057\u305f\u306e\u3067\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044 \u307b\u3093\u306e\u308a\u968f\u6642\u66f4\u65b0\u3057\u3066\u3044\u304f\u4e88\u5b9a\u3067\u3059\n\n\u4f5c\u696d\u5171\u901a \uff08\u500b\u4eba\u7684\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u76e3\u8996\u9805\u76ee\u3092\u524a\u9664\u3057\u307e\u3059\n\ncd /etc/munin/plugins\nunlink sendmail_mailqueue \nunlink sendmail_mailstats\nunlink sendmail_mailtraffic\nunlink users\nunlink threads\nunlink proc_pri\nunlink entropy\nunlink irqstats\nunlink forks\nunlink interrupts\n\n\n\u5404\u7a2e\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u5225\u3001\u30d7\u30e9\u30b0\u30a4\u30f3\u8a2d\u5b9a\u65b9\u6cd5\n\nmysql\n\nperl \u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nyum install --enablerepo=epel perl-IPC-ShareLite perl-Cache-Cache perl-Cache perl-DBD-MySQL\n\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\ncd /etc/munin/plugins\nln -s /usr/share/munin/plugins/mysql_ mysql_commands\nln -s /usr/share/munin/plugins/mysql_ mysql_innodb_bpool\nln -s /usr/share/munin/plugins/mysql_ mysql_innodb_io\nln -s /usr/share/munin/plugins/mysql_ mysql_innodb_log\nln -s /usr/share/munin/plugins/mysql_ mysql_innodb_tnx\nln -s /usr/share/munin/plugins/mysql_ mysql_select_types\nln -s /usr/share/munin/plugins/mysql_ mysql_table_locks\nln -s /usr/share/munin/plugins/mysql_ mysql_connections\nln -s /usr/share/munin/plugins/mysql_ mysql_slow\nln -s /usr/share/munin/plugins/mysql_ mysql_myisam_indexes\nln -s /usr/share/munin/plugins/mysql_ mysql_network_traffic\nln -s /usr/share/munin/plugins/mysql_ mysql_qcache\nln -s /usr/share/munin/plugins/mysql_ mysql_qcache_mem\n\n\nMySQL \u306e\u63a5\u7d9a\u8a2d\u5b9a\n\n_mysql_userid=\u30e6\u30fc\u30b6\u30fcID\n_mysql_passwd=\u30d1\u30b9\u30ef\u30fc\u30c9\n\ncat << _EOT_ >> /etc/munin/plugin-conf.d/munin-node\n[mysql*]\nenv.mysqlopts -u ${_mysql_userid} -p${_mysql_passwd}\nenv.mysqladmin /usr/bin/mysqladmin\nenv.mysqlconnection DBI:mysql:mysql;host=127.0.0.1;port=3306\nenv.mysqluser ${_mysql_userid}\nenv.mysqlpassword ${_mysql_passwd}\n_EOT_\n\n\n\u52d5\u4f5c\u78ba\u8a8d\n\n\n/usr/sbin/munin-run mysql_commands\n--------------\nCom_delete.value 52\nCom_insert.value 1624\nCom_insert_select.value 0\nCom_load.value 0\nCom_replace.value 0\nCom_replace_select.value 0\nCom_select.value 4\nCom_update.value 4330\nCom_update_multi.value 0\n\n\u30fbmariadb\u306e\u5834\u5408\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u3053\u3068\u304c\u3042\u308b\u306e\u3067\u30fb\u30fb\n\nUnknown section: INDIVIDUAL BUFFER POOL INFO at /etc/munin/plugins/mysql_commands line 1098.\n\n\n'INDIVIDUAL BUFFER POOL INFO'   => \\&skip,\n\n\u3068\u3044\u3046\u884c\u3092\u4e0b\u8a18\u3042\u305f\u308a\u306b\u8ffd\u8a18\nvi /usr/share/munin/plugins/mysql_\n---------------------------------\n    my %section_map = (\n\n        'BUFFER POOL AND MEMORY'   => \\&parse_buffer_pool_and_memory,\n        'FILE I/O'                 => \\&parse_file_io,\n        'INSERT BUFFER AND ADAPTIVE HASH INDEX'\n            => \\&parse_insert_buffer_and_adaptive_hash_index,\n        'LATEST DETECTED DEADLOCK' => \\&skip,\n        'LATEST FOREIGN KEY ERROR' => \\&skip,\n        'LOG'                      => \\&parse_log,\n        'ROW OPERATIONS'           => \\&skip,\n        'SEMAPHORES'               => \\&parse_semaphores,\n        'TRANSACTIONS'             => \\&parse_transactions,\n        'BACKGROUND THREAD'        => \\&skip,\n        'INDIVIDUAL BUFFER POOL INFO'   => \\&skip,    # \u2192 \u3053\u308c\u3092\u8ffd\u8a18                                                                    \n    );\n---------------------------------\n\n\napache\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\ncd /etc/munin/plugins\nln -s /usr/share/munin/plugins/apache_accesses /etc/munin/plugins/\nln -s /usr/share/munin/plugins/apache_processes /etc/munin/plugins/\nln -s /usr/share/munin/plugins/apache_volume /etc/munin/plugins/\nln -s /usr/share/munin/plugins/ps_ /etc/munin/plugins/ps_httpd\n\n\n\napache\u306e\u8a08\u6e2c\u7528\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u8a2d\u5b9a\n\ncat << '_EOT_' > /etc/httpd/conf.d/status.conf\n<IfModule mod_status.c>\n    ExtendedStatus On\n    <Location /server-status>\n        SetHandler server-status\n        Order deny,allow\n        Deny from all\n        Allow from 127.0.0.1\n    </Location>\n</IfModule>\n_EOT_\n\n\nconfig\u306e\u30c1\u30a7\u30c3\u30af\n\n/etc/init.d/httpd configtest\n\n\n\u8a2d\u5b9a\u306e\u53cd\u6620\n\n/etc/init.d/httpd graceful\n\n\n\u30b9\u30c6\u30fc\u30bf\u30b9\u78ba\u8a8d\n\ncurl http://127.0.0.1/server-status/?auto\n\n\n\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u306a\u3069\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u30fb\u30fb\u30fb\n\nProxyPass /server-status ! \u3067server-status\u3060\u3051\u306f\u3001\u30d7\u30ed\u30ad\u30b7\u3057\u306a\u3044\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\uff01\n<IfModule mod_proxy.c>\nSSLProxyEngine on\nProxyRequests Off\nProxyPass /server-status !\n.\n.\n\n\n\nredis\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\ncd /usr/share/munin/plugins/\nwget https://raw.github.com/bpineau/redis-munin/master/redis_\nchmod 755 redis_\ncd /etc/munin/plugins/\nln -s /usr/share/munin/plugins/redis_ redis_127.0.0.1_6379\n\n\nredis\u306b\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u4e0b\u8a18\u30b3\u30f3\u30d5\u30a3\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3057\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3059\u308b\n\ncat << '_EOT_' > /etc/munin/plugin-conf.d/redis\n[redis_*]\nenv.password passswwwword\n_EOT_\n\n* \u52d5\u4f5c\u78ba\u8a8d\n\n```bash\nmunin-run redis_127.0.0.1_6379\n-----\nmultigraph redis_clients_6379\nclients.value 1\nmultigraph redis_blocked_clients_6379\nblocked.value 0\nmultigraph redis_memory_6379\nmemory.value 1777184\nmultigraph redis_fragmentation_6379\nfrag.value 2.01\nmultigraph redis_total_connections_6379\nconnections.value 48221\nmultigraph redis_expired_keys_6379\nexpired.value 0\nmultigraph redis_evicted_keys_6379\nevicted.value 0\nmultigraph redis_pubsub_channels_6379\nchannels.value 0\nmultigraph redis_commands_6379\ncommands.value 317025\nhits.value 44456\nmisses.value 957\nmultigraph redis_dbs_6379\ndb0keys.value 729\ndb0expires.value 291\n-----\n\n\n# \u5404\u7a2e\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u5225 munin \u30d7\u30e9\u30b0\u30a4\u30f3\u8a2d\u5b9a\u624b\u9806\n\n\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u306b\u3088\u3063\u3066\u3001munin\u3078\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5\u304c\u5909\u308f\u3063\u3066\u304d\u307e\u3059\u306e\u3067\u3001\u5099\u5fd8\u9332\u7684\u306b\u30e1\u30e2\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nmunin\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff08\u30b5\u30fc\u30d0\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\uff09\u306b\u3064\u3044\u3066\u306f\u3001[AWS EC2\u3067munin \u697d\u3005\u30ea\u30bd\u30fc\u30b9\u76e3\u8996 \u3057\u3088\u3046\uff01](http://qiita.com/hit/items/366b8ae789411761f3f7)\u306b\u8a18\u8f09\u3057\u307e\u3057\u305f\u306e\u3067\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044 \u307b\u3093\u306e\u308a\u968f\u6642\u66f4\u65b0\u3057\u3066\u3044\u304f\u4e88\u5b9a\u3067\u3059\n\n## \u4f5c\u696d\u5171\u901a \uff08\u500b\u4eba\u7684\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u76e3\u8996\u9805\u76ee\u3092\u524a\u9664\u3057\u307e\u3059\n\n```bash\n\ncd /etc/munin/plugins\nunlink sendmail_mailqueue \nunlink sendmail_mailstats\nunlink sendmail_mailtraffic\nunlink users\nunlink threads\nunlink proc_pri\nunlink entropy\nunlink irqstats\nunlink forks\nunlink interrupts\n```\n\n## \u5404\u7a2e\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u5225\u3001\u30d7\u30e9\u30b0\u30a4\u30f3\u8a2d\u5b9a\u65b9\u6cd5\n\n### mysql\n\n* perl \u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\nyum install --enablerepo=epel perl-IPC-ShareLite perl-Cache-Cache perl-Cache perl-DBD-MySQL\n```\n\n* \u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\ncd /etc/munin/plugins\nln -s /usr/share/munin/plugins/mysql_ mysql_commands\nln -s /usr/share/munin/plugins/mysql_ mysql_innodb_bpool\nln -s /usr/share/munin/plugins/mysql_ mysql_innodb_io\nln -s /usr/share/munin/plugins/mysql_ mysql_innodb_log\nln -s /usr/share/munin/plugins/mysql_ mysql_innodb_tnx\nln -s /usr/share/munin/plugins/mysql_ mysql_select_types\nln -s /usr/share/munin/plugins/mysql_ mysql_table_locks\nln -s /usr/share/munin/plugins/mysql_ mysql_connections\nln -s /usr/share/munin/plugins/mysql_ mysql_slow\nln -s /usr/share/munin/plugins/mysql_ mysql_myisam_indexes\nln -s /usr/share/munin/plugins/mysql_ mysql_network_traffic\nln -s /usr/share/munin/plugins/mysql_ mysql_qcache\nln -s /usr/share/munin/plugins/mysql_ mysql_qcache_mem\n```\n\n* MySQL \u306e\u63a5\u7d9a\u8a2d\u5b9a\n\n```bash\n_mysql_userid=\u30e6\u30fc\u30b6\u30fcID\n_mysql_passwd=\u30d1\u30b9\u30ef\u30fc\u30c9\n\ncat << _EOT_ >> /etc/munin/plugin-conf.d/munin-node\n[mysql*]\nenv.mysqlopts -u ${_mysql_userid} -p${_mysql_passwd}\nenv.mysqladmin /usr/bin/mysqladmin\nenv.mysqlconnection DBI:mysql:mysql;host=127.0.0.1;port=3306\nenv.mysqluser ${_mysql_userid}\nenv.mysqlpassword ${_mysql_passwd}\n_EOT_\n```\n\n* \u52d5\u4f5c\u78ba\u8a8d\n\n```bash\n\n/usr/sbin/munin-run mysql_commands\n--------------\nCom_delete.value 52\nCom_insert.value 1624\nCom_insert_select.value 0\nCom_load.value 0\nCom_replace.value 0\nCom_replace_select.value 0\nCom_select.value 4\nCom_update.value 4330\nCom_update_multi.value 0\n```\n\n\u30fbmariadb\u306e\u5834\u5408\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u3053\u3068\u304c\u3042\u308b\u306e\u3067\u30fb\u30fb\n\n```bash\n\nUnknown section: INDIVIDUAL BUFFER POOL INFO at /etc/munin/plugins/mysql_commands line 1098.\n```\n```bash\n\n'INDIVIDUAL BUFFER POOL INFO'   => \\&skip,\n```\n\n\u3068\u3044\u3046\u884c\u3092\u4e0b\u8a18\u3042\u305f\u308a\u306b\u8ffd\u8a18\n\n```bash\nvi /usr/share/munin/plugins/mysql_\n---------------------------------\n    my %section_map = (\n\n        'BUFFER POOL AND MEMORY'   => \\&parse_buffer_pool_and_memory,\n        'FILE I/O'                 => \\&parse_file_io,\n        'INSERT BUFFER AND ADAPTIVE HASH INDEX'\n            => \\&parse_insert_buffer_and_adaptive_hash_index,\n        'LATEST DETECTED DEADLOCK' => \\&skip,\n        'LATEST FOREIGN KEY ERROR' => \\&skip,\n        'LOG'                      => \\&parse_log,\n        'ROW OPERATIONS'           => \\&skip,\n        'SEMAPHORES'               => \\&parse_semaphores,\n        'TRANSACTIONS'             => \\&parse_transactions,\n        'BACKGROUND THREAD'        => \\&skip,\n        'INDIVIDUAL BUFFER POOL INFO'   => \\&skip,    # \u2192 \u3053\u308c\u3092\u8ffd\u8a18                                                                    \n    );\n---------------------------------\n```\n\n### apache\n\n* \u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\ncd /etc/munin/plugins\nln -s /usr/share/munin/plugins/apache_accesses /etc/munin/plugins/\nln -s /usr/share/munin/plugins/apache_processes /etc/munin/plugins/\nln -s /usr/share/munin/plugins/apache_volume /etc/munin/plugins/\nln -s /usr/share/munin/plugins/ps_ /etc/munin/plugins/ps_httpd\n\n```\n\n* apache\u306e\u8a08\u6e2c\u7528\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u8a2d\u5b9a\n\n```bash\ncat << '_EOT_' > /etc/httpd/conf.d/status.conf\n<IfModule mod_status.c>\n    ExtendedStatus On\n    <Location /server-status>\n        SetHandler server-status\n        Order deny,allow\n        Deny from all\n        Allow from 127.0.0.1\n    </Location>\n</IfModule>\n_EOT_\n```\n\n* config\u306e\u30c1\u30a7\u30c3\u30af\n\n```bash\n/etc/init.d/httpd configtest\n```\n\n* \u8a2d\u5b9a\u306e\u53cd\u6620\n\n```bash\n/etc/init.d/httpd graceful\n```\n\n* \u30b9\u30c6\u30fc\u30bf\u30b9\u78ba\u8a8d\n\n```bash\ncurl http://127.0.0.1/server-status/?auto\n```\n\n* \u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u306a\u3069\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u30fb\u30fb\u30fb\n\nProxyPass /server-status ! \u3067server-status\u3060\u3051\u306f\u3001\u30d7\u30ed\u30ad\u30b7\u3057\u306a\u3044\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\uff01\n\n```\n<IfModule mod_proxy.c>\nSSLProxyEngine on\nProxyRequests Off\nProxyPass /server-status !\n.\n.\n\n```\n\n\n### redis\n\n* \u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\ncd /usr/share/munin/plugins/\nwget https://raw.github.com/bpineau/redis-munin/master/redis_\nchmod 755 redis_\ncd /etc/munin/plugins/\nln -s /usr/share/munin/plugins/redis_ redis_127.0.0.1_6379\n```\n\n* redis\u306b\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u4e0b\u8a18\u30b3\u30f3\u30d5\u30a3\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3057\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3059\u308b\n\n```bash\ncat << '_EOT_' > /etc/munin/plugin-conf.d/redis\n[redis_*]\nenv.password passswwwword\n_EOT_\n\n* \u52d5\u4f5c\u78ba\u8a8d\n\n```bash\nmunin-run redis_127.0.0.1_6379\n-----\nmultigraph redis_clients_6379\nclients.value 1\nmultigraph redis_blocked_clients_6379\nblocked.value 0\nmultigraph redis_memory_6379\nmemory.value 1777184\nmultigraph redis_fragmentation_6379\nfrag.value 2.01\nmultigraph redis_total_connections_6379\nconnections.value 48221\nmultigraph redis_expired_keys_6379\nexpired.value 0\nmultigraph redis_evicted_keys_6379\nevicted.value 0\nmultigraph redis_pubsub_channels_6379\nchannels.value 0\nmultigraph redis_commands_6379\ncommands.value 317025\nhits.value 44456\nmisses.value 957\nmultigraph redis_dbs_6379\ndb0keys.value 729\ndb0expires.value 291\n-----\n\n```\n", "tags": ["Munin", "Redis", "Apache", "MySQL"]}