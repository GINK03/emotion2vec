{"context": " More than 1 year has passed since last update.\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3084\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u753b\u9762\u306a\u3069\u3001Devise\u95a2\u9023\u306e\u753b\u9762\u306e\u307fSSL\u5316\u3057\u3066\u3001\u305d\u308c\u4ee5\u5916\u306fSSL\u5316\u3057\u305f\u304f\u306a\u3044\u5834\u5408\u306e\u624b\u9806\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n\u624b\u9806\nDevise\u95a2\u9023\u306eController\u3067SSL\u3092\u5f37\u5236\u7684\u306b\u6709\u52b9\u5316\u3057\u307e\u3059\u3002\n\nconfig/environments/production.rb\n# staging.rb\u304c\u3042\u308c\u3070\u305d\u3061\u3089\u3082\u540c\u69d8\nconfig.to_prepare { Devise::SessionsController.force_ssl }\nconfig.to_prepare { Devise::RegistrationsController.force_ssl }\nconfig.to_prepare { Devise::PasswordsController.force_ssl }\n\n\n(2012.11.23\u5909\u66f4)\n\u30ed\u30b0\u30a4\u30f3\u5f8c\u3001\u304a\u3088\u3073\u30ed\u30b0\u30a2\u30a6\u30c8\u5f8c\u306fhttps://\u3067\u306f\u306a\u304f\u3001http://\u3067\u30da\u30fc\u30b8\u3092\u8868\u793a\u3057\u3066\u307b\u3057\u3044\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306bDevise\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u307e\u3059\u3002\n\napp/controllers/application_controller.rb\ndef after_sign_in_path_for_with_http(resource_or_scope)\n  path = after_sign_in_path_for_without_http(resource_or_scope)\n  path_to_url(path)\nend\nalias_method_chain :after_sign_in_path_for, :http\n\ndef after_sign_out_path_for_with_http(resource_or_scope)\n  path = after_sign_out_path_for_without_http(resource_or_scope)\n  path_to_url(path)\nend\nalias_method_chain :after_sign_out_path_for, :http\n\ndef path_to_url(path)\n  \"http://#{request.host_with_port.sub(/:80$/,\"\")}/#{path.sub(/^\\//,\"\")}\"\nend\n\n\n\u30ed\u30b0\u30a2\u30a6\u30c8\u7528\u306e\u30ea\u30f3\u30af\u3092\u4f5c\u3063\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u30ea\u30f3\u30af\u5148\u3092https://\u306b\u3057\u307e\u3059\u3002\n\u305f\u3060\u3057\u3001\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u3067\u306fhttp://\u306b\u306a\u3063\u3066\u3044\u308b\u3068\u601d\u3046\u306e\u3067\u3001helper\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3063\u3066\u5207\u308a\u5206\u3051\u307e\u3057\u3087\u3046\u3002\n\napp/views/layouts/application.html.haml\nlink_to '\u30ed\u30b0\u30a2\u30a6\u30c8', destroy_user_session_url(protocol: protocol_for_devise), method: :delete\n\n\n\napp/helpers/application_helper.rb\ndef protocol_for_devise\n  Rails.env.development? ? 'http://' : 'https://'\nend\n\n\nSSL\u306e\u30da\u30fc\u30b8\u3067http://\u3092\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306a\u7b87\u6240\u304c\u3042\u308b\u3068\u3001\u30d6\u30e9\u30a6\u30b6\u306b\u3088\u3063\u3066\u306f\u8b66\u544a\u304c\u51fa\u307e\u3059\u3002\n\u305f\u3068\u3048\u3070\u3001twitter-bootstrap-rails\u3092\u4f7f\u3063\u3066\u3044\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306bhttp://\u306e\u8aad\u307f\u8fbc\u307f\u51e6\u7406\u304c\u3042\u308b\u306e\u3067\u3001URL\u3092https://\u306b\u5909\u66f4\u3057\u307e\u3059\u3002(\u5bfe\u8c61\u306e\u30ea\u30bd\u30fc\u30b9\u304chttp://\u3068https://\u306e\u3069\u3061\u3089\u3067\u3082\u53c2\u7167\u3067\u304d\u308b\u5834\u5408)\n\napp/views/layouts/application.html.haml\n- = javascript_include_tag \"http://html5shim.googlecode.com/svn/trunk/html5.js\"\n+ = javascript_include_tag \"https://html5shim.googlecode.com/svn/trunk/html5.js\"\n\n\n\u4ee5\u4e0a\u3067\u7d42\u308f\u308a\u3067\u3059\u3002\n\u6b63\u3057\u304f\u52d5\u4f5c\u3059\u308b\u304b\u3001\u30b5\u30fc\u30d0\u30fc\u3067\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u78ba\u8a8d\u74b0\u5883\n\nRails 3.2.8\nDevise 2.1.2\nHeroku Cedar Stack + Piggyback SSL\n\n\n\n\u304a\u307e\u3051\n\u5168\u753b\u9762\u3068\u3082\u5f37\u5236\u7684\u306bSSL\u5316\u3059\u308b\u5834\u5408(\u975eSSL\u306a\u30da\u30fc\u30b8\u304c\u4e0d\u8981\u306a\u5834\u5408)\u306f\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3060\u3051\u3067OK\u3067\u3059\u3002\n\nconfig/environments/production.rb\n# staging.rb\u304c\u3042\u308c\u3070\u305d\u3061\u3089\u3082\u540c\u69d8\nconfig.force_ssl = true\n\n\n\n\u53c2\u8003\n\nhttps://github.com/plataformatec/devise/wiki/How-To:-Use-SSL-(HTTPS)\nhttp://stackoverflow.com/questions/9527158/how-should-i-go-about-making-all-devise-paths-use-https\nhttp://grosser.it/2008/11/24/rails-transform-path-to-url/\n\n\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3084\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u753b\u9762\u306a\u3069\u3001Devise\u95a2\u9023\u306e\u753b\u9762\u306e\u307fSSL\u5316\u3057\u3066\u3001\u305d\u308c\u4ee5\u5916\u306fSSL\u5316\u3057\u305f\u304f\u306a\u3044\u5834\u5408\u306e\u624b\u9806\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n###\u624b\u9806\nDevise\u95a2\u9023\u306eController\u3067SSL\u3092\u5f37\u5236\u7684\u306b\u6709\u52b9\u5316\u3057\u307e\u3059\u3002\n\n````ruby:config/environments/production.rb\n# staging.rb\u304c\u3042\u308c\u3070\u305d\u3061\u3089\u3082\u540c\u69d8\nconfig.to_prepare { Devise::SessionsController.force_ssl }\nconfig.to_prepare { Devise::RegistrationsController.force_ssl }\nconfig.to_prepare { Devise::PasswordsController.force_ssl }\n````\n\n(2012.11.23\u5909\u66f4)\n\u30ed\u30b0\u30a4\u30f3\u5f8c\u3001\u304a\u3088\u3073\u30ed\u30b0\u30a2\u30a6\u30c8\u5f8c\u306f`https://`\u3067\u306f\u306a\u304f\u3001`http://`\u3067\u30da\u30fc\u30b8\u3092\u8868\u793a\u3057\u3066\u307b\u3057\u3044\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306bDevise\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u307e\u3059\u3002\n\n````ruby:app/controllers/application_controller.rb\ndef after_sign_in_path_for_with_http(resource_or_scope)\n  path = after_sign_in_path_for_without_http(resource_or_scope)\n  path_to_url(path)\nend\nalias_method_chain :after_sign_in_path_for, :http\n\ndef after_sign_out_path_for_with_http(resource_or_scope)\n  path = after_sign_out_path_for_without_http(resource_or_scope)\n  path_to_url(path)\nend\nalias_method_chain :after_sign_out_path_for, :http\n\ndef path_to_url(path)\n  \"http://#{request.host_with_port.sub(/:80$/,\"\")}/#{path.sub(/^\\//,\"\")}\"\nend\n````\n\n\u30ed\u30b0\u30a2\u30a6\u30c8\u7528\u306e\u30ea\u30f3\u30af\u3092\u4f5c\u3063\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u30ea\u30f3\u30af\u5148\u3092`https://`\u306b\u3057\u307e\u3059\u3002\n\u305f\u3060\u3057\u3001\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u3067\u306f`http://`\u306b\u306a\u3063\u3066\u3044\u308b\u3068\u601d\u3046\u306e\u3067\u3001helper\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3063\u3066\u5207\u308a\u5206\u3051\u307e\u3057\u3087\u3046\u3002\n\n````ruby:app/views/layouts/application.html.haml\nlink_to '\u30ed\u30b0\u30a2\u30a6\u30c8', destroy_user_session_url(protocol: protocol_for_devise), method: :delete\n````\n\n````ruby:app/helpers/application_helper.rb\ndef protocol_for_devise\n  Rails.env.development? ? 'http://' : 'https://'\nend\n````\n\nSSL\u306e\u30da\u30fc\u30b8\u3067`http://`\u3092\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306a\u7b87\u6240\u304c\u3042\u308b\u3068\u3001\u30d6\u30e9\u30a6\u30b6\u306b\u3088\u3063\u3066\u306f\u8b66\u544a\u304c\u51fa\u307e\u3059\u3002\n\u305f\u3068\u3048\u3070\u3001twitter-bootstrap-rails\u3092\u4f7f\u3063\u3066\u3044\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b`http://`\u306e\u8aad\u307f\u8fbc\u307f\u51e6\u7406\u304c\u3042\u308b\u306e\u3067\u3001URL\u3092`https://`\u306b\u5909\u66f4\u3057\u307e\u3059\u3002(\u5bfe\u8c61\u306e\u30ea\u30bd\u30fc\u30b9\u304c`http://`\u3068`https://`\u306e\u3069\u3061\u3089\u3067\u3082\u53c2\u7167\u3067\u304d\u308b\u5834\u5408)\n\n````diff:app/views/layouts/application.html.haml\n- = javascript_include_tag \"http://html5shim.googlecode.com/svn/trunk/html5.js\"\n+ = javascript_include_tag \"https://html5shim.googlecode.com/svn/trunk/html5.js\"\n````\n\n\u4ee5\u4e0a\u3067\u7d42\u308f\u308a\u3067\u3059\u3002\n\u6b63\u3057\u304f\u52d5\u4f5c\u3059\u308b\u304b\u3001\u30b5\u30fc\u30d0\u30fc\u3067\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n###\u78ba\u8a8d\u74b0\u5883\n  - Rails 3.2.8\n  - Devise 2.1.2\n  - Heroku Cedar Stack + [Piggyback SSL](https://devcenter.heroku.com/articles/ssl#piggyback-ssl)\n\n###\u304a\u307e\u3051\n\u5168\u753b\u9762\u3068\u3082\u5f37\u5236\u7684\u306bSSL\u5316\u3059\u308b\u5834\u5408(\u975eSSL\u306a\u30da\u30fc\u30b8\u304c\u4e0d\u8981\u306a\u5834\u5408)\u306f\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3060\u3051\u3067OK\u3067\u3059\u3002\n\n````ruby:config/environments/production.rb\n# staging.rb\u304c\u3042\u308c\u3070\u305d\u3061\u3089\u3082\u540c\u69d8\nconfig.force_ssl = true\n````\n\n###\u53c2\u8003\n  - https://github.com/plataformatec/devise/wiki/How-To:-Use-SSL-(HTTPS)\n  - http://stackoverflow.com/questions/9527158/how-should-i-go-about-making-all-devise-paths-use-https\n  - http://grosser.it/2008/11/24/rails-transform-path-to-url/\n", "tags": ["devise2.1.2", "Rails3.2.8"]}