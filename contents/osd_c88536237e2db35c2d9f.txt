{"tags": ["Ruby", "capistrano"], "context": " More than 1 year has passed since last update.capistrano \u3067 mysqldump \u3057\u3066\u3001\u30ed\u30fc\u30ab\u30eb\u307e\u3067\u6301\u3063\u3066\u304f\u308b\u3002\n\u8981\u70b9\u306f\u3001run \u306b\u30d6\u30ed\u30c3\u30af\u3092\u6e21\u3059\u3053\u3068\u3002\nrun cmd do |channel, stream, data|\n\u306e\u3068\u304d\u3001channel.send_data \u3067 \u30ea\u30e2\u30fc\u30c8\u306e stdin\u3001 data \u3067 stdout \u3092\u6271\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n\u624b\u9806\n\nmysql \u306e\u8a2d\u5b9a\u306f database.yml \u306b\u66f8\u304b\u308c\u3066\u3044\u308b\nYAML::load \u3067\u30cf\u30c3\u30b7\u30e5\u306b\u306a\u308b\nDataTime.now \u3067 \u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3092\u4ed8\u4e0e\nmysqldump \u3092 -p \u4ed8\u304d\u3067\u767a\u884c\nEnter password: \u3092\u5f85\u3063\u3066\u3001password \u3092\u5165\u529b\u3055\u305b\u308b\u3002\n\u4f5c\u6210\u5f8c\u3001get \u3057\u3066\u304f\u308b\u3002\n\nnamespace :mysql do\n  desc \"mysqldump\"\n  task :dump do\n    require \"date\"\n    database_yml_path = File.join(File.expand_path('../../', __FILE__), \"database.yml\")\n    database_yml = File.open(database_yml_path)\n    database_yml = YAML::load(database_yml)\n    settings = database_yml[\"#{rails_env}\"]\n    dump_path = \"mysql_dump.#{DateTime.now}.sql\"\n    cmd = \"mysqldump -u#{settings['username']} -p -h #{settings['host']} #{settings['database']} > #{dump_path}\"\n    run cmd do |channel, stream, data|\n      if data.chomp == \"Enter password: \"\n        channel.send_data(\"#{settings['password']}\\n\")\n      end\n    end\n    # get #{dump_path}\n  end\nend\n\n\n\u53c2\u8003\n2.x DSL Action Invocation Run \u00b7 capistrano/capistrano Wiki https://github.com/capistrano/capistrano/wiki/2.x-DSL-Action-Invocation-Run\ncapistrano \u3067 mysqldump \u3057\u3066\u3001\u30ed\u30fc\u30ab\u30eb\u307e\u3067\u6301\u3063\u3066\u304f\u308b\u3002\n\n\u8981\u70b9\u306f\u3001run \u306b\u30d6\u30ed\u30c3\u30af\u3092\u6e21\u3059\u3053\u3068\u3002\n \n```run cmd do |channel, stream, data|```\n\n\u306e\u3068\u304d\u3001channel.send_data \u3067 \u30ea\u30e2\u30fc\u30c8\u306e stdin\u3001 data \u3067 stdout \u3092\u6271\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n# \u624b\u9806\n- mysql \u306e\u8a2d\u5b9a\u306f database.yml \u306b\u66f8\u304b\u308c\u3066\u3044\u308b\n- YAML::load \u3067\u30cf\u30c3\u30b7\u30e5\u306b\u306a\u308b\n- DataTime.now \u3067 \u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3092\u4ed8\u4e0e\n- mysqldump \u3092 -p \u4ed8\u304d\u3067\u767a\u884c\n- Enter password: \u3092\u5f85\u3063\u3066\u3001password \u3092\u5165\u529b\u3055\u305b\u308b\u3002\n- \u4f5c\u6210\u5f8c\u3001get \u3057\u3066\u304f\u308b\u3002\n\n```rb\nnamespace :mysql do\n  desc \"mysqldump\"\n  task :dump do\n    require \"date\"\n    database_yml_path = File.join(File.expand_path('../../', __FILE__), \"database.yml\")\n    database_yml = File.open(database_yml_path)\n    database_yml = YAML::load(database_yml)\n    settings = database_yml[\"#{rails_env}\"]\n    dump_path = \"mysql_dump.#{DateTime.now}.sql\"\n    cmd = \"mysqldump -u#{settings['username']} -p -h #{settings['host']} #{settings['database']} > #{dump_path}\"\n    run cmd do |channel, stream, data|\n      if data.chomp == \"Enter password: \"\n        channel.send_data(\"#{settings['password']}\\n\")\n      end\n    end\n    # get #{dump_path}\n  end\nend\n```\n\n# \u53c2\u8003\n2.x DSL Action Invocation Run \u00b7 capistrano/capistrano Wiki https://github.com/capistrano/capistrano/wiki/2.x-DSL-Action-Invocation-Run"}