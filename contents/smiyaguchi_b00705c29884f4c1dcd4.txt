{"context": "kubenetes1.4\u304b\u3089\u5c0e\u5165\u3055\u308c\u305fkubeadm\uff08alpha\u7248\uff09\u3092\u4f7f\u7528\u3057\u3066\u3001\u30ed\u30fc\u30ab\u30eb\u306eVirtualBox\u4e0a\u306bkuebernetes\u30af\u30e9\u30b9\u30bf\u3092\u69cb\u7bc9\u3057\u305f\u969b\u306b\u767a\u751f\u3057\u305f\u30a8\u30e9\u30fc\u306e\u89e3\u6c7a\u65b9\u6cd5\u306e\u899a\u66f8\u304d\u3067\u3059\u3002\nkubeadm\u3092\u4f7f\u7528\u3057\u3066kubernetes\u30af\u30e9\u30b9\u30bf\u306bNode\u3092\u8ffd\u52a0\u3057\u3088\u3046\u3068\u3057\u305f\u969b\u306b\u3001Node\u5074\u304b\u3089Master\u3078\u306e\u63a5\u7d9a\u304c\u3067\u304d\u306a\u3044\u3068\u3044\u3046\u306e\u304c\u30a8\u30e9\u30fc\u306e\u5185\u5bb9\u306b\u306a\u308a\u307e\u3059\u3002\n\u74b0\u5883\u306fVagrant\u3092\u4f7f\u7528\u3057\u3066\u3001VirtualBox\u4e0a\u306bUbuntu16.04\u306eMaster\u3068Node\u3092\u7528\u610f\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u524d\u63d0\nPC\uff1aMacBook Pro\uff08OS X El Capitan 10.11.6\uff09\nVirtualBox\uff1a\u30d0\u30fc\u30b8\u30e7\u30f3 5.0.26 r108824\nVagrant\uff1a\u30d0\u30fc\u30b8\u30e7\u30f3 1.8.6\n\n\u69cb\u6210\nVirtualBox\u4e0a\u306b\u4e0b\u8a18\uff12\u74b0\u5883\u3092\u7528\u610f\u3002\nMaster\n\u30fbOS\uff1aUbuntu16.04\n\u30fb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30c0\u30d7\u30bf\u30fc1\uff1aNAT\n\u30fb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30c0\u30d7\u30bf\u30fc2\uff1a\u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30a2\u30c0\u30d7\u30bf\u30fc\nNode\n\u30fbOS\uff1aUbuntu16.04\n\u30fb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30c0\u30d7\u30bf\u30fc1\uff1aNAT\n\u30fb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30c0\u30d7\u30bf\u30fc2\uff1a\u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30a2\u30c0\u30d7\u30bf\u30fc\n\n\u4eee\u60f3\u74b0\u5883\u69cb\u7bc9 - Vagrant\nVagrant\u3092\u4f7f\u7528\u3057\u3066\u4eee\u60f3\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306b\u3001\u307e\u305a\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066Vagrantfile\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u5b9f\u884c\u3059\u308b\u3068\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306bVagrantfile\u304c\u4f5c\u6210\u3055\u308c\u308b\u306e\u3067\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u79fb\u52d5\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n$ vagrant init ubuntu/xenial64\n\n\u6b21\u306b\u3001\u4f5c\u6210\u3057\u305fVagrantfile\u3092\u7de8\u96c6\u3067\u3059\u3002\n\u7de8\u96c6\u3059\u308b\u5185\u5bb9\u306f\n\n\nubuntu/xenial64\u306eBox\u3092\u4f7f\u7528\u3057\u3066\u3001Master\u3068Node\u3092\u7acb\u3061\u4e0a\u3052\u308b\nMaster\u3068Node\u9593\u3067\u901a\u4fe1\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3001private_network\u3092\u8a2d\u5b9a\u3059\u308b\n\n\u306e2\u70b9\u306b\u306a\u308a\u307e\u3059\u3002\n\nVagrantfile\n # -*- mode: ruby -*-\n # vi: set ft=ruby :\n\n Vagrant.configure(2) do |config|\n   config.vm.box = \"ubuntu/xenial64\"\n\n   # Master\u306e\u8a2d\u5b9a\n   # \u56fa\u5b9aIP\u30a2\u30c9\u30ec\u30b9 192.168.33.10\u3092\u6307\u5b9a\n   config.vm.define :master do | master |\n     master.vm.hostname = \"master\"\n     master.vm.network :private_network, ip: \"192.168.33.10\"\n   end\n\n   # Node\u306e\u8a2d\u5b9a\n\u3000\u3000\u3000\u3000\u3000\u3000# \u56fa\u5b9aIP\u30a2\u30c9\u30ec\u30b9 192.168.33.11\u3092\u6307\u5b9a\n   config.vm.define :node1 do | node1 |\n     node1.vm.hostname = \"node1\"\n     node1.vm.network :private_network, ip: \"192.168.33.11\"\n   end\nend\n\n\nVagrantfile\u306e\u7de8\u96c6\u304c\u7d42\u308f\u308c\u3070\u3001vagrant up\u3092\u5b9f\u884c\u3057\u3066\u4eee\u60f3\u74b0\u5883\u3092\u7acb\u3061\u4e0a\u3052\u307e\u3059\u3002\n\nkubeadm\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4eee\u60f3\u74b0\u5883\u304c\u7acb\u3061\u4e0a\u304c\u3063\u305f\u3089\u3001\u307e\u305akubernet\u30af\u30e9\u30b9\u30bf\u3092\u69cb\u7bc9\u3059\u308b\u306e\u306b\u5fc5\u8981\u306akubeadm\u3001\u304a\u3088\u3073\u305d\u306e\u4ed6\u306e\u5fc5\u9808\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u5f93\u3063\u3066Master\u3068Node\u306e\u4e21\u65b9\u5171\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nvagrant ssh master\u3001vagrant ssh node1\u3067\u4eee\u60f3\u74b0\u5883\u306b\u63a5\u7d9a\u3057\u3066root\u3067\u4f5c\u696d\u958b\u59cb\u3067\u3059\u3002\n\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u901a\u308a\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n# curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -\n# cat <<EOF > /etc/apt/sources.list.d/kubernetes.list\ndeb http://apt.kubernetes.io/ kubernetes-xenial main\nEOF\n# apt-get update\n# apt-get install -y docker.io kubelet kubeadm kubectl kubernetes-cni\n\n\nMaster\u306e\u521d\u671f\u5316 - Node\u8ffd\u52a0\uff08\u30a8\u30e9\u30fc\u767a\u751f\u7b87\u6240\uff09\n\u554f\u984c\u304c\u3042\u3063\u305f\u306e\u306f\u3053\u3053\u3067\u3059\u3002\n\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u901a\u308akubeadm init\u3092\u5b9f\u884c\u3059\u308b\u3068\u4e0b\u8a18\u306e\u3088\u3046\u306bNode\u5074\u3067\u5b9f\u884c\u3059\u308bjoin\u30b3\u30de\u30f3\u30c9\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\uff08\u30c8\u30fc\u30af\u30f3\u306e\u5024\u306f\u9069\u5f53\u306a\u3082\u306e\u306b\u7f6e\u304d\u63db\u3048\u3066\u307e\u3059\uff09\nmaster# kubeadm init\n<master/tokens> generated token: \"123abc.123456789abcdefg\"\n<master/pki> created keys and certificates in \"/etc/kubernetes/pki\"\n<util/kubeconfig> created \"/etc/kubernetes/kubelet.conf\"\n<util/kubeconfig> created \"/etc/kubernetes/admin.conf\"\n<master/apiclient> created API client configuration\n<master/apiclient> created API client, waiting for the control plane to become ready\n<master/apiclient> all control plane components are healthy after 44.814120 seconds\n<master/apiclient> waiting for at least one node to register and become ready\n<master/apiclient> first node is ready after 4.230195 seconds\n<master/discovery> created essential addon: kube-discovery, waiting for it to become ready\n<master/discovery> kube-discovery is ready after 31.503093 seconds\n<master/addons> created essential addon: kube-proxy\n<master/addons> created essential addon: kube-dns\n\nKubernetes master initialised successfully!\n\nYou can now join any number of machines by running the following on each node:\n\nkubeadm join --token 123abc.123456789abcdefg 10.0.2.15\n\n\u672c\u6765\u3067\u3042\u308c\u3070\u8868\u793a\u3055\u308c\u305fjoin\u30b3\u30de\u30f3\u30c9\u3092Node\u5074\u3067\u4f7f\u7528\u3059\u308c\u3070\u3001Node\u3092kubernetes\u30af\u30e9\u30b9\u30bf\u306b\u8ffd\u52a0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u3067\u3059\u304c\u3001\u5b9f\u884c\u3057\u3066\u307f\u305f\u3068\u3053\u308d\u4e0b\u8a18\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\nnode1# kubeadm join --token 123abc.123456789abcdefg 10.0.2.15\n<util/tokens> validating provided token\n<node/discovery> created cluster info discovery client, requesting info from \"http://10.0.2.15:9898/cluster-info/v1/?token-id=629bfc\"\nerror: <node/discovery> failed to request cluster info [Get http://10.0.2.15:9898/cluster-info/v1/?token-id=123abc: dial tcp 10.0.2.15:9898: getsockopt: connection refused]\n\njoin\u30b3\u30de\u30f3\u30c9\u3067\u6307\u5b9a\u3057\u305f10.0.2.15\u306b\u63a5\u7d9a\u3067\u304d\u306a\u3044\u3068\u63a5\u7d9a\u3067\u304d\u306a\u3044\u3068\u6012\u3089\u308c\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\u3069\u3046\u3082kubeadm\u306fjoin\u30b3\u30de\u30f3\u30c9\u3092\u8868\u793a\u3059\u308b\u969b\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u3001\u81ea\u52d5\u3067\u691c\u51fa\u3057\u3066\u304f\u308c\u308b\u307f\u305f\u3044\u306a\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306e\u5834\u5408IP\u30a2\u30c9\u30ec\u30b9\u304c2\u3064\u3042\u308a\u3001Master\u3068Node\u9593\u3067\u901a\u4fe1\u3067\u304d\u308b\u3088\u3046\u306b\u6307\u5b9a\u3057\u305f\u56fa\u5b9aIP\u30a2\u30c9\u30ec\u30b9\u3092\u691c\u51fa\u3057\u3066\u3044\u306a\u304b\u3063\u305f\u70ba\u306b\u3001Node\u5074\u304b\u3089Master\u3078\u306e\u901a\u4fe1\u306b\u5931\u6557\u3057\u3066\u3044\u305f\u307f\u305f\u3044\u3067\u3059\u3002\n10.0.2.15\u306fVirtualBox\u306eNAT\u7528\u306eIP\u30a2\u30c9\u30ec\u30b9\u3067\u3057\u305f\u3002\nMaster\u5074\u306eifconfig\u306e\u5b9f\u884c\u7d50\u679c\u306f\u4e0b\u8a18\u306b\u306a\u308a\u307e\u3059\u3002\nmaster# ifconfig\ndocker0   Link encap:Ethernet  HWaddr 02:42:40:e4:03:c2\n          inet addr:172.17.0.1  Bcast:0.0.0.0  Mask:255.255.0.0\n          UP BROADCAST MULTICAST  MTU:1500  Metric:1\n          RX packets:0 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0\n          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)\n\nenp0s3    Link encap:Ethernet  HWaddr 02:3b:10:fe:82:8d\n          inet addr:10.0.2.15  Bcast:10.0.2.255  Mask:255.255.255.0\n          inet6 addr: fe80::3b:10ff:fefe:828d/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:255853 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:94600 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:366452042 (366.4 MB)  TX bytes:5874999 (5.8 MB)\n\nenp0s8    Link encap:Ethernet  HWaddr 08:00:27:65:8e:49\n          inet addr:192.168.33.10  Bcast:192.168.33.255  Mask:255.255.255.0\n          inet6 addr: fe80::a00:27ff:fe65:8e49/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:9 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:8 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:828 (828.0 B)  TX bytes:648 (648.0 B)\n\nlo        Link encap:Local Loopback\n          inet addr:127.0.0.1  Mask:255.0.0.0\n          inet6 addr: ::1/128 Scope:Host\n          UP LOOPBACK RUNNING  MTU:65536  Metric:1\n          RX packets:66878 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:66878 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1\n          RX bytes:31873809 (31.8 MB)  TX bytes:31873809 (31.8 MB)\n\n\n\u89e3\u6c7a\u65b9\u6cd5\n\u3044\u308d\u3044\u308d\u8abf\u3079\u3066\u307f\u3068\u3053\u308d\u540c\u3058\u3088\u3046\u306a\u72b6\u6cc1\u306b\u306a\u3063\u3066\u3044\u308b\u4eba\u304c\u3044\u307e\u3057\u305f\u3002kubernetes issue#33562\u3002\n\u89e3\u6c7a\u65b9\u6cd5\u3068\u3057\u3066\u306f\u3001\u8907\u6570IP\u30a2\u30c9\u30ec\u30b9\u3092\u6301\u3063\u3066\u3044\u308b\u5834\u5408\u306fkubeadm init\u3092\u5b9f\u884c\u3059\u308b\u6642\u306b\u3001\u30aa\u30d7\u30b7\u30e7\u30f3\u306e--api-advertise-addresses\u3092\u4f7f\u7528\u3057\u3066IP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3057\u3066\u3042\u3052\u308c\u3070\u3044\u3044\u307f\u305f\u3044\u3067\u3059\u3002\n\u5ff5\u306e\u305f\u3081\u4eee\u60f3\u74b0\u5883\u3092\u3082\u3046\u4e00\u5ea6\u4f5c\u308a\u76f4\u3057\u3066\u304b\u3089\u3001--api-advertise-addresses\u3092\u4f7f\u7528\u3057\u3066\u518d\u5ea6kubeadm init\u3092\u5b9f\u884c\u3057\u3066\u307f\u308b\u3068\u3001\nmaster# kubeadm init --api-advertise-addresses=192.168.33.10\n\u30fb\u30fb\u30fb\n\u30fb\u30fb\u30fb\nkubeadm join --token 123xyz.123456789abcdefg 192.168.33.10\u3000\n\n\u6307\u5b9a\u3057\u305fIP\u30a2\u30c9\u30ec\u30b9\u304c\u8868\u793a\u3055\u308c\u307e\u3057\u305f!\n\u8868\u793a\u3055\u308c\u305fjoin\u30b3\u30de\u30f3\u30c9\u3092Node\u5074\u3067\u5b9f\u884c\u3057\u305f\u5834\u5408\u3082\u30a8\u30e9\u30fc\u3068\u306a\u3089\u305a\u306b\u6210\u529f\u3067\u3059\u3002\nnode1# kubeadm join --token 123xyz.123456789abcdefg 192.168.33.10\n<util/tokens> validating provided token\n<node/discovery> created cluster info discovery client, requesting info from \"http://192.168.33.10:9898/cluster-info/v1/?token-id=123xyz\"\n<node/discovery> cluster info object received, verifying signature using given token\n<node/discovery> cluster info signature and contents are valid, will use API endpoints [https://192.168.33.10:443]\n<node/csr> created API client to obtain unique certificate for this node, generating keys and certificate signing request\n<node/csr> received signed certificate from the API server, generating kubelet configuration\n<util/kubeconfig> created \"/etc/kubernetes/kubelet.conf\"\n\nNode join complete:\n* Certificate signing request sent to master and response\n  received.\n* Kubelet informed of new secure connection details.\n\nRun 'kubectl get nodes' on the master to see this machine join.\n\nMaster\u5074\u3067\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3068\u3001\u3061\u3083\u3093\u3068Node\u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\nmaster# kubectl get nodes\nNAME      STATUS    AGE\nmaster    Ready     3m\nnode1     Ready     18s\n\n\n\u672a\u89e3\u6c7a\u306e\u554f\u984c\n\u4e0a\u8a18\u30a8\u30e9\u30fc\u306f\u89e3\u6c7a\u3057\u307e\u3057\u305f\u304c\u3001\u3053\u306e\u74b0\u5883\u3067\u306f\u307e\u3060\u4e0b\u8a182\u70b9\u306e\u554f\u984c\u3092\u78ba\u8a8d\u3057\u3066\u3044\u307e\u3059\u3002\n\nMaster\u5074\u3067kube-dns\u306ePod\u304c\u8d77\u52d5\u3055\u308c\u306a\u3044\uff08STATUS\u304c\u300cContainerCreating\u300d\u304b\u3089\u9032\u307e\u306a\u3044\uff09\nPod\u9593\u901a\u4fe1\u306bWeave Net\u3092\u4f7f\u7528\u3057\u305f\u969b\u306b\u3001Weave Net\u306ePod\u306e1\u3064\u304c\u300cCrashLoopBackOff\u300d\u306b\u306a\u308b\n\n\u8a2d\u5b9a\u306e\u554f\u984c\u304bkubeadm\u306e\u554f\u984c\u306a\u306e\u304b\u306f\u8abf\u67fb\u4e2d\u3067\u3059\u304c\u3001GitHub\u3092\u898b\u308b\u3068VirtualBox\u306b\u95a2\u9023\u3057\u305fkubeadm\u306eissue\u304c\u3044\u304f\u3064\u304b\u3042\u3063\u305f\u306e\u3067\u3001kubeadm\u306e\u554f\u984c\u306e\u53ef\u80fd\u6027\u3082\u9ad8\u305d\u3046\u306a\u6c17\u304c\u3057\u307e\u3059\u3002\n\u307e\u3060kubeadm\u306falpha\u7248\u306a\u306e\u3067\u3001\u307e\u3060\u307e\u3060\u3053\u308c\u304b\u3089\u306b\u671f\u5f85\u3068\u3044\u3046\u3068\u3053\u308d\u3067\u3057\u3087\u3046\u304b\u3002\nkubenetes1.4\u304b\u3089\u5c0e\u5165\u3055\u308c\u305f`kubeadm\uff08alpha\u7248\uff09`\u3092\u4f7f\u7528\u3057\u3066\u3001\u30ed\u30fc\u30ab\u30eb\u306eVirtualBox\u4e0a\u306bkuebernetes\u30af\u30e9\u30b9\u30bf\u3092\u69cb\u7bc9\u3057\u305f\u969b\u306b\u767a\u751f\u3057\u305f\u30a8\u30e9\u30fc\u306e\u89e3\u6c7a\u65b9\u6cd5\u306e\u899a\u66f8\u304d\u3067\u3059\u3002\n\n`kubeadm`\u3092\u4f7f\u7528\u3057\u3066kubernetes\u30af\u30e9\u30b9\u30bf\u306bNode\u3092\u8ffd\u52a0\u3057\u3088\u3046\u3068\u3057\u305f\u969b\u306b\u3001Node\u5074\u304b\u3089Master\u3078\u306e\u63a5\u7d9a\u304c\u3067\u304d\u306a\u3044\u3068\u3044\u3046\u306e\u304c\u30a8\u30e9\u30fc\u306e\u5185\u5bb9\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u74b0\u5883\u306fVagrant\u3092\u4f7f\u7528\u3057\u3066\u3001VirtualBox\u4e0a\u306bUbuntu16.04\u306eMaster\u3068Node\u3092\u7528\u610f\u3057\u3066\u3044\u307e\u3059\u3002\n\n# \u524d\u63d0\nPC\uff1aMacBook Pro\uff08OS X El Capitan 10.11.6\uff09\nVirtualBox\uff1a\u30d0\u30fc\u30b8\u30e7\u30f3 5.0.26 r108824\nVagrant\uff1a\u30d0\u30fc\u30b8\u30e7\u30f3 1.8.6\n\n# \u69cb\u6210\nVirtualBox\u4e0a\u306b\u4e0b\u8a18\uff12\u74b0\u5883\u3092\u7528\u610f\u3002\nMaster\n\u30fbOS\uff1aUbuntu16.04\n\u30fb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30c0\u30d7\u30bf\u30fc1\uff1aNAT\n\u30fb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30c0\u30d7\u30bf\u30fc2\uff1a\u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30a2\u30c0\u30d7\u30bf\u30fc\n\nNode\n\u30fbOS\uff1aUbuntu16.04\n\u30fb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30c0\u30d7\u30bf\u30fc1\uff1aNAT\n\u30fb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30c0\u30d7\u30bf\u30fc2\uff1a\u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30a2\u30c0\u30d7\u30bf\u30fc\n\n# \u4eee\u60f3\u74b0\u5883\u69cb\u7bc9 - Vagrant\nVagrant\u3092\u4f7f\u7528\u3057\u3066\u4eee\u60f3\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306b\u3001\u307e\u305a\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066Vagrantfile\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u5b9f\u884c\u3059\u308b\u3068\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306bVagrantfile\u304c\u4f5c\u6210\u3055\u308c\u308b\u306e\u3067\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u79fb\u52d5\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n$ vagrant init ubuntu/xenial64\n```\n\n\u6b21\u306b\u3001\u4f5c\u6210\u3057\u305fVagrantfile\u3092\u7de8\u96c6\u3067\u3059\u3002\n\u7de8\u96c6\u3059\u308b\u5185\u5bb9\u306f\n\n- `ubuntu/xenial64`\u306eBox\u3092\u4f7f\u7528\u3057\u3066\u3001Master\u3068Node\u3092\u7acb\u3061\u4e0a\u3052\u308b\n- Master\u3068Node\u9593\u3067\u901a\u4fe1\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3001private_network\u3092\u8a2d\u5b9a\u3059\u308b\n\n\u306e2\u70b9\u306b\u306a\u308a\u307e\u3059\u3002\n\n```shell:Vagrantfile\n # -*- mode: ruby -*-\n # vi: set ft=ruby :\n\n Vagrant.configure(2) do |config|\n   config.vm.box = \"ubuntu/xenial64\"\n\n   # Master\u306e\u8a2d\u5b9a\n   # \u56fa\u5b9aIP\u30a2\u30c9\u30ec\u30b9 192.168.33.10\u3092\u6307\u5b9a\n   config.vm.define :master do | master |\n     master.vm.hostname = \"master\"\n     master.vm.network :private_network, ip: \"192.168.33.10\"\n   end\n\n   # Node\u306e\u8a2d\u5b9a\n\u3000\u3000\u3000\u3000\u3000\u3000# \u56fa\u5b9aIP\u30a2\u30c9\u30ec\u30b9 192.168.33.11\u3092\u6307\u5b9a\n   config.vm.define :node1 do | node1 |\n     node1.vm.hostname = \"node1\"\n     node1.vm.network :private_network, ip: \"192.168.33.11\"\n   end\nend\n```\n\nVagrantfile\u306e\u7de8\u96c6\u304c\u7d42\u308f\u308c\u3070\u3001`vagrant up`\u3092\u5b9f\u884c\u3057\u3066\u4eee\u60f3\u74b0\u5883\u3092\u7acb\u3061\u4e0a\u3052\u307e\u3059\u3002\n\n# kubeadm\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4eee\u60f3\u74b0\u5883\u304c\u7acb\u3061\u4e0a\u304c\u3063\u305f\u3089\u3001\u307e\u305akubernet\u30af\u30e9\u30b9\u30bf\u3092\u69cb\u7bc9\u3059\u308b\u306e\u306b\u5fc5\u8981\u306a`kubeadm`\u3001\u304a\u3088\u3073\u305d\u306e\u4ed6\u306e\u5fc5\u9808\u30d1\u30c3\u30b1\u30fc\u30b8\u3092[\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](http://kubernetes.io/docs/getting-started-guides/kubeadm/)\u306b\u5f93\u3063\u3066Master\u3068Node\u306e\u4e21\u65b9\u5171\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n`vagrant ssh master`\u3001`vagrant ssh node1`\u3067\u4eee\u60f3\u74b0\u5883\u306b\u63a5\u7d9a\u3057\u3066root\u3067\u4f5c\u696d\u958b\u59cb\u3067\u3059\u3002\n\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u901a\u308a\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```shell\n# curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -\n# cat <<EOF > /etc/apt/sources.list.d/kubernetes.list\ndeb http://apt.kubernetes.io/ kubernetes-xenial main\nEOF\n# apt-get update\n# apt-get install -y docker.io kubelet kubeadm kubectl kubernetes-cni\n```\n\n# Master\u306e\u521d\u671f\u5316 - Node\u8ffd\u52a0\uff08\u30a8\u30e9\u30fc\u767a\u751f\u7b87\u6240\uff09\n\u554f\u984c\u304c\u3042\u3063\u305f\u306e\u306f\u3053\u3053\u3067\u3059\u3002\n\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u901a\u308a`kubeadm init`\u3092\u5b9f\u884c\u3059\u308b\u3068\u4e0b\u8a18\u306e\u3088\u3046\u306bNode\u5074\u3067\u5b9f\u884c\u3059\u308bjoin\u30b3\u30de\u30f3\u30c9\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\uff08\u30c8\u30fc\u30af\u30f3\u306e\u5024\u306f\u9069\u5f53\u306a\u3082\u306e\u306b\u7f6e\u304d\u63db\u3048\u3066\u307e\u3059\uff09\n\n```\nmaster# kubeadm init\n<master/tokens> generated token: \"123abc.123456789abcdefg\"\n<master/pki> created keys and certificates in \"/etc/kubernetes/pki\"\n<util/kubeconfig> created \"/etc/kubernetes/kubelet.conf\"\n<util/kubeconfig> created \"/etc/kubernetes/admin.conf\"\n<master/apiclient> created API client configuration\n<master/apiclient> created API client, waiting for the control plane to become ready\n<master/apiclient> all control plane components are healthy after 44.814120 seconds\n<master/apiclient> waiting for at least one node to register and become ready\n<master/apiclient> first node is ready after 4.230195 seconds\n<master/discovery> created essential addon: kube-discovery, waiting for it to become ready\n<master/discovery> kube-discovery is ready after 31.503093 seconds\n<master/addons> created essential addon: kube-proxy\n<master/addons> created essential addon: kube-dns\n\nKubernetes master initialised successfully!\n\nYou can now join any number of machines by running the following on each node:\n\nkubeadm join --token 123abc.123456789abcdefg 10.0.2.15\n```\n\n\u672c\u6765\u3067\u3042\u308c\u3070\u8868\u793a\u3055\u308c\u305f`join`\u30b3\u30de\u30f3\u30c9\u3092Node\u5074\u3067\u4f7f\u7528\u3059\u308c\u3070\u3001Node\u3092kubernetes\u30af\u30e9\u30b9\u30bf\u306b\u8ffd\u52a0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u3067\u3059\u304c\u3001\u5b9f\u884c\u3057\u3066\u307f\u305f\u3068\u3053\u308d\u4e0b\u8a18\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\n```\nnode1# kubeadm join --token 123abc.123456789abcdefg 10.0.2.15\n<util/tokens> validating provided token\n<node/discovery> created cluster info discovery client, requesting info from \"http://10.0.2.15:9898/cluster-info/v1/?token-id=629bfc\"\nerror: <node/discovery> failed to request cluster info [Get http://10.0.2.15:9898/cluster-info/v1/?token-id=123abc: dial tcp 10.0.2.15:9898: getsockopt: connection refused]\n```\n\n`join`\u30b3\u30de\u30f3\u30c9\u3067\u6307\u5b9a\u3057\u305f`10.0.2.15`\u306b\u63a5\u7d9a\u3067\u304d\u306a\u3044\u3068\u63a5\u7d9a\u3067\u304d\u306a\u3044\u3068\u6012\u3089\u308c\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\n\u3069\u3046\u3082`kubeadm`\u306f`join`\u30b3\u30de\u30f3\u30c9\u3092\u8868\u793a\u3059\u308b\u969b\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u3001\u81ea\u52d5\u3067\u691c\u51fa\u3057\u3066\u304f\u308c\u308b\u307f\u305f\u3044\u306a\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306e\u5834\u5408IP\u30a2\u30c9\u30ec\u30b9\u304c2\u3064\u3042\u308a\u3001Master\u3068Node\u9593\u3067\u901a\u4fe1\u3067\u304d\u308b\u3088\u3046\u306b\u6307\u5b9a\u3057\u305f\u56fa\u5b9aIP\u30a2\u30c9\u30ec\u30b9\u3092\u691c\u51fa\u3057\u3066\u3044\u306a\u304b\u3063\u305f\u70ba\u306b\u3001Node\u5074\u304b\u3089Master\u3078\u306e\u901a\u4fe1\u306b\u5931\u6557\u3057\u3066\u3044\u305f\u307f\u305f\u3044\u3067\u3059\u3002\n`10.0.2.15`\u306fVirtualBox\u306eNAT\u7528\u306eIP\u30a2\u30c9\u30ec\u30b9\u3067\u3057\u305f\u3002\nMaster\u5074\u306e`ifconfig`\u306e\u5b9f\u884c\u7d50\u679c\u306f\u4e0b\u8a18\u306b\u306a\u308a\u307e\u3059\u3002\n\n```\nmaster# ifconfig\ndocker0   Link encap:Ethernet  HWaddr 02:42:40:e4:03:c2\n          inet addr:172.17.0.1  Bcast:0.0.0.0  Mask:255.255.0.0\n          UP BROADCAST MULTICAST  MTU:1500  Metric:1\n          RX packets:0 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0\n          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)\n\nenp0s3    Link encap:Ethernet  HWaddr 02:3b:10:fe:82:8d\n          inet addr:10.0.2.15  Bcast:10.0.2.255  Mask:255.255.255.0\n          inet6 addr: fe80::3b:10ff:fefe:828d/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:255853 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:94600 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:366452042 (366.4 MB)  TX bytes:5874999 (5.8 MB)\n\nenp0s8    Link encap:Ethernet  HWaddr 08:00:27:65:8e:49\n          inet addr:192.168.33.10  Bcast:192.168.33.255  Mask:255.255.255.0\n          inet6 addr: fe80::a00:27ff:fe65:8e49/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:9 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:8 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000\n          RX bytes:828 (828.0 B)  TX bytes:648 (648.0 B)\n\nlo        Link encap:Local Loopback\n          inet addr:127.0.0.1  Mask:255.0.0.0\n          inet6 addr: ::1/128 Scope:Host\n          UP LOOPBACK RUNNING  MTU:65536  Metric:1\n          RX packets:66878 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:66878 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1\n          RX bytes:31873809 (31.8 MB)  TX bytes:31873809 (31.8 MB)\n```\n\n# \u89e3\u6c7a\u65b9\u6cd5\n\u3044\u308d\u3044\u308d\u8abf\u3079\u3066\u307f\u3068\u3053\u308d\u540c\u3058\u3088\u3046\u306a\u72b6\u6cc1\u306b\u306a\u3063\u3066\u3044\u308b\u4eba\u304c\u3044\u307e\u3057\u305f\u3002[kubernetes issue#33562](https://github.com/kubernetes/kubernetes/issues/33562)\u3002\n\u89e3\u6c7a\u65b9\u6cd5\u3068\u3057\u3066\u306f\u3001\u8907\u6570IP\u30a2\u30c9\u30ec\u30b9\u3092\u6301\u3063\u3066\u3044\u308b\u5834\u5408\u306f`kubeadm init`\u3092\u5b9f\u884c\u3059\u308b\u6642\u306b\u3001\u30aa\u30d7\u30b7\u30e7\u30f3\u306e`--api-advertise-addresses`\u3092\u4f7f\u7528\u3057\u3066IP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3057\u3066\u3042\u3052\u308c\u3070\u3044\u3044\u307f\u305f\u3044\u3067\u3059\u3002\n\n\u5ff5\u306e\u305f\u3081\u4eee\u60f3\u74b0\u5883\u3092\u3082\u3046\u4e00\u5ea6\u4f5c\u308a\u76f4\u3057\u3066\u304b\u3089\u3001`--api-advertise-addresses`\u3092\u4f7f\u7528\u3057\u3066\u518d\u5ea6`kubeadm init`\u3092\u5b9f\u884c\u3057\u3066\u307f\u308b\u3068\u3001\n\n```\nmaster# kubeadm init --api-advertise-addresses=192.168.33.10\n\u30fb\u30fb\u30fb\n\u30fb\u30fb\u30fb\nkubeadm join --token 123xyz.123456789abcdefg 192.168.33.10\u3000\n```\n\u6307\u5b9a\u3057\u305fIP\u30a2\u30c9\u30ec\u30b9\u304c\u8868\u793a\u3055\u308c\u307e\u3057\u305f!\n\n\u8868\u793a\u3055\u308c\u305f`join`\u30b3\u30de\u30f3\u30c9\u3092Node\u5074\u3067\u5b9f\u884c\u3057\u305f\u5834\u5408\u3082\u30a8\u30e9\u30fc\u3068\u306a\u3089\u305a\u306b\u6210\u529f\u3067\u3059\u3002\n\n```\nnode1# kubeadm join --token 123xyz.123456789abcdefg 192.168.33.10\n<util/tokens> validating provided token\n<node/discovery> created cluster info discovery client, requesting info from \"http://192.168.33.10:9898/cluster-info/v1/?token-id=123xyz\"\n<node/discovery> cluster info object received, verifying signature using given token\n<node/discovery> cluster info signature and contents are valid, will use API endpoints [https://192.168.33.10:443]\n<node/csr> created API client to obtain unique certificate for this node, generating keys and certificate signing request\n<node/csr> received signed certificate from the API server, generating kubelet configuration\n<util/kubeconfig> created \"/etc/kubernetes/kubelet.conf\"\n\nNode join complete:\n* Certificate signing request sent to master and response\n  received.\n* Kubelet informed of new secure connection details.\n\nRun 'kubectl get nodes' on the master to see this machine join.\n```\n\nMaster\u5074\u3067\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3068\u3001\u3061\u3083\u3093\u3068Node\u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n```\nmaster# kubectl get nodes\nNAME      STATUS    AGE\nmaster    Ready     3m\nnode1     Ready     18s\n```\n\n# \u672a\u89e3\u6c7a\u306e\u554f\u984c\n\u4e0a\u8a18\u30a8\u30e9\u30fc\u306f\u89e3\u6c7a\u3057\u307e\u3057\u305f\u304c\u3001\u3053\u306e\u74b0\u5883\u3067\u306f\u307e\u3060\u4e0b\u8a182\u70b9\u306e\u554f\u984c\u3092\u78ba\u8a8d\u3057\u3066\u3044\u307e\u3059\u3002\n\n- Master\u5074\u3067kube-dns\u306ePod\u304c\u8d77\u52d5\u3055\u308c\u306a\u3044\uff08STATUS\u304c\u300cContainerCreating\u300d\u304b\u3089\u9032\u307e\u306a\u3044\uff09\n- Pod\u9593\u901a\u4fe1\u306bWeave Net\u3092\u4f7f\u7528\u3057\u305f\u969b\u306b\u3001Weave Net\u306ePod\u306e1\u3064\u304c\u300cCrashLoopBackOff\u300d\u306b\u306a\u308b\n\n\u8a2d\u5b9a\u306e\u554f\u984c\u304b`kubeadm`\u306e\u554f\u984c\u306a\u306e\u304b\u306f\u8abf\u67fb\u4e2d\u3067\u3059\u304c\u3001GitHub\u3092\u898b\u308b\u3068VirtualBox\u306b\u95a2\u9023\u3057\u305f`kubeadm`\u306eissue\u304c\u3044\u304f\u3064\u304b\u3042\u3063\u305f\u306e\u3067\u3001`kubeadm`\u306e\u554f\u984c\u306e\u53ef\u80fd\u6027\u3082\u9ad8\u305d\u3046\u306a\u6c17\u304c\u3057\u307e\u3059\u3002\n\u307e\u3060`kubeadm`\u306falpha\u7248\u306a\u306e\u3067\u3001\u307e\u3060\u307e\u3060\u3053\u308c\u304b\u3089\u306b\u671f\u5f85\u3068\u3044\u3046\u3068\u3053\u308d\u3067\u3057\u3087\u3046\u304b\u3002\n", "tags": ["kubernetes"]}