{"context": " More than 1 year has passed since last update.\n\n1. \u3084\u308a\u305f\u3044\u3053\u3068\n\u4ee5\u524d\u306e\u6295\u7a3f\u3067docker-compose\u3092\u5229\u7528\u3057\u3066\u3001OpenZipkin\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u30b7\u30f3\u30b0\u30eb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u69cb\u7bc9\u3057\u307e\u3057\u305f\u3002\n\u3069\u3046\u3084\u3063\u3066\u3001\u3053\u3053\u306btrace\u5bfe\u8c61\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u60c5\u5831\u3092\u767b\u9332\u3057\u3066\u3044\u304f\u306e\u304b\u306a\u3001\u3068\u3044\u3046\u3068\u3053\u308d\u304c\u6c17\u306b\u306a\u3063\u305f\u306e\u3067\u3001Ruby\u306egem\u3092\u5229\u7528\u3057\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\nhttps://github.com/openzipkin/zipkin-tracer\n\n\n2. \u5229\u7528\u3057\u3066\u307f\u305f\u30ea\u30dd\u30b8\u30c8\u30ea\n\nhttps://github.com/letusfly85/sample-zipkin-rails\n\nzipkin tracer\u306eIP\u3092config/application.rb\u306b\u8a18\u8f09\u3057\u3066\u3044\u308b\u306e\u3067\u3001application.rb\u306f\u30b3\u30df\u30c3\u30c8\u3057\u3066\u3044\u306a\u3044\u3067\u3059\u3002\u30de\u30b9\u30ad\u30f3\u30b0\u3057\u3066\u5f8c\u8ff0\u3057\u307e\u3059\u3002\n\n3. \u5b9f\u65bd\u624b\u9806\n\n3-1. rails\u30a2\u30d7\u30ea\u3092\u4f5c\u6210\nrails new app\ncd app\n\n\n3-2. Gemfile\u3092\u7de8\u96c6\u3057\u3066bundle install\u3092\u5b9f\u884c\nvim Gemfile\nbundle install\n\nGemfile\u306b\u306f\u4ee5\u4e0b\u306e\uff12\u884c\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002\ngem 'zipkin-tracer'\ngem 'faraday', '~> 0.8'\n\n\n3-3. config/application.rb\u306bzipkin\u7528\u306b\u3001service_name, service_port, json_api_host\u3092\u767b\u9332\u3059\u308b\nservice_name\u306f\u3000[  hoge app  ]\u3000\u3068\u3057\u307e\u3057\u305f\u3002\nmodule App\n  class Application < Rails::Application\n    # Settings in config/environments/* take precedence over those specified here.\n    # Application configuration should go into files in config/initializers\n    # -- all .rb files in that directory are automatically loaded.\n\n    # Set Time.zone default to the specified zone and make Active Record auto-convert to this zone.\n    # Run \"rake -D time\" for a list of tasks for finding time zone names. Default is UTC.\n    # config.time_zone = 'Central Time (US & Canada)'\n\n    zipkin_tracer_config = {service_name: 'hoge app', service_port: 3000, sample_rate: 1, json_api_host: 'http://*.*.*.*:9411'}\n\n    config.middleware.use ZipkinTracer::RackHandler, zipkin_tracer_config\n\n\n    # The default locale is :en and all translations from config/locales/*.rb,yml are auto loaded.\n    # config.i18n.load_path += Dir[Rails.root.join('my', 'locales', '*.{rb,yml}').to_s]\n    # config.i18n.default_locale = :de\n\n    # Do not swallow errors in after_commit/after_rollback callbacks.\n    config.active_record.raise_in_transactional_callbacks = true\n  end\nend\n\n\u3053\u3053\u304c\u3061\u3087\u3063\u3068\u308f\u304b\u308a\u3065\u3089\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\njson_api_port\u306e9411\u306f\u3001zipkin docker-compose.yml \u306b\u3042\u308b\u3001zipkin-query\u304c\u63d0\u4f9b\u3057\u3066\u3044\u308b\u30b5\u30fc\u30d3\u30b9\u306e\u30dd\u30fc\u30c8\u306b\u306a\u308a\u307e\u3059\u3002\nquery:\n  image: openzipkin/zipkin-query:1.33.2\n  environment:\n    # Remove TRANSPORT_TYPE to disable tracing\n    - TRANSPORT_TYPE=http\n    - STORAGE_TYPE=cassandra\n  expose:\n    # The http api is mounted at /api/v1\n    - 9411\n    # Admin interface is under the http path /admin\n    # https://twitter.github.io/twitter-server/Features.html#http-admin-interface\n    - 9901\n  ports:\n    - 9411:9411\n    - 9901:9901\n  links:\n    - cassandra:storage\n\nservice_port\u306f\u3001trace\u5bfe\u8c61\u306e\u30b5\u30fc\u30d3\u30b9\u306e\u30dd\u30fc\u30c8\u306b\u306a\u308a\u307e\u3059\u3002\nrails s\u3067\u8d77\u52d5\u3055\u305b\u308b\u306e\u3067\u30013000\u3092\u6307\u5b9a\u3057\u307e\u3057\u305f\u3002\n\n3-4. rails s \u3067\u30c7\u30d0\u30c3\u30ae\u30f3\u30b0\u30e2\u30fc\u30c9\u3067rails\u30a2\u30d7\u30ea\u3092\u8d77\u52d5\u3059\u308b\nrails s\n\n\n3-5. \u30a6\u30a7\u30d6\u30d6\u30e9\u30a6\u30b6\u3067\u3001localhost:3000 \u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\nrails\u306e\u30a6\u30a7\u30eb\u30ab\u30e0\u30da\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n\n3-6. zipkin\u306e8080\u30dd\u30fc\u30c8\u306eWebUI\u3092\u898b\u3066\u307f\u308b\u3002\n\n[ hoge app ]\u304c\u767b\u9332\u3055\u308c\u307e\u3057\u305f\u3002\n\u3053\u3061\u3089\u3092\u9078\u629e\u3057\u3066\u3001Find Traces\u30dc\u30bf\u30f3\u3092\u62bc\u4e0b\u3057\u307e\u3059\u3002\n\n\u30ec\u30b3\u30fc\u30c9\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\u4e00\u3064\u3092\u9078\u629e\u3057\u3066\u8868\u793a\u3055\u305b\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u5b9f\u884c\u6642\u9593\u3082\u8868\u793a\u3055\u308c\u3066\u307e\u3059\u306d\uff01\n\n4. \u6240\u611f\n\nRails\u4ee5\u5916\u306eweb framework\u3067\u3082\u5229\u7528\u3067\u304d\u308b\u306e\u304b\u78ba\u8a8d\u3057\u3066\u307f\u305f\u3044\u3002play, akka\u3068\u3044\u3063\u305fscala\u7cfb\u306fGitHub\u306b\u30b5\u30f3\u30d7\u30eb\u7b49\u3042\u308a\u305d\u3046\u3060\u3063\u305f\u3002Golang\u306f\u3069\u3046\u3060\u308d\u3002go-kit\u3092\u4f7f\u3063\u305f\u30b5\u30f3\u30d7\u30eb\u304c\u3042\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u304b\u3089\u63a2\u3057\u3066\u307f\u308b\nhttp\u4ee5\u5916\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u3067\u63d0\u4f9b\u3057\u3066\u3044\u308b\u81ea\u524d\u30b5\u30fc\u30d3\u30b9\u306b\u5bfe\u3057\u3066Handler\u5b9f\u88c5\u3067\u304d\u308b\u306e\u304b\u306a\n\u8907\u6570\u30b5\u30fc\u30d3\u30b9\u304c\u8de8\u3063\u3066\u9023\u643a\u3057\u305f\u6642\u306etrace\u3063\u3066\u3069\u3046\u3084\u308b\u3093\u3060\u308d\u3046\u304b\nelixir\u306ephoenix\u3068\u304bdynamo\u3067\u3082\u4f7f\u3048\u306a\u3044\u306e\u304b\u3057\u3089\ncassandra\u306e\u5185\u90e8\u306e\u30c7\u30fc\u30bf\u69cb\u9020\u3069\u3046\u306a\u3063\u3066\u308b\u3093\u3060\u308d\n\n\u9762\u767d\u305d\u3046\u306a\u30cd\u30bf\u304c\u307e\u3060\u307e\u3060\u3042\u308a\u305d\u3046\u306a\u5370\u8c61\u3067\u3059\uff3e\uff3e\n\n\u672c\u65e5\u306f\u4ee5\u4e0a\u3068\u306a\u308a\u307e\u3059\u3002\n## 1. \u3084\u308a\u305f\u3044\u3053\u3068\n\n[\u4ee5\u524d\u306e\u6295\u7a3f](http://qiita.com/letusfly85/items/58fd4bb2d2f083d8d274)\u3067`docker-compose`\u3092\u5229\u7528\u3057\u3066\u3001OpenZipkin\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u30b7\u30f3\u30b0\u30eb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u69cb\u7bc9\u3057\u307e\u3057\u305f\u3002\n\n\u3069\u3046\u3084\u3063\u3066\u3001\u3053\u3053\u306btrace\u5bfe\u8c61\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u60c5\u5831\u3092\u767b\u9332\u3057\u3066\u3044\u304f\u306e\u304b\u306a\u3001\u3068\u3044\u3046\u3068\u3053\u308d\u304c\u6c17\u306b\u306a\u3063\u305f\u306e\u3067\u3001Ruby\u306egem\u3092\u5229\u7528\u3057\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\n* https://github.com/openzipkin/zipkin-tracer\n\n## 2. \u5229\u7528\u3057\u3066\u307f\u305f\u30ea\u30dd\u30b8\u30c8\u30ea\n\n* https://github.com/letusfly85/sample-zipkin-rails\n\nzipkin tracer\u306eIP\u3092`config/application.rb`\u306b\u8a18\u8f09\u3057\u3066\u3044\u308b\u306e\u3067\u3001`application.rb`\u306f\u30b3\u30df\u30c3\u30c8\u3057\u3066\u3044\u306a\u3044\u3067\u3059\u3002\u30de\u30b9\u30ad\u30f3\u30b0\u3057\u3066\u5f8c\u8ff0\u3057\u307e\u3059\u3002\n\n## 3. \u5b9f\u65bd\u624b\u9806\n\n### 3-1. rails\u30a2\u30d7\u30ea\u3092\u4f5c\u6210\n\n```bash\nrails new app\ncd app\n```\n\n### 3-2. Gemfile\u3092\u7de8\u96c6\u3057\u3066bundle install\u3092\u5b9f\u884c\n\n```bash\nvim Gemfile\nbundle install\n```\n\n`Gemfile`\u306b\u306f\u4ee5\u4e0b\u306e\uff12\u884c\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002\n\n```rb\ngem 'zipkin-tracer'\ngem 'faraday', '~> 0.8'\n```\n\n### 3-3. config/application.rb\u306bzipkin\u7528\u306b\u3001service_name, service_port, json_api_host\u3092\u767b\u9332\u3059\u308b\n\n`service_name`\u306f\u3000[  *hoge app*  ]\u3000\u3068\u3057\u307e\u3057\u305f\u3002\n\n```rb\nmodule App\n  class Application < Rails::Application\n    # Settings in config/environments/* take precedence over those specified here.\n    # Application configuration should go into files in config/initializers\n    # -- all .rb files in that directory are automatically loaded.\n\n    # Set Time.zone default to the specified zone and make Active Record auto-convert to this zone.\n    # Run \"rake -D time\" for a list of tasks for finding time zone names. Default is UTC.\n    # config.time_zone = 'Central Time (US & Canada)'\n\n    zipkin_tracer_config = {service_name: 'hoge app', service_port: 3000, sample_rate: 1, json_api_host: 'http://*.*.*.*:9411'}\n\n    config.middleware.use ZipkinTracer::RackHandler, zipkin_tracer_config\n\n\n    # The default locale is :en and all translations from config/locales/*.rb,yml are auto loaded.\n    # config.i18n.load_path += Dir[Rails.root.join('my', 'locales', '*.{rb,yml}').to_s]\n    # config.i18n.default_locale = :de\n\n    # Do not swallow errors in after_commit/after_rollback callbacks.\n    config.active_record.raise_in_transactional_callbacks = true\n  end\nend\n```\n\n\u3053\u3053\u304c\u3061\u3087\u3063\u3068\u308f\u304b\u308a\u3065\u3089\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\n\n`json_api_port`\u306e9411\u306f\u3001[zipkin docker-compose.yml](https://github.com/openzipkin/docker-zipkin/blob/master/docker-compose.yml) \u306b\u3042\u308b\u3001`zipkin-query`\u304c\u63d0\u4f9b\u3057\u3066\u3044\u308b\u30b5\u30fc\u30d3\u30b9\u306e\u30dd\u30fc\u30c8\u306b\u306a\u308a\u307e\u3059\u3002\n\n```yaml\nquery:\n  image: openzipkin/zipkin-query:1.33.2\n  environment:\n    # Remove TRANSPORT_TYPE to disable tracing\n    - TRANSPORT_TYPE=http\n    - STORAGE_TYPE=cassandra\n  expose:\n    # The http api is mounted at /api/v1\n    - 9411\n    # Admin interface is under the http path /admin\n    # https://twitter.github.io/twitter-server/Features.html#http-admin-interface\n    - 9901\n  ports:\n    - 9411:9411\n    - 9901:9901\n  links:\n    - cassandra:storage\n```\n\n`service_port`\u306f\u3001trace\u5bfe\u8c61\u306e\u30b5\u30fc\u30d3\u30b9\u306e\u30dd\u30fc\u30c8\u306b\u306a\u308a\u307e\u3059\u3002\n`rails s`\u3067\u8d77\u52d5\u3055\u305b\u308b\u306e\u3067\u30013000\u3092\u6307\u5b9a\u3057\u307e\u3057\u305f\u3002\n\n## 3-4. rails s \u3067\u30c7\u30d0\u30c3\u30ae\u30f3\u30b0\u30e2\u30fc\u30c9\u3067rails\u30a2\u30d7\u30ea\u3092\u8d77\u52d5\u3059\u308b\n\n```bash\nrails s\n```\n\n## 3-5. \u30a6\u30a7\u30d6\u30d6\u30e9\u30a6\u30b6\u3067\u3001localhost:3000 \u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\n\nrails\u306e\u30a6\u30a7\u30eb\u30ab\u30e0\u30da\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-03-09 10.58.50.png](https://qiita-image-store.s3.amazonaws.com/0/49547/6006cb41-3017-39f5-6c2d-05199c6f935e.png)\n\n## 3-6. zipkin\u306e8080\u30dd\u30fc\u30c8\u306eWebUI\u3092\u898b\u3066\u307f\u308b\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-03-09 11.01.24.png](https://qiita-image-store.s3.amazonaws.com/0/49547/eaf85cff-fd7c-2cf0-fa05-393130ce9e76.png)\n\n[ *hoge app* ]\u304c\u767b\u9332\u3055\u308c\u307e\u3057\u305f\u3002\n\u3053\u3061\u3089\u3092\u9078\u629e\u3057\u3066\u3001Find Traces\u30dc\u30bf\u30f3\u3092\u62bc\u4e0b\u3057\u307e\u3059\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-03-09 11.02.20.png](https://qiita-image-store.s3.amazonaws.com/0/49547/596f814e-7f45-56d9-c35e-014ee797a09f.png)\n\n\u30ec\u30b3\u30fc\u30c9\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\u4e00\u3064\u3092\u9078\u629e\u3057\u3066\u8868\u793a\u3055\u305b\u3066\u307f\u307e\u3057\u305f\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-03-09 11.02.59.png](https://qiita-image-store.s3.amazonaws.com/0/49547/9314b7ce-0b53-76fb-6f55-c6a18bb13657.png)\n\n\u5b9f\u884c\u6642\u9593\u3082\u8868\u793a\u3055\u308c\u3066\u307e\u3059\u306d\uff01\n\n## 4. \u6240\u611f\n\n* Rails\u4ee5\u5916\u306eweb framework\u3067\u3082\u5229\u7528\u3067\u304d\u308b\u306e\u304b\u78ba\u8a8d\u3057\u3066\u307f\u305f\u3044\u3002play, akka\u3068\u3044\u3063\u305fscala\u7cfb\u306fGitHub\u306b\u30b5\u30f3\u30d7\u30eb\u7b49\u3042\u308a\u305d\u3046\u3060\u3063\u305f\u3002Golang\u306f\u3069\u3046\u3060\u308d\u3002go-kit\u3092\u4f7f\u3063\u305f\u30b5\u30f3\u30d7\u30eb\u304c\u3042\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u304b\u3089\u63a2\u3057\u3066\u307f\u308b\n* http\u4ee5\u5916\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u3067\u63d0\u4f9b\u3057\u3066\u3044\u308b\u81ea\u524d\u30b5\u30fc\u30d3\u30b9\u306b\u5bfe\u3057\u3066Handler\u5b9f\u88c5\u3067\u304d\u308b\u306e\u304b\u306a\n* \u8907\u6570\u30b5\u30fc\u30d3\u30b9\u304c\u8de8\u3063\u3066\u9023\u643a\u3057\u305f\u6642\u306etrace\u3063\u3066\u3069\u3046\u3084\u308b\u3093\u3060\u308d\u3046\u304b\n* elixir\u306ephoenix\u3068\u304bdynamo\u3067\u3082\u4f7f\u3048\u306a\u3044\u306e\u304b\u3057\u3089\n* cassandra\u306e\u5185\u90e8\u306e\u30c7\u30fc\u30bf\u69cb\u9020\u3069\u3046\u306a\u3063\u3066\u308b\u3093\u3060\u308d\n\n\u9762\u767d\u305d\u3046\u306a\u30cd\u30bf\u304c\u307e\u3060\u307e\u3060\u3042\u308a\u305d\u3046\u306a\u5370\u8c61\u3067\u3059\uff3e\uff3e\n\n---\n\n\u672c\u65e5\u306f\u4ee5\u4e0a\u3068\u306a\u308a\u307e\u3059\u3002\n", "tags": ["Rails", "OpenZipkin", "microservices", "Scala", "docker"]}