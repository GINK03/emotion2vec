{"context": " More than 1 year has passed since last update.\namesh.rb\nrequire 'open-uri'\nrequire 'RMagick'\ninclude Magick\n\n# \u73fe\u5728\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u306a\u96e8\u91cf\u753b\u50cf\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u4e00\u89a7\u3092\u542b\u3080js\u3092\u53d6\u5f97 \u73fe\u5728\u6642\u523b\u304b\u3089\u8a08\u7b97\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3063\u307d\u3044\ntimes_url = \"http://tokyo-ame.jwa.or.jp/scripts/mesh_index.js\"\ntimes_js = open(times_url).read()\ntimes = times_js.sub(\"Amesh.setIndexList([\", \"\").sub(\");\", \"\").chomp!.chomp!.split(\",\").map!{|t| t[1..-2].to_i}\n\n# \u3067\u304b\u3044\u307b\u3046\u306egif\u753b\u50cf\u6700\u65b0\u4e00\u4ef6\u3092\u53d6\u5f97 /100/\u3058\u3083\u306a\u304f\u3066/000/\u306b\u3059\u308b\u3068\u5c0f\u3055\u304f\u306a\u308b\ngif_url = \"http://tokyo-ame.jwa.or.jp/mesh/100/#{times[0]}.gif\"\namesh_gif = open(gif_url).read()\namesh_magick = Magick::Image.from_blob(amesh_gif).first\n\n# \u8272\u3068\u96e8\u91cf\u306e\u5bfe\u5fdc\u95a2\u4fc2\ncolor_precipitation_map = {\n  Magick::Pixel.new(0, 0, 0, 0)             => 0,\n  Magick::Pixel.new(0, 0, 257, 65535)       => 0,\n  Magick::Pixel.new(52428, 65535, 65535, 0) => 3,\n  Magick::Pixel.new(26214, 39321, 65535, 0) => 10,\n  Magick::Pixel.new(13107, 13107, 65535, 0) => 20,\n  Magick::Pixel.new(0, 65535, 0, 0)         => 30,\n  Magick::Pixel.new(65535, 65535, 0, 0)     => 40,\n  Magick::Pixel.new(65535, 39321, 0, 0)     => 50,\n  Magick::Pixel.new(65535, 0, 65535, 0)     => 80,\n  Magick::Pixel.new(65535, 0, 0, 0)         => 100,\n}\n# \u3053\u3053\u3067\u5fc5\u8981\u3060\u3063\u305f\u3089 magick_image.corp(x, y, w, h) \u306a\u3069\u3067\u5207\u308a\u629c\u304f\ntarget_area = amesh_magick\n# \u5207\u308a\u51fa\u3057\u9818\u57df\u306e\u30d4\u30af\u30bb\u30eb\u5168\u90e8\u3067\u3001\u8272\u304b\u3089\u96e8\u91cf\u3078\u306e\u63db\u7b97\u3092\u3059\u308b\ntarget_area.each_pixel do |px, col, row|\n  precipitation = color_precipitation_map.fetch(px, -1)\n  case precipitation\n  when 0\n  when 1..100\n    # \u96e8\u304c\u89b3\u6e2c\u3055\u308c\u3066\u3044\u308b\u5730\u57df\u306e\u96e8\u91cf\u3068\u753b\u50cf\u5185\u306e\u5ea7\u6a19\n    p [precipitation, col, row]\n  when -1\n    # \u672a\u77e5\u306e\u8272\u304c\u4f7f\u308f\u308c\u59cb\u3081\u305f?\n    p [px.to_color, px, col, row]\n  end\nend\n\n\n```ruby:amesh.rb\nrequire 'open-uri'\nrequire 'RMagick'\ninclude Magick\n\n# \u73fe\u5728\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u306a\u96e8\u91cf\u753b\u50cf\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u4e00\u89a7\u3092\u542b\u3080js\u3092\u53d6\u5f97 \u73fe\u5728\u6642\u523b\u304b\u3089\u8a08\u7b97\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3063\u307d\u3044\ntimes_url = \"http://tokyo-ame.jwa.or.jp/scripts/mesh_index.js\"\ntimes_js = open(times_url).read()\ntimes = times_js.sub(\"Amesh.setIndexList([\", \"\").sub(\");\", \"\").chomp!.chomp!.split(\",\").map!{|t| t[1..-2].to_i}\n\n# \u3067\u304b\u3044\u307b\u3046\u306egif\u753b\u50cf\u6700\u65b0\u4e00\u4ef6\u3092\u53d6\u5f97 /100/\u3058\u3083\u306a\u304f\u3066/000/\u306b\u3059\u308b\u3068\u5c0f\u3055\u304f\u306a\u308b\ngif_url = \"http://tokyo-ame.jwa.or.jp/mesh/100/#{times[0]}.gif\"\namesh_gif = open(gif_url).read()\namesh_magick = Magick::Image.from_blob(amesh_gif).first\n\n# \u8272\u3068\u96e8\u91cf\u306e\u5bfe\u5fdc\u95a2\u4fc2\ncolor_precipitation_map = {\n  Magick::Pixel.new(0, 0, 0, 0)             => 0,\n  Magick::Pixel.new(0, 0, 257, 65535)       => 0,\n  Magick::Pixel.new(52428, 65535, 65535, 0) => 3,\n  Magick::Pixel.new(26214, 39321, 65535, 0) => 10,\n  Magick::Pixel.new(13107, 13107, 65535, 0) => 20,\n  Magick::Pixel.new(0, 65535, 0, 0)         => 30,\n  Magick::Pixel.new(65535, 65535, 0, 0)     => 40,\n  Magick::Pixel.new(65535, 39321, 0, 0)     => 50,\n  Magick::Pixel.new(65535, 0, 65535, 0)     => 80,\n  Magick::Pixel.new(65535, 0, 0, 0)         => 100,\n}\n# \u3053\u3053\u3067\u5fc5\u8981\u3060\u3063\u305f\u3089 magick_image.corp(x, y, w, h) \u306a\u3069\u3067\u5207\u308a\u629c\u304f\ntarget_area = amesh_magick\n# \u5207\u308a\u51fa\u3057\u9818\u57df\u306e\u30d4\u30af\u30bb\u30eb\u5168\u90e8\u3067\u3001\u8272\u304b\u3089\u96e8\u91cf\u3078\u306e\u63db\u7b97\u3092\u3059\u308b\ntarget_area.each_pixel do |px, col, row|\n  precipitation = color_precipitation_map.fetch(px, -1)\n  case precipitation\n  when 0\n  when 1..100\n    # \u96e8\u304c\u89b3\u6e2c\u3055\u308c\u3066\u3044\u308b\u5730\u57df\u306e\u96e8\u91cf\u3068\u753b\u50cf\u5185\u306e\u5ea7\u6a19\n    p [precipitation, col, row]\n  when -1\n    # \u672a\u77e5\u306e\u8272\u304c\u4f7f\u308f\u308c\u59cb\u3081\u305f?\n    p [px.to_color, px, col, row]\n  end\nend\n```", "tags": ["Ruby", "RMagick", "ImageMagick"]}