{"tags": ["docker", "docker-compose", "redash", "oracle"], "context": "Oracle \u3060\u3089\u3051\u306e\u74b0\u5883\u306e\u7686\u3055\u3093\u3078\n\nDocker Compose Install\n\u203b docker \u306fInstall\u6e08\u307f\n$ uname -r\n3.10.0-327.el7.x86_64\n$ sudo curl -L \"https://github.com/docker/compose/releases/download/1.9.0/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\n$ sudo chmod +x /usr/local/bin/docker-compose\n$ sudo curl -L https://raw.githubusercontent.com/docker/compose/$(docker-compose version --short)/contrib/completion/bash/docker-compose -o /etc/bash_completion.d/docker-compose\n$ docker-compose --version\ndocker-compose version 1.9.0, build 2585387\n$ sudo usermod -aG docker ${USER}\n# \u30b3\u30f3\u30bd\u30fc\u30eb\u518d\u8d77\u52d5\n\n\nRedash Install\n$ git clone https://github.com/getredash/redash\n$ cd redash\n$ mkdir oracle\n# Oracle Instance Download\n# Oracle \u3067\u30ed\u30b0\u30a4\u30f3\u3057\u305fCookie\u3092\u6301\u3063\u3066\u304f\u308b\n$ curl --location --cookie ./cookies.txt --insecure \"http://download.oracle.com/otn/linux/instantclient/11204/instantclient-basic-linux.x64-11.2.0.4.0.zip\" -o instantclient-basic-linux.x64-11.2.0.4.0.zip\n$ curl --location --cookie ./cookies.txt --insecure \"http://download.oracle.com/otn/linux/instantclient/11204/instantclient-jdbc-linux.x64-11.2.0.4.0.zip\" -o instantclient-jdbc-linux.x64-11.2.0.4.0.zip\n$ curl --location --cookie ./cookies.txt --insecure \"http://download.oracle.com/otn/linux/instantclient/11204/instantclient-sqlplus-linux.x64-11.2.0.4.0.zip\" -o instantclient-sqlplus-linux.x64-11.2.0.4.0.zip\n$ curl --location --cookie ./cookies.txt --insecure \"http://download.oracle.com/otn/linux/instantclient/11204/instantclient-sdk-linux.x64-11.2.0.4.0.zip\" -o instantclient-sdk-linux.x64-11.2.0.4.0.zip\n$ curl --location --cookie ./cookies.txt --insecure \"http://download.oracle.com/otn/linux/instantclient/11204/instantclient-odbc-linux.x64-11.2.0.4.0.zip\" -o instantclient-odbc-linux.x64-11.2.0.4.0.zip\n$ cd ../\n$ vi Dockerfile-redash\n\n\nDockerfile-redash\nFROM redash/redash:latest\n\n# Oracle instantclient\nADD oracle/instantclient-basic-linux.x64-11.2.0.4.0.zip /tmp/instantclient-basic-linux.x64-11.2.0.4.0.zip\nADD oracle/instantclient-sdk-linux.x64-11.2.0.4.0.zip /tmp/instantclient-sdk-linux.x64-11.2.0.4.0.zip\nADD oracle/instantclient-sqlplus-linux.x64-11.2.0.4.0.zip /tmp/instantclient-sqlplus-linux.x64-11.2.0.4.0.zip\nADD oracle/instantclient-odbc-linux.x64-11.2.0.4.0.zip /tmp/instantclient-odbc-linux.x64-11.2.0.4.0.zip\nADD oracle/instantclient-jdbc-linux.x64-11.2.0.4.0.zip /tmp/instantclient-jdbc-linux.x64-11.2.0.4.0.zip\nADD oracle/tnsnames.ora /tmp/tnsnames.ora\n\nRUN mkdir -p /opt/oracle/\nRUN apt-get update  -y\nRUN apt-get install -y unzip\n\nRUN unzip /tmp/instantclient-basic-linux.x64-11.2.0.4.0.zip -d /opt/oracle/\nRUN unzip /tmp/instantclient-sdk-linux.x64-11.2.0.4.0.zip -d /opt/oracle/\nRUN unzip /tmp/instantclient-sqlplus-linux.x64-11.2.0.4.0.zip -d /opt/oracle/\nRUN unzip /tmp/instantclient-odbc-linux.x64-11.2.0.4.0.zip -d /opt/oracle/\nRUN unzip /tmp/instantclient-jdbc-linux.x64-11.2.0.4.0.zip -d /opt/oracle/\n\nRUN ln -s /opt/oracle/instantclient_11_2 /opt/oracle/instantclient\nRUN ln -s /opt/oracle/instantclient/libclntsh.so.11.1 /opt/oracle/instantclient/libclntsh.so\nRUN ln -s /opt/oracle/instantclient/sqlplus /usr/local/bin/sqlplus\n\nRUN apt-get install libaio-dev -y\nRUN apt-get clean -y\n\nENV ORACLE_HOME=/opt/oracle/instantclient\nENV LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/opt/oracle/instantclient\nENV TNS_ADMIN=$ORACLE_HOME/network/admin\nRUN mkdir -p /opt/oracle/instantclient/network/admin\nRUN cp /tmp/tnsnames.ora /opt/oracle/instantclient/network/admin/\n\nRUN pip install cx_Oracle\n\n#Add REDASH ENV to add Oracle Query Runner\nENV REDASH_ADDITIONAL_QUERY_RUNNERS=redash.query_runner.oracle\n\n\n$ cp docker-compose-example.yml docker-compose.yml\n$ vi docker-compose.yml\n\n\ndocker-compose.yml\nredash:\n#  image: redash/redash:latest\n  build: .\n  dockerfile: Dockerfile-redash\n  ports:\n    - \"5000:5000\"\n    - \"1555:1555\" # Oracle\u7528\u30dd\u30fc\u30c8\u8ffd\u52a0\n  links:\n    - redis\n    - postgres\n  environment:\n    REDASH_LOG_LEVEL: \"INFO\"\n    REDASH_REDIS_URL: \"redis://redis:6379/0\"\n    REDASH_DATABASE_URL: \"postgresql://postgres@postgres/postgres\"\n    REDASH_COOKIE_SECRET: veryverysecret\nredis:\n  image: redis:2.8\npostgres:\n  image: postgres:9.3\n  volumes:\n    - /opt/postgres-data:/var/lib/postgresql/data\nredash-nginx:\n  image: redash/nginx:latest\n  ports:\n    - \"80:80\"\n  links:\n    - redash\n\n\n\n$ docker-compose up postgres\n# Ctrl+C\n$ ./setup/docker/create_database.sh\n$ docker-compose up -d\n\n\u826f\u304d Redash Life \u3092\nOracle \u3060\u3089\u3051\u306e\u74b0\u5883\u306e\u7686\u3055\u3093\u3078\n\n# Docker Compose Install\n\n\u203b docker \u306fInstall\u6e08\u307f\n\n```bash\n$ uname -r\n3.10.0-327.el7.x86_64\n$ sudo curl -L \"https://github.com/docker/compose/releases/download/1.9.0/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\n$ sudo chmod +x /usr/local/bin/docker-compose\n$ sudo curl -L https://raw.githubusercontent.com/docker/compose/$(docker-compose version --short)/contrib/completion/bash/docker-compose -o /etc/bash_completion.d/docker-compose\n$ docker-compose --version\ndocker-compose version 1.9.0, build 2585387\n$ sudo usermod -aG docker ${USER}\n# \u30b3\u30f3\u30bd\u30fc\u30eb\u518d\u8d77\u52d5\n```\n\n# Redash Install\n\n```bash \n$ git clone https://github.com/getredash/redash\n$ cd redash\n$ mkdir oracle\n# Oracle Instance Download\n# Oracle \u3067\u30ed\u30b0\u30a4\u30f3\u3057\u305fCookie\u3092\u6301\u3063\u3066\u304f\u308b\n$ curl --location --cookie ./cookies.txt --insecure \"http://download.oracle.com/otn/linux/instantclient/11204/instantclient-basic-linux.x64-11.2.0.4.0.zip\" -o instantclient-basic-linux.x64-11.2.0.4.0.zip\n$ curl --location --cookie ./cookies.txt --insecure \"http://download.oracle.com/otn/linux/instantclient/11204/instantclient-jdbc-linux.x64-11.2.0.4.0.zip\" -o instantclient-jdbc-linux.x64-11.2.0.4.0.zip\n$ curl --location --cookie ./cookies.txt --insecure \"http://download.oracle.com/otn/linux/instantclient/11204/instantclient-sqlplus-linux.x64-11.2.0.4.0.zip\" -o instantclient-sqlplus-linux.x64-11.2.0.4.0.zip\n$ curl --location --cookie ./cookies.txt --insecure \"http://download.oracle.com/otn/linux/instantclient/11204/instantclient-sdk-linux.x64-11.2.0.4.0.zip\" -o instantclient-sdk-linux.x64-11.2.0.4.0.zip\n$ curl --location --cookie ./cookies.txt --insecure \"http://download.oracle.com/otn/linux/instantclient/11204/instantclient-odbc-linux.x64-11.2.0.4.0.zip\" -o instantclient-odbc-linux.x64-11.2.0.4.0.zip\n$ cd ../\n$ vi Dockerfile-redash\n```\n\n```dockerfile:Dockerfile-redash\nFROM redash/redash:latest\n\n# Oracle instantclient\nADD oracle/instantclient-basic-linux.x64-11.2.0.4.0.zip /tmp/instantclient-basic-linux.x64-11.2.0.4.0.zip\nADD oracle/instantclient-sdk-linux.x64-11.2.0.4.0.zip /tmp/instantclient-sdk-linux.x64-11.2.0.4.0.zip\nADD oracle/instantclient-sqlplus-linux.x64-11.2.0.4.0.zip /tmp/instantclient-sqlplus-linux.x64-11.2.0.4.0.zip\nADD oracle/instantclient-odbc-linux.x64-11.2.0.4.0.zip /tmp/instantclient-odbc-linux.x64-11.2.0.4.0.zip\nADD oracle/instantclient-jdbc-linux.x64-11.2.0.4.0.zip /tmp/instantclient-jdbc-linux.x64-11.2.0.4.0.zip\nADD oracle/tnsnames.ora /tmp/tnsnames.ora\n\nRUN mkdir -p /opt/oracle/\nRUN apt-get update  -y\nRUN apt-get install -y unzip\n\nRUN unzip /tmp/instantclient-basic-linux.x64-11.2.0.4.0.zip -d /opt/oracle/\nRUN unzip /tmp/instantclient-sdk-linux.x64-11.2.0.4.0.zip -d /opt/oracle/\nRUN unzip /tmp/instantclient-sqlplus-linux.x64-11.2.0.4.0.zip -d /opt/oracle/\nRUN unzip /tmp/instantclient-odbc-linux.x64-11.2.0.4.0.zip -d /opt/oracle/\nRUN unzip /tmp/instantclient-jdbc-linux.x64-11.2.0.4.0.zip -d /opt/oracle/\n\nRUN ln -s /opt/oracle/instantclient_11_2 /opt/oracle/instantclient\nRUN ln -s /opt/oracle/instantclient/libclntsh.so.11.1 /opt/oracle/instantclient/libclntsh.so\nRUN ln -s /opt/oracle/instantclient/sqlplus /usr/local/bin/sqlplus\n\nRUN apt-get install libaio-dev -y\nRUN apt-get clean -y\n\nENV ORACLE_HOME=/opt/oracle/instantclient\nENV LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/opt/oracle/instantclient\nENV TNS_ADMIN=$ORACLE_HOME/network/admin\nRUN mkdir -p /opt/oracle/instantclient/network/admin\nRUN cp /tmp/tnsnames.ora /opt/oracle/instantclient/network/admin/\n\nRUN pip install cx_Oracle\n\n#Add REDASH ENV to add Oracle Query Runner\nENV REDASH_ADDITIONAL_QUERY_RUNNERS=redash.query_runner.oracle\n```\n\n```bash \n$ cp docker-compose-example.yml docker-compose.yml\n$ vi docker-compose.yml\n```\n\n```yaml:docker-compose.yml\nredash:\n#  image: redash/redash:latest\n  build: .\n  dockerfile: Dockerfile-redash\n  ports:\n    - \"5000:5000\"\n    - \"1555:1555\" # Oracle\u7528\u30dd\u30fc\u30c8\u8ffd\u52a0\n  links:\n    - redis\n    - postgres\n  environment:\n    REDASH_LOG_LEVEL: \"INFO\"\n    REDASH_REDIS_URL: \"redis://redis:6379/0\"\n    REDASH_DATABASE_URL: \"postgresql://postgres@postgres/postgres\"\n    REDASH_COOKIE_SECRET: veryverysecret\nredis:\n  image: redis:2.8\npostgres:\n  image: postgres:9.3\n  volumes:\n    - /opt/postgres-data:/var/lib/postgresql/data\nredash-nginx:\n  image: redash/nginx:latest\n  ports:\n    - \"80:80\"\n  links:\n    - redash\n\n```\n\n```bash\n$ docker-compose up postgres\n# Ctrl+C\n$ ./setup/docker/create_database.sh\n$ docker-compose up -d\n```\n\n\n\u826f\u304d Redash Life \u3092\n"}