{"context": "\n\n\u6982\u8981\nSpringSecurity\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u3001Spring\u306eMockMvc\u3092\u4f7f\u3063\u3066Controller\u306e\u30c6\u30b9\u30c8\u3092\u66f8\u304f \u3068\u3001\nPost\u30ea\u30af\u30a8\u30b9\u30c8\u306fCSRF Token\u304c\u306a\u3044\u3068403\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u305d\u306e\u5bfe\u5fdc\u3002\n\n\u30c6\u30b9\u30c8\u5bfe\u8c61\u30e1\u30bd\u30c3\u30c9\n@PostMapping(value = \"hoge\", consumes = MediaType.APPLICATION_JSON_VALUE)\npublic void hoge(@RequestBody Hoge hoge) {\n    System.out.println(\"hoge\");\n}\n\n\nspring-security-test \u3092\u4f9d\u5b58\u306b\u8ffd\u52a0\n\u4e0b\u8a18\u306fMaven\u306e\u5834\u5408\u3002\npom.xml\u306b\u8ffd\u52a0\u3059\u308b\u3002\n<dependency>\n    <groupId>org.springframework.security</groupId>\n    <artifactId>spring-security-test</artifactId>\n    <version>4.0.0.RELEASE</version>\n</dependency>\n\n\nSecurityMockMvcRequestPostProcessors\u3092\u4f7f\u3046\n\u4e0b\u8a18\u306fSpock\u3067\u306e\u4f8b\u3002\ndef \"CSRF\u30c8\u30fc\u30af\u30f3\u3092\u4f7f\u3063\u305fPost\u30ea\u30af\u30a8\u30b9\u30c8\"() {\n    setup:\n    ObjectMapper mapper = new ObjectMapper();\n    String json = mapper.writeValueAsString(new Hoge());\n\n    expect:\n    mockMvc.perform(MockMvcRequestBuilders\n        .post('/hoge')\n        .contentType(MediaType.APPLICATION_JSON)\n        .content(json)\n        // CSRF\u30c8\u30fc\u30af\u30f3\u3092\u30bb\u30c3\u30c8\n        .with(SecurityMockMvcRequestPostProcessors.csrf())\n    ).andExpect(\n        MockMvcResultMatchers.status().is(HttpStatus.OK.value()),\n    )\n}\n\n\n\u53c2\u8003\n\nWhy I received an Error 403 with MockMvc and JUnit?\nPreview Spring Security Test: Web Security\n\n# \u6982\u8981\n\nSpringSecurity\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u3001Spring\u306eMockMvc\u3092\u4f7f\u3063\u3066Controller\u306e\u30c6\u30b9\u30c8\u3092\u66f8\u304f \u3068\u3001\nPost\u30ea\u30af\u30a8\u30b9\u30c8\u306fCSRF Token\u304c\u306a\u3044\u3068403\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u305d\u306e\u5bfe\u5fdc\u3002\n\n## \u30c6\u30b9\u30c8\u5bfe\u8c61\u30e1\u30bd\u30c3\u30c9\n\n```java\n@PostMapping(value = \"hoge\", consumes = MediaType.APPLICATION_JSON_VALUE)\npublic void hoge(@RequestBody Hoge hoge) {\n    System.out.println(\"hoge\");\n}\n```\n\n## `spring-security-test` \u3092\u4f9d\u5b58\u306b\u8ffd\u52a0\n\n\u4e0b\u8a18\u306fMaven\u306e\u5834\u5408\u3002\npom.xml\u306b\u8ffd\u52a0\u3059\u308b\u3002\n\n```xml\n<dependency>\n    <groupId>org.springframework.security</groupId>\n    <artifactId>spring-security-test</artifactId>\n    <version>4.0.0.RELEASE</version>\n</dependency>\n```\n\n## `SecurityMockMvcRequestPostProcessors`\u3092\u4f7f\u3046\n\n\u4e0b\u8a18\u306fSpock\u3067\u306e\u4f8b\u3002\n\n```groovy\ndef \"CSRF\u30c8\u30fc\u30af\u30f3\u3092\u4f7f\u3063\u305fPost\u30ea\u30af\u30a8\u30b9\u30c8\"() {\n    setup:\n    ObjectMapper mapper = new ObjectMapper();\n    String json = mapper.writeValueAsString(new Hoge());\n\n    expect:\n    mockMvc.perform(MockMvcRequestBuilders\n        .post('/hoge')\n        .contentType(MediaType.APPLICATION_JSON)\n        .content(json)\n        // CSRF\u30c8\u30fc\u30af\u30f3\u3092\u30bb\u30c3\u30c8\n        .with(SecurityMockMvcRequestPostProcessors.csrf())\n    ).andExpect(\n        MockMvcResultMatchers.status().is(HttpStatus.OK.value()),\n    )\n}\n```\n\n## \u53c2\u8003\n\n- [Why I received an Error 403 with MockMvc and JUnit?](http://stackoverflow.com/questions/21749781/why-i-received-an-error-403-with-mockmvc-and-junit)\n- [Preview Spring Security Test: Web Security](https://spring.io/blog/2014/05/23/preview-spring-security-test-web-security)\n", "tags": ["spring", "spring-boot", "Java", "unittest"]}