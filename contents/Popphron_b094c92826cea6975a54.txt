{"context": " More than 1 year has passed since last update.\u5b8c\u5168\u52dd\u5229\u3002\n\n\u52a9\u3051\u3066\u3044\u305f\u3060\u3044\u305f\u8a18\u4e8b\nPHP\u306e\u95a2\u6570unserialize\u3067\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\u5834\u5408\u306e\u5bfe\u51e6\u65b9\u6cd5 | cms helog - CMS\u69cb\u7bc9\u3092\u76ee\u7684\u306bPHP\u3092\u30d9\u30fc\u30b9\u3068\u3057\u305fWordPress\u3001CakePHP\u3084PEAR\u306a\u3069\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u3092\u4e2d\u5fc3\u306b\u89e3\u8aac\u3057\u3066\u3044\u307e\u3059\n\n\u7d50\u8ad6\nhtml_entity_decode()\u3092\u3057\u3088\u3046\u3002\n\n/**\n * \u6587\u5b57\u30b3\u30fc\u30c9\u30a8\u30e9\u30fc\u304c\u51fa\u306a\u3044\u3088\u3046\u306bunserialize\u3059\u308b\n * @param $string unserialize\u3057\u305f\u3044\u6587\u5b57\u5217\n * @return mixed\n */\nfunction safe_unserialize($string)\n{\n    return unserialize(html_entity_decode($string, ENT_QUOTES));\n}\n\n/**\n * users\u30c6\u30fc\u30d6\u30eb\u304b\u3089\u53d6\u5f97\u3057\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eprofile_fields\u306b\u3042\u308b\u7279\u5b9a\u60c5\u5831\u3092\u8fd4\u3059\n * @param $user Model_User::find()\u306e\u8fd4\u308a\u5024\n * @param $field profile_fields\u306e\u4e2d\u304b\u3089\u6b32\u3057\u3044\u60c5\u5831\n * @return array|mixed\n */\nfunction get_field_from_user($user, $field)\n{\n    if (isset($user['profile_fields']))\n    {\n        is_array($user['profile_fields']) or $user['profile_fields'] = (@safe_unserialize($user['profile_fields']) ?: array());\n    }\n    else\n    {\n        $user['profile_fields'] = array();\n    }\n    return is_null($field) ? $user['profile_fields'] : \\Arr::get($user['profile_fields'], $field);\n}\n\n\u547c\u3073\u51fa\u3059\u969b\u306f\n$users = Model_User::find('all');\nforeach ($users as $user)\n{\n    echo $user->username.\"(\".get_field_from_user($user, 'age').\")<br>\";\n}\n/*\n * Bob(30)\n * John(12)\n * ...\n */\n\n\u306e\u3088\u3046\u306b\u4f7f\u3048\u3070\u826f\u3044\u3002\n\n\u30cd\u30c3\u30c8\u306b\u3088\u304f\u5e83\u307e\u3063\u3066\u3044\u308b\u65b9\u6cd5\n\u3082\u3068\u3082\u3068\u305d\u306e\u307e\u307eunserialize\u3057\u305f\u304b\u3063\u305f\u304c\u30a8\u30e9\u30fc\u3092\u5410\u304b\u308c\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u8abf\u3079\u305f\u3068\u3053\u308d\u3001\u6700\u3082\u591a\u304b\u3063\u305f\u306e\u306f\n\n\nsereialize\u3057\u305f\u5f8c\u306bbase64_encode()\n\n\nunsereialize\u3059\u308b\u524d\u306bbase64_decode()\n\n\n\u3068\u3044\u3046\u65b9\u6cd5\u3002\n\u3057\u304b\u3057Model\u306esave()\u3084\u3089Auth::update_user()\u3084\u3089\u3092\u76f4\u63a5\u3044\u3058\u308b\u308f\u3051\u306b\u3044\u304b\u306a\u3044\u3057\u3001Auth::get($profile)\u307f\u305f\u3044\u306b\u3084\u308b\u3068\u3001\u65e2\u306b\u53d6\u5f97\u3057\u3066\u3044\u3066\u3082\u3082\u3046\u4e00\u56de\u53d6\u3089\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3057\u306a\u3041\u30fc\u2026\u3068\u601d\u3063\u3066\u3044\u308d\u3044\u308d\u8abf\u3079\u3066\u3044\u305f\u3068\u3053\u308d\u3001\u3053\u306e\u65b9\u6cd5\u3092\u767a\u898b\u3057\u305f\u3002\n\n\u74b0\u5883\n\u4e00\u5fdc\u3067\u306f\u3042\u308b\u304c\u81ea\u5206\u306e\u74b0\u5883\u3092\u8efd\u304f\u66f8\u304f\u3068\n\nPHP5.3\nFuelPHP 1.7\nAuth\u30d1\u30c3\u30b1\u30fc\u30b8\u306fSimpleAuth\u3001users\u30c6\u30fc\u30d6\u30eb\u306f\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u57fa\u3065\u3044\u305f\u69cb\u6210\n\n\u3068\u8a00\u3063\u305f\u611f\u3058\u3067\u3042\u308b\u3002\n\u5b8c\u5168\u52dd\u5229\u3002\n###\u52a9\u3051\u3066\u3044\u305f\u3060\u3044\u305f\u8a18\u4e8b\n[PHP\u306e\u95a2\u6570unserialize\u3067\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\u5834\u5408\u306e\u5bfe\u51e6\u65b9\u6cd5 | cms helog - CMS\u69cb\u7bc9\u3092\u76ee\u7684\u306bPHP\u3092\u30d9\u30fc\u30b9\u3068\u3057\u305fWordPress\u3001CakePHP\u3084PEAR\u306a\u3069\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u3092\u4e2d\u5fc3\u306b\u89e3\u8aac\u3057\u3066\u3044\u307e\u3059](http://cms.helog.jp/php/unserialize-error/)\n\n#\u7d50\u8ad6\n`html_entity_decode()`\u3092\u3057\u3088\u3046\u3002\n\n```php\n\n/**\n * \u6587\u5b57\u30b3\u30fc\u30c9\u30a8\u30e9\u30fc\u304c\u51fa\u306a\u3044\u3088\u3046\u306bunserialize\u3059\u308b\n * @param $string unserialize\u3057\u305f\u3044\u6587\u5b57\u5217\n * @return mixed\n */\nfunction safe_unserialize($string)\n{\n\treturn unserialize(html_entity_decode($string, ENT_QUOTES));\n}\n\n/**\n * users\u30c6\u30fc\u30d6\u30eb\u304b\u3089\u53d6\u5f97\u3057\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eprofile_fields\u306b\u3042\u308b\u7279\u5b9a\u60c5\u5831\u3092\u8fd4\u3059\n * @param $user Model_User::find()\u306e\u8fd4\u308a\u5024\n * @param $field profile_fields\u306e\u4e2d\u304b\u3089\u6b32\u3057\u3044\u60c5\u5831\n * @return array|mixed\n */\nfunction get_field_from_user($user, $field)\n{\n\tif (isset($user['profile_fields']))\n\t{\n\t\tis_array($user['profile_fields']) or $user['profile_fields'] = (@safe_unserialize($user['profile_fields']) ?: array());\n\t}\n\telse\n\t{\n\t\t$user['profile_fields'] = array();\n\t}\n\treturn is_null($field) ? $user['profile_fields'] : \\Arr::get($user['profile_fields'], $field);\n}\n```\n\n\u547c\u3073\u51fa\u3059\u969b\u306f\n\n```php\n$users = Model_User::find('all');\nforeach ($users as $user)\n{\n\techo $user->username.\"(\".get_field_from_user($user, 'age').\")<br>\";\n}\n/*\n * Bob(30)\n * John(12)\n * ...\n */\n```\n\u306e\u3088\u3046\u306b\u4f7f\u3048\u3070\u826f\u3044\u3002\n\n#\u30cd\u30c3\u30c8\u306b\u3088\u304f\u5e83\u307e\u3063\u3066\u3044\u308b\u65b9\u6cd5\n\u3082\u3068\u3082\u3068\u305d\u306e\u307e\u307e`unserialize`\u3057\u305f\u304b\u3063\u305f\u304c\u30a8\u30e9\u30fc\u3092\u5410\u304b\u308c\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u8abf\u3079\u305f\u3068\u3053\u308d\u3001\u6700\u3082\u591a\u304b\u3063\u305f\u306e\u306f\n\n- `sereialize`\u3057\u305f\u5f8c\u306b`base64_encode()`\n- `unsereialize`\u3059\u308b\u524d\u306b`base64_decode()`\n\n\u3068\u3044\u3046\u65b9\u6cd5\u3002\n\u3057\u304b\u3057`Model`\u306e`save()`\u3084\u3089`Auth::update_user()`\u3084\u3089\u3092\u76f4\u63a5\u3044\u3058\u308b\u308f\u3051\u306b\u3044\u304b\u306a\u3044\u3057\u3001`Auth::get($profile)`\u307f\u305f\u3044\u306b\u3084\u308b\u3068\u3001\u65e2\u306b\u53d6\u5f97\u3057\u3066\u3044\u3066\u3082\u3082\u3046\u4e00\u56de\u53d6\u3089\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3057\u306a\u3041\u30fc\u2026\u3068\u601d\u3063\u3066\u3044\u308d\u3044\u308d\u8abf\u3079\u3066\u3044\u305f\u3068\u3053\u308d\u3001\u3053\u306e\u65b9\u6cd5\u3092\u767a\u898b\u3057\u305f\u3002\n\n#\u74b0\u5883\n\u4e00\u5fdc\u3067\u306f\u3042\u308b\u304c\u81ea\u5206\u306e\u74b0\u5883\u3092\u8efd\u304f\u66f8\u304f\u3068\n\n- PHP5.3\n- FuelPHP 1.7\n- Auth\u30d1\u30c3\u30b1\u30fc\u30b8\u306fSimpleAuth\u3001users\u30c6\u30fc\u30d6\u30eb\u306f\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u57fa\u3065\u3044\u305f\u69cb\u6210\n\n\u3068\u8a00\u3063\u305f\u611f\u3058\u3067\u3042\u308b\u3002\n", "tags": ["FuelPHP", "PHP"]}