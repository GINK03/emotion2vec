{"context": "\n\nCrowi\nMarkdown\u3067\u7c21\u5358\u306b\u66f8\u3051\u308bWiki\u306e\u3088\u3046\u306a\u3082\u306e\u3092\u63a2\u3057\u3066\u3044\u305f\u3089\u3088\u3055\u3052\u306a\u306e\u3092\u898b\u3064\u3051\u307e\u3057\u305f\nCrowi\nCrowi - The Simple & Powerful Communication Tool Based on Wiki (github)\n\nMarkdown\u304c\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u30d7\u30ec\u30d3\u30e5\u30fc\u3067\u66f8\u3051\u308b\n\u6295\u7a3f\u30e6\u30fc\u30b6\u304c\u8a2d\u5b9a\u3067\u304d\u308b\nnodejs\u3068mongodb\u3067\u52d5\u3044\u3066\u8efd\u91cf\n\u52d5\u4f5c\u3082\u8efd\u5feb\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u74b0\u5883\n\nUbuntu 14.04 LTS (VirtualBox)\nMongoDB 3.2.8\nNode.js 4.4.7\n\n\u65e2\u306bUbuntu 16.04 LTS\u304c\u51fa\u3066\u307e\u3059\u3057\u305d\u3061\u3089\u3067\u3082\u3044\u3044\u3068\u601d\u3044\u307e\u3059\n\u304c\u3001\u30b5\u30fc\u30d3\u30b9\u5468\u308a\u304c14.04\u3068\u5927\u304d\u304f\u7570\u306a\u308b\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\n\n\u6e96\u5099\nCrowi\u306fgithub\u3067\u7ba1\u7406\u3055\u308c\u3066\u308b\u306e\u3067git\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nNode.js\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30b3\u30f3\u30d1\u30a4\u30eb\u306e\u305f\u3081\u306bbuild-essential\u3068python\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u307e\u305fkerberos\u3068\u3044\u3046\u30e2\u30b8\u30e5\u30fc\u30eb\u306blibkrb5-dev\u304c\u5fc5\u8981\u307f\u305f\u3044\u306a\u306e\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304d\u307e\u3059\nsudo apt-get update\nsudo apt-get install build-essential python git libkrb5-dev\n\n\nMongoDB\n\u3053\u3053\u306b\u66f8\u3044\u3066\u3042\u308b\u3068\u304a\u308a\u306b\u9032\u3081\u307e\u3059\nInstall MongoDB Community Edition on Ubuntu\n# 1 Import the public key used by the package management system\nsudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv EA312927\n# 2 Create a list file for MongoDB\necho \"deb http://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.2 multiverse\" | sudo tee /etc/apt/sources.list.d/mongodb-org-3.2.list\n# 3 Reload local package database\nsudo apt-get update\n# 4 Install the MongoDB packages.\nsudo apt-get install mongodb-org\n\n\u3061\u306a\u307f\u306b\u3053\u3053\u3067\u4f7f\u3046apt-key\u3067\u3059\u304cProxy\u304c\u3042\u308b\u3068\u305d\u306e\u307e\u307e\u52d5\u304d\u307e\u305b\u3093\n--keyserver-option\u3092\u4f7f\u3063\u3066Proxy\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\nubuntu\u3067\u8a8d\u8a3c\u30d7\u30ed\u30ad\u30b7\u914d\u4e0b\u304b\u3089apt-key\u3092\u4f7f\u3046\u3068\u304d\n\u3055\u3089\u306b16.04\u306e\u5834\u5408\u3001systemd\u304c\u63a1\u7528\u3055\u308c\u305f\u95a2\u4fc2\u304b\u3089\u305d\u306e\u307e\u307e\u3060\u3068mongodb\u304c\u8d77\u52d5\u3057\u306a\u3044\u3053\u3068\u304c\u3042\u308a\u307e\u3059\n\u3053\u306e\u5834\u5408\u306fmongodb.service\u3092\u81ea\u5206\u3067\u66f8\u3051\u3070\u3061\u3083\u3093\u3068\u52d5\u304f\u3088\u3046\u306b\u306a\u308a\u307e\u3059\nHow to Install MongoDB on Ubuntu 16.04\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u305f\u3089Crowi\u7528\u306e\u30e6\u30fc\u30b6\u3092\u4f5c\u3063\u3066\u304a\u304d\u307e\u3059\n\u30e6\u30fc\u30b6\u540d\uff0c\u30d1\u30b9\u30ef\u30fc\u30c9\uff0c\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d\u306f\u9069\u5f53\u306b\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\n\u5f8c\u3067Crowi\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u306b\u4f7f\u7528\u3057\u307e\u3059\n$ mongo\n> use crowidb\nswitched to db crowidb\n> db.createUser({user: \"USERNAME\", pwd: \"PASSWORD\", roles: [{role: \"readWrite\", db: \"DBNAME\"}]})\nSuccessfully added user: {\n        \"user\" : \"USERNAME\",\n        \"roles\" : [\n                {\n                        \"role\" : \"readWrite\",\n                        \"db\" : \"DBNAME\"\n                }\n        ]\n}\n\n\u4e00\u5fdc\u30e6\u30fc\u30b6\u304c\u3061\u3083\u3093\u3068\u3067\u304d\u3066\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\n> use admin\nswitched to db admin\n> db.system.users.find()\n{ \"_id\" : \"DBNAME.USERNAME\", \"user\" : \"USERNAME\", \"db\" : \"DBNAME\", \uff5e\u4e2d\u7565\uff5e \"roles\" : [ { \"role\" : \"readWrite\", \"db\" : \"DBNAME\" } ] }\n> exit\n\n\nNode.js\n\ntrusty\u306eNode.js\u306f\u53e4\u3044\nCrowi\u306f4.2.x\u306eNode.js\u304c\u5fc5\u8981\u3067\u3059\uff0e\n\u3067\u3082trusty\u306eapt-get\u3060\u30680.10.x\u306e\u53e4\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u5165\u3063\u3066\u3057\u307e\u3044\u307e\u3059\uff0e\napt search\u3059\u308b\u3068\u3053\u3093\u306a\u611f\u3058\u3067\u3059\uff0e\napt search nodejs | grep nodejs\n\nWARNING: apt does not have a stable CLI interface yet. Use with caution in scripts.\n\n  unobtrusive notification system for nodejs\nnodejs/trusty 0.10.25~dfsg2-2ubuntu1 amd64\nnodejs-dbg/trusty 0.10.25~dfsg2-2ubuntu1 amd64\nnodejs-dev/trusty 0.10.25~dfsg2-2ubuntu1 amd64\nnodejs-legacy/trusty 0.10.25~dfsg2-2ubuntu1 all\n\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nUbuntu\u306b\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u30664.x\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u65b9\u6cd5\u304c\u3053\u3053\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\nNodeSource Node.js Binary Distributions\ncurl\u3067\u3082wget\u3067\u3082\u3069\u3063\u3061\u3067\u3082\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\nwget -qO- https://deb.nodesource.com/setup_4.x | sudo -E bash -\n\n\u3053\u3053\u3067\u3082\u3046\u4e00\u5ea6apt search nodejs\u3059\u308b\u3068\u3061\u3083\u3093\u30684.x\u306eNode.js\u304c\u5c45\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\napt search nodejs | grep nodejs\n\nWARNING: apt does not have a stable CLI interface yet. Use with caution in scripts.\n\n  unobtrusive notification system for nodejs\nnodejs/unknown 4.4.7-1nodesource1~trusty1 amd64\nnodejs-dbg/unknown 4.4.7-1nodesource1~trusty1 amd64\nnodejs-dev/trusty 0.10.25~dfsg2-2ubuntu1 amd64\nnodejs-legacy/trusty 0.10.25~dfsg2-2ubuntu1 all\n\n\u3042\u3068\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3060\u3051\u3067\u3059\nsudo apt-get install nodejs\n\n\u3061\u3083\u3093\u30684.x\u306eNode.js\u304c\u5165\u308a\u307e\u3057\u305f\nnodejs -v\nv4.4.7\n\n\nCrowi\ngit clone\u3057\u3066npm install\u3059\u308b\u3060\u3051\u3067\u3059\n\u7d50\u69cb\u6642\u9593\u304c\u304b\u304b\u308b\u306e\u3067\u5f85\u3061\u307e\u3059\ngit clone --depth 1 https://github.com/crowi/crowi.git\ncd crowi\nnpm install\n\n\u3061\u306a\u307f\u306b\u3084\u3063\u3071\u308aProxy\u74b0\u5883\u4e0b\u3060\u3068npm install\u304c\u304c\u3067\u304d\u307e\u305b\u3093\n\u30d7\u30ed\u30ad\u30b7\u74b0\u5883\u4e0b\u3067npm install\u3092\u5b9f\u884c\u3059\u308b\nlibkrb5-dev\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3063\u3066\u304a\u3051\u3070\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u306f\u51fa\u307e\u305b\u3093\n\nkerberos\u306e\u30d3\u30eb\u30c9\u3067\u30a8\u30e9\u30fc\u3092\u5410\u3044\u3066\u3057\u307e\u3063\u3066\u3044\u308b\nmake: Entering directory `/usr/lib/node_modules/kerberos/build'\n  CXX(target) Release/obj.target/kerberos/lib/kerberos.o\nIn file included from ../lib/kerberos.cc:1:0:\n../lib/kerberos.h:5:27: fatal error: gssapi/gssapi.h: No such file or directory\n #include <gssapi/gssapi.h>\n\nlibkrb5-dev\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308c\u3070\u3044\u3044\u3089\u3057\u3044\u306e\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo apt-get install libkrb5-dev\n\nlibkrb5-dev\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8ckerberos\u3092\u5358\u4f53\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068\u3061\u3083\u3093\u3068\u3067\u304d\u307e\u3059\nsudo npm install -g kerberos\nkerberos@0.0.21 /usr/lib/node_modules/kerberos\n\u2514\u2500\u2500 nan@2.3.5\n\n\n\u3082\u3046\u4e00\u5ea6crowi\u3092npm install\u3057\u305f\u3089\u3061\u3083\u3093\u3068\u3067\u304d\u307e\u3057\u305f\nnpm install\n/\n> crowi@1.4.0 postinstall /home/USERNAME/crowi\n> gulp\n\n[02:12:57] Using gulpfile ~/crowi/gulpfile.js\n[02:12:57] Starting 'css:sass'...\n[02:12:57] Starting 'js:del'...\n[02:12:57] Finished 'js:del' after 106 ms\n[02:12:57] Starting 'js:concat'...\n[02:12:57] Finished 'js:concat' after 178 ms\n[02:12:57] Starting 'webpack'...\n[02:13:03] Finished 'css:sass' after 6.04 s\n[02:13:03] Starting 'css:concat'...\n[02:15:26] Finished 'css:concat' after 2.38 min\n[02:15:26] Starting 'css:min'...\n[02:15:39] Finished 'css:min' after 13 s\n[02:16:31] Version: webpack 1.13.1\n          Asset       Size  Chunks             Chunk Names\n       admin.js  611 bytes       0  [emitted]  admin\n         app.js     687 kB       1  [emitted]  app\n       crowi.js     591 kB       2  [emitted]  crowi\n        form.js    6.34 kB       3  [emitted]  form\npresentation.js    52.6 kB       4  [emitted]  presentation\n[02:16:32] Finished 'webpack' after 3.57 min\n[02:16:32] Starting 'js:min'...\n[02:16:32] Finished 'js:min' after 222 ms\n[02:16:32] Starting 'default'...\n[02:16:32] Finished 'default' after 33 \u03bcs\ninline-attachment@2.0.2 node_modules/inline-attachment\n\n\n\u5b9f\u884c\n\u74b0\u5883\u5909\u6570\u3067\u8a2d\u5b9a\u3092\u884c\u3044\uff0c\u6700\u5f8c\u306bnode app.js\u3092\u5b9f\u884c\u3057\u3066Crowi\u3092\u7acb\u3061\u4e0a\u3052\u307e\u3059\nPASSWORD_SEED=somesecretstring MONGO_URI=mongodb://USERNAME:PASSWORD@localhost/DBNAME node app.js\n\n\u3068\u308a\u3042\u3048\u305a\u6700\u4f4e\u9650MONGO_URI\u3060\u3051\u8a2d\u5b9a\u3059\u308c\u3070\u305d\u306e\u4ed6\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u304c\u5165\u3063\u3066\u52d5\u304f\u307f\u305f\u3044\u3067\u3059\nPASSWORD_SEED\u306b\u5024\u304c\u306a\u3044\u5834\u5408\u306f\u81ea\u52d5\u751f\u6210\u3055\u308c\u308b\u3088\u3046\u3067\u3059\n\u8a73\u3057\u304f\u306fCrowi\u306egithub\u3092\u53c2\u7167\n\u305f\u3060\uff0cPASSWORD_SEED\u306f\u30e6\u30fc\u30b6\u767b\u9332\u6642\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u304b\u3089\u30cf\u30c3\u30b7\u30e5\u3092\u751f\u6210\u3059\u308b\u305f\u3081\u306e\u30b7\u30fc\u30c9\u5024\u3067\u3059\u306e\u3067\uff0c\n\u3053\u308c\u3092\u5909\u3048\u308b\u3068\u65e2\u5b58\u30e6\u30fc\u30b6\u304c\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\ncrowi\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u76f4\u4e0b\u306b\u3053\u3093\u306a\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u3044\u3066\u7f6e\u3044\u3066\u304a\u3051\u3070\u7c21\u5358\u304b\u3082\n\ncrowi.sh\nexport PASSWORD_SEED=somesecretstring\nexport MONGO_URI=mongodb://USERNAME:PASSWORD@localhost/DBNAME\nnode app.js\n\n\n\u3042\u3068\u306f\u5b9f\u884c\u3059\u308b\u3060\u3051\u3067\u3059\nchmod +x crowi.sh\n./crowi.sh\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u30dd\u30fc\u30c8\u306f3000\u3067\u3059\nhttp://localhost:3000/\u3067crowi\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u3059\n\u8a73\u3057\u304f\u306fCrowi\u306egithub\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\n\u521d\u56de\u63a5\u7d9a\u6642\u306f\u7ba1\u7406\u8005\u8a2d\u5b9a\u753b\u9762\u304c\u51fa\u307e\u3059\n\n\nsystemd\u3067\u81ea\u52d5\u8d77\u52d5\ncrowi\u3092systemd\u3067\u81ea\u52d5\u8d77\u52d5\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\n\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\nCrowi \u3092 CentOS7 \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nSystemd\u3092\u4f7f\u3063\u3066\u3055\u304f\u3063\u3068\u81ea\u4f5c\u30b3\u30de\u30f3\u30c9\u3092\u30b5\u30fc\u30d3\u30b9\u5316\u3057\u3066\u307f\u308b\nsystemd\u3067\u30e6\u30fc\u30b6\u30fc\u306e\u74b0\u5883\u5909\u6570\u3092\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u3059\u308b\n\u307e\u305acrowi\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u9069\u5f53\u306b\u79fb\u52d5\u3057\u307e\u3059\nsudo mv crowi /usr/local/bin/\n\n\u6b21\u306bsystemd\u306e\u305f\u3081\u306e\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\n\u7d76\u5bfe\u30d1\u30b9\u3067\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\n\n/etc/systemd/system/crowi.service\n[Unit]\nDescription=Crowi - The Simple & Powerful Communication Tool Based on Wiki\nAfter=network.target mongod.service\n\n[Service]\nWorkingDirectory=/usr/local/bin/crowi\nEnvironmentFile=/etc/systemd/system/crowi.conf\nExecStart=/usr/bin/node app.js\n\n[Install]\nWantedBy=multi-user.target\n\n\n\n\n\n\u5909\u6570\n\n\n\n\n\nDescription\n\u3053\u306e.service\u30d5\u30a1\u30a4\u30eb\u306e\u8aac\u660e\n\n\nAfter\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8d77\u52d5\u5f8c\u3001mongodb\u306e\u8d77\u52d5\u5f8c\u306b\u958b\u59cb\n\n\nWorkingDirectory\n\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u5834\u6240(\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea)\n\n\nEnvironmentFile\n\u74b0\u5883\u5909\u6570\u3092\u8aad\u307f\u8fbc\u3080\u30d5\u30a1\u30a4\u30eb\n\n\nExecStart\n\u5b9f\u884c\u3059\u308b\u30b3\u30de\u30f3\u30c9\n\n\n\n\u3053\u3061\u3089\u304c\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3059\u308bEnvironmentFile\u3067\u3059\n\n/etc/systemd/system/crowi.conf\nPORT=3000\nMONGO_URI=\"mongodb://USERNAME:PASSWORD@localhost/DBNAME\"\nPASSWORD_SEED=somesecretstring\nFILE_UPLOAD=local\n\n\n\u30d5\u30a1\u30a4\u30eb\u304c\u7528\u610f\u51fa\u6765\u305f\u3089\u8a8d\u8b58\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\nsudo systemctl list-unit-files --type=service |grep crowi\ncrowi.service                              disabled\n\n\u554f\u984c\u306a\u3055\u305d\u3046\u3067\u3059\nenable\u3067\u81ea\u52d5\u8d77\u52d5\u3092\u6709\u52b9\u306b\u3057\u3001start\u3067\u958b\u59cb\u3057\u307e\u3059\nsudo systemctl enable crowi\nsudo systemctl start crowi\n\n\u518d\u8d77\u52d5\u3057\u3066\u81ea\u52d5\u8d77\u52d5\u3067\u304d\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\n$ sudo systemctl list-unit-files --type=service |grep crowi\ncrowi.service                              enabled\n\n$ systemctl status crowi.service\n\u25cf crowi.service - Crowi - The Simple & Powerful Communication Tool Based on Wiki\n   Loaded: loaded (/etc/systemd/system/crowi.service; enabled; vendor preset: enabled)\n   Active: active (running) since \u706b 2016-07-19 13:37:27 JST; 13min ago\n Main PID: 769 (node)\n    Tasks: 9\n   Memory: 87.0M\n      CPU: 1.477s\n   CGroup: /system.slice/crowi.service\n           \u2514\u2500769 /usr/bin/node app.js\n\n 7\u6708 19 13:37:27 ubuntuVM systemd[1]: Started Crowi - The Simple & Powerful Communication Tool Based on Wiki.\n 7\u6708 19 13:37:51 ubuntuVM node[769]: [development] Express server listening on port 3000\n\n\u6b63\u3057\u304f\u8d77\u52d5\u3067\u304d\u3066\u3044\u308b\u3088\u3046\u3067\u3059\n\u6700\u5f8c\u306b\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u7d42\u4e86\u3067\u3059\n# Crowi\nMarkdown\u3067\u7c21\u5358\u306b\u66f8\u3051\u308bWiki\u306e\u3088\u3046\u306a\u3082\u306e\u3092\u63a2\u3057\u3066\u3044\u305f\u3089\u3088\u3055\u3052\u306a\u306e\u3092\u898b\u3064\u3051\u307e\u3057\u305f\n\n[Crowi](http://site.crowi.wiki/)\n[Crowi - The Simple & Powerful Communication Tool Based on Wiki](https://github.com/crowi/crowi/) (github)\n\n* Markdown\u304c\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u30d7\u30ec\u30d3\u30e5\u30fc\u3067\u66f8\u3051\u308b\n* \u6295\u7a3f\u30e6\u30fc\u30b6\u304c\u8a2d\u5b9a\u3067\u304d\u308b\n* nodejs\u3068mongodb\u3067\u52d5\u3044\u3066\u8efd\u91cf\n* \u52d5\u4f5c\u3082\u8efd\u5feb\n\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n### \u74b0\u5883\n\n* Ubuntu 14.04 LTS (VirtualBox)\n* MongoDB 3.2.8\n* Node.js 4.4.7\n\n\u65e2\u306bUbuntu 16.04 LTS\u304c\u51fa\u3066\u307e\u3059\u3057\u305d\u3061\u3089\u3067\u3082\u3044\u3044\u3068\u601d\u3044\u307e\u3059\n\u304c\u3001\u30b5\u30fc\u30d3\u30b9\u5468\u308a\u304c14.04\u3068\u5927\u304d\u304f\u7570\u306a\u308b\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\n\n### \u6e96\u5099\nCrowi\u306fgithub\u3067\u7ba1\u7406\u3055\u308c\u3066\u308b\u306e\u3067git\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nNode.js\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30b3\u30f3\u30d1\u30a4\u30eb\u306e\u305f\u3081\u306b`build-essential`\u3068`python`\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u307e\u305fkerberos\u3068\u3044\u3046\u30e2\u30b8\u30e5\u30fc\u30eb\u306b`libkrb5-dev`\u304c\u5fc5\u8981\u307f\u305f\u3044\u306a\u306e\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304d\u307e\u3059\n\n```bash\nsudo apt-get update\nsudo apt-get install build-essential python git libkrb5-dev\n```\n\n### MongoDB\n\u3053\u3053\u306b\u66f8\u3044\u3066\u3042\u308b\u3068\u304a\u308a\u306b\u9032\u3081\u307e\u3059\n[Install MongoDB Community Edition on Ubuntu](https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/)\n\n```bash\n# 1 Import the public key used by the package management system\nsudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv EA312927\n# 2 Create a list file for MongoDB\necho \"deb http://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.2 multiverse\" | sudo tee /etc/apt/sources.list.d/mongodb-org-3.2.list\n# 3 Reload local package database\nsudo apt-get update\n# 4 Install the MongoDB packages.\nsudo apt-get install mongodb-org\n```\n\u3061\u306a\u307f\u306b\u3053\u3053\u3067\u4f7f\u3046apt-key\u3067\u3059\u304cProxy\u304c\u3042\u308b\u3068\u305d\u306e\u307e\u307e\u52d5\u304d\u307e\u305b\u3093\n`--keyserver-option`\u3092\u4f7f\u3063\u3066Proxy\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\n[ubuntu\u3067\u8a8d\u8a3c\u30d7\u30ed\u30ad\u30b7\u914d\u4e0b\u304b\u3089apt-key\u3092\u4f7f\u3046\u3068\u304d](http://qiita.com/nmatsui/items/816051fe6445db116e9a)\n\n\u3055\u3089\u306b16.04\u306e\u5834\u5408\u3001systemd\u304c\u63a1\u7528\u3055\u308c\u305f\u95a2\u4fc2\u304b\u3089\u305d\u306e\u307e\u307e\u3060\u3068mongodb\u304c\u8d77\u52d5\u3057\u306a\u3044\u3053\u3068\u304c\u3042\u308a\u307e\u3059\n\u3053\u306e\u5834\u5408\u306f`mongodb.service`\u3092\u81ea\u5206\u3067\u66f8\u3051\u3070\u3061\u3083\u3093\u3068\u52d5\u304f\u3088\u3046\u306b\u306a\u308a\u307e\u3059\n[How to Install MongoDB on Ubuntu 16.04](https://www.digitalocean.com/community/tutorials/how-to-install-mongodb-on-ubuntu-16-04)\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u305f\u3089Crowi\u7528\u306e\u30e6\u30fc\u30b6\u3092\u4f5c\u3063\u3066\u304a\u304d\u307e\u3059\n\u30e6\u30fc\u30b6\u540d\uff0c\u30d1\u30b9\u30ef\u30fc\u30c9\uff0c\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d\u306f\u9069\u5f53\u306b\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\n\u5f8c\u3067Crowi\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u306b\u4f7f\u7528\u3057\u307e\u3059\n\n```bash\n$ mongo\n> use crowidb\nswitched to db crowidb\n> db.createUser({user: \"USERNAME\", pwd: \"PASSWORD\", roles: [{role: \"readWrite\", db: \"DBNAME\"}]})\nSuccessfully added user: {\n        \"user\" : \"USERNAME\",\n        \"roles\" : [\n                {\n                        \"role\" : \"readWrite\",\n                        \"db\" : \"DBNAME\"\n                }\n        ]\n}\n```\n\u4e00\u5fdc\u30e6\u30fc\u30b6\u304c\u3061\u3083\u3093\u3068\u3067\u304d\u3066\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\n\n```bash\n> use admin\nswitched to db admin\n> db.system.users.find()\n{ \"_id\" : \"DBNAME.USERNAME\", \"user\" : \"USERNAME\", \"db\" : \"DBNAME\", \uff5e\u4e2d\u7565\uff5e \"roles\" : [ { \"role\" : \"readWrite\", \"db\" : \"DBNAME\" } ] }\n> exit\n```\n\n### Node.js\n#### trusty\u306eNode.js\u306f\u53e4\u3044\nCrowi\u306f4.2.x\u306eNode.js\u304c\u5fc5\u8981\u3067\u3059\uff0e\n\u3067\u3082trusty\u306eapt-get\u3060\u30680.10.x\u306e\u53e4\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u5165\u3063\u3066\u3057\u307e\u3044\u307e\u3059\uff0e\n`apt search`\u3059\u308b\u3068\u3053\u3093\u306a\u611f\u3058\u3067\u3059\uff0e\n\n```bash\napt search nodejs | grep nodejs\n\nWARNING: apt does not have a stable CLI interface yet. Use with caution in scripts.\n\n  unobtrusive notification system for nodejs\nnodejs/trusty 0.10.25~dfsg2-2ubuntu1 amd64\nnodejs-dbg/trusty 0.10.25~dfsg2-2ubuntu1 amd64\nnodejs-dev/trusty 0.10.25~dfsg2-2ubuntu1 amd64\nnodejs-legacy/trusty 0.10.25~dfsg2-2ubuntu1 all\n```\n\n#### \u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nUbuntu\u306b\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u30664.x\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u65b9\u6cd5\u304c\u3053\u3053\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\n[NodeSource Node.js Binary Distributions](https://github.com/nodesource/distributions)\n`curl`\u3067\u3082`wget`\u3067\u3082\u3069\u3063\u3061\u3067\u3082\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\n\n```bash\nwget -qO- https://deb.nodesource.com/setup_4.x | sudo -E bash -\n```\n\n\u3053\u3053\u3067\u3082\u3046\u4e00\u5ea6`apt search nodejs`\u3059\u308b\u3068\u3061\u3083\u3093\u30684.x\u306eNode.js\u304c\u5c45\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\n\n```bash\napt search nodejs | grep nodejs\n\nWARNING: apt does not have a stable CLI interface yet. Use with caution in scripts.\n\n  unobtrusive notification system for nodejs\nnodejs/unknown 4.4.7-1nodesource1~trusty1 amd64\nnodejs-dbg/unknown 4.4.7-1nodesource1~trusty1 amd64\nnodejs-dev/trusty 0.10.25~dfsg2-2ubuntu1 amd64\nnodejs-legacy/trusty 0.10.25~dfsg2-2ubuntu1 all\n```\n\n\u3042\u3068\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3060\u3051\u3067\u3059\n\n```bash\nsudo apt-get install nodejs\n```\n\n\u3061\u3083\u3093\u30684.x\u306eNode.js\u304c\u5165\u308a\u307e\u3057\u305f\n\n```bash\nnodejs -v\nv4.4.7\n```\n\n### Crowi\ngit clone\u3057\u3066npm install\u3059\u308b\u3060\u3051\u3067\u3059\n\u7d50\u69cb\u6642\u9593\u304c\u304b\u304b\u308b\u306e\u3067\u5f85\u3061\u307e\u3059\n\n```bash\ngit clone --depth 1 https://github.com/crowi/crowi.git\ncd crowi\nnpm install\n```\n\n\u3061\u306a\u307f\u306b\u3084\u3063\u3071\u308aProxy\u74b0\u5883\u4e0b\u3060\u3068npm install\u304c\u304c\u3067\u304d\u307e\u305b\u3093\n[\u30d7\u30ed\u30ad\u30b7\u74b0\u5883\u4e0b\u3067npm install\u3092\u5b9f\u884c\u3059\u308b](http://sushichop.blogspot.jp/2013/01/npm-install.html)\n\n<Font color=\"red\">libkrb5-dev\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3063\u3066\u304a\u3051\u3070\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u306f\u51fa\u307e\u305b\u3093</font>\n> kerberos\u306e\u30d3\u30eb\u30c9\u3067\u30a8\u30e9\u30fc\u3092\u5410\u3044\u3066\u3057\u307e\u3063\u3066\u3044\u308b\n\n> ```bash\nmake: Entering directory `/usr/lib/node_modules/kerberos/build'\n  CXX(target) Release/obj.target/kerberos/lib/kerberos.o\nIn file included from ../lib/kerberos.cc:1:0:\n../lib/kerberos.h:5:27: fatal error: gssapi/gssapi.h: No such file or directory\n #include <gssapi/gssapi.h>\n```\n> libkrb5-dev\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308c\u3070\u3044\u3044\u3089\u3057\u3044\u306e\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n> ```bash\nsudo apt-get install libkrb5-dev\n```\nlibkrb5-dev\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8ckerberos\u3092\u5358\u4f53\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068\u3061\u3083\u3093\u3068\u3067\u304d\u307e\u3059\n\n> ```bash\nsudo npm install -g kerberos\nkerberos@0.0.21 /usr/lib/node_modules/kerberos\n\u2514\u2500\u2500 nan@2.3.5\n```\n\n\u3082\u3046\u4e00\u5ea6crowi\u3092npm install\u3057\u305f\u3089\u3061\u3083\u3093\u3068\u3067\u304d\u307e\u3057\u305f\n\n```bash\nnpm install\n/\n> crowi@1.4.0 postinstall /home/USERNAME/crowi\n> gulp\n\n[02:12:57] Using gulpfile ~/crowi/gulpfile.js\n[02:12:57] Starting 'css:sass'...\n[02:12:57] Starting 'js:del'...\n[02:12:57] Finished 'js:del' after 106 ms\n[02:12:57] Starting 'js:concat'...\n[02:12:57] Finished 'js:concat' after 178 ms\n[02:12:57] Starting 'webpack'...\n[02:13:03] Finished 'css:sass' after 6.04 s\n[02:13:03] Starting 'css:concat'...\n[02:15:26] Finished 'css:concat' after 2.38 min\n[02:15:26] Starting 'css:min'...\n[02:15:39] Finished 'css:min' after 13 s\n[02:16:31] Version: webpack 1.13.1\n          Asset       Size  Chunks             Chunk Names\n       admin.js  611 bytes       0  [emitted]  admin\n         app.js     687 kB       1  [emitted]  app\n       crowi.js     591 kB       2  [emitted]  crowi\n        form.js    6.34 kB       3  [emitted]  form\npresentation.js    52.6 kB       4  [emitted]  presentation\n[02:16:32] Finished 'webpack' after 3.57 min\n[02:16:32] Starting 'js:min'...\n[02:16:32] Finished 'js:min' after 222 ms\n[02:16:32] Starting 'default'...\n[02:16:32] Finished 'default' after 33 \u03bcs\ninline-attachment@2.0.2 node_modules/inline-attachment\n```\n\n## \u5b9f\u884c\n\u74b0\u5883\u5909\u6570\u3067\u8a2d\u5b9a\u3092\u884c\u3044\uff0c\u6700\u5f8c\u306b`node app.js`\u3092\u5b9f\u884c\u3057\u3066Crowi\u3092\u7acb\u3061\u4e0a\u3052\u307e\u3059\n\n```bash\nPASSWORD_SEED=somesecretstring MONGO_URI=mongodb://USERNAME:PASSWORD@localhost/DBNAME node app.js\n```\n\u3068\u308a\u3042\u3048\u305a\u6700\u4f4e\u9650`MONGO_URI`\u3060\u3051\u8a2d\u5b9a\u3059\u308c\u3070\u305d\u306e\u4ed6\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u304c\u5165\u3063\u3066\u52d5\u304f\u307f\u305f\u3044\u3067\u3059\n`PASSWORD_SEED`\u306b\u5024\u304c\u306a\u3044\u5834\u5408\u306f\u81ea\u52d5\u751f\u6210\u3055\u308c\u308b\u3088\u3046\u3067\u3059\n\u8a73\u3057\u304f\u306f[Crowi\u306egithub](https://github.com/crowi/crowi/)\u3092\u53c2\u7167\n\n\u305f\u3060\uff0c`PASSWORD_SEED`\u306f\u30e6\u30fc\u30b6\u767b\u9332\u6642\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u304b\u3089\u30cf\u30c3\u30b7\u30e5\u3092\u751f\u6210\u3059\u308b\u305f\u3081\u306e\u30b7\u30fc\u30c9\u5024\u3067\u3059\u306e\u3067\uff0c\n\u3053\u308c\u3092\u5909\u3048\u308b\u3068\u65e2\u5b58\u30e6\u30fc\u30b6\u304c\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\ncrowi\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u76f4\u4e0b\u306b\u3053\u3093\u306a\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u3044\u3066\u7f6e\u3044\u3066\u304a\u3051\u3070\u7c21\u5358\u304b\u3082\n\n```bash:crowi.sh\nexport PASSWORD_SEED=somesecretstring\nexport MONGO_URI=mongodb://USERNAME:PASSWORD@localhost/DBNAME\nnode app.js\n```\n\u3042\u3068\u306f\u5b9f\u884c\u3059\u308b\u3060\u3051\u3067\u3059\n\n```bash\nchmod +x crowi.sh\n./crowi.sh\n```\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u30dd\u30fc\u30c8\u306f3000\u3067\u3059\n[http://localhost:3000/](http://localhost:3000/)\u3067crowi\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u3059\n\u8a73\u3057\u304f\u306f[Crowi](https://github.com/crowi/crowi/)\u306egithub\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\n\n\u521d\u56de\u63a5\u7d9a\u6642\u306f\u7ba1\u7406\u8005\u8a2d\u5b9a\u753b\u9762\u304c\u51fa\u307e\u3059\n![c83076deafe7c75a07d76baf35cede3f.png](https://qiita-image-store.s3.amazonaws.com/0/125525/bd57ea79-74bb-285f-e1a1-98135c561f94.png)\n\n## systemd\u3067\u81ea\u52d5\u8d77\u52d5\ncrowi\u3092systemd\u3067\u81ea\u52d5\u8d77\u52d5\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\n\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\n[Crowi \u3092 CentOS7 \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb](http://www.kunitake.org/chalow/2016-04-28-1.html)\n[Systemd\u3092\u4f7f\u3063\u3066\u3055\u304f\u3063\u3068\u81ea\u4f5c\u30b3\u30de\u30f3\u30c9\u3092\u30b5\u30fc\u30d3\u30b9\u5316\u3057\u3066\u307f\u308b](http://qiita.com/DQNEO/items/0b5d0bc5d3cf407cb7ff)\n[systemd\u3067\u30e6\u30fc\u30b6\u30fc\u306e\u74b0\u5883\u5909\u6570\u3092\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u3059\u308b](https://bacchi.me/linux/systemd-tips/)\n\n\u307e\u305acrowi\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u9069\u5f53\u306b\u79fb\u52d5\u3057\u307e\u3059\n\n```bash\nsudo mv crowi /usr/local/bin/\n```\n\u6b21\u306bsystemd\u306e\u305f\u3081\u306e\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\n\u7d76\u5bfe\u30d1\u30b9\u3067\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\n\n```bash:/etc/systemd/system/crowi.service\n[Unit]\nDescription=Crowi - The Simple & Powerful Communication Tool Based on Wiki\nAfter=network.target mongod.service\n\n[Service]\nWorkingDirectory=/usr/local/bin/crowi\nEnvironmentFile=/etc/systemd/system/crowi.conf\nExecStart=/usr/bin/node app.js\n\n[Install]\nWantedBy=multi-user.target\n```\n|\u5909\u6570            |   |\n|---             |---|\n|Description     |\u3053\u306e.service\u30d5\u30a1\u30a4\u30eb\u306e\u8aac\u660e|\n|After           |\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8d77\u52d5\u5f8c\u3001mongodb\u306e\u8d77\u52d5\u5f8c\u306b\u958b\u59cb|\n|WorkingDirectory|\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u5834\u6240(\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea)|\n|EnvironmentFile |\u74b0\u5883\u5909\u6570\u3092\u8aad\u307f\u8fbc\u3080\u30d5\u30a1\u30a4\u30eb|\n|ExecStart       |\u5b9f\u884c\u3059\u308b\u30b3\u30de\u30f3\u30c9|\n\n\u3053\u3061\u3089\u304c\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3059\u308b`EnvironmentFile`\u3067\u3059\n\n```bash:/etc/systemd/system/crowi.conf\nPORT=3000\nMONGO_URI=\"mongodb://USERNAME:PASSWORD@localhost/DBNAME\"\nPASSWORD_SEED=somesecretstring\nFILE_UPLOAD=local\n```\n\u30d5\u30a1\u30a4\u30eb\u304c\u7528\u610f\u51fa\u6765\u305f\u3089\u8a8d\u8b58\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\n\n```bash\nsudo systemctl list-unit-files --type=service |grep crowi\ncrowi.service                              disabled\n```\n\u554f\u984c\u306a\u3055\u305d\u3046\u3067\u3059\nenable\u3067\u81ea\u52d5\u8d77\u52d5\u3092\u6709\u52b9\u306b\u3057\u3001start\u3067\u958b\u59cb\u3057\u307e\u3059\n\n```bash\nsudo systemctl enable crowi\nsudo systemctl start crowi\n```\n\u518d\u8d77\u52d5\u3057\u3066\u81ea\u52d5\u8d77\u52d5\u3067\u304d\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\n\n```bash\n$ sudo systemctl list-unit-files --type=service |grep crowi\ncrowi.service                              enabled\n\n$ systemctl status crowi.service\n\u25cf crowi.service - Crowi - The Simple & Powerful Communication Tool Based on Wiki\n   Loaded: loaded (/etc/systemd/system/crowi.service; enabled; vendor preset: enabled)\n   Active: active (running) since \u706b 2016-07-19 13:37:27 JST; 13min ago\n Main PID: 769 (node)\n    Tasks: 9\n   Memory: 87.0M\n      CPU: 1.477s\n   CGroup: /system.slice/crowi.service\n           \u2514\u2500769 /usr/bin/node app.js\n\n 7\u6708 19 13:37:27 ubuntuVM systemd[1]: Started Crowi - The Simple & Powerful Communication Tool Based on Wiki.\n 7\u6708 19 13:37:51 ubuntuVM node[769]: [development] Express server listening on port 3000\n```\n\u6b63\u3057\u304f\u8d77\u52d5\u3067\u304d\u3066\u3044\u308b\u3088\u3046\u3067\u3059\n\u6700\u5f8c\u306b\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u7d42\u4e86\u3067\u3059\n", "tags": ["Markdown", "Crowi"]}