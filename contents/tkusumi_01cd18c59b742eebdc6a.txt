{"context": "\u3053\u306e\u8a18\u4e8b\u306f Kubernetes 1.5.2 \u3067\u78ba\u8a8d\u3057\u305f\u60c5\u5831\u3092\u5143\u306b\u8a18\u8f09\u3057\u3066\u3044\u307e\u3059\u3002\n\nDeployment\nDeployment\u306f\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3084\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3068\u3044\u3063\u305f\u30c7\u30d7\u30ed\u30a4\u7ba1\u7406\u306e\u4ed5\u7d44\u307f\u3092\u63d0\u4f9b\u3059\u308b\u3082\u306e\u3067\u3059\u3002\n\nDeployment \u306e\u4ed5\u7d44\u307f\n\u4e0b\u8a18\u306e\u56f3\u306e\u3088\u3046\u306bDeployment\u306fReplicaSet\u3092\u751f\u6210\u30fb\u7ba1\u7406\u3057\u3001ReplicaSet\u306fPod\u3092\u751f\u6210\u30fb\u7ba1\u7406\u3057\u307e\u3059\u3002\n\nReplicaSet(ReplicationController\u306e\u5f8c\u7d99)\u306fPodTemplate\u3068\u547c\u3070\u308c\u308bPod\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u3082\u3068\u306b\u3001Pod\u3092\u6307\u5b9a\u3055\u308c\u305f\u6570(\u30ec\u30d7\u30ea\u30ab\u6570)\u306b\u8abf\u6574\u30fb\u7ba1\u7406\u3092\u884c\u3046\u4ed5\u7d44\u307f\u3067\u3059\u3002Pod\u304c\u30ec\u30d7\u30ea\u30ab\u6570\u3088\u308a\u8db3\u308a\u306a\u3044\u5834\u5408\u306fPod\u3092\u8ffd\u52a0\u3057\u3001\u591a\u3044\u5834\u5408\u306f\u3092Pod\u3092\u524a\u9664\u3057\u307e\u3059\u3002\u3053\u306e\u4ed5\u7d44\u307f\u306b\u3088\u3063\u3066\u30ce\u30fc\u30c9\u306e\u969c\u5bb3\u3084\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u3067Pod\u304c\u8db3\u308a\u306a\u304f\u306a\u3063\u305f\u969b\u3082\u81ea\u52d5\u7684\u306bPod\u304c\u8ffd\u52a0\u3055\u308c\u3001\u30bb\u30eb\u30d5\u30d2\u30fc\u30ea\u30f3\u30b0\u304c\u5b9f\u73fe\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nDeployment\u306f\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u306a\u3069\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u304c\u3042\u3063\u305f\u5834\u5408\u3001\u65b0\u3057\u3044\u4ed5\u69d8\u306eReplicaSet\u3092\u4f5c\u6210\u3057\u3001\u65b0\u65e7\u306e\u5168\u4f53Pod\u6570\u3092\u8abf\u6574\u3057\u306a\u304c\u3089\u65b0\u3057\u3044\u4ed5\u69d8\u306ePod\u306b\u7f6e\u304d\u63db\u3048\u3066\u3044\u304d\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u304c\u5b9f\u73fe\u3055\u308c\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u30ec\u30d7\u30ea\u30ab\u6570\u306e\u307f\u5909\u66f4\u306e\u5834\u5408\u306f\u65b0\u3057\u3044ReplicaSet\u306f\u4f5c\u6210\u305b\u305a\u3001\u73fe\u5728\u306eReplicaSet\u306e\u30ec\u30d7\u30ea\u30ab\u6570\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\u65b0\u65e7\u306ePod\u3068\u3082\u306b\u5171\u901a\u3059\u308b\u30e9\u30d9\u30eb\u3092\u6301\u3063\u3066\u304a\u308a\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u4e2d\u306fService\u3092\u901a\u3057\u3066\u65b0\u65e7\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u6df7\u3056\u3063\u3066\u30b5\u30fc\u30d3\u30b9\u63d0\u4f9b\u3055\u308c\u308b\u5f62\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n\n\n\u30ea\u30bd\u30fc\u30b9\n\u5f79\u5272\n\n\n\n\nDeployment\n\nReplicaSet\u3092\u751f\u6210\u3001\u7ba1\u7406\u3057\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3084\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3068\u3044\u3063\u305f\u30c7\u30d7\u30ed\u30a4\u7ba1\u7406\u3092\u884c\u3044\u307e\u3059\u3002\n\n\nReplicaSet\n\u540c\u3058\u4ed5\u69d8\u306ePod\u306e\u30ec\u30d7\u30ea\u30ab\u6570\u3092\u7ba1\u7406\u3057\u307e\u3059\u3002ReplicationController\u306e\u5f8c\u7d99\u306b\u5f53\u305f\u308b\u3082\u306e\u3067\u3059\u3002\n\n\nPod\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u52d5\u304b\u3059\u305f\u3081\u306e\u6700\u5c0f\u5358\u4f4d\u30021\u3064\u4ee5\u4e0a\u306e\u30b3\u30f3\u30c6\u30ca\u3068\u5171\u6709\u3055\u308c\u305f\u30dc\u30ea\u30e5\u30fc\u30e0\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\u3002\n\n\n\n\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u304c\u7d42\u308f\u3063\u305f\u5f8c\u3082\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u524d\u306eReplicaSet\u306f\u4e00\u5b9a\u6570\u4fdd\u6301\u3055\u308c\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u304c\u53ef\u80fd\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\nDeployment \u306e\u5b9a\u7fa9\n\u4ee5\u4e0b\u306fDeployment\u306e\u5b9a\u7fa9\u4f8b\u306b\u306a\u308a\u307e\u3059\u3002\u4e0b\u8a18\u306e\u5185\u5bb9\u3092deployment-example.yaml\u3068\u3044\u3046\u540d\u524d\u3067\u4fdd\u5b58\u3057\u305f\u3068\u3057\u307e\u3059\u3002\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  # Deployment\u306e\u540d\u524d\u3002Namespace\u5185\u3067\u306f\u30e6\u30cb\u30fc\u30af\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\n  name: deployment-example\nspec:\n  # \u30ec\u30d7\u30ea\u30ab\u6570\u306e\u6307\u5b9a\n  replicas: 2\n  # Pod\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8(PodTemplate)\n  template:\n    metadata:\n      labels:\n        # \u30e9\u30d9\u30eb\u6307\u5b9a\u306f\u5fc5\u9808\n        app: deployment-example\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.10\n        ports:\n        - containerPort: 80\n\n.spec.template\u306fPodTemplate\u3068\u547c\u3070\u308c\u308bPod\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u306ePodTemplate\u3092\u3082\u3068\u306bReplicaSet\u304c\u30ec\u30d7\u30ea\u30ab\u6570\u5206\u306ePod\u3092\u751f\u6210\u30fb\u7ba1\u7406\u3057\u307e\u3059\u3002\u307e\u305fDeployment\u304c\u914d\u4e0b\u306eReplicaSet\u3068ReplicaSet\u304c\u7ba1\u7406\u3059\u308bPod\u3092\u7ba1\u7406\u3059\u308b\u305f\u3081\u306b\u30e9\u30d9\u30eb\u304c\u5fc5\u8981\u3068\u306a\u308a\u3001.spec.template.metadata.labels\u3067\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nDeployment \u306e\u30c7\u30d7\u30ed\u30a4\n\u5b9a\u7fa9\u3057\u305fDeployment\u3092\u30c7\u30d7\u30ed\u30a4\u3092\u3057\u3066\u307f\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u64cd\u4f5c\u5c65\u6b74\u3092\u6b8b\u3059\u305f\u3081\u306b--record\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u3066kubectl\u306e\u30b3\u30de\u30f3\u30c9\u3092\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u306b\u4fdd\u5b58\u3059\u308b\u3088\u3046\u306b\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n$ kubectl create -f deployment-example.yaml --record\ndeployment \"deployment-example\" created\n\n\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u305f\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n$ kubectl get deployments\nNAME                 DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\ndeployment-example   2         2         2            2           22m\n\n--selector\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u8a2d\u5b9a\u3057\u305f\u30e9\u30d9\u30eb\u3092\u6307\u5b9a\u3057\u3066\u95a2\u9023\u30ea\u30bd\u30fc\u30b9\u3092\u898b\u3066\u307e\u3059\u3002\n$ kubectl get deployments,replicasets,pods --selector app=deployment-example\nNAME                        DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\ndeploy/deployment-example   2         2         2            2           30s\n\nNAME                               DESIRED   CURRENT   READY     AGE\nrs/deployment-example-2748039730   2         2         2         30s\n\nNAME                                     READY     STATUS    RESTARTS   AGE\npo/deployment-example-2748039730-k5c5j   1/1       Running   0          30s\npo/deployment-example-2748039730-p85gg   1/1       Running   0          30s\n\n\nDeployment \u306e\u5909\u66f4\n\u6b21\u306bDeployment\u306e\u60c5\u5831\u3092\u5909\u66f4\u3057\u3066\u307f\u307e\u3059\u3002\u3053\u3053\u3067\u306f nginx \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u5909\u66f4\u3057\u3066\u307f\u307e\u3059\u3002\u5148\u7a0b\u306edeployment-example.yaml\u3092\u7de8\u96c6\u3057\u3001nginx \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092 1.11 \u306b\u3057\u3066\u307f\u307e\u3059\u3002\n# \u7701\u7565...\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.11 # 1.10\u304b\u30891.11\u306b\u5909\u66f4\n        ports:\n        - containerPort: 80\n\n\u5909\u66f4\u3092\u53cd\u6620\u3055\u305b\u307e\u3059\u3002\n$ kubectl apply -f deployment-example.yaml --record\ndeployment \"deployment-example\" configured\n\n\u5909\u66f4\u3055\u308c\u305f\u304b\u898b\u3066\u307f\u307e\u3059\u3002\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3067\u65b0\u65e7\u306ePod\u306e\u6570\u3092\u8abf\u6574\u3057\u306a\u304c\u3089\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3055\u308c\u3066\u3044\u304d\u307e\u3059\u3002\n$ kubectl get deployments,replicasets,pods --selector app=deployment-example\nNAME                        DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\ndeploy/deployment-example   2         2         2            2           7m\n\nNAME                               DESIRED   CURRENT   READY     AGE\nrs/deployment-example-2748039730   0         0         0         7m     # \u53e4\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u306eReplicaSet\u3002\u30ec\u30d7\u30ea\u30ab\u6570\u304c0\u306b\nrs/deployment-example-2829304371   2         2         2         27s    # \u65b0\u3057\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u306eReplicaset\u3002\u30ec\u30d7\u30ea\u30ab\u6570\u304c2\u306b\n\nNAME                                     READY     STATUS    RESTARTS   AGE\npo/deployment-example-2829304371-33x2x   1/1       Running   0          27s # Pod\u306f\u518d\u751f\u6210\u3055\u308c\u308b\npo/deployment-example-2829304371-szbxm   1/1       Running   0          27s\n\n\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u4e2d\u306f\u4e0b\u8a18\u306e\u56f3\u306e\u3088\u3046\u306a\u72b6\u614b\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u304c\u7d42\u308f\u3063\u3066\u3082\u53e4\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u306eReplicaSet\u306f\u5c65\u6b74\u7ba1\u7406\u306e\u305f\u3081\u306b\u6b8b\u308a\u307e\u3059\u3002\n\nPod\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u65b0\u3057\u304f\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n$ kubectl describe pods --selector=app=deployment-example\n...\nControllers:    ReplicaSet/deployment-example-2829304371\nContainers:\n  nginx:\n    Container ID:       docker://a7adf603e653826d4092d8b1340f985584767080c47a5d23895c438ed5d4d813\n    Image:              nginx:1.11 # \u30b3\u30f3\u30c6\u30ca\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u65b0\u3057\u304f\u306a\u3063\u3066\u3044\u308c\u3070\u6210\u529f\n    Image ID:           docker://sha256:01f818af747d88b4ebca7cdabd0c581e406e0e790be72678d257735fad84a15f\n    Port:               80/TCP\n...\n\n\n\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\nDeployment\u306e\u7279\u5fb4\u306b\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u304c\u3042\u308a\u307e\u3059\u3002\u30c7\u30d7\u30ed\u30a4\u306e\u5c65\u6b74\u3092\u898b\u3066\u307f\u307e\u3059\u3002\n$  kubectl rollout history deployment deployment-example\ndeployments \"deployment-example\"\nREVISION        CHANGE-CAUSE\n1               kubectl create -f deployment-example.yaml --record\n2               kubectl apply -f deployment-example.yaml --record\n\n\u30ea\u30d3\u30b8\u30e7\u30f3\u306e\u8a73\u7d30\u306f\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n$ kubectl rollout history deployment deployment-example --revision=2\ndeployments \"deployment-example\" with revision #2\n  Labels:       app=deployment-example\n        pod-template-hash=2829304371\n  Annotations:  kubernetes.io/change-cause=kubectl apply -f deployment-example.yaml --record\n  Containers:\n   nginx:\n    Image:      nginx:1.11\n    Port:       80/TCP\n    Volume Mounts:      <none>\n    Environment Variables:      <none>\n  No volumes.\n\n\u30ea\u30d3\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u3066\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3057\u3066\u307f\u307e\u3059\u3002--to-revision\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u76f4\u524d\u306e\u30ea\u30d3\u30b8\u30e7\u30f3\u306b\u306a\u308a\u307e\u3059\u3002\n$ kubectl rollout undo deployment deployment-example --to-revision=1\ndeployment \"deployment-example\" rolled back\n\nnginx \u30b3\u30f3\u30c6\u30ca\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c 1.11 \u304b\u3089 1.10 \u306b\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u307e\u3067\u5c11\u3057\u6642\u9593\u304c\u304b\u304b\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\n$ kubectl describe pods --selector=app=deployment-example\n...\nContainers:\n  nginx:\n    Container ID:       docker://fae4d04753243119bf5840fefd820353766eddfd9dd75a628ea1e56673cf3828\n    Image:              nginx:1.10  # 1.10\u306b\u623b\u3063\u3066\u3044\u308b\n    Image ID:           docker://sha256:c2d83d8cde8d6b13e774170f85d87829736e6614a8be33479bb7f8bd7f12dd06\n    Port:               80/TCP\n\n\u30c7\u30d7\u30ed\u30a4\u306e\u5c65\u6b74\u3092\u898b\u3066\u307f\u307e\u3059\u3002\u30ea\u30d3\u30b8\u30e7\u30f31\u306e\u884c\u304c\u306a\u304f\u306a\u308a\u3001\u30ea\u30d3\u30b8\u30e7\u30f33(\u6700\u65b0)\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n$ kubectl rollout history deployment deployment-example\ndeployments \"deployment-example\"\nREVISION        CHANGE-CAUSE\n2               kubectl apply -f deployment-example.yaml --record\n3               kubectl create -f deployment-example.yaml --record # 1\u304b\u30893(\u6700\u65b0)\u306b\u5909\u66f4\u3055\u308c\u305f\n\n\u306a\u304a\u30c7\u30d7\u30ed\u30a4\u306e\u5c65\u6b74\u306f\u5185\u90e8\u7684\u306b\u306f\u904e\u53bb\u306eReplicaSet\u3067\u7ba1\u7406\u3055\u308c\u3066\u304a\u308a\u3001\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u306f\u904e\u53bb\u306eReplicaSet\u306e\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u3067\u884c\u308f\u308c\u3066\u3044\u307e\u3059\u3002\u30ea\u30d3\u30b8\u30e7\u30f3\u3084\u30b3\u30de\u30f3\u30c9\u306e\u5c65\u6b74\u3068\u3044\u3063\u305f\u60c5\u5831\u306fReplicaSet\u306e\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3068\u3057\u3066\u4fdd\u5b58\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\n\u88dc\u8db3: Deployment \u306e\u30e9\u30d9\u30eb\nDeployment\u3067\u306fspec.template.metadata.labels\u8a2d\u5b9a\u3057\u305f\u30e9\u30d9\u30eb\u304c\u81ea\u52d5\u7684\u306bDeployment\u306e\u30bb\u30ec\u30af\u30bf(.spec.selector.matchLabels)\u306b\u8a2d\u5b9a\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n$ kubectl get deployment deployment-example -o yaml\napiVersion: extensions/v1beta1\nkind: Deployment\n...\nspec:\n  replicas: 2\n  selector:\n    # \u81ea\u52d5\u7684\u306b\u8a2d\u5b9a\u3055\u308c\u308b\n    matchLabels:\n      app: deployment-example\n  ...\n  template:\n    metadata:\n      creationTimestamp: null\n      labels:\n        # \u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u3067\u8a2d\u5b9a\u3057\u305f\u5024\n        app: deployment-example\n...\n\nDeployment\u306espec.template.metadata.labels\u306e\u5024\u306fReplicaSet\u306e\u30e9\u30d9\u30eb\u3068\u30bb\u30ec\u30af\u30bf\u306e\u4e00\u90e8\u3068Pod\u306e\u30e9\u30d9\u30eb\u306b\u4f7f\u308f\u308c\u3066\u3044\u307e\u3059\u3002\u307e\u305fReplicaSet\u3054\u3068\u306b\u914d\u4e0b\u306ePod\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u306bpod-template-hash\u3068\u3044\u3046PodTemplate\u304b\u3089\u751f\u6210\u3057\u305f\u30cf\u30c3\u30b7\u30e5\u5024\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002\n$ kubectl get replicaset -l app=deployment-example -o yaml\n...\n- apiVersion: extensions/v1beta1\n  kind: ReplicaSet\n  spec:\n    replicas: 2\n    selector:\n      # \u3053\u306e\u30bb\u30ec\u30af\u30bf\u3067Pod\u3092\u9078\u629e\u3059\u308b\n      matchLabels:\n        # deployment\u3067\u6307\u5b9a\u3057\u305f\u30e9\u30d9\u30eb\n        app: deployment-example\n        # Pod\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u306ePodTemplate\u304b\u3089\u4f5c\u3089\u308c\u305f\u30cf\u30c3\u30b7\u30e5\u5024\n        pod-template-hash: \"2748039730\"\n    template:\n      metadata:\n        creationTimestamp: null\n        labels:\n          # \u30bb\u30ec\u30af\u30bf\u3068\u540c\u3058\u5024\n          app: deployment-example\n          pod-template-hash: \"2748039730\"\n\nPod\u306eReplicaSet\u304c\u6301\u3064\u30bb\u30ec\u30af\u30bf\u3068\u540c\u3058\u30e9\u30d9\u30eb\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n$ kubectl get pods -l app=deployment-example -o yaml\n...\n- apiVersion: v1\n  kind: Pod\n  metadata:\n   ...\n    labels:\n      app: deployment-example\n      pod-template-hash: \"2748039730\"\n\n\u4e0b\u8a18\u306e\u56f3\u3067\u306fDeployment\u306espec.template.metadata.labels\u304capp=myapp\u3060\u3063\u305f\u5834\u5408\u306e\u30e9\u30d9\u30eb\u306e\u4ed8\u3051\u65b9\u3092\u8aac\u660e\u3057\u3066\u3044\u307e\u3059\u3002\u65b0\u65e7\u306ePod\u3068\u3082\u306b\u5171\u901a\u306eapp=myapp\u3068\u3044\u3046\u30e9\u30d9\u30eb\u304c\u3042\u308b\u305f\u3081\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u4e2d\u3082Service\u3092\u901a\u3057\u3066\u65ad\u7d9a\u306a\u304f\u30b5\u30fc\u30d3\u30b9\u63d0\u4f9b\u3067\u304d\u3001\u65b0\u65e7\u3067\u7570\u306a\u308bpod-template-hash\u3068\u3044\u3046\u30e9\u30d9\u30eb\u304c\u3042\u308b\u305f\u3081\u500b\u5225\u306b\u3082\u7ba1\u7406\u3067\u304d\u308b\u4ed5\u7d44\u307f\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\n\u307e\u3068\u3081\n\n\nDeployment\u306f\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3084\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3068\u3044\u3063\u305f\u30c7\u30d7\u30ed\u30a4\u7ba1\u7406\u306e\u4ed5\u7d44\u307f\u3092\u63d0\u4f9b\u3057\u307e\u3059\n\u540c\u3058\u4ed5\u69d8\u306ePod\u3092\u7ba1\u7406\u3059\u308bReplicaSet\u3068\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u52d5\u4f5c\u3055\u305b\u308b\u6700\u5c0f\u5358\u4f4d\u306ePod\u3067\u69cb\u6210\u3055\u308c\u3066\u3044\u307e\u3059\n\u5c65\u6b74\u304c\u7ba1\u7406\u3055\u308c\u3066\u304a\u308a\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u304c\u53ef\u80fd\u3067\u3059\n\n\n\u53c2\u8003\n\nhttps://kubernetes.io/docs/user-guide/deployments/\nhttps://kubernetes.io/docs/user-guide/replicasets/\n\n\u3053\u306e\u8a18\u4e8b\u306f Kubernetes 1.5.2 \u3067\u78ba\u8a8d\u3057\u305f\u60c5\u5831\u3092\u5143\u306b\u8a18\u8f09\u3057\u3066\u3044\u307e\u3059\u3002\n\n# Deployment\n\n`Deployment`\u306f\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3084\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3068\u3044\u3063\u305f\u30c7\u30d7\u30ed\u30a4\u7ba1\u7406\u306e\u4ed5\u7d44\u307f\u3092\u63d0\u4f9b\u3059\u308b\u3082\u306e\u3067\u3059\u3002\n\n## Deployment \u306e\u4ed5\u7d44\u307f\n\n\u4e0b\u8a18\u306e\u56f3\u306e\u3088\u3046\u306b`Deployment`\u306f`ReplicaSet`\u3092\u751f\u6210\u30fb\u7ba1\u7406\u3057\u3001`ReplicaSet`\u306f`Pod`\u3092\u751f\u6210\u30fb\u7ba1\u7406\u3057\u307e\u3059\u3002\n\n<img src=\"https://qiita-image-store.s3.amazonaws.com/0/100377/03f4ff76-9408-256e-c019-645ab77f8b09.png\" width=\"572\">\n\n`ReplicaSet`(`ReplicationController`\u306e\u5f8c\u7d99)\u306f[`PodTemplate`](https://kubernetes.io/docs/api-reference/v1/definitions/#_v1_podtemplate)\u3068\u547c\u3070\u308c\u308b`Pod`\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u3082\u3068\u306b\u3001`Pod`\u3092\u6307\u5b9a\u3055\u308c\u305f\u6570(\u30ec\u30d7\u30ea\u30ab\u6570)\u306b\u8abf\u6574\u30fb\u7ba1\u7406\u3092\u884c\u3046\u4ed5\u7d44\u307f\u3067\u3059\u3002`Pod`\u304c\u30ec\u30d7\u30ea\u30ab\u6570\u3088\u308a\u8db3\u308a\u306a\u3044\u5834\u5408\u306f`Pod`\u3092\u8ffd\u52a0\u3057\u3001\u591a\u3044\u5834\u5408\u306f\u3092`Pod`\u3092\u524a\u9664\u3057\u307e\u3059\u3002\u3053\u306e\u4ed5\u7d44\u307f\u306b\u3088\u3063\u3066\u30ce\u30fc\u30c9\u306e\u969c\u5bb3\u3084\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u3067`Pod`\u304c\u8db3\u308a\u306a\u304f\u306a\u3063\u305f\u969b\u3082\u81ea\u52d5\u7684\u306b`Pod`\u304c\u8ffd\u52a0\u3055\u308c\u3001\u30bb\u30eb\u30d5\u30d2\u30fc\u30ea\u30f3\u30b0\u304c\u5b9f\u73fe\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n`Deployment`\u306f\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u306a\u3069\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u304c\u3042\u3063\u305f\u5834\u5408\u3001\u65b0\u3057\u3044\u4ed5\u69d8\u306e`ReplicaSet`\u3092\u4f5c\u6210\u3057\u3001\u65b0\u65e7\u306e\u5168\u4f53`Pod`\u6570\u3092\u8abf\u6574\u3057\u306a\u304c\u3089\u65b0\u3057\u3044\u4ed5\u69d8\u306e`Pod`\u306b\u7f6e\u304d\u63db\u3048\u3066\u3044\u304d\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u304c\u5b9f\u73fe\u3055\u308c\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u30ec\u30d7\u30ea\u30ab\u6570\u306e\u307f\u5909\u66f4\u306e\u5834\u5408\u306f\u65b0\u3057\u3044`ReplicaSet`\u306f\u4f5c\u6210\u305b\u305a\u3001\u73fe\u5728\u306e`ReplicaSet`\u306e\u30ec\u30d7\u30ea\u30ab\u6570\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\u65b0\u65e7\u306e`Pod`\u3068\u3082\u306b\u5171\u901a\u3059\u308b\u30e9\u30d9\u30eb\u3092\u6301\u3063\u3066\u304a\u308a\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u4e2d\u306f`Service`\u3092\u901a\u3057\u3066\u65b0\u65e7\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u6df7\u3056\u3063\u3066\u30b5\u30fc\u30d3\u30b9\u63d0\u4f9b\u3055\u308c\u308b\u5f62\u306b\u306a\u308a\u307e\u3059\u3002\n\n<img src=\"https://qiita-image-store.s3.amazonaws.com/0/100377/adb7acb1-72ef-5765-77bd-fae9d9c5cc09.png\" width=\"777\">\n\n\u30ea\u30bd\u30fc\u30b9 | \u5f79\u5272\n--- | ---\n`Deployment` | `ReplicaSet`\u3092\u751f\u6210\u3001\u7ba1\u7406\u3057\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3084\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3068\u3044\u3063\u305f\u30c7\u30d7\u30ed\u30a4\u7ba1\u7406\u3092\u884c\u3044\u307e\u3059\u3002\n`ReplicaSet` | \u540c\u3058\u4ed5\u69d8\u306e`Pod`\u306e\u30ec\u30d7\u30ea\u30ab\u6570\u3092\u7ba1\u7406\u3057\u307e\u3059\u3002`ReplicationController`\u306e\u5f8c\u7d99\u306b\u5f53\u305f\u308b\u3082\u306e\u3067\u3059\u3002\n`Pod`        | \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u52d5\u304b\u3059\u305f\u3081\u306e\u6700\u5c0f\u5358\u4f4d\u30021\u3064\u4ee5\u4e0a\u306e\u30b3\u30f3\u30c6\u30ca\u3068\u5171\u6709\u3055\u308c\u305f\u30dc\u30ea\u30e5\u30fc\u30e0\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\u3002\n\n\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u304c\u7d42\u308f\u3063\u305f\u5f8c\u3082\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u524d\u306e`ReplicaSet`\u306f\u4e00\u5b9a\u6570\u4fdd\u6301\u3055\u308c\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u304c\u53ef\u80fd\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n<img src=\"https://qiita-image-store.s3.amazonaws.com/0/100377/050b6a40-fcb0-610f-1c9f-a753ad124d36.png\" width=\"774\">\n\n## Deployment \u306e\u5b9a\u7fa9\n\n\u4ee5\u4e0b\u306f`Deployment`\u306e\u5b9a\u7fa9\u4f8b\u306b\u306a\u308a\u307e\u3059\u3002\u4e0b\u8a18\u306e\u5185\u5bb9\u3092`deployment-example.yaml`\u3068\u3044\u3046\u540d\u524d\u3067\u4fdd\u5b58\u3057\u305f\u3068\u3057\u307e\u3059\u3002\n\n```yaml\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  # Deployment\u306e\u540d\u524d\u3002Namespace\u5185\u3067\u306f\u30e6\u30cb\u30fc\u30af\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\n  name: deployment-example\nspec:\n  # \u30ec\u30d7\u30ea\u30ab\u6570\u306e\u6307\u5b9a\n  replicas: 2\n  # Pod\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8(PodTemplate)\n  template:\n    metadata:\n      labels:\n        # \u30e9\u30d9\u30eb\u6307\u5b9a\u306f\u5fc5\u9808\n        app: deployment-example\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.10\n        ports:\n        - containerPort: 80\n```\n\n`.spec.template`\u306f[`PodTemplate`](https://kubernetes.io/docs/api-reference/v1/definitions/#_v1_podtemplate)\u3068\u547c\u3070\u308c\u308b`Pod`\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u306e`PodTemplate`\u3092\u3082\u3068\u306b`ReplicaSet`\u304c\u30ec\u30d7\u30ea\u30ab\u6570\u5206\u306e`Pod`\u3092\u751f\u6210\u30fb\u7ba1\u7406\u3057\u307e\u3059\u3002\u307e\u305f`Deployment`\u304c\u914d\u4e0b\u306e`ReplicaSet`\u3068`ReplicaSet`\u304c\u7ba1\u7406\u3059\u308b`Pod`\u3092\u7ba1\u7406\u3059\u308b\u305f\u3081\u306b\u30e9\u30d9\u30eb\u304c\u5fc5\u8981\u3068\u306a\u308a\u3001`.spec.template.metadata.labels`\u3067\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n## Deployment \u306e\u30c7\u30d7\u30ed\u30a4\n\n\u5b9a\u7fa9\u3057\u305f`Deployment`\u3092\u30c7\u30d7\u30ed\u30a4\u3092\u3057\u3066\u307f\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u64cd\u4f5c\u5c65\u6b74\u3092\u6b8b\u3059\u305f\u3081\u306b`--record`\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u3066`kubectl`\u306e\u30b3\u30de\u30f3\u30c9\u3092\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u306b\u4fdd\u5b58\u3059\u308b\u3088\u3046\u306b\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n```bash\n$ kubectl create -f deployment-example.yaml --record\ndeployment \"deployment-example\" created\n```\n\n\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u305f\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n```bash\n$ kubectl get deployments\nNAME                 DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\ndeployment-example   2         2         2            2           22m\n```\n\n`--selector`\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u8a2d\u5b9a\u3057\u305f\u30e9\u30d9\u30eb\u3092\u6307\u5b9a\u3057\u3066\u95a2\u9023\u30ea\u30bd\u30fc\u30b9\u3092\u898b\u3066\u307e\u3059\u3002\n\n```bash\n$ kubectl get deployments,replicasets,pods --selector app=deployment-example\nNAME                        DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\ndeploy/deployment-example   2         2         2            2           30s\n\nNAME                               DESIRED   CURRENT   READY     AGE\nrs/deployment-example-2748039730   2         2         2         30s\n\nNAME                                     READY     STATUS    RESTARTS   AGE\npo/deployment-example-2748039730-k5c5j   1/1       Running   0          30s\npo/deployment-example-2748039730-p85gg   1/1       Running   0          30s\n```\n\n## Deployment \u306e\u5909\u66f4\n\n\u6b21\u306b`Deployment`\u306e\u60c5\u5831\u3092\u5909\u66f4\u3057\u3066\u307f\u307e\u3059\u3002\u3053\u3053\u3067\u306f nginx \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u5909\u66f4\u3057\u3066\u307f\u307e\u3059\u3002\u5148\u7a0b\u306e`deployment-example.yaml`\u3092\u7de8\u96c6\u3057\u3001nginx \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092 1.11 \u306b\u3057\u3066\u307f\u307e\u3059\u3002\n\n```yaml\n# \u7701\u7565...\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.11 # 1.10\u304b\u30891.11\u306b\u5909\u66f4\n        ports:\n        - containerPort: 80\n```\n\n\u5909\u66f4\u3092\u53cd\u6620\u3055\u305b\u307e\u3059\u3002\n\n```bash\n$ kubectl apply -f deployment-example.yaml --record\ndeployment \"deployment-example\" configured\n```\n\n\u5909\u66f4\u3055\u308c\u305f\u304b\u898b\u3066\u307f\u307e\u3059\u3002\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3067\u65b0\u65e7\u306e`Pod`\u306e\u6570\u3092\u8abf\u6574\u3057\u306a\u304c\u3089\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3055\u308c\u3066\u3044\u304d\u307e\u3059\u3002\n\n```bash\n$ kubectl get deployments,replicasets,pods --selector app=deployment-example\nNAME                        DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\ndeploy/deployment-example   2         2         2            2           7m\n\nNAME                               DESIRED   CURRENT   READY     AGE\nrs/deployment-example-2748039730   0         0         0         7m     # \u53e4\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u306eReplicaSet\u3002\u30ec\u30d7\u30ea\u30ab\u6570\u304c0\u306b\nrs/deployment-example-2829304371   2         2         2         27s    # \u65b0\u3057\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u306eReplicaset\u3002\u30ec\u30d7\u30ea\u30ab\u6570\u304c2\u306b\n\nNAME                                     READY     STATUS    RESTARTS   AGE\npo/deployment-example-2829304371-33x2x   1/1       Running   0          27s # Pod\u306f\u518d\u751f\u6210\u3055\u308c\u308b\npo/deployment-example-2829304371-szbxm   1/1       Running   0          27s\n```\n\n\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u4e2d\u306f\u4e0b\u8a18\u306e\u56f3\u306e\u3088\u3046\u306a\u72b6\u614b\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u304c\u7d42\u308f\u3063\u3066\u3082\u53e4\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u306e`ReplicaSet`\u306f\u5c65\u6b74\u7ba1\u7406\u306e\u305f\u3081\u306b\u6b8b\u308a\u307e\u3059\u3002\n\n<img src=\"https://qiita-image-store.s3.amazonaws.com/0/100377/adb7acb1-72ef-5765-77bd-fae9d9c5cc09.png\" width=\"777\">\n\n\n`Pod`\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u65b0\u3057\u304f\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n```bash\n$ kubectl describe pods --selector=app=deployment-example\n...\nControllers:    ReplicaSet/deployment-example-2829304371\nContainers:\n  nginx:\n    Container ID:       docker://a7adf603e653826d4092d8b1340f985584767080c47a5d23895c438ed5d4d813\n    Image:              nginx:1.11 # \u30b3\u30f3\u30c6\u30ca\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u65b0\u3057\u304f\u306a\u3063\u3066\u3044\u308c\u3070\u6210\u529f\n    Image ID:           docker://sha256:01f818af747d88b4ebca7cdabd0c581e406e0e790be72678d257735fad84a15f\n    Port:               80/TCP\n...\n```\n\n## \u30ed\u30fc\u30eb\u30d0\u30c3\u30af\n\n`Deployment`\u306e\u7279\u5fb4\u306b\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u304c\u3042\u308a\u307e\u3059\u3002\u30c7\u30d7\u30ed\u30a4\u306e\u5c65\u6b74\u3092\u898b\u3066\u307f\u307e\u3059\u3002\n\n```bash\n$  kubectl rollout history deployment deployment-example\ndeployments \"deployment-example\"\nREVISION        CHANGE-CAUSE\n1               kubectl create -f deployment-example.yaml --record\n2               kubectl apply -f deployment-example.yaml --record\n```\n\n\u30ea\u30d3\u30b8\u30e7\u30f3\u306e\u8a73\u7d30\u306f\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n```bash\n$ kubectl rollout history deployment deployment-example --revision=2\ndeployments \"deployment-example\" with revision #2\n  Labels:       app=deployment-example\n        pod-template-hash=2829304371\n  Annotations:  kubernetes.io/change-cause=kubectl apply -f deployment-example.yaml --record\n  Containers:\n   nginx:\n    Image:      nginx:1.11\n    Port:       80/TCP\n    Volume Mounts:      <none>\n    Environment Variables:      <none>\n  No volumes.\n```\n\n\u30ea\u30d3\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u3066\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3057\u3066\u307f\u307e\u3059\u3002`--to-revision`\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u76f4\u524d\u306e\u30ea\u30d3\u30b8\u30e7\u30f3\u306b\u306a\u308a\u307e\u3059\u3002\n\n```bash\n$ kubectl rollout undo deployment deployment-example --to-revision=1\ndeployment \"deployment-example\" rolled back\n```\n\nnginx \u30b3\u30f3\u30c6\u30ca\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c 1.11 \u304b\u3089 1.10 \u306b\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u307e\u3067\u5c11\u3057\u6642\u9593\u304c\u304b\u304b\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\n\n```bash\n$ kubectl describe pods --selector=app=deployment-example\n...\nContainers:\n  nginx:\n    Container ID:       docker://fae4d04753243119bf5840fefd820353766eddfd9dd75a628ea1e56673cf3828\n    Image:              nginx:1.10  # 1.10\u306b\u623b\u3063\u3066\u3044\u308b\n    Image ID:           docker://sha256:c2d83d8cde8d6b13e774170f85d87829736e6614a8be33479bb7f8bd7f12dd06\n    Port:               80/TCP\n```\n\n\u30c7\u30d7\u30ed\u30a4\u306e\u5c65\u6b74\u3092\u898b\u3066\u307f\u307e\u3059\u3002\u30ea\u30d3\u30b8\u30e7\u30f31\u306e\u884c\u304c\u306a\u304f\u306a\u308a\u3001\u30ea\u30d3\u30b8\u30e7\u30f33(\u6700\u65b0)\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n```bash\n$ kubectl rollout history deployment deployment-example\ndeployments \"deployment-example\"\nREVISION        CHANGE-CAUSE\n2               kubectl apply -f deployment-example.yaml --record\n3               kubectl create -f deployment-example.yaml --record # 1\u304b\u30893(\u6700\u65b0)\u306b\u5909\u66f4\u3055\u308c\u305f\n```\n\n\u306a\u304a\u30c7\u30d7\u30ed\u30a4\u306e\u5c65\u6b74\u306f\u5185\u90e8\u7684\u306b\u306f\u904e\u53bb\u306e`ReplicaSet`\u3067\u7ba1\u7406\u3055\u308c\u3066\u304a\u308a\u3001\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u306f\u904e\u53bb\u306e`ReplicaSet`\u306e\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u3067\u884c\u308f\u308c\u3066\u3044\u307e\u3059\u3002\u30ea\u30d3\u30b8\u30e7\u30f3\u3084\u30b3\u30de\u30f3\u30c9\u306e\u5c65\u6b74\u3068\u3044\u3063\u305f\u60c5\u5831\u306f`ReplicaSet`\u306e\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3068\u3057\u3066\u4fdd\u5b58\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n<img src=\"https://qiita-image-store.s3.amazonaws.com/0/100377/050b6a40-fcb0-610f-1c9f-a753ad124d36.png\" width=\"774\">\n\n## \u88dc\u8db3: Deployment \u306e\u30e9\u30d9\u30eb\n\n`Deployment`\u3067\u306f`spec.template.metadata.labels`\u8a2d\u5b9a\u3057\u305f\u30e9\u30d9\u30eb\u304c\u81ea\u52d5\u7684\u306b`Deployment`\u306e\u30bb\u30ec\u30af\u30bf(`.spec.selector.matchLabels`)\u306b\u8a2d\u5b9a\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n```yaml\n$ kubectl get deployment deployment-example -o yaml\napiVersion: extensions/v1beta1\nkind: Deployment\n...\nspec:\n  replicas: 2\n  selector:\n    # \u81ea\u52d5\u7684\u306b\u8a2d\u5b9a\u3055\u308c\u308b\n    matchLabels:\n      app: deployment-example\n  ...\n  template:\n    metadata:\n      creationTimestamp: null\n      labels:\n        # \u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u3067\u8a2d\u5b9a\u3057\u305f\u5024\n        app: deployment-example\n...\n```\n\n`Deployment`\u306e`spec.template.metadata.labels`\u306e\u5024\u306f`ReplicaSet`\u306e\u30e9\u30d9\u30eb\u3068\u30bb\u30ec\u30af\u30bf\u306e\u4e00\u90e8\u3068`Pod`\u306e\u30e9\u30d9\u30eb\u306b\u4f7f\u308f\u308c\u3066\u3044\u307e\u3059\u3002\u307e\u305f`ReplicaSet`\u3054\u3068\u306b\u914d\u4e0b\u306e`Pod`\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u306b`pod-template-hash`\u3068\u3044\u3046`PodTemplate`\u304b\u3089\u751f\u6210\u3057\u305f\u30cf\u30c3\u30b7\u30e5\u5024\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002\n\n```yaml\n$ kubectl get replicaset -l app=deployment-example -o yaml\n...\n- apiVersion: extensions/v1beta1\n  kind: ReplicaSet\n  spec:\n    replicas: 2\n    selector:\n      # \u3053\u306e\u30bb\u30ec\u30af\u30bf\u3067Pod\u3092\u9078\u629e\u3059\u308b\n      matchLabels:\n        # deployment\u3067\u6307\u5b9a\u3057\u305f\u30e9\u30d9\u30eb\n        app: deployment-example\n        # Pod\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u306ePodTemplate\u304b\u3089\u4f5c\u3089\u308c\u305f\u30cf\u30c3\u30b7\u30e5\u5024\n        pod-template-hash: \"2748039730\"\n    template:\n      metadata:\n        creationTimestamp: null\n        labels:\n          # \u30bb\u30ec\u30af\u30bf\u3068\u540c\u3058\u5024\n          app: deployment-example\n          pod-template-hash: \"2748039730\"\n```\n\n`Pod`\u306e`ReplicaSet`\u304c\u6301\u3064\u30bb\u30ec\u30af\u30bf\u3068\u540c\u3058\u30e9\u30d9\u30eb\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```yaml\n$ kubectl get pods -l app=deployment-example -o yaml\n...\n- apiVersion: v1\n  kind: Pod\n  metadata:\n   ...\n    labels:\n      app: deployment-example\n      pod-template-hash: \"2748039730\"\n```\n\n\u4e0b\u8a18\u306e\u56f3\u3067\u306f`Deployment`\u306e`spec.template.metadata.labels`\u304c`app=myapp`\u3060\u3063\u305f\u5834\u5408\u306e\u30e9\u30d9\u30eb\u306e\u4ed8\u3051\u65b9\u3092\u8aac\u660e\u3057\u3066\u3044\u307e\u3059\u3002\u65b0\u65e7\u306e`Pod`\u3068\u3082\u306b\u5171\u901a\u306e`app=myapp`\u3068\u3044\u3046\u30e9\u30d9\u30eb\u304c\u3042\u308b\u305f\u3081\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u4e2d\u3082`Service`\u3092\u901a\u3057\u3066\u65ad\u7d9a\u306a\u304f\u30b5\u30fc\u30d3\u30b9\u63d0\u4f9b\u3067\u304d\u3001\u65b0\u65e7\u3067\u7570\u306a\u308b`pod-template-hash\u3068\u3044\u3046\u30e9\u30d9\u30eb\u304c\u3042\u308b\u305f\u3081\u500b\u5225\u306b\u3082\u7ba1\u7406`\u3067\u304d\u308b\u4ed5\u7d44\u307f\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n<img src=\"https://qiita-image-store.s3.amazonaws.com/0/100377/e817e2a7-000e-495d-924f-ad9ebf5190fc.png\" width=\"795\">\n\n## \u307e\u3068\u3081\n\n- `Deployment`\u306f\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3084\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3068\u3044\u3063\u305f\u30c7\u30d7\u30ed\u30a4\u7ba1\u7406\u306e\u4ed5\u7d44\u307f\u3092\u63d0\u4f9b\u3057\u307e\u3059\n- \u540c\u3058\u4ed5\u69d8\u306e`Pod`\u3092\u7ba1\u7406\u3059\u308b`ReplicaSet`\u3068\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u52d5\u4f5c\u3055\u305b\u308b\u6700\u5c0f\u5358\u4f4d\u306e`Pod`\u3067\u69cb\u6210\u3055\u308c\u3066\u3044\u307e\u3059\n- \u5c65\u6b74\u304c\u7ba1\u7406\u3055\u308c\u3066\u304a\u308a\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u304c\u53ef\u80fd\u3067\u3059\n\n## \u53c2\u8003\n\n- https://kubernetes.io/docs/user-guide/deployments/\n- https://kubernetes.io/docs/user-guide/replicasets/\n", "tags": ["kubernetes"]}