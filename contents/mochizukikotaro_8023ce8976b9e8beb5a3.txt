{"context": "\u4f8b\u3048\u3070\u3001\u305f\u3068\u3048\u3070\u3067\u3059\u3051\u3069\u6b21\u306e\u3088\u3046\u306a\u30c7\u30fc\u30bf\u3092\u3082\u3089\u3063\u305f\u3068\u3057\u307e\u3059\u3002\n\n\u3059\u308b\u3068\u3001\n\u3060\u3044\u305f\u3044\u6b21\u306e\u3088\u3046\u306b\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\n\u30bb\u30df\u30b3\u30ed\u30f3\u3067\u5206\u5272\u3057\u3066\n\u8981\u7d20\u3092\u30ab\u30a6\u30f3\u30c8\u3057\u3066\n\u30b0\u30e9\u30d5\u3092\u3064\u304f\u308b\n\n\u4e0a\u306e\u30b5\u30f3\u30d7\u30eb\u306f\u30ab\u30e9\u30e0\u304c3\u3064\u304f\u3089\u3044\u3067\u3059\u304c\u3001\u50d5\u304c\u3082\u3089\u3063\u305f\u30c7\u30fc\u30bf\u306f\u81a8\u5927\u3067\u3001\u4e00\u500b\u4e00\u500b\u3064\u304f\u308b\u306e\u304c\u5927\u5909\u305d\u3046\u3067\u3057\u305f\u306e\u3067\u3001Google App Script\u3092\u7528\u3044\u308b\u3053\u3068\u3067\u3001\u3010\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u305f\u3089\u81ea\u52d5\u3067\u3001\u30b7\u30fc\u30c8\u4f5c\u6210&\u30b0\u30e9\u30d5\u8868\u793a\u3011\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u65e9\u3059\u304e\u3066\u3001\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u3068\u601d\u3044\u307e\u3059\u304c\u3002\n\n [\u51e6\u7406\u30e1\u30cb\u30e5\u30fc] > [\u96c6\u8a08]\u3092\u30af\u30ea\u30c3\u30af\n \u30b7\u30fc\u30c8\u304c\uff13\u3064\u81ea\u52d5\u3067\u3067\u304d\u308b\n \u5404\u30b7\u30fc\u30c8\u3054\u3068\u306b\u6587\u5b57\u5217\u3092\u5206\u5272\u3057\u3066\u96c6\u8a08\u3057\u3066\u30b0\u30e9\u30d5\u3092\u8a2d\u7f6e\n\n\u3068\u3044\u3046\u6d41\u308c\u3067\u9032\u3093\u3067\u3044\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u30bd\u30fc\u30b9\u3092\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u8a2d\u7f6e\u3059\u308b\u3068\u52d5\u304d\u307e\u3059\u3002\n\u203b\u6025\u304e\u3067\u3064\u304f\u3063\u305f\u306e\u3067\u3001\u30bd\u30fc\u30b9\u306f\u6539\u5584\u306e\u4f59\u5730\u304c\u591a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nanalytics.gs\n\n/*\n\u30e1\u30cb\u30e5\u30fc\u306b\u8ffd\u52a0\n*/\nfunction onOpen() {\n  var ss = SpreadsheetApp.getActiveSpreadsheet();\n  var menu = [\n    {name: \"\u96c6\u8a08\", functionName: \"creatSheet\"}\n  ];\n  ss.addMenu(\"\u51e6\u7406\u30e1\u30cb\u30e5\u30fc\", menu);\n}\n\n\n/*\n\u5206\u6790\u5bfe\u8c61\u306e\u30ab\u30e9\u30e0\u5225\u306b\u30b7\u30fc\u30c8\u3092\u4f5c\u6210\u3002\u3055\u3089\u306b\u30b0\u30e9\u30d5\u4f5c\u6210\n*/\nfunction creatSheet() {\n  var ss = SpreadsheetApp.getActiveSpreadsheet();\n  var sheet = ss.getActiveSheet();\n  var lastColumn = sheet.getLastColumn();\n  var lastRow = sheet.getLastRow();\n\n  // \u5bfe\u8c61\u306e\u30ab\u30e9\u30e0\u3092\u914d\u5217\u3067\u6301\u3061\u305f\u3044.\n  var columnNames = [\n    '\u597d\u304d\u306a\u98df\u3079\u7269',\n    '\u5acc\u3044\u306a\u98df\u3079\u7269'\n  ];\n\n  // \u5bfe\u8c61\u30ab\u30e9\u30e0\u306ecolumn\u3092\u53d6\u5f97\u3059\u308b\u3002\n  var targetColumn = 0;  \n  for (i = 1; i <= lastColumn; i++) {\n    var range = sheet.getRange(1, i);\n    var columnName = range.getValue();    \n\n    var exists = columnNames.indexOf(columnName);\n\n    if (exists >= 0) {\n      Logger.log(i);\n      Logger.log(range.getValue());\n\n      targetRange = sheet.getRange(1, i, lastRow, 1);\n      var values = targetRange.getValues();\n\n      // \u5b58\u5728\u3057\u306a\u3051\u308c\u3070\u633f\u5165\n      if (!ss.getSheetByName(columnName)) {\n        ss.insertSheet(columnName);\n        targetSheet = ss.getSheetByName(columnName);  \n        for (j = 0; j < values.length; j++) {  \n          var range = targetSheet.getRange(j + 1, 1);\n          range.setValue(values[j]);    \n        }\n        createGraphBySheetName(columnName);\n      }\n    }\n  }  \n}\n\n\n/*\n\u30b0\u30e9\u30d5\u4f5c\u6210\n*/\nfunction createGraphBySheetName(sheetName) {\n  var ss = SpreadsheetApp.getActiveSpreadsheet();\n  var sheet = ss.getSheetByName(sheetName);\n  var lastRow = sheet.getLastRow();\n  var outputArr = {}\n  var outputKeyColumn = 4;\n  var outputValueColumn = outputKeyColumn + 1;\n\n  // \u96c6\u8a08\n  for (i = 2; i <= lastRow; i++) {\n    var range = sheet.getRange(i, 1);\n    var text = range.getValue();\n    var splitArr = text.split(\";\");\n\n    // \u30b9\u30d7\u30ea\u30c3\u30c8\u3057\u3066\u9023\u60f3\u914d\u5217\u306b\u3044\u308c\u308b\uff08\u5b58\u5728\u3059\u308c\u3070+1\u3001\u306a\u3051\u308c\u30701\u3092\u30bb\u30c3\u30c8\uff09\n    for (j = 0; j < splitArr.length; j++) {\n      var outputKey = splitArr[j];\n      if (outputArr[outputKey] == null) {\n       outputArr[outputKey] = 1;\n      } else {\n        outputArr[outputKey]++;\n      }\n    }  \n  }  \n\n  // \u30a2\u30a6\u30c8\u30d7\u30c3\u30c8\u306e\u8868\u793a\n  var outputKeyRange = sheet.getRange(1, outputKeyColumn);\n  var outputValueRange = sheet.getRange(1, outputValueColumn);\n  outputKeyRange.setValue(\"\u9805\u76ee\");\n  outputValueRange.setValue(\"count\");\n  var outputLabelRange = sheet.getRange(1, outputKeyColumn, 1, 2);\n  outputLabelRange.setBackground(\"yellow\");\n\n  var i = 2;\n  for (key in outputArr) {\n    var keyRange = sheet.getRange(i, outputKeyColumn);\n    var valueRange = sheet.getRange(i, outputValueColumn);\n    keyRange.setValue(key);\n    valueRange.setValue(outputArr[key]);\n    i++;   \n  }\n\n  // \u30bd\u30fc\u30c8\u3059\u308b\n  var height = Object.keys(outputArr).length;\n  var sortRange = sheet.getRange(2, outputKeyColumn, height + 1, 2);\n  sortRange.sort({column: outputValueColumn, ascending: false});\n\n  // \u30b0\u30e9\u30d5\u3092\u57cb\u3081\u8fbc\u3080\n  var chartRange = sheet.getRange(1, outputKeyColumn, height + 1, 2);\n  var chartBuilder = sheet.newChart();\n  chartBuilder.addRange(chartRange)\n  .setChartType(Charts.ChartType.PIE)\n  .setOption('title', 'My Chart!')\n  .setPosition(1, outputValueColumn + 1, 20, 20); \n  sheet.insertChart(chartBuilder.build());\n}\n\n\n\u4ee5\u4e0a\u3067\u3059\u3002\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f\u3002\n\u4f8b\u3048\u3070\u3001\u305f\u3068\u3048\u3070\u3067\u3059\u3051\u3069\u6b21\u306e\u3088\u3046\u306a\u30c7\u30fc\u30bf\u3092\u3082\u3089\u3063\u305f\u3068\u3057\u307e\u3059\u3002\n\n<img width=\"624\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-03-31 15.33.48.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/45822/c9c451df-d84e-912b-cb00-795dc3ae2f22.png\">\n\n\n\u3059\u308b\u3068\u3001\n\n\u3060\u3044\u305f\u3044\u6b21\u306e\u3088\u3046\u306b\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n<img width=\"912\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-03-31 15.49.39.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/45822/30d55578-73a2-1388-0c83-a8867a0d3001.png\">\n\n- \u30bb\u30df\u30b3\u30ed\u30f3\u3067\u5206\u5272\u3057\u3066\n- \u8981\u7d20\u3092\u30ab\u30a6\u30f3\u30c8\u3057\u3066\n- \u30b0\u30e9\u30d5\u3092\u3064\u304f\u308b\n\n\u4e0a\u306e\u30b5\u30f3\u30d7\u30eb\u306f\u30ab\u30e9\u30e0\u304c3\u3064\u304f\u3089\u3044\u3067\u3059\u304c\u3001\u50d5\u304c\u3082\u3089\u3063\u305f\u30c7\u30fc\u30bf\u306f\u81a8\u5927\u3067\u3001\u4e00\u500b\u4e00\u500b\u3064\u304f\u308b\u306e\u304c\u5927\u5909\u305d\u3046\u3067\u3057\u305f\u306e\u3067\u3001Google App Script\u3092\u7528\u3044\u308b\u3053\u3068\u3067\u3001\u3010\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u305f\u3089\u81ea\u52d5\u3067\u3001\u30b7\u30fc\u30c8\u4f5c\u6210&\u30b0\u30e9\u30d5\u8868\u793a\u3011\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\n![gas_sample.gif](https://qiita-image-store.s3.amazonaws.com/0/45822/557b88c2-1ef1-15e5-9b35-20316bced408.gif)\n\n\n\u65e9\u3059\u304e\u3066\u3001\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u3068\u601d\u3044\u307e\u3059\u304c\u3002\n\n1.  [\u51e6\u7406\u30e1\u30cb\u30e5\u30fc] > [\u96c6\u8a08]\u3092\u30af\u30ea\u30c3\u30af\n2.  \u30b7\u30fc\u30c8\u304c\uff13\u3064\u81ea\u52d5\u3067\u3067\u304d\u308b\n3.  \u5404\u30b7\u30fc\u30c8\u3054\u3068\u306b\u6587\u5b57\u5217\u3092\u5206\u5272\u3057\u3066\u96c6\u8a08\u3057\u3066\u30b0\u30e9\u30d5\u3092\u8a2d\u7f6e\n\n\u3068\u3044\u3046\u6d41\u308c\u3067\u9032\u3093\u3067\u3044\u307e\u3059\u3002\n\n\n\u4ee5\u4e0b\u306e\u30bd\u30fc\u30b9\u3092\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u8a2d\u7f6e\u3059\u308b\u3068\u52d5\u304d\u307e\u3059\u3002\n\u203b\u6025\u304e\u3067\u3064\u304f\u3063\u305f\u306e\u3067\u3001\u30bd\u30fc\u30b9\u306f\u6539\u5584\u306e\u4f59\u5730\u304c\u591a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\n```js:analytics.gs\n\n/*\n\u30e1\u30cb\u30e5\u30fc\u306b\u8ffd\u52a0\n*/\nfunction onOpen() {\n  var ss = SpreadsheetApp.getActiveSpreadsheet();\n  var menu = [\n    {name: \"\u96c6\u8a08\", functionName: \"creatSheet\"}\n  ];\n  ss.addMenu(\"\u51e6\u7406\u30e1\u30cb\u30e5\u30fc\", menu);\n}\n\n\n/*\n\u5206\u6790\u5bfe\u8c61\u306e\u30ab\u30e9\u30e0\u5225\u306b\u30b7\u30fc\u30c8\u3092\u4f5c\u6210\u3002\u3055\u3089\u306b\u30b0\u30e9\u30d5\u4f5c\u6210\n*/\nfunction creatSheet() {\n  var ss = SpreadsheetApp.getActiveSpreadsheet();\n  var sheet = ss.getActiveSheet();\n  var lastColumn = sheet.getLastColumn();\n  var lastRow = sheet.getLastRow();\n  \n  // \u5bfe\u8c61\u306e\u30ab\u30e9\u30e0\u3092\u914d\u5217\u3067\u6301\u3061\u305f\u3044.\n  var columnNames = [\n    '\u597d\u304d\u306a\u98df\u3079\u7269',\n    '\u5acc\u3044\u306a\u98df\u3079\u7269'\n  ];\n  \n  // \u5bfe\u8c61\u30ab\u30e9\u30e0\u306ecolumn\u3092\u53d6\u5f97\u3059\u308b\u3002\n  var targetColumn = 0;  \n  for (i = 1; i <= lastColumn; i++) {\n    var range = sheet.getRange(1, i);\n    var columnName = range.getValue();    \n        \n    var exists = columnNames.indexOf(columnName);\n    \n    if (exists >= 0) {\n      Logger.log(i);\n      Logger.log(range.getValue());\n      \n      targetRange = sheet.getRange(1, i, lastRow, 1);\n      var values = targetRange.getValues();\n      \n      // \u5b58\u5728\u3057\u306a\u3051\u308c\u3070\u633f\u5165\n      if (!ss.getSheetByName(columnName)) {\n        ss.insertSheet(columnName);\n        targetSheet = ss.getSheetByName(columnName);  \n        for (j = 0; j < values.length; j++) {  \n          var range = targetSheet.getRange(j + 1, 1);\n          range.setValue(values[j]);    \n        }\n        createGraphBySheetName(columnName);\n      }\n    }\n  }  \n}\n\n\n/*\n\u30b0\u30e9\u30d5\u4f5c\u6210\n*/\nfunction createGraphBySheetName(sheetName) {\n  var ss = SpreadsheetApp.getActiveSpreadsheet();\n  var sheet = ss.getSheetByName(sheetName);\n  var lastRow = sheet.getLastRow();\n  var outputArr = {}\n  var outputKeyColumn = 4;\n  var outputValueColumn = outputKeyColumn + 1;\n\n  // \u96c6\u8a08\n  for (i = 2; i <= lastRow; i++) {\n    var range = sheet.getRange(i, 1);\n    var text = range.getValue();\n    var splitArr = text.split(\";\");\n      \n    // \u30b9\u30d7\u30ea\u30c3\u30c8\u3057\u3066\u9023\u60f3\u914d\u5217\u306b\u3044\u308c\u308b\uff08\u5b58\u5728\u3059\u308c\u3070+1\u3001\u306a\u3051\u308c\u30701\u3092\u30bb\u30c3\u30c8\uff09\n    for (j = 0; j < splitArr.length; j++) {\n      var outputKey = splitArr[j];\n      if (outputArr[outputKey] == null) {\n       outputArr[outputKey] = 1;\n      } else {\n        outputArr[outputKey]++;\n      }\n    }  \n  }  \n  \n  // \u30a2\u30a6\u30c8\u30d7\u30c3\u30c8\u306e\u8868\u793a\n  var outputKeyRange = sheet.getRange(1, outputKeyColumn);\n  var outputValueRange = sheet.getRange(1, outputValueColumn);\n  outputKeyRange.setValue(\"\u9805\u76ee\");\n  outputValueRange.setValue(\"count\");\n  var outputLabelRange = sheet.getRange(1, outputKeyColumn, 1, 2);\n  outputLabelRange.setBackground(\"yellow\");\n  \n  var i = 2;\n  for (key in outputArr) {\n    var keyRange = sheet.getRange(i, outputKeyColumn);\n    var valueRange = sheet.getRange(i, outputValueColumn);\n    keyRange.setValue(key);\n    valueRange.setValue(outputArr[key]);\n    i++;   \n  }\n  \n  // \u30bd\u30fc\u30c8\u3059\u308b\n  var height = Object.keys(outputArr).length;\n  var sortRange = sheet.getRange(2, outputKeyColumn, height + 1, 2);\n  sortRange.sort({column: outputValueColumn, ascending: false});\n  \n  // \u30b0\u30e9\u30d5\u3092\u57cb\u3081\u8fbc\u3080\n  var chartRange = sheet.getRange(1, outputKeyColumn, height + 1, 2);\n  var chartBuilder = sheet.newChart();\n  chartBuilder.addRange(chartRange)\n  .setChartType(Charts.ChartType.PIE)\n  .setOption('title', 'My Chart!')\n  .setPosition(1, outputValueColumn + 1, 20, 20); \n  sheet.insertChart(chartBuilder.build());\n}\n```\n\n\u4ee5\u4e0a\u3067\u3059\u3002\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f\u3002\n", "tags": ["GoogleAppsScript"]}