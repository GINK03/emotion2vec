{"context": " More than 1 year has passed since last update.\n\n\u6982\u8981\n\u30c7\u30fc\u30bf\u30af\u30ec\u30f3\u30b8\u30f3\u30b0\u306e\u58c1\u306b\u6253\u3061\u3072\u3057\u304c\u308c\u3064\u3064\u3001\u3067\u304d\u308b\u3053\u3068\u3092\u3084\u308a\u307e\u3059\u3002\nR\u3067\u30b3\u30fc\u30c9\u9032\u884c\u3092\u4e01\u5be7\u4e01\u5be7\u4e01\u5be7\u306b\u53ef\u8996\u5316\u3057\u3066\u307f\u308b\uff08Level 1\uff09\u306e\u7d9a\u304d\u3067\u3059\u3002\n\n\u8ab2\u984c\u5bfe\u5fdc\n\n\u6210\u5206\u304b\u3089\u66f2\u306e\u9006\u5f15\u304d\u304c\u3057\u305f\u3044\n\u305d\u306e\u307e\u3093\u307e\u3067\u3059\u3002\u3053\u308c\u3082\u3001Shiny + Qlik Sense\u3092\u4f7f\u3048\u3070\u89e3\u6c7a\u3059\u308b\u306e\u3067\u3001Level 2\u3067\u3084\u308a\u305f\u3044\u3068\u3053\u308d\u3067\u3059\u3002\n\n\u306a\u3093\u3066\u3044\u3046\u3053\u3068\u3092\u66f8\u3044\u3066\u3044\u307e\u3057\u305f\u3002\u3068\u308a\u3042\u3048\u305a\u3053\u308c\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002\n\u3082\u3046\u3061\u3087\u3063\u3068\u304d\u308c\u3044\u306b\u3057\u3066\u304b\u3089\u304b\u306a\u30fc\u3068\u601d\u3063\u3066\u3001GitHub\u306b\u306fPush\u3057\u3066\u3044\u307e\u305b\u3093\u304c\u3001\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u306eShiny\u3092\u5c11\u3057\u4e0a\u7b49\u306b\u3057\u307e\u3057\u305f\u3002\u30bd\u30fc\u30b9\u306f\u6700\u5f8c\u306b\u3042\u308a\u307e\u3059\u3002\n\n\u96f0\u56f2\u6c17\n\u524d\u56de\u3001\u53d6\u5f97\u3057\u305f\u30c7\u30fc\u30bf\u3092\u5b9f\u306fcsv\u3068\u3057\u3066\u4fdd\u5b58\u3057\u3066\u3044\u305f\u306e\u3067\u3001\u3053\u308c\u3092\u305d\u306e\u307e\u307eQlik Sense\u306b\u8aad\u307f\u8fbc\u307e\u305b\u307e\u3059\u3002\n\n\u5de6\u5074\u306etitle\u3068\u304bbefore\u3068\u304b\u3092\u9078\u629e\u3059\u308b\u3068\u3001\u5f53\u7136\u3067\u3059\u304c\u7d5e\u308a\u8fbc\u307e\u308c\u307e\u3059\u3002\n\u3053\u308c\u3001\u975e\u5e38\u306b\u6b8b\u5ff5\u306a\u306e\u304c\u3001\u306a\u305c\u304bmermaid.js(DiagrammeR)\u306e\u77e2\u5370\u304c\u51fa\u306a\u3044\u3093\u3067\u3059\u3088\u306d\u3002\u3002\u3002Opera\u3067\u3084\u3063\u3066\u3082\u30c0\u30e1\u3067\u3057\u305f\u3002\u306a\u305c\u3060\u308d\u3046\u30fc\u3002R\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c3.1.3\u3060\u304b\u3089\u306a\u306e\u3060\u308d\u3046\u304b\u3002\n\u3081\u3052\u305a\u306b\u691c\u7d22\u3057\u307e\u3059\u3002\u4e2d\u592e\u306e\u5cf6\u306eF#7sus4\u3001\u304a\u524d\u306f\u3060\u308c\u3060\u30fc\u3002\n\n\n\u30e2\u30ce\u30af\u30ed\u30c8\u30a6\u30ad\u30e7\u30fc\u3067\u3057\u305f\u3002\u30e2\u30ce\u30af\u30ed\u30c8\u30a6\u30ad\u30e7\u30fc\u4ee5\u5916\u306b\u306f\u3044\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u4e00\u66f2\u3060\u3051\u3067\u5cf6\u3092\u4f5c\u3063\u3066\u3057\u307e\u3046\u3068\u306f\u3002\u3002\u3002\u3082\u3046\u3061\u3087\u3063\u3068\u3001support\u306e\u8003\u3048\u65b9\u3092\u898b\u76f4\u3057\u305f\u65b9\u304c\u3088\u3044\u306e\u304b\u3002\u66f2\u6570\u306e\u6982\u5ff5\u3092\u5165\u308c\u308b\u3068\u304b\u3002\n\u6c17\u3092\u53d6\u308a\u76f4\u3057\u3066\u3001\u5f53\u7136\u3001\u5186\u30b0\u30e9\u30d5\u3067\u3082\u30c7\u30fc\u30bf\u3092\u9078\u629e\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u5186\u30b0\u30e9\u30d5\u3067D\u3092\u9078\u3076\u3068\u3001\u2026\n\n\u3053\u308c\u304c\u30b5\u30af\u30b5\u30af\u3067\u304d\u308b\u306e\u304c\u512a\u79c0\u3067\u3059\u3002\n\u3061\u306a\u307f\u306b\u3001D\u3092\u30b5\u30ab\u30ca\u30af\u30b7\u30e7\u30f3\u4ee5\u5916\u3067\u3082\u898b\u3066\u307f\u308b\u3068\u3001\u2026\uff08confidence\u3092\u9ad8\u304f\u3057\u307e\u3057\u305f\uff09\n\n\u30b5\u30ab\u30ca\u30af\u30b7\u30e7\u30f3\u306b\u306fD\u2192A\u3068\u3044\u3046\u6d41\u308c\u306f\u7121\u3044\u3067\u3059\u304c\u3001D\u2192A\u304c\u7d50\u69cb\u3042\u308a\u307e\u3059\u306d\u3002\u305d\u308a\u3083\u305d\u3046\u304b\u30fc\u3002\n\n\u3056\u3093\u306d\u3093\u306a\u306f\u306a\u3057\n\u3055\u3066\u3001\u3082\u3046\u4e00\u3064\u3001Qlik Sense\u3092\u4f7f\u3048\u3070\u3059\u3050\u306b\u89e3\u6c7a\u3067\u304d\u308b\u306f\u305a\u306e\u8ab2\u984c\u304c\u3042\u3063\u3066\u3001\n\n\u5e74\u4ee3\u3084\u305d\u306e\u4ed6\u6761\u4ef6\u5225\u306e\u5206\u6790\n\u7279\u306b\u5c0f\u7530\u548c\u6b63\u306e\u5834\u5408\u3001\u30aa\u30d5\u30b3\u30fc\u30b9\u306e\u6642\u4ee3\u3068\u4eca\u3067\u306f\u3060\u3044\u3076\u8272\u3005\u9055\u3046\u3068\u601d\u3046\u306e\u3067\u3001\u305f\u3068\u3048\u3070\u30ec\u30b3\u30fc\u30c9\u306e\u767a\u58f2\u6642\u671f\u3068\u304b\u3001\u30a2\u30eb\u30d0\u30e0\u304b\u30b7\u30f3\u30b0\u30eb\u304b\u3068\u304b\u3001\u305d\u3046\u3044\u3046\u30c7\u30fc\u30bf\u3092\u4ed8\u52a0\u3057\u3066\u898b\u308b\u3068\u9762\u767d\u3044\u3088\u3046\u306a\u6c17\u304c\u3057\u307e\u3059\u3002\n\n\u3053\u308c\u3001\u305d\u308c\u305e\u308c\u306e\u66f2\u306b\u5bfe\u3057\u3066\u767a\u58f2\u6642\u671f\u3092\u4ed8\u52a0\u3059\u308b\u3060\u3051\u306e\u7c21\u5358\u306a\u304a\u4ed5\u4e8b\u3092\u3059\u308c\u3070\u3001\u540c\u3058\u3088\u3046\u306b\u62bd\u51fa\u6761\u4ef6\u306b\u6307\u5b9a\u3067\u304d\u308b\u2026\u3064\u3082\u308a\u3067\u3057\u305f\u3002\u3057\u304b\u3057\u3001\u305d\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u3063\u3066\u304f\u308b\u306e\u304c\u3061\u3087\u3063\u3068\u9762\u5012\u3067\u3057\u305f\u3002Wikipedia\u3068\u304b\u63a2\u308b\u306e\u304c\u65e9\u3044\u304b\u306a\u30fc\u3068\u601d\u3044\u3064\u3064\u3001\u3053\u308c\u306fLevel 3\u4ee5\u964d\u306b\u56de\u3059\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\u4eca\u56de\u306e\u8ab2\u984c\u5bfe\u5fdc\u3001Shiny\u3068\u7d44\u307f\u5408\u308f\u305b\u308b\uff08HelloShiny\u3092\u4f7f\u3046\uff09\u3068\u3044\u3046\u306e\u304c\u307b\u307c\u5168\u3066\u3067\u3059\u3002\n\u3057\u304b\u3057\u3001\u5730\u5473\u306b\u300cShiny\u306b\u5bfe\u3057\u3066Post\u3057\u3066\u3001\u65b0\u3057\u304fURL\u3092\u8a2a\u308c\u305f\u6271\u3044\u306b\u306a\u3063\u3066\u3082\u3001\u5165\u529b\u3092\u6d88\u3055\u305b\u306a\u3044\u300d\u3068\u3044\u3046\u3042\u305f\u308a\u306b\u60b2\u3057\u3044\u52aa\u529b\u3092\u8981\u3057\u307e\u3057\u305f\u3002\n\u3053\u308c\u304c\u76f8\u5f53\u5730\u5473\u304b\u3064\u60b2\u3057\u3044\u52aa\u529b\u3067\u3001print(paste(input$support, input$confidence))\u3068\u304b\u3044\u3046\u51e6\u7406\u304c\u54c0\u308c\u306a\u611f\u3058\u3067\u3059\u3002Shiny\u3067\u30a2\u30d7\u30ea\u3092\u4f5c\u308d\u3046\u3068\u3059\u308b\u3068\u3001\u305f\u307e\u306breactivity\u3092\u3046\u307e\u304f\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u3067\u304d\u306a\u304f\u3066\u3001\u3053\u3046\u305b\u3056\u308b\u3092\u5f97\u306a\u3044\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u3082\u3046\u5c11\u3057Shiny\u306e\u52c9\u5f37\u3092\u3059\u308b\u3057\u304b\u306a\u3044\u306e\u304b\u30fc\u3002\n\n\u30bd\u30fc\u30b9\n\nui.R\nlibrary(shiny)\nlibrary(DiagrammeR)\nshinyUI(fluidPage(\n  singleton(tags$head(HTML(\n    '\n    <script type=\"text/javascript\">\n    $(document).ready(function() {\n      // creates a handler for our special message type\n      Shiny.addCustomMessageHandler(\"api_url\", function(message) {\n        // set up the the submit URL of the form\n        var shiny_test = document.getElementById(\"shiny_test\")\n        shiny_test.innerHTML = \"http://127.0.0.1:7458/\" + message.url;\n      });\n    })\n    </script>\n    '\n  ))),\n  uiOutput(\"hideScript\"),\n  div(id=\"keydiv\",style=\"display:none;\",\n    HTML(\"<span id='shiny_test'></span>\")\n  ),\n  div(id=\"tablediv\",\n    numericInput(\"support\", \"support\", 0.90),\n    numericInput(\"confidence\", \"confidence\", 0.50),\n    DiagrammeROutput(\"mermaidtest\")\n    #,dataTableOutput(\"tabletest\")\n  )\n))\n\n\n\nserver.R\nlibrary(shiny)\nlibrary(stringr)\nlibrary(arules)\nlibrary(DiagrammeR)\n\ndf.test <- data.frame(a=1,b=2)\n\nshinyServer(function(input, output, session) {\n  output$hideScript <- renderText({\n    query <- parseQueryString(session$clientData$url_search)\n    if(\"key\" %in% names(query)){\n      \"<script>$('#keydiv').css('display','none');</script>\"\n    } else {\n      \"<script>$('#tablediv').css('display','none');$('#keydiv').css('display','block');</script>\"\n    }\n  })\n\n  #output$tabletest <- renderDataTable(getRule())\n\n  output$mermaidtest <- renderDiagrammeR(mermaid(getDiagramExpr()))\n\n  getRule <- function(support, confidence){\n    tryCatch({\n      setTimeLimit(5,5)\n      df <- data.frame(before=df.test[[2]], after=df.test[[3]])\n      colnames(df)<-c(\"before\",\"after\")\n      #print(df)\n      d <- apriori(as(df,\"transactions\"), parameter=list(support=support, confidence=confidence))\n      setTimeLimit(Inf,Inf)\n    },error=function(e){\n      setTimeLimit(Inf,Inf)\n      stop(e)\n    })\n    e <- as(d,\"data.frame\")\n    e$LHS <- str_replace_all(e$rules,\"=>.+\",\"\")\n    e$RHS <- str_replace_all(e$rules,\".+=>\",\"\")\n    e\n  }\n\n  getDiagramExpr <- function(){\n    if(redirectFlg == T){\n      redirectFlg <<- F\n    } else {\n      t_support <<- input$support\n      t_confidence <<- input$confidence\n    }\n    tryCatch({\n      updateNumericInput(session, \"support\", value = t_support)\n      updateNumericInput(session, \"confidence\", value = t_confidence)\n    }, error=function(e){\n      t_support <<- input$support\n      t_confidence <<- input$confidence\n    })\n    print(paste(input$support, input$confidence))\n    e <- getRule(t_support, t_confidence)\n    nodes <- e[!is.na(str_match(e$LHS, \"before\")),]\n    nodes$LHS <- nodes$LHS %>% str_replace_all(\"\\\\{before=\",\"\") %>% str_replace_all(\"\\\\}\",\"\")\n    nodes$RHS <- nodes$RHS %>% str_replace_all(\"\\\\{after=\",\"\") %>% str_replace_all(\"\\\\}\",\"\")\n    nodes$mermaid <- paste0(nodes$LHS, \"-->|\", (floor(nodes$confidence*1000)/10), \"%|\", nodes$RHS)\n    nodes$mermaid <- str_replace_all(nodes$mermaid, \"\u266d\", \"b\")\n    str <- paste(\"graph TD\",Reduce(function(...){paste(...,sep=\"\\n\")},nodes$mermaid),sep=\"\\n\")\n    str\n  }\n\n  api_url <- session$registerDataObj( \n    name   = 'api', # an arbitrary but unique name for the data object\n    data   = list(), # you can bind some data here, which is the data argument for the\n    # filter function below.\n    filter = function(data, req) {\n      # print(ls(req))  # you can inspect what variables are encapsulated in this req\n      # environment\n      if (req$REQUEST_METHOD == \"GET\") {\n        # handle GET requests\n        query <- parseQueryString(req$QUERY_STRING)\n\n      } \n\n      if (req$REQUEST_METHOD == \"POST\") {\n        # handle POST requests here\n        reqInput <- req$rook.input\n\n        # data must be one line and must be the form of http://www.yoheim.net/blog.php?q=20120611\n        strs <- paste0(\"?key=T\")\n        datastr <- reqInput$read_lines(1)\n        str_split(datastr, \"\\\\&\")\n        data <- parseQueryString(datastr)\n        for(i in 1:length(data)){\n          data[[i]] <- str_split(iconv(data[[i]],\"utf-8\",\"cp932\"),\",\")\n        }\n        df.test <<- data\n        buf <- paste0(\n          '<HEAD><META HTTP-EQUIV=\"Refresh\" CONTENT=\"0; URL=http://127.0.0.1:7458/',strs,\n          '\" /></HEAD>')\n        redirectFlg <<- T\n        shiny:::httpResponse(\n          status=200, content_type='text/html', content=buf\n        )\n      }          \n    }\n  )\n\n  # because the API entry is UNIQUE, we need to send it to the client\n  # we can create a custom pipeline to convey this message\n  session$sendCustomMessage(\"api_url\", list(url=api_url))\n})\n\n\n\n\u307e\u3068\u3081\n\u3055\u304f\u3055\u304f\u3068Qlik Sense + Shiny\u3067\u904a\u3079\u307e\u3059\u304c\u3001\u5fae\u5999\u306a\u8ab2\u984c\u3082\u8272\u3005\u3068\u6b8b\u308a\u307e\u3057\u305f\u3002\n\u77e2\u5370\u304c\u51fa\u306a\u3044\u3068\u304b\u3001Reactive\u3067\u5909\u306a\u66f8\u304d\u65b9\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3068\u304b\u3001\u66f2\u6570\u306e\u6982\u5ff5\u3092\u53cd\u6620\u3057\u305f\u65b9\u304c\u3044\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3068\u304b\u3001\u767a\u58f2\u5e74\u6708\u65e5\u3084\u7d2f\u7a4d\u8ca9\u58f2\u679a\u6570\u305d\u306e\u4ed6\u306e\u60c5\u5831\u3092\u7c21\u5358\u306b\u62fe\u3046\u65b9\u6cd5\u3092\u691c\u8a0e\u3059\u308b\u3068\u304b\u3002\n\u3053\u308c\u306fLevel 3\u4ee5\u964d\u3067\u5bfe\u5fdc\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u305b\u3046\u3002\n\n\u304a\u308f\u308a\n\u305f\u306e\u3057\u3081\uff01\n# \u6982\u8981\n\u30c7\u30fc\u30bf\u30af\u30ec\u30f3\u30b8\u30f3\u30b0\u306e\u58c1\u306b\u6253\u3061\u3072\u3057\u304c\u308c\u3064\u3064\u3001\u3067\u304d\u308b\u3053\u3068\u3092\u3084\u308a\u307e\u3059\u3002\n[R\u3067\u30b3\u30fc\u30c9\u9032\u884c\u3092\u4e01\u5be7\u4e01\u5be7\u4e01\u5be7\u306b\u53ef\u8996\u5316\u3057\u3066\u307f\u308b\uff08Level 1\uff09](http://qiita.com/sasanquaneuf/items/aed57423b4edce26f783)\u306e\u7d9a\u304d\u3067\u3059\u3002\n\n# \u8ab2\u984c\u5bfe\u5fdc\n>**\u6210\u5206\u304b\u3089\u66f2\u306e\u9006\u5f15\u304d\u304c\u3057\u305f\u3044**\n>\n>\u305d\u306e\u307e\u3093\u307e\u3067\u3059\u3002\u3053\u308c\u3082\u3001Shiny + Qlik Sense\u3092\u4f7f\u3048\u3070\u89e3\u6c7a\u3059\u308b\u306e\u3067\u3001Level 2\u3067\u3084\u308a\u305f\u3044\u3068\u3053\u308d\u3067\u3059\u3002\n\n\u306a\u3093\u3066\u3044\u3046\u3053\u3068\u3092\u66f8\u3044\u3066\u3044\u307e\u3057\u305f\u3002\u3068\u308a\u3042\u3048\u305a\u3053\u308c\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002\n\u3082\u3046\u3061\u3087\u3063\u3068\u304d\u308c\u3044\u306b\u3057\u3066\u304b\u3089\u304b\u306a\u30fc\u3068\u601d\u3063\u3066\u3001GitHub\u306b\u306fPush\u3057\u3066\u3044\u307e\u305b\u3093\u304c\u3001\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u306eShiny\u3092\u5c11\u3057\u4e0a\u7b49\u306b\u3057\u307e\u3057\u305f\u3002\u30bd\u30fc\u30b9\u306f\u6700\u5f8c\u306b\u3042\u308a\u307e\u3059\u3002\n\n# \u96f0\u56f2\u6c17\n\u524d\u56de\u3001\u53d6\u5f97\u3057\u305f\u30c7\u30fc\u30bf\u3092\u5b9f\u306fcsv\u3068\u3057\u3066\u4fdd\u5b58\u3057\u3066\u3044\u305f\u306e\u3067\u3001\u3053\u308c\u3092\u305d\u306e\u307e\u307eQlik Sense\u306b\u8aad\u307f\u8fbc\u307e\u305b\u307e\u3059\u3002\n<img width=\"1078\" alt=\"qs1.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/94255/37d89ff7-8b92-69b6-7b36-45c50975a19a.png\">\n\u5de6\u5074\u306etitle\u3068\u304bbefore\u3068\u304b\u3092\u9078\u629e\u3059\u308b\u3068\u3001\u5f53\u7136\u3067\u3059\u304c\u7d5e\u308a\u8fbc\u307e\u308c\u307e\u3059\u3002\n\u3053\u308c\u3001\u975e\u5e38\u306b\u6b8b\u5ff5\u306a\u306e\u304c\u3001\u306a\u305c\u304bmermaid.js(DiagrammeR)\u306e\u77e2\u5370\u304c\u51fa\u306a\u3044\u3093\u3067\u3059\u3088\u306d\u3002\u3002\u3002Opera\u3067\u3084\u3063\u3066\u3082\u30c0\u30e1\u3067\u3057\u305f\u3002\u306a\u305c\u3060\u308d\u3046\u30fc\u3002R\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c3.1.3\u3060\u304b\u3089\u306a\u306e\u3060\u308d\u3046\u304b\u3002\n\u3081\u3052\u305a\u306b\u691c\u7d22\u3057\u307e\u3059\u3002\u4e2d\u592e\u306e\u5cf6\u306eF#7sus4\u3001\u304a\u524d\u306f\u3060\u308c\u3060\u30fc\u3002\n<img width=\"532\" alt=\"qs2.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/94255/0946749e-def7-fc49-2cf2-eaa645721ebe.png\">\n<img width=\"1080\" alt=\"qs3.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/94255/126eb320-f74e-29fc-838a-9886263405e2.png\">\n\u30e2\u30ce\u30af\u30ed\u30c8\u30a6\u30ad\u30e7\u30fc\u3067\u3057\u305f\u3002\u30e2\u30ce\u30af\u30ed\u30c8\u30a6\u30ad\u30e7\u30fc\u4ee5\u5916\u306b\u306f\u3044\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u4e00\u66f2\u3060\u3051\u3067\u5cf6\u3092\u4f5c\u3063\u3066\u3057\u307e\u3046\u3068\u306f\u3002\u3002\u3002\u3082\u3046\u3061\u3087\u3063\u3068\u3001support\u306e\u8003\u3048\u65b9\u3092\u898b\u76f4\u3057\u305f\u65b9\u304c\u3088\u3044\u306e\u304b\u3002\u66f2\u6570\u306e\u6982\u5ff5\u3092\u5165\u308c\u308b\u3068\u304b\u3002\n\n\n\u6c17\u3092\u53d6\u308a\u76f4\u3057\u3066\u3001\u5f53\u7136\u3001\u5186\u30b0\u30e9\u30d5\u3067\u3082\u30c7\u30fc\u30bf\u3092\u9078\u629e\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u5186\u30b0\u30e9\u30d5\u3067D\u3092\u9078\u3076\u3068\u3001\u2026\n<img width=\"1080\" alt=\"qs4.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/94255/364e9b71-75c8-92e4-512c-b8875f5e4bae.png\">\n\u3053\u308c\u304c\u30b5\u30af\u30b5\u30af\u3067\u304d\u308b\u306e\u304c\u512a\u79c0\u3067\u3059\u3002\n\u3061\u306a\u307f\u306b\u3001D\u3092\u30b5\u30ab\u30ca\u30af\u30b7\u30e7\u30f3\u4ee5\u5916\u3067\u3082\u898b\u3066\u307f\u308b\u3068\u3001\u2026\uff08confidence\u3092\u9ad8\u304f\u3057\u307e\u3057\u305f\uff09\n<img width=\"1079\" alt=\"qs5.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/94255/bc90e287-df90-b74c-9423-6b941651be64.png\">\n\u30b5\u30ab\u30ca\u30af\u30b7\u30e7\u30f3\u306b\u306fD\u2192A\u3068\u3044\u3046\u6d41\u308c\u306f\u7121\u3044\u3067\u3059\u304c\u3001D\u2192A\u304c\u7d50\u69cb\u3042\u308a\u307e\u3059\u306d\u3002\u305d\u308a\u3083\u305d\u3046\u304b\u30fc\u3002\n\n# \u3056\u3093\u306d\u3093\u306a\u306f\u306a\u3057\n\u3055\u3066\u3001\u3082\u3046\u4e00\u3064\u3001Qlik Sense\u3092\u4f7f\u3048\u3070\u3059\u3050\u306b\u89e3\u6c7a\u3067\u304d\u308b\u306f\u305a\u306e\u8ab2\u984c\u304c\u3042\u3063\u3066\u3001\n>**\u5e74\u4ee3\u3084\u305d\u306e\u4ed6\u6761\u4ef6\u5225\u306e\u5206\u6790**\n>\n>\u7279\u306b\u5c0f\u7530\u548c\u6b63\u306e\u5834\u5408\u3001\u30aa\u30d5\u30b3\u30fc\u30b9\u306e\u6642\u4ee3\u3068\u4eca\u3067\u306f\u3060\u3044\u3076\u8272\u3005\u9055\u3046\u3068\u601d\u3046\u306e\u3067\u3001\u305f\u3068\u3048\u3070\u30ec\u30b3\u30fc\u30c9\u306e\u767a\u58f2\u6642\u671f\u3068\u304b\u3001\u30a2\u30eb\u30d0\u30e0\u304b\u30b7\u30f3\u30b0\u30eb\u304b\u3068\u304b\u3001\u305d\u3046\u3044\u3046\u30c7\u30fc\u30bf\u3092\u4ed8\u52a0\u3057\u3066\u898b\u308b\u3068\u9762\u767d\u3044\u3088\u3046\u306a\u6c17\u304c\u3057\u307e\u3059\u3002\n\n\u3053\u308c\u3001\u305d\u308c\u305e\u308c\u306e\u66f2\u306b\u5bfe\u3057\u3066\u767a\u58f2\u6642\u671f\u3092\u4ed8\u52a0\u3059\u308b\u3060\u3051\u306e\u7c21\u5358\u306a\u304a\u4ed5\u4e8b\u3092\u3059\u308c\u3070\u3001\u540c\u3058\u3088\u3046\u306b\u62bd\u51fa\u6761\u4ef6\u306b\u6307\u5b9a\u3067\u304d\u308b\u2026\u3064\u3082\u308a\u3067\u3057\u305f\u3002\u3057\u304b\u3057\u3001\u305d\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u3063\u3066\u304f\u308b\u306e\u304c\u3061\u3087\u3063\u3068\u9762\u5012\u3067\u3057\u305f\u3002Wikipedia\u3068\u304b\u63a2\u308b\u306e\u304c\u65e9\u3044\u304b\u306a\u30fc\u3068\u601d\u3044\u3064\u3064\u3001\u3053\u308c\u306fLevel 3\u4ee5\u964d\u306b\u56de\u3059\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\n\u4eca\u56de\u306e\u8ab2\u984c\u5bfe\u5fdc\u3001Shiny\u3068\u7d44\u307f\u5408\u308f\u305b\u308b\uff08HelloShiny\u3092\u4f7f\u3046\uff09\u3068\u3044\u3046\u306e\u304c\u307b\u307c\u5168\u3066\u3067\u3059\u3002\n\u3057\u304b\u3057\u3001\u5730\u5473\u306b\u300cShiny\u306b\u5bfe\u3057\u3066Post\u3057\u3066\u3001\u65b0\u3057\u304fURL\u3092\u8a2a\u308c\u305f\u6271\u3044\u306b\u306a\u3063\u3066\u3082\u3001\u5165\u529b\u3092\u6d88\u3055\u305b\u306a\u3044\u300d\u3068\u3044\u3046\u3042\u305f\u308a\u306b\u60b2\u3057\u3044\u52aa\u529b\u3092\u8981\u3057\u307e\u3057\u305f\u3002\n\u3053\u308c\u304c\u76f8\u5f53\u5730\u5473\u304b\u3064\u60b2\u3057\u3044\u52aa\u529b\u3067\u3001`print(paste(input$support, input$confidence))`\u3068\u304b\u3044\u3046\u51e6\u7406\u304c\u54c0\u308c\u306a\u611f\u3058\u3067\u3059\u3002Shiny\u3067\u30a2\u30d7\u30ea\u3092\u4f5c\u308d\u3046\u3068\u3059\u308b\u3068\u3001\u305f\u307e\u306breactivity\u3092\u3046\u307e\u304f\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u3067\u304d\u306a\u304f\u3066\u3001\u3053\u3046\u305b\u3056\u308b\u3092\u5f97\u306a\u3044\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u3082\u3046\u5c11\u3057Shiny\u306e\u52c9\u5f37\u3092\u3059\u308b\u3057\u304b\u306a\u3044\u306e\u304b\u30fc\u3002\n\n# \u30bd\u30fc\u30b9\n\n```r:ui.R\nlibrary(shiny)\nlibrary(DiagrammeR)\nshinyUI(fluidPage(\n  singleton(tags$head(HTML(\n    '\n    <script type=\"text/javascript\">\n    $(document).ready(function() {\n      // creates a handler for our special message type\n      Shiny.addCustomMessageHandler(\"api_url\", function(message) {\n        // set up the the submit URL of the form\n        var shiny_test = document.getElementById(\"shiny_test\")\n        shiny_test.innerHTML = \"http://127.0.0.1:7458/\" + message.url;\n      });\n    })\n    </script>\n    '\n  ))),\n  uiOutput(\"hideScript\"),\n  div(id=\"keydiv\",style=\"display:none;\",\n    HTML(\"<span id='shiny_test'></span>\")\n  ),\n  div(id=\"tablediv\",\n    numericInput(\"support\", \"support\", 0.90),\n    numericInput(\"confidence\", \"confidence\", 0.50),\n    DiagrammeROutput(\"mermaidtest\")\n    #,dataTableOutput(\"tabletest\")\n  )\n))\n```\n\n```r:server.R\nlibrary(shiny)\nlibrary(stringr)\nlibrary(arules)\nlibrary(DiagrammeR)\n\ndf.test <- data.frame(a=1,b=2)\n\nshinyServer(function(input, output, session) {\n  output$hideScript <- renderText({\n    query <- parseQueryString(session$clientData$url_search)\n    if(\"key\" %in% names(query)){\n      \"<script>$('#keydiv').css('display','none');</script>\"\n    } else {\n      \"<script>$('#tablediv').css('display','none');$('#keydiv').css('display','block');</script>\"\n    }\n  })\n  \n  #output$tabletest <- renderDataTable(getRule())\n  \n  output$mermaidtest <- renderDiagrammeR(mermaid(getDiagramExpr()))\n\n  getRule <- function(support, confidence){\n    tryCatch({\n      setTimeLimit(5,5)\n      df <- data.frame(before=df.test[[2]], after=df.test[[3]])\n      colnames(df)<-c(\"before\",\"after\")\n      #print(df)\n      d <- apriori(as(df,\"transactions\"), parameter=list(support=support, confidence=confidence))\n      setTimeLimit(Inf,Inf)\n    },error=function(e){\n      setTimeLimit(Inf,Inf)\n      stop(e)\n    })\n    e <- as(d,\"data.frame\")\n    e$LHS <- str_replace_all(e$rules,\"=>.+\",\"\")\n    e$RHS <- str_replace_all(e$rules,\".+=>\",\"\")\n    e\n  }\n  \n  getDiagramExpr <- function(){\n    if(redirectFlg == T){\n      redirectFlg <<- F\n    } else {\n      t_support <<- input$support\n      t_confidence <<- input$confidence\n    }\n    tryCatch({\n      updateNumericInput(session, \"support\", value = t_support)\n      updateNumericInput(session, \"confidence\", value = t_confidence)\n    }, error=function(e){\n      t_support <<- input$support\n      t_confidence <<- input$confidence\n    })\n    print(paste(input$support, input$confidence))\n    e <- getRule(t_support, t_confidence)\n    nodes <- e[!is.na(str_match(e$LHS, \"before\")),]\n    nodes$LHS <- nodes$LHS %>% str_replace_all(\"\\\\{before=\",\"\") %>% str_replace_all(\"\\\\}\",\"\")\n    nodes$RHS <- nodes$RHS %>% str_replace_all(\"\\\\{after=\",\"\") %>% str_replace_all(\"\\\\}\",\"\")\n    nodes$mermaid <- paste0(nodes$LHS, \"-->|\", (floor(nodes$confidence*1000)/10), \"%|\", nodes$RHS)\n    nodes$mermaid <- str_replace_all(nodes$mermaid, \"\u266d\", \"b\")\n    str <- paste(\"graph TD\",Reduce(function(...){paste(...,sep=\"\\n\")},nodes$mermaid),sep=\"\\n\")\n    str\n  }\n  \n  api_url <- session$registerDataObj( \n    name   = 'api', # an arbitrary but unique name for the data object\n    data   = list(), # you can bind some data here, which is the data argument for the\n    # filter function below.\n    filter = function(data, req) {\n      # print(ls(req))  # you can inspect what variables are encapsulated in this req\n      # environment\n      if (req$REQUEST_METHOD == \"GET\") {\n        # handle GET requests\n        query <- parseQueryString(req$QUERY_STRING)\n        \n      } \n      \n      if (req$REQUEST_METHOD == \"POST\") {\n        # handle POST requests here\n        reqInput <- req$rook.input\n        \n        # data must be one line and must be the form of http://www.yoheim.net/blog.php?q=20120611\n        strs <- paste0(\"?key=T\")\n        datastr <- reqInput$read_lines(1)\n        str_split(datastr, \"\\\\&\")\n        data <- parseQueryString(datastr)\n        for(i in 1:length(data)){\n          data[[i]] <- str_split(iconv(data[[i]],\"utf-8\",\"cp932\"),\",\")\n        }\n        df.test <<- data\n        buf <- paste0(\n          '<HEAD><META HTTP-EQUIV=\"Refresh\" CONTENT=\"0; URL=http://127.0.0.1:7458/',strs,\n          '\" /></HEAD>')\n        redirectFlg <<- T\n        shiny:::httpResponse(\n          status=200, content_type='text/html', content=buf\n        )\n      }          \n    }\n  )\n  \n  # because the API entry is UNIQUE, we need to send it to the client\n  # we can create a custom pipeline to convey this message\n  session$sendCustomMessage(\"api_url\", list(url=api_url))\n})\n```\n\n# \u307e\u3068\u3081\n\u3055\u304f\u3055\u304f\u3068Qlik Sense + Shiny\u3067\u904a\u3079\u307e\u3059\u304c\u3001\u5fae\u5999\u306a\u8ab2\u984c\u3082\u8272\u3005\u3068\u6b8b\u308a\u307e\u3057\u305f\u3002\n\u77e2\u5370\u304c\u51fa\u306a\u3044\u3068\u304b\u3001Reactive\u3067\u5909\u306a\u66f8\u304d\u65b9\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3068\u304b\u3001\u66f2\u6570\u306e\u6982\u5ff5\u3092\u53cd\u6620\u3057\u305f\u65b9\u304c\u3044\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3068\u304b\u3001\u767a\u58f2\u5e74\u6708\u65e5\u3084\u7d2f\u7a4d\u8ca9\u58f2\u679a\u6570\u305d\u306e\u4ed6\u306e\u60c5\u5831\u3092\u7c21\u5358\u306b\u62fe\u3046\u65b9\u6cd5\u3092\u691c\u8a0e\u3059\u308b\u3068\u304b\u3002\n\u3053\u308c\u306fLevel 3\u4ee5\u964d\u3067\u5bfe\u5fdc\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u305b\u3046\u3002\n\n# \u304a\u308f\u308a\n\u305f\u306e\u3057\u3081\uff01\n", "tags": ["Qlik", "Qlik_Sense", "R", "Shiny", "\u6a5f\u68b0\u5b66\u7fd2"]}