{"context": "\u524d\u56de\u306e\u7d9a\u304d\u3067\u3059\u3002\nruby\u304a\u52c9\u5f37\u3092\u7d9a\u3051\u307e\u3059\u3002\n\n1. MariaDB\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n1.1 \u672c\u4f53\n\u3053\u3061\u3089\u3092\u53c2\u8003\u306bMariaDB\u3092\u5165\u308c\u307e\u3059\u3002\u4f55\u3082\u8aac\u660e\u3059\u308b\u4e8b\u306f\u306a\u3044\u304f\u3089\u3044\u7c21\u5358\u3067\u3059\u3002\n[root@localhost share]# yum -y install mariadb-server mariadb\n..........\n\u5b8c\u4e86\u3057\u307e\u3057\u305f!\n[root@localhost share]# yum -y install mariadb-devel.x86_64\n..........\n\u5b8c\u4e86\u3057\u307e\u3057\u305f!\n\n[root@localhost share]# systemctl start mariadb\n[root@localhost share]# systemctl enable mariadb\n..........\n 8\u6708 03 17:42:15 localhost.localdomain systemd[1]: Started MariaDB database server.\nHint: Some lines were ellipsized, use -l to show in full.\n\n[root@localhost share]# mysql\n..........\nMariaDB [(none)]> show databases;\n..........\n\n\n1.2 gem\u8ffd\u52a0\n\u3053\u3061\u3089\u3082\u4f55\u4e8b\u3082\u306a\u304f\u7d42\u4e86\u3057\u307e\u3059\u3002\n[root@localhost my1stAPI]# vi Gemfile\n# for MariaDB\ngem 'mysql2'\n\n[root@localhost my1stAPI]# bundle install --path vendor/bundle\n..........\nBundle complete! 9 Gemfile dependencies, 49 gems now installed.\nBundled gems are installed into ./vendor/bundle.\n\n\n\n2 configuration\n\u524d\u56de\u4f5c\u3063\u305fmy1stAPI\u306bDB\u63a5\u7d9a\u60c5\u5831\u3092\u66f8\u304d\u8db3\u3057\u307e\u3059\u3002\n# 2.1 \u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\n\nMariaDB [(none)]> create user 'railsuser'@'localhost' identified by 'railspass';\nQuery OK, 0 rows affected (0.00 sec)\n\nMariaDB [(none)]> grant all on *.* to 'railsuser'@'localhost';\nQuery OK, 0 rows affected (0.00 sec)\n\nMariaDB [(none)]> flush privileges;\nQuery OK, 0 rows affected (0.00 sec)\n\n\n2.1 DB\u63a5\u7d9a\u8a2d\u5b9a\nDB\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002mysql\u306b\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3068create database\u3055\u308c\u3066\u3044\u308b\u4e8b\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n[root@localhost my1stAPI]# rake db:create\nCreated database 'example'\nDatabase 'example' already exists\n\ndatabase.yml\u3092\u7de8\u96c6\u3057\u307e\u3059\n\nmy1stAPI/config/database.yml\n# SQLite version 3.x\n#   gem install sqlite3\n#\n#   Ensure the SQLite 3 gem is defined in your Gemfile\n#   gem 'sqlite3'\n#\ndefault: &default\n  adapter: mysql2\n  encoding: utf8\n  reconnect: false\n  database: example\n  pool: 5\n  username: railsuser\n  password: railspass\n  host: localhost\n\ndevelopment:\n  <<: *default\n\n# Warning: The database defined as \"test\" will be erased and\n# re-generated from your development database when you run \"rake\".\n# Do not set this db to the same as development or production.\ntest:\n  <<: *default\n\nproduction:\n  <<: *default\n\n\n\n3. DB\u30a2\u30d7\u30ea\u3092\u4f5c\u3063\u3066\u307f\u3088\u3046\n\u3053\u3061\u3089\u3092\u53c2\u8003\u306brails\u30b3\u30de\u30f3\u30c9\u3067\u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\u3092\u884c\u3044\u307e\u3059\u3002DAO\u307e\u3067\u4e00\u6c17\u306b\u4f5c\u3063\u3061\u3083\u3044\u307e\u3057\u3087\u3046\u3002\n\u4eca\u56de\u306fmecab\u306e\u30e6\u30fc\u30b6\u30fc\u8f9e\u66f8\u3092\u8ffd\u52a0\u3057\u3066\u5410\u304d\u51fa\u3059\u30c4\u30fc\u30eb\u304c\u6b32\u3057\u304b\u3063\u305f\u306e\u3067\u767b\u9332\u7528API\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u3053\u3061\u3089\u3092\u307f\u306a\u304c\u3089\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n3.1 \u30e2\u30c7\u30eb\u4f5c\u6210\n1) rake db:create \u30b3\u30de\u30f3\u30c9\u3067.yml\u306b\u8a18\u8f09\u306eDB\u4f5c\u6210\n2) rails generate model\u30b3\u30de\u30f3\u30c9\u3067\u30c7\u30fc\u30bf\u30fb\u30e2\u30c7\u30eb\u306e\u4f5c\u6210\n3) rake db:migrate\u3000\u30b3\u30de\u30f3\u30c9\u3067model\u306b\u8a18\u8f09\u306e\u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\n\n\n\n\u8868\u5c64\u5f62\n\u5de6\u6587\u8108ID\n\u53f3\u6587\u8108ID\n\u30b3\u30b9\u30c8\n\u54c1\u8a5e\n\u54c1\u8a5e\u7d30\u5206\u985e1\n\u54c1\u8a5e\u7d30\u5206\u985e2\n\u54c1\u8a5e\u7d30\u5206\u985e3\n\u6d3b\u7528\u5f62\n\u6d3b\u7528\u578b\n\u539f\u5f62\n\u8aad\u307f\n\u767a\u97f3\n\n\n\n\nsTitle\niLeft_id\niRight_id\niCost\nsClassification\nsClass1\nsClass2\nsClass3\nsConjugation\nsConjugation_type\nsOriginal\nsPronunciation1\nsPronunciation2\n\n\n\u713c\u8089\u5b9a\u98df\n\n\n1\n\u540d\u8a5e\n\u4e00\u822c\n*\n*\n*\n*\n\u713c\u8089\u5b9a\u98df\n\u30e4\u30ad\u30cb\u30af\u30c6\u30a4\u30b7\u30e7\u30af\n\u30e4\u30ad\u30cb\u30af\u30c6\u30a4\u30b7\u30e7\u30af\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[admin@localhost my1stAPI]$ rails generate model Mecabuserdic sTitle:string:index iLeft_id:integer iRight_id:integer iCost:integer sClassification:string sClass1:string sClass2:string sClass3:string sConjugation:string sConjugation_type:string sOriginal:string sPronunciation1:string sPronunciation2:string\nRunning via Spring preloader in process 4764\n      invoke  active_record\n      create    db/migrate/20160806060901_create_mecabuserdics.rb\n      create    app/models/mecabuserdic.rb\n      invoke    test_unit\n      create      test/models/mecabuserdic_test.rb\n      create      test/fixtures/mecabuserdics.yml\n[admin@localhost my1stAPI]$ rake db:migrate\n== 20160806060901 CreateMecabuserdics: migrating ==============================\n-- create_table(:mecabuserdics)\n   -> 0.0075s\n-- add_index(:mecabuserdics, :sTitle)\n   -> 0.0170s\n== 20160806060901 CreateMecabuserdics: migrated (0.0247s) =====================\n\n[admin@localhost my1stAPI]$ rails console\nRunning via Spring preloader in process 4842\nLoading development environment (Rails 5.0.0)\nirb(main):001:0> Mecabuserdic\n=> Mecabuserdic (call 'Mecabuserdic.connection' to establish a connection)\nirb(main):002:0> Mecabuserdic.new\n=> #<Mecabuserdic id: nil, sTitle: nil, iLeft_id: nil, iRight_id: nil, iCost: nil, sClassification: nil, sClass1: nil, sClass2: nil, sClass3: nil, sConjugation: nil, sConjugation_type: nil, sOriginal: nil, sPronunciation1: nil, sPronunciation2: nil, created_at: nil, updated_at: nil>\nirb(main):006:0* record=Mecabuserdic.new(sTitle: '\u30ab\u30c4\u4e3c\u5b9a\u98df',iCost: 1, sClassification: '\u540d\u8a5e', sClass1: '\u4e00\u822c', sClass2: '*', sClass3: '*', sConjugation: '*', sConjugation_type: '*', sOriginal: '\u30ab\u30c4\u4e3c\u5b9a\u98df', sPronunciation1: '\u30ab\u30c4\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af', sPronunciation2: '\u30ab\u30c4\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af')\n=> #<Mecabuserdic id: nil, sTitle: \"\u30ab\u30c4\u4e3c\u5b9a\u98df\", iLeft_id: nil, iRight_id: nil, iCost: 1, sClassification: \"\u540d\u8a5e\", sClass1: \"\u4e00\u822c\", sClass2: \"*\", sClass3: \"*\", sConjugation: \"*\", sConjugation_type: \"*\", sOriginal: \"\u30ab\u30c4\u4e3c\u5b9a\u98df\", sPronunciation1: \"\u30ab\u30c4\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af\", sPronunciation2: \"\u30ab\u30c4\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af\", created_at: nil, updated_at: nil>\nirb(main):007:0> record.valid?\n=> true\nirb(main):008:0> record.save\n   (0.2ms)  BEGIN\n  SQL (0.3ms)  INSERT INTO `mecabuserdics` (`sTitle`, `iCost`, `sClassification`, `sClass1`, `sClass2`, `sClass3`, `sConjugation`, `sConjugation_type`, `sOriginal`, `sPronunciation1`, `sPronunciation2`, `created_at`, `updated_at`) VALUES ('\u30ab\u30c4\u4e3c\u5b9a\u98df', 1, '\u540d\u8a5e', '\u4e00\u822c', '*', '*', '*', '*', '\u30ab\u30c4\u4e3c\u5b9a\u98df', '\u30ab\u30c4\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af', '\u30ab\u30c4\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af', '2016-08-06 06:14:46', '2016-08-06 06:14:46')\n   (1.9ms)  COMMIT\n=> true\nirb(main):012:0* Mecabuserdic.all\n  Mecabuserdic Load (0.4ms)  SELECT `mecabuserdics`.* FROM `mecabuserdics`\n=> #<ActiveRecord::Relation [#<Mecabuserdic id: 1, sTitle: \"\u30ab\u30c4\u4e3c\u5b9a\u98df\", iLeft_id: nil, iRight_id: nil, iCost: 1, sClassification: \"\u540d\u8a5e\", sClass1: \"\u4e00\u822c\", sClass2: \"*\", sClass3: \"*\", sConjugation: \"*\", sConjugation_type: \"*\", sOriginal: \"\u30ab\u30c4\u4e3c\u5b9a\u98df\", sPronunciation1: \"\u30ab\u30c4\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af\", sPronunciation2: \"\u30ab\u30c4\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af\", created_at: \"2016-08-06 06:14:46\", updated_at: \"2016-08-06 06:14:46\">]>\n\n\n\n3.2 \u30a2\u30d7\u30ea\u5185\u306b\u30e2\u30c7\u30eb\u3092\u7d44\u307f\u8fbc\u307f\n\u3053\u3061\u3089\u3092\u53c2\u8003\u306bmodel\u306e\u30c7\u30fc\u30bf\u3092\u66f4\u65b0\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u3092\u4f5c\u3063\u3066\u898b\u307e\u3057\u305f\u3002\nvalidation\u30c1\u30a7\u30c3\u30af\u3068\u304b\u697d\u306b\u3084\u308b\u65b9\u6cd5\u3092\u63a2\u3057\u305f\u3044\u3067\u3059\u306d\u3002\n1) \u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u8ffd\u52a0\n2) configfile\u306b\u8ffd\u8a18\n3) \u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u304b\u3089\u30e2\u30c7\u30eb\u547c\u3073\u51fa\u3057\n[admin@localhost my1stAPI]$ rails generate controller Mecabuserdic new create update edit destroy index show\nRunning via Spring preloader in process 5060\n    conflict  app/controllers/mecabuserdic_controller.rb\nOverwrite /home/admin/share/HelloRuby/my1stAPI/app/controllers/mecabuserdic_controller.rb? (enter \"h\" for help) [Ynaqdh] Y\n       force  app/controllers/mecabuserdic_controller.rb\n       route  get 'mecabuserdic/show'\n       route  get 'mecabuserdic/index'\n       route  get 'mecabuserdic/destroy'\n       route  get 'mecabuserdic/edit'\n       route  get 'mecabuserdic/update'\n       route  get 'mecabuserdic/create'\n       route  get 'mecabuserdic/new'\n      invoke  test_unit\n    conflict    test/controllers/mecabuserdic_controller_test.rb\n  Overwrite /home/admin/share/HelloRuby/my1stAPI/test/controllers/mecabuserdic_controller_test.rb? (enter \"h\" for help) [Ynaqdh] Y\n       force    test/controllers/mecabuserdic_controller_test.rb\n\nAPI\u306a\u306e\u3067\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u3057\u306a\u3044\u8a2d\u5b9a\u306b\u3057\u307e\u3059\u3002\n(\u74b0\u5883\u5225\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u3044\u305f\u307b\u3046\u304c\u3088\u3057config/environments/development.rb)\n\nconfig/application.rb\nmodule My1stAPI\n  class Application < Rails::Application\n.......................\n  config.action_controller.perform_caching  = false\n  end\nend\n\n\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u3066\u30b5\u30fc\u30d0\u30fc\u518d\u8d77\u52d5\n\nconfig/routes.rb\nRails.application.routes.draw do\n  get 'mecabuserdic/show' => 'mecabuserdic#show'\n\n  get 'mecabuserdic/new' => 'mecabuserdic#new'\n\n  get 'mecabuserdic/create' => 'mecabuserdic#create'\n\n  get 'mecabuserdic/update' => 'mecabuserdic#update'\n\n  get 'mecabuserdic/edit' => 'mecabuserdic#edit'\n\n  get 'mecabuserdic/destroy' => 'mecabuserdic#destroy'\n\n  get 'mecabuserdic/index' => 'mecabuserdic#index'\n\n  # For details on the DSL available within this file, see http://guides.rubyonrails.org/routing.html\n  get 'example2' => 'example2#show'\n  get 'example2/show2' => 'example2#show2'\nend\n\n\n\napp/controllers/mecabuserdic_controller.rb\nclass MecabuserdicController < ApplicationController\n  before_action :idcheck, only: [:update, :destroy]\n\n  def initialize\n    @targets = Array[\"sTitle\",\"iCost\",\"sClassification\",\"sClass1\",\"sClass2\",\"sClass3\",\"sConjugation\",\"sConjugation_type\",\"sOriginal\",\"sPronunciation1\",\"sPronunciation2\"]\n  end\n\n  def new\n    render json: Mecabuserdic.new\n  end\n\n  def create\n      record = {}\n      @targets.each do |key, val|\n        pval = params[key]\n        Rails.logger.warn \"Param #{key}: #{pval}\"\n        if params.has_key?(key)\n          sprintf(\"exists: %s = %s\",key,pval)\n          record[key] = val\n        end\n      end\n\n      colms = Mecabuserdic.new(record)\n      if colms.valid?\n        colms.save\n      end\n      render json: params\n  end\n\n  def update\n    selected = Mecabuserdic.find(@id)\n\n    @targets.each do |key, val|\n      if params.has_key?(key)\n        eval(sprintf(\"selected.%s = '%s'\",key,params[key]))\n      end\n    end\n    selected.save\n    render json:selected\n  end\n\n  def edit\n    testresult = [{\"error\":\"not implemented\"}]\n    render json: testresult\n  end\n\n  def destroy\n    selected = Mecabuserdic.find(@id)\n    selected.destroy\n    render json: selected\n  end\n\n  def index\n    testresult = [{\"error\":\"not implemented\"}]\n    render json: testresult\n  end\n\n  def show\n    render json: Mecabuserdic.all\n  end\n\n  private\n  def idcheck()\n    if !params.has_key?(\"id\")\n      showerr(sprintf(\"validation error %s \" ,params[\"id\"]))\n    else\n      @id = params[\"id\"]\n    end\n  end\n\n  def showerr(msg)\n    #Rails.logger.warn \"validation error: \"+ msg\n    render json: {\"msg\": \"validation error: \"+ msg} and return\n  end\n\nend\n\n\n\u30ea\u30af\u30a8\u30b9\u30c8\u30b5\u30f3\u30d7\u30eb\n\n\u884c\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u78ba\u8a8d\nhttp://192.168.10.5:3000/mecabuserdic/new\n\n\n\n\u65b0\u898f\u4f5c\u6210\nhttp://192.168.10.5:3000/mecabuserdic/create?sTitle=\u5929\u4e3c\u5b9a\u98df&iCost=1&sClassification=\u540d\u8a5e&sClass1=\u4e00\u822c&sClass2=*&sClass3=*&sConjugation=*&sConjugation_type=*&sOriginal=\u5929\u4e3c\u5b9a\u98df&sPronunciation1=\u30c6\u30f3\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af&sPronunciation2=\u30c6\u30f3\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af\n\n\n\n\u66f4\u65b0\nhttp://192.168.10.5:3000/mecabuserdic/update?id=980190966&sTitle=\u89aa\u5b50\u4e3c\u5b9a\u98df&iCost=1&sClassification=\u540d\u8a5e&sClass1=\u4e00\u822c&sClass2=*&sClass3=*&sConjugation=*&sConjugation_type=*&sOriginal=\u89aa\u5b50\u4e3c\u5b9a\u98df&sPronunciation1=\u30aa\u30e4\u30b3\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af&sPronunciation2=\u30aa\u30e4\u30b3\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af\n\n\n\n\u524a\u9664\nhttp://192.168.10.5:3000/mecabuserdic/destroy?id=980190966\n\n\n\n\u4e00\u89a7\nhttp://192.168.10.5:3000/mecabuserdic/show\n\n\n[\u524d\u56de](http://qiita.com/MariMurotani/items/dd8040c564ea4083369b)\u306e\u7d9a\u304d\u3067\u3059\u3002\nruby\u304a\u52c9\u5f37\u3092\u7d9a\u3051\u307e\u3059\u3002\n\n# 1. MariaDB\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# 1.1 \u672c\u4f53\n[\u3053\u3061\u3089](http://www.liquidweb.com/kb/how-to-install-mysql-mariadb-on-centos-7/)\u3092\u53c2\u8003\u306bMariaDB\u3092\u5165\u308c\u307e\u3059\u3002\u4f55\u3082\u8aac\u660e\u3059\u308b\u4e8b\u306f\u306a\u3044\u304f\u3089\u3044\u7c21\u5358\u3067\u3059\u3002\n\n```\n[root@localhost share]# yum -y install mariadb-server mariadb\n..........\n\u5b8c\u4e86\u3057\u307e\u3057\u305f!\n[root@localhost share]# yum -y install mariadb-devel.x86_64\n..........\n\u5b8c\u4e86\u3057\u307e\u3057\u305f!\n\n[root@localhost share]# systemctl start mariadb\n[root@localhost share]# systemctl enable mariadb\n..........\n 8\u6708 03 17:42:15 localhost.localdomain systemd[1]: Started MariaDB database server.\nHint: Some lines were ellipsized, use -l to show in full.\n\n[root@localhost share]# mysql\n..........\nMariaDB [(none)]> show databases;\n..........\n```\n\n# 1.2 gem\u8ffd\u52a0\n\u3053\u3061\u3089\u3082\u4f55\u4e8b\u3082\u306a\u304f\u7d42\u4e86\u3057\u307e\u3059\u3002\n\n```\n[root@localhost my1stAPI]# vi Gemfile\n# for MariaDB\ngem 'mysql2'\n\n[root@localhost my1stAPI]# bundle install --path vendor/bundle\n..........\nBundle complete! 9 Gemfile dependencies, 49 gems now installed.\nBundled gems are installed into ./vendor/bundle.\n\n```\n\n# 2 configuration\n\u524d\u56de\u4f5c\u3063\u305fmy1stAPI\u306bDB\u63a5\u7d9a\u60c5\u5831\u3092\u66f8\u304d\u8db3\u3057\u307e\u3059\u3002\n\n```\n# 2.1 \u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\n\nMariaDB [(none)]> create user 'railsuser'@'localhost' identified by 'railspass';\nQuery OK, 0 rows affected (0.00 sec)\n\nMariaDB [(none)]> grant all on *.* to 'railsuser'@'localhost';\nQuery OK, 0 rows affected (0.00 sec)\n\nMariaDB [(none)]> flush privileges;\nQuery OK, 0 rows affected (0.00 sec)\n```\n\n# 2.1 DB\u63a5\u7d9a\u8a2d\u5b9a\nDB\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002mysql\u306b\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3068create database\u3055\u308c\u3066\u3044\u308b\u4e8b\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n```\n[root@localhost my1stAPI]# rake db:create\nCreated database 'example'\nDatabase 'example' already exists\n```\n\ndatabase.yml\u3092\u7de8\u96c6\u3057\u307e\u3059\n\n```yaml:my1stAPI/config/database.yml\n# SQLite version 3.x\n#   gem install sqlite3\n#\n#   Ensure the SQLite 3 gem is defined in your Gemfile\n#   gem 'sqlite3'\n#\ndefault: &default\n  adapter: mysql2\n  encoding: utf8\n  reconnect: false\n  database: example\n  pool: 5\n  username: railsuser\n  password: railspass\n  host: localhost\n\ndevelopment:\n  <<: *default\n\n# Warning: The database defined as \"test\" will be erased and\n# re-generated from your development database when you run \"rake\".\n# Do not set this db to the same as development or production.\ntest:\n  <<: *default\n\nproduction:\n  <<: *default\n```\n\n# 3. DB\u30a2\u30d7\u30ea\u3092\u4f5c\u3063\u3066\u307f\u3088\u3046\n[\u3053\u3061\u3089](http://railstutorial.jp/chapters/modeling_users?version=4.2)\u3092\u53c2\u8003\u306brails\u30b3\u30de\u30f3\u30c9\u3067\u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\u3092\u884c\u3044\u307e\u3059\u3002DAO\u307e\u3067\u4e00\u6c17\u306b\u4f5c\u3063\u3061\u3083\u3044\u307e\u3057\u3087\u3046\u3002\n\u4eca\u56de\u306fmecab\u306e\u30e6\u30fc\u30b6\u30fc\u8f9e\u66f8\u3092\u8ffd\u52a0\u3057\u3066\u5410\u304d\u51fa\u3059\u30c4\u30fc\u30eb\u304c\u6b32\u3057\u304b\u3063\u305f\u306e\u3067\u767b\u9332\u7528API\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n[\u3053\u3061\u3089](https://blog.apar.jp/linux/2748/)\u3092\u307f\u306a\u304c\u3089\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n## 3.1 \u30e2\u30c7\u30eb\u4f5c\u6210\n1) rake db:create \u30b3\u30de\u30f3\u30c9\u3067.yml\u306b\u8a18\u8f09\u306eDB\u4f5c\u6210\n2) rails generate model\u30b3\u30de\u30f3\u30c9\u3067\u30c7\u30fc\u30bf\u30fb\u30e2\u30c7\u30eb\u306e\u4f5c\u6210\n3) rake db:migrate\u3000\u30b3\u30de\u30f3\u30c9\u3067model\u306b\u8a18\u8f09\u306e\u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\n\n| \u8868\u5c64\u5f62 | \u5de6\u6587\u8108ID | \u53f3\u6587\u8108ID | \u30b3\u30b9\u30c8 | \u54c1\u8a5e | \u54c1\u8a5e\u7d30\u5206\u985e1 | \u54c1\u8a5e\u7d30\u5206\u985e2 | \u54c1\u8a5e\u7d30\u5206\u985e3 | \u6d3b\u7528\u5f62 | \u6d3b\u7528\u578b | \u539f\u5f62 | \u8aad\u307f | \u767a\u97f3 |\n|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|\n| sTitle | iLeft_id | iRight_id | iCost | sClassification | sClass1 | sClass2 | sClass3 | sConjugation | sConjugation_type | sOriginal | sPronunciation1 | sPronunciation2 |\n| \u713c\u8089\u5b9a\u98df |   |   | 1 | \u540d\u8a5e | \u4e00\u822c | * | * | * | * | \u713c\u8089\u5b9a\u98df | \u30e4\u30ad\u30cb\u30af\u30c6\u30a4\u30b7\u30e7\u30af | \u30e4\u30ad\u30cb\u30af\u30c6\u30a4\u30b7\u30e7\u30af |\n|   |   |   |   |   |   |   |   |   |   |   |   |   |\n\n\n```command\n[admin@localhost my1stAPI]$ rails generate model Mecabuserdic sTitle:string:index iLeft_id:integer iRight_id:integer iCost:integer sClassification:string sClass1:string sClass2:string sClass3:string sConjugation:string sConjugation_type:string sOriginal:string sPronunciation1:string sPronunciation2:string\nRunning via Spring preloader in process 4764\n      invoke  active_record\n      create    db/migrate/20160806060901_create_mecabuserdics.rb\n      create    app/models/mecabuserdic.rb\n      invoke    test_unit\n      create      test/models/mecabuserdic_test.rb\n      create      test/fixtures/mecabuserdics.yml\n[admin@localhost my1stAPI]$ rake db:migrate\n== 20160806060901 CreateMecabuserdics: migrating ==============================\n-- create_table(:mecabuserdics)\n   -> 0.0075s\n-- add_index(:mecabuserdics, :sTitle)\n   -> 0.0170s\n== 20160806060901 CreateMecabuserdics: migrated (0.0247s) =====================\n\n[admin@localhost my1stAPI]$ rails console\nRunning via Spring preloader in process 4842\nLoading development environment (Rails 5.0.0)\nirb(main):001:0> Mecabuserdic\n=> Mecabuserdic (call 'Mecabuserdic.connection' to establish a connection)\nirb(main):002:0> Mecabuserdic.new\n=> #<Mecabuserdic id: nil, sTitle: nil, iLeft_id: nil, iRight_id: nil, iCost: nil, sClassification: nil, sClass1: nil, sClass2: nil, sClass3: nil, sConjugation: nil, sConjugation_type: nil, sOriginal: nil, sPronunciation1: nil, sPronunciation2: nil, created_at: nil, updated_at: nil>\nirb(main):006:0* record=Mecabuserdic.new(sTitle: '\u30ab\u30c4\u4e3c\u5b9a\u98df',iCost: 1, sClassification: '\u540d\u8a5e', sClass1: '\u4e00\u822c', sClass2: '*', sClass3: '*', sConjugation: '*', sConjugation_type: '*', sOriginal: '\u30ab\u30c4\u4e3c\u5b9a\u98df', sPronunciation1: '\u30ab\u30c4\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af', sPronunciation2: '\u30ab\u30c4\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af')\n=> #<Mecabuserdic id: nil, sTitle: \"\u30ab\u30c4\u4e3c\u5b9a\u98df\", iLeft_id: nil, iRight_id: nil, iCost: 1, sClassification: \"\u540d\u8a5e\", sClass1: \"\u4e00\u822c\", sClass2: \"*\", sClass3: \"*\", sConjugation: \"*\", sConjugation_type: \"*\", sOriginal: \"\u30ab\u30c4\u4e3c\u5b9a\u98df\", sPronunciation1: \"\u30ab\u30c4\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af\", sPronunciation2: \"\u30ab\u30c4\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af\", created_at: nil, updated_at: nil>\nirb(main):007:0> record.valid?\n=> true\nirb(main):008:0> record.save\n   (0.2ms)  BEGIN\n  SQL (0.3ms)  INSERT INTO `mecabuserdics` (`sTitle`, `iCost`, `sClassification`, `sClass1`, `sClass2`, `sClass3`, `sConjugation`, `sConjugation_type`, `sOriginal`, `sPronunciation1`, `sPronunciation2`, `created_at`, `updated_at`) VALUES ('\u30ab\u30c4\u4e3c\u5b9a\u98df', 1, '\u540d\u8a5e', '\u4e00\u822c', '*', '*', '*', '*', '\u30ab\u30c4\u4e3c\u5b9a\u98df', '\u30ab\u30c4\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af', '\u30ab\u30c4\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af', '2016-08-06 06:14:46', '2016-08-06 06:14:46')\n   (1.9ms)  COMMIT\n=> true\nirb(main):012:0* Mecabuserdic.all\n  Mecabuserdic Load (0.4ms)  SELECT `mecabuserdics`.* FROM `mecabuserdics`\n=> #<ActiveRecord::Relation [#<Mecabuserdic id: 1, sTitle: \"\u30ab\u30c4\u4e3c\u5b9a\u98df\", iLeft_id: nil, iRight_id: nil, iCost: 1, sClassification: \"\u540d\u8a5e\", sClass1: \"\u4e00\u822c\", sClass2: \"*\", sClass3: \"*\", sConjugation: \"*\", sConjugation_type: \"*\", sOriginal: \"\u30ab\u30c4\u4e3c\u5b9a\u98df\", sPronunciation1: \"\u30ab\u30c4\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af\", sPronunciation2: \"\u30ab\u30c4\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af\", created_at: \"2016-08-06 06:14:46\", updated_at: \"2016-08-06 06:14:46\">]>\n\n```\n\n## 3.2 \u30a2\u30d7\u30ea\u5185\u306b\u30e2\u30c7\u30eb\u3092\u7d44\u307f\u8fbc\u307f\n[\u3053\u3061\u3089](http://ruby-rails.hatenadiary.com/entry/20140724/1406142120#ar-update)\u3092\u53c2\u8003\u306bmodel\u306e\u30c7\u30fc\u30bf\u3092\u66f4\u65b0\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u3092\u4f5c\u3063\u3066\u898b\u307e\u3057\u305f\u3002\nvalidation\u30c1\u30a7\u30c3\u30af\u3068\u304b\u697d\u306b\u3084\u308b\u65b9\u6cd5\u3092\u63a2\u3057\u305f\u3044\u3067\u3059\u306d\u3002\n\n1) \u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u8ffd\u52a0\n2) configfile\u306b\u8ffd\u8a18\n3) \u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u304b\u3089\u30e2\u30c7\u30eb\u547c\u3073\u51fa\u3057\n\n```\n[admin@localhost my1stAPI]$ rails generate controller Mecabuserdic new create update edit destroy index show\nRunning via Spring preloader in process 5060\n    conflict  app/controllers/mecabuserdic_controller.rb\nOverwrite /home/admin/share/HelloRuby/my1stAPI/app/controllers/mecabuserdic_controller.rb? (enter \"h\" for help) [Ynaqdh] Y\n       force  app/controllers/mecabuserdic_controller.rb\n       route  get 'mecabuserdic/show'\n       route  get 'mecabuserdic/index'\n       route  get 'mecabuserdic/destroy'\n       route  get 'mecabuserdic/edit'\n       route  get 'mecabuserdic/update'\n       route  get 'mecabuserdic/create'\n       route  get 'mecabuserdic/new'\n      invoke  test_unit\n    conflict    test/controllers/mecabuserdic_controller_test.rb\n  Overwrite /home/admin/share/HelloRuby/my1stAPI/test/controllers/mecabuserdic_controller_test.rb? (enter \"h\" for help) [Ynaqdh] Y\n       force    test/controllers/mecabuserdic_controller_test.rb\n```\n\nAPI\u306a\u306e\u3067\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u3057\u306a\u3044\u8a2d\u5b9a\u306b\u3057\u307e\u3059\u3002\n(\u74b0\u5883\u5225\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u3044\u305f\u307b\u3046\u304c\u3088\u3057config/environments/development.rb)\n\n```ruby:config/application.rb\nmodule My1stAPI\n  class Application < Rails::Application\n.......................\n  config.action_controller.perform_caching  = false\n  end\nend\n```\n\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u3066\u30b5\u30fc\u30d0\u30fc\u518d\u8d77\u52d5\n\n```ruby:config/routes.rb\nRails.application.routes.draw do\n  get 'mecabuserdic/show' => 'mecabuserdic#show'\n\n  get 'mecabuserdic/new' => 'mecabuserdic#new'\n\n  get 'mecabuserdic/create' => 'mecabuserdic#create'\n\n  get 'mecabuserdic/update' => 'mecabuserdic#update'\n\n  get 'mecabuserdic/edit' => 'mecabuserdic#edit'\n\n  get 'mecabuserdic/destroy' => 'mecabuserdic#destroy'\n\n  get 'mecabuserdic/index' => 'mecabuserdic#index'\n\n  # For details on the DSL available within this file, see http://guides.rubyonrails.org/routing.html\n  get 'example2' => 'example2#show'\n  get 'example2/show2' => 'example2#show2'\nend\n```\n\n```ruby:app/controllers/mecabuserdic_controller.rb\nclass MecabuserdicController < ApplicationController\n  before_action :idcheck, only: [:update, :destroy]\n\n  def initialize\n    @targets = Array[\"sTitle\",\"iCost\",\"sClassification\",\"sClass1\",\"sClass2\",\"sClass3\",\"sConjugation\",\"sConjugation_type\",\"sOriginal\",\"sPronunciation1\",\"sPronunciation2\"]\n  end\n\n  def new\n    render json: Mecabuserdic.new\n  end\n\n  def create\n      record = {}\n      @targets.each do |key, val|\n        pval = params[key]\n        Rails.logger.warn \"Param #{key}: #{pval}\"\n        if params.has_key?(key)\n          sprintf(\"exists: %s = %s\",key,pval)\n          record[key] = val\n        end\n      end\n\n      colms = Mecabuserdic.new(record)\n      if colms.valid?\n        colms.save\n      end\n      render json: params\n  end\n\n  def update\n    selected = Mecabuserdic.find(@id)\n\n    @targets.each do |key, val|\n      if params.has_key?(key)\n        eval(sprintf(\"selected.%s = '%s'\",key,params[key]))\n      end\n    end\n    selected.save\n    render json:selected\n  end\n\n  def edit\n    testresult = [{\"error\":\"not implemented\"}]\n    render json: testresult\n  end\n\n  def destroy\n    selected = Mecabuserdic.find(@id)\n    selected.destroy\n    render json: selected\n  end\n\n  def index\n    testresult = [{\"error\":\"not implemented\"}]\n    render json: testresult\n  end\n\n  def show\n    render json: Mecabuserdic.all\n  end\n\n  private\n  def idcheck()\n    if !params.has_key?(\"id\")\n      showerr(sprintf(\"validation error %s \" ,params[\"id\"]))\n    else\n      @id = params[\"id\"]\n    end\n  end\n\n  def showerr(msg)\n    #Rails.logger.warn \"validation error: \"+ msg\n    render json: {\"msg\": \"validation error: \"+ msg} and return\n  end\n\nend\n```\n\n\u30ea\u30af\u30a8\u30b9\u30c8\u30b5\u30f3\u30d7\u30eb\n\n```text:\u884c\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u78ba\u8a8d\nhttp://192.168.10.5:3000/mecabuserdic/new\n```\n\n```text:\u65b0\u898f\u4f5c\u6210\nhttp://192.168.10.5:3000/mecabuserdic/create?sTitle=\u5929\u4e3c\u5b9a\u98df&iCost=1&sClassification=\u540d\u8a5e&sClass1=\u4e00\u822c&sClass2=*&sClass3=*&sConjugation=*&sConjugation_type=*&sOriginal=\u5929\u4e3c\u5b9a\u98df&sPronunciation1=\u30c6\u30f3\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af&sPronunciation2=\u30c6\u30f3\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af\n```\n\n```text:\u66f4\u65b0\nhttp://192.168.10.5:3000/mecabuserdic/update?id=980190966&sTitle=\u89aa\u5b50\u4e3c\u5b9a\u98df&iCost=1&sClassification=\u540d\u8a5e&sClass1=\u4e00\u822c&sClass2=*&sClass3=*&sConjugation=*&sConjugation_type=*&sOriginal=\u89aa\u5b50\u4e3c\u5b9a\u98df&sPronunciation1=\u30aa\u30e4\u30b3\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af&sPronunciation2=\u30aa\u30e4\u30b3\u30c9\u30f3\u30c6\u30a4\u30b7\u30e7\u30af\n```\n\n```text:\u524a\u9664\nhttp://192.168.10.5:3000/mecabuserdic/destroy?id=980190966\n```\n\n```text:\u4e00\u89a7\nhttp://192.168.10.5:3000/mecabuserdic/show\n```\n", "tags": ["Ruby", "on", "Rails", "5.0", "mariadb"]}