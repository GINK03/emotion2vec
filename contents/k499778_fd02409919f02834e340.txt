{"context": " More than 1 year has passed since last update.api/index.html\n\nindex.html\n<!DOCTYPE html>\n<html lang=\"ja\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>WebAPI test</title>\n</head>\n<body>\n  <h2>WebAPI</h2>\n  <h3>\u30ea\u30af\u30a8\u30b9\u30c8</h3>\n  <!-- \u30e6\u30fc\u30b6\u30bf\u30a4\u30d7\u3092\u5165\u529b\u3059\u308b\u30c6\u30ad\u30b9\u30c8\u30dc\u30c3\u30af\u30b9 -->\n  User Type:<input type=\"text\" name=\"dataType\" /><br>\n  <!-- \u5165\u529b\u3059\u308b\u5024\u306e\u9805\u76ee -->\n  <ul>\n    <li>a:Admin</li>\n    <li>o:Operator</li>\n    <li>g:Guest</li>\n    <li>e:Empty</li>\n  </ul>\n  <!-- ajax()\u3092\u5b9f\u884c\u3059\u308b\u30dc\u30bf\u30f3 -->\n  <button data-btn-type=\"ajax\">Data get!</button>\n  <br><br>\n  <h3>\u7d50\u679c</h3>\n  <!-- \u7d50\u679c\u8868\u793a\u7528\u306ediv\u30bf\u30b0 -->\n  <div data-result=\"\">\u672a\u53d6\u5f97</div>\n  <script src=\"../lib/jquery.js\"></script>\n  <script type=\"text/javascript\" src=\"api.js\"></script>\n  <!-- <script type=\"text/javascript\" src=\"api2.js\"></script> -->\n</body>\n</html>\n\n\n\n\napi/api/users.php\n\nusers.php\n\n<?php\nfunction returnJson($resultArray){\n  if(array_key_exists('callback', $_GET)){\n    $json = $_GET['callback'] . \"(\" . json_encode($resultArray) . \");\";\n  }else{\n    $json = json_encode($resultArray);\n  }\n  header('Content-Type: text/html; charset=utf-8');\n  echo  $json;\n  exit(0);\n}\n\n\n//---------------------------------------------------------\n//  \u51e6\u7406\u306e\u958b\u59cb\n//---------------------------------------------------------\n//  \u5024\u306e\u53d6\u5f97\uff08\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u53d7\u4ed8\uff09\n$type = $_REQUEST[\"user_type\"];\n\n//  \u30e6\u30fc\u30b6\u30ea\u30b9\u30c8\u306e\u521d\u671f\u5316\n$user_list = [];\n//  \u8fd4\u5374\u5024\u306e\u521d\u671f\u5316\n$result = [];\n\ntry {\n  //  \u5024\u306e\u691c\u8a3c\n  if (empty($type)) {\n    throw new Exception(\"no type...\");\n  }\n\n  //  \u30e6\u30fc\u30b6\u30ea\u30b9\u30c8\u306e\u4f5c\u6210\n  switch ($type) {\n    case 'a':\n    case 'admin':\n      $user_list = [\n        ['name'=>'\u4e2d\u5c45','age'=>18]\n      ];\n      break;\n    case 'o':\n    case 'operator':\n      $user_list = [\n        ['name'=>'\u6728\u6751','age'=>17],\n        ['name'=>'\u68ee','age'=>16]\n      ];\n      break;\n    case 'g':\n    case 'guest':\n      $user_list = [\n        ['name'=>'\u9999\u53d6','age'=>14],\n        ['name'=>'\u8349\u8599','age'=>15],\n        ['name'=>'\u7a32\u57a3','age'=>15],\n        ['name'=>'\u5ca1\u7530','age'=>15],\n        ['name'=>'\u68ee\u7530','age'=>15],\n        ['name'=>'\u4e09\u5b85','age'=>15],\n        ['name'=>'\u9577\u91ce','age'=>15],\n        ['name'=>'\u5742\u672c','age'=>15],\n        ['name'=>'\u4e95\u30ce\u539f','age'=>15]\n      ];\n      break;\n    default:\n      //  \u4e0d\u6b63\u306a\u5024\n      throw new Exception(\"Invalid value...\");\n      break;\n  }\n\n  //  \u8fd4\u5374\u5024\u306e\u4f5c\u6210\n  $result = [\n    'result' => 'OK',\n    'users' => $user_list\n  ];\n} catch (Exception $e) {\n  $result = [\n    'result' => 'NG',\n    'message' => $e->__toString()\n  ];\n}\n\n//  JSON\u3067\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u8fd4\u3059\nreturnJson($result);\n?>\n\n\n\n\napi/api.js\n\napi.js\n\n$(function() {\n  //  \u30af\u30ea\u30c3\u30af\u30a4\u30d9\u30f3\u30c8\u306bajax\u51e6\u7406\u3092\u767b\u9332\u3059\u308b\n  $('body').on('click', 'button[data-btn-type=ajax]', function(e) {\n    console.log('click btn');\n    //  \u30ea\u30af\u30a8\u30b9\u30c8\u306e\u4e0b\u6e96\u5099\n    //  \u30ea\u30af\u30a8\u30b9\u30c8\u6642\u306b\u4e00\u7dd2\u306b\u9001\u308b\u30c7\u30fc\u30bf\u306e\u4f5c\u6210\n    var send_data;\n    send_data = {\n      //  \u30c6\u30ad\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u306e\u5024\u3092\u8a2d\u5b9a\n      user_type : $('input').val()\n    };\n    console.log(send_data);\n    //  WebAPI\u3092\u53e9\u304f\n    $.ajax({\n      //  \u30ea\u30af\u30a8\u30b9\u30c8\u306e\u5185\u5bb9\n      type: \"POST\",\n      url: 'api/users.php',\n      dataType: \"json\",\n      data: send_data,\n      //  \u30ec\u30b9\u30dd\u30f3\u30b9\u6210\u529f\u6642\u306e\u51e6\u7406\n      success: function(responce) {\n        if (responce.result === \"OK\") {\n          console.log(\"\u6210\u529f\uff11\");\n          console.log(responce);\n          $('div[data-result=\"\"]').html(JSON.stringify(responce));\n        } else {\n          console.log(\"\u6210\u529f\uff12\");\n          console.log(responce);\n          $('div[data-result=\"\"]').html(JSON.stringify(responce));\n        }\n        return false;\n      },\n      //  \u30ec\u30b9\u30dd\u30f3\u30b9\u5931\u6557\u6642\u306e\u51e6\u7406\n      error: function(XMLHttpRequest, textStatus, errorThrown) {\n        console.log(\"\u30a8\u30e9\u30fc\");\n        console.log(XMLHttpRequest);\n        console.log(textStatus);\n        console.log(errorThrown);\n        $('div[data-result=\"\"]').html(JSON.stringify(\"\u30c7\u30fc\u30bf\u53d6\u5f97\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\"));\n        return false;\n      }\n    });\n    //  \u30d5\u30a9\u30fc\u30ab\u30b9\u3092\u30c6\u30ad\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u306b\u5408\u308f\u305b\u308b\n    $('input').focus();\n\n    return false;\n  });\n});\n\n\n\n\napi/index.html\n\n```html:index.html\n<!DOCTYPE html>\n<html lang=\"ja\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>WebAPI test</title>\n</head>\n<body>\n  <h2>WebAPI</h2>\n  <h3>\u30ea\u30af\u30a8\u30b9\u30c8</h3>\n  <!-- \u30e6\u30fc\u30b6\u30bf\u30a4\u30d7\u3092\u5165\u529b\u3059\u308b\u30c6\u30ad\u30b9\u30c8\u30dc\u30c3\u30af\u30b9 -->\n  User Type:<input type=\"text\" name=\"dataType\" /><br>\n  <!-- \u5165\u529b\u3059\u308b\u5024\u306e\u9805\u76ee -->\n  <ul>\n    <li>a:Admin</li>\n    <li>o:Operator</li>\n    <li>g:Guest</li>\n    <li>e:Empty</li>\n  </ul>\n  <!-- ajax()\u3092\u5b9f\u884c\u3059\u308b\u30dc\u30bf\u30f3 -->\n  <button data-btn-type=\"ajax\">Data get!</button>\n  <br><br>\n  <h3>\u7d50\u679c</h3>\n  <!-- \u7d50\u679c\u8868\u793a\u7528\u306ediv\u30bf\u30b0 -->\n  <div data-result=\"\">\u672a\u53d6\u5f97</div>\n  <script src=\"../lib/jquery.js\"></script>\n  <script type=\"text/javascript\" src=\"api.js\"></script>\n  <!-- <script type=\"text/javascript\" src=\"api2.js\"></script> -->\n</body>\n</html>\n\n```\n\n\n<br>\napi/api/users.php\n\n```php:users.php\n\n<?php\nfunction returnJson($resultArray){\n  if(array_key_exists('callback', $_GET)){\n    $json = $_GET['callback'] . \"(\" . json_encode($resultArray) . \");\";\n  }else{\n    $json = json_encode($resultArray);\n  }\n  header('Content-Type: text/html; charset=utf-8');\n  echo  $json;\n  exit(0);\n}\n\n\n//---------------------------------------------------------\n//  \u51e6\u7406\u306e\u958b\u59cb\n//---------------------------------------------------------\n//  \u5024\u306e\u53d6\u5f97\uff08\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u53d7\u4ed8\uff09\n$type = $_REQUEST[\"user_type\"];\n\n//  \u30e6\u30fc\u30b6\u30ea\u30b9\u30c8\u306e\u521d\u671f\u5316\n$user_list = [];\n//  \u8fd4\u5374\u5024\u306e\u521d\u671f\u5316\n$result = [];\n\ntry {\n  //  \u5024\u306e\u691c\u8a3c\n  if (empty($type)) {\n    throw new Exception(\"no type...\");\n  }\n\n  //  \u30e6\u30fc\u30b6\u30ea\u30b9\u30c8\u306e\u4f5c\u6210\n  switch ($type) {\n    case 'a':\n    case 'admin':\n      $user_list = [\n        ['name'=>'\u4e2d\u5c45','age'=>18]\n      ];\n      break;\n    case 'o':\n    case 'operator':\n      $user_list = [\n        ['name'=>'\u6728\u6751','age'=>17],\n        ['name'=>'\u68ee','age'=>16]\n      ];\n      break;\n    case 'g':\n    case 'guest':\n      $user_list = [\n        ['name'=>'\u9999\u53d6','age'=>14],\n        ['name'=>'\u8349\u8599','age'=>15],\n        ['name'=>'\u7a32\u57a3','age'=>15],\n        ['name'=>'\u5ca1\u7530','age'=>15],\n        ['name'=>'\u68ee\u7530','age'=>15],\n        ['name'=>'\u4e09\u5b85','age'=>15],\n        ['name'=>'\u9577\u91ce','age'=>15],\n        ['name'=>'\u5742\u672c','age'=>15],\n        ['name'=>'\u4e95\u30ce\u539f','age'=>15]\n      ];\n      break;\n    default:\n      //  \u4e0d\u6b63\u306a\u5024\n      throw new Exception(\"Invalid value...\");\n      break;\n  }\n\n  //  \u8fd4\u5374\u5024\u306e\u4f5c\u6210\n  $result = [\n    'result' => 'OK',\n    'users' => $user_list\n  ];\n} catch (Exception $e) {\n  $result = [\n    'result' => 'NG',\n    'message' => $e->__toString()\n  ];\n}\n\n//  JSON\u3067\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u8fd4\u3059\nreturnJson($result);\n?>\n\n```\n\n\n<br>\napi/api.js\n\n```js:api.js\n\n$(function() {\n  //  \u30af\u30ea\u30c3\u30af\u30a4\u30d9\u30f3\u30c8\u306bajax\u51e6\u7406\u3092\u767b\u9332\u3059\u308b\n  $('body').on('click', 'button[data-btn-type=ajax]', function(e) {\n    console.log('click btn');\n    //  \u30ea\u30af\u30a8\u30b9\u30c8\u306e\u4e0b\u6e96\u5099\n    //  \u30ea\u30af\u30a8\u30b9\u30c8\u6642\u306b\u4e00\u7dd2\u306b\u9001\u308b\u30c7\u30fc\u30bf\u306e\u4f5c\u6210\n    var send_data;\n    send_data = {\n      //  \u30c6\u30ad\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u306e\u5024\u3092\u8a2d\u5b9a\n      user_type : $('input').val()\n    };\n    console.log(send_data);\n    //  WebAPI\u3092\u53e9\u304f\n    $.ajax({\n      //  \u30ea\u30af\u30a8\u30b9\u30c8\u306e\u5185\u5bb9\n      type: \"POST\",\n      url: 'api/users.php',\n      dataType: \"json\",\n      data: send_data,\n      //  \u30ec\u30b9\u30dd\u30f3\u30b9\u6210\u529f\u6642\u306e\u51e6\u7406\n      success: function(responce) {\n        if (responce.result === \"OK\") {\n          console.log(\"\u6210\u529f\uff11\");\n          console.log(responce);\n          $('div[data-result=\"\"]').html(JSON.stringify(responce));\n        } else {\n          console.log(\"\u6210\u529f\uff12\");\n          console.log(responce);\n          $('div[data-result=\"\"]').html(JSON.stringify(responce));\n        }\n        return false;\n      },\n      //  \u30ec\u30b9\u30dd\u30f3\u30b9\u5931\u6557\u6642\u306e\u51e6\u7406\n      error: function(XMLHttpRequest, textStatus, errorThrown) {\n        console.log(\"\u30a8\u30e9\u30fc\");\n        console.log(XMLHttpRequest);\n        console.log(textStatus);\n        console.log(errorThrown);\n        $('div[data-result=\"\"]').html(JSON.stringify(\"\u30c7\u30fc\u30bf\u53d6\u5f97\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\"));\n        return false;\n      }\n    });\n    //  \u30d5\u30a9\u30fc\u30ab\u30b9\u3092\u30c6\u30ad\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u306b\u5408\u308f\u305b\u308b\n    $('input').focus();\n\n    return false;\n  });\n});\n\n\n```\n\n", "tags": ["PHP", "jQuery", "Ajax"]}