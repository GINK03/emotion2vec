{"tags": ["Home@KAIT", "node-red", "ECHONET", "ECHONETLite"], "context": "\n\n\u6982\u8981\n\u3000Node-RED\u306bdefault\u3067install\u3055\u308c\u308bUDP\u306e\u9001\u4fe1node\u3068\u53d7\u4fe1node\u3092\u5229\u7528\u3057\u3066\u3001ECHONET Lite\u306e\u9001\u53d7\u4fe1\u3092\u5bb9\u6613\u306b\u3059\u308bnode\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\u53d7\u4fe1\u3057\u305fUDP data\u306f\u30d1\u30fc\u30b9\u3055\u308cECHONET Lite\u3067\u898f\u5b9a\u3055\u308c\u308b\u30d6\u30ed\u30c3\u30af\u306b\u5206\u89e3\u3055\u308c\u307e\u3059\u3002\u30c7\u30fc\u30bf\u3092\u9001\u4fe1\u3059\u308b\u5834\u5408\u306fECHONET Lite\u3067\u898f\u5b9a\u3055\u308c\u308b\u5404\u30d6\u30ed\u30c3\u30af\u306e\u5024\u3092\u5f15\u6570\u3068\u3057\u3066\u6e21\u3057\u307e\u3059\u3002ECHONET Lite\u306f\u30d0\u30a4\u30c8\u5358\u4f4d\u3067\u30d1\u30b1\u30c3\u30c8\u304c\u69cb\u6210\u3055\u308c\u307e\u3059\u304c\u3001UInt8\u306edata type\u3092\u6301\u305f\u306a\u3044JavaScript\u3067\u306f\u6271\u3044\u306b\u304f\u3044\u305f\u3081\u3001\u30c7\u30fc\u30bf\u306fInt\u3067\u6e21\u3057\u307e\u3059\u3002\n\u3000\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\u3068\u3057\u3066\u4ee5\u4e0b\u306e\uff13\u3064\u3092\u7528\u610f\u3057\u307e\u3057\u305f\u3002\n\nNode-RED\u304b\u3089\u30de\u30cb\u30e5\u30a2\u30eb\u3067\u30a8\u30a2\u30b3\u30f3\u3068\u7167\u660e\u306eON/OFF\u5236\u5fa1\n\u96fb\u5b50\u9320\u306e\u958b\u9589\u3067\u30a8\u30a2\u30b3\u30f3\u3068\u7167\u660e\u306eON/OFF\u5236\u5fa1\n\u30b9\u30de\u30db\u306e\u30d6\u30e9\u30a6\u30b6\u30fc\u3092\u30a8\u30a2\u30b3\u30f3\u3068\u7167\u660e\u306eON/OFF\u5236\u5fa1\u30ea\u30e2\u30b3\u30f3\u306b\u3059\u308bweb application\n\n\u306a\u304a\u3001\u4ee5\u4e0b\u306e\u74b0\u5883\u3067\u52d5\u4f5c\u78ba\u8a8d\u3057\u3066\u3044\u307e\u3059\u3002\nNode-RED version: v0.15.1\nNode.js  version: v6.9.1\n\u5168\u4f53\u306eFLOW\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n\n\u9001\u4fe1\n\u307e\u305a\u9001\u4fe1\u5074\u304b\u3089\u898b\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\u753b\u9762\u4e0a\u3067\u300cEL send\u300d\u3068\u8868\u793a\u3055\u308c\u3066\u3044\u308bUDP\u306e\u9001\u4fe1\u30ce\u30fc\u30c9\u306e\u8a2d\u5b9a\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002to port\u306b3610\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u3053\u306eudp node\u306e\u5165\u529b\u5074\u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u300cSend EL1\u300d\u3068\u3044\u3046function node\u306e\u4e2d\u8eab\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u304c\u3001\u7406\u89e3\u3057\u306a\u304f\u3066\u3082\u4f7f\u3048\u307e\u3059\u3002\n// Send ECHONET Lite packet\n// Assumption: OPC = 1\n//\n//  Usage:\n//      Input following data\n//\n//  msg.els.ip      // ip address (String)\n//  msg.els.tid     // TID (Int)\n//  msg.els.seoj    // SEOJ ([Int:device, Int:instance])\n//  msg.els.deoj    // DEOJ ([Int:device, Int:instance])\n//  msg.els.esv     // ESV (Int)\n//  msg.els.epc     // EPC (Int)\n//  msg.els.edt     // EDT ([Int])\n//          // in case of no EDT data, no edt or []\n\nconst tid_buffer = Buffer.allocUnsafe(2);\nlet   seoj_buffer = Buffer.allocUnsafe(3);\nconst seoj = msg.els.seoj;\nlet   deoj_buffer = Buffer.allocUnsafe(3);\nconst deoj = msg.els.deoj;\nconst esv_buffer = Buffer.allocUnsafe(1);\nconst opc_buffer = Buffer.from([1]);\nconst epc_buffer = Buffer.allocUnsafe(1);\nconst pdc_buffer = Buffer.allocUnsafe(1);\nlet edt = msg.els.edt;\n\ntid_buffer.writeUInt16BE(msg.els.tid, 0);\nesv_buffer.writeUInt8(msg.els.esv, 0);\nepc_buffer.writeUInt8(msg.els.epc, 0);\n\nseoj_buffer.writeUInt16BE(seoj[0], 0);\nseoj_buffer.writeUInt8(seoj[1], 2);\ndeoj_buffer.writeUInt16BE(deoj[0], 0);\ndeoj_buffer.writeUInt8(deoj[1], 2);\n\n// edt[]\u304b\u3089edt_buffer\u3092\u4f5c\u6210\nif ((typeof edt) == \"undefined\") {\n    edt = [];\n}\n\nconst edt_buffer = Buffer.allocUnsafe(edt.length);\nfor (var i = 0; i < edt.length; i++) {\n    edt_buffer.writeUInt8(edt[i], i);\n}\n\npdc_buffer.writeUInt8(edt_buffer.length, 0);\n\n// Create ECHONET Lite packet\nconst el_buffer = Buffer.from([\n    0x10, 0x81,\n    tid_buffer[0], tid_buffer[1],\n    seoj_buffer[0], seoj_buffer[1], seoj_buffer[2],\n    deoj_buffer[0], deoj_buffer[1], deoj_buffer[2],\n    esv_buffer[0], opc_buffer[0], epc_buffer[0], pdc_buffer[0]]);\n\n// add EDT data\nif (edt_buffer.length !== 0) {\n    msg.payload = Buffer.concat([el_buffer, edt_buffer], \n        (el_buffer.length + edt_buffer.length));\n} else {\n    msg.payload = el_buffer;\n}\n\nmsg.ip = msg.els.ip;\nreturn msg;\n\n\u3000\u5192\u982d\u306e\u30b3\u30e1\u30f3\u30c8\u306b\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u306b\u3001\u3053\u306efunction\u306b\u4ee5\u4e0b\u306e\u30c7\u30fc\u30bf\u3092\u6e21\u3057\u3066\u3084\u308b\u3068\u3001byte\u5217\u306eECHONET Lite\u30c7\u30fc\u30bf\u30d1\u30b1\u30c3\u30c8\u306b\u5909\u63db\u3057\u3066udp node\u306b\u6e21\u3057\u307e\u3059\u3002\u306a\u304a\u3001OPC=1\u306e\u307f\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\n\nmsg.els.ip      // ip address (String)\nmsg.els.tid     // TID (Int)\nmsg.els.seoj    // SEOJ ([Int:device, Int:instance])\nmsg.els.deoj    // DEOJ ([Int:device, Int:instance])\nmsg.els.esv     // ESV (Int)\nmsg.els.epc     // EPC (Int)\nmsg.els.edt     // EDT ([Int])\n\n\u5177\u4f53\u7684\u306b\u306f\u3001\u3053\u306e\u300cSend EL1\u300dfunction\u306e\u5165\u529b\u5074\u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u300c\u30a8\u30a2\u30b3\u30f3 ON\u300dfunction\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\nmsg.els = {\n    \"ip\" : \"224.0.23.0\",\n    \"tid\" : 5,\n    \"seoj\" : [0x05ff,1],\n    \"deoj\" : [0x0130,1],\n    \"esv\" : 0x61,\n    \"epc\" : 0x80,\n    \"edt\" : [0x30]\n};\n\nreturn msg;\n\n\u3053\u306efunction\u5185\u306e\u5fc5\u8981\u306a\u7b87\u6240\u306e\u5024\u3092\u5909\u66f4\u3059\u308b\u3060\u3051\u3067\u3001ECHONET Lite\u306e\u30c7\u30fc\u30bf\u9001\u4fe1\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002\n\n\u53d7\u4fe1\n\u7d9a\u3044\u3066\u53d7\u4fe1\u5074\u3092\u898b\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\u753b\u9762\u4e0a\u3067\u300cEL receive\u300d\u3068\u8868\u793a\u3055\u308c\u3066\u3044\u308bUDP\u306e\u53d7\u4fe1\u30ce\u30fc\u30c9\u306e\u8a2d\u5b9a\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u300cListen for\u300d\u3067\u300cmulticast message\u300d\u3092\u9078\u629e\u3057\u3001\u300cGroup\u300d\u306b224.0.23.0\u3092\u300con port\u300d\u306b3610\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u300cOutput\u300d\u306f\u300ca Buffer\u300d\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u3053\u306eudp node\u306e\u51fa\u529b\u5074\u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u300cParse EL1\u300d\u3068\u3044\u3046function node\u306e\u4e2d\u8eab\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u304c\u3001\u7406\u89e3\u3057\u306a\u304f\u3066\u3082\u4f7f\u3048\u307e\u3059\u3002\n// Parse ECHONET Lite packet\n// Assumption: OPC = 1\n\n//  OUTPUT:\n//  msg.elr.ip      // ip address (String)\n//  msg.elr.ehd     // EHD (Int)\n//  msg.elr.tid     // TID (Int)\n//  msg.elr.seoj    // SEOJ ([Int:device, Int:instance])\n//  msg.elr.deoj    // DEOJ ([Int:device, Int:instance])\n//  msg.elr.esv     // ESV (Int)\n//  msg.elr.opc     // OPC (Int)\n//  msg.elr.epc     // EPC (Int)\n//  msg.elr.pdc     // PDC (Int)\n//  msg.elr.edt     // EDT ([Int]) or [](no EDT data)\n\nconst buffer = msg.payload;\nmsg.elr = null;\n\nif (buffer.length >= 14) {\n  const ehd_buffer = buffer.slice(0, 2);\n  const tid_buffer = buffer.slice(2, 4);\n  const seoj_device_buffer = buffer.slice(4, 6);\n  const seoj_instance_buffer = buffer.slice(6, 7);\n  const deoj_device_buffer = buffer.slice(7, 9);\n  const deoj_instance_buffer = buffer.slice(9, 10);\n  const esv_buffer = buffer.slice(10, 11);\n  const opc_buffer = buffer.slice(11, 12);\n  const epc_buffer = buffer.slice(12, 13);\n  const pdc_buffer = buffer.slice(13, 14);\n\n  const ehd = ehd_buffer.readUInt16BE(0);\n  const tid = tid_buffer.readUInt16BE(0);\n  const seoj_device = seoj_device_buffer.readUInt16BE(0);\n  const seoj_instance = seoj_instance_buffer.readUInt8(0);\n  const seoj = [seoj_device, seoj_instance];\n  const deoj_device = deoj_device_buffer.readUInt16BE(0);\n  const deoj_instance = deoj_instance_buffer.readUInt8(0);\n  const deoj = [deoj_device, deoj_instance];\n  const esv = esv_buffer.readUInt8(0);\n  const opc = opc_buffer.readUInt8(0);\n  const epc = epc_buffer.readUInt8(0);\n  const pdc = pdc_buffer.readUInt8(0);\n  let edt = [];\n\n  if (buffer.length >= 15) {\n    const edt_buffer = buffer.slice(14);\n    for (var i = 0; i < edt_buffer.length; i++) {\n        edt[i] = edt_buffer.readUInt8(i);\n    }\n  }\n\n  // ECHONET Lite header check\n  if (ehd == 0x1081) {\n    msg.elr = {\n        \"ip\"            : msg.ip,\n        \"ehd\"           : ehd,\n        \"tid\"           : tid,\n        \"seoj\"          : seoj,\n        \"deoj\"          : deoj,\n        \"esv\"           : esv,\n        \"opc\"           : opc,\n        \"epc\"           : epc,\n        \"pdc\"           : pdc,\n        \"edt\"           : edt\n    };\n  }\n}\n\nreturn msg;\n\n\u3000\u5192\u982d\u306e\u30b3\u30e1\u30f3\u30c8\u306b\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u306b\u3001\u3053\u306efunction\u304b\u3089\u4ee5\u4e0b\u306e\u30c7\u30fc\u30bf\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\u306a\u304a\u3001OPC=1\u306e\u307f\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\n\nmsg.elr.ip      // ip address (String)\nmsg.elr.ehd     // EHD (Int)\nmsg.elr.tid     // TID (Int)\nmsg.elr.seoj    // SEOJ ([Int:device, Int:instance])\nmsg.elr.deoj    // DEOJ ([Int:device, Int:instance])\nmsg.elr.esv     // ESV (Int)\nmsg.elr.opc     // OPC (Int)\nmsg.elr.epc     // EPC (Int)\nmsg.elr.pdc     // PDC (Int)\nmsg.elr.edt     // EDT ([Int])\n\n\u30d1\u30fc\u30b9\u3055\u308c\u305f\u30c7\u30fc\u30bf\u306e\u4f7f\u3044\u65b9\u306e\u4f8b\u3092\u3001\u3053\u306e\u300cParse EL1\u300dfunction\u306e\u51fa\u529b\u5074\u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u300cfilter keyStatus\u300dfunction\u3067\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u53d7\u4fe1\u3057\u305f\u30c7\u30fc\u30bf\u306e\u9001\u4fe1\u5143\u304c\u300c\u96fb\u5b50\u9320\u300d\u3067\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u304c\u300c\u958b\u9589\u72b6\u614b\u300d\u306a\u3089\u3070\u3001\u958b\u9589\u72b6\u614b\u3092\u8868\u3059EDT\u30c7\u30fc\u30bf\u3092msg.payload\u306b\u683c\u7d0d\u3057\u3066\u3044\u307e\u3059\u3002\u6b21\u306eswitch node\u3067\u9589(0x41)\u307e\u305f\u306f\u958b(0x42)\u3067\u5206\u5c90\u3057\u3001\u30a8\u30a2\u30b3\u30f3\u3084\u7167\u660e\u3092ON/OFF\u5236\u5fa1\u3057\u3066\u3044\u307e\u3059\u3002\n// \u96fb\u5b50\u9320 EOJ=0x026f, \u958b\u9589\u72b6\u614b EPC=0xe0\nif ((msg.elr.seoj[0] == 0x026f) && (msg.elr.epc == 0xe0)) {\n    msg.payload = msg.elr.edt[0];\n}\n\nreturn msg;\n\n\nWeb\u30ea\u30e2\u30b3\u30f3\nNode-RED\u306fweb server\u6a5f\u80fd\u3092\u3082\u3063\u3066\u3044\u308b\u306e\u3067\u3001web application\u3092\u5bb9\u6613\u306b\u4f5c\u6210\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u5168\u4f53Flow\u306e\u4e0b\u90e8\u306e\u300cON/OFF Remote Controller\u300d\u3092\u898b\u3066\u304f\u3060\u3055\u3044\u3002\u30b9\u30de\u30db\u306e\u30d6\u30e9\u30a6\u30b6\u3067\n\nhttp://:1880/control\n\n\u3092\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001\u3053\u306e\u3088\u3046\u306a\u30b7\u30f3\u30d7\u30eb\u306a\u30ea\u30e2\u30b3\u30f3\u753b\u9762\u304c\u73fe\u308c\u307e\u3059\u3002\u3053\u306eON/OFF\u30dc\u30bf\u30f3\u3067\u30a8\u30a2\u30b3\u30f3\u3084\u7167\u660e\u3092ON/OFF\u5236\u5fa1\u3067\u304d\u307e\u3059\u3002\n\n\u5168\u4f53\u306eFlow\u306e\u5de6\u4e0b\u90e8\u306b\u3042\u308b\u300c/control\u300d\u3068\u66f8\u304b\u308c\u305fhttp node\u3067GET request\u3092\u53d7\u3051\u4ed8\u3051\u307e\u3059\u3002\u3053\u306enode\u306fURL\u306b\u300c/control\u300d\u3068\u5165\u529b\u3057\u3066\u3042\u308b\u3060\u3051\u3067\u3059\u3002\u3053\u306enode\u306e\u51fa\u529b\u304c\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u300cON/OFF button\u300d\u3068\u66f8\u304b\u308c\u305ftemplate node\u304cHTML\u3092\u51fa\u529b\u3057\u3066\u3001\u30d6\u30e9\u30a6\u30b6\u30fc\u306b\u30dc\u30bf\u30f3\u3092\u8868\u793a\u3057\u307e\u3059\u3002template node\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n<!DOCTYPE html>\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n    <meta charset=\u201cUFT-8\u201d>\n    <style>\n        body { background: #FAFAD2; }\n        h1 {color:black; font-family:sans-serif;}\n        button { width: 300px; height: 100px; font-size: 36px; border-radius: 10px; border-style: none; background-color: #aaaaaa;}\n        button:hover {background-color: #dddddd;}\n    </style>\n    <title> ON/OFF BUTTON </title>\n    <script language=\"javascript\" type=\"text/javascript\">\n        function OnButtonClick() {\n            location.href = \"/on\";\n        }\n        function OffButtonClick() {\n            location.href = \"/off\";\n        }\n    </script>\n</head>\n<body>\n    <h1>HEMS Controller</h1>\n    <button type=\"button\" name=\"buttonOn\" onclick=\"OnButtonClick()\">ON</button> \n    <button type=\"button\" name=\"buttonOff\" onclick=\"OffButtonClick()\">OFF</button> <br/>\n</body>\n</html>\n\n\u3053\u306eHTML\u304chttp response node\u304b\u3089\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\n\u5168\u4f53\u306eFlow\n\u5168\u4f53\u306eFlow\u306eJSON\u30c7\u30fc\u30bf\u306f\u3053\u3061\u3089\u3067\u3059\u3002\n[{\"id\":\"929982f7.1dfe88\",\"type\":\"inject\",\"z\":\"b25212d8.336a88\",\"name\":\"Search\",\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"repeat\":\"\",\"crontab\":\"\",\"once\":false,\"x\":145.63636779785156,\"y\":159,\"wires\":[[\"48da7a43.d0e234\"]]},{\"id\":\"2ab8c00.fd8fd4\",\"type\":\"link in\",\"z\":\"b25212d8.336a88\",\"name\":\"ON\",\"links\":[\"60038e3d.3ea5\",\"60579462.f009ac\",\"a47b7d1b.85f958\"],\"x\":144,\"y\":242.18182373046875,\"wires\":[[\"8f824877.268258\",\"30b813d1.96d6f4\"]]},{\"id\":\"7bab7379.ce52ac\",\"type\":\"link in\",\"z\":\"b25212d8.336a88\",\"name\":\"OFF\",\"links\":[\"19f3c295.8e39bd\",\"49fe4793.c299c8\",\"d6714c57.f29c38\"],\"x\":146,\"y\":329.18182373046875,\"wires\":[[\"46ac93c4.9bf35c\",\"2bcde2cc.b0e0b6\"]]},{\"id\":\"4f1896ac.7cfcb\",\"type\":\"comment\",\"z\":\"b25212d8.336a88\",\"name\":\"Check Key Status\",\"info\":\"\u96fb\u5b50\u9320\u306eOn/OFF\u3067\u30a8\u30a2\u30b3\u30f3\u3068\u7167\u660e\u306eON/OFF\u3092\u5236\u5fa1\",\"x\":128.22727966308594,\"y\":422.5454406738281,\"wires\":[]},{\"id\":\"e46582fe.0e69b\",\"type\":\"comment\",\"z\":\"b25212d8.336a88\",\"name\":\"Flow: demoRoom\",\"info\":\"ECHONET Lite\u306e\u9001\u53d7\u4fe1\u3092\u5b9f\u73fe\u3002\\nBrowser\u3067\u63a5\u7d9a\u3059\u308b\u3068ON/OFF\u5236\u5fa1\u306e\u30ea\u30e2\u30b3\u30f3\u3068\u306a\u308b\u3002\",\"x\":138.86363220214844,\"y\":114.81817626953125,\"wires\":[]},{\"id\":\"6e147962.3b1508\",\"type\":\"http in\",\"z\":\"b25212d8.336a88\",\"name\":\"/on\",\"url\":\"/on\",\"method\":\"get\",\"swaggerDoc\":\"\",\"x\":87.5,\"y\":628.1818237304688,\"wires\":[[\"a47b7d1b.85f958\",\"cd5ec784.0801d8\"]]},{\"id\":\"a47b7d1b.85f958\",\"type\":\"link out\",\"z\":\"b25212d8.336a88\",\"name\":\"REST/on\",\"links\":[\"2ab8c00.fd8fd4\"],\"x\":219.5,\"y\":627.1818313598633,\"wires\":[]},{\"id\":\"85a91f31.a3686\",\"type\":\"http in\",\"z\":\"b25212d8.336a88\",\"name\":\"/off\",\"url\":\"/off\",\"method\":\"get\",\"swaggerDoc\":\"\",\"x\":88,\"y\":669.1818237304688,\"wires\":[[\"d6714c57.f29c38\",\"cd5ec784.0801d8\"]]},{\"id\":\"d6714c57.f29c38\",\"type\":\"link out\",\"z\":\"b25212d8.336a88\",\"name\":\"REST/off\",\"links\":[\"7bab7379.ce52ac\"],\"x\":217.5,\"y\":668.1818237304688,\"wires\":[]},{\"id\":\"e35592e3.6ced4\",\"type\":\"http in\",\"z\":\"b25212d8.336a88\",\"name\":\"/control\",\"url\":\"/control\",\"method\":\"get\",\"swaggerDoc\":\"\",\"x\":87,\"y\":710.1818237304688,\"wires\":[[\"387d2a5d.fa9d76\",\"cd5ec784.0801d8\"]]},{\"id\":\"8bb17ee2.8b71c\",\"type\":\"http response\",\"z\":\"b25212d8.336a88\",\"name\":\"\",\"x\":596.5,\"y\":654.1818237304688,\"wires\":[]},{\"id\":\"387d2a5d.fa9d76\",\"type\":\"debug\",\"z\":\"b25212d8.336a88\",\"name\":\"\",\"active\":true,\"console\":\"false\",\"complete\":\"true\",\"x\":371.5,\"y\":709.1818313598633,\"wires\":[]},{\"id\":\"dfdee8d8.e1e74\",\"type\":\"comment\",\"z\":\"b25212d8.336a88\",\"name\":\"ON/OFF Remote Controller\",\"info\":\"Browser\u3067\u63a5\u7d9a\u3059\u308b\u3068\u3001ON/OFF\u5236\u5fa1\u306e\u30dc\u30bf\u30f3\u304c\u8868\u793a\u3055\u308c\u308b\\n\\nhttp://<Node-red\u306eIP address>:1880/control\",\"x\":149.5,\"y\":588.1818237304688,\"wires\":[]},{\"id\":\"baad2d25.311cc8\",\"type\":\"debug\",\"z\":\"b25212d8.336a88\",\"name\":\"\",\"active\":true,\"console\":\"false\",\"complete\":\"true\",\"x\":601.5,\"y\":705.1818237304688,\"wires\":[]},{\"id\":\"cd5ec784.0801d8\",\"type\":\"template\",\"z\":\"b25212d8.336a88\",\"name\":\"ON/OFF button\",\"field\":\"payload\",\"fieldType\":\"msg\",\"format\":\"html\",\"syntax\":\"mustache\",\"template\":\"<!DOCTYPE html>\\n<html xmlns=\\\"http://www.w3.org/1999/xhtml\\\">\\n<head>\\n    <meta charset=\u201cUFT-8\u201d>\\n    <style>\\n        body { background: #FAFAD2; }\\n        h1 {color:black; font-family:sans-serif;}\\n        button { width: 300px; height: 100px; font-size: 36px; border-radius: 10px; border-style: none; background-color: #aaaaaa;}\\n        button:hover {background-color: #dddddd;}\\n    </style>\\n    <title> ON/OFF BUTTON </title>\\n    <script language=\\\"javascript\\\" type=\\\"text/javascript\\\">\\n        function OnButtonClick() {\\n            location.href = \\\"/on\\\";\\n        }\\n        function OffButtonClick() {\\n            location.href = \\\"/off\\\";\\n        }\\n    </script>\\n</head>\\n<body>\\n\\t<h1>HEMS Controller</h1>\\n    <button type=\\\"button\\\" name=\\\"buttonOn\\\" onclick=\\\"OnButtonClick()\\\">ON</button> \\n    <button type=\\\"button\\\" name=\\\"buttonOff\\\" onclick=\\\"OffButtonClick()\\\">OFF</button> <br/>\\n</body>\\n</html>\",\"x\":389.5,\"y\":653.1818237304688,\"wires\":[[\"8bb17ee2.8b71c\",\"baad2d25.311cc8\"]]},{\"id\":\"2cd805cd.f6b84a\",\"type\":\"function\",\"z\":\"b25212d8.336a88\",\"name\":\"Parse EL1\",\"func\":\"// Parse ECHONET Lite packet\\n// Assumption: OPC = 1\\n\\n//  OUTPUT:\\n//  msg.elr.ip      // ip address (String)\\n//  msg.elr.ehd     // EHD (Int)\\n//  msg.elr.tid     // TID (Int)\\n//  msg.elr.seoj    // SEOJ ([Int:device, Int:instance])\\n//  msg.elr.deoj    // DEOJ ([Int:device, Int:instance])\\n//  msg.elr.esv     // ESV (Int)\\n//  msg.elr.opc     // OPC (Int)\\n//  msg.elr.epc     // EPC (Int)\\n//  msg.elr.pdc     // PDC (Int)\\n//  msg.elr.edt     // EDT ([Int]) or [](no EDT data)\\n\\nconst buffer = msg.payload;\\nmsg.elr = null;\\n\\nif (buffer.length >= 14) {\\n  const ehd_buffer = buffer.slice(0, 2);\\n  const tid_buffer = buffer.slice(2, 4);\\n  const seoj_device_buffer = buffer.slice(4, 6);\\n  const seoj_instance_buffer = buffer.slice(6, 7);\\n  const deoj_device_buffer = buffer.slice(7, 9);\\n  const deoj_instance_buffer = buffer.slice(9, 10);\\n  const esv_buffer = buffer.slice(10, 11);\\n  const opc_buffer = buffer.slice(11, 12);\\n  const epc_buffer = buffer.slice(12, 13);\\n  const pdc_buffer = buffer.slice(13, 14);\\n\\n  const ehd = ehd_buffer.readUInt16BE(0);\\n  const tid = tid_buffer.readUInt16BE(0);\\n  const seoj_device = seoj_device_buffer.readUInt16BE(0);\\n  const seoj_instance = seoj_instance_buffer.readUInt8(0);\\n  const seoj = [seoj_device, seoj_instance];\\n  const deoj_device = deoj_device_buffer.readUInt16BE(0);\\n  const deoj_instance = deoj_instance_buffer.readUInt8(0);\\n  const deoj = [deoj_device, deoj_instance];\\n  const esv = esv_buffer.readUInt8(0);\\n  const opc = opc_buffer.readUInt8(0);\\n  const epc = epc_buffer.readUInt8(0);\\n  const pdc = pdc_buffer.readUInt8(0);\\n  let edt = [];\\n  \\n  if (buffer.length >= 15) {\\n    const edt_buffer = buffer.slice(14);\\n    for (var i = 0; i < edt_buffer.length; i++) {\\n        edt[i] = edt_buffer.readUInt8(i);\\n    }\\n  }\\n\\n  // ECHONET Lite header check\\n  if (ehd == 0x1081) {\\n    msg.elr = {\\n        \\\"ip\\\"            : msg.ip,\\n        \\\"ehd\\\"           : ehd,\\n        \\\"tid\\\"           : tid,\\n        \\\"seoj\\\"          : seoj,\\n        \\\"deoj\\\"          : deoj,\\n        \\\"esv\\\"           : esv,\\n        \\\"opc\\\"           : opc,\\n        \\\"epc\\\"           : epc,\\n        \\\"pdc\\\"           : pdc,\\n        \\\"edt\\\"           : edt\\n    };\\n  }\\n}\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":324,\"y\":458,\"wires\":[[\"f79f22e2.9b9448\",\"c709dd31.ebd05\"]]},{\"id\":\"f79f22e2.9b9448\",\"type\":\"function\",\"z\":\"b25212d8.336a88\",\"name\":\"filter keyStatus\",\"func\":\"//  msg.elr.ip      // ip address (String)\\n//  msg.elr.ehd     // EHD (Int)\\n//  msg.elr.tid     // TID (Int)\\n//  msg.elr.seoj    // SEOJ ([Int:device, Int:instance])\\n//  msg.elr.deoj    // DEOJ ([Int:device, Int:instance])\\n//  msg.elr.esv     // ESV (Int)\\n//  msg.elr.opc     // OPC (Int)\\n//  msg.elr.epc     // EPC (Int)\\n//  msg.elr.pdc     // PDC (Int)\\n//  msg.elr.edt     // EDT ([Int]) or [](no EDT data)\\n\\n// \u96fb\u5b50\u9320 EOJ=0x026f, \u958b\u9589\u72b6\u614b EPC=0xe0\\nif ((msg.elr.seoj[0] == 0x026f) && (msg.elr.epc == 0xe0)) {\\n    msg.payload = msg.elr.edt[0];\\n}\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":519,\"y\":458,\"wires\":[[\"acff4917.ab63f8\"]]},{\"id\":\"acff4917.ab63f8\",\"type\":\"switch\",\"z\":\"b25212d8.336a88\",\"name\":\"\",\"property\":\"payload\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"0x41\",\"vt\":\"num\"},{\"t\":\"eq\",\"v\":\"0x42\",\"vt\":\"num\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"outputs\":3,\"x\":682.5,\"y\":459,\"wires\":[[\"60038e3d.3ea5\"],[\"49fe4793.c299c8\"],[]]},{\"id\":\"60038e3d.3ea5\",\"type\":\"link out\",\"z\":\"b25212d8.336a88\",\"name\":\"0x41\",\"links\":[\"2ab8c00.fd8fd4\"],\"x\":798.5,\"y\":446,\"wires\":[]},{\"id\":\"49fe4793.c299c8\",\"type\":\"link out\",\"z\":\"b25212d8.336a88\",\"name\":\"0x42\",\"links\":[\"7bab7379.ce52ac\"],\"x\":800.5,\"y\":484,\"wires\":[]},{\"id\":\"42922bec.b77014\",\"type\":\"udp in\",\"z\":\"b25212d8.336a88\",\"name\":\"EL receive\",\"iface\":\"\",\"port\":\"3610\",\"ipv\":\"udp4\",\"multicast\":\"true\",\"group\":\"224.0.23.0\",\"datatype\":\"buffer\",\"x\":118,\"y\":459,\"wires\":[[\"2cd805cd.f6b84a\",\"c617b521.c138c8\",\"81a3a52d.f2ecd8\"]]},{\"id\":\"c617b521.c138c8\",\"type\":\"debug\",\"z\":\"b25212d8.336a88\",\"name\":\"\",\"active\":true,\"console\":\"false\",\"complete\":\"false\",\"x\":324.5,\"y\":509,\"wires\":[]},{\"id\":\"c709dd31.ebd05\",\"type\":\"debug\",\"z\":\"b25212d8.336a88\",\"name\":\"\",\"active\":true,\"console\":\"false\",\"complete\":\"elr\",\"x\":520,\"y\":506,\"wires\":[]},{\"id\":\"41393aaf.0409c4\",\"type\":\"inject\",\"z\":\"b25212d8.336a88\",\"name\":\"Search\",\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"repeat\":\"\",\"crontab\":\"\",\"once\":false,\"x\":112,\"y\":1251,\"wires\":[[\"5819b7f9.f2929\"]]},{\"id\":\"5819b7f9.f2929\",\"type\":\"function\",\"z\":\"b25212d8.336a88\",\"name\":\"Search\",\"func\":\"//  msg.els.ip_string   // ip address (String)\\n//  msg.els.tid         // TID (Int)\\n//  msg.els.seoj        // SEOJ ([Int:device, Int:instance])\\n//  msg.els.deoj        // DEOJ ([Int:device, Int:instance])\\n//  msg.els.esv         // ESV (Int)\\n//  msg.els.epc         // EPC (Int)\\n//  msg.els.edt_int     // EDT ([Int])\\n\\nmsg.els = {\\n    \\\"ip\\\" : \\\"224.0.23.0\\\",\\n    \\\"tid\\\" : 5,\\n    \\\"seoj\\\" : [0x05ff,1],\\n    \\\"deoj\\\" : [0x0ef0,1],\\n    \\\"esv\\\" : 0x62,\\n    \\\"epc\\\" : 0xD6\\n};\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":301,\"y\":1260,\"wires\":[[]]},{\"id\":\"d1d50d8a.9a455\",\"type\":\"udp out\",\"z\":\"b25212d8.336a88\",\"name\":\"\",\"addr\":\"\",\"iface\":\"\",\"port\":\"3610\",\"ipv\":\"udp4\",\"outport\":\"\",\"base64\":false,\"multicast\":\"multi\",\"x\":769,\"y\":206,\"wires\":[]},{\"id\":\"816be296.50e15\",\"type\":\"inject\",\"z\":\"b25212d8.336a88\",\"name\":\"ON\",\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"repeat\":\"\",\"crontab\":\"\",\"once\":false,\"x\":146,\"y\":206,\"wires\":[[\"30b813d1.96d6f4\",\"8f824877.268258\"]]},{\"id\":\"7b5baebc.d748d\",\"type\":\"function\",\"z\":\"b25212d8.336a88\",\"name\":\"Send EL1\",\"func\":\"// Send ECHONET Lite packet\\n// Assumption: OPC = 1\\n//\\n//  Usage:\\n//      Input following data\\n//\\n//  msg.els.ip      // ip address (String)\\n//  msg.els.tid     // TID (Int)\\n//  msg.els.seoj    // SEOJ ([Int:device, Int:instance])\\n//  msg.els.deoj    // DEOJ ([Int:device, Int:instance])\\n//  msg.els.esv     // ESV (Int)\\n//  msg.els.epc     // EPC (Int)\\n//  msg.els.edt     // EDT ([Int])\\n//          // in case of no EDT data, no edt or []\\n\\nconst tid_buffer = Buffer.allocUnsafe(2);\\nlet   seoj_buffer = Buffer.allocUnsafe(3);\\nconst seoj = msg.els.seoj;\\nlet   deoj_buffer = Buffer.allocUnsafe(3);\\nconst deoj = msg.els.deoj;\\nconst esv_buffer = Buffer.allocUnsafe(1);\\nconst opc_buffer = Buffer.from([1]);\\nconst epc_buffer = Buffer.allocUnsafe(1);\\nconst pdc_buffer = Buffer.allocUnsafe(1);\\nlet edt = msg.els.edt;\\n\\ntid_buffer.writeUInt16BE(msg.els.tid, 0);\\nesv_buffer.writeUInt8(msg.els.esv, 0);\\nepc_buffer.writeUInt8(msg.els.epc, 0);\\n\\nseoj_buffer.writeUInt16BE(seoj[0], 0);\\nseoj_buffer.writeUInt8(seoj[1], 2);\\ndeoj_buffer.writeUInt16BE(deoj[0], 0);\\ndeoj_buffer.writeUInt8(deoj[1], 2);\\n\\n// edt[]\u304b\u3089edt_buffer\u3092\u4f5c\u6210\\nif ((typeof edt) == \\\"undefined\\\") {\\n    edt = [];\\n}\\n\\nconst edt_buffer = Buffer.allocUnsafe(edt.length);\\nfor (var i = 0; i < edt.length; i++) {\\n    edt_buffer.writeUInt8(edt[i], i);\\n}\\n\\npdc_buffer.writeUInt8(edt_buffer.length, 0);\\n\\n// Create ECHONET Lite packet\\nconst el_buffer = Buffer.from([\\n\\t0x10, 0x81,\\n\\ttid_buffer[0], tid_buffer[1],\\n\\tseoj_buffer[0], seoj_buffer[1], seoj_buffer[2],\\n\\tdeoj_buffer[0], deoj_buffer[1], deoj_buffer[2],\\n\\tesv_buffer[0], opc_buffer[0], epc_buffer[0], pdc_buffer[0]]);\\n\\n// add EDT data\\nif (edt_buffer.length !== 0) {\\n    msg.payload = Buffer.concat([el_buffer, edt_buffer], \\n        (el_buffer.length + edt_buffer.length));\\n} else {\\n    msg.payload = el_buffer;\\n}\\n\\nmsg.ip = msg.els.ip;\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":547.5,\"y\":207,\"wires\":[[\"d1d50d8a.9a455\",\"20a78033.c64988\",\"2ecc22f4.b79f3e\"]]},{\"id\":\"20a78033.c64988\",\"type\":\"debug\",\"z\":\"b25212d8.336a88\",\"name\":\"\",\"active\":true,\"console\":\"false\",\"complete\":\"ip\",\"x\":760,\"y\":262,\"wires\":[]},{\"id\":\"8f824877.268258\",\"type\":\"function\",\"z\":\"b25212d8.336a88\",\"name\":\"\u30a8\u30a2\u30b3\u30f3\u3000ON\",\"func\":\"//  msg.els.ip_string   // ip address (String)\\n//  msg.els.tid         // TID (Int)\\n//  msg.els.seoj        // SEOJ ([Int:device, Int:instance])\\n//  msg.els.deoj        // DEOJ ([Int:device, Int:instance])\\n//  msg.els.esv         // ESV (Int)\\n//  msg.els.epc         // EPC (Int)\\n//  msg.els.edt_int     // EDT ([Int])\\n\\nmsg.els = {\\n    \\\"ip\\\" : \\\"224.0.23.0\\\",\\n    \\\"tid\\\" : 5,\\n    \\\"seoj\\\" : [0x05ff,1],\\n    \\\"deoj\\\" : [0x0130,1],\\n    \\\"esv\\\" : 0x61,\\n    \\\"epc\\\" : 0x80,\\n    \\\"edt\\\" : [0x30]\\n};\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":348.5,\"y\":206,\"wires\":[[\"7b5baebc.d748d\"]]},{\"id\":\"30b813d1.96d6f4\",\"type\":\"function\",\"z\":\"b25212d8.336a88\",\"name\":\"\u30e9\u30a4\u30c8\u3000ON\",\"func\":\"//  msg.els.ip_string   // ip address (String)\\n//  msg.els.tid         // TID (Int)\\n//  msg.els.seoj        // SEOJ ([Int:device, Int:instance])\\n//  msg.els.deoj        // DEOJ ([Int:device, Int:instance])\\n//  msg.els.esv         // ESV (Int)\\n//  msg.els.epc         // EPC (Int)\\n//  msg.els.edt_int     // EDT ([Int])\\n\\nmsg.els = {\\n    \\\"ip\\\" : \\\"224.0.23.0\\\",\\n    \\\"tid\\\" : 5,\\n    \\\"seoj\\\" : [0x05ff,1],\\n    \\\"deoj\\\" : [0x0290,1],\\n    \\\"esv\\\" : 0x61,\\n    \\\"epc\\\" : 0x80,\\n    \\\"edt\\\" : [0x30]\\n};\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":338.5,\"y\":248,\"wires\":[[\"7b5baebc.d748d\"]]},{\"id\":\"2bcde2cc.b0e0b6\",\"type\":\"function\",\"z\":\"b25212d8.336a88\",\"name\":\"\u30e9\u30a4\u30c8\u3000OFF\",\"func\":\"//  msg.els.ip_string   // ip address (String)\\n//  msg.els.tid         // TID (Int)\\n//  msg.els.seoj        // SEOJ ([Int:device, Int:instance])\\n//  msg.els.deoj        // DEOJ ([Int:device, Int:instance])\\n//  msg.els.esv         // ESV (Int)\\n//  msg.els.epc         // EPC (Int)\\n//  msg.els.edt_int     // EDT ([Int])\\n\\nmsg.els = {\\n    \\\"ip\\\" : \\\"224.0.23.0\\\",\\n    \\\"tid\\\" : 5,\\n    \\\"seoj\\\" : [0x05ff,1],\\n    \\\"deoj\\\" : [0x0290,1],\\n    \\\"esv\\\" : 0x61,\\n    \\\"epc\\\" : 0x80,\\n    \\\"edt\\\" : [0x31]\\n};\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":334.5,\"y\":329,\"wires\":[[\"7b5baebc.d748d\"]]},{\"id\":\"46ac93c4.9bf35c\",\"type\":\"function\",\"z\":\"b25212d8.336a88\",\"name\":\"\u30a8\u30a2\u30b3\u30f3\u3000OFF\",\"func\":\"//  msg.els.ip_string   // ip address (String)\\n//  msg.els.tid         // TID (Int)\\n//  msg.els.seoj        // SEOJ ([Int:device, Int:instance])\\n//  msg.els.deoj        // DEOJ ([Int:device, Int:instance])\\n//  msg.els.esv         // ESV (Int)\\n//  msg.els.epc         // EPC (Int)\\n//  msg.els.edt_int     // EDT ([Int])\\n\\nmsg.els = {\\n    \\\"ip\\\" : \\\"224.0.23.0\\\",\\n    \\\"tid\\\" : 5,\\n    \\\"seoj\\\" : [0x05ff,1],\\n    \\\"deoj\\\" : [0x0130,1],\\n    \\\"esv\\\" : 0x61,\\n    \\\"epc\\\" : 0x80,\\n    \\\"edt\\\" : [0x31]\\n};\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":348.5,\"y\":289,\"wires\":[[\"7b5baebc.d748d\"]]},{\"id\":\"9231a3bb.ce8bc\",\"type\":\"inject\",\"z\":\"b25212d8.336a88\",\"name\":\"OFF\",\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"repeat\":\"\",\"crontab\":\"\",\"once\":false,\"x\":149,\"y\":290,\"wires\":[[\"2bcde2cc.b0e0b6\",\"46ac93c4.9bf35c\"]]},{\"id\":\"2ecc22f4.b79f3e\",\"type\":\"debug\",\"z\":\"b25212d8.336a88\",\"name\":\"\",\"active\":true,\"console\":\"false\",\"complete\":\"false\",\"x\":780,\"y\":308,\"wires\":[]},{\"id\":\"fad08edd.8db6c8\",\"type\":\"link in\",\"z\":\"b25212d8.336a88\",\"name\":\"UDP send\",\"links\":[],\"x\":605,\"y\":269,\"wires\":[[\"d1d50d8a.9a455\"]]},{\"id\":\"81a3a52d.f2ecd8\",\"type\":\"link out\",\"z\":\"b25212d8.336a88\",\"name\":\"UDP receive\",\"links\":[],\"x\":177.5,\"y\":513,\"wires\":[]},{\"id\":\"48da7a43.d0e234\",\"type\":\"function\",\"z\":\"b25212d8.336a88\",\"name\":\"Search\",\"func\":\"//  msg.els.ip_string   // ip address (String)\\n//  msg.els.tid         // TID (Int)\\n//  msg.els.seoj        // SEOJ ([Int:device, Int:instance])\\n//  msg.els.deoj        // DEOJ ([Int:device, Int:instance])\\n//  msg.els.esv         // ESV (Int)\\n//  msg.els.epc         // EPC (Int)\\n//  msg.els.edt_int     // EDT ([Int])\\n\\nmsg.els = {\\n    \\\"ip\\\" : \\\"224.0.23.0\\\",\\n    \\\"tid\\\" : 0x30f0,\\n    \\\"seoj\\\" : [0x05ff,1],\\n    \\\"deoj\\\" : [0x0ef0,1],\\n    \\\"esv\\\" : 0x62,\\n    \\\"epc\\\" : 0xd6,\\n    \\\"edt\\\" : []\\n};\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":330,\"y\":158,\"wires\":[[\"7b5baebc.d748d\"]]},{\"id\":\"276ccd10.744a02\",\"type\":\"comment\",\"z\":\"b25212d8.336a88\",\"name\":\"Send EL1\",\"info\":\"Description: msg.els\u306e\u5024\u3092\u5143\u306bECHONET Lite\u306e\u30d0\u30a4\u30ca\u30ea\u30fc\u30c7\u30fc\u30bf\u3092\u4f5c\u6210\u3057UDP\u9001\u4fe1node\u306b\u5024\u3092\u6e21\u3059\\n\\nAssumption: OPC = 1\\n\\nUsage: \u4ee5\u4e0b\u306e\u30c7\u30fc\u30bf\u3092\u5165\u529b\u3057\u307e\u3059\\n\\n- msg.els.ip\\n    - Content: ip address\\n    - Data Type: String\\n    - Sample: \\\"224.0.23.0\\\"\\n- msg.els.tid\\n    - Content: TID\\n    - Data Type: Int\\n    - Sample: 0x0101\\n- msg.els.seoj\\n    - Content: SEOJ\\n    - Data Type: [Int:device, Int:instance]\\n    - device: EOJ, instance: instance number\\n    - Sample: [0x05ff, 0x01]\\n- msg.els.deoj\\n    - Content: DEOJ\\n    - Data Type: [Int:device, Int:instance]\\n    - device: EOJ, instance: instance number\\n    - Sample: [0x0130, 0x01]\\n- msg.els.esv\\n    - Content: ESV\\n    - Data Type: Int\\n    - Sample: 0x62\\n- msg.els.epc\\n    - Content: EPC\\n    - Data Type: Int\\n    - Sample: 0x80\\n- msg.els.edt\\n    - Content: EDT\\n    - Data Type: [Int]\\n    - Sample: [0x30]\\n    - Note: in case of no EDT data, []\",\"x\":546.5,\"y\":168,\"wires\":[]},{\"id\":\"ac7445a8.9d057\",\"type\":\"comment\",\"z\":\"b25212d8.336a88\",\"name\":\"Parse EL1\",\"info\":\"Description: UDP\u53d7\u4fe1node\u304b\u3089\u6e21\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3092\u30d1\u30fc\u30b9\u3057msg.elr\u3068\u3057\u3066\u6e21\u3059\\n\\nAssumption: OPC = 1\\n\\nUsage: \u4ee5\u4e0b\u306e\u30c7\u30fc\u30bf\u3092\u51fa\u529b\u3059\u308b\\n\\n- msg.elr.ip\\n    - Content: ip address\\n    - Data Type: String\\n    - Sample: \\\"224.0.23.0\\\"\\n- msg.elr.ehd\\n    - Content: EHD\\n    - Data Type: Int\\n    - Sample: 0x1081\\n- msg.elr.tid\\n    - Content: TID\\n    - Data Type: Int\\n    - Sample: 0x0101\\n- msg.elr.seoj\\n    - Content: SEOJ\\n    - Data Type: [Int:device, Int:instance]\\n    - device: EOJ, instance: instance number\\n    - Sample: [0x05ff, 0x01]\\n- msg.elr.deoj\\n    - Content: DEOJ\\n    - Data Type: [Int:device, Int:instance]\\n    - device: EOJ, instance: instance number\\n    - Sample: [0x0130, 0x01]\\n- msg.elr.esv\\n    - Content: ESV\\n    - Data Type: Int\\n    - Sample: 0x62\\n- msg.elr.opc\\n    - Content: OPC\\n    - Data Type: Int\\n    - Sample: 0x01\\n- msg.elr.epc\\n    - Content: EPC\\n    - Data Type: Int\\n    - Sample: 0x80\\n- msg.elr.pdc\\n    - Content: PDC\\n    - Data Type: Int\\n    - Sample: 0x01\\n- msg.elr.edt\\n    - Content: EDT\\n    - Data Type: [Int]\\n    - Sample: [0x30]\\n    - Note: in case of no EDT data, []\",\"x\":313,\"y\":419,\"wires\":[]}]\n\n##\u6982\u8981\n\u3000Node-RED\u306bdefault\u3067install\u3055\u308c\u308bUDP\u306e\u9001\u4fe1node\u3068\u53d7\u4fe1node\u3092\u5229\u7528\u3057\u3066\u3001ECHONET Lite\u306e\u9001\u53d7\u4fe1\u3092\u5bb9\u6613\u306b\u3059\u308bnode\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\u53d7\u4fe1\u3057\u305fUDP data\u306f\u30d1\u30fc\u30b9\u3055\u308cECHONET Lite\u3067\u898f\u5b9a\u3055\u308c\u308b\u30d6\u30ed\u30c3\u30af\u306b\u5206\u89e3\u3055\u308c\u307e\u3059\u3002\u30c7\u30fc\u30bf\u3092\u9001\u4fe1\u3059\u308b\u5834\u5408\u306fECHONET Lite\u3067\u898f\u5b9a\u3055\u308c\u308b\u5404\u30d6\u30ed\u30c3\u30af\u306e\u5024\u3092\u5f15\u6570\u3068\u3057\u3066\u6e21\u3057\u307e\u3059\u3002ECHONET Lite\u306f\u30d0\u30a4\u30c8\u5358\u4f4d\u3067\u30d1\u30b1\u30c3\u30c8\u304c\u69cb\u6210\u3055\u308c\u307e\u3059\u304c\u3001UInt8\u306edata type\u3092\u6301\u305f\u306a\u3044JavaScript\u3067\u306f\u6271\u3044\u306b\u304f\u3044\u305f\u3081\u3001\u30c7\u30fc\u30bf\u306fInt\u3067\u6e21\u3057\u307e\u3059\u3002\n\u3000\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\u3068\u3057\u3066\u4ee5\u4e0b\u306e\uff13\u3064\u3092\u7528\u610f\u3057\u307e\u3057\u305f\u3002\n\n- Node-RED\u304b\u3089\u30de\u30cb\u30e5\u30a2\u30eb\u3067\u30a8\u30a2\u30b3\u30f3\u3068\u7167\u660e\u306eON/OFF\u5236\u5fa1\n- \u96fb\u5b50\u9320\u306e\u958b\u9589\u3067\u30a8\u30a2\u30b3\u30f3\u3068\u7167\u660e\u306eON/OFF\u5236\u5fa1\n- \u30b9\u30de\u30db\u306e\u30d6\u30e9\u30a6\u30b6\u30fc\u3092\u30a8\u30a2\u30b3\u30f3\u3068\u7167\u660e\u306eON/OFF\u5236\u5fa1\u30ea\u30e2\u30b3\u30f3\u306b\u3059\u308bweb application\n\n\u306a\u304a\u3001\u4ee5\u4e0b\u306e\u74b0\u5883\u3067\u52d5\u4f5c\u78ba\u8a8d\u3057\u3066\u3044\u307e\u3059\u3002\nNode-RED version: v0.15.1\nNode.js  version: v6.9.1\n\n\u5168\u4f53\u306eFLOW\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n![\u5168\u4f53Flow.png](https://qiita-image-store.s3.amazonaws.com/0/73141/f1d42080-ec7e-0221-6744-bbf96ca17531.png \"\u5168\u4f53Flow.png\")\n\n##\u9001\u4fe1\n\n\u307e\u305a\u9001\u4fe1\u5074\u304b\u3089\u898b\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\u753b\u9762\u4e0a\u3067\u300cEL send\u300d\u3068\u8868\u793a\u3055\u308c\u3066\u3044\u308bUDP\u306e\u9001\u4fe1\u30ce\u30fc\u30c9\u306e\u8a2d\u5b9a\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002to port\u306b3610\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n![udp_out.png](https://qiita-image-store.s3.amazonaws.com/0/73141/9754bb8a-c0e1-c30d-4f6d-7332f88a09a2.png)\n\n\n\n\u3053\u306eudp node\u306e\u5165\u529b\u5074\u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u300cSend EL1\u300d\u3068\u3044\u3046function node\u306e\u4e2d\u8eab\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u304c\u3001\u7406\u89e3\u3057\u306a\u304f\u3066\u3082\u4f7f\u3048\u307e\u3059\u3002\n\n```JavaScript\n// Send ECHONET Lite packet\n// Assumption: OPC = 1\n//\n//  Usage:\n//      Input following data\n//\n//  msg.els.ip      // ip address (String)\n//  msg.els.tid     // TID (Int)\n//  msg.els.seoj    // SEOJ ([Int:device, Int:instance])\n//  msg.els.deoj    // DEOJ ([Int:device, Int:instance])\n//  msg.els.esv     // ESV (Int)\n//  msg.els.epc     // EPC (Int)\n//  msg.els.edt     // EDT ([Int])\n//          // in case of no EDT data, no edt or []\n\nconst tid_buffer = Buffer.allocUnsafe(2);\nlet   seoj_buffer = Buffer.allocUnsafe(3);\nconst seoj = msg.els.seoj;\nlet   deoj_buffer = Buffer.allocUnsafe(3);\nconst deoj = msg.els.deoj;\nconst esv_buffer = Buffer.allocUnsafe(1);\nconst opc_buffer = Buffer.from([1]);\nconst epc_buffer = Buffer.allocUnsafe(1);\nconst pdc_buffer = Buffer.allocUnsafe(1);\nlet edt = msg.els.edt;\n\ntid_buffer.writeUInt16BE(msg.els.tid, 0);\nesv_buffer.writeUInt8(msg.els.esv, 0);\nepc_buffer.writeUInt8(msg.els.epc, 0);\n\nseoj_buffer.writeUInt16BE(seoj[0], 0);\nseoj_buffer.writeUInt8(seoj[1], 2);\ndeoj_buffer.writeUInt16BE(deoj[0], 0);\ndeoj_buffer.writeUInt8(deoj[1], 2);\n\n// edt[]\u304b\u3089edt_buffer\u3092\u4f5c\u6210\nif ((typeof edt) == \"undefined\") {\n    edt = [];\n}\n\nconst edt_buffer = Buffer.allocUnsafe(edt.length);\nfor (var i = 0; i < edt.length; i++) {\n    edt_buffer.writeUInt8(edt[i], i);\n}\n\npdc_buffer.writeUInt8(edt_buffer.length, 0);\n\n// Create ECHONET Lite packet\nconst el_buffer = Buffer.from([\n\t0x10, 0x81,\n\ttid_buffer[0], tid_buffer[1],\n\tseoj_buffer[0], seoj_buffer[1], seoj_buffer[2],\n\tdeoj_buffer[0], deoj_buffer[1], deoj_buffer[2],\n\tesv_buffer[0], opc_buffer[0], epc_buffer[0], pdc_buffer[0]]);\n\n// add EDT data\nif (edt_buffer.length !== 0) {\n    msg.payload = Buffer.concat([el_buffer, edt_buffer], \n        (el_buffer.length + edt_buffer.length));\n} else {\n    msg.payload = el_buffer;\n}\n\nmsg.ip = msg.els.ip;\nreturn msg;\n```\n\n\u3000\u5192\u982d\u306e\u30b3\u30e1\u30f3\u30c8\u306b\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u306b\u3001\u3053\u306efunction\u306b\u4ee5\u4e0b\u306e\u30c7\u30fc\u30bf\u3092\u6e21\u3057\u3066\u3084\u308b\u3068\u3001byte\u5217\u306eECHONET Lite\u30c7\u30fc\u30bf\u30d1\u30b1\u30c3\u30c8\u306b\u5909\u63db\u3057\u3066udp node\u306b\u6e21\u3057\u307e\u3059\u3002\u306a\u304a\u3001OPC=1\u306e\u307f\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\n\n- msg.els.ip      // ip address (String)\n- msg.els.tid     // TID (Int)\n- msg.els.seoj    // SEOJ ([Int:device, Int:instance])\n- msg.els.deoj    // DEOJ ([Int:device, Int:instance])\n- msg.els.esv     // ESV (Int)\n- msg.els.epc     // EPC (Int)\n- msg.els.edt     // EDT ([Int])\n\n\u5177\u4f53\u7684\u306b\u306f\u3001\u3053\u306e\u300cSend EL1\u300dfunction\u306e\u5165\u529b\u5074\u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u300c\u30a8\u30a2\u30b3\u30f3 ON\u300dfunction\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```JavaScript\nmsg.els = {\n    \"ip\" : \"224.0.23.0\",\n    \"tid\" : 5,\n    \"seoj\" : [0x05ff,1],\n    \"deoj\" : [0x0130,1],\n    \"esv\" : 0x61,\n    \"epc\" : 0x80,\n    \"edt\" : [0x30]\n};\n\nreturn msg;\n```\n\n\u3053\u306efunction\u5185\u306e\u5fc5\u8981\u306a\u7b87\u6240\u306e\u5024\u3092\u5909\u66f4\u3059\u308b\u3060\u3051\u3067\u3001ECHONET Lite\u306e\u30c7\u30fc\u30bf\u9001\u4fe1\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002\n\n##\u53d7\u4fe1\n\n\u7d9a\u3044\u3066\u53d7\u4fe1\u5074\u3092\u898b\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\u753b\u9762\u4e0a\u3067\u300cEL receive\u300d\u3068\u8868\u793a\u3055\u308c\u3066\u3044\u308bUDP\u306e\u53d7\u4fe1\u30ce\u30fc\u30c9\u306e\u8a2d\u5b9a\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u300cListen for\u300d\u3067\u300cmulticast message\u300d\u3092\u9078\u629e\u3057\u3001\u300cGroup\u300d\u306b224.0.23.0\u3092\u300con port\u300d\u306b3610\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u300cOutput\u300d\u306f\u300ca Buffer\u300d\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n![udp_in.png](https://qiita-image-store.s3.amazonaws.com/0/73141/d2e4b609-60f6-be65-6f1c-0806b356bf5b.png \"udp_in.png\")\n\n\n\u3053\u306eudp node\u306e\u51fa\u529b\u5074\u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u300cParse EL1\u300d\u3068\u3044\u3046function node\u306e\u4e2d\u8eab\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u304c\u3001\u7406\u89e3\u3057\u306a\u304f\u3066\u3082\u4f7f\u3048\u307e\u3059\u3002\n\n```JavaScript\n// Parse ECHONET Lite packet\n// Assumption: OPC = 1\n\n//  OUTPUT:\n//  msg.elr.ip      // ip address (String)\n//  msg.elr.ehd     // EHD (Int)\n//  msg.elr.tid     // TID (Int)\n//  msg.elr.seoj    // SEOJ ([Int:device, Int:instance])\n//  msg.elr.deoj    // DEOJ ([Int:device, Int:instance])\n//  msg.elr.esv     // ESV (Int)\n//  msg.elr.opc     // OPC (Int)\n//  msg.elr.epc     // EPC (Int)\n//  msg.elr.pdc     // PDC (Int)\n//  msg.elr.edt     // EDT ([Int]) or [](no EDT data)\n\nconst buffer = msg.payload;\nmsg.elr = null;\n\nif (buffer.length >= 14) {\n  const ehd_buffer = buffer.slice(0, 2);\n  const tid_buffer = buffer.slice(2, 4);\n  const seoj_device_buffer = buffer.slice(4, 6);\n  const seoj_instance_buffer = buffer.slice(6, 7);\n  const deoj_device_buffer = buffer.slice(7, 9);\n  const deoj_instance_buffer = buffer.slice(9, 10);\n  const esv_buffer = buffer.slice(10, 11);\n  const opc_buffer = buffer.slice(11, 12);\n  const epc_buffer = buffer.slice(12, 13);\n  const pdc_buffer = buffer.slice(13, 14);\n\n  const ehd = ehd_buffer.readUInt16BE(0);\n  const tid = tid_buffer.readUInt16BE(0);\n  const seoj_device = seoj_device_buffer.readUInt16BE(0);\n  const seoj_instance = seoj_instance_buffer.readUInt8(0);\n  const seoj = [seoj_device, seoj_instance];\n  const deoj_device = deoj_device_buffer.readUInt16BE(0);\n  const deoj_instance = deoj_instance_buffer.readUInt8(0);\n  const deoj = [deoj_device, deoj_instance];\n  const esv = esv_buffer.readUInt8(0);\n  const opc = opc_buffer.readUInt8(0);\n  const epc = epc_buffer.readUInt8(0);\n  const pdc = pdc_buffer.readUInt8(0);\n  let edt = [];\n  \n  if (buffer.length >= 15) {\n    const edt_buffer = buffer.slice(14);\n    for (var i = 0; i < edt_buffer.length; i++) {\n        edt[i] = edt_buffer.readUInt8(i);\n    }\n  }\n\n  // ECHONET Lite header check\n  if (ehd == 0x1081) {\n    msg.elr = {\n        \"ip\"            : msg.ip,\n        \"ehd\"           : ehd,\n        \"tid\"           : tid,\n        \"seoj\"          : seoj,\n        \"deoj\"          : deoj,\n        \"esv\"           : esv,\n        \"opc\"           : opc,\n        \"epc\"           : epc,\n        \"pdc\"           : pdc,\n        \"edt\"           : edt\n    };\n  }\n}\n\nreturn msg;\n```\n\n\u3000\u5192\u982d\u306e\u30b3\u30e1\u30f3\u30c8\u306b\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u306b\u3001\u3053\u306efunction\u304b\u3089\u4ee5\u4e0b\u306e\u30c7\u30fc\u30bf\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\u306a\u304a\u3001OPC=1\u306e\u307f\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\n\n- msg.elr.ip      // ip address (String)\n- msg.elr.ehd     // EHD (Int)\n- msg.elr.tid     // TID (Int)\n- msg.elr.seoj    // SEOJ ([Int:device, Int:instance])\n- msg.elr.deoj    // DEOJ ([Int:device, Int:instance])\n- msg.elr.esv     // ESV (Int)\n- msg.elr.opc     // OPC (Int)\n- msg.elr.epc     // EPC (Int)\n- msg.elr.pdc     // PDC (Int)\n- msg.elr.edt     // EDT ([Int])\n\n\u30d1\u30fc\u30b9\u3055\u308c\u305f\u30c7\u30fc\u30bf\u306e\u4f7f\u3044\u65b9\u306e\u4f8b\u3092\u3001\u3053\u306e\u300cParse EL1\u300dfunction\u306e\u51fa\u529b\u5074\u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u300cfilter keyStatus\u300dfunction\u3067\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u53d7\u4fe1\u3057\u305f\u30c7\u30fc\u30bf\u306e\u9001\u4fe1\u5143\u304c\u300c\u96fb\u5b50\u9320\u300d\u3067\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u304c\u300c\u958b\u9589\u72b6\u614b\u300d\u306a\u3089\u3070\u3001\u958b\u9589\u72b6\u614b\u3092\u8868\u3059EDT\u30c7\u30fc\u30bf\u3092msg.payload\u306b\u683c\u7d0d\u3057\u3066\u3044\u307e\u3059\u3002\u6b21\u306eswitch node\u3067\u9589(0x41)\u307e\u305f\u306f\u958b(0x42)\u3067\u5206\u5c90\u3057\u3001\u30a8\u30a2\u30b3\u30f3\u3084\u7167\u660e\u3092ON/OFF\u5236\u5fa1\u3057\u3066\u3044\u307e\u3059\u3002\n\n```JavaScript\n// \u96fb\u5b50\u9320 EOJ=0x026f, \u958b\u9589\u72b6\u614b EPC=0xe0\nif ((msg.elr.seoj[0] == 0x026f) && (msg.elr.epc == 0xe0)) {\n    msg.payload = msg.elr.edt[0];\n}\n\nreturn msg;\n```\n\n##Web\u30ea\u30e2\u30b3\u30f3\nNode-RED\u306fweb server\u6a5f\u80fd\u3092\u3082\u3063\u3066\u3044\u308b\u306e\u3067\u3001web application\u3092\u5bb9\u6613\u306b\u4f5c\u6210\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u5168\u4f53Flow\u306e\u4e0b\u90e8\u306e\u300cON/OFF Remote Controller\u300d\u3092\u898b\u3066\u304f\u3060\u3055\u3044\u3002\u30b9\u30de\u30db\u306e\u30d6\u30e9\u30a6\u30b6\u3067\n> http://<Node-RED server\u306eip address>:1880/control\n\n\u3092\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001\u3053\u306e\u3088\u3046\u306a\u30b7\u30f3\u30d7\u30eb\u306a\u30ea\u30e2\u30b3\u30f3\u753b\u9762\u304c\u73fe\u308c\u307e\u3059\u3002\u3053\u306eON/OFF\u30dc\u30bf\u30f3\u3067\u30a8\u30a2\u30b3\u30f3\u3084\u7167\u660e\u3092ON/OFF\u5236\u5fa1\u3067\u304d\u307e\u3059\u3002\n\n![web_remocon.PNG](https://qiita-image-store.s3.amazonaws.com/0/73141/33424a06-e626-1c69-4390-1d7dca9d6d16.png \"web_remocon.PNG\")\n\n\u5168\u4f53\u306eFlow\u306e\u5de6\u4e0b\u90e8\u306b\u3042\u308b\u300c/control\u300d\u3068\u66f8\u304b\u308c\u305fhttp node\u3067GET request\u3092\u53d7\u3051\u4ed8\u3051\u307e\u3059\u3002\u3053\u306enode\u306fURL\u306b\u300c/control\u300d\u3068\u5165\u529b\u3057\u3066\u3042\u308b\u3060\u3051\u3067\u3059\u3002\u3053\u306enode\u306e\u51fa\u529b\u304c\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u300cON/OFF button\u300d\u3068\u66f8\u304b\u308c\u305ftemplate node\u304cHTML\u3092\u51fa\u529b\u3057\u3066\u3001\u30d6\u30e9\u30a6\u30b6\u30fc\u306b\u30dc\u30bf\u30f3\u3092\u8868\u793a\u3057\u307e\u3059\u3002template node\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n```HTML\n<!DOCTYPE html>\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n    <meta charset=\u201cUFT-8\u201d>\n    <style>\n        body { background: #FAFAD2; }\n        h1 {color:black; font-family:sans-serif;}\n        button { width: 300px; height: 100px; font-size: 36px; border-radius: 10px; border-style: none; background-color: #aaaaaa;}\n        button:hover {background-color: #dddddd;}\n    </style>\n    <title> ON/OFF BUTTON </title>\n    <script language=\"javascript\" type=\"text/javascript\">\n        function OnButtonClick() {\n            location.href = \"/on\";\n        }\n        function OffButtonClick() {\n            location.href = \"/off\";\n        }\n    </script>\n</head>\n<body>\n\t<h1>HEMS Controller</h1>\n    <button type=\"button\" name=\"buttonOn\" onclick=\"OnButtonClick()\">ON</button> \n    <button type=\"button\" name=\"buttonOff\" onclick=\"OffButtonClick()\">OFF</button> <br/>\n</body>\n</html>\n```\n\n\u3053\u306eHTML\u304chttp response node\u304b\u3089\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\n\n##\u5168\u4f53\u306eFlow\n\n\u5168\u4f53\u306eFlow\u306eJSON\u30c7\u30fc\u30bf\u306f\u3053\u3061\u3089\u3067\u3059\u3002\n\n```JSON\n[{\"id\":\"929982f7.1dfe88\",\"type\":\"inject\",\"z\":\"b25212d8.336a88\",\"name\":\"Search\",\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"repeat\":\"\",\"crontab\":\"\",\"once\":false,\"x\":145.63636779785156,\"y\":159,\"wires\":[[\"48da7a43.d0e234\"]]},{\"id\":\"2ab8c00.fd8fd4\",\"type\":\"link in\",\"z\":\"b25212d8.336a88\",\"name\":\"ON\",\"links\":[\"60038e3d.3ea5\",\"60579462.f009ac\",\"a47b7d1b.85f958\"],\"x\":144,\"y\":242.18182373046875,\"wires\":[[\"8f824877.268258\",\"30b813d1.96d6f4\"]]},{\"id\":\"7bab7379.ce52ac\",\"type\":\"link in\",\"z\":\"b25212d8.336a88\",\"name\":\"OFF\",\"links\":[\"19f3c295.8e39bd\",\"49fe4793.c299c8\",\"d6714c57.f29c38\"],\"x\":146,\"y\":329.18182373046875,\"wires\":[[\"46ac93c4.9bf35c\",\"2bcde2cc.b0e0b6\"]]},{\"id\":\"4f1896ac.7cfcb\",\"type\":\"comment\",\"z\":\"b25212d8.336a88\",\"name\":\"Check Key Status\",\"info\":\"\u96fb\u5b50\u9320\u306eOn/OFF\u3067\u30a8\u30a2\u30b3\u30f3\u3068\u7167\u660e\u306eON/OFF\u3092\u5236\u5fa1\",\"x\":128.22727966308594,\"y\":422.5454406738281,\"wires\":[]},{\"id\":\"e46582fe.0e69b\",\"type\":\"comment\",\"z\":\"b25212d8.336a88\",\"name\":\"Flow: demoRoom\",\"info\":\"ECHONET Lite\u306e\u9001\u53d7\u4fe1\u3092\u5b9f\u73fe\u3002\\nBrowser\u3067\u63a5\u7d9a\u3059\u308b\u3068ON/OFF\u5236\u5fa1\u306e\u30ea\u30e2\u30b3\u30f3\u3068\u306a\u308b\u3002\",\"x\":138.86363220214844,\"y\":114.81817626953125,\"wires\":[]},{\"id\":\"6e147962.3b1508\",\"type\":\"http in\",\"z\":\"b25212d8.336a88\",\"name\":\"/on\",\"url\":\"/on\",\"method\":\"get\",\"swaggerDoc\":\"\",\"x\":87.5,\"y\":628.1818237304688,\"wires\":[[\"a47b7d1b.85f958\",\"cd5ec784.0801d8\"]]},{\"id\":\"a47b7d1b.85f958\",\"type\":\"link out\",\"z\":\"b25212d8.336a88\",\"name\":\"REST/on\",\"links\":[\"2ab8c00.fd8fd4\"],\"x\":219.5,\"y\":627.1818313598633,\"wires\":[]},{\"id\":\"85a91f31.a3686\",\"type\":\"http in\",\"z\":\"b25212d8.336a88\",\"name\":\"/off\",\"url\":\"/off\",\"method\":\"get\",\"swaggerDoc\":\"\",\"x\":88,\"y\":669.1818237304688,\"wires\":[[\"d6714c57.f29c38\",\"cd5ec784.0801d8\"]]},{\"id\":\"d6714c57.f29c38\",\"type\":\"link out\",\"z\":\"b25212d8.336a88\",\"name\":\"REST/off\",\"links\":[\"7bab7379.ce52ac\"],\"x\":217.5,\"y\":668.1818237304688,\"wires\":[]},{\"id\":\"e35592e3.6ced4\",\"type\":\"http in\",\"z\":\"b25212d8.336a88\",\"name\":\"/control\",\"url\":\"/control\",\"method\":\"get\",\"swaggerDoc\":\"\",\"x\":87,\"y\":710.1818237304688,\"wires\":[[\"387d2a5d.fa9d76\",\"cd5ec784.0801d8\"]]},{\"id\":\"8bb17ee2.8b71c\",\"type\":\"http response\",\"z\":\"b25212d8.336a88\",\"name\":\"\",\"x\":596.5,\"y\":654.1818237304688,\"wires\":[]},{\"id\":\"387d2a5d.fa9d76\",\"type\":\"debug\",\"z\":\"b25212d8.336a88\",\"name\":\"\",\"active\":true,\"console\":\"false\",\"complete\":\"true\",\"x\":371.5,\"y\":709.1818313598633,\"wires\":[]},{\"id\":\"dfdee8d8.e1e74\",\"type\":\"comment\",\"z\":\"b25212d8.336a88\",\"name\":\"ON/OFF Remote Controller\",\"info\":\"Browser\u3067\u63a5\u7d9a\u3059\u308b\u3068\u3001ON/OFF\u5236\u5fa1\u306e\u30dc\u30bf\u30f3\u304c\u8868\u793a\u3055\u308c\u308b\\n\\nhttp://<Node-red\u306eIP address>:1880/control\",\"x\":149.5,\"y\":588.1818237304688,\"wires\":[]},{\"id\":\"baad2d25.311cc8\",\"type\":\"debug\",\"z\":\"b25212d8.336a88\",\"name\":\"\",\"active\":true,\"console\":\"false\",\"complete\":\"true\",\"x\":601.5,\"y\":705.1818237304688,\"wires\":[]},{\"id\":\"cd5ec784.0801d8\",\"type\":\"template\",\"z\":\"b25212d8.336a88\",\"name\":\"ON/OFF button\",\"field\":\"payload\",\"fieldType\":\"msg\",\"format\":\"html\",\"syntax\":\"mustache\",\"template\":\"<!DOCTYPE html>\\n<html xmlns=\\\"http://www.w3.org/1999/xhtml\\\">\\n<head>\\n    <meta charset=\u201cUFT-8\u201d>\\n    <style>\\n        body { background: #FAFAD2; }\\n        h1 {color:black; font-family:sans-serif;}\\n        button { width: 300px; height: 100px; font-size: 36px; border-radius: 10px; border-style: none; background-color: #aaaaaa;}\\n        button:hover {background-color: #dddddd;}\\n    </style>\\n    <title> ON/OFF BUTTON </title>\\n    <script language=\\\"javascript\\\" type=\\\"text/javascript\\\">\\n        function OnButtonClick() {\\n            location.href = \\\"/on\\\";\\n        }\\n        function OffButtonClick() {\\n            location.href = \\\"/off\\\";\\n        }\\n    </script>\\n</head>\\n<body>\\n\\t<h1>HEMS Controller</h1>\\n    <button type=\\\"button\\\" name=\\\"buttonOn\\\" onclick=\\\"OnButtonClick()\\\">ON</button> \\n    <button type=\\\"button\\\" name=\\\"buttonOff\\\" onclick=\\\"OffButtonClick()\\\">OFF</button> <br/>\\n</body>\\n</html>\",\"x\":389.5,\"y\":653.1818237304688,\"wires\":[[\"8bb17ee2.8b71c\",\"baad2d25.311cc8\"]]},{\"id\":\"2cd805cd.f6b84a\",\"type\":\"function\",\"z\":\"b25212d8.336a88\",\"name\":\"Parse EL1\",\"func\":\"// Parse ECHONET Lite packet\\n// Assumption: OPC = 1\\n\\n//  OUTPUT:\\n//  msg.elr.ip      // ip address (String)\\n//  msg.elr.ehd     // EHD (Int)\\n//  msg.elr.tid     // TID (Int)\\n//  msg.elr.seoj    // SEOJ ([Int:device, Int:instance])\\n//  msg.elr.deoj    // DEOJ ([Int:device, Int:instance])\\n//  msg.elr.esv     // ESV (Int)\\n//  msg.elr.opc     // OPC (Int)\\n//  msg.elr.epc     // EPC (Int)\\n//  msg.elr.pdc     // PDC (Int)\\n//  msg.elr.edt     // EDT ([Int]) or [](no EDT data)\\n\\nconst buffer = msg.payload;\\nmsg.elr = null;\\n\\nif (buffer.length >= 14) {\\n  const ehd_buffer = buffer.slice(0, 2);\\n  const tid_buffer = buffer.slice(2, 4);\\n  const seoj_device_buffer = buffer.slice(4, 6);\\n  const seoj_instance_buffer = buffer.slice(6, 7);\\n  const deoj_device_buffer = buffer.slice(7, 9);\\n  const deoj_instance_buffer = buffer.slice(9, 10);\\n  const esv_buffer = buffer.slice(10, 11);\\n  const opc_buffer = buffer.slice(11, 12);\\n  const epc_buffer = buffer.slice(12, 13);\\n  const pdc_buffer = buffer.slice(13, 14);\\n\\n  const ehd = ehd_buffer.readUInt16BE(0);\\n  const tid = tid_buffer.readUInt16BE(0);\\n  const seoj_device = seoj_device_buffer.readUInt16BE(0);\\n  const seoj_instance = seoj_instance_buffer.readUInt8(0);\\n  const seoj = [seoj_device, seoj_instance];\\n  const deoj_device = deoj_device_buffer.readUInt16BE(0);\\n  const deoj_instance = deoj_instance_buffer.readUInt8(0);\\n  const deoj = [deoj_device, deoj_instance];\\n  const esv = esv_buffer.readUInt8(0);\\n  const opc = opc_buffer.readUInt8(0);\\n  const epc = epc_buffer.readUInt8(0);\\n  const pdc = pdc_buffer.readUInt8(0);\\n  let edt = [];\\n  \\n  if (buffer.length >= 15) {\\n    const edt_buffer = buffer.slice(14);\\n    for (var i = 0; i < edt_buffer.length; i++) {\\n        edt[i] = edt_buffer.readUInt8(i);\\n    }\\n  }\\n\\n  // ECHONET Lite header check\\n  if (ehd == 0x1081) {\\n    msg.elr = {\\n        \\\"ip\\\"            : msg.ip,\\n        \\\"ehd\\\"           : ehd,\\n        \\\"tid\\\"           : tid,\\n        \\\"seoj\\\"          : seoj,\\n        \\\"deoj\\\"          : deoj,\\n        \\\"esv\\\"           : esv,\\n        \\\"opc\\\"           : opc,\\n        \\\"epc\\\"           : epc,\\n        \\\"pdc\\\"           : pdc,\\n        \\\"edt\\\"           : edt\\n    };\\n  }\\n}\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":324,\"y\":458,\"wires\":[[\"f79f22e2.9b9448\",\"c709dd31.ebd05\"]]},{\"id\":\"f79f22e2.9b9448\",\"type\":\"function\",\"z\":\"b25212d8.336a88\",\"name\":\"filter keyStatus\",\"func\":\"//  msg.elr.ip      // ip address (String)\\n//  msg.elr.ehd     // EHD (Int)\\n//  msg.elr.tid     // TID (Int)\\n//  msg.elr.seoj    // SEOJ ([Int:device, Int:instance])\\n//  msg.elr.deoj    // DEOJ ([Int:device, Int:instance])\\n//  msg.elr.esv     // ESV (Int)\\n//  msg.elr.opc     // OPC (Int)\\n//  msg.elr.epc     // EPC (Int)\\n//  msg.elr.pdc     // PDC (Int)\\n//  msg.elr.edt     // EDT ([Int]) or [](no EDT data)\\n\\n// \u96fb\u5b50\u9320 EOJ=0x026f, \u958b\u9589\u72b6\u614b EPC=0xe0\\nif ((msg.elr.seoj[0] == 0x026f) && (msg.elr.epc == 0xe0)) {\\n    msg.payload = msg.elr.edt[0];\\n}\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":519,\"y\":458,\"wires\":[[\"acff4917.ab63f8\"]]},{\"id\":\"acff4917.ab63f8\",\"type\":\"switch\",\"z\":\"b25212d8.336a88\",\"name\":\"\",\"property\":\"payload\",\"propertyType\":\"msg\",\"rules\":[{\"t\":\"eq\",\"v\":\"0x41\",\"vt\":\"num\"},{\"t\":\"eq\",\"v\":\"0x42\",\"vt\":\"num\"},{\"t\":\"else\"}],\"checkall\":\"true\",\"outputs\":3,\"x\":682.5,\"y\":459,\"wires\":[[\"60038e3d.3ea5\"],[\"49fe4793.c299c8\"],[]]},{\"id\":\"60038e3d.3ea5\",\"type\":\"link out\",\"z\":\"b25212d8.336a88\",\"name\":\"0x41\",\"links\":[\"2ab8c00.fd8fd4\"],\"x\":798.5,\"y\":446,\"wires\":[]},{\"id\":\"49fe4793.c299c8\",\"type\":\"link out\",\"z\":\"b25212d8.336a88\",\"name\":\"0x42\",\"links\":[\"7bab7379.ce52ac\"],\"x\":800.5,\"y\":484,\"wires\":[]},{\"id\":\"42922bec.b77014\",\"type\":\"udp in\",\"z\":\"b25212d8.336a88\",\"name\":\"EL receive\",\"iface\":\"\",\"port\":\"3610\",\"ipv\":\"udp4\",\"multicast\":\"true\",\"group\":\"224.0.23.0\",\"datatype\":\"buffer\",\"x\":118,\"y\":459,\"wires\":[[\"2cd805cd.f6b84a\",\"c617b521.c138c8\",\"81a3a52d.f2ecd8\"]]},{\"id\":\"c617b521.c138c8\",\"type\":\"debug\",\"z\":\"b25212d8.336a88\",\"name\":\"\",\"active\":true,\"console\":\"false\",\"complete\":\"false\",\"x\":324.5,\"y\":509,\"wires\":[]},{\"id\":\"c709dd31.ebd05\",\"type\":\"debug\",\"z\":\"b25212d8.336a88\",\"name\":\"\",\"active\":true,\"console\":\"false\",\"complete\":\"elr\",\"x\":520,\"y\":506,\"wires\":[]},{\"id\":\"41393aaf.0409c4\",\"type\":\"inject\",\"z\":\"b25212d8.336a88\",\"name\":\"Search\",\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"repeat\":\"\",\"crontab\":\"\",\"once\":false,\"x\":112,\"y\":1251,\"wires\":[[\"5819b7f9.f2929\"]]},{\"id\":\"5819b7f9.f2929\",\"type\":\"function\",\"z\":\"b25212d8.336a88\",\"name\":\"Search\",\"func\":\"//  msg.els.ip_string   // ip address (String)\\n//  msg.els.tid         // TID (Int)\\n//  msg.els.seoj        // SEOJ ([Int:device, Int:instance])\\n//  msg.els.deoj        // DEOJ ([Int:device, Int:instance])\\n//  msg.els.esv         // ESV (Int)\\n//  msg.els.epc         // EPC (Int)\\n//  msg.els.edt_int     // EDT ([Int])\\n\\nmsg.els = {\\n    \\\"ip\\\" : \\\"224.0.23.0\\\",\\n    \\\"tid\\\" : 5,\\n    \\\"seoj\\\" : [0x05ff,1],\\n    \\\"deoj\\\" : [0x0ef0,1],\\n    \\\"esv\\\" : 0x62,\\n    \\\"epc\\\" : 0xD6\\n};\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":301,\"y\":1260,\"wires\":[[]]},{\"id\":\"d1d50d8a.9a455\",\"type\":\"udp out\",\"z\":\"b25212d8.336a88\",\"name\":\"\",\"addr\":\"\",\"iface\":\"\",\"port\":\"3610\",\"ipv\":\"udp4\",\"outport\":\"\",\"base64\":false,\"multicast\":\"multi\",\"x\":769,\"y\":206,\"wires\":[]},{\"id\":\"816be296.50e15\",\"type\":\"inject\",\"z\":\"b25212d8.336a88\",\"name\":\"ON\",\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"repeat\":\"\",\"crontab\":\"\",\"once\":false,\"x\":146,\"y\":206,\"wires\":[[\"30b813d1.96d6f4\",\"8f824877.268258\"]]},{\"id\":\"7b5baebc.d748d\",\"type\":\"function\",\"z\":\"b25212d8.336a88\",\"name\":\"Send EL1\",\"func\":\"// Send ECHONET Lite packet\\n// Assumption: OPC = 1\\n//\\n//  Usage:\\n//      Input following data\\n//\\n//  msg.els.ip      // ip address (String)\\n//  msg.els.tid     // TID (Int)\\n//  msg.els.seoj    // SEOJ ([Int:device, Int:instance])\\n//  msg.els.deoj    // DEOJ ([Int:device, Int:instance])\\n//  msg.els.esv     // ESV (Int)\\n//  msg.els.epc     // EPC (Int)\\n//  msg.els.edt     // EDT ([Int])\\n//          // in case of no EDT data, no edt or []\\n\\nconst tid_buffer = Buffer.allocUnsafe(2);\\nlet   seoj_buffer = Buffer.allocUnsafe(3);\\nconst seoj = msg.els.seoj;\\nlet   deoj_buffer = Buffer.allocUnsafe(3);\\nconst deoj = msg.els.deoj;\\nconst esv_buffer = Buffer.allocUnsafe(1);\\nconst opc_buffer = Buffer.from([1]);\\nconst epc_buffer = Buffer.allocUnsafe(1);\\nconst pdc_buffer = Buffer.allocUnsafe(1);\\nlet edt = msg.els.edt;\\n\\ntid_buffer.writeUInt16BE(msg.els.tid, 0);\\nesv_buffer.writeUInt8(msg.els.esv, 0);\\nepc_buffer.writeUInt8(msg.els.epc, 0);\\n\\nseoj_buffer.writeUInt16BE(seoj[0], 0);\\nseoj_buffer.writeUInt8(seoj[1], 2);\\ndeoj_buffer.writeUInt16BE(deoj[0], 0);\\ndeoj_buffer.writeUInt8(deoj[1], 2);\\n\\n// edt[]\u304b\u3089edt_buffer\u3092\u4f5c\u6210\\nif ((typeof edt) == \\\"undefined\\\") {\\n    edt = [];\\n}\\n\\nconst edt_buffer = Buffer.allocUnsafe(edt.length);\\nfor (var i = 0; i < edt.length; i++) {\\n    edt_buffer.writeUInt8(edt[i], i);\\n}\\n\\npdc_buffer.writeUInt8(edt_buffer.length, 0);\\n\\n// Create ECHONET Lite packet\\nconst el_buffer = Buffer.from([\\n\\t0x10, 0x81,\\n\\ttid_buffer[0], tid_buffer[1],\\n\\tseoj_buffer[0], seoj_buffer[1], seoj_buffer[2],\\n\\tdeoj_buffer[0], deoj_buffer[1], deoj_buffer[2],\\n\\tesv_buffer[0], opc_buffer[0], epc_buffer[0], pdc_buffer[0]]);\\n\\n// add EDT data\\nif (edt_buffer.length !== 0) {\\n    msg.payload = Buffer.concat([el_buffer, edt_buffer], \\n        (el_buffer.length + edt_buffer.length));\\n} else {\\n    msg.payload = el_buffer;\\n}\\n\\nmsg.ip = msg.els.ip;\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":547.5,\"y\":207,\"wires\":[[\"d1d50d8a.9a455\",\"20a78033.c64988\",\"2ecc22f4.b79f3e\"]]},{\"id\":\"20a78033.c64988\",\"type\":\"debug\",\"z\":\"b25212d8.336a88\",\"name\":\"\",\"active\":true,\"console\":\"false\",\"complete\":\"ip\",\"x\":760,\"y\":262,\"wires\":[]},{\"id\":\"8f824877.268258\",\"type\":\"function\",\"z\":\"b25212d8.336a88\",\"name\":\"\u30a8\u30a2\u30b3\u30f3\u3000ON\",\"func\":\"//  msg.els.ip_string   // ip address (String)\\n//  msg.els.tid         // TID (Int)\\n//  msg.els.seoj        // SEOJ ([Int:device, Int:instance])\\n//  msg.els.deoj        // DEOJ ([Int:device, Int:instance])\\n//  msg.els.esv         // ESV (Int)\\n//  msg.els.epc         // EPC (Int)\\n//  msg.els.edt_int     // EDT ([Int])\\n\\nmsg.els = {\\n    \\\"ip\\\" : \\\"224.0.23.0\\\",\\n    \\\"tid\\\" : 5,\\n    \\\"seoj\\\" : [0x05ff,1],\\n    \\\"deoj\\\" : [0x0130,1],\\n    \\\"esv\\\" : 0x61,\\n    \\\"epc\\\" : 0x80,\\n    \\\"edt\\\" : [0x30]\\n};\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":348.5,\"y\":206,\"wires\":[[\"7b5baebc.d748d\"]]},{\"id\":\"30b813d1.96d6f4\",\"type\":\"function\",\"z\":\"b25212d8.336a88\",\"name\":\"\u30e9\u30a4\u30c8\u3000ON\",\"func\":\"//  msg.els.ip_string   // ip address (String)\\n//  msg.els.tid         // TID (Int)\\n//  msg.els.seoj        // SEOJ ([Int:device, Int:instance])\\n//  msg.els.deoj        // DEOJ ([Int:device, Int:instance])\\n//  msg.els.esv         // ESV (Int)\\n//  msg.els.epc         // EPC (Int)\\n//  msg.els.edt_int     // EDT ([Int])\\n\\nmsg.els = {\\n    \\\"ip\\\" : \\\"224.0.23.0\\\",\\n    \\\"tid\\\" : 5,\\n    \\\"seoj\\\" : [0x05ff,1],\\n    \\\"deoj\\\" : [0x0290,1],\\n    \\\"esv\\\" : 0x61,\\n    \\\"epc\\\" : 0x80,\\n    \\\"edt\\\" : [0x30]\\n};\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":338.5,\"y\":248,\"wires\":[[\"7b5baebc.d748d\"]]},{\"id\":\"2bcde2cc.b0e0b6\",\"type\":\"function\",\"z\":\"b25212d8.336a88\",\"name\":\"\u30e9\u30a4\u30c8\u3000OFF\",\"func\":\"//  msg.els.ip_string   // ip address (String)\\n//  msg.els.tid         // TID (Int)\\n//  msg.els.seoj        // SEOJ ([Int:device, Int:instance])\\n//  msg.els.deoj        // DEOJ ([Int:device, Int:instance])\\n//  msg.els.esv         // ESV (Int)\\n//  msg.els.epc         // EPC (Int)\\n//  msg.els.edt_int     // EDT ([Int])\\n\\nmsg.els = {\\n    \\\"ip\\\" : \\\"224.0.23.0\\\",\\n    \\\"tid\\\" : 5,\\n    \\\"seoj\\\" : [0x05ff,1],\\n    \\\"deoj\\\" : [0x0290,1],\\n    \\\"esv\\\" : 0x61,\\n    \\\"epc\\\" : 0x80,\\n    \\\"edt\\\" : [0x31]\\n};\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":334.5,\"y\":329,\"wires\":[[\"7b5baebc.d748d\"]]},{\"id\":\"46ac93c4.9bf35c\",\"type\":\"function\",\"z\":\"b25212d8.336a88\",\"name\":\"\u30a8\u30a2\u30b3\u30f3\u3000OFF\",\"func\":\"//  msg.els.ip_string   // ip address (String)\\n//  msg.els.tid         // TID (Int)\\n//  msg.els.seoj        // SEOJ ([Int:device, Int:instance])\\n//  msg.els.deoj        // DEOJ ([Int:device, Int:instance])\\n//  msg.els.esv         // ESV (Int)\\n//  msg.els.epc         // EPC (Int)\\n//  msg.els.edt_int     // EDT ([Int])\\n\\nmsg.els = {\\n    \\\"ip\\\" : \\\"224.0.23.0\\\",\\n    \\\"tid\\\" : 5,\\n    \\\"seoj\\\" : [0x05ff,1],\\n    \\\"deoj\\\" : [0x0130,1],\\n    \\\"esv\\\" : 0x61,\\n    \\\"epc\\\" : 0x80,\\n    \\\"edt\\\" : [0x31]\\n};\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":348.5,\"y\":289,\"wires\":[[\"7b5baebc.d748d\"]]},{\"id\":\"9231a3bb.ce8bc\",\"type\":\"inject\",\"z\":\"b25212d8.336a88\",\"name\":\"OFF\",\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"repeat\":\"\",\"crontab\":\"\",\"once\":false,\"x\":149,\"y\":290,\"wires\":[[\"2bcde2cc.b0e0b6\",\"46ac93c4.9bf35c\"]]},{\"id\":\"2ecc22f4.b79f3e\",\"type\":\"debug\",\"z\":\"b25212d8.336a88\",\"name\":\"\",\"active\":true,\"console\":\"false\",\"complete\":\"false\",\"x\":780,\"y\":308,\"wires\":[]},{\"id\":\"fad08edd.8db6c8\",\"type\":\"link in\",\"z\":\"b25212d8.336a88\",\"name\":\"UDP send\",\"links\":[],\"x\":605,\"y\":269,\"wires\":[[\"d1d50d8a.9a455\"]]},{\"id\":\"81a3a52d.f2ecd8\",\"type\":\"link out\",\"z\":\"b25212d8.336a88\",\"name\":\"UDP receive\",\"links\":[],\"x\":177.5,\"y\":513,\"wires\":[]},{\"id\":\"48da7a43.d0e234\",\"type\":\"function\",\"z\":\"b25212d8.336a88\",\"name\":\"Search\",\"func\":\"//  msg.els.ip_string   // ip address (String)\\n//  msg.els.tid         // TID (Int)\\n//  msg.els.seoj        // SEOJ ([Int:device, Int:instance])\\n//  msg.els.deoj        // DEOJ ([Int:device, Int:instance])\\n//  msg.els.esv         // ESV (Int)\\n//  msg.els.epc         // EPC (Int)\\n//  msg.els.edt_int     // EDT ([Int])\\n\\nmsg.els = {\\n    \\\"ip\\\" : \\\"224.0.23.0\\\",\\n    \\\"tid\\\" : 0x30f0,\\n    \\\"seoj\\\" : [0x05ff,1],\\n    \\\"deoj\\\" : [0x0ef0,1],\\n    \\\"esv\\\" : 0x62,\\n    \\\"epc\\\" : 0xd6,\\n    \\\"edt\\\" : []\\n};\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":330,\"y\":158,\"wires\":[[\"7b5baebc.d748d\"]]},{\"id\":\"276ccd10.744a02\",\"type\":\"comment\",\"z\":\"b25212d8.336a88\",\"name\":\"Send EL1\",\"info\":\"Description: msg.els\u306e\u5024\u3092\u5143\u306bECHONET Lite\u306e\u30d0\u30a4\u30ca\u30ea\u30fc\u30c7\u30fc\u30bf\u3092\u4f5c\u6210\u3057UDP\u9001\u4fe1node\u306b\u5024\u3092\u6e21\u3059\\n\\nAssumption: OPC = 1\\n\\nUsage: \u4ee5\u4e0b\u306e\u30c7\u30fc\u30bf\u3092\u5165\u529b\u3057\u307e\u3059\\n\\n- msg.els.ip\\n    - Content: ip address\\n    - Data Type: String\\n    - Sample: \\\"224.0.23.0\\\"\\n- msg.els.tid\\n    - Content: TID\\n    - Data Type: Int\\n    - Sample: 0x0101\\n- msg.els.seoj\\n    - Content: SEOJ\\n    - Data Type: [Int:device, Int:instance]\\n    - device: EOJ, instance: instance number\\n    - Sample: [0x05ff, 0x01]\\n- msg.els.deoj\\n    - Content: DEOJ\\n    - Data Type: [Int:device, Int:instance]\\n    - device: EOJ, instance: instance number\\n    - Sample: [0x0130, 0x01]\\n- msg.els.esv\\n    - Content: ESV\\n    - Data Type: Int\\n    - Sample: 0x62\\n- msg.els.epc\\n    - Content: EPC\\n    - Data Type: Int\\n    - Sample: 0x80\\n- msg.els.edt\\n    - Content: EDT\\n    - Data Type: [Int]\\n    - Sample: [0x30]\\n    - Note: in case of no EDT data, []\",\"x\":546.5,\"y\":168,\"wires\":[]},{\"id\":\"ac7445a8.9d057\",\"type\":\"comment\",\"z\":\"b25212d8.336a88\",\"name\":\"Parse EL1\",\"info\":\"Description: UDP\u53d7\u4fe1node\u304b\u3089\u6e21\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3092\u30d1\u30fc\u30b9\u3057msg.elr\u3068\u3057\u3066\u6e21\u3059\\n\\nAssumption: OPC = 1\\n\\nUsage: \u4ee5\u4e0b\u306e\u30c7\u30fc\u30bf\u3092\u51fa\u529b\u3059\u308b\\n\\n- msg.elr.ip\\n    - Content: ip address\\n    - Data Type: String\\n    - Sample: \\\"224.0.23.0\\\"\\n- msg.elr.ehd\\n    - Content: EHD\\n    - Data Type: Int\\n    - Sample: 0x1081\\n- msg.elr.tid\\n    - Content: TID\\n    - Data Type: Int\\n    - Sample: 0x0101\\n- msg.elr.seoj\\n    - Content: SEOJ\\n    - Data Type: [Int:device, Int:instance]\\n    - device: EOJ, instance: instance number\\n    - Sample: [0x05ff, 0x01]\\n- msg.elr.deoj\\n    - Content: DEOJ\\n    - Data Type: [Int:device, Int:instance]\\n    - device: EOJ, instance: instance number\\n    - Sample: [0x0130, 0x01]\\n- msg.elr.esv\\n    - Content: ESV\\n    - Data Type: Int\\n    - Sample: 0x62\\n- msg.elr.opc\\n    - Content: OPC\\n    - Data Type: Int\\n    - Sample: 0x01\\n- msg.elr.epc\\n    - Content: EPC\\n    - Data Type: Int\\n    - Sample: 0x80\\n- msg.elr.pdc\\n    - Content: PDC\\n    - Data Type: Int\\n    - Sample: 0x01\\n- msg.elr.edt\\n    - Content: EDT\\n    - Data Type: [Int]\\n    - Sample: [0x30]\\n    - Note: in case of no EDT data, []\",\"x\":313,\"y\":419,\"wires\":[]}]\n```\n"}