{"context": "\n\n\u6982\u8981\n\n2015/05\u306eHeroku\u306e\u6599\u91d1\u4f53\u5236\u6539\u5b9a\u3067\u3001Free\u30d7\u30e9\u30f3\u3067\u3082worker dyno\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002\n\u3055\u3089\u306b\u30012015.06\u306b\u306fHeroku Redis\u304c\u4e00\u822c\u516c\u958b\u3055\u308c\u305f\u300225MB\u307e\u3067\u306a\u3089\u7121\u6599\u3067\u4f7f\u3048\u308b\u3002\nRails 4.2\u3067\u8ffd\u52a0\u3055\u308c\u305fActiveJob\u306e\u6a5f\u69cb\u3092\u4f7f\u3063\u3066\u3001\u30b7\u30f3\u30d7\u30eb\u306b\u3001\u52b9\u7387\u7684\u306b\u7121\u6599\u3067Heroku\u4e0a\u3067\u30d0\u30c3\u30af\u30b0\u30e9\u30f3\u30c9\u51e6\u7406\u3092\u5b9f\u88c5\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002\n\n\n\u80cc\u666f\u77e5\u8b58\n\nHeroku\n\nHeroku\u306b\u306fweb dyno\u3068worker dyno\u304c\u3042\u308b\u3002\n\n\nHTTP\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u51e6\u7406\u3059\u308b\u306e\u304cweb dyno\n\u30d0\u30c3\u30af\u30b0\u30e9\u30f3\u30c9\u3067\u51e6\u7406\u3092\u3059\u308b\u306e\u304cworker dyno\n\u5143\u3005\u306e\u7121\u6599\u30d7\u30e9\u30f3\u3067\u306fweb dyno\u306e\u8ffd\u52a0\u306b\u306f\u6599\u91d1\u304c\u304b\u304b\u3063\u305f\u304c\u3001\u65b0\u3057\u3044\u7121\u6599\u30d7\u30e9\u30f3\u3067\u306f\u5236\u9650\u4ed8\u304d\u306a\u304c\u3089worker dyno\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002\u5b9f\u9a13\u3059\u308b\u306b\u306f\u3001\u305d\u308c\u3067\u3082\u5341\u5206\u3002\n\n\nHeroku\u4e0a\u3067\u30d0\u30c3\u30af\u30b0\u30e9\u30f3\u30c9\u51e6\u7406\u3092\u3084\u308b\u4ed5\u7d44\u307f\u3068\u3057\u3066\u306fDelayed Job\u3068\u3044\u3046\u3082\u306e\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u305f\u304c\u3001 DB\u306e\u8ca0\u8377\u7684\u306a\u554f\u984c\u304b\u3089\u73fe\u5728\u306f\u4f7f\u7528\u304c\u63a8\u5968\u3055\u308c\u3066\u3044\u306a\u3044\u3002\n\n\n\u4ee3\u308f\u308a\u306bRedis\u30d9\u30fc\u30b9\u306e\u30ad\u30e5\u30fc\u30a4\u30f3\u30b0\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u4f7f\u7528\u304c\u63a8\u5968\u3055\u308c\u3066\u3044\u308b\u3002(Resque\u306a\u3069)\n\n\n\n\nRedis\u3001Resque\n\nResque Scheduler\n\nResque\u5358\u4f53\u3067\u306f\u3001\u30ad\u30e5\u30fc\u306b\u7a4d\u307e\u308c\u305f\u30b8\u30e7\u30d6\u3092\u9806\u6b21\u5b9f\u884c\u3057\u3066\u3044\u304f\u3053\u3068\u3057\u304b\u3067\u304d\u306a\u3044\u304c\u3001Resque Scheduler\u3092\u4f7f\u3046\u3068\u3001\u4efb\u610f\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u30b8\u30e7\u30d6\u3092\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\u5177\u4f53\u7684\u306b\u306f\u3001\u300c\u6570\u65e5\u5f8c\u306b\u30e1\u30fc\u30eb\u3092\u9001\u308a\u305f\u3044\u300d\u3068\u3044\u3046\u3088\u3046\u306a\u30b8\u30e7\u30d6\u306e\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u304c\u53ef\u80fd\u306b\u306a\u308b\u3002\n\u3084\u3084\u3053\u3057\u304f\u306a\u308b\u305f\u3081\u3001Resque Scheduler\u306e\u8aac\u660e\u306f\u3053\u3053\u3067\u306f\u5272\u611b\u3002\n\n\nActiveJob\n\nRails 4.2\u3067\u767b\u5834\u3057\u305f\u3001\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30b8\u30e7\u30d6\u306e\u5b9f\u884c\u6a5f\u69cb\u3002\nDelayed Job\u3068Resque\u306a\u3069\u306e\u3088\u3046\u306b\u3001\u3055\u307e\u3056\u307e\u306a\u30b8\u30e7\u30d6\u5b9f\u884c\u6a5f\u80fd\u306eAPI\u306e\u9055\u3044\u3092\u6c17\u306b\u305b\u305a\u306b\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30b8\u30e7\u30d6\u306e\u5b9f\u88c5\u3092\u8a18\u8ff0\u3067\u304d\u308b\u3002\n\n\n\u30b9\u30c6\u30c3\u30d7\n\n\u958b\u767a\u74b0\u5883\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\nHeroku\u306e\u8a2d\u5b9a\n\u30ed\u30fc\u30ab\u30eb\u3067\u52d5\u304b\u3059\nHeroku\u4e0a\u3067\u52d5\u4f5c\u78ba\u8a8d\n\n\n\u958b\u767a\u74b0\u5883\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\nRedis\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nbrew install redis\n\n\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u3001\u81ea\u52d5\u8d77\u52d5\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3002(\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306b\u8868\u793a\u3055\u308c\u308b)\n\n\u958b\u767a\u6642\n\nResque\u306e\u8a2d\u5b9a\n\ngem\u306e\u8ffd\u52a0\n\nGemfile\ngem 'resque'\n\n\ngem\u3092\u8ffd\u52a0\u3059\u308b\u3060\u3051\u3067OK\u3002\u8ffd\u52a0\u3057\u305f\u3089bundle install\u3092\u5b9f\u884c\u3059\u308b\u3002\n\nResque\u306e\u8a2d\u5b9a\n\nconfig/initializers/resque.rb\nResque.redis = Redis.new(:url => ENV['REDIS_URL'])\nResque.after_fork = Proc.new { ActiveRecord::Base.establish_connection }\n\n\n\u30a4\u30cb\u30b7\u30e3\u30e9\u30a4\u30b6config/initializers/resque.rb\u3092\u4f5c\u6210\u3057\u3066\u3001\u63a5\u7d9a\u5148\u306eRedis\u306e\u8a2d\u5b9a\u3068\u3001\u30b8\u30e7\u30d6\u5185\u3067ActiveRecord\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3002\nHeroku Redis\u3067Rails\u304b\u3089Redis\u3092\u4f7f\u3046\u5834\u5408\u306f\u3001url\u306bENV['REDIS_URL']\u3092\u6307\u5b9a\u3059\u308b\u3002(https://devcenter.heroku.com/articles/heroku-redis#connecting-in-ruby)\n\u74b0\u5883\u5909\u6570REDIS_URL\u306f\u3001Heroku Redis\u30a2\u30c9\u30aa\u30f3\u3092\u8ffd\u52a0\u3057\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u30bb\u30c3\u30c8\u3055\u308c\u308b\u3002\u5f53\u7136\u3001\u30ed\u30fc\u30ab\u30eb\u3067\u5b9f\u884c\u3057\u305f\u5834\u5408\u306furl\u304c\u7a7a\u3068\u306a\u308b\u306e\u3067\u3001Redis\u30b5\u30fc\u30d0\u30fc\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u4ee5\u5916\u306e\u5834\u6240\u3067\u52d5\u3044\u3066\u3044\u308b\u5834\u5408\u306f\u5225\u9014\u6307\u5b9a\u304c\u5fc5\u8981\u3002\nfork\u5f8c\u306bActiveRecord::Base.establish_connection\u3092\u5b9f\u884c\u3057\u3066\u3001ActiveRecord\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u3002\n\nActiveJob\u3067Resque\u3092\u4f7f\u3046\u3088\u3046\u306b\u8a2d\u5b9a\n\nconfig/initializers/active_job.rb\nActiveJob::Base.queue_adapter = :resque\n\n\n\u540c\u3058\u304f\u3001ActiveJob\u7528\u306e\u30a4\u30cb\u30b7\u30e3\u30e9\u30a4\u30b6\u3092\u4f5c\u6210\u3057\u3001\u305d\u306e\u4e2d\u3067queue_adapter\u306b:resque\u3092\u6307\u5b9a\u3059\u308b\u3002\n\nResque\u8d77\u52d5\u7528\u30bf\u30b9\u30af\u306e\u8ffd\u52a0\n\nlib/tasks/resque.rake\nrequire 'resque/tasks'\n\n\n\nResque\u306e\u8d77\u52d5\nTERM_CHILD=1 QUEUES=* rake environment resque:work\n\nTERM_CHILD=1\u3092\u3064\u3051\u306a\u3044\u3068\u3001WARNING: This way of doing signal handling is now deprecated.\u3068\u3044\u3046\u8b66\u544a\u304c\u8868\u793a\u3055\u308c\u308b\u3002\u3053\u308c\u306f\u3001Resque\u306e\u5143\u3005\u306e\u5b9f\u88c5\u3067\u3001\u30d7\u30ed\u30bb\u30b9\u3092\u7d42\u4e86\u3055\u305b\u308b\u305f\u3081\u306e\u30b7\u30b0\u30ca\u30eb\u3092\u53d7\u3051\u53d6\u3063\u305f\u969b\u306e\u4ed5\u69d8\u306b\u554f\u984c\u304c\u3042\u3063\u305f\u305f\u3081\u3002\u4e92\u63db\u6027\u306e\u554f\u984c\u306e\u305f\u3081\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u6319\u52d5\u306f\u53e4\u3044\u4ed5\u69d8\u306e\u307e\u307e\u306b\u306a\u3063\u3066\u3044\u308b\u304c\u3001\u73fe\u5728\u3067\u306f\u305d\u306e\u4ed5\u69d8\u306f\u975e\u63a8\u5968\u3068\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3053\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u308b\u3002TERM_CHILD=1\u3092\u3064\u3051\u308b\u3068\u4e00\u822c\u7684\u306a\u3001\u4ed6\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3068\u540c\u3058\u7d42\u4e86\u306e\u6319\u52d5\u306b\u306a\u308a\u3001\u8b66\u544a\u3082\u6d88\u3048\u308b\u3002\nhttp://hone.herokuapp.com/resque/2012/08/21/resque-signals.html\n\n\u5b9f\u88c5\n\nJob\u30af\u30e9\u30b9\u3092\u4f5c\u308b\nrails g job my_job\n\nclass MyJob < ActiveJob::Base\n  queue_as :default\n\n  def perform(instance)\n    p \"Process #{instance}\"\n  end\nend\n\n\n\u975e\u540c\u671f\u51e6\u7406\u3092\u30ad\u30e5\u30fc\u306b\u7a4d\u3080\nMyJob.perform_later(instance)\n\n\nHeroku\u306e\u8a2d\u5b9a\n\nHeroku Redis\u306e\u8ffd\u52a0\nhttps://elements.heroku.com/addons/heroku-redis \u304b\u3089\u30d7\u30e9\u30f3\u3092\u9078\u629e\u3057\u3066\u8ffd\u52a0\u3059\u308b\u300225MB\u307e\u3067\u306a\u3089\u7121\u6599\u306eHobby\u30d7\u30e9\u30f3\u304c\u4f7f\u3048\u308b\u3002Hobby\u30d7\u30e9\u30f3\u3067\u306f\u6c38\u7d9a\u5316\u306f\u3067\u304d\u306a\u3044\u304c\u3001Resque\u3067\u4f7f\u3046\u5206\u306b\u306f\u5927\u304d\u306a\u554f\u984c\u306f\u306a\u3044\u3002(Redis\u304c\u518d\u8d77\u52d5\u3057\u305f\u6642\u306b\u305d\u306e\u6642\u306e\u30ad\u30e5\u30fc\u306e\u5185\u5bb9\u304c\u6d88\u3048\u3066\u3057\u307e\u3046\u3068\u3044\u3046\u554f\u984c\u306f\u3042\u308b\u304b\u3082\u3057\u308c\u306a\u3044)\n\nWorker\u7528\u30d7\u30ed\u30bb\u30b9\u306e\u8a2d\u5b9a\n\nProcfile\nworker: TERM_CHILD=1 QUEUES=* rake environment resque:work\n\n\nResque\u7528\u306eRake\u30bf\u30b9\u30af\u3092Worker\u3068\u3057\u3066\u8d77\u52d5\u3055\u305b\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3002\n\nWorker\u306e\u6709\u52b9\u5316\n\n\u6700\u5f8c\u306b\u3001\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u4e0a\u304b\u3089Worker\u3092\u6709\u52b9\u5316\u3057\u3066\u5b8c\u6210\u3002\n\n\u7d50\u8ad6\nHeroku\u306e\u30d7\u30e9\u30f3\u6539\u5b9a\u3001Heroku Redis\u306e\u767b\u5834\u3001Active Job\u306e\u767b\u5834\u306b\u3088\u3063\u3066\u3001Heroku\u4e0a\u3067\u306e\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u51e6\u7406\u306e\u5b9f\u88c5\u304c\u3068\u3066\u3082\u8eab\u8fd1\u306b\u306a\u3063\u305f\u3002\u3069\u3093\u3069\u3093\u6d3b\u7528\u3057\u3088\u3046\u3002\n\n\u53c2\u8003\u30ea\u30f3\u30af\n\nhttp://blog.flect.co.jp/labo/2015/05/free-dyno-fae3.html\nhttps://devcenter.heroku.com/articles/delayed-job\nhttps://blog.engineyard.com/2014/getting-started-with-active-job\nhttp://qiita.com/Takayuki-Suzuki@github/items/cf2f904873496ff6c384\n\n# \u6982\u8981\n* 2015/05\u306eHeroku\u306e\u6599\u91d1\u4f53\u5236\u6539\u5b9a\u3067\u3001Free\u30d7\u30e9\u30f3\u3067\u3082worker dyno\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002\n* \u3055\u3089\u306b\u30012015.06\u306b\u306fHeroku Redis\u304c\u4e00\u822c\u516c\u958b\u3055\u308c\u305f\u300225MB\u307e\u3067\u306a\u3089\u7121\u6599\u3067\u4f7f\u3048\u308b\u3002\n* Rails 4.2\u3067\u8ffd\u52a0\u3055\u308c\u305f`ActiveJob`\u306e\u6a5f\u69cb\u3092\u4f7f\u3063\u3066\u3001\u30b7\u30f3\u30d7\u30eb\u306b\u3001\u52b9\u7387\u7684\u306b\u7121\u6599\u3067Heroku\u4e0a\u3067\u30d0\u30c3\u30af\u30b0\u30e9\u30f3\u30c9\u51e6\u7406\u3092\u5b9f\u88c5\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002\n\n# \u80cc\u666f\u77e5\u8b58\n## Heroku\n* Heroku\u306b\u306fweb dyno\u3068worker dyno\u304c\u3042\u308b\u3002\n  * HTTP\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u51e6\u7406\u3059\u308b\u306e\u304cweb dyno\n  * \u30d0\u30c3\u30af\u30b0\u30e9\u30f3\u30c9\u3067\u51e6\u7406\u3092\u3059\u308b\u306e\u304cworker dyno\n  * \u5143\u3005\u306e\u7121\u6599\u30d7\u30e9\u30f3\u3067\u306fweb dyno\u306e\u8ffd\u52a0\u306b\u306f\u6599\u91d1\u304c\u304b\u304b\u3063\u305f\u304c\u3001\u65b0\u3057\u3044\u7121\u6599\u30d7\u30e9\u30f3\u3067\u306f\u5236\u9650\u4ed8\u304d\u306a\u304c\u3089worker dyno\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002\u5b9f\u9a13\u3059\u308b\u306b\u306f\u3001\u305d\u308c\u3067\u3082\u5341\u5206\u3002\n* Heroku\u4e0a\u3067\u30d0\u30c3\u30af\u30b0\u30e9\u30f3\u30c9\u51e6\u7406\u3092\u3084\u308b\u4ed5\u7d44\u307f\u3068\u3057\u3066\u306f`Delayed Job`\u3068\u3044\u3046\u3082\u306e\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u305f\u304c\u3001 DB\u306e\u8ca0\u8377\u7684\u306a\u554f\u984c\u304b\u3089\u73fe\u5728\u306f\u4f7f\u7528\u304c[\u63a8\u5968\u3055\u308c\u3066\u3044\u306a\u3044](https://devcenter.heroku.com/articles/delayed-job)\u3002\n  * \u4ee3\u308f\u308a\u306bRedis\u30d9\u30fc\u30b9\u306e\u30ad\u30e5\u30fc\u30a4\u30f3\u30b0\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u4f7f\u7528\u304c\u63a8\u5968\u3055\u308c\u3066\u3044\u308b\u3002(`Resque`\u306a\u3069)\n\n## Redis\u3001Resque\n### Resque Scheduler\n* Resque\u5358\u4f53\u3067\u306f\u3001\u30ad\u30e5\u30fc\u306b\u7a4d\u307e\u308c\u305f\u30b8\u30e7\u30d6\u3092\u9806\u6b21\u5b9f\u884c\u3057\u3066\u3044\u304f\u3053\u3068\u3057\u304b\u3067\u304d\u306a\u3044\u304c\u3001`Resque Scheduler`\u3092\u4f7f\u3046\u3068\u3001\u4efb\u610f\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u30b8\u30e7\u30d6\u3092\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n* \u5177\u4f53\u7684\u306b\u306f\u3001\u300c\u6570\u65e5\u5f8c\u306b\u30e1\u30fc\u30eb\u3092\u9001\u308a\u305f\u3044\u300d\u3068\u3044\u3046\u3088\u3046\u306a\u30b8\u30e7\u30d6\u306e\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u304c\u53ef\u80fd\u306b\u306a\u308b\u3002\n* \u3084\u3084\u3053\u3057\u304f\u306a\u308b\u305f\u3081\u3001`Resque Scheduler`\u306e\u8aac\u660e\u306f\u3053\u3053\u3067\u306f\u5272\u611b\u3002\n\n## ActiveJob\n* Rails 4.2\u3067\u767b\u5834\u3057\u305f\u3001\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30b8\u30e7\u30d6\u306e\u5b9f\u884c\u6a5f\u69cb\u3002\n* Delayed Job\u3068Resque\u306a\u3069\u306e\u3088\u3046\u306b\u3001\u3055\u307e\u3056\u307e\u306a\u30b8\u30e7\u30d6\u5b9f\u884c\u6a5f\u80fd\u306eAPI\u306e\u9055\u3044\u3092\u6c17\u306b\u305b\u305a\u306b\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30b8\u30e7\u30d6\u306e\u5b9f\u88c5\u3092\u8a18\u8ff0\u3067\u304d\u308b\u3002\n\n# \u30b9\u30c6\u30c3\u30d7\n1. \u958b\u767a\u74b0\u5883\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n2. Heroku\u306e\u8a2d\u5b9a\n+ \u30ed\u30fc\u30ab\u30eb\u3067\u52d5\u304b\u3059\n+ Heroku\u4e0a\u3067\u52d5\u4f5c\u78ba\u8a8d\n\n# \u958b\u767a\u74b0\u5883\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n## Redis\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\nbrew install redis\n```\n\n\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u3001\u81ea\u52d5\u8d77\u52d5\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3002(\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306b\u8868\u793a\u3055\u308c\u308b)\n\n# \u958b\u767a\u6642\n## Resque\u306e\u8a2d\u5b9a\n### gem\u306e\u8ffd\u52a0\n```:Gemfile\ngem 'resque'\n```\n\ngem\u3092\u8ffd\u52a0\u3059\u308b\u3060\u3051\u3067OK\u3002\u8ffd\u52a0\u3057\u305f\u3089`bundle install`\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n### Resque\u306e\u8a2d\u5b9a\n```rb:config/initializers/resque.rb\nResque.redis = Redis.new(:url => ENV['REDIS_URL'])\nResque.after_fork = Proc.new { ActiveRecord::Base.establish_connection }\n```\n\n\u30a4\u30cb\u30b7\u30e3\u30e9\u30a4\u30b6`config/initializers/resque.rb`\u3092\u4f5c\u6210\u3057\u3066\u3001\u63a5\u7d9a\u5148\u306eRedis\u306e\u8a2d\u5b9a\u3068\u3001\u30b8\u30e7\u30d6\u5185\u3067ActiveRecord\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\nHeroku Redis\u3067Rails\u304b\u3089Redis\u3092\u4f7f\u3046\u5834\u5408\u306f\u3001`url`\u306b`ENV['REDIS_URL']`\u3092\u6307\u5b9a\u3059\u308b\u3002(https://devcenter.heroku.com/articles/heroku-redis#connecting-in-ruby)\n\u74b0\u5883\u5909\u6570`REDIS_URL`\u306f\u3001Heroku Redis\u30a2\u30c9\u30aa\u30f3\u3092\u8ffd\u52a0\u3057\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u30bb\u30c3\u30c8\u3055\u308c\u308b\u3002\u5f53\u7136\u3001\u30ed\u30fc\u30ab\u30eb\u3067\u5b9f\u884c\u3057\u305f\u5834\u5408\u306furl\u304c\u7a7a\u3068\u306a\u308b\u306e\u3067\u3001Redis\u30b5\u30fc\u30d0\u30fc\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u4ee5\u5916\u306e\u5834\u6240\u3067\u52d5\u3044\u3066\u3044\u308b\u5834\u5408\u306f\u5225\u9014\u6307\u5b9a\u304c\u5fc5\u8981\u3002\n\nfork\u5f8c\u306b`ActiveRecord::Base.establish_connection`\u3092\u5b9f\u884c\u3057\u3066\u3001ActiveRecord\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u3002\n\n### ActiveJob\u3067Resque\u3092\u4f7f\u3046\u3088\u3046\u306b\u8a2d\u5b9a\n```rb:config/initializers/active_job.rb\nActiveJob::Base.queue_adapter = :resque\n```\n\n\u540c\u3058\u304f\u3001`ActiveJob`\u7528\u306e\u30a4\u30cb\u30b7\u30e3\u30e9\u30a4\u30b6\u3092\u4f5c\u6210\u3057\u3001\u305d\u306e\u4e2d\u3067`queue_adapter`\u306b`:resque`\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n### Resque\u8d77\u52d5\u7528\u30bf\u30b9\u30af\u306e\u8ffd\u52a0\n\n```rb:lib/tasks/resque.rake\nrequire 'resque/tasks'\n```\n\n## Resque\u306e\u8d77\u52d5\n\n```\nTERM_CHILD=1 QUEUES=* rake environment resque:work\n```\n\n`TERM_CHILD=1`\u3092\u3064\u3051\u306a\u3044\u3068\u3001`WARNING: This way of doing signal handling is now deprecated.`\u3068\u3044\u3046\u8b66\u544a\u304c\u8868\u793a\u3055\u308c\u308b\u3002\u3053\u308c\u306f\u3001Resque\u306e\u5143\u3005\u306e\u5b9f\u88c5\u3067\u3001\u30d7\u30ed\u30bb\u30b9\u3092\u7d42\u4e86\u3055\u305b\u308b\u305f\u3081\u306e\u30b7\u30b0\u30ca\u30eb\u3092\u53d7\u3051\u53d6\u3063\u305f\u969b\u306e\u4ed5\u69d8\u306b\u554f\u984c\u304c\u3042\u3063\u305f\u305f\u3081\u3002\u4e92\u63db\u6027\u306e\u554f\u984c\u306e\u305f\u3081\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u6319\u52d5\u306f\u53e4\u3044\u4ed5\u69d8\u306e\u307e\u307e\u306b\u306a\u3063\u3066\u3044\u308b\u304c\u3001\u73fe\u5728\u3067\u306f\u305d\u306e\u4ed5\u69d8\u306f\u975e\u63a8\u5968\u3068\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3053\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u308b\u3002`TERM_CHILD=1`\u3092\u3064\u3051\u308b\u3068\u4e00\u822c\u7684\u306a\u3001\u4ed6\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3068\u540c\u3058\u7d42\u4e86\u306e\u6319\u52d5\u306b\u306a\u308a\u3001\u8b66\u544a\u3082\u6d88\u3048\u308b\u3002\n\nhttp://hone.herokuapp.com/resque/2012/08/21/resque-signals.html\n\n# \u5b9f\u88c5\n## Job\u30af\u30e9\u30b9\u3092\u4f5c\u308b\n\n```\nrails g job my_job\n```\n\n```\nclass MyJob < ActiveJob::Base\n  queue_as :default\n\n  def perform(instance)\n    p \"Process #{instance}\"\n  end\nend\n```\n\n## \u975e\u540c\u671f\u51e6\u7406\u3092\u30ad\u30e5\u30fc\u306b\u7a4d\u3080\n\n```\nMyJob.perform_later(instance)\n```\n\n# Heroku\u306e\u8a2d\u5b9a\n## Heroku Redis\u306e\u8ffd\u52a0\n\nhttps://elements.heroku.com/addons/heroku-redis \u304b\u3089\u30d7\u30e9\u30f3\u3092\u9078\u629e\u3057\u3066\u8ffd\u52a0\u3059\u308b\u300225MB\u307e\u3067\u306a\u3089\u7121\u6599\u306eHobby\u30d7\u30e9\u30f3\u304c\u4f7f\u3048\u308b\u3002Hobby\u30d7\u30e9\u30f3\u3067\u306f\u6c38\u7d9a\u5316\u306f\u3067\u304d\u306a\u3044\u304c\u3001Resque\u3067\u4f7f\u3046\u5206\u306b\u306f\u5927\u304d\u306a\u554f\u984c\u306f\u306a\u3044\u3002(Redis\u304c\u518d\u8d77\u52d5\u3057\u305f\u6642\u306b\u305d\u306e\u6642\u306e\u30ad\u30e5\u30fc\u306e\u5185\u5bb9\u304c\u6d88\u3048\u3066\u3057\u307e\u3046\u3068\u3044\u3046\u554f\u984c\u306f\u3042\u308b\u304b\u3082\u3057\u308c\u306a\u3044)\n\n## Worker\u7528\u30d7\u30ed\u30bb\u30b9\u306e\u8a2d\u5b9a\n```rb:Procfile\nworker: TERM_CHILD=1 QUEUES=* rake environment resque:work\n```\n\nResque\u7528\u306eRake\u30bf\u30b9\u30af\u3092Worker\u3068\u3057\u3066\u8d77\u52d5\u3055\u305b\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3002\n\n## Worker\u306e\u6709\u52b9\u5316\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-10-20 13.43.53.png](https://qiita-image-store.s3.amazonaws.com/0/14097/af8adb7d-ba54-d4e9-78a6-579b1b93381d.png)\n\n\u6700\u5f8c\u306b\u3001\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u4e0a\u304b\u3089Worker\u3092\u6709\u52b9\u5316\u3057\u3066\u5b8c\u6210\u3002\n\n# \u7d50\u8ad6\nHeroku\u306e\u30d7\u30e9\u30f3\u6539\u5b9a\u3001Heroku Redis\u306e\u767b\u5834\u3001Active Job\u306e\u767b\u5834\u306b\u3088\u3063\u3066\u3001Heroku\u4e0a\u3067\u306e\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u51e6\u7406\u306e\u5b9f\u88c5\u304c\u3068\u3066\u3082\u8eab\u8fd1\u306b\u306a\u3063\u305f\u3002\u3069\u3093\u3069\u3093\u6d3b\u7528\u3057\u3088\u3046\u3002\n\n# \u53c2\u8003\u30ea\u30f3\u30af\n* http://blog.flect.co.jp/labo/2015/05/free-dyno-fae3.html\n* https://devcenter.heroku.com/articles/delayed-job\n* https://blog.engineyard.com/2014/getting-started-with-active-job\n* http://qiita.com/Takayuki-Suzuki@github/items/cf2f904873496ff6c384\n\n", "tags": ["Heroku", "ActiveJob", "Rails", "Redis", "Resque"]}