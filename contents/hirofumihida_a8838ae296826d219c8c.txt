{"context": "\n\nMunin \u3092 Docker \u30b3\u30f3\u30c6\u30ca\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u76ee\u7684\n\nmunin \u306e\u8a55\u4fa1(\u500b\u4eba\u7684)\n\n\nMRTG, Zabbix \u3064\u304b\u3063\u305f\u3053\u3068\u3042\u308b\nsensu \u3082\u8208\u5473\u3042\u308b\u304c\u305d\u308c\u307b\u3069\u5927\u898f\u6a21\u306a\u3082\u306e\u306f\u4eca\u306f\u60f3\u5b9a\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u5f8c\u65e5\n\n\n\n\n\u5bfe\u8c61\n\n\u76e3\u8996\u30c4\u30fc\u30eb\u306b\u8208\u5473\u304c\u3042\u308b\n\u76e3\u8996\u30c4\u30fc\u30eb\u304c\u597d\u304d\n\u30b0\u30e9\u30d5\u898b\u308b\u306e\u304c\u597d\u304d\n\n\n\u30b7\u30b9\u30c6\u30e0\n\n\n\u30db\u30b9\u30c8\n\nUbuntu 14.04\ndocker 1.12\n\n\nisolated-network\nubuntu:latest\nmunin: 2.0.25\napache: 2.4.18\n\n\n\n\n\ncentos7 \u30b3\u30f3\u30c6\u30ca\u306b\u3057\u3088\u3046\u3068\u601d\u3063\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u30b3\u30f3\u30c6\u30ca\u5185\u3067\u306e systemd \u52d5\u4f5c\u304c\u5384\u4ecb\u305d\u3046\u306a\u306e\u3067\u3044\u3063\u305f\u3093\u30b9\u30eb\u30fc\u3067\u3002\u3002\n\nhttps://github.com/docker/docker/issues/6980\nhttps://github.com/docker/docker/issues/7459\n\n\n\n\n\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\n\nhttps://help.ubuntu.com/lts/serverguide/munin.html\nhttps://help.ubuntu.com/lts/serverguide/httpd.html\nhttps://www.server-world.info/en/note?os=Ubuntu_16.04&p=munin\nhttps://www.server-world.info/en/note?os=Ubuntu_16.04&p=httpd&f=1\n\n\n\u69cb\u7bc9\n\n1. \u30b3\u30f3\u30c6\u30ca\u5efa\u9020\nroot# docker pull ubuntu:latest\n\nroot# docker run \\\n-itd --name munin-server01 \\\n-p 0.0.0.0:8080:80 \\\n-p 0.0.0.0:4948:4948 \\\n--network=isolated_nw \\\n-t ubuntu:latest /bin/bash\n\n\nroot# docker attach munin-server01\n\n[root@5e4d20afb75f /]# dpkg-reconfigure tzdata\n[root@5e4d20afb75f /]# apt-get -y update ; apt-get -y upgrade\n\n[root@5e4d20afb75f /]# cat /etc/lsb-release\nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=16.04\nDISTRIB_CODENAME=xenial\nDISTRIB_DESCRIPTION=\"Ubuntu 16.04.1 LTS\"\n\n\n2. munin \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb(\u76e3\u8996\u30b5\u30fc\u30d0 on \u30b3\u30f3\u30c6\u30ca)\n[root@5e4d20afb75f /]# apt-get -y install apache2\n[root@5e4d20afb75f /]# apt-get -y install munin vim\n\n[root@5e4d20afb75f /]# vi /etc/munin/munin.conf\n\nadd lines\n\n### docker host\n[fs1]\n    address 192.168.100.5\n    use_node_name yes\n\n[root@5e4d20afb75f /]# vi /etc/apache2/conf-enabled/security.conf\n\nServerTokens Prod\n\n[root@5e4d20afb75f /]# vi /etc/apache2/apache2.conf\n\nServerName www.munin-server.com\n\n[root@5e4d20afb75f /]# vi /etc/apache2/conf-enabled/munin.conf\n\n### add LAN Segments\nRequire ip 192.168.100.0/24\n\n[root@5e4d20afb75f /]# service cron start\n[root@5e4d20afb75f /]# /etc/init.d/munin start \n[root@5e4d20afb75f /]# service apache2 start\n\n\n3. munin-node \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb(Docker Host on ubuntu)\n# apt-get install munin-node\n\n\nmunin \u30b5\u30fc\u30d0\u306eIP\u78ba\u8a8d\n\n# docker network inspect isolated_nw | jq .[].Containers\n(snip)\n    \"IPv4Address\": \"172.19.0.3/16\",\n\n# vi /etc/munin/munin-node.conf\n\n(edit)\n\nhost_name fs1\nallow ^172\\.19\\.0\\.3$\n\n# service munin-node restart\n\n\n4. Web \u30d6\u30e9\u30a6\u30b6\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\n\n5\u5206\u4ee5\u4e0a\u5f85\u3061\u307e\u3057\u3087\u3046(/etc/cron.d/munin)\n\nLAN \u5074\u306e 8080 \u306b\u30de\u30c3\u30d7\u3057\u305f\u306e\u3067 Docker \u30db\u30b9\u30c8IP \u306e 8080 \u306b\u30d6\u30e9\u30a6\u30b6\u3067\u30a2\u30af\u30bb\u30b9\n\n\u4f8b: http://192.168.100.5:8080/munin\n\n\n\n\u4ee5\u4e0b\u306e\u8868\u793a\u304c\u51fa\u3066\u3044\u305f\u3089\u6210\u529f\n\n\n\n5. \u304a\u308f\u308a\n# Munin \u3092 Docker \u30b3\u30f3\u30c6\u30ca\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n## \u76ee\u7684\n\n- munin \u306e\u8a55\u4fa1(\u500b\u4eba\u7684)\n  - MRTG, Zabbix \u3064\u304b\u3063\u305f\u3053\u3068\u3042\u308b\n  - sensu \u3082\u8208\u5473\u3042\u308b\u304c\u305d\u308c\u307b\u3069\u5927\u898f\u6a21\u306a\u3082\u306e\u306f\u4eca\u306f\u60f3\u5b9a\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u5f8c\u65e5\n\n## \u5bfe\u8c61\n\n- \u76e3\u8996\u30c4\u30fc\u30eb\u306b\u8208\u5473\u304c\u3042\u308b\n- \u76e3\u8996\u30c4\u30fc\u30eb\u304c\u597d\u304d\n- \u30b0\u30e9\u30d5\u898b\u308b\u306e\u304c\u597d\u304d\n\n## \u30b7\u30b9\u30c6\u30e0\n\n- \u30db\u30b9\u30c8\n  - Ubuntu 14.04\n  - docker 1.12\n      - isolated-network\n      - ubuntu:latest\n      - munin: 2.0.25\n      - apache: 2.4.18\n\n- centos7 \u30b3\u30f3\u30c6\u30ca\u306b\u3057\u3088\u3046\u3068\u601d\u3063\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u30b3\u30f3\u30c6\u30ca\u5185\u3067\u306e systemd \u52d5\u4f5c\u304c\u5384\u4ecb\u305d\u3046\u306a\u306e\u3067\u3044\u3063\u305f\u3093\u30b9\u30eb\u30fc\u3067\u3002\u3002\n  - https://github.com/docker/docker/issues/6980\n  - https://github.com/docker/docker/issues/7459\n\n## \u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\n\n- https://help.ubuntu.com/lts/serverguide/munin.html\n- https://help.ubuntu.com/lts/serverguide/httpd.html\n- https://www.server-world.info/en/note?os=Ubuntu_16.04&p=munin\n- https://www.server-world.info/en/note?os=Ubuntu_16.04&p=httpd&f=1\n\n## \u69cb\u7bc9\n\n### 1. \u30b3\u30f3\u30c6\u30ca\u5efa\u9020\n\n```shell-session\nroot# docker pull ubuntu:latest\n\nroot# docker run \\\n-itd --name munin-server01 \\\n-p 0.0.0.0:8080:80 \\\n-p 0.0.0.0:4948:4948 \\\n--network=isolated_nw \\\n-t ubuntu:latest /bin/bash\n\n```\n```shell-session\nroot# docker attach munin-server01\n\n[root@5e4d20afb75f /]# dpkg-reconfigure tzdata\n[root@5e4d20afb75f /]# apt-get -y update ; apt-get -y upgrade\n\n[root@5e4d20afb75f /]# cat /etc/lsb-release\nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=16.04\nDISTRIB_CODENAME=xenial\nDISTRIB_DESCRIPTION=\"Ubuntu 16.04.1 LTS\"\n```\n\n### 2. munin \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb(\u76e3\u8996\u30b5\u30fc\u30d0 on \u30b3\u30f3\u30c6\u30ca)\n\n```shell-session\n[root@5e4d20afb75f /]# apt-get -y install apache2\n[root@5e4d20afb75f /]# apt-get -y install munin vim\n\n[root@5e4d20afb75f /]# vi /etc/munin/munin.conf\n\nadd lines\n\n### docker host\n[fs1]\n    address 192.168.100.5\n    use_node_name yes\n\n[root@5e4d20afb75f /]# vi /etc/apache2/conf-enabled/security.conf\n\nServerTokens Prod\n\n[root@5e4d20afb75f /]# vi /etc/apache2/apache2.conf\n\nServerName www.munin-server.com\n\n[root@5e4d20afb75f /]# vi /etc/apache2/conf-enabled/munin.conf\n\n### add LAN Segments\nRequire ip 192.168.100.0/24\n\n[root@5e4d20afb75f /]# service cron start\n[root@5e4d20afb75f /]# /etc/init.d/munin start \n[root@5e4d20afb75f /]# service apache2 start\n```\n\n### 3. munin-node \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb(Docker Host on ubuntu)\n\n```shell-session\n# apt-get install munin-node\n```\n\n- munin \u30b5\u30fc\u30d0\u306eIP\u78ba\u8a8d\n\n```shell-session\n# docker network inspect isolated_nw | jq .[].Containers\n(snip)\n    \"IPv4Address\": \"172.19.0.3/16\",\n```\n\n```shell-session\n# vi /etc/munin/munin-node.conf\n\n(edit)\n\nhost_name fs1\nallow ^172\\.19\\.0\\.3$\n```\n\n```shell-session\n# service munin-node restart\n```\n\n### 4. Web \u30d6\u30e9\u30a6\u30b6\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\n\n- 5\u5206\u4ee5\u4e0a\u5f85\u3061\u307e\u3057\u3087\u3046(/etc/cron.d/munin)\n\n- LAN \u5074\u306e 8080 \u306b\u30de\u30c3\u30d7\u3057\u305f\u306e\u3067 Docker \u30db\u30b9\u30c8IP \u306e 8080 \u306b\u30d6\u30e9\u30a6\u30b6\u3067\u30a2\u30af\u30bb\u30b9\n  - \u4f8b: http://192.168.100.5:8080/munin\n\n- \u4ee5\u4e0b\u306e\u8868\u793a\u304c\u51fa\u3066\u3044\u305f\u3089\u6210\u529f\n\n![Screenshot 2016-11-11 03.11.21.png](https://qiita-image-store.s3.amazonaws.com/0/67892/27caa977-e85d-f787-defa-38440b0e136b.png)\n\n### 5. \u304a\u308f\u308a\n", "tags": ["Munin", "docker1.12", "Ubuntu14.04", "ubuntu16.04", "Apache2.4.18"]}