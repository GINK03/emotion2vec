{"context": " More than 1 year has passed since last update.ELB\u306e\u30ed\u30b0\u3092s3\u306b\u7f6e\u3044\u3066\u3044\u305f\u306e\u3067\u3001\u6700\u8fd1\u3088\u304f\u898b\u304b\u3051\u308b\u65b9\u6cd5\u3067\u3001\u89e3\u6790\u3057\u3066\u307f\u308b\u3053\u3068\u306b\u306b\u3057\u305f\u3002\nElasticsearch\u304c\u3069\u3093\u306a\u611f\u3058\u3067\u52d5\u304f\u304b\u307e\u3060\u628a\u63e1\u3067\u304d\u3066\u3044\u306a\u3044\u306e\u3067\u3059\u304c\u3001\u4ee5\u4e0b\u306e\u624b\u9806\u3067\u30b5\u30fc\u30d0\u30fc\u3092\u69cb\u7bc9\u3057\u52d5\u304b\u3057\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u305f\u3002\n\u4e45\u3005\u306b\u30b5\u30fc\u30d0\u30fc\u3092\u8a2d\u5b9a\u3059\u308b\u306e\u3067\u3001\u57fa\u672c\u7684\u306a\u8a2d\u5b9a\u3082\u30e1\u30e2\u3059\u308b\u3053\u3068\u3057\u305f\u3002\n\n\u69cb\u6210\u6982\u8981\nELB -> s3(log storage) <-> Fluentd -> Elasticsearch -> Kibana <- Proxy -> End Users \n\n\u4f5c\u696d\u624b\u9806\n\nAWS\n\n\n\n\u9805\u76ee\n\u5185\u5bb9\n\n\n\n\nOS\nUbuntu 14.04.1 LTS (GNU/Linux 3.13.0-36-generic x86_64)(PV)\n\n\nInstance\nm3.medium\n\n\nStorage\n\u5bb9\u91cf\u306b\u5fdc\u3058\u3066\n\n\n\n\n\u30b5\u30fc\u30d0\u30fc\u306e\u6e96\u5099\n\n\u6642\u9593\u8a2d\u5b9a\n$ sudo apt-get update\n$ sudo apt-get install ntp\n$ sudo vi /etc/ntp.conf\n#\u3000server ntp.ubuntu.com\nserver ntp.nict.jp\n$ sudo /etc/init.d/ntp restart\n# UTC -> JST\n$ sudo cp /etc/localtime /etc/localtime.bak\n$ sudo cp /usr/share/zoneinfo/Japan /etc/localtime\n\n\n\u8a00\u8a9e\u8a2d\u5b9a\n$ apt-get install language-pack-ja\n$ echo 'export LANG=ja_JP.UTF-8'|tee -a ~/.bashrc\n$ source ~/.bashrc\n$ locale\nLANG=ja_JP.UTF-8\nLANGUAGE=\nLC_CTYPE=\"ja_JP.utf8\"\nLC_NUMERIC=\"ja_JP.utf8\"\nLC_TIME=\"ja_JP.utf8\"\nLC_COLLATE=\"ja_JP.utf8\"\nLC_MONETARY=\"ja_JP.utf8\"\nLC_MESSAGES=\"ja_JP.utf8\"\nLC_PAPER=\"ja_JP.utf8\"\nLC_NAME=\"ja_JP.utf8\"\nLC_ADDRESS=\"ja_JP.utf8\"\nLC_TELEPHONE=\"ja_JP.utf8\"\nLC_MEASUREMENT=\"ja_JP.utf8\"\nLC_IDENTIFICATION=\"ja_JP.utf8\"\nLC_ALL=ja_JP.utf8\n\n\n\u30db\u30b9\u30c8\u540d\u8a2d\u5b9a\n$ echo \"127.0.0.1 $HOSTNAME\" | sudo tee -a /etc/hosts\n\n\n\u30d5\u30a1\u30a4\u30eb\u30c7\u30a3\u30b9\u30af\u30ea\u30d7\u30bf\u8a2d\u5b9a\nFluentd\u3067\u63a8\u5968\u3055\u308c\u3066\u3044\u308b\u8a2d\u5b9a\u3092\u4f7f\u3063\u3066\u307f\u308b\n$ ulimit -n\n1024\n$ sudo vi /etc/security/limits.conf\n#\u3000\u4ee5\u4e0b\u3092\u8ffd\u52a0 \nroot soft nofile 65536\nroot hard nofile 65536\n* soft nofile 65536\n* hard nofile 65536\n\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u95a2\u9023\u30d1\u30e9\u30e1\u30fc\u30bf\u8a2d\u5b9a\nFluentd\u3067\u63a8\u5968\u3055\u308c\u3066\u3044\u308b\u8a2d\u5b9a\u3092\u4f7f\u3063\u3066\u307f\u308b\n$ sudo vi /etc/sysctl.conf\n#\u3000\u4ee5\u4e0b\u3092\u8ffd\u52a0\nnet.ipv4.tcp_tw_recycle = 1\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.ip_local_port_range = 10240    65535\n\n\n\u518d\u8d77\u52d5\n$ sudo reboot\n\n\n\u5404\u7a2e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u4e8b\u524d\u6e96\u5099\n\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo apt-get install git-core build-essential ruby1.9.3 openjdk-7-jdk\n\n\nElasticsearch\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ wget https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-1.3.4.deb\n$ sudo dpkg -i elasticsearch-1.3.4.deb\n$ sudo service elasticsearch start\n$ curl localhost:9200\n{\n  \"status\" : 200,\n  \"name\" : \"Jennifer Kale\",\n  \"version\" : {\n    \"number\" : \"1.3.4\",\n    \"build_hash\" : \"a70f3ccb52200f8f2c87e9c370c6597448eb3e45\",\n    \"build_timestamp\" : \"2014-09-30T09:07:17Z\",\n    \"build_snapshot\" : false,\n    \"lucene_version\" : \"4.9\"\n  },\n  \"tagline\" : \"You Know, for Search\"\n}\n\n\nFluentd\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb (\u53c2\u7167)\n\n# ubuntu trusty\u7528\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ curl -L http://toolbelt.treasuredata.com/sh/install-ubuntu-trusty-td-agent2.sh | sh\n$ sudo apt-get install libcurl4-openssl-dev -y\n#\u3000Elasticsearch\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\n$ sudo /opt/td-agent/embedded/bin/fluent-gem install fluent-plugin-elasticsearch\n#\u3000ELB\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\n$ sudo /opt/td-agent/embedded/bin/fluent-gem install fluent-plugin-elb-log\n\n\nKibana\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# nginx\u3067\u52d5\u304b\u3059\n$ sudo apt-get install nginx\n$ sudo vi /etc/nginx/sites-enabled/default\nlocation / { # location kibana \u3092\u5c55\u958b\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\n    root /home/ubuntu/kibana;\n    index index.html index.htm;\n}\n$ cd $HOME\n$ wget https://download.elasticsearch.org/kibana/kibana/kibana-3.1.1.tar.gz\n$ tar zxvf kibana-3.1.1.tar.gz\n$ ln -s kibana-3.1.1 kibana\n# nginx\u306e\u8d77\u52d5\u3068\u78ba\u8a8d\n$ sudo service nginx start\n$ sudo service nginx status\n * nginx is running\n\n\n\u5404\u7a2e\u8a2d\u5b9a\n\ntd-agent\u306e\u8a2d\u5b9a\n\n\n/etc/td-agent/td-agent.conf\u3092\u7de8\u96c6\u3059\u308b\ns3\u306b\u3042\u308bELB\u306e\u30ed\u30b0\u3092\u53d6\u5f97\u3057\u3001Elasticsearch\u306b\u6d41\u3059\u8a2d\u5b9a (\u53c2\u7167)\n\n\n<source>\n  type elb_log\n  access_key_id     *****************\n  secret_access_key *************************\n  s3_endpoint       s3-ap-northeast-1.amazonaws.com\n  s3_bucketname     \u30d0\u30b1\u30c3\u30c8\u540d\n  s3_prefix         \u30d0\u30b1\u30c3\u30c8\u306e\u6b21\u306b\u7d9a\u304f\u540d\u524d\n  timestamp_file    /tmp/elb_last_at.dat\n  # 5\u5206\u5358\u4f4d\u306b\u3059\u308b\u3053\u3068\u306b\n  refresh_interval  300\n</source>\n<match **>\n  type elasticsearch\n  type_name access_log\n  host localhost\n  port 9200\n  logstash_format true\n  include_tag_key true\n  tag_key @log_name\n</match>\n\n\ntd-agent\u306e\u8d77\u52d5\n\u30d0\u30c3\u30d5\u30a1\u30d5\u30a1\u30a4\u30eb\u306e\u66f8\u304d\u8fbc\u307f\u306e\u6a29\u9650\u304croot\u3067\u306a\u3044\u3068\u6709\u52b9\u3067\u306a\u3044\u306e\u3067\u3001sudo vi /etc/init.d/td-agent\u3067\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u3066\u3001USER\u3068GROUP\u3092root\u306b\u3057\u3066\u304a\u304f\u3068\u52d5\u304f\u3002\u53d6\u308a\u6025\u304e\u3001\u4ed6\u826f\u3044\u3084\u308a\u65b9\u601d\u3044\u3064\u304b\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u3053\u306e\u5bfe\u5fdc\u306b\u3057\u305f\u3002\n$ sudo /etc/init.d/td-agent start\n$ sudo /etc/init.d/td-agent status\n\n\u81ea\u52d5\u8d77\u52d5\u306e\u8a2d\u5b9a\n$ sudo apt-get install sysv-rc-conf\n$ sudo sysv-rc-conf td-agent on\n$ sudo sysv-rc-conf --list | grep td-agent\ntd-agent     2:on   3:on    4:on    5:on\n\n\nKibana\u3078\u306e\u63a5\u7d9a\nvpc\u5185\u306bKibana\u3092\u69cb\u7bc9\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u30d7\u30ed\u30ad\u30b7\u30b5\u30fc\u30d0\u30fc\u7d4c\u7531\u3067Kibana\u306b\u63a5\u7d9a\u3059\u308bnginx\u306e\u8a2d\u5b9a\u30b5\u30f3\u30d7\u30eb\u3002\nserver {\n    listen 80;\n    server_name \u307b\u3052\u307b\u3052.com;\n\n    auth_basic            \"Basic Auth\";\n    auth_basic_user_file  \"/home/www/.htpasswd\";\n\n    proxy_set_header Host $host;\n    proxy_set_header X-Forwarded-Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Scheme $scheme;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\n    location / {\n        proxy_pass http://**.**.**.**;\n    }\n}\nserver {\n    listen 9200;\n    server_name \u307b\u3052\u307b\u3052.com;\n\n    auth_basic            \"Basic Auth\";\n    auth_basic_user_file  \"/home/www/.htpasswd\";\n\n    proxy_set_header Host $host;\n    proxy_set_header X-Forwarded-Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Scheme $scheme;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\n    location / {\n        proxy_pass http://**.**.**.**:9200;\n    }\n}\n\n\nELB\u306e\u30ed\u30b0\u3092s3\u306b\u7f6e\u3044\u3066\u3044\u305f\u306e\u3067\u3001\u6700\u8fd1\u3088\u304f\u898b\u304b\u3051\u308b\u65b9\u6cd5\u3067\u3001\u89e3\u6790\u3057\u3066\u307f\u308b\u3053\u3068\u306b\u306b\u3057\u305f\u3002\nElasticsearch\u304c\u3069\u3093\u306a\u611f\u3058\u3067\u52d5\u304f\u304b\u307e\u3060\u628a\u63e1\u3067\u304d\u3066\u3044\u306a\u3044\u306e\u3067\u3059\u304c\u3001\u4ee5\u4e0b\u306e\u624b\u9806\u3067\u30b5\u30fc\u30d0\u30fc\u3092\u69cb\u7bc9\u3057\u52d5\u304b\u3057\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u305f\u3002\n\u4e45\u3005\u306b\u30b5\u30fc\u30d0\u30fc\u3092\u8a2d\u5b9a\u3059\u308b\u306e\u3067\u3001\u57fa\u672c\u7684\u306a\u8a2d\u5b9a\u3082\u30e1\u30e2\u3059\u308b\u3053\u3068\u3057\u305f\u3002\n\n## \u69cb\u6210\u6982\u8981\n\n```ELB -> s3(log storage) <-> Fluentd -> Elasticsearch -> Kibana <- Proxy -> End Users``` \n\n## \u4f5c\u696d\u624b\u9806\n\n### AWS\n\n| \u9805\u76ee | \u5185\u5bb9 |\n|:-----------|:------------|\n|OS|Ubuntu 14.04.1 LTS (GNU/Linux 3.13.0-36-generic x86_64)(PV)|\n|Instance|m3.medium|\n|Storage|\u5bb9\u91cf\u306b\u5fdc\u3058\u3066|\n\n### \u30b5\u30fc\u30d0\u30fc\u306e\u6e96\u5099\n\n#### \u6642\u9593\u8a2d\u5b9a\n\n```bash\n$ sudo apt-get update\n$ sudo apt-get install ntp\n$ sudo vi /etc/ntp.conf\n#\u3000server ntp.ubuntu.com\nserver ntp.nict.jp\n$ sudo /etc/init.d/ntp restart\n# UTC -> JST\n$ sudo cp /etc/localtime /etc/localtime.bak\n$ sudo cp /usr/share/zoneinfo/Japan /etc/localtime\n```\n\n#### \u8a00\u8a9e\u8a2d\u5b9a\n\n```bash\n$ apt-get install language-pack-ja\n$ echo 'export LANG=ja_JP.UTF-8'|tee -a ~/.bashrc\n$ source ~/.bashrc\n$ locale\nLANG=ja_JP.UTF-8\nLANGUAGE=\nLC_CTYPE=\"ja_JP.utf8\"\nLC_NUMERIC=\"ja_JP.utf8\"\nLC_TIME=\"ja_JP.utf8\"\nLC_COLLATE=\"ja_JP.utf8\"\nLC_MONETARY=\"ja_JP.utf8\"\nLC_MESSAGES=\"ja_JP.utf8\"\nLC_PAPER=\"ja_JP.utf8\"\nLC_NAME=\"ja_JP.utf8\"\nLC_ADDRESS=\"ja_JP.utf8\"\nLC_TELEPHONE=\"ja_JP.utf8\"\nLC_MEASUREMENT=\"ja_JP.utf8\"\nLC_IDENTIFICATION=\"ja_JP.utf8\"\nLC_ALL=ja_JP.utf8\n```\n\n#### \u30db\u30b9\u30c8\u540d\u8a2d\u5b9a\n\n```bash\n$ echo \"127.0.0.1 $HOSTNAME\" | sudo tee -a /etc/hosts\n```\n\n#### \u30d5\u30a1\u30a4\u30eb\u30c7\u30a3\u30b9\u30af\u30ea\u30d7\u30bf\u8a2d\u5b9a\n\n*Fluentd\u3067\u63a8\u5968\u3055\u308c\u3066\u3044\u308b\u8a2d\u5b9a\u3092\u4f7f\u3063\u3066\u307f\u308b*\n\n```bash\n$ ulimit -n\n1024\n$ sudo vi /etc/security/limits.conf\n#\u3000\u4ee5\u4e0b\u3092\u8ffd\u52a0 \nroot soft nofile 65536\nroot hard nofile 65536\n* soft nofile 65536\n* hard nofile 65536\n```\n\n#### \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u95a2\u9023\u30d1\u30e9\u30e1\u30fc\u30bf\u8a2d\u5b9a\n\n*Fluentd\u3067\u63a8\u5968\u3055\u308c\u3066\u3044\u308b\u8a2d\u5b9a\u3092\u4f7f\u3063\u3066\u307f\u308b*\n\n```bash\n$ sudo vi /etc/sysctl.conf\n#\u3000\u4ee5\u4e0b\u3092\u8ffd\u52a0\nnet.ipv4.tcp_tw_recycle = 1\nnet.ipv4.tcp_tw_reuse = 1\nnet.ipv4.ip_local_port_range = 10240    65535\n```\n\n#### \u518d\u8d77\u52d5\n\n```bash\n$ sudo reboot\n```\n\n\n### \u5404\u7a2e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n#### \u4e8b\u524d\u6e96\u5099\n*\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb*\n\n```bash\n$ sudo apt-get install git-core build-essential ruby1.9.3 openjdk-7-jdk\n```\n\n#### Elasticsearch\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```base\n$ wget https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-1.3.4.deb\n$ sudo dpkg -i elasticsearch-1.3.4.deb\n$ sudo service elasticsearch start\n\u001b$ curl localhost:9200\n{\n  \"status\" : 200,\n  \"name\" : \"Jennifer Kale\",\n  \"version\" : {\n    \"number\" : \"1.3.4\",\n    \"build_hash\" : \"a70f3ccb52200f8f2c87e9c370c6597448eb3e45\",\n    \"build_timestamp\" : \"2014-09-30T09:07:17Z\",\n    \"build_snapshot\" : false,\n    \"lucene_version\" : \"4.9\"\n  },\n  \"tagline\" : \"You Know, for Search\"\n}\n```\n\n#### Fluentd\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb [(\u53c2\u7167)](http://docs.fluentd.org/ja/articles/install-by-deb)\n```bash\n# ubuntu trusty\u7528\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ curl -L http://toolbelt.treasuredata.com/sh/install-ubuntu-trusty-td-agent2.sh | sh\n$ sudo apt-get install libcurl4-openssl-dev -y\n#\u3000Elasticsearch\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\n$ sudo /opt/td-agent/embedded/bin/fluent-gem install fluent-plugin-elasticsearch\n#\u3000ELB\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\n$ sudo /opt/td-agent/embedded/bin/fluent-gem install fluent-plugin-elb-log\n```\n\n#### Kibana\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```bash\n# nginx\u3067\u52d5\u304b\u3059\n$ sudo apt-get install nginx\n$ sudo vi /etc/nginx/sites-enabled/default\nlocation / { # location kibana \u3092\u5c55\u958b\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\n\troot /home/ubuntu/kibana;\n\tindex index.html index.htm;\n}\n$ cd $HOME\n$ wget https://download.elasticsearch.org/kibana/kibana/kibana-3.1.1.tar.gz\n$ tar zxvf kibana-3.1.1.tar.gz\n$ ln -s kibana-3.1.1 kibana\n# nginx\u306e\u8d77\u52d5\u3068\u78ba\u8a8d\n$ sudo service nginx start\n$ sudo service nginx status\n * nginx is running\n```\n\n\n### \u5404\u7a2e\u8a2d\u5b9a\n\n#### td-agent\u306e\u8a2d\u5b9a\n* ```/etc/td-agent/td-agent.conf```\u3092\u7de8\u96c6\u3059\u308b\n* s3\u306b\u3042\u308bELB\u306e\u30ed\u30b0\u3092\u53d6\u5f97\u3057\u3001Elasticsearch\u306b\u6d41\u3059\u8a2d\u5b9a [(\u53c2\u7167)](http://dev.classmethod.jp/cloud/aws/fluent-plugin-elb-log-to-kibana/)\n\n```\n<source>\n  type elb_log\n  access_key_id     *****************\n  secret_access_key *************************\n  s3_endpoint       s3-ap-northeast-1.amazonaws.com\n  s3_bucketname     \u30d0\u30b1\u30c3\u30c8\u540d\n  s3_prefix         \u30d0\u30b1\u30c3\u30c8\u306e\u6b21\u306b\u7d9a\u304f\u540d\u524d\n  timestamp_file    /tmp/elb_last_at.dat\n  # 5\u5206\u5358\u4f4d\u306b\u3059\u308b\u3053\u3068\u306b\n  refresh_interval  300\n</source>\n<match **>\n  type elasticsearch\n  type_name access_log\n  host localhost\n  port 9200\n  logstash_format true\n  include_tag_key true\n  tag_key @log_name\n</match>\n```\n\n#### td-agent\u306e\u8d77\u52d5\n*\u30d0\u30c3\u30d5\u30a1\u30d5\u30a1\u30a4\u30eb\u306e\u66f8\u304d\u8fbc\u307f\u306e\u6a29\u9650\u304croot\u3067\u306a\u3044\u3068\u6709\u52b9\u3067\u306a\u3044\u306e\u3067\u3001```sudo vi /etc/init.d/td-agent```\u3067\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u3066\u3001USER\u3068GROUP\u3092root\u306b\u3057\u3066\u304a\u304f\u3068\u52d5\u304f\u3002\u53d6\u308a\u6025\u304e\u3001\u4ed6\u826f\u3044\u3084\u308a\u65b9\u601d\u3044\u3064\u304b\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u3053\u306e\u5bfe\u5fdc\u306b\u3057\u305f\u3002*\n\n```bash\n$ sudo /etc/init.d/td-agent start\n$ sudo /etc/init.d/td-agent status\n```\n\n**\u81ea\u52d5\u8d77\u52d5\u306e\u8a2d\u5b9a**\n\n```bash\n$ sudo apt-get install sysv-rc-conf\n$ sudo sysv-rc-conf td-agent on\n$ sudo sysv-rc-conf --list | grep td-agent\ntd-agent     2:on\t3:on\t4:on\t5:on\n```\n\n### Kibana\u3078\u306e\u63a5\u7d9a\n*vpc\u5185\u306bKibana\u3092\u69cb\u7bc9\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u30d7\u30ed\u30ad\u30b7\u30b5\u30fc\u30d0\u30fc\u7d4c\u7531\u3067Kibana\u306b\u63a5\u7d9a\u3059\u308bnginx\u306e\u8a2d\u5b9a\u30b5\u30f3\u30d7\u30eb\u3002*\n\n```nginx\u306e\u30b5\u30f3\u30d7\u30eb\u8a2d\u5b9a\nserver {\n    listen 80;\n    server_name \u307b\u3052\u307b\u3052.com;\n\n    auth_basic            \"Basic Auth\";\n    auth_basic_user_file  \"/home/www/.htpasswd\";\n\n    proxy_set_header Host $host;\n    proxy_set_header X-Forwarded-Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Scheme $scheme;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\n    location / {\n        proxy_pass http://**.**.**.**;\n    }\n}\nserver {\n    listen 9200;\n    server_name \u307b\u3052\u307b\u3052.com;\n\n    auth_basic            \"Basic Auth\";\n    auth_basic_user_file  \"/home/www/.htpasswd\";\n\n    proxy_set_header Host $host;\n    proxy_set_header X-Forwarded-Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Scheme $scheme;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\n    location / {\n        proxy_pass http://**.**.**.**:9200;\n    }\n}\n```\n\n", "tags": ["Ubuntu", "fluentd", "elb", "kibana", "Elasticsearch"]}