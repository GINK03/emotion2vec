{"tags": ["Ruby", "Sinatra"], "context": " More than 1 year has passed since last update.Sinatra\u306eerb\u30e1\u30bd\u30c3\u30c9\u306f\u6a19\u6e96\u3067\u306fContent negotiation\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u305b\u3093\u3002\u305d\u3053\u3067\u3001\u30e6\u30fc\u30b6\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8(Web\u30d6\u30e9\u30a6\u30b6)\u304c\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u6307\u5b9a\u3057\u305fAccept-Language\u30d8\u30c3\u30c0\u306e\u5024\u3092\u3082\u3068\u306b\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u81ea\u52d5\u7684\u306b\u9078\u629e\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u30e1\u30bd\u30c3\u30c9(erb_l)\u3092\u65b0\u305f\u306b\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\u591a\u5206\u3001sinatra-r18n\u304bSinatra\u672c\u5bb6\u304c\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u307e\u3067\u306e\u9593\u306e\u66ab\u5b9a\u5bfe\u5fdc\u3002\n\n\u6e96\u5099\n\u4ee5\u4e0b\u306egem\u304c\u5fc5\u8981\u3067\u3059\u3002\u9069\u5f53\u306bgem install\u3057\u3066\u304a\u3044\u3066\u4e0b\u3055\u3044\u3002\n\ni18n\nrack-contrib\n\n\n\u30b3\u30fc\u30c9\n\n\u30a2\u30d7\u30ea\n\ntest_app.rb\n# coding: utf-8\nrequire 'rack/contrib'\nrequire 'sinatra/base'\n\nclass TestApp < Sinatra::Base\n  use Rack::Locale\n\n  helpers do\n    # erb with content negotiation support\n    def erb_l(template, options = {}, locals = {})\n      locale = request.env['rack.locale']\n      if locale.nil? or locale.to_s !~ /^\\w+$/\n        erb(template, options, locals)\n      end\n\n      tmpl = \"#{template.to_s}_#{locale}\".to_sym\n\n      begin\n        erb(tmpl, options, locals)\n      rescue Errno::ENOENT\n        erb(template, options, locals)\n      end\n    end\n  end\n\n  get '/' do\n    erb_l :index\n  end\nend\n\n\nerb_l\u30e1\u30bd\u30c3\u30c9\u306f\u3001Accept-Language\u30d8\u30c3\u30c0\u306e\u5024\u306b\u57fa\u3044\u3066\u3001\u8aad\u307f\u8fbc\u3080\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u6c7a\u5b9a\u3057\u307e\u3059\u3002\u4e0a\u8a18\u306e\u4f8b\u306e\u5834\u5408\u3001\u65e5\u672c\u8a9e\u3092\u512a\u5148\u3059\u308b\u8a2d\u5b9a\u306eWeb\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u5834\u5408\u306b\u306findex_ja.erb\u3092\u3001\u82f1\u8a9e\u3092\u512a\u5148\u3059\u308bWeb\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u5834\u5408\u306b\u306findex_en.erb\u3092\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3068\u3057\u3066\u4f7f\u7528\u3057\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u3001index.erb\u3092\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3068\u3057\u3066\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u4f8b\n\nviews/index.erb\n<%# coding: utf-8 %>\n<html>\n  <body>\n    <h1>Hello, world</h1>\n  </body>\n</html>\n\n\n\nviews/index_ja.erb\n<%# coding: utf-8 %>\n<html>\n  <body>\n    <h1>\u3053\u3093\u306b\u3061\u306f\u4e16\u754c</h1>\n  </body>\n</html>\n\n\n\nconfig.ru\n\nconfig.ru\nrequire 'rubygems'\nrequire File.join(File.dirname(__FILE__), 'test_app.rb')\n\nrun TestApp\n\n\n\n\u5b9f\u884c\u4f8b\n\u30c6\u30b9\u30c8\u306e\u305f\u3081\u3001\u4e0a\u8a18\u306e\u30a2\u30d7\u30ea\u3092\u8d77\u52d5\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n% rainbows -E production -p 8080 config.ru\n\nAccept-Language\u30d8\u30c3\u30c0\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001\u6a19\u6e96\u306eindex.erb\u304c\u4f7f\u308f\u308c\u307e\u3059\u3002\n% wget -nv -4 -O - http://localhost:8080/\n<html>\n  <body>\n    <h1>Hello, world</h1>\n  </body>\n</html>\n\nAccept-Language: en\u306e\u5834\u5408\u3002index_en.erb\u306e\u5229\u7528\u3092\u8a66\u307f\u307e\u3059\u304c\u3001\u3053\u308c\u306f\u5b58\u5728\u3057\u307e\u305b\u3093\u306e\u3067\u3001index.erb\u304c\u4f7f\u308f\u308c\u307e\u3059\u3002\n% wget -nv -4 -O - --header='Accept-Language: en' http://localhost:8080/\n<html>\n  <body>\n    <h1>Hello, world</h1>\n  </body>\n</html>\n\nAccept-Language: ja,en\u306e\u5834\u5408\u3002index_ja.erb\u304c\u4f7f\u308f\u308c\u307e\u3059\u3002\n% wget -nv -4 -O - --header='Accept-Language: ja,en' http://localhost:8080/\n<html>\n  <body>\n    <h1>\u3053\u3093\u306b\u3061\u306f\u4e16\u754c</h1>\n  </body>\n</html>\n\nAccept-Language: fr\u306e\u5834\u5408\u3002index_fr.erb\u306e\u5229\u7528\u3092\u8a66\u307f\u307e\u3059\u304c\u3001\u3053\u308c\u306f\u5b58\u5728\u3057\u307e\u305b\u3093\u306e\u3067\u3001index.erb\u304c\u4f7f\u308f\u308c\u307e\u3059\u3002\n% wget -nv -4 -O - --header='Accept-Language: fr' http://localhost:8080/\n<html>\n  <body>\n    <h1>Hello, world</h1>\n  </body>\n</html>\n\n\nSinatra\u306eerb\u30e1\u30bd\u30c3\u30c9\u306f\u6a19\u6e96\u3067\u306fContent negotiation\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u305b\u3093\u3002\u305d\u3053\u3067\u3001\u30e6\u30fc\u30b6\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8(Web\u30d6\u30e9\u30a6\u30b6)\u304c\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u6307\u5b9a\u3057\u305f`Accept-Language`\u30d8\u30c3\u30c0\u306e\u5024\u3092\u3082\u3068\u306b\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u81ea\u52d5\u7684\u306b\u9078\u629e\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u30e1\u30bd\u30c3\u30c9(`erb_l`)\u3092\u65b0\u305f\u306b\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n\u591a\u5206\u3001sinatra-r18n\u304bSinatra\u672c\u5bb6\u304c\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u307e\u3067\u306e\u9593\u306e\u66ab\u5b9a\u5bfe\u5fdc\u3002\n\n## \u6e96\u5099\n\u4ee5\u4e0b\u306egem\u304c\u5fc5\u8981\u3067\u3059\u3002\u9069\u5f53\u306b`gem install`\u3057\u3066\u304a\u3044\u3066\u4e0b\u3055\u3044\u3002\n\n * i18n\n * rack-contrib\n\n## \u30b3\u30fc\u30c9\n### \u30a2\u30d7\u30ea\n```ruby:test_app.rb\n# coding: utf-8\nrequire 'rack/contrib'\nrequire 'sinatra/base'\n\nclass TestApp < Sinatra::Base\n  use Rack::Locale\n\n  helpers do\n    # erb with content negotiation support\n    def erb_l(template, options = {}, locals = {})\n      locale = request.env['rack.locale']\n      if locale.nil? or locale.to_s !~ /^\\w+$/\n        erb(template, options, locals)\n      end\n\n      tmpl = \"#{template.to_s}_#{locale}\".to_sym\n\n      begin\n        erb(tmpl, options, locals)\n      rescue Errno::ENOENT\n        erb(template, options, locals)\n      end\n    end\n  end\n\n  get '/' do\n    erb_l :index\n  end\nend\n```\n\n`erb_l`\u30e1\u30bd\u30c3\u30c9\u306f\u3001`Accept-Language`\u30d8\u30c3\u30c0\u306e\u5024\u306b\u57fa\u3044\u3066\u3001\u8aad\u307f\u8fbc\u3080\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u6c7a\u5b9a\u3057\u307e\u3059\u3002\u4e0a\u8a18\u306e\u4f8b\u306e\u5834\u5408\u3001\u65e5\u672c\u8a9e\u3092\u512a\u5148\u3059\u308b\u8a2d\u5b9a\u306eWeb\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u5834\u5408\u306b\u306f`index_ja.erb`\u3092\u3001\u82f1\u8a9e\u3092\u512a\u5148\u3059\u308bWeb\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u5834\u5408\u306b\u306f`index_en.erb`\u3092\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3068\u3057\u3066\u4f7f\u7528\u3057\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u3001`index.erb`\u3092\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3068\u3057\u3066\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n### \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u4f8b\n```ruby:views/index.erb\n<%# coding: utf-8 %>\n<html>\n  <body>\n    <h1>Hello, world</h1>\n  </body>\n</html>\n```\n\n```ruby:views/index_ja.erb\n<%# coding: utf-8 %>\n<html>\n  <body>\n    <h1>\u3053\u3093\u306b\u3061\u306f\u4e16\u754c</h1>\n  </body>\n</html>\n```\n\n### config.ru\n```ruby:config.ru\nrequire 'rubygems'\nrequire File.join(File.dirname(__FILE__), 'test_app.rb')\n\nrun TestApp\n```\n\n## \u5b9f\u884c\u4f8b\n\u30c6\u30b9\u30c8\u306e\u305f\u3081\u3001\u4e0a\u8a18\u306e\u30a2\u30d7\u30ea\u3092\u8d77\u52d5\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n% rainbows -E production -p 8080 config.ru\n```\n\n`Accept-Language`\u30d8\u30c3\u30c0\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001\u6a19\u6e96\u306e`index.erb`\u304c\u4f7f\u308f\u308c\u307e\u3059\u3002\n\n```\n% wget -nv -4 -O - http://localhost:8080/\n<html>\n  <body>\n    <h1>Hello, world</h1>\n  </body>\n</html>\n```\n\n`Accept-Language: en`\u306e\u5834\u5408\u3002`index_en.erb`\u306e\u5229\u7528\u3092\u8a66\u307f\u307e\u3059\u304c\u3001\u3053\u308c\u306f\u5b58\u5728\u3057\u307e\u305b\u3093\u306e\u3067\u3001`index.erb`\u304c\u4f7f\u308f\u308c\u307e\u3059\u3002\n\n```\n% wget -nv -4 -O - --header='Accept-Language: en' http://localhost:8080/\n<html>\n  <body>\n    <h1>Hello, world</h1>\n  </body>\n</html>\n```\n\n`Accept-Language: ja,en`\u306e\u5834\u5408\u3002`index_ja.erb`\u304c\u4f7f\u308f\u308c\u307e\u3059\u3002\n\n```\n% wget -nv -4 -O - --header='Accept-Language: ja,en' http://localhost:8080/\n<html>\n  <body>\n    <h1>\u3053\u3093\u306b\u3061\u306f\u4e16\u754c</h1>\n  </body>\n</html>\n```\n\n`Accept-Language: fr`\u306e\u5834\u5408\u3002`index_fr.erb`\u306e\u5229\u7528\u3092\u8a66\u307f\u307e\u3059\u304c\u3001\u3053\u308c\u306f\u5b58\u5728\u3057\u307e\u305b\u3093\u306e\u3067\u3001`index.erb`\u304c\u4f7f\u308f\u308c\u307e\u3059\u3002\n\n```\n% wget -nv -4 -O - --header='Accept-Language: fr' http://localhost:8080/\n<html>\n  <body>\n    <h1>Hello, world</h1>\n  </body>\n</html>\n```"}