{"context": " More than 1 year has passed since last update.FuelPHP\u3067\u305d\u306eView\u3067\u3057\u304b\u4f7f\u308f\u306a\u3044JS\u30b3\u30fc\u30c9\u3092\u66f8\u304f\u3068\u304d\u306b\u3001\u3068\u308a\u3042\u3048\u305a\u5916\u90e8\u30d5\u30a1\u30a4\u30eb\u5316\u305b\u305a\u306bView\u306e\u4e2d\u306b\u66f8\u3044\u3066\u3057\u307e\u3044\u305f\u3044\u6642\u304c\u3042\u308b\u3002\nView\u306e\u4e2d\u306bscript\u30bf\u30b0\u3092\u8a18\u8ff0\u3059\u308b\u3060\u3051\u3067OK\u306a\u5834\u5408\u3082\u3042\u308b\u304c\u3001Template\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3092\u4f7f\u3063\u3066\u3044\u3066\u3001html\u306e\u5f8c\u308d\u306e\u65b9\u3067jQuery\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u308b\u5834\u5408\u306a\u3069\u306f\u3001\u5148\u306e\u65b9\u6cd5\u3060\u3068View\u306e\u4e2d\u3067jQuery\u304c\u4f7f\u3048\u306a\u304f\u3066\u56f0\u308b\u3002\n\ntemplate.php\n<html>\n<head>\n(\u4e2d\u7565)\n<?= $header ?>\n<?= $content ?>\n<?= $footer ?>\n<script type=\"text/javascript\" src=\"//code.jquery.com/jquery-1.11.0.min.js\"></script>\n</body>\n</html>\n\n\n\ncontent.php\n<div id=\"content\">\n  Something content...\n</div>\n\n<script type=\"text/javascript\">\n// \u3053\u3053\u3067\u306f\u307e\u3060jQuery\u304c\u8aad\u307f\u8fbc\u307e\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u4f7f\u3048\u306a\u3044\uff01\njQuery(function(){\n  alert(\"hello1\");\n});\n</script>\n\n\n\u3053\u3093\u306a\u6642\u306bZendFramework\u306e\u30d3\u30e5\u30fc\u30d8\u30eb\u30d1\u30fc\u306eheadScript()->captureStart() \u307f\u305f\u3044\u306b\u3001View\u306e\u4e2d\u3067JS\u30b3\u30fc\u30c9\u3092\u30d0\u30c3\u30d5\u30a1\u3057\u3066\u304a\u3044\u3066\u3001jQuery\u3092\u8aad\u307f\u8fbc\u3093\u3060\u5f8c\u3067\u51fa\u529b\u3067\u304d\u308b\u3068\u4fbf\u5229\u3060\u3063\u305f\u308a\u3059\u308b\u3002\n\u3068\u3044\u3046\u308f\u3051\u3067Asset\u30af\u30e9\u30b9\u3092\u62e1\u5f35\u3057\u3066JS\u30b3\u30fc\u30c9\u3092\u30ad\u30e3\u30d7\u30c1\u30e3\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u305f\u3002\n\nAsset\u62e1\u5f35\u30af\u30e9\u30b9\n\nmyasset.php\n<?php\nclass Myasset extends \\Fuel\\Core\\Asset\n{\n  public static function forge( $name='default', array $config=array() ) {\n    if ( isset(static::$_instances[$name]) ) {\n      if ( \\get_class(static::$_instances[$name]) != \"Myasset_Instance\" ) {\n        static::$_instances[$name] = new Myasset_Instance(static::$_instances[$name]);\n      }\n    } else {\n      static::$_instances[$name] = new Myasset_Instance(array_merge(static::$default_config, \\Fuel\\Core\\Config::get('asset'), $config));\n    }\n\n    if ( $name == 'default' ) {\n      static::$_instance = static::$_instances[$name];\n    }\n    return static::$_instances[$name];\n  }\n\n  public static function instance( $instance=null ) {\n    return static::forge();\n  }\n\n  /**\n   * \u30ad\u30e3\u30d7\u30c1\u30e3\u4e2d\u5224\u5b9a\u7528\n   */\n  static protected $capture_lock = false;\n\n  /**\n   * JS\u30ad\u30e3\u30d7\u30c1\u30e3\u958b\u59cb\n   */\n  public static function begin( $attr=array(), $group=null ) {\n    if ( static::$capture_lock ) {\n      throw new \\Exception(\"\u30ad\u30e3\u30d7\u30c1\u30e3\u306f\u30cd\u30b9\u30c8\u3067\u304d\u307e\u305b\u3093\u3002\");\n    }\n    if ( static::instance()->begin($attr, $group) ) {\n      static::$capture_lock = true;\n    }\n  }\n\n  /**\n   * JS\u30ad\u30e3\u30d7\u30c1\u30e3\u7d42\u4e86\n   */\n  public static function end() {\n    if ( !static::$capture_lock ) {\n      throw new \\Exception(\"\u30ad\u30e3\u30d7\u30c1\u30e3\u3092\u958b\u59cb\u3057\u3066\u3044\u307e\u305b\u3093\u3002\");\n    }\n    if ( static::instance()->end() ) {\n      static::$capture_lock = false;\n    }\n  }\n}\n\nclass Myasset_Instance extends \\Fuel\\Core\\Asset_Instance\n{\n  protected $_attr;\n  protected $_group;\n\n  public function groups( $group=null ) {\n    if ( $group !== null && isset($this->_groups[$group]) ) {\n      return $this->_groups[$group];\n    }\n    return $this->_groups;\n  }\n\n  public function __construct( $config ) {\n    if ( $config instanceof \\Fuel\\Core\\Asset_Instance ) {\n      // \u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u30b3\u30d4\u30fc\n      $this->_asset_paths = $config->_asset_paths;\n      $this->_path_folders = $config->_path_folders;\n      $this->_asset_url = $config->_asset_url;\n      $this->_add_mtime = $config->_add_mtime;\n      $this->_groups = $config->_groups;\n      $this->_ident = $config->_ident;\n      $this->_auto_render = $config->_auto_render;\n      $this->_fail_silently = $config->_fail_silently;\n      $this->_indent = $config->_indent;\n    } else {\n      parent::__construct($config);\n    }\n  }\n\n  public function begin( $attr=array(), $group=null ) {\n    $this->_attr = $attr;\n    $this->_group = $group;\n    return \\ob_start();\n  }\n\n  public function end() {\n    if ( false === ($code = \\ob_get_clean()) ) {\n      return false;\n    }\n    $this->_parse_assets('js_code', $code, $this->_attr, $this->_group);\n    return true;\n  }\n\n  public function render( $group=null, $raw=false ) {\n    ($group === null) and $group = '_default_';\n    if ( \\is_string($group) ) {\n      isset($this->_groups[$group]) and $group = $this->_groups[$group];\n    }\n    \\is_array($group) or $group = array();\n\n    $css = '';\n    $js = '';\n    $img = '';\n    foreach ( $group as $key=>$item ) {\n      $type = $item['type'];\n      $filename = $item['file'];\n      $attr = $item['attr'];\n\n      if ( $type != 'js_code' ) {\n        // only do a file search if the asset is not a URI\n        if ( !\\preg_match('|^(\\w+:)?//|', $filename) ) {\n          // and only if the asset is local to the applications base_url\n          if ( !\\preg_match('|^(\\w+:)?//|', $this->_asset_url) or \\strpos($this->_asset_url, \\Fuel\\Core\\Config::get('base_url')) === 0 ) {\n            if ( !($file = $this->find_file($filename, $type)) ) {\n              if ( $this->_fail_silently ) {\n                continue;\n              }\n              throw new \\FuelException('Could not find asset: '.$filename);\n            }\n            $raw or $file = $this->_asset_url.$file.($this->_add_mtime ? '?'.\\filemtime($file) : '');\n          } else {\n            $raw or $file = $this->_asset_url.$this->_path_folders[$type].$filename;\n          }\n        } else {\n          $file = $filename;\n        }\n      }\n\n      switch ( $type ) {\n        case 'css':\n          $attr['type'] = 'text/css';\n          if ( $raw ) {\n            $css .= \\html_tag('style', $attr, PHP_EOL.\\file_get_contents($file).PHP_EOL).PHP_EOL;\n          } else {\n            if ( !isset($attr['rel']) or empty($attr['rel']) ) {\n              $attr['rel'] = 'stylesheet';\n            }\n            $attr['href'] = $file;\n            $css .= $this->_indent.\\html_tag('link', $attr).PHP_EOL;\n          }\n          break;\n\n        case 'js':\n          $attr['type'] = 'text/javascript';\n          if ( $raw ) {\n            $js .= \\html_tag('script', $attr, PHP_EOL.\\file_get_contents($file).PHP_EOL).PHP_EOL;\n          } else {\n            $attr['src'] = $file;\n            $js .= $this->_indent.\\html_tag('script', $attr, '').PHP_EOL;\n          }\n          break;\n\n        case 'js_code':\n          $attr['type'] = 'text/javascript';\n          $js .= \\html_tag('script', $attr, PHP_EOL.$filename.PHP_EOL).PHP_EOL;\n          break;\n\n        case 'img':\n          $attr['src'] = $file;\n          $attr['alt'] = isset($attr['alt']) ? $attr['alt'] : '';\n          $img .= \\html_tag('img', $attr );\n          break;\n      }\n    }\n\n    // return them in the correct order\n    return $css.$js.$img;\n  }\n}\n\n\n\n\u4f7f\u3044\u65b9\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5074\n\ntemplate.php\n<html>\n<head>\n(\u4e2d\u7565)\n<?= $header ?>\n<?= $content ?>\n<?= $footer ?>\n<script type=\"text/javascript\" src=\"//code.jquery.com/jquery-1.11.0.min.js\"></script>\n<?= Myasset::render('add_js')  /** \u3053\u3053\u306b\u30ad\u30e3\u30d7\u30c1\u30e3\u3057\u305fJS\u30b3\u30fc\u30c9\u304c\u5c55\u958b\u3055\u308c\u308b */ ?>\n</body>\n</html>\n\n\n\n\u30d3\u30e5\u30fc\u5074\n\ncontent.php\n<div id=\"content\">\n  Something content...\n</div>\n\n<? Myasset::begin(array(), 'add_js')  /** 'add_js'\u3068\u3044\u3046\u30d0\u30c3\u30d5\u30a1\u540d\u3067\u30ad\u30e3\u30d7\u30c1\u30e3\u958b\u59cb */ ?>\njQuery(function(){\n  alert(\"hello1\");\n});\n<? Myasset::end()  /** \u30ad\u30e3\u30d7\u30c1\u30e3\u7d42\u4e86 */ ?>\n\n\n\n\u516c\u958b\u6642\u306f\u5916\u90e8\u30d5\u30a1\u30a4\u30eb\u5316\n\u3068\u306f\u3044\u3048\u3001\u30b5\u30fc\u30d3\u30b9\u3092\u516c\u958b\u3059\u308b\u3068\u304d\u306b\u306f\u304d\u3061\u3093\u3068\u5916\u90e8\u30d5\u30a1\u30a4\u30eb\u5316\u3057\u3066\u30d6\u30e9\u30a6\u30b6\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\u3068\u308a\u3042\u3048\u305a\u958b\u767a\u4e2d\u306f\u4fbf\u5229\u306b\u4f7f\u3048\u308b\u3093\u3058\u3083\u306a\u3044\u304b\u306a\u3001\u3068\u8a00\u3046\u3053\u3068\u3067\u3002\nFuelPHP\u3067\u305d\u306eView\u3067\u3057\u304b\u4f7f\u308f\u306a\u3044JS\u30b3\u30fc\u30c9\u3092\u66f8\u304f\u3068\u304d\u306b\u3001\u3068\u308a\u3042\u3048\u305a\u5916\u90e8\u30d5\u30a1\u30a4\u30eb\u5316\u305b\u305a\u306bView\u306e\u4e2d\u306b\u66f8\u3044\u3066\u3057\u307e\u3044\u305f\u3044\u6642\u304c\u3042\u308b\u3002\n\nView\u306e\u4e2d\u306bscript\u30bf\u30b0\u3092\u8a18\u8ff0\u3059\u308b\u3060\u3051\u3067OK\u306a\u5834\u5408\u3082\u3042\u308b\u304c\u3001Template\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3092\u4f7f\u3063\u3066\u3044\u3066\u3001html\u306e\u5f8c\u308d\u306e\u65b9\u3067jQuery\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u308b\u5834\u5408\u306a\u3069\u306f\u3001\u5148\u306e\u65b9\u6cd5\u3060\u3068View\u306e\u4e2d\u3067jQuery\u304c\u4f7f\u3048\u306a\u304f\u3066\u56f0\u308b\u3002\n\n```template.php\n<html>\n<head>\n(\u4e2d\u7565)\n<?= $header ?>\n<?= $content ?>\n<?= $footer ?>\n<script type=\"text/javascript\" src=\"//code.jquery.com/jquery-1.11.0.min.js\"></script>\n</body>\n</html>\n```\n\n```content.php\n<div id=\"content\">\n  Something content...\n</div>\n\n<script type=\"text/javascript\">\n// \u3053\u3053\u3067\u306f\u307e\u3060jQuery\u304c\u8aad\u307f\u8fbc\u307e\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u4f7f\u3048\u306a\u3044\uff01\njQuery(function(){\n  alert(\"hello1\");\n});\n</script>\n```\n\n\u3053\u3093\u306a\u6642\u306bZendFramework\u306e\u30d3\u30e5\u30fc\u30d8\u30eb\u30d1\u30fc\u306eheadScript()->captureStart() \u307f\u305f\u3044\u306b\u3001View\u306e\u4e2d\u3067JS\u30b3\u30fc\u30c9\u3092\u30d0\u30c3\u30d5\u30a1\u3057\u3066\u304a\u3044\u3066\u3001jQuery\u3092\u8aad\u307f\u8fbc\u3093\u3060\u5f8c\u3067\u51fa\u529b\u3067\u304d\u308b\u3068\u4fbf\u5229\u3060\u3063\u305f\u308a\u3059\u308b\u3002\n\n\u3068\u3044\u3046\u308f\u3051\u3067Asset\u30af\u30e9\u30b9\u3092\u62e1\u5f35\u3057\u3066JS\u30b3\u30fc\u30c9\u3092\u30ad\u30e3\u30d7\u30c1\u30e3\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u305f\u3002\n\n# Asset\u62e1\u5f35\u30af\u30e9\u30b9\n\n```myasset.php\n<?php\nclass Myasset extends \\Fuel\\Core\\Asset\n{\n  public static function forge( $name='default', array $config=array() ) {\n    if ( isset(static::$_instances[$name]) ) {\n      if ( \\get_class(static::$_instances[$name]) != \"Myasset_Instance\" ) {\n        static::$_instances[$name] = new Myasset_Instance(static::$_instances[$name]);\n      }\n    } else {\n      static::$_instances[$name] = new Myasset_Instance(array_merge(static::$default_config, \\Fuel\\Core\\Config::get('asset'), $config));\n    }\n\n    if ( $name == 'default' ) {\n      static::$_instance = static::$_instances[$name];\n    }\n    return static::$_instances[$name];\n  }\n\n  public static function instance( $instance=null ) {\n    return static::forge();\n  }\n\n  /**\n   * \u30ad\u30e3\u30d7\u30c1\u30e3\u4e2d\u5224\u5b9a\u7528\n   */\n  static protected $capture_lock = false;\n\n  /**\n   * JS\u30ad\u30e3\u30d7\u30c1\u30e3\u958b\u59cb\n   */\n  public static function begin( $attr=array(), $group=null ) {\n    if ( static::$capture_lock ) {\n      throw new \\Exception(\"\u30ad\u30e3\u30d7\u30c1\u30e3\u306f\u30cd\u30b9\u30c8\u3067\u304d\u307e\u305b\u3093\u3002\");\n    }\n    if ( static::instance()->begin($attr, $group) ) {\n      static::$capture_lock = true;\n    }\n  }\n\n  /**\n   * JS\u30ad\u30e3\u30d7\u30c1\u30e3\u7d42\u4e86\n   */\n  public static function end() {\n    if ( !static::$capture_lock ) {\n      throw new \\Exception(\"\u30ad\u30e3\u30d7\u30c1\u30e3\u3092\u958b\u59cb\u3057\u3066\u3044\u307e\u305b\u3093\u3002\");\n    }\n    if ( static::instance()->end() ) {\n      static::$capture_lock = false;\n    }\n  }\n}\n\nclass Myasset_Instance extends \\Fuel\\Core\\Asset_Instance\n{\n  protected $_attr;\n  protected $_group;\n\n  public function groups( $group=null ) {\n    if ( $group !== null && isset($this->_groups[$group]) ) {\n      return $this->_groups[$group];\n    }\n    return $this->_groups;\n  }\n\n  public function __construct( $config ) {\n    if ( $config instanceof \\Fuel\\Core\\Asset_Instance ) {\n      // \u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u30b3\u30d4\u30fc\n      $this->_asset_paths = $config->_asset_paths;\n      $this->_path_folders = $config->_path_folders;\n      $this->_asset_url = $config->_asset_url;\n      $this->_add_mtime = $config->_add_mtime;\n      $this->_groups = $config->_groups;\n      $this->_ident = $config->_ident;\n      $this->_auto_render = $config->_auto_render;\n      $this->_fail_silently = $config->_fail_silently;\n      $this->_indent = $config->_indent;\n    } else {\n      parent::__construct($config);\n    }\n  }\n\n  public function begin( $attr=array(), $group=null ) {\n    $this->_attr = $attr;\n    $this->_group = $group;\n    return \\ob_start();\n  }\n\n  public function end() {\n    if ( false === ($code = \\ob_get_clean()) ) {\n      return false;\n    }\n    $this->_parse_assets('js_code', $code, $this->_attr, $this->_group);\n    return true;\n  }\n\n  public function render( $group=null, $raw=false ) {\n    ($group === null) and $group = '_default_';\n    if ( \\is_string($group) ) {\n      isset($this->_groups[$group]) and $group = $this->_groups[$group];\n    }\n    \\is_array($group) or $group = array();\n\n    $css = '';\n    $js = '';\n    $img = '';\n    foreach ( $group as $key=>$item ) {\n      $type = $item['type'];\n      $filename = $item['file'];\n      $attr = $item['attr'];\n\n      if ( $type != 'js_code' ) {\n        // only do a file search if the asset is not a URI\n        if ( !\\preg_match('|^(\\w+:)?//|', $filename) ) {\n          // and only if the asset is local to the applications base_url\n          if ( !\\preg_match('|^(\\w+:)?//|', $this->_asset_url) or \\strpos($this->_asset_url, \\Fuel\\Core\\Config::get('base_url')) === 0 ) {\n            if ( !($file = $this->find_file($filename, $type)) ) {\n              if ( $this->_fail_silently ) {\n                continue;\n              }\n              throw new \\FuelException('Could not find asset: '.$filename);\n            }\n            $raw or $file = $this->_asset_url.$file.($this->_add_mtime ? '?'.\\filemtime($file) : '');\n          } else {\n            $raw or $file = $this->_asset_url.$this->_path_folders[$type].$filename;\n          }\n        } else {\n          $file = $filename;\n        }\n      }\n\n      switch ( $type ) {\n        case 'css':\n          $attr['type'] = 'text/css';\n          if ( $raw ) {\n            $css .= \\html_tag('style', $attr, PHP_EOL.\\file_get_contents($file).PHP_EOL).PHP_EOL;\n          } else {\n            if ( !isset($attr['rel']) or empty($attr['rel']) ) {\n              $attr['rel'] = 'stylesheet';\n            }\n            $attr['href'] = $file;\n            $css .= $this->_indent.\\html_tag('link', $attr).PHP_EOL;\n          }\n          break;\n\n        case 'js':\n          $attr['type'] = 'text/javascript';\n          if ( $raw ) {\n            $js .= \\html_tag('script', $attr, PHP_EOL.\\file_get_contents($file).PHP_EOL).PHP_EOL;\n          } else {\n            $attr['src'] = $file;\n            $js .= $this->_indent.\\html_tag('script', $attr, '').PHP_EOL;\n          }\n          break;\n\n        case 'js_code':\n          $attr['type'] = 'text/javascript';\n          $js .= \\html_tag('script', $attr, PHP_EOL.$filename.PHP_EOL).PHP_EOL;\n          break;\n\n        case 'img':\n          $attr['src'] = $file;\n          $attr['alt'] = isset($attr['alt']) ? $attr['alt'] : '';\n          $img .= \\html_tag('img', $attr );\n          break;\n      }\n    }\n\n    // return them in the correct order\n    return $css.$js.$img;\n  }\n}\n```\n\n# \u4f7f\u3044\u65b9\n\n## \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5074\n```template.php\n<html>\n<head>\n(\u4e2d\u7565)\n<?= $header ?>\n<?= $content ?>\n<?= $footer ?>\n<script type=\"text/javascript\" src=\"//code.jquery.com/jquery-1.11.0.min.js\"></script>\n<?= Myasset::render('add_js')  /** \u3053\u3053\u306b\u30ad\u30e3\u30d7\u30c1\u30e3\u3057\u305fJS\u30b3\u30fc\u30c9\u304c\u5c55\u958b\u3055\u308c\u308b */ ?>\n</body>\n</html>\n```\n\n## \u30d3\u30e5\u30fc\u5074\n```content.php\n<div id=\"content\">\n  Something content...\n</div>\n\n<? Myasset::begin(array(), 'add_js')  /** 'add_js'\u3068\u3044\u3046\u30d0\u30c3\u30d5\u30a1\u540d\u3067\u30ad\u30e3\u30d7\u30c1\u30e3\u958b\u59cb */ ?>\njQuery(function(){\n  alert(\"hello1\");\n});\n<? Myasset::end()  /** \u30ad\u30e3\u30d7\u30c1\u30e3\u7d42\u4e86 */ ?>\n```\n\n# \u516c\u958b\u6642\u306f\u5916\u90e8\u30d5\u30a1\u30a4\u30eb\u5316\n\n\u3068\u306f\u3044\u3048\u3001\u30b5\u30fc\u30d3\u30b9\u3092\u516c\u958b\u3059\u308b\u3068\u304d\u306b\u306f\u304d\u3061\u3093\u3068\u5916\u90e8\u30d5\u30a1\u30a4\u30eb\u5316\u3057\u3066\u30d6\u30e9\u30a6\u30b6\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\u3068\u308a\u3042\u3048\u305a\u958b\u767a\u4e2d\u306f\u4fbf\u5229\u306b\u4f7f\u3048\u308b\u3093\u3058\u3083\u306a\u3044\u304b\u306a\u3001\u3068\u8a00\u3046\u3053\u3068\u3067\u3002\n\n\n\n\n", "tags": ["FuelPHP"]}