{"tags": ["visudo", "sudo", "systemctl", "restart"], "context": " More than 1 year has passed since last update.\n\n[\u89e3\u6c7a]/etc/suoders\u306b\u30b5\u30fc\u30d3\u30b9\u518d\u8d77\u52d5\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u8ffd\u52a0\u3057\u305f\u3051\u3069\u3001\u4e0a\u624b\u304f\u3044\u304b\u306a\u304b\u3063\u305f\u8a71\n\u3050\u3050\u308c\u5148\u751f\u306b\u805e\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u65e5\u672c\u8a9e\u3067\u306e\u89e3\u8aac\u304c\u306a\u304b\u3063\u305f\u306e\u3067\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002\n\u74b0\u5883\uff1aCentOS-7\nroot\u3067\u306f\u306a\u3044\u30e6\u30fc\u30b6\u30fc\u306b\u3001\u30b5\u30fc\u30d3\u30b9\u518d\u8d77\u52d5\u6a29\u9650\u3092\u3042\u3052\u3088\u3046\u3068\u601d\u3063\u3066\u3001visudo\u3057\u3066\u4ee5\u4e0b\u306e\u884c\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002\n\nvisudo\nsomeone  ALL=(root)      NOPASSWD:/usr/bin/systemctl restart postfix.service\n\n\n\u3057\u304b\u3057\u3001\u4e0a\u624b\u304f\u3044\u304d\u307e\u305b\u3093\u3002\u3002\u3002\n\nshell\n$ sudo -u someone systemctl restart postfix.service\n\n\n\u3067\u3001\u3053\u3093\u306a\u30a8\u30e9\u30fc\u304c\u51fa\u307e\u3059\u3002\n\n/var/log/message\nSep 29 12:06:08 web01 dbus-daemon: dbus[599]: [system] Rejected send message, 2 matched rules; type=\"method_call\", sender=\":1.55036\" (uid=997 pid=10229 comm=\"/usr/bin/systemctl restart postfix.service \") interface=\"org.freedesktop.systemd1.\nManager\" member=\"RestartUnit\" error name=\"(unset)\" requested_reply=\"0\" destination=\"org.freedesktop.systemd1\" (uid=0 pid=1 comm=\"/usr/lib/systemd/systemd --switched-root --system \")\nSep 29 12:06:08 web01 dbus[599]: [system] Rejected send message, 2 matched rules; type=\"method_call\", sender=\":1.55036\" (uid=997 pid=10229 comm=\"/usr/bin/systemctl restart postfix.service \") interface=\"org.freedesktop.systemd1.Manager\" memb\ner=\"RestartUnit\" error name=\"(unset)\" requested_reply=\"0\" destination=\"org.freedesktop.systemd1\" (uid=0 pid=1 comm=\"/usr/lib/systemd/systemd --switched-root --system \")\n\n\n\n\u3042\u308c\u3053\u308c visudo \u3057\u3066\u307f\u307e\u3057\u305f\u304c\u3001\u3069\u3046\u3082\u305d\u3053\u3058\u3083\u306a\u3055\u305d\u3046\u3002\n\u4ee5\u4e0b\u306e\u30da\u30fc\u30b8\u3092\u767a\u898b\nhow to allow vncserver restart ??\nhttp://permalink.gmane.org/gmane.comp.freedesktop.dbus/15722\n\u3053\u308c\u3092\u307f\u308b\u3068\u3001system bus(dbus) \u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30dd\u30ea\u30b7\u30fc\u306b\u30de\u30c3\u30c1\u3057\u3066\u306a\u3044\u306e\u3067\u30a8\u30e9\u30fc\u304c\u3067\u308b\u305d\u3046\u3060\u3002\n/etc/dbus-1/system.d/org.freedesktop.systemd1.conf\n\u3092\u898b\u3066\u307f\u308b\u3068\u3001\n\n/etc/dbus-1/system.d/org.freedesktop.systemd1.conf\n        <policy context=\"default\">\n                <deny send_destination=\"org.freedesktop.systemd1\"/>\n\n\n\u4ee5\u4e0b\u306e\u9805\u76ee\u306b\u306f\u78ba\u304b\u306b\u3001\n\nGet\nGetAll\nGetUnit\nGetUnitByPID\nLoadUnit\nGetJob\nListUnits\nListUnitFiles\nGetUnitFileState\nListJobs\nSubscribe\nUnsubscribe\nDump\nGetDefaultTarget\n\n\u306f\u3042\u308b\u3051\u3069\u3001StartUnit,RestartUnit,StopUnit\u306f\u306a\u304b\u3063\u305f\u3002\nrestart\u3060\u3051\u3055\u305b\u305f\u3044\u306e\u3067\u4ee5\u4e0b\u3092\u8ffd\u52a0(\u81ea\u52d5\u7684\u306b\u518d\u8aad\u307f\u8fbc\u307f\u3055\u308c\u307e\u3059)\n\n/etc/dbus-1/system.d/org.freedesktop.systemd1.conf\n                <allow send_destination=\"org.freedesktop.systemd1\"\n                       send_interface=\"org.freedesktop.systemd1.Manager\"\n                       send_member=\"RestartUnit\"/>\n\n\n\u518d\u8d77\u52d5\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n/var/log/message\nSep 29 12:43:13 web01 dbus-daemon: dbus[599]: [system] Reloaded configuration\nSep 29 12:43:13 web01 dbus[599]: [system] Reloaded configuration\nSep 29 12:43:25 web01 systemd: Starting Postfix Mail Transport Agent...\nSep 29 12:43:26 web01 systemd: Started Postfix Mail Transport Agent.\n\n\n#[\u89e3\u6c7a]/etc/suoders\u306b\u30b5\u30fc\u30d3\u30b9\u518d\u8d77\u52d5\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u8ffd\u52a0\u3057\u305f\u3051\u3069\u3001\u4e0a\u624b\u304f\u3044\u304b\u306a\u304b\u3063\u305f\u8a71\n\u3050\u3050\u308c\u5148\u751f\u306b\u805e\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u65e5\u672c\u8a9e\u3067\u306e\u89e3\u8aac\u304c\u306a\u304b\u3063\u305f\u306e\u3067\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002\n\n`\u74b0\u5883\uff1aCentOS-7`\n\nroot\u3067\u306f\u306a\u3044\u30e6\u30fc\u30b6\u30fc\u306b\u3001\u30b5\u30fc\u30d3\u30b9\u518d\u8d77\u52d5\u6a29\u9650\u3092\u3042\u3052\u3088\u3046\u3068\u601d\u3063\u3066\u3001visudo\u3057\u3066\u4ee5\u4e0b\u306e\u884c\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002\n\n```lang:visudo\nsomeone  ALL=(root)      NOPASSWD:/usr/bin/systemctl restart postfix.service\n```\n\u3057\u304b\u3057\u3001\u4e0a\u624b\u304f\u3044\u304d\u307e\u305b\u3093\u3002\u3002\u3002\n\n```lang:shell\n$ sudo -u someone systemctl restart postfix.service\n```\n\u3067\u3001\u3053\u3093\u306a\u30a8\u30e9\u30fc\u304c\u51fa\u307e\u3059\u3002\n\n```lang:/var/log/message\nSep 29 12:06:08 web01 dbus-daemon: dbus[599]: [system] Rejected send message, 2 matched rules; type=\"method_call\", sender=\":1.55036\" (uid=997 pid=10229 comm=\"/usr/bin/systemctl restart postfix.service \") interface=\"org.freedesktop.systemd1.\nManager\" member=\"RestartUnit\" error name=\"(unset)\" requested_reply=\"0\" destination=\"org.freedesktop.systemd1\" (uid=0 pid=1 comm=\"/usr/lib/systemd/systemd --switched-root --system \")\nSep 29 12:06:08 web01 dbus[599]: [system] Rejected send message, 2 matched rules; type=\"method_call\", sender=\":1.55036\" (uid=997 pid=10229 comm=\"/usr/bin/systemctl restart postfix.service \") interface=\"org.freedesktop.systemd1.Manager\" memb\ner=\"RestartUnit\" error name=\"(unset)\" requested_reply=\"0\" destination=\"org.freedesktop.systemd1\" (uid=0 pid=1 comm=\"/usr/lib/systemd/systemd --switched-root --system \")\n\n```\n\u3042\u308c\u3053\u308c visudo \u3057\u3066\u307f\u307e\u3057\u305f\u304c\u3001\u3069\u3046\u3082\u305d\u3053\u3058\u3083\u306a\u3055\u305d\u3046\u3002\n\u4ee5\u4e0b\u306e\u30da\u30fc\u30b8\u3092\u767a\u898b\n\nhow to allow vncserver restart ??\nhttp://permalink.gmane.org/gmane.comp.freedesktop.dbus/15722\n\n\u3053\u308c\u3092\u307f\u308b\u3068\u3001system bus(dbus) \u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30dd\u30ea\u30b7\u30fc\u306b\u30de\u30c3\u30c1\u3057\u3066\u306a\u3044\u306e\u3067\u30a8\u30e9\u30fc\u304c\u3067\u308b\u305d\u3046\u3060\u3002\n\n/etc/dbus-1/system.d/org.freedesktop.systemd1.conf\n\u3092\u898b\u3066\u307f\u308b\u3068\u3001\n\n```lang:/etc/dbus-1/system.d/org.freedesktop.systemd1.conf\n        <policy context=\"default\">\n                <deny send_destination=\"org.freedesktop.systemd1\"/>\n```\n\u4ee5\u4e0b\u306e\u9805\u76ee\u306b\u306f\u78ba\u304b\u306b\u3001\n>Get\n>GetAll\n>GetUnit\n>GetUnitByPID\n>LoadUnit\n>GetJob\n>ListUnits\n>ListUnitFiles\n>GetUnitFileState\n>ListJobs\n>Subscribe\n>Unsubscribe\n>Dump\n>GetDefaultTarget\n\n\u306f\u3042\u308b\u3051\u3069\u3001StartUnit,RestartUnit,StopUnit\u306f\u306a\u304b\u3063\u305f\u3002\nrestart\u3060\u3051\u3055\u305b\u305f\u3044\u306e\u3067\u4ee5\u4e0b\u3092\u8ffd\u52a0(\u81ea\u52d5\u7684\u306b\u518d\u8aad\u307f\u8fbc\u307f\u3055\u308c\u307e\u3059)\n\n```lang:/etc/dbus-1/system.d/org.freedesktop.systemd1.conf\n                <allow send_destination=\"org.freedesktop.systemd1\"\n                       send_interface=\"org.freedesktop.systemd1.Manager\"\n                       send_member=\"RestartUnit\"/>\n```\n\n\u518d\u8d77\u52d5\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n```lang:/var/log/message\nSep 29 12:43:13 web01 dbus-daemon: dbus[599]: [system] Reloaded configuration\nSep 29 12:43:13 web01 dbus[599]: [system] Reloaded configuration\nSep 29 12:43:25 web01 systemd: Starting Postfix Mail Transport Agent...\nSep 29 12:43:26 web01 systemd: Started Postfix Mail Transport Agent.\n```\n\n"}