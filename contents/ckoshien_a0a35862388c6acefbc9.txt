{"tags": ["CSV", "Seasar2"], "context": " More than 1 year has passed since last update.CSV\u3092OrangeSignal CSV\u3092\u4f7f\u3063\u3066\u30d1\u30fc\u30b9\u3059\u308b\u3002\npublic class UploadAction {\n    @Resource\n    @ActionForm\n    public UploadForm uploadForm;\n\n    @Required\n    @Binding(bindingType = BindingType.NONE)\n    public FormFile formFile;\n\n    @Binding(bindingType = BindingType.NONE)\n    public FormFile[] formFiles;\n\n    public HttpServletRequest request;\n    public List<String[]> csvData;\n    @Resource\n    public MSongService mSongService;\n    @Resource\n    public TMarkingService tMarkingService;\n\n\n    public MSong mSong;\n    public TMarking tMarking;\n\n    @Execute(validator=false)\n    public String index(){\n        return \"index.jsp\";\n    }\n    @Execute(validator=false)\n    public String upload() throws ParseException, FileNotFoundException, IOException{\n        CsvConfig cfg = new CsvConfig();\n        cfg.setQuoteDisabled(false);// \u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u7121\u52b9\u3068\u306a\u3063\u3066\u3044\u308b\u56f2\u307f\u6587\u5b57\u3092\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\n        cfg.setEscapeDisabled(false);// \u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u7121\u52b9\u3068\u306a\u3063\u3066\u3044\u308b\u30a8\u30b9\u30b1\u30fc\u30d7\u6587\u5b57\u3092\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\n        cfg.setIgnoreLeadingWhitespaces(true);// \u9805\u76ee\u5024\u524d\u306e\u30db\u30ef\u30a4\u30c8\u30b9\u30da\u30fc\u30b9\u3092\u9664\u53bb\u3057\u307e\u3059\u3002\n        cfg.setIgnoreTrailingWhitespaces(true);// \u9805\u76ee\u5024\u5f8c\u306e\u30db\u30ef\u30a4\u30c8\u30b9\u30da\u30fc\u30b9\u3092\u9664\u53bb\u3057\u307e\u3059\u3002\n        cfg.setIgnoreEmptyLines(true);// \u7a7a\u884c\u3092\u7121\u8996\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n        InputStream is = uploadForm.file.getInputStream();\n        File file = new File(\"/\", uploadForm.file.getFileName());\n        try {\n            //IS\u304b\u3089\u4e00\u6642\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n            Files.copy(is, file.toPath(),StandardCopyOption.REPLACE_EXISTING);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        try {\n            csvData = Csv.load(new File(file.getAbsolutePath()),\"MS932\", cfg, new StringArrayListHandler());\n            //\u4e00\u6642\u30d5\u30a1\u30a4\u30eb\u524a\u9664\n            Files.deleteIfExists(file.toPath());\n        } catch (IOException e) {\n            // TODO \u81ea\u52d5\u751f\u6210\u3055\u308c\u305f catch \u30d6\u30ed\u30c3\u30af\n            e.printStackTrace();\n        }\n        System.out.println(file.getAbsolutePath());\n\n\n        for(int i=1;i<csvData.size();i++){\n            String[] str=csvData.get(i);\n            //Song\u30de\u30b9\u30bf\u306binsert\n            mSong=mSongService.findById(str[REQUEST_NO]);\n            if(mSong==null){\n                mSong=new MSong();\n                mSong.requestNo=str[REQUEST_NO];\n                mSong.artist=str[ARTIST];\n                mSong.songTitle=str[SONG_TITLE];\n                mSong.highTess=Integer.parseInt(str[HIGH_TESS]);\n                mSong.lowTess=Integer.parseInt(str[LOW_TESS]);\n                mSongService.insert(mSong);\n            }\n            //marking\u30c6\u30fc\u30d6\u30eb\u3078\u306einsert\n            Timestamp dateTime = new Timestamp(new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\").parse(str[DATETIME]).getTime());     \n\n        ActionMessages errors = new ActionMessages();\n        errors.add(ActionMessages.GLOBAL_MESSAGE,new ActionMessage(\"errors.upload.complete\"));\n        ActionMessagesUtil.addMessages(request, errors);\n        return \"index.jsp\";\n    }\n}\n\npublic List<String[]> csvData;\n//i\u306f\u884c\u6570\nString[] str=csvData.get(i);\n//\u6dfb\u3048\u5b57\u306f\u6a2a\u65b9\u5411\u306e\u30bb\u30eb\nstr[REQUEST_NO];\n\nOrangeSignal CSV - \u30e6\u30fc\u30b6\u30fc\u30ac\u30a4\u30c9\nCSV\u3092OrangeSignal CSV\u3092\u4f7f\u3063\u3066\u30d1\u30fc\u30b9\u3059\u308b\u3002\n\n\n```java\npublic class UploadAction {\n\t@Resource\n\t@ActionForm\n\tpublic UploadForm uploadForm;\n\n\t@Required\n\t@Binding(bindingType = BindingType.NONE)\n\tpublic FormFile formFile;\n\n\t@Binding(bindingType = BindingType.NONE)\n    public FormFile[] formFiles;\n\n\tpublic HttpServletRequest request;\n\tpublic List<String[]> csvData;\n\t@Resource\n\tpublic MSongService mSongService;\n\t@Resource\n\tpublic TMarkingService tMarkingService;\n\n\n\tpublic MSong mSong;\n\tpublic TMarking tMarking;\n\n\t@Execute(validator=false)\n\tpublic String index(){\n\t\treturn \"index.jsp\";\n\t}\n\t@Execute(validator=false)\n\tpublic String upload() throws ParseException, FileNotFoundException, IOException{\n\t\tCsvConfig cfg = new CsvConfig();\n\t\tcfg.setQuoteDisabled(false);// \u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u7121\u52b9\u3068\u306a\u3063\u3066\u3044\u308b\u56f2\u307f\u6587\u5b57\u3092\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\n\t\tcfg.setEscapeDisabled(false);// \u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u7121\u52b9\u3068\u306a\u3063\u3066\u3044\u308b\u30a8\u30b9\u30b1\u30fc\u30d7\u6587\u5b57\u3092\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\n\t\tcfg.setIgnoreLeadingWhitespaces(true);// \u9805\u76ee\u5024\u524d\u306e\u30db\u30ef\u30a4\u30c8\u30b9\u30da\u30fc\u30b9\u3092\u9664\u53bb\u3057\u307e\u3059\u3002\n\t\tcfg.setIgnoreTrailingWhitespaces(true);// \u9805\u76ee\u5024\u5f8c\u306e\u30db\u30ef\u30a4\u30c8\u30b9\u30da\u30fc\u30b9\u3092\u9664\u53bb\u3057\u307e\u3059\u3002\n\t\tcfg.setIgnoreEmptyLines(true);// \u7a7a\u884c\u3092\u7121\u8996\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\t\tInputStream is = uploadForm.file.getInputStream();\n\t\tFile file = new File(\"/\", uploadForm.file.getFileName());\n\t\ttry {\n\t\t    //IS\u304b\u3089\u4e00\u6642\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n\t\t\tFiles.copy(is, file.toPath(),StandardCopyOption.REPLACE_EXISTING);\n\t\t} catch (IOException e) {\n\t\t    e.printStackTrace();\n\t\t}\n\t\ttry {\n\t\t\tcsvData = Csv.load(new File(file.getAbsolutePath()),\"MS932\", cfg, new StringArrayListHandler());\n\t\t\t//\u4e00\u6642\u30d5\u30a1\u30a4\u30eb\u524a\u9664\n\t\t\tFiles.deleteIfExists(file.toPath());\n\t\t} catch (IOException e) {\n\t\t\t// TODO \u81ea\u52d5\u751f\u6210\u3055\u308c\u305f catch \u30d6\u30ed\u30c3\u30af\n\t\t\te.printStackTrace();\n\t\t}\n\t\tSystem.out.println(file.getAbsolutePath());\n\n\n\t\tfor(int i=1;i<csvData.size();i++){\n\t\t\tString[] str=csvData.get(i);\n\t\t\t//Song\u30de\u30b9\u30bf\u306binsert\n\t\t\tmSong=mSongService.findById(str[REQUEST_NO]);\n\t\t\tif(mSong==null){\n\t\t\t\tmSong=new MSong();\n\t\t\t\tmSong.requestNo=str[REQUEST_NO];\n\t\t\t\tmSong.artist=str[ARTIST];\n\t\t\t\tmSong.songTitle=str[SONG_TITLE];\n\t\t\t\tmSong.highTess=Integer.parseInt(str[HIGH_TESS]);\n\t\t\t\tmSong.lowTess=Integer.parseInt(str[LOW_TESS]);\n\t\t\t\tmSongService.insert(mSong);\n\t\t\t}\n\t\t\t//marking\u30c6\u30fc\u30d6\u30eb\u3078\u306einsert\n\t\t\tTimestamp dateTime = new Timestamp(new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\").parse(str[DATETIME]).getTime());\t\t\n\t\t\t\n\t\tActionMessages errors = new ActionMessages();\n\t\terrors.add(ActionMessages.GLOBAL_MESSAGE,new ActionMessage(\"errors.upload.complete\"));\n\t\tActionMessagesUtil.addMessages(request, errors);\n\t\treturn \"index.jsp\";\n\t}\n}\n```\n\n```java\npublic List<String[]> csvData;\n//i\u306f\u884c\u6570\nString[] str=csvData.get(i);\n//\u6dfb\u3048\u5b57\u306f\u6a2a\u65b9\u5411\u306e\u30bb\u30eb\nstr[REQUEST_NO];\n```\n\n[OrangeSignal CSV - \u30e6\u30fc\u30b6\u30fc\u30ac\u30a4\u30c9](http://orangesignal.osdn.jp/csv/userguide.html)\n"}