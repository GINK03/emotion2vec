{"tags": ["PHP", "SQL", "server", "WordPress"], "context": "A\u30b5\u30a4\u30c8\u304b\u3089\u8aad\u307f\u8fbc\u3093\u3060\u8a18\u4e8b\u3092B\u30b5\u30a4\u30c8\u306b\u81ea\u52d5\u3067\u6295\u7a3f\u3055\u305b\u305f\u3044\u3067\u3059\u3002\n\u307e\u305f\u3001\u305d\u306eA\u30b5\u30a4\u30c8\u306e\u8a18\u4e8b\u3092\u66f4\u65b0\u3057\u305f\u3089B\u30b5\u30a4\u30c8\u3067\u81ea\u52d5\u751f\u6210\u3055\u308c\u305f\u8a18\u4e8b\u3082\u66f4\u65b0\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u3067\u3059\u3002\n\u4eca\u306e\u6bb5\u968e\u3067\u306e\u30bd\u30fc\u30b9\u3067\u3059\u3002\n`\nglobal wpdb;wpdb; \nresults = $wpdb->get_results(\"\nSELECT post_title \nFROM wp_posts\n\");\nforeach (resultsasresults as post) {\npageexists=page_exists = post->post_title;\n}\n//\u305d\u306e\u4ed6DB\u63a5\u7d9a\u8a2d\u5b9a\nanotherdbuser=\u2032user\u2032;another_db_user = 'user'; \nanother_db_pass = 'pass';\nanotherdbname=\u2032name\u2032;another_db_name = 'name'; \nanother_db_host = 'localhost';\n$another_tb_prefix = 'wp_';\nmydb=newwpdb(mydb = new wpdb(another_db_user,anotherdbpass,another_db_pass,another_db_name,$another_db_host);\nmydb\u2212>setprefix(mydb->set_prefix(another_tb_prefix);\n//\u4e00\u89a7\u60c5\u5831\u53d6\u5f97\nresult=result = mydb->get_results(\"\nSELECT\nm0.post_title,\nm0.id,\nm0.post_name,\nm0.guid\nFROM ( select post_title, id, guid, post_name from wp_posts where post_type = 'bio' AND post_status = 'publish'  ) AS m0 \n\");\nforeach (resultasresult as value) {\nif( value\u2212>posttitle==value->post_title == page_exists  ) {\n//\u4f55\u3082\u3057\u306a\u3044\n}\nelse {\n$my_access = Array(\n'post_author' => '1',\n'post_title' => ''.value\u2212>posttitle.\u2032\u2032,\u2032poststatus\u2032=>\u2032publish\u2032,\u2032commentstatus\u2032=>\u2032closed\u2032,\u2032pingstatus\u2032=>\u2032closed\u2032,\u2032postname\u2032=>\u2032\u2032.value->post_title.'', \n'post_status' => 'publish', \n'comment_status' => 'closed', \n'ping_status' => 'closed', \n'post_name' => ''.value->post_name.'',\n'post_type' => 'page',\n'post_parent' => '115822',\n'page_template' => 'template-profile-info.php'\n      );\nwp_insert_post($my_access);\n}\n}\n`\n\u3053\u308c\u3060\u3068\u8a18\u4e8b\u306f\u91cd\u8907\u3055\u308c\u3066\u7e70\u308a\u8fd4\u3057\u81ea\u52d5\u6295\u7a3f\u3057\u307e\u3059\u3002\n\n\u5225\u306e\u30bd\u30fc\u30b9\u306e\u6848\n$this_posts = get_posts(\n                array(\n                    'post_type' => 'page',\n                    'page_template' => 'template-profile-info.php'\n                )\n            );\n\n$this_post_titles = wp_list_pluck( $this_posts, 'post_title' );\n\n// set the DB creds\n$another_db_user = 'user';\n$another_db_pass = 'pass';\n$another_db_name = 'name';\n$another_db_host = 'localhost';\n$another_tb_prefix = 'wp_';\n\n// setup the DB connection\n$mydb = new wpdb( $another_db_user, $another_db_pass, $another_db_name, $another_db_host );\n\n$mydb->set_prefix( $another_tb_prefix );\n\n//\u4e00\u89a7\u60c5\u5831\u53d6\u5f97\n$result = $mydb->get_results(\"\nSELECT  \nm0.post_title,  \nm0.id,  \nm0.post_name,\nm0.guid  \nFROM ( select post_title, id, guid, post_name from wp_posts where post_type = 'bio' AND post_status = 'publish'  ) AS m0 \n\");\n\n\nforeach ( $result as $value ) {\n    if ( in_array( $value->post_title, $this_post_titles ) ) {\n\n    } else {\n        $my_access = array(\n                    'post_author' => '1',\n                    'post_title' => $value->post_title,\n                    'post_status' => 'publish',\n                    'comment_status' => 'closed',\n                    'ping_status' => 'closed',\n                    'post_name' => $value->post_name,\n                    'post_type' => 'page',\n                    'post_parent' => '115822',\n                    'page_template' => 'template-profile-info.php'\n                  );\n\n        wp_insert_post( $my_access );\n    }\n}\n\n\n\u3055\u3089\u306b\u5225\u306e\u30bd\u30fc\u30b9\u306e\u6848\nfunction wpse_20160318_do_db_sync() {\n\n    // query the DB\n    global $wpdb;\n    $result = $wpdb->get_results(\n        \"\n    SELECT post_name\n    FROM wp_posts\n    WHERE post_status = 'publish'\n    AND post_type = 'page'\n    \"\n    );\n\n\n\n    // for all the results, let's check against the slug.\n    foreach ( $result as $r ) {\n\n        // see if we can find it...\n        $post = get_page_by_path( $r->post_name );\n\n    }\n\n    // set the DB creds\n    $another_db_user = 'user';\n    $another_db_pass = 'pass';\n    $another_db_name = 'name';\n    $another_db_host = 'localhost';\n    $another_tb_prefix = 'wp_';\n\n    // setup the DB connection\n    $mydb = new wpdb( $another_db_user, $another_db_pass, $another_db_name, $another_db_host );\n\n    $mydb->set_prefix( $another_tb_prefix );\n\n    //\u4e00\u89a7\u60c5\u5831\u53d6\u5f97\n    $results = $mydb->get_results(\"\n    SELECT  \n    m0.post_title,  \n    m0.id,  \n    m0.post_name,\n    m0.guid  \n    FROM ( select post_title, id, guid, post_name from wp_posts where post_type = 'bio' AND post_status = 'publish'  ) AS m0 \n    \");\n\n    foreach ( $results as $value ) {\n\n\n        if ( ! $post ) {\n            // We're cool, let's create this one.\n            $my_access = Array(\n\n            'post_author' => '1',\n            'post_title' => ''.$value->post_title.'',\n            'post_status' => 'publish',\n            'comment_status' => 'closed',\n            'ping_status' => 'closed',\n            'post_name' => ''.$value->post_name.'',\n            'post_type' => 'page',\n            'post_parent' => '115822',\n            'page_template' => 'template-profile-info.php'\n            );\n            wp_insert_post($my_access); \n\n        }\n        else {\n            // No need to duplicate this one\n\n        }\n\n    }\n\n\n}\n\n// using on init to make sure the DB is ready to go\nadd_action( 'init', 'wpse_20160318_do_db_sync' );\n\nA\u30b5\u30a4\u30c8\u304b\u3089\u8aad\u307f\u8fbc\u3093\u3060\u8a18\u4e8b\u3092B\u30b5\u30a4\u30c8\u306b\u81ea\u52d5\u3067\u6295\u7a3f\u3055\u305b\u305f\u3044\u3067\u3059\u3002\n\n\u307e\u305f\u3001\u305d\u306eA\u30b5\u30a4\u30c8\u306e\u8a18\u4e8b\u3092\u66f4\u65b0\u3057\u305f\u3089B\u30b5\u30a4\u30c8\u3067\u81ea\u52d5\u751f\u6210\u3055\u308c\u305f\u8a18\u4e8b\u3082\u66f4\u65b0\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u3067\u3059\u3002\n\n\u4eca\u306e\u6bb5\u968e\u3067\u306e\u30bd\u30fc\u30b9\u3067\u3059\u3002\n`\nglobal $wpdb;\n$results = $wpdb->get_results(\"\nSELECT post_title \nFROM wp_posts\n\");\n\nforeach ($results as $post) {\n$page_exists = $post->post_title;\n}\n\n\n//\u305d\u306e\u4ed6DB\u63a5\u7d9a\u8a2d\u5b9a\n$another_db_user = 'user';\n$another_db_pass = 'pass';\n$another_db_name = 'name';\n$another_db_host = 'localhost';\n$another_tb_prefix = 'wp_';\n\n$mydb = new wpdb($another_db_user,$another_db_pass,$another_db_name,$another_db_host);\n\n$mydb->set_prefix($another_tb_prefix);\n\n//\u4e00\u89a7\u60c5\u5831\u53d6\u5f97\n$result = $mydb->get_results(\"\nSELECT  \nm0.post_title,  \nm0.id,  \nm0.post_name,\nm0.guid  \nFROM ( select post_title, id, guid, post_name from wp_posts where post_type = 'bio' AND post_status = 'publish'  ) AS m0 \n\");\n\n\nforeach ($result as $value) {\n\nif( $value->post_title == $page_exists  ) {\n\n//\u4f55\u3082\u3057\u306a\u3044\n\n}\n\nelse {\n$my_access = Array(\n\n'post_author' => '1',\n'post_title' => ''.$value->post_title.'',\n'post_status' => 'publish',\n'comment_status' => 'closed',\n'ping_status' => 'closed',\n'post_name' => ''.$value->post_name.'',\n'post_type' => 'page',\n'post_parent' => '115822',\n'page_template' => 'template-profile-info.php'\n\t  );\n\nwp_insert_post($my_access);\n}\n\n}\n`\n\n\n**\u3053\u308c\u3060\u3068\u8a18\u4e8b\u306f\u91cd\u8907\u3055\u308c\u3066\u7e70\u308a\u8fd4\u3057\u81ea\u52d5\u6295\u7a3f\u3057\u307e\u3059\u3002**\n\n###\u5225\u306e\u30bd\u30fc\u30b9\u306e\u6848\n```\u3053\u3053\u306b\u8a00\u8a9e\u3092\u5165\u529b\n$this_posts = get_posts(\n                array(\n\t\t\t\t\t'post_type' => 'page',\n                    'page_template' => 'template-profile-info.php'\n                )\n            );\n\t\t\t\n$this_post_titles = wp_list_pluck( $this_posts, 'post_title' );\n\t\t\n// set the DB creds\n$another_db_user = 'user';\n$another_db_pass = 'pass';\n$another_db_name = 'name';\n$another_db_host = 'localhost';\n$another_tb_prefix = 'wp_';\n\n// setup the DB connection\n$mydb = new wpdb( $another_db_user, $another_db_pass, $another_db_name, $another_db_host );\n\n$mydb->set_prefix( $another_tb_prefix );\n\n//\u4e00\u89a7\u60c5\u5831\u53d6\u5f97\n$result = $mydb->get_results(\"\nSELECT  \nm0.post_title,  \nm0.id,  \nm0.post_name,\nm0.guid  \nFROM ( select post_title, id, guid, post_name from wp_posts where post_type = 'bio' AND post_status = 'publish'  ) AS m0 \n\");\n\n\nforeach ( $result as $value ) {\n    if ( in_array( $value->post_title, $this_post_titles ) ) {\n        \n    } else {\n        $my_access = array(\n                    'post_author' => '1',\n                    'post_title' => $value->post_title,\n                    'post_status' => 'publish',\n                    'comment_status' => 'closed',\n                    'ping_status' => 'closed',\n                    'post_name' => $value->post_name,\n                    'post_type' => 'page',\n                    'post_parent' => '115822',\n                    'page_template' => 'template-profile-info.php'\n                  );\n\n        wp_insert_post( $my_access );\n    }\n}\n```\n\n###\u3055\u3089\u306b\u5225\u306e\u30bd\u30fc\u30b9\u306e\u6848\n\n```\u3053\u3053\u306b\u8a00\u8a9e\u3092\u5165\u529b\nfunction wpse_20160318_do_db_sync() {\n\n\t// query the DB\n\tglobal $wpdb;\n    $result = $wpdb->get_results(\n        \"\n    SELECT post_name\n\tFROM wp_posts\n\tWHERE post_status = 'publish'\n\tAND post_type = 'page'\n    \"\n    );\n\n\n\n    // for all the results, let's check against the slug.\n    foreach ( $result as $r ) {\n\n        // see if we can find it...\n        $post = get_page_by_path( $r->post_name );\n\n    }\n\t\n\t// set the DB creds\n\t$another_db_user = 'user';\n\t$another_db_pass = 'pass';\n\t$another_db_name = 'name';\n\t$another_db_host = 'localhost';\n\t$another_tb_prefix = 'wp_';\n\n\t// setup the DB connection\n\t$mydb = new wpdb( $another_db_user, $another_db_pass, $another_db_name, $another_db_host );\n\n\t$mydb->set_prefix( $another_tb_prefix );\n\n\t//\u4e00\u89a7\u60c5\u5831\u53d6\u5f97\n\t$results = $mydb->get_results(\"\n\tSELECT  \n\tm0.post_title,  \n\tm0.id,  \n\tm0.post_name,\n\tm0.guid  \n\tFROM ( select post_title, id, guid, post_name from wp_posts where post_type = 'bio' AND post_status = 'publish'  ) AS m0 \n\t\");\n\n\tforeach ( $results as $value ) {\n\t\t\n\t\t\n\t\tif ( ! $post ) {\n\t\t\t// We're cool, let's create this one.\n\t\t\t$my_access = Array(\n\t\t\n\t\t\t'post_author' => '1',\n\t\t\t'post_title' => ''.$value->post_title.'',\n\t\t\t'post_status' => 'publish',\n\t\t\t'comment_status' => 'closed',\n\t\t\t'ping_status' => 'closed',\n\t\t\t'post_name' => ''.$value->post_name.'',\n\t\t\t'post_type' => 'page',\n\t\t\t'post_parent' => '115822',\n\t\t\t'page_template' => 'template-profile-info.php'\n\t\t\t);\n\t\t\twp_insert_post($my_access); \n\t\t\t\n        }\n        else {\n            // No need to duplicate this one\n            \n        }\n\t\t\n\t}\n\t\n\t\n}\n\n// using on init to make sure the DB is ready to go\nadd_action( 'init', 'wpse_20160318_do_db_sync' );\n```\n"}