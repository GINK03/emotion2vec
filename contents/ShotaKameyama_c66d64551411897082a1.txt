{"context": " More than 1 year has passed since last update.aws-sdk-core(aws-sdk\u306eversion2)\u3092\u3064\u304b\u3063\u3066\u3001Capistrano3\u3067\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u5834\u5408\u306b\u3069\u306e\u3088\u3046\u306b\u30b3\u30fc\u30c9\u3092\u66f8\u3051\u3070\u3044\u3044\u304b\u3042\u307e\u308a\u60c5\u5831\u304c\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u898b\u306a\u304c\u3089\u3001\u5b9f\u88c5\u3057\u3066\u307f\u305f\u3002\naccess key\u3092\u4f7f\u3046\u306e\u3067\u3001IAM\u3067\u30a2\u30af\u30bb\u30b9\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u3092\u3057\u3066\u304a\u3044\u305f\u307b\u3046\u304c\u826f\u3044\u3002\n\u73fe\u5728\u306f2.0.6.pre\u3092\u6307\u5b9a\u3057\u3066gem install\u3059\u308b\u3002\n# Gemfile\n\n# AWS SDK for Ruby version2\ngem 'aws-sdk', '2.0.6.pre'\n\ndeploy\u914d\u4e0b\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53d6\u5f97\n# config/deploy/staging.rb\nrequire 'aws-sdk-core'\n\n# Access key\u3068Secret Access Key\u3092\u3064\u304b\u3063\u3066\u3001EC2\u304b\u3089public_dns_name\u3092\u53d6\u5f97\u3059\u308b\nec2 = Aws::EC2::Client.new(\n        access_key_id: ENV['ACCESS_KEY_ID'],\n        secret_access_key: ENV['SECRET_ACCESS_KEY'],\n        region: 'ap-northeast-1')\n\n# \u691c\u7d22\u6761\u4ef6\u306f\uff11\u3001EC2\u306b\u7d10\u4ed8\u3044\u3066\u3044\u308btag\u60c5\u5831\u3000\uff12\u3001\u8d77\u52d5\u4e2d\u306eEC2\u3067\u6761\u4ef6\u691c\u7d22\u3059\u308b\u3002\n# \u3053\u3053\u306f\u81ea\u5206\u306e\u691c\u7d22\u3057\u305f\u3044\u6761\u4ef6\u3092\u8272\u3005\u5909\u66f4\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3002\nec2_filtered = ec2.describe_instances(\n                 filters:[\n                   {name: \"tag:foo\", values: ['bar']},\n                   {name: 'instance-state-name', values: ['running']}\n                 ])\n# \u691c\u7d22\u6761\u4ef6\u304b\u3089public_dns_name\u3092\u53d6\u5f97\u3059\u308b(array)\ninstances = ec2_filtered.reservations.map{|k| k.instances}[0].map{|k| k.public_dns_name}\n\nrole :app, *instances\nrole :web, *instances\nserver *instances,\n       user: 'ec2-user',\n       roles: 'localhost',\n       ssh_options: {\n           forward_agent: true,\n           auth_methods: [\"publickey\"],\n           # if you want to debug capistrano set verbose to debug\n           # verbose: :debug,\n           keys: ENV['AWS_PEM_PATH']}\n\nset :stage, :production\nset :rails_env, 'production'\n\n\u4e0a\u8a18\u306fEC2\u304b\u3089\u306e\u691c\u7d22\u3060\u304c\u3001\u3082\u3061\u308d\u3093ELB\u914d\u4e0b\u306epublic_dns_name\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3002\u305d\u306e\u969b\u306f Aws::ElasticLoadBalancing::Client \u3092\u4f7f\u3046\u3002\naws-sdk-core(aws-sdk\u306eversion2)\u3092\u3064\u304b\u3063\u3066\u3001Capistrano3\u3067\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u5834\u5408\u306b\u3069\u306e\u3088\u3046\u306b\u30b3\u30fc\u30c9\u3092\u66f8\u3051\u3070\u3044\u3044\u304b\u3042\u307e\u308a\u60c5\u5831\u304c\u306a\u304b\u3063\u305f\u306e\u3067\u3001[\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](http://docs.aws.amazon.com/sdkforruby/api/Aws/EC2.html)\u3092\u898b\u306a\u304c\u3089\u3001\u5b9f\u88c5\u3057\u3066\u307f\u305f\u3002\n\naccess key\u3092\u4f7f\u3046\u306e\u3067\u3001IAM\u3067\u30a2\u30af\u30bb\u30b9\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u3092\u3057\u3066\u304a\u3044\u305f\u307b\u3046\u304c\u826f\u3044\u3002\n\n\u73fe\u5728\u306f2.0.6.pre\u3092\u6307\u5b9a\u3057\u3066gem install\u3059\u308b\u3002\n\n```rb\n# Gemfile\n\n# AWS SDK for Ruby version2\ngem 'aws-sdk', '2.0.6.pre'\n```\n\ndeploy\u914d\u4e0b\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53d6\u5f97\n\n```rb\n# config/deploy/staging.rb\nrequire 'aws-sdk-core'\n\n# Access key\u3068Secret Access Key\u3092\u3064\u304b\u3063\u3066\u3001EC2\u304b\u3089public_dns_name\u3092\u53d6\u5f97\u3059\u308b\nec2 = Aws::EC2::Client.new(\n        access_key_id: ENV['ACCESS_KEY_ID'],\n        secret_access_key: ENV['SECRET_ACCESS_KEY'],\n        region: 'ap-northeast-1')\n\n# \u691c\u7d22\u6761\u4ef6\u306f\uff11\u3001EC2\u306b\u7d10\u4ed8\u3044\u3066\u3044\u308btag\u60c5\u5831\u3000\uff12\u3001\u8d77\u52d5\u4e2d\u306eEC2\u3067\u6761\u4ef6\u691c\u7d22\u3059\u308b\u3002\n# \u3053\u3053\u306f\u81ea\u5206\u306e\u691c\u7d22\u3057\u305f\u3044\u6761\u4ef6\u3092\u8272\u3005\u5909\u66f4\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3002\nec2_filtered = ec2.describe_instances(\n                 filters:[\n                   {name: \"tag:foo\", values: ['bar']},\n                   {name: 'instance-state-name', values: ['running']}\n                 ])\n# \u691c\u7d22\u6761\u4ef6\u304b\u3089public_dns_name\u3092\u53d6\u5f97\u3059\u308b(array)\ninstances = ec2_filtered.reservations.map{|k| k.instances}[0].map{|k| k.public_dns_name}\n\nrole :app, *instances\nrole :web, *instances\nserver *instances,\n       user: 'ec2-user',\n       roles: 'localhost',\n       ssh_options: {\n           forward_agent: true,\n           auth_methods: [\"publickey\"],\n           # if you want to debug capistrano set verbose to debug\n           # verbose: :debug,\n           keys: ENV['AWS_PEM_PATH']}\n\nset :stage, :production\nset :rails_env, 'production'\n```\n\n\u4e0a\u8a18\u306fEC2\u304b\u3089\u306e\u691c\u7d22\u3060\u304c\u3001\u3082\u3061\u308d\u3093ELB\u914d\u4e0b\u306epublic_dns_name\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3002\u305d\u306e\u969b\u306f `Aws::ElasticLoadBalancing::Client` \u3092\u4f7f\u3046\u3002\n", "tags": ["AWS", "AWS_SDK", "aws-sdk", "capistrano"]}