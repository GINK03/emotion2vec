{"context": "\n\n\u306f\u3058\u3081\u306b\nCentOS6\u7b49\u3067ruby\u30002.x\u3092\u5229\u7528\u3057\u305f\u3044\uff08Serverspec\u3092\u4f7f\u3044\u305f\u3044\uff09\u306a\u3069\u3067\u3001\nruby\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u3042\u3052\u308b\u305f\u3081\u306brbenv\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\u3092\u884c\u3046\nAnsible\u306eplaybook\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\npyenv\u306f\u3053\u3061\u3089\nhttp://qiita.com/tbuchi888/items/d44d15dcc6f63ae440d9\n\n\u69cb\u7bc9\u306e\u4e3b\u306a\u624b\u9806\nCentOS\u306b\u5bfe\u3057\u3066\u4ee5\u4e0b\u3092root\u3067\u5b9f\u65bd\u3057\u307e\u3059\n1.\u3000rbenv\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n2.\u3000ruby\u30d0\u30fc\u30b8\u30e7\u30f32.2.3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nsite.yml\n---\n - include: install_rbenv_without_proxy.yml\n\n\n\u4ee5\u4e0bplaybook\u306evars\uff1a ruby_ver: 2.2.3\u3067rbenv\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fb\u8a2d\u5b9a\u3059\u308bruby\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u6307\u5b9a\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u9069\u5b9c\u5909\u66f4\u3057\u3066\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u307e\u305f\u3001rbenv\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u306b\u3001\u7d9a\u3051\u3066Serverspec\u306a\u3069\u3092gem\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3044\u5834\u5408\u306f\n#  Please remove the following comment '#' when you want to do, for example,gem install Serverspecusing rbenv.\n\u3088\u308a\u4e0b\u306e\u884c\u306e\u3092\u30b3\u30e1\u30f3\u30c8\u3092\u5916\u3057\u3066\u3001\u9069\u5b9c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5bfe\u8c61\u3092\u5909\u66f4\u3057\u3066\u3054\u5229\u7528\u304f\u3060\u3055\u3044\u3002\n\u306a\u304a\u3001rbenv\u3067\u306f\u3001\u4ed5\u7d44\u307f\u4e0a~/.bash_profile\u3067ruby\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\u3092\u5b9f\u65bd\u3057\u3066\u3044\u308b\u306e\u3067\u3001Ansible\u7b49\u3067ruby\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u5834\u5408\u306f\u3001\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u524d\u306bsource ~/.bash_profile;\u3068\u3064\u3051\u3066\u3001~/.bash_profile\u3092\u4e8b\u524d\u306b\u8aad\u8fbc\u3080\u3068\u3053\u308d\u304c\u30dd\u30a4\u30f3\u30c8\u3067\u3059\u3002\n\ninstall_rbenv_without_proxy.yml\n---\n- hosts: all\n  gather_facts: no\n  become: yes\n  vars:\n    ruby_ver: 2.2.3\n  tasks:\n    - name: check install rbenv by which command\n      shell: source ~/.bash_profile; which rbenv\n      register: rbenv_install\n      failed_when: rbenv_install.rc == 0\n\n    - block:\n        - debug: msg=\"---------- block start ----------\"\n        - name: yum install\n          yum:\n            name:  '{{ item.name }}'\n            state: '{{ item.state }}'\n          register: RESULT\n          with_items:\n            - name: gcc\n              state: latest\n            - name: zlib-devel\n              state: latest\n            - name: openssl-devel\n              state: latest\n            - name: mysql-server\n              state: latest\n            - name: mysql-devel\n              state: latest\n            - name: libffi-devel\n              state: latest\n            - name: libxml2-devel\n              state: latest\n            - name: libxslt-devel\n              state: latest\n            - name: httpd-devel\n              state: latest\n            - name: curl-devel\n              state: latest\n            - name: apr-devel\n              state: latest\n            - name: apr-util-devel\n              state: latest\n            - name: readline-devel\n              state: latest\n            - name: ImageMagick\n              state: latest\n            - name: ImageMagick-devel\n              state: latest\n            - name: git\n              state: latest\n            - name: rubygems\n              state: latest\n        - name: results\n          debug: var=RESULT.results\n\n        - name: git clone rbenv,ruby-build\n          git:\n            repo: '{{ item.repo }}'\n            dest: '{{ item.dest }}'\n          register: RESULT\n          with_items:\n            - repo: https://github.com/sstephenson/rbenv.git\n              dest: ~/.rbenv\n            - repo: https://github.com/sstephenson/ruby-build.git\n              dest: ~/.rbenv/plugins/ruby-build\n        - name: results\n          debug: var=RESULT.results\n\n        - name: install rbenv and ruby\n          shell: '{{ item.cmd }}'\n          register: RESULT\n          with_items:\n            - cmd: echo 'export PATH=\"$HOME/.rbenv/bin:$PATH\"' >> ~/.bash_profile\n            - cmd: echo 'eval \"$(rbenv init -)\"' >> ~/.bash_profile\n            - cmd: source ~/.bash_profile; rbenv -v\n            - cmd: source ~/.bash_profile; rbenv install '{{ ruby_ver }}'\n            - cmd: source ~/.bash_profile; rbenv rehash\n            - cmd: source ~/.bash_profile; rbenv global '{{ ruby_ver }}'\n            - cmd: source ~/.bash_profile; rbenv rehash\n            - cmd: source ~/.bash_profile; ruby -v\n        - name: results\n          debug: var=RESULT.results\n\n#  Please remove the following comment '#' when you want to do, for example, `gem install Serverspec` using rbenv.\n#        - name: install serverspec and ansiblespec\n#          shell: '{{ item.cmd }}'\n#          register: RESULT\n#          with_items:\n#            - cmd: source ~/.bash_profile; gem install serverspec\n#            - cmd: source ~/.bash_profile; gem install ansible_spec\n#        - name: results\n#          debug: var=RESULT.results\n\n        - debug: msg=\"---------- block end   ----------\"\n      when: rbenv_install.rc == 1\n\n\n\n\u4ee5\u4e0b\u306fVagrant\u74b0\u5883\u306e\u5834\u5408\nvagrant up\u306b\u3066CentOS6\u306eServer\u8d77\u52d5\u3068Ansible provisoner\u3092\u5229\u7528\u3057\u3066rbenv\u74b0\u5883\u306e\u69cb\u7bc9\u3068\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\u306a\u304a\u3001box\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u3064\u3044\u3066\u306f\u3001\u9069\u6642\u81ea\u74b0\u5883\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u7f6e\u304d\u63db\u3048\u3066\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\nVagrantfile\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVagrant.configure(2) do |config|\n  # Every Vagrant development environment requires a box. You can search for\n  # boxes at https://atlas.hashicorp.com/search.\n  # Please replace it with a BOX name of CentOS6 for one's own 32bit when your host is 32bit machine.\n  config.vm.box = \"geerlingguy/centos6\"\n\n  # Add ansible provisioner\n  config.vm.provision \"ansible\" do |ansible|\n    ansible.playbook = \"site.yml\"\n  end\nend\n\n\n\u3000\u4f7f\u3044\u65b9\n-\u3000OSX\u7b49\u3067Ansible provisoner\u304c\u5229\u7528\u3067\u304d\u308bVagrant\u74b0\u5883\u306e\u5834\u5408\n\u3000\u3000-\u3000\u4e0a\u8a18playbook\u7b49\u8cc7\u6750\u3092\u7528\u610f\u3057\u305f\u4e0a\u3067vagrant up\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n-\u3000Ansible\u74b0\u5883\u306e\u307f\u306e\u5834\u5408\n\u3000\u3000-\u3000\u30a4\u30f3\u30d9\u30f3\u30c8\u30ea\u30db\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u5404\u81ea\u7528\u610f\u3057\u3066CentOS6\u30b5\u30fc\u30d0\u306b\u5bfe\u3057\u3066Playbook\u3092\u5b9f\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002ansible-playbook -i \u30a4\u30f3\u30d9\u30f3\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\u3000site.yml\n\n\u4e0a\u8a18\u30d7\u30ec\u30a4\u30d6\u30c3\u30af\u7b49\u306e\u5b9f\u884c\u74b0\u5883\n\nAnsible provisioner and Vagrant,Virtulbox Host\n\u3000-\u3000OS\uff1aOSX yosemite\n\u3000-\u3000Virtulbox\uff1a\u30d0\u30fc\u30b8\u30e7\u30f3 5.0.10 r104061\n\u3000-\u3000Vagrant\uff1a Vagrant 1.8.1\n\u3000-\u3000Ansible\uff1a\n$ansible --version\nansible 2.1.0 (devel c600ab81ee) last updated 2016/04/20 11:11:25 (GMT +900)\n  lib/ansible/modules/core: (detached HEAD 98322a777f) last updated 2016/04/20 11:11:54 (GMT +900)\n  lib/ansible/modules/extras: (detached HEAD 1aecfc1e19) last updated 2016/04/20 11:11:55 (GMT +900)\n  config file = \n  configured module search path = Default w/o overrides\n\n\nrbenv install Server\n-\u3000OS: CentOS6.8\n# \u306f\u3058\u3081\u306b\nCentOS6\u7b49\u3067ruby\u30002.x\u3092\u5229\u7528\u3057\u305f\u3044\uff08Serverspec\u3092\u4f7f\u3044\u305f\u3044\uff09\u306a\u3069\u3067\u3001\nruby\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u3042\u3052\u308b\u305f\u3081\u306brbenv\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\u3092\u884c\u3046\nAnsible\u306eplaybook\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\npyenv\u306f\u3053\u3061\u3089\nhttp://qiita.com/tbuchi888/items/d44d15dcc6f63ae440d9\n\n## \u69cb\u7bc9\u306e\u4e3b\u306a\u624b\u9806\nCentOS\u306b\u5bfe\u3057\u3066\u4ee5\u4e0b\u3092root\u3067\u5b9f\u65bd\u3057\u307e\u3059\n\n1.\u3000rbenv\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n2.\u3000ruby\u30d0\u30fc\u30b8\u30e7\u30f32.2.3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\n``` site.yml\n---\n - include: install_rbenv_without_proxy.yml\n```\n\n\u4ee5\u4e0bplaybook\u306evars\uff1a `ruby_ver: 2.2.3`\u3067rbenv\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fb\u8a2d\u5b9a\u3059\u308bruby\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u6307\u5b9a\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u9069\u5b9c\u5909\u66f4\u3057\u3066\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u307e\u305f\u3001rbenv\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u306b\u3001\u7d9a\u3051\u3066Serverspec\u306a\u3069\u3092gem\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3044\u5834\u5408\u306f\n`#  Please remove the following comment '#' when you want to do, for example, `gem install Serverspec` using rbenv.\n`\u3088\u308a\u4e0b\u306e\u884c\u306e\u3092\u30b3\u30e1\u30f3\u30c8\u3092\u5916\u3057\u3066\u3001\u9069\u5b9c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5bfe\u8c61\u3092\u5909\u66f4\u3057\u3066\u3054\u5229\u7528\u304f\u3060\u3055\u3044\u3002\n\u306a\u304a\u3001rbenv\u3067\u306f\u3001\u4ed5\u7d44\u307f\u4e0a`~/.bash_profile`\u3067ruby\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\u3092\u5b9f\u65bd\u3057\u3066\u3044\u308b\u306e\u3067\u3001Ansible\u7b49\u3067ruby\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u5834\u5408\u306f\u3001\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u524d\u306b`source ~/.bash_profile;`\u3068\u3064\u3051\u3066\u3001`~/.bash_profile`\u3092\u4e8b\u524d\u306b\u8aad\u8fbc\u3080\u3068\u3053\u308d\u304c\u30dd\u30a4\u30f3\u30c8\u3067\u3059\u3002\n\n``` install_rbenv_without_proxy.yml\n---\n- hosts: all\n  gather_facts: no\n  become: yes\n  vars:\n    ruby_ver: 2.2.3\n  tasks:\n    - name: check install rbenv by which command\n      shell: source ~/.bash_profile; which rbenv\n      register: rbenv_install\n      failed_when: rbenv_install.rc == 0\n\n    - block:\n        - debug: msg=\"---------- block start ----------\"\n        - name: yum install\n          yum:\n            name:  '{{ item.name }}'\n            state: '{{ item.state }}'\n          register: RESULT\n          with_items:\n            - name: gcc\n              state: latest\n            - name: zlib-devel\n              state: latest\n            - name: openssl-devel\n              state: latest\n            - name: mysql-server\n              state: latest\n            - name: mysql-devel\n              state: latest\n            - name: libffi-devel\n              state: latest\n            - name: libxml2-devel\n              state: latest\n            - name: libxslt-devel\n              state: latest\n            - name: httpd-devel\n              state: latest\n            - name: curl-devel\n              state: latest\n            - name: apr-devel\n              state: latest\n            - name: apr-util-devel\n              state: latest\n            - name: readline-devel\n              state: latest\n            - name: ImageMagick\n              state: latest\n            - name: ImageMagick-devel\n              state: latest\n            - name: git\n              state: latest\n            - name: rubygems\n              state: latest\n        - name: results\n          debug: var=RESULT.results\n\n        - name: git clone rbenv,ruby-build\n          git:\n            repo: '{{ item.repo }}'\n            dest: '{{ item.dest }}'\n          register: RESULT\n          with_items:\n            - repo: https://github.com/sstephenson/rbenv.git\n              dest: ~/.rbenv\n            - repo: https://github.com/sstephenson/ruby-build.git\n              dest: ~/.rbenv/plugins/ruby-build\n        - name: results\n          debug: var=RESULT.results\n\n        - name: install rbenv and ruby\n          shell: '{{ item.cmd }}'\n          register: RESULT\n          with_items:\n            - cmd: echo 'export PATH=\"$HOME/.rbenv/bin:$PATH\"' >> ~/.bash_profile\n            - cmd: echo 'eval \"$(rbenv init -)\"' >> ~/.bash_profile\n            - cmd: source ~/.bash_profile; rbenv -v\n            - cmd: source ~/.bash_profile; rbenv install '{{ ruby_ver }}'\n            - cmd: source ~/.bash_profile; rbenv rehash\n            - cmd: source ~/.bash_profile; rbenv global '{{ ruby_ver }}'\n            - cmd: source ~/.bash_profile; rbenv rehash\n            - cmd: source ~/.bash_profile; ruby -v\n        - name: results\n          debug: var=RESULT.results\n\n#  Please remove the following comment '#' when you want to do, for example, `gem install Serverspec` using rbenv.\n#        - name: install serverspec and ansiblespec\n#          shell: '{{ item.cmd }}'\n#          register: RESULT\n#          with_items:\n#            - cmd: source ~/.bash_profile; gem install serverspec\n#            - cmd: source ~/.bash_profile; gem install ansible_spec\n#        - name: results\n#          debug: var=RESULT.results\n\n        - debug: msg=\"---------- block end   ----------\"\n      when: rbenv_install.rc == 1\n```\n\n\u4ee5\u4e0b\u306fVagrant\u74b0\u5883\u306e\u5834\u5408\n---\n`vagrant up`\u306b\u3066CentOS6\u306eServer\u8d77\u52d5\u3068Ansible provisoner\u3092\u5229\u7528\u3057\u3066rbenv\u74b0\u5883\u306e\u69cb\u7bc9\u3068\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\u306a\u304a\u3001box\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u3064\u3044\u3066\u306f\u3001\u9069\u6642\u81ea\u74b0\u5883\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u7f6e\u304d\u63db\u3048\u3066\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\n\nVagrantfile\n\n``` Vagrantfile\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVagrant.configure(2) do |config|\n  # Every Vagrant development environment requires a box. You can search for\n  # boxes at https://atlas.hashicorp.com/search.\n  # Please replace it with a BOX name of CentOS6 for one's own 32bit when your host is 32bit machine.\n  config.vm.box = \"geerlingguy/centos6\"\n\n  # Add ansible provisioner\n  config.vm.provision \"ansible\" do |ansible|\n    ansible.playbook = \"site.yml\"\n  end\nend\n```\n\n##\u3000\u4f7f\u3044\u65b9\n-\u3000OSX\u7b49\u3067Ansible provisoner\u304c\u5229\u7528\u3067\u304d\u308bVagrant\u74b0\u5883\u306e\u5834\u5408\n\u3000\u3000-\u3000\u4e0a\u8a18playbook\u7b49\u8cc7\u6750\u3092\u7528\u610f\u3057\u305f\u4e0a\u3067`vagrant up`\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n-\u3000Ansible\u74b0\u5883\u306e\u307f\u306e\u5834\u5408\n\u3000\u3000-\u3000\u30a4\u30f3\u30d9\u30f3\u30c8\u30ea\u30db\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u5404\u81ea\u7528\u610f\u3057\u3066CentOS6\u30b5\u30fc\u30d0\u306b\u5bfe\u3057\u3066Playbook\u3092\u5b9f\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002`ansible-playbook -i \u30a4\u30f3\u30d9\u30f3\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\u3000site.yml`\n\n## \u4e0a\u8a18\u30d7\u30ec\u30a4\u30d6\u30c3\u30af\u7b49\u306e\u5b9f\u884c\u74b0\u5883\n### Ansible provisioner and Vagrant,Virtulbox Host\n\u3000-\u3000OS\uff1aOSX yosemite\n\u3000-\u3000Virtulbox\uff1a\u30d0\u30fc\u30b8\u30e7\u30f3 5.0.10 r104061\n\u3000-\u3000Vagrant\uff1a Vagrant 1.8.1\n\u3000-\u3000Ansible\uff1a\n\n```\n$ansible --version\nansible 2.1.0 (devel c600ab81ee) last updated 2016/04/20 11:11:25 (GMT +900)\n  lib/ansible/modules/core: (detached HEAD 98322a777f) last updated 2016/04/20 11:11:54 (GMT +900)\n  lib/ansible/modules/extras: (detached HEAD 1aecfc1e19) last updated 2016/04/20 11:11:55 (GMT +900)\n  config file = \n  configured module search path = Default w/o overrides\n```\n\n### rbenv install Server\n-\u3000OS: CentOS6.8\n", "tags": ["rbenv", "CentOS", "Ansible", "vagrant", "Ruby"]}