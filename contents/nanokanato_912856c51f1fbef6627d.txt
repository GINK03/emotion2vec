{"tags": ["Unity", "OpenCVforUnity", "OpenCV", "C#"], "context": "\u3053\u306e\u30da\u30fc\u30b8\u3067\u306fOpenCV\u3092Unity\u3067\u6271\u3046\u305f\u3081\u306eAsset\u300cOpenCV for Unity\u300d\u3092\u5229\u7528\u3057\u305f\u30ab\u30e1\u30e9\u306e\u6a5f\u80fd\u3067\u3001\u753b\u9762\u306b\u6620\u50cf\u3092\u63cf\u753b\u3059\u308b\u307e\u3067\u306e\u624b\u9806\u3092\u30e1\u30e2\u3057\u3066\u3044\u307e\u3059\u3002\n\u3053\u3061\u3089\u306fUnity5.4.1\u3067\u4f5c\u696d\u3057\u307e\u3057\u305f\u3002\n\u203b\u4fee\u6b63\u70b9\u3001\u6539\u5584\u70b9\u3042\u308a\u307e\u3057\u305f\u3089\u30b3\u30e1\u30f3\u30c8\u307e\u305f\u306f\u7de8\u96c6\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u3088\u308d\u3057\u304f\u304a\u9858\u3044\u3057\u307e\u3059\u3002\nMacBookPro OS.Sierra\u306b\u4ed8\u3044\u3066\u3044\u308bWeb\u30ab\u30e1\u30e9\uff08\u30a4\u30f3\u30ab\u30e1\uff09\u3067\u64ae\u5f71\u3057\u305f\u3082\u306e\u3002\n\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067Mat\u3067\u53d6\u5f97\u3057\u63cf\u753b\u3057\u3066\u3044\u308b\u306e\u3067\u30d5\u30a3\u30eb\u30bf\u3084\u8a8d\u8b58\u306a\u3069\u306b\u8ee2\u7528\u3082\u53ef\u80fd\u3002\n\n\n\u958b\u767a\u6e96\u5099\n\n\u30ab\u30e1\u30e9\u6a5f\u80fd\u3092\u4f7f\u3044\u307e\u3059\u306e\u3067\u30ab\u30e1\u30e9\u3092\u7528\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\n\u30ab\u30e1\u30e9\u4ed8\u304dPC\u3001USB\u3067\u5916\u4ed8\u3051\u306eWeb\u30ab\u30e1\u30e9\u3001\u5b9f\u6a5f\u3067\u3042\u308c\u3070\u30b9\u30de\u30db\u7b49\u306e\u30ab\u30e1\u30e9\u3067\u3082\u53ef\u80fd\u3067\u3059\u3002\n\n\n\u958b\u767a\u3092\u884c\u3046\u305f\u3081\u306bAsset\u3092Import\u3057\u3066\u304f\u3060\u3055\u3044\u3002OpenCVForUnity\u3092Import\u3059\u308b\u307e\u3067\n\n\n\nScript\u306e\u8ffd\u52a0\nOpenCV\u3067\u306f\u753b\u50cf\u3092Mat\u3068\u3044\u3046\u5f62\u5f0f\u3067\u51e6\u7406\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u306fWebCamTexture\u3092Mat\u306b\u3057\u305f\u308a\u3001Mat\u3092Texture2D\u306b\u5909\u63db\u3057\u3066\u304f\u308c\u308bCVCameraMat.cs\u3068\u3001Mat\u3092\u53d7\u3051\u53d6\u308a\u52a0\u5de5\u51e6\u7406\u3092\u3057\u305f\u5f8cTexture2D\u3092\u753b\u9762\u306b\u8868\u793a\u3059\u308bSimpleScript.cs\u3092\u7528\u610f\u3057\u307e\u3059\u3002\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3054\u3068\u306b\u4fee\u6b63\u3059\u308b\u306e\u306fSimpleScript.cs\u306b\u306a\u308a\u307e\u3059\u3002\nWebCamTexture\u3068\u306fWeb\u30ab\u30e1\u30e9\u306e\u6620\u50cf\u3092Unity\u3067\u6271\u3048\u308b\u30c6\u30af\u30b9\u30c1\u30e3\u306b\u3057\u305f\u3082\u306e\u3067\u3059\u3002 \u2192 WebCamTexture\u306e\u4f7f\u3044\u65b9(AspectFill)\n\nCVCameraMat.cs\n\u5148\u307b\u3069\u3082\u66f8\u304d\u307e\u3057\u305f\u304c\u3001WebCamTexture\u3092\u521d\u671f\u5316\u3057Mat\u306b\u5909\u63db\u3001\u52a0\u5de5\u5f8c\u306bMat\u3092\u6e21\u3059\u3053\u3068\u3067Texture2D\u3092\u8fd4\u3057\u3066\u304f\u308c\u308b\u30af\u30e9\u30b9\u3067\u3059\u3002\n\u30e1\u30bd\u30c3\u30c9\u5185\u306e\u51e6\u7406\u3084\u5f79\u5272\u306f\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u3066\u304a\u308a\u307e\u3059\u306e\u3067\u4e0d\u660e\u70b9\u304c\u3042\u308c\u3070\u4e0b\u306e\u30b3\u30e1\u30f3\u30c8\u307e\u3067\u3088\u308d\u3057\u304f\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n\npublic\u5909\u6570\u306e\u8aac\u660e\n\n\nrequestDeviceName - \u5e0c\u671b\u306e\u30ab\u30e1\u30e9\u7aef\u672b\u540d\nflipVertical - true\u306e\u6642\u3001\u4e0a\u4e0b\u53cd\u8ee2\u3059\u308b\nflipHorizontal - true\u306e\u6642\u3001\u5de6\u53f3\u53cd\u8ee2\u3059\u308b\nOnInitedEvent - \u521d\u671f\u5316\u5f8c\u306b\u547c\u3076\u30a4\u30d9\u30f3\u30c8\u3092\u8a2d\u5b9a\u3067\u304d\u308b\nOnDisposedEvent - \u7834\u68c4\u5f8c\u306b\u547c\u3076\u30a4\u30d9\u30f3\u30c8\u3092\u8a2d\u5b9a\u3067\u304d\u308b\nrequestWidth - \u5e0c\u671b\u306e\u6a2a\u30b5\u30a4\u30ba\nrequestHeight - \u5e0c\u671b\u306e\u7e26\u30b5\u30a4\u30ba\n\n\n\nrequestWidth,requestHeight\u3067\u6307\u5b9a\u3057\u3066\u3044\u308b\u5e0c\u671b\u306e\u7e26\u30b5\u30a4\u30ba,\u6a2a\u30b5\u30a4\u30ba\u306f\u3001\u30bd\u30fc\u30b9\u5185\u3067\u306f(768,768)\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u30ab\u30e1\u30e9\u6a5f\u5668\u306b\u3088\u308a\u53d7\u3051\u53d6\u308c\u308b\u6bd4\u7387\u304c\u9055\u3046\u306e\u304b\u305d\u308c\u306b\u8fd1\u3044\u5225\u306e\u30b5\u30a4\u30ba\u304c\u53d7\u3051\u53d6\u308c\u307e\u3059\u3002\n\nCVCameraMat.cs\nusing UnityEngine;\nusing System.Collections;\n\nusing System;\nusing OpenCVForUnity;\nusing UnityEngine.Events;\n\npublic class CVCameraMat : MonoBehaviour\n{\n    public string requestDeviceName = null;\n    public bool flipVertical = false;\n    public bool flipHorizontal = false;\n\n    public UnityEvent OnInitedEvent;\n    public UnityEvent OnDisposedEvent;\n\n    public int requestWidth = 768;\n    public int requestHeight = 768;\n\n    private WebCamTexture webCamTexture;\n    private WebCamDevice webCamDevice;\n\n    private Mat rgbaMat;\n    private Mat rotatedRgbaMat;\n    private Color32[] colors;\n    private bool initDone = false;\n    private ScreenOrientation screenOrientation = ScreenOrientation.Unknown;\n\n    /*------------------------------------------*\n     * Default Method\n     *------------------------------------------*/\n    // Use this for initialization\n    void Start()\n    {\n\n    }\n\n    // Update is called once per frame\n    void Update()\n    {\n        if (initDone)\n        {\n            if (screenOrientation != Screen.orientation)\n            {\n                //\u89d2\u5ea6\u304c\u5909\u308f\u3063\u305f\u306e\u3067\u518d\u5ea6\u521d\u671f\u5316\n                Init();\n            }\n        }\n    }\n\n    /*------------------------------------------*\n     * Init Method\n     *------------------------------------------*/\n    //\u8a2d\u5b9a\u305b\u305a\u521d\u671f\u5316\u3092\u958b\u59cb\n    public void Init()\n    {\n        if (OnInitedEvent == null)\n        {\n            OnInitedEvent = new UnityEvent();\n        }\n        if (OnDisposedEvent == null)\n        {\n            OnDisposedEvent = new UnityEvent();\n        }\n        webCamInit ();\n    }\n\n    //\u8a2d\u5b9a\u3057\u3066\u521d\u671f\u5316\u3092\u958b\u59cb\n    public void Init(string deviceName, int requestWidth, int requestHeight)\n    {\n        this.requestDeviceName = deviceName;\n        this.requestWidth = requestWidth;\n        this.requestHeight = requestHeight;\n        Init();\n    }\n\n    //\u521d\u671f\u5316\n    private void webCamInit()\n    {\n        //\u3059\u3067\u306b\u521d\u671f\u5316\u3055\u308c\u3066\u3044\u308b\u6642\u306f\u4e00\u65e6\u89e3\u653e\u3059\u308b\n        if (initDone) {\n            Dispose ();\n        }\n\n        //\u30ab\u30e1\u30e9\u306e\u5e0c\u671b\u304c\u3042\u308b\u304b\u3069\u3046\u304b\u78ba\u8a8d\u3059\u308b\n        if (!String.IsNullOrEmpty (requestDeviceName)) {\n            //\u4f7f\u7528\u3067\u304d\u308b\u30ab\u30e1\u30e9\u3092\u53c2\u7167\u3059\u308b\n            for (int cameraIndex = 0; cameraIndex < WebCamTexture.devices.Length; cameraIndex++) {\n                //\u5e0c\u671b\u306e\u30ab\u30e1\u30e9\u3068\u540c\u3058\u30ab\u30e1\u30e9\u304c\u3042\u3063\u305f\u3089\u305d\u308c\u3092\u4f7f\u7528\u3059\u308b\n                webCamDevice = WebCamTexture.devices [cameraIndex];\n                if (webCamDevice.name == requestDeviceName) {\n                    webCamTexture = new WebCamTexture (requestDeviceName, requestWidth, requestHeight);\n                }\n            }\n        }\n\n        //\u5e0c\u671b\u306e\u30ab\u30e1\u30e9\u304c\u7121\u304b\u3063\u305f\u5834\u5408\n        if (webCamTexture == null) {\n            //\u4e00\u756a\u6700\u521d\u306b\u8a8d\u8b58\u3057\u305f\u30ab\u30e1\u30e9\u3092\u4f7f\u7528\u3059\u308b\n            if (WebCamTexture.devices.Length > 0) {\n                webCamDevice = WebCamTexture.devices [0];\n                webCamTexture = new WebCamTexture (webCamDevice.name, requestWidth, requestHeight);\n            } else {\n                webCamTexture = new WebCamTexture (requestWidth, requestHeight);\n            }\n        }\n\n        //\u30ab\u30e1\u30e9\u306e\u6e96\u5099\u304c\u3067\u304d\u305f\u304b\u3069\u3046\u304b\u78ba\u8a8d\n        if (webCamTexture) {\n            //\u6e96\u5099\u3057\u305f\u30ab\u30e1\u30e9\u304b\u3089\u6620\u50cf\u306e\u53d6\u5f97\u3092\u958b\u59cb\u3059\u308b\n            webCamTexture.Play ();\n\n            //\u6700\u521d\u306e\u64ae\u5f71\u30d5\u30ec\u30fc\u30e0\u3092\u53d6\u5f97\u3059\u308b\u307e\u3067\u30b3\u30eb\u30fc\u30c1\u30f3\u3067\u5f85\u6a5f\n            GameObject coroutineObj = new GameObject(\"waitWebCamTexture\");\n            CVCameraMat coroutine = coroutineObj.AddComponent<CVCameraMat> ();\n            coroutine.StartCoroutine(waitWebCamFrame(coroutineObj));\n        } else {\n            //\u30ab\u30e1\u30e9\u306e\u6e96\u5099\u304c\u3067\u304d\u306a\u304b\u3063\u305f\u306e\u3067\u518d\u5ea6\u521d\u671f\u5316\u3059\u308b\n            webCamInit ();\n        }\n    }\n\n    //Web\u30ab\u30e1\u30e9\u306e\u6700\u521d\u306e\u30d5\u30ec\u30fc\u30e0\u304c\u53d6\u5f97\u3067\u304d\u308b\u307e\u3067\u5f85\u6a5f\n    public IEnumerator waitWebCamFrame(GameObject coroutine)\n    {\n        while (true) {\n            if (webCamTexture) {\n                if (webCamTexture.isPlaying) {\n                    if (webCamTexture.didUpdateThisFrame) {\n                        colors = new Color32[webCamTexture.width * webCamTexture.height];\n                        rgbaMat = new Mat (webCamTexture.height, webCamTexture.width, CvType.CV_8UC4);\n\n                        screenOrientation = Screen.orientation;\n\n                        initDone = true;\n\n                        if (OnInitedEvent != null) {\n                            OnInitedEvent.Invoke ();\n                        }\n\n                        Destroy(coroutine);\n                        break;\n                    }\n                }\n            }\n            yield return new WaitForSeconds (1);\n        }\n    }\n\n    //\u521d\u671f\u5316\u3057\u305f\u304b\u3069\u3046\u304b\n    public bool isInited()\n    {\n        return initDone;\n    }\n\n    //\u7834\u68c4\u51e6\u7406\n    public void Dispose()\n    {\n        initDone = false;\n\n        if (webCamTexture != null)\n        {\n            webCamTexture.Stop();\n            webCamTexture = null;\n        }\n        if (rgbaMat != null)\n        {\n            rgbaMat.Dispose();\n            rgbaMat = null;\n        }\n        if (rotatedRgbaMat != null)\n        {\n            rotatedRgbaMat.Dispose();\n            rotatedRgbaMat = null;\n        }\n        colors = null;\n\n        if (OnDisposedEvent != null)\n            OnDisposedEvent.Invoke();\n    }\n\n    /*------------------------------------------*\n     * WebCamTexture Method\n     *------------------------------------------*/\n    //WebCamTexture\u306e\u64ae\u5f71\u958b\u59cb\n    public void Play()\n    {\n        if (initDone)\n        {\n            webCamTexture.Play();\n        }\n    }\n\n    //WebCamTexture\u306e\u505c\u6b62\n    public void Pause()\n    {\n        if (initDone)\n        {\n            webCamTexture.Pause();\n        }\n    }\n\n    //WebCamTexture\u306e\u64ae\u5f71\u7d42\u4e86\n    public void Stop()\n    {\n        if (initDone)\n        {\n            webCamTexture.Stop();\n        }\n    }\n\n    //WebCamTexture\u304c\u521d\u671f\u5316\u3055\u308c\u3066\u3044\u308b\u304b\n    public bool isPlaying()\n    {\n        if (!initDone)\n        {\n            return false;\n        }\n        return webCamTexture.isPlaying;\n    }\n\n    //WebCamTexture\u3092\u8fd4\u3059\n    public WebCamTexture GetWebCamTexture()\n    {\n        return webCamTexture;\n    }\n\n    //WebCamDevice\u3092\u8fd4\u3059\n    public WebCamDevice GetWebCamDevice()\n    {\n        return webCamDevice;\n    }\n\n    //WebCamTexture\u304c\u6700\u5f8c\u306e\u30d5\u30ec\u30fc\u30e0\u304b\u3089\u66f4\u65b0\u3055\u308c\u3066\u3044\u308b\u304b\u3092\u8fd4\u3059\n    public bool didUpdateThisFrame()\n    {\n        if (!initDone)\n        {\n            return false;\n        }\n        return webCamTexture.didUpdateThisFrame;\n    }\n\n    //WebCamTexture\u3092Mat\u306b\u5909\u63db\u3057\u3066\u8fd4\u3059\n    public Mat GetMat()\n    {\n        if (!initDone || !webCamTexture.isPlaying)\n        {\n            if (rotatedRgbaMat != null)\n            {\n                return rotatedRgbaMat;\n            }\n            else\n            {\n                return rgbaMat;\n            }\n        }\n\n        if (rgbaMat == null)\n        {\n            rgbaMat = new Mat(webCamTexture.height, webCamTexture.width, CvType.CV_8UC4);\n        }\n\n        Utils.webCamTextureToMat(webCamTexture, rgbaMat, colors);\n\n        int flipCode = int.MinValue;\n\n        if (webCamDevice.isFrontFacing)\n        {\n            if (webCamTexture.videoRotationAngle == 0)\n            {\n                flipCode = 1;\n            }\n            else if (webCamTexture.videoRotationAngle == 90)\n            {\n                flipCode = 0;\n            }\n            if (webCamTexture.videoRotationAngle == 180)\n            {\n                flipCode = 0;\n            }\n            else if (webCamTexture.videoRotationAngle == 270)\n            {\n                flipCode = 1;\n            }\n        }\n        else\n        {\n            if (webCamTexture.videoRotationAngle == 180)\n            {\n                flipCode = -1;\n            }\n            else if (webCamTexture.videoRotationAngle == 270)\n            {\n                flipCode = -1;\n            }\n        }\n\n        if (flipVertical)\n        {\n            if (flipCode == int.MinValue)\n            {\n                flipCode = 0;\n            }\n            else if (flipCode == 0)\n            {\n                flipCode = int.MinValue;\n            }\n            else if (flipCode == 1)\n            {\n                flipCode = -1;\n            }\n            else if (flipCode == -1)\n            {\n                flipCode = 1;\n            }\n        }\n\n        if (flipHorizontal)\n        {\n            if (flipCode == int.MinValue)\n            {\n                flipCode = 1;\n            }\n            else if (flipCode == 0)\n            {\n                flipCode = -1;\n            }\n            else if (flipCode == 1)\n            {\n                flipCode = int.MinValue;\n            }\n            else if (flipCode == -1)\n            {\n                flipCode = 0;\n            }\n        }\n\n        if (flipCode > int.MinValue)\n        {\n            Core.flip(rgbaMat, rgbaMat, flipCode);\n        }\n\n\n        if (rotatedRgbaMat != null)\n        {\n\n            using (Mat transposeRgbaMat = rgbaMat.t())\n            {\n                Core.flip(transposeRgbaMat, rotatedRgbaMat, 1);\n            }\n\n            return rotatedRgbaMat;\n        }\n        else\n        {\n            return rgbaMat;\n        }\n    }\n\n    /*------------------------------------------*\n     * OpenCV Support Method\n     *------------------------------------------*/\n    //Mat\u3092Texture2D\u306b\u5909\u63db\u3057\u3066\u53cd\u6620\u3059\u308b\n    public void matToTexture2D(Mat mat, Texture2D texture)\n    {\n        Utils.matToTexture2D (mat, texture, colors);\n    }\n}\n\n\n\nSimpleScript.cs\nCVCameraMat.cs\u3092\u5b9f\u969b\u306b\u4f7f\u7528\u3057\u3066\u3044\u308b\u30af\u30e9\u30b9\u3067\u3059\u3002\n\u4e3b\u306bRawImage\u3078\u63cf\u753b\u3059\u308bTexture2D\u306e\u4f5c\u6210\u3068\u7d10\u4ed8\u3051\u3092\u884c\u306a\u3063\u3066\u3044\u307e\u3059\u3002\nStart()\u3067CVCameraMat\u306e\u521d\u671f\u5316\nOnCVCameraMatInited()\u3067\u521d\u671f\u5316\u7d42\u4e86\u3092\u53d7\u3051\u53d6\u308a\u3001\u53d6\u5f97\u3057\u305fMat\u306b\u5408\u308f\u305b\u305fTexture2D\u306e\u4f5c\u6210\u3068RawImage\u3078\u306e\u7d10\u4ed8\u3051\nUpdate()\u3067Mat\u3092\u53d7\u3051\u53d6\u308a\u52a0\u5de5\u3057\u3066Texture2D\u3078\u66f4\u65b0\n\npublic\u5909\u6570\u306e\u8aac\u660e\n\n\nrawImage - \u30ab\u30e1\u30e9\u6620\u50cf\u3092\u63cf\u753b\u3059\u308bRawImage(Texture2D\u304c\u4f7f\u3048\u308c\u3070\u4fee\u6b63\u53ef)\n\n\n\n\nSimpleScript.cs\nusing UnityEngine;\nusing UnityEngine.UI;\nusing OpenCVForUnity;\n\n[RequireComponent(typeof(CVCameraMat))]\npublic class SimpleScript : MonoBehaviour {\n\n    public RawImage rawImage;\n    private CVCameraMat cvCameraMat;\n    private Texture2D texture;\n    private bool startCVCam = false;\n\n    /*--------------------------------\n     : Default Method\n     --------------------------------*/\n    // Use this for initialization\n    void Start()\n    {\n        Init();\n    }\n\n    // Update is called once per frame\n    void Update()\n    {\n        //\u30ab\u30e1\u30e9\u753b\u50cf\u306e\u8868\u793a\u5148\u304c\u3042\u308b\u304b\u78ba\u8a8d\n        if (rawImage) {\n            //\u30ab\u30e1\u30e9\u306e\u53d6\u5f97\u6e96\u5099\u304c\u3067\u304d\u3066\u3044\u308b\u304b\u78ba\u8a8d\n            if (startCVCam) {\n                //CVCameraMat\u306e\u521d\u671f\u5316\u304c\u7d42\u4e86\u3057\u3066\u3044\u308b\n                if (cvCameraMat) {\n                    //CVCameraMat\u304c\u64ae\u5f71\u4e2d\u304b\u78ba\u8a8d\n                    if (cvCameraMat.isPlaying ()) {\n                        //CVCameraMat\u306e\u30d5\u30ec\u30fc\u30e0\u304c\u66f4\u65b0\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\n                        if (cvCameraMat.didUpdateThisFrame ()) {\n                            //Texture2D\u304c\u521d\u671f\u5316\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\n                            if (texture != null) {\n                                //\u30ab\u30e1\u30e9\u306eMat\u753b\u50cf\u3092\u53d6\u5f97\n                                Mat cvCamMat = cvCameraMat.GetMat ();\n                                //Mat\u304c\u53d6\u5f97\u3067\u304d\u3066\u3044\u308b\u304b\u78ba\u8a8d\n                                if (cvCamMat != null) {\n                                    //Mat\u304c\u7a7a\u306e\u30c7\u30fc\u30bf\u3058\u3083\u306a\u3044\u304b\u78ba\u8a8d\n                                    if (!cvCamMat.empty ()) {\n\n                                        /* \u753b\u50cf\u52a0\u5de5\u958b\u59cb */\n\n\n\n                                        /* \u753b\u50cf\u52a0\u5de5\u7d42\u4e86 */\n\n                                        //\u52a0\u5de5\u3057\u305fMat\u304c\u5b58\u5728\u3059\u308b\u304b\u78ba\u8a8d\n                                        if (cvCamMat != null) {\n                                            //Mat\u304c\u7a7a\u306e\u30c7\u30fc\u30bf\u3058\u3083\u306a\u3044\u304b\u78ba\u8a8d\n                                            if (!cvCamMat.empty ()) {\n                                                try {\n                                                    //cvCamMat\u3092Texture2D\u306b\u5909\u63db\u3057\u3066\u53cd\u6620\u3059\u308b\n                                                    cvCameraMat.matToTexture2D (cvCamMat, texture);\n                                                } catch (System.ArgumentException e) {\n                                                    Debug.Log (e.Message);\n                                                } catch {\n                                                    Debug.Log (\"OtherError\");\n                                                }\n                                            }\n                                        }\n                                    }\n                                    cvCamMat = null;\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        } else {\n            Debug.LogError(\"NotFound:rawImage\");\n        }\n    }\n\n    /*--------------------------------\n     : Load Method\n     --------------------------------*/\n    //CVCameraMat\u3092\u8d77\u52d5\u3055\u305b\u308b\n    private void Init()\n    {\n        startCVCam = false;\n        //\u30ab\u30e1\u30e9\u753b\u50cf\u306e\u8868\u793a\u5148\u304c\u3042\u308b\u304b\u78ba\u8a8d\n        if (rawImage) {\n            //cvCameraMat\u3092\u53d6\u5f97\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u53d6\u5f97\n            if (cvCameraMat == null) {\n                cvCameraMat = GetComponent<CVCameraMat> ();\n            }\n            if (cvCameraMat != null) {\n                if (cvCameraMat.isInited ()) {\n                    //\u521d\u671f\u5316\u3057\u3066\u3044\u308b\n                    //\u30ab\u30e1\u30e9\u306e\u72b6\u614b\u3092\u78ba\u8a8d\n                    if (!cvCameraMat.isPlaying ()) {\n                        //\u30ab\u30e1\u30e9\u306e\u64ae\u5f71\u304c\u6b62\u307e\u3063\u3066\u3044\u308b\n                        //\u64ae\u5f71\u958b\u59cb\n                        cvCameraMat.Play ();\n                    } else {\n                        //\u30ab\u30e1\u30e9\u306f\u64ae\u5f71\u4e2d\n                        //Texture2D\u304c\u521d\u671f\u5316\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\n                        if (texture != null) {\n                            //\u521d\u671f\u5316\u3055\u308c\u3066\u3044\u308b\n                            startCVCam = true;\n                        } else {\n                            //\u521d\u671f\u5316\u3055\u308c\u3066\u3044\u306a\u3044\n                            //Texture2D\u3092\u521d\u671f\u5316\n                            OnCVCameraMatInited();\n                        }\n                    }\n                } else {\n                    //\u521d\u671f\u5316\u3057\u3066\u3044\u306a\u3044\n                    //\u521d\u671f\u5316\u3057\u3066\u8d77\u52d5\n                    cvCameraMat.Init();\n                }\n            }\n        } else {\n            Debug.LogError(\"NotFound:rawImage\");\n        }\n    }\n\n    /*--------------------------------\n     : CVCameraMat Method\n     --------------------------------*/\n    //CVCameraMat\u304c\u521d\u671f\u5316\u3055\u308c\u305f\u6642\n    public void OnCVCameraMatInited()\n    {\n        if (rawImage) { \n            //CVMat\u8aad\u307f\u8fbc\u307f\u5f85\u3061\n            bool loadMatFlag = false;\n            Mat cvCamMat = new Mat ();\n            while (!loadMatFlag) {\n                if (cvCameraMat) {\n                    if (cvCameraMat.isPlaying ()) {\n                        if (cvCameraMat.didUpdateThisFrame ()) {\n                            cvCamMat = cvCameraMat.GetMat ();\n                            if (cvCamMat != null) {\n                                if (!cvCamMat.empty ()) {\n                                    loadMatFlag = true;\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n            //CVMat\u3092Texture\u306b\u30bb\u30c3\u30c8\n            if (loadMatFlag) {\n                //Texture2D\u306e\u4f5c\u6210\n                texture = new Texture2D ((int)cvCamMat.cols (), (int)cvCamMat.rows (), TextureFormat.RGBA32, false);\n                if (texture) {\n                    //RawImage\u3078Texture2D\u3092\u8a2d\u5b9a\uff08\u8868\u793a\u3055\u308c\u306a\u3044\u6642\u306frawImage.material.mainTexture\uff09\n                    rawImage.texture = texture;\n                    startCVCam = true;\n                } else {\n                    Init ();\n                }\n            }\n        } else {\n            Debug.LogError(\"NotFound:rawImage\");\n        }\n    }\n\n    //CVCameraMat\u304c\u89e3\u653e\u3055\u308c\u305f\u6642\n    public void OnCVCameraMatDisposed()\n    {\n        startCVCam = false;\n        texture = null;\n    }\n}\n\n\n\nGameObject\u306e\u69cb\u6210\n\u4e00\u5fdc\u52d5\u4f5c\u3059\u308b\u72b6\u614b\u306eGameObject\u306e\u69cb\u6210\u304c\u3069\u3046\u306a\u3063\u3066\u3044\u308b\u304b\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\n\u30b5\u30f3\u30d7\u30eb\u3068\u3057\u3066Unity2D\u3067\u52d5\u4f5c\u3055\u305b\u3066\u3044\u307e\u3059\u3002\nCanvas,Camera,EventSystem\u306f\u6a19\u6e96\u306e\u307e\u307e\u3067\u3059\u3002\n\nCameraMask\u306fRectMask2D\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u8ffd\u52a0\u3057\u305fGameObject\u3067\u3059\u3002\n\u30ab\u30e1\u30e9\u6620\u50cf\u3092\u753b\u9762\u306b\u8868\u793a\u3057\u305f\u3044\u30b5\u30a4\u30ba\u3067\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nCameraImage\u306f\u30ab\u30e1\u30e9\u6620\u50cf\u3092\u63cf\u753b\u3059\u308bRawImage\u3067\u3059\u3002\n\u4eca\u56de\u4f7f\u3063\u305f\u30ab\u30e1\u30e9\u306f\u6a2a\u9577\u306b\u53d6\u5f97\u3067\u304d\u308b\u3082\u306e\u3060\u3063\u305f\u306e\u3067\u7e26\u30b5\u30a4\u30ba\u306fCameraMask\u3068\u540c\u3058\u30b5\u30a4\u30ba\u3067\u6a2a\u30b5\u30a4\u30ba\u3092\u5c11\u3057\u9577\u304f\u3057\u307e\u3057\u305f\u3002\n\nCameraImage\u306bCVCameraMat.cs\u3068SimpleScript.cs\u3092\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nCVCameraMat.cs\u306eOnInitedEvent\u3068OnDisposedEvent\u306e\u8a2d\u5b9a\u306fSimpleScript.cs\u3067\u901a\u77e5\u3092\u53d7\u3051\u53d6\u308b\u306e\u306b\u5fc5\u9808\u3067\u3059\u3002\nSimpleScript.cs\u306eRawImage\u306f\u81ea\u8eab\u3067\u3042\u308bCameraImage\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\u3053\u306e\u30da\u30fc\u30b8\u3067\u306fOpenCV\u3092Unity\u3067\u6271\u3046\u305f\u3081\u306eAsset\u300c[OpenCV for Unity](http://u3d.as/915)\u300d\u3092\u5229\u7528\u3057\u305f\u30ab\u30e1\u30e9\u306e\u6a5f\u80fd\u3067\u3001\u753b\u9762\u306b\u6620\u50cf\u3092\u63cf\u753b\u3059\u308b\u307e\u3067\u306e\u624b\u9806\u3092\u30e1\u30e2\u3057\u3066\u3044\u307e\u3059\u3002\n\u3053\u3061\u3089\u306fUnity5.4.1\u3067\u4f5c\u696d\u3057\u307e\u3057\u305f\u3002\n\n\u203b\u4fee\u6b63\u70b9\u3001\u6539\u5584\u70b9\u3042\u308a\u307e\u3057\u305f\u3089\u30b3\u30e1\u30f3\u30c8\u307e\u305f\u306f\u7de8\u96c6\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u3088\u308d\u3057\u304f\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n\nMacBookPro OS.Sierra\u306b\u4ed8\u3044\u3066\u3044\u308bWeb\u30ab\u30e1\u30e9\uff08\u30a4\u30f3\u30ab\u30e1\uff09\u3067\u64ae\u5f71\u3057\u305f\u3082\u306e\u3002\n\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067Mat\u3067\u53d6\u5f97\u3057\u63cf\u753b\u3057\u3066\u3044\u308b\u306e\u3067\u30d5\u30a3\u30eb\u30bf\u3084\u8a8d\u8b58\u306a\u3069\u306b\u8ee2\u7528\u3082\u53ef\u80fd\u3002\n<img width=\"240\" alt=\"Game\" src=\"https://qiita-image-store.s3.amazonaws.com/0/82938/e4c9b047-7cdc-14d0-96b7-42a5caf63996.png\">\n\n#\u958b\u767a\u6e96\u5099\n- \u30ab\u30e1\u30e9\u6a5f\u80fd\u3092\u4f7f\u3044\u307e\u3059\u306e\u3067\u30ab\u30e1\u30e9\u3092\u7528\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n    - \u30ab\u30e1\u30e9\u4ed8\u304dPC\u3001USB\u3067\u5916\u4ed8\u3051\u306eWeb\u30ab\u30e1\u30e9\u3001\u5b9f\u6a5f\u3067\u3042\u308c\u3070\u30b9\u30de\u30db\u7b49\u306e\u30ab\u30e1\u30e9\u3067\u3082\u53ef\u80fd\u3067\u3059\u3002\n- \u958b\u767a\u3092\u884c\u3046\u305f\u3081\u306bAsset\u3092Import\u3057\u3066\u304f\u3060\u3055\u3044\u3002<br>[OpenCVForUnity\u3092Import\u3059\u308b\u307e\u3067](http://qiita.com/nanokanato/items/acc7fa6927b5a71755c1)\n\n#Script\u306e\u8ffd\u52a0\nOpenCV\u3067\u306f\u753b\u50cf\u3092Mat\u3068\u3044\u3046\u5f62\u5f0f\u3067\u51e6\u7406\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u306fWebCamTexture\u3092Mat\u306b\u3057\u305f\u308a\u3001Mat\u3092Texture2D\u306b\u5909\u63db\u3057\u3066\u304f\u308c\u308bCVCameraMat.cs\u3068\u3001Mat\u3092\u53d7\u3051\u53d6\u308a\u52a0\u5de5\u51e6\u7406\u3092\u3057\u305f\u5f8cTexture2D\u3092\u753b\u9762\u306b\u8868\u793a\u3059\u308bSimpleScript.cs\u3092\u7528\u610f\u3057\u307e\u3059\u3002\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3054\u3068\u306b\u4fee\u6b63\u3059\u308b\u306e\u306fSimpleScript.cs\u306b\u306a\u308a\u307e\u3059\u3002\n\nWebCamTexture\u3068\u306fWeb\u30ab\u30e1\u30e9\u306e\u6620\u50cf\u3092Unity\u3067\u6271\u3048\u308b\u30c6\u30af\u30b9\u30c1\u30e3\u306b\u3057\u305f\u3082\u306e\u3067\u3059\u3002 \u2192 [WebCamTexture\u306e\u4f7f\u3044\u65b9(AspectFill)](http://qiita.com/nanokanato/items/5ce2b2d6822789b51988)\n\n###CVCameraMat.cs\n\u5148\u307b\u3069\u3082\u66f8\u304d\u307e\u3057\u305f\u304c\u3001WebCamTexture\u3092\u521d\u671f\u5316\u3057Mat\u306b\u5909\u63db\u3001\u52a0\u5de5\u5f8c\u306bMat\u3092\u6e21\u3059\u3053\u3068\u3067Texture2D\u3092\u8fd4\u3057\u3066\u304f\u308c\u308b\u30af\u30e9\u30b9\u3067\u3059\u3002\n\u30e1\u30bd\u30c3\u30c9\u5185\u306e\u51e6\u7406\u3084\u5f79\u5272\u306f\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u3066\u304a\u308a\u307e\u3059\u306e\u3067\u4e0d\u660e\u70b9\u304c\u3042\u308c\u3070\u4e0b\u306e\u30b3\u30e1\u30f3\u30c8\u307e\u3067\u3088\u308d\u3057\u304f\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n\n- public\u5909\u6570\u306e\u8aac\u660e\n    - requestDeviceName - \u5e0c\u671b\u306e\u30ab\u30e1\u30e9\u7aef\u672b\u540d\n    - flipVertical - true\u306e\u6642\u3001\u4e0a\u4e0b\u53cd\u8ee2\u3059\u308b\n    - flipHorizontal - true\u306e\u6642\u3001\u5de6\u53f3\u53cd\u8ee2\u3059\u308b\n    - OnInitedEvent - \u521d\u671f\u5316\u5f8c\u306b\u547c\u3076\u30a4\u30d9\u30f3\u30c8\u3092\u8a2d\u5b9a\u3067\u304d\u308b\n    - OnDisposedEvent - \u7834\u68c4\u5f8c\u306b\u547c\u3076\u30a4\u30d9\u30f3\u30c8\u3092\u8a2d\u5b9a\u3067\u304d\u308b\n    - requestWidth - \u5e0c\u671b\u306e\u6a2a\u30b5\u30a4\u30ba\n    - requestHeight - \u5e0c\u671b\u306e\u7e26\u30b5\u30a4\u30ba\n\nrequestWidth,requestHeight\u3067\u6307\u5b9a\u3057\u3066\u3044\u308b\u5e0c\u671b\u306e\u7e26\u30b5\u30a4\u30ba,\u6a2a\u30b5\u30a4\u30ba\u306f\u3001\u30bd\u30fc\u30b9\u5185\u3067\u306f(768,768)\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u30ab\u30e1\u30e9\u6a5f\u5668\u306b\u3088\u308a\u53d7\u3051\u53d6\u308c\u308b\u6bd4\u7387\u304c\u9055\u3046\u306e\u304b\u305d\u308c\u306b\u8fd1\u3044\u5225\u306e\u30b5\u30a4\u30ba\u304c\u53d7\u3051\u53d6\u308c\u307e\u3059\u3002\n\n```csharp:CVCameraMat.cs\nusing UnityEngine;\nusing System.Collections;\n\nusing System;\nusing OpenCVForUnity;\nusing UnityEngine.Events;\n\npublic class CVCameraMat : MonoBehaviour\n{\n    public string requestDeviceName = null;\n    public bool flipVertical = false;\n    public bool flipHorizontal = false;\n\n    public UnityEvent OnInitedEvent;\n    public UnityEvent OnDisposedEvent;\n\n    public int requestWidth = 768;\n    public int requestHeight = 768;\n\n    private WebCamTexture webCamTexture;\n    private WebCamDevice webCamDevice;\n\n    private Mat rgbaMat;\n    private Mat rotatedRgbaMat;\n    private Color32[] colors;\n    private bool initDone = false;\n    private ScreenOrientation screenOrientation = ScreenOrientation.Unknown;\n\n    /*------------------------------------------*\n     * Default Method\n     *------------------------------------------*/\n    // Use this for initialization\n    void Start()\n    {\n\n    }\n\n    // Update is called once per frame\n    void Update()\n    {\n        if (initDone)\n        {\n            if (screenOrientation != Screen.orientation)\n            {\n                //\u89d2\u5ea6\u304c\u5909\u308f\u3063\u305f\u306e\u3067\u518d\u5ea6\u521d\u671f\u5316\n\t\t\t\tInit();\n            }\n        }\n    }\n\n    /*------------------------------------------*\n     * Init Method\n     *------------------------------------------*/\n    //\u8a2d\u5b9a\u305b\u305a\u521d\u671f\u5316\u3092\u958b\u59cb\n    public void Init()\n    {\n        if (OnInitedEvent == null)\n        {\n            OnInitedEvent = new UnityEvent();\n        }\n        if (OnDisposedEvent == null)\n        {\n            OnDisposedEvent = new UnityEvent();\n        }\n\t\twebCamInit ();\n    }\n\n    //\u8a2d\u5b9a\u3057\u3066\u521d\u671f\u5316\u3092\u958b\u59cb\n    public void Init(string deviceName, int requestWidth, int requestHeight)\n    {\n        this.requestDeviceName = deviceName;\n        this.requestWidth = requestWidth;\n        this.requestHeight = requestHeight;\n        Init();\n    }\n\n    //\u521d\u671f\u5316\n    private void webCamInit()\n    {\n\t\t//\u3059\u3067\u306b\u521d\u671f\u5316\u3055\u308c\u3066\u3044\u308b\u6642\u306f\u4e00\u65e6\u89e3\u653e\u3059\u308b\n\t\tif (initDone) {\n\t\t\tDispose ();\n\t\t}\n\n\t\t//\u30ab\u30e1\u30e9\u306e\u5e0c\u671b\u304c\u3042\u308b\u304b\u3069\u3046\u304b\u78ba\u8a8d\u3059\u308b\n\t\tif (!String.IsNullOrEmpty (requestDeviceName)) {\n\t\t\t//\u4f7f\u7528\u3067\u304d\u308b\u30ab\u30e1\u30e9\u3092\u53c2\u7167\u3059\u308b\n\t\t\tfor (int cameraIndex = 0; cameraIndex < WebCamTexture.devices.Length; cameraIndex++) {\n\t\t\t\t//\u5e0c\u671b\u306e\u30ab\u30e1\u30e9\u3068\u540c\u3058\u30ab\u30e1\u30e9\u304c\u3042\u3063\u305f\u3089\u305d\u308c\u3092\u4f7f\u7528\u3059\u308b\n\t\t\t\twebCamDevice = WebCamTexture.devices [cameraIndex];\n\t\t\t\tif (webCamDevice.name == requestDeviceName) {\n\t\t\t\t\twebCamTexture = new WebCamTexture (requestDeviceName, requestWidth, requestHeight);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t//\u5e0c\u671b\u306e\u30ab\u30e1\u30e9\u304c\u7121\u304b\u3063\u305f\u5834\u5408\n\t\tif (webCamTexture == null) {\n\t\t\t//\u4e00\u756a\u6700\u521d\u306b\u8a8d\u8b58\u3057\u305f\u30ab\u30e1\u30e9\u3092\u4f7f\u7528\u3059\u308b\n\t\t\tif (WebCamTexture.devices.Length > 0) {\n\t\t\t\twebCamDevice = WebCamTexture.devices [0];\n\t\t\t\twebCamTexture = new WebCamTexture (webCamDevice.name, requestWidth, requestHeight);\n\t\t\t} else {\n\t\t\t\twebCamTexture = new WebCamTexture (requestWidth, requestHeight);\n\t\t\t}\n\t\t}\n\n        //\u30ab\u30e1\u30e9\u306e\u6e96\u5099\u304c\u3067\u304d\u305f\u304b\u3069\u3046\u304b\u78ba\u8a8d\n\t\tif (webCamTexture) {\n\t\t\t//\u6e96\u5099\u3057\u305f\u30ab\u30e1\u30e9\u304b\u3089\u6620\u50cf\u306e\u53d6\u5f97\u3092\u958b\u59cb\u3059\u308b\n\t\t\twebCamTexture.Play ();\n\n\t\t\t//\u6700\u521d\u306e\u64ae\u5f71\u30d5\u30ec\u30fc\u30e0\u3092\u53d6\u5f97\u3059\u308b\u307e\u3067\u30b3\u30eb\u30fc\u30c1\u30f3\u3067\u5f85\u6a5f\n\t\t\tGameObject coroutineObj = new GameObject(\"waitWebCamTexture\");\n\t\t\tCVCameraMat coroutine = coroutineObj.AddComponent<CVCameraMat> ();\n\t\t\tcoroutine.StartCoroutine(waitWebCamFrame(coroutineObj));\n\t\t} else {\n\t\t\t//\u30ab\u30e1\u30e9\u306e\u6e96\u5099\u304c\u3067\u304d\u306a\u304b\u3063\u305f\u306e\u3067\u518d\u5ea6\u521d\u671f\u5316\u3059\u308b\n\t\t\twebCamInit ();\n\t\t}\n    }\n\n\t//Web\u30ab\u30e1\u30e9\u306e\u6700\u521d\u306e\u30d5\u30ec\u30fc\u30e0\u304c\u53d6\u5f97\u3067\u304d\u308b\u307e\u3067\u5f85\u6a5f\n\tpublic IEnumerator waitWebCamFrame(GameObject coroutine)\n\t{\n\t\twhile (true) {\n\t\t\tif (webCamTexture) {\n\t\t\t\tif (webCamTexture.isPlaying) {\n\t\t\t\t\tif (webCamTexture.didUpdateThisFrame) {\n\t\t\t\t\t\tcolors = new Color32[webCamTexture.width * webCamTexture.height];\n\t\t\t\t\t\trgbaMat = new Mat (webCamTexture.height, webCamTexture.width, CvType.CV_8UC4);\n\n\t\t\t\t\t\tscreenOrientation = Screen.orientation;\n\n\t\t\t\t\t\tinitDone = true;\n\n\t\t\t\t\t\tif (OnInitedEvent != null) {\n\t\t\t\t\t\t\tOnInitedEvent.Invoke ();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tDestroy(coroutine);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tyield return new WaitForSeconds (1);\n\t\t}\n\t}\n\n    //\u521d\u671f\u5316\u3057\u305f\u304b\u3069\u3046\u304b\n    public bool isInited()\n    {\n        return initDone;\n    }\n\n    //\u7834\u68c4\u51e6\u7406\n    public void Dispose()\n    {\n        initDone = false;\n\n        if (webCamTexture != null)\n        {\n            webCamTexture.Stop();\n            webCamTexture = null;\n        }\n        if (rgbaMat != null)\n        {\n            rgbaMat.Dispose();\n            rgbaMat = null;\n        }\n        if (rotatedRgbaMat != null)\n        {\n            rotatedRgbaMat.Dispose();\n            rotatedRgbaMat = null;\n        }\n        colors = null;\n\n        if (OnDisposedEvent != null)\n            OnDisposedEvent.Invoke();\n    }\n\n    /*------------------------------------------*\n     * WebCamTexture Method\n     *------------------------------------------*/\n    //WebCamTexture\u306e\u64ae\u5f71\u958b\u59cb\n    public void Play()\n    {\n        if (initDone)\n        {\n            webCamTexture.Play();\n        }\n    }\n\n    //WebCamTexture\u306e\u505c\u6b62\n    public void Pause()\n    {\n        if (initDone)\n        {\n            webCamTexture.Pause();\n        }\n    }\n\n    //WebCamTexture\u306e\u64ae\u5f71\u7d42\u4e86\n    public void Stop()\n    {\n        if (initDone)\n        {\n            webCamTexture.Stop();\n        }\n    }\n\n    //WebCamTexture\u304c\u521d\u671f\u5316\u3055\u308c\u3066\u3044\u308b\u304b\n    public bool isPlaying()\n    {\n        if (!initDone)\n        {\n            return false;\n        }\n        return webCamTexture.isPlaying;\n    }\n\n    //WebCamTexture\u3092\u8fd4\u3059\n    public WebCamTexture GetWebCamTexture()\n    {\n        return webCamTexture;\n    }\n\n    //WebCamDevice\u3092\u8fd4\u3059\n    public WebCamDevice GetWebCamDevice()\n    {\n        return webCamDevice;\n    }\n\n    //WebCamTexture\u304c\u6700\u5f8c\u306e\u30d5\u30ec\u30fc\u30e0\u304b\u3089\u66f4\u65b0\u3055\u308c\u3066\u3044\u308b\u304b\u3092\u8fd4\u3059\n    public bool didUpdateThisFrame()\n    {\n        if (!initDone)\n        {\n            return false;\n        }\n        return webCamTexture.didUpdateThisFrame;\n    }\n\n    //WebCamTexture\u3092Mat\u306b\u5909\u63db\u3057\u3066\u8fd4\u3059\n    public Mat GetMat()\n    {\n        if (!initDone || !webCamTexture.isPlaying)\n        {\n            if (rotatedRgbaMat != null)\n            {\n                return rotatedRgbaMat;\n            }\n            else\n            {\n                return rgbaMat;\n            }\n        }\n\n        if (rgbaMat == null)\n        {\n            rgbaMat = new Mat(webCamTexture.height, webCamTexture.width, CvType.CV_8UC4);\n        }\n\n        Utils.webCamTextureToMat(webCamTexture, rgbaMat, colors);\n\n        int flipCode = int.MinValue;\n\n        if (webCamDevice.isFrontFacing)\n        {\n            if (webCamTexture.videoRotationAngle == 0)\n            {\n                flipCode = 1;\n            }\n            else if (webCamTexture.videoRotationAngle == 90)\n            {\n                flipCode = 0;\n            }\n            if (webCamTexture.videoRotationAngle == 180)\n            {\n                flipCode = 0;\n            }\n            else if (webCamTexture.videoRotationAngle == 270)\n            {\n                flipCode = 1;\n            }\n        }\n        else\n        {\n            if (webCamTexture.videoRotationAngle == 180)\n            {\n                flipCode = -1;\n            }\n            else if (webCamTexture.videoRotationAngle == 270)\n            {\n                flipCode = -1;\n            }\n        }\n\n        if (flipVertical)\n        {\n            if (flipCode == int.MinValue)\n            {\n                flipCode = 0;\n            }\n            else if (flipCode == 0)\n            {\n                flipCode = int.MinValue;\n            }\n            else if (flipCode == 1)\n            {\n                flipCode = -1;\n            }\n            else if (flipCode == -1)\n            {\n                flipCode = 1;\n            }\n        }\n\n        if (flipHorizontal)\n        {\n            if (flipCode == int.MinValue)\n            {\n                flipCode = 1;\n            }\n            else if (flipCode == 0)\n            {\n                flipCode = -1;\n            }\n            else if (flipCode == 1)\n            {\n                flipCode = int.MinValue;\n            }\n            else if (flipCode == -1)\n            {\n                flipCode = 0;\n            }\n        }\n\n        if (flipCode > int.MinValue)\n        {\n            Core.flip(rgbaMat, rgbaMat, flipCode);\n        }\n\n\n        if (rotatedRgbaMat != null)\n        {\n\n            using (Mat transposeRgbaMat = rgbaMat.t())\n            {\n                Core.flip(transposeRgbaMat, rotatedRgbaMat, 1);\n            }\n\n            return rotatedRgbaMat;\n        }\n        else\n        {\n            return rgbaMat;\n        }\n    }\n\n\t/*------------------------------------------*\n     * OpenCV Support Method\n     *------------------------------------------*/\n\t//Mat\u3092Texture2D\u306b\u5909\u63db\u3057\u3066\u53cd\u6620\u3059\u308b\n\tpublic void matToTexture2D(Mat mat, Texture2D texture)\n\t{\n\t\tUtils.matToTexture2D (mat, texture, colors);\n\t}\n}\n```\n\n###SimpleScript.cs\nCVCameraMat.cs\u3092\u5b9f\u969b\u306b\u4f7f\u7528\u3057\u3066\u3044\u308b\u30af\u30e9\u30b9\u3067\u3059\u3002\n\u4e3b\u306bRawImage\u3078\u63cf\u753b\u3059\u308bTexture2D\u306e\u4f5c\u6210\u3068\u7d10\u4ed8\u3051\u3092\u884c\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\nStart()\u3067CVCameraMat\u306e\u521d\u671f\u5316\nOnCVCameraMatInited()\u3067\u521d\u671f\u5316\u7d42\u4e86\u3092\u53d7\u3051\u53d6\u308a\u3001\u53d6\u5f97\u3057\u305fMat\u306b\u5408\u308f\u305b\u305fTexture2D\u306e\u4f5c\u6210\u3068RawImage\u3078\u306e\u7d10\u4ed8\u3051\nUpdate()\u3067Mat\u3092\u53d7\u3051\u53d6\u308a\u52a0\u5de5\u3057\u3066Texture2D\u3078\u66f4\u65b0\n\n- public\u5909\u6570\u306e\u8aac\u660e\n    - rawImage - \u30ab\u30e1\u30e9\u6620\u50cf\u3092\u63cf\u753b\u3059\u308bRawImage(Texture2D\u304c\u4f7f\u3048\u308c\u3070\u4fee\u6b63\u53ef)\n\n```csharp:SimpleScript.cs\nusing UnityEngine;\nusing UnityEngine.UI;\nusing OpenCVForUnity;\n\n[RequireComponent(typeof(CVCameraMat))]\npublic class SimpleScript : MonoBehaviour {\n\n    public RawImage rawImage;\n\tprivate CVCameraMat cvCameraMat;\n    private Texture2D texture;\n\tprivate bool startCVCam = false;\n\n    /*--------------------------------\n     : Default Method\n     --------------------------------*/\n    // Use this for initialization\n    void Start()\n    {\n\t\tInit();\n    }\n\t\t\n    // Update is called once per frame\n    void Update()\n\t{\n\t\t//\u30ab\u30e1\u30e9\u753b\u50cf\u306e\u8868\u793a\u5148\u304c\u3042\u308b\u304b\u78ba\u8a8d\n\t\tif (rawImage) {\n\t\t\t//\u30ab\u30e1\u30e9\u306e\u53d6\u5f97\u6e96\u5099\u304c\u3067\u304d\u3066\u3044\u308b\u304b\u78ba\u8a8d\n\t\t\tif (startCVCam) {\n\t\t\t\t//CVCameraMat\u306e\u521d\u671f\u5316\u304c\u7d42\u4e86\u3057\u3066\u3044\u308b\n\t\t\t\tif (cvCameraMat) {\n\t\t\t\t\t//CVCameraMat\u304c\u64ae\u5f71\u4e2d\u304b\u78ba\u8a8d\n\t\t\t\t\tif (cvCameraMat.isPlaying ()) {\n\t\t\t\t\t\t//CVCameraMat\u306e\u30d5\u30ec\u30fc\u30e0\u304c\u66f4\u65b0\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\n\t\t\t\t\t\tif (cvCameraMat.didUpdateThisFrame ()) {\n\t\t\t\t\t\t\t//Texture2D\u304c\u521d\u671f\u5316\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\n\t\t\t\t\t\t\tif (texture != null) {\n\t\t\t\t\t\t\t\t//\u30ab\u30e1\u30e9\u306eMat\u753b\u50cf\u3092\u53d6\u5f97\n\t\t\t\t\t\t\t\tMat cvCamMat = cvCameraMat.GetMat ();\n\t\t\t\t\t\t\t\t//Mat\u304c\u53d6\u5f97\u3067\u304d\u3066\u3044\u308b\u304b\u78ba\u8a8d\n\t\t\t\t\t\t\t\tif (cvCamMat != null) {\n\t\t\t\t\t\t\t\t\t//Mat\u304c\u7a7a\u306e\u30c7\u30fc\u30bf\u3058\u3083\u306a\u3044\u304b\u78ba\u8a8d\n\t\t\t\t\t\t\t\t\tif (!cvCamMat.empty ()) {\n\n\t\t\t\t\t\t\t\t\t\t/* \u753b\u50cf\u52a0\u5de5\u958b\u59cb */\n\n\n\n\t\t\t\t\t\t\t\t\t\t/* \u753b\u50cf\u52a0\u5de5\u7d42\u4e86 */\n\n\t\t\t\t\t\t\t\t\t\t//\u52a0\u5de5\u3057\u305fMat\u304c\u5b58\u5728\u3059\u308b\u304b\u78ba\u8a8d\n\t\t\t\t\t\t\t\t\t\tif (cvCamMat != null) {\n\t\t\t\t\t\t\t\t\t\t\t//Mat\u304c\u7a7a\u306e\u30c7\u30fc\u30bf\u3058\u3083\u306a\u3044\u304b\u78ba\u8a8d\n\t\t\t\t\t\t\t\t\t\t\tif (!cvCamMat.empty ()) {\n\t\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\t//cvCamMat\u3092Texture2D\u306b\u5909\u63db\u3057\u3066\u53cd\u6620\u3059\u308b\n\t\t\t\t\t\t\t\t\t\t\t\t\tcvCameraMat.matToTexture2D (cvCamMat, texture);\n\t\t\t\t\t\t\t\t\t\t\t\t} catch (System.ArgumentException e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tDebug.Log (e.Message);\n\t\t\t\t\t\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\t\t\t\t\t\tDebug.Log (\"OtherError\");\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tcvCamMat = null;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tDebug.LogError(\"NotFound:rawImage\");\n\t\t}\n\t}\n\n    /*--------------------------------\n     : Load Method\n     --------------------------------*/\n\t//CVCameraMat\u3092\u8d77\u52d5\u3055\u305b\u308b\n\tprivate void Init()\n\t{\n\t\tstartCVCam = false;\n\t\t//\u30ab\u30e1\u30e9\u753b\u50cf\u306e\u8868\u793a\u5148\u304c\u3042\u308b\u304b\u78ba\u8a8d\n\t\tif (rawImage) {\n\t\t\t//cvCameraMat\u3092\u53d6\u5f97\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u53d6\u5f97\n\t\t\tif (cvCameraMat == null) {\n\t\t\t\tcvCameraMat = GetComponent<CVCameraMat> ();\n\t\t\t}\n\t\t\tif (cvCameraMat != null) {\n\t\t\t\tif (cvCameraMat.isInited ()) {\n\t\t\t\t\t//\u521d\u671f\u5316\u3057\u3066\u3044\u308b\n\t\t\t\t\t//\u30ab\u30e1\u30e9\u306e\u72b6\u614b\u3092\u78ba\u8a8d\n\t\t\t\t\tif (!cvCameraMat.isPlaying ()) {\n\t\t\t\t\t\t//\u30ab\u30e1\u30e9\u306e\u64ae\u5f71\u304c\u6b62\u307e\u3063\u3066\u3044\u308b\n\t\t\t\t\t\t//\u64ae\u5f71\u958b\u59cb\n\t\t\t\t\t\tcvCameraMat.Play ();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//\u30ab\u30e1\u30e9\u306f\u64ae\u5f71\u4e2d\n\t\t\t\t\t\t//Texture2D\u304c\u521d\u671f\u5316\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\n\t\t\t\t\t\tif (texture != null) {\n\t\t\t\t\t\t\t//\u521d\u671f\u5316\u3055\u308c\u3066\u3044\u308b\n\t\t\t\t\t\t\tstartCVCam = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t//\u521d\u671f\u5316\u3055\u308c\u3066\u3044\u306a\u3044\n\t\t\t\t\t\t\t//Texture2D\u3092\u521d\u671f\u5316\n\t\t\t\t\t\t\tOnCVCameraMatInited();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t//\u521d\u671f\u5316\u3057\u3066\u3044\u306a\u3044\n\t\t\t\t\t//\u521d\u671f\u5316\u3057\u3066\u8d77\u52d5\n\t\t\t\t\tcvCameraMat.Init();\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tDebug.LogError(\"NotFound:rawImage\");\n\t\t}\n\t}\n\n    /*--------------------------------\n     : CVCameraMat Method\n     --------------------------------*/\n\t//CVCameraMat\u304c\u521d\u671f\u5316\u3055\u308c\u305f\u6642\n\tpublic void OnCVCameraMatInited()\n\t{\n\t\tif (rawImage) { \n\t\t\t//CVMat\u8aad\u307f\u8fbc\u307f\u5f85\u3061\n\t\t\tbool loadMatFlag = false;\n\t\t\tMat cvCamMat = new Mat ();\n\t\t\twhile (!loadMatFlag) {\n\t\t\t\tif (cvCameraMat) {\n\t\t\t\t\tif (cvCameraMat.isPlaying ()) {\n\t\t\t\t\t\tif (cvCameraMat.didUpdateThisFrame ()) {\n\t\t\t\t\t\t\tcvCamMat = cvCameraMat.GetMat ();\n\t\t\t\t\t\t\tif (cvCamMat != null) {\n\t\t\t\t\t\t\t\tif (!cvCamMat.empty ()) {\n\t\t\t\t\t\t\t\t\tloadMatFlag = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t//CVMat\u3092Texture\u306b\u30bb\u30c3\u30c8\n\t\t\tif (loadMatFlag) {\n\t\t\t\t//Texture2D\u306e\u4f5c\u6210\n\t\t\t\ttexture = new Texture2D ((int)cvCamMat.cols (), (int)cvCamMat.rows (), TextureFormat.RGBA32, false);\n\t\t\t\tif (texture) {\n\t\t\t\t\t//RawImage\u3078Texture2D\u3092\u8a2d\u5b9a\uff08\u8868\u793a\u3055\u308c\u306a\u3044\u6642\u306frawImage.material.mainTexture\uff09\n\t\t\t\t\trawImage.texture = texture;\n\t\t\t\t\tstartCVCam = true;\n\t\t\t\t} else {\n\t\t\t\t\tInit ();\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tDebug.LogError(\"NotFound:rawImage\");\n\t\t}\n\t}\n\n\t//CVCameraMat\u304c\u89e3\u653e\u3055\u308c\u305f\u6642\n\tpublic void OnCVCameraMatDisposed()\n\t{\n\t\tstartCVCam = false;\n\t\ttexture = null;\n\t}\n}\n```\n\n#GameObject\u306e\u69cb\u6210\n\u4e00\u5fdc\u52d5\u4f5c\u3059\u308b\u72b6\u614b\u306eGameObject\u306e\u69cb\u6210\u304c\u3069\u3046\u306a\u3063\u3066\u3044\u308b\u304b\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\n\n\u30b5\u30f3\u30d7\u30eb\u3068\u3057\u3066Unity2D\u3067\u52d5\u4f5c\u3055\u305b\u3066\u3044\u307e\u3059\u3002\nCanvas,Camera,EventSystem\u306f\u6a19\u6e96\u306e\u307e\u307e\u3067\u3059\u3002\n<img width=\"249\" alt=\"Hierarchy\" src=\"https://qiita-image-store.s3.amazonaws.com/0/82938/cb5d2427-f76b-7c59-3ac6-8d2cc2576107.png\">\n\nCameraMask\u306fRectMask2D\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u8ffd\u52a0\u3057\u305fGameObject\u3067\u3059\u3002\n\u30ab\u30e1\u30e9\u6620\u50cf\u3092\u753b\u9762\u306b\u8868\u793a\u3057\u305f\u3044\u30b5\u30a4\u30ba\u3067\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n<img width=\"400\" alt=\"RectMask2D\" src=\"https://qiita-image-store.s3.amazonaws.com/0/82938/d15b9fd6-2a4d-92f7-820f-f2f1bc343d22.png\">\n\nCameraImage\u306f\u30ab\u30e1\u30e9\u6620\u50cf\u3092\u63cf\u753b\u3059\u308bRawImage\u3067\u3059\u3002\n\u4eca\u56de\u4f7f\u3063\u305f\u30ab\u30e1\u30e9\u306f\u6a2a\u9577\u306b\u53d6\u5f97\u3067\u304d\u308b\u3082\u306e\u3060\u3063\u305f\u306e\u3067\u7e26\u30b5\u30a4\u30ba\u306fCameraMask\u3068\u540c\u3058\u30b5\u30a4\u30ba\u3067\u6a2a\u30b5\u30a4\u30ba\u3092\u5c11\u3057\u9577\u304f\u3057\u307e\u3057\u305f\u3002\n<img width=\"388\" alt=\"CameraImage\" src=\"https://qiita-image-store.s3.amazonaws.com/0/82938/31e0c4a4-d8af-450d-cc89-1e3b788e32cc.png\">\n\nCameraImage\u306bCVCameraMat.cs\u3068SimpleScript.cs\u3092\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nCVCameraMat.cs\u306eOnInitedEvent\u3068OnDisposedEvent\u306e\u8a2d\u5b9a\u306fSimpleScript.cs\u3067\u901a\u77e5\u3092\u53d7\u3051\u53d6\u308b\u306e\u306b\u5fc5\u9808\u3067\u3059\u3002\nSimpleScript.cs\u306eRawImage\u306f\u81ea\u8eab\u3067\u3042\u308bCameraImage\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n<img width=\"408\" alt=\"Script\" src=\"https://qiita-image-store.s3.amazonaws.com/0/82938/4c9e435f-ae1d-3ad0-202d-14382b187aab.png\">\n\n"}