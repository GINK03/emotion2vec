{"context": "SICP\u3092\u8aad\u307f\u9032\u3081\u308b\u4e0a\u3067\u306e\u500b\u4eba\u7684\u306a\u30e1\u30e2\u3067\u3059\u3002\n\n\u6c17\u306b\u306a\u3063\u305f\u90e8\u5206\u306e\u5f15\u7528\n\n3.1.1 \u5c40\u6240\u72b6\u614b\u5909\u6570\n\nscheme\n(define balance 100)\n(define (withdraw amount)\n  (if (>= balance amount)\n      (begin (set! balance (- balance amount))\n             balance)\n      \"Insufficient funds\"\n  )\n)\n\n\n\u5b9f\u884c\u4f8b\uff1a\n\n>(withdraw 25)\n75\n>(withdraw 25)\n50\n>(withdraw 60)\n\"Insufficient funds\"\n>(withdraw 15)\n36\n\u5f0f (withdraw 25) \u306f\u4e8c\u56de\u8a55\u4fa1\u3055\u308c\u3066\u3044\u307e\u3059\u304b\u3099\u3001\u305d\u308c\u305d\u3099\u308c\u9055\u3046\u5024\u3092\u8fd4\u3057\u3066\u3044\u308b\u3068\u3044\u3046\u3068\u3053\u308d\u306b\u6ce8\u610f\u3057\u3066\u304f\u305f\u3099\u3055\u3044\u3002\u3053\u308c\u306f\u3001\u624b\u7d9a\u304d\u306e\u3075\u308b\u307e\u3044\u3068\u3057\u3066\u3001\u3053\u308c\u307e\u3066\u3099\u306b\u306a\u304b\u3063\u305f\u7a2e\u985e\u306e\u3082\u306e\u3066\u3099\u3059\u3002\u3053\u308c\u307e\u3066\u3099\u306f\u3001\u624b\u7d9a\u304d\u306f\u3059\u3078\u3099\u3066\u6570\u5b66\u95a2\u6570\u3092\u8a08\u7b97\u3059\u308b\u4ed5\u69d8\u3068\u3057\u3066\u6349\u3048\u308b\u3053\u3068\u304b\u3099\u53ef\u80fd\u3066\u3099\u3057\u305f\u3002\u624b\u7d9a\u304d\u306e\u547c\u3072\u3099\u51fa\u3057\u3092\u884c\u3046\u3068\u3001\u4e0e\u3048\u3089\u308c\u305f\u5f15\u6570\u3092\u95a2\u6570\u306b\u9069\u7528\u3057\u305f\u3068\u304d\u306e\u5024\u306e\u8a08\u7b97\u304b\u3099\u884c\u308f\u308c\u3001\u540c\u3057\u3099\u624b\u7d9a\u304d\u3092\u540c\u3057\u3099\u5f15\u6570\u3066\u3099\u4e8c\u56de\u547c\u3072\u3099\u51fa\u3059\u3068\u3001\u3044\u3064\u3066\u3099\u3082\u540c\u3057\u3099\u5024\u304b\u3099\u8fd4\u3063\u3066\u304f\u308b\u3053\u3068\u306b\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\n\n(set! <name> <new-value>)\n\nbalance\u306e\u6e1b\u7b97\u306fset!\u3068\u3044\u3046\u7279\u6b8a\u5f0f\u3092\u7528\u3044\u308b\u3002\n\u5909\u6570<name>\u306e\u5024\u3092<new-value>\u306b\u5909\u66f4\u3059\u308b\u3002\n\n\n(begin <exp1> <exp2>...<expk>)\n\nif\u304cTrue\u306e\u5834\u5408\u3001\u4e8c\u3064\u306e\u5f0f\u304c\u8a55\u4fa1\u3055\u308c\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u306b\u3001begin\u3068\u3044\u3046\u7279\u6b8a\u5f62\u5f0f\u3092\u7528\u3044\u308b\u3002<exp1>\uff5e<expk>\u307e\u3067\u306e\u5f0f\u304c\u9806\u756a\u306b\u8a55\u4fa1\u3055\u308c\u3001\u6700\u5f8c\u306e\u5f0f(<expk>)\u3092\u8a55\u4fa1\u3057\u305f\u7d50\u679c\u306e\u5024\u304cbegin\u5168\u4f53\u306e\u5024\u3068\u3057\u3066\u8fd4\u3055\u308c\u308b\u3002\n\n\n\u30ab\u30d7\u30bb\u30eb\u5316\n\nscheme\n(define new-withdraw\n  (let ((balance 100))\n    (lambda (amount)\n      (if (>= balance amount)\n          (begin (set! balance (- balance amount))\n                 \u3000balance)\n          \"Insufficient funds\"\n      )\n    )\n  )\n)\n\n\n\u5b9f\u884c\u7d50\u679c\n\n>(new-withdraw 10)\n90\n>(new-withdraw 10)\n80\n\u3053\u306e\u5c40\u6240\u74b0\u5883\u306e\u4e2d\u3066\u3099\u3001amount \u3092\u5f15\u6570\u306b\u53d6\u308a\u4ee5\u524d\u306e withdraw \u624b\u7d9a\u304d\u3068\u540c\u3057\u3099\u3088\u3046\u306a\u3075\u308b\u307e\u3044\u3092\u3059\u308b\u624b\u7d9a\u304d\u3092 lambda \u3092\u4f7f\u3063\u3066\u4f5c\u3063\u3066\u3044\u307e\u3059\u3002let \u5f0f\u3092\u8a55\u4fa1\u3057\u305f\u7d50\u679c\u3068\u3057\u3066\u8fd4\u3055\u308c\u308b\u3053\u306e\u624b\u7d9a\u304d\u306f new-withdraw \u3066\u3099\u3001withdraw \u3068\u6b63\u78ba\u306b\u540c\u3057\u3099\u3075\u308b\u307e\u3044\u3092\u3057\u307e\u3059\u304b\u3099\u3001\u5909\u6570 balance \u306f\u307b\u304b\u306e\u3068\u3099\u306e\u624b\u7d9a\u304d\u304b\u3089\u3082\u30a2\u30af\u30bb\u30b9\u3066\u3099\u304d\u307e\u305b\u3093\u3002\n\u30d5\u309a\u30ed\u30af\u3099\u30e9\u30df\u30f3\u30af\u3099\u8a00\u8a9e\u306e\u696d\u754c\u7528\u8a9e\u3066\u3099\u306f\u3001\u5909\u6570 balance \u306f\u624b\u7d9a\u304d new-withdraw \u306e\u4e2d\u306b \u30ab\u30d5\u309a\u30bb\u30eb\u5316 (encapsulated) \u3055\u308c\u3066\u3044\u308b\u3068\u8a00\u3044\u307e\u3059\u3002\u30ab\u30d5\u309a\u30bb\u30eb\u5316\u306f\u3001\u96a0\u853d\u539f\u7406 (hiding principle) \u3068\u3057\u3066\u77e5\u3089\u308c\u308b\u3001\u4e00\u822c\u7684\u306a\u30b7\u30b9\u30c6\u30e0\u8a2d\u8a08\u306e\u539f\u5247\u3092\u53cd\u6620\u3057\u305f\u3082\u306e\u3066\u3099\u3059\u3002\u96a0\u853d\u539f\u7406\u3068\u306f\u3001\u30b7\u30b9\u30c6\u30e0\u306e\u5404\u90e8\u54c1\u3092\u307b\u304b\u306e\u90e8\u54c1\u304b\u3089\u5b88\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u3001\u30b7\u30b9\u30c6\u30e0\u3092\u3088\u308a\u30e2\u30b7\u3099\u30e5\u30fc\u30eb\u7684\u3066\u3099\u9811\u5065\u306a\u3082\u306e\u306b\u3066\u3099\u304d\u308b\u3068\u3044\u3046\u8003\u3048\u65b9\u3066\u3099\u3059\u3002\u3053\u308c\u306f\u3064\u307e\u308a\u3001\u201c\u77e5\u308b\u5fc5\u8981\u201d \u306e\u3042\u308b\u30b7\u30b9\u30c6\u30e0\u306e\u90e8\u54c1\u306b\u305f\u3099\u3051\u3001\u60c5\u5831\u3078\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u3092\u4e0e\u3048\u308b\u3068\u3044\u3046\u3053\u3068\u3066\u3099\u3059\u3002\nset! \u3092\u5c40\u6240\u5909\u6570\u3068\u7d44\u307f\u5408\u308f\u305b\u308b\u3068\u3044\u3046\u306e\u306f\u3001\u4eca\u5f8c\u5c40\u6240\u72b6\u614b\u3092\u6301\u3064\u8a08\u7b97\u30aa\u30d5\u3099\u30b7\u3099\u30a7\u30af\u30c8\u3092\u69cb\u7bc9\u3059\u308b\u306e\u306b\u4f7f\u3046\u3053\u3068\u306b\u306a\u308b\u4e00\u822c\u7684\u306a\u30d5\u309a\u30ed\u30af\u3099\u30e9\u30df\u30f3\u30af\u3099\u30c6\u30af\u30cb\u30c3\u30af\u3066\u3099\u3059\u3002\u6b8b\u5ff5\u306a\u304b\u3099\u3089\u3001\u3053\u306e\u30c6\u30af\u30cb\u30c3\u30af\u3092\u4f7f\u3046\u3068\u6df1\u523b\u306a\u554f\u984c\u304b\u3099\u51fa\u3066\u304d\u307e\u3059\u3002\n\u554f\u984c\u306f\u3001\u8a00\u8a9e\u306b\u4ee3\u5165\u3092\u5c0e\u5165\u3057\u305f\u3068\u305f\u3093\u3001\u7f6e\u63db\u3068\u3044\u3046\u306e\u306f\u624b\u7d9a\u304d\u9069\u7528\u306e\u9069\u5207\u306a\u30e2\u30c6\u3099\u30eb\u3066\u3099\u306f\u306a\u304f\u306a\u308b\u3068\u3044\u3046\u3053\u3068\u3066\u3099\u3059 (\u3068\u3099\u3046\u3057\u3066\u305d\u3046\u306a\u308b\u306e\u304b\u306f3.1.3 \u7bc0\u3066\u3099\u898b\u3066\u3044\u304d\u307e\u3059)\u3002\n\n\n\u3000\u30e1\u30c3\u30bb\u30fc\u30b8\u30d1\u30c3\u30b7\u30f3\u30b0\n\nscheme\n(define (make-account balance)\n  (define (withdraw amount)\n    (if (>= balance amount)\n        (begin (set! balance (- balance amount))\n                   balance)\n        \"Insufficient funds\"\n    )\n  )\n  (define (deposit amount)\n    (set! balance (+ balance amount))\n    balance\n  )\n  (define (dispatch m)\n    (cond ((eq? m 'withdraw) withdraw)\n          ((eq? m 'deposit) deposit)\n          (else (error \"Unknown request: MAKE-ACCOUNT\"))\n    )\n  )\n  dispatch\n)\n\n\n\u5b9f\u884c\u7d50\u679c\uff1a\n\n>(define acc (make-account 100))\n>((acc 'withdraw) 60)\n40\n>((acc 'deposit) 30)\n70\nmake-account \u3092\u547c\u3072\u3099\u51fa\u3059\u305f\u3072\u3099\u306b\u3001\u5c40\u6240\u72b6\u614b\u5909\u6570 balance \u3092\u6301\u3064\u74b0\u5883\u304b\u3099\u69cb\u7bc9\u3055\u308c\u307e\u3059\u3002\u3053\u306e\u74b0\u5883\u306e\u4e2d\u3066\u3099\u3001make-account \u306f balance \u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u624b\u7d9a\u304d deposit, withdraw \u3068\u3001\u307e\u305f \u201c\u30e1\u30c3\u30bb\u30fc\u30b7\u3099\u201d \u3092\u5165\u529b\u3068\u3057\u3066\u53d6\u308a\u4e8c\u3064\u306e\u5c40\u6240\u624b\u7d9a\u304d\u306e\u3046\u3061\u3072\u3068\u3064\u3092\u8fd4\u3059 dispatch \u3068\u3044\u3046\u8ffd\u52a0\u306e\u624b\u7d9a\u304d\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\u9280\u884c\u53e3\u5ea7\u30aa\u30d5\u3099\u30b7\u3099\u30a7\u30af\u30c8\u3092\u8868\u73fe\u3059\u308b\u5024\u3068\u3057\u3066\u306f\u3001dispatch \u624b\u7d9a\u304d\u305d\u306e\u3082\u306e\u304b\u3099\u8fd4\u3055\u308c\u307e\u3059\u3002\u3053\u308c\u306f\u307e\u3055\u306b\u30012.4.3 \u7bc0\u3066\u3099\u5b66\u3093\u305f\u3099 \u30e1\u30c3\u30bb\u30fc\u30b7\u3099\u30cf\u309a\u30c3\u30b7\u30f3\u30af\u3099 (message-passing) \u306e\u30d5\u309a\u30ed\u30af\u3099\u30e9\u30df\u30f3\u30af\u3099\u30b9\u30bf\u30a4\u30eb\u3066\u3099\u3059\u304b\u3099\u3001\u3053\u3053\u3066\u3099\u306f\u5c40\u6240\u5909\u6570\u3092\u5909\u66f4\u3059\u308b\u80fd\u529b\u3068\u5408\u308f\u305b\u3066\u4f7f\u3063 \u3066\u3044\u307e\u3059\u3002\n\n\nExercise\n\nEx 3.1\n\u521d\u671f\u5024\u306b\u52a0\u7b97\u3057\u3066\u3044\u304f\n\nscheme\n(define (make-accumulator init)\n  (lambda (operand)\n    (set! init (+ init operand))\n    init\n  )\n)\n\n\n\u5b9f\u884c\u7d50\u679c\n\n> (define A (make-accumulator 5))\n> (A 10)\n15\n> (A 10)\n25\n\n\nEx 3.2\n\u547c\u3073\u51fa\u3057\u56de\u6570\u3092\u6570\u3048\u308b\u3002\u7279\u5b9a\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u5834\u5408\u306b\u547c\u3073\u51fa\u3057\u56de\u6570\u3092\u8fd4\u3057\u305f\u308a\u3001\n\u30ab\u30a6\u30f3\u30bf\u3092\u30ea\u30bb\u30c3\u30c8\u3059\u308b\u3002\n\nscheme\n(define (make-monitored procedure)\n  (let ((cnt 0))\n    (define (dispatch args)\n      (cond ((eq? args 'how-many-calls?) cnt)\n            ((eq? args 'reset-count)\n              (begin (set! cnt 0)\n                     cnt))\n            (else (begin\n                   \u3000(set! cnt (+ cnt 1))\n                   \u3000(procedure args)\n                  )\n\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000)\n      )\n    )\n    dispatch\n  )\n)\n\n\n\u5b9f\u884c\u7d50\u679c\uff1a\n\n> (define s (make-monitored sqrt))\n> (s 100)\n10\n> (s 'how-many-calls?)\n1\n> (s 'reset-count)\n0\n> (s 'how-many-calls?)\n0\n\n\nEx 3.3\n\u9280\u884c\u53e3\u5ea7\u306b\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u3064\u3051\u308b\u3002\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u9593\u9055\u3048\u308b\u3068\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8868\u793a\n\nscheme\n(define (make-account balance password)\n  (define (withdraw amount)\n    (if (>= balance amount)\n        (begin (set! balance (- balance amount))\n                   balance)\n        \"Insufficient funds\"\n    )\n  )\n  (define (deposit amount)\n    (set! balance (+ balance amount))\n    balance\n  )\n  (define (incorrect DUMMY)\n    \"Incorrect password\"\n  )\n  (define (dispatch p m)\n    (if (eq? p password)\n      (cond ((eq? m 'withdraw) withdraw)\n            ((eq? m 'deposit) deposit)\n            (else (error \"Unknown request: MAKE-ACCOUNT\"))\n      )\n      incorrect\n    )\n  )\n  dispatch\n)\n\n\n\u5b9f\u884c\u7d50\u679c\uff1a\n\n> (define acc (make-account 100 'secret-password))\n> ((acc 'secret-password 'withdraw) 40)\n60\n> ((acc 'some-other-password 'deposit) 50)\n\"Incorrect password\"\n\n\nEx 3.4\n\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\uff17\u56de\u9593\u9055\u3048\u308b\u3068\u8b66\u5bdf\u3092\u547c\u3076\uff08call-the-cops\uff09\n\nscheme\n(define (make-account balance password)\n  (let ((err-count 0) (ERR-LIMIT 7))\n    (define (withdraw amount)\n      (if (>= balance amount)\n          (begin (set! balance (- balance amount))\n                     balance)\n          \"Insufficient funds\"\n      )\n    )\n    (define (deposit amount)\n      (set! balance (+ balance amount))\n      balance\n    )\n    (define (incorrect DUMMY)\n      (begin (set! err-count (+ err-count 1))\n             (if (>= err-count ERR-LIMIT)\n                  \"call-the-cops!!\"\n                  \"Incorrect password\"\n             )\n      )\n    )\n    (define (dispatch p m)\n      (if (eq? p password)\n        (cond ((eq? m 'withdraw) withdraw)\n              ((eq? m 'deposit) deposit)\n              (else (error \"Unknown request: MAKE-ACCOUNT\"))\n        )\n        incorrect\n      )\n    )\n    dispatch  \n  )\n)\n\n\n\u5b9f\u884c\u7d50\u679c\uff1a\n\n> (define acc (make-account 100 'secret-password))\n> ((acc 'secret-password 'withdraw) 40)\n60\n> ((acc 'some-other-password 'deposit) 50)\n\"Incorrect password\"\n> ((acc 'some-other-password 'deposit) 50)\n\"Incorrect password\"\n> ((acc 'some-other-password 'deposit) 50)\n\"Incorrect password\"\n> ((acc 'some-other-password 'deposit) 50)\n\"Incorrect password\"\n> ((acc 'some-other-password 'deposit) 50)\n\"Incorrect password\"\n> ((acc 'some-other-password 'deposit) 50)\n\"Incorrect password\"\n> ((acc 'some-other-password 'deposit) 50)\n\"call-the-cops!!\"\n\n\n\u53c2\u8003\nSICP\u975e\u516c\u5f0f\u65e5\u672c\u8a9e\u7248 \u7ffb\u8a33\u6539\u8a02\u7248\nSICP\u3092\u8aad\u307f\u9032\u3081\u308b\u4e0a\u3067\u306e\u500b\u4eba\u7684\u306a\u30e1\u30e2\u3067\u3059\u3002\n\n# \u6c17\u306b\u306a\u3063\u305f\u90e8\u5206\u306e\u5f15\u7528\n\n## 3.1.1 \u5c40\u6240\u72b6\u614b\u5909\u6570\n```lang:scheme\n(define balance 100)\n(define (withdraw amount)\n  (if (>= balance amount)\n      (begin (set! balance (- balance amount))\n             balance)\n      \"Insufficient funds\"\n  )\n)\n```\n\n\u5b9f\u884c\u4f8b\uff1a\n>\\>(withdraw 25)\n75\n\\>(withdraw 25)\n50\n\\>(withdraw 60)\n\"Insufficient funds\"\n\\>(withdraw 15)\n36\n\n>\n\u5f0f (withdraw 25) \u306f\u4e8c\u56de\u8a55\u4fa1\u3055\u308c\u3066\u3044\u307e\u3059\u304b\u3099\u3001\u305d\u308c\u305d\u3099\u308c\u9055\u3046\u5024\u3092\u8fd4\u3057\u3066\u3044\u308b\u3068\u3044\u3046\u3068\u3053\u308d\u306b\u6ce8\u610f\u3057\u3066\u304f\u305f\u3099\u3055\u3044\u3002\u3053\u308c\u306f\u3001\u624b\u7d9a\u304d\u306e\u3075\u308b\u307e\u3044\u3068\u3057\u3066\u3001\u3053\u308c\u307e\u3066\u3099\u306b\u306a\u304b\u3063\u305f\u7a2e\u985e\u306e\u3082\u306e\u3066\u3099\u3059\u3002\u3053\u308c\u307e\u3066\u3099\u306f\u3001\u624b\u7d9a\u304d\u306f\u3059\u3078\u3099\u3066\u6570\u5b66\u95a2\u6570\u3092\u8a08\u7b97\u3059\u308b\u4ed5\u69d8\u3068\u3057\u3066\u6349\u3048\u308b\u3053\u3068\u304b\u3099\u53ef\u80fd\u3066\u3099\u3057\u305f\u3002\u624b\u7d9a\u304d\u306e\u547c\u3072\u3099\u51fa\u3057\u3092\u884c\u3046\u3068\u3001\u4e0e\u3048\u3089\u308c\u305f\u5f15\u6570\u3092\u95a2\u6570\u306b\u9069\u7528\u3057\u305f\u3068\u304d\u306e\u5024\u306e\u8a08\u7b97\u304b\u3099\u884c\u308f\u308c\u3001\u540c\u3057\u3099\u624b\u7d9a\u304d\u3092\u540c\u3057\u3099\u5f15\u6570\u3066\u3099\u4e8c\u56de\u547c\u3072\u3099\u51fa\u3059\u3068\u3001\u3044\u3064\u3066\u3099\u3082\u540c\u3057\u3099\u5024\u304b\u3099\u8fd4\u3063\u3066\u304f\u308b\u3053\u3068\u306b\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\n### (set! \\<name> \\<new-value>)\n>balance\u306e\u6e1b\u7b97\u306fset!\u3068\u3044\u3046\u7279\u6b8a\u5f0f\u3092\u7528\u3044\u308b\u3002\n\u5909\u6570\\<name>\u306e\u5024\u3092\\<new-value>\u306b\u5909\u66f4\u3059\u308b\u3002\n\n### (begin \\<exp1> \\<exp2>...\\<expk>)\n>if\u304cTrue\u306e\u5834\u5408\u3001\u4e8c\u3064\u306e\u5f0f\u304c\u8a55\u4fa1\u3055\u308c\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u306b\u3001begin\u3068\u3044\u3046\u7279\u6b8a\u5f62\u5f0f\u3092\u7528\u3044\u308b\u3002\\<exp1>\uff5e\\<expk>\u307e\u3067\u306e\u5f0f\u304c\u9806\u756a\u306b\u8a55\u4fa1\u3055\u308c\u3001\u6700\u5f8c\u306e\u5f0f(\\<expk>)\u3092\u8a55\u4fa1\u3057\u305f\u7d50\u679c\u306e\u5024\u304cbegin\u5168\u4f53\u306e\u5024\u3068\u3057\u3066\u8fd4\u3055\u308c\u308b\u3002\n\n### \u30ab\u30d7\u30bb\u30eb\u5316\n\n```lang:scheme\n(define new-withdraw\n  (let ((balance 100))\n    (lambda (amount)\n      (if (>= balance amount)\n          (begin (set! balance (- balance amount))\n                 \u3000balance)\n          \"Insufficient funds\"\n      )\n    )\n  )\n)\n```\n\n\u5b9f\u884c\u7d50\u679c\n>\\>(new-withdraw 10)\n>90\n>\\>(new-withdraw 10)\n>80\n>\n\n>\u3053\u306e\u5c40\u6240\u74b0\u5883\u306e\u4e2d\u3066\u3099\u3001amount \u3092\u5f15\u6570\u306b\u53d6\u308a\u4ee5\u524d\u306e withdraw \u624b\u7d9a\u304d\u3068\u540c\u3057\u3099\u3088\u3046\u306a\u3075\u308b\u307e\u3044\u3092\u3059\u308b\u624b\u7d9a\u304d\u3092 lambda \u3092\u4f7f\u3063\u3066\u4f5c\u3063\u3066\u3044\u307e\u3059\u3002let \u5f0f\u3092\u8a55\u4fa1\u3057\u305f\u7d50\u679c\u3068\u3057\u3066\u8fd4\u3055\u308c\u308b\u3053\u306e\u624b\u7d9a\u304d\u306f new-withdraw \u3066\u3099\u3001withdraw \u3068\u6b63\u78ba\u306b\u540c\u3057\u3099\u3075\u308b\u307e\u3044\u3092\u3057\u307e\u3059\u304b\u3099\u3001\u5909\u6570 balance \u306f\u307b\u304b\u306e\u3068\u3099\u306e\u624b\u7d9a\u304d\u304b\u3089\u3082\u30a2\u30af\u30bb\u30b9\u3066\u3099\u304d\u307e\u305b\u3093\u3002\n\n>\u30d5\u309a\u30ed\u30af\u3099\u30e9\u30df\u30f3\u30af\u3099\u8a00\u8a9e\u306e\u696d\u754c\u7528\u8a9e\u3066\u3099\u306f\u3001\u5909\u6570 balance \u306f\u624b\u7d9a\u304d new-withdraw \u306e\u4e2d\u306b **\u30ab\u30d5\u309a\u30bb\u30eb\u5316 (encapsulated)** \u3055\u308c\u3066\u3044\u308b\u3068\u8a00\u3044\u307e\u3059\u3002\u30ab\u30d5\u309a\u30bb\u30eb\u5316\u306f\u3001\u96a0\u853d\u539f\u7406 (hiding principle) \u3068\u3057\u3066\u77e5\u3089\u308c\u308b\u3001\u4e00\u822c\u7684\u306a\u30b7\u30b9\u30c6\u30e0\u8a2d\u8a08\u306e\u539f\u5247\u3092\u53cd\u6620\u3057\u305f\u3082\u306e\u3066\u3099\u3059\u3002\u96a0\u853d\u539f\u7406\u3068\u306f\u3001\u30b7\u30b9\u30c6\u30e0\u306e\u5404\u90e8\u54c1\u3092\u307b\u304b\u306e\u90e8\u54c1\u304b\u3089\u5b88\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u3001\u30b7\u30b9\u30c6\u30e0\u3092\u3088\u308a\u30e2\u30b7\u3099\u30e5\u30fc\u30eb\u7684\u3066\u3099\u9811\u5065\u306a\u3082\u306e\u306b\u3066\u3099\u304d\u308b\u3068\u3044\u3046\u8003\u3048\u65b9\u3066\u3099\u3059\u3002\u3053\u308c\u306f\u3064\u307e\u308a\u3001\u201c\u77e5\u308b\u5fc5\u8981\u201d \u306e\u3042\u308b\u30b7\u30b9\u30c6\u30e0\u306e\u90e8\u54c1\u306b\u305f\u3099\u3051\u3001\u60c5\u5831\u3078\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u3092\u4e0e\u3048\u308b\u3068\u3044\u3046\u3053\u3068\u3066\u3099\u3059\u3002\n\n>set! \u3092\u5c40\u6240\u5909\u6570\u3068\u7d44\u307f\u5408\u308f\u305b\u308b\u3068\u3044\u3046\u306e\u306f\u3001\u4eca\u5f8c\u5c40\u6240\u72b6\u614b\u3092\u6301\u3064\u8a08\u7b97\u30aa\u30d5\u3099\u30b7\u3099\u30a7\u30af\u30c8\u3092\u69cb\u7bc9\u3059\u308b\u306e\u306b\u4f7f\u3046\u3053\u3068\u306b\u306a\u308b\u4e00\u822c\u7684\u306a\u30d5\u309a\u30ed\u30af\u3099\u30e9\u30df\u30f3\u30af\u3099\u30c6\u30af\u30cb\u30c3\u30af\u3066\u3099\u3059\u3002\u6b8b\u5ff5\u306a\u304b\u3099\u3089\u3001\u3053\u306e\u30c6\u30af\u30cb\u30c3\u30af\u3092\u4f7f\u3046\u3068\u6df1\u523b\u306a\u554f\u984c\u304b\u3099\u51fa\u3066\u304d\u307e\u3059\u3002\n\n>\u554f\u984c\u306f\u3001\u8a00\u8a9e\u306b\u4ee3\u5165\u3092\u5c0e\u5165\u3057\u305f\u3068\u305f\u3093\u3001\u7f6e\u63db\u3068\u3044\u3046\u306e\u306f\u624b\u7d9a\u304d\u9069\u7528\u306e\u9069\u5207\u306a\u30e2\u30c6\u3099\u30eb\u3066\u3099\u306f\u306a\u304f\u306a\u308b\u3068\u3044\u3046\u3053\u3068\u3066\u3099\u3059 (\u3068\u3099\u3046\u3057\u3066\u305d\u3046\u306a\u308b\u306e\u304b\u306f3.1.3 \u7bc0\u3066\u3099\u898b\u3066\u3044\u304d\u307e\u3059)\u3002\n\n##\u3000\u30e1\u30c3\u30bb\u30fc\u30b8\u30d1\u30c3\u30b7\u30f3\u30b0\n```lang:scheme\n(define (make-account balance)\n  (define (withdraw amount)\n    (if (>= balance amount)\n        (begin (set! balance (- balance amount))\n                   balance)\n        \"Insufficient funds\"\n    )\n  )\n  (define (deposit amount)\n    (set! balance (+ balance amount))\n    balance\n  )\n  (define (dispatch m)\n    (cond ((eq? m 'withdraw) withdraw)\n          ((eq? m 'deposit) deposit)\n          (else (error \"Unknown request: MAKE-ACCOUNT\"))\n    )\n  )\n  dispatch\n)\n```\n\n\u5b9f\u884c\u7d50\u679c\uff1a\n>\n\\>(define acc (make-account 100))\n\\>((acc 'withdraw) 60)\n40\n\\>((acc 'deposit) 30)\n70\n\n\n>\nmake-account \u3092\u547c\u3072\u3099\u51fa\u3059\u305f\u3072\u3099\u306b\u3001\u5c40\u6240\u72b6\u614b\u5909\u6570 balance \u3092\u6301\u3064\u74b0\u5883\u304b\u3099\u69cb\u7bc9\u3055\u308c\u307e\u3059\u3002\u3053\u306e\u74b0\u5883\u306e\u4e2d\u3066\u3099\u3001make-account \u306f balance \u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u624b\u7d9a\u304d deposit, withdraw \u3068\u3001\u307e\u305f \u201c\u30e1\u30c3\u30bb\u30fc\u30b7\u3099\u201d \u3092\u5165\u529b\u3068\u3057\u3066\u53d6\u308a\u4e8c\u3064\u306e\u5c40\u6240\u624b\u7d9a\u304d\u306e\u3046\u3061\u3072\u3068\u3064\u3092\u8fd4\u3059 dispatch \u3068\u3044\u3046\u8ffd\u52a0\u306e\u624b\u7d9a\u304d\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\u9280\u884c\u53e3\u5ea7\u30aa\u30d5\u3099\u30b7\u3099\u30a7\u30af\u30c8\u3092\u8868\u73fe\u3059\u308b\u5024\u3068\u3057\u3066\u306f\u3001dispatch \u624b\u7d9a\u304d\u305d\u306e\u3082\u306e\u304b\u3099\u8fd4\u3055\u308c\u307e\u3059\u3002\u3053\u308c\u306f\u307e\u3055\u306b\u30012.4.3 \u7bc0\u3066\u3099\u5b66\u3093\u305f\u3099 **\u30e1\u30c3\u30bb\u30fc\u30b7\u3099\u30cf\u309a\u30c3\u30b7\u30f3\u30af\u3099 (message-passing)** \u306e\u30d5\u309a\u30ed\u30af\u3099\u30e9\u30df\u30f3\u30af\u3099\u30b9\u30bf\u30a4\u30eb\u3066\u3099\u3059\u304b\u3099\u3001\u3053\u3053\u3066\u3099\u306f\u5c40\u6240\u5909\u6570\u3092\u5909\u66f4\u3059\u308b\u80fd\u529b\u3068\u5408\u308f\u305b\u3066\u4f7f\u3063 \u3066\u3044\u307e\u3059\u3002\n\n# Exercise\n###Ex 3.1\n\u521d\u671f\u5024\u306b\u52a0\u7b97\u3057\u3066\u3044\u304f\n\n```lang:scheme\n(define (make-accumulator init)\n  (lambda (operand)\n    (set! init (+ init operand))\n    init\n  )\n)\n```\n\n\u5b9f\u884c\u7d50\u679c\n>\n\\> (define A (make-accumulator 5))\n\\> (A 10)\n15\n\\> (A 10)\n25\n\n### Ex 3.2\n\u547c\u3073\u51fa\u3057\u56de\u6570\u3092\u6570\u3048\u308b\u3002\u7279\u5b9a\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u5834\u5408\u306b\u547c\u3073\u51fa\u3057\u56de\u6570\u3092\u8fd4\u3057\u305f\u308a\u3001\n\u30ab\u30a6\u30f3\u30bf\u3092\u30ea\u30bb\u30c3\u30c8\u3059\u308b\u3002\n\n```lang:scheme\n(define (make-monitored procedure)\n  (let ((cnt 0))\n    (define (dispatch args)\n      (cond ((eq? args 'how-many-calls?) cnt)\n            ((eq? args 'reset-count)\n              (begin (set! cnt 0)\n                     cnt))\n            (else (begin\n                   \u3000(set! cnt (+ cnt 1))\n                   \u3000(procedure args)\n                  )\n\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000)\n      )\n    )\n    dispatch\n  )\n)\n```\n\u5b9f\u884c\u7d50\u679c\uff1a\n>\n\\> (define s (make-monitored sqrt))\n\\> (s 100)\n10\n\\> (s 'how-many-calls?)\n1\n\\> (s 'reset-count)\n0\n\\> (s 'how-many-calls?)\n0\n\n### Ex 3.3\n\u9280\u884c\u53e3\u5ea7\u306b\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u3064\u3051\u308b\u3002\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u9593\u9055\u3048\u308b\u3068\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8868\u793a\n\n```lang:scheme\n(define (make-account balance password)\n  (define (withdraw amount)\n    (if (>= balance amount)\n        (begin (set! balance (- balance amount))\n                   balance)\n        \"Insufficient funds\"\n    )\n  )\n  (define (deposit amount)\n    (set! balance (+ balance amount))\n    balance\n  )\n  (define (incorrect DUMMY)\n    \"Incorrect password\"\n  )\n  (define (dispatch p m)\n    (if (eq? p password)\n      (cond ((eq? m 'withdraw) withdraw)\n            ((eq? m 'deposit) deposit)\n            (else (error \"Unknown request: MAKE-ACCOUNT\"))\n      )\n      incorrect\n    )\n  )\n  dispatch\n)\n```\n\u5b9f\u884c\u7d50\u679c\uff1a\n>\n\\> (define acc (make-account 100 'secret-password))\n\\> ((acc 'secret-password 'withdraw) 40)\n60\n\\> ((acc 'some-other-password 'deposit) 50)\n\"Incorrect password\"\n\n### Ex 3.4\n\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\uff17\u56de\u9593\u9055\u3048\u308b\u3068\u8b66\u5bdf\u3092\u547c\u3076\uff08call-the-cops\uff09\n\n```lang:scheme\n(define (make-account balance password)\n  (let ((err-count 0) (ERR-LIMIT 7))\n    (define (withdraw amount)\n      (if (>= balance amount)\n          (begin (set! balance (- balance amount))\n                     balance)\n          \"Insufficient funds\"\n      )\n    )\n    (define (deposit amount)\n      (set! balance (+ balance amount))\n      balance\n    )\n    (define (incorrect DUMMY)\n      (begin (set! err-count (+ err-count 1))\n             (if (>= err-count ERR-LIMIT)\n                  \"call-the-cops!!\"\n                  \"Incorrect password\"\n             )\n      )\n    )\n    (define (dispatch p m)\n      (if (eq? p password)\n        (cond ((eq? m 'withdraw) withdraw)\n              ((eq? m 'deposit) deposit)\n              (else (error \"Unknown request: MAKE-ACCOUNT\"))\n        )\n        incorrect\n      )\n    )\n    dispatch  \n  )\n)\n```\n\n\u5b9f\u884c\u7d50\u679c\uff1a\n>\n\\> (define acc (make-account 100 'secret-password))\n\\> ((acc 'secret-password 'withdraw) 40)\n60\n\\> ((acc 'some-other-password 'deposit) 50)\n\"Incorrect password\"\n\\> ((acc 'some-other-password 'deposit) 50)\n\"Incorrect password\"\n\\> ((acc 'some-other-password 'deposit) 50)\n\"Incorrect password\"\n\\> ((acc 'some-other-password 'deposit) 50)\n\"Incorrect password\"\n\\> ((acc 'some-other-password 'deposit) 50)\n\"Incorrect password\"\n\\> ((acc 'some-other-password 'deposit) 50)\n\"Incorrect password\"\n\\> ((acc 'some-other-password 'deposit) 50)\n\"call-the-cops!!\"\n\n# \u53c2\u8003\n[SICP\u975e\u516c\u5f0f\u65e5\u672c\u8a9e\u7248 \u7ffb\u8a33\u6539\u8a02\u7248](http://vocrf.net/docs_ja/jsicp.pdf)\n", "tags": ["SICP"]}