{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\nCentOS 6.4 \u74b0\u5883\u306b Cassandra 1.2.6 \u3092 tarball \u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u624b\u9806\u30e1\u30e2\u3092\u6b8b\u3057\u3066\u304a\u304f\u3002\u3068\u308a\u3042\u3048\u305a\u52d5\u4f5c\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u3002\u4eca\u56de\u306f 5 \u53f0\u306e\u7269\u7406\u30b5\u30fc\u30d0  (10.0.0.[1-5]) \u3092\u4f7f\u7528\u3057\u3001\u305d\u308c\u305e\u308c CentOS 6.4 \u304c\u30af\u30ea\u30fc\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3002\n\u2605 Kernel \u3092\u78ba\u8a8d\u3059\u308b\n$ uname -a\nLinux localhost 2.6.32-358.11.1.el6.x86_64 #1 SMP Wed Jun 12 03:34:52 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux\n\n\u2605 \u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u3092\u78ba\u8a8d\u3059\u308b\n$ cat /etc/redhat-release\nCentOS release 6.4 (Final)\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nCassandra \u306e\u52d5\u4f5c\u306b\u5fc5\u8981\u306a Java \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\u4eca\u56de\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u306a\u3046 Cassandra 1.2.6 \u3067\u306f\u3001OpenJDK-1.6.0_0 \u3092\u4f7f\u7528\u3059\u308b\u3068\u8d77\u52d5\u6642\u306b SEGMENT FAULT \u304c\u767a\u751f\u3057\u3066\u3057\u307e\u3046\u6319\u52d5\u304c\u78ba\u8a8d\u3067\u304d\u305f\u305f\u3081\u3001Oracle \u304c\u63d0\u4f9b\u3057\u3066\u3044\u308b SunJDK 1.6.0_45 \u3092\u4f7f\u7528\u3059\u308b\u3002\n\u2605 SunJDK \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n$ chmod +x ./jdk-6u45-linux-x64-rpm.bin && sudo ./jdk-6u45-linux-x64-rpm.bin\nUnpacking...\nChecksumming...\nExtracting...\nUnZipSFX 5.50 of 17 February 2002, by Info-ZIP (Zip-Bugs@lists.wku.edu).\n  inflating: jdk-6u45-linux-amd64.rpm\n  inflating: sun-javadb-common-10.6.2-1.1.i386.rpm\n  inflating: sun-javadb-core-10.6.2-1.1.i386.rpm\n  inflating: sun-javadb-client-10.6.2-1.1.i386.rpm\n  inflating: sun-javadb-demo-10.6.2-1.1.i386.rpm\n  inflating: sun-javadb-docs-10.6.2-1.1.i386.rpm\n  inflating: sun-javadb-javadoc-10.6.2-1.1.i386.rpm\n\u6e96\u5099\u4e2d...                ########################################### [100%]\n   1:jdk                    ########################################### [100%]\nUnpacking JAR files...\n        rt.jar...\n        jsse.jar...\n        charsets.jar...\n        tools.jar...\n        localedata.jar...\n        plugin.jar...\n        javaws.jar...\n        deploy.jar...\nInstalling JavaDB\n\u6e96\u5099\u4e2d...                ########################################### [100%]\n   1:sun-javadb-common      ########################################### [ 17%]\n   2:sun-javadb-core        ########################################### [ 33%]\n   3:sun-javadb-client      ########################################### [ 50%]\n   4:sun-javadb-demo        ########################################### [ 67%]\n   5:sun-javadb-docs        ########################################### [ 83%]\n   6:sun-javadb-javadoc     ########################################### [100%]\nDone.\n\n\u2605 \u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\u3059\u308b\n$ java -version\njava version \"1.6.0_45\"\nJava(TM) SE Runtime Environment (build 1.6.0_45-b06)\nJava HotSpot(TM) 64-Bit Server VM (build 20.45-b01, mixed mode)\n\nCassandra \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u306f DataStax \u304c\u63d0\u4f9b\u3057\u3066\u3044\u308b RPM \u3092\u4f7f\u3046\u3053\u3068\u3082\u3067\u304d\u308b\u304c\u3001Cassandra \u306f\u500b\u5225\u306b\u30d0\u30c3\u30c1\u3092\u5f53\u3066\u305f\u308a\u3059\u308b\u3053\u3068\u3082\u591a\u3044 (\u3067\u304d\u308c\u3070\u907f\u3051\u305f\u3044) \u3068\u601d\u308f\u308c\u308b\u306e\u3067\u3001\u4eca\u56de\u306f tarball \u304b\u3089 /opt/cassandra \u4ee5\u4e0b\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\u2605 tarball \u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\n$ wget http://www.fightrice.com/mirrors/apache/cassandra/1.2.6/apache-cassandra-1.2.6-bin.tar.gz\n\n\u2605 \u5c55\u958b\u5f8c\u306b /opt/cassandra \u4ee5\u4e0b\u306b\u79fb\u52d5\u3059\u308b\n$ tar xvzf apache-cassandra-1.2.6-bin.tar.gz && sudo mv ./apache-cassandra-1.2.6 /opt/ && sudo ln -s /opt/apache-cassandra-1.2.6 /opt/cassandra\n\n\u2605 \u30ed\u30b0\u3068\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\n$ sudo mkdir -p /var/log/cassandra && sudo mkdir -p /var/lib/cassandra\n\n\n\u8a2d\u5b9a\nCassandra \u3092\u8a2d\u5b9a\u3059\u308b\u3002\u3068\u308a\u3042\u3048\u305a\u52d5\u304b\u3059\u305f\u3081\u306b \"seeds\", \"listen_address\", \"rpc_address\" \u306e 3 \u30ab\u6240\u3092\u5909\u66f4\u3059\u308b\u3002\u4eca\u56de\u306f 4 \u53f0\u306e\u7269\u7406\u30b5\u30fc\u30d0\u306e\u3046\u3061\u30013 \u53f0\u3092 seed \u3068\u3059\u308b\u3002\u307e\u305f \"listen_address\" \u306f\u3001\u4e92\u3044\u306b\u63a5\u7d9a\u3067\u304d\u308b IP \u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u2605 \u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b (\u30b5\u30fc\u30d0 10.0.0.1 \u306e\u5834\u5408\u306e\u8a2d\u5b9a\u4f8b)\n$ sudo vim /opt/cassandra/conf/cassandra.yaml\n... (snip) ...\n# any class that implements the SeedProvider interface and has a\n# constructor that takes a Map<String, String> of parameters will do.\nseed_provider:\n    # Addresses of hosts that are deemed contact points.\n    # Cassandra nodes use this list of hosts to find each other and learn\n    # the topology of the ring.  You must change this if you are running\n    # multiple nodes!\n    - class_name: org.apache.cassandra.locator.SimpleSeedProvider\n      parameters:\n          # seeds is actually a comma-delimited list of addresses.\n          # Ex: \"<ip1>,<ip2>,<ip3>\"\n          - seeds: \"10.0.0.1, 10.0.0.2, 10.0.0.3\"\n... (snip) ...\n# Address to bind to and tell other Cassandra nodes to connect to. You\n# _must_ change this if you want multiple nodes to be able to\n# communicate!\n#\n# Leaving it blank leaves it up to InetAddress.getLocalHost(). This\n# will always do the Right Thing _if_ the node is properly configured\n# (hostname, name resolution, etc), and the Right Thing is to use the\n# address associated with the hostname (it might not be).\n#\n# Setting this to 0.0.0.0 is always wrong.\nlisten_address: 10.0.0.1\n... (snip) ...\n# The address to bind the Thrift RPC service to -- clients connect\n# here. Unlike ListenAddress above, you _can_ specify 0.0.0.0 here if\n# you want Thrift to listen on all interfaces.\n#\n# Leaving this blank has the same effect it does for ListenAddress,\n# (i.e. it will be based on the configured hostname of the node).\nrpc_address: 0.0.0.0\n... (snip) ...\n\nCassandra \u306e\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3059\u308b\u3002\u7d50\u5c40\u306f /opt/cassandra/bin/cassandra \u30b7\u30a7\u30eb\u3092\u547c\u3073\u51fa\u3059\u3060\u3051\u3060\u304c\u3001\u3044\u308d\u3044\u308d\u3068\u9762\u5012\u306a\u306e\u3067\u7c21\u6613\u7684\u306b\u4f5c\u6210\u3057\u3066\u304a\u304f\u3002Cassandra \u306e PID \u3092\u30d5\u30a1\u30a4\u30eb\u3067\u7ba1\u7406\u3057\u3001\u6a19\u6e96\u51fa\u529b\u304a\u3088\u3073\u6a19\u6e96\u30a8\u30e9\u30fc\u51fa\u529b\u306f\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3059\u308b\u3002\n\u2605 \u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3059\u308b\n$ sudo cat << 'EOS' > /etc/init.d/cassandra && sudo chmod +x /etc/init.d/cassandra\n#!/bin/sh\nCASSANDRA_ROOT_DIR=/opt/cassandra\nCASSANDRA_BIN_DIR=${CASSANDRA_ROOT_DIR}/bin\nCASSANDRA_LOG_DIR=/var/log/cassandra\nCASSANDRA_RUN_DIR=/var/run/cassandra\ncase \"$1\" in\n  start)\n    if [ ! -d ${CASSANDRA_LOG_DIR} ]; then\n      mkdir ${CASSANDRA_LOG_DIR}\n    fi\n    if [ ! -d ${CASSANDRA_RUN_DIR} ]; then\n      mkdir ${CASSANDRA_RUN_DIR}\n    fi\n    if [ -e ${CASSANDRA_RUN_DIR}/cassandra.pid ]; then\n      if [ 1 -ne $(ps $(cat ${CASSANDRA_RUN_DIR}/cassandra.pid) | wc -l) ]; then\n        echo \"NG: already running (pid=$(cat ${CASSANDRA_RUN_DIR}/cassandra.pid))\"\n        exit 1\n      fi\n    fi\n    ${CASSANDRA_BIN_DIR}/cassandra -p ${CASSANDRA_RUN_DIR}/cassandra.pid >> ${CASSANDRA_LOG_DIR}/cassandra.log 2>&1\n    echo \"OK: running cassandra (pid=$(cat ${CASSANDRA_RUN_DIR}/cassandra.pid))\"\n    ;;\n  stop)\n    kill $(cat ${CASSANDRA_RUN_DIR}/cassandra.pid)\n    echo \"OK: stopped cassandra\"\n    ;;\n  restart)\n    $0 stop\n    sleep 2\n    $0 start\n    ;;\n  *)\n    echo \"Usage: `basename $0` start|stop|restart\"\nesac\nexit 0\nEOS\n\n\n\u52d5\u4f5c\u78ba\u8a8d\nCassandra \u30ce\u30fc\u30c9\u3092\u8d77\u52d5\u3059\u308b\u3002\u4e00\u756a\u6700\u521d\u306b\u8d77\u52d5\u3059\u308b\u30ce\u30fc\u30c9\u306f seeds \u3067\u8a2d\u5b9a\u3057\u305f\u3069\u308c\u304b\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002Cluster \u5185\u306b seeds \u306b\u8a2d\u5b9a\u3057\u305f \u30ce\u30fc\u30c9\u304c 1 \u53f0\u3067\u3082\u3042\u308c\u3070\u826f\u3044\u305f\u3081\u3001\u6b21\u306b\u8d77\u52d5\u3059\u308b\u30ce\u30fc\u30c9\u306f\u3069\u308c\u3067\u3082\u304b\u307e\u308f\u306a\u3044\u3002\u6700\u5f8c\u306b\u4ed8\u5c5e\u306e nodetool \u30b3\u30de\u30f3\u30c9\u3067 Cluster \u306e\u60c5\u5831\u304c\u53d6\u5f97\u3059\u308b\u3002\n\u2605 \u30ce\u30fc\u30c9\u3092\u8d77\u52d5\u3059\u308b (\u540c\u69d8\u306b\u4ed6\u306e\u30b5\u30fc\u30d0\u3067\u3082\u884c\u306a\u3046)\n$ sudo /etc/init.d/cassandra start\nOK: running cassandra (pid=24225)\n\n\u2605 \u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u30ce\u30fc\u30c9\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u8868\u793a\u3059\u308b\n$ /opt/cassandra/bin/nodetool status\nDatacenter: datacenter1\n=======================\nStatus=Up/Down\n|/ State=Normal/Leaving/Joining/Moving\n--  Address        Load       Owns (effective)  Host ID                               Token                            Rack\nUN  10.0.0.1      76.43 KB   35.2%             52bdee4a-d815-4bf5-9795-9cb4c489a6f7  6225635841253981655               rack1\nUN  10.0.0.2      68.81 KB    8.5%             1d9329f3-3632-4697-bb2c-a96a3d306d0d  -263408352895507995               rack1\nUN  10.0.0.3       50.6 KB    4.2%             a46cc725-9a32-42a8-9290-e9c721769221  -2605039640550962807              rack1\nUN  10.0.0.4      62.12 KB   47.9%             b6fd7064-6da8-436e-ae53-1190f18ebcf9  -3385583403102781077              rack1\nUN  10.0.0.5      78.88 KB    4.2%             cb379e54-a0ec-42ce-a77e-98271502f4eb  -1824495877999144536              rack1\n\n\u2605 \u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u30ce\u30fc\u30c9\u306e\u30ea\u30f3\u30b0\u3092\u8868\u793a\u3059\u308b\n$ /opt/cassandra/bin/nodetool ring\nDatacenter: datacenter1\n==========\nReplicas: 1\n\nAddress        Rack        Status State   Load            Owns                Token\n                                                                              -1824495877999144536\n10.0.0.1       rack1       Up     Normal  76.43 KB        35.18%              6225635841253981655\n10.0.0.2       rack1       Up     Normal  68.81 KB        8.46%               -263408352895507995\n10.0.0.3       rack1       Up     Normal  50.6 KB         4.23%               -2605039640550962807\n10.0.0.4       rack1       Up     Normal  62.12 KB        47.90%              -3385583403102781077\n10.0.0.5       rack1       Up     Normal  78.88 KB        4.23%               -1824495877999144536\n\n\u2605 \u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u30ce\u30fc\u30c9\u306e\u60c5\u5831\u3092\u8868\u793a\u3059\u308b\n$ /opt/cassandra/bin/nodetool info\nToken            : 6225635841253981655\nID               : 52bdee4a-d815-4bf5-9795-9cb4c489a6f7\nGossip active    : true\nThrift active    : true\nLoad             : 76.43 KB\nGeneration No    : 1373623266\nUptime (seconds) : 1331\nHeap Memory (MB) : 123.28 / 3696.00\nData Center      : datacenter1\nRack             : rack1\nExceptions       : 0\nKey Cache        : size 824 (bytes), capacity 104857600 (bytes), 24 hits, 34 requests, 0.706 recent hit rate, 14400 save period in seconds\nRow Cache        : size 0 (bytes), capacity 0 (bytes), 0 hits, 0 requests, NaN recent hit rate, 0 save period in seconds\n\n\n\u304a\u308f\u308a\u306b\n\u3068\u308a\u3042\u3048\u305a CentOS 6.4 \u3067 Cassandra 1.2.6 \u304c\u52d5\u304f\u3088\u3046\u306b\u306a\u3063\u305f\u3002\u3053\u308c\u304b\u3089\u306f\u3001Cassandra 1.2 \u7cfb\u3067\u51fa\u6765\u308b\u3053\u3068\u3092\u8abf\u3079\u305f\u308a\u3084\u3089\u3001\u30ce\u30fc\u30c9\u969c\u5bb3\u6642\u306e\u6319\u52d5\u3084\u3089\u3092\u8abf\u3079\u3066\u3044\u304f\u3053\u3068\u306b\u306a\u308b\u3068\u601d\u3046\u3002\u3042\u308b\u7a0b\u5ea6\u305f\u3081\u305b\u305f\u3089\u3001\u307e\u305f\u5225\u8a18\u4e8b\u3067\u6295\u7a3f\u3057\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u53c2\u8003\u306b\u3057\u305f\u6587\u732e\u306a\u3069\n\nDatastax Apache Cassandra 1.2\nApache Cassandra 1.1.0\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u52d5\u4f5c\u78ba\u8a8d\nCassandra\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\nApache Cassandra\u3067NoSQL\u306b\u6311\u6226 \u524d\u7de8\nCassandra\u30e1\u30e2\u305d\u306e1(\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3001\u30c7\u30fc\u30bf\u30e2\u30c7\u30eb\u3001\u30c7\u30fc\u30bf\u64cd\u4f5c\u306b\u3064\u3044\u3066)\nCassandra \u306e\u81ea\u52d5\u8d77\u52d5 Shellscript\n\n\n## \u306f\u3058\u3081\u306b\n\nCentOS 6.4 \u74b0\u5883\u306b Cassandra 1.2.6 \u3092 tarball \u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u624b\u9806\u30e1\u30e2\u3092\u6b8b\u3057\u3066\u304a\u304f\u3002\u3068\u308a\u3042\u3048\u305a\u52d5\u4f5c\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u3002\u4eca\u56de\u306f 5 \u53f0\u306e\u7269\u7406\u30b5\u30fc\u30d0  (10.0.0.[1-5]) \u3092\u4f7f\u7528\u3057\u3001\u305d\u308c\u305e\u308c CentOS 6.4 \u304c\u30af\u30ea\u30fc\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3002\n\n```\n\u2605 Kernel \u3092\u78ba\u8a8d\u3059\u308b\n$ uname -a\nLinux localhost 2.6.32-358.11.1.el6.x86_64 #1 SMP Wed Jun 12 03:34:52 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux\n\n\u2605 \u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u3092\u78ba\u8a8d\u3059\u308b\n$ cat /etc/redhat-release\nCentOS release 6.4 (Final)\n```\n\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nCassandra \u306e\u52d5\u4f5c\u306b\u5fc5\u8981\u306a Java \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\u4eca\u56de\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u306a\u3046 Cassandra 1.2.6 \u3067\u306f\u3001OpenJDK-1.6.0_0 \u3092\u4f7f\u7528\u3059\u308b\u3068\u8d77\u52d5\u6642\u306b SEGMENT FAULT \u304c\u767a\u751f\u3057\u3066\u3057\u307e\u3046\u6319\u52d5\u304c\u78ba\u8a8d\u3067\u304d\u305f\u305f\u3081\u3001Oracle \u304c\u63d0\u4f9b\u3057\u3066\u3044\u308b SunJDK 1.6.0_45 \u3092\u4f7f\u7528\u3059\u308b\u3002\n\n```\n\u2605 SunJDK \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n$ chmod +x ./jdk-6u45-linux-x64-rpm.bin && sudo ./jdk-6u45-linux-x64-rpm.bin\nUnpacking...\nChecksumming...\nExtracting...\nUnZipSFX 5.50 of 17 February 2002, by Info-ZIP (Zip-Bugs@lists.wku.edu).\n  inflating: jdk-6u45-linux-amd64.rpm\n  inflating: sun-javadb-common-10.6.2-1.1.i386.rpm\n  inflating: sun-javadb-core-10.6.2-1.1.i386.rpm\n  inflating: sun-javadb-client-10.6.2-1.1.i386.rpm\n  inflating: sun-javadb-demo-10.6.2-1.1.i386.rpm\n  inflating: sun-javadb-docs-10.6.2-1.1.i386.rpm\n  inflating: sun-javadb-javadoc-10.6.2-1.1.i386.rpm\n\u6e96\u5099\u4e2d...                ########################################### [100%]\n   1:jdk                    ########################################### [100%]\nUnpacking JAR files...\n        rt.jar...\n        jsse.jar...\n        charsets.jar...\n        tools.jar...\n        localedata.jar...\n        plugin.jar...\n        javaws.jar...\n        deploy.jar...\nInstalling JavaDB\n\u6e96\u5099\u4e2d...                ########################################### [100%]\n   1:sun-javadb-common      ########################################### [ 17%]\n   2:sun-javadb-core        ########################################### [ 33%]\n   3:sun-javadb-client      ########################################### [ 50%]\n   4:sun-javadb-demo        ########################################### [ 67%]\n   5:sun-javadb-docs        ########################################### [ 83%]\n   6:sun-javadb-javadoc     ########################################### [100%]\nDone.\n\n\u2605 \u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\u3059\u308b\n$ java -version\njava version \"1.6.0_45\"\nJava(TM) SE Runtime Environment (build 1.6.0_45-b06)\nJava HotSpot(TM) 64-Bit Server VM (build 20.45-b01, mixed mode)\n```\n\nCassandra \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u306f DataStax \u304c\u63d0\u4f9b\u3057\u3066\u3044\u308b RPM \u3092\u4f7f\u3046\u3053\u3068\u3082\u3067\u304d\u308b\u304c\u3001Cassandra \u306f\u500b\u5225\u306b\u30d0\u30c3\u30c1\u3092\u5f53\u3066\u305f\u308a\u3059\u308b\u3053\u3068\u3082\u591a\u3044 (\u3067\u304d\u308c\u3070\u907f\u3051\u305f\u3044) \u3068\u601d\u308f\u308c\u308b\u306e\u3067\u3001\u4eca\u56de\u306f tarball \u304b\u3089 /opt/cassandra \u4ee5\u4e0b\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\n```\n\u2605 tarball \u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\n$ wget http://www.fightrice.com/mirrors/apache/cassandra/1.2.6/apache-cassandra-1.2.6-bin.tar.gz\n\n\u2605 \u5c55\u958b\u5f8c\u306b /opt/cassandra \u4ee5\u4e0b\u306b\u79fb\u52d5\u3059\u308b\n$ tar xvzf apache-cassandra-1.2.6-bin.tar.gz && sudo mv ./apache-cassandra-1.2.6 /opt/ && sudo ln -s /opt/apache-cassandra-1.2.6 /opt/cassandra\n\n\u2605 \u30ed\u30b0\u3068\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\n$ sudo mkdir -p /var/log/cassandra && sudo mkdir -p /var/lib/cassandra\n```\n\n## \u8a2d\u5b9a\n\nCassandra \u3092\u8a2d\u5b9a\u3059\u308b\u3002\u3068\u308a\u3042\u3048\u305a\u52d5\u304b\u3059\u305f\u3081\u306b \"seeds\", \"listen_address\", \"rpc_address\" \u306e 3 \u30ab\u6240\u3092\u5909\u66f4\u3059\u308b\u3002\u4eca\u56de\u306f 4 \u53f0\u306e\u7269\u7406\u30b5\u30fc\u30d0\u306e\u3046\u3061\u30013 \u53f0\u3092 seed \u3068\u3059\u308b\u3002\u307e\u305f \"listen_address\" \u306f\u3001\u4e92\u3044\u306b\u63a5\u7d9a\u3067\u304d\u308b IP \u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n```\n\u2605 \u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b (\u30b5\u30fc\u30d0 10.0.0.1 \u306e\u5834\u5408\u306e\u8a2d\u5b9a\u4f8b)\n$ sudo vim /opt/cassandra/conf/cassandra.yaml\n... (snip) ...\n# any class that implements the SeedProvider interface and has a\n# constructor that takes a Map<String, String> of parameters will do.\nseed_provider:\n    # Addresses of hosts that are deemed contact points.\n    # Cassandra nodes use this list of hosts to find each other and learn\n    # the topology of the ring.  You must change this if you are running\n    # multiple nodes!\n    - class_name: org.apache.cassandra.locator.SimpleSeedProvider\n      parameters:\n          # seeds is actually a comma-delimited list of addresses.\n          # Ex: \"<ip1>,<ip2>,<ip3>\"\n          - seeds: \"10.0.0.1, 10.0.0.2, 10.0.0.3\"\n... (snip) ...\n# Address to bind to and tell other Cassandra nodes to connect to. You\n# _must_ change this if you want multiple nodes to be able to\n# communicate!\n#\n# Leaving it blank leaves it up to InetAddress.getLocalHost(). This\n# will always do the Right Thing _if_ the node is properly configured\n# (hostname, name resolution, etc), and the Right Thing is to use the\n# address associated with the hostname (it might not be).\n#\n# Setting this to 0.0.0.0 is always wrong.\nlisten_address: 10.0.0.1\n... (snip) ...\n# The address to bind the Thrift RPC service to -- clients connect\n# here. Unlike ListenAddress above, you _can_ specify 0.0.0.0 here if\n# you want Thrift to listen on all interfaces.\n#\n# Leaving this blank has the same effect it does for ListenAddress,\n# (i.e. it will be based on the configured hostname of the node).\nrpc_address: 0.0.0.0\n... (snip) ...\n```\n\nCassandra \u306e\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3059\u308b\u3002\u7d50\u5c40\u306f /opt/cassandra/bin/cassandra \u30b7\u30a7\u30eb\u3092\u547c\u3073\u51fa\u3059\u3060\u3051\u3060\u304c\u3001\u3044\u308d\u3044\u308d\u3068\u9762\u5012\u306a\u306e\u3067\u7c21\u6613\u7684\u306b\u4f5c\u6210\u3057\u3066\u304a\u304f\u3002Cassandra \u306e PID \u3092\u30d5\u30a1\u30a4\u30eb\u3067\u7ba1\u7406\u3057\u3001\u6a19\u6e96\u51fa\u529b\u304a\u3088\u3073\u6a19\u6e96\u30a8\u30e9\u30fc\u51fa\u529b\u306f\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3059\u308b\u3002\n\n```\n\u2605 \u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3059\u308b\n$ sudo cat << 'EOS' > /etc/init.d/cassandra && sudo chmod +x /etc/init.d/cassandra\n#!/bin/sh\nCASSANDRA_ROOT_DIR=/opt/cassandra\nCASSANDRA_BIN_DIR=${CASSANDRA_ROOT_DIR}/bin\nCASSANDRA_LOG_DIR=/var/log/cassandra\nCASSANDRA_RUN_DIR=/var/run/cassandra\ncase \"$1\" in\n  start)\n    if [ ! -d ${CASSANDRA_LOG_DIR} ]; then\n      mkdir ${CASSANDRA_LOG_DIR}\n    fi\n    if [ ! -d ${CASSANDRA_RUN_DIR} ]; then\n      mkdir ${CASSANDRA_RUN_DIR}\n    fi\n    if [ -e ${CASSANDRA_RUN_DIR}/cassandra.pid ]; then\n      if [ 1 -ne $(ps $(cat ${CASSANDRA_RUN_DIR}/cassandra.pid) | wc -l) ]; then\n        echo \"NG: already running (pid=$(cat ${CASSANDRA_RUN_DIR}/cassandra.pid))\"\n        exit 1\n      fi\n    fi\n    ${CASSANDRA_BIN_DIR}/cassandra -p ${CASSANDRA_RUN_DIR}/cassandra.pid >> ${CASSANDRA_LOG_DIR}/cassandra.log 2>&1\n    echo \"OK: running cassandra (pid=$(cat ${CASSANDRA_RUN_DIR}/cassandra.pid))\"\n    ;;\n  stop)\n    kill $(cat ${CASSANDRA_RUN_DIR}/cassandra.pid)\n    echo \"OK: stopped cassandra\"\n    ;;\n  restart)\n    $0 stop\n    sleep 2\n    $0 start\n    ;;\n  *)\n    echo \"Usage: `basename $0` start|stop|restart\"\nesac\nexit 0\nEOS\n```\n\n## \u52d5\u4f5c\u78ba\u8a8d\n\nCassandra \u30ce\u30fc\u30c9\u3092\u8d77\u52d5\u3059\u308b\u3002\u4e00\u756a\u6700\u521d\u306b\u8d77\u52d5\u3059\u308b\u30ce\u30fc\u30c9\u306f seeds \u3067\u8a2d\u5b9a\u3057\u305f\u3069\u308c\u304b\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002Cluster \u5185\u306b seeds \u306b\u8a2d\u5b9a\u3057\u305f \u30ce\u30fc\u30c9\u304c 1 \u53f0\u3067\u3082\u3042\u308c\u3070\u826f\u3044\u305f\u3081\u3001\u6b21\u306b\u8d77\u52d5\u3059\u308b\u30ce\u30fc\u30c9\u306f\u3069\u308c\u3067\u3082\u304b\u307e\u308f\u306a\u3044\u3002\u6700\u5f8c\u306b\u4ed8\u5c5e\u306e nodetool \u30b3\u30de\u30f3\u30c9\u3067 Cluster \u306e\u60c5\u5831\u304c\u53d6\u5f97\u3059\u308b\u3002\n\n```\n\u2605 \u30ce\u30fc\u30c9\u3092\u8d77\u52d5\u3059\u308b (\u540c\u69d8\u306b\u4ed6\u306e\u30b5\u30fc\u30d0\u3067\u3082\u884c\u306a\u3046)\n$ sudo /etc/init.d/cassandra start\nOK: running cassandra (pid=24225)\n\n\u2605 \u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u30ce\u30fc\u30c9\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u8868\u793a\u3059\u308b\n$ /opt/cassandra/bin/nodetool status\nDatacenter: datacenter1\n=======================\nStatus=Up/Down\n|/ State=Normal/Leaving/Joining/Moving\n--  Address        Load       Owns (effective)  Host ID                               Token                            Rack\nUN  10.0.0.1      76.43 KB   35.2%             52bdee4a-d815-4bf5-9795-9cb4c489a6f7  6225635841253981655               rack1\nUN  10.0.0.2      68.81 KB    8.5%             1d9329f3-3632-4697-bb2c-a96a3d306d0d  -263408352895507995               rack1\nUN  10.0.0.3       50.6 KB    4.2%             a46cc725-9a32-42a8-9290-e9c721769221  -2605039640550962807              rack1\nUN  10.0.0.4      62.12 KB   47.9%             b6fd7064-6da8-436e-ae53-1190f18ebcf9  -3385583403102781077              rack1\nUN  10.0.0.5      78.88 KB    4.2%             cb379e54-a0ec-42ce-a77e-98271502f4eb  -1824495877999144536              rack1\n\n\u2605 \u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u30ce\u30fc\u30c9\u306e\u30ea\u30f3\u30b0\u3092\u8868\u793a\u3059\u308b\n$ /opt/cassandra/bin/nodetool ring\nDatacenter: datacenter1\n==========\nReplicas: 1\n\nAddress        Rack        Status State   Load            Owns                Token\n                                                                              -1824495877999144536\n10.0.0.1       rack1       Up     Normal  76.43 KB        35.18%              6225635841253981655\n10.0.0.2       rack1       Up     Normal  68.81 KB        8.46%               -263408352895507995\n10.0.0.3       rack1       Up     Normal  50.6 KB         4.23%               -2605039640550962807\n10.0.0.4       rack1       Up     Normal  62.12 KB        47.90%              -3385583403102781077\n10.0.0.5       rack1       Up     Normal  78.88 KB        4.23%               -1824495877999144536\n\n\u2605 \u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u30ce\u30fc\u30c9\u306e\u60c5\u5831\u3092\u8868\u793a\u3059\u308b\n$ /opt/cassandra/bin/nodetool info\nToken            : 6225635841253981655\nID               : 52bdee4a-d815-4bf5-9795-9cb4c489a6f7\nGossip active    : true\nThrift active    : true\nLoad             : 76.43 KB\nGeneration No    : 1373623266\nUptime (seconds) : 1331\nHeap Memory (MB) : 123.28 / 3696.00\nData Center      : datacenter1\nRack             : rack1\nExceptions       : 0\nKey Cache        : size 824 (bytes), capacity 104857600 (bytes), 24 hits, 34 requests, 0.706 recent hit rate, 14400 save period in seconds\nRow Cache        : size 0 (bytes), capacity 0 (bytes), 0 hits, 0 requests, NaN recent hit rate, 0 save period in seconds\n```\n\n## \u304a\u308f\u308a\u306b\n\n\u3068\u308a\u3042\u3048\u305a CentOS 6.4 \u3067 Cassandra 1.2.6 \u304c\u52d5\u304f\u3088\u3046\u306b\u306a\u3063\u305f\u3002\u3053\u308c\u304b\u3089\u306f\u3001Cassandra 1.2 \u7cfb\u3067\u51fa\u6765\u308b\u3053\u3068\u3092\u8abf\u3079\u305f\u308a\u3084\u3089\u3001\u30ce\u30fc\u30c9\u969c\u5bb3\u6642\u306e\u6319\u52d5\u3084\u3089\u3092\u8abf\u3079\u3066\u3044\u304f\u3053\u3068\u306b\u306a\u308b\u3068\u601d\u3046\u3002\u3042\u308b\u7a0b\u5ea6\u305f\u3081\u305b\u305f\u3089\u3001\u307e\u305f\u5225\u8a18\u4e8b\u3067\u6295\u7a3f\u3057\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n## \u53c2\u8003\u306b\u3057\u305f\u6587\u732e\u306a\u3069\n\n* [Datastax Apache Cassandra 1.2](http://www.datastax.com/documentation/cassandra/1.2/index.html)\n* [Apache Cassandra 1.1.0\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u52d5\u4f5c\u78ba\u8a8d](http://seijimomoto.blogspot.jp/2012/05/apache-cassandra-110.html)\n* [Cassandra\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7](http://metasearch.sourceforge.jp/wiki/index.php?Cassandra\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7#z895a637)\n* [Apache Cassandra\u3067NoSQL\u306b\u6311\u6226 \u524d\u7de8](http://blog.gmocloud.com/?p=560)\n* [Cassandra\u30e1\u30e2\u305d\u306e1(\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3001\u30c7\u30fc\u30bf\u30e2\u30c7\u30eb\u3001\u30c7\u30fc\u30bf\u64cd\u4f5c\u306b\u3064\u3044\u3066)](https://hiroakis.com/blog/2012/10/17/cassandra\u30e1\u30e2\u305d\u306e1\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3001\u30c7\u30fc\u30bf\u30e2\u30c7\u30eb\u3001\u30c7\u30fc\u30bf/)\n* [Cassandra \u306e\u81ea\u52d5\u8d77\u52d5 Shellscript](http://d.hatena.ne.jp/proxy0721/20100717/1279368987)\n", "tags": ["Cassandra"]}