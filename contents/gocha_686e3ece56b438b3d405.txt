{"context": "HSP3 (Hot Soup Processor 3) \u3067\u306f\u3001\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u306b\u542b\u3081\u308b\u30a2\u30fc\u30ab\u30a4\u30d6\u306b\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u304c\u4ed8\u4e0e\u3055\u308c\u3066\u3044\u3066\u3001\u30a2\u30fc\u30ab\u30a4\u30d6\u306e\u5185\u5bb9\u3092\u6539\u5909\u3059\u308b\u3068\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u30a8\u30e9\u30fc\u3067\u8d77\u52d5\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3057\u304b\u3057\u3001HSP3 \u306e\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u306f\u975e\u5e38\u306b\u7c21\u5358\u306b\u8a08\u7b97\u3067\u304d\u307e\u3059\u3002\n\n\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u8a08\u7b97\u30b9\u30af\u30ea\u30d7\u30c8\n\u4ee5\u4e0b\u3001\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u3092\u8a08\u7b97\u3059\u308b HSP3 \u306e\u30bd\u30fc\u30b9\u3067\u3059\u3002\n; \u30d5\u30a1\u30a4\u30eb\u8aad\u307f\u8fbc\u307f\ndialog \"exe\", 16\nif (stat == 0) {\n    end\n}\nfilename = refstr\nexist filename\nfilesize = strsize\nsdim buf, filesize + 1\nbload filename, buf, filesize\n\n;; \u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u304b\n;if (peek(buf, 0) != 'M' | peek(buf, 1) != 'Z') {\n;   dialog \"\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u3067\u306f\u3042\u308a\u307e\u305b\u3093\"\n;   end\n;}\n;\n;; PE (Portable Executable) Header \u306e\u4f4d\u7f6e\u3092\u53d6\u5f97\n;peOffset = lpeek(buf, 0x3c)\n;\n;; PE \u304b\n;if (peek(buf, peOffset) != 'P' | peek(buf, peOffset + 1) != 'E' | peek(buf, peOffset + 2) != 0 | peek(buf, peOffset + 3) != 0) {\n;   dialog \"PE \u3067\u306f\u3042\u308a\u307e\u305b\u3093\"\n;   end\n;}\n\n; \u5b9f\u884c\u6642\u30aa\u30d7\u30b7\u30e7\u30f3\u9818\u57df(HSPHED)\u3092\u691c\u7d22\n; \u5148\u982d\u306b DPM offset - 0x10000 \u304c10\u9032\u6570\u3067\u66f8\u304b\u308c\u3066\u3044\u308b\u306e\u3067\n; \u3053\u3053\u3067\u306f\u3057\u3089\u307f\u3064\u3076\u3057\u306b\u305d\u308c\u3089\u3057\u3044\u7b87\u6240\u3092\u63a2\u3059 (\u9069\u5f53)\nhedoffset = -1\nrepeat filesize\n    offset = cnt\n    c = peek(buf, offset)\n    if ((c >= '0' & c <= '9') | c == '+' | c == '-') {\n        getstr offsetstr, buf, offset, 0, 10\n        tmpoffset = int(offsetstr) + 0x10000\n        if (tmpoffset >= 0 & (tmpoffset + 3) < filesize) {\n            if (peek(buf, tmpoffset) == 'D' & peek(buf, tmpoffset + 1) == 'P' & peek(buf, tmpoffset + 2) == 'M' & peek(buf, tmpoffset + 3) == 'X') {\n                hedoffset = offset\n                dpmoffset = tmpoffset\n                break\n            }\n        }\n    }\nloop\nif (hedoffset < 0) {\n    dialog \"HSPHED \u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\"\n    end\n}\n\nsumHED = wpeek(buf, hedoffset + 0x14)\ncryptKey4 = peek(buf, hedoffset + 0x17 + 3)\n\nsumDPM = 0\ndpmsize = filesize - dpmoffset\n; (DPM \u4ee5\u964d\u306e\u30d0\u30a4\u30ca\u30ea\u306e) \u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u3092\u8a08\u7b97\nrepeat dpmsize, dpmoffset\n    offset = cnt\n    sumDPM += peek(buf, offset)\n\n    ; \u30eb\u30fc\u30d7\u5916\u3067\u8db3\u3057\u3066\u3082\u554f\u984c\u306a\u3044\u306f\u305a\u306a\u306e\u3067\n    ; \u30eb\u30fc\u30d7\u5916\u3067\u52a0\u7b97\n    ; sumDPM += (cryptKey4 / 7)\nloop\nsumDPM += (cryptKey4 / 7) * dpmsize\nsumDPM = sumDPM & 0xffff\n\nif (sumDPM == sumHED) {\n    dialog \"\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u304c\u4e00\u81f4\u3057\u307e\u3057\u305f \" + strf(\"%04X\", sumDPM)\n}\nelse {\n    dialog \"\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u304c\u4e00\u81f4\u3057\u307e\u305b\u3093 \" + strf(\"%04X\", sumHED) + \" / \" + strf(\"%04X\", sumDPM)\n}\nend\n\nHSP3 (Hot Soup Processor 3) \u3067\u306f\u3001\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u306b\u542b\u3081\u308b\u30a2\u30fc\u30ab\u30a4\u30d6\u306b\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u304c\u4ed8\u4e0e\u3055\u308c\u3066\u3044\u3066\u3001\u30a2\u30fc\u30ab\u30a4\u30d6\u306e\u5185\u5bb9\u3092\u6539\u5909\u3059\u308b\u3068\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u30a8\u30e9\u30fc\u3067\u8d77\u52d5\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u3057\u304b\u3057\u3001HSP3 \u306e\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u306f\u975e\u5e38\u306b\u7c21\u5358\u306b\u8a08\u7b97\u3067\u304d\u307e\u3059\u3002\n\n## \u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u8a08\u7b97\u30b9\u30af\u30ea\u30d7\u30c8\n\n\u4ee5\u4e0b\u3001\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u3092\u8a08\u7b97\u3059\u308b HSP3 \u306e\u30bd\u30fc\u30b9\u3067\u3059\u3002\n\n```\n; \u30d5\u30a1\u30a4\u30eb\u8aad\u307f\u8fbc\u307f\ndialog \"exe\", 16\nif (stat == 0) {\n\tend\n}\nfilename = refstr\nexist filename\nfilesize = strsize\nsdim buf, filesize + 1\nbload filename, buf, filesize\n\n;; \u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u304b\n;if (peek(buf, 0) != 'M' | peek(buf, 1) != 'Z') {\n;\tdialog \"\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u3067\u306f\u3042\u308a\u307e\u305b\u3093\"\n;\tend\n;}\n;\n;; PE (Portable Executable) Header \u306e\u4f4d\u7f6e\u3092\u53d6\u5f97\n;peOffset = lpeek(buf, 0x3c)\n;\n;; PE \u304b\n;if (peek(buf, peOffset) != 'P' | peek(buf, peOffset + 1) != 'E' | peek(buf, peOffset + 2) != 0 | peek(buf, peOffset + 3) != 0) {\n;\tdialog \"PE \u3067\u306f\u3042\u308a\u307e\u305b\u3093\"\n;\tend\n;}\n\n; \u5b9f\u884c\u6642\u30aa\u30d7\u30b7\u30e7\u30f3\u9818\u57df(HSPHED)\u3092\u691c\u7d22\n; \u5148\u982d\u306b DPM offset - 0x10000 \u304c10\u9032\u6570\u3067\u66f8\u304b\u308c\u3066\u3044\u308b\u306e\u3067\n; \u3053\u3053\u3067\u306f\u3057\u3089\u307f\u3064\u3076\u3057\u306b\u305d\u308c\u3089\u3057\u3044\u7b87\u6240\u3092\u63a2\u3059 (\u9069\u5f53)\nhedoffset = -1\nrepeat filesize\n\toffset = cnt\n\tc = peek(buf, offset)\n\tif ((c >= '0' & c <= '9') | c == '+' | c == '-') {\n\t\tgetstr offsetstr, buf, offset, 0, 10\n\t\ttmpoffset = int(offsetstr) + 0x10000\n\t\tif (tmpoffset >= 0 & (tmpoffset + 3) < filesize) {\n\t\t\tif (peek(buf, tmpoffset) == 'D' & peek(buf, tmpoffset + 1) == 'P' & peek(buf, tmpoffset + 2) == 'M' & peek(buf, tmpoffset + 3) == 'X') {\n\t\t\t\thedoffset = offset\n\t\t\t\tdpmoffset = tmpoffset\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\nloop\nif (hedoffset < 0) {\n\tdialog \"HSPHED \u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\"\n\tend\n}\n\nsumHED = wpeek(buf, hedoffset + 0x14)\ncryptKey4 = peek(buf, hedoffset + 0x17 + 3)\n\nsumDPM = 0\ndpmsize = filesize - dpmoffset\n; (DPM \u4ee5\u964d\u306e\u30d0\u30a4\u30ca\u30ea\u306e) \u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u3092\u8a08\u7b97\nrepeat dpmsize, dpmoffset\n\toffset = cnt\n\tsumDPM += peek(buf, offset)\n\n\t; \u30eb\u30fc\u30d7\u5916\u3067\u8db3\u3057\u3066\u3082\u554f\u984c\u306a\u3044\u306f\u305a\u306a\u306e\u3067\n\t; \u30eb\u30fc\u30d7\u5916\u3067\u52a0\u7b97\n\t; sumDPM += (cryptKey4 / 7)\nloop\nsumDPM += (cryptKey4 / 7) * dpmsize\nsumDPM = sumDPM & 0xffff\n\nif (sumDPM == sumHED) {\n\tdialog \"\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u304c\u4e00\u81f4\u3057\u307e\u3057\u305f \" + strf(\"%04X\", sumDPM)\n}\nelse {\n\tdialog \"\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u304c\u4e00\u81f4\u3057\u307e\u305b\u3093 \" + strf(\"%04X\", sumHED) + \" / \" + strf(\"%04X\", sumDPM)\n}\nend\n```\n", "tags": ["HSP"]}