{"context": " More than 1 year has passed since last update.\u4e57\u308a\u304b\u304b\u3063\u305f\u8239\u306a\u306e\u3067\u3002\u3002\u3002\n\n\u691c\u7d22\u30d5\u30ed\u30fc\u306e\u5b9f\u88c5\n\n\u30d5\u30ed\u30fc\u5b9a\u7fa9\n\u307e\u305a\u306f\u5358\u7d14\u306a\u753b\u9762\u9077\u79fb\u306e\u307f\u3092\u884c\u3046\u30d5\u30ed\u30fc\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\nflow-search.xml\u306f\u300c/src/main/resources/templates/search\u300d\u76f4\u4e0b\u306b\u914d\u7f6e\u3057\u307e\u3059\u3002\n\nflow-search.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<flow  \n    xmlns=\"http://www.springframework.org/schema/webflow\"\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n    xsi:schemaLocation=\"http://www.springframework.org/schema/webflow\n                          http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd\">\n    <!-- \u691c\u7d22\u30c8\u30c3\u30d7\u753b\u9762 -->\n    <view-state id=\"top\" view=\"/search/top\">\n        <transition on=\"search\" to=\"result\"/>\n    </view-state>\n\n    <!-- \u691c\u7d22\u30c8\u30c3\u30d7\u753b\u9762\uff08\u691c\u7d22\u7d50\u679c\u8868\u793a\u72b6\u614b\uff09 \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306f\u540c\u3058-->\n    <view-state id=\"result\" view=\"/search/top\">\n        <transition on=\"search\" to=\"result\"/>\n        <transition on=\"detail\" to=\"detail\"/>\n    </view-state>\n\n    <!-- \u8a73\u7d30\u753b\u9762 -->\n    <view-state id=\"detail\" view=\"/search/detail\">\n       <transition on=\"back\" to=\"top\"/>\n    </view-state>\n</flow>\n\n\n\n\u8a2d\u5b9a\n\nWebConfig.java\npackage flowapp;\n\n@Configuration\npublic class WebFlowConfig extends AbstractFlowConfiguration {\n\n    @Autowired\n    SpringTemplateEngine templateEngine;\n\n    /**\n     * WebFlow \u3092\u5229\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u3001enfoce=true\u3060\u6587\u5b57\u5316\u3051\u3059\u308b\u3002\n     * @return\n     */\n    @Bean\n    public CharacterEncodingFilter characterEncodingFilter() {\n\n        CharacterEncodingFilter filter = new CharacterEncodingFilter();\n        filter.setEncoding(\"UTF-8\");\n        filter.setForceEncoding(false);\n        return filter;\n    }\n\n    /**\n     * \u30d5\u30ed\u30fc\u5b9a\u7fa9\u3092\u914d\u7f6e\u3059\u308b\u30eb\u30fc\u30c8\u30d5\u30a9\u30eb\u30c0\u3092\u5b9a\u7fa9\u3002\n     * \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3068\u540c\u3058\u968e\u5c64\u306b\u3059\u308b\u305f\u3081\u3001Spring boot\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u300ctemplates\u300d\u30d5\u30a9\u30eb\u30c0\u3092\u6307\u5b9a\n     * @return\n     */\n    @Bean\n    public FlowDefinitionRegistry flowRegistry() {\n        return getFlowDefinitionRegistryBuilder()\n                .setBasePath(\"classpath:templates\")\n                .addFlowLocationPattern(\"/**/flow-*.xml\")\n                .setFlowBuilderServices(flowBuilderServices()).build();\n    }\n\n    @Bean\n    public FlowBuilderServices flowBuilderServices() {\n        return getFlowBuilderServicesBuilder()\n                .setViewFactoryCreator(viewFactoryCreator())\n                .setValidator(validator())\n                .setDevelopmentMode(true)\n                .build();\n    }\n\n    @Bean\n    public Validator validator(){\n        return new LocalValidatorFactoryBean();\n    }\n\n    @Bean\n    public ViewFactoryCreator viewFactoryCreator() {\n        MvcViewFactoryCreator bean = new MvcViewFactoryCreator();\n        bean.setViewResolvers(Arrays.asList(viewResolver()));               \n        bean.setUseSpringBeanBinding(true);\n        return bean;\n    }\n\n    @Bean\n    public FlowExecutor flowExecutor() {\n        return getFlowExecutorBuilder(flowRegistry())\n                .build();\n    }\n\n    @Bean\n    public FlowHandlerAdapter flowHandler() {\n        FlowHandlerAdapter bean = new FlowHandlerAdapter();\n        bean.setFlowExecutor(flowExecutor());\n        bean.setSaveOutputToFlashScopeOnRedirect(true);\n        return bean;\n    }\n\n    @Bean\n    public FlowHandlerMapping flowHandlerMapping() {\n        FlowHandlerMapping bean = new FlowHandlerMapping();\n        bean.setFlowRegistry(flowRegistry());\n        bean.setOrder(0);\n        return bean;\n    }\n\n    @Bean\n    public AjaxThymeleafViewResolver viewResolver() {\n        AjaxThymeleafViewResolver viewResolver = new AjaxThymeleafViewResolver();\n        viewResolver.setViewClass(FlowAjaxThymeleafView.class);\n        viewResolver.setTemplateEngine(templateEngine);\n        viewResolver.setCharacterEncoding(\"UTF-8\");\n        return viewResolver;\n    }\n}\n\n\n\n\u30d5\u30ed\u30fc\u5b9a\u7fa9\u306e\u30c6\u30b9\u30c8\nAbstractXmlFlowExecutionTests\u306f\u30b9\u30fc\u30d1\u30fc\u30af\u30e9\u30b9\u3068\u306a\u308b\u305f\u3081\u3001Spock\u3067\u4f7f\u3046\u305f\u3081\u306bTestRule\u30af\u30e9\u30b9\u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\uff08\u591a\u5206\u3001\u4f55\u304b\u30d0\u30b0\u306f\u3042\u308b\u3002\uff09\n\nFlowExecutionTestsRule.java\npackage flowapp.test;\n\npublic class FlowExecutionTestsRule extends AbstractXmlFlowExecutionTests\n        implements TestRule {\n\n    private String flowDefPath;\n    private Map<String, Object> registoredBeans = new HashMap<>();\n\n    public FlowExecutionTestsRule(String flowDefPath) {\n        super();\n        this.flowDefPath = flowDefPath;\n    }\n\n    public void registorBean(String beanName, Object bean) {\n        registoredBeans.put(beanName, bean);\n    }\n\n    @Override\n    public Statement apply(Statement base, Description description) {\n        return new Statement() {\n\n            @Override\n            public void evaluate() throws Throwable {\n                base.evaluate();\n            }\n        };\n    }\n\n    @Override\n    protected FlowDefinitionResource getResource(\n            FlowDefinitionResourceFactory resourceFactory) {\n        return resourceFactory.createFileResource(flowDefPath);\n    }\n\n    @Override\n    protected void configureFlowBuilderContext(\n            MockFlowBuilderContext builderContext) {\n\n        registoredBeans.entrySet().forEach(e -> \n          builderContext.registerBean(e.getKey(), e.getValue())\n          );\n    }\n\n}\n\n\n\n\u30c6\u30b9\u30c8\u30af\u30e9\u30b9\u3002\n\nSearchFlowSpec\npackage flowapp;\n\nclass SearchFlowSpec extends Specification{\n\n    @Rule\n    public FlowExecutionTestsRule flowExecutionTestsRule = new FlowExecutionTestsRule(\"src/main/resources/templates/search/flow-search.xml\");\n\n\n    def \"\u30d5\u30ed\u30fc\u306e\u521d\u671f\u5316\"() {\n        when:\n        MockExternalContext context = new MockExternalContext();\n        flowExecutionTestsRule.startFlow(context);\n\n        then:\n        flowExecutionTestsRule.assertCurrentStateEquals(\"top\");\n    }\n\n    def \"\u753b\u9762\u9077\u79fb\u306e\u30c6\u30b9\u30c8\"(){\n        setup:\n        MockExternalContext context = new MockExternalContext();\n\n        when:\n        flowExecutionTestsRule.setCurrentState(currentState)\n        context.setEventId(eventId)\n        flowExecutionTestsRule.resumeFlow(context)\n\n        then:\n        flowExecutionTestsRule.assertCurrentStateEquals(resultState);\n\n        where:\n        currentState|eventId |resultState\n        \"top\"       |\"search\"|\"result\"\n        \"result\"    |\"search\"|\"result\"\n        \"result\"    |\"detail\"|\"detail\"\n        \"detail\"    |\"back\"  |\"top\"\n    }\n\n}\n\n\n\u3053\u306e\u6bb5\u968e\u3067\u306f\u3001\u307e\u3060\u3001\u753b\u9762\u3068\u306e\u7d50\u5408\u306f\u3067\u304d\u3066\u3044\u307e\u305b\u3093\u3002\n\n\u753b\u9762\u306e\u4f5c\u6210\n\u30e2\u30c3\u30af\u753b\u9762\u3092\u4f5c\u6210\u3057\u3066\u3001\u9077\u79fb\u306e\u52d5\u4f5c\u78ba\u8a8d\u3092\u3057\u307e\u3059\u3002\nsrc/main/resources/search\u76f4\u4e0b\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\ntop.html\n<!DOCTYPE html>\n<html xmlns=\"http://www.w3.org/1999/xhtml\"\n    xmlns:th=\"http://www.thymeleaf.org\"\n    xmlns:tiles=\"http://www.thymeleaf.org\"\n    xmlns:sec=\"http://www.thymeleaf.org\" lang=\"jp\">\n<head>\n<meta charset=\"UTF-8\" />\n<title>\u691c\u7d22\u753b\u9762</title>\n</head>\n<body>\n    <!-- \u30b9\u30c6\u30fc\u30c8ID\u3092\u8868\u793a -->\n    <span th:text=\"${flowRequestContext.currentState.id}\"></span>\n    <form action=\"#\" th:action=\"${flowExecutionUrl}\" method=\"POST\">\n        <table>\n            <tr>\n                <td>ISBN</td>\n                <td><input type=\"text\" name=\"isbn\" /></td>\n            </tr>\n            <tr>\n                <td>\u30bf\u30a4\u30c8\u30eb</td>\n                <td><input type=\"text\" name=\"title\" /></td>\n            </tr>\n        </table>\n        <input type=\"submit\" name=\"_eventId_search\" value=\"\u691c\u7d22\" />\n        <table>\n            <tr>\n                <th>ISBN</th>\n                <th>\u30bf\u30a4\u30c8\u30eb</th>\n                <th>\u8a73\u7d30</th>\n            </tr>\n            <tr>\n                <td>1234567890</td>\n                <td>\u30bf\u30a4\u30c8\u30eb1</td>\n                <td><a href=\"#\" th:href=\"@{${flowExecutionUrl}(_eventId='detail')}\">\u8a73\u7d30</a></td>\n            </tr>\n            <tr> <td>1234567891</td>\n                <td>\u30bf\u30a4\u30c8\u30eb2</td>\n                <td><a href=\"#\" th:href=\"@{${flowExecutionUrl}(_eventId='detail')}\">\u8a73\u7d30</a></td></tr>\n        </table>\n    </form>\n</body>\n</html>\n\n\n\ndetail.html\n<!DOCTYPE html>\n<html xmlns=\"http://www.w3.org/1999/xhtml\"\n    xmlns:th=\"http://www.thymeleaf.org\"\n    xmlns:tiles=\"http://www.thymeleaf.org\"\n    xmlns:sec=\"http://www.thymeleaf.org\" lang=\"en\">\n<head>\n<script type=\"text/javascript\" th:src=\"@{/resources/dojo/dojo.js}\"></script>\n<script type=\"text/javascript\" th:src=\"@{/resources/spring/Spring.js}\"></script>\n<script type=\"text/javascript\"\n    th:src=\"@{/resources/spring/Spring-Dojo.js}\"></script>\n<meta charset=\"UTF-8\" />\n<title>\u8a73\u7d30</title>\n</head>\n<body>\n    <form action=\"\" th:action=\"${flowExecutionUrl}\" method=\"POST\">\n        <table>\n            <tr>\n                <th>ISBN</th>\n                <td>1234567891</td>\n            </tr>\n            <tr>\n                <th>\u30bf\u30a4\u30c8\u30eb</th>\n                <td>\u30bf\u30a4\u30c8\u30eb2</td></tr>\n        </table>\n        <input type=\"submit\" name=\"_eventId_back\" value=\"\u623b\u308b\" />\n    </form>\n</body>\n</html>\n\n\n\n\u30a4\u30d9\u30f3\u30c8ID\n\u30b9\u30c6\u30fc\u30c8\u306e\u9077\u79fb\u306b\u5229\u7528\u3055\u308c\u308beventId\u306f\u3001submit\u6642\u306ename\u5c5e\u6027\u306e\u307b\u304b\u3001queryString\u3067\u3082\u6e21\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u52d5\u4f5c\u78ba\u8a8d\ngradle bootRun,\u3082\u3057\u304f\u306f\u3001IDE\u4e0a\u304b\u3089Application\u30af\u30e9\u30b9\u3092\u5b9f\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u4e0b\u8a18\u306e\u901a\u308a\u306b\u9077\u79fb\u3059\u308b\u3068\u6b63\u5e38\u306b\u9077\u79fb\u3067\u304d\u307e\u3059\u3002\ntop\u2192result\u2192detail\u2192top\n\u3057\u304b\u3057\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306a\u30d5\u30ed\u30fc\u5b9a\u7fa9\u306b\u8a18\u8f09\u304c\u306a\u3044\u9077\u79fb\u306f\u3067\u304d\u307e\u305b\u3093\u3002\ntop\u2192detail\n\u672c\u6765\u306a\u3089\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067\u3082\u64cd\u4f5c\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u5236\u5fa1\u3059\u308b\u3079\u304d\u3067\u3059\u304c\u3001\u307e\u305a\u306f\u3001\u30b5\u30fc\u30d0\u5074\u3067\u3057\u3063\u304b\u308a\u30c1\u30a7\u30c3\u30af\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u5b89\u5fc3\u3067\u3059\u3002\n\n\u5b9f\u884c\u30ad\u30fc\n\u5b9f\u884c\u306fqueryString\u306b\u6e21\u3055\u308c\u308b\u5b9f\u884c\u30ad\u30fc\uff08execution=exsx\uff09\u306b\u3088\u3063\u3066\u7ba1\u7406\u3055\u308c\u307e\u3059\u3002x\u306f\u81ea\u52d5\u3067\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30c8\u3055\u308c\u3066\u3044\u304d\u307e\u3059\u3002\u30e1\u30cb\u30e5\u30fc\u753b\u9762\u304b\u3089\u3082\u3046\u4e00\u5ea6\u5165\u308a\u306a\u304a\u3057\u305f\u5834\u5408\u3001\u65b0\u305f\u306b\u5b9f\u884c\u30ad\u30fc\u304c\u5272\u308a\u632f\u3089\u308c\u3001\u904e\u53bb\u306e\u5b9f\u884c\u4e2d\u306e\u30c7\u30fc\u30bf\u3068\u306f\u5225\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3067\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002\u8907\u6570\u753b\u9762\u3067\u3082\u3001\u76f8\u4e92\u306b\u5e72\u6e09\u305b\u305a\u306b\u64cd\u4f5c\u304c\u884c\u3048\u307e\u3059\u3002\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\uff15\u3064\u307e\u3067\u306e\u5b9f\u884c\u72b6\u614b\u3092\u4fdd\u6301\u3057\u307e\u3059\u3002\uff15\u3064\u3092\u8d85\u3048\u308b\u3068\u4e0a\u66f8\u304d\u3055\u308c\u307e\u3059\u3002\uff09\n\u539f\u5247\u3068\u3057\u3066\u3001\u30d5\u30ed\u30fc\u304c\u958b\u59cb\u3055\u308c\u308c\u3070\u30d5\u30ed\u30fc\u306e\u7d42\u4e86\u307e\u3067\u5b9f\u884c\u3059\u308b\u3053\u3068\u3092\u60f3\u5b9a\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\u53c2\u7167\u7cfb\u306e\u753b\u9762\u306a\u3069\u306f\u3001WebFlow\u3067\u306f\u306a\u304f\u3001\u901a\u5e38\u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306e\u65b9\u304c\u90fd\u5408\u304c\u3088\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\u4e57\u308a\u304b\u304b\u3063\u305f\u8239\u306a\u306e\u3067\u3002\u3002\u3002\n#\u691c\u7d22\u30d5\u30ed\u30fc\u306e\u5b9f\u88c5\n##\u30d5\u30ed\u30fc\u5b9a\u7fa9\n\u307e\u305a\u306f\u5358\u7d14\u306a\u753b\u9762\u9077\u79fb\u306e\u307f\u3092\u884c\u3046\u30d5\u30ed\u30fc\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\nflow-search.xml\u306f\u300c/src/main/resources/templates/search\u300d\u76f4\u4e0b\u306b\u914d\u7f6e\u3057\u307e\u3059\u3002\n\n```xml:flow-search.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<flow  \n    xmlns=\"http://www.springframework.org/schema/webflow\"\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n    xsi:schemaLocation=\"http://www.springframework.org/schema/webflow\n                          http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd\">\n    <!-- \u691c\u7d22\u30c8\u30c3\u30d7\u753b\u9762 -->\n    <view-state id=\"top\" view=\"/search/top\">\n        <transition on=\"search\" to=\"result\"/>\n    </view-state>\n    \n    <!-- \u691c\u7d22\u30c8\u30c3\u30d7\u753b\u9762\uff08\u691c\u7d22\u7d50\u679c\u8868\u793a\u72b6\u614b\uff09 \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306f\u540c\u3058-->\n    <view-state id=\"result\" view=\"/search/top\">\n        <transition on=\"search\" to=\"result\"/>\n        <transition on=\"detail\" to=\"detail\"/>\n    </view-state>\n    \n    <!-- \u8a73\u7d30\u753b\u9762 -->\n    <view-state id=\"detail\" view=\"/search/detail\">\n       <transition on=\"back\" to=\"top\"/>\n    </view-state>\n</flow>\n```\n\n##\u8a2d\u5b9a\n\n```java:WebConfig.java\npackage flowapp;\n\n@Configuration\npublic class WebFlowConfig extends AbstractFlowConfiguration {\n\n\t@Autowired\n\tSpringTemplateEngine templateEngine;\n\t\t\n\t/**\n\t * WebFlow \u3092\u5229\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u3001enfoce=true\u3060\u6587\u5b57\u5316\u3051\u3059\u308b\u3002\n\t * @return\n\t */\n\t@Bean\n\tpublic CharacterEncodingFilter characterEncodingFilter() {\n\n\t\tCharacterEncodingFilter filter = new CharacterEncodingFilter();\n\t\tfilter.setEncoding(\"UTF-8\");\n\t\tfilter.setForceEncoding(false);\n\t\treturn filter;\n\t}\n\t\n\t/**\n\t * \u30d5\u30ed\u30fc\u5b9a\u7fa9\u3092\u914d\u7f6e\u3059\u308b\u30eb\u30fc\u30c8\u30d5\u30a9\u30eb\u30c0\u3092\u5b9a\u7fa9\u3002\n\t * \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3068\u540c\u3058\u968e\u5c64\u306b\u3059\u308b\u305f\u3081\u3001Spring boot\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u300ctemplates\u300d\u30d5\u30a9\u30eb\u30c0\u3092\u6307\u5b9a\n\t * @return\n\t */\n\t@Bean\n\tpublic FlowDefinitionRegistry flowRegistry() {\n\t\treturn getFlowDefinitionRegistryBuilder()\n\t\t\t\t.setBasePath(\"classpath:templates\")\n\t\t\t\t.addFlowLocationPattern(\"/**/flow-*.xml\")\n\t\t\t\t.setFlowBuilderServices(flowBuilderServices()).build();\n\t}\n\n\t@Bean\n\tpublic FlowBuilderServices flowBuilderServices() {\n\t\treturn getFlowBuilderServicesBuilder()\n\t\t\t\t.setViewFactoryCreator(viewFactoryCreator())\n\t\t\t\t.setValidator(validator())\n\t\t\t\t.setDevelopmentMode(true)\n\t\t\t\t.build();\n\t}\n\n\t@Bean\n\tpublic Validator validator(){\n\t\treturn new LocalValidatorFactoryBean();\n\t}\n\t\n\t@Bean\n\tpublic ViewFactoryCreator viewFactoryCreator() {\n\t\tMvcViewFactoryCreator bean = new MvcViewFactoryCreator();\n\t\tbean.setViewResolvers(Arrays.asList(viewResolver()));\t\t\t\t\n\t\tbean.setUseSpringBeanBinding(true);\n\t\treturn bean;\n\t}\n\n\t@Bean\n\tpublic FlowExecutor flowExecutor() {\n\t\treturn getFlowExecutorBuilder(flowRegistry())\n\t\t\t\t.build();\n\t}\n\n\t@Bean\n\tpublic FlowHandlerAdapter flowHandler() {\n\t\tFlowHandlerAdapter bean = new FlowHandlerAdapter();\n\t\tbean.setFlowExecutor(flowExecutor());\n\t\tbean.setSaveOutputToFlashScopeOnRedirect(true);\n\t\treturn bean;\n\t}\n\n\t@Bean\n\tpublic FlowHandlerMapping flowHandlerMapping() {\n\t\tFlowHandlerMapping bean = new FlowHandlerMapping();\n\t\tbean.setFlowRegistry(flowRegistry());\n\t\tbean.setOrder(0);\n\t\treturn bean;\n\t}\n\t\n\t@Bean\n\tpublic AjaxThymeleafViewResolver viewResolver() {\n\t\tAjaxThymeleafViewResolver viewResolver = new AjaxThymeleafViewResolver();\n\t\tviewResolver.setViewClass(FlowAjaxThymeleafView.class);\n\t\tviewResolver.setTemplateEngine(templateEngine);\n\t\tviewResolver.setCharacterEncoding(\"UTF-8\");\n\t\treturn viewResolver;\n\t}\n}\n```\n\n##\u30d5\u30ed\u30fc\u5b9a\u7fa9\u306e\u30c6\u30b9\u30c8\nAbstractXmlFlowExecutionTests\u306f\u30b9\u30fc\u30d1\u30fc\u30af\u30e9\u30b9\u3068\u306a\u308b\u305f\u3081\u3001Spock\u3067\u4f7f\u3046\u305f\u3081\u306bTestRule\u30af\u30e9\u30b9\u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\uff08\u591a\u5206\u3001\u4f55\u304b\u30d0\u30b0\u306f\u3042\u308b\u3002\uff09\n\n```java:FlowExecutionTestsRule.java\npackage flowapp.test;\n\npublic class FlowExecutionTestsRule extends AbstractXmlFlowExecutionTests\n\t\timplements TestRule {\n\n\tprivate String flowDefPath;\n\tprivate Map<String, Object> registoredBeans = new HashMap<>();\n\n\tpublic FlowExecutionTestsRule(String flowDefPath) {\n\t\tsuper();\n\t\tthis.flowDefPath = flowDefPath;\n\t}\n\n\tpublic void registorBean(String beanName, Object bean) {\n\t\tregistoredBeans.put(beanName, bean);\n\t}\n\n\t@Override\n\tpublic Statement apply(Statement base, Description description) {\n\t\treturn new Statement() {\n\n\t\t\t@Override\n\t\t\tpublic void evaluate() throws Throwable {\n\t\t\t\tbase.evaluate();\n\t\t\t}\n\t\t};\n\t}\n\n\t@Override\n\tprotected FlowDefinitionResource getResource(\n\t\t\tFlowDefinitionResourceFactory resourceFactory) {\n\t\treturn resourceFactory.createFileResource(flowDefPath);\n\t}\n\n\t@Override\n\tprotected void configureFlowBuilderContext(\n\t\t\tMockFlowBuilderContext builderContext) {\n\n\t\tregistoredBeans.entrySet().forEach(e -> \n\t\t  builderContext.registerBean(e.getKey(), e.getValue())\n\t\t  );\n\t}\n\n}\n\n```\n\n\u30c6\u30b9\u30c8\u30af\u30e9\u30b9\u3002\n\n```groovy:SearchFlowSpec\npackage flowapp;\n\nclass SearchFlowSpec extends Specification{\n\n\t@Rule\n\tpublic FlowExecutionTestsRule flowExecutionTestsRule = new FlowExecutionTestsRule(\"src/main/resources/templates/search/flow-search.xml\");\n\t\n\t\n\tdef \"\u30d5\u30ed\u30fc\u306e\u521d\u671f\u5316\"() {\n\t\twhen:\n\t\tMockExternalContext context = new MockExternalContext();\n\t\tflowExecutionTestsRule.startFlow(context);\n\t\t\n\t\tthen:\n\t\tflowExecutionTestsRule.assertCurrentStateEquals(\"top\");\n\t}\n\t\n\tdef \"\u753b\u9762\u9077\u79fb\u306e\u30c6\u30b9\u30c8\"(){\n\t\tsetup:\n\t\tMockExternalContext context = new MockExternalContext();\n\t\t\n\t\twhen:\n\t\tflowExecutionTestsRule.setCurrentState(currentState)\n\t\tcontext.setEventId(eventId)\n\t\tflowExecutionTestsRule.resumeFlow(context)\n\t\t\n\t\tthen:\n\t\tflowExecutionTestsRule.assertCurrentStateEquals(resultState);\n\t\t\n\t\twhere:\n\t\tcurrentState|eventId |resultState\n\t\t\"top\"       |\"search\"|\"result\"\n\t\t\"result\"    |\"search\"|\"result\"\n\t\t\"result\"    |\"detail\"|\"detail\"\n\t\t\"detail\"    |\"back\"  |\"top\"\n\t}\n\n}\n```\n\n\u3053\u306e\u6bb5\u968e\u3067\u306f\u3001\u307e\u3060\u3001\u753b\u9762\u3068\u306e\u7d50\u5408\u306f\u3067\u304d\u3066\u3044\u307e\u305b\u3093\u3002\n\n##\u753b\u9762\u306e\u4f5c\u6210\n\u30e2\u30c3\u30af\u753b\u9762\u3092\u4f5c\u6210\u3057\u3066\u3001\u9077\u79fb\u306e\u52d5\u4f5c\u78ba\u8a8d\u3092\u3057\u307e\u3059\u3002\nsrc/main/resources/search\u76f4\u4e0b\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```html:top.html\n<!DOCTYPE html>\n<html xmlns=\"http://www.w3.org/1999/xhtml\"\n\txmlns:th=\"http://www.thymeleaf.org\"\n\txmlns:tiles=\"http://www.thymeleaf.org\"\n\txmlns:sec=\"http://www.thymeleaf.org\" lang=\"jp\">\n<head>\n<meta charset=\"UTF-8\" />\n<title>\u691c\u7d22\u753b\u9762</title>\n</head>\n<body>\n    <!-- \u30b9\u30c6\u30fc\u30c8ID\u3092\u8868\u793a -->\n\t<span th:text=\"${flowRequestContext.currentState.id}\"></span>\n\t<form action=\"#\" th:action=\"${flowExecutionUrl}\" method=\"POST\">\n\t\t<table>\n\t\t\t<tr>\n\t\t\t\t<td>ISBN</td>\n\t\t\t\t<td><input type=\"text\" name=\"isbn\" /></td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td>\u30bf\u30a4\u30c8\u30eb</td>\n\t\t\t\t<td><input type=\"text\" name=\"title\" /></td>\n\t\t\t</tr>\n\t\t</table>\n\t\t<input type=\"submit\" name=\"_eventId_search\" value=\"\u691c\u7d22\" />\n\t\t<table>\n\t\t\t<tr>\n\t\t\t\t<th>ISBN</th>\n\t\t\t\t<th>\u30bf\u30a4\u30c8\u30eb</th>\n\t\t\t\t<th>\u8a73\u7d30</th>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td>1234567890</td>\n\t\t\t\t<td>\u30bf\u30a4\u30c8\u30eb1</td>\n\t            <td><a href=\"#\" th:href=\"@{${flowExecutionUrl}(_eventId='detail')}\">\u8a73\u7d30</a></td>\n    \t\t</tr>\n\t\t\t<tr> <td>1234567891</td>\n                <td>\u30bf\u30a4\u30c8\u30eb2</td>\n                <td><a href=\"#\" th:href=\"@{${flowExecutionUrl}(_eventId='detail')}\">\u8a73\u7d30</a></td></tr>\n\t\t</table>\n\t</form>\n</body>\n</html>\n```\n\n```html:detail.html\n<!DOCTYPE html>\n<html xmlns=\"http://www.w3.org/1999/xhtml\"\n\txmlns:th=\"http://www.thymeleaf.org\"\n\txmlns:tiles=\"http://www.thymeleaf.org\"\n\txmlns:sec=\"http://www.thymeleaf.org\" lang=\"en\">\n<head>\n<script type=\"text/javascript\" th:src=\"@{/resources/dojo/dojo.js}\"></script>\n<script type=\"text/javascript\" th:src=\"@{/resources/spring/Spring.js}\"></script>\n<script type=\"text/javascript\"\n\tth:src=\"@{/resources/spring/Spring-Dojo.js}\"></script>\n<meta charset=\"UTF-8\" />\n<title>\u8a73\u7d30</title>\n</head>\n<body>\n\t<form action=\"\" th:action=\"${flowExecutionUrl}\" method=\"POST\">\n\t\t<table>\n\t\t\t<tr>\n\t\t\t\t<th>ISBN</th>\n\t\t\t\t<td>1234567891</td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<th>\u30bf\u30a4\u30c8\u30eb</th>\n\t\t\t\t<td>\u30bf\u30a4\u30c8\u30eb2</td></tr>\n\t\t</table>\n\t\t<input type=\"submit\" name=\"_eventId_back\" value=\"\u623b\u308b\" />\n\t</form>\n</body>\n</html>\n```\n###\u30a4\u30d9\u30f3\u30c8ID\n\u30b9\u30c6\u30fc\u30c8\u306e\u9077\u79fb\u306b\u5229\u7528\u3055\u308c\u308beventId\u306f\u3001submit\u6642\u306ename\u5c5e\u6027\u306e\u307b\u304b\u3001queryString\u3067\u3082\u6e21\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\n##\u52d5\u4f5c\u78ba\u8a8d\ngradle bootRun,\u3082\u3057\u304f\u306f\u3001IDE\u4e0a\u304b\u3089Application\u30af\u30e9\u30b9\u3092\u5b9f\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u4e0b\u8a18\u306e\u901a\u308a\u306b\u9077\u79fb\u3059\u308b\u3068\u6b63\u5e38\u306b\u9077\u79fb\u3067\u304d\u307e\u3059\u3002\ntop\u2192result\u2192detail\u2192top\n\u3057\u304b\u3057\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306a\u30d5\u30ed\u30fc\u5b9a\u7fa9\u306b\u8a18\u8f09\u304c\u306a\u3044\u9077\u79fb\u306f\u3067\u304d\u307e\u305b\u3093\u3002\ntop\u2192detail\n\u672c\u6765\u306a\u3089\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067\u3082\u64cd\u4f5c\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u5236\u5fa1\u3059\u308b\u3079\u304d\u3067\u3059\u304c\u3001\u307e\u305a\u306f\u3001\u30b5\u30fc\u30d0\u5074\u3067\u3057\u3063\u304b\u308a\u30c1\u30a7\u30c3\u30af\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u5b89\u5fc3\u3067\u3059\u3002\n\n###\u5b9f\u884c\u30ad\u30fc\n\u5b9f\u884c\u306fqueryString\u306b\u6e21\u3055\u308c\u308b\u5b9f\u884c\u30ad\u30fc\uff08execution=exsx\uff09\u306b\u3088\u3063\u3066\u7ba1\u7406\u3055\u308c\u307e\u3059\u3002x\u306f\u81ea\u52d5\u3067\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30c8\u3055\u308c\u3066\u3044\u304d\u307e\u3059\u3002\u30e1\u30cb\u30e5\u30fc\u753b\u9762\u304b\u3089\u3082\u3046\u4e00\u5ea6\u5165\u308a\u306a\u304a\u3057\u305f\u5834\u5408\u3001\u65b0\u305f\u306b\u5b9f\u884c\u30ad\u30fc\u304c\u5272\u308a\u632f\u3089\u308c\u3001\u904e\u53bb\u306e\u5b9f\u884c\u4e2d\u306e\u30c7\u30fc\u30bf\u3068\u306f\u5225\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3067\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002\u8907\u6570\u753b\u9762\u3067\u3082\u3001\u76f8\u4e92\u306b\u5e72\u6e09\u305b\u305a\u306b\u64cd\u4f5c\u304c\u884c\u3048\u307e\u3059\u3002\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\uff15\u3064\u307e\u3067\u306e\u5b9f\u884c\u72b6\u614b\u3092\u4fdd\u6301\u3057\u307e\u3059\u3002\uff15\u3064\u3092\u8d85\u3048\u308b\u3068\u4e0a\u66f8\u304d\u3055\u308c\u307e\u3059\u3002\uff09\n\u539f\u5247\u3068\u3057\u3066\u3001\u30d5\u30ed\u30fc\u304c\u958b\u59cb\u3055\u308c\u308c\u3070\u30d5\u30ed\u30fc\u306e\u7d42\u4e86\u307e\u3067\u5b9f\u884c\u3059\u308b\u3053\u3068\u3092\u60f3\u5b9a\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\u53c2\u7167\u7cfb\u306e\u753b\u9762\u306a\u3069\u306f\u3001WebFlow\u3067\u306f\u306a\u304f\u3001\u901a\u5e38\u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306e\u65b9\u304c\u90fd\u5408\u304c\u3088\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n", "tags": ["spring-webflow", "spring-boot", "Java"]}