{"context": " More than 1 year has passed since last update.http://qiita.com/items/c64ce7477169a710f755\n\u3053\u306e\u9752\u3044\u590f\u7a7a\u306e\u4e0b\u306b\u306farray_intersect_key\u3068\u304baddcslashes\u3068\u304b\u3042\u308b\u306e\u3067\u3059\u3088\u3002\u3002\n<?php\nuse Zend\\Db\\Adapter\\Adapter;\nuse Zend\\Db\\Sql\\Sql;\nuse Zend\\Db\\Sql\\Where;\n\nrequire_once 'vendor/autoload.php';\n\n$adapter = new Adapter([\n    'driver' => 'Mysqli',\n    'database' => 'foo',\n    'username' => 'USERNAME',\n    'password' => 'PASSWORD',\n]);\n\n$sql = new Sql($adapter);\n\n// \u4e0d\u7279\u5b9a\u306e\u30ad\u30fc\u3092\u3082\u3064\u914d\u5217\u304b\u3089\u7279\u5b9a\u306e\u30ad\u30fc\u3060\u3051\u5bfe\u8c61\u306b\u62bd\u51fa\n$whereSet = array_intersect_key(\n    array_filter($_REQUEST), // \u305f\u3044\u3066\u3044\u306f\u3001\u3069\u3053\u304b\u306e\u30e1\u30bd\u30c3\u30c9\u3067\u306e$parameters\u3068\u304b\u3067\u306f\n    array_fill_keys(['name', 'gender', 'address'], true)\n);\n\n\nequal: // \u3069\u3053\u306e\u3054\u5bb6\u5ead\u306b\u3082\u3042\u308b\u914d\u5217\u6e21\u3057\u3067\u306e\u30d0\u30a4\u30f3\u30c9\n\n$select = $sql->select('myTable')->where($whereSet);\n\nequal_or_like: //\u7279\u5b9a\u306e\u9805\u76ee\u3060\u3051LIKE\u691c\u7d22\n\n$select = $sql->select('myTable')->where(function(Where $where) use ($whereSet) {\n    foreach ($whereSet as $column => $value) {\n        if ($column === 'address') {\n            $where->like($column, '%'.addcslashes($value, '%_\\\\').'%');\n        } else {\n            $where->equalTo($column, $value);\n        }\n    }\n    return $where;\n});\n\n$statement = $sql->prepareStatementForSqlObject($select);\n$results = $statement->execute();\n\n\n\u3064\u3044\u30b9\u30fc\u30d1\u30fc\u30b0\u30ed\u30fc\u30d0\u30eb\u5909\u6570\u3092\u898b\u3066\u30ab\u30c3\u3068\u306a\u308a\u307e\u3057\u305f\u3002\u53cd\u7701\u306f\u3057\u307e\u305b\u3093\u3002\nhttp://qiita.com/items/c64ce7477169a710f755\n\n\u3053\u306e\u9752\u3044\u590f\u7a7a\u306e\u4e0b\u306b\u306farray_intersect_key\u3068\u304baddcslashes\u3068\u304b\u3042\u308b\u306e\u3067\u3059\u3088\u3002\u3002\n\n```php:\n<?php\nuse Zend\\Db\\Adapter\\Adapter;\nuse Zend\\Db\\Sql\\Sql;\nuse Zend\\Db\\Sql\\Where;\n\nrequire_once 'vendor/autoload.php';\n\n$adapter = new Adapter([\n    'driver' => 'Mysqli',\n    'database' => 'foo',\n    'username' => 'USERNAME',\n    'password' => 'PASSWORD',\n]);\n\n$sql = new Sql($adapter);\n\n// \u4e0d\u7279\u5b9a\u306e\u30ad\u30fc\u3092\u3082\u3064\u914d\u5217\u304b\u3089\u7279\u5b9a\u306e\u30ad\u30fc\u3060\u3051\u5bfe\u8c61\u306b\u62bd\u51fa\n$whereSet = array_intersect_key(\n    array_filter($_REQUEST), // \u305f\u3044\u3066\u3044\u306f\u3001\u3069\u3053\u304b\u306e\u30e1\u30bd\u30c3\u30c9\u3067\u306e$parameters\u3068\u304b\u3067\u306f\n    array_fill_keys(['name', 'gender', 'address'], true)\n);\n\n\nequal: // \u3069\u3053\u306e\u3054\u5bb6\u5ead\u306b\u3082\u3042\u308b\u914d\u5217\u6e21\u3057\u3067\u306e\u30d0\u30a4\u30f3\u30c9\n\n$select = $sql->select('myTable')->where($whereSet);\n\nequal_or_like: //\u7279\u5b9a\u306e\u9805\u76ee\u3060\u3051LIKE\u691c\u7d22\n\n$select = $sql->select('myTable')->where(function(Where $where) use ($whereSet) {\n    foreach ($whereSet as $column => $value) {\n        if ($column === 'address') {\n            $where->like($column, '%'.addcslashes($value, '%_\\\\').'%');\n        } else {\n            $where->equalTo($column, $value);\n        }\n    }\n    return $where;\n});\n\n$statement = $sql->prepareStatementForSqlObject($select);\n$results = $statement->execute();\n\n```\n\n\u3064\u3044\u30b9\u30fc\u30d1\u30fc\u30b0\u30ed\u30fc\u30d0\u30eb\u5909\u6570\u3092\u898b\u3066\u30ab\u30c3\u3068\u306a\u308a\u307e\u3057\u305f\u3002\u53cd\u7701\u306f\u3057\u307e\u305b\u3093\u3002", "tags": ["PHP", "zf2"]}