{"context": "\n\n\u524d\u56de\n\u3055\u304f\u3089\u306eVPS \u6a19\u6e96OS\u306e\u74b0\u5883\u69cb\u7bc9(2) \u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u3068\u30b7\u30b9\u30c6\u30e0\u306e\u8a2d\u5b9a\n\nSFTP\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\n\u30c7\u30d7\u30ed\u30a4\u6642\u306b\u4f7f\u7528\u3059\u308bSFTP\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u30e6\u30fc\u30b6\u30fc\u30b0\u30eb\u30fc\u30d7\u306b\u306fwheel\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3042\u308f\u305b\u3066SFTP\u30e6\u30fc\u30b6\u30fc\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\nuseradd SFTP_USER -G wheel && \\\npasswd SFTP_USER\n\nSFTP_USER\u306e\u90e8\u5206\u3092\u4efb\u610f\u306e\u30e6\u30fc\u30b6\u30fc\u540d\u306b\u5dee\u3057\u66ff\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\u4ee5\u964d\u306e\u30ed\u30b0\u30a4\u30f3\u7528\u30e6\u30fc\u30b6\u30fc\u306e\u8868\u8a18\u306fSFTP_USER\u306b\u7d71\u4e00\u3057\u307e\u3059\u3002\n\n\n\n\u5b9f\u884c\u7d50\u679c\n\u30e6\u30fc\u30b6\u30fc SFTP_USER \u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5909\u66f4\u3002\n\u65b0\u3057\u3044\u30d1\u30b9\u30ef\u30fc\u30c9: <- \u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\n\u65b0\u3057\u3044\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u518d\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044: <- \u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u518d\u5165\u529b\npasswd: \u5168\u3066\u306e\u8a8d\u8a3c\u30c8\u30fc\u30af\u30f3\u304c\u6b63\u3057\u304f\u66f4\u65b0\u3067\u304d\u307e\u3057\u305f\u3002\n\n\n\u307e\u305f\u3001SFTP\u30e6\u30fc\u30b6\u30fc\u7528\u306e\u516c\u958b\u9375\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u901a\u5e38\u306f\u65b0\u3057\u304f\u4f5c\u308a\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u624b\u9806\u7c21\u7565\u306e\u305f\u3081\u306bLOGIN_USER\u306e\u516c\u958b\u9375authorized_keys\u3092SFTP_USER\u306e\u65b9\u3078\u30b3\u30d4\u30fc\u3057\u6a29\u9650\u3092\u5909\u66f4\u3057\u3066\u4f7f\u7528\u3057\u307e\u3059\u3002\n\ncp /home/LOGIN_USER/.ssh/authorized_keys /home/SFTP_USER/.ssh/authorized_keys && \\\nchmod 0600 /home/SFTP_USER/.ssh/authorized_keys && \\\nchown SFTP_USER:SFTP_USER /home/SFTP_USER/.ssh/authorized_keys\n\n\nNginx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\nNginx\u306f\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u30b5\u30fc\u30d0\u30fc\u3068\u3057\u3066\u52d5\u4f5c\u3055\u305b\u3001\u305d\u306e\u80cc\u5f8c\u3067Apache\u3092\u52d5\u4f5c\u3055\u305b\u307e\u3059\u3002\n\u753b\u50cf\u306a\u3069\u306e\u9759\u7684\u30b3\u30f3\u30c6\u30f3\u30c4\u3092Nginx\u3067\u634c\u304d\u3001\u52d5\u7684\u51e6\u7406\u306fApache\u3078\u6d41\u3059\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u8ffd\u52a0\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u624b\u52d5\u3067yum\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nvim /etc/yum.repo.d/nginx.repo\n\n\n/etc/yum.repo.d/nginx.repo\n+ [nginx]\n+ name=nginx repo\n+ baseurl=http://nginx.org/packages/mainline/rhel/$releasever/$basearch/\n+ gpgcheck=0\n+ enabled=1\n\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u304c\u8ffd\u52a0\u3067\u304d\u305f\u3089\u3001yum\u30b3\u30de\u30f3\u30c9\u3067Nginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nyum install nginx\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u305f\u3089Nginx\u306e\u81ea\u52d5\u5b9f\u884c\u306e\u767b\u9332\u3092\u3057\u307e\u3059\u3002\n\nchkconfig nginx on\n\n\n\u30d5\u30a1\u30a4\u30eb\u306e\u30aa\u30fc\u30d7\u30f3\u6570\u3068\u540c\u6642\u63a5\u7d9a\u6570\u306e\u4e0a\u9650\u306e\u8a2d\u5b9a\u3068gzip\u306e\u6709\u52b9\u5316\n\u30d5\u30a1\u30a4\u30eb\u306e\u30aa\u30fc\u30d7\u30f3\u6570\u3068\u540c\u6642\u63a5\u7d9a\u6570\u306e\u4e0a\u9650\u3092\u5f15\u304d\u4e0a\u3052\u3001\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u30fc\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u756a\u53f7\u3092\u975e\u8868\u793a\u306b\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001gzip\u3092\u6709\u52b9\u5316\u3057\u9ad8\u901f\u5316\u3092\u56f3\u308a\u307e\u3059\u3002\n\nvi /etc/nginx/nginx.conf\n\n\n/etc/nginx/nginx.conf\n  :\n+ worker_rlimit_nofile    10240;\n  events {\n-     worker_connections  1024;\n+     worker_connections  10240;\n  }\n\n  http {\n      :\n-     #gzip                on;\n+     gzip                on;\n+     gzip_http_version   1.0;\n+     gzip_types          text/xml\n+                         text/css\n+                         text/javascript\n+                         application/xhtml+xml\n+                         application/xml\n+                         application/rss+xml\n+                         application/atom_xml\n+                         application/javascript\n+                         application/json\n+                         application/x-javascript\n+                         application/x-httpd-php;\n+     gzip_vary           on;\n+     gzip_proxied        any;\n+     gzip_comp_level     6;\n+     gzip_disable        \"MSIE [1-6]\\.\";\n      :\n+     server_tokens off;\n  }\n\n\n\n\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068\u3057\u3066\u52d5\u4f5c\u3055\u305b\u308b\u8a2d\u5b9a\nNginx\u3092\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068\u3057\u3066\u52d5\u4f5c\u3055\u305b\u308b\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\u4eca\u56de\u3001\u8907\u6570\u30c9\u30e1\u30a4\u30f3\u306e\u30c6\u30b9\u30c8\u3068\u3057\u3066\u3001\u901a\u5e38\u306e(www.)example.com\u3068\u30b5\u30d6\u30c9\u30e1\u30a4\u30f3\u306esub.example.com\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u524d\u63d0\u3067\u9032\u3081\u307e\u3059\u3002\n\nvi /etc/nginx/conf.d/default.conf\n\n\n/etc/nginx/conf.d/default.conf\n+ server {\n+     listen      80;\n+     server_name example.com www.example.com;\n+ \n+     access_log  /var/log/nginx/example.com.access.log;\n+     error_log   /var/log/nginx/example.com.error.log;\n+ \n+     location ~ .*\\.(jpg|JPG|gif|GIF|png|PNG|swf|SWF|css|CSS|js|JS|inc|INC|ico|ICO) {\n+         root    /var/www/html/example.com/htdocs;\n+         index   index.html;\n+         ssi     on;\n+     }\n+ \n+     location / {\n+         proxy_set_header Host               $host;\n+         proxy_set_header X-Real-IP          $remote_addr;\n+         proxy_set_header X-Forwarded-Host   $host;\n+         proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;\n+ \n+         proxy_pass  http://127.0.0.1:8080;\n+         proxy_redirect off;\n+ \n+         proxy_connect_timeout 120;\n+         proxy_read_timeout    120;\n+         proxy_send_timeout    120;\n+ \n+         proxy_max_temp_file_size 0;\n+     }\n+ }\n+ \n+ server {\n+     listen      80;\n+     server_name sub.example.com;\n+ \n+     access_log  /var/log/nginx/sub.example.com.access.log;\n+     error_log   /var/log/nginx/sub.example.com.error.log;\n+ \n+     location ~ .*\\.(jpg|JPG|gif|GIF|png|PNG|swf|SWF|css|CSS|js|JS|inc|INC|ico|ICO) {\n+         root    /var/www/html/sub.example.com/htdocs;\n+         index   index.html;\n+         ssi     on;\n+     }\n+ \n+     location / {\n+         proxy_set_header Host               $host;\n+         proxy_set_header X-Real-IP          $remote_addr;\n+         proxy_set_header X-Forwarded-Host   $host;\n+         proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;\n+ \n+         proxy_pass  http://127.0.0.1:8081;\n+         proxy_redirect off;\n+ \n+         proxy_connect_timeout 120;\n+         proxy_read_timeout    120;\n+         proxy_send_timeout    120;\n+ \n+         proxy_max_temp_file_size 0;\n+     }\n+ }\n\n\n\u4fdd\u5b58\u3057\u305f\u3089\u3001\u6b63\u5e38\u306b\u8d77\u52d5\u51fa\u6765\u308b\u304b\u3069\u3046\u304b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u69cb\u6587\u30c1\u30a7\u30c3\u30af\u3092\u884c\u3044\u307e\u3059\u3002\nsuccessful\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308c\u3070\u5927\u4e08\u592b\u3067\u3059\u3002\n\nservice nginx configtest\n\n\n\u5b9f\u884c\u7d50\u679c\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n\n\n\nApache\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\n\u52d5\u7684\u51e6\u7406\u3092\u62c5\u5f53\u3059\u308bApache\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306fApache\u306e2.4\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nSoftware Collections(SCL)\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nCentOS6.x\u3067\u306f\u3001\u6a19\u6e96\u306eyum\u3067\u306fApache2.4\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\nSCL\u3068\u306f\u3001Red Hat\u304c\u63d0\u4f9b\u3059\u308b\u6700\u65b0\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u5b89\u5b9a\u7248\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u63d0\u4f9b\u3057\u3001\u304b\u3064yum\u306e\u65e7\u30d1\u30c3\u30b1\u30fc\u30b8\u3068\u5171\u5b58\u3055\u305b\u3066\u304f\u308c\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u3067\u3059\u3002\n\nyum install centos-release-scl\nyum-config-manager --enable rhel-server-rhscl-7-rpms\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nSCL\u3092\u7528\u3044\u3066Apache2.4\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nyum install httpd24\nscl enable httpd24 bash\nchkconfig httpd24-httpd on\n\napxs\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3001apr-devel.x86_64\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nyum install apr-devel.x86_64\n\n\n\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u306e\u4f5c\u6210\nApache2.2\u3068\u540c\u3058\u3088\u3046\u306b\u64cd\u4f5c\u51fa\u6765\u308b\u3088\u3046\u306b\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u5f35\u308a\u307e\u3059\u3002\n\nln -s /opt/rh/httpd24/root/etc/httpd /etc/httpd && \\\nln -s /opt/rh/httpd24/root/var/log/httpd /var/log/httpd && \\\nln -s /opt/rh/httpd24/root/var/www /var/www && \\\nln -s /opt/rh/httpd24/root/usr/bin/apxs /usr/bin/apxs && \\\nln -s /opt/rh/httpd24/root/usr/lib64/httpd /usr/lib64/httpd\n\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u306e\u4f5c\u6210\u3068\u6a29\u9650\u306e\u5909\u66f4\n\u30c9\u30e1\u30a4\u30f3\u6bce\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u3092\u4f5c\u6210\u3057\u3001SFTP\u3067\u6271\u3048\u308b\u3088\u3046\u306b\u6a29\u9650\u3092\u5909\u66f4\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u3088\u308a\u4e0a\u306e\u968e\u5c64\u306b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8a2d\u7f6e\u3057\u305f\u3044\u5834\u5408\u3082\u3042\u308b\u3068\u601d\u3046\u306e\u3067\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u306f\u30c9\u30e1\u30a4\u30f3\u5225\u306e\u4e2d\u306bhtdocs\u3067\u4e00\u968e\u5c64\u4e0b\u3052\u3066\u3042\u308a\u307e\u3059\u3002\n(www.)example.com\u7528\n\nmkdir -p /var/www/html/example.com/htdocs && \\\nchmod 0755 /var/www/html/example.com && \\\nchmod 0755 /var/www/html/example.com/htdocs && \\\nchown SFTP_USER:SFTP_USER /var/www/html/example.com && \\\nchown SFTP_USER:SFTP_USER /var/www/html/example.com/htdocs\n\nsub.example.com\u7528\n\nmkdir -p /var/www/html/sub.example.com/htdocs && \\\nchmod 0755 /var/www/html/sub.example.com && \\\nchmod 0755 /var/www/html/sub.example.com/htdocs && \\\nchown SFTP_USER:SFTP_USER /var/www/html/sub.example.com && \\\nchown SFTP_USER:SFTP_USER /var/www/html/sub.example.com/htdocs\n\n\nmod_rpaf\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u3092Apache\u5074\u3067\u53d7\u3051\u53d6\u308b\u969b\u306b\u3001\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u306e\u30a2\u30c9\u30ec\u30b9\u304c\u8a18\u9332\u3055\u308c\u308b\u5bfe\u7b56\u3068\u3057\u3066\u3001mod_rpaf\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nGitHub\u304b\u3089\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u30af\u30ed\u30fc\u30f3\u3057\u3001mod_rpaf.so\u3092\u751f\u6210\u3057\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\ngit clone https://github.com/gnif/mod_rpaf ~/mod_rpaf && \\\ncd ~/mod_rpaf && \\\nmake && \\\nmake install\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3057\u305f\u3089GitHub\u304b\u3089\u30af\u30ed\u30fc\u30f3\u3057\u305f\u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u306f\u524a\u9664\u3057\u307e\u3059\u3002\n\ncd ~ && \\\nrm -rf ~/mod_rpaf\n\n\n\u57fa\u672c\u8a2d\u5b9a\u3068\u30d0\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\u8a2d\u5b9a\nApache\u306e\u57fa\u672c\u8a2d\u5b9a\u3084\u30d0\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\nvi /etc/httpd/conf/httpd.conf\n\nApache\u3092\u5b9f\u884c\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u3068\u30b0\u30eb\u30fc\u30d7\u3092SFTP_USER\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n/opt/rh/httpd24/root/etc/httpd/conf/httpd.conf\n- User apache\n- Group apache\n+ User SFTP_USER\n+ Group SFTP_USER\n\n\n\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u30fc\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u756a\u53f7\u3068\u30b5\u30fc\u30d0\u30fc\u7f72\u540d\u3092\u975e\u8868\u793a\u306b\u3057\u307e\u3059\u3002\n\u4e0b\u8a18\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\n/opt/rh/httpd24/root/etc/httpd/conf/httpd.conf\n+ ServerTokens Prod\n+ ServerSignature Off\n\n\nNginx\u306edefault.conf\u3067\u6307\u5b9a\u3057\u305f\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u8907\u6570\u30dd\u30fc\u30c8\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u30011\u884c\u305a\u3064\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n/opt/rh/httpd24/root/etc/httpd/conf/httpd.conf\n+ Listen 8080\n+ Listen 8081\n\n\n\u30b5\u30fc\u30d0\u30fc\u7ba1\u7406\u8005\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002\n\n/opt/rh/httpd24/root/etc/httpd/conf/httpd.conf\n+ ServerAdmin test@example.com\n\n\n\u30b5\u30fc\u30d0\u30fc\u540d\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u3053\u3053\u306f\u30e1\u30a4\u30f3\u306e\u30c9\u30e1\u30a4\u30f3\u306b\u306a\u308a\u307e\u3059\u3002\n\n/opt/rh/httpd24/root/etc/httpd/conf/httpd.conf\n+ ServerName example.com:8080\n\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u306e\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002\n\u30aa\u30d7\u30b7\u30e7\u30f3\u3068\u3057\u3066\u30d6\u30e9\u30a6\u30b6\u3067\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u3092\u8868\u793a\u3055\u305b\u306a\u3044\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u3042\u308f\u305b\u3066\u3001.htaccess\u30d5\u30a1\u30a4\u30eb\u3067\u306e\u8a2d\u5b9a\u306e\u4e0a\u66f8\u304d\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n/opt/rh/httpd24/root/etc/httpd/conf/httpd.conf\n  :\n- DocumentRoot \"/opt/rh/httpd24/root/var/www/html\"\n+ DocumentRoot \"/var/www/html\"\n  :\n- <Directory \"/opt/rh/httpd24/root/var/www/html\">\n+ <Directory \"/var/www/html\">\n  :\n\n\n\n/opt/rh/httpd24/root/etc/httpd/conf/httpd.conf\n  :\n  <Directory \"/var/www/html\">\n      :\n-     Options Indexes FollowSymLinks\n+     Options FollowSymLinks SymLinksIfOwnerMatch\n      :\n-     AllowOverride None\n+     AllowOverride All\n      :\n  </Directory>\n  :\n\n\nIndex\u30d5\u30a1\u30a4\u30eb\u306bindex.php\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u3042\u308f\u305b\u3066\u3001index.php\u304c\u512a\u5148\u3055\u308c\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n/opt/rh/httpd24/root/etc/httpd/conf/httpd.conf\n  :\n  <IfModule dir_module>\n-     DirectoryIndex index.html\n+     DirectoryIndex index.php index.html\n  </IfModule>\n  :\n\n\n.php\u30d5\u30a1\u30a4\u30eb\u304c\u5b9f\u884c\u51fa\u6765\u308b\u3088\u3046\u306b\u3001\u62e1\u5f35\u5b50\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001.shtml\u306f\u4f7f\u7528\u3057\u306a\u3044\u306e\u3067\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u307e\u3059\u3002\n\n/opt/rh/httpd24/root/etc/httpd/conf/httpd.conf\n  :\n  <IfModule mime_module>\n      :\n+     AddType application/x-httpd-php .php\n      :\n-     AddType text/html .shtml\n-     AddOutputFilter INCLUDES .shtml\n+     #AddType text/html .shtml\n+     #AddOutputFilter INCLUDES .shtml\n      :\n  </IfModule>\n  :\n\n\n\u6700\u5f8c\u306b\u30d0\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\n/opt/rh/httpd24/root/etc/httpd/conf/httpd.conf\n+ # Virtual Host\n+ <VirtualHost 127.0.0.1:8080>\n+     ServerName example.com\n+     DocumentRoot /var/www/html/example.com/htdocs\n+     ErrorLog /var/log/httpd/example.com.access.log\n+ \n+     RPAF_Enable On\n+     RPAF_SetHostName On\n+     RPAF_ProxyIPs 127.0.0.1 10.0.0.1\n+     RPAF_Header X-Forwarded-For\n+     <Directory \"/var/www/html/example.com/htdocs\">\n+         Require all granted\n+     </Directory>\n+ </VirtualHost>\n+ \n+ <VirtualHost 127.0.0.1:8081>\n+     ServerName sub.example.com\n+     DocumentRoot /var/www/html/sub.example.com/htdocs\n+     ErrorLog /var/log/httpd/sub.example.com.access.log\n+ \n+     RPAF_Enable On\n+     RPAF_SetHostName On\n+     RPAF_ProxyIPs 127.0.0.1 10.0.0.1\n+     RPAF_Header X-Forwarded-For\n+     <Directory \"/var/www/html/sub.example.com/htdocs\">\n+         Require all granted\n+     </Directory>\n+ </VirtualHost>\n\n\n\nmod_rpaf\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8aad\u307f\u8fbc\u3080\u8a2d\u5b9a\n\u57fa\u672c\u30e2\u30b8\u30e5\u30fc\u30eb\u7528\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb00-base.conf\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\nvi /etc/httpd/conf.modules.d/00-base.conf\n\n\u4e0b\u8a18\u3092\u8ffd\u8a18\u3057\u3066\u3001mod_rpaf.so\u304c\u8aad\u307f\u8fbc\u307e\u308c\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n/opt/rh/httpd24/root/etc/httpd/conf.modules.d/00-base.conf\n+ LoadModule rpaf_module modules/mod_rpaf.so\n\n\n\n\u30c6\u30b9\u30c8\u30da\u30fc\u30b8\u306e\u524a\u9664(\u30d0\u30c3\u30af\u30a2\u30c3\u30d7)\n\u3053\u306e\u307e\u307e\u3060\u3068404 NotFound\u306a\u3069\u306b\u306a\u3063\u305f\u969b\u306bApache\u306e\u30c6\u30b9\u30c8\u30da\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3059\u308b\u304b\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u5909\u3048\u3066\u304a\u304d\u307e\u3059\u3002\n\ncd /opt/rh/httpd24/root/usr/share/httpd/noindex/\nmv index.html index.html.bak\n\n\n\u8a2d\u5b9a\u306e\u69cb\u6587\u30c1\u30a7\u30c3\u30af\n\u6b63\u5e38\u306b\u8d77\u52d5\u51fa\u6765\u308b\u304b\u3069\u3046\u304b\u3001\u8a2d\u5b9a\u306e\u69cb\u6587\u30c1\u30a7\u30c3\u30af\u3092\u884c\u3044\u307e\u3059\u3002\n\nservice httpd24-httpd configtest\n\n\n\u5b9f\u884c\u7d50\u679c\nSyntax OK\n\n\nSyntax OK\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308c\u3070\u5927\u4e08\u592b\u3067\u3059\u3002\n\nNginx\u3068Apache\u306e\u8d77\u52d5\n\u5168\u3066\u306e\u8a2d\u5b9a\u304c\u5b8c\u4e86\u3057\u305f\u3089Nginx\u3068Apache\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\nservice nginx start && \\\nservice httpd24-httpd start\n\n\n\u5b9f\u884c\u7d50\u679c\nnginx \u3092\u8d77\u52d5\u4e2d:                                            [  OK  ]\nStarting httpd:                                            [  OK  ]\n\n\n\nLogWatch\u306e\u8a2d\u5b9a\u306e\u4fee\u6b63\nApache\u306f\u6a19\u6e96\u3067\u76e3\u8996\u5bfe\u8c61\u3067\u3059\u304cNginx\u306f\u76e3\u8996\u3055\u308c\u307e\u305b\u3093\u3002\nNginx\u306e\u30ed\u30b0\u304c\u542b\u307e\u308c\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\nApache\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\u3057\u3066\u7de8\u96c6\u3057\u307e\u3059\u3002\n\ncp /usr/share/logwatch/scripts/services/http /etc/logwatch/scripts/services/nginx && \\\ncp /usr/share/logwatch/default.conf/services/http.conf /etc/logwatch/conf/services/nginx.conf && \\\ncp /usr/share/logwatch/default.conf/logfiles/http.conf /etc/logwatch/conf/logfiles/nginx.conf\n\n\u76e3\u8996\u30b5\u30fc\u30d3\u30b9\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\nvi /etc/logwatch/conf/services/nginx.conf\n\n\n/etc/logwatch/conf/services/nginx.conf\n  :\n- Title = \"httpd\"\n+ Title = \"nginx\"\n  :\n- LogFile = http\n+ LogFile = nginx\n  :\n\n\n\u76e3\u8996\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\nvi /etc/logwatch/conf/logfiles/nginx.conf\n\n\n/etc/logwatch/conf/logfiles/nginx.conf\n  :\n- #LogFile = httpd/*access_log\n- #LogFile = apache/*access.log.1\n- #LogFile = apache/*access.log\n- #LogFile = apache2/*access.log.1\n- #LogFile = apache2/*access.log\n- #LogFile = apache2/*access_log\n- #LogFile = apache-ssl/*access.log.1\n- #LogFile = apache-ssl/*access.log\n+ LogFile = nginx/*access.log\n  :\n- #Archive = archiv/httpd/*access_log.*\n- #Archive = httpd/*access_log.*\n- #Archive = apache/*access.log.*.gz\n- #Archive = apache2/*access.log.*.gz\n- #Archive = apache2/*access_log.*.gz\n- #Archive = apache-ssl/*access.log.*.gz\n+ Archive = nginx/*access.log.*.gz\n  :\n\n\n\nSSH\u306e\u8a2d\u5b9a\u306e\u4fee\u6b63\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u306a\u3069\u3082\u4f5c\u3089\u308c\u305f\u305f\u3081\u3001SFTP\u3092\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306bSSH\u306e\u8a2d\u5b9a\u3092\u4fee\u6b63\u3057\u307e\u3059\u3002\n\nvi /etc/ssh/sshd_config\n\nSubsystem sftp\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n/etc/ssh/sshd_config\n  # override default of no subsystems\n- #Subsystem      sftp    /usr/libexec/openssh/sftp-server\n+ Subsystem       sftp    internal-sftp\n\n\nMatch User\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\nChrootDirectory\u306f\u3001Apache\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u3092\u6307\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n/etc/ssh/sshd_config\n+ Match User SFTP_USER\n+     ChrootDirectory /var/www/html\n+     ForceCommand internal-sftp\n\n\n\u8a2d\u5b9a\u3092\u4fdd\u5b58\u3057\u305f\u3089\u3001sshd\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n\nservice sshd restart\n\n\n\u6b21\u56de\n\u3055\u304f\u3089\u306eVPS \u6a19\u6e96OS\u306e\u74b0\u5883\u69cb\u7bc9(4) MariaDB\u3068PHP\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n## \u524d\u56de\n\n[\u3055\u304f\u3089\u306eVPS \u6a19\u6e96OS\u306e\u74b0\u5883\u69cb\u7bc9(2) \u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u3068\u30b7\u30b9\u30c6\u30e0\u306e\u8a2d\u5b9a](http://qiita.com/takahiko-takei/items/ee233aac59976ce55f11)\n\n\n## SFTP\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\n\n\u30c7\u30d7\u30ed\u30a4\u6642\u306b\u4f7f\u7528\u3059\u308b`SFTP`\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u30e6\u30fc\u30b6\u30fc\u30b0\u30eb\u30fc\u30d7\u306b\u306f`wheel`\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3042\u308f\u305b\u3066`SFTP`\u30e6\u30fc\u30b6\u30fc\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n> `useradd SFTP_USER -G wheel && \\`\n> `passwd SFTP_USER`\n> > `SFTP_USER`\u306e\u90e8\u5206\u3092\u4efb\u610f\u306e\u30e6\u30fc\u30b6\u30fc\u540d\u306b\u5dee\u3057\u66ff\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n> > \u4ee5\u964d\u306e\u30ed\u30b0\u30a4\u30f3\u7528\u30e6\u30fc\u30b6\u30fc\u306e\u8868\u8a18\u306f`SFTP_USER`\u306b\u7d71\u4e00\u3057\u307e\u3059\u3002\n\n```shell-session:\u5b9f\u884c\u7d50\u679c\n\u30e6\u30fc\u30b6\u30fc SFTP_USER \u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5909\u66f4\u3002\n\u65b0\u3057\u3044\u30d1\u30b9\u30ef\u30fc\u30c9: <- \u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\n\u65b0\u3057\u3044\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u518d\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044: <- \u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u518d\u5165\u529b\npasswd: \u5168\u3066\u306e\u8a8d\u8a3c\u30c8\u30fc\u30af\u30f3\u304c\u6b63\u3057\u304f\u66f4\u65b0\u3067\u304d\u307e\u3057\u305f\u3002\n```\n\n\u307e\u305f\u3001`SFTP`\u30e6\u30fc\u30b6\u30fc\u7528\u306e\u516c\u958b\u9375\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u901a\u5e38\u306f\u65b0\u3057\u304f\u4f5c\u308a\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u624b\u9806\u7c21\u7565\u306e\u305f\u3081\u306b`LOGIN_USER`\u306e\u516c\u958b\u9375`authorized_keys`\u3092`SFTP_USER`\u306e\u65b9\u3078\u30b3\u30d4\u30fc\u3057\u6a29\u9650\u3092\u5909\u66f4\u3057\u3066\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n> `cp /home/LOGIN_USER/.ssh/authorized_keys /home/SFTP_USER/.ssh/authorized_keys && \\`\n> `chmod 0600 /home/SFTP_USER/.ssh/authorized_keys && \\`\n> `chown SFTP_USER:SFTP_USER /home/SFTP_USER/.ssh/authorized_keys`\n\n\n## Nginx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\n\n`Nginx`\u306f**\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u30b5\u30fc\u30d0\u30fc**\u3068\u3057\u3066\u52d5\u4f5c\u3055\u305b\u3001\u305d\u306e\u80cc\u5f8c\u3067`Apache`\u3092\u52d5\u4f5c\u3055\u305b\u307e\u3059\u3002\n\u753b\u50cf\u306a\u3069\u306e\u9759\u7684\u30b3\u30f3\u30c6\u30f3\u30c4\u3092`Nginx`\u3067\u634c\u304d\u3001\u52d5\u7684\u51e6\u7406\u306f`Apache`\u3078\u6d41\u3059\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n\n### \u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u8ffd\u52a0\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u624b\u52d5\u3067`yum`\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n> `vim /etc/yum.repo.d/nginx.repo`\n\n```diff:/etc/yum.repo.d/nginx.repo\n+ [nginx]\n+ name=nginx repo\n+ baseurl=http://nginx.org/packages/mainline/rhel/$releasever/$basearch/\n+ gpgcheck=0\n+ enabled=1\n```\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u304c\u8ffd\u52a0\u3067\u304d\u305f\u3089\u3001`yum`\u30b3\u30de\u30f3\u30c9\u3067`Nginx`\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n> `yum install nginx`\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u305f\u3089`Nginx`\u306e\u81ea\u52d5\u5b9f\u884c\u306e\u767b\u9332\u3092\u3057\u307e\u3059\u3002\n\n> `chkconfig nginx on`\n\n\n### \u30d5\u30a1\u30a4\u30eb\u306e\u30aa\u30fc\u30d7\u30f3\u6570\u3068\u540c\u6642\u63a5\u7d9a\u6570\u306e\u4e0a\u9650\u306e\u8a2d\u5b9a\u3068gzip\u306e\u6709\u52b9\u5316\n\n\u30d5\u30a1\u30a4\u30eb\u306e\u30aa\u30fc\u30d7\u30f3\u6570\u3068\u540c\u6642\u63a5\u7d9a\u6570\u306e\u4e0a\u9650\u3092\u5f15\u304d\u4e0a\u3052\u3001\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u30fc\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u756a\u53f7\u3092\u975e\u8868\u793a\u306b\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001`gzip`\u3092\u6709\u52b9\u5316\u3057\u9ad8\u901f\u5316\u3092\u56f3\u308a\u307e\u3059\u3002\n\n> `vi /etc/nginx/nginx.conf`\n\n```diff:/etc/nginx/nginx.conf\n  :\n+ worker_rlimit_nofile    10240;\n  events {\n-     worker_connections  1024;\n+     worker_connections  10240;\n  }\n\n  http {\n      :\n-     #gzip                on;\n+     gzip                on;\n+     gzip_http_version   1.0;\n+     gzip_types          text/xml\n+                         text/css\n+                         text/javascript\n+                         application/xhtml+xml\n+                         application/xml\n+                         application/rss+xml\n+                         application/atom_xml\n+                         application/javascript\n+                         application/json\n+                         application/x-javascript\n+                         application/x-httpd-php;\n+     gzip_vary           on;\n+     gzip_proxied        any;\n+     gzip_comp_level     6;\n+     gzip_disable        \"MSIE [1-6]\\.\";\n      :\n+     server_tokens off;\n  }\n```\n\n\n### \u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068\u3057\u3066\u52d5\u4f5c\u3055\u305b\u308b\u8a2d\u5b9a\n\n`Nginx`\u3092\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068\u3057\u3066\u52d5\u4f5c\u3055\u305b\u308b\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\u4eca\u56de\u3001\u8907\u6570\u30c9\u30e1\u30a4\u30f3\u306e\u30c6\u30b9\u30c8\u3068\u3057\u3066\u3001\u901a\u5e38\u306e`(www.)example.com`\u3068\u30b5\u30d6\u30c9\u30e1\u30a4\u30f3\u306e`sub.example.com`\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u524d\u63d0\u3067\u9032\u3081\u307e\u3059\u3002\n\n> `vi /etc/nginx/conf.d/default.conf`\n\n```diff:/etc/nginx/conf.d/default.conf\n+ server {\n+     listen      80;\n+     server_name example.com www.example.com;\n+ \n+     access_log  /var/log/nginx/example.com.access.log;\n+     error_log   /var/log/nginx/example.com.error.log;\n+ \n+     location ~ .*\\.(jpg|JPG|gif|GIF|png|PNG|swf|SWF|css|CSS|js|JS|inc|INC|ico|ICO) {\n+         root    /var/www/html/example.com/htdocs;\n+         index   index.html;\n+         ssi     on;\n+     }\n+ \n+     location / {\n+         proxy_set_header Host               $host;\n+         proxy_set_header X-Real-IP          $remote_addr;\n+         proxy_set_header X-Forwarded-Host   $host;\n+         proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;\n+ \n+         proxy_pass  http://127.0.0.1:8080;\n+         proxy_redirect off;\n+ \n+         proxy_connect_timeout 120;\n+         proxy_read_timeout    120;\n+         proxy_send_timeout    120;\n+ \n+         proxy_max_temp_file_size 0;\n+     }\n+ }\n+ \n+ server {\n+     listen      80;\n+     server_name sub.example.com;\n+ \n+     access_log  /var/log/nginx/sub.example.com.access.log;\n+     error_log   /var/log/nginx/sub.example.com.error.log;\n+ \n+     location ~ .*\\.(jpg|JPG|gif|GIF|png|PNG|swf|SWF|css|CSS|js|JS|inc|INC|ico|ICO) {\n+         root    /var/www/html/sub.example.com/htdocs;\n+         index   index.html;\n+         ssi     on;\n+     }\n+ \n+     location / {\n+         proxy_set_header Host               $host;\n+         proxy_set_header X-Real-IP          $remote_addr;\n+         proxy_set_header X-Forwarded-Host   $host;\n+         proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;\n+ \n+         proxy_pass  http://127.0.0.1:8081;\n+         proxy_redirect off;\n+ \n+         proxy_connect_timeout 120;\n+         proxy_read_timeout    120;\n+         proxy_send_timeout    120;\n+ \n+         proxy_max_temp_file_size 0;\n+     }\n+ }\n```\n\n\u4fdd\u5b58\u3057\u305f\u3089\u3001\u6b63\u5e38\u306b\u8d77\u52d5\u51fa\u6765\u308b\u304b\u3069\u3046\u304b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u69cb\u6587\u30c1\u30a7\u30c3\u30af\u3092\u884c\u3044\u307e\u3059\u3002\n`successful`\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308c\u3070\u5927\u4e08\u592b\u3067\u3059\u3002\n\n> `service nginx configtest`\n\n```shell-session:\u5b9f\u884c\u7d50\u679c\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n```\n\n\n## Apache\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\n\n\u52d5\u7684\u51e6\u7406\u3092\u62c5\u5f53\u3059\u308b`Apache`\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f`Apache`\u306e`2.4`\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n\n### Software Collections(SCL)\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nCentOS6.x\u3067\u306f\u3001\u6a19\u6e96\u306e`yum`\u3067\u306f`Apache2.4`\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\n`SCL`\u3068\u306f\u3001Red Hat\u304c\u63d0\u4f9b\u3059\u308b\u6700\u65b0\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u5b89\u5b9a\u7248\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u63d0\u4f9b\u3057\u3001\u304b\u3064`yum`\u306e\u65e7\u30d1\u30c3\u30b1\u30fc\u30b8\u3068\u5171\u5b58\u3055\u305b\u3066\u304f\u308c\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u3067\u3059\u3002\n\n> `yum install centos-release-scl`\n> `yum-config-manager --enable rhel-server-rhscl-7-rpms`\n\n\n### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nSCL\u3092\u7528\u3044\u3066`Apache2.4`\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n> `yum install httpd24`\n> `scl enable httpd24 bash`\n> `chkconfig httpd24-httpd on`\n\n`apxs`\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3001`apr-devel.x86_64`\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n> `yum install apr-devel.x86_64`\n\n\n### \u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u306e\u4f5c\u6210\n\n`Apache2.2`\u3068\u540c\u3058\u3088\u3046\u306b\u64cd\u4f5c\u51fa\u6765\u308b\u3088\u3046\u306b\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u5f35\u308a\u307e\u3059\u3002\n\n> `ln -s /opt/rh/httpd24/root/etc/httpd /etc/httpd && \\`\n> `ln -s /opt/rh/httpd24/root/var/log/httpd /var/log/httpd && \\`\n> `ln -s /opt/rh/httpd24/root/var/www /var/www && \\`\n> `ln -s /opt/rh/httpd24/root/usr/bin/apxs /usr/bin/apxs && \\`\n> `ln -s /opt/rh/httpd24/root/usr/lib64/httpd /usr/lib64/httpd`\n\n\n### \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u306e\u4f5c\u6210\u3068\u6a29\u9650\u306e\u5909\u66f4\n\n\u30c9\u30e1\u30a4\u30f3\u6bce\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u3092\u4f5c\u6210\u3057\u3001SFTP\u3067\u6271\u3048\u308b\u3088\u3046\u306b\u6a29\u9650\u3092\u5909\u66f4\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u3088\u308a\u4e0a\u306e\u968e\u5c64\u306b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8a2d\u7f6e\u3057\u305f\u3044\u5834\u5408\u3082\u3042\u308b\u3068\u601d\u3046\u306e\u3067\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u306f\u30c9\u30e1\u30a4\u30f3\u5225\u306e\u4e2d\u306b`htdocs`\u3067\u4e00\u968e\u5c64\u4e0b\u3052\u3066\u3042\u308a\u307e\u3059\u3002\n\n`(www.)example.com`\u7528\n\n> `mkdir -p /var/www/html/example.com/htdocs && \\`\n> `chmod 0755 /var/www/html/example.com && \\`\n> `chmod 0755 /var/www/html/example.com/htdocs && \\`\n> `chown SFTP_USER:SFTP_USER /var/www/html/example.com && \\`\n> `chown SFTP_USER:SFTP_USER /var/www/html/example.com/htdocs`\n\n`sub.example.com`\u7528\n\n> `mkdir -p /var/www/html/sub.example.com/htdocs && \\`\n> `chmod 0755 /var/www/html/sub.example.com && \\`\n> `chmod 0755 /var/www/html/sub.example.com/htdocs && \\`\n> `chown SFTP_USER:SFTP_USER /var/www/html/sub.example.com && \\`\n> `chown SFTP_USER:SFTP_USER /var/www/html/sub.example.com/htdocs`\n\n\n### mod_rpaf\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u3092Apache\u5074\u3067\u53d7\u3051\u53d6\u308b\u969b\u306b\u3001\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u306e\u30a2\u30c9\u30ec\u30b9\u304c\u8a18\u9332\u3055\u308c\u308b\u5bfe\u7b56\u3068\u3057\u3066\u3001mod_rpaf\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n[GitHub](https://github.com/gnif/mod_rpaf)\u304b\u3089\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u30af\u30ed\u30fc\u30f3\u3057\u3001`mod_rpaf.so`\u3092\u751f\u6210\u3057\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n> `git clone https://github.com/gnif/mod_rpaf ~/mod_rpaf && \\`\n> `cd ~/mod_rpaf && \\`\n> `make && \\`\n> `make install`\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3057\u305f\u3089GitHub\u304b\u3089\u30af\u30ed\u30fc\u30f3\u3057\u305f\u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u306f\u524a\u9664\u3057\u307e\u3059\u3002\n\n> `cd ~ && \\`\n> `rm -rf ~/mod_rpaf`\n\n\n### \u57fa\u672c\u8a2d\u5b9a\u3068\u30d0\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\u8a2d\u5b9a\n\n`Apache`\u306e\u57fa\u672c\u8a2d\u5b9a\u3084\u30d0\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n> `vi /etc/httpd/conf/httpd.conf`\n\nApache\u3092\u5b9f\u884c\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u3068\u30b0\u30eb\u30fc\u30d7\u3092`SFTP_USER`\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```diff:/opt/rh/httpd24/root/etc/httpd/conf/httpd.conf\n- User apache\n- Group apache\n+ User SFTP_USER\n+ Group SFTP_USER\n```\n\n\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u30fc\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u756a\u53f7\u3068\u30b5\u30fc\u30d0\u30fc\u7f72\u540d\u3092\u975e\u8868\u793a\u306b\u3057\u307e\u3059\u3002\n\u4e0b\u8a18\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\n```diff:/opt/rh/httpd24/root/etc/httpd/conf/httpd.conf\n+ ServerTokens Prod\n+ ServerSignature Off\n```\n\n`Nginx`\u306e`default.conf`\u3067\u6307\u5b9a\u3057\u305f\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u8907\u6570\u30dd\u30fc\u30c8\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u30011\u884c\u305a\u3064\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n```diff:/opt/rh/httpd24/root/etc/httpd/conf/httpd.conf\n+ Listen 8080\n+ Listen 8081\n```\n\n\u30b5\u30fc\u30d0\u30fc\u7ba1\u7406\u8005\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002\n\n```diff:/opt/rh/httpd24/root/etc/httpd/conf/httpd.conf\n+ ServerAdmin test@example.com\n```\n\n\u30b5\u30fc\u30d0\u30fc\u540d\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u3053\u3053\u306f\u30e1\u30a4\u30f3\u306e\u30c9\u30e1\u30a4\u30f3\u306b\u306a\u308a\u307e\u3059\u3002\n\n```diff:/opt/rh/httpd24/root/etc/httpd/conf/httpd.conf\n+ ServerName example.com:8080\n```\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u306e\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002\n\u30aa\u30d7\u30b7\u30e7\u30f3\u3068\u3057\u3066\u30d6\u30e9\u30a6\u30b6\u3067\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u3092\u8868\u793a\u3055\u305b\u306a\u3044\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u3042\u308f\u305b\u3066\u3001`.htaccess`\u30d5\u30a1\u30a4\u30eb\u3067\u306e\u8a2d\u5b9a\u306e\u4e0a\u66f8\u304d\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```diff:/opt/rh/httpd24/root/etc/httpd/conf/httpd.conf\n  :\n- DocumentRoot \"/opt/rh/httpd24/root/var/www/html\"\n+ DocumentRoot \"/var/www/html\"\n  :\n- <Directory \"/opt/rh/httpd24/root/var/www/html\">\n+ <Directory \"/var/www/html\">\n  :\n```\n\n```diff:/opt/rh/httpd24/root/etc/httpd/conf/httpd.conf\n  :\n  <Directory \"/var/www/html\">\n      :\n-     Options Indexes FollowSymLinks\n+     Options FollowSymLinks SymLinksIfOwnerMatch\n      :\n-     AllowOverride None\n+     AllowOverride All\n      :\n  </Directory>\n  :\n```\n\nIndex\u30d5\u30a1\u30a4\u30eb\u306b`index.php`\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u3042\u308f\u305b\u3066\u3001`index.php`\u304c\u512a\u5148\u3055\u308c\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```diff:/opt/rh/httpd24/root/etc/httpd/conf/httpd.conf\n  :\n  <IfModule dir_module>\n-     DirectoryIndex index.html\n+     DirectoryIndex index.php index.html\n  </IfModule>\n  :\n```\n\n`.php`\u30d5\u30a1\u30a4\u30eb\u304c\u5b9f\u884c\u51fa\u6765\u308b\u3088\u3046\u306b\u3001\u62e1\u5f35\u5b50\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001`.shtml`\u306f\u4f7f\u7528\u3057\u306a\u3044\u306e\u3067\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u307e\u3059\u3002\n\n```diff:/opt/rh/httpd24/root/etc/httpd/conf/httpd.conf\n  :\n  <IfModule mime_module>\n      :\n+     AddType application/x-httpd-php .php\n      :\n-     AddType text/html .shtml\n-     AddOutputFilter INCLUDES .shtml\n+     #AddType text/html .shtml\n+     #AddOutputFilter INCLUDES .shtml\n      :\n  </IfModule>\n  :\n```\n\n\u6700\u5f8c\u306b\u30d0\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\n```diff:/opt/rh/httpd24/root/etc/httpd/conf/httpd.conf\n+ # Virtual Host\n+ <VirtualHost 127.0.0.1:8080>\n+     ServerName example.com\n+     DocumentRoot /var/www/html/example.com/htdocs\n+     ErrorLog /var/log/httpd/example.com.access.log\n+ \n+     RPAF_Enable On\n+     RPAF_SetHostName On\n+     RPAF_ProxyIPs 127.0.0.1 10.0.0.1\n+     RPAF_Header X-Forwarded-For\n+     <Directory \"/var/www/html/example.com/htdocs\">\n+         Require all granted\n+     </Directory>\n+ </VirtualHost>\n+ \n+ <VirtualHost 127.0.0.1:8081>\n+     ServerName sub.example.com\n+     DocumentRoot /var/www/html/sub.example.com/htdocs\n+     ErrorLog /var/log/httpd/sub.example.com.access.log\n+ \n+     RPAF_Enable On\n+     RPAF_SetHostName On\n+     RPAF_ProxyIPs 127.0.0.1 10.0.0.1\n+     RPAF_Header X-Forwarded-For\n+     <Directory \"/var/www/html/sub.example.com/htdocs\">\n+         Require all granted\n+     </Directory>\n+ </VirtualHost>\n```\n\n\n### mod_rpaf\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8aad\u307f\u8fbc\u3080\u8a2d\u5b9a\n\n\u57fa\u672c\u30e2\u30b8\u30e5\u30fc\u30eb\u7528\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb`00-base.conf`\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n> `vi /etc/httpd/conf.modules.d/00-base.conf`\n\n\u4e0b\u8a18\u3092\u8ffd\u8a18\u3057\u3066\u3001`mod_rpaf.so`\u304c\u8aad\u307f\u8fbc\u307e\u308c\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```diff:/opt/rh/httpd24/root/etc/httpd/conf.modules.d/00-base.conf\n+ LoadModule rpaf_module modules/mod_rpaf.so\n```\n\n\n### \u30c6\u30b9\u30c8\u30da\u30fc\u30b8\u306e\u524a\u9664(\u30d0\u30c3\u30af\u30a2\u30c3\u30d7)\n\n\u3053\u306e\u307e\u307e\u3060\u3068`404 NotFound`\u306a\u3069\u306b\u306a\u3063\u305f\u969b\u306bApache\u306e\u30c6\u30b9\u30c8\u30da\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3059\u308b\u304b\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u5909\u3048\u3066\u304a\u304d\u307e\u3059\u3002\n\n> `cd /opt/rh/httpd24/root/usr/share/httpd/noindex/`\n> `mv index.html index.html.bak`\n\n\n### \u8a2d\u5b9a\u306e\u69cb\u6587\u30c1\u30a7\u30c3\u30af\n\n\u6b63\u5e38\u306b\u8d77\u52d5\u51fa\u6765\u308b\u304b\u3069\u3046\u304b\u3001\u8a2d\u5b9a\u306e\u69cb\u6587\u30c1\u30a7\u30c3\u30af\u3092\u884c\u3044\u307e\u3059\u3002\n\n> `service httpd24-httpd configtest`\n\n```shell-session:\u5b9f\u884c\u7d50\u679c\nSyntax OK\n```\n\n`Syntax OK`\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308c\u3070\u5927\u4e08\u592b\u3067\u3059\u3002\n\n\n### Nginx\u3068Apache\u306e\u8d77\u52d5\n\n\u5168\u3066\u306e\u8a2d\u5b9a\u304c\u5b8c\u4e86\u3057\u305f\u3089`Nginx`\u3068`Apache`\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n> `service nginx start && \\`\n> `service httpd24-httpd start`\n\n```shell-session:\u5b9f\u884c\u7d50\u679c\nnginx \u3092\u8d77\u52d5\u4e2d:                                            [  OK  ]\nStarting httpd:                                            [  OK  ]\n```\n\n\n### LogWatch\u306e\u8a2d\u5b9a\u306e\u4fee\u6b63\n\n`Apache`\u306f\u6a19\u6e96\u3067\u76e3\u8996\u5bfe\u8c61\u3067\u3059\u304c`Nginx`\u306f\u76e3\u8996\u3055\u308c\u307e\u305b\u3093\u3002\n`Nginx`\u306e\u30ed\u30b0\u304c\u542b\u307e\u308c\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n`Apache`\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\u3057\u3066\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n> `cp /usr/share/logwatch/scripts/services/http /etc/logwatch/scripts/services/nginx && \\`\n> `cp /usr/share/logwatch/default.conf/services/http.conf /etc/logwatch/conf/services/nginx.conf && \\`\n> `cp /usr/share/logwatch/default.conf/logfiles/http.conf /etc/logwatch/conf/logfiles/nginx.conf`\n\n\u76e3\u8996\u30b5\u30fc\u30d3\u30b9\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n> `vi /etc/logwatch/conf/services/nginx.conf`\n\n```diff:/etc/logwatch/conf/services/nginx.conf\n  :\n- Title = \"httpd\"\n+ Title = \"nginx\"\n  :\n- LogFile = http\n+ LogFile = nginx\n  :\n```\n\n\u76e3\u8996\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n> `vi /etc/logwatch/conf/logfiles/nginx.conf`\n\n```diff:/etc/logwatch/conf/logfiles/nginx.conf\n  :\n- #LogFile = httpd/*access_log\n- #LogFile = apache/*access.log.1\n- #LogFile = apache/*access.log\n- #LogFile = apache2/*access.log.1\n- #LogFile = apache2/*access.log\n- #LogFile = apache2/*access_log\n- #LogFile = apache-ssl/*access.log.1\n- #LogFile = apache-ssl/*access.log\n+ LogFile = nginx/*access.log\n  :\n- #Archive = archiv/httpd/*access_log.*\n- #Archive = httpd/*access_log.*\n- #Archive = apache/*access.log.*.gz\n- #Archive = apache2/*access.log.*.gz\n- #Archive = apache2/*access_log.*.gz\n- #Archive = apache-ssl/*access.log.*.gz\n+ Archive = nginx/*access.log.*.gz\n  :\n```\n\n\n## SSH\u306e\u8a2d\u5b9a\u306e\u4fee\u6b63\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u306a\u3069\u3082\u4f5c\u3089\u308c\u305f\u305f\u3081\u3001`SFTP`\u3092\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b`SSH`\u306e\u8a2d\u5b9a\u3092\u4fee\u6b63\u3057\u307e\u3059\u3002\n\n> `vi /etc/ssh/sshd_config`\n\n`Subsystem sftp`\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```diff:/etc/ssh/sshd_config\n  # override default of no subsystems\n- #Subsystem      sftp    /usr/libexec/openssh/sftp-server\n+ Subsystem       sftp    internal-sftp\n```\n\n`Match User`\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n`ChrootDirectory`\u306f\u3001`Apache`\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u3092\u6307\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```diff:/etc/ssh/sshd_config\n+ Match User SFTP_USER\n+     ChrootDirectory /var/www/html\n+     ForceCommand internal-sftp\n```\n\n\u8a2d\u5b9a\u3092\u4fdd\u5b58\u3057\u305f\u3089\u3001`sshd`\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n> `service sshd restart`\n\n\n## \u6b21\u56de\n\n[\u3055\u304f\u3089\u306eVPS \u6a19\u6e96OS\u306e\u74b0\u5883\u69cb\u7bc9(4) MariaDB\u3068PHP\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7](http://qiita.com/takahiko-takei/items/bcbfc8195188a3bce6d7)\n", "tags": ["\u30b5\u30fc\u30d0\u30fc\u69cb\u7bc9", "\u3055\u304f\u3089\u306eVPS", "CentOS6.x", "nginx", "Apache2.4"]}