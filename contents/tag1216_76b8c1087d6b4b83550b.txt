{"context": " More than 1 year has passed since last update.\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30b3\u30f3\u30c6\u30ca\u304b\u3089Injection\u3055\u308c\u305f\u5024(Bean)\u3092\u4f7f\u3063\u305f\u30ab\u30b9\u30bf\u30e0Validator\u304c\u3042\u3063\u305f\u3068\u3059\u308b\u3002\n\nMyConstraintValidator.java\n/**\n * \u30b3\u30f3\u30c6\u30ca\u3067\"hoge\"\u306b\u767b\u9332\u3055\u308c\u305f\u6587\u5b57\u5217\u3068\u4e00\u81f4\u3059\u308b\u304b\u691c\u8a3c\u3059\u308b\u3002\n */\npublic class MyConstraintValidator implements ConstraintValidator<MyConstraint, String> {\n    @Autowired\n    private String hoge;\n    @Override\n    public void initialize(MyConstraint paramA) {\n    }\n    @Override\n    public boolean isValid(String value, ConstraintValidatorContext paramConstraintValidatorContext) {\n        Objects.requireNonNull(hoge);\n        return Objects.equals(value, hoge);\n    }\n}\n\n\n\u3053\u306eValidator\u306bInjection\u3057\u3066\u4f7f\u3046\u306b\u306f\u3001Spring\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u3053\u3053\u3089\u3078\u3093\u3092\u898b\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u304c\u5fc5\u8981\u306b\u306a\u308b\u3002\n<bean id=\"validator\"\n    class=\"org.springframework.validation.beanvalidation.LocalValidatorFactoryBean\"/>\n\n@Configuration\u306a\u30af\u30e9\u30b9\u3067\u8a2d\u5b9a\u3059\u308b\u5834\u5408\u306f\u3053\u3046\u306a\u308b\u3002\n@Bean\npublic javax.validation.Validator localValidatorFactoryBean() {\n   return new LocalValidatorFactoryBean();\n}\n\n\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3067\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3059\u308b\u5834\u5408\u306a\u3093\u304b\u306b\u306f\u4e0a\u8a18\u3060\u3051\u3067\u3082\u826f\u3044\u304c\u3001Hibernate\u3067\u4f7f\u3046\u5834\u5408\u306b\u306f\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3067EntityManagerFactory\u306bValidator\u306e\u53c2\u7167\u3092\u6e21\u3059\u5fc5\u8981\u304c\u3042\u308b\u3002\nhttp://stackoverflow.com/questions/2712345/jsr-303-dependency-injection-and-hibernate\n<bean id=\"entityManagerFactory\" class=\"org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean\">\n <property name=\"jpaPropertyMap\">\n  <map>\n   <entry key=\"javax.persistence.validation.factory\" value-ref=\"validator\" />               \n  </map>\n </property>\n</bean>\n\n\u3053\u308c\u3092Spring Boot\u3067\u8a2d\u5b9a\u3059\u308b\u5834\u5408\u3001SpringBoot\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u3053\u3053\u3092\u898b\u308b\u3068application.properties\u3067spring.jpa.properties.*\u306bJPA\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u6307\u5b9a\u3059\u308c\u3070\u3044\u3044\u306e\u3060\u304c\u306a\u3093\u304b\u5acc\u306a\u4e88\u611f\u3002\u3002\u3002\n\napplication.properties\nspring.jpa.properties.javax.persistence.validation.factory=validator\n\n\n\u3053\u308c\u3067\u306f\"validator\"\u3068\u3044\u3046\u6587\u5b57\u5217\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u3060\u3051\u306a\u306e\u3067\u30a8\u30e9\u30fc\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u3002\u8a66\u3057\u306b\u30af\u30e9\u30b9\u540d\u3092\u6307\u5b9a\u3057\u3066\u307f\u3066\u3082\u30c0\u30e1\u3002\nCaused by: org.hibernate.cfg.beanvalidation.IntegrationException: Given object was not an instance of javax.validation.ValidatorFactory[java.lang.String]\n\nBean\u306e\u53c2\u7167\u3092\u8a2d\u5b9a\u3059\u308b\u306b\u306f\u30d7\u30ed\u30d1\u30c6\u30a3\u30d5\u30a1\u30a4\u30eb\u3067\u306f\u3060\u3081\u307d\u306a\u306e\u3067@Configuration\u306a\u30af\u30e9\u30b9\u3067\u8a2d\u5b9a\u3059\u308b\u3057\u304b\u306a\u3055\u305d\u3046\u3002\n    @Bean\n    public LocalContainerEntityManagerFactoryBean entityManagerFactory(\n            EntityManagerFactoryBuilder builder, DataSource dataSource, JpaProperties jpaProperties) {\n\n        LocalContainerEntityManagerFactoryBean factory = builder\n                .dataSource(dataSource)\n                .packages(Application.class)\n                .persistenceUnit(\"default\")\n                .properties(jpaProperties.getHibernateProperties(dataSource))\n                .build();\n\n        Map<String, Object> jpaPropertyMap = new HashMap<>();\n        jpaPropertyMap.put(\"javax.persistence.validation.factory\", validator());\n        factory.setJpaPropertyMap(jpaPropertyMap);\n        return factory;\n    }\n\nLocalContainerEntityManagerFactoryBean\u306e\u751f\u6210\u90e8\u5206\u306fJpaBaseConfiguration.entityManagerFactory()\u306e\u30bd\u30fc\u30b9\u3092\u53c2\u8003\u306b\u3057\u305f\u3002\n\u3084\u308a\u305f\u3044\u4e8b\u306fjpaPropertyMap.put(\"javax.persistence.validation.factory\", validator();\u306e1\u884c\u3060\u3051\u306a\u3093\u3060\u3051\u3069\u3001\u3082\u3063\u3068\u3044\u3044\u3084\u308a\u65b9\u306f\u306a\u3044\u3093\u3060\u308d\u3046\u304b\uff1f\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30b3\u30f3\u30c6\u30ca\u304b\u3089Injection\u3055\u308c\u305f\u5024(Bean)\u3092\u4f7f\u3063\u305f\u30ab\u30b9\u30bf\u30e0Validator\u304c\u3042\u3063\u305f\u3068\u3059\u308b\u3002\n\n```java:MyConstraintValidator.java\n/**\n * \u30b3\u30f3\u30c6\u30ca\u3067\"hoge\"\u306b\u767b\u9332\u3055\u308c\u305f\u6587\u5b57\u5217\u3068\u4e00\u81f4\u3059\u308b\u304b\u691c\u8a3c\u3059\u308b\u3002\n */\npublic class MyConstraintValidator implements ConstraintValidator<MyConstraint, String> {\n    @Autowired\n    private String hoge;\n    @Override\n    public void initialize(MyConstraint paramA) {\n    }\n    @Override\n    public boolean isValid(String value, ConstraintValidatorContext paramConstraintValidatorContext) {\n        Objects.requireNonNull(hoge);\n        return Objects.equals(value, hoge);\n    }\n}\n```\n\n\u3053\u306eValidator\u306bInjection\u3057\u3066\u4f7f\u3046\u306b\u306f\u3001Spring\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067[\u3053\u3053\u3089\u3078\u3093](http://docs.spring.io/spring/docs/current/spring-framework-reference/htmlsingle/#validation-beanvalidation-spring)\u3092\u898b\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u304c\u5fc5\u8981\u306b\u306a\u308b\u3002\n\n```xml\n<bean id=\"validator\"\n    class=\"org.springframework.validation.beanvalidation.LocalValidatorFactoryBean\"/>\n```\n@Configuration\u306a\u30af\u30e9\u30b9\u3067\u8a2d\u5b9a\u3059\u308b\u5834\u5408\u306f\u3053\u3046\u306a\u308b\u3002\n\n```java\n@Bean\npublic javax.validation.Validator localValidatorFactoryBean() {\n   return new LocalValidatorFactoryBean();\n}\n```\n\n\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3067\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3059\u308b\u5834\u5408\u306a\u3093\u304b\u306b\u306f\u4e0a\u8a18\u3060\u3051\u3067\u3082\u826f\u3044\u304c\u3001Hibernate\u3067\u4f7f\u3046\u5834\u5408\u306b\u306f\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3067EntityManagerFactory\u306b**Validator\u306e\u53c2\u7167**\u3092\u6e21\u3059\u5fc5\u8981\u304c\u3042\u308b\u3002\nhttp://stackoverflow.com/questions/2712345/jsr-303-dependency-injection-and-hibernate\n\n```xml\n<bean id=\"entityManagerFactory\" class=\"org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean\">\n <property name=\"jpaPropertyMap\">\n  <map>\n   <entry key=\"javax.persistence.validation.factory\" value-ref=\"validator\" />               \n  </map>\n </property>\n</bean>\n```\n\n\u3053\u308c\u3092Spring Boot\u3067\u8a2d\u5b9a\u3059\u308b\u5834\u5408\u3001SpringBoot\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067[\u3053\u3053](http://docs.spring.io/spring-boot/docs/1.1.6.RELEASE/reference/htmlsingle/#common-application-properties)\u3092\u898b\u308b\u3068application.properties\u3067```spring.jpa.properties.*```\u306bJPA\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u6307\u5b9a\u3059\u308c\u3070\u3044\u3044\u306e\u3060\u304c\u306a\u3093\u304b\u5acc\u306a\u4e88\u611f\u3002\u3002\u3002\n\n```properties:application.properties\nspring.jpa.properties.javax.persistence.validation.factory=validator\n```\n\u3053\u308c\u3067\u306f**\"validator\"\u3068\u3044\u3046\u6587\u5b57\u5217**\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u3060\u3051\u306a\u306e\u3067\u30a8\u30e9\u30fc\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u3002\u8a66\u3057\u306b\u30af\u30e9\u30b9\u540d\u3092\u6307\u5b9a\u3057\u3066\u307f\u3066\u3082\u30c0\u30e1\u3002\n\n```console\nCaused by: org.hibernate.cfg.beanvalidation.IntegrationException: Given object was not an instance of javax.validation.ValidatorFactory[java.lang.String]\n```\n\nBean\u306e\u53c2\u7167\u3092\u8a2d\u5b9a\u3059\u308b\u306b\u306f\u30d7\u30ed\u30d1\u30c6\u30a3\u30d5\u30a1\u30a4\u30eb\u3067\u306f\u3060\u3081\u307d\u306a\u306e\u3067@Configuration\u306a\u30af\u30e9\u30b9\u3067\u8a2d\u5b9a\u3059\u308b\u3057\u304b\u306a\u3055\u305d\u3046\u3002\n\n```java\n    @Bean\n    public LocalContainerEntityManagerFactoryBean entityManagerFactory(\n            EntityManagerFactoryBuilder builder, DataSource dataSource, JpaProperties jpaProperties) {\n\n        LocalContainerEntityManagerFactoryBean factory = builder\n                .dataSource(dataSource)\n                .packages(Application.class)\n                .persistenceUnit(\"default\")\n                .properties(jpaProperties.getHibernateProperties(dataSource))\n                .build();\n\n        Map<String, Object> jpaPropertyMap = new HashMap<>();\n        jpaPropertyMap.put(\"javax.persistence.validation.factory\", validator());\n        factory.setJpaPropertyMap(jpaPropertyMap);\n        return factory;\n    }\n```\nLocalContainerEntityManagerFactoryBean\u306e\u751f\u6210\u90e8\u5206\u306fJpaBaseConfiguration.entityManagerFactory()\u306e\u30bd\u30fc\u30b9\u3092\u53c2\u8003\u306b\u3057\u305f\u3002\n\n\u3084\u308a\u305f\u3044\u4e8b\u306f```jpaPropertyMap.put(\"javax.persistence.validation.factory\", validator();```\u306e1\u884c\u3060\u3051\u306a\u3093\u3060\u3051\u3069\u3001\u3082\u3063\u3068\u3044\u3044\u3084\u308a\u65b9\u306f\u306a\u3044\u3093\u3060\u308d\u3046\u304b\uff1f\n", "tags": ["spring", "spring-boot", "Hibernate", "Java"]}