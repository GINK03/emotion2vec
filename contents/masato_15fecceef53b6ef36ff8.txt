{"tags": ["IDCF\u30af\u30e9\u30a6\u30c9", "cli", "Python", "docker-compose"], "context": " More than 1 year has passed since last update.Docker\u30b3\u30f3\u30c6\u30ca\u4e0a\u3067CLI\u3092\u5b9f\u884c\u3059\u308b\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u3092\u4ee5\u524d\u8abf\u3079\u307e\u3057\u305f\u304c\u3001\u4eca\u56de\u306fIDCF\u30af\u30e9\u30a6\u30c9\u306eCLI\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u3063\u3066\u307f\u307e\u3059\u3002virtuanemv\u3067\u4eee\u60f3\u74b0\u5883\u3092\u7528\u610f\u3057\u3066\u3082\u826f\u3044\u306e\u3067\u3059\u304c\u3001Docker\u30a4\u30e1\u30fc\u30b8\u3067\u30b3\u30de\u30f3\u30c9\u3092\u914d\u5e03\u3059\u308b\u3068\u30db\u30b9\u30c8\u30de\u30b7\u30f3\u306e\u74b0\u5883\u3092\u6c5a\u3055\u305a\u306b\u304a\u8a66\u3057\u3067\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002CLI\u306e\u914d\u5e03\u5f62\u5f0f\u3068\u3057\u3066\u3082Docker\u30a4\u30e1\u30fc\u30b8\u306f\u4fbf\u5229\u306b\u4f7f\u3048\u307e\u3059\u3002\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\n\u4eca\u56de\u4f5c\u6210\u3057\u305f\u30ea\u30dd\u30b8\u30c8\u30ea\u306f\u3053\u3061\u3089\u3067\u3059\u3002\n\nDockerfile\n\u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u306f\u30aa\u30d5\u30a3\u30b7\u30e3\u30eb\u306ePython\u306e2.7 ONBUILD\u3092\u4f7f\u3044\u307e\u3059\u3002ONBUILD\u3067\u30d3\u30eb\u30c9\u306b\u5fc5\u8981\u306a\u51e6\u7406\u3092\u3059\u308b\u305f\u3081Dockerfile\u306f\u3068\u3066\u3082\u7c21\u5358\u3067\u3059\u3002\n\nDockerfile\nFROM python:2-onbuild\n\n\n\nrequirements.txt\nIDCF\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u306frequirements.txt\u304c\u540c\u68b1\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u4f9d\u5b58\u3059\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u8ffd\u52a0\u3068\u3001cloudstack-api\u3082GitHub\u7d4c\u7531\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3088\u3046\u306b\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\nrequirements.txt\nhttplib2\nsimplejson\nargparse\nprettytable==0.5\nparsedatetime==0.8.7\nlxml\n-e git+https://github.com/idcf/cloudstack-api#egg=cloudstack-api\n\n\nONBUILD\u306e\u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u304crequirements.txt\u30d5\u30a1\u30a4\u30eb\u306eCOPY\u3068pip install\u3092\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\nDockerfile\nFROM python:2.7\n\nRUN mkdir -p /usr/src/app\nWORKDIR /usr/src/app\n\nONBUILD COPY requirements.txt /usr/src/app/\nONBUILD RUN pip install --no-cache-dir -r requirements.txt\n\nONBUILD COPY . /usr/src/app\n\n\n\ndocker-compose.yml\nIDCF\u30af\u30e9\u30a6\u30c9\u30b3\u30f3\u30bd\u30fc\u30eb\u306eAPI Key\u304b\u3089\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\nIDCF_COMPUTE_HOST: \u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\nIDCF_COMPUTE_API_KEY: API Key\nIDCF_COMPUTE_SECRET_KEY: Secret Key\n\n\ndocker-compose.yml\nidcfcli:\n  build: .\n  volumes:\n    - /etc/localtime:/etc/localtime:ro\n  environment:\n    - IDCF_COMPUTE_HOST=\n    - IDCF_COMPUTE_API_KEY=\n    - IDCF_COMPUTE_SECRET_KEY=\n  command: [\"/usr/local/bin/cloudstack-api\",\"listVirtualMachines\",\"-t=id,name,state\"]\n\n\n\n\u4f7f\u3044\u65b9\n\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089git clone\u3057\u307e\u3059\u3002docker-compose.yml.default\u3092docker-compose.yml\u306b\u30ea\u30cd\u30fc\u30e0\u3057\u3066\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n$ git clone https://github.com/masato/docker-idcfcli.git idcfcli\n$ cd idcfcli\n$ mv docker-compose.yml.default docker-compose.yml\n$ vi docker-compose.yml\n\nDocker Compose\u304b\u3089\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30b3\u30de\u30f3\u30c9\u306flistVirtualMachines\u3092\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u3002\n$ docker-compose build\n$ docker-compose run --rm idcfcli\n+--------------------------------------+------+---------+\n|                  id                  | name |  state  |\n+--------------------------------------+------+---------+\n| xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx | seed | Running |\n+--------------------------------------+------+---------+\n\n\u4efb\u610f\u306e\u30b3\u30de\u30f3\u30c9\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9f\u884c\u3057\u307e\u3059\u3002\n$ docker-compose run --rm idcfcli cloudstack-api listVirtualMachines -t=id,name,state\n+--------------------------------------+------+---------+\n|                  id                  | name |  state  |\n+--------------------------------------+------+---------+\n| xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx | seed | Running |\n+--------------------------------------+------+---------+\n\n\n\u30a8\u30a4\u30ea\u30a2\u30b9\u306e\u4f5c\u6210\n~/.bashrc\u306a\u3069\u306b\u30a8\u30a4\u30ea\u30a2\u30b9\u3092\u5b9a\u7fa9\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n~/.bashrc\nalias idcf-cli='docker-compose run --rm idcfcli cloudstack-api'\n\n\n\u30a8\u30a4\u30ea\u30a2\u30b9\u3092\u4f7f\u3046\u3068\u3088\u308aCLI\u3089\u3057\u304f\u306a\u308a\u307e\u3059\u3002\n$ idcf-cli listVirtualMachines -t=id,name,state\n+--------------------------------------+------+---------+\n|                  id                  | name |  state  |\n+--------------------------------------+------+---------+\n| xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx | seed | Running |\n+--------------------------------------+------+---------+\n\n[Docker\u30b3\u30f3\u30c6\u30ca\u4e0a\u3067CLI\u3092\u5b9f\u884c\u3059\u308b\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3](http://qiita.com/masato/items/a39b43290d7efe3f6630)\u3092\u4ee5\u524d\u8abf\u3079\u307e\u3057\u305f\u304c\u3001\u4eca\u56de\u306f[IDCF\u30af\u30e9\u30a6\u30c9\u306eCLI](http://www.idcf.jp/cloud/spec/api.html)\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u3063\u3066\u307f\u307e\u3059\u3002[virtuanemv](https://virtualenv.pypa.io/en/latest/)\u3067\u4eee\u60f3\u74b0\u5883\u3092\u7528\u610f\u3057\u3066\u3082\u826f\u3044\u306e\u3067\u3059\u304c\u3001Docker\u30a4\u30e1\u30fc\u30b8\u3067\u30b3\u30de\u30f3\u30c9\u3092\u914d\u5e03\u3059\u308b\u3068\u30db\u30b9\u30c8\u30de\u30b7\u30f3\u306e\u74b0\u5883\u3092\u6c5a\u3055\u305a\u306b\u304a\u8a66\u3057\u3067\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002CLI\u306e\u914d\u5e03\u5f62\u5f0f\u3068\u3057\u3066\u3082Docker\u30a4\u30e1\u30fc\u30b8\u306f\u4fbf\u5229\u306b\u4f7f\u3048\u307e\u3059\u3002\n\n## \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\n\n\u4eca\u56de\u4f5c\u6210\u3057\u305f\u30ea\u30dd\u30b8\u30c8\u30ea\u306f[\u3053\u3061\u3089](https://github.com/masato/docker-idcfcli)\u3067\u3059\u3002\n\n### Dockerfile\n\n\u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u306f\u30aa\u30d5\u30a3\u30b7\u30e3\u30eb\u306e[Python](https://hub.docker.com/_/python/)\u306e2.7 ONBUILD\u3092\u4f7f\u3044\u307e\u3059\u3002ONBUILD\u3067\u30d3\u30eb\u30c9\u306b\u5fc5\u8981\u306a\u51e6\u7406\u3092\u3059\u308b\u305f\u3081Dockerfile\u306f\u3068\u3066\u3082\u7c21\u5358\u3067\u3059\u3002\n\n``` bash:Dockerfile\nFROM python:2-onbuild\n```\n\n### requirements.txt\n\nIDCF\u306e[\u30ea\u30dd\u30b8\u30c8\u30ea](https://github.com/idcf/cloudstack-api)\u306b\u306frequirements.txt\u304c\u540c\u68b1\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u4f9d\u5b58\u3059\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u8ffd\u52a0\u3068\u3001cloudstack-api\u3082GitHub\u7d4c\u7531\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3088\u3046\u306b\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n```txt:requirements.txt\nhttplib2\nsimplejson\nargparse\nprettytable==0.5\nparsedatetime==0.8.7\nlxml\n-e git+https://github.com/idcf/cloudstack-api#egg=cloudstack-api\n```\n\nONBUILD\u306e\u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u304crequirements.txt\u30d5\u30a1\u30a4\u30eb\u306eCOPY\u3068`pip install`\u3092\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\n```bash:Dockerfile\nFROM python:2.7\n\nRUN mkdir -p /usr/src/app\nWORKDIR /usr/src/app\n\nONBUILD COPY requirements.txt /usr/src/app/\nONBUILD RUN pip install --no-cache-dir -r requirements.txt\n\nONBUILD COPY . /usr/src/app\n```\n\n### docker-compose.yml\n\nIDCF\u30af\u30e9\u30a6\u30c9\u30b3\u30f3\u30bd\u30fc\u30eb\u306e[API Key](https://console.idcfcloud.com/user/apikey)\u304b\u3089\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n* IDCF_COMPUTE_HOST: \u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\n* IDCF_COMPUTE_API_KEY: API Key\n* IDCF_COMPUTE_SECRET_KEY: Secret Key\n\n```yaml:docker-compose.yml\nidcfcli:\n  build: .\n  volumes:\n    - /etc/localtime:/etc/localtime:ro\n  environment:\n    - IDCF_COMPUTE_HOST=\n    - IDCF_COMPUTE_API_KEY=\n    - IDCF_COMPUTE_SECRET_KEY=\n  command: [\"/usr/local/bin/cloudstack-api\",\"listVirtualMachines\",\"-t=id,name,state\"]\n```\n\n## \u4f7f\u3044\u65b9\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089`git clone`\u3057\u307e\u3059\u3002docker-compose.yml.default\u3092docker-compose.yml\u306b\u30ea\u30cd\u30fc\u30e0\u3057\u3066\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```bash\n$ git clone https://github.com/masato/docker-idcfcli.git idcfcli\n$ cd idcfcli\n$ mv docker-compose.yml.default docker-compose.yml\n$ vi docker-compose.yml\n```\n\nDocker Compose\u304b\u3089\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30b3\u30de\u30f3\u30c9\u306f[listVirtualMachines](http://docs.idcf.jp/cloud/api/virtual-machine/#listvirtualmachines)\u3092\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u3002\n\n```bash\n$ docker-compose build\n$ docker-compose run --rm idcfcli\n+--------------------------------------+------+---------+\n|                  id                  | name |  state  |\n+--------------------------------------+------+---------+\n| xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx | seed | Running |\n+--------------------------------------+------+---------+\n```\n\n\u4efb\u610f\u306e\u30b3\u30de\u30f3\u30c9\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```bash\n$ docker-compose run --rm idcfcli cloudstack-api listVirtualMachines -t=id,name,state\n+--------------------------------------+------+---------+\n|                  id                  | name |  state  |\n+--------------------------------------+------+---------+\n| xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx | seed | Running |\n+--------------------------------------+------+---------+\n```\n\n### \u30a8\u30a4\u30ea\u30a2\u30b9\u306e\u4f5c\u6210\n\n` ~/.bashrc`\u306a\u3069\u306b\u30a8\u30a4\u30ea\u30a2\u30b9\u3092\u5b9a\u7fa9\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```bash:~/.bashrc\nalias idcf-cli='docker-compose run --rm idcfcli cloudstack-api'\n```\n\n\u30a8\u30a4\u30ea\u30a2\u30b9\u3092\u4f7f\u3046\u3068\u3088\u308aCLI\u3089\u3057\u304f\u306a\u308a\u307e\u3059\u3002\n\n```bash\n$ idcf-cli listVirtualMachines -t=id,name,state\n+--------------------------------------+------+---------+\n|                  id                  | name |  state  |\n+--------------------------------------+------+---------+\n| xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx | seed | Running |\n+--------------------------------------+------+---------+\n```\n\n"}