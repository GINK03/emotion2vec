{"context": "NEC\u306eAterm\u306f\u4e0d\u660e\u306a\u30d6\u30fc\u30c8\u304c\u5165\u3063\u3066\u3044\u308b\u306e\u3067FreeBSD 10.3\u3067U-Boot\u3092\u30d3\u30eb\u30c9\u3057\u3066\u713c\u304d\u76f4\u3057\u3066\u307f\u305f\u3002\n\u30cf\u30fc\u30c9\u30aa\u30d5\u3067108\u5186\u3067\u8cfc\u5165\u3057\u305f\u3001Atheros AR7240(AP91)\u304c\u5bfe\u8c61\u3067\u3059\u3002\n\u5f53\u521d\u306fRedboot\u3092\u8a66\u305d\u3046\u3068\u601d\u3063\u3066\u3044\u305f\u304c\u3001\u3061\u3083\u3093\u3068\u30d3\u30eb\u30c9\u3067\u304d\u308b\u30bd\u30fc\u30b9\u304c\u306a\u304f\u3066\u3001U-Boot\u3092\u8a66\u3059\u4e8b\u306b\u3057\u307e\u3057\u305f\u3002\nAR7240\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30afIF\u00d72\u3068EtherSwitch\u304c\u30c1\u30c3\u30d7\u306b\u5185\u8535\u306b\u306a\u3063\u3066\u3044\u3066\u3001\u500b\u5225\u306e\u30b3\u30fc\u30c9\u304c\u5fc5\u8981\u7121\u3044\u306e\u3067\u30d3\u30eb\u30c9\u306f\u6bd4\u8f03\u7684\u7c21\u5358\u306a\u307b\u3046\u3067\u306f\u306a\u3044\u304b\u3068\u601d\u308f\u308c\u307e\u3059\u3002EtherSwich\u304c\u5916\u4ed8\u3051\u3055\u308c\u3066\u305f\u308a\u3059\u308b\u3068\u3001\u305d\u308c\u306e\u5236\u5fa1\u7528\u306e\u30b3\u30fc\u30c9\u304c\u5fc5\u8981\u306b\u306a\u308a\u3061\u3068\u5384\u4ecb\u3067\u3059\u3002\n\u3053\u306eSOC\u306fSPI\u306a\u30d5\u30e9\u30c3\u30b7\u30e5\u306a\u306e\u3067\u3044\u3063\u305f\u3093\u30d5\u30e9\u30c3\u30b7\u30e5\u3092\u5916\u3057\u3066\u3001SOP\u5909\u63db\u57fa\u677f\u306b\u8cbc\u4ed8\u3051\u30b8\u30e3\u30f3\u30d1\u30fc\u3092\u306f\u308a\u307e\u3057\u305f\u3002VCC,GND\u306fflashrom\u3067\u713c\u304f\u6642\u306fFT\u306b\u63a5\u7d9a\u3057\u3066\u3001\u8d77\u52d5\u3059\u308b\u6642\u306f\u672c\u4f53\u5074\u306b\u63a5\u7d9a\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\nCPU\u3092\u6b62\u3081\u308b\u4e8b\u304c\u3067\u304d\u308c\u3070\u57fa\u677f\u306b\u5b9f\u88c5\u3057\u305f\u307e\u307e\u713c\u304f\u4e8b\u304c\u3067\u304d\u308b\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002CFI\u306a\u30d5\u30e9\u30c3\u30b7\u30e5\u3092JTAG\u3067\u713c\u304f\u6642\u306f300K\u30672\u6642\u9593\u304f\u3089\u3044\u304b\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001SPI\u306a\u30d5\u30e9\u30c3\u30b7\u30e5\u306f2M\u30925\u5206\u304f\u3089\u3044\u3067\u713c\u3051\u308b\u306e\u3067\u3001\u8a66\u3057\u3084\u3059\u3044\u3067\u3059\u3002\nMac\u3067flashrom\u306fFT232H\u3067\u30b7\u30ea\u30a2\u30eb\u30b3\u30f3\u30bd\u30fc\u30eb\u306fFT231X\u3067\u63a5\u7d9a\u3057\u3066\u3044\u305f\u304c\u3001FT232H\u3060\u3051\u3067\u3082\u826f\u3044\u3002\u5bfe\u8c61\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30b7\u30ea\u30a2\u30eb\u30b3\u30cd\u30af\u30bf\u306f1m\u30d4\u30c3\u30c15\u672c\u3068\u3044\u3046\u5909\u5247\u7684\u3067\u79cb\u6708\u306e\uff29\uff23\u30af\u30ea\u30c3\u30d7\uff08\u30b0\u30e9\u30d0\u30fc\u30af\u30ea\u30c3\u30d7\uff09\u3067\u3069\u3046\u306b\u304b\u63a5\u7d9a\u3067\u304d\u305f\u3002\nar7240\u306a\u30d5\u30a1\u30a4\u30eb\u306f\u672c\u5bb6\u306b\u306f\u542b\u307e\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3059\u304c\u3001U-Boot\u306fGPL\u306a\u306e\u3067\u3001\u3044\u308d\u3044\u308d\u3068\u3053\u308d\u306b\u30bd\u30fc\u30b9\u304c\u3053\u308d\u304c\u3063\u3066\u3044\u307e\u3059\u3002\nAP91\u306a\u3069\u306e\u30bd\u30fc\u30b9\u306fAtheros\u304c\u4f5c\u6210\u3057\u305f\u3082\u306e\u3068\u601d\u308f\u308c\u308b\u304cAtheros\u306f\u672c\u5bb6\u306b\u306f\u63d0\u4f9b\u3057\u306a\u3044\u4e3b\u7fa9\u306a\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\u624b\u5143\u306b\u3042\u308b\u540c\u3058SOC\u3092\u4f7f\u3063\u305f\u67d0\u793e\u306e\u30a2\u30fc\u30ab\u30a4\u30d6\u3092\u5229\u7528\u3055\u305b\u3066\u3082\u3089\u3063\u305f\u3002\ntoolchain\u306fRedBoot\u306e\u6642\u3068\u540c\u3058\u3088\u3046\u306blinux x86\u306a\u30d0\u30a4\u30ca\u30ea\u3092FreeBSD\u306elinux\u30a8\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3067\u5229\u7528\u3057\u3066\u30d3\u30eb\u30c9\u3059\u308b\u3053\u3068\u306b\u3059\u308b\u3002\n% sudo kldload linux\n\n\u30d3\u30eb\u30c9\u306f\u4ee5\u4e0b\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u901a\u308a\u307e\u3057\u305f\u3002\n#!/bin/sh\n\nexport PATH=\"/storage/home/hiroki/tools/linux-toolchain/mips-linux-gcc344/bin:${PATH}\"\n\nCROSS=mips-linux-\n\ngmake distclean\ngmake HOSTCC=cc CROSS_COMPILE=${CROSS} ap91_config\ngmake HOSTCC=cc CROSS_COMPILE=${CROSS} u-boot.bin\n\ninclude/configs/ap91.h\u3068board/ar7240/ap91/\u306e\u4e0b\u304c\u3053\u306e\u30bf\u30fc\u30b2\u30c3\u30c8\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u306a\u308a\u307e\u3059\u3002\n\u6700\u521d\u306fRedBoot\u306e\u30d3\u30eb\u30c9\u306b\u4f7f\u3063\u305fgcc 3.2.1\u3092\u4f7f\u3063\u305f\u3068\u3053\u308d-march=mips32r2\u306a\u3093\u3066\u30aa\u30d7\u30b7\u30e7\u30f3\u77e5\u3089\u3093\u3068\u8a00\u308f\u308c\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\nMIPS\u516c\u5f0f\u306etoolchain(mips-mti-linux-gnu/2015.\n06-05)\u3092\u4f7f\u3063\u305f\u3089\u30ea\u30f3\u30ab\u30fc\u304c\u30a8\u30e9\u30fc\u3092\u5410\u3044\u3066\u3044\u307e\u3057\u305f\u3002\ncpu/mips/start.o: In function `reset':\n(.text+0x4b4): undefined reference to `_GLOBAL_OFFSET_TABLE_'\nMakefile:178: recipe for target 'u-boot' failed\ngmake: *** [u-boot] Error 1\n\n\u3042\u307e\u308a\u6df1\u8ffd\u3044\u306f\u305b\u305a\u306b\u3001gcc3\u7cfb\u306eel(\u30ea\u30c8\u30eb\u30a8\u30f3\u30c7\u30a3\u30a2\u30f3)\u306atoolchain\u3092-EB\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u901a\u3057\u307e\u3057\u305f\u3002\n\u8d77\u52d5\u306f\u3067\u304d\u3066\u3001setenv,saveenv\u3057\u3066Flash\u306e\u30a2\u30af\u30bb\u30b9\u306fOK\u3060\u3063\u305f\u306e\u3067\u3059\u304c\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304cTime Out\u3067\u4f7f\u3048\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u30cd\u30c3\u30c8\u691c\u7d22\u3057\u305f\u3089el\u306atoolchain\u306e\u554f\u984c\u306e\u3088\u3046\u3067\u3057\u305f\u3002\n\u624b\u5143\u306b\u3042\u3063\u305fgcc4\u7cfb\u306eeb(\u30d3\u30c3\u30b0\u30a8\u30f3\u30c7\u30a3\u30a2\u30f3)\u306atoolchain\u3092\u4f7f\u3063\u305f\u3068\u3053\u308d\u3001\u30a8\u30e9\u30fc\u3067\u8d77\u52d5\u3067\u304d\u306a\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n### ERROR ### Please RESET the board ###\n\n\u305f\u307e\u305f\u307e\u624b\u5143\u306b\u3042\u3063\u305f\u3001gcc3.4.4\u306eeb\u306atoolchain\u3092\u4f7f\u3063\u305f\u3089\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3082\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\nU-Boot 1.1.4 (Jun 27 2016 - 00:51:30)\n\nAP91 (ar7240) U-boot\nDRAM:  \nsri\n#### TAP VALUE 1 = 8, 2 = 9\n32 MB\nTop of RAM usable for U-Boot at: 82000000\nReserving 256k for U-Boot at: 81fbc000\nReserving 192k for malloc() at: 81f8c000\nReserving 44 Bytes for Board Info at: 81f8bfd4\nReserving 36 Bytes for Global Data at: 81f8bfb0\nReserving 128k for boot params() at: 81f6bfb0\nStack Pointer at: 81f6bf98\nNow running in RAM - U-Boot at: 81fbc000\nid read 0x100000ff\nflash size 2097152, sector count = 32\nFlash:  2 MB\nBOARD IS NOT CALIBRATED!!!\nIn:    serial\nOut:   serial\nErr:   serial\nNet:   ag7240_enet_initialize...\nNo valid address in Flash. Using fixed address\n: cfg1 0xf cfg2 0x7014\neth0: 00:03:7f:09:0b:ad\neth0 up\nNo valid address in Flash. Using fixed address\n: cfg1 0xf cfg2 0x7214\neth1: 00:03:7f:09:0b:ad\nATHRS26: resetting s26\nATHRS26: s26 reset done\neth1 up\neth0, eth1\nHit any key to stop autoboot:  0 \n## Booting image at 9f300000 ...\nBad Magic Number\nar7240> ping 10.10.10.100\nTrying eth0\ndup 1 speed 100\nUsing eth0 device\nhost 10.10.10.100 is alive\nar7240> \n\nWAN\u5074\u306eeth0\u3082LAN\u5074\u306eeth1\u3082\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002eth1\u306e\u65b9\u306b\u306f\u30b9\u30a4\u30c3\u30c1\u7d4c\u7531\u306b\u306a\u308a\u307e\u3059\u3002\ngcc 3.4\u306etoolchain\u306fftp.mips.com\u306brpm\u304c\u7f6e\u3044\u3066\u3042\u3063\u305f\u3088\u3046\u306a\u306e\u3067\u3059\u304c\u3001\u3053\u306e\u30b5\u30fc\u30d0\u304c\u7121\u304f\u306a\u3063\u3066rpm\u306e\u5165\u624b\u304c\u3067\u304d\u305a\u3042\u304d\u3089\u3081\u304b\u3051\u305f\u306e\u3067\u3059\u304c\u3001\u305f\u307e\u305f\u307e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u3042\u3063\u305f\u30a2\u30fc\u30ab\u30a4\u30d6\u306b\u5165\u3063\u3066\u3044\u307e\u3057\u305f\u3002\nu-boot\u306e\u30b5\u30a4\u30ba\u306b\u3088\u308a\u30a8\u30f3\u30c8\u30ea\u30fc\u30dd\u30a4\u30f3\u30c8\u3068\u74b0\u5883\u5909\u6570\u3067\u8a2d\u5b9a\u3055\u308c\u305f\u5024\u304c\u9055\u3063\u3066\u3057\u307e\u3046\u4e8b\u304c\u3042\u308b\u306e\u3067\u3001\u305d\u306e\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30a8\u30f3\u30c8\u30ea\u30fc\u30dd\u30a4\u30f3\u30c8\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nar7240> setenv bootcmd \"bootm 0x9F050000\"\nar7240> saveenv\n\nu-boot\u306esetenv\u306f\"\u3067\u304f\u304f\u308b\u3068\u3001\u74b0\u5883\u5909\u6570\u304c\u542b\u307e\u308c\u308b\u5834\u5408\u5c55\u958b\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u304c\u3001'\u3067\u304f\u304f\u308b\u3068\u74b0\u5883\u5909\u6570\u306e\u307e\u307e\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002\n\u3082\u3068\u3082\u30684M\u306e\u30d5\u30e9\u30c3\u30b7\u30e5\u304c\u5b9f\u88c5\u3055\u308c\u3066\u3044\u305f\u306e\u3067\u3059\u304c8M\u306e\u30d5\u30e9\u30c3\u30b7\u30e5\u306b\u63db\u3048\u3066FreeBSD\u713c\u3044\u3066\u307f\u307e\u3057\u305f\u3002\nhttps://gist.github.com/yamori813/8811498b26b180512c4d8d750d4119e6\n\u3082\u3068\u3082\u3068\u5165\u3063\u3066\u3044\u305fboot\u306fNEC\u30aa\u30ea\u30b8\u30ca\u30eb\u306a\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u8d77\u52d5\u6642\u306b\u30ad\u30fc\u3092\u3044\u308d\u3044\u308d\u5165\u529b\u3057\u305f\u3089\u4e00\u56de\u30d7\u30ed\u30f3\u30d7\u30c8\u304c\u3067\u305f\u306e\u3067\u3059\u304c\u3001\u518d\u73fe\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\nIPL:HARD-RESET\nmemory test ... ok\nflinstall OK\n\nboot version: 1.0.1\n\nPKG \"FERRY\"\nCPU \"Atheros/AR7240\"\nRevision c.2 CLOCK 340.0 MHz\nBoot:InitFilesystem\nphy0.4: \"Atheros/AR7240(phy)\"\nphy0.0: \"Atheros/AR7240(SW)\"\nactive ch:1\npost start\nDRAM Test ..... PASS\nTimer test .... PASS\nFLASH CHKSUM .. PASS\nLAN Test ..... \nLoopBack count 0 .. \nphy0.4: \"Atheros/AR7240(phy)\"\nphy0.0: \"Atheros/AR7240(SW)\"\nactive ch:0\nactive ch:1\nphy0.4: \"Atheros/AR7240(phy)\"\nphy0.0: \"Atheros/AR7240(SW)\"\nactive ch:1\nPASS\nWAN Test ..... \nLoopBack count 0 .. \nphy0.4: \"Atheros/AR7240(phy)\"\nphy0.0: \"Atheros/AR7240(SW)\"\nactive ch:0\nactive ch:1\nphy0.4: \"Atheros/AR7240(phy)\"\nphy0.0: \"Atheros/AR7240(SW)\"\nactive ch:1\nPASS\nPackage TYPE = 0x06\npost success\nnow booting Firmware ...\nloaded Firmware\n\nwelcome to boot console\nboot>\n\nU-boot\u306f\u5909\u6570\u306b\u30b3\u30de\u30f3\u30c9\u5217\u3092\u4fdd\u5b58\u3057\u3066\u5b9f\u884c\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\nsetenv hoge='tftpboot $(memtmp_addr) kernel;bootm'\nsaveenv\nrun hoge\n\nsaveenv\u3084run\u304c\u7121\u3044\u30d3\u30eb\u30c9\u306e\u5834\u5408\u306f\u4f7f\u3048\u307e\u305b\u3093\u3002\n\u4f59\u8ac7\u3060\u304c\u3053\u306e\u30bf\u30fc\u30b2\u30fc\u30c3\u30c8\u306fUSB\u306e\u30d1\u30bf\u30fc\u30f3\u304c\u3042\u308a\u3001FreeBSD\u306e\u30c9\u30e9\u30a4\u30d0\u3082\u3042\u308b\u306e\u3067\u3001\u6642\u9593\u304c\u3067\u304d\u305f\u3089\u8a66\u3057\u3066\u307f\u305f\u3044\u3002\n\n\u540c\u3058\u30bf\u30fc\u30b2\u30c3\u30c8\u304c\u624b\u306b\u5165\u3063\u305f\u306e\u3067\u30018M\u306eFlash\u306b\u540c\u3058U-Boot\u3092\u713c\u3044\u3066\u3064\u3051\u3066\u307f\u305f\u3068\u3053\u308d\u3001\u8d77\u52d5\u3057\u3066\u3059\u3050\u306b\u7248\u30a2\u30c3\u30d7\u3057\u3066\u3057\u307e\u3046\u4e8b\u304c\u3042\u3063\u305f\u3002\u30cf\u30f3\u30b0\u30a2\u30c3\u30d7\u3059\u308b\u3068\u304d\u306f\nU-Boot 1.1.4 (Jun 27 2016 - 09:39:48)\n\nAP91 (ar7240) U-boot\nDRAM:  \nsri\n#### TAP VALUE 1 = 8, 2 = 8\n32 MB\nTop of RAM usable for U-Boot at: 82000000\nReserving 256k for U-Boot at: 81fbc000\nReserving 192k for malloc() at: 81f8c000\nReserving 44 Bytes for Board Info at: 81f8bfd4\nReserving 36 Bytes for Global Data at: 81f8bfb0\nReserving 128k for boot params() at: 81f6bfb0\nStack Pointer at: 81f6bf98\n\n\u3068\u8868\u793a\u3055\u308c\u3066\u56fa\u307e\u308b\u3002\u305f\u307e\u306b\u3046\u307e\u304f\u52d5\u304f\u3068\u304d\u306f\n#### TAP VALUE 1 = c, 2 = c\n\n\u3068\u8868\u793a\u3055\u308c\u3066\u3044\u305f\u3002DDR\u30e1\u30e2\u30ea\u306e\u521d\u671f\u5316\u304c\u3046\u307e\u304f\u3067\u304d\u3066\u3044\u306a\u3044\u3063\u307d\u3044\u304c\u3001\u30cf\u30fc\u30c9\u304c\u58ca\u308c\u3066\u3044\u308b\u306e\u304b\u3001U-Boot\u306b\u554f\u984c\u304c\u3042\u308b\u306e\u304b\u306f\u4e0d\u660e\u3002\nNEC\u306eAterm\u306f\u4e0d\u660e\u306a\u30d6\u30fc\u30c8\u304c\u5165\u3063\u3066\u3044\u308b\u306e\u3067FreeBSD 10.3\u3067U-Boot\u3092\u30d3\u30eb\u30c9\u3057\u3066\u713c\u304d\u76f4\u3057\u3066\u307f\u305f\u3002\n\n\u30cf\u30fc\u30c9\u30aa\u30d5\u3067108\u5186\u3067\u8cfc\u5165\u3057\u305f\u3001Atheros AR7240(AP91)\u304c\u5bfe\u8c61\u3067\u3059\u3002\n\n\u5f53\u521d\u306f[Redboot](http://qiita.com/yamori813/items/85b35ddb7ec1569d9377)\u3092\u8a66\u305d\u3046\u3068\u601d\u3063\u3066\u3044\u305f\u304c\u3001\u3061\u3083\u3093\u3068\u30d3\u30eb\u30c9\u3067\u304d\u308b\u30bd\u30fc\u30b9\u304c\u306a\u304f\u3066\u3001U-Boot\u3092\u8a66\u3059\u4e8b\u306b\u3057\u307e\u3057\u305f\u3002\n\nAR7240\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30afIF\u00d72\u3068EtherSwitch\u304c\u30c1\u30c3\u30d7\u306b\u5185\u8535\u306b\u306a\u3063\u3066\u3044\u3066\u3001\u500b\u5225\u306e\u30b3\u30fc\u30c9\u304c\u5fc5\u8981\u7121\u3044\u306e\u3067\u30d3\u30eb\u30c9\u306f\u6bd4\u8f03\u7684\u7c21\u5358\u306a\u307b\u3046\u3067\u306f\u306a\u3044\u304b\u3068\u601d\u308f\u308c\u307e\u3059\u3002EtherSwich\u304c\u5916\u4ed8\u3051\u3055\u308c\u3066\u305f\u308a\u3059\u308b\u3068\u3001\u305d\u308c\u306e\u5236\u5fa1\u7528\u306e\u30b3\u30fc\u30c9\u304c\u5fc5\u8981\u306b\u306a\u308a\u3061\u3068\u5384\u4ecb\u3067\u3059\u3002\n\n\u3053\u306eSOC\u306fSPI\u306a\u30d5\u30e9\u30c3\u30b7\u30e5\u306a\u306e\u3067\u3044\u3063\u305f\u3093\u30d5\u30e9\u30c3\u30b7\u30e5\u3092\u5916\u3057\u3066\u3001SOP\u5909\u63db\u57fa\u677f\u306b\u8cbc\u4ed8\u3051\u30b8\u30e3\u30f3\u30d1\u30fc\u3092\u306f\u308a\u307e\u3057\u305f\u3002VCC,GND\u306f[flashrom](http://qiita.com/yamori813/items/28c3fe71840c3277e409)\u3067\u713c\u304f\u6642\u306fFT\u306b\u63a5\u7d9a\u3057\u3066\u3001\u8d77\u52d5\u3059\u308b\u6642\u306f\u672c\u4f53\u5074\u306b\u63a5\u7d9a\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\nCPU\u3092\u6b62\u3081\u308b\u4e8b\u304c\u3067\u304d\u308c\u3070\u57fa\u677f\u306b\u5b9f\u88c5\u3057\u305f\u307e\u307e\u713c\u304f\u4e8b\u304c\u3067\u304d\u308b\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002CFI\u306a\u30d5\u30e9\u30c3\u30b7\u30e5\u3092JTAG\u3067\u713c\u304f\u6642\u306f300K\u30672\u6642\u9593\u304f\u3089\u3044\u304b\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001SPI\u306a\u30d5\u30e9\u30c3\u30b7\u30e5\u306f2M\u30925\u5206\u304f\u3089\u3044\u3067\u713c\u3051\u308b\u306e\u3067\u3001\u8a66\u3057\u3084\u3059\u3044\u3067\u3059\u3002\n\nMac\u3067flashrom\u306fFT232H\u3067\u30b7\u30ea\u30a2\u30eb\u30b3\u30f3\u30bd\u30fc\u30eb\u306fFT231X\u3067\u63a5\u7d9a\u3057\u3066\u3044\u305f\u304c\u3001FT232H\u3060\u3051\u3067\u3082\u826f\u3044\u3002\u5bfe\u8c61\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30b7\u30ea\u30a2\u30eb\u30b3\u30cd\u30af\u30bf\u306f1m\u30d4\u30c3\u30c15\u672c\u3068\u3044\u3046\u5909\u5247\u7684\u3067\u79cb\u6708\u306e[\uff29\uff23\u30af\u30ea\u30c3\u30d7\uff08\u30b0\u30e9\u30d0\u30fc\u30af\u30ea\u30c3\u30d7\uff09](http://akizukidenshi.com/catalog/g/gP-03436/)\u3067\u3069\u3046\u306b\u304b\u63a5\u7d9a\u3067\u304d\u305f\u3002\n\nar7240\u306a\u30d5\u30a1\u30a4\u30eb\u306f[\u672c\u5bb6](http://www.denx.de/wiki/U-Boot/WebHome)\u306b\u306f\u542b\u307e\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3059\u304c\u3001U-Boot\u306fGPL\u306a\u306e\u3067\u3001\u3044\u308d\u3044\u308d\u3068\u3053\u308d\u306b\u30bd\u30fc\u30b9\u304c\u3053\u308d\u304c\u3063\u3066\u3044\u307e\u3059\u3002\n\nAP91\u306a\u3069\u306e\u30bd\u30fc\u30b9\u306fAtheros\u304c\u4f5c\u6210\u3057\u305f\u3082\u306e\u3068\u601d\u308f\u308c\u308b\u304cAtheros\u306f\u672c\u5bb6\u306b\u306f\u63d0\u4f9b\u3057\u306a\u3044\u4e3b\u7fa9\u306a\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\u624b\u5143\u306b\u3042\u308b\u540c\u3058SOC\u3092\u4f7f\u3063\u305f\u67d0\u793e\u306e\u30a2\u30fc\u30ab\u30a4\u30d6\u3092\u5229\u7528\u3055\u305b\u3066\u3082\u3089\u3063\u305f\u3002\n\ntoolchain\u306f[RedBoot](http://qiita.com/yamori813/items/85b35ddb7ec1569d9377)\u306e\u6642\u3068\u540c\u3058\u3088\u3046\u306blinux x86\u306a\u30d0\u30a4\u30ca\u30ea\u3092FreeBSD\u306elinux\u30a8\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3067\u5229\u7528\u3057\u3066\u30d3\u30eb\u30c9\u3059\u308b\u3053\u3068\u306b\u3059\u308b\u3002\n\n```\n% sudo kldload linux\n```\n\n\u30d3\u30eb\u30c9\u306f\u4ee5\u4e0b\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u901a\u308a\u307e\u3057\u305f\u3002\n\n```\n#!/bin/sh\n\nexport PATH=\"/storage/home/hiroki/tools/linux-toolchain/mips-linux-gcc344/bin:${PATH}\"\n\nCROSS=mips-linux-\n\ngmake distclean\ngmake HOSTCC=cc CROSS_COMPILE=${CROSS} ap91_config\ngmake HOSTCC=cc CROSS_COMPILE=${CROSS} u-boot.bin\n```\n\ninclude/configs/ap91.h\u3068board/ar7240/ap91/\u306e\u4e0b\u304c\u3053\u306e\u30bf\u30fc\u30b2\u30c3\u30c8\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u6700\u521d\u306fRedBoot\u306e\u30d3\u30eb\u30c9\u306b\u4f7f\u3063\u305fgcc 3.2.1\u3092\u4f7f\u3063\u305f\u3068\u3053\u308d-march=mips32r2\u306a\u3093\u3066\u30aa\u30d7\u30b7\u30e7\u30f3\u77e5\u3089\u3093\u3068\u8a00\u308f\u308c\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\nMIPS\u516c\u5f0f\u306etoolchain(mips-mti-linux-gnu/2015.\n06-05)\u3092\u4f7f\u3063\u305f\u3089\u30ea\u30f3\u30ab\u30fc\u304c\u30a8\u30e9\u30fc\u3092\u5410\u3044\u3066\u3044\u307e\u3057\u305f\u3002\n\n```\ncpu/mips/start.o: In function `reset':\n(.text+0x4b4): undefined reference to `_GLOBAL_OFFSET_TABLE_'\nMakefile:178: recipe for target 'u-boot' failed\ngmake: *** [u-boot] Error 1\n```\n\n\u3042\u307e\u308a\u6df1\u8ffd\u3044\u306f\u305b\u305a\u306b\u3001gcc3\u7cfb\u306eel(\u30ea\u30c8\u30eb\u30a8\u30f3\u30c7\u30a3\u30a2\u30f3)\u306atoolchain\u3092-EB\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u901a\u3057\u307e\u3057\u305f\u3002\n\n\u8d77\u52d5\u306f\u3067\u304d\u3066\u3001setenv,saveenv\u3057\u3066Flash\u306e\u30a2\u30af\u30bb\u30b9\u306fOK\u3060\u3063\u305f\u306e\u3067\u3059\u304c\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304cTime Out\u3067\u4f7f\u3048\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u30cd\u30c3\u30c8\u691c\u7d22\u3057\u305f\u3089el\u306atoolchain\u306e\u554f\u984c\u306e\u3088\u3046\u3067\u3057\u305f\u3002\n\n\u624b\u5143\u306b\u3042\u3063\u305fgcc4\u7cfb\u306eeb(\u30d3\u30c3\u30b0\u30a8\u30f3\u30c7\u30a3\u30a2\u30f3)\u306atoolchain\u3092\u4f7f\u3063\u305f\u3068\u3053\u308d\u3001\u30a8\u30e9\u30fc\u3067\u8d77\u52d5\u3067\u304d\u306a\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n\n```\n### ERROR ### Please RESET the board ###\n```\n\n\u305f\u307e\u305f\u307e\u624b\u5143\u306b\u3042\u3063\u305f\u3001gcc3.4.4\u306eeb\u306atoolchain\u3092\u4f7f\u3063\u305f\u3089\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3082\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n```\nU-Boot 1.1.4 (Jun 27 2016 - 00:51:30)\n\nAP91 (ar7240) U-boot\nDRAM:  \nsri\n#### TAP VALUE 1 = 8, 2 = 9\n32 MB\nTop of RAM usable for U-Boot at: 82000000\nReserving 256k for U-Boot at: 81fbc000\nReserving 192k for malloc() at: 81f8c000\nReserving 44 Bytes for Board Info at: 81f8bfd4\nReserving 36 Bytes for Global Data at: 81f8bfb0\nReserving 128k for boot params() at: 81f6bfb0\nStack Pointer at: 81f6bf98\nNow running in RAM - U-Boot at: 81fbc000\nid read 0x100000ff\nflash size 2097152, sector count = 32\nFlash:  2 MB\nBOARD IS NOT CALIBRATED!!!\nIn:    serial\nOut:   serial\nErr:   serial\nNet:   ag7240_enet_initialize...\nNo valid address in Flash. Using fixed address\n: cfg1 0xf cfg2 0x7014\neth0: 00:03:7f:09:0b:ad\neth0 up\nNo valid address in Flash. Using fixed address\n: cfg1 0xf cfg2 0x7214\neth1: 00:03:7f:09:0b:ad\nATHRS26: resetting s26\nATHRS26: s26 reset done\neth1 up\neth0, eth1\nHit any key to stop autoboot:  0 \n## Booting image at 9f300000 ...\nBad Magic Number\nar7240> ping 10.10.10.100\nTrying eth0\ndup 1 speed 100\nUsing eth0 device\nhost 10.10.10.100 is alive\nar7240> \n```\n\nWAN\u5074\u306eeth0\u3082LAN\u5074\u306eeth1\u3082\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002eth1\u306e\u65b9\u306b\u306f\u30b9\u30a4\u30c3\u30c1\u7d4c\u7531\u306b\u306a\u308a\u307e\u3059\u3002\n\ngcc 3.4\u306etoolchain\u306fftp.mips.com\u306brpm\u304c\u7f6e\u3044\u3066\u3042\u3063\u305f\u3088\u3046\u306a\u306e\u3067\u3059\u304c\u3001\u3053\u306e\u30b5\u30fc\u30d0\u304c\u7121\u304f\u306a\u3063\u3066rpm\u306e\u5165\u624b\u304c\u3067\u304d\u305a\u3042\u304d\u3089\u3081\u304b\u3051\u305f\u306e\u3067\u3059\u304c\u3001\u305f\u307e\u305f\u307e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u3042\u3063\u305f\u30a2\u30fc\u30ab\u30a4\u30d6\u306b\u5165\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\nu-boot\u306e\u30b5\u30a4\u30ba\u306b\u3088\u308a\u30a8\u30f3\u30c8\u30ea\u30fc\u30dd\u30a4\u30f3\u30c8\u3068\u74b0\u5883\u5909\u6570\u3067\u8a2d\u5b9a\u3055\u308c\u305f\u5024\u304c\u9055\u3063\u3066\u3057\u307e\u3046\u4e8b\u304c\u3042\u308b\u306e\u3067\u3001\u305d\u306e\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30a8\u30f3\u30c8\u30ea\u30fc\u30dd\u30a4\u30f3\u30c8\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\nar7240> setenv bootcmd \"bootm 0x9F050000\"\nar7240> saveenv\n```\n\nu-boot\u306esetenv\u306f\"\u3067\u304f\u304f\u308b\u3068\u3001\u74b0\u5883\u5909\u6570\u304c\u542b\u307e\u308c\u308b\u5834\u5408\u5c55\u958b\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u304c\u3001'\u3067\u304f\u304f\u308b\u3068\u74b0\u5883\u5909\u6570\u306e\u307e\u307e\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002\n\n\u3082\u3068\u3082\u30684M\u306e\u30d5\u30e9\u30c3\u30b7\u30e5\u304c\u5b9f\u88c5\u3055\u308c\u3066\u3044\u305f\u306e\u3067\u3059\u304c8M\u306e\u30d5\u30e9\u30c3\u30b7\u30e5\u306b\u63db\u3048\u3066FreeBSD\u713c\u3044\u3066\u307f\u307e\u3057\u305f\u3002\n\nhttps://gist.github.com/yamori813/8811498b26b180512c4d8d750d4119e6\n\n\u3082\u3068\u3082\u3068\u5165\u3063\u3066\u3044\u305fboot\u306fNEC\u30aa\u30ea\u30b8\u30ca\u30eb\u306a\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u8d77\u52d5\u6642\u306b\u30ad\u30fc\u3092\u3044\u308d\u3044\u308d\u5165\u529b\u3057\u305f\u3089\u4e00\u56de\u30d7\u30ed\u30f3\u30d7\u30c8\u304c\u3067\u305f\u306e\u3067\u3059\u304c\u3001\u518d\u73fe\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n```\nIPL:HARD-RESET\nmemory test ... ok\nflinstall OK\n\nboot version: 1.0.1\n\nPKG \"FERRY\"\nCPU \"Atheros/AR7240\"\nRevision c.2 CLOCK 340.0 MHz\nBoot:InitFilesystem\nphy0.4: \"Atheros/AR7240(phy)\"\nphy0.0: \"Atheros/AR7240(SW)\"\nactive ch:1\npost start\nDRAM Test ..... PASS\nTimer test .... PASS\nFLASH CHKSUM .. PASS\nLAN Test ..... \nLoopBack count 0 .. \nphy0.4: \"Atheros/AR7240(phy)\"\nphy0.0: \"Atheros/AR7240(SW)\"\nactive ch:0\nactive ch:1\nphy0.4: \"Atheros/AR7240(phy)\"\nphy0.0: \"Atheros/AR7240(SW)\"\nactive ch:1\nPASS\nWAN Test ..... \nLoopBack count 0 .. \nphy0.4: \"Atheros/AR7240(phy)\"\nphy0.0: \"Atheros/AR7240(SW)\"\nactive ch:0\nactive ch:1\nphy0.4: \"Atheros/AR7240(phy)\"\nphy0.0: \"Atheros/AR7240(SW)\"\nactive ch:1\nPASS\nPackage TYPE = 0x06\npost success\nnow booting Firmware ...\nloaded Firmware\n\nwelcome to boot console\nboot>\n```\n\nU-boot\u306f\u5909\u6570\u306b\u30b3\u30de\u30f3\u30c9\u5217\u3092\u4fdd\u5b58\u3057\u3066\u5b9f\u884c\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\n\n```\nsetenv hoge='tftpboot $(memtmp_addr) kernel;bootm'\nsaveenv\nrun hoge\n```\n\nsaveenv\u3084run\u304c\u7121\u3044\u30d3\u30eb\u30c9\u306e\u5834\u5408\u306f\u4f7f\u3048\u307e\u305b\u3093\u3002\n\n\u4f59\u8ac7\u3060\u304c\u3053\u306e\u30bf\u30fc\u30b2\u30fc\u30c3\u30c8\u306fUSB\u306e\u30d1\u30bf\u30fc\u30f3\u304c\u3042\u308a\u3001FreeBSD\u306e\u30c9\u30e9\u30a4\u30d0\u3082\u3042\u308b\u306e\u3067\u3001\u6642\u9593\u304c\u3067\u304d\u305f\u3089\u8a66\u3057\u3066\u307f\u305f\u3044\u3002\n\n![\u5199\u771f\uff082016-06-29 22.06\uff09.jpg](https://qiita-image-store.s3.amazonaws.com/0/104066/62206911-1a63-611f-6297-3cd8ebb0fa92.jpeg)\n\n\u540c\u3058\u30bf\u30fc\u30b2\u30c3\u30c8\u304c\u624b\u306b\u5165\u3063\u305f\u306e\u3067\u30018M\u306eFlash\u306b\u540c\u3058U-Boot\u3092\u713c\u3044\u3066\u3064\u3051\u3066\u307f\u305f\u3068\u3053\u308d\u3001\u8d77\u52d5\u3057\u3066\u3059\u3050\u306b\u7248\u30a2\u30c3\u30d7\u3057\u3066\u3057\u307e\u3046\u4e8b\u304c\u3042\u3063\u305f\u3002\u30cf\u30f3\u30b0\u30a2\u30c3\u30d7\u3059\u308b\u3068\u304d\u306f\n\n```\nU-Boot 1.1.4 (Jun 27 2016 - 09:39:48)\n\nAP91 (ar7240) U-boot\nDRAM:  \nsri\n#### TAP VALUE 1 = 8, 2 = 8\n32 MB\nTop of RAM usable for U-Boot at: 82000000\nReserving 256k for U-Boot at: 81fbc000\nReserving 192k for malloc() at: 81f8c000\nReserving 44 Bytes for Board Info at: 81f8bfd4\nReserving 36 Bytes for Global Data at: 81f8bfb0\nReserving 128k for boot params() at: 81f6bfb0\nStack Pointer at: 81f6bf98\n```\n\n\u3068\u8868\u793a\u3055\u308c\u3066\u56fa\u307e\u308b\u3002\u305f\u307e\u306b\u3046\u307e\u304f\u52d5\u304f\u3068\u304d\u306f\n\n```\n#### TAP VALUE 1 = c, 2 = c\n```\n\n\u3068\u8868\u793a\u3055\u308c\u3066\u3044\u305f\u3002DDR\u30e1\u30e2\u30ea\u306e\u521d\u671f\u5316\u304c\u3046\u307e\u304f\u3067\u304d\u3066\u3044\u306a\u3044\u3063\u307d\u3044\u304c\u3001\u30cf\u30fc\u30c9\u304c\u58ca\u308c\u3066\u3044\u308b\u306e\u304b\u3001U-Boot\u306b\u554f\u984c\u304c\u3042\u308b\u306e\u304b\u306f\u4e0d\u660e\u3002\n", "tags": ["FreeBSD", "U-boot"]}