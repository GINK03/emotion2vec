{"context": "\n\nnodejs v6.x \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nubuntu 16.04 \u6a19\u6e96\u30ea\u30dd\u30b8\u30c8\u30ea\u3067\u306f nodejs v4\u304c\u914d\u5e03\u3055\u308c\u3066\u3044\u308b\u3002\n\u3057\u304b\u3057\u73fe\u5728\u306eLTS\u306fv6\u306e\u3088\u3046\u306a\u306e\u3067v6\u3092\u9078\u629e\u3057\u305f\u3002\n\nInstalling Node.js via package manager | Node.js\n\ncurl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash -\nsudo apt-get install -y nodejs\n\n$ nodejs -v\nv6.9.5\n\n\nnpm\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\nsudo npm update -g npm\n\n\n\nbotkit\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nmkdir ~/slackbot && cd ~/slackbot\nnpm init -y\nnpm install botkit --save\n\n\n\u4f7f\u3044\u65b9\n\n~/slackbot/run.sh\nexport token=xxxxxxxxx\nnode index.js\n\n\n\nsh run.sh\n\n\nslack\u304b\u3089bot\u3078\u30c0\u30a4\u30ec\u30af\u30c8\u30e1\u30c3\u30bb\u30fc\u30b8\nsh df -h | grep G\nsh ip a s | grep glo\nsh sudo whoami\nexit\n\n\n\nsudo\u306f\u4ee5\u4e0b\u5fc5\u8981\n\n\n/etc/sudoers\nuser1    ALL=(ALL:ALL) NOPASSWD:ALL\n\n\n\n\u4efb\u610f\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\n\n\u547d\u4ee4\u3092\u53d7\u3051\u4ed8\u3051\u308b\u30e6\u30fc\u30b6\u30fc\u3092\u5236\u9650\u3057\u3066\u3044\u308b\u306e\u3067\u3001\n\nvar allow_user = \"\u30e6\u30fc\u30b6\u540d\";\u3092\u4fee\u6b63\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n~/slackbot/index.js\nconst Botkit = require('botkit');\n\nif (!process.env.token) {\n  console.log('Error: Specify token in environment');\n  process.exit(1);\n}\n\nconst controller = Botkit.slackbot({\n    debug: false\n});\n\ncontroller.spawn({\n    token: process.env.token\n}).startRTM(function(err){\n    if (err) {\n        throw new Error(err);\n    }\n});\n\n// \u5b9f\u884c\u53ef\u80fd\u30e6\u30fc\u30b6\u30fc\u306e\u5236\u9650\nfunction is_allow_user(bot,message) {\n    var allow_user = \"\u30e6\u30fc\u30b6\u540d\";\n    bot.api.users.info({user:message.user},function(error,response){\n        if(response.user.name != allow_user){\n            return false;\n        }\n    });\n    return true;\n}\n\n// \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\ncontroller.hears('sh (.*)',['direct_message'],function(bot,message) {\n\n    if(!is_allow_user(bot,message)) {\n        bot.reply(message,'your access denied.');\n        return false;\n    }\n\n    var matches = message.text.match(/^sh (.*)/);\n    var command = matches[1];\n\n    const execSync = require('child_process').execSync;\n    try {\n        const result =  execSync(command).toString();\n        bot.reply(message,result);\n    } catch(error) {\n        bot.reply(message,error.toString());\n    }\n});\n\n// exit \u3067\u7d42\u4e86\ncontroller.hears('exit',['direct_message'],function(bot,message) {\n    process.exit(0);\n});\n\n\n## nodejs v6.x \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nubuntu 16.04 \u6a19\u6e96\u30ea\u30dd\u30b8\u30c8\u30ea\u3067\u306f nodejs v4\u304c\u914d\u5e03\u3055\u308c\u3066\u3044\u308b\u3002\n\u3057\u304b\u3057\u73fe\u5728\u306eLTS\u306fv6\u306e\u3088\u3046\u306a\u306e\u3067v6\u3092\u9078\u629e\u3057\u305f\u3002\n\n* [Installing Node.js via package manager | Node.js](https://nodejs.org/en/download/package-manager/#debian-and-ubuntu-based-linux-distributions)\n\n```\ncurl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash -\nsudo apt-get install -y nodejs\n```\n\n```\n$ nodejs -v\nv6.9.5\n```\n\n```bash:npm\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\nsudo npm update -g npm\n```\n\n## botkit\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\nmkdir ~/slackbot && cd ~/slackbot\nnpm init -y\nnpm install botkit --save\n```\n\n## \u4f7f\u3044\u65b9\n\n```bash:~/slackbot/run.sh\nexport token=xxxxxxxxx\nnode index.js\n```\n\n* `sh run.sh`\n\n```bash:slack\u304b\u3089bot\u3078\u30c0\u30a4\u30ec\u30af\u30c8\u30e1\u30c3\u30bb\u30fc\u30b8\nsh df -h | grep G\nsh ip a s | grep glo\nsh sudo whoami\nexit\n```\n\n* sudo\u306f\u4ee5\u4e0b\u5fc5\u8981\n\n```bash:/etc/sudoers\nuser1    ALL=(ALL:ALL) NOPASSWD:ALL\n```\n\n## \u4efb\u610f\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\n\n* \u547d\u4ee4\u3092\u53d7\u3051\u4ed8\u3051\u308b\u30e6\u30fc\u30b6\u30fc\u3092\u5236\u9650\u3057\u3066\u3044\u308b\u306e\u3067\u3001\n\n`var allow_user = \"\u30e6\u30fc\u30b6\u540d\";`\u3092\u4fee\u6b63\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```javascript:~/slackbot/index.js\nconst Botkit = require('botkit');\n\nif (!process.env.token) {\n  console.log('Error: Specify token in environment');\n  process.exit(1);\n}\n\nconst controller = Botkit.slackbot({\n    debug: false\n});\n\ncontroller.spawn({\n    token: process.env.token\n}).startRTM(function(err){\n    if (err) {\n        throw new Error(err);\n    }\n});\n\n// \u5b9f\u884c\u53ef\u80fd\u30e6\u30fc\u30b6\u30fc\u306e\u5236\u9650\nfunction is_allow_user(bot,message) {\n    var allow_user = \"\u30e6\u30fc\u30b6\u540d\";\n    bot.api.users.info({user:message.user},function(error,response){\n        if(response.user.name != allow_user){\n            return false;\n        }\n    });\n    return true;\n}\n\n// \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\ncontroller.hears('sh (.*)',['direct_message'],function(bot,message) {\n\n    if(!is_allow_user(bot,message)) {\n        bot.reply(message,'your access denied.');\n        return false;\n    }\n\n    var matches = message.text.match(/^sh (.*)/);\n    var command = matches[1];\n\n    const execSync = require('child_process').execSync;\n    try {\n        const result =  execSync(command).toString();\n        bot.reply(message,result);\n    } catch(error) {\n        bot.reply(message,error.toString());\n    }\n});\n\n// exit \u3067\u7d42\u4e86\ncontroller.hears('exit',['direct_message'],function(bot,message) {\n    process.exit(0);\n});\n```\n", "tags": ["Botkit", "Slack"]}