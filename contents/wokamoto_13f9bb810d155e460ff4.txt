{"context": "Nginx \u3067\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u30da\u30fc\u30b8\u306e On/Off \u3092\u30d5\u30a1\u30a4\u30eb\u306e\u6709\u7121\u306b\u3088\u3063\u3066\u5207\u308a\u66ff\u3048\u308b\u65b9\u6cd5\u3068\u3057\u3066\u306f\u3001\u4ee5\u4e0b\u306e URL \u3067\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u306a\u65b9\u6cd5\u306a\u3069\u304c\u3042\u308a\u307e\u3059\u3002\nNginx\u3067\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u30da\u30fc\u30b8\u306b\u7de8\u96c6\u306a\u3057\u3067\u5373\u6642\u5207\u308a\u66ff\u3048\u308b\u65b9\u6cd5\n\u305f\u3060\u3001\u4e0a\u8a18\u306e\u65b9\u6cd5\u3060\u3068 IP \u5236\u9650\u3067\u3057\u304b\u5236\u9650\u3067\u304d\u306a\u3044\u305f\u3081\u78ba\u8a8d\u8005\u306e IP \u30a2\u30c9\u30ec\u30b9\u304c\u5236\u9650\u3067\u304d\u306a\u3044\u5834\u5408\u306b\u3061\u3068\u56f0\u308a\u307e\u3059\u3002\nIP \u5236\u9650\u306e\u6240\u3092 BASIC \u8a8d\u8a3c\u306b\u7f6e\u304d\u63db\u3048\u305f\u304f\u3066\u3001if \u306e\u4e2d\u306b if ($maintenance = true) { auth_basic ... } \u3068\u3044\u3046\u3088\u3046\u306b auth_basic \u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3092\u66f8\u304f\u3068\u3001\u7121\u60c5\u306b\u3082 nginx: [emerg] \"auth_basic\" directive is not allowed here \u3068\u304b\u3063\u3066\u6012\u3089\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\u305d\u3093\u306a\u6642\u306e\u305f\u3081\u306b\u50d5\u3089\u306b\u306f ngx_mruby \u304c\u3042\u308b\u306e\u3067\u3059\u3088\u3002\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b satisfy any \u3068\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3067 /etc/nginx/.htpasswd \u3063\u3066\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u6642\u306f\u3001BASIC \u8a8d\u8a3c\u3092\u6709\u52b9\u306b\u3057\u3001\u30d5\u30a1\u30a4\u30eb\u304c\u7121\u3044\u6642\u306f BASIC \u8a8d\u8a3c\u3092\u7121\u52b9\u306b\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\n    satisfy any;\n    mruby_access_handler_code '\n        if ( !File.exist?(\"/etc/nginx/.htpasswd\") ) then\n            Nginx.return Nginx::OK\n        else\n            Nginx.return Nginx::HTTP_FORBIDDEN\n        end';\n    auth_basic \"basic authentication\";\n    auth_basic_user_file /etc/nginx/.htpasswd;\n\n\u3082\u3061\u308d\u3093 mruby_access_handlert_code \u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306e\u4e2d\u3067 File.exist \u3067\u5b58\u5728\u78ba\u8a8d\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3092 .htpasswd \u3067\u306f\u306a\u304f\u3001/var/tmp/do_maintenace \u3068\u304b\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u3057\u3066\u3082\u3044\u3044\u3067\u3057\u3087\u3046\u3002\n[PR]\nAMIMOTO \u3060\u3068\u3001\u7c21\u5358\u306b ngx_mruby \u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8ffd\u52a0\u3067\u304d\u307e\u3059\u3088\u3002\nAMIMOTO AMI \u306e nginx \u304c\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30e2\u30b8\u30e5\u30fc\u30eb\u7248 ngx_mruby \u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f | \u8d85\u9ad8\u901f WordPress AMI AMIMOTO\nNginx \u3067\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u30da\u30fc\u30b8\u306e On/Off \u3092\u30d5\u30a1\u30a4\u30eb\u306e\u6709\u7121\u306b\u3088\u3063\u3066\u5207\u308a\u66ff\u3048\u308b\u65b9\u6cd5\u3068\u3057\u3066\u306f\u3001\u4ee5\u4e0b\u306e URL \u3067\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u306a\u65b9\u6cd5\u306a\u3069\u304c\u3042\u308a\u307e\u3059\u3002\n[Nginx\u3067\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u30da\u30fc\u30b8\u306b\u7de8\u96c6\u306a\u3057\u3067\u5373\u6642\u5207\u308a\u66ff\u3048\u308b\u65b9\u6cd5](http://qiita.com/kotaroito/items/8b7d4b8ad6935edcdba8)\n\n\u305f\u3060\u3001\u4e0a\u8a18\u306e\u65b9\u6cd5\u3060\u3068 IP \u5236\u9650\u3067\u3057\u304b\u5236\u9650\u3067\u304d\u306a\u3044\u305f\u3081\u78ba\u8a8d\u8005\u306e IP \u30a2\u30c9\u30ec\u30b9\u304c\u5236\u9650\u3067\u304d\u306a\u3044\u5834\u5408\u306b\u3061\u3068\u56f0\u308a\u307e\u3059\u3002\nIP \u5236\u9650\u306e\u6240\u3092 BASIC \u8a8d\u8a3c\u306b\u7f6e\u304d\u63db\u3048\u305f\u304f\u3066\u3001if \u306e\u4e2d\u306b ```if ($maintenance = true) { auth_basic ... }``` \u3068\u3044\u3046\u3088\u3046\u306b ```auth_basic``` \u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3092\u66f8\u304f\u3068\u3001\u7121\u60c5\u306b\u3082 ```nginx: [emerg] \"auth_basic\" directive is not allowed here``` \u3068\u304b\u3063\u3066\u6012\u3089\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n\u305d\u3093\u306a\u6642\u306e\u305f\u3081\u306b\u50d5\u3089\u306b\u306f ngx_mruby \u304c\u3042\u308b\u306e\u3067\u3059\u3088\u3002\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b ```satisfy any``` \u3068\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3067 ```/etc/nginx/.htpasswd``` \u3063\u3066\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u6642\u306f\u3001BASIC \u8a8d\u8a3c\u3092\u6709\u52b9\u306b\u3057\u3001\u30d5\u30a1\u30a4\u30eb\u304c\u7121\u3044\u6642\u306f BASIC \u8a8d\u8a3c\u3092\u7121\u52b9\u306b\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n```text\n    satisfy any;\n    mruby_access_handler_code '\n        if ( !File.exist?(\"/etc/nginx/.htpasswd\") ) then\n            Nginx.return Nginx::OK\n        else\n            Nginx.return Nginx::HTTP_FORBIDDEN\n        end';\n    auth_basic \"basic authentication\";\n    auth_basic_user_file /etc/nginx/.htpasswd;\n```\n\n\u3082\u3061\u308d\u3093 ```mruby_access_handlert_code``` \u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306e\u4e2d\u3067 File.exist \u3067\u5b58\u5728\u78ba\u8a8d\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3092 ```.htpasswd``` \u3067\u306f\u306a\u304f\u3001```/var/tmp/do_maintenace``` \u3068\u304b\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u3057\u3066\u3082\u3044\u3044\u3067\u3057\u3087\u3046\u3002\n\n\n[PR]\nAMIMOTO \u3060\u3068\u3001\u7c21\u5358\u306b ngx_mruby \u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8ffd\u52a0\u3067\u304d\u307e\u3059\u3088\u3002\n[AMIMOTO AMI \u306e nginx \u304c\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30e2\u30b8\u30e5\u30fc\u30eb\u7248 ngx_mruby \u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f | \u8d85\u9ad8\u901f WordPress AMI AMIMOTO](https://ja.amimoto-ami.com/2016/06/08/amimoto-ami-supported-ngx_mruby/)\n", "tags": ["nginx", "ngx_mruby"]}