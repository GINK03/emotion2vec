{"tags": ["groonga", "Rails44.2"], "context": " More than 1 year has passed since last update.Rails \u3067 Groonga \u3092\u3044\u3044\u611f\u3058\u306b\u6271\u3048\u308b ActiveGroonga \u3068\u3044\u3046\u3082\u306e\u304c\u3042\u308b\u3088\u3046\u306a\u306e\u3067\uff0c2014-12-19 \u306b\u51fa\u305f Rails4.2 \u3067\u8a66\u3057\u3066\u307f\u305f\uff0e\n2014-12-23 18:18:58 +0900 \u30b3\u30e1\u30f3\u30c8\u3092\u53d7\u3051\u3066\u5185\u5bb9\u3092\u4fee\u6b63\uff0eActiveGroonga4.2\u3067\u306f\u5168\u3066\u610f\u56f3\u901a\u308a\u306b\u52d5\u4f5c\u3059\u308b\n\n\u53c2\u8003\u306b\u3057\u305f\u30b5\u30a4\u30c8\n\nTry ActiveGroonga!\nActiveGroonga\u3092\u4f7f\u3063\u3066\u307f\u308b (1)\nActiveGroonga\u3092\u4f7f\u3063\u3066\u307f\u308b (2)\n\n\nRails \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u308b\n\u540d\u524d\u306f active_record-playground \u3068\u3057\u305f\uff0e\nActiveRecord \u306f\u4f7f\u308f\u306a\u3044\u306e\u3067 --skip-active-record \u3059\u308b\uff0e\n$ rails new active_groonga_playground --skip-active-record\n\n\nActiveGroonga \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nGemfile \u306b\n# Gemfile\ngem \"activegroonga\", require: \"active_groonga\"\n\n\u3092\u8ffd\u52a0\u3059\u308b\uff0e\n\u6b21\u306b\n$ bin/bundle insall\n\n\u3059\u308b\uff0e\n\nActiveGroonga \u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092 Rails \u8d77\u52d5\u6642\u306b\u8aad\u307f\u8fbc\u3080\n# config/application.rb\n\n# require \"active_record/railtie\"\nrequire \"active_groonga/railtie\"\n\n\nGroonga \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\u3059\u308b\n$ bin/rake groonga:create\n\n\nUser \u30e2\u30c7\u30eb\u3092\u4f5c\u6210\u3059\u308b\n$ bin/rails generate model user name:short_text\n$ bin/rake groonga:migrate\n\n\u6307\u5b9a\u53ef\u80fd\u306a\u30ab\u30e9\u30e0\u540d\u306f Schema::TableDefinition \u306b\u66f8\u3044\u3066\u3042\u308b\u3088\u3046\u3060\uff0e\n\nTweet \u30e2\u30c7\u30eb\u3092\u4f5c\u6210\u3059\u308b\n$ bin/rails generate model tweet content:short_text user:reference\n$ bin/rake groonga:migrate\n\n\n\u691c\u7d22\u7528\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3059\u308b\n$ bin/rails generate migration CreateFullTextSearchIndex\n\n\u751f\u6210\u3055\u308c\u305f migration \u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3059\u308b\n# db/groonga/migrate/20141221113954_create_full_text_search_index.rb\nclass CreateFullTextSearchIndex < ActiveGroonga::Migration\n  def up\n    create_table(\"bigram\",\n                 type: :patricia_trie,\n                 key_type: \"ShortText\",\n                 default_tokenizer: \"TokenBigram\",\n                 key_normalize: true) do |table|\n      table.index(\"tweets.content\")\n    end\n  end\n\n  def down\n    remove_table(\"bigram\")\n  end\nend\n\ncreate_table \u306b\u6e21\u3059\u30aa\u30d7\u30b7\u30e7\u30f3\u306f Schema.create_table \u3092\u53c2\u8003\u306e\u3053\u3068\uff0e\nschema \u3092\u5b9a\u7fa9\u3057\u305f\u3089 migrate \u3059\u308b\uff0e\n$ bin/rake groonga:migrate\n\n\n\u4f7f\u3063\u3066\u307f\u308b\n$ bin/rails console\nLoading development environment (Rails 4.2.0)\nirb(main):001:0> User.create(name: \"\u5317 \u592a\u90ce\")\n=> #<User id: 1, created_at: 2014-12-23 18:08:07 +0900, name: \"\u5317 \u592a\u90ce\", updated_at: 2014-12-23 18:08:07 +0900>\nirb(main):002:0> User.create(name: \"\u5357 \u82b1\u5b50\")\n=> #<User id: 2, created_at: 2014-12-23 18:08:22 +0900, name: \"\u5357 \u82b1\u5b50\", updated_at: 2014-12-23 18:08:22 +0900>\nirb(main):003:0> Tweet.create(user: 1, content: \"\u5317\u98a8\u3092\u5439\u304b\u305b\u307e\u3059\")\n=> #<Tweet id: 1, content: \"\u5317\u98a8\u3092\u5439\u304b\u305b\u307e\u3059\", created_at: 2014-12-23 18:08:32 +0900, updated_at: 2014-12-23 18:08:32 +0900, user: #<User id: 1, created_at: 2014-12-23 18:08:07 +0900, name: \"\u5317 \u592a\u90ce\", updated_at: 2014-12-23 18:08:07 +0900>>\nirb(main):004:0> Tweet.create(user: 1, content: \"\u51b7\u305f\u3044\u7a7a\u6c17\u3092\u9001\u308a\u307e\u3059\")\n=> #<Tweet id: 2, content: \"\u51b7\u305f\u3044\u7a7a\u6c17\u3092\u9001\u308a\u307e\u3059\", created_at: 2014-12-23 18:08:40 +0900, updated_at: 2014-12-23 18:08:40 +0900, user: #<User id: 1, created_at: 2014-12-23 18:08:07 +0900, name: \"\u5317 \u592a\u90ce\", updated_at: 2014-12-23 18:08:07 +0900>>\nirb(main):005:0> Tweet.create(user: 2, content: \"\u5357\u98a8\u3092\u5439\u304b\u305b\u307e\u3059\")\n=> #<Tweet id: 3, content: \"\u5357\u98a8\u3092\u5439\u304b\u305b\u307e\u3059\", created_at: 2014-12-23 18:08:47 +0900, updated_at: 2014-12-23 18:08:47 +0900, user: #<User id: 2, created_at: 2014-12-23 18:08:22 +0900, name: \"\u5357 \u82b1\u5b50\", updated_at: 2014-12-23 18:08:22 +0900>>\nirb(main):006:0> Tweet.create(user: 1, content: \"\u6696\u304b\u3044\u7a7a\u6c17\u3092\u9001\u308a\u307e\u3059\")\n=> #<Tweet id: 4, content: \"\u6696\u304b\u3044\u7a7a\u6c17\u3092\u9001\u308a\u307e\u3059\", created_at: 2014-12-23 18:08:54 +0900, updated_at: 2014-12-23 18:08:54 +0900, user: #<User id: 1, created_at: 2014-12-23 18:08:07 +0900, name: \"\u5317 \u592a\u90ce\", updated_at: 2014-12-23 18:08:07 +0900>>\n\n\u610f\u56f3\u901a\u308a\u306b\u52d5\u3044\u3066\u3044\u305d\u3046\u3060\uff0e\n\u691c\u7d22\u3057\u3066\u307f\u3088\u3046\uff0e\u691c\u7d22\u306f\u6761\u4ef6\u3092\u30d6\u30ed\u30c3\u30af\u3067\u6307\u5b9a\u3059\u308b\uff0e\nirb(main):007:0> set = Tweet.select { |record| record.content =~ \"\u7a7a\u6c17\" }\n=> #<ActiveGroonga::ResultSet:0x007ffec6ac7958 @records=#<Groonga::Hash id: <2147483649>, name: (anonymous), path: (temporary), domain: <tweets>, range: (nil), flags: <WITH_SUBREC>, size: <2>, encoding: <:utf8>, default_tokenizer: (nil), token_filters: [], normalizer: (nil)>, @klass=Tweet(content: ShortText, created_at: Time, updated_at: Time, user: users), @groups={}, @expression=#<Groonga::Expression #<expr\n  vars:{\n    $1:#<record:no_key:tweets id:0(nonexistent)>\n  },\n  codes:{\n    0:<push(), modify:1, value:#<record:no_key:tweets id:0(nonexistent)>>,\n    1:<get_value(), modify:2, value:#<column:var_size tweets.content range:ShortText type:scalar compress:none>>,\n    2:<push(), modify:0, value:\"\u7a7a\u6c17\">,\n    3:<match(), modify:0, value:(NULL)>\n  }\n>>, @n_records=2, @default_sort_keys=nil, @default_limit=nil, @n_key_nested=1>\nirb(main):008:0> set.each { |e| p e }\n#<Tweet id: 2, content: \"\u51b7\u305f\u3044\u7a7a\u6c17\u3092\u9001\u308a\u307e\u3059\", created_at: 2014-12-23 18:08:40 +0900, updated_at: 2014-12-23 18:08:40 +0900, user: #<User id: 1, created_at: 2014-12-23 18:08:07 +0900, name: \"\u5317 \u592a\u90ce\", updated_at: 2014-12-23 18:08:07 +0900>>\n#<Tweet id: 4, content: \"\u6696\u304b\u3044\u7a7a\u6c17\u3092\u9001\u308a\u307e\u3059\", created_at: 2014-12-23 18:08:54 +0900, updated_at: 2014-12-23 18:08:54 +0900, user: #<User id: 1, created_at: 2014-12-23 18:08:07 +0900, name: \"\u5317 \u592a\u90ce\", updated_at: 2014-12-23 18:08:07 +0900>>\n=> nil\n\n\u3046\u3080\uff0e\u3046\u307e\u304f\u3067\u304d\u3066\u3044\u308b\uff0e\nRails \u3067 Groonga \u3092\u3044\u3044\u611f\u3058\u306b\u6271\u3048\u308b [ActiveGroonga](http://ranguba.org/ja/#about-active-groonga) \u3068\u3044\u3046\u3082\u306e\u304c\u3042\u308b\u3088\u3046\u306a\u306e\u3067\uff0c2014-12-19 \u306b\u51fa\u305f [Rails4.2](http://weblog.rubyonrails.org/2014/12/19/Rails-4-2-final/) \u3067\u8a66\u3057\u3066\u307f\u305f\uff0e\n\n***2014-12-23 18:18:58 +0900 [\u30b3\u30e1\u30f3\u30c8](http://qiita.com/niku/items/508705c0dbc5357b126c#comment-764d53b994716a213651)\u3092\u53d7\u3051\u3066\u5185\u5bb9\u3092\u4fee\u6b63\uff0eActiveGroonga4.2\u3067\u306f\u5168\u3066\u610f\u56f3\u901a\u308a\u306b\u52d5\u4f5c\u3059\u308b***\n\n# \u53c2\u8003\u306b\u3057\u305f\u30b5\u30a4\u30c8\n\n- [Try ActiveGroonga!](https://web.archive.org/web/20111008122752/http://typo.okkez.net/2010/12/05/try-activegroonga)\n- [ActiveGroonga\u3092\u4f7f\u3063\u3066\u307f\u308b (1)](http://shoutakenaka.blogspot.jp/2014/08/activegroonga-1.html)\n- [ActiveGroonga\u3092\u4f7f\u3063\u3066\u307f\u308b (2)](http://shoutakenaka.blogspot.jp/2014/09/activegroonga-2.html)\n\n# Rails \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u308b\n\n\u540d\u524d\u306f active_record-playground \u3068\u3057\u305f\uff0e\nActiveRecord \u306f\u4f7f\u308f\u306a\u3044\u306e\u3067 --skip-active-record \u3059\u308b\uff0e\n\n```bash\n$ rails new active_groonga_playground --skip-active-record\n```\n\n# ActiveGroonga \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\nGemfile \u306b\n\n```rb\n# Gemfile\ngem \"activegroonga\", require: \"active_groonga\"\n```\n\n\u3092\u8ffd\u52a0\u3059\u308b\uff0e\n\n\u6b21\u306b\n\n```bash\n$ bin/bundle insall\n```\n\n\u3059\u308b\uff0e\n\n# ActiveGroonga \u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092 Rails \u8d77\u52d5\u6642\u306b\u8aad\u307f\u8fbc\u3080\n\n```rb\n# config/application.rb\n\n# require \"active_record/railtie\"\nrequire \"active_groonga/railtie\"\n```\n\n# Groonga \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\u3059\u308b\n\n```bash\n$ bin/rake groonga:create\n```\n\n# User \u30e2\u30c7\u30eb\u3092\u4f5c\u6210\u3059\u308b\n\n```bash\n$ bin/rails generate model user name:short_text\n$ bin/rake groonga:migrate\n```\n\n\u6307\u5b9a\u53ef\u80fd\u306a\u30ab\u30e9\u30e0\u540d\u306f [Schema::TableDefinition](http://ranguba.org/rroonga/ja/Groonga/Schema/TableDefinition.html) \u306b\u66f8\u3044\u3066\u3042\u308b\u3088\u3046\u3060\uff0e\n\n\n# Tweet \u30e2\u30c7\u30eb\u3092\u4f5c\u6210\u3059\u308b\n\n```bash\n$ bin/rails generate model tweet content:short_text user:reference\n$ bin/rake groonga:migrate\n```\n\n# \u691c\u7d22\u7528\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3059\u308b\n\n```bash\n$ bin/rails generate migration CreateFullTextSearchIndex\n```\n\n\u751f\u6210\u3055\u308c\u305f migration \u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3059\u308b\n\n```rb\n# db/groonga/migrate/20141221113954_create_full_text_search_index.rb\nclass CreateFullTextSearchIndex < ActiveGroonga::Migration\n  def up\n    create_table(\"bigram\",\n                 type: :patricia_trie,\n                 key_type: \"ShortText\",\n                 default_tokenizer: \"TokenBigram\",\n                 key_normalize: true) do |table|\n      table.index(\"tweets.content\")\n    end\n  end\n\n  def down\n    remove_table(\"bigram\")\n  end\nend\n```\n\ncreate_table \u306b\u6e21\u3059\u30aa\u30d7\u30b7\u30e7\u30f3\u306f [Schema.create_table](http://ranguba.org/rroonga/ja/Groonga/Schema.html#create_table-class_method) \u3092\u53c2\u8003\u306e\u3053\u3068\uff0e\n\nschema \u3092\u5b9a\u7fa9\u3057\u305f\u3089 migrate \u3059\u308b\uff0e\n\n```bash\n$ bin/rake groonga:migrate\n```\n\n# \u4f7f\u3063\u3066\u307f\u308b\n\n```irb\n$ bin/rails console\nLoading development environment (Rails 4.2.0)\nirb(main):001:0> User.create(name: \"\u5317 \u592a\u90ce\")\n=> #<User id: 1, created_at: 2014-12-23 18:08:07 +0900, name: \"\u5317 \u592a\u90ce\", updated_at: 2014-12-23 18:08:07 +0900>\nirb(main):002:0> User.create(name: \"\u5357 \u82b1\u5b50\")\n=> #<User id: 2, created_at: 2014-12-23 18:08:22 +0900, name: \"\u5357 \u82b1\u5b50\", updated_at: 2014-12-23 18:08:22 +0900>\nirb(main):003:0> Tweet.create(user: 1, content: \"\u5317\u98a8\u3092\u5439\u304b\u305b\u307e\u3059\")\n=> #<Tweet id: 1, content: \"\u5317\u98a8\u3092\u5439\u304b\u305b\u307e\u3059\", created_at: 2014-12-23 18:08:32 +0900, updated_at: 2014-12-23 18:08:32 +0900, user: #<User id: 1, created_at: 2014-12-23 18:08:07 +0900, name: \"\u5317 \u592a\u90ce\", updated_at: 2014-12-23 18:08:07 +0900>>\nirb(main):004:0> Tweet.create(user: 1, content: \"\u51b7\u305f\u3044\u7a7a\u6c17\u3092\u9001\u308a\u307e\u3059\")\n=> #<Tweet id: 2, content: \"\u51b7\u305f\u3044\u7a7a\u6c17\u3092\u9001\u308a\u307e\u3059\", created_at: 2014-12-23 18:08:40 +0900, updated_at: 2014-12-23 18:08:40 +0900, user: #<User id: 1, created_at: 2014-12-23 18:08:07 +0900, name: \"\u5317 \u592a\u90ce\", updated_at: 2014-12-23 18:08:07 +0900>>\nirb(main):005:0> Tweet.create(user: 2, content: \"\u5357\u98a8\u3092\u5439\u304b\u305b\u307e\u3059\")\n=> #<Tweet id: 3, content: \"\u5357\u98a8\u3092\u5439\u304b\u305b\u307e\u3059\", created_at: 2014-12-23 18:08:47 +0900, updated_at: 2014-12-23 18:08:47 +0900, user: #<User id: 2, created_at: 2014-12-23 18:08:22 +0900, name: \"\u5357 \u82b1\u5b50\", updated_at: 2014-12-23 18:08:22 +0900>>\nirb(main):006:0> Tweet.create(user: 1, content: \"\u6696\u304b\u3044\u7a7a\u6c17\u3092\u9001\u308a\u307e\u3059\")\n=> #<Tweet id: 4, content: \"\u6696\u304b\u3044\u7a7a\u6c17\u3092\u9001\u308a\u307e\u3059\", created_at: 2014-12-23 18:08:54 +0900, updated_at: 2014-12-23 18:08:54 +0900, user: #<User id: 1, created_at: 2014-12-23 18:08:07 +0900, name: \"\u5317 \u592a\u90ce\", updated_at: 2014-12-23 18:08:07 +0900>>\n```\n\n\u610f\u56f3\u901a\u308a\u306b\u52d5\u3044\u3066\u3044\u305d\u3046\u3060\uff0e\n\n\u691c\u7d22\u3057\u3066\u307f\u3088\u3046\uff0e\u691c\u7d22\u306f\u6761\u4ef6\u3092\u30d6\u30ed\u30c3\u30af\u3067\u6307\u5b9a\u3059\u308b\uff0e\n\n```irb\nirb(main):007:0> set = Tweet.select { |record| record.content =~ \"\u7a7a\u6c17\" }\n=> #<ActiveGroonga::ResultSet:0x007ffec6ac7958 @records=#<Groonga::Hash id: <2147483649>, name: (anonymous), path: (temporary), domain: <tweets>, range: (nil), flags: <WITH_SUBREC>, size: <2>, encoding: <:utf8>, default_tokenizer: (nil), token_filters: [], normalizer: (nil)>, @klass=Tweet(content: ShortText, created_at: Time, updated_at: Time, user: users), @groups={}, @expression=#<Groonga::Expression #<expr\n  vars:{\n    $1:#<record:no_key:tweets id:0(nonexistent)>\n  },\n  codes:{\n    0:<push(), modify:1, value:#<record:no_key:tweets id:0(nonexistent)>>,\n    1:<get_value(), modify:2, value:#<column:var_size tweets.content range:ShortText type:scalar compress:none>>,\n    2:<push(), modify:0, value:\"\u7a7a\u6c17\">,\n    3:<match(), modify:0, value:(NULL)>\n  }\n>>, @n_records=2, @default_sort_keys=nil, @default_limit=nil, @n_key_nested=1>\nirb(main):008:0> set.each { |e| p e }\n#<Tweet id: 2, content: \"\u51b7\u305f\u3044\u7a7a\u6c17\u3092\u9001\u308a\u307e\u3059\", created_at: 2014-12-23 18:08:40 +0900, updated_at: 2014-12-23 18:08:40 +0900, user: #<User id: 1, created_at: 2014-12-23 18:08:07 +0900, name: \"\u5317 \u592a\u90ce\", updated_at: 2014-12-23 18:08:07 +0900>>\n#<Tweet id: 4, content: \"\u6696\u304b\u3044\u7a7a\u6c17\u3092\u9001\u308a\u307e\u3059\", created_at: 2014-12-23 18:08:54 +0900, updated_at: 2014-12-23 18:08:54 +0900, user: #<User id: 1, created_at: 2014-12-23 18:08:07 +0900, name: \"\u5317 \u592a\u90ce\", updated_at: 2014-12-23 18:08:07 +0900>>\n=> nil\n```\n\n\u3046\u3080\uff0e\u3046\u307e\u304f\u3067\u304d\u3066\u3044\u308b\uff0e\n"}