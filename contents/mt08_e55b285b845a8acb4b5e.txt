{"context": "\n\n\u6982\u8981/Overview\n\nZFS \u3092 Raspbian \u3067\u4f7f\u7528\u3059\u308b\n\u53c2\u8003: zfsonlinux/zfs:Building ZFS\n\n\nlinux-headers-$(uname -r)\u306e\u4ee3\u308f\u308a\u306b\u3001raspberrypi-kernel-headers\n\n\n\n\u74b0\u5883/Environment\n\nRaspberry Pi 2/3\nRaspbian: 2017-01-11-raspbian-jessie-lite \n\n\n\u624b\u9806\n\n\n\u3044\u3064\u3082\u306e\n\nBurn Raspbian to SD\n\u30d1\u30c3\u30b1\u30fc\u30b8\u66f4\u65b0:sudo apt-get update && sudo apt upgrade -y\n\n\n\n\n\u30d3\u30eb\u30c9\u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u3053\u3074\u307a\nsudo apt-get install -y build-essential autoconf libtool gawk alien fakeroot raspberrypi-kernel-headers && \\\nsudo apt-get install -y zlib1g-dev uuid-dev libattr1-dev libblkid-dev libselinux-dev libudev-dev libdevmapper-dev && \\\nsudo apt-get install -y parted lsscsi ksh\n\n\n\n\n\u30d3\u30eb\u30c9\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nDIR_WORK=${HOME}/work\n#\ncd ${DIR_WORK}\n# \u30bd\u30fc\u30b9\u53d6\u5f97.\nwget https://github.com/zfsonlinux/zfs/releases/download/zfs-0.6.5.9/spl-0.6.5.9.tar.gz\nwget https://github.com/zfsonlinux/zfs/releases/download/zfs-0.6.5.9/zfs-0.6.5.9.tar.gz\n# \u30ef\u30fc\u30af\u30d5\u30a9\u30eb\u30c0\u306b\u30bd\u30fc\u30b9\u5c55\u958b.\nmkdir zfs\ncd zfs\ntar xf ../spl-0.6.5.9.tar.gz\ntar xf ../zfs-0.6.5.9.tar.gz\n# OR \n##git clone https://github.com/zfsonlinux/spl\n##git clone https://github.com/zfsonlinux/zfs\n# \u30d3\u30eb\u30c9\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb.\ncd spl-*\n./autogen.sh && ./configure && make -j4\nsudo make install\n# sudo sh -c 'PATH=/home/pi/.local/bin:$PATH porg -lD \"make install\"'\ncd ..\ncd zfs-*\n./autogen.sh && ./configure && make -j4\nsudo make install\n#sudo sh -c 'PATH=/home/pi/.local/bin:$PATH porg -lD \"make install\"'\ncd ..\n#\n# \u5171\u6709Lib\u306e\u66f4\u65b0\nsudo ldconfig\n#\ncd ${HOME}\n# \u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u66f4\u65b0.\nsudo depmod -a\n\n\n\n\u30c6\u30b9\u30c8 : 256MB\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u3064\u304f\u3063\u3066\u3001\u305d\u3053\u3067\u3001zfs\u3092\u4f7f\u7528\u3057\u3066\u307f\u308b.\n#root\u306b\u306a\u308b.\n# root\u3067\u306a\u3044\u3068\u3001'Permission denied the ZFS utilities must be run as root.'\nsudo -s\n# \u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u8aad\u307f\u8fbc\u307f\nmodprobe zfs\nlsmod\n# 256MB\u306e\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210 \ndd if=/dev/zero of=/tmp/zfs256MB bs=1M count=256\n#\u30d7\u30fc\u30eb\u30c6\u30b9\u30c8\nzpool create tank /tmp/zfs256MB \nzpool list\nzpool status\n# FS\u4f5c\u6210\nzfs create tank/test1\nzfs list\nchown pi.pi -R /tank/test1\n# \u30d7\u30fc\u30eb\u306e\u7834\u68c4\nzpool destroy tank\nzpool list\n\n\n\u5b9f\u884c\u4f8b\npi@raspberrypi:~ $ sudo zpool status\n  pool: tank\n state: ONLINE\n  scan: none requested\nconfig:\n\n    NAME             STATE     READ WRITE CKSUM\n    tank             ONLINE       0     0     0\n      /tmp/zfs256MB  ONLINE       0     0     0\n\nerrors: No known data errors\npi@raspberrypi:~ $ sudo zfs list\nNAME         USED  AVAIL  REFER  MOUNTPOINT\ntank          89K   208M    19K  /tank\ntank/test1    19K   208M    19K  /tank/test1\npi@raspberrypi:~ $\n\n\n\n\n\n\u305d\u306e\u4ed6\n\n\u3082\u3046\u3061\u3068\u3001zfs\u3092\u304a\u52c9\u5f37\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3002\nUSB\u30c9\u30e9\u30a4\u30d6\u3067\u3001zpool create hogehoge /dev/sda\u307f\u305f\u3044\u306b\u3067\u304d\u305f\u306f\u305a\u3002\nUSB\u30c9\u30e9\u30a4\u30d62\u53f0\u3068\u304b\u3067\u3001\u30df\u30e9\u30fc\u30ea\u30f3\u30b0\u3068\u304b\u3067\u304d\u308b\u306e\u3060\u308d\u3046\u304b\uff1f\n\n\u8d77\u52d5\u6642\u306b\u518d\u30de\u30a6\u30f3\u30c8\u3059\u308b\u306b\u306f\u3069\u3046\u3059\u308b\u306e\u304c\u3044\u3044\u3060\u308d\u3046\u304b\uff1f=> (2017-3-2\u8ffd\u8a18) archlinux\u306eZFS\u306e\u81ea\u52d5\u8d77\u52d5\u306e\u3042\u305f\u308a\u304b\u3089\n# pool\u4f5c\u6210\u5f8c\nzpool set cachefile=/usr/local/etc/zfs/zpool.cache <pool>\nsystemctl enable zfs.target\nsystemctl enable zfs-import-cache\nsystemctl enable zfs-mount\n\ncachefile\u306f\u3001/etc/default/zfs\u306eZPOOL_CACHE=\uff5e\u3067\u6307\u5b9a?\n\nRaspbian\u3067\u3001rootfs\u3068\u3057\u3066\u4f7f\u3048\u308b\u306e\u3060\u308d\u3046\u304b\uff1f\n\n## \u6982\u8981/Overview\n- ZFS \u3092 Raspbian \u3067\u4f7f\u7528\u3059\u308b\n- \u53c2\u8003: [zfsonlinux/zfs:Building ZFS](https://github.com/zfsonlinux/zfs/wiki/Building-ZFS)\n- `linux-headers-$(uname -r)`\u306e\u4ee3\u308f\u308a\u306b\u3001`raspberrypi-kernel-headers`\n\n\n## \u74b0\u5883/Environment\n- Raspberry Pi 2/3\n- Raspbian: `2017-01-11-raspbian-jessie-lite` \n\n\n## \u624b\u9806\n1. \u3044\u3064\u3082\u306e\n - Burn Raspbian to SD\n - \u30d1\u30c3\u30b1\u30fc\u30b8\u66f4\u65b0:<br>`sudo apt-get update && sudo apt upgrade -y`\n\n2. \u30d3\u30eb\u30c9\u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n    ```bash:\u3053\u3074\u307a\nsudo apt-get install -y build-essential autoconf libtool gawk alien fakeroot raspberrypi-kernel-headers && \\\nsudo apt-get install -y zlib1g-dev uuid-dev libattr1-dev libblkid-dev libselinux-dev libudev-dev libdevmapper-dev && \\\nsudo apt-get install -y parted lsscsi ksh\n```\n\n3. \u30d3\u30eb\u30c9\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n    ```bash\nDIR_WORK=${HOME}/work\n#\ncd ${DIR_WORK}\n# \u30bd\u30fc\u30b9\u53d6\u5f97.\nwget https://github.com/zfsonlinux/zfs/releases/download/zfs-0.6.5.9/spl-0.6.5.9.tar.gz\nwget https://github.com/zfsonlinux/zfs/releases/download/zfs-0.6.5.9/zfs-0.6.5.9.tar.gz\n# \u30ef\u30fc\u30af\u30d5\u30a9\u30eb\u30c0\u306b\u30bd\u30fc\u30b9\u5c55\u958b.\nmkdir zfs\ncd zfs\ntar xf ../spl-0.6.5.9.tar.gz\ntar xf ../zfs-0.6.5.9.tar.gz\n# OR \n##git clone https://github.com/zfsonlinux/spl\n##git clone https://github.com/zfsonlinux/zfs\n# \u30d3\u30eb\u30c9\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb.\ncd spl-*\n./autogen.sh && ./configure && make -j4\nsudo make install\n# sudo sh -c 'PATH=/home/pi/.local/bin:$PATH porg -lD \"make install\"'\ncd ..\ncd zfs-*\n./autogen.sh && ./configure && make -j4\nsudo make install\n#sudo sh -c 'PATH=/home/pi/.local/bin:$PATH porg -lD \"make install\"'\ncd ..\n#\n# \u5171\u6709Lib\u306e\u66f4\u65b0\nsudo ldconfig\n#\ncd ${HOME}\n# \u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u66f4\u65b0.\nsudo depmod -a\n```\n\n4. \u30c6\u30b9\u30c8 : 256MB\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u3064\u304f\u3063\u3066\u3001\u305d\u3053\u3067\u3001zfs\u3092\u4f7f\u7528\u3057\u3066\u307f\u308b.\n\n    ```bash\n#root\u306b\u306a\u308b.\n# root\u3067\u306a\u3044\u3068\u3001'Permission denied the ZFS utilities must be run as root.'\nsudo -s\n# \u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u8aad\u307f\u8fbc\u307f\nmodprobe zfs\nlsmod\n# 256MB\u306e\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210 \ndd if=/dev/zero of=/tmp/zfs256MB bs=1M count=256\n#\u30d7\u30fc\u30eb\u30c6\u30b9\u30c8\nzpool create tank /tmp/zfs256MB \nzpool list\nzpool status\n# FS\u4f5c\u6210\nzfs create tank/test1\nzfs list\nchown pi.pi -R /tank/test1\n# \u30d7\u30fc\u30eb\u306e\u7834\u68c4\nzpool destroy tank\nzpool list\n```\n\n\n    ```shell-session:\u5b9f\u884c\u4f8b\n\tpi@raspberrypi:~ $ sudo zpool status\n\t  pool: tank\n\t state: ONLINE\n\t  scan: none requested\n\tconfig:\n\n\t\tNAME             STATE     READ WRITE CKSUM\n\t\ttank             ONLINE       0     0     0\n\t\t  /tmp/zfs256MB  ONLINE       0     0     0\n\n\terrors: No known data errors\n\tpi@raspberrypi:~ $ sudo zfs list\n\tNAME         USED  AVAIL  REFER  MOUNTPOINT\n\ttank          89K   208M    19K  /tank\n\ttank/test1    19K   208M    19K  /tank/test1\n\tpi@raspberrypi:~ $\n```\n\n## \u305d\u306e\u4ed6\n- \u3082\u3046\u3061\u3068\u3001zfs\u3092\u304a\u52c9\u5f37\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3002\n- USB\u30c9\u30e9\u30a4\u30d6\u3067\u3001`zpool create hogehoge /dev/sda`\u307f\u305f\u3044\u306b\u3067\u304d\u305f\u306f\u305a\u3002\n- USB\u30c9\u30e9\u30a4\u30d62\u53f0\u3068\u304b\u3067\u3001\u30df\u30e9\u30fc\u30ea\u30f3\u30b0\u3068\u304b\u3067\u304d\u308b\u306e\u3060\u308d\u3046\u304b\uff1f\n- \u8d77\u52d5\u6642\u306b\u518d\u30de\u30a6\u30f3\u30c8\u3059\u308b\u306b\u306f\u3069\u3046\u3059\u308b\u306e\u304c\u3044\u3044\u3060\u308d\u3046\u304b\uff1f<br>=> (2017-3-2\u8ffd\u8a18) [archlinux\u306eZFS\u306e\u81ea\u52d5\u8d77\u52d5](https://wiki.archlinuxjp.org/index.php/ZFS#.E8.87.AA.E5.8B.95.E8.B5.B7.E5.8B.95)\u306e\u3042\u305f\u308a\u304b\u3089\n\n\t```bash\n\t# pool\u4f5c\u6210\u5f8c\n\tzpool set cachefile=/usr/local/etc/zfs/zpool.cache <pool>\n\tsystemctl enable zfs.target\n\tsystemctl enable zfs-import-cache\n\tsystemctl enable zfs-mount\n\t```\n\tcachefile\u306f\u3001`/etc/default/zfs`\u306e`ZPOOL_CACHE=\uff5e`\u3067\u6307\u5b9a?\n\n- Raspbian\u3067\u3001rootfs\u3068\u3057\u3066\u4f7f\u3048\u308b\u306e\u3060\u308d\u3046\u304b\uff1f\n\n\n", "tags": ["RaspberryPi", "ZFS"]}