{"context": " More than 1 year has passed since last update.\n\nNova Migration Type\nhttp://docs.openstack.org/admin-guide-cloud/compute-configuring-migrations.html\n\nThe migration types are:\n\nNon-live migration (sometimes referred to simply as \u2018migration\u2019)\nThe instance is shut down for a period of time to be moved to another hypervisor. In this case, the instance recognizes that it was rebooted.\n\nLive migration (or \u2018true live migration\u2019)\nAlmost no instance downtime. Useful when the instances must be kept running during the migration.\nThe different types of live migration are:\n\n2-1. Shared storage-based live migration \n   Both hypervisors have access to shared storage.\n2-2. Block live migration \n   No shared storage is required. Incompatible with read-only devices such as CD-ROMs and Configuration Drive (config_drive).\n2-3. Volume-backed live migration \n   Instances are backed by volumes rather than ephemeral disk, no shared storage is required, and migration is supported (currently only available for libvirt-based hypervisors).\n\n\n\n\n\nWhat's this?\nnova migrate \u3092\u4f7f\u7528\u3057\u305f AZ \u9593\u306e Nova instance \u306e\u79fb\u52d5\u3067\u306f\u306a\u304f\u3001\n\nNova Migration (non live migration) to Different Hypervisor between AZ\nNova Migration (true live migration) to Different Hypervisor between AZ\n\n\u624b\u52d5\u3067 Nova instance \u3092\u5225\u306e AZ \u3078\u79fb\u52d5\u3002\nBrief summary procedure:\n\nNova \u306e snapshot \u53d6\u5f97\n\u305d\u306e snapshot \u304b\u3089 \u5225 AZ \u3067 Nova boot\n\n\nMigrate Nova instance\n\nInitial state\n\nHypervisor (Compute node)\n# nova hypervisor-list\n+----+-----------------------+\n| ID | Hypervisor hostname   |\n+----+-----------------------+\n| 6  | node-27               |\n| 9  | node-28               |\n| 15 | node-31               |\n+----+-----------------------+\n\n\nAZ\n# nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n| nova                     | available                              |\n| |- node-27               |                                        |\n| | |- nova-compute        | enabled :-) 2015-02-25T01:12:12.000000 |\n| |- node-28               |                                        |\n| | |- nova-compute        | enabled :-) 2015-02-25T01:12:15.000000 |\n| nova2                    | available                              |\n| |- node-31               |                                        |\n| | |- nova-compute        | enabled :-) 2015-02-25T01:12:13.000000 |\n+--------------------------+----------------------------------------+\n\n\nNova instance is on node-27 of AZ:nova\n# nova list --field name,status,,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n+--------------------------------------+------------+--------+--+----------------------+------------------------------+--------------------------------------+\n| ID                                   | Name       | Status |  | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n+--------------------------------------+------------+--------+--+----------------------+------------------------------+--------------------------------------+\n| 4cabed9e-94fe-4229-9fb9-b4e785895845 | admin_vm01 | ACTIVE |  | active               | nova                         | node-27                              |\n+--------------------------------------+------------+--------+--+----------------------+------------------------------+--------------------------------------+\n\n\nNova snapshot\n\nTake Nova snapshot\nRecommend to stop a instance before take a snapshot.\n$ nova image-create --poll admin_vm01 admin_vm01_ss\nServer snapshotting... 100% complete\nFinished\n\n\nList Glance images\n$ glance image-list --name admin_vm01_ss\n+--------------------------------------+---------------+-------------+------------------+------------+--------+\n| ID                                   | Name          | Disk Format | Container Format | Size       | Status |\n+--------------------------------------+---------------+-------------+------------------+------------+--------+\n| 95385cef-879c-4b36-91d7-e96f87c0c8ed | admin_vm01_ss | raw         | bare             | 1073741824 | active |\n+--------------------------------------+---------------+-------------+------------------+------------+--------+\n\n$ glance image-show admin_vm01_ss | egrep \"Property|instance_uuid\"\n| Property                              | Value                                |\n| Property 'instance_uuid'              | 4cabed9e-94fe-4229-9fb9-b4e785895845 |\n\n\nBoot Nova instance in different AZ:nova2 from the snapshot of AZ:nova\n\nNova boot\n# nova boot --flavor m1.tiny \\\n            --image admin_vm01_ss \\\n            --security-groups default \\\n            --availability-zone nova2 \\\n            --nic net-id=b3fa9d4d-4c21-47f5-be07-cf2ff518035e \\\n            admin_vm02\n+--------------------------------------+------------------------------------------------------+\n| Property                             | Value                                                |\n+--------------------------------------+------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                               |\n| OS-EXT-AZ:availability_zone          | nova                                                 |\n| OS-EXT-SRV-ATTR:host                 | -                                                    |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                                    |\n| OS-EXT-SRV-ATTR:instance_name        | instance-0000048c                                    |\n| OS-EXT-STS:power_state               | 0                                                    |\n| OS-EXT-STS:task_state                | scheduling                                           |\n| OS-EXT-STS:vm_state                  | building                                             |\n| OS-SRV-USG:launched_at               | -                                                    |\n| OS-SRV-USG:terminated_at             | -                                                    |\n| accessIPv4                           |                                                      |\n| accessIPv6                           |                                                      |\n| adminPass                            | yWYtEPCu78qz                                         |\n| config_drive                         |                                                      |\n| created                              | 2015-02-25T01:22:19Z                                 |\n| flavor                               | m1.tiny (1)                                          |\n| hostId                               |                                                      |\n| id                                   | e75a9a13-1df2-43e3-923e-bd6f4b56996c                 |\n| image                                | admin_vm01_ss (d2aad231-0b2a-4785-b58c-aa57300e5dee) |\n| key_name                             | -                                                    |\n| metadata                             | {}                                                   |\n| name                                 | admin_vm02                                           |\n| os-extended-volumes:volumes_attached | []                                                   |\n| progress                             | 0                                                    |\n| security_groups                      | default                                              |\n| status                               | BUILD                                                |\n| tenant_id                            | a8085d1871f847bdb906ef4a28d1bd48                     |\n| updated                              | 2015-02-25T01:22:19Z                                 |\n| user_id                              | a1c2ec19759040e39f219fcf82028bf6                     |\n+--------------------------------------+------------------------------------------------------+\n\n\nCheck the Nova instance\nNew Nova instance is booted on node-31 in AZ:nova2\n# nova list --field name,status,,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n+--------------------------------------+------------+--------+--+----------------------+------------------------------+--------------------------------------+\n| ID                                   | Name       | Status |  | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n+--------------------------------------+------------+--------+--+----------------------+------------------------------+--------------------------------------+\n| 4cabed9e-94fe-4229-9fb9-b4e785895845 | admin_vm01 | ACTIVE |  | active               | nova                         | node-27                              |\n| e75a9a13-1df2-43e3-923e-bd6f4b56996c | admin_vm02 | ACTIVE |  | active               | nova2                        | node-31                              |\n+--------------------------------------+------------+--------+--+----------------------+------------------------------+--------------------------------------+\n\n# nova show admin_vm02 | egrep \"Property|AZ|hypervisor| id |image\"\n| Property                             | Value                                                    |\n| OS-EXT-AZ:availability_zone          | nova2                                                    |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | node-31                                                  |\n| id                                   | e75a9a13-1df2-43e3-923e-bd6f4b56996c                     |\n| image                                | admin_vm01_ss (d2aad231-0b2a-4785-b58c-aa57300e5dee)     |\n\n\nEnvironment\n\nOpenstack : Juno\nCeph : Firefly\n\n\nReference\nNova Migration (non live migration) to Different Hypervisor\nNova Migration (non live migration) to Different Hypervisor between AZ\nNova Migration (true live migration) to Different Hypervisor\nNova Migration (true live migration) to Different Hypervisor between AZ\nNova Migration (Manually) between AZ\nNova Migration (Manually) between Region\nNova Migration (true live migration) to Different Hypervisor - Volume-backend live migration (instance)\nNova Migration (true live migration) to Different Hypervisor - Volume-backend live migration (instance) between AZ\n## Nova Migration Type\n\nhttp://docs.openstack.org/admin-guide-cloud/compute-configuring-migrations.html\n\n> **The migration types are:**\n>\n> 1. **Non-live migration** (sometimes referred to simply as \u2018migration\u2019)\n> The instance is shut down for a period of time to be moved to another hypervisor. In this case, the instance recognizes that it was rebooted.\n>\n> 2. **Live migration** (or \u2018true live migration\u2019)\n> Almost no instance downtime. Useful when the instances must be kept running during the migration.\n> The different types of live migration are:\n>     - 2-1. **Shared storage-based live migration** <br>\n>            Both hypervisors have access to shared storage.\n>     - 2-2. **Block live migration** <br>\n>            No shared storage is required. Incompatible with read-only devices such as CD-ROMs and Configuration Drive (config_drive).\n>     - 2-3. **Volume-backed live migration** <br>\n>            Instances are backed by volumes rather than ephemeral disk, no shared storage is required, and migration is supported (currently only available for libvirt-based hypervisors).\n\n## What's this?\n\n`nova migrate` \u3092\u4f7f\u7528\u3057\u305f AZ \u9593\u306e Nova instance \u306e\u79fb\u52d5\u3067\u306f\u306a\u304f\u3001\n\n* [Nova Migration (non live migration) to Different Hypervisor between AZ][link-02]\n* [Nova Migration (true live migration) to Different Hypervisor between AZ][link-04]\n\n\u624b\u52d5\u3067 Nova instance \u3092\u5225\u306e AZ \u3078\u79fb\u52d5\u3002\n\nBrief summary procedure:\n\n1. Nova \u306e snapshot \u53d6\u5f97\n2. \u305d\u306e snapshot \u304b\u3089 \u5225 AZ \u3067 Nova boot\n\n\n## Migrate Nova instance\n\n### Initial state\n\n#### Hypervisor (Compute node)\n\n    # nova hypervisor-list\n    +----+-----------------------+\n    | ID | Hypervisor hostname   |\n    +----+-----------------------+\n    | 6  | node-27               |\n    | 9  | node-28               |\n    | 15 | node-31               |\n    +----+-----------------------+\n\n#### AZ\n\n    # nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n    | nova                     | available                              |\n    | |- node-27               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-02-25T01:12:12.000000 |\n    | |- node-28               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-02-25T01:12:15.000000 |\n    | nova2                    | available                              |\n    | |- node-31               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-02-25T01:12:13.000000 |\n    +--------------------------+----------------------------------------+\n\n#### Nova instance is on node-27 of AZ:nova\n\n    # nova list --field name,status,,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n    +--------------------------------------+------------+--------+--+----------------------+------------------------------+--------------------------------------+\n    | ID                                   | Name       | Status |  | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n    +--------------------------------------+------------+--------+--+----------------------+------------------------------+--------------------------------------+\n    | 4cabed9e-94fe-4229-9fb9-b4e785895845 | admin_vm01 | ACTIVE |  | active               | nova                         | node-27                              |\n    +--------------------------------------+------------+--------+--+----------------------+------------------------------+--------------------------------------+\n\n\n### Nova snapshot\n\n#### Take Nova snapshot\n\nRecommend to stop a instance before take a snapshot.\n\n    $ nova image-create --poll admin_vm01 admin_vm01_ss\n    Server snapshotting... 100% complete\n    Finished\n\n#### List Glance images\n\n    $ glance image-list --name admin_vm01_ss\n    +--------------------------------------+---------------+-------------+------------------+------------+--------+\n    | ID                                   | Name          | Disk Format | Container Format | Size       | Status |\n    +--------------------------------------+---------------+-------------+------------------+------------+--------+\n    | 95385cef-879c-4b36-91d7-e96f87c0c8ed | admin_vm01_ss | raw         | bare             | 1073741824 | active |\n    +--------------------------------------+---------------+-------------+------------------+------------+--------+\n\n    $ glance image-show admin_vm01_ss | egrep \"Property|instance_uuid\"\n    | Property                              | Value                                |\n    | Property 'instance_uuid'              | 4cabed9e-94fe-4229-9fb9-b4e785895845 |\n\n\n### Boot Nova instance in different AZ:nova2 from the snapshot of AZ:nova\n\n#### Nova boot\n\n    # nova boot --flavor m1.tiny \\\n                --image admin_vm01_ss \\\n                --security-groups default \\\n                --availability-zone nova2 \\\n                --nic net-id=b3fa9d4d-4c21-47f5-be07-cf2ff518035e \\\n                admin_vm02\n    +--------------------------------------+------------------------------------------------------+\n    | Property                             | Value                                                |\n    +--------------------------------------+------------------------------------------------------+\n    | OS-DCF:diskConfig                    | MANUAL                                               |\n    | OS-EXT-AZ:availability_zone          | nova                                                 |\n    | OS-EXT-SRV-ATTR:host                 | -                                                    |\n    | OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                                    |\n    | OS-EXT-SRV-ATTR:instance_name        | instance-0000048c                                    |\n    | OS-EXT-STS:power_state               | 0                                                    |\n    | OS-EXT-STS:task_state                | scheduling                                           |\n    | OS-EXT-STS:vm_state                  | building                                             |\n    | OS-SRV-USG:launched_at               | -                                                    |\n    | OS-SRV-USG:terminated_at             | -                                                    |\n    | accessIPv4                           |                                                      |\n    | accessIPv6                           |                                                      |\n    | adminPass                            | yWYtEPCu78qz                                         |\n    | config_drive                         |                                                      |\n    | created                              | 2015-02-25T01:22:19Z                                 |\n    | flavor                               | m1.tiny (1)                                          |\n    | hostId                               |                                                      |\n    | id                                   | e75a9a13-1df2-43e3-923e-bd6f4b56996c                 |\n    | image                                | admin_vm01_ss (d2aad231-0b2a-4785-b58c-aa57300e5dee) |\n    | key_name                             | -                                                    |\n    | metadata                             | {}                                                   |\n    | name                                 | admin_vm02                                           |\n    | os-extended-volumes:volumes_attached | []                                                   |\n    | progress                             | 0                                                    |\n    | security_groups                      | default                                              |\n    | status                               | BUILD                                                |\n    | tenant_id                            | a8085d1871f847bdb906ef4a28d1bd48                     |\n    | updated                              | 2015-02-25T01:22:19Z                                 |\n    | user_id                              | a1c2ec19759040e39f219fcf82028bf6                     |\n    +--------------------------------------+------------------------------------------------------+\n\n#### Check the Nova instance\n\nNew Nova instance is booted on node-31 in AZ:nova2\n\n    # nova list --field name,status,,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n    +--------------------------------------+------------+--------+--+----------------------+------------------------------+--------------------------------------+\n    | ID                                   | Name       | Status |  | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n    +--------------------------------------+------------+--------+--+----------------------+------------------------------+--------------------------------------+\n    | 4cabed9e-94fe-4229-9fb9-b4e785895845 | admin_vm01 | ACTIVE |  | active               | nova                         | node-27                              |\n    | e75a9a13-1df2-43e3-923e-bd6f4b56996c | admin_vm02 | ACTIVE |  | active               | nova2                        | node-31                              |\n    +--------------------------------------+------------+--------+--+----------------------+------------------------------+--------------------------------------+\n\n    # nova show admin_vm02 | egrep \"Property|AZ|hypervisor| id |image\"\n    | Property                             | Value                                                    |\n    | OS-EXT-AZ:availability_zone          | nova2                                                    |\n    | OS-EXT-SRV-ATTR:hypervisor_hostname  | node-31                                                  |\n    | id                                   | e75a9a13-1df2-43e3-923e-bd6f4b56996c                     |\n    | image                                | admin_vm01_ss (d2aad231-0b2a-4785-b58c-aa57300e5dee)     |\n\n## Environment\n\n* Openstack : Juno\n* Ceph : Firefly\n\n## Reference\n\n[Nova Migration (non live migration) to Different Hypervisor][link-01]\n[Nova Migration (non live migration) to Different Hypervisor between AZ][link-02]\n[Nova Migration (true live migration) to Different Hypervisor][link-03]\n[Nova Migration (true live migration) to Different Hypervisor between AZ][link-04]\n[Nova Migration (Manually) between AZ][link-05]\n[Nova Migration (Manually) between Region][link-06]\n[Nova Migration (true live migration) to Different Hypervisor - Volume-backend live migration (instance)][link-07]\n[Nova Migration (true live migration) to Different Hypervisor - Volume-backend live migration (instance) between AZ][link-08]\n\n[link-01]:http://qiita.com/idzzy/items/a3032dce3110f959e11b\n[link-02]:http://qiita.com/idzzy/items/3d67b3cedd42d39a8e2a\n[link-03]:http://qiita.com/idzzy/items/a03b19e0c0289a63e491\n[link-04]:http://qiita.com/idzzy/items/ed45aaa3cc6ecc144f90\n[link-05]:http://qiita.com/idzzy/items/98967887a0d3771a7795\n[link-06]:http://qiita.com/idzzy/items/01b32f52e7cf0e4c5f55\n[link-07]:http://qiita.com/idzzy/items/515776f1461bb5c96eea\n[link-08]:http://qiita.com/idzzy/items/5c54443c0d36f0a14e72\n", "tags": ["openstack", "nova"]}