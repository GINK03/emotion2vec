{"context": " More than 1 year has passed since last update.Testing Flux Applications\u3067\u306f\u3001Store\u3092\u30c6\u30b9\u30c8\u3059\u308b\u969b\u306e\u30c8\u30ea\u30c3\u30af\u3068\u3057\u3066Jest\u4e0a\u3067\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u3002\nvar mockRegister = MyDispatcher.register;\nvar mockRegisterInfo = mockRegister.mock;\nvar callsToRegister = mockRegisterInfo.calls;\nvar firstCall = callsToRegister[0];\nvar firstArgument = firstCall[0];\nvar callback = firstArgument;\n\nJest\u306f\u57fa\u672c\u5168\u3066\u304c\u30e2\u30c3\u30af\u3055\u308c\u308b\u306e\u3067\u3001\u8981\u306f\u300cDispatcher\u306eregister\u306b\u4e0e\u3048\u3089\u308c\u305f\u5f15\u6570\u304c\u89b3\u6e2c\u3067\u304d\u308b\u304b\u3089\u3001Store\u306ecallback\u3092\u6355\u6349\u3057\u3066\u30c6\u30b9\u30c8\u3057\u305f\u3044\u5185\u5bb9\u306b\u5408\u308f\u305b\u3066\u9069\u5b9c\u5b9f\u884c\u305b\u3088\u300d\u3068\u3044\u3046\u3053\u3068\u3067\u3042\u308b\u3002\n\u3053\u306e\u52d5\u4f5c\u3001Sinon\u306eSpy\u306b\u3082\u540c\u3058\u3088\u3046\u306a\u5b9f\u88c5\u304c\u3042\u308b\u3002spy.firstCall\u3084spy.getCall\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u304a\u308a\u3001n\u5ea6\u76ee\u306b\u547c\u3070\u308c\u305f\u969b\u306b\u6e21\u3055\u308c\u305f\u5f15\u6570\u3092\u53d6\u5f97\u3067\u304d\u308b\u3002\u4f8b\u3048\u3070\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3067MyStore\u5185\u90e8\u306b\u5b9a\u7fa9\u3057\u305fcallback\u306f\u53d6\u5f97\u3067\u304d\u308b\u3002\nregister = spy require('../../src/dispatcher/AppDispatcher'), 'register'\nMyStore = require '../../src/stores/MyStore'\ncallback = register.lastCall.args[0]\n\nStore\u306f\u5e38\u306b\u5358\u4e00\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u3042\u308b\u3053\u3068\u3092\u5f37\u5236\u3055\u308c\u308b\u306e\u3067\u3001\u30c6\u30b9\u30c8\u3054\u3068\u306b\u72b6\u614b\u3092\u30ea\u30bb\u30c3\u30c8\u3057\u306a\u3044\u3068\u524d\u306e\u72b6\u614b\u3092\u4fdd\u6301\u3057\u3066\u3057\u307e\u3046\u3002Store\u306e\u72b6\u614b\u3092\u76f4\u63a5\u5909\u3048\u305f\u308asetter\u3092\u4f5c\u308b\u306e\u306f\u7981\u3058\u624b\u306a\u306e\u3067\u3001\u30c6\u30b9\u30c8\u3054\u3068\u306brequire\u304c\u65b0\u305f\u306aStore\u3092\u8fd4\u3059\u3088\u3046\u306b\u3059\u308b\u3002\nrequire\u3059\u308b\u3068\u901a\u5e38\u306e\u5834\u5408\u7d50\u679c\u304crequire.cache\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u308b\u306e\u3067\u3001require.cache\u304b\u3089\u524a\u9664\u3059\u308b\u3053\u3068\u3067\u3001\u518d\u5ea6require\u3057\u305f\u3068\u304d\u65b0\u3057\u3044Store\u304c\u8fd4\u3063\u3066\u304f\u308b\u3088\u3046\u306b\u3067\u304d\u308b\u3002\ndelete require.cache[require.resolve '../../src/stores/MyStore']\n\n\n\u5b9f\u969b\u306b\u52d5\u304b\u3059\nJest\u3067\u66f8\u304b\u308c\u305fFlux TodoMVC\u306e\u30c6\u30b9\u30c8\u3092Mocha, power-assert\u3067\u52d5\u304f\u3088\u3046\u306b\u66f8\u304f\u3002\n$ npm install mocha power-assert sinon espower-coffee --save-dev\n\n\ntest/stores/TodoStore.test.coffee\nassert = require 'power-assert'\n{spy} = require 'sinon'\n\ndescribe 'TodoStore', ->\n  TodoConstants = require '../../js/constants/TodoConstants'\n  register = null\n  TodoStore = null\n  callback = null\n\n  actionTodoCreate =\n    actionType: TodoConstants.TODO_CREATE,\n    text: 'foo'\n  actionTodoDestroy =\n    actionType: TodoConstants.TODO_DESTROY,\n    id: 'replace me in test'\n\n  before ->\n    register = spy require('../../js/dispatcher/AppDispatcher'), 'register'\n\n  beforeEach ->\n    delete require.cache[require.resolve '../../js/stores/TodoStore']\n    TodoStore = require '../../js/stores/TodoStore'\n    callback = register.lastCall.args[0]\n\n  it 'creates a to-do item', ->\n    callback actionTodoCreate\n    all = do TodoStore.getAll\n    keys = Object.keys all\n    assert.equal keys.length, 1\n    assert.equal all[keys[0]].text, 'foo'\n\n  it 'destroys a to-do item', ->\n    callback actionTodoCreate\n    all = do TodoStore.getAll\n    keys = Object.keys all\n    assert.equal keys.length, 1\n    actionTodoDestroy.id = keys[0]\n    callback actionTodoDestroy\n    assert.equal all[keys[0]], undefined\n\n\n$ ./node_modules/.bin/mocha --require espower-coffee/guess test/**/*.test.coffee\n\n\n  TodoStore\n    \u2713 creates a to-do item\n    \u2713 destroys a to-do item\n\n\n  2 passing (100ms)\n\nJest(Contextify)\u304csandbox\u3092\u4f5c\u308b\u306e\u3088\u308a\u3082\u6bd4\u8f03\u7684\u4f4e\u30b3\u30b9\u30c8\u3067\u30c6\u30b9\u30c8\u304c\u3067\u304d\u308b\u3002\n$ time ./node_modules/.bin/mocha --require espower-coffee/guess test/stores/TodoStore.test.coffee\n./node_modules/.bin/mocha --require espower-coffee/guess   0.69s user 0.09s system 99% cpu 0.787 total\n\n$ time ./node_modules/.bin/jest js/stores/__tests__/TodoStore-test.js\n./node_modules/.bin/jest js/stores/__tests__/TodoStore-test.js  0.42s user 0.08s system 44% cpu 1.119 total\n\n[Testing Flux Applications](http://facebook.github.io/react/blog/2014/09/24/testing-flux-applications.html)\u3067\u306f\u3001Store\u3092\u30c6\u30b9\u30c8\u3059\u308b\u969b\u306e\u30c8\u30ea\u30c3\u30af\u3068\u3057\u3066Jest\u4e0a\u3067\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u3002\n\n```js\nvar mockRegister = MyDispatcher.register;\nvar mockRegisterInfo = mockRegister.mock;\nvar callsToRegister = mockRegisterInfo.calls;\nvar firstCall = callsToRegister[0];\nvar firstArgument = firstCall[0];\nvar callback = firstArgument;\n```\n\nJest\u306f\u57fa\u672c\u5168\u3066\u304c\u30e2\u30c3\u30af\u3055\u308c\u308b\u306e\u3067\u3001\u8981\u306f\u300cDispatcher\u306e`register`\u306b\u4e0e\u3048\u3089\u308c\u305f\u5f15\u6570\u304c\u89b3\u6e2c\u3067\u304d\u308b\u304b\u3089\u3001Store\u306ecallback\u3092\u6355\u6349\u3057\u3066\u30c6\u30b9\u30c8\u3057\u305f\u3044\u5185\u5bb9\u306b\u5408\u308f\u305b\u3066\u9069\u5b9c\u5b9f\u884c\u305b\u3088\u300d\u3068\u3044\u3046\u3053\u3068\u3067\u3042\u308b\u3002\n\n\u3053\u306e\u52d5\u4f5c\u3001Sinon\u306eSpy\u306b\u3082\u540c\u3058\u3088\u3046\u306a\u5b9f\u88c5\u304c\u3042\u308b\u3002`spy.firstCall`\u3084`spy.getCall`\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u304a\u308a\u3001n\u5ea6\u76ee\u306b\u547c\u3070\u308c\u305f\u969b\u306b\u6e21\u3055\u308c\u305f\u5f15\u6570\u3092\u53d6\u5f97\u3067\u304d\u308b\u3002\u4f8b\u3048\u3070\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3067MyStore\u5185\u90e8\u306b\u5b9a\u7fa9\u3057\u305fcallback\u306f\u53d6\u5f97\u3067\u304d\u308b\u3002\n\n```coffeescript\nregister = spy require('../../src/dispatcher/AppDispatcher'), 'register'\nMyStore = require '../../src/stores/MyStore'\ncallback = register.lastCall.args[0]\n```\n\nStore\u306f\u5e38\u306b\u5358\u4e00\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u3042\u308b\u3053\u3068\u3092\u5f37\u5236\u3055\u308c\u308b\u306e\u3067\u3001\u30c6\u30b9\u30c8\u3054\u3068\u306b\u72b6\u614b\u3092\u30ea\u30bb\u30c3\u30c8\u3057\u306a\u3044\u3068\u524d\u306e\u72b6\u614b\u3092\u4fdd\u6301\u3057\u3066\u3057\u307e\u3046\u3002Store\u306e\u72b6\u614b\u3092\u76f4\u63a5\u5909\u3048\u305f\u308asetter\u3092\u4f5c\u308b\u306e\u306f\u7981\u3058\u624b\u306a\u306e\u3067\u3001\u30c6\u30b9\u30c8\u3054\u3068\u306b`require`\u304c\u65b0\u305f\u306aStore\u3092\u8fd4\u3059\u3088\u3046\u306b\u3059\u308b\u3002\n\n`require`\u3059\u308b\u3068\u901a\u5e38\u306e\u5834\u5408\u7d50\u679c\u304c`require.cache`\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u308b\u306e\u3067\u3001`require.cache`\u304b\u3089\u524a\u9664\u3059\u308b\u3053\u3068\u3067\u3001\u518d\u5ea6`require`\u3057\u305f\u3068\u304d\u65b0\u3057\u3044Store\u304c\u8fd4\u3063\u3066\u304f\u308b\u3088\u3046\u306b\u3067\u304d\u308b\u3002\n\n```coffeescript\ndelete require.cache[require.resolve '../../src/stores/MyStore']\n```\n\n## \u5b9f\u969b\u306b\u52d5\u304b\u3059\n\n[Jest\u3067\u66f8\u304b\u308c\u305fFlux TodoMVC\u306e\u30c6\u30b9\u30c8](https://github.com/facebook/flux/blob/master/examples/flux-todomvc/js/stores/__tests__/TodoStore-test.js)\u3092Mocha, power-assert\u3067\u52d5\u304f\u3088\u3046\u306b\u66f8\u304f\u3002\n\n```bash\n$ npm install mocha power-assert sinon espower-coffee --save-dev\n```\n\n```coffeescript:test/stores/TodoStore.test.coffee\nassert = require 'power-assert'\n{spy} = require 'sinon'\n\ndescribe 'TodoStore', ->\n  TodoConstants = require '../../js/constants/TodoConstants'\n  register = null\n  TodoStore = null\n  callback = null\n\n  actionTodoCreate =\n    actionType: TodoConstants.TODO_CREATE,\n    text: 'foo'\n  actionTodoDestroy =\n    actionType: TodoConstants.TODO_DESTROY,\n    id: 'replace me in test'\n\n  before ->\n    register = spy require('../../js/dispatcher/AppDispatcher'), 'register'\n\n  beforeEach ->\n    delete require.cache[require.resolve '../../js/stores/TodoStore']\n    TodoStore = require '../../js/stores/TodoStore'\n    callback = register.lastCall.args[0]\n\n  it 'creates a to-do item', ->\n    callback actionTodoCreate\n    all = do TodoStore.getAll\n    keys = Object.keys all\n    assert.equal keys.length, 1\n    assert.equal all[keys[0]].text, 'foo'\n\n  it 'destroys a to-do item', ->\n    callback actionTodoCreate\n    all = do TodoStore.getAll\n    keys = Object.keys all\n    assert.equal keys.length, 1\n    actionTodoDestroy.id = keys[0]\n    callback actionTodoDestroy\n    assert.equal all[keys[0]], undefined\n```\n\n```bash\n$ ./node_modules/.bin/mocha --require espower-coffee/guess test/**/*.test.coffee\n\n\n  TodoStore\n    \u2713 creates a to-do item\n    \u2713 destroys a to-do item\n\n\n  2 passing (100ms)\n```\n\n[Jest(Contextify)\u304csandbox\u3092\u4f5c\u308b](http://qiita.com/Misumi_Rize/items/4251f4ac993345e7ba68)\u306e\u3088\u308a\u3082\u6bd4\u8f03\u7684\u4f4e\u30b3\u30b9\u30c8\u3067\u30c6\u30b9\u30c8\u304c\u3067\u304d\u308b\u3002\n\n```bash\n$ time ./node_modules/.bin/mocha --require espower-coffee/guess test/stores/TodoStore.test.coffee\n./node_modules/.bin/mocha --require espower-coffee/guess   0.69s user 0.09s system 99% cpu 0.787 total\n\n$ time ./node_modules/.bin/jest js/stores/__tests__/TodoStore-test.js\n./node_modules/.bin/jest js/stores/__tests__/TodoStore-test.js  0.42s user 0.08s system 44% cpu 1.119 total\n```\n", "tags": ["Node.js", "flux", "reactjs", "mocha", "jest"]}