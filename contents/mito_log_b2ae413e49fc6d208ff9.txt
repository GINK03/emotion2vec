{"context": " More than 1 year has passed since last update.\n\n\u4f55\u3092\u3059\u308b\u304b\n\u524d\u56de\u3001socket.io\u3067\u30b5\u30f3\u30d7\u30eb\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\u3092\u4f5c\u308b\u8a18\u4e8b\u3092\u304b\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u305d\u308c\u3092\u5c11\u3057\u62e1\u5f35\u3057\u3066\u3001php\u304b\u3089socket.io\u306bemit\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3059\u3002\u5099\u5fd8\u3068\u3057\u3066\u66f8\u304d\u307e\u3059\u3002\n\u516c\u5f0f\u30da\u30fc\u30b8\u3067\u4e0b\u8a18\u306e\u3088\u3046\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3057\u305f\u3002\n\nSending messages from the outside-world\nIn some cases, you might want to emit events to sockets in Socket.IO namespaces / rooms from outside the context of your Socket.IO processes.\nThere\u2019s several ways to tackle this problem, like implementing your own channel to send messages into the process.\nTo facilitate this use case, we created two modules:\n\nsocket.io-redis\nsocket.io-emitter\n\n\n\u7c21\u5358\u306b\u3044\u3046\u3068\u3001\nsocket.io\u306e\u30d7\u30ed\u30bb\u30b9\u306e\u5916\u90e8\u304b\u3089\u3001namespace\u3084room\u306b\u30a4\u30d9\u30f3\u30c8\u3092emit\u3059\u308b\u306b\u306f\u3001\u4e0b\u8a18\u306e2\u3064(socket.io-redis/socket.io-emitter)\u3092\u5b9f\u88c5\u3057\u307e\u3057\u3087\u3046\u3002\n\u3063\u3066\u3053\u3068\u3089\u3057\u3044\u3067\u3059\u3002\u305f\u3060\u3001\u3053\u308c\u3060\u3051\u3060\u3068\u3001js\u304b\u3089\u3057\u304b\u547c\u3079\u306a\u3044\u306e\u3067\u3001ruby\u3068\u304bphp\u3067API\u66f8\u3044\u3066\u308b\u5834\u5408\u3060\u3068\u3061\u3087\u3063\u3068\u4fdd\u5b88\u6027\u60aa\u305d\u3046\u3067\u3059\u3002\u305d\u3053\u3067\u3001\u4e0b\u8a18\u306e\u30c4\u30fc\u30eb\u304c\u4f7f\u3048\u305d\u3046\u3067\u3059\u3002\n\nsocket.io-php-emitter\nA PHP implementation of socket.io-emitter\n\nsocket.io-emitter\u306ephp\u5b9f\u88c5\u7248\u3092\u66f8\u3044\u3066\u304f\u308c\u305f\u65b9\u304c\u3044\u305f\u306e\u3067\u3001\u4eca\u56de\u306f\u3053\u308c\u3092\u4f7f\u3063\u3066\u3001php\u7d4c\u7531\u3067socket.io\u306e\u7279\u5b9a\u306eroom\u306bemit\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u4eca\u56de\u306e\u74b0\u5883\n\nec2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 (Amazon Linux AMI release 2014.09)\nApache (v2.2.29)\nPHP (v5.3.29)\nredis (v2.8.19)\nphpredis (v2.2.5)\nsocket.io (v1.3.5)\nsocket.io-emitter (v0.2.0)\nsocket.io-redis (v0.1.4)\n\n\n\u624b\u9806\n\u203b httpd\u3001php\u74b0\u5883\u306f\u4e88\u3081\u6e96\u5099\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u3068\u3057\u307e\u3059\n\nredis\u95a2\u9023\u30c4\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068redis\u30b5\u30fc\u30d0\u306e\u8d77\u52d5\nsocket.io-php-emitter\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb(\u9014\u4e2d\u5fc5\u8981\u306b\u5fdc\u3058\u3066composer\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb)\nsocket.io-redis, socket.io-emitter\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nserver.js\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8 & node\u30b5\u30fc\u30d0\u518d\u8d77\u52d5\n\u7c21\u6613API\u3092\u7528\u610f\niOS\u5074\u306e\u30bd\u30fc\u30b9\u3082\u5c11\u3057\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\nready to go!\n\n\n1. redis\u95a2\u9023\u30c4\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068redis\u30b5\u30fc\u30d0\u306e\u8d77\u52d5\n\nredis\u672c\u4f53\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nAWS EC2\u306bredis\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\u4ee5\u524d\u306fmake\u3057\u3066\u305f\u3093\u3067\u3059\u304c\u3001yum\u3067install\u3059\u308b\u3068\u79d2\u901f\u4e14\u3064\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306a\u3069\u3082\u81ea\u52d5\u3067\u914d\u7f6e\u3057\u3066\u304f\u308c\u307e\u3057\u305f...\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\n\nredis\u5b9f\u884c\u74b0\u5883\u3092\u6574\u3048\u308b\n\u50d5\u306e\u74b0\u5883\u3060\u3068\u3001/etc/redis.conf\u306bconf\u30d5\u30a1\u30a4\u30eb\u304c\u914d\u7f6e\u3055\u308c\u307e\u3057\u305f\u3002\u4e2d\u306e\u8a2d\u5b9a\u3092\u5c11\u3057\u5909\u66f4\u3057\u307e\u3059\u3002\n37c37\n< daemonize yes\n---\n> daemonize no\n\n\u305d\u306e\u3042\u3068\u4e0b\u8a18\u306e\u3088\u3046\u306b\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n# vm.overcommit_memory=1\u3092\u73fe\u72b6\u3067\u53cd\u6620\u3055\u305b\u308b\nsysctl vm.overcommit_memory=1\n\n# \u672b\u5c3e\u306b vm.overcommit_memory = 1 \u3092\u8ffd\u52a0\nvi /etc/sysctl.conf\n\n# redis\u30ed\u30b0\u306egroup:user\u3092\u5909\u66f4\nchown redis:redis /var/log/redis/redis.log\n\n# \u5b9f\u884c\n/etc/init.d/redis start\n\n# \u5b9f\u884c\u78ba\u8a8d\nps ax | grep [r]edis\n29143 ?        Ssl    0:19 redis-server 127.0.0.1:6379 \n\n# \u30b5\u30fc\u30d0\u518d\u8d77\u52d5\u3067\u81ea\u52d5\u7684\u306b\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u306b\nchkconfig redis on\n\n# 2~5\u307e\u3067on\u306a\u3089OK\nchkconfig --list redis\n\n\u203b yum\u3067\u3044\u308c\u305f\u5834\u5408\u5b9f\u884c\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u3001\u65e2\u306b /etc/init.d/redis \u306b\u914d\u7f6e\u3055\u308c\u3066\u3044\u307e\u3057\u305f\n\u203b redis\u30b0\u30eb\u30fc\u30d7/\u30e6\u30fc\u30b6\u3082\u52dd\u624b\u306b\u8ffd\u52a0\u3055\u308c\u3066\u304a\u308a\u307e\u3057\u305f\u306e\u3067\u3053\u3053\u3067\u306f\u7701\u7565(\u3044\u3064\u306e\u307e\u306b?)\n\u203b \u53c2\u8003\u305d\u306e1: Redis\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u203b \u53c2\u8003\u305d\u306e2\uff1a\u3055\u304f\u3089\u306eVPS\u306bredis\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nphpredis\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo yum -y install php-pecl-redis --enablerepo=epel\n\n\u203b \u53c2\u8003: PHP\u3067Redis\u3092\u4f7f\u3063\u3066\u307f\u308b\n\n2. socket.io-php-emitter\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb(\u9014\u4e2d\u5fc5\u8981\u306b\u5fdc\u3058\u3066composer\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb)\n\ncomposer\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4eca\u56de\u3064\u304b\u3046\u30c4\u30fc\u30eb\u306fcomposer\u30d1\u30c3\u30b1\u30fc\u30b8\u3068\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306e\u3067\u3001\u307e\u305acomposer\u304c\u306a\u3044\u3068\u59cb\u307e\u308a\u307e\u305b\u3093\u3002\ncurl -sS https://getcomposer.org/installer | php\nmv composer.phar /usr/local/bin/composer\n# \u5fc5\u8981\u3067\u3042\u308c\u3070path\u3092bashrc\u3084zshrc\u306b\u8ffd\u52a0\n# PATH=$PATH:/usr/local/bin\n# vi ~.bashrc\n\n\u53c2\u8003\uff1avagrant+CentOS\u306bcomposer\u3092\u5c0e\u5165\n\nsocket.io-php-emitter\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# documentroot\u3078\u79fb\u52d5\ncd /var/www/html\n\n# \u30bd\u30fc\u30b9\u3092\u843d\u3068\u3059 & \u30bd\u30fc\u30b9\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u79fb\u52d5\ngit clone https://github.com/rase-/socket.io-php-emitter.git\ncd socket.io-php-emitter/\n\n# composer\u3067\u4e00\u62ec\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# (\u81ea\u5206\u306e\u74b0\u5883\u3067\u306f\u3001the requested PHP extension dom is missing from your system\u3063\u3066\u3044\u3046\u30a8\u30e9\u30fc\u304c\u3067\u305f\u306e\u3067\u3001\u4e00\u65e6 yum install php-xml \u3057\u3066\u518d\u5ea6 composer install\u3057\u307e\u3057\u305f)\ncomposer install\n\n\n3. socket.io-redis, socket.io-emitter\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# server.js\u304c\u3042\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u307e\u3067\u79fb\u52d5\ncd /path/to/server.js\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nnpm install socket.io-redis\nnpm install socket.io-emitter\n\n\n4. server.js\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8 & node\u30b5\u30fc\u30d0\u518d\u8d77\u52d5\n# 2,3\u884c\u76ee\u306b\u4e0b\u8a18\u3092\u8ffd\u52a0\n1a2,3\n> var redis = require('socket.io-redis');\n> var adapter = io.adapter(redis({ host: '127.0.0.1', port: 6379 }));\n\n# node-server\u518d\u5ea6\u5b9f\u884c\nnode server\n\n\n\n5. \u7c21\u6613API\u3092\u7528\u610f\n\u4f8b\u3048\u3070\u3053\u3093\u306a\u611f\u3058\u306e\u7c21\u6613API\u3092\u30b5\u30fc\u30d0\u5074\u306b\u7528\u610f\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\nSIOChatEmitter.php\n<?php\n    header('Content-type: application/json');\n\n    $json_string = file_get_contents('php://input');\n    $json = json_decode($json_string);\n\n    $sepStr = ',';\n\n    $param = $json->param;\n    $params = split($sepStr, $param);\n    $room = $params[0];\n\n    if(empty($room) || empty($param)){\n        exit;\n    }\n    //echo 'post to' . $room;\n\n    require('src/Emitter.php');\n    $redis = new \\Redis();\n    $redis->connect('127.0.0.1', '6379');\n    $emitter = new SocketIO\\Emitter($redis);\n    $emitter->in($room)->emit('update', $param);\n\n    echo json_encode(array('param' => $param));\n?>\n\n\n\n6. iOS\u5074\u306e\u30bd\u30fc\u30b9\u3082\u5c11\u3057\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n\u3068\u308a\u3042\u3048\u305a\u3001\u30cb\u30c3\u30af\u30cd\u30fc\u30e0\u3092\u5909\u66f4\u3059\u308b\u3068\u3001http POST\u30dd\u30b9\u30c8\u304c\u98db\u3076\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u8a72\u5f53\u7b87\u6240\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\nChatViewController.m(289\u884c\u76ee)\nAFHTTPRequestOperationManager* manager = [AFHTTPRequestOperationManager manager];\nmanager.responseSerializer = [AFJSONResponseSerializer serializer];\nmanager.requestSerializer = [AFJSONRequestSerializer serializer];\nNSString *postFilePath = [NSString stringWithFormat:@\"%@/%@\",\nkHTTPHostName, kEmitFilePath];\n\n[manager POST:postFilePath\n   parameters:@{@\"param\":[param paramStr]}\n      success:^(AFHTTPRequestOperation *operation, id responseObject)\n {\n     NSLog(@\"posted\");\n } failure:^(AFHTTPRequestOperation *operation, NSError *error)\n {\n     NSLog(@\"Error: %@\", error);\n }];\n\n\n\u203b \u30bd\u30fc\u30b9\u306f\u4e0b\u8a18\u306b\u304a\u3044\u3066\u307e\u3059\u3002\nhttps://github.com/mitolog/SIOChat\n\n7. ready to go!\n6\u306e\u30bd\u30fc\u30b9\u3092\u5b9f\u884c\u3057\u3066\u30011\u3064\u306eroom\u306b2\u540d\u4ee5\u4e0a\u53c2\u52a0\u3057\u3066\u307f\u307e\u3059\u3002\u3067\u3001\u81ea\u5206\u306enickname\u3092\u5909\u66f4\u3057\u3066\u307f\u308b\u3068\u3001room\u5185\u306e\u4ed6\u306e\u30e1\u30f3\u30d0\u30fc\u306b \u300cchanged nickname from \"hogehoge\" to \"fugafuga\"\u300d\u3068\u3044\u3046\u611f\u3058\u3067\u30e1\u30c3\u30bb\u304c\u98db\u3073\u307e\u3059\u3002\n\n\u611f\u60f3\n\n\u6982\u5ff5\u7684\u306b\u306f\u306a\u3093\u3068\u306a\u304f\u5206\u304b\u308b\u306e\u3060\u3051\u3069\u3001\u4e2d\u8eab\u304c\u305d\u3093\u306a\u306b\u7406\u89e3\u3067\u304d\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u8981\u52c9\u5f37\n\u30b9\u30c6\u30ad\u306a\u52c9\u5f37\u4f1a\u304c\u3042\u3063\u305f\u3089\u662f\u975e\u3044\u304d\u305f\u3044\n\n\n(\u8a71\u305d\u308c\u308b\u3051\u3069)\u52c9\u5f37\u306b\u306a\u308a\u305d\u3046\u306a\u3082\u306e\n\n\u4eca\u66f4\u3060\u3051\u3069Socket.io\u306b\u3064\u3044\u3066\u307e\u3068\u3081\u3066\u307f\u308b\nSocket.IO, Redis\u3092\u4f7f\u7528\u3057\u5404\u30b2\u30fc\u30e0\u9593\u3067\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u3059\u308b\u30b7\u30b9\u30c6\u30e0\n\u4eca\u65e5\u304b\u3089\u59cb\u3081\u308bNode.js\u30b3\u30fc\u30c9\u30ea\u30fc\u30c7\u30a3\u30f3\u30b0 - libuv / V8 JavaScript\u30a8\u30f3\u30b8\u30f3 / Node.js\u306b\u3088\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9f\u884c\n\n\u4ee5\u4e0a\u3067\u3057\u305f\u301c\u3002\n# \u4f55\u3092\u3059\u308b\u304b\n\u524d\u56de\u3001[socket.io\u3067\u30b5\u30f3\u30d7\u30eb\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\u3092\u4f5c\u308b\u8a18\u4e8b](http://qiita.com/mito_log/items/a6207d2b43189687d750)\u3092\u304b\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u305d\u308c\u3092\u5c11\u3057\u62e1\u5f35\u3057\u3066\u3001php\u304b\u3089socket.io\u306bemit\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3059\u3002\u5099\u5fd8\u3068\u3057\u3066\u66f8\u304d\u307e\u3059\u3002\n\n[\u516c\u5f0f\u30da\u30fc\u30b8](http://socket.io/docs/rooms-and-namespaces/)\u3067\u4e0b\u8a18\u306e\u3088\u3046\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3057\u305f\u3002\n\n> **Sending messages from the outside-world**\nIn some cases, you might want to emit events to sockets in Socket.IO namespaces / rooms from outside the context of your Socket.IO processes.\n\n>There\u2019s several ways to tackle this problem, like implementing your own channel to send messages into the process.\n\n>To facilitate this use case, we created two modules:\n\n> - [socket.io-redis](http://github.com/automattic/socket.io-redis)\n> - [socket.io-emitter](http://github.com/automattic/socket.io-emitter)\n\n\u7c21\u5358\u306b\u3044\u3046\u3068\u3001\n`socket.io\u306e\u30d7\u30ed\u30bb\u30b9\u306e\u5916\u90e8\u304b\u3089\u3001namespace\u3084room\u306b\u30a4\u30d9\u30f3\u30c8\u3092emit\u3059\u308b\u306b\u306f\u3001\u4e0b\u8a18\u306e2\u3064(socket.io-redis/socket.io-emitter)\u3092\u5b9f\u88c5\u3057\u307e\u3057\u3087\u3046\u3002`\n\u3063\u3066\u3053\u3068\u3089\u3057\u3044\u3067\u3059\u3002\u305f\u3060\u3001\u3053\u308c\u3060\u3051\u3060\u3068\u3001js\u304b\u3089\u3057\u304b\u547c\u3079\u306a\u3044\u306e\u3067\u3001ruby\u3068\u304bphp\u3067API\u66f8\u3044\u3066\u308b\u5834\u5408\u3060\u3068\u3061\u3087\u3063\u3068\u4fdd\u5b88\u6027\u60aa\u305d\u3046\u3067\u3059\u3002\u305d\u3053\u3067\u3001\u4e0b\u8a18\u306e\u30c4\u30fc\u30eb\u304c\u4f7f\u3048\u305d\u3046\u3067\u3059\u3002\n\n> [socket.io-php-emitter](https://github.com/rase-/socket.io-php-emitter)\n> *A PHP implementation of socket.io-emitter*\n\nsocket.io-emitter\u306ephp\u5b9f\u88c5\u7248\u3092\u66f8\u3044\u3066\u304f\u308c\u305f\u65b9\u304c\u3044\u305f\u306e\u3067\u3001\u4eca\u56de\u306f\u3053\u308c\u3092\u4f7f\u3063\u3066\u3001php\u7d4c\u7531\u3067socket.io\u306e\u7279\u5b9a\u306eroom\u306bemit\u3057\u3066\u307f\u307e\u3059\u3002\n\n# \u4eca\u56de\u306e\u74b0\u5883\n - ec2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 (Amazon Linux AMI release 2014.09)\n - Apache (v2.2.29)\n - PHP (v5.3.29)\n - redis (v2.8.19)\n - phpredis (v2.2.5)\n - socket.io (v1.3.5)\n - socket.io-emitter (v0.2.0)\n - socket.io-redis (v0.1.4)\n\n# \u624b\u9806\n\u203b httpd\u3001php\u74b0\u5883\u306f\u4e88\u3081\u6e96\u5099\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u3068\u3057\u307e\u3059\n\n1. redis\u95a2\u9023\u30c4\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068redis\u30b5\u30fc\u30d0\u306e\u8d77\u52d5\n2. socket.io-php-emitter\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb(\u9014\u4e2d\u5fc5\u8981\u306b\u5fdc\u3058\u3066composer\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb)\n3. socket.io-redis, socket.io-emitter\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n4. server.js\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8 & node\u30b5\u30fc\u30d0\u518d\u8d77\u52d5\n5. \u7c21\u6613API\u3092\u7528\u610f\n6. iOS\u5074\u306e\u30bd\u30fc\u30b9\u3082\u5c11\u3057\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n7. ready to go!\n\n## 1. redis\u95a2\u9023\u30c4\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068redis\u30b5\u30fc\u30d0\u306e\u8d77\u52d5\n### redis\u672c\u4f53\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n[AWS EC2\u306bredis\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b](http://qiita.com/stoshiya/items/b8c1d2eb41770f92ffcf)\n\u4ee5\u524d\u306fmake\u3057\u3066\u305f\u3093\u3067\u3059\u304c\u3001yum\u3067install\u3059\u308b\u3068\u79d2\u901f\u4e14\u3064\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306a\u3069\u3082\u81ea\u52d5\u3067\u914d\u7f6e\u3057\u3066\u304f\u308c\u307e\u3057\u305f...\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\n\n### redis\u5b9f\u884c\u74b0\u5883\u3092\u6574\u3048\u308b\n\u50d5\u306e\u74b0\u5883\u3060\u3068\u3001`/etc/redis.conf`\u306bconf\u30d5\u30a1\u30a4\u30eb\u304c\u914d\u7f6e\u3055\u308c\u307e\u3057\u305f\u3002\u4e2d\u306e\u8a2d\u5b9a\u3092\u5c11\u3057\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```bash\n37c37\n< daemonize yes\n---\n> daemonize no\n```\n\n\u305d\u306e\u3042\u3068\u4e0b\u8a18\u306e\u3088\u3046\u306b\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\n```bash\n# vm.overcommit_memory=1\u3092\u73fe\u72b6\u3067\u53cd\u6620\u3055\u305b\u308b\nsysctl vm.overcommit_memory=1\n\n# \u672b\u5c3e\u306b vm.overcommit_memory = 1 \u3092\u8ffd\u52a0\nvi /etc/sysctl.conf\n\n# redis\u30ed\u30b0\u306egroup:user\u3092\u5909\u66f4\nchown redis:redis /var/log/redis/redis.log\n\n# \u5b9f\u884c\n/etc/init.d/redis start\n\n# \u5b9f\u884c\u78ba\u8a8d\nps ax | grep [r]edis\n29143 ?        Ssl    0:19 redis-server 127.0.0.1:6379 \n\n# \u30b5\u30fc\u30d0\u518d\u8d77\u52d5\u3067\u81ea\u52d5\u7684\u306b\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u306b\nchkconfig redis on\n\n# 2~5\u307e\u3067on\u306a\u3089OK\nchkconfig --list redis\n```\n\n\u203b yum\u3067\u3044\u308c\u305f\u5834\u5408\u5b9f\u884c\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u3001\u65e2\u306b `/etc/init.d/redis` \u306b\u914d\u7f6e\u3055\u308c\u3066\u3044\u307e\u3057\u305f\n\u203b redis\u30b0\u30eb\u30fc\u30d7/\u30e6\u30fc\u30b6\u3082\u52dd\u624b\u306b\u8ffd\u52a0\u3055\u308c\u3066\u304a\u308a\u307e\u3057\u305f\u306e\u3067\u3053\u3053\u3067\u306f\u7701\u7565(\u3044\u3064\u306e\u307e\u306b?)\n\u203b \u53c2\u8003\u305d\u306e1: [Redis\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb](http://qiita.com/i2bskn/items/42cbf6bc52f9cfa406bb)\n\u203b \u53c2\u8003\u305d\u306e2\uff1a[\u3055\u304f\u3089\u306eVPS\u306bredis\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb](http://9ensan.com/blog/server/sakura-vps-redis/)\n\n### phpredis\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\nsudo yum -y install php-pecl-redis --enablerepo=epel\n```\n\u203b \u53c2\u8003: [PHP\u3067Redis\u3092\u4f7f\u3063\u3066\u307f\u308b](http://d.hatena.ne.jp/yk5656/20140923/1411889810)\n\n## 2. socket.io-php-emitter\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb(\u9014\u4e2d\u5fc5\u8981\u306b\u5fdc\u3058\u3066composer\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb)\n### composer\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4eca\u56de\u3064\u304b\u3046\u30c4\u30fc\u30eb\u306fcomposer\u30d1\u30c3\u30b1\u30fc\u30b8\u3068\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306e\u3067\u3001\u307e\u305acomposer\u304c\u306a\u3044\u3068\u59cb\u307e\u308a\u307e\u305b\u3093\u3002\n\n```bash\ncurl -sS https://getcomposer.org/installer | php\nmv composer.phar /usr/local/bin/composer\n# \u5fc5\u8981\u3067\u3042\u308c\u3070path\u3092bashrc\u3084zshrc\u306b\u8ffd\u52a0\n# PATH=$PATH:/usr/local/bin\n# vi ~.bashrc\n```\n\n\u53c2\u8003\uff1a[vagrant+CentOS\u306bcomposer\u3092\u5c0e\u5165](http://qiita.com/TetsuTaka/items/1431bb202e1a00777f82)\n\n### socket.io-php-emitter\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\n# documentroot\u3078\u79fb\u52d5\ncd /var/www/html\n\n# \u30bd\u30fc\u30b9\u3092\u843d\u3068\u3059 & \u30bd\u30fc\u30b9\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u79fb\u52d5\ngit clone https://github.com/rase-/socket.io-php-emitter.git\ncd socket.io-php-emitter/\n\n# composer\u3067\u4e00\u62ec\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# (\u81ea\u5206\u306e\u74b0\u5883\u3067\u306f\u3001the requested PHP extension dom is missing from your system\u3063\u3066\u3044\u3046\u30a8\u30e9\u30fc\u304c\u3067\u305f\u306e\u3067\u3001\u4e00\u65e6 yum install php-xml \u3057\u3066\u518d\u5ea6 composer install\u3057\u307e\u3057\u305f)\ncomposer install\n```\n\n## 3. socket.io-redis, socket.io-emitter\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\n# server.js\u304c\u3042\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u307e\u3067\u79fb\u52d5\ncd /path/to/server.js\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nnpm install socket.io-redis\nnpm install socket.io-emitter\n```\n## 4. server.js\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8 & node\u30b5\u30fc\u30d0\u518d\u8d77\u52d5\n\n```bash\n# 2,3\u884c\u76ee\u306b\u4e0b\u8a18\u3092\u8ffd\u52a0\n1a2,3\n> var redis = require('socket.io-redis');\n> var adapter = io.adapter(redis({ host: '127.0.0.1', port: 6379 }));\n\n# node-server\u518d\u5ea6\u5b9f\u884c\nnode server\n\n```\n\n## 5. \u7c21\u6613API\u3092\u7528\u610f\n\u4f8b\u3048\u3070\u3053\u3093\u306a\u611f\u3058\u306e\u7c21\u6613API\u3092\u30b5\u30fc\u30d0\u5074\u306b\u7528\u610f\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```php:SIOChatEmitter.php\n<?php\n    header('Content-type: application/json');\n\n    $json_string = file_get_contents('php://input');\n    $json = json_decode($json_string);\n\n    $sepStr = ',';\n\n    $param = $json->param;\n    $params = split($sepStr, $param);\n    $room = $params[0];\n\n    if(empty($room) || empty($param)){\n        exit;\n    }\n    //echo 'post to' . $room;\n\n    require('src/Emitter.php');\n    $redis = new \\Redis();\n    $redis->connect('127.0.0.1', '6379');\n    $emitter = new SocketIO\\Emitter($redis);\n    $emitter->in($room)->emit('update', $param);\n\n    echo json_encode(array('param' => $param));\n?>\n```\n\n## 6. iOS\u5074\u306e\u30bd\u30fc\u30b9\u3082\u5c11\u3057\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n\u3068\u308a\u3042\u3048\u305a\u3001\u30cb\u30c3\u30af\u30cd\u30fc\u30e0\u3092\u5909\u66f4\u3059\u308b\u3068\u3001http POST\u30dd\u30b9\u30c8\u304c\u98db\u3076\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u8a72\u5f53\u7b87\u6240\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n```objc:ChatViewController.m(289\u884c\u76ee)\nAFHTTPRequestOperationManager* manager = [AFHTTPRequestOperationManager manager];\nmanager.responseSerializer = [AFJSONResponseSerializer serializer];\nmanager.requestSerializer = [AFJSONRequestSerializer serializer];\nNSString *postFilePath = [NSString stringWithFormat:@\"%@/%@\",\nkHTTPHostName, kEmitFilePath];\n\n[manager POST:postFilePath\n   parameters:@{@\"param\":[param paramStr]}\n      success:^(AFHTTPRequestOperation *operation, id responseObject)\n {\n     NSLog(@\"posted\");\n } failure:^(AFHTTPRequestOperation *operation, NSError *error)\n {\n     NSLog(@\"Error: %@\", error);\n }];\n```\n\n\u203b \u30bd\u30fc\u30b9\u306f\u4e0b\u8a18\u306b\u304a\u3044\u3066\u307e\u3059\u3002\n[https://github.com/mitolog/SIOChat](https://github.com/mitolog/SIOChat)\n\n## 7. ready to go!\n6\u306e\u30bd\u30fc\u30b9\u3092\u5b9f\u884c\u3057\u3066\u30011\u3064\u306eroom\u306b2\u540d\u4ee5\u4e0a\u53c2\u52a0\u3057\u3066\u307f\u307e\u3059\u3002\u3067\u3001\u81ea\u5206\u306enickname\u3092\u5909\u66f4\u3057\u3066\u307f\u308b\u3068\u3001room\u5185\u306e\u4ed6\u306e\u30e1\u30f3\u30d0\u30fc\u306b \u300cchanged nickname from \"hogehoge\" to \"fugafuga\"\u300d\u3068\u3044\u3046\u611f\u3058\u3067\u30e1\u30c3\u30bb\u304c\u98db\u3073\u307e\u3059\u3002\n\n# \u611f\u60f3\n - \u6982\u5ff5\u7684\u306b\u306f\u306a\u3093\u3068\u306a\u304f\u5206\u304b\u308b\u306e\u3060\u3051\u3069\u3001\u4e2d\u8eab\u304c\u305d\u3093\u306a\u306b\u7406\u89e3\u3067\u304d\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u8981\u52c9\u5f37\n - \u30b9\u30c6\u30ad\u306a\u52c9\u5f37\u4f1a\u304c\u3042\u3063\u305f\u3089\u662f\u975e\u3044\u304d\u305f\u3044\n \n# (\u8a71\u305d\u308c\u308b\u3051\u3069)\u52c9\u5f37\u306b\u306a\u308a\u305d\u3046\u306a\u3082\u306e\n - [\u4eca\u66f4\u3060\u3051\u3069Socket.io\u306b\u3064\u3044\u3066\u307e\u3068\u3081\u3066\u307f\u308b](http://blog.wnotes.net/blog/article/nodejs-socketio-summary)\n - [Socket.IO, Redis\u3092\u4f7f\u7528\u3057\u5404\u30b2\u30fc\u30e0\u9593\u3067\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u3059\u308b\u30b7\u30b9\u30c6\u30e0](https://www.cyberagent.co.jp/techinfo/techreport/report/id=8858\n)\n - [\u4eca\u65e5\u304b\u3089\u59cb\u3081\u308bNode.js\u30b3\u30fc\u30c9\u30ea\u30fc\u30c7\u30a3\u30f3\u30b0 - libuv / V8 JavaScript\u30a8\u30f3\u30b8\u30f3 / Node.js\u306b\u3088\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9f\u884c](http://blog.otakumode.com/2014/08/14/nodejs-code-reading-startup-script/)\n \n\u4ee5\u4e0a\u3067\u3057\u305f\u301c\u3002\n", "tags": ["Socket.io", "JavaScript", "PHP", "iOS"]}