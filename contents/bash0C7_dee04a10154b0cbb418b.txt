{"context": " More than 1 year has passed since last update.emit\u3067\u306fQueue\u306bpush\u3059\u308b\u3060\u3051\u306b\u3057\u3066\u3001\u5225\u30b9\u30ec\u30c3\u30c9\u3067Queue\u304b\u3089pop\u3059\u308b\u5f62\u3092\u3068\u308c\u3070\u3001\u884c\u5100\u3088\u304f\u9593\u9694\u3092\u7a7a\u3051\u306a\u304c\u3089Web\u306eAPI\u3092\u53e9\u3051\u308b\u3068\u8003\u3048\u305f\u6b21\u7b2c\u3002\n\u4ed6\u306b\u306f\u3069\u3093\u306a\u89e3\u304c\u3042\u308b\u3060\u308d\u3046\u3002\n\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n    def configure(conf)\n      super\n      @q = Queue.new\n    end\n\n    def start\n      super\n      @thread = Thread.new(&method(:post))\n    end\n\n    def shutdown\n      super\n      Thread.kill(@thread)\n    end\n\n    def emit(tag, es, chain)\n      es.each {|time, record|\n        param = OpenStruct.new\n        param.tag = tag\n        param.time = time\n        param.record = record\n\n        @q.push param\n      }\n\n      chain.next\n    end\n\n    private\n\n    def post\n      loop do\n        param = @q.pop\n        tag = param.tag\n        time = param.time\n        record = param.record\n\n        #Web\u306eAPI\u3092\u53e9\u304f\n        HTTParty.post(@web_api_url, :body => \"#{tag},#{param},#{time},#{record}\")\n        sleep(1)\n      end\n\n\n\u5229\u7528\u4f8b\nhttps://github.com/bash0C7/fluent-plugin-idobata/blob/d35eeed4e5a7390e4fa0044aa3b9512a4eff37bd/lib/fluent/plugin/out_idobata.rb#L55\n\n\u3053\u306e\u3084\u308a\u65b9\u306b\u3064\u3044\u3066\nInput\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3053\u306e\u3088\u3046\u306a\u3084\u308a\u65b9\u3092\u3088\u304f\u898b\u307e\u3059\u3002\n\u4e0a\u8a18\u306e\u4f8b\u306f\u56fa\u5b9a\u5024\u3067sleep(1)\u3068\u3057\u307e\u3057\u305f\u304c\u3001\u5b9f\u969b\u306b\u306fpost_interval\u3068\u304b\u306e\u540d\u524d\u3067config\u3067\u9593\u9694\u3092\u6307\u5b9a\u3067\u304d\u308b\u3068\u3044\u3044\u3067\u3057\u3087\u3046\u3002\nemit\u3067\u306fQueue\u306bpush\u3059\u308b\u3060\u3051\u306b\u3057\u3066\u3001\u5225\u30b9\u30ec\u30c3\u30c9\u3067Queue\u304b\u3089pop\u3059\u308b\u5f62\u3092\u3068\u308c\u3070\u3001\u884c\u5100\u3088\u304f\u9593\u9694\u3092\u7a7a\u3051\u306a\u304c\u3089Web\u306eAPI\u3092\u53e9\u3051\u308b\u3068\u8003\u3048\u305f\u6b21\u7b2c\u3002\n\n\u4ed6\u306b\u306f\u3069\u3093\u306a\u89e3\u304c\u3042\u308b\u3060\u308d\u3046\u3002\n\n## \u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n\n```rb\n    def configure(conf)\n      super\n      @q = Queue.new\n    end\n\n    def start\n      super\n      @thread = Thread.new(&method(:post))\n    end\n\n    def shutdown\n      super\n      Thread.kill(@thread)\n    end\n\n    def emit(tag, es, chain)\n      es.each {|time, record|\n        param = OpenStruct.new\n        param.tag = tag\n        param.time = time\n        param.record = record\n\n        @q.push param\n      }\n\n      chain.next\n    end\n\n    private\n    \n    def post\n      loop do\n        param = @q.pop\n        tag = param.tag\n        time = param.time\n        record = param.record\n        \n        #Web\u306eAPI\u3092\u53e9\u304f\n        HTTParty.post(@web_api_url, :body => \"#{tag},#{param},#{time},#{record}\")\n        sleep(1)\n      end\n```\n\n## \u5229\u7528\u4f8b\n\nhttps://github.com/bash0C7/fluent-plugin-idobata/blob/d35eeed4e5a7390e4fa0044aa3b9512a4eff37bd/lib/fluent/plugin/out_idobata.rb#L55\n\n## \u3053\u306e\u3084\u308a\u65b9\u306b\u3064\u3044\u3066\n\nInput\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3053\u306e\u3088\u3046\u306a\u3084\u308a\u65b9\u3092\u3088\u304f\u898b\u307e\u3059\u3002\n\u4e0a\u8a18\u306e\u4f8b\u306f\u56fa\u5b9a\u5024\u3067sleep(1)\u3068\u3057\u307e\u3057\u305f\u304c\u3001\u5b9f\u969b\u306b\u306fpost_interval\u3068\u304b\u306e\u540d\u524d\u3067config\u3067\u9593\u9694\u3092\u6307\u5b9a\u3067\u304d\u308b\u3068\u3044\u3044\u3067\u3057\u3087\u3046\u3002\n", "tags": ["fluentd", "Ruby"]}