{"context": "\n\n\u6982\u8981\nApache \u306e\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u5171\u901a\u5316\u3067\u304d\u308b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\u3068\u305d\u306e\u5404\u9805\u76ee\u306b\u3064\u3044\u3066\u307e\u3068\u3081\u305f\u3002\n\n\u8a2d\u5b9a\u4f8b\n\n\u5fc5\u9808\u8a2d\u5b9a\ncat << _EOF_ > /etc/httpd/conf.d/security.conf\n# \u30d0\u30fc\u30b8\u30e7\u30f3\u60c5\u5831\u306e\u96a0\u853d\nServerTokens Prod \nHeader unset X-Powered-By\n# httpoxy \u5bfe\u7b56\nRequestHeader unset Proxy\n# \u30af\u30ea\u30c3\u30af\u30b8\u30e3\u30c3\u30ad\u30f3\u30b0\u5bfe\u7b56\nHeader append X-Frame-Options SAMEORIGIN\n# XSS\u5bfe\u7b56\nHeader set X-XSS-Protection \"1; mode=block\"\nHeader set X-Content-Type-Options nosniff\n# XST\u5bfe\u7b56\nTraceEnable Off\n\n<Directory /var/www/html>\n    # .htaccess \u306e\u6709\u52b9\u5316\n    AllowOverride All\n    # \u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u51fa\u529b\u306e\u7981\u6b62\n    Options -Indexes\n    # Apache 2.2\u4ee5\u524d\u306e\u5bfe\u7b56\n    <IfVersion < 2.3>\n        # \u30d0\u30fc\u30b8\u30e7\u30f3\u60c5\u5831\u306e\u96a0\u853d\n        ServerSignature Off\n        # ETag\u306einode\u60c5\u5831\u306e\u96a0\u853d\n        FileETag MTime Size\n    </IfVersion>\n</Directory>\n\n<Directory \"/var/www/cgi-bin\">\n    <IfVersion < 2.3>\n        ServerSignature Off\n        FileETag MTime Size\n    </IfVersion>\n</Directory>\n_EOF_\n\n\nCentOS7\ncat /dev/null > /etc/httpd/conf.d/autoindex.conf ;\ncat /dev/null > /etc/httpd/conf.d/welcome.conf ;\n\n\n\n\u6ce8\u610f\u4e8b\u9805\n\n\u5916\u90e8\u30b5\u30a4\u30c8\u304b\u3089iframe\u3067\u547c\u3073\u51fa\u3057\u3067\u304d\u306a\u304f\u306a\u308b\nApache 2.2 \u306e\u5834\u5408 ServerSignature \u306f Directory \u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u5185\u3067\u6307\u5b9a\u3057\u306a\u3044\u3068\u4e0a\u66f8\u304d\u3055\u308c\u306a\u3044\u3002\n\u73fe\u72b6\u306e\u4e0a\u8a18\u8a2d\u5b9a\u3067\u306f Apache 2.2 \u3067\u4ee5\u4e0b\u304c\u4e0a\u66f8\u304d\u3055\u308c\u306a\u3044\n\n\nOptions -Indexes\n<Directory \"/var/www/cgi-bin\">\n\n\n\n\n\u4efb\u610f\u8a2d\u5b9a\ncat << _EOF_ > /etc/httpd/conf.d/security-strict.conf\n# DoS \u653b\u6483\u5bfe\u7b56\nLimitRequestBody 10485760\nLimitRequestFields 20\n# slowloris \u5bfe\u7b56\nRequestReadTimeout header=20-40,MinRate=500 body=20,MinRate=500\n\n# HTTP\u30e1\u30bd\u30c3\u30c9\u306e\u5236\u9650\n<Directory /var/www/html>\n    <IfVersion > 2.4>\n        Require method GET POST\n    </IfVersion>\n    <IfVersion < 2.3>\n        <Limit GET POST>\n            Order allow,deny\n            Allow from all\n        </Limit>\n        <LimitExcept GET POST>\n            Order deny,allow\n            Deny from all\n        </LimitExcept>\n    </IfVersion>\n</Directory>\n\n<Directory \"/var/www/cgi-bin\">\n    <IfVersion > 2.4>\n        Require all denied\n    </IfVersion>\n    <IfVersion < 2.3>\n        Order allow,deny\n        Deny from all\n    </IfVersion>\n</Directory>\n_EOF_\n\n\n\u6ce8\u610f\u4e8b\u9805\n\nGET/POST \u4ee5\u5916\u4f7f\u3048\u306a\u304f\u306a\u308b\ncgi-bin \u304c\u4f7f\u3048\u306a\u304f\u306a\u308b\n\u73fe\u72b6\u306e\u4e0a\u8a18\u8a2d\u5b9a\u3067\u306f Apache 2.2 \u3067 <Directory \"/var/www/cgi-bin\"> \u304c\u4e0a\u66f8\u304d\u3055\u308c\u306a\u3044\n\n\n\u60f3\u5b9a\u74b0\u5883\n\u672c\u8a18\u4e8b\u306f\u4e3b\u306b CentOS \u3067 Yum \u3092\u4f7f\u3063\u3066 Apache \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u308b\u60f3\u5b9a\u3067\u306e\u60c5\u5831\u306e\u305f\u3081\u3001\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u9069\u5b9c\u8aad\u307f\u66ff\u3048\u308b\u3053\u3068\u3002\n\u5bfe\u8c61\u3068\u3059\u308b Apache \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u3001\u73fe\u5728\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u308b 2.4 \u3068 2.2 1\u3002\u8a73\u7d30\u306f Apache HTTP Server \u306e\u30b5\u30dd\u30fc\u30c8\u671f\u9650 \u3092\u53c2\u7167\u3002\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u691c\u8a3c\u306e\u74b0\u5883\u60c5\u5831\n\nCentOS 7.2.1511 (CentOS-7-x86_64-Minimal-1511.iso)\nApache 2.4.6 (yum install httpd)\nPHP 5.4.16 (yum install php)\n\n\n\u30dd\u30ea\u30b7\u30fc\n\nYum \u306b\u3088\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u7ba1\u7406\n\n\n\u30bd\u30fc\u30b9\u304b\u3089\u30b3\u30f3\u30d1\u30a4\u30eb\uff1f\u305d\u3093\u306a\u3082\u306e\u30a6\u30c1\u306b\u306f\u306a\u3044\u3088\u3002\n\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u6975\u529b\u624b\u3092\u5165\u308c\u306a\u3044\n\u30b3\u30b9\u30c8\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u512a\u5148\n\n\n\u6210\u7acb\u306e\u53ef\u80fd\u6027\u304c\u4f4e\u3044\u8106\u5f31\u6027\u3078\u306e\u5bfe\u5fdc\u3067\u6c4e\u7528\u6027\u3084\u30b7\u30f3\u30d7\u30eb\u3055\u304c\u5931\u308f\u308c\u308b\u3088\u3046\u306a\u8a2d\u5b9a\u306f\u907f\u3051\u308b\n\n\n\n\n\u8a2d\u5b9a\u9805\u76ee\n\n\u60c5\u5831\u306e\u96a0\u533f\uff08\u96a0\u853d\uff09\n\u30d0\u30fc\u30b8\u30e7\u30f3\u306a\u3069\u306e\u60c5\u5831\u96a0\u533f\u306b\u3064\u3044\u3066\u306f\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5bfe\u7b56\u3068\u3057\u3066\u306e\u5b9f\u52b9\u6027\u306b\u95a2\u3059\u308b\u8b70\u8ad6 2 \u304c\u4e00\u5fdc\u3042\u308b\u3002\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u60c5\u5831\uff08ServerTokens\uff09\n\nHTTP\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u30fc\nServer: Apache/2.4.6 (CentOS) PHP/5.4.16\n\n\nApache 2.23 / 2.44 \u5171\u306b ServerTokens \u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f Full \u306e\u305f\u3081\u3001 HTTP \u30d8\u30c3\u30c0\u30fc\u306b\u4e0a\u8a18\u306e\u3088\u3046\u306b Apache \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u51fa\u529b\u3055\u308c\u308b\u3002\nServerTokens Prod\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306b ServerTokens \u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306b Prod \u307e\u305f\u306f ProductOnly \u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b Apache \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u60c5\u5831\u3092\u96a0\u853d\u3067\u304d\u308b\u3002\n\nHTTP\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u30fc\nServer: Apache\n\n\n\nServerSignature\nApache/2.2.15 (CentOS) Server at 192.168.56.101 Port 80\n\nServerSignature \u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306f\u3001 \u30b5\u30fc\u30d0\u30fc\u304c\u751f\u6210\u3059\u308b\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\uff08\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3001mod_proxy \u306b\u304a\u3051\u308b FTP \u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u30ea\u30b9\u30c8\u3001 mod_info \u306e\u51fa\u529b\u7b49\uff09\u306e\u6700\u4e0b\u884c\u306b\u4e0a\u8a18\u306e\u3088\u3046\u306a\u51fa\u529b\u3092\u4ed8\u4e0e\u3059\u308b\u8a2d\u5b9a\u3092\u884c\u3046\u3002\nServerSignature Off\n\nApache 2.25 / 2.46 \u5171\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f Off \u306b\u306a\u3063\u3066\u3044\u308b\u304c\u3001CentOS 6.x \u306e Apache 2.2 \u3067\u306f\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u5074\u306e\u8a2d\u5b9a\u3067 On \u306b\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u304b\u3001\u66f8\u304d\u63db\u3048\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u306a\u304a\u3001 httpd.conf \u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u3066\u3044\u306a\u3044\u5834\u5408\u3001 <Directory \"/var/www/html\"> \u5185\u3067\u6307\u5b9a\u3057\u306a\u3044\u3068\u6a5f\u80fd\u3057\u306a\u3044\u3002\n\nTRACE\u30e1\u30bd\u30c3\u30c9\u306e\u7121\u52b9\u5316\uff08XST\u5bfe\u7b56\uff09\nTraceEnable Off\n\nXSS \u3068 TRACE \u30e1\u30bd\u30c3\u30c9\u3092\u7d44\u307f\u5408\u308f\u305b\u305f XST (\u30af\u30ed\u30b9\u30b5\u30a4\u30c8\u30c8\u30ec\u30fc\u30b7\u30f3\u30b0)\u653b\u6483\u3078\u306e\u5bfe\u7b56\u3002\nBASIC\u8a8d\u8a3c\u306eID\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u7b49\u304c\u6f0f\u6d29\u3059\u308b\u5371\u967a\u304c\u3042\u308b\u304c\u3001\u30b5\u30dd\u30fc\u30c8\u5207\u308c\u306e\u53e4\u3044OS\u306a\u3069\u653b\u6483\u6210\u7acb\u6761\u4ef6\u306f\u9650\u5b9a\u76847 8 \u3067\u3042\u308b\u3002\n\u306a\u304a\u3001TRACE \u30e1\u30bd\u30c3\u30c9\u306f <Limit> \u3084 <LimitExcept> \u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3067\u306f\u5236\u9650\u3067\u304d\u306a\u3044\u30029\n\n\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u30bf\u30b0\uff08ETag\uff09\n\u904e\u53bb\u306e Apache \u3067\u306f HTTP \u30d8\u30c3\u30c0\u30fc\u306b\u51fa\u529b\u3059\u308b ETag \u306b inode \u756a\u53f7\u3092\u5f37\u5236\u7684\u306b\u5229\u7528\u3057\u3066\u3044\u305f10\u305f\u3081\u3001ETag \u30d8\u30c3\u30c0\u30fc\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u306e inode \u756a\u53f7\u3092\u5165\u624b\u3055\u308c\u308b\u30ea\u30b9\u30af\u304c\u3042\u3063\u305f\u300211\n\u305f\u3060\u3001\u691c\u8a3c\u304a\u3088\u3073\u8abf\u67fb\u3057\u305f\u3068\u3053\u308d Apache 2.4.0 \u304b\u3089\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f MTime Size \u306b\u306a\u3063\u3066\u304a\u308a\u30012.4 \u7cfb\u3067\u306f\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u9762\u3067\u306f\u672c\u8a2d\u5b9a\u306f\u6c17\u306b\u3059\u308b\u5fc5\u8981\u306f\u306a\u3044\u3002\n2.2 \u7cfb\u3067\u306f FileETag MTime Size \u307e\u305f\u306f FileETag None \u3092\u6307\u5b9a\u3059\u308b\u3068\u3044\u3044\u3060\u308d\u3046\u3002\nETag\u3092\u524a\u9664\u3057\u3066 Last-Modified \u30d8\u30c3\u30c0\u30fc\u3092\u4f7f\u3048\u3070 HTTP \u30d8\u30c3\u30c0\u30fc\u306e\u30b5\u30a4\u30ba\u304c\u305d\u306e\u5206\u5c11\u306a\u304f\u306a\u308b\u3068\u3044\u3046\u30e1\u30ea\u30c3\u30c8\u304c\u3042\u308b\u3002ETag \u3092\u51fa\u529b\u3057\u306a\u3044\u8a2d\u5b9a\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3002\nFileETag None\n\n\u4e0a\u8a18\u8a2d\u5b9a\u3067\u306f\u3046\u307e\u304f ETag \u304c\u6d88\u3048\u306a\u3044\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u6d88\u3059\u3053\u3068\u3082\u53ef\u80fd\u3002\nHeader unset ETag\n\n\nFileETag \u8a2d\u5b9a\u306e\u6319\u52d5\u691c\u8a3c\n\n\n\nFileETag\nETag\n\n\n\n\n(\u672a\u6307\u5b9a)\n\"220-529841bdd9a78\"\n\n\nMTime Size\n\"220-529841bdd9a78\"\n\n\nAll\n\"905069-220-529841bdd9a78\"\n\n\nINode\n\"905069\"\n\n\nMTime\n\"529830adcea90\"\n\n\nSize\n\"220\"\n\n\n\n\u516c\u5f0f\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f\u672a\u3060\u306b FileETag INode MTime Size \u3068\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b10\u304c\u3001\u691c\u8a3c\u74b0\u5883\u3067\u691c\u8a3c\u3057\u305f\u3068\u3053\u308d\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f MTime Size \u3060\u3063\u305f\u3002\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u306e\u66f4\u65b0\u6f0f\u308c\u304b\u3001\u3042\u308b\u3044\u306f\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3067\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u5909\u66f4\u3057\u3066\u3044\u308b\u304b\u3002\u306f\u3066\u30d6\u3067\u6307\u6458\u304c\u3042\u3063\u305f\u306e\u3067\u30bd\u30fc\u30b9\u3092\u8abf\u3079\u305f\u308912Apache\u672c\u4f53\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u304c 2.4.0 \u304b\u3089\u5909\u308f\u3063\u3066\u305f\u306e\u3067\u3001\u3084\u306f\u308a\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u306e\u66f4\u65b0\u6f0f\u308c\u306e\u6a21\u69d8\u3002\uff08\u82f1\u8a9e\u724813\u306f\u6b63\u3057\u304f\u4fee\u6b63\u3055\u308c\u3066\u3044\u308b by @matuu\u3055\u3093\uff09\n\ndocs/manual/mod/core.xml\n-<default>FileETag INode MTime Size</default>\n+<default>FileETag MTime Size</default>\n <contextlist><context>server config</context><context>virtual host</context>\n <context>directory</context><context>.htaccess</context>\n </contextlist>\n <override>FileInfo</override>\n+<compatibility>The default used to be \"INode&nbsp;MTime&nbsp;Size\" in 2.3.14 and\n+earlier.</compatibility>\n\n\n\ninclude/http_core.h\n-#define ETAG_BACKWARD (ETAG_MTIME | ETAG_INODE | ETAG_SIZE)\n #define ETAG_ALL   (ETAG_MTIME | ETAG_INODE | ETAG_SIZE)\n+/* This is the default value used */\n+#define ETAG_BACKWARD (ETAG_MTIME | ETAG_SIZE)\n\n\n\nmodules/dav/fs/repos.c\n     if (ctx->finfo.filetype != APR_NOFILE) {\n          return apr_psprintf(ctx->pool, \"\\\"%\" APR_UINT64_T_HEX_FMT \"-%\"\n-                            APR_UINT64_T_HEX_FMT \"-%\" APR_UINT64_T_HEX_FMT \"\\\"\",\n+                            APR_UINT64_T_HEX_FMT \"\\\"\",\n-                            (apr_uint64_t) ctx->finfo.inode,\n                             (apr_uint64_t) ctx->finfo.size,\n                             (apr_uint64_t) ctx->finfo.mtime);\n      }\n\n\n\nX-Powered-By\nX-Powered-By: PHP/5.4.16\n\nHTTP \u30d8\u30c3\u30c0\u30fc\u306b\u4e0a\u8a18\u306e\u3088\u3046\u306b PHP \u306a\u3069\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u304c\u3042\u308b\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b Apache \u5074\u3067\u30d8\u30c3\u30c0\u30fc\u3092\u5f37\u5236\u524a\u9664\u3059\u308b\u3002\nHeader unset X-Powered-By\n\nPHP \u306e\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b php.ini \u306e expose_php \u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6 14 \u3067\u975e\u8868\u793a\u306b\u3059\u308b\u8a2d\u5b9a\u304c\u53ef\u80fd\u3060\u304c\u3001Apache \u5074\u3067\u4e00\u5143\u7684\u306b\u5f37\u5236\u524a\u9664\u3057\u305f\u65b9\u304c\u8a2d\u5b9a\u6f0f\u308c\u306e\u30ea\u30b9\u30af\u304c\u306a\u3044\u3060\u308d\u3046\u3002\n\nphp.ini\nexpose_php = Off\n\n\n\nOptions -Indexes\n<Directory /var/www/html>\n    Options -Indexes\n</Directory>\n\nApache 2.0/2.2/2.4 \u5171\u306b Options \u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f All\u3002\nDirectoryIndex \u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6 15 \u3067\u6307\u5b9a\u3057\u305f\u30d5\u30a1\u30a4\u30eb (index.html\u7b49) \u304c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u5185\u306b\u7121\u3044\u5834\u5408\u306b mod_autoindex \u304c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u5185\u306e\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u3092\u6574\u5f62\u3057\u3066\u8fd4\u3059\u3002\n\nautoindex.conf\ncp /dev/null /etc/httpd/conf.d/autoindex.conf\n\n\u307e\u305f\u306f\n> /etc/httpd/conf.d/autoindex.conf\n\nicons\u306e\u8a2d\u5b9a\u7b49\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u304c\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4e00\u89a7\u306f\u8868\u793a\u3055\u305b\u306a\u3044\u305f\u3081\u539f\u5247\u7684\u306b\u5229\u7528\u3057\u306a\u3044\u306e\u3067\u524a\u9664\u3002\u30d5\u30a1\u30a4\u30eb\u81ea\u4f53\u3092\u524a\u9664\u3059\u308b\u3068\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u6642\u306b\u518d\u4f5c\u6210\u3055\u308c\u308b\u306e\u3067\u3001\u7a7a\u30d5\u30a1\u30a4\u30eb\u306b\u3059\u308b\u3002\n\nwelcome.conf\ncp /dev/null /etc/httpd/conf.d/welcome.conf\n\n\u307e\u305f\u306f\n> /etc/httpd/conf.d/welcome.conf\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u306b index.html \u304c\u306a\u3044\u5834\u5408\u306a\u3069 Forbidden \u306b\u306a\u308b\u3068 CentOS \u306e\u30a6\u30a7\u30eb\u30ab\u30e0\u30da\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u308b\u304c\u3001\u4f59\u8a08\u306a\u60c5\u5831\u306b\u306a\u308b\u306e\u3067\u524a\u9664\u3002autoindex.conf \u3068\u540c\u69d8\u306b\u524a\u9664\u3059\u308b\u3068\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u6642\u306b\u518d\u4f5c\u6210\u3055\u308c\u308b\u305f\u3081\u7a7a\u30d5\u30a1\u30a4\u30eb\u306b\u3059\u308b\u3002\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\n\nAllowOverride\n<Directory /var/www/html>\n    AllowOverride All\n</Directory>\n\n/etc/httpd/conf.d/userdir.conf \u306e <Directory \"/home/*/public_html\"> \u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b AllowOverride \u4ee5\u5916\u306f\u3059\u3079\u3066 None \u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001.htaccess \u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u914d\u4e0b\u3092\u500b\u5225\u306b\u8a31\u53ef\u3059\u308b\u3002\n\nHTTP \u30e1\u30bd\u30c3\u30c9\u306e\u5236\u9650\n\n2.4\n<Directory /var/www/html>\n    Require method GET POST\n</Directory>\n\n\n\n2.2\n<Directory /var/www/html>\n    <Limit GET POST>\n        Order allow,deny\n        Allow from all\n    </Limit>\n    <LimitExcept GET POST>\n        Order deny,allow\n        Deny from all\n    </LimitExcept>\n</IfVersion>\n\n\n\nX-Frame-Options\uff08\u30af\u30ea\u30c3\u30af\u30b8\u30e3\u30c3\u30ad\u30f3\u30b0\u5bfe\u7b56\uff09\nHeader always append X-Frame-Options SAMEORIGIN\n\nX-Frame-Options HTTP \u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u30fc\u306f\u3001\u30d6\u30e9\u30a6\u30b6\u30fc\u304c\u30da\u30fc\u30b8\u3092 <frame> \u307e\u305f\u306f <iframe> \u306e\u5185\u90e8\u306b\u8868\u793a\u3059\u308b\u3053\u3068\u3092\u8a31\u53ef\u3059\u308b\u304b\u3092\u793a\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\u30af\u30ea\u30c3\u30af\u30b8\u30e3\u30c3\u30ad\u30f3\u30b0\u5bfe\u7b56\u3068\u3057\u3066 IE8 \u304b\u3089\u5b9f\u88c5\u3055\u308c\u305f\u30aa\u30d7\u30b7\u30e7\u30f3\u30d8\u30c3\u30c0\u30fc\u3002\n\u81ea\u5206\u306e\u30b5\u30a4\u30c8\u306e\u30b3\u30f3\u30c6\u30f3\u30c4\u304c\u4ed6\u306e\u30b5\u30a4\u30c8\u306b\u57cb\u3081\u8fbc\u307e\u308c\u306a\u3044\u3053\u3068\u3092\u4fdd\u8a3c\u3059\u308b\u300216\n\n\n\n\u8a2d\u5b9a\u5024\n\u5185\u5bb9\n\n\n\n\nDENY\n\u30b5\u30a4\u30c8\u5074\u306e\u610f\u56f3\u306b\u95a2\u308f\u3089\u305a\u3001\u30da\u30fc\u30b8\u3092\u30d5\u30ec\u30fc\u30e0\u5185\u306b\u8868\u793a\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u306a\u3044\u3002\u540c\u3058\u30b5\u30a4\u30c8\u306e\u30da\u30fc\u30b8\u3092\u30d5\u30ec\u30fc\u30e0\u5185\u306b\u8aad\u307f\u8fbc\u3080\u3053\u3068\u3082\u4e0d\u53ef\u80fd\u306b\u306a\u308b\u3002\n\n\nSAMEORIGIN\n\u81ea\u8eab\u3068\u751f\u6210\u5143\u304c\u540c\u3058\u30d5\u30ec\u30fc\u30e0\u5185\u306b\u9650\u308a\u30da\u30fc\u30b8\u3092\u8868\u793a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\u5916\u90e8\u30b5\u30a4\u30c8\u306e\u30d5\u30ec\u30fc\u30e0\u5185\u306b\u30da\u30fc\u30b8\u3092\u8aad\u307f\u8fbc\u3080\u3053\u3068\u3092\u4e0d\u53ef\u80fd\u306b\u3059\u308b\u3002\n\n\nALLOW-FROM uri\n\u6307\u5b9a\u3055\u308c\u305f\u751f\u6210\u5143\u306b\u9650\u308a\u3001\u30da\u30fc\u30b8\u3092\u30d5\u30ec\u30fc\u30e0\u5185\u306b\u8868\u793a\u3067\u304d\u308b\u3002Chrome\u3001Safari\u306f\u672a\u5bfe\u5fdc\u300217\n\n\n\n\nX-Frame-Options \u306b\u5bfe\u5fdc\u3059\u308b\u30d6\u30e9\u30a6\u30b6\u30fc\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f IE8 \u4ee5\u4e0a\u3001Firefox 3.6.9 \u4ee5\u4e0a\u3001Chrome 4.1.249.1042 \u4ee5\u4e0a\u3001Safari 4 \u4ee5\u4e0a\u3001Opera 10.50 \u4ee5\u4e0a\u300218\nGoogle\u3001Twitter\u3001Yahoo! JAPAN \u306a\u3069\u3067 SAMEORIGIN \u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u3002\nFacebook \u3067\u306f DENY \u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u3002\n\nX-XSS-Protection\uff08XSS\u30d5\u30a3\u30eb\u30bf\u30fc\u6a5f\u80fd\uff09\nHeader always set X-XSS-Protection \"1; mode=block\"\n\nX-XSS-Protection \u306f\u30d6\u30e9\u30a6\u30b6\u306e XSS \u30d5\u30a3\u30eb\u30bf\u30fc\u6a5f\u80fd\u3092\u5236\u5fa1\u3067\u304d\u308b\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u30fc\u3002\n0 \u306f\u7121\u52b9\u3001 1 \u306f\u6709\u52b9\uff08\u90e8\u5206\u7684\u66f8\u304d\u63db\u3048\uff09\u3001 1; mode=block \u306f\u6709\u52b9\uff08\u8868\u793a\u306e\u5b8c\u5168\u306a\u505c\u6b62\uff09\u3092\u610f\u5473\u3059\u308b\u3002\n\u30b5\u30a4\u30c8\u306e XSS \u5bfe\u7b56\u306b\u554f\u984c\u306f\u306a\u304f\u8aa4\u691c\u77e5\u3092\u306a\u304f\u3057\u305f\u3044\u5834\u5408\u306f 0 \u3092\u3001\u305d\u3046\u3067\u306a\u3044\u5834\u5408\u306f 1; mode=block \u3092\u6307\u5b9a\u3059\u308b\u306e\u304c\u671b\u307e\u3057\u304f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e 1 \u306e\u72b6\u614b\u306f\u671b\u307e\u3057\u304f\u306a\u3044\u3002 19\nGoogle\u3001Twitter\u3001Yahoo! JAPAN \u306a\u3069\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u3002\nFacebook \u3067\u306f 0 \u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u3002\n\nX-Content-Type-Options\nHeader always set X-Content-Type-Options nosniff\n\nX-Content-Type-Options \u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u30fc\u306e\u5024\u306b nosniff \u3092\u8a2d\u5b9a\u3057\u3066\u9001\u4fe1\u3059\u308b\u3068\u3001Internet Explorer \u304c MIME Sniffing \u6a5f\u80fd\u3067 content-type \u5ba3\u8a00\u3092\u56de\u907f\u3059\u308b\u306e\u3092\u9632\u6b62\u3067\u304d\u308b\u300220\nFacebook\u3001Twitter\u3001Yahoo! JAPAN \u306a\u3069\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u3002\n\nContent Security Policy (CSP)\n\u7d20\u4eba\u306b\u306f\u304a\u52e7\u3081\u3067\u304d\u306a\u3044\u3002\nhttps://content-security-policy.com/\nhttp://blog.hash-c.co.jp/2013/12/Content-Security-Policy-CSP.html\n\nhttpoxy \u5bfe\u7b56\nFoo: Bar \u3063\u3066\u3044\u3046 header \u9001\u3063\u305f\u3089 CGI \u306e spec \u7684\u306b\u306f HTTP_Foo = Bar \u306b\u3057\u3066\u304f\u308c\u308b\u3063\u3066\u3044\u3046\u4ed5\u69d8\u3092\u7a81\u3044\u3066 PROXY: xxx \u3063\u3066\u3044\u3046header\u9001\u308b\u3068 HTTP_PROXY\u66f8\u304d\u63db\u3048\u3089\u308c\u308b\u3093\u3058\u3083\u306d\u3063\u3066\u3044\u3046\u8106\u5f31\u6027\u300221\nHTTPOXY Vulnerability Checking Tool \u3067\u30c6\u30b9\u30c8\u3067\u304d\u308b\u3002\n\u4ee5\u4e0b\u306e\u30bd\u30d5\u30c8\u30a6\u30a8\u30a2\u304c\u5f71\u97ff\u3092\u53d7\u3051\u308b\u300222\n\nPHP (CVE-2016-5385)\nGO (CVE-2016-5386)\nApache HTTP Server (CVE-2016-5387)\nApache Tomcat (CVE-2016-5388)\nHHVM (CVE-2016-1000109)\nPython (CVE-2016-1000110\n\n\nLimitRequestBody\n\u3053\u306e\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306f\u30ea\u30af\u30a8\u30b9\u30c8\u30dc\u30c7\u30a3\u306b\u8a31\u3055\u308c\u308b\u30d0\u30a4\u30c8\u6570\u3092\u6307\u5b9a\u3059\u308b\u3002\n\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u304c\u66f8\u304b\u308c\u305f\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\uff08\u30b5\u30fc\u30d0\u5168\u4f53\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3001\u30d5\u30a1\u30a4\u30eb\u3001\u30ed\u30b1\u30fc\u30b7\u30e7\u30f3\uff09\u5185\u3067\u8a31\u5bb9\u3059\u308b HTTP \u30ea\u30af\u30a8\u30b9\u30c8\u30e1\u30c3\u30bb\u30fc\u30b8\u30dc\u30c7\u30a3\u306e\u30b5\u30a4\u30ba\u306b\u5236\u9650\u3092\u304b\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f 0 \u3067\u7121\u5236\u9650\u3002\u4e0a\u9650\u306f 2147483647 (2GB) \u307e\u3067\u3002\nLimitRequestBody 10485760\n\n10MiB \u306b\u5236\u9650\u3057\u305f\u3044\u5834\u5408\u306f\u4e0a\u8a18\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3002\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u3067 DoS \u653b\u6483\u3092\u907f\u3051\u308b\u306e\u306b\u6709\u52b9\u3068\u3057\u3066\u3044\u308b\u3002\n\u306a\u304a\u3001PHP \u3067\u306f\u4ee5\u4e0b\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u4f75\u305b\u3066\u78ba\u8a8d\u3057\u305f\u3044\u3002\n\nphp.ini\nmemory_limit = 128M\npost_max_size = 8M\nupload_max_filesize = 5M\n\n\n\nLimitRequestFields\n\u3053\u306e\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306f HTTP \u30ea\u30af\u30a8\u30b9\u30c8\u306b\u304a\u3044\u3066\u8a31\u53ef\u3059\u308b\u30ea\u30af\u30a8\u30b9\u30c8\u30d8\u30c3\u30c0\u30d5\u30a3\u30fc\u30eb\u30c9\u6570\u3092\u6307\u5b9a\u3059\u308b\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f 100 \u306b\u306a\u3063\u3066\u3044\u308b\u3002\nLimitRequestFields 20\n\n\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u306b\u306f\u300c\u30ea\u30af\u30a8\u30b9\u30c8\u30d8\u30c3\u30c0\u30fc\u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u6570\u304c 20 \u3092\u8d85\u3048\u308b\u3053\u3068\u306f\u307b\u3068\u3093\u3069\u306a\u3044\u3002\u300d23 \u3068\u3042\u308b\u3002\u307e\u305f\u3001DoS \u653b\u6483\u3092\u907f\u3051\u308b\u306e\u306b\u6709\u52b9\u3068\u3057\u3066\u3044\u308b\u3002\n\nRequestReadTimeout\nRequestReadTimeout header=20-40,MinRate=500 body=20,MinRate=500\n\nslowloris 24 \u5bfe\u7b56\u3067\u5b9f\u88c5\u3055\u308c\u305f mod_reqtimeout \u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u4f7f\u7528\u3067\u304d\u308b\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3002\n2.2.15 \u4ee5\u964d\u306b\u5b9f\u88c5\u3055\u308c\u30012.3.15 \u4ee5\u964d\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u6709\u52b9\u306b\u306a\u3063\u305f\u3002\nAWS \u306e ELB \u3092\u5229\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u3001 ELB \u306e Connection Settings: Idle Timeout \u306e\u5024\u304c Apache \u306e RequestReadTimeout header \u306e\u6700\u4f4e\u5024\u3088\u308a\u3082\u5927\u304d\u3044\u3068\u3001 Apache \u306e\u30a8\u30e9\u30fc\u30ed\u30b0\u306b 408 \u304c\u5927\u91cf\u306b\u5410\u304b\u308c\u3066\u3057\u307e\u3046\u3088\u3046\u306a\u306e\u3067\u6ce8\u610f\u300225\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30c6\u30b9\u30c8\nCentOS 7.2.1511 \u306b yum \u3067 Apache \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u8a2d\u5b9a\u5909\u66f4\u3057\u3066\u3044\u306a\u3044\u30b1\u30fc\u30b9\u3092\u30c6\u30b9\u30c8\u3057\u305f\u7d50\u679c\u3002\n[root@localhost program]# perl ./nikto.pl -h 127.0.0.1\n- ***** SSL support not available (see docs for SSL install) *****\n- Nikto v2.1.6\n---------------------------------------------------------------------------\n+ Target IP:          127.0.0.1\n+ Target Hostname:    127.0.0.1\n+ Target Port:        80\n+ Start Time:         2016-01-16 10:00:00 (GMT9)\n---------------------------------------------------------------------------\n+ Server: Apache/2.4.6 (CentOS) PHP/5.4.16\n+ Server leaks inodes via ETags, header found with file /, fields: 0x220 0x529841bdd9a78\n+ The anti-clickjacking X-Frame-Options header is not present.\n+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS\n+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type\n+ PHP/5.4.16 appears to be outdated (current is at least 5.6.9). PHP 5.5.25 and 5.4.41 are also current.\n+ Apache/2.4.6 appears to be outdated (current is at least Apache/2.4.16). Apache 2.2.31 is also current for the 2.x branch.\n+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS, TRACE\n+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST\n+ Retrieved x-powered-by header: PHP/5.4.16\n+ OSVDB-3092: /test.php: This might be interesting...\n+ 8225 requests: 0 error(s) and 10 item(s) reported on remote host\n+ End Time:           2016-01-16 10:00:11 (GMT9) (11 seconds)\n---------------------------------------------------------------------------\n+ 1 host(s) tested\n\n\nApache \u95a2\u9023\u8a18\u4e8b\n\nApache\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\nApache HTTP Server \u306e\u30b5\u30dd\u30fc\u30c8\u671f\u9650\nApache \u306e\u30ed\u30b0\u3092\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067\u96c6\u8a08\u3059\u308b\nApache \u306e\u60c5\u5831\u3092\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067\u53d6\u5f97\u3059\u308b\nIP\u30a2\u30c9\u30ec\u30b9\u304b\u3089\u56fd\u3084\u90fd\u5e02\u3092\u5224\u5225\u3059\u308b (GeoIP)\nApache \u30c1\u30e5\u30fc\u30cb\u30f3\u30b0 \u30b9\u30af\u30ea\u30d7\u30c8\n\n\n\u53c2\u7167\u60c5\u5831\n\n\n\n\nhttp://qiita.com/bezeklik/items/7e2c02c3eabd2a416231\u00a0\u21a9\n\n\n\u30b5\u30fc\u30d0\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u96a0\u3059\u306e\u304c\u5e38\u8b58? | \u30b9\u30e9\u30c9 \u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u00a0\u21a9\n\n\nhttps://httpd.apache.org/docs/2.2/ja/mod/core.html#servertokens\u00a0\u21a9\n\n\nhttps://httpd.apache.org/docs/2.4/ja/mod/core.html#servertokens\u00a0\u21a9\n\n\nhttps://httpd.apache.org/docs/2.2/ja/mod/core.html#serversignature\u00a0\u21a9\n\n\nhttps://httpd.apache.org/docs/2.4/ja/mod/core.html#serversignature\u00a0\u21a9\n\n\nhttp://blog.tokumaru.org/2013/01/TRACE-method-is-not-so-dangerous-in-fact.html\u00a0\u21a9\n\n\nhttp://n.pentest.ninja/?p=952\u00a0\u21a9\n\n\nhttps://httpd.apache.org/docs/2.4/ja/mod/core.html#limit\u00a0\u21a9\n\n\nhttp://httpd.apache.org/docs/2.4/ja/mod/core.html#fileetag\u00a0\u21a9\n\n\nhttp://www.iss.net/security_center/reference/jp/vuln/apache-mime-information-disclosure.htm\u00a0\u21a9\n\n\nhttps://github.com/apache/httpd/commit/ba86234a7e627a50fdedc50b49ceaf40465911cb\u00a0\u21a9\n\n\nhttp://httpd.apache.org/docs/2.4/en/mod/core.html#fileetag\u00a0\u21a9\n\n\nhttp://php.net/manual/ja/ini.core.php#ini.expose-php\u00a0\u21a9\n\n\nhttps://httpd.apache.org/docs/2.4/ja/mod/mod_dir.html#directoryindex\u00a0\u21a9\n\n\nhttps://developer.mozilla.org/ja/docs/HTTP/X-Frame-Options\u00a0\u21a9\n\n\nIssue 511521 - chromium - `X-Frame-Options` does not support the `allow-from` directive. - Monorail\u00a0\u21a9\n\n\nX-Frame-Options\u3001\u30d6\u30e9\u30a6\u30b6\u5bfe\u5fdc\u5b8c\u4e86 | \u30de\u30a4\u30ca\u30d3\u30cb\u30e5\u30fc\u30b9\u00a0\u21a9\n\n\nhttp://www.slideshare.net/masatokinugawa/xxn-ja/98\u00a0\u21a9\n\n\n2008/9/3 - Internet Explorer 8 \u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3 Part VI: Beta 2 \u306e\u66f4\u65b0\u9805\u76ee\u00a0\u21a9\n\n\nhttp://b.hatena.ne.jp/entry/294900783/comment/yosuke_furukawa\u00a0\u21a9\n\n\nCGI \u7b49\u3092\u5229\u7528\u3059\u308b Web \u30b5\u30fc\u30d0\u306e\u8106\u5f31\u6027 (CVE-2016-5385 \u7b49) \u306b\u95a2\u3059\u308b\u6ce8\u610f\u559a\u8d77\u00a0\u21a9\n\n\nhttp://httpd.apache.org/docs/2.4/mod/core.html#limitrequestbody\u00a0\u21a9\n\n\nApache\u306b\u65b0\u305f\u306a\u8106\u5f31\u6027\u767a\u898b | \u30b9\u30e9\u30c9 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u00a0\u21a9\n\n\n\u300cELB\u304b\u3089\u306e\u901a\u4fe1\u3067408\u304c\u591a\u767a\u3059\u308b\u300d\u4ef6\u3067\u3001\u7d50\u5c40\u3069\u3046\u3059\u3079\u304d\u304b\u8abf\u3079\u305f\u306e\u3067\u307e\u3068\u3081\u305f - \u53cc\u516d\u5de5\u5834\u65e5\u8a8c\u00a0\u21a9\n\n\n\n# \u6982\u8981\n**Apache \u306e\u8a2d\u5b9a**\u306b\u3064\u3044\u3066\u5171\u901a\u5316\u3067\u304d\u308b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\u3068\u305d\u306e\u5404\u9805\u76ee\u306b\u3064\u3044\u3066\u307e\u3068\u3081\u305f\u3002\n\n## \u8a2d\u5b9a\u4f8b\n### \u5fc5\u9808\u8a2d\u5b9a\n```apache\ncat << _EOF_ > /etc/httpd/conf.d/security.conf\n# \u30d0\u30fc\u30b8\u30e7\u30f3\u60c5\u5831\u306e\u96a0\u853d\nServerTokens Prod \nHeader unset X-Powered-By\n# httpoxy \u5bfe\u7b56\nRequestHeader unset Proxy\n# \u30af\u30ea\u30c3\u30af\u30b8\u30e3\u30c3\u30ad\u30f3\u30b0\u5bfe\u7b56\nHeader append X-Frame-Options SAMEORIGIN\n# XSS\u5bfe\u7b56\nHeader set X-XSS-Protection \"1; mode=block\"\nHeader set X-Content-Type-Options nosniff\n# XST\u5bfe\u7b56\nTraceEnable Off\n\n<Directory /var/www/html>\n    # .htaccess \u306e\u6709\u52b9\u5316\n    AllowOverride All\n    # \u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u51fa\u529b\u306e\u7981\u6b62\n    Options -Indexes\n    # Apache 2.2\u4ee5\u524d\u306e\u5bfe\u7b56\n    <IfVersion < 2.3>\n        # \u30d0\u30fc\u30b8\u30e7\u30f3\u60c5\u5831\u306e\u96a0\u853d\n        ServerSignature Off\n        # ETag\u306einode\u60c5\u5831\u306e\u96a0\u853d\n        FileETag MTime Size\n    </IfVersion>\n</Directory>\n\n<Directory \"/var/www/cgi-bin\">\n    <IfVersion < 2.3>\n        ServerSignature Off\n        FileETag MTime Size\n    </IfVersion>\n</Directory>\n_EOF_\n```\n```bash:CentOS7\ncat /dev/null > /etc/httpd/conf.d/autoindex.conf ;\ncat /dev/null > /etc/httpd/conf.d/welcome.conf ;\n```\n#### \u6ce8\u610f\u4e8b\u9805\n* \u5916\u90e8\u30b5\u30a4\u30c8\u304b\u3089iframe\u3067\u547c\u3073\u51fa\u3057\u3067\u304d\u306a\u304f\u306a\u308b\n* Apache 2.2 \u306e\u5834\u5408 `ServerSignature` \u306f `Directory` \u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u5185\u3067\u6307\u5b9a\u3057\u306a\u3044\u3068\u4e0a\u66f8\u304d\u3055\u308c\u306a\u3044\u3002\n* \u73fe\u72b6\u306e\u4e0a\u8a18\u8a2d\u5b9a\u3067\u306f Apache 2.2 \u3067\u4ee5\u4e0b\u304c\u4e0a\u66f8\u304d\u3055\u308c\u306a\u3044\n    * `Options -Indexes`\n    * `<Directory \"/var/www/cgi-bin\">`\n\n### \u4efb\u610f\u8a2d\u5b9a\n```apache\ncat << _EOF_ > /etc/httpd/conf.d/security-strict.conf\n# DoS \u653b\u6483\u5bfe\u7b56\nLimitRequestBody 10485760\nLimitRequestFields 20\n# slowloris \u5bfe\u7b56\nRequestReadTimeout header=20-40,MinRate=500 body=20,MinRate=500\n\n# HTTP\u30e1\u30bd\u30c3\u30c9\u306e\u5236\u9650\n<Directory /var/www/html>\n    <IfVersion > 2.4>\n        Require method GET POST\n    </IfVersion>\n    <IfVersion < 2.3>\n        <Limit GET POST>\n            Order allow,deny\n            Allow from all\n        </Limit>\n        <LimitExcept GET POST>\n            Order deny,allow\n            Deny from all\n        </LimitExcept>\n    </IfVersion>\n</Directory>\n\n<Directory \"/var/www/cgi-bin\">\n    <IfVersion > 2.4>\n        Require all denied\n    </IfVersion>\n    <IfVersion < 2.3>\n        Order allow,deny\n        Deny from all\n    </IfVersion>\n</Directory>\n_EOF_\n```\n#### \u6ce8\u610f\u4e8b\u9805\n* GET/POST \u4ee5\u5916\u4f7f\u3048\u306a\u304f\u306a\u308b\n* cgi-bin \u304c\u4f7f\u3048\u306a\u304f\u306a\u308b\n* \u73fe\u72b6\u306e\u4e0a\u8a18\u8a2d\u5b9a\u3067\u306f Apache 2.2 \u3067 `<Directory \"/var/www/cgi-bin\">` \u304c\u4e0a\u66f8\u304d\u3055\u308c\u306a\u3044\n\n## \u60f3\u5b9a\u74b0\u5883\n\u672c\u8a18\u4e8b\u306f\u4e3b\u306b CentOS \u3067 **Yum** \u3092\u4f7f\u3063\u3066 Apache \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u308b\u60f3\u5b9a\u3067\u306e\u60c5\u5831\u306e\u305f\u3081\u3001\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u9069\u5b9c\u8aad\u307f\u66ff\u3048\u308b\u3053\u3068\u3002\n\u5bfe\u8c61\u3068\u3059\u308b **Apache** \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u3001\u73fe\u5728\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u308b **2.4** \u3068 **2.2** [^support]\u3002\u8a73\u7d30\u306f [Apache HTTP Server \u306e\u30b5\u30dd\u30fc\u30c8\u671f\u9650](http://qiita.com/bezeklik/items/7e2c02c3eabd2a416231) \u3092\u53c2\u7167\u3002\n[^support]: http://qiita.com/bezeklik/items/7e2c02c3eabd2a416231\n\n### \u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u691c\u8a3c\u306e\u74b0\u5883\u60c5\u5831\n\n* CentOS 7.2.1511 (CentOS-7-x86_64-Minimal-1511.iso)\n* Apache 2.4.6 (`yum install httpd`)\n* PHP 5.4.16 (`yum install php`)\n\n## \u30dd\u30ea\u30b7\u30fc\n\n* Yum \u306b\u3088\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u7ba1\u7406\n    * \u30bd\u30fc\u30b9\u304b\u3089\u30b3\u30f3\u30d1\u30a4\u30eb\uff1f\u305d\u3093\u306a\u3082\u306e\u30a6\u30c1\u306b\u306f\u306a\u3044\u3088\u3002\n* \u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u6975\u529b\u624b\u3092\u5165\u308c\u306a\u3044\n* \u30b3\u30b9\u30c8\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u512a\u5148\n    * \u6210\u7acb\u306e\u53ef\u80fd\u6027\u304c\u4f4e\u3044\u8106\u5f31\u6027\u3078\u306e\u5bfe\u5fdc\u3067\u6c4e\u7528\u6027\u3084\u30b7\u30f3\u30d7\u30eb\u3055\u304c\u5931\u308f\u308c\u308b\u3088\u3046\u306a\u8a2d\u5b9a\u306f\u907f\u3051\u308b\n\n# \u8a2d\u5b9a\u9805\u76ee\n## \u60c5\u5831\u306e\u96a0\u533f\uff08\u96a0\u853d\uff09\n\u30d0\u30fc\u30b8\u30e7\u30f3\u306a\u3069\u306e\u60c5\u5831\u96a0\u533f\u306b\u3064\u3044\u3066\u306f\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5bfe\u7b56\u3068\u3057\u3066\u306e\u5b9f\u52b9\u6027\u306b\u95a2\u3059\u308b\u8b70\u8ad6 [^srad] \u304c\u4e00\u5fdc\u3042\u308b\u3002\n\n[^srad]: [\u30b5\u30fc\u30d0\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u96a0\u3059\u306e\u304c\u5e38\u8b58? | \u30b9\u30e9\u30c9 \u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9](http://opensource.srad.jp/story/07/09/03/0219247/)\n\n### \u30d0\u30fc\u30b8\u30e7\u30f3\u60c5\u5831\uff08ServerTokens\uff09\n```text:HTTP\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u30fc\nServer: Apache/2.4.6 (CentOS) PHP/5.4.16\n```\nApache 2.2[^servertoken22] / 2.4[^servertoken24] \u5171\u306b `ServerTokens` \u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f `Full` \u306e\u305f\u3081\u3001 HTTP \u30d8\u30c3\u30c0\u30fc\u306b\u4e0a\u8a18\u306e\u3088\u3046\u306b Apache \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u51fa\u529b\u3055\u308c\u308b\u3002\n\n```apache\nServerTokens Prod\n```\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306b `ServerTokens` \u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306b `Prod` \u307e\u305f\u306f `ProductOnly` \u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b Apache \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u60c5\u5831\u3092\u96a0\u853d\u3067\u304d\u308b\u3002\n\n```text:HTTP\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u30fc\nServer: Apache\n```\n[^servertoken22]: https://httpd.apache.org/docs/2.2/ja/mod/core.html#servertokens\n[^servertoken24]: https://httpd.apache.org/docs/2.4/ja/mod/core.html#servertokens\n\n### ServerSignature\n```text\nApache/2.2.15 (CentOS) Server at 192.168.56.101 Port 80\n```\n`ServerSignature` \u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306f\u3001 \u30b5\u30fc\u30d0\u30fc\u304c\u751f\u6210\u3059\u308b\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\uff08\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3001mod_proxy \u306b\u304a\u3051\u308b FTP \u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u30ea\u30b9\u30c8\u3001 mod_info \u306e\u51fa\u529b\u7b49\uff09\u306e\u6700\u4e0b\u884c\u306b\u4e0a\u8a18\u306e\u3088\u3046\u306a\u51fa\u529b\u3092\u4ed8\u4e0e\u3059\u308b\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\n```apache\nServerSignature Off\n```\n\nApache 2.2[^serversignature22] / 2.4[^serversignature24] \u5171\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f `Off` \u306b\u306a\u3063\u3066\u3044\u308b\u304c\u3001CentOS 6.x \u306e Apache 2.2 \u3067\u306f\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u5074\u306e\u8a2d\u5b9a\u3067 `On` \u306b\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u304b\u3001\u66f8\u304d\u63db\u3048\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n\u306a\u304a\u3001 httpd.conf \u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u3066\u3044\u306a\u3044\u5834\u5408\u3001 `<Directory \"/var/www/html\">` \u5185\u3067\u6307\u5b9a\u3057\u306a\u3044\u3068\u6a5f\u80fd\u3057\u306a\u3044\u3002\n[^serversignature22]: https://httpd.apache.org/docs/2.2/ja/mod/core.html#serversignature\n[^serversignature24]: https://httpd.apache.org/docs/2.4/ja/mod/core.html#serversignature\n\n### TRACE\u30e1\u30bd\u30c3\u30c9\u306e\u7121\u52b9\u5316\uff08XST\u5bfe\u7b56\uff09\n```apache\nTraceEnable Off\n```\nXSS \u3068 TRACE \u30e1\u30bd\u30c3\u30c9\u3092\u7d44\u307f\u5408\u308f\u305b\u305f **XST (\u30af\u30ed\u30b9\u30b5\u30a4\u30c8\u30c8\u30ec\u30fc\u30b7\u30f3\u30b0)\u653b\u6483**\u3078\u306e\u5bfe\u7b56\u3002\nBASIC\u8a8d\u8a3c\u306eID\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u7b49\u304c\u6f0f\u6d29\u3059\u308b\u5371\u967a\u304c\u3042\u308b\u304c\u3001\u30b5\u30dd\u30fc\u30c8\u5207\u308c\u306e\u53e4\u3044OS\u306a\u3069\u653b\u6483\u6210\u7acb\u6761\u4ef6\u306f\u9650\u5b9a\u7684[^XST] [^XST2] \u3067\u3042\u308b\u3002\n\u306a\u304a\u3001TRACE \u30e1\u30bd\u30c3\u30c9\u306f `<Limit>` \u3084 `<LimitExcept>` \u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3067\u306f\u5236\u9650\u3067\u304d\u306a\u3044\u3002[^TRACE]\n\n[^XST]: http://blog.tokumaru.org/2013/01/TRACE-method-is-not-so-dangerous-in-fact.html\n[^XST2]: http://n.pentest.ninja/?p=952\n[^TRACE]: https://httpd.apache.org/docs/2.4/ja/mod/core.html#limit\n\n### \u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u30bf\u30b0\uff08ETag\uff09\n\u904e\u53bb\u306e Apache \u3067\u306f HTTP \u30d8\u30c3\u30c0\u30fc\u306b\u51fa\u529b\u3059\u308b ETag \u306b inode \u756a\u53f7\u3092\u5f37\u5236\u7684\u306b\u5229\u7528\u3057\u3066\u3044\u305f[^ETag]\u305f\u3081\u3001ETag \u30d8\u30c3\u30c0\u30fc\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u306e inode \u756a\u53f7\u3092\u5165\u624b\u3055\u308c\u308b\u30ea\u30b9\u30af\u304c\u3042\u3063\u305f\u3002[^vuln_11438]\n[^vuln_11438]: http://www.iss.net/security_center/reference/jp/vuln/apache-mime-information-disclosure.htm\n\u305f\u3060\u3001\u691c\u8a3c\u304a\u3088\u3073\u8abf\u67fb\u3057\u305f\u3068\u3053\u308d Apache 2.4.0 \u304b\u3089\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f `MTime Size` \u306b\u306a\u3063\u3066\u304a\u308a\u30012.4 \u7cfb\u3067\u306f\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u9762\u3067\u306f\u672c\u8a2d\u5b9a\u306f\u6c17\u306b\u3059\u308b\u5fc5\u8981\u306f\u306a\u3044\u3002\n2.2 \u7cfb\u3067\u306f `FileETag MTime Size` \u307e\u305f\u306f `FileETag None` \u3092\u6307\u5b9a\u3059\u308b\u3068\u3044\u3044\u3060\u308d\u3046\u3002\n\nETag\u3092\u524a\u9664\u3057\u3066 `Last-Modified` \u30d8\u30c3\u30c0\u30fc\u3092\u4f7f\u3048\u3070 HTTP \u30d8\u30c3\u30c0\u30fc\u306e\u30b5\u30a4\u30ba\u304c\u305d\u306e\u5206\u5c11\u306a\u304f\u306a\u308b\u3068\u3044\u3046\u30e1\u30ea\u30c3\u30c8\u304c\u3042\u308b\u3002ETag \u3092\u51fa\u529b\u3057\u306a\u3044\u8a2d\u5b9a\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3002\n\n```apache\nFileETag None\n```\n\u4e0a\u8a18\u8a2d\u5b9a\u3067\u306f\u3046\u307e\u304f ETag \u304c\u6d88\u3048\u306a\u3044\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u6d88\u3059\u3053\u3068\u3082\u53ef\u80fd\u3002\n\n```apache\nHeader unset ETag\n```\n\n#### FileETag \u8a2d\u5b9a\u306e\u6319\u52d5\u691c\u8a3c\n| FileETag | ETag |\n|----------|------|\n| (\u672a\u6307\u5b9a)  | \"220-529841bdd9a78\" |\n| MTime Size | \"220-529841bdd9a78\" |\n| All      | \"905069-220-529841bdd9a78\" |\n| INode    | \"905069\" |\n| MTime    | \"529830adcea90\" |\n| Size     | \"220\" |\n\u516c\u5f0f\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f\u672a\u3060\u306b `FileETag INode MTime Size` \u3068\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b[^ETag]\u304c\u3001\u691c\u8a3c\u74b0\u5883\u3067\u691c\u8a3c\u3057\u305f\u3068\u3053\u308d\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f `MTime Size` \u3060\u3063\u305f\u3002~~\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u306e\u66f4\u65b0\u6f0f\u308c\u304b\u3001\u3042\u308b\u3044\u306f\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3067\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u5909\u66f4\u3057\u3066\u3044\u308b\u304b\u3002~~\u306f\u3066\u30d6\u3067\u6307\u6458\u304c\u3042\u3063\u305f\u306e\u3067\u30bd\u30fc\u30b9\u3092\u8abf\u3079\u305f\u3089[^ETag-github]Apache\u672c\u4f53\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u304c 2.4.0 \u304b\u3089\u5909\u308f\u3063\u3066\u305f\u306e\u3067\u3001\u3084\u306f\u308a\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u306e\u66f4\u65b0\u6f0f\u308c\u306e\u6a21\u69d8\u3002\uff08\u82f1\u8a9e\u7248[^ETag-ref24-en]\u306f\u6b63\u3057\u304f\u4fee\u6b63\u3055\u308c\u3066\u3044\u308b by @matuu\u3055\u3093\uff09\n\n[^ETag-ref24-en]: http://httpd.apache.org/docs/2.4/en/mod/core.html#fileetag\n\n```diff:docs/manual/mod/core.xml\n-<default>FileETag INode MTime Size</default>\n+<default>FileETag MTime Size</default>\n <contextlist><context>server config</context><context>virtual host</context>\n <context>directory</context><context>.htaccess</context>\n </contextlist>\n <override>FileInfo</override>\n+<compatibility>The default used to be \"INode&nbsp;MTime&nbsp;Size\" in 2.3.14 and\n+earlier.</compatibility>\n```\n```diff:include/http_core.h\n-#define ETAG_BACKWARD (ETAG_MTIME | ETAG_INODE | ETAG_SIZE)\n #define ETAG_ALL   (ETAG_MTIME | ETAG_INODE | ETAG_SIZE)\n+/* This is the default value used */\n+#define ETAG_BACKWARD (ETAG_MTIME | ETAG_SIZE)\n```\n```diff:modules/dav/fs/repos.c\n     if (ctx->finfo.filetype != APR_NOFILE) {\n          return apr_psprintf(ctx->pool, \"\\\"%\" APR_UINT64_T_HEX_FMT \"-%\"\n-                            APR_UINT64_T_HEX_FMT \"-%\" APR_UINT64_T_HEX_FMT \"\\\"\",\n+                            APR_UINT64_T_HEX_FMT \"\\\"\",\n-                            (apr_uint64_t) ctx->finfo.inode,\n                             (apr_uint64_t) ctx->finfo.size,\n                             (apr_uint64_t) ctx->finfo.mtime);\n      }\n```\n\n[^ETag]: http://httpd.apache.org/docs/2.4/ja/mod/core.html#fileetag\n[^ETag-github]: https://github.com/apache/httpd/commit/ba86234a7e627a50fdedc50b49ceaf40465911cb\n\n### X-Powered-By\n```\nX-Powered-By: PHP/5.4.16\n```\nHTTP \u30d8\u30c3\u30c0\u30fc\u306b\u4e0a\u8a18\u306e\u3088\u3046\u306b PHP \u306a\u3069\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u304c\u3042\u308b\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b Apache \u5074\u3067\u30d8\u30c3\u30c0\u30fc\u3092\u5f37\u5236\u524a\u9664\u3059\u308b\u3002\n\n```apache\nHeader unset X-Powered-By\n```\n\nPHP \u306e\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b php.ini \u306e `expose_php` \u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6 [^expose_php] \u3067\u975e\u8868\u793a\u306b\u3059\u308b\u8a2d\u5b9a\u304c\u53ef\u80fd\u3060\u304c\u3001Apache \u5074\u3067\u4e00\u5143\u7684\u306b\u5f37\u5236\u524a\u9664\u3057\u305f\u65b9\u304c\u8a2d\u5b9a\u6f0f\u308c\u306e\u30ea\u30b9\u30af\u304c\u306a\u3044\u3060\u308d\u3046\u3002\n\n```ini:php.ini\nexpose_php = Off\n```\n\n[^expose_php]: http://php.net/manual/ja/ini.core.php#ini.expose-php\n\n\n### Options -Indexes\n```apache\n<Directory /var/www/html>\n    Options -Indexes\n</Directory>\n```\nApache 2.0/2.2/2.4 \u5171\u306b `Options` \u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f `All`\u3002\n`DirectoryIndex` \u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6 [^DirectoryIndex] \u3067\u6307\u5b9a\u3057\u305f\u30d5\u30a1\u30a4\u30eb (index.html\u7b49) \u304c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u5185\u306b\u7121\u3044\u5834\u5408\u306b mod_autoindex \u304c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u5185\u306e\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u3092\u6574\u5f62\u3057\u3066\u8fd4\u3059\u3002\n[^DirectoryIndex]: https://httpd.apache.org/docs/2.4/ja/mod/mod_dir.html#directoryindex\n\n### autoindex.conf\n```bash\ncp /dev/null /etc/httpd/conf.d/autoindex.conf\n```\n\n\u307e\u305f\u306f\n\n```bash\n> /etc/httpd/conf.d/autoindex.conf\n```\nicons\u306e\u8a2d\u5b9a\u7b49\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u304c\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4e00\u89a7\u306f\u8868\u793a\u3055\u305b\u306a\u3044\u305f\u3081\u539f\u5247\u7684\u306b\u5229\u7528\u3057\u306a\u3044\u306e\u3067\u524a\u9664\u3002\u30d5\u30a1\u30a4\u30eb\u81ea\u4f53\u3092\u524a\u9664\u3059\u308b\u3068\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u6642\u306b\u518d\u4f5c\u6210\u3055\u308c\u308b\u306e\u3067\u3001\u7a7a\u30d5\u30a1\u30a4\u30eb\u306b\u3059\u308b\u3002\n\n### welcome.conf\n```bash\ncp /dev/null /etc/httpd/conf.d/welcome.conf\n```\n\n\u307e\u305f\u306f\n\n```bash\n> /etc/httpd/conf.d/welcome.conf\n```\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u306b index.html \u304c\u306a\u3044\u5834\u5408\u306a\u3069 Forbidden \u306b\u306a\u308b\u3068 CentOS \u306e\u30a6\u30a7\u30eb\u30ab\u30e0\u30da\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u308b\u304c\u3001\u4f59\u8a08\u306a\u60c5\u5831\u306b\u306a\u308b\u306e\u3067\u524a\u9664\u3002autoindex.conf \u3068\u540c\u69d8\u306b\u524a\u9664\u3059\u308b\u3068\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u6642\u306b\u518d\u4f5c\u6210\u3055\u308c\u308b\u305f\u3081\u7a7a\u30d5\u30a1\u30a4\u30eb\u306b\u3059\u308b\u3002\n\n## \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\n\n### AllowOverride\n```apache\n<Directory /var/www/html>\n    AllowOverride All\n</Directory>\n```\n`/etc/httpd/conf.d/userdir.conf` \u306e `<Directory \"/home/*/public_html\">` \u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b `AllowOverride` \u4ee5\u5916\u306f\u3059\u3079\u3066 `None` \u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001.htaccess \u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u914d\u4e0b\u3092\u500b\u5225\u306b\u8a31\u53ef\u3059\u308b\u3002\n\n### HTTP \u30e1\u30bd\u30c3\u30c9\u306e\u5236\u9650\n```apache:2.4\n<Directory /var/www/html>\n    Require method GET POST\n</Directory>\n```\n```apache:2.2\n<Directory /var/www/html>\n    <Limit GET POST>\n        Order allow,deny\n        Allow from all\n    </Limit>\n    <LimitExcept GET POST>\n        Order deny,allow\n        Deny from all\n    </LimitExcept>\n</IfVersion>\n```\n\n### X-Frame-Options\uff08\u30af\u30ea\u30c3\u30af\u30b8\u30e3\u30c3\u30ad\u30f3\u30b0\u5bfe\u7b56\uff09\n```apache\nHeader always append X-Frame-Options SAMEORIGIN\n```\n\n**X-Frame-Options** HTTP \u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u30fc\u306f\u3001\u30d6\u30e9\u30a6\u30b6\u30fc\u304c\u30da\u30fc\u30b8\u3092 `<frame>` \u307e\u305f\u306f `<iframe>` \u306e\u5185\u90e8\u306b\u8868\u793a\u3059\u308b\u3053\u3068\u3092\u8a31\u53ef\u3059\u308b\u304b\u3092\u793a\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\u30af\u30ea\u30c3\u30af\u30b8\u30e3\u30c3\u30ad\u30f3\u30b0\u5bfe\u7b56\u3068\u3057\u3066 IE8 \u304b\u3089\u5b9f\u88c5\u3055\u308c\u305f\u30aa\u30d7\u30b7\u30e7\u30f3\u30d8\u30c3\u30c0\u30fc\u3002\n\u81ea\u5206\u306e\u30b5\u30a4\u30c8\u306e\u30b3\u30f3\u30c6\u30f3\u30c4\u304c\u4ed6\u306e\u30b5\u30a4\u30c8\u306b\u57cb\u3081\u8fbc\u307e\u308c\u306a\u3044\u3053\u3068\u3092\u4fdd\u8a3c\u3059\u308b\u3002[^xfo-mdn]\n\n[^xfo-mdn]: https://developer.mozilla.org/ja/docs/HTTP/X-Frame-Options\n| \u8a2d\u5b9a\u5024 | \u5185\u5bb9 |\n|---|---|\n| `DENY` | \u30b5\u30a4\u30c8\u5074\u306e\u610f\u56f3\u306b\u95a2\u308f\u3089\u305a\u3001\u30da\u30fc\u30b8\u3092\u30d5\u30ec\u30fc\u30e0\u5185\u306b\u8868\u793a\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u306a\u3044\u3002\u540c\u3058\u30b5\u30a4\u30c8\u306e\u30da\u30fc\u30b8\u3092\u30d5\u30ec\u30fc\u30e0\u5185\u306b\u8aad\u307f\u8fbc\u3080\u3053\u3068\u3082\u4e0d\u53ef\u80fd\u306b\u306a\u308b\u3002 |\n| `SAMEORIGIN` | \u81ea\u8eab\u3068\u751f\u6210\u5143\u304c\u540c\u3058\u30d5\u30ec\u30fc\u30e0\u5185\u306b\u9650\u308a\u30da\u30fc\u30b8\u3092\u8868\u793a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\u5916\u90e8\u30b5\u30a4\u30c8\u306e\u30d5\u30ec\u30fc\u30e0\u5185\u306b\u30da\u30fc\u30b8\u3092\u8aad\u307f\u8fbc\u3080\u3053\u3068\u3092\u4e0d\u53ef\u80fd\u306b\u3059\u308b\u3002 |\n| `ALLOW-FROM uri` | \u6307\u5b9a\u3055\u308c\u305f\u751f\u6210\u5143\u306b\u9650\u308a\u3001\u30da\u30fc\u30b8\u3092\u30d5\u30ec\u30fc\u30e0\u5185\u306b\u8868\u793a\u3067\u304d\u308b\u3002Chrome\u3001Safari\u306f\u672a\u5bfe\u5fdc\u3002[^xfo-chromium] |\n\n[^xfo-chromium]: [Issue 511521 - chromium - \\`X-Frame-Options\\` does not support the \\`allow-from\\` directive. - Monorail](https://code.google.com/p/chromium/issues/detail?id=511521)\n\n`X-Frame-Options` \u306b\u5bfe\u5fdc\u3059\u308b\u30d6\u30e9\u30a6\u30b6\u30fc\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f IE8 \u4ee5\u4e0a\u3001Firefox 3.6.9 \u4ee5\u4e0a\u3001Chrome 4.1.249.1042 \u4ee5\u4e0a\u3001Safari 4 \u4ee5\u4e0a\u3001Opera 10.50 \u4ee5\u4e0a\u3002[^xfo]\n\n[^xfo]: [X-Frame-Options\u3001\u30d6\u30e9\u30a6\u30b6\u5bfe\u5fdc\u5b8c\u4e86 | \u30de\u30a4\u30ca\u30d3\u30cb\u30e5\u30fc\u30b9](http://news.mynavi.jp/articles/2010/09/10/x-frame-options-for-all-browsers/)\n\nGoogle\u3001Twitter\u3001Yahoo! JAPAN \u306a\u3069\u3067 `SAMEORIGIN` \u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u3002\nFacebook \u3067\u306f `DENY` \u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u3002\n### X-XSS-Protection\uff08XSS\u30d5\u30a3\u30eb\u30bf\u30fc\u6a5f\u80fd\uff09\n\n```apache\nHeader always set X-XSS-Protection \"1; mode=block\"\n```\n`X-XSS-Protection` \u306f\u30d6\u30e9\u30a6\u30b6\u306e XSS \u30d5\u30a3\u30eb\u30bf\u30fc\u6a5f\u80fd\u3092\u5236\u5fa1\u3067\u304d\u308b\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u30fc\u3002\n`0` \u306f\u7121\u52b9\u3001 `1` \u306f\u6709\u52b9\uff08\u90e8\u5206\u7684\u66f8\u304d\u63db\u3048\uff09\u3001 `1; mode=block` \u306f\u6709\u52b9\uff08\u8868\u793a\u306e\u5b8c\u5168\u306a\u505c\u6b62\uff09\u3092\u610f\u5473\u3059\u308b\u3002\n\u30b5\u30a4\u30c8\u306e XSS \u5bfe\u7b56\u306b\u554f\u984c\u306f\u306a\u304f\u8aa4\u691c\u77e5\u3092\u306a\u304f\u3057\u305f\u3044\u5834\u5408\u306f `0` \u3092\u3001\u305d\u3046\u3067\u306a\u3044\u5834\u5408\u306f `1; mode=block` \u3092\u6307\u5b9a\u3059\u308b\u306e\u304c\u671b\u307e\u3057\u304f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e `1` \u306e\u72b6\u614b\u306f\u671b\u307e\u3057\u304f\u306a\u3044\u3002 [^xss-protection]\n\nGoogle\u3001Twitter\u3001Yahoo! JAPAN \u306a\u3069\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u3002\nFacebook \u3067\u306f `0` \u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u3002\n\n[^xss-protection]: http://www.slideshare.net/masatokinugawa/xxn-ja/98\n\n### X-Content-Type-Options\n\n```apache\nHeader always set X-Content-Type-Options nosniff\n```\n`X-Content-Type-Options` \u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u30fc\u306e\u5024\u306b `nosniff` \u3092\u8a2d\u5b9a\u3057\u3066\u9001\u4fe1\u3059\u308b\u3068\u3001Internet Explorer \u304c MIME Sniffing \u6a5f\u80fd\u3067 content-type \u5ba3\u8a00\u3092\u56de\u907f\u3059\u308b\u306e\u3092\u9632\u6b62\u3067\u304d\u308b\u3002[^nosniff]\n\n[^nosniff]: [2008/9/3 - Internet Explorer 8 \u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3 Part VI: Beta 2 \u306e\u66f4\u65b0\u9805\u76ee](https://msdn.microsoft.com/ja-jp/dd218497.aspx)\n\nFacebook\u3001Twitter\u3001Yahoo! JAPAN \u306a\u3069\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u3002\n\n### Content Security Policy (CSP)\n\u7d20\u4eba\u306b\u306f\u304a\u52e7\u3081\u3067\u304d\u306a\u3044\u3002\nhttps://content-security-policy.com/\nhttp://blog.hash-c.co.jp/2013/12/Content-Security-Policy-CSP.html\n\n### httpoxy \u5bfe\u7b56\nFoo: Bar \u3063\u3066\u3044\u3046 header \u9001\u3063\u305f\u3089 CGI \u306e spec \u7684\u306b\u306f HTTP_Foo = Bar \u306b\u3057\u3066\u304f\u308c\u308b\u3063\u3066\u3044\u3046\u4ed5\u69d8\u3092\u7a81\u3044\u3066 PROXY: xxx \u3063\u3066\u3044\u3046header\u9001\u308b\u3068 HTTP_PROXY\u66f8\u304d\u63db\u3048\u3089\u308c\u308b\u3093\u3058\u3083\u306d\u3063\u3066\u3044\u3046\u8106\u5f31\u6027\u3002[^294900783]\n[HTTPOXY Vulnerability Checking Tool](https://httpoxy.rehmann.co/) \u3067\u30c6\u30b9\u30c8\u3067\u304d\u308b\u3002\n\u4ee5\u4e0b\u306e\u30bd\u30d5\u30c8\u30a6\u30a8\u30a2\u304c\u5f71\u97ff\u3092\u53d7\u3051\u308b\u3002[^JPCERT-AT-2016-0031]\n\n - PHP (CVE-2016-5385)\n - GO (CVE-2016-5386)\n - Apache HTTP Server (CVE-2016-5387)\n - Apache Tomcat (CVE-2016-5388)\n - HHVM (CVE-2016-1000109)\n - Python (CVE-2016-1000110\n\n[^294900783]: http://b.hatena.ne.jp/entry/294900783/comment/yosuke_furukawa\n[^JPCERT-AT-2016-0031]: [CGI \u7b49\u3092\u5229\u7528\u3059\u308b Web \u30b5\u30fc\u30d0\u306e\u8106\u5f31\u6027 (CVE-2016-5385 \u7b49) \u306b\u95a2\u3059\u308b\u6ce8\u610f\u559a\u8d77](https://www.jpcert.or.jp/at/2016/at160031.html)\n\n### LimitRequestBody\n\u3053\u306e\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306f\u30ea\u30af\u30a8\u30b9\u30c8\u30dc\u30c7\u30a3\u306b\u8a31\u3055\u308c\u308b\u30d0\u30a4\u30c8\u6570\u3092\u6307\u5b9a\u3059\u308b\u3002\n\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u304c\u66f8\u304b\u308c\u305f\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\uff08\u30b5\u30fc\u30d0\u5168\u4f53\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3001\u30d5\u30a1\u30a4\u30eb\u3001\u30ed\u30b1\u30fc\u30b7\u30e7\u30f3\uff09\u5185\u3067\u8a31\u5bb9\u3059\u308b HTTP \u30ea\u30af\u30a8\u30b9\u30c8\u30e1\u30c3\u30bb\u30fc\u30b8\u30dc\u30c7\u30a3\u306e\u30b5\u30a4\u30ba\u306b\u5236\u9650\u3092\u304b\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f `0` \u3067\u7121\u5236\u9650\u3002\u4e0a\u9650\u306f `2147483647` (2GB) \u307e\u3067\u3002\n\n```apache\nLimitRequestBody 10485760\n```\n10MiB \u306b\u5236\u9650\u3057\u305f\u3044\u5834\u5408\u306f\u4e0a\u8a18\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3002\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u3067 DoS \u653b\u6483\u3092\u907f\u3051\u308b\u306e\u306b\u6709\u52b9\u3068\u3057\u3066\u3044\u308b\u3002\n\n\u306a\u304a\u3001PHP \u3067\u306f\u4ee5\u4e0b\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u4f75\u305b\u3066\u78ba\u8a8d\u3057\u305f\u3044\u3002\n\n```ini:php.ini\nmemory_limit = 128M\npost_max_size = 8M\nupload_max_filesize = 5M\n```\n\n### LimitRequestFields\n\u3053\u306e\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306f HTTP \u30ea\u30af\u30a8\u30b9\u30c8\u306b\u304a\u3044\u3066\u8a31\u53ef\u3059\u308b\u30ea\u30af\u30a8\u30b9\u30c8\u30d8\u30c3\u30c0\u30d5\u30a3\u30fc\u30eb\u30c9\u6570\u3092\u6307\u5b9a\u3059\u308b\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f `100` \u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n```apache\nLimitRequestFields 20\n```\n\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u306b\u306f\u300c\u30ea\u30af\u30a8\u30b9\u30c8\u30d8\u30c3\u30c0\u30fc\u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u6570\u304c 20 \u3092\u8d85\u3048\u308b\u3053\u3068\u306f\u307b\u3068\u3093\u3069\u306a\u3044\u3002\u300d[^limitrequestbody] \u3068\u3042\u308b\u3002\u307e\u305f\u3001DoS \u653b\u6483\u3092\u907f\u3051\u308b\u306e\u306b\u6709\u52b9\u3068\u3057\u3066\u3044\u308b\u3002\n\n[^limitrequestbody]: http://httpd.apache.org/docs/2.4/mod/core.html#limitrequestbody\n\n### RequestReadTimeout\n```apache\nRequestReadTimeout header=20-40,MinRate=500 body=20,MinRate=500\n```\nslowloris [^slowloris] \u5bfe\u7b56\u3067\u5b9f\u88c5\u3055\u308c\u305f mod_reqtimeout \u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u4f7f\u7528\u3067\u304d\u308b\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3002\n2.2.15 \u4ee5\u964d\u306b\u5b9f\u88c5\u3055\u308c\u30012.3.15 \u4ee5\u964d\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u6709\u52b9\u306b\u306a\u3063\u305f\u3002\n\nAWS \u306e ELB \u3092\u5229\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u3001 ELB \u306e `Connection Settings: Idle Timeout` \u306e\u5024\u304c Apache \u306e `RequestReadTimeout header` \u306e\u6700\u4f4e\u5024\u3088\u308a\u3082\u5927\u304d\u3044\u3068\u3001 Apache \u306e\u30a8\u30e9\u30fc\u30ed\u30b0\u306b 408 \u304c\u5927\u91cf\u306b\u5410\u304b\u308c\u3066\u3057\u307e\u3046\u3088\u3046\u306a\u306e\u3067\u6ce8\u610f\u3002[^slowloris-elb]\n\n[^slowloris]: [Apache\u306b\u65b0\u305f\u306a\u8106\u5f31\u6027\u767a\u898b | \u30b9\u30e9\u30c9 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3](http://security.srad.jp/story/09/06/23/0455215/)\n\n[^slowloris-elb]: [\u300cELB\u304b\u3089\u306e\u901a\u4fe1\u3067408\u304c\u591a\u767a\u3059\u308b\u300d\u4ef6\u3067\u3001\u7d50\u5c40\u3069\u3046\u3059\u3079\u304d\u304b\u8abf\u3079\u305f\u306e\u3067\u307e\u3068\u3081\u305f - \u53cc\u516d\u5de5\u5834\u65e5\u8a8c](http://sechiro.hatenablog.com/entry/2014/12/07/%E3%80%8CELB%E3%81%8B%E3%82%89%E3%81%AE%E9%80%9A%E4%BF%A1%E3%81%A7408%E3%81%8C%E5%A4%9A%E7%99%BA%E3%81%99%E3%82%8B%E3%80%8D%E4%BB%B6%E3%81%A7%E3%80%81%E7%B5%90%E5%B1%80%E3%81%A9%E3%81%86%E3%81%99)\n\n## \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30c6\u30b9\u30c8\nCentOS 7.2.1511 \u306b yum \u3067 Apache \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u8a2d\u5b9a\u5909\u66f4\u3057\u3066\u3044\u306a\u3044\u30b1\u30fc\u30b9\u3092\u30c6\u30b9\u30c8\u3057\u305f\u7d50\u679c\u3002\n\n```bash\n[root@localhost program]# perl ./nikto.pl -h 127.0.0.1\n- ***** SSL support not available (see docs for SSL install) *****\n- Nikto v2.1.6\n---------------------------------------------------------------------------\n+ Target IP:          127.0.0.1\n+ Target Hostname:    127.0.0.1\n+ Target Port:        80\n+ Start Time:         2016-01-16 10:00:00 (GMT9)\n---------------------------------------------------------------------------\n+ Server: Apache/2.4.6 (CentOS) PHP/5.4.16\n+ Server leaks inodes via ETags, header found with file /, fields: 0x220 0x529841bdd9a78\n+ The anti-clickjacking X-Frame-Options header is not present.\n+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS\n+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type\n+ PHP/5.4.16 appears to be outdated (current is at least 5.6.9). PHP 5.5.25 and 5.4.41 are also current.\n+ Apache/2.4.6 appears to be outdated (current is at least Apache/2.4.16). Apache 2.2.31 is also current for the 2.x branch.\n+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS, TRACE\n+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST\n+ Retrieved x-powered-by header: PHP/5.4.16\n+ OSVDB-3092: /test.php: This might be interesting...\n+ 8225 requests: 0 error(s) and 10 item(s) reported on remote host\n+ End Time:           2016-01-16 10:00:11 (GMT9) (11 seconds)\n---------------------------------------------------------------------------\n+ 1 host(s) tested\n```\n# Apache \u95a2\u9023\u8a18\u4e8b\n* [Apache\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a](http://qiita.com/bezeklik/items/1c4145652661cf5b2271)\n* [Apache HTTP Server \u306e\u30b5\u30dd\u30fc\u30c8\u671f\u9650](http://qiita.com/bezeklik/items/7e2c02c3eabd2a416231)\n* [Apache \u306e\u30ed\u30b0\u3092\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067\u96c6\u8a08\u3059\u308b](http://qiita.com/bezeklik/items/f5c292c4360cde140bef)\n* [Apache \u306e\u60c5\u5831\u3092\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067\u53d6\u5f97\u3059\u308b](http://qiita.com/bezeklik/items/7bbfcbcfeb05c1d57fec)\n* [IP\u30a2\u30c9\u30ec\u30b9\u304b\u3089\u56fd\u3084\u90fd\u5e02\u3092\u5224\u5225\u3059\u308b (GeoIP)](http://qiita.com/bezeklik/items/927e1c52c8c0aefb1f06)\n* [Apache \u30c1\u30e5\u30fc\u30cb\u30f3\u30b0 \u30b9\u30af\u30ea\u30d7\u30c8](http://qiita.com/bezeklik/items/85f4001a2517be5fe4c0)\n\n# \u53c2\u7167\u60c5\u5831\n", "tags": ["Apache2.2, 2.4", "CentOS6.7, 7.2.1511", "\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3"]}