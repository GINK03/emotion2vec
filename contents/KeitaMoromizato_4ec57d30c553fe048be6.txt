{"context": " More than 1 year has passed since last update.\n\n\u6982\u8981\n\u5f0a\u793e\u3067\u306f\u4e00\u90e8\u306e\u793e\u5185\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067Sails.js\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u305d\u306e\u4e2d\u3067\u5f97\u3089\u308c\u305f\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3084\u3089\u30d0\u30c3\u30c9\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3092\u307e\u3068\u3081\u3066\u3044\u3053\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\u7b2c2\u56de\u306fController\u306e\u4f5c\u308a\u65b9\u306b\u3064\u3044\u3066\u3002\n\n\u52d5\u4f5c\u74b0\u5883\n\nnode.js v0.12.7\nSails.js v0.11.2\nsails-mysql v0.11.0\n\n\n\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u6982\u8981\nView(ejs) -> ViewController -> ApiController -> Service -> Model\u306e5\u5c64\u69cb\u9020\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002View\u3068Model\u306f\u751f\u306eSails.js\u3001Service\u3082\u3088\u304f\u3042\u308bService\u5c64\u306a\u306e\u3067\u3001\u3053\u3053\u3067\u306fViewController\u3068ApiController\u306b\u3064\u3044\u3066\u8a73\u3057\u304f\u8aac\u660e\u3057\u307e\u3059\u3002\n\nViewController\u3068ApiController\nSails.js\u3067\u306f\u3001View(html)\u3092\u8fd4\u3059\u304bjson\u3092\u8fd4\u3059\u304b\u3068\u3044\u3046\u9055\u3044\u3092\u3001\u305f\u3063\u305f1\u884c\u306e\u30b3\u30fc\u30c9\u3067\u8868\u73fe\u3067\u304d\u307e\u3059\u3002\n\nHogeController.ts\nclass HogeController {\n\n  // hogepage\u3092\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3057\u3066\u8fd4\u3059action\n  find(req, res) {\n    Hoge.find().then(hoges => {\n      res.view('hogepage', hoges);\n    });\n  }\n\n  // hoges\u306ejson\u3092\u8fd4\u3059action\n  findOne(req, res) {\n    Hoge.find().then(hoges => {\n      res.send(hoges);\n    });\n  }\n}\n\nexport default new HogeController();\n\n\n\u3053\u306e\u4ed5\u7d44\u307f\u306f\u30b5\u30af\u30c3\u3068\u30b3\u30fc\u30c9\u3092\u66f8\u304f\u306b\u306f\u4fbf\u5229\u306a\u306e\u3067\u3059\u304c\u3001\u898f\u6a21\u304c\u5927\u304d\u304f\u306a\u3063\u3066\u304f\u308b\u3068\u6df7\u4e71\u304c\u751f\u3058\u307e\u3059\u3002View\u3092\u8fd4\u3059action\u3068json\u3092\u8fd4\u3059action\u304c\u5165\u308a\u6df7\u3058\u308a\u3001\u3069\u306eController\u306b\u3069\u306e\u30e1\u30bd\u30c3\u30c9\u304c\u3042\u308b\u306e\u304b\u3001\u628a\u63e1\u3059\u308b\u3053\u3068\u304c\u96e3\u3057\u304f\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001ViewController\u3068ApiController\u3092\u660e\u78ba\u306b\u5206\u96e2\u3057\u3066\u3044\u307e\u3059\u3002\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5f62\u3067\u3059\u3002API\u7528HogeController\u306e\u30d1\u30b9\u304c api/controllers/api/HogeController.ts\u3068api\u304c\u7d9a\u304f\u306e\u304c\u82e5\u5e72\u6c17\u6301\u3061\u60aa\u3044\u3067\u3059\u304c\u3001\u3053\u306e\u69cb\u6210\u306a\u3089Sails.js\u306eblueprint\u6a5f\u80fd\u3067GET /api/hoge/find \u306e\u3088\u3046\u306aURL\u304c\u81ea\u52d5\u7684\u306b\u7d10\u4ed8\u304f\u306e\u3067\u7d50\u69cb\u4fbf\u5229\u3067\u3059\u3002\n/api\n |_/controllers\n   |_HogeController.ts\n   |_/api\n     |_HogeController.ts\n\n\u307e\u305f\u3001ViewController\u306f\u76f4\u63a5Service\u5c64\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3053\u3068\u306f\u306a\u304f\u3001ApiController\u7d4c\u7531\u3067\u5168\u3066\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\nAPI Controller\u306e\u30b5\u30f3\u30d7\u30eb\nAPIController\u306f\u76f4\u63a5API\u3068\u3057\u3066\u53e9\u304f\u30b1\u30fc\u30b9\u3068\u3001ViewController\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3055\u308c\u308b\u30b1\u30fc\u30b9\u304c\u3042\u308a\u307e\u3059\u3002\u305f\u3060\u3001\u3053\u306e\u9055\u3044\u306fViewController\u306e\u65b9\u3067\u5438\u53ce\u3057\u3066\u3044\u308b\u305f\u3081\u3001APIController\u3067\u306f\u666e\u901a\u306b res.ok \u3067success\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3001 res.send \u3067\u30a8\u30e9\u30fc\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u8fd4\u3057\u3066\u3044\u308b\u3060\u3051\u3067\u3059\u3002\n\napi/controllers/api/TagController.ts\nclass TagController {\n  'use strict';\n\n  constructor() { }\n\n  find(req, res) {\n    sails.log.verbose('api::TagController#find');\n    sails.log.verbose('params', req.allParams());\n    sails.log.verbose(`user=${(req.user ? req.user.id : 'null') }`);\n\n    const page = +req.param('page') || 1;\n\n    TagService.find({\n      limit: 30,\n      page: page\n    }).then((tags) => {\n\n      res.ok(tags);\n\n    }).catch((error) => {\n      sails.log.error(\"api::TagController.find\", error);\n      res.send(500);\n    });\n  }\n\n\n\nView Controller\u306e\u30b5\u30f3\u30d7\u30eb\nViewController\u304b\u3089ApiController\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306b\u3001express\u306eres\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u540c\u3058I/F\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u6e21\u3057\u3066\u7d50\u679c\u3092\u53d7\u3051\u53d6\u3063\u3066\u3044\u307e\u3059\u3002(\u3061\u3087\u3063\u3068\u4f5c\u308a\u306f\u96d1\u3067\u3059\u304c)TypeScript\u3067\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u3044\u308b\u306e\u3067\u3001\u30d9\u30fc\u30b9\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u3066\u5171\u901a\u5316\u3057\u3066\u3044\u307e\u3059\u3002\n\napi/controller/BaseController.ts\nexport default class BaseController {\n  Api(method, req) {\n    return new Promise((resolve, reject) => {\n      method(req, {\n        ok: (result) => {\n          resolve(result);\n        },\n        send: (error, result) => {\n          if (typeof error === 'object') {\n            return resolve(result);\n          }\n\n          reject(new NetworkError('API call Error', error));\n        }\n      });\n    });\n  }\n\n\n\u5b9f\u969b\u306eViewController\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9f\u88c5\u3057\u307e\u3059\u3002\u5148\u307b\u3069\u306eBaseController\u3092\u7d99\u627f\u3057\u3001ApiController\u306e\u30e1\u30bd\u30c3\u30c9\u3092Api()\u30e1\u30bd\u30c3\u30c9\u3092\u5229\u7528\u3057\u3066\u547c\u3073\u51fa\u3057\u3066\u3044\u307e\u3059\u3002\n\napi/controller/TagController.ts\nimport BaseController from './BaseController';\nimport ApiTagController from './api/TagController';\n\nclass TagController extends BaseController {\n\n  find(req, res) {\n    sails.log.verbose('view::TagController#find');\n    sails.log.verbose('params', req.allParams());\n    sails.log.verbose(`user=${req.user ? req.user.id : \"null\"}`);\n\n    this.Api(ApiTagController.all, req).then(tags => {\n\n      res.view('tagpage', tags);\n\n    }).catch(error => {\n      // error\n    });\n  }\n}\n\nexport default new TagController();\n\n\n\n\u307e\u3068\u3081\nViewController\u3068ApiController\u3092\u660e\u78ba\u306b\u5f79\u5272\u3092\u5206\u3051\u308b\u3053\u3068\u3067\u3001\u53ef\u8aad\u6027\u304c\u4e0a\u304c\u308a\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u6027\u304c\u5411\u4e0a\u3057\u307e\u3059\u3002\u4f55\u3067\u3082\u51fa\u6765\u308b\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3068\u3044\u3046\u3082\u306e\u306f\u7834\u7dbb\u3055\u305b\u308b\u3053\u3068\u3082\u7c21\u5358\u306a\u306e\u3067\u3001\u9069\u5207\u306a\u30eb\u30fc\u30eb\u3092\u4f5c\u3063\u3066\u904b\u7528\u3057\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\n# \u6982\u8981\n\u5f0a\u793e\u3067\u306f\u4e00\u90e8\u306e\u793e\u5185\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067Sails.js\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u305d\u306e\u4e2d\u3067\u5f97\u3089\u308c\u305f\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3084\u3089\u30d0\u30c3\u30c9\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3092\u307e\u3068\u3081\u3066\u3044\u3053\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\u7b2c2\u56de\u306fController\u306e\u4f5c\u308a\u65b9\u306b\u3064\u3044\u3066\u3002\n\n# \u52d5\u4f5c\u74b0\u5883\n* node.js v0.12.7\n* Sails.js v0.11.2\n* sails-mysql v0.11.0\n\n# \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u6982\u8981\nView(ejs) -> ViewController -> ApiController -> Service -> Model\u306e5\u5c64\u69cb\u9020\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002View\u3068Model\u306f\u751f\u306eSails.js\u3001Service\u3082\u3088\u304f\u3042\u308bService\u5c64\u306a\u306e\u3067\u3001\u3053\u3053\u3067\u306fViewController\u3068ApiController\u306b\u3064\u3044\u3066\u8a73\u3057\u304f\u8aac\u660e\u3057\u307e\u3059\u3002\n\n## ViewController\u3068ApiController\nSails.js\u3067\u306f\u3001View(html)\u3092\u8fd4\u3059\u304bjson\u3092\u8fd4\u3059\u304b\u3068\u3044\u3046\u9055\u3044\u3092\u3001\u305f\u3063\u305f1\u884c\u306e\u30b3\u30fc\u30c9\u3067\u8868\u73fe\u3067\u304d\u307e\u3059\u3002\n\n```js:HogeController.ts\nclass HogeController {\n\n  // hogepage\u3092\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3057\u3066\u8fd4\u3059action\n  find(req, res) {\n    Hoge.find().then(hoges => {\n      res.view('hogepage', hoges);\n    });\n  }\n  \n  // hoges\u306ejson\u3092\u8fd4\u3059action\n  findOne(req, res) {\n    Hoge.find().then(hoges => {\n      res.send(hoges);\n    });\n  }\n}\n\nexport default new HogeController();\n```\n\n\u3053\u306e\u4ed5\u7d44\u307f\u306f\u30b5\u30af\u30c3\u3068\u30b3\u30fc\u30c9\u3092\u66f8\u304f\u306b\u306f\u4fbf\u5229\u306a\u306e\u3067\u3059\u304c\u3001\u898f\u6a21\u304c\u5927\u304d\u304f\u306a\u3063\u3066\u304f\u308b\u3068\u6df7\u4e71\u304c\u751f\u3058\u307e\u3059\u3002View\u3092\u8fd4\u3059action\u3068json\u3092\u8fd4\u3059action\u304c\u5165\u308a\u6df7\u3058\u308a\u3001\u3069\u306eController\u306b\u3069\u306e\u30e1\u30bd\u30c3\u30c9\u304c\u3042\u308b\u306e\u304b\u3001\u628a\u63e1\u3059\u308b\u3053\u3068\u304c\u96e3\u3057\u304f\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001ViewController\u3068ApiController\u3092\u660e\u78ba\u306b\u5206\u96e2\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5f62\u3067\u3059\u3002API\u7528HogeController\u306e\u30d1\u30b9\u304c `api/controllers/api/HogeController.ts`\u3068`api`\u304c\u7d9a\u304f\u306e\u304c\u82e5\u5e72\u6c17\u6301\u3061\u60aa\u3044\u3067\u3059\u304c\u3001\u3053\u306e\u69cb\u6210\u306a\u3089Sails.js\u306eblueprint\u6a5f\u80fd\u3067`GET /api/hoge/find` \u306e\u3088\u3046\u306aURL\u304c\u81ea\u52d5\u7684\u306b\u7d10\u4ed8\u304f\u306e\u3067\u7d50\u69cb\u4fbf\u5229\u3067\u3059\u3002\n\n```\n/api\n |_/controllers\n   |_HogeController.ts\n   |_/api\n     |_HogeController.ts\n```\n\n\u307e\u305f\u3001ViewController\u306f\u76f4\u63a5Service\u5c64\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3053\u3068\u306f\u306a\u304f\u3001ApiController\u7d4c\u7531\u3067\u5168\u3066\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n### API Controller\u306e\u30b5\u30f3\u30d7\u30eb\nAPIController\u306f\u76f4\u63a5API\u3068\u3057\u3066\u53e9\u304f\u30b1\u30fc\u30b9\u3068\u3001ViewController\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3055\u308c\u308b\u30b1\u30fc\u30b9\u304c\u3042\u308a\u307e\u3059\u3002\u305f\u3060\u3001\u3053\u306e\u9055\u3044\u306fViewController\u306e\u65b9\u3067\u5438\u53ce\u3057\u3066\u3044\u308b\u305f\u3081\u3001APIController\u3067\u306f\u666e\u901a\u306b `res.ok` \u3067success\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3001 `res.send` \u3067\u30a8\u30e9\u30fc\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u8fd4\u3057\u3066\u3044\u308b\u3060\u3051\u3067\u3059\u3002\n\n```ts:api/controllers/api/TagController.ts\nclass TagController {\n  'use strict';\n\n  constructor() { }\n\n  find(req, res) {\n    sails.log.verbose('api::TagController#find');\n    sails.log.verbose('params', req.allParams());\n    sails.log.verbose(`user=${(req.user ? req.user.id : 'null') }`);\n\n    const page = +req.param('page') || 1;\n\n    TagService.find({\n      limit: 30,\n      page: page\n    }).then((tags) => {\n\n      res.ok(tags);\n\n    }).catch((error) => {\n      sails.log.error(\"api::TagController.find\", error);\n      res.send(500);\n    });\n  }\n```\n\n### View Controller\u306e\u30b5\u30f3\u30d7\u30eb\nViewController\u304b\u3089ApiController\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306b\u3001express\u306e`res`\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u540c\u3058I/F\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u6e21\u3057\u3066\u7d50\u679c\u3092\u53d7\u3051\u53d6\u3063\u3066\u3044\u307e\u3059\u3002(\u3061\u3087\u3063\u3068\u4f5c\u308a\u306f\u96d1\u3067\u3059\u304c)TypeScript\u3067\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u3044\u308b\u306e\u3067\u3001\u30d9\u30fc\u30b9\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u3066\u5171\u901a\u5316\u3057\u3066\u3044\u307e\u3059\u3002\n\n``` ts:api/controller/BaseController.ts\nexport default class BaseController {\n  Api(method, req) {\n    return new Promise((resolve, reject) => {\n      method(req, {\n        ok: (result) => {\n          resolve(result);\n        },\n        send: (error, result) => {\n          if (typeof error === 'object') {\n            return resolve(result);\n          }\n\n          reject(new NetworkError('API call Error', error));\n        }\n      });\n    });\n  }\n```\n\n\u5b9f\u969b\u306eViewController\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9f\u88c5\u3057\u307e\u3059\u3002\u5148\u307b\u3069\u306e`BaseController`\u3092\u7d99\u627f\u3057\u3001`ApiController`\u306e\u30e1\u30bd\u30c3\u30c9\u3092`Api()`\u30e1\u30bd\u30c3\u30c9\u3092\u5229\u7528\u3057\u3066\u547c\u3073\u51fa\u3057\u3066\u3044\u307e\u3059\u3002\n\n```ts:api/controller/TagController.ts\nimport BaseController from './BaseController';\nimport ApiTagController from './api/TagController';\n\nclass TagController extends BaseController {\n\n  find(req, res) {\n    sails.log.verbose('view::TagController#find');\n    sails.log.verbose('params', req.allParams());\n    sails.log.verbose(`user=${req.user ? req.user.id : \"null\"}`);\n\n    this.Api(ApiTagController.all, req).then(tags => {\n\n      res.view('tagpage', tags);\n\n    }).catch(error => {\n      // error\n    });\n  }\n}\n\nexport default new TagController();\n```\n\n# \u307e\u3068\u3081\nViewController\u3068ApiController\u3092\u660e\u78ba\u306b\u5f79\u5272\u3092\u5206\u3051\u308b\u3053\u3068\u3067\u3001\u53ef\u8aad\u6027\u304c\u4e0a\u304c\u308a\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u6027\u304c\u5411\u4e0a\u3057\u307e\u3059\u3002\u4f55\u3067\u3082\u51fa\u6765\u308b\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3068\u3044\u3046\u3082\u306e\u306f\u7834\u7dbb\u3055\u305b\u308b\u3053\u3068\u3082\u7c21\u5358\u306a\u306e\u3067\u3001\u9069\u5207\u306a\u30eb\u30fc\u30eb\u3092\u4f5c\u3063\u3066\u904b\u7528\u3057\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\n", "tags": ["Sails.js"]}