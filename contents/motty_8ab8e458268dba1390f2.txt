{"context": " More than 1 year has passed since last update.\n\u3053\u306e\u8a18\u4e8b\u3092\u5143\u306b\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\nhttps://insights.ubuntu.com/2016/02/16/zfs-is-the-fs-for-containers-in-ubuntu-16-04/\n\nIDCF\u30af\u30e9\u30a6\u30c9\u306e\u6e96\u5099\n\n\u307e\u305a\u306f\u3001ubuntu16.04\u7528\u306eISO\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nISO\u30a4\u30e1\u30fc\u30b8\u306f\u3053\u3053\u306eURL\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5148\u3068\u3057\u3066\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\nhttp://cdimage.ubuntu.com/ubuntu-server/daily/current/xenial-server-amd64.iso\n\nISO\u306e\u5834\u5408\u306f\u3001\u30eb\u30fc\u30c8\u30c7\u30a3\u30b9\u30af\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u6a19\u6e96\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u5834\u5408\u306f15GB\u304c\u81ea\u52d5\u3067\u9078\u629e\u3055\u308c\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f15GB\u3092\u6307\u5b9a\u3057\u307e\u3059\n\nISO\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u4e2d\u306e\u753b\u9762\n\nISO\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4e2d\u306e\u753b\u9762\n\nISO\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u6210\u529f\u3057\u305f\u753b\u9762\n\n\nVM\u3092\u8d77\u52d5\u3055\u305b\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u8d77\u52d5\u753b\u9762\u306b\u306a\u308b\u306e\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\n\n\n\u3082\u308d\u3082\u308d\u8a2d\u5b9a\u3057\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u9078\u629e\u3055\u308c\u3066\u3044\u308b standard system utilities \u306e\u307b\u304b\u3001OpenSSH server \u3092\u9078\u629e\n\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001\u518d\u8d77\u52d5\n\u518d\u8d77\u52d5\u5f8c\u3001VM\u306b\u5bfe\u3057\u3066\u30d5\u30a1\u30a4\u30a2\u30d5\u30a9\u30fc\u30eb\u3001\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u7b49\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u3001\u4f5c\u6210\u3057\u305fVM\u306bSSH\u3059\u308b\u3002\nzfs\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u3042\u308b\u306e\u3092\u78ba\u8a8d\n\n$ locate zfs.ko\n/lib/modules/4.4.0-6-generic/kernel/zfs/zfs/zfs.ko\n\u30ed\u30fc\u30c9\u306f\u3055\u308c\u3066\u3044\u306a\u3044\u3002\u3002\n$ lsmod | grep zfs\n$\n\nmodprobe\u3067\u30ed\u30fc\u30c9\u3059\u308b\n\u203b\u6b21\u56de\u3001\u518d\u8d77\u52d5\u5f8c\u3082\u8d77\u52d5\u6642\u306b\u30ed\u30fc\u30c9\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n$ sudo modprobe zfs\n\n\u30ed\u30fc\u30c9\u3055\u308c\u305f\n\n$ lsmod | grep zfs\nzfs                  2801664  4\nzunicode              331776  1 zfs\nzcommon                57344  1 zfs\nznvpair                90112  2 zfs,zcommon\nspl                   102400  3 zfs,zcommon,znvpair\nzavl                   16384  1 zfs\n\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n$ head -n1 /etc/issue\nUbuntu Xenial Xerus (development branch) \\n \\l\nlxd\u3068zfs\u95a2\u9023\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo apt install lxd zfsutils-linux\n\u521d\u671f\u8a2d\u5b9a\n$ sudo lxd init\nName of the storage backend to use (dir or zfs): zfs\nCreate a new ZFS pool (yes/no)? yes\nName of the new ZFS pool: lxd\nWould you like to use an existing block device (yes/no)? no\nSize in GB of the new loop device (1GB minimum): 2\nWould you like LXD to be available over the network (yes/no)? no \nLXD has been successfully configured.\nzfs\u3068\u3057\u3066\u8a8d\u8b58\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\n$ sudo zpool list\nNAME   SIZE  ALLOC   FREE  EXPANDSZ   FRAG    CAP  DEDUP  HEALTH  ALTROOT\nlxd   1.98G   470K  1.98G         -     0%     0%  1.00x  ONLINE  -\nzpool\u30b9\u30c6\u30fc\u30bf\u30b9\u78ba\u8a8d\n```$ sudo zpool status\n  pool: lxd\n state: ONLINE\n  scan: none requested\nconfig:\nNAME                    STATE     READ WRITE CKSUM\nlxd                     ONLINE       0     0     0\n  /var/lib/lxd/zfs.img  ONLINE       0     0     0\n\nerrors: No known data errors```\nlxd\u78ba\u8a8d\n$ sudo lxc config get storage.zfs_pool_name\nstorage.zfs_pool_name: lxd\nlxd\u30b0\u30eb\u30fc\u30d7\u3092\u65b0\u898f\u4f5c\u6210\n$ newgrp lxd\nlxd\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\n$ lxd-images import ubuntu --alias ubuntu\nDownloading the GPG key for http://cloud-images.ubuntu.com\nValidating the GPG signature of /tmp/tmp1mgm39av/download.json.asc\nDownloading the image.\nImage manifest: http://cloud-images.ubuntu.com/server/releases/trusty/release-20160217.1/ubuntu-14.04-server-cloudimg-amd64.manifest\nImage imported as: 7336a7a1ae64878292ba7ea1905a2e98438a4894c3257504a32244bedf809feb\nSetup alias: ubuntu\n\n3\u30b3\u30f3\u30c6\u30ca\u4f5c\u6210\u3057\u3066\u307f\u308b\n$ for i in $(seq 1 3); do lxc launch ubuntu; done\nCreating undisgusted-mercedez\nStarting undisgusted-mercedez\nCreating thermionic-dilan\nStarting thermionic-dilan\nCreating fluviomarine-irving\nStarting fluviomarine-irving\n\n\u4f5c\u6210\u3055\u308c\u305f\u304b\u78ba\u8a8d\n$ lxc list\n+----------------------+---------+-------------------+------+-----------+-----------+\n|         NAME         |  STATE  |       IPV4        | IPV6 | EPHEMERAL | SNAPSHOTS |\n+----------------------+---------+-------------------+------+-----------+-----------+\n| fluviomarine-irving  | RUNNING | 10.0.3.239 (eth0) |      | NO        |         0 |\n+----------------------+---------+-------------------+------+-----------+-----------+\n| thermionic-dilan     | RUNNING | 10.0.3.237 (eth0) |      | NO        |         0 |\n+----------------------+---------+-------------------+------+-----------+-----------+\n| undisgusted-mercedez | RUNNING | 10.0.3.162 (eth0) |      | NO        |         0 |\n+----------------------+---------+-------------------+------+-----------+-----------+\n\n\n* \u3053\u306e\u8a18\u4e8b\u3092\u5143\u306b\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\nhttps://insights.ubuntu.com/2016/02/16/zfs-is-the-fs-for-containers-in-ubuntu-16-04/\n\n\n* IDCF\u30af\u30e9\u30a6\u30c9\u306e\u6e96\u5099\n\n\u307e\u305a\u306f\u3001ubuntu16.04\u7528\u306eISO\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nISO\u30a4\u30e1\u30fc\u30b8\u306f\u3053\u3053\u306eURL\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5148\u3068\u3057\u3066\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\nhttp://cdimage.ubuntu.com/ubuntu-server/daily/current/xenial-server-amd64.iso\n\n![2016221-8.50.50.png](https://qiita-image-store.s3.amazonaws.com/0/18391/9b314de1-6bc4-34de-58b2-01789656e3de.png)\n\nISO\u306e\u5834\u5408\u306f\u3001\u30eb\u30fc\u30c8\u30c7\u30a3\u30b9\u30af\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u6a19\u6e96\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u5834\u5408\u306f15GB\u304c\u81ea\u52d5\u3067\u9078\u629e\u3055\u308c\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f15GB\u3092\u6307\u5b9a\u3057\u307e\u3059\n\n![2016221-8.56.21.png](https://qiita-image-store.s3.amazonaws.com/0/18391/32c26b24-bf97-48dc-189e-4060f77c2a94.png)\n\nISO\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u4e2d\u306e\u753b\u9762\n![2016221-8.44.19.png](https://qiita-image-store.s3.amazonaws.com/0/18391/806529dd-a5bc-140e-021c-543d899e14c5.png)\n\nISO\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4e2d\u306e\u753b\u9762\n![2016221-8.46.36.png](https://qiita-image-store.s3.amazonaws.com/0/18391/569c0882-21bb-1704-4e64-fbf2b54aa2da.png)\n\nISO\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u6210\u529f\u3057\u305f\u753b\u9762\n![2016221-8.49.27.png](https://qiita-image-store.s3.amazonaws.com/0/18391/cf6e0ba3-df6e-4af3-b114-e9179c2cb9b6.png)\n\n* VM\u3092\u8d77\u52d5\u3055\u305b\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u8d77\u52d5\u753b\u9762\u306b\u306a\u308b\u306e\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\n![2016221-8.58.35.png](https://qiita-image-store.s3.amazonaws.com/0/18391/971ce3a0-c258-4c10-36d2-373d68b05ec5.png)\n\n* \u3082\u308d\u3082\u308d\u8a2d\u5b9a\u3057\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u9078\u629e\u3055\u308c\u3066\u3044\u308b standard system utilities \u306e\u307b\u304b\u3001OpenSSH server \u3092\u9078\u629e\n\n![2016221-9.6.29.png](https://qiita-image-store.s3.amazonaws.com/0/18391/e15ebcd3-11ba-f74a-5362-e6a4d3b1f721.png)\n\n* \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001\u518d\u8d77\u52d5\n\n* \u518d\u8d77\u52d5\u5f8c\u3001VM\u306b\u5bfe\u3057\u3066\u30d5\u30a1\u30a4\u30a2\u30d5\u30a9\u30fc\u30eb\u3001\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u7b49\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u3001\u4f5c\u6210\u3057\u305fVM\u306bSSH\u3059\u308b\u3002\n\n* zfs\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u3042\u308b\u306e\u3092\u78ba\u8a8d\n\n```$ locate zfs.ko\n/lib/modules/4.4.0-6-generic/kernel/zfs/zfs/zfs.ko```\n\n\u30ed\u30fc\u30c9\u306f\u3055\u308c\u3066\u3044\u306a\u3044\u3002\u3002\n\n```$ lsmod | grep zfs\n$```\n\n* modprobe\u3067\u30ed\u30fc\u30c9\u3059\u308b\n\u203b\u6b21\u56de\u3001\u518d\u8d77\u52d5\u5f8c\u3082\u8d77\u52d5\u6642\u306b\u30ed\u30fc\u30c9\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n```$ sudo modprobe zfs```\n\n* \u30ed\u30fc\u30c9\u3055\u308c\u305f\n\n```$ lsmod | grep zfs\nzfs                  2801664  4\nzunicode              331776  1 zfs\nzcommon                57344  1 zfs\nznvpair                90112  2 zfs,zcommon\nspl                   102400  3 zfs,zcommon,znvpair\nzavl                   16384  1 zfs```\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n\n```$ head -n1 /etc/issue\nUbuntu Xenial Xerus (development branch) \\n \\l```\n\nlxd\u3068zfs\u95a2\u9023\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```$ sudo apt install lxd zfsutils-linux```\n\n\u521d\u671f\u8a2d\u5b9a\n\n```$ sudo lxd init\nName of the storage backend to use (dir or zfs): zfs\nCreate a new ZFS pool (yes/no)? yes\nName of the new ZFS pool: lxd\nWould you like to use an existing block device (yes/no)? no\nSize in GB of the new loop device (1GB minimum): 2\nWould you like LXD to be available over the network (yes/no)? no \nLXD has been successfully configured.```\n\nzfs\u3068\u3057\u3066\u8a8d\u8b58\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\n\n```$ sudo zpool list\nNAME   SIZE  ALLOC   FREE  EXPANDSZ   FRAG    CAP  DEDUP  HEALTH  ALTROOT\nlxd   1.98G   470K  1.98G         -     0%     0%  1.00x  ONLINE  -```\n\nzpool\u30b9\u30c6\u30fc\u30bf\u30b9\u78ba\u8a8d\n\n```$ sudo zpool status\n  pool: lxd\n state: ONLINE\n  scan: none requested\nconfig:\n\n\tNAME                    STATE     READ WRITE CKSUM\n\tlxd                     ONLINE       0     0     0\n\t  /var/lib/lxd/zfs.img  ONLINE       0     0     0\n\nerrors: No known data errors```\n\nlxd\u78ba\u8a8d\n\n```$ sudo lxc config get storage.zfs_pool_name\nstorage.zfs_pool_name: lxd```\n\n\nlxd\u30b0\u30eb\u30fc\u30d7\u3092\u65b0\u898f\u4f5c\u6210\n\n```$ newgrp lxd```\n\nlxd\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\n\n```$ lxd-images import ubuntu --alias ubuntu\nDownloading the GPG key for http://cloud-images.ubuntu.com\nValidating the GPG signature of /tmp/tmp1mgm39av/download.json.asc\nDownloading the image.\nImage manifest: http://cloud-images.ubuntu.com/server/releases/trusty/release-20160217.1/ubuntu-14.04-server-cloudimg-amd64.manifest\nImage imported as: 7336a7a1ae64878292ba7ea1905a2e98438a4894c3257504a32244bedf809feb\nSetup alias: ubuntu\n```\n\n3\u30b3\u30f3\u30c6\u30ca\u4f5c\u6210\u3057\u3066\u307f\u308b\n\n```$ for i in $(seq 1 3); do lxc launch ubuntu; done\nCreating undisgusted-mercedez\nStarting undisgusted-mercedez\nCreating thermionic-dilan\nStarting thermionic-dilan\nCreating fluviomarine-irving\nStarting fluviomarine-irving\n```\n\n\u4f5c\u6210\u3055\u308c\u305f\u304b\u78ba\u8a8d\n\n```$ lxc list\n+----------------------+---------+-------------------+------+-----------+-----------+\n|         NAME         |  STATE  |       IPV4        | IPV6 | EPHEMERAL | SNAPSHOTS |\n+----------------------+---------+-------------------+------+-----------+-----------+\n| fluviomarine-irving  | RUNNING | 10.0.3.239 (eth0) |      | NO        |         0 |\n+----------------------+---------+-------------------+------+-----------+-----------+\n| thermionic-dilan     | RUNNING | 10.0.3.237 (eth0) |      | NO        |         0 |\n+----------------------+---------+-------------------+------+-----------+-----------+\n| undisgusted-mercedez | RUNNING | 10.0.3.162 (eth0) |      | NO        |         0 |\n+----------------------+---------+-------------------+------+-----------+-----------+\n```\n\n\n", "tags": ["ZFS", "Ubuntu", "lxc", "lxd", "IDCF\u30af\u30e9\u30a6\u30c9"]}