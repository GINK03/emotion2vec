{"tags": ["capistrano"], "context": " More than 1 year has passed since last update.\u7528\u9014\u3068\u3057\u3066\u306f\u3001\u30b5\u30fc\u30d0\u30fc\u4e0a\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u30de\u30cb\u30e5\u30a2\u30eb\u3067\u4f55\u5ea6\u3082\u5909\u66f4\u3057\u3066\u691c\u8a3c\u3059\u308b\u5834\u5408\u3084\u3001\u8907\u6570\u306e\u4eba\u304c\u30b5\u30fc\u30d0\u30fc\u4e0a\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u5834\u5408\u306a\u3069\u3001\u305d\u306e\u5f8c\u518d\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u3068\u304d\u306b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u623b\u3057\u5fd8\u308c\u306b\u3088\u308b\u4e8b\u6545\u3092\u9632\u3050\u305f\u3081\u306b\u4f7f\u3046\n\u4f8b\u306f.env.production\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9 (dotenv-deployment gem)\nfilepath = ...\nremote_filepath = \"#{shared_path}/.env.production\"\n\nif test(\"[ -f #{remote_filepath} ]\")\n  local_content = File.read(filepath)\n  remote_content = capture(\"cat #{remote_filepath}\")\n  if local_content.strip == remote_content.strip\n    puts \"Skip uploading of #{filepath} because files are identical\"\n  else\n    puts \"Diff of #{filepath}\"\n    puts \"--- Local file ---\"\n    puts local_content.strip.split(\"\\n\") - remote_content.strip.split(\"\\n\")\n    puts \"--- Remote file ---\"\n    puts remote_content.strip.split(\"\\n\") - local_content.strip.split(\"\\n\")\n    puts\n    ask(:continue_upload, \"Do you continue `deploy:upload_dotenv`? [y/n]\")\n    if fetch(:continue_upload) == 'y'\n      upload!(filepath, remote_filepath)\n    end\n  end\nelse\n  upload!(filepath, remote_filepath)\nend\n\n\u30ed\u30b0\u306e\u51fa\u529b\u4f8b\nDiff of config/deploy/.env.production\n--- Local file ---\nFOO=12345678\nBAR=abcdefg\n--- Remote file ---\nFOO=00000000\n\nPlease enter continue_upload (Do you continue `deploy:upload_dotenv`? [y/n]): y\nDEBUGUploading config/deploy/.env.production 0.0%\nINFOUploading config/deploy/.env.production 100.0%\n\n\u3042\u307e\u308a\u304d\u308c\u3044\u3060\u3068\u601d\u308f\u306a\u3044\u304c\u3001\u3068\u308a\u3042\u3048\u305a\u52d5\u304f\n\nCapistrano\u306b\u306f\u72ec\u81ea\u306eask\u30e1\u30bd\u30c3\u30c9\u304c\u3042\u308b\nhttps://github.com/capistrano/capistrano/blob/master/lib/capistrano/configuration.rb\n\u53c2\u8003\uff1aWriting Capistrano Tasks\n\u7528\u9014\u3068\u3057\u3066\u306f\u3001\u30b5\u30fc\u30d0\u30fc\u4e0a\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u30de\u30cb\u30e5\u30a2\u30eb\u3067\u4f55\u5ea6\u3082\u5909\u66f4\u3057\u3066\u691c\u8a3c\u3059\u308b\u5834\u5408\u3084\u3001\u8907\u6570\u306e\u4eba\u304c\u30b5\u30fc\u30d0\u30fc\u4e0a\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u5834\u5408\u306a\u3069\u3001\u305d\u306e\u5f8c\u518d\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u3068\u304d\u306b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u623b\u3057\u5fd8\u308c\u306b\u3088\u308b\u4e8b\u6545\u3092\u9632\u3050\u305f\u3081\u306b\u4f7f\u3046\n\n\u4f8b\u306f`.env.production`\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9 ([dotenv-deployment](https://github.com/bkeepers/dotenv-deployment) gem)\n\n```rb\nfilepath = ...\nremote_filepath = \"#{shared_path}/.env.production\"\n\nif test(\"[ -f #{remote_filepath} ]\")\n  local_content = File.read(filepath)\n  remote_content = capture(\"cat #{remote_filepath}\")\n  if local_content.strip == remote_content.strip\n    puts \"Skip uploading of #{filepath} because files are identical\"\n  else\n    puts \"Diff of #{filepath}\"\n    puts \"--- Local file ---\"\n    puts local_content.strip.split(\"\\n\") - remote_content.strip.split(\"\\n\")\n    puts \"--- Remote file ---\"\n    puts remote_content.strip.split(\"\\n\") - local_content.strip.split(\"\\n\")\n    puts\n    ask(:continue_upload, \"Do you continue `deploy:upload_dotenv`? [y/n]\")\n    if fetch(:continue_upload) == 'y'\n      upload!(filepath, remote_filepath)\n    end\n  end\nelse\n  upload!(filepath, remote_filepath)\nend\n```\n\n\u30ed\u30b0\u306e\u51fa\u529b\u4f8b\n\n```\nDiff of config/deploy/.env.production\n--- Local file ---\nFOO=12345678\nBAR=abcdefg\n--- Remote file ---\nFOO=00000000\n\nPlease enter continue_upload (Do you continue `deploy:upload_dotenv`? [y/n]): y\nDEBUGUploading config/deploy/.env.production 0.0%\nINFOUploading config/deploy/.env.production 100.0%\n```\n\n\u3042\u307e\u308a\u304d\u308c\u3044\u3060\u3068\u601d\u308f\u306a\u3044\u304c\u3001\u3068\u308a\u3042\u3048\u305a\u52d5\u304f\n\n\n---\n\nCapistrano\u306b\u306f\u72ec\u81ea\u306e`ask`\u30e1\u30bd\u30c3\u30c9\u304c\u3042\u308b\nhttps://github.com/capistrano/capistrano/blob/master/lib/capistrano/configuration.rb\n\n\u53c2\u8003\uff1a[Writing Capistrano Tasks](http://vladigleba.com/blog/2014/04/10/deploying-rails-apps-part-6-writing-capistrano-tasks/)\n"}