{"context": "\n\n\u306f\u3058\u3081\u306b\nPython\u3067\u30b7\u30b9\u30c8\u30ec\u306e\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u3092\u3059\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u3063\u3066\u305f\u304f\u3055\u3093\u3042\u308b\u306e\u3067\u3059\u304c\u3001MetaTrader\u304b\u3089\u5165\u3063\u305f\u4eba\u306b\u3068\u3063\u3066\u306f\u308f\u304b\u308a\u306b\u304f\u3044\u306e\u3067\u3001Python\u306e\u7df4\u7fd2\u304c\u3066\u3089\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u306e\u305f\u3081\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002\nPython\u3067\u30b7\u30b9\u30c8\u30ec\u306e\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\n\u305f\u3060\u3001\u6700\u521d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u3001\u307e\u305a\u52d5\u304f\u3053\u3068\u3092\u7b2c\u4e00\u306b\u66f8\u3044\u305f\u306e\u3067\u3001\u7d50\u69cb\u7121\u99c4\u304c\u3042\u3063\u305f\u308a\u3001\u5b9f\u884c\u901f\u5ea6\u304c\u9045\u304b\u3063\u305f\u308a\u3057\u305f\u306e\u3067\u3001\u4eca\u56de\u3001\u3061\u3087\u3063\u3068\u6539\u826f\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\nFX\u30d2\u30b9\u30c8\u30ea\u30ab\u30eb\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\n\u682a\u4fa1\u3060\u3068\u3001Yahoo!\u3068\u304b\u304b\u3089\u76f4\u63a5\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u4f7f\u3048\u308b\u3082\u306e\u3082\u591a\u3044\u306e\u3067\u3059\u304c\u3001FX\u3060\u30685\u5206\u8db3\u3068\u304b15\u5206\u8db3\u3068\u304b\u8907\u6570\u306e\u30bf\u30a4\u30e0\u30d5\u30ec\u30fc\u30e0\u306e\u30c7\u30fc\u30bf\u3092\u4f7f\u3046\u3053\u3068\u3082\u3042\u308b\u306e\u3067\u3001\u57fa\u672c\u306e\u30c7\u30fc\u30bf\u3068\u3057\u30661\u5206\u8db3\u30c7\u30fc\u30bf\u304c\u6b32\u3057\u3044\u3068\u3053\u308d\u3067\u3059\u3002\n\u305d\u3046\u306a\u308b\u3068\u3001\u30c7\u30fc\u30bf\u3082\u5927\u304d\u3044\u306e\u3067\u3001\u4e88\u3081\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u3080\u65b9\u304c\u90fd\u5408\u304c\u3044\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u30b5\u30f3\u30d7\u30eb\u30c7\u30fc\u30bf\u3068\u3057\u3066\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nHistData.com\n\u540c\u3058\u30c7\u30fc\u30bf\u3067\u3082\u3044\u304f\u3064\u304b\u306e\u5f62\u5f0f\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001pandas\u306e\u95a2\u6570\u3092\u4f7f\u3046\u95a2\u4fc2\u3067\u3001Generic ASCII\u306e\u5f62\u5f0f\u306e\u30c7\u30fc\u30bf\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u3067\u306f\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305fEUR/USD\u306e2015\u5e74\u5206\u306e1\u5206\u8db3\u30c7\u30fc\u30bf'DAT_ASCII_EURUSD_M1_2015.csv'\u3092pandas\u306e\u95a2\u6570\u3067\u8aad\u307f\u8fbc\u3093\u3067\u307f\u307e\u3059\u3002\u305f\u3060\u3001\u3053\u306e\u307e\u307e\u3060\u3068\u9031\u660e\u3051\u306e\u76f8\u5834\u304c\u65e5\u66dc\u65e5\u304b\u3089\u59cb\u307e\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u30017\u6642\u9593\u3060\u3051\u9045\u3089\u305b\u3066\u3001\u6708\u66dc\u65e5\u306e0\u6642\u304b\u3089\u59cb\u3081\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\nimport numpy as np\nimport pandas as pd\n\ndataM1 = pd.read_csv('DAT_ASCII_EURUSD_M1_2015.csv', sep=';',\n                     names=('Time','Open','High','Low','Close', ''),\n                     index_col='Time', parse_dates=True)\ndataM1.index += pd.offsets.Hour(7) #7\u6642\u9593\u306e\u30aa\u30d5\u30bb\u30c3\u30c8\n\n\n\u4efb\u610f\u306e\u30bf\u30a4\u30e0\u30d5\u30ec\u30fc\u30e0\u30c7\u30fc\u30bf\u306e\u4f5c\u6210\n\u6b21\u306b1\u5206\u8db3\u306e\u30c7\u30fc\u30bf\u304b\u3089\u4efb\u610f\u306e\u30bf\u30a4\u30e0\u30d5\u30ec\u30fc\u30e0\u306e\u30c7\u30fc\u30bf\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u3082pandas\u306eresample(), ohlc()\u3068\u3044\u3046\u95a2\u6570\u3092\u4f7f\u3048\u3070\u7c21\u5358\u306b\u3067\u304d\u307e\u3059\u3002\n# df\u306e\u30c7\u30fc\u30bf\u304b\u3089tf\u3067\u6307\u5b9a\u3059\u308b\u30bf\u30a4\u30e0\u30d5\u30ec\u30fc\u30e0\u306e4\u672c\u8db3\u30c7\u30fc\u30bf\u3092\u4f5c\u6210\u3059\u308b\u95a2\u6570\ndef TF_ohlc(df, tf):\n    x = df.resample(tf).ohlc()\n    O = x['Open']['open']\n    H = x['High']['high']\n    L = x['Low']['low']\n    C = x['Close']['close']\n    ret = pd.DataFrame({'Open': O, 'High': H, 'Low': L, 'Close': C},\n                       columns=['Open','High','Low','Close'])\n    return ret.dropna()\n\nohlc = TF_ohlc(dataM1, 'H') #\uff11\u6642\u9593\u8db3\u30c7\u30fc\u30bf\u306e\u4f5c\u6210\n\ntf\u306b\u6307\u5b9a\u3059\u308b\u30ad\u30fc\u30ef\u30fc\u30c9\u306f\u3001\n\n\u5206 - 'T'\n\n\u6642 - 'H'\n\n\u65e5 - 'D'\n\n\u9031 - 'W'\n\n\u6708 - 'M'\n\n\n\u3067\u300115\u5206\u306e\u5834\u5408\u3001'15T'\u3068\u66f8\u3051\u3070\u3044\u3044\u3067\u3059\u3002\u3053\u308c\u3067\u3001\u4f55\u5206\u8db3\u306e\u30c7\u30fc\u30bf\u3067\u3082\u4f5c\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u30011\u6642\u9593\u8db3\u306e\u30c7\u30fc\u30bf\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u30c6\u30af\u30cb\u30ab\u30eb\u6307\u6a19\u306e\u4f5c\u6210\n\u30b7\u30b9\u30c8\u30ec\u306e\u58f2\u8cb7\u30eb\u30fc\u30eb\u3067\u4f7f\u3046\u30c6\u30af\u30cb\u30ab\u30eb\u6307\u6a19\u306fGitHub\u306b\u4f5c\u3063\u3066\u3042\u308a\u307e\u3059\u3002indicators.py\u3060\u3051\u53d6\u3063\u3066\u304f\u308c\u3070\u4f7f\u3048\u307e\u3059\u3002\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u7701\u7565\u3057\u307e\u3059\u304c\u3001\u5185\u90e8\u306e\u7e70\u308a\u8fd4\u3057\u3067pandas\u4f7f\u308f\u306a\u3044\u3088\u3046\u306b\u3057\u305f\u308a\u3001Numba\u3092\u4f7f\u3063\u305f\u308a\u3057\u305f\u306e\u3067\u3001\u6975\u7aef\u306b\u6642\u9593\u306e\u304b\u304b\u308b\u95a2\u6570\u306f\u306a\u304f\u306a\u3063\u305f\u3068\u601d\u3044\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u95a2\u4fc2\u3067\u30d1\u30e9\u30dc\u30ea\u30c3\u30afSAR\u306f\u591a\u5c11\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u300110\u30d0\u30fc\u306e\u79fb\u52d5\u5e73\u5747\u306830\u30d0\u30fc\u306e\u79fb\u52d5\u5e73\u5747\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u3051\u307e\u3059\u3002\nimport indicators as ind #indicators.py\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\nFastMA = ind.iMA(ohlc, 10) #\u77ed\u671f\u79fb\u52d5\u5e73\u5747\nSlowMA = ind.iMA(ohlc, 30) #\u9577\u671f\u79fb\u52d5\u5e73\u5747\n\n\n\u30c6\u30af\u30cb\u30ab\u30eb\u6307\u6a19\u306e\u8868\u793a\n\u4f5c\u6210\u3057\u305f\u30c6\u30af\u30cb\u30ab\u30eb\u6307\u6a19\u3092\u30c1\u30e3\u30fc\u30c8\u306b\u8868\u793a\u3055\u305b\u308b\u306e\u306b\u3001pandas\u306eplot\u95a2\u6570\u3067\u3082\u3044\u3044\u306e\u3067\u3059\u304c\u3001\u62e1\u5927\u7e2e\u5c0f\u3057\u305f\u3044\u3053\u3068\u3082\u3042\u308b\u306e\u3067\u3001\u76f8\u5834\u95a2\u4fc2\u306e\u30b5\u30a4\u30c8\u3067\u3088\u304f\u898b\u304b\u3051\u308bHighCharts\u306b\u8868\u793a\u3055\u305b\u308bPython\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u3001\u7c21\u5358\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u305fpandas-highcharts\u3092\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u3001\npip install pandas-highcharts\n\n\u3067OK\u3067\u3059\u3002FX\u306e\u7d42\u5024\u3068\uff12\u672c\u306e\u79fb\u52d5\u5e73\u5747\u3092\u8868\u793a\u3055\u305b\u308b\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\nfrom pandas_highcharts.display import display_charts\ndf = pd.DataFrame({'Close': ohlc['Close'], 'FastMA': FastMA, 'SlowMA': SlowMA})\ndisplay_charts(df, chart_type=\"stock\", title=\"MA cross\", figsize=(640,480), grid=True)\n\n\u3053\u308c\u3092\u5b9f\u884c\u3059\u308b\u3068\u3053\u3093\u306a\u30c1\u30e3\u30fc\u30c8\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n\uff11\u5e74\u5206\u3092\u8868\u793a\u3055\u305b\u308b\u3068\u79fb\u52d5\u5e73\u5747\u304c\u307b\u3068\u3093\u3069\u91cd\u306a\u3063\u3066\u898b\u3048\u306a\u3044\u306e\u3067\u3001\u9069\u5f53\u306b\u30ba\u30fc\u30e0\u3059\u308b\u3068\u3001\u3053\u3093\u306a\u611f\u3058\u306b\u306a\u308a\u3001\u79fb\u52d5\u5e73\u5747\u306e\u9055\u3044\u304c\u898b\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u306a\u304b\u306a\u304b\u4fbf\u5229\u3067\u3059\u3002\n\n\u79fb\u52d5\u5e73\u5747\u4ea4\u5dee\u30b7\u30b9\u30c6\u30e0\u306e\u58f2\u8cb7\u30eb\u30fc\u30eb\n\u58f2\u8cb7\u30b7\u30b9\u30c6\u30e0\u306e\u4e00\u4f8b\u3068\u3057\u3066\u3001\u5b9a\u756a\u306e\u79fb\u52d5\u5e73\u5747\u306e\u4ea4\u5dee\u30b7\u30b9\u30c6\u30e0\u3092\u53d6\u308a\u4e0a\u3052\u307e\u3059\u3002\u58f2\u8cb7\u30eb\u30fc\u30eb\u306f\u3001\n\n\u8cb7\u3044\u30b7\u30b0\u30ca\u30eb - \u77ed\u671f\u79fb\u52d5\u5e73\u5747\u7dda\u304c\u9577\u671f\u79fb\u52d5\u5e73\u5747\u7dda\u3092\u4e0a\u629c\u3051\u308b\n\u58f2\u308a\u30b7\u30b0\u30ca\u30eb - \u77ed\u671f\u79fb\u52d5\u5e73\u5747\u7dda\u304c\u9577\u671f\u79fb\u52d5\u5e73\u5747\u7dda\u3092\u4e0b\u629c\u3051\u308b\n\n\u3068\u3044\u3046\u5358\u7d14\u306a\u3082\u306e\u3067\u3059\u3002\u3053\u306e\u30b7\u30b0\u30ca\u30eb\u306f\u30a8\u30f3\u30c8\u30ea\u30fc\u306e\u30b7\u30b0\u30ca\u30eb\u3067\u3001\u30dd\u30b8\u30b7\u30e7\u30f3\u3092\u6c7a\u6e08\u3059\u308b\u305f\u3081\u306e\u30a8\u30b0\u30b8\u30c3\u30c8\u30b7\u30b0\u30ca\u30eb\u306f\u3001\u8cb7\u3044\u30a8\u30b0\u30b8\u30c3\u30c8\u306f\u58f2\u308a\u30a8\u30f3\u30c8\u30ea\u30fc\u3068\u540c\u3058\u3001\u58f2\u308a\u30a8\u30b0\u30b8\u30c3\u30c8\u306f\u8cb7\u3044\u30a8\u30f3\u30c8\u30ea\u30fc\u540c\u3058\u3082\u306e\u3068\u3057\u307e\u3059\u3002\u3044\u308f\u3086\u308b\u9014\u8ee2\u58f2\u8cb7\u3067\u3059\u3002\n#\u8cb7\u3044\u30a8\u30f3\u30c8\u30ea\u30fc\u30b7\u30b0\u30ca\u30eb\nBuyEntry = ((FastMA > SlowMA) & (FastMA.shift() <= SlowMA.shift())).values\n#\u58f2\u308a\u30a8\u30f3\u30c8\u30ea\u30fc\u30b7\u30b0\u30ca\u30eb\nSellEntry = ((FastMA < SlowMA) & (FastMA.shift() >= SlowMA.shift())).values\n#\u8cb7\u3044\u30a8\u30b0\u30b8\u30c3\u30c8\u30b7\u30b0\u30ca\u30eb\nBuyExit = SellEntry.copy()\n#\u58f2\u308a\u30a8\u30b0\u30b8\u30c3\u30c8\u30b7\u30b0\u30ca\u30eb\nSellExit = BuyEntry.copy()\n\n\u3053\u3053\u3067\u306f\u3001\u305d\u308c\u305e\u308c\u306e\u30b7\u30b0\u30ca\u30eb\u304cnumpy\u306ebool\u578b\u306e\u914d\u5217\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u666e\u901a\u306b\u8003\u3048\u308b\u3068\u3001\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u3092\u56de\u3057\u306a\u304c\u3089\u30b7\u30b0\u30ca\u30eb\u306e\u5224\u5225\u3092\u3059\u308b\u3068\u3053\u308d\u3067\u3057\u3087\u3046\u304c\u3001Python\u306e\u5834\u5408\u3001\u914d\u5217\u3067\u307e\u3068\u3081\u3066\u51e6\u7406\u3057\u305f\u65b9\u304c\u901f\u3044\u306e\u3067\u3001\u30b7\u30b0\u30ca\u30eb\u3092\u914d\u5217\u306b\u5165\u308c\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u306e\u5b9f\u884c\n\u3044\u3088\u3044\u3088\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u3092\u884c\u3044\u307e\u3059\u3002\u30d2\u30b9\u30c8\u30ea\u30ab\u30eb\u30c7\u30fc\u30bf\u3068\u3001\u4e0a\u8a18\u306e\u58f2\u8cb7\u30b7\u30b0\u30ca\u30eb\u3092\u5165\u529b\u3057\u3066\u3001\u5b9f\u969b\u306b\u58f2\u8cb7\u3057\u305f\u4fa1\u683c\u3068\u640d\u76ca\u3092\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u3068\u3057\u3066\u51fa\u529b\u3055\u305b\u307e\u3059\u3002\ndef Backtest(ohlc, BuyEntry, SellEntry, BuyExit, SellExit, lots=0.1, spread=2):\n    Open = ohlc['Open'].values #\u59cb\u5024\n    Point = 0.0001 #1pip\u306e\u5024\n    if(Open[0] > 50): Point = 0.01 #\u30af\u30ed\u30b9\u5186\u306e1pip\u306e\u5024\n    Spread = spread*Point #\u30b9\u30d7\u30ec\u30c3\u30c9\n    Lots = lots*100000 #\u5b9f\u969b\u306e\u58f2\u8cb7\u91cf\n    N = len(ohlc) #FX\u30c7\u30fc\u30bf\u306e\u30b5\u30a4\u30ba\n    BuyExit[N-2] = SellExit[N-2] = True #\u6700\u5f8c\u306b\u5f37\u5236\u30a8\u30b0\u30b8\u30c3\u30c8\n    BuyPrice = SellPrice = 0.0 # \u58f2\u8cb7\u4fa1\u683c\n\n    LongTrade = np.zeros(N) # \u8cb7\u3044\u30c8\u30ec\u30fc\u30c9\u60c5\u5831\n    ShortTrade = np.zeros(N) # \u58f2\u308a\u30c8\u30ec\u30fc\u30c9\u60c5\u5831\n\n    LongPL = np.zeros(N) # \u8cb7\u3044\u30dd\u30b8\u30b7\u30e7\u30f3\u306e\u640d\u76ca\n    ShortPL = np.zeros(N) # \u58f2\u308a\u30dd\u30b8\u30b7\u30e7\u30f3\u306e\u640d\u76ca\n\n    for i in range(1,N):\n        if BuyEntry[i-1] and BuyPrice == 0: #\u8cb7\u3044\u30a8\u30f3\u30c8\u30ea\u30fc\u30b7\u30b0\u30ca\u30eb\n            BuyPrice = Open[i]+Spread\n            LongTrade[i] = BuyPrice #\u8cb7\u3044\u30dd\u30b8\u30b7\u30e7\u30f3\u30aa\u30fc\u30d7\u30f3\n        elif BuyExit[i-1] and BuyPrice != 0: #\u8cb7\u3044\u30a8\u30b0\u30b8\u30c3\u30c8\u30b7\u30b0\u30ca\u30eb\n            ClosePrice = Open[i]\n            LongTrade[i] = -ClosePrice #\u8cb7\u3044\u30dd\u30b8\u30b7\u30e7\u30f3\u30af\u30ed\u30fc\u30ba\n            LongPL[i] = (ClosePrice-BuyPrice)*Lots #\u640d\u76ca\u78ba\u5b9a\n            BuyPrice = 0\n\n        if SellEntry[i-1] and SellPrice == 0: #\u58f2\u308a\u30a8\u30f3\u30c8\u30ea\u30fc\u30b7\u30b0\u30ca\u30eb\n            SellPrice = Open[i]\n            ShortTrade[i] = SellPrice #\u58f2\u308a\u30dd\u30b8\u30b7\u30e7\u30f3\u30aa\u30fc\u30d7\u30f3\n        elif SellExit[i-1] and SellPrice != 0: #\u58f2\u308a\u30a8\u30b0\u30b8\u30c3\u30c8\u30b7\u30b0\u30ca\u30eb\n            ClosePrice = Open[i]+Spread\n            ShortTrade[i] = -ClosePrice #\u58f2\u308a\u30dd\u30b8\u30b7\u30e7\u30f3\u30af\u30ed\u30fc\u30ba\n            ShortPL[i] = (SellPrice-ClosePrice)*Lots #\u640d\u76ca\u78ba\u5b9a\n            SellPrice = 0\n\n    return pd.DataFrame({'Long':LongTrade, 'Short':ShortTrade}, index=ohlc.index),\\\n            pd.DataFrame({'Long':LongPL, 'Short':ShortPL}, index=ohlc.index)\n\nTrade, PL = Backtest(ohlc, BuyEntry, SellEntry, BuyExit, SellExit)\n\n\u524d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u3001\u3053\u306e\u90e8\u5206\u3092\u4f55\u6bb5\u968e\u304b\u306b\u5206\u3051\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u307e\u3068\u3081\u3066\u307f\u307e\u3057\u305f\u3002\u672c\u6765\u306a\u3089\u30b7\u30b0\u30ca\u30eb\u3060\u3051\u3067\u30c8\u30ec\u30fc\u30c9\u3067\u304d\u308c\u3070\u3044\u3044\u306e\u3067\u3059\u304c\u3001\u30dd\u30b8\u30b7\u30e7\u30f3\u304c\u3042\u3063\u3066\u3082\u30b7\u30b0\u30ca\u30eb\u304c\u51fa\u308b\u30b1\u30fc\u30b9\u3082\u3042\u308b\u306e\u3067\u3001\u30dd\u30b8\u30b7\u30e7\u30f3\u306e\u6709\u7121\u3082\u30c1\u30a7\u30c3\u30af\u3059\u308b\u5f62\u306b\u3057\u307e\u3057\u305f\u3002\n\u3053\u306e\u95a2\u6570\u306e\u51fa\u529b\u306e\u3046\u3061\u3001Trade\u306b\u306f\u3001\u8cb7\u3044\u3068\u58f2\u308a\u305d\u308c\u305e\u308c\u306b\u3001\u58f2\u8cb7\u4fa1\u683c\u3092\u30d7\u30e9\u30b9\u306e\u5024\u3001\u6c7a\u6e08\u4fa1\u683c\u3092\u30de\u30a4\u30ca\u30b9\u306e\u5024\u3067\u683c\u7d0d\u3057\u3066\u3042\u308a\u307e\u3059\u3002PL\u306b\u306f\u3001\u6c7a\u6e08\u6642\u70b9\u3067\u306e\u5b9f\u73fe\u640d\u76ca\u304c\u683c\u7d0d\u3057\u3066\u3042\u308a\u307e\u3059\u3002\n\n\u58f2\u8cb7\u30b7\u30b9\u30c6\u30e0\u306e\u8a55\u4fa1\nTrade\u3068PL\u306e\u60c5\u5831\u304c\u3042\u308c\u3070\u3001\u58f2\u8cb7\u30b7\u30b9\u30c6\u30e0\u306e\u3060\u3044\u305f\u3044\u306e\u8a55\u4fa1\u304c\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\ndef BacktestReport(Trade, PL):\n    LongPL = PL['Long']\n    LongTrades = np.count_nonzero(Trade['Long'])//2\n    LongWinTrades = np.count_nonzero(LongPL.clip_lower(0))\n    LongLoseTrades = np.count_nonzero(LongPL.clip_upper(0))\n    print('\u8cb7\u3044\u30c8\u30ec\u30fc\u30c9\u6570 =', LongTrades)\n    print('\u52dd\u30c8\u30ec\u30fc\u30c9\u6570 =', LongWinTrades)\n    print('\u6700\u5927\u52dd\u30c8\u30ec\u30fc\u30c9 =', LongPL.max())\n    print('\u5e73\u5747\u52dd\u30c8\u30ec\u30fc\u30c9 =', round(LongPL.clip_lower(0).sum()/LongWinTrades, 2))\n    print('\u8ca0\u30c8\u30ec\u30fc\u30c9\u6570 =', LongLoseTrades)\n    print('\u6700\u5927\u8ca0\u30c8\u30ec\u30fc\u30c9 =', LongPL.min())\n    print('\u5e73\u5747\u8ca0\u30c8\u30ec\u30fc\u30c9 =', round(LongPL.clip_upper(0).sum()/LongLoseTrades, 2))\n    print('\u52dd\u7387 =', round(LongWinTrades/LongTrades*100, 2), '%\\n')\n\n    ShortPL = PL['Short']\n    ShortTrades = np.count_nonzero(Trade['Short'])//2\n    ShortWinTrades = np.count_nonzero(ShortPL.clip_lower(0))\n    ShortLoseTrades = np.count_nonzero(ShortPL.clip_upper(0))\n    print('\u58f2\u308a\u30c8\u30ec\u30fc\u30c9\u6570 =', ShortTrades)\n    print('\u52dd\u30c8\u30ec\u30fc\u30c9\u6570 =', ShortWinTrades)\n    print('\u6700\u5927\u52dd\u30c8\u30ec\u30fc\u30c9 =', ShortPL.max())\n    print('\u5e73\u5747\u52dd\u30c8\u30ec\u30fc\u30c9 =', round(ShortPL.clip_lower(0).sum()/ShortWinTrades, 2))\n    print('\u8ca0\u30c8\u30ec\u30fc\u30c9\u6570 =', ShortLoseTrades)\n    print('\u6700\u5927\u8ca0\u30c8\u30ec\u30fc\u30c9 =', ShortPL.min())\n    print('\u5e73\u5747\u8ca0\u30c8\u30ec\u30fc\u30c9 =', round(ShortPL.clip_upper(0).sum()/ShortLoseTrades, 2))\n    print('\u52dd\u7387 =', round(ShortWinTrades/ShortTrades*100, 2), '%\\n')\n\n    Trades = LongTrades + ShortTrades\n    WinTrades = LongWinTrades+ShortWinTrades\n    LoseTrades = LongLoseTrades+ShortLoseTrades\n    print('\u7dcf\u30c8\u30ec\u30fc\u30c9\u6570 =', Trades)\n    print('\u52dd\u30c8\u30ec\u30fc\u30c9\u6570 =', WinTrades)\n    print('\u6700\u5927\u52dd\u30c8\u30ec\u30fc\u30c9 =', max(LongPL.max(), ShortPL.max()))\n    print('\u5e73\u5747\u52dd\u30c8\u30ec\u30fc\u30c9 =', round((LongPL.clip_lower(0).sum()+ShortPL.clip_lower(0).sum())/WinTrades, 2))\n    print('\u8ca0\u30c8\u30ec\u30fc\u30c9\u6570 =', LoseTrades)\n    print('\u6700\u5927\u8ca0\u30c8\u30ec\u30fc\u30c9 =', min(LongPL.min(), ShortPL.min()))\n    print('\u5e73\u5747\u8ca0\u30c8\u30ec\u30fc\u30c9 =', round((LongPL.clip_upper(0).sum()+ShortPL.clip_upper(0).sum())/LoseTrades, 2))\n    print('\u52dd\u7387 =', round(WinTrades/Trades*100, 2), '%\\n')\n\n    GrossProfit = LongPL.clip_lower(0).sum()+ShortPL.clip_lower(0).sum()\n    GrossLoss = LongPL.clip_upper(0).sum()+ShortPL.clip_upper(0).sum()\n    Profit = GrossProfit+GrossLoss\n    Equity = (LongPL+ShortPL).cumsum()\n    MDD = (Equity.cummax()-Equity).max()\n    print('\u7dcf\u5229\u76ca =', round(GrossProfit, 2))\n    print('\u7dcf\u640d\u5931 =', round(GrossLoss, 2))\n    print('\u7dcf\u640d\u76ca =', round(Profit, 2))\n    print('\u30d7\u30ed\u30d5\u30a3\u30c3\u30c8\u30d5\u30a1\u30af\u30bf\u30fc =', round(-GrossProfit/GrossLoss, 2))\n    print('\u5e73\u5747\u640d\u76ca =', round(Profit/Trades, 2))\n    print('\u6700\u5927\u30c9\u30ed\u30fc\u30c0\u30a6\u30f3 =', round(MDD, 2))\n    print('\u30ea\u30ab\u30d0\u30ea\u30fc\u30d5\u30a1\u30af\u30bf\u30fc =', round(Profit/MDD, 2))\n    return Equity\nEquity = BacktestReport(Trade, PL)\n\n\u8cb7\u3044\u30c8\u30ec\u30fc\u30c9\u6570 = 113\n\u52dd\u30c8\u30ec\u30fc\u30c9\u6570 = 39\n\u6700\u5927\u52dd\u30c8\u30ec\u30fc\u30c9 = 440.4\n\u5e73\u5747\u52dd\u30c8\u30ec\u30fc\u30c9 = 82.57\n\u8ca0\u30c8\u30ec\u30fc\u30c9\u6570 = 74\n\u6700\u5927\u8ca0\u30c8\u30ec\u30fc\u30c9 = -169.4\n\u5e73\u5747\u8ca0\u30c8\u30ec\u30fc\u30c9 = -43.89\n\u52dd\u7387 = 34.51 %\n\n\u58f2\u308a\u30c8\u30ec\u30fc\u30c9\u6570 = 113\n\u52dd\u30c8\u30ec\u30fc\u30c9\u6570 = 49\n\u6700\u5927\u52dd\u30c8\u30ec\u30fc\u30c9 = 327.6\n\u5e73\u5747\u52dd\u30c8\u30ec\u30fc\u30c9 = 78.71\n\u8ca0\u30c8\u30ec\u30fc\u30c9\u6570 = 64\n\u6700\u5927\u8ca0\u30c8\u30ec\u30fc\u30c9 = -238.5\n\u5e73\u5747\u8ca0\u30c8\u30ec\u30fc\u30c9 = -43.85\n\u52dd\u7387 = 43.36 %\n\n\u7dcf\u30c8\u30ec\u30fc\u30c9\u6570 = 226\n\u52dd\u30c8\u30ec\u30fc\u30c9\u6570 = 88\n\u6700\u5927\u52dd\u30c8\u30ec\u30fc\u30c9 = 440.4\n\u5e73\u5747\u52dd\u30c8\u30ec\u30fc\u30c9 = 80.42\n\u8ca0\u30c8\u30ec\u30fc\u30c9\u6570 = 138\n\u6700\u5927\u8ca0\u30c8\u30ec\u30fc\u30c9 = -238.5\n\u5e73\u5747\u8ca0\u30c8\u30ec\u30fc\u30c9 = -43.87\n\u52dd\u7387 = 38.94 %\n\n\u7dcf\u5229\u76ca = 7077.0\n\u7dcf\u640d\u5931 = -6054.4\n\u7dcf\u640d\u76ca = 1022.6\n\u30d7\u30ed\u30d5\u30a3\u30c3\u30c8\u30d5\u30a1\u30af\u30bf\u30fc = 1.17\n\u5e73\u5747\u640d\u76ca = 4.52\n\u6700\u5927\u30c9\u30ed\u30fc\u30c0\u30a6\u30f3 = 1125.4\n\u30ea\u30ab\u30d0\u30ea\u30fc\u30d5\u30a1\u30af\u30bf\u30fc = 0.91\n\n\u3053\u3053\u3067\u306f\u3001\u5404\u9805\u76ee\u3092\u8868\u793a\u3055\u305b\u3066\u3044\u307e\u3059\u304c\u3001\u6a5f\u68b0\u5b66\u7fd2\u3084\u6700\u9069\u5316\u3092\u884c\u3046\u5834\u5408\u306b\u306f\u3001\u8a55\u4fa1\u5024\u306e\u307f\u3092\u8a08\u7b97\u3055\u305b\u308b\u3088\u3046\u306b\u3059\u308c\u3070\u3088\u3044\u3067\u3057\u3087\u3046\u3002\n\u30b7\u30b9\u30c6\u30e0\u306e\u8a55\u4fa1\u3068\u3057\u3066\u8cc7\u7523\u66f2\u7dda\u3092\u898b\u305f\u3044\u5834\u5408\u3082\u591a\u3044\u3067\u3057\u3087\u3046\u3002\u4e0a\u8a18\u306e\u95a2\u6570\u3067\u306f\u3001Equity\u3068\u3057\u3066\u8cc7\u7523\u66f2\u7dda\u3092\u51fa\u529b\u3055\u305b\u3066\u3044\u308b\u306e\u3067\u3001\u521d\u671f\u8cc7\u7523\u3092\u52a0\u7b97\u3057\u3066\u30b0\u30e9\u30d5\u306b\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\nInitial = 10000 # \u521d\u671f\u8cc7\u7523\ndisplay_charts(pd.DataFrame({'Equity':Equity+Initial}), chart_type=\"stock\", title=\"\u8cc7\u7523\u66f2\u7dda\", figsize=(640,480), grid=True)\n\n\n\n\u30c8\u30ec\u30fc\u30c9\u30c1\u30e3\u30fc\u30c8\u306e\u8868\u793a\n\u6700\u5f8c\u306b\u3001\u30c1\u30e3\u30fc\u30c8\u4e0a\u306e\u3069\u3053\u3067\u58f2\u8cb7\u3057\u305f\u304b\u3092\u8868\u793a\u3055\u305b\u3066\u307f\u307e\u3059\u3002\u58f2\u8cb7\u3057\u305f\u30dd\u30a4\u30f3\u30c8\u306e\u307f\u3092\u8868\u793a\u3055\u305b\u3066\u3082\u3044\u3044\u306e\u3067\u3059\u304c\u3001HighCharts\u3067\u306e\u65b9\u6cd5\u304c\u308f\u304b\u3089\u306a\u3044\u306e\u3067\u3001\u30dd\u30b8\u30b7\u30e7\u30f3\u3092\u30aa\u30fc\u30d7\u30f3\u3057\u305f\u30dd\u30a4\u30f3\u30c8\u3068\u30af\u30ed\u30fc\u30ba\u3057\u305f\u30dd\u30a4\u30f3\u30c8\u3092\u30e9\u30a4\u30f3\u3067\u7d50\u3093\u3067\u307f\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u3067Trade\u60c5\u5831\u304b\u3089\u30e9\u30a4\u30f3\u306b\u5909\u63db\u3057\u3066\u307f\u307e\u3059\u3002\ndef PositionLine(trade):\n    PosPeriod = 0 #\u30dd\u30b8\u30b7\u30e7\u30f3\u306e\u671f\u9593\n    Position = False #\u30dd\u30b8\u30b7\u30e7\u30f3\u306e\u6709\u7121\n    Line = trade.copy()\n    for i in range(len(Line)):\n        if trade[i] > 0: Position = True \n        elif Position: PosPeriod += 1 # \u30dd\u30b8\u30b7\u30e7\u30f3\u306e\u671f\u9593\u3092\u30ab\u30a6\u30f3\u30c8\n        if trade[i] < 0:\n            if PosPeriod > 0:\n                Line[i] = -trade[i]\n                diff = (Line[i]-Line[i-PosPeriod])/PosPeriod\n                for j in range(i-1, i-PosPeriod, -1):\n                    Line[j] = Line[j+1]-diff # \u30dd\u30b8\u30b7\u30e7\u30f3\u306e\u671f\u9593\u3092\u88dc\u9593\n                PosPeriod = 0\n                Position = False\n        if trade[i] == 0 and not Position: Line[i] = 'NaN'\n    return Line\n\ndf = pd.DataFrame({'Open': ohlc['Open'],\n                   'Long': PositionLine(Trade['Long'].values),\n                   'Short': PositionLine(Trade['Short'].values)})\ndisplay_charts(df, chart_type=\"stock\", title=\"\u30c8\u30ec\u30fc\u30c9\u30c1\u30e3\u30fc\u30c8\", figsize=(640,480), grid=True)\n\n\u540c\u3058\u3088\u3046\u306bHighCharts\u306b\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u9069\u5f53\u306b\u30ba\u30fc\u30e0\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u9014\u8ee2\u58f2\u8cb7\u306e\u30b7\u30b9\u30c6\u30e0\u306a\u306e\u3067\u3001Long\u30dd\u30b8\u30b7\u30e7\u30f3\u3068Short\u30dd\u30b8\u30b7\u30e7\u30f3\u304c\u4ea4\u4e92\u306b\u51fa\u3066\u304f\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n\u307e\u3068\u3081\n\u58f2\u8cb7\u30eb\u30fc\u30eb\u304c\u30c6\u30af\u30cb\u30ab\u30eb\u6307\u6a19\u3060\u3051\u3067\u8a18\u8ff0\u3067\u304d\u308b\u3088\u3046\u306a\u30b7\u30b9\u30c6\u30e0\u306e\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u3092\u884c\u3046\u30b3\u30fc\u30c9\u3092Python\u3067\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002Python\u304b\u3089HighCharts\u306b\u30b0\u30e9\u30d5\u8868\u793a\u3067\u304d\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u306f\u306a\u304b\u306a\u304b\u4fbf\u5229\u3067\u3057\u305f\u3002\u307e\u3060\u307e\u3060\u6539\u5584\u306e\u4f59\u5730\u306f\u3042\u308b\u306e\u3067\u3001\u6c17\u304c\u5411\u3044\u305f\u3089\u7d9a\u304d\u3092\u66f8\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u7d9a\u304d\u306f\u3053\u3061\u3089\u3067\u3059\u3002\nPython\u3067FX\u30b7\u30b9\u30c8\u30ec\u306e\u30d0\u30c3\u30af\u30c6\u30b9\u30c8(2)\n\u306a\u304a\u3001\u672c\u8a18\u4e8b\u3067\u63b2\u8f09\u3057\u305f\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u3042\u308a\u307e\u3059\u3002\nMT5IndicatorsPy/EA_sample.ipynb\n# \u306f\u3058\u3081\u306b\nPython\u3067\u30b7\u30b9\u30c8\u30ec\u306e\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u3092\u3059\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u3063\u3066\u305f\u304f\u3055\u3093\u3042\u308b\u306e\u3067\u3059\u304c\u3001MetaTrader\u304b\u3089\u5165\u3063\u305f\u4eba\u306b\u3068\u3063\u3066\u306f\u308f\u304b\u308a\u306b\u304f\u3044\u306e\u3067\u3001Python\u306e\u7df4\u7fd2\u304c\u3066\u3089\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u306e\u305f\u3081\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002\n\n[Python\u3067\u30b7\u30b9\u30c8\u30ec\u306e\u30d0\u30c3\u30af\u30c6\u30b9\u30c8](http://forex.toyolab.com/?p=631)\n\n\u305f\u3060\u3001\u6700\u521d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u3001\u307e\u305a\u52d5\u304f\u3053\u3068\u3092\u7b2c\u4e00\u306b\u66f8\u3044\u305f\u306e\u3067\u3001\u7d50\u69cb\u7121\u99c4\u304c\u3042\u3063\u305f\u308a\u3001\u5b9f\u884c\u901f\u5ea6\u304c\u9045\u304b\u3063\u305f\u308a\u3057\u305f\u306e\u3067\u3001\u4eca\u56de\u3001\u3061\u3087\u3063\u3068\u6539\u826f\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n# FX\u30d2\u30b9\u30c8\u30ea\u30ab\u30eb\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\n\u682a\u4fa1\u3060\u3068\u3001Yahoo!\u3068\u304b\u304b\u3089\u76f4\u63a5\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u4f7f\u3048\u308b\u3082\u306e\u3082\u591a\u3044\u306e\u3067\u3059\u304c\u3001FX\u3060\u30685\u5206\u8db3\u3068\u304b15\u5206\u8db3\u3068\u304b\u8907\u6570\u306e\u30bf\u30a4\u30e0\u30d5\u30ec\u30fc\u30e0\u306e\u30c7\u30fc\u30bf\u3092\u4f7f\u3046\u3053\u3068\u3082\u3042\u308b\u306e\u3067\u3001\u57fa\u672c\u306e\u30c7\u30fc\u30bf\u3068\u3057\u30661\u5206\u8db3\u30c7\u30fc\u30bf\u304c\u6b32\u3057\u3044\u3068\u3053\u308d\u3067\u3059\u3002\n\n\u305d\u3046\u306a\u308b\u3068\u3001\u30c7\u30fc\u30bf\u3082\u5927\u304d\u3044\u306e\u3067\u3001\u4e88\u3081\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u3080\u65b9\u304c\u90fd\u5408\u304c\u3044\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u30b5\u30f3\u30d7\u30eb\u30c7\u30fc\u30bf\u3068\u3057\u3066\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n[HistData.com](http://www.histdata.com/)\n\n\u540c\u3058\u30c7\u30fc\u30bf\u3067\u3082\u3044\u304f\u3064\u304b\u306e\u5f62\u5f0f\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001pandas\u306e\u95a2\u6570\u3092\u4f7f\u3046\u95a2\u4fc2\u3067\u3001Generic ASCII\u306e\u5f62\u5f0f\u306e\u30c7\u30fc\u30bf\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u3067\u306f\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305fEUR/USD\u306e2015\u5e74\u5206\u306e1\u5206\u8db3\u30c7\u30fc\u30bf'DAT_ASCII_EURUSD_M1_2015.csv'\u3092pandas\u306e\u95a2\u6570\u3067\u8aad\u307f\u8fbc\u3093\u3067\u307f\u307e\u3059\u3002\u305f\u3060\u3001\u3053\u306e\u307e\u307e\u3060\u3068\u9031\u660e\u3051\u306e\u76f8\u5834\u304c\u65e5\u66dc\u65e5\u304b\u3089\u59cb\u307e\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u30017\u6642\u9593\u3060\u3051\u9045\u3089\u305b\u3066\u3001\u6708\u66dc\u65e5\u306e0\u6642\u304b\u3089\u59cb\u3081\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n````py\nimport numpy as np\nimport pandas as pd\n\ndataM1 = pd.read_csv('DAT_ASCII_EURUSD_M1_2015.csv', sep=';',\n                     names=('Time','Open','High','Low','Close', ''),\n                     index_col='Time', parse_dates=True)\ndataM1.index += pd.offsets.Hour(7) #7\u6642\u9593\u306e\u30aa\u30d5\u30bb\u30c3\u30c8\n````\n\n# \u4efb\u610f\u306e\u30bf\u30a4\u30e0\u30d5\u30ec\u30fc\u30e0\u30c7\u30fc\u30bf\u306e\u4f5c\u6210\n\u6b21\u306b1\u5206\u8db3\u306e\u30c7\u30fc\u30bf\u304b\u3089\u4efb\u610f\u306e\u30bf\u30a4\u30e0\u30d5\u30ec\u30fc\u30e0\u306e\u30c7\u30fc\u30bf\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u3082pandas\u306e`resample()`, `ohlc()`\u3068\u3044\u3046\u95a2\u6570\u3092\u4f7f\u3048\u3070\u7c21\u5358\u306b\u3067\u304d\u307e\u3059\u3002\n\n````py\n# df\u306e\u30c7\u30fc\u30bf\u304b\u3089tf\u3067\u6307\u5b9a\u3059\u308b\u30bf\u30a4\u30e0\u30d5\u30ec\u30fc\u30e0\u306e4\u672c\u8db3\u30c7\u30fc\u30bf\u3092\u4f5c\u6210\u3059\u308b\u95a2\u6570\ndef TF_ohlc(df, tf):\n    x = df.resample(tf).ohlc()\n    O = x['Open']['open']\n    H = x['High']['high']\n    L = x['Low']['low']\n    C = x['Close']['close']\n    ret = pd.DataFrame({'Open': O, 'High': H, 'Low': L, 'Close': C},\n                       columns=['Open','High','Low','Close'])\n    return ret.dropna()\n\nohlc = TF_ohlc(dataM1, 'H') #\uff11\u6642\u9593\u8db3\u30c7\u30fc\u30bf\u306e\u4f5c\u6210\n`````\n\n`tf`\u306b\u6307\u5b9a\u3059\u308b\u30ad\u30fc\u30ef\u30fc\u30c9\u306f\u3001\n\n* \u5206 - `'T'`\n* \u6642 - `'H'`\n* \u65e5 - `'D'`\n* \u9031 - `'W'`\n* \u6708 - `'M'`\n\n\u3067\u300115\u5206\u306e\u5834\u5408\u3001`'15T'`\u3068\u66f8\u3051\u3070\u3044\u3044\u3067\u3059\u3002\u3053\u308c\u3067\u3001\u4f55\u5206\u8db3\u306e\u30c7\u30fc\u30bf\u3067\u3082\u4f5c\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u30011\u6642\u9593\u8db3\u306e\u30c7\u30fc\u30bf\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n# \u30c6\u30af\u30cb\u30ab\u30eb\u6307\u6a19\u306e\u4f5c\u6210\n\n\u30b7\u30b9\u30c8\u30ec\u306e\u58f2\u8cb7\u30eb\u30fc\u30eb\u3067\u4f7f\u3046\u30c6\u30af\u30cb\u30ab\u30eb\u6307\u6a19\u306f[GitHub](https://github.com/toyolab/MT5IndicatorsPy)\u306b\u4f5c\u3063\u3066\u3042\u308a\u307e\u3059\u3002indicators.py\u3060\u3051\u53d6\u3063\u3066\u304f\u308c\u3070\u4f7f\u3048\u307e\u3059\u3002\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u7701\u7565\u3057\u307e\u3059\u304c\u3001\u5185\u90e8\u306e\u7e70\u308a\u8fd4\u3057\u3067pandas\u4f7f\u308f\u306a\u3044\u3088\u3046\u306b\u3057\u305f\u308a\u3001Numba\u3092\u4f7f\u3063\u305f\u308a\u3057\u305f\u306e\u3067\u3001\u6975\u7aef\u306b\u6642\u9593\u306e\u304b\u304b\u308b\u95a2\u6570\u306f\u306a\u304f\u306a\u3063\u305f\u3068\u601d\u3044\u307e\u3059\u3002~~\u305f\u3060\u3057\u3001\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u95a2\u4fc2\u3067\u30d1\u30e9\u30dc\u30ea\u30c3\u30afSAR\u306f\u591a\u5c11\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u3002~~\n\n\u4f8b\u3048\u3070\u300110\u30d0\u30fc\u306e\u79fb\u52d5\u5e73\u5747\u306830\u30d0\u30fc\u306e\u79fb\u52d5\u5e73\u5747\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u3051\u307e\u3059\u3002\n\n````py\nimport indicators as ind #indicators.py\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\nFastMA = ind.iMA(ohlc, 10) #\u77ed\u671f\u79fb\u52d5\u5e73\u5747\nSlowMA = ind.iMA(ohlc, 30) #\u9577\u671f\u79fb\u52d5\u5e73\u5747\n````\n\n# \u30c6\u30af\u30cb\u30ab\u30eb\u6307\u6a19\u306e\u8868\u793a\n\n\u4f5c\u6210\u3057\u305f\u30c6\u30af\u30cb\u30ab\u30eb\u6307\u6a19\u3092\u30c1\u30e3\u30fc\u30c8\u306b\u8868\u793a\u3055\u305b\u308b\u306e\u306b\u3001pandas\u306eplot\u95a2\u6570\u3067\u3082\u3044\u3044\u306e\u3067\u3059\u304c\u3001\u62e1\u5927\u7e2e\u5c0f\u3057\u305f\u3044\u3053\u3068\u3082\u3042\u308b\u306e\u3067\u3001\u76f8\u5834\u95a2\u4fc2\u306e\u30b5\u30a4\u30c8\u3067\u3088\u304f\u898b\u304b\u3051\u308b[HighCharts](http://www.highcharts.com/)\u306b\u8868\u793a\u3055\u305b\u308bPython\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\n\n\u3053\u3053\u3067\u306f\u3001\u7c21\u5358\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u305f[pandas-highcharts](https://github.com/gtnx/pandas-highcharts)\u3092\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u3001\n\n````\npip install pandas-highcharts\n````\n\n\u3067OK\u3067\u3059\u3002FX\u306e\u7d42\u5024\u3068\uff12\u672c\u306e\u79fb\u52d5\u5e73\u5747\u3092\u8868\u793a\u3055\u305b\u308b\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n````py\nfrom pandas_highcharts.display import display_charts\ndf = pd.DataFrame({'Close': ohlc['Close'], 'FastMA': FastMA, 'SlowMA': SlowMA})\ndisplay_charts(df, chart_type=\"stock\", title=\"MA cross\", figsize=(640,480), grid=True)\n````\n\u3053\u308c\u3092\u5b9f\u884c\u3059\u308b\u3068\u3053\u3093\u306a\u30c1\u30e3\u30fc\u30c8\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n![chart_y.png](https://qiita-image-store.s3.amazonaws.com/0/131169/db0a3afd-c2f5-fcd2-d84a-46320610148a.png)\n\n\uff11\u5e74\u5206\u3092\u8868\u793a\u3055\u305b\u308b\u3068\u79fb\u52d5\u5e73\u5747\u304c\u307b\u3068\u3093\u3069\u91cd\u306a\u3063\u3066\u898b\u3048\u306a\u3044\u306e\u3067\u3001\u9069\u5f53\u306b\u30ba\u30fc\u30e0\u3059\u308b\u3068\u3001\u3053\u3093\u306a\u611f\u3058\u306b\u306a\u308a\u3001\u79fb\u52d5\u5e73\u5747\u306e\u9055\u3044\u304c\u898b\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n![chart_m.png](https://qiita-image-store.s3.amazonaws.com/0/131169/1c6f7853-aa1c-7b3e-3f02-270a192edffb.png)\n\n\u306a\u304b\u306a\u304b\u4fbf\u5229\u3067\u3059\u3002\n\n# \u79fb\u52d5\u5e73\u5747\u4ea4\u5dee\u30b7\u30b9\u30c6\u30e0\u306e\u58f2\u8cb7\u30eb\u30fc\u30eb\n\u58f2\u8cb7\u30b7\u30b9\u30c6\u30e0\u306e\u4e00\u4f8b\u3068\u3057\u3066\u3001\u5b9a\u756a\u306e\u79fb\u52d5\u5e73\u5747\u306e\u4ea4\u5dee\u30b7\u30b9\u30c6\u30e0\u3092\u53d6\u308a\u4e0a\u3052\u307e\u3059\u3002\u58f2\u8cb7\u30eb\u30fc\u30eb\u306f\u3001\n\n* \u8cb7\u3044\u30b7\u30b0\u30ca\u30eb - \u77ed\u671f\u79fb\u52d5\u5e73\u5747\u7dda\u304c\u9577\u671f\u79fb\u52d5\u5e73\u5747\u7dda\u3092\u4e0a\u629c\u3051\u308b\n* \u58f2\u308a\u30b7\u30b0\u30ca\u30eb - \u77ed\u671f\u79fb\u52d5\u5e73\u5747\u7dda\u304c\u9577\u671f\u79fb\u52d5\u5e73\u5747\u7dda\u3092\u4e0b\u629c\u3051\u308b\n\n\u3068\u3044\u3046\u5358\u7d14\u306a\u3082\u306e\u3067\u3059\u3002\u3053\u306e\u30b7\u30b0\u30ca\u30eb\u306f\u30a8\u30f3\u30c8\u30ea\u30fc\u306e\u30b7\u30b0\u30ca\u30eb\u3067\u3001\u30dd\u30b8\u30b7\u30e7\u30f3\u3092\u6c7a\u6e08\u3059\u308b\u305f\u3081\u306e\u30a8\u30b0\u30b8\u30c3\u30c8\u30b7\u30b0\u30ca\u30eb\u306f\u3001\u8cb7\u3044\u30a8\u30b0\u30b8\u30c3\u30c8\u306f\u58f2\u308a\u30a8\u30f3\u30c8\u30ea\u30fc\u3068\u540c\u3058\u3001\u58f2\u308a\u30a8\u30b0\u30b8\u30c3\u30c8\u306f\u8cb7\u3044\u30a8\u30f3\u30c8\u30ea\u30fc\u540c\u3058\u3082\u306e\u3068\u3057\u307e\u3059\u3002\u3044\u308f\u3086\u308b\u9014\u8ee2\u58f2\u8cb7\u3067\u3059\u3002\n\n````py\n#\u8cb7\u3044\u30a8\u30f3\u30c8\u30ea\u30fc\u30b7\u30b0\u30ca\u30eb\nBuyEntry = ((FastMA > SlowMA) & (FastMA.shift() <= SlowMA.shift())).values\n#\u58f2\u308a\u30a8\u30f3\u30c8\u30ea\u30fc\u30b7\u30b0\u30ca\u30eb\nSellEntry = ((FastMA < SlowMA) & (FastMA.shift() >= SlowMA.shift())).values\n#\u8cb7\u3044\u30a8\u30b0\u30b8\u30c3\u30c8\u30b7\u30b0\u30ca\u30eb\nBuyExit = SellEntry.copy()\n#\u58f2\u308a\u30a8\u30b0\u30b8\u30c3\u30c8\u30b7\u30b0\u30ca\u30eb\nSellExit = BuyEntry.copy()\n````\n\n\u3053\u3053\u3067\u306f\u3001\u305d\u308c\u305e\u308c\u306e\u30b7\u30b0\u30ca\u30eb\u304cnumpy\u306ebool\u578b\u306e\u914d\u5217\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u666e\u901a\u306b\u8003\u3048\u308b\u3068\u3001\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u3092\u56de\u3057\u306a\u304c\u3089\u30b7\u30b0\u30ca\u30eb\u306e\u5224\u5225\u3092\u3059\u308b\u3068\u3053\u308d\u3067\u3057\u3087\u3046\u304c\u3001Python\u306e\u5834\u5408\u3001\u914d\u5217\u3067\u307e\u3068\u3081\u3066\u51e6\u7406\u3057\u305f\u65b9\u304c\u901f\u3044\u306e\u3067\u3001\u30b7\u30b0\u30ca\u30eb\u3092\u914d\u5217\u306b\u5165\u308c\u3066\u304a\u304d\u307e\u3059\u3002\n\n# \u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u306e\u5b9f\u884c\n\u3044\u3088\u3044\u3088\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u3092\u884c\u3044\u307e\u3059\u3002\u30d2\u30b9\u30c8\u30ea\u30ab\u30eb\u30c7\u30fc\u30bf\u3068\u3001\u4e0a\u8a18\u306e\u58f2\u8cb7\u30b7\u30b0\u30ca\u30eb\u3092\u5165\u529b\u3057\u3066\u3001\u5b9f\u969b\u306b\u58f2\u8cb7\u3057\u305f\u4fa1\u683c\u3068\u640d\u76ca\u3092\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u3068\u3057\u3066\u51fa\u529b\u3055\u305b\u307e\u3059\u3002\n\n````py\ndef Backtest(ohlc, BuyEntry, SellEntry, BuyExit, SellExit, lots=0.1, spread=2):\n    Open = ohlc['Open'].values #\u59cb\u5024\n    Point = 0.0001 #1pip\u306e\u5024\n    if(Open[0] > 50): Point = 0.01 #\u30af\u30ed\u30b9\u5186\u306e1pip\u306e\u5024\n    Spread = spread*Point #\u30b9\u30d7\u30ec\u30c3\u30c9\n    Lots = lots*100000 #\u5b9f\u969b\u306e\u58f2\u8cb7\u91cf\n    N = len(ohlc) #FX\u30c7\u30fc\u30bf\u306e\u30b5\u30a4\u30ba\n    BuyExit[N-2] = SellExit[N-2] = True #\u6700\u5f8c\u306b\u5f37\u5236\u30a8\u30b0\u30b8\u30c3\u30c8\n    BuyPrice = SellPrice = 0.0 # \u58f2\u8cb7\u4fa1\u683c\n    \n    LongTrade = np.zeros(N) # \u8cb7\u3044\u30c8\u30ec\u30fc\u30c9\u60c5\u5831\n    ShortTrade = np.zeros(N) # \u58f2\u308a\u30c8\u30ec\u30fc\u30c9\u60c5\u5831\n    \n    LongPL = np.zeros(N) # \u8cb7\u3044\u30dd\u30b8\u30b7\u30e7\u30f3\u306e\u640d\u76ca\n    ShortPL = np.zeros(N) # \u58f2\u308a\u30dd\u30b8\u30b7\u30e7\u30f3\u306e\u640d\u76ca\n\n    for i in range(1,N):\n        if BuyEntry[i-1] and BuyPrice == 0: #\u8cb7\u3044\u30a8\u30f3\u30c8\u30ea\u30fc\u30b7\u30b0\u30ca\u30eb\n            BuyPrice = Open[i]+Spread\n            LongTrade[i] = BuyPrice #\u8cb7\u3044\u30dd\u30b8\u30b7\u30e7\u30f3\u30aa\u30fc\u30d7\u30f3\n        elif BuyExit[i-1] and BuyPrice != 0: #\u8cb7\u3044\u30a8\u30b0\u30b8\u30c3\u30c8\u30b7\u30b0\u30ca\u30eb\n            ClosePrice = Open[i]\n            LongTrade[i] = -ClosePrice #\u8cb7\u3044\u30dd\u30b8\u30b7\u30e7\u30f3\u30af\u30ed\u30fc\u30ba\n            LongPL[i] = (ClosePrice-BuyPrice)*Lots #\u640d\u76ca\u78ba\u5b9a\n            BuyPrice = 0\n\n        if SellEntry[i-1] and SellPrice == 0: #\u58f2\u308a\u30a8\u30f3\u30c8\u30ea\u30fc\u30b7\u30b0\u30ca\u30eb\n            SellPrice = Open[i]\n            ShortTrade[i] = SellPrice #\u58f2\u308a\u30dd\u30b8\u30b7\u30e7\u30f3\u30aa\u30fc\u30d7\u30f3\n        elif SellExit[i-1] and SellPrice != 0: #\u58f2\u308a\u30a8\u30b0\u30b8\u30c3\u30c8\u30b7\u30b0\u30ca\u30eb\n            ClosePrice = Open[i]+Spread\n            ShortTrade[i] = -ClosePrice #\u58f2\u308a\u30dd\u30b8\u30b7\u30e7\u30f3\u30af\u30ed\u30fc\u30ba\n            ShortPL[i] = (SellPrice-ClosePrice)*Lots #\u640d\u76ca\u78ba\u5b9a\n            SellPrice = 0\n\n    return pd.DataFrame({'Long':LongTrade, 'Short':ShortTrade}, index=ohlc.index),\\\n            pd.DataFrame({'Long':LongPL, 'Short':ShortPL}, index=ohlc.index)\n        \nTrade, PL = Backtest(ohlc, BuyEntry, SellEntry, BuyExit, SellExit)\n````\n\n\u524d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u3001\u3053\u306e\u90e8\u5206\u3092\u4f55\u6bb5\u968e\u304b\u306b\u5206\u3051\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u307e\u3068\u3081\u3066\u307f\u307e\u3057\u305f\u3002\u672c\u6765\u306a\u3089\u30b7\u30b0\u30ca\u30eb\u3060\u3051\u3067\u30c8\u30ec\u30fc\u30c9\u3067\u304d\u308c\u3070\u3044\u3044\u306e\u3067\u3059\u304c\u3001\u30dd\u30b8\u30b7\u30e7\u30f3\u304c\u3042\u3063\u3066\u3082\u30b7\u30b0\u30ca\u30eb\u304c\u51fa\u308b\u30b1\u30fc\u30b9\u3082\u3042\u308b\u306e\u3067\u3001\u30dd\u30b8\u30b7\u30e7\u30f3\u306e\u6709\u7121\u3082\u30c1\u30a7\u30c3\u30af\u3059\u308b\u5f62\u306b\u3057\u307e\u3057\u305f\u3002\n\n\u3053\u306e\u95a2\u6570\u306e\u51fa\u529b\u306e\u3046\u3061\u3001`Trade`\u306b\u306f\u3001\u8cb7\u3044\u3068\u58f2\u308a\u305d\u308c\u305e\u308c\u306b\u3001\u58f2\u8cb7\u4fa1\u683c\u3092\u30d7\u30e9\u30b9\u306e\u5024\u3001\u6c7a\u6e08\u4fa1\u683c\u3092\u30de\u30a4\u30ca\u30b9\u306e\u5024\u3067\u683c\u7d0d\u3057\u3066\u3042\u308a\u307e\u3059\u3002`PL`\u306b\u306f\u3001\u6c7a\u6e08\u6642\u70b9\u3067\u306e\u5b9f\u73fe\u640d\u76ca\u304c\u683c\u7d0d\u3057\u3066\u3042\u308a\u307e\u3059\u3002\n\n# \u58f2\u8cb7\u30b7\u30b9\u30c6\u30e0\u306e\u8a55\u4fa1\n`Trade`\u3068`PL`\u306e\u60c5\u5831\u304c\u3042\u308c\u3070\u3001\u58f2\u8cb7\u30b7\u30b9\u30c6\u30e0\u306e\u3060\u3044\u305f\u3044\u306e\u8a55\u4fa1\u304c\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n````py\ndef BacktestReport(Trade, PL):\n    LongPL = PL['Long']\n    LongTrades = np.count_nonzero(Trade['Long'])//2\n    LongWinTrades = np.count_nonzero(LongPL.clip_lower(0))\n    LongLoseTrades = np.count_nonzero(LongPL.clip_upper(0))\n    print('\u8cb7\u3044\u30c8\u30ec\u30fc\u30c9\u6570 =', LongTrades)\n    print('\u52dd\u30c8\u30ec\u30fc\u30c9\u6570 =', LongWinTrades)\n    print('\u6700\u5927\u52dd\u30c8\u30ec\u30fc\u30c9 =', LongPL.max())\n    print('\u5e73\u5747\u52dd\u30c8\u30ec\u30fc\u30c9 =', round(LongPL.clip_lower(0).sum()/LongWinTrades, 2))\n    print('\u8ca0\u30c8\u30ec\u30fc\u30c9\u6570 =', LongLoseTrades)\n    print('\u6700\u5927\u8ca0\u30c8\u30ec\u30fc\u30c9 =', LongPL.min())\n    print('\u5e73\u5747\u8ca0\u30c8\u30ec\u30fc\u30c9 =', round(LongPL.clip_upper(0).sum()/LongLoseTrades, 2))\n    print('\u52dd\u7387 =', round(LongWinTrades/LongTrades*100, 2), '%\\n')\n\n    ShortPL = PL['Short']\n    ShortTrades = np.count_nonzero(Trade['Short'])//2\n    ShortWinTrades = np.count_nonzero(ShortPL.clip_lower(0))\n    ShortLoseTrades = np.count_nonzero(ShortPL.clip_upper(0))\n    print('\u58f2\u308a\u30c8\u30ec\u30fc\u30c9\u6570 =', ShortTrades)\n    print('\u52dd\u30c8\u30ec\u30fc\u30c9\u6570 =', ShortWinTrades)\n    print('\u6700\u5927\u52dd\u30c8\u30ec\u30fc\u30c9 =', ShortPL.max())\n    print('\u5e73\u5747\u52dd\u30c8\u30ec\u30fc\u30c9 =', round(ShortPL.clip_lower(0).sum()/ShortWinTrades, 2))\n    print('\u8ca0\u30c8\u30ec\u30fc\u30c9\u6570 =', ShortLoseTrades)\n    print('\u6700\u5927\u8ca0\u30c8\u30ec\u30fc\u30c9 =', ShortPL.min())\n    print('\u5e73\u5747\u8ca0\u30c8\u30ec\u30fc\u30c9 =', round(ShortPL.clip_upper(0).sum()/ShortLoseTrades, 2))\n    print('\u52dd\u7387 =', round(ShortWinTrades/ShortTrades*100, 2), '%\\n')\n\n    Trades = LongTrades + ShortTrades\n    WinTrades = LongWinTrades+ShortWinTrades\n    LoseTrades = LongLoseTrades+ShortLoseTrades\n    print('\u7dcf\u30c8\u30ec\u30fc\u30c9\u6570 =', Trades)\n    print('\u52dd\u30c8\u30ec\u30fc\u30c9\u6570 =', WinTrades)\n    print('\u6700\u5927\u52dd\u30c8\u30ec\u30fc\u30c9 =', max(LongPL.max(), ShortPL.max()))\n    print('\u5e73\u5747\u52dd\u30c8\u30ec\u30fc\u30c9 =', round((LongPL.clip_lower(0).sum()+ShortPL.clip_lower(0).sum())/WinTrades, 2))\n    print('\u8ca0\u30c8\u30ec\u30fc\u30c9\u6570 =', LoseTrades)\n    print('\u6700\u5927\u8ca0\u30c8\u30ec\u30fc\u30c9 =', min(LongPL.min(), ShortPL.min()))\n    print('\u5e73\u5747\u8ca0\u30c8\u30ec\u30fc\u30c9 =', round((LongPL.clip_upper(0).sum()+ShortPL.clip_upper(0).sum())/LoseTrades, 2))\n    print('\u52dd\u7387 =', round(WinTrades/Trades*100, 2), '%\\n')\n\n    GrossProfit = LongPL.clip_lower(0).sum()+ShortPL.clip_lower(0).sum()\n    GrossLoss = LongPL.clip_upper(0).sum()+ShortPL.clip_upper(0).sum()\n    Profit = GrossProfit+GrossLoss\n    Equity = (LongPL+ShortPL).cumsum()\n    MDD = (Equity.cummax()-Equity).max()\n    print('\u7dcf\u5229\u76ca =', round(GrossProfit, 2))\n    print('\u7dcf\u640d\u5931 =', round(GrossLoss, 2))\n    print('\u7dcf\u640d\u76ca =', round(Profit, 2))\n    print('\u30d7\u30ed\u30d5\u30a3\u30c3\u30c8\u30d5\u30a1\u30af\u30bf\u30fc =', round(-GrossProfit/GrossLoss, 2))\n    print('\u5e73\u5747\u640d\u76ca =', round(Profit/Trades, 2))\n    print('\u6700\u5927\u30c9\u30ed\u30fc\u30c0\u30a6\u30f3 =', round(MDD, 2))\n    print('\u30ea\u30ab\u30d0\u30ea\u30fc\u30d5\u30a1\u30af\u30bf\u30fc =', round(Profit/MDD, 2))\n    return Equity\nEquity = BacktestReport(Trade, PL)\n````\n\n````\n\u8cb7\u3044\u30c8\u30ec\u30fc\u30c9\u6570 = 113\n\u52dd\u30c8\u30ec\u30fc\u30c9\u6570 = 39\n\u6700\u5927\u52dd\u30c8\u30ec\u30fc\u30c9 = 440.4\n\u5e73\u5747\u52dd\u30c8\u30ec\u30fc\u30c9 = 82.57\n\u8ca0\u30c8\u30ec\u30fc\u30c9\u6570 = 74\n\u6700\u5927\u8ca0\u30c8\u30ec\u30fc\u30c9 = -169.4\n\u5e73\u5747\u8ca0\u30c8\u30ec\u30fc\u30c9 = -43.89\n\u52dd\u7387 = 34.51 %\n\n\u58f2\u308a\u30c8\u30ec\u30fc\u30c9\u6570 = 113\n\u52dd\u30c8\u30ec\u30fc\u30c9\u6570 = 49\n\u6700\u5927\u52dd\u30c8\u30ec\u30fc\u30c9 = 327.6\n\u5e73\u5747\u52dd\u30c8\u30ec\u30fc\u30c9 = 78.71\n\u8ca0\u30c8\u30ec\u30fc\u30c9\u6570 = 64\n\u6700\u5927\u8ca0\u30c8\u30ec\u30fc\u30c9 = -238.5\n\u5e73\u5747\u8ca0\u30c8\u30ec\u30fc\u30c9 = -43.85\n\u52dd\u7387 = 43.36 %\n\n\u7dcf\u30c8\u30ec\u30fc\u30c9\u6570 = 226\n\u52dd\u30c8\u30ec\u30fc\u30c9\u6570 = 88\n\u6700\u5927\u52dd\u30c8\u30ec\u30fc\u30c9 = 440.4\n\u5e73\u5747\u52dd\u30c8\u30ec\u30fc\u30c9 = 80.42\n\u8ca0\u30c8\u30ec\u30fc\u30c9\u6570 = 138\n\u6700\u5927\u8ca0\u30c8\u30ec\u30fc\u30c9 = -238.5\n\u5e73\u5747\u8ca0\u30c8\u30ec\u30fc\u30c9 = -43.87\n\u52dd\u7387 = 38.94 %\n\n\u7dcf\u5229\u76ca = 7077.0\n\u7dcf\u640d\u5931 = -6054.4\n\u7dcf\u640d\u76ca = 1022.6\n\u30d7\u30ed\u30d5\u30a3\u30c3\u30c8\u30d5\u30a1\u30af\u30bf\u30fc = 1.17\n\u5e73\u5747\u640d\u76ca = 4.52\n\u6700\u5927\u30c9\u30ed\u30fc\u30c0\u30a6\u30f3 = 1125.4\n\u30ea\u30ab\u30d0\u30ea\u30fc\u30d5\u30a1\u30af\u30bf\u30fc = 0.91\n````\n\n\u3053\u3053\u3067\u306f\u3001\u5404\u9805\u76ee\u3092\u8868\u793a\u3055\u305b\u3066\u3044\u307e\u3059\u304c\u3001\u6a5f\u68b0\u5b66\u7fd2\u3084\u6700\u9069\u5316\u3092\u884c\u3046\u5834\u5408\u306b\u306f\u3001\u8a55\u4fa1\u5024\u306e\u307f\u3092\u8a08\u7b97\u3055\u305b\u308b\u3088\u3046\u306b\u3059\u308c\u3070\u3088\u3044\u3067\u3057\u3087\u3046\u3002\n\n\u30b7\u30b9\u30c6\u30e0\u306e\u8a55\u4fa1\u3068\u3057\u3066\u8cc7\u7523\u66f2\u7dda\u3092\u898b\u305f\u3044\u5834\u5408\u3082\u591a\u3044\u3067\u3057\u3087\u3046\u3002\u4e0a\u8a18\u306e\u95a2\u6570\u3067\u306f\u3001`Equity`\u3068\u3057\u3066\u8cc7\u7523\u66f2\u7dda\u3092\u51fa\u529b\u3055\u305b\u3066\u3044\u308b\u306e\u3067\u3001\u521d\u671f\u8cc7\u7523\u3092\u52a0\u7b97\u3057\u3066\u30b0\u30e9\u30d5\u306b\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n````py\nInitial = 10000 # \u521d\u671f\u8cc7\u7523\ndisplay_charts(pd.DataFrame({'Equity':Equity+Initial}), chart_type=\"stock\", title=\"\u8cc7\u7523\u66f2\u7dda\", figsize=(640,480), grid=True)\n````\n![equity.png](https://qiita-image-store.s3.amazonaws.com/0/131169/6c6e6c1a-37cc-b54b-32ec-38a180c8c964.png)\n\n# \u30c8\u30ec\u30fc\u30c9\u30c1\u30e3\u30fc\u30c8\u306e\u8868\u793a\n\n\u6700\u5f8c\u306b\u3001\u30c1\u30e3\u30fc\u30c8\u4e0a\u306e\u3069\u3053\u3067\u58f2\u8cb7\u3057\u305f\u304b\u3092\u8868\u793a\u3055\u305b\u3066\u307f\u307e\u3059\u3002\u58f2\u8cb7\u3057\u305f\u30dd\u30a4\u30f3\u30c8\u306e\u307f\u3092\u8868\u793a\u3055\u305b\u3066\u3082\u3044\u3044\u306e\u3067\u3059\u304c\u3001HighCharts\u3067\u306e\u65b9\u6cd5\u304c\u308f\u304b\u3089\u306a\u3044\u306e\u3067\u3001\u30dd\u30b8\u30b7\u30e7\u30f3\u3092\u30aa\u30fc\u30d7\u30f3\u3057\u305f\u30dd\u30a4\u30f3\u30c8\u3068\u30af\u30ed\u30fc\u30ba\u3057\u305f\u30dd\u30a4\u30f3\u30c8\u3092\u30e9\u30a4\u30f3\u3067\u7d50\u3093\u3067\u307f\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u3067`Trade`\u60c5\u5831\u304b\u3089\u30e9\u30a4\u30f3\u306b\u5909\u63db\u3057\u3066\u307f\u307e\u3059\u3002\n\n````py\ndef PositionLine(trade):\n    PosPeriod = 0 #\u30dd\u30b8\u30b7\u30e7\u30f3\u306e\u671f\u9593\n    Position = False #\u30dd\u30b8\u30b7\u30e7\u30f3\u306e\u6709\u7121\n    Line = trade.copy()\n    for i in range(len(Line)):\n        if trade[i] > 0: Position = True \n        elif Position: PosPeriod += 1 # \u30dd\u30b8\u30b7\u30e7\u30f3\u306e\u671f\u9593\u3092\u30ab\u30a6\u30f3\u30c8\n        if trade[i] < 0:\n            if PosPeriod > 0:\n                Line[i] = -trade[i]\n                diff = (Line[i]-Line[i-PosPeriod])/PosPeriod\n                for j in range(i-1, i-PosPeriod, -1):\n                    Line[j] = Line[j+1]-diff # \u30dd\u30b8\u30b7\u30e7\u30f3\u306e\u671f\u9593\u3092\u88dc\u9593\n                PosPeriod = 0\n                Position = False\n        if trade[i] == 0 and not Position: Line[i] = 'NaN'\n    return Line\n\ndf = pd.DataFrame({'Open': ohlc['Open'],\n                   'Long': PositionLine(Trade['Long'].values),\n                   'Short': PositionLine(Trade['Short'].values)})\ndisplay_charts(df, chart_type=\"stock\", title=\"\u30c8\u30ec\u30fc\u30c9\u30c1\u30e3\u30fc\u30c8\", figsize=(640,480), grid=True)\n````\n\u540c\u3058\u3088\u3046\u306bHighCharts\u306b\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u9069\u5f53\u306b\u30ba\u30fc\u30e0\u3057\u3066\u307f\u307e\u3059\u3002\n\n![trade.png](https://qiita-image-store.s3.amazonaws.com/0/131169/8acb23aa-89a2-cee4-9da7-3b60ecd73e2e.png)\n\n\u9014\u8ee2\u58f2\u8cb7\u306e\u30b7\u30b9\u30c6\u30e0\u306a\u306e\u3067\u3001Long\u30dd\u30b8\u30b7\u30e7\u30f3\u3068Short\u30dd\u30b8\u30b7\u30e7\u30f3\u304c\u4ea4\u4e92\u306b\u51fa\u3066\u304f\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n# \u307e\u3068\u3081\n\u58f2\u8cb7\u30eb\u30fc\u30eb\u304c\u30c6\u30af\u30cb\u30ab\u30eb\u6307\u6a19\u3060\u3051\u3067\u8a18\u8ff0\u3067\u304d\u308b\u3088\u3046\u306a\u30b7\u30b9\u30c6\u30e0\u306e\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u3092\u884c\u3046\u30b3\u30fc\u30c9\u3092Python\u3067\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002Python\u304b\u3089HighCharts\u306b\u30b0\u30e9\u30d5\u8868\u793a\u3067\u304d\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u306f\u306a\u304b\u306a\u304b\u4fbf\u5229\u3067\u3057\u305f\u3002\u307e\u3060\u307e\u3060\u6539\u5584\u306e\u4f59\u5730\u306f\u3042\u308b\u306e\u3067\u3001\u6c17\u304c\u5411\u3044\u305f\u3089\u7d9a\u304d\u3092\u66f8\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u7d9a\u304d\u306f\u3053\u3061\u3089\u3067\u3059\u3002\n[Python\u3067FX\u30b7\u30b9\u30c8\u30ec\u306e\u30d0\u30c3\u30af\u30c6\u30b9\u30c8(2)](http://qiita.com/toyolab/items/8fe0f05cc28af29a9ad9)\n\n\u306a\u304a\u3001\u672c\u8a18\u4e8b\u3067\u63b2\u8f09\u3057\u305f\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u3042\u308a\u307e\u3059\u3002\n[MT5IndicatorsPy/EA_sample.ipynb](https://nbviewer.jupyter.org/github/toyolab/MT5IndicatorsPy/blob/master/EA_sample.ipynb\n)\n", "tags": ["Python", "\u30c6\u30af\u30cb\u30ab\u30eb\u6307\u6a19", "FX", "\u30b7\u30b9\u30c8\u30ec", "\u30d0\u30c3\u30af\u30c6\u30b9\u30c8"]}