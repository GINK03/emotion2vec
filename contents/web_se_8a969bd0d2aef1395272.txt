{"context": "3/13 EC2 Auto Recovery\u304c\u5168\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u5bfe\u5fdc\nEC2 Auto Recovery\u6628\u5e74\u672b\u306eEC2 \u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u3068\u304b\u3001\u5197\u9577\u5316\u306b\u5bfe\u5fdc\u3067\u304d\u3066\u3044\u306a\u3044\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u306e\u30b5\u30fc\u30d0\u30fc\u306e\u53ef\u7528\u6027\u3092\u6301\u305f\u305b\u308b\u3053\u3068\u306b\u4f7f\u3048\u308b\u3068\u601d\u308f\u308c\u307e\u3059\u3002\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u591a\u3044\u3068CreateAlarm\u3082Management Console\u304b\u3089\u3067\u306f\u9762\u5012\n\u305d\u3053\u3067\u3001\u540c\u4e00\u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u5bfe\u3057\u3066\u3001Revery Instance\u3092\u767b\u9332\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\n#! /bin/bash -ex\n\nfor INSTANCE_ID in `aws ec2 describe-instances --region ap-northeast-1 | jq '.Reservations[].Instances[].InstanceId ' | cut -d '\"' -f 2`\ndo\n\naws cloudwatch put-metric-alarm --alarm-name \"recover-instance \".$INSTANCE_ID  --alarm-description \"Recover Instance\"  --namespace AWS/EC2 --dimensions Name=InstanceId,Value=$INSTANCE_ID --statistic Average  --metric-name StatusCheckFailed_System --comparison-operator GreaterThanThreshold --threshold 0 --period 60 --evaluation-periods 2 --alarm-actions arn:aws:automate:ap-northeast-1:ec2:recover --region ap-northeast-1\n\ndone\n\n\nRole \u300ccloudwatch:PutMetricAlarm\u300d\u306e\u6a29\u9650\u3092\u5b9f\u884c\u3067\u304d\u308b\u74b0\u5883\u3067\u306e\u307f\u4f7f\u3048\u307e\u3059\u3002\n\u203bIAM Role\u306a\u308a\u306b\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n3/13 EC2 Auto Recovery\u304c\u5168\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u5bfe\u5fdc\n\nEC2 Auto Recovery\u6628\u5e74\u672b\u306eEC2 \u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u3068\u304b\u3001\u5197\u9577\u5316\u306b\u5bfe\u5fdc\u3067\u304d\u3066\u3044\u306a\u3044\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u306e\u30b5\u30fc\u30d0\u30fc\u306e\u53ef\u7528\u6027\u3092\u6301\u305f\u305b\u308b\u3053\u3068\u306b\u4f7f\u3048\u308b\u3068\u601d\u308f\u308c\u307e\u3059\u3002\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u591a\u3044\u3068CreateAlarm\u3082Management Console\u304b\u3089\u3067\u306f\u9762\u5012\n\u305d\u3053\u3067\u3001\u540c\u4e00\u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u5bfe\u3057\u3066\u3001Revery Instance\u3092\u767b\u9332\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\n\n```\n#! /bin/bash -ex\n\nfor INSTANCE_ID in `aws ec2 describe-instances --region ap-northeast-1 | jq '.Reservations[].Instances[].InstanceId ' | cut -d '\"' -f 2`\ndo\n\naws cloudwatch put-metric-alarm --alarm-name \"recover-instance \".$INSTANCE_ID  --alarm-description \"Recover Instance\"  --namespace AWS/EC2 --dimensions Name=InstanceId,Value=$INSTANCE_ID --statistic Average  --metric-name StatusCheckFailed_System --comparison-operator GreaterThanThreshold --threshold 0 --period 60 --evaluation-periods 2 --alarm-actions arn:aws:automate:ap-northeast-1:ec2:recover --region ap-northeast-1\n\ndone\n\n```\n\nRole \u300ccloudwatch:PutMetricAlarm\u300d\u306e\u6a29\u9650\u3092\u5b9f\u884c\u3067\u304d\u308b\u74b0\u5883\u3067\u306e\u307f\u4f7f\u3048\u307e\u3059\u3002\n\u203bIAM Role\u306a\u308a\u306b\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n", "tags": ["awscli", "CloudWatch", "AWS"]}