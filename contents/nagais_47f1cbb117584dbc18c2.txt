{"context": "S3\u306b\u7f6e\u3044\u3066\u3042\u308bcsv\u30c7\u30fc\u30bf\u3092BigQuery\u306b\u3064\u3063\u3053\u3093\u3067\u53ef\u8996\u5316\u3057\u305f\u3044\u3068\u3044\u3046\u8981\u4ef6\u304c\u3042\u3063\u305f\u306e\u3067\u3001Embulk\u3092\u4f7f\u3063\u3066\u3084\u3063\u3066\u307f\u305f\u6642\u306e\u5099\u5fd8\u9332\u3002\nEmbulk\u89e6\u308a\u305f\u3044\u3068\u601d\u3063\u3066\u305f\u3051\u3069\u4e2d\u3005\u6a5f\u4f1a\u306a\u304f\u3066\u3001\u521d\u3081\u3066\u3060\u3063\u305f\u3051\u3069\u3068\u3066\u3082\u7c21\u5358\u306b\u3084\u308a\u305f\u3044\u4e8b\u304c\u51fa\u6765\u307e\u3057\u305f\u3002\u7d20\u6674\u3089\u3057\u3044\u30d7\u30ed\u30c0\u30af\u30c8\u3060\u306a\u30fc\u3068\u5b9f\u611f\uff01\uff01\n\u6700\u8fd1\u306f\u3001\u793e\u5185\u3067redash\u71b1\u3082\u9ad8\u307e\u3063\u3066\u308b\u3057\u4f75\u305b\u3066\u3044\u3044\u6a5f\u4f1a\u3060\u3063\u305f\u3002\n\n\u4eca\u56de\u306e\u30c6\u30fc\u30de\nAWS\u306e\u8acb\u6c42\u60c5\u5831\u30ec\u30dd\u30fc\u30c8\u3067\u51fa\u305b\u308b\u300cxxxxxx-aws-billing-detailed-line-items-with-resources-and-tags-2016-08.csv.zip\u300d\u306e\u8a73\u7d30\u30c7\u30fc\u30bf\u3092\u5bfe\u8c61\u306b\u3057\u3066\u3044\u307e\u3059\u3002\u203bbigquery\u306e\u30b9\u30ad\u30fc\u30dejson\u306e\u30ab\u30e9\u30e0\u540d\u306f\u3001\u3053\u306ecsv\u30d5\u30a1\u30a4\u30eb\u306e\u30ab\u30e9\u30e0\u540d\u3092\u305d\u306e\u307e\u307e\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\u5177\u4f53\u7684\u306b\u306f\u3001s3\u306e\u30c7\u30fc\u30bf\u8ee2\u9001\u91cf\u306e\u307f\u3092\u30c8\u30e9\u30c3\u30ad\u30f3\u30b0\u3057\u3066\u307f\u305f\u3068\u3044\u3046\u3068\u3053\u308d\u3067\u3059\u3002\n\n\u6e96\u5099\n\nEmbulk\u672c\u4f53\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb (\u624b\u5143\u306emac)\n\n$  curl --create-dirs -o ~/bin/embulk -L http://dl.embulk.org/embulk-latest.jar\n\n$ chmod +x ~/bin/embulk\n\n$ cat << 'EOF' >> ~/.bash_profile\nexport PATH=$PATH:$HOME/bin\nEOF\n\n$ source ~/.bash_profile\n\n$ embulk\nEmbulk v0.8.13\nUsage ....\n....\n\n\n\u5fc5\u8981\u306a\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n#in_s3\n$ embulk gem install embulk-input-s3\n\n#out_bigquery\n$ embulk gem install embulk-output-bigquery\n\n#decorder (aws\u306e\u8acb\u6c42\u60c5\u5831\u304czip\u5f62\u5f0f\u3067s3\u306b\u7f6e\u304b\u308c\u308b\u306e\u3067\u305d\u308c\u3092\u89e3\u51cd\u3059\u308b\u70ba)\n$ embulk gem install embulk-decoder-commons-compress\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb(embulk,bigquery\u30b9\u30ad\u30fc\u30de)\nEmbulk\u306f\u3001\u57fa\u672c\u7684\u306b\u4e0b\u8a18\u306e\u3088\u3046\u306ayaml\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304f\u3060\u3051\u3067OK\u3002\u5927\u4f53\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u63c3\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u3084\u308a\u305f\u3044\u3053\u3068\u306f\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5165\u308c\u308b\u3060\u3051\u3067\u8a2d\u5b9a\u30b4\u30cb\u30e7\u30b4\u30cb\u30e7\u66f8\u3051\u3070\u3059\u3050\u306b\u30c7\u30fc\u30bf\u6295\u5165\u304c\u51fa\u6765\u308b\uff01\n\nconfig.yaml\nin:\n  type: s3\n  bucket: [\u30d0\u30b1\u30c3\u30c8\u540d]\n  endpoint: s3.amazonaws.com\n  access_key_id: [\u30a2\u30af\u30bb\u30b9\u30ad\u30fc] \n  secret_access_key: [\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc]\n  path_prefix: xxxxxx-aws-billing-detailed-line-items-with-resources-and-tags-\n  decoders:\n    - type: commons-compress\n  parser:\n    charset: UTF-8\n    newline: CRLF\n    type: csv\n    delimiter: ','\n    quote: '\"'\n    escape: '\"'\n    columns:\n    - {name: InvoiceID, type: string}\n    - {name: PayerAccountId, type: string}\n    - {name: LinkedAccountId, type: string}\n    - {name: RecordType, type: string}\n    - {name: RecordId, type: string}\n    - {name: ProductName, type: string}\n    - {name: RateId, type: string}\n    - {name: SubscriptionId, type: string}\n    - {name: PricingPlanId, type: string}\n    - {name: UsageType, type: string}\n    - {name: Operation, type: string}\n    - {name: AvailabilityZone, type: string}\n    - {name: ReservedInstance, type: string}\n    - {name: ItemDescription, type: string}\n    - {name: UsageStartDate, type: timestamp, format: '%Y-%m-%d %H:%M:%S'}\n    - {name: UsageEndDate, type: timestamp, format: '%Y-%m-%d %H:%M:%S'}\n    - {name: UsageQuantity, type: double}\n    - {name: BlendedRate, type: double}\n    - {name: BlendedCost, type: double}\n    - {name: UnBlendedRate, type: double}\n    - {name: UnBlendedCost, type: double}\n    - {name: ResourceId, type: string}\n\nout:\n  type: bigquery\n  mode: append\n  auth_method: private_key\n  service_account_email: [\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8]\n  p12_keyfile: [p12\u5f62\u5f0f\u9375\u306e\u7f6e\u304d\u5834]\n  project: [\u30d7\u30ed\u30b8\u30a7\u30af\u30c8ID]\n  dataset: [dataset\u540d]\n  table: [\u30c6\u30fc\u30d6\u30eb\u540d]\n  auto_create_table: true\n  schema_file: [BigQuery\u306e\u30b9\u30ad\u30fc\u30de\u30d5\u30a1\u30a4\u30eb(json)\u7f6e\u304d\u5834]\n\n\n\nbigquery\u306e\u30c6\u30fc\u30d6\u30eb\u30b9\u30ad\u30fc\u30de\u306f\u4e0b\u8a18\u306e\u611f\u3058\u3067\u3002Embulk parser\u3067\u5404\u30ab\u30e9\u30e0\u306b\u3064\u3051\u305f\u578b\u3068\u5408\u308f\u305b\u308b\u3060\u3051\u3002\n\nbq-billing-aws.json\n[\n  {\n    \"name\": \"InvoiceID\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"PayerAccountId\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"LinkedAccountId\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"RecordType\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"RecordId\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"ProductName\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"RateId\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"SubscriptionId\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"PricingPlanId\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"UsageType\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"Operation\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"AvailabilityZone\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"ReservedInstance\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"ItemDescription\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"UsageStartDate\",\n    \"type\": \"timestamp\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"UsageEndDate\",\n    \"type\": \"timestamp\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"UsageQuantity\",\n    \"type\": \"float\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"BlendedRate\",\n    \"type\": \"float\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"BlendedCost\",\n    \"type\": \"float\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"UnBlendedRate\",\n    \"type\": \"float\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"UnBlendedCost\",\n    \"type\": \"float\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"ResourceId\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  }\n]\n\n\n\n\u52d5\u304b\u3059\n\u4e00\u5fdc\u65b0\u898f\u306econfig\u306fdry-run\u7684\u306apreview\u3092\u4f7f\u3063\u3066config\u306e\u30c6\u30b9\u30c8\u3092\u5b9f\u65bd\n#config.yaml\u306etypo\n$ embulk preview config.yaml\n2016-08-25 16:07:33.486 +0900: Embulk v0.8.13\nwhile scanning a simple key\n in 'string', line 48, column 3:\n      schema_file:~/opt/gits/shoichiro ...\n      ^\ncould not found expected ':'\n in 'string', line 49, column 1:\n\n\n#\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u5fc5\u9808\u9805\u76ee\u30bb\u30c3\u30c8\u3055\u308c\u3066\u306a\u3044\u3068\u304b\n$ embulk preview config.yaml\nError: com.fasterxml.jackson.databind.JsonMappingException: Field 'path_prefix' is required but not set\n\ndry-run\u6210\u529f(\u30a8\u30e9\u30fc\u51fa\u306a\u3044)\u3057\u305f\u3089\u3001\u5b9f\u884c\n$ embulk run config.yaml\n\n\u7121\u4e8b\u30a4\u30f3\u30dd\u30fc\u30c8\u304c\u51fa\u6765\u3066\u3044\u308b\u3002\n\n\nRe:dash\nRe:dash\u306e\u57fa\u76e4\u304c\u65e2\u306b\u3042\u3063\u305f\u306e\u3067\u3053\u308c\u3092\u4f7f\u3063\u3066\u7c21\u5358\u306a\u30b0\u30e9\u30d5\u3092\u751f\u6210\n\n\u65e5\u6bce\u306eS3\u306e\u8ee2\u9001\u91cf\u3092\u96c6\u8a08\u3059\u308b\u30af\u30a8\u30ea\n\nAWS\u306e\u8acb\u6c42\u66f8\u3092\u898b\u306a\u304c\u3089\u3001\u30c8\u30e9\u30c3\u30ad\u30f3\u30b0\u3057\u305f\u3044\u9805\u76ee\u306b\u305f\u3069\u308a\u3064\u304f\u306e\u306b\u5c11\u3057\u6642\u9593\u304c\u304b\u304b\u3063\u305f\u3002(\u8ab2\u91d1\u4f53\u7cfb\u306e\u9805\u76ee\u304c\u591a\u3059\u304e\u3066\u30c4\u30e9\u30a4\u3002\u3002\u3002)\nselect\n  DATE(UsageStartDate) as day,\n  sum(UsageQuantity) as Traffic_GB,\n  sum(BlendedCost) as Cost_USD\nfrom\n  [\u30d7\u30ed\u30b8\u30a7\u30af\u30c8ID:InfraTeam.aws_main_billing] \nwhere \n  UsageType = 'APN1-DataTransfer-Out-Bytes'\n  and ProductName = 'Amazon Simple Storage Service'\ngroup by day\norder by day\n\n\n\u6642\u7cfb\u5217\u306echart\u3092\u4f5c\u308b\n\n\u30c7\u30fc\u30bf\u8ee2\u9001\u91cf\u3068\u30b3\u30b9\u30c8\u304c\u4e00\u76ee\u77ad\u7136\u306b!\n\n\n\u203b\u30cf\u30de\u3063\u305f\u3053\u3068\n\nbigquery\u306f\u30c6\u30fc\u30d6\u30eb\u540d\u306b\u3001-(\u30cf\u30a4\u30d5\u30f3)\u306f\u3060\u3081 \u203b\u3088\u304f\u5fd8\u308c\u308b\u304c\u30ab\u30e9\u30e0\u540d\u306b\u3082\u30cf\u30a4\u30d5\u30f3\u306f\u4f7f\u3048\u306a\u3044\n\u6700\u521d\u3001zip\u5f62\u5f0f\u3068\u3044\u3046\u306e\u3092\u5fd8\u308c\u3066\u3066\u3001embulk\u306ecsv\u30d1\u30fc\u30b5\u304c\u3072\u305f\u3059\u3089\u30a8\u30e9\u30fc\u3092\u5c65\u304d\u7d9a\u3051\u305f\u3002\u3002\n\n\n\u6240\u611f\nEmbulk\u306f\u3001fluentd\u3068\u540c\u3058\u30d7\u30e9\u30ac\u30d6\u30eb\u306a\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3067\u3068\u3066\u3082\u4f7f\u3044\u3084\u3059\u304b\u3063\u305f\u3002Fluentd\u306f\u30ac\u30b7\u30ac\u30b7\u4f7f\u3063\u3066\u3044\u305f\u304b\u3089\u304b\u3001\u5b66\u7fd2\u30b3\u30b9\u30c8\u307b\u307c0\u3067\u3084\u308a\u305f\u3044\u4e8b\u51fa\u6765\u305f\uff01\n\u3046\u3061\u306e\u5834\u5408\u306f\u3001Redash\u74b0\u5883\u304c\u65e2\u306b\u3042\u308b\u306e\u3067\u3053\u308c\u3092\u4f7f\u3063\u3066\u53ef\u8996\u5316\u3057\u305f\u304c\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u3067\u53ef\u8996\u5316\u3059\u308b\u306e\u3082\u3042\u308a\u3060\u3068\u601d\u3046\u3002\n\u6700\u8fd1\u306f\u3001Elasticsearch\u3088\u304f\u4f7f\u3063\u3066\u305f\u304b\u3089\u305d\u308c\u3068\u306e\u6bd4\u8f03\u3059\u308b\u3068\u3001JSON\u3067\u30c7\u30fc\u30bf\u5f15\u304f\u306e\u306b\u6bd4\u3079\u3066\u3084\u306f\u308a\u3001sql\u3067\u30c7\u30fc\u30bf\u51fa\u305b\u308b\u306e\u306f\u697d\u3067\u3088\u3044\u3068\u5b9f\u611f\u3002\n\n\u53c2\u7167\nhttp://qiita.com/y-ken/items/31890f4f188321cb88a7\nhttp://www.embulk.org/docs/built-in.html\n\nS3\u306b\u7f6e\u3044\u3066\u3042\u308bcsv\u30c7\u30fc\u30bf\u3092BigQuery\u306b\u3064\u3063\u3053\u3093\u3067\u53ef\u8996\u5316\u3057\u305f\u3044\u3068\u3044\u3046\u8981\u4ef6\u304c\u3042\u3063\u305f\u306e\u3067\u3001Embulk\u3092\u4f7f\u3063\u3066\u3084\u3063\u3066\u307f\u305f\u6642\u306e\u5099\u5fd8\u9332\u3002\nEmbulk\u89e6\u308a\u305f\u3044\u3068\u601d\u3063\u3066\u305f\u3051\u3069\u4e2d\u3005\u6a5f\u4f1a\u306a\u304f\u3066\u3001\u521d\u3081\u3066\u3060\u3063\u305f\u3051\u3069\u3068\u3066\u3082\u7c21\u5358\u306b\u3084\u308a\u305f\u3044\u4e8b\u304c\u51fa\u6765\u307e\u3057\u305f\u3002\u7d20\u6674\u3089\u3057\u3044\u30d7\u30ed\u30c0\u30af\u30c8\u3060\u306a\u30fc\u3068\u5b9f\u611f\uff01\uff01\n\u6700\u8fd1\u306f\u3001\u793e\u5185\u3067redash\u71b1\u3082\u9ad8\u307e\u3063\u3066\u308b\u3057\u4f75\u305b\u3066\u3044\u3044\u6a5f\u4f1a\u3060\u3063\u305f\u3002\n\n##\u4eca\u56de\u306e\u30c6\u30fc\u30de\n\nAWS\u306e\u8acb\u6c42\u60c5\u5831\u30ec\u30dd\u30fc\u30c8\u3067\u51fa\u305b\u308b\u300cxxxxxx-aws-billing-detailed-line-items-with-resources-and-tags-2016-08.csv.zip\u300d\u306e\u8a73\u7d30\u30c7\u30fc\u30bf\u3092\u5bfe\u8c61\u306b\u3057\u3066\u3044\u307e\u3059\u3002\u203bbigquery\u306e\u30b9\u30ad\u30fc\u30dejson\u306e\u30ab\u30e9\u30e0\u540d\u306f\u3001\u3053\u306ecsv\u30d5\u30a1\u30a4\u30eb\u306e\u30ab\u30e9\u30e0\u540d\u3092\u305d\u306e\u307e\u307e\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\u5177\u4f53\u7684\u306b\u306f\u3001s3\u306e\u30c7\u30fc\u30bf\u8ee2\u9001\u91cf\u306e\u307f\u3092\u30c8\u30e9\u30c3\u30ad\u30f3\u30b0\u3057\u3066\u307f\u305f\u3068\u3044\u3046\u3068\u3053\u308d\u3067\u3059\u3002\n\n\n##\u6e96\u5099\n\n- Embulk\u672c\u4f53\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb (\u624b\u5143\u306emac)\n\n\n```\n$  curl --create-dirs -o ~/bin/embulk -L http://dl.embulk.org/embulk-latest.jar\n\n$ chmod +x ~/bin/embulk\n\n$ cat << 'EOF' >> ~/.bash_profile\nexport PATH=$PATH:$HOME/bin\nEOF\n\n$ source ~/.bash_profile\n\n$ embulk\nEmbulk v0.8.13\nUsage ....\n....\n```\n\n- \u5fc5\u8981\u306a\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n#in_s3\n$ embulk gem install embulk-input-s3\n\n#out_bigquery\n$ embulk gem install embulk-output-bigquery\n\n#decorder (aws\u306e\u8acb\u6c42\u60c5\u5831\u304czip\u5f62\u5f0f\u3067s3\u306b\u7f6e\u304b\u308c\u308b\u306e\u3067\u305d\u308c\u3092\u89e3\u51cd\u3059\u308b\u70ba)\n$ embulk gem install embulk-decoder-commons-compress\n```\n\n##\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb(embulk,bigquery\u30b9\u30ad\u30fc\u30de)\n\nEmbulk\u306f\u3001\u57fa\u672c\u7684\u306b\u4e0b\u8a18\u306e\u3088\u3046\u306ayaml\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304f\u3060\u3051\u3067OK\u3002\u5927\u4f53\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u63c3\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u3084\u308a\u305f\u3044\u3053\u3068\u306f\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5165\u308c\u308b\u3060\u3051\u3067\u8a2d\u5b9a\u30b4\u30cb\u30e7\u30b4\u30cb\u30e7\u66f8\u3051\u3070\u3059\u3050\u306b\u30c7\u30fc\u30bf\u6295\u5165\u304c\u51fa\u6765\u308b\uff01\n\n```config.yaml\nin:\n  type: s3\n  bucket: [\u30d0\u30b1\u30c3\u30c8\u540d]\n  endpoint: s3.amazonaws.com\n  access_key_id: [\u30a2\u30af\u30bb\u30b9\u30ad\u30fc] \n  secret_access_key: [\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc]\n  path_prefix: xxxxxx-aws-billing-detailed-line-items-with-resources-and-tags-\n  decoders:\n    - type: commons-compress\n  parser:\n    charset: UTF-8\n    newline: CRLF\n    type: csv\n    delimiter: ','\n    quote: '\"'\n    escape: '\"'\n    columns:\n    - {name: InvoiceID, type: string}\n    - {name: PayerAccountId, type: string}\n    - {name: LinkedAccountId, type: string}\n    - {name: RecordType, type: string}\n    - {name: RecordId, type: string}\n    - {name: ProductName, type: string}\n    - {name: RateId, type: string}\n    - {name: SubscriptionId, type: string}\n    - {name: PricingPlanId, type: string}\n    - {name: UsageType, type: string}\n    - {name: Operation, type: string}\n    - {name: AvailabilityZone, type: string}\n    - {name: ReservedInstance, type: string}\n    - {name: ItemDescription, type: string}\n    - {name: UsageStartDate, type: timestamp, format: '%Y-%m-%d %H:%M:%S'}\n    - {name: UsageEndDate, type: timestamp, format: '%Y-%m-%d %H:%M:%S'}\n    - {name: UsageQuantity, type: double}\n    - {name: BlendedRate, type: double}\n    - {name: BlendedCost, type: double}\n    - {name: UnBlendedRate, type: double}\n    - {name: UnBlendedCost, type: double}\n    - {name: ResourceId, type: string}\n\nout:\n  type: bigquery\n  mode: append\n  auth_method: private_key\n  service_account_email: [\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8]\n  p12_keyfile: [p12\u5f62\u5f0f\u9375\u306e\u7f6e\u304d\u5834]\n  project: [\u30d7\u30ed\u30b8\u30a7\u30af\u30c8ID]\n  dataset: [dataset\u540d]\n  table: [\u30c6\u30fc\u30d6\u30eb\u540d]\n  auto_create_table: true\n  schema_file: [BigQuery\u306e\u30b9\u30ad\u30fc\u30de\u30d5\u30a1\u30a4\u30eb(json)\u7f6e\u304d\u5834]\n```\n\n###bigquery\u306e\u30c6\u30fc\u30d6\u30eb\u30b9\u30ad\u30fc\u30de\u306f\u4e0b\u8a18\u306e\u611f\u3058\u3067\u3002Embulk parser\u3067\u5404\u30ab\u30e9\u30e0\u306b\u3064\u3051\u305f\u578b\u3068\u5408\u308f\u305b\u308b\u3060\u3051\u3002\n\n```bq-billing-aws.json\n[\n  {\n    \"name\": \"InvoiceID\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"PayerAccountId\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"LinkedAccountId\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"RecordType\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"RecordId\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"ProductName\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"RateId\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"SubscriptionId\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"PricingPlanId\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"UsageType\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"Operation\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"AvailabilityZone\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"ReservedInstance\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"ItemDescription\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"UsageStartDate\",\n    \"type\": \"timestamp\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"UsageEndDate\",\n    \"type\": \"timestamp\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"UsageQuantity\",\n    \"type\": \"float\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"BlendedRate\",\n    \"type\": \"float\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"BlendedCost\",\n    \"type\": \"float\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"UnBlendedRate\",\n    \"type\": \"float\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"UnBlendedCost\",\n    \"type\": \"float\",\n    \"mode\": \"nullable\"\n  },\n  {\n    \"name\": \"ResourceId\",\n    \"type\": \"string\",\n    \"mode\": \"nullable\"\n  }\n]\n```\n\n##\u52d5\u304b\u3059\n\n\u4e00\u5fdc\u65b0\u898f\u306econfig\u306fdry-run\u7684\u306apreview\u3092\u4f7f\u3063\u3066config\u306e\u30c6\u30b9\u30c8\u3092\u5b9f\u65bd\n\n```\n#config.yaml\u306etypo\n$ embulk preview config.yaml\n2016-08-25 16:07:33.486 +0900: Embulk v0.8.13\nwhile scanning a simple key\n in 'string', line 48, column 3:\n      schema_file:~/opt/gits/shoichiro ...\n      ^\ncould not found expected ':'\n in 'string', line 49, column 1:\n\n\n#\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u5fc5\u9808\u9805\u76ee\u30bb\u30c3\u30c8\u3055\u308c\u3066\u306a\u3044\u3068\u304b\n$ embulk preview config.yaml\nError: com.fasterxml.jackson.databind.JsonMappingException: Field 'path_prefix' is required but not set\n```\n\ndry-run\u6210\u529f(\u30a8\u30e9\u30fc\u51fa\u306a\u3044)\u3057\u305f\u3089\u3001\u5b9f\u884c\n\n```\n$ embulk run config.yaml\n```\n\n\u7121\u4e8b\u30a4\u30f3\u30dd\u30fc\u30c8\u304c\u51fa\u6765\u3066\u3044\u308b\u3002\n![Google_BigQuery.jpg](https://qiita-image-store.s3.amazonaws.com/0/40850/e69e1724-32c0-641f-125c-123c17df25c3.jpeg \"Google_BigQuery.jpg\")\n\n##Re:dash\n\nRe:dash\u306e\u57fa\u76e4\u304c\u65e2\u306b\u3042\u3063\u305f\u306e\u3067\u3053\u308c\u3092\u4f7f\u3063\u3066\u7c21\u5358\u306a\u30b0\u30e9\u30d5\u3092\u751f\u6210\n\n- \u65e5\u6bce\u306eS3\u306e\u8ee2\u9001\u91cf\u3092\u96c6\u8a08\u3059\u308b\u30af\u30a8\u30ea\n\nAWS\u306e\u8acb\u6c42\u66f8\u3092\u898b\u306a\u304c\u3089\u3001\u30c8\u30e9\u30c3\u30ad\u30f3\u30b0\u3057\u305f\u3044\u9805\u76ee\u306b\u305f\u3069\u308a\u3064\u304f\u306e\u306b\u5c11\u3057\u6642\u9593\u304c\u304b\u304b\u3063\u305f\u3002(\u8ab2\u91d1\u4f53\u7cfb\u306e\u9805\u76ee\u304c\u591a\u3059\u304e\u3066\u30c4\u30e9\u30a4\u3002\u3002\u3002)\n\n```\nselect\n  DATE(UsageStartDate) as day,\n  sum(UsageQuantity) as Traffic_GB,\n  sum(BlendedCost) as Cost_USD\nfrom\n  [\u30d7\u30ed\u30b8\u30a7\u30af\u30c8ID:InfraTeam.aws_main_billing] \nwhere \n  UsageType = 'APN1-DataTransfer-Out-Bytes'\n  and ProductName = 'Amazon Simple Storage Service'\ngroup by day\norder by day\n```\n\n- \u6642\u7cfb\u5217\u306echart\u3092\u4f5c\u308b\n\n\u30c7\u30fc\u30bf\u8ee2\u9001\u91cf\u3068\u30b3\u30b9\u30c8\u304c\u4e00\u76ee\u77ad\u7136\u306b!\n\n![aws-s3\u8ee2\u9001\u91cf\u63a8\u79fb_1day___re_dash.jpg](https://qiita-image-store.s3.amazonaws.com/0/40850/e4cc2ab8-db55-f8dd-9fcb-0eab356ed380.jpeg \"aws-s3\u8ee2\u9001\u91cf\u63a8\u79fb_1day___re_dash.jpg\")\n\n\n##\u203b\u30cf\u30de\u3063\u305f\u3053\u3068\n\n- bigquery\u306f\u30c6\u30fc\u30d6\u30eb\u540d\u306b\u3001-(\u30cf\u30a4\u30d5\u30f3)\u306f\u3060\u3081 \u203b\u3088\u304f\u5fd8\u308c\u308b\u304c\u30ab\u30e9\u30e0\u540d\u306b\u3082\u30cf\u30a4\u30d5\u30f3\u306f\u4f7f\u3048\u306a\u3044\n- \u6700\u521d\u3001zip\u5f62\u5f0f\u3068\u3044\u3046\u306e\u3092\u5fd8\u308c\u3066\u3066\u3001embulk\u306ecsv\u30d1\u30fc\u30b5\u304c\u3072\u305f\u3059\u3089\u30a8\u30e9\u30fc\u3092\u5c65\u304d\u7d9a\u3051\u305f\u3002\u3002\n\n##\u6240\u611f\n\nEmbulk\u306f\u3001fluentd\u3068\u540c\u3058\u30d7\u30e9\u30ac\u30d6\u30eb\u306a\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3067\u3068\u3066\u3082\u4f7f\u3044\u3084\u3059\u304b\u3063\u305f\u3002Fluentd\u306f\u30ac\u30b7\u30ac\u30b7\u4f7f\u3063\u3066\u3044\u305f\u304b\u3089\u304b\u3001\u5b66\u7fd2\u30b3\u30b9\u30c8\u307b\u307c0\u3067\u3084\u308a\u305f\u3044\u4e8b\u51fa\u6765\u305f\uff01\n\u3046\u3061\u306e\u5834\u5408\u306f\u3001Redash\u74b0\u5883\u304c\u65e2\u306b\u3042\u308b\u306e\u3067\u3053\u308c\u3092\u4f7f\u3063\u3066\u53ef\u8996\u5316\u3057\u305f\u304c\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u3067\u53ef\u8996\u5316\u3059\u308b\u306e\u3082\u3042\u308a\u3060\u3068\u601d\u3046\u3002\n\u6700\u8fd1\u306f\u3001Elasticsearch\u3088\u304f\u4f7f\u3063\u3066\u305f\u304b\u3089\u305d\u308c\u3068\u306e\u6bd4\u8f03\u3059\u308b\u3068\u3001JSON\u3067\u30c7\u30fc\u30bf\u5f15\u304f\u306e\u306b\u6bd4\u3079\u3066\u3084\u306f\u308a\u3001sql\u3067\u30c7\u30fc\u30bf\u51fa\u305b\u308b\u306e\u306f\u697d\u3067\u3088\u3044\u3068\u5b9f\u611f\u3002\n\n\n##\u53c2\u7167\n\nhttp://qiita.com/y-ken/items/31890f4f188321cb88a7\nhttp://www.embulk.org/docs/built-in.html\n", "tags": ["Embulk", "bigquery"]}