{"context": "\u3053\u306e\u8a18\u4e8b\u306f\u30a8\u30e0\u30c6\u30a3\u30fc\u30a2\u30a4 Advent Calender 2016\u306e22\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\nAdvent Calender\u3082\u6b8b\u3059\u3068\u3053\u308d4\u65e5\u3068\u306a\u3063\u305f\u672c\u65e5\u306f\u3001\u4eca\u6d41\u884c\u308a\u306eAzure Resource Manager\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8(\u4ee5\u964dArm\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8)\u306b\u3064\u3044\u3066\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\n\u3053\u308c\u304b\u3089Arm\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u52c9\u5f37\u3057\u305f\u3044\u3001\u3068\u308a\u3042\u3048\u305a\u52d5\u304f\u74b0\u5883\u3092\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3067\u4f5c\u308a\u305f\u3044\n\u305d\u3093\u306a\u65b9\u306b\u304a\u3059\u3059\u3081\u3067\u3059\u3002\n\n\u3084\u308a\u305f\u3044\u3053\u3068\n\nArm\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3067Linux Virtual Machine\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u307e\u3059\u3002\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30c7\u30d7\u30ed\u30a4\u6642\u306bjava\u30fbTomcat\u3092\u81ea\u52d5\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u4eca\u56de\u4f5c\u6210\u3059\u308b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u540c\u4e00\u74b0\u5883\u306eVM\u3092\u4e00\u5ea6\u306b\u8907\u6570\u53f0\u30c7\u30d7\u30ed\u30a4\u53ef\u80fd\u3067\u3059\u3002\n\n\nArm\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306fJson\u3067\u66f8\u304b\u308c\u3066\u3044\u307e\u3059\u3002\n\u304a\u597d\u304d\u306a\u30a8\u30c7\u30a3\u30bf\u3067\u7de8\u96c6\u3067\u304d\u307e\u3059\u304c\u3001VisualStudio\u3092\u4f7f\u3046\u3068\u30a4\u30f3\u30c6\u30ea\u30bb\u30f3\u30b9\u304c\u4f7f\u3048\u305f\u308a\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u81ea\u7531\u306b\u751f\u6210\u3057\u3066\u304f\u308c\u305f\u308a\u3068\u4f55\u304b\u3068\u4fbf\u5229\u3067\u3059\u3002  \n\n\u5b9f\u884c\u74b0\u5883\n\nWindows10\nVisualStudio 2015 Community\n\nAzure SDK 2.9\n\nPowerShell 5.0\n\u203bVisualStudio\u3067\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f5c\u6210\u3059\u308b\u306b\u306f\u3001AzureSDK2.6\u4ee5\u4e0a\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n\n\nVisualStudio\u3067\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f5c\u6210\u3059\u308b\n\u3067\u306f\u65e9\u901f\u3001Visual Studio\u3067\u65b0\u898f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\u3002\n\u300c\u65b0\u898f\u4f5c\u6210\u300d\uff1e\u300c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u300d\u304b\u3089Azure\u30ea\u30bd\u30fc\u30b9\u30de\u30cd\u30fc\u30b8\u30e3\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n\u69d8\u3005\u306a\u30ea\u30bd\u30fc\u30b9\u304c\u9078\u629e\u3067\u304d\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u300cLinux Virtual Machine Scale Set\u300d\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\u4eee\u60f3\u30de\u30b7\u30f3\u30b9\u30b1\u30fc\u30eb\u30bb\u30c3\u30c8\u306e\u6982\u8981\n\n\u4f5c\u6210\u3057\u305f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u69cb\u6210\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u30c7\u30d7\u30ed\u30a4\u7528\u306ePowershell\u30b9\u30af\u30ea\u30d7\u30c8\u3082\u81ea\u52d5\u3067\u751f\u6210\u3057\u3066\u304f\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u7c21\u5358\u306b\u5404\u30d5\u30a1\u30a4\u30eb\u306e\u8aac\u660e\u3092\u3057\u307e\u3059\u3002\n* Deploy-AzureResourceGroup.ps1\n\u30c7\u30d7\u30ed\u30a4\u7528\u306ePowerShell\u30b9\u30af\u30ea\u30d7\u30c8\u3002\nPowerShell 5.0 \u3067\u52d5\u4f5c\u3057\u307e\u3059\u3002\nPowersshell 5.0 Windows10\u304b\u3089\u306f\u6a19\u6e96\u3067\u642d\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001Windows 7\u30fb8\u306e\u5834\u5408\u306f\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u304c\u5fc5\u8981\u3067\u3059\u3002  \n\n\nLinuxVirtualMachineScaleSet.json\n\u3053\u3061\u3089\u304c\u6240\u8b02Arm\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3067\u3059\u3002\u30ea\u30bd\u30fc\u30b9\u306e\u60c5\u5831\u3092\u8a18\u8f09\u3057\u3066\u3044\u307e\u3059\u3002\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u69cb\u6210\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002  \n\nparameters\n\u30c7\u30d7\u30ed\u30a4\u6642\u306b\u30e6\u30fc\u30b6\u304c\u6307\u5b9a\u3059\u308b\u5024\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002\n\nvariables\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5185\u3067\u4f7f\u7528\u3059\u308b\u5909\u6570\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002\n\u4e71\u6570\u3092\u81ea\u52d5\u751f\u6210\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\nresourrces\nVirtual Machine\u3084NIC\u7b49\u306e\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n\nLinuxVirtualMachineScaleSet.parameters.json\nPowershell\u304b\u3089\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u6642\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\nArm\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306eParameters\u3067\u5b9a\u7fa9\u3057\u305f\u9805\u76ee\u306e\u5024\u3092\u8a18\u8ff0\u3057\u3066\u304a\u304f\u3053\u3068\u3067\u3001\u624b\u5165\u529b\u306e\u624b\u9593\u3092\u7701\u304d\u307e\u3059\u3002\n\u3000\u3000\n\n\u81ea\u52d5\u751f\u6210\u3055\u308c\u305f\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u300cLinuxVirtualMachineScaleSet.json\u300d\u306f\u305d\u306e\u307e\u307e\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u4eca\u56de\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067Ubuntu\u306b\u306a\u3063\u3066\u3044\u308bOS\u3092CentOS\u306b\u5909\u66f4\u3057\u3066\u304b\u3089\u30c7\u30d7\u30ed\u30a4\u3057\u307e\u3059\u3002\n\nOS\u3092CentOS\u306b\u5909\u66f4\u3059\u308b\u3002\nCentOS 7.2 \u306b\u5909\u66f4\u3057\u307e\u3059\u3002  \nParameters\u306eubuntuOsVersion\u3092\u4ee5\u4e0b\u306b\u5dee\u3057\u66ff\u3048\u307e\u3059\u3002\n\nLinuxVirtualMachineScaleSet.json\n\"centOsVersion\": {\n  \"type\": \"string\",\n  \"defaultValue\": \"7.2\",\n  \"metadata\": {\n    \"description\": \"The Ubuntu version for the VM. This will pick a fully patched image of this given Ubuntu version. Allowed values are: 15.10, 14.04.4-LTS.\"\n  }\n}\n\n\nvariables\u306eosType\u3092\u4ee5\u4e0b\u306b\u5dee\u3057\u66ff\u3048\u307e\u3059\u3002  \n\nLinuxVirtualMachineScaleSet.json\n\"osType\": {\n  \"publisher\": \"OpenLogic\",\n  \"offer\": \"CentOS\",\n  \"sku\": \"[parameters('centOSVersion')]\",\n  \"version\": \"latest\"\n}\n\n\n\u5909\u66f4\u70b9\u306f\u4ee5\u4e0a\u3067\u3059\u3002  \n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u7528\u610f\u3059\u308b\n\u81ea\u52d5\u751f\u6210\u3055\u308c\u305fLinuxVirtualMachineScaleSet.parameters.json\u306eValue\u306b\u5024\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\nadminUserPassword\u306fSecureString\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\n\u30d1\u30e9\u30e1\u30fc\u30bf\u30d5\u30a1\u30a4\u30eb\u306b\u306f\u8a18\u8ff0\u305b\u305a\u3001Powershell\u5b9f\u884c\u6642\u306b\u76f4\u63a5\u5165\u529b\u3057\u307e\u3059\u3002  \n\nLinuxVirtualMachineScaleSet.parameters.json\n{\n    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"parameters\": {\n        \"vmssName\": {\n            \"value\": \"testVmss\"\n        },\n        \"instanceCount\": {\n            \"value\": 2\n        },\n      \"adminUsername\": {\n        \"value\": \"testUser\"\n      }\n    }\n}\n\n\n\n\u30c7\u30d7\u30ed\u30a4\u3057\u3066\u307f\u308b\n\u305d\u308c\u3067\u306f\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u4eca\u56de\u306fPowerShell\u3092\u4f7f\u7528\u3057\u305f\u30c7\u30d7\u30ed\u30a4\u65b9\u6cd5\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002  \n\u307e\u305a\u30c7\u30d7\u30ed\u30a4\u5148\u306e\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\n\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u8907\u6570\u306e\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u304c\u7d10\u3065\u3044\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u4eca\u56de\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u9078\u629e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \n\n\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u305f\u3089\u3001VisualStudio\u304c\u751f\u6210\u3057\u3066\u304f\u308c\u305fDeploy-AzureResourceGroup.ps1\u3092\u5b9f\u884c\u3059\u308c\u3070OK\u3067\u3059\u3002  \n\u3053\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u4f5c\u6210\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u805e\u3044\u3066\u304f\u308b\u306e\u3067\u3001\u9069\u5f53\u306a\u30ea\u30fc\u30b8\u30e7\u30f3\u540d\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\n\u897f\u65e5\u672c\u2192japanwest\n\u6771\u65e5\u672c\u2192japaneast\n\u3068\u3044\u3063\u305f\u8981\u9818\u3067\u3059\u3002\u7279\u5225\u306a\u7406\u7531\u304c\u306a\u3044\u9650\u308a\u3001\u65e5\u672c\u306e\u3069\u3061\u3089\u304b\u3067\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002\u3000\u3000\n\u5148\u8ff0\u306e\u901a\u308a\u30d1\u30b9\u30ef\u30fc\u30c9\u306fSecureString\u3067\u5b9a\u7fa9\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u3053\u3067\u5165\u529b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u30c0\u30a4\u30a2\u30ed\u30b0\u30dc\u30c3\u30af\u30b9\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u9069\u5f53\u306a\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u203bVM\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306f12\u6587\u5b57\u4ee5\u4e0a\u3067\u306a\u3051\u308c\u3070\u3044\u3051\u306a\u3044\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u30c7\u30d7\u30ed\u30a4\u304c\u5b8c\u4e86\u3057\u305f\u3089\u30dd\u30fc\u30bf\u30eb\u3067\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u4f5c\u6210\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u304c\u5b8c\u6210\u3057\u3066\u3044\u307e\u3059\u306d\u3002\n\n\nCustomScript\u3067\u3001\u30c7\u30d7\u30ed\u30a4\u6642\u306bJava\u30fbTomcat\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\u3055\u3066\u3001\u5b9f\u969b\u306bVM Scale set\u306e\u30c7\u30d7\u30ed\u30a4\u304c\u3067\u304d\u307e\u3057\u305f\u304c\u3001\n\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u5f8c\u306b\u3001\u624b\u52d5\u3067\u30de\u30b7\u30f3\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3092\u884c\u3046\u306e\u5927\u5909\u3067\u3059\u3088\u306d\u3002\nVM\u306b\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u62e1\u5f35\u6a5f\u80fd\u306e\u30ab\u30b9\u30bf\u30e0\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u30c7\u30d7\u30ed\u30a4\u6642\u306b\u6307\u5b9a\u3057\u305f\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u6b21\u306f\u3053\u306e\u62e1\u5f35\u6a5f\u80fd\u3092\u4f7f\u3063\u3066Tomcat\u3068Java\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3059\u3002  \n\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u4fdd\u5b58\u3057\u3066\u3042\u308b\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u5b9f\u884c\u3057\u307e\u3059\u3002\nVirtualMachineScaleSet\u306eProfiles\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306aExtensionProfile\u3092\u4ed8\u3051\u8db3\u3057\u3066\u304f\u3060\u3055\u3044\u3002  \n\nLinuxVirtualMachineScaleSet.json\n        \"extensionProfile\": {\n            \"extensions\": [\n              {\n                \"name\": \"CustomScript\",\n                \"properties\": {\n                  \"publisher\": \"Microsoft.Azure.Extensions\",\n                  \"type\": \"CustomScript\",\n                  \"typeHandlerVersion\": \"2.0\",\n                  \"settings\": {\n                    \"fileUris\": [ \"[variables('scriptUri')]\" ]\n                  },\n                  \"protectedSettings\": {\n                    \"commandToExecute\": \"bash testscript.sh\",\n                    \"storageAccountName\": \"[variables('scriptsStorageAccount')]\",\n                    \"storageAccountKey\": \"[listkeys(resourceId('Microsoft.Storage/storageAccounts', variables('scriptsStorageAccount')), '2015-06-15').key1]\"\n                  }\n                }\n              }\n            ]\n          }\n\n\n\u4eca\u56de\u7528\u610f\u3057\u305f\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u30ab\u30b9\u30bf\u30e0\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u306fRoot\u6a29\u9650\u3067\u30b3\u30de\u30f3\u30c9\u304c\u5b9f\u884c\u3055\u308c\u308b\u305f\u3081\u3001sudo\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\ntestscript.sh\n#!/bin/sh\n\nyum install java-1.7.0-openjdk\nuseradd -s /sbin/nologin tomcat\ncd ~\nwget http://ftp.jaist.ac.jp/pub/apache/tomcat/tomcat-7/v7.0.53/bin/apache-tomcat-7.0.53.tar.gz\ntar -xzvf ~/apache-tomcat-7.0.53.tar.gz\nmkdir /opt/apache-tomcat\nmv ~/apache-tomcat-7.0.53 /opt/apache-tomcat\nchown -R tomcat:tomcat /opt/apache-tomcat\n\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5168\u4f53\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002  \n\nLinuxVirtualMachineScaleSet.json\n{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"parameters\": {\n    \"vmSize\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"Standard_A1\",\n      \"minLength\": 1\n    },\n    \"centOsVersion\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"7.2\",\n      \"metadata\": {\n        \"description\": \"The Ubuntu version for the VM. This will pick a fully patched image of this given Ubuntu version. Allowed values are: 15.10, 14.04.4-LTS.\"\n      }\n    },\n    \"vmssName\": {\n      \"type\": \"string\",\n      \"metadata\": {\n        \"description\": \"DNS name used for public IP addresses and as base for naming other resources. Must be globally unique and 3 to 61 characters long.\"\n      },\n      \"minLength\": 3,\n      \"maxLength\": 61\n    },\n    \"instanceCount\": {\n      \"type\": \"int\",\n      \"metadata\": {\n        \"description\": \"Number of VM instances (100 or less)\"\n      },\n      \"minValue\": 1,\n      \"maxValue\": 100\n    },\n    \"adminUsername\": {\n      \"type\": \"string\",\n      \"minLength\": 1,\n      \"metadata\": {\n        \"description\": \"Administrator username on all VMs\"\n      }\n    },\n    \"adminPassword\": {\n      \"type\": \"securestring\",\n      \"metadata\": {\n        \"description\": \"Administrator password on all VMs\"\n      }\n    }\n  },\n  \"variables\": {\n    \"location\": \"[resourceGroup().location]\",\n    \"storageAccountType\": \"Standard_LRS\",\n    \"namingInfix\": \"[toLower(substring(concat(parameters('vmssName'), uniqueString(resourceGroup().id)), 0, 9))]\",\n    \"longNamingInfix\": \"[toLower(parameters('vmssName'))]\",\n    \"newStorageAccountSuffix\": \"[concat(variables('namingInfix'), 'sa')]\",\n    \"uniqueStringArray\": [\n      \"[concat(uniqueString(concat(resourceGroup().id, variables('newStorageAccountSuffix'), '0')), variables('newStorageAccountSuffix'))]\",\n      \"[concat(uniqueString(concat(resourceGroup().id, variables('newStorageAccountSuffix'), '1')), variables('newStorageAccountSuffix'))]\",\n      \"[concat(uniqueString(concat(resourceGroup().id, variables('newStorageAccountSuffix'), '2')), variables('newStorageAccountSuffix'))]\",\n      \"[concat(uniqueString(concat(resourceGroup().id, variables('newStorageAccountSuffix'), '3')), variables('newStorageAccountSuffix'))]\",\n      \"[concat(uniqueString(concat(resourceGroup().id, variables('newStorageAccountSuffix'), '4')), variables('newStorageAccountSuffix'))]\"\n    ],\n    \"vhdContainerName\": \"[concat(variables('namingInfix'), 'vhd')]\",\n    \"osDiskName\": \"[concat(variables('namingInfix'), 'osdisk')]\",\n    \"addressPrefix\": \"10.0.0.0/16\",\n    \"subnetPrefix\": \"10.0.0.0/24\",\n    \"virtualNetworkName\": \"[concat(variables('namingInfix'), 'vnet')]\",\n    \"publicIPAddressName\": \"[concat(variables('namingInfix'), 'pip')]\",\n    \"subnetName\": \"[concat(variables('namingInfix'), 'subnet')]\",\n    \"loadBalancerName\": \"[concat(variables('namingInfix'), 'lb')]\",\n    \"publicIPAddressID\": \"[resourceId('Microsoft.Network/publicIPAddresses', variables('publicIPAddressName'))]\",\n    \"lbID\": \"[resourceId('Microsoft.Network/loadBalancers', variables('loadBalancerName'))]\",\n    \"natPoolName\": \"[concat(variables('namingInfix'), 'natpool')]\",\n    \"bePoolName\": \"[concat(variables('namingInfix'), 'bepool')]\",\n    \"nicName\": \"[concat(variables('namingInfix'), 'nic')]\",\n    \"ipConfigName\": \"[concat(variables('namingInfix'), 'ipconfig')]\",\n    \"frontEndIPConfigID\": \"[concat(variables('lbID'), '/frontendIPConfigurations/loadBalancerFrontEnd')]\",\n    \"osType\": {\n      \"publisher\": \"OpenLogic\",\n      \"offer\": \"CentOS\",\n      \"sku\": \"[parameters('centOSVersion')]\",\n      \"version\": \"latest\"\n    },\n    \"imageReference\": \"[variables('osType')]\",\n    \"scriptsStorageAccount\": \"vmssjavasampleaccount\",\n    \"scriptUri\": \"\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4fdd\u5b58\u3057\u305fURL\"\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.Network/virtualNetworks\",\n      \"name\": \"[variables('virtualNetworkName')]\",\n      \"location\": \"[variables('location')]\",\n      \"apiVersion\": \"2015-06-15\",\n      \"tags\": {\n        \"displayName\": \"VirtualNetwork\"\n      },\n      \"properties\": {\n        \"addressSpace\": {\n          \"addressPrefixes\": [\n            \"[variables('addressPrefix')]\"\n          ]\n        },\n        \"subnets\": [\n          {\n            \"name\": \"[variables('subnetName')]\",\n            \"properties\": {\n              \"addressPrefix\": \"[variables('subnetPrefix')]\"\n            }\n          }\n        ]\n      }\n    },\n    {\n      \"type\": \"Microsoft.Storage/storageAccounts\",\n      \"name\": \"[variables('uniqueStringArray')[copyIndex()]]\",\n      \"location\": \"[variables('location')]\",\n      \"apiVersion\": \"2015-06-15\",\n      \"tags\": {\n        \"displayName\": \"StorageAccounts\"\n      },\n      \"copy\": {\n        \"name\": \"storageLoop\",\n        \"count\": \"[length(variables('uniqueStringArray'))]\"\n      },\n      \"properties\": {\n        \"accountType\": \"[variables('storageAccountType')]\"\n      }\n    },\n    {\n      \"type\": \"Microsoft.Network/publicIPAddresses\",\n      \"name\": \"[variables('publicIPAddressName')]\",\n      \"location\": \"[variables('location')]\",\n      \"apiVersion\": \"2015-06-15\",\n      \"tags\": {\n        \"displayName\": \"PublicIP\"\n      },\n      \"properties\": {\n        \"publicIPAllocationMethod\": \"Dynamic\",\n        \"dnsSettings\": {\n          \"domainNameLabel\": \"[variables('longNamingInfix')]\"\n        }\n      }\n    },\n    {\n      \"type\": \"Microsoft.Network/loadBalancers\",\n      \"name\": \"[variables('loadBalancerName')]\",\n      \"location\": \"[variables('location')]\",\n      \"apiVersion\": \"2015-06-15\",\n      \"tags\": {\n        \"displayName\": \"LoadBalancer\"\n      },\n      \"dependsOn\": [\n        \"[resourceId('Microsoft.Network/publicIPAddresses', variables('publicIPAddressName'))]\"\n      ],\n      \"properties\": {\n        \"frontendIPConfigurations\": [\n          {\n            \"name\": \"LoadBalancerFrontEnd\",\n            \"properties\": {\n              \"publicIPAddress\": {\n                \"id\": \"[variables('publicIPAddressID')]\"\n              }\n            }\n          }\n        ],\n        \"backendAddressPools\": [\n          {\n            \"name\": \"[variables('bePoolName')]\"\n          }\n        ],\n        \"inboundNatPools\": [\n          {\n            \"name\": \"[variables('natPoolName')]\",\n            \"properties\": {\n              \"frontendIPConfiguration\": {\n                \"id\": \"[variables('frontEndIPConfigID')]\"\n              },\n              \"protocol\": \"tcp\",\n              \"frontendPortRangeStart\": 50000,\n              \"frontendPortRangeEnd\": 50099,\n              \"backendPort\": 22\n            }\n          }\n        ]\n      }\n    },\n    {\n      \"type\": \"Microsoft.Compute/virtualMachineScaleSets\",\n      \"name\": \"[variables('namingInfix')]\",\n      \"location\": \"[variables('location')]\",\n      \"apiVersion\": \"2016-03-30\",\n      \"tags\": {\n        \"displayName\": \"VMScaleSet\"\n      },\n      \"dependsOn\": [\n        \"storageLoop\",\n        \"[resourceId('Microsoft.Network/loadBalancers', variables('loadBalancerName'))]\",\n        \"[resourceId('Microsoft.Network/virtualNetworks', variables('virtualNetworkName'))]\"\n      ],\n      \"sku\": {\n        \"name\": \"[parameters('vmSize')]\",\n        \"tier\": \"Standard\",\n        \"capacity\": \"[parameters('instanceCount')]\"\n      },\n      \"properties\": {\n        \"overprovision\": \"true\",\n        \"upgradePolicy\": {\n          \"mode\": \"Manual\"\n        },\n        \"virtualMachineProfile\": {\n          \"storageProfile\": {\n            \"osDisk\": {\n              \"vhdContainers\": [\n                \"[concat('https://', variables('uniqueStringArray')[0], '.blob.core.windows.net/', variables('vhdContainerName'))]\",\n                \"[concat('https://', variables('uniqueStringArray')[1], '.blob.core.windows.net/', variables('vhdContainerName'))]\",\n                \"[concat('https://', variables('uniqueStringArray')[2], '.blob.core.windows.net/', variables('vhdContainerName'))]\",\n                \"[concat('https://', variables('uniqueStringArray')[3], '.blob.core.windows.net/', variables('vhdContainerName'))]\",\n                \"[concat('https://', variables('uniqueStringArray')[4], '.blob.core.windows.net/', variables('vhdContainerName'))]\"\n              ],\n              \"name\": \"[variables('osDiskName')]\",\n              \"caching\": \"ReadOnly\",\n              \"createOption\": \"FromImage\"\n            },\n            \"imageReference\": \"[variables('imageReference')]\"\n          },\n          \"osProfile\": {\n            \"computerNamePrefix\": \"[variables('namingInfix')]\",\n            \"adminUsername\": \"[parameters('adminUsername')]\",\n            \"adminPassword\": \"[parameters('adminPassword')]\"\n          },\n          \"networkProfile\": {\n            \"networkInterfaceConfigurations\": [\n              {\n                \"name\": \"[variables('nicName')]\",\n                \"properties\": {\n                  \"primary\": true,\n                  \"ipConfigurations\": [\n                    {\n                      \"name\": \"[variables('ipConfigName')]\",\n                      \"properties\": {\n                        \"subnet\": {\n                          \"id\": \"[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Network/virtualNetworks/', variables('virtualNetworkName'), '/subnets/', variables('subnetName'))]\"\n                        },\n                        \"loadBalancerBackendAddressPools\": [\n                          {\n                            \"id\": \"[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Network/loadBalancers/', variables('loadBalancerName'), '/backendAddressPools/', variables('bePoolName'))]\"\n                          }\n                        ],\n                        \"loadBalancerInboundNatPools\": [\n                          {\n                            \"id\": \"[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Network/loadBalancers/', variables('loadBalancerName'), '/inboundNatPools/', variables('natPoolName'))]\"\n                          }\n                        ]\n                      }\n                    }\n                  ]\n                }\n              }\n            ]\n          },\n          \"extensionProfile\": {\n            \"extensions\": [\n              {\n                \"name\": \"CustomScript\",\n                \"properties\": {\n                  \"publisher\": \"Microsoft.Azure.Extensions\",\n                  \"type\": \"CustomScript\",\n                  \"typeHandlerVersion\": \"2.0\",\n                  \"settings\": {\n                    \"fileUris\": [ \"[variables('scriptUri')]\" ]\n                  },\n                  \"protectedSettings\": {\n                    \"commandToExecute\": \"bash testscript.sh\",\n                    \"storageAccountName\": \"[variables('scriptsStorageAccount')]\",\n                    \"storageAccountKey\": \"[listkeys(resourceId('Microsoft.Storage/storageAccounts', variables('scriptsStorageAccount')), '2015-06-15').key1]\"\n                  }\n                }\n              }\n            ]\n          }\n        }\n      }\n    }\n  ]\n}\n\n\n\n\u5148\u307b\u3069\u3068\u540c\u69d8\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u3067\u304d\u3042\u304c\u3063\u305fScaleSet\u306bssh\u3067\u63a5\u7d9a\u3057\u3066\u307f\u308b\u3068\u3001/opt/apache-tomcat\u304c\u3067\u304d\u3042\u304c\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u203bScaleSet\u3078\u306e\u63a5\u7d9a\u306f\u3001\u4f5c\u6210\u3057\u305fLoadBalancer\u306e\u300c\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9IP\u30d7\u30fc\u30eb\u300d\u306eIP\u3068\u30dd\u30fc\u30c8\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 \n\n\n\u307e\u3068\u3081\nVisualStudio\u3067\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u3001PowerShell\u3067\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u307e\u3067\u4e00\u9023\u306e\u6d41\u308c\u3092\u8aac\u660e\u3057\u307e\u3057\u305f\u3002\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u7d30\u304b\u3044\u3068\u3053\u308d\u307e\u3067\u89e3\u8aac\u3059\u308b\u4f59\u88d5\u306f\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u304c\u3001\n\u30ea\u30bd\u30fc\u30b9\u5358\u4f4d\u3067\u3088\u304f\u898b\u308b\u3068\u5358\u7d14\u306a\u69cb\u6210\u306b\u306a\u3063\u3066\u3044\u3066\u7406\u89e3\u3057\u3084\u3059\u3044\u3067\u3059\u3002\nMicrosoft\u304cGitHub\u306bArm\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u8f09\u305b\u3066\u3044\u305f\u308a\u3001\nAzure\u30dd\u30fc\u30bf\u30eb\u304b\u3089\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u4e00\u89a7\u3092\u78ba\u8a8d\u3067\u304d\u305f\u308a\u3068\n\u30bd\u30fc\u30b9\u3082\u591a\u304f\u8ee2\u304c\u3063\u3066\u3044\u3066\u53d6\u308a\u7d44\u307f\u3084\u3059\u3044\u306e\u3067\u306f\u306a\u3044\u3067\u3057\u3087\u3046\u304b\u3002  \nInfrastracture as code \u306e\u7aef\u3063\u3053\u306b\u307b\u3093\u306e\u3061\u3087\u3063\u3068\u3067\u3082\u89e6\u308c\u308b\u624b\u52a9\u3051\u3068\u306a\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\u30dc\u30ea\u30e5\u30fc\u30df\u30fc\u306b\u306a\u308a\u3059\u304e\u3066\u3057\u307e\u3044\u7533\u3057\u8a33\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\n\u3053\u306e\u8a18\u4e8b\u306f[\u30a8\u30e0\u30c6\u30a3\u30fc\u30a2\u30a4 Advent Calender 2016](http://qiita.com/advent-calendar/2016/mti \"\u30a8\u30e0\u30c6\u30a3\u30fc\u30a2\u30a4 Advent Calender 2016\")\u306e22\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\nAdvent Calender\u3082\u6b8b\u3059\u3068\u3053\u308d4\u65e5\u3068\u306a\u3063\u305f\u672c\u65e5\u306f\u3001\u4eca\u6d41\u884c\u308a\u306eAzure Resource Manager\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8(\u4ee5\u964dArm\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8)\u306b\u3064\u3044\u3066\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002  \n**\u3053\u308c\u304b\u3089Arm\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u52c9\u5f37\u3057\u305f\u3044\u3001\u3068\u308a\u3042\u3048\u305a\u52d5\u304f\u74b0\u5883\u3092\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3067\u4f5c\u308a\u305f\u3044**  \n\u305d\u3093\u306a\u65b9\u306b\u304a\u3059\u3059\u3081\u3067\u3059\u3002\n\n\n# \u3084\u308a\u305f\u3044\u3053\u3068  \n1. Arm\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3067Linux Virtual Machine\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u307e\u3059\u3002  \n2. \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30c7\u30d7\u30ed\u30a4\u6642\u306bjava\u30fbTomcat\u3092\u81ea\u52d5\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002  \n\u4eca\u56de\u4f5c\u6210\u3059\u308b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u540c\u4e00\u74b0\u5883\u306eVM\u3092\u4e00\u5ea6\u306b\u8907\u6570\u53f0\u30c7\u30d7\u30ed\u30a4\u53ef\u80fd\u3067\u3059\u3002  \n\nArm\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306fJson\u3067\u66f8\u304b\u308c\u3066\u3044\u307e\u3059\u3002  \n\u304a\u597d\u304d\u306a\u30a8\u30c7\u30a3\u30bf\u3067\u7de8\u96c6\u3067\u304d\u307e\u3059\u304c\u3001VisualStudio\u3092\u4f7f\u3046\u3068\u30a4\u30f3\u30c6\u30ea\u30bb\u30f3\u30b9\u304c\u4f7f\u3048\u305f\u308a\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u81ea\u7531\u306b\u751f\u6210\u3057\u3066\u304f\u308c\u305f\u308a\u3068\u4f55\u304b\u3068\u4fbf\u5229\u3067\u3059\u3002  \n\n\n# \u5b9f\u884c\u74b0\u5883\n* Windows10\n* VisualStudio 2015 Community  \n* Azure SDK 2.9  \n* PowerShell 5.0\n\u203bVisualStudio\u3067\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f5c\u6210\u3059\u308b\u306b\u306f\u3001AzureSDK2.6\u4ee5\u4e0a\u304c\u5fc5\u8981\u3067\u3059\u3002  \n\n# VisualStudio\u3067\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f5c\u6210\u3059\u308b  \n\u3067\u306f\u65e9\u901f\u3001Visual Studio\u3067\u65b0\u898f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\u3002  \n\u300c\u65b0\u898f\u4f5c\u6210\u300d\uff1e\u300c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u300d\u304b\u3089Azure\u30ea\u30bd\u30fc\u30b9\u30de\u30cd\u30fc\u30b8\u30e3\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n![\u65b0\u898f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210.PNG](https://qiita-image-store.s3.amazonaws.com/0/150361/2904113e-36de-a59d-abc2-6e738c95c7a7.png)\n  \n\n\u69d8\u3005\u306a\u30ea\u30bd\u30fc\u30b9\u304c\u9078\u629e\u3067\u304d\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u300cLinux Virtual Machine Scale Set\u300d\u3092\u9078\u629e\u3057\u307e\u3059\u3002  \n[\u4eee\u60f3\u30de\u30b7\u30f3\u30b9\u30b1\u30fc\u30eb\u30bb\u30c3\u30c8\u306e\u6982\u8981](https://docs.microsoft.com/ja-jp/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview)  \n ![\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u9078\u629e.PNG](https://qiita-image-store.s3.amazonaws.com/0/150361/4e76dcd7-0f63-baf3-9092-1fa73db459d3.png)\n\n\u4f5c\u6210\u3057\u305f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u69cb\u6210\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002  \n\u30c7\u30d7\u30ed\u30a4\u7528\u306ePowershell\u30b9\u30af\u30ea\u30d7\u30c8\u3082\u81ea\u52d5\u3067\u751f\u6210\u3057\u3066\u304f\u308c\u3066\u3044\u307e\u3059\u3002  \n![\u30bd\u30ea\u30e5\u30fc\u30b7\u30e7\u30f3\u30a8\u30af\u30b9\u30d7\u30ed\u30fc\u30e9.PNG](https://qiita-image-store.s3.amazonaws.com/0/150361/8f8d077f-cb2e-58b1-085a-385c17a66707.png)\n\n\n\u7c21\u5358\u306b\u5404\u30d5\u30a1\u30a4\u30eb\u306e\u8aac\u660e\u3092\u3057\u307e\u3059\u3002\n* Deploy-AzureResourceGroup.ps1  \n\u30c7\u30d7\u30ed\u30a4\u7528\u306ePowerShell\u30b9\u30af\u30ea\u30d7\u30c8\u3002  \nPowerShell 5.0 \u3067\u52d5\u4f5c\u3057\u307e\u3059\u3002  \nPowersshell 5.0 Windows10\u304b\u3089\u306f\u6a19\u6e96\u3067\u642d\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001Windows 7\u30fb8\u306e\u5834\u5408\u306f\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u304c\u5fc5\u8981\u3067\u3059\u3002  \n\n* LinuxVirtualMachineScaleSet.json  \n\u3053\u3061\u3089\u304c\u6240\u8b02Arm\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3067\u3059\u3002\u30ea\u30bd\u30fc\u30b9\u306e\u60c5\u5831\u3092\u8a18\u8f09\u3057\u3066\u3044\u307e\u3059\u3002  \n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u69cb\u6210\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002  \n  * parameters  \n  \u30c7\u30d7\u30ed\u30a4\u6642\u306b\u30e6\u30fc\u30b6\u304c\u6307\u5b9a\u3059\u308b\u5024\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002  \n  * variables  \n  \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5185\u3067\u4f7f\u7528\u3059\u308b\u5909\u6570\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002  \n  \u4e71\u6570\u3092\u81ea\u52d5\u751f\u6210\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n  * resourrces  \n  Virtual Machine\u3084NIC\u7b49\u306e\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002  \n\n\n* LinuxVirtualMachineScaleSet.parameters.json  \nPowershell\u304b\u3089\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u6642\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002  \nArm\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306eParameters\u3067\u5b9a\u7fa9\u3057\u305f\u9805\u76ee\u306e\u5024\u3092\u8a18\u8ff0\u3057\u3066\u304a\u304f\u3053\u3068\u3067\u3001\u624b\u5165\u529b\u306e\u624b\u9593\u3092\u7701\u304d\u307e\u3059\u3002\n\u3000\u3000\n\n\u81ea\u52d5\u751f\u6210\u3055\u308c\u305f\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u300cLinuxVirtualMachineScaleSet.json\u300d\u306f\u305d\u306e\u307e\u307e\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u4eca\u56de\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067Ubuntu\u306b\u306a\u3063\u3066\u3044\u308bOS\u3092CentOS\u306b\u5909\u66f4\u3057\u3066\u304b\u3089\u30c7\u30d7\u30ed\u30a4\u3057\u307e\u3059\u3002\n\n## OS\u3092CentOS\u306b\u5909\u66f4\u3059\u308b\u3002  \nCentOS 7.2 \u306b\u5909\u66f4\u3057\u307e\u3059\u3002  \n\nParameters\u306eubuntuOsVersion\u3092\u4ee5\u4e0b\u306b\u5dee\u3057\u66ff\u3048\u307e\u3059\u3002\n\n```json:LinuxVirtualMachineScaleSet.json\n\"centOsVersion\": {\n  \"type\": \"string\",\n  \"defaultValue\": \"7.2\",\n  \"metadata\": {\n    \"description\": \"The Ubuntu version for the VM. This will pick a fully patched image of this given Ubuntu version. Allowed values are: 15.10, 14.04.4-LTS.\"\n  }\n}\n```  \n\nvariables\u306eosType\u3092\u4ee5\u4e0b\u306b\u5dee\u3057\u66ff\u3048\u307e\u3059\u3002  \n\n```json:LinuxVirtualMachineScaleSet.json\n\"osType\": {\n  \"publisher\": \"OpenLogic\",\n  \"offer\": \"CentOS\",\n  \"sku\": \"[parameters('centOSVersion')]\",\n  \"version\": \"latest\"\n}\n```\n\u5909\u66f4\u70b9\u306f\u4ee5\u4e0a\u3067\u3059\u3002  \n\n## \u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u7528\u610f\u3059\u308b  \n\u81ea\u52d5\u751f\u6210\u3055\u308c\u305fLinuxVirtualMachineScaleSet.parameters.json\u306eValue\u306b\u5024\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002  \nadminUserPassword\u306fSecureString\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001  \n\u30d1\u30e9\u30e1\u30fc\u30bf\u30d5\u30a1\u30a4\u30eb\u306b\u306f\u8a18\u8ff0\u305b\u305a\u3001Powershell\u5b9f\u884c\u6642\u306b\u76f4\u63a5\u5165\u529b\u3057\u307e\u3059\u3002  \n\n```json:LinuxVirtualMachineScaleSet.parameters.json\n{\n    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"parameters\": {\n        \"vmssName\": {\n            \"value\": \"testVmss\"\n        },\n        \"instanceCount\": {\n            \"value\": 2\n        },\n      \"adminUsername\": {\n        \"value\": \"testUser\"\n      }\n    }\n}\n```\n\n# \u30c7\u30d7\u30ed\u30a4\u3057\u3066\u307f\u308b  \n\u305d\u308c\u3067\u306f\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002  \n\u4eca\u56de\u306fPowerShell\u3092\u4f7f\u7528\u3057\u305f\u30c7\u30d7\u30ed\u30a4\u65b9\u6cd5\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002  \n\n\u307e\u305a\u30c7\u30d7\u30ed\u30a4\u5148\u306e\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002  \n![Powershell_\u30ed\u30b0\u30a4\u30f3.PNG](https://qiita-image-store.s3.amazonaws.com/0/150361/a61189ec-7777-1df3-56de-09a60d1106d7.png)\n\n\n\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u8907\u6570\u306e\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u304c\u7d10\u3065\u3044\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u4eca\u56de\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u9078\u629e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \n![Powershell_\u9078\u629e_Ink_LI.jpg](https://qiita-image-store.s3.amazonaws.com/0/150361/0240c52c-4ff2-14aa-9782-357d817ed517.jpeg)\n \n\n\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u305f\u3089\u3001VisualStudio\u304c\u751f\u6210\u3057\u3066\u304f\u308c\u305fDeploy-AzureResourceGroup.ps1\u3092\u5b9f\u884c\u3059\u308c\u3070OK\u3067\u3059\u3002  \n\n\n\u3053\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u4f5c\u6210\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u30b0\u30eb\u30fc\u30d7\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u805e\u3044\u3066\u304f\u308b\u306e\u3067\u3001\u9069\u5f53\u306a\u30ea\u30fc\u30b8\u30e7\u30f3\u540d\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n![Powershell_\u30ea\u30fc\u30b8\u30e7\u30f3.PNG](https://qiita-image-store.s3.amazonaws.com/0/150361/a0857d0d-3112-66e5-e227-0f34b099d43a.png)\n  \n\u897f\u65e5\u672c\u2192japanwest\n\u6771\u65e5\u672c\u2192japaneast  \n\u3068\u3044\u3063\u305f\u8981\u9818\u3067\u3059\u3002\u7279\u5225\u306a\u7406\u7531\u304c\u306a\u3044\u9650\u308a\u3001\u65e5\u672c\u306e\u3069\u3061\u3089\u304b\u3067\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002\u3000\u3000\n\n\u5148\u8ff0\u306e\u901a\u308a\u30d1\u30b9\u30ef\u30fc\u30c9\u306fSecureString\u3067\u5b9a\u7fa9\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u3053\u3067\u5165\u529b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u30c0\u30a4\u30a2\u30ed\u30b0\u30dc\u30c3\u30af\u30b9\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u9069\u5f53\u306a\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n**\u203bVM\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306f12\u6587\u5b57\u4ee5\u4e0a\u3067\u306a\u3051\u308c\u3070\u3044\u3051\u306a\u3044\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002**\n\n\u30c7\u30d7\u30ed\u30a4\u304c\u5b8c\u4e86\u3057\u305f\u3089\u30dd\u30fc\u30bf\u30eb\u3067\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u4f5c\u6210\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u304c\u5b8c\u6210\u3057\u3066\u3044\u307e\u3059\u306d\u3002\n![\u30c7\u30d7\u30ed\u30a4\u6210\u529f.PNG](https://qiita-image-store.s3.amazonaws.com/0/150361/66948c25-5fdb-6aed-0915-32b1d6a40028.png)\n\n\n# CustomScript\u3067\u3001\u30c7\u30d7\u30ed\u30a4\u6642\u306bJava\u30fbTomcat\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b  \n\u3055\u3066\u3001\u5b9f\u969b\u306bVM Scale set\u306e\u30c7\u30d7\u30ed\u30a4\u304c\u3067\u304d\u307e\u3057\u305f\u304c\u3001  \n\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u5f8c\u306b\u3001\u624b\u52d5\u3067\u30de\u30b7\u30f3\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3092\u884c\u3046\u306e\u5927\u5909\u3067\u3059\u3088\u306d\u3002  \nVM\u306b\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u62e1\u5f35\u6a5f\u80fd\u306e\u30ab\u30b9\u30bf\u30e0\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u30c7\u30d7\u30ed\u30a4\u6642\u306b\u6307\u5b9a\u3057\u305f\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002  \n\u6b21\u306f\u3053\u306e\u62e1\u5f35\u6a5f\u80fd\u3092\u4f7f\u3063\u3066Tomcat\u3068Java\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3059\u3002  \n\n\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u4fdd\u5b58\u3057\u3066\u3042\u308b\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u5b9f\u884c\u3057\u307e\u3059\u3002  \nVirtualMachineScaleSet\u306eProfiles\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306aExtensionProfile\u3092\u4ed8\u3051\u8db3\u3057\u3066\u304f\u3060\u3055\u3044\u3002  \n\n```json:LinuxVirtualMachineScaleSet.json\n        \"extensionProfile\": {\n            \"extensions\": [\n              {\n                \"name\": \"CustomScript\",\n                \"properties\": {\n                  \"publisher\": \"Microsoft.Azure.Extensions\",\n                  \"type\": \"CustomScript\",\n                  \"typeHandlerVersion\": \"2.0\",\n                  \"settings\": {\n                    \"fileUris\": [ \"[variables('scriptUri')]\" ]\n                  },\n                  \"protectedSettings\": {\n                    \"commandToExecute\": \"bash testscript.sh\",\n                    \"storageAccountName\": \"[variables('scriptsStorageAccount')]\",\n                    \"storageAccountKey\": \"[listkeys(resourceId('Microsoft.Storage/storageAccounts', variables('scriptsStorageAccount')), '2015-06-15').key1]\"\n                  }\n                }\n              }\n            ]\n          }\n```\n\n\u4eca\u56de\u7528\u610f\u3057\u305f\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002  \n\u30ab\u30b9\u30bf\u30e0\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u306f**Root\u6a29\u9650\u3067\u30b3\u30de\u30f3\u30c9\u304c\u5b9f\u884c\u3055\u308c\u308b**\u305f\u3081\u3001sudo\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n```shell-session:testscript.sh\n#!/bin/sh\n\nyum install java-1.7.0-openjdk\nuseradd -s /sbin/nologin tomcat\ncd ~\nwget http://ftp.jaist.ac.jp/pub/apache/tomcat/tomcat-7/v7.0.53/bin/apache-tomcat-7.0.53.tar.gz\ntar -xzvf ~/apache-tomcat-7.0.53.tar.gz\nmkdir /opt/apache-tomcat\nmv ~/apache-tomcat-7.0.53 /opt/apache-tomcat\nchown -R tomcat:tomcat /opt/apache-tomcat\n```\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5168\u4f53\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002  \n\n```json:LinuxVirtualMachineScaleSet.json\n{\n  \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json\",\n  \"contentVersion\": \"1.0.0.0\",\n  \"parameters\": {\n    \"vmSize\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"Standard_A1\",\n      \"minLength\": 1\n    },\n    \"centOsVersion\": {\n      \"type\": \"string\",\n      \"defaultValue\": \"7.2\",\n      \"metadata\": {\n        \"description\": \"The Ubuntu version for the VM. This will pick a fully patched image of this given Ubuntu version. Allowed values are: 15.10, 14.04.4-LTS.\"\n      }\n    },\n    \"vmssName\": {\n      \"type\": \"string\",\n      \"metadata\": {\n        \"description\": \"DNS name used for public IP addresses and as base for naming other resources. Must be globally unique and 3 to 61 characters long.\"\n      },\n      \"minLength\": 3,\n      \"maxLength\": 61\n    },\n    \"instanceCount\": {\n      \"type\": \"int\",\n      \"metadata\": {\n        \"description\": \"Number of VM instances (100 or less)\"\n      },\n      \"minValue\": 1,\n      \"maxValue\": 100\n    },\n    \"adminUsername\": {\n      \"type\": \"string\",\n      \"minLength\": 1,\n      \"metadata\": {\n        \"description\": \"Administrator username on all VMs\"\n      }\n    },\n    \"adminPassword\": {\n      \"type\": \"securestring\",\n      \"metadata\": {\n        \"description\": \"Administrator password on all VMs\"\n      }\n    }\n  },\n  \"variables\": {\n    \"location\": \"[resourceGroup().location]\",\n    \"storageAccountType\": \"Standard_LRS\",\n    \"namingInfix\": \"[toLower(substring(concat(parameters('vmssName'), uniqueString(resourceGroup().id)), 0, 9))]\",\n    \"longNamingInfix\": \"[toLower(parameters('vmssName'))]\",\n    \"newStorageAccountSuffix\": \"[concat(variables('namingInfix'), 'sa')]\",\n    \"uniqueStringArray\": [\n      \"[concat(uniqueString(concat(resourceGroup().id, variables('newStorageAccountSuffix'), '0')), variables('newStorageAccountSuffix'))]\",\n      \"[concat(uniqueString(concat(resourceGroup().id, variables('newStorageAccountSuffix'), '1')), variables('newStorageAccountSuffix'))]\",\n      \"[concat(uniqueString(concat(resourceGroup().id, variables('newStorageAccountSuffix'), '2')), variables('newStorageAccountSuffix'))]\",\n      \"[concat(uniqueString(concat(resourceGroup().id, variables('newStorageAccountSuffix'), '3')), variables('newStorageAccountSuffix'))]\",\n      \"[concat(uniqueString(concat(resourceGroup().id, variables('newStorageAccountSuffix'), '4')), variables('newStorageAccountSuffix'))]\"\n    ],\n    \"vhdContainerName\": \"[concat(variables('namingInfix'), 'vhd')]\",\n    \"osDiskName\": \"[concat(variables('namingInfix'), 'osdisk')]\",\n    \"addressPrefix\": \"10.0.0.0/16\",\n    \"subnetPrefix\": \"10.0.0.0/24\",\n    \"virtualNetworkName\": \"[concat(variables('namingInfix'), 'vnet')]\",\n    \"publicIPAddressName\": \"[concat(variables('namingInfix'), 'pip')]\",\n    \"subnetName\": \"[concat(variables('namingInfix'), 'subnet')]\",\n    \"loadBalancerName\": \"[concat(variables('namingInfix'), 'lb')]\",\n    \"publicIPAddressID\": \"[resourceId('Microsoft.Network/publicIPAddresses', variables('publicIPAddressName'))]\",\n    \"lbID\": \"[resourceId('Microsoft.Network/loadBalancers', variables('loadBalancerName'))]\",\n    \"natPoolName\": \"[concat(variables('namingInfix'), 'natpool')]\",\n    \"bePoolName\": \"[concat(variables('namingInfix'), 'bepool')]\",\n    \"nicName\": \"[concat(variables('namingInfix'), 'nic')]\",\n    \"ipConfigName\": \"[concat(variables('namingInfix'), 'ipconfig')]\",\n    \"frontEndIPConfigID\": \"[concat(variables('lbID'), '/frontendIPConfigurations/loadBalancerFrontEnd')]\",\n    \"osType\": {\n      \"publisher\": \"OpenLogic\",\n      \"offer\": \"CentOS\",\n      \"sku\": \"[parameters('centOSVersion')]\",\n      \"version\": \"latest\"\n    },\n    \"imageReference\": \"[variables('osType')]\",\n    \"scriptsStorageAccount\": \"vmssjavasampleaccount\",\n    \"scriptUri\": \"\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4fdd\u5b58\u3057\u305fURL\"\n  },\n  \"resources\": [\n    {\n      \"type\": \"Microsoft.Network/virtualNetworks\",\n      \"name\": \"[variables('virtualNetworkName')]\",\n      \"location\": \"[variables('location')]\",\n      \"apiVersion\": \"2015-06-15\",\n      \"tags\": {\n        \"displayName\": \"VirtualNetwork\"\n      },\n      \"properties\": {\n        \"addressSpace\": {\n          \"addressPrefixes\": [\n            \"[variables('addressPrefix')]\"\n          ]\n        },\n        \"subnets\": [\n          {\n            \"name\": \"[variables('subnetName')]\",\n            \"properties\": {\n              \"addressPrefix\": \"[variables('subnetPrefix')]\"\n            }\n          }\n        ]\n      }\n    },\n    {\n      \"type\": \"Microsoft.Storage/storageAccounts\",\n      \"name\": \"[variables('uniqueStringArray')[copyIndex()]]\",\n      \"location\": \"[variables('location')]\",\n      \"apiVersion\": \"2015-06-15\",\n      \"tags\": {\n        \"displayName\": \"StorageAccounts\"\n      },\n      \"copy\": {\n        \"name\": \"storageLoop\",\n        \"count\": \"[length(variables('uniqueStringArray'))]\"\n      },\n      \"properties\": {\n        \"accountType\": \"[variables('storageAccountType')]\"\n      }\n    },\n    {\n      \"type\": \"Microsoft.Network/publicIPAddresses\",\n      \"name\": \"[variables('publicIPAddressName')]\",\n      \"location\": \"[variables('location')]\",\n      \"apiVersion\": \"2015-06-15\",\n      \"tags\": {\n        \"displayName\": \"PublicIP\"\n      },\n      \"properties\": {\n        \"publicIPAllocationMethod\": \"Dynamic\",\n        \"dnsSettings\": {\n          \"domainNameLabel\": \"[variables('longNamingInfix')]\"\n        }\n      }\n    },\n    {\n      \"type\": \"Microsoft.Network/loadBalancers\",\n      \"name\": \"[variables('loadBalancerName')]\",\n      \"location\": \"[variables('location')]\",\n      \"apiVersion\": \"2015-06-15\",\n      \"tags\": {\n        \"displayName\": \"LoadBalancer\"\n      },\n      \"dependsOn\": [\n        \"[resourceId('Microsoft.Network/publicIPAddresses', variables('publicIPAddressName'))]\"\n      ],\n      \"properties\": {\n        \"frontendIPConfigurations\": [\n          {\n            \"name\": \"LoadBalancerFrontEnd\",\n            \"properties\": {\n              \"publicIPAddress\": {\n                \"id\": \"[variables('publicIPAddressID')]\"\n              }\n            }\n          }\n        ],\n        \"backendAddressPools\": [\n          {\n            \"name\": \"[variables('bePoolName')]\"\n          }\n        ],\n        \"inboundNatPools\": [\n          {\n            \"name\": \"[variables('natPoolName')]\",\n            \"properties\": {\n              \"frontendIPConfiguration\": {\n                \"id\": \"[variables('frontEndIPConfigID')]\"\n              },\n              \"protocol\": \"tcp\",\n              \"frontendPortRangeStart\": 50000,\n              \"frontendPortRangeEnd\": 50099,\n              \"backendPort\": 22\n            }\n          }\n        ]\n      }\n    },\n    {\n      \"type\": \"Microsoft.Compute/virtualMachineScaleSets\",\n      \"name\": \"[variables('namingInfix')]\",\n      \"location\": \"[variables('location')]\",\n      \"apiVersion\": \"2016-03-30\",\n      \"tags\": {\n        \"displayName\": \"VMScaleSet\"\n      },\n      \"dependsOn\": [\n        \"storageLoop\",\n        \"[resourceId('Microsoft.Network/loadBalancers', variables('loadBalancerName'))]\",\n        \"[resourceId('Microsoft.Network/virtualNetworks', variables('virtualNetworkName'))]\"\n      ],\n      \"sku\": {\n        \"name\": \"[parameters('vmSize')]\",\n        \"tier\": \"Standard\",\n        \"capacity\": \"[parameters('instanceCount')]\"\n      },\n      \"properties\": {\n        \"overprovision\": \"true\",\n        \"upgradePolicy\": {\n          \"mode\": \"Manual\"\n        },\n        \"virtualMachineProfile\": {\n          \"storageProfile\": {\n            \"osDisk\": {\n              \"vhdContainers\": [\n                \"[concat('https://', variables('uniqueStringArray')[0], '.blob.core.windows.net/', variables('vhdContainerName'))]\",\n                \"[concat('https://', variables('uniqueStringArray')[1], '.blob.core.windows.net/', variables('vhdContainerName'))]\",\n                \"[concat('https://', variables('uniqueStringArray')[2], '.blob.core.windows.net/', variables('vhdContainerName'))]\",\n                \"[concat('https://', variables('uniqueStringArray')[3], '.blob.core.windows.net/', variables('vhdContainerName'))]\",\n                \"[concat('https://', variables('uniqueStringArray')[4], '.blob.core.windows.net/', variables('vhdContainerName'))]\"\n              ],\n              \"name\": \"[variables('osDiskName')]\",\n              \"caching\": \"ReadOnly\",\n              \"createOption\": \"FromImage\"\n            },\n            \"imageReference\": \"[variables('imageReference')]\"\n          },\n          \"osProfile\": {\n            \"computerNamePrefix\": \"[variables('namingInfix')]\",\n            \"adminUsername\": \"[parameters('adminUsername')]\",\n            \"adminPassword\": \"[parameters('adminPassword')]\"\n          },\n          \"networkProfile\": {\n            \"networkInterfaceConfigurations\": [\n              {\n                \"name\": \"[variables('nicName')]\",\n                \"properties\": {\n                  \"primary\": true,\n                  \"ipConfigurations\": [\n                    {\n                      \"name\": \"[variables('ipConfigName')]\",\n                      \"properties\": {\n                        \"subnet\": {\n                          \"id\": \"[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Network/virtualNetworks/', variables('virtualNetworkName'), '/subnets/', variables('subnetName'))]\"\n                        },\n                        \"loadBalancerBackendAddressPools\": [\n                          {\n                            \"id\": \"[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Network/loadBalancers/', variables('loadBalancerName'), '/backendAddressPools/', variables('bePoolName'))]\"\n                          }\n                        ],\n                        \"loadBalancerInboundNatPools\": [\n                          {\n                            \"id\": \"[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Network/loadBalancers/', variables('loadBalancerName'), '/inboundNatPools/', variables('natPoolName'))]\"\n                          }\n                        ]\n                      }\n                    }\n                  ]\n                }\n              }\n            ]\n          },\n          \"extensionProfile\": {\n            \"extensions\": [\n              {\n                \"name\": \"CustomScript\",\n                \"properties\": {\n                  \"publisher\": \"Microsoft.Azure.Extensions\",\n                  \"type\": \"CustomScript\",\n                  \"typeHandlerVersion\": \"2.0\",\n                  \"settings\": {\n                    \"fileUris\": [ \"[variables('scriptUri')]\" ]\n                  },\n                  \"protectedSettings\": {\n                    \"commandToExecute\": \"bash testscript.sh\",\n                    \"storageAccountName\": \"[variables('scriptsStorageAccount')]\",\n                    \"storageAccountKey\": \"[listkeys(resourceId('Microsoft.Storage/storageAccounts', variables('scriptsStorageAccount')), '2015-06-15').key1]\"\n                  }\n                }\n              }\n            ]\n          }\n        }\n      }\n    }\n  ]\n}\n\n```\n\n\u5148\u307b\u3069\u3068\u540c\u69d8\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u3067\u304d\u3042\u304c\u3063\u305fScaleSet\u306bssh\u3067\u63a5\u7d9a\u3057\u3066\u307f\u308b\u3068\u3001/opt/apache-tomcat\u304c\u3067\u304d\u3042\u304c\u3063\u3066\u3044\u307e\u3059\u3002\n![tomcat.PNG](https://qiita-image-store.s3.amazonaws.com/0/150361/abe949b4-55b7-756a-5538-a22f74cd54f7.png)\n\n\n\u203bScaleSet\u3078\u306e\u63a5\u7d9a\u306f\u3001\u4f5c\u6210\u3057\u305fLoadBalancer\u306e\u300c\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9IP\u30d7\u30fc\u30eb\u300d\u306eIP\u3068\u30dd\u30fc\u30c8\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 \n![\u30dd\u30fc\u30c8.PNG](https://qiita-image-store.s3.amazonaws.com/0/150361/8805dc97-3fec-b24d-5956-097db527f628.png)\n \n\n\n# \u307e\u3068\u3081\nVisualStudio\u3067\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u3001PowerShell\u3067\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u307e\u3067\u4e00\u9023\u306e\u6d41\u308c\u3092\u8aac\u660e\u3057\u307e\u3057\u305f\u3002  \n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u7d30\u304b\u3044\u3068\u3053\u308d\u307e\u3067\u89e3\u8aac\u3059\u308b\u4f59\u88d5\u306f\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u304c\u3001\n\u30ea\u30bd\u30fc\u30b9\u5358\u4f4d\u3067\u3088\u304f\u898b\u308b\u3068\u5358\u7d14\u306a\u69cb\u6210\u306b\u306a\u3063\u3066\u3044\u3066\u7406\u89e3\u3057\u3084\u3059\u3044\u3067\u3059\u3002  \nMicrosoft\u304cGitHub\u306bArm\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u8f09\u305b\u3066\u3044\u305f\u308a\u3001\nAzure\u30dd\u30fc\u30bf\u30eb\u304b\u3089\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u4e00\u89a7\u3092\u78ba\u8a8d\u3067\u304d\u305f\u308a\u3068\n\u30bd\u30fc\u30b9\u3082\u591a\u304f\u8ee2\u304c\u3063\u3066\u3044\u3066\u53d6\u308a\u7d44\u307f\u3084\u3059\u3044\u306e\u3067\u306f\u306a\u3044\u3067\u3057\u3087\u3046\u304b\u3002  \n\nInfrastracture as code \u306e\u7aef\u3063\u3053\u306b\u307b\u3093\u306e\u3061\u3087\u3063\u3068\u3067\u3082\u89e6\u308c\u308b\u624b\u52a9\u3051\u3068\u306a\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\u30dc\u30ea\u30e5\u30fc\u30df\u30fc\u306b\u306a\u308a\u3059\u304e\u3066\u3057\u307e\u3044\u7533\u3057\u8a33\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\n", "tags": ["ARM", "\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8", "VirtualMachineScaleSet"]}