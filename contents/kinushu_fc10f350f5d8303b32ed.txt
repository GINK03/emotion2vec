{"context": " More than 1 year has passed since last update.\u30a8\u30e9\u30fc\u51e6\u7406\u3001\u5927\u898f\u6a21\u306e\u3082\u306e\u306b\u3064\u3044\u3066\u306e\u5bfe\u5fdc\u306f\u7279\u306b\u3057\u3066\u3044\u307e\u305b\u3093\u3002\n\u3042\u307e\u308a\u7dba\u9e97\u3067\u306f\u306a\u3044\u3002\n\u3068\u308a\u3042\u3048\u305a\u3001\u958b\u767a\u6e96\u5099\u7528\n\npg_export.rb\n\nrequire 'csv'\nrequire 'pg'\nrequire 'uri'\nrequire \"json\"\nrequire \"yaml\"\n\n# PostgreSQL \u306e\u6307\u5b9aDB,\u30c6\u30fc\u30d6\u30eb\u3092\u5168\u3066CSV,YAML,JSON\u5316\u3059\u308b\u3002\n# \u5168\u3066\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u6587\u5b57\u5217\u3068\u3057\u3066\u3001\u6539\u884c\u30b3\u30fc\u30c9\u306f\\r\\n\u306b\u5909\u63db\u3057\u3066\u51fa\u529b\u3059\u308b\n\n# \u3053\u3061\u3089\u306b DB, \u30c6\u30fc\u30d6\u30eb \u3092\u6307\u5b9a\u3059\u308b\ndb_attrs = {\n  'dbname' => [\n    \"tblname\",\n    \"tblname2\",\n    ],\n}\n\ndef puts_db_csv(f,db_name,table_name)\n  # Output a table of current connections to the DB\n  conn = PG.connect( dbname: db_name )\n  conn.exec( \"SELECT * FROM #{table_name}\" ) do |result|\n    result.each_with_index do |row, i|\n      # 1\u884c\u76ee\u306e\u524d\u306b\u30ad\u30fc\u5217\u3092\u51fa\u529b\u3057\u3066\u304a\u304f\n      if i == 0\n        k_arr = []\n        row.each do |k,v|\n          k_arr << k.inspect\n        end\n        f.puts k_arr.join(\",\")\n      end\n\n      row_arr = []\n      row.each do |k,v|\n        v ||= \"\"\n        v_enc = v.inspect\n        row_arr << v_enc\n      end\n      f.puts row_arr.join(\",\")\n    end\n  end\nend\n\ndef puts_db_json(f,db_name,table_name)\n  conn = PG.connect( dbname: db_name )\n  conn.exec( \"SELECT * FROM #{table_name}\" ) do |result|\n    results = []\n    result.each_with_index do |row, i|\n      results.push(row)\n    end\n\n    f.puts JSON.pretty_generate(results)\n  end\nend\n\ndef puts_db_yml(f,db_name,table_name)\n  conn = PG.connect( dbname: db_name )\n  conn.exec( \"SELECT * FROM #{table_name}\" ) do |result|\n    results = []\n    result.each_with_index do |row, i|\n      results.push(row)\n    end\n\n    f.puts YAML.dump(results)\n  end\nend\n\ndef export_db_format(format, db_name,table_name)\n  output_file_name = \"#{db_name}_#{table_name}.#{format.to_s}\"\n  open(output_file_name,\"wt\") do |f|\n    func_name = \"puts_db_#{format.to_s}\"\n    send(func_name, f, db_name, table_name)\n  end\nend\n\n# 3format\u307e\u3068\u3081\u3066\u51fa\u529b\ndb_attrs.each do |db_name, table_names|\n  table_names.each do |table_name|\n    export_db_format(:csv, db_name, table_name)\n    export_db_format(:json, db_name, table_name)\n    export_db_format(:yml, db_name, table_name)\n  end\nend\n\n\n\n\n\u30a8\u30e9\u30fc\u51e6\u7406\u3001\u5927\u898f\u6a21\u306e\u3082\u306e\u306b\u3064\u3044\u3066\u306e\u5bfe\u5fdc\u306f\u7279\u306b\u3057\u3066\u3044\u307e\u305b\u3093\u3002\n\u3042\u307e\u308a\u7dba\u9e97\u3067\u306f\u306a\u3044\u3002\n\u3068\u308a\u3042\u3048\u305a\u3001\u958b\u767a\u6e96\u5099\u7528\n\n``` pg_export.rb\n\nrequire 'csv'\nrequire 'pg'\nrequire 'uri'\nrequire \"json\"\nrequire \"yaml\"\n\n# PostgreSQL \u306e\u6307\u5b9aDB,\u30c6\u30fc\u30d6\u30eb\u3092\u5168\u3066CSV,YAML,JSON\u5316\u3059\u308b\u3002\n# \u5168\u3066\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u6587\u5b57\u5217\u3068\u3057\u3066\u3001\u6539\u884c\u30b3\u30fc\u30c9\u306f\\r\\n\u306b\u5909\u63db\u3057\u3066\u51fa\u529b\u3059\u308b\n\n# \u3053\u3061\u3089\u306b DB, \u30c6\u30fc\u30d6\u30eb \u3092\u6307\u5b9a\u3059\u308b\ndb_attrs = {\n  'dbname' => [\n    \"tblname\",\n    \"tblname2\",\n    ],\n}\n\ndef puts_db_csv(f,db_name,table_name)\n  # Output a table of current connections to the DB\n  conn = PG.connect( dbname: db_name )\n  conn.exec( \"SELECT * FROM #{table_name}\" ) do |result|\n    result.each_with_index do |row, i|\n      # 1\u884c\u76ee\u306e\u524d\u306b\u30ad\u30fc\u5217\u3092\u51fa\u529b\u3057\u3066\u304a\u304f\n      if i == 0\n        k_arr = []\n        row.each do |k,v|\n          k_arr << k.inspect\n        end\n        f.puts k_arr.join(\",\")\n      end\n\n      row_arr = []\n      row.each do |k,v|\n        v ||= \"\"\n        v_enc = v.inspect\n        row_arr << v_enc\n      end\n      f.puts row_arr.join(\",\")\n    end\n  end\nend\n\ndef puts_db_json(f,db_name,table_name)\n  conn = PG.connect( dbname: db_name )\n  conn.exec( \"SELECT * FROM #{table_name}\" ) do |result|\n    results = []\n    result.each_with_index do |row, i|\n      results.push(row)\n    end\n\n    f.puts JSON.pretty_generate(results)\n  end\nend\n\ndef puts_db_yml(f,db_name,table_name)\n  conn = PG.connect( dbname: db_name )\n  conn.exec( \"SELECT * FROM #{table_name}\" ) do |result|\n    results = []\n    result.each_with_index do |row, i|\n      results.push(row)\n    end\n\n    f.puts YAML.dump(results)\n  end\nend\n\ndef export_db_format(format, db_name,table_name)\n  output_file_name = \"#{db_name}_#{table_name}.#{format.to_s}\"\n  open(output_file_name,\"wt\") do |f|\n    func_name = \"puts_db_#{format.to_s}\"\n    send(func_name, f, db_name, table_name)\n  end\nend\n\n# 3format\u307e\u3068\u3081\u3066\u51fa\u529b\ndb_attrs.each do |db_name, table_names|\n  table_names.each do |table_name|\n    export_db_format(:csv, db_name, table_name)\n    export_db_format(:json, db_name, table_name)\n    export_db_format(:yml, db_name, table_name)\n  end\nend\n\n```\n", "tags": ["Ruby", "PostgreSQL", "CSV", "YAML", "JSON"]}