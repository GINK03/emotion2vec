{"context": "\u5099\u5fd8\u9332\u3002\n\u304b\u306a\u308a\u9069\u5f53\u306a\u306e\u3067\u3001\u30c4\u30c3\u30b3\u30df\u5927\u6b53\u8fce\u3067\u3059\u3002\n\n1. IAM\u3067EC2\u7528\u30ed\u30fc\u30eb\u4f5c\u6210\u3057\u3066EC2\u306b\u8a2d\u5b9a\n\n\u4f5c\u6210\u3059\u308b\u30ed\u30fc\u30eb\u306e\u30bf\u30a4\u30d7\u306fEC2\u3001\u30dd\u30ea\u30b7\u30fc\u306fAmazonS3ReadOnlyAccess\u306e\u307f\u3002\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u6642\u3067\u306a\u3044\u3068\u30ed\u30fc\u30eb\u306f\u8a2d\u5b9a\u3067\u304d\u306a\u3044\u3002\n\u306a\u306e\u3067\u65e2\u306bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u306f\u3001\u4f5c\u308a\u306a\u304a\u3059\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n\n2. EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bCodeDeploy Agent\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\n\nbash\nsudo yum update\nsudo yum install aws-cli -y\ncd /home/ec2-user\naws s3 cp s3://aws-codedeploy-ap-northeast-1/latest/install . --region ap-northeast-1\nchmod +x ./install\nsudo ./install auto\n\n\n\n3. IAM\u3067CodeDeploy\u7528\u30ed\u30fc\u30eb\u4f5c\u6210\n\u8a2d\u5b9a\u3059\u308b\u30bf\u30a4\u30d7\u306fCodeDeploy\u3001\u30dd\u30ea\u30b7\u30fc\u306f\u4e0b\u8a18URL\u53c2\u7167\u3002\nhttp://docs.aws.amazon.com/codedeploy/latest/userguide/how-to-create-service-role.html\n\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u5834\u5408\u306f\u3001\u3068\u308a\u3042\u3048\u305aAWSCodeDeployFullAccess\u3092\u8a2d\u5b9a\u3059\u308c\u3070\u52d5\u304f\u3002\n\n4. CodeDeploy\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u4f5c\u6210\n\n\u65b0\u3057\u3044\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3059\u308b\n\u30bf\u30b0\u306fEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u6307\u5b9a\n\u30c7\u30d7\u30ed\u30a4\u8a2d\u5b9a\u306f\u4efb\u610f\u306e\u3082\u306e\u3092\u9078\u3076\n\u30b5\u30fc\u30d3\u30b9\u30ed\u30fc\u30eb\u306b\u306f\u524d\u8ff0\u306eCodeDeploy\u7528\u30ed\u30fc\u30eb\u3092\u6307\u5b9a\n\n\n5. GitHub\u3067\u30ea\u30dd\u30b8\u30c8\u30ea\u4f5c\u6210\n\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30ea\u30dd\u30b8\u30c8\u30ea\u3067\u3082OK\u3002\n\n6. circle.yml\u8a2d\u5b9a\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u30eb\u30fc\u30c8\u306bcircle.yml\u3092\u8ffd\u52a0\u3057\u3066\u4e0b\u8a18\u306e\u3088\u3046\u306b\u8a2d\u5b9a\uff08\u30b3\u30e1\u30f3\u30c8\u8981\u524a\u9664\uff09\n\n\ncircle.yml\nmachine: # \u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u3084\u8a00\u8a9e\u30d0\u30fc\u30b8\u30e7\u30f3\u8a2d\u5b9a\u306a\u3069\n    timezone: Asia/Tokyo\n    node:\n        version: 5.2.0\n    post:\n        - npm install -g npm@3.3.12\ndependencies: # \u4f9d\u5b58\u30e9\u30a4\u30d6\u30e9\u30ea\u7b49\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3001\u30d3\u30eb\u30c9\n    post:\n        - npm run build\ndeployment: # \u30c7\u30d7\u30ed\u30a4\u8a2d\u5b9a\n    staging: # \u4efb\u610f\u306e\u6587\u5b57\u5217\n        branch: master # \u30d6\u30e9\u30f3\u30c1\u540d\n        codedeploy:\n            app_app_app: # CodeDeploy\u3067\u4f5c\u6210\u3057\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u540d\n                deployment_group: group_group_group # CodeDeploy\u3067\u4f5c\u6210\u3057\u305f\u30c7\u30d7\u30ed\u30a4\u30b0\u30eb\u30fc\u30d7\u540d\n                application_root: /public # \u30c7\u30d7\u30ed\u30a4\u3057\u305f\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n                region: ap-northeast-1\n                revision_location:\n                    revision_type: S3\n                    s3_location:\n                        bucket: xxxxxx # \u30d0\u30b1\u30c3\u30c8\u540d\n                        key_pattern: '{BUILD_NUM}_{COMMIT}.zip'\n\n\n\n7. appspec.yml\u8a2d\u5b9a\n\n\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30eb\u30fc\u30c8\u306bappspec.yml\u3092\u8ffd\u52a0\u3057\u3066\u4e0b\u8a18\u306e\u3088\u3046\u306b\u8a2d\u5b9a\uff08\u30b3\u30e1\u30f3\u30c8\u8981\u524a\u9664\uff09\n\n\nappspec.yml\nversion: 0.0\nos: linux\nfiles:\n   - source: / # \u30d5\u30a1\u30a4\u30eb\u53c2\u7167\u5143\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30d1\u30b9\n     destination: /var/www/dest_dest_dest/ # \u30d5\u30a1\u30a4\u30eb\u30b3\u30d4\u30fc\u5148\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30d1\u30b9\nhooks:\n    BeforeInstall: # \u30d5\u30a1\u30a4\u30eb\u30b3\u30d4\u30fc\u524d\u306b\u5b9f\u884c\u3059\u308b\u5185\u5bb9\n        - location: before_install.sh # \u30d5\u30a1\u30a4\u30eb\u524a\u9664\u3068\u304b\n\n\n\n8. IAM\u3067CircleCI\u7528\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\n\u8a2d\u5b9a\u3059\u308b\u30bf\u30a4\u30d7\u306fCodeDeploy\u3001\u30dd\u30ea\u30b7\u30fc\u306f\u4e0b\u8a18URL\u53c2\u7167\u3002\nhttp://jedipunkz.github.io/blog/2015/11/15/circleci-codedeploy/\n\u3088\u304f\u5206\u304b\u3089\u306a\u3044\u5834\u5408\u306f\u3001\u3068\u308a\u3042\u3048\u305aAWSCodeDeployFullAccess\u3068AmazonS3FullAccess\u3092\u8a2d\u5b9a\u3059\u308c\u3070\u52d5\u304f\u3002\n\n9. CircleCI\u3067\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u8ffd\u52a0\n\n\nAdd Projects\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4e00\u89a7\u753b\u9762\u306b\u9077\u79fb\nGitHub\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u9078\u629e\u3059\u308b\n\nBuild Project\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u8ffd\u52a0\u3067\u304d\u308b\n\n\n10. CircleCI\u306bIAM\u30e6\u30fc\u30b6\u30fc\u3092\u7d10\u4ed8\u3051\n\n\nBuilds\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u30d3\u30eb\u30c9\u4e00\u89a7\u753b\u9762\u306b\u9077\u79fb\n\u3055\u3063\u304d\u4f5c\u3063\u305f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u9078\u629e\n\nProject Settings\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u8a2d\u5b9a\u753b\u9762\u306b\u9077\u79fb\n\nAWS Permissions\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066AWS\u6a29\u9650\u8a2d\u5b9a\u753b\u9762\u306b\u9077\u79fb\n\u3055\u3063\u304d\u4f5c\u3063\u305fCircleCI\u7528\u30e6\u30fc\u30b6\u30fc\u306e\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3092\u5165\u529b\uff08\u30e6\u30fc\u30b6\u30fc\u540d\u3067\u306f\u306a\u3044\u306e\u3067\u6ce8\u610f\uff09\n\nSave AWS Keys\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u4fdd\u5b58\n\n\n11. GitHub\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306bpush\npush\u3059\u308b\u3068\u4e00\u9023\u306e\u30c7\u30d7\u30ed\u30a4\u304c\u5b9f\u884c\u3055\u308c\u308b\u306e\u3067CircleCI\u3067\u78ba\u8a8d\u3059\u308b\n\n12. \u5b8c\u4e86\n\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\n\u5099\u5fd8\u9332\u3002\n\u304b\u306a\u308a\u9069\u5f53\u306a\u306e\u3067\u3001\u30c4\u30c3\u30b3\u30df\u5927\u6b53\u8fce\u3067\u3059\u3002\n\n\n\n## 1. IAM\u3067EC2\u7528\u30ed\u30fc\u30eb\u4f5c\u6210\u3057\u3066EC2\u306b\u8a2d\u5b9a\n\n* \u4f5c\u6210\u3059\u308b\u30ed\u30fc\u30eb\u306e\u30bf\u30a4\u30d7\u306fEC2\u3001\u30dd\u30ea\u30b7\u30fc\u306f`AmazonS3ReadOnlyAccess`\u306e\u307f\u3002\n* EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u6642\u3067\u306a\u3044\u3068\u30ed\u30fc\u30eb\u306f\u8a2d\u5b9a\u3067\u304d\u306a\u3044\u3002\n* \u306a\u306e\u3067\u65e2\u306bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u306f\u3001\u4f5c\u308a\u306a\u304a\u3059\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n\n\n## 2. EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bCodeDeploy Agent\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\n\n```bash:bash\nsudo yum update\nsudo yum install aws-cli -y\ncd /home/ec2-user\naws s3 cp s3://aws-codedeploy-ap-northeast-1/latest/install . --region ap-northeast-1\nchmod +x ./install\nsudo ./install auto\n```\n\n\n\n## 3. IAM\u3067CodeDeploy\u7528\u30ed\u30fc\u30eb\u4f5c\u6210\n\n\u8a2d\u5b9a\u3059\u308b\u30bf\u30a4\u30d7\u306fCodeDeploy\u3001\u30dd\u30ea\u30b7\u30fc\u306f\u4e0b\u8a18URL\u53c2\u7167\u3002\nhttp://docs.aws.amazon.com/codedeploy/latest/userguide/how-to-create-service-role.html\n\n\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u5834\u5408\u306f\u3001\u3068\u308a\u3042\u3048\u305a`AWSCodeDeployFullAccess`\u3092\u8a2d\u5b9a\u3059\u308c\u3070\u52d5\u304f\u3002\n\n\n\n## 4. CodeDeploy\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u4f5c\u6210\n\n* \u65b0\u3057\u3044\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3059\u308b\n* \u30bf\u30b0\u306fEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u6307\u5b9a\n* \u30c7\u30d7\u30ed\u30a4\u8a2d\u5b9a\u306f\u4efb\u610f\u306e\u3082\u306e\u3092\u9078\u3076\n* \u30b5\u30fc\u30d3\u30b9\u30ed\u30fc\u30eb\u306b\u306f\u524d\u8ff0\u306eCodeDeploy\u7528\u30ed\u30fc\u30eb\u3092\u6307\u5b9a\n\n\n\n## 5. GitHub\u3067\u30ea\u30dd\u30b8\u30c8\u30ea\u4f5c\u6210\n\n\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30ea\u30dd\u30b8\u30c8\u30ea\u3067\u3082OK\u3002\n\n\n\n## 6. circle.yml\u8a2d\u5b9a\n\n* \u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u30eb\u30fc\u30c8\u306b`circle.yml`\u3092\u8ffd\u52a0\u3057\u3066\u4e0b\u8a18\u306e\u3088\u3046\u306b\u8a2d\u5b9a\uff08\u30b3\u30e1\u30f3\u30c8\u8981\u524a\u9664\uff09\n\n```yaml:circle.yml\nmachine: # \u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u3084\u8a00\u8a9e\u30d0\u30fc\u30b8\u30e7\u30f3\u8a2d\u5b9a\u306a\u3069\n    timezone: Asia/Tokyo\n    node:\n        version: 5.2.0\n    post:\n        - npm install -g npm@3.3.12\ndependencies: # \u4f9d\u5b58\u30e9\u30a4\u30d6\u30e9\u30ea\u7b49\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3001\u30d3\u30eb\u30c9\n    post:\n        - npm run build\ndeployment: # \u30c7\u30d7\u30ed\u30a4\u8a2d\u5b9a\n    staging: # \u4efb\u610f\u306e\u6587\u5b57\u5217\n        branch: master # \u30d6\u30e9\u30f3\u30c1\u540d\n        codedeploy:\n            app_app_app: # CodeDeploy\u3067\u4f5c\u6210\u3057\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u540d\n                deployment_group: group_group_group # CodeDeploy\u3067\u4f5c\u6210\u3057\u305f\u30c7\u30d7\u30ed\u30a4\u30b0\u30eb\u30fc\u30d7\u540d\n                application_root: /public # \u30c7\u30d7\u30ed\u30a4\u3057\u305f\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n                region: ap-northeast-1\n                revision_location:\n                    revision_type: S3\n                    s3_location:\n                        bucket: xxxxxx # \u30d0\u30b1\u30c3\u30c8\u540d\n                        key_pattern: '{BUILD_NUM}_{COMMIT}.zip'\n```\n\n\n\n## 7. appspec.yml\u8a2d\u5b9a\n\n* \u30c7\u30d7\u30ed\u30a4\u3057\u305f\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30eb\u30fc\u30c8\u306b`appspec.yml`\u3092\u8ffd\u52a0\u3057\u3066\u4e0b\u8a18\u306e\u3088\u3046\u306b\u8a2d\u5b9a\uff08\u30b3\u30e1\u30f3\u30c8\u8981\u524a\u9664\uff09\n\n```yaml:appspec.yml\nversion: 0.0\nos: linux\nfiles:\n   - source: / # \u30d5\u30a1\u30a4\u30eb\u53c2\u7167\u5143\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30d1\u30b9\n     destination: /var/www/dest_dest_dest/ # \u30d5\u30a1\u30a4\u30eb\u30b3\u30d4\u30fc\u5148\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30d1\u30b9\nhooks:\n    BeforeInstall: # \u30d5\u30a1\u30a4\u30eb\u30b3\u30d4\u30fc\u524d\u306b\u5b9f\u884c\u3059\u308b\u5185\u5bb9\n        - location: before_install.sh # \u30d5\u30a1\u30a4\u30eb\u524a\u9664\u3068\u304b\n```\n\n\n\n## 8. IAM\u3067CircleCI\u7528\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\n\n\u8a2d\u5b9a\u3059\u308b\u30bf\u30a4\u30d7\u306fCodeDeploy\u3001\u30dd\u30ea\u30b7\u30fc\u306f\u4e0b\u8a18URL\u53c2\u7167\u3002\nhttp://jedipunkz.github.io/blog/2015/11/15/circleci-codedeploy/\n\n\u3088\u304f\u5206\u304b\u3089\u306a\u3044\u5834\u5408\u306f\u3001\u3068\u308a\u3042\u3048\u305a`AWSCodeDeployFullAccess`\u3068`AmazonS3FullAccess`\u3092\u8a2d\u5b9a\u3059\u308c\u3070\u52d5\u304f\u3002\n\n\n\n## 9. CircleCI\u3067\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u8ffd\u52a0\n\n* `Add Projects`\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4e00\u89a7\u753b\u9762\u306b\u9077\u79fb\n* GitHub\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u9078\u629e\u3059\u308b\n* `Build Project`\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u8ffd\u52a0\u3067\u304d\u308b\n\n\n\n## 10. CircleCI\u306bIAM\u30e6\u30fc\u30b6\u30fc\u3092\u7d10\u4ed8\u3051\n\n* `Builds`\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u30d3\u30eb\u30c9\u4e00\u89a7\u753b\u9762\u306b\u9077\u79fb\n* \u3055\u3063\u304d\u4f5c\u3063\u305f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u9078\u629e\n* `Project Settings`\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u8a2d\u5b9a\u753b\u9762\u306b\u9077\u79fb\n* `AWS Permissions`\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066AWS\u6a29\u9650\u8a2d\u5b9a\u753b\u9762\u306b\u9077\u79fb\n* \u3055\u3063\u304d\u4f5c\u3063\u305fCircleCI\u7528\u30e6\u30fc\u30b6\u30fc\u306e\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3092\u5165\u529b\uff08\u30e6\u30fc\u30b6\u30fc\u540d\u3067\u306f\u306a\u3044\u306e\u3067\u6ce8\u610f\uff09\n* `Save AWS Keys`\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u4fdd\u5b58\n\n\n\n## 11. GitHub\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306bpush\n\npush\u3059\u308b\u3068\u4e00\u9023\u306e\u30c7\u30d7\u30ed\u30a4\u304c\u5b9f\u884c\u3055\u308c\u308b\u306e\u3067CircleCI\u3067\u78ba\u8a8d\u3059\u308b\n\n\n\n## 12. \u5b8c\u4e86\n\n\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\n", "tags": ["CircleCI", "CodeDeploy", "S3", "EC2", "GitHub"]}