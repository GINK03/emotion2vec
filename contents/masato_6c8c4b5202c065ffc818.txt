{"context": " More than 1 year has passed since last update.Netatmo \u30a6\u30a7\u30b6\u30fc\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u4f7f\u3046\u3068\u3001\u5c4b\u5185\u3084\u5c4b\u5916\u306b\u8a2d\u7f6e\u3057\u305f\u30e2\u30b8\u30e5\u30fc\u30eb\u304b\u3089\u7c21\u5358\u306b\u74b0\u5883\u30c7\u30fc\u30bf\u3092\u8a08\u6e2c\u3057\u3066\u3001\u30b9\u30de\u30db\u3084\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u30d6\u30e9\u30a6\u30b6\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u304b\u3089\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u8a08\u6e2c\u3067\u304d\u308b\u30c7\u30fc\u30bf\u306f\u6c17\u6e29\u3001\u6e7f\u5ea6\u3001\u6c17\u5727\u3001\u4e8c\u9178\u5316\u70ad\u7d20\u6fc3\u5ea6\u3001\u9a12\u97f3\u306a\u3069\u3067\u3059\u3002myThings\u306b\u3082\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\u30aa\u30d5\u30a3\u30b7\u30e3\u30eb\u3067\u306fAPI\u3092\u4f7f\u3046\u305f\u3081\u306eSDK\u306fPHP\u3001Objective-C\u3001Windows8\u3001Android\u7528\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u30fc\u30d9\u30fc\u30b9\u3067\u3059\u304c\u3001Node.js\u7528\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3082GitHub\u306b\u30ea\u30dd\u30b8\u30c8\u30ea\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u3053\u3061\u3089\u3092\u4f7f\u3063\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\nNetatmo\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\u5ba4\u5185\uff06\u5c4b\u5916\u306e\u6c17\u6e29\u30fb\u6e7f\u5ea6\u30fbCO2\u7b49\u3092\u8a08\u6e2c\u3057\u3066\u8a73\u7d30\u306a\u5929\u6c17\u60c5\u5831\u3092\u51fa\u3057\u3066\u304f\u308c\u308b\u300cnetatmo \u30a6\u30a7\u30b6\u30fc\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\uff06\u96e8\u91cf\u8a08\u300d\u30ec\u30d3\u30e5\u30fc\u304c\u5199\u771f\u5165\u308a\u3067\u89e3\u8aac\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3059\u3002\u307e\u305f\u3001\u30b9\u30de\u30db\u30a2\u30d7\u30ea\u306e\u30ac\u30a4\u30c9\u3082\u4e01\u5be7\u3067\u308f\u304b\u308a\u3084\u3059\u3044\u306e\u3067\u3001\u30a2\u30d7\u30ea\u3092\u64cd\u4f5c\u3057\u3066\u3044\u304f\u3060\u3051\u3067\u3082\u7c21\u5358\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30b5\u30a4\u30f3\u30a2\u30c3\u30d7\niPhone\u306e\u5834\u5408\u306fWeather Station by Netatmo\u3001Android\u306f\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3 Netatmo\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3001Netatmo\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7etatmo\u306b\u30b5\u30a4\u30f3\u30a2\u30c3\u30d7\u3057\u307e\u3059\u3002\n\n\u5c4b\u5916\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u7f6e\n\u5c4b\u5916\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u96fb\u6c60\u3092\u3092\u30bb\u30c3\u30c8\u3057\u307e\u3059\u3002\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u306fMicro USB\u30b1\u30fc\u30d6\u30eb\u3067\u96fb\u6e90\u30d7\u30e9\u30b0\u306b\u63a5\u7d9a\u3057\u307e\u3059\u3002\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u4e0a\u90e8\u3092\u30bf\u30c3\u30c1\u3057\u3066\u5074\u9762\u304c\u9752\u8272\u306b\u70b9\u6ec5\u3055\u305b\u307e\u3059\u3002\n\n\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u306eWi-Fi\u8a2d\u5b9a\n\u30b9\u30de\u30db\u30a2\u30d7\u30ea\u304b\u3089\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u306bBluetooth\u3067\u30da\u30a2\u30ea\u30f3\u30b0\u3057\u305f\u3042\u3068\u3001\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u306bWi-Fi\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3092\u884c\u3044\u307e\u3059\u3002\u63a5\u7d9a\u306b\u6210\u529f\u3059\u308b\u3068\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u3092Netatmo\u306b\u767b\u9332\u3057\u3066\u7d42\u4e86\u3057\u307e\u3059\u3002\n\n\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u30d6\u30e9\u30a6\u30b6\n\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\u30a6\u30a7\u30b6\u30fc\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u30da\u30fc\u30b8\u3092\u958b\u304f\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n\nAPI\u3092\u4f7f\u3046\u6e96\u5099\nAPI\u3092\u4f7f\u3063\u305f\u30b5\u30f3\u30d7\u30eb\u306f\u3001Netatmo \u30a6\u30a7\u30b6\u30fc\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u8cb7\u3063\u3066\u307f\u305f\u306e\u3067 Node.js \u3067\u3044\u3058\u3063\u3066\u307f\u305f\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\u8a66\u3057\u3066\u307f\u305f\u3044Node.js\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u4f8b\u306a\u306e\u3067\u52a9\u304b\u308a\u307e\u3057\u305f\u3002\n\n\u30a2\u30d7\u30ea\u306e\u767b\u9332\nNetatmo Developers\u306e\u30da\u30fc\u30b8\u3092\u958b\u3044\u3066\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\u4e0a\u30e1\u30cb\u30e5\u30fc\u306bDOCUMENTATION\u3068CREATE AN APPLICATION\u306a\u3069\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u3002CREATE AN APPLICATION\u306e\u30da\u30fc\u30b8\u3092\u958b\u304d\u300cName\u300d\u3068\u300cDescription\u300d\u306b\u9069\u5f53\u306a\u540d\u524d\u3092\u3064\u3051\u3066\u767b\u9332\u3059\u308b\u3068\u3001Client id\u3068Client secret\u304c\u767a\u884c\u3055\u308c\u307e\u3059\u3002API\u3067\u306f\u3053\u306eid\u3068secret\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n\nNode.js\u306e\u30b5\u30f3\u30d7\u30eb\nNode.js\u306enetatmo\u3092\u5229\u7528\u3057\u3066API\u3092\u4f7f\u3063\u305f\u30b5\u30f3\u30d7\u30eb\u3092\u66f8\u3044\u3066\u307f\u307e\u3059\u3002\u30ea\u30dd\u30b8\u30c8\u30ea\u306f\u3053\u3061\u3089\u3067\u3059\u3002\u4eca\u56de\u3082\u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u306bio.js\u306e3.2\u3092\u5229\u7528\u3057\u3066Docker Compose\u304b\u3089\u69cb\u6210\u7ba1\u7406\u3057\u307e\u3059\u3002\n\ndocker-compose.yml\ndocker-compose.yml.default\u30d5\u30a1\u30a4\u30eb\u3092docker-compose.yml\u306b\u30ea\u30cd\u30fc\u30e0\u3057\u3066\u304b\u3089\u74b0\u5883\u5909\u6570\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\nCLIENT_ID: \u4f5c\u6210\u3057\u305f\u30a2\u30d7\u30ea\u306eClient id\nCLIENT_SECRET: \u4f5c\u6210\u3057\u305f\u30a2\u30d7\u30ea\u306eClient secret\nUSERNAME: netatmo\u306b\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u540d\nPASSWORD: netatmo\u306b\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u30d1\u30b9\u30ef\u30fc\u30c9\u540d\nINTERVAL: 1800000(30\u5206)\u3001 netatmo\u304b\u3089\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u611f\u899a\n\n\n~/node_apps/docker-netatmo/docker-compose.yml.default\nnetatmo:\n  build: .\n  volumes:\n    - .:/app\n    - /etc/localtime:/etc/localtime:ro\n  environment:\n    - CLIENT_ID=\n    - CLIENT_SECRET=\n    - USERNAME=\n    - PASSWORD=\n    - INTERVAL=1800000\n  ports:\n    - 3033:3000\n\n\n\napp.js\nNetatomo\u306b\u306fGETMEASURE\u3068\u3044\u3046API\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u30c7\u30d0\u30a4\u30b9(\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3)\u3068\u30e2\u30b8\u30e5\u30fc\u30eb(\u5c4b\u5916\u30e2\u30b8\u30e5\u30fc\u30eb)\u306e\u3069\u3061\u3089\u304b\u3057\u304b\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3067\u304d\u306a\u3044\u3088\u3046\u3067\u3059\u3002\u89aa\u5b50\u95a2\u4fc2\u3092\u7d10\u4ed8\u3051\u308bid\u3092\u3064\u304b\u3063\u3066\u4e00\u3064\u306eJSON\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u307e\u3068\u3081\u3066\u307f\u307e\u3057\u305f\u3002\n\u307e\u305f\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u306etype\u30d5\u30a3\u30fc\u30eb\u30c9\u304cNAModule4\u306e\u5834\u5408\u306f\u8ffd\u52a0\u306e\u5c4b\u5185\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u3061\u3089\u306fCO2\u3092\u691c\u51fa\u3067\u304d\u308b\u306e\u3067\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n~/node_apps/docker-netatmo/app.js\n\"use strict\";\n\nvar netatmo = require('netatmo'),\n    async = require('async'),\n    _ = require('lodash'),\n    moment = require('moment-timezone'),\n    api = new netatmo({\n        'client_id': process.env.CLIENT_ID,\n        'client_secret': process.env.CLIENT_SECRET,\n        'username': process.env.USERNAME,\n        'password': process.env.PASSWORD,\n    });\n\nfunction getMyDevices(deviceIds, devices, modules, callback) {\n    var myDevices = _.map(deviceIds, function(id) {\n        return {\n            device: _.find(devices, function(device) {\n                return id == device._id;\n            }),\n            modules: _.filter(modules, function(module) {\n                return id == module.main_device;\n            })\n        };\n    });\n    callback(null, myDevices);\n}\n\nfunction toJST(time_utc) {\n  return moment(time_utc, 'X').tz(\"Asia/Tokyo\").format();\n}\n\nfunction pluckDevice(device) {\n    return {\n        module_name: device.module_name,\n        time_utc: toJST(device.dashboard_data.time_utc),\n        noise: device.dashboard_data.Noise,\n        temperature: device.dashboard_data.Temperature,\n        humidity: device.dashboard_data.Humidity,\n        pressure: device.dashboard_data.Pressure,\n        co2: device.dashboard_data.CO2\n    };\n}\n\nfunction pluckModule(module) {\n    var retval = {\n        module_name: module.module_name,\n        time_utc: toJST(module.dashboard_data.time_utc),\n        temperature: module.dashboard_data.Temperature,\n        humidity: module.dashboard_data.Humidity\n    };\n    // for the additionnal indoor module\n    // https://dev.netatmo.com/doc/methods/devicelist\n    if (module.type == 'NAModule4'){\n        retval[co2] = module.dashboard_data.CO2;\n    }\n    return retval;\n}\n\nfunction resultsOut(results) {\n    _.forEach(results, function(result) {\n        console.log(pluckDevice(result.device));\n        _.forEach(result.modules, function(module) {\n            console.log(pluckModule(module));\n        });\n    });\n}\n\nfunction measure(callback) {\n    async.waterfall([\n        function(callback) {\n            api.getUser(callback);\n        },\n        function(user, callback) {\n            api.getDevicelist(function(err, devices, modules) {\n                if (err) return callback(err);\n                getMyDevices(user.devices,\n                             devices, modules,\n                             callback);\n            });\n        }], function(err, results) {\n            if (err) return console.log(err);\n            resultsOut(results);\n            console.log('----');\n            setTimeout(callback, process.env.INTERVAL);\n        });\n}\n\nasync.forever( measure, function(err) {\n    if(err) console.log(err);\n});\n\n\n\n\u5b9f\u884c\n\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5b9f\u884c\u3059\u308b\u3068\u74b0\u5883\u5909\u6570INTERVAL\u306b\u5b9a\u7fa9\u3057\u305f\u9593\u9694(1800000\u30df\u30ea\u79d2=30\u5206)\u3067Netatomo\u304b\u3089\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3066\u6a19\u6e96\u51fa\u529b\u3057\u307e\u3059\u3002\u672c\u4f53\u3068\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30bb\u30f3\u30b7\u30f3\u30b0\u6642\u9593\u306f\u5b8c\u5168\u306b\u4e00\u81f4\u306f\u3057\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n$ docker-compose up netatmo\n...\nnetatmo_1 | npm info it worked if it ends with ok\nnetatmo_1 | npm info using npm@2.13.3\nnetatmo_1 | npm info using node@v3.2.0\nnetatmo_1 | npm info prestart netatmo-docker@0.0.1\nnetatmo_1 | npm info start netatmo-docker@0.0.1\nnetatmo_1 |\nnetatmo_1 | > netatmo-docker@0.0.1 start /app\nnetatmo_1 | > node app.js\nnetatmo_1 |\nnetatmo_1 | { module_name: '\u30ea\u30d3\u30f3\u30b0',\nnetatmo_1 |   time_jst: '2015-08-31T09:34:30+09:00',\nnetatmo_1 |   noise: 38,\nnetatmo_1 |   temperature: 24.5,\nnetatmo_1 |   humidity: 84,\nnetatmo_1 |   pressure: 1081.7,\nnetatmo_1 |   co2: 395 }\nnetatmo_1 | { module_name: '\u30d9\u30e9\u30f3\u30c0',\nnetatmo_1 |   time_jst: '2015-08-31T09:34:28+09:00',\nnetatmo_1 |   temperature: 22.9,\nnetatmo_1 |   humidity: 86 }\nnetatmo_1 | ----\n\nNetatmo \u30a6\u30a7\u30b6\u30fc\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u4f7f\u3046\u3068\u3001\u5c4b\u5185\u3084\u5c4b\u5916\u306b\u8a2d\u7f6e\u3057\u305f\u30e2\u30b8\u30e5\u30fc\u30eb\u304b\u3089\u7c21\u5358\u306b\u74b0\u5883\u30c7\u30fc\u30bf\u3092\u8a08\u6e2c\u3057\u3066\u3001\u30b9\u30de\u30db\u3084\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u30d6\u30e9\u30a6\u30b6\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u304b\u3089\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u8a08\u6e2c\u3067\u304d\u308b\u30c7\u30fc\u30bf\u306f\u6c17\u6e29\u3001\u6e7f\u5ea6\u3001\u6c17\u5727\u3001\u4e8c\u9178\u5316\u70ad\u7d20\u6fc3\u5ea6\u3001\u9a12\u97f3\u306a\u3069\u3067\u3059\u3002[myThings](http://mythings.yahoo.co.jp/)\u306b\u3082\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\u30aa\u30d5\u30a3\u30b7\u30e3\u30eb\u3067\u306f[API](https://dev.netatmo.com/doc/)\u3092\u4f7f\u3046\u305f\u3081\u306eSDK\u306fPHP\u3001Objective-C\u3001Windows8\u3001Android\u7528\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u30fc\u30d9\u30fc\u30b9\u3067\u3059\u304c\u3001Node.js\u7528\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3082GitHub\u306b\u30ea\u30dd\u30b8\u30c8\u30ea\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u3053\u3061\u3089\u3092\u4f7f\u3063\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n## Netatmo\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\n[\u5ba4\u5185\uff06\u5c4b\u5916\u306e\u6c17\u6e29\u30fb\u6e7f\u5ea6\u30fbCO2\u7b49\u3092\u8a08\u6e2c\u3057\u3066\u8a73\u7d30\u306a\u5929\u6c17\u60c5\u5831\u3092\u51fa\u3057\u3066\u304f\u308c\u308b\u300cnetatmo \u30a6\u30a7\u30b6\u30fc\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\uff06\u96e8\u91cf\u8a08\u300d\u30ec\u30d3\u30e5\u30fc](http://gigazine.net/news/20140829-netatmo/)\u304c\u5199\u771f\u5165\u308a\u3067\u89e3\u8aac\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3059\u3002\u307e\u305f\u3001\u30b9\u30de\u30db\u30a2\u30d7\u30ea\u306e\u30ac\u30a4\u30c9\u3082\u4e01\u5be7\u3067\u308f\u304b\u308a\u3084\u3059\u3044\u306e\u3067\u3001\u30a2\u30d7\u30ea\u3092\u64cd\u4f5c\u3057\u3066\u3044\u304f\u3060\u3051\u3067\u3082\u7c21\u5358\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n### \u30b5\u30a4\u30f3\u30a2\u30c3\u30d7\n\niPhone\u306e\u5834\u5408\u306f[Weather Station by Netatmo](https://itunes.apple.com/ja/app/netatmo-weather-station/id532538499)\u3001Android\u306f[\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3 Netatmo](https://play.google.com/store/apps/details?id=com.netatmo.netatmo&hl=ja)\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3001Netatmo\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7etatmo\u306b\u30b5\u30a4\u30f3\u30a2\u30c3\u30d7\u3057\u307e\u3059\u3002\n\n### \u5c4b\u5916\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u7f6e\n\n\u5c4b\u5916\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u96fb\u6c60\u3092\u3092\u30bb\u30c3\u30c8\u3057\u307e\u3059\u3002\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u306fMicro USB\u30b1\u30fc\u30d6\u30eb\u3067\u96fb\u6e90\u30d7\u30e9\u30b0\u306b\u63a5\u7d9a\u3057\u307e\u3059\u3002\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u4e0a\u90e8\u3092\u30bf\u30c3\u30c1\u3057\u3066\u5074\u9762\u304c\u9752\u8272\u306b\u70b9\u6ec5\u3055\u305b\u307e\u3059\u3002\n\n### \u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u306eWi-Fi\u8a2d\u5b9a\n\n\u30b9\u30de\u30db\u30a2\u30d7\u30ea\u304b\u3089\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u306bBluetooth\u3067\u30da\u30a2\u30ea\u30f3\u30b0\u3057\u305f\u3042\u3068\u3001\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u306bWi-Fi\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3092\u884c\u3044\u307e\u3059\u3002\u63a5\u7d9a\u306b\u6210\u529f\u3059\u308b\u3068\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u3092Netatmo\u306b\u767b\u9332\u3057\u3066\u7d42\u4e86\u3057\u307e\u3059\u3002\n\n\n### \u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u30d6\u30e9\u30a6\u30b6\n\n\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u30d6\u30e9\u30a6\u30b6\u304b\u3089[\u30ed\u30b0\u30a4\u30f3](https://auth.netatmo.com/access/login)\u3057\u307e\u3059\u3002[\u30a6\u30a7\u30b6\u30fc\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3](https://my.netatmo.com/app/station)\u306e\u30da\u30fc\u30b8\u3092\u958b\u304f\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n![netatmo-station.png](https://qiita-image-store.s3.amazonaws.com/0/43745/87c3c082-c65a-cc6e-bc0e-2f43f0ce2381.png)\n\n## API\u3092\u4f7f\u3046\u6e96\u5099\n\nAPI\u3092\u4f7f\u3063\u305f\u30b5\u30f3\u30d7\u30eb\u306f\u3001[Netatmo \u30a6\u30a7\u30b6\u30fc\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u8cb7\u3063\u3066\u307f\u305f\u306e\u3067 Node.js \u3067\u3044\u3058\u3063\u3066\u307f\u305f](http://tips.hecomi.com/entry/2014/04/14/211252)\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\u8a66\u3057\u3066\u307f\u305f\u3044Node.js\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u4f8b\u306a\u306e\u3067\u52a9\u304b\u308a\u307e\u3057\u305f\u3002\n\n### \u30a2\u30d7\u30ea\u306e\u767b\u9332\n\n[Netatmo Developers](https://dev.netatmo.com/)\u306e\u30da\u30fc\u30b8\u3092\u958b\u3044\u3066\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\u4e0a\u30e1\u30cb\u30e5\u30fc\u306b[DOCUMENTATION](https://dev.netatmo.com/doc/)\u3068[CREATE AN APPLICATION](https://dev.netatmo.com/dev/createapp)\u306a\u3069\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u3002CREATE AN APPLICATION\u306e\u30da\u30fc\u30b8\u3092\u958b\u304d\u300cName\u300d\u3068\u300cDescription\u300d\u306b\u9069\u5f53\u306a\u540d\u524d\u3092\u3064\u3051\u3066\u767b\u9332\u3059\u308b\u3068\u3001Client id\u3068Client secret\u304c\u767a\u884c\u3055\u308c\u307e\u3059\u3002API\u3067\u306f\u3053\u306eid\u3068secret\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n![netatmo-apikey.png](https://qiita-image-store.s3.amazonaws.com/0/43745/0790a4eb-b0d4-af84-04cf-50036e57eb49.png)\n\n## Node.js\u306e\u30b5\u30f3\u30d7\u30eb\n\nNode.js\u306e[netatmo](https://github.com/karbassi/netatmo)\u3092\u5229\u7528\u3057\u3066API\u3092\u4f7f\u3063\u305f\u30b5\u30f3\u30d7\u30eb\u3092\u66f8\u3044\u3066\u307f\u307e\u3059\u3002\u30ea\u30dd\u30b8\u30c8\u30ea\u306f[\u3053\u3061\u3089](https://github.com/masato/docker-netatmo)\u3067\u3059\u3002\u4eca\u56de\u3082\u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u306b[io.js](https://hub.docker.com/_/iojs/)\u306e[3.2](https://github.com/nodejs/docker-iojs/blob/68a13ab0f190d079b484c67b9eb266ce999420b0/3.2/Dockerfile)\u3092\u5229\u7528\u3057\u3066Docker Compose\u304b\u3089\u69cb\u6210\u7ba1\u7406\u3057\u307e\u3059\u3002\n\n### docker-compose.yml\n\ndocker-compose.yml.default\u30d5\u30a1\u30a4\u30eb\u3092docker-compose.yml\u306b\u30ea\u30cd\u30fc\u30e0\u3057\u3066\u304b\u3089\u74b0\u5883\u5909\u6570\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n* CLIENT_ID: \u4f5c\u6210\u3057\u305f\u30a2\u30d7\u30ea\u306eClient id\n* CLIENT_SECRET: \u4f5c\u6210\u3057\u305f\u30a2\u30d7\u30ea\u306eClient secret\n* USERNAME: netatmo\u306b\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u540d\n* PASSWORD: netatmo\u306b\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u30d1\u30b9\u30ef\u30fc\u30c9\u540d\n* INTERVAL: 1800000(30\u5206)\u3001 netatmo\u304b\u3089\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u611f\u899a\n\n```yaml:~/node_apps/docker-netatmo/docker-compose.yml.default\nnetatmo:\n  build: .\n  volumes:\n    - .:/app\n    - /etc/localtime:/etc/localtime:ro\n  environment:\n    - CLIENT_ID=\n    - CLIENT_SECRET=\n    - USERNAME=\n    - PASSWORD=\n    - INTERVAL=1800000\n  ports:\n    - 3033:3000\n```\n\n### app.js\n\nNetatomo\u306b\u306f[GETMEASURE](https://dev.netatmo.com/doc/methods/getmeasure)\u3068\u3044\u3046API\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u30c7\u30d0\u30a4\u30b9(\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3)\u3068\u30e2\u30b8\u30e5\u30fc\u30eb(\u5c4b\u5916\u30e2\u30b8\u30e5\u30fc\u30eb)\u306e\u3069\u3061\u3089\u304b\u3057\u304b\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3067\u304d\u306a\u3044\u3088\u3046\u3067\u3059\u3002\u89aa\u5b50\u95a2\u4fc2\u3092\u7d10\u4ed8\u3051\u308bid\u3092\u3064\u304b\u3063\u3066\u4e00\u3064\u306eJSON\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u307e\u3068\u3081\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u307e\u305f\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u306etype\u30d5\u30a3\u30fc\u30eb\u30c9\u304c`NAModule4`\u306e\u5834\u5408\u306f\u8ffd\u52a0\u306e\u5c4b\u5185\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u3061\u3089\u306fCO2\u3092\u691c\u51fa\u3067\u304d\u308b\u306e\u3067\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```js:~/node_apps/docker-netatmo/app.js\n\"use strict\";\n\nvar netatmo = require('netatmo'),\n    async = require('async'),\n    _ = require('lodash'),\n    moment = require('moment-timezone'),\n    api = new netatmo({\n        'client_id': process.env.CLIENT_ID,\n        'client_secret': process.env.CLIENT_SECRET,\n        'username': process.env.USERNAME,\n        'password': process.env.PASSWORD,\n    });\n\nfunction getMyDevices(deviceIds, devices, modules, callback) {\n    var myDevices = _.map(deviceIds, function(id) {\n        return {\n            device: _.find(devices, function(device) {\n                return id == device._id;\n            }),\n            modules: _.filter(modules, function(module) {\n                return id == module.main_device;\n            })\n        };\n    });\n    callback(null, myDevices);\n}\n\nfunction toJST(time_utc) {\n  return moment(time_utc, 'X').tz(\"Asia/Tokyo\").format();\n}\n\nfunction pluckDevice(device) {\n    return {\n        module_name: device.module_name,\n        time_utc: toJST(device.dashboard_data.time_utc),\n        noise: device.dashboard_data.Noise,\n        temperature: device.dashboard_data.Temperature,\n        humidity: device.dashboard_data.Humidity,\n        pressure: device.dashboard_data.Pressure,\n        co2: device.dashboard_data.CO2\n    };\n}\n\nfunction pluckModule(module) {\n    var retval = {\n        module_name: module.module_name,\n        time_utc: toJST(module.dashboard_data.time_utc),\n        temperature: module.dashboard_data.Temperature,\n        humidity: module.dashboard_data.Humidity\n    };\n    // for the additionnal indoor module\n    // https://dev.netatmo.com/doc/methods/devicelist\n    if (module.type == 'NAModule4'){\n        retval[co2] = module.dashboard_data.CO2;\n    }\n    return retval;\n}\n\nfunction resultsOut(results) {\n    _.forEach(results, function(result) {\n        console.log(pluckDevice(result.device));\n        _.forEach(result.modules, function(module) {\n            console.log(pluckModule(module));\n        });\n    });\n}\n\nfunction measure(callback) {\n    async.waterfall([\n        function(callback) {\n            api.getUser(callback);\n        },\n        function(user, callback) {\n            api.getDevicelist(function(err, devices, modules) {\n                if (err) return callback(err);\n                getMyDevices(user.devices,\n                             devices, modules,\n                             callback);\n            });\n        }], function(err, results) {\n            if (err) return console.log(err);\n            resultsOut(results);\n            console.log('----');\n            setTimeout(callback, process.env.INTERVAL);\n        });\n}\n\nasync.forever( measure, function(err) {\n    if(err) console.log(err);\n});\n```\n\n### \u5b9f\u884c\n\n\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5b9f\u884c\u3059\u308b\u3068\u74b0\u5883\u5909\u6570INTERVAL\u306b\u5b9a\u7fa9\u3057\u305f\u9593\u9694(1800000\u30df\u30ea\u79d2=30\u5206)\u3067Netatomo\u304b\u3089\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3066\u6a19\u6e96\u51fa\u529b\u3057\u307e\u3059\u3002\u672c\u4f53\u3068\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30bb\u30f3\u30b7\u30f3\u30b0\u6642\u9593\u306f\u5b8c\u5168\u306b\u4e00\u81f4\u306f\u3057\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\n```bash\n$ docker-compose up netatmo\n...\nnetatmo_1 | npm info it worked if it ends with ok\nnetatmo_1 | npm info using npm@2.13.3\nnetatmo_1 | npm info using node@v3.2.0\nnetatmo_1 | npm info prestart netatmo-docker@0.0.1\nnetatmo_1 | npm info start netatmo-docker@0.0.1\nnetatmo_1 |\nnetatmo_1 | > netatmo-docker@0.0.1 start /app\nnetatmo_1 | > node app.js\nnetatmo_1 |\nnetatmo_1 | { module_name: '\u30ea\u30d3\u30f3\u30b0',\nnetatmo_1 |   time_jst: '2015-08-31T09:34:30+09:00',\nnetatmo_1 |   noise: 38,\nnetatmo_1 |   temperature: 24.5,\nnetatmo_1 |   humidity: 84,\nnetatmo_1 |   pressure: 1081.7,\nnetatmo_1 |   co2: 395 }\nnetatmo_1 | { module_name: '\u30d9\u30e9\u30f3\u30c0',\nnetatmo_1 |   time_jst: '2015-08-31T09:34:28+09:00',\nnetatmo_1 |   temperature: 22.9,\nnetatmo_1 |   humidity: 86 }\nnetatmo_1 | ----\n```\n", "tags": ["netatmo", "Node.js", "IoT", "docker-compose", "myThings"]}