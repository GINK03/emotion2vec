{"context": " More than 1 year has passed since last update.\u672c\u8a18\u4e8b\u3067\u306f\u3001XOOPS Cube \u304c\u30a6\u30a7\u30d6\u30b5\u30a4\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3055\u308c\u305f\u6642\u3069\u306e\u3088\u3046\u306b\u3057\u3066\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30b5\u30fc\u30d0\u306b\u63a5\u7d9a\u3057\u3066\u3044\u308b\u304b\u3092\u9806\u3092\u8ffd\u3063\u3066\u89e3\u8aac\u3057\u307e\u3059\u3002\n\u307e\u305a\u3001 XOOPS Cube \u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u7b49\u3067\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u5229\u7528\u3059\u308b\u969b\u306e\u6a19\u6e96\u7684\u306a\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u624b\u6cd5\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u69d8\u306a\u30c7\u30fc\u30bf\u30a2\u30af\u30bb\u30b9\u7528\u306e\u30b3\u30fc\u30c9\u306f\u901a\u5e38\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u306e class \u30d5\u30a9\u30eb\u30c0\u306b\u914d\u7f6e\u3055\u308c\u3001\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u304b\u3089\u5229\u7528\u3055\u308c\u307e\u3059\u3002\n$root =& XCube_Root::getSingleton();\n$db =& $root->mController->getDB();\n$table = $db->prefix('foo');\n$sql = \"SELECT * FROM \". $table .\" WHERE uid=$uid\"; \n$result = $db->query($sql);\nwhile ($row = $db->fetchArray($result)) {\n    $ret[] = $row;\n}\nreturn $ret;\n\n\u306a\u304a\u3001\u3053\u3053\u306b\u63b2\u793a\u3055\u308c\u308b\u30b3\u30fc\u30c9\u306f XOOPS Cube Legacy 2.2.1 \u306e\u30b3\u30a2\u30bd\u30fc\u30b9\u304b\u3089\u89e3\u8aac\u30dd\u30a4\u30f3\u30c8\u3060\u3051\u3092\u30d4\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u305f\u7269\u3067\u3059\u306e\u3067\u4e88\u3081\u3054\u4e86\u627f\u304f\u3060\u3055\u3044\u3002\n\u6700\u521d\u306b\u3001html \u76f4\u4e0b\u306e index.php \u304c\u547c\u3073\u51fa\u3055\u308c\u307e\u3059\u3002\u305d\u3057\u3066\u305d\u306e\u4e2d\u3067 mainfile.php \u304c\u8aad\u307f\u8fbc\u307e\u308c\u307e\u3059\u3002\u3055\u3089\u306b minfile.php \u306e\u4e2d\u3067 common.php \u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002\n\nmainfile.php\ninclude XOOPS_ROOT_PATH.'/include/common.php';\n\n\ncommon.php \u3067\u306f\u3001\u30b3\u30a2\u306e\u5404\u7a2e\u521d\u671f\u8a2d\u5b9a\u3067\u3042\u308b cubecore_init.php \u3092\u8aad\u307f\u8fbc\u307f root\u3092\u4f5c\u308b\u3068\u3044\u3046\u5927\u4e8b\u306a\u5f79\u5272\u3092\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002XOOPSCube\u3067\u306f\u3001\u5168\u3066root \u3092\u4f5c\u308b\u3068\u3044\u3046\u5927\u4e8b\u306a\u5f79\u5272\u3092\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002 XOOPS Cube \u3067\u306f\u3001\u5168\u3066 root \u304b\u3089\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u53ef\u80fd\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n\ncommon.php\nrequire_once XOOPS_ROOT_PATH . '/include/cubecore_init.php';\n$root=&XCube_Root::getSingleton();\n$xoopsController=&$root->getController();\n$xoopsController->executeCommon();\n\n\nroot\u304c\u751f\u6210\u3055\u308c\u305f\u5f8c\u305d\u3053\u306b\u8089\u4ed8\u3051\u3057\u3066\u3044\u304f\u4f5c\u696d\u304c\u7d9a\u304d\u307e\u3059\u3002\u305d\u308c\u304cexecuteCommon\u3067\u3059\u3002\u307e\u308b\u3067\u6728\u306e\u5e79\u304b\u3089\u679d\u304c\u751f\u3048\u3066\u884c\u304f\u69d8\u3092\u307f\u308b\u304b\u306e\u69d8\u306b\u4ee5\u4e0b\u306e\u30af\u30e9\u30b9\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\u5404\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u89e3\u8aac\u306f\u307e\u305f\u3044\u305a\u308c\u884c\u3044\u307e\u3059\u304c\u3001\u3053\u3053\u3067\u6ce8\u76ee\u3057\u3066\u9802\u304d\u305f\u3044\u306e\u304croot \u304c\u751f\u6210\u3055\u308c\u305f\u5f8c\u305d\u3053\u306b\u8089\u4ed8\u3051\u3057\u3066\u3044\u304f\u4f5c\u696d\u304c\u7d9a\u304d\u307e\u3059\u3002\u305d\u308c\u304c executeCommon \u3067\u3059\u3002\u307e\u308b\u3067\u6728\u306e\u5e79\u304b\u3089\u679d\u304c\u751f\u3048\u3066\u884c\u304f\u69d8\u3092\u307f\u308b\u304b\u306e\u69d8\u306b\u4ee5\u4e0b\u306e\u30af\u30e9\u30b9\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\u5404\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u89e3\u8aac\u306f\u307e\u305f\u3044\u305a\u308c\u884c\u3044\u307e\u3059\u304c\u3001\u3053\u3053\u3067\u6ce8\u76ee\u3057\u3066\u9802\u304d\u305f\u3044\u306e\u304c this->_setupDB(); \u3067\u3059\u3002\u3053\u3053\u3067\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30b5\u30fc\u30d0\u3078\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u304c\u5f35\u3089\u308c\u3066\u30d7\u30e9\u30a4\u30de\u30ea\u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304c\u6c7a\u5b9a\u3057\u307e\u3059\u3002\n\nhtml/modules/legacy/kernel/Legacy_Controller.class.php\nclass Legacy_Controller extends XCube_Controller{\n    function executeCommon(){\n        $this->_setupEnvironment();\n        $this->_setupLogger();\n        $this->_setupDB();\n        $this->_setupLanguage();\n        $this->_setupTextFilter();\n        $this->_setupConfig();\n        $this->_setupScript();\n        $this->_setupDebugger();\n        $this->_loadInterfaceFiles();\n        $this->_processPreBlockFilter();\n        $this->_setupSession();\n        $this->_setupUser();\n        $this->setupModuleContext();\n        $this->_processModule();\n        $this->_processPostFilter();\n    }\n    function _setupDB(){\n        $this->mDB =& XoopsDatabaseFactory::getDatabaseConnection();\n    }\n    function &getDB(){\n        return $this->mDB;\n    }\n}\n\n\n_setupDB() \u3067\u306f\u3001getDatabaseConnection \u3092\u30b3\u30fc\u30eb\u3057\u3066 $root->mController->mDB \u306b\u751f\u6210\u5185\u5bb9\u3092\u6e21\u3057\u307e\u3059\u3002\u3055\u3066\u3001\u3067\u306f\u3044\u3088\u3044\u3088 MySQL \u30b5\u30fc\u30d0\u3068\u306e\u63a5\u7d9a\u90e8\u5206\u3067\u3059\u3002\ngetDatabaseConnection \u306f databasefactory \u3068\u3044\u3046\u30af\u30e9\u30b9\u306b\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u3053\u306e connect \u3067 XOOPS_DB_TYPE \u306b\u6307\u5b9a\u3057\u305f\u7a2e\u985e\u306eDB\u30b5\u30fc\u30d0(=MySQL) \u306e\u30af\u30e9\u30b9\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u30ed\u30fc\u30c7\u30a3\u30f3\u30b0\u3055\u308c\u307e\u3059\u3002\n\nhtml/class/database/databasefactory.php\npublic static function &getDatabaseConnection(){\n$file = XOOPS_ROOT_PATH.'/class/database/'.XOOPS_DB_TYPE.'database.php';\n$instance->connect();\n}\n\n\n\u305d\u3057\u3066\u3001mysql_connect \u304c\u5b9f\u884c\u3055\u308c mysql_select_db \u3067\u30d7\u30e9\u30a4\u30de\u30ea\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304c\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u3002\n\nhtml/class/database/mysqldatabase.php\nclass XoopsMySQLDatabase extends XoopsDatabase\n{\n    function connect($selectdb = true){\n        $this->conn = @mysql_connect(XOOPS_DB_HOST, XOOPS_DB_USER, XOOPS_DB_PASS, false, MYSQL_CLIENT_FOUND_ROWS);\n        mysql_select_db(XOOPS_DB_NAME);\n    }\n}\n\n\n\u672c\u8a18\u4e8b\u3067\u306f\u3001XOOPS Cube \u304c\u30a6\u30a7\u30d6\u30b5\u30a4\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3055\u308c\u305f\u6642\u3069\u306e\u3088\u3046\u306b\u3057\u3066\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30b5\u30fc\u30d0\u306b\u63a5\u7d9a\u3057\u3066\u3044\u308b\u304b\u3092\u9806\u3092\u8ffd\u3063\u3066\u89e3\u8aac\u3057\u307e\u3059\u3002\n\n\u307e\u305a\u3001 XOOPS Cube \u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u7b49\u3067\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u5229\u7528\u3059\u308b\u969b\u306e\u6a19\u6e96\u7684\u306a\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u624b\u6cd5\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u69d8\u306a\u30c7\u30fc\u30bf\u30a2\u30af\u30bb\u30b9\u7528\u306e\u30b3\u30fc\u30c9\u306f\u901a\u5e38\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u306e class \u30d5\u30a9\u30eb\u30c0\u306b\u914d\u7f6e\u3055\u308c\u3001\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u304b\u3089\u5229\u7528\u3055\u308c\u307e\u3059\u3002\n\n```\n$root =& XCube_Root::getSingleton();\n$db =& $root->mController->getDB();\n$table = $db->prefix('foo');\n$sql = \"SELECT * FROM \". $table .\" WHERE uid=$uid\"; \n$result = $db->query($sql);\nwhile ($row = $db->fetchArray($result)) {\n    $ret[] = $row;\n}\nreturn $ret;\n```\n\n\u306a\u304a\u3001\u3053\u3053\u306b\u63b2\u793a\u3055\u308c\u308b\u30b3\u30fc\u30c9\u306f XOOPS Cube Legacy 2.2.1 \u306e\u30b3\u30a2\u30bd\u30fc\u30b9\u304b\u3089\u89e3\u8aac\u30dd\u30a4\u30f3\u30c8\u3060\u3051\u3092\u30d4\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u305f\u7269\u3067\u3059\u306e\u3067\u4e88\u3081\u3054\u4e86\u627f\u304f\u3060\u3055\u3044\u3002\n\n\u6700\u521d\u306b\u3001html \u76f4\u4e0b\u306e index.php \u304c\u547c\u3073\u51fa\u3055\u308c\u307e\u3059\u3002\u305d\u3057\u3066\u305d\u306e\u4e2d\u3067 mainfile.php \u304c\u8aad\u307f\u8fbc\u307e\u308c\u307e\u3059\u3002\u3055\u3089\u306b minfile.php \u306e\u4e2d\u3067 common.php \u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002\n\n```mainfile.php\ninclude XOOPS_ROOT_PATH.'/include/common.php';\n```\ncommon.php \u3067\u306f\u3001\u30b3\u30a2\u306e\u5404\u7a2e\u521d\u671f\u8a2d\u5b9a\u3067\u3042\u308b cubecore_init.php \u3092\u8aad\u307f\u8fbc\u307f $root \u3092\u4f5c\u308b\u3068\u3044\u3046\u5927\u4e8b\u306a\u5f79\u5272\u3092\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002 XOOPS Cube \u3067\u306f\u3001\u5168\u3066 $root \u304b\u3089\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u53ef\u80fd\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n\n```common.php\nrequire_once XOOPS_ROOT_PATH . '/include/cubecore_init.php';\n$root=&XCube_Root::getSingleton();\n$xoopsController=&$root->getController();\n$xoopsController->executeCommon();\n```\n\n$root \u304c\u751f\u6210\u3055\u308c\u305f\u5f8c\u305d\u3053\u306b\u8089\u4ed8\u3051\u3057\u3066\u3044\u304f\u4f5c\u696d\u304c\u7d9a\u304d\u307e\u3059\u3002\u305d\u308c\u304c executeCommon \u3067\u3059\u3002\u307e\u308b\u3067\u6728\u306e\u5e79\u304b\u3089\u679d\u304c\u751f\u3048\u3066\u884c\u304f\u69d8\u3092\u307f\u308b\u304b\u306e\u69d8\u306b\u4ee5\u4e0b\u306e\u30af\u30e9\u30b9\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\u5404\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u89e3\u8aac\u306f\u307e\u305f\u3044\u305a\u308c\u884c\u3044\u307e\u3059\u304c\u3001\u3053\u3053\u3067\u6ce8\u76ee\u3057\u3066\u9802\u304d\u305f\u3044\u306e\u304c $this->_setupDB(); \u3067\u3059\u3002\u3053\u3053\u3067\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30b5\u30fc\u30d0\u3078\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u304c\u5f35\u3089\u308c\u3066\u30d7\u30e9\u30a4\u30de\u30ea\u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304c\u6c7a\u5b9a\u3057\u307e\u3059\u3002\n\n```html/modules/legacy/kernel/Legacy_Controller.class.php\nclass Legacy_Controller extends XCube_Controller{\n\tfunction executeCommon(){\n\t\t$this->_setupEnvironment();\n\t\t$this->_setupLogger();\n\t\t$this->_setupDB();\n\t\t$this->_setupLanguage();\n\t\t$this->_setupTextFilter();\n\t\t$this->_setupConfig();\n\t\t$this->_setupScript();\n\t\t$this->_setupDebugger();\n\t\t$this->_loadInterfaceFiles();\n\t\t$this->_processPreBlockFilter();\n\t\t$this->_setupSession();\n\t\t$this->_setupUser();\n\t\t$this->setupModuleContext();\n\t\t$this->_processModule();\n\t\t$this->_processPostFilter();\n\t}\n\tfunction _setupDB(){\n\t\t$this->mDB =& XoopsDatabaseFactory::getDatabaseConnection();\n\t}\n\tfunction &getDB(){\n\t\treturn $this->mDB;\n\t}\n}\n```\n\n_setupDB() \u3067\u306f\u3001getDatabaseConnection \u3092\u30b3\u30fc\u30eb\u3057\u3066 $root->mController->mDB \u306b\u751f\u6210\u5185\u5bb9\u3092\u6e21\u3057\u307e\u3059\u3002\u3055\u3066\u3001\u3067\u306f\u3044\u3088\u3044\u3088 MySQL \u30b5\u30fc\u30d0\u3068\u306e\u63a5\u7d9a\u90e8\u5206\u3067\u3059\u3002\n\ngetDatabaseConnection \u306f databasefactory \u3068\u3044\u3046\u30af\u30e9\u30b9\u306b\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u3053\u306e connect \u3067 XOOPS_DB_TYPE \u306b\u6307\u5b9a\u3057\u305f\u7a2e\u985e\u306eDB\u30b5\u30fc\u30d0(=MySQL) \u306e\u30af\u30e9\u30b9\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u30ed\u30fc\u30c7\u30a3\u30f3\u30b0\u3055\u308c\u307e\u3059\u3002\n\n```html/class/database/databasefactory.php\npublic static function &getDatabaseConnection(){\n$file = XOOPS_ROOT_PATH.'/class/database/'.XOOPS_DB_TYPE.'database.php';\n$instance->connect();\n}\n```\n\n\u305d\u3057\u3066\u3001mysql_connect \u304c\u5b9f\u884c\u3055\u308c mysql_select_db \u3067\u30d7\u30e9\u30a4\u30de\u30ea\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304c\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u3002\n\n```html/class/database/mysqldatabase.php\nclass XoopsMySQLDatabase extends XoopsDatabase\n{\n\tfunction connect($selectdb = true){\n\t\t$this->conn = @mysql_connect(XOOPS_DB_HOST, XOOPS_DB_USER, XOOPS_DB_PASS, false, MYSQL_CLIENT_FOUND_ROWS);\n\t\tmysql_select_db(XOOPS_DB_NAME);\n\t}\n}\n```\n", "tags": ["PHP", "XOOPS"]}