{"context": "AWS\u306eCodeDeploy\u4f7f\u3063\u3066\u3044\u308b\u4eba\u3063\u3066\u3069\u306e\u304f\u3089\u3044\u3044\u308b\u3093\u3067\u3057\u3087\u3046\uff1f\n\u5148\u65e5\u3053\u3093\u306a\u306e\u3082\u66f8\u304d\u307e\u3057\u305f\u304c\nhttp://qiita.com/hardreggaecafe/items/7ff3ada575a1100fa4a2\n\u3042\u307e\u308a\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u306a\u304f\u3066\u6b63\u76f4\u82e6\u52b4\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n\u3053\u3053\u306b\u66f8\u3044\u305f\u3053\u3068\u3082Amazon\u306e\u30b5\u30dd\u30fc\u30c8\u306b\u805e\u3044\u305f\u3053\u3068\u3082\u4e00\u90e8\u66f8\u3044\u3066\u307e\u3059\u3002\n\u81ea\u5206\u306e\u5834\u5408\u306fCircleCI\u304b\u3089S3\u307e\u3067\u306f\u30b3\u30f3\u30c6\u30f3\u30c4\u6301\u3063\u3066\u3053\u308c\u3066\u3001\u305d\u306e\u5f8cCodeDeploy\u304c\nEC2\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u3088\u3046\u3068\u3057\u3066\u30a8\u30e9\u30fc\u306b\u306a\u308b\u3068\u3044\u3046\u306e\u3092\u4f55\u56de\u304b\u7d4c\u9a13\u3057\u3066\u3044\u307e\u3059\u3002\n\u305d\u306e\u6642\u306e\u30a8\u30e9\u30fc\u306f\u3053\u3061\u3089\u3002\n\"The overall deployment failed because too many individual instances failed deployment, too few healthy instances are available for deployment, or some instances in your deployment group are experiencing problems. (Error code: HEALTH_CONSTRAINTS) \"\nDeployment: d-XXXXXXX\nInstance ID: i-XXXXXX\n\n\u300e\u5168\u4f53\u306e\u30c7\u30d7\u30ed\u30a4\u306f\u500b\u5225\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30c7\u30d7\u30ed\u30a4\u5931\u6557\u304c\u591a\u3059\u304e\u308b\u304b\u3001\u3082\u3057\u304f\u306f\u30c7\u30d7\u30ed\u30a4\u304c\u51fa\u6765\u308b\u5065\u5168\u306a\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u5c11\u306a\u3059\u304e\u308b\u3001\u3042\u308b\u3044\u306f\u3044\u304f\u3064\u304b\u306e\u30c7\u30d7\u30ed\u30a4\u30b0\u30eb\u30fc\u30d7\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u554f\u984c\u3092\u62b1\u3048\u3066\u3044\u308b\u3053\u3068\u304c\u539f\u56e0\u3067\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u300f\u3068\u30a8\u30e9\u30fc\u306e\u539f\u56e0\u304c\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u5185\u5bb9\u30fb\u30fb\u30fb\u3002\n\u30b5\u30dd\u30fc\u30c8\u306b\u554f\u3044\u5408\u308f\u305b\u3066\u308f\u304b\u3063\u305f\u3053\u3068\u306f\u30c7\u30d7\u30ed\u30a4\u3059\u308bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bCodeDeployAgent\u304c\u7121\u3044\u3068\u8a73\u7d30\u539f\u56e0\u3092\u7279\u5b9a\u3067\u304d\u306a\u3044\u3068\u3044\u3046\u3053\u3068\u3067\u3057\u305f\u3002\u305d\u308c\u3092\u3044\u308c\u308b\u3053\u3068\u3067\u30c7\u30d7\u30ed\u30a4\u3092\u518d\u5b9f\u884c\u3057\u3066\u30a8\u30e9\u30fc\u539f\u56e0\u3092\u5410\u304d\u51fa\u3055\u305b\u308c\u3070\u305d\u308c\u3092\u691c\u7d22\u3059\u308c\u3070\u308f\u304b\u308a\u305d\u3046\u3002\n\u3068\u3044\u3046\u3053\u3068\u3067\u65e9\u901f\u5f53\u8a72\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4e2d\u306bSSH\u3067\u30ed\u30b0\u30a4\u30f3\u5f8c\u3001CodeDeployAgent\u304c\u5165\u3063\u3066\u3044\u308b\u304b\u3092\u78ba\u8a8d\u3002\nrpm -qa |grep -i codedeploy-agent\nCodeDeployAgent\u304c\u5165\u3063\u3066\u3044\u306a\u3044\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002\nAgent\u304c\u5165\u3063\u3066\u3044\u306a\u3051\u308c\u3070\u3053\u3061\u3089\u3092\u6253\u3061\u8fbc\u3093\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\nyum -y install ruby; yum -y install wget; cd /home/ec2-user; wget https://aws-codedeploy-ap-northeast-1.s3.amazonaws.com/latest/install; chmod +x ./install; sudo ./install auto\n\n\u4ee5\u4e0b\u306e\u30ed\u30b0\u3092\u78ba\u8a8d\n/var/log/aws/codedeploy-agent/* \n/opt/codedeploy-agent/deployment-root/deployment-logs/* \n\n\u3053\u3061\u3089\u306e\u30b3\u30de\u30f3\u30c9\u3082\u6709\u52b9\nfind /opt/codedeploy-agent/deployment-root/ -type d -iname \"d-XXXXX\"\nd-XXXX\u306fCodeDeploy\u306e\u30c7\u30d7\u30ed\u30a4\u756a\u53f7\u3002\n\u3067\u65e9\u901f\u30ed\u30b0\u3092\u898b\u308b\u3068\n2016-09-13 17:20:44 ERROR [codedeploy-agent(20914)]: InstanceAgent::Plugins::CodeDeployPlugin::CommandPoller: Error during perform: RuntimeError - File already exists at location /home/adbase/analytics/public/site_edit.html - /opt/codedeploy-agent/lib/instance_agent/plugins/codedeploy/installer.rb:115:in `generate_normal_copy'\n\n\u3068\u30d5\u30a1\u30a4\u30eb\u304c\u3059\u3067\u306b\u3042\u308b\u3068\u6012\u3089\u308c\u3066\u3044\u308b\u3002\u307e\u3042\u3001\u305f\u3057\u304b\u306b\u30c7\u30d7\u30ed\u30a4\u524d\u306b\u30bd\u30fc\u30b9\u3092\u30b3\u30d4\u30fc\u3057\u3066\u3044\u308b\u304b\u3089\u3053\u308c\u304c\u4f55\u304b\u3084\u3063\u3066\u3044\u308b\u306e\u304b\uff1f\u3068\u601d\u3044\u8abf\u3079\u305f\u3089\nhttps://forums.aws.amazon.com/thread.jspa?threadID=212987\n\u306b\u3053\u3093\u306a\u3053\u3068\u304c\u66f8\u3044\u3066\u3044\u307e\u3057\u305f\u3002\nAWS CodeDeploy keeps track of files in an application revision that are deployed for a deployment group. It does not overwrite any existing files that were not deployed as part of a deployment group's application revision. This is done so that your deployment does not interfere with anything outside of its revision.\n\nIf you want to overwrite an existing file, you can do the clean up in 'BeforeInstall' lifecycle event.\n\n\u300eAWS\u306eCodeDeploy\u306f\u30c7\u30d7\u30ed\u30a4\u30b0\u30eb\u30fc\u30d7\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30ea\u30d3\u30b8\u30e7\u30f3\u3092\u8ffd\u8de1\u3057\u3066\u8a18\u9332\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u65e2\u306b\u5b58\u5728\u3057\u3066\u3044\u308b\u30d5\u30a1\u30a4\u30eb\u304c\u6709\u308c\u3070\u305d\u308c\u304c\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30ea\u30d3\u30b8\u30e7\u30f3\u306e\u4e00\u90e8\u3067\u306a\u3044\u3053\u3068\u3092\u691c\u77e5\u3057\u3066\u4e0a\u66f8\u304d\u3057\u306a\u3044\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\u30ea\u30d3\u30b8\u30e7\u30f3\u5916\u306e\u3082\u306e\u3092\u59a8\u3052\u306a\u3044\u3088\u3046\u306b\u305d\u3046\u3057\u3066\u3044\u307e\u3059\u3002\n\u3082\u3057\u4e0a\u66f8\u304d\u3057\u305f\u3051\u308c\u3070\u6d88\u53bb\u3059\u308b\u3088\u3046\u306bBeforeInstall\uff08CodeDeploy\u306e\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\uff09\u306b\u8a18\u8ff0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u300f\n\u3068\u3044\u3046\u3053\u3068\u3067\u3057\u305f\u3002\u6c17\u304c\u304d\u3044\u3066\u308b\u3093\u3067\u3057\u3087\u3046\u304b\uff1f\uff1f\u3068\u3044\u3046\u3053\u3068\u3067\u30d5\u30a1\u30a4\u30eb\u6d88\u3057\u305f\u3089\u30c7\u30d7\u30ed\u30a4\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u3063\u3066\u3053\u306e\u3078\u3093\u307e\u3067\u66f8\u3044\u3066\u6614\u304a\u3093\u306a\u3058\u3088\u3046\u306a\u8a18\u4e8b\u3092\u66f8\u3044\u305f\u3053\u3068\u306b\u6c17\u3065\u3044\u305f\u7f60\u3002\nhttp://qiita.com/hardreggaecafe/items/6abf9d4c6a82fcf61589\n\u3088\u308d\u3057\u3051\u308c\u3070\u3054\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\nAWS\u306eCodeDeploy\u4f7f\u3063\u3066\u3044\u308b\u4eba\u3063\u3066\u3069\u306e\u304f\u3089\u3044\u3044\u308b\u3093\u3067\u3057\u3087\u3046\uff1f\n\u5148\u65e5\u3053\u3093\u306a\u306e\u3082\u66f8\u304d\u307e\u3057\u305f\u304c\nhttp://qiita.com/hardreggaecafe/items/7ff3ada575a1100fa4a2\n\u3042\u307e\u308a\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u306a\u304f\u3066\u6b63\u76f4\u82e6\u52b4\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n\u3053\u3053\u306b\u66f8\u3044\u305f\u3053\u3068\u3082Amazon\u306e\u30b5\u30dd\u30fc\u30c8\u306b\u805e\u3044\u305f\u3053\u3068\u3082\u4e00\u90e8\u66f8\u3044\u3066\u307e\u3059\u3002\n\n\u81ea\u5206\u306e\u5834\u5408\u306fCircleCI\u304b\u3089S3\u307e\u3067\u306f\u30b3\u30f3\u30c6\u30f3\u30c4\u6301\u3063\u3066\u3053\u308c\u3066\u3001\u305d\u306e\u5f8cCodeDeploy\u304c\nEC2\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u3088\u3046\u3068\u3057\u3066\u30a8\u30e9\u30fc\u306b\u306a\u308b\u3068\u3044\u3046\u306e\u3092\u4f55\u56de\u304b\u7d4c\u9a13\u3057\u3066\u3044\u307e\u3059\u3002\n\u305d\u306e\u6642\u306e\u30a8\u30e9\u30fc\u306f\u3053\u3061\u3089\u3002\n\n```\n\"The overall deployment failed because too many individual instances failed deployment, too few healthy instances are available for deployment, or some instances in your deployment group are experiencing problems. (Error code: HEALTH_CONSTRAINTS) \"\nDeployment: d-XXXXXXX\nInstance ID: i-XXXXXX\n```\n\u300e\u5168\u4f53\u306e\u30c7\u30d7\u30ed\u30a4\u306f\u500b\u5225\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30c7\u30d7\u30ed\u30a4\u5931\u6557\u304c\u591a\u3059\u304e\u308b\u304b\u3001\u3082\u3057\u304f\u306f\u30c7\u30d7\u30ed\u30a4\u304c\u51fa\u6765\u308b\u5065\u5168\u306a\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u5c11\u306a\u3059\u304e\u308b\u3001\u3042\u308b\u3044\u306f\u3044\u304f\u3064\u304b\u306e\u30c7\u30d7\u30ed\u30a4\u30b0\u30eb\u30fc\u30d7\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u554f\u984c\u3092\u62b1\u3048\u3066\u3044\u308b\u3053\u3068\u304c\u539f\u56e0\u3067\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u300f\u3068\u30a8\u30e9\u30fc\u306e\u539f\u56e0\u304c\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u5185\u5bb9\u30fb\u30fb\u30fb\u3002\n\n\u30b5\u30dd\u30fc\u30c8\u306b\u554f\u3044\u5408\u308f\u305b\u3066\u308f\u304b\u3063\u305f\u3053\u3068\u306f\u30c7\u30d7\u30ed\u30a4\u3059\u308bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bCodeDeployAgent\u304c\u7121\u3044\u3068\u8a73\u7d30\u539f\u56e0\u3092\u7279\u5b9a\u3067\u304d\u306a\u3044\u3068\u3044\u3046\u3053\u3068\u3067\u3057\u305f\u3002\u305d\u308c\u3092\u3044\u308c\u308b\u3053\u3068\u3067\u30c7\u30d7\u30ed\u30a4\u3092\u518d\u5b9f\u884c\u3057\u3066\u30a8\u30e9\u30fc\u539f\u56e0\u3092\u5410\u304d\u51fa\u3055\u305b\u308c\u3070\u305d\u308c\u3092\u691c\u7d22\u3059\u308c\u3070\u308f\u304b\u308a\u305d\u3046\u3002\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u65e9\u901f\u5f53\u8a72\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4e2d\u306bSSH\u3067\u30ed\u30b0\u30a4\u30f3\u5f8c\u3001CodeDeployAgent\u304c\u5165\u3063\u3066\u3044\u308b\u304b\u3092\u78ba\u8a8d\u3002\n`rpm -qa |grep -i codedeploy-agent`\nCodeDeployAgent\u304c\u5165\u3063\u3066\u3044\u306a\u3044\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002\n\nAgent\u304c\u5165\u3063\u3066\u3044\u306a\u3051\u308c\u3070\u3053\u3061\u3089\u3092\u6253\u3061\u8fbc\u3093\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\n```\nyum -y install ruby; yum -y install wget; cd /home/ec2-user; wget https://aws-codedeploy-ap-northeast-1.s3.amazonaws.com/latest/install; chmod +x ./install; sudo ./install auto\n```\n\n\u4ee5\u4e0b\u306e\u30ed\u30b0\u3092\u78ba\u8a8d\n\n```\n/var/log/aws/codedeploy-agent/* \n/opt/codedeploy-agent/deployment-root/deployment-logs/* \n```\n\u3053\u3061\u3089\u306e\u30b3\u30de\u30f3\u30c9\u3082\u6709\u52b9\n`find /opt/codedeploy-agent/deployment-root/ -type d -iname \"d-XXXXX\" `\nd-XXXX\u306fCodeDeploy\u306e\u30c7\u30d7\u30ed\u30a4\u756a\u53f7\u3002\n\n\u3067\u65e9\u901f\u30ed\u30b0\u3092\u898b\u308b\u3068\n\n```\n2016-09-13 17:20:44 ERROR [codedeploy-agent(20914)]: InstanceAgent::Plugins::CodeDeployPlugin::CommandPoller: Error during perform: RuntimeError - File already exists at location /home/adbase/analytics/public/site_edit.html - /opt/codedeploy-agent/lib/instance_agent/plugins/codedeploy/installer.rb:115:in `generate_normal_copy'\n```\n\n\u3068\u30d5\u30a1\u30a4\u30eb\u304c\u3059\u3067\u306b\u3042\u308b\u3068\u6012\u3089\u308c\u3066\u3044\u308b\u3002\u307e\u3042\u3001\u305f\u3057\u304b\u306b\u30c7\u30d7\u30ed\u30a4\u524d\u306b\u30bd\u30fc\u30b9\u3092\u30b3\u30d4\u30fc\u3057\u3066\u3044\u308b\u304b\u3089\u3053\u308c\u304c\u4f55\u304b\u3084\u3063\u3066\u3044\u308b\u306e\u304b\uff1f\u3068\u601d\u3044\u8abf\u3079\u305f\u3089\nhttps://forums.aws.amazon.com/thread.jspa?threadID=212987\n\u306b\u3053\u3093\u306a\u3053\u3068\u304c\u66f8\u3044\u3066\u3044\u307e\u3057\u305f\u3002\n\n```\nAWS CodeDeploy keeps track of files in an application revision that are deployed for a deployment group. It does not overwrite any existing files that were not deployed as part of a deployment group's application revision. This is done so that your deployment does not interfere with anything outside of its revision.\n\nIf you want to overwrite an existing file, you can do the clean up in 'BeforeInstall' lifecycle event.\n```\n\n\u300eAWS\u306eCodeDeploy\u306f\u30c7\u30d7\u30ed\u30a4\u30b0\u30eb\u30fc\u30d7\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30ea\u30d3\u30b8\u30e7\u30f3\u3092\u8ffd\u8de1\u3057\u3066\u8a18\u9332\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u65e2\u306b\u5b58\u5728\u3057\u3066\u3044\u308b\u30d5\u30a1\u30a4\u30eb\u304c\u6709\u308c\u3070\u305d\u308c\u304c\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30ea\u30d3\u30b8\u30e7\u30f3\u306e\u4e00\u90e8\u3067\u306a\u3044\u3053\u3068\u3092\u691c\u77e5\u3057\u3066\u4e0a\u66f8\u304d\u3057\u306a\u3044\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\u30ea\u30d3\u30b8\u30e7\u30f3\u5916\u306e\u3082\u306e\u3092\u59a8\u3052\u306a\u3044\u3088\u3046\u306b\u305d\u3046\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u3082\u3057\u4e0a\u66f8\u304d\u3057\u305f\u3051\u308c\u3070\u6d88\u53bb\u3059\u308b\u3088\u3046\u306bBeforeInstall\uff08CodeDeploy\u306e\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\uff09\u306b\u8a18\u8ff0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u300f\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3057\u305f\u3002\u6c17\u304c\u304d\u3044\u3066\u308b\u3093\u3067\u3057\u3087\u3046\u304b\uff1f\uff1f\u3068\u3044\u3046\u3053\u3068\u3067\u30d5\u30a1\u30a4\u30eb\u6d88\u3057\u305f\u3089\u30c7\u30d7\u30ed\u30a4\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\u3063\u3066\u3053\u306e\u3078\u3093\u307e\u3067\u66f8\u3044\u3066\u6614\u304a\u3093\u306a\u3058\u3088\u3046\u306a\u8a18\u4e8b\u3092\u66f8\u3044\u305f\u3053\u3068\u306b\u6c17\u3065\u3044\u305f\u7f60\u3002\nhttp://qiita.com/hardreggaecafe/items/6abf9d4c6a82fcf61589\n\u3088\u308d\u3057\u3051\u308c\u3070\u3054\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n", "tags": ["AWS", "CodeDeploy"]}