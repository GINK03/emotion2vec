{"context": "\n\n\u3084\u308a\u305f\u3044\u3053\u3068\nrails\u306eactiverecord\u3092\u4f7f\u3063\u3066\u3001PostgreSQL\u306etimestamp\u30ab\u30e9\u30e0\u306b\u5bfe\u3057\u3066\u3001\u66dc\u65e5\u3054\u3068\u30fb\u6642\u9593\u5e2f\u3054\u3068\u306b\u30ec\u30b3\u30fc\u30c9\u3092\u62bd\u51fa\u3057\u305f\u3044\u3002\n\n\u66dc\u65e5\u3054\u3068\n\u30b9\u30af\u30ea\u30d7\u30c8:\n['\u65e5', '\u6708', '\u706b', '\u6c34', '\u6728', '\u91d1', '\u571f'].each_with_index do |dow, i|\n  count_by_dow = Model.where(\"extract(dow from created_at AT TIME ZONE 'UTC' AT TIME ZONE 'JST') = ?\", i).count\n  puts \"#{dow}\u66dc\u65e5: #{count_by_dow}\"\nend\n\n\u51fa\u529b:\n\u65e5\u66dc\u65e5: 2405\n\u6708\u66dc\u65e5: 3768\n\u706b\u66dc\u65e5: 2336\n\u6c34\u66dc\u65e5: 4860\n\u6728\u66dc\u65e5: 3158\n\u91d1\u66dc\u65e5: 2753\n\u571f\u66dc\u65e5: 2220\n\ncreated_at AT TIME ZONE 'UTC' AT TIME ZONE 'JST'\u306f\u3001(created_at AT TIME ZONE 'UTC') AT TIME ZONE 'JST'\u3068\u540c\u3058\u3002DB\u306e\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u304cUTC\u306a\u306e\u3067JST\u306b\u5909\u63db\u3057\u3066\u3044\u308b\u3002\n\n\u6642\u9593\u5e2f\u3054\u3068\n\u30b9\u30af\u30ea\u30d7\u30c8:\n(0..23).each do |clock|\n  time_string_from = \"#{sprintf('%02d', clock)}:00\"\n  time_string_to = \"#{sprintf('%02d', clock + 1)}:00\"\n  count_by_timescope = Model.where(\"to_char(created_at AT TIME ZONE 'UTC' AT TIME ZONE 'JST', 'HH24:MI') >= '#{time_string_from}'\")\n                            .where(\"to_char(created_at AT TIME ZONE 'UTC' AT TIME ZONE 'JST', 'HH24:MI') < '#{time_string_to}'\")\n                            .count\n  puts \"#{time_string_from}\u6642\u301c: #{count_by_timescope}\"\nend\n\n\u51fa\u529b:\n00:00\u6642\u301c: 1438\n01:00\u6642\u301c: 735\n02:00\u6642\u301c: 157\n03:00\u6642\u301c: 142\n04:00\u6642\u301c: 75\n05:00\u6642\u301c: 176\n06:00\u6642\u301c: 325\n07:00\u6642\u301c: 348\n08:00\u6642\u301c: 537\n09:00\u6642\u301c: 1047\n10:00\u6642\u301c: 1228\n11:00\u6642\u301c: 1500\n12:00\u6642\u301c: 658\n13:00\u6642\u301c: 1129\n14:00\u6642\u301c: 1099\n15:00\u6642\u301c: 981\n16:00\u6642\u301c: 927\n17:00\u6642\u301c: 1502\n18:00\u6642\u301c: 1763\n19:00\u6642\u301c: 593\n20:00\u6642\u301c: 703\n21:00\u6642\u301c: 1026\n22:00\u6642\u301c: 1991\n23:00\u6642\u301c: 1420\n\nto_char\u95a2\u6570\u3067\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3092\u6587\u5b57\u5217\u306b\u5909\u63db\u3057\u3066\u304b\u3089\u3001\u6587\u5b57\u5217\u3067\u6bd4\u8f03\u3092\u884c\u3063\u3066\u3044\u308b\u3002\u3082\u3063\u3068\u826f\u3044\u65b9\u6cd5\u304c\u3042\u308a\u305d\u3046\u306a\u306e\u3060\u304c\u3001\u3001\n\n\u88dc\u8db3\nextract\u95a2\u6570\u3067\u3001timestamp\u306e\u30ab\u30e9\u30e0\u304b\u3089\u3044\u308d\u3044\u308d\u306a\u30c7\u30fc\u30bf\u304c\u53d6\u5f97\u3067\u304d\u308b\u3002https://www.postgresql.jp/document/7.2/user/functions-datetime.html \u306b\u8a73\u3057\u304f\u66f8\u3044\u3066\u3042\u308b\u3002\n\ncentury (\u4e16\u7d00)\nday (\u65e5)\ndecade (\u5341\u5e74)\ndow (\u66dc\u65e5)\ndoy (\u901a\u7b97\u65e5\u6570)\nepoch (1970-01-01 00:00:00 \u304b\u3089\u306e\u79d2\u6570)\nhour (\u6642)\nmicroseconds (\u30de\u30a4\u30af\u30ed\u79d2)\nmillennium (\u30df\u30ec\u30cb\u30a2\u30e0)\nmilliseconds (\u30df\u30ea\u79d2)\nminute (\u5206)\nmonth (\u6708)\nquarter (\u56db\u534a\u671f)\nsecond (\u79d2)\ntimezone_hour (\u6642\u9593\u5e2f\u30aa\u30d5\u30bb\u30c3\u30c8\u306e\u6642\u306e\u6210\u5206)\ntimezone_minute (\u6642\u9593\u5e2f\u30aa\u30d5\u30bb\u30c3\u30c8\u306e\u5206\u306e\u6210\u5206)\nweek (\u9031)\nyear (\u5e74)\n\n## \u3084\u308a\u305f\u3044\u3053\u3068\nrails\u306eactiverecord\u3092\u4f7f\u3063\u3066\u3001PostgreSQL\u306etimestamp\u30ab\u30e9\u30e0\u306b\u5bfe\u3057\u3066\u3001\u66dc\u65e5\u3054\u3068\u30fb\u6642\u9593\u5e2f\u3054\u3068\u306b\u30ec\u30b3\u30fc\u30c9\u3092\u62bd\u51fa\u3057\u305f\u3044\u3002\n\n## \u66dc\u65e5\u3054\u3068\n\u30b9\u30af\u30ea\u30d7\u30c8:\n\n```\n['\u65e5', '\u6708', '\u706b', '\u6c34', '\u6728', '\u91d1', '\u571f'].each_with_index do |dow, i|\n  count_by_dow = Model.where(\"extract(dow from created_at AT TIME ZONE 'UTC' AT TIME ZONE 'JST') = ?\", i).count\n  puts \"#{dow}\u66dc\u65e5: #{count_by_dow}\"\nend\n```\n\n\u51fa\u529b:\n\n```\n\u65e5\u66dc\u65e5: 2405\n\u6708\u66dc\u65e5: 3768\n\u706b\u66dc\u65e5: 2336\n\u6c34\u66dc\u65e5: 4860\n\u6728\u66dc\u65e5: 3158\n\u91d1\u66dc\u65e5: 2753\n\u571f\u66dc\u65e5: 2220\n```\n\n`created_at AT TIME ZONE 'UTC' AT TIME ZONE 'JST'`\u306f\u3001`(created_at AT TIME ZONE 'UTC') AT TIME ZONE 'JST'`\u3068\u540c\u3058\u3002DB\u306e\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u304cUTC\u306a\u306e\u3067JST\u306b\u5909\u63db\u3057\u3066\u3044\u308b\u3002\n\n## \u6642\u9593\u5e2f\u3054\u3068\n\u30b9\u30af\u30ea\u30d7\u30c8:\n\n```\n(0..23).each do |clock|\n  time_string_from = \"#{sprintf('%02d', clock)}:00\"\n  time_string_to = \"#{sprintf('%02d', clock + 1)}:00\"\n  count_by_timescope = Model.where(\"to_char(created_at AT TIME ZONE 'UTC' AT TIME ZONE 'JST', 'HH24:MI') >= '#{time_string_from}'\")\n                            .where(\"to_char(created_at AT TIME ZONE 'UTC' AT TIME ZONE 'JST', 'HH24:MI') < '#{time_string_to}'\")\n                            .count\n  puts \"#{time_string_from}\u6642\u301c: #{count_by_timescope}\"\nend\n```\n\n\u51fa\u529b:\n\n```\n00:00\u6642\u301c: 1438\n01:00\u6642\u301c: 735\n02:00\u6642\u301c: 157\n03:00\u6642\u301c: 142\n04:00\u6642\u301c: 75\n05:00\u6642\u301c: 176\n06:00\u6642\u301c: 325\n07:00\u6642\u301c: 348\n08:00\u6642\u301c: 537\n09:00\u6642\u301c: 1047\n10:00\u6642\u301c: 1228\n11:00\u6642\u301c: 1500\n12:00\u6642\u301c: 658\n13:00\u6642\u301c: 1129\n14:00\u6642\u301c: 1099\n15:00\u6642\u301c: 981\n16:00\u6642\u301c: 927\n17:00\u6642\u301c: 1502\n18:00\u6642\u301c: 1763\n19:00\u6642\u301c: 593\n20:00\u6642\u301c: 703\n21:00\u6642\u301c: 1026\n22:00\u6642\u301c: 1991\n23:00\u6642\u301c: 1420\n```\n\nto_char\u95a2\u6570\u3067\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3092\u6587\u5b57\u5217\u306b\u5909\u63db\u3057\u3066\u304b\u3089\u3001\u6587\u5b57\u5217\u3067\u6bd4\u8f03\u3092\u884c\u3063\u3066\u3044\u308b\u3002\u3082\u3063\u3068\u826f\u3044\u65b9\u6cd5\u304c\u3042\u308a\u305d\u3046\u306a\u306e\u3060\u304c\u3001\u3001\n\n## \u88dc\u8db3\nextract\u95a2\u6570\u3067\u3001timestamp\u306e\u30ab\u30e9\u30e0\u304b\u3089\u3044\u308d\u3044\u308d\u306a\u30c7\u30fc\u30bf\u304c\u53d6\u5f97\u3067\u304d\u308b\u3002https://www.postgresql.jp/document/7.2/user/functions-datetime.html \u306b\u8a73\u3057\u304f\u66f8\u3044\u3066\u3042\u308b\u3002\n\n- century (\u4e16\u7d00)\n- day (\u65e5)\n- decade (\u5341\u5e74)\n- dow (\u66dc\u65e5)\n- doy (\u901a\u7b97\u65e5\u6570)\n- epoch (1970-01-01 00:00:00 \u304b\u3089\u306e\u79d2\u6570)\n- hour (\u6642)\n- microseconds (\u30de\u30a4\u30af\u30ed\u79d2)\n- millennium (\u30df\u30ec\u30cb\u30a2\u30e0)\n- milliseconds (\u30df\u30ea\u79d2)\n- minute (\u5206)\n- month (\u6708)\n- quarter (\u56db\u534a\u671f)\n- second (\u79d2)\n- timezone_hour (\u6642\u9593\u5e2f\u30aa\u30d5\u30bb\u30c3\u30c8\u306e\u6642\u306e\u6210\u5206)\n- timezone_minute (\u6642\u9593\u5e2f\u30aa\u30d5\u30bb\u30c3\u30c8\u306e\u5206\u306e\u6210\u5206)\n- week (\u9031)\n- year (\u5e74)\n", "tags": ["PostgreSQL", "Ruby", "Rails", "ActiveRecord"]}