{"tags": ["AWS", "aws-cli", "cognito", "S3"], "context": " More than 1 year has passed since last update.\n\n\u524d\u63d0\u6761\u4ef6\n\nCognito (Identity)\u3078\u306e\u6a29\u9650\n\nCognito (Identity)\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\n\nAWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\n\n\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\nAWS CLI 1.8.3\n\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws --version\n\n\n\n\u7d50\u679c(\u4f8b)\n      aws-cli/1.8.3 Python/2.7.5 Darwin/13.4.0\n\n\n\n0 \u6e96\u5099\n\n0.1. \u8b58\u5225\u5b50\u30d7\u30fc\u30ebID\u306e\u6307\u5b9a\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nCOGNITO_IDPOOL_ID=<ID\u30d7\u30fc\u30eb\u306e\u8b58\u5225\u5b50>\n\n\n\u8b58\u5225\u5b50\u30d7\u30fc\u30eb\u540d\u306e\u5b58\u5728\u3059\u308b\u30ea\u30fc\u30b8\u30e7\u30f3\u3082\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nAWS_REGION='ap-northeast-1'\n\n\n\n0.2. S3\u30d0\u30b1\u30c3\u30c8\u540d\u306e\u6307\u5b9a\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nS3_BUCKET_NAME=<S3\u30d0\u30b1\u30c3\u30c8\u540d>\n\n\n\n0.3. \u30d5\u30a1\u30a4\u30eb\u540d\u306e\u6307\u5b9a\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nFILE_CONTENTS='post.html'\n\n\n\n1. \u30b3\u30f3\u30c6\u30f3\u30c4\u306e\u4f5c\u6210\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n        COGNITO_IDPOOL_ID: ${COGNITO_IDPOOL_ID}\n        AWS_REGION:        ${AWS_REGION}\n        S3_BUCKET_NAME:    ${S3_BUCKET_NAME}\n        FILE_CONTENTS:     ${FILE_CONTENTS}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\ncat << EOF > ${FILE_CONTENTS}\n      <!DOCTYPE html>\n      <meta charset=\"UTF-8\">\n      <script src=\"https://sdk.amazonaws.com/js/aws-sdk-2.2.0.min.js\"></script>\n      <title>\u304a\u554f\u3044\u5408\u308f\u305b\u30d5\u30a9\u30fc\u30e0</title>\n      <script>\n        var func = function(id) { return document.getElementById(id); };\n        AWS.config.region = \"${AWS_REGION}\";\n        AWS.config.credentials = new AWS.CognitoIdentityCredentials({IdentityPoolId: \"${COGNITO_IDPOOL_ID}\"});\n        AWS.config.credentials.get(function(err) {\n            if (!err) {\n                console.log(\"Cognito Identify Id: \" + AWS.config.credentials.identityId);\n            }\n        });\n\n        function uploadFile() {\n          AWS.config.region = '${AWS_REGION}';\n          var s3BucketName = \"${S3_BUCKET_NAME}\";\n          var now = new Date();\n          var obj = {\"title\": func(\"title\").value, \"mail\": func(\"mail\").value ,\"contents\": func(\"contents\").value, \"date\": now.toLocaleString()};\n          var s3 = new AWS.S3({params: {Bucket: s3BucketName}});\n          var blob = new Blob([JSON.stringify(obj, null, 2)], {type:'text/plain'});\n          s3.putObject({Key: \"uploads/\" +now.getTime()+\".txt\", ContentType: \"text/plain\", Body: blob, ACL: \"public-read\"},\n          function(err, data){\n            if(data !== null){\n              alert(\"\u304a\u554f\u3044\u5408\u308f\u305b\u5b8c\u4e86\u81f4\u3057\u307e\u3057\u305f\");\n            }\n            else{\n              alert(\"Upload Failed\" + err.message);\n            }\n          });\n        }\n      </script>\n\n      <div>\n        <div>\n          <form>\n            <table>\n              <tr>\n                <th>\u4ef6\u540d</th>\n                <td><input id=\"title\" type=\"text\" name=\"title\" maxlength=\"40\" value=\"\" /></td>\n              </tr>\n              <tr>\n                <th>\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9</th>\n                <td><input id=\"mail\" type=\"email\" name=\"mail\" size=\"20\" maxlength=\"50\" /></td>\n              </tr>\n              <tr>\n                <th>\u304a\u554f\u3044\u5408\u308f\u305b\u5185\u5bb9</th>\n                <td><textarea id=\"contents\" cols=\"70\" rows=\"6\" name=\"contents\"></textarea></td>\n              </tr>\n            </table>\n            <div>\n              <input onClick=\"uploadFile();\" type=\"button\" value=\"\u9001\u4fe1\" id=\"button\" />\n            </div>\n          </form>\n        </div>\n      </div>\nEOF\n\ncat ${FILE_CONTENTS}\n\n\n\n2. \u30b3\u30f3\u30c6\u30f3\u30c4\u306e\u8ee2\u9001\n\n\u30b3\u30de\u30f3\u30c9\naws s3 cp ${FILE_CONTENTS} \"s3://${S3_BUCKET_NAME}/\"\n\n\n\n\u7d50\u679c(\u4f8b)\n      upload: ./post.html to s3://example-handson-20150928/post.html\n\n\n\n\u5b8c\u4e86\n\n\u524d\u63d0\u6761\u4ef6\n========\n\n\nCognito (Identity)\u3078\u306e\u6a29\u9650\n-------------------\n\n* Cognito (Identity)\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\n\nAWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n-------------------\n\n* \u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\n  * AWS CLI 1.8.3\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws --version\n```\n\n```text:\u7d50\u679c(\u4f8b):\n      aws-cli/1.8.3 Python/2.7.5 Darwin/13.4.0\n```\n\n0 \u6e96\u5099\n======\n\n\n0.1. \u8b58\u5225\u5b50\u30d7\u30fc\u30ebID\u306e\u6307\u5b9a\n-------------------------\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nCOGNITO_IDPOOL_ID=<ID\u30d7\u30fc\u30eb\u306e\u8b58\u5225\u5b50>\n```\n\n\u8b58\u5225\u5b50\u30d7\u30fc\u30eb\u540d\u306e\u5b58\u5728\u3059\u308b\u30ea\u30fc\u30b8\u30e7\u30f3\u3082\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nAWS_REGION='ap-northeast-1'\n```\n\n\n0.2. S3\u30d0\u30b1\u30c3\u30c8\u540d\u306e\u6307\u5b9a\n-----------------------\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nS3_BUCKET_NAME=<S3\u30d0\u30b1\u30c3\u30c8\u540d>\n```\n\n\n0.3. \u30d5\u30a1\u30a4\u30eb\u540d\u306e\u6307\u5b9a\n---------------------\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nFILE_CONTENTS='post.html'\n```\n\n\n1. \u30b3\u30f3\u30c6\u30f3\u30c4\u306e\u4f5c\u6210\n===================\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n        COGNITO_IDPOOL_ID: ${COGNITO_IDPOOL_ID}\n        AWS_REGION:        ${AWS_REGION}\n        S3_BUCKET_NAME:    ${S3_BUCKET_NAME}\n        FILE_CONTENTS:     ${FILE_CONTENTS}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\ncat << EOF > ${FILE_CONTENTS}\n      <!DOCTYPE html>\n      <meta charset=\"UTF-8\">\n      <script src=\"https://sdk.amazonaws.com/js/aws-sdk-2.2.0.min.js\"></script>\n      <title>\u304a\u554f\u3044\u5408\u308f\u305b\u30d5\u30a9\u30fc\u30e0</title>\n      <script>\n        var func = function(id) { return document.getElementById(id); };\n        AWS.config.region = \"${AWS_REGION}\";\n        AWS.config.credentials = new AWS.CognitoIdentityCredentials({IdentityPoolId: \"${COGNITO_IDPOOL_ID}\"});\n        AWS.config.credentials.get(function(err) {\n            if (!err) {\n                console.log(\"Cognito Identify Id: \" + AWS.config.credentials.identityId);\n            }\n        });\n\n        function uploadFile() {\n          AWS.config.region = '${AWS_REGION}';\n          var s3BucketName = \"${S3_BUCKET_NAME}\";\n          var now = new Date();\n          var obj = {\"title\": func(\"title\").value, \"mail\": func(\"mail\").value ,\"contents\": func(\"contents\").value, \"date\": now.toLocaleString()};\n          var s3 = new AWS.S3({params: {Bucket: s3BucketName}});\n          var blob = new Blob([JSON.stringify(obj, null, 2)], {type:'text/plain'});\n          s3.putObject({Key: \"uploads/\" +now.getTime()+\".txt\", ContentType: \"text/plain\", Body: blob, ACL: \"public-read\"},\n          function(err, data){\n            if(data !== null){\n              alert(\"\u304a\u554f\u3044\u5408\u308f\u305b\u5b8c\u4e86\u81f4\u3057\u307e\u3057\u305f\");\n            }\n            else{\n              alert(\"Upload Failed\" + err.message);\n            }\n          });\n        }\n      </script>\n\n      <div>\n        <div>\n          <form>\n            <table>\n              <tr>\n                <th>\u4ef6\u540d</th>\n                <td><input id=\"title\" type=\"text\" name=\"title\" maxlength=\"40\" value=\"\" /></td>\n              </tr>\n              <tr>\n                <th>\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9</th>\n                <td><input id=\"mail\" type=\"email\" name=\"mail\" size=\"20\" maxlength=\"50\" /></td>\n              </tr>\n              <tr>\n                <th>\u304a\u554f\u3044\u5408\u308f\u305b\u5185\u5bb9</th>\n                <td><textarea id=\"contents\" cols=\"70\" rows=\"6\" name=\"contents\"></textarea></td>\n              </tr>\n            </table>\n            <div>\n              <input onClick=\"uploadFile();\" type=\"button\" value=\"\u9001\u4fe1\" id=\"button\" />\n            </div>\n          </form>\n        </div>\n      </div>\nEOF\n\ncat ${FILE_CONTENTS}\n```\n\n2. \u30b3\u30f3\u30c6\u30f3\u30c4\u306e\u8ee2\u9001\n===================\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws s3 cp ${FILE_CONTENTS} \"s3://${S3_BUCKET_NAME}/\"\n```\n\n```text:\u7d50\u679c(\u4f8b)\n      upload: ./post.html to s3://example-handson-20150928/post.html\n```\n\n\n\u5b8c\u4e86\n====\n"}