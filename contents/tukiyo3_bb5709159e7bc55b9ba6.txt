{"context": " More than 1 year has passed since last update.CentOS6.5\u3067DRBD 8.4\u3092\u8a66\u3057\u3066\u307f\u305f - Qiita\nCentOS7\u306bdrbd\u304c\u7121\u3044CentOS7\u7528drbd\u30d1\u30c3\u30b1\u30fc\u30b8\u7528\u610f\u3055\u308c\u307e\u3057\u305f\n\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u3069\u3046\u3057\u3088\u3046\u304b\u3068\u601d\u3063\u305f\u304cglusterfs\u304c\u3042\u3063\u305f\u306e\u3067\u4f7f\u3063\u3066\u307f\u305f\u3002\n\nglusterfs\u306fxfs\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nGlusterFS\u3092\u5546\u7528\u5316\u3057\u3001\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba\u5411\u3051\u306b\u63d0\u4f9b\u3059\u308b\u306e\u304c\u300cRed Hat Storage\u300d\n\nCentOS6\u3067\u306fglusterfs\u306f\u5916\u90e8\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u306a\u304f\u3066\u3082\u7528\u610f\u3055\u308c\u3066\u3044\u308b glusterfs-server\u304c\u306a\u3044\n\n\u53c2\u8003:\n\nCentOS - GlusterFS - Qiita\n\u30a4\u30f3\u30d5\u30e9\u672c\u8217 - \u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 Linux Web\u30a2\u30d7\u30ea Windows \u69cb\u7bc9\n\n\nDRBD\u3068\u306e\u6bd4\u8f03\n\nDRBD\u306f2\u53f0\u3067\u69cb\u6210\u3002\nGlusterfS\u306f3\u53f0\u4ee5\u4e0a\u3067\u69cb\u6210\n\n\n\u30c6\u30b9\u30c8\u74b0\u5883\n\n192.168.100.11 server1\n192.168.100.12 server2\n\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u8ffd\u52a0\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u8ffd\u52a0\n# wget -P /etc/yum.repos.d/ \\\n http://download.gluster.org/pub/gluster/glusterfs/LATEST/CentOS/glusterfs-epel.repo\n\n\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# yum install -y glusterfs-server\n\n\n\nglusterd\u8d77\u52d5\n\nglusterd\u8d77\u52d5\n# systemctl start glusterd\n# systemctl enable glusterd\n\n\n\ngluster\u306epeer\u767b\u9332\n# gluster peer status\n# gluster peer probe 192.168.100.11\n192.168.100.12\u5074\u3067\u5b9f\u65bd\n# gluster peer status\n\n\nvolume\u4f5c\u6210\n# gluster volume create mysql_volume \\\n replica 2 \\\n 192.168.100.11:/srv/glusterfs/ \\\n 192.168.100.12:/srv/glusterfs/ \\\n force\n\n# gluster volume start mysql_volume\n# gluster volume info\n# gluster volume status\n\n\n\u5b9f\u969b\u306b\u4f7f\u3063\u3066\u307f\u308b\n\n\u4e21\u65b9\u306e\u30b5\u30fc\u30d0\u3067\u5b9f\u65bd\n# mount -t glusterfs localhost:/mysql_volume /var/lib/mysql/\n\n\n\n192.168.100.11\u3067\u5b9f\u65bd\n# date > /var/lib/mysql/a.txt\n\n\n\n192.168.100.12\u3067\u5b9f\u65bd\n# ls /var/lib/mysql/\na.txt\u304c\u5b58\u5728\u3059\u308b\u3053\u3068\u3002\n\n\n\ngluster\u306b3\u53f0\u76ee\u3092\u8ffd\u52a0\n\n192.168.100.13\n\n\n192.168.100.11\u306b\u3066\u5b9f\u65bd\n# gluster peer probe 192.168.100.13\n# gluster volume add-brick mysql_volume replica 3 192.168.100.13:/srv/glusterfs/ force\n\n\n\n192.168.100.13\u306b\u3066\u5b9f\u65bd\n# gluster volume start mysql_volume\n# mount -t glusterfs localhost:/mysql_volume /var/lib/mysql/\n\n\n\n\u969c\u5bb3\u30c6\u30b9\u30c8\n\n192.168.100.11\u3092\u518d\u8d77\u52d5\u3055\u305b\u308b\n192.168.100.11\u3068\u901a\u4fe1\u304c\u53d6\u308c\u306a\u3044\u6642\u306f\u4ed6\u306epeer\u304b\u3089/var/lib/mysql/\u306b62\u79d2\u9593\u30a2\u30af\u30bb\u30b9\u51fa\u6765\u306a\u3044\u30fb\u30fb\u30fb\u3002\n\n\n\u4ee5\u4e0b\u306fwatch date >> /var/lib/mysql/a.txt\u306e\u7d50\u679c\n\n\n\n\n\u969c\u5bb3\u30c6\u30b9\u30c8\n2014\u5e74 7\u6708 9\u65e5 \u6c34\u66dc\u65e5 13:21:55 JST\n2014\u5e74 7\u6708 9\u65e5 \u6c34\u66dc\u65e5 13:21:57 JST\n2014\u5e74 7\u6708 9\u65e5 \u6c34\u66dc\u65e5 13:21:59 JST\n2014\u5e74 7\u6708 9\u65e5 \u6c34\u66dc\u65e5 13:23:05 JST\n2014\u5e74 7\u6708 9\u65e5 \u6c34\u66dc\u65e5 13:23:07 JST\n2014\u5e74 7\u6708 9\u65e5 \u6c34\u66dc\u65e5 13:23:09 JST\n\n\n\nproxmox\u3067\u306e\u5229\u7528\u4f8b\n\n\n[CentOS6.5\u3067DRBD 8.4\u3092\u8a66\u3057\u3066\u307f\u305f - Qiita](http://qiita.com/tukiyo3/items/bba1b939fcf150b2cb56)\n\nCentOS7\u306b~~drbd\u304c\u7121\u3044~~[CentOS7\u7528drbd\u30d1\u30c3\u30b1\u30fc\u30b8\u7528\u610f\u3055\u308c\u307e\u3057\u305f](http://elrepo.org/tiki/tiki-index.php)\n\n\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u3069\u3046\u3057\u3088\u3046\u304b\u3068\u601d\u3063\u305f\u304cglusterfs\u304c\u3042\u3063\u305f\u306e\u3067\u4f7f\u3063\u3066\u307f\u305f\u3002\n\n* glusterfs\u306fxfs\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n* GlusterFS\u3092\u5546\u7528\u5316\u3057\u3001\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba\u5411\u3051\u306b\u63d0\u4f9b\u3059\u308b\u306e\u304c\u300cRed Hat Storage\u300d\n* ~~CentOS6\u3067\u306fglusterfs\u306f\u5916\u90e8\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u306a\u304f\u3066\u3082\u7528\u610f\u3055\u308c\u3066\u3044\u308b~~ glusterfs-server\u304c\u306a\u3044\n\n\u53c2\u8003:\n\n* [CentOS - GlusterFS - Qiita](http://qiita.com/mykysyk@github/items/ec5979c1c0a0b49a736b)\n* [\u30a4\u30f3\u30d5\u30e9\u672c\u8217 - \u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 Linux Web\u30a2\u30d7\u30ea Windows \u69cb\u7bc9](http://infra.makeall.net/)\n\n# DRBD\u3068\u306e\u6bd4\u8f03\n\n* DRBD\u306f2\u53f0\u3067\u69cb\u6210\u3002\n* GlusterfS\u306f3\u53f0\u4ee5\u4e0a\u3067\u69cb\u6210\n\n# \u30c6\u30b9\u30c8\u74b0\u5883\n\n* 192.168.100.11 server1\n* 192.168.100.12 server2\n\n## \u30ea\u30dd\u30b8\u30c8\u30ea\u8ffd\u52a0\n\n```bash:\u30ea\u30dd\u30b8\u30c8\u30ea\u8ffd\u52a0\n# wget -P /etc/yum.repos.d/ \\\n http://download.gluster.org/pub/gluster/glusterfs/LATEST/CentOS/glusterfs-epel.repo\n```\n\n## \u30d1\u30c3\u30b1\u30fc\u30b8\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash:\u30d1\u30c3\u30b1\u30fc\u30b8\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# yum install -y glusterfs-server\n```\n\n## glusterd\u8d77\u52d5\n\n```bash:glusterd\u8d77\u52d5\n# systemctl start glusterd\n# systemctl enable glusterd\n```\n\n## gluster\u306epeer\u767b\u9332\n\n```bash:\n# gluster peer status\n# gluster peer probe 192.168.100.11\n192.168.100.12\u5074\u3067\u5b9f\u65bd\n# gluster peer status\n```\n\n## volume\u4f5c\u6210\n\n```bash:\n# gluster volume create mysql_volume \\\n replica 2 \\\n 192.168.100.11:/srv/glusterfs/ \\\n 192.168.100.12:/srv/glusterfs/ \\\n force\n```\n\n```bash:\n# gluster volume start mysql_volume\n# gluster volume info\n# gluster volume status\n```\n\n# \u5b9f\u969b\u306b\u4f7f\u3063\u3066\u307f\u308b\n\n```bash:\u4e21\u65b9\u306e\u30b5\u30fc\u30d0\u3067\u5b9f\u65bd\n# mount -t glusterfs localhost:/mysql_volume /var/lib/mysql/\n```\n\n```bash:192.168.100.11\u3067\u5b9f\u65bd\n# date > /var/lib/mysql/a.txt\n```\n\n```bash:192.168.100.12\u3067\u5b9f\u65bd\n# ls /var/lib/mysql/\na.txt\u304c\u5b58\u5728\u3059\u308b\u3053\u3068\u3002\n```\n\n# gluster\u306b3\u53f0\u76ee\u3092\u8ffd\u52a0\n\n* 192.168.100.13\n\n```bash:192.168.100.11\u306b\u3066\u5b9f\u65bd\n# gluster peer probe 192.168.100.13\n# gluster volume add-brick mysql_volume replica 3 192.168.100.13:/srv/glusterfs/ force\n```\n\n```bash:192.168.100.13\u306b\u3066\u5b9f\u65bd\n# gluster volume start mysql_volume\n# mount -t glusterfs localhost:/mysql_volume /var/lib/mysql/\n```\n\n# \u969c\u5bb3\u30c6\u30b9\u30c8\n\n1. 192.168.100.11\u3092\u518d\u8d77\u52d5\u3055\u305b\u308b\n2. 192.168.100.11\u3068\u901a\u4fe1\u304c\u53d6\u308c\u306a\u3044\u6642\u306f\u4ed6\u306epeer\u304b\u3089/var/lib/mysql/\u306b62\u79d2\u9593\u30a2\u30af\u30bb\u30b9\u51fa\u6765\u306a\u3044\u30fb\u30fb\u30fb\u3002\n * \u4ee5\u4e0b\u306f`watch date >> /var/lib/mysql/a.txt`\u306e\u7d50\u679c\n\n```bash:\u969c\u5bb3\u30c6\u30b9\u30c8\n2014\u5e74 7\u6708 9\u65e5 \u6c34\u66dc\u65e5 13:21:55 JST\n2014\u5e74 7\u6708 9\u65e5 \u6c34\u66dc\u65e5 13:21:57 JST\n2014\u5e74 7\u6708 9\u65e5 \u6c34\u66dc\u65e5 13:21:59 JST\n2014\u5e74 7\u6708 9\u65e5 \u6c34\u66dc\u65e5 13:23:05 JST\n2014\u5e74 7\u6708 9\u65e5 \u6c34\u66dc\u65e5 13:23:07 JST\n2014\u5e74 7\u6708 9\u65e5 \u6c34\u66dc\u65e5 13:23:09 JST\n```\n\n# proxmox\u3067\u306e\u5229\u7528\u4f8b\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2014-07-09 13.31.13.png](https://qiita-image-store.s3.amazonaws.com/0/25728/d6f0b5bd-cec7-7762-b21d-22122dcfe822.png)\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2014-07-09 13.32.03.png](https://qiita-image-store.s3.amazonaws.com/0/25728/99e46a29-ffa0-c053-d4c3-daabe619fd96.png)\n", "tags": ["CentOS", "GlusterFS"]}