{"context": "\n\n\u672c\u8a18\u4e8b\u3092\u8aad\u3080\u524d\u306e\u6ce8\u610f\u4e8b\u9805\n\u73fe\u5728\u3067\u306fAWS\u306bUser Pools\u3068\u3044\u3046\u6a5f\u80fd\u304c\u3042\u308a\u307e\u3059\u3002\n\u305d\u3061\u3089\u3092\u5229\u7528\u3057\u3066\u4f1a\u54e1\u767b\u9332\u6a5f\u80fd\u3092\u5b9f\u88c5\u3057\u305f\u307b\u3046\u304c\u9065\u304b\u306b\u52b9\u7387\u304c\u826f\u3044\u3067\u3059\u3002Amazon Cognito User Pools\u3092\u4f7f\u3063\u3066\u3001web\u30b5\u30a4\u30c8\u306b\u30e6\u30fc\u30b6\u8a8d\u8a3c\u57fa\u76e4\u3092\u4f5c\u308b\u3092\u3054\u53c2\u7167\u304f\u3060\u3055\u3044\n\n\u6982\u8981\n\u30d5\u30a9\u30fc\u30e0\u304b\u3089\u4f1a\u54e1\u60c5\u5831\u3092\u767b\u9332\u3002\u767b\u9332\u5b8c\u4e86\u306e\u65e8\u3092\u30e6\u30fc\u30b6\u306b\u901a\u77e5\u3059\u308b\u4ed5\u7d44\u307f\u3092\u30b5\u30fc\u30d0\u30ec\u30b9\u3067\u4f5c\u3063\u3066\u307f\u307e\u3059\n\n\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\n\n\nAPI Gateway \u2192 Lmabda \u2192 DynamoDB\n\nPOST\u306e\u30c7\u30fc\u30bf\u3092Lambda\u5074\u3067json\u3067\u6271\u3048\u308b\u3088\u3046\u8a2d\u5b9a\n\nregister.html\n<form method=\"post\" action=\"API Gateway\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\">\n  <input type=\"text\" name=\"email\" value=\"\"/>\n  <input type=\"password\" name=\"password\" value=\"\"/>\n  <input type=\"submit\" value=\"Send\">\n</form>\n\n\n\u30d5\u30a9\u30fc\u30e0\u306e\u9001\u4fe1\u5148\u306bAPI Gateway\u3092\u30bb\u30c3\u30c8\u3057\u307e\u3059\u3002HTML\u30d5\u30a9\u30fc\u30e0\u304b\u3089APIGateway\u3092\u4f7f\u3063\u3066AWS Lambda\u306bPOST\u3059\u308b\u3092\u53c2\u8003\u306b\u3057\u3066\u3001POST\u306e\u30c7\u30fc\u30bf\u3092Lambda\u5074\u3067json\u3067\u6271\u3048\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\u6b63\u5e38\u306b\u51e6\u7406\u304c\u7d42\u4e86\u3059\u308c\u3070\u30b5\u30f3\u30ad\u30e5\u30fc\u30da\u30fc\u30b8\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\nDynamoDB\u306b\u30c7\u30fc\u30bf\u304c\u767b\u9332\u3067\u304d\u308c\u3070\u3001\u30b5\u30f3\u30ad\u30e5\u30fc\u30da\u30fc\u30b8\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3059\u308b\u3088\u3046\u306bAPI Gateway\u3092\u8a2d\u5b9a\u3057\u307e\u3057\u3087\u3046\u3002\n\nMethod Response\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066302\u30d8\u30c3\u30c0\u306e\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002\n\n302\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u30b3\u30fc\u30c9\u3092\u4f5c\u308a\u3001Location\u30d8\u30c3\u30c0\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\nIntegration Response\u306e\u753b\u9762\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3001Header Mapping\u306b\u3066integration.response.body.location\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\nformtest.js\ndynamo.putItem(dynamoRequest, function(err, data){\n      if (err) {\n        console.log(err);\n      } else {\n        context.succeed({location:\"\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u5148URL\"});\n      }\n    });\n\n\n\u3053\u3046\u3057\u3066API Gateway\u306e\u51e6\u7406\u3059\u308bLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306econtext\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3055\u305b\u305flocation\u3092\u6e21\u3059\u3053\u3068\u3067\u51e6\u7406\u6210\u529f\u6642\u306b302\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3057\u307e\u3059\u3002\u3053\u3053\u306b\u30b5\u30f3\u30ad\u30e5\u30fc\u30da\u30fc\u30b8\u306eURL\u3092\u8a2d\u5b9a\u3059\u308c\u3070OK\u3067\u3059\u3002\n\nDynamoDB \u2192 Lmabda \u2192 SES\nDynamoDB\u30c8\u30ea\u30ac\u30fc\u306e\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002\u305d\u3057\u3066\u305d\u306eLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u304b\u3089SES\u3078\u30b5\u30f3\u30ad\u30e5\u30fc\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3057\u307e\u3059\u3002\n'use strict';\nconsole.log('Loading function');\nvar aws = require('aws-sdk');\naws.config.update({region: \"us-east-1\"});\nvar ses = new aws.SES();\n\nexports.handler = (event, context, callback) => {\n    event.Records.forEach((record) => {\n        console.log(record.eventID);\n        console.log(record.eventName);\n        console.log('DynamoDB Record: %j', record.dynamodb);\n\n\n        var params = {\n                Destination: {\n                    ToAddresses: [\n                        record.dynamodb.Keys.email.S\n                    ]\n                },\n                Message: {\n\n                    Subject: {\n                        Data: 'Thank you for subscribing our site'\n                    },\n\n                    Body: {\n                        Text: {\n                            Data: 'Thank you!Thank you!PanPanPan!'\n                        }\n                    }\n                },\n                Source: '<your from address>'\n            };\n         ses.sendEmail(params, function (err, data) {\n                if (err) {\n                    console.log(err, err.stack);\n                    context.fail('Internal Error: The email could not be sent.');\n                } else {\n                    console.log(data);           // successful response\n                    context.succeed('The email was successfully sent to ' + event.email);\n                }\n            });\n    });\n};\n\n\u30d5\u30a9\u30fc\u30e0\u304b\u3089\u306e\u767b\u9332\u5f8c\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3061\u3083\u3093\u3068\u30e1\u30fc\u30eb\u5c4a\u3044\u3066\u307e\u3057\u305f\n\n\u4f1a\u54e1\u767b\u9332\u3057\u305f\u3060\u3051\u3058\u3083\u306a\u306b\u3082\u306a\u3089\u3093\u306e\u3067\u3001\u6b21\u56de\u306f\u30b5\u30fc\u30d0\u30ec\u30b9\u3067\u306e\u30ed\u30b0\u30a4\u30f3\u3001\u30ed\u30b0\u30a2\u30a6\u30c8\u51e6\u7406\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n##\u672c\u8a18\u4e8b\u3092\u8aad\u3080\u524d\u306e\u6ce8\u610f\u4e8b\u9805\n\u73fe\u5728\u3067\u306fAWS\u306bUser Pools\u3068\u3044\u3046\u6a5f\u80fd\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u305d\u3061\u3089\u3092\u5229\u7528\u3057\u3066\u4f1a\u54e1\u767b\u9332\u6a5f\u80fd\u3092\u5b9f\u88c5\u3057\u305f\u307b\u3046\u304c\u9065\u304b\u306b\u52b9\u7387\u304c\u826f\u3044\u3067\u3059\u3002[Amazon Cognito User Pools\u3092\u4f7f\u3063\u3066\u3001web\u30b5\u30a4\u30c8\u306b\u30e6\u30fc\u30b6\u8a8d\u8a3c\u57fa\u76e4\u3092\u4f5c\u308b](http://qiita.com/horike37/items/1d522f66452d3abe1203)\u3092\u3054\u53c2\u7167\u304f\u3060\u3055\u3044\n\n## \u6982\u8981\n\u30d5\u30a9\u30fc\u30e0\u304b\u3089\u4f1a\u54e1\u60c5\u5831\u3092\u767b\u9332\u3002\u767b\u9332\u5b8c\u4e86\u306e\u65e8\u3092\u30e6\u30fc\u30b6\u306b\u901a\u77e5\u3059\u308b\u4ed5\u7d44\u307f\u3092\u30b5\u30fc\u30d0\u30ec\u30b9\u3067\u4f5c\u3063\u3066\u307f\u307e\u3059\n\n## \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\n![\u4f1a\u54e1\u767b\u9332.png](https://qiita-image-store.s3.amazonaws.com/0/65478/0704602f-fd38-3ce7-249c-6eb77a812e6b.png)\n\n\n## API Gateway \u2192 Lmabda \u2192 DynamoDB\n### POST\u306e\u30c7\u30fc\u30bf\u3092Lambda\u5074\u3067json\u3067\u6271\u3048\u308b\u3088\u3046\u8a2d\u5b9a\n``` register.html\n<form method=\"post\" action=\"API Gateway\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\">\n  <input type=\"text\" name=\"email\" value=\"\"/>\n  <input type=\"password\" name=\"password\" value=\"\"/>\n  <input type=\"submit\" value=\"Send\">\n</form>\n```\n\u30d5\u30a9\u30fc\u30e0\u306e\u9001\u4fe1\u5148\u306bAPI Gateway\u3092\u30bb\u30c3\u30c8\u3057\u307e\u3059\u3002[HTML\u30d5\u30a9\u30fc\u30e0\u304b\u3089APIGateway\u3092\u4f7f\u3063\u3066AWS Lambda\u306bPOST\u3059\u308b](http://qiita.com/satetsu888/items/40fc387735192b794da8)\u3092\u53c2\u8003\u306b\u3057\u3066\u3001POST\u306e\u30c7\u30fc\u30bf\u3092Lambda\u5074\u3067json\u3067\u6271\u3048\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n### \u6b63\u5e38\u306b\u51e6\u7406\u304c\u7d42\u4e86\u3059\u308c\u3070\u30b5\u30f3\u30ad\u30e5\u30fc\u30da\u30fc\u30b8\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\nDynamoDB\u306b\u30c7\u30fc\u30bf\u304c\u767b\u9332\u3067\u304d\u308c\u3070\u3001\u30b5\u30f3\u30ad\u30e5\u30fc\u30da\u30fc\u30b8\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3059\u308b\u3088\u3046\u306bAPI Gateway\u3092\u8a2d\u5b9a\u3057\u307e\u3057\u3087\u3046\u3002\n\n<img width=\"778\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-04-13 9.53.36.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/65478/c1ff28fd-659a-a8e0-29be-75d59e27a4b7.png\">\nMethod Response\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066302\u30d8\u30c3\u30c0\u306e\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002\n\n<img width=\"742\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-04-13 10.09.49.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/65478/551b6d48-1c02-fca3-637e-23cec874cfcf.png\">\n302\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u30b3\u30fc\u30c9\u3092\u4f5c\u308a\u3001Location\u30d8\u30c3\u30c0\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n<img width=\"776\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-04-13 10.10.17.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/65478/04afa391-b033-26ac-3e42-4286dff5a1ba.png\">\n\nIntegration Response\u306e\u753b\u9762\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3001Header Mapping\u306b\u3066`integration.response.body.location`\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\n```js:formtest.js\ndynamo.putItem(dynamoRequest, function(err, data){\n      if (err) {\n        console.log(err);\n      } else {\n        context.succeed({location:\"\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u5148URL\"});\n      }\n    });\n```\n\u3053\u3046\u3057\u3066API Gateway\u306e\u51e6\u7406\u3059\u308bLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306econtext\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3055\u305b\u305flocation\u3092\u6e21\u3059\u3053\u3068\u3067\u51e6\u7406\u6210\u529f\u6642\u306b302\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3057\u307e\u3059\u3002\u3053\u3053\u306b\u30b5\u30f3\u30ad\u30e5\u30fc\u30da\u30fc\u30b8\u306eURL\u3092\u8a2d\u5b9a\u3059\u308c\u3070OK\u3067\u3059\u3002\n\n## DynamoDB \u2192 Lmabda \u2192 SES\nDynamoDB\u30c8\u30ea\u30ac\u30fc\u306e\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002\u305d\u3057\u3066\u305d\u306eLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u304b\u3089SES\u3078\u30b5\u30f3\u30ad\u30e5\u30fc\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3057\u307e\u3059\u3002\n\n```js\n'use strict';\nconsole.log('Loading function');\nvar aws = require('aws-sdk');\naws.config.update({region: \"us-east-1\"});\nvar ses = new aws.SES();\n\nexports.handler = (event, context, callback) => {\n    event.Records.forEach((record) => {\n        console.log(record.eventID);\n        console.log(record.eventName);\n        console.log('DynamoDB Record: %j', record.dynamodb);\n\n\n        var params = {\n                Destination: {\n                    ToAddresses: [\n                        record.dynamodb.Keys.email.S\n                    ]\n                },\n                Message: {\n                    \n                    Subject: {\n                        Data: 'Thank you for subscribing our site'\n                    },\n                    \n                    Body: {\n                        Text: {\n                            Data: 'Thank you!Thank you!PanPanPan!'\n                        }\n                    }\n                },\n                Source: '<your from address>'\n            };\n         ses.sendEmail(params, function (err, data) {\n                if (err) {\n                    console.log(err, err.stack);\n                    context.fail('Internal Error: The email could not be sent.');\n                } else {\n                    console.log(data);           // successful response\n                    context.succeed('The email was successfully sent to ' + event.email);\n                }\n            });\n    });\n};\n```\n\n\u30d5\u30a9\u30fc\u30e0\u304b\u3089\u306e\u767b\u9332\u5f8c\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3061\u3083\u3093\u3068\u30e1\u30fc\u30eb\u5c4a\u3044\u3066\u307e\u3057\u305f\n<img width=\"350\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-04-13 10.07.11.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/65478/98ea5171-df67-275e-6b94-13ac034ed21b.png\">\n\n\u4f1a\u54e1\u767b\u9332\u3057\u305f\u3060\u3051\u3058\u3083\u306a\u306b\u3082\u306a\u3089\u3093\u306e\u3067\u3001\u6b21\u56de\u306f\u30b5\u30fc\u30d0\u30ec\u30b9\u3067\u306e\u30ed\u30b0\u30a4\u30f3\u3001\u30ed\u30b0\u30a2\u30a6\u30c8\u51e6\u7406\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n", "tags": ["AWS", "lambda", "DynamoDB", "APIGateway", "amazonses"]}