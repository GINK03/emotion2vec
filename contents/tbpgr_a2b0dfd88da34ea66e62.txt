{"context": " More than 1 year has passed since last update.\n\nHubot | \u81ea\u4f5cScript | gitlab_ci_sample.coffee - GitLab CI\u3068\u306e\u9023\u643a\u3092\u691c\u8a3c\u3059\u308b\u30b5\u30f3\u30d7\u30eb\n\n\u6982\u8981\nGitLab CI \u3068\u306e \u9023\u643a\u3092\u691c\u8a3c\u3059\u308b\u30b5\u30f3\u30d7\u30eb script \u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nGitLab CI \u306e Web hooks \u3068\u3001 Hubot \u306e Web \u30b5\u30fc\u30d0\u30fc\u6a5f\u80fd\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n\u4ed5\u69d8\n\nfilename\ngitlab_ci_sample.coffee\n\nHubot gitlab \u691c\u8a3c\u7528URL\n\nhttp://hubot_url:8080/gitlab_ci/hook\n\n\n\u4ed5\u69d8\u88dc\u8db3\nGitLab CI \u306e Web Hook \u304c\u8fd4\u5374\u3057\u3066\u304f\u308b json \u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u3064\u3044\u3066\u306f\u4e0b\u8a18\u53c2\u7167\n  {\n      \"build_id\": 2,\n      \"build_status\": \"failed\",\n      \"build_started_at\": \"2014-05-05T18:01:02.563Z\",\n      \"build_finished_at\": \"2014-05-05T18:01:07.611Z\",\n      \"project_id\": 1,\n      \"project_name\": \"Brightbox \\/ Brightbox Cli\",\n      \"gitlab_url\": \"http:\\/\\/localhost:3000\\/brightbox\\/brightbox-cli\",\n      \"ref\": \"master\",\n      \"sha\": \"a26cf5de9ed9827746d4970872376b10d9325f40\",\n      \"before_sha\": \"34f57f6ba3ed0c21c5e361bbb041c3591411176c\",\n      \"push_data\": {\n        \"before\": \"34f57f6ba3ed0c21c5e361bbb041c3591411176c\",\n        \"after\": \"a26cf5de9ed9827746d4970872376b10d9325f40\",\n        \"ref\": \"refs\\/heads\\/master\",\n        \"user_id\": 1,\n        \"user_name\": \"Administrator\",\n        \"project_id\": 5,\n        \"repository\": {\n          \"name\": \"Brightbox Cli\",\n          \"url\": \"dzaporozhets@localhost:brightbox\\/brightbox-cli.git\",\n          \"description\": \"Voluptatibus quae error consectetur voluptas dolores vel excepturi possimus.\",\n          \"homepage\": \"http:\\/\\/localhost:3000\\/brightbox\\/brightbox-cli\"\n        },\n        \"commits\": [\n          {\n            \"id\": \"a26cf5de9ed9827746d4970872376b10d9325f40\",\n            \"message\": \"Release v1.2.2\",\n            \"timestamp\": \"2014-04-22T16:46:42+03:00\",\n            \"url\": \"http:\\/\\/localhost:3000\\/brightbox\\/brightbox-cli\\/commit\\/a26cf5de9ed9827746d4970872376b10d9325f40\",\n            \"author\": {\n              \"name\": \"Paul Thornthwaite\",\n              \"email\": \"tokengeek@gmail.com\"\n            }\n          },\n          {\n            \"id\": \"34f57f6ba3ed0c21c5e361bbb041c3591411176c\",\n            \"message\": \"Fix server user data update\\n\\nIncorrect condition was being used so Base64 encoding option was having\\nopposite effect from desired.\",\n            \"timestamp\": \"2014-04-11T18:17:26+03:00\",\n            \"url\": \"http:\\/\\/localhost:3000\\/brightbox\\/brightbox-cli\\/commit\\/34f57f6ba3ed0c21c5e361bbb041c3591411176c\",\n            \"author\": {\n              \"name\": \"Paul Thornthwaite\",\n              \"email\": \"tokengeek@gmail.com\"\n            }\n          }\n        ],\n        \"total_commits_count\": 2,\n      }\n    }\n\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\ncoffee:gitlab_ci_sample.coffee\nmodule.exports = (robot) ->\n  say = (message) ->\n    user = {\n      room :\n        id : 2\n    }\n\n    robot.send user, message\n\n  robot.router.post \"/gitlab_ci/hook\", (req, res) ->\n    json  = req.body\n    say \"GitLab CI issue\"\n    say \"project_name = #{json['project_name']}\"\n    status = json['build_status']\n    icon = status == 'failed' ? ':skull:' : ':angel:'\n    say \"build_status = #{icon} #{status}\"\n    say \"branch = #{json['ref']}\"\n    say json['gitlab_url']\n\n    res.send 200\n\n\n\u524d\u63d0\n\nKandan 1.1\nHubot 2.4.7\nGitLab 7.0\nGitLab CI 5.0.1\nGitLab CI Runner 5.0.1\n\n\u203bGitLab - GitLab CI - GitLab CI Runner \u306f\u9023\u643a\u6e08\u307f\n\n\u5bfe\u8c61\u30ea\u30dd\u30b8\u30c8\u30ea\u306f\u81ea\u4f5c gem \u306e gottani \u3092 GitLab\u306b\u4fdd\u5b58\u3057\u305f\u3082\u306e\n\nhttps://github.com/tbpgr/gottani\n\u3053\u308c\u3092\u305d\u306e\u307e\u307e GitLab \u306b\u653e\u308a\u8fbc\u3093\u3067\u307e\u3059\u3002\n\n\u624b\u9806\n\ngitlab_ci_sample.coffee \u3092\u914d\u7f6e\ngitlab_ci_sample.coffee \u3092 hubot \u30b5\u30fc\u30d0\u30fc\u306e scripts \u914d\u4e0b\u306b\u4fdd\u5b58\u3059\u308b\u3002\n\nHubot \u306e\u518d\u8d77\u52d5\n\n\u30d6\u30e9\u30a6\u30b6\u3067 GitLab CI \u306e Web hooks \u3092\u8ffd\u52a0\u3059\u308b\nURL \u306f http://hubot_path:8080/gitlab_ci/hook \u306b\u8a2d\u5b9a\u3002\ngitlab/hook \u306e\u90e8\u5206\u306f gitlab_ci_sample.coffee \u306e\nrobot.router.post \"/gitlab_ci/hook\", (req, res) ->\n\n\u306e\u90e8\u5206\u306b\u5bfe\u5fdc\u3002\n\n\n\u78ba\u8a8d\n\nGitLab \u3078 push \u3057\u307e\u3059\n\n$ git commit -m \"test for gitlab-gitlab ci-kandan-hubot test\"\n$ git push origin master\n\n\nGitLab CI \u306e\u30c6\u30b9\u30c8\u958b\u59cb\u3092\u78ba\u8a8d\n\n\n\nGitLab CI \u306e\u30c6\u30b9\u30c8\u7d42\u4e86\u3092\u78ba\u8a8d\n\n\n\nKandan \u3067 Hubot \u306e\u53cd\u5fdc\u3092\u78ba\u8a8d\u3057\u307e\u3059(\u6210\u529f\u6642)\n\n\n\nKandan \u3067 Hubot \u306e\u53cd\u5fdc\u3092\u78ba\u8a8d\u3057\u307e\u3059(\u5931\u6557\u6642)\n\n\n\n\u88dc\u8db3\n\u4eca\u306e\u3068\u3053\u308d\u3001 npm \u3067\u516c\u958b\u3057\u305f\u308a\u3059\u308b\u4e88\u5b9a\u306f\u306a\u3044\u306e\u3067\u9069\u5f53\u306bGitHub\u306b\u7a81\u3063\u8fbc\u3093\u3067\u304a\u304d\u307e\u3059\u3002\nhttps://github.com/tbpgr/hubot_scripts\n# Hubot | \u81ea\u4f5cScript | gitlab_ci_sample.coffee - GitLab CI\u3068\u306e\u9023\u643a\u3092\u691c\u8a3c\u3059\u308b\u30b5\u30f3\u30d7\u30eb\n\n## \u6982\u8981\nGitLab CI \u3068\u306e \u9023\u643a\u3092\u691c\u8a3c\u3059\u308b\u30b5\u30f3\u30d7\u30eb script \u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nGitLab CI \u306e Web hooks \u3068\u3001 Hubot \u306e Web \u30b5\u30fc\u30d0\u30fc\u6a5f\u80fd\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n## \u4ed5\u69d8\n### filename\ngitlab_ci_sample.coffee\n\n### Hubot gitlab \u691c\u8a3c\u7528URL\n* http://hubot_url:8080/gitlab_ci/hook\n\n### \u4ed5\u69d8\u88dc\u8db3\nGitLab CI \u306e Web Hook \u304c\u8fd4\u5374\u3057\u3066\u304f\u308b json \u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u3064\u3044\u3066\u306f\u4e0b\u8a18\u53c2\u7167\n\n~~~json\n  {\n      \"build_id\": 2,\n      \"build_status\": \"failed\",\n      \"build_started_at\": \"2014-05-05T18:01:02.563Z\",\n      \"build_finished_at\": \"2014-05-05T18:01:07.611Z\",\n      \"project_id\": 1,\n      \"project_name\": \"Brightbox \\/ Brightbox Cli\",\n      \"gitlab_url\": \"http:\\/\\/localhost:3000\\/brightbox\\/brightbox-cli\",\n      \"ref\": \"master\",\n      \"sha\": \"a26cf5de9ed9827746d4970872376b10d9325f40\",\n      \"before_sha\": \"34f57f6ba3ed0c21c5e361bbb041c3591411176c\",\n      \"push_data\": {\n        \"before\": \"34f57f6ba3ed0c21c5e361bbb041c3591411176c\",\n        \"after\": \"a26cf5de9ed9827746d4970872376b10d9325f40\",\n        \"ref\": \"refs\\/heads\\/master\",\n        \"user_id\": 1,\n        \"user_name\": \"Administrator\",\n        \"project_id\": 5,\n        \"repository\": {\n          \"name\": \"Brightbox Cli\",\n          \"url\": \"dzaporozhets@localhost:brightbox\\/brightbox-cli.git\",\n          \"description\": \"Voluptatibus quae error consectetur voluptas dolores vel excepturi possimus.\",\n          \"homepage\": \"http:\\/\\/localhost:3000\\/brightbox\\/brightbox-cli\"\n        },\n        \"commits\": [\n          {\n            \"id\": \"a26cf5de9ed9827746d4970872376b10d9325f40\",\n            \"message\": \"Release v1.2.2\",\n            \"timestamp\": \"2014-04-22T16:46:42+03:00\",\n            \"url\": \"http:\\/\\/localhost:3000\\/brightbox\\/brightbox-cli\\/commit\\/a26cf5de9ed9827746d4970872376b10d9325f40\",\n            \"author\": {\n              \"name\": \"Paul Thornthwaite\",\n              \"email\": \"tokengeek@gmail.com\"\n            }\n          },\n          {\n            \"id\": \"34f57f6ba3ed0c21c5e361bbb041c3591411176c\",\n            \"message\": \"Fix server user data update\\n\\nIncorrect condition was being used so Base64 encoding option was having\\nopposite effect from desired.\",\n            \"timestamp\": \"2014-04-11T18:17:26+03:00\",\n            \"url\": \"http:\\/\\/localhost:3000\\/brightbox\\/brightbox-cli\\/commit\\/34f57f6ba3ed0c21c5e361bbb041c3591411176c\",\n            \"author\": {\n              \"name\": \"Paul Thornthwaite\",\n              \"email\": \"tokengeek@gmail.com\"\n            }\n          }\n        ],\n        \"total_commits_count\": 2,\n      }\n    }\n~~~\n\n\n## \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n\ncoffee:gitlab_ci_sample.coffee\n\n~~~coffeescript\nmodule.exports = (robot) ->\n  say = (message) ->\n    user = {\n      room :\n        id : 2\n    }\n\n    robot.send user, message\n\n  robot.router.post \"/gitlab_ci/hook\", (req, res) ->\n    json  = req.body\n    say \"GitLab CI issue\"\n    say \"project_name = #{json['project_name']}\"\n    status = json['build_status']\n    icon = status == 'failed' ? ':skull:' : ':angel:'\n    say \"build_status = #{icon} #{status}\"\n    say \"branch = #{json['ref']}\"\n    say json['gitlab_url']\n\n    res.send 200\n~~~\n\n## \u524d\u63d0\n* Kandan 1.1\n* Hubot 2.4.7\n* GitLab 7.0\n* GitLab CI 5.0.1\n* GitLab CI Runner 5.0.1\n\n\u203bGitLab - GitLab CI - GitLab CI Runner \u306f\u9023\u643a\u6e08\u307f\n\n* \u5bfe\u8c61\u30ea\u30dd\u30b8\u30c8\u30ea\u306f\u81ea\u4f5c gem \u306e gottani \u3092 GitLab\u306b\u4fdd\u5b58\u3057\u305f\u3082\u306e\n\nhttps://github.com/tbpgr/gottani\n\n\u3053\u308c\u3092\u305d\u306e\u307e\u307e GitLab \u306b\u653e\u308a\u8fbc\u3093\u3067\u307e\u3059\u3002\n\n## \u624b\u9806\n### gitlab_ci_sample.coffee \u3092\u914d\u7f6e\n\ngitlab_ci_sample.coffee \u3092 hubot \u30b5\u30fc\u30d0\u30fc\u306e scripts \u914d\u4e0b\u306b\u4fdd\u5b58\u3059\u308b\u3002\n\n### Hubot \u306e\u518d\u8d77\u52d5\n### \u30d6\u30e9\u30a6\u30b6\u3067 GitLab CI \u306e Web hooks \u3092\u8ffd\u52a0\u3059\u308b\n\nURL \u306f http://hubot_path:8080/gitlab_ci/hook \u306b\u8a2d\u5b9a\u3002\ngitlab/hook \u306e\u90e8\u5206\u306f gitlab_ci_sample.coffee \u306e\n\n~~~coffeescript\nrobot.router.post \"/gitlab_ci/hook\", (req, res) ->\n~~~\n\n\u306e\u90e8\u5206\u306b\u5bfe\u5fdc\u3002\n\n![hubot_gitlab_ci1.png](https://qiita-image-store.s3.amazonaws.com/0/43480/dda631d0-aef8-7995-90d4-dd1e99d3658d.png)\n\n## \u78ba\u8a8d\n* GitLab \u3078 push \u3057\u307e\u3059\n\n~~~bash\n$ git commit -m \"test for gitlab-gitlab ci-kandan-hubot test\"\n$ git push origin master\n~~~\n\n* GitLab CI \u306e\u30c6\u30b9\u30c8\u958b\u59cb\u3092\u78ba\u8a8d\n\n![hubot_gitlab_ci2.png](https://qiita-image-store.s3.amazonaws.com/0/43480/3e5d1a47-c2c5-faa4-40b4-36674f134821.png)\n\n* GitLab CI \u306e\u30c6\u30b9\u30c8\u7d42\u4e86\u3092\u78ba\u8a8d\n\n![hubot_gitlab_ci3.png](https://qiita-image-store.s3.amazonaws.com/0/43480/3abc97c8-cad1-4628-c696-60c54236630d.png)\n\n* Kandan \u3067 Hubot \u306e\u53cd\u5fdc\u3092\u78ba\u8a8d\u3057\u307e\u3059(\u6210\u529f\u6642)\n\n![hubot_gitlab_ci4.png](https://qiita-image-store.s3.amazonaws.com/0/43480/c1b6625c-020f-4b08-7eb5-d45e38c9c7e2.png)\n\n* Kandan \u3067 Hubot \u306e\u53cd\u5fdc\u3092\u78ba\u8a8d\u3057\u307e\u3059(\u5931\u6557\u6642)\n\n![hubot_gitlab_ci5.png](https://qiita-image-store.s3.amazonaws.com/0/43480/c856dfd5-ed7f-92c9-71e1-eea1b475eba9.png)\n\n## \u88dc\u8db3\n\u4eca\u306e\u3068\u3053\u308d\u3001 npm \u3067\u516c\u958b\u3057\u305f\u308a\u3059\u308b\u4e88\u5b9a\u306f\u306a\u3044\u306e\u3067\u9069\u5f53\u306bGitHub\u306b\u7a81\u3063\u8fbc\u3093\u3067\u304a\u304d\u307e\u3059\u3002\nhttps://github.com/tbpgr/hubot_scripts\n", "tags": ["Hubot2.4.7", "GitLab7", "GitLab-CI5.0.1", "kandan1.1", "GitLab-CI-Runner"]}