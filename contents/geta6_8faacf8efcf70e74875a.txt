{"context": " More than 1 year has passed since last update.osx\u3067\u30c9\u30e1\u30a4\u30f3\u30d9\u30fc\u30b9\u3067\u6319\u52d5\u304c\u5909\u308f\u308b\u3088\u3046\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u958b\u767a\u3059\u308b\u6642\u3001\u2193\u306e\u3088\u3046\u306a\u611f\u3058\u3067/etc/hosts\u306b\u4f7f\u7528\u3059\u308b(\u30b5\u30d6)\u30c9\u30e1\u30a4\u30f3\u3092\u66f8\u304d\u9023\u306d\u3066\u3044\u304f\u82e6\u884c\u3092\u3057\u305f\u3053\u3068\u304c\u3042\u308b\u4eba\u306f\u591a\u3044\u3068\u601d\u3046\u3002\n127.0.0.1  localhost hoge.dev asset.hoge.dev secure.hoge.dev api.hoge.dev\n\n\u3053\u308c\u3092\u89e3\u6d88\u3059\u308b\u30c4\u30fc\u30eb\u3068\u3057\u3066pow\u3068\u304b\u304c\u3042\u3063\u305f\u308a\u3059\u308b\u3093\u3060\u3051\u3069\u3001\u52d5\u4f5c\u304c\u91cd\u304b\u3063\u305f\u308a\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5468\u308a\u3067\u30b3\u30b1\u305f\u308a\u3001\u6319\u52d5\u304c\u8b0e\u3060\u3063\u305f\u308a\u3001static\u3067\u8a2d\u7f6e\u3057\u305f404\u30d5\u30a1\u30a4\u30eb\u304c\u3061\u3083\u3093\u3068\u898b\u308c\u306a\u304b\u3063\u305f\u308a\u3001nginx\u306e\u8a2d\u5b9a\u3092\u8a66\u305b\u306a\u304b\u3063\u305f\u308a\u3001\u30c4\u30fc\u30eb\u306e\u4ed5\u69d8\u3084\u30d0\u30b0\u306b\u5f15\u3063\u5f35\u3089\u308c\u3066\u958b\u767a\u304c\u6ede\u308b\u3053\u3068\u3082\u3042\u308b\u3068\u601d\u3046\u3002\n\u305d\u3053\u3067dnsmasq\u3068resolver\u3092\u4f7f\u3063\u3066\u72ec\u81ea\u306b\u30c9\u30e1\u30a4\u30f3\u3092\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3001nginx\u304b\u3089proxy\u3092\u98db\u3070\u3057\u3066\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3078\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3088\u3046\u306a\u3001\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u306b\u9650\u308a\u306a\u304f\u8fd1\u3044\u958b\u767a\u74b0\u5883\u3092\u6e96\u5099\u3059\u308b\u3002\n\n\n/\\.dev$/\u3092127.0.0.1\u306eDNS\u30b5\u30fc\u30d0\u3067\u540d\u524d\u89e3\u6c7a\u3055\u305b\u308b (resolver)\n\n/\\.dev$/\u306e\u540d\u524d\u3092127.0.0.1\u306b\u89e3\u6c7a\u3055\u305b\u308b (dnsmasq)\n\nhoge.dev *.hoge.dev\u3092\u7279\u5b9a\u306eupstream\u3078proxy\u3059\u308b (nginx)\n\n\nresolver\n/etc/resolver\u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u3042\u308b\u3068\u601d\u3046\u3001\u7121\u3051\u308c\u3070\u4f5c\u308b\u3002\n\u3053\u3053\u306b\u5f8c\u65b9\u4e00\u81f4\u306e\u5f62\u5f0f\u3067\u30de\u30c3\u30c1\u3055\u305b\u305f\u3044\u540d\u524d\u3092\u3064\u3051\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u3044\u3066\u3001\u4e2d\u306bresolve.conf\u3068\u540c\u3058\u5f62\u5f0f(resolver\u30d5\u30a9\u30fc\u30de\u30c3\u30c8)\u3067nameserver\u3092\u66f8\u3044\u3066\u3042\u3052\u308b\u3068\u3001\u305d\u306e\u30cd\u30fc\u30e0\u30b5\u30fc\u30d0\u3092\u4f7f\u3063\u3066\u304f\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n/hoge\\.dev$/\u306b\u30de\u30c3\u30c1\u3055\u305b\u305f\u3044\u306a\u3089hoge.dev\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u3059\u308b\u3002\n/\\.dev$/\u306b\u30de\u30c3\u30c1\u3055\u305b\u305f\u3044\u306a\u3089dev\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u3059\u308b\u3002\n\u4eca\u56de\u306f/etc/resolver/dev\u3092\u8a2d\u7f6e\u3057\u3066\u30ca\u30f3\u30c8\u30ab.dev\u3068\u3044\u3046\u30c9\u30e1\u30a4\u30f3\u3092\u5168\u90e8\u958b\u767a\u7528\u306b\u5229\u7528\u3059\u308b\u3002\n$ test [ -d /etc/resolver ] || sudo mkdir /etc/resolver\n$ echo 'nameserver 127.0.0.1' | sudo tee /etc/resolver/dev\nnameserver 127.0.0.1\n$ cat /etc/resolver/dev\nnameserver 127.0.0.1\n\n\ndnsmasq\n\u8d85\u304a\u624b\u8efdDNS\u30b5\u30fc\u30d0\u30fcdnsmasq\u3092homebrew\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066.dev\u3092127.0.0.1\u306b\u89e3\u6c7a\u3059\u308b\u3088\u3046\u8a2d\u5b9a\u3059\u308b\u3002address=/dev/127.0.0.1\u3068\u3044\u3046\u884c\u3092\u8ffd\u8a18\u3059\u308b\u3060\u3051\u3067\u3088\u3044\u3002\n\u2193\u3060\u3068\u9069\u5f53\u306b\u66f8\u304d\u8fbc\u3093\u3067\u308b\u3051\u3069\u3001\u3061\u3083\u3093\u3068\u66f8\u304d\u305f\u3044\u4eba\u306f80\u884c\u76ee\u304f\u3089\u3044\u306b\u3042\u308b#address=/double-click.net/127.0.0.1\u306e\u76f4\u4e0b\u3068\u304b\u306b\u66f8\u304f\u3068\u3044\u3044\u3068\u601d\u3046\u3002\n$ brew install dnsmasq\n$ cp /usr/local/opt/dnsmasq/dnsmasq.conf.example /usr/local/etc/dnsmasq.conf\n$ echo 'address=/dev/127.0.0.1' >> /usr/local/etc/dnsmasq.conf\n\nosx\u3067\u306fDNS\u30b5\u30fc\u30d0\u306e\u30dd\u30fc\u30c8\u3092\u4f7f\u3046\u306b\u306fsudo\u6a29\u9650\u304c\u5fc5\u8981\u306a\u306e\u3067\u3001launchd\u306e\u767b\u9332\u306f/Library/LaunchAgents\u304b\u3089sudo\u7d4c\u7531\u3067\u884c\u3046\u3088\u3046\u306b\u3059\u308b\u3002\u3053\u308c\u3067\u6b21\u56de\u306eOS\u8d77\u52d5\u6642\u306b\u81ea\u52d5\u3067\u7acb\u3061\u4e0a\u304c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n$ sudo cp /usr/local/opt/dnsmasq/*.plist /Library/LaunchAgents\n$ sudo launchctl load /Library/LaunchAgents/homebrew.mxcl.dnsmasq.plist\n\n\u3053\u308c\u3067dnsmasq\u304c\u8d77\u52d5\u3057\u3066\u305f\u3089ok\u3001ps ax\u3067\u78ba\u8a8d\u3059\u308b\u3002\n$ ps ax | grep -v grep | grep dnsmasq\n12397   ??  Ss     0:00.01 /usr/local/opt/dnsmasq/sbin/dnsmasq --keep-in-foreground\n\ndig\u3067\u8a2d\u5b9a\u304c\u3061\u3083\u3093\u3068\u901a\u3063\u3066\u308b\u304b\u78ba\u8a8d\u3059\u308b\u3002\n$ dig fuga.hoge.dev @127.0.0.1\n;; ANSWER SECTION:\nfuga.hoge.dev.      0   IN  A   127.0.0.1\n\n\nnginx\nhomebrew\u3067nginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3001\u3044\u3064\u3082\u306e\u901a\u308a\u9069\u5f53\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n$ brew install nginx\n\n# /usr/local/etc/nginx/nginx.conf\n\nuser              USER staff;\nworker_processes  2;\n\nevents {\n  worker_connections  1024;\n}\n\nhttp {\n  include       mime.types;\n  default_type  application/octet-stream;\n\n  sendfile        on;\n  tcp_nopush      on;\n  tcp_nodelay     on;\n\n  keepalive_timeout     300;\n  client_max_body_size  2000M;\n\n  proxy_set_header  Host             $http_host;\n  proxy_set_header  X-Remote-Addr    $remote_addr;\n  proxy_set_header  X-Forwarded-For  $proxy_add_x_forwarded_for;\n\n  proxy_connect_timeout 10s;\n\n  server {\n    listen       80 default_server;\n    server_name  _;\n\n    location  / {\n      root   html;\n      index  index.html;\n    }\n  }\n\n  include  conf.d/*.conf;\n}\n\n# /usr/local/etc/nginx/conf.d/hoge.conf\n\nupstream hoge {\n  server 127.0.0.1:3000;\n}\n\nserver {\n  listen       80;\n  server_name  hoge.dev *.hoge.dev;\n  index        index.html;\n  root         /Users/USER/Development/hoge/public;\n\n  location  / {\n    try_files  $uri @app;\n  }\n\n  location  @app {\n    proxy_set_header  Host        $host;\n    proxy_set_header  Upgrade     $http_upgrade;\n    proxy_set_header  Connection  \"Upgrade\";\n    proxy_pass        http://hoge;\n  }\n\n  error_page  403 404          /404.html;\n  error_page  422              /422.html;\n  error_page  500 502 503 504  /500.html;\n}\n\nnginx\u309280\u756a\u30dd\u30fc\u30c8\u3067\u4f7f\u7528\u3055\u305b\u308b\u306b\u306fdnsmasq\u3068\u540c\u69d8\u3001sudo\u6a29\u9650\u304c\u5fc5\u8981\u306b\u306a\u308b\u306e\u3067/Library/LaunchAgents\u304b\u3089sudo\u3067launchd\u3078\u767b\u9332\u3059\u308b\u3002\u3053\u308c\u3067\u6b21\u56de\u306eOS\u8d77\u52d5\u6642\u306b\u81ea\u52d5\u3067\u7acb\u3061\u4e0a\u304c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n$ sudo cp /usr/local/opt/nginx/*.plist /Library/LaunchAgents\n$ sudo launchctl load /Library/LaunchAgents/homebrew.mxcl.nginx.plist\n\n\u8d77\u52d5\u3092\u78ba\u8a8d\u3059\u308b\u3002\n$ ps ax | grep -v grep | grep nginx\n14622   ??  Ss     0:00.01 nginx: master process /usr/local/opt/nginx/bin/nginx -g daemon off;  \n14626   ??  S      0:02.29 nginx: worker process  \n14627   ??  S      0:02.17 nginx: worker process  \n\n\n\u5b8c\u4e86\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089http://hoge.dev\u3092\u958b\u3051\u3070/usr/local/etc/nginx/conf.d/hoge.conf\u306b\u5f93\u3063\u3066\u6b63\u5e38\u306a\u72b6\u614b\u304b\u3001404\u30d5\u30a1\u30a4\u30eb\u304c\u8868\u793a\u3055\u308c\u308b\u3002\nhttp://piyo.dev\uff08nginx\u3067\u7279\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u306a\u3044.dev\u30c9\u30e1\u30a4\u30f3\uff09\u3092\u958b\u3051\u3070\u3001nginx\u30c7\u30d5\u30a9\u30eb\u30c8\u306e404\u304c\u8868\u793a\u3055\u308c\u308b\u306f\u305a\u3002\n\n\u30d6\u30e9\u30a6\u30b6\u3067http://hoge.dev\u306b\u30a2\u30af\u30bb\u30b9\n\nhoge.dev\u304cdev$\u306b\u30de\u30c3\u30c1\u3059\u308b\u306e\u3067DNS\u30b5\u30fc\u30d0\u3092/etc/resolver/dev\u304b\u3089\u9078\u629e\n\nnameserver 127.0.0.1\u3068\u3042\u308b\u306e\u3067@127.0.0.1\u3092\u4f7f\u7528\ndnsmasq\u304choge.dev\u3092127.0.0.1\u3078\u89e3\u6c7a\u3001nginx\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u98db\u3076\nnginx\u304choge.dev\u3092\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3078proxy\u3059\u308b\n\n\n\u3053\u3053\u307e\u3067\u306f\u5e38\u306b\u52d5\u4f5c\u3059\u308b\u3001\u3082\u3057\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u4e0d\u6b63\u3067\u3042\u308c\u3070nginx\u304c404\u3084500\u306e\u30da\u30fc\u30b8\u3092\u30d6\u30e9\u30a6\u30b6\u3078\u8fd4\u3057\u3066\u304f\u308c\u308b\n\n\n\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u304c\u30ec\u30b9\u30dd\u30f3\u30b9\u3092nginx\u3078\u8fd4\u3059\n\u30d6\u30e9\u30a6\u30b6\u306b\u30b3\u30f3\u30c6\u30f3\u30c4\u304c\u8868\u793a\u3055\u308c\u308b\n\n\n\u30aa\u30da\u30ec\u30fc\u30b7\u30e7\u30f3\ndnsmasq\u3092\u518d\u8d77\u52d5\u3057\u305f\u3044\n$ sudo launchctl stop homebrew.mxcl.dnsmasq.plist\n$ sudo launchctl start homebrew.mxcl.dnsmasq.plist\n\nnginx\u306e\u8a2d\u5b9a\u3092\u66f4\u65b0\u3057\u305f\u306e\u3067\u518d\u8d77\u52d5\u3057\u305f\u3044\n$ sudo launchctl stop homebrew.mxcl.nginx.plist\n$ sudo launchctl start homebrew.mxcl.nginx.plist\n\nosx\u3067\u30c9\u30e1\u30a4\u30f3\u30d9\u30fc\u30b9\u3067\u6319\u52d5\u304c\u5909\u308f\u308b\u3088\u3046\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u958b\u767a\u3059\u308b\u6642\u3001\u2193\u306e\u3088\u3046\u306a\u611f\u3058\u3067`/etc/hosts`\u306b\u4f7f\u7528\u3059\u308b(\u30b5\u30d6)\u30c9\u30e1\u30a4\u30f3\u3092\u66f8\u304d\u9023\u306d\u3066\u3044\u304f\u82e6\u884c\u3092\u3057\u305f\u3053\u3068\u304c\u3042\u308b\u4eba\u306f\u591a\u3044\u3068\u601d\u3046\u3002\n\n```\n127.0.0.1  localhost hoge.dev asset.hoge.dev secure.hoge.dev api.hoge.dev\n```\n\n\u3053\u308c\u3092\u89e3\u6d88\u3059\u308b\u30c4\u30fc\u30eb\u3068\u3057\u3066`pow`\u3068\u304b\u304c\u3042\u3063\u305f\u308a\u3059\u308b\u3093\u3060\u3051\u3069\u3001\u52d5\u4f5c\u304c\u91cd\u304b\u3063\u305f\u308a\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5468\u308a\u3067\u30b3\u30b1\u305f\u308a\u3001\u6319\u52d5\u304c\u8b0e\u3060\u3063\u305f\u308a\u3001static\u3067\u8a2d\u7f6e\u3057\u305f404\u30d5\u30a1\u30a4\u30eb\u304c\u3061\u3083\u3093\u3068\u898b\u308c\u306a\u304b\u3063\u305f\u308a\u3001nginx\u306e\u8a2d\u5b9a\u3092\u8a66\u305b\u306a\u304b\u3063\u305f\u308a\u3001\u30c4\u30fc\u30eb\u306e\u4ed5\u69d8\u3084\u30d0\u30b0\u306b\u5f15\u3063\u5f35\u3089\u308c\u3066\u958b\u767a\u304c\u6ede\u308b\u3053\u3068\u3082\u3042\u308b\u3068\u601d\u3046\u3002\n\n\u305d\u3053\u3067`dnsmasq`\u3068`resolver`\u3092\u4f7f\u3063\u3066\u72ec\u81ea\u306b\u30c9\u30e1\u30a4\u30f3\u3092\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3001`nginx`\u304b\u3089proxy\u3092\u98db\u3070\u3057\u3066\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3078\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3088\u3046\u306a\u3001\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u306b\u9650\u308a\u306a\u304f\u8fd1\u3044\u958b\u767a\u74b0\u5883\u3092\u6e96\u5099\u3059\u308b\u3002\n\n1. `/\\.dev$/`\u3092`127.0.0.1`\u306eDNS\u30b5\u30fc\u30d0\u3067\u540d\u524d\u89e3\u6c7a\u3055\u305b\u308b (resolver)\n2. `/\\.dev$/`\u306e\u540d\u524d\u3092`127.0.0.1`\u306b\u89e3\u6c7a\u3055\u305b\u308b (dnsmasq)\n3. `hoge.dev *.hoge.dev`\u3092\u7279\u5b9a\u306eupstream\u3078proxy\u3059\u308b (nginx)\n\nresolver\n--------\n\n`/etc/resolver`\u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u3042\u308b\u3068\u601d\u3046\u3001\u7121\u3051\u308c\u3070\u4f5c\u308b\u3002\n\n\u3053\u3053\u306b\u5f8c\u65b9\u4e00\u81f4\u306e\u5f62\u5f0f\u3067\u30de\u30c3\u30c1\u3055\u305b\u305f\u3044\u540d\u524d\u3092\u3064\u3051\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u3044\u3066\u3001\u4e2d\u306b`resolve.conf`\u3068\u540c\u3058\u5f62\u5f0f(resolver\u30d5\u30a9\u30fc\u30de\u30c3\u30c8)\u3067nameserver\u3092\u66f8\u3044\u3066\u3042\u3052\u308b\u3068\u3001\u305d\u306e\u30cd\u30fc\u30e0\u30b5\u30fc\u30d0\u3092\u4f7f\u3063\u3066\u304f\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n`/hoge\\.dev$/`\u306b\u30de\u30c3\u30c1\u3055\u305b\u305f\u3044\u306a\u3089`hoge.dev`\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u3059\u308b\u3002\n\n`/\\.dev$/`\u306b\u30de\u30c3\u30c1\u3055\u305b\u305f\u3044\u306a\u3089`dev`\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u3059\u308b\u3002\n\n\u4eca\u56de\u306f`/etc/resolver/dev`\u3092\u8a2d\u7f6e\u3057\u3066`\u30ca\u30f3\u30c8\u30ab.dev`\u3068\u3044\u3046\u30c9\u30e1\u30a4\u30f3\u3092\u5168\u90e8\u958b\u767a\u7528\u306b\u5229\u7528\u3059\u308b\u3002\n\n```bash\n$ test [ -d /etc/resolver ] || sudo mkdir /etc/resolver\n$ echo 'nameserver 127.0.0.1' | sudo tee /etc/resolver/dev\nnameserver 127.0.0.1\n$ cat /etc/resolver/dev\nnameserver 127.0.0.1\n```\n\ndnsmasq\n-------\n\n\u8d85\u304a\u624b\u8efdDNS\u30b5\u30fc\u30d0\u30fcdnsmasq\u3092homebrew\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066`.dev`\u3092`127.0.0.1`\u306b\u89e3\u6c7a\u3059\u308b\u3088\u3046\u8a2d\u5b9a\u3059\u308b\u3002`address=/dev/127.0.0.1`\u3068\u3044\u3046\u884c\u3092\u8ffd\u8a18\u3059\u308b\u3060\u3051\u3067\u3088\u3044\u3002\n\n\u2193\u3060\u3068\u9069\u5f53\u306b\u66f8\u304d\u8fbc\u3093\u3067\u308b\u3051\u3069\u3001\u3061\u3083\u3093\u3068\u66f8\u304d\u305f\u3044\u4eba\u306f80\u884c\u76ee\u304f\u3089\u3044\u306b\u3042\u308b`#address=/double-click.net/127.0.0.1`\u306e\u76f4\u4e0b\u3068\u304b\u306b\u66f8\u304f\u3068\u3044\u3044\u3068\u601d\u3046\u3002\n\n```bash\n$ brew install dnsmasq\n$ cp /usr/local/opt/dnsmasq/dnsmasq.conf.example /usr/local/etc/dnsmasq.conf\n$ echo 'address=/dev/127.0.0.1' >> /usr/local/etc/dnsmasq.conf\n```\n\nosx\u3067\u306fDNS\u30b5\u30fc\u30d0\u306e\u30dd\u30fc\u30c8\u3092\u4f7f\u3046\u306b\u306fsudo\u6a29\u9650\u304c\u5fc5\u8981\u306a\u306e\u3067\u3001launchd\u306e\u767b\u9332\u306f`/Library/LaunchAgents`\u304b\u3089sudo\u7d4c\u7531\u3067\u884c\u3046\u3088\u3046\u306b\u3059\u308b\u3002\u3053\u308c\u3067\u6b21\u56de\u306eOS\u8d77\u52d5\u6642\u306b\u81ea\u52d5\u3067\u7acb\u3061\u4e0a\u304c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n```bash\n$ sudo cp /usr/local/opt/dnsmasq/*.plist /Library/LaunchAgents\n$ sudo launchctl load /Library/LaunchAgents/homebrew.mxcl.dnsmasq.plist\n```\n\n\u3053\u308c\u3067dnsmasq\u304c\u8d77\u52d5\u3057\u3066\u305f\u3089ok\u3001`ps ax`\u3067\u78ba\u8a8d\u3059\u308b\u3002\n\n```bash\n$ ps ax | grep -v grep | grep dnsmasq\n12397   ??  Ss     0:00.01 /usr/local/opt/dnsmasq/sbin/dnsmasq --keep-in-foreground\n```\n\n`dig`\u3067\u8a2d\u5b9a\u304c\u3061\u3083\u3093\u3068\u901a\u3063\u3066\u308b\u304b\u78ba\u8a8d\u3059\u308b\u3002\n\n```bash\n$ dig fuga.hoge.dev @127.0.0.1\n;; ANSWER SECTION:\nfuga.hoge.dev.\t\t0\tIN\tA\t127.0.0.1\n```\n\nnginx\n-----\n\nhomebrew\u3067nginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3001\u3044\u3064\u3082\u306e\u901a\u308a\u9069\u5f53\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n\n```bash\n$ brew install nginx\n```\n\n```nginx\n# /usr/local/etc/nginx/nginx.conf\n\nuser              USER staff;\nworker_processes  2;\n\nevents {\n  worker_connections  1024;\n}\n\nhttp {\n  include       mime.types;\n  default_type  application/octet-stream;\n\n  sendfile        on;\n  tcp_nopush      on;\n  tcp_nodelay     on;\n\n  keepalive_timeout     300;\n  client_max_body_size  2000M;\n\n  proxy_set_header  Host             $http_host;\n  proxy_set_header  X-Remote-Addr    $remote_addr;\n  proxy_set_header  X-Forwarded-For  $proxy_add_x_forwarded_for;\n\n  proxy_connect_timeout 10s;\n\n  server {\n    listen       80 default_server;\n    server_name  _;\n\n    location  / {\n      root   html;\n      index  index.html;\n    }\n  }\n\n  include  conf.d/*.conf;\n}\n```\n\n```nginx\n# /usr/local/etc/nginx/conf.d/hoge.conf\n\nupstream hoge {\n  server 127.0.0.1:3000;\n}\n\nserver {\n  listen       80;\n  server_name  hoge.dev *.hoge.dev;\n  index        index.html;\n  root         /Users/USER/Development/hoge/public;\n\n  location  / {\n    try_files  $uri @app;\n  }\n\n  location  @app {\n    proxy_set_header  Host        $host;\n    proxy_set_header  Upgrade     $http_upgrade;\n    proxy_set_header  Connection  \"Upgrade\";\n    proxy_pass        http://hoge;\n  }\n\n  error_page  403 404          /404.html;\n  error_page  422              /422.html;\n  error_page  500 502 503 504  /500.html;\n}\n```\n\nnginx\u309280\u756a\u30dd\u30fc\u30c8\u3067\u4f7f\u7528\u3055\u305b\u308b\u306b\u306fdnsmasq\u3068\u540c\u69d8\u3001sudo\u6a29\u9650\u304c\u5fc5\u8981\u306b\u306a\u308b\u306e\u3067`/Library/LaunchAgents`\u304b\u3089sudo\u3067launchd\u3078\u767b\u9332\u3059\u308b\u3002\u3053\u308c\u3067\u6b21\u56de\u306eOS\u8d77\u52d5\u6642\u306b\u81ea\u52d5\u3067\u7acb\u3061\u4e0a\u304c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n```bash\n$ sudo cp /usr/local/opt/nginx/*.plist /Library/LaunchAgents\n$ sudo launchctl load /Library/LaunchAgents/homebrew.mxcl.nginx.plist\n```\n\n\u8d77\u52d5\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n```bash\n$ ps ax | grep -v grep | grep nginx\n14622   ??  Ss     0:00.01 nginx: master process /usr/local/opt/nginx/bin/nginx -g daemon off;  \n14626   ??  S      0:02.29 nginx: worker process  \n14627   ??  S      0:02.17 nginx: worker process  \n```\n\n\u5b8c\u4e86\n----\n\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089`http://hoge.dev`\u3092\u958b\u3051\u3070`/usr/local/etc/nginx/conf.d/hoge.conf`\u306b\u5f93\u3063\u3066\u6b63\u5e38\u306a\u72b6\u614b\u304b\u3001404\u30d5\u30a1\u30a4\u30eb\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\n`http://piyo.dev`\uff08nginx\u3067\u7279\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u306a\u3044`.dev`\u30c9\u30e1\u30a4\u30f3\uff09\u3092\u958b\u3051\u3070\u3001nginx\u30c7\u30d5\u30a9\u30eb\u30c8\u306e404\u304c\u8868\u793a\u3055\u308c\u308b\u306f\u305a\u3002\n\n1. \u30d6\u30e9\u30a6\u30b6\u3067`http://hoge.dev`\u306b\u30a2\u30af\u30bb\u30b9\n2. `hoge.dev`\u304c`dev$`\u306b\u30de\u30c3\u30c1\u3059\u308b\u306e\u3067DNS\u30b5\u30fc\u30d0\u3092`/etc/resolver/dev`\u304b\u3089\u9078\u629e\n3. `nameserver 127.0.0.1`\u3068\u3042\u308b\u306e\u3067`@127.0.0.1`\u3092\u4f7f\u7528\n4. dnsmasq\u304c`hoge.dev`\u3092`127.0.0.1`\u3078\u89e3\u6c7a\u3001nginx\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u98db\u3076\n5. nginx\u304c`hoge.dev`\u3092\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3078proxy\u3059\u308b\n  * \u3053\u3053\u307e\u3067\u306f\u5e38\u306b\u52d5\u4f5c\u3059\u308b\u3001\u3082\u3057\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u4e0d\u6b63\u3067\u3042\u308c\u3070nginx\u304c404\u3084500\u306e\u30da\u30fc\u30b8\u3092\u30d6\u30e9\u30a6\u30b6\u3078\u8fd4\u3057\u3066\u304f\u308c\u308b\n6. \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u304c\u30ec\u30b9\u30dd\u30f3\u30b9\u3092nginx\u3078\u8fd4\u3059\n7. \u30d6\u30e9\u30a6\u30b6\u306b\u30b3\u30f3\u30c6\u30f3\u30c4\u304c\u8868\u793a\u3055\u308c\u308b\n\n\u30aa\u30da\u30ec\u30fc\u30b7\u30e7\u30f3\n-----------\n\ndnsmasq\u3092\u518d\u8d77\u52d5\u3057\u305f\u3044\n\n```bash\n$ sudo launchctl stop homebrew.mxcl.dnsmasq.plist\n$ sudo launchctl start homebrew.mxcl.dnsmasq.plist\n```\n\nnginx\u306e\u8a2d\u5b9a\u3092\u66f4\u65b0\u3057\u305f\u306e\u3067\u518d\u8d77\u52d5\u3057\u305f\u3044\n\n```bash\n$ sudo launchctl stop homebrew.mxcl.nginx.plist\n$ sudo launchctl start homebrew.mxcl.nginx.plist\n```\n", "tags": ["dnsmasq", "nginx", "OSX"]}