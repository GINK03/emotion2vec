{"context": " More than 1 year has passed since last update.\n\n\u6982\u8981\nExcel\u306e\u30b7\u30fc\u30c8\u306b\u753b\u50cf\u3092\u8cbc\u308bExcel\u30de\u30af\u30ed\u3092\u4f5c\u6210\u3057\u3066\u307f\u305f\u3002\n\u3088\u304f\u3042\u308b\u753b\u50cf\u8cbc\u308a\u4ed8\u3051\u30de\u30af\u30ed\u3060\u3068\u3001Shape.ScaleWidth\u3001Shape.ScaleHeight\u306e2\u3064\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3063\u3066\u7b49\u500d\u3067\u8cbc\u308a\u4ed8\u3051\u308b\u65b9\u6cd5\u3092\u63a1\u3063\u3066\u3044\u308b\u304c\u3001\u3053\u306e\u65b9\u6cd5\u306e\u5834\u5408\u3001\u4f8b\u3048\u3070JPEG\u5f62\u5f0f\u306e\u753b\u50cf\u3060\u3068\u753b\u50cf\u306e\u6301\u3063\u3066\u3044\u308b\u89e3\u50cf\u5ea6\u3092\u53c2\u7167\u3057\u3066\u56f3\u5f62\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5927\u304d\u3055\u3092\u6c7a\u5b9a\u3057\u3066\u3057\u307e\u3046\u305f\u3081\u3001\u540c\u3058\u5e45\u3068\u9ad8\u3055\u306e\u753b\u50cf\u3067\u3082\u8cbc\u308a\u4ed8\u3051\u3089\u308c\u305f\u753b\u50cf\u306e\u5927\u304d\u3055\u304c\u7570\u306a\u3063\u3066\u898b\u3048\u3066\u3057\u307e\u3046\u3002\u3082\u3061\u308d\u3093\u3001\u753b\u50cf\u3092\u5370\u5237\u3059\u308b\u3088\u3046\u306a\u5834\u5408\u306f\u89e3\u50cf\u5ea6\u306e\u60c5\u5831\u3092\u5143\u306b\u5927\u304d\u3055\u3092\u6c7a\u5b9a\u3059\u308b\u65b9\u304c\u5b9f\u60c5\u306b\u9069\u3057\u3066\u3044\u308b\u304c\u3001Excel\u306b\u753b\u50cf\u3092\u8cbc\u308b\u3088\u3046\u306a\u5834\u5408\u306f\u753b\u9762\u3067\u898b\u308b\u3053\u3068\u3092\u60f3\u5b9a\u3057\u3066\u3044\u308b\u306e\u3067\u3042\u308a\u3001\u540c\u3058\u5e45\u3068\u9ad8\u3055\u306e\u753b\u50cf\u304c\u7570\u306a\u308b\u5927\u304d\u3055\u306b\u898b\u3048\u3066\u306f\u56f0\u308b\u306e\u3067\u3042\u308b\u3002\n\u305d\u3053\u3067\u3001\u753b\u50cf\u306e\u5e45\u3084\u9ad8\u3055\u306e\u6307\u5b9a\u306bShape.ScaleWidth\u3001Shape.ScaleHeight\u306e\u30e1\u30bd\u30c3\u30c9\u306f\u7528\u3044\u305a\u3001GDI+\u3092\u5229\u7528\u3057\u3066\u3042\u3089\u304b\u3058\u3081\u753b\u50cf\u306e\u5e45\u3068\u9ad8\u3055\u3092\u30d4\u30af\u30bb\u30eb\u5358\u4f4d\u3067\u53d6\u5f97\u3057\u3066\u304a\u3044\u3066\u3001Shapes.AddPicture\u30e1\u30bd\u30c3\u30c9\u3067\u5e45\u3084\u9ad8\u3055\u3092\u6307\u5b9a\u3059\u308b\u3088\u3046\u306b\u3057\u305f\u3002Shapes.AddPicture\u30e1\u30bd\u30c3\u30c9\u3067\u6307\u5b9a\u3059\u308b\u5e45\u3084\u9ad8\u3055\u306f\u30dd\u30a4\u30f3\u30c8\u5358\u4f4d\u306a\u306e\u3067\u3001\u753b\u9762\u306eDPI\u3092\u5143\u306b\u30d4\u30af\u30bb\u30eb\u5358\u4f4d\u304b\u3089\u30dd\u30a4\u30f3\u30c8\u5358\u4f4d\u306b\u5909\u63db\u3057\u3066\u3044\u308b\u3002\n\n\u30b3\u30fc\u30c9\n\u753b\u50cf\u3092\u8cbc\u308a\u4ed8\u3051\u308b\u4f4d\u7f6e\u304c\u30b7\u30fc\u30c8\u306e\u5de6\u4e0a(0, 0)\u3067\u56fa\u5b9a\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u9023\u7d9a\u3057\u3066\u8cbc\u308c\u308b\u3088\u3046\u306b\u8cbc\u308a\u4ed8\u3051\u4f4d\u7f6e\u3092\u7b97\u51fa\u3059\u308b\u3088\u3046\u306b\u3059\u308b\u3068\u3082\u3046\u5c11\u3057\u5b9f\u7528\u7684(\uff1f)\u306b\u306a\u308b\u3068\u601d\u308f\u308c\u308b\u3002\n\u30a8\u30e9\u30fc\u51e6\u7406\u306f\u9069\u5f53\u3002\n\nSheet1\nOption Explicit\n\nPublic Sub PastePicture()\n\n    Dim filePath As Variant\n    Dim dpiX As Integer\n    Dim dpiY As Integer\n    Dim width As Single\n    Dim height As Single\n    Dim picture As Shape\n\n    '\u753b\u50cf\u3092\u9078\u629e\u3055\u305b\u308b\n    filePath = Application.GetOpenFilename( _\n        FileFilter:=\"\u753b\u50cf\u30d5\u30a1\u30a4\u30eb,*.png;*.jpg;*.gif;*.bmp;*.tif;\")\n    If filePath = False Then\n        Exit Sub\n    End If\n\n    'DPI\u306e\u53d6\u5f97\n    If Not GetDpi(dpiX, dpiY) Then\n        MsgBox \"DPI\u306e\u53d6\u5f97\u306b\u5931\u6557\"\n        Exit Sub\n    End If\n\n    '\u753b\u50cf\u306e\u5e45\u30fb\u9ad8\u3055\u306e\u53d6\u5f97(\u30d4\u30af\u30bb\u30eb\u5358\u4f4d)\n    If Not GetImageDimensionFromFile(filePath, width, height) Then\n        MsgBox \"\u753b\u50cf\u306e\u5e45\u30fb\u9ad8\u3055\u306e\u53d6\u5f97\u306b\u5931\u6557\"\n        Exit Sub\n    End If\n\n    '\u753b\u50cf\u306e\u8cbc\u308a\u4ed8\u3051\n    'Shapes.AddPicture\u306e\u5e45\u3068\u9ad8\u3055\u306f\u30dd\u30a4\u30f3\u30c8\u5358\u4f4d\u3067\u6307\u5b9a\u3059\u308b\u306e\u3067\n    '\u30d4\u30af\u30bb\u30eb->\u30dd\u30a4\u30f3\u30c8\u5909\u63db\u3059\u308b\n    Set picture = ActiveSheet.Shapes.AddPicture( _\n        FileName:=filePath, _\n        LinkToFile:=False, SaveWithDocument:=True, _\n        Left:=0, Top:=0, _\n        width:=width * 72 / dpiX, height:=height * 72 / dpiY)\n\n    Set picture = Nothing\nEnd Sub\n\n\n\n\u6a19\u6e96\u30e2\u30b8\u30e5\u30fc\u30eb\nOption Explicit\n\n'GDI+ API\u5b9a\u7fa9\n#If VBA7 And Win64 Then\n\nPrivate Declare PtrSafe Function GdiplusStartup Lib \"GDIPlus\" ( _\n    ByRef token As LongPtr, _\n    ByRef inputbuf As GdiplusStartupInput, _\n    Optional ByVal outputbuf As LongPtr = 0) As Long\nPrivate Declare PtrSafe Sub GdiplusShutdown Lib \"GDIPlus\" ( _\n    ByVal token As LongPtr)\nPrivate Declare PtrSafe Function GdipLoadImageFromFile Lib \"GDIPlus\" ( _\n    ByVal FileName As LongPtr, _\n    ByRef image As LongPtr) As Long\nPrivate Declare PtrSafe Function GdipDisposeImage Lib \"GDIPlus\" ( _\n    ByVal image As LongPtr) As Long\nPrivate Declare PtrSafe Function GdipGetImageDimension Lib \"GDIPlus\" ( _\n    ByVal image As LongPtr, _\n    ByRef width As Single, _\n    ByRef height As Single) As Long\n\n#Else\n\nPrivate Declare Function GdiplusStartup Lib \"GDIPlus\" ( _\n    ByRef token As Long, _\n    ByRef inputbuf As GdiplusStartupInput, _\n    Optional ByVal outputbuf As Long = 0) As Long\nPrivate Declare Sub GdiplusShutdown Lib \"GDIPlus\" ( _\n    ByVal token As Long)\nPrivate Declare Function GdipLoadImageFromFile Lib \"GDIPlus\" ( _\n    ByVal FileName As Long, _\n    ByRef image As Long) As Long\nPrivate Declare Function GdipDisposeImage Lib \"GDIPlus\" ( _\n    ByVal image As Long) As Long\nPrivate Declare Function GdipGetImageDimension Lib \"GDIPlus\" ( _\n    ByVal image As Long, _\n    ByRef width As Single, _\n    ByRef height As Single) As Long\n\n#End If\n\n'Windows API\u5b9a\u7fa9\n#If VBA7 And Win64 Then\n\nPrivate Declare PtrSafe Function GetDeviceCaps Lib \"gdi32.dll\" ( _\n    ByVal hdc As Long, _\n    ByVal nIndex As Long) As Long\nPrivate Declare PtrSafe Function GetDC Lib \"user32.dll\" ( _\n    ByVal hwnd As Long) As Long\nPrivate Declare PtrSafe Function ReleaseDC Lib \"user32.dll\" ( _\n    ByVal hwnd As Long, _\n    ByVal hdc As Long) As Long\n\n#Else\n\nPrivate Declare Function GetDeviceCaps Lib \"gdi32.dll\" ( _\n    ByVal hdc As Long, _\n    ByVal nIndex As Long) As Long\nPrivate Declare Function GetDC Lib \"user32.dll\" ( _\n    ByVal hwnd As Long) As Long\nPrivate Declare Function ReleaseDC Lib \"user32.dll\" ( _\n    ByVal hwnd As Long, _\n    ByVal hdc As Long) As Long\n\n#End If\n\n'GDI+\u7528\u30e6\u30fc\u30b6\u5b9a\u7fa9\u578b\n#If VBA7 And Win64 Then\n\nPrivate Type GdiplusStartupInput\n    GdiplusVersion As Long\n    DebugEventCallback As LongPtr\n    SuppressBackgroundThread As Long\n    SuppressExternalCodecs As Long\nEnd Type\n\n#Else\n\nPrivate Type GdiplusStartupInput\n    GdiplusVersion As Long\n    DebugEventCallback As Long\n    SuppressBackgroundThread As Long\n    SuppressExternalCodecs As Long\nEnd Type\n\n#End If\n\nPrivate Const LOGPIXELSX As Long = 88\nPrivate Const LOGPIXELSY As Long = 90\n\n'DPI\u306e\u53d6\u5f97\nPublic Function GetDpi(ByRef dpiX As Integer, ByRef dpiY As Integer) As Boolean\n\n    Dim hdc As Long\n\n    hdc = GetDC(Application.hwnd)\n    If hdc Then\n        dpiX = GetDeviceCaps(hdc, LOGPIXELSX)\n        dpiY = GetDeviceCaps(hdc, LOGPIXELSY)\n\n        GetDpi = True\n        Call ReleaseDC(Application.hwnd, hdc)\n    End If\n\nEnd Function\n\n'\u753b\u50cf\u306e\u5e45\u3068\u9ad8\u3055\u3092\u30d4\u30af\u30bb\u30eb\u5358\u4f4d\u3067\u53d6\u5f97\u3059\u308b\n'\u5bfe\u5fdc\u30d5\u30a9\u30fc\u30de\u30c3\u30c8:GDI+\u6e96\u62e0(BMP, JPEG, GIF, TIFF, PNG)\nPublic Function GetImageDimensionFromFile( _\n    ByVal filePath As String, ByRef width As Single, ByRef height As Single) As Boolean\n\n    Dim uGdiStartupInput As GdiplusStartupInput\n#If VBA7 And Win64 Then\n    Dim nGdiToken As LongPtr\n    Dim hImage As LongPtr\n#Else\n    Dim nGdiToken As Long\n    Dim hImage As Long\n#End If\n\n    uGdiStartupInput.GdiplusVersion = 1\n\n    If GdiplusStartup(nGdiToken, uGdiStartupInput) = 0 Then\n        If GdipLoadImageFromFile(ByVal StrPtr(filePath), hImage) = 0 Then\n            If GdipGetImageDimension(hImage, width, height) = 0 Then\n                GetImageDimensionFromFile = True\n            End If\n            If GdipDisposeImage(hImage) <> 0 Then\n                MsgBox \"\u30e1\u30e2\u30ea\u306e\u89e3\u653e\u306b\u5931\u6557\"\n            End If\n        End If\n        Call GdiplusShutdown(nGdiToken)\n    End If\n\nEnd Function\n\n\n\nExcel\u306e\u753b\u50cf\u633f\u5165\u306b\u3064\u3044\u3066\nShape.ScaleWidth\u3001Shape.ScaleHeight\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3063\u3066\u753b\u50cf\u3092\u7b49\u500d\u3067\u8cbc\u308a\u4ed8\u3051\u308b\u30b3\u30fc\u30c9\u7247\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u306b\u306a\u308b\u3002\nSet picture = ActiveSheet.Shapes.AddPicture( _\n    FileName:=filePath, _\n    LinkToFile:=False, SaveWithDocument:=True, _\n    Left:=0, Top:=0, _\n    width:=0, height:=0)\n\nWith picture\n    .ScaleHeight 1, msoTrue\n    .ScaleWidth 1, msoTrue\nEnd With\n\nSet picture = Nothing\n\n\u3053\u306e\u65b9\u6cd5\u3060\u3068\u3001Excel\u3067\u30e1\u30cb\u30e5\u30fc\u304b\u3089\u753b\u50cf\u3092\u633f\u5165\u3057\u305f\u3068\u304d\u3068\u540c\u3058\u5927\u304d\u3055\u306b\u306a\u308b\u3088\u3046\u3060\u3002\n\u666e\u901a\u306bExcel\u3067\u753b\u50cf\u3092\u633f\u5165\u3059\u308b\u3068\u3001\u4f8b\u3048\u3070\u5e45\u30fb\u9ad8\u3055\u304c\u3068\u3082\u306b320pixel\u3067\u89e3\u50cf\u5ea6\u304c\u6c34\u5e73\u30fb\u5782\u76f4\u65b9\u5411\u3068\u3082\u306b360dpi\u306eJPEG\u5f62\u5f0f\u306e\u753b\u50cf\u306e\u5834\u5408\u3001\u5e45\u30fb\u9ad8\u3055\u304c\u3068\u3082\u306b2.26cm\u306e\u56f3\u5f62\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u306a\u308b\u3002\n\u3069\u3046\u3044\u3046\u8a08\u7b97\u3067\u3053\u306e\u5927\u304d\u3055\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u3068\u3044\u3046\u3068\u3001\n320(pixel) / 360(dpi) * 2.54(cm) = 2.2577777...(cm) \u2252 2.26(cm)\n\u3068\u3044\u3046\u8a08\u7b97\u5f0f\u306b\u3088\u308b\u3088\u3046\u3060\u3002\nWikipedia\u3088\u308a\n\npixel\u306f\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u3067\u753b\u50cf\u3092\u6271\u3046\u3068\u304d\u306e\u3001\u8272\u60c5\u5831(\u8272\u8abf\u3084\u968e\u8abf)\u3092\u6301\u3064\u6700\u5c0f\u5358\u4f4d\u3001\u6700\u5c0f\u8981\u7d20\u3002\u3057\u3070\u3057\u3070\u30d4\u30af\u30bb\u30eb\u3068\u540c\u4e00\u306e\u8a00\u8449\u3068\u3057\u3066\u4f7f\u308f\u308c\u308b\u30c9\u30c3\u30c8\u3068\u306f\u3001\u5f8c\u8005\u304c\u5358\u306a\u308b\u7269\u7406\u7684\u306a\u70b9\u60c5\u5831\u3067\u3042\u308b\u3053\u3068\u3067\u533a\u5225\u3055\u308c\u308b\u3002\ndpi\u3068\u306fdots per inch\u306e\u7565\u3067\u3001\u30c9\u30c3\u30c8\u5bc6\u5ea6\u306e\u5358\u4f4d\u3067\u3042\u308b\u30021\u30a4\u30f3\u30c1\u306e\u5e45\u306e\u4e2d\u306b\u3069\u308c\u3060\u3051\u306e\u30c9\u30c3\u30c8\u3092\u8868\u73fe\u3067\u304d\u308b\u304b\u3092\u8868\u3059\u3002\n\n\u3064\u307e\u308a\u30011inch\u4e2d\u306b360\u500b\u70b9(\u30c9\u30c3\u30c8)\u3092\u6253\u3066\u308b\u5bc6\u5ea6\u3067320\u500b\u306e\u70b9\u3092\u6253\u3064\u3068\u4f55inch\u5fc5\u8981\u304b\u3092\u8a08\u7b97\u3059\u308c\u3070\u826f\u3044\u3002\u5f8c\u306finch\u304b\u3089cm\u3078\u306e\u5358\u4f4d\u306e\u63db\u7b97(1inch = 2.54cm)\u3092\u3057\u3066\u3084\u308c\u3070\u7b97\u51fa\u3067\u304d\u308b\u3002\n\u306a\u304a\u3001\u89e3\u50cf\u5ea6\u306e\u60c5\u5831\u3092\u6301\u305f\u306a\u3044BMP\u5f62\u5f0f\u7b49\u306e\u753b\u50cf\u306e\u5834\u5408\u3001Excel\u306e\u5185\u90e8\u3067\u306f72dpi\u3068\u306a\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u300172dpi\u306e\u753b\u50cf\u3068\u3057\u3066\u8a08\u7b97\u3059\u308c\u3070\u826f\u3044\u3002\n## \u6982\u8981\n\nExcel\u306e\u30b7\u30fc\u30c8\u306b\u753b\u50cf\u3092\u8cbc\u308bExcel\u30de\u30af\u30ed\u3092\u4f5c\u6210\u3057\u3066\u307f\u305f\u3002\n\n\u3088\u304f\u3042\u308b\u753b\u50cf\u8cbc\u308a\u4ed8\u3051\u30de\u30af\u30ed\u3060\u3068\u3001`Shape.ScaleWidth`\u3001`Shape.ScaleHeight`\u306e2\u3064\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3063\u3066\u7b49\u500d\u3067\u8cbc\u308a\u4ed8\u3051\u308b\u65b9\u6cd5\u3092\u63a1\u3063\u3066\u3044\u308b\u304c\u3001\u3053\u306e\u65b9\u6cd5\u306e\u5834\u5408\u3001\u4f8b\u3048\u3070JPEG\u5f62\u5f0f\u306e\u753b\u50cf\u3060\u3068\u753b\u50cf\u306e\u6301\u3063\u3066\u3044\u308b\u89e3\u50cf\u5ea6\u3092\u53c2\u7167\u3057\u3066\u56f3\u5f62\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5927\u304d\u3055\u3092\u6c7a\u5b9a\u3057\u3066\u3057\u307e\u3046\u305f\u3081\u3001\u540c\u3058\u5e45\u3068\u9ad8\u3055\u306e\u753b\u50cf\u3067\u3082\u8cbc\u308a\u4ed8\u3051\u3089\u308c\u305f\u753b\u50cf\u306e\u5927\u304d\u3055\u304c\u7570\u306a\u3063\u3066\u898b\u3048\u3066\u3057\u307e\u3046\u3002\u3082\u3061\u308d\u3093\u3001\u753b\u50cf\u3092\u5370\u5237\u3059\u308b\u3088\u3046\u306a\u5834\u5408\u306f\u89e3\u50cf\u5ea6\u306e\u60c5\u5831\u3092\u5143\u306b\u5927\u304d\u3055\u3092\u6c7a\u5b9a\u3059\u308b\u65b9\u304c\u5b9f\u60c5\u306b\u9069\u3057\u3066\u3044\u308b\u304c\u3001Excel\u306b\u753b\u50cf\u3092\u8cbc\u308b\u3088\u3046\u306a\u5834\u5408\u306f\u753b\u9762\u3067\u898b\u308b\u3053\u3068\u3092\u60f3\u5b9a\u3057\u3066\u3044\u308b\u306e\u3067\u3042\u308a\u3001\u540c\u3058\u5e45\u3068\u9ad8\u3055\u306e\u753b\u50cf\u304c\u7570\u306a\u308b\u5927\u304d\u3055\u306b\u898b\u3048\u3066\u306f\u56f0\u308b\u306e\u3067\u3042\u308b\u3002\n\n\u305d\u3053\u3067\u3001\u753b\u50cf\u306e\u5e45\u3084\u9ad8\u3055\u306e\u6307\u5b9a\u306b`Shape.ScaleWidth`\u3001`Shape.ScaleHeight`\u306e\u30e1\u30bd\u30c3\u30c9\u306f\u7528\u3044\u305a\u3001GDI+\u3092\u5229\u7528\u3057\u3066\u3042\u3089\u304b\u3058\u3081\u753b\u50cf\u306e\u5e45\u3068\u9ad8\u3055\u3092\u30d4\u30af\u30bb\u30eb\u5358\u4f4d\u3067\u53d6\u5f97\u3057\u3066\u304a\u3044\u3066\u3001`Shapes.AddPicture`\u30e1\u30bd\u30c3\u30c9\u3067\u5e45\u3084\u9ad8\u3055\u3092\u6307\u5b9a\u3059\u308b\u3088\u3046\u306b\u3057\u305f\u3002`Shapes.AddPicture`\u30e1\u30bd\u30c3\u30c9\u3067\u6307\u5b9a\u3059\u308b\u5e45\u3084\u9ad8\u3055\u306f\u30dd\u30a4\u30f3\u30c8\u5358\u4f4d\u306a\u306e\u3067\u3001\u753b\u9762\u306eDPI\u3092\u5143\u306b\u30d4\u30af\u30bb\u30eb\u5358\u4f4d\u304b\u3089\u30dd\u30a4\u30f3\u30c8\u5358\u4f4d\u306b\u5909\u63db\u3057\u3066\u3044\u308b\u3002\n\n## \u30b3\u30fc\u30c9\n\n\u753b\u50cf\u3092\u8cbc\u308a\u4ed8\u3051\u308b\u4f4d\u7f6e\u304c\u30b7\u30fc\u30c8\u306e\u5de6\u4e0a(0, 0)\u3067\u56fa\u5b9a\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u9023\u7d9a\u3057\u3066\u8cbc\u308c\u308b\u3088\u3046\u306b\u8cbc\u308a\u4ed8\u3051\u4f4d\u7f6e\u3092\u7b97\u51fa\u3059\u308b\u3088\u3046\u306b\u3059\u308b\u3068\u3082\u3046\u5c11\u3057\u5b9f\u7528\u7684(\uff1f)\u306b\u306a\u308b\u3068\u601d\u308f\u308c\u308b\u3002\n\u30a8\u30e9\u30fc\u51e6\u7406\u306f\u9069\u5f53\u3002\n\n```vbnet:Sheet1\nOption Explicit\n\nPublic Sub PastePicture()\n    \n    Dim filePath As Variant\n    Dim dpiX As Integer\n    Dim dpiY As Integer\n    Dim width As Single\n    Dim height As Single\n    Dim picture As Shape\n    \n    '\u753b\u50cf\u3092\u9078\u629e\u3055\u305b\u308b\n    filePath = Application.GetOpenFilename( _\n        FileFilter:=\"\u753b\u50cf\u30d5\u30a1\u30a4\u30eb,*.png;*.jpg;*.gif;*.bmp;*.tif;\")\n    If filePath = False Then\n        Exit Sub\n    End If\n    \n    'DPI\u306e\u53d6\u5f97\n    If Not GetDpi(dpiX, dpiY) Then\n        MsgBox \"DPI\u306e\u53d6\u5f97\u306b\u5931\u6557\"\n        Exit Sub\n    End If\n    \n    '\u753b\u50cf\u306e\u5e45\u30fb\u9ad8\u3055\u306e\u53d6\u5f97(\u30d4\u30af\u30bb\u30eb\u5358\u4f4d)\n    If Not GetImageDimensionFromFile(filePath, width, height) Then\n        MsgBox \"\u753b\u50cf\u306e\u5e45\u30fb\u9ad8\u3055\u306e\u53d6\u5f97\u306b\u5931\u6557\"\n        Exit Sub\n    End If\n    \n    '\u753b\u50cf\u306e\u8cbc\u308a\u4ed8\u3051\n    'Shapes.AddPicture\u306e\u5e45\u3068\u9ad8\u3055\u306f\u30dd\u30a4\u30f3\u30c8\u5358\u4f4d\u3067\u6307\u5b9a\u3059\u308b\u306e\u3067\n    '\u30d4\u30af\u30bb\u30eb->\u30dd\u30a4\u30f3\u30c8\u5909\u63db\u3059\u308b\n    Set picture = ActiveSheet.Shapes.AddPicture( _\n        FileName:=filePath, _\n        LinkToFile:=False, SaveWithDocument:=True, _\n        Left:=0, Top:=0, _\n        width:=width * 72 / dpiX, height:=height * 72 / dpiY)\n    \n    Set picture = Nothing\nEnd Sub\n```\n```vbnet:\u6a19\u6e96\u30e2\u30b8\u30e5\u30fc\u30eb\nOption Explicit\n\n'GDI+ API\u5b9a\u7fa9\n#If VBA7 And Win64 Then\n\nPrivate Declare PtrSafe Function GdiplusStartup Lib \"GDIPlus\" ( _\n    ByRef token As LongPtr, _\n    ByRef inputbuf As GdiplusStartupInput, _\n    Optional ByVal outputbuf As LongPtr = 0) As Long\nPrivate Declare PtrSafe Sub GdiplusShutdown Lib \"GDIPlus\" ( _\n    ByVal token As LongPtr)\nPrivate Declare PtrSafe Function GdipLoadImageFromFile Lib \"GDIPlus\" ( _\n    ByVal FileName As LongPtr, _\n    ByRef image As LongPtr) As Long\nPrivate Declare PtrSafe Function GdipDisposeImage Lib \"GDIPlus\" ( _\n    ByVal image As LongPtr) As Long\nPrivate Declare PtrSafe Function GdipGetImageDimension Lib \"GDIPlus\" ( _\n    ByVal image As LongPtr, _\n    ByRef width As Single, _\n    ByRef height As Single) As Long\n\n#Else\n\nPrivate Declare Function GdiplusStartup Lib \"GDIPlus\" ( _\n    ByRef token As Long, _\n    ByRef inputbuf As GdiplusStartupInput, _\n    Optional ByVal outputbuf As Long = 0) As Long\nPrivate Declare Sub GdiplusShutdown Lib \"GDIPlus\" ( _\n    ByVal token As Long)\nPrivate Declare Function GdipLoadImageFromFile Lib \"GDIPlus\" ( _\n    ByVal FileName As Long, _\n    ByRef image As Long) As Long\nPrivate Declare Function GdipDisposeImage Lib \"GDIPlus\" ( _\n    ByVal image As Long) As Long\nPrivate Declare Function GdipGetImageDimension Lib \"GDIPlus\" ( _\n    ByVal image As Long, _\n    ByRef width As Single, _\n    ByRef height As Single) As Long\n\n#End If\n\n'Windows API\u5b9a\u7fa9\n#If VBA7 And Win64 Then\n\nPrivate Declare PtrSafe Function GetDeviceCaps Lib \"gdi32.dll\" ( _\n    ByVal hdc As Long, _\n    ByVal nIndex As Long) As Long\nPrivate Declare PtrSafe Function GetDC Lib \"user32.dll\" ( _\n    ByVal hwnd As Long) As Long\nPrivate Declare PtrSafe Function ReleaseDC Lib \"user32.dll\" ( _\n    ByVal hwnd As Long, _\n    ByVal hdc As Long) As Long\n\n#Else\n\nPrivate Declare Function GetDeviceCaps Lib \"gdi32.dll\" ( _\n    ByVal hdc As Long, _\n    ByVal nIndex As Long) As Long\nPrivate Declare Function GetDC Lib \"user32.dll\" ( _\n    ByVal hwnd As Long) As Long\nPrivate Declare Function ReleaseDC Lib \"user32.dll\" ( _\n    ByVal hwnd As Long, _\n    ByVal hdc As Long) As Long\n\n#End If\n\n'GDI+\u7528\u30e6\u30fc\u30b6\u5b9a\u7fa9\u578b\n#If VBA7 And Win64 Then\n\nPrivate Type GdiplusStartupInput\n    GdiplusVersion As Long\n    DebugEventCallback As LongPtr\n    SuppressBackgroundThread As Long\n    SuppressExternalCodecs As Long\nEnd Type\n\n#Else\n\nPrivate Type GdiplusStartupInput\n    GdiplusVersion As Long\n    DebugEventCallback As Long\n    SuppressBackgroundThread As Long\n    SuppressExternalCodecs As Long\nEnd Type\n\n#End If\n\nPrivate Const LOGPIXELSX As Long = 88\nPrivate Const LOGPIXELSY As Long = 90\n\n'DPI\u306e\u53d6\u5f97\nPublic Function GetDpi(ByRef dpiX As Integer, ByRef dpiY As Integer) As Boolean\n\n    Dim hdc As Long\n    \n    hdc = GetDC(Application.hwnd)\n    If hdc Then\n        dpiX = GetDeviceCaps(hdc, LOGPIXELSX)\n        dpiY = GetDeviceCaps(hdc, LOGPIXELSY)\n        \n        GetDpi = True\n        Call ReleaseDC(Application.hwnd, hdc)\n    End If\n    \nEnd Function\n\n'\u753b\u50cf\u306e\u5e45\u3068\u9ad8\u3055\u3092\u30d4\u30af\u30bb\u30eb\u5358\u4f4d\u3067\u53d6\u5f97\u3059\u308b\n'\u5bfe\u5fdc\u30d5\u30a9\u30fc\u30de\u30c3\u30c8:GDI+\u6e96\u62e0(BMP, JPEG, GIF, TIFF, PNG)\nPublic Function GetImageDimensionFromFile( _\n    ByVal filePath As String, ByRef width As Single, ByRef height As Single) As Boolean\n\n    Dim uGdiStartupInput As GdiplusStartupInput\n#If VBA7 And Win64 Then\n    Dim nGdiToken As LongPtr\n    Dim hImage As LongPtr\n#Else\n    Dim nGdiToken As Long\n    Dim hImage As Long\n#End If\n\n    uGdiStartupInput.GdiplusVersion = 1\n\n    If GdiplusStartup(nGdiToken, uGdiStartupInput) = 0 Then\n        If GdipLoadImageFromFile(ByVal StrPtr(filePath), hImage) = 0 Then\n            If GdipGetImageDimension(hImage, width, height) = 0 Then\n                GetImageDimensionFromFile = True\n            End If\n            If GdipDisposeImage(hImage) <> 0 Then\n                MsgBox \"\u30e1\u30e2\u30ea\u306e\u89e3\u653e\u306b\u5931\u6557\"\n            End If\n        End If\n        Call GdiplusShutdown(nGdiToken)\n    End If\n\nEnd Function\n```\n\n## Excel\u306e\u753b\u50cf\u633f\u5165\u306b\u3064\u3044\u3066\n\n`Shape.ScaleWidth`\u3001`Shape.ScaleHeight`\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3063\u3066\u753b\u50cf\u3092\u7b49\u500d\u3067\u8cbc\u308a\u4ed8\u3051\u308b\u30b3\u30fc\u30c9\u7247\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u306b\u306a\u308b\u3002\n\n```vbnet\nSet picture = ActiveSheet.Shapes.AddPicture( _\n    FileName:=filePath, _\n    LinkToFile:=False, SaveWithDocument:=True, _\n    Left:=0, Top:=0, _\n    width:=0, height:=0)\n\nWith picture\n    .ScaleHeight 1, msoTrue\n    .ScaleWidth 1, msoTrue\nEnd With\n\nSet picture = Nothing\n```\n\n\u3053\u306e\u65b9\u6cd5\u3060\u3068\u3001Excel\u3067\u30e1\u30cb\u30e5\u30fc\u304b\u3089\u753b\u50cf\u3092\u633f\u5165\u3057\u305f\u3068\u304d\u3068\u540c\u3058\u5927\u304d\u3055\u306b\u306a\u308b\u3088\u3046\u3060\u3002\n\n\u666e\u901a\u306bExcel\u3067\u753b\u50cf\u3092\u633f\u5165\u3059\u308b\u3068\u3001\u4f8b\u3048\u3070\u5e45\u30fb\u9ad8\u3055\u304c\u3068\u3082\u306b320pixel\u3067\u89e3\u50cf\u5ea6\u304c\u6c34\u5e73\u30fb\u5782\u76f4\u65b9\u5411\u3068\u3082\u306b360dpi\u306eJPEG\u5f62\u5f0f\u306e\u753b\u50cf\u306e\u5834\u5408\u3001\u5e45\u30fb\u9ad8\u3055\u304c\u3068\u3082\u306b2.26cm\u306e\u56f3\u5f62\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u306a\u308b\u3002\n\n\u3069\u3046\u3044\u3046\u8a08\u7b97\u3067\u3053\u306e\u5927\u304d\u3055\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u3068\u3044\u3046\u3068\u3001\n320(pixel) / 360(dpi) * 2.54(cm) = 2.2577777...(cm) \u2252 2.26(cm)\n\u3068\u3044\u3046\u8a08\u7b97\u5f0f\u306b\u3088\u308b\u3088\u3046\u3060\u3002\n\nWikipedia\u3088\u308a\n>pixel\u306f\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u3067\u753b\u50cf\u3092\u6271\u3046\u3068\u304d\u306e\u3001\u8272\u60c5\u5831(\u8272\u8abf\u3084\u968e\u8abf)\u3092\u6301\u3064\u6700\u5c0f\u5358\u4f4d\u3001\u6700\u5c0f\u8981\u7d20\u3002\u3057\u3070\u3057\u3070\u30d4\u30af\u30bb\u30eb\u3068\u540c\u4e00\u306e\u8a00\u8449\u3068\u3057\u3066\u4f7f\u308f\u308c\u308b\u30c9\u30c3\u30c8\u3068\u306f\u3001\u5f8c\u8005\u304c\u5358\u306a\u308b\u7269\u7406\u7684\u306a\u70b9\u60c5\u5831\u3067\u3042\u308b\u3053\u3068\u3067\u533a\u5225\u3055\u308c\u308b\u3002\n>dpi\u3068\u306fdots per inch\u306e\u7565\u3067\u3001\u30c9\u30c3\u30c8\u5bc6\u5ea6\u306e\u5358\u4f4d\u3067\u3042\u308b\u30021\u30a4\u30f3\u30c1\u306e\u5e45\u306e\u4e2d\u306b\u3069\u308c\u3060\u3051\u306e\u30c9\u30c3\u30c8\u3092\u8868\u73fe\u3067\u304d\u308b\u304b\u3092\u8868\u3059\u3002\n\n\u3064\u307e\u308a\u30011inch\u4e2d\u306b360\u500b\u70b9(\u30c9\u30c3\u30c8)\u3092\u6253\u3066\u308b\u5bc6\u5ea6\u3067320\u500b\u306e\u70b9\u3092\u6253\u3064\u3068\u4f55inch\u5fc5\u8981\u304b\u3092\u8a08\u7b97\u3059\u308c\u3070\u826f\u3044\u3002\u5f8c\u306finch\u304b\u3089cm\u3078\u306e\u5358\u4f4d\u306e\u63db\u7b97(1inch = 2.54cm)\u3092\u3057\u3066\u3084\u308c\u3070\u7b97\u51fa\u3067\u304d\u308b\u3002\n\u306a\u304a\u3001\u89e3\u50cf\u5ea6\u306e\u60c5\u5831\u3092\u6301\u305f\u306a\u3044BMP\u5f62\u5f0f\u7b49\u306e\u753b\u50cf\u306e\u5834\u5408\u3001Excel\u306e\u5185\u90e8\u3067\u306f72dpi\u3068\u306a\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u300172dpi\u306e\u753b\u50cf\u3068\u3057\u3066\u8a08\u7b97\u3059\u308c\u3070\u826f\u3044\u3002\n", "tags": ["ExcelVBA"]}