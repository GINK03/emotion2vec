{"context": "\n\n\u524d\u63d0\u6761\u4ef6\n\nAPI Gateway\u3078\u306e\u6a29\u9650\nAPI Gateway\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\nLambda\u3078\u306e\u6a29\u9650\nLambda\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\nAWS CLI\n\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\nAWS CLI 1.10.58\n\n\n\u30b3\u30de\u30f3\u30c9\naws --version\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      aws-cli/1.10.58 Python/2.7.11 Darwin/15.6.0 botocore/1.4.48\n\n\n\n0. \u6e96\u5099\n\n0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u6c7a\u5b9a\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nexport AWS_DEFAULT_REGION='ap-northeast-1'\n\n\n\n0.2. \u5909\u6570\u306e\u78ba\u8a8d\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u304c\u60f3\u5b9a\u306e\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u5909\u6570\u306e\u78ba\u8a8d\naws configure list\n\n\n\n\u7d50\u679c(\u4f8b)\n\n            Name                    Value             Type    Location\n            ----                    -----             ----    --------\n         profile       lambdaFull-prjz-mbp13        env    AWS_DEFAULT_PROFILE\n      access_key     ****************XXXX shared-credentials-file\n      secret_key     ****************XXXX shared-credentials-file\n          region        ap-northeast-1        env    AWS_DEFAULT_REGION\n\n\n\n1. \u4e8b\u524d\u4f5c\u696d\n\n1.1. API\u540d\u306e\u6307\u5b9a\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nAPIGW_API_NAME=\"slack-echo-command-$( date '+%Y%m%d' )\" \\\n        && echo ${APIGW_API_NAME}\n\n\n\u540c\u540d\u306eREST API\u304c\u5b58\u5728\u3057\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway get-rest-apis \\\n        --query \"items[?name == \\`${APIGW_API_NAME}\\`].name\"\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      []\n\n\n\n1.2. AWS ID\u306e\u53d6\u5f97\n\n\u30b3\u30de\u30f3\u30c9\nAWS_ID=$( \\\n        aws sts get-caller-identity \\\n          --query 'Account' \\\n          --output text \\\n) \\\n        && echo ${AWS_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      XXXXXXXXXXXX\n\n\n\n2. API\u306e\u4f5c\u6210\n\n2.1. API\u306e\u4f5c\u6210\nAPI\u3092\u4f5c\u6210\u3059\u308b\u3068\u304d\u306f\u3001\u8aac\u660e\u3082\u5fc5\u305a\u5165\u308c\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nAPIGW_API_DESC='API for slack-echo-command'\n\n\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n        APIGW_API_NAME: ${APIGW_API_NAME}\n        APIGW_API_DESC: \"${APIGW_API_DESC}\"\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway create-rest-api \\\n        --name ${APIGW_API_NAME} \\\n        --description \"${APIGW_API_DESC}\"\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"id\": \"xxxxxxxxxx\",\n        \"name\": \"slack-echo-command-20160829\",\n        \"description\": \"API for slack-echo-command\",\n        \"createdDate\": 1448002904\n      }\n\n\n\n2.2. API\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway get-rest-apis \\\n        --query \"items[?name == \\`${APIGW_API_NAME}\\`].name\"\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      [\n        \"slack-echo-command-20160829\"\n      ]\n\n\n\n2.3. API ID\u306e\u53d6\u5f97\n\n\u30b3\u30de\u30f3\u30c9\nAPIGW_API_ID=$( \\\n        aws apigateway get-rest-apis \\\n          --query \"items[?name == \\`${APIGW_API_NAME}\\`].id\" \\\n          --output text \\\n) \\\n        && echo ${APIGW_API_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      xxxxxxxxxx\n\n\n\n2.4. API\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway get-rest-api \\\n        --rest-api-id ${APIGW_API_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"id\": \"xxxxxxxxxx\",\n        \"name\": \"slack-echo-command-20160829\",\n        \"description\": \"API for slack-echo-command\",\n        \"createdDate\": 1445947998\n      }\n\n\n\n2.5. \u30e2\u30c7\u30eb\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway get-models \\\n        --rest-api-id ${APIGW_API_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"items\": [\n          {\n              \"description\": \"This is a default empty schema model\",\n              \"schema\": \"{\\n  \\\"$schema\\\": \\\"http://json-schema.org/draft-04/schema#\\\",\\n  \\\"title\\\" : \\\"Empty Schema\\\",n  \\\"type\\\" : \\\"object\\\"\\n}\",\n              \"contentType\": \"application/json\",\n              \"id\": \"xxxxxx\",\n              \"name\": \"Empty\"\n          },\n          {\n              \"description\": \"This is a default error schema model\",\n              \"schema\": \"{\\n  \\\"$schema\\\" : \\\"http://json-schema.org/draft-04/schema#\\\",\\n  \\\"title\\\" : \\\"Error Schema\\\",\\n  \\\"type\\\" : \\\"object\\\",\\n  \\\"properties\\\" : {\\n    \\\"message\\\" : { \\\"type\\\" : \\\"string\\\" }\\n  }\\n}\",\n              \"contentType\": \"application/json\",\n              \"id\": \"xxxxxx\",\n              \"name\": \"Error\"\n          }\n        ]\n      }\n\n\n\n3. \u30ea\u30bd\u30fc\u30b9\u306e\u4f5c\u6210\n\n3.1. \u73fe\u5728\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway get-resources \\\n        --rest-api-id ${APIGW_API_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"items\": [\n          {\n              \"path\": \"/\",\n              \"id\": \"xxxxxxxxxx\"\n          }\n        ]\n      }\n\n\n\n3.2. \u73fe\u5728\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u30ea\u30bd\u30fc\u30b9ID\u53d6\u5f97\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nAPIGW_RESOURCE_PATH=\"/\"\n\n\n\n\u30b3\u30de\u30f3\u30c9\nAPIGW_RESOURCE_ID=$( \\\n        aws apigateway get-resources \\\n          --rest-api-id ${APIGW_API_ID} \\\n          --query \"items[?path == \\`${APIGW_RESOURCE_PATH}\\`].id\" \\\n          --output text \\\n) \\\n        && echo ${APIGW_RESOURCE_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      xxxxxxxxxx\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway get-resource \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"path\": \"/\",\n        \"id\": \"xxxxxxxxxx\"\n      }\n\n\n\n3.3. \u65b0\u3057\u3044\u30ea\u30bd\u30fc\u30b9\u306e\u4f5c\u6210\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nAPIGW_PARENT_ID=\"${APIGW_RESOURCE_ID}\"\nAPIGW_PATH_PART='sayhello'\n\n\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n        APIGW_API_ID:    ${APIGW_API_ID}\n        APIGW_PARENT_ID: ${APIGW_PARENT_ID}\n        APIGW_PATH_PART: ${APIGW_PATH_PART}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway create-resource \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --parent-id ${APIGW_PARENT_ID} \\\n        --path-part ${APIGW_PATH_PART}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"path\": \"/sayhello\",\n        \"pathPart\": \"sayhello\",\n        \"id\": \"xxxxxx\",\n        \"parentId\": \"xxxxxxxxxx\"\n      }\n\n\n\n3.4. \u65b0\u3057\u3044\u30ea\u30bd\u30fc\u30b9\u306e\u30ea\u30bd\u30fc\u30b9ID\u53d6\u5f97\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nAPIGW_RESOURCE_PATH=\"${APIGW_RESOURCE_PATH}${APIGW_PATH_PART}\" \\\n        && echo ${APIGW_RESOURCE_PATH}\n\n\n\n\u30b3\u30de\u30f3\u30c9\nAPIGW_RESOURCE_ID=$( \\\n        aws apigateway get-resources \\\n          --rest-api-id ${APIGW_API_ID} \\\n          --query \"items[?path == \\`${APIGW_RESOURCE_PATH}\\`].id\" \\\n          --output text \\\n) \\\n        && echo ${APIGW_RESOURCE_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      xxxxxxxxxx\n\n\n\n3.5. \u65b0\u3057\u3044\u30ea\u30bd\u30fc\u30b9\u306e\u5185\u5bb9\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway get-resource \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"path\": \"/sayhello\",\n        \"pathPart\": \"sayhello\",\n        \"id\": \"xxxxxx\",\n        \"parentId\": \"gca9ho3sa4\"\n      }\n\n\n\n4. \u30e1\u30bd\u30c3\u30c9\u306e\u4f5c\u6210\n\n4.1. Lambda\u95a2\u6570\u306e\u6307\u5b9a\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nLAMBDA_FUNC_NAME='slack-echo-command-20160829'\n\n\n\n\u30b3\u30de\u30f3\u30c9\nLAMBDA_FUNC_ARN=$( \\\n        aws lambda get-function \\\n          --function-name ${LAMBDA_FUNC_NAME} \\\n          --query 'Configuration.FunctionArn' \\\n          --output text \\\n) \\\n        && echo ${LAMBDA_FUNC_ARN}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      arn:aws:lambda:ap-northeast-1:XXXXXXXXXXXX:function:slack-echo-command-20160829\n\n\n\n4.2. API Gateway Integration URL\u306e\u6307\u5b9a\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nAPIGW_INTEG_URI=\"arn:aws:apigateway:${AWS_DEFAULT_REGION}:lambda:path/2015-03-31/functions/${LAMBDA_FUNC_ARN}/invocations\" \\\n        && echo ${APIGW_INTEG_URI}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      arn:aws:lambda:ap-northeast-1:XXXXXXXXXXXX:function:slack-echo-command-20160829\n\n\n\n4.3. HTTP\u30e1\u30bd\u30c3\u30c9\u306e\u4f5c\u6210\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nHTTP_METHOD='POST'\nAUTH_TYPE='NONE'\n\n\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n        APIGW_API_ID:      ${APIGW_API_ID}\n        APIGW_RESOURCE_ID: ${APIGW_RESOURCE_ID}\n        HTTP_METHOD:       ${HTTP_METHOD}\n        AUTH_TYPE:         ${AUTH_TYPE}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway put-method \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD} \\\n        --authorization-type ${AUTH_TYPE}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"apiKeyRequired\": false,\n        \"httpMethod\": \"POST\",\n        \"authorizationType\": \"NONE\"\n      }\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway get-method \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"apiKeyRequired\": false,\n        \"httpMethod\": \"POST\",\n        \"authorizationType\": \"NONE\"\n      }\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway get-resource \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"resourceMethods\": {\n          \"POST\": {}\n        },\n        \"pathPart\": \"sayhello\",\n        \"parentId\": \"xxxxxxxxxx\",\n        \"path\": \"/sayhello\",\n        \"id\": \"xxxxxx\"\n      }\n\n\n\n4.4. integration\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway get-integration \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      A client error (NotFoundException) occurred when calling the GetIntegration operation: No integration defined for method\n\n\nIntegration Type\u306e\u6307\u5b9a\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nAPIGW_INTEG_TYPE='AWS'\n\n\nIntegration\u306eHTTP\u30e1\u30bd\u30c3\u30c9\u6307\u5b9a\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nAPIGW_INTEG_METHOD='POST'\n\n\nIntegration Request\u306eBody Mapping Templates\u4f5c\u6210\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nFILE_INPUT=\"${APIGW_RESOURCE_ID}-BODY_MAPPING_TEMPLATE.json\" \\\n        && echo ${FILE_INPUT}\n\n\n\n\u30b3\u30de\u30f3\u30c9\ncat << \\EOF > ${FILE_INPUT}\n      {\n        \"application/x-www-form-urlencoded\": \"{ \\\"body\\\": $input.json(\\\"$\\\") }\"\n      }\nEOF\n\n\nJSON\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u58ca\u308c\u3066\u306a\u3044\u304b\u5fc5\u305a\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\njsonlint -q ${FILE_INPUT}\n\n\n\u30a8\u30e9\u30fc\u304c\u51fa\u529b\u3055\u308c\u306a\u3051\u308c\u3070OK\u3067\u3059\u3002\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nAPIGW_PASSTHROUGH_BEHAVIOR='WHEN_NO_TEMPLATES'\n\n\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n        APIGW_API_ID:               ${APIGW_API_ID}\n        APIGW_RESOURCE_ID:          ${APIGW_RESOURCE_ID}\n        HTTP_METHOD:                ${HTTP_METHOD}\n        APIGW_INTEG_TYPE:           ${APIGW_INTEG_TYPE}\n        APIGW_INTEG_METHOD:         ${APIGW_INTEG_METHOD}\n        APIGW_INTEG_URI:            ${APIGW_INTEG_URI}\n        FILE_INPUT:                 ${FILE_INPUT}\n        APIGW_PASSTHROUGH_BEHAVIOR: ${APIGW_PASSTHROUGH_BEHAVIOR}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway put-integration \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD} \\\n        --type ${APIGW_INTEG_TYPE} \\\n        --integration-http-method ${APIGW_INTEG_METHOD} \\\n        --uri ${APIGW_INTEG_URI} \\\n        --request-templates file://${FILE_INPUT} \\\n        --passthrough-behavior ${APIGW_PASSTHROUGH_BEHAVIOR}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"passthroughBehavior\": \"WHEN_NO_TEMPLATES\",\n        \"cacheKeyParameters\": [],\n        \"uri\": \"arn:aws:apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-northeast-1:XXXXXXXXXXXX:function:slack-echo-command-20160829/invocations\",\n        \"httpMethod\": \"POST\",\n        \"requestTemplates\": {\n          \"application/x-www-form-urlencoded\": \"{ \\\"body\\\": $input.json(\\\"$\\\") }\"\n        },\n        \"cacheNamespace\": \"xxxxxx\",\n        \"type\": \"AWS\"\n      }\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway get-integration \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD}\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n        \"passthroughBehavior\": \"WHEN_NO_TEMPLATES\",\n        \"cacheKeyParameters\": [],\n        \"uri\": \"arn:aws:apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-northeast-1:XXXXXXXXXXXX:function:slack-echo-command-20160829/invocations\",\n        \"httpMethod\": \"POST\",\n        \"requestTemplates\": {\n          \"application/x-www-form-urlencoded\": \"{ \\\"body\\\": $input.json(\\\"$\\\") }\"\n        },\n        \"cacheNamespace\": \"xxxxxx\",\n        \"type\": \"AWS\"\n      }\n\n\n\n4.5. Integration Response\u306e\u4f5c\u6210\nPOST\u30e1\u30bd\u30c3\u30c9\u306e\u30ea\u30b6\u30eb\u30c8\u30b3\u30fc\u30c9200\u3067\u306eIntegration Response\u304c\u5b58\u5728\u4f5c\u6210\u3057\u306a\n\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nHTTP_STATUS_CODE='200'\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway get-integration-response \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD} \\\n        --status-code ${HTTP_STATUS_CODE}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      A client error (NotFoundException) occurred when calling the GetMethodResponse operation: Invalid Response status code specified\n\n\nPOST\u30e1\u30bd\u30c3\u30c9\u306e\u30ea\u30b6\u30eb\u30c8\u30b3\u30fc\u30c9200\u3067\u306eIntegration Response\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n        APIGW_API_ID:       ${APIGW_API_ID}\n        APIGW_RESOURCE_ID:  ${APIGW_RESOURCE_ID}\n        HTTP_METHOD:        ${HTTP_METHOD}\n        HTTP_STATUS_CODE:   ${HTTP_STATUS_CODE}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway put-integration-response \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD} \\\n        --status-code ${HTTP_STATUS_CODE} \\\n        --selection-pattern \".*\"\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"selectionPattern\": \".*\",\n        \"statusCode\": \"200\"\n      }\n\n\nPOST\u30e1\u30bd\u30c3\u30c9\u306e\u30ea\u30b6\u30eb\u30c8\u30b3\u30fc\u30c9200\u3067\u306eIntegration Response\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway get-integration-response \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD} \\\n        --status-code ${HTTP_STATUS_CODE}\n\n\n\n\u7d50\u679c(\u4f8b)\n{\n    \"selectionPattern\": \".*\", \n    \"statusCode\": \"200\"\n}\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway get-integration \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"integrationResponses\": {\n          \"200\": {\n              \"selectionPattern\": \".*\",\n              \"statusCode\": \"200\"\n          }\n        },\n        \"passthroughBehavior\": \"WHEN_NO_TEMPLATES\",\n        \"cacheKeyParameters\": [],\n        \"uri\": \"arn:aws:apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-northeast-1:XXXXXXXXXXXX:function:slack-echo-command-20160829/invocations\",\n        \"httpMethod\": \"POST\",\n        \"requestTemplates\": {\n          \"application/x-www-form-urlencoded\": \"{ \"body\": $input.json(\"$\") }\"\n        },\n        \"cacheNamespace\": \"hrs5il\",\n        \"type\": \"AWS\"\n      }\n\n\n\n4.6. Lambda\u95a2\u6570\u306e\u5b9f\u884c\u6a29\u9650\u4ed8\u4e0e\nPOST\u30e1\u30bd\u30c3\u30c9\u306e\u30ea\u30b6\u30eb\u30c8\u30b3\u30fc\u30c9200\u3067\u306eIntegration Response\u306b\u3001Lambda\u95a2\u6570\n\u3092\u5b9f\u884c\u3059\u308b\u6a29\u9650\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002\nStatement ID\u3092\u4e71\u657032\u6841\u3067\u751f\u6210\u3057\u307e\u3059\u3002\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nLAMBDA_STAT_ID=$(od -vAn -N16 -tx < /dev/urandom | sed 's/ //g')\n\n\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nRESOURCE_PATH=\"${APIGW_RESOURCE_PATH}\"\n\n\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n        AWS_ID:        ${AWS_ID}\n        APIGW_API_ID:  ${APIGW_API_ID}\n        HTTP_METHOD:   ${HTTP_METHOD}\n        RESOURCE_PATH: ${RESOURCE_PATH}\n\nETX\n\n\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nSOURCE_ARN=\"arn:aws:execute-api:${AWS_DEFAULT_REGION}:${AWS_ID}:${APIGW_API_ID}/*/${HTTP_METHOD}${RESOURCE_PATH}\" \\\n        && echo ${SOURCE_ARN}\n\n\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nLAMBDA_PERMIT_ACTION='lambda:InvokeFunction'\n      LAMBDA_PERMIT_PRINCIPAL='apigateway.amazonaws.com'\n      RESOURCE_PATH=\"${APIGW_RESOURCE_PATH}\"\n\n\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n        LAMBDA_FUNC_NAME:        ${LAMBDA_FUNC_NAME}\n        LAMBDA_STAT_ID:          ${LAMBDA_STAT_ID}\n        LAMBDA_PERMIT_ACTION:    ${LAMBDA_PERMIT_ACTION}\n        LAMBDA_PERMIT_PRINCIPAL: ${LAMBDA_PERMIT_PRINCIPAL}\n        SOURCE_ARN:              ${SOURCE_ARN}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws lambda add-permission \\\n        --function-name ${LAMBDA_FUNC_NAME} \\\n        --statement-id ${LAMBDA_STAT_ID} \\\n        --action ${LAMBDA_PERMIT_ACTION} \\\n        --principal ${LAMBDA_PERMIT_PRINCIPAL} \\\n        --source-arn ${SOURCE_ARN}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"Statement\": \"{\\\"Condition\\\":{\\\"ArnLike\\\":{\\\"AWS:SourceArn\\\":\\\"arn:aws:execute-api:ap-northeast-1:XXXXXXXXXXXX:xxxxxxxxxx/*/POST/sayhello\\\"}},\\\"Action\\\":[\\\"lambda:InvokeFunction\\\"],\\\"Resource\\\":\\\"arn:aws:lambda:ap-northeast-1:XXXXXXXXXXXX:function:slack-echo-command-20160829\\\",\\\"Effect\\\":\\\"Allow\\\",\\\"Principal\\\":{\\\"Service\\\":\\\"apigateway.amazonaws.com\\\"},\\\"Sid\\\":\\\"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\\\"}\"\n      }\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws lambda get-policy \\\n        --function-name ${LAMBDA_FUNC_NAME} \\\n        | sed 's/\\\\//g' | sed 's/\\\"{/{/' | sed 's/\\\"$//' \\\n        | jp.py \"Policy.Statement[?Sid == \\`${LAMBDA_STAT_ID}\\`]\"\n\n\n\n\u7d50\u679c(\u4f8b)\n[\n    {\n        \"Resource\": \"arn:aws:lambda:ap-northeast-1:XXXXXXXXXXXX:function:slack-echo-command-20160828\",\n        \"Effect\": \"Allow\",        \"Sid\": \"54dee6c20e66aa1d1af183b2b8a2796a\",\n        \"Action\": \"lambda:InvokeFunction\",\n        \"Condition\": {\n            \"ArnLike\": {\n                \"AWS:SourceArn\": \"arn:aws:execute-api:ap-northeast-1:XXXXXXXXXXXX:npvefdajeb/*/POST/sayhello\"\n            }        },\n        \"Principal\": {\n            \"Service\": \"apigateway.amazonaws.com\"\n        }\n    }\n]\n\n\n\n4.7. Method Response\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway get-method-response \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD} \\\n        --status-code ${HTTP_STATUS_CODE}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      A client error (NotFoundException) occurred when calling the GetIntegrationResponse operation: Invalid Response status code specified\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway put-method-response \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD} \\\n        --status-code ${HTTP_STATUS_CODE} \\\n        --response-models '{}'\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"responseModels\": {},\n        \"statusCode\": \"200\"\n      }\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway get-method-response \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD} \\\n        --status-code ${HTTP_STATUS_CODE}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"responseModels\": {},\n        \"statusCode\": \"200\"\n      }\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway get-method \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"apiKeyRequired\": false,\n        \"httpMethod\": \"POST\",\n        \"methodIntegration\": {\n          \"integrationResponses\": {\n              \"200\": {\n                  \"selectionPattern\": \".*\",\n                  \"statusCode\": \"200\"\n              }\n          },\n          \"passthroughBehavior\": \"WHEN_NO_TEMPLATES\",\n          \"cacheKeyParameters\": [],\n          \"uri\": \"arn:aws:apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-northeast-1:XXXXXXXXXXXX:function:slack-echo-command-20160828/invocations\",\n          \"httpMethod\": \"POST\",\n          \"requestTemplates\": {\n              \"application/x-www-form-urlencoded\": \"{ \"body\": $input.json(\"$\") }\"\n          },\n          \"cacheNamespace\": \"0z3hfw\",\n          \"type\": \"AWS\"\n        },\n        \"methodResponses\": {\n          \"200\": {\n              \"responseModels\": {},\n              \"statusCode\": \"200\"\n          }\n        },\n        \"authorizationType\": \"NONE\"\n      }\n\n\n\n5. API\u306e\u30c7\u30d7\u30ed\u30a4\n\n5.1. API\u306e\u30c7\u30d7\u30ed\u30a4\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway get-deployments \\\n        --rest-api-id ${APIGW_API_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n          \"items\": []\n      }\n\n\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nAPIGW_STAGE_NAME='prod'\nAPIGW_STAGE_DESC='This is a prod.'\nAPIGW_DEPLOY_DESC='Calling Lambda functions blueprint.'\n\n\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n        APIGW_API_ID:      ${APIGW_API_ID}\n        APIGW_STAGE_NAME:  ${APIGW_STAGE_NAME}\n        APIGW_STAGE_DESC:  \"${APIGW_STAGE_DESC}\"\n        APIGW_DEPLOY_DESC: \"${APIGW_DEPLOY_DESC}\"\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway create-deployment \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --stage-name ${APIGW_STAGE_NAME} \\\n        --stage-description \"${APIGW_STAGE_DESC}\" \\\n        --description \"${APIGW_DEPLOY_DESC}\"\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"description\": \"Calling Lambda functions blueprint.\",\n        \"id\": \"xxxxxx\",\n        \"createdDate\": 1448115971\n      }\n\n\n\n5.2. API\u306e\u30b9\u30c6\u30fc\u30b8\u540d\u306e\u53d6\u5f97\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway get-stages \\\n        --rest-api-id ${APIGW_API_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"item\": [\n          {\n              \"description\": \"This is a prod.\",\n              \"stageName\": \"test\",\n              \"cacheClusterEnabled\": false,\n              \"cacheClusterStatus\": \"NOT_AVAILABLE\",\n              \"deploymentId\": \"xxxxxx\",\n              \"lastUpdatedDate\": 1448115971,\n              \"createdDate\": 1448115971,\n              \"methodSettings\": {}\n          }\n        ]\n      }\n\n\n\n\u30b3\u30de\u30f3\u30c9\nAPIGW_STAGE_NAME=$( \\\n        aws apigateway get-stages \\\n          --rest-api-id ${APIGW_API_ID} \\\n          --query \"item[?description == \\`${APIGW_STAGE_DESC}\\`].stageName\" \\\n          --output text \\\n) \\\n        && echo ${APIGW_STAGE_NAME}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      prod\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws apigateway get-stage \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --stage-name ${APIGW_STAGE_NAME}\n\n\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"stageName\": \"prod\",\n        \"description\": \"This is a prod.\",\n        \"cacheClusterEnabled\": false,\n        \"cacheClusterStatus\": \"NOT_AVAILABLE\",\n        \"deploymentId\": \"xxxxxx\",\n        \"lastUpdatedDate\": 1448115971,\n        \"createdDate\": 1448115971,\n        \"methodSettings\": {}\n      }\n\n\n\n6. API\u306e\u30c6\u30b9\u30c8\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nAPIGW_URI=\"https://${APIGW_API_ID}.execute-api.${AWS_DEFAULT_REGION}.amazonaws.com/${APIGW_STAGE_NAME}${APIGW_RESOURCE_PATH}\" \\\n        && echo ${APIGW_URI}\n\n\n\n7. Slack (API Endpoint\u8ffd\u52a0)\n\n\nhttps://${SLACK_TEAM_NAME}.slack.com/apps \u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002(App Directory \u753b \u9762)\n\n\u691c\u7d22\u7a93\u306b 'Slash Commands' \u3068\u5165\u529b\u3057\u307e\u3059\u3002\n'Slash Commands'\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\n\nBrowse Apps > Slash Commands (\u753b\u9762)\n\n(\u30dc\u30bf\u30f3)\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\n\nEdit configuration (\u753b\u9762)\n\nIntegration Settings\n\n\nURL: API Gateway\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\n\n\n\n\n\n\n8. slack\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\nslack\u304b\u3089\u3001/sayhello\u30b3\u30de\u30f3\u30c9\u306b\u7d9a\u3044\u3066\u82f1\u6570\u5b57\u534a\u89d2\u306e\u30c6\u30ad\u30b9\u30c8\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\n/sayhello ec2\n\n\n\n\u5b8c\u4e86\n# \u524d\u63d0\u6761\u4ef6\n\n\n## API Gateway\u3078\u306e\u6a29\u9650\n\nAPI Gateway\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\n## Lambda\u3078\u306e\u6a29\u9650\n\nLambda\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\n\n## AWS CLI\n\n\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\n* AWS CLI 1.10.58\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws --version\n```\n\n```text:\u7d50\u679c(\u4f8b):\n\n      aws-cli/1.10.58 Python/2.7.11 Darwin/15.6.0 botocore/1.4.48\n```\n\n\n# 0. \u6e96\u5099\n\n\n## 0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u6c7a\u5b9a\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nexport AWS_DEFAULT_REGION='ap-northeast-1'\n```\n\n\n## 0.2. \u5909\u6570\u306e\u78ba\u8a8d\n\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u304c\u60f3\u5b9a\u306e\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\naws configure list\n```\n\n```text:\u7d50\u679c(\u4f8b):\n\n            Name                    Value             Type    Location\n            ----                    -----             ----    --------\n         profile       lambdaFull-prjz-mbp13        env    AWS_DEFAULT_PROFILE\n      access_key     ****************XXXX shared-credentials-file\n      secret_key     ****************XXXX shared-credentials-file\n          region        ap-northeast-1        env    AWS_DEFAULT_REGION\n```\n\n\n# 1. \u4e8b\u524d\u4f5c\u696d\n\n\n## 1.1. API\u540d\u306e\u6307\u5b9a\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nAPIGW_API_NAME=\"slack-echo-command-$( date '+%Y%m%d' )\" \\\n        && echo ${APIGW_API_NAME}\n```\n\n\u540c\u540d\u306eREST API\u304c\u5b58\u5728\u3057\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway get-rest-apis \\\n        --query \"items[?name == \\`${APIGW_API_NAME}\\`].name\"\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      []\n```\n\n\n## 1.2. AWS ID\u306e\u53d6\u5f97\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nAWS_ID=$( \\\n        aws sts get-caller-identity \\\n          --query 'Account' \\\n          --output text \\\n) \\\n        && echo ${AWS_ID}\n```\n\n```text:\u7d50\u679c(\u4f8b):\n\n      XXXXXXXXXXXX\n```\n\n\n# 2. API\u306e\u4f5c\u6210\n\n\n\n## 2.1. API\u306e\u4f5c\u6210\n\nAPI\u3092\u4f5c\u6210\u3059\u308b\u3068\u304d\u306f\u3001\u8aac\u660e\u3082\u5fc5\u305a\u5165\u308c\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nAPIGW_API_DESC='API for slack-echo-command'\n```\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n        APIGW_API_NAME: ${APIGW_API_NAME}\n        APIGW_API_DESC: \"${APIGW_API_DESC}\"\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway create-rest-api \\\n        --name ${APIGW_API_NAME} \\\n        --description \"${APIGW_API_DESC}\"\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n        \"id\": \"xxxxxxxxxx\",\n        \"name\": \"slack-echo-command-20160829\",\n        \"description\": \"API for slack-echo-command\",\n        \"createdDate\": 1448002904\n      }\n```\n\n\n## 2.2. API\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway get-rest-apis \\\n        --query \"items[?name == \\`${APIGW_API_NAME}\\`].name\"\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      [\n        \"slack-echo-command-20160829\"\n      ]\n```\n\n\n## 2.3. API ID\u306e\u53d6\u5f97\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nAPIGW_API_ID=$( \\\n        aws apigateway get-rest-apis \\\n          --query \"items[?name == \\`${APIGW_API_NAME}\\`].id\" \\\n          --output text \\\n) \\\n        && echo ${APIGW_API_ID}\n```\n\n```text:\u7d50\u679c(\u4f8b):\n\n      xxxxxxxxxx\n```\n\n\n## 2.4. API\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway get-rest-api \\\n        --rest-api-id ${APIGW_API_ID}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n        \"id\": \"xxxxxxxxxx\",\n        \"name\": \"slack-echo-command-20160829\",\n        \"description\": \"API for slack-echo-command\",\n        \"createdDate\": 1445947998\n      }\n```\n\n\n## 2.5. \u30e2\u30c7\u30eb\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway get-models \\\n        --rest-api-id ${APIGW_API_ID}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n        \"items\": [\n          {\n              \"description\": \"This is a default empty schema model\",\n              \"schema\": \"{\\n  \\\"$schema\\\": \\\"http://json-schema.org/draft-04/schema#\\\",\\n  \\\"title\\\" : \\\"Empty Schema\\\",n  \\\"type\\\" : \\\"object\\\"\\n}\",\n              \"contentType\": \"application/json\",\n              \"id\": \"xxxxxx\",\n              \"name\": \"Empty\"\n          },\n          {\n              \"description\": \"This is a default error schema model\",\n              \"schema\": \"{\\n  \\\"$schema\\\" : \\\"http://json-schema.org/draft-04/schema#\\\",\\n  \\\"title\\\" : \\\"Error Schema\\\",\\n  \\\"type\\\" : \\\"object\\\",\\n  \\\"properties\\\" : {\\n    \\\"message\\\" : { \\\"type\\\" : \\\"string\\\" }\\n  }\\n}\",\n              \"contentType\": \"application/json\",\n              \"id\": \"xxxxxx\",\n              \"name\": \"Error\"\n          }\n        ]\n      }\n```\n\n\n# 3. \u30ea\u30bd\u30fc\u30b9\u306e\u4f5c\u6210\n\n\n## 3.1. \u73fe\u5728\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway get-resources \\\n        --rest-api-id ${APIGW_API_ID}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n        \"items\": [\n          {\n              \"path\": \"/\",\n              \"id\": \"xxxxxxxxxx\"\n          }\n        ]\n      }\n```\n\n\n## 3.2. \u73fe\u5728\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u30ea\u30bd\u30fc\u30b9ID\u53d6\u5f97\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nAPIGW_RESOURCE_PATH=\"/\"\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nAPIGW_RESOURCE_ID=$( \\\n        aws apigateway get-resources \\\n          --rest-api-id ${APIGW_API_ID} \\\n          --query \"items[?path == \\`${APIGW_RESOURCE_PATH}\\`].id\" \\\n          --output text \\\n) \\\n        && echo ${APIGW_RESOURCE_ID}\n```\n\n```text:\u7d50\u679c(\u4f8b):\n\n      xxxxxxxxxx\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway get-resource \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n        \"path\": \"/\",\n        \"id\": \"xxxxxxxxxx\"\n      }\n```\n\n\n## 3.3. \u65b0\u3057\u3044\u30ea\u30bd\u30fc\u30b9\u306e\u4f5c\u6210\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nAPIGW_PARENT_ID=\"${APIGW_RESOURCE_ID}\"\nAPIGW_PATH_PART='sayhello'\n```\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n        APIGW_API_ID:    ${APIGW_API_ID}\n        APIGW_PARENT_ID: ${APIGW_PARENT_ID}\n        APIGW_PATH_PART: ${APIGW_PATH_PART}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway create-resource \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --parent-id ${APIGW_PARENT_ID} \\\n        --path-part ${APIGW_PATH_PART}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n        \"path\": \"/sayhello\",\n        \"pathPart\": \"sayhello\",\n        \"id\": \"xxxxxx\",\n        \"parentId\": \"xxxxxxxxxx\"\n      }\n```\n\n\n## 3.4. \u65b0\u3057\u3044\u30ea\u30bd\u30fc\u30b9\u306e\u30ea\u30bd\u30fc\u30b9ID\u53d6\u5f97\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nAPIGW_RESOURCE_PATH=\"${APIGW_RESOURCE_PATH}${APIGW_PATH_PART}\" \\\n        && echo ${APIGW_RESOURCE_PATH}\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nAPIGW_RESOURCE_ID=$( \\\n        aws apigateway get-resources \\\n          --rest-api-id ${APIGW_API_ID} \\\n          --query \"items[?path == \\`${APIGW_RESOURCE_PATH}\\`].id\" \\\n          --output text \\\n) \\\n        && echo ${APIGW_RESOURCE_ID}\n```\n\n```text:\u7d50\u679c(\u4f8b):\n\n      xxxxxxxxxx\n```\n\n\n## 3.5. \u65b0\u3057\u3044\u30ea\u30bd\u30fc\u30b9\u306e\u5185\u5bb9\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway get-resource \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n        \"path\": \"/sayhello\",\n        \"pathPart\": \"sayhello\",\n        \"id\": \"xxxxxx\",\n        \"parentId\": \"gca9ho3sa4\"\n      }\n```\n\n\n# 4. \u30e1\u30bd\u30c3\u30c9\u306e\u4f5c\u6210\n\n\n## 4.1. Lambda\u95a2\u6570\u306e\u6307\u5b9a\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nLAMBDA_FUNC_NAME='slack-echo-command-20160829'\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nLAMBDA_FUNC_ARN=$( \\\n        aws lambda get-function \\\n          --function-name ${LAMBDA_FUNC_NAME} \\\n          --query 'Configuration.FunctionArn' \\\n          --output text \\\n) \\\n        && echo ${LAMBDA_FUNC_ARN}\n```\n\n```text:\u7d50\u679c(\u4f8b):\n\n      arn:aws:lambda:ap-northeast-1:XXXXXXXXXXXX:function:slack-echo-command-20160829\n```\n\n\n## 4.2. API Gateway Integration URL\u306e\u6307\u5b9a\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nAPIGW_INTEG_URI=\"arn:aws:apigateway:${AWS_DEFAULT_REGION}:lambda:path/2015-03-31/functions/${LAMBDA_FUNC_ARN}/invocations\" \\\n        && echo ${APIGW_INTEG_URI}\n```\n\n```text:\u7d50\u679c(\u4f8b):\n\n      arn:aws:lambda:ap-northeast-1:XXXXXXXXXXXX:function:slack-echo-command-20160829\n```\n\n\n## 4.3. HTTP\u30e1\u30bd\u30c3\u30c9\u306e\u4f5c\u6210\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nHTTP_METHOD='POST'\nAUTH_TYPE='NONE'\n```\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n        APIGW_API_ID:      ${APIGW_API_ID}\n        APIGW_RESOURCE_ID: ${APIGW_RESOURCE_ID}\n        HTTP_METHOD:       ${HTTP_METHOD}\n        AUTH_TYPE:         ${AUTH_TYPE}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway put-method \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD} \\\n        --authorization-type ${AUTH_TYPE}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n        \"apiKeyRequired\": false,\n        \"httpMethod\": \"POST\",\n        \"authorizationType\": \"NONE\"\n      }\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway get-method \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n        \"apiKeyRequired\": false,\n        \"httpMethod\": \"POST\",\n        \"authorizationType\": \"NONE\"\n      }\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway get-resource \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n        \"resourceMethods\": {\n          \"POST\": {}\n        },\n        \"pathPart\": \"sayhello\",\n        \"parentId\": \"xxxxxxxxxx\",\n        \"path\": \"/sayhello\",\n        \"id\": \"xxxxxx\"\n      }\n```\n\n\n## 4.4. integration\u306e\u4f5c\u6210\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway get-integration \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD}\n```\n\n```text:\u7d50\u679c(\u4f8b):\n\n      A client error (NotFoundException) occurred when calling the GetIntegration operation: No integration defined for method\n```\n\nIntegration Type\u306e\u6307\u5b9a\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nAPIGW_INTEG_TYPE='AWS'\n```\n\nIntegration\u306eHTTP\u30e1\u30bd\u30c3\u30c9\u6307\u5b9a\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nAPIGW_INTEG_METHOD='POST'\n```\n\nIntegration Request\u306eBody Mapping Templates\u4f5c\u6210\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nFILE_INPUT=\"${APIGW_RESOURCE_ID}-BODY_MAPPING_TEMPLATE.json\" \\\n        && echo ${FILE_INPUT}\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\ncat << \\EOF > ${FILE_INPUT}\n      {\n        \"application/x-www-form-urlencoded\": \"{ \\\"body\\\": $input.json(\\\"$\\\") }\"\n      }\nEOF\n```\n\nJSON\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u58ca\u308c\u3066\u306a\u3044\u304b\u5fc5\u305a\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\njsonlint -q ${FILE_INPUT}\n```\n\n\u30a8\u30e9\u30fc\u304c\u51fa\u529b\u3055\u308c\u306a\u3051\u308c\u3070OK\u3067\u3059\u3002\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nAPIGW_PASSTHROUGH_BEHAVIOR='WHEN_NO_TEMPLATES'\n```\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n        APIGW_API_ID:               ${APIGW_API_ID}\n        APIGW_RESOURCE_ID:          ${APIGW_RESOURCE_ID}\n        HTTP_METHOD:                ${HTTP_METHOD}\n        APIGW_INTEG_TYPE:           ${APIGW_INTEG_TYPE}\n        APIGW_INTEG_METHOD:         ${APIGW_INTEG_METHOD}\n        APIGW_INTEG_URI:            ${APIGW_INTEG_URI}\n        FILE_INPUT:                 ${FILE_INPUT}\n        APIGW_PASSTHROUGH_BEHAVIOR: ${APIGW_PASSTHROUGH_BEHAVIOR}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway put-integration \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD} \\\n        --type ${APIGW_INTEG_TYPE} \\\n        --integration-http-method ${APIGW_INTEG_METHOD} \\\n        --uri ${APIGW_INTEG_URI} \\\n        --request-templates file://${FILE_INPUT} \\\n        --passthrough-behavior ${APIGW_PASSTHROUGH_BEHAVIOR}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n        \"passthroughBehavior\": \"WHEN_NO_TEMPLATES\",\n        \"cacheKeyParameters\": [],\n        \"uri\": \"arn:aws:apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-northeast-1:XXXXXXXXXXXX:function:slack-echo-command-20160829/invocations\",\n        \"httpMethod\": \"POST\",\n        \"requestTemplates\": {\n          \"application/x-www-form-urlencoded\": \"{ \\\"body\\\": $input.json(\\\"$\\\") }\"\n        },\n        \"cacheNamespace\": \"xxxxxx\",\n        \"type\": \"AWS\"\n      }\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway get-integration \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n      {\n        \"passthroughBehavior\": \"WHEN_NO_TEMPLATES\",\n        \"cacheKeyParameters\": [],\n        \"uri\": \"arn:aws:apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-northeast-1:XXXXXXXXXXXX:function:slack-echo-command-20160829/invocations\",\n        \"httpMethod\": \"POST\",\n        \"requestTemplates\": {\n          \"application/x-www-form-urlencoded\": \"{ \\\"body\\\": $input.json(\\\"$\\\") }\"\n        },\n        \"cacheNamespace\": \"xxxxxx\",\n        \"type\": \"AWS\"\n      }\n```\n\n\n## 4.5. Integration Response\u306e\u4f5c\u6210\n\nPOST\u30e1\u30bd\u30c3\u30c9\u306e\u30ea\u30b6\u30eb\u30c8\u30b3\u30fc\u30c9200\u3067\u306eIntegration Response\u304c\u5b58\u5728\u4f5c\u6210\u3057\u306a\n\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nHTTP_STATUS_CODE='200'\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway get-integration-response \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD} \\\n        --status-code ${HTTP_STATUS_CODE}\n```\n\n```text:\u7d50\u679c(\u4f8b):\n\n      A client error (NotFoundException) occurred when calling the GetMethodResponse operation: Invalid Response status code specified\n```\n\nPOST\u30e1\u30bd\u30c3\u30c9\u306e\u30ea\u30b6\u30eb\u30c8\u30b3\u30fc\u30c9200\u3067\u306eIntegration Response\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n        APIGW_API_ID:       ${APIGW_API_ID}\n        APIGW_RESOURCE_ID:  ${APIGW_RESOURCE_ID}\n        HTTP_METHOD:        ${HTTP_METHOD}\n        HTTP_STATUS_CODE:   ${HTTP_STATUS_CODE}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway put-integration-response \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD} \\\n        --status-code ${HTTP_STATUS_CODE} \\\n        --selection-pattern \".*\"\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n        \"selectionPattern\": \".*\",\n        \"statusCode\": \"200\"\n      }\n```\n\nPOST\u30e1\u30bd\u30c3\u30c9\u306e\u30ea\u30b6\u30eb\u30c8\u30b3\u30fc\u30c9200\u3067\u306eIntegration Response\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway get-integration-response \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD} \\\n        --status-code ${HTTP_STATUS_CODE}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n{\n    \"selectionPattern\": \".*\", \n    \"statusCode\": \"200\"\n}\n```\n\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway get-integration \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n        \"integrationResponses\": {\n          \"200\": {\n              \"selectionPattern\": \".*\",\n              \"statusCode\": \"200\"\n          }\n        },\n        \"passthroughBehavior\": \"WHEN_NO_TEMPLATES\",\n        \"cacheKeyParameters\": [],\n        \"uri\": \"arn:aws:apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-northeast-1:XXXXXXXXXXXX:function:slack-echo-command-20160829/invocations\",\n        \"httpMethod\": \"POST\",\n        \"requestTemplates\": {\n          \"application/x-www-form-urlencoded\": \"{ \"body\": $input.json(\"$\") }\"\n        },\n        \"cacheNamespace\": \"hrs5il\",\n        \"type\": \"AWS\"\n      }\n```\n\n\n## 4.6. Lambda\u95a2\u6570\u306e\u5b9f\u884c\u6a29\u9650\u4ed8\u4e0e\n\nPOST\u30e1\u30bd\u30c3\u30c9\u306e\u30ea\u30b6\u30eb\u30c8\u30b3\u30fc\u30c9200\u3067\u306eIntegration Response\u306b\u3001Lambda\u95a2\u6570\n\u3092\u5b9f\u884c\u3059\u308b\u6a29\u9650\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002\n\nStatement ID\u3092\u4e71\u657032\u6841\u3067\u751f\u6210\u3057\u307e\u3059\u3002\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nLAMBDA_STAT_ID=$(od -vAn -N16 -tx < /dev/urandom | sed 's/ //g')\n```\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nRESOURCE_PATH=\"${APIGW_RESOURCE_PATH}\"\n```\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n        AWS_ID:        ${AWS_ID}\n        APIGW_API_ID:  ${APIGW_API_ID}\n        HTTP_METHOD:   ${HTTP_METHOD}\n        RESOURCE_PATH: ${RESOURCE_PATH}\n\nETX\n```\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nSOURCE_ARN=\"arn:aws:execute-api:${AWS_DEFAULT_REGION}:${AWS_ID}:${APIGW_API_ID}/*/${HTTP_METHOD}${RESOURCE_PATH}\" \\\n        && echo ${SOURCE_ARN}\n```\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nLAMBDA_PERMIT_ACTION='lambda:InvokeFunction'\n      LAMBDA_PERMIT_PRINCIPAL='apigateway.amazonaws.com'\n      RESOURCE_PATH=\"${APIGW_RESOURCE_PATH}\"\n```\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n        LAMBDA_FUNC_NAME:        ${LAMBDA_FUNC_NAME}\n        LAMBDA_STAT_ID:          ${LAMBDA_STAT_ID}\n        LAMBDA_PERMIT_ACTION:    ${LAMBDA_PERMIT_ACTION}\n        LAMBDA_PERMIT_PRINCIPAL: ${LAMBDA_PERMIT_PRINCIPAL}\n        SOURCE_ARN:              ${SOURCE_ARN}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws lambda add-permission \\\n        --function-name ${LAMBDA_FUNC_NAME} \\\n        --statement-id ${LAMBDA_STAT_ID} \\\n        --action ${LAMBDA_PERMIT_ACTION} \\\n        --principal ${LAMBDA_PERMIT_PRINCIPAL} \\\n        --source-arn ${SOURCE_ARN}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n        \"Statement\": \"{\\\"Condition\\\":{\\\"ArnLike\\\":{\\\"AWS:SourceArn\\\":\\\"arn:aws:execute-api:ap-northeast-1:XXXXXXXXXXXX:xxxxxxxxxx/*/POST/sayhello\\\"}},\\\"Action\\\":[\\\"lambda:InvokeFunction\\\"],\\\"Resource\\\":\\\"arn:aws:lambda:ap-northeast-1:XXXXXXXXXXXX:function:slack-echo-command-20160829\\\",\\\"Effect\\\":\\\"Allow\\\",\\\"Principal\\\":{\\\"Service\\\":\\\"apigateway.amazonaws.com\\\"},\\\"Sid\\\":\\\"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\\\"}\"\n      }\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws lambda get-policy \\\n        --function-name ${LAMBDA_FUNC_NAME} \\\n        | sed 's/\\\\//g' | sed 's/\\\"{/{/' | sed 's/\\\"$//' \\\n        | jp.py \"Policy.Statement[?Sid == \\`${LAMBDA_STAT_ID}\\`]\"\n```\n\n```json:\u7d50\u679c(\u4f8b):\n[\n    {\n        \"Resource\": \"arn:aws:lambda:ap-northeast-1:XXXXXXXXXXXX:function:slack-echo-command-20160828\",\n        \"Effect\": \"Allow\",        \"Sid\": \"54dee6c20e66aa1d1af183b2b8a2796a\",\n        \"Action\": \"lambda:InvokeFunction\",\n        \"Condition\": {\n            \"ArnLike\": {\n                \"AWS:SourceArn\": \"arn:aws:execute-api:ap-northeast-1:XXXXXXXXXXXX:npvefdajeb/*/POST/sayhello\"\n            }        },\n        \"Principal\": {\n            \"Service\": \"apigateway.amazonaws.com\"\n        }\n    }\n]\n```\n\n\n## 4.7. Method Response\u306e\u4f5c\u6210\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway get-method-response \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD} \\\n        --status-code ${HTTP_STATUS_CODE}\n```\n\n```text:\u7d50\u679c(\u4f8b):\n\n      A client error (NotFoundException) occurred when calling the GetIntegrationResponse operation: Invalid Response status code specified\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway put-method-response \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD} \\\n        --status-code ${HTTP_STATUS_CODE} \\\n        --response-models '{}'\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n        \"responseModels\": {},\n        \"statusCode\": \"200\"\n      }\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway get-method-response \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD} \\\n        --status-code ${HTTP_STATUS_CODE}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n        \"responseModels\": {},\n        \"statusCode\": \"200\"\n      }\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway get-method \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --resource-id ${APIGW_RESOURCE_ID} \\\n        --http-method ${HTTP_METHOD}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n        \"apiKeyRequired\": false,\n        \"httpMethod\": \"POST\",\n        \"methodIntegration\": {\n          \"integrationResponses\": {\n              \"200\": {\n                  \"selectionPattern\": \".*\",\n                  \"statusCode\": \"200\"\n              }\n          },\n          \"passthroughBehavior\": \"WHEN_NO_TEMPLATES\",\n          \"cacheKeyParameters\": [],\n          \"uri\": \"arn:aws:apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-northeast-1:XXXXXXXXXXXX:function:slack-echo-command-20160828/invocations\",\n          \"httpMethod\": \"POST\",\n          \"requestTemplates\": {\n              \"application/x-www-form-urlencoded\": \"{ \"body\": $input.json(\"$\") }\"\n          },\n          \"cacheNamespace\": \"0z3hfw\",\n          \"type\": \"AWS\"\n        },\n        \"methodResponses\": {\n          \"200\": {\n              \"responseModels\": {},\n              \"statusCode\": \"200\"\n          }\n        },\n        \"authorizationType\": \"NONE\"\n      }\n```\n\n\n# 5. API\u306e\u30c7\u30d7\u30ed\u30a4\n\n\n## 5.1. API\u306e\u30c7\u30d7\u30ed\u30a4\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway get-deployments \\\n        --rest-api-id ${APIGW_API_ID}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n          \"items\": []\n      }\n```\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nAPIGW_STAGE_NAME='prod'\nAPIGW_STAGE_DESC='This is a prod.'\nAPIGW_DEPLOY_DESC='Calling Lambda functions blueprint.'\n```\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n        APIGW_API_ID:      ${APIGW_API_ID}\n        APIGW_STAGE_NAME:  ${APIGW_STAGE_NAME}\n        APIGW_STAGE_DESC:  \"${APIGW_STAGE_DESC}\"\n        APIGW_DEPLOY_DESC: \"${APIGW_DEPLOY_DESC}\"\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway create-deployment \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --stage-name ${APIGW_STAGE_NAME} \\\n        --stage-description \"${APIGW_STAGE_DESC}\" \\\n        --description \"${APIGW_DEPLOY_DESC}\"\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n        \"description\": \"Calling Lambda functions blueprint.\",\n        \"id\": \"xxxxxx\",\n        \"createdDate\": 1448115971\n      }\n```\n\n\n\n## 5.2. API\u306e\u30b9\u30c6\u30fc\u30b8\u540d\u306e\u53d6\u5f97\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway get-stages \\\n        --rest-api-id ${APIGW_API_ID}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n        \"item\": [\n          {\n              \"description\": \"This is a prod.\",\n              \"stageName\": \"test\",\n              \"cacheClusterEnabled\": false,\n              \"cacheClusterStatus\": \"NOT_AVAILABLE\",\n              \"deploymentId\": \"xxxxxx\",\n              \"lastUpdatedDate\": 1448115971,\n              \"createdDate\": 1448115971,\n              \"methodSettings\": {}\n          }\n        ]\n      }\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nAPIGW_STAGE_NAME=$( \\\n        aws apigateway get-stages \\\n          --rest-api-id ${APIGW_API_ID} \\\n          --query \"item[?description == \\`${APIGW_STAGE_DESC}\\`].stageName\" \\\n          --output text \\\n) \\\n        && echo ${APIGW_STAGE_NAME}\n```\n\n```text:\u7d50\u679c(\u4f8b):\n\n      prod\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws apigateway get-stage \\\n        --rest-api-id ${APIGW_API_ID} \\\n        --stage-name ${APIGW_STAGE_NAME}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n\n      {\n        \"stageName\": \"prod\",\n        \"description\": \"This is a prod.\",\n        \"cacheClusterEnabled\": false,\n        \"cacheClusterStatus\": \"NOT_AVAILABLE\",\n        \"deploymentId\": \"xxxxxx\",\n        \"lastUpdatedDate\": 1448115971,\n        \"createdDate\": 1448115971,\n        \"methodSettings\": {}\n      }\n```\n\n\n# 6. API\u306e\u30c6\u30b9\u30c8\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nAPIGW_URI=\"https://${APIGW_API_ID}.execute-api.${AWS_DEFAULT_REGION}.amazonaws.com/${APIGW_STAGE_NAME}${APIGW_RESOURCE_PATH}\" \\\n        && echo ${APIGW_URI}\n```\n\n\n# 7. Slack (API Endpoint\u8ffd\u52a0)\n\n1. https://${SLACK_TEAM_NAME}.slack.com/apps \u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002(App Directory \u753b \u9762)\n   * \u691c\u7d22\u7a93\u306b 'Slash Commands' \u3068\u5165\u529b\u3057\u307e\u3059\u3002\n   * 'Slash Commands'\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n2. Browse Apps > Slash Commands (\u753b\u9762)\n   * (\u30dc\u30bf\u30f3)\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n3. Edit configuration (\u753b\u9762)\n   * Integration Settings\n     * URL: API Gateway\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\n\n\n# 8. slack\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\n\nslack\u304b\u3089\u3001/sayhello\u30b3\u30de\u30f3\u30c9\u306b\u7d9a\u3044\u3066\u82f1\u6570\u5b57\u534a\u89d2\u306e\u30c6\u30ad\u30b9\u30c8\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```text::slack:\n/sayhello ec2\n```\n\n\n# \u5b8c\u4e86\n", "tags": ["AWS", "aws-cli", "APIGateway", "lambda"]}