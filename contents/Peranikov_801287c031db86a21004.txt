{"tags": ["Rails", "fluentd", "CloudWatch"], "context": "\u3053\u306e\u8a18\u4e8b\u306fSupership\u682a\u5f0f\u4f1a\u793e Advent Calendar 2016\u306e10\u65e5\u76ee\u306e\u8a18\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002\n\u79c1\u306fSupership\u306e\u6240\u5c5e\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u540c\u3058Syn.\u30db\u30fc\u30eb\u30c7\u30a3\u30f3\u30b0\u30b9\u306e\u30b0\u30eb\u30fc\u30d7\u4f1a\u793e\u3067\u3042\u308b\u682a\u5f0f\u4f1a\u793eSocket\u306e @Peranikov \u3068\u7533\u3057\u307e\u3059\u3002\nSocket\u3067\u306f\u3001\u5f0a\u793e\u306e\u30d7\u30ed\u30c0\u30af\u30c8\u3067\u3042\u308bFlipdesk\u306e\u958b\u767a\u30e1\u30f3\u30d0\u30fc\u3068\u3057\u3066Ruby\u3068Scala\u306b\u53d6\u308a\u7d44\u3093\u3067\u304a\u308a\u307e\u3059\u3002\nFlipdesk\u306fRuby on Rails\u3067\u7a3c\u50cd\u3057\u3066\u304a\u308a\u3001AWS\u4e0a\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u7acb\u3066\u3066\u904b\u55b6\u3057\u3066\u304a\u308a\u307e\u3059\u3002\u5404\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ed\u30b0\u3092\u96c6\u7d04\u3059\u308b\u305f\u3081\u306bfluentd\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u65b9\u306f\u5897\u3048\u3066\u304d\u3066\u3044\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u5f0a\u793e\u3082\u3054\u591a\u5206\u306b\u6f0f\u308c\u305afluentd\u3092\u4f7f\u7528\u3057\u3066\u304a\u308a\u307e\u3059\u3002\u4eca\u56de\u306f\u3001Rails\u306e\u30ed\u30b0\u3092LTSV\u5f62\u5f0f\u3067\u51fa\u529b\u3057\u3001fluentd\u3092\u4f7f\u3063\u3066CloudWatch Logs\u306b\u96c6\u7d04\u3059\u308b\u65b9\u6cd5\u3092\u3054\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\nRails\u306e\u30ed\u30b0\u3092LTSV\u5f62\u5f0f\u3067\u51fa\u529b\u3059\u308b\nRails\u304c\u6a19\u6e96\u3067\u51fa\u529b\u3059\u308bproduction.log\u306a\u3069\u306f\u30de\u30eb\u30c1\u30e9\u30a4\u30f3\u3067\u51fa\u529b\u3055\u308c\u308b\u305f\u3081\u3001\u3053\u306e\u307e\u307e\u3067\u306ffluentd\u3067\u306f\u5c11\u3005\u6271\u3044\u306b\u304f\u3044\u3067\u3059\u3002\u3068\u3044\u3046\u308f\u3051\u3067\u3001rack-ltsv_logger\u3092\u4f7f\u3063\u3066LTSV\u5f62\u5f0f\u306b\u5225\u9014\u30ed\u30b0\u3092\u51fa\u529b\u3057\u3066\u3044\u307e\u3059\u3002\nrack-ltsv_logger#default-fields\u3092\u898b\u308b\u3068\u3053\u306egem\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u51fa\u529b\u3059\u308b\u30d5\u30a3\u30fc\u30eb\u30c9\u304c\u308f\u304b\u308a\u307e\u3059\u304c\u3001\u3053\u308c\u3060\u3051\u3067\u306f\u904b\u7528\u306b\u306f\u4e0d\u5341\u5206\u306a\u306e\u3067\u3055\u3089\u306b\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\n\nproduction.rb\n# rack-ltsv_logger settings\nclass LtsvLogger < ::Logger\n  def write(msg)\n    @logdev.write(msg)\n  end\nend\n\nappends = {\n  vhost: Proc.new { |env| env['HTTP_HOST'] || \"-\" },\n  ua: Proc.new { |env| env['HTTP_USER_AGENT'] || \"-\" },\n  referer: Proc.new { |env| env['HTTP_REFERER'] || \"-\" },\n  db_runtime: Proc.new { |env| env['action_controller.instance'].try(:db_runtime).to_f / 1000.0 }, # ActiveRecord\u306e\u5b9f\u884c\u6642\u9593(msec\u3092sec\u306b\u5408\u308f\u305b\u3066\u3044\u308b)\n  view_runtime: Proc.new { |env| env['action_controller.instance'].try(:view_runtime).to_f / 1000.0 }, # View\u306e\u5b9f\u884c\u6642\u9593(msec\u3092sec\u306b\u5408\u308f\u305b\u3066\u3044\u308b)\n  user_id: Proc.new { |env| env['action_controller.instance'].try(:current_user).try(:id) || \"-\" }, # \u81ea\u524d\u3067Controller\u306b\u5b9a\u7fa9\u3057\u305f\u30e1\u30bd\u30c3\u30c9\n  instance_id: Proc.new { |env| ENV['EC2_INSTANCE_ID'] || \"-\" }, # \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\n}\n\nconfig.middleware.insert_after(0, Rack::LtsvLogger, LtsvLogger.new('log/rack_ltsv.log'), appends)\n\n\nenv \u306b\u306fRack\u306e\u74b0\u5883\u304c\u683c\u7d0d\u3055\u308c\u3066\u304a\u308a\u3001'action_controller.instance'\u30ad\u30fc\u306bRails\u306eController\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u306b\u3088\u308aController\u304c\u6301\u3064Rails\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3067\u304d\u305f\u308a\u3001\u81ea\u524d\u3067\u5b9a\u7fa9\u3057\u305f\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u7528\u3057\u305f\u308a\u3067\u304d\u307e\u3059\u3002(\u3053\u308c\u306b\u3064\u3044\u3066\u306f\u3053\u3061\u3089\u306e\u8a18\u4e8b\u3067\u5225\u9014\u89e3\u8aac\u3057\u3066\u3044\u307e\u3059\u3002)\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\u3082\u542b\u307e\u308c\u3066\u3044\u305f\u307b\u3046\u304c\u4fbf\u5229\u306a\u306e\u3067\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8d77\u52d5\u6642\u306b\u74b0\u5883\u5909\u6570EC2_INSTANCE_ID\u306b\u683c\u7d0d\u3057\u3066\u3044\u308b\u3082\u306e\u3092\u30ed\u30b0\u306b\u3082\u6301\u305f\u305b\u3066\u3044\u307e\u3059\u3002\n\nfluetnd\u306b\u3088\u308bCloudWatch Logs\u3078\u306e\u96c6\u7d04\nfluetnd\u3092\u7528\u3044\u3066\u306eCloudWatch Logs\u3078\u306e\u8ee2\u9001\u306f\u7279\u306b\u7279\u5225\u306a\u3053\u3068\u306f\u3057\u3066\u304a\u3089\u305a\u3001input plugin\u306ftail\u3067ltsv\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u3057\u3001output plugin\u306ffluent-plugin-cloudwatch-logs\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u631f\u3080\u3053\u3068\u3067\u3001CloudWatch Logs\u4e0a\u3067\u306fJSON\u5f62\u5f0f\u3067\u8a18\u9332\u3055\u308c\u307e\u3059\u3002\n\nCloudWatch Logs\u4e0a\u3067\u306e\u5206\u6790\nCloudWatch Logs\u306b\u306f\u30ed\u30b0\u3092\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3059\u308b\u305f\u3081\u306e\u30d1\u30bf\u30fc\u30f3\u69cb\u6587\u304c\u3042\u308a\u3001JSON\u3067\u8a18\u9332\u3055\u308c\u305f\u30ed\u30b0\u306b\u5bfe\u3057\u3066\u67d4\u8edf\u306b\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u3053\u306e\u3088\u3046\u306a\u5f62\u5f0f\u3067\u30ed\u30b0\u304c\u8a18\u9332\u3055\u308c\u3066\u3044\u308b\u3068\u3057\u3066\u3001\n\u203b\u5b9f\u969b\u306e\u30ed\u30b0\u304b\u3089\u4e00\u90e8\u7701\u7565\u3057\u3066\u3044\u307e\u3059\n{\n    \"pid\": 3563,\n    \"method\": \"GET\",\n    \"status\": 200,\n    \"reqtime\": 1.327199,\n    \"db_runtime\": 0.046870868999999996,\n    \"view_runtime\": 0.01331332,\n    \"instance_id\": \"i-58a952d6\",\n    \"time\": \"2016-12-07T12:01:48+09:00\"\n}\n\nActiveRecord\u306e\u5b9f\u884c\u6642\u9593\u306b5\u79d2\u4ee5\u4e0a\u304b\u304b\u3063\u305f\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u63a2\u3057\u305f\u3044\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u3051\u3070\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3067\u304d\u307e\u3059\u3002\n{ $.db_runtime >= 5 }\n\nCloudWatch Logs\u3067\u306f\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u4f5c\u6210\u3057\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u4f5c\u308b\u3053\u3068\u3082\u53ef\u80fd\u306a\u306e\u3067\u3001\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3068\u4f75\u7528\u3057\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u9045\u3044\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30b0\u30e9\u30d5\u3092\u8868\u793a\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\u307e\u305f\u3001CloudWatch Logs\u5358\u4f53\u3067\u306f\u30ed\u30b0\u306e\u96c6\u8a08\u306f\u884c\u306a\u3048\u307e\u305b\u3093\u304c\u3001Amazon Elasticsearch\u3068\u9023\u643a\u3055\u305b\u305f\u308a\u3001S3\u306b\u30ed\u30b0\u3092\u51fa\u529b\u3057\u3066\u304a\u3044\u3066\u3001\u6700\u8fd1\u767a\u8868\u3055\u308c\u305fAmazon Athena\u3092\u4f7f\u3063\u3066\u96c6\u8a08\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u304b\u3082\u77e5\u308c\u307e\u305b\u3093 :)\n\n\u6700\u5f8c\u306b\nRails\u306e\u30ed\u30b0\u3092LTSV\u5f62\u5f0f\u3067\u51fa\u529b\u3057\u3001fluentd\u3067CloudWatch Logs\u306b\u96c6\u7d04\u3059\u308b\u65b9\u6cd5\u3092\u3054\u7d39\u4ecb\u3057\u307e\u3057\u305f\u3002CloudWatch Logs\u306e\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3068\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u610f\u5916\u3068\u4f7f\u3048\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u3001\u3068\u308a\u3042\u3048\u305a\u30ed\u30b0\u3092\u653e\u308a\u8fbc\u3093\u3067\u304a\u3051\u3070\u3001\u3044\u3056\u3068\u3044\u3046\u6642\u306e\u5206\u6790\u306b\u4f7f\u3048\u308b\u304b\u3082\u77e5\u308c\u307e\u305b\u3093\u3002\n\u660e\u65e5\u306f @hiirokato \u3055\u3093\u3067\u3059\u3002\u3088\u308d\u3057\u304f\u304a\u9858\u3044\u3057\u307e\u3059!\n\u3053\u306e\u8a18\u4e8b\u306fSupership\u682a\u5f0f\u4f1a\u793e Advent Calendar 2016\u306e10\u65e5\u76ee\u306e\u8a18\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u79c1\u306fSupership\u306e\u6240\u5c5e\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u540c\u3058Syn.\u30db\u30fc\u30eb\u30c7\u30a3\u30f3\u30b0\u30b9\u306e\u30b0\u30eb\u30fc\u30d7\u4f1a\u793e\u3067\u3042\u308b[\u682a\u5f0f\u4f1a\u793eSocket](http://socket.co.jp/)\u306e @Peranikov \u3068\u7533\u3057\u307e\u3059\u3002\nSocket\u3067\u306f\u3001\u5f0a\u793e\u306e\u30d7\u30ed\u30c0\u30af\u30c8\u3067\u3042\u308b[Flipdesk](https://flipdesk.jp/)\u306e\u958b\u767a\u30e1\u30f3\u30d0\u30fc\u3068\u3057\u3066Ruby\u3068Scala\u306b\u53d6\u308a\u7d44\u3093\u3067\u304a\u308a\u307e\u3059\u3002\n\nFlipdesk\u306fRuby on Rails\u3067\u7a3c\u50cd\u3057\u3066\u304a\u308a\u3001AWS\u4e0a\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u7acb\u3066\u3066\u904b\u55b6\u3057\u3066\u304a\u308a\u307e\u3059\u3002\u5404\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ed\u30b0\u3092\u96c6\u7d04\u3059\u308b\u305f\u3081\u306bfluentd\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u65b9\u306f\u5897\u3048\u3066\u304d\u3066\u3044\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u5f0a\u793e\u3082\u3054\u591a\u5206\u306b\u6f0f\u308c\u305afluentd\u3092\u4f7f\u7528\u3057\u3066\u304a\u308a\u307e\u3059\u3002\u4eca\u56de\u306f\u3001Rails\u306e\u30ed\u30b0\u3092LTSV\u5f62\u5f0f\u3067\u51fa\u529b\u3057\u3001fluentd\u3092\u4f7f\u3063\u3066CloudWatch Logs\u306b\u96c6\u7d04\u3059\u308b\u65b9\u6cd5\u3092\u3054\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n# Rails\u306e\u30ed\u30b0\u3092LTSV\u5f62\u5f0f\u3067\u51fa\u529b\u3059\u308b\n\nRails\u304c\u6a19\u6e96\u3067\u51fa\u529b\u3059\u308bproduction.log\u306a\u3069\u306f\u30de\u30eb\u30c1\u30e9\u30a4\u30f3\u3067\u51fa\u529b\u3055\u308c\u308b\u305f\u3081\u3001\u3053\u306e\u307e\u307e\u3067\u306ffluentd\u3067\u306f\u5c11\u3005\u6271\u3044\u306b\u304f\u3044\u3067\u3059\u3002\u3068\u3044\u3046\u308f\u3051\u3067\u3001[rack-ltsv_logger](https://github.com/sonots/rack-ltsv_logger)\u3092\u4f7f\u3063\u3066LTSV\u5f62\u5f0f\u306b\u5225\u9014\u30ed\u30b0\u3092\u51fa\u529b\u3057\u3066\u3044\u307e\u3059\u3002\n\n[rack-ltsv_logger#default-fields](https://github.com/sonots/rack-ltsv_logger#default-fields)\u3092\u898b\u308b\u3068\u3053\u306egem\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u51fa\u529b\u3059\u308b\u30d5\u30a3\u30fc\u30eb\u30c9\u304c\u308f\u304b\u308a\u307e\u3059\u304c\u3001\u3053\u308c\u3060\u3051\u3067\u306f\u904b\u7528\u306b\u306f\u4e0d\u5341\u5206\u306a\u306e\u3067\u3055\u3089\u306b\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\n\n```rb:production.rb\n# rack-ltsv_logger settings\nclass LtsvLogger < ::Logger\n  def write(msg)\n    @logdev.write(msg)\n  end\nend\n\nappends = {\n  vhost: Proc.new { |env| env['HTTP_HOST'] || \"-\" },\n  ua: Proc.new { |env| env['HTTP_USER_AGENT'] || \"-\" },\n  referer: Proc.new { |env| env['HTTP_REFERER'] || \"-\" },\n  db_runtime: Proc.new { |env| env['action_controller.instance'].try(:db_runtime).to_f / 1000.0 }, # ActiveRecord\u306e\u5b9f\u884c\u6642\u9593(msec\u3092sec\u306b\u5408\u308f\u305b\u3066\u3044\u308b)\n  view_runtime: Proc.new { |env| env['action_controller.instance'].try(:view_runtime).to_f / 1000.0 }, # View\u306e\u5b9f\u884c\u6642\u9593(msec\u3092sec\u306b\u5408\u308f\u305b\u3066\u3044\u308b)\n  user_id: Proc.new { |env| env['action_controller.instance'].try(:current_user).try(:id) || \"-\" }, # \u81ea\u524d\u3067Controller\u306b\u5b9a\u7fa9\u3057\u305f\u30e1\u30bd\u30c3\u30c9\n  instance_id: Proc.new { |env| ENV['EC2_INSTANCE_ID'] || \"-\" }, # \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\n}\n\nconfig.middleware.insert_after(0, Rack::LtsvLogger, LtsvLogger.new('log/rack_ltsv.log'), appends)\n```\n\n`env` \u306b\u306fRack\u306e\u74b0\u5883\u304c\u683c\u7d0d\u3055\u308c\u3066\u304a\u308a\u3001`'action_controller.instance'`\u30ad\u30fc\u306bRails\u306eController\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u306b\u3088\u308aController\u304c\u6301\u3064Rails\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3067\u304d\u305f\u308a\u3001\u81ea\u524d\u3067\u5b9a\u7fa9\u3057\u305f\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u7528\u3057\u305f\u308a\u3067\u304d\u307e\u3059\u3002(\u3053\u308c\u306b\u3064\u3044\u3066\u306f[\u3053\u3061\u3089](http://qiita.com/Peranikov/items/fcf9e0f7fcb726e28b6b)\u306e\u8a18\u4e8b\u3067\u5225\u9014\u89e3\u8aac\u3057\u3066\u3044\u307e\u3059\u3002)\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\u3082\u542b\u307e\u308c\u3066\u3044\u305f\u307b\u3046\u304c\u4fbf\u5229\u306a\u306e\u3067\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8d77\u52d5\u6642\u306b\u74b0\u5883\u5909\u6570`EC2_INSTANCE_ID`\u306b\u683c\u7d0d\u3057\u3066\u3044\u308b\u3082\u306e\u3092\u30ed\u30b0\u306b\u3082\u6301\u305f\u305b\u3066\u3044\u307e\u3059\u3002\n\n# fluetnd\u306b\u3088\u308bCloudWatch Logs\u3078\u306e\u96c6\u7d04\n\nfluetnd\u3092\u7528\u3044\u3066\u306eCloudWatch Logs\u3078\u306e\u8ee2\u9001\u306f\u7279\u306b\u7279\u5225\u306a\u3053\u3068\u306f\u3057\u3066\u304a\u3089\u305a\u3001input plugin\u306f[tail](http://docs.fluentd.org/articles/in_tail)\u3067ltsv\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u3057\u3001output plugin\u306f[fluent-plugin-cloudwatch-logs](https://github.com/ryotarai/fluent-plugin-cloudwatch-logs)\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u631f\u3080\u3053\u3068\u3067\u3001CloudWatch Logs\u4e0a\u3067\u306fJSON\u5f62\u5f0f\u3067\u8a18\u9332\u3055\u308c\u307e\u3059\u3002\n\n# CloudWatch Logs\u4e0a\u3067\u306e\u5206\u6790\n\nCloudWatch Logs\u306b\u306f\u30ed\u30b0\u3092\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3059\u308b\u305f\u3081\u306e[\u30d1\u30bf\u30fc\u30f3\u69cb\u6587](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html#d0e4083)\u304c\u3042\u308a\u3001JSON\u3067\u8a18\u9332\u3055\u308c\u305f\u30ed\u30b0\u306b\u5bfe\u3057\u3066\u67d4\u8edf\u306b\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u4f8b\u3048\u3070\u3053\u306e\u3088\u3046\u306a\u5f62\u5f0f\u3067\u30ed\u30b0\u304c\u8a18\u9332\u3055\u308c\u3066\u3044\u308b\u3068\u3057\u3066\u3001\n\u203b\u5b9f\u969b\u306e\u30ed\u30b0\u304b\u3089\u4e00\u90e8\u7701\u7565\u3057\u3066\u3044\u307e\u3059\n\n```json\n{\n    \"pid\": 3563,\n    \"method\": \"GET\",\n    \"status\": 200,\n    \"reqtime\": 1.327199,\n    \"db_runtime\": 0.046870868999999996,\n    \"view_runtime\": 0.01331332,\n    \"instance_id\": \"i-58a952d6\",\n    \"time\": \"2016-12-07T12:01:48+09:00\"\n}\n```\n\nActiveRecord\u306e\u5b9f\u884c\u6642\u9593\u306b5\u79d2\u4ee5\u4e0a\u304b\u304b\u3063\u305f\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u63a2\u3057\u305f\u3044\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u3051\u3070\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3067\u304d\u307e\u3059\u3002\n\n```\n{ $.db_runtime >= 5 }\n```\n\nCloudWatch Logs\u3067\u306f[\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u4f5c\u6210](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/MonitoringPolicyExamples.html)\u3057\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u4f5c\u308b\u3053\u3068\u3082\u53ef\u80fd\u306a\u306e\u3067\u3001\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3068\u4f75\u7528\u3057\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u9045\u3044\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30b0\u30e9\u30d5\u3092\u8868\u793a\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\n\u307e\u305f\u3001CloudWatch Logs\u5358\u4f53\u3067\u306f\u30ed\u30b0\u306e\u96c6\u8a08\u306f\u884c\u306a\u3048\u307e\u305b\u3093\u304c\u3001[Amazon Elasticsearch](https://aws.amazon.com/jp/elasticsearch-service/)\u3068\u9023\u643a\u3055\u305b\u305f\u308a\u3001S3\u306b\u30ed\u30b0\u3092\u51fa\u529b\u3057\u3066\u304a\u3044\u3066\u3001\u6700\u8fd1\u767a\u8868\u3055\u308c\u305fAmazon Athena\u3092\u4f7f\u3063\u3066\u96c6\u8a08\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u304b\u3082\u77e5\u308c\u307e\u305b\u3093 :)\n\n# \u6700\u5f8c\u306b\n\nRails\u306e\u30ed\u30b0\u3092LTSV\u5f62\u5f0f\u3067\u51fa\u529b\u3057\u3001fluentd\u3067CloudWatch Logs\u306b\u96c6\u7d04\u3059\u308b\u65b9\u6cd5\u3092\u3054\u7d39\u4ecb\u3057\u307e\u3057\u305f\u3002CloudWatch Logs\u306e\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3068\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u610f\u5916\u3068\u4f7f\u3048\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u3001\u3068\u308a\u3042\u3048\u305a\u30ed\u30b0\u3092\u653e\u308a\u8fbc\u3093\u3067\u304a\u3051\u3070\u3001\u3044\u3056\u3068\u3044\u3046\u6642\u306e\u5206\u6790\u306b\u4f7f\u3048\u308b\u304b\u3082\u77e5\u308c\u307e\u305b\u3093\u3002\n\n\u660e\u65e5\u306f @hiirokato \u3055\u3093\u3067\u3059\u3002\u3088\u308d\u3057\u304f\u304a\u9858\u3044\u3057\u307e\u3059!\n"}