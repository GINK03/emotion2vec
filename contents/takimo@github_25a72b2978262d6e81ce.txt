{"tags": ["GoogleAppsScript", "hipchat"], "context": " More than 1 year has passed since last update.HipChat\u306b\u65e5\u3005\u306e\u58f2\u4e0a\u30ec\u30dd\u30fc\u30c8\u3092\u901a\u77e5\u3055\u305b\u305f\u3044\u3067\u3059\u3088\u306d\u3002\n\u4eca\u56de\u306fGoogleAppScript\u3068Hipchat\u306eAPI\u3092\u5229\u7528\u3057\u3066\u5b9f\u73fe\u3057\u3066\u307f\u307e\u3059\u3002\n\nHipChat\u306eAdmin API token\u3092\u53d6\u5f97\u3059\u308b\nAdmin API Key\n\nGoogleAppsScript\u3067AdSense\u306e\u58f2\u4e0a\u3092\u96c6\u8a08\u3059\u308b\nfunction addFigure(str) {\n  var num = new String(str).replace(/,/g, \"\");\n  while(num != (num = num.replace(/^(-?\\d+)(\\d{3})/, \"$1,$2\")));\n  return num;\n}\n\n/*\n * @example\n * generateReport('2014-01-01')\n */\nfunction generateReport(date){\n  var startDate = date;\n  var endDate = date;\n\n  var args = {\n    'metric': ['AD_REQUESTS', 'AD_REQUESTS_CTR', 'COST_PER_CLICK', 'AD_REQUESTS_RPM', 'EARNINGS', 'CLICKS'],\n    'dimension': ['DATE'],\n    'useTimezoneReporting': true\n  };\n  var rows = AdSense.Reports.generate(startDate, endDate, args).getRows();\n  var row = rows[0];\n\n  var message = [\n    row[0],\n    '\u53ce\u76ca: \u00a5' + addFigure(row[5]),\n    '\u5e83\u544a\u30ea\u30af\u30a8\u30b9\u30c8: ' +  addFigure(row[1]),\n    '\u5e83\u544a\u30ea\u30af\u30a8\u30b9\u30c8CTR: ' + parseFloat(row[2]) * 100 + '%',\n    'CPC: \u00a5' + addFigure(row[3]),\n    '\u5e83\u544a\u30ea\u30af\u30a8\u30b9\u30c8RPM: \u00a5' + addFigure(row[4])\n  ].join(\"<br>\");\n\n  sayMessage(message);\n}\n\n\n\u96c6\u8a08\u7d50\u679c\u3092HipChatAPI\u3067\u901a\u77e5\u3059\u308b\nRooms API\u306e\u4ed5\u69d8\nvar authToken = \"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\";\n\nfunction getRequestURL(){\n  var url = \"http://api.hipchat.com/v1/rooms/message\";\n  return url + '?auth_token=' + authToken;\n}\n\nfunction sayMessage(message) {\n  var options = {\n    \"contentType\" : \"application/x-www-form-urlencoded\",\n    \"method\": \"post\",\n    \"payload\": {\n      \"room_id\": XXXXXX, // Found in the hipchat.com MyAccount > Rooms > API ID\n      \"from\": 'AdSense',\n      \"notify\": 0,\n      \"message\": message ? message : \"\",  \n      \"color\": 'green',\n      \"message_format\": 'html'\n    },\n    //\"muteHttpExceptions\": true\n  };\n\n  var responseString = UrlFetchApp.fetch(getRequestURL(), options).getContentText();\n  Logger.log(responseString);\n}\n\n\n\u51fa\u6765\u4e0a\u304c\u308a\n\nHipChat\u306b\u65e5\u3005\u306e\u58f2\u4e0a\u30ec\u30dd\u30fc\u30c8\u3092\u901a\u77e5\u3055\u305b\u305f\u3044\u3067\u3059\u3088\u306d\u3002\n\u4eca\u56de\u306fGoogleAppScript\u3068Hipchat\u306eAPI\u3092\u5229\u7528\u3057\u3066\u5b9f\u73fe\u3057\u3066\u307f\u307e\u3059\u3002\n\n# HipChat\u306eAdmin API token\u3092\u53d6\u5f97\u3059\u308b\n\n[Admin API Key](https://www.hipchat.com/admin/api)\n\n# GoogleAppsScript\u3067AdSense\u306e\u58f2\u4e0a\u3092\u96c6\u8a08\u3059\u308b\n\n```js\nfunction addFigure(str) {\n  var num = new String(str).replace(/,/g, \"\");\n  while(num != (num = num.replace(/^(-?\\d+)(\\d{3})/, \"$1,$2\")));\n  return num;\n}\n\n/*\n * @example\n * generateReport('2014-01-01')\n */\nfunction generateReport(date){\n  var startDate = date;\n  var endDate = date;\n\n  var args = {\n    'metric': ['AD_REQUESTS', 'AD_REQUESTS_CTR', 'COST_PER_CLICK', 'AD_REQUESTS_RPM', 'EARNINGS', 'CLICKS'],\n    'dimension': ['DATE'],\n    'useTimezoneReporting': true\n  };\n  var rows = AdSense.Reports.generate(startDate, endDate, args).getRows();\n  var row = rows[0];\n\n  var message = [\n    row[0],\n    '\u53ce\u76ca: \u00a5' + addFigure(row[5]),\n    '\u5e83\u544a\u30ea\u30af\u30a8\u30b9\u30c8: ' +  addFigure(row[1]),\n    '\u5e83\u544a\u30ea\u30af\u30a8\u30b9\u30c8CTR: ' + parseFloat(row[2]) * 100 + '%',\n    'CPC: \u00a5' + addFigure(row[3]),\n    '\u5e83\u544a\u30ea\u30af\u30a8\u30b9\u30c8RPM: \u00a5' + addFigure(row[4])\n  ].join(\"<br>\");\n\n  sayMessage(message);\n}\n```\n\n# \u96c6\u8a08\u7d50\u679c\u3092HipChatAPI\u3067\u901a\u77e5\u3059\u308b\n\n[Rooms API\u306e\u4ed5\u69d8](https://www.hipchat.com/docs/api/method/rooms/message)\n\n```js\nvar authToken = \"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\";\n\nfunction getRequestURL(){\n  var url = \"http://api.hipchat.com/v1/rooms/message\";\n  return url + '?auth_token=' + authToken;\n}\n\nfunction sayMessage(message) {\n  var options = {\n    \"contentType\" : \"application/x-www-form-urlencoded\",\n    \"method\": \"post\",\n    \"payload\": {\n      \"room_id\": XXXXXX, // Found in the hipchat.com MyAccount > Rooms > API ID\n      \"from\": 'AdSense',\n      \"notify\": 0,\n      \"message\": message ? message : \"\",  \n      \"color\": 'green',\n      \"message_format\": 'html'\n    },\n    //\"muteHttpExceptions\": true\n  };\n\n  var responseString = UrlFetchApp.fetch(getRequestURL(), options).getContentText();\n  Logger.log(responseString);\n}\n```\n\n# \u51fa\u6765\u4e0a\u304c\u308a\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2014-02-20 20.43.15.png](https://qiita-image-store.s3.amazonaws.com/0/19548/91dec90b-69a3-f7de-592f-41fcfecfc23d.png)\n"}