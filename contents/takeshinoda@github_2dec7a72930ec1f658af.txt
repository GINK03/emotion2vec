{"tags": ["jq", "JSON", "aws-cli", "AWS"], "context": "\n\njq \u30b3\u30de\u30f3\u30c9\u3068\u306f\nhttp://stedolan.github.io/jq/\nJSON\u304b\u3089\u7c21\u5358\u306b\u5024\u3092\u629c\u304d\u51fa\u3057\u305f\u308a\u3001\u96c6\u8a08\u3057\u305f\u308a\u3001\u6574\u5f62\u3057\u3066\u8868\u793a\u3057\u305f\u308a\u3067\u304d\u308bJSON\u7528\u306egrep\u3068\u304bawk\u307f\u305f\u3044\u306a\u30b3\u30de\u30f3\u30c9\u3067\u3059\u3002\nWeb\u30b5\u30fc\u30d3\u30b9\u304cJSON\u3092\u5410\u3044\u305f\u308a\u3001AWS CLI\u304c JSON \u3092\u5410\u3044\u305f\u308a\u3059\u308b\u73fe\u4ee3\u793e\u4f1a\u3067\u5927\u5909\u4fbf\u5229\u306a\u30b3\u30de\u30f3\u30c9\u3067\u3059\u3002\n\n\u30de\u30cb\u30e5\u30a2\u30eb\n\u3060\u3044\u305f\u3044\u3053\u3053\u8aad\u3081\u3070OK.\nhttp://stedolan.github.io/jq/manual/\n\u3042\u3001\u3053\u308c\u3067\u3001\u7d42\u308f\u3063\u3066\u3057\u307e\u3046\u3002\u3060\u3051\u3069\u6c17\u306b\u305b\u305a\u9032\u3081\u307e\u3059\u3002\n\n\u7c21\u5358\u306a\u4f8b\n\u307e\u305a\u3001\u7a7a\u6c17\u3092\u3064\u304b\u307f\u307e\u3057\u3087\u3046\u3002\n\u4ee5\u4e0bjq\u30b3\u30de\u30f3\u30c9\u306e\u8a18\u6cd5\u3092\u898b\u3066\u3044\u304d\u307e\u3059\u3002JSON { \"hoge\": \"velue\" } \u304c\u3042\u3063\u305f\u5834\u5408\u3001 . \u304c\u30eb\u30fc\u30c8 {} \u3092\u8868\u3057\u307e\u3059\u3002.hoge \u3067 \"value\" \u3092\u8868\u73fe\u3057\u307e\u3059\u3002\u3060\u3044\u305f\u3044\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n\u30b5\u30f3\u30d7\u30eb de-ta\n\n\u305f\u3060\u306e\u6574\u5f62\n$ echo '{\"items\":[{\"item_id\":1,\"name\":\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\"price\":2500},{\"item_id\":2,\"name\":\"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\"price\":4500}]}' \\\n| jq .\n{\n  \"items\": [\n    {\n      \"item_id\": 1,\n      \"name\": \"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\n      \"price\": 2500\n    },\n    {\n      \"item_id\": 2,\n      \"name\": \"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\n      \"price\": 4500\n    }\n  ]\n}\n\n\u3057\u3070\u3089\u304f\u2191\u306eJSON\u3092\u4f8b\u306b\u9032\u3081\u307e\u3059\u3002items\u306b\u306f\u914d\u5217\u304c\u3076\u3089\u4e0b\u304c\u308a\u3001\u305d\u306e\u4e0b\u306b\u306f\u4e8c\u3064\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u683c\u7d0d\u3055\u308c\u3066\u307e\u3059\u3002\n\n\u5024\u306e\u5217\u6319\n$ echo '{\"items\":[{\"item_id\":1,\"name\":\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\"price\":2500},{\"item_id\":2,\"name\":\"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\"price\":4500}]}' \\\n| jq '.items[].name'\n\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\"\n\"\u683c\u597d\u3044\u3044\u7f6e\u7269\"\n\n\n\u30c0\u30d6\u30eb\u30af\u30a9\u30fc\u30c8\u304c\u90aa\u9b54\n\u5225\u306e\u30b3\u30de\u30f3\u30c9\u306b\u6d41\u3059\u3068\u304d\u306f\u30c0\u30d6\u30eb\u30af\u30a9\u30fc\u30c8\u304c\u90aa\u9b54\u3067\u3059\u306d\u3002-r \u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u6d88\u3048\u307e\u3059\u3002\n$ echo '{\"items\":[{\"item_id\":1,\"name\":\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\"price\":2500},{\"item_id\":2,\"name\":\"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\"price\":4500}]}' \\\n| jq -r '.items[].name'\n\u3059\u3066\u304d\u306a\u96d1\u8ca8\n\u683c\u597d\u3044\u3044\u7f6e\u7269\n\n\n\u30d5\u30a3\u30eb\u30bf(\u30d1\u30a4\u30d7)\nshell \u306e\u30d1\u30a4\u30d7\u307f\u305f\u3044\u306a\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\u2191\u3068\u540c\u3058\u4e8b\u3092\u30d5\u30a3\u30eb\u30bf\u3067\u3002\u2193\u306e\u4f8b\u306f\u3001.items[]\u3092\u30d5\u30a3\u30eb\u30bf\u306b\u6e21\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u8981\u7d20\u6bce\u306b\u6b21\u306e\u51e6\u7406\u304c\u9069\u7528\u3055\u308c\u307e\u3059\u3002\u3082\u3057\u3001.items\u3068\u3059\u308b\u3068\u3001\u8981\u7d20\u6bce\u3067\u306f\u7121\u304f\u3001\u914d\u5217\u307e\u308b\u3054\u3068\u6b21\u306e\u30d5\u30a3\u30eb\u30bf\u306b\u6e21\u3055\u308c\u307e\u3059\u3002\n $ echo '{\"items\":[{\"item_id\":1,\"name\":\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\"price\":2500},{\"item_id\":2,\"name\":\"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\"price\":4500}]}' \\\n | jq -r '.items[] | .name'\n\u3059\u3066\u304d\u306a\u96d1\u8ca8\n\u683c\u597d\u3044\u3044\u7f6e\u7269\n\n\n\u96c6\u8a08\n$ echo '{\"items\":[{\"item_id\":1,\"name\":\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\"price\":2500},{\"item_id\":2,\"name\":\"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\"price\":4500}]}' \\\n| jq '[.items[].price] | add'\n7000\n\n\n\u30d5\u30a3\u30eb\u30bf\u3092\u901a\u3058\u3066\u518d\u6574\u5f62\n$ echo '{\"items\":[{\"item_id\":1,\"name\":\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\"price\":2500},{\"item_id\":2,\"name\":\"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\"price\":4500}]}' \\\n| jq '.items[] | { name: .name, yen: .price }'\n{\n  \"name\": \"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\n  \"yen\": 2500\n}\n{\n  \"name\": \"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\n  \"yen\": 4500\n}\n\n\nmap\n$ echo '{\"items\":[{\"item_id\":1,\"name\":\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\"price\":2500},{\"item_id\":2,\"name\":\"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\"price\":4500}]}' \\\n| jq '.items | map({ name: .name, yen: .price })'\n[\n  {\n    \"name\": \"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\n    \"yen\": 2500\n  },\n  {\n    \"name\": \"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\n    \"yen\": 4500\n  }\n]\n\n\nreduce\n$ echo '{\"items\":[{\"item_id\":1,\"name\":\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\"price\":2500},{\"item_id\":2,\"name\":\"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\"price\":4500}]}' \\\n| jq 'reduce .items[] as $item (0; . + $item.price)'\n7000\n\n\njq \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3046\u5834\u9762\u3067\u306e\u3061\u3087\u3063\u3068\u3057\u305f\u3053\u3068\n\n\u30ab\u30f3\u30de\u306f\u533a\u5207\u308a\u6587\u5b57\u3058\u3083\u7121\u304f\u3066\u3001\u30d5\u30a3\u30eb\u30bf\u306e\u5165\u529b\u3092\u5206\u3051\u308b\n\u30ab\u30f3\u30de\u306f\u914d\u5217\u3084\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u8981\u7d20\u3092\u533a\u5207\u308b\u3082\u306e\u3068\u3057\u3066\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u306f\u7121\u304f\u3001\u30d5\u30a3\u30eb\u30bf\u306e\u5165\u529b\u51e6\u7406\u3092\u5206\u3051\u308b\u610f\u5473\u3067\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n$ echo '{\"key1\": \"val1\", \"key2\": \"val2\"}' \\\n| jq '[.key1, .key2]'\n[\n  \"val1\",\n  \"val2\"\n]\n\n\u306a\u306e\u3067\u3001\u62ec\u5f27\u3067\u304f\u304f\u308c\u3070\u5165\u529b\u3092\u6b21\u3005\u3068\u518d\u6574\u5f62\u3057\u3066\u3044\u304f\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n$ echo '{\"key1\": \"val1\", \"key2\": \"val2\"}' \\\n| jq '[.key1, (keys | map(.))]'\n[\n  \"val1\",\n  [\n    \"key1\",\n    \"key2\"\n  ]\n]\n\n\u3053\u308c\u3092\u7406\u89e3\u3067\u304d\u308c\u3070\u7d50\u69cb\u8272\u3005\u904a\u3079\u308b\u306e\u3067\u3001\u662f\u975e\u77e5\u3063\u3066\u304a\u3044\u3066\u3044\u305f\u3060\u3051\u308c\u3070\u3068\u601d\u3044\u307e\u3059\u3002\n\nKey/Value\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u5909\u63db\u3059\u308b\n\nfrom_entries\nAWS\u30ea\u30bd\u30fc\u30b9\u3092\u64cd\u4f5c\u7ba1\u7406\u51fa\u6765\u308b\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30c4\u30fc\u30eb\"AWS CLI\"\u3067\u306f\u3001\u30ea\u30bd\u30fc\u30b9\u306b\u4ed8\u3051\u3089\u308c\u305f\u30bf\u30b0\u3092[{\"Key\": \"tagkey\", \"Value\": \"value\"},{\"Key\": \"tagkey2\", \"Value\": \"value\uff12\"}]\u306e\u3088\u3046\u306a\u5f62\u5f0f\u3067\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3053\u308c\u3092\u5225\u30b3\u30de\u30f3\u30c9\u306b\u6d41\u3059\u3068\u304b\u3001\u30ea\u30bd\u30fc\u30b9\u5358\u4f4d\u3067\u30bf\u30b0\u3092\u5143\u306b\u30bd\u30fc\u30c8\u3059\u308b\u3068\u304bgroup by\u3057\u305f\u3044\u306e\u3067\u3001{\"tagkey\": \"tagkey\", \"tagkey2\": \"value\uff12\"}\u306e\u3088\u3046\u306a\u4e00\u3064\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5f62\u5f0f\u306b\u3057\u305f\u3044\u3068\u304d\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u3053\u3046\u3044\u3046\u5834\u5408\u306b\u306fjq\u306b\u306ffrom_entries\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n$ echo '[{\"Key\": \"tagkey\", \"Value\": \"value\"},{\"Key\": \"tagkey2\", \"Value\": \"value\uff12\"}]' \\\n| jq 'from_entries'\n{\n  \"tagkey\": \"value\",\n  \"tagkey2\": \"value\uff12\"\n}\n\n\n\u305d\u308c\u3063\u307d\u3044\u6d3b\u7528\u4e8b\u4f8b\n\u306a\u3093\u3068\u306a\u304f\u3001\u5206\u304b\u3063\u3066\u304d\u305f\u3067\u3057\u3087\u3046\u3002\u3053\u3053\u304b\u3089\u306f\u30cd\u30c3\u30c8\u3092\u4f7f\u3063\u305f\u305d\u308c\u3063\u307d\u3044\u4f8b\u3092\u51fa\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u3042\u308b\u4eba\u306egithub\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u5217\u6319\u3059\u308b\ngithub\u306eAPI\u3067\u53d6\u308c\u308b\u30a2\u30ab\u30a6\u30f3\u30c8\u60c5\u5831\u306b\u306f\u3001\u30ea\u30dd\u30b8\u30c8\u30ea\u4e00\u89a7\u3092\u898b\u308b\u305f\u3081\u306eURL\u304c\u683c\u7d0d\u3055\u308c\u3066\u308b\u306e\u3067\u30012\u56de\u30af\u30a8\u30ea\u3092\u6295\u3052\u308c\u3070\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\u3048\u3044\u3048\u3044\u3002\n$ curl -s `curl -s https://api.github.com/users/takeshinoda | jq -r .repos_url` \\\n | jq '.[].name'\n\"avr-test\"\n\"doctree\"\n\"HogeApp\"\n\"rubykaigi\"\n\"sprk2012-cflt\"\n\"thinreports-handler\"\n\"thinreports-rails\"\n\n\n\u6771\u4eac\u306e\u6c17\u6e29\u306e\u5c65\u6b74\n\u5bd2\u304f\u306a\u3063\u3066\u304d\u307e\u3057\u305f\u306e\u3067\u3001CSV\u306b\u6c17\u6e29\u306e\u5c65\u6b74\u3092\u51fa\u3057\u307e\u3059\u3002Openweathermap\u3068\u3044\u3046\u4e16\u754c\u4e2d\u306e\u90fd\u5e02\u306e\u6c17\u8c61\u60c5\u5831\u3092API\u3067\u63d0\u4f9b\u3057\u3066\u3044\u308b\u30b5\u30fc\u30d3\u30b9\u304c\u3042\u308b\u306e\u3067\u305d\u308c\u3092\u5229\u7528\u3057\u3066\u307f\u307e\u3059\u3002\n\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306f\u3001{ ..., list: [...] }\u307f\u305f\u3044\u306a\u611f\u3058\u3067\u3001list\u30a2\u30c8\u30ea\u30d3\u30e5\u30fc\u30c8\u4ee5\u4e0b\u306b\u305d\u308c\u3063\u307d\u3044\u30c7\u30fc\u30bf\u304c\u683c\u7d0d\u3055\u308c\u3066\u307e\u3059\u3002\n$ curl -s 'http://api.openweathermap.org/data/2.5/history/city?id=1850147&type=hour' \\\n| jq -r '.list[] | [.dt, .main.temp_min, .main.temp_max] | @csv'\n1418348513,281.15,284.15\n1418350162,281.15,284.15\n1418352118,281.15,284.15\n1418355724,281.15,284.15\n1418359309,281.15,283.15\n1418361358,282.15,283.15\n1418362930,282.15,283.15\n1418367148,282.15,283.15\n\n\u8aad\u3081\u306a\u3044\u3067\u3059\u306d\u3002\u5de6\u304b\u3089unixtime(UTC), \u6700\u4f4e\u6c17\u6e29(\u30b1\u30eb\u30d3\u30f3), \u6700\u9ad8\u6c17\u6e29(\u30b1\u30eb\u30d3\u30f3)\u3067\u3059\u3002\u9069\u5b9cawk\u3068\u304b\u306b\u55b0\u308f\u305b\u3066\u5909\u63db\u3059\u308c\u3070\u5927\u4e08\u592b\u3067\u3059\u3002\u3046\u3093\u3002\u3061\u306a\u307f\u306b1418380960\u306f2014\u5e74 12\u670812\u65e5 \u91d1\u66dc\u65e5 19\u664242\u520640\u79d2 JST\u306a\u306e\u3067\u307e\u3041\u305d\u306e\u8fba\u306e\u30c7\u30fc\u30bf\u3060\u3068\u308f\u304b\u308a\u307e\u3059\u3002\n\u3053\u3046\u3044\u3046\u95a2\u6570(Zsh)\u3092\u5b9a\u7fa9\u3057\u3066\u304a\u3051\u3070\u30bf\u30fc\u30df\u30ca\u30eb\u306e\u3069\u3063\u304b\u306b\u4eca\u306e\u5929\u6c17\u3092\u51fa\u305b\u307e\u3059\u306d\u3002:sunny:\u3068\u304b\u306b\u306f  \u307f\u305f\u3044\u306a\u7d75\u6587\u5b57\u304c\u3042\u308b\u3068\u8aad\u307f\u66ff\u3048\u3066\u304f\u3060\u3055\u3044><\nfunction weather_icon() {\n  typeset -A weathers\n  weathers=(sky :sunny: clouds :cloud: rain :umbrella: thunderstorm :zap: snow :snowman: mist :foggy: )\n  owm=`curl -s 'http://api.openweathermap.org/data/2.5/weather?q=Tokyo,jp' \\\n  | jq -r '.weather[0].description'`\n  for weather in ${(k)weathers}\n  do\n    current=`echo $owm | grep $weather`\n    if [ \"$current\" != '' ]\n    then\n      echo -n $weathers[$weather]\n      exit\n    fi\n  done\n}\n\n\u3082\u3046jq\u3042\u3093\u307e\u95a2\u4fc2\u306a\u304f\u306a\u3063\u3066\u304d\u3066\u307e\u3059\u306d\u3002\u3044\u308d\u3093\u306a\u30e2\u30ce\u7d44\u307f\u5408\u308f\u305b\u306a\u3044\u3068\u8aac\u5f97\u529b\u51fa\u306a\u3044\u306e\u306fUNIX\u3068\u3044\u3046\u8003\u3048\u65b9\u306a\u306e\u3067\u3044\u3044\u3093\u3060\u3068\u66f2\u89e3\u3057\u3066\u524d\u306b\u9032\u307f\u307e\u3057\u3087\u3046\u3002\n\nSQL \u3063\u307d\u304f\u4f7f\u3046\n\u5168\u7136\u9055\u3046\u8a71\u984c\u306b\u79fb\u308a\u307e\u3059\u3002\n\u3042\u30fc\u306a\u3093\u304bRDB\u306bJSON\u914d\u7f6e\u3059\u308b\u306e\u9762\u5012\u304f\u3055\u3044\u306a\u3068\u3044\u3046\u3068\u304d\u306bjq\u3092\u3069\u3046\u4f7f\u3046\u304b\u3068\u3044\u3046\u8a71\u3002SQL\u3068\u6bd4\u8f03\u3057\u3066\u307f\u3066\u3069\u3093\u306a\u611f\u3058\u3067\u66f8\u3051\u308b\u304b\u898b\u3066\u307f\u307e\u3059\u3002\n\u306a\u304a\u3001\u8a18\u4e8b\u7528\u306eJSON\u3092\u4f5c\u308b\u306e\u304c\u9762\u5012\u304f\u3055\u304b\u3063\u305f\u306e\u3067\u3001SQLite3\u306b\u30c7\u30fc\u30bf\u3092\u4f5c\u3063\u3066\u3001\u305d\u308c\u3092JSON\u306b\u5909\u63db\u3057\u3066\u4e0b\u8a18\u306e\u8a18\u4e8b\u3092\u66f8\u3044\u3066\u307e\u3059\u3002\u3042\u3068\u3001\u65e5\u5e38\u3067\u79c1\u306f\u3053\u3093\u306a\u306e\u3067\u96c6\u8a08\u3057\u305f\u3053\u3068\u7121\u3044\u306e\u304c\u3053\u306e\u7ae0\u306e\u96e3\u70b9\u3067\u3059\u3002\n\n\u4f8b\u3067\u4f7f\u3046\u30c7\u30fc\u30bf\n\u5546\u54c1\u30de\u30b9\u30bf\u3068\u30e6\u30fc\u30b6\u30fc\u304c\u3044\u3066\u3001\u30e6\u30fc\u30b6\u30fc\u306f\u3044\u304f\u3064\u304b\u5546\u54c1\u3092\u307e\u3068\u3081\u3066\u4e00\u3064\u306e\u6ce8\u6587\u3059\u308b\u3068\u3044\u3046\u3088\u3046\u306a\u30c6\u30fc\u30d6\u30eb\u3067\u3059\u3002\nitems_old \u306f\u306a\u3093\u304b\u306e\u624b\u9055\u3044\u3067\u6b8b\u3063\u3066\u3057\u307e\u3063\u305f\u30c6\u30f3\u30dd\u30e9\u30ea\u306a\u30c6\u30fc\u30d6\u30eb\u3067\u3059\u3002\u99c4\u76ee\u3067\u3059\u306d\u3002\n\nitems(item_id, name, price)\nitems_old(item_id, name, price)\norders\nitem_orders(item_order_id, item_id, order_id, number)\n\n\nJSON\u3092RDB\u30b9\u30c8\u30ec\u30fc\u30b8\u3068\u3059\u308b\n\u4e00\u3064\u306eJSON\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u306a\u3063\u3066\u307e\u3059\u3002\u5197\u9577\u306a\u306e\u3067$ ./json\u3067\u51fa\u308b\u3053\u3068\u3068\u3057\u307e\u3059\u3002\n\u3044\u3084\u30fc\u898b\u306b\u304f\u3044\u3002jq .\u3067\u6574\u5f62\u3057\u3066\u306d\u3002\n$ ./json\n{\"items\":[{\"item_id\":1,\"name\":\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\"price\":2500},{\"item_id\":2,\"name\":\"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\"price\":4500},{\"item_id\":3,\"name\":\"\u9593\u63a5\u7167\u660e\",\"price\":3400},{\"item_id\":4,\"name\":\"\u5c0f\u7269\u5165\u308c\",\"price\":1200}],\"items_old\":[{\"item_id\":1,\"name\":\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\"price\":2500},{\"item_id\":5,\"name\":\"\u30ab\u30a8\u30eb\u306e\u7f6e\u7269\",\"price\":500}],\"orders\":[{\"order_id\":1,\"user_id\":1},{\"order_id\":2,\"user_id\":2},{\"order_id\":3,\"user_id\":3}],\"item_orders\":[{\"item_order_id\":1,\"item_id\":1,\"order_id\":1,\"number\":1},{\"item_order_id\":2,\"item_id\":4,\"order_id\":1,\"number\":2},{\"item_order_id\":3,\"item_id\":1,\"order_id\":3,\"number\":2},{\"item_order_id\":4,\"item_id\":2,\"order_id\":3,\"number\":1},{\"item_order_id\":5,\"item_id\":3,\"order_id\":3,\"number\":1}]}\n\n\n\u308f\u304b\u308a\u306b\u304f\u3044\u306e\u3067\u8868\u306b\u3057\u3066\u304a\u304d\u307e\u3059\n\u4f8b\u3067\u4f7f\u3046\u30c7\u30fc\u30bf\u3060\u3051\u8f09\u305b\u3066\u304a\u304d\u307e\u3059\u3002\n\nitems\n\n\n\nitem_id\nname\nprice\n\n\n\n\n1\n\u3059\u3066\u304d\u306a\u96d1\u8ca8\n2500\n\n\n2\n\u683c\u597d\u3044\u3044\u7f6e\u7269\n4500\n\n\n3\n\u9593\u63a5\u7167\u660e\n3400\n\n\n4\n\u5c0f\u7269\u5165\u308c\n1200\n\n\n\n\nitems_old\n\n\n\nitem_id\nname\nprice\n\n\n\n\n1\n\u3059\u3066\u304d\u306a\u96d1\u8ca8\n2500\n\n\n2\n\u683c\u597d\u3044\u3044\u7f6e\u7269\n4500\n\n\n\n\nitem_orders\n\n\n\nitem_order_id\nitem_id\norder_id\nnumber\n\n\n\n\n1\n1\n1\n1\n\n\n2\n4\n1\n2\n\n\n3\n1\n3\n2\n\n\n4\n2\n3\n1\n\n\n5\n3\n3\n1\n\n\n\n\n\u6f14\u7b97\nWikipedia\u306b\u3088\u308c\u3070\u5e7e\u3064\u304b\u306e\u6f14\u7b97\u304c\u3067\u304d\u308c\u3070SQL\u3063\u307d\u3044\u3053\u3068\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u3002\n\n\u548c\nunion\u3067\u3059\u306d\u3002 items\u3068items_old\u5168\u90e8\u3067\u3069\u306e\u304f\u3089\u3044\u5546\u54c1\u3042\u3063\u305f\u3063\u3051\uff1f\n./json \\\n| jq '.items + .items_old | unique'\n\n\n\u5dee\n\u3042\u3093\u307e\u308a\u4f7f\u308f\u306a\u3044\u3067\u3059\u3057\u3001\u5b9f\u88c5\u3055\u308c\u3066\u306a\u3044RDBMS\u3082\u3042\u308a\u307e\u3059\u304c\u3001except\u3067\u3059\u306d\u3002items_old \u306b\u3042\u308b\u3084\u3064\u3092\u9664\u304f\u3068\uff1f\n./json \\\n| jq '.items - .items_old'\n\n\u3042\u3001\u306a\u3093\u304b\u7c21\u5358\u306b\u3067\u304d\u305f\u3002\n\n\u7a4d\n\u540c\u3058\u3084\u3064\u3092\u629c\u304d\u51fa\u3057\u307e\u3059\u3002SQL\u3060\u3068\u3053\u308c\u3082\u307e\u308b\u3067\u898b\u304b\u3051\u306a\u3044intersect\u3002\n./json \\\n| jq '[.items[] as $item | .items_old[] | select($item == .)]'\n\n\u3084\u3070\u3044\u3067\u3059\u306d\u3002\u82e6\u3057\u304f\u306a\u3063\u3066\u304d\u305f\u3002\u6025\u306b\u5909\u6570\u3063\u307d\u3044\u306e\u3067\u3066\u304d\u307e\u3057\u305f\u3002as $item\u306f\u5909\u6570\u3067\u3059\u3002foreach\u306e\u3088\u3046\u306b\u632f\u308b\u821e\u3044\u307e\u3059\u306e\u3067\u3001\u4e8c\u3064\u306e\u30d5\u30a3\u30eb\u30bf\u30672\u91cd\u30eb\u30fc\u30d7\u306e\u3088\u3046\u306a\u69cb\u9020\u306b\u306a\u3063\u3066\u307e\u3059\u3002\u82e6\u3057\u3044\u306e\u3067\u624b\u7d9a\u304d\u578b\u3063\u307d\u304f\u306a\u3063\u3066\u304d\u3066\u307e\u3059\u3002\n\n\u76f4\u7a4d\n\u6761\u4ef6\u3092\u6307\u5b9a\u3057\u306a\u3044join\u3067\u3059\u306d\u3002cross join\u3068\u304b\u3002\n./json \\\n| jq '[.items[] as $item | .item_orders[] | { item: $item, item_orders: . }]'\n\n\u3055\u3089\u306b\u8f9b\u304f\u306a\u3063\u3066\u304d\u307e\u3057\u305f\u306d\u3002\n\u30c6\u30fc\u30d6\u30eb\u3092\u666e\u901a\u306b\u3072\u3068\u3064\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u304c\u3063\u3061\u3083\u3093\u3053\u3059\u308b\u3068\u3001\u3069\u306e\u30c6\u30fc\u30d6\u30eb\u306e\u9805\u76ee\u304b\u5206\u304b\u3089\u306a\u304f\u306a\u308b\u306e\u3067\u3001\u5206\u304b\u308b\u3088\u3046\u306bcross join\u3055\u305b\u3066\u307f\u307e\u3057\u305f\u3002\u2193\u307f\u305f\u3044\u306a\u611f\u3058\u3002\u3067\u3082\u76f4\u7a4d\u304c\u51fa\u6765\u308c\u3070\u2026\u3002\n[\n  {\n    \"item\": {\n      \"item_id\": 1,\n      \"name\": \"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\n      \"price\": 2500\n    },\n    \"item_orders\": {\n      \"item_order_id\": 1,\n      \"item_id\": 1,\n      \"order_id\": 1,\n      \"number\": 1\n    }\n  },\n\n\n\u9078\u629e\nwhere\u307f\u305f\u3044\u306a\u3002item_id: 1 \u306e\u6ce8\u6587\u3092\u629c\u304d\u51fa\u3057\u307e\u3059\u3002\n./json \\\n| jq '.item_orders | map(select(.item_id == 1))'\n\n\n\u5c04\u5f71\nselect\u3067\u3059\u306d\u3002\u3053\u308c\u306f\u7c21\u5358\u304b\u3002\n$ ./json \\\n| jq '.items | map({name: .name})'\n\n\n3\u3064\u4ee5\u4e0a\u58f2\u308c\u305f\u5546\u54c1\u306e\u540d\u524d\u3092\u51fa\u3059\n\u306a\u3093\u3068\u306a\u304f\u8272\u3005\u51fa\u6765\u305d\u3046\u306a\u306e\u3067\u3001SQL\u3063\u307d\u3044\u3053\u3068\u3092\u3084\u3063\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u30023\u3064\u4ee5\u4e0a\u58f2\u308c\u305f\u5546\u54c1\u306e\u540d\u524d\u3092\u51fa\u3057\u3066\u307f\u307e\u3059\u3002\n\u5fc5\u8981\u305d\u3046\u306a\u306e\u306fgroup by\u3068having\u76f8\u5f53\u3067\u3059\u306d\u3002\n./json \\\n| jq '[.items[] as $item | .item_orders[] | { item: $item, item_orders: . } | select(.item.item_id == .item_orders.item_id)] | [group_by(.item.item_id)[] | { item: .[0].item, sum: (. | map(.item_orders.number) | add) } | select(.sum >= 3) | { name: .item.name }]'\n\nSQL\u3060\u3068\u3053\u3046\u306a\u308a\u307e\u3059\u3002\nSELECT   items.name\nFROM     items, item_orders\nWHERE    items.item_id = item_orders.item_id\nGROUP BY items.name\nHAVING   SUM(item_orders.number) >= 3\n\n\u5206\u89e3\u3059\u308b\u3068\u3053\u3046\u3044\u3046\u611f\u3058\u306b\u306a\u308a\u307e\u3059\u3002\n1, CROSS JOIN\n.items[] as $item | .item_orders[] | { item: $item, item_orders: . }\n2, INNER JOIN\nselect(.item.item_id == .item_orders.item_id)]\n3, GROUP BY\ngroup_by(.item.item_id)\n4, HAVING\n{ item: .[0].item, sum: (. | map(.item_orders.number) | add) } | select(.sum >= 3)\n5, SELECT\n{ name: .item.name }\n\u6700\u65e9jq\u95a2\u4fc2\u306a\u3044\u3067\u3059\u304c\u3001\u521d\u5fc3\u8005\u304c\u3064\u307e\u3065\u304d\u304c\u3061\u306aHAVING\u3068WHERE\u304c\u5206\u304b\u308c\u3066\u308b\u7406\u7531\u304c\u306a\u3093\u3068\u306a\u304f\u5206\u304b\u3063\u3066\u304d\u307e\u3059\u306d\u3002\u3042\u3068SQL\u306e\u5049\u5927\u3055\u304c\u4f1d\u308f\u3063\u3066\u304d\u307e\u3059\u3002\n\nJSON\u3092\u5206\u6790\u3059\u308b\u3068\u304d\u306e\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\n@csv\u3092\u4f7f\u3063\u3066\u3001CSV\u306b\u306f\u304d\u51fa\u3057\u3066\u3001RDBMS\u4ed8\u5c5e\u306eCSV\u30ed\u30fc\u30c0\u30fc\u304b\u3089RDB\u306b\u5165\u308c\u3066\u3001\u7d20\u76f4\u306bSQL\u305f\u305f\u304f\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059w\u3002\n$ ./json \\\n| jq -r '.items[] | [.item_id, .name, .price] | @csv'\n1,\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",2500\n2,\"\u683c\u597d\u3044\u3044\u7f6e\u7269\",4500\n3,\"\u9593\u63a5\u7167\u660e\",3400\n4,\"\u5c0f\u7269\u5165\u308c\",1200\n\n\u4ee5\u4e0a\u3067\u3059\u3002\n# jq \u30b3\u30de\u30f3\u30c9\u3068\u306f\nhttp://stedolan.github.io/jq/\nJSON\u304b\u3089\u7c21\u5358\u306b\u5024\u3092\u629c\u304d\u51fa\u3057\u305f\u308a\u3001\u96c6\u8a08\u3057\u305f\u308a\u3001\u6574\u5f62\u3057\u3066\u8868\u793a\u3057\u305f\u308a\u3067\u304d\u308bJSON\u7528\u306egrep\u3068\u304bawk\u307f\u305f\u3044\u306a\u30b3\u30de\u30f3\u30c9\u3067\u3059\u3002\nWeb\u30b5\u30fc\u30d3\u30b9\u304cJSON\u3092\u5410\u3044\u305f\u308a\u3001AWS CLI\u304c JSON \u3092\u5410\u3044\u305f\u308a\u3059\u308b\u73fe\u4ee3\u793e\u4f1a\u3067\u5927\u5909\u4fbf\u5229\u306a\u30b3\u30de\u30f3\u30c9\u3067\u3059\u3002\n\n## \u30de\u30cb\u30e5\u30a2\u30eb\n\u3060\u3044\u305f\u3044\u3053\u3053\u8aad\u3081\u3070OK.\nhttp://stedolan.github.io/jq/manual/\n\n\u3042\u3001\u3053\u308c\u3067\u3001\u7d42\u308f\u3063\u3066\u3057\u307e\u3046\u3002\u3060\u3051\u3069\u6c17\u306b\u305b\u305a\u9032\u3081\u307e\u3059\u3002\n\n# \u7c21\u5358\u306a\u4f8b\n\u307e\u305a\u3001\u7a7a\u6c17\u3092\u3064\u304b\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u4ee5\u4e0bjq\u30b3\u30de\u30f3\u30c9\u306e\u8a18\u6cd5\u3092\u898b\u3066\u3044\u304d\u307e\u3059\u3002JSON ``{ \"hoge\": \"velue\" }`` \u304c\u3042\u3063\u305f\u5834\u5408\u3001 ``.`` \u304c\u30eb\u30fc\u30c8 ``{}`` \u3092\u8868\u3057\u307e\u3059\u3002``.hoge`` \u3067 ``\"value\"`` \u3092\u8868\u73fe\u3057\u307e\u3059\u3002\u3060\u3044\u305f\u3044\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n## \u30b5\u30f3\u30d7\u30eb de-ta\n\n\n## \u305f\u3060\u306e\u6574\u5f62\n\n```bash\n$ echo '{\"items\":[{\"item_id\":1,\"name\":\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\"price\":2500},{\"item_id\":2,\"name\":\"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\"price\":4500}]}' \\\n| jq .\n{\n  \"items\": [\n    {\n      \"item_id\": 1,\n      \"name\": \"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\n      \"price\": 2500\n    },\n    {\n      \"item_id\": 2,\n      \"name\": \"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\n      \"price\": 4500\n    }\n  ]\n}\n```\n\n\u3057\u3070\u3089\u304f\u2191\u306eJSON\u3092\u4f8b\u306b\u9032\u3081\u307e\u3059\u3002items\u306b\u306f\u914d\u5217\u304c\u3076\u3089\u4e0b\u304c\u308a\u3001\u305d\u306e\u4e0b\u306b\u306f\u4e8c\u3064\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u683c\u7d0d\u3055\u308c\u3066\u307e\u3059\u3002\n\n## \u5024\u306e\u5217\u6319\n\n```bash\n$ echo '{\"items\":[{\"item_id\":1,\"name\":\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\"price\":2500},{\"item_id\":2,\"name\":\"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\"price\":4500}]}' \\\n| jq '.items[].name'\n\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\"\n\"\u683c\u597d\u3044\u3044\u7f6e\u7269\"\n```\n\n### \u30c0\u30d6\u30eb\u30af\u30a9\u30fc\u30c8\u304c\u90aa\u9b54\n\n\u5225\u306e\u30b3\u30de\u30f3\u30c9\u306b\u6d41\u3059\u3068\u304d\u306f\u30c0\u30d6\u30eb\u30af\u30a9\u30fc\u30c8\u304c\u90aa\u9b54\u3067\u3059\u306d\u3002`-r` \u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u6d88\u3048\u307e\u3059\u3002\n\n```bash\n$ echo '{\"items\":[{\"item_id\":1,\"name\":\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\"price\":2500},{\"item_id\":2,\"name\":\"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\"price\":4500}]}' \\\n| jq -r '.items[].name'\n\u3059\u3066\u304d\u306a\u96d1\u8ca8\n\u683c\u597d\u3044\u3044\u7f6e\u7269\n```\n\n## \u30d5\u30a3\u30eb\u30bf(\u30d1\u30a4\u30d7)\nshell \u306e\u30d1\u30a4\u30d7\u307f\u305f\u3044\u306a\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\u2191\u3068\u540c\u3058\u4e8b\u3092\u30d5\u30a3\u30eb\u30bf\u3067\u3002\u2193\u306e\u4f8b\u306f\u3001``.items[]``\u3092\u30d5\u30a3\u30eb\u30bf\u306b\u6e21\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u8981\u7d20\u6bce\u306b\u6b21\u306e\u51e6\u7406\u304c\u9069\u7528\u3055\u308c\u307e\u3059\u3002\u3082\u3057\u3001``.items``\u3068\u3059\u308b\u3068\u3001\u8981\u7d20\u6bce\u3067\u306f\u7121\u304f\u3001\u914d\u5217\u307e\u308b\u3054\u3068\u6b21\u306e\u30d5\u30a3\u30eb\u30bf\u306b\u6e21\u3055\u308c\u307e\u3059\u3002\n\n```bash\n $ echo '{\"items\":[{\"item_id\":1,\"name\":\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\"price\":2500},{\"item_id\":2,\"name\":\"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\"price\":4500}]}' \\\n | jq -r '.items[] | .name'\n\u3059\u3066\u304d\u306a\u96d1\u8ca8\n\u683c\u597d\u3044\u3044\u7f6e\u7269\n```\n\n## \u96c6\u8a08\n\n```bash\n$ echo '{\"items\":[{\"item_id\":1,\"name\":\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\"price\":2500},{\"item_id\":2,\"name\":\"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\"price\":4500}]}' \\\n| jq '[.items[].price] | add'\n7000\n```\n## \u30d5\u30a3\u30eb\u30bf\u3092\u901a\u3058\u3066\u518d\u6574\u5f62\n```bash\n$ echo '{\"items\":[{\"item_id\":1,\"name\":\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\"price\":2500},{\"item_id\":2,\"name\":\"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\"price\":4500}]}' \\\n| jq '.items[] | { name: .name, yen: .price }'\n{\n  \"name\": \"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\n  \"yen\": 2500\n}\n{\n  \"name\": \"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\n  \"yen\": 4500\n}\n```\n## map\n```bash\n$ echo '{\"items\":[{\"item_id\":1,\"name\":\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\"price\":2500},{\"item_id\":2,\"name\":\"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\"price\":4500}]}' \\\n| jq '.items | map({ name: .name, yen: .price })'\n[\n  {\n    \"name\": \"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\n    \"yen\": 2500\n  },\n  {\n    \"name\": \"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\n    \"yen\": 4500\n  }\n]\n```\n## reduce\n```bash\n$ echo '{\"items\":[{\"item_id\":1,\"name\":\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\"price\":2500},{\"item_id\":2,\"name\":\"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\"price\":4500}]}' \\\n| jq 'reduce .items[] as $item (0; . + $item.price)'\n7000\n```\n\n# jq \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3046\u5834\u9762\u3067\u306e\u3061\u3087\u3063\u3068\u3057\u305f\u3053\u3068\n\n## \u30ab\u30f3\u30de\u306f\u533a\u5207\u308a\u6587\u5b57\u3058\u3083\u7121\u304f\u3066\u3001\u30d5\u30a3\u30eb\u30bf\u306e\u5165\u529b\u3092\u5206\u3051\u308b\n\n\u30ab\u30f3\u30de\u306f\u914d\u5217\u3084\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u8981\u7d20\u3092\u533a\u5207\u308b\u3082\u306e\u3068\u3057\u3066\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u306f\u7121\u304f\u3001\u30d5\u30a3\u30eb\u30bf\u306e\u5165\u529b\u51e6\u7406\u3092\u5206\u3051\u308b\u610f\u5473\u3067\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```bash\n$ echo '{\"key1\": \"val1\", \"key2\": \"val2\"}' \\\n| jq '[.key1, .key2]'\n[\n  \"val1\",\n  \"val2\"\n]\n```\n\n\u306a\u306e\u3067\u3001\u62ec\u5f27\u3067\u304f\u304f\u308c\u3070\u5165\u529b\u3092\u6b21\u3005\u3068\u518d\u6574\u5f62\u3057\u3066\u3044\u304f\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n```bash\n$ echo '{\"key1\": \"val1\", \"key2\": \"val2\"}' \\\n| jq '[.key1, (keys | map(.))]'\n[\n  \"val1\",\n  [\n    \"key1\",\n    \"key2\"\n  ]\n]\n```\n\n\u3053\u308c\u3092\u7406\u89e3\u3067\u304d\u308c\u3070\u7d50\u69cb\u8272\u3005\u904a\u3079\u308b\u306e\u3067\u3001\u662f\u975e\u77e5\u3063\u3066\u304a\u3044\u3066\u3044\u305f\u3060\u3051\u308c\u3070\u3068\u601d\u3044\u307e\u3059\u3002\n\n## Key/Value\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u5909\u63db\u3059\u308b\n\n### from_entries\nAWS\u30ea\u30bd\u30fc\u30b9\u3092\u64cd\u4f5c\u7ba1\u7406\u51fa\u6765\u308b\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30c4\u30fc\u30eb\"AWS CLI\"\u3067\u306f\u3001\u30ea\u30bd\u30fc\u30b9\u306b\u4ed8\u3051\u3089\u308c\u305f\u30bf\u30b0\u3092``[{\"Key\": \"tagkey\", \"Value\": \"value\"},{\"Key\": \"tagkey2\", \"Value\": \"value\uff12\"}]``\u306e\u3088\u3046\u306a\u5f62\u5f0f\u3067\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u3053\u308c\u3092\u5225\u30b3\u30de\u30f3\u30c9\u306b\u6d41\u3059\u3068\u304b\u3001\u30ea\u30bd\u30fc\u30b9\u5358\u4f4d\u3067\u30bf\u30b0\u3092\u5143\u306b\u30bd\u30fc\u30c8\u3059\u308b\u3068\u304bgroup by\u3057\u305f\u3044\u306e\u3067\u3001``{\"tagkey\": \"tagkey\", \"tagkey2\": \"value\uff12\"}``\u306e\u3088\u3046\u306a\u4e00\u3064\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5f62\u5f0f\u306b\u3057\u305f\u3044\u3068\u304d\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u3053\u3046\u3044\u3046\u5834\u5408\u306b\u306fjq\u306b\u306f``from_entries``\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```bash\n$ echo '[{\"Key\": \"tagkey\", \"Value\": \"value\"},{\"Key\": \"tagkey2\", \"Value\": \"value\uff12\"}]' \\\n| jq 'from_entries'\n{\n  \"tagkey\": \"value\",\n  \"tagkey2\": \"value\uff12\"\n}\n```\n\n# \u305d\u308c\u3063\u307d\u3044\u6d3b\u7528\u4e8b\u4f8b\n\u306a\u3093\u3068\u306a\u304f\u3001\u5206\u304b\u3063\u3066\u304d\u305f\u3067\u3057\u3087\u3046\u3002\u3053\u3053\u304b\u3089\u306f\u30cd\u30c3\u30c8\u3092\u4f7f\u3063\u305f\u305d\u308c\u3063\u307d\u3044\u4f8b\u3092\u51fa\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n## \u3042\u308b\u4eba\u306egithub\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u5217\u6319\u3059\u308b\ngithub\u306eAPI\u3067\u53d6\u308c\u308b\u30a2\u30ab\u30a6\u30f3\u30c8\u60c5\u5831\u306b\u306f\u3001\u30ea\u30dd\u30b8\u30c8\u30ea\u4e00\u89a7\u3092\u898b\u308b\u305f\u3081\u306eURL\u304c\u683c\u7d0d\u3055\u308c\u3066\u308b\u306e\u3067\u30012\u56de\u30af\u30a8\u30ea\u3092\u6295\u3052\u308c\u3070\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\u3048\u3044\u3048\u3044\u3002\n\n```bash\n$ curl -s `curl -s https://api.github.com/users/takeshinoda | jq -r .repos_url` \\\n | jq '.[].name'\n\"avr-test\"\n\"doctree\"\n\"HogeApp\"\n\"rubykaigi\"\n\"sprk2012-cflt\"\n\"thinreports-handler\"\n\"thinreports-rails\"\n```\n\n## \u6771\u4eac\u306e\u6c17\u6e29\u306e\u5c65\u6b74\n\u5bd2\u304f\u306a\u3063\u3066\u304d\u307e\u3057\u305f\u306e\u3067\u3001CSV\u306b\u6c17\u6e29\u306e\u5c65\u6b74\u3092\u51fa\u3057\u307e\u3059\u3002Openweathermap\u3068\u3044\u3046\u4e16\u754c\u4e2d\u306e\u90fd\u5e02\u306e\u6c17\u8c61\u60c5\u5831\u3092API\u3067\u63d0\u4f9b\u3057\u3066\u3044\u308b\u30b5\u30fc\u30d3\u30b9\u304c\u3042\u308b\u306e\u3067\u305d\u308c\u3092\u5229\u7528\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306f\u3001``{ ..., list: [...] }``\u307f\u305f\u3044\u306a\u611f\u3058\u3067\u3001list\u30a2\u30c8\u30ea\u30d3\u30e5\u30fc\u30c8\u4ee5\u4e0b\u306b\u305d\u308c\u3063\u307d\u3044\u30c7\u30fc\u30bf\u304c\u683c\u7d0d\u3055\u308c\u3066\u307e\u3059\u3002\n\n```bash\n$ curl -s 'http://api.openweathermap.org/data/2.5/history/city?id=1850147&type=hour' \\\n| jq -r '.list[] | [.dt, .main.temp_min, .main.temp_max] | @csv'\n1418348513,281.15,284.15\n1418350162,281.15,284.15\n1418352118,281.15,284.15\n1418355724,281.15,284.15\n1418359309,281.15,283.15\n1418361358,282.15,283.15\n1418362930,282.15,283.15\n1418367148,282.15,283.15\n```\n\n\u8aad\u3081\u306a\u3044\u3067\u3059\u306d\u3002\u5de6\u304b\u3089unixtime(UTC), \u6700\u4f4e\u6c17\u6e29(\u30b1\u30eb\u30d3\u30f3), \u6700\u9ad8\u6c17\u6e29(\u30b1\u30eb\u30d3\u30f3)\u3067\u3059\u3002\u9069\u5b9cawk\u3068\u304b\u306b\u55b0\u308f\u305b\u3066\u5909\u63db\u3059\u308c\u3070\u5927\u4e08\u592b\u3067\u3059\u3002\u3046\u3093\u3002\u3061\u306a\u307f\u306b1418380960\u306f``2014\u5e74 12\u670812\u65e5 \u91d1\u66dc\u65e5 19\u664242\u520640\u79d2 JST``\u306a\u306e\u3067\u307e\u3041\u305d\u306e\u8fba\u306e\u30c7\u30fc\u30bf\u3060\u3068\u308f\u304b\u308a\u307e\u3059\u3002\n\n\u3053\u3046\u3044\u3046\u95a2\u6570(Zsh)\u3092\u5b9a\u7fa9\u3057\u3066\u304a\u3051\u3070\u30bf\u30fc\u30df\u30ca\u30eb\u306e\u3069\u3063\u304b\u306b\u4eca\u306e\u5929\u6c17\u3092\u51fa\u305b\u307e\u3059\u306d\u3002``:sunny:``\u3068\u304b\u306b\u306f :sunny: \u307f\u305f\u3044\u306a\u7d75\u6587\u5b57\u304c\u3042\u308b\u3068\u8aad\u307f\u66ff\u3048\u3066\u304f\u3060\u3055\u3044><\n\n```zsh\nfunction weather_icon() {\n  typeset -A weathers\n  weathers=(sky :sunny: clouds :cloud: rain :umbrella: thunderstorm :zap: snow :snowman: mist :foggy: )\n  owm=`curl -s 'http://api.openweathermap.org/data/2.5/weather?q=Tokyo,jp' \\\n  | jq -r '.weather[0].description'`\n  for weather in ${(k)weathers}\n  do\n    current=`echo $owm | grep $weather`\n    if [ \"$current\" != '' ]\n    then\n      echo -n $weathers[$weather]\n      exit\n    fi\n  done\n}\n```\n\n\u3082\u3046jq\u3042\u3093\u307e\u95a2\u4fc2\u306a\u304f\u306a\u3063\u3066\u304d\u3066\u307e\u3059\u306d\u3002\u3044\u308d\u3093\u306a\u30e2\u30ce\u7d44\u307f\u5408\u308f\u305b\u306a\u3044\u3068\u8aac\u5f97\u529b\u51fa\u306a\u3044\u306e\u306f[UNIX\u3068\u3044\u3046\u8003\u3048\u65b9](http://www.amazon.co.jp/dp/4274064069)\u306a\u306e\u3067\u3044\u3044\u3093\u3060\u3068\u66f2\u89e3\u3057\u3066\u524d\u306b\u9032\u307f\u307e\u3057\u3087\u3046\u3002\n\n# SQL \u3063\u307d\u304f\u4f7f\u3046\n\n\u5168\u7136\u9055\u3046\u8a71\u984c\u306b\u79fb\u308a\u307e\u3059\u3002\n\n\u3042\u30fc\u306a\u3093\u304bRDB\u306bJSON\u914d\u7f6e\u3059\u308b\u306e\u9762\u5012\u304f\u3055\u3044\u306a\u3068\u3044\u3046\u3068\u304d\u306bjq\u3092\u3069\u3046\u4f7f\u3046\u304b\u3068\u3044\u3046\u8a71\u3002SQL\u3068\u6bd4\u8f03\u3057\u3066\u307f\u3066\u3069\u3093\u306a\u611f\u3058\u3067\u66f8\u3051\u308b\u304b\u898b\u3066\u307f\u307e\u3059\u3002\n\n\u306a\u304a\u3001\u8a18\u4e8b\u7528\u306eJSON\u3092\u4f5c\u308b\u306e\u304c\u9762\u5012\u304f\u3055\u304b\u3063\u305f\u306e\u3067\u3001SQLite3\u306b\u30c7\u30fc\u30bf\u3092\u4f5c\u3063\u3066\u3001\u305d\u308c\u3092JSON\u306b\u5909\u63db\u3057\u3066\u4e0b\u8a18\u306e\u8a18\u4e8b\u3092\u66f8\u3044\u3066\u307e\u3059\u3002\u3042\u3068\u3001\u65e5\u5e38\u3067\u79c1\u306f\u3053\u3093\u306a\u306e\u3067\u96c6\u8a08\u3057\u305f\u3053\u3068\u7121\u3044\u306e\u304c\u3053\u306e\u7ae0\u306e\u96e3\u70b9\u3067\u3059\u3002\n\n## \u4f8b\u3067\u4f7f\u3046\u30c7\u30fc\u30bf\n\u5546\u54c1\u30de\u30b9\u30bf\u3068\u30e6\u30fc\u30b6\u30fc\u304c\u3044\u3066\u3001\u30e6\u30fc\u30b6\u30fc\u306f\u3044\u304f\u3064\u304b\u5546\u54c1\u3092\u307e\u3068\u3081\u3066\u4e00\u3064\u306e\u6ce8\u6587\u3059\u308b\u3068\u3044\u3046\u3088\u3046\u306a\u30c6\u30fc\u30d6\u30eb\u3067\u3059\u3002\nitems_old \u306f\u306a\u3093\u304b\u306e\u624b\u9055\u3044\u3067\u6b8b\u3063\u3066\u3057\u307e\u3063\u305f\u30c6\u30f3\u30dd\u30e9\u30ea\u306a\u30c6\u30fc\u30d6\u30eb\u3067\u3059\u3002\u99c4\u76ee\u3067\u3059\u306d\u3002\n\n- items(item_id, name, price)\n- items_old(item_id, name, price)\n- orders\n- item_orders(item_order_id, item_id, order_id, number)\n\n### JSON\u3092RDB\u30b9\u30c8\u30ec\u30fc\u30b8\u3068\u3059\u308b\n\n\u4e00\u3064\u306eJSON\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u306a\u3063\u3066\u307e\u3059\u3002\u5197\u9577\u306a\u306e\u3067``$ ./json``\u3067\u51fa\u308b\u3053\u3068\u3068\u3057\u307e\u3059\u3002\n\n\u3044\u3084\u30fc\u898b\u306b\u304f\u3044\u3002``jq .``\u3067\u6574\u5f62\u3057\u3066\u306d\u3002\n\n```json\n$ ./json\n{\"items\":[{\"item_id\":1,\"name\":\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\"price\":2500},{\"item_id\":2,\"name\":\"\u683c\u597d\u3044\u3044\u7f6e\u7269\",\"price\":4500},{\"item_id\":3,\"name\":\"\u9593\u63a5\u7167\u660e\",\"price\":3400},{\"item_id\":4,\"name\":\"\u5c0f\u7269\u5165\u308c\",\"price\":1200}],\"items_old\":[{\"item_id\":1,\"name\":\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\"price\":2500},{\"item_id\":5,\"name\":\"\u30ab\u30a8\u30eb\u306e\u7f6e\u7269\",\"price\":500}],\"orders\":[{\"order_id\":1,\"user_id\":1},{\"order_id\":2,\"user_id\":2},{\"order_id\":3,\"user_id\":3}],\"item_orders\":[{\"item_order_id\":1,\"item_id\":1,\"order_id\":1,\"number\":1},{\"item_order_id\":2,\"item_id\":4,\"order_id\":1,\"number\":2},{\"item_order_id\":3,\"item_id\":1,\"order_id\":3,\"number\":2},{\"item_order_id\":4,\"item_id\":2,\"order_id\":3,\"number\":1},{\"item_order_id\":5,\"item_id\":3,\"order_id\":3,\"number\":1}]}\n```\n\n### \u308f\u304b\u308a\u306b\u304f\u3044\u306e\u3067\u8868\u306b\u3057\u3066\u304a\u304d\u307e\u3059\n\u4f8b\u3067\u4f7f\u3046\u30c7\u30fc\u30bf\u3060\u3051\u8f09\u305b\u3066\u304a\u304d\u307e\u3059\u3002\n\n#### items\n|item_id|name|price|\n|:-----|:-----|:-----|\n|1|\u3059\u3066\u304d\u306a\u96d1\u8ca8|2500|\n|2|\u683c\u597d\u3044\u3044\u7f6e\u7269|4500|\n|3|\u9593\u63a5\u7167\u660e|3400|\n|4|\u5c0f\u7269\u5165\u308c|1200|\n\n#### items_old\n|item_id|name|price|\n|:-----|:-----|:-----|\n|1|\u3059\u3066\u304d\u306a\u96d1\u8ca8|2500|\n|2|\u683c\u597d\u3044\u3044\u7f6e\u7269|4500|\n\n#### item_orders\n|item_order_id|item_id|order_id|number|\n|:-----|:-----|:-----|:-----|\n|1|1|1|1|\n|2|4|1|2|\n|3|1|3|2|\n|4|2|3|1|\n|5|3|3|1|\n\n## \u6f14\u7b97\nWikipedia\u306b\u3088\u308c\u3070\u5e7e\u3064\u304b\u306e\u6f14\u7b97\u304c\u3067\u304d\u308c\u3070SQL\u3063\u307d\u3044\u3053\u3068\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u3002\n\n### \u548c\n\n``union``\u3067\u3059\u306d\u3002 items\u3068items_old\u5168\u90e8\u3067\u3069\u306e\u304f\u3089\u3044\u5546\u54c1\u3042\u3063\u305f\u3063\u3051\uff1f\n\n```bash\n./json \\\n| jq '.items + .items_old | unique'\n```\n\n### \u5dee\n\n\u3042\u3093\u307e\u308a\u4f7f\u308f\u306a\u3044\u3067\u3059\u3057\u3001\u5b9f\u88c5\u3055\u308c\u3066\u306a\u3044RDBMS\u3082\u3042\u308a\u307e\u3059\u304c\u3001``except``\u3067\u3059\u306d\u3002items_old \u306b\u3042\u308b\u3084\u3064\u3092\u9664\u304f\u3068\uff1f\n\n```bash\n./json \\\n| jq '.items - .items_old'\n```\n\n\u3042\u3001\u306a\u3093\u304b\u7c21\u5358\u306b\u3067\u304d\u305f\u3002\n\n### \u7a4d\n\n\u540c\u3058\u3084\u3064\u3092\u629c\u304d\u51fa\u3057\u307e\u3059\u3002SQL\u3060\u3068\u3053\u308c\u3082\u307e\u308b\u3067\u898b\u304b\u3051\u306a\u3044``intersect``\u3002\n\n```bash\n./json \\\n| jq '[.items[] as $item | .items_old[] | select($item == .)]'\n```\n\n\u3084\u3070\u3044\u3067\u3059\u306d\u3002\u82e6\u3057\u304f\u306a\u3063\u3066\u304d\u305f\u3002\u6025\u306b\u5909\u6570\u3063\u307d\u3044\u306e\u3067\u3066\u304d\u307e\u3057\u305f\u3002``as $item``\u306f\u5909\u6570\u3067\u3059\u3002foreach\u306e\u3088\u3046\u306b\u632f\u308b\u821e\u3044\u307e\u3059\u306e\u3067\u3001\u4e8c\u3064\u306e\u30d5\u30a3\u30eb\u30bf\u30672\u91cd\u30eb\u30fc\u30d7\u306e\u3088\u3046\u306a\u69cb\u9020\u306b\u306a\u3063\u3066\u307e\u3059\u3002\u82e6\u3057\u3044\u306e\u3067\u624b\u7d9a\u304d\u578b\u3063\u307d\u304f\u306a\u3063\u3066\u304d\u3066\u307e\u3059\u3002\n\n### \u76f4\u7a4d\n\n\u6761\u4ef6\u3092\u6307\u5b9a\u3057\u306a\u3044``join``\u3067\u3059\u306d\u3002``cross join``\u3068\u304b\u3002\n\n```bash\n./json \\\n| jq '[.items[] as $item | .item_orders[] | { item: $item, item_orders: . }]'\n```\n\n\u3055\u3089\u306b\u8f9b\u304f\u306a\u3063\u3066\u304d\u307e\u3057\u305f\u306d\u3002\n\n\u30c6\u30fc\u30d6\u30eb\u3092\u666e\u901a\u306b\u3072\u3068\u3064\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u304c\u3063\u3061\u3083\u3093\u3053\u3059\u308b\u3068\u3001\u3069\u306e\u30c6\u30fc\u30d6\u30eb\u306e\u9805\u76ee\u304b\u5206\u304b\u3089\u306a\u304f\u306a\u308b\u306e\u3067\u3001\u5206\u304b\u308b\u3088\u3046\u306b``cross join``\u3055\u305b\u3066\u307f\u307e\u3057\u305f\u3002\u2193\u307f\u305f\u3044\u306a\u611f\u3058\u3002\u3067\u3082\u76f4\u7a4d\u304c\u51fa\u6765\u308c\u3070\u2026\u3002\n\n```json\n[\n  {\n    \"item\": {\n      \"item_id\": 1,\n      \"name\": \"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",\n      \"price\": 2500\n    },\n    \"item_orders\": {\n      \"item_order_id\": 1,\n      \"item_id\": 1,\n      \"order_id\": 1,\n      \"number\": 1\n    }\n  },\n```\n\n### \u9078\u629e\n\n``where``\u307f\u305f\u3044\u306a\u3002item_id: 1 \u306e\u6ce8\u6587\u3092\u629c\u304d\u51fa\u3057\u307e\u3059\u3002\n\n```bash\n./json \\\n| jq '.item_orders | map(select(.item_id == 1))'\n```\n\n### \u5c04\u5f71\n\n``select``\u3067\u3059\u306d\u3002\u3053\u308c\u306f\u7c21\u5358\u304b\u3002\n\n```bash\n$ ./json \\\n| jq '.items | map({name: .name})'\n```\n\n## 3\u3064\u4ee5\u4e0a\u58f2\u308c\u305f\u5546\u54c1\u306e\u540d\u524d\u3092\u51fa\u3059\n\n\u306a\u3093\u3068\u306a\u304f\u8272\u3005\u51fa\u6765\u305d\u3046\u306a\u306e\u3067\u3001SQL\u3063\u307d\u3044\u3053\u3068\u3092\u3084\u3063\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u30023\u3064\u4ee5\u4e0a\u58f2\u308c\u305f\u5546\u54c1\u306e\u540d\u524d\u3092\u51fa\u3057\u3066\u307f\u307e\u3059\u3002\n\u5fc5\u8981\u305d\u3046\u306a\u306e\u306f``group by``\u3068``having``\u76f8\u5f53\u3067\u3059\u306d\u3002\n\n```bash\n./json \\\n| jq '[.items[] as $item | .item_orders[] | { item: $item, item_orders: . } | select(.item.item_id == .item_orders.item_id)] | [group_by(.item.item_id)[] | { item: .[0].item, sum: (. | map(.item_orders.number) | add) } | select(.sum >= 3) | { name: .item.name }]'\n```\n\nSQL\u3060\u3068\u3053\u3046\u306a\u308a\u307e\u3059\u3002\n\n```sql\nSELECT   items.name\nFROM     items, item_orders\nWHERE    items.item_id = item_orders.item_id\nGROUP BY items.name\nHAVING   SUM(item_orders.number) >= 3\n```\n\n\u5206\u89e3\u3059\u308b\u3068\u3053\u3046\u3044\u3046\u611f\u3058\u306b\u306a\u308a\u307e\u3059\u3002\n\n1, CROSS JOIN\n``.items[] as $item | .item_orders[] | { item: $item, item_orders: . }``\n2, INNER JOIN\n``select(.item.item_id == .item_orders.item_id)]``\n3, GROUP BY\n``group_by(.item.item_id)``\n4, HAVING\n``{ item: .[0].item, sum: (. | map(.item_orders.number) | add) } | select(.sum >= 3)``\n5, SELECT\n``{ name: .item.name }``\n\n\u6700\u65e9``jq``\u95a2\u4fc2\u306a\u3044\u3067\u3059\u304c\u3001\u521d\u5fc3\u8005\u304c\u3064\u307e\u3065\u304d\u304c\u3061\u306a``HAVING``\u3068``WHERE``\u304c\u5206\u304b\u308c\u3066\u308b\u7406\u7531\u304c\u306a\u3093\u3068\u306a\u304f\u5206\u304b\u3063\u3066\u304d\u307e\u3059\u306d\u3002\u3042\u3068SQL\u306e\u5049\u5927\u3055\u304c\u4f1d\u308f\u3063\u3066\u304d\u307e\u3059\u3002\n\n## JSON\u3092\u5206\u6790\u3059\u308b\u3068\u304d\u306e\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\n\n``@csv``\u3092\u4f7f\u3063\u3066\u3001CSV\u306b\u306f\u304d\u51fa\u3057\u3066\u3001RDBMS\u4ed8\u5c5e\u306eCSV\u30ed\u30fc\u30c0\u30fc\u304b\u3089RDB\u306b\u5165\u308c\u3066\u3001\u7d20\u76f4\u306bSQL\u305f\u305f\u304f\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059w\u3002\n\n```bash\n$ ./json \\\n| jq -r '.items[] | [.item_id, .name, .price] | @csv'\n1,\"\u3059\u3066\u304d\u306a\u96d1\u8ca8\",2500\n2,\"\u683c\u597d\u3044\u3044\u7f6e\u7269\",4500\n3,\"\u9593\u63a5\u7167\u660e\",3400\n4,\"\u5c0f\u7269\u5165\u308c\",1200\n```\n\n\u4ee5\u4e0a\u3067\u3059\u3002\n"}