{"context": "\n\n\u666e\u901a\u306f\u3053\u3046\uff1f\n\u666e\u901a\u306f\u4ee5\u4e0b\u306e\u65b9\u6cd5\u3067\u3059\u304c\u3001\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u5206\u306e\u30e1\u30e2\u30ea\u3092\u6d88\u8cbb\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\nwith open('/path/to/not-sorted-file', 'r') as fr:\n    new_lines = sorted(fr.readlines()) # \u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u5206\u30e1\u30e2\u30ea\u306b\u5c55\u958b\n\nwith open('/path/to/sorted-file', 'wb') as fw:\n    fw.write(''.join(new_lines))\n\n\n\u5927\u304d\u3044\u30b5\u30a4\u30ba\u306b\u5bfe\u5fdc\u3059\u308b\n\u95a2\u6570\u3092\u66f8\u304d\u307e\u3057\u305f\u3002\u5927\u4f53\u2193\u306e\u3088\u3046\u306a\u4e8b\u3092\u3057\u3066\u307e\u3059\u3002\n\n\u30d5\u30a1\u30a4\u30eb\u3092\u884c\u6bce\u306b\u8aad\u3080\n\u884c\u6bce\u306b\u4ee5\u4e0b\u3092\u53d6\u3063\u3066\u304a\u3044\u3066\u30011 list\u306b\u307e\u3068\u3081\u308b\n\n\n\u5404\u884c\u306efile offset\u5024\n\u30bd\u30fc\u30c8\u306e\u6bd4\u8f03\u6761\u4ef6\u306b\u3059\u308b\u5404\u884c\u306esubstring\n\n\n#2\u306elist\u3092\u30bd\u30fc\u30c8\u3059\u308b\n\u30d5\u30a1\u30a4\u30eb fr \u3092\u958b\u304d\u76f4\u3059\n\u66f8\u304d\u8fbc\u307f\u69d8\u306e\u30d5\u30a1\u30a4\u30eb fw \u3092\u958b\u304f\n#3\u306elist\u3092foreach\u3057\u3001\u30d5\u30a1\u30a4\u30eb fr \u306e\u4f4d\u7f6e\u3092file offset\u5024\u306e\u7b87\u6240\u306b\u79fb\u52d5\u3059\u308b\n\nline = fr.readline() \u3059\u308b\n\nfw.write(line) \u3059\u308b\n\n\n\u3053\u306e\u65b9\u6cd5\u3060\u3068 \"substring x \u884c\u6570\" \u5206\u306f\u30e1\u30e2\u30ea\u3092\u6d88\u8cbb\u3057\u3066\u3057\u307e\u3046\u306e\u304c\u3001\u3044\u305f\u3060\u3051\u306a\u3044\u3068\u3053\u308d (;_;)\n\nimport os\nimport uuid\nimport tempfile\n\ndef sort_large_file(filename, key=lambda l: l[:5]):\n    '''\n    sort large file without on-memory.\n\n    :param str filename: abspath of file.\n    :param function key: the function makes sort-key from a line.\n    '''\n    # \u30bd\u30fc\u30c8\u524d\u30d5\u30a1\u30a4\u30eb\u3092\u9000\u907f\u3059\u308b.\n    tmpname = os.path.join(tempfile.gettempdir(), 'sortlargefile_%s' % (uuid.uuid4().get_hex()))\n    os.rename(filename, tmpname)\n\n    # make a list of offsets.\n    offset_list = []\n    with open(tmpname, 'r') as fr:\n        while True:\n            offset = fr.tell()\n            line = fr.readline()\n            if not line:\n                break\n\n            keyword = key(line)\n            offset_list.append((keyword, offset, ))\n\n    # sort offsets.\n    offset_list.sort(key=lambda e: e[0])\n\n    # sort (write to new file).\n    with open(filename, 'wb') as fw, open(tmpname, 'r') as fr:\n        for keyword, offset in offset_list:\n            fr.seek(offset)\n            line = fr.readline()\n            fw.write(line)\n\n    # remove tmp.\n    os.remove(tmpname)\n\n\n\u5b9f\u969b\u306b\u8a66\u3057\u3066\u307f\u308b\n\u4ee5\u4e0b\u306e\u69d8\u306b\u95a2\u6570\u3092\u547c\u3073\u307e\u3059\u3002\n\n\u7b2c1\u5f15\u6570\u306f\u30bd\u30fc\u30c8\u5bfe\u8c61\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9\u3067\u3059\u3002\n\u7b2c2\u5f15\u6570\u306f\u300c1\u884c\u3092\u5f15\u6570\u306b\u3068\u3063\u3066\u3001\u30bd\u30fc\u30c8\u306e\u6bd4\u8f03\u6761\u4ef6\u306b\u306a\u308bsubstring\u3092\u8fd4\u3059\u300d\u95a2\u6570\u3067\u3059\u3002\n\n\n\u3053\u3053\u3067\u306f\u3001CSV\u884c\u306e1\u5217\u76ee\u306e\u8981\u7d20\u3092\u5207\u308a\u51fa\u3059lambda\u3092\u4e0e\u3048\u3066\u3044\u307e\u3059\u3002\n\n\n\n> sort_large_file('/path/to/your/file', lambda l: l[:l.find(',')])\n\n\u2193\u3082\u3068\u306eCSV\u3067\u3059\u3002\n2016-10-01,apple,red\n2016-09-29,orange,orange\n2015-12-21,banana,yellow\n\n\n\nsort_large_file()\u95a2\u6570\u306f\u6700\u7d42\u884c\u306b\u3082\u6539\u884c\u304c\u5fc5\u8981\u3002\n\n\u2193\u30bd\u30fc\u30c8\u3055\u308c\u3066\u3053\u3046\u306a\u308a\u307e\u3059\u3002\n2015-12-21,banana,yellow\n2016-09-29,orange,orange\n2016-10-01,apple,red\n\n\n## \u666e\u901a\u306f\u3053\u3046\uff1f\n\n\u666e\u901a\u306f\u4ee5\u4e0b\u306e\u65b9\u6cd5\u3067\u3059\u304c\u3001\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u5206\u306e\u30e1\u30e2\u30ea\u3092\u6d88\u8cbb\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n```py\nwith open('/path/to/not-sorted-file', 'r') as fr:\n    new_lines = sorted(fr.readlines()) # \u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u5206\u30e1\u30e2\u30ea\u306b\u5c55\u958b\n\nwith open('/path/to/sorted-file', 'wb') as fw:\n    fw.write(''.join(new_lines))\n```\n\n## \u5927\u304d\u3044\u30b5\u30a4\u30ba\u306b\u5bfe\u5fdc\u3059\u308b\n\n\u95a2\u6570\u3092\u66f8\u304d\u307e\u3057\u305f\u3002\u5927\u4f53\u2193\u306e\u3088\u3046\u306a\u4e8b\u3092\u3057\u3066\u307e\u3059\u3002\n\n1. \u30d5\u30a1\u30a4\u30eb\u3092\u884c\u6bce\u306b\u8aad\u3080\n2. \u884c\u6bce\u306b\u4ee5\u4e0b\u3092\u53d6\u3063\u3066\u304a\u3044\u3066\u30011 list\u306b\u307e\u3068\u3081\u308b\n\t* \u5404\u884c\u306efile offset\u5024\n\t* \u30bd\u30fc\u30c8\u306e\u6bd4\u8f03\u6761\u4ef6\u306b\u3059\u308b\u5404\u884c\u306esubstring\n3. #2\u306elist\u3092\u30bd\u30fc\u30c8\u3059\u308b\n4. \u30d5\u30a1\u30a4\u30eb ``fr`` \u3092\u958b\u304d\u76f4\u3059\n5. \u66f8\u304d\u8fbc\u307f\u69d8\u306e\u30d5\u30a1\u30a4\u30eb ``fw`` \u3092\u958b\u304f\n5. #3\u306elist\u3092foreach\u3057\u3001\u30d5\u30a1\u30a4\u30eb ``fr`` \u306e\u4f4d\u7f6e\u3092file offset\u5024\u306e\u7b87\u6240\u306b\u79fb\u52d5\u3059\u308b\n6. ``line = fr.readline()`` \u3059\u308b\n7. ``fw.write(line)`` \u3059\u308b\n\n> \u3053\u306e\u65b9\u6cd5\u3060\u3068 \"substring x \u884c\u6570\" \u5206\u306f\u30e1\u30e2\u30ea\u3092\u6d88\u8cbb\u3057\u3066\u3057\u307e\u3046\u306e\u304c\u3001\u3044\u305f\u3060\u3051\u306a\u3044\u3068\u3053\u308d (;_;)\n\n```py\nimport os\nimport uuid\nimport tempfile\n\ndef sort_large_file(filename, key=lambda l: l[:5]):\n    '''\n    sort large file without on-memory.\n\n    :param str filename: abspath of file.\n    :param function key: the function makes sort-key from a line.\n    '''\n    # \u30bd\u30fc\u30c8\u524d\u30d5\u30a1\u30a4\u30eb\u3092\u9000\u907f\u3059\u308b.\n    tmpname = os.path.join(tempfile.gettempdir(), 'sortlargefile_%s' % (uuid.uuid4().get_hex()))\n    os.rename(filename, tmpname)\n\n    # make a list of offsets.\n    offset_list = []\n    with open(tmpname, 'r') as fr:\n        while True:\n            offset = fr.tell()\n            line = fr.readline()\n            if not line:\n                break\n\n            keyword = key(line)\n            offset_list.append((keyword, offset, ))\n\n    # sort offsets.\n    offset_list.sort(key=lambda e: e[0])\n\n    # sort (write to new file).\n    with open(filename, 'wb') as fw, open(tmpname, 'r') as fr:\n        for keyword, offset in offset_list:\n            fr.seek(offset)\n            line = fr.readline()\n            fw.write(line)\n\n    # remove tmp.\n    os.remove(tmpname)\n```\n\n## \u5b9f\u969b\u306b\u8a66\u3057\u3066\u307f\u308b\n\n\u4ee5\u4e0b\u306e\u69d8\u306b\u95a2\u6570\u3092\u547c\u3073\u307e\u3059\u3002\n\n* \u7b2c1\u5f15\u6570\u306f\u30bd\u30fc\u30c8\u5bfe\u8c61\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9\u3067\u3059\u3002\n* \u7b2c2\u5f15\u6570\u306f\u300c1\u884c\u3092\u5f15\u6570\u306b\u3068\u3063\u3066\u3001\u30bd\u30fc\u30c8\u306e\u6bd4\u8f03\u6761\u4ef6\u306b\u306a\u308bsubstring\u3092\u8fd4\u3059\u300d\u95a2\u6570\u3067\u3059\u3002\n    * \u3053\u3053\u3067\u306f\u3001CSV\u884c\u306e1\u5217\u76ee\u306e\u8981\u7d20\u3092\u5207\u308a\u51fa\u3059lambda\u3092\u4e0e\u3048\u3066\u3044\u307e\u3059\u3002\n\n\n```pycon\n> sort_large_file('/path/to/your/file', lambda l: l[:l.find(',')])\n```\n\n\u2193\u3082\u3068\u306eCSV\u3067\u3059\u3002\n\n```csv\n2016-10-01,apple,red\n2016-09-29,orange,orange\n2015-12-21,banana,yellow\n\n```\n\n> sort_large_file()\u95a2\u6570\u306f\u6700\u7d42\u884c\u306b\u3082\u6539\u884c\u304c\u5fc5\u8981\u3002\n\n\u2193\u30bd\u30fc\u30c8\u3055\u308c\u3066\u3053\u3046\u306a\u308a\u307e\u3059\u3002\n\n```csv\n2015-12-21,banana,yellow\n2016-09-29,orange,orange\n2016-10-01,apple,red\n\n```\n", "tags": ["Python", "sort"]}