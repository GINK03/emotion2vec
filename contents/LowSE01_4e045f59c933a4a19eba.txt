{"context": "\n\n\u524d\u63d0\n\nJenkins\u304c\u7a3c\u50cd\u3057\u3066\u3044\u308b\nJenkins\u5b9f\u884c\u30e6\u30fc\u30b6\u30fc\u306f\u8a8d\u8a3c\u306a\u3057\u306bsudo\u304c\u53ef\u80fd\nJenkins\u5b9f\u884c\u30e6\u30fc\u30b6\u30fc\u306f/var/backup\u306b\u66f8\u304d\u8fbc\u307f\u53ef\u80fd\n\n\n\u6e96\u5099\n\n\nJenkins\u306bthinBackup\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5c0e\u5165\n\n\nthinBackup\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u8a2d\u5b9a\n\n\n\ncategory\nitem\nvalue\n\n\n\n\nBackup settings\n\n\n\n\n\nBackup directory\n/var/backup/jenkins\n\n\n\nBackup schedule for full backups\n\n\n\n\nBackup schedule for differential backups\n\n\n\n\nMax number of backup sets\n\n\n\n\nFiles excluded from backup (regular expression)\n\n\n\n\nWait until Jenkins/Hudson is idle to perform a backup\n\n\n\n\nBackup build results\n\n\n\n\nBackup 'userContent' folder\n\n\n\n\nBackup next build number file\n\n\n\n\nClean up differential backups\n\n\n\n\nMove old backups to ZIP files\non\n\n\n\n\n\n\n\n\n\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u5b9f\u884cShell\n\n\n\u300c\u30d3\u30eb\u30c9\u300d>\u300c\u30b7\u30a7\u30eb\u306e\u5b9f\u884c\u300d\u3078\u4e0b\u8a18\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u8a2d\u5b9a\n# -----------------------------------------------------\n#   paramters \n# -----------------------------------------------------\n\n# thinBackup\u306b\u6307\u5b9a\u3057\u305f\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u5148\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\nTHINBACKUP_DIR=/var/backup/jenkins\n\n# bitbucket\u8a8d\u8a3c&\u30ec\u30dd\u30b8\u30c8\u30ea\u60c5\u5831\nGIT_USERNAME=\"your-git-username\"\nGIT_PASSWORD=\"your-git-password\"\nGIT_REPOSITORY=\"your-git-repository\"\nGIT_URL=\"https://${GIT_USERNAME}:${GIT_PASSWORD}@path/to/your/git/repository.git\"\n\n# jenkins\u8a8d\u8a3c\u60c5\u5831\n# \u8a8d\u8a3c\u4e0d\u8981\u306e\u5834\u5408\u306f\u30e6\u30fc\u30b6\u30fc\u540d\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u5171\u306b\u7a7a\u6587\u5b57\u3092\u8a2d\u5b9a\nJENKINS_USERNAME=\"your-jenkins-username\"\nJENKINS_PASSWORD=\"your-jenkins-password\"\nJENKINS_URL=\"http://localhost:8080\"\n\n# -----------------------------------------------------\n#   begin \n# -----------------------------------------------------\n\n# =====================================\n#   Git clone\n# =====================================\n#rm -rf ${WORKSPACE}/${GIT_REPOSITORY}\nrm -rf ${THINBACKUP_DIR}\ngit clone ${GIT_URL} ${THINBACKUP_DIR}\nsudo chown -R jenkins:jenkins ${THINBACKUP_DIR}\n\n# thinBackup execute\n\n# Jenkins\u8a8d\u8a3c\u304c\u5fc5\u8981\u306a\u5834\u5408\nif [ -n \"${JENKINS_USERNAME}\" ] && [ -n \"${JENKINS_PASSWORD}\" ] ; then\n    curl -X POST ${JENKINS_URL}/j_acegi_security_check -d \"j_username=${JENKINS_USERNAME}&j_password=${JENKINS_PASSWORD}\" -c ./cookie.txt\n    curl -X GET  ${JENKINS_URL}/thinBackup/backupManual -b ./cookie.txt\n\n# Jenkins\u8a8d\u8a3c\u304c\u4e0d\u8981\u306a\u5834\u5408\nelse\n    curl -X GET  ${JENKINS_URL}/thinBackup/backupManual\nfi\n\nsleep 5\n\n# =====================================\n#   Git commit & push\n# =====================================\n\ncd ${THINBACKUP_DIR}\n\n# make rollback point\n\necho \"*** make rollback point ***\"\necho \"build #${BUILD_NUMBER}\" > ${THINBACKUP_DIR}/build_number.txt\n\ngit add -A\n\nGIT_DIFF_ROLLBACK=`git status -s | wc -l`\nif [ \"${GIT_DIFF_ROLLBACK}\" != 0 ] ; then\n    git commit -a -m \"make rollback point - build #${BUILD_NUMBER}\"\n    git push origin master\nfi;\n\n# log trunk modified\n\necho \"*** log trunk modified ***\"\n# trunk\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092FULL-*\u306e\u5185\u5bb9\u3067\u7f6e\u304d\u63db\u3048\u308b\u3002\nrm -rf ${THINBACKUP_DIR}/trunk\ncp -r FULL-* ${THINBACKUP_DIR}/trunk\n\ngit add -A\n\nGIT_DIFF_MODIFIED=`git status -s | wc -l`\nif [ \"${GIT_DIFF_MODIFIED}\" != 0 ] ; then\n    git commit -a -m \"log trunk modified - build #${BUILD_NUMBER}\"\n    git push origin master\nfi;\n\n\n\n\n\n## \u524d\u63d0\n* Jenkins\u304c\u7a3c\u50cd\u3057\u3066\u3044\u308b\n* Jenkins\u5b9f\u884c\u30e6\u30fc\u30b6\u30fc\u306f\u8a8d\u8a3c\u306a\u3057\u306bsudo\u304c\u53ef\u80fd\n* Jenkins\u5b9f\u884c\u30e6\u30fc\u30b6\u30fc\u306f/var/backup\u306b\u66f8\u304d\u8fbc\u307f\u53ef\u80fd\n\n## \u6e96\u5099\n* Jenkins\u306bthinBackup\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5c0e\u5165\n\t* thinBackup\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u8a2d\u5b9a\n\n\t\t|category|item|value|\n\t\t|:--|:--|:--|\n\t\t|Backup settings|||\n\t\t||Backup directory|/var/backup/jenkins|\n\t\t||Backup schedule for full backups||\n\t\t||Backup schedule for differential backups||\n\t\t||Max number of backup sets||\n\t\t||Files excluded from backup (regular expression)||\n\t\t||Wait until Jenkins/Hudson is idle to perform a backup||\n\t\t||Backup build results||\n\t\t||Backup 'userContent' folder||\n\t\t||Backup next build number file||\n\t\t||Clean up differential backups||\n\t\t||Move old backups to ZIP files|on|\n\t\n## \u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u5b9f\u884cShell\n\n* \u300c\u30d3\u30eb\u30c9\u300d>\u300c\u30b7\u30a7\u30eb\u306e\u5b9f\u884c\u300d\u3078\u4e0b\u8a18\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u8a2d\u5b9a\n\n\t```bash\n\t# -----------------------------------------------------\n\t#\tparamters \n\t# -----------------------------------------------------\n\t\n\t# thinBackup\u306b\u6307\u5b9a\u3057\u305f\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u5148\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n\tTHINBACKUP_DIR=/var/backup/jenkins\n\t\n\t# bitbucket\u8a8d\u8a3c&\u30ec\u30dd\u30b8\u30c8\u30ea\u60c5\u5831\n\tGIT_USERNAME=\"your-git-username\"\n\tGIT_PASSWORD=\"your-git-password\"\n\tGIT_REPOSITORY=\"your-git-repository\"\n\tGIT_URL=\"https://${GIT_USERNAME}:${GIT_PASSWORD}@path/to/your/git/repository.git\"\n\t\n\t# jenkins\u8a8d\u8a3c\u60c5\u5831\n\t# \u8a8d\u8a3c\u4e0d\u8981\u306e\u5834\u5408\u306f\u30e6\u30fc\u30b6\u30fc\u540d\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u5171\u306b\u7a7a\u6587\u5b57\u3092\u8a2d\u5b9a\n\tJENKINS_USERNAME=\"your-jenkins-username\"\n\tJENKINS_PASSWORD=\"your-jenkins-password\"\n\tJENKINS_URL=\"http://localhost:8080\"\n\t\n\t# -----------------------------------------------------\n\t#\tbegin \n\t# -----------------------------------------------------\n\t\n\t# =====================================\n\t# \tGit clone\n\t# =====================================\n\t#rm -rf ${WORKSPACE}/${GIT_REPOSITORY}\n\trm -rf ${THINBACKUP_DIR}\n\tgit clone ${GIT_URL} ${THINBACKUP_DIR}\n\tsudo chown -R jenkins:jenkins ${THINBACKUP_DIR}\n\t\n\t\n\t# thinBackup execute\n\t\n\t# Jenkins\u8a8d\u8a3c\u304c\u5fc5\u8981\u306a\u5834\u5408\n\tif [ -n \"${JENKINS_USERNAME}\" ] && [ -n \"${JENKINS_PASSWORD}\" ] ; then\n\t\tcurl -X POST ${JENKINS_URL}/j_acegi_security_check -d \"j_username=${JENKINS_USERNAME}&j_password=${JENKINS_PASSWORD}\" -c ./cookie.txt\n\t\tcurl -X GET  ${JENKINS_URL}/thinBackup/backupManual -b ./cookie.txt\n\t\n\t# Jenkins\u8a8d\u8a3c\u304c\u4e0d\u8981\u306a\u5834\u5408\n\telse\n\t\tcurl -X GET  ${JENKINS_URL}/thinBackup/backupManual\n\tfi\n\t\n\tsleep 5\n\t\n\t# =====================================\n\t#\tGit commit & push\n\t# =====================================\n\t\n\tcd ${THINBACKUP_DIR}\n\t\n\t# make rollback point\n\t\n\techo \"*** make rollback point ***\"\n\techo \"build #${BUILD_NUMBER}\" > ${THINBACKUP_DIR}/build_number.txt\n\t\n\tgit add -A\n\t\n\tGIT_DIFF_ROLLBACK=`git status -s | wc -l`\n\tif [ \"${GIT_DIFF_ROLLBACK}\" != 0 ] ; then\n\t\tgit commit -a -m \"make rollback point - build #${BUILD_NUMBER}\"\n\t\tgit push origin master\n\tfi;\n\t\n\t\n\t# log trunk modified\n\t\n\techo \"*** log trunk modified ***\"\n\t# trunk\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092FULL-*\u306e\u5185\u5bb9\u3067\u7f6e\u304d\u63db\u3048\u308b\u3002\n\trm -rf ${THINBACKUP_DIR}/trunk\n\tcp -r FULL-* ${THINBACKUP_DIR}/trunk\n\t\n\tgit add -A\n\t\n\tGIT_DIFF_MODIFIED=`git status -s | wc -l`\n\tif [ \"${GIT_DIFF_MODIFIED}\" != 0 ] ; then\n\t\tgit commit -a -m \"log trunk modified - build #${BUILD_NUMBER}\"\n\t\tgit push origin master\n\tfi;\n\t\n\t```\n", "tags": ["bitbucket", "\u30d0\u30c3\u30af\u30a2\u30c3\u30d7", "Jenkins", "Git", "shell"]}