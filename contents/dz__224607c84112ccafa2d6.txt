{"tags": ["AWS", "IAM", "EC2", "fluentd"], "context": " More than 1 year has passed since last update.\u3053\u3093\u306b\u3061\u306f\u3001cloudpack \u306e @dz_ \u3053\u3068\u5927\u5e73\u304b\u3065\u307f\u3067\u3059\u3002\n\nPrologue - \u306f\u3058\u3081\u306b\n\u4eca\u56de\u306f\u3001Fluentd \u304b\u3089 Amazon S3 \u3078\u306e\u30ed\u30b0\u3092\u9001\u3063\u3066\u307f\u307e\u3059\u3002\nS3 \u3078\u306e\u51fa\u529b\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067 out_s3 \u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u30bb\u30ad\u30e5\u30a2\u306a\u901a\u4fe1\u306b\u3059\u308b\u306b\u306f\u3001Credentials ( aws_key_id \u3068 aws_sec_key ) \u3092\u8a2d\u5b9a\u3059\u308c\u3070\u3088\u3044\u306e\u3067\u3059\u304c\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b Creadentials \u3092\u8a18\u8f09\u3059\u308b\u306e\u306f\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u3084\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u306e\u70b9\u3067\u4e0d\u4fbf\u3067\u3059\u3002\n\u305d\u3053\u3067\u3001AWS\u304c\u63d0\u4f9b\u3059\u308b AWS IAM \u306e\u6a5f\u80fd\u3092\u5229\u7528\u3057\u3066\u3001Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3068 Amazon S3 \u306e\u901a\u4fe1\u3092\u5236\u9650\u3057\u3001\u4e0a\u8a18\u3092\u5b9f\u73fe\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n[\u4f59\u8ac7] \u5b9f\u306f\u3001\u8d77\u52d5\u4e2d\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u306fIAM\u30ed\u30fc\u30eb\u3092\u4ed8\u4e0e\u3067\u304d\u306a\u3044\u2026\u306e\u3067\u3059\u3088\u2026\n\u305a\u3063\u3068\u60a9\u3093\u3067\u3044\u305f\u3093\u3067\u3059\u3002\u524d\u56de\u4f5c\u3063\u305f Fluentd \u8d77\u52d5\u4e2d\u306e\u30b5\u30fc\u30d0\u30fc\u306b IAM\u30ed\u30fc\u30eb\u3092\u4ed8\u4e0e\u3057\u305f\u3044\u306e\u306b\u3001AWS\u30b3\u30f3\u30bd\u30fc\u30eb\u306e\u3069\u3053\u3092\u63a2\u3057\u3066\u3082\u8a2d\u5b9a\u3067\u304d\u308b\u5834\u6240\u304c\u306a\u3044\u2026 (\u6c57)\nIAM\u30ed\u30fc\u30eb\u306f\u3001Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\u6642\u306b\u3057\u304b\u4ed8\u4e0e\u3067\u304d\u307e\u305b\u3093\u3002\n\u30dd\u30fc\u30f3 ((=\u03c9=))\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u308a\u76f4\u3057\u307e\u3057\u305f\u2026\uff01\n\n\u4f5c\u696d\u30a4\u30e1\u30fc\u30b8\n\u306a\u306b\u306f\u3068\u3082\u3042\u308c\u3001\u5b9f\u8df5\u3067\u3059\u2606\n\nAmazon S3 \u30d0\u30b1\u30c3\u30c8\u3092\u4f5c\u6210\u3059\u308b\n\u3053\u306eS3\u30d0\u30b1\u30c3\u30c8\u3078\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u3092\u6301\u3063\u305fIAM\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3059\u308b\nAmazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u6642\u306b\u3001IAM\u30ed\u30fc\u30eb\u3092\u8a2d\u5b9a\u3059\u308b\nFluentd \u306e out_s3 \u30d7\u30e9\u30b0\u30a4\u30f3\u3067 S3 \u306b\u30ed\u30b0\u3092\u66f8\u304d\u51fa\u3059\n\n\n\u624b\u9806\u306e\u30dd\u30a4\u30f3\u30c8\n\n1. Amazon S3 \u306e\u30d0\u30b1\u30c3\u30c8\u3092\u4f5c\u6210\u3059\u308b\nAWS\u30b3\u30f3\u30bd\u30fc\u30eb\u306a\u3069\u3092\u5229\u7528\u3057\u3066\u3001\u4efb\u610f\u306e\u30d0\u30b1\u30c3\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n2. IAM\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3059\u308b\n\n\n\n\n\n\n\n\n\nIAM\u30dd\u30ea\u30b7\u30fc\u306b\u306f\u4f55\u3092\u8a2d\u5b9a\u3059\u308b\u306e\uff1f\n\u306a\u3093\u3068\u3082\u3042\u308a\u304c\u305f\u3044\u3053\u3068\u306b\u3001Fluentd\u30de\u30b9\u30bf\u30fc @inokara \u5927\u5148\u8f29\u304c\u3001\u30d2\u30f3\u30c8\u3092\u6559\u3048\u3066\u304f\u3060\u3055\u3044\u307e\u3057\u305f\uff01\u3053\u3061\u3089\u2193\u306e fluent-plugin-s3 \u306egithub\u306b\u8a2d\u5b9a\u3059\u3079\u304dIAM\u30dd\u30ea\u30b7\u30fc\u304c\u63b2\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nfluent/fluent-plugin-s3 \u00b7 GitHub\n\n\n{ \"Statement\": [\n { \"Effect\":\"Allow\",\n   \"Action\":\"s3:*\",\n   \"Resource\":\"arn:aws:s3:::my-s3bucket*\"\n  } ]\n}\n\n\n\u3053\u308c\u3092\u8a2d\u5b9a\u3057\u307e\u3057\u3087\u3046\u3002 my-s3bucket \u306e\u90e8\u5206\u306f\u3001\u4e0a\u8a18\u3067\u4f5c\u6210\u3057\u305f\u30d0\u30b1\u30c3\u30c8\u540d\u306b\u7f6e\u63db\u3048\u3066\u4e0b\u3055\u3044\u3002\n\n\n3. Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u6642\u306b\u3001IAM\u30ed\u30fc\u30eb\u3092\u8a2d\u5b9a\u3059\u308b\n\u3055\u3066\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u308a\u76f4\u3057\u3066\u3001IAM\u30ed\u30fc\u30eb\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\u3053\u3053\u307e\u3067\u304f\u308c\u3070\u3001\u6b8b\u308a\u306e\u4f5c\u696d\u306f\u7c21\u5358\u3067\u3059\uff01\n\n4. Fluentd \u306e out_s3 \u30d7\u30e9\u30b0\u30a4\u30f3\u3067 S3 \u306b\u30ed\u30b0\u3092\u66f8\u304d\u51fa\u3059\n\nout_s3 \u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u6e96\u5099\n\u4eca\u56de\u4f7f\u3046 out_s3 \u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u3001td-agent \u306b\u306f\u542b\u307e\u308c\u3066\u3044\u308b\u306e\u3067\u5927\u4e08\u592b\u3067\u3059\u3002\u3082\u3057 Fluentd gem \u3092\u5229\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u5225\u9014\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n# Fluentd gem \u306b fluent-plugin-s3 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nfluent-gem install fluent-plugin-s3\n\n\n\u30d0\u30c3\u30d5\u30a1\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\n\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u69cb\u308f\u306a\u3044\u306e\u3067\u3059\u304c\u3001td-agent\u304c\u8aad\u307f\u66f8\u304d\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u6240\u6709\u8005\u3092 td-agent \u306b\u5909\u66f4\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n# \u30d0\u30c3\u30d5\u30a1\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\nmkdir /var/log/fluent\nchown -R td-agent:td-agent /var/log/fluent\n\n\nFluentd \u306e\u8a2d\u5b9a\nFluentd \u306b out_s3 \u306e\u8a2d\u5b9a\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306f\u3001 s3.** \u306b\u4e00\u81f4\u3059\u308b\u30ed\u30b0\u3092\u3001S3 \u306b\u8ee2\u9001\u3057\u307e\u3059\u3002\n\n/etc/td-agent/td-agent.conf\n...\n# \u4ee5\u4e0b\u3092\u8ffd\u52a0\n<match s3.**>\n  type s3\n  s3_bucket my-s3bucket\n  buffer_path /var/log/fluent/s3\n</match>\n\n\n\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u540d\n\u8a2d\u5b9a\u5024\n\u8aac\u660e\n\n\n\ntype\ns3\nout_s3 \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u6307\u5b9a\n\n\ns3_bucket\nS3\u30d0\u30b1\u30c3\u30c8\u540d\n\u30ed\u30b0\u9001\u4fe1\u5148\u306eS3\u30d0\u30b1\u30c3\u30c8\u540d\u3092\u6307\u5b9a\n\n\nbuffer_path\n\u30d0\u30c3\u30d5\u30a1\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30d1\u30b9\n\u4e0a\u8a18\u3067\u7528\u610f\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\n\n\n\n\u3053\u308c\u3067\u6e96\u5099\u5b8c\u4e86\u3067\u3059\u3002\n\n\u30ed\u30b0\u3092\u9001\u4fe1\u3057\u3066\u307f\u3088\u3046\uff01\n\u3053\u306e http\u304b\u3089\u30ed\u30b0\u3092\u9001\u4fe1\u3057\u3066\u307f\u308b \u3092\u53c2\u8003\u306b\u3001 s3.** \u306e\u30bf\u30b0\u3092\u3064\u3051\u3066\u30ed\u30b0\u3092\u9001\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n# HTTP\u304b\u3089\u30ed\u30b0\u3092\u9001\u4fe1\u3057\u3066\u307f\u308b\ncurl -X POST -d 'json={\"json\":\"message to s3!\"}' http://localhost:8888/s3.test\n\n# \u9001\u4fe1\u76f4\u5f8c\u306f\u307e\u3060\u30d0\u30c3\u30d5\u30a1\u306b\u683c\u7d0d\u3055\u308c\u305f\u307e\u307e\u3067\u3059\nls /var/log/fluent/\ns3.201504061559.b5131063452159925.log\n\n# \u4e2d\u8eab\u306b\u306f\u9001\u3063\u305f\u30ed\u30b0\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\ncat /var/log/fluent/s3.201504061559.b5131063452159925.log\n2015-04-06T15:59:49+00:00   s3.test {\"json\":\"message to s3!\"}\n\n\u3053\u306e\u5f8c\u30011\u6642\u9593\u307b\u3069\u5f85\u3066\u3070 S3 \u306b\u53ce\u307e\u308a\u307e\u3059\u3002\n\n\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30c8\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3092\u8a2d\u5b9a\u3059\u308b\nS3\u306b\u683c\u7d0d\u3055\u308c\u308b\u307e\u30671\u6642\u9593\u5f85\u3064\u306e\u306f\u9577\u3044\uff01\u306e\u3067\u3001\u30bf\u30a4\u30e0\u30b9\u30e9\u30a4\u30b9\u3092\u5909\u66f4\u3057\u3066\u30011\u5206\u6bce\u306b\u30ed\u30b0\u304cS3\u306b\u683c\u7d0d\u3055\u308c\u308b\u3088\u3046\u306b\u8abf\u6574\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n/etc/td-agent/td-agent.conf\n<match s3.**>\n  type s3\n  s3_bucket my-s3bucket\n  buffer_path /var/log/fluent/s3\n  time_slice_format %Y%m%d%H%M    # \u2190 \u30bf\u30a4\u30e0\u30b9\u30e9\u30a4\u30b9\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\n</match>\n\n\n\n\u3069\u308c\u3069\u308c\u3001S3\u3067\u78ba\u8a8d\u3057\u3066\u307f\u308b\n\n\n\u30ad\u30bf\u30fc\u30fc\u30fc\u30fc\uff01\uff01\uff01(*'\u03c9'*)\n\u7121\u4e8b\u3001\u30bf\u30a4\u30e0\u30b9\u30e9\u30a4\u30b9\u306e\u30eb\u30fc\u30eb\u306b\u5f93\u3063\u305f\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u307e\u3057\u305f\u3088\u2606\n\u203b 3\u756a\u76ee\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u304c\u305d\u308c\u3067\u3059\u3002\u4e0a2\u3064\u306f\u8a2d\u5b9a\u306b\u30df\u30b9\u3057\u3066H\u304c\u6df7\u5165\u3057\u3066\u3044\u307e\u3059(\u7b11)\n\nEpilogue - \u304a\u308f\u308a\u306b\n\u4eca\u56de\u306f\u3001IAM\u30ed\u30fc\u30eb\u9069\u7528\u306e\u305f\u3081\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u308a\u76f4\u3055\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001AWS\u901a\u306e\u4e2d\u3067\u306f\u3042\u308b\u3042\u308b\u30ce\u30a6\u30cf\u30a6\u3060\u3063\u305f\u3088\u3046\u3067\u3059\u3002\u307e\u3060\u307e\u3060\u5965\u304c\u6df1\u3044\u3067\u3059\uff01\u7cbe\u9032\u3057\u307e\u3059\uff01\n\n\u8fd1\u6cc1\n\nPhalcon\u95a2\u9023\n\n\u7206\u901f\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af!! Phalcon PHP Framework\nMeet Volt ! Phalcon \u8b39\u88fd\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3 Volt - from \u7b2c71\u56de PHP\u52c9\u5f37\u4f1a\nMeet Phalcon! - Phalcon PHP\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092 Nginx on Amazon EC2 \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff01\n\n\nfluentd\u95a2\u9023\n\n\nCheck! \u306f\u3058\u3081\u3066\u306e fluentd \u3092 Amazon Linux \u3067\u52d5\u304b\u3057\u3066\u307f\u308b (\u30ed\u30b0\u3092 PHP \u304b\u3089\u9001\u308b) \u2190  \n\n\n\nAmazon ECS\u95a2\u9023\n\nCheck! Amazon EC2 Container Service \u3067 Docker \u3092\u5b66\u3073\u305f\u3044\uff01(\u6e96\u5099\u7de8)\nCheck! Amazon EC2 Container Service \u3067 Docker \u3092\u5b66\u3073\u305f\u3044\uff01 (IAM\u30dd\u30ea\u30b7\u30fc\u7de8)\n\n\n\u6280\u8853\u30d6\u30ed\u30b0\u5bc4\u7a3f\ncloudpack\u6280\u8853\u30d6\u30ed\u30b0\u3067\u3082\u3001AWS Lambda \u3084 \u904b\u7528\u30c4\u30fc\u30eb Serf \u306b\u95a2\u3057\u3066\u8a18\u4e8b\u3092\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\u3054\u8208\u5473\u3042\u308c\u3070\u8aad\u3093\u3067\u3044\u305f\u3060\u3051\u308b\u3068\u5b09\u3057\u3044\u3067\u3059\uff01\n\n\u5927\u5e73 \u304b\u3065\u307f \u306e\u8a18\u4e8b\u4e00\u89a7\n\n\n\u3053\u3093\u306b\u3061\u306f\u3001[cloudpack][] \u306e @dz_ \u3053\u3068[\u5927\u5e73\u304b\u3065\u307f][]\u3067\u3059\u3002\n\nPrologue - \u306f\u3058\u3081\u306b\n=====\n\u4eca\u56de\u306f\u3001<a href=\"http://www.fluentd.org/\" title=\"Fluentd | Open Source Data Collector | Unified Logging Layer\" target=\"_blank\">Fluentd</a> \u304b\u3089 <a href=\"http://aws.amazon.com/jp/s3/\" title=\"Amazon S3 (\u30af\u30e9\u30a6\u30c9\u30b9\u30c8\u30ec\u30fc\u30b8\u30b5\u30fc\u30d3\u30b9 Amazon Simple Storage Service) | \u30a2\u30de\u30be\u30f3 \u30a6\u30a7\u30d6 \u30b5\u30fc\u30d3\u30b9\uff08AWS \u65e5\u672c\u8a9e\uff09\" target=\"_blank\">Amazon S3</a> \u3078\u306e\u30ed\u30b0\u3092\u9001\u3063\u3066\u307f\u307e\u3059\u3002\n\nS3 \u3078\u306e\u51fa\u529b\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067 <a href=\"http://docs.fluentd.org/articles/out_s3\" title=\"Amazon S3 Output Plugin | Fluentd\" target=\"_blank\">out_s3</a> \u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u30bb\u30ad\u30e5\u30a2\u306a\u901a\u4fe1\u306b\u3059\u308b\u306b\u306f\u3001Credentials ( `aws_key_id` \u3068 `aws_sec_key` ) \u3092\u8a2d\u5b9a\u3059\u308c\u3070\u3088\u3044\u306e\u3067\u3059\u304c\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b Creadentials \u3092\u8a18\u8f09\u3059\u308b\u306e\u306f\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u3084\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u306e\u70b9\u3067\u4e0d\u4fbf\u3067\u3059\u3002\n\n\u305d\u3053\u3067\u3001AWS\u304c\u63d0\u4f9b\u3059\u308b <a href=\"http://aws.amazon.com/jp/iam/\" title=\"AWS Identity and Access Management\uff08IAM \u30af\u30e9\u30a6\u30c9\u306e\u30a2\u30af\u30bb\u30b9\u30fb\u8a8d\u8a3c\u7ba1\u7406\uff09| \u30a2\u30de\u30be\u30f3 \u30a6\u30a7\u30d6 \u30b5\u30fc\u30d3\u30b9\uff08AWS \u65e5\u672c\u8a9e\uff09\" target=\"_blank\">AWS IAM</a> \u306e\u6a5f\u80fd\u3092\u5229\u7528\u3057\u3066\u3001<a href=\"http://aws.amazon.com/jp/ec2/\" title=\"Amazon EC2\uff08\u30b9\u30b1\u30fc\u30e9\u30d6\u30eb\u306a\u30af\u30e9\u30a6\u30c9\u4e0a\u306e\u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\uff09 | \u30a2\u30de\u30be\u30f3 \u30a6\u30a7\u30d6 \u30b5\u30fc\u30d3\u30b9\uff08AWS \u65e5\u672c\u8a9e\uff09\" target=\"_blank\">Amazon EC2</a> \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3068 Amazon S3 \u306e\u901a\u4fe1\u3092\u5236\u9650\u3057\u3001\u4e0a\u8a18\u3092\u5b9f\u73fe\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n[\u4f59\u8ac7] \u5b9f\u306f\u3001\u8d77\u52d5\u4e2d\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u306fIAM\u30ed\u30fc\u30eb\u3092\u4ed8\u4e0e\u3067\u304d\u306a\u3044\u2026\u306e\u3067\u3059\u3088\u2026\n====\n\u305a\u3063\u3068\u60a9\u3093\u3067\u3044\u305f\u3093\u3067\u3059\u3002<a href=\"http://qiita.com/dz_/items/960319ffffa0d7355f8c\" title=\"Check! \u306f\u3058\u3081\u3066\u306e fluentd \u3092 Amazon Linux \u3067\u52d5\u304b\u3057\u3066\u307f\u308b (\u30ed\u30b0\u3092 PHP \u304b\u3089\u9001\u308b) - Qiita\" target=\"_blank\">\u524d\u56de</a>\u4f5c\u3063\u305f Fluentd \u8d77\u52d5\u4e2d\u306e\u30b5\u30fc\u30d0\u30fc\u306b IAM\u30ed\u30fc\u30eb\u3092\u4ed8\u4e0e\u3057\u305f\u3044\u306e\u306b\u3001AWS\u30b3\u30f3\u30bd\u30fc\u30eb\u306e\u3069\u3053\u3092\u63a2\u3057\u3066\u3082\u8a2d\u5b9a\u3067\u304d\u308b\u5834\u6240\u304c\u306a\u3044\u2026 (\u6c57)\n\n__IAM\u30ed\u30fc\u30eb\u306f\u3001Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\u6642\u306b\u3057\u304b\u4ed8\u4e0e\u3067\u304d\u307e\u305b\u3093\u3002__\n\n\u30dd\u30fc\u30f3 ((=\u03c9=))\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u308a\u76f4\u3057\u307e\u3057\u305f\u2026\uff01\n\n\u4f5c\u696d\u30a4\u30e1\u30fc\u30b8\n====\n\u306a\u306b\u306f\u3068\u3082\u3042\u308c\u3001\u5b9f\u8df5\u3067\u3059\u2606\n\n1. Amazon S3 \u30d0\u30b1\u30c3\u30c8\u3092\u4f5c\u6210\u3059\u308b\n2. \u3053\u306eS3\u30d0\u30b1\u30c3\u30c8\u3078\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u3092\u6301\u3063\u305fIAM\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3059\u308b\n3. Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u6642\u306b\u3001IAM\u30ed\u30fc\u30eb\u3092\u8a2d\u5b9a\u3059\u308b\n4. Fluentd \u306e out_s3 \u30d7\u30e9\u30b0\u30a4\u30f3\u3067 S3 \u306b\u30ed\u30b0\u3092\u66f8\u304d\u51fa\u3059\n\n\u624b\u9806\u306e\u30dd\u30a4\u30f3\u30c8\n====\n\n1. Amazon S3 \u306e\u30d0\u30b1\u30c3\u30c8\u3092\u4f5c\u6210\u3059\u308b\n----\nAWS\u30b3\u30f3\u30bd\u30fc\u30eb\u306a\u3069\u3092\u5229\u7528\u3057\u3066\u3001\u4efb\u610f\u306e\u30d0\u30b1\u30c3\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n2. IAM\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3059\u308b\n----\n![20150405_fluentd-to-s3-by-iam-role_001.png](https://qiita-image-store.s3.amazonaws.com/0/3812/803361e3-95ba-6a1b-3c22-8bc4be1ca199.png)\n\n![20150405_fluentd-to-s3-by-iam-role_002.png](https://qiita-image-store.s3.amazonaws.com/0/3812/d9bc872c-61d6-7d17-5f9a-0eb61f9af82f.png)\n\n![20150405_fluentd-to-s3-by-iam-role_001-1.png](https://qiita-image-store.s3.amazonaws.com/0/3812/7b4e3bf4-fbcb-9380-50f0-f54ffcd98a26.png)\n\n![20150405_fluentd-to-s3-by-iam-role_003.png](https://qiita-image-store.s3.amazonaws.com/0/3812/bc699922-1c27-ed0b-adbc-411d5e8cee84.png)\n\n![20150405_fluentd-to-s3-by-iam-role_004.png](https://qiita-image-store.s3.amazonaws.com/0/3812/f0e67a44-aaed-f4ab-9a9d-84d6e376ae8f.png)\n\n![20150405_fluentd-to-s3-by-iam-role_005.png](https://qiita-image-store.s3.amazonaws.com/0/3812/cc86c313-5d72-1a63-9109-10416191fa92.png)\n\n![20150405_fluentd-to-s3-by-iam-role_006.png](https://qiita-image-store.s3.amazonaws.com/0/3812/8e037d76-6c83-69b3-59da-eb02bec5f229.png)\n\n![20150405_fluentd-to-s3-by-iam-role_007.png](https://qiita-image-store.s3.amazonaws.com/0/3812/15147b18-dc06-0ac9-442b-2e7a2e95a7ae.png)\n\nIAM\u30dd\u30ea\u30b7\u30fc\u306b\u306f\u4f55\u3092\u8a2d\u5b9a\u3059\u308b\u306e\uff1f\n----\n\u306a\u3093\u3068\u3082\u3042\u308a\u304c\u305f\u3044\u3053\u3068\u306b\u3001Fluentd\u30de\u30b9\u30bf\u30fc @inokara \u5927\u5148\u8f29\u304c\u3001\u30d2\u30f3\u30c8\u3092\u6559\u3048\u3066\u304f\u3060\u3055\u3044\u307e\u3057\u305f\uff01\u3053\u3061\u3089\u2193\u306e fluent-plugin-s3 \u306egithub\u306b\u8a2d\u5b9a\u3059\u3079\u304dIAM\u30dd\u30ea\u30b7\u30fc\u304c\u63b2\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n- [fluent&#x2F;fluent-plugin-s3 \u00b7 GitHub](fluentd-phttps://github.com/fluent/fluent-plugin-s3#iam-policy \"fluent/fluent-plugin-s3 \u00b7 GitHub\")\n\n> ```json\n{ \"Statement\": [\n { \"Effect\":\"Allow\",\n   \"Action\":\"s3:*\",\n   \"Resource\":\"arn:aws:s3:::my-s3bucket*\"\n  } ]\n}\n```\n\n\u3053\u308c\u3092\u8a2d\u5b9a\u3057\u307e\u3057\u3087\u3046\u3002 `my-s3bucket` \u306e\u90e8\u5206\u306f\u3001\u4e0a\u8a18\u3067\u4f5c\u6210\u3057\u305f\u30d0\u30b1\u30c3\u30c8\u540d\u306b\u7f6e\u63db\u3048\u3066\u4e0b\u3055\u3044\u3002\n![20150405_fluentd-to-s3-by-iam-role_008.png](https://qiita-image-store.s3.amazonaws.com/0/3812/cbce8a19-28c5-9e0f-2440-3848b5950da2.png)\n\n3. Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u6642\u306b\u3001IAM\u30ed\u30fc\u30eb\u3092\u8a2d\u5b9a\u3059\u308b\n----\n\u3055\u3066\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u308a\u76f4\u3057\u3066\u3001IAM\u30ed\u30fc\u30eb\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n![20150405_fluentd-to-s3-by-iam-role_009.png](https://qiita-image-store.s3.amazonaws.com/0/3812/21a338df-df83-c536-546b-8c37d74974bb.png)\n\n\u3053\u3053\u307e\u3067\u304f\u308c\u3070\u3001\u6b8b\u308a\u306e\u4f5c\u696d\u306f\u7c21\u5358\u3067\u3059\uff01\n\n4. Fluentd \u306e out_s3 \u30d7\u30e9\u30b0\u30a4\u30f3\u3067 S3 \u306b\u30ed\u30b0\u3092\u66f8\u304d\u51fa\u3059\n----\n### out_s3 \u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u6e96\u5099\n\u4eca\u56de\u4f7f\u3046 `out_s3` \u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u3001td-agent \u306b\u306f\u542b\u307e\u308c\u3066\u3044\u308b\u306e\u3067\u5927\u4e08\u592b\u3067\u3059\u3002\u3082\u3057 Fluentd gem \u3092\u5229\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u5225\u9014\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```bash\n# Fluentd gem \u306b fluent-plugin-s3 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nfluent-gem install fluent-plugin-s3\n```\n\n### \u30d0\u30c3\u30d5\u30a1\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\n\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u69cb\u308f\u306a\u3044\u306e\u3067\u3059\u304c\u3001td-agent\u304c\u8aad\u307f\u66f8\u304d\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u6240\u6709\u8005\u3092 `td-agent` \u306b\u5909\u66f4\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```bash\n# \u30d0\u30c3\u30d5\u30a1\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\nmkdir /var/log/fluent\nchown -R td-agent:td-agent /var/log/fluent\n```\n\n### Fluentd \u306e\u8a2d\u5b9a\nFluentd \u306b out_s3 \u306e\u8a2d\u5b9a\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306f\u3001 `s3.**` \u306b\u4e00\u81f4\u3059\u308b\u30ed\u30b0\u3092\u3001S3 \u306b\u8ee2\u9001\u3057\u307e\u3059\u3002\n\n```:/etc/td-agent/td-agent.conf\n...\n# \u4ee5\u4e0b\u3092\u8ffd\u52a0\n<match s3.**>\n  type s3\n  s3_bucket my-s3bucket\n  buffer_path /var/log/fluent/s3\n</match>\n```\n\n<table>\n<thead><tr><th>\u30d1\u30e9\u30e1\u30fc\u30bf\u540d</th><th>\u8a2d\u5b9a\u5024</th><th>\u8aac\u660e</th></tr></thead>\n<tbody>\n<tr><td>type</td><td>s3</td><td>out_s3 \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u6307\u5b9a</td></tr>\n<tr><td>s3_bucket</td><td>S3\u30d0\u30b1\u30c3\u30c8\u540d</td><td>\u30ed\u30b0\u9001\u4fe1\u5148\u306eS3\u30d0\u30b1\u30c3\u30c8\u540d\u3092\u6307\u5b9a</td></tr>\n<tr><td>buffer_path</td><td>\u30d0\u30c3\u30d5\u30a1\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30d1\u30b9</td><td>\u4e0a\u8a18\u3067\u7528\u610f\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a</td></tr>\n</tbody>\n</table>\n\n\u3053\u308c\u3067\u6e96\u5099\u5b8c\u4e86\u3067\u3059\u3002\n\n\u30ed\u30b0\u3092\u9001\u4fe1\u3057\u3066\u307f\u3088\u3046\uff01\n----\n\n\u3053\u306e <a href=\"http://qiita.com/dz_/items/960319ffffa0d7355f8c#http\u304b\u3089\u30ed\u30b0\u3092\u9001\u4fe1\u3057\u3066\u307f\u308b\" title=\"http\u304b\u3089\u30ed\u30b0\u3092\u9001\u4fe1\u3057\u3066\u307f\u308b - Check! \u306f\u3058\u3081\u3066\u306e fluentd \u3092 Amazon Linux \u3067\u52d5\u304b\u3057\u3066\u307f\u308b (\u30ed\u30b0\u3092 PHP \u304b\u3089\u9001\u308b) - Qiita\" target=\"_blank\">http\u304b\u3089\u30ed\u30b0\u3092\u9001\u4fe1\u3057\u3066\u307f\u308b</a> \u3092\u53c2\u8003\u306b\u3001 `s3.**` \u306e\u30bf\u30b0\u3092\u3064\u3051\u3066\u30ed\u30b0\u3092\u9001\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```bash\n# HTTP\u304b\u3089\u30ed\u30b0\u3092\u9001\u4fe1\u3057\u3066\u307f\u308b\ncurl -X POST -d 'json={\"json\":\"message to s3!\"}' http://localhost:8888/s3.test\n\n# \u9001\u4fe1\u76f4\u5f8c\u306f\u307e\u3060\u30d0\u30c3\u30d5\u30a1\u306b\u683c\u7d0d\u3055\u308c\u305f\u307e\u307e\u3067\u3059\nls /var/log/fluent/\ns3.201504061559.b5131063452159925.log\n\n# \u4e2d\u8eab\u306b\u306f\u9001\u3063\u305f\u30ed\u30b0\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\ncat /var/log/fluent/s3.201504061559.b5131063452159925.log\n2015-04-06T15:59:49+00:00\ts3.test\t{\"json\":\"message to s3!\"}\n```\n\n\u3053\u306e\u5f8c\u30011\u6642\u9593\u307b\u3069\u5f85\u3066\u3070 S3 \u306b\u53ce\u307e\u308a\u307e\u3059\u3002\n\n\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30c8\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3092\u8a2d\u5b9a\u3059\u308b\n----\nS3\u306b\u683c\u7d0d\u3055\u308c\u308b\u307e\u30671\u6642\u9593\u5f85\u3064\u306e\u306f\u9577\u3044\uff01\u306e\u3067\u3001\u30bf\u30a4\u30e0\u30b9\u30e9\u30a4\u30b9\u3092\u5909\u66f4\u3057\u3066\u30011\u5206\u6bce\u306b\u30ed\u30b0\u304cS3\u306b\u683c\u7d0d\u3055\u308c\u308b\u3088\u3046\u306b\u8abf\u6574\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n```:/etc/td-agent/td-agent.conf\n<match s3.**>\n  type s3\n  s3_bucket my-s3bucket\n  buffer_path /var/log/fluent/s3\n  time_slice_format %Y%m%d%H%M    # \u2190 \u30bf\u30a4\u30e0\u30b9\u30e9\u30a4\u30b9\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\n</match>\n```\n\n\u3069\u308c\u3069\u308c\u3001S3\u3067\u78ba\u8a8d\u3057\u3066\u307f\u308b\n----\n![20150405_fluentd-to-s3-by-iam-role_010.png](https://qiita-image-store.s3.amazonaws.com/0/3812/24b628bf-4916-6ac0-e268-e49f2a52547f.png)\n\n![20150405_fluentd-to-s3-by-iam-role_011.png](https://qiita-image-store.s3.amazonaws.com/0/3812/5abd8d28-e13b-ba24-201c-acf0a6fb0873.png)\n\n\u30ad\u30bf\u30fc\u30fc\u30fc\u30fc\uff01\uff01\uff01(\\*'\u03c9'\\*)\n\n\u7121\u4e8b\u3001\u30bf\u30a4\u30e0\u30b9\u30e9\u30a4\u30b9\u306e\u30eb\u30fc\u30eb\u306b\u5f93\u3063\u305f\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u307e\u3057\u305f\u3088\u2606\n\u203b 3\u756a\u76ee\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u304c\u305d\u308c\u3067\u3059\u3002\u4e0a2\u3064\u306f\u8a2d\u5b9a\u306b\u30df\u30b9\u3057\u3066*H*\u304c\u6df7\u5165\u3057\u3066\u3044\u307e\u3059(\u7b11)\n\nEpilogue - \u304a\u308f\u308a\u306b\n====\n\u4eca\u56de\u306f\u3001IAM\u30ed\u30fc\u30eb\u9069\u7528\u306e\u305f\u3081\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u308a\u76f4\u3055\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001AWS\u901a\u306e\u4e2d\u3067\u306f\u3042\u308b\u3042\u308b\u30ce\u30a6\u30cf\u30a6\u3060\u3063\u305f\u3088\u3046\u3067\u3059\u3002\u307e\u3060\u307e\u3060\u5965\u304c\u6df1\u3044\u3067\u3059\uff01\u7cbe\u9032\u3057\u307e\u3059\uff01\n\n\u8fd1\u6cc1\n===================================================\n\nPhalcon\u95a2\u9023\n---------------------------------------\n\n- [\u7206\u901f\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af!! Phalcon PHP Framework](\nhttp://qiita.com/dz_/items/55ae18f7fe3a873bace1 \"\u7206\u901f\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af!! Phalcon PHP Framework\")\n- [Meet Volt ! Phalcon \u8b39\u88fd\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3 Volt - from \u7b2c71\u56de PHP\u52c9\u5f37\u4f1a](http://qiita.com/dz_/items/974a90b32ba6a6e38182 \"Meet Volt ! Phalcon \u8b39\u88fd\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3 Volt - from \u7b2c71\u56de PHP\u52c9\u5f37\u4f1a\")\n- [Meet Phalcon! - Phalcon PHP\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092 Nginx on Amazon EC2 \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff01](http://qiita.com/dz_/items/e70d61487224b854b971 \"Meet Phalcon! - Phalcon PHP\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092 Nginx on Amazon EC2 \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff01\")\n\nfluentd\u95a2\u9023\n---------------------------------------\n- [Check! \u306f\u3058\u3081\u3066\u306e fluentd \u3092 Amazon Linux \u3067\u52d5\u304b\u3057\u3066\u307f\u308b (\u30ed\u30b0\u3092 PHP \u304b\u3089\u9001\u308b)](http://qiita.com/dz_/items/960319ffffa0d7355f8c \"Check! \u306f\u3058\u3081\u3066\u306e fluentd \u3092 Amazon Linux \u3067\u52d5\u304b\u3057\u3066\u307f\u308b (\u30ed\u30b0\u3092 PHP \u304b\u3089\u9001\u308b)\") \u2190 :new: :sparkles:\n\nAmazon ECS\u95a2\u9023\n---------------------------------------\n\n- [Check! Amazon EC2 Container Service \u3067 Docker \u3092\u5b66\u3073\u305f\u3044\uff01(\u6e96\u5099\u7de8)][my-amazon-ecs-docker-vol1]\n- [Check! Amazon EC2 Container Service \u3067 Docker \u3092\u5b66\u3073\u305f\u3044\uff01 (IAM\u30dd\u30ea\u30b7\u30fc\u7de8)][my-amazon-ecs-docker-vol2]\n\n[my-amazon-ecs-docker-vol1]:http://qiita.com/dz_/items/625f55bc5de371d15caa \"Check! Amazon EC2 Container Service \u3067 Docker \u3092\u5b66\u3073\u305f\u3044\uff01(\u6e96\u5099\u7de8)\"\n[my-amazon-ecs-docker-vol2]:http://qiita.com/dz_/items/44388a0908f8d18fe42d \"Check! Amazon EC2 Container Service \u3067 Docker \u3092\u5b66\u3073\u305f\u3044\uff01(IAM\u30dd\u30ea\u30b7\u30fc\u7de8)\"\n\n\u6280\u8853\u30d6\u30ed\u30b0\u5bc4\u7a3f\n-----------------------------------------\n\n[cloudpack\u6280\u8853\u30d6\u30ed\u30b0][cloudpack-blog]\u3067\u3082\u3001AWS Lambda \u3084 \u904b\u7528\u30c4\u30fc\u30eb Serf \u306b\u95a2\u3057\u3066\u8a18\u4e8b\u3092\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\u3054\u8208\u5473\u3042\u308c\u3070\u8aad\u3093\u3067\u3044\u305f\u3060\u3051\u308b\u3068\u5b09\u3057\u3044\u3067\u3059\uff01\n\n- <a href=\"http://blog.cloudpack.jp/author/oohira/\" title=\"\u5927\u5e73 \u304b\u3065\u307f \u306e\u8a18\u4e8b\u4e00\u89a7 | cloudpack\u6280\u8853\u60c5\u5831\u30b5\u30a4\u30c8\"\u3000target=\"_blank\" rel=\"nofollow\">\u5927\u5e73 \u304b\u3065\u307f \u306e\u8a18\u4e8b\u4e00\u89a7</a>\n\n\n[cloudpack]:https://cloudpack.jp/ \"cloudpack\uff08\u30af\u30e9\u30a6\u30c9\u30d1\u30c3\u30af\uff09 400\u793e\u3092\u8d85\u3048\u308b\u5c0e\u5165\u5b9f\u7e3e! EC2\u306a\u3069AWS\u30af\u30e9\u30a6\u30c9\u306e\u5c0e\u5165\u8a2d\u8a08\u3001\u69cb\u7bc9\u3001\u904b\u7528\u4fdd\u5b88\u30b5\u30fc\u30d3\u30b9\"\n[cloudpack-blog]:http://blog.cloudpack.jp/ \"cloudpack\u6280\u8853\u60c5\u5831\u30b5\u30a4\u30c8\"\n[\u5927\u5e73\u304b\u3065\u307f]:http://blog.cloudpack.jp/author/oohira/ \"\u5927\u5e73\u304b\u3065\u307f\u306e\u8a18\u4e8b\u4e00\u89a7\"\n"}