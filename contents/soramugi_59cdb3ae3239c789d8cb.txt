{"tags": ["Ruby", "Conoha", "openstack"], "context": " More than 1 year has passed since last update.gem i openstack\n\n\nconoha_create.rb\nrequire 'openstack'\n\nmodule OpenStack\n  class Authentication\n    def self.init(conn)\n      if conn.auth_path =~ /.*v2.0\\//\n        AuthV20.new(conn)\n      else\n        AuthV10.new(conn)\n      end\n    end\n  end\nend\n\nflavor_name = 'g-1gb'\nimage_name = 'vmi-ubuntu-14.04-amd64'\n\n# https://www.conoha.jp/docs/compute-create_vm.html\nos = OpenStack::Connection.create(\n  username: ENV['CONOHA_USER'],\n  api_key: ENV['CONOHA_PASS'],\n  authtenant_id: ENV['CONOHA_TENANT_ID'],\n  auth_url: 'https://identity.tyo1.conoha.io/v2.0/tokens',\n)\n\n#pp os.servers\nos_flavor = os.flavors.select{|flavor|flavor[:name]==flavor_name}.first\nos_image = os.images.select{|image|image[:name]==image_name&&image[:status]=='ACTIVE'}.first\n\nnewserver = os.create_server(\n  name: 'New Server',\n  metadata: {\n    instance_name_tag: ENV['CONOHA_NAME_TAG'],\n  },\n  imageRef: os_image[:id],\n  flavorRef: os_flavor[:id],\n  adminPass: ENV['CONOHA_ADMINPASS'],\n  key_name: ENV['CONOHA_KEY_NAME'],\n  security_groups: ['gncs-ipv4-all'],\n)\nwhile newserver.accessipv4.nil?\n  sleep 15 # ip\u632f\u308a\u5206\u3051\u3089\u308c\u308b\u306e\u3092\u5c11\u3057\u5f85\u3064\n  newserver.refresh\nend\nputs newserver.accessipv4\n\n\n\u5404\u7a2e\u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u5b9f\u884c\u3057\u307e\u3057\u3087\u3046\u3002ip\u30a2\u30c9\u30ec\u30b9\u304c\u51fa\u529b\u3055\u308c\u308b\u306e\u3067\u3057\u3070\u3089\u304f\u5f85\u3063\u3066vps\u7acb\u3061\u4e0a\u304c\u308b\u306e\u5f85\u3063\u3066\u304b\u3089(1\u5206\u3050\u3089\u3044?)\nssh root@123.456.789.012\n\n\u3068\u304b\u3067\u884c\u3051\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\n\u81ea\u5206\u597d\u307f\u306b\u8a2d\u5b9a\u8af8\u3005\u3092\u5909\u66f4\u3057\u305f\u304f\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u305d\u306e\u969b\u306b\u5fc5\u8981\u306b\u306a\u308b\u3067\u3042\u308d\u3046\u60c5\u5831\u3092\u3070\u3002\n\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u304c\u4ee5\u4e0b\nhttps://www.conoha.jp/docs/\n\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u3067\u51fa\u3066\u304f\u308bX-Auth-Token\u306e\u53d6\u5f97\u65b9\u6cd5\ncurl -s -X POST \\\n-H \"Accept: application/json\" \\\n-d '{\"auth\":{\"passwordCredentials\":{\"username\":\"xxxxxxxxxxx\",\"password\":\"yyyyyyyyyy\"},\"tenantId\":\"zzzzzzzzzzzzzzzz\"}}' \\\nhttps://identity.tyo1.conoha.io/v2.0/tokens | jq '.access.token.id'\n\n\"aaaaaaaaaaaaaaaaaaaaaa\"\n\n1\u65e5\u3060\u3051\u6709\u52b9\u306e\u30c8\u30fc\u30af\u30f3\u304c\u53d6\u5f97\u3055\u308c\u307e\u3059\u3002\u305d\u306e\u30c8\u30fc\u30af\u30f3\u3092\u4f7f\u3063\u3066\u3053\u3093\u306a\u98a8\u306b\ncurl -s -X GET \\\n-H \"Accept: application/json\" \\\n-H \"X-Auth-Token: aaaaaaaaaaaaaaaaaaaaaa\" \\\nhttps://networking.tyo1.conoha.io/v2.0/security-groups | jq '.security_groups[].name'\n\n\"gncs-ipv4-ssh\"\n\"gncs-ipv4-all\"\n\"default\"\n\"gncs-ipv6-ssh\"\n\"gncs-ipv4-web\"\n\"gncs-ipv6-all\"\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u4e00\u89a7\u53d6\u5f97\u3057\u305f\u308a\u3068\u304b\u3057\u3066\u8a2d\u5b9a\u5024\u3068\u304b\u53d6\u5f97\u3057\u3066\u8a2d\u5b9a\u5909\u3048\u305f\u308a\u3068\u304b\u3057\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\n    gem i openstack\n\n```rb:conoha_create.rb\nrequire 'openstack'\n\nmodule OpenStack\n  class Authentication\n    def self.init(conn)\n      if conn.auth_path =~ /.*v2.0\\//\n        AuthV20.new(conn)\n      else\n        AuthV10.new(conn)\n      end\n    end\n  end\nend\n\nflavor_name = 'g-1gb'\nimage_name = 'vmi-ubuntu-14.04-amd64'\n\n# https://www.conoha.jp/docs/compute-create_vm.html\nos = OpenStack::Connection.create(\n  username: ENV['CONOHA_USER'],\n  api_key: ENV['CONOHA_PASS'],\n  authtenant_id: ENV['CONOHA_TENANT_ID'],\n  auth_url: 'https://identity.tyo1.conoha.io/v2.0/tokens',\n)\n\n#pp os.servers\nos_flavor = os.flavors.select{|flavor|flavor[:name]==flavor_name}.first\nos_image = os.images.select{|image|image[:name]==image_name&&image[:status]=='ACTIVE'}.first\n\nnewserver = os.create_server(\n  name: 'New Server',\n  metadata: {\n    instance_name_tag: ENV['CONOHA_NAME_TAG'],\n  },\n  imageRef: os_image[:id],\n  flavorRef: os_flavor[:id],\n  adminPass: ENV['CONOHA_ADMINPASS'],\n  key_name: ENV['CONOHA_KEY_NAME'],\n  security_groups: ['gncs-ipv4-all'],\n)\nwhile newserver.accessipv4.nil?\n  sleep 15 # ip\u632f\u308a\u5206\u3051\u3089\u308c\u308b\u306e\u3092\u5c11\u3057\u5f85\u3064\n  newserver.refresh\nend\nputs newserver.accessipv4\n```\n\n\u5404\u7a2e\u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u5b9f\u884c\u3057\u307e\u3057\u3087\u3046\u3002ip\u30a2\u30c9\u30ec\u30b9\u304c\u51fa\u529b\u3055\u308c\u308b\u306e\u3067\u3057\u3070\u3089\u304f\u5f85\u3063\u3066vps\u7acb\u3061\u4e0a\u304c\u308b\u306e\u5f85\u3063\u3066\u304b\u3089(1\u5206\u3050\u3089\u3044?)\n\n    ssh root@123.456.789.012\n\n\u3068\u304b\u3067\u884c\u3051\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n## \u30ab\u30b9\u30bf\u30de\u30a4\u30ba\n\n\u81ea\u5206\u597d\u307f\u306b\u8a2d\u5b9a\u8af8\u3005\u3092\u5909\u66f4\u3057\u305f\u304f\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u305d\u306e\u969b\u306b\u5fc5\u8981\u306b\u306a\u308b\u3067\u3042\u308d\u3046\u60c5\u5831\u3092\u3070\u3002\n\n\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u304c\u4ee5\u4e0b\n<https://www.conoha.jp/docs/>\n\n\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u3067\u51fa\u3066\u304f\u308b`X-Auth-Token`\u306e\u53d6\u5f97\u65b9\u6cd5\n\n```\ncurl -s -X POST \\\n-H \"Accept: application/json\" \\\n-d '{\"auth\":{\"passwordCredentials\":{\"username\":\"xxxxxxxxxxx\",\"password\":\"yyyyyyyyyy\"},\"tenantId\":\"zzzzzzzzzzzzzzzz\"}}' \\\nhttps://identity.tyo1.conoha.io/v2.0/tokens | jq '.access.token.id'\n```\n\n```\n\"aaaaaaaaaaaaaaaaaaaaaa\"\n```\n\n1\u65e5\u3060\u3051\u6709\u52b9\u306e\u30c8\u30fc\u30af\u30f3\u304c\u53d6\u5f97\u3055\u308c\u307e\u3059\u3002\u305d\u306e\u30c8\u30fc\u30af\u30f3\u3092\u4f7f\u3063\u3066\u3053\u3093\u306a\u98a8\u306b\n\n```\ncurl -s -X GET \\\n-H \"Accept: application/json\" \\\n-H \"X-Auth-Token: aaaaaaaaaaaaaaaaaaaaaa\" \\\nhttps://networking.tyo1.conoha.io/v2.0/security-groups | jq '.security_groups[].name'\n```\n\n```\n\"gncs-ipv4-ssh\"\n\"gncs-ipv4-all\"\n\"default\"\n\"gncs-ipv6-ssh\"\n\"gncs-ipv4-web\"\n\"gncs-ipv6-all\"\n```\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u4e00\u89a7\u53d6\u5f97\u3057\u305f\u308a\u3068\u304b\u3057\u3066\u8a2d\u5b9a\u5024\u3068\u304b\u53d6\u5f97\u3057\u3066\u8a2d\u5b9a\u5909\u3048\u305f\u308a\u3068\u304b\u3057\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\n"}