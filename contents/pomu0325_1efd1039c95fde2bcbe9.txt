{"context": "Datastore\u306e\u30ec\u30b3\u30fc\u30c9\u3092BigQuery\u306b\u5165\u308c\u308b\u306e\u306f\u3053\u3063\u3061\u53c2\u7167\uff1a http://qiita.com/tab02733/items/966eab11be6845eaf3ee\nDatastore Backup\u304b\u3089\u53d6\u308a\u8fbc\u3093\u3060table\u306b\u3042\u308bkey\u95a2\u9023\u306e\u30ab\u30e9\u30e0\n\n\u3053\u306e\u4e2d\u306e\u3001__key__.path\u306b\u3053\u3093\u306a\u611f\u3058\u3067ancestor key\u304c\u6587\u5b57\u5217\u3067\u5165\u3063\u3066\u3044\u308b\u3002\n\"ParentEntity\", \"9512e2b44c614b23216...\", \"ChildEntity\", \"child_key_name\"\n\n\nSQL\u95a2\u6570\u3067__key__.path\u3092\u30d0\u30e9\u3057\u3066\u3084\u308c\u3070JOIN\u3067\u304d\u305f\u3002\nSELECT\n  parent.hogehoge\nFROM\n  [datastore_backup20170117.Parent] parent\nLEFT JOIN (\n  SELECT\n    REPLACE(NTH(2, SPLIT(__key__.path, ', ')), '\"', '') parent_key_name\n  FROM\n    [datastore_backup20170117.Child]) child\nON\n  parent.__key__.name = child.parent_key_name\n\nDatastore\u306e\u30ec\u30b3\u30fc\u30c9\u3092BigQuery\u306b\u5165\u308c\u308b\u306e\u306f\u3053\u3063\u3061\u53c2\u7167\uff1a http://qiita.com/tab02733/items/966eab11be6845eaf3ee\n\n\nDatastore Backup\u304b\u3089\u53d6\u308a\u8fbc\u3093\u3060table\u306b\u3042\u308bkey\u95a2\u9023\u306e\u30ab\u30e9\u30e0\n![image](https://qiita-image-store.s3.amazonaws.com/0/9490/9d65dad7-03bd-7475-9398-a8b88e3d5f97.png)\n\n\u3053\u306e\u4e2d\u306e\u3001`__key__.path`\u306b\u3053\u3093\u306a\u611f\u3058\u3067ancestor key\u304c\u6587\u5b57\u5217\u3067\u5165\u3063\u3066\u3044\u308b\u3002\n\n```\n\"ParentEntity\", \"9512e2b44c614b23216...\", \"ChildEntity\", \"child_key_name\"\n```\n\n# SQL\u95a2\u6570\u3067`__key__.path`\u3092\u30d0\u30e9\u3057\u3066\u3084\u308c\u3070JOIN\u3067\u304d\u305f\u3002\n\n```sql\nSELECT\n  parent.hogehoge\nFROM\n  [datastore_backup20170117.Parent] parent\nLEFT JOIN (\n  SELECT\n    REPLACE(NTH(2, SPLIT(__key__.path, ', ')), '\"', '') parent_key_name\n  FROM\n    [datastore_backup20170117.Child]) child\nON\n  parent.__key__.name = child.parent_key_name\n```\n", "tags": ["bigquery"]}