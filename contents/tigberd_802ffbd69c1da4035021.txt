{"context": " More than 1 year has passed since last update.\u8ffd\u8a18 : Vimperator - buftabs.js\u3092Firefox29.1\u306b\u5bfe\u5fdc - Qiita\n\n\u6982\u8981\nbuftab.js\u304cPanorama\u306b\u5bfe\u5fdc\u3057\u3066\u304a\u3089\u305a\u3001\u5225\u306e\u30bf\u30d6\u30b0\u30eb\u30fc\u30d7\u306e\u30bf\u30d6\u3082\u307e\u3068\u3081\u3066\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3057\u305f\u3002\n\u305d\u306e\u305f\u3081\u30bf\u30d6\u3092\u5207\u308a\u66ff\u3048\u308b\u969b\u306b\u8868\u793a\u9806\u306e\u5207\u308a\u66ff\u3048\u304c\u3067\u304d\u305a\u4e0d\u4fbf\u3060\u3063\u305f\u306e\u3067\u73fe\u5728\u4f7f\u3063\u3066\u3044\u308bPanorama\u306e\u30bf\u30d6\u306e\u307f\u3092\u8868\u793a\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3057\u305f\u3002\n\n\u30d1\u30c3\u30c1\nhttps://github.com/tigberd/buftabs.js\n $ diff -u buftabs.js.old buftabs.js\n--- buftabs.js.old\n+++ buftabs.js\n@@ -1,5 +1,5 @@\n // {{{ Information\n-var INFO =\n+let INFO = xml`\n <plugin name=\"buftabs\" version=\"1.0\"\n     href=\"http://git.glacicle.org/vimperator-buftabs/\"\n     summary=\"Buftabs: show the tabbar in the statusline\"\n@@ -34,7 +34,7 @@\n             Set to 0 for unlimited.\n         </description>\n     </item>\n-</plugin>;\n+</plugin>;`;\n // }}}\n\n buftabs = {\n@@ -48,12 +48,12 @@\n         var position=0, selpos;\n\n         // Make sure we have an appropriate amount of labels\n-        while (btabs.childNodes.length > browsers.length)\n+        while (btabs.childNodes.length > window.gBrowser.visibleTabs.length)\n         {\n             btabs.removeChild(btabs.lastChild);\n         }\n\n-        while (btabs.childNodes.length < browsers.length)\n+        while (btabs.childNodes.length < window.gBrowser.visibleTabs.length)\n         {\n             var label = document.createElement(\"label\");\n             btabs.appendChild(label);\n@@ -68,10 +68,11 @@\n         }\n\n         // Create the new tabs\n-        for (let i=0; i < browsers.length; i++)\n+        for (let i=0; i < window.gBrowser.visibleTabs.length; i++)\n         {\n+            var tabnum = window.gBrowser.tabContainer.getIndexOfItem(window.gBrowser.visibleTabs[i]);\n             // Create label\n-            var browser = browsers[i];\n+            var browser = browsers[tabnum];\n             var label = btabs.childNodes[i];\n\n             // Hook on load\n@@ -85,10 +86,11 @@\n             }\n\n             // Fill label\n-            label.tabpos = i;\n+            label.tabpos = tabnum;\n+            label.num = i;\n             buftabs.fillLabel(label, browser);\n\n-            if (tabs.index() == label.tabpos)\n+            if (tabs.index() == tabnum)\n             {\n                 selpos = [position, label.clientWidth+position];\n             }\n@@ -105,7 +107,8 @@\n             btabs.scrollLeft = 0;\n\n         // Empty url label\n-        urlWidget.value = \"\";\n+        statusline.updateField(\"location\",\"\");\n+        liberator.echo(buffer.URL,2);\n     },\n\n     // Fill a label with browser content\n@@ -131,7 +134,7 @@\n             tabvalue += \"\\u2764\";\n\n         // Brackets and index\n-        tabvalue = \"[\"+(label.tabpos+1)+\"-\"+tabvalue+\"]\";\n+        tabvalue = \"[\"+(label.num+1)+\"-\"+tabvalue+\"]\";\n\n         label.setAttribute(\"value\", tabvalue);\n\n@@ -140,28 +143,23 @@\n             label.setAttributeNS(NS.uri, \"highlight\", \"BufTabSelected\");\n         else\n             label.setAttributeNS(NS.uri, \"highlight\", \"BufTab\");\n-\n-\n     },\n\n     // Create the horizontal box for adding the tabs to\n     createBar: function()\n     {\n-        var statusline = document.getElementById(\"liberator-statusline\");\n+        var addonbar = document.getElementById(\"addon-bar\");\n         var buftabs = document.getElementById(\"liberator-statusline-buftabs\");\n-        var urlWidget = document.getElementById(\"liberator-statusline-field-url\");\n-\n         // Only create if it doesn't exist yet\n         if (!buftabs)\n         {\n             buftabs = document.createElement(\"hbox\");\n             buftabs.setAttribute(\"id\", \"liberator-statusline-buftabs\");\n             buftabs.setAttribute(\"flex\", \"1\");\n-            buftabs.style.overflow = \"hidden\"\n-\n-            statusline.insertBefore(buftabs, urlWidget);\n+            buftabs.style.overflow = \"hidden\";\n+            addonbar.insertBefore(buftabs, addonbar.firstChild);\n         }\n-    },\n+    },\n\n     destroyBar: function()\n     {\n@@ -197,13 +195,12 @@\n window.getBrowser().addEventListener(\"load\", function (event) {\n     if (options.get(\"buftabs\").get())\n         statusline.updateUrl();\n-}, false);\n+}, true);\n\n /// Initialise highlight groups\n-highlight.loadCSS(String(<![CDATA[\n-    BufTab\n-    BufTabSelected   font-weight: bold;\n-]]>));\n+highlight.loadCSS(['BufTab',\n+                   'BufTabSelected   font-weight: bold;'\n+].join(\"\\n\"));\n\n /// Options\n options.add([\"buftabs\"],\n\n\n\u8ffd\u8a18 : [Vimperator - buftabs.js\u3092Firefox29.1\u306b\u5bfe\u5fdc - Qiita](http://qiita.com/tigberd/items/9ff9e313dd5d1db9f31d)\n\n## \u6982\u8981\nbuftab.js\u304cPanorama\u306b\u5bfe\u5fdc\u3057\u3066\u304a\u3089\u305a\u3001\u5225\u306e\u30bf\u30d6\u30b0\u30eb\u30fc\u30d7\u306e\u30bf\u30d6\u3082\u307e\u3068\u3081\u3066\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3057\u305f\u3002\n\u305d\u306e\u305f\u3081\u30bf\u30d6\u3092\u5207\u308a\u66ff\u3048\u308b\u969b\u306b\u8868\u793a\u9806\u306e\u5207\u308a\u66ff\u3048\u304c\u3067\u304d\u305a\u4e0d\u4fbf\u3060\u3063\u305f\u306e\u3067\u73fe\u5728\u4f7f\u3063\u3066\u3044\u308bPanorama\u306e\u30bf\u30d6\u306e\u307f\u3092\u8868\u793a\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3057\u305f\u3002\n\n## \u30d1\u30c3\u30c1\nhttps://github.com/tigberd/buftabs.js\n\n```diff\n $ diff -u buftabs.js.old buftabs.js\n--- buftabs.js.old\n+++ buftabs.js\n@@ -1,5 +1,5 @@\n // {{{ Information\n-var INFO =\n+let INFO = xml`\n <plugin name=\"buftabs\" version=\"1.0\"\n     href=\"http://git.glacicle.org/vimperator-buftabs/\"\n     summary=\"Buftabs: show the tabbar in the statusline\"\n@@ -34,7 +34,7 @@\n             Set to 0 for unlimited.\n         </description>\n     </item>\n-</plugin>;\n+</plugin>;`;\n // }}}\n\n buftabs = {\n@@ -48,12 +48,12 @@\n         var position=0, selpos;\n\n         // Make sure we have an appropriate amount of labels\n-        while (btabs.childNodes.length > browsers.length)\n+        while (btabs.childNodes.length > window.gBrowser.visibleTabs.length)\n         {\n             btabs.removeChild(btabs.lastChild);\n         }\n\n-        while (btabs.childNodes.length < browsers.length)\n+        while (btabs.childNodes.length < window.gBrowser.visibleTabs.length)\n         {\n             var label = document.createElement(\"label\");\n             btabs.appendChild(label);\n@@ -68,10 +68,11 @@\n         }\n\n         // Create the new tabs\n-        for (let i=0; i < browsers.length; i++)\n+        for (let i=0; i < window.gBrowser.visibleTabs.length; i++)\n         {\n+            var tabnum = window.gBrowser.tabContainer.getIndexOfItem(window.gBrowser.visibleTabs[i]);\n             // Create label\n-            var browser = browsers[i];\n+            var browser = browsers[tabnum];\n             var label = btabs.childNodes[i];\n\n             // Hook on load\n@@ -85,10 +86,11 @@\n             }\n\n             // Fill label\n-            label.tabpos = i;\n+            label.tabpos = tabnum;\n+            label.num = i;\n             buftabs.fillLabel(label, browser);\n\n-            if (tabs.index() == label.tabpos)\n+            if (tabs.index() == tabnum)\n             {\n                 selpos = [position, label.clientWidth+position];\n             }\n@@ -105,7 +107,8 @@\n             btabs.scrollLeft = 0;\n\n         // Empty url label\n-        urlWidget.value = \"\";\n+        statusline.updateField(\"location\",\"\");\n+        liberator.echo(buffer.URL,2);\n     },\n\n     // Fill a label with browser content\n@@ -131,7 +134,7 @@\n             tabvalue += \"\\u2764\";\n\n         // Brackets and index\n-        tabvalue = \"[\"+(label.tabpos+1)+\"-\"+tabvalue+\"]\";\n+        tabvalue = \"[\"+(label.num+1)+\"-\"+tabvalue+\"]\";\n\n         label.setAttribute(\"value\", tabvalue);\n\n@@ -140,28 +143,23 @@\n             label.setAttributeNS(NS.uri, \"highlight\", \"BufTabSelected\");\n         else\n             label.setAttributeNS(NS.uri, \"highlight\", \"BufTab\");\n-\n-\n     },\n\n     // Create the horizontal box for adding the tabs to\n     createBar: function()\n     {\n-        var statusline = document.getElementById(\"liberator-statusline\");\n+        var addonbar = document.getElementById(\"addon-bar\");\n         var buftabs = document.getElementById(\"liberator-statusline-buftabs\");\n-        var urlWidget = document.getElementById(\"liberator-statusline-field-url\");\n-\n         // Only create if it doesn't exist yet\n         if (!buftabs)\n         {\n             buftabs = document.createElement(\"hbox\");\n             buftabs.setAttribute(\"id\", \"liberator-statusline-buftabs\");\n             buftabs.setAttribute(\"flex\", \"1\");\n-            buftabs.style.overflow = \"hidden\"\n-\n-            statusline.insertBefore(buftabs, urlWidget);\n+            buftabs.style.overflow = \"hidden\";\n+            addonbar.insertBefore(buftabs, addonbar.firstChild);\n         }\n-    },\n+    },\n\n     destroyBar: function()\n     {\n@@ -197,13 +195,12 @@\n window.getBrowser().addEventListener(\"load\", function (event) {\n     if (options.get(\"buftabs\").get())\n         statusline.updateUrl();\n-}, false);\n+}, true);\n\n /// Initialise highlight groups\n-highlight.loadCSS(String(<![CDATA[\n-    BufTab\n-    BufTabSelected   font-weight: bold;\n-]]>));\n+highlight.loadCSS(['BufTab',\n+                   'BufTabSelected   font-weight: bold;'\n+].join(\"\\n\"));\n\n /// Options\n options.add([\"buftabs\"],\n```\n", "tags": ["Vimperator"]}