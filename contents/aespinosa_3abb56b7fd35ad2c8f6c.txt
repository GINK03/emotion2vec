{"context": " More than 1 year has passed since last update.Originally posted in http://aespinosa.github.io/blog/2015-02-21-proxy-cache-for-freebsd-pkg.html\nBy setting up apt-cacher-ng 1 in you local development environment, you can save\non precious bandwidth when building Chef recipes (or any  server side stuff) on\nyour local machine. Below are some of the steps to get this up and running.\n\nInstall and configure apt-cacher-ng\nIn a Mac you can get it via homebrew\nbrew install apt-cacher-ng\n\nWhen configuring apt-cacher-ng you need to set the following\n\n Setup the freebsd repository\n Set Pigeonhole files for *.txz files for packages and meta.txz,\npackagesite.txz, digests.txz for metadata files.\n\nTLDR: Place these changes to your vanilla apt-cacher-ng configuration.\n--- acng.conf.vanilla    2015-02-19 23:50:34.000000000 +0900\n+++ acng.conf            2015-02-21 01:40:51.000000000 +0900\n@@ -62,6 +62,7 @@\n Remap-epel:   file:epel_mirrors # Fedora EPEL\n Remap-slrep:  file:sl_mirrors # Scientific Linux\n Remap-gentoo: file:gentoo_mirrors.gz /gentoo ; file:backends_gentoo # Gentoo Archives\n+Remap-freebsd: pkg.freebsd.org pkgmir.pkg.freebsd.org\n\n # This is usually not needed for security.debian.org because it's always the\n # same DNS hostname. However, it might be enabled in order to use hooks\n@@ -170,8 +171,8 @@\n # Pigeonholing files with regular expressions (static/volatile). Can be\n # overriden here but not should not be done permanently because future update\n # of default settings would not be applied later.\n-# VfilePattern = (^|.*/)(Index|Packages(\\.gz|\\.bz2|\\.lzma|\\.xz)?|InRelease|Release|Release\\.gpg|custom\\.gpg|mirrors.txt|Sources(\\.gz|\\.bz2|\\.lzma|\\.xz)?|release|index\\.db-.*\\.gz|Contents-[^/]*(\\.gz|\\.bz2|\\.lzma|\\.xz)?|pkglist[^/]*\\.bz2|rclist[^/]*\\.bz2|meta-release[^/]*|Translation[^/]*(\\.gz|\\.bz2|\\.lzma|\\.xz)?|MD5SUMS|SHA1SUMS|((setup|setup-legacy)(\\.ini|\\.bz2|\\.hint)(\\.sig)?)|mirrors\\.lst|repo(index|md)\\.xml(\\.asc|\\.key)?|directory\\.yast|products|content(\\.asc|\\.key)?|media|filelists\\.xml\\.gz|filelists\\.sqlite\\.bz2|repomd\\.xml|packages\\.[a-zA-Z][a-zA-Z]\\.gz|info\\.txt|license\\.tar\\.gz|license\\.zip|.*\\.(db|files|abs)(\\.tar(\\.gz|\\.bz2|\\.lzma|\\.xz))?|metalink\\?repo|.*prestodelta\\.xml\\.gz|repodata/.*\\.(xml|sqlite)(\\.gz|\\.bz2|\\.lzma|\\.xz))$|/dists/.*/installer-[^/]+/[^0-9][^/]+/images/.*\n-# PfilePattern = .*(\\.d?deb|\\.rpm|\\.drpm|\\.dsc|\\.tar(\\.gz|\\.bz2|\\.lzma|\\.xz)(\\.gpg)?|\\.diff(\\.gz|\\.bz2|\\.lzma|\\.xz)|\\.jigdo|\\.template|changelog|copyright|\\.udeb|\\.debdelta|\\.diff/.*\\.gz|(Devel)?ReleaseAnnouncement(\\?.*)?|[a-f0-9]+-(susedata|updateinfo|primary|deltainfo).xml.gz|fonts/(final/)?[a-z]+32.exe(\\?download.*)?|/dists/.*/installer-[^/]+/[0-9][^/]+/images/.*)$\n+VfilePattern = (^|.*/)((meta|packagesite|digests)\\.txz|Index|Packages(\\.gz|\\.bz2|\\.lzma|\\.xz)?|InRelease|Release|Release\\.gpg|custom\\.gpg|mirrors.txt|Sources(\\.gz|\\.bz2|\\.lzma|\\.xz)?|release|index\\.db-.*\\.gz|Contents-[^/]*(\\.gz|\\.bz2|\\.lzma|\\.xz)?|pkglist[^/]*\\.bz2|rclist[^/]*\\.bz2|meta-release[^/]*|Translation[^/]*(\\.gz|\\.bz2|\\.lzma|\\.xz)?|MD5SUMS|SHA1SUMS|((setup|setup-legacy)(\\.ini|\\.bz2|\\.hint)(\\.sig)?)|mirrors\\.lst|repo(index|md)\\.xml(\\.asc|\\.key)?|directory\\.yast|products|content(\\.asc|\\.key)?|media|filelists\\.xml\\.gz|filelists\\.sqlite\\.bz2|repomd\\.xml|packages\\.[a-zA-Z][a-zA-Z]\\.gz|info\\.txt|license\\.tar\\.gz|license\\.zip|.*\\.(db|files|abs)(\\.tar(\\.gz|\\.bz2|\\.lzma|\\.xz))?|metalink\\?repo|.*prestodelta\\.xml\\.gz|repodata/.*\\.(xml|sqlite)(\\.gz|\\.bz2|\\.lzma|\\.xz))$|/dists/.*/installer-[^/]+/[^0-9][^/]+/images/.*\n+PfilePattern = .*(\\.d?deb|\\.rpm|\\.drpm|\\.txz|\\.dsc|\\.tar(\\.gz|\\.bz2|\\.lzma|\\.xz)(\\.gpg)?|\\.diff(\\.gz|\\.bz2|\\.lzma|\\.xz)|\\.jigdo|\\.template|changelog|copyright|\\.udeb|\\.debdelta|\\.diff/.*\\.gz|(Devel)?ReleaseAnnouncement(\\?.*)?|[a-f0-9]+-(susedata|updateinfo|primary|deltainfo).xml.gz|fonts/(final/)?[a-z]+32.exe(\\?download.*)?|/dists/.*/installer-[^/]+/[0-9][^/]+/images/.*)$\n # \n # Whitelist for expiration, file types not to be removed even when being\n # unreferenced. Default: many parts from VfilePattern where no parent index\n/usr/local/etc/apt-cacher-ng$ vagrant plugin list\n\nFinally run apt-cacher-ng like as follows on your mac\nlaunchctl load /usr/local/opt/apt-cacher-ng/homebrew.mxcl.apt-cacher-ng.plist\n\nUpdate your base vagrant box\nI am using Chef's FreeBSD 10.1 basebox 2 from its bento repository 3 here.  I modify\nthe Vagrantfile in the basebox as follows.  \nVagrant.configure '2' do |config|\n  config.vm.provision 'shell', inline: <<-eos\n#!/bin/sh\nmkdir -p /usr/local/etc/pkg/repos\ncat > /usr/local/etc/pkg/repos/freebsd.conf <<EOF\nFreeBSD { url: \"pkg+http://<ip-of-mac-vagrant-host>:3142/pkg.FreeBSD.org/\\\\${ABI}/latest\" }\nEOF\n  eos\nend\n\nThe basebox' Vagrantfile is found in\n~/.vagrant.d/boxes/chef-VAGRANTSLASH-freebsd10.1/0/vmware_desktop/Vagrantfile in my case.\n\n\n\n\nhttps://www.unix-ag.uni-kl.de/~bloch/acng/\u00a0\u21a9\n\n\nhttp://opscode-vm-bento.s3.amazonaws.com/vagrant/virtualbox/opscode_freebsd-10.1_chef-provisionerless.box\u00a0\u21a9\n\n\nhttps://github.com/chef/bento \u00a0\u21a9\n\n\n\nOriginally posted in http://aespinosa.github.io/blog/2015-02-21-proxy-cache-for-freebsd-pkg.html\n\nBy setting up apt-cacher-ng [^1] in you local development environment, you can save\non precious bandwidth when building Chef recipes (or any  server side stuff) on\nyour local machine. Below are some of the steps to get this up and running.\n\n##  Install and configure apt-cacher-ng\n\nIn a Mac you can get it via homebrew\n\n    brew install apt-cacher-ng\n\nWhen configuring apt-cacher-ng you need to set the following\n\n1.  Setup the freebsd repository\n2.  Set Pigeonhole files for \\*.txz files for packages and meta.txz,\n    packagesite.txz, digests.txz for metadata files.\n\nTLDR: Place these changes to your vanilla apt-cacher-ng configuration.\n\n```diff\n--- acng.conf.vanilla    2015-02-19 23:50:34.000000000 +0900\n+++ acng.conf            2015-02-21 01:40:51.000000000 +0900\n@@ -62,6 +62,7 @@\n Remap-epel:   file:epel_mirrors # Fedora EPEL\n Remap-slrep:  file:sl_mirrors # Scientific Linux\n Remap-gentoo: file:gentoo_mirrors.gz /gentoo ; file:backends_gentoo # Gentoo Archives\n+Remap-freebsd: pkg.freebsd.org pkgmir.pkg.freebsd.org\n \n # This is usually not needed for security.debian.org because it's always the\n # same DNS hostname. However, it might be enabled in order to use hooks\n@@ -170,8 +171,8 @@\n # Pigeonholing files with regular expressions (static/volatile). Can be\n # overriden here but not should not be done permanently because future update\n # of default settings would not be applied later.\n-# VfilePattern = (^|.*/)(Index|Packages(\\.gz|\\.bz2|\\.lzma|\\.xz)?|InRelease|Release|Release\\.gpg|custom\\.gpg|mirrors.txt|Sources(\\.gz|\\.bz2|\\.lzma|\\.xz)?|release|index\\.db-.*\\.gz|Contents-[^/]*(\\.gz|\\.bz2|\\.lzma|\\.xz)?|pkglist[^/]*\\.bz2|rclist[^/]*\\.bz2|meta-release[^/]*|Translation[^/]*(\\.gz|\\.bz2|\\.lzma|\\.xz)?|MD5SUMS|SHA1SUMS|((setup|setup-legacy)(\\.ini|\\.bz2|\\.hint)(\\.sig)?)|mirrors\\.lst|repo(index|md)\\.xml(\\.asc|\\.key)?|directory\\.yast|products|content(\\.asc|\\.key)?|media|filelists\\.xml\\.gz|filelists\\.sqlite\\.bz2|repomd\\.xml|packages\\.[a-zA-Z][a-zA-Z]\\.gz|info\\.txt|license\\.tar\\.gz|license\\.zip|.*\\.(db|files|abs)(\\.tar(\\.gz|\\.bz2|\\.lzma|\\.xz))?|metalink\\?repo|.*prestodelta\\.xml\\.gz|repodata/.*\\.(xml|sqlite)(\\.gz|\\.bz2|\\.lzma|\\.xz))$|/dists/.*/installer-[^/]+/[^0-9][^/]+/images/.*\n-# PfilePattern = .*(\\.d?deb|\\.rpm|\\.drpm|\\.dsc|\\.tar(\\.gz|\\.bz2|\\.lzma|\\.xz)(\\.gpg)?|\\.diff(\\.gz|\\.bz2|\\.lzma|\\.xz)|\\.jigdo|\\.template|changelog|copyright|\\.udeb|\\.debdelta|\\.diff/.*\\.gz|(Devel)?ReleaseAnnouncement(\\?.*)?|[a-f0-9]+-(susedata|updateinfo|primary|deltainfo).xml.gz|fonts/(final/)?[a-z]+32.exe(\\?download.*)?|/dists/.*/installer-[^/]+/[0-9][^/]+/images/.*)$\n+VfilePattern = (^|.*/)((meta|packagesite|digests)\\.txz|Index|Packages(\\.gz|\\.bz2|\\.lzma|\\.xz)?|InRelease|Release|Release\\.gpg|custom\\.gpg|mirrors.txt|Sources(\\.gz|\\.bz2|\\.lzma|\\.xz)?|release|index\\.db-.*\\.gz|Contents-[^/]*(\\.gz|\\.bz2|\\.lzma|\\.xz)?|pkglist[^/]*\\.bz2|rclist[^/]*\\.bz2|meta-release[^/]*|Translation[^/]*(\\.gz|\\.bz2|\\.lzma|\\.xz)?|MD5SUMS|SHA1SUMS|((setup|setup-legacy)(\\.ini|\\.bz2|\\.hint)(\\.sig)?)|mirrors\\.lst|repo(index|md)\\.xml(\\.asc|\\.key)?|directory\\.yast|products|content(\\.asc|\\.key)?|media|filelists\\.xml\\.gz|filelists\\.sqlite\\.bz2|repomd\\.xml|packages\\.[a-zA-Z][a-zA-Z]\\.gz|info\\.txt|license\\.tar\\.gz|license\\.zip|.*\\.(db|files|abs)(\\.tar(\\.gz|\\.bz2|\\.lzma|\\.xz))?|metalink\\?repo|.*prestodelta\\.xml\\.gz|repodata/.*\\.(xml|sqlite)(\\.gz|\\.bz2|\\.lzma|\\.xz))$|/dists/.*/installer-[^/]+/[^0-9][^/]+/images/.*\n+PfilePattern = .*(\\.d?deb|\\.rpm|\\.drpm|\\.txz|\\.dsc|\\.tar(\\.gz|\\.bz2|\\.lzma|\\.xz)(\\.gpg)?|\\.diff(\\.gz|\\.bz2|\\.lzma|\\.xz)|\\.jigdo|\\.template|changelog|copyright|\\.udeb|\\.debdelta|\\.diff/.*\\.gz|(Devel)?ReleaseAnnouncement(\\?.*)?|[a-f0-9]+-(susedata|updateinfo|primary|deltainfo).xml.gz|fonts/(final/)?[a-z]+32.exe(\\?download.*)?|/dists/.*/installer-[^/]+/[0-9][^/]+/images/.*)$\n # \n # Whitelist for expiration, file types not to be removed even when being\n # unreferenced. Default: many parts from VfilePattern where no parent index\n/usr/local/etc/apt-cacher-ng$ vagrant plugin list\n```\n\nFinally run apt-cacher-ng like as follows on your mac\n\n   launchctl load /usr/local/opt/apt-cacher-ng/homebrew.mxcl.apt-cacher-ng.plist\n\n## Update your base vagrant box\n\nI am using Chef's FreeBSD 10.1 basebox [^2] from its bento repository [^3] here.  I modify\nthe Vagrantfile in the basebox as follows.  \n\n```rb\nVagrant.configure '2' do |config|\n  config.vm.provision 'shell', inline: <<-eos\n#!/bin/sh\nmkdir -p /usr/local/etc/pkg/repos\ncat > /usr/local/etc/pkg/repos/freebsd.conf <<EOF\nFreeBSD { url: \"pkg+http://<ip-of-mac-vagrant-host>:3142/pkg.FreeBSD.org/\\\\${ABI}/latest\" }\nEOF\n  eos\nend\n```\n\nThe basebox' Vagrantfile is found in\n`~/.vagrant.d/boxes/chef-VAGRANTSLASH-freebsd10.1/0/vmware_desktop/Vagrantfile` in my case.\n\n\n[^1]: <https://www.unix-ag.uni-kl.de/~bloch/acng/>\n[^2]: <http://opscode-vm-bento.s3.amazonaws.com/vagrant/virtualbox/opscode_freebsd-10.1_chef-provisionerless.box>\n[^3]: <https://github.com/chef/bento> \n", "tags": ["FreeBSD"]}