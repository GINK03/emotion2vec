{"context": " More than 1 year has passed since last update.ROMA\u306erouting\u306b\u95a2\u3057\u3066\u306e\u8aac\u660e\u3067\u3059\n\n\nroutin\u30d5\u30a1\u30a4\u30eb\n\nrouting\u30d5\u30a1\u30a4\u30eb\u3068\u306f\n\nROMA\u306e\u30af\u30e9\u30b9\u30bf\u30fc\u69cb\u6210\u3092\u8a18\u8ff0\u3057\u305f\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\u3053\u308c\u3092\u3082\u3068\u306b\u30c7\u30fc\u30bf\u306e\u5206\u6563\u306a\u3069\u3092\u884c\u3046\n\n\nrouting\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n$ mkroute [options] [nodeIDs]\nEx.) mkroute 192.168.33.11_10001 192.168.33.11_10002 192.168.33.12_10001 192.168.33.12_10002\n\n\nmkroute\u30b3\u30de\u30f3\u30c9\u3067routing\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\n\n\nrouting\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\n\nrouting\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u5bb9\u306f\u5404\u30d5\u30a1\u30a4\u30eb\u3067\u5168\u3066\u540c\u3058\u5185\u5bb9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\nROMA\u304c\u8d77\u52d5\u3059\u308b\u3068\u304d\u306b\u6307\u5b9a\u3057\u305faddress\u3068port No.\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306eroutign\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\n\n\nrouting_file\n--- !ruby/object:Roma::Routing::RoutingData\ndgst_bits: 32 # 2**32 = 4294967296\ndiv_bits: 9 # 2**9 = 512\nrn: 2 # redundancy\nnodes:\n- 192.168.33.11_10001\n- 192.168.33.11_10002\n- 192.168.33.12_10001\n- 192.168.33.12_10002\nv_idx:\n  0:\n  - 192.168.33.11_10001\n  - 192.168.33.12_10001\n  8388608:\n  - 192.168.33.12_10002\n  - 192.168.33.11_10001\n  16777216:\n  - 192.168.33.12_10001\n  - 192.168.33.11_10002\n  .\n  .\n  .\nv_clk:\n  0: 0\n  8388608: 0\n  16777216: 0\n  .\n  .\n  .\n\n\n\n\ndgts_bits\n\n\u30c7\u30fc\u30bf\u5206\u6563\u306e\u969b\u306b\u4f7f\u7528\u3059\u308bROMA\u306eHash table\u3092\u3044\u304f\u3064\u306b\u5206\u6563\u3059\u308b\u304b\u306e\u8a2d\u5b9a\n(\u30c7\u30fc\u30bf\u632f\u308a\u5206\u3051\u306e\u969b\u306b2^^32\u500b\u5206\u306e\u7a7a\u9593\u304c\u3042\u308b)\n\u5b9f\u969b\u306e\u5024\u306f2**(\u8a2d\u5b9a\u3057\u305f\u6570)\n\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f32(4294967296)\n\n\n\ndiv_bits\n\nvnodes\u306e\u6570\u3092\u793a\u3059\n(dgst_bits\u3067\u7528\u610f\u3057\u305f2^^32\u306e\u7a7a\u9593\u3092\u3053\u306evnodes\u306e\u500b\u6570\u306b\u632f\u308a\u5206\u3051\u308b)\n\u5b9f\u969b\u306e\u5024\u306f2**(\u8a2d\u5b9a\u3057\u305f\u6570)\n\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f9(512)\n\n\n\nrn\n\n\u5197\u9577\u5ea6\u3092\u8868\u3059\n\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f2\n\n\n\nv_idx\n\n\u305d\u308c\u305e\u308c\u306evnodes\u306e\u62c5\u5f53node\u3092\u793a\u3059\n\u4e0a\u306e\u884c\u304b\u3089primary, secondary1, secondary2\u30fb\u30fb\u30fb\u3068\u306a\u308b\n\u540cserver\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u540c\u3058vnodes\u306b\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u308b\u3053\u3068\u306f\u306a\u3044\n(--duplicate_in_host\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u3048\u3070\u53ef\u80fd)\n\n\n\nv_clk\n\nvnodes\u6bce\u306e\u8ffd\u8a18\u56de\u6570\u3092\u793a\u3059\n\u521d\u671f\u5024\u306f0\n\n\n\n\n\u73fe\u5728\u306erouting\u60c5\u5831\u306e\u53d6\u5f97\nroutingdump\u30b3\u30de\u30f3\u30c9\u3067\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\n> routingdump [yaml|json|yamlbytes|bin]\n\nrouting\u60c5\u5831\u306e\u66f4\u65b0\n\ninstance\u304c\u8ffd\u52a0\u3055\u308c\u305f\u308a\u843d\u3061\u305f\u308a\u3059\u308b\u3068\u3001\u305d\u308c\u306b\u5408\u308f\u305b\u3066routing\u306e\u60c5\u5831\u304cupdate\u3055\u308c\u307e\u3059\n\n\n\u4ee5\u524d\u7d39\u4ecb\u3057\u305fjoin\u3084recover\u3001data lost\u6642\u306eauto_assign\u306a\u3069\nhttp://qiita.com/hiroaki-iwase/items/a2558eb1b7b44977ec5f\nhttp://qiita.com/hiroaki-iwase/items/087c1b4d0dd3e6882001\nhttp://qiita.com/hiroaki-iwase/items/1e1185e09c3614f5ad74\n\n\n\u65b0\u3057\u3044routing\u60c5\u5831\u306f\u3001routing\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u5dee\u5206\u60c5\u5831\u3068\u3057\u3066\u4fdd\u5b58\u3055\u308c\u307e\u3059\n\n\n\u4f8b\n\n'localhost_10001', 'localhost_10002', 'localhost_10003'\u3067\u69cb\u7bc9\u3057\u3066\u3044\u308b\u30af\u30e9\u30b9\u30bf\u30fc\u3067'localhost_10003'\u304c\u843d\u3061\u305f\u5834\u5408\n\n\nrouting\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n$ ls -l\ntotal 124\n-rw-r--r-- 1 root root 25471 Dec 10 03:07 localhost_10001.route   # \u521d\u671f\u30d5\u30a1\u30a4\u30eb\n-rw-r--r-- 1 root root 19453 Dec 10 05:31 localhost_10001.route.1 # \u5dee\u5206\u30d5\u30a1\u30a4\u30eb1(10001)\n-rw-r--r-- 1 root root 25471 Dec 10 03:07 localhost_10002.route   # \u521d\u671f\u30d5\u30a1\u30a4\u30eb\n-rw-r--r-- 1 root root 19453 Dec 10 05:31 localhost_10002.route.1 # \u5dee\u5206\u30d5\u30a1\u30a4\u30eb1(10002)\n-rw-r--r-- 1 root root 25471 Dec 10 03:07 localhost_10003.route   # \u521d\u671f\u30d5\u30a1\u30a4\u30eb\n-rw-r--r-- 1 root root     0 Dec 10 03:07 localhost_10003.route.1\n\n\n\n\u5dee\u5206\u30d5\u30a1\u30a4\u30eb\u306f\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u672b\u5c3e\u306b.(\u6570\u5b57)\u304c\u8ffd\u52a0\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3067\u3059\n\n\n\u4eca\u56de\u306flocalhost_10003\u306f\u843d\u3061\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306a\u306e\u3067\u5dee\u5206\u30d5\u30a1\u30a4\u30eb\u306f0bytes\nlocalhost_10001\u3068localhost10002\u306frouting\u306eupdate\u304c\u8d77\u304d\u305f\u306e\u3067\u5dee\u5206\u30d5\u30a1\u30a4\u30eb\u306b\u5909\u66f4\u60c5\u5831\u304c\u4fdd\u5b58\u3055\u308c\u3066\u3044\u307e\u3059\n\n\n\u5dee\u5206\u304c\u5897\u3048\u3066\u3044\u304f\u306b\u3064\u308c\u3001'.1', '.2'\u3068\u5897\u3048\u3066\u3044\u304d\u307e\u3059\n\nROMA\u306erouting\u306b\u95a2\u3057\u3066\u306e\u8aac\u660e\u3067\u3059\n![704c063c-ccdc-a425-b9f6-bfe84f8a1aad.png](https://qiita-image-store.s3.amazonaws.com/0/103558/44c93721-d4e7-8c30-a2bb-dd0c9600d95e.png)\n\n# routin\u30d5\u30a1\u30a4\u30eb\n## routing\u30d5\u30a1\u30a4\u30eb\u3068\u306f\n- ROMA\u306e\u30af\u30e9\u30b9\u30bf\u30fc\u69cb\u6210\u3092\u8a18\u8ff0\u3057\u305f\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n- \u3053\u308c\u3092\u3082\u3068\u306b\u30c7\u30fc\u30bf\u306e\u5206\u6563\u306a\u3069\u3092\u884c\u3046\n\n## routing\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n\n```bash\n$ mkroute [options] [nodeIDs]\nEx.) mkroute 192.168.33.11_10001 192.168.33.11_10002 192.168.33.12_10001 192.168.33.12_10002\n```\n- mkroute\u30b3\u30de\u30f3\u30c9\u3067routing\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\n\n## routing\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\n- routing\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u5bb9\u306f\u5404\u30d5\u30a1\u30a4\u30eb\u3067\u5168\u3066\u540c\u3058\u5185\u5bb9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\n- ROMA\u304c\u8d77\u52d5\u3059\u308b\u3068\u304d\u306b\u6307\u5b9a\u3057\u305faddress\u3068port No.\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306eroutign\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\n\n```rb:routing_file\n--- !ruby/object:Roma::Routing::RoutingData\ndgst_bits: 32 # 2**32 = 4294967296\ndiv_bits: 9 # 2**9 = 512\nrn: 2 # redundancy\nnodes:\n- 192.168.33.11_10001\n- 192.168.33.11_10002\n- 192.168.33.12_10001\n- 192.168.33.12_10002\nv_idx:\n  0:\n  - 192.168.33.11_10001\n  - 192.168.33.12_10001\n  8388608:\n  - 192.168.33.12_10002\n  - 192.168.33.11_10001\n  16777216:\n  - 192.168.33.12_10001\n  - 192.168.33.11_10002\n  .\n  .\n  .\nv_clk:\n  0: 0\n  8388608: 0\n  16777216: 0\n  .\n  .\n  .\n```\n- dgts_bits\n  - \u30c7\u30fc\u30bf\u5206\u6563\u306e\u969b\u306b\u4f7f\u7528\u3059\u308bROMA\u306eHash table\u3092\u3044\u304f\u3064\u306b\u5206\u6563\u3059\u308b\u304b\u306e\u8a2d\u5b9a  \n  (\u30c7\u30fc\u30bf\u632f\u308a\u5206\u3051\u306e\u969b\u306b2^^32\u500b\u5206\u306e\u7a7a\u9593\u304c\u3042\u308b)\n  - \u5b9f\u969b\u306e\u5024\u306f2**(\u8a2d\u5b9a\u3057\u305f\u6570)\n  - \u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f32(4294967296)\n\n- div_bits\n  - vnodes\u306e\u6570\u3092\u793a\u3059  \n  (dgst_bits\u3067\u7528\u610f\u3057\u305f2^^32\u306e\u7a7a\u9593\u3092\u3053\u306evnodes\u306e\u500b\u6570\u306b\u632f\u308a\u5206\u3051\u308b)\n  - \u5b9f\u969b\u306e\u5024\u306f2**(\u8a2d\u5b9a\u3057\u305f\u6570)\n  - \u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f9(512)\n\n- rn\n  - \u5197\u9577\u5ea6\u3092\u8868\u3059\n  - \u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f2\n\n- v_idx\n  - \u305d\u308c\u305e\u308c\u306evnodes\u306e\u62c5\u5f53node\u3092\u793a\u3059\n  - \u4e0a\u306e\u884c\u304b\u3089primary, secondary1, secondary2\u30fb\u30fb\u30fb\u3068\u306a\u308b\n  - \u540cserver\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u540c\u3058vnodes\u306b\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u308b\u3053\u3068\u306f\u306a\u3044  \n  (--duplicate_in_host\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u3048\u3070\u53ef\u80fd)\n\n- v_clk\n  - vnodes\u6bce\u306e\u8ffd\u8a18\u56de\u6570\u3092\u793a\u3059\n  - \u521d\u671f\u5024\u306f0\n \n## \u73fe\u5728\u306erouting\u60c5\u5831\u306e\u53d6\u5f97\nroutingdump\u30b3\u30de\u30f3\u30c9\u3067\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\n`> routingdump [yaml|json|yamlbytes|bin]`\n\n\n# routing\u60c5\u5831\u306e\u66f4\u65b0\n- instance\u304c\u8ffd\u52a0\u3055\u308c\u305f\u308a\u843d\u3061\u305f\u308a\u3059\u308b\u3068\u3001\u305d\u308c\u306b\u5408\u308f\u305b\u3066routing\u306e\u60c5\u5831\u304cupdate\u3055\u308c\u307e\u3059\n  - \u4ee5\u524d\u7d39\u4ecb\u3057\u305fjoin\u3084recover\u3001data lost\u6642\u306eauto_assign\u306a\u3069\n  - http://qiita.com/hiroaki-iwase/items/a2558eb1b7b44977ec5f\n  - http://qiita.com/hiroaki-iwase/items/087c1b4d0dd3e6882001\n  - http://qiita.com/hiroaki-iwase/items/1e1185e09c3614f5ad74\n- \u65b0\u3057\u3044routing\u60c5\u5831\u306f\u3001routing\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u5dee\u5206\u60c5\u5831\u3068\u3057\u3066\u4fdd\u5b58\u3055\u308c\u307e\u3059\n\n## \u4f8b\n- 'localhost_10001', 'localhost_10002', 'localhost_10003'\u3067\u69cb\u7bc9\u3057\u3066\u3044\u308b\u30af\u30e9\u30b9\u30bf\u30fc\u3067'localhost_10003'\u304c\u843d\u3061\u305f\u5834\u5408\n\n```bash:routing\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n$ ls -l\ntotal 124\n-rw-r--r-- 1 root root 25471 Dec 10 03:07 localhost_10001.route   # \u521d\u671f\u30d5\u30a1\u30a4\u30eb\n-rw-r--r-- 1 root root 19453 Dec 10 05:31 localhost_10001.route.1 # \u5dee\u5206\u30d5\u30a1\u30a4\u30eb1(10001)\n-rw-r--r-- 1 root root 25471 Dec 10 03:07 localhost_10002.route   # \u521d\u671f\u30d5\u30a1\u30a4\u30eb\n-rw-r--r-- 1 root root 19453 Dec 10 05:31 localhost_10002.route.1 # \u5dee\u5206\u30d5\u30a1\u30a4\u30eb1(10002)\n-rw-r--r-- 1 root root 25471 Dec 10 03:07 localhost_10003.route   # \u521d\u671f\u30d5\u30a1\u30a4\u30eb\n-rw-r--r-- 1 root root     0 Dec 10 03:07 localhost_10003.route.1\n```\n- \u5dee\u5206\u30d5\u30a1\u30a4\u30eb\u306f\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u672b\u5c3e\u306b.(\u6570\u5b57)\u304c\u8ffd\u52a0\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3067\u3059\n  - \u4eca\u56de\u306flocalhost_10003\u306f\u843d\u3061\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306a\u306e\u3067\u5dee\u5206\u30d5\u30a1\u30a4\u30eb\u306f0bytes\n  - localhost_10001\u3068localhost10002\u306frouting\u306eupdate\u304c\u8d77\u304d\u305f\u306e\u3067\u5dee\u5206\u30d5\u30a1\u30a4\u30eb\u306b\u5909\u66f4\u60c5\u5831\u304c\u4fdd\u5b58\u3055\u308c\u3066\u3044\u307e\u3059\n- \u5dee\u5206\u304c\u5897\u3048\u3066\u3044\u304f\u306b\u3064\u308c\u3001'.1', '.2'\u3068\u5897\u3048\u3066\u3044\u304d\u307e\u3059\n\n", "tags": ["Ruby", "nosql", "Database", "KVS", "roma"]}