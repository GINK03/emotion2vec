{"context": " More than 1 year has passed since last update.Web\u30d6\u30e9\u30a6\u30b6\u3068\u3057\u3066\u826f\u304fconkeror\u3092\u4f7f\u3044\u59cb\u3081\u305f\u306e\u3060\u304c\uff0c\u524d\u56de\u7d42\u4e86\u6642\u306e\u30d0\u30c3\u30d5\u30a1(\u3044\u308f\u3086\u308b\u30bf\u30d6)\u3092\u4fdd\u5b58\u3059\u308b\u3053\u3068\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3067\u304d\u306a\u3044\uff0e\n\u516c\u5f0f\u306eWiki\u3084\u9069\u5f53\u306b\u30b0\u30b0\u3063\u305f\u7d50\u679c\u3092\u898b\u308b\u9650\u308a\uff0c\u305d\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f\u898b\u3064\u304b\u3089\u306a\u304b\u3063\u305f\u306e\u3067\uff0c\u81ea\u5206\u3067\u66f8\u3044\u3066\u307f\u305f\uff0e\n\nConkeror\u3068\u306f\nMozilla XULRunner\u3092\u30d9\u30fc\u30b9\u306b\u3057\u305fWeb\u30d6\u30e9\u30a6\u30b6\u3067\uff0c\n\nCUI/TUI\u3067\u306e\u5229\u7528\u304c\u30d9\u30fc\u30b9\nEmacs\u3068\u304bvi\u306e\u3088\u3046\u306b\uff0c\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u52d5\u4f5c\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u53ef\u80fd\n\n\u3068\u3044\u3046\u7279\u5fb4\u304c\u3042\u308b\uff0eKeySnail\u304c\u4f7f\u3048\u306a\u304f\u306a\u308b\u65e5\u306b\u5099\u3048\u3066\u5f90\u3005\u306bconkeror\u3078\u306e\u79fb\u52d5\u3092\u81ea\u5206\u306f\u958b\u59cb\u3057\u3066\u307f\u305f\u304c\uff0c\u307e\u3060\u307e\u3060\u5148\u306f\u9577\u3044\uff0e\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n/**\n * The browser restore the windows and buffers from last time.\n */\nvar ioService = Components.classes[\"@mozilla.org/network/io-service;1\"].getService(Components.interfaces.nsIIOService);\n\nvar startup_filename = \".conkeror_startup\";\nvar startup_file = get_home_directory();\n\nstartup_file.append(startup_filename);\n\nfunction can_restore_windows_and_buffers() {\n  var count = 0;\n  var flag = true;\n  for_each_buffer(function (buffer) {\n    count += 1;\n\n    var uri = buffer.current_uri.resolve(null);\n    if (uri != null && uri != homepage) {\n      flag = false;\n    }\n  });\n  return count <= 1 && flag;\n}\n\nfunction should_save_windows_and_buffers() {\n  var count = 0;\n  for_each_window(function (w) {\n    count += 1;\n  });\n  // if the number of windows is 1, save windows and buffers.\n  return count == 1;\n}\n/* save windows and buffers */\nfunction save_windows_and_buffers() {\n  try {\n    var windows = [];\n    for_each_window(function (w) {\n      var buffers = [];\n      w.buffers.for_each(function (buffer) {\n        buffers.push(buffer.current_uri.resolve(null));\n      });\n      windows.push(buffers);\n    });\n\n    var data = JSON.stringify(windows);\n\n    /* write file\n    (https://developer.mozilla.org/ja/docs/Code_snippets/File_I_O#.E3.83.95.E3.82.A1.E3.82.A4.E3.83.AB.E3.81.AB.E6.9B.B8.E3.81.8D.E5.87.BA.E3.81.99)\n    */\n    var foStream = Components.classes[\"@mozilla.org/network/file-output-stream;1\"]\n                       .createInstance(Components.interfaces.nsIFileOutputStream);\n    foStream.init(startup_file, 0x02 | 0x08 | 0x20, 0664, 0);\n    foStream.write(data, data.length);\n    foStream.close();\n  } catch (e) {\n    dumpln(\"Error in save buffers: \" + e);\n  }\n}\n\n// add hook to save the windows and buffers when the conkeror exit.\nadd_hook(\"quit_hook\", save_windows_and_buffers);\nadd_hook(\"window_before_close_hook\", function(w) {\n  if (should_save_windows_and_buffers()) {\n    save_windows_and_buffers();\n  }\n  return true;\n});\n\nif (!startup_file.exists()) {\n  return ;\n}\n\n/* read file\n(https://developer.mozilla.org/ja/docs/Code_snippets/File_I_O#.E3.83.95.E3.82.A1.E3.82.A4.E3.83.AB.E3.81.AB.E6.9B.B8.E3.81.8D.E5.87.BA.E3.81.99)\n*/\nvar data = \"\";\nvar fstream = Components.classes[\"@mozilla.org/network/file-input-stream;1\"]\n                        .createInstance(Components.interfaces.nsIFileInputStream);\nvar sstream = Components.classes[\"@mozilla.org/scriptableinputstream;1\"]\n                        .createInstance(Components.interfaces.nsIScriptableInputStream);\nfstream.init(startup_file, -1, 0, 0);\nsstream.init(fstream);\nvar str = sstream.read(4096);\nwhile (str.length > 0) {\n  data += str;\n  str = sstream.read(4096);\n}\nsstream.close();\nfstream.close();\n\nvar windows = JSON.parse(data);\n\nadd_hook(\"window_initialize_late_hook\", function(w) {\n  if (!can_restore_windows_and_buffers()) return ;\n\n  var buffer = null;\n  w.buffers.for_each(function(b) {\n    buffer = b;\n  });\n\n  if (buffer == null) return ;\n\n  for (var i = 0, l1 = windows.length; i < l1; i++) {\n    var window = windows[i];\n    for (var j = 0, l2 = window.length; j < l2; j++) {\n      var uri = ioService.newURI(window[j], null, null);\n      if (j == 0) {\n        if (i != 0) {\n          browser_object_follow(buffer, OPEN_NEW_WINDOW, uri.spec);\n        } else {\n          browser_object_follow(buffer, OPEN_CURRENT_BUFFER, uri.spec);\n        }\n      } else {\n        browser_object_follow(buffer, OPEN_NEW_BUFFER, uri.spec);\n      }\n    }\n  }\n});\n\n${HOME}/.conkeror_startup\u30d5\u30a1\u30a4\u30eb\u306b\uff0c\u524d\u56de\u7d42\u4e86\u6642\u306e\u30d0\u30c3\u30d5\u30a1\u4e00\u89a7\u304c\u4fdd\u5b58\u3055\u308c\uff0c\u8d77\u52d5\u6642\u306b\u306f\u305d\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u3093\u3067\u5fa9\u5143\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\uff0e\n\u66f8\u3044\u3066\u3044\u308b\u3068\u304d\u306b\u30cf\u30de\u3063\u305f\u306e\u306f\uff0c\n\nconkeror\u306e\u7d42\u4e86\u306f\uff0c\u6b21\u306e2\u3064\u306ehook\u3092\u4f75\u7528\u3057\u3066\u691c\u51fa\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b(\u3053\u3053\u304c\u7d50\u69cb\u30cf\u30de\u3063\u305f)\uff0e\n\n\n\nquit_hook\n\n\nC-x C-c\u7b49\u3067\u306e\u7d42\u4e86\u6642\u306ehook\n\n\n\nwindow_before_close_hook\u304c\u547c\u3073\u51fa\u3055\u308c\uff0c\u304b\u3064\uff0cwindow\u306e\u500b\u6570\u304c1\u500b\n\n\n\u4f55\u3089\u304b\u306e\u624b\u6bb5\u3067\uff0c\u6700\u5f8c\u306ewindow\u3092\u9589\u3058\u305f\u3068\u304d\u306ehook\n\n\n\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u547c\u3073\u51fa\u3055\u308c\u3066\u3044\u308b\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u306f\uff0c\u307e\u3060window\u306f\u521d\u671f\u5316\u3055\u308c\u3066\u3044\u306a\u3044\n\n\n\nwindow_initialize_late_hook\u3092\u4f7f\u3063\u3066\uff0cwindow\u304c\u958b\u304b\u308c\u305f\u3068\u304d\u306b\u5fa9\u5143\u51e6\u7406\u3092\u884c\u3046\u5fc5\u8981\u304c\u3042\u308b\n\n\n\n\u306e2\u7b87\u6240\uff0e\u3053\u306e2\u70b9\u3092\u9664\u3051\u3070\u96e3\u3057\u3044\u3068\u3053\u308d\u306e\u306a\u3044\u30b9\u30af\u30ea\u30d7\u30c8\u3060\u3063\u305f\u3057\uff0c\u53c2\u8003URL\u306f\u30b3\u30e1\u30f3\u30c8\u3067\u8f09\u305b\u3066\u3042\u308b\u306e\u3067\u8aac\u660e\u306f\u7701\u304f\uff0e\nWeb\u30d6\u30e9\u30a6\u30b6\u3068\u3057\u3066\u826f\u304f[conkeror](http://conkeror.org/)\u3092\u4f7f\u3044\u59cb\u3081\u305f\u306e\u3060\u304c\uff0c\u524d\u56de\u7d42\u4e86\u6642\u306e\u30d0\u30c3\u30d5\u30a1(\u3044\u308f\u3086\u308b\u30bf\u30d6)\u3092\u4fdd\u5b58\u3059\u308b\u3053\u3068\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3067\u304d\u306a\u3044\uff0e\n\u516c\u5f0f\u306eWiki\u3084\u9069\u5f53\u306b\u30b0\u30b0\u3063\u305f\u7d50\u679c\u3092\u898b\u308b\u9650\u308a\uff0c\u305d\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f\u898b\u3064\u304b\u3089\u306a\u304b\u3063\u305f\u306e\u3067\uff0c\u81ea\u5206\u3067\u66f8\u3044\u3066\u307f\u305f\uff0e\n\n## Conkeror\u3068\u306f\nMozilla XULRunner\u3092\u30d9\u30fc\u30b9\u306b\u3057\u305fWeb\u30d6\u30e9\u30a6\u30b6\u3067\uff0c\n\n* CUI/TUI\u3067\u306e\u5229\u7528\u304c\u30d9\u30fc\u30b9\n* Emacs\u3068\u304bvi\u306e\u3088\u3046\u306b\uff0c\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u52d5\u4f5c\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u53ef\u80fd\n\n\u3068\u3044\u3046\u7279\u5fb4\u304c\u3042\u308b\uff0eKeySnail\u304c\u4f7f\u3048\u306a\u304f\u306a\u308b\u65e5\u306b\u5099\u3048\u3066\u5f90\u3005\u306bconkeror\u3078\u306e\u79fb\u52d5\u3092\u81ea\u5206\u306f\u958b\u59cb\u3057\u3066\u307f\u305f\u304c\uff0c\u307e\u3060\u307e\u3060\u5148\u306f\u9577\u3044\uff0e\n\n## \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n```javascript\n/**\n * The browser restore the windows and buffers from last time.\n */\nvar ioService = Components.classes[\"@mozilla.org/network/io-service;1\"].getService(Components.interfaces.nsIIOService);\n\nvar startup_filename = \".conkeror_startup\";\nvar startup_file = get_home_directory();\n\nstartup_file.append(startup_filename);\n\nfunction can_restore_windows_and_buffers() {\n  var count = 0;\n  var flag = true;\n  for_each_buffer(function (buffer) {\n    count += 1;\n\n    var uri = buffer.current_uri.resolve(null);\n    if (uri != null && uri != homepage) {\n      flag = false;\n    }\n  });\n  return count <= 1 && flag;\n}\n\nfunction should_save_windows_and_buffers() {\n  var count = 0;\n  for_each_window(function (w) {\n    count += 1;\n  });\n  // if the number of windows is 1, save windows and buffers.\n  return count == 1;\n}\n/* save windows and buffers */\nfunction save_windows_and_buffers() {\n  try {\n    var windows = [];\n    for_each_window(function (w) {\n      var buffers = [];\n      w.buffers.for_each(function (buffer) {\n        buffers.push(buffer.current_uri.resolve(null));\n      });\n      windows.push(buffers);\n    });\n\n    var data = JSON.stringify(windows);\n\n    /* write file\n    (https://developer.mozilla.org/ja/docs/Code_snippets/File_I_O#.E3.83.95.E3.82.A1.E3.82.A4.E3.83.AB.E3.81.AB.E6.9B.B8.E3.81.8D.E5.87.BA.E3.81.99)\n    */\n    var foStream = Components.classes[\"@mozilla.org/network/file-output-stream;1\"]\n                       .createInstance(Components.interfaces.nsIFileOutputStream);\n    foStream.init(startup_file, 0x02 | 0x08 | 0x20, 0664, 0);\n    foStream.write(data, data.length);\n    foStream.close();\n  } catch (e) {\n    dumpln(\"Error in save buffers: \" + e);\n  }\n}\n\n// add hook to save the windows and buffers when the conkeror exit.\nadd_hook(\"quit_hook\", save_windows_and_buffers);\nadd_hook(\"window_before_close_hook\", function(w) {\n  if (should_save_windows_and_buffers()) {\n    save_windows_and_buffers();\n  }\n  return true;\n});\n\nif (!startup_file.exists()) {\n  return ;\n}\n\n/* read file\n(https://developer.mozilla.org/ja/docs/Code_snippets/File_I_O#.E3.83.95.E3.82.A1.E3.82.A4.E3.83.AB.E3.81.AB.E6.9B.B8.E3.81.8D.E5.87.BA.E3.81.99)\n*/\nvar data = \"\";\nvar fstream = Components.classes[\"@mozilla.org/network/file-input-stream;1\"]\n                        .createInstance(Components.interfaces.nsIFileInputStream);\nvar sstream = Components.classes[\"@mozilla.org/scriptableinputstream;1\"]\n                        .createInstance(Components.interfaces.nsIScriptableInputStream);\nfstream.init(startup_file, -1, 0, 0);\nsstream.init(fstream);\nvar str = sstream.read(4096);\nwhile (str.length > 0) {\n  data += str;\n  str = sstream.read(4096);\n}\nsstream.close();\nfstream.close();\n\nvar windows = JSON.parse(data);\n\nadd_hook(\"window_initialize_late_hook\", function(w) {\n  if (!can_restore_windows_and_buffers()) return ;\n\n  var buffer = null;\n  w.buffers.for_each(function(b) {\n    buffer = b;\n  });\n\n  if (buffer == null) return ;\n\n  for (var i = 0, l1 = windows.length; i < l1; i++) {\n    var window = windows[i];\n    for (var j = 0, l2 = window.length; j < l2; j++) {\n      var uri = ioService.newURI(window[j], null, null);\n      if (j == 0) {\n        if (i != 0) {\n          browser_object_follow(buffer, OPEN_NEW_WINDOW, uri.spec);\n        } else {\n          browser_object_follow(buffer, OPEN_CURRENT_BUFFER, uri.spec);\n        }\n      } else {\n        browser_object_follow(buffer, OPEN_NEW_BUFFER, uri.spec);\n      }\n    }\n  }\n});\n```\n\n`${HOME}/.conkeror_startup`\u30d5\u30a1\u30a4\u30eb\u306b\uff0c\u524d\u56de\u7d42\u4e86\u6642\u306e\u30d0\u30c3\u30d5\u30a1\u4e00\u89a7\u304c\u4fdd\u5b58\u3055\u308c\uff0c\u8d77\u52d5\u6642\u306b\u306f\u305d\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u3093\u3067\u5fa9\u5143\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\uff0e\n\u66f8\u3044\u3066\u3044\u308b\u3068\u304d\u306b\u30cf\u30de\u3063\u305f\u306e\u306f\uff0c\n\n1. conkeror\u306e\u7d42\u4e86\u306f\uff0c\u6b21\u306e2\u3064\u306ehook\u3092\u4f75\u7528\u3057\u3066\u691c\u51fa\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b(\u3053\u3053\u304c\u7d50\u69cb\u30cf\u30de\u3063\u305f)\uff0e\n    * `quit_hook`\n        * `C-x C-c`\u7b49\u3067\u306e\u7d42\u4e86\u6642\u306ehook\n    * `window_before_close_hook`\u304c\u547c\u3073\u51fa\u3055\u308c\uff0c\u304b\u3064\uff0cwindow\u306e\u500b\u6570\u304c1\u500b\n        * \u4f55\u3089\u304b\u306e\u624b\u6bb5\u3067\uff0c\u6700\u5f8c\u306ewindow\u3092\u9589\u3058\u305f\u3068\u304d\u306ehook\n2. \u30b9\u30af\u30ea\u30d7\u30c8\u304c\u547c\u3073\u51fa\u3055\u308c\u3066\u3044\u308b\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u306f\uff0c\u307e\u3060window\u306f\u521d\u671f\u5316\u3055\u308c\u3066\u3044\u306a\u3044\n    * `window_initialize_late_hook`\u3092\u4f7f\u3063\u3066\uff0cwindow\u304c\u958b\u304b\u308c\u305f\u3068\u304d\u306b\u5fa9\u5143\u51e6\u7406\u3092\u884c\u3046\u5fc5\u8981\u304c\u3042\u308b\n\n\u306e2\u7b87\u6240\uff0e\u3053\u306e2\u70b9\u3092\u9664\u3051\u3070\u96e3\u3057\u3044\u3068\u3053\u308d\u306e\u306a\u3044\u30b9\u30af\u30ea\u30d7\u30c8\u3060\u3063\u305f\u3057\uff0c\u53c2\u8003URL\u306f\u30b3\u30e1\u30f3\u30c8\u3067\u8f09\u305b\u3066\u3042\u308b\u306e\u3067\u8aac\u660e\u306f\u7701\u304f\uff0e\n", "tags": ["JavaScript", "browser", "conkeror", "mozilla"]}