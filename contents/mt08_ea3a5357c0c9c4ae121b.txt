{"context": "\u3044\u3064\u3082\u3068\u611f\u3058\u304c\u3061\u304c\u3044\u307e\u3059\u304c\u3001\u3060\u3044\u305f\u3044\u30b3\u30d4\u30da\u3067\u3044\u3051\u308b\u304b\u3068\u3002 :-)\n\nOverview\n\nMaking your Wifi AP Router with DNS-based-Adblock on Raspberry Pi 3\n\n\nEnvironment\n\nRaspberry Pi 3 Model B\n\n\nEthernet(eth0): Connected to InternetIP address 192.168.22.65 is taken from DHCP server. ex)Cable router\nWifi(wlan0): Access Point.It will be static IP, set to 192.168.42.1\n\n\n\nmicroSD 8GB\nRaspbian Jessie Lite : 2016-11-25-raspbian-jessie-lite.img\n\n\n\nSteps\n\nRasPi: Initial setup to boot and to update\n\nCreating bootable microSD\n\n\nWindows 7 64bit\n\nRufus v2.11Portable\n\nChoose: 'Device'\nCreate a bootable disk using: DD image\n\nClick Disk icon, and pick Raspbian '.ZIP' file. (You don't need to extract zip. It will burn with extracting. :-) )\n\n\n\n\n(Optional) Create the file named 'ssh' on SD to allow ssh-login.\nBoot \nUpdate Packages:sudo apt update; sudo apt upgrade -y\n\nInstall hostapd:sudo apt install hostapd -y\n\n\n\nSetup : wlan0 as STATIC IP (192.168.42.1), hostapd and ip-forwarding\n\nCopy_and_Paste\n###\n# Make sure hostapd is installed :)\n# sudo apt install hostapd -y \n\n###\n# Unmanage: wlan0 by DHCPCD\necho denyinterfaces wlan0 | sudo tee -a /etc/dhcpcd.conf\n\n###\n# Modify: /etc/network/interfaces\nsudo sed -i \\\n-e 's/allow-hotplug wlan0/#allow-hotplug wlan0/g' \\\n-e 's/iface wlan0 inet manual/#iface wlan0 inet manual/g' \\\n-e 's@    wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf@#    wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf@'  \\\n/etc/network/interfaces\n\ncat <<EOF | sudo tee -a /etc/network/interfaces\n#\n# wlan0 - static IP \nallow-hotplug wlan0 \niface wlan0 inet static \n    address 192.168.42.1\n    netmask 255.255.255.0\n    network 192.168.42.0\n    broadcast 192.168.42.255\nEOF\n\n\n###\n# Create: /etc/hostapd/hostapd.conf\n#  ssid/wpa_passphrase = Pi3-AP/raspberry\n#  you may modify them.\ncat <<EOF | sudo tee /etc/hostapd/hostapd.conf\ninterface=wlan0\ndriver=nl80211\n#driver=rtl871xdrv\nhw_mode=g\nchannel=6\nieee80211n=1\nwmm_enabled=1\nht_capab=[HT40][SHORT-GI-20][DSSS_CCK-40]\nmacaddr_acl=0\nauth_algs=1\nignore_broadcast_ssid=0\nwpa=2\nwpa_key_mgmt=WPA-PSK\nrsn_pairwise=CCMP\nssid=Pi3-AP\nwpa_passphrase=raspberry\nEOF\n\n##\n# Edit: /etc/default/hostapd\necho DAEMON_CONF=\\\"/etc/hostapd/hostapd.conf\\\" | sudo tee -a /etc/default/hostapd\n\n##\n# Setting: IP Forward\nsudo sed -i -e 's/#net.ipv4.ip_forward=1/net.ipv4.ip_forward=1/g'  /etc/sysctl.conf\n#\nsudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE\nsudo iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT\nsudo iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT\nsudo sh -c \"iptables-save > /etc/iptables.ipv4.nat\"\n#\necho 'iptables-restore < /etc/iptables.ipv4.nat' | sudo tee /lib/dhcpcd/dhcpcd-hooks/70-ipv4-nat\n\n##\n# Reboot! \nsudo reboot\n## \n\n\n\nPi-hole: Install and setup\n\nInstall script:curl -L https://install.pi-hole.net | bashWait until configuration starts...\nEnter > Enter > Enter > Down Arrow > SpaceBar > Tab > Enter\n\nUp/Down and SpaceBar to select your favorite DNS, and Tab > Enter\n\nDown>SpaceBar>Tab>EnterUncheck IPv6\n\nRight(to select 'NO' when it shows eth0 IP address) > Enter\n\nEdit: 192.168.42.1/24Then, Tab > Enter\n\nEdit: 192.168.42.1Then, Tab > Enter\n\nMake sure, and Enter: \n\nTab>Enter\n\nWait ... The necessary packages will be installed. \nYou'll see the admin password.  \nPress Enter to back to shell.\nEdit: /etc/dhcpcd.conf - remove last 4 linessudo vi /etc/dhcpcd.conftype: Gdddddddd:wq[Enter] (shift+'g' to go to last line, 'dd' 4times to 4 remove lines, ':' to command, 'wq' to write and quit.)\nRebootsudo reboot\nOpen WebBrowser: http://RasPi_eth0_IP_Address/admin/settings.phpEnter admin-password to login, Check 'DHCP server enabled' and [Save]\n\n\n\nConnect to RPi3 Wifi Access Point\n\nYou'll find SSID 'RPi3-AP' and 'raspberry' as passphrase. (Or you change your own ones.)\n\n\nYou should modify /etc/hostapd/hostapd.conf for ssid=and wpa_passphrase=. \n\n\n\n\nWindows\nC:\\> ipconfig\n...\nWireless LAN adapter Wireless Network Connection:\n\n   Connection-specific DNS Suffix  . : local\n   IPv4 Address. . . . . . . . . . . : 192.168.42.213\n   Subnet Mask . . . . . . . . . . . : 255.255.255.0\n   Default Gateway . . . . . . . . . : 192.168.42.1\n...\nC:\\>nslookup www.google.com\nServer:  raspberrypi\nAddress:  192.168.42.1\n\nNon-authoritative answer:\nName:    www.google.com\nAddresses:  2607:f8b0:4005:804::2004\n          216.58.193.100\n\nC:\\>nslookup doubleclick.net\nServer:  raspberrypi\nAddress:  192.168.42.1\n\nName:    doubleclick.net\nAddresses:  2607:f8b0:4005:809::200e\n          192.168.42.1\n\nC:\\>\n\n\n\nOthers\n\nIf you lost admin password, you can change it by: pihole -a -p  your_new_password\n\nRelated:\n\n\n[\u30e1\u30e2] Raspberry Pi 3\u3067\u3001Wi-Fi \u30a2\u30af\u30bb\u30b9\u30dd\u30a4\u30f3\u30c8\u30eb\u30fc\u30bf\n\n\nIt's not enough to have been tested, it might something wrong. :-|\u3042\u307e\u308a\u30c6\u30b9\u30c8\u3057\u3066\u306a\u3044\u306e\u3067\u3001\u4e0d\u5177\u5408\u3042\u308b\u304b\u3082...\n\n\u3044\u3064\u3082\u3068\u611f\u3058\u304c\u3061\u304c\u3044\u307e\u3059\u304c\u3001\u3060\u3044\u305f\u3044\u30b3\u30d4\u30da\u3067\u3044\u3051\u308b\u304b\u3068\u3002 :-)\n\n## Overview\n- Making your Wifi AP Router with DNS-based-Adblock on Raspberry Pi 3\n\n\n\n## Environment\n\n- Raspberry Pi 3 Model B\n    - Ethernet(`eth0`): Connected to Internet<br>IP address `192.168.22.65` is taken from DHCP server. ex)Cable router\n    - Wifi(`wlan0`): Access Point.<br>It will be static IP, set to `192.168.42.1`\n- microSD 8GB\n- Raspbian Jessie Lite : [2016-11-25-raspbian-jessie-lite.img](https://downloads.raspberrypi.org/raspbian_lite/images/raspbian_lite-2016-11-29/)\n\n\n\n## Steps\n\n### RasPi: Initial setup to boot and to update\n1. Creating bootable microSD\n    - Windows 7 64bit\n    - [Rufus v2.11Portable](https://rufus.akeo.ie/downloads/rufus-2.11p.exe)\n        1. Choose: 'Device'\n        2. Create a bootable disk using: `DD image`\n        3. Click Disk icon, and pick Raspbian '.ZIP' file. (You don't need to extract zip. It will burn with extracting. :-) )\n2. (Optional) Create the file named '`ssh`' on SD to allow ssh-login.\n3. Boot \n4. Update Packages:<br>`sudo apt update; sudo apt upgrade -y`\n5. Install **hostapd**:<br>`sudo apt install hostapd -y`\n\n### Setup : wlan0 as STATIC IP (192.168.42.1), hostapd and ip-forwarding\n\n```bash:Copy_and_Paste\n###\n# Make sure hostapd is installed :)\n# sudo apt install hostapd -y \n\n###\n# Unmanage: wlan0 by DHCPCD\necho denyinterfaces wlan0 | sudo tee -a /etc/dhcpcd.conf\n\n###\n# Modify: /etc/network/interfaces\nsudo sed -i \\\n-e 's/allow-hotplug wlan0/#allow-hotplug wlan0/g' \\\n-e 's/iface wlan0 inet manual/#iface wlan0 inet manual/g' \\\n-e 's@    wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf@#    wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf@'  \\\n/etc/network/interfaces\n\ncat <<EOF | sudo tee -a /etc/network/interfaces\n#\n# wlan0 - static IP \nallow-hotplug wlan0 \niface wlan0 inet static \n    address 192.168.42.1\n    netmask 255.255.255.0\n    network 192.168.42.0\n    broadcast 192.168.42.255\nEOF\n\n\n###\n# Create: /etc/hostapd/hostapd.conf\n#  ssid/wpa_passphrase = Pi3-AP/raspberry\n#  you may modify them.\ncat <<EOF | sudo tee /etc/hostapd/hostapd.conf\ninterface=wlan0\ndriver=nl80211\n#driver=rtl871xdrv\nhw_mode=g\nchannel=6\nieee80211n=1\nwmm_enabled=1\nht_capab=[HT40][SHORT-GI-20][DSSS_CCK-40]\nmacaddr_acl=0\nauth_algs=1\nignore_broadcast_ssid=0\nwpa=2\nwpa_key_mgmt=WPA-PSK\nrsn_pairwise=CCMP\nssid=Pi3-AP\nwpa_passphrase=raspberry\nEOF\n\n##\n# Edit: /etc/default/hostapd\necho DAEMON_CONF=\\\"/etc/hostapd/hostapd.conf\\\" | sudo tee -a /etc/default/hostapd\n\n##\n# Setting: IP Forward\nsudo sed -i -e 's/#net.ipv4.ip_forward=1/net.ipv4.ip_forward=1/g'  /etc/sysctl.conf\n#\nsudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE\nsudo iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT\nsudo iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT\nsudo sh -c \"iptables-save > /etc/iptables.ipv4.nat\"\n#\necho 'iptables-restore < /etc/iptables.ipv4.nat' | sudo tee /lib/dhcpcd/dhcpcd-hooks/70-ipv4-nat\n\n##\n# Reboot! \nsudo reboot\n## \n```\n\n\n### [Pi-hole](https://pi-hole.net/): Install and setup\n1. Install script:<br>`curl -L https://install.pi-hole.net | bash`<br>Wait until configuration starts...\n2. Enter > Enter > Enter > Down Arrow > SpaceBar > Tab > Enter<br>![PiHoleWifiRouter04_.png](https://qiita-image-store.s3.amazonaws.com/0/75594/deb5074a-e6fe-f8a1-87e8-f6d3186c765e.png)\n3. Up/Down and SpaceBar to select your favorite DNS, and Tab > Enter<br>![PiHoleWifiRouter05.png](https://qiita-image-store.s3.amazonaws.com/0/75594/b99c04f2-1306-80af-549b-383daf7783d9.png)\n4. Down>SpaceBar>Tab>Enter<br>Uncheck IPv6<br>![PiHoleWifiRouter06_ipv4.png](https://qiita-image-store.s3.amazonaws.com/0/75594/94e938ef-a2a4-8057-93a7-7cff6aea6420.png)\n5. Right(to select 'NO' when it shows eth0 IP address) > Enter<br>![PiHoleWifiRouter07.png](https://qiita-image-store.s3.amazonaws.com/0/75594/95bd8ecf-5808-4a76-0e02-9945652857ff.png)\n6. Edit: `192.168.42.1/24`<br>Then, Tab > Enter<br>![PiHoleWifiRouter08.png](https://qiita-image-store.s3.amazonaws.com/0/75594/c78ac365-fe3c-4585-00ae-73c7c95cab60.png)\n7. Edit: `192.168.42.1`<br>Then, Tab > Enter<br>![PiHoleWifiRouter09.png](https://qiita-image-store.s3.amazonaws.com/0/75594/12ba342d-2b0a-9cde-ed60-5b8a79dff365.png)\n8. Make sure, and Enter: <br>![PiHoleWifiRouter10.png](https://qiita-image-store.s3.amazonaws.com/0/75594/d04077ca-4b94-05b6-14f4-794b99fc32de.png)\n9. Tab>Enter<br>![PiHoleWifiRouter12.png](https://qiita-image-store.s3.amazonaws.com/0/75594/fc4fa3e8-6283-2ed0-b8cf-d0dd89015422.png)\n10. Wait ... The necessary packages will be installed. \n11. You'll see the admin password.  <br>![PiHoleWifiRouter13_2.png](https://qiita-image-store.s3.amazonaws.com/0/75594/6a8687e5-04e5-1597-9429-97514e07954e.png)\n\n12. Press Enter to back to shell.\n\n13. <font color='red'>Edit: </font>**/etc/dhcpcd.conf** - remove last 4 lines<br>`sudo vi /etc/dhcpcd.conf`<br>type: `Gdddddddd:wq[Enter]` (shift+'g' to go to last line, 'dd' 4times to 4 remove lines, ':' to command, 'wq' to write and quit.)\n14. Reboot<br>`sudo reboot`\n\n15. Open WebBrowser: http://RasPi_eth0_IP_Address/admin/settings.php<br>Enter admin-password to login, Check 'DHCP server enabled' and \\[Save\\]\n<br>![PiHoleWifiRouter14.png](https://qiita-image-store.s3.amazonaws.com/0/75594/9ea26f0c-b693-3472-9549-ef495c08f707.png)\n\n\n### Connect to RPi3 Wifi Access Point\n- You'll find SSID 'RPi3-AP' and 'raspberry' as passphrase. (Or you change your own ones.)\n    - You should modify `/etc/hostapd/hostapd.conf` for `ssid=`and `wpa_passphrase=`. \n\n\n```txt:Windows\nC:\\> ipconfig\n...\nWireless LAN adapter Wireless Network Connection:\n\n   Connection-specific DNS Suffix  . : local\n   IPv4 Address. . . . . . . . . . . : 192.168.42.213\n   Subnet Mask . . . . . . . . . . . : 255.255.255.0\n   Default Gateway . . . . . . . . . : 192.168.42.1\n...\nC:\\>nslookup www.google.com\nServer:  raspberrypi\nAddress:  192.168.42.1\n\nNon-authoritative answer:\nName:    www.google.com\nAddresses:  2607:f8b0:4005:804::2004\n          216.58.193.100\n\nC:\\>nslookup doubleclick.net\nServer:  raspberrypi\nAddress:  192.168.42.1\n\nName:    doubleclick.net\nAddresses:  2607:f8b0:4005:809::200e\n          192.168.42.1\n\nC:\\>\n```\n\n## Others\n- If you lost admin password, you can change it by:<br> `pihole -a -p  your_new_password`\n- Related:\n    - [[\u30e1\u30e2] Raspberry Pi 3\u3067\u3001Wi-Fi \u30a2\u30af\u30bb\u30b9\u30dd\u30a4\u30f3\u30c8\u30eb\u30fc\u30bf](http://qiita.com/mt08/items/f2e4f9d3b1ed00849e23)\n- It's not enough to have been tested, it might something wrong. :-|<br>\u3042\u307e\u308a\u30c6\u30b9\u30c8\u3057\u3066\u306a\u3044\u306e\u3067\u3001\u4e0d\u5177\u5408\u3042\u308b\u304b\u3082...\n\n\n", "tags": ["RaspberryPi", "raspbian", "Pi-Hole", "dnsmasq"]}