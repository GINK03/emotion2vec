{"context": " More than 1 year has passed since last update.Babel 5 \u304b\u3089 6 \u306e\u9593\u306b API \u304c\u5927\u304d\u304f\u5909\u308f\u3063\u3066\u3044\u307e\u3059\u3002Babel 6 \u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306b\u306f Babel plugin handbook \u3092\u304a\u3059\u3059\u3081\u3057\u307e\u3059\u3002thejameskyle \u3055\u3093\u306f Babel \u306e\u30e1\u30f3\u30c6\u30ca\u306e\u4e00\u4eba\u3067\u3059\u3002\nES2015 \u3084 JSX \u3092 ES5 \u306b\u30c8\u30e9\u30f3\u30b9\u30d1\u30a4\u30eb\u3059\u308b Babel\u3002\u65e5\u5e38\u7684\u306b\u4f7f\u3063\u3066\u3044\u308b\u65b9\u3082\u591a\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u306e\u307e\u307e\u3067\u3082\u4fbf\u5229\u306a Babel \u3067\u3059\u304c\u3001\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f7f\u3046\u3053\u3068\u3067\u72ec\u81ea\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u5909\u63db\u30eb\u30fc\u30eb\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u79c1\u3082\u3061\u3087\u3063\u3068\u524d\u304b\u3089 Angular 2 \u30a2\u30d7\u30ea\u3092 Babel \u3067\u4f5c\u308b\u305f\u3081\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u66f8\u3044\u305f\u308a\u3057\u3066\u3044\u307e\u3057\u305f\u3002\u7d50\u69cb\u7c21\u5358\u306b\u4f5c\u308c\u308b\u306e\u3067\u3001Babel 5.x \u3067\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u308b\u65b9\u6cd5\u3092\u7d39\u4ecb\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nBabel \u306e\u4ed5\u7d44\u307f\n\u3056\u3063\u304f\u308a\u8a00\u3046\u3068 Babel \u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u4ed5\u7d44\u307f\u3067\u52d5\u3044\u3066\u3044\u307e\u3059\u3002\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u30d1\u30fc\u30b9\u3057\u3066 AST \u3092\u751f\u6210\uff08Babylon\uff09\nAST -> AST \u306e\u5909\u63db\uff08transformers\uff09\nAST \u304b\u3089 JS \u306e\u30b3\u30fc\u30c9\u3092\u751f\u6210\uff08generators\uff09\n\n1 \u3067\u8a00\u3046 AST \u3068\u3044\u3046\u306e\u306f Abstract Syntax Tree\uff08\u62bd\u8c61\u69cb\u6587\u6728\uff09\u3067\u3001\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u5404\u8981\u7d20\u3092\u30c4\u30ea\u30fc\u3068\u3057\u3066\u8868\u73fe\u3057\u305f\u3082\u306e\u3067\u3059\u3002Babel \u306e AST \u306f ESTree \u3068\u3044\u3046\u4ed5\u69d8\u306b\u57fa\u3065\u3044\u3066\u304a\u308a\u3001\u4ee5\u4e0b\u3067\u53c2\u7167\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002Babel \u3067\u306f\u3001\u3053\u308c\u3089\u306b\u3055\u3089\u306b ES7 \u3084 JSX \u306a\u3069\u306e\u975e\u6a19\u6e96\u306e\u30ce\u30fc\u30c9\u3082\u52a0\u308f\u308a\u307e\u3059\u3002\n\nCore\nES6\n\n2 \u306b\u306f\u672c\u4f53\u5185\u306e transformer\uff08class \u3092 ES5 \u3067\u52d5\u304f AST \u306b\u5909\u63db\u3057\u305f\u308a\uff09\u3068\uff08\u3082\u3057\u4f7f\u3063\u3066\u3044\u308c\u3070\uff09\u30b5\u30fc\u30c9\u30d1\u30fc\u30c6\u30a3\u30d7\u30e9\u30b0\u30a4\u30f3\u306e transformer \u304c\u542b\u307e\u308c\u307e\u3059\u3002Babel 6.x \u304b\u3089\u306f\u6a19\u6e96\u306e transformer \u3082\u5168\u3066\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u3057\u3066\u63d0\u4f9b\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u4e88\u5b9a\u3060\u305d\u3046\u3067\u3059\u3002\n\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u308b\u306e\u306f AST -> AST \u3092\u5909\u63db\u3059\u308b transformer \u3092\u66f8\u304f\u3060\u3051\u3002\u81ea\u5206\u3067 JS \u3092\u30d1\u30fc\u30b9\u3057\u305f\u308a AST \u304b\u3089 JS \u3092\u51fa\u529b\u3059\u308b\u5fc5\u8981\u306f\u306a\u3044\u306e\u3067\u7c21\u5358\u3067\u3059\u3002\u3055\u3089\u306b JS \u306e\u30d1\u30fc\u30b9\u3001\u51fa\u529b\u304c\u4e00\u56de\u3067\u6e08\u3080\u3067\u306e\u3001Babel \u3068\u5225\u306b JS \u3092\u30d1\u30fc\u30b9\u3059\u308b\u30c4\u30fc\u30eb\u3092\u5c0e\u5165\u3059\u308b\u3088\u308a\u3082\u591a\u5206\u306b\u52b9\u7387\u7684\u3067\u3059\u3002\u307e\u305f Babel \u306e API \u3092\u4f7f\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u3067\u3001esprima \u3068\u304b\u3092\u4f7f\u3063\u3066\u3084\u308b\u3088\u308a\u3082\u7c21\u5358\u306b\u66f8\u3051\u308b\u3088\u3046\u3067\u3059\uff08\u3084\u3063\u305f\u3053\u3068\u306a\u3044\u306e\u3067\u6bd4\u8f03\u3067\u304d\u306a\u3044\u3067\u3059\u304c\uff09\u3002\n\n\u3067\u304d\u308b\u3053\u3068\u3001\u3067\u304d\u306a\u3044\u3053\u3068\nBabylon \u304c\u30d1\u30fc\u30b9\u3067\u304d\u308b\u6587\u6cd5\u306e\u7bc4\u56f2\u5185\uff08ES2015, ES7+, JSX, flowtype \u306a\u3069\uff09\u3067\u3042\u308c\u3070 AST \u306e\u5909\u63db\u3067\u3067\u304d\u308b\u3053\u3068\u306f\u4f55\u3067\u3082\u3067\u304d\u307e\u3059\u3002\u305f\u3060\u3057 5.x \u3067\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u30d1\u30fc\u30b5\u3092\u62e1\u5f35\u3059\u308b\u4ed5\u7d44\u307f\u306f\u306a\u3044\u306e\u3067\u3001Babylon \u304c\u30d1\u30fc\u30b9\u3067\u304d\u306a\u3044\u6587\u6cd5\u3092\u5c0e\u5165\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\uff08Babylon \u306b\u30e2\u30f3\u30ad\u30fc\u30d1\u30c3\u30c1\u3059\u308c\u3070\u3067\u304d\u307e\u3059\u304c\u3002\uff09\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u4f5c\u6210\n\u4f55\u6545\u304b\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306f\u66f8\u304b\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3059\u304c npm install -g babel \u3067\u5165\u308b babel-plugin \u30b3\u30de\u30f3\u30c9\u3067\u30d7\u30e9\u30b0\u30a4\u30f3\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u3072\u306a\u5f62\u3092\u51fa\u529b\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002babel-plugin-* \u3068\u3044\u3046\u540d\u524d\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u81ea\u5206\u3067\u4f5c\u308b\u5fc5\u8981\u304c\u3042\u308b\u3053\u3068\u306b\u6ce8\u610f\u3002* \u306e\u90e8\u5206\u304c\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u540d\u524d\u306b\u306a\u308a\u307e\u3059\u3002\n# \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u7528\u610f\nmkdir babel-plugin-foo-bar\ncd babel-plugin-foo-bar\n# \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u3072\u306a\u5f62\u3092\u751f\u6210\nnpm install -g babel\nbabel-plugin init\n# \u4f9d\u5b58\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nnpm install\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u69cb\u6210\u304c\u3067\u304d\u3042\u304c\u308a\u307e\u3059\u3002\n.\n\u251c\u2500\u2500 .gitignore\n\u251c\u2500\u2500 .npmigonore\n\u251c\u2500\u2500 LICENSE\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 node_modules\n\u251c\u2500\u2500 package.json\n\u2514\u2500\u2500 src\n \u00a0\u00a0 \u2514\u2500\u2500 index.js\n\n\u4ee5\u4e0b\u306e npm run scripts \u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\nnpm run build: src \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4ee5\u4e0b\u3092 Babel \u3067\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u305f\u7d50\u679c\u3092 lib \u306b\u51fa\u529b\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\nnpm run push: \u30ea\u30ea\u30fc\u30b9\u7528\u306e\u30b3\u30de\u30f3\u30c9\u3002git \u3068 npm \u3092\u4e21\u65b9\u9762\u5012\u898b\u3066\u304f\u308c\u307e\u3059\u3002\n\nnpm test: babel-plugin test \u3068\u66f8\u304b\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u305d\u3046\u3044\u3046\u30bf\u30b9\u30af\u306f\u306a\u3044\u306e\u3067\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002\u5efa\u8a2d\u4e88\u5b9a\u5730\u306e\u6a21\u69d8\u3002\u30c6\u30b9\u30c8\u306f mocha \u306a\u3069\u81ea\u5206\u3067\u597d\u304d\u306a\u3082\u306e\u3092\u7528\u610f\u3057\u307e\u3057\u3087\u3046\u3002\n\nsrc \u3067 Babel \u3092\u4f7f\u3063\u305f\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u3001lib \u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u305f\u7d50\u679c\u3092\u51fa\u529b\u3002git \u306b\u306f src \u3092\u3001npm \u306b\u306f lib \u3092\u767b\u9332\u3059\u308b\u3068\u3044\u3046\u69cb\u6210\u3067\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u30d7\u30e9\u30b0\u30a4\u30f3\u305d\u306e\u3082\u306e\u3082 ES2015+ \u306e\u6587\u6cd5\u3067\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u66f8\u304d\u65b9\nbabel-plugin init \u3067\u51fa\u529b\u3055\u308c\u308b\u3072\u306a\u5f62\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\nsrc/index.js\n/* eslint no-unused-vars:0 */\nexport default function ({ Plugin, types: t }) {\n  return new Plugin(\"foo\", {\n    visitor: {\n      // your visitor methods go here\n    }\n  });\n}\n\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u306f\u3001Plugin \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8fd4\u3059\u95a2\u6570\u3092 export \u3057\u307e\u3059\u3002Plugin \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u306f\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u540d\u524d\u3068\u8a2d\u5b9a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u6e21\u3057\u307e\u3059\u3002\nAST \u306e\u5909\u63db\u51e6\u7406\u3092\u8a18\u8ff0\u3059\u308b\u306e\u304c visitor \u3067\u3059\u3002Babel transformer \u306f\u5909\u63db\u5bfe\u8c61\u306e AST \u3092\u4e0a\u304b\u3089\u4e0b\u307e\u3067\u79fb\u52d5\u3057\u3066\u3044\u304d\u307e\u3059\u3002visitor \u3067\u306f\u305d\u306e\u540d\u524d\u306e AST \u30ce\u30fc\u30c9\u3092\u8a2a\u308c\u305f\u6642\u306b\u5b9f\u884c\u3059\u308b\u51e6\u7406\u3092\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070\u4ee5\u4e0b\u306e\u4f8b\u3067\u306f\u30af\u30e9\u30b9\u5b9a\u7fa9\u3068\u95a2\u6570\u5b9a\u7fa9\u306e\u30ce\u30fc\u30c9\u306b\u5bfe\u3057\u3066\u51e6\u7406\u3092\u884c\u3048\u307e\u3059\u3002\n\nindex.js\nexport default function ({ Plugin, types: t }) {\n  return new Plugin('plugin-name', {\n    visitor: {\n      ClassDeclaration(node, parent) {\n        // \u30af\u30e9\u30b9\u5b9a\u7fa9\u306b\u4f55\u304b\u3059\u308b\u3002\n      },\n      FunctionDeclaration(node, parent) {\n        // \u95a2\u6570\u5b9a\u7fa9\u306b\u4f55\u304b\u3059\u308b\u3002\n      }\n    }\n  });\n};\n\n\n\u4f3c\u305f\u30ce\u30fc\u30c9\u306e\u30bf\u30a4\u30d7\u3092\u30b0\u30eb\u30fc\u30d7\u5316\u3057\u305f alias \u3068\u3044\u3046\u3082\u306e\u3092\u4f7f\u3046\u3068\u8907\u6570\u306e\u30ce\u30fc\u30c9\u306b\u30de\u30c3\u30c1\u3059\u308b visitor \u3092\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070 Function \u306f FunctionDeclaration, FunctionExpression \u3092\u307e\u3068\u3081\u305f\u3082\u306e\u3067\u3059\u3002\ntypes \u306f AST \u64cd\u4f5c\u306e\u305f\u3081\u306e\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u95a2\u6570\u7fa4\u3067\u3059\u3002\n\nAST \u30ce\u30fc\u30c9\u306e\u4f5c\u6210\uff08identifier(), memberExpression(), assignmentExpression \u306a\u3069\u30ce\u30fc\u30c9\u540d\u306e\u5148\u982d\u3092\u5c0f\u6587\u5b57\u306b\u3057\u305f\u3082\u306e\u3002\u5f15\u6570\u306e\u9806\u756a\u306fdefinitions \u306e builder \u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\uff09\nAST \u30ce\u30fc\u30c9\u306e\u5224\u5b9a\uff08isIdentifier(), isDecorator() \u306a\u3069\u3002\u7b2c\u4e8c\u5f15\u6570\u3067\u30d7\u30ed\u30d1\u30c6\u30a3\u3082\u30c1\u30a7\u30c3\u30af\u3067\u304d\u307e\u3059\u3002\uff09\n\n\u3053\u308c\u3089\u306e\u30e1\u30bd\u30c3\u30c9\u306f definitions \u306e\u5b9a\u7fa9\u304b\u3089\u751f\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u8a73\u7d30\u306f\u5b9a\u7fa9\u3092\u898b\u3066\u307f\u308b\u3068\u3044\u3044\u3067\u3057\u3087\u3046\u3002\ntypes \u3092\u4f7f\u3063\u305f AST \u5909\u63db\u306e\u65b9\u6cd5\u306f\u3001\u7d44\u307f\u8fbc\u307f\u306e transformer \u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9 \u3092\u898b\u308c\u3070\u5927\u4f53\u306e\u30d1\u30bf\u30fc\u30f3\u304c\u3042\u308b\u306e\u3067\u3001\u4e00\u89a7\u304b\u3089\u81ea\u5206\u306e\u884c\u3044\u305f\u3044\u5909\u63db\u306b\u8fd1\u3044 transformer \u3092\u63a2\u3057\u3066\u3001\u30bd\u30fc\u30b9\u3092\u898b\u3066\u307f\u308b\u306e\u304c\u4e00\u756a\u306e\u8fd1\u9053\u3060\u3068\u601d\u3044\u307e\u3059\u3002\u3042\u307e\u308a\u8a73\u3057\u304f\u66f8\u304b\u304b\u308c\u3066\u3044\u307e\u305b\u3093\u304c\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u3082\u76ee\u3092\u901a\u3057\u3066\u304a\u304f\u3068\u3044\u3044\u3067\u3057\u3087\u3046\u3002\n\n\u4f8b\uff08\u30af\u30e9\u30b9\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u5f15\u6570\u3092\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3068\u3057\u3066\u4ee3\u5165\u3059\u308b\uff09\n\u4f8b\u3068\u3057\u3066 babel-plugin-auto-assign \u3068\u3044\u3046\u300c\u30af\u30e9\u30b9\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u5f15\u6570\u3092\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3068\u3057\u3066\u4ee3\u5165\u3059\u308b\u300d\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u3063\u3066\u307f\u307e\u3059\u3002TypeScript \u306e parameter properties \u307f\u305f\u3044\u306a\u3084\u3064\u3067\u3059\u306d\u3002Angular \u3067 class \u30d9\u30fc\u30b9\u306e DI \u3092\u3059\u308b\u6642\u306a\u3069\u306b\u4fbf\u5229\u3067\u3059\u3002\n\u5168\u90e8\u306e class \u306b\u5bfe\u3057\u3066\u5b9f\u884c\u3059\u308b\u306e\u3082\u826f\u304f\u306a\u3044\u3067 @autoAssign \u3068\u3044\u3046 decorator \u304c\u3064\u3044\u305f class \u306b\u5bfe\u3057\u3066\u3060\u3051\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\u307e\u305f @autoAssign \u306f\u5f8c\u3067\u4f7f\u308f\u306a\u3044\u306e\u3067\u6d88\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u6700\u7d42\u7684\u306a\u30b3\u30fc\u30c9\u306b\u306f\u51fa\u3066\u3053\u306a\u3044 ambient decorator \u3068\u3044\u3046\u3084\u3064\u3067\u3059\u306d\u3002\n\nbefore.js\n@autoAssign\nclass Hello {\n  constructor(foo, bar, baz) {\n  }\n}\n\n\n\nafter.js\nclass Hello {\n  constructor(foo, bar, baz) {\n    this.foo = foo;\n    this.bar = bar;\n    this.baz = baz;\n  }\n}\n\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f Babel \u30d7\u30e9\u30b0\u30a4\u30f3\u306f class \u30b5\u30dd\u30fc\u30c8\u3092\u542b\u3080\u6a19\u6e96\u306e transformer \u3088\u308a\u3082\u524d\u306b\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\u3053\u306e\u305f\u3081 class \u306f class \u306e\u307e\u307e\u306b\u3057\u3066\u304a\u3044\u3066\u3082\u5f8c\u306b\u9069\u7528\u3055\u308c\u308b transformer \u304c ES5 \u306b\u5909\u63db\u3057\u3066\u304f\u308c\u307e\u3059\u3002\uff08\u6a19\u6e96\u306e transformer \u306e\u5f8c\u306b\u9069\u7528\u3057\u305f\u3044\u5834\u5408\u306f\u3001\u5229\u7528\u6642\u306b --plugins auto-assign:after \u306e\u3088\u3046\u306b\u540d\u524d\u306b :after \u3092\u4ed8\u3051\u307e\u3059\u3002\uff09\n\n\u5909\u63db\u524d\u5f8c\u306e AST\nAST \u306e\u5909\u63db\u3092\u3059\u308b\u306b\u306f\u3001\u5909\u63db\u524d\u5f8c\u306e AST \u306e\u5f62\u3092\u77e5\u3089\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u5165\u529b\u3059\u308b\u3068 AST \u3092\u8868\u793a\u3057\u3066\u304f\u308c\u308b JS AST Explorer \u3068\u3044\u3046\u4fbf\u5229\u306a\u30c4\u30fc\u30eb\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u3067\u5909\u63db\u524d\u5f8c\u306e AST \u3092\u8abf\u3079\u307e\u3057\u3087\u3046\u3002\u30d1\u30fc\u30b5\u30fc\u306f Babylon \u3092\u9078\u3073\u307e\u3059\u3002\n\n\u5909\u63db\u524d\n\u5909\u63db\u5f8c\n\nconsole.log() \u3067\u30ce\u30fc\u30c9\u3092\u8868\u793a\u3057\u306a\u304c\u3089\u958b\u767a\u3059\u308b\u306e\u3082\u6357\u308a\u307e\u3059\u3002\n\n\u5b9f\u969b\u306e\u30b3\u30fc\u30c9\n\u76ee\u6a19\u306e\u69cb\u9020\u304c\u308f\u304b\u308c\u3070\u3001\u3042\u3068\u306f\u66f8\u304f\u3060\u3051\u3067\u3059\u3002types \u3092\u4f7f\u3063\u3066\u5fc5\u8981\u306a AST \u30ce\u30fc\u30c9\u3092\u4f5c\u3063\u3066\u633f\u5165\u3057\u3066\u3044\u307e\u3059\u3002\n\u30c6\u30b9\u30c8\u65b9\u6cd5\u306a\u3069\u306f\u5b9f\u969b\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u3092\u898b\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\nsrc/index.js\nimport AutoAssign from './auto-assign';\n\nexport default function ({ Plugin, types: t }) {\n  return new Plugin('autoAssign', {\n    visitor: {\n      ClassDeclaration: function (node, parent) {\n        new AutoAssign(t).run(node);\n      }\n    }\n  });\n}\n\n\n\nsrc/auto-assign.js\nexport default class AutoAssign {\n  constructor(types) {\n    this.types = types;\n  }\n\n  run(klass) {\n    // @autoAssign \u3068\u3044\u3046 decorator \u304c\u3064\u3044\u3066\u3044\u308b\u6642\u3060\u3051\u5b9f\u884c\u3002\n    const decorators = this.findautoAssignDecorators(klass);\n    if (decorators.length > 0) {\n      // \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3068\u305d\u306e\u5f15\u6570\u3092\u53d6\u5f97\u3002\n      const ctor = this.findConstructor(klass);\n      const args = this.getArguments(ctor);\n      // \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u6700\u521d\u306b\u4ee3\u5165\u6587\u3092\u633f\u5165\u3002\n      this.prependAssignments(ctor, args);\n      // \u7528\u6e08\u307f\u306e @autoAssign \u3092\u524a\u9664\u3002\n      this.deleteDecorators(klass, decorators);\n    }\n  }\n\n  findautoAssignDecorators(klass) {\n    return (klass.decorators || []).filter((decorator) => {\n      return decorator.expression.name === 'autoAssign';\n    });\n  }\n\n  deleteDecorators(klass, decorators) {\n    decorators.forEach((decorator) => {\n      const index = klass.decorators.indexOf(decorator);\n      if (index >= 0) {\n        klass.decorators.splice(index, 1);\n      }\n    });\n  }\n\n  findConstructor(klass) {\n    return klass.body.body.filter((body) => {\n      return body.kind === 'constructor';\n    })[0];\n  }\n\n  getArguments(ctor) {\n    return ctor.value.params;\n  }\n\n  prependAssignments(ctor, args) {\n    const body = ctor.value.body.body;\n    args.slice().reverse().forEach((arg) => {\n      const assignment = this.buildAssignment(arg);\n      body.unshift(assignment);\n    });\n  }\n\n  buildAssignment(arg) {\n    const self = this.types.identifier('this');\n    const prop = this.types.memberExpression(self, arg);\n    const assignment = this.types.assignmentExpression('=', prop, arg);\n    return this.types.expressionStatement(assignment);\n  }\n}\n\n\n\n\u5b9f\u884c\n\u3053\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306f decorator \u3092\u30d1\u30fc\u30b9\u3057\u305f\u3044\u306e\u3067 --optional es7.decorators \u3092\u3064\u3051\u3066\u5b9f\u884c\u3057\u307e\u3059\u3002plugins \u306f npm module \u540d\u3060\u3051\u3067\u306f\u306a\u304f\u30d5\u30a1\u30a4\u30eb\u540d\u3067\u3082 OK \u3067\u3059\u3002\nnpm run build\necho '@autoAssign class Hello { constructor(foo, bar, baz) {} }' | babel --optional es7.decorators --plugins ./lib/index.js\n\n\noutput.js\n\"use strict\";\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Hello = (function () {\n  function Hello(foo, bar, baz) {\n    _classCallCheck(this, _Hello);\n\n    this.foo = foo;\n    this.bar = bar;\n    this.baz = baz;\n  }\n\n  var _Hello = Hello;\n  return Hello;\n})();\n\n\n\u3046\u307e\u304f\u884c\u304d\u307e\u3057\u305f\u3002\n\n\u516c\u958b\n\u3042\u3068\u306f README.md \u3092\u66f8\u3044\u305f\u3089 npm run push \u3067 npm \u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u3057\u3066\u5168\u4e16\u754c\u306b\u516c\u958b\u3067\u304d\u307e\u3059\u3002\n\u4fbf\u5229\u306a Babel \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u308a\u307e\u3057\u3087\u3046\uff01\n\n\u53c2\u8003\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\n\n\nPlugins - Babel\uff08\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\uff09 \nESTree\n\u7d44\u307f\u8fbc\u307f\u306e transformers\n\n\n\u5b9f\u4f8b\n\n\nshuhei/babel-plugin-auto-assign \u3053\u306e\u8a18\u4e8b\u306e\u4f8b\u3068\u3057\u3066\u4f5c\u3063\u305f\u3082\u306e\u3002\n\nshuhei/babel-plugin-angular2-annotations Angular 2 \u30a2\u30d7\u30ea\u3092 Babel \u3067\u4f5c\u308b\u305f\u3081\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3002Babylon \u306b\u30e2\u30f3\u30ad\u30fc\u30d1\u30c3\u30c1\u3057\u3066\u3001TypeScript \u306e\u3088\u3046\u306b\u30e1\u30bd\u30c3\u30c9\u306e\u5f15\u6570\u3078 decorator \u3092\u4ed8\u3051\u3089\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n**Babel 5 \u304b\u3089 6 \u306e\u9593\u306b API \u304c\u5927\u304d\u304f\u5909\u308f\u3063\u3066\u3044\u307e\u3059\u3002Babel 6 \u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306b\u306f [Babel plugin handbook](https://github.com/thejameskyle/babel-plugin-handbook) \u3092\u304a\u3059\u3059\u3081\u3057\u307e\u3059\u3002**thejameskyle \u3055\u3093\u306f Babel \u306e\u30e1\u30f3\u30c6\u30ca\u306e\u4e00\u4eba\u3067\u3059\u3002\n\nES2015 \u3084 JSX \u3092 ES5 \u306b\u30c8\u30e9\u30f3\u30b9\u30d1\u30a4\u30eb\u3059\u308b [Babel](https://babeljs.io/)\u3002\u65e5\u5e38\u7684\u306b\u4f7f\u3063\u3066\u3044\u308b\u65b9\u3082\u591a\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u305d\u306e\u307e\u307e\u3067\u3082\u4fbf\u5229\u306a Babel \u3067\u3059\u304c\u3001\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f7f\u3046\u3053\u3068\u3067\u72ec\u81ea\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u5909\u63db\u30eb\u30fc\u30eb\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u79c1\u3082\u3061\u3087\u3063\u3068\u524d\u304b\u3089 [Angular 2 \u30a2\u30d7\u30ea\u3092 Babel \u3067\u4f5c\u308b\u305f\u3081\u306e\u30d7\u30e9\u30b0\u30a4\u30f3](https://github.com/shuhei/babel-plugin-angular2-annotations)\u3092\u66f8\u3044\u305f\u308a\u3057\u3066\u3044\u307e\u3057\u305f\u3002\u7d50\u69cb\u7c21\u5358\u306b\u4f5c\u308c\u308b\u306e\u3067\u3001Babel 5.x \u3067\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u308b\u65b9\u6cd5\u3092\u7d39\u4ecb\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n## Babel \u306e\u4ed5\u7d44\u307f\n\n\u3056\u3063\u304f\u308a\u8a00\u3046\u3068 Babel \u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u4ed5\u7d44\u307f\u3067\u52d5\u3044\u3066\u3044\u307e\u3059\u3002\n\n1. \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u30d1\u30fc\u30b9\u3057\u3066 AST \u3092\u751f\u6210\uff08Babylon\uff09\n2. AST -> AST \u306e\u5909\u63db\uff08transformers\uff09\n3. AST \u304b\u3089 JS \u306e\u30b3\u30fc\u30c9\u3092\u751f\u6210\uff08generators\uff09\n\n1 \u3067\u8a00\u3046 AST \u3068\u3044\u3046\u306e\u306f Abstract Syntax Tree\uff08\u62bd\u8c61\u69cb\u6587\u6728\uff09\u3067\u3001\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u5404\u8981\u7d20\u3092\u30c4\u30ea\u30fc\u3068\u3057\u3066\u8868\u73fe\u3057\u305f\u3082\u306e\u3067\u3059\u3002Babel \u306e AST \u306f ESTree \u3068\u3044\u3046\u4ed5\u69d8\u306b\u57fa\u3065\u3044\u3066\u304a\u308a\u3001\u4ee5\u4e0b\u3067\u53c2\u7167\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002Babel \u3067\u306f\u3001\u3053\u308c\u3089\u306b\u3055\u3089\u306b ES7 \u3084 JSX \u306a\u3069\u306e\u975e\u6a19\u6e96\u306e\u30ce\u30fc\u30c9\u3082\u52a0\u308f\u308a\u307e\u3059\u3002\n\n- [Core](https://github.com/estree/estree/blob/master/spec.md)\n- [ES6](https://github.com/estree/estree/blob/master/es6.md)\n\n2 \u306b\u306f[\u672c\u4f53\u5185\u306e transformer](https://babeljs.io/docs/advanced/transformers/)\uff08class \u3092 ES5 \u3067\u52d5\u304f AST \u306b\u5909\u63db\u3057\u305f\u308a\uff09\u3068\uff08\u3082\u3057\u4f7f\u3063\u3066\u3044\u308c\u3070\uff09\u30b5\u30fc\u30c9\u30d1\u30fc\u30c6\u30a3\u30d7\u30e9\u30b0\u30a4\u30f3\u306e transformer \u304c\u542b\u307e\u308c\u307e\u3059\u3002Babel 6.x \u304b\u3089\u306f\u6a19\u6e96\u306e transformer \u3082\u5168\u3066\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u3057\u3066\u63d0\u4f9b\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u4e88\u5b9a\u3060\u305d\u3046\u3067\u3059\u3002\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u308b\u306e\u306f AST -> AST \u3092\u5909\u63db\u3059\u308b transformer \u3092\u66f8\u304f\u3060\u3051\u3002\u81ea\u5206\u3067 JS \u3092\u30d1\u30fc\u30b9\u3057\u305f\u308a AST \u304b\u3089 JS \u3092\u51fa\u529b\u3059\u308b\u5fc5\u8981\u306f\u306a\u3044\u306e\u3067\u7c21\u5358\u3067\u3059\u3002\u3055\u3089\u306b JS \u306e\u30d1\u30fc\u30b9\u3001\u51fa\u529b\u304c\u4e00\u56de\u3067\u6e08\u3080\u3067\u306e\u3001Babel \u3068\u5225\u306b JS \u3092\u30d1\u30fc\u30b9\u3059\u308b\u30c4\u30fc\u30eb\u3092\u5c0e\u5165\u3059\u308b\u3088\u308a\u3082\u591a\u5206\u306b\u52b9\u7387\u7684\u3067\u3059\u3002\u307e\u305f Babel \u306e API \u3092\u4f7f\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u3067\u3001esprima \u3068\u304b\u3092\u4f7f\u3063\u3066\u3084\u308b\u3088\u308a\u3082\u7c21\u5358\u306b\u66f8\u3051\u308b\u3088\u3046\u3067\u3059\uff08\u3084\u3063\u305f\u3053\u3068\u306a\u3044\u306e\u3067\u6bd4\u8f03\u3067\u304d\u306a\u3044\u3067\u3059\u304c\uff09\u3002\n\n## \u3067\u304d\u308b\u3053\u3068\u3001\u3067\u304d\u306a\u3044\u3053\u3068\n\nBabylon \u304c\u30d1\u30fc\u30b9\u3067\u304d\u308b\u6587\u6cd5\u306e\u7bc4\u56f2\u5185\uff08ES2015, ES7+, JSX, flowtype \u306a\u3069\uff09\u3067\u3042\u308c\u3070 AST \u306e\u5909\u63db\u3067\u3067\u304d\u308b\u3053\u3068\u306f\u4f55\u3067\u3082\u3067\u304d\u307e\u3059\u3002\u305f\u3060\u3057 5.x \u3067\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u30d1\u30fc\u30b5\u3092\u62e1\u5f35\u3059\u308b\u4ed5\u7d44\u307f\u306f\u306a\u3044\u306e\u3067\u3001Babylon \u304c\u30d1\u30fc\u30b9\u3067\u304d\u306a\u3044\u6587\u6cd5\u3092\u5c0e\u5165\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\uff08Babylon \u306b\u30e2\u30f3\u30ad\u30fc\u30d1\u30c3\u30c1\u3059\u308c\u3070\u3067\u304d\u307e\u3059\u304c\u3002\uff09\n\n## \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u4f5c\u6210\n\n\u4f55\u6545\u304b\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306f\u66f8\u304b\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3059\u304c `npm install -g babel` \u3067\u5165\u308b `babel-plugin` \u30b3\u30de\u30f3\u30c9\u3067\u30d7\u30e9\u30b0\u30a4\u30f3\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u3072\u306a\u5f62\u3092\u51fa\u529b\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002`babel-plugin-*` \u3068\u3044\u3046\u540d\u524d\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u81ea\u5206\u3067\u4f5c\u308b\u5fc5\u8981\u304c\u3042\u308b\u3053\u3068\u306b\u6ce8\u610f\u3002`*` \u306e\u90e8\u5206\u304c\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u540d\u524d\u306b\u306a\u308a\u307e\u3059\u3002\n\n```\n# \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u7528\u610f\nmkdir babel-plugin-foo-bar\ncd babel-plugin-foo-bar\n# \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u3072\u306a\u5f62\u3092\u751f\u6210\nnpm install -g babel\nbabel-plugin init\n# \u4f9d\u5b58\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nnpm install\n```\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u69cb\u6210\u304c\u3067\u304d\u3042\u304c\u308a\u307e\u3059\u3002\n\n```\n.\n\u251c\u2500\u2500 .gitignore\n\u251c\u2500\u2500 .npmigonore\n\u251c\u2500\u2500 LICENSE\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 node_modules\n\u251c\u2500\u2500 package.json\n\u2514\u2500\u2500 src\n \u00a0\u00a0 \u2514\u2500\u2500 index.js\n```\n\n\u4ee5\u4e0b\u306e npm run scripts \u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n- `npm run build`: `src` \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4ee5\u4e0b\u3092 Babel \u3067\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u305f\u7d50\u679c\u3092 `lib` \u306b\u51fa\u529b\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n- `npm run push`: \u30ea\u30ea\u30fc\u30b9\u7528\u306e\u30b3\u30de\u30f3\u30c9\u3002git \u3068 npm \u3092\u4e21\u65b9\u9762\u5012\u898b\u3066\u304f\u308c\u307e\u3059\u3002\n- `npm test`: `babel-plugin test` \u3068\u66f8\u304b\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u305d\u3046\u3044\u3046\u30bf\u30b9\u30af\u306f\u306a\u3044\u306e\u3067\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002[\u5efa\u8a2d\u4e88\u5b9a\u5730\u306e\u6a21\u69d8\u3002](https://github.com/babel/babel/issues/1950)\u30c6\u30b9\u30c8\u306f mocha \u306a\u3069\u81ea\u5206\u3067\u597d\u304d\u306a\u3082\u306e\u3092\u7528\u610f\u3057\u307e\u3057\u3087\u3046\u3002\n\n`src` \u3067 Babel \u3092\u4f7f\u3063\u305f\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u3001`lib` \u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u305f\u7d50\u679c\u3092\u51fa\u529b\u3002git \u306b\u306f `src` \u3092\u3001npm \u306b\u306f `lib` \u3092\u767b\u9332\u3059\u308b\u3068\u3044\u3046\u69cb\u6210\u3067\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u30d7\u30e9\u30b0\u30a4\u30f3\u305d\u306e\u3082\u306e\u3082 ES2015+ \u306e\u6587\u6cd5\u3067\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n## \u66f8\u304d\u65b9\n\n`babel-plugin init` \u3067\u51fa\u529b\u3055\u308c\u308b\u3072\u306a\u5f62\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n```src/index.js\n/* eslint no-unused-vars:0 */\nexport default function ({ Plugin, types: t }) {\n  return new Plugin(\"foo\", {\n    visitor: {\n      // your visitor methods go here\n    }\n  });\n}\n```\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u306f\u3001`Plugin` \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8fd4\u3059\u95a2\u6570\u3092 `export` \u3057\u307e\u3059\u3002`Plugin` \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u306f\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u540d\u524d\u3068\u8a2d\u5b9a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u6e21\u3057\u307e\u3059\u3002\n\nAST \u306e\u5909\u63db\u51e6\u7406\u3092\u8a18\u8ff0\u3059\u308b\u306e\u304c `visitor` \u3067\u3059\u3002Babel transformer \u306f\u5909\u63db\u5bfe\u8c61\u306e AST \u3092\u4e0a\u304b\u3089\u4e0b\u307e\u3067\u79fb\u52d5\u3057\u3066\u3044\u304d\u307e\u3059\u3002`visitor` \u3067\u306f\u305d\u306e\u540d\u524d\u306e AST \u30ce\u30fc\u30c9\u3092\u8a2a\u308c\u305f\u6642\u306b\u5b9f\u884c\u3059\u308b\u51e6\u7406\u3092\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070\u4ee5\u4e0b\u306e\u4f8b\u3067\u306f\u30af\u30e9\u30b9\u5b9a\u7fa9\u3068\u95a2\u6570\u5b9a\u7fa9\u306e\u30ce\u30fc\u30c9\u306b\u5bfe\u3057\u3066\u51e6\u7406\u3092\u884c\u3048\u307e\u3059\u3002\n\n```index.js\nexport default function ({ Plugin, types: t }) {\n  return new Plugin('plugin-name', {\n    visitor: {\n      ClassDeclaration(node, parent) {\n        // \u30af\u30e9\u30b9\u5b9a\u7fa9\u306b\u4f55\u304b\u3059\u308b\u3002\n      },\n      FunctionDeclaration(node, parent) {\n        // \u95a2\u6570\u5b9a\u7fa9\u306b\u4f55\u304b\u3059\u308b\u3002\n      }\n    }\n  });\n};\n```\n\n\u4f3c\u305f\u30ce\u30fc\u30c9\u306e\u30bf\u30a4\u30d7\u3092\u30b0\u30eb\u30fc\u30d7\u5316\u3057\u305f alias \u3068\u3044\u3046\u3082\u306e\u3092\u4f7f\u3046\u3068\u8907\u6570\u306e\u30ce\u30fc\u30c9\u306b\u30de\u30c3\u30c1\u3059\u308b visitor \u3092\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070 `Function` \u306f `FunctionDeclaration`, `FunctionExpression` \u3092\u307e\u3068\u3081\u305f\u3082\u306e\u3067\u3059\u3002\n\n`types` \u306f AST \u64cd\u4f5c\u306e\u305f\u3081\u306e\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u95a2\u6570\u7fa4\u3067\u3059\u3002\n\n- AST \u30ce\u30fc\u30c9\u306e\u4f5c\u6210\uff08`identifier()`, `memberExpression()`, `assignmentExpression` \u306a\u3069\u30ce\u30fc\u30c9\u540d\u306e\u5148\u982d\u3092\u5c0f\u6587\u5b57\u306b\u3057\u305f\u3082\u306e\u3002\u5f15\u6570\u306e\u9806\u756a\u306f[definitions](https://github.com/babel/babel/tree/v5.8.24/packages/babel/src/types/definitions) \u306e `builder` \u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\uff09\n- AST \u30ce\u30fc\u30c9\u306e\u5224\u5b9a\uff08`isIdentifier()`, `isDecorator()` \u306a\u3069\u3002\u7b2c\u4e8c\u5f15\u6570\u3067\u30d7\u30ed\u30d1\u30c6\u30a3\u3082\u30c1\u30a7\u30c3\u30af\u3067\u304d\u307e\u3059\u3002\uff09\n\n\u3053\u308c\u3089\u306e\u30e1\u30bd\u30c3\u30c9\u306f [definitions](https://github.com/babel/babel/tree/v5.8.24/packages/babel/src/types/definitions) \u306e\u5b9a\u7fa9\u304b\u3089[\u751f\u6210\u3055\u308c\u3066\u3044\u307e\u3059](https://github.com/babel/babel/blob/v5.8.24/packages/babel/src/types/index.js)\u3002\u8a73\u7d30\u306f\u5b9a\u7fa9\u3092\u898b\u3066\u307f\u308b\u3068\u3044\u3044\u3067\u3057\u3087\u3046\u3002\n\ntypes \u3092\u4f7f\u3063\u305f AST \u5909\u63db\u306e\u65b9\u6cd5\u306f\u3001[\u7d44\u307f\u8fbc\u307f\u306e transformer \u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9](https://github.com/babel/babel/tree/v5.8.24/packages/babel/src/transformation/transformers) \u3092\u898b\u308c\u3070\u5927\u4f53\u306e\u30d1\u30bf\u30fc\u30f3\u304c\u3042\u308b\u306e\u3067\u3001[\u4e00\u89a7](https://babeljs.io/docs/advanced/transformers/)\u304b\u3089\u81ea\u5206\u306e\u884c\u3044\u305f\u3044\u5909\u63db\u306b\u8fd1\u3044 transformer \u3092\u63a2\u3057\u3066\u3001\u30bd\u30fc\u30b9\u3092\u898b\u3066\u307f\u308b\u306e\u304c\u4e00\u756a\u306e\u8fd1\u9053\u3060\u3068\u601d\u3044\u307e\u3059\u3002\u3042\u307e\u308a\u8a73\u3057\u304f\u66f8\u304b\u304b\u308c\u3066\u3044\u307e\u305b\u3093\u304c[\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](https://babeljs.io/docs/advanced/plugins/)\u306b\u3082\u76ee\u3092\u901a\u3057\u3066\u304a\u304f\u3068\u3044\u3044\u3067\u3057\u3087\u3046\u3002\n\n## \u4f8b\uff08\u30af\u30e9\u30b9\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u5f15\u6570\u3092\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3068\u3057\u3066\u4ee3\u5165\u3059\u308b\uff09\n\n\u4f8b\u3068\u3057\u3066 [babel-plugin-auto-assign](https://github.com/shuhei/babel-plugin-auto-assign) \u3068\u3044\u3046\u300c\u30af\u30e9\u30b9\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u5f15\u6570\u3092\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3068\u3057\u3066\u4ee3\u5165\u3059\u308b\u300d\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u3063\u3066\u307f\u307e\u3059\u3002TypeScript \u306e parameter properties \u307f\u305f\u3044\u306a\u3084\u3064\u3067\u3059\u306d\u3002Angular \u3067 class \u30d9\u30fc\u30b9\u306e DI \u3092\u3059\u308b\u6642\u306a\u3069\u306b\u4fbf\u5229\u3067\u3059\u3002\n\n\u5168\u90e8\u306e class \u306b\u5bfe\u3057\u3066\u5b9f\u884c\u3059\u308b\u306e\u3082\u826f\u304f\u306a\u3044\u3067 `@autoAssign` \u3068\u3044\u3046 decorator \u304c\u3064\u3044\u305f class \u306b\u5bfe\u3057\u3066\u3060\u3051\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\u307e\u305f `@autoAssign` \u306f\u5f8c\u3067\u4f7f\u308f\u306a\u3044\u306e\u3067\u6d88\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u6700\u7d42\u7684\u306a\u30b3\u30fc\u30c9\u306b\u306f\u51fa\u3066\u3053\u306a\u3044 [ambient decorator](https://github.com/jonathandturner/brainstorming/blob/master/README.md#c6-ambient-decorators) \u3068\u3044\u3046\u3084\u3064\u3067\u3059\u306d\u3002\n\n```before.js\n@autoAssign\nclass Hello {\n  constructor(foo, bar, baz) {\n  }\n}\n```\n\n```after.js\nclass Hello {\n  constructor(foo, bar, baz) {\n    this.foo = foo;\n    this.bar = bar;\n    this.baz = baz;\n  }\n}\n```\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f Babel \u30d7\u30e9\u30b0\u30a4\u30f3\u306f class \u30b5\u30dd\u30fc\u30c8\u3092\u542b\u3080\u6a19\u6e96\u306e transformer \u3088\u308a\u3082\u524d\u306b\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\u3053\u306e\u305f\u3081 class \u306f class \u306e\u307e\u307e\u306b\u3057\u3066\u304a\u3044\u3066\u3082\u5f8c\u306b\u9069\u7528\u3055\u308c\u308b transformer \u304c ES5 \u306b\u5909\u63db\u3057\u3066\u304f\u308c\u307e\u3059\u3002\uff08\u6a19\u6e96\u306e transformer \u306e\u5f8c\u306b\u9069\u7528\u3057\u305f\u3044\u5834\u5408\u306f\u3001\u5229\u7528\u6642\u306b `--plugins auto-assign:after` \u306e\u3088\u3046\u306b\u540d\u524d\u306b `:after` \u3092\u4ed8\u3051\u307e\u3059\u3002\uff09\n\n## \u5909\u63db\u524d\u5f8c\u306e AST\n\nAST \u306e\u5909\u63db\u3092\u3059\u308b\u306b\u306f\u3001\u5909\u63db\u524d\u5f8c\u306e AST \u306e\u5f62\u3092\u77e5\u3089\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u5165\u529b\u3059\u308b\u3068 AST \u3092\u8868\u793a\u3057\u3066\u304f\u308c\u308b [JS AST Explorer](http://felix-kling.de/esprima_ast_explorer) \u3068\u3044\u3046\u4fbf\u5229\u306a\u30c4\u30fc\u30eb\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u3067\u5909\u63db\u524d\u5f8c\u306e AST \u3092\u8abf\u3079\u307e\u3057\u3087\u3046\u3002\u30d1\u30fc\u30b5\u30fc\u306f Babylon \u3092\u9078\u3073\u307e\u3059\u3002\n\n- [\u5909\u63db\u524d](http://felix-kling.de/esprima_ast_explorer/#/OuFSNzgCl2)\n- [\u5909\u63db\u5f8c](http://felix-kling.de/esprima_ast_explorer/#/tZsOQTyns6)\n\n`console.log()` \u3067\u30ce\u30fc\u30c9\u3092\u8868\u793a\u3057\u306a\u304c\u3089\u958b\u767a\u3059\u308b\u306e\u3082\u6357\u308a\u307e\u3059\u3002\n\n## \u5b9f\u969b\u306e\u30b3\u30fc\u30c9\n\n\u76ee\u6a19\u306e\u69cb\u9020\u304c\u308f\u304b\u308c\u3070\u3001\u3042\u3068\u306f\u66f8\u304f\u3060\u3051\u3067\u3059\u3002types \u3092\u4f7f\u3063\u3066\u5fc5\u8981\u306a AST \u30ce\u30fc\u30c9\u3092\u4f5c\u3063\u3066\u633f\u5165\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30c6\u30b9\u30c8\u65b9\u6cd5\u306a\u3069\u306f[\u5b9f\u969b\u306e\u30ec\u30dd\u30b8\u30c8\u30ea](https://github.com/shuhei/babel-plugin-auto-assign)\u3092\u898b\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\n```src/index.js\nimport AutoAssign from './auto-assign';\n\nexport default function ({ Plugin, types: t }) {\n  return new Plugin('autoAssign', {\n    visitor: {\n      ClassDeclaration: function (node, parent) {\n        new AutoAssign(t).run(node);\n      }\n    }\n  });\n}\n```\n\n```src/auto-assign.js\nexport default class AutoAssign {\n  constructor(types) {\n    this.types = types;\n  }\n\n  run(klass) {\n    // @autoAssign \u3068\u3044\u3046 decorator \u304c\u3064\u3044\u3066\u3044\u308b\u6642\u3060\u3051\u5b9f\u884c\u3002\n    const decorators = this.findautoAssignDecorators(klass);\n    if (decorators.length > 0) {\n      // \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3068\u305d\u306e\u5f15\u6570\u3092\u53d6\u5f97\u3002\n      const ctor = this.findConstructor(klass);\n      const args = this.getArguments(ctor);\n      // \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u6700\u521d\u306b\u4ee3\u5165\u6587\u3092\u633f\u5165\u3002\n      this.prependAssignments(ctor, args);\n      // \u7528\u6e08\u307f\u306e @autoAssign \u3092\u524a\u9664\u3002\n      this.deleteDecorators(klass, decorators);\n    }\n  }\n\n  findautoAssignDecorators(klass) {\n    return (klass.decorators || []).filter((decorator) => {\n      return decorator.expression.name === 'autoAssign';\n    });\n  }\n\n  deleteDecorators(klass, decorators) {\n    decorators.forEach((decorator) => {\n      const index = klass.decorators.indexOf(decorator);\n      if (index >= 0) {\n        klass.decorators.splice(index, 1);\n      }\n    });\n  }\n\n  findConstructor(klass) {\n    return klass.body.body.filter((body) => {\n      return body.kind === 'constructor';\n    })[0];\n  }\n\n  getArguments(ctor) {\n    return ctor.value.params;\n  }\n\n  prependAssignments(ctor, args) {\n    const body = ctor.value.body.body;\n    args.slice().reverse().forEach((arg) => {\n      const assignment = this.buildAssignment(arg);\n      body.unshift(assignment);\n    });\n  }\n\n  buildAssignment(arg) {\n    const self = this.types.identifier('this');\n    const prop = this.types.memberExpression(self, arg);\n    const assignment = this.types.assignmentExpression('=', prop, arg);\n    return this.types.expressionStatement(assignment);\n  }\n}\n```\n\n## \u5b9f\u884c\n\n\u3053\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306f decorator \u3092\u30d1\u30fc\u30b9\u3057\u305f\u3044\u306e\u3067 `--optional es7.decorators` \u3092\u3064\u3051\u3066\u5b9f\u884c\u3057\u307e\u3059\u3002plugins \u306f npm module \u540d\u3060\u3051\u3067\u306f\u306a\u304f\u30d5\u30a1\u30a4\u30eb\u540d\u3067\u3082 OK \u3067\u3059\u3002\n\n```\nnpm run build\necho '@autoAssign class Hello { constructor(foo, bar, baz) {} }' | babel --optional es7.decorators --plugins ./lib/index.js\n```\n\n```output.js\n\"use strict\";\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Hello = (function () {\n  function Hello(foo, bar, baz) {\n    _classCallCheck(this, _Hello);\n\n    this.foo = foo;\n    this.bar = bar;\n    this.baz = baz;\n  }\n\n  var _Hello = Hello;\n  return Hello;\n})();\n```\n\n\u3046\u307e\u304f\u884c\u304d\u307e\u3057\u305f\u3002\n\n## \u516c\u958b\n\n\u3042\u3068\u306f README.md \u3092\u66f8\u3044\u305f\u3089 `npm run push` \u3067 npm \u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u3057\u3066\u5168\u4e16\u754c\u306b\u516c\u958b\u3067\u304d\u307e\u3059\u3002\n\n\u4fbf\u5229\u306a Babel \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u308a\u307e\u3057\u3087\u3046\uff01\n\n## \u53c2\u8003\n\n### \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\n\n- [Plugins - Babel\uff08\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\uff09](https://babeljs.io/docs/advanced/plugins/) \n- [ESTree](https://github.com/estree/estree)\n- [\u7d44\u307f\u8fbc\u307f\u306e transformers](https://github.com/babel/babel/tree/v5.8.24/packages/babel/src/transformation/transformers)\n\n### \u5b9f\u4f8b\n\n- [shuhei/babel-plugin-auto-assign](https://github.com/shuhei/babel-plugin-auto-assign) \u3053\u306e\u8a18\u4e8b\u306e\u4f8b\u3068\u3057\u3066\u4f5c\u3063\u305f\u3082\u306e\u3002\n- [shuhei/babel-plugin-angular2-annotations](https://github.com/shuhei/babel-plugin-angular2-annotations) Angular 2 \u30a2\u30d7\u30ea\u3092 Babel \u3067\u4f5c\u308b\u305f\u3081\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3002Babylon \u306b\u30e2\u30f3\u30ad\u30fc\u30d1\u30c3\u30c1\u3057\u3066\u3001TypeScript \u306e\u3088\u3046\u306b\u30e1\u30bd\u30c3\u30c9\u306e\u5f15\u6570\u3078 decorator \u3092\u4ed8\u3051\u3089\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n", "tags": ["JavaScript", "babel"]}