{"tags": ["hadoop", "hive", "Presto", "MySQL", "TreasureData"], "context": "HiveQL\u3067\u306f\u30b9\u30d4\u30fc\u30c9\u306b\u96e3\u3092\u611f\u3058\u3066\u3044\u305f\u305f\u3081\u3001\u79c1\u3082Presto\u3092\u4f7f\u3044\u59cb\u3081\u307e\u3057\u305f\u3002\nMySQL\u3084Hive\u3067\u4f7f\u3063\u3066\u3044\u305f\u30af\u30a8\u30ea\u3092\u7f6e\u304d\u63db\u3048\u308b\u6642\u306b\u30cf\u30de\u3063\u305fTips\u3092\u307e\u3068\u3081\u3066\u3044\u304d\u307e\u3059\u3002\n\nPresto\u3068\u306f\nPresto\u306f\u30aa\u30f3\u30e1\u30e2\u30ea\u3067\u52d5\u304f\u5206\u6563SQL\u30a8\u30f3\u30b8\u30f3\u3067\u3001\u305d\u306e\u9032\u5316\u306f\u76ee\u3092\u898b\u5f35\u308b\u7269\u3067\u3059\u3002\n\u767a\u8868\u3055\u308c\u305f\u5f53\u6642\u306f\u8272\u3005\u306a\u6210\u7d04\u304c\u3042\u308a\u4f7f\u3046\u3053\u3068\u3092\u8e8a\u8e87\u3057\u3066\u3044\u307e\u3057\u305f\u304c\u30012015\u5e741\u6708\u73fe\u5728\u306f\u3082\u3046\u4f7f\u308f\u306a\u3044\u7406\u7531\u306f\u306a\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n\u30a2\u30c9\u30db\u30c3\u30af\u306b\u4f7f\u3048\u308b\u3068\u3066\u3082\u9ad8\u901f\u306aSQL\u30a8\u30f3\u30b8\u30f3\u3067\u3059\u306e\u3067\u3001\u30d0\u30c3\u30c1\u5411\u3051\u306eHive\u306e\u3088\u3046\u306b\u5b9f\u884c\u7d50\u679c\u3092\u5f85\u3064\u6642\u9593\u306f\u307b\u3068\u3093\u3069\u3042\u308a\u307e\u305b\u3093\u3002\nHive\u3067\u3059\u30681\u30641\u3064\u306e\u5b9f\u884c\u306b\u6642\u9593\u304c\u639b\u304b\u308b\u306e\u3067\u3001\u30af\u30a8\u30ea\u306b\u6163\u308c\u3066\u3044\u306a\u3044\u65b0\u53c2\u8005\u306b\u306f\u8f9b\u3044\u7269\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\u3057\u304b\u3057Presto\u3067\u306f\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u306b\u5b9f\u884c\u3067\u304d\u307e\u3059\u306e\u3067\u3001\u30c8\u30e9\u30a4\uff06\u30a8\u30e9\u30fc\u3092\u7e70\u308a\u8fd4\u3057\u3084\u3059\u3044\u70b9\u304c\u826f\u3044\u3067\u3059\u306d\u3002\n\u307e\u305f\u3001JDBC\u30c9\u30e9\u30a4\u30d0\u7d4c\u7531\u3067BI\u30c4\u30fc\u30eb\u3068Presto\u3092\u63a5\u7d9a\u3059\u308c\u3070\u3001\u3055\u3089\u306a\u308b\u4fa1\u5024\u3092\u898b\u3044\u3060\u305b\u308b\u3067\u3057\u3087\u3046\u3002\n\n\u30cf\u30de\u308a\u3084\u3059\u3044\u6319\u52d5\u306e\u9055\u3044\n\n\u30c0\u30d6\u30eb\u30af\u30a9\u30fc\u30c8\u3068\u30b7\u30f3\u30b0\u30eb\u30af\u30a9\u30fc\u30c8\nMySQL\u3084Hive\u3067\u306f\u3042\u307e\u308a\u610f\u8b58\u3059\u308b\u3053\u3068\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u6a19\u6e96SQL\u3092\u63a1\u7528\u3059\u308bPresto\u3067\u306f\u89e3\u91c8\u304c\u7570\u306a\u308a\u307e\u3059\u3002\n\u6587\u5b57\u5217\u3068\u3057\u3066\u6e21\u3059\u305f\u3081\u306b\u306f\u30b7\u30f3\u30b0\u30eb\u30af\u30a9\u30fc\u30c8\u3067\u56f2\u3044\u307e\u3057\u3087\u3046\u3002\u30c0\u30d6\u30eb\u30af\u30a9\u30fc\u30c8\u3067\u3059\u3068\u305d\u306e\u305d\u306e\u30ab\u30e9\u30e0\u3092\u63a2\u3059\u3088\u3046\u3067\u3059\u3002\n-- MySQL\u30fbHive\u3067\u4f7f\u3048\u308b\u8a18\u6cd5\nSELECT \"abc\" AS name;\nSELECT 'abc' AS name;\n\n-- Presto\u3067\u4f7f\u3048\u308b\u8a18\u6cd5\nSELECT 'abc' AS name;\n\n\u30ab\u30e9\u30e0\u540d\u306b\u5225\u540d\u3092\u4ed8\u3051\u308bAS\u53e5\u306b\u3064\u3044\u3066\u3082\u30b1\u30a2\u304c\u5fc5\u8981\u3067\u3059\u3002\nPresto\u3067\u306f\u30c0\u30d6\u30eb\u30af\u30a9\u30fc\u30c8\u3067\u56f2\u307f\u307e\u3057\u3087\u3046\u3002\n-- MySQL\u3067\u4f7f\u3048\u308b\u8a18\u6cd5\nselect '\u65e5\u672c\u8a9e' AS `\u65e5\u672c\u8a9e`;\nselect '\u65e5\u672c\u8a9e' AS '\u65e5\u672c\u8a9e';\nselect '\u65e5\u672c\u8a9e' AS \"\u65e5\u672c\u8a9e\";\n\n-- Hive\u3067\u4f7f\u3048\u308b\u8a18\u6cd5\nselect '\u65e5\u672c\u8a9e' AS `\u65e5\u672c\u8a9e`;\n\n-- Presto\u3067\u4f7f\u3048\u308b\u8a18\u6cd5\nSELECT '\u65e5\u672c\u8a9e' AS \"\u65e5\u672c\u8a9e\";\n\n\u4e88\u7d04\u8a9e\u306e\u30ab\u30e9\u30e0\u540d\u3092\u7528\u3044\u308b\u969b\u306f\u30d0\u30c3\u30af\u30af\u30a9\u30fc\u30c8\u3067\u56f2\u307f\u307e\u3059\u3002\n-- Hive\u306e\u5834\u5408\nSELECT `date`\n\n-- Presto\u306e\u5834\u5408\nSELECT \"date\"\n\n\nIFNULL\u95a2\u6570\nIFNULL\u95a2\u6570\u306f\u3001\u6700\u521d\u306e\u5f15\u6570\u304cNULL\u306a\u3089\u3070\u30012\u756a\u76ee\u306e\u5f15\u6570\u3092\u8fd4\u3059SQL\u95a2\u6570\u3067\u3059\u3002\n\u3057\u304b\u3057\u3053\u3061\u3089\u3001Hive\u306b\u3082Presto\u306b\u3082\u3042\u308a\u307e\u305b\u3093\u3002\u305d\u306e\u4ee3\u308f\u308aIF\u6587\u3067\u8868\u73fe\u3067\u304d\u307e\u3059\u3002\n\u4f8b\uff09\u5272\u5f15\u7387\u3092\u683c\u7d0d\u3059\u308bdiscount_price\u30d5\u30a3\u30fc\u30eb\u30c9\u306b\u5024\u304c\u3042\u308c\u3070\u305d\u308c\u3092\u3001NULL\u3060\u3063\u305f\u6642\u306b\u306f0\u3068\u8fd4\u3057\u305f\u3044\u5834\u5408\n-- MySQL\u3067\u4f7f\u3048\u308b\u8a18\u6cd5\nselect IFNULL(discount_price, 0) from items;\n\n-- Hive\u30fbPresto\u3067\u4f7f\u3048\u308b\u8a18\u6cd5\nselect IF(discount_price IS NULL, 0, discount_price) from items;\n\n-- MySQL\u30fbPostgreSQL\u30fbPresto\u3067\u4f7f\u3048\u308bcoalesce\u95a2\u6570\u3092\u4f7f\u3063\u305f\u4f8b\u306f\u6b21\u306e\u901a\u308a\u3067\u3059\n-- \u3053\u306e\u95a2\u6570\u306f2\u3064\u4ee5\u4e0a\u306e\u5f15\u6570\u3092\u53d6\u308a\u3001\u4e00\u756a\u6700\u521d\u306eNULL\u3067\u306a\u3044\u5024\u3092\u8fd4\u3057\u307e\u3059\nselect coalesce(discount_price, 0) from items;\n\n\nNULLIF\u95a2\u6570\nHive\u306b\u306f\u307e\u3060\u3042\u308a\u307e\u305b\u3093\u304c\u3001Presto\u3067\u306fnullif\u95a2\u6570\u304c\u4f7f\u3048\u307e\u3059\u3002\nNULLIF(value1, value2)\u3068\u7528\u3044\u3001value1\u3068value2\u304c\u540c\u3058\u306a\u3089null\u3092\u8fd4\u3057\u3001\u305d\u308c\u3044\u304c\u3044\u306fvalue1\u3092\u8fd4\u3059\u3068\u3044\u3046\u3082\u306e\u3067\u3059\u3002\n\u6b21\u306e\u3088\u3046\u306b\u3001COALESCE\u3068\u4e00\u7dd2\u306b\u4f7f\u3046\u3068\u4fbf\u5229\u306a\u30b1\u30fc\u30b9\u304c\u591a\u3044\u3067\u3059\u3002\n-- Presto\u5411\u3051\uff1aemail\u304c\u7a7a\u6587\u5b57\u306a\u3089telephone\u3092\u8fd4\u3057\u3001\u305d\u3046\u3067\u306a\u3051\u308c\u3070email\u3092\u8fd4\u3059\u30b1\u30fc\u30b9\nSELECT COALESCE(NULLIF(email,''), telephone) AS contact FROM registration;\n\n-- Hive\u5411\u3051 \u305d\u306e1\nSELECT IF(email = '', telephone, email) AS contact FROM registration;\n\n-- Hive\u5411\u3051 \u305d\u306e2\nSELECT \n  CASE\n    WHEN email = '' THEN telephone\n    ELSE email\n  END AS contact\nFROM\n  registration;\n\ncf. http://stackoverflow.com/questions/17283978/sql-coalesce-with-empty-string\n\nCONCAT\u95a2\u6570\nCONCAT\u95a2\u6570\u306f\u3001\u5f15\u6570\u306e\u6587\u5b57\u5217\u3092\u9023\u7d50\u3057\u305f\u6587\u5b57\u5217\u3092\u8fd4\u3059SQL\u95a2\u6570\u3067\u3059\u3002\nMySQL\u3068Hive\u306f2\u3064\u4ee5\u4e0a\u306e\u5f15\u6570\u3067\u3082\u52d5\u304d\u3001\u6570\u5024\u578b\u30ab\u30e9\u30e0\u3067\u3042\u308c\u3070\u81ea\u52d5\u7684\u306b\u6587\u5b57\u5217\u578b\u3078\u5909\u63db\u3055\u308c\u307e\u3059\u3002\n\u3057\u304b\u3057Presto\u3067\u306f\u5f15\u6570\u306f2\u3064\u306b\u9650\u5b9a\u3055\u308c\u308b\u4ed6\u3001\u9023\u7d50\u3067\u304d\u308b\u306e\u306f\u6587\u5b57\u5217\u578b\u306e\u307f\u3067\u3059\u3002\n\u307e\u305f\u3001\u4efb\u610f\u306e\u6587\u5b57\u5217\u3068\u9023\u7d50\u3057\u305f\u3044\u6642\u3082\u30b7\u30f3\u30b0\u30eb\u30af\u30a9\u30fc\u30c8\u3067\u56f2\u3046\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u6ce8\u610f\u3057\u307e\u3057\u3087\u3046\u3002\n-- MySQL\u30fbHive\u3067\u4f7f\u3048\u308b\u8a18\u6cd5\nSELECT CONCAT('string', 100); -- \u7d50\u679c: string100\nSELECT CONCAT(\"string\", 100); -- \u7d50\u679c: string100\nSELECT CONCAT(pref_name, city_name) FROM shops;\nSELECT CONCAT(pref_name, city_name, town_name) FROM shops;\n\n-- Presto\u3067\u4f7f\u3048\u308b\u8a18\u6cd5\nSELECT CONCAT('string', cast(100 AS VARCHAR)); -- \u7d50\u679c: string100\nSELECT CONCAT(pref_name, city_name) FROM shops;\nSELECT CONCAT(CONCAT(pref_name, city_name), town_name) FROM shops;\n\n-- PostgreSQL\u30fbPresto\u3067\u4f7f\u3048\u308b||\u6f14\u7b97\u5b50\u3092\u7528\u3044\u308b\u3068\u30012\u3064\u4ee5\u4e0a\u306e\u8981\u7d20\u3092\u9023\u7d50\u3067\u304d\u307e\u3059\nSELECT pref_name || city_name FROM shops;\nSELECT pref_name || city_name || town_name FROM shops;\n\n-- Presto\u3067\u4f7f\u3048\u306a\u3044\u8a18\u6cd5\nSELECT CONCAT(\"string\", cast(100 AS VARCHAR)); -- \u30c0\u30d6\u30eb\u30af\u30a9\u30fc\u30c8\u306a\u306e\u3067\u3001\u305d\u306e\u30ab\u30e9\u30e0\u3092\u63a2\u3057\u3066\u3057\u307e\u3046\u304c\u898b\u3064\u304b\u3089\u305a\u306b\u30a8\u30e9\u30fc\nSELECT CONCAT(pref_name, city_name, town_name) FROM shops; -- 2\u3064\u4ee5\u4e0a\u306e\u5f15\u6570\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u30a8\u30e9\u30fc\n\n\u306a\u304a\u3001CONCAT\u30672\u3064\u4ee5\u4e0a\u306e\u5f15\u6570\u3092\u9023\u7d50\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u3001Presto\u306f\u6b21\u306e\u30a8\u30e9\u30fc\u3092\u8fd4\u3057\u307e\u3059\u3002\nexecuting query: select concat('a','b','c')\nQuery 20150122_020707_00541_693te failed: Unexpected parameters (varchar, varchar, varchar) for function concat.\nExpected: concat(varchar, varchar), concat(array<E>, array<E>), concat(array<E>, E), concat(E, array<E>)\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u306b\u30822\u3064\u306e\u5f15\u6570\u3067\u4f7f\u3046\u4e8b\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u306d\u3002\n\nconcat(string1, string2) \u2192 varchar\nReturns the concatenation of string1 and string2. This function provides the same functionality as the SQL-standard concatenation operator (||).\n4.6. String Functions and Operators \u2014 Presto 0.89 Documentation\n\n\nCAST\u95a2\u6570\n\u578b\u306b\u53b3\u3057\u304f\u306a\u3044Hive\u3084MySQL\u3067\u306f\u5229\u7528\u306e\u6a5f\u4f1a\u304c\u5c11\u306a\u3044\u3068\u601d\u3044\u307e\u3059\u304c\u3001Presto\u3067\u306f\u4e16\u8a71\u306b\u306a\u308b\u6a5f\u4f1a\u304c\u5897\u3048\u307e\u3059\u3002\nPresto\u3067\u306e\u5229\u7528\u65b9\u6cd5\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\u672c\u30ac\u30a4\u30c9\u3067\u306f\u3001CONCAT\u3092\u7528\u3044\u308b\u969b\u306b\u5229\u7528\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n\nCAST(value AS types)\nTRY_CAST(value AS type) \u203b Hive\u306b\u5b58\u5728\u3057\u306a\u3044\u95a2\u6570\n\ntype\u306b\u6307\u5b9a\u3067\u304d\u308b\u578b\u306f\u3001boolean, bigint, double, varchar\u306e4\u7a2e\u985e\u3067\u3059\u3002\n-- Presto\u3067\u306e\u5229\u7528\u4f8b\nSELECT CONCAT('string', cast(100 AS VARCHAR)); -- \u7d50\u679c: string100\nSELECT CONCAT(CONCAT(area, '_'), cast(id AS VARCHAR)) FROM shops; -- \u7d50\u679c: tokyo_1\n\n-- Presto\u3067\u306f||\u6f14\u7b97\u5b50\u3067\u3082\u9023\u7d50\u3057\u3066\u5229\u7528\u3067\u304d\u307e\u3059\nSELECT 'string' || cast(100 AS VARCHAR); -- \u7d50\u679c: string100\nSELECT area || '_' || cast(id AS VARCHAR) FROM shops; -- \u7d50\u679c: tokyo_1\n\ncf. http://prestodb.io/docs/current/functions/conversion.html\n\u306a\u304a\u3001string\u578b\u5411\u3051\u306e\u95a2\u6570\u3078CAST\u95a2\u6570\u3092\u7528\u3044\u305a\u306b\u6e21\u3059\u3068\u3001Presto\u306f\u6b21\u306e\u30a8\u30e9\u30fc\u3092\u8fd4\u3057\u307e\u3059\u3002\nexecuting query: select concat(name, area_id) from pref\nQuery 20150122_021028_00576_693te failed: Unexpected parameters (varchar, bigint) for function concat. \nExpected: concat(varchar, varchar), concat(array<E>, array<E>), concat(array<E>, E), concat(E, array<E>)\n\n\nLATERAL VIEW\n1\u3064\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u306bArray\u578b\u3068\u3057\u3066\u4fdd\u5b58\u3059\u308b\u304c\u3001\u305d\u308c\u3092\u884c\u306b\u5c55\u958b\u3057\u3066JOIN\u3059\u308b\u6642\u306b\u4f7f\u3046\u69cb\u6587\u3067\u3059\u3002\nhivemall\u3067\u4f5c\u3063\u305f\u56de\u5e30\u5206\u6790\u306e\u30e2\u30c7\u30eb\u3092\u7cbe\u5ea6\u691c\u8a3c\u3059\u308b\u969b\u306a\u3069\u306e\u30b9\u30d4\u30fc\u30c9\u30a2\u30c3\u30d7\u306b\u3082\u5f79\u7acb\u3061\u307e\u3059\u3002\nPresto\u3067\u306f\u6b21\u306e\u3088\u3046\u306bUNNEST\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n-- Hive\nSELECT student, score\nFROM tests\nLATERAL VIEW explode(scores) t AS score;\n\n-- Presto\nSELECT student, score\nFROM tests\nCROSS JOIN UNNEST(scores) AS t (score);\n\n\u52d5\u304d\u304c\u5206\u304b\u308a\u3065\u3089\u3044\u69cb\u6587\u306a\u306e\u3067\u3001\u30b5\u30f3\u30d7\u30eb\u3082\u7528\u610f\u3057\u307e\u3057\u305f\u3002\n-- Hive\nSELECT\n  id, scores, score\nFROM\n  (\n    SELECT 1 as id, array(60,70,50) as scores\n  ) tests\nLATERAL VIEW explode(scores) t AS score;\n\n-- Presto\nSELECT\n  id, scores, score\nFROM\n  (\n    SELECT 1 as id, array[60,70,50] as scores\n  ) tests\nCROSS JOIN UNNEST(scores) AS t (score);\n\n\u6b21\u306e\u3088\u3046\u306b\u3001\u884c\u304c\u5897\u3048\u307e\u3059\u3002\n\n\u306a\u304a\u3001\u5c55\u958b\u3057\u305f\u7d50\u679c\u306bJOIN\u3059\u308b\u5834\u5408\u306b\u306f\u3001LATERAL VIEW\u306b\n\u7d9a\u3051\u3066INNER JOIN\u306a\u3069\u306f\u66f8\u3051\u306a\u3044\u306e\u3067\u30b5\u30d6\u30af\u30a8\u30ea\u5316\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u6761\u4ef6\u4ed8\u304d\u3067\u306e\u30ab\u30a6\u30f3\u30c8\nWHERE\u53e5\u3067\u53d6\u308a\u51fa\u3057\u305f\u6761\u4ef6\u306e\u4e2d\u3067\u3001\u4efb\u610f\u306e\u6761\u4ef6\u306b\u5408\u81f4\u3059\u308b\u4ef6\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3057\u305f\u3044\u6642\u306b\u5229\u7528\u3059\u308b\u69cb\u6587\u3067\u3059\u3002\ncount()\u306e\u6761\u4ef6\u3092\u305d\u308c\u305e\u308c\u9055\u3046\u7269\u3067\u8907\u6570\u56de\u9023\u306d\u308b\u8a18\u6cd5\u306f\u30011\u3064\u306e\u30af\u30a8\u30ea\u3067\u30ec\u30b3\u30fc\u30c9\u306e\u5185\u8a33\u3092\u8a73\u3057\u304f\u8abf\u67fb\u3067\u304d\u308b\u305f\u3081\u4fbf\u5229\u3067\u3059\u3002\n\u6b21\u306f\u3001matching_level\u304c5\u4ee5\u4e0a\u306e\u30ec\u30b3\u30fc\u30c9\u306e\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3059\u308b\u4f8b\u3067\u3059\u3002\n-- Presto\u3067\u52d5\u304f\u304cHive\u3067\u306f\u4f7f\u3048\u306a\u3044\ncount(matching_level >= 5 or null) as count\n\n-- Presto\u30fbHive\u3067\u4f7f\u3048\u308b\nsum(if(matching_level >= 5,1,0)) as count\n\nHive\u306e\u5834\u5408\u306fsum\u3092\u7528\u3044\u305f\u30c8\u30ea\u30c3\u30ad\u30fc\u306a\u624b\u6cd5\u3092\u4f7f\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3057\u305f\u304c\u3001Presto\u306a\u3089ANSI\u4e92\u63db\u306a\u306e\u3067\u81ea\u7136\u306a\u30af\u30a8\u30ea\u304c\u66f8\u3051\u307e\u3059\u306d\u3002\n\u53c2\u8003: https://www.softel.co.jp/blogs/tech/archives/3267\n\nIN()\u306e\u6271\u3044\n\u6b21\u306eHive\u30af\u30a8\u30ea\u306b\u306f\u5236\u7d04\u304c\u3042\u308a\u3001\u7d20\u76f4\u306b\u66f8\u304f\u3068\u6b21\u306e\u30a8\u30e9\u30fc\u3068\u306a\u308a\u307e\u3059\u3002\n\u305d\u306e\u305f\u3081\u5197\u9577\u306a\u8868\u8a18\u3068\u306a\u3063\u3066\u3044\u308b\u5834\u5408\u306b\u306f\u3001Presto\u3067\u306f\u30b7\u30f3\u30d7\u30eb\u306b\u8a18\u8ff0\u3067\u304d\u307e\u3059\u3002\n--Presto\u3067\u52d5\u304f\u304cHive\u3067\u306f\u4f7f\u3048\u306a\u3044\n--Correlating expression cannot contain unqualified column references\u30a8\u30e9\u30fc\u3068\u306a\u308b\nstation_id IN(SELECT station_id FROM other_stations)\n\n--Hive\u3067\u52d5\u304f\u30af\u30a8\u30ea\nstation_id IN(SELECT other_stations.station_id FROM other_stations)\n\n\n\u6587\u5b57\u5217\u306e\u5207\u308a\u51fa\u3057\nHive\u3067\u306fsubstring\u3068substr\u304c\u3042\u308a\u307e\u3059\u304c\u3001Presto\u3067\u306fsubstr\u306e\u307f\u4f7f\u3048\u307e\u3059\u3002\nsubstr\u3067\u7d71\u4e00\u3057\u3066\u304a\u3051\u3070\u3001\u79fb\u690d\u6027\u306f\u9ad8\u307e\u308b\u3067\u3057\u3087\u3046\u3002\n--Hive\u30fbPresto\u3067\u52d5\u304f\u30af\u30a8\u30ea\n--substr(\u6587\u5b57\u5217, \u958b\u59cb\u4f4d\u7f6e, \u958b\u59cb\u4f4d\u7f6e\u304b\u3089\u306e\u9577\u3055)\nSELECT substr('ABCDE', 2, 1) -- \u7d50\u679c: B\nSELECT substr('ABCDE', -2, 1) -- \u7d50\u679c: D\n\n\n\u7f6e\u63db\u95a2\u6570\nHive\u304b\u3089Presto\u3084\u305d\u306e\u9006\u306e\u66f8\u304d\u63db\u3048\u304c\u5730\u5473\u306b\u624b\u304c\u639b\u304b\u308b\u7f6e\u63db\u95a2\u6570\u3067\u3059\u3002\n\nHive\u306etranslate\u95a2\u6570\u306b\u5bfe\u5fdc\u3059\u308bPresto\u306e\u95a2\u6570\u306f\u73fe\u72b6\u3042\u308a\u307e\u305b\u3093\n\n\nreplace\u95a2\u6570\u3092\u30cd\u30b9\u30c8\u3055\u305b\u3066\u9811\u5f35\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\n\n\nPresto\u306ereplace\u306b\u5bfe\u5fdc\u3059\u308b\u95a2\u6570\u306fHive\u306b\u306f\u3042\u308a\u307e\u305b\u3093\n\n\nregexp_replace\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\n\n\n\n--1\u2192a, 3\u2192b, 5\u2192c\u3068\u3044\u3046\u7f6e\u63db\u3092\u884c\u3046\u5834\u5408\n--\u7d50\u679c\u306f\u3069\u3061\u3089\u3082`0a2b4c`\u3068\u306a\u308a\u307e\u3059\n\n--Hive\u3067\u52d5\u304f\u304cPresto\u3067\u306f\u52d5\u304b\u306a\u3044\nSELECT translate('012345', '135', 'abc')\n\n--Presto\u3067\u52d5\u304f\u4e92\u63db\u51e6\u7406\nSELECT replace(replace(replace('012345', '1', 'a'), '3', 'b'), '5', 'c')\n\n--Hive: \u5358\u7d14\u306a\u7f6e\u63db\u3092\u3059\u308b\u6642\u3082 regexp_replace \u3092\u5229\u7528\u3059\u308b\u306e\u3067\u3001\u30e1\u30bf\u6587\u5b57\u306f\u30a8\u30b9\u30b1\u30fc\u30d7\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\nSELECT regexp_replace('012345', '01', 'abz'), --\u7d50\u679c: 012345\n\n--Presto: \u7528\u9014\u306b\u5fdc\u3058\u3066replace\u3084regexp_replace\u3092\u4f7f\u3044\u5206\u3051\u3089\u308c\u308b\nSELECT regexp_replace('01-23-45', '[0-9]', 'Z'), --\u7d50\u679c: ZZ-ZZ-ZZ\nSELECT replace('01-23-45', '-', ''), --\u7d50\u679c: 012345\n\n\n\u6b63\u898f\u8868\u73fe\u3092\u7528\u3044\u305f\u95a2\u6570\nHive\u3067\u306fRLIKE\u3092\u7528\u3044\u307e\u3059\u304c\u3001Presto\u3067\u306fregexp_like\u3092\u4f7f\u3044\u307e\u3059\u3002\n-- Hive\u3067\u52d5\u304f\u30af\u30a8\u30ea\nSELECT 'abc' RLIKE '^[a-z]{3}$'\n\n-- Presto\u3067\u52d5\u304f\u30af\u30a8\u30ea\nSELECT regexp_like('abc', '^[a-z]{3}$')\n\n\u306a\u304a\u3001Presto\u3067\u306fcol LIKE '%abc%'\u306fregexp_like(col, 'abc')\u306b\u5185\u90e8\u7684\u306b\u66f8\u304d\u63db\u3048\u3089\u308c\u3066\u3044\u307e\u3059\u3002\n\u3082\u3061\u308d\u3093\u305d\u306e\u969b\u306b\u30d1\u30bf\u30fc\u30f3\u90e8\u5206\u306f\u30a8\u30b9\u30b1\u30fc\u30d7\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u30e1\u30bf\u6587\u5b57\u304c\u542b\u307e\u308c\u3066\u3082\u554f\u984c\u306a\u304f\u52d5\u304d\u307e\u3059\u3002\n\n\u6b63\u898f\u8868\u73fe\u3067\u30e1\u30bf\u6587\u5b57\u3092\u5229\u7528\u3059\u308b\u969b\u306e\u30a8\u30b9\u30b1\u30fc\u30d7\n\u30e1\u30bf\u6587\u5b57\u3092\u5358\u306a\u308b\u6587\u5b57\u5217\u3068\u3057\u3066\u6271\u3046\u969b\u306b\u306f\u3001\u30a8\u30b9\u30b1\u30fc\u30d7\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001Hive\u3068Presto\u3067\u6319\u52d5\u304c\u7570\u306a\u308b\u6642\u304c\u3042\u308a\u307e\u3059\u3002\n\u5bfe\u8c61\u3068\u306a\u308b\u30e1\u30bf\u6587\u5b57\u306b\u306f\u00a5 * + . ? { } ( ) [ ] ^ $ - |\u304c\u3042\u308a\u307e\u3059\u3002 \u5f15\u7528\u5143\uff1awww.javadrive.jp\n\u4e00\u822c\u7684\u306b\u306f\u30d0\u30c3\u30af\u30b9\u30e9\u30c3\u30b7\u30e5\u30921\u3064\u3068\u3059\u308b\u306e\u304c\u901a\u5e38\u306a\u306e\u3067\u3001Hive\u30af\u30a8\u30ea\u3092\u66f8\u304f\u969b\u306b\u306f\u30cf\u30de\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\u6319\u52d5\u304c\u540c\u3058\u30b5\u30f3\u30d7\u30eb\u306f\u6b21\u306e\u901a\u308a\u3067\u3059\n--Hive\u30fbPresto\u5171\u306b\u540c\u3058\u6319\u52d5\nselect regexp_replace('(\u4eee\u79f0)ABC', '[\uff08\\(]?\u4eee\u79f0?[\uff09\\)]', '') --\u7d50\u679c: ABC\nselect regexp_extract('(\u4eee\u79f0)ABC', '[\uff08\\(]?(\u4eee\u79f0?)[\uff09\\)]', 1) --\u7d50\u679c: \u4eee\u79f0\n\n\u6319\u52d5\u304c\u7570\u306a\u308b\u5b9f\u969b\u306e\u30b5\u30f3\u30d7\u30eb\u306f\u6b21\u306e\u901a\u308a\u3067\u3059\u3002\n\u3053\u3053\u3067\u306f\u3001AAA(BB\u304b\u3089(BB\u3092\u53d6\u308a\u51fa\u3057\u307e\u3059\u3002\n--Hive: \u30a8\u30b9\u30b1\u30fc\u30d7\u304c1\u3064\u306e\u5834\u5408\nselect regexp_extract('AAA(BB', '(\\(BB)$', 1)\n--\u30a8\u30e9\u30fc\u5185\u5bb9 Wrong arguments '1': org.apache.hadoop.hive.ql.metadata.HiveException\n\n--Hive: \u30a8\u30b9\u30b1\u30fc\u30d7\u304c2\u3064\u306e\u5834\u5408\nselect regexp_extract('AAA(BB', '(\\\\(BB)$', 1) --\u7d50\u679c: (BB\n\n--Presto: \u30a8\u30b9\u30b1\u30fc\u30d7\u304c1\u3064\u306e\u5834\u5408\nselect regexp_extract('AAA(BB', '(\\(BB)$', 1) --\u7d50\u679c: (BB\n\n--Presto: \u30a8\u30b9\u30b1\u30fc\u30d7\u304c2\u3064\u306e\u5834\u5408\nselect regexp_extract('AAA(BB', '(\\\\(BB)$', 1)\n--\u30a8\u30e9\u30fc\u5185\u5bb9 failed: end pattern with unmatched parenthesis\n\n\u305d\u306e\u4ed6\u3001\u3053\u3046\u3044\u3063\u305f\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u6642\u3082\u3042\u308a\u307e\u3059\u3002\n--Hive: \u30a8\u30b9\u30b1\u30fc\u30d7\u304c1\u3064\u306e\u5834\u5408 \u52d5\u304b\u306a\u3044\nselect regexp_replace('Hive\u30d3\u30eb(B1-7F)', '\\(?B?[0-9]+[-\u301c][0-9][F\u968e]\\)?', '')\n--\u30a8\u30e9\u30fc\u5185\u5bb9 Unknown inline modifier near index 2\n\n--Hive: \u30a8\u30b9\u30b1\u30fc\u30d7\u304c1\u3064\u306e\u5834\u5408 \u52d5\u304f\nselect regexp_replace('Hive\u30d3\u30eb(B1-7F)', '\\\\(?B?[0-9]+[-\u301c][0-9][F\u968e]\\\\)?', '')\n\nHive\u3067\u306f\u30d0\u30c3\u30af\u30b9\u30e9\u30c3\u30b7\u30e5\u30922\u3064\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u30b1\u30fc\u30b9\u304c\u3042\u308b\u3053\u3068\u3001\u899a\u3048\u3066\u304a\u304d\u305f\u3044\u3067\u3059\u306d\u3002\n\u3069\u3046\u3044\u3046\u6761\u4ef6\u3067\u305d\u3046\u3059\u308c\u3070\u826f\u3044\u306e\u304b\u307e\u3060\u5206\u304b\u3089\u306a\u3044\u306e\u3067\u3001\u3054\u5b58\u3058\u306e\u65b9\u3044\u3089\u3063\u3057\u3083\u308c\u3070\u6559\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\u307e\u305f\u3001\u4f8b\u3048\u3070\u3042\u308b\u30ab\u30e9\u30e0A\u306b\u30ab\u30e9\u30e0B\u306e\u5185\u5bb9\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u304b\u3092\u8abf\u3079\u305f\u3044\u3068\u304d\u3001LIKE\u3067\u90e8\u5206\u4e00\u81f4\u691c\u7d22\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\u3057\u304b\u3057\u6b63\u898f\u8868\u73fe\u3068\u7d44\u307f\u5408\u308f\u305b\u305f\u3044\u6642\u306b\u306f\u3001\u30e1\u30bf\u6587\u5b57\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u4e8b\u3082\u8003\u616e\u3057\u3066\u30a8\u30b9\u30b1\u30fc\u30d7\u3057\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002\n\u305d\u306e\u6642\u306b\u4fbf\u5229\u306a\u30e1\u30bf\u6587\u5b57\u304c\u6b21\u304e\u306e\\Q\u3068\\E\u3067\u3059\u3002\n\n\n\\ ... \u6b63\u898f\u8868\u73fe\u3067\u306f\u306a\u3044\u304c\u3001\u6b21\u306e\u6587\u5b57\u3092\u30a8\u30b9\u30b1\u30fc\u30d7\u3059\u308b\n\n\\Q ... \u6b63\u898f\u8868\u73fe\u3067\u306f\u306a\u3044\u304c\u3001\\E \u307e\u3067\u306e\u3059\u3079\u3066\u306e\u6587\u5b57\u3092\u30a8\u30b9\u30b1\u30fc\u30d7\u3059\u308b\n\n\\E ... \u6b63\u898f\u8868\u73fe\u3067\u306f\u306a\u3044\u304c\u3001\\Q \u3067\u958b\u59cb\u3055\u308c\u305f\u5f15\u7528\u3092\u30a8\u30b9\u30b1\u30fc\u30d7\u3059\u308b\n\n\u5f15\u7528\u5143: https://docs.oracle.com/javase/jp/7/api/java/util/regex/Pattern.html\n\u30d0\u30c3\u30af\u30b9\u30e9\u30c3\u30b7\u30e5\u306f\u6709\u540d\u306a\u3082\u306e\u3067\u3001\u76f4\u5f8c\u306b\u3042\u308b\u610f\u5473\u306e\u3042\u308b\u6587\u5b57\u3092\u30a8\u30b9\u30b1\u30fc\u30d7\u3057\u3066\u5358\u7d14\u306a\u6587\u5b57\u5217\u3068\u3057\u3066\u6271\u3046\u7269\u3067\u3059\u3002\n\u305d\u306e\u5f8c\u306b\u7d9a\u304f2\u3064\u306f\u30bb\u30c3\u30c8\u3067\u4f7f\u3046\u7269\u3067\u3001\\Q\u304b\u3089\u5f15\u7528\u6587\u5b57\u5217\u3068\u3057\u3066\\E\u307e\u3067\u3001\u30a8\u30b9\u30b1\u30fc\u30d7\u3092\u884c\u3044\u307e\u3059\u3002\n\u5229\u7528\u30b5\u30f3\u30d7\u30eb\u306f\u6b21\u306e\u901a\u308a\u3067\u3059\u3002\n\u3053\u3053\u3067\u306f\u5358\u7d14\u306b\u90e8\u5206\u4e00\u81f4\u3067\u898b\u3066\u3044\u307e\u3059\u304c\u3001\u6b63\u898f\u8868\u73fe\u306e\u4e00\u90e8\u306b\u7d44\u307f\u8fbc\u3093\u3067\u5229\u7528\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\nHive\u306e\u4f8b WHERE building_name REGEXP CONCAT('\\\\Q', room_name, '\\\\E')\n\nPresto\u306e\u4f8b WHERE regexp_like(building_name, '\\Q' || room_name || '\\E')\n\n\n\u3053\u308c\u3092\u6d3b\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u6fc0\u3057\u3044\u30a8\u30b9\u30b1\u30fc\u30d7\u51e6\u7406\u3092\u5b9f\u88c5\u3059\u308b\u3053\u3068\u306a\u304f\u30b9\u30de\u30fc\u30c8\u306b\u5b9f\u88c5\u3057\u305f\u3044\u3067\u3059\u306d\u3002\n\n\u6b63\u898f\u8868\u73fe\u3067\u6587\u5b57\u5217\u3092\u62bd\u51fa\u3059\u308b\u3068\u304d\u306e\u6319\u52d5\n\u30de\u30c3\u30c1\u3057\u306a\u3044\u6b63\u898f\u8868\u73fe\u3067regexp_extract\u3092\u4f7f\u3046\u3068\u3001Null\u304c\u8fd4\u308b\u7269\u3068\u601d\u3063\u3066\u3044\u307e\u3057\u305f\u304c\u3001Hive\u306f\u7a7a\u6587\u5b57\u3092\u8fd4\u3057\u307e\u3059\u3002\n\u4e00\u65b9\u3002Presto\u306f\u671f\u5f85\u901a\u308aNULL\u3092\u8fd4\u3057\u307e\u3059\u3002\n--Hive : \u7a7a\u6587\u5b57\u304c\u8fd4\u308b\nSELECT regexp_extract('example-string', '([0-9]+)', 1) as foo\n\n--Presto : NULL\u304c\u8fd4\u308b\nSELECT regexp_extract('example-string', '([0-9]+)', 1) as foo\n\n\u305d\u306e\u305f\u3081\u3001\u305d\u306e\u7d50\u679c\u3092\u5229\u7528\u3057\u3066\u5225\u306e\u30af\u30a8\u30ea\u3067\u6761\u4ef6\u3092\u66f8\u304f\u6642\u306b\u306f\u8003\u616e\u304c\u5fc5\u8981\u3067\u3059\n--Presto\u3067\u306f\u52d5\u304f\u304c\u3001Hive\u3067\u306f\u540c\u3058\u3088\u3046\u306b\u52d5\u304b\u306a\u3044\u4f8b\nSELECT\n  foo\nFROM\n  (SELECT regexp_extract('example-string', '([0-9]+)', 1) as foo) t\nWHERE\n  foo IS NOT NULL\n\n--Hive\u3067\u306f\u7a7a\u6587\u5b57\u3067\u306e\u5224\u5b9a\u304c\u5fc5\u8981\u3067\u3059\nSELECT\n  foo\nFROM\n  (SELECT regexp_extract('example-string', '([0-9]+)', 1) as foo) t\nWHERE\n  foo != ''\n\n\u7a7a\u6587\u5b57\u3068\u3059\u308b\u306e\u306f\u6c17\u6301\u3061\u60aa\u3044\u306e\u3067\u3001Hive\u3067\u305d\u306e\u7d50\u679c\u3092NULL\u3068\u3057\u3066\u6271\u3046\u306b\u306f\u6b21\u306e\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u3002\ntranslate\u95a2\u6570\u3084regexp_replace\u306a\u3069\u3067\u306f\u5bfe\u51e6\u3067\u304d\u305a\u3001\u4ed6\u306b\u826f\u3044\u65b9\u6cd5\u304c\u3042\u308c\u3070\u6559\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n--Hive: regexp_extract\u3067\u30de\u30c3\u30c1\u3057\u306a\u3044\u5834\u5408\u306bNULL\u3092\u8fd4\u3059\u65b9\u6cd5\n--IF\u6587\u3084CASE\u6587\u3092\u7528\u3044\u3001LIKE\u3084REGEXP\u3092\u7528\u3044\u3066\u4e8b\u524d\u306b\u5224\u5b9a\u3059\u308b\nSELECT\n  foo\nFROM\n  (\n    SELECT\n      IF('example-string' REGEXP '([0-9]+)', regexp_extract('example-string', '([0-9]+)', 1), NULL) as foo\n    UNION ALL\n    SELECT\n      IF('example-string' REGEXP '([a-z]+)', regexp_extract('example-string', '([a-z]+)', 1), NULL) as foo\n  ) t\nWHERE\n  foo IS NOT NULL\n\n\n2\u3064\u306e\u65e5\u4ed8\u306e\u671f\u9593\u8a08\u7b97\n2\u3064\u306e\u65e5\u4ed8\u306e\u671f\u9593\u3092\u8a08\u7b97\u3057\u305f\u3044\u6642\u306b\u306fdatediff\u3092\u4f7f\u3044\u307e\u3059\u3002\n\u5f15\u6570\u306e\u9806\u756a\u304c\u7570\u306a\u308b\u306e\u3067\u6ce8\u610f\u3057\u307e\u3057\u3087\u3046\u3002\n--Hive\u3067\u52d5\u304f\u30af\u30a8\u30ea\n--2\u3064\u306e\u5dee\u5206\u65e5\u6570\u306e\u8a08\u7b97\u306e\u307f\u3067\u304d\u308b\n--datediff(enddate, startdate)\nSELECT datediff('2009-03-01', '2009-02-27') --\u7d50\u679c: 2\n\n--Presto\u3067\u52d5\u304f\u30af\u30a8\u30ea\n--\u7b2c1\u5f15\u6570\u3067\u6307\u5b9a\u3057\u305f\u5358\u4f4d(\u4e0b\u8a18\u53c2\u7167)\u3067\u306e\u5dee\u3092\u8a08\u7b97\u3067\u304d\u308b\n--date_diff(unit, starttime, endtime)\nSELECT date_diff('day', CAST('2009-02-27' AS DATE), CAST('2009-03-01' AS DATE)) --\u7d50\u679c: 2\nSELECT date_diff('day', CAST('2009-02-27' AS TIMESTAMP), CAST('2009-03-01' AS TIMESTAMP)) --\u7d50\u679c: 2\n\nPresto\u3067\u306f\u3001date_diff\u306e\u7b2c1\u5f15\u6570\u306b\u6b21\u306e\u5024\u304c\u4f7f\u3048\u307e\u3059\u3002\nhttps://prestodb.io/docs/current/functions/datetime.html#interval-functions\n\n\n\n\u5358\u4f4d\n\u8aac\u660e\n\n\n\n\nmillisecond\n\u30df\u30ea\u79d2\n\n\nsecond\n\u79d2\u6570\n\n\nminute\n\u5206\u6570\n\n\nhour\n\u6642\u9593\n\n\nday\n\u65e5\u6570\n\n\nweek\n\u9031\u6570\n\n\nmonth\n\u6708\u6570\n\n\nquarter\n\u56db\u534a\u671f\n\n\nyear\n\u5e74\u6570\n\n\n\nPresto\u306edate_diff\u306e\u7b2c2\u5f15\u6570\u3068\u7b2c3\u5f15\u6570\u3067\u6271\u3048\u308b\u578b\u306e\u30d1\u30bf\u30fc\u30f3\u306f\u6b21\u306e\u901a\u308a\u3067\u3059\u3002\nHive\u306e\u3088\u3046\u306b\u6587\u5b57\u5217\u3067\u6e21\u3059\u3068\u3001Unexpected parameters (varchar, varchar, varchar)\u3068\u3044\u3046\u30a8\u30e9\u30fc\u3068\u306a\u308a\u307e\u3059\u3002\n\ndate_diff(varchar, date, date)\ndate_diff(varchar, time, time)\ndate_diff(varchar, time with time zone, time with time zone)\ndate_diff(varchar, timestamp, timestamp)\ndate_diff(varchar, timestamp with time zone, timestamp with time zone) \n\nHive\u304b\u3089Presto\u3078\u306e\u66f8\u304d\u63db\u3048\u306f\u7c21\u5358\u3067\u3059\u304c\u3001\u305d\u306e\u9006\u306f\u53b3\u3057\u3044\u72b6\u6cc1\u3067\u3059\u3002\n\u306a\u304a\u3001Hive 1.2.0\u304b\u3089\u6708\u6570\u306e\u5dee\u3092\u6c42\u3081\u308bmonths_between\u95a2\u6570\u304c\u52a0\u308f\u308a\u307e\u3057\u305f\u3002\n--Hive 1.2.0\u4ee5\u964d\u3067\u4f7f\u3048\u308b\u95a2\u6570\nSELECT months_between('1997-02-28 10:30:00', '1996-10-30')--\u7d50\u679c: 3.94959677\n\n\n\u578b\u5909\u63db\nHive\u3067\u306fLL\u8a00\u8a9e\u306e\u3088\u3046\u306b\u578b\u304c\u9055\u3048\u3069\u3088\u3057\u306a\u306b\u6271\u3063\u3066\u304f\u308c\u307e\u3059\u304c\u3001\nPresto\u3067\u306f\u578b\u304c\u7570\u306a\u308b\u3068\u30a8\u30e9\u30fc\u3068\u306a\u308b\u306e\u3067\u53b3\u683c\u306b\u578b\u3092\u610f\u8b58\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u5225\u306e\u578b\u306e\u3082\u306e\u3092\u6587\u5b57\u5217\u578b\u306b\u3057\u305f\u3044\u6642\u306f\u3001\u6b21\u306e\u3088\u3046\u306b\u884c\u3044\u307e\u3059\u3002\n--Hive\u3067\u52d5\u304f\u30af\u30a8\u30ea\nCAST(col1 AS STRING)\n--\u4e0a\u8a18\u30af\u30a8\u30ea\u3092Presto\u3067\u4f7f\u3046\u3068\u6b21\u306e\u30a8\u30e9\u30fc\u3068\u306a\u308a\u307e\u3059\n--Unknown type: STRING\n\n--Presto\u3067\u52d5\u304f\u30af\u30a8\u30ea\nCAST(col1 AS VARCHAR)\n--\u4e0a\u8a18\u30af\u30a8\u30ea\u3092Hive\u3067\u4f7f\u3046\u3068\u6b21\u306e\u306e\u30a8\u30e9\u30fc\u3068\u306a\u308a\u307e\u3059\n--mismatched input ')' expecting ( near 'VARCHAR' in primitive type specification\n\n\nORDER BY\u3067\u4f7f\u3046\u30ab\u30e9\u30e0\u306f\u5fc5\u305aSELECT\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\nPresto\u3067\u306f\u3001SELECT\u53e5\u3067\u30ea\u30b9\u30c8\u30a2\u30c3\u30d7\u3057\u306a\u304f\u3066\u3082ORDER BY\u53e5\u3067\u4f7f\u3048\u307e\u3059\u304c\u3001\nHive\u3067\u306fWHERE\u53e5\u3067\u4f7f\u3046\u7269\u306fSELECT\u53e5\u3067\u547c\u3073\u51fa\u3059\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u305d\u306e\u969b\u306f\u6b21\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u3068\u306a\u308a\u307e\u3059\u3002possible column names are\u3068\u3044\u3046\u306e\u304cORDER BY\u53e5\u3067\u4f7f\u3048\u308b\u7269\u3067\u3059\u3002\nInvalid table alias or column reference 'room_name': (possible column names are: building_name, _c1)\n\n\u30d1\u30fc\u30bb\u30f3\u30bf\u30a4\u30eb\u3092\u7b97\u51fa\n\u30d1\u30fc\u30bb\u30f3\u30bf\u30a4\u30eb\u3092\u7b97\u51fa\u3059\u308b\u95a2\u6570\u306f\u3001\u5358\u8a9e\u306e\u9806\u756a\u304c\u9006\u306b\u306a\u308a\u307e\u3059\u3002\ncol\u3092\u6607\u9806\u306b\u4e26\u3079\u3066\u5c0f\u3055\u3044\u65b9\u304b\u308950%\u306e\u6240\u3001\u3064\u307e\u308a\u4e2d\u592e\u5024\u3092\u53d6\u308b\u4f8b\u3067\u8a18\u8f09\u3057\u307e\u3059\u3002\n\nPresto: approx_percentile(col, 0.5)\nHive: percentile_approx(col, 0.5)\n\n\nTreasureData\u306eUDF\u306e\u5bfe\u5fdc\u72b6\u6cc1\n\u6b21\u306e2\u3064\u306fHive\u30fbPresto\u5171\u306b\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n\nTD_TIME_RANGE()\nTD_TIME_ADD()\n\n\u305d\u306e\u4ed6\u306b\u3001Hive\u3067\u306fUDF\u3068\u3057\u3066\u7528\u610f\u3057\u306a\u3044\u9650\u308a\u7121\u304b\u3063\u305f\u304c\u3001Presto\u3067\u306f\u6a19\u6e96\u3067\u4f7f\u3048\u308b\u95a2\u6570\u3082\u3042\u308a\u307e\u3059\u3002\n\u3044\u308f\u3086\u308bGROUP BY\u3057\u305f\u3082\u306e\u306e\u4e2d\u3067\u6700\u5f8c\u306b\u3042\u308b\u30ec\u30b3\u30fc\u30c9\u3092\u512a\u5148\u3059\u308b\u3068\u3044\u3046\u4fbf\u5229\u95a2\u6570\u3067\u3059\u3002\nref. http://prestodb.io/docs/current/functions/aggregate.html#max_by\n\n\n\nHive\nPresto\n\n\n\n\nTD_LAST()\nmax_by(url, time)\n\n\nTD_FIRST()\nmax_by(url, - time)\n\n\n\n-- Hive example for TreasureData\nSELECT user, TD_LAST(url, time) AS last_url FROM access_logs GROUP BY user;\n\n-- Presto  example\nSELECT user, MAX_BY(url, time) as last_url FROM access_logs GROUP BY user;\n\n\u4f8b\u3048\u3070GROUP BY\u3057\u305f\u3082\u306e\u306b\u7d10\u4ed8\u304f\u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u4e2d\u3067\u3001\u6587\u5b57\u6570\u304c\u6700\u3082\u9577\u3044\u3082\u306e\u3060\u3051\u3092\u53d6\u308a\u51fa\u3057\u305f\u3044\u6642\u306b\u306f\u6b21\u306e\u3088\u3046\u306b\u884c\u3044\u307e\u3059\u3002\nGROUP BY\u306b\u306fMAX_BY\u3067\u53d6\u308a\u51fa\u3057\u305f\u3044\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u6307\u5b9a\u3057\u306a\u3044\u3088\u3046\u306b\u6c17\u3092\u3064\u3051\u307e\u3057\u3087\u3046\u3002\n-- \u30e6\u30fc\u30b6\u3068\u3001\u6700\u3082\u6587\u5b57\u6570\u306e\u591a\u3044\u30b3\u30e1\u30f3\u30c8\u3092\u53d6\u308a\u51fa\u3059\u4f8b\nSELECT user_id, MAX_BY(comment, length(comment)) as long_comment FROM comments GROUP BY user_id;\n\n\n\u6700\u5f8c\u306b\nMySQL/Hive/Presto\u306e\u6319\u52d5\u306e\u9055\u3044\u3092\u307e\u3068\u3081\u307e\u3057\u305f\u3002\n\u4ed6\u306b\u3082Tips\u304c\u3042\u308c\u3070\u968f\u6642\u66f4\u65b0\u3057\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u4f75\u305b\u3066\u8aad\u307f\u305f\u3044\n\n7.1. Migrating From Hive \u2014 Presto 0.90 Documentation\nhttp://prestodb.io/docs/current/migration/from-hive.html\n\n\nHiveQL\u3067\u306f\u30b9\u30d4\u30fc\u30c9\u306b\u96e3\u3092\u611f\u3058\u3066\u3044\u305f\u305f\u3081\u3001\u79c1\u3082Presto\u3092\u4f7f\u3044\u59cb\u3081\u307e\u3057\u305f\u3002\nMySQL\u3084Hive\u3067\u4f7f\u3063\u3066\u3044\u305f\u30af\u30a8\u30ea\u3092\u7f6e\u304d\u63db\u3048\u308b\u6642\u306b\u30cf\u30de\u3063\u305fTips\u3092\u307e\u3068\u3081\u3066\u3044\u304d\u307e\u3059\u3002\n\n# Presto\u3068\u306f\n\nPresto\u306f\u30aa\u30f3\u30e1\u30e2\u30ea\u3067\u52d5\u304f\u5206\u6563SQL\u30a8\u30f3\u30b8\u30f3\u3067\u3001\u305d\u306e\u9032\u5316\u306f\u76ee\u3092\u898b\u5f35\u308b\u7269\u3067\u3059\u3002\n\u767a\u8868\u3055\u308c\u305f\u5f53\u6642\u306f\u8272\u3005\u306a\u6210\u7d04\u304c\u3042\u308a\u4f7f\u3046\u3053\u3068\u3092\u8e8a\u8e87\u3057\u3066\u3044\u307e\u3057\u305f\u304c\u30012015\u5e741\u6708\u73fe\u5728\u306f\u3082\u3046\u4f7f\u308f\u306a\u3044\u7406\u7531\u306f\u306a\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n\u30a2\u30c9\u30db\u30c3\u30af\u306b\u4f7f\u3048\u308b\u3068\u3066\u3082\u9ad8\u901f\u306aSQL\u30a8\u30f3\u30b8\u30f3\u3067\u3059\u306e\u3067\u3001\u30d0\u30c3\u30c1\u5411\u3051\u306eHive\u306e\u3088\u3046\u306b\u5b9f\u884c\u7d50\u679c\u3092\u5f85\u3064\u6642\u9593\u306f\u307b\u3068\u3093\u3069\u3042\u308a\u307e\u305b\u3093\u3002\n\nHive\u3067\u3059\u30681\u30641\u3064\u306e\u5b9f\u884c\u306b\u6642\u9593\u304c\u639b\u304b\u308b\u306e\u3067\u3001\u30af\u30a8\u30ea\u306b\u6163\u308c\u3066\u3044\u306a\u3044\u65b0\u53c2\u8005\u306b\u306f\u8f9b\u3044\u7269\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\u3057\u304b\u3057Presto\u3067\u306f\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u306b\u5b9f\u884c\u3067\u304d\u307e\u3059\u306e\u3067\u3001\u30c8\u30e9\u30a4\uff06\u30a8\u30e9\u30fc\u3092\u7e70\u308a\u8fd4\u3057\u3084\u3059\u3044\u70b9\u304c\u826f\u3044\u3067\u3059\u306d\u3002\n\u307e\u305f\u3001JDBC\u30c9\u30e9\u30a4\u30d0\u7d4c\u7531\u3067BI\u30c4\u30fc\u30eb\u3068Presto\u3092\u63a5\u7d9a\u3059\u308c\u3070\u3001\u3055\u3089\u306a\u308b\u4fa1\u5024\u3092\u898b\u3044\u3060\u305b\u308b\u3067\u3057\u3087\u3046\u3002\n\n# \u30cf\u30de\u308a\u3084\u3059\u3044\u6319\u52d5\u306e\u9055\u3044\n\n### \u30c0\u30d6\u30eb\u30af\u30a9\u30fc\u30c8\u3068\u30b7\u30f3\u30b0\u30eb\u30af\u30a9\u30fc\u30c8\n\nMySQL\u3084Hive\u3067\u306f\u3042\u307e\u308a\u610f\u8b58\u3059\u308b\u3053\u3068\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u6a19\u6e96SQL\u3092\u63a1\u7528\u3059\u308bPresto\u3067\u306f\u89e3\u91c8\u304c\u7570\u306a\u308a\u307e\u3059\u3002\n\u6587\u5b57\u5217\u3068\u3057\u3066\u6e21\u3059\u305f\u3081\u306b\u306f\u30b7\u30f3\u30b0\u30eb\u30af\u30a9\u30fc\u30c8\u3067\u56f2\u3044\u307e\u3057\u3087\u3046\u3002\u30c0\u30d6\u30eb\u30af\u30a9\u30fc\u30c8\u3067\u3059\u3068\u305d\u306e\u305d\u306e\u30ab\u30e9\u30e0\u3092\u63a2\u3059\u3088\u3046\u3067\u3059\u3002\n\n```sql\n-- MySQL\u30fbHive\u3067\u4f7f\u3048\u308b\u8a18\u6cd5\nSELECT \"abc\" AS name;\nSELECT 'abc' AS name;\n\n-- Presto\u3067\u4f7f\u3048\u308b\u8a18\u6cd5\nSELECT 'abc' AS name;\n```\n\n\u30ab\u30e9\u30e0\u540d\u306b\u5225\u540d\u3092\u4ed8\u3051\u308bAS\u53e5\u306b\u3064\u3044\u3066\u3082\u30b1\u30a2\u304c\u5fc5\u8981\u3067\u3059\u3002\nPresto\u3067\u306f\u30c0\u30d6\u30eb\u30af\u30a9\u30fc\u30c8\u3067\u56f2\u307f\u307e\u3057\u3087\u3046\u3002\n\n```sql\n-- MySQL\u3067\u4f7f\u3048\u308b\u8a18\u6cd5\nselect '\u65e5\u672c\u8a9e' AS `\u65e5\u672c\u8a9e`;\nselect '\u65e5\u672c\u8a9e' AS '\u65e5\u672c\u8a9e';\nselect '\u65e5\u672c\u8a9e' AS \"\u65e5\u672c\u8a9e\";\n\n-- Hive\u3067\u4f7f\u3048\u308b\u8a18\u6cd5\nselect '\u65e5\u672c\u8a9e' AS `\u65e5\u672c\u8a9e`;\n\n-- Presto\u3067\u4f7f\u3048\u308b\u8a18\u6cd5\nSELECT '\u65e5\u672c\u8a9e' AS \"\u65e5\u672c\u8a9e\";\n```\n\n\u4e88\u7d04\u8a9e\u306e\u30ab\u30e9\u30e0\u540d\u3092\u7528\u3044\u308b\u969b\u306f\u30d0\u30c3\u30af\u30af\u30a9\u30fc\u30c8\u3067\u56f2\u307f\u307e\u3059\u3002\n\n```sql\n-- Hive\u306e\u5834\u5408\nSELECT `date`\n\n-- Presto\u306e\u5834\u5408\nSELECT \"date\"\n```\n\n### IFNULL\u95a2\u6570\n\nIFNULL\u95a2\u6570\u306f\u3001\u6700\u521d\u306e\u5f15\u6570\u304cNULL\u306a\u3089\u3070\u30012\u756a\u76ee\u306e\u5f15\u6570\u3092\u8fd4\u3059SQL\u95a2\u6570\u3067\u3059\u3002\n\u3057\u304b\u3057\u3053\u3061\u3089\u3001Hive\u306b\u3082Presto\u306b\u3082\u3042\u308a\u307e\u305b\u3093\u3002\u305d\u306e\u4ee3\u308f\u308aIF\u6587\u3067\u8868\u73fe\u3067\u304d\u307e\u3059\u3002\n\n\u4f8b\uff09\u5272\u5f15\u7387\u3092\u683c\u7d0d\u3059\u308bdiscount_price\u30d5\u30a3\u30fc\u30eb\u30c9\u306b\u5024\u304c\u3042\u308c\u3070\u305d\u308c\u3092\u3001NULL\u3060\u3063\u305f\u6642\u306b\u306f0\u3068\u8fd4\u3057\u305f\u3044\u5834\u5408\n\n```sql\n-- MySQL\u3067\u4f7f\u3048\u308b\u8a18\u6cd5\nselect IFNULL(discount_price, 0) from items;\n\n-- Hive\u30fbPresto\u3067\u4f7f\u3048\u308b\u8a18\u6cd5\nselect IF(discount_price IS NULL, 0, discount_price) from items;\n\n-- MySQL\u30fbPostgreSQL\u30fbPresto\u3067\u4f7f\u3048\u308bcoalesce\u95a2\u6570\u3092\u4f7f\u3063\u305f\u4f8b\u306f\u6b21\u306e\u901a\u308a\u3067\u3059\n-- \u3053\u306e\u95a2\u6570\u306f2\u3064\u4ee5\u4e0a\u306e\u5f15\u6570\u3092\u53d6\u308a\u3001\u4e00\u756a\u6700\u521d\u306eNULL\u3067\u306a\u3044\u5024\u3092\u8fd4\u3057\u307e\u3059\nselect coalesce(discount_price, 0) from items;\n```\n\n### NULLIF\u95a2\u6570\n\nHive\u306b\u306f\u307e\u3060\u3042\u308a\u307e\u305b\u3093\u304c\u3001Presto\u3067\u306f[nullif\u95a2\u6570](http://prestodb.io/docs/current/functions/conditional.html#nullif)\u304c\u4f7f\u3048\u307e\u3059\u3002\n\nNULLIF(value1, value2)\u3068\u7528\u3044\u3001value1\u3068value2\u304c\u540c\u3058\u306a\u3089null\u3092\u8fd4\u3057\u3001\u305d\u308c\u3044\u304c\u3044\u306fvalue1\u3092\u8fd4\u3059\u3068\u3044\u3046\u3082\u306e\u3067\u3059\u3002\n\u6b21\u306e\u3088\u3046\u306b\u3001COALESCE\u3068\u4e00\u7dd2\u306b\u4f7f\u3046\u3068\u4fbf\u5229\u306a\u30b1\u30fc\u30b9\u304c\u591a\u3044\u3067\u3059\u3002\n\n```sql\n-- Presto\u5411\u3051\uff1aemail\u304c\u7a7a\u6587\u5b57\u306a\u3089telephone\u3092\u8fd4\u3057\u3001\u305d\u3046\u3067\u306a\u3051\u308c\u3070email\u3092\u8fd4\u3059\u30b1\u30fc\u30b9\nSELECT COALESCE(NULLIF(email,''), telephone) AS contact FROM registration;\n\n-- Hive\u5411\u3051 \u305d\u306e1\nSELECT IF(email = '', telephone, email) AS contact FROM registration;\n\n-- Hive\u5411\u3051 \u305d\u306e2\nSELECT \n  CASE\n    WHEN email = '' THEN telephone\n    ELSE email\n  END AS contact\nFROM\n  registration;\n```\n\ncf. http://stackoverflow.com/questions/17283978/sql-coalesce-with-empty-string\n\n### CONCAT\u95a2\u6570\n\nCONCAT\u95a2\u6570\u306f\u3001\u5f15\u6570\u306e\u6587\u5b57\u5217\u3092\u9023\u7d50\u3057\u305f\u6587\u5b57\u5217\u3092\u8fd4\u3059SQL\u95a2\u6570\u3067\u3059\u3002\nMySQL\u3068Hive\u306f2\u3064\u4ee5\u4e0a\u306e\u5f15\u6570\u3067\u3082\u52d5\u304d\u3001\u6570\u5024\u578b\u30ab\u30e9\u30e0\u3067\u3042\u308c\u3070\u81ea\u52d5\u7684\u306b\u6587\u5b57\u5217\u578b\u3078\u5909\u63db\u3055\u308c\u307e\u3059\u3002\n\u3057\u304b\u3057Presto\u3067\u306f\u5f15\u6570\u306f2\u3064\u306b\u9650\u5b9a\u3055\u308c\u308b\u4ed6\u3001\u9023\u7d50\u3067\u304d\u308b\u306e\u306f\u6587\u5b57\u5217\u578b\u306e\u307f\u3067\u3059\u3002\n\u307e\u305f\u3001\u4efb\u610f\u306e\u6587\u5b57\u5217\u3068\u9023\u7d50\u3057\u305f\u3044\u6642\u3082\u30b7\u30f3\u30b0\u30eb\u30af\u30a9\u30fc\u30c8\u3067\u56f2\u3046\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u6ce8\u610f\u3057\u307e\u3057\u3087\u3046\u3002\n\n```sql\n-- MySQL\u30fbHive\u3067\u4f7f\u3048\u308b\u8a18\u6cd5\nSELECT CONCAT('string', 100); -- \u7d50\u679c: string100\nSELECT CONCAT(\"string\", 100); -- \u7d50\u679c: string100\nSELECT CONCAT(pref_name, city_name) FROM shops;\nSELECT CONCAT(pref_name, city_name, town_name) FROM shops;\n\n-- Presto\u3067\u4f7f\u3048\u308b\u8a18\u6cd5\nSELECT CONCAT('string', cast(100 AS VARCHAR)); -- \u7d50\u679c: string100\nSELECT CONCAT(pref_name, city_name) FROM shops;\nSELECT CONCAT(CONCAT(pref_name, city_name), town_name) FROM shops;\n\n-- PostgreSQL\u30fbPresto\u3067\u4f7f\u3048\u308b||\u6f14\u7b97\u5b50\u3092\u7528\u3044\u308b\u3068\u30012\u3064\u4ee5\u4e0a\u306e\u8981\u7d20\u3092\u9023\u7d50\u3067\u304d\u307e\u3059\nSELECT pref_name || city_name FROM shops;\nSELECT pref_name || city_name || town_name FROM shops;\n\n-- Presto\u3067\u4f7f\u3048\u306a\u3044\u8a18\u6cd5\nSELECT CONCAT(\"string\", cast(100 AS VARCHAR)); -- \u30c0\u30d6\u30eb\u30af\u30a9\u30fc\u30c8\u306a\u306e\u3067\u3001\u305d\u306e\u30ab\u30e9\u30e0\u3092\u63a2\u3057\u3066\u3057\u307e\u3046\u304c\u898b\u3064\u304b\u3089\u305a\u306b\u30a8\u30e9\u30fc\nSELECT CONCAT(pref_name, city_name, town_name) FROM shops; -- 2\u3064\u4ee5\u4e0a\u306e\u5f15\u6570\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u30a8\u30e9\u30fc\n```\n\n\u306a\u304a\u3001CONCAT\u30672\u3064\u4ee5\u4e0a\u306e\u5f15\u6570\u3092\u9023\u7d50\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u3001Presto\u306f\u6b21\u306e\u30a8\u30e9\u30fc\u3092\u8fd4\u3057\u307e\u3059\u3002\n\n```sql\nexecuting query: select concat('a','b','c')\nQuery 20150122_020707_00541_693te failed: Unexpected parameters (varchar, varchar, varchar) for function concat.\nExpected: concat(varchar, varchar), concat(array<E>, array<E>), concat(array<E>, E), concat(E, array<E>)\n```\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u306b\u30822\u3064\u306e\u5f15\u6570\u3067\u4f7f\u3046\u4e8b\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u306d\u3002\n\n> concat(string1, string2) \u2192 varchar\nReturns the concatenation of string1 and string2. This function provides the same functionality as the SQL-standard concatenation operator (||).\n[4.6. String Functions and Operators \u2014 Presto 0.89 Documentation](http://prestodb.io/docs/current/functions/string.html)\n\n### CAST\u95a2\u6570\n\n\u578b\u306b\u53b3\u3057\u304f\u306a\u3044Hive\u3084MySQL\u3067\u306f\u5229\u7528\u306e\u6a5f\u4f1a\u304c\u5c11\u306a\u3044\u3068\u601d\u3044\u307e\u3059\u304c\u3001Presto\u3067\u306f\u4e16\u8a71\u306b\u306a\u308b\u6a5f\u4f1a\u304c\u5897\u3048\u307e\u3059\u3002\nPresto\u3067\u306e\u5229\u7528\u65b9\u6cd5\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\u672c\u30ac\u30a4\u30c9\u3067\u306f\u3001CONCAT\u3092\u7528\u3044\u308b\u969b\u306b\u5229\u7528\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n\n* CAST(value AS types)\n* TRY_CAST(value AS type) \u203b Hive\u306b\u5b58\u5728\u3057\u306a\u3044\u95a2\u6570\n\ntype\u306b\u6307\u5b9a\u3067\u304d\u308b\u578b\u306f\u3001boolean, bigint, double, varchar\u306e4\u7a2e\u985e\u3067\u3059\u3002\n\n```sql\n-- Presto\u3067\u306e\u5229\u7528\u4f8b\nSELECT CONCAT('string', cast(100 AS VARCHAR)); -- \u7d50\u679c: string100\nSELECT CONCAT(CONCAT(area, '_'), cast(id AS VARCHAR)) FROM shops; -- \u7d50\u679c: tokyo_1\n\n-- Presto\u3067\u306f||\u6f14\u7b97\u5b50\u3067\u3082\u9023\u7d50\u3057\u3066\u5229\u7528\u3067\u304d\u307e\u3059\nSELECT 'string' || cast(100 AS VARCHAR); -- \u7d50\u679c: string100\nSELECT area || '_' || cast(id AS VARCHAR) FROM shops; -- \u7d50\u679c: tokyo_1\n```\n\ncf. http://prestodb.io/docs/current/functions/conversion.html\n\n\u306a\u304a\u3001string\u578b\u5411\u3051\u306e\u95a2\u6570\u3078CAST\u95a2\u6570\u3092\u7528\u3044\u305a\u306b\u6e21\u3059\u3068\u3001Presto\u306f\u6b21\u306e\u30a8\u30e9\u30fc\u3092\u8fd4\u3057\u307e\u3059\u3002\n\n```sql\nexecuting query: select concat(name, area_id) from pref\nQuery 20150122_021028_00576_693te failed: Unexpected parameters (varchar, bigint) for function concat. \nExpected: concat(varchar, varchar), concat(array<E>, array<E>), concat(array<E>, E), concat(E, array<E>)\n```\n\n### LATERAL VIEW\n\n1\u3064\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u306bArray\u578b\u3068\u3057\u3066\u4fdd\u5b58\u3059\u308b\u304c\u3001\u305d\u308c\u3092\u884c\u306b\u5c55\u958b\u3057\u3066JOIN\u3059\u308b\u6642\u306b\u4f7f\u3046\u69cb\u6587\u3067\u3059\u3002\nhivemall\u3067\u4f5c\u3063\u305f\u56de\u5e30\u5206\u6790\u306e\u30e2\u30c7\u30eb\u3092\u7cbe\u5ea6\u691c\u8a3c\u3059\u308b\u969b\u306a\u3069\u306e\u30b9\u30d4\u30fc\u30c9\u30a2\u30c3\u30d7\u306b\u3082\u5f79\u7acb\u3061\u307e\u3059\u3002\nPresto\u3067\u306f\u6b21\u306e\u3088\u3046\u306bUNNEST\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n```sql\n-- Hive\nSELECT student, score\nFROM tests\nLATERAL VIEW explode(scores) t AS score;\n\n-- Presto\nSELECT student, score\nFROM tests\nCROSS JOIN UNNEST(scores) AS t (score);\n```\n\n\u52d5\u304d\u304c\u5206\u304b\u308a\u3065\u3089\u3044\u69cb\u6587\u306a\u306e\u3067\u3001\u30b5\u30f3\u30d7\u30eb\u3082\u7528\u610f\u3057\u307e\u3057\u305f\u3002\n\n```sql\n-- Hive\nSELECT\n  id, scores, score\nFROM\n  (\n    SELECT 1 as id, array(60,70,50) as scores\n  ) tests\nLATERAL VIEW explode(scores) t AS score;\n\n-- Presto\nSELECT\n  id, scores, score\nFROM\n  (\n    SELECT 1 as id, array[60,70,50] as scores\n  ) tests\nCROSS JOIN UNNEST(scores) AS t (score);\n```\n\n\u6b21\u306e\u3088\u3046\u306b\u3001\u884c\u304c\u5897\u3048\u307e\u3059\u3002\n![image](https://qiita-image-store.s3.amazonaws.com/0/19199/de4662b6-5a36-805b-c442-044b7fec8ac5.png)\n\n\u306a\u304a\u3001\u5c55\u958b\u3057\u305f\u7d50\u679c\u306bJOIN\u3059\u308b\u5834\u5408\u306b\u306f\u3001LATERAL VIEW\u306b\n\u7d9a\u3051\u3066INNER JOIN\u306a\u3069\u306f\u66f8\u3051\u306a\u3044\u306e\u3067\u30b5\u30d6\u30af\u30a8\u30ea\u5316\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n### \u6761\u4ef6\u4ed8\u304d\u3067\u306e\u30ab\u30a6\u30f3\u30c8\n\nWHERE\u53e5\u3067\u53d6\u308a\u51fa\u3057\u305f\u6761\u4ef6\u306e\u4e2d\u3067\u3001\u4efb\u610f\u306e\u6761\u4ef6\u306b\u5408\u81f4\u3059\u308b\u4ef6\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3057\u305f\u3044\u6642\u306b\u5229\u7528\u3059\u308b\u69cb\u6587\u3067\u3059\u3002\ncount()\u306e\u6761\u4ef6\u3092\u305d\u308c\u305e\u308c\u9055\u3046\u7269\u3067\u8907\u6570\u56de\u9023\u306d\u308b\u8a18\u6cd5\u306f\u30011\u3064\u306e\u30af\u30a8\u30ea\u3067\u30ec\u30b3\u30fc\u30c9\u306e\u5185\u8a33\u3092\u8a73\u3057\u304f\u8abf\u67fb\u3067\u304d\u308b\u305f\u3081\u4fbf\u5229\u3067\u3059\u3002\n\n\u6b21\u306f\u3001matching_level\u304c5\u4ee5\u4e0a\u306e\u30ec\u30b3\u30fc\u30c9\u306e\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3059\u308b\u4f8b\u3067\u3059\u3002\n\n```sql\n-- Presto\u3067\u52d5\u304f\u304cHive\u3067\u306f\u4f7f\u3048\u306a\u3044\ncount(matching_level >= 5 or null) as count\n\n-- Presto\u30fbHive\u3067\u4f7f\u3048\u308b\nsum(if(matching_level >= 5,1,0)) as count\n```\n\nHive\u306e\u5834\u5408\u306fsum\u3092\u7528\u3044\u305f\u30c8\u30ea\u30c3\u30ad\u30fc\u306a\u624b\u6cd5\u3092\u4f7f\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3057\u305f\u304c\u3001Presto\u306a\u3089ANSI\u4e92\u63db\u306a\u306e\u3067\u81ea\u7136\u306a\u30af\u30a8\u30ea\u304c\u66f8\u3051\u307e\u3059\u306d\u3002\n\n\u53c2\u8003: https://www.softel.co.jp/blogs/tech/archives/3267\n\n### IN()\u306e\u6271\u3044\n\n\u6b21\u306eHive\u30af\u30a8\u30ea\u306b\u306f\u5236\u7d04\u304c\u3042\u308a\u3001\u7d20\u76f4\u306b\u66f8\u304f\u3068\u6b21\u306e\u30a8\u30e9\u30fc\u3068\u306a\u308a\u307e\u3059\u3002\n\u305d\u306e\u305f\u3081\u5197\u9577\u306a\u8868\u8a18\u3068\u306a\u3063\u3066\u3044\u308b\u5834\u5408\u306b\u306f\u3001Presto\u3067\u306f\u30b7\u30f3\u30d7\u30eb\u306b\u8a18\u8ff0\u3067\u304d\u307e\u3059\u3002\n\n```sql\n--Presto\u3067\u52d5\u304f\u304cHive\u3067\u306f\u4f7f\u3048\u306a\u3044\n--Correlating expression cannot contain unqualified column references\u30a8\u30e9\u30fc\u3068\u306a\u308b\nstation_id IN(SELECT station_id FROM other_stations)\n\n--Hive\u3067\u52d5\u304f\u30af\u30a8\u30ea\nstation_id IN(SELECT other_stations.station_id FROM other_stations)\n```\n\n### \u6587\u5b57\u5217\u306e\u5207\u308a\u51fa\u3057\n\nHive\u3067\u306fsubstring\u3068substr\u304c\u3042\u308a\u307e\u3059\u304c\u3001Presto\u3067\u306fsubstr\u306e\u307f\u4f7f\u3048\u307e\u3059\u3002\nsubstr\u3067\u7d71\u4e00\u3057\u3066\u304a\u3051\u3070\u3001\u79fb\u690d\u6027\u306f\u9ad8\u307e\u308b\u3067\u3057\u3087\u3046\u3002\n\n```sql\n--Hive\u30fbPresto\u3067\u52d5\u304f\u30af\u30a8\u30ea\n--substr(\u6587\u5b57\u5217, \u958b\u59cb\u4f4d\u7f6e, \u958b\u59cb\u4f4d\u7f6e\u304b\u3089\u306e\u9577\u3055)\nSELECT substr('ABCDE', 2, 1) -- \u7d50\u679c: B\nSELECT substr('ABCDE', -2, 1) -- \u7d50\u679c: D\n```\n\n### \u7f6e\u63db\u95a2\u6570\n\nHive\u304b\u3089Presto\u3084\u305d\u306e\u9006\u306e\u66f8\u304d\u63db\u3048\u304c\u5730\u5473\u306b\u624b\u304c\u639b\u304b\u308b\u7f6e\u63db\u95a2\u6570\u3067\u3059\u3002\n\n* Hive\u306etranslate\u95a2\u6570\u306b\u5bfe\u5fdc\u3059\u308bPresto\u306e\u95a2\u6570\u306f\u73fe\u72b6\u3042\u308a\u307e\u305b\u3093\n  * replace\u95a2\u6570\u3092\u30cd\u30b9\u30c8\u3055\u305b\u3066\u9811\u5f35\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\n* Presto\u306ereplace\u306b\u5bfe\u5fdc\u3059\u308b\u95a2\u6570\u306fHive\u306b\u306f\u3042\u308a\u307e\u305b\u3093\n  * regexp_replace\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\n\n```sql\n--1\u2192a, 3\u2192b, 5\u2192c\u3068\u3044\u3046\u7f6e\u63db\u3092\u884c\u3046\u5834\u5408\n--\u7d50\u679c\u306f\u3069\u3061\u3089\u3082`0a2b4c`\u3068\u306a\u308a\u307e\u3059\n\n--Hive\u3067\u52d5\u304f\u304cPresto\u3067\u306f\u52d5\u304b\u306a\u3044\nSELECT translate('012345', '135', 'abc')\n\n--Presto\u3067\u52d5\u304f\u4e92\u63db\u51e6\u7406\nSELECT replace(replace(replace('012345', '1', 'a'), '3', 'b'), '5', 'c')\n```\n\n```sql\n--Hive: \u5358\u7d14\u306a\u7f6e\u63db\u3092\u3059\u308b\u6642\u3082 regexp_replace \u3092\u5229\u7528\u3059\u308b\u306e\u3067\u3001\u30e1\u30bf\u6587\u5b57\u306f\u30a8\u30b9\u30b1\u30fc\u30d7\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\nSELECT regexp_replace('012345', '01', 'abz'), --\u7d50\u679c: 012345\n\n--Presto: \u7528\u9014\u306b\u5fdc\u3058\u3066replace\u3084regexp_replace\u3092\u4f7f\u3044\u5206\u3051\u3089\u308c\u308b\nSELECT regexp_replace('01-23-45', '[0-9]', 'Z'), --\u7d50\u679c: ZZ-ZZ-ZZ\nSELECT replace('01-23-45', '-', ''), --\u7d50\u679c: 012345\n```\n\n### \u6b63\u898f\u8868\u73fe\u3092\u7528\u3044\u305f\u95a2\u6570\n\nHive\u3067\u306fRLIKE\u3092\u7528\u3044\u307e\u3059\u304c\u3001Presto\u3067\u306fregexp_like\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n```sql\n-- Hive\u3067\u52d5\u304f\u30af\u30a8\u30ea\nSELECT 'abc' RLIKE '^[a-z]{3}$'\n\n-- Presto\u3067\u52d5\u304f\u30af\u30a8\u30ea\nSELECT regexp_like('abc', '^[a-z]{3}$')\n```\n\n\u306a\u304a\u3001Presto\u3067\u306f`col LIKE '%abc%'`\u306f`regexp_like(col, 'abc')`\u306b\u5185\u90e8\u7684\u306b\u66f8\u304d\u63db\u3048\u3089\u308c\u3066\u3044\u307e\u3059\u3002\n\u3082\u3061\u308d\u3093\u305d\u306e\u969b\u306b\u30d1\u30bf\u30fc\u30f3\u90e8\u5206\u306f\u30a8\u30b9\u30b1\u30fc\u30d7\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u30e1\u30bf\u6587\u5b57\u304c\u542b\u307e\u308c\u3066\u3082\u554f\u984c\u306a\u304f\u52d5\u304d\u307e\u3059\u3002\n\n### \u6b63\u898f\u8868\u73fe\u3067\u30e1\u30bf\u6587\u5b57\u3092\u5229\u7528\u3059\u308b\u969b\u306e\u30a8\u30b9\u30b1\u30fc\u30d7\n\n\u30e1\u30bf\u6587\u5b57\u3092\u5358\u306a\u308b\u6587\u5b57\u5217\u3068\u3057\u3066\u6271\u3046\u969b\u306b\u306f\u3001\u30a8\u30b9\u30b1\u30fc\u30d7\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001Hive\u3068Presto\u3067\u6319\u52d5\u304c\u7570\u306a\u308b\u6642\u304c\u3042\u308a\u307e\u3059\u3002\n\u5bfe\u8c61\u3068\u306a\u308b\u30e1\u30bf\u6587\u5b57\u306b\u306f`\u00a5 * + . ? { } ( ) [ ] ^ $ - |`\u304c\u3042\u308a\u307e\u3059\u3002 [\u5f15\u7528\u5143\uff1awww.javadrive.jp](http://www.javadrive.jp/regex/ini/index4.html)\n\u4e00\u822c\u7684\u306b\u306f\u30d0\u30c3\u30af\u30b9\u30e9\u30c3\u30b7\u30e5\u30921\u3064\u3068\u3059\u308b\u306e\u304c\u901a\u5e38\u306a\u306e\u3067\u3001Hive\u30af\u30a8\u30ea\u3092\u66f8\u304f\u969b\u306b\u306f\u30cf\u30de\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\u6319\u52d5\u304c\u540c\u3058\u30b5\u30f3\u30d7\u30eb\u306f\u6b21\u306e\u901a\u308a\u3067\u3059\n\n```sql\n--Hive\u30fbPresto\u5171\u306b\u540c\u3058\u6319\u52d5\nselect regexp_replace('(\u4eee\u79f0)ABC', '[\uff08\\(]?\u4eee\u79f0?[\uff09\\)]', '') --\u7d50\u679c: ABC\nselect regexp_extract('(\u4eee\u79f0)ABC', '[\uff08\\(]?(\u4eee\u79f0?)[\uff09\\)]', 1) --\u7d50\u679c: \u4eee\u79f0\n```\n\n\u6319\u52d5\u304c\u7570\u306a\u308b\u5b9f\u969b\u306e\u30b5\u30f3\u30d7\u30eb\u306f\u6b21\u306e\u901a\u308a\u3067\u3059\u3002\n\u3053\u3053\u3067\u306f\u3001`AAA(BB`\u304b\u3089`(BB`\u3092\u53d6\u308a\u51fa\u3057\u307e\u3059\u3002\n\n```sql\n--Hive: \u30a8\u30b9\u30b1\u30fc\u30d7\u304c1\u3064\u306e\u5834\u5408\nselect regexp_extract('AAA(BB', '(\\(BB)$', 1)\n--\u30a8\u30e9\u30fc\u5185\u5bb9 Wrong arguments '1': org.apache.hadoop.hive.ql.metadata.HiveException\n\n--Hive: \u30a8\u30b9\u30b1\u30fc\u30d7\u304c2\u3064\u306e\u5834\u5408\nselect regexp_extract('AAA(BB', '(\\\\(BB)$', 1) --\u7d50\u679c: (BB\n\n--Presto: \u30a8\u30b9\u30b1\u30fc\u30d7\u304c1\u3064\u306e\u5834\u5408\nselect regexp_extract('AAA(BB', '(\\(BB)$', 1) --\u7d50\u679c: (BB\n\n--Presto: \u30a8\u30b9\u30b1\u30fc\u30d7\u304c2\u3064\u306e\u5834\u5408\nselect regexp_extract('AAA(BB', '(\\\\(BB)$', 1)\n--\u30a8\u30e9\u30fc\u5185\u5bb9 failed: end pattern with unmatched parenthesis\n```\n\n\u305d\u306e\u4ed6\u3001\u3053\u3046\u3044\u3063\u305f\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u6642\u3082\u3042\u308a\u307e\u3059\u3002\n\n```sql\n--Hive: \u30a8\u30b9\u30b1\u30fc\u30d7\u304c1\u3064\u306e\u5834\u5408 \u52d5\u304b\u306a\u3044\nselect regexp_replace('Hive\u30d3\u30eb(B1-7F)', '\\(?B?[0-9]+[-\u301c][0-9][F\u968e]\\)?', '')\n--\u30a8\u30e9\u30fc\u5185\u5bb9 Unknown inline modifier near index 2\n\n--Hive: \u30a8\u30b9\u30b1\u30fc\u30d7\u304c1\u3064\u306e\u5834\u5408 \u52d5\u304f\nselect regexp_replace('Hive\u30d3\u30eb(B1-7F)', '\\\\(?B?[0-9]+[-\u301c][0-9][F\u968e]\\\\)?', '')\n```\n\nHive\u3067\u306f\u30d0\u30c3\u30af\u30b9\u30e9\u30c3\u30b7\u30e5\u30922\u3064\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u30b1\u30fc\u30b9\u304c\u3042\u308b\u3053\u3068\u3001\u899a\u3048\u3066\u304a\u304d\u305f\u3044\u3067\u3059\u306d\u3002\n\u3069\u3046\u3044\u3046\u6761\u4ef6\u3067\u305d\u3046\u3059\u308c\u3070\u826f\u3044\u306e\u304b\u307e\u3060\u5206\u304b\u3089\u306a\u3044\u306e\u3067\u3001\u3054\u5b58\u3058\u306e\u65b9\u3044\u3089\u3063\u3057\u3083\u308c\u3070\u6559\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u307e\u305f\u3001\u4f8b\u3048\u3070\u3042\u308b\u30ab\u30e9\u30e0A\u306b\u30ab\u30e9\u30e0B\u306e\u5185\u5bb9\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u304b\u3092\u8abf\u3079\u305f\u3044\u3068\u304d\u3001LIKE\u3067\u90e8\u5206\u4e00\u81f4\u691c\u7d22\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\u3057\u304b\u3057\u6b63\u898f\u8868\u73fe\u3068\u7d44\u307f\u5408\u308f\u305b\u305f\u3044\u6642\u306b\u306f\u3001\u30e1\u30bf\u6587\u5b57\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u4e8b\u3082\u8003\u616e\u3057\u3066\u30a8\u30b9\u30b1\u30fc\u30d7\u3057\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002\n\u305d\u306e\u6642\u306b\u4fbf\u5229\u306a\u30e1\u30bf\u6587\u5b57\u304c\u6b21\u304e\u306e`\\Q`\u3068`\\E`\u3067\u3059\u3002\n\n* `\\` ... \u6b63\u898f\u8868\u73fe\u3067\u306f\u306a\u3044\u304c\u3001\u6b21\u306e\u6587\u5b57\u3092\u30a8\u30b9\u30b1\u30fc\u30d7\u3059\u308b\n* `\\Q` ... \u6b63\u898f\u8868\u73fe\u3067\u306f\u306a\u3044\u304c\u3001\\E \u307e\u3067\u306e\u3059\u3079\u3066\u306e\u6587\u5b57\u3092\u30a8\u30b9\u30b1\u30fc\u30d7\u3059\u308b\n* `\\E` ... \u6b63\u898f\u8868\u73fe\u3067\u306f\u306a\u3044\u304c\u3001\\Q \u3067\u958b\u59cb\u3055\u308c\u305f\u5f15\u7528\u3092\u30a8\u30b9\u30b1\u30fc\u30d7\u3059\u308b\n\n\u5f15\u7528\u5143: https://docs.oracle.com/javase/jp/7/api/java/util/regex/Pattern.html\n\n\u30d0\u30c3\u30af\u30b9\u30e9\u30c3\u30b7\u30e5\u306f\u6709\u540d\u306a\u3082\u306e\u3067\u3001\u76f4\u5f8c\u306b\u3042\u308b\u610f\u5473\u306e\u3042\u308b\u6587\u5b57\u3092\u30a8\u30b9\u30b1\u30fc\u30d7\u3057\u3066\u5358\u7d14\u306a\u6587\u5b57\u5217\u3068\u3057\u3066\u6271\u3046\u7269\u3067\u3059\u3002\n\u305d\u306e\u5f8c\u306b\u7d9a\u304f2\u3064\u306f\u30bb\u30c3\u30c8\u3067\u4f7f\u3046\u7269\u3067\u3001`\\Q`\u304b\u3089\u5f15\u7528\u6587\u5b57\u5217\u3068\u3057\u3066`\\E`\u307e\u3067\u3001\u30a8\u30b9\u30b1\u30fc\u30d7\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u5229\u7528\u30b5\u30f3\u30d7\u30eb\u306f\u6b21\u306e\u901a\u308a\u3067\u3059\u3002\n\u3053\u3053\u3067\u306f\u5358\u7d14\u306b\u90e8\u5206\u4e00\u81f4\u3067\u898b\u3066\u3044\u307e\u3059\u304c\u3001\u6b63\u898f\u8868\u73fe\u306e\u4e00\u90e8\u306b\u7d44\u307f\u8fbc\u3093\u3067\u5229\u7528\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\n* Hive\u306e\u4f8b `WHERE building_name REGEXP CONCAT('\\\\Q', room_name, '\\\\E')`\n* Presto\u306e\u4f8b `WHERE regexp_like(building_name, '\\Q' || room_name || '\\E')`\n\n\u3053\u308c\u3092\u6d3b\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u6fc0\u3057\u3044\u30a8\u30b9\u30b1\u30fc\u30d7\u51e6\u7406\u3092\u5b9f\u88c5\u3059\u308b\u3053\u3068\u306a\u304f\u30b9\u30de\u30fc\u30c8\u306b\u5b9f\u88c5\u3057\u305f\u3044\u3067\u3059\u306d\u3002\n\n### \u6b63\u898f\u8868\u73fe\u3067\u6587\u5b57\u5217\u3092\u62bd\u51fa\u3059\u308b\u3068\u304d\u306e\u6319\u52d5\n\n\u30de\u30c3\u30c1\u3057\u306a\u3044\u6b63\u898f\u8868\u73fe\u3067regexp_extract\u3092\u4f7f\u3046\u3068\u3001Null\u304c\u8fd4\u308b\u7269\u3068\u601d\u3063\u3066\u3044\u307e\u3057\u305f\u304c\u3001Hive\u306f\u7a7a\u6587\u5b57\u3092\u8fd4\u3057\u307e\u3059\u3002\n\u4e00\u65b9\u3002Presto\u306f\u671f\u5f85\u901a\u308aNULL\u3092\u8fd4\u3057\u307e\u3059\u3002\n\n```sql\n--Hive : \u7a7a\u6587\u5b57\u304c\u8fd4\u308b\nSELECT regexp_extract('example-string', '([0-9]+)', 1) as foo\n\n--Presto : NULL\u304c\u8fd4\u308b\nSELECT regexp_extract('example-string', '([0-9]+)', 1) as foo\n```\n\n\u305d\u306e\u305f\u3081\u3001\u305d\u306e\u7d50\u679c\u3092\u5229\u7528\u3057\u3066\u5225\u306e\u30af\u30a8\u30ea\u3067\u6761\u4ef6\u3092\u66f8\u304f\u6642\u306b\u306f\u8003\u616e\u304c\u5fc5\u8981\u3067\u3059\n\n```sql\n--Presto\u3067\u306f\u52d5\u304f\u304c\u3001Hive\u3067\u306f\u540c\u3058\u3088\u3046\u306b\u52d5\u304b\u306a\u3044\u4f8b\nSELECT\n  foo\nFROM\n  (SELECT regexp_extract('example-string', '([0-9]+)', 1) as foo) t\nWHERE\n  foo IS NOT NULL\n\n--Hive\u3067\u306f\u7a7a\u6587\u5b57\u3067\u306e\u5224\u5b9a\u304c\u5fc5\u8981\u3067\u3059\nSELECT\n  foo\nFROM\n  (SELECT regexp_extract('example-string', '([0-9]+)', 1) as foo) t\nWHERE\n  foo != ''\n```\n\n\u7a7a\u6587\u5b57\u3068\u3059\u308b\u306e\u306f\u6c17\u6301\u3061\u60aa\u3044\u306e\u3067\u3001Hive\u3067\u305d\u306e\u7d50\u679c\u3092NULL\u3068\u3057\u3066\u6271\u3046\u306b\u306f\u6b21\u306e\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u3002\ntranslate\u95a2\u6570\u3084regexp_replace\u306a\u3069\u3067\u306f\u5bfe\u51e6\u3067\u304d\u305a\u3001\u4ed6\u306b\u826f\u3044\u65b9\u6cd5\u304c\u3042\u308c\u3070\u6559\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\n```sql\n--Hive: regexp_extract\u3067\u30de\u30c3\u30c1\u3057\u306a\u3044\u5834\u5408\u306bNULL\u3092\u8fd4\u3059\u65b9\u6cd5\n--IF\u6587\u3084CASE\u6587\u3092\u7528\u3044\u3001LIKE\u3084REGEXP\u3092\u7528\u3044\u3066\u4e8b\u524d\u306b\u5224\u5b9a\u3059\u308b\nSELECT\n  foo\nFROM\n  (\n    SELECT\n      IF('example-string' REGEXP '([0-9]+)', regexp_extract('example-string', '([0-9]+)', 1), NULL) as foo\n    UNION ALL\n    SELECT\n      IF('example-string' REGEXP '([a-z]+)', regexp_extract('example-string', '([a-z]+)', 1), NULL) as foo\n  ) t\nWHERE\n  foo IS NOT NULL\n```\n\n### 2\u3064\u306e\u65e5\u4ed8\u306e\u671f\u9593\u8a08\u7b97\n\n2\u3064\u306e\u65e5\u4ed8\u306e\u671f\u9593\u3092\u8a08\u7b97\u3057\u305f\u3044\u6642\u306b\u306fdatediff\u3092\u4f7f\u3044\u307e\u3059\u3002\n\u5f15\u6570\u306e\u9806\u756a\u304c\u7570\u306a\u308b\u306e\u3067\u6ce8\u610f\u3057\u307e\u3057\u3087\u3046\u3002\n\n```sql\n--Hive\u3067\u52d5\u304f\u30af\u30a8\u30ea\n--2\u3064\u306e\u5dee\u5206\u65e5\u6570\u306e\u8a08\u7b97\u306e\u307f\u3067\u304d\u308b\n--datediff(enddate, startdate)\nSELECT datediff('2009-03-01', '2009-02-27') --\u7d50\u679c: 2\n\n--Presto\u3067\u52d5\u304f\u30af\u30a8\u30ea\n--\u7b2c1\u5f15\u6570\u3067\u6307\u5b9a\u3057\u305f\u5358\u4f4d(\u4e0b\u8a18\u53c2\u7167)\u3067\u306e\u5dee\u3092\u8a08\u7b97\u3067\u304d\u308b\n--date_diff(unit, starttime, endtime)\nSELECT date_diff('day', CAST('2009-02-27' AS DATE), CAST('2009-03-01' AS DATE)) --\u7d50\u679c: 2\nSELECT date_diff('day', CAST('2009-02-27' AS TIMESTAMP), CAST('2009-03-01' AS TIMESTAMP)) --\u7d50\u679c: 2\n```\n\nPresto\u3067\u306f\u3001date_diff\u306e\u7b2c1\u5f15\u6570\u306b\u6b21\u306e\u5024\u304c\u4f7f\u3048\u307e\u3059\u3002\nhttps://prestodb.io/docs/current/functions/datetime.html#interval-functions\n\n| \u5358\u4f4d        | \u8aac\u660e        |\n|-------------|--------------------|\n| millisecond | \u30df\u30ea\u79d2       |\n| second      | \u79d2\u6570            |\n| minute      | \u5206\u6570            |\n| hour        | \u6642\u9593              |\n| day         | \u65e5\u6570               |\n| week        | \u9031\u6570              |\n| month       | \u6708\u6570             |\n| quarter     | \u56db\u534a\u671f |\n| year        | \u5e74\u6570              |\n\nPresto\u306edate_diff\u306e\u7b2c2\u5f15\u6570\u3068\u7b2c3\u5f15\u6570\u3067\u6271\u3048\u308b\u578b\u306e\u30d1\u30bf\u30fc\u30f3\u306f\u6b21\u306e\u901a\u308a\u3067\u3059\u3002\nHive\u306e\u3088\u3046\u306b\u6587\u5b57\u5217\u3067\u6e21\u3059\u3068\u3001`Unexpected parameters (varchar, varchar, varchar)`\u3068\u3044\u3046\u30a8\u30e9\u30fc\u3068\u306a\u308a\u307e\u3059\u3002\n\n* date_diff(varchar, date, date)\n* date_diff(varchar, time, time)\n* date_diff(varchar, time with time zone, time with time zone)\n* date_diff(varchar, timestamp, timestamp)\n* date_diff(varchar, timestamp with time zone, timestamp with time zone) \n\nHive\u304b\u3089Presto\u3078\u306e\u66f8\u304d\u63db\u3048\u306f\u7c21\u5358\u3067\u3059\u304c\u3001\u305d\u306e\u9006\u306f\u53b3\u3057\u3044\u72b6\u6cc1\u3067\u3059\u3002\n\u306a\u304a\u3001Hive 1.2.0\u304b\u3089\u6708\u6570\u306e\u5dee\u3092\u6c42\u3081\u308bmonths_between\u95a2\u6570\u304c\u52a0\u308f\u308a\u307e\u3057\u305f\u3002\n\n```sql\n--Hive 1.2.0\u4ee5\u964d\u3067\u4f7f\u3048\u308b\u95a2\u6570\nSELECT months_between('1997-02-28 10:30:00', '1996-10-30')--\u7d50\u679c: 3.94959677\n```\n\n### \u578b\u5909\u63db\n\nHive\u3067\u306fLL\u8a00\u8a9e\u306e\u3088\u3046\u306b\u578b\u304c\u9055\u3048\u3069\u3088\u3057\u306a\u306b\u6271\u3063\u3066\u304f\u308c\u307e\u3059\u304c\u3001\nPresto\u3067\u306f\u578b\u304c\u7570\u306a\u308b\u3068\u30a8\u30e9\u30fc\u3068\u306a\u308b\u306e\u3067\u53b3\u683c\u306b\u578b\u3092\u610f\u8b58\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u5225\u306e\u578b\u306e\u3082\u306e\u3092\u6587\u5b57\u5217\u578b\u306b\u3057\u305f\u3044\u6642\u306f\u3001\u6b21\u306e\u3088\u3046\u306b\u884c\u3044\u307e\u3059\u3002\n\n```sql\n--Hive\u3067\u52d5\u304f\u30af\u30a8\u30ea\nCAST(col1 AS STRING)\n--\u4e0a\u8a18\u30af\u30a8\u30ea\u3092Presto\u3067\u4f7f\u3046\u3068\u6b21\u306e\u30a8\u30e9\u30fc\u3068\u306a\u308a\u307e\u3059\n--Unknown type: STRING\n\n--Presto\u3067\u52d5\u304f\u30af\u30a8\u30ea\nCAST(col1 AS VARCHAR)\n--\u4e0a\u8a18\u30af\u30a8\u30ea\u3092Hive\u3067\u4f7f\u3046\u3068\u6b21\u306e\u306e\u30a8\u30e9\u30fc\u3068\u306a\u308a\u307e\u3059\n--mismatched input ')' expecting ( near 'VARCHAR' in primitive type specification\n```\n\n### ORDER BY\u3067\u4f7f\u3046\u30ab\u30e9\u30e0\u306f\u5fc5\u305aSELECT\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\n\nPresto\u3067\u306f\u3001SELECT\u53e5\u3067\u30ea\u30b9\u30c8\u30a2\u30c3\u30d7\u3057\u306a\u304f\u3066\u3082ORDER BY\u53e5\u3067\u4f7f\u3048\u307e\u3059\u304c\u3001\nHive\u3067\u306fWHERE\u53e5\u3067\u4f7f\u3046\u7269\u306fSELECT\u53e5\u3067\u547c\u3073\u51fa\u3059\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u305d\u306e\u969b\u306f\u6b21\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u3068\u306a\u308a\u307e\u3059\u3002`possible column names are`\u3068\u3044\u3046\u306e\u304cORDER BY\u53e5\u3067\u4f7f\u3048\u308b\u7269\u3067\u3059\u3002\n`Invalid table alias or column reference 'room_name': (possible column names are: building_name, _c1)`\n\n### \u30d1\u30fc\u30bb\u30f3\u30bf\u30a4\u30eb\u3092\u7b97\u51fa\n\n\u30d1\u30fc\u30bb\u30f3\u30bf\u30a4\u30eb\u3092\u7b97\u51fa\u3059\u308b\u95a2\u6570\u306f\u3001\u5358\u8a9e\u306e\u9806\u756a\u304c\u9006\u306b\u306a\u308a\u307e\u3059\u3002\ncol\u3092\u6607\u9806\u306b\u4e26\u3079\u3066\u5c0f\u3055\u3044\u65b9\u304b\u308950%\u306e\u6240\u3001\u3064\u307e\u308a\u4e2d\u592e\u5024\u3092\u53d6\u308b\u4f8b\u3067\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n* Presto: approx_percentile(col, 0.5)\n* Hive: percentile_approx(col, 0.5)\n\n\n### TreasureData\u306eUDF\u306e\u5bfe\u5fdc\u72b6\u6cc1\n\n\u6b21\u306e2\u3064\u306fHive\u30fbPresto\u5171\u306b\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n\n* TD_TIME_RANGE()\n* TD_TIME_ADD()\n\n\u305d\u306e\u4ed6\u306b\u3001Hive\u3067\u306fUDF\u3068\u3057\u3066\u7528\u610f\u3057\u306a\u3044\u9650\u308a\u7121\u304b\u3063\u305f\u304c\u3001Presto\u3067\u306f\u6a19\u6e96\u3067\u4f7f\u3048\u308b\u95a2\u6570\u3082\u3042\u308a\u307e\u3059\u3002\n\u3044\u308f\u3086\u308bGROUP BY\u3057\u305f\u3082\u306e\u306e\u4e2d\u3067\u6700\u5f8c\u306b\u3042\u308b\u30ec\u30b3\u30fc\u30c9\u3092\u512a\u5148\u3059\u308b\u3068\u3044\u3046\u4fbf\u5229\u95a2\u6570\u3067\u3059\u3002\n\nref. http://prestodb.io/docs/current/functions/aggregate.html#max_by\n\n| Hive       | Presto              |\n|------------|---------------------|\n| TD_LAST()  | max_by(url, time)   |\n| TD_FIRST() | max_by(url, - time) |\n\n```sql\n-- Hive example for TreasureData\nSELECT user, TD_LAST(url, time) AS last_url FROM access_logs GROUP BY user;\n\n-- Presto  example\nSELECT user, MAX_BY(url, time) as last_url FROM access_logs GROUP BY user;\n```\n\n\u4f8b\u3048\u3070GROUP BY\u3057\u305f\u3082\u306e\u306b\u7d10\u4ed8\u304f\u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u4e2d\u3067\u3001\u6587\u5b57\u6570\u304c\u6700\u3082\u9577\u3044\u3082\u306e\u3060\u3051\u3092\u53d6\u308a\u51fa\u3057\u305f\u3044\u6642\u306b\u306f\u6b21\u306e\u3088\u3046\u306b\u884c\u3044\u307e\u3059\u3002\nGROUP BY\u306b\u306fMAX_BY\u3067\u53d6\u308a\u51fa\u3057\u305f\u3044\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u6307\u5b9a\u3057\u306a\u3044\u3088\u3046\u306b\u6c17\u3092\u3064\u3051\u307e\u3057\u3087\u3046\u3002\n\n```sql\n-- \u30e6\u30fc\u30b6\u3068\u3001\u6700\u3082\u6587\u5b57\u6570\u306e\u591a\u3044\u30b3\u30e1\u30f3\u30c8\u3092\u53d6\u308a\u51fa\u3059\u4f8b\nSELECT user_id, MAX_BY(comment, length(comment)) as long_comment FROM comments GROUP BY user_id;\n```\n\n# \u6700\u5f8c\u306b\n\nMySQL/Hive/Presto\u306e\u6319\u52d5\u306e\u9055\u3044\u3092\u307e\u3068\u3081\u307e\u3057\u305f\u3002\n\u4ed6\u306b\u3082Tips\u304c\u3042\u308c\u3070\u968f\u6642\u66f4\u65b0\u3057\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n# \u4f75\u305b\u3066\u8aad\u307f\u305f\u3044\n\n* 7.1. Migrating From Hive \u2014 Presto 0.90 Documentation<br />\nhttp://prestodb.io/docs/current/migration/from-hive.html\n"}