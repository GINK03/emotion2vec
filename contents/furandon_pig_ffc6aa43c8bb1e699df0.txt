{"context": "iij/ipgen\u3068\u3044\u3046FreeBSD\u4e0a\u3067\u52d5\u4f5c\u3059\u308b\u30d1\u30b1\u30c3\u30c8\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u304cGitHub\u3067\u516c\u958b\u3055\u308c\u3066\u3044\u305f\u306e\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u4ee5\u4e0b\u306e\u624b\u9806\u306fiij/ipgen/README.md\u306e\u5185\u5bb9\u3092\u5143\u306b\u3001FreeBSD+NetBSD\u3067\u30c6\u30b9\u30c8\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u307e\u3067\u306e\u624b\u9806\u3067\u3059\u3002\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\n\u4eca\u56de\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n+-------------------------------------+\n|               FreeBSD               |\n+---+-----------------+---------------+\n    |em1              |em2\n    |172.16.0.59      |172.16.1.159\n    |                 |\n    |                 |\n    |wm1              |wm2\n    |172.16.0.58      |172.16.1.158\n+---+-----------------+---------------+\n|                NetBSD               |\n+-------------------------------------+\n\nFreeBSD\u306f10.3-RELEASE\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n$ freebsd-version -ku\n10.3-RELEASE\n10.3-RELEASE\n\n\nnetmap\u6a5f\u80fd\u3092\u30ab\u30fc\u30cd\u30eb\u306b\u7d44\u307f\u8fbc\u3080\nipgen\u306fnetmap\u3068\u3044\u3046\u30d1\u30b1\u30c3\u30c8I/O\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u6a5f\u80fd\u306fGENERIC\u30ab\u30fc\u30cd\u30eb\u306b\u306f\u7d44\u307f\u8fbc\u307e\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u4e8b\u524d\u306b\u30ab\u30fc\u30cd\u30eb\u3092\u518d\u69cb\u7bc9\u3057\u307e\u3059\u3002\n$ mkdir -p ~/work/pakeana\n$ cd ~/work/pakeana\n$ curl -O http://ftp.jaist.ac.jp/pub/FreeBSD/releases/amd64/10.3-RELEASE/src.txz\n$ tar Jxvf src.txz -C .\n$ cd usr/src/sys/amd64/conf/\n$ cp -p GENERIC PAKEANA01\n$ vi PAKEANA01\n...\n$ diff -ur GENERIC PAKEANA01\n--- GENERIC     2016-03-25 10:09:25.000000000 +0900\n+++ PAKEANA01   2016-04-20 00:41:01.631701000 +0900\n@@ -364,3 +364,5 @@\n\n # VMware support\n device         vmx                     # VMware VMXNET3 Ethernet\n+\n+device         netmap\n$ config PAKEANA01\nKernel build directory is ../compile/PAKEANA01\nDon't forget to do ``make cleandepend && make depend''\n$ cd ../compile/PAKEANA01/\n$ make cleandepend\n$ make depend\n$ make\n$ sudo make install\n\n\u3053\u308c\u3067netmap\u304c\u7d44\u307f\u8fbc\u307e\u308c\u305f\u30ab\u30fc\u30cd\u30eb\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3057\u305f\u3002FreeBSD\u3092\u518d\u8d77\u52d5\u3057\u305f\u5f8c\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067netmap\u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n$ sysctl -a | grep device | grep netmap\ndevice   netmap\n\n\nipgen\u306e\u30d3\u30eb\u30c9\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u6b21\u306bipgen\u3092\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002ipgen\u306flibevent\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u306e\u3067\u4e88\u3081\u30d1\u30c3\u30b1\u30fc\u30b8\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n$ pkg search libevent2\nlibevent2-2.0.22_1             API for executing callback functions on events or timeouts\n$ sudo pkg install libevent2-2.0.22_1\n$ git clone https://github.com/iij/ipgen.git\n$ cd ipgen\n$ make depend\n$ sudo make install\n\n\nNetBSD\u5074\u3067\u306e\u6e96\u5099\n\u5bfe\u5411\u5074\u306e\u30de\u30b7\u30f3\u3068\u306a\u308bNetBSD\u3067\u306f\u3001IP forwarding\u3092\u6709\u52b9\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n# sysctl -w net.inet.ip.forwarding=1\nnet.inet.ip.forwarding: 0 -> 1\n\n\u3053\u308c\u3067ipgen\u3092\u8a66\u3057\u3066\u307f\u308b\u305f\u3081\u306e\u6e96\u5099\u304c\u6574\u3044\u307e\u3057\u305f\u3002\n\nipgen\u3067\u30d1\u30b1\u30c3\u30c8\u9001\u51fa\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30d1\u30b1\u30c3\u30c8\u3092\u9001\u51fa\u3057\u307e\u3059\u3002\"T\"\u306fTx\u3001\"R\"\u306fRx\u3067\u3059\u306d\u3002\n$ sudo ipgen -Tem1,172.16.0.58,172.16.0.59/24 -Rem2,172.16.1.158,172.16.1.159/24\n\n\u5b9f\u884c\u753b\u9762\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002CLI(TUI?)\u304b\u3089\u30d1\u30b1\u30c3\u30c8\u9001\u51fa\u306e\u958b\u59cb\u30fb\u505c\u6b62\u3084\u9001\u51fa\u30d1\u30b1\u30c3\u30c8\u30b5\u30a4\u30ba\u7b49\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u307e\u305f\u3001CLI\u3068\u5171\u306bWeb\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3082\u5229\u7528\u3067\u304d\u307e\u3059\u30028080\u756a\u30dd\u30fc\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u30d1\u30b1\u30c3\u30c8\u9001\u51fa\u306e\u5236\u5fa1\u304c\u884c\u3048\u307e\u3059\u3002\n\n\u3053\u3093\u306a\u611f\u3058\u3067ipgen\u3092\u8a66\u3057\u3066\u307f\u308b\u305f\u3081\u306e\u74b0\u5883\u304c\u69cb\u7bc9\u3067\u304d\u307e\u3057\u305f\u3002\n\n\u307e\u3068\u3081\niij/ipgen\u3068\u3044\u3046\u30d1\u30b1\u30c3\u30c8\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002Raspberry Pi+FreeBSD\u3067ipgen\u3092\u52d5\u304b\u3059\u3088\u3046\u306b\u3059\u308b\u3068\u3001(NIC\u304c100M\u306a\u306e\u304c\u7389\u306b\u30ad\u30ba\u3067\u3059\u304c)\u304a\u624b\u8efd\u306b\u5229\u7528\u3067\u304d\u308b\u30d1\u30b1\u30c3\u30c8\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u74b0\u5883\u3068\u3057\u3066\u6d3b\u7528\u3067\u304d\u305d\u3046\u3067\u3059\u3002\u307e\u305f\u3001ipgen\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u53c2\u8003\u306bnetmap\u3092\u8abf\u3079\u3066\u307f\u308b\u306e\u3082\u9762\u767d\u305d\u3046\u3067\u3059\u3002\n[iij/ipgen](https://github.com/iij/ipgen)\u3068\u3044\u3046FreeBSD\u4e0a\u3067\u52d5\u4f5c\u3059\u308b\u30d1\u30b1\u30c3\u30c8\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u304cGitHub\u3067\u516c\u958b\u3055\u308c\u3066\u3044\u305f\u306e\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u4ee5\u4e0b\u306e\u624b\u9806\u306f[iij/ipgen/README.md](https://github.com/iij/ipgen/blob/master/README.md)\u306e\u5185\u5bb9\u3092\u5143\u306b\u3001FreeBSD+NetBSD\u3067\u30c6\u30b9\u30c8\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u307e\u3067\u306e\u624b\u9806\u3067\u3059\u3002\n\n# \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\n\n\u4eca\u56de\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n```\n+-------------------------------------+\n|               FreeBSD               |\n+---+-----------------+---------------+\n    |em1              |em2\n    |172.16.0.59      |172.16.1.159\n    |                 |\n    |                 |\n    |wm1              |wm2\n    |172.16.0.58      |172.16.1.158\n+---+-----------------+---------------+\n|                NetBSD               |\n+-------------------------------------+\n```\n\nFreeBSD\u306f10.3-RELEASE\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\n```\n$ freebsd-version -ku\n10.3-RELEASE\n10.3-RELEASE\n```\n\n# netmap\u6a5f\u80fd\u3092\u30ab\u30fc\u30cd\u30eb\u306b\u7d44\u307f\u8fbc\u3080\n\nipgen\u306f[netmap](http://info.iet.unipi.it/~luigi/netmap/)\u3068\u3044\u3046\u30d1\u30b1\u30c3\u30c8I/O\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u6a5f\u80fd\u306fGENERIC\u30ab\u30fc\u30cd\u30eb\u306b\u306f\u7d44\u307f\u8fbc\u307e\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u4e8b\u524d\u306b\u30ab\u30fc\u30cd\u30eb\u3092\u518d\u69cb\u7bc9\u3057\u307e\u3059\u3002\n\n```\n$ mkdir -p ~/work/pakeana\n$ cd ~/work/pakeana\n$ curl -O http://ftp.jaist.ac.jp/pub/FreeBSD/releases/amd64/10.3-RELEASE/src.txz\n$ tar Jxvf src.txz -C .\n$ cd usr/src/sys/amd64/conf/\n$ cp -p GENERIC PAKEANA01\n$ vi PAKEANA01\n...\n$ diff -ur GENERIC PAKEANA01\n--- GENERIC     2016-03-25 10:09:25.000000000 +0900\n+++ PAKEANA01   2016-04-20 00:41:01.631701000 +0900\n@@ -364,3 +364,5 @@\n\n # VMware support\n device         vmx                     # VMware VMXNET3 Ethernet\n+\n+device         netmap\n$ config PAKEANA01\nKernel build directory is ../compile/PAKEANA01\nDon't forget to do ``make cleandepend && make depend''\n$ cd ../compile/PAKEANA01/\n$ make cleandepend\n$ make depend\n$ make\n$ sudo make install\n```\n\n\u3053\u308c\u3067netmap\u304c\u7d44\u307f\u8fbc\u307e\u308c\u305f\u30ab\u30fc\u30cd\u30eb\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3057\u305f\u3002FreeBSD\u3092\u518d\u8d77\u52d5\u3057\u305f\u5f8c\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067netmap\u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n```\n$ sysctl -a | grep device | grep netmap\ndevice   netmap\n```\n\n# ipgen\u306e\u30d3\u30eb\u30c9\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u6b21\u306bipgen\u3092\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002ipgen\u306flibevent\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u306e\u3067\u4e88\u3081\u30d1\u30c3\u30b1\u30fc\u30b8\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n$ pkg search libevent2\nlibevent2-2.0.22_1             API for executing callback functions on events or timeouts\n$ sudo pkg install libevent2-2.0.22_1\n$ git clone https://github.com/iij/ipgen.git\n$ cd ipgen\n$ make depend\n$ sudo make install\n```\n\n# NetBSD\u5074\u3067\u306e\u6e96\u5099\n\n\u5bfe\u5411\u5074\u306e\u30de\u30b7\u30f3\u3068\u306a\u308bNetBSD\u3067\u306f\u3001IP forwarding\u3092\u6709\u52b9\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n# sysctl -w net.inet.ip.forwarding=1\nnet.inet.ip.forwarding: 0 -> 1\n```\n\n\u3053\u308c\u3067ipgen\u3092\u8a66\u3057\u3066\u307f\u308b\u305f\u3081\u306e\u6e96\u5099\u304c\u6574\u3044\u307e\u3057\u305f\u3002\n\n# ipgen\u3067\u30d1\u30b1\u30c3\u30c8\u9001\u51fa\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30d1\u30b1\u30c3\u30c8\u3092\u9001\u51fa\u3057\u307e\u3059\u3002\"T\"\u306fTx\u3001\"R\"\u306fRx\u3067\u3059\u306d\u3002\n\n```\n$ sudo ipgen -Tem1,172.16.0.58,172.16.0.59/24 -Rem2,172.16.1.158,172.16.1.159/24\n```\n\n\u5b9f\u884c\u753b\u9762\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002CLI(TUI?)\u304b\u3089\u30d1\u30b1\u30c3\u30c8\u9001\u51fa\u306e\u958b\u59cb\u30fb\u505c\u6b62\u3084\u9001\u51fa\u30d1\u30b1\u30c3\u30c8\u30b5\u30a4\u30ba\u7b49\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n![img101.png](https://qiita-image-store.s3.amazonaws.com/0/61137/62c5fc6f-b7e6-64fa-a127-da663257d8b8.png)\n\n\u307e\u305f\u3001CLI\u3068\u5171\u306bWeb\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3082\u5229\u7528\u3067\u304d\u307e\u3059\u30028080\u756a\u30dd\u30fc\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u30d1\u30b1\u30c3\u30c8\u9001\u51fa\u306e\u5236\u5fa1\u304c\u884c\u3048\u307e\u3059\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-04-22 8.08.52.png](https://qiita-image-store.s3.amazonaws.com/0/61137/161e4bdd-e452-1b45-11f1-7e36c7d51d75.png)\n\n\u3053\u3093\u306a\u611f\u3058\u3067ipgen\u3092\u8a66\u3057\u3066\u307f\u308b\u305f\u3081\u306e\u74b0\u5883\u304c\u69cb\u7bc9\u3067\u304d\u307e\u3057\u305f\u3002\n\n# \u307e\u3068\u3081\n\niij/ipgen\u3068\u3044\u3046\u30d1\u30b1\u30c3\u30c8\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002Raspberry Pi+FreeBSD\u3067ipgen\u3092\u52d5\u304b\u3059\u3088\u3046\u306b\u3059\u308b\u3068\u3001(NIC\u304c100M\u306a\u306e\u304c\u7389\u306b\u30ad\u30ba\u3067\u3059\u304c)\u304a\u624b\u8efd\u306b\u5229\u7528\u3067\u304d\u308b\u30d1\u30b1\u30c3\u30c8\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u74b0\u5883\u3068\u3057\u3066\u6d3b\u7528\u3067\u304d\u305d\u3046\u3067\u3059\u3002\u307e\u305f\u3001ipgen\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u53c2\u8003\u306bnetmap\u3092\u8abf\u3079\u3066\u307f\u308b\u306e\u3082\u9762\u767d\u305d\u3046\u3067\u3059\u3002\n", "tags": ["NetBSD", "FreeBSD", "netmap", "\u30d1\u30b1\u30c3\u30c8\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf"]}