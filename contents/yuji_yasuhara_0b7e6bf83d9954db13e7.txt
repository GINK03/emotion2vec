{"context": " More than 1 year has passed since last update.Unity 2 Advent Calendar 2015 23\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\n\u8efd\u3044\u96ea\u3092\uff01\nUnity \u3067\u96ea\u3092\u964d\u3089\u305b\u307e\u3057\u3087\u3046\u3002\u305d\u308c\u3082\u30c7\u30e2\u30c7\u30e2\u3057\u305f\u30ab\u30c3\u30b3\u30a4\u30a4\u306e\u3058\u3083\u306a\u304f\u3066\u3001\u305d\u306e\u307e\u307e\u30b2\u30fc\u30e0\u306b\u4f7f\u3048\u3061\u3083\u3046\u3088\u3046\u306a\u3001 \u306a\u308b\u3079\u304f\u5b9f\u7528\u7684\u306a\u3082\u306e\u3092\u3002\u3064\u307e\u308a\u8efd\u3044\u3084\u3064\u3002\n\u30b5\u30f3\u30bf\u3055\u3093\u3042\u308a\u304c\u3068\u3046\u7684\u306a\u96ea\u3092\uff01\n\nGPU \u3067\u63cf\u304f\n\u3068\u3044\u3046\u308f\u3051\u3067 GPU \u3092\u4f7f\u3046\u3057\u304b\u306a\u3044\u3067\u3059\u306d\u3002\u3068\u306f\u3044\u3048\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u3068\u304b\u306f\u4f7f\u3044\u307e\u305b\u3093\u3002\u5927\u62b5\u306e\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3067\u52d5\u4f5c\u3059\u308b\u3082\u306e\u3092\u76ee\u6307\u3057\u307e\u3059\u3002\u4e88\u3081\u9802\u70b9\u3092\u5c71\u307b\u3069\u7528\u610f\u3057\u3066\u304a\u3044\u3066\u3001\u9802\u70b9\u30b7\u30a7\u30fc\u30c0\u3067\u30d3\u30eb\u30dc\u30fc\u30c9\u306b\u3059\u308b\u4f5c\u6226\u3067\u3059\u3002\uff08\u307e\u3042\u3001\u3088\u304f\u3042\u308b\u8a71\u306a\u3093\u3067\u3059\u3051\u3069\u3001\u610f\u5916\u3068\u307e\u3068\u307e\u3063\u305f\u306e\u306f\u306a\u3044\u3088\u3046\u306a\uff09\n\nSnow.cs\n\u3044\u304d\u306a\u308a\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3002\u4e0a\u304b\u3089\u9806\u756a\u306b\u89e3\u8aac\u3057\u3066\u304d\u307e\u3059\u3002\n\nSnow.cs\n[RequireComponent(typeof(MeshFilter),typeof(MeshRenderer))]\npublic class Snow : MonoBehaviour\n{\n    const int SNOW_NUM = 16000;\n    private Vector3[] vertices_;\n    private int[] triangles_;\n    private Color[] colors_;\n    private Vector2[] uvs_;\n\n\n\u2191\u30af\u30e9\u30b9\u3092\u7528\u610f\u3057\u3001\u9802\u70b9\u305d\u306e\u4ed6\u3092\u7528\u610f\u3057\u307e\u3059\u3002Unity \u306f\uff11\u30c9\u30ed\u30fc\u30b3\u30fc\u30eb\u3067 65000 \u9802\u70b9\u307e\u3067\u6271\u3048\u308b\u306e\u3067\u3001\u4e00\u7c92\uff14\u9802\u70b9\u306e\u96ea\u306f\u305d\u306e 1/4 \u307e\u3067\u51fa\u305b\u307e\u3059\u3002\u3068\u308a\u3042\u3048\u305a\u3081\u3044\u3044\u3063\u3071\u3044\u306e 16000 \u500b\u306b\u3057\u3068\u304d\u307e\u3057\u3087\u3046\u3002GPU \u304c\u60b2\u9cf4\u3092\u3042\u3052\u305f\u3089\u6e1b\u3089\u305b\u3070\u3044\u3044\u306e\u3067\u3059\u3002\n\nSnow.cs\u7d9a\u304d\n    private float range_;\n    private float rangeR_;\n    private Vector3 move_ = Vector3.zero;\n\n\n\u2191\u305d\u306e\u4ed6\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u3059\u3002range_ \u306f\u3001\u96ea\u3092\u964d\u3089\u305b\u308b\u7bc4\u56f2\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u9060\u304f\u307e\u3067\u63cf\u3044\u3066\u3082\u610f\u5473\u306a\u3044\u3067\u3059\u304b\u3089\u306d\u3002\u624b\u524d\u3060\u3051\u3067\u5341\u5206\u3002\n\nSnow.cs\u7d9a\u304d\n    void Start ()\n    {\n        range_ = 16f;\n        rangeR_ = 1.0f/range_;\n        vertices_ = new Vector3[SNOW_NUM*4];\n        for (var i = 0; i < SNOW_NUM; ++i) {\n            float x = Random.Range (-range_, range_);\n            float y = Random.Range (-range_, range_);\n            float z = Random.Range (-range_, range_);\n            var point = new Vector3(x, y, z);\n            vertices_ [i*4+0] = point;\n            vertices_ [i*4+1] = point;\n            vertices_ [i*4+2] = point;\n            vertices_ [i*4+3] = point;\n        }\n\n\n\u2191\u3053\u3053\u304b\u3089 Start \u95a2\u6570\u3067\u3059\u3002\u7bc4\u56f2\u5185\u306e\u30e9\u30f3\u30c0\u30e0\u306a\u70b9\u306b\uff14\u9802\u70b9\u3092\u307e\u3068\u3081\u307e\u3059\u3002\n\nSnow.cs\u7d9a\u304d\n        triangles_ = new int[SNOW_NUM * 6];\n        for (int i = 0; i < SNOW_NUM; ++i) {\n            triangles_[i*6+0] = i*4+0;\n            triangles_[i*6+1] = i*4+1;\n            triangles_[i*6+2] = i*4+2;\n            triangles_[i*6+3] = i*4+2;\n            triangles_[i*6+4] = i*4+1;\n            triangles_[i*6+5] = i*4+3;\n        }\n\n\n\u2191\u4e0a\u306e\uff14\u9802\u70b9\u3092\u77e9\u5f62\u306b\u3059\u308b\u3088\u3046\u306b\u7d50\u3093\u3067\u9762\u306b\u3057\u307e\u3059\u3002\u4e09\u89d2\u5f62\u3075\u305f\u3064\u305a\u3064\u3067\u3059\u306d\u3002\n\nSnow.cs\u7d9a\u304d\n        uvs_ = new Vector2[SNOW_NUM*4];\n        for (var i = 0; i < SNOW_NUM; ++i) {\n            uvs_ [i*4+0] = new Vector2 (0f, 0f);\n            uvs_ [i*4+1] = new Vector2 (1f, 0f);\n            uvs_ [i*4+2] = new Vector2 (0f, 1f);\n            uvs_ [i*4+3] = new Vector2 (1f, 1f);\n        }\n\n\n\u2191UV\u5ea7\u6a19\u3067\u3059\u3002\u30c6\u30af\u30b9\u30c1\u30e3\u3092\u5f35\u308b\u306e\u3067\u5f53\u7136\u5fc5\u8981\u306a\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u30c6\u30af\u30b9\u30c1\u30e3\u5ea7\u6a19\u4ee5\u5916\u306b\u3082\u4f7f\u7528\u3057\u307e\u3059\u3002\u3053\u306e\u5f8c\u306e\u30b7\u30a7\u30fc\u30c0\u7de8\u3067\u89e6\u308c\u307e\u3059\u3002\n\nSnow.cs\u7d9a\u304d\n        Mesh mesh = new Mesh ();\n        mesh.name = \"MeshSnowFlakes\";\n        mesh.vertices = vertices_;\n        mesh.triangles = triangles_;\n        mesh.colors = colors_;\n        mesh.uv = uvs_;\n        mesh.bounds = new Bounds(Vector3.zero, Vector3.one * 99999999);\n        var mf = GetComponent<MeshFilter> ();\n        mf.sharedMesh = mesh;\n    }\n\n\n\u2191\u30e1\u30c3\u30b7\u30e5\u306b\u683c\u7d0d\u3057\u307e\u3059\u3002bounds \u306b\u3059\u3054\u3044\u5024\u3092\u5165\u308c\u3066\u3044\u308b\u306e\u306f\u3001Frustom Culling \u3055\u308c\u306a\u3044\u305f\u3081\u3002Unity \u306f Frustom Culling \u3092\u7121\u52b9\u306b\u3067\u304d\u306a\u3044\u3093\u3067\u3059\u3002\n\u3053\u3053\u307e\u3067\u304c Start \u95a2\u6570\u3067\u3057\u305f\u3002\u304b\u306a\u308a\u91cd\u3044\u51e6\u7406\u306a\u306e\u3067\u3001\u9593\u9055\u3063\u3066\u3082 Update \u306b\u5165\u308c\u306a\u3044\u3088\u3046\u306b\u3002\n\nSnow.cs\u7d9a\u304d\u3001\u6700\u5f8c\n    void LateUpdate ()\n    {\n        var target_position = Camera.main.transform.TransformPoint(Vector3.forward * range_);\n        var mr = GetComponent<Renderer> ();\n        mr.material.SetFloat(\"_Range\", range_);\n        mr.material.SetFloat(\"_RangeR\", rangeR_);\n        mr.material.SetFloat(\"_Size\", 0.1f);\n        mr.material.SetVector(\"_MoveTotal\", move_);\n        mr.material.SetVector(\"_CamUp\", Camera.main.transform.up);\n        mr.material.SetVector(\"_TargetPosition\", target_position);\n    }\n}\n\n\n\u2191\u305d\u3057\u3066\u6bce\u30d5\u30ec\u30fc\u30e0\u306e\u66f4\u65b0\u3067\u3059\u3002transform \u306e\u66f4\u65b0\u5f8c\u306b\u547c\u3070\u308c\u3066\u6b32\u3057\u3044\u306e\u3067\u3001LateUpdate \u306b\u3057\u307e\u3057\u305f\u3002\u5185\u5bb9\u306f\u307b\u3068\u3093\u3069\u30b7\u30a7\u30fc\u30c0\u5b9a\u6570\u306e\u8a2d\u5b9a\u3060\u3051\u3067\u3059\u306d\u3002target_position \u306f\u3001\u30ab\u30e1\u30e9\u304b\u3089\u306e\u524d\u65b9\u4f4d\u7f6e\u3092\u8a08\u7b97\u3057\u3066\u304a\u304d\u3001\u3053\u3053\u3092\u4e2d\u5fc3\u306b\u96ea\u304c\u964d\u308a\u307e\u3059\u3002\n\n_Range : \u96ea\u306e\u7bc4\u56f2\n_RangeR : _Range \u306e\u9006\u6570\uff08\u8a08\u7b97\u52b9\u7387\u306e\u305f\u3081\uff09\n_Size : \u96ea\u306e\u7c92\u306e\u5927\u304d\u3055\n_MoveTotal : \u79fb\u52d5\u91cf\n_CamUp : \u30ab\u30e1\u30e9\u306e\u8996\u7dda\u30d9\u30af\u30c8\u30eb\u306b\u5bfe\u3057\u3066\uff19\uff10\u5ea6\u4e0a\u306e\u30d9\u30af\u30c8\u30eb\n_TargetPosition : \u96ea\u306e\u7bc4\u56f2\u306e\u4e2d\u5fc3\n\n\u3053\u3093\u306a\u611f\u3058\u3002\u6b21\u306b\u30b7\u30a7\u30fc\u30c0\u3002\n\nsnow.shader\n\nsnow.shader\nShader \"Custom/snow\" {\n    Properties {\n        _MainTex (\"Base (RGB)\", 2D) = \"white\" {}\n    }\n\n\n\u2191\u30c6\u30af\u30b9\u30c1\u30e3\u3092\u4f7f\u3046\u3088\u3068\u3002\n\nsnow.shader\u7d9a\u304d\n    SubShader {\n        Tags { \"Queue\"=\"Transparent\" \"IgnoreProjector\"=\"True\" \"RenderType\"=\"Transparent\" }\n        ZWrite Off\n        Cull Off\n        Blend SrcAlpha OneMinusSrcAlpha // alpha blending\n\n\n\u2191\u900f\u660e\u306e\u30d1\u30b9\u306b\u63cf\u304d\u307e\u3059\u3002\u3042\u3068\u306f Z \u306f\u66f8\u304b\u306a\u3044\u3001backface culling \u3057\u306a\u3044\u3001\u30a2\u30eb\u30d5\u30a1\u30d6\u30ec\u30f3\u30c9\u3092\u30df\u30c3\u30af\u30b9\u3067\u3002\n\nsnow.shader\u7d9a\u304d\n        Pass {\n            CGPROGRAM\n\n            #pragma vertex vert\n            #pragma fragment frag\n            #pragma target 3.0\n\n            #include \"UnityCG.cginc\"\n\n            uniform sampler2D _MainTex;\n\n            struct appdata_custom {\n                float4 vertex : POSITION;\n                float2 texcoord : TEXCOORD0;\n            };\n\n            struct v2f {\n                float4 pos:SV_POSITION;\n                float2 uv:TEXCOORD0;\n            };\n\n            float4x4 _PrevInvMatrix;\n            float3   _TargetPosition;\n            float    _Range;\n            float    _RangeR;\n            float    _Size;\n            float3   _MoveTotal;\n            float3   _CamUp;\n\n\n\u2191\u305a\u3089\u305a\u3089\u3068\u6c7a\u307e\u308a\u6587\u53e5\u3092\u66f8\u3044\u3066\u3001\n\nsnow.shader\u7d9a\u304d\n            v2f vert(appdata_custom v)\n            {\n                float3 target = _TargetPosition;\n                float3 trip;\n                float3 mv = v.vertex.xyz;\n                mv += _MoveTotal;\n                trip = floor( ((target - mv)*_RangeR + 1) * 0.5 );\n                trip *= (_Range * 2);\n                mv += trip;\n\n\n\u2191\u3053\u3053\u304b\u3089\u9802\u70b9\u30b7\u30a7\u30fc\u30c0\u3002\u4eca\u56de\u306e\u30e1\u30a4\u30f3\u3067\u3059\u3002\u5e38\u306b _TargetPosition \u306e\u5468\u308a\u306b\u767b\u5834\u3059\u308b\u3088\u3046\u306a\u8a08\u7b97\u3092\u3057\u307e\u3059\u3002\u5358\u306b\u5ea7\u6a19\u3092\u8db3\u3059\u306e\u3067\u306f\u30c0\u30e1\u3067\u3001\u3046\u307e\u304f\u30ea\u30d4\u30fc\u30c8\u3055\u305b\u306a\u3044\u3068\u3044\u3051\u307e\u305b\u3093\u3002\nfloor( ((target - mv)*_RangeR + 1) * 0.5 );\n\u3053\u308c\u304c\u30ad\u30e2\u3067\u3059\u306d\u3002\u5f0f\u306e\u610f\u5473\u3092\u7406\u89e3\u3057\u305f\u3044\u65b9\u306f\u3053\u3061\u3089\u3092\u3069\u3046\u305e\u3002\n\nsnow.shader\u7d9a\u304d\n                float3 diff = _CamUp * _Size;\n                float3 finalposition;\n                float3 tv0 = mv;\n                {\n                    float3 eyeVector = ObjSpaceViewDir(float4(tv0, 0));\n                    float3 sideVector = normalize(cross(eyeVector,diff));\n                    tv0 += (v.texcoord.x-0.5f)*sideVector * _Size;\n                    tv0 += (v.texcoord.y-0.5f)*diff;\n                    finalposition = tv0;\n                }\n\n\n\u2191\u3053\u3053\u3067\u8996\u7dda\u30d9\u30af\u30c8\u30eb\u3092\u4f7f\u3063\u3066\u30d3\u30eb\u30dc\u30fc\u30c9\u306b\u3057\u307e\u3059\u3002texcoord \u3092\u5229\u7528\u3057\u3066\u56db\u9685\u3092\u8b58\u5225\u3057\u307e\u3059\u3002\u3046\u307e\u3044\u5177\u5408\u306b0\u30681\u304c\u5165\u3063\u3066\u3044\u308b\u306e\u3067\u6210\u308a\u7acb\u3064\u3093\u3067\u3059\u3088\u306d\u3002\u306a\u306e\u3067 UV \u306b\u306f 0 \u3068 1 \u4ee5\u5916\u306e\u5024\u3092\u5165\u308c\u3066\u306f\u3044\u3051\u306a\u3044\u306e\u3067\u3059\u3002\n\nsnow.shader\u7d9a\u304d\n                v2f o;\n                o.pos = mul( UNITY_MATRIX_MVP, float4(finalposition,1));\n                o.uv = MultiplyUV(UNITY_MATRIX_TEXTURE0, v.texcoord);\n                return o;\n            }\n\n\n\u2191\u6700\u5f8c\u306f\u666e\u901a\u306b\u5ea7\u6a19\u3092\u51fa\u3057\u3066\u5b8c\u4e86\u3002\n\nsnow.shader\u7d9a\u304d\u3001\u6700\u5f8c\n\n            fixed4 frag(v2f i) : SV_Target\n            {\n                return tex2D(_MainTex, i.uv);\n            }\n\n            ENDCG\n        }\n    }\n}\n\n\n\u2191\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u30b7\u30a7\u30fc\u30c0\u306f\u30c6\u30af\u30b9\u30c1\u30e3\u5f15\u304f\u3060\u3051\u3002\n\n\u753b\u50cf\u3092\u7528\u610f\u3059\u308b\n\u3044\u304d\u306a\u308a python\u3002\n\nimage.py\nimport Image\nimport ImageDraw\nimport math\n\ndef drawing(img):\n    x,y = img.size\n    cx = x/2\n    cy = y/2\n    if x < y:\n        rad = x/2\n    else:\n        rad = y/2\n    draw = ImageDraw.Draw(img)\n    for i in range(0,x):\n        for j in range(0,y):\n            dist = math.sqrt((i - cx)*(i - cx) + (j - cy)*(j - cy))\n            val = 0xff*(1.0 - (dist/rad));\n            draw.point((i, j), (0xff,0xff,0xff,int(val)))\n    return img\n\ndef make_image(screen, bgcolor, filename):\n    img = Image.new('RGBA', screen, bgcolor)\n    img = drawing(img)\n    img.save(filename)\n\nif __name__ == '__main__':\n    screen = (64,64)\n\n    bgcolor=(0x00,0x00,0x00,0x00)\n\n    filename = \"snow.png\"\n\n    make_image(screen, bgcolor, filename)\n\n#EOF\n\n\n\u4e38\u3044\u30c6\u30af\u30b9\u30c1\u30e3\u3050\u3089\u3044\u306f\u3001\u81ea\u529b\u3067\u4f5c\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u3068\u304d\u305f\u3044\u3067\u3059\u306d\u3002\u7279\u306b alpha \u3092\u53b3\u5bc6\u306b\u6307\u5b9a\u3057\u305f\u3044\u5834\u5408\u306f\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u4f5c\u3063\u3061\u3083\u3063\u305f\u307b\u3046\u304c\u65e9\u3044\u3067\u3059\u3002\u65ad\u8a00\u3002\n\u307e\u3001python \u306e PIL \u3068\u3044\u3046\u4fbf\u5229\u306a\u3082\u306e\u304c\u3042\u308c\u3070\u3053\u305d\u3067\u3059\u304c\u3002\n\u3053\u308c\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u5168\u9762\u304c white \u3067 alpha \u3060\u3051\u304c\u4e2d\u592e\u304b\u3089\u306e\u8ddd\u96e2\u6e1b\u8870\u3057\u305f\u753b\u50cf\u304c\u51fa\u6765\u4e0a\u304c\u308a\u307e\u3059\u3002\n\n\u2191\u3053\u3093\u306a\u611f\u3058\u3002\n\n\u5b9f\u884c\u3059\u308b\n\u3055\u3042\u5b9f\u884c\u3002\u3082\u3061\u308d\u3093\u30b7\u30fc\u30f3\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u304c\u5fc5\u8981\u3067\u3059\u3051\u3069\u3001\u305d\u3053\u306f\u7701\u7565\u3002\u307e\u3042\u7f6e\u304f\u3060\u3051\u3067\u3059\u3088\u306d\u3002\n\n\u51fa\u307e\u3057\u305f\u30fc\uff01\n\nBatches: 7 \u3068\u51fa\u3066\u307e\u3059\u304c\u3001\u518d\u751f\u3092\u505c\u6b62\u3059\u308b\u3068 6 \u3067\u3057\u305f\u3002\u306a\u306e\u3067\u96ea\u306e\u51e6\u7406\u5358\u4f4d\u306f\uff11\u3067\u3059\u3002\u3084\u3063\u305f\u306d\uff01\n\n\u3061\u3083\u3093\u3068\u3001\u30ab\u30e1\u30e9\u306e\u524d\u306b\u30ab\u30bf\u30de\u30ea\u304c\u6765\u3066\u3044\u307e\u3059\u3002\u30ab\u30e1\u30e9\u304c\u3069\u3053\u306b\u3044\u3066\u3082\u3001\u305d\u306e\u524d\u306b\u3060\u3051\u964d\u3063\u3066\u3044\u308b\u308f\u3051\u3067\u3059\u306d\u3002\n\n\u964d\u3089\u3059\n\u964d\u3063\u3066\u306a\u3044\u306e\u3067\u306f\u96ea\u3068\u306f\u8a00\u3048\u307e\u305b\u3093\u3002\u4e0b\u306b\u843d\u4e0b\u3055\u305b\u307e\u3057\u3087\u3046\u3002\u9802\u70b9\u30b7\u30a7\u30fc\u30c0\u306e\u5b9f\u88c5\u3092\u7406\u89e3\u3057\u3066\u79fb\u52d5\u3055\u305b\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nSnow.cs(LateUpdate)\n    void LateUpdate ()\n    {\n        var target_position = Camera.main.transform.TransformPoint(Vector3.forward * range_);\n        var mr = GetComponent<Renderer> ();\n        mr.material.SetFloat(\"_Range\", range_);\n        mr.material.SetFloat(\"_RangeR\", rangeR_);\n        mr.material.SetFloat(\"_Size\", 0.1f);\n        mr.material.SetVector(\"_MoveTotal\", move_);\n        mr.material.SetVector(\"_CamUp\", Camera.main.transform.up);\n        mr.material.SetVector(\"_TargetPosition\", target_position);\n        float x = 0f;\n        float y = -2f;\n        float z = 0f;\n        move_ += new Vector3(x, y, z) * Time.deltaTime;\n        move_.x = Mathf.Repeat(move_.x, range_ * 2f);\n        move_.y = Mathf.Repeat(move_.y, range_ * 2f);\n        move_.z = Mathf.Repeat(move_.z, range_ * 2f);\n    }\n\n\n\u2191LateUpdate \u306e\u6700\u5f8c\u306b\u79fb\u52d5\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002\u3053\u3093\u306a\u5177\u5408\u3067 _MoveTotal \u306b\u5165\u308c\u308b\u79fb\u52d5\u91cf\u3092\u5236\u5fa1\u3057\u307e\u3059\u3002\u843d\u4e0b\u901f\u5ea6\u306f float y = -2f; \u306a\u306e\u3067\u3001\u79d2\u901f\uff12\u30e1\u30fc\u30c8\u30eb\u3067\u3059\u306d\u3002\u79fb\u52d5\u3057\u305f\u3089 Mathf.Repeat \u3092\u4f7f\u3063\u3066\u5faa\u74b0\u3055\u305b\u3066\u304a\u304d\u307e\u3059\u3002\u3067\u306a\u3044\u3068\u6570\u5024\u304c\u6c38\u9060\u306b\u5927\u304d\u304f\u306a\u3063\u3066\u3001\u30aa\u30fc\u30d0\u30fc\u30d5\u30ed\u30fc\u3092\u8d77\u3053\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n\u63fa\u3089\u3059\n\u304a\u6b21\u306f\u96ea\u3063\u307d\u304f\u3001\u30d5\u30ef\u30d5\u30ef\u3055\u305b\u307e\u3057\u3087\u3046\u3002\u4eca\u5ea6\u306f\u9802\u70b9\u30b7\u30a7\u30fc\u30c0\u306b\u624b\u3092\u52a0\u3048\u307e\u3059\u3002\n\nsnow.shader(vert)\n            v2f vert(appdata_custom v)\n            {\n                float3 target = _TargetPosition;\n                float3 trip;\n                float3 mv = v.vertex.xyz;\n                mv += _MoveTotal;\n                trip = floor( ((target - mv)*_RangeR + 1) * 0.5 );\n                trip *= (_Range * 2);\n                mv += trip;\n\n                float3 diff = _CamUp * _Size;\n                float3 finalposition;\n                float3 tv0 = mv;\n                tv0.x += sin(mv.x*0.2) * sin(mv.y*0.3) * sin(mv.x*0.9) * sin(mv.y*0.8);\n                tv0.z += sin(mv.x*0.1) * sin(mv.y*0.2) * sin(mv.x*0.8) * sin(mv.y*1.2);\n                {\n                    float3 eyeVector = ObjSpaceViewDir(float4(tv0, 0));\n                    float3 sideVector = normalize(cross(eyeVector,diff));\n                    tv0 += (v.texcoord.x-0.5f)*sideVector * _Size;\n                    tv0 += (v.texcoord.y-0.5f)*diff;\n                    finalposition = tv0;\n                }\n                v2f o;\n                o.pos = mul( UNITY_MATRIX_MVP, float4(finalposition,1));\n                o.uv = MultiplyUV(UNITY_MATRIX_TEXTURE0, v.texcoord);\n                return o;\n            }\n\n\n\u2191sin \u3092\u91cd\u306d\u5408\u308f\u305b\u308b\uff12\u884c\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002\u3053\u306e\u96ea\u306f\u30b7\u30a7\u30fc\u30c0\u3067\u4f5c\u3063\u3066\u3044\u308b\u306e\u3067\u3001CPU\u3067\u4f55\u304b\u3059\u308b\u3068\u304d\u306e\u3088\u3046\u306b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u6982\u5ff5\u3067\u306f\u52d5\u304b\u305b\u307e\u305b\u3093\u3002\u300c\u5834\u300d\u306e\u6982\u5ff5\u3067\u63fa\u3089\u3057\u307e\u3059\u3002\u3064\u307e\u308a\u7a7a\u9593\u3092\u66f2\u3052\u308b\u7684\u306a\u3002\n\u6570\u5b57\u306f\u9069\u5f53\u3067\u3001\u5468\u671f\u3092\u305a\u3089\u3057\u3066\u91cd\u306d\u307e\u3059\u3002\u4f4d\u76f8\u3092\u7e26\u8ef8\u306b\u3057\u305f\u308a\u6a2a\u8ef8\u306b\u3057\u305f\u308a\u3059\u308b\u306e\u3082\u5de5\u592b\u3067\u3059\u306d\u3002\u8abf\u6574\u3057\u3066\u3044\u308b\u3068\u3001\u697d\u3057\u304f\u3066\u3044\u304f\u3089\u3067\u3082\u6642\u9593\u304c\u904e\u304e\u3066\u3044\u304d\u307e\u3059\u3002\n\n\u6700\u5f8c\u306b\u3082\u3046\u3072\u3068\u5de5\u592b\n\nSnow.cs(LateUpdate)\n    void LateUpdate ()\n    {\n        var target_position = Camera.main.transform.TransformPoint(Vector3.forward * range_);\n        var mr = GetComponent<Renderer> ();\n        mr.material.SetFloat(\"_Range\", range_);\n        mr.material.SetFloat(\"_RangeR\", rangeR_);\n        mr.material.SetFloat(\"_Size\", 0.1f);\n        mr.material.SetVector(\"_MoveTotal\", move_);\n        mr.material.SetVector(\"_CamUp\", Camera.main.transform.up);\n        mr.material.SetVector(\"_TargetPosition\", target_position);\n        float x = (Mathf.PerlinNoise(0f, Time.time*0.1f)-0.5f) * 10f;\n        float y = -2f;\n        float z = (Mathf.PerlinNoise(Time.time*0.1f, 0f)-0.5f) * 10f;\n        move_ += new Vector3(x, y, z) * Time.deltaTime;\n        move_.x = Mathf.Repeat(move_.x, range_ * 2f);\n        move_.y = Mathf.Repeat(move_.y, range_ * 2f);\n        move_.z = Mathf.Repeat(move_.z, range_ * 2f);\n    }\n\n\ny \u3067\u843d\u4e0b\u3055\u305b\u308b\u3060\u3051\u3067\u306a\u304f\u3001x \u3068 z \u306b\u3082\u5024\u3092\u5165\u308c\u307e\u3059\u3002\u3053\u3053\u306f\u5168\u4f53\u3092\u52d5\u304b\u3059\u300c\u98a8\u300d\u306b\u306a\u308b\u306e\u3067\u3001PerlinNoise \u3067\u63fa\u3089\u304e\u3092\u5165\u308c\u3066\u307f\u307e\u3057\u3087\u3046\u3002PerlinNoise \u306e\u5165\u529b\u306f\u5e73\u9762\u306a\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u305d\u306e\u7e01\u3060\u3051\u4f7f\u308f\u305b\u3066\u3082\u3089\u3044\u307e\u3059\u3002\n\u6c17\u307e\u3050\u308c\u306a\u98a8\u304c\u5439\u304f\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u3053\u308c\u306b\u3066\u5b8c\u6210\u3068\u3057\u307e\u3059\u3002\n\n\u3053\u3046\u306a\u308a\u307e\u3057\u305f\n\u52d5\u753b\u3067\u3059\u3002\uff13\uff10\u79d2\uff1ahttps://vimeo.com/149642482\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4e00\u5f0f\u306f\u3053\u3061\u3089\u306b\u7f6e\u304d\u307e\u3057\u305f\uff1a\nhttps://github.com/dsedb/snowflakes\n\n\u30e1\u30ea\u30fc\u30af\u30ea\u30b9\u30de\u30b9\uff01\uff08\u65e9\u3044\u3051\u3069\uff09\n\u30b2\u30fc\u30e0\u4f5c\u308b\u4eba\u306b\u5e78\u3042\u308c\u3002\n[Unity 2 Advent Calendar 2015](http://qiita.com/advent-calendar/2015/unity2) 23\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\n# \u8efd\u3044\u96ea\u3092\uff01\n\nUnity \u3067\u96ea\u3092\u964d\u3089\u305b\u307e\u3057\u3087\u3046\u3002\u305d\u308c\u3082\u30c7\u30e2\u30c7\u30e2\u3057\u305f\u30ab\u30c3\u30b3\u30a4\u30a4\u306e\u3058\u3083\u306a\u304f\u3066\u3001\u305d\u306e\u307e\u307e\u30b2\u30fc\u30e0\u306b\u4f7f\u3048\u3061\u3083\u3046\u3088\u3046\u306a\u3001 __\u306a\u308b\u3079\u304f\u5b9f\u7528\u7684__\u306a\u3082\u306e\u3092\u3002\u3064\u307e\u308a\u8efd\u3044\u3084\u3064\u3002\n\u30b5\u30f3\u30bf\u3055\u3093\u3042\u308a\u304c\u3068\u3046\u7684\u306a\u96ea\u3092\uff01\n\n# GPU \u3067\u63cf\u304f\n\n\u3068\u3044\u3046\u308f\u3051\u3067 GPU \u3092\u4f7f\u3046\u3057\u304b\u306a\u3044\u3067\u3059\u306d\u3002\u3068\u306f\u3044\u3048\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u3068\u304b\u306f\u4f7f\u3044\u307e\u305b\u3093\u3002\u5927\u62b5\u306e\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3067\u52d5\u4f5c\u3059\u308b\u3082\u306e\u3092\u76ee\u6307\u3057\u307e\u3059\u3002\u4e88\u3081\u9802\u70b9\u3092\u5c71\u307b\u3069\u7528\u610f\u3057\u3066\u304a\u3044\u3066\u3001\u9802\u70b9\u30b7\u30a7\u30fc\u30c0\u3067\u30d3\u30eb\u30dc\u30fc\u30c9\u306b\u3059\u308b\u4f5c\u6226\u3067\u3059\u3002\uff08\u307e\u3042\u3001\u3088\u304f\u3042\u308b\u8a71\u306a\u3093\u3067\u3059\u3051\u3069\u3001\u610f\u5916\u3068\u307e\u3068\u307e\u3063\u305f\u306e\u306f\u306a\u3044\u3088\u3046\u306a\uff09\n\n# Snow.cs\n\u3044\u304d\u306a\u308a\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3002\u4e0a\u304b\u3089\u9806\u756a\u306b\u89e3\u8aac\u3057\u3066\u304d\u307e\u3059\u3002\n\n```C#:Snow.cs\n[RequireComponent(typeof(MeshFilter),typeof(MeshRenderer))]\npublic class Snow : MonoBehaviour\n{\n\tconst int SNOW_NUM = 16000;\n\tprivate Vector3[] vertices_;\n\tprivate int[] triangles_;\n\tprivate Color[] colors_;\n\tprivate Vector2[] uvs_;\n```\n\u2191\u30af\u30e9\u30b9\u3092\u7528\u610f\u3057\u3001\u9802\u70b9\u305d\u306e\u4ed6\u3092\u7528\u610f\u3057\u307e\u3059\u3002Unity \u306f\uff11\u30c9\u30ed\u30fc\u30b3\u30fc\u30eb\u3067 65000 \u9802\u70b9\u307e\u3067\u6271\u3048\u308b\u306e\u3067\u3001\u4e00\u7c92\uff14\u9802\u70b9\u306e\u96ea\u306f\u305d\u306e 1/4 \u307e\u3067\u51fa\u305b\u307e\u3059\u3002\u3068\u308a\u3042\u3048\u305a\u3081\u3044\u3044\u3063\u3071\u3044\u306e 16000 \u500b\u306b\u3057\u3068\u304d\u307e\u3057\u3087\u3046\u3002GPU \u304c\u60b2\u9cf4\u3092\u3042\u3052\u305f\u3089\u6e1b\u3089\u305b\u3070\u3044\u3044\u306e\u3067\u3059\u3002\n\n```C#:Snow.cs\u7d9a\u304d\n\tprivate float range_;\n\tprivate float rangeR_;\n\tprivate Vector3 move_ = Vector3.zero;\n```\n\n\u2191\u305d\u306e\u4ed6\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u3059\u3002range_ \u306f\u3001\u96ea\u3092\u964d\u3089\u305b\u308b\u7bc4\u56f2\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u9060\u304f\u307e\u3067\u63cf\u3044\u3066\u3082\u610f\u5473\u306a\u3044\u3067\u3059\u304b\u3089\u306d\u3002\u624b\u524d\u3060\u3051\u3067\u5341\u5206\u3002\n\n```C#:Snow.cs\u7d9a\u304d\n\tvoid Start ()\n\t{\n\t\trange_ = 16f;\n\t\trangeR_ = 1.0f/range_;\n\t\tvertices_ = new Vector3[SNOW_NUM*4];\n\t\tfor (var i = 0; i < SNOW_NUM; ++i) {\n\t\t\tfloat x = Random.Range (-range_, range_);\n\t\t\tfloat y = Random.Range (-range_, range_);\n\t\t\tfloat z = Random.Range (-range_, range_);\n\t\t\tvar point = new Vector3(x, y, z);\n\t\t\tvertices_ [i*4+0] = point;\n\t\t\tvertices_ [i*4+1] = point;\n\t\t\tvertices_ [i*4+2] = point;\n\t\t\tvertices_ [i*4+3] = point;\n\t\t}\n```\n\u2191\u3053\u3053\u304b\u3089 Start \u95a2\u6570\u3067\u3059\u3002\u7bc4\u56f2\u5185\u306e\u30e9\u30f3\u30c0\u30e0\u306a\u70b9\u306b\uff14\u9802\u70b9\u3092\u307e\u3068\u3081\u307e\u3059\u3002\n\n```C#:Snow.cs\u7d9a\u304d\n\t\ttriangles_ = new int[SNOW_NUM * 6];\n\t\tfor (int i = 0; i < SNOW_NUM; ++i) {\n\t\t\ttriangles_[i*6+0] = i*4+0;\n\t\t\ttriangles_[i*6+1] = i*4+1;\n\t\t\ttriangles_[i*6+2] = i*4+2;\n\t\t\ttriangles_[i*6+3] = i*4+2;\n\t\t\ttriangles_[i*6+4] = i*4+1;\n\t\t\ttriangles_[i*6+5] = i*4+3;\n\t\t}\n```\n\u2191\u4e0a\u306e\uff14\u9802\u70b9\u3092\u77e9\u5f62\u306b\u3059\u308b\u3088\u3046\u306b\u7d50\u3093\u3067\u9762\u306b\u3057\u307e\u3059\u3002\u4e09\u89d2\u5f62\u3075\u305f\u3064\u305a\u3064\u3067\u3059\u306d\u3002\n\n```C#:Snow.cs\u7d9a\u304d\n\t\tuvs_ = new Vector2[SNOW_NUM*4];\n\t\tfor (var i = 0; i < SNOW_NUM; ++i) {\n\t\t\tuvs_ [i*4+0] = new Vector2 (0f, 0f);\n\t\t\tuvs_ [i*4+1] = new Vector2 (1f, 0f);\n\t\t\tuvs_ [i*4+2] = new Vector2 (0f, 1f);\n\t\t\tuvs_ [i*4+3] = new Vector2 (1f, 1f);\n\t\t}\n```\n\u2191UV\u5ea7\u6a19\u3067\u3059\u3002\u30c6\u30af\u30b9\u30c1\u30e3\u3092\u5f35\u308b\u306e\u3067\u5f53\u7136\u5fc5\u8981\u306a\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u30c6\u30af\u30b9\u30c1\u30e3\u5ea7\u6a19\u4ee5\u5916\u306b\u3082\u4f7f\u7528\u3057\u307e\u3059\u3002\u3053\u306e\u5f8c\u306e\u30b7\u30a7\u30fc\u30c0\u7de8\u3067\u89e6\u308c\u307e\u3059\u3002\n\n```C#:Snow.cs\u7d9a\u304d\n\t\tMesh mesh = new Mesh ();\n\t\tmesh.name = \"MeshSnowFlakes\";\n\t\tmesh.vertices = vertices_;\n\t\tmesh.triangles = triangles_;\n\t\tmesh.colors = colors_;\n\t\tmesh.uv = uvs_;\n\t\tmesh.bounds = new Bounds(Vector3.zero, Vector3.one * 99999999);\n\t\tvar mf = GetComponent<MeshFilter> ();\n\t\tmf.sharedMesh = mesh;\n\t}\n```\n\u2191\u30e1\u30c3\u30b7\u30e5\u306b\u683c\u7d0d\u3057\u307e\u3059\u3002bounds \u306b\u3059\u3054\u3044\u5024\u3092\u5165\u308c\u3066\u3044\u308b\u306e\u306f\u3001Frustom Culling \u3055\u308c\u306a\u3044\u305f\u3081\u3002Unity \u306f Frustom Culling \u3092\u7121\u52b9\u306b\u3067\u304d\u306a\u3044\u3093\u3067\u3059\u3002\n\u3053\u3053\u307e\u3067\u304c Start \u95a2\u6570\u3067\u3057\u305f\u3002\u304b\u306a\u308a\u91cd\u3044\u51e6\u7406\u306a\u306e\u3067\u3001\u9593\u9055\u3063\u3066\u3082 Update \u306b\u5165\u308c\u306a\u3044\u3088\u3046\u306b\u3002\n\n```C#:Snow.cs\u7d9a\u304d\u3001\u6700\u5f8c\n\tvoid LateUpdate ()\n\t{\n\t\tvar target_position = Camera.main.transform.TransformPoint(Vector3.forward * range_);\n\t\tvar mr = GetComponent<Renderer> ();\n\t\tmr.material.SetFloat(\"_Range\", range_);\n\t\tmr.material.SetFloat(\"_RangeR\", rangeR_);\n\t\tmr.material.SetFloat(\"_Size\", 0.1f);\n\t\tmr.material.SetVector(\"_MoveTotal\", move_);\n\t\tmr.material.SetVector(\"_CamUp\", Camera.main.transform.up);\n\t\tmr.material.SetVector(\"_TargetPosition\", target_position);\n\t}\n}\n```\n\u2191\u305d\u3057\u3066\u6bce\u30d5\u30ec\u30fc\u30e0\u306e\u66f4\u65b0\u3067\u3059\u3002transform \u306e\u66f4\u65b0\u5f8c\u306b\u547c\u3070\u308c\u3066\u6b32\u3057\u3044\u306e\u3067\u3001LateUpdate \u306b\u3057\u307e\u3057\u305f\u3002\u5185\u5bb9\u306f\u307b\u3068\u3093\u3069\u30b7\u30a7\u30fc\u30c0\u5b9a\u6570\u306e\u8a2d\u5b9a\u3060\u3051\u3067\u3059\u306d\u3002target_position \u306f\u3001\u30ab\u30e1\u30e9\u304b\u3089\u306e\u524d\u65b9\u4f4d\u7f6e\u3092\u8a08\u7b97\u3057\u3066\u304a\u304d\u3001\u3053\u3053\u3092\u4e2d\u5fc3\u306b\u96ea\u304c\u964d\u308a\u307e\u3059\u3002\n\n* _Range : \u96ea\u306e\u7bc4\u56f2\n* _RangeR : _Range \u306e\u9006\u6570\uff08\u8a08\u7b97\u52b9\u7387\u306e\u305f\u3081\uff09\n* _Size : \u96ea\u306e\u7c92\u306e\u5927\u304d\u3055\n* _MoveTotal : \u79fb\u52d5\u91cf\n* _CamUp : \u30ab\u30e1\u30e9\u306e\u8996\u7dda\u30d9\u30af\u30c8\u30eb\u306b\u5bfe\u3057\u3066\uff19\uff10\u5ea6\u4e0a\u306e\u30d9\u30af\u30c8\u30eb\n* _TargetPosition : \u96ea\u306e\u7bc4\u56f2\u306e\u4e2d\u5fc3\n\n\u3053\u3093\u306a\u611f\u3058\u3002\u6b21\u306b\u30b7\u30a7\u30fc\u30c0\u3002\n\n# snow.shader\n\n```C++:snow.shader\nShader \"Custom/snow\" {\n    Properties {\n\t\t_MainTex (\"Base (RGB)\", 2D) = \"white\" {}\n    }\n```\n\u2191\u30c6\u30af\u30b9\u30c1\u30e3\u3092\u4f7f\u3046\u3088\u3068\u3002\n\n```C++:snow.shader\u7d9a\u304d\n\tSubShader {\n   \t\tTags { \"Queue\"=\"Transparent\" \"IgnoreProjector\"=\"True\" \"RenderType\"=\"Transparent\" }\n\t\tZWrite Off\n\t\tCull Off\n\t\tBlend SrcAlpha OneMinusSrcAlpha // alpha blending\n```\n\u2191\u900f\u660e\u306e\u30d1\u30b9\u306b\u63cf\u304d\u307e\u3059\u3002\u3042\u3068\u306f Z \u306f\u66f8\u304b\u306a\u3044\u3001backface culling \u3057\u306a\u3044\u3001\u30a2\u30eb\u30d5\u30a1\u30d6\u30ec\u30f3\u30c9\u3092\u30df\u30c3\u30af\u30b9\u3067\u3002\n\n```C++:snow.shader\u7d9a\u304d\n        Pass {\n \t\t\tCGPROGRAM\n\n \t\t\t#pragma vertex vert\n \t\t\t#pragma fragment frag\n \t\t\t#pragma target 3.0\n \t\t\t\n \t\t\t#include \"UnityCG.cginc\"\n\n            uniform sampler2D _MainTex;\n\n \t\t\tstruct appdata_custom {\n\t\t\t\tfloat4 vertex : POSITION;\n\t\t\t\tfloat2 texcoord : TEXCOORD0;\n\t\t\t};\n\n \t\t\tstruct v2f {\n \t\t\t\tfloat4 pos:SV_POSITION;\n\t\t\t\tfloat2 uv:TEXCOORD0;\n \t\t\t};\n \t\t\t\n \t\t\tfloat4x4 _PrevInvMatrix;\n\t\t\tfloat3   _TargetPosition;\n\t\t\tfloat    _Range;\n\t\t\tfloat    _RangeR;\n\t\t\tfloat    _Size;\n\t\t\tfloat3   _MoveTotal;\n\t\t\tfloat3   _CamUp;\n```\n\u2191\u305a\u3089\u305a\u3089\u3068\u6c7a\u307e\u308a\u6587\u53e5\u3092\u66f8\u3044\u3066\u3001\n\n```C++:snow.shader\u7d9a\u304d\n            v2f vert(appdata_custom v)\n            {\n\t\t\t\tfloat3 target = _TargetPosition;\n\t\t\t\tfloat3 trip;\n\t\t\t\tfloat3 mv = v.vertex.xyz;\n\t\t\t\tmv += _MoveTotal;\n\t\t\t\ttrip = floor( ((target - mv)*_RangeR + 1) * 0.5 );\n\t\t\t\ttrip *= (_Range * 2);\n\t\t\t\tmv += trip;\n```\n\u2191\u3053\u3053\u304b\u3089\u9802\u70b9\u30b7\u30a7\u30fc\u30c0\u3002\u4eca\u56de\u306e\u30e1\u30a4\u30f3\u3067\u3059\u3002\u5e38\u306b _TargetPosition \u306e\u5468\u308a\u306b\u767b\u5834\u3059\u308b\u3088\u3046\u306a\u8a08\u7b97\u3092\u3057\u307e\u3059\u3002\u5358\u306b\u5ea7\u6a19\u3092\u8db3\u3059\u306e\u3067\u306f\u30c0\u30e1\u3067\u3001\u3046\u307e\u304f\u30ea\u30d4\u30fc\u30c8\u3055\u305b\u306a\u3044\u3068\u3044\u3051\u307e\u305b\u3093\u3002\n`floor( ((target - mv)*_RangeR + 1) * 0.5 );`\n\u3053\u308c\u304c\u30ad\u30e2\u3067\u3059\u306d\u3002\u5f0f\u306e\u610f\u5473\u3092\u7406\u89e3\u3057\u305f\u3044\u65b9\u306f[\u3053\u3061\u3089](http://qiita.com/yuji_yasuhara/items/1b4d5f0052f074915f47#%E9%A0%82%E7%82%B9%E3%81%AE%E3%83%AA%E3%83%94%E3%83%BC%E3%83%88%E5%87%A6%E7%90%86)\u3092\u3069\u3046\u305e\u3002\n\n```C++:snow.shader\u7d9a\u304d\n\t\t\t\tfloat3 diff = _CamUp * _Size;\n\t\t\t\tfloat3 finalposition;\n\t\t\t\tfloat3 tv0 = mv;\n\t\t\t\t{\n\t\t\t\t\tfloat3 eyeVector = ObjSpaceViewDir(float4(tv0, 0));\n\t\t\t\t\tfloat3 sideVector = normalize(cross(eyeVector,diff));\n\t\t\t\t\ttv0 += (v.texcoord.x-0.5f)*sideVector * _Size;\n\t\t\t\t\ttv0 += (v.texcoord.y-0.5f)*diff;\n\t\t\t\t\tfinalposition = tv0;\n\t\t\t\t}\n```\n\u2191\u3053\u3053\u3067\u8996\u7dda\u30d9\u30af\u30c8\u30eb\u3092\u4f7f\u3063\u3066\u30d3\u30eb\u30dc\u30fc\u30c9\u306b\u3057\u307e\u3059\u3002texcoord \u3092\u5229\u7528\u3057\u3066\u56db\u9685\u3092\u8b58\u5225\u3057\u307e\u3059\u3002\u3046\u307e\u3044\u5177\u5408\u306b0\u30681\u304c\u5165\u3063\u3066\u3044\u308b\u306e\u3067\u6210\u308a\u7acb\u3064\u3093\u3067\u3059\u3088\u306d\u3002\u306a\u306e\u3067 UV \u306b\u306f 0 \u3068 1 \u4ee5\u5916\u306e\u5024\u3092\u5165\u308c\u3066\u306f\u3044\u3051\u306a\u3044\u306e\u3067\u3059\u3002\n\n```C++:snow.shader\u7d9a\u304d\n            \tv2f o;\n\t\t\t    o.pos = mul( UNITY_MATRIX_MVP, float4(finalposition,1));\n\t\t\t\to.uv = MultiplyUV(UNITY_MATRIX_TEXTURE0, v.texcoord);\n            \treturn o;\n            }\n```\n\u2191\u6700\u5f8c\u306f\u666e\u901a\u306b\u5ea7\u6a19\u3092\u51fa\u3057\u3066\u5b8c\u4e86\u3002\n\n```C++:snow.shader\u7d9a\u304d\u3001\u6700\u5f8c\n\n            fixed4 frag(v2f i) : SV_Target\n            {\n\t\t\t\treturn tex2D(_MainTex, i.uv);\n            }\n\n            ENDCG\n        }\n    }\n}\n```\n\n\u2191\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u30b7\u30a7\u30fc\u30c0\u306f\u30c6\u30af\u30b9\u30c1\u30e3\u5f15\u304f\u3060\u3051\u3002\n\n#\u753b\u50cf\u3092\u7528\u610f\u3059\u308b\n\u3044\u304d\u306a\u308a python\u3002\n\n```Python:image.py\nimport Image\nimport ImageDraw\nimport math\n\ndef drawing(img):\n    x,y = img.size\n    cx = x/2\n    cy = y/2\n    if x < y:\n        rad = x/2\n    else:\n        rad = y/2\n    draw = ImageDraw.Draw(img)\n    for i in range(0,x):\n        for j in range(0,y):\n            dist = math.sqrt((i - cx)*(i - cx) + (j - cy)*(j - cy))\n            val = 0xff*(1.0 - (dist/rad));\n            draw.point((i, j), (0xff,0xff,0xff,int(val)))\n    return img\n\ndef make_image(screen, bgcolor, filename):\n    img = Image.new('RGBA', screen, bgcolor)\n    img = drawing(img)\n    img.save(filename)\n\nif __name__ == '__main__':\n    screen = (64,64)\n\n    bgcolor=(0x00,0x00,0x00,0x00)\n\n    filename = \"snow.png\"\n\n    make_image(screen, bgcolor, filename)\n\n#EOF\n```\n\n\u4e38\u3044\u30c6\u30af\u30b9\u30c1\u30e3\u3050\u3089\u3044\u306f\u3001\u81ea\u529b\u3067\u4f5c\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u3068\u304d\u305f\u3044\u3067\u3059\u306d\u3002\u7279\u306b alpha \u3092\u53b3\u5bc6\u306b\u6307\u5b9a\u3057\u305f\u3044\u5834\u5408\u306f\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u4f5c\u3063\u3061\u3083\u3063\u305f\u307b\u3046\u304c\u65e9\u3044\u3067\u3059\u3002\u65ad\u8a00\u3002\n\u307e\u3001python \u306e PIL \u3068\u3044\u3046\u4fbf\u5229\u306a\u3082\u306e\u304c\u3042\u308c\u3070\u3053\u305d\u3067\u3059\u304c\u3002\n\n\u3053\u308c\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u5168\u9762\u304c white \u3067 alpha \u3060\u3051\u304c\u4e2d\u592e\u304b\u3089\u306e\u8ddd\u96e2\u6e1b\u8870\u3057\u305f\u753b\u50cf\u304c\u51fa\u6765\u4e0a\u304c\u308a\u307e\u3059\u3002\n![snow.png](https://qiita-image-store.s3.amazonaws.com/0/90046/d87a1e50-839b-0c31-80c0-317465bbf006.png \"snow.png\")\n\u2191\u3053\u3093\u306a\u611f\u3058\u3002\n\n#\u5b9f\u884c\u3059\u308b\n\n\u3055\u3042\u5b9f\u884c\u3002\u3082\u3061\u308d\u3093\u30b7\u30fc\u30f3\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u304c\u5fc5\u8981\u3067\u3059\u3051\u3069\u3001\u305d\u3053\u306f\u7701\u7565\u3002\u307e\u3042\u7f6e\u304f\u3060\u3051\u3067\u3059\u3088\u306d\u3002\n\n![snow.png](https://qiita-image-store.s3.amazonaws.com/0/90046/c01208dc-092e-3f92-5df4-a71376da21ad.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-21 22.31.09.png\")\n\n\u51fa\u307e\u3057\u305f\u30fc\uff01\n\n![stats.png](https://qiita-image-store.s3.amazonaws.com/0/90046/1f9de193-15c8-b44a-32a2-bd4d59f03769.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-21 22.31.25.png\")\n\nBatches: 7 \u3068\u51fa\u3066\u307e\u3059\u304c\u3001\u518d\u751f\u3092\u505c\u6b62\u3059\u308b\u3068 6 \u3067\u3057\u305f\u3002\u306a\u306e\u3067\u96ea\u306e\u51e6\u7406\u5358\u4f4d\u306f\uff11\u3067\u3059\u3002\u3084\u3063\u305f\u306d\uff01\n\n![scene.png](https://qiita-image-store.s3.amazonaws.com/0/90046/2f2ceeff-f8fd-632d-3a65-7259b3531362.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-21 22.31.55.png\")\n\n\u3061\u3083\u3093\u3068\u3001\u30ab\u30e1\u30e9\u306e\u524d\u306b\u30ab\u30bf\u30de\u30ea\u304c\u6765\u3066\u3044\u307e\u3059\u3002\u30ab\u30e1\u30e9\u304c\u3069\u3053\u306b\u3044\u3066\u3082\u3001\u305d\u306e\u524d\u306b\u3060\u3051\u964d\u3063\u3066\u3044\u308b\u308f\u3051\u3067\u3059\u306d\u3002\n\n#\u964d\u3089\u3059\n\u964d\u3063\u3066\u306a\u3044\u306e\u3067\u306f\u96ea\u3068\u306f\u8a00\u3048\u307e\u305b\u3093\u3002\u4e0b\u306b\u843d\u4e0b\u3055\u305b\u307e\u3057\u3087\u3046\u3002\u9802\u70b9\u30b7\u30a7\u30fc\u30c0\u306e\u5b9f\u88c5\u3092\u7406\u89e3\u3057\u3066\u79fb\u52d5\u3055\u305b\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```C#:Snow.cs(LateUpdate)\n\tvoid LateUpdate ()\n\t{\n\t\tvar target_position = Camera.main.transform.TransformPoint(Vector3.forward * range_);\n\t\tvar mr = GetComponent<Renderer> ();\n\t\tmr.material.SetFloat(\"_Range\", range_);\n\t\tmr.material.SetFloat(\"_RangeR\", rangeR_);\n\t\tmr.material.SetFloat(\"_Size\", 0.1f);\n\t\tmr.material.SetVector(\"_MoveTotal\", move_);\n\t\tmr.material.SetVector(\"_CamUp\", Camera.main.transform.up);\n\t\tmr.material.SetVector(\"_TargetPosition\", target_position);\n\t\tfloat x = 0f;\n\t\tfloat y = -2f;\n\t\tfloat z = 0f;\n\t\tmove_ += new Vector3(x, y, z) * Time.deltaTime;\n\t\tmove_.x = Mathf.Repeat(move_.x, range_ * 2f);\n\t\tmove_.y = Mathf.Repeat(move_.y, range_ * 2f);\n\t\tmove_.z = Mathf.Repeat(move_.z, range_ * 2f);\n\t}\n```\n\u2191LateUpdate \u306e\u6700\u5f8c\u306b\u79fb\u52d5\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002\u3053\u3093\u306a\u5177\u5408\u3067 _MoveTotal \u306b\u5165\u308c\u308b\u79fb\u52d5\u91cf\u3092\u5236\u5fa1\u3057\u307e\u3059\u3002\u843d\u4e0b\u901f\u5ea6\u306f `float y = -2f;` \u306a\u306e\u3067\u3001\u79d2\u901f\uff12\u30e1\u30fc\u30c8\u30eb\u3067\u3059\u306d\u3002\u79fb\u52d5\u3057\u305f\u3089 Mathf.Repeat \u3092\u4f7f\u3063\u3066\u5faa\u74b0\u3055\u305b\u3066\u304a\u304d\u307e\u3059\u3002\u3067\u306a\u3044\u3068\u6570\u5024\u304c\u6c38\u9060\u306b\u5927\u304d\u304f\u306a\u3063\u3066\u3001\u30aa\u30fc\u30d0\u30fc\u30d5\u30ed\u30fc\u3092\u8d77\u3053\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n#\u63fa\u3089\u3059\n\n\u304a\u6b21\u306f\u96ea\u3063\u307d\u304f\u3001\u30d5\u30ef\u30d5\u30ef\u3055\u305b\u307e\u3057\u3087\u3046\u3002\u4eca\u5ea6\u306f\u9802\u70b9\u30b7\u30a7\u30fc\u30c0\u306b\u624b\u3092\u52a0\u3048\u307e\u3059\u3002\n\n```C++:snow.shader(vert)\n            v2f vert(appdata_custom v)\n            {\n\t\t\t\tfloat3 target = _TargetPosition;\n\t\t\t\tfloat3 trip;\n\t\t\t\tfloat3 mv = v.vertex.xyz;\n\t\t\t\tmv += _MoveTotal;\n\t\t\t\ttrip = floor( ((target - mv)*_RangeR + 1) * 0.5 );\n\t\t\t\ttrip *= (_Range * 2);\n\t\t\t\tmv += trip;\n\n\t\t\t\tfloat3 diff = _CamUp * _Size;\n\t\t\t\tfloat3 finalposition;\n\t\t\t\tfloat3 tv0 = mv;\n\t\t\t\ttv0.x += sin(mv.x*0.2) * sin(mv.y*0.3) * sin(mv.x*0.9) * sin(mv.y*0.8);\n\t\t\t\ttv0.z += sin(mv.x*0.1) * sin(mv.y*0.2) * sin(mv.x*0.8) * sin(mv.y*1.2);\n\t\t\t\t{\n\t\t\t\t\tfloat3 eyeVector = ObjSpaceViewDir(float4(tv0, 0));\n\t\t\t\t\tfloat3 sideVector = normalize(cross(eyeVector,diff));\n\t\t\t\t\ttv0 += (v.texcoord.x-0.5f)*sideVector * _Size;\n\t\t\t\t\ttv0 += (v.texcoord.y-0.5f)*diff;\n\t\t\t\t\tfinalposition = tv0;\n\t\t\t\t}\n            \tv2f o;\n\t\t\t    o.pos = mul( UNITY_MATRIX_MVP, float4(finalposition,1));\n\t\t\t\to.uv = MultiplyUV(UNITY_MATRIX_TEXTURE0, v.texcoord);\n            \treturn o;\n            }\n```\n\u2191sin \u3092\u91cd\u306d\u5408\u308f\u305b\u308b\uff12\u884c\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002\u3053\u306e\u96ea\u306f\u30b7\u30a7\u30fc\u30c0\u3067\u4f5c\u3063\u3066\u3044\u308b\u306e\u3067\u3001CPU\u3067\u4f55\u304b\u3059\u308b\u3068\u304d\u306e\u3088\u3046\u306b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u6982\u5ff5\u3067\u306f\u52d5\u304b\u305b\u307e\u305b\u3093\u3002\u300c\u5834\u300d\u306e\u6982\u5ff5\u3067\u63fa\u3089\u3057\u307e\u3059\u3002\u3064\u307e\u308a\u7a7a\u9593\u3092\u66f2\u3052\u308b\u7684\u306a\u3002\n\u6570\u5b57\u306f\u9069\u5f53\u3067\u3001\u5468\u671f\u3092\u305a\u3089\u3057\u3066\u91cd\u306d\u307e\u3059\u3002\u4f4d\u76f8\u3092\u7e26\u8ef8\u306b\u3057\u305f\u308a\u6a2a\u8ef8\u306b\u3057\u305f\u308a\u3059\u308b\u306e\u3082\u5de5\u592b\u3067\u3059\u306d\u3002\u8abf\u6574\u3057\u3066\u3044\u308b\u3068\u3001\u697d\u3057\u304f\u3066\u3044\u304f\u3089\u3067\u3082\u6642\u9593\u304c\u904e\u304e\u3066\u3044\u304d\u307e\u3059\u3002\n\n#\u6700\u5f8c\u306b\u3082\u3046\u3072\u3068\u5de5\u592b\n```C#:Snow.cs(LateUpdate)\n\tvoid LateUpdate ()\n\t{\n\t\tvar target_position = Camera.main.transform.TransformPoint(Vector3.forward * range_);\n\t\tvar mr = GetComponent<Renderer> ();\n\t\tmr.material.SetFloat(\"_Range\", range_);\n\t\tmr.material.SetFloat(\"_RangeR\", rangeR_);\n\t\tmr.material.SetFloat(\"_Size\", 0.1f);\n\t\tmr.material.SetVector(\"_MoveTotal\", move_);\n\t\tmr.material.SetVector(\"_CamUp\", Camera.main.transform.up);\n\t\tmr.material.SetVector(\"_TargetPosition\", target_position);\n\t\tfloat x = (Mathf.PerlinNoise(0f, Time.time*0.1f)-0.5f) * 10f;\n\t\tfloat y = -2f;\n\t\tfloat z = (Mathf.PerlinNoise(Time.time*0.1f, 0f)-0.5f) * 10f;\n\t\tmove_ += new Vector3(x, y, z) * Time.deltaTime;\n\t\tmove_.x = Mathf.Repeat(move_.x, range_ * 2f);\n\t\tmove_.y = Mathf.Repeat(move_.y, range_ * 2f);\n\t\tmove_.z = Mathf.Repeat(move_.z, range_ * 2f);\n\t}\n```\n\ny \u3067\u843d\u4e0b\u3055\u305b\u308b\u3060\u3051\u3067\u306a\u304f\u3001x \u3068 z \u306b\u3082\u5024\u3092\u5165\u308c\u307e\u3059\u3002\u3053\u3053\u306f\u5168\u4f53\u3092\u52d5\u304b\u3059\u300c\u98a8\u300d\u306b\u306a\u308b\u306e\u3067\u3001PerlinNoise \u3067\u63fa\u3089\u304e\u3092\u5165\u308c\u3066\u307f\u307e\u3057\u3087\u3046\u3002PerlinNoise \u306e\u5165\u529b\u306f\u5e73\u9762\u306a\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u305d\u306e\u7e01\u3060\u3051\u4f7f\u308f\u305b\u3066\u3082\u3089\u3044\u307e\u3059\u3002\n\n\u6c17\u307e\u3050\u308c\u306a\u98a8\u304c\u5439\u304f\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u3053\u308c\u306b\u3066\u5b8c\u6210\u3068\u3057\u307e\u3059\u3002\n\n#\u3053\u3046\u306a\u308a\u307e\u3057\u305f\n\n\u52d5\u753b\u3067\u3059\u3002\uff13\uff10\u79d2\uff1ahttps://vimeo.com/149642482\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4e00\u5f0f\u306f\u3053\u3061\u3089\u306b\u7f6e\u304d\u307e\u3057\u305f\uff1a\nhttps://github.com/dsedb/snowflakes\n\n#\u30e1\u30ea\u30fc\u30af\u30ea\u30b9\u30de\u30b9\uff01\uff08\u65e9\u3044\u3051\u3069\uff09\n\u30b2\u30fc\u30e0\u4f5c\u308b\u4eba\u306b\u5e78\u3042\u308c\u3002\n", "tags": ["Unity", "GPU", "particle"]}