{"tags": ["QUIC", "IPv6", "yamaha", "TCP"], "context": "\n\n\u5168\u3066\u306fQUIC\u304b\u3089\n\u672c\u5bb6\u306e\u8cc7\u6599\u306b\u3088\u308b\u3068\u300192%\u304cworks\u3068\u66f8\u3044\u3066\u3042\u308b\u3002\n\u5f53\u7136\u3001\u81ea\u5206\u3082\u7121\u610f\u8b58\u306b\u4f7f\u3063\u3066\u3044\u308b\u306f\u305a\u3002\u3069\u3093\u306a\u3082\u306e\u304b\u898b\u3066\u307f\u305f\u3044\u3002\n\u305d\u3053\u3067\u3001Wireshark\u3002\u3059\u308b\u3068\u2026\n\n\u78ba\u304b\u306b\u51fa\u3066\u3044\u308b\u304c\u3001\u4e00\u77ac\u3060\u3051\u3002\u305d\u306e\u5f8c\u306f\u3001\u898b\u6163\u308c\u305fSSL/TLS\u304c\u3001\u3069\u3070\u30fc\u3063\u3068\u3002\n\u3044\u304d\u306a\u308a8%\u306b\u3054\u5f53\u9078\u304b\u3002\u4e0d\u5e78\u3060\u30fc\u3002\nGoogle\u69d8\u306e\u30c6\u30af\u30ce\u30ed\u30b8\u30fc\u306e\u6069\u6075\u3092\u53d7\u3051\u305f\u3044\u3058\u3083\u306a\u3044\u306e\u3002\n\n\u74b0\u5883\n\u6211\u304c\u5bb6\u306b\u306fNOC(A)\u3068NOC(B)\u304c\u3042\u308a\u3001NOC(A)=v4/v6\u30c7\u30e5\u30a2\u30eb\u30b9\u30bf\u30c3\u30af\u306eISP\u3001NOC(B)=v4\u30b7\u30f3\u30b0\u30eb\u30b9\u30bf\u30c3\u30af\u306eISP\u3002\nNOC(A)-NOC(B)\u9593\u306f\u3001IPIP(v6)\u3067\u30c8\u30f3\u30cd\u30eb\u3057\u3066\u304a\u308a\u3001NOC(B)\u306ev6\u306f\u3001NOC(A)\u306eISP\u7d4c\u7531\u306b\u306a\u308b\u3002\n\u3088\u3063\u3066\u3001NOC(A)-NOC(B)\u306ePath MTU\u306f\u30011500-40=1460\u3060\u3002\n\u3053\u308c\u306a\u3089\u30011350+8+40=1398\u306eQUIC\u306eClient Hello\u306f\u3001\u901a\u308a\u305d\u3046\u3058\u3083\u306a\u3044\u3002\n\u3067\u3082\u3001\u5b9f\u969b\u306b\u898b\u308b\u3068\u3001TCP\u306bFallback\u3057\u3066\u3044\u308b\u3002\u307e\u305f\u3001Chrome\u3092\u52d5\u304b\u3059\u30db\u30b9\u30c8\u3092v4\u30b7\u30f3\u30b0\u30eb\u306b\u3059\u308b\u3068\u3001\u3061\u3083\u3093\u3068QUIC\u306b\u306a\u308b\u3002\nUDP\u306aQUIC\u306fMSS Clamping\u3082\u52b9\u304b\u306a\u3044\u306e\u3067\u3001MTU\u304c1460\u306b\u306a\u308b\u3088\u3046\u306b\u3001Path MTU discovery\u306e\u6319\u52d5\u3092\u78ba\u8a8d\u3057\u3066\u307f\u3088\u3046\u3002(\u30d5\u30e9\u30b0)\n\nMTU\u306b\u307e\u3064\u308f\u308b\u7f60\u305f\u3061\n\u8abf\u3079\u308b\u904e\u7a0b\u3067\u76ee\u6483\u3057\u3066\u3057\u307e\u3063\u305f\u3001MTU\u306e\u5473\u308f\u3044\u6df1\u3044\u4e16\u754c\u3092\u3001\u304a\u697d\u3057\u307f\u4e0b\u3055\u3044\u3002\nUDP\u306aQUIC\u306b\u7121\u95a2\u4fc2\u306a\u3082\u306e\u3082\u542b\u3080\u3002\n\nSEIL\u306e\u7d4c\u8defMTU\u63a2\u7d22\u6291\u5236\u6a5f\u80fd\nNOC(B)\u306e\u30eb\u30fc\u30bf\u30fc\u306fSEIL/x86\u3002\n\u30de\u30cb\u30e5\u30a2\u30eb\u306b\u3088\u308b\u3068\u3001v6+\u30c8\u30f3\u30cd\u30eb\u306e\u5834\u5408\u3001PMTUD\u3092\u6291\u6b62\u3059\u308b\u6a5f\u80fd\u304c\u3042\u308b\u3089\u3057\u3044\u3002\n\u3057\u304b\u3082\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067on\u3002\n\u6761\u4ef6\u3082\u5408\u3063\u3066\u3044\u305d\u3046\u3060\u3057\u3001\u8e0f\u3093\u3067\u3057\u307e\u3063\u305f\u304b\u3002\n\nRTX1200\u306eip tunnel mtu\n\nNOC(A)\u306e\u30eb\u30fc\u30bf\u30fc\u306fRTX1200\u3002\nip tunnel mtu 1460\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u306e\u306b\u3001\u6319\u52d5\u3092\u898b\u308b\u3068\u30011280\u56fa\u5b9a\u3067\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3088\u3046\u306b\u898b\u3048\u308b\u3002\n\u6a5f\u7a2e\u3068\u6761\u4ef6\u304c\u9055\u3046\u304c\u3001\u3053\u3061\u3089\u306e\u30ea\u30ea\u30fc\u30b9\u30ce\u30fc\u30c8\u3060\u3068\u3001\u300c1280\u56fa\u5b9a\u306e\u306f\u305a\u304cip tunnel mtu\u306e\u5024\u3067\u52d5\u4f5c\u300d\u3068\u3044\u3046\u30d0\u30b0\u304c\u3042\u3063\u305f\u3089\u3057\u3044\u3002\n\u30de\u30cb\u30e5\u30a2\u30eb\u3092\u3088\u304f\u898b\u308b\u3068\u3001ip tunnnel mtu\u306f\u3042\u308b\u304c\u3001ipv6 tunnel mtu\u306f\u7121\u3044\u3002\nover v6\u306e\u30c8\u30f3\u30cd\u30eb\u306f\u30011280\u56fa\u5b9a\u304c\u3001\u4ed5\u69d8? (\u8a73\u7d30\u672a\u78ba\u8a8d)\n\u3053\u306e\u6642\u70b9\u3067\u3001QUIC over UDP over IPv6 over IPv6\u306f\u3001\u30ae\u30d6\u30a2\u30c3\u30d7\u304b\u3002\n\n\u5927\u304d\u3044ICMP\u3092\u4e0d\u6b63\u3068\u6271\u3046ICMP\nping -s\u306a\u3069\u3067MTU\u3092\u6e2c\u5b9a\u3057\u3066\u3044\u308b\u3068\u767a\u751f\u3002IDS\u306a\u3069\u3067\u4e0d\u6b63\u3068\u691c\u77e5\u3057\u3001\u843d\u3068\u3055\u308c\u3066\u3057\u307e\u3046\u3002\nYAMAHA\u306e\u5834\u5408\u306f1025\u30d0\u30a4\u30c8\u4ee5\u4e0a\u304c\u6761\u4ef6\u306e\u6a21\u69d8\u3002\n\u3053\u3061\u3089\u3082\u5927\u5909\u8a73\u3057\u3044\u3002\n\u3057\u304b\u3057\u3001MTU\u3092\u901a\u77e5\u3059\u308bICMP\u306b\u8f09\u305b\u308b\u5143\u30d1\u30b1\u30c3\u30c8\u306e\u30b5\u30a4\u30ba\u304c\u5b9f\u88c5\u4f9d\u5b58\u3068\u306f\u2026\u5927\u304d\u3044\u30d1\u30b1\u30c3\u30c8\u3092\u9001\u308d\u3046\u3068\u3057\u3066\u3001\u5927\u304d\u3059\u304e\u308b\u3053\u3068\u3092\u901a\u77e5\u3059\u308b\u30c7\u30fc\u30bf\u304c\u5927\u304d\u3059\u304e\u308b\u3068\u3001\u30d6\u30e9\u30c3\u30af\u30db\u30fc\u30eb\u3002\n\nTCP Segmentation Offload (TSO)\nQUIC\u3068\u306f\u95a2\u4fc2\u306e\u7121\u3044TCP\u306b\u3064\u3044\u3066\u3060\u304c\u3001ICMP\u306eport unreachable(MTU=1460)\u3092\u53d7\u3051\u305f\u5f8c\u306e\u30bb\u30c3\u30c3\u30b7\u30e7\u30f3\u3067\u3082\u30011460-40-20=1400\u3092\u8d85\u3048\u308bTCP\u30bb\u30b0\u30e1\u30f3\u30c8\u3092\u6295\u3052\u308b\u30db\u30b9\u30c8\u304c\u3044\u308b\u3002\n\u3057\u304b\u3082\u3001\u53d7\u3051\u305f\u65b9\u306f\u3001MSS Clamping\u306e\u3088\u3046\u306b\u3001TCP\u30ec\u30d9\u30eb\u3067MTU\u306b\u5408\u308f\u305b\u305f\u30bb\u30b0\u30e1\u30f3\u30c8\u3092\u53d7\u4fe1\u3057\u3066\u3044\u308b\u3002\n\u3055\u3089\u306b\u3001netstat -4 -nrC\u3067\u3001\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u4e57\u3089\u306a\u3044\u3088\u3046\u306b\u898b\u3048\u308b\u3002\n\u306a\u306b\u3053\u308c\u3001\u3053\u308f\u3044\u2026\u3002\n\u3053\u308c\u306f\u3001TSO\u306b\u3088\u308b\u3082\u306e\u3060\u3063\u305f\u3002\u3053\u3061\u3089\u306b\u8a73\u3057\u3044\u3002\nVMware\u3067\u306e\u8a73\u7d30\u306f\u3053\u3061\u3089\u3002\n\nTSO\u3092Off\u306b\u3067\u304d\u306a\u3044\u30c9\u30e9\u30a4\u30d0\n\u4e0a\u8a18\u8a18\u4e8b\u3067\u306f\u3001ethtool -K eth0 tso off\u3067\u7121\u52b9\u306b\u306a\u3089\u306a\u3044\u30c9\u30e9\u30a4\u30d0\u304c\u3042\u308b\u6a21\u69d8\u3002\nI350 + VMware + open-vm-tools\u3067\u3082\u3001\u7121\u52b9\u306b\u306a\u3089\u306a\u3044\u3088\u3046\u306b\u898b\u3048\u308b(\u8a73\u7d30\u672a\u78ba\u8a8d)\u3002\n\nICMP\u3067\u901a\u77e5\u3055\u308c\u308bMTU\u3088\u308a\u3082\u5c0f\u3055\u306aMTU\u3092\u4f7f\u3046\u30db\u30b9\u30c8\niPhone\u304c\u3001ICMP destination unreachable\u3092\u53d7\u3051\u308b\u3068\u30011280\u3067\u51fa\u3057\u3066\u304f\u308b\u3088\u3046\u306b\u898b\u3048\u308b\u30ed\u30b0\u3092\u30c1\u30e9\u898b\u3057\u305f\u6c17\u304c\u3059\u308b(\u8a73\u7d30\u672a\u78ba\u8a8d)\u3002\nPLPMTUD\u306b\u95a2\u9023\u304b? RFC2923?\n\nMSS Clamping\u3092\u624b\u52d5\u3067MTU\u306b\u8a2d\u5b9a\n\u305f\u3060\u306e\u81ea\u5206\u306e\u3061\u3087\u3093\u307c\u3067\u3059\u3002\n\u7279\u306bv6\u306f\u3001MTU\u306a\u30891280\u3067MSS Clamping\u3057\u306a\u3044\u3068\u901a\u3089\u306a\u3044\u3068\u3053\u308d\u306b\u3001\u7d50\u69cb\u3076\u3064\u304b\u308b\u6c17\u304c\u3059\u308b\u3002\n\u305d\u3053\u3067\u3001auto\u3067\u306a\u304f\u624b\u52d5\u8a2d\u5b9a\u3057\u3066\u3001\u306f\u307e\u308b\u3002\nMSS\u306f\u3001MTU\u304b\u3089IP\u3068TCP\u306e\u30d8\u30c3\u30c0\u5206\u6e1b\u3089\u3055\u306a\u3044\u3068\u3002v6\u306a\u3089\u30011280-40-20=1220\u3002\n\n(\u304a\u307e\u3051)Chrome\u306e\u6319\u52d5\nQUIC v6 > TLS v6 > QUIC v4 > TLS v4 \u3068\u3044\u3046\u512a\u5148\u9806\u4f4d\u306e\u3088\u3046\u3060\u3002\nPMTU\u304c1280\u306a\u7d4c\u8def\u306f\u3082\u306f\u3084\u5c11\u6570\u6d3e\u3001\u3068\u3044\u3046\u3054\u5224\u65ad\u306a\u306e\u3060\u308d\u3046\u304b\u2026\u3002\nQUIC v4\u512a\u5148\u8a2d\u5b9a\u3068\u304b\u306a\u3044\u304b\u306a(\u8981\u8abf\u67fb)\u3002\n\n\u5bbf\u984c\n\nQUIC\u95a2\u9023\n\n\nInternet draft\u306b\u3088\u308b\u3068\u3001Path MTU discovery\u306fwork in progress\nQUIC\u306e\u304a\u52c9\u5f37\u2026\u3053\u3061\u3089\u304c\u53c2\u8003\u306b\u306a\u308a\u305d\u3046\n\n\nMTU\u95a2\u9023\n\n\u4e16\u754c\u306eMTU/MSS\u72b6\u6cc1\u3001\u7279\u306bv6\nNIC\u3068\u30c9\u30e9\u30a4\u30d0\u30fc\u306eTSO\u5bfe\u5fdc\u72b6\u6cc1\nICMP\u3092\u53d7\u3051\u305f\u5f8c\u306eTCP\u306e\u6319\u52d5\nPLPMTUD\u3068tcp_mtu_probing\u3068tcp_base_mss\u306e\u95a2\u4fc2\n\n# \u5168\u3066\u306fQUIC\u304b\u3089\n[\u672c\u5bb6](https://www.chromium.org/quic)\u306e[\u8cc7\u6599](https://docs.google.com/presentation/d/15e1bLKYeN56GL1oTJSF9OZiUsI-rcxisLo9dEyDkWQs/edit#slide=id.gc34025b9a_0_0)\u306b\u3088\u308b\u3068\u300192%\u304cworks\u3068\u66f8\u3044\u3066\u3042\u308b\u3002\n\u5f53\u7136\u3001\u81ea\u5206\u3082\u7121\u610f\u8b58\u306b\u4f7f\u3063\u3066\u3044\u308b\u306f\u305a\u3002\u3069\u3093\u306a\u3082\u306e\u304b\u898b\u3066\u307f\u305f\u3044\u3002\n\u305d\u3053\u3067\u3001Wireshark\u3002\u3059\u308b\u3068\u2026\n<img width=\"849\" alt=\"Hello.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/104225/6a92551d-3318-02dd-1418-7967c7eb8861.png\">\n\u78ba\u304b\u306b\u51fa\u3066\u3044\u308b\u304c\u3001\u4e00\u77ac\u3060\u3051\u3002\u305d\u306e\u5f8c\u306f\u3001\u898b\u6163\u308c\u305fSSL/TLS\u304c\u3001\u3069\u3070\u30fc\u3063\u3068\u3002\n\u3044\u304d\u306a\u308a8%\u306b\u3054\u5f53\u9078\u304b\u3002\u4e0d\u5e78\u3060\u30fc\u3002\n\nGoogle\u69d8\u306e\u30c6\u30af\u30ce\u30ed\u30b8\u30fc\u306e\u6069\u6075\u3092\u53d7\u3051\u305f\u3044\u3058\u3083\u306a\u3044\u306e\u3002\n\n# \u74b0\u5883\n\u6211\u304c\u5bb6\u306b\u306fNOC(A)\u3068NOC(B)\u304c\u3042\u308a\u3001NOC(A)=v4/v6\u30c7\u30e5\u30a2\u30eb\u30b9\u30bf\u30c3\u30af\u306eISP\u3001NOC(B)=v4\u30b7\u30f3\u30b0\u30eb\u30b9\u30bf\u30c3\u30af\u306eISP\u3002\nNOC(A)-NOC(B)\u9593\u306f\u3001IPIP(v6)\u3067\u30c8\u30f3\u30cd\u30eb\u3057\u3066\u304a\u308a\u3001NOC(B)\u306ev6\u306f\u3001NOC(A)\u306eISP\u7d4c\u7531\u306b\u306a\u308b\u3002\n\u3088\u3063\u3066\u3001NOC(A)-NOC(B)\u306ePath MTU\u306f\u30011500-40=1460\u3060\u3002\n\u3053\u308c\u306a\u3089\u30011350+8+40=1398\u306eQUIC\u306eClient Hello\u306f\u3001\u901a\u308a\u305d\u3046\u3058\u3083\u306a\u3044\u3002\n\u3067\u3082\u3001\u5b9f\u969b\u306b\u898b\u308b\u3068\u3001TCP\u306bFallback\u3057\u3066\u3044\u308b\u3002\u307e\u305f\u3001Chrome\u3092\u52d5\u304b\u3059\u30db\u30b9\u30c8\u3092v4\u30b7\u30f3\u30b0\u30eb\u306b\u3059\u308b\u3068\u3001\u3061\u3083\u3093\u3068QUIC\u306b\u306a\u308b\u3002\nUDP\u306aQUIC\u306fMSS Clamping\u3082\u52b9\u304b\u306a\u3044\u306e\u3067\u3001MTU\u304c1460\u306b\u306a\u308b\u3088\u3046\u306b\u3001Path MTU discovery\u306e\u6319\u52d5\u3092\u78ba\u8a8d\u3057\u3066\u307f\u3088\u3046\u3002(\u30d5\u30e9\u30b0)\n\n# MTU\u306b\u307e\u3064\u308f\u308b\u7f60\u305f\u3061\n\u8abf\u3079\u308b\u904e\u7a0b\u3067\u76ee\u6483\u3057\u3066\u3057\u307e\u3063\u305f\u3001MTU\u306e\u5473\u308f\u3044\u6df1\u3044\u4e16\u754c\u3092\u3001\u304a\u697d\u3057\u307f\u4e0b\u3055\u3044\u3002\nUDP\u306aQUIC\u306b\u7121\u95a2\u4fc2\u306a\u3082\u306e\u3082\u542b\u3080\u3002\n\n## SEIL\u306e\u7d4c\u8defMTU\u63a2\u7d22\u6291\u5236\u6a5f\u80fd\nNOC(B)\u306e\u30eb\u30fc\u30bf\u30fc\u306f[SEIL/x86](http://www.seil.jp/product/seil-x86.html)\u3002\n[\u30de\u30cb\u30e5\u30a2\u30eb](http://www.seil.jp/doc/index.html#fn/option/cmd/option_ipv6_avoid_path_mtu_discovery.html)\u306b\u3088\u308b\u3068\u3001v6+\u30c8\u30f3\u30cd\u30eb\u306e\u5834\u5408\u3001PMTUD\u3092\u6291\u6b62\u3059\u308b\u6a5f\u80fd\u304c\u3042\u308b\u3089\u3057\u3044\u3002\n\u3057\u304b\u3082\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067on\u3002\n\u6761\u4ef6\u3082\u5408\u3063\u3066\u3044\u305d\u3046\u3060\u3057\u3001\u8e0f\u3093\u3067\u3057\u307e\u3063\u305f\u304b\u3002\n\n## RTX1200\u306e`ip tunnel mtu`\nNOC(A)\u306e\u30eb\u30fc\u30bf\u30fc\u306fRTX1200\u3002\n`ip tunnel mtu 1460`\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u306e\u306b\u3001\u6319\u52d5\u3092\u898b\u308b\u3068\u30011280\u56fa\u5b9a\u3067\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3088\u3046\u306b\u898b\u3048\u308b\u3002\n\u6a5f\u7a2e\u3068\u6761\u4ef6\u304c\u9055\u3046\u304c\u3001\u3053\u3061\u3089\u306e[\u30ea\u30ea\u30fc\u30b9\u30ce\u30fc\u30c8](http://www.rtpro.yamaha.co.jp/RT/relnote/Rev.10.00/relnote_10_00_61.html)\u3060\u3068\u3001\u300c1280\u56fa\u5b9a\u306e\u306f\u305a\u304c`ip tunnel mtu`\u306e\u5024\u3067\u52d5\u4f5c\u300d\u3068\u3044\u3046\u30d0\u30b0\u304c\u3042\u3063\u305f\u3089\u3057\u3044\u3002\n[\u30de\u30cb\u30e5\u30a2\u30eb](http://www.rtpro.yamaha.co.jp/RT/manual/rt-common/index.html)\u3092\u3088\u304f\u898b\u308b\u3068\u3001`ip tunnnel mtu`\u306f\u3042\u308b\u304c\u3001`ipv6 tunnel mtu`\u306f\u7121\u3044\u3002\nover v6\u306e\u30c8\u30f3\u30cd\u30eb\u306f\u30011280\u56fa\u5b9a\u304c\u3001\u4ed5\u69d8? (\u8a73\u7d30\u672a\u78ba\u8a8d)\n\u3053\u306e\u6642\u70b9\u3067\u3001QUIC over UDP over IPv6 over IPv6\u306f\u3001\u30ae\u30d6\u30a2\u30c3\u30d7\u304b\u3002\n\n## \u5927\u304d\u3044ICMP\u3092\u4e0d\u6b63\u3068\u6271\u3046ICMP\n`ping -s`\u306a\u3069\u3067MTU\u3092\u6e2c\u5b9a\u3057\u3066\u3044\u308b\u3068\u767a\u751f\u3002IDS\u306a\u3069\u3067\u4e0d\u6b63\u3068\u691c\u77e5\u3057\u3001\u843d\u3068\u3055\u308c\u3066\u3057\u307e\u3046\u3002\n[YAMAHA\u306e\u5834\u5408](http://www.rtpro.yamaha.co.jp/RT/docs/firewall/index.html#section3)\u306f1025\u30d0\u30a4\u30c8\u4ee5\u4e0a\u304c\u6761\u4ef6\u306e\u6a21\u69d8\u3002\n[\u3053\u3061\u3089](https://www.janog.gr.jp/meeting/janog34/doc/janog34-6pmtu-kunitake-1.pdf)\u3082\u5927\u5909\u8a73\u3057\u3044\u3002\n\u3057\u304b\u3057\u3001MTU\u3092\u901a\u77e5\u3059\u308bICMP\u306b\u8f09\u305b\u308b\u5143\u30d1\u30b1\u30c3\u30c8\u306e\u30b5\u30a4\u30ba\u304c\u5b9f\u88c5\u4f9d\u5b58\u3068\u306f\u2026\u5927\u304d\u3044\u30d1\u30b1\u30c3\u30c8\u3092\u9001\u308d\u3046\u3068\u3057\u3066\u3001\u5927\u304d\u3059\u304e\u308b\u3053\u3068\u3092\u901a\u77e5\u3059\u308b\u30c7\u30fc\u30bf\u304c\u5927\u304d\u3059\u304e\u308b\u3068\u3001\u30d6\u30e9\u30c3\u30af\u30db\u30fc\u30eb\u3002\n\n## TCP Segmentation Offload (TSO)\nQUIC\u3068\u306f\u95a2\u4fc2\u306e\u7121\u3044TCP\u306b\u3064\u3044\u3066\u3060\u304c\u3001ICMP\u306eport unreachable(MTU=1460)\u3092\u53d7\u3051\u305f\u5f8c\u306e\u30bb\u30c3\u30c3\u30b7\u30e7\u30f3\u3067\u3082\u30011460-40-20=1400\u3092\u8d85\u3048\u308bTCP\u30bb\u30b0\u30e1\u30f3\u30c8\u3092\u6295\u3052\u308b\u30db\u30b9\u30c8\u304c\u3044\u308b\u3002\n\u3057\u304b\u3082\u3001\u53d7\u3051\u305f\u65b9\u306f\u3001MSS Clamping\u306e\u3088\u3046\u306b\u3001TCP\u30ec\u30d9\u30eb\u3067MTU\u306b\u5408\u308f\u305b\u305f\u30bb\u30b0\u30e1\u30f3\u30c8\u3092\u53d7\u4fe1\u3057\u3066\u3044\u308b\u3002\n\u3055\u3089\u306b\u3001`netstat -4 -nrC`\u3067\u3001\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u4e57\u3089\u306a\u3044\u3088\u3046\u306b\u898b\u3048\u308b\u3002\n\u306a\u306b\u3053\u308c\u3001\u3053\u308f\u3044\u2026\u3002\n\n\u3053\u308c\u306f\u3001TSO\u306b\u3088\u308b\u3082\u306e\u3060\u3063\u305f\u3002[\u3053\u3061\u3089](\nhttp://blog.keshi.org/hogememo/2010/10/09/tcp-segmentation-offload-trap)\u306b\u8a73\u3057\u3044\u3002\nVMware\u3067\u306e\u8a73\u7d30\u306f[\u3053\u3061\u3089](https://kb.vmware.com/kb/2092912)\u3002\n\n### TSO\u3092Off\u306b\u3067\u304d\u306a\u3044\u30c9\u30e9\u30a4\u30d0\n[\u4e0a\u8a18\u8a18\u4e8b](http://blog.keshi.org/hogememo/2010/10/09/tcp-segmentation-offload-trap)\u3067\u306f\u3001`ethtool -K eth0 tso off`\u3067\u7121\u52b9\u306b\u306a\u3089\u306a\u3044\u30c9\u30e9\u30a4\u30d0\u304c\u3042\u308b\u6a21\u69d8\u3002\nI350 + VMware + open-vm-tools\u3067\u3082\u3001\u7121\u52b9\u306b\u306a\u3089\u306a\u3044\u3088\u3046\u306b\u898b\u3048\u308b(\u8a73\u7d30\u672a\u78ba\u8a8d)\u3002\n\n## ICMP\u3067\u901a\u77e5\u3055\u308c\u308bMTU\u3088\u308a\u3082\u5c0f\u3055\u306aMTU\u3092\u4f7f\u3046\u30db\u30b9\u30c8\niPhone\u304c\u3001ICMP destination unreachable\u3092\u53d7\u3051\u308b\u3068\u30011280\u3067\u51fa\u3057\u3066\u304f\u308b\u3088\u3046\u306b\u898b\u3048\u308b\u30ed\u30b0\u3092\u30c1\u30e9\u898b\u3057\u305f\u6c17\u304c\u3059\u308b(\u8a73\u7d30\u672a\u78ba\u8a8d)\u3002\n[PLPMTUD](https://tools.ietf.org/html/rfc4821)\u306b\u95a2\u9023\u304b? [RFC2923](https://tools.ietf.org/html/rfc2923)?\n\n## MSS Clamping\u3092\u624b\u52d5\u3067MTU\u306b\u8a2d\u5b9a\n\u305f\u3060\u306e\u81ea\u5206\u306e\u3061\u3087\u3093\u307c\u3067\u3059\u3002\n\u7279\u306bv6\u306f\u3001MTU\u306a\u30891280\u3067MSS Clamping\u3057\u306a\u3044\u3068\u901a\u3089\u306a\u3044\u3068\u3053\u308d\u306b\u3001\u7d50\u69cb\u3076\u3064\u304b\u308b\u6c17\u304c\u3059\u308b\u3002\n\u305d\u3053\u3067\u3001auto\u3067\u306a\u304f\u624b\u52d5\u8a2d\u5b9a\u3057\u3066\u3001\u306f\u307e\u308b\u3002\nMSS\u306f\u3001MTU\u304b\u3089IP\u3068TCP\u306e\u30d8\u30c3\u30c0\u5206\u6e1b\u3089\u3055\u306a\u3044\u3068\u3002v6\u306a\u3089\u30011280-40-20=1220\u3002\n\n# (\u304a\u307e\u3051)Chrome\u306e\u6319\u52d5\nQUIC v6 > TLS v6 > QUIC v4 > TLS v4 \u3068\u3044\u3046\u512a\u5148\u9806\u4f4d\u306e\u3088\u3046\u3060\u3002\nPMTU\u304c1280\u306a\u7d4c\u8def\u306f\u3082\u306f\u3084\u5c11\u6570\u6d3e\u3001\u3068\u3044\u3046\u3054\u5224\u65ad\u306a\u306e\u3060\u308d\u3046\u304b\u2026\u3002\nQUIC v4\u512a\u5148\u8a2d\u5b9a\u3068\u304b\u306a\u3044\u304b\u306a(\u8981\u8abf\u67fb)\u3002\n\n# \u5bbf\u984c\n## QUIC\u95a2\u9023\n- [Internet draft](https://tools.ietf.org/html/draft-tsvwg-quic-protocol-00)\u306b\u3088\u308b\u3068\u3001Path MTU discovery\u306fwork in progress\n- QUIC\u306e\u304a\u52c9\u5f37\u2026[\u3053\u3061\u3089](http://keens.github.io/blog/2017/01/02/quicnonakamigawakaranaikarashiyouyondemita/)\u304c\u53c2\u8003\u306b\u306a\u308a\u305d\u3046\n\n## MTU\u95a2\u9023\n- \u4e16\u754c\u306eMTU/MSS\u72b6\u6cc1\u3001\u7279\u306bv6\n- NIC\u3068\u30c9\u30e9\u30a4\u30d0\u30fc\u306eTSO\u5bfe\u5fdc\u72b6\u6cc1\n- ICMP\u3092\u53d7\u3051\u305f\u5f8c\u306eTCP\u306e\u6319\u52d5\n- PLPMTUD\u3068`tcp_mtu_probing`\u3068`tcp_base_mss`\u306e\u95a2\u4fc2\n"}