{"context": "\n\n1. \u69cb\u6210\nmaster\u3068node1\u306e2\u53f0\u69cb\u6210\u3002()\u5185\u306fTCP\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u8868\u3059\u3002\n\n(1) : Proxy\u306eNginx\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\n(2),(3):Nginx\u304c\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306ehttpd\u306bHTTP\u30a2\u30af\u30bb\u30b9\u3092\u632f\u308a\u5206\u3051\u308b\u3002\n\n  +--------- master ---------+    +----- node1 ----+\n  |                          |    |                |\n  | nginx(8888)    httpd(80) |    |    httpd(80)   |\n  |    A   |  |     A(2)     |    |       A(3)     |\n  |    |   |  |     |        |    |       |        |\n  |    |   |  +-----+        |    |       |        |\n  |    |   +-----+           |    |       |        |\n  |    |         |           |    |       |        |\n  |    +----+    | CentOS7.2 |    |   CentOS7.2    |\n  |         |    |           |    |       |        |\n  |         |    |           |    |       |        |\n  +---------- eth0 ----------+    +----- eth0 -----+\n         192.168.0.100               192.168.0.110\n            |    |                        |\n            |    +------------------------+\n            |\n           (1)\n\n\n\n2. \u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\n\nyum\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u8a2d\u5b9a\u3002\nCentOS7\u306bNginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5834\u5408\u306f\u4e0b\u8a18\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3002\n[root@master ~]# cat /etc/yum.repos.d/nginx.repo \n[nginx]\nname=nginx repo\nbaseurl=http://nginx.org/packages/centos/7/$basearch/\ngpgcheck=0\nenabled=1\n\nmaster\u306b\u306f\u3001Nginx\u3068httpd\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n[root@master ~]# yum -y install nginx\n[root@master ~]# yum -y install httpd\n\nnode1\u306b\u306fhttpd\u306e\u307f\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n[root@node1 ~]# yum -y install httpd\n\n\n3. Nginx\u306e\u8a2d\u5b9a\n\n3.1 Proxy\u30b5\u30fc\u30d0\u306e\u8a2d\u5b9a\nProxy\u30b5\u30fc\u30d0\u3068\u3057\u3066\u306e\u8a2d\u5b9a\u3092\u3059\u308b\u3002\nserver\u306b\u306f\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0(httpd)\u306eIP\u3068\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u8a2d\u5b9a\u3059\u308b\u3002weight\u306b\u306f\u30a2\u30af\u30bb\u30b9\u3059\u308b\u5272\u5408\u3092\u6307\u5b9a\u3059\u308b\u3002\n\u4e0b\u8a18\u8a2d\u5b9a\u306f1\u5bfe1\u306e\u5272\u5408\u3067\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u8a2d\u5b9a\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n[root@master ~]# cat /etc/nginx/conf.d/backend.conf\nupstream backend {\n    server 192.168.0.100:80 weight=1;\n    server 192.168.0.110:80 weight=1;\n}\n\nserver {\n    listen  8888;                       <= Nginx\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n    server_name  192.168.0.100;         <= Nginx\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n    location / {\n        proxy_pass http://backend;\n    }\n}\n\n\n\n3.2 \u30dd\u30fc\u30c8\u756a\u53f7\u306e\u5909\u66f4\n\u30dd\u30fc\u30c8\u756a\u53f780\u306ehttpd\u3092\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u3068\u3057\u3066\u8d77\u52d5\u3059\u308b\u3002\nhttpd\u3068nginx\u304c\u540c\u3058\u30dd\u30fc\u30c8\u756a\u53f780\u3092\u4f7f\u3046\u306e\u3092\u907f\u3051\u308b\u305f\u3081\u3001\nnginx\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u306e80\u304b\u30898888\u306b\u5909\u66f4\u3059\u308b\u3002\n\n[root@master ~]# cat /etc/nginx/nginx.conf\n\n    server {\n        listen       8888 default_server;\n        listen       [::]:8888 default_server;\n\n\n\n4. Nginx,httpd\u306e\u8d77\u52d5\nmaster\u3068node1\u3067httpd\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# systemctl start httpd\n[root@node1 ~]# systemctl start httpd[\n\nmaster\u3067Nginx\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# systemctl start nginx\n\n\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# lsof -i:8888\nCOMMAND  PID  USER   FD   TYPE DEVICE SIZE/OFF NODE NAME\nnginx   6588  root    6u  IPv4 184368      0t0  TCP *:ddi-tcp-1 (LISTEN)\nnginx   6588  root    7u  IPv6 184369      0t0  TCP *:ddi-tcp-1 (LISTEN)\n\u4ee5\u4e0b\u3001\u7565\n\n[root@master ~]# lsof -i:80\nCOMMAND  PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME\nhttpd   4543   root    4u  IPv6 122843      0t0  TCP *:http (LISTEN)\nhttpd   4569 apache    4u  IPv6 122843      0t0  TCP *:http (LISTEN)\n\u4ee5\u4e0b\u3001\u7565\n\n\n\n5. \u52d5\u4f5c\u78ba\u8a8d\nNginx\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n[root@master ~]# curl http://192.168.0.100:8888\n\n\nmaster\u3067httpd\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# tail -f /var/log/httpd/access_log\n192.168.0.100 - - [09/Nov/2016:15:23:41 +0900] \"GET / HTTP/1.0\" 403 4897 \"-\" \"curl/7.29.0\"\n192.168.0.100 - - [09/Nov/2016:15:23:53 +0900] \"GET / HTTP/1.0\" 403 4897 \"-\" \"curl/7.29.0\"\n\n\nnode1\u3067httpd\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@node1 ~]# tail -f /var/log/httpd/access_log\n192.168.0.100 - - [09/Nov/2016:15:06:04 +0900] \"GET / HTTP/1.0\" 403 4897 \"-\" \"curl/7.29.0\"\n192.168.0.100 - - [09/Nov/2016:15:23:52 +0900] \"GET / HTTP/1.0\" 403 4897 \"-\" \"curl/7.29.0\"\n\n\n\n6. \u53c2\u8003\u60c5\u5831\n[Nginx\u672c\u5bb6\u306e\u8a2d\u5b9a]http://nginx.org/en/linux_packages.html#stable\n#1. \u69cb\u6210\n\n```\nmaster\u3068node1\u306e2\u53f0\u69cb\u6210\u3002()\u5185\u306fTCP\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u8868\u3059\u3002\n\n(1) : Proxy\u306eNginx\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\n(2),(3):Nginx\u304c\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306ehttpd\u306bHTTP\u30a2\u30af\u30bb\u30b9\u3092\u632f\u308a\u5206\u3051\u308b\u3002\n\n  +--------- master ---------+    +----- node1 ----+\n  |                          |    |                |\n  | nginx(8888)    httpd(80) |    |    httpd(80)   |\n  |    A   |  |     A(2)     |    |       A(3)     |\n  |    |   |  |     |        |    |       |        |\n  |    |   |  +-----+        |    |       |        |\n  |    |   +-----+           |    |       |        |\n  |    |         |           |    |       |        |\n  |    +----+    | CentOS7.2 |    |   CentOS7.2    |\n  |         |    |           |    |       |        |\n  |         |    |           |    |       |        |\n  +---------- eth0 ----------+    +----- eth0 -----+\n         192.168.0.100               192.168.0.110\n            |    |                        |\n            |    +------------------------+\n            |\n           (1)\n\n```\n\n#2. \u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n\n\n\nyum\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u8a2d\u5b9a\u3002\nCentOS7\u306bNginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5834\u5408\u306f\u4e0b\u8a18\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3002\n[root@master ~]# cat /etc/yum.repos.d/nginx.repo \n[nginx]\nname=nginx repo\nbaseurl=http://nginx.org/packages/centos/7/$basearch/\ngpgcheck=0\nenabled=1\n\nmaster\u306b\u306f\u3001Nginx\u3068httpd\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n[root@master ~]# yum -y install nginx\n[root@master ~]# yum -y install httpd\n\nnode1\u306b\u306fhttpd\u306e\u307f\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n[root@node1 ~]# yum -y install httpd\n```\n\n#3. Nginx\u306e\u8a2d\u5b9a\n##3.1 Proxy\u30b5\u30fc\u30d0\u306e\u8a2d\u5b9a\n```\nProxy\u30b5\u30fc\u30d0\u3068\u3057\u3066\u306e\u8a2d\u5b9a\u3092\u3059\u308b\u3002\nserver\u306b\u306f\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0(httpd)\u306eIP\u3068\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u8a2d\u5b9a\u3059\u308b\u3002weight\u306b\u306f\u30a2\u30af\u30bb\u30b9\u3059\u308b\u5272\u5408\u3092\u6307\u5b9a\u3059\u308b\u3002\n\u4e0b\u8a18\u8a2d\u5b9a\u306f1\u5bfe1\u306e\u5272\u5408\u3067\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u8a2d\u5b9a\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n[root@master ~]# cat /etc/nginx/conf.d/backend.conf\nupstream backend {\n    server 192.168.0.100:80 weight=1;\n    server 192.168.0.110:80 weight=1;\n}\n\nserver {\n    listen  8888;                       <= Nginx\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n    server_name  192.168.0.100;         <= Nginx\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n    location / {\n        proxy_pass http://backend;\n    }\n}\n\n```\n##3.2 \u30dd\u30fc\u30c8\u756a\u53f7\u306e\u5909\u66f4\n\n```\n\u30dd\u30fc\u30c8\u756a\u53f780\u306ehttpd\u3092\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u3068\u3057\u3066\u8d77\u52d5\u3059\u308b\u3002\nhttpd\u3068nginx\u304c\u540c\u3058\u30dd\u30fc\u30c8\u756a\u53f780\u3092\u4f7f\u3046\u306e\u3092\u907f\u3051\u308b\u305f\u3081\u3001\nnginx\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u306e80\u304b\u30898888\u306b\u5909\u66f4\u3059\u308b\u3002\n\n[root@master ~]# cat /etc/nginx/nginx.conf\n\n    server {\n        listen       8888 default_server;\n        listen       [::]:8888 default_server;\n\n```\n\n#4. Nginx,httpd\u306e\u8d77\u52d5\n```\nmaster\u3068node1\u3067httpd\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# systemctl start httpd\n[root@node1 ~]# systemctl start httpd[\n\nmaster\u3067Nginx\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# systemctl start nginx\n\n\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# lsof -i:8888\nCOMMAND  PID  USER   FD   TYPE DEVICE SIZE/OFF NODE NAME\nnginx   6588  root    6u  IPv4 184368      0t0  TCP *:ddi-tcp-1 (LISTEN)\nnginx   6588  root    7u  IPv6 184369      0t0  TCP *:ddi-tcp-1 (LISTEN)\n\u4ee5\u4e0b\u3001\u7565\n\n[root@master ~]# lsof -i:80\nCOMMAND  PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME\nhttpd   4543   root    4u  IPv6 122843      0t0  TCP *:http (LISTEN)\nhttpd   4569 apache    4u  IPv6 122843      0t0  TCP *:http (LISTEN)\n\u4ee5\u4e0b\u3001\u7565\n\n```\n\n\n#5. \u52d5\u4f5c\u78ba\u8a8d\n\n```\nNginx\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n[root@master ~]# curl http://192.168.0.100:8888\n\n\nmaster\u3067httpd\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# tail -f /var/log/httpd/access_log\n192.168.0.100 - - [09/Nov/2016:15:23:41 +0900] \"GET / HTTP/1.0\" 403 4897 \"-\" \"curl/7.29.0\"\n192.168.0.100 - - [09/Nov/2016:15:23:53 +0900] \"GET / HTTP/1.0\" 403 4897 \"-\" \"curl/7.29.0\"\n\n\nnode1\u3067httpd\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@node1 ~]# tail -f /var/log/httpd/access_log\n192.168.0.100 - - [09/Nov/2016:15:06:04 +0900] \"GET / HTTP/1.0\" 403 4897 \"-\" \"curl/7.29.0\"\n192.168.0.100 - - [09/Nov/2016:15:23:52 +0900] \"GET / HTTP/1.0\" 403 4897 \"-\" \"curl/7.29.0\"\n\n```\n#6. \u53c2\u8003\u60c5\u5831\n[Nginx\u672c\u5bb6\u306e\u8a2d\u5b9a]http://nginx.org/en/linux_packages.html#stable\n", "tags": ["nginx", "proxy"]}