{"context": "\n\n\u69cb\u6210\n\n\nOS\u306fCentOS6.5\u3002GlusterFS\u306f\u30d0\u30fc\u30b8\u30e7\u30f33.7.12\u3092\u4f7f\u7528\u3002\n2\u53f0\u69cb\u6210\u306e\u5206\u6563\u30dc\u30ea\u30e5\u30fc\u30e0\u300cdistributed\u300d\u3067\u69cb\u7bc9\u3057\u30b5\u30fc\u30d0\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u517c\u306d\u308b\u3002\n\n\u8ffd\u52a0\u3057\u305f20GB\u306e\u30c7\u30a3\u30b9\u30af\u3092\u5206\u6563\u30dc\u30ea\u30e5\u30fc\u30e0\u306b\u4f7f\u7528\u3059\u308b\u3002\n(\u53c2\u8003) \u30c7\u30a3\u30b9\u30af\u3092\u8ffd\u52a0\u3057\u3066xfs\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3059\u308b\n\n\n1\u53f7\u6a5f\u306bGlusterFS\u30b5\u30fc\u30d0\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# wget http://download.gluster.org/pub/gluster/glusterfs/3.7/LATEST/CentOS/glusterfs-epel.repo -P /etc/yum.repos.d\n# yum install -y --enablerepo=glusterfs-epel glusterfs-server\n# service glusterd start\n# chkconfig glusterd on\n# vi /etc/hosts\n192.168.0.1  gfs01\n192.168.0.2  gfs02\niptables\u8a2d\u5b9a (\u4fbf\u5b9c\u4e0a\u3056\u3063\u304f\u308a)\n# vi /etc/sysconfig/iptables\n-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp -s 192.168.0.0/24  --dport 111 -j ACCEPT\n-A RH-Firewall-1-INPUT -m state --state NEW -m udp -p udp -s 192.168.0.0/24  --dport 111 -j ACCEPT\n-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp -s 192.168.0.0/24  --dport 2049:49199 -j ACCEPT\n# service iptables restart\n\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30c8\u8a2d\u5b9a\n# vi /etc/logrotate.d/glusterfs\n/var/log/glusterfs/*.log {\nsharedscripts\ndaily\nrotate 7\nmissingok\nnotifempty\ndateext\npostrotate\n/usr/bin/killall -HUP glusterfs > /dev/null 2>&1 || true\n/usr/bin/killall -HUP glusterd > /dev/null 2>&1 || true\nendscript\n}\n/var/log/glusterfs/bricks/*.log {\nsharedscripts\ndaily\nrotate 7\nmissingok\nnotifempty\ndateext\npostrotate\n/usr/bin/killall -HUP glusterfsd > /dev/null 2>&1 || true\nendscript\n}\n2\u53f7\u6a5f\u3082\u540c\u69d8\u306b\u8a2d\u5b9a\n\u30b9\u30c8\u30ec\u30fc\u30b8\u30d7\u30fc\u30eb\u306e\u4f5c\u6210 (1\u53f7\u6a5f)\n# gluster peer probe gfs02\n\u78ba\u8a8d (1\u53f7\u6a5f)\n# gluster peer status\nNumber of Peers: 1\nHostname: gfs02\nUuid: eedf2e27-93cd-4de2-b14c-cef7642c2cbd\nState: Peer in Cluster (Connected)\n\u78ba\u8a8d (2\u53f7\u6a5f)\n# gluster peer status\nNumber of Peers: 1\nHostname: gfs01\nUuid: 7bb7d79e-8dc0-479b-b6c8-ca335e7e082d\nState: Peer in Cluster (Connected)\n\u30dc\u30ea\u30e5\u30fc\u30e0\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210 (1\u53f7\u6a5f\u30012\u53f7\u6a5f)\n# mkdir -p /mnt/gfs_vol/distributed\n\u30dc\u30ea\u30e5\u30fc\u30e0\u4f5c\u6210 (1\u53f7\u6a5f)\n# gluster volume create vol_distributed gfs01:/mnt/gfs_vol/distributed gfs02:/mnt/gfs_vol/distributed\n# gluster volume start vol_distributed\n\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u78ba\u8a8d (1\u53f7\u6a5f\u30012\u53f7\u6a5f)\n# gluster volume info\nVolume Name: vol_distributed\nType: Distribute\nVolume ID: 1474a2e5-0cf3-4a52-9cd7-9a0a1b1e2ed4\nStatus: Started\nNumber of Bricks: 2\nTransport-type: tcp\nBricks:\nBrick1: gfs01:/mnt/gfs_vol/distributed\nBrick2: gfs02:/mnt/gfs_vol/distributed\nOptions Reconfigured:\nperformance.readdir-ahead: on\n# gluster volume info\nVolume Name: vol_distributed\nType: Distribute\nVolume ID: 1474a2e5-0cf3-4a52-9cd7-9a0a1b1e2ed4\nStatus: Started\nNumber of Bricks: 2\nTransport-type: tcp\nBricks:\nBrick1: gfs01:/mnt/gfs_vol/distributed\nBrick2: gfs02:/mnt/gfs_vol/distributed\nOptions Reconfigured:\nperformance.readdir-ahead: on\nGlusterFS\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3001\u8a2d\u5b9a (1\u53f7\u6a5f\u30012\u53f7\u6a5f)\nyum install -y --enablerepo=glusterfs-epel glusterfs glusterfs-fuse\n\u30de\u30a6\u30f3\u30c8\u30dd\u30a4\u30f3\u30c8\u4f5c\u6210 (1\u53f7\u6a5f\u30012\u53f7\u6a5f)\n# mkdir -p /mnt/glusterfs_vol\n\u4f5c\u6210\u3057\u305f\u5206\u6563\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u30de\u30a6\u30f3\u30c8 (1\u53f7\u6a5f\u30012\u53f7\u6a5f)\n# mount -t glusterfs gfs01:/vol_distributed /mnt/glusterfs_vol\n\u81ea\u52d5\u30de\u30a6\u30f3\u30c8\u8a2d\u5b9a (1\u53f7\u6a5f\u30012\u53f7\u6a5f)\n# vi /etc/fstab\ngfs01:/vol_distributed /mnt/glusterfs_vol glusterfs defaults,_netdev 0 0\n\u5206\u6563\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0(40GB)\u306e\u30de\u30a6\u30f3\u30c8\u78ba\u8a8d (1\u53f7\u6a5f\u30012\u53f7\u6a5f)\n# df -T\nFilesystem                      Type           1K-blocks    Used Available Use% Mounted on\n/dev/mapper/vg_nonmem01-lv_root ext4            20243012 5823008  13371428  31% /\ntmpfs                           tmpfs            1962856      72   1962784   1% /dev/shm\n/dev/sda1                       ext4              495844   88461    381783  19% /boot\n/dev/mapper/vg_nonmem01-lv_data ext4            19492656 1836472  16607608  10% /var\n/dev/sdc1                       xfs             20954552   33012  20921540   1% /mnt/gfs_vol\ngfs01:/vol_distributed          fuse.glusterfs  41908992   65920  41843072   1% /mnt/glusterfs_vol\n\n\u7d42\u308f\u308a\n###\u69cb\u6210\n![gfs_20160705.png](https://qiita-image-store.s3.amazonaws.com/0/131486/0a6173b7-af30-ec53-bd75-46183dde2704.png)\n***\nOS\u306fCentOS6.5\u3002GlusterFS\u306f\u30d0\u30fc\u30b8\u30e7\u30f33.7.12\u3092\u4f7f\u7528\u3002\n2\u53f0\u69cb\u6210\u306e\u5206\u6563\u30dc\u30ea\u30e5\u30fc\u30e0\u300cdistributed\u300d\u3067\u69cb\u7bc9\u3057\u30b5\u30fc\u30d0\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u517c\u306d\u308b\u3002\n***\n\u8ffd\u52a0\u3057\u305f20GB\u306e\u30c7\u30a3\u30b9\u30af\u3092\u5206\u6563\u30dc\u30ea\u30e5\u30fc\u30e0\u306b\u4f7f\u7528\u3059\u308b\u3002\n[(\u53c2\u8003) \u30c7\u30a3\u30b9\u30af\u3092\u8ffd\u52a0\u3057\u3066xfs\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3059\u308b](http://qiita.com/a-killer-bee/items/564d51034c125d192df3)\n***\n\n1. 1\u53f7\u6a5f\u306bGlusterFS\u30b5\u30fc\u30d0\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n`# wget http://download.gluster.org/pub/gluster/glusterfs/3.7/LATEST/CentOS/glusterfs-epel.repo -P /etc/yum.repos.d`\n`# yum install -y --enablerepo=glusterfs-epel glusterfs-server`\n`# service glusterd start`\n`# chkconfig glusterd on`\n`# vi /etc/hosts`\n`192.168.0.1  gfs01\n192.168.0.2  gfs02`\n\n2. iptables\u8a2d\u5b9a (\u4fbf\u5b9c\u4e0a\u3056\u3063\u304f\u308a)\n`# vi /etc/sysconfig/iptables`\n`-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp -s 192.168.0.0/24  --dport 111 -j ACCEPT\n-A RH-Firewall-1-INPUT -m state --state NEW -m udp -p udp -s 192.168.0.0/24  --dport 111 -j ACCEPT\n-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp -s 192.168.0.0/24  --dport 2049:49199 -j ACCEPT`\n`# service iptables restart`\n\n3. \u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30c8\u8a2d\u5b9a\n`# vi /etc/logrotate.d/glusterfs`\n`/var/log/glusterfs/*.log {\n  sharedscripts\n  daily\n  rotate 7\n  missingok\n  notifempty\n  dateext\n  postrotate\n  /usr/bin/killall -HUP glusterfs > /dev/null 2>&1 || true\n  /usr/bin/killall -HUP glusterd > /dev/null 2>&1 || true\n  endscript\n}\n/var/log/glusterfs/bricks/*.log {\n  sharedscripts\n  daily\n  rotate 7\n  missingok\n  notifempty\n  dateext\n  postrotate\n  /usr/bin/killall -HUP glusterfsd > /dev/null 2>&1 || true\n  endscript\n}`\n\n4. 2\u53f7\u6a5f\u3082\u540c\u69d8\u306b\u8a2d\u5b9a\n\n5. \u30b9\u30c8\u30ec\u30fc\u30b8\u30d7\u30fc\u30eb\u306e\u4f5c\u6210 (1\u53f7\u6a5f)\n`# gluster peer probe gfs02`\n\n6. \u78ba\u8a8d (1\u53f7\u6a5f)\n`# gluster peer status\nNumber of Peers: 1\nHostname: gfs02\nUuid: eedf2e27-93cd-4de2-b14c-cef7642c2cbd\nState: Peer in Cluster (Connected)`\n\n7. \u78ba\u8a8d (2\u53f7\u6a5f)\n`# gluster peer status\nNumber of Peers: 1\nHostname: gfs01\nUuid: 7bb7d79e-8dc0-479b-b6c8-ca335e7e082d\nState: Peer in Cluster (Connected)`\n\n8. \u30dc\u30ea\u30e5\u30fc\u30e0\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210 (1\u53f7\u6a5f\u30012\u53f7\u6a5f)\n`# mkdir -p /mnt/gfs_vol/distributed`\n\n9. \u30dc\u30ea\u30e5\u30fc\u30e0\u4f5c\u6210 (1\u53f7\u6a5f)\n`# gluster volume create vol_distributed gfs01:/mnt/gfs_vol/distributed gfs02:/mnt/gfs_vol/distributed`\n`# gluster volume start vol_distributed`\n\n10. \u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u78ba\u8a8d (1\u53f7\u6a5f\u30012\u53f7\u6a5f)\n`# gluster volume info\nVolume Name: vol_distributed\nType: Distribute\nVolume ID: 1474a2e5-0cf3-4a52-9cd7-9a0a1b1e2ed4\nStatus: Started\nNumber of Bricks: 2\nTransport-type: tcp\nBricks:\nBrick1: gfs01:/mnt/gfs_vol/distributed\nBrick2: gfs02:/mnt/gfs_vol/distributed\nOptions Reconfigured:\nperformance.readdir-ahead: on`\n`# gluster volume info\nVolume Name: vol_distributed\nType: Distribute\nVolume ID: 1474a2e5-0cf3-4a52-9cd7-9a0a1b1e2ed4\nStatus: Started\nNumber of Bricks: 2\nTransport-type: tcp\nBricks:\nBrick1: gfs01:/mnt/gfs_vol/distributed\nBrick2: gfs02:/mnt/gfs_vol/distributed\nOptions Reconfigured:\nperformance.readdir-ahead: on`\n\n11. GlusterFS\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3001\u8a2d\u5b9a (1\u53f7\u6a5f\u30012\u53f7\u6a5f)\n`yum install -y --enablerepo=glusterfs-epel glusterfs glusterfs-fuse`\n\n12. \u30de\u30a6\u30f3\u30c8\u30dd\u30a4\u30f3\u30c8\u4f5c\u6210 (1\u53f7\u6a5f\u30012\u53f7\u6a5f)\n`# mkdir -p /mnt/glusterfs_vol`\n\n13. \u4f5c\u6210\u3057\u305f\u5206\u6563\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u30de\u30a6\u30f3\u30c8 (1\u53f7\u6a5f\u30012\u53f7\u6a5f)\n`# mount -t glusterfs gfs01:/vol_distributed /mnt/glusterfs_vol`\n\n14. \u81ea\u52d5\u30de\u30a6\u30f3\u30c8\u8a2d\u5b9a (1\u53f7\u6a5f\u30012\u53f7\u6a5f)\n`# vi /etc/fstab\ngfs01:/vol_distributed /mnt/glusterfs_vol glusterfs defaults,_netdev 0 0`\n\n15. \u5206\u6563\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0(40GB)\u306e\u30de\u30a6\u30f3\u30c8\u78ba\u8a8d (1\u53f7\u6a5f\u30012\u53f7\u6a5f)\n`# df -T\nFilesystem                      Type           1K-blocks    Used Available Use% Mounted on\n/dev/mapper/vg_nonmem01-lv_root ext4            20243012 5823008  13371428  31% /\ntmpfs                           tmpfs            1962856      72   1962784   1% /dev/shm\n/dev/sda1                       ext4              495844   88461    381783  19% /boot\n/dev/mapper/vg_nonmem01-lv_data ext4            19492656 1836472  16607608  10% /var\n/dev/sdc1                       xfs             20954552   33012  20921540   1% /mnt/gfs_vol\ngfs01:/vol_distributed          fuse.glusterfs  41908992   65920  41843072   1% /mnt/glusterfs_vol`\n\n\u7d42\u308f\u308a\n", "tags": ["CentOS6.5", "GlusterFS", "iptables", "xfs"]}