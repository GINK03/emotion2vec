{"context": "Android\u30a2\u30d7\u30ea\u3092\u4f5c\u3063\u3066\u3044\u308c\u3070\u57fa\u5e95\u306eView\u3092\u62e1\u5f35\u3057\u305f\u72ec\u81ea\u306eView\u30af\u30e9\u30b9\u3092\u4f5c\u308b\u3053\u3068\u304c\u591a\u3005\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u3044\u3056\u30bc\u30ed\u304b\u3089\u66f8\u304f\u3068\u306a\u308b\u3068\u8272\u3005\u3068\u53d6\u308a\u3053\u307c\u3057\u304c\u3042\u308a\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u307e\u3068\u3081\u307e\u3057\u305f\n\nCircleView\n\u4eca\u56de\u306f\u4ee5\u4e0b\u306e\u69d8\u306a2\u91cd\u306e\u5186\u5f27\u3092\u63cf\u753b\u3059\u308bView\u3092\u4f5c\u6210\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\nView#onDraw\u3067\u63cf\u753b\u3057\u3066\u3044\u304d\u307e\u3059\u304c\u3001View\u306e\u5916\u5074\u304b\u3089\u306f\u30b7\u30f3\u30d7\u30eb\u306b\u4f7f\u3048\u308b\u3053\u3068\u3092\u610f\u8b58\u3057\u3066\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u8a2d\u5b9a\u3067\u304d\u308b\u72ec\u81ea\u30d7\u30ed\u30d1\u30c6\u30a3\u3068\u3057\u3066\u4ee5\u4e0b\u3092\u5ba3\u8a00\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n\u4e0a\u306e\u5186\u5f27\u306e\u958b\u59cb\u89d2\u5ea6\uff08StartAngle\uff09\n\u4e0a\u306e\u5186\u5f27\u306e\u63cf\u753b\u89d2\u5ea6\uff08DrawAngle\uff09\n\u4e0a\u306e\u5186\u5f27\u306e\u8272\uff08PrimaryLineColor\uff09\n\u4e0b\u306e\u5186\u5f27\u306e\u8272\uff08SecondaryLineColor\uff09\n\u7dda\u306e\u592a\u3055\uff08StrokeWidth\uff09\n\n\n1. \u72ec\u81eaView\u30af\u30e9\u30b9\u4f5c\u6210\n\u307e\u305a\u306fView\u30af\u30e9\u30b9\u3092extend\u3057\u305f\u7a7a\u306eCircleView\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\nCircleView.java\npublic class CircleView extends View {\n\n    public CircleView(Context context) {\n        this(context, null);\n    }\n\n    public CircleView(Context context, AttributeSet attrs) {\n        this(context, attrs, 0);\n    }\n\n    public CircleView(Context context, AttributeSet attrs, int defStyleAttr) {\n        super(context, attrs, defStyleAttr);\n    }\n}\n\n\n\n2. XML\u3067\u306e\u72ec\u81ea\u30d7\u30ed\u30d1\u30c6\u30a3\u5b9f\u88c5\n\u6b21\u306bLayout\u306eXML\u3067\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306battrs.xml\u3092\u4f5c\u6210\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u305d\u308c\u305e\u308c\u30d7\u30ed\u30d1\u30c6\u30a3\u540d\u3068\u578b\u5ba3\u8a00\u3092\u884c\u3044\u307e\u3059\u3002\n\nattrs.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<resources>\n    <declare-styleable name=\"CircleView\">\n        <attr name=\"start_angle\" format=\"float|reference\"/>\n        <attr name=\"draw_angle\" format=\"float|reference\"/>\n        <attr name=\"primary_line_color\" format=\"color|reference\"/>\n        <attr name=\"secondary_line_color\" format=\"color|reference\"/>\n        <attr name=\"stroke_width\" format=\"dimension|reference\"/>\n    </declare-styleable>\n</resources>\n\n\n\u3053\u308c\u3067CircleView\u30af\u30e9\u30b9\u3092Layout\u30d5\u30a1\u30a4\u30eb\u4e0a\u306b\u914d\u7f6e\u3057\u305f\u969b\u306bXML\u4e0a\u3067\u72ec\u81ea\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u6307\u5b9a\u3067\u304d\u307e\u3059\n\u203bcom.kazakago.test.CircleView\u306f\u5404\u81ea\u306e\u914d\u7f6e\u3057\u305f\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30d5\u30eb\u30d1\u30b9\u306b\u7f6e\u304d\u63db\u3048\u3066\u8a18\u8f09\u3057\u3066\u4e0b\u3055\u3044\n\nactivity_main.xml\n<FrameLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n             xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n             android:layout_width=\"match_parent\"\n             android:layout_height=\"match_parent\">\n\n    <com.kazakago.test.CircleView\n        android:id=\"@+id/view_circle\"\n        android:layout_width=\"300dp\"\n        android:layout_height=\"300dp\"\n        android:layout_gravity=\"center\"\n        app:draw_angle=\"300\"\n        app:primary_line_color=\"#ff00ddff\"\n        app:secondary_line_color=\"#f0f0f0\"\n        app:start_angle=\"-90\"\n        app:stroke_width=\"10dp\"/>\n\n</FrameLayout>\n\n\napp\u540d\u524d\u7a7a\u9593\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u304c\u72ec\u81ea\u306b\u8ffd\u52a0\u3057\u305f\u3082\u306e\u306b\u306a\u308a\u307e\u3059\u3002\n\u30eb\u30fc\u30c8\u30ec\u30a4\u30a2\u30a6\u30c8\u306e\u8981\u7d20\u306bxmlns:app=\"http://schemas.android.com/apk/res-auto\"\u3092\u8ffd\u52a0\u3059\u308b\u306e\u3082\u5fd8\u308c\u305a\u306b\uff01\n\n3. XML\u304b\u3089\u5024\u3092\u53d6\u5f97\u3059\u308b\n\u4e0a\u8a18\u3067\u5ba3\u8a00\u3057\u305fXML\u8981\u7d20\u3092\u72ec\u81eaView\u30af\u30e9\u30b9\u306eJava\u30bd\u30fc\u30b9\u304b\u3089\u53d6\u5f97\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306fonDraw\u3067\u63cf\u753b\u3092\u884c\u3046\u305f\u3081\u305d\u306e\u90e8\u5206\u3067\u5fc5\u8981\u306aPaint\u5909\u6570\u7b49\u3082\u3053\u3053\u3067\u5ba3\u8a00\u3057\u3066\u3044\u307e\u3059\u3002\nXML\u3067\u5ba3\u8a00\u3057\u305f\u5404\u30d7\u30ed\u30d1\u30c6\u30a3\u306fJava\u30bd\u30fc\u30b9\u304b\u3089\u30bb\u30c3\u30c8\u3001\u53d6\u5f97\u3059\u308b\u3053\u3068\u3082\u60f3\u5b9a\u3057\u3066getter\u3001setter\u3092\u5fc5\u305a\u7528\u610f\u3057\u307e\u3059\u3002\n\nCircleView.java\npublic class CircleView extends View {\n\n    private float mStartAngle;\n    private float mDrawAngle;\n    private final Paint mFirstPaint = new Paint();\n    private final Paint mSecondPaint = new Paint();\n    private final RectF mOval = new RectF();\n\n    public CircleView(Context context) {\n        this(context, null);\n    }\n\n    public CircleView(Context context, AttributeSet attrs) {\n        this(context, attrs, 0);\n    }\n\n    public CircleView(Context context, AttributeSet attrs, int defStyleAttr) {\n        super(context, attrs, defStyleAttr);\n        initView(context, attrs, defStyleAttr);\n    }\n\n    private void initView(Context context, AttributeSet attrs, int defStyle) {\n        mFirstPaint.setAntiAlias(true);\n        mFirstPaint.setStyle(Paint.Style.STROKE);\n\n        mSecondPaint.setAntiAlias(true);\n        mSecondPaint.setStyle(Paint.Style.STROKE);\n\n        TypedArray typedArray = context.obtainStyledAttributes(attrs, R.styleable.CircleView, defStyle, 0);\n        setStartAngle(typedArray.getFloat(R.styleable.CircleView_start_angle, -90.0f));\n        setDrawAngle(typedArray.getFloat(R.styleable.CircleView_draw_angle, 270.0f));\n        setPrimaryLineColor(typedArray.getColor(R.styleable.CircleView_primary_line_color, Color.BLACK));\n        setSecondaryLineColor(typedArray.getColor(R.styleable.CircleView_secondary_line_color, Color.LTGRAY));\n        setStrokeWidth(typedArray.getDimension(R.styleable.CircleView_stroke_width,\n                TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, 10.0f, getResources().getDisplayMetrics())));\n        typedArray.recycle();\n    }\n}\n\n\nTypedArray\u3092Class\u540d\u3092\u6307\u5b9a\u3057\u3066\u53d6\u5f97\u3057\u3001\u5ba3\u8a00\u3057\u305fattrs.xml\u306e\u5185\u5bb9\u3092\u4e00\u3064\u4e00\u3064\u53d6\u308a\u51fa\u3057\u3066\u3044\u307e\u3059\u3002\n\u30ec\u30a4\u30a2\u30a6\u30c8\u5074\u3067\u30d7\u30ed\u30d1\u30c6\u30a3\u304c\u5ba3\u8a00\u304c\u3055\u308c\u3066\u3044\u306a\u3044\u6642\u7528\u306b\u5fc5\u305aTypedArray#get***\u306e\u7b2c2\u5f15\u6570\u3067\u521d\u671f\u5024\u3092\u5ba3\u8a00\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\ngetter\u3001setter\u306b\u3064\u3044\u3066\u306f\u4eca\u56de\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a18\u8f09\u3057\u307e\u3057\u305f\u3002\u203b\u9577\u304f\u306a\u308b\u306e\u3067\u884c\u3092\u8a70\u3081\u3066\u307e\u3059\n\nCircleView.java\n    public float getStartAngle() { return mStartAngle; }\n    public void setStartAngle(float startAngle) { mStartAngle = startAngle; }\n    public float getDrawAngle() { return mDrawAngle; }\n    public void setDrawAngle(float drawAngle) { mDrawAngle = drawAngle; }\n    public int getPrimaryLineColor() { return mFirstPaint.getColor(); }\n    public void setPrimaryLineColor(int color) { mFirstPaint.setColor(color); }\n    public int getSecondaryLineColor() { return mSecondPaint.getColor(); }\n    public void setSecondaryLineColor(int color) { mSecondPaint.setColor(color); }\n    public float getStrokeWidth() { return mFirstPaint.getStrokeWidth(); }\n    public void setStrokeWidth(float width) { mFirstPaint.setStrokeWidth(width); mSecondPaint.setStrokeWidth(width); }\n\n\n\u3061\u306a\u307f\u306b\u521d\u671f\u63cf\u753b\u5f8c\u306bmStartAngle\u7b49\u306b\u30bb\u30c3\u30c8\u3057\u305f\u5024\u3092\u5b9f\u969b\u306eUI\u306b\u53cd\u6620\u3055\u305b\u308b\u305f\u3081\u306b\u306fView#invalidate()\u3092\u30b3\u30fc\u30eb\u3057\u3066\u63cf\u753b\u66f4\u65b0\u3092\u4fc3\u3059\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u5834\u5408\u306b\u3088\u3063\u3066\u306fsetStartAngle\u30e1\u30bd\u30c3\u30c9\u5185\u3067\u6700\u5f8c\u306b\u547c\u3073\u51fa\u3057\u3066\u3057\u307e\u3063\u3066\u3082\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n4.\u5b9f\u969b\u306e\u63cf\u753b\u51e6\u7406\n\u4fdd\u6301\u3055\u308c\u305f\u5909\u6570\u306b\u5f93\u3063\u3066\u63cf\u753b\u3092\u884c\u3044\u307e\u3059\u3002\n\u4eca\u56de\u306fView#onDraw\u3092\u4f7f\u3063\u3066\u72ec\u81ea\u306b\u63cf\u753b\u3057\u3066\u3044\u307e\u3059\u304c\u3001\n\u5834\u5408\u306b\u3088\u3063\u3066\u306fonDraw\u3092\u4f7f\u308f\u306a\u3044\u3053\u3068\u3082\u3042\u308b\u3068\u601d\u3046\u306e\u3067\u72b6\u6cc1\u306b\u5fdc\u3058\u3066\u8aad\u307f\u66ff\u3048\u3066\u4e0b\u3055\u3044\u3002\n\nCircleView.java\n    @Override\n    protected void onDraw(Canvas canvas) {\n        mOval.set(getStrokeWidth(),\n                getStrokeWidth(),\n                canvas.getWidth() - getStrokeWidth(),\n                canvas.getHeight() - getStrokeWidth());\n        canvas.drawArc(mOval, mStartAngle, 360, false, mSecondPaint);\n        canvas.drawArc(mOval, mStartAngle, mDrawAngle, false, mFirstPaint);\n    }\n\n\n\u4eca\u56de\u306f\u3053\u308c\u3060\u3051\u3067\u3059\u306d\u3002\u30b7\u30f3\u30d7\u30eb\uff01\n\n5. \u753b\u9762\u56de\u8ee2\u7b49\u306eActivity\u518d\u8d77\u52d5\u5bfe\u5fdc\n\u5fd8\u308c\u3061\u3083\u3044\u3051\u306a\u3044\u306e\u304c\u753b\u9762\u56de\u8ee2\u5bfe\u5fdc\u3001\u6b63\u78ba\u306b\u306fActivity\u306e\u518d\u8d77\u52d5\u5bfe\u5fdc\u3067\u3059\u3002\n\u3053\u308c\u304c\u306a\u3044\u3068\u753b\u9762\u56de\u8ee2\u3055\u305b\u305f\u6642\u306a\u3069\u306b\u8a2d\u5b9a\u3057\u305f\u30e1\u30f3\u30d0\u30fc\u5909\u6570\u304c\u5168\u3066\u521d\u671f\u5316\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\u57fa\u672c\u7684\u306bActivity\u304c\u4fdd\u6301\u3057\u3066\u3044\u308b\u30e1\u30f3\u30d0\u5909\u6570\u306fActivity\u5074\u3067Bundle\u306b\u6301\u305f\u305b\u308b\u306a\u3069\u306e\u5bfe\u7b56\u304c\u5fc5\u8981\u3067\u3059\u304c\u3001\u72ec\u81eaView\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u306fView\u5074\u3067\u5bfe\u5fdc\u3055\u305b\u305f\u3044\u3067\u3059\u306d\u3002\n\u305d\u306e\u305f\u3081\u306b\u306fView#onSaveInstanceState\u3068View#onRestoreInstanceState\u3092\u4f7f\u3044\u307e\u3059\u3002\n\nCircleView.java\n    @Override\n    protected Parcelable onSaveInstanceState() {\n        Parcelable parent = super.onSaveInstanceState();\n        SavedState saved = new SavedState(parent);\n        saved.startAngle = getStartAngle();\n        saved.drawAngle = getDrawAngle();\n        saved.primaryLineColor = getPrimaryLineColor();\n        saved.secondaryLineColor = getSecondaryLineColor();\n        saved.strokeWidth = getStrokeWidth();\n        return saved;\n    }\n\n    @Override\n    protected void onRestoreInstanceState(Parcelable state) {\n        SavedState saved = (SavedState) state;\n        super.onRestoreInstanceState(saved.getSuperState());\n        setStartAngle(saved.startAngle);\n        setDrawAngle(saved.drawAngle);\n        setPrimaryLineColor(saved.primaryLineColor);\n        setSecondaryLineColor(saved.secondaryLineColor);\n        setStrokeWidth(saved.strokeWidth);\n    }\n\n    private static class SavedState extends BaseSavedState {\n        public float startAngle;\n        public float drawAngle;\n        public int primaryLineColor;\n        public int secondaryLineColor;\n        public float strokeWidth;\n\n        public SavedState(Parcel in) {\n            super(in);\n            startAngle = in.readFloat();\n            drawAngle = in.readFloat();\n            primaryLineColor = in.readInt();\n            secondaryLineColor = in.readInt();\n            strokeWidth = in.readFloat();\n        }\n\n        public SavedState(Parcelable superState) {\n            super(superState);\n        }\n\n        @Override\n        public void writeToParcel(final Parcel out, final int flags) {\n            super.writeToParcel(out, flags);\n            out.writeFloat(startAngle);\n            out.writeFloat(drawAngle);\n            out.writeInt(primaryLineColor);\n            out.writeInt(secondaryLineColor);\n            out.writeFloat(strokeWidth);\n        }\n\n        public static final Parcelable.Creator<SavedState> CREATOR = new Parcelable.Creator<SavedState>() {\n            public SavedState createFromParcel(Parcel in) {\n                return new SavedState(in);\n            }\n\n            public SavedState[] newArray(int size) {\n                return new SavedState[size];\n            }\n        };\n\n    }\n\n\n\u683c\u7d0d\u7528\u306bBaseSavedState\u3092extend\u3057\u305f\u30af\u30e9\u30b9\u3092\u5ba3\u8a00\u3057\u307e\u3059\u3002\nParcelable\u306b\u5bfe\u5fdc\u3055\u305b\u308b\u305f\u3081CREATER\u3082\u8a18\u8ff0\u3057\u3066\u4e0b\u3055\u3044\u3002\nView#onSaveInstanceState\u5185\u3067SavedState\u3078\u30e1\u30f3\u30d0\u30fc\u5909\u6570\u3092\u4e00\u6642\u9000\u53bb\u3055\u305b\u3001\nView#onRestoreInstanceState\u3067\u53d6\u308a\u51fa\u3057\u3066\u30e1\u30f3\u30d0\u30fc\u5909\u6570\u3092\u5fa9\u5143\u3055\u305b\u308b\u6d41\u308c\u306b\u306a\u308a\u307e\u3059\u3002\n\u203b\u7d30\u304b\u3044Parcelable\u306e\u5b9f\u88c5\u65b9\u6cd5\u306f\u516c\u5f0f\u304b\u2193\u8fba\u308a\u304c\u308f\u304b\u308a\u3084\u3059\u3044\u3067\u3059\uff08\u4e38\u6295\u3052\uff09\nhttp://y-anz-m.blogspot.jp/2010/03/androidparcelable.html\n\u7e26\u753b\u9762\u56fa\u5b9a\u306b\u3057\u3066\u3044\u308b\u3068\u753b\u9762\u56de\u8ee2\u3057\u306a\u3044\u305f\u3081Activity\u518d\u8d77\u52d5\u304c\u8d77\u304d\u306b\u304f\u304f\u5fd8\u308c\u304c\u3061\u3067\u3059\u304c\u3001\n\u30d5\u30a9\u30f3\u30c8\u5909\u66f4\u6642\u3084\u30e1\u30e2\u30ea\u4e0d\u8db3\u6642\u306a\u3069\u69d8\u3005\u306a\u72b6\u6cc1\u3067\u767a\u751f\u3057\u307e\u3059\u3002\n\u500b\u4eba\u7684\u306b\u306f\u3001\u3044\u304b\u306a\u308b\u5834\u5408\u3067\u3082\u5bfe\u5fdc\u306f\u7d76\u5bfe\u6761\u4ef6\u3060\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u304a\u308f\u308a\n\u4e0a\u8a18\u307e\u3067\u8a18\u8f09\u3059\u308c\u3070XML\u304b\u3089\u3082Java\u304b\u3089\u3082\u5168\u3066\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u3001\nActivity\u306e\u518d\u8d77\u52d5\u306b\u3082\u5bfe\u5fdc\u3057\u305f\u72ec\u81eaView\u30af\u30e9\u30b9\u306e\u5b8c\u6210\u3067\u3059\u3002\n\u30b3\u30fc\u30c9\u306e\u5168\u6587\u306f\u4ee5\u4e0b\u306eGist\u306b\u304a\u3044\u3066\u304a\u304d\u307e\u3059\u3002\nhttps://gist.github.com/KazaKago/81123f712ab36bfa77cf\nAndroid\u30a2\u30d7\u30ea\u3092\u4f5c\u3063\u3066\u3044\u308c\u3070\u57fa\u5e95\u306eView\u3092\u62e1\u5f35\u3057\u305f\u72ec\u81ea\u306eView\u30af\u30e9\u30b9\u3092\u4f5c\u308b\u3053\u3068\u304c\u591a\u3005\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u3044\u3056\u30bc\u30ed\u304b\u3089\u66f8\u304f\u3068\u306a\u308b\u3068\u8272\u3005\u3068\u53d6\u308a\u3053\u307c\u3057\u304c\u3042\u308a\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u307e\u3068\u3081\u307e\u3057\u305f\n\n##CircleView\n\u4eca\u56de\u306f\u4ee5\u4e0b\u306e\u69d8\u306a2\u91cd\u306e\u5186\u5f27\u3092\u63cf\u753b\u3059\u308bView\u3092\u4f5c\u6210\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n![639483c5-710f-f296-0131-74232138a46f.png](https://qiita-image-store.s3.amazonaws.com/0/129872/9472f5fe-d1ce-c27d-3d48-f90bbff21f96.png)\n\n`View#onDraw`\u3067\u63cf\u753b\u3057\u3066\u3044\u304d\u307e\u3059\u304c\u3001View\u306e\u5916\u5074\u304b\u3089\u306f\u30b7\u30f3\u30d7\u30eb\u306b\u4f7f\u3048\u308b\u3053\u3068\u3092\u610f\u8b58\u3057\u3066\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u8a2d\u5b9a\u3067\u304d\u308b\u72ec\u81ea\u30d7\u30ed\u30d1\u30c6\u30a3\u3068\u3057\u3066\u4ee5\u4e0b\u3092\u5ba3\u8a00\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n- \u4e0a\u306e\u5186\u5f27\u306e\u958b\u59cb\u89d2\u5ea6\uff08StartAngle\uff09\n- \u4e0a\u306e\u5186\u5f27\u306e\u63cf\u753b\u89d2\u5ea6\uff08DrawAngle\uff09\n- \u4e0a\u306e\u5186\u5f27\u306e\u8272\uff08PrimaryLineColor\uff09\n- \u4e0b\u306e\u5186\u5f27\u306e\u8272\uff08SecondaryLineColor\uff09\n- \u7dda\u306e\u592a\u3055\uff08StrokeWidth\uff09\n\n##1. \u72ec\u81eaView\u30af\u30e9\u30b9\u4f5c\u6210\n\u307e\u305a\u306fView\u30af\u30e9\u30b9\u3092extend\u3057\u305f\u7a7a\u306e`CircleView`\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n```java:CircleView.java\npublic class CircleView extends View {\n\n    public CircleView(Context context) {\n        this(context, null);\n    }\n\n    public CircleView(Context context, AttributeSet attrs) {\n        this(context, attrs, 0);\n    }\n\n    public CircleView(Context context, AttributeSet attrs, int defStyleAttr) {\n        super(context, attrs, defStyleAttr);\n    }\n}\n```\n\n##2. XML\u3067\u306e\u72ec\u81ea\u30d7\u30ed\u30d1\u30c6\u30a3\u5b9f\u88c5\n\n\u6b21\u306bLayout\u306eXML\u3067\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b`attrs.xml`\u3092\u4f5c\u6210\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u305d\u308c\u305e\u308c\u30d7\u30ed\u30d1\u30c6\u30a3\u540d\u3068\u578b\u5ba3\u8a00\u3092\u884c\u3044\u307e\u3059\u3002\n\n\n```xml:attrs.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<resources>\n    <declare-styleable name=\"CircleView\">\n        <attr name=\"start_angle\" format=\"float|reference\"/>\n        <attr name=\"draw_angle\" format=\"float|reference\"/>\n        <attr name=\"primary_line_color\" format=\"color|reference\"/>\n        <attr name=\"secondary_line_color\" format=\"color|reference\"/>\n        <attr name=\"stroke_width\" format=\"dimension|reference\"/>\n    </declare-styleable>\n</resources>\n```\n\n\u3053\u308c\u3067`CircleView`\u30af\u30e9\u30b9\u3092Layout\u30d5\u30a1\u30a4\u30eb\u4e0a\u306b\u914d\u7f6e\u3057\u305f\u969b\u306bXML\u4e0a\u3067\u72ec\u81ea\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u6307\u5b9a\u3067\u304d\u307e\u3059\n\u203b`com.kazakago.test.CircleView`\u306f\u5404\u81ea\u306e\u914d\u7f6e\u3057\u305f\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30d5\u30eb\u30d1\u30b9\u306b\u7f6e\u304d\u63db\u3048\u3066\u8a18\u8f09\u3057\u3066\u4e0b\u3055\u3044\n\n```xml:activity_main.xml\n<FrameLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n             xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n             android:layout_width=\"match_parent\"\n             android:layout_height=\"match_parent\">\n\n    <com.kazakago.test.CircleView\n        android:id=\"@+id/view_circle\"\n        android:layout_width=\"300dp\"\n        android:layout_height=\"300dp\"\n        android:layout_gravity=\"center\"\n        app:draw_angle=\"300\"\n        app:primary_line_color=\"#ff00ddff\"\n        app:secondary_line_color=\"#f0f0f0\"\n        app:start_angle=\"-90\"\n        app:stroke_width=\"10dp\"/>\n\n</FrameLayout>\n```\n\n`app`\u540d\u524d\u7a7a\u9593\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u304c\u72ec\u81ea\u306b\u8ffd\u52a0\u3057\u305f\u3082\u306e\u306b\u306a\u308a\u307e\u3059\u3002\n\u30eb\u30fc\u30c8\u30ec\u30a4\u30a2\u30a6\u30c8\u306e\u8981\u7d20\u306b`xmlns:app=\"http://schemas.android.com/apk/res-auto\"`\u3092\u8ffd\u52a0\u3059\u308b\u306e\u3082\u5fd8\u308c\u305a\u306b\uff01\n\n##3. XML\u304b\u3089\u5024\u3092\u53d6\u5f97\u3059\u308b\n\u4e0a\u8a18\u3067\u5ba3\u8a00\u3057\u305fXML\u8981\u7d20\u3092\u72ec\u81eaView\u30af\u30e9\u30b9\u306eJava\u30bd\u30fc\u30b9\u304b\u3089\u53d6\u5f97\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306fonDraw\u3067\u63cf\u753b\u3092\u884c\u3046\u305f\u3081\u305d\u306e\u90e8\u5206\u3067\u5fc5\u8981\u306aPaint\u5909\u6570\u7b49\u3082\u3053\u3053\u3067\u5ba3\u8a00\u3057\u3066\u3044\u307e\u3059\u3002\nXML\u3067\u5ba3\u8a00\u3057\u305f\u5404\u30d7\u30ed\u30d1\u30c6\u30a3\u306fJava\u30bd\u30fc\u30b9\u304b\u3089\u30bb\u30c3\u30c8\u3001\u53d6\u5f97\u3059\u308b\u3053\u3068\u3082\u60f3\u5b9a\u3057\u3066getter\u3001setter\u3092\u5fc5\u305a\u7528\u610f\u3057\u307e\u3059\u3002\n\n```java:CircleView.java\npublic class CircleView extends View {\n\n    private float mStartAngle;\n    private float mDrawAngle;\n    private final Paint mFirstPaint = new Paint();\n    private final Paint mSecondPaint = new Paint();\n    private final RectF mOval = new RectF();\n\n    public CircleView(Context context) {\n        this(context, null);\n    }\n\n    public CircleView(Context context, AttributeSet attrs) {\n        this(context, attrs, 0);\n    }\n\n    public CircleView(Context context, AttributeSet attrs, int defStyleAttr) {\n        super(context, attrs, defStyleAttr);\n        initView(context, attrs, defStyleAttr);\n    }\n\n    private void initView(Context context, AttributeSet attrs, int defStyle) {\n        mFirstPaint.setAntiAlias(true);\n        mFirstPaint.setStyle(Paint.Style.STROKE);\n\n        mSecondPaint.setAntiAlias(true);\n        mSecondPaint.setStyle(Paint.Style.STROKE);\n\n        TypedArray typedArray = context.obtainStyledAttributes(attrs, R.styleable.CircleView, defStyle, 0);\n        setStartAngle(typedArray.getFloat(R.styleable.CircleView_start_angle, -90.0f));\n        setDrawAngle(typedArray.getFloat(R.styleable.CircleView_draw_angle, 270.0f));\n        setPrimaryLineColor(typedArray.getColor(R.styleable.CircleView_primary_line_color, Color.BLACK));\n        setSecondaryLineColor(typedArray.getColor(R.styleable.CircleView_secondary_line_color, Color.LTGRAY));\n        setStrokeWidth(typedArray.getDimension(R.styleable.CircleView_stroke_width,\n                TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, 10.0f, getResources().getDisplayMetrics())));\n        typedArray.recycle();\n    }\n}\n```\n\nTypedArray\u3092Class\u540d\u3092\u6307\u5b9a\u3057\u3066\u53d6\u5f97\u3057\u3001\u5ba3\u8a00\u3057\u305f`attrs.xml`\u306e\u5185\u5bb9\u3092\u4e00\u3064\u4e00\u3064\u53d6\u308a\u51fa\u3057\u3066\u3044\u307e\u3059\u3002\n\u30ec\u30a4\u30a2\u30a6\u30c8\u5074\u3067\u30d7\u30ed\u30d1\u30c6\u30a3\u304c\u5ba3\u8a00\u304c\u3055\u308c\u3066\u3044\u306a\u3044\u6642\u7528\u306b\u5fc5\u305a`TypedArray#get***`\u306e\u7b2c2\u5f15\u6570\u3067\u521d\u671f\u5024\u3092\u5ba3\u8a00\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\ngetter\u3001setter\u306b\u3064\u3044\u3066\u306f\u4eca\u56de\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a18\u8f09\u3057\u307e\u3057\u305f\u3002\u203b\u9577\u304f\u306a\u308b\u306e\u3067\u884c\u3092\u8a70\u3081\u3066\u307e\u3059\n\n```java:CircleView.java\n    public float getStartAngle() { return mStartAngle; }\n    public void setStartAngle(float startAngle) { mStartAngle = startAngle; }\n    public float getDrawAngle() { return mDrawAngle; }\n    public void setDrawAngle(float drawAngle) { mDrawAngle = drawAngle; }\n    public int getPrimaryLineColor() { return mFirstPaint.getColor(); }\n    public void setPrimaryLineColor(int color) { mFirstPaint.setColor(color); }\n    public int getSecondaryLineColor() { return mSecondPaint.getColor(); }\n    public void setSecondaryLineColor(int color) { mSecondPaint.setColor(color); }\n    public float getStrokeWidth() { return mFirstPaint.getStrokeWidth(); }\n    public void setStrokeWidth(float width) { mFirstPaint.setStrokeWidth(width); mSecondPaint.setStrokeWidth(width); }\n```\n\n\u3061\u306a\u307f\u306b\u521d\u671f\u63cf\u753b\u5f8c\u306b`mStartAngle`\u7b49\u306b\u30bb\u30c3\u30c8\u3057\u305f\u5024\u3092\u5b9f\u969b\u306eUI\u306b\u53cd\u6620\u3055\u305b\u308b\u305f\u3081\u306b\u306f`View#invalidate()`\u3092\u30b3\u30fc\u30eb\u3057\u3066\u63cf\u753b\u66f4\u65b0\u3092\u4fc3\u3059\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u5834\u5408\u306b\u3088\u3063\u3066\u306f`setStartAngle`\u30e1\u30bd\u30c3\u30c9\u5185\u3067\u6700\u5f8c\u306b\u547c\u3073\u51fa\u3057\u3066\u3057\u307e\u3063\u3066\u3082\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n##4.\u5b9f\u969b\u306e\u63cf\u753b\u51e6\u7406\n\u4fdd\u6301\u3055\u308c\u305f\u5909\u6570\u306b\u5f93\u3063\u3066\u63cf\u753b\u3092\u884c\u3044\u307e\u3059\u3002\n\u4eca\u56de\u306f`View#onDraw`\u3092\u4f7f\u3063\u3066\u72ec\u81ea\u306b\u63cf\u753b\u3057\u3066\u3044\u307e\u3059\u304c\u3001\n\u5834\u5408\u306b\u3088\u3063\u3066\u306fonDraw\u3092\u4f7f\u308f\u306a\u3044\u3053\u3068\u3082\u3042\u308b\u3068\u601d\u3046\u306e\u3067\u72b6\u6cc1\u306b\u5fdc\u3058\u3066\u8aad\u307f\u66ff\u3048\u3066\u4e0b\u3055\u3044\u3002\n\n```java:CircleView.java\n    @Override\n    protected void onDraw(Canvas canvas) {\n        mOval.set(getStrokeWidth(),\n                getStrokeWidth(),\n                canvas.getWidth() - getStrokeWidth(),\n                canvas.getHeight() - getStrokeWidth());\n        canvas.drawArc(mOval, mStartAngle, 360, false, mSecondPaint);\n        canvas.drawArc(mOval, mStartAngle, mDrawAngle, false, mFirstPaint);\n    }\n```\n\n\u4eca\u56de\u306f\u3053\u308c\u3060\u3051\u3067\u3059\u306d\u3002\u30b7\u30f3\u30d7\u30eb\uff01\n\n##5. \u753b\u9762\u56de\u8ee2\u7b49\u306eActivity\u518d\u8d77\u52d5\u5bfe\u5fdc\n\u5fd8\u308c\u3061\u3083\u3044\u3051\u306a\u3044\u306e\u304c\u753b\u9762\u56de\u8ee2\u5bfe\u5fdc\u3001\u6b63\u78ba\u306b\u306fActivity\u306e\u518d\u8d77\u52d5\u5bfe\u5fdc\u3067\u3059\u3002\n\u3053\u308c\u304c\u306a\u3044\u3068\u753b\u9762\u56de\u8ee2\u3055\u305b\u305f\u6642\u306a\u3069\u306b\u8a2d\u5b9a\u3057\u305f\u30e1\u30f3\u30d0\u30fc\u5909\u6570\u304c\u5168\u3066\u521d\u671f\u5316\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\u57fa\u672c\u7684\u306bActivity\u304c\u4fdd\u6301\u3057\u3066\u3044\u308b\u30e1\u30f3\u30d0\u5909\u6570\u306fActivity\u5074\u3067Bundle\u306b\u6301\u305f\u305b\u308b\u306a\u3069\u306e\u5bfe\u7b56\u304c\u5fc5\u8981\u3067\u3059\u304c\u3001\u72ec\u81eaView\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u306fView\u5074\u3067\u5bfe\u5fdc\u3055\u305b\u305f\u3044\u3067\u3059\u306d\u3002\n\n\u305d\u306e\u305f\u3081\u306b\u306f`View#onSaveInstanceState`\u3068`View#onRestoreInstanceState`\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n```java:CircleView.java\n    @Override\n    protected Parcelable onSaveInstanceState() {\n        Parcelable parent = super.onSaveInstanceState();\n        SavedState saved = new SavedState(parent);\n        saved.startAngle = getStartAngle();\n        saved.drawAngle = getDrawAngle();\n        saved.primaryLineColor = getPrimaryLineColor();\n        saved.secondaryLineColor = getSecondaryLineColor();\n        saved.strokeWidth = getStrokeWidth();\n        return saved;\n    }\n\n    @Override\n    protected void onRestoreInstanceState(Parcelable state) {\n        SavedState saved = (SavedState) state;\n        super.onRestoreInstanceState(saved.getSuperState());\n        setStartAngle(saved.startAngle);\n        setDrawAngle(saved.drawAngle);\n        setPrimaryLineColor(saved.primaryLineColor);\n        setSecondaryLineColor(saved.secondaryLineColor);\n        setStrokeWidth(saved.strokeWidth);\n    }\n\n    private static class SavedState extends BaseSavedState {\n        public float startAngle;\n        public float drawAngle;\n        public int primaryLineColor;\n        public int secondaryLineColor;\n        public float strokeWidth;\n\n        public SavedState(Parcel in) {\n            super(in);\n            startAngle = in.readFloat();\n            drawAngle = in.readFloat();\n            primaryLineColor = in.readInt();\n            secondaryLineColor = in.readInt();\n            strokeWidth = in.readFloat();\n        }\n\n        public SavedState(Parcelable superState) {\n            super(superState);\n        }\n\n        @Override\n        public void writeToParcel(final Parcel out, final int flags) {\n            super.writeToParcel(out, flags);\n            out.writeFloat(startAngle);\n            out.writeFloat(drawAngle);\n            out.writeInt(primaryLineColor);\n            out.writeInt(secondaryLineColor);\n            out.writeFloat(strokeWidth);\n        }\n\n        public static final Parcelable.Creator<SavedState> CREATOR = new Parcelable.Creator<SavedState>() {\n            public SavedState createFromParcel(Parcel in) {\n                return new SavedState(in);\n            }\n\n            public SavedState[] newArray(int size) {\n                return new SavedState[size];\n            }\n        };\n\n    }\n```\n\n\u683c\u7d0d\u7528\u306b`BaseSavedState`\u3092extend\u3057\u305f\u30af\u30e9\u30b9\u3092\u5ba3\u8a00\u3057\u307e\u3059\u3002\nParcelable\u306b\u5bfe\u5fdc\u3055\u305b\u308b\u305f\u3081CREATER\u3082\u8a18\u8ff0\u3057\u3066\u4e0b\u3055\u3044\u3002\n`View#onSaveInstanceState`\u5185\u3067SavedState\u3078\u30e1\u30f3\u30d0\u30fc\u5909\u6570\u3092\u4e00\u6642\u9000\u53bb\u3055\u305b\u3001\n`View#onRestoreInstanceState`\u3067\u53d6\u308a\u51fa\u3057\u3066\u30e1\u30f3\u30d0\u30fc\u5909\u6570\u3092\u5fa9\u5143\u3055\u305b\u308b\u6d41\u308c\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u203b\u7d30\u304b\u3044Parcelable\u306e\u5b9f\u88c5\u65b9\u6cd5\u306f[\u516c\u5f0f](https://developer.android.com/reference/android/os/Parcelable.html)\u304b\u2193\u8fba\u308a\u304c\u308f\u304b\u308a\u3084\u3059\u3044\u3067\u3059\uff08\u4e38\u6295\u3052\uff09\nhttp://y-anz-m.blogspot.jp/2010/03/androidparcelable.html\n\n\u7e26\u753b\u9762\u56fa\u5b9a\u306b\u3057\u3066\u3044\u308b\u3068\u753b\u9762\u56de\u8ee2\u3057\u306a\u3044\u305f\u3081Activity\u518d\u8d77\u52d5\u304c\u8d77\u304d\u306b\u304f\u304f\u5fd8\u308c\u304c\u3061\u3067\u3059\u304c\u3001\n\u30d5\u30a9\u30f3\u30c8\u5909\u66f4\u6642\u3084\u30e1\u30e2\u30ea\u4e0d\u8db3\u6642\u306a\u3069\u69d8\u3005\u306a\u72b6\u6cc1\u3067\u767a\u751f\u3057\u307e\u3059\u3002\n\u500b\u4eba\u7684\u306b\u306f\u3001\u3044\u304b\u306a\u308b\u5834\u5408\u3067\u3082\u5bfe\u5fdc\u306f\u7d76\u5bfe\u6761\u4ef6\u3060\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u3002\n\n## \u304a\u308f\u308a\n\u4e0a\u8a18\u307e\u3067\u8a18\u8f09\u3059\u308c\u3070XML\u304b\u3089\u3082Java\u304b\u3089\u3082\u5168\u3066\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u3001\nActivity\u306e\u518d\u8d77\u52d5\u306b\u3082\u5bfe\u5fdc\u3057\u305f\u72ec\u81eaView\u30af\u30e9\u30b9\u306e\u5b8c\u6210\u3067\u3059\u3002\n\n\u30b3\u30fc\u30c9\u306e\u5168\u6587\u306f\u4ee5\u4e0b\u306eGist\u306b\u304a\u3044\u3066\u304a\u304d\u307e\u3059\u3002\nhttps://gist.github.com/KazaKago/81123f712ab36bfa77cf\n", "tags": ["Android", "view"]}