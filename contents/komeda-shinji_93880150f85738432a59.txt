{"context": " More than 1 year has passed since last update.\n\n\u529b\u6280\u3067\u52d5\u304b\u3059\nCentOS6 \u3067 Zabbix 3.0 \u3092\u52d5\u304b\u3059\u5b9f\u9a13\u306e\u8a18\u9332\u3067\u3059\u3002MySQL \u7528\u3092\u4f7f\u3063\u3066\u5b9f\u9a13\u3057\u307e\u3057\u305f\u3002\n\u691c\u8a3c\u306f CentOS 6.7 \u3067\u884c\u3044\u307e\u3057\u305f\u3002\nrpm \u30d1\u30c3\u30b1\u30fc\u30b8\u3068\u3001\u5bfe\u5fdc\u3059\u308b glibc \u3084 libmysqlclient\u3001libcurl \u3092\u307b\u3069\u3044\u3066\u914d\u7f6e\u3057\u3066\u52d5\u304b\u3059\u65b9\u6cd5\u3067\u3059\u3002\u30bd\u30fc\u30b9\u304b\u3089\u306e\u30d3\u30eb\u30c9\u306f\u4e0d\u8981\u3067\u3059\u304c\u3001\u5fc5\u8981\u3068\u306a\u308b glibc \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u5408\u308f\u306a\u3044\u305f\u3081\u3001\u304b\u306a\u308a\u5f37\u5f15\u306a\u65b9\u6cd5\u3067\u5b9f\u73fe\u3057\u3066\u3044\u307e\u3059\u3002\nCentOS6 \u3067 Zabbix 3.0 \u3092\u52d5\u304b\u3059 (\u81ea\u529b\u30d3\u30eb\u30c9\u7de8) \u3082\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5165\u624b\u3059\u308b\n\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u76f4\u63a5\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3057\u305f\u3002\nzabbix-agent-3.0.1-1.el7.x86_64.rpm\nzabbix-get-3.0.1-1.el7.x86_64.rpm\nzabbix-java-gateway-3.0.1-1.el7.x86_64.rpm\nzabbix-proxy-mysql-3.0.1-1.el7.x86_64.rpm\nzabbix-sender-3.0.1-1.el7.x86_64.rpm\nzabbix-server-mysql-3.0.1-1.el7.x86_64.rpm\nzabbix-web-3.0.1-1.el7.noarch.rpm\nzabbix-web-japanese-3.0.1-1.el7.noarch.rpm\nzabbix-web-mysql-3.0.1-1.el7.noarch.rpm\n\u4eca\u56de\u306f\u5b9f\u9a13\u306e\u305f\u3081\u306b\u4e00\u901a\u308a\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3057\u305f\u304c\u3001zabbix-server-mysql \u3068 zabbix-web \u306e\u4e00\u9023\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u4ee5\u5916\u306f RHEL6/CentOS6 \u7528\u306e\u3082\u306e\u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nMySQL\nremi \u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5c0e\u5165\u3057\u307e\u3057\u305f\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\nmysql-libs-5.5.48-1.el6.remi.x86_64\ncompat-mysql51-5.1.54-1.el6.remi.x86_64\nmysql-5.5.48-1.el6.remi.x86_64\nperl-DBD-MySQL-4.013-3.el6.x86_64\nmysql-server-5.5.48-1.el6.remi.x86_64\n\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u307b\u3069\u3044\u3066\u914d\u7f6e\nrpm \u30d1\u30c3\u30b1\u30fc\u30b8\u3068\u3001\u5bfe\u5fdc\u3059\u308b glibc \u3084 libmysqlclient\u3001libcurl \u3092\u89e3\u3044\u3066\u914d\u7f6e\u3057\u307e\u3059\u3002\n\u914d\u7f6e\u5148\u3092 /opt/zabbix \u3068\u3057\u307e\u3059\u3002\n# mkdir /opt/zabbix\n# rpm2cpio zabbix-server-mysql-3.0.1-1.el7.x86_64.rpm | (cd /opt/zabbix && cpio -idmvu)\n# rpm2cpio zabbix-agent-3.0.1-1.el7.x86_64.rpm | (cd /opt/zabbix && cpio -idmvu)\n# rpm2cpio zabbix-get-3.0.1-1.el7.x86_64.rpm | (cd /opt/zabbix && cpio -idmvu)\n# rpm2cpio zabbix-sender-3.0.1-1.el7.x86_64.rpm | (cd /opt/zabbix && cpio -idmvu)\n\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u4f5c\u6210\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068\u63a5\u7d9a\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306f\u3001\u30e6\u30fc\u30b6\u540d zabbix \u30d1\u30b9\u30ef\u30fc\u30c9 zabbix \u3067\u306e\u4f8b\u3067\u3059\u3002\n$ mysql -uroot -p\nEnter password:\nmysql> create database zabbix character set utf8 collate utf8_bin;\nmysql> grant all privileges on zabbix.* to zabbix@localhost identified by 'zabbix';\nmysql> quit;\n$ gzip -dc /opt/zabbix/usr/share/doc/zabbix-server-mysql-3.0.1/create.sql.gz |\nmysql -uzabbix -pzabbix zabbix \n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u5f35\u3063\u3066\u304a\u304d\u307e\u3059\u3002\n# ln -s /opt/zabbix/etc/zabbix /etc/zabbix\n\n# ln -s /opt/usr/lib/zabbix/alertscripts /usr/lib/zabbix/alertscripts\n# ln -s /opt/usr/lib/zabbix/externalscripts /usr/lib/zabbix/externalscripts\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4fee\u6b63\u3057\u307e\u3059\u3002\n\nzabbix_server.conf.patch\ndiff -u zabbix_server.conf zabbix_server.conf\n--- zabbix_server.conf- 2016-02-28 16:23:55.000000000 +0900\n+++ zabbix_server.conf  2016-03-02 15:50:50.000000000 +0900\n@@ -114,6 +114,8 @@\n # Default:\n # DBPassword=\n\n+DBPassword=zabbix\n+\n ### Option: DBSocket\n #      Path to MySQL socket.\n #\n@@ -121,6 +123,8 @@\n # Default:\n # DBSocket=/tmp/mysql.sock\n\n+DBSocket=/var/lib/mysql/mysql.sock\n+\n ### Option: DBPort\n #      Database port when not using local socket. Ignored for SQLite.\n #\n\n\n# chown zabbix /etc/zabbix/zabbix_server.conf\n# chmod 640 /etc/zabbix/zabbix_server.conf\n\n\n\u5171\u6709\u30e9\u30a4\u30d6\u30e9\u30ea\n\u5171\u6709\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u8db3\u308a\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u30c1\u30a7\u30c3\u30af\u3057\u307e\u3059\u3002\n$ ldd /opt/zabbix/usr/sbin/zabbix_server_mysql\n/opt/zabbix/usr/sbin/zabbix_server_mysql: /lib64/libc.so.6: version `GLIBC_2.15' not found (required by /opt/zabbix/usr/sbin/zabbix_server_mysql)\n/opt/zabbix/usr/sbin/zabbix_server_mysql: /lib64/libc.so.6: version `GLIBC_2.17' not found (required by /opt/zabbix/usr/sbin/zabbix_server_mysql)\n/opt/zabbix/usr/sbin/zabbix_server_mysql: /lib64/libc.so.6: version `GLIBC_2.14' not found (required by /opt/zabbix/usr/sbin/zabbix_server_mysql)\n        linux-vdso.so.1 =>  (0x00007ffc81169000)\n        libmysqlclient.so.18 => /usr/lib64/mysql/libmysqlclient.so.18 (0x00007fb896437000)\n        libiksemel.so.3 => /usr/lib64/libiksemel.so.3 (0x00007fb896229000)\n        libxml2.so.2 => /usr/lib64/libxml2.so.2 (0x00007fb895ed6000)\n        libodbc.so.2 => /usr/lib64/libodbc.so.2 (0x00007fb895c6f000)\n        libnetsnmp.so.31 => not found\n        libssh2.so.1 => /usr/lib64/libssh2.so.1 (0x00007fb895a46000)\n        libOpenIPMI.so.0 => /usr/lib64/libOpenIPMI.so.0 (0x00007fb89573e000)\n        libOpenIPMIposix.so.0 => /usr/lib64/libOpenIPMIposix.so.0 (0x00007fb895539000)\n        libssl.so.10 => /usr/lib64/libssl.so.10 (0x00007fb8952cc000)\n        libcrypto.so.10 => /usr/lib64/libcrypto.so.10 (0x00007fb894ee8000)\n        libldap-2.4.so.2 => /lib64/libldap-2.4.so.2 (0x00007fb894c98000)\n        liblber-2.4.so.2 => /lib64/liblber-2.4.so.2 (0x00007fb894a88000)\n        libcurl.so.4 => /usr/lib64/libcurl.so.4 (0x00007fb894822000)\n        libm.so.6 => /lib64/libm.so.6 (0x00007fb89459e000)\n        libdl.so.2 => /lib64/libdl.so.2 (0x00007fb894399000)\n        libresolv.so.2 => /lib64/libresolv.so.2 (0x00007fb89417f000)\n        libc.so.6 => /lib64/libc.so.6 (0x00007fb893deb000)\n        libpthread.so.0 => /lib64/libpthread.so.0 (0x00007fb893bcd000)\n        libz.so.1 => /lib64/libz.so.1 (0x00007fb8939b7000)\n        librt.so.1 => /lib64/librt.so.1 (0x00007fb8937af000)\n        libstdc++.so.6 => /usr/lib64/libstdc++.so.6 (0x00007fb8934a8000)\n        libgcc_s.so.1 => /lib64/libgcc_s.so.1 (0x00007fb893292000)\n        libgnutls.so.26 => /usr/lib64/libgnutls.so.26 (0x00007fb892fef000)\n        libgcrypt.so.11 => /lib64/libgcrypt.so.11 (0x00007fb892d79000)\n        libgpg-error.so.0 => /lib64/libgpg-error.so.0 (0x00007fb892b75000)\n        libltdl.so.7 => /usr/lib64/libltdl.so.7 (0x00007fb89296c000)\n        libOpenIPMIutils.so.0 => /usr/lib64/libOpenIPMIutils.so.0 (0x00007fb892763000)\n        libncurses.so.5 => /lib64/libncurses.so.5 (0x00007fb892541000)\n        libgdbm.so.2 => /usr/lib64/libgdbm.so.2 (0x00007fb89233b000)\n        libgssapi_krb5.so.2 => /lib64/libgssapi_krb5.so.2 (0x00007fb8920f6000)\n        libkrb5.so.3 => /lib64/libkrb5.so.3 (0x00007fb891e0f000)\n        libcom_err.so.2 => /lib64/libcom_err.so.2 (0x00007fb891c0b000)\n        libk5crypto.so.3 => /lib64/libk5crypto.so.3 (0x00007fb8919de000)\n        libsasl2.so.2 => /usr/lib64/libsasl2.so.2 (0x00007fb8917c4000)\n        libssl3.so => /usr/lib64/libssl3.so (0x00007fb891584000)\n        libsmime3.so => /usr/lib64/libsmime3.so (0x00007fb891357000)\n        libnss3.so => /usr/lib64/libnss3.so (0x00007fb891018000)\n        libnssutil3.so => /usr/lib64/libnssutil3.so (0x00007fb890dec000)\n        libplds4.so => /lib64/libplds4.so (0x00007fb890be7000)\n        libplc4.so => /lib64/libplc4.so (0x00007fb8909e2000)\n        libnspr4.so => /lib64/libnspr4.so (0x00007fb8907a4000)\n        libidn.so.11 => /lib64/libidn.so.11 (0x00007fb890571000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007fb89691f000)\n        libtasn1.so.3 => /usr/lib64/libtasn1.so.3 (0x00007fb890361000)\n        libtinfo.so.5 => /lib64/libtinfo.so.5 (0x00007fb89013f000)\n        libkrb5support.so.0 => /lib64/libkrb5support.so.0 (0x00007fb88ff34000)\n        libkeyutils.so.1 => /lib64/libkeyutils.so.1 (0x00007fb88fd31000)\n        libcrypt.so.1 => /lib64/libcrypt.so.1 (0x00007fb88faf9000)\n        libselinux.so.1 => /lib64/libselinux.so.1 (0x00007fb88f8da000)\n        libfreebl3.so => /lib64/libfreebl3.so (0x00007fb88f6d6000)\n\nRHEL7/CentOS7 \u7528\u306b\u30d3\u30eb\u30c9\u3055\u308c\u305f Zabbix 3.0 \u306f glibc 2.17 \u3092\u8981\u6c42\u3057\u307e\u3059\u3002\n\u307e\u305f libnetsnmp.so.31 \u304c not found \u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\nCentOS7 \u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304d\u307e\u3059\u3002\n\u307e\u305f\u3001curl \u3082 CentOS6 \u3082\u306e\u306f\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u53e4\u304f SMTP AUTH \u304c\u4f7f\u3048\u306a\u3044\u305f\u3081\u3053\u3061\u3089\u3082\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304d\u307e\u3059\u3002\n\u5148\u307b\u3069\u3068\u540c\u69d8\u306b\u5c55\u958b\u3057\u307e\u3059\u3002\n# rpm2cpio glibc-2.17-105.el7.x86_64.rpm | (cd /opt/zabbix && cpio -idmvu)\n# net-snmp-libs-5.7.2-24.el7.x86_64.rpm | (cd /opt/zabbix && cpio -idmvu)\n# rpm2cpio libcurl-7.29.0-25.el7.centos.x86_64.rpm | (cd /opt/zabbix && cpio -idmvu)\n\n\n\u3072\u3068\u307e\u305a\u5b9f\u884c\u3057\u3066\u307f\u308b\n\u8d77\u52d5\u3067\u304d\u308b\u304b\u3069\u3046\u304b\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n$ LD_LIBRARY_PATH=/opt/zabbix/lib64:/opt/zabbix/usr/lib64 /opt/zabbix/usr/sbin/zabbix_server_mysql -h\n/opt/zabbix/usr/sbin/zabbix_server_mysql: relocation error: /opt/zabbix/lib64/libc.so.6: symbol _dl_starting_up, version GLIBC_PRIVATE not defined in file ld-linux-x86-64.so.2 with link time reference\n\n\u8d77\u52d5\u6642\u306b\u4f7f\u7528\u3059\u308b\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30ea\u30f3\u30ab\u30fc ld-linux-x86-64.so.2 \u304c\u5408\u3063\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u3002\nCentOS6 \u3068 CentOS7 \u3067\u306f\u3001glibc \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u7570\u306a\u308a\u307e\u3059\u3002\nCentOS6 \u306e glibc \u306f 2.12 CentOS7 \u306e glibc \u306f 2.17 \u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3053\u306e\u305f\u3081\u3001rpm \u30d1\u30c3\u30b1\u30fc\u30b8\u3068\u3001\u5bfe\u5fdc\u3059\u308b glibc \u3084 libmysqlclient\u3001libcurl \u3092\u89e3\u3044\u3066\u914d\u7f6e\u3057\u3066\u3001\u74b0\u5883\u5909\u6570 LD_LIBRARY_PATH \u3092\u8a2d\u5b9a\u3057\u305f\u3060\u3051\u3067\u306f\u3046\u307e\u304f\u8d77\u52d5\u3067\u304d\u307e\u305b\u3093\u3002\nglibc \u306e\u5834\u5408\u3001libc-2.XX.so \u3068\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30ea\u30f3\u30ab\u30fc ld-2.XX.so \u3068\u304c\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001\u8d77\u52d5\u6642\u306b\u4f7f\u7528\u3055\u308c\u308b\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30ea\u30f3\u30ab\u30fc\u306f\u3001\u30ed\u30fc\u30c9-\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3068\u304d\u306b\u3001libc.so \u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u304c\u30d7\u30ed\u30b0\u30e9\u30e0\u30d8\u30c3\u30c0\u306e INTERP \u306b\u57cb\u3081\u8fbc\u307e\u308c\u307e\u3059\u3002\n\n/usr/lib64/libc.so\n/* GNU ld script\n   Use the shared library, but some functions are only in\n   the static library, so try that secondarily.  */\nOUTPUT_FORMAT(elf64-x86-64)\nGROUP ( /lib64/libc.so.6 /usr/lib64/libc_nonshared.a  AS_NEEDED ( /lib64/ld-linux-x86-64.so.2 ) )\n\n\n$ readelf  -l -S   /opt/zabbix/usr/sbin/zabbix_server_mysql  | sed -n '/Program Headers:/,/program interpreter/p'\nProgram Headers:\n  Type           Offset             VirtAddr           PhysAddr\n                 FileSiz            MemSiz              Flags  Align\n  PHDR           0x0000000000000040 0x0000000000400040 0x0000000000400040\n                 0x00000000000001f8 0x00000000000001f8  R E    8\n  INTERP         0x0000000000000238 0x0000000000400238 0x0000000000400238\n                 0x000000000000001c 0x000000000000001c  R      1\n      [Requesting program interpreter: /lib64/ld-linux-x86-64.so.2]\n\n/lib64/ld-linux-x86-64.so.2 \u306f CentOS6 \u3067\u306f\u30012.12 \u7528\u306e\u3082\u306e\u306a\u306e\u3067\u3046\u307e\u304f\u8d77\u52d5\u3067\u304d\u307e\u305b\u3093\u3002\n\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30ea\u30f3\u30ab\u30fc\u306b\u306f\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u304c\u8d77\u52d5\u3055\u308c\u305f\u3068\u304d\u306b\u3001\u5fc5\u8981\u306a\u5171\u6709\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8aad\u307f\u8fbc\u3080\u30d8\u30eb\u30d1\u30fc\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u6a5f\u80fd\u306e\u307b\u304b\u306b\u3001\u30ed\u30fc\u30c9\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8d77\u52d5\u3059\u308b\u6a5f\u80fd\u304c\u3042\u308a\u307e\u3059\u3002\nNAME\n       ld.so, ld-linux.so* - dynamic linker/loader\n\nSYNOPSIS\n       The dynamic linker can be run either indirectly by running some dynami\u2010\n       cally linked program or library (in which case no command-line  options\n       to  the  dynamic linker can be passed and, in the ELF case, the dynamic\n       linker which is stored in the .interp section of the  program  is  exe\u2010\n       cuted) or directly by running:\n\n       /lib/ld-linux.so.*  [OPTIONS] [PROGRAM [ARGUMENTS]]\n\nOPTIONS\n\n       --library-path PATH\n              Use PATH instead of LD_LIBRARY_PATH environment variable setting\n              (see below).\n\n\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30ea\u30f3\u30ab ld-linux-x86-64.so.2 \u306b\u3001\u5171\u6709\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u691c\u7d22\u30d1\u30b9\u3092\u6307\u5b9a\u3057\u3066\u8d77\u52d5\u3057\u3001\u30ed\u30fc\u30c9\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u547c\u3073\u51fa\u3059\u3088\u3046\u306b\u3059\u308c\u3070\u554f\u984c\u306a\u304f\u52d5\u4f5c\u3057\u307e\u3059\u3002\n\u3084\u3063\u3066\u307f\u307e\u3059\u3002\n$ /opt/zabbix/lib64/ld-linux-x86-64.so.2 --library-path /opt/zabbix/lib64:/opt/zabbix/usr/lib64 /opt/zabbix/usr/sbin/zabbix_server_mysql -h\nusage:\n  zabbix_server_mysql [-c config-file]\n  zabbix_server_mysql [-c config-file] -R runtime-option\n  zabbix_server_mysql -h\n  zabbix_server_mysql -V\n\nThe core daemon of Zabbix software.\n\nOptions:\n  -c --config config-file        Absolute path to the configuration file\n                                 (default: \"/etc/zabbix/zabbix_server.conf\")\n  -f --foreground                Run Zabbix server in foreground\n  -R --runtime-control runtime-option   Perform administrative functions\n\n    Runtime control options:\n      config_cache_reload        Reload configuration cache\n      housekeeper_execute        Execute the housekeeper\n      log_level_increase=target  Increase log level, affects all processes if\n                                 target is not specified\n      log_level_decrease=target  Decrease log level, affects all processes if\n                                 target is not specified\n\n      Log level control targets:\n        pid                      Process identifier\n        process-type             All processes of specified type (e.g., poller)\n        process-type,N           Process type and number (e.g., poller,3)\n\n  -h --help                      Display this help message\n  -V --version                   Display version number\n\nReport bugs to: <https://support.zabbix.com>\nZabbix home page: <http://www.zabbix.com>\nDocumentation: <https://www.zabbix.com/documentation>\n\n\u3060\u3044\u3058\u3087\u3046\u3076\u306a\u3088\u3046\u3067\u3059\u3002\n\u8a3b) \u3053\u306e\u5b9f\u884c\u7d50\u679c\u3060\u3051\u3067\u306f\u308f\u304b\u308a\u307e\u305b\u3093\u304c\u3001\u3058\u3064\u306f libmysqlclient.so.18 \u306f CentOS7 \u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u3042\u308bMariaDB \u306e\u3082\u306e\u3092\u4f7f\u7528\u3057\u306a\u3044\u3068\u5b9f\u884c\u6642\u306b\u672a\u5b9a\u7fa9\u30b7\u30f3\u30dc\u30eb\u30a8\u30e9\u30fc\u304c\u51fa\u307e\u3059\u3002\u3053\u306e\u3053\u3068\u306b\u3064\u3044\u3066\u306f\u5f8c\u307b\u3069\u89e6\u308c\u307e\u3059\u3002\n\n\u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\nCentOS7 \u3067\u306f systemd \u3092\u4f7f\u7528\u3059\u308b\u5f62\u306b\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3001\u65e7\u6765\u306e\u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u542b\u307e\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n\u305d\u3053\u3067 Zabbix 2.4 \u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u542b\u307e\u308c\u308b\u3082\u306e\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081\u3001\u30a2\u30fc\u30ab\u30a4\u30d6\u304b\u3089\u5c55\u958b\u3057\u307e\u3059\u3002\n# rpm2cpio zabbix-server-2.4.7-1.el6.x86_64.rpm | (cd /opt/zabbix && cpio -idmvu ./etc/init.d/zabbix-server)\n# rpm2cpio zabbix-agent-2.4.7-1.el6.x86_64.rpm | (cd /opt/zabbix && cpio -idmvu\n./etc/init.d/zabbix-agent)\n\nld-linux-x86-64.so.2 \u7d4c\u7531\u3067\u8d77\u52d5\u3059\u308b\u3088\u3046\u306b\u4fee\u6b63\u3057\u307e\u3059\u3002\n\nzabbix-server.init.patch\n--- /opt/zabbix/etc/init.d/zabbix-server        2015-11-13 19:14:20.000000000 +0900\n+++ /opt/zabbix/etc/init.d/zabbix-server        2016-03-03 23:57:02.975726383 +0900\n@@ -18,11 +18,19 @@\n # Source function library.\n . /etc/rc.d/init.d/functions\n\n-if [ -x /usr/sbin/zabbix_server ]; then\n-    exec=zabbix_server\n+zroot=/opt/zabbix\n+if [ -x $zroot/usr/sbin/zabbix_server ]; then\n+    #exec=$zroot/usr/sbin/zabbix_server\n+    exec=$zroot/usr/sbin/zabbix_server_mysql\n else\n     exit 5\n fi\n+if [ -x $zroot/lib64/ld-linux-x86-64.so.2 ]; then\n+    ld_so=$zroot/lib64/ld-linux-x86-64.so.2\n+else\n+    exit 5\n+fi\n+library_path=$zroot/lib64:$zroot/usr/lib64\n\n prog=${exec##*/}\n conf=/etc/zabbix/zabbix_server.conf\n@@ -38,7 +46,7 @@\n start()\n {\n     echo -n $\"Starting Zabbix server: \"\n-    daemon $exec -c $conf\n+    LD_LIBRARY_PATH=$library_path $ld_so $exec -c $conf\n     rv=$?\n     echo\n     [ $rv -eq 0 ] && touch $lockfile\n\n\n\u5b9f\u884c\u30e6\u30fc\u30b6 zabbix \u3068\u5b9f\u884c\u30b0\u30eb\u30fc\u30d7 zabbix \u3092\u4f5c\u6210\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n# groupadd -g 119 zabbix\n# useradd -u 119 -g 119 -d /var/run/zabbix/ -s /bin/false zabbix \n\n\u30ed\u30b0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u304a\u304d\u307e\u3059\u3002\ninstall -o zabbix -g zabbix -d /var/log/zabbix\n\n\u8d77\u52d5\u3057\u3066\u307f\u307e\u3059\u3002\n# sh -x /opt/zabbix/etc/init.d/zabbix-server start\n\n\u5b9f\u884c\u3057\u3066\u307f\u308b\u3068\u4e00\u898b\u30a8\u30e9\u30fc\u306f\u51fa\u306a\u3044\u3082\u306e\u306e\u3001\u8d77\u52d5\u3057\u305f\u30d7\u30ed\u30bb\u30b9\u304c\u3042\u308a\u307e\u305b\u3093\u3002zabbix_server.log \u3092\u898b\u308b\u3068\u672a\u89e3\u6c7a\u30b7\u30f3\u30dc\u30eb\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u3044\u307e\u3057\u305f\u3002\n\n/var/log/zabbix/zabbix_server.log\n/opt/zabbix/usr/sbin/zabbix_server_mysql: relocation error: /opt/zabbix/usr/sbin/zabbix_server_mysql: symbol mysql_init, version libmysqlclient_18 not defined in file libmysqlclient.so.18 with link time reference\n\n\nCentOS7 \u3067\u306f MariaDB \u3092\u4f7f\u7528\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3001libmysqlclient.so.18 \u306f CentOS7 \u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u3042\u308b MariaDB \u306e\u3082\u306e\u3092\u4f7f\u7528\u3057\u306a\u3044\u3068\u30c0\u30e1\u306a\u3088\u3046\u3067\u3059\u3002CentOS7 \u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304d\u3066\u5c55\u958b\u3057\u307e\u3059\u3002\n# rpm2cpio mariadb-libs-5.5.44-2.el7.centos.x86_64.rpm | (cd /opt/zabbix && cpio -idmvu)\n\n\u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u306e library_path \u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nzabbix-server.init.2.patch\n--- zabbix-server       2016-03-04 02:28:56.955721309 +0900\n+++ zabbix-server       2016-03-03 23:57:02.975726383 +0900\n@@ -30,7 +30,7 @@\n else\n     exit 5\n fi\n-library_path=$zroot/lib64:$zroot/usr/lib64\n+library_path=$zroot/lib64:$zroot/usr/lib64:$zroot/usr/lib64/mysql\n\n if [ ! -d /var/log/zabbix ]; then\n     install -o zabbix -g zabbix -d /var/log/zabbix\n\n\n\u518d\u5ea6\u8d77\u52d5\u3057\u3066\u307f\u308b\u3068\u554f\u984c\u306a\u304f\u7acb\u3061\u4e0a\u304c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\nps \u3067\u898b\u308b\u3068\u3001ld-linux \u3070\u304b\u308a\u4e26\u3093\u3067\u4f55\u304c\u306a\u3093\u3060\u304b\u308f\u304b\u308a\u307e\u305b\u3093\u3002\n$ ps axg | grep zabbix\n  366 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2 /opt/zabbix/usr/sbin/zabbix_server_mysql -c /etc/zabbix/zabbix_server.conf\n  371 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  372 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  373 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  374 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  375 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  376 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  377 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  378 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  379 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  380 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  381 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  382 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  383 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  384 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  385 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  389 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  390 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  391 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  392 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  393 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  394 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  395 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  406 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  407 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  408 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  409 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n\nargv[0] \u304c\u30ed\u30fc\u30c9\u30e2\u30b8\u30e5\u30fc\u30eb\u540d\u306b\u306a\u308b\u3088\u3046\u306b\u3057\u3066 exec \u3059\u308b\u30e9\u30c3\u30d1\u30fc\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\n\nzwrapper.py\n#!/usr/bin/python\n\nimport sys\nimport os\n\nLD_SO = \"/opt/zabbix/lib64/ld-linux-x86-64.so.2\"\n\nZROOT = \"/opt/zabbix\"\nLIBRARY_PATH = [ \"/lib64\", \"/usr/lib64\", \"/usr/lib64/mysql\" ]\n\nif (len(sys.argv) < 1):\n    sys.exit(1)\n\n#os.environ[\"LD_LIBRARY_PATH\"] = ':'.join([ ZROOT + x for x in LIBRARY_PATH ])\n\nargs = [ sys.argv[0] ]\nargs.append(\"--library-path\")\nargs.append(':'.join([ ZROOT + x for x in LIBRARY_PATH ]))\n\nif (sys.argv[0][0] == '/'):\n    path = \"%s%s\" % (ZROOT, sys.argv[0])\n    args.append(path)\nelse:\n    path = \"%s/usr/bin/%s\" % (ZROOT, sys.argv[0])\n    if (os.access(path, os.X_OK)):\n        args.append(path)\n    else:\n        path = \"%s/usr/sbin/%s\" % (ZROOT, sys.argv[0])\n        if (os.access(path, os.X_OK)):\n            printf >>stderr, \"%s: not found\\n\" % sys.argv[0]\n            sys.exit(1)\n        args.append(path)\nargs.extend(sys.argv[1:])\nos.execv(LD_SO, args)\n\n\n\u3053\u306e\u30e9\u30c3\u30d1\u30fc\u306f /usr/sbin/zabbix_server_mysql \u3068\u3057\u3066\u914d\u7f6e\u3057\u3066\u3001\u3053\u3061\u3089\u3092\u8d77\u52d5\u3059\u308b\u3068\u3001/opt/zabbix/usr/sbin/zabbix_server_mysql_ \u3092\u8d77\u52d5\u3057\u3066\u3001\u30d7\u30ed\u30bb\u30b9\u540d\u304c /usr/sbin/zabbix_server_mysql \u3068\u3057\u3066\u898b\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002 \n\u8a3b\uff09\u901a\u5e38\u30d7\u30ed\u30bb\u30b9\u540d\u306f Zabbix \u5074\u3067\u5f79\u5272\u3092\u8868\u3059\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u3089\u308c\u308b\u306e\u3067\u3059\u304c\u3001ld-linux \u7d4c\u7531\u3067\u30ed\u30fc\u30c9\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8d77\u52d5\u3057\u305f\u3068\u304d\u306f\u3001\u66f8\u304d\u63db\u3048\u304c\u3067\u304d\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n$ ps axg | grep zabbix\n 3840 ?        S      0:00 /usr/sbin/zabbix_server_mysql --library-path /opt/zabbix/lib64:/opt/zabbix/usr/lib64:/opt/zabbix/usr/lib64/mysql /opt/zabbix/usr/sbin/zabbix_server_mysql\n 3845 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3846 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3847 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3848 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3849 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3850 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3851 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3852 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3853 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3854 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3855 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3856 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3857 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3858 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3859 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3860 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3861 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3862 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3863 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3870 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3871 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3872 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3873 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3874 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3875 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3876 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3894 pts/1    S+     0:00 grep zabbix\n\n\n\u30ce\u30fc\u30c8\nLD_LIBRARY_PATH \u3092\u6307\u5b9a\u3057\u3066\u3001ld-linux-x86-64.so.2 \u3092\u8d77\u52d5\u3059\u308b\u3068\u3001zabbix_server \u304b\u3089\u8d77\u52d5\u3055\u308c\u308b\u5b50\u30d7\u30ed\u30bb\u30b9\u306b\u3082\u3053\u306e\u74b0\u5883\u5909\u6570\u304c\u6e21\u3063\u3066\u3057\u307e\u3044\u3001\u5b50\u30d7\u30ed\u30bb\u30b9\u306e\u8d77\u52d5\u306b\u5931\u6557\u3057\u307e\u3059\u3002\n\u305f\u3068\u3048\u3070\u3001zabbix_agentd \u3092 LD_LIBRARY_PATH \u3092\u6307\u5b9a\u3059\u308b\u65b9\u6cd5\u3067\u8d77\u52d5\u3059\u308b\u3068\u3001zabbix_agentd \u305d\u306e\u3082\u306e\u306f\u52d5\u304f\u306e\u3067\u3059\u304c\u3001UserParameter \u3067\u6307\u5b9a\u3057\u305f\u5916\u90e8\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u8d77\u52d5\u306b\u5931\u6557\u3057\u307e\u3059\u3002\n$ zabbix_get -s 127.0.0.1 -k mysql.version\nsh: relocation error: /opt/zabbix/lib64/libc.so.6: symbol _dl_starting_up, version GLIBC_PRIVATE not defined in file ld-linux-x86-64.so.2 with link time reference\n\n\u3053\u306e\u4f8b\u306e relocation error \u306f\u3001 zabbix_agentd \u304c execl(\"/bin/sh\", \"sh\", \"-c\", command, NULL); \u3067\u5b50\u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3057\u3088\u3046\u3068\u3057\u3066 /bin/sh \u304c\u30a8\u30e9\u30fc\u3092\u51fa\u3057\u305f\u3082\u306e\u3067\u3059\u3002\n\u6700\u521d\u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u306f\u3001LD_LIBRARY_PATH \u3092\u6307\u5b9a\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u30e9\u30c3\u30d1\u30fc\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u306f --library-path \u5f15\u6570\u3067\u6307\u5b9a\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30e9\u30c3\u30d1\u30fc\u306e\u914d\u7f6e\u3068\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u306e\u4f5c\u6210\n\u4eca\u56de\u306f rpm2cpio \u3067\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5c55\u958b\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u672c\u6765\u3067\u3042\u308c\u3070\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u306b\n/usr/sbin/update-alternatives --install /usr/sbin/zabbix_server \\\n        zabbix-server /usr/sbin/zabbix_server_mysql 10\n\n\u304c\u5b9f\u884c\u3055\u308c\u3066\u3001/usr/sbin/zabbix_server \u306f /usr/sbin/zabbix_server_mysql \u3092\u6307\u3059\u3088\u3046\u306b\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u304c\u5f35\u3089\u308c\u307e\u3059\u3002\n\u30e9\u30c3\u30d1\u30fc\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u306f\u3001\u8d77\u52d5\u3055\u308c\u305f\u540d\u524d\u3092\u3082\u3068\u306b\u5b9f\u884c\u3059\u308b\u30ed\u30fc\u30c9\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u6c7a\u5b9a\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u3064\u304e\u306e\u3088\u3046\u306b\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\ncp zwrapper.py /usr/sbin/zwrapper\nln -s zwrapper /usr/sbin/zabbix_server_mysql\nln -s zwrapper /usr/sbin/zabbix_server\nln -s zabbix_server_mysql /opt/zabbix/usr/sbin/zabbix_server\nln -s zwrapper /usr/sbin/zabbix_agentd\n\nln /usr/sbin/zwrapper /usr/bin/zwrapper\nln -s zwrapper /usr/bin/zabbix_get\nln -s zwrapper /usr/bin/zabbix_sender\n\n$ ls -l /usr/sbin/zabbix_server /usr/sbin/zabbix_server_mysql  /opt/zabbix/usr/sbin/zabbix_server /opt/zabbix/usr/sbin/zabbix_server_mysql\nlrwxrwxrwx 1 root root      19 Mar  4 02:55 /opt/zabbix/usr/sbin/zabbix_server -> zabbix_server_mysql\n-rwxr-xr-x 1 root root 1594952 Feb 28 16:24 /opt/zabbix/usr/sbin/zabbix_server_mysql\nlrwxrwxrwx 1 root root       8 Mar  4 03:08 /usr/sbin/zabbix_server -> zwrapper\nlrwxrwxrwx 1 root root       8 Mar  2 18:41 /usr/sbin/zabbix_server_mysql -> zwrapper\n$ ls -l /usr/sbin/zabbix_agentd\nlrwxrwxrwx 1 root root 8 Mar  2 18:41 /usr/sbin/zabbix_agentd -> zwrapper\n$ ls -l /usr/bin/zabbix_get /usr/bin/zabbix_sender /usr/bin/zwrapper\nlrwxrwxrwx 1 root root   8 Mar  2 18:38 /usr/bin/zabbix_get -> zwrapper\nlrwxrwxrwx 1 root root   8 Mar  2 18:41 /usr/bin/zabbix_sender -> zwrapper\n-rwxr-xr-x 2 root root 881 Mar  4 05:42 /usr/bin/zwrapper\n\n\u3053\u306e\u3088\u3046\u306b\u3059\u308b\u3068\u3001\u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u5909\u66f4\u306a\u3057\u3067\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u30a2\u30fc\u30ab\u30a4\u30d6\u304b\u3089 /etc/init.d \u306b\u5c55\u958b\u3057\u307e\u3059\u3002\n# rpm2cpio zabbix-server-2.4.7-1.el6.x86_64.rpm | (cd / && cpio -imv ./etc/init.d/zabbix-server)\n# rpm2cpio zabbix-agent-2.4.7-1.el6.x86_64.rpm | (cd / && cpio -imv ./etc/init.d/zabbix-agent)\n\n\nweb\nPHP 5.4 \u4ee5\u4e0a\u304c\u5fc5\u8981\u3068\u306a\u308a\u307e\u3059\u3002remi \u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5c0e\u5165\u3057\u307e\u3057\u305f\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\nphp-common-5.4.45-4.el6.remi.x86_64\nphp-5.4.45-4.el6.remi.x86_64\nphp-mysql-5.4.45-4.el6.remi.x86_64\nphp-bcmath-5.4.45-4.el6.remi.x86_64\nphp-xml-5.4.45-4.el6.remi.x86_64\nhttpd-tools-2.2.15-47.el6.centos.3.x86_64\nhttpd-2.2.15-47.el6.centos.3.x86_64\nphp-cli-5.4.45-4.el6.remi.x86_64\nphp-pdo-5.4.45-4.el6.remi.x86_64\nphp-mbstring-5.4.45-4.el6.remi.x86_64\nphp-gd-5.4.45-4.el6.remi.x86_64\nphp-ldap-5.4.45-4.el6.remi.x86_64\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u5f35\u3063\u3066\u304a\u304d\u307e\u3059\u3002\n# ln -s /opt/zabbix/usr/share/zabbix /usr/share/zabbix\n\nGUI \u304b\u3089\u306e\u521d\u671f\u8a2d\u5b9a\u3067\u4f5c\u6210\u3055\u308c\u308b\u30d5\u30a1\u30a4\u30eb\u304c\u66f8\u304d\u8fbc\u3081\u308b\u3088\u3046\u306b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n# chgrp apache /etc/zabbix/web\n# chmod g+w /etc/zabbix/web\n\n# ls -ld /etc/zabbix/web\ndrwxrwx--- 2 root apache 4096 Mar  2 19:43 /etc/zabbix/web\n\n/opt/zabbix/etc/httpd/conf.d/zabbix.conf \u306b\u3042\u308b\u30d5\u30a1\u30a4\u30eb\u306f apache 2.4 \u7528\u306e\u3082\u306e\u3067\u3042\u308b\u305f\u3081\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u4fee\u6b63\u3057\u3066 /etc/httpd/conf.d/zabbix.conf \u306b\u914d\u7f6e\u3057\u307e\u3059\u3002\n\n/etc/httpd/conf.d/zabbix.conf.patch\ndiff -u zabbix.conf zabbix.conf\n--- zabbix.conf       2016-02-28 16:05:33.000000000 +0900\n+++ zabbix.conf       2016-03-04 14:49:45.345699170 +0900\n@@ -7,7 +7,8 @@\n <Directory \"/usr/share/zabbix\">\n     Options FollowSymLinks\n     AllowOverride None\n-    Require all granted\n+    Order allow,deny\n+    Allow from all\n\n     <IfModule mod_php5.c>\n         php_value max_execution_time 300\n@@ -16,22 +17,42 @@\n         php_value upload_max_filesize 2M\n         php_value max_input_time 300\n         php_value always_populate_raw_post_data -1\n-        # php_value date.timezone Europe/Riga\n+        php_value date.timezone Asia/Tokyo\n     </IfModule>\n </Directory>\n\n <Directory \"/usr/share/zabbix/conf\">\n-    Require all denied\n+    Order deny,allow\n+    Deny from all\n+    <files *.php>\n+        Order deny,allow\n+        Deny from all\n+    </files>\n </Directory>\n\n <Directory \"/usr/share/zabbix/app\">\n-    Require all denied\n+    Order deny,allow\n+    Deny from all\n+    <files *.php>\n+        Order deny,allow\n+        Deny from all\n+    </files>\n </Directory>\n\n <Directory \"/usr/share/zabbix/include\">\n-    Require all denied\n+    Order deny,allow\n+    Deny from all\n+    <files *.php>\n+        Order deny,allow\n+        Deny from all\n+    </files>\n </Directory>\n\n <Directory \"/usr/share/zabbix/local\">\n-    Require all denied\n+    Order deny,allow\n+    Deny from all\n+    <files *.php>\n+        Order deny,allow\n+        Deny from all\n+    </files>\n </Directory>\n\n\n# apachectl graceful\n\n\nGUI \u304b\u3089\u306e\u521d\u671f\u8a2d\u5b9a\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f iptable \u306b\u3088\u308b\u30d1\u30b1\u30c3\u30c8\u30d5\u30a3\u30eb\u30bf\u30fc\u304c\u304b\u304b\u3063\u3066\u3044\u307e\u3059\u3002\n\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u4fee\u6b63\u3057\u307e\u3059\u3002\n\niptables.patch\ndiff -u /etc/sysconfig/iptables  /etc/sysconfig/iptables\n--- /etc/sysconfig/iptables.old 2016-03-02 05:23:33.296000000 +0900\n+++ /etc/sysconfig/iptables     2016-03-03 03:21:08.606717140 +0900\n@@ -8,6 +8,10 @@\n -A INPUT -p icmp -j ACCEPT\n -A INPUT -i lo -j ACCEPT\n -A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT\n+-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT\n+-A INPUT -m state --state NEW -m tcp -p tcp --dport 10050 -j ACCEPT\n+-A INPUT -m state --state NEW -m tcp -p tcp --dport 10051 -j ACCEPT\n+-A INPUT -j REJECT --reject-with icmp-host-prohibited\n -A INPUT -j REJECT --reject-with icmp-host-prohibited\n -A FORWARD -j REJECT --reject-with icmp-host-prohibited\n COMMIT\n\n\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089 http://zabbix-server/zabbix/ \u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n2.2 \u3084 2.4 \u3068\u306f\u305a\u3044\u3076\u3093\u96f0\u56f2\u6c17\u304c\u5909\u308f\u308a\u307e\u3057\u305f\u304c\u3001\u8a2d\u5b9a\u306e\u6d41\u308c\u306f\u304b\u308f\u308a\u307e\u305b\u3093\u3002\n\n\u30ce\u30fc\u30c8\nSElinux \u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u308b\u3068\u3001Zabbix \u30b5\u30fc\u30d0\u3078\u306e\u30d8\u30eb\u30b9\u30c1\u30a7\u30c3\u30af\u3092 SElinux \u304c\u963b\u6b62\u3059\u308b\u305f\u3081\u306b\u3001Zabbix server is not running (\u30b5\u30fc\u30d0\u304c\u505c\u6b62\u3057\u3066\u3044\u308b) \u3068\u3044\u3046\u8b66\u544a\u304c\u51fa\u305f\u307e\u307e\u306b\u306a\u308a\u307e\u3059\u3002\n\u3053\u306e\u3068\u304d audit.log \u3092\u78ba\u8a8d\u3059\u308b\u3068\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u3066\u3044\u307e\u3059\u3002\n\n/var/log/audit/audit.log\ntype=AVC msg=audit(1456943266.076:612): avc:  denied  { name_connect } for  pid=15592 comm=\"httpd\" dest=10051 scontext=unconfined_u:system_r:httpd_t:s0 tcontext=system_u:object_r:zabbix_port_t:s0 tclass=tcp_socket\ntype=SYSCALL msg=audit(1456943266.076:612): arch=c000003e syscall=42 success=no exit=-13 a0=c a1=7fa7401687e8 a2=10 a3=7fa73bf6814c items=0 ppid=15529 pid=15592 auid=1003 uid=48 gid=48 euid=48 suid=48 fsuid=48 egid=48 sgid=48 fsgid=48 tty=(none) ses=1 comm=\"httpd\" exe=\"/usr/sbin/httpd\" subj=unconfined_u:system_r:httpd_t:s0 key=(null)\n\n\nhttpd(php)\u304b\u3089\u306e\u901a\u4fe1\u3092\u8a31\u53ef\u3059\u308b\u3088\u3046\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30fc\u30dd\u30ea\u30b7\u30fc\u3092\u5909\u66f4\u3059\u308b\u304b\u3001SELinux \u3092\u7121\u52b9(Permissive \u3042\u308b\u3044\u306f Disable) \u306b\u3059\u308b\u3068\u89e3\u6d88\u3057\u307e\u3059\u3002\n# setsebool -P httpd_can_network_connect 1\n\n\n\u307e\u3068\u3081\nrpm \u30d1\u30c3\u30b1\u30fc\u30b8\u3068\u3001\u5bfe\u5fdc\u3059\u308b glibc \u3084 libmysqlclient\u3001libcurl \u3092\u89e3\u3044\u3066\u914d\u7f6e\u3057\u3066\u3001\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30ea\u30f3\u30ab\u306b\u3001\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u30d1\u30b9\u3092\u6307\u5b9a\u3057\u3066\u30ed\u30fc\u30c9\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u547c\u3073\u51fa\u3059\u3088\u3046\u306b\u3059\u308c\u3070\u3001\u554f\u984c\u306a\u304f\u52d5\u4f5c\u3059\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\n\u5c55\u958b\u304c\u5fc5\u8981\u306a CentOS 7 \u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\nglibc-2.17-105.el7.x86_64.rpm\nlibcurl-7.29.0-25.el7.centos.x86_64.rpm\nmariadb-libs-5.5.44-2.el7.centos.x86_64.rpm\nnet-snmp-libs-5.7.2-24.el7.x86_64.rpm\n\nWeb GUI \u306f\u30012.2 \u3084 2.4 \u306e\u6642\u3068\u540c\u69d8\u306e\u8a2d\u5b9a\u3067\u5bfe\u5fdc\u53ef\u80fd\u3067\u3059\u3002\n\u4eca\u56de\u306f\u3001\u5b9f\u884c\u3067\u304d\u308b\u74b0\u5883\u3092\u3001\u529b\u696d\u3067\u3064\u304f\u308a\u307e\u3057\u305f\u304c\u3001SRPM \u304b\u3089\u3082\u3001spec \u30d5\u30a1\u30a4\u30eb\u3092\u5c11\u3057\u4fee\u6b63\u3059\u308c\u3070\u30d3\u30eb\u30c9\u3067\u304d\u307e\u3057\u305f\u3002\u3053\u306e\u3053\u3068\u306f\u3001CentOS6 \u3067 Zabbix 3.0 \u3092\u52d5\u304b\u3059 (\u81ea\u529b\u30d3\u30eb\u30c9\u7de8) \u3067\u53d6\u308a\u4e0a\u3052\u307e\u3059\u3002\n\n\u88dc\u8db3\nPatchELF \u3092\u4f7f\u7528\u3059\u308b\u3068 INTERP \u30bb\u30af\u30b7\u30e7\u30f3\u3092\u5909\u66f4\u3067\u304d\u308b\u306e\u3067\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n$ wget http://nixos.org/releases/patchelf/patchelf-0.8/patchelf-0.8.tar.bz2\n$ tar xvfa patchelf-0.8.tar.bz2\n\n$ ./configure --prefix=/usr/local\nchecking for a BSD-compatible install... /usr/bin/install -c\nchecking whether build environment is sane... yes\nchecking for a thread-safe mkdir -p... /bin/mkdir -p\nchecking for gawk... gawk\nchecking whether make sets $(MAKE)... yes\nchecking for style of include used by make... GNU\nchecking for gcc... gcc\nchecking whether the C compiler works... yes\nchecking for C compiler default output file name... a.out\nchecking for suffix of executables...\nchecking whether we are cross compiling... no\nchecking for suffix of object files... o\nchecking whether we are using the GNU C compiler... yes\nchecking whether gcc accepts -g... yes\nchecking for gcc option to accept ISO C89... none needed\nchecking dependency style of gcc... gcc3\nchecking whether gcc and cc understand -c and -o together... yes\nchecking for g++... no\nchecking for c++... no\nchecking for gpp... no\nchecking for aCC... no\nchecking for CC... no\nchecking for cxx... no\nchecking for cc++... no\nchecking for cl.exe... no\nchecking for FCC... no\nchecking for KCC... no\nchecking for RCC... no\nchecking for xlC_r... no\nchecking for xlC... no\nchecking whether we are using the GNU C++ compiler... no\nchecking whether g++ accepts -g... no\nchecking dependency style of g++... none\nchecking that generated files are newer than configure... done\nconfigure: creating ./config.status\nconfig.status: creating Makefile\nconfig.status: creating src/Makefile\nconfig.status: creating tests/Makefile\nconfig.status: creating patchelf.spec\nconfig.status: executing depfiles commands\n\n$ make\nMaking all in src\nmake[1]: Entering directory `/src/patchelf-0.8/src'\nsource='patchelf.cc' object='patchelf.o' libtool=no \\\nDEPDIR=.deps depmode=none /bin/sh ../build-aux/depcomp \\\ng++ -DPACKAGE_NAME=\\\"patchelf\\\" -DPACKAGE_TARNAME=\\\"patchelf\\\" -DPACKAGE_VERSION=\\\"0.8\\\" -DPACKAGE_STRING=\\\"patchelf\\ 0.8\\\" -DPACKAGE_BUGREPORT=\\\"\\\" -DPACKAGE_URL=\\\"\\\" -DPACKAGE=\\\"patchelf\\\" -DVERSION=\\\"0.8\\\" -I.      -c -o patchelf.o patchelf.cc\n../build-aux/depcomp: line 761: exec: g++: not found\nmake[1]: *** [patchelf.o] Error 127\nmake[1]: Leaving directory `/src/patchelf-0.8/src'\nmake: *** [all-recursive] Error 1\n\n\u30d3\u30eb\u30c9\u306b g++ \u304c\u5fc5\u8981\u3067\u3057\u305f\u3002configure \u3067\u30a8\u30e9\u30fc\u3092\u51fa\u3057\u3066\u3088\u3002\n$ sudo yum install gcc-c++\n\n$ ./configure --prefix=/usr/local\nchecking for a BSD-compatible install... /usr/bin/install -c\nchecking whether build environment is sane... yes\nchecking for a thread-safe mkdir -p... /bin/mkdir -p\nchecking for gawk... gawk\nchecking whether make sets $(MAKE)... yes\nchecking for style of include used by make... GNU\nchecking for gcc... gcc\nchecking whether the C compiler works... yes\nchecking for C compiler default output file name... a.out\nchecking for suffix of executables...\nchecking whether we are cross compiling... no\nchecking for suffix of object files... o\nchecking whether we are using the GNU C compiler... yes\nchecking whether gcc accepts -g... yes\nchecking for gcc option to accept ISO C89... none needed\nchecking dependency style of gcc... gcc3\nchecking whether gcc and cc understand -c and -o together... yes\nchecking for g++... g++\nchecking whether we are using the GNU C++ compiler... yes\nchecking whether g++ accepts -g... yes\nchecking dependency style of g++... gcc3\nchecking that generated files are newer than configure... done\nconfigure: creating ./config.status\nconfig.status: creating Makefile\nconfig.status: creating src/Makefile\nconfig.status: creating tests/Makefile\nconfig.status: creating patchelf.spec\nconfig.status: executing depfiles commands\n\n$ make\nMaking all in src\nmake[1]: Entering directory `/src/patchelf-0.8/src'\ng++ -DPACKAGE_NAME=\\\"patchelf\\\" -DPACKAGE_TARNAME=\\\"patchelf\\\" -DPACKAGE_VERSION=\\\"0.8\\\" -DPACKAGE_STRING=\\\"patchelf\\ 0.8\\\" -DPACKAGE_BUGREPORT=\\\"\\\" -DPACKAGE_URL=\\\"\\\" -DPACKAGE=\\\"patchelf\\\" -DVERSION=\\\"0.8\\\" -I.     -g -O2 -MT patchelf.o -MD -MP -MF .deps/patchelf.Tpo -c -o patchelf.o patchelf.cc\nmv -f .deps/patchelf.Tpo .deps/patchelf.Po\ng++  -g -O2   -o patchelf patchelf.o\nmake[1]: Leaving directory `/src/patchelf-0.8/src'\nMaking all in tests\nmake[1]: Entering directory `/src/patchelf-0.8/tests'\nmake[1]: Nothing to be done for `all'.\nmake[1]: Leaving directory `/src/patchelf-0.8/tests'\nmake[1]: Entering directory `/src/patchelf-0.8'\nmake[1]: Nothing to be done for `all-am'.\nmake[1]: Leaving directory `/src/patchelf-0.8'\n\n$ sudo make install\nMaking install in src\nmake[1]: Entering directory `/src/patchelf-0.8/src'\nmake[2]: Entering directory `/src/patchelf-0.8/src'\n /bin/mkdir -p '/usr/local/bin'\n  /usr/bin/install -c patchelf '/usr/local/bin'\nmake[2]: Nothing to be done for `install-data-am'.\nmake[2]: Leaving directory `/src/patchelf-0.8/src'\nmake[1]: Leaving directory `/src/patchelf-0.8/src'\nMaking install in tests\nmake[1]: Entering directory `/src/patchelf-0.8/tests'\nmake[2]: Entering directory `/src/patchelf-0.8/tests'\nmake[2]: Nothing to be done for `install-exec-am'.\nmake[2]: Nothing to be done for `install-data-am'.\nmake[2]: Leaving directory `/src/patchelf-0.8/tests'\nmake[1]: Leaving directory `/src/patchelf-0.8/tests'\nmake[1]: Entering directory `/src/patchelf-0.8'\nmake[2]: Entering directory `/src/patchelf-0.8'\nmake[2]: Nothing to be done for `install-exec-am'.\n /bin/mkdir -p '/usr/local/share/doc/patchelf'\n /usr/bin/install -c -m 644 README '/usr/local/share/doc/patchelf'\n /bin/mkdir -p '/usr/local/share/man/man1'\n /usr/bin/install -c -m 644 patchelf.1 '/usr/local/share/man/man1'\nmake[2]: Leaving directory `/src/patchelf-0.8'\nmake[1]: Leaving directory `/src/patchelf-0.8'\n\n\u3067\u304d\u305f\n$ /usr/local/bin/patchelf\nsyntax: /usr/local/bin/patchelf\n  [--set-interpreter FILENAME]\n  [--print-interpreter]\n  [--set-rpath RPATH]\n  [--shrink-rpath]\n  [--print-rpath]\n  [--force-rpath]\n  [--remove-needed LIBRARY]\n  [--debug]\n  [--version]\n  FILENAME\n\n\u3088\u3057\u3002\n$ sudo /usr/local/bin/patchelf  --set-interpreter /opt/zabbix/lib64/ld-linux-x86-64.so.2 --set-rpath /opt/zabbix/lib64:/opt/zabbix/usr/lib64:/opt/zabbix/usr/lib64/mysql /opt/zabbix/usr/bin/zabbix_get\n\n$ /opt/zabbix/usr/bin/zabbix_get -h\nusage:\n  zabbix_get -s host-name-or-IP [-p port-number] [-I IP-address] -k item-key\n  zabbix_get -s host-name-or-IP [-p port-number] [-I IP-address]\n                --tls-connect cert --tls-ca-file CA-file\n                [--tls-crl-file CRL-file] [--tls-agent-cert-issuer cert-issuer]\n                [--tls-agent-cert-subject cert-subject]\n                --tls-cert-file cert-file --tls-key-file key-file -k item-key\n  zabbix_get -s host-name-or-IP [-p port-number] [-I IP-address]\n                --tls-connect psk --tls-psk-identity PSK-identity\n                --tls-psk-file PSK-file -k item-key\n  zabbix_get -h\n  zabbix_get -V\n\nGet data from Zabbix agent.\n\nGeneral options:\n  -s --host host-name-or-IP  Specify host name or IP address of a host\n  -p --port port-number      Specify port number of agent running on the host\n                             (default: 10050)\n  -I --source-address IP-address   Specify source IP address\n\n  -k --key item-key          Specify key of the item to retrieve value for\n\n  -h --help                  Display this help message\n  -V --version               Display version number\n\nTLS connection options:\n  --tls-connect value        How to connect to agent. Values:\n                               unencrypted - connect without encryption\n                                             (default)\n                               psk         - connect using TLS and a pre-shared\n                                             key\n                               cert        - connect using TLS and a\n                                             certificate\n\n  --tls-ca-file CA-file      Full pathname of a file containing the top-level\n                             CA(s) certificates for peer certificate\n                             verification\n\n  --tls-crl-file CRL-file    Full pathname of a file containing revoked\n                             certificates\n\n  --tls-agent-cert-issuer cert-issuer   Allowed agent certificate issuer\n\n  --tls-agent-cert-subject cert-subject   Allowed agent certificate subject\n\n  --tls-cert-file cert-file  Full pathname of a file containing the certificate\n                             or certificate chain\n\n  --tls-key-file key-file    Full pathname of a file containing the private key\n\n  --tls-psk-identity PSK-identity   Unique, case sensitive string used to\n                             identify the pre-shared key\n\n  --tls-psk-file PSK-file    Full pathname of a file containing the pre-shared\n                             key\n\nExample(s):\n  zabbix_get -s 127.0.0.1 -p 10050 -k \"system.cpu.load[all,avg1]\"\n\n  zabbix_get -s 127.0.0.1 -p 10050 -k \"system.cpu.load[all,avg1]\" \\\n    --tls-connect cert --tls-ca-file /home/zabbix/zabbix_ca_file \\\n    --tls-agent-cert-issuer \\\n    \"CN=Signing CA,OU=IT operations,O=Example Corp,DC=example,DC=com\" \\\n    --tls-agent-cert-subject \\\n    \"CN=server1,OU=IT operations,O=Example Corp,DC=example,DC=com\" \\\n    --tls-cert-file /home/zabbix/zabbix_get.crt \\\n    --tls-key-file /home/zabbix/zabbix_get.key\n\n  zabbix_get -s 127.0.0.1 -p 10050 -k \"system.cpu.load[all,avg1]\" \\\n    --tls-connect psk --tls-psk-identity \"PSK ID Zabbix agentd\" \\\n    --tls-psk-file /home/zabbix/zabbix_agentd.psk\n\nReport bugs to: <https://support.zabbix.com>\nZabbix home page: <http://www.zabbix.com>\nDocumentation: <https://www.zabbix.com/documentation>\n\n\u3053\u308c\u3067\u30e9\u30c3\u30d1\u30fc\u3082\u4e0d\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\u4ed6\u306e\u30ed\u30fc\u30c9\u30e2\u30b8\u30e5\u30fc\u30eb\u3082\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\n$ sudo /usr/local/bin/patchelf  --set-interpreter /opt/zabbix/lib64/ld-linux-x86-64.so.2 --set-rpath /opt/zabbix/lib64:/opt/zabbix/usr/lib64:/opt/zabbix/usr/lib64/mysql /opt/zabbix/usr/bin/zabbix_sender\n\n$ /opt/zabbix/usr/bin/zabbix_sender -h | head\nusage:\n  zabbix_sender [-v] -z server [-p port] [-I IP-address] -s host -k key\n                -o value\n  zabbix_sender [-v] -z server [-p port] [-I IP-address] [-s host] [-T] [-r]\n                -i input-file\n  zabbix_sender [-v] -c config-file [-z server] [-p port] [-I IP-address]\n                [-s host] -k key -o value\n  zabbix_sender [-v] -c config-file [-z server] [-p port] [-I IP-address]\n                [-s host] [-T] [-r] -i input-file\n  zabbix_sender [-v] -z server [-p port] [-I IP-address] -s host\n\n$ sudo /usr/local/bin/patchelf  --set-interpreter /opt/zabbix/lib64/ld-linux-x86-64.so.2 --set-rpath /opt/zabbix/lib64:/opt/zabbix/usr/lib64:/opt/zabbix/usr/lib64/mysql /opt/zabbix/usr/sbin/zabbix_server_mysql\n\n$ /opt/zabbix/usr/sbin/zabbix_server_mysql -h | head\nusage:\n  zabbix_server_mysql [-c config-file]\n  zabbix_server_mysql [-c config-file] -R runtime-option\n  zabbix_server_mysql -h\n  zabbix_server_mysql -V\n\nThe core daemon of Zabbix software.\n\nOptions:\n  -c --config config-file        Absolute path to the configuration file\n\n$ sudo /usr/local/bin/patchelf  --set-interpreter /opt/zabbix/lib64/ld-linux-x86-64.so.2 --set-rpath /opt/zabbix/lib64:/opt/zabbix/usr/lib64:/opt/zabbix/usr/lib64/mysql /opt/zabbix/usr/sbin/zabbix_agentd\n\n$ /opt/zabbix/usr/sbin/zabbix_agentd -h | head\nusage:\n  zabbix_agentd [-c config-file]\n  zabbix_agentd [-c config-file] -p\n  zabbix_agentd [-c config-file] -t item-key\n  zabbix_agentd [-c config-file] -R runtime-option\n  zabbix_agentd -h\n  zabbix_agentd -V\n\nA Zabbix daemon for monitoring of various server parameters.\n\n\nOK!\n# \u529b\u6280\u3067\u52d5\u304b\u3059\n\nCentOS6 \u3067 Zabbix 3.0 \u3092\u52d5\u304b\u3059\u5b9f\u9a13\u306e\u8a18\u9332\u3067\u3059\u3002MySQL \u7528\u3092\u4f7f\u3063\u3066\u5b9f\u9a13\u3057\u307e\u3057\u305f\u3002\n\n\u691c\u8a3c\u306f CentOS 6.7 \u3067\u884c\u3044\u307e\u3057\u305f\u3002\n\nrpm \u30d1\u30c3\u30b1\u30fc\u30b8\u3068\u3001\u5bfe\u5fdc\u3059\u308b glibc \u3084 libmysqlclient\u3001libcurl \u3092\u307b\u3069\u3044\u3066\u914d\u7f6e\u3057\u3066\u52d5\u304b\u3059\u65b9\u6cd5\u3067\u3059\u3002\u30bd\u30fc\u30b9\u304b\u3089\u306e\u30d3\u30eb\u30c9\u306f\u4e0d\u8981\u3067\u3059\u304c\u3001\u5fc5\u8981\u3068\u306a\u308b glibc \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u5408\u308f\u306a\u3044\u305f\u3081\u3001\u304b\u306a\u308a\u5f37\u5f15\u306a\u65b9\u6cd5\u3067\u5b9f\u73fe\u3057\u3066\u3044\u307e\u3059\u3002\n\n[CentOS6 \u3067 Zabbix 3.0 \u3092\u52d5\u304b\u3059 (\u81ea\u529b\u30d3\u30eb\u30c9\u7de8)] (http://qiita.com/items/b6b7adc914a3ca8ad0cb) \u3082\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\n## \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5165\u624b\u3059\u308b\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u76f4\u63a5\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3057\u305f\u3002\n\nzabbix-agent-3.0.1-1.el7.x86_64.rpm\nzabbix-get-3.0.1-1.el7.x86_64.rpm\nzabbix-java-gateway-3.0.1-1.el7.x86_64.rpm\nzabbix-proxy-mysql-3.0.1-1.el7.x86_64.rpm\nzabbix-sender-3.0.1-1.el7.x86_64.rpm\nzabbix-server-mysql-3.0.1-1.el7.x86_64.rpm\nzabbix-web-3.0.1-1.el7.noarch.rpm\nzabbix-web-japanese-3.0.1-1.el7.noarch.rpm\nzabbix-web-mysql-3.0.1-1.el7.noarch.rpm\n\n\u4eca\u56de\u306f\u5b9f\u9a13\u306e\u305f\u3081\u306b\u4e00\u901a\u308a\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3057\u305f\u304c\u3001zabbix-server-mysql \u3068 zabbix-web \u306e\u4e00\u9023\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u4ee5\u5916\u306f RHEL6/CentOS6 \u7528\u306e\u3082\u306e\u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n## MySQL\n\nremi \u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5c0e\u5165\u3057\u307e\u3057\u305f\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\n* mysql-libs-5.5.48-1.el6.remi.x86_64\n* compat-mysql51-5.1.54-1.el6.remi.x86_64\n* mysql-5.5.48-1.el6.remi.x86_64\n* perl-DBD-MySQL-4.013-3.el6.x86_64\n* mysql-server-5.5.48-1.el6.remi.x86_64\n\n## \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u307b\u3069\u3044\u3066\u914d\u7f6e\n\nrpm \u30d1\u30c3\u30b1\u30fc\u30b8\u3068\u3001\u5bfe\u5fdc\u3059\u308b glibc \u3084 libmysqlclient\u3001libcurl \u3092\u89e3\u3044\u3066\u914d\u7f6e\u3057\u307e\u3059\u3002\n\u914d\u7f6e\u5148\u3092 /opt/zabbix \u3068\u3057\u307e\u3059\u3002\n\n~~~\n# mkdir /opt/zabbix\n# rpm2cpio zabbix-server-mysql-3.0.1-1.el7.x86_64.rpm | (cd /opt/zabbix && cpio -idmvu)\n# rpm2cpio zabbix-agent-3.0.1-1.el7.x86_64.rpm | (cd /opt/zabbix && cpio -idmvu)\n# rpm2cpio zabbix-get-3.0.1-1.el7.x86_64.rpm | (cd /opt/zabbix && cpio -idmvu)\n# rpm2cpio zabbix-sender-3.0.1-1.el7.x86_64.rpm | (cd /opt/zabbix && cpio -idmvu)\n~~~\n\n\n## \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u4f5c\u6210\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068\u63a5\u7d9a\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306f\u3001\u30e6\u30fc\u30b6\u540d zabbix \u30d1\u30b9\u30ef\u30fc\u30c9 zabbix \u3067\u306e\u4f8b\u3067\u3059\u3002\n\n~~~\n$ mysql -uroot -p\nEnter password:\nmysql> create database zabbix character set utf8 collate utf8_bin;\nmysql> grant all privileges on zabbix.* to zabbix@localhost identified by 'zabbix';\nmysql> quit;\n$ gzip -dc /opt/zabbix/usr/share/doc/zabbix-server-mysql-3.0.1/create.sql.gz |\nmysql -uzabbix -pzabbix zabbix \n~~~\n\n\n## \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u5f35\u3063\u3066\u304a\u304d\u307e\u3059\u3002\n\n~~~\n# ln -s /opt/zabbix/etc/zabbix /etc/zabbix\n~~~\n\n~~~\n# ln -s /opt/usr/lib/zabbix/alertscripts /usr/lib/zabbix/alertscripts\n# ln -s /opt/usr/lib/zabbix/externalscripts /usr/lib/zabbix/externalscripts\n~~~\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4fee\u6b63\u3057\u307e\u3059\u3002\n\n```zabbix_server.conf.patch\ndiff -u zabbix_server.conf zabbix_server.conf\n--- zabbix_server.conf- 2016-02-28 16:23:55.000000000 +0900\n+++ zabbix_server.conf  2016-03-02 15:50:50.000000000 +0900\n@@ -114,6 +114,8 @@\n # Default:\n # DBPassword=\n\n+DBPassword=zabbix\n+\n ### Option: DBSocket\n #      Path to MySQL socket.\n #\n@@ -121,6 +123,8 @@\n # Default:\n # DBSocket=/tmp/mysql.sock\n\n+DBSocket=/var/lib/mysql/mysql.sock\n+\n ### Option: DBPort\n #      Database port when not using local socket. Ignored for SQLite.\n #\n```\n\n~~~\n# chown zabbix /etc/zabbix/zabbix_server.conf\n# chmod 640 /etc/zabbix/zabbix_server.conf\n~~~\n\n## \u5171\u6709\u30e9\u30a4\u30d6\u30e9\u30ea\n\n\u5171\u6709\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u8db3\u308a\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u30c1\u30a7\u30c3\u30af\u3057\u307e\u3059\u3002\n\n~~~\n$ ldd /opt/zabbix/usr/sbin/zabbix_server_mysql\n/opt/zabbix/usr/sbin/zabbix_server_mysql: /lib64/libc.so.6: version `GLIBC_2.15' not found (required by /opt/zabbix/usr/sbin/zabbix_server_mysql)\n/opt/zabbix/usr/sbin/zabbix_server_mysql: /lib64/libc.so.6: version `GLIBC_2.17' not found (required by /opt/zabbix/usr/sbin/zabbix_server_mysql)\n/opt/zabbix/usr/sbin/zabbix_server_mysql: /lib64/libc.so.6: version `GLIBC_2.14' not found (required by /opt/zabbix/usr/sbin/zabbix_server_mysql)\n        linux-vdso.so.1 =>  (0x00007ffc81169000)\n        libmysqlclient.so.18 => /usr/lib64/mysql/libmysqlclient.so.18 (0x00007fb896437000)\n        libiksemel.so.3 => /usr/lib64/libiksemel.so.3 (0x00007fb896229000)\n        libxml2.so.2 => /usr/lib64/libxml2.so.2 (0x00007fb895ed6000)\n        libodbc.so.2 => /usr/lib64/libodbc.so.2 (0x00007fb895c6f000)\n        libnetsnmp.so.31 => not found\n        libssh2.so.1 => /usr/lib64/libssh2.so.1 (0x00007fb895a46000)\n        libOpenIPMI.so.0 => /usr/lib64/libOpenIPMI.so.0 (0x00007fb89573e000)\n        libOpenIPMIposix.so.0 => /usr/lib64/libOpenIPMIposix.so.0 (0x00007fb895539000)\n        libssl.so.10 => /usr/lib64/libssl.so.10 (0x00007fb8952cc000)\n        libcrypto.so.10 => /usr/lib64/libcrypto.so.10 (0x00007fb894ee8000)\n        libldap-2.4.so.2 => /lib64/libldap-2.4.so.2 (0x00007fb894c98000)\n        liblber-2.4.so.2 => /lib64/liblber-2.4.so.2 (0x00007fb894a88000)\n        libcurl.so.4 => /usr/lib64/libcurl.so.4 (0x00007fb894822000)\n        libm.so.6 => /lib64/libm.so.6 (0x00007fb89459e000)\n        libdl.so.2 => /lib64/libdl.so.2 (0x00007fb894399000)\n        libresolv.so.2 => /lib64/libresolv.so.2 (0x00007fb89417f000)\n        libc.so.6 => /lib64/libc.so.6 (0x00007fb893deb000)\n        libpthread.so.0 => /lib64/libpthread.so.0 (0x00007fb893bcd000)\n        libz.so.1 => /lib64/libz.so.1 (0x00007fb8939b7000)\n        librt.so.1 => /lib64/librt.so.1 (0x00007fb8937af000)\n        libstdc++.so.6 => /usr/lib64/libstdc++.so.6 (0x00007fb8934a8000)\n        libgcc_s.so.1 => /lib64/libgcc_s.so.1 (0x00007fb893292000)\n        libgnutls.so.26 => /usr/lib64/libgnutls.so.26 (0x00007fb892fef000)\n        libgcrypt.so.11 => /lib64/libgcrypt.so.11 (0x00007fb892d79000)\n        libgpg-error.so.0 => /lib64/libgpg-error.so.0 (0x00007fb892b75000)\n        libltdl.so.7 => /usr/lib64/libltdl.so.7 (0x00007fb89296c000)\n        libOpenIPMIutils.so.0 => /usr/lib64/libOpenIPMIutils.so.0 (0x00007fb892763000)\n        libncurses.so.5 => /lib64/libncurses.so.5 (0x00007fb892541000)\n        libgdbm.so.2 => /usr/lib64/libgdbm.so.2 (0x00007fb89233b000)\n        libgssapi_krb5.so.2 => /lib64/libgssapi_krb5.so.2 (0x00007fb8920f6000)\n        libkrb5.so.3 => /lib64/libkrb5.so.3 (0x00007fb891e0f000)\n        libcom_err.so.2 => /lib64/libcom_err.so.2 (0x00007fb891c0b000)\n        libk5crypto.so.3 => /lib64/libk5crypto.so.3 (0x00007fb8919de000)\n        libsasl2.so.2 => /usr/lib64/libsasl2.so.2 (0x00007fb8917c4000)\n        libssl3.so => /usr/lib64/libssl3.so (0x00007fb891584000)\n        libsmime3.so => /usr/lib64/libsmime3.so (0x00007fb891357000)\n        libnss3.so => /usr/lib64/libnss3.so (0x00007fb891018000)\n        libnssutil3.so => /usr/lib64/libnssutil3.so (0x00007fb890dec000)\n        libplds4.so => /lib64/libplds4.so (0x00007fb890be7000)\n        libplc4.so => /lib64/libplc4.so (0x00007fb8909e2000)\n        libnspr4.so => /lib64/libnspr4.so (0x00007fb8907a4000)\n        libidn.so.11 => /lib64/libidn.so.11 (0x00007fb890571000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007fb89691f000)\n        libtasn1.so.3 => /usr/lib64/libtasn1.so.3 (0x00007fb890361000)\n        libtinfo.so.5 => /lib64/libtinfo.so.5 (0x00007fb89013f000)\n        libkrb5support.so.0 => /lib64/libkrb5support.so.0 (0x00007fb88ff34000)\n        libkeyutils.so.1 => /lib64/libkeyutils.so.1 (0x00007fb88fd31000)\n        libcrypt.so.1 => /lib64/libcrypt.so.1 (0x00007fb88faf9000)\n        libselinux.so.1 => /lib64/libselinux.so.1 (0x00007fb88f8da000)\n        libfreebl3.so => /lib64/libfreebl3.so (0x00007fb88f6d6000)\n~~~\n\nRHEL7/CentOS7 \u7528\u306b\u30d3\u30eb\u30c9\u3055\u308c\u305f Zabbix 3.0 \u306f glibc 2.17 \u3092\u8981\u6c42\u3057\u307e\u3059\u3002\n\u307e\u305f libnetsnmp.so.31 \u304c not found \u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\nCentOS7 \u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304d\u307e\u3059\u3002\n\u307e\u305f\u3001curl \u3082 CentOS6 \u3082\u306e\u306f\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u53e4\u304f SMTP AUTH \u304c\u4f7f\u3048\u306a\u3044\u305f\u3081\u3053\u3061\u3089\u3082\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304d\u307e\u3059\u3002\n\n\n\u5148\u307b\u3069\u3068\u540c\u69d8\u306b\u5c55\u958b\u3057\u307e\u3059\u3002\n\n~~~\n# rpm2cpio glibc-2.17-105.el7.x86_64.rpm | (cd /opt/zabbix && cpio -idmvu)\n# net-snmp-libs-5.7.2-24.el7.x86_64.rpm | (cd /opt/zabbix && cpio -idmvu)\n# rpm2cpio libcurl-7.29.0-25.el7.centos.x86_64.rpm | (cd /opt/zabbix && cpio -idmvu)\n~~~\n\n## \u3072\u3068\u307e\u305a\u5b9f\u884c\u3057\u3066\u307f\u308b\n\n\u8d77\u52d5\u3067\u304d\u308b\u304b\u3069\u3046\u304b\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\n~~~\n$ LD_LIBRARY_PATH=/opt/zabbix/lib64:/opt/zabbix/usr/lib64 /opt/zabbix/usr/sbin/zabbix_server_mysql -h\n/opt/zabbix/usr/sbin/zabbix_server_mysql: relocation error: /opt/zabbix/lib64/libc.so.6: symbol _dl_starting_up, version GLIBC_PRIVATE not defined in file ld-linux-x86-64.so.2 with link time reference\n~~~\n\n\u8d77\u52d5\u6642\u306b\u4f7f\u7528\u3059\u308b\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30ea\u30f3\u30ab\u30fc ld-linux-x86-64.so.2 \u304c\u5408\u3063\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\nCentOS6 \u3068 CentOS7 \u3067\u306f\u3001glibc \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u7570\u306a\u308a\u307e\u3059\u3002\nCentOS6 \u306e glibc \u306f 2.12 CentOS7 \u306e glibc \u306f 2.17 \u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u3053\u306e\u305f\u3081\u3001rpm \u30d1\u30c3\u30b1\u30fc\u30b8\u3068\u3001\u5bfe\u5fdc\u3059\u308b glibc \u3084 libmysqlclient\u3001libcurl \u3092\u89e3\u3044\u3066\u914d\u7f6e\u3057\u3066\u3001\u74b0\u5883\u5909\u6570 LD_LIBRARY_PATH \u3092\u8a2d\u5b9a\u3057\u305f\u3060\u3051\u3067\u306f\u3046\u307e\u304f\u8d77\u52d5\u3067\u304d\u307e\u305b\u3093\u3002\n\nglibc \u306e\u5834\u5408\u3001libc-2.XX.so \u3068\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30ea\u30f3\u30ab\u30fc ld-2.XX.so \u3068\u304c\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001\u8d77\u52d5\u6642\u306b\u4f7f\u7528\u3055\u308c\u308b\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30ea\u30f3\u30ab\u30fc\u306f\u3001\u30ed\u30fc\u30c9-\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3068\u304d\u306b\u3001libc.so \u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u304c\u30d7\u30ed\u30b0\u30e9\u30e0\u30d8\u30c3\u30c0\u306e INTERP \u306b\u57cb\u3081\u8fbc\u307e\u308c\u307e\u3059\u3002\n\n```/usr/lib64/libc.so\n/* GNU ld script\n   Use the shared library, but some functions are only in\n   the static library, so try that secondarily.  */\nOUTPUT_FORMAT(elf64-x86-64)\nGROUP ( /lib64/libc.so.6 /usr/lib64/libc_nonshared.a  AS_NEEDED ( /lib64/ld-linux-x86-64.so.2 ) )\n```\n\n~~~\n$ readelf  -l -S   /opt/zabbix/usr/sbin/zabbix_server_mysql  | sed -n '/Program Headers:/,/program interpreter/p'\nProgram Headers:\n  Type           Offset             VirtAddr           PhysAddr\n                 FileSiz            MemSiz              Flags  Align\n  PHDR           0x0000000000000040 0x0000000000400040 0x0000000000400040\n                 0x00000000000001f8 0x00000000000001f8  R E    8\n  INTERP         0x0000000000000238 0x0000000000400238 0x0000000000400238\n                 0x000000000000001c 0x000000000000001c  R      1\n      [Requesting program interpreter: /lib64/ld-linux-x86-64.so.2]\n~~~\n\n/lib64/ld-linux-x86-64.so.2 \u306f CentOS6 \u3067\u306f\u30012.12 \u7528\u306e\u3082\u306e\u306a\u306e\u3067\u3046\u307e\u304f\u8d77\u52d5\u3067\u304d\u307e\u305b\u3093\u3002\n\n\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30ea\u30f3\u30ab\u30fc\u306b\u306f\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u304c\u8d77\u52d5\u3055\u308c\u305f\u3068\u304d\u306b\u3001\u5fc5\u8981\u306a\u5171\u6709\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8aad\u307f\u8fbc\u3080\u30d8\u30eb\u30d1\u30fc\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u6a5f\u80fd\u306e\u307b\u304b\u306b\u3001\u30ed\u30fc\u30c9\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8d77\u52d5\u3059\u308b\u6a5f\u80fd\u304c\u3042\u308a\u307e\u3059\u3002\n\n~~~\nNAME\n       ld.so, ld-linux.so* - dynamic linker/loader\n\nSYNOPSIS\n       The dynamic linker can be run either indirectly by running some dynami\u2010\n       cally linked program or library (in which case no command-line  options\n       to  the  dynamic linker can be passed and, in the ELF case, the dynamic\n       linker which is stored in the .interp section of the  program  is  exe\u2010\n       cuted) or directly by running:\n\n       /lib/ld-linux.so.*  [OPTIONS] [PROGRAM [ARGUMENTS]]\n\nOPTIONS\n\n       --library-path PATH\n              Use PATH instead of LD_LIBRARY_PATH environment variable setting\n              (see below).\n~~~\n\n\n\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30ea\u30f3\u30ab ld-linux-x86-64.so.2 \u306b\u3001\u5171\u6709\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u691c\u7d22\u30d1\u30b9\u3092\u6307\u5b9a\u3057\u3066\u8d77\u52d5\u3057\u3001\u30ed\u30fc\u30c9\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u547c\u3073\u51fa\u3059\u3088\u3046\u306b\u3059\u308c\u3070\u554f\u984c\u306a\u304f\u52d5\u4f5c\u3057\u307e\u3059\u3002\n\n\u3084\u3063\u3066\u307f\u307e\u3059\u3002\n\n~~~\n$ /opt/zabbix/lib64/ld-linux-x86-64.so.2 --library-path /opt/zabbix/lib64:/opt/zabbix/usr/lib64 /opt/zabbix/usr/sbin/zabbix_server_mysql -h\nusage:\n  zabbix_server_mysql [-c config-file]\n  zabbix_server_mysql [-c config-file] -R runtime-option\n  zabbix_server_mysql -h\n  zabbix_server_mysql -V\n\nThe core daemon of Zabbix software.\n\nOptions:\n  -c --config config-file        Absolute path to the configuration file\n                                 (default: \"/etc/zabbix/zabbix_server.conf\")\n  -f --foreground                Run Zabbix server in foreground\n  -R --runtime-control runtime-option   Perform administrative functions\n\n    Runtime control options:\n      config_cache_reload        Reload configuration cache\n      housekeeper_execute        Execute the housekeeper\n      log_level_increase=target  Increase log level, affects all processes if\n                                 target is not specified\n      log_level_decrease=target  Decrease log level, affects all processes if\n                                 target is not specified\n\n      Log level control targets:\n        pid                      Process identifier\n        process-type             All processes of specified type (e.g., poller)\n        process-type,N           Process type and number (e.g., poller,3)\n\n  -h --help                      Display this help message\n  -V --version                   Display version number\n\nReport bugs to: <https://support.zabbix.com>\nZabbix home page: <http://www.zabbix.com>\nDocumentation: <https://www.zabbix.com/documentation>\n~~~\n\n\u3060\u3044\u3058\u3087\u3046\u3076\u306a\u3088\u3046\u3067\u3059\u3002\n\n\u8a3b) \u3053\u306e\u5b9f\u884c\u7d50\u679c\u3060\u3051\u3067\u306f\u308f\u304b\u308a\u307e\u305b\u3093\u304c\u3001\u3058\u3064\u306f libmysqlclient.so.18 \u306f CentOS7 \u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u3042\u308bMariaDB \u306e\u3082\u306e\u3092\u4f7f\u7528\u3057\u306a\u3044\u3068\u5b9f\u884c\u6642\u306b\u672a\u5b9a\u7fa9\u30b7\u30f3\u30dc\u30eb\u30a8\u30e9\u30fc\u304c\u51fa\u307e\u3059\u3002\u3053\u306e\u3053\u3068\u306b\u3064\u3044\u3066\u306f\u5f8c\u307b\u3069\u89e6\u308c\u307e\u3059\u3002\n\n## \u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\n\nCentOS7 \u3067\u306f systemd \u3092\u4f7f\u7528\u3059\u308b\u5f62\u306b\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3001\u65e7\u6765\u306e\u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u542b\u307e\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n\n\u305d\u3053\u3067 Zabbix 2.4 \u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u542b\u307e\u308c\u308b\u3082\u306e\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081\u3001\u30a2\u30fc\u30ab\u30a4\u30d6\u304b\u3089\u5c55\u958b\u3057\u307e\u3059\u3002\n\n~~~\n# rpm2cpio zabbix-server-2.4.7-1.el6.x86_64.rpm | (cd /opt/zabbix && cpio -idmvu ./etc/init.d/zabbix-server)\n# rpm2cpio zabbix-agent-2.4.7-1.el6.x86_64.rpm | (cd /opt/zabbix && cpio -idmvu\n./etc/init.d/zabbix-agent)\n~~~\n\nld-linux-x86-64.so.2 \u7d4c\u7531\u3067\u8d77\u52d5\u3059\u308b\u3088\u3046\u306b\u4fee\u6b63\u3057\u307e\u3059\u3002\n\n```zabbix-server.init.patch\n--- /opt/zabbix/etc/init.d/zabbix-server        2015-11-13 19:14:20.000000000 +0900\n+++ /opt/zabbix/etc/init.d/zabbix-server        2016-03-03 23:57:02.975726383 +0900\n@@ -18,11 +18,19 @@\n # Source function library.\n . /etc/rc.d/init.d/functions\n\n-if [ -x /usr/sbin/zabbix_server ]; then\n-    exec=zabbix_server\n+zroot=/opt/zabbix\n+if [ -x $zroot/usr/sbin/zabbix_server ]; then\n+    #exec=$zroot/usr/sbin/zabbix_server\n+    exec=$zroot/usr/sbin/zabbix_server_mysql\n else\n     exit 5\n fi\n+if [ -x $zroot/lib64/ld-linux-x86-64.so.2 ]; then\n+    ld_so=$zroot/lib64/ld-linux-x86-64.so.2\n+else\n+    exit 5\n+fi\n+library_path=$zroot/lib64:$zroot/usr/lib64\n\n prog=${exec##*/}\n conf=/etc/zabbix/zabbix_server.conf\n@@ -38,7 +46,7 @@\n start()\n {\n     echo -n $\"Starting Zabbix server: \"\n-    daemon $exec -c $conf\n+    LD_LIBRARY_PATH=$library_path $ld_so $exec -c $conf\n     rv=$?\n     echo\n     [ $rv -eq 0 ] && touch $lockfile\n```\n\n\n\u5b9f\u884c\u30e6\u30fc\u30b6 zabbix \u3068\u5b9f\u884c\u30b0\u30eb\u30fc\u30d7 zabbix \u3092\u4f5c\u6210\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n~~~\n# groupadd -g 119 zabbix\n# useradd -u 119 -g 119 -d /var/run/zabbix/ -s /bin/false zabbix \n~~~\n\n\u30ed\u30b0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n~~~\ninstall -o zabbix -g zabbix -d /var/log/zabbix\n~~~\n\n\u8d77\u52d5\u3057\u3066\u307f\u307e\u3059\u3002\n\n~~~\n# sh -x /opt/zabbix/etc/init.d/zabbix-server start\n~~~\n\n\u5b9f\u884c\u3057\u3066\u307f\u308b\u3068\u4e00\u898b\u30a8\u30e9\u30fc\u306f\u51fa\u306a\u3044\u3082\u306e\u306e\u3001\u8d77\u52d5\u3057\u305f\u30d7\u30ed\u30bb\u30b9\u304c\u3042\u308a\u307e\u305b\u3093\u3002zabbix_server.log \u3092\u898b\u308b\u3068\u672a\u89e3\u6c7a\u30b7\u30f3\u30dc\u30eb\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u3044\u307e\u3057\u305f\u3002\n\n```/var/log/zabbix/zabbix_server.log\n/opt/zabbix/usr/sbin/zabbix_server_mysql: relocation error: /opt/zabbix/usr/sbin/zabbix_server_mysql: symbol mysql_init, version libmysqlclient_18 not defined in file libmysqlclient.so.18 with link time reference\n```\n\nCentOS7 \u3067\u306f MariaDB \u3092\u4f7f\u7528\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3001libmysqlclient.so.18 \u306f CentOS7 \u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u3042\u308b MariaDB \u306e\u3082\u306e\u3092\u4f7f\u7528\u3057\u306a\u3044\u3068\u30c0\u30e1\u306a\u3088\u3046\u3067\u3059\u3002CentOS7 \u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304d\u3066\u5c55\u958b\u3057\u307e\u3059\u3002\n\n~~~\n# rpm2cpio mariadb-libs-5.5.44-2.el7.centos.x86_64.rpm | (cd /opt/zabbix && cpio -idmvu)\n~~~\n\n\u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u306e library_path \u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```zabbix-server.init.2.patch\n--- zabbix-server       2016-03-04 02:28:56.955721309 +0900\n+++ zabbix-server       2016-03-03 23:57:02.975726383 +0900\n@@ -30,7 +30,7 @@\n else\n     exit 5\n fi\n-library_path=$zroot/lib64:$zroot/usr/lib64\n+library_path=$zroot/lib64:$zroot/usr/lib64:$zroot/usr/lib64/mysql\n\n if [ ! -d /var/log/zabbix ]; then\n     install -o zabbix -g zabbix -d /var/log/zabbix\n```\n\n\u518d\u5ea6\u8d77\u52d5\u3057\u3066\u307f\u308b\u3068\u554f\u984c\u306a\u304f\u7acb\u3061\u4e0a\u304c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\nps \u3067\u898b\u308b\u3068\u3001ld-linux \u3070\u304b\u308a\u4e26\u3093\u3067\u4f55\u304c\u306a\u3093\u3060\u304b\u308f\u304b\u308a\u307e\u305b\u3093\u3002\n\n~~~\n$ ps axg | grep zabbix\n  366 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2 /opt/zabbix/usr/sbin/zabbix_server_mysql -c /etc/zabbix/zabbix_server.conf\n  371 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  372 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  373 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  374 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  375 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  376 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  377 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  378 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  379 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  380 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  381 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  382 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  383 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  384 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  385 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  389 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  390 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  391 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  392 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  393 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  394 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  395 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  406 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  407 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  408 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n  409 ?        S      0:00 /opt/zabbix/lib64/ld-linux-x86-64.so.2\n~~~\n\nargv[0] \u304c\u30ed\u30fc\u30c9\u30e2\u30b8\u30e5\u30fc\u30eb\u540d\u306b\u306a\u308b\u3088\u3046\u306b\u3057\u3066 exec \u3059\u308b\u30e9\u30c3\u30d1\u30fc\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\n\n```zwrapper.py\n#!/usr/bin/python\n\nimport sys\nimport os\n\nLD_SO = \"/opt/zabbix/lib64/ld-linux-x86-64.so.2\"\n\nZROOT = \"/opt/zabbix\"\nLIBRARY_PATH = [ \"/lib64\", \"/usr/lib64\", \"/usr/lib64/mysql\" ]\n\nif (len(sys.argv) < 1):\n    sys.exit(1)\n\n#os.environ[\"LD_LIBRARY_PATH\"] = ':'.join([ ZROOT + x for x in LIBRARY_PATH ])\n\nargs = [ sys.argv[0] ]\nargs.append(\"--library-path\")\nargs.append(':'.join([ ZROOT + x for x in LIBRARY_PATH ]))\n\nif (sys.argv[0][0] == '/'):\n    path = \"%s%s\" % (ZROOT, sys.argv[0])\n    args.append(path)\nelse:\n    path = \"%s/usr/bin/%s\" % (ZROOT, sys.argv[0])\n    if (os.access(path, os.X_OK)):\n        args.append(path)\n    else:\n        path = \"%s/usr/sbin/%s\" % (ZROOT, sys.argv[0])\n        if (os.access(path, os.X_OK)):\n            printf >>stderr, \"%s: not found\\n\" % sys.argv[0]\n            sys.exit(1)\n        args.append(path)\nargs.extend(sys.argv[1:])\nos.execv(LD_SO, args)\n```\n\n\u3053\u306e\u30e9\u30c3\u30d1\u30fc\u306f /usr/sbin/zabbix_server_mysql \u3068\u3057\u3066\u914d\u7f6e\u3057\u3066\u3001\u3053\u3061\u3089\u3092\u8d77\u52d5\u3059\u308b\u3068\u3001/opt/zabbix/usr/sbin/zabbix_server_mysql_ \u3092\u8d77\u52d5\u3057\u3066\u3001\u30d7\u30ed\u30bb\u30b9\u540d\u304c /usr/sbin/zabbix_server_mysql \u3068\u3057\u3066\u898b\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002 \n\n\u8a3b\uff09\u901a\u5e38\u30d7\u30ed\u30bb\u30b9\u540d\u306f Zabbix \u5074\u3067\u5f79\u5272\u3092\u8868\u3059\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u3089\u308c\u308b\u306e\u3067\u3059\u304c\u3001ld-linux \u7d4c\u7531\u3067\u30ed\u30fc\u30c9\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8d77\u52d5\u3057\u305f\u3068\u304d\u306f\u3001\u66f8\u304d\u63db\u3048\u304c\u3067\u304d\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\n~~~\n$ ps axg | grep zabbix\n 3840 ?        S      0:00 /usr/sbin/zabbix_server_mysql --library-path /opt/zabbix/lib64:/opt/zabbix/usr/lib64:/opt/zabbix/usr/lib64/mysql /opt/zabbix/usr/sbin/zabbix_server_mysql\n 3845 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3846 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3847 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3848 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3849 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3850 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3851 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3852 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3853 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3854 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3855 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3856 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3857 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3858 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3859 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3860 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3861 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3862 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3863 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3870 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3871 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3872 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3873 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3874 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3875 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3876 ?        S      0:00 /usr/sbin/zabbix_server_mysql\n 3894 pts/1    S+     0:00 grep zabbix\n~~~\n\n\n##### \u30ce\u30fc\u30c8\n\nLD_LIBRARY_PATH \u3092\u6307\u5b9a\u3057\u3066\u3001ld-linux-x86-64.so.2 \u3092\u8d77\u52d5\u3059\u308b\u3068\u3001zabbix_server \u304b\u3089\u8d77\u52d5\u3055\u308c\u308b\u5b50\u30d7\u30ed\u30bb\u30b9\u306b\u3082\u3053\u306e\u74b0\u5883\u5909\u6570\u304c\u6e21\u3063\u3066\u3057\u307e\u3044\u3001\u5b50\u30d7\u30ed\u30bb\u30b9\u306e\u8d77\u52d5\u306b\u5931\u6557\u3057\u307e\u3059\u3002\n\n\u305f\u3068\u3048\u3070\u3001zabbix_agentd \u3092 LD_LIBRARY_PATH \u3092\u6307\u5b9a\u3059\u308b\u65b9\u6cd5\u3067\u8d77\u52d5\u3059\u308b\u3068\u3001zabbix_agentd \u305d\u306e\u3082\u306e\u306f\u52d5\u304f\u306e\u3067\u3059\u304c\u3001UserParameter \u3067\u6307\u5b9a\u3057\u305f\u5916\u90e8\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u8d77\u52d5\u306b\u5931\u6557\u3057\u307e\u3059\u3002\n\n~~~~\n$ zabbix_get -s 127.0.0.1 -k mysql.version\nsh: relocation error: /opt/zabbix/lib64/libc.so.6: symbol _dl_starting_up, version GLIBC_PRIVATE not defined in file ld-linux-x86-64.so.2 with link time reference\n~~~\n\n\u3053\u306e\u4f8b\u306e relocation error \u306f\u3001 zabbix_agentd \u304c `execl(\"/bin/sh\", \"sh\", \"-c\", command, NULL);` \u3067\u5b50\u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3057\u3088\u3046\u3068\u3057\u3066 /bin/sh \u304c\u30a8\u30e9\u30fc\u3092\u51fa\u3057\u305f\u3082\u306e\u3067\u3059\u3002\n\n\u6700\u521d\u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u306f\u3001`LD_LIBRARY_PATH` \u3092\u6307\u5b9a\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u30e9\u30c3\u30d1\u30fc\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u306f `--library-path` \u5f15\u6570\u3067\u6307\u5b9a\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n## \u30e9\u30c3\u30d1\u30fc\u306e\u914d\u7f6e\u3068\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u306e\u4f5c\u6210\n\n\u4eca\u56de\u306f rpm2cpio \u3067\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5c55\u958b\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u672c\u6765\u3067\u3042\u308c\u3070\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u306b\n\n~~~\n/usr/sbin/update-alternatives --install /usr/sbin/zabbix_server \\\n        zabbix-server /usr/sbin/zabbix_server_mysql 10\n~~~\n\n\u304c\u5b9f\u884c\u3055\u308c\u3066\u3001`/usr/sbin/zabbix_server` \u306f `/usr/sbin/zabbix_server_mysql` \u3092\u6307\u3059\u3088\u3046\u306b\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u304c\u5f35\u3089\u308c\u307e\u3059\u3002\n\n\u30e9\u30c3\u30d1\u30fc\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u306f\u3001\u8d77\u52d5\u3055\u308c\u305f\u540d\u524d\u3092\u3082\u3068\u306b\u5b9f\u884c\u3059\u308b\u30ed\u30fc\u30c9\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u6c7a\u5b9a\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u3064\u304e\u306e\u3088\u3046\u306b\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n~~~\ncp zwrapper.py /usr/sbin/zwrapper\nln -s zwrapper /usr/sbin/zabbix_server_mysql\nln -s zwrapper /usr/sbin/zabbix_server\nln -s zabbix_server_mysql /opt/zabbix/usr/sbin/zabbix_server\nln -s zwrapper /usr/sbin/zabbix_agentd\n~~~\n\n~~~\nln /usr/sbin/zwrapper /usr/bin/zwrapper\nln -s zwrapper /usr/bin/zabbix_get\nln -s zwrapper /usr/bin/zabbix_sender\n~~~\n\n~~~\n$ ls -l /usr/sbin/zabbix_server /usr/sbin/zabbix_server_mysql  /opt/zabbix/usr/sbin/zabbix_server /opt/zabbix/usr/sbin/zabbix_server_mysql\nlrwxrwxrwx 1 root root      19 Mar  4 02:55 /opt/zabbix/usr/sbin/zabbix_server -> zabbix_server_mysql\n-rwxr-xr-x 1 root root 1594952 Feb 28 16:24 /opt/zabbix/usr/sbin/zabbix_server_mysql\nlrwxrwxrwx 1 root root       8 Mar  4 03:08 /usr/sbin/zabbix_server -> zwrapper\nlrwxrwxrwx 1 root root       8 Mar  2 18:41 /usr/sbin/zabbix_server_mysql -> zwrapper\n$ ls -l /usr/sbin/zabbix_agentd\nlrwxrwxrwx 1 root root 8 Mar  2 18:41 /usr/sbin/zabbix_agentd -> zwrapper\n$ ls -l /usr/bin/zabbix_get /usr/bin/zabbix_sender /usr/bin/zwrapper\nlrwxrwxrwx 1 root root   8 Mar  2 18:38 /usr/bin/zabbix_get -> zwrapper\nlrwxrwxrwx 1 root root   8 Mar  2 18:41 /usr/bin/zabbix_sender -> zwrapper\n-rwxr-xr-x 2 root root 881 Mar  4 05:42 /usr/bin/zwrapper\n~~~\n\n\u3053\u306e\u3088\u3046\u306b\u3059\u308b\u3068\u3001\u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u5909\u66f4\u306a\u3057\u3067\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u30a2\u30fc\u30ab\u30a4\u30d6\u304b\u3089 /etc/init.d \u306b\u5c55\u958b\u3057\u307e\u3059\u3002\n\n~~~\n# rpm2cpio zabbix-server-2.4.7-1.el6.x86_64.rpm | (cd / && cpio -imv ./etc/init.d/zabbix-server)\n# rpm2cpio zabbix-agent-2.4.7-1.el6.x86_64.rpm | (cd / && cpio -imv ./etc/init.d/zabbix-agent)\n~~~\n\n## web\n\nPHP 5.4 \u4ee5\u4e0a\u304c\u5fc5\u8981\u3068\u306a\u308a\u307e\u3059\u3002remi \u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5c0e\u5165\u3057\u307e\u3057\u305f\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\n* php-common-5.4.45-4.el6.remi.x86_64\n* php-5.4.45-4.el6.remi.x86_64\n* php-mysql-5.4.45-4.el6.remi.x86_64\n* php-bcmath-5.4.45-4.el6.remi.x86_64\n* php-xml-5.4.45-4.el6.remi.x86_64\n* httpd-tools-2.2.15-47.el6.centos.3.x86_64\n* httpd-2.2.15-47.el6.centos.3.x86_64\n* php-cli-5.4.45-4.el6.remi.x86_64\n* php-pdo-5.4.45-4.el6.remi.x86_64\n* php-mbstring-5.4.45-4.el6.remi.x86_64\n* php-gd-5.4.45-4.el6.remi.x86_64\n* php-ldap-5.4.45-4.el6.remi.x86_64\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u5f35\u3063\u3066\u304a\u304d\u307e\u3059\u3002\n\n~~~\n# ln -s /opt/zabbix/usr/share/zabbix /usr/share/zabbix\n~~~\n\n\nGUI \u304b\u3089\u306e\u521d\u671f\u8a2d\u5b9a\u3067\u4f5c\u6210\u3055\u308c\u308b\u30d5\u30a1\u30a4\u30eb\u304c\u66f8\u304d\u8fbc\u3081\u308b\u3088\u3046\u306b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n~~~\n# chgrp apache /etc/zabbix/web\n# chmod g+w /etc/zabbix/web\n~~~\n\n~~~\n# ls -ld /etc/zabbix/web\ndrwxrwx--- 2 root apache 4096 Mar  2 19:43 /etc/zabbix/web\n~~~\n\n`/opt/zabbix/etc/httpd/conf.d/zabbix.conf` \u306b\u3042\u308b\u30d5\u30a1\u30a4\u30eb\u306f apache 2.4 \u7528\u306e\u3082\u306e\u3067\u3042\u308b\u305f\u3081\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u4fee\u6b63\u3057\u3066 `/etc/httpd/conf.d/zabbix.conf` \u306b\u914d\u7f6e\u3057\u307e\u3059\u3002\n\n```/etc/httpd/conf.d/zabbix.conf.patch\ndiff -u zabbix.conf zabbix.conf\n--- zabbix.conf       2016-02-28 16:05:33.000000000 +0900\n+++ zabbix.conf       2016-03-04 14:49:45.345699170 +0900\n@@ -7,7 +7,8 @@\n <Directory \"/usr/share/zabbix\">\n     Options FollowSymLinks\n     AllowOverride None\n-    Require all granted\n+    Order allow,deny\n+    Allow from all\n\n     <IfModule mod_php5.c>\n         php_value max_execution_time 300\n@@ -16,22 +17,42 @@\n         php_value upload_max_filesize 2M\n         php_value max_input_time 300\n         php_value always_populate_raw_post_data -1\n-        # php_value date.timezone Europe/Riga\n+        php_value date.timezone Asia/Tokyo\n     </IfModule>\n </Directory>\n\n <Directory \"/usr/share/zabbix/conf\">\n-    Require all denied\n+    Order deny,allow\n+    Deny from all\n+    <files *.php>\n+        Order deny,allow\n+        Deny from all\n+    </files>\n </Directory>\n\n <Directory \"/usr/share/zabbix/app\">\n-    Require all denied\n+    Order deny,allow\n+    Deny from all\n+    <files *.php>\n+        Order deny,allow\n+        Deny from all\n+    </files>\n </Directory>\n\n <Directory \"/usr/share/zabbix/include\">\n-    Require all denied\n+    Order deny,allow\n+    Deny from all\n+    <files *.php>\n+        Order deny,allow\n+        Deny from all\n+    </files>\n </Directory>\n\n <Directory \"/usr/share/zabbix/local\">\n-    Require all denied\n+    Order deny,allow\n+    Deny from all\n+    <files *.php>\n+        Order deny,allow\n+        Deny from all\n+    </files>\n </Directory>\n```\n\n~~~\n# apachectl graceful\n~~~\n\n## GUI \u304b\u3089\u306e\u521d\u671f\u8a2d\u5b9a\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f iptable \u306b\u3088\u308b\u30d1\u30b1\u30c3\u30c8\u30d5\u30a3\u30eb\u30bf\u30fc\u304c\u304b\u304b\u3063\u3066\u3044\u307e\u3059\u3002\n\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u4fee\u6b63\u3057\u307e\u3059\u3002\n\n```iptables.patch\ndiff -u /etc/sysconfig/iptables  /etc/sysconfig/iptables\n--- /etc/sysconfig/iptables.old 2016-03-02 05:23:33.296000000 +0900\n+++ /etc/sysconfig/iptables     2016-03-03 03:21:08.606717140 +0900\n@@ -8,6 +8,10 @@\n -A INPUT -p icmp -j ACCEPT\n -A INPUT -i lo -j ACCEPT\n -A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT\n+-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT\n+-A INPUT -m state --state NEW -m tcp -p tcp --dport 10050 -j ACCEPT\n+-A INPUT -m state --state NEW -m tcp -p tcp --dport 10051 -j ACCEPT\n+-A INPUT -j REJECT --reject-with icmp-host-prohibited\n -A INPUT -j REJECT --reject-with icmp-host-prohibited\n -A FORWARD -j REJECT --reject-with icmp-host-prohibited\n COMMIT\n```\n\n\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089 http://zabbix-server/zabbix/ \u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n\n2.2 \u3084 2.4 \u3068\u306f\u305a\u3044\u3076\u3093\u96f0\u56f2\u6c17\u304c\u5909\u308f\u308a\u307e\u3057\u305f\u304c\u3001\u8a2d\u5b9a\u306e\u6d41\u308c\u306f\u304b\u308f\u308a\u307e\u305b\u3093\u3002\n\n\n\n#### \u30ce\u30fc\u30c8\n\nSElinux \u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u308b\u3068\u3001Zabbix \u30b5\u30fc\u30d0\u3078\u306e\u30d8\u30eb\u30b9\u30c1\u30a7\u30c3\u30af\u3092 SElinux \u304c\u963b\u6b62\u3059\u308b\u305f\u3081\u306b\u3001Zabbix server is not running (\u30b5\u30fc\u30d0\u304c\u505c\u6b62\u3057\u3066\u3044\u308b) \u3068\u3044\u3046\u8b66\u544a\u304c\u51fa\u305f\u307e\u307e\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u3053\u306e\u3068\u304d audit.log \u3092\u78ba\u8a8d\u3059\u308b\u3068\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u3066\u3044\u307e\u3059\u3002\n\n```/var/log/audit/audit.log\ntype=AVC msg=audit(1456943266.076:612): avc:  denied  { name_connect } for  pid=15592 comm=\"httpd\" dest=10051 scontext=unconfined_u:system_r:httpd_t:s0 tcontext=system_u:object_r:zabbix_port_t:s0 tclass=tcp_socket\ntype=SYSCALL msg=audit(1456943266.076:612): arch=c000003e syscall=42 success=no exit=-13 a0=c a1=7fa7401687e8 a2=10 a3=7fa73bf6814c items=0 ppid=15529 pid=15592 auid=1003 uid=48 gid=48 euid=48 suid=48 fsuid=48 egid=48 sgid=48 fsgid=48 tty=(none) ses=1 comm=\"httpd\" exe=\"/usr/sbin/httpd\" subj=unconfined_u:system_r:httpd_t:s0 key=(null)\n```\n\nhttpd(php)\u304b\u3089\u306e\u901a\u4fe1\u3092\u8a31\u53ef\u3059\u308b\u3088\u3046\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30fc\u30dd\u30ea\u30b7\u30fc\u3092\u5909\u66f4\u3059\u308b\u304b\u3001SELinux \u3092\u7121\u52b9(Permissive \u3042\u308b\u3044\u306f Disable) \u306b\u3059\u308b\u3068\u89e3\u6d88\u3057\u307e\u3059\u3002\n\n```\n# setsebool -P httpd_can_network_connect 1\n```\n\n## \u307e\u3068\u3081\n\nrpm \u30d1\u30c3\u30b1\u30fc\u30b8\u3068\u3001\u5bfe\u5fdc\u3059\u308b glibc \u3084 libmysqlclient\u3001libcurl \u3092\u89e3\u3044\u3066\u914d\u7f6e\u3057\u3066\u3001\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30ea\u30f3\u30ab\u306b\u3001\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u30d1\u30b9\u3092\u6307\u5b9a\u3057\u3066\u30ed\u30fc\u30c9\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u547c\u3073\u51fa\u3059\u3088\u3046\u306b\u3059\u308c\u3070\u3001\u554f\u984c\u306a\u304f\u52d5\u4f5c\u3059\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\n\n\u5c55\u958b\u304c\u5fc5\u8981\u306a CentOS 7 \u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\n* glibc-2.17-105.el7.x86_64.rpm\n* libcurl-7.29.0-25.el7.centos.x86_64.rpm\n* mariadb-libs-5.5.44-2.el7.centos.x86_64.rpm\n* net-snmp-libs-5.7.2-24.el7.x86_64.rpm\n\nWeb GUI \u306f\u30012.2 \u3084 2.4 \u306e\u6642\u3068\u540c\u69d8\u306e\u8a2d\u5b9a\u3067\u5bfe\u5fdc\u53ef\u80fd\u3067\u3059\u3002\n\n\u4eca\u56de\u306f\u3001\u5b9f\u884c\u3067\u304d\u308b\u74b0\u5883\u3092\u3001\u529b\u696d\u3067\u3064\u304f\u308a\u307e\u3057\u305f\u304c\u3001SRPM \u304b\u3089\u3082\u3001spec \u30d5\u30a1\u30a4\u30eb\u3092\u5c11\u3057\u4fee\u6b63\u3059\u308c\u3070\u30d3\u30eb\u30c9\u3067\u304d\u307e\u3057\u305f\u3002\u3053\u306e\u3053\u3068\u306f\u3001[CentOS6 \u3067 Zabbix 3.0 \u3092\u52d5\u304b\u3059 (\u81ea\u529b\u30d3\u30eb\u30c9\u7de8)] (http://qiita.com/items/b6b7adc914a3ca8ad0cb) \u3067\u53d6\u308a\u4e0a\u3052\u307e\u3059\u3002\n\n# \u88dc\u8db3 \n\n[PatchELF] (http://nixos.org/patchelf.html) \u3092\u4f7f\u7528\u3059\u308b\u3068 INTERP \u30bb\u30af\u30b7\u30e7\u30f3\u3092\u5909\u66f4\u3067\u304d\u308b\u306e\u3067\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n~~~\n$ wget http://nixos.org/releases/patchelf/patchelf-0.8/patchelf-0.8.tar.bz2\n$ tar xvfa patchelf-0.8.tar.bz2\n~~~\n\n~~~\n$ ./configure --prefix=/usr/local\nchecking for a BSD-compatible install... /usr/bin/install -c\nchecking whether build environment is sane... yes\nchecking for a thread-safe mkdir -p... /bin/mkdir -p\nchecking for gawk... gawk\nchecking whether make sets $(MAKE)... yes\nchecking for style of include used by make... GNU\nchecking for gcc... gcc\nchecking whether the C compiler works... yes\nchecking for C compiler default output file name... a.out\nchecking for suffix of executables...\nchecking whether we are cross compiling... no\nchecking for suffix of object files... o\nchecking whether we are using the GNU C compiler... yes\nchecking whether gcc accepts -g... yes\nchecking for gcc option to accept ISO C89... none needed\nchecking dependency style of gcc... gcc3\nchecking whether gcc and cc understand -c and -o together... yes\nchecking for g++... no\nchecking for c++... no\nchecking for gpp... no\nchecking for aCC... no\nchecking for CC... no\nchecking for cxx... no\nchecking for cc++... no\nchecking for cl.exe... no\nchecking for FCC... no\nchecking for KCC... no\nchecking for RCC... no\nchecking for xlC_r... no\nchecking for xlC... no\nchecking whether we are using the GNU C++ compiler... no\nchecking whether g++ accepts -g... no\nchecking dependency style of g++... none\nchecking that generated files are newer than configure... done\nconfigure: creating ./config.status\nconfig.status: creating Makefile\nconfig.status: creating src/Makefile\nconfig.status: creating tests/Makefile\nconfig.status: creating patchelf.spec\nconfig.status: executing depfiles commands\n~~~\n\n~~~\n$ make\nMaking all in src\nmake[1]: Entering directory `/src/patchelf-0.8/src'\nsource='patchelf.cc' object='patchelf.o' libtool=no \\\nDEPDIR=.deps depmode=none /bin/sh ../build-aux/depcomp \\\ng++ -DPACKAGE_NAME=\\\"patchelf\\\" -DPACKAGE_TARNAME=\\\"patchelf\\\" -DPACKAGE_VERSION=\\\"0.8\\\" -DPACKAGE_STRING=\\\"patchelf\\ 0.8\\\" -DPACKAGE_BUGREPORT=\\\"\\\" -DPACKAGE_URL=\\\"\\\" -DPACKAGE=\\\"patchelf\\\" -DVERSION=\\\"0.8\\\" -I.      -c -o patchelf.o patchelf.cc\n../build-aux/depcomp: line 761: exec: g++: not found\nmake[1]: *** [patchelf.o] Error 127\nmake[1]: Leaving directory `/src/patchelf-0.8/src'\nmake: *** [all-recursive] Error 1\n~~~\n\n\u30d3\u30eb\u30c9\u306b g++ \u304c\u5fc5\u8981\u3067\u3057\u305f\u3002configure \u3067\u30a8\u30e9\u30fc\u3092\u51fa\u3057\u3066\u3088\u3002\n\n~~~\n$ sudo yum install gcc-c++\n~~~\n\n~~~\n$ ./configure --prefix=/usr/local\nchecking for a BSD-compatible install... /usr/bin/install -c\nchecking whether build environment is sane... yes\nchecking for a thread-safe mkdir -p... /bin/mkdir -p\nchecking for gawk... gawk\nchecking whether make sets $(MAKE)... yes\nchecking for style of include used by make... GNU\nchecking for gcc... gcc\nchecking whether the C compiler works... yes\nchecking for C compiler default output file name... a.out\nchecking for suffix of executables...\nchecking whether we are cross compiling... no\nchecking for suffix of object files... o\nchecking whether we are using the GNU C compiler... yes\nchecking whether gcc accepts -g... yes\nchecking for gcc option to accept ISO C89... none needed\nchecking dependency style of gcc... gcc3\nchecking whether gcc and cc understand -c and -o together... yes\nchecking for g++... g++\nchecking whether we are using the GNU C++ compiler... yes\nchecking whether g++ accepts -g... yes\nchecking dependency style of g++... gcc3\nchecking that generated files are newer than configure... done\nconfigure: creating ./config.status\nconfig.status: creating Makefile\nconfig.status: creating src/Makefile\nconfig.status: creating tests/Makefile\nconfig.status: creating patchelf.spec\nconfig.status: executing depfiles commands\n~~~\n\n~~~\n$ make\nMaking all in src\nmake[1]: Entering directory `/src/patchelf-0.8/src'\ng++ -DPACKAGE_NAME=\\\"patchelf\\\" -DPACKAGE_TARNAME=\\\"patchelf\\\" -DPACKAGE_VERSION=\\\"0.8\\\" -DPACKAGE_STRING=\\\"patchelf\\ 0.8\\\" -DPACKAGE_BUGREPORT=\\\"\\\" -DPACKAGE_URL=\\\"\\\" -DPACKAGE=\\\"patchelf\\\" -DVERSION=\\\"0.8\\\" -I.     -g -O2 -MT patchelf.o -MD -MP -MF .deps/patchelf.Tpo -c -o patchelf.o patchelf.cc\nmv -f .deps/patchelf.Tpo .deps/patchelf.Po\ng++  -g -O2   -o patchelf patchelf.o\nmake[1]: Leaving directory `/src/patchelf-0.8/src'\nMaking all in tests\nmake[1]: Entering directory `/src/patchelf-0.8/tests'\nmake[1]: Nothing to be done for `all'.\nmake[1]: Leaving directory `/src/patchelf-0.8/tests'\nmake[1]: Entering directory `/src/patchelf-0.8'\nmake[1]: Nothing to be done for `all-am'.\nmake[1]: Leaving directory `/src/patchelf-0.8'\n~~~\n\n~~~\n$ sudo make install\nMaking install in src\nmake[1]: Entering directory `/src/patchelf-0.8/src'\nmake[2]: Entering directory `/src/patchelf-0.8/src'\n /bin/mkdir -p '/usr/local/bin'\n  /usr/bin/install -c patchelf '/usr/local/bin'\nmake[2]: Nothing to be done for `install-data-am'.\nmake[2]: Leaving directory `/src/patchelf-0.8/src'\nmake[1]: Leaving directory `/src/patchelf-0.8/src'\nMaking install in tests\nmake[1]: Entering directory `/src/patchelf-0.8/tests'\nmake[2]: Entering directory `/src/patchelf-0.8/tests'\nmake[2]: Nothing to be done for `install-exec-am'.\nmake[2]: Nothing to be done for `install-data-am'.\nmake[2]: Leaving directory `/src/patchelf-0.8/tests'\nmake[1]: Leaving directory `/src/patchelf-0.8/tests'\nmake[1]: Entering directory `/src/patchelf-0.8'\nmake[2]: Entering directory `/src/patchelf-0.8'\nmake[2]: Nothing to be done for `install-exec-am'.\n /bin/mkdir -p '/usr/local/share/doc/patchelf'\n /usr/bin/install -c -m 644 README '/usr/local/share/doc/patchelf'\n /bin/mkdir -p '/usr/local/share/man/man1'\n /usr/bin/install -c -m 644 patchelf.1 '/usr/local/share/man/man1'\nmake[2]: Leaving directory `/src/patchelf-0.8'\nmake[1]: Leaving directory `/src/patchelf-0.8'\n~~~\n\n\u3067\u304d\u305f\n\n~~~\n$ /usr/local/bin/patchelf\nsyntax: /usr/local/bin/patchelf\n  [--set-interpreter FILENAME]\n  [--print-interpreter]\n  [--set-rpath RPATH]\n  [--shrink-rpath]\n  [--print-rpath]\n  [--force-rpath]\n  [--remove-needed LIBRARY]\n  [--debug]\n  [--version]\n  FILENAME\n~~~\n\n\u3088\u3057\u3002\n\n\n~~~\n$ sudo /usr/local/bin/patchelf  --set-interpreter /opt/zabbix/lib64/ld-linux-x86-64.so.2 --set-rpath /opt/zabbix/lib64:/opt/zabbix/usr/lib64:/opt/zabbix/usr/lib64/mysql /opt/zabbix/usr/bin/zabbix_get\n~~~\n\n~~~\n$ /opt/zabbix/usr/bin/zabbix_get -h\nusage:\n  zabbix_get -s host-name-or-IP [-p port-number] [-I IP-address] -k item-key\n  zabbix_get -s host-name-or-IP [-p port-number] [-I IP-address]\n                --tls-connect cert --tls-ca-file CA-file\n                [--tls-crl-file CRL-file] [--tls-agent-cert-issuer cert-issuer]\n                [--tls-agent-cert-subject cert-subject]\n                --tls-cert-file cert-file --tls-key-file key-file -k item-key\n  zabbix_get -s host-name-or-IP [-p port-number] [-I IP-address]\n                --tls-connect psk --tls-psk-identity PSK-identity\n                --tls-psk-file PSK-file -k item-key\n  zabbix_get -h\n  zabbix_get -V\n\nGet data from Zabbix agent.\n\nGeneral options:\n  -s --host host-name-or-IP  Specify host name or IP address of a host\n  -p --port port-number      Specify port number of agent running on the host\n                             (default: 10050)\n  -I --source-address IP-address   Specify source IP address\n\n  -k --key item-key          Specify key of the item to retrieve value for\n\n  -h --help                  Display this help message\n  -V --version               Display version number\n\nTLS connection options:\n  --tls-connect value        How to connect to agent. Values:\n                               unencrypted - connect without encryption\n                                             (default)\n                               psk         - connect using TLS and a pre-shared\n                                             key\n                               cert        - connect using TLS and a\n                                             certificate\n\n  --tls-ca-file CA-file      Full pathname of a file containing the top-level\n                             CA(s) certificates for peer certificate\n                             verification\n\n  --tls-crl-file CRL-file    Full pathname of a file containing revoked\n                             certificates\n\n  --tls-agent-cert-issuer cert-issuer   Allowed agent certificate issuer\n\n  --tls-agent-cert-subject cert-subject   Allowed agent certificate subject\n\n  --tls-cert-file cert-file  Full pathname of a file containing the certificate\n                             or certificate chain\n\n  --tls-key-file key-file    Full pathname of a file containing the private key\n\n  --tls-psk-identity PSK-identity   Unique, case sensitive string used to\n                             identify the pre-shared key\n\n  --tls-psk-file PSK-file    Full pathname of a file containing the pre-shared\n                             key\n\nExample(s):\n  zabbix_get -s 127.0.0.1 -p 10050 -k \"system.cpu.load[all,avg1]\"\n\n  zabbix_get -s 127.0.0.1 -p 10050 -k \"system.cpu.load[all,avg1]\" \\\n    --tls-connect cert --tls-ca-file /home/zabbix/zabbix_ca_file \\\n    --tls-agent-cert-issuer \\\n    \"CN=Signing CA,OU=IT operations,O=Example Corp,DC=example,DC=com\" \\\n    --tls-agent-cert-subject \\\n    \"CN=server1,OU=IT operations,O=Example Corp,DC=example,DC=com\" \\\n    --tls-cert-file /home/zabbix/zabbix_get.crt \\\n    --tls-key-file /home/zabbix/zabbix_get.key\n\n  zabbix_get -s 127.0.0.1 -p 10050 -k \"system.cpu.load[all,avg1]\" \\\n    --tls-connect psk --tls-psk-identity \"PSK ID Zabbix agentd\" \\\n    --tls-psk-file /home/zabbix/zabbix_agentd.psk\n\nReport bugs to: <https://support.zabbix.com>\nZabbix home page: <http://www.zabbix.com>\nDocumentation: <https://www.zabbix.com/documentation>\n~~~\n\n\u3053\u308c\u3067\u30e9\u30c3\u30d1\u30fc\u3082\u4e0d\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u4ed6\u306e\u30ed\u30fc\u30c9\u30e2\u30b8\u30e5\u30fc\u30eb\u3082\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\n\n~~~\n$ sudo /usr/local/bin/patchelf  --set-interpreter /opt/zabbix/lib64/ld-linux-x86-64.so.2 --set-rpath /opt/zabbix/lib64:/opt/zabbix/usr/lib64:/opt/zabbix/usr/lib64/mysql /opt/zabbix/usr/bin/zabbix_sender\n~~~\n\n~~~\n$ /opt/zabbix/usr/bin/zabbix_sender -h | head\nusage:\n  zabbix_sender [-v] -z server [-p port] [-I IP-address] -s host -k key\n                -o value\n  zabbix_sender [-v] -z server [-p port] [-I IP-address] [-s host] [-T] [-r]\n                -i input-file\n  zabbix_sender [-v] -c config-file [-z server] [-p port] [-I IP-address]\n                [-s host] -k key -o value\n  zabbix_sender [-v] -c config-file [-z server] [-p port] [-I IP-address]\n                [-s host] [-T] [-r] -i input-file\n  zabbix_sender [-v] -z server [-p port] [-I IP-address] -s host\n~~~\n\n~~~\n$ sudo /usr/local/bin/patchelf  --set-interpreter /opt/zabbix/lib64/ld-linux-x86-64.so.2 --set-rpath /opt/zabbix/lib64:/opt/zabbix/usr/lib64:/opt/zabbix/usr/lib64/mysql /opt/zabbix/usr/sbin/zabbix_server_mysql\n~~~\n \n~~~\n$ /opt/zabbix/usr/sbin/zabbix_server_mysql -h | head\nusage:\n  zabbix_server_mysql [-c config-file]\n  zabbix_server_mysql [-c config-file] -R runtime-option\n  zabbix_server_mysql -h\n  zabbix_server_mysql -V\n\nThe core daemon of Zabbix software.\n\nOptions:\n  -c --config config-file        Absolute path to the configuration file\n~~~\n\n~~~\n$ sudo /usr/local/bin/patchelf  --set-interpreter /opt/zabbix/lib64/ld-linux-x86-64.so.2 --set-rpath /opt/zabbix/lib64:/opt/zabbix/usr/lib64:/opt/zabbix/usr/lib64/mysql /opt/zabbix/usr/sbin/zabbix_agentd\n~~~\n\n~~~\n$ /opt/zabbix/usr/sbin/zabbix_agentd -h | head\nusage:\n  zabbix_agentd [-c config-file]\n  zabbix_agentd [-c config-file] -p\n  zabbix_agentd [-c config-file] -t item-key\n  zabbix_agentd [-c config-file] -R runtime-option\n  zabbix_agentd -h\n  zabbix_agentd -V\n\nA Zabbix daemon for monitoring of various server parameters.\n\n~~~\n\nOK!\n", "tags": ["zabbix3.0", "CentOS6"]}