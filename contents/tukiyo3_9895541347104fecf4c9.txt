{"context": " More than 1 year has passed since last update.Socket\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306f\u521d\u3081\u3066\u3002\u6dfb\u524a\u5e0c\u671b\u3002\n\nsocket\u5f62\u5f0f\n\u53c2\u8003 IP Messenger \u30d7\u30ed\u30c8\u30b3\u30eb\u30e1\u30e2.\n\n\n(\u305d\u306ePC\u304c\u77e5\u3063\u3066\u3044\u308b)IPMessenger\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u4e00\u89a7\u3092\u554f\u3044\u5408\u308f\u305b\n\n1:100:username:pcname:18:0\n\n\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u6587hello_world\u3092\u9001\u4fe1\n\n1:100:username:pcname:32:hello_world\n\n\n\n\n\u51e6\u7406\u306e\u6d41\u308c\n\nudp://target_ip, port 2425\u306esocket\u3092\u751f\u6210\ntarget_ip\u306eIpMessenger\u306b\u3001username,pcname\u3092\u540d\u4e57\u308a\u3001target_ip\u3055\u3093\u304c\u77e5\u3063\u3066\u3044\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u4e00\u89a7\u304c\u6b32\u3057\u3044\u3068\u8a00\u3046\u3002\ntarget_ip\u3055\u3093\u304b\u3089\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u4e00\u89a7\u3092\u3082\u3089\u3046\u304c\u3001\u6b7b\u6d3b\u76e3\u8996\u304c\u3057\u305f\u3044\u3060\u3051\u306a\u306e\u3067\u3068\u308a\u3042\u3048\u305a1\u30d0\u30a4\u30c8\u3060\u3051\u3082\u3089\u3063\u3068\u304f\u3002\n\u53d6\u5f97\u7d50\u679c\u306eok,ng\u3092\u9001\u4fe1\n\n\nIpMessenger\u30af\u30e9\u30b9\n\nipmessenger.php\n<?php\nclass IpMessenger {\n  const IPMSG_GETLIST = '18';\n  const IPMSG_SENDMESSAGE = '32';\n  const STREAM_TIMEOUT = 3; //second\n\n  private $target_ip;\n\n  public function set_target_ip($ip) {\n      $this->target_ip = $ip;\n  }\n\n  private function connect() {\n      $fp = fsockopen('udp://'.$this->target_ip, 2425);\n      stream_set_timeout($fp, self::STREAM_TIMEOUT);\n      return $fp;\n  }\n\n  public function connect_check() {\n      $fp = self::connect();\n      fwrite($fp, \"1:100:username:pcname:\".self::IPMSG_GETLIST.\":0\");\n      $data_length = 1;\n      if(!fread($fp, $data_length)) {\n          return false;\n      }\n      return true;\n  }\n\n  public function send_message($message_utf8) {\n      $fp = self::connect();\n      $message_sjis = mb_convert_encoding($message_utf8,\"sjis\",\"utf-8\");\n      fwrite($fp, \"1:100:username:groupname:\".self::IPMSG_SENDMESSAGE.\":\".$message_sjis);\n  }\n}\n\n\n\n\u4f7f\u3044\u65b9\n\n192.168.100.45 : php\u3092\u5b9f\u884c\u3059\u308b\u7aef\u672b\n192.168.100.68 : \u30c1\u30a7\u30c3\u30af\u3057\u305f\u3044IPMessenger\u306e\u7aef\u672b\n192.168.100.67 : \u7d50\u679c\u3092IPMessenger\u3067\u53d7\u3051\u53d6\u308b\u7aef\u672b\n\n\nmain.php\n<?php\nrequire_once('ipmessenger.php');\n\n$ipmsg = new IpMessenger();\n$ipmsg->set_target_ip('192.168.100.68');\nif($ipmsg->connect_check()) {\n    $ipmsg->set_target_ip('192.168.100.67');\n    $ipmsg->send_message(\"\u65e5\u672c\u8a9e\u3067\u3082OK\");\n} else {\n    $ipmsg->set_target_ip('192.168.100.67');\n    $ipmsg->send_message(\"ng\");\n}\n\n\n\n\u5b9f\u884c\n\n\u5b9f\u884c\nphp main.php\n\n\n\n192.168.100.68 \u306e IPMessenger\u306e\u5fdc\u7b54\u304c\u3042\u308b\u3068\u304d\u3001192.168.100.67 \u3078ok\u3092\u9001\u308b\n\n\n\u2028\n* 192.168.100.68 \u306e IPMessenger\u306e\u5fdc\u7b54\u304c\u306a\u3044\u3068\u304d\u3001192.168.100.67 \u3078ok\u3092\u9001\u308b\n\n\nSocket\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306f\u521d\u3081\u3066\u3002\u6dfb\u524a\u5e0c\u671b\u3002\n\n# socket\u5f62\u5f0f\n\n\u53c2\u8003 [IP Messenger \u30d7\u30ed\u30c8\u30b3\u30eb\u30e1\u30e2.](http://smart-pda.net/isourou/ipmsg/doc/ipmsg_protocol.html)\n\n* (\u305d\u306ePC\u304c\u77e5\u3063\u3066\u3044\u308b)IPMessenger\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u4e00\u89a7\u3092\u554f\u3044\u5408\u308f\u305b\n  * `1:100:username:pcname:18:0`\n\n* \u30e1\u30c3\u30bb\u30fc\u30b8\u6587`hello_world`\u3092\u9001\u4fe1\n  * `1:100:username:pcname:32:hello_world`\n\n# \u51e6\u7406\u306e\u6d41\u308c\n\n1. udp://target_ip, port 2425\u306esocket\u3092\u751f\u6210\n1. target_ip\u306eIpMessenger\u306b\u3001username,pcname\u3092\u540d\u4e57\u308a\u3001target_ip\u3055\u3093\u304c\u77e5\u3063\u3066\u3044\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u4e00\u89a7\u304c\u6b32\u3057\u3044\u3068\u8a00\u3046\u3002\n1. target_ip\u3055\u3093\u304b\u3089\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u4e00\u89a7\u3092\u3082\u3089\u3046\u304c\u3001\u6b7b\u6d3b\u76e3\u8996\u304c\u3057\u305f\u3044\u3060\u3051\u306a\u306e\u3067\u3068\u308a\u3042\u3048\u305a1\u30d0\u30a4\u30c8\u3060\u3051\u3082\u3089\u3063\u3068\u304f\u3002\n1. \u53d6\u5f97\u7d50\u679c\u306eok,ng\u3092\u9001\u4fe1\n\n\n# IpMessenger\u30af\u30e9\u30b9\n\n```php:ipmessenger.php\n<?php\nclass IpMessenger {\n  const IPMSG_GETLIST = '18';\n  const IPMSG_SENDMESSAGE = '32';\n  const STREAM_TIMEOUT = 3; //second\n\n  private $target_ip;\n\n  public function set_target_ip($ip) {\n      $this->target_ip = $ip;\n  }\n\n  private function connect() {\n      $fp = fsockopen('udp://'.$this->target_ip, 2425);\n      stream_set_timeout($fp, self::STREAM_TIMEOUT);\n      return $fp;\n  }\n\n  public function connect_check() {\n      $fp = self::connect();\n      fwrite($fp, \"1:100:username:pcname:\".self::IPMSG_GETLIST.\":0\");\n      $data_length = 1;\n      if(!fread($fp, $data_length)) {\n          return false;\n      }\n      return true;\n  }\n\n  public function send_message($message_utf8) {\n      $fp = self::connect();\n      $message_sjis = mb_convert_encoding($message_utf8,\"sjis\",\"utf-8\");\n      fwrite($fp, \"1:100:username:groupname:\".self::IPMSG_SENDMESSAGE.\":\".$message_sjis);\n  }\n}\n```\n\n# \u4f7f\u3044\u65b9\n\n* 192.168.100.45 : php\u3092\u5b9f\u884c\u3059\u308b\u7aef\u672b\n* 192.168.100.68 : \u30c1\u30a7\u30c3\u30af\u3057\u305f\u3044IPMessenger\u306e\u7aef\u672b\n* 192.168.100.67 : \u7d50\u679c\u3092IPMessenger\u3067\u53d7\u3051\u53d6\u308b\u7aef\u672b\n\n```php:main.php\n<?php\nrequire_once('ipmessenger.php');\n\n$ipmsg = new IpMessenger();\n$ipmsg->set_target_ip('192.168.100.68');\nif($ipmsg->connect_check()) {\n    $ipmsg->set_target_ip('192.168.100.67');\n    $ipmsg->send_message(\"\u65e5\u672c\u8a9e\u3067\u3082OK\");\n} else {\n    $ipmsg->set_target_ip('192.168.100.67');\n    $ipmsg->send_message(\"ng\");\n}\n```\n\n\n# \u5b9f\u884c\n\n```bash:\u5b9f\u884c\nphp main.php\n```\n\n* 192.168.100.68 \u306e IPMessenger\u306e\u5fdc\u7b54\u304c\u3042\u308b\u3068\u304d\u3001192.168.100.67 \u3078ok\u3092\u9001\u308b\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2014-08-13 16.02.34.png](https://qiita-image-store.s3.amazonaws.com/0/25728/ceb60cec-4e05-6988-3dfe-788bd588f4c2.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2014-08-13 16.02.34.png\")\n\u2028\n* 192.168.100.68 \u306e IPMessenger\u306e\u5fdc\u7b54\u304c\u306a\u3044\u3068\u304d\u3001192.168.100.67 \u3078ok\u3092\u9001\u308b\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2014-08-13 16.02.18.png](https://qiita-image-store.s3.amazonaws.com/0/25728/2f6db783-7d1b-4333-2251-a40f2c6b99b4.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2014-08-13 16.02.18.png\")\n", "tags": ["socket", "ipmessenger", "PHP"]}