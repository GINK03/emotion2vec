{"context": "\n\n\u3084\u308b\u3053\u3068\nvagrant\u3067\u7acb\u3066\u305fubuntu\u30b5\u30fc\u30d0\u306bchef-zero\u3092\u4f7f\u3063\u3066\u3001postgresql\u3084rbenv\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\n\n\u6e96\u5099\n\n\nvagrant\u3067\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u5bfe\u8c61\u3092\u69cb\u7bc9\u3059\u308b\n$ vagrant init bento/ubuntu-14.04\n$ vim Vagrantfile\n# \u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3092\u5916\u3059\n#  config.vm.network \"private_network\", ip: \u201c192.168.33.10\"\n$ vagrant up\n$ vagrant ssh\n$ ssh-add ~/.vagrant.d/insecure_private_key\n$ ssh vagrant@192.168.33.10\n\n\n\nchef\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nchef-dk\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nhttps://downloads.chef.io/chef-dk/mac/\n\nknife-zero\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n$ sudo chef gem install knife-zero\n\n\n\n\u69cb\u6210\n\n\n\n\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3057\u3066\u307f\u308b\n\nrepo\u3092\u4f5c\u308b\n$ chef generate repo chef-repo\n$ cd chef-repo\n$ mkdir .chef\n\nknife\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\n\n.chef/knife.rb\nlocal_mode true\nknife[:automatic_attribute_whitelist] = []\ncookbook_path [\n  './cookbooks',\n  './site-cookbooks'\n]\n\n# knife[:ssh_password] = 'vagrant'\n\n\n\n\nbootstrap\u3059\u308b\n$ chef exec knife zero bootstrap 192.168.33.10 -x vagrant --sudo\n$ chef exec knife node list\n\n\n\n\u5229\u7528\u3059\u308bcookbook\u3092\u5ba3\u8a00\u3059\u308b\n\nBerksfile\nsource \"https://supermarket.chef.io\"\n\ncookbook 'postgresql', '~> 4.0.6'\ncookbook 'database', '~> 5.1.2'\ncookbook 'rbenv', '~> 1.7.1'\ncookbook 'imagemagick', '~> 0.2.3'\n\n\nChef Supermarket\n\u5148\u4eba\u306e\u7686\u69d8\u304c\u4f5c\u3063\u3066\u304f\u308c\u305fcookbook\u304c\u516c\u958b\u3055\u308c\u3066\u3044\u308b\n\n\ncookbook\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304f\u308b\n$ chef exec berks vendor cookbooks\n$ chef exec knife cookbook list\n\n\n\ncookbook\u3092\u4f5c\u308b\nsupermarket\u304b\u3089\u6301\u3063\u3066\u304d\u305fcookbook\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u7528\u9014\u306b\u5408\u308f\u305b\u305fcookbook\u3092\u4f5c\u308b\u3002\n\u4eca\u56de\u306fRails\u304c\u52d5\u304d\u305d\u3046\u306a\u74b0\u5883\u3002\n$ mkdir site-cookbooks\n$ chef exec knife cookbook create app -o site-cookbooks\n$ cd site-cookbooks/app\n\n\n\u4f9d\u5b58\u3059\u308bcookbook\u3092\u66f8\u304f\n\nsite-cookbooks/app/metadata.rb\n...\n\ndepends 'postgresql'\ndepends 'database'\ndepends 'rbenv'\ndepends 'imagemagick'\n\n\n\n\u30b5\u30fc\u30d0\u306e\u69cb\u6210\u3092\u5b9a\u7fa9\u3059\u308b\n\u203b\u73fe\u72b6\u3001database_user\u304c\u52d5\u304b\u306a\u3044...\n\nsite-cookbooks/app/recipes/default.rb\ninclude_recipe 'apt'\ninclude_recipe 'postgresql::client'\ninclude_recipe 'postgresql::server'\ninclude_recipe 'postgresql::contrib'\ninclude_recipe \"database::postgresql\"\n\ninclude_recipe 'rbenv::default'\ninclude_recipe 'rbenv::ruby_build'\ninclude_recipe 'imagemagick::default'\n\n# create postgres user\npostgresql_connection_info = {\n  :host     => '127.0.0.1',\n  :port     => node['postgresql']['config']['port'],\n  :username => 'postgres',\n  :password => node['postgresql']['password']['postgres']\n}\n\npostgresql_database_user 'sample-user' do\n  connection postgresql_connection_info\n  password   'ultra_secret'\n  action     :create\nend\n\n# install ruby\nrbenv_ruby \"2.3.1\"\nrbenv_gem \"bundler\" do\n  ruby_version \"2.3.1\"\nend\n\n# libmagickwand-dev\npackage 'libmagickwand-dev' do\n  action :install\nend\n\n\n\n\nrun_list\u3092\u7de8\u96c6\n\u5bfe\u8c61\u306e\u30b5\u30fc\u30d0\u306b\u5bfe\u3057\u3066\u3069\u306erecipe\u3092\u9069\u7528\u3059\u308b\u304b\u6307\u5b9a\u3059\u308b\u3002\n$ cd [chef-repo-root]\n$ EDITOR=vim knife node edit vagrant.vm\n...\n\"run_list\": [\n  \"recipe[app::default]\"\n]\n...\n\n\n\ncookbook\u3092\u9069\u7528\n$ chef exec knife zero converge name:vagrant.vm --attribute knife_zero.host  -x vagrant --sudo\n\n\n\u78ba\u8a8d\n$ ssh vagrant@192.168.33.10\n\n$ psql\n$ rbenv versions\n\n\n\n\ud83c\udf89\n\n\n\u53c2\u8003\n\nhttp://qiita.com/dahugani/items/cecfe04cc7ab06461711\nhttp://qiita.com/tsuyopooon/items/d90679d9f8b5ccfcfde5\nhttp://qiita.com/sawanoboly/items/a2cbd4c42525ae894371\nhttps://github.com/kawasakitoshiya/knife-zero-sample\n\n# \u3084\u308b\u3053\u3068\nvagrant\u3067\u7acb\u3066\u305fubuntu\u30b5\u30fc\u30d0\u306bchef-zero\u3092\u4f7f\u3063\u3066\u3001postgresql\u3084rbenv\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\n---\n\n# \u6e96\u5099\n---\n\n# vagrant\u3067\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u5bfe\u8c61\u3092\u69cb\u7bc9\u3059\u308b\n```\n$ vagrant init bento/ubuntu-14.04\n$ vim Vagrantfile\n# \u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3092\u5916\u3059\n#  config.vm.network \"private_network\", ip: \u201c192.168.33.10\"\n$ vagrant up\n$ vagrant ssh\n$ ssh-add ~/.vagrant.d/insecure_private_key\n$ ssh vagrant@192.168.33.10\n```\n---\n\n# chef\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n## chef-dk\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nhttps://downloads.chef.io/chef-dk/mac/\n\n## knife-zero\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n```\n$ sudo chef gem install knife-zero\n```\n\n---\n## \u69cb\u6210\n![IMG_0921.JPG](https://qiita-image-store.s3.amazonaws.com/0/55128/99c83e32-8317-eb56-5053-8f3c407c8b8e.jpeg)\n\n---\n\n# \u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3057\u3066\u307f\u308b\n---\nrepo\u3092\u4f5c\u308b\n\n```\n$ chef generate repo chef-repo\n$ cd chef-repo\n$ mkdir .chef\n```\n\nknife\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\n\n```ruby:.chef/knife.rb\nlocal_mode true\nknife[:automatic_attribute_whitelist] = []\ncookbook_path [\n  './cookbooks',\n  './site-cookbooks'\n]\n\n# knife[:ssh_password] = 'vagrant'\n```\n\n---\n\n## bootstrap\u3059\u308b\n```\n$ chef exec knife zero bootstrap 192.168.33.10 -x vagrant --sudo\n$ chef exec knife node list\n```\n---\n\n## \u5229\u7528\u3059\u308bcookbook\u3092\u5ba3\u8a00\u3059\u308b\n```ruby:Berksfile\nsource \"https://supermarket.chef.io\"\n\ncookbook 'postgresql', '~> 4.0.6'\ncookbook 'database', '~> 5.1.2'\ncookbook 'rbenv', '~> 1.7.1'\ncookbook 'imagemagick', '~> 0.2.3'\n```\n[Chef Supermarket](https://supermarket.chef.io/)\n\u5148\u4eba\u306e\u7686\u69d8\u304c\u4f5c\u3063\u3066\u304f\u308c\u305fcookbook\u304c\u516c\u958b\u3055\u308c\u3066\u3044\u308b\n\n----\n\n## cookbook\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304f\u308b\n\n```\n$ chef exec berks vendor cookbooks\n$ chef exec knife cookbook list\n```\n---\n\n## cookbook\u3092\u4f5c\u308b\nsupermarket\u304b\u3089\u6301\u3063\u3066\u304d\u305fcookbook\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u7528\u9014\u306b\u5408\u308f\u305b\u305fcookbook\u3092\u4f5c\u308b\u3002\n\u4eca\u56de\u306fRails\u304c\u52d5\u304d\u305d\u3046\u306a\u74b0\u5883\u3002\n\n```\n$ mkdir site-cookbooks\n$ chef exec knife cookbook create app -o site-cookbooks\n$ cd site-cookbooks/app\n```\n---\n\n\u4f9d\u5b58\u3059\u308bcookbook\u3092\u66f8\u304f\n\n```ruby:site-cookbooks/app/metadata.rb\n...\n\ndepends 'postgresql'\ndepends 'database'\ndepends 'rbenv'\ndepends 'imagemagick'\n```\n\n---\n\n\u30b5\u30fc\u30d0\u306e\u69cb\u6210\u3092\u5b9a\u7fa9\u3059\u308b\n\u203b\u73fe\u72b6\u3001database_user\u304c\u52d5\u304b\u306a\u3044...\n\n```ruby:site-cookbooks/app/recipes/default.rb\ninclude_recipe 'apt'\ninclude_recipe 'postgresql::client'\ninclude_recipe 'postgresql::server'\ninclude_recipe 'postgresql::contrib'\ninclude_recipe \"database::postgresql\"\n\ninclude_recipe 'rbenv::default'\ninclude_recipe 'rbenv::ruby_build'\ninclude_recipe 'imagemagick::default'\n\n# create postgres user\npostgresql_connection_info = {\n  :host     => '127.0.0.1',\n  :port     => node['postgresql']['config']['port'],\n  :username => 'postgres',\n  :password => node['postgresql']['password']['postgres']\n}\n\npostgresql_database_user 'sample-user' do\n  connection postgresql_connection_info\n  password   'ultra_secret'\n  action     :create\nend\n\n# install ruby\nrbenv_ruby \"2.3.1\"\nrbenv_gem \"bundler\" do\n  ruby_version \"2.3.1\"\nend\n\n# libmagickwand-dev\npackage 'libmagickwand-dev' do\n  action :install\nend\n```\n---\n\n## run_list\u3092\u7de8\u96c6\n\u5bfe\u8c61\u306e\u30b5\u30fc\u30d0\u306b\u5bfe\u3057\u3066\u3069\u306erecipe\u3092\u9069\u7528\u3059\u308b\u304b\u6307\u5b9a\u3059\u308b\u3002\n\n```\n$ cd [chef-repo-root]\n$ EDITOR=vim knife node edit vagrant.vm\n...\n\"run_list\": [\n  \"recipe[app::default]\"\n]\n...\n```\n\n---\n\n## cookbook\u3092\u9069\u7528\n```\n$ chef exec knife zero converge name:vagrant.vm --attribute knife_zero.host  -x vagrant --sudo\n```\n## \u78ba\u8a8d\n```\n$ ssh vagrant@192.168.33.10\n\n$ psql\n$ rbenv versions\n```\n\n---\n# \ud83c\udf89\n\n---\n\n# \u53c2\u8003\n- http://qiita.com/dahugani/items/cecfe04cc7ab06461711\n- http://qiita.com/tsuyopooon/items/d90679d9f8b5ccfcfde5\n- http://qiita.com/sawanoboly/items/a2cbd4c42525ae894371\n- https://github.com/kawasakitoshiya/knife-zero-sample\n", "tags": ["chef-zero", "chef", "knife-zero"]}