{"context": "\n\n\u6982\u8981\n\n\n\u672c\u8a18\u4e8b\u306fSORACOM\u30b5\u30fc\u30d3\u30b9\u30ea\u30ea\u30fc\u30b91\u5468\u5e74\u8a18\u5ff5\u30ea\u30ec\u30fc\u30d6\u30ed\u30b010\u670826\u65e5\u5206\u3067\u3059\u3002\n\u3069\u3082\u3001AWS Samurai 2015\u306e\u8fbb\u3067\u3059\u3002\nSORACOM\u306b\u306fIoT\u30d7\u30ec\u30a4\u30e4\u30fc\u306b\u3068\u3063\u3066\u5b09\u3057\u3044\u30b5\u30fc\u30d3\u30b9\u304c\u305f\u304f\u3055\u3093\u3042\u308a\u307e\u3059\u304c\u3001\u305d\u306e\u4e2d\u3067\u3082\u79c1\u304c\u5927\u597d\u304d\u306a\u306e\u304cSORACOM Funnel\u3067\u3059\u3002AWS\u3067\u3042\u308c\u3070Kinesis\u306b\u76f4\u7d50\u3057\u3066\u304f\u308c\u308b\u30b5\u30fc\u30d3\u30b9\u306a\u306e\u3067\u3059\u304c\u3001Kinesis\u81ea\u4f53\u304c\u5272\u3068\u6577\u5c45\u9ad8\u3081\u306a\u30b5\u30fc\u30d3\u30b9\u3067\u3042\u308b\u305b\u3044\u304b\u3001SORACOM Funnel\u306e\u4f7f\u3044\u65b9\u3092\u7d39\u4ecb\u3057\u305f\u8a18\u4e8b\u306f\u30cd\u30c3\u30c8\u4e0a\u306b\u3082\u3042\u307e\u308a\u3042\u308a\u307e\u305b\u3093\u30021\u5468\u5e74\u8a18\u5ff5\u3067\u3059\u306e\u3067\u3001\u53ef\u8996\u5316\u307e\u3067\u542b\u3081\u3066\u624b\u9806\u3092\u5927\u516c\u958b\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3063\uff01\uff01\nSORACOM Funnel\u306e\u4f55\u304c\u3044\u3044\u3063\u3066\u3001\u305d\u308a\u3083\u3041\u3082\u3046\u304a\u5ba2\u69d8\u306b\u300c\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306f\u30fb\u30fb\u30fb\u300d\u3063\u3066\u805e\u304b\u308c\u3066\u3082\u3059\u304b\u3055\u305a\u300c\u9589\u57df\u3060\u304b\u3089\u5927\u4e08\u592b\u3067\u3059\uff01\u300d\u3063\u3066\u30c9\u30e4\u9854\u3067\u304d\u308b\u3068\u3053\u308d\u3067\u3059\u3002\u3057\u304b\u3082IoT\u30c7\u30d0\u30a4\u30b9\u306b\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb(\u8a8d\u8a3c\u60c5\u5831)\u3092\u3082\u305f\u306a\u304f\u3066\u3044\u3044\u306a\u3093\u3066\u307e\u3055\u306b\u5922\u306e\u3088\u3046\u3067\u3059\u3002\u4eca\u56de\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u904a\u3093\u3067\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u306a\u306b\u3084\u3089\u840c\u3048\u30ad\u30e3\u30e9\u304c\u3044\u307e\u3059\u306d\uff01\u53ef\u8996\u5316\u306b\u5229\u7528\u3059\u308bIoT.kyoto VIS\u306e\u30a4\u30e1\u30fc\u30b8\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u300c\u3044\u304a\u305f\u3093(IoTan)\u300d\u3067\u3059\u3002\u3044\u304a\u305f\u3093\u306f\u3053\u3093\u306a\u7d4c\u7def\u3067\u8a95\u751f\u3057\u307e\u3057\u305f\u3002\u305d\u3057\u3066\u5de8\u5927\u5316\u3057\u3066\u76ee\u304b\u3089\u30d3\u30fc\u30e0\u3092\u51fa\u3057\u558b\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\uff01(\u4eca\u56de\u306e\u8a18\u4e8b\u306b\u306f\u5168\u304f\u95a2\u4fc2\u3042\u308a\u307e\u305b\u3093w)\n\n\u524d\u63d0\u6761\u4ef6\n\n\nAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u3082\u3063\u3066\u3044\u308b\u3053\u3068\nSORACOM Air\u3067\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a\u3067\u304d\u308bRaspberryPi\u3092\u3082\u3063\u3066\u3044\u308b\u3053\u3068(\u3053\u306e\u90e8\u5206\u306e\u624b\u9806\u306f\u8aac\u660e\u3057\u307e\u305b\u3093)\nRaspberryPi\u306b\u63a5\u7d9a\u3057\u3066\u8a08\u6e2c\u3067\u304d\u308b\u3001\u7167\u5ea6\u30fb\u6e29\u5ea6\u30fb\u8d85\u97f3\u6ce2\u7b49\u306e\u30bb\u30f3\u30b5\u30fc\u3092\u3082\u3063\u3066\u3044\u308b\u3053\u3068\n\nRASPBIAN JESSIE 2016-05-27\u7248\u3067\u52d5\u4f5c\u78ba\u8a8d\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u3088\u308a\u53e4\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u3060\u3068\u671f\u5f85\u901a\u308a\u306b\u52d5\u4f5c\u3057\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n\n[ToDo 1] RaspberryPi\u3067\u4f55\u304b\u3092\u30bb\u30f3\u30b7\u30f3\u30b0\u3057\u3001\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306b\u4fdd\u5b58\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b(RasPi)\n\nRaspberryPi\u306b\u30bb\u30f3\u30b5\u30fc\u3092\u63a5\u7d9a\u3057\u3001\u8a08\u6e2c\u5024\u3092\u57fa\u306b\u3053\u3093\u306a\u611f\u3058\u306eJSON\u304c\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306b\u4fdd\u5b58\u3067\u304d\u3066\u3044\u308c\u3070OK\u3067\u3059\u3002\u30c7\u30d0\u30a4\u30b9ID\u30fb\u8a08\u6e2c\u5024\u30fb\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u304c\u5fc5\u9808\u3067\u3059\u3002\u4ee5\u5f8c\u3001/home/pi/shodo-logs/shodo-funnel.log\u306b\u30ed\u30b0\u304c\u4fdd\u5b58\u3055\u308c\u308b\u3082\u306e\u3068\u3057\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\n{\"brightness\": 164, \"ID\": \"id000\", \"time_sensor\": \"2016-03-28 15:16:48\"}\n{\"brightness\": 692, \"ID\": \"id000\", \"time_sensor\": \"2016-03-28 15:16:51\"}\n{\"brightness\": 720, \"ID\": \"id000\", \"time_sensor\": \"2016-03-28 15:16:54\"}\n{\"brightness\": 945, \"ID\": \"id000\", \"time_sensor\": \"2016-03-28 15:16:57\"}\n{\"brightness\": 9, \"ID\": \"id000\", \"time_sensor\": \"2016-03-28 15:17:00\"}\n\n\u5b9f\u88c5\u4f8b\u3068\u3057\u3066\u3001\u7167\u5ea6\u30bb\u30f3\u30b5\u30fc\u3092\u4f7f\u3063\u305f\u624b\u9806\u3092\u4ee5\u524d\u306e\u30ea\u30ec\u30fc\u30d6\u30ed\u30b0\u3067\u7d39\u4ecb\u3057\u307e\u3057\u305f\u3002RaspberryPi\u3067\u30bb\u30f3\u30b5\u30fc\u30c7\u30fc\u30bf\u3092fluentd\u3092\u4f7f\u3063\u3066DynamoDB\u306b\u9001\u3063\u3066\u53ef\u8996\u5316\u3057\u3066\u307f\u3088\u3046\uff1c\u5b8c\u5168\u7de8\uff1e\u306e[Todo 0]\u3068[ToDo 1]\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u4ee5\u4e0b\u3001\u6ce8\u610f\u70b9\u3067\u3059\u3002\n\n$ sudo apt-get update\u306f\u5fc5\u305a\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\n\u4eca\u56de\u306fSORACOM Air\u3067\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u63a5\u7d9a\u3057\u307e\u3059\u306e\u3067\u3001\u30ea\u30f3\u30af\u5148[ToDo 1]\u306eWi-Fi\u63a5\u7d9a\u78ba\u8a8d\u3067\u5fc5\u305a\u3057\u3082\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a\u3067\u304d\u3066\u3044\u308b\u5fc5\u8981\u306f\u306a\u304f\u3001SSH\u63a5\u7d9a\u306e\u78ba\u8a8d\u304c\u3067\u304d\u308c\u3070OK\u3067\u3059\u3002\u6709\u7ddaLAN\u63a5\u7d9a\u3084HDMI\u63a5\u7d9a\u306e\u30e2\u30cb\u30bf\u3067\u3082\u4ee3\u7528\u3067\u304d\u307e\u3059\n\u4eca\u56de\u306e\u5b9f\u88c5\u306b\u304a\u3044\u3066\u3001SORACOM Funnel\u306f1\u79d2\u9593\u9694\u3068\u3044\u3063\u305f\u77ed\u3044\u5468\u671f\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\u3068\u51e6\u7406\u304c\u9593\u306b\u5408\u308f\u306a\u3044\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u30023\u79d2\u4ee5\u4e0a\u9593\u9694\u3092\u7a7a\u3051\u3066\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u30ea\u30f3\u30af\u5148[ToDo 1]\u306e\u30b3\u30fc\u30c9\u306f1\u79d2\u9593\u9694\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u4fee\u6b63\u304c\u5fc5\u8981\u3067\u3059\n\n\n[ToDo 2] SORACOM Air\u3067\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a\u3059\u308b(RasPi)\n\nSORACOM\u516c\u5f0f\u30cf\u30f3\u30ba\u30aa\u30f3\u30c6\u30ad\u30b9\u30c8\u304c\u53c2\u8003\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u63a5\u7d9a\u304c\u5b8c\u4e86\u3057\u305f\u3089RaspberryPi\u306bSSH\u3067\u63a5\u7d9a\u3057\u3066\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n$ curl ifconfig.io\n54.250.xxx.xxx\n#IPv6\u30a2\u30c9\u30ec\u30b9\u304c\u8868\u793a\u3055\u308c\u308b\u5834\u5408\u306f\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066\u4e0b\u3055\u3044\n\n$ curl ifconfig.me\n54.250.xxx.xxx\n\n\u8fd4\u308a\u5024(\u30b0\u30ed\u30fc\u30d0\u30ebIP\u30a2\u30c9\u30ec\u30b9)\u304c54.250.xxx.xxx\u3068\u306a\u3063\u3066\u3044\u308c\u3070SORACOM Air\u7d4c\u7531\u3067\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u63a5\u7d9a\u3067\u304d\u3066\u3044\u307e\u3059\u3002\n\n[ToDo 3] API\u30a2\u30af\u30bb\u30b9\u7528\u306eKey\u3092\u4f5c\u6210\u3059\u308b(AWS)\n\nKinesis\u3084DynamoDB\u306bAPI\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306b\u3001AWS\u306eIAM Access Key\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u4eca\u56de\u4f5c\u6210\u3059\u308b\u306e\u306f\u4e0b\u8a18\u306b\u3042\u308b2\u3064\u306e\u30e6\u30fc\u30b6\u30fc\u304a\u3088\u3073\u305d\u308c\u306b\u3072\u3082\u4ed8\u304fKey\u3067\u3059\u3002\n\u624b\u9806\u306f\u3053\u3061\u3089\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002(\u624b\u629c\u304d\u3067\u3059\u3044\u307e\u305b\u3093\u6c57)\n\n\n\n\u30e6\u30fc\u30b6\u30fc\u540d\n\u30a2\u30af\u30bb\u30b9\u6a29\n\u4f7f\u7528\u7b87\u6240\n\n\n\n\nKinesis-full\nAmazonKinesisFullAccessAmazonKinesisFirehoseFullAccess\nFunnel\u304b\u3089Kinesis\u3078\u306e\u66f8\u304d\u8fbc\u307f\n\n\ndynamo-read\nAmazonDynamoDBReadOnlyAccess\nIoT.kyoto\u304b\u3089DynamoDB\u3078\u306e\u8aad\u307f\u51fa\u3057\n\n\n\n\n[ToDo 4] Kinesis\u306e\u8a2d\u5b9a(AWS)\n\n\u4eca\u56de\u306f\u52d5\u4f5c\u78ba\u8a8d\u7528\u3068\u3057\u3066\u3001S3 / Redshift / Elasticsearch Service\u306b\u30ed\u30b0\u3092\u914d\u9001\u3057\u3066\u304f\u308c\u308bKinesis Firehose\u3068\u3001\u6982\u8981\u306e\u56f3\u3067\u767b\u5834\u3057\u3066\u3044\u308bKinesis Streams\u3092\u5229\u7528\u3057\u307e\u3059\u3002\nKinesis Streams\u3092\u3056\u3063\u304f\u308a\u8aac\u660e\u3059\u308b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u3057\u3087\u3046\u304b\u3002\n\nStream\u306b\u30c7\u30fc\u30bf\u3092\u306b\u6295\u3052\u8fbc\u3080\u3068\u4e00\u5b9a\u671f\u9593(\u30c7\u30d5\u30a9\u30eb\u30c8\u306724\u6642\u9593)\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3066\u304f\u308c\u3066\u3001\u305d\u306e\u9593\u306b\u30c7\u30fc\u30bf\u3092\u53d6\u308a\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u308b\n\u30c7\u30fc\u30bf\u306f\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u3092\u3064\u3051\u3066\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306bHTTPS\u3067POST\u3059\u308b\n\u30c7\u30fc\u30bf\u306e\u53d6\u308a\u51fa\u3057\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u671f\u9593\u4e2d\u4f55\u56de\u3067\u3082OK\n\u30b5\u30a4\u30b8\u30f3\u30b0\u306f\u300c\u30b7\u30e3\u30fc\u30c9\u300d\u3068\u3044\u3046\u5358\u4f4d\u3067\u6307\u5b9a\n\u30b7\u30e3\u30fc\u30c9\u3092\u30aa\u30fc\u30c8\u30b9\u30b1\u30fc\u30eb\u3059\u308b\u6a5f\u80fd\u306f\u306a\u3044\n1\u30b7\u30e3\u30fc\u30c9\u3067\u6700\u59271000\u30e1\u30c3\u30bb\u30fc\u30b8\uff0f\u79d2\u3082\u3055\u3070\u3044\u3066\u304f\u308c\u308b\u306e\u3067\u3001\u30b9\u30d1\u30a4\u30af\u304c\u6765\u3066\u3082\u5b89\u5fc3\n\u30b7\u30e3\u30fc\u30c9\u3092\u62e1\u5f35\u3057\u3066\u3082\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306f1\u3064\u306e\u307e\u307e\u3002\u3088\u308d\u3057\u304f\u5206\u6563\u3057\u3066\u304f\u308c\u308b(\u5206\u6563\u51e6\u7406\u306e\u305f\u3081\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u30ad\u30fc\u306e\u6307\u5b9a\u304c\u5fc5\u8981)\n\u30de\u30cd\u30fc\u30b8\u30c9\u30b5\u30fc\u30d3\u30b9\u306a\u306e\u3067\u30a4\u30f3\u30d5\u30e9\u306e\u904b\u7528\u306f\u4e0d\u8981\u3002SPOF\u3082\u8003\u616e\u3057\u306a\u304f\u3066\u826f\u3044\n\nKinesis Streams\u306f\u30c7\u30fc\u30bf\u3092\u53d6\u308a\u51fa\u3057\u3066\u51e6\u7406\u3092\u3059\u308b\u90e8\u5206(Kinesis App)\u3092Lambda\u306a\u3069\u3067\u958b\u767a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001Kinesis Firehose\u3092\u4f7f\u3048\u3070S3 / Redshift / Elasticsearch Service\u306e\u3069\u308c\u304b\u306b\u30c7\u30fc\u30bf\u3092\u914d\u9001\u3057\u3066\u304f\u308c\u307e\u3059\u3002Kinesis Firehose\u306e\u4ed5\u69d8\u306fKinesis Streams\u3068\u306f\u82e5\u5e72\u7570\u306a\u308a\u307e\u3059\u306e\u3067\u3001\u8a73\u7d30\u306f\u4e0a\u8a18\u30ea\u30f3\u30af\u5148\u3092\u53c2\u7167\u3057\u3066\u4e0b\u3055\u3044\u3002\n\nAWS IoT\u3068\u4f55\u304c\u9055\u3046\u306e\uff1f\nIoT\u5411\u3051\u306e\u540c\u3058\u3088\u3046\u306a\u6a5f\u80fd\u3092\u6301\u3064\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066AWS IoT\u304c\u3042\u308a\u307e\u3059\u3002\u8aa4\u89e3\u3092\u6050\u308c\u305a\u3056\u3063\u304f\u308a\u3068\u9055\u3044\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\n\n\u5168\u30ce\u30fc\u30c9\u5408\u8a08\u30671\u30e1\u30c3\u30bb\u30fc\u30b8\uff0f\u79d2\u3092\u8d85\u3048\u308b\u3088\u3046\u306a\u5834\u5408\u306f\u3001AWS IoT\u306e\u65b9\u304c\u5272\u9ad8\nKinesis\u306e\u5bfe\u5fdc\u30d7\u30ed\u30c8\u30b3\u30eb\u306fHTTPS\u306e\u307f\u3001AWS IoT\u306fMQTT\u306a\u3069\u69d8\u3005\u306a\u30d7\u30ed\u30c8\u30b3\u30eb\u306b\u5bfe\u5fdc\n1\u30e1\u30c3\u30bb\u30fc\u30b8\u3042\u305f\u308a\u306e\u6700\u5927\u30da\u30a4\u30ed\u30fc\u30c9\u306f\u3001Kinesis -> 1MB \u3001AWS IoT ->128KB\nKinesis\u306f\u30c7\u30d0\u30a4\u30b9-> \u30af\u30e9\u30a6\u30c9\u306e1\u65b9\u5411\u306e\u307f\u3001AWS IoT\u306f\u30af\u30e9\u30a6\u30c9\u5074\u304b\u3089\u30c7\u30d0\u30a4\u30b9\u3092\u5236\u5fa1\u3067\u304d\u308b\n\nAWS IoT\u306e\u65b9\u304c\u9ad8\u6a5f\u80fd\u306a\u5206\u5272\u9ad8\u3068\u8a00\u3048\u305d\u3046\u3067\u3059\u306d\u3002\u8981\u4ef6\u306b\u5408\u308f\u305b\u3066\u3046\u307e\u304f\u4f7f\u3044\u5206\u3051\u307e\u3057\u3087\u3046\u3002\n\nKinesis Firehose\u306e\u8a2d\u5b9a\n\nKinesis\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u958b\u304f\nKinesis Firehose\u306f2016\u5e7410\u6708\u73fe\u5728\u3001\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u63d0\u4f9b\u3055\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u5229\u7528\u53ef\u80fd\u306a\u5317\u30d0\u30fc\u30b8\u30cb\u30a2(N.Virginia)\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u9078\u629e\u3059\u308b\n\n\n[Go to Firehose]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n\n[Create Delivery Stream]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n\n\u914d\u9001\u5148\u306b[Amazon S3]\u3092\u9078\u629e\u3059\u308b\n\n\nStream Name\u3092\u5165\u529b\u3057\u3001\u30ed\u30b0\u3092\u683c\u7d0d\u3059\u308bS3\u30d0\u30b1\u30c3\u30c8\u3092\u9078\u629e(\u3053\u3053\u3067\u306f\u3068\u3082\u306b\u300ciotan-f\u300d\u3068\u3057\u3066\u3044\u308b)\u3059\u308b\u3002\u30d0\u30b1\u30c3\u30c8\u306f\u3053\u3053\u3067\u4f5c\u6210\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\n\u30ed\u30b0\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067Stream\u540d+\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3068\u306a\u308b\u304c\u3001\u5fc5\u8981\u3067\u3042\u308c\u3070\u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u6307\u5b9a\u3059\u308b\n[Next]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n\nBuffer interval(S3\u3078\u306e\u9001\u4fe1\u9593\u9694)\u3092\u6307\u5b9a\u3059\u308b\u3002\u6700\u5c0f\u5024\u306f60\u79d2\nIAM role\u3067[Firehose Delivery IAM role]\u3092\u9078\u629e\u3059\u308b\n\u4ed6\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067OK\n\n\n\u305d\u306e\u307e\u307e[Allow]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n\n\u305d\u306e\u307e\u307e[Next]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n\n[Create Delivery Stream]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n\nS3\u914d\u9001Stream\u304c\u4f5c\u6210\u3055\u308c\u305f\u3002[ACTIVE]\u306b\u306a\u3063\u305f\u3089\u5229\u7528\u53ef\u80fd\n\n\n\n\nKinesis Streams\u306e\u8a2d\u5b9a\n\nKinesis\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u958b\u304f\n\u3068\u304f\u306b\u7406\u7531\u304c\u306a\u3051\u308c\u3070\u3001\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u9762\u3067\u6709\u5229\u306a\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u9078\u629e\u3059\u308b\n\n\n[Go to Streams]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n\n[Create Stream]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n\nStream Name\u3092\u5165\u529b(\u3053\u3053\u3067\u306f\u300ciotan-s\u300d\u3068\u3057\u3066\u3044\u308b)\u3059\u308b\n\u30b7\u30e3\u30fc\u30c9\u6570\u3092\u5165\u529b\u3059\u308b\u30021\u3067\u5145\u5206\n[Create]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n\nStream\u304c\u4f5c\u6210\u3055\u308c\u305f\u3002[ACTIVE]\u306b\u306a\u3063\u305f\u3089\u5229\u7528\u53ef\u80fd\n\n\n\n\n[ToDo 5] SORACOM Funnel\u306e\u8a2d\u5b9a(SORACOM)\n\n\nSORACOM\u30e6\u30fc\u30b6\u30fc\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u958b\u304f\n[\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3]\u306e\u753b\u9762\u3092\u958b\u304f\n\n\n[\u8a8d\u8a3c\u60c5\u5831\u30b9\u30c8\u30a2] -> [\u8a8d\u8a3c\u60c5\u5831\u3092\u767b\u9332]\n\n\n\u4efb\u610f\u306e\u8a8d\u8a3c\u60c5\u5831ID(\u3053\u3053\u3067\u306f\u300ciotan-kinesis\u300d\u3068\u3057\u3066\u3044\u308b)\u3092\u5165\u529b\u3059\u308b\n[Todo 2]\u3067\u4f5c\u6210\u3057\u305f\u300ckinesis-full\u300d\u306e\u8a8d\u8a3c\u60c5\u5831\u3092\u5165\u529b\u3059\u308b\n\n[\u767b\u9332]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n\n\u8a8d\u8a3c\u60c5\u5831\u304c\u767b\u9332\u3055\u308c\u305f\n\n\n[\u30b0\u30eb\u30fc\u30d7]\u306e\u753b\u9762\u3092\u958b\u304f\n\n\n[\u8ffd\u52a0]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\u4efb\u610f\u306e\u30b0\u30eb\u30fc\u30d7\u540d(\u3053\u3053\u3067\u306f\u300ciotan-kinesis\u300d\u3068\u3057\u3066\u3044\u308b)\u3092\u5165\u529b\u3057\u3066[\u30b0\u30eb\u30fc\u30d7\u4f5c\u6210]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n\n\u767b\u9332\u6e08\u307f\u306e\u30b0\u30eb\u30fc\u30d7\u304c\u4e00\u89a7\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u5148\u307b\u3069\u767b\u9332\u3057\u305f\u30b0\u30eb\u30fc\u30d7\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n[SORACOM Funnel \u8a2d\u5b9a]\u3092\u5c55\u958b\u3059\u308b\n\u307e\u305a\u306f\u52d5\u4f5c\u78ba\u8a8d\u3067Kinesis Firehose\u306b\u30c7\u30fc\u30bf\u3092\u6d41\u3059\u306e\u3067\u3001\u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7\u3067[Kinesis Firehose]\u3092\u9078\u629e\u3059\u308b\n\u30ea\u30bd\u30fc\u30b9URL\u306f\u6b21\u306e\u3088\u3046\u306b\u5165\u529b\u3059\u308bhttps://kfirehose.us-east-1.amazonaws.com/{stream_name}  (\u5317\u30d0\u30fc\u30b8\u30cb\u30a2\u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u5834\u5408)\n\u8a8d\u8a3c\u60c5\u5831\u306f\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u8a8d\u8a3c\u60c5\u5831\u540d\u3092\u9078\u629e\u3059\u308b\n\u9001\u4fe1\u3059\u308b\u30c7\u30fc\u30bf\u5f62\u5f0f\u306f[JSON]\u3092\u9078\u629e\u3059\u308b\n[\u4fdd\u5b58]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n\n[SIM\u7ba1\u7406]\u306e\u753b\u9762\u3092\u958b\u304f\n\n\nRaspberryPi\u306e\u901a\u4fe1\u306b\u4f7f\u7528\u3057\u3066\u3044\u308bSIM\u3092\u9078\u629e\u3057\u3066\u53f3\u30af\u30ea\u30c3\u30af -> [\u6240\u5c5e\u30b0\u30eb\u30fc\u30d7\u5909\u66f4]\n\n\n\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u30b0\u30eb\u30fc\u30d7\u3092\u9078\u629e\u3057\u3001[\u30b0\u30eb\u30fc\u30d7\u5909\u66f4]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n\n\u6240\u5c5e\u30b0\u30eb\u30fc\u30d7\u304c\u5909\u66f4\u3055\u308c\u305f\n\n\n\n\n\u30c7\u30fc\u30bf\u306e\u914d\u9001\u5148\u3092Kinesis Streams\u306b\u5909\u66f4\u3059\u308b\n[ToDo 8]\u3067Kinesis Firehose\u306b\u3088\u308bSORACOM Funnel\u306e\u52d5\u4f5c\u78ba\u8a8d\u304c\u7d42\u308f\u3063\u305f\u3089\u4e0b\u8a18\u306e\u624b\u9806\u3067\u914d\u9001\u5148\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\n[\u30b0\u30eb\u30fc\u30d7]\u306e\u753b\u9762\u3092\u958b\u304f\n\n\n\u767b\u9332\u6e08\u307f\u306e\u30b0\u30eb\u30fc\u30d7\u304c\u4e00\u89a7\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u5148\u307b\u3069\u767b\u9332\u3057\u305f\u30b0\u30eb\u30fc\u30d7\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n[SORACOM Funnel \u8a2d\u5b9a]\u3092\u5c55\u958b\u3059\u308b\n\u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7\u3067[Kinesis Streams]\u3092\u9078\u629e\u3059\u308b\n\u30ea\u30bd\u30fc\u30b9URL\u306f\u6b21\u306e\u3088\u3046\u306b\u5165\u529b\u3059\u308bhttps://kinesis.ap-northeast-1.amazonaws.com/{stream_name}  (\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u5834\u5408)\n[\u4fdd\u5b58]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n\n\n\n[ToDo 6] fluentd\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb(RasPi)\n\nRaspberryPi\u304b\u3089\u306e\u30c7\u30fc\u30bf\u914d\u9001\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3068\u3057\u3066fluentd\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u52d5\u4f5c\u6982\u5ff5\u306b\u3064\u3044\u3066\u306f\u3053\u3061\u3089\u3092\u53c2\u7167\u4e0b\u3055\u3044\u3002\u4eca\u56de\u306foutput\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u3057\u3066\u300cout-http\u30d7\u30e9\u30b0\u30a4\u30f3\u300d\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u4ed6\u306b\u306f\u30ea\u30f3\u30af\u5148\u306b\u3042\u308b\u3088\u3046\u306bDynamoDB\u306b\u914d\u9001\u3057\u305f\u308a\u3001Kinesis\u3084S3\u306b\u914d\u9001\u3059\u308b\u3053\u3068\u306a\u3069\u3082\u3067\u304d\u307e\u3059\u3002\n\u300cout-http\u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u300d\u5358\u306bHTTP\u3067POST\u3059\u308b\u3060\u3051\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3059\u3002\u305d\u3046\u3001\u6697\u53f7\u5316\u3082\u3057\u307e\u305b\u3093\u3002\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5927\u4e08\u592b\u306a\u306e\uff1f\u3068\u601d\u3063\u305f\u3042\u306a\u305f\u306fSORACOM Funnel\u306e\u30b5\u30fc\u30d3\u30b9\u8aac\u660e\u3092\u719f\u8aad\u3057\u307e\u3057\u3087\u3046\u3002\u30e2\u30d0\u30a4\u30eb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4e0a\u306e\u6697\u53f7\u5316\u306f3G\u7db2\u5074\u306b\u30aa\u30d5\u30ed\u30fc\u30c9\u3055\u308c\u3001AWS\u3078\u306e\u8a8d\u8a3c\u3084\u6697\u53f7\u5316\u306fSORACOM Funnel\u304c\u3088\u308d\u3057\u304f\u3084\u3063\u3066\u304f\u308c\u307e\u3059\u3002\u305d\u3046\u3001IoT\u958b\u767a\u8005\u306b\u3068\u3063\u3066\u9762\u5012\u81ed\u3044\u3068\u3053\u308d\u306fSORACOM\u3055\u3093\u304c\u9811\u5f35\u3063\u3066\u304f\u308c\u308b\u306e\u3067\u3059\u3002\u7d20\u6575(\u306f\u3041\u3068\u3002\u3055\u3089\u306bKinesis\u307e\u3067\u9589\u57df\u7db2\u76f8\u5f53\u3067\u63a5\u7d9a\u3067\u304d\u308b\u306e\u3067\u3059\u3002\u3082\u3046\u62b1\u3044\u3066w\u3002\u300c\u76f8\u5f53\u300d\u3068\u66f8\u3044\u305f\u306e\u306f\u3001Kinesis\u304c\u30e6\u30fc\u30b6\u30fc\u6bce\u306e\u9589\u3058\u305f\u74b0\u5883(AWS\u3067\u3044\u3046VPC)\u5185\u306b\u3042\u308b\u308f\u3051\u3058\u3083\u306a\u304f\u3066\u3001AWS\u30e6\u30fc\u30b6\u30fc\u5171\u7528\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7a7a\u9593\u306b\u5b58\u5728\u3059\u308b\u304b\u3089\u3067\u3059\u3002\n\u4ee5\u4e0b\u3001RaspberryPi\u3078\u306efluentd\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\u3067\u3059\u3002\n\nfluentd\u672c\u4f53\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u6570\u5206\u304b\u304b\u308a\u307e\u3059\u3002\n$ sudo apt-get install ruby-dev libssl-dev\n$ sudo gem install fluentd --no-ri --no-rdoc\n\n\u203b\u4eca\u56de\u4f7f\u3046out-http\u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u3042\u308b0.14\u7cfb\u3067\u52d5\u4f5c\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u4ed6\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3082\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f0.12\u7cfb\u306e\u6700\u65b0\u7248\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u65b9\u304c\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u305d\u306e\u5834\u5408\u306e\u30b3\u30de\u30f3\u30c9\u306f\u4e0b\u8a18\n$ sudo gem install fluentd -v \"~> 0.12.0\" --no-ri --no-rdoc\n\n\nout-http\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u6570\u5206\u304b\u304b\u308a\u307e\u3059\u3002\n$ sudo fluent-gem install fluent-plugin-out-http --no-ri --no-rdoc\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u78ba\u8a8d\n\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u82e5\u5e72\u7570\u306a\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n$ sudo gem list fluent\n*** LOCAL GEMS ***\nfluent-plugin-out-http (0.1.4)\nfluentd (0.14.4, 0.10.61)\n\n\n[ToDo 7] fluentd\u306e\u8a2d\u5b9a(RasPi)\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3068\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\u30bb\u30f3\u30b5\u30fc\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb(.log\u3068.pos)\u306e\u30d1\u30b9\u306f\u9069\u5b9c\u66f8\u304d\u63db\u3048\u3066\u4e0b\u3055\u3044\u3002\n$ sudo touch /home/pi/shodo-logs/shodo-funnel.pos\n$ sudo mkdir /fluent\n$ sudo touch /fluent/fluent.log\n$ sudo vim /fluent/fluent.conf\n\n\nfluent.conf\n<source>\n  # input\u306btail\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u6307\u5b9a\n  @type tail\n  # \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u6307\u5b9a\n  format json\n  # \u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u30d5\u30eb\u30d1\u30b9\u3067\u6307\u5b9a\n  path /home/pi/shodo-logs/shodo-funnel.log\n  # \u30d5\u30a1\u30a4\u30eb\u5185\u306e\u3069\u306e\u884c\u307e\u3067\u3092\u8aad\u3093\u3060\u304b\u3092\u8a18\u9332\u3057\u3066\u304a\u304f\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\n  pos_file /home/pi/shodo-logs/shodo-funnel.pos\n  # \u5206\u304b\u308a\u3084\u3059\u3044\u30bf\u30b0\u3092\u6307\u5b9a\n  tag funnel.shodo\n</source>\n# \u4ee5\u4e0b\u306e\u30bf\u30b0\u306b\u30de\u30c3\u30c1\u3057\u305f\u3082\u306e\u3060\u3051output\u51e6\u7406\u3055\u308c\u308b\n<match funnel.**>\n  @type http\n  # SORACOM Funnel\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u6307\u5b9a\n  endpoint_url    http://funnel.soracom.io/\n  #\u4ee5\u4e0b\u3001\u5404\u7a2e\u8a2d\u5b9a\n  http_method     post   # default: post\n  serializer      json   # default: form\n  rate_limit_msec 100    # default: 0 = no rate limiting\n  raise_on_error  false  # default: true\n</match>\n\n\n\n\u30c6\u30b9\u30c8\n[error]\u306e\u884c\u304c\u306a\u3044\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ sudo fluentd -c /fluent/fluent.conf --dry-run\n\n2016-10-20 19:35:36 +0900 [info]: reading config file path=\"/fluent/fluent.conf\"\n2016-10-20 19:35:36 +0900 [info]: starting fluentd-0.14.4 as dry run mode\n2016-10-20 19:35:36 +0900 [info]: gem 'fluent-plugin-out-http' version '0.1.4'\n2016-10-20 19:35:36 +0900 [info]: gem 'fluentd' version '0.14.4'\n2016-10-20 19:35:36 +0900 [info]: gem 'fluentd' version '0.10.61'\n2016-10-20 19:35:36 +0900 [info]: adding match pattern=\"funnel.**\" type=\"http\"\n2016-10-20 19:35:36 +0900 [info]: adding source type=\"tail\"\n2016-10-20 19:35:36 +0900 [info]: using configuration file: <ROOT>\n  <source>\n    @type tail\n    format json\n    path \"/home/pi/shodo-logs/shodo-funnel.log\"\n    pos_file \"/home/pi/shodo-logs/shodo-funnel.pos\"\n    tag \"funnel.shodo\"\n  </source>\n  <match funnel.**>\n    @type http\n    endpoint_url \"http://funnel.soracom.io/\"\n    http_method \"post\"\n    serializer \"json\"\n    rate_limit_msec 100\n    raise_on_error false\n  </match>\n</ROOT>\n\n\nfluentd\u3092\u5b9f\u884c\u3059\u308b\n$ sudo fluentd -c /fluent/fluent.conf -v -o /fluent/fluent.log &\n[1] 20284\n\n\u6b63\u5e38\u306b\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u306f/fluent/fluent.log\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u8d77\u52d5\u6642\u306b\u81ea\u52d5\u5b9f\u884c\u3059\u308b\u5834\u5408\u306f\u3001/etc/rc.local\u306b\u8a18\u8ff0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u203b\u300c20284\u300d\u306fPID\u306a\u306e\u3067\u3001\u5024\u306f\u5b9f\u884c\u306e\u5ea6\u306b\u5909\u308f\u308a\u307e\u3059\n\n[ToDo 8] Kinesis Firehose\u306b\u30c7\u30fc\u30bf\u3092\u6d41\u3057\u3066\u307f\u308b(\u4e3b\u306bAWS)\n\n\u30bb\u30f3\u30b7\u30f3\u30b0\u3092\u958b\u59cb\u3057\u3066\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306bJSON\u304c\u66f8\u304d\u8fbc\u307e\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u6b63\u3057\u304f\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308c\u3070\u3001S3\u30d0\u30b1\u30c3\u30c8\u306b\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u304c\u66f8\u304d\u8fbc\u307e\u308c\u308b\u306f\u305a\u3067\u3059\u3002\u30ed\u30b0\u306fBuffer interval\u3067\u6307\u5b9a\u3057\u305f\u79d2\u6570(\u30c7\u30d5\u30a9\u30eb\u30c8\u306f300\u79d2)\u3054\u3068\u306b\u66f8\u304d\u8fbc\u307e\u308c\u308b\u306e\u3067\u3001S3\u30d0\u30b1\u30c3\u30c8\u306b\u4fdd\u5b58\u3055\u308c\u308b\u307e\u3067\u30bf\u30a4\u30e0\u30e9\u30b0\u304c\u3042\u308a\u307e\u3059\u3002\n\u6b63\u3057\u304f\u52d5\u4f5c\u3057\u3066\u3044\u306a\u3051\u308c\u3070/fluent/fluent.log\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n\nKinesis Firehose\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u958b\u304f\nStream\u3092\u9078\u629e -> [Actions] -> [Monitor]\n\n\n\u6298\u308c\u7dda\u30b0\u30e9\u30d5\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308c\u3070\u6b63\u5e38\u306b\u52d5\u4f5c\u3057\u3066\u3044\u308b\n\n\nS3\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u958b\u304f\nKinesis Firehose\u306e\u8a2d\u5b9a\u3067\u6307\u5b9a\u3057\u305f\u30d0\u30b1\u30c3\u30c8\u3092\u958b\u304f\n\u30ed\u30b0\u304c\u66f8\u304d\u8fbc\u307e\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b(\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u306fUTC)\n\n\n\u30ed\u30b0\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u958b\u304f\u3068JSON\u304c\u66f8\u304d\u8fbc\u307e\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\n\n\n\n\n[ToDo 9] Lambda Function\u3092\u4f5c\u6210\u3059\u308b(AWS)\n\n\u5148\u307b\u3069\u306fKinesis Firehose\u304cS3\u30d0\u30b1\u30c3\u30c8\u306b\u30c7\u30fc\u30bf\u3092\u914d\u9001\u3057\u3066\u304f\u308c\u307e\u3057\u305f\u304c\u3001DynamoDB\u306b\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3059\u308b\u306b\u306fRaspberryPi -> Kinesis Streams -> Lambda -> DynamoDB\u3068\u3044\u3046\u30c7\u30fc\u30bf\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u69cb\u7bc9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002Kinesis Streams\u306b\u30c7\u30fc\u30bf\u304c\u66f8\u304d\u8fbc\u307e\u308c\u305f\u3053\u3068\u3092\u30c8\u30ea\u30ac\u30fc\u306bLambda Function\u304c\u8d77\u52d5\u3057\u3066\u3001DynamoDB\u306b\u30c7\u30fc\u30bf\u3092\u66f8\u304d\u8fbc\u307f\u307e\u3059\u3002\u3067\u306f\u3001Lambda Function\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\u3002\n\nasync\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u53d6\u5f97\u3059\u308b\nLambda Function\u306f\u3001Java / NodeJS / Python\u3067\u8a18\u8ff0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u304c\u3001\u4eca\u56de\u306fNodeJS\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u5b9f\u884c\u306b\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u306f\u3001\u3042\u3089\u304b\u3058\u3081\u5b9f\u884c\u3059\u308b\u30b3\u30fc\u30c9\u3068\u3068\u3082\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30e9\u30a4\u30d6\u30e9\u30ea\u306fLinux\u74b0\u5883\u3067npm\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066\u53d6\u5f97\u3057\u307e\u3059\u3002\u3082\u3061\u308d\u3093\u3001RaspberryPi\u3082\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n$ cd ~\n$ sudo apt-get install -y npm\n$ mkdir node-lib\n$ cd node-lib\n$ npm install async\n$ ls -l\ntotal 4\ndrwxr-xr-x 3 pi pi 4096 Oct 20 23:03 node_modules\n\nnode-lib/node_modules/\u306b\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3001node_modules\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3054\u3068SFTP\u7b49\u3067PC\u30ed\u30fc\u30ab\u30eb\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\nLambda Function\u7528\u306e\u30b3\u30fc\u30c9\u3092\u4f5c\u6210\u3059\u308b\n\nPC\u306e\u30c6\u30ad\u30b9\u30c8\u30a8\u30c7\u30a3\u30bf\u3067index.js\u3068\u3044\u3046\u540d\u524d\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\u30b3\u30e1\u30f3\u30c8\u884c\u306e\u7b87\u6240\u306f\u9069\u5b9c\u4fee\u6b63\u3059\u308b\n\n\nindex.js\nvar AWS = require('aws-sdk');\nvar async = require('async');\n//DynamoDB\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3059\u308b\nvar dynamodb = new AWS.DynamoDB({region: 'ap-northeast-1'});\n\nvar get_current_timestamp = function() {\n    var d = new Date();\n    var month  = d.getMonth() + 1;\n    var day    = d.getDate();\n    var hour   = d.getHours();\n    var minute = d.getMinutes();\n    var second = d.getSeconds();\n\n    if (month < 10) {month = \"0\" + month;}\n    if (day < 10) {day = \"0\" + day;}\n    if (hour < 10) {hour = \"0\" + hour;}\n    if (minute < 10) {minute = \"0\" + minute;}\n    if (second < 10) {second = \"0\" + second;}\n\n    return d.getFullYear()  + \"-\" + month + \"-\" + day + \"T\" + hour + \":\" + minute + \":\" + second + \"Z\";\n}\n\nexports.handler = function(event, context) {\n    async.eachSeries(event.Records, function(v, callback){\n        var encodedPayload = v.kinesis.data;\n        var payload = new Buffer(encodedPayload, 'base64').toString('ascii');\n        var data = JSON.parse(payload);\n        if(typeof data.operatorId != \"undefined\"){\n          var params = {\n            Item: {\n                //\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u306ekey\u540d\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3059\u308b\n                'time_sensor': { S: data.payloads.time_sensor},\n                //Lambda\u306e\u51e6\u7406\u6642\u523b\u3092UTC\u3067\u8a18\u9332\u3059\u308b\n                'time_lambda': { S: get_current_timestamp()},\n                //\u30c7\u30d0\u30a4\u30b9ID\u306ekey\u540d\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3059\u308b\n                'ID': { S: data.payloads.ID},\n                //\u30bb\u30f3\u30b5\u30fc\u8a08\u6e2c\u5024\u306ekey\u540d\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3059\u308b\n                'brightness': { N: String(data.payloads.brightness)}\n            },\n            //DynamoDB\u306e\u30c6\u30fc\u30d6\u30eb\u540d\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3059\u308b\n            'TableName': 'iotan-funnel'\n          };\n        }else{\n          console.log('NOT SORACOM');\n        }\n        dynamodb.putItem(params, function(err) {\n            if (err) console.log(err, err.stack); callback();\n        });\n    }, function(err,result){\n        if (err) {\n            context.fail(err);\n        } else {\n            context.succeed('success');\n        }\n    });\n}\n\n\n\n\nindex.js\u3068\u5148\u307b\u3069\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305fnode_modules\u3092myfunc.zip\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u540d\u3067ZIP\u5727\u7e2e\u3059\u308b\n\n\n\n\nLambda Function\u3092\u4f5c\u6210\u3059\u308b\n\nLambda\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u958b\u304f\n\u30ea\u30fc\u30b8\u30e7\u30f3\u304c\u300cAsia Pacific (Tokyo)\u300d\u3067\u306a\u3044\u5834\u5408\u306f\u5909\u66f4\u3059\u308b\n\n\n[Get Started Now]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n\n[Blank Function]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n\n\u70b9\u7dda\u56f2\u307f\u3092\u30af\u30ea\u30c3\u30af -> [Kinesis] -> [Next]\n\n\nKinesis stream\u3067[ToDo 4]\u3067\u4f5c\u6210\u3057\u305fStream\u3092\u9078\u629e\u3059\u308b\nStarting position\u3067[Trim horizon]\u3092\u9078\u629e\u3059\u308b\n[Enable trigger]\u306b\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u308b\n[Next]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n\nName\u306b\u4efb\u610f\u306eFunction\u540d(\u3053\u3053\u3067\u306f\u300ciotan-funnel\u300d\u3068\u3057\u3066\u3044\u308b)\u3092\u5165\u529b\u3059\u308b\n\n\n\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fmyfunc.zip\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\n\n\nRole\u3067[Create a custom role]\u3092\u9078\u629e\u3059\u308b\n\u65b0\u3057\u3044\u30bf\u30d6\u3067\u30ed\u30fc\u30eb\u306e\u8a2d\u5b9a\u753b\u9762\u304c\u958b\u304f\n\n\nRole Name\u306b\u4efb\u610f\u306e\u30ed\u30fc\u30eb\u540d(\u3053\u3053\u3067\u306f\u300clambda_DynamoDB\u300d\u3068\u3057\u3066\u3044\u308b)\u3092\u5165\u529b\u3059\u308b\n[Edit]\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001\u30c6\u30ad\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u306eJSON\u3092\u524a\u9664\u3057\u3066\u4e0b\u8a18\u306eJSON\u3092\u8cbc\u308a\u4ed8\u3051\u308b\n\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"Stmt1428341300017\",\n            \"Action\": [\n                \"dynamodb:DeleteItem\",\n                \"dynamodb:GetItem\",\n                \"dynamodb:PutItem\",\n                \"dynamodb:Query\",\n                \"dynamodb:Scan\",\n                \"dynamodb:UpdateItem\"\n            ],\n            \"Effect\": \"Allow\",\n            \"Resource\": \"*\"\n        },\n        {\n            \"Sid\": \"\",\n            \"Resource\": \"*\",\n            \"Action\": [\n                \"logs:CreateLogGroup\",\n                \"logs:CreateLogStream\",\n                \"logs:PutLogEvents\"\n            ],\n            \"Effect\": \"Allow\"\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"lambda:InvokeFunction\"\n            ],\n            \"Resource\": \"*\"\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"kinesis:*\"\n            ],\n            \"Resource\": \"*\"\n        }\n    ]\n}\n\n\n[Allow]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u30bf\u30d6\u304c\u9589\u3058\u308b\n\n\n\u5143\u306e\u753b\u9762\u306b\u623b\u3063\u3066\u3001Timeout\u309230\u79d2\u306b\u8a2d\u5b9a\u3059\u308b\n[Next]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n\n\u30ed\u30fc\u30eb\u540d\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066[Create function]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3002\u3082\u3057\u3001\u30ed\u30fc\u30eb\u304c\u5f53\u305f\u3063\u3066\u3044\u306a\u3044\u5834\u5408\u306f[Edit]\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u4fee\u6b63\u3059\u308b\n\n\n\n\n[ToDo 10] DynamoDB\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3059\u308b(AWS)\n\nkey\u540d\u306f[ToDo 9]\u3067\u8a2d\u5b9a\u3057\u305f\u3082\u306e\u3068\u540c\u3058\u3082\u306e\u3092\u5165\u529b\u3057\u3066\u4e0b\u3055\u3044\u3002\n\nDynamoDB\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u958b\u304f\n\u30ea\u30fc\u30b8\u30e7\u30f3\u304c\u300cAsia Pacific (Tokyo)\u300d\u3067\u306a\u3044\u5834\u5408\u306f\u5909\u66f4\u3059\u308b\n\n\n[Create table]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n\n\nTable name\u306b\u5148\u307b\u3069Lambda\u3067\u6307\u5b9a\u3057\u305f\u30c6\u30fc\u30d6\u30eb\u540d(\u3053\u3053\u3067\u306f\u300ciotan-funnel\u300d\u3068\u3057\u3066\u3044\u308b)\u3092\u5165\u529b\u3059\u308b\nPartition key\u306b\u30c7\u30d0\u30a4\u30b9ID\u306eKey(\u3053\u3053\u3067\u306f\u300cID\u300d\u3068\u3057\u3066\u3044\u308b)\u3092\u5165\u529b\u3059\u308b\n[Add sort key]\u306b\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u3001\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u306eKey(\u3053\u3053\u3067\u306f\u306f\u300ctime_sensor\u300d\u3068\u3057\u3066\u3044\u308b)\u3092\u5165\u529b\u3059\u308b\n[Create]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n\n\u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\u304c\u7d42\u308f\u308b\u306e\u3092\u5f85\u3064\n\n\n[ToDo 11] Kinesis Streams\u306b\u30c7\u30fc\u30bf\u3092\u6d41\u3057\u3066DynamoDB\u306b\u30c7\u30fc\u30bf\u304c\u683c\u7d0d\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u304b\u3081\u308b(\u4e3b\u306bAWS)\n\n\nSORACOM Funnel\u306e\u914d\u9001\u5148\u3092Kinesis Streams\u306b\u5909\u66f4\u3059\u308b\n[ToDo 5]\u306e\u6700\u7d42\u9805\u306e\u624b\u9806\u3067\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nDynamoDB\u306b\u30c7\u30fc\u30bf\u304c\u683c\u7d0d\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u304b\u3081\u308b\nRaspberryPi\u304b\u3089\u30c7\u30fc\u30bf\u3092\u9001\u4fe1\u3057\u3001\u4e0b\u8a18\u624b\u9806\u3067DynamoDB\u306b\u30c7\u30fc\u30bf\u304c\u66f8\u304d\u8fbc\u307e\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u304b\u3081\u307e\u3059\u3002\n\n[Tables] -> (\u4f5c\u6210\u3057\u305f\u30c6\u30fc\u30d6\u30eb) -> [Items]\u306e\u9806\u306b\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n\n\n[Query]\u3092\u9078\u629e\u3059\u308b\n[Partition key]\u306b\u73fe\u5728\u9001\u4fe1\u4e2d\u306e\u30c7\u30d0\u30a4\u30b9ID\u3092\u5165\u529b\u3059\u308b\n[Descending]\u3092\u9078\u629e\u3059\u308b\n[Start search]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u5ea6\u306b\u6700\u65b0\u306e\u30ec\u30b3\u30fc\u30c9\u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u304f\u306e\u304c\u308f\u304b\u308b\n\n\n\n\n\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\nKinesis Streams\u3068Lambda\u306e\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u3084\u30ed\u30b0\u3092\u78ba\u8a8d\u3059\u308b\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002\n\nKinesis Streams\u306e\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\n\n\nLambda\u306e\u7c21\u6613\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u3002\u3053\u306e\u753b\u9762\u304b\u3089\u30ed\u30b0\u306e\u753b\u9762\u306b\u9077\u79fb\u3067\u304d\u308b\n\n\nLambda\u306e\u30ed\u30b0\u306e\u753b\u9762\u3002\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3082\u8868\u793a\u3055\u308c\u308b\n\n\n\n\n[ToDo 12] IoT.kyoto VIS\u3067\u30b0\u30e9\u30d5\u8868\u793a\u3059\u308b\n\n\u30d6\u30e9\u30a6\u30b6\u306fChrome(Win/Mac)\u307e\u305f\u306fSafari(Mac)\u3092\u304a\u4f7f\u3044\u4e0b\u3055\u3044\u3002\n\u6700\u5f8c\u306bDynamoDB\u306e\u30c7\u30fc\u30bf\u3092\u3044\u304a\u305f\u3093\u3067IoT.kyoto VIS\u3067\u53ef\u8996\u5316\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u30b5\u30a4\u30f3\u30a2\u30c3\u30d7\nhttps://vis.iot.kyoto \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3001\u300c\u65b0\u898f\u767b\u9332\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u8a2d\u5b9a\nIoT.kyoto VIS\u516c\u5f0f\u30de\u30cb\u30e5\u30a2\u30eb\u306e3\uff5e4\u7ae0\u3092\u53c2\u7167\u3002\nAWS\u306eKey\u306b\u306f\u3001[ToDo 3]\u3067\u4f5c\u6210\u3057\u305f\u300cdynamo-read\u300d\u30e6\u30fc\u30b6\u30fc\u306eKey\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n\u3044\u308d\u3044\u308d\u8a66\u3057\u3066\u307f\u308b\n[\u30ec\u30f3\u30b8\u8a2d\u5b9a]\u3092[\u624b\u52d5]\u306b\u5909\u66f4\u3057\u30660\uff5e1000\u304f\u3089\u3044\u306b\u8a2d\u5b9a\u3059\u308b\u3068\u30b0\u30e9\u30d5\u304c\u898b\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u3002\u4e0b\u8a18\u306e\u3088\u3046\u306a\u3053\u3068\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u30d5\u30a9\u30c8\u30c8\u30e9\u30f3\u30b8\u30b9\u30bf\u306b\u30e9\u30a4\u30c8\u3092\u5f53\u3066\u305f\u308a\u624b\u3067\u8986\u3063\u305f\u308a\u3057\u3066\u3001\u30b0\u30e9\u30d5\u306e\u5909\u5316\u3084\u63cf\u753b\u307e\u3067\u306e\u9045\u5ef6\u3092\u78ba\u8a8d\u3059\u308b\n\u95be\u5024\u8d85\u3048\u306e\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u304c\u5c4a\u304f\u304b\u8a66\u3057\u3066\u307f\u308b\n\u65e5\u6642\u6307\u5b9a\u3067\u904e\u53bb\u306e\u5c65\u6b74\u3092\u8868\u793a\u3057\u3066\u307f\u308b\n\u5225window\u3067\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u958b\u304d\u3001\u30c7\u30d0\u30a4\u30b9ID\u3092\u5909\u3048\u305fPython\u30b3\u30fc\u30c9\u3092\u5b9f\u884c(\u64ec\u4f3c\u7684\u306b\u8907\u6570\u30c7\u30d0\u30a4\u30b9\u304c\u63a5\u7d9a\u3055\u308c\u305f\u72b6\u614b\u3068\u306a\u308b)\u3057\u3066\u3001IoT.kyoto VIS\u306e\u753b\u9762\u30672\u500b\u306e\u30b0\u30e9\u30d5\u3092\u540c\u6642\u306b\u8868\u793a\u3057\u3066\u307f\u308b\n\u30c7\u30fc\u30bf\u306e\u9001\u4fe1\u9593\u9694\u3092\u5909\u3048\u3066\u307f\u308b(\u300c\u30b0\u30e9\u30d5\u8a2d\u5b9a(\u6b6f\u8eca)\u300d\u3067\u30b0\u30e9\u30d5\u306e\u66f4\u65b0\u9593\u9694\u3092\u5909\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059)\n\n\n\n\n\u307e\u3068\u3081\n\n\u4eca\u56de\u306f\u4e0b\u8a182\u901a\u308a\u306e\u30c7\u30fc\u30bf\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u69cb\u7bc9\u3057\u307e\u3057\u305f\u3002\n\n\u30c7\u30d0\u30a4\u30b9 -> SORACOM Funnel -> Kinesis Firehose -> S3\n\u30c7\u30d0\u30a4\u30b9 -> SORACOM Funnel -> Kinesis Streams -> Lambda -> DynamoDB\n\n\u524d\u8005\u306f\u3001\u3068\u308a\u3042\u3048\u305a\u624b\u8efd\u306b\u30c7\u30fc\u30bf\u3092\u96c6\u3081\u305f\u3044\u3068\u3044\u3046\u3088\u3046\u306a\u30b1\u30fc\u30b9\u306b\u6700\u9069\u3067\u3059\u3002\u307e\u305f\u3001Redshift\u3084Elasticsearch Service\u306b\u3082\u6d41\u305b\u308b\u306e\u3067\u5922\u304c\u5e83\u304c\u308a\u30f3\u30b0\u3067\u3059\u306d\uff01\n\u5f8c\u8005\u306f\u3001\u96c6\u3081\u305f\u30c7\u30fc\u30bf\u3092\u57fa\u306b\u53ef\u8996\u5316\u3084\u76e3\u8996\u306a\u3069\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u69cb\u7bc9\u3057\u305f\u3044\u5834\u5408\u306b\u6700\u9069\u3067\u3059\u3002DynamoDB\u306f\u3061\u3083\u3093\u3068\u5206\u304b\u3063\u3066\u4f7f\u3048\u3070SQL\u7cfb\u306eDBMS\u3067\u306f\u5b9f\u73fe\u3067\u304d\u306a\u304b\u3063\u305f\u3088\u3046\u306a\u8d85\u5f37\u529b\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u4f5c\u308c\u3061\u3083\u3044\u307e\u3059\u3002\u307e\u305f\u3001\u76e3\u8996\u7cfb\u306e\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u306fLambda\u3067\u30b5\u30af\u30c3\u3068\u5b9f\u88c5\u3057\u3061\u3083\u3046\u306e\u304c\u826f\u3044\u3067\u3059\u306d\u3002\nSORACOM\u3092\u5358\u306a\u308b\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a\u624b\u6bb5\u3068\u3057\u3066\u4f7f\u3046\u306a\u3093\u3066\u3082\u3063\u305f\u3044\u306a\u3044\uff01\uff01\u305c\u3072SORACOM\u306e\u4e16\u754c\u306bDeep Dive\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n#**\u6982\u8981**\n##\u672c\u8a18\u4e8b\u306f[**SORACOM\u30b5\u30fc\u30d3\u30b9\u30ea\u30ea\u30fc\u30b91\u5468\u5e74\u8a18\u5ff5\u30ea\u30ec\u30fc\u30d6\u30ed\u30b0**](https://blog.soracom.jp/relay-blog/2016-10/)10\u670826\u65e5\u5206\u3067\u3059\u3002\n\u3069\u3082\u3001AWS Samurai 2015\u306e\u8fbb\u3067\u3059\u3002\nSORACOM\u306b\u306fIoT\u30d7\u30ec\u30a4\u30e4\u30fc\u306b\u3068\u3063\u3066\u5b09\u3057\u3044\u30b5\u30fc\u30d3\u30b9\u304c\u305f\u304f\u3055\u3093\u3042\u308a\u307e\u3059\u304c\u3001\u305d\u306e\u4e2d\u3067\u3082\u79c1\u304c\u5927\u597d\u304d\u306a\u306e\u304c[SORACOM Funnel](https://soracom.jp/services/funnel/)\u3067\u3059\u3002AWS\u3067\u3042\u308c\u3070Kinesis\u306b\u76f4\u7d50\u3057\u3066\u304f\u308c\u308b\u30b5\u30fc\u30d3\u30b9\u306a\u306e\u3067\u3059\u304c\u3001Kinesis\u81ea\u4f53\u304c\u5272\u3068\u6577\u5c45\u9ad8\u3081\u306a\u30b5\u30fc\u30d3\u30b9\u3067\u3042\u308b\u305b\u3044\u304b\u3001SORACOM Funnel\u306e\u4f7f\u3044\u65b9\u3092\u7d39\u4ecb\u3057\u305f\u8a18\u4e8b\u306f\u30cd\u30c3\u30c8\u4e0a\u306b\u3082\u3042\u307e\u308a\u3042\u308a\u307e\u305b\u3093\u30021\u5468\u5e74\u8a18\u5ff5\u3067\u3059\u306e\u3067\u3001\u53ef\u8996\u5316\u307e\u3067\u542b\u3081\u3066\u624b\u9806\u3092\u5927\u516c\u958b\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3063\uff01\uff01\nSORACOM Funnel\u306e\u4f55\u304c\u3044\u3044\u3063\u3066\u3001\u305d\u308a\u3083\u3041\u3082\u3046\u304a\u5ba2\u69d8\u306b\u300c\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306f\u30fb\u30fb\u30fb\u300d\u3063\u3066\u805e\u304b\u308c\u3066\u3082\u3059\u304b\u3055\u305a\u300c\u9589\u57df\u3060\u304b\u3089\u5927\u4e08\u592b\u3067\u3059\uff01\u300d\u3063\u3066\u30c9\u30e4\u9854\u3067\u304d\u308b\u3068\u3053\u308d\u3067\u3059\u3002\u3057\u304b\u3082IoT\u30c7\u30d0\u30a4\u30b9\u306b\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb(\u8a8d\u8a3c\u60c5\u5831)\u3092\u3082\u305f\u306a\u304f\u3066\u3044\u3044\u306a\u3093\u3066\u307e\u3055\u306b\u5922\u306e\u3088\u3046\u3067\u3059\u3002\u4eca\u56de\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u904a\u3093\u3067\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n![iot_kyoto.PNG](https://qiita-image-store.s3.amazonaws.com/0/80392/5cf7f4ea-90cd-4961-f121-dcf7cc6e5817.png)\n\u306a\u306b\u3084\u3089\u840c\u3048\u30ad\u30e3\u30e9\u304c\u3044\u307e\u3059\u306d\uff01\u53ef\u8996\u5316\u306b\u5229\u7528\u3059\u308b[**IoT.kyoto VIS**](http://iot.kyoto)\u306e\u30a4\u30e1\u30fc\u30b8\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u300c**\u3044\u304a\u305f\u3093(IoTan)**\u300d\u3067\u3059\u3002\u3044\u304a\u305f\u3093\u306f[\u3053\u3093\u306a\u7d4c\u7def](http://www.slideshare.net/ichiroohkini/iot-63775043)\u3067\u8a95\u751f\u3057\u307e\u3057\u305f\u3002\u305d\u3057\u3066[\u5de8\u5927\u5316\u3057\u3066\u76ee\u304b\u3089\u30d3\u30fc\u30e0\u3092\u51fa\u3057\u558b\u308b](https://youtu.be/XE0JWyfW4Yk)\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\uff01(\u4eca\u56de\u306e\u8a18\u4e8b\u306b\u306f\u5168\u304f\u95a2\u4fc2\u3042\u308a\u307e\u305b\u3093w)\n\n#**\u524d\u63d0\u6761\u4ef6**\n* AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u3082\u3063\u3066\u3044\u308b\u3053\u3068\n* SORACOM Air\u3067\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a\u3067\u304d\u308bRaspberryPi\u3092\u3082\u3063\u3066\u3044\u308b\u3053\u3068(\u3053\u306e\u90e8\u5206\u306e\u624b\u9806\u306f\u8aac\u660e\u3057\u307e\u305b\u3093)\n* RaspberryPi\u306b\u63a5\u7d9a\u3057\u3066\u8a08\u6e2c\u3067\u304d\u308b\u3001\u7167\u5ea6\u30fb\u6e29\u5ea6\u30fb\u8d85\u97f3\u6ce2\u7b49\u306e\u30bb\u30f3\u30b5\u30fc\u3092\u3082\u3063\u3066\u3044\u308b\u3053\u3068\n\nRASPBIAN JESSIE 2016-05-27\u7248\u3067\u52d5\u4f5c\u78ba\u8a8d\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u3088\u308a\u53e4\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u3060\u3068\u671f\u5f85\u901a\u308a\u306b\u52d5\u4f5c\u3057\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n\n#**[ToDo 1] RaspberryPi\u3067\u4f55\u304b\u3092\u30bb\u30f3\u30b7\u30f3\u30b0\u3057\u3001\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306b\u4fdd\u5b58\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b(RasPi)**\nRaspberryPi\u306b\u30bb\u30f3\u30b5\u30fc\u3092\u63a5\u7d9a\u3057\u3001\u8a08\u6e2c\u5024\u3092\u57fa\u306b\u3053\u3093\u306a\u611f\u3058\u306eJSON\u304c\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306b\u4fdd\u5b58\u3067\u304d\u3066\u3044\u308c\u3070OK\u3067\u3059\u3002**\u30c7\u30d0\u30a4\u30b9ID\u30fb\u8a08\u6e2c\u5024\u30fb\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7**\u304c\u5fc5\u9808\u3067\u3059\u3002\u4ee5\u5f8c\u3001`/home/pi/shodo-logs/shodo-funnel.log`\u306b\u30ed\u30b0\u304c\u4fdd\u5b58\u3055\u308c\u308b\u3082\u306e\u3068\u3057\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\n\n```\n{\"brightness\": 164, \"ID\": \"id000\", \"time_sensor\": \"2016-03-28 15:16:48\"}\n{\"brightness\": 692, \"ID\": \"id000\", \"time_sensor\": \"2016-03-28 15:16:51\"}\n{\"brightness\": 720, \"ID\": \"id000\", \"time_sensor\": \"2016-03-28 15:16:54\"}\n{\"brightness\": 945, \"ID\": \"id000\", \"time_sensor\": \"2016-03-28 15:16:57\"}\n{\"brightness\": 9, \"ID\": \"id000\", \"time_sensor\": \"2016-03-28 15:17:00\"}\n```\n\n\u5b9f\u88c5\u4f8b\u3068\u3057\u3066\u3001\u7167\u5ea6\u30bb\u30f3\u30b5\u30fc\u3092\u4f7f\u3063\u305f\u624b\u9806\u3092\u4ee5\u524d\u306e\u30ea\u30ec\u30fc\u30d6\u30ed\u30b0\u3067\u7d39\u4ecb\u3057\u307e\u3057\u305f\u3002[**RaspberryPi\u3067\u30bb\u30f3\u30b5\u30fc\u30c7\u30fc\u30bf\u3092fluentd\u3092\u4f7f\u3063\u3066DynamoDB\u306b\u9001\u3063\u3066\u53ef\u8996\u5316\u3057\u3066\u307f\u3088\u3046\uff1c\u5b8c\u5168\u7de8\uff1e**](http://qiita.com/Ichiro_Tsuji/items/fce61bdd5974a2c9cf14#todo-0-raspberrypi%E3%81%AE%E6%BA%96%E5%82%99)\u306e**[Todo 0]**\u3068**[ToDo 1]**\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u4ee5\u4e0b\u3001\u6ce8\u610f\u70b9\u3067\u3059\u3002\n\n* **`$ sudo apt-get update`\u306f\u5fc5\u305a\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044**\n* \u4eca\u56de\u306fSORACOM Air\u3067\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u63a5\u7d9a\u3057\u307e\u3059\u306e\u3067\u3001\u30ea\u30f3\u30af\u5148[ToDo 1]\u306eWi-Fi\u63a5\u7d9a\u78ba\u8a8d\u3067\u5fc5\u305a\u3057\u3082\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a\u3067\u304d\u3066\u3044\u308b\u5fc5\u8981\u306f\u306a\u304f\u3001SSH\u63a5\u7d9a\u306e\u78ba\u8a8d\u304c\u3067\u304d\u308c\u3070OK\u3067\u3059\u3002\u6709\u7ddaLAN\u63a5\u7d9a\u3084HDMI\u63a5\u7d9a\u306e\u30e2\u30cb\u30bf\u3067\u3082\u4ee3\u7528\u3067\u304d\u307e\u3059\n* \u4eca\u56de\u306e\u5b9f\u88c5\u306b\u304a\u3044\u3066\u3001SORACOM Funnel\u306f1\u79d2\u9593\u9694\u3068\u3044\u3063\u305f\u77ed\u3044\u5468\u671f\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\u3068\u51e6\u7406\u304c\u9593\u306b\u5408\u308f\u306a\u3044\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u30023\u79d2\u4ee5\u4e0a\u9593\u9694\u3092\u7a7a\u3051\u3066\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u30ea\u30f3\u30af\u5148[ToDo 1]\u306e\u30b3\u30fc\u30c9\u306f1\u79d2\u9593\u9694\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u4fee\u6b63\u304c\u5fc5\u8981\u3067\u3059\n\n#**[ToDo 2] SORACOM Air\u3067\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a\u3059\u308b(RasPi)**\n[**SORACOM\u516c\u5f0f\u30cf\u30f3\u30ba\u30aa\u30f3\u30c6\u30ad\u30b9\u30c8**](https://github.com/soracom/handson/blob/master/setup/setup.md)\u304c\u53c2\u8003\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u63a5\u7d9a\u304c\u5b8c\u4e86\u3057\u305f\u3089RaspberryPi\u306bSSH\u3067\u63a5\u7d9a\u3057\u3066\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```bash\n$ curl ifconfig.io\n54.250.xxx.xxx\n#IPv6\u30a2\u30c9\u30ec\u30b9\u304c\u8868\u793a\u3055\u308c\u308b\u5834\u5408\u306f\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066\u4e0b\u3055\u3044\n\n$ curl ifconfig.me\n54.250.xxx.xxx\n```\n\n\u8fd4\u308a\u5024(\u30b0\u30ed\u30fc\u30d0\u30ebIP\u30a2\u30c9\u30ec\u30b9)\u304c**54.250.xxx.xxx**\u3068\u306a\u3063\u3066\u3044\u308c\u3070SORACOM Air\u7d4c\u7531\u3067\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u63a5\u7d9a\u3067\u304d\u3066\u3044\u307e\u3059\u3002\n\n#**[ToDo 3] API\u30a2\u30af\u30bb\u30b9\u7528\u306eKey\u3092\u4f5c\u6210\u3059\u308b(AWS)**\nKinesis\u3084DynamoDB\u306bAPI\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306b\u3001AWS\u306eIAM Access Key\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u4eca\u56de\u4f5c\u6210\u3059\u308b\u306e\u306f\u4e0b\u8a18\u306b\u3042\u308b2\u3064\u306e\u30e6\u30fc\u30b6\u30fc\u304a\u3088\u3073\u305d\u308c\u306b\u3072\u3082\u4ed8\u304fKey\u3067\u3059\u3002\n\u624b\u9806\u306f[**\u3053\u3061\u3089**](http://qiita.com/Ichiro_Tsuji/items/fce61bdd5974a2c9cf14#todo-2-api%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E7%94%A8%E3%81%AEkey%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B)\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002(\u624b\u629c\u304d\u3067\u3059\u3044\u307e\u305b\u3093\u6c57)\n\n| \u30e6\u30fc\u30b6\u30fc\u540d | \u30a2\u30af\u30bb\u30b9\u6a29 | \u4f7f\u7528\u7b87\u6240 |\n|----------|----------|----------|\n| Kinesis-full | AmazonKinesisFullAccess<BR>AmazonKinesisFirehoseFullAccess | Funnel\u304b\u3089Kinesis\u3078\u306e\u66f8\u304d\u8fbc\u307f |\n| dynamo-read | AmazonDynamoDBReadOnlyAccess | IoT.kyoto\u304b\u3089DynamoDB\u3078\u306e\u8aad\u307f\u51fa\u3057 |\n\n#**[ToDo 4] Kinesis\u306e\u8a2d\u5b9a(AWS)**\n\u4eca\u56de\u306f\u52d5\u4f5c\u78ba\u8a8d\u7528\u3068\u3057\u3066\u3001S3 / Redshift / Elasticsearch Service\u306b\u30ed\u30b0\u3092\u914d\u9001\u3057\u3066\u304f\u308c\u308b[Kinesis Firehose](https://aws.amazon.com/jp/kinesis/firehose/)\u3068\u3001\u6982\u8981\u306e\u56f3\u3067\u767b\u5834\u3057\u3066\u3044\u308b[Kinesis Streams](https://aws.amazon.com/jp/kinesis/streams/)\u3092\u5229\u7528\u3057\u307e\u3059\u3002\nKinesis Streams\u3092\u3056\u3063\u304f\u308a\u8aac\u660e\u3059\u308b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u3057\u3087\u3046\u304b\u3002\n\n* Stream\u306b\u30c7\u30fc\u30bf\u3092\u306b\u6295\u3052\u8fbc\u3080\u3068\u4e00\u5b9a\u671f\u9593(\u30c7\u30d5\u30a9\u30eb\u30c8\u306724\u6642\u9593)\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3066\u304f\u308c\u3066\u3001\u305d\u306e\u9593\u306b\u30c7\u30fc\u30bf\u3092\u53d6\u308a\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u308b\n* \u30c7\u30fc\u30bf\u306f\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u3092\u3064\u3051\u3066\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306bHTTPS\u3067POST\u3059\u308b\n* \u30c7\u30fc\u30bf\u306e\u53d6\u308a\u51fa\u3057\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u671f\u9593\u4e2d\u4f55\u56de\u3067\u3082OK\n* \u30b5\u30a4\u30b8\u30f3\u30b0\u306f\u300c\u30b7\u30e3\u30fc\u30c9\u300d\u3068\u3044\u3046\u5358\u4f4d\u3067\u6307\u5b9a\n* \u30b7\u30e3\u30fc\u30c9\u3092\u30aa\u30fc\u30c8\u30b9\u30b1\u30fc\u30eb\u3059\u308b\u6a5f\u80fd\u306f\u306a\u3044\n* 1\u30b7\u30e3\u30fc\u30c9\u3067\u6700\u59271000\u30e1\u30c3\u30bb\u30fc\u30b8\uff0f\u79d2\u3082\u3055\u3070\u3044\u3066\u304f\u308c\u308b\u306e\u3067\u3001\u30b9\u30d1\u30a4\u30af\u304c\u6765\u3066\u3082\u5b89\u5fc3\n* \u30b7\u30e3\u30fc\u30c9\u3092\u62e1\u5f35\u3057\u3066\u3082\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306f1\u3064\u306e\u307e\u307e\u3002\u3088\u308d\u3057\u304f\u5206\u6563\u3057\u3066\u304f\u308c\u308b(\u5206\u6563\u51e6\u7406\u306e\u305f\u3081\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u30ad\u30fc\u306e\u6307\u5b9a\u304c\u5fc5\u8981)\n* \u30de\u30cd\u30fc\u30b8\u30c9\u30b5\u30fc\u30d3\u30b9\u306a\u306e\u3067\u30a4\u30f3\u30d5\u30e9\u306e\u904b\u7528\u306f\u4e0d\u8981\u3002SPOF\u3082\u8003\u616e\u3057\u306a\u304f\u3066\u826f\u3044\n\nKinesis Streams\u306f\u30c7\u30fc\u30bf\u3092\u53d6\u308a\u51fa\u3057\u3066\u51e6\u7406\u3092\u3059\u308b\u90e8\u5206(Kinesis App)\u3092Lambda\u306a\u3069\u3067\u958b\u767a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001Kinesis Firehose\u3092\u4f7f\u3048\u3070S3 / Redshift / Elasticsearch Service\u306e\u3069\u308c\u304b\u306b\u30c7\u30fc\u30bf\u3092\u914d\u9001\u3057\u3066\u304f\u308c\u307e\u3059\u3002Kinesis Firehose\u306e\u4ed5\u69d8\u306fKinesis Streams\u3068\u306f\u82e5\u5e72\u7570\u306a\u308a\u307e\u3059\u306e\u3067\u3001\u8a73\u7d30\u306f\u4e0a\u8a18\u30ea\u30f3\u30af\u5148\u3092\u53c2\u7167\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n##AWS IoT\u3068\u4f55\u304c\u9055\u3046\u306e\uff1f\nIoT\u5411\u3051\u306e\u540c\u3058\u3088\u3046\u306a\u6a5f\u80fd\u3092\u6301\u3064\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066[AWS IoT](https://aws.amazon.com/jp/iot/)\u304c\u3042\u308a\u307e\u3059\u3002\u8aa4\u89e3\u3092\u6050\u308c\u305a\u3056\u3063\u304f\u308a\u3068\u9055\u3044\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\n\n* \u5168\u30ce\u30fc\u30c9\u5408\u8a08\u30671\u30e1\u30c3\u30bb\u30fc\u30b8\uff0f\u79d2\u3092\u8d85\u3048\u308b\u3088\u3046\u306a\u5834\u5408\u306f\u3001AWS IoT\u306e\u65b9\u304c\u5272\u9ad8\n* Kinesis\u306e\u5bfe\u5fdc\u30d7\u30ed\u30c8\u30b3\u30eb\u306fHTTPS\u306e\u307f\u3001AWS IoT\u306fMQTT\u306a\u3069\u69d8\u3005\u306a\u30d7\u30ed\u30c8\u30b3\u30eb\u306b\u5bfe\u5fdc\n* 1\u30e1\u30c3\u30bb\u30fc\u30b8\u3042\u305f\u308a\u306e\u6700\u5927\u30da\u30a4\u30ed\u30fc\u30c9\u306f\u3001Kinesis -> 1MB \u3001AWS IoT ->128KB\n* Kinesis\u306f\u30c7\u30d0\u30a4\u30b9-> \u30af\u30e9\u30a6\u30c9\u306e1\u65b9\u5411\u306e\u307f\u3001AWS IoT\u306f\u30af\u30e9\u30a6\u30c9\u5074\u304b\u3089\u30c7\u30d0\u30a4\u30b9\u3092\u5236\u5fa1\u3067\u304d\u308b\n\nAWS IoT\u306e\u65b9\u304c\u9ad8\u6a5f\u80fd\u306a\u5206\u5272\u9ad8\u3068\u8a00\u3048\u305d\u3046\u3067\u3059\u306d\u3002\u8981\u4ef6\u306b\u5408\u308f\u305b\u3066\u3046\u307e\u304f\u4f7f\u3044\u5206\u3051\u307e\u3057\u3087\u3046\u3002\n\n##Kinesis Firehose\u306e\u8a2d\u5b9a\n* Kinesis\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u958b\u304f\n* Kinesis Firehose\u306f2016\u5e7410\u6708\u73fe\u5728\u3001\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u63d0\u4f9b\u3055\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u5229\u7528\u53ef\u80fd\u306a\u5317\u30d0\u30fc\u30b8\u30cb\u30a2(N.Virginia)\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u9078\u629e\u3059\u308b<BR>\n![k-1.png](https://qiita-image-store.s3.amazonaws.com/0/80392/9bfa9b74-a4c3-9188-2046-af6fbd0dc3b7.png)<BR><BR>\n* [Go to Firehose]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b<BR>\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-10-19 13.42.20.png](https://qiita-image-store.s3.amazonaws.com/0/80392/472756eb-fefa-84c9-0eff-8cf5741fb938.png)<BR><BR>\n* [Create Delivery Stream]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b<BR>\n![Amazon Kinesis Firehose 2016-10-19 13-43-18.png](https://qiita-image-store.s3.amazonaws.com/0/80392/7a25283b-594d-d1c2-260d-229f4ccf806e.png)<BR><BR>\n* \u914d\u9001\u5148\u306b[Amazon S3]\u3092\u9078\u629e\u3059\u308b<BR>\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-10-19 13.44.22.png](https://qiita-image-store.s3.amazonaws.com/0/80392/3c53785c-026c-5212-0599-5eb9d3131049.png)<BR><BR>\n* Stream Name\u3092\u5165\u529b\u3057\u3001\u30ed\u30b0\u3092\u683c\u7d0d\u3059\u308bS3\u30d0\u30b1\u30c3\u30c8\u3092\u9078\u629e(\u3053\u3053\u3067\u306f\u3068\u3082\u306b\u300ciotan-f\u300d\u3068\u3057\u3066\u3044\u308b)\u3059\u308b\u3002\u30d0\u30b1\u30c3\u30c8\u306f\u3053\u3053\u3067\u4f5c\u6210\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\n* \u30ed\u30b0\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067Stream\u540d+\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3068\u306a\u308b\u304c\u3001\u5fc5\u8981\u3067\u3042\u308c\u3070\u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u6307\u5b9a\u3059\u308b\n* [Next]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b<BR>\n![Amazon Kinesis Firehose 2016-10-19 13-46-27.png](https://qiita-image-store.s3.amazonaws.com/0/80392/06ce462f-250c-eca2-2118-0894ec187f0d.png)<BR><BR>\n* Buffer interval(S3\u3078\u306e\u9001\u4fe1\u9593\u9694)\u3092\u6307\u5b9a\u3059\u308b\u3002\u6700\u5c0f\u5024\u306f60\u79d2\n* IAM role\u3067[Firehose Delivery IAM role]\u3092\u9078\u629e\u3059\u308b\n* \u4ed6\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067OK<BR>\n![c6aa8e58-6526-40dd-c9b7-ad890b113caa.png](https://qiita-image-store.s3.amazonaws.com/0/80392/e18c5caa-0b6e-c49d-80bd-0cc923d1cf6e.png)<BR><BR>\n* \u305d\u306e\u307e\u307e[Allow]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b<BR>\n![IAM Management Console 2016-10-19 13-49-20.png](https://qiita-image-store.s3.amazonaws.com/0/80392/c157d4de-ec77-8361-22b6-0c8ba7b6a331.png)<BR><BR>\n* \u305d\u306e\u307e\u307e[Next]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b<BR>\n![Amazon Kinesis Firehose 2016-10-19 13-50-05.png](https://qiita-image-store.s3.amazonaws.com/0/80392/3d722e41-6f5c-3d59-51a3-19f4f1aa9430.png)<BR><BR>\n* [Create Delivery Stream]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b<BR>\n![Amazon Kinesis Firehose 2016-10-19 13-51-10.png](https://qiita-image-store.s3.amazonaws.com/0/80392/d7e20fcf-59ae-498a-8f02-f8870d20894d.png)<BR><BR>\n* S3\u914d\u9001Stream\u304c\u4f5c\u6210\u3055\u308c\u305f\u3002[ACTIVE]\u306b\u306a\u3063\u305f\u3089\u5229\u7528\u53ef\u80fd<BR>\n\b![Amazon Kinesis Firehose 2016-10-19 14-24-14.png](https://qiita-image-store.s3.amazonaws.com/0/80392/a7f368ff-9a9f-073c-a3cb-e6a93bf48e89.png)\n\n##Kinesis Streams\u306e\u8a2d\u5b9a\n* Kinesis\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u958b\u304f\n* \u3068\u304f\u306b\u7406\u7531\u304c\u306a\u3051\u308c\u3070\u3001\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u9762\u3067\u6709\u5229\u306a\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u9078\u629e\u3059\u308b<BR>\n![k-2.png](https://qiita-image-store.s3.amazonaws.com/0/80392/caa2c1e2-41a5-1f3d-cceb-12d9cbd13363.png)<BR><BR>\n* [Go to Streams]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b<BR>\n![AWS Kinesis Management Console 2016-10-19 14-11-28.png](https://qiita-image-store.s3.amazonaws.com/0/80392/0f685b17-5808-c705-ddbd-5cc725a8c163.png)<BR><BR>\n* [Create Stream]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b<BR>\n![AWS Kinesis Management Console 2016-10-19 14-11-52.png](https://qiita-image-store.s3.amazonaws.com/0/80392/b3be110f-ef62-cc94-44d0-1c439ced9587.png)<BR><BR>\n* Stream Name\u3092\u5165\u529b(\u3053\u3053\u3067\u306f\u300ciotan-s\u300d\u3068\u3057\u3066\u3044\u308b)\u3059\u308b\n* \u30b7\u30e3\u30fc\u30c9\u6570\u3092\u5165\u529b\u3059\u308b\u30021\u3067\u5145\u5206\n* [Create]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n![AWS Kinesis Management Console 2016-10-19 14-12-27.png](https://qiita-image-store.s3.amazonaws.com/0/80392/8101e952-3d16-a549-6b96-d3b00c17128a.png)<BR><BR>\n* Stream\u304c\u4f5c\u6210\u3055\u308c\u305f\u3002[ACTIVE]\u306b\u306a\u3063\u305f\u3089\u5229\u7528\u53ef\u80fd<BR>\n![AWS Kinesis Management Console 2016-10-19 14-18-23.png](https://qiita-image-store.s3.amazonaws.com/0/80392/0cb79a21-cb56-eb4f-d684-c8472f3bdace.png)\n\n#**[ToDo 5] SORACOM Funnel\u306e\u8a2d\u5b9a(SORACOM)**\n* SORACOM\u30e6\u30fc\u30b6\u30fc\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u958b\u304f\n* [\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3]\u306e\u753b\u9762\u3092\u958b\u304f<BR>\n![s-1.png](https://qiita-image-store.s3.amazonaws.com/0/80392/a1da51cb-0dc0-b340-811d-48e7e3c782f7.png)<BR><BR>\n* [\u8a8d\u8a3c\u60c5\u5831\u30b9\u30c8\u30a2] -> [\u8a8d\u8a3c\u60c5\u5831\u3092\u767b\u9332]<BR>\n![s-2.png](https://qiita-image-store.s3.amazonaws.com/0/80392/afabdcf9-7699-30a4-b953-2371218310dc.png)<BR><BR>\n* \u4efb\u610f\u306e\u8a8d\u8a3c\u60c5\u5831ID(\u3053\u3053\u3067\u306f\u300ciotan-kinesis\u300d\u3068\u3057\u3066\u3044\u308b)\u3092\u5165\u529b\u3059\u308b\n* [Todo 2]\u3067\u4f5c\u6210\u3057\u305f\u300ckinesis-full\u300d\u306e\u8a8d\u8a3c\u60c5\u5831\u3092\u5165\u529b\u3059\u308b<BR>\n* [\u767b\u9332]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b<BR>\n![s-3.png](https://qiita-image-store.s3.amazonaws.com/0/80392/cce32049-3b3a-c4ae-2d05-fb10b998496e.png)<BR><BR>\n* \u8a8d\u8a3c\u60c5\u5831\u304c\u767b\u9332\u3055\u308c\u305f<BR>\n![a60f81c0-1913-f8af-5033-4a1390db34a2.png](https://qiita-image-store.s3.amazonaws.com/0/80392/c4f58077-991a-5a92-4384-8935afb25e28.png)<BR><BR>\n* [\u30b0\u30eb\u30fc\u30d7]\u306e\u753b\u9762\u3092\u958b\u304f<BR>\n![s-5.png](https://qiita-image-store.s3.amazonaws.com/0/80392/03364814-1987-8992-b29c-7ae4940ea478.png)<BR><BR>\n* [\u8ffd\u52a0]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n* \u4efb\u610f\u306e\u30b0\u30eb\u30fc\u30d7\u540d(\u3053\u3053\u3067\u306f\u300ciotan-kinesis\u300d\u3068\u3057\u3066\u3044\u308b)\u3092\u5165\u529b\u3057\u3066[\u30b0\u30eb\u30fc\u30d7\u4f5c\u6210]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b<BR>\n![s-6.png](https://qiita-image-store.s3.amazonaws.com/0/80392/6e9f7b83-2b15-f745-b841-b15d75d7aad4.png)<BR><BR>\n* \u767b\u9332\u6e08\u307f\u306e\u30b0\u30eb\u30fc\u30d7\u304c\u4e00\u89a7\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u5148\u307b\u3069\u767b\u9332\u3057\u305f\u30b0\u30eb\u30fc\u30d7\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n* [SORACOM Funnel \u8a2d\u5b9a]\u3092\u5c55\u958b\u3059\u308b\n* \u307e\u305a\u306f\u52d5\u4f5c\u78ba\u8a8d\u3067Kinesis Firehose\u306b\u30c7\u30fc\u30bf\u3092\u6d41\u3059\u306e\u3067\u3001\u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7\u3067[Kinesis Firehose]\u3092\u9078\u629e\u3059\u308b\n* \u30ea\u30bd\u30fc\u30b9URL\u306f\u6b21\u306e\u3088\u3046\u306b\u5165\u529b\u3059\u308b<BR>**`https://kfirehose.us-east-1.amazonaws.com/{stream_name}`**  (\u5317\u30d0\u30fc\u30b8\u30cb\u30a2\u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u5834\u5408)\n* \u8a8d\u8a3c\u60c5\u5831\u306f\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u8a8d\u8a3c\u60c5\u5831\u540d\u3092\u9078\u629e\u3059\u308b\n* \u9001\u4fe1\u3059\u308b\u30c7\u30fc\u30bf\u5f62\u5f0f\u306f[JSON]\u3092\u9078\u629e\u3059\u308b\n* [\u4fdd\u5b58]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b<BR>\n ![s-7-f.png](https://qiita-image-store.s3.amazonaws.com/0/80392/e8cc1045-1e3b-d046-f599-eb7645afe398.png)<BR><BR>\n* [SIM\u7ba1\u7406]\u306e\u753b\u9762\u3092\u958b\u304f<BR>\n![s-8.png](https://qiita-image-store.s3.amazonaws.com/0/80392/4595d60c-0980-6c3b-f7f6-33bc2c56ea8f.png)<BR><BR>\n* RaspberryPi\u306e\u901a\u4fe1\u306b\u4f7f\u7528\u3057\u3066\u3044\u308bSIM\u3092\u9078\u629e\u3057\u3066\u53f3\u30af\u30ea\u30c3\u30af -> [\u6240\u5c5e\u30b0\u30eb\u30fc\u30d7\u5909\u66f4]<BR>\n![s-9.png](https://qiita-image-store.s3.amazonaws.com/0/80392/7e3af22d-8342-69e1-9e78-27418c67c0a4.png)<BR><BR>\n* \u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u30b0\u30eb\u30fc\u30d7\u3092\u9078\u629e\u3057\u3001[\u30b0\u30eb\u30fc\u30d7\u5909\u66f4]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b<BR>\n![s-10.png](https://qiita-image-store.s3.amazonaws.com/0/80392/28b71415-b881-adf4-a2d8-03b35b7e3330.png)<BR><BR>\n* \u6240\u5c5e\u30b0\u30eb\u30fc\u30d7\u304c\u5909\u66f4\u3055\u308c\u305f<BR>\n![s-11.png](https://qiita-image-store.s3.amazonaws.com/0/80392/270adf36-a8ca-6909-9068-41ee07fa7113.png)\n\n\n##\u30c7\u30fc\u30bf\u306e\u914d\u9001\u5148\u3092Kinesis Streams\u306b\u5909\u66f4\u3059\u308b\n[ToDo 8]\u3067Kinesis Firehose\u306b\u3088\u308bSORACOM Funnel\u306e\u52d5\u4f5c\u78ba\u8a8d\u304c\u7d42\u308f\u3063\u305f\u3089\u4e0b\u8a18\u306e\u624b\u9806\u3067\u914d\u9001\u5148\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\n* [\u30b0\u30eb\u30fc\u30d7]\u306e\u753b\u9762\u3092\u958b\u304f<BR>\n![s-5.png](https://qiita-image-store.s3.amazonaws.com/0/80392/03364814-1987-8992-b29c-7ae4940ea478.png)<BR><BR>\n* \u767b\u9332\u6e08\u307f\u306e\u30b0\u30eb\u30fc\u30d7\u304c\u4e00\u89a7\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u5148\u307b\u3069\u767b\u9332\u3057\u305f\u30b0\u30eb\u30fc\u30d7\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n* [SORACOM Funnel \u8a2d\u5b9a]\u3092\u5c55\u958b\u3059\u308b\n* \u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7\u3067[Kinesis Streams]\u3092\u9078\u629e\u3059\u308b\n* \u30ea\u30bd\u30fc\u30b9URL\u306f\u6b21\u306e\u3088\u3046\u306b\u5165\u529b\u3059\u308b<BR>**`https://kinesis.ap-northeast-1.amazonaws.com/{stream_name}`**  (\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u5834\u5408)\n* [\u4fdd\u5b58]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b<BR>\n![s-7-s.png](https://qiita-image-store.s3.amazonaws.com/0/80392/866b516b-4b98-86be-7cbe-e5c42390b2ca.png)\n\n#**[ToDo 6] fluentd\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb(RasPi)**\nRaspberryPi\u304b\u3089\u306e\u30c7\u30fc\u30bf\u914d\u9001\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3068\u3057\u3066fluentd\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u52d5\u4f5c\u6982\u5ff5\u306b\u3064\u3044\u3066\u306f[\u3053\u3061\u3089](http://qiita.com/Ichiro_Tsuji/items/fce61bdd5974a2c9cf14#%E4%BB%8A%E5%9B%9E%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B%E3%83%84%E3%83%BC%E3%83%AB%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9)\u3092\u53c2\u7167\u4e0b\u3055\u3044\u3002\u4eca\u56de\u306foutput\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u3057\u3066\u300cout-http\u30d7\u30e9\u30b0\u30a4\u30f3\u300d\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u4ed6\u306b\u306f\u30ea\u30f3\u30af\u5148\u306b\u3042\u308b\u3088\u3046\u306bDynamoDB\u306b\u914d\u9001\u3057\u305f\u308a\u3001Kinesis\u3084S3\u306b\u914d\u9001\u3059\u308b\u3053\u3068\u306a\u3069\u3082\u3067\u304d\u307e\u3059\u3002\n\u300cout-http\u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u300d\u5358\u306bHTTP\u3067POST\u3059\u308b\u3060\u3051\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3059\u3002\u305d\u3046\u3001\u6697\u53f7\u5316\u3082\u3057\u307e\u305b\u3093\u3002\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5927\u4e08\u592b\u306a\u306e\uff1f\u3068\u601d\u3063\u305f\u3042\u306a\u305f\u306f[SORACOM Funnel](https://soracom.jp/services/funnel/)\u306e\u30b5\u30fc\u30d3\u30b9\u8aac\u660e\u3092\u719f\u8aad\u3057\u307e\u3057\u3087\u3046\u3002\u30e2\u30d0\u30a4\u30eb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4e0a\u306e\u6697\u53f7\u5316\u306f3G\u7db2\u5074\u306b\u30aa\u30d5\u30ed\u30fc\u30c9\u3055\u308c\u3001AWS\u3078\u306e\u8a8d\u8a3c\u3084\u6697\u53f7\u5316\u306fSORACOM Funnel\u304c\u3088\u308d\u3057\u304f\u3084\u3063\u3066\u304f\u308c\u307e\u3059\u3002\u305d\u3046\u3001**IoT\u958b\u767a\u8005\u306b\u3068\u3063\u3066\u9762\u5012\u81ed\u3044\u3068\u3053\u308d\u306fSORACOM\u3055\u3093\u304c\u9811\u5f35\u3063\u3066\u304f\u308c\u308b**\u306e\u3067\u3059\u3002\u7d20\u6575(\u306f\u3041\u3068\u3002\u3055\u3089\u306b**Kinesis\u307e\u3067\u9589\u57df\u7db2\u76f8\u5f53\u3067\u63a5\u7d9a\u3067\u304d\u308b**\u306e\u3067\u3059\u3002\u3082\u3046\u62b1\u3044\u3066w\u3002\u300c\u76f8\u5f53\u300d\u3068\u66f8\u3044\u305f\u306e\u306f\u3001Kinesis\u304c\u30e6\u30fc\u30b6\u30fc\u6bce\u306e\u9589\u3058\u305f\u74b0\u5883(AWS\u3067\u3044\u3046VPC)\u5185\u306b\u3042\u308b\u308f\u3051\u3058\u3083\u306a\u304f\u3066\u3001AWS\u30e6\u30fc\u30b6\u30fc\u5171\u7528\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7a7a\u9593\u306b\u5b58\u5728\u3059\u308b\u304b\u3089\u3067\u3059\u3002\n\u4ee5\u4e0b\u3001RaspberryPi\u3078\u306efluentd\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\u3067\u3059\u3002\n\n##fluentd\u672c\u4f53\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u6570\u5206\u304b\u304b\u308a\u307e\u3059\u3002\n\n```bash\n$ sudo apt-get install ruby-dev libssl-dev\n$ sudo gem install fluentd --no-ri --no-rdoc\n```\n\n\u203b\u4eca\u56de\u4f7f\u3046out-http\u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u3042\u308b0.14\u7cfb\u3067\u52d5\u4f5c\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u4ed6\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3082\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f0.12\u7cfb\u306e\u6700\u65b0\u7248\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u65b9\u304c\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u305d\u306e\u5834\u5408\u306e\u30b3\u30de\u30f3\u30c9\u306f\u4e0b\u8a18\n\n```bash\n$ sudo gem install fluentd -v \"~> 0.12.0\" --no-ri --no-rdoc\n```\n\n##out-http\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u6570\u5206\u304b\u304b\u308a\u307e\u3059\u3002\n\n```bash\n$ sudo fluent-gem install fluent-plugin-out-http --no-ri --no-rdoc\n```\n\n\n##\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u78ba\u8a8d\n\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u82e5\u5e72\u7570\u306a\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n```bash\n$ sudo gem list fluent\n*** LOCAL GEMS ***\nfluent-plugin-out-http (0.1.4)\nfluentd (0.14.4, 0.10.61)\n```\n\n#**[ToDo 7] fluentd\u306e\u8a2d\u5b9a(RasPi)**\n##\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3068\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\u30bb\u30f3\u30b5\u30fc\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb(.log\u3068.pos)\u306e\u30d1\u30b9\u306f\u9069\u5b9c\u66f8\u304d\u63db\u3048\u3066\u4e0b\u3055\u3044\u3002\n\n```bash\n$ sudo touch /home/pi/shodo-logs/shodo-funnel.pos\n$ sudo mkdir /fluent\n$ sudo touch /fluent/fluent.log\n$ sudo vim /fluent/fluent.conf\n```\n\n```bash:fluent.conf\n<source>\n  # input\u306btail\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u6307\u5b9a\n  @type tail\n  # \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u6307\u5b9a\n  format json\n  # \u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u30d5\u30eb\u30d1\u30b9\u3067\u6307\u5b9a\n  path /home/pi/shodo-logs/shodo-funnel.log\n  # \u30d5\u30a1\u30a4\u30eb\u5185\u306e\u3069\u306e\u884c\u307e\u3067\u3092\u8aad\u3093\u3060\u304b\u3092\u8a18\u9332\u3057\u3066\u304a\u304f\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\n  pos_file /home/pi/shodo-logs/shodo-funnel.pos\n  # \u5206\u304b\u308a\u3084\u3059\u3044\u30bf\u30b0\u3092\u6307\u5b9a\n  tag funnel.shodo\n</source>\n# \u4ee5\u4e0b\u306e\u30bf\u30b0\u306b\u30de\u30c3\u30c1\u3057\u305f\u3082\u306e\u3060\u3051output\u51e6\u7406\u3055\u308c\u308b\n<match funnel.**>\n  @type http\n  # SORACOM Funnel\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u6307\u5b9a\n  endpoint_url    http://funnel.soracom.io/\n  #\u4ee5\u4e0b\u3001\u5404\u7a2e\u8a2d\u5b9a\n  http_method     post   # default: post\n  serializer      json   # default: form\n  rate_limit_msec 100    # default: 0 = no rate limiting\n  raise_on_error  false  # default: true\n</match>\n```\n\n##\u30c6\u30b9\u30c8\n**`[error]`**\u306e\u884c\u304c\u306a\u3044\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash\n$ sudo fluentd -c /fluent/fluent.conf --dry-run\n\n2016-10-20 19:35:36 +0900 [info]: reading config file path=\"/fluent/fluent.conf\"\n2016-10-20 19:35:36 +0900 [info]: starting fluentd-0.14.4 as dry run mode\n2016-10-20 19:35:36 +0900 [info]: gem 'fluent-plugin-out-http' version '0.1.4'\n2016-10-20 19:35:36 +0900 [info]: gem 'fluentd' version '0.14.4'\n2016-10-20 19:35:36 +0900 [info]: gem 'fluentd' version '0.10.61'\n2016-10-20 19:35:36 +0900 [info]: adding match pattern=\"funnel.**\" type=\"http\"\n2016-10-20 19:35:36 +0900 [info]: adding source type=\"tail\"\n2016-10-20 19:35:36 +0900 [info]: using configuration file: <ROOT>\n  <source>\n    @type tail\n    format json\n    path \"/home/pi/shodo-logs/shodo-funnel.log\"\n    pos_file \"/home/pi/shodo-logs/shodo-funnel.pos\"\n    tag \"funnel.shodo\"\n  </source>\n  <match funnel.**>\n    @type http\n    endpoint_url \"http://funnel.soracom.io/\"\n    http_method \"post\"\n    serializer \"json\"\n    rate_limit_msec 100\n    raise_on_error false\n  </match>\n</ROOT>\n```\n\n##fluentd\u3092\u5b9f\u884c\u3059\u308b\n```bash\n$ sudo fluentd -c /fluent/fluent.conf -v -o /fluent/fluent.log &\n[1] 20284\n```\n\u6b63\u5e38\u306b\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u306f/fluent/fluent.log\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u8d77\u52d5\u6642\u306b\u81ea\u52d5\u5b9f\u884c\u3059\u308b\u5834\u5408\u306f\u3001`/etc/rc.local`\u306b\u8a18\u8ff0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u203b\u300c20284\u300d\u306fPID\u306a\u306e\u3067\u3001\u5024\u306f\u5b9f\u884c\u306e\u5ea6\u306b\u5909\u308f\u308a\u307e\u3059\n\n#**[ToDo 8] Kinesis Firehose\u306b\u30c7\u30fc\u30bf\u3092\u6d41\u3057\u3066\u307f\u308b(\u4e3b\u306bAWS)**\n\u30bb\u30f3\u30b7\u30f3\u30b0\u3092\u958b\u59cb\u3057\u3066\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306bJSON\u304c\u66f8\u304d\u8fbc\u307e\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u6b63\u3057\u304f\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308c\u3070\u3001S3\u30d0\u30b1\u30c3\u30c8\u306b\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u304c\u66f8\u304d\u8fbc\u307e\u308c\u308b\u306f\u305a\u3067\u3059\u3002\u30ed\u30b0\u306fBuffer interval\u3067\u6307\u5b9a\u3057\u305f\u79d2\u6570(\u30c7\u30d5\u30a9\u30eb\u30c8\u306f300\u79d2)\u3054\u3068\u306b\u66f8\u304d\u8fbc\u307e\u308c\u308b\u306e\u3067\u3001S3\u30d0\u30b1\u30c3\u30c8\u306b\u4fdd\u5b58\u3055\u308c\u308b\u307e\u3067\u30bf\u30a4\u30e0\u30e9\u30b0\u304c\u3042\u308a\u307e\u3059\u3002\n\u6b63\u3057\u304f\u52d5\u4f5c\u3057\u3066\u3044\u306a\u3051\u308c\u3070`/fluent/fluent.log`\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n\n* Kinesis Firehose\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u958b\u304f\n* Stream\u3092\u9078\u629e -> [Actions] -> [Monitor]<BR>\n![Amazon Kinesis Firehose 2016-10-20 20-09-10.png](https://qiita-image-store.s3.amazonaws.com/0/80392/114c0737-6444-42f0-e605-d2446006017e.png)<BR><BR>\n* \u6298\u308c\u7dda\u30b0\u30e9\u30d5\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308c\u3070\u6b63\u5e38\u306b\u52d5\u4f5c\u3057\u3066\u3044\u308b<BR>\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-10-20 20.10.11.png](https://qiita-image-store.s3.amazonaws.com/0/80392/d4af8264-887a-9409-5f61-c5bf2c2c8255.png)<BR><BR>\n* S3\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u958b\u304f\n* Kinesis Firehose\u306e\u8a2d\u5b9a\u3067\u6307\u5b9a\u3057\u305f\u30d0\u30b1\u30c3\u30c8\u3092\u958b\u304f\n* \u30ed\u30b0\u304c\u66f8\u304d\u8fbc\u307e\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b(\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u306fUTC)<BR>\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-10-20 20.02.32.png](https://qiita-image-store.s3.amazonaws.com/0/80392/31f7d161-c103-f28d-bd75-61729320457b.png)<BR><BR>\n* \u30ed\u30b0\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u958b\u304f\u3068JSON\u304c\u66f8\u304d\u8fbc\u307e\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b<BR>\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-10-20 20.20.46.png](https://qiita-image-store.s3.amazonaws.com/0/80392/cf683be2-0542-e7b6-86bc-5c6ba0b6a099.png)\n\n#**[ToDo 9] Lambda Function\u3092\u4f5c\u6210\u3059\u308b(AWS)**\n\u5148\u307b\u3069\u306fKinesis Firehose\u304cS3\u30d0\u30b1\u30c3\u30c8\u306b\u30c7\u30fc\u30bf\u3092\u914d\u9001\u3057\u3066\u304f\u308c\u307e\u3057\u305f\u304c\u3001DynamoDB\u306b\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3059\u308b\u306b\u306fRaspberryPi -> Kinesis Streams -> Lambda -> DynamoDB\u3068\u3044\u3046\u30c7\u30fc\u30bf\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u69cb\u7bc9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002Kinesis Streams\u306b\u30c7\u30fc\u30bf\u304c\u66f8\u304d\u8fbc\u307e\u308c\u305f\u3053\u3068\u3092\u30c8\u30ea\u30ac\u30fc\u306bLambda Function\u304c\u8d77\u52d5\u3057\u3066\u3001DynamoDB\u306b\u30c7\u30fc\u30bf\u3092\u66f8\u304d\u8fbc\u307f\u307e\u3059\u3002\u3067\u306f\u3001Lambda Function\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\u3002\n\n##async\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u53d6\u5f97\u3059\u308b\nLambda Function\u306f\u3001Java / NodeJS / Python\u3067\u8a18\u8ff0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u304c\u3001\u4eca\u56de\u306fNodeJS\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u5b9f\u884c\u306b\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u306f\u3001\u3042\u3089\u304b\u3058\u3081\u5b9f\u884c\u3059\u308b\u30b3\u30fc\u30c9\u3068\u3068\u3082\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30e9\u30a4\u30d6\u30e9\u30ea\u306fLinux\u74b0\u5883\u3067npm\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066\u53d6\u5f97\u3057\u307e\u3059\u3002\u3082\u3061\u308d\u3093\u3001RaspberryPi\u3082\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n\n```bash\n$ cd ~\n$ sudo apt-get install -y npm\n$ mkdir node-lib\n$ cd node-lib\n$ npm install async\n$ ls -l\ntotal 4\ndrwxr-xr-x 3 pi pi 4096 Oct 20 23:03 node_modules\n```\n\n`node-lib/node_modules/`\u306b\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3001node_modules\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3054\u3068SFTP\u7b49\u3067PC\u30ed\u30fc\u30ab\u30eb\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n##Lambda Function\u7528\u306e\u30b3\u30fc\u30c9\u3092\u4f5c\u6210\u3059\u308b\n* PC\u306e\u30c6\u30ad\u30b9\u30c8\u30a8\u30c7\u30a3\u30bf\u3067`index.js`\u3068\u3044\u3046\u540d\u524d\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\u30b3\u30e1\u30f3\u30c8\u884c\u306e\u7b87\u6240\u306f\u9069\u5b9c\u4fee\u6b63\u3059\u308b\n\n```js:index.js\nvar AWS = require('aws-sdk');\nvar async = require('async');\n//DynamoDB\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3059\u308b\nvar dynamodb = new AWS.DynamoDB({region: 'ap-northeast-1'});\n\nvar get_current_timestamp = function() {\n    var d = new Date();\n    var month  = d.getMonth() + 1;\n    var day    = d.getDate();\n    var hour   = d.getHours();\n    var minute = d.getMinutes();\n    var second = d.getSeconds();\n \n    if (month < 10) {month = \"0\" + month;}\n    if (day < 10) {day = \"0\" + day;}\n    if (hour < 10) {hour = \"0\" + hour;}\n    if (minute < 10) {minute = \"0\" + minute;}\n    if (second < 10) {second = \"0\" + second;}\n\n    return d.getFullYear()  + \"-\" + month + \"-\" + day + \"T\" + hour + \":\" + minute + \":\" + second + \"Z\";\n}\n\nexports.handler = function(event, context) {\n    async.eachSeries(event.Records, function(v, callback){\n        var encodedPayload = v.kinesis.data;\n        var payload = new Buffer(encodedPayload, 'base64').toString('ascii');\n        var data = JSON.parse(payload);\n        if(typeof data.operatorId != \"undefined\"){\n          var params = {\n            Item: {\n                //\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u306ekey\u540d\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3059\u308b\n                'time_sensor': { S: data.payloads.time_sensor},\n                //Lambda\u306e\u51e6\u7406\u6642\u523b\u3092UTC\u3067\u8a18\u9332\u3059\u308b\n                'time_lambda': { S: get_current_timestamp()},\n                //\u30c7\u30d0\u30a4\u30b9ID\u306ekey\u540d\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3059\u308b\n                'ID': { S: data.payloads.ID},\n                //\u30bb\u30f3\u30b5\u30fc\u8a08\u6e2c\u5024\u306ekey\u540d\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3059\u308b\n                'brightness': { N: String(data.payloads.brightness)}\n            },\n            //DynamoDB\u306e\u30c6\u30fc\u30d6\u30eb\u540d\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3059\u308b\n            'TableName': 'iotan-funnel'\n          };\n        }else{\n          console.log('NOT SORACOM');\n        }\n        dynamodb.putItem(params, function(err) {\n            if (err) console.log(err, err.stack); callback();\n        });\n    }, function(err,result){\n        if (err) {\n            context.fail(err);\n        } else {\n            context.succeed('success');\n        }\n    });\n}\n```\n\n* `index.js`\u3068\u5148\u307b\u3069\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f`node_modules`\u3092`myfunc.zip`\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u540d\u3067ZIP\u5727\u7e2e\u3059\u308b<BR>\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-10-20 23.34.44.png](https://qiita-image-store.s3.amazonaws.com/0/80392/11b9a605-d293-1eba-ce7b-b5b06c358263.png)\n\n##Lambda Function\u3092\u4f5c\u6210\u3059\u308b\n* Lambda\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u958b\u304f\n* \u30ea\u30fc\u30b8\u30e7\u30f3\u304c\u300cAsia Pacific (Tokyo)\u300d\u3067\u306a\u3044\u5834\u5408\u306f\u5909\u66f4\u3059\u308b<BR>\n![DynamoDB \u00b7 AWS Console 2016-04-02 16-55-11.png](https://qiita-image-store.s3.amazonaws.com/0/80392/4bd6b0f2-3593-3b10-1839-62f3c2f13173.png)<BR><BR>\n* [Get Started Now]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b<BR>\n![l-1.png](https://qiita-image-store.s3.amazonaws.com/0/80392/570f2114-5e04-0c4a-af16-e42359ab83fb.png)<BR><BR>\n* [Blank Function]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b<BR>\n![l-2.png](https://qiita-image-store.s3.amazonaws.com/0/80392/e7b35963-2556-a2ce-3396-4f43f28f6b63.png)<BR><BR>\n* \u70b9\u7dda\u56f2\u307f\u3092\u30af\u30ea\u30c3\u30af -> [Kinesis] -> [Next]<BR>\n ![l-3.png](https://qiita-image-store.s3.amazonaws.com/0/80392/0a71584b-03af-6679-e1bf-562f205598c8.png)<BR><BR>\n* Kinesis stream\u3067[ToDo 4]\u3067\u4f5c\u6210\u3057\u305fStream\u3092\u9078\u629e\u3059\u308b\n* Starting position\u3067[Trim horizon]\u3092\u9078\u629e\u3059\u308b\n* [Enable trigger]\u306b\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u308b\n* [Next]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b<BR>\n![l-4.png](https://qiita-image-store.s3.amazonaws.com/0/80392/ed6e0479-7dec-82c5-3b2c-596961074602.png)<BR><BR>\n* Name\u306b\u4efb\u610f\u306eFunction\u540d(\u3053\u3053\u3067\u306f\u300ciotan-funnel\u300d\u3068\u3057\u3066\u3044\u308b)\u3092\u5165\u529b\u3059\u308b<BR>\n![l-5-a.png](https://qiita-image-store.s3.amazonaws.com/0/80392/da6aa8e4-8691-7b4e-9819-5838be021ea4.png)<BR><BR>\n* \u5148\u307b\u3069\u4f5c\u6210\u3057\u305fmyfunc.zip\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b<BR>\n![l-5-b.png](https://qiita-image-store.s3.amazonaws.com/0/80392/6ab2d4b0-4531-a54f-c2dd-1d9ade3962a1.png)<BR><BR>\n* Role\u3067[Create a custom role]\u3092\u9078\u629e\u3059\u308b\n* \u65b0\u3057\u3044\u30bf\u30d6\u3067\u30ed\u30fc\u30eb\u306e\u8a2d\u5b9a\u753b\u9762\u304c\u958b\u304f<BR>\n![l-5-c.png](https://qiita-image-store.s3.amazonaws.com/0/80392/09fbb395-7ea8-8d27-04e2-644b94a3d7b8.png)<BR><BR>\n* Role Name\u306b\u4efb\u610f\u306e\u30ed\u30fc\u30eb\u540d(\u3053\u3053\u3067\u306f\u300clambda_DynamoDB\u300d\u3068\u3057\u3066\u3044\u308b)\u3092\u5165\u529b\u3059\u308b\n* [Edit]\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001\u30c6\u30ad\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u306eJSON\u3092\u524a\u9664\u3057\u3066\u4e0b\u8a18\u306eJSON\u3092\u8cbc\u308a\u4ed8\u3051\u308b\n\n```JSON\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"Stmt1428341300017\",\n            \"Action\": [\n                \"dynamodb:DeleteItem\",\n                \"dynamodb:GetItem\",\n                \"dynamodb:PutItem\",\n                \"dynamodb:Query\",\n                \"dynamodb:Scan\",\n                \"dynamodb:UpdateItem\"\n            ],\n            \"Effect\": \"Allow\",\n            \"Resource\": \"*\"\n        },\n        {\n            \"Sid\": \"\",\n            \"Resource\": \"*\",\n            \"Action\": [\n                \"logs:CreateLogGroup\",\n                \"logs:CreateLogStream\",\n                \"logs:PutLogEvents\"\n            ],\n            \"Effect\": \"Allow\"\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"lambda:InvokeFunction\"\n            ],\n            \"Resource\": \"*\"\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"kinesis:*\"\n            ],\n            \"Resource\": \"*\"\n        }\n    ]\n}\n```\n\n* [Allow]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u30bf\u30d6\u304c\u9589\u3058\u308b<BR>\n![l-5-d.png](https://qiita-image-store.s3.amazonaws.com/0/80392/34e1efec-5adb-6493-d8cd-79d925ae6ca5.png)<BR><BR>\n* \u5143\u306e\u753b\u9762\u306b\u623b\u3063\u3066\u3001Timeout\u309230\u79d2\u306b\u8a2d\u5b9a\u3059\u308b\n* [Next]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b<BR>\n![l-6.png](https://qiita-image-store.s3.amazonaws.com/0/80392/a5e09fee-4b95-cee5-17c4-ea2f93b43241.png)<BR><BR>\n* \u30ed\u30fc\u30eb\u540d\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066[Create function]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3002\u3082\u3057\u3001\u30ed\u30fc\u30eb\u304c\u5f53\u305f\u3063\u3066\u3044\u306a\u3044\u5834\u5408\u306f[Edit]\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u4fee\u6b63\u3059\u308b<BR>\n![l-7.png](https://qiita-image-store.s3.amazonaws.com/0/80392/b49c333f-b908-fa4b-a54a-05e7996e29aa.png)\n\n#**[ToDo 10] DynamoDB\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3059\u308b(AWS)**\nkey\u540d\u306f[ToDo 9]\u3067\u8a2d\u5b9a\u3057\u305f\u3082\u306e\u3068\u540c\u3058\u3082\u306e\u3092\u5165\u529b\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n* DynamoDB\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u958b\u304f\n* \u30ea\u30fc\u30b8\u30e7\u30f3\u304c\u300cAsia Pacific (Tokyo)\u300d\u3067\u306a\u3044\u5834\u5408\u306f\u5909\u66f4\u3059\u308b<BR>\n![DynamoDB \u00b7 AWS Console 2016-04-02 16-55-11.png](https://qiita-image-store.s3.amazonaws.com/0/80392/4bd6b0f2-3593-3b10-1839-62f3c2f13173.png)<BR><BR>\n* [Create table]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b<BR>\n![DynamoDB \u00b7 AWS Console 2016-04-01 23-02-21.png](https://qiita-image-store.s3.amazonaws.com/0/80392/ed90be9a-8c72-8032-26eb-78bc959573a5.png)\n<BR><BR>\n* Table name\u306b\u5148\u307b\u3069Lambda\u3067\u6307\u5b9a\u3057\u305f\u30c6\u30fc\u30d6\u30eb\u540d(\u3053\u3053\u3067\u306f\u300ciotan-funnel\u300d\u3068\u3057\u3066\u3044\u308b)\u3092\u5165\u529b\u3059\u308b\n* Partition key\u306b\u30c7\u30d0\u30a4\u30b9ID\u306eKey(\u3053\u3053\u3067\u306f\u300cID\u300d\u3068\u3057\u3066\u3044\u308b)\u3092\u5165\u529b\u3059\u308b\n* [Add sort key]\u306b\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u3001\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u306eKey(\u3053\u3053\u3067\u306f\u306f\u300ctime_sensor\u300d\u3068\u3057\u3066\u3044\u308b)\u3092\u5165\u529b\u3059\u308b\n* [Create]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b<BR>\n![DynamoDB \u00b7 AWS Console 2016-10-20 22-02-55.png](https://qiita-image-store.s3.amazonaws.com/0/80392/b9c3c706-5c99-82d3-be30-f4fb2f95983a.png)<BR><BR>\n* \u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\u304c\u7d42\u308f\u308b\u306e\u3092\u5f85\u3064\n\n#**[ToDo 11] Kinesis Streams\u306b\u30c7\u30fc\u30bf\u3092\u6d41\u3057\u3066DynamoDB\u306b\u30c7\u30fc\u30bf\u304c\u683c\u7d0d\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u304b\u3081\u308b(\u4e3b\u306bAWS)**\n##SORACOM Funnel\u306e\u914d\u9001\u5148\u3092Kinesis Streams\u306b\u5909\u66f4\u3059\u308b\n[[ToDo 5]\u306e\u6700\u7d42\u9805](http://qiita.com/Ichiro_Tsuji/items/b432ac99a690a31151fd#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E9%85%8D%E9%80%81%E5%85%88%E3%82%92kinesis-streams%E3%81%AB%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B)\u306e\u624b\u9806\u3067\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n##DynamoDB\u306b\u30c7\u30fc\u30bf\u304c\u683c\u7d0d\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u304b\u3081\u308b\nRaspberryPi\u304b\u3089\u30c7\u30fc\u30bf\u3092\u9001\u4fe1\u3057\u3001\u4e0b\u8a18\u624b\u9806\u3067DynamoDB\u306b\u30c7\u30fc\u30bf\u304c\u66f8\u304d\u8fbc\u307e\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u304b\u3081\u307e\u3059\u3002\n\n* [Tables] -> (\u4f5c\u6210\u3057\u305f\u30c6\u30fc\u30d6\u30eb) -> [Items]\u306e\u9806\u306b\u30af\u30ea\u30c3\u30af\u3059\u308b<BR>\n![DynamoDB \u00b7 AWS Console 2016-04-01 23-18-32.png](https://qiita-image-store.s3.amazonaws.com/0/80392/958879af-2f30-b5e0-df10-17e1185b64c4.png)\n<BR><BR>\n* [Query]\u3092\u9078\u629e\u3059\u308b\n* [Partition key]\u306b\u73fe\u5728\u9001\u4fe1\u4e2d\u306e\u30c7\u30d0\u30a4\u30b9ID\u3092\u5165\u529b\u3059\u308b\n* [Descending]\u3092\u9078\u629e\u3059\u308b\n* [Start search]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u5ea6\u306b\u6700\u65b0\u306e\u30ec\u30b3\u30fc\u30c9\u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u304f\u306e\u304c\u308f\u304b\u308b<BR>\n![DynamoDB \u00b7 AWS Console 2016-04-01 23-25-44.png](https://qiita-image-store.s3.amazonaws.com/0/80392/c9fb82fc-a1c8-6e6f-739a-7a49267a40f4.png)\n\n##\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\nKinesis Streams\u3068Lambda\u306e\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u3084\u30ed\u30b0\u3092\u78ba\u8a8d\u3059\u308b\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002\n\n* Kinesis Streams\u306e\u30e1\u30c8\u30ea\u30c3\u30af\u30b9<BR>\n![kinesis.png](https://qiita-image-store.s3.amazonaws.com/0/80392/8a26eda1-2141-ceb4-1b97-78250f028184.png)<BR>\n* Lambda\u306e\u7c21\u6613\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u3002\u3053\u306e\u753b\u9762\u304b\u3089\u30ed\u30b0\u306e\u753b\u9762\u306b\u9077\u79fb\u3067\u304d\u308b<BR>\n![lambda1.png](https://qiita-image-store.s3.amazonaws.com/0/80392/bd0f88c4-8bf3-a517-94ed-8099b4bed51d.png)<BR><BR>\n* Lambda\u306e\u30ed\u30b0\u306e\u753b\u9762\u3002\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3082\u8868\u793a\u3055\u308c\u308b<BR>\n![lambda2.png](https://qiita-image-store.s3.amazonaws.com/0/80392/66124b11-536c-7907-9506-bac9b515f93c.png)\n\n#**[ToDo 12] IoT.kyoto VIS\u3067\u30b0\u30e9\u30d5\u8868\u793a\u3059\u308b**\n**\u30d6\u30e9\u30a6\u30b6\u306fChrome(Win/Mac)\u307e\u305f\u306fSafari(Mac)\u3092\u304a\u4f7f\u3044\u4e0b\u3055\u3044\u3002**\n\u6700\u5f8c\u306bDynamoDB\u306e\u30c7\u30fc\u30bf\u3092**~~\u3044\u304a\u305f\u3093\u3067~~**[**IoT.kyoto VIS**](http://iot.kyoto)\u3067\u53ef\u8996\u5316\u3057\u307e\u3057\u3087\u3046\u3002\n##\u30b5\u30a4\u30f3\u30a2\u30c3\u30d7\nhttps://vis.iot.kyoto \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3001\u300c\u65b0\u898f\u767b\u9332\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n##\u8a2d\u5b9a\n[IoT.kyoto VIS\u516c\u5f0f\u30de\u30cb\u30e5\u30a2\u30eb](http://qiita.com/kyoso_bizdev/items/9223cb6fa125e1502183)\u306e3\uff5e4\u7ae0\u3092\u53c2\u7167\u3002\nAWS\u306eKey\u306b\u306f\u3001[ToDo 3]\u3067\u4f5c\u6210\u3057\u305f\u300cdynamo-read\u300d\u30e6\u30fc\u30b6\u30fc\u306eKey\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n##\u3044\u308d\u3044\u308d\u8a66\u3057\u3066\u307f\u308b\n[\u30ec\u30f3\u30b8\u8a2d\u5b9a]\u3092[\u624b\u52d5]\u306b\u5909\u66f4\u3057\u30660\uff5e1000\u304f\u3089\u3044\u306b\u8a2d\u5b9a\u3059\u308b\u3068\u30b0\u30e9\u30d5\u304c\u898b\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u3002\u4e0b\u8a18\u306e\u3088\u3046\u306a\u3053\u3068\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\n* \u30d5\u30a9\u30c8\u30c8\u30e9\u30f3\u30b8\u30b9\u30bf\u306b\u30e9\u30a4\u30c8\u3092\u5f53\u3066\u305f\u308a\u624b\u3067\u8986\u3063\u305f\u308a\u3057\u3066\u3001\u30b0\u30e9\u30d5\u306e\u5909\u5316\u3084\u63cf\u753b\u307e\u3067\u306e\u9045\u5ef6\u3092\u78ba\u8a8d\u3059\u308b\n* \u95be\u5024\u8d85\u3048\u306e\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u304c\u5c4a\u304f\u304b\u8a66\u3057\u3066\u307f\u308b\n* \u65e5\u6642\u6307\u5b9a\u3067\u904e\u53bb\u306e\u5c65\u6b74\u3092\u8868\u793a\u3057\u3066\u307f\u308b\n* \u5225window\u3067\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u958b\u304d\u3001\u30c7\u30d0\u30a4\u30b9ID\u3092\u5909\u3048\u305fPython\u30b3\u30fc\u30c9\u3092\u5b9f\u884c(\u64ec\u4f3c\u7684\u306b\u8907\u6570\u30c7\u30d0\u30a4\u30b9\u304c\u63a5\u7d9a\u3055\u308c\u305f\u72b6\u614b\u3068\u306a\u308b)\u3057\u3066\u3001IoT.kyoto VIS\u306e\u753b\u9762\u30672\u500b\u306e\u30b0\u30e9\u30d5\u3092\u540c\u6642\u306b\u8868\u793a\u3057\u3066\u307f\u308b\n* \u30c7\u30fc\u30bf\u306e\u9001\u4fe1\u9593\u9694\u3092\u5909\u3048\u3066\u307f\u308b(\u300c\u30b0\u30e9\u30d5\u8a2d\u5b9a(\u6b6f\u8eca)\u300d\u3067\u30b0\u30e9\u30d5\u306e\u66f4\u65b0\u9593\u9694\u3092\u5909\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059)\n![IoT.kyoto\u7167\u5ea6\u30b5\u30f3\u30d7\u30eb.png](https://qiita-image-store.s3.amazonaws.com/0/80392/14084335-223b-4291-2abb-4c7a332983bb.png)\n\n#**\u307e\u3068\u3081**\n\u4eca\u56de\u306f\u4e0b\u8a182\u901a\u308a\u306e\u30c7\u30fc\u30bf\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u69cb\u7bc9\u3057\u307e\u3057\u305f\u3002\n\n* \u30c7\u30d0\u30a4\u30b9 -> SORACOM Funnel -> Kinesis Firehose -> S3\n* \u30c7\u30d0\u30a4\u30b9 -> SORACOM Funnel -> Kinesis Streams -> Lambda -> DynamoDB\n\n\u524d\u8005\u306f\u3001\u3068\u308a\u3042\u3048\u305a\u624b\u8efd\u306b\u30c7\u30fc\u30bf\u3092\u96c6\u3081\u305f\u3044\u3068\u3044\u3046\u3088\u3046\u306a\u30b1\u30fc\u30b9\u306b\u6700\u9069\u3067\u3059\u3002\u307e\u305f\u3001Redshift\u3084Elasticsearch Service\u306b\u3082\u6d41\u305b\u308b\u306e\u3067\u5922\u304c\u5e83\u304c\u308a\u30f3\u30b0\u3067\u3059\u306d\uff01\n\u5f8c\u8005\u306f\u3001\u96c6\u3081\u305f\u30c7\u30fc\u30bf\u3092\u57fa\u306b\u53ef\u8996\u5316\u3084\u76e3\u8996\u306a\u3069\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u69cb\u7bc9\u3057\u305f\u3044\u5834\u5408\u306b\u6700\u9069\u3067\u3059\u3002DynamoDB\u306f\u3061\u3083\u3093\u3068\u5206\u304b\u3063\u3066\u4f7f\u3048\u3070SQL\u7cfb\u306eDBMS\u3067\u306f\u5b9f\u73fe\u3067\u304d\u306a\u304b\u3063\u305f\u3088\u3046\u306a\u8d85\u5f37\u529b\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u4f5c\u308c\u3061\u3083\u3044\u307e\u3059\u3002\u307e\u305f\u3001\u76e3\u8996\u7cfb\u306e\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u306fLambda\u3067\u30b5\u30af\u30c3\u3068\u5b9f\u88c5\u3057\u3061\u3083\u3046\u306e\u304c\u826f\u3044\u3067\u3059\u306d\u3002\nSORACOM\u3092\u5358\u306a\u308b\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a\u624b\u6bb5\u3068\u3057\u3066\u4f7f\u3046\u306a\u3093\u3066\u3082\u3063\u305f\u3044\u306a\u3044\uff01\uff01\u305c\u3072SORACOM\u306e\u4e16\u754c\u306bDeep Dive\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n", "tags": ["RaspberryPi", "AWS", "SORACOM", "IoT"]}