{"tags": ["bitbucket", "wercker", "Deployer", "\u3055\u304f\u3089\u30ec\u30f3\u30bf\u30eb\u30b5\u30fc\u30d0\u30fc"], "context": "\n\n\u30c7\u30d7\u30ed\u30a4\u30d5\u30ed\u30fc\n\n\n\u8e93\u3044\u305f\u3068\u3053\u308d\u3060\u3051\u307e\u3068\u3081\u307e\u3059\u3002\n\nwercker\u306eworkflows\u306e\u8a2d\u5b9a\u304c\u308f\u304b\u3089\u306a\u304b\u3063\u305f\nworkflows\u306epipeline\u306fwercker.yml\u306b\u8a18\u8ff0\u3059\u308b\u4ee5\u4e0b\u306e\u7b87\u6240\u3068\u540d\u524d\u3092\u5408\u308f\u305b\u308b\n\nwercker.yml\nbox: boedy/wercker-php\nno-response-timeout: 25\n\nbuild:\u3000\u3000<-\u3000\u30b3\u30b3\u3068\u540d\u524d\u3092\u5408\u308f\u305b\u308b\n    steps:\n       - script:\n\n\n\nwercker.yml\u306e\u8a2d\u5b9a\n\ncd\u306e\u4ed5\u65b9\u304c\u308f\u304b\u3089\u304b\u306a\u3063\u305f\ncwd\u3092\u4f7f\u3063\u3066\u30ef\u30fc\u30ad\u30f3\u30b0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u5207\u308a\u66ff\u3048\u308b\n\nwercker.yml\n- script:\n    name: deploy application\n    cwd: deploy/\n    code: php deployer.phar deploy -vvv production\n\n\n\nyml\u306e\u8a2d\u5b9a\u304c\u308f\u304b\u3089\u306a\u304b\u3063\u305f\u3002\n\nwercker.yml\nbox: boedy/wercker-php\nno-response-timeout: 25\nbuild:\n    steps:\n       - script:\n          name: deployer install\n          cwd: deploy/\n          code: curl -L -O http://deployer.org/deployer.phar\n\ndeploy:\n    steps:\n       - script:\n            name: make .ssh directory\n            code: mkdir -p \"$HOME/.ssh\"\n\n       - create-file:\n          name: write id_rsa\n          filename: $HOME/.ssh/id_rsa\n          content: $SAKURA_KEY_PRIVATE\n          overwrite: true\n          hide-from-log: true\n\n       - create-file:\n          name: write id_rsa pub\n          filename: $HOME/.ssh/id_rsa.pub\n          content: $SAKURA_KEY_PUBLIC\n          overwrite: true\n          hide-from-log: true\n\n       - script:\n          name: deploy application\n          cwd: deploy/\n          code: php deployer.phar deploy -vvv production\n\n\n\n\ndeployer\u306e\u8a2d\u5b9a\u304c\u308f\u304b\u3089\u306a\u304b\u3063\u305f\ngit\u3092\u3055\u304f\u3089\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5fc5\u8981\u304c\u3042\u3063\u305f\u306e\u3067bin\u306e\u5834\u6240\u3092\u6307\u5b9a\n\u203b\u30b5\u30af\u30e9\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308bgit\u306f\u4f7f\u3048\u306a\u304b\u3063\u305f\n\ndeploy.php\n<?php\nrequire 'recipe/laravel.php';\n\nserverList('server.yml'); // server\u60c5\u5831\u306fserver.yml\u306b\u307e\u3068\u3081\u305f\nset('repository', 'git@bitbucket.org:xxx/xxx.git'); // \u30c7\u30d7\u30ed\u30a4\u3059\u308b\u30ea\u30dd\u30b8\u30c8\u30ea\nset('writable_use_sudo', false); // sudo \u6a29\u9650\u306a\u3044\u306e\u3067\u3000false\nenv('bin/git', '/home/xxx/local/bin/git'); //\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fgit\u306ebin\n\nset('shared_files', ['.env']);\nset('shared_dirs', [\n    'storage/app',\n    'storage/framework/cache',\n    'storage/framework/sessions',\n    'storage/framework/views',\n    'storage/logs',\n]);\nset('writable_dirs', ['bootstrap/cache', 'storage']);\n\n/**\n * Make writable dirs.\n */\ntask('deploy:writable', function () {\n\n//\u7565\n\n})->desc('Make writable dirs');\n\n\n\u300c//\u7565\u300d\u306e\u90e8\u5206\u30fb\u30fb\u30fb\ndeployer\u306edeploy:writable\u304cchmod 777 -R\u3068\u306a\u3063\u3066\u304a\u308a\u3001\n\u5b9f\u884c\u6642\u306b\u30a8\u30e9\u30fc\u306b\u306a\u3063\u305f\u306e\u3067\u3001\u30bf\u30b9\u30af\u3092\u4e0a\u66f8\u304f\u305f\u3081\u5185\u5bb9\u3092\u30b3\u30d4\u30fc\u3057\u3066\u6240\u5b9a\u306e\u7b87\u6240\u3092\u4fee\u6b63\u3057\u305f\nchmod 777 -R ->\u3000chmod -R 777 \n\u8ffd\u8a18\n\u4e0a\u8a18\u306e\u300c//\u7565\u300d\u306e\u90e8\u5206\u306f\u4ee5\u4e0b\u306ePR\u304c\u30de\u30fc\u30b8\u3055\u308c\u305f\u305f\u3081\u5bfe\u5fdc\u4e0d\u8981\u3068\u306a\u308a\u307e\u3057\u305f\u3002(^o^)/\nhttps://github.com/deployphp/deployer/commit/fa46d3f58f22f2d917a10854d54c9419fabbdb28\n\nserver.yml\u306e\u8a2d\u5b9a\u304c\u308f\u304b\u3089\u306a\u304b\u3063\u305f\n\nsercer.yml\nproduction:\n  host: xxx.sakura.ne.jp\n  identity_file:\n    private_key: \"/root/.ssh/id_rsa\"\n    public_key:  \"/root/.ssh/id_rsa.pub\"\n  user: username\n  stage: production\n  deploy_path: \"~/export\"\n  branch: master\n\n\nproduction\u306fwercker.yml\u306e\nphp deployer.phar deploy -vvv production\u3067\u6307\u5b9a\u3057\u3066\u3044\u308b\n\n\u3055\u304f\u3089\u3067\u306e\u8a2d\u5b9a\u304c\u308f\u304b\u3089\u306a\u304b\u3063\u305f\n\ncsh\u304b\u3089bash\u306b\u5909\u3048\u308b\n\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u4e0a\u3067\u30b7\u30a7\u30eb\u304c\u5b9f\u884c\u3067\u304d\u306a\u304b\u3063\u305f\u3002\n\u3055\u304f\u3089\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30b7\u30a7\u30eb\u3092\u5909\u66f4\u3057\u305f\nbash\u306e\u5834\u6240\u3092\u8abf\u3079\u308b\n$ cat /etc/shells\n\u5909\u66f4\u3059\u308b\n$ chsh -s /usr/local/bin/bash\nexit\u3057\u3066\u5165\u308a\u76f4\u3057\u3001\u53cd\u6620\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n\u3055\u304f\u3089\u306egit\u304c\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u304b\u3063\u305f\ndeployer\u5b9f\u884c\u6642\u306bgit\u30b3\u30de\u30f3\u30c9\u3067\u3067\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\u3002\nfatal: git was built without support for git-submodule (NO_PERL=1).\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ wget https://github.com/git/git/archive/v2.10.0-rc2.tar.gz\n$ tar xjvf v2.10.0-rc2.tar.gz\n$ cd git-2.10.0-rc2/\n$ gmake configure\n$ ./configure --prefix=$HOME/local\n$ gmake all install\n\n\u30d1\u30b9\u3092\u901a\u3059.bashrc\nPATH=$HOME/local/bin:$PATH\n\n\u78ba\u8a8d\n$ which git\n/home/userid/bin/bin/git\n$ git --version\ngit version 2.10.0-rc2\n\n\n\u53c2\u8003\u306b\u3057\u305f\u30b5\u30a4\u30c8\nLaravel5\u3092\u3055\u304f\u3089\u306e\u30ec\u30f3\u30bf\u30eb\u30b5\u30fc\u30d0\u3067\u52d5\u304b\u3059\uff08\u30b9\u30bf\u30f3\u30c0\u30fc\u30c9\u30d7\u30e9\u30f3\u4ee5\u4e0a\uff09\nwercker\u3092\u4f7f\u3063\u3066\u3001\u3055\u304f\u3089\u30b5\u30fc\u30d0\u306b\u81ea\u52d5\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u307e\u3057\u305f\n\u3055\u304f\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30b7\u30a7\u30eb\u3092bash \u306b\u5909\u66f4\u3057\u3066\u307f\u305f\n\u3055\u304f\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30ec\u30f3\u30bf\u30eb\u30b5\u30fc\u30d0\u306bGit\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\u30c7\u30d7\u30ed\u30a4\u30c4\u30fc\u30eb\u3092\u4f7f\u3063\u3066Laravel\u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b\ndeployer docs\n# \u30c7\u30d7\u30ed\u30a4\u30d5\u30ed\u30fc\n![\u30c6\u3099\u30d5\u309a\u30ed\u30a4\u30d5\u30ed\u30fc.png](https://qiita-image-store.s3.amazonaws.com/0/87172/7dc897c9-1522-a826-bb5f-946a1069df7f.png)\n\n\n\n# \u8e93\u3044\u305f\u3068\u3053\u308d\u3060\u3051\u307e\u3068\u3081\u307e\u3059\u3002\n## wercker\u306eworkflows\u306e\u8a2d\u5b9a\u304c\u308f\u304b\u3089\u306a\u304b\u3063\u305f\nworkflows\u306epipeline\u306fwercker.yml\u306b\u8a18\u8ff0\u3059\u308b\u4ee5\u4e0b\u306e\u7b87\u6240\u3068\u540d\u524d\u3092\u5408\u308f\u305b\u308b\n\n```yaml:wercker.yml\nbox: boedy/wercker-php\nno-response-timeout: 25\n\nbuild:\u3000\u3000<-\u3000\u30b3\u30b3\u3068\u540d\u524d\u3092\u5408\u308f\u305b\u308b\n    steps:\n       - script:\n```\n\n## wercker.yml\u306e\u8a2d\u5b9a\n### cd\u306e\u4ed5\u65b9\u304c\u308f\u304b\u3089\u304b\u306a\u3063\u305f\ncwd\u3092\u4f7f\u3063\u3066\u30ef\u30fc\u30ad\u30f3\u30b0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u5207\u308a\u66ff\u3048\u308b\n\n```yaml:wercker.yml\n- script:\n    name: deploy application\n    cwd: deploy/\n    code: php deployer.phar deploy -vvv production\n```\n\n### yml\u306e\u8a2d\u5b9a\u304c\u308f\u304b\u3089\u306a\u304b\u3063\u305f\u3002\n\n```yaml:wercker.yml\nbox: boedy/wercker-php\nno-response-timeout: 25\nbuild:\n    steps:\n       - script:\n          name: deployer install\n          cwd: deploy/\n          code: curl -L -O http://deployer.org/deployer.phar\n\ndeploy:\n    steps:\n       - script:\n            name: make .ssh directory\n            code: mkdir -p \"$HOME/.ssh\"\n\n       - create-file:\n          name: write id_rsa\n          filename: $HOME/.ssh/id_rsa\n          content: $SAKURA_KEY_PRIVATE\n          overwrite: true\n          hide-from-log: true\n\n       - create-file:\n          name: write id_rsa pub\n          filename: $HOME/.ssh/id_rsa.pub\n          content: $SAKURA_KEY_PUBLIC\n          overwrite: true\n          hide-from-log: true\n\n       - script:\n          name: deploy application\n          cwd: deploy/\n          code: php deployer.phar deploy -vvv production\n\n```\n    \n## deployer\u306e\u8a2d\u5b9a\u304c\u308f\u304b\u3089\u306a\u304b\u3063\u305f\ngit\u3092\u3055\u304f\u3089\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5fc5\u8981\u304c\u3042\u3063\u305f\u306e\u3067bin\u306e\u5834\u6240\u3092\u6307\u5b9a\n\u203b\u30b5\u30af\u30e9\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308bgit\u306f\u4f7f\u3048\u306a\u304b\u3063\u305f\n\n```php:deploy.php\n<?php\nrequire 'recipe/laravel.php';\n\nserverList('server.yml'); // server\u60c5\u5831\u306fserver.yml\u306b\u307e\u3068\u3081\u305f\nset('repository', 'git@bitbucket.org:xxx/xxx.git'); // \u30c7\u30d7\u30ed\u30a4\u3059\u308b\u30ea\u30dd\u30b8\u30c8\u30ea\nset('writable_use_sudo', false); // sudo \u6a29\u9650\u306a\u3044\u306e\u3067\u3000false\nenv('bin/git', '/home/xxx/local/bin/git'); //\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fgit\u306ebin\n\nset('shared_files', ['.env']);\nset('shared_dirs', [\n    'storage/app',\n    'storage/framework/cache',\n    'storage/framework/sessions',\n    'storage/framework/views',\n    'storage/logs',\n]);\nset('writable_dirs', ['bootstrap/cache', 'storage']);\n\n/**\n * Make writable dirs.\n */\ntask('deploy:writable', function () {\n\n//\u7565\n\n})->desc('Make writable dirs');\n```\n\n\u300c//\u7565\u300d\u306e\u90e8\u5206\u30fb\u30fb\u30fb\ndeployer\u306edeploy:writable\u304c[chmod 777 -R](https://github.com/deployphp/deployer/blob/master/recipe/common.php#L318)\u3068\u306a\u3063\u3066\u304a\u308a\u3001\n\u5b9f\u884c\u6642\u306b\u30a8\u30e9\u30fc\u306b\u306a\u3063\u305f\u306e\u3067\u3001\u30bf\u30b9\u30af\u3092\u4e0a\u66f8\u304f\u305f\u3081\u5185\u5bb9\u3092\u30b3\u30d4\u30fc\u3057\u3066\u6240\u5b9a\u306e\u7b87\u6240\u3092\u4fee\u6b63\u3057\u305f\n`chmod 777 -R` ->\u3000`chmod -R 777` \n\n\u8ffd\u8a18\n\u4e0a\u8a18\u306e\u300c//\u7565\u300d\u306e\u90e8\u5206\u306f\u4ee5\u4e0b\u306ePR\u304c\u30de\u30fc\u30b8\u3055\u308c\u305f\u305f\u3081\u5bfe\u5fdc\u4e0d\u8981\u3068\u306a\u308a\u307e\u3057\u305f\u3002*\\(^o^)/*\nhttps://github.com/deployphp/deployer/commit/fa46d3f58f22f2d917a10854d54c9419fabbdb28\n\n### server.yml\u306e\u8a2d\u5b9a\u304c\u308f\u304b\u3089\u306a\u304b\u3063\u305f\n\n```yaml:sercer.yml\nproduction:\n  host: xxx.sakura.ne.jp\n  identity_file:\n    private_key: \"/root/.ssh/id_rsa\"\n    public_key:  \"/root/.ssh/id_rsa.pub\"\n  user: username\n  stage: production\n  deploy_path: \"~/export\"\n  branch: master\n```\nproduction\u306fwercker.yml\u306e\n`php deployer.phar deploy -vvv production`\u3067\u6307\u5b9a\u3057\u3066\u3044\u308b\n\n\n## \u3055\u304f\u3089\u3067\u306e\u8a2d\u5b9a\u304c\u308f\u304b\u3089\u306a\u304b\u3063\u305f\n### csh\u304b\u3089bash\u306b\u5909\u3048\u308b\n[\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u4e0a\u3067\u30b7\u30a7\u30eb](https://github.com/deployphp/deployer/blob/master/recipe/common.php#L129)\u304c\u5b9f\u884c\u3067\u304d\u306a\u304b\u3063\u305f\u3002\n\u3055\u304f\u3089\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30b7\u30a7\u30eb\u3092\u5909\u66f4\u3057\u305f\n\nbash\u306e\u5834\u6240\u3092\u8abf\u3079\u308b\n`$ cat /etc/shells`\n\n\u5909\u66f4\u3059\u308b\n`$ chsh -s /usr/local/bin/bash`\n\nexit\u3057\u3066\u5165\u308a\u76f4\u3057\u3001\u53cd\u6620\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n### \u3055\u304f\u3089\u306egit\u304c\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u304b\u3063\u305f\ndeployer\u5b9f\u884c\u6642\u306bgit\u30b3\u30de\u30f3\u30c9\u3067\u3067\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\u3002\n\n```\nfatal: git was built without support for git-submodule (NO_PERL=1).\n```\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n$ wget https://github.com/git/git/archive/v2.10.0-rc2.tar.gz\n$ tar xjvf v2.10.0-rc2.tar.gz\n$ cd git-2.10.0-rc2/\n$ gmake configure\n$ ./configure --prefix=$HOME/local\n$ gmake all install\n```\n\n\u30d1\u30b9\u3092\u901a\u3059.bashrc\n\n```\nPATH=$HOME/local/bin:$PATH\n```\n\n\u78ba\u8a8d\n\n```\n$ which git\n/home/userid/bin/bin/git\n$ git --version\ngit version 2.10.0-rc2\n```\n\n# \u53c2\u8003\u306b\u3057\u305f\u30b5\u30a4\u30c8\n[Laravel5\u3092\u3055\u304f\u3089\u306e\u30ec\u30f3\u30bf\u30eb\u30b5\u30fc\u30d0\u3067\u52d5\u304b\u3059\uff08\u30b9\u30bf\u30f3\u30c0\u30fc\u30c9\u30d7\u30e9\u30f3\u4ee5\u4e0a\uff09](http://c-rtx.com/2015/09/22/laravel-on-sakura-rental-server/)\n[wercker\u3092\u4f7f\u3063\u3066\u3001\u3055\u304f\u3089\u30b5\u30fc\u30d0\u306b\u81ea\u52d5\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u307e\u3057\u305f](http://blog.6vox.com/2015/11/wercker_18.html)\n[\u3055\u304f\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30b7\u30a7\u30eb\u3092bash \u306b\u5909\u66f4\u3057\u3066\u307f\u305f](http://kawairi.jp/weblog/vita/2014123118987)\n[\u3055\u304f\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30ec\u30f3\u30bf\u30eb\u30b5\u30fc\u30d0\u306bGit\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b](http://blog.onpu-tamago.net/entry/2016/03/25/182707)\n[\u30c7\u30d7\u30ed\u30a4\u30c4\u30fc\u30eb\u3092\u4f7f\u3063\u3066Laravel\u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b](http://localdisk.hatenablog.com/entry/2015/12/24/153622)\n[deployer docs](http://deployer.org/docs)\n\n"}