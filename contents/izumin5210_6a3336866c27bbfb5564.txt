{"context": "\n\nTL;DR\n\n\u3084\u308a\u304b\u305f\n\n\nIAM\u3064\u304f\u308b\n .travis.yaml\u306edeploy.provider\u3092lambda\u306b\u3059\u308b\n\u8a2d\u5b9a\u3092\u9069\u5f53\u306b\u66f8\u304f\npush\u3059\u308b\n\u4fbf\u5229\n\n\n\u304c\u3093\u3070\u3063\u3066zip\u3057\u3066upload\u3057\u3066\u2026\u307f\u305f\u3044\u306a\u306e\u304c\u306a\u3044\u304b\u3089\u4fbf\u5229\nLambda\u3060\u3068cron\u7684\u306a\u5b9a\u671f\u51e6\u7406\u3082\u96d1\u306b\u6271\u3048\u308b\u3057\u5b89\u3044\u304b\u3089\u4fbf\u5229\n\n\n\n\n\u3055\u3093\u3077\u308b: izumin5210/kusa-store\n\nGitHub\u306e\u30e6\u30fc\u30b6\u30da\u30fc\u30b8\u304b\u3089\u8349\u72b6\u6cc1\u3092\u62fe\u3063\u3066S3\u306b\u4fdd\u5b58\u3059\u308b\u3084\u3064\n\n\n\n\n\u3084\u308a\u304b\u305f\n\nIAM Role\u3064\u304f\u308b\n\u30de\u30b8\u30e1\u306b\u3084\u3089\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3084\u3064\u306a\u3089CloudFormation\u3068\u304b\u4f7f\u3063\u3066\u30a4\u30a4\u30ab\u30f3\u30b8\u306b\u3084\u308b\uff08\u300cAWS Lambda\u306e\u30c7\u30d7\u30ed\u30a4\u30d5\u30ed\u30fc\u7ba1\u7406 - Qiita\u300d\u304c\u53c2\u8003\u306b\u306a\u308b\uff09\uff0e\n\u96d1\u3067\u3044\u3044\u306a\u3089AWS\u306eweb console\u304b\u3089\u96d1\u306b\u4f5c\u308b\uff0e\n\u6700\u4f4e\u9650\u3060\u3068\u305f\u3076\u3093\u4ee5\u4e0b\u306e5\u3064\u304c\u8a31\u53ef\u3055\u308c\u3066\u308c\u3070OK\uff0eDynamoDB\u3084S3\u7b49\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u306f\u9069\u5b9c\u8ffd\u52a0\u3057\u3066\u304a\u304f\uff0e\n\nlambda:createFunction\nlambda:updateFunctionCode\nlambda:updateFunctionConfiguration\nlambda:deleteFunction\niam:PassRole\n\n\n.travis.yml\u66f8\u304f\nYOUR_AWS_*\u3092\u81ea\u5206\u306e\u3084\u3064\u306b\u7f6e\u304d\u63db\u3048\u308b\u3060\u3051\uff0e\nlanguage: node_js\nnode_js:\n- \"4.3.2\"\n\ndeploy:\n  provider: lambda\n  function_name: YOUR_LAMBDA_FUNCTION_NAME\n  region: ap-northeast-1\n  module_name: index\n  handler_name: handler\n  runtime: nodejs4.3\n  role: YOUR_AWS_ROLE\n  access_key_id: YOUR_AWS_ACCESS_KEY_ID\n  secret_access_key: YOUR_AWS_SECRET_ACCESS_KEY\n\n\n\u6ce8\u610f\u70b9\n\n\nrequired\u306a\u306e\u306f\u4ee5\u4e0b3\u3064\n\n\n\nrole: IAM Role\n\nfunction_name: lambda function\u306e\u540d\u524d\n\nhandler_name: export\u3057\u3066\u308bhandler function\u306e\u540d\u524d\n\n\nTravis CI\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u898b\u3066index.handler\u3068\u304b\u66f8\u3044\u3061\u3083\u3046\u3068index.index.handler\u3068\u304b\u306b\u3055\u308c\u3066\u3064\u3089\u304f\u306a\u308b\nhttps://github.com/travis-ci/dpl/blob/v1.8.18/lib/dpl/provider/lambda.rb#L47-L52\n\n\n\n\n\naccess_key_id\u3084secret_access_key\u3082\u5b9f\u8cearequired\n\n\n\u30d9\u30bf\u66f8\u304d\u3059\u308b\u306e\u306f\u6d41\u77f3\u306b\u307e\u305a\u3044\u306e\u3067\uff0cTravis CLI\u306eencryption\u3092\u5229\u7528\u3057\u3066\u6697\u53f7\u5316\u3057\u3066\u304a\u304f\n\uff08role\u3063\u3066\u6697\u53f7\u5316\u3057\u305f\u307b\u3046\u304c\u3044\u3044\u306e\u304b\u306a\uff1f\uff09\n\n\n\nregion: \u30c7\u30d5\u30a9\u30eb\u30c8\u306fus-east-1\n\n\nmodule_name: \u30a8\u30f3\u30c8\u30ea\u30dd\u30a4\u30f3\u30c8\u306b\u306a\u308b.js\u30d5\u30a1\u30a4\u30eb\u306e\u540d\u524d\uff1f\n\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306findex\n\n\n\nruntime: \u30c7\u30d5\u30a9\u30eb\u30c8nodejs\u3060\u304c\uff0c\u3053\u308c\u306f0.10.12\u306b\u306a\u308b\n\n\nNode.js\u3067\u66f8\u304d\u305f\u3044\u306a\u3089nodejs4.3\u306b\u3059\u3079\u304d\nTravis CI\u306eNode.js\uff08node_js\uff09\u3082\u3042\u308f\u305b\u30664.3.2\u306b\u3057\u3068\u304f\u3068lint\u3084test\u304c\u6357\u308b\n\n\n\n\ntrigger\u8a2d\u5b9a\u3059\u308b\n\u96d1\u3067\u3044\u3044\u306a\u3089web console\u304b\u3089\u9069\u5f53\u306b\uff0eCloudWatch Events - Schedule\u3068\u304b\u4f7f\u3048\u3070cron\u3063\u307d\u3044\u30a2\u30ec\u3082\u30b7\u30e5\u30c3\u3068\u4f5c\u308c\u3061\u3083\u3046\uff0e\n\nReferences\n\nizumin5210/kusa-store\nAWS Lambda\u306e\u30c7\u30d7\u30ed\u30a4\u30d5\u30ed\u30fc\u7ba1\u7406 - Qiita\nLambda Deployment - Travis CI\nEncryption keys - Travis CI\ntravis-ci/dpl#lambda\n\n## TL;DR\n- \u3084\u308a\u304b\u305f\n  1. IAM\u3064\u304f\u308b\n  2.  `.travis.yaml`\u306e`deploy.provider`\u3092`lambda`\u306b\u3059\u308b\n  3. \u8a2d\u5b9a\u3092\u9069\u5f53\u306b\u66f8\u304f\n  4. push\u3059\u308b\n  5. \u4fbf\u5229\n        - \u304c\u3093\u3070\u3063\u3066zip\u3057\u3066upload\u3057\u3066\u2026\u307f\u305f\u3044\u306a\u306e\u304c\u306a\u3044\u304b\u3089\u4fbf\u5229\n        - Lambda\u3060\u3068cron\u7684\u306a\u5b9a\u671f\u51e6\u7406\u3082\u96d1\u306b\u6271\u3048\u308b\u3057\u5b89\u3044\u304b\u3089\u4fbf\u5229\n- \u3055\u3093\u3077\u308b: [izumin5210/kusa-store][kusa-store]\n    - GitHub\u306e\u30e6\u30fc\u30b6\u30da\u30fc\u30b8\u304b\u3089\u8349\u72b6\u6cc1\u3092\u62fe\u3063\u3066S3\u306b\u4fdd\u5b58\u3059\u308b\u3084\u3064\n\n\n## \u3084\u308a\u304b\u305f\n### IAM Role\u3064\u304f\u308b\n\u30de\u30b8\u30e1\u306b\u3084\u3089\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3084\u3064\u306a\u3089CloudFormation\u3068\u304b\u4f7f\u3063\u3066\u30a4\u30a4\u30ab\u30f3\u30b8\u306b\u3084\u308b\uff08\u300c[AWS Lambda\u306e\u30c7\u30d7\u30ed\u30a4\u30d5\u30ed\u30fc\u7ba1\u7406 - Qiita][qiita-lambda-deploy-flow]\u300d\u304c\u53c2\u8003\u306b\u306a\u308b\uff09\uff0e\n\u96d1\u3067\u3044\u3044\u306a\u3089AWS\u306eweb console\u304b\u3089\u96d1\u306b\u4f5c\u308b\uff0e\n\n\u6700\u4f4e\u9650\u3060\u3068\u305f\u3076\u3093\u4ee5\u4e0b\u306e5\u3064\u304c\u8a31\u53ef\u3055\u308c\u3066\u308c\u3070OK\uff0eDynamoDB\u3084S3\u7b49\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u306f\u9069\u5b9c\u8ffd\u52a0\u3057\u3066\u304a\u304f\uff0e\n\n- `lambda:createFunction`\n- `lambda:updateFunctionCode`\n- `lambda:updateFunctionConfiguration`\n- `lambda:deleteFunction`\n- `iam:PassRole`\n\n### `.travis.yml`\u66f8\u304f\n`YOUR_AWS_*`\u3092\u81ea\u5206\u306e\u3084\u3064\u306b\u7f6e\u304d\u63db\u3048\u308b\u3060\u3051\uff0e\n\n```yaml\nlanguage: node_js\nnode_js:\n- \"4.3.2\"\n\ndeploy:\n  provider: lambda\n  function_name: YOUR_LAMBDA_FUNCTION_NAME\n  region: ap-northeast-1\n  module_name: index\n  handler_name: handler\n  runtime: nodejs4.3\n  role: YOUR_AWS_ROLE\n  access_key_id: YOUR_AWS_ACCESS_KEY_ID\n  secret_access_key: YOUR_AWS_SECRET_ACCESS_KEY\n```\n\n#### \u6ce8\u610f\u70b9\n- **required**\u306a\u306e\u306f\u4ee5\u4e0b3\u3064\n    - `role`: IAM Role\n    - `function_name`: lambda function\u306e\u540d\u524d\n    - `handler_name`: export\u3057\u3066\u308bhandler function\u306e\u540d\u524d\n      - Travis CI\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u898b\u3066`index.handler`\u3068\u304b\u66f8\u3044\u3061\u3083\u3046\u3068`index.index.handler`\u3068\u304b\u306b\u3055\u308c\u3066\u3064\u3089\u304f\u306a\u308b\n      - https://github.com/travis-ci/dpl/blob/v1.8.18/lib/dpl/provider/lambda.rb#L47-L52\n- `access_key_id`\u3084`secret_access_key`\u3082\u5b9f\u8cearequired\n    - \u30d9\u30bf\u66f8\u304d\u3059\u308b\u306e\u306f\u6d41\u77f3\u306b\u307e\u305a\u3044\u306e\u3067\uff0c[Travis CLI\u306eencryption][travis-encryption]\u3092\u5229\u7528\u3057\u3066\u6697\u53f7\u5316\u3057\u3066\u304a\u304f\n    - \uff08role\u3063\u3066\u6697\u53f7\u5316\u3057\u305f\u307b\u3046\u304c\u3044\u3044\u306e\u304b\u306a\uff1f\uff09\n- `region`: [\u30c7\u30d5\u30a9\u30eb\u30c8\u306f`us-east-1`](https://github.com/travis-ci/dpl/blob/v1.8.18/lib/dpl/provider/lambda.rb#L17)\n- `module_name`: \u30a8\u30f3\u30c8\u30ea\u30dd\u30a4\u30f3\u30c8\u306b\u306a\u308b`.js`\u30d5\u30a1\u30a4\u30eb\u306e\u540d\u524d\uff1f\n    - [\u30c7\u30d5\u30a9\u30eb\u30c8\u306f`index`](https://github.com/travis-ci/dpl/blob/v1.8.18/lib/dpl/provider/lambda.rb#L130-L132)\n- `runtime`: [\u30c7\u30d5\u30a9\u30eb\u30c8`nodejs`](https://github.com/travis-ci/dpl/blob/v1.8.18/lib/dpl/provider/lambda.rb#L110-L112)\u3060\u304c\uff0c\u3053\u308c\u306f0.10.12\u306b\u306a\u308b\n    - Node.js\u3067\u66f8\u304d\u305f\u3044\u306a\u3089`nodejs4.3`\u306b\u3059\u3079\u304d\n    - Travis CI\u306eNode.js\uff08`node_js`\uff09\u3082\u3042\u308f\u305b\u3066`4.3.2`\u306b\u3057\u3068\u304f\u3068lint\u3084test\u304c\u6357\u308b\n\n### trigger\u8a2d\u5b9a\u3059\u308b\n\u96d1\u3067\u3044\u3044\u306a\u3089web console\u304b\u3089\u9069\u5f53\u306b\uff0e`CloudWatch Events - Schedule`\u3068\u304b\u4f7f\u3048\u3070cron\u3063\u307d\u3044\u30a2\u30ec\u3082\u30b7\u30e5\u30c3\u3068\u4f5c\u308c\u3061\u3083\u3046\uff0e\n\n\n## References\n- [izumin5210/kusa-store][kusa-store]\n- [AWS Lambda\u306e\u30c7\u30d7\u30ed\u30a4\u30d5\u30ed\u30fc\u7ba1\u7406 - Qiita][qiita-lambda-deploy-flow]\n- [Lambda Deployment - Travis CI][travis-deploy-lambda]\n- [Encryption keys - Travis CI][travis-encryption]\n- [travis-ci/dpl#lambda][dpl-lambda]\n\n[kusa-store]: https://github.com/izumin5210/kusa-store\n[qiita-lambda-deploy-flow]: http://qiita.com/kinzal/items/046a848a9f0829f87670\n[travis-deploy-lambda]: https://docs.travis-ci.com/user/deployment/lambda\n[travis-encryption]: https://docs.travis-ci.com/user/encryption-keys/\n[dpl-lambda]: https://github.com/travis-ci/dpl#lambda\n", "tags": ["lambda", "TravisCI", "AWS"]}