{"context": " More than 1 year has passed since last update.\u7814\u7a76\u5ba4\u3067\u306f\uff0c\u30b5\u30fc\u30d0\u76e3\u8996\u306bSensu\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\uff0e\n\u305d\u306eagent\u3067\u3042\u308bsensu-client\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u305f\u3081\u306b\uff0c\u69cb\u6210\u7ba1\u7406\u30c4\u30fc\u30eb\u306eAnsible\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\uff0e\n\u4eca\u56de\u306f\uff0cAnsible\u306e\u5b9f\u884c\u5bfe\u8c61\u3092\u8a18\u8ff0\u3057\u305fInventory\u304b\u3089Kibana\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u751f\u6210\u3057\u3066\u307f\u307e\u3059\uff0e\n\n\u7814\u7a76\u5ba4\u3067Ansible\u4f7f\u3063\u3066\u308b\u8a71 - Qiita\n\n\nKibana\n\u3053\u3053\u3067\u306f\uff0cKibana 3.1.2\u3092\u4f7f\u3044\u307e\u3059\uff0e\n(Kibana 4\u306fjson\u30d5\u30a1\u30a4\u30eb\u5f62\u5f0f\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u4f7f\u3048\u306a\u3044\u3088\u3046\u306a\u306e\u3067\uff0e)\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u306f/opt/kibana\u3067\uff0cconfig.json\u306edefault_route\u3092\u5909\u66f4\u3057\u307e\u3059\uff0e\n\u3053\u306edashborads.json\u306b\uff0csensu-client\u306e\u4e00\u89a7\u3092\u8868\u793a\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\uff0e\n\n/opt/kibana/config.json\n/** @scratch /configuration/config.js/5\n *\n * ==== default_route\n *\n * This is the default landing page when you don't specify a dashboard to load. You can specify\n * files, scripts or saved dashboards here. For example, if you had saved a dashboard called\n * `WebLogs' to elasticsearch you might use:\n *\n * default_route: '/dashboard/elasticsearch/WebLogs',\n */\ndefault_route     : '/dashboard/file/dashboards.json',\n\n\n\nAnsible Inventory\n\u5b9f\u969b\u306b\u4f7f\u3063\u3066\u3044\u308bInventory\u306e\u4e00\u90e8\u3092\u304a\u898b\u305b\u3057\u307e\u3059\uff0c\u30db\u30b9\u30c8\u540d\u306f\u6c17\u306b\u3057\u306a\u3044\u3067\u4e0b\u3055\u3044\uff0e\n[kibana]\u306b\u5bfe\u3057\u3066playbook\u3092\u5b9f\u884c\u3057\uff0c[sensu-client]\u306e\u5404\u30db\u30b9\u30c8\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u751f\u6210\u3057\u307e\u3059\uff0e\n[kibana]\n192.168.11.250\n\n[sensu-client]\nair          ansible_ssh_host=air.eng.kagawa-u.ac.jp\nrewrite      ansible_ssh_host=rewrite.eng.kagawa-u.ac.jp\nclannad      ansible_ssh_host=clannad.eng.kagawa-u.ac.jp\nplanetarian  ansible_ssh_host=planetarian.eng.kagawa-u.ac.jp\nkanon        ansible_ssh_host=planetarian.eng.kagawa-u.ac.jp\n\n\nAnsible Playbook\n\u3053\u3053\u3067\u306f\uff0c\u4f7f\u7528\u3057\u3066\u3044\u308bplaybook\u306e\u4e00\u90e8\u3092\u7d39\u4ecb\u3057\u307e\u3059\uff0e\n\u5168\u4f53\u306fGitHub\u306b\u3042\u308a\u307e\u3059\u306e\u3067\uff0c\u53c2\u7167\u3057\u3066\u4e0b\u3055\u3044\uff0e\n\nansible-playbooks/kibana at master \u00b7 hico-horiuchi/ansible-playbooks\n\nwith_items\u3092\u4f7f\u3063\u3066[sensu-client]\u306e\u5404\u30db\u30b9\u30c8\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u751f\u6210\u3057\u307e\u3059\uff0e\n\u4e00\u89a7\u3067\u3042\u308bdashboards.json\u3082\u751f\u6210\u3057\u307e\u3059\u304c\uff0c\u3053\u3061\u3089\u306f\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5185\u3067for\u3092\u7528\u3044\u3066\u3044\u307e\u3059\uff0e\n\nkibana.yml\n---\n- hosts: kibana\n  sudo: yes\n  gather_facts: no\n  tasks:\n\n    - name: create each server.json\n      template:\n        src=templates/server.json.j2\n        dest=/opt/kibana/app/dashboards/{{ item }}.json\n        owner=root\n        group=root\n        mode=0644\n      with_items: groups['sensu-client']\n\n   - name: create dashboards.json\n      template:\n        src=templates/dashboards.json.j2\n        dest=/opt/kibana/app/dashboards/dashboards.json\n        owner=root\n        group=root\n        mode=0644\n\n\nserver.json.j2\u3067\u306f\uff0c\u30db\u30b9\u30c8\u540d\u3067\u3042\u308b{{ item }}\u3092\u4f7f\u3044\u307e\u3059\uff0e\n\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306e\u30bf\u30a4\u30c8\u30eb\u3084\uff0cElasticsearch\u3078\u306e\u691c\u7d22\u30af\u30a8\u30ea\u306b\u5fc5\u8981\u3067\u3059\uff0e\n\nserver.json.j2\n{\n  \"title\": \"{{ item }}\",\n  \"services\": {\n    \"query\": {\n      \"list\": {\n        \"0\": {\n          \"id\": 0,\n          \"color\": \"#bc3539\",\n          \"alias\": \"\",\n          \"pin\": false,\n          \"type\": \"lucene\",\n          \"enable\": true,\n          \"query\": \"key:\\\"{{ item }}.cpu.usage\\\"\"\n        },\n...\n\n\ndashboards.json.j2\u3067\u306f\uff0cJinja2\u306efor\u3092\u7528\u3044\u307e\u3059\uff0e\n\u5404\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3078\u306e\u30ea\u30f3\u30af\u3068\uff0cIP\u30a2\u30c9\u30ec\u30b9\u306e\u30ea\u30b9\u30c8\u3092\u751f\u6210\u3057\u307e\u3059\uff0e\n\ndashboards.json.j2\n...\n\"rows\": [\n    {\n      \"title\": \"dashboards\",\n      \"height\": \"500px\",\n      \"editable\": false,\n      \"collapse\": false,\n      \"collapsable\": false,\n      \"panels\": [\n        {\n          \"error\": false,\n          \"span\": 4,\n          \"editable\": false,\n          \"type\": \"text\",\n          \"loadingEditor\": false,\n          \"mode\": \"markdown\",\n          \"content\": \"\n            {% for host in groups['sensu-client'] %}\n              - [{{ host }}](index.html#/dashboard/file/{{ host }}.json) ({{ hostvars[host]['ansible_ssh_host'] }})\\n\n            {% endfor %}\\n\",\n          \"style\": {},\n          \"title\": \"sensu metrics\"\n        }\n      ],\n      \"notice\": false\n    }\n  ],\n...\n\n\n\n\u7d50\u679c\nAnsible\u306eInventory\u304b\u3089\uff0csensu-client\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3068\uff0c\u305d\u306e\u4e00\u89a7\u3092\u751f\u6210\u3067\u304d\u307e\u3057\u305f\uff0e\n\u4ed6\u306b\u3082\uff0cRails\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u751f\u6210\u3057\u305f\u308a\uff0c\u4e00\u7dd2\u306b\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u306e\u8ee2\u9001\u3092\u3057\u305f\u308a\u3057\u3066\u3044\u307e\u3059\uff0e\nKibana 4\u3067\u3082\u540c\u69d8\u306e\u3053\u3068\u3092\u3084\u308a\u305f\u3044\u306e\u3067\uff0c\u30ce\u30a6\u30cf\u30a6\u3042\u308b\u65b9\u306f\u6559\u3048\u3066\u304f\u3060\u3055\u3044!\n\n\n\n\u7814\u7a76\u5ba4\u3067\u306f\uff0c\u30b5\u30fc\u30d0\u76e3\u8996\u306b[Sensu](http://sensuapp.org/)\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\uff0e\n\u305d\u306eagent\u3067\u3042\u308bsensu-client\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u305f\u3081\u306b\uff0c\u69cb\u6210\u7ba1\u7406\u30c4\u30fc\u30eb\u306e[Ansible](http://www.ansible.com/)\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\uff0e\n\u4eca\u56de\u306f\uff0cAnsible\u306e\u5b9f\u884c\u5bfe\u8c61\u3092\u8a18\u8ff0\u3057\u305f[Inventory](http://docs.ansible.com/intro_inventory.html)\u304b\u3089[Kibana](https://www.elastic.co/products/kibana)\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u751f\u6210\u3057\u3066\u307f\u307e\u3059\uff0e\n\n  - [\u7814\u7a76\u5ba4\u3067Ansible\u4f7f\u3063\u3066\u308b\u8a71 - Qiita](http://qiita.com/hiconyan/items/ddf5d3e34a18a2028566)\n\n## Kibana\n\n\u3053\u3053\u3067\u306f\uff0c[Kibana 3.1.2](https://www.elastic.co/downloads/past-releases/kibana-3-1-2)\u3092\u4f7f\u3044\u307e\u3059\uff0e\n(Kibana 4\u306fjson\u30d5\u30a1\u30a4\u30eb\u5f62\u5f0f\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u4f7f\u3048\u306a\u3044\u3088\u3046\u306a\u306e\u3067\uff0e)\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u306f`/opt/kibana`\u3067\uff0c`config.json`\u306e`default_route`\u3092\u5909\u66f4\u3057\u307e\u3059\uff0e\n\u3053\u306e`dashborads.json`\u306b\uff0csensu-client\u306e\u4e00\u89a7\u3092\u8868\u793a\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\uff0e\n\n```javascript:/opt/kibana/config.json\n/** @scratch /configuration/config.js/5\n *\n * ==== default_route\n *\n * This is the default landing page when you don't specify a dashboard to load. You can specify\n * files, scripts or saved dashboards here. For example, if you had saved a dashboard called\n * `WebLogs' to elasticsearch you might use:\n *\n * default_route: '/dashboard/elasticsearch/WebLogs',\n */\ndefault_route     : '/dashboard/file/dashboards.json',\n```\n\n## Ansible Inventory\n\n\u5b9f\u969b\u306b\u4f7f\u3063\u3066\u3044\u308bInventory\u306e\u4e00\u90e8\u3092\u304a\u898b\u305b\u3057\u307e\u3059\uff0c\u30db\u30b9\u30c8\u540d\u306f\u6c17\u306b\u3057\u306a\u3044\u3067\u4e0b\u3055\u3044\uff0e\n`[kibana]`\u306b\u5bfe\u3057\u3066playbook\u3092\u5b9f\u884c\u3057\uff0c`[sensu-client]`\u306e\u5404\u30db\u30b9\u30c8\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u751f\u6210\u3057\u307e\u3059\uff0e\n\n```hosts\n[kibana]\n192.168.11.250\n\n[sensu-client]\nair          ansible_ssh_host=air.eng.kagawa-u.ac.jp\nrewrite      ansible_ssh_host=rewrite.eng.kagawa-u.ac.jp\nclannad      ansible_ssh_host=clannad.eng.kagawa-u.ac.jp\nplanetarian  ansible_ssh_host=planetarian.eng.kagawa-u.ac.jp\nkanon        ansible_ssh_host=planetarian.eng.kagawa-u.ac.jp\n```\n\n## Ansible Playbook\n\n\u3053\u3053\u3067\u306f\uff0c\u4f7f\u7528\u3057\u3066\u3044\u308bplaybook\u306e\u4e00\u90e8\u3092\u7d39\u4ecb\u3057\u307e\u3059\uff0e\n\u5168\u4f53\u306fGitHub\u306b\u3042\u308a\u307e\u3059\u306e\u3067\uff0c\u53c2\u7167\u3057\u3066\u4e0b\u3055\u3044\uff0e\n\n  - [ansible-playbooks/kibana at master \u00b7 hico-horiuchi/ansible-playbooks](https://github.com/hico-horiuchi/ansible-playbooks/tree/master/kibana)\n\n`with_items`\u3092\u4f7f\u3063\u3066`[sensu-client]`\u306e\u5404\u30db\u30b9\u30c8\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u751f\u6210\u3057\u307e\u3059\uff0e\n\u4e00\u89a7\u3067\u3042\u308b`dashboards.json`\u3082\u751f\u6210\u3057\u307e\u3059\u304c\uff0c\u3053\u3061\u3089\u306f\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5185\u3067`for`\u3092\u7528\u3044\u3066\u3044\u307e\u3059\uff0e\n\n```yml:kibana.yml\n---\n- hosts: kibana\n  sudo: yes\n  gather_facts: no\n  tasks:\n\n    - name: create each server.json\n      template:\n        src=templates/server.json.j2\n        dest=/opt/kibana/app/dashboards/{{ item }}.json\n        owner=root\n        group=root\n        mode=0644\n      with_items: groups['sensu-client']\n\n   - name: create dashboards.json\n      template:\n        src=templates/dashboards.json.j2\n        dest=/opt/kibana/app/dashboards/dashboards.json\n        owner=root\n        group=root\n        mode=0644\n```\n\n`server.json.j2`\u3067\u306f\uff0c\u30db\u30b9\u30c8\u540d\u3067\u3042\u308b`{{ item }}`\u3092\u4f7f\u3044\u307e\u3059\uff0e\n\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306e\u30bf\u30a4\u30c8\u30eb\u3084\uff0c[Elasticsearch](https://www.elastic.co/products/elasticsearch)\u3078\u306e\u691c\u7d22\u30af\u30a8\u30ea\u306b\u5fc5\u8981\u3067\u3059\uff0e\n\n```javascript+jinja:server.json.j2\n{\n  \"title\": \"{{ item }}\",\n  \"services\": {\n    \"query\": {\n      \"list\": {\n        \"0\": {\n          \"id\": 0,\n          \"color\": \"#bc3539\",\n          \"alias\": \"\",\n          \"pin\": false,\n          \"type\": \"lucene\",\n          \"enable\": true,\n          \"query\": \"key:\\\"{{ item }}.cpu.usage\\\"\"\n        },\n...\n```\n\n`dashboards.json.j2`\u3067\u306f\uff0c[Jinja2](http://jinja.pocoo.org)\u306e[for](http://jinja.pocoo.org/docs/dev/templates/)\u3092\u7528\u3044\u307e\u3059\uff0e\n\u5404\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3078\u306e\u30ea\u30f3\u30af\u3068\uff0cIP\u30a2\u30c9\u30ec\u30b9\u306e\u30ea\u30b9\u30c8\u3092\u751f\u6210\u3057\u307e\u3059\uff0e\n\n```javascript+jinja:dashboards.json.j2\n...\n\"rows\": [\n    {\n      \"title\": \"dashboards\",\n      \"height\": \"500px\",\n      \"editable\": false,\n      \"collapse\": false,\n      \"collapsable\": false,\n      \"panels\": [\n        {\n          \"error\": false,\n          \"span\": 4,\n          \"editable\": false,\n          \"type\": \"text\",\n          \"loadingEditor\": false,\n          \"mode\": \"markdown\",\n          \"content\": \"\n            {% for host in groups['sensu-client'] %}\n              - [{{ host }}](index.html#/dashboard/file/{{ host }}.json) ({{ hostvars[host]['ansible_ssh_host'] }})\\n\n            {% endfor %}\\n\",\n          \"style\": {},\n          \"title\": \"sensu metrics\"\n        }\n      ],\n      \"notice\": false\n    }\n  ],\n...\n```\n\n## \u7d50\u679c\n\nAnsible\u306eInventory\u304b\u3089\uff0csensu-client\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3068\uff0c\u305d\u306e\u4e00\u89a7\u3092\u751f\u6210\u3067\u304d\u307e\u3057\u305f\uff0e\n\u4ed6\u306b\u3082\uff0cRails\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u751f\u6210\u3057\u305f\u308a\uff0c\u4e00\u7dd2\u306b\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u306e\u8ee2\u9001\u3092\u3057\u305f\u308a\u3057\u3066\u3044\u307e\u3059\uff0e\nKibana 4\u3067\u3082\u540c\u69d8\u306e\u3053\u3068\u3092\u3084\u308a\u305f\u3044\u306e\u3067\uff0c\u30ce\u30a6\u30cf\u30a6\u3042\u308b\u65b9\u306f\u6559\u3048\u3066\u304f\u3060\u3055\u3044!\n\n![dashboards.png](https://qiita-image-store.s3.amazonaws.com/0/58742/88bb4fa3-74c5-fd86-d80c-36ef658c56bb.png \"dashboards.png\")\n\n![server.png](https://qiita-image-store.s3.amazonaws.com/0/58742/c7987312-2386-4604-d292-613b93edb997.png \"server.png\")\n", "tags": ["Ansible1.7.2", "kibana3.1.2"]}