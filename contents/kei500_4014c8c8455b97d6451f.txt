{"context": "\n\n\u6982\u8981\nWeb \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u666e\u901a\u306b\u52d5\u304b\u3057\u3064\u3064\uff0c\u88cf\u3067 batch \u51e6\u7406\u3092\u304c\u3093\u304c\u3093\u52d5\u304b\u3059\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092 rails \u3067\u66f8\u3044\u305f\u3002\u3053\u3046\u3044\u3046\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u3053\u3068\u3092\u5404 batch \u304c\u5099\u3048\u3066\u3044\u308b\u3068\u975e\u5e38\u306b\u6357\u308b\u3002\n\ndryrun \u30e2\u30fc\u30c9\nlog \u306f batch \u3054\u3068\u306b\u5225\u306a\u30d5\u30a1\u30a4\u30eb\u306b\u5410\u304b\u305b\u308b\n\n\u5177\u4f53\u7684\u306b\u306f\u4ee5\u4e0b\u3002\n# dryrun\n# log \u306f\u30d5\u30a1\u30a4\u30eb\u3067\u306a\u304f\u6a19\u6e96\u51fa\u529b\u306b\u3002debug log \u3082\u5410\u304f\u3002\n$ bundle exec rails runner 'BatchExample.dryrun'\n\n# exec\n# log \u306f\u3053\u306e\u30d0\u30c3\u30c1\u5c02\u7528\u306e\u30d5\u30a1\u30a4\u30eb (=log/batch/batch_example.log) \u306b\u3002debug log \u306f\u5410\u304b\u306a\u3044\u3002\n$ bundle exec rails runner 'BatchExample.exec'\n\n\u3053\u308c\u3092\u3069\u306e\u3088\u3046\u306b\u5b9f\u73fe\u3057\u305f\u304b\u3092\u5099\u5fd8\u9332\u7684\u306b\u6b8b\u3057\u3066\u304a\u304f\u3002\n\n\u5b9f\u73fe\u65b9\u6cd5\n\u307e\u305a batch \u306e\u57fa\u5e95\u30af\u30e9\u30b9\u3092\u4f5c\u308b\u3002\n\nlib/batch/base.rb\nrequire 'logger'\n\nclass Batch::Base\n  @@is_dryrun = false\n\n  class << self\n    def logger\n      @@logger ||= Logger.new(\n        dryrun? ? STDOUT : File.join(Rails.root, 'log', \"#{self.to_s.underscore}.log\")\n      )\n    end\n\n    def dryrun(*args)\n      @@is_dryrun = true\n      logger.level = Logger::DEBUG\n      exec(*args)\n    end\n\n    def dryrun?\n      @@is_dryrun\n    end\n  end\nend\n\n\n\u3042\u3068\u306f\u3053\u306e\u57fa\u5e95\u30af\u30e9\u30b9\u3092\u7d99\u627f\u3055\u305b\u3066 batch \u3092\u66f8\u304f\u3002\n\nlib/batch/batch_example.rb\nclass Batch::BatchExample < Batch::Base\n  def self.exec\n    logger.info('start.')\n    logger.debug('show only in dryrun mode.')\n    unless dryrun?\n      # some processes\n    end\n    logger.info('finish.')\n  end\nend\n\n\n\u3053\u308c\u3060\u3051\u3002\nlog \u306f log/batch/batch_exmaple.log \u306b\u5410\u304b\u308c\u308b\u3002\n\n\u88dc\u8db3\u4e8b\u9805\nlog \u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea (log/batch) \u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u3066 git keep \u3059\u308b (.gitignore \u306e\u66f8\u304d\u65b9\u304c\u56de\u308a\u304f\u3069\u3044...)\u3002\n\n.gitingore\n/log/*\n!/log/.keep\n!/log/batch/\n/log/batch/*\n!/log/batch/.keep\n\n\n# \u6982\u8981\nWeb \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u666e\u901a\u306b\u52d5\u304b\u3057\u3064\u3064\uff0c\u88cf\u3067 batch \u51e6\u7406\u3092\u304c\u3093\u304c\u3093\u52d5\u304b\u3059\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092 rails \u3067\u66f8\u3044\u305f\u3002\u3053\u3046\u3044\u3046\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u3053\u3068\u3092\u5404 batch \u304c\u5099\u3048\u3066\u3044\u308b\u3068\u975e\u5e38\u306b\u6357\u308b\u3002\n\n- dryrun \u30e2\u30fc\u30c9\n- log \u306f batch \u3054\u3068\u306b\u5225\u306a\u30d5\u30a1\u30a4\u30eb\u306b\u5410\u304b\u305b\u308b\n\n\u5177\u4f53\u7684\u306b\u306f\u4ee5\u4e0b\u3002\n\n```bash\n# dryrun\n# log \u306f\u30d5\u30a1\u30a4\u30eb\u3067\u306a\u304f\u6a19\u6e96\u51fa\u529b\u306b\u3002debug log \u3082\u5410\u304f\u3002\n$ bundle exec rails runner 'BatchExample.dryrun'\n\n# exec\n# log \u306f\u3053\u306e\u30d0\u30c3\u30c1\u5c02\u7528\u306e\u30d5\u30a1\u30a4\u30eb (=log/batch/batch_example.log) \u306b\u3002debug log \u306f\u5410\u304b\u306a\u3044\u3002\n$ bundle exec rails runner 'BatchExample.exec'\n```\n\n\u3053\u308c\u3092\u3069\u306e\u3088\u3046\u306b\u5b9f\u73fe\u3057\u305f\u304b\u3092\u5099\u5fd8\u9332\u7684\u306b\u6b8b\u3057\u3066\u304a\u304f\u3002\n\n# \u5b9f\u73fe\u65b9\u6cd5\n\n\u307e\u305a batch \u306e\u57fa\u5e95\u30af\u30e9\u30b9\u3092\u4f5c\u308b\u3002\n\n```ruby:lib/batch/base.rb\nrequire 'logger'\n\nclass Batch::Base\n  @@is_dryrun = false\n\n  class << self\n    def logger\n      @@logger ||= Logger.new(\n        dryrun? ? STDOUT : File.join(Rails.root, 'log', \"#{self.to_s.underscore}.log\")\n      )\n    end\n\n    def dryrun(*args)\n      @@is_dryrun = true\n      logger.level = Logger::DEBUG\n      exec(*args)\n    end\n\n    def dryrun?\n      @@is_dryrun\n    end\n  end\nend\n```\n\n\u3042\u3068\u306f\u3053\u306e\u57fa\u5e95\u30af\u30e9\u30b9\u3092\u7d99\u627f\u3055\u305b\u3066 batch \u3092\u66f8\u304f\u3002\n\n```ruby:lib/batch/batch_example.rb\nclass Batch::BatchExample < Batch::Base\n  def self.exec\n    logger.info('start.')\n    logger.debug('show only in dryrun mode.')\n    unless dryrun?\n      # some processes\n    end\n    logger.info('finish.')\n  end\nend\n```\n\n\u3053\u308c\u3060\u3051\u3002\nlog \u306f `log/batch/batch_exmaple.log` \u306b\u5410\u304b\u308c\u308b\u3002\n\n# \u88dc\u8db3\u4e8b\u9805\nlog \u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea (`log/batch`) \u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u3066 git keep \u3059\u308b (`.gitignore` \u306e\u66f8\u304d\u65b9\u304c\u56de\u308a\u304f\u3069\u3044...)\u3002\n\n```:.gitingore\n/log/*\n!/log/.keep\n!/log/batch/\n/log/batch/*\n!/log/batch/.keep\n```\n", "tags": ["Ruby", "Rails", "batch"]}