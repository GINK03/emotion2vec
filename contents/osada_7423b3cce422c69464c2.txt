{"context": "\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30b7\u30df\u30e5\u30ec\u30fc\u30bfns-2\u306e\u8a71\u3067\u3059\u3002\n\u30d1\u30b1\u30c3\u30c8\u30c8\u30ec\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u306b\u3001TCP\u306e\u30d8\u30c3\u30c0\u60c5\u5831\uff08\u30b7\u30fc\u30b1\u30f3\u30b9\u756a\u53f7\u3084ACK\u756a\u53f7\u306a\u3069\uff09\u304c\u8a18\u8f09\u3055\u308c\u308b\u3068\u4fbf\u5229\u3002\n\n\u8868\u793a\u65b9\u6cd5\n\u305d\u3046\u3044\u3046\u3068\u304d\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30b7\u30ca\u30ea\u30aa\u30d5\u30a1\u30a4\u30eb\u306b\u4ee5\u4e0b\u306e1\u884c\u3092\u8ffd\u52a0\u3059\u308c\u3070OK\n\n\u30b7\u30ca\u30ea\u30aa\u30d5\u30a1\u30a4\u30eb\n# \u2193\u30dd\u30a4\u30f3\u30c8\nTrace set show_tcphdr_ 1; # trace-all shows tcp headers(default: 0)\n\nset nf [open out.ns w]\n$ns trace-all $nf\n\nproc finish {} {\n    global ns\n    $ns flush-trace\n    close $nf\n    exit 0\n}\n\n\n\n\u5909\u66f4\u524d\u51fa\u529b\nr 1.000089 0 1 tcp 40 ------- 0 2.1 1.256 0 2\nr 1.000166 0 1 tcp 40 ------- 0 2.1 1.256 1 4\nr 1.00019 0 1 tcp 1500 ------- 0 2.1 1.256 1 5\nr 1.000202 0 1 tcp 1500 ------- 0 2.1 1.256 1461 6\nr 1.00029 0 1 tcp 1500 ------- 0 2.1 1.256 2921 9\nr 1.000314 0 1 tcp 1500 ------- 0 2.1 1.256 4381 10\nr 1.000326 0 1 tcp 1500 ------- 0 2.1 1.256 5841 12\n\n\n\u5909\u66f4\u5f8c\u51fa\u529b\nosada@share1% grep 'r.*0\\ 1\\ tcp' out.ns\nr 1.000089 0 1 tcp 40 ------- 0 2.1 1.256 0 2 -1 0xa 40 0\nr 1.000166 0 1 tcp 40 ------- 0 2.1 1.256 1 4 1 0x10 40 0\nr 1.00019 0 1 tcp 1500 ------- 0 2.1 1.256 1 5 1 0x10 40 0\nr 1.000202 0 1 tcp 1500 ------- 0 2.1 1.256 1461 6 1 0x10 40 0\nr 1.00029 0 1 tcp 1500 ------- 0 2.1 1.256 2921 9 1 0x10 40 0\nr 1.000314 0 1 tcp 1500 ------- 0 2.1 1.256 4381 10 1 0x10 40 0\nr 1.000326 0 1 tcp 1500 ------- 0 2.1 1.256 5841 12 1 0x10 40 0\n\n\u30b7\u30fc\u30b1\u30f3\u30b9\u756a\u53f7\u3060\u3051\u3067\u306a\u304f\u3001\u78ba\u8a8d\u5fdc\u7b54\u756a\u53f7\u304c\u898b\u3048\u3066\u3001\u3042\u308a\u304c\u305f\u3044\u3002\n\n\u8aad\u307f\u65b9\n'-----'\uff08\u30d5\u30e9\u30b0\uff09\u306e\u3042\u3068\u304b\u3089\u9806\u756a\u306b\u3001\n* \u30d5\u30ed\u30fc\u756a\u53f7\uff1aiph->flowid()\n* \u9001\u4fe1\u5143\u30ce\u30fc\u30c9\u756a\u53f7.\u30dd\u30fc\u30c8\u756a\u53f7\uff1asrc_nodeaddr.src_portaddr\n* \u9001\u4fe1\u5148\u30ce\u30fc\u30c9\u756a\u53f7.\u30dd\u30fc\u30c8\u756a\u53f7\uff1adst_nodeaddr.dst_portaddr\n* \u30b7\u30fc\u30b1\u30f3\u30b9\u756a\u53f7\uff1aseqno\n* UID\uff1ath->uid()\n* ACK\u756a\u53f7\uff1atcph->ackno()\n* \u30d5\u30e9\u30b0\u60c5\u5831\uff1atcph->flags()\n* \u30d8\u30c3\u30c0\u9577\uff1atcph->hlen()\n* SA\uff08SelectiveACK?\uff09\u9577\uff1atcph->sa_length()\n\u30d5\u30e9\u30b0\u306f\u4ee5\u4e0b\u3002OR\u6f14\u7b97\u3057\u305f\u7d50\u679c\u304c\u5165\u3063\u3066\u3044\u308b\u3002\u4f8b\u3048\u3070\"0xa = TH_SYN | TH_PUSH\"\n#define TH_FIN  0x01        /* FIN: closing a connection */\n#define TH_SYN  0x02        /* SYN: starting a connection */\n#define TH_PUSH 0x08        /* PUSH: used here to \"deliver\" data */\n#define TH_ACK  0x10        /* ACK: ack number is valid */\n#define TH_ECE  0x40        /* ECE: CE echo flag */\n#define TH_CWR  0x80        /* CWR: congestion window reduced */\n\n\n\u5b9f\u884c\u74b0\u5883\n\nns-2.35\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5: http://qiita.com/osada/items/133afdbba68c388ab818\n\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30b7\u30df\u30e5\u30ec\u30fc\u30bfns-2\u306e\u8a71\u3067\u3059\u3002\n\n\u30d1\u30b1\u30c3\u30c8\u30c8\u30ec\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u306b\u3001TCP\u306e\u30d8\u30c3\u30c0\u60c5\u5831\uff08\u30b7\u30fc\u30b1\u30f3\u30b9\u756a\u53f7\u3084ACK\u756a\u53f7\u306a\u3069\uff09\u304c\u8a18\u8f09\u3055\u308c\u308b\u3068\u4fbf\u5229\u3002\n\n# \u8868\u793a\u65b9\u6cd5\n\n\u305d\u3046\u3044\u3046\u3068\u304d\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30b7\u30ca\u30ea\u30aa\u30d5\u30a1\u30a4\u30eb\u306b\u4ee5\u4e0b\u306e1\u884c\u3092\u8ffd\u52a0\u3059\u308c\u3070OK\n\n```tcl:\u30b7\u30ca\u30ea\u30aa\u30d5\u30a1\u30a4\u30eb\n# \u2193\u30dd\u30a4\u30f3\u30c8\nTrace set show_tcphdr_ 1; # trace-all shows tcp headers(default: 0)\n\nset nf [open out.ns w]\n$ns trace-all $nf\n\nproc finish {} {\n    global ns\n    $ns flush-trace\n    close $nf\n    exit 0\n}\n```\n\n# \u5909\u66f4\u524d\u51fa\u529b\n\n```\nr 1.000089 0 1 tcp 40 ------- 0 2.1 1.256 0 2\nr 1.000166 0 1 tcp 40 ------- 0 2.1 1.256 1 4\nr 1.00019 0 1 tcp 1500 ------- 0 2.1 1.256 1 5\nr 1.000202 0 1 tcp 1500 ------- 0 2.1 1.256 1461 6\nr 1.00029 0 1 tcp 1500 ------- 0 2.1 1.256 2921 9\nr 1.000314 0 1 tcp 1500 ------- 0 2.1 1.256 4381 10\nr 1.000326 0 1 tcp 1500 ------- 0 2.1 1.256 5841 12\n```\n\n# \u5909\u66f4\u5f8c\u51fa\u529b\n\n```\nosada@share1% grep 'r.*0\\ 1\\ tcp' out.ns\nr 1.000089 0 1 tcp 40 ------- 0 2.1 1.256 0 2 -1 0xa 40 0\nr 1.000166 0 1 tcp 40 ------- 0 2.1 1.256 1 4 1 0x10 40 0\nr 1.00019 0 1 tcp 1500 ------- 0 2.1 1.256 1 5 1 0x10 40 0\nr 1.000202 0 1 tcp 1500 ------- 0 2.1 1.256 1461 6 1 0x10 40 0\nr 1.00029 0 1 tcp 1500 ------- 0 2.1 1.256 2921 9 1 0x10 40 0\nr 1.000314 0 1 tcp 1500 ------- 0 2.1 1.256 4381 10 1 0x10 40 0\nr 1.000326 0 1 tcp 1500 ------- 0 2.1 1.256 5841 12 1 0x10 40 0\n```\n\n\u30b7\u30fc\u30b1\u30f3\u30b9\u756a\u53f7\u3060\u3051\u3067\u306a\u304f\u3001\u78ba\u8a8d\u5fdc\u7b54\u756a\u53f7\u304c\u898b\u3048\u3066\u3001\u3042\u308a\u304c\u305f\u3044\u3002\n\n# \u8aad\u307f\u65b9\n\n'-----'\uff08\u30d5\u30e9\u30b0\uff09\u306e\u3042\u3068\u304b\u3089\u9806\u756a\u306b\u3001\n* \u30d5\u30ed\u30fc\u756a\u53f7\uff1aiph->flowid()\n* \u9001\u4fe1\u5143\u30ce\u30fc\u30c9\u756a\u53f7.\u30dd\u30fc\u30c8\u756a\u53f7\uff1asrc_nodeaddr.src_portaddr\n* \u9001\u4fe1\u5148\u30ce\u30fc\u30c9\u756a\u53f7.\u30dd\u30fc\u30c8\u756a\u53f7\uff1adst_nodeaddr.dst_portaddr\n* \u30b7\u30fc\u30b1\u30f3\u30b9\u756a\u53f7\uff1aseqno\n* UID\uff1ath->uid()\n* ACK\u756a\u53f7\uff1atcph->ackno()\n* \u30d5\u30e9\u30b0\u60c5\u5831\uff1atcph->flags()\n* \u30d8\u30c3\u30c0\u9577\uff1atcph->hlen()\n* SA\uff08SelectiveACK?\uff09\u9577\uff1atcph->sa_length()\n\n\u30d5\u30e9\u30b0\u306f\u4ee5\u4e0b\u3002OR\u6f14\u7b97\u3057\u305f\u7d50\u679c\u304c\u5165\u3063\u3066\u3044\u308b\u3002\u4f8b\u3048\u3070\"0xa = TH_SYN | TH_PUSH\"\n\n```\n#define TH_FIN  0x01        /* FIN: closing a connection */\n#define TH_SYN  0x02        /* SYN: starting a connection */\n#define TH_PUSH 0x08        /* PUSH: used here to \"deliver\" data */\n#define TH_ACK  0x10        /* ACK: ack number is valid */\n#define TH_ECE  0x40        /* ECE: CE echo flag */\n#define TH_CWR  0x80        /* CWR: congestion window reduced */\n```\n\n# \u5b9f\u884c\u74b0\u5883\n\n* ns-2.35\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5: http://qiita.com/osada/items/133afdbba68c388ab818\n", "tags": ["ns-2", "TCP", "C++", "Tcl"]}