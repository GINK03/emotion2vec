{"tags": ["Terraform", "\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9", "\u3055\u304f\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8", "Hashicorp"], "context": "2016/5/24\u8ffd\u8a18\nTerraform for \u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u306b\u4f34\u3044\u3001\nresource\u9805\u76ee\u306a\u3069\u304c\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u3068\u7570\u306a\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n\u6700\u65b0\u306e\u60c5\u5831\u306fGitHub\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u95a2\u9023\u8a18\u4e8b\nTerraform for \u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9 \u30b9\u30bf\u30fc\u30c8\u30ac\u30a4\u30c9\n\n\u81ea\u5206\u7528\u30e1\u30e2\u3002\nTerraform for \u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u3067\u8907\u6570\u30be\u30fc\u30f3\u9593(\u77f3\u72e9/\u6771\u4eac\u306a\u3069)\u3067\u306e\n\u30d6\u30ea\u30c3\u30b8\u63a5\u7d9a\u3092\u304a\u3053\u306a\u3046\u307e\u3067\u3002\n\n\u4f5c\u6210\u3055\u308c\u308b\u30af\u30e9\u30a6\u30c9\u4e0a\u306e\u30ea\u30bd\u30fc\u30b9\n\n\u30b5\u30fc\u30d0\u30fc2\u53f0(\u77f3\u72e9\u7b2c\uff11\u30fb\u7b2c\uff12\uff09\n\u30c7\u30a3\u30b9\u30af\uff12\u672c(\u5404\u30b5\u30fc\u30d0\u30fc\u306b1\u672c\u305a\u3064)\n\u30b9\u30a4\u30c3\u30c12\u53f0(\u77f3\u72e9\u7b2c\uff11\u30fb\u7b2c\uff12\u3001\u30d6\u30ea\u30c3\u30b8\u3068\u306e\u63a5\u7d9a\u7528\uff09\n\u30d6\u30ea\u30c3\u30b81\u53f0\n\n\u30b5\u30fc\u30d0\u3078\u306eSSH\u63a5\u7d9a\u306f\u516c\u958b\u9375\u8a8d\u8a3c\u306e\u307f\u3068\u3059\u308b\u3002\n\n\u524d\u6e96\u5099\n\n\nterraform\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nterraform for \u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nssh-keygen \u306a\u3069\u3067SSH\u7528\u306b\u30ad\u30fc\u30da\u30a2\u4f5c\u6210(id_rsa\u3068id_rsa.pub)\n\u4ee5\u4e0b2\u3064\u306e\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u3066\u304a\u304f\u3002\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u7528\n\n\nprovision_sv01.sh\n#!/bin/sh\n\n# eth1\u306eIP\u8a2d\u5b9a\ncat << EOS >> /etc/sysconfig/network-scripts/ifcfg-eth1\nBOOTPROTO=static\nPREFIX0=24\nDEVICE=eth1\nIPADDR0=192.168.1.1\nONBOOT=yes\nEOS\n\n#\u53cd\u6620\nifdown eth1; ifup eth1\n\n\n\nprovision_sv02.sh\n#!/bin/sh\n\n# eth1\u306eIP\u8a2d\u5b9a\ncat << EOS >> /etc/sysconfig/network-scripts/ifcfg-eth1\nBOOTPROTO=static\nPREFIX0=24\nDEVICE=eth1\nIPADDR0=192.168.1.2\nONBOOT=yes\nEOS\n\n#\u53cd\u6620\nifdown eth1; ifup eth1\n\n\n\n\u4ee5\u4e0b\u74b0\u5883\u5909\u6570\u306bAPI\u30ad\u30fc\u60c5\u5831\u3092\u8a2d\u5b9a\u3057\u3066\u304a\u304f\n\n\n\nSAKURACLOUD_ACCESS_TOKEN \uff1a\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\n\nSAKURACLOUD_ACCESS_TOKEN_SECRET \uff1a\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\n\n\n\n\n\nterraform\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb(tf\u30d5\u30a1\u30a4\u30eb)\n\nsakura.tf\nprovider \"sakuracloud\" {}\n\n##################################################\n#  \u30b5\u30fc\u30d0\u30fc1(\u77f3\u72e9\u7b2c1)\n##################################################\nresource \"sakuracloud_server\" \"is1a_sv01\" {\n    name = \"sv01\"\n    disks = [\"${sakuracloud_disk.disk01.id}\"]\n    tags = [\"@virtio-net-pci\"]\n    switched_interfaces = [ \"${sakuracloud_switch.sw01.id}\" ]\n\n    connection {\n       user = \"root\"\n       host = \"${sakuracloud_server.is1a_sv01.shared_nw_ipaddress}\"\n       private_key = \"${file(\"./id_rsa\")}\"\n    }\n\n    provisioner \"file\" {\n        source = \"provision_sv01.sh\"\n        destination = \"/tmp/script.sh\"\n    }\n\n    provisioner \"remote-exec\" {\n        inline = [\n          \"chmod +x /tmp/script.sh\",\n          \"/tmp/script.sh\"\n        ] \n   }\n   zone = \"is1a\"\n}\n##################################################\n#  \u30b5\u30fc\u30d0\u30fc2(\u77f3\u72e9\u7b2c2)\n##################################################\nresource \"sakuracloud_server\" \"is1b_sv02\" {\n    name = \"sv02\"\n    disks = [\"${sakuracloud_disk.disk02.id}\"]\n    tags = [\"@virtio-net-pci\"]\n    switched_interfaces = [ \"${sakuracloud_switch.sw02.id}\" ]\n    connection {\n       user = \"root\"\n       host = \"${sakuracloud_server.is1b_sv02.shared_nw_ipaddress}\"\n       private_key = \"${file(\"./id_rsa\")}\"\n    }\n    provisioner \"file\" {\n        source = \"provision_sv02.sh\"\n        destination = \"/tmp/script.sh\"\n    }\n\n    provisioner \"remote-exec\" {\n        inline = [\n          \"chmod +x /tmp/script.sh\",\n          \"/tmp/script.sh\"\n        ] \n   }\n   zone = \"is1b\"\n}\n\n##################################################\n#  \u30b5\u30fc\u30d0\u30fc1\u7528\u30c7\u30a3\u30b9\u30af(\u77f3\u72e9\u7b2c1)\n##################################################\nresource \"sakuracloud_disk\" \"disk01\" {\n    name = \"disk01\"\n    source_archive_name = \"CentOS 7.2 64bit\"\n    ssh_key_ids = [\"${sakuracloud_ssh_key.mykey.id}\"]\n    disable_pw_auth = true\n    zone = \"is1a\"\n}\n##################################################\n#  \u30b5\u30fc\u30d0\u30fc2\u7528\u30c7\u30a3\u30b9\u30af(\u77f3\u72e9\u7b2c1)\n##################################################\nresource \"sakuracloud_disk\" \"disk02\" {\n    name = \"disk02\"\n    source_archive_name = \"CentOS 7.2 64bit\"\n    ssh_key_ids = [\"${sakuracloud_ssh_key.mykey.id}\"]\n    disable_pw_auth = true\n    zone = \"is1b\"\n}\n\n##################################################\n#  \u30b9\u30a4\u30c3\u30c1(\u77f3\u72e9\u7b2c1)\uff1a\u30d6\u30ea\u30c3\u30b8\u306b\u63a5\u7d9a\n##################################################\nresource \"sakuracloud_switch\" \"sw01\"{\n    name = \"sw01\"\n    zone = \"is1a\"\n    bridge_id = \"${sakuracloud_bridge.br.id}\"\n}\n##################################################\n#  \u30b9\u30a4\u30c3\u30c1(\u77f3\u72e9\u7b2c2)\uff1a\u30d6\u30ea\u30c3\u30b8\u306b\u63a5\u7d9a\n##################################################\nresource \"sakuracloud_switch\" \"sw02\"{\n    name = \"sw02\"\n    zone = \"is1b\"\n    bridge_id = \"${sakuracloud_bridge.br.id}\"\n}\n\n##################################################\n#  \u30d6\u30ea\u30c3\u30b8(\u30be\u30fc\u30f3\u9593\u306e\u63a5\u7d9a)\n##################################################\nresource \"sakuracloud_bridge\" \"br\"{\n    name = \"br01\"\n    zone = \"is1a\"\n}\n\n/************************\n SSHKey\n************************/\nresource \"sakuracloud_ssh_key\" \"mykey\" {\n    name = \"key\"\n    public_key = \"${file(\"./id_rsa.pub\")}\"\n}\n\n\n\n\u5b9f\u884c\n# \u78ba\u8a8d\nterraform plan\n\n# \u5b9f\u884c\nterraform apply\n\n# \u4f5c\u3063\u305f\u30de\u30b7\u30f3\u306e\u30b0\u30ed\u30fc\u30d0\u30ebIP\u78ba\u8a8d(\uff12\u53f0\u5206\u8868\u793a\u3055\u308c\u308b)\nterraform show | grep \"shared_nw_address\"\n\n# \u4f5c\u3063\u305f\u30de\u30b7\u30f3\u3078\u306eSSH\nssh root@[\u5148\u307b\u3069\u78ba\u8a8d\u3057\u305fIP] -i id_rsa\n\n# ping(\u7570\u306a\u308b\u30be\u30fc\u30f3\u3078\u3064\u306a\u304c\u3063\u3066\u308b\u3053\u3068\u3092\u78ba\u8a8d)\nping 192.168.1.1\n# \u307e\u305f\u306f\nping 192.168.1.2\n\n\n\n**2016/5/24\u8ffd\u8a18**\n\nTerraform for \u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u306b\u4f34\u3044\u3001\nresource\u9805\u76ee\u306a\u3069\u304c\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u3068\u7570\u306a\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n\u6700\u65b0\u306e\u60c5\u5831\u306f[GitHub](https://github.com/yamamoto-febc/terraform-provider-sakuracloud)\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n#### \u95a2\u9023\u8a18\u4e8b\n\n[Terraform for \u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9 \u30b9\u30bf\u30fc\u30c8\u30ac\u30a4\u30c9](http://qiita.com/yamamoto-febc/items/ae92cd258cf040957487)\n\n---\n\n\u81ea\u5206\u7528\u30e1\u30e2\u3002\nTerraform for \u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u3067\u8907\u6570\u30be\u30fc\u30f3\u9593(\u77f3\u72e9/\u6771\u4eac\u306a\u3069)\u3067\u306e\n\u30d6\u30ea\u30c3\u30b8\u63a5\u7d9a\u3092\u304a\u3053\u306a\u3046\u307e\u3067\u3002\n\n## \u4f5c\u6210\u3055\u308c\u308b\u30af\u30e9\u30a6\u30c9\u4e0a\u306e\u30ea\u30bd\u30fc\u30b9\n\n* \u30b5\u30fc\u30d0\u30fc2\u53f0(\u77f3\u72e9\u7b2c\uff11\u30fb\u7b2c\uff12\uff09\n* \u30c7\u30a3\u30b9\u30af\uff12\u672c(\u5404\u30b5\u30fc\u30d0\u30fc\u306b1\u672c\u305a\u3064)\n* \u30b9\u30a4\u30c3\u30c12\u53f0(\u77f3\u72e9\u7b2c\uff11\u30fb\u7b2c\uff12\u3001\u30d6\u30ea\u30c3\u30b8\u3068\u306e\u63a5\u7d9a\u7528\uff09\n* \u30d6\u30ea\u30c3\u30b81\u53f0\n\n\u30b5\u30fc\u30d0\u3078\u306eSSH\u63a5\u7d9a\u306f\u516c\u958b\u9375\u8a8d\u8a3c\u306e\u307f\u3068\u3059\u308b\u3002\n\n\n## \u524d\u6e96\u5099\n\n* `terraform`\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n* `terraform for \u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9`\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n* `ssh-keygen` \u306a\u3069\u3067SSH\u7528\u306b\u30ad\u30fc\u30da\u30a2\u4f5c\u6210(`id_rsa`\u3068`id_rsa.pub`)\n\n* \u4ee5\u4e0b2\u3064\u306e\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u3066\u304a\u304f\u3002\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u7528\n\n``` provision_sv01.sh\n#!/bin/sh\n\n# eth1\u306eIP\u8a2d\u5b9a\ncat << EOS >> /etc/sysconfig/network-scripts/ifcfg-eth1\nBOOTPROTO=static\nPREFIX0=24\nDEVICE=eth1\nIPADDR0=192.168.1.1\nONBOOT=yes\nEOS\n\n#\u53cd\u6620\nifdown eth1; ifup eth1\n```\n\n``` provision_sv02.sh\n#!/bin/sh\n\n# eth1\u306eIP\u8a2d\u5b9a\ncat << EOS >> /etc/sysconfig/network-scripts/ifcfg-eth1\nBOOTPROTO=static\nPREFIX0=24\nDEVICE=eth1\nIPADDR0=192.168.1.2\nONBOOT=yes\nEOS\n\n#\u53cd\u6620\nifdown eth1; ifup eth1\n```\n\n* \u4ee5\u4e0b\u74b0\u5883\u5909\u6570\u306bAPI\u30ad\u30fc\u60c5\u5831\u3092\u8a2d\u5b9a\u3057\u3066\u304a\u304f\n  * `SAKURACLOUD_ACCESS_TOKEN` \uff1a\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\n  * `SAKURACLOUD_ACCESS_TOKEN_SECRET` \uff1a\u30b7\u30fc\u30af\u30ec\u30c3\u30c8  \n\n### terraform\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb(tf\u30d5\u30a1\u30a4\u30eb)\n\n```sakura.tf\nprovider \"sakuracloud\" {}\n\n##################################################\n#  \u30b5\u30fc\u30d0\u30fc1(\u77f3\u72e9\u7b2c1)\n##################################################\nresource \"sakuracloud_server\" \"is1a_sv01\" {\n    name = \"sv01\"\n    disks = [\"${sakuracloud_disk.disk01.id}\"]\n    tags = [\"@virtio-net-pci\"]\n    switched_interfaces = [ \"${sakuracloud_switch.sw01.id}\" ]\n\n    connection {\n       user = \"root\"\n       host = \"${sakuracloud_server.is1a_sv01.shared_nw_ipaddress}\"\n       private_key = \"${file(\"./id_rsa\")}\"\n    }\n \n    provisioner \"file\" {\n        source = \"provision_sv01.sh\"\n        destination = \"/tmp/script.sh\"\n    }\n \n    provisioner \"remote-exec\" {\n        inline = [\n          \"chmod +x /tmp/script.sh\",\n          \"/tmp/script.sh\"\n        ] \n   }\n   zone = \"is1a\"\n}\n##################################################\n#  \u30b5\u30fc\u30d0\u30fc2(\u77f3\u72e9\u7b2c2)\n##################################################\nresource \"sakuracloud_server\" \"is1b_sv02\" {\n    name = \"sv02\"\n    disks = [\"${sakuracloud_disk.disk02.id}\"]\n    tags = [\"@virtio-net-pci\"]\n    switched_interfaces = [ \"${sakuracloud_switch.sw02.id}\" ]\n    connection {\n       user = \"root\"\n       host = \"${sakuracloud_server.is1b_sv02.shared_nw_ipaddress}\"\n       private_key = \"${file(\"./id_rsa\")}\"\n    }\n    provisioner \"file\" {\n        source = \"provision_sv02.sh\"\n        destination = \"/tmp/script.sh\"\n    }\n\n    provisioner \"remote-exec\" {\n        inline = [\n          \"chmod +x /tmp/script.sh\",\n          \"/tmp/script.sh\"\n        ] \n   }\n   zone = \"is1b\"\n}\n\n##################################################\n#  \u30b5\u30fc\u30d0\u30fc1\u7528\u30c7\u30a3\u30b9\u30af(\u77f3\u72e9\u7b2c1)\n##################################################\nresource \"sakuracloud_disk\" \"disk01\" {\n    name = \"disk01\"\n    source_archive_name = \"CentOS 7.2 64bit\"\n    ssh_key_ids = [\"${sakuracloud_ssh_key.mykey.id}\"]\n    disable_pw_auth = true\n    zone = \"is1a\"\n}\n##################################################\n#  \u30b5\u30fc\u30d0\u30fc2\u7528\u30c7\u30a3\u30b9\u30af(\u77f3\u72e9\u7b2c1)\n##################################################\nresource \"sakuracloud_disk\" \"disk02\" {\n    name = \"disk02\"\n    source_archive_name = \"CentOS 7.2 64bit\"\n    ssh_key_ids = [\"${sakuracloud_ssh_key.mykey.id}\"]\n    disable_pw_auth = true\n    zone = \"is1b\"\n}\n\n##################################################\n#  \u30b9\u30a4\u30c3\u30c1(\u77f3\u72e9\u7b2c1)\uff1a\u30d6\u30ea\u30c3\u30b8\u306b\u63a5\u7d9a\n##################################################\nresource \"sakuracloud_switch\" \"sw01\"{\n    name = \"sw01\"\n    zone = \"is1a\"\n    bridge_id = \"${sakuracloud_bridge.br.id}\"\n}\n##################################################\n#  \u30b9\u30a4\u30c3\u30c1(\u77f3\u72e9\u7b2c2)\uff1a\u30d6\u30ea\u30c3\u30b8\u306b\u63a5\u7d9a\n##################################################\nresource \"sakuracloud_switch\" \"sw02\"{\n    name = \"sw02\"\n    zone = \"is1b\"\n    bridge_id = \"${sakuracloud_bridge.br.id}\"\n}\n\n##################################################\n#  \u30d6\u30ea\u30c3\u30b8(\u30be\u30fc\u30f3\u9593\u306e\u63a5\u7d9a)\n##################################################\nresource \"sakuracloud_bridge\" \"br\"{\n    name = \"br01\"\n    zone = \"is1a\"\n}\n\n/************************\n SSHKey\n************************/\nresource \"sakuracloud_ssh_key\" \"mykey\" {\n    name = \"key\"\n    public_key = \"${file(\"./id_rsa.pub\")}\"\n}\n```\n\n## \u5b9f\u884c\n\n```terraform\u5b9f\u884c\n# \u78ba\u8a8d\nterraform plan\n\n# \u5b9f\u884c\nterraform apply\n\n# \u4f5c\u3063\u305f\u30de\u30b7\u30f3\u306e\u30b0\u30ed\u30fc\u30d0\u30ebIP\u78ba\u8a8d(\uff12\u53f0\u5206\u8868\u793a\u3055\u308c\u308b)\nterraform show | grep \"shared_nw_address\"\n\n# \u4f5c\u3063\u305f\u30de\u30b7\u30f3\u3078\u306eSSH\nssh root@[\u5148\u307b\u3069\u78ba\u8a8d\u3057\u305fIP] -i id_rsa\n\n# ping(\u7570\u306a\u308b\u30be\u30fc\u30f3\u3078\u3064\u306a\u304c\u3063\u3066\u308b\u3053\u3068\u3092\u78ba\u8a8d)\nping 192.168.1.1\n# \u307e\u305f\u306f\nping 192.168.1.2\n\n```\n"}