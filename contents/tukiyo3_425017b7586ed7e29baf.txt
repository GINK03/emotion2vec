{"context": " More than 1 year has passed since last update.\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\n\n192.168.11.39 : rsyslog\u30b5\u30fc\u30d0(CentOS7) \n192.168.11.2 : mail\u30b5\u30fc\u30d0 \n192.168.11.254 : cisco\u6a5f\u5668\n192.168.11.1 : \u30eb\u30fc\u30bf\u30fc\n\n\n\u8a2d\u5b9a\n\ncisco\u5074\n(conf)#logging trap notifications\n(conf)#logging host 192.168.11.39\n\n\nrsyslog\u30b5\u30fc\u30d0\u5074\n\nudp514\u3067LISTEN\n\n/etc/rsyslog.conf\n$ModLoad imudp\n$UDPServerRun 514\n\n\n\n\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u8a2d\u5b9a\n\n/etc/rsyslog.conf\n$ModLoad ommail\n$ActionMailSMTPServer 192.168.11.2\n$ActionMailFrom rsyslog@syslog.server\n$template mail_subject,\"syslog:%fromhost%:%msg%\"\n$template mail_body,\"%fromhost%\\r\\n%msg%\"\n$ActionMailSubject mail_subject\n$ActionExecOnlyOnceEveryInterval  -1\n\n\n\n\u9001\u4fe1\u5143\u3054\u3068\u306b\u4fdd\u5b58\u5148\u6307\u5b9a\n\n/etc/rsyslog.conf\n$ActionMailTo my@mailaddr\n:fromhost-ip, isequal, \"192.168.11.254\" /var/log/rsyslog/192.168.1.254\nif $fromhost-ip == '192.168.11.254' then :ommail:;mail_body\n& stop\n\n\n\nsyntax check\n\nsyntax\u00a0check\n# rsyslogd -N 1\nrsyslogd: version 7.4.7, config validation run (level 1), master config /etc/rsyslog.conf\nrsyslogd: End of config validation run. Bye.\n\n\n\nrsyslog\u30ea\u30b9\u30bf\u30fc\u30c8\n# systemctl restart rsyslog\n\n\n\nsyntax error\u4f8b\n\n& ~\n\nMar 30 07:10:09 syslog1 rsyslogd-2307: warning: ~ action is deprecated, consider using the 'stop' statement instead [try http://www.rsyslog.com/e/2307 ]\n\n\n/etc/rsyslog.conf\n- & ~\n+ & stop\n\n\n\n$ActionMailTo\n\nrsyslogd: no recipient address given - specify $ActionMailTo [try http://www.rsyslog.com/e/2071 ]\nrsyslogd: error during parsing file /etc/rsyslog.conf, on or before line 66: errors occured in file '/etc/rsyslog.conf' around line 66 [try http://www.rsyslog.com/e/2207 ]\n\n\n/etc/rsyslog.conf\n+ $ActionMailTo my@mailaddr\n  :fromhost-ip, isequal, \"192.168.11.254\" /var/log/rsyslog/192.168.11.254\n  if $fromhost-ip == '192.168.11.254' then :ommail:;mail_body\n& stop\n\n+ $ActionMailTo my@mailaddr\n  :fromhost-ip, isequal, \"192.168.11.1\" /var/log/rsyslog/192.168.11.1\n  if $fromhost-ip == '192.168.11.1' then :ommail:;mail_body\n& stop\n\n\n\nommail \u306e\u76f4\u524d\u306b$ActionMailTo\u3092\u90fd\u5ea6\u66f8\u304b\u306a\u3044\u3068\u3044\u3051\u306a\u304b\u3063\u305f\u3002\n\n## \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\n\n* 192.168.11.39 : rsyslog\u30b5\u30fc\u30d0(CentOS7) \n* 192.168.11.2 : mail\u30b5\u30fc\u30d0 \n* 192.168.11.254 : cisco\u6a5f\u5668\n* 192.168.11.1 : \u30eb\u30fc\u30bf\u30fc\n\n# \u8a2d\u5b9a\n\n## cisco\u5074\n\n```bash:\n(conf)#logging trap notifications\n(conf)#logging host 192.168.11.39\n```\n\n## rsyslog\u30b5\u30fc\u30d0\u5074\n\n### udp514\u3067LISTEN\n\n```diff:/etc/rsyslog.conf\n$ModLoad imudp\n$UDPServerRun 514\n```\n\n### \u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u8a2d\u5b9a\n\n```diff:/etc/rsyslog.conf\n$ModLoad ommail\n$ActionMailSMTPServer 192.168.11.2\n$ActionMailFrom rsyslog@syslog.server\n$template mail_subject,\"syslog:%fromhost%:%msg%\"\n$template mail_body,\"%fromhost%\\r\\n%msg%\"\n$ActionMailSubject mail_subject\n$ActionExecOnlyOnceEveryInterval  -1\n```\n\n### \u9001\u4fe1\u5143\u3054\u3068\u306b\u4fdd\u5b58\u5148\u6307\u5b9a\n\n```bash:/etc/rsyslog.conf\n$ActionMailTo my@mailaddr\n:fromhost-ip, isequal, \"192.168.11.254\" /var/log/rsyslog/192.168.1.254\nif $fromhost-ip == '192.168.11.254' then :ommail:;mail_body\n& stop\n```\n\n\n## syntax check\n\n```bash:syntax&nbsp;check\n# rsyslogd -N 1\nrsyslogd: version 7.4.7, config validation run (level 1), master config /etc/rsyslog.conf\nrsyslogd: End of config validation run. Bye.\n```\n\n## rsyslog\u30ea\u30b9\u30bf\u30fc\u30c8\n\n```bash:\n# systemctl restart rsyslog\n```\n\n----\n\n# syntax error\u4f8b\n\n## & ~\n\n> Mar 30 07:10:09 syslog1 rsyslogd-2307: warning: ~ action is deprecated, consider using the 'stop' statement instead [try http://www.rsyslog.com/e/2307 ]\n\n```diff:/etc/rsyslog.conf\n- & ~\n+ & stop\n```\n\n## $ActionMailTo\n\n> rsyslogd: no recipient address given - specify $ActionMailTo [try http://www.rsyslog.com/e/2071 ]\n> rsyslogd: error during parsing file /etc/rsyslog.conf, on or before line 66: errors occured in file '/etc/rsyslog.conf' around line 66 [try http://www.rsyslog.com/e/2207 ]\n\n```diff:/etc/rsyslog.conf\n+ $ActionMailTo my@mailaddr\n  :fromhost-ip, isequal, \"192.168.11.254\" /var/log/rsyslog/192.168.11.254\n  if $fromhost-ip == '192.168.11.254' then :ommail:;mail_body\n& stop\n\n+ $ActionMailTo my@mailaddr\n  :fromhost-ip, isequal, \"192.168.11.1\" /var/log/rsyslog/192.168.11.1\n  if $fromhost-ip == '192.168.11.1' then :ommail:;mail_body\n& stop\n```\n\n* ommail \u306e\u76f4\u524d\u306b$ActionMailTo\u3092\u90fd\u5ea6\u66f8\u304b\u306a\u3044\u3068\u3044\u3051\u306a\u304b\u3063\u305f\u3002\n", "tags": ["rsyslog"]}