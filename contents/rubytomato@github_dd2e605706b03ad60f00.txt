{"tags": ["Redis3.0.3", "docker1.8.1"], "context": " More than 1 year has passed since last update.\n\n\u6982\u8981\nRedis\u306eOFFICIAL REPOSITORY\u3067\u516c\u958b\u3055\u308c\u3066\u3044\u308bRedis 3.0.3\u30a4\u30e1\u30fc\u30b8\u3092\u30d9\u30fc\u30b9\u306b\u3057\u305fRedis\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3001\u5b9f\u884c\u3059\u308b\u307e\u3067\u306e\u624b\u9806\u3067\u3059\u3002\n\u74b0\u5883\n\u4e0b\u8a18\u306e\u74b0\u5883\u3067\u52d5\u4f5c\u78ba\u8a8d\u3092\u884c\u3044\u307e\u3057\u305f\u3002\n\nWindows7 (64bit)\ndocker 1.8.1\n\n\nredis 3.0.3\n\n\n\n\u53c2\u8003\n\u4e0b\u8a18\u306e\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\n\nredis - OFFICIAL REPOSITORY\ntokuhy/conf-jp\nnet.core.somaxconn\u306b\u3064\u3044\u3066\u8abf\u3079\u3066\u307f\u305f\n\n\n\u4e8b\u524d\u6e96\u5099\n\nredis.conf\u306e\u7528\u610f\n\nredis.conf\ndaemonize no\npidfile /var/run/redis.pid\n\nport 6379\ntcp-backlog 511\n\nunixsocket /tmp/redis.sock\nunixsocketperm 700\n\ntimeout 0\ntcp-keepalive 0\n\nloglevel notice\nlogfile /var/log/redis.log\n\ndatabases 16\n\nsave 900 1\nsave 300 10\nsave 60 10000\n\nstop-writes-on-bgsave-error yes\n\nrdbcompression yes\n\nrdbchecksum yes\n\ndbfilename dump.rdb\ndir /data\n\nslave-serve-stale-data yes\nslave-read-only yes\n\nrepl-diskless-sync no\nrepl-diskless-sync-delay 5\nrepl-disable-tcp-nodelay no\n\nslave-priority 100\n\nmaxclients 100\nmaxmemory 10mb\n\nappendonly yes\nappendfilename \"appendonly.aof\"\nappendfsync everysec\n\nno-appendfsync-on-rewrite no\n\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\n\naof-load-truncated yes\n\nlua-time-limit 5000\n\nslowlog-log-slower-than 10000\nslowlog-max-len 128\n\nlatency-monitor-threshold 0\n\nnotify-keyspace-events \"\"\n\nhash-max-ziplist-entries 512\nhash-max-ziplist-value 64\nlist-max-ziplist-entries 512\nlist-max-ziplist-value 64\nset-max-intset-entries 512\nzset-max-ziplist-entries 128\nzset-max-ziplist-value 64\nhll-sparse-max-bytes 3000\n\nactiverehashing yes\n\nclient-output-buffer-limit normal 0 0 0\nclient-output-buffer-limit slave 256mb 64mb 60\nclient-output-buffer-limit pubsub 32mb 8mb 60\n\nhz 10\n\naof-rewrite-incremental-fsync yes\n\n\n\nDockerfile\u306e\u7528\u610f\n\nDockerfile\nFROM redis:3.0.3\n\n# log file\nRUN touch /var/log/redis.log && chmod 755 /var/log/redis.log && chown redis:redis /var/log/redis.log\n\n# conf file\nADD redis.conf /tmp/redis.conf\nRUN mkdir -p -m 755 /usr/local/etc/redis && chown redis:redis /usr/local/etc/redis && cp /tmp/redis.conf /usr/local/etc/redis && chown redis:redis /usr/local/etc/redis/redis.conf && rm /tmp/redis.conf\n\nEXPOSE 6379\n\nCMD [\"redis-server\",\"/usr/local/etc/redis/redis.conf\"]\n\n\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u4f5c\u6210\n\nredis 3.0.3\u30a4\u30e1\u30fc\u30b8\u306e\u53d6\u5f97\n\u5143\u306b\u306a\u308bredis\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002(\u4e00\u5ea6\u3060\u3051\u5b9f\u884c\u3057\u307e\u3059\u3002)\n\npull\n$ docker pull redis:3.0.3\n\n\n\n\u30d3\u30eb\u30c9\n\nbuild\n$ docker build -t rubytomato/redis303:0.1 .\n\n\n\u30d3\u30eb\u30c9\u3057\u305f\u30a4\u30e1\u30fc\u30b8\u304b\u3089\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3057\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u30c7\u30fc\u30bf\u3092\u6c38\u7d9a\u5316\u3059\u308b\u305f\u3081\u3001AOF\u30d5\u30a1\u30a4\u30eb\u304a\u3088\u3073RDB\u30d5\u30a1\u30a4\u30eb\u304c\u914d\u7f6e\u3055\u308c\u308b/data\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30db\u30b9\u30c8\u306e\u5171\u6709\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3057\u307e\u3059\u3002\n\nrun\n$ docker run -d --name my-redis -p 6379:6379 -v /c/Users/Username/dev/docker/redis3.0.3:/data rubytomato/redis303:0.1\n\n\n\n\u5171\u6709\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30d1\u30b9\u306e\u4e00\u90e8\u3092\u30de\u30b9\u30af\u3057\u3066\u3044\u307e\u3059\u3002\n\n\nps\n$ docker ps --format=\"{{.ID}}\\\\t{{.Status}}\\\\t{{.Ports}}\\\\t{{.Names}}\"\nfd95ba3b2322    Up 48 seconds   0.0.0.0:6379->6379/tcp  my-redis\n\n\n\u5ff5\u306e\u305f\u3081redis.log\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\nexec\n$ docker exec -it my-redis bash\n\nroot@fd95ba3b2322:~# cat /var/log/redis.log\n                _._\n           _.-``__ ''-._\n      _.-``    `.  `_.  ''-._           Redis 3.0.3 (00000000/0) 64 bit\n  .-`` .-```.  ```\\/    _.,_ ''-._\n (    '      ,       .-`  | `,    )     Running in standalone mode\n |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6379\n |    `-._   `._    /     _.-'    |     PID: 1\n  `-._    `-._  `-./  _.-'    _.-'\n |`-._`-._    `-.__.-'    _.-'_.-'|\n |    `-._`-._        _.-'_.-'    |           http://redis.io\n  `-._    `-._`-.__.-'_.-'    _.-'\n |`-._`-._    `-.__.-'    _.-'_.-'|\n |    `-._`-._        _.-'_.-'    |\n  `-._    `-._`-.__.-'_.-'    _.-'\n      `-._    `-.__.-'    _.-'\n          `-._        _.-'\n              `-.__.-'\n\n1:M 24 Aug 18:26:08.808 # Server started, Redis version 3.0.3\n1:M 24 Aug 18:26:08.809 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.\n1:M 24 Aug 18:26:08.809 # WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo never > /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.\n1:M 24 Aug 18:26:08.809 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.\n1:M 24 Aug 18:26:08.809 * The server is now ready to accept connections on port 6379\n1:M 24 Aug 18:26:08.809 * The server is now ready to accept connections at /tmp/redis.sock\n\n\nWarning\u304c3\u4ef6\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u539f\u56e0\u3068\u5bfe\u7b56\u306fRedis \u3068 php-pecl-redis \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30e1\u30e2\uff08CentOS7.1.1503\uff09\u3068\u3044\u3046\u30b5\u30a4\u30c8\u3067\u8a73\u3057\u304f\u8aac\u660e\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u305f\u3060\u30d9\u30fc\u30b9\u3068\u306a\u308bDebian\u306b\u306fsysctl\u304c\u7121\u3044\u3088\u3046\u3067\u5bfe\u5fdc\u306e\u4ed5\u65b9\u304c\u308f\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u5b9f\u884c\u306b\u5931\u6557\u3059\u308b\u5834\u5408\n\u30b3\u30f3\u30c6\u30ca\u306e\u5b9f\u884c\u3067\u5931\u6557\u3059\u308b\u5834\u5408\u306f\u30ed\u30b0\u306b\u539f\u56e0\u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u306a\u3044\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u3001\u3053\u306e\u3088\u3046\u306a\u60c5\u5831\u304c\u5f97\u3089\u308c\u307e\u3059\u3002\n\nlogs\n$ docker logs fd95ba3b2322\n\n*** FATAL CONFIG FILE ERROR ***\nReading the configuration file, at line 940\n>>> 'aof-rewrite-incremental-fsyn'\nBad directive or wrong number of arguments\n\n\n\nredis-cli\nredis-cli\u30b3\u30f3\u30c6\u30ca\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\nredis-cli\n$ docker run -it --link my-redis:redis --rm rubytomato/redis303:0.1 sh -c 'exec redis-cli -h \"$REDIS_PORT_6379_TCP_ADDR\" -p \"$REDIS_PORT_6379_TCP_PORT\"'\n172.17.0.3:6379>\n\n\nredis-cli\u3092\u5b9f\u884c\u3059\u308b\u5225\u306e\u65b9\u6cd5\nexec\u30b3\u30de\u30f3\u30c9\u3067\u30b3\u30f3\u30c6\u30ca\u306b\u5165\u308a\u76f4\u63a5redis-cli\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\nexec\n$ docker exec -it my-redis bash\n\n\n# redis-cli\n172.17.0.3:6379>\n\n\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u4e00\u62ec\u3067\u4f5c\u6210\u3059\u308b\n\u4e0b\u8a18\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092test_data.sh\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3067\u4fdd\u5b58\u3057\u3066\u5b9f\u884c\u3057\u307e\u3059\u3002\nkey:xxx\u3068\u3044\u3046\u540d\u524d\u306e\u30ad\u30fc\u304c1000\u4ef6\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\ntest_data.sh\n#!/bin/bash\n\nfor a in {1..1000}\ndo\nredis-cli set key:$a $a\ndone\n\n\n\u3053\u306e\u5185\u5bb9\u306f\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3067redis\u30c7\u30fc\u30bf\u4f5c\u6210\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\n\n\u30e1\u30e2\nredis\u306e\u30ed\u30b0\u306b\u51fa\u529b\u3055\u308c\u3066\u3044\u308b3\u3064\u306eWARNING\u306e\u5bfe\u51e6\u65b9\u6cd5\u306e\u30e1\u30e2\u3067\u3059\u3002\n\u4eee\u60f3\u30de\u30b7\u30f3(\u30db\u30b9\u30c8)\u5074\u306e\u8a2d\u5b9a\u3092\u5909\u3048\u308b\u3053\u3068\u3067\u5bfe\u51e6\u3067\u304d\u308b\u90e8\u5206\u304c\u3042\u308a\u307e\u3057\u305f\u3002\u307e\u305f\u3053\u306e\u5909\u66f4\u3092\u6c38\u7d9a\u5316\u3059\u308b\u305f\u3081\u306bVirtualbox\u3067\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u53d6\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\novercommit_memory\nWARNING overcommit_memory is set to 0! Background save may fail under low memory condition.\n\n\u30db\u30b9\u30c8\u5074\u306esysctl.conf\u3092\u4e0b\u8a18\u306e\u3088\u3046\u306b\u7de8\u96c6\u3057\u3001\u7de8\u96c6\u5f8c\u306bsudo sysctl -p\u3067\u53cd\u6620\u3057\u307e\u3059\u3002\n/etc/sysctl.conf\u306b\u4e0b\u8a18\u306e\u884c\u3092\u8ffd\u52a0\n\nsysctl.conf\nvm.overcommit_memory = 1\n\n\n\nDisable Transparent Huge Pages\nWARNING you have Transparent Huge Pages (THP) support enabled in your kernel.\n\n\u73fe\u5728\u5024\u306e\u78ba\u8a8d\n$ sudo cat /sys/kernel/mm/transparent_hugepage/enabled\n[always] madvise never\n$ sudo cat /sys/kernel/mm/transparent_hugepage/defrag\n[always] madvise never\n\n\u30db\u30b9\u30c8\u5074\u3067root\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u30b9\u30a4\u30c3\u30c1\u3057\u3066\u4e0b\u8a18\u306e\u64cd\u4f5c\u3092\u884c\u3044\u307e\u3059\u3002\n$ sudo su\n\n# echo never > /sys/kernel/mm/transparent_hugepage/enabled\n# echo never > /sys/kernel/mm/transparent_hugepage/defrag\n\n\u5909\u66f4\u5f8c\u306e\u78ba\u8a8d\n# cat /sys/kernel/mm/transparent_hugepage/enabled\nalways madvise [never]\n# cat /sys/kernel/mm/transparent_hugepage/defrag\nalways madvise [never]\n\n\nsomaxconn\n \u3053\u306e\u30ef\u30fc\u30cb\u30f3\u30b0\u306f\u4e0b\u8a18\u306e\u65b9\u6cd5\u3067\u306f\u89e3\u6c7a\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\nWARNING: The TCP backlog setting of 511 cannot be enforced ...\n\n\u30db\u30b9\u30c8\u5074\u306esysctl.conf\u3092\u4e0b\u8a18\u306e\u3088\u3046\u306b\u7de8\u96c6\u3057\u3001\u7de8\u96c6\u5f8c\u306bsudo sysctl -p\u3067\u53cd\u6620\u3057\u307e\u3059\u3002\n/etc/sysctl.conf\u306b\u4e0b\u8a18\u306e\u884c\u3092\u8ffd\u52a0\n\nsysctl.conf\nnet.core.somaxconn = 1024\n\n\n\u6b63\u3057\u3044\u5bfe\u51e6\u65b9\u6cd5\u304b\u306f\u308f\u304b\u308a\u307e\u305b\u3093\u304c\u3001redis.conf\u306etcp_backlog\u306e\u5024\u3092128\u306b\u4e0b\u3052\u308b\u3053\u3068\u3067\u30ef\u30fc\u30cb\u30f3\u30b0\u3092\u6d88\u3059\u3053\u3068\u306f\u3067\u304d\u307e\u3059\u3002\n# \u6982\u8981\n\nRedis\u306eOFFICIAL REPOSITORY\u3067\u516c\u958b\u3055\u308c\u3066\u3044\u308bRedis 3.0.3\u30a4\u30e1\u30fc\u30b8\u3092\u30d9\u30fc\u30b9\u306b\u3057\u305fRedis\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3001\u5b9f\u884c\u3059\u308b\u307e\u3067\u306e\u624b\u9806\u3067\u3059\u3002\n\n**\u74b0\u5883**\n\n\u4e0b\u8a18\u306e\u74b0\u5883\u3067\u52d5\u4f5c\u78ba\u8a8d\u3092\u884c\u3044\u307e\u3057\u305f\u3002\n\n* Windows7 (64bit)\n* docker 1.8.1\n * redis 3.0.3\n\n**\u53c2\u8003**\n\n\u4e0b\u8a18\u306e\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\n\n* [redis - OFFICIAL REPOSITORY] (https://hub.docker.com/_/redis/)\n* [tokuhy/conf-jp] (https://github.com/tokuhy/conf-jp/blob/master/redis.2.8.x.conf)\n* [net.core.somaxconn\u306b\u3064\u3044\u3066\u8abf\u3079\u3066\u307f\u305f] (http://tetsuyai.hatenablog.com/entry/20111220/1324466655)\n\n\n## \u4e8b\u524d\u6e96\u5099\n\n### redis.conf\u306e\u7528\u610f\n\n```text:redis.conf\ndaemonize no\npidfile /var/run/redis.pid\n\nport 6379\ntcp-backlog 511\n\nunixsocket /tmp/redis.sock\nunixsocketperm 700\n\ntimeout 0\ntcp-keepalive 0\n\nloglevel notice\nlogfile /var/log/redis.log\n\ndatabases 16\n\nsave 900 1\nsave 300 10\nsave 60 10000\n\nstop-writes-on-bgsave-error yes\n\nrdbcompression yes\n\nrdbchecksum yes\n\ndbfilename dump.rdb\ndir /data\n\nslave-serve-stale-data yes\nslave-read-only yes\n\nrepl-diskless-sync no\nrepl-diskless-sync-delay 5\nrepl-disable-tcp-nodelay no\n\nslave-priority 100\n\nmaxclients 100\nmaxmemory 10mb\n\nappendonly yes\nappendfilename \"appendonly.aof\"\nappendfsync everysec\n\nno-appendfsync-on-rewrite no\n\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\n\naof-load-truncated yes\n\nlua-time-limit 5000\n\nslowlog-log-slower-than 10000\nslowlog-max-len 128\n\nlatency-monitor-threshold 0\n\nnotify-keyspace-events \"\"\n\nhash-max-ziplist-entries 512\nhash-max-ziplist-value 64\nlist-max-ziplist-entries 512\nlist-max-ziplist-value 64\nset-max-intset-entries 512\nzset-max-ziplist-entries 128\nzset-max-ziplist-value 64\nhll-sparse-max-bytes 3000\n\nactiverehashing yes\n\nclient-output-buffer-limit normal 0 0 0\nclient-output-buffer-limit slave 256mb 64mb 60\nclient-output-buffer-limit pubsub 32mb 8mb 60\n\nhz 10\n\naof-rewrite-incremental-fsync yes\n```\n\n### Dockerfile\u306e\u7528\u610f\n\n```text:Dockerfile\nFROM redis:3.0.3\n\n# log file\nRUN touch /var/log/redis.log && chmod 755 /var/log/redis.log && chown redis:redis /var/log/redis.log\n\n# conf file\nADD redis.conf /tmp/redis.conf\nRUN mkdir -p -m 755 /usr/local/etc/redis && chown redis:redis /usr/local/etc/redis && cp /tmp/redis.conf /usr/local/etc/redis && chown redis:redis /usr/local/etc/redis/redis.conf && rm /tmp/redis.conf\n\nEXPOSE 6379\n\nCMD [\"redis-server\",\"/usr/local/etc/redis/redis.conf\"]\n```\n\n## \u30a4\u30e1\u30fc\u30b8\u306e\u4f5c\u6210\n\n### redis 3.0.3\u30a4\u30e1\u30fc\u30b8\u306e\u53d6\u5f97\n\n\u5143\u306b\u306a\u308bredis\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002(\u4e00\u5ea6\u3060\u3051\u5b9f\u884c\u3057\u307e\u3059\u3002)\n\n```bash:pull\n$ docker pull redis:3.0.3\n```\n\n### \u30d3\u30eb\u30c9\n\n```bash:build\n$ docker build -t rubytomato/redis303:0.1 .\n```\n\n\u30d3\u30eb\u30c9\u3057\u305f\u30a4\u30e1\u30fc\u30b8\u304b\u3089\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3057\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u30c7\u30fc\u30bf\u3092\u6c38\u7d9a\u5316\u3059\u308b\u305f\u3081\u3001AOF\u30d5\u30a1\u30a4\u30eb\u304a\u3088\u3073RDB\u30d5\u30a1\u30a4\u30eb\u304c\u914d\u7f6e\u3055\u308c\u308b/data\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30db\u30b9\u30c8\u306e\u5171\u6709\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3057\u307e\u3059\u3002\n\n```bash:run\n$ docker run -d --name my-redis -p 6379:6379 -v /c/Users/Username/dev/docker/redis3.0.3:/data rubytomato/redis303:0.1\n```\n\n* \u5171\u6709\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30d1\u30b9\u306e\u4e00\u90e8\u3092\u30de\u30b9\u30af\u3057\u3066\u3044\u307e\u3059\u3002\n\n```bash:ps\n$ docker ps --format=\"{{.ID}}\\\\t{{.Status}}\\\\t{{.Ports}}\\\\t{{.Names}}\"\nfd95ba3b2322    Up 48 seconds   0.0.0.0:6379->6379/tcp  my-redis\n```\n\n\u5ff5\u306e\u305f\u3081redis.log\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:exec\n$ docker exec -it my-redis bash\n\nroot@fd95ba3b2322:~# cat /var/log/redis.log\n                _._\n           _.-``__ ''-._\n      _.-``    `.  `_.  ''-._           Redis 3.0.3 (00000000/0) 64 bit\n  .-`` .-```.  ```\\/    _.,_ ''-._\n (    '      ,       .-`  | `,    )     Running in standalone mode\n |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6379\n |    `-._   `._    /     _.-'    |     PID: 1\n  `-._    `-._  `-./  _.-'    _.-'\n |`-._`-._    `-.__.-'    _.-'_.-'|\n |    `-._`-._        _.-'_.-'    |           http://redis.io\n  `-._    `-._`-.__.-'_.-'    _.-'\n |`-._`-._    `-.__.-'    _.-'_.-'|\n |    `-._`-._        _.-'_.-'    |\n  `-._    `-._`-.__.-'_.-'    _.-'\n      `-._    `-.__.-'    _.-'\n          `-._        _.-'\n              `-.__.-'\n\n1:M 24 Aug 18:26:08.808 # Server started, Redis version 3.0.3\n1:M 24 Aug 18:26:08.809 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.\n1:M 24 Aug 18:26:08.809 # WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo never > /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.\n1:M 24 Aug 18:26:08.809 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.\n1:M 24 Aug 18:26:08.809 * The server is now ready to accept connections on port 6379\n1:M 24 Aug 18:26:08.809 * The server is now ready to accept connections at /tmp/redis.sock\n```\n\nWarning\u304c3\u4ef6\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u539f\u56e0\u3068\u5bfe\u7b56\u306f[Redis \u3068 php-pecl-redis \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30e1\u30e2\uff08CentOS7.1.1503\uff09] (https://blog.apar.jp/linux/2959/)\u3068\u3044\u3046\u30b5\u30a4\u30c8\u3067\u8a73\u3057\u304f\u8aac\u660e\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u305f\u3060\u30d9\u30fc\u30b9\u3068\u306a\u308bDebian\u306b\u306fsysctl\u304c\u7121\u3044\u3088\u3046\u3067\u5bfe\u5fdc\u306e\u4ed5\u65b9\u304c\u308f\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n\n#### \u30b3\u30f3\u30c6\u30ca\u306e\u5b9f\u884c\u306b\u5931\u6557\u3059\u308b\u5834\u5408\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u5b9f\u884c\u3067\u5931\u6557\u3059\u308b\u5834\u5408\u306f\u30ed\u30b0\u306b\u539f\u56e0\u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u306a\u3044\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u3001\u3053\u306e\u3088\u3046\u306a\u60c5\u5831\u304c\u5f97\u3089\u308c\u307e\u3059\u3002\n\n```bash:logs\n$ docker logs fd95ba3b2322\n\n*** FATAL CONFIG FILE ERROR ***\nReading the configuration file, at line 940\n>>> 'aof-rewrite-incremental-fsyn'\nBad directive or wrong number of arguments\n```\n\n\n#### redis-cli\n\nredis-cli\u30b3\u30f3\u30c6\u30ca\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```bash:redis-cli\n$ docker run -it --link my-redis:redis --rm rubytomato/redis303:0.1 sh -c 'exec redis-cli -h \"$REDIS_PORT_6379_TCP_ADDR\" -p \"$REDIS_PORT_6379_TCP_PORT\"'\n172.17.0.3:6379>\n```\n\n**redis-cli\u3092\u5b9f\u884c\u3059\u308b\u5225\u306e\u65b9\u6cd5**\n\nexec\u30b3\u30de\u30f3\u30c9\u3067\u30b3\u30f3\u30c6\u30ca\u306b\u5165\u308a\u76f4\u63a5redis-cli\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```bash:exec\n$ docker exec -it my-redis bash\n```\n\n```shell-session\n# redis-cli\n172.17.0.3:6379>\n```\n\n**\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u4e00\u62ec\u3067\u4f5c\u6210\u3059\u308b**\n\n\u4e0b\u8a18\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092`test_data.sh`\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3067\u4fdd\u5b58\u3057\u3066\u5b9f\u884c\u3057\u307e\u3059\u3002\n`key:xxx`\u3068\u3044\u3046\u540d\u524d\u306e\u30ad\u30fc\u304c1000\u4ef6\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\n```shell-session:test_data.sh\n#!/bin/bash\n\nfor a in {1..1000}\ndo\nredis-cli set key:$a $a\ndone\n```\n\n\u3053\u306e\u5185\u5bb9\u306f[\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3067redis\u30c7\u30fc\u30bf\u4f5c\u6210] (http://qiita.com/shell/items/4d3fca4b27fb674b173a)\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\n\n\n\n## \u30e1\u30e2\n\nredis\u306e\u30ed\u30b0\u306b\u51fa\u529b\u3055\u308c\u3066\u3044\u308b3\u3064\u306eWARNING\u306e\u5bfe\u51e6\u65b9\u6cd5\u306e\u30e1\u30e2\u3067\u3059\u3002\n\u4eee\u60f3\u30de\u30b7\u30f3(\u30db\u30b9\u30c8)\u5074\u306e\u8a2d\u5b9a\u3092\u5909\u3048\u308b\u3053\u3068\u3067\u5bfe\u51e6\u3067\u304d\u308b\u90e8\u5206\u304c\u3042\u308a\u307e\u3057\u305f\u3002\u307e\u305f\u3053\u306e\u5909\u66f4\u3092\u6c38\u7d9a\u5316\u3059\u308b\u305f\u3081\u306bVirtualbox\u3067\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u53d6\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n### overcommit_memory\n\n```text\nWARNING overcommit_memory is set to 0! Background save may fail under low memory condition.\n```\n\n\u30db\u30b9\u30c8\u5074\u306esysctl.conf\u3092\u4e0b\u8a18\u306e\u3088\u3046\u306b\u7de8\u96c6\u3057\u3001\u7de8\u96c6\u5f8c\u306b`sudo sysctl -p`\u3067\u53cd\u6620\u3057\u307e\u3059\u3002\n\n`/etc/sysctl.conf`\u306b\u4e0b\u8a18\u306e\u884c\u3092\u8ffd\u52a0\n\n```text:sysctl.conf\nvm.overcommit_memory = 1\n```\n\n\n### Disable Transparent Huge Pages\n\n```text\nWARNING you have Transparent Huge Pages (THP) support enabled in your kernel.\n```\n\n\u73fe\u5728\u5024\u306e\u78ba\u8a8d\n\n```bash\n$ sudo cat /sys/kernel/mm/transparent_hugepage/enabled\n[always] madvise never\n$ sudo cat /sys/kernel/mm/transparent_hugepage/defrag\n[always] madvise never\n```\n\n\u30db\u30b9\u30c8\u5074\u3067root\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u30b9\u30a4\u30c3\u30c1\u3057\u3066\u4e0b\u8a18\u306e\u64cd\u4f5c\u3092\u884c\u3044\u307e\u3059\u3002\n\n```bash\n$ sudo su\n```\n\n```shell-session\n# echo never > /sys/kernel/mm/transparent_hugepage/enabled\n# echo never > /sys/kernel/mm/transparent_hugepage/defrag\n```\n\n\u5909\u66f4\u5f8c\u306e\u78ba\u8a8d\n\n```shell-session\n# cat /sys/kernel/mm/transparent_hugepage/enabled\nalways madvise [never]\n# cat /sys/kernel/mm/transparent_hugepage/defrag\nalways madvise [never]\n```\n\n\n### somaxconn\n\n:exclamation: \u3053\u306e\u30ef\u30fc\u30cb\u30f3\u30b0\u306f\u4e0b\u8a18\u306e\u65b9\u6cd5\u3067\u306f\u89e3\u6c7a\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n```text\nWARNING: The TCP backlog setting of 511 cannot be enforced ...\n```\n\n\u30db\u30b9\u30c8\u5074\u306esysctl.conf\u3092\u4e0b\u8a18\u306e\u3088\u3046\u306b\u7de8\u96c6\u3057\u3001\u7de8\u96c6\u5f8c\u306b`sudo sysctl -p`\u3067\u53cd\u6620\u3057\u307e\u3059\u3002\n\n`/etc/sysctl.conf`\u306b\u4e0b\u8a18\u306e\u884c\u3092\u8ffd\u52a0\n\n```text:sysctl.conf\nnet.core.somaxconn = 1024\n```\n\n\u6b63\u3057\u3044\u5bfe\u51e6\u65b9\u6cd5\u304b\u306f\u308f\u304b\u308a\u307e\u305b\u3093\u304c\u3001redis.conf\u306e`tcp_backlog`\u306e\u5024\u3092128\u306b\u4e0b\u3052\u308b\u3053\u3068\u3067\u30ef\u30fc\u30cb\u30f3\u30b0\u3092\u6d88\u3059\u3053\u3068\u306f\u3067\u304d\u307e\u3059\u3002\n"}