{"tags": ["pacemaker", "ESXi"], "context": "fence_agent\u306b\u542b\u307e\u308c\u308bfence_vmare_soap\u3067\u306fESXi5\u3078\u306e\u63a5\u7d9a\u306f\u3069\u3046\u306a\u306e\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nESX\u306f\u3001\u5c11\u3057\u524d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306e5.5\u7cfb\u3067\u3059\u3002\nfence_vmare_soap\u3067\u306f\u3001external/libvirt\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u3068\u7570\u306a\u308a\u3001\u63a5\u7d9a\u5148\u6307\u5b9a(esx/vpx\u6307\u5b9a\u306b\u3088\u308bESXi\u63a5\u7d9a\u304b\u3001vCenter\u63a5\u7d9a\u304b\u306e\u533a\u5225)\u304c\u4e0d\u8981\u306a\u306e\u304c\u4fbf\u5229\u3067\u3059\u304c\u3001\u82e5\u5e72\u3001soap\u51e6\u7406\u306b\u6642\u9593\u304c\u304b\u304b\u308b\u3088\u3046\u3067\u3001external/libvirt\u3088\u308a\u306f\u52d5\u4f5c\u304c\u9045\u3044\u3088\u3046\u3067\u3059\u3002\n\u307e\u305f\u3001/etc/libvirt/auth.conf\u306e\u7de8\u96c6\u3082\u4e0d\u8981\u3067\u3059\u3002\n\n\u74b0\u5883\n\nvCenter : xxx.xxx.xx.62\nESXi5 : xxx.xxx.xx.33\n\n\n\u5b9f\u969b\u306b\u306f\u3001vCenter\u914d\u4e0b\u306b\u3053\u306e\u4ed6\u306b\uff12\u53f0\u306eESXi5\u30b5\u30fc\u30d0\u304c\u5b58\u5728\u3057\u3001HA\u69cb\u6210\u3092\u53d6\u3063\u3066\u3044\u307e\u3059\u3002\n\n\nRHEL7.3 : rh73-01 - \u63a5\u7d9a\u5148\u306eESXi5\u5185\u306e\u30b2\u30b9\u30c8\nfence_agent 4.0.25\n\n\n\u5185\u5bb9\n\u3068\u308a\u3042\u3048\u305a\u3001RHEL7\u7cfb\u3067\u5229\u7528\u3059\u308b\u5834\u5408\u3001insecure\u6307\u5b9a\u304c\u5fc5\u8981\u306a\u3088\u3046\u3067\u3059\u3002\n\u4e0b\u8a18\u306e\u4f8b\u3067\u306f\u30e6\u30fc\u30b6\u540d\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067\u306e\u78ba\u8a8d\u3067\u3059\u306e\u3067\u3001\u30d9\u30bf\u3067\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u304c\u5b9f\u969b\u306bPacemaker\u306bStonith\u30ea\u30bd\u30fc\u30b9\u3068\u3057\u3066\u53d6\u308a\u8fbc\u3080\u5834\u5408\u306a\u3069\u306f\u3001cibsecret\u306b\u3088\u308b\u30de\u30b9\u30af\u5316\u306e\u5229\u7528\u304c\u5fc5\u8981\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u30ea\u30b9\u30c8\u53d6\u5f97\nESXi5\u30db\u30b9\u30c8\u306e\u30b2\u30b9\u30c8\u306e\u30ea\u30b9\u30c8\u3092\u53d6\u5f97\u3057\u3066\u307f\u307e\u3059\u3002\n[rh73-01]# fence_vmware_soap -o list -a \"xxx.xxx.xx.33\" -l \"userid\" -p \"password\" -z --ssl-insecure\n(snip)\nweb-srv,564dac69-59b8-7967-7617-c29a6cfbfd2c\nrh73-01,564d7267-8fad-56e9-609d-ae8f13c3d44f\ndb01-srv,564d550f-2fa4-7227-2377-f2a64076caaa\n\n\u3000\n\u63a5\u7d9a\u5148\u306bvCenter\u3092\u6307\u5b9a\u3057\u3066\u3001vCenter\u914d\u4e0b\u306eESXi\u30db\u30b9\u30c8\u306e\u30b2\u30b9\u30c8\u306e\u30ea\u30b9\u30c8\u3092\u53d6\u5f97\u3057\u3066\u307f\u307e\u3059\u3002\nlibvirt\u5229\u7528\u3067\u306f\u3001vpx\u6307\u5b9a\u304c\u5fc5\u8981\u3067\u3057\u305f\u304c\u3001\u30e6\u30fc\u30b6\u540d\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u304cvCenter\u3067\u5171\u901a\u3067\u3042\u308c\u3070\u3001ip\u30a2\u30c9\u30ec\u30b9\u3092vCenter\u306b\u5909\u66f4\u3059\u308b\u3060\u3051\u3067\u3001\u53d6\u5f97\u304c\u53ef\u80fd\u3067\u3059\u3002\n\u5168\u3066\u306eESXi\u30db\u30b9\u30c8\u306b\u914d\u7f6e\u3055\u308c\u305f\u30b2\u30b9\u30c8\u306e\u30ea\u30b9\u30c8\u304c\u53d6\u5f97\u51fa\u6765\u307e\u3059\u3002\n[rh73-01]# fence_vmware_soap -o list -a \"xxx.xxx.xx.62\" -l \"userid\" -p \"password\" -z --ssl-insecure\n(snip)\nweb-srv,564dac69-59b8-7967-7617-c29a6cfbfd2c\nrh73-01,564d7267-8fad-56e9-609d-ae8f13c3d44f\ndb01-srv,564d550f-2fa4-7227-2377-f2a64076caaa\n(snip)\nap02-srv,564d7267-8fad-56e9-609d-1e8f13c3d44f\ndb02-srv,564d550f-2fa4-7227-2377-32a64076caaa\n\n\n\n\u30b2\u30b9\u30c8\u306e\u72b6\u614b\u53d6\u5f97\nn\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u5bfe\u8c61\u30b2\u30b9\u30c8\u3092\u6307\u5b9a\u3057\u307e\u3059\u304c\u3001\u30b2\u30b9\u30c8\u540d\u6307\u5b9a\u3068UUID\u6307\u5b9a\u304c\u53ef\u80fd\u3067\u3059\u3002\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.33\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nStatus: OFF\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.33\" -l \"userid\" -p \"password\" -z --ssl-insecure -n 564dac69-59b8-7967-7617-c29a6cfbfd2c\nStatus: OFF\n\n\u63a5\u7d9a\u5148\u306bvCenter\u30b5\u30fc\u30d0\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u306b\u3082\u540c\u69d8\u306b\u72b6\u614b\u53d6\u5f97\u304c\u53ef\u80fd\u3067\u3059\u3002\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.62\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nStatus: OFF\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.62\" -l \"userid\" -p \"password\" -z --ssl-insecure -n 564dac69-59b8-7967-7617-c29a6cfbfd2c\nStatus: OFF\n\n\n\u30b2\u30b9\u30c8\u306e\u96fb\u6e90OFF\nStonith\u3092\u60f3\u5b9a\u3057\u3066\u3001\u30b2\u30b9\u30c8\u306e\u96fb\u6e90\u3092\u843d\u3068\u3057\u3066\u307f\u307e\u3059\u3002\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.33\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nStatus: ON\n[rh73-01]# fence_vmware_soap -o off -a \"xxx.xxx.xx.33\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nSuccess: Powered OFF\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.33\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nStatus: OFF\n\n\u63a5\u7d9a\u5148\u306bvCenter\u30b5\u30fc\u30d0\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u306b\u3082\u540c\u69d8\u306b\u96fb\u6e90OFF\u304c\u53ef\u80fd\u3067\u3059\u3002\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.62\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nStatus: ON\n[rh73-01]# fence_vmware_soap -o off -a \"xxx.xxx.xx.62\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nSuccess: Powered OFF\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.62\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nStatus: OFF\n\n\n\u30b2\u30b9\u30c8\u306e\u96fb\u6e90on\nStonith\u3092\u60f3\u5b9a\u3057\u3066\u3001\u30b2\u30b9\u30c8\u306e\u96fb\u6e90\u3092\u5165\u308c\u3066\u307f\u307e\u3059\u3002\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.33\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nStatus: OFF\n[rh73-01]# fence_vmware_soap -o on -a \"xxx.xxx.xx.33\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nSuccess: Powered ON\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.33\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nStatus: ON\n\n\u63a5\u7d9a\u5148\u306bvCenter\u30b5\u30fc\u30d0\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u306b\u3082\u540c\u69d8\u306b\u96fb\u6e90ON\u304c\u53ef\u80fd\u3067\u3059\u3002\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.62\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nStatus: OFF\n[rh73-01]# fence_vmware_soap -o on -a \"xxx.xxx.xx.62\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nSuccess: Powered ON\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.62\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nStatus: ON\n\n\n\u305d\u306e\u4ed6\n\n\u30d8\u30eb\u30d7\n[rh73-01]# fence_vmware_soap --help\nUsage:\n        fence_vmware_soap [options]\nOptions:\n   -a, --ip=[ip]                  IP address or hostname of fencing device\n   -l, --username=[name]          Login name\n   -p, --password=[password]      Login password or passphrase\n   -z, --ssl                      Use SSL connection with verifying certificate\n   -t, --notls                    Disable TLS negotiation and force SSL3.0. This\n                                        should only be used for devices that do not\n                                        support TLS1.0 and up.\n   -n, --plug=[id]                Physical plug number on device, UUID or\n                                        identification of machine\n   -u, --ipport=[port]            TCP/UDP port to use\n                                        (default 80, 443 if --ssl option is used)\n   -4, --inet4-only               Forces agent to use IPv4 addresses only\n   -6, --inet6-only               Forces agent to use IPv6 addresses only\n   -S, --password-script=[script] Script to run to retrieve password\n   --ssl-secure                   Use SSL connection with verifying certificate\n   --ssl-insecure                 Use SSL connection without verifying certificate\n   -o, --action=[action]          Action: on, off, reboot (default), status, list,\n                                        list-status, monitor, metadata or\n                                        validate-all\n   -q, --quiet                    Disable logging to stderr. Does not affect\n                                        --verbose or --debug logging to syslog.\n   -v, --verbose                  Verbose mode\n   -D, --debug-file=[debugfile]   Debugging to output file\n   -V, --version                  Display version information and exit\n   -h, --help                     Display this help and exit\n   -C, --separator=[char]         Separator for CSV created by 'list' operation\n   --power-timeout=[seconds]      Test X seconds for status change after ON/OFF\n   --shell-timeout=[seconds]      Wait X seconds for cmd prompt after issuing command\n   --login-timeout=[seconds]      Wait X seconds for cmd prompt after login\n   --power-wait=[seconds]         Wait X seconds after issuing ON/OFF\n   --delay=[seconds]              Wait X seconds before fencing is started\n   --retry-on=[attempts]          Count of attempts to retry power on\n   --gnutlscli-path=[path]        Path to gnutls-cli binary\n\n\n\u30e1\u30bf\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\n\u5b9f\u969b\u306bPacemaker\u3067\u5229\u7528\u3059\u308b\u5834\u5408\u306b\u8a2d\u5b9a\u3059\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u306a\u3069\u304c\u78ba\u8a8d\u51fa\u6765\u307e\u3059\u3002\n[rh73-01]# stonith_admin -M -a fence_vmware_soap\n<resource-agent name=\"fence_vmware_soap\" shortdesc=\"Fence agent for VMWare over SOAP API\">\n  <longdesc>\n    fence_vmware_soap is an I/O Fencing agent which can be used with the virtual machines managed by VMWare products that have SOAP API v4.1+. \n.P\nName of virtual machine (-n / port) has to be used in inventory path format (e.g. /datacenter/vm/Discovered virtual machine/myMachine). In the cases when name of yours VM is unique you can use it instead. Alternatively you can always use UUID to access virtual machine.\n  </longdesc>\n  <vendor-url>\n    http://www.vmware.com\n  </vendor-url>\n  <parameters>\n    <parameter name=\"action\" unique=\"0\" required=\"1\">\n      <getopt mixed=\"-o, --action=[action]\"/>\n      <content type=\"string\" default=\"reboot\"/>\n      <shortdesc lang=\"en\">\n        Fencing action\n      </shortdesc>\n    </parameter>\n    <parameter name=\"inet4_only\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-4, --inet4-only\"/>\n      <content type=\"boolean\"/>\n      <shortdesc lang=\"en\">\n        Forces agent to use IPv4 addresses only\n      </shortdesc>\n    </parameter>\n    <parameter name=\"inet6_only\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-6, --inet6-only\"/>\n      <content type=\"boolean\"/>\n      <shortdesc lang=\"en\">\n        Forces agent to use IPv6 addresses only\n      </shortdesc>\n    </parameter>\n    <parameter name=\"ipaddr\" unique=\"0\" required=\"1\">\n      <getopt mixed=\"-a, --ip=[ip]\"/>\n      <content type=\"string\"/>\n      <shortdesc lang=\"en\">\n        IP address or hostname of fencing device\n      </shortdesc>\n    </parameter>\n    <parameter name=\"ipport\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-u, --ipport=[port]\"/>\n      <content type=\"integer\" default=\"80\"/>\n      <shortdesc lang=\"en\">\n        TCP/UDP port to use for connection with device\n      </shortdesc>\n    </parameter>\n    <parameter name=\"login\" unique=\"0\" required=\"1\">\n      <getopt mixed=\"-l, --username=[name]\"/>\n      <content type=\"string\"/>\n      <shortdesc lang=\"en\">\n        Login name\n      </shortdesc>\n    </parameter>\n    <parameter name=\"notls\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-t, --notls\"/>\n      <content type=\"boolean\"/>\n      <shortdesc lang=\"en\">\n        Disable TLS negotiation and force SSL3.0. This should only be used for devices that do not support TLS1.0 and up.\n      </shortdesc>\n    </parameter>\n    <parameter name=\"passwd\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-p, --password=[password]\"/>\n      <content type=\"string\"/>\n      <shortdesc lang=\"en\">\n        Login password or passphrase\n      </shortdesc>\n    </parameter>\n    <parameter name=\"passwd_script\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-S, --password-script=[script]\"/>\n      <content type=\"string\"/>\n      <shortdesc lang=\"en\">\n        Script to run to retrieve password\n      </shortdesc>\n    </parameter>\n    <parameter name=\"port\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-n, --plug=[id]\"/>\n      <content type=\"string\"/>\n      <shortdesc lang=\"en\">\n        Physical plug number on device, UUID or identification of machine\n      </shortdesc>\n    </parameter>\n    <parameter name=\"ssl\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-z, --ssl\"/>\n      <content type=\"boolean\"/>\n      <shortdesc lang=\"en\">\n        Use SSL connection with verifying certificate\n      </shortdesc>\n    </parameter>\n    <parameter name=\"ssl_insecure\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"--ssl-insecure\"/>\n      <content type=\"boolean\"/>\n      <shortdesc lang=\"en\">\n        Use SSL connection without verifying certificate\n      </shortdesc>\n    </parameter>\n    <parameter name=\"ssl_secure\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"--ssl-secure\"/>\n      <content type=\"boolean\"/>\n      <shortdesc lang=\"en\">\n        Use SSL connection with verifying certificate\n      </shortdesc>\n    </parameter>\n    <parameter name=\"quiet\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-q, --quiet\"/>\n      <content type=\"boolean\"/>\n      <shortdesc lang=\"en\">\n        Disable logging to stderr. Does not affect --verbose or --debug logging to syslog.\n      </shortdesc>\n    </parameter>\n    <parameter name=\"verbose\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-v, --verbose\"/>\n      <content type=\"boolean\"/>\n      <shortdesc lang=\"en\">\n        Verbose mode\n      </shortdesc>\n    </parameter>\n    <parameter name=\"debug\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-D, --debug-file=[debugfile]\"/>\n      <content type=\"string\"/>\n      <shortdesc lang=\"en\">\n        Write debug information to given file\n      </shortdesc>\n    </parameter>\n    <parameter name=\"version\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-V, --version\"/>\n      <content type=\"boolean\"/>\n      <shortdesc lang=\"en\">\n        Display version information and exit\n      </shortdesc>\n    </parameter>\n    <parameter name=\"help\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-h, --help\"/>\n      <content type=\"boolean\"/>\n      <shortdesc lang=\"en\">\n        Display help and exit\n      </shortdesc>\n    </parameter>\n    <parameter name=\"separator\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-C, --separator=[char]\"/>\n      <content type=\"string\" default=\",\"/>\n      <shortdesc lang=\"en\">\n        Separator for CSV created by 'list' operation\n      </shortdesc>\n    </parameter>\n    <parameter name=\"delay\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"--delay=[seconds]\"/>\n      <content type=\"second\" default=\"0\"/>\n      <shortdesc lang=\"en\">\n        Wait X seconds before fencing is started\n      </shortdesc>\n    </parameter>\n    <parameter name=\"login_timeout\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"--login-timeout=[seconds]\"/>\n      <content type=\"second\" default=\"5\"/>\n      <shortdesc lang=\"en\">\n        Wait X seconds for cmd prompt after login\n      </shortdesc>\n    </parameter>\n    <parameter name=\"power_timeout\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"--power-timeout=[seconds]\"/>\n      <content type=\"second\" default=\"20\"/>\n      <shortdesc lang=\"en\">\n        Test X seconds for status change after ON/OFF\n      </shortdesc>\n    </parameter>\n    <parameter name=\"power_wait\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"--power-wait=[seconds]\"/>\n      <content type=\"second\" default=\"0\"/>\n      <shortdesc lang=\"en\">\n        Wait X seconds after issuing ON/OFF\n      </shortdesc>\n    </parameter>\n    <parameter name=\"shell_timeout\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"--shell-timeout=[seconds]\"/>\n      <content type=\"second\" default=\"3\"/>\n      <shortdesc lang=\"en\">\n        Wait X seconds for cmd prompt after issuing command\n      </shortdesc>\n    </parameter>\n    <parameter name=\"retry_on\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"--retry-on=[attempts]\"/>\n      <content type=\"integer\" default=\"1\"/>\n      <shortdesc lang=\"en\">\n        Count of attempts to retry power on\n      </shortdesc>\n    </parameter>\n    <parameter name=\"gnutlscli_path\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"--gnutlscli-path=[path]\"/>\n      <content type=\"string\" default=\"/usr/bin/gnutls-cli\"/>\n      <shortdesc lang=\"en\">\n        Path to gnutls-cli binary\n      </shortdesc>\n    </parameter>\n  </parameters>\n  <actions>\n    <action name=\"on\" automatic=\"0\"/>\n    <action name=\"off\"/>\n    <action name=\"reboot\"/>\n    <action name=\"status\"/>\n    <action name=\"list\"/>\n    <action name=\"list-status\"/>\n    <action name=\"monitor\"/>\n    <action name=\"metadata\"/>\n    <action name=\"validate-all\"/>\n    <action name=\"stop\" timeout=\"20s\"/>\n    <action name=\"start\" timeout=\"20s\"/>\n  </actions>\n</resource-agent>\n\n\u4ee5\u4e0a\u3067\u3059\u3002\nfence_agent\u306b\u542b\u307e\u308c\u308bfence_vmare_soap\u3067\u306fESXi5\u3078\u306e\u63a5\u7d9a\u306f\u3069\u3046\u306a\u306e\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nESX\u306f\u3001\u5c11\u3057\u524d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306e5.5\u7cfb\u3067\u3059\u3002\n\nfence_vmare_soap\u3067\u306f\u3001external/libvirt\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u3068\u7570\u306a\u308a\u3001\u63a5\u7d9a\u5148\u6307\u5b9a(esx/vpx\u6307\u5b9a\u306b\u3088\u308bESXi\u63a5\u7d9a\u304b\u3001vCenter\u63a5\u7d9a\u304b\u306e\u533a\u5225)\u304c\u4e0d\u8981\u306a\u306e\u304c\u4fbf\u5229\u3067\u3059\u304c\u3001\u82e5\u5e72\u3001soap\u51e6\u7406\u306b\u6642\u9593\u304c\u304b\u304b\u308b\u3088\u3046\u3067\u3001external/libvirt\u3088\u308a\u306f\u52d5\u4f5c\u304c\u9045\u3044\u3088\u3046\u3067\u3059\u3002\n\u307e\u305f\u3001/etc/libvirt/auth.conf\u306e\u7de8\u96c6\u3082\u4e0d\u8981\u3067\u3059\u3002\n\n# \u74b0\u5883\n * vCenter : xxx.xxx.xx.62\n * ESXi5 : xxx.xxx.xx.33\n  * \u5b9f\u969b\u306b\u306f\u3001vCenter\u914d\u4e0b\u306b\u3053\u306e\u4ed6\u306b\uff12\u53f0\u306eESXi5\u30b5\u30fc\u30d0\u304c\u5b58\u5728\u3057\u3001HA\u69cb\u6210\u3092\u53d6\u3063\u3066\u3044\u307e\u3059\u3002\n * RHEL7.3 : rh73-01 - \u63a5\u7d9a\u5148\u306eESXi5\u5185\u306e\u30b2\u30b9\u30c8\n * fence_agent 4.0.25\n\n# \u5185\u5bb9\n\u3068\u308a\u3042\u3048\u305a\u3001RHEL7\u7cfb\u3067\u5229\u7528\u3059\u308b\u5834\u5408\u3001insecure\u6307\u5b9a\u304c\u5fc5\u8981\u306a\u3088\u3046\u3067\u3059\u3002\n\u4e0b\u8a18\u306e\u4f8b\u3067\u306f\u30e6\u30fc\u30b6\u540d\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067\u306e\u78ba\u8a8d\u3067\u3059\u306e\u3067\u3001\u30d9\u30bf\u3067\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u304c\u5b9f\u969b\u306bPacemaker\u306bStonith\u30ea\u30bd\u30fc\u30b9\u3068\u3057\u3066\u53d6\u308a\u8fbc\u3080\u5834\u5408\u306a\u3069\u306f\u3001cibsecret\u306b\u3088\u308b\u30de\u30b9\u30af\u5316\u306e\u5229\u7528\u304c\u5fc5\u8981\u3068\u601d\u3044\u307e\u3059\u3002\n\n## \u30ea\u30b9\u30c8\u53d6\u5f97\nESXi5\u30db\u30b9\u30c8\u306e\u30b2\u30b9\u30c8\u306e\u30ea\u30b9\u30c8\u3092\u53d6\u5f97\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\n[rh73-01]# fence_vmware_soap -o list -a \"xxx.xxx.xx.33\" -l \"userid\" -p \"password\" -z --ssl-insecure\n(snip)\nweb-srv,564dac69-59b8-7967-7617-c29a6cfbfd2c\nrh73-01,564d7267-8fad-56e9-609d-ae8f13c3d44f\ndb01-srv,564d550f-2fa4-7227-2377-f2a64076caaa\n```\n\u3000\n\u63a5\u7d9a\u5148\u306bvCenter\u3092\u6307\u5b9a\u3057\u3066\u3001vCenter\u914d\u4e0b\u306eESXi\u30db\u30b9\u30c8\u306e\u30b2\u30b9\u30c8\u306e\u30ea\u30b9\u30c8\u3092\u53d6\u5f97\u3057\u3066\u307f\u307e\u3059\u3002\nlibvirt\u5229\u7528\u3067\u306f\u3001vpx\u6307\u5b9a\u304c\u5fc5\u8981\u3067\u3057\u305f\u304c\u3001\u30e6\u30fc\u30b6\u540d\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u304cvCenter\u3067\u5171\u901a\u3067\u3042\u308c\u3070\u3001ip\u30a2\u30c9\u30ec\u30b9\u3092vCenter\u306b\u5909\u66f4\u3059\u308b\u3060\u3051\u3067\u3001\u53d6\u5f97\u304c\u53ef\u80fd\u3067\u3059\u3002\n\u5168\u3066\u306eESXi\u30db\u30b9\u30c8\u306b\u914d\u7f6e\u3055\u308c\u305f\u30b2\u30b9\u30c8\u306e\u30ea\u30b9\u30c8\u304c\u53d6\u5f97\u51fa\u6765\u307e\u3059\u3002\n\n```\n[rh73-01]# fence_vmware_soap -o list -a \"xxx.xxx.xx.62\" -l \"userid\" -p \"password\" -z --ssl-insecure\n(snip)\nweb-srv,564dac69-59b8-7967-7617-c29a6cfbfd2c\nrh73-01,564d7267-8fad-56e9-609d-ae8f13c3d44f\ndb01-srv,564d550f-2fa4-7227-2377-f2a64076caaa\n(snip)\nap02-srv,564d7267-8fad-56e9-609d-1e8f13c3d44f\ndb02-srv,564d550f-2fa4-7227-2377-32a64076caaa\n\n```\n\n## \u30b2\u30b9\u30c8\u306e\u72b6\u614b\u53d6\u5f97\nn\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u5bfe\u8c61\u30b2\u30b9\u30c8\u3092\u6307\u5b9a\u3057\u307e\u3059\u304c\u3001\u30b2\u30b9\u30c8\u540d\u6307\u5b9a\u3068UUID\u6307\u5b9a\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n```\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.33\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nStatus: OFF\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.33\" -l \"userid\" -p \"password\" -z --ssl-insecure -n 564dac69-59b8-7967-7617-c29a6cfbfd2c\nStatus: OFF\n```\n\n\u63a5\u7d9a\u5148\u306bvCenter\u30b5\u30fc\u30d0\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u306b\u3082\u540c\u69d8\u306b\u72b6\u614b\u53d6\u5f97\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n```\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.62\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nStatus: OFF\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.62\" -l \"userid\" -p \"password\" -z --ssl-insecure -n 564dac69-59b8-7967-7617-c29a6cfbfd2c\nStatus: OFF\n```\n\n## \u30b2\u30b9\u30c8\u306e\u96fb\u6e90OFF\nStonith\u3092\u60f3\u5b9a\u3057\u3066\u3001\u30b2\u30b9\u30c8\u306e\u96fb\u6e90\u3092\u843d\u3068\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.33\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nStatus: ON\n[rh73-01]# fence_vmware_soap -o off -a \"xxx.xxx.xx.33\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nSuccess: Powered OFF\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.33\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nStatus: OFF\n```\n\n\u63a5\u7d9a\u5148\u306bvCenter\u30b5\u30fc\u30d0\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u306b\u3082\u540c\u69d8\u306b\u96fb\u6e90OFF\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n```\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.62\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nStatus: ON\n[rh73-01]# fence_vmware_soap -o off -a \"xxx.xxx.xx.62\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nSuccess: Powered OFF\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.62\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nStatus: OFF\n```\n\n## \u30b2\u30b9\u30c8\u306e\u96fb\u6e90on\nStonith\u3092\u60f3\u5b9a\u3057\u3066\u3001\u30b2\u30b9\u30c8\u306e\u96fb\u6e90\u3092\u5165\u308c\u3066\u307f\u307e\u3059\u3002\n\n```\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.33\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nStatus: OFF\n[rh73-01]# fence_vmware_soap -o on -a \"xxx.xxx.xx.33\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nSuccess: Powered ON\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.33\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nStatus: ON\n```\n\n\u63a5\u7d9a\u5148\u306bvCenter\u30b5\u30fc\u30d0\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u306b\u3082\u540c\u69d8\u306b\u96fb\u6e90ON\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n```\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.62\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nStatus: OFF\n[rh73-01]# fence_vmware_soap -o on -a \"xxx.xxx.xx.62\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nSuccess: Powered ON\n[rh73-01]# fence_vmware_soap -o status -a \"xxx.xxx.xx.62\" -l \"userid\" -p \"password\" -z --ssl-insecure -n web-srv\nStatus: ON\n```\n\n# \u305d\u306e\u4ed6\n## \u30d8\u30eb\u30d7\n\n```\n[rh73-01]# fence_vmware_soap --help\nUsage:\n        fence_vmware_soap [options]\nOptions:\n   -a, --ip=[ip]                  IP address or hostname of fencing device\n   -l, --username=[name]          Login name\n   -p, --password=[password]      Login password or passphrase\n   -z, --ssl                      Use SSL connection with verifying certificate\n   -t, --notls                    Disable TLS negotiation and force SSL3.0. This\n                                        should only be used for devices that do not\n                                        support TLS1.0 and up.\n   -n, --plug=[id]                Physical plug number on device, UUID or\n                                        identification of machine\n   -u, --ipport=[port]            TCP/UDP port to use\n                                        (default 80, 443 if --ssl option is used)\n   -4, --inet4-only               Forces agent to use IPv4 addresses only\n   -6, --inet6-only               Forces agent to use IPv6 addresses only\n   -S, --password-script=[script] Script to run to retrieve password\n   --ssl-secure                   Use SSL connection with verifying certificate\n   --ssl-insecure                 Use SSL connection without verifying certificate\n   -o, --action=[action]          Action: on, off, reboot (default), status, list,\n                                        list-status, monitor, metadata or\n                                        validate-all\n   -q, --quiet                    Disable logging to stderr. Does not affect\n                                        --verbose or --debug logging to syslog.\n   -v, --verbose                  Verbose mode\n   -D, --debug-file=[debugfile]   Debugging to output file\n   -V, --version                  Display version information and exit\n   -h, --help                     Display this help and exit\n   -C, --separator=[char]         Separator for CSV created by 'list' operation\n   --power-timeout=[seconds]      Test X seconds for status change after ON/OFF\n   --shell-timeout=[seconds]      Wait X seconds for cmd prompt after issuing command\n   --login-timeout=[seconds]      Wait X seconds for cmd prompt after login\n   --power-wait=[seconds]         Wait X seconds after issuing ON/OFF\n   --delay=[seconds]              Wait X seconds before fencing is started\n   --retry-on=[attempts]          Count of attempts to retry power on\n   --gnutlscli-path=[path]        Path to gnutls-cli binary\n```\n\n## \u30e1\u30bf\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\n\u5b9f\u969b\u306bPacemaker\u3067\u5229\u7528\u3059\u308b\u5834\u5408\u306b\u8a2d\u5b9a\u3059\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u306a\u3069\u304c\u78ba\u8a8d\u51fa\u6765\u307e\u3059\u3002\n\n```\n[rh73-01]# stonith_admin -M -a fence_vmware_soap\n<resource-agent name=\"fence_vmware_soap\" shortdesc=\"Fence agent for VMWare over SOAP API\">\n  <longdesc>\n    fence_vmware_soap is an I/O Fencing agent which can be used with the virtual machines managed by VMWare products that have SOAP API v4.1+. \n.P\nName of virtual machine (-n / port) has to be used in inventory path format (e.g. /datacenter/vm/Discovered virtual machine/myMachine). In the cases when name of yours VM is unique you can use it instead. Alternatively you can always use UUID to access virtual machine.\n  </longdesc>\n  <vendor-url>\n    http://www.vmware.com\n  </vendor-url>\n  <parameters>\n    <parameter name=\"action\" unique=\"0\" required=\"1\">\n      <getopt mixed=\"-o, --action=[action]\"/>\n      <content type=\"string\" default=\"reboot\"/>\n      <shortdesc lang=\"en\">\n        Fencing action\n      </shortdesc>\n    </parameter>\n    <parameter name=\"inet4_only\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-4, --inet4-only\"/>\n      <content type=\"boolean\"/>\n      <shortdesc lang=\"en\">\n        Forces agent to use IPv4 addresses only\n      </shortdesc>\n    </parameter>\n    <parameter name=\"inet6_only\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-6, --inet6-only\"/>\n      <content type=\"boolean\"/>\n      <shortdesc lang=\"en\">\n        Forces agent to use IPv6 addresses only\n      </shortdesc>\n    </parameter>\n    <parameter name=\"ipaddr\" unique=\"0\" required=\"1\">\n      <getopt mixed=\"-a, --ip=[ip]\"/>\n      <content type=\"string\"/>\n      <shortdesc lang=\"en\">\n        IP address or hostname of fencing device\n      </shortdesc>\n    </parameter>\n    <parameter name=\"ipport\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-u, --ipport=[port]\"/>\n      <content type=\"integer\" default=\"80\"/>\n      <shortdesc lang=\"en\">\n        TCP/UDP port to use for connection with device\n      </shortdesc>\n    </parameter>\n    <parameter name=\"login\" unique=\"0\" required=\"1\">\n      <getopt mixed=\"-l, --username=[name]\"/>\n      <content type=\"string\"/>\n      <shortdesc lang=\"en\">\n        Login name\n      </shortdesc>\n    </parameter>\n    <parameter name=\"notls\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-t, --notls\"/>\n      <content type=\"boolean\"/>\n      <shortdesc lang=\"en\">\n        Disable TLS negotiation and force SSL3.0. This should only be used for devices that do not support TLS1.0 and up.\n      </shortdesc>\n    </parameter>\n    <parameter name=\"passwd\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-p, --password=[password]\"/>\n      <content type=\"string\"/>\n      <shortdesc lang=\"en\">\n        Login password or passphrase\n      </shortdesc>\n    </parameter>\n    <parameter name=\"passwd_script\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-S, --password-script=[script]\"/>\n      <content type=\"string\"/>\n      <shortdesc lang=\"en\">\n        Script to run to retrieve password\n      </shortdesc>\n    </parameter>\n    <parameter name=\"port\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-n, --plug=[id]\"/>\n      <content type=\"string\"/>\n      <shortdesc lang=\"en\">\n        Physical plug number on device, UUID or identification of machine\n      </shortdesc>\n    </parameter>\n    <parameter name=\"ssl\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-z, --ssl\"/>\n      <content type=\"boolean\"/>\n      <shortdesc lang=\"en\">\n        Use SSL connection with verifying certificate\n      </shortdesc>\n    </parameter>\n    <parameter name=\"ssl_insecure\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"--ssl-insecure\"/>\n      <content type=\"boolean\"/>\n      <shortdesc lang=\"en\">\n        Use SSL connection without verifying certificate\n      </shortdesc>\n    </parameter>\n    <parameter name=\"ssl_secure\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"--ssl-secure\"/>\n      <content type=\"boolean\"/>\n      <shortdesc lang=\"en\">\n        Use SSL connection with verifying certificate\n      </shortdesc>\n    </parameter>\n    <parameter name=\"quiet\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-q, --quiet\"/>\n      <content type=\"boolean\"/>\n      <shortdesc lang=\"en\">\n        Disable logging to stderr. Does not affect --verbose or --debug logging to syslog.\n      </shortdesc>\n    </parameter>\n    <parameter name=\"verbose\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-v, --verbose\"/>\n      <content type=\"boolean\"/>\n      <shortdesc lang=\"en\">\n        Verbose mode\n      </shortdesc>\n    </parameter>\n    <parameter name=\"debug\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-D, --debug-file=[debugfile]\"/>\n      <content type=\"string\"/>\n      <shortdesc lang=\"en\">\n        Write debug information to given file\n      </shortdesc>\n    </parameter>\n    <parameter name=\"version\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-V, --version\"/>\n      <content type=\"boolean\"/>\n      <shortdesc lang=\"en\">\n        Display version information and exit\n      </shortdesc>\n    </parameter>\n    <parameter name=\"help\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-h, --help\"/>\n      <content type=\"boolean\"/>\n      <shortdesc lang=\"en\">\n        Display help and exit\n      </shortdesc>\n    </parameter>\n    <parameter name=\"separator\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"-C, --separator=[char]\"/>\n      <content type=\"string\" default=\",\"/>\n      <shortdesc lang=\"en\">\n        Separator for CSV created by 'list' operation\n      </shortdesc>\n    </parameter>\n    <parameter name=\"delay\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"--delay=[seconds]\"/>\n      <content type=\"second\" default=\"0\"/>\n      <shortdesc lang=\"en\">\n        Wait X seconds before fencing is started\n      </shortdesc>\n    </parameter>\n    <parameter name=\"login_timeout\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"--login-timeout=[seconds]\"/>\n      <content type=\"second\" default=\"5\"/>\n      <shortdesc lang=\"en\">\n        Wait X seconds for cmd prompt after login\n      </shortdesc>\n    </parameter>\n    <parameter name=\"power_timeout\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"--power-timeout=[seconds]\"/>\n      <content type=\"second\" default=\"20\"/>\n      <shortdesc lang=\"en\">\n        Test X seconds for status change after ON/OFF\n      </shortdesc>\n    </parameter>\n    <parameter name=\"power_wait\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"--power-wait=[seconds]\"/>\n      <content type=\"second\" default=\"0\"/>\n      <shortdesc lang=\"en\">\n        Wait X seconds after issuing ON/OFF\n      </shortdesc>\n    </parameter>\n    <parameter name=\"shell_timeout\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"--shell-timeout=[seconds]\"/>\n      <content type=\"second\" default=\"3\"/>\n      <shortdesc lang=\"en\">\n        Wait X seconds for cmd prompt after issuing command\n      </shortdesc>\n    </parameter>\n    <parameter name=\"retry_on\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"--retry-on=[attempts]\"/>\n      <content type=\"integer\" default=\"1\"/>\n      <shortdesc lang=\"en\">\n        Count of attempts to retry power on\n      </shortdesc>\n    </parameter>\n    <parameter name=\"gnutlscli_path\" unique=\"0\" required=\"0\">\n      <getopt mixed=\"--gnutlscli-path=[path]\"/>\n      <content type=\"string\" default=\"/usr/bin/gnutls-cli\"/>\n      <shortdesc lang=\"en\">\n        Path to gnutls-cli binary\n      </shortdesc>\n    </parameter>\n  </parameters>\n  <actions>\n    <action name=\"on\" automatic=\"0\"/>\n    <action name=\"off\"/>\n    <action name=\"reboot\"/>\n    <action name=\"status\"/>\n    <action name=\"list\"/>\n    <action name=\"list-status\"/>\n    <action name=\"monitor\"/>\n    <action name=\"metadata\"/>\n    <action name=\"validate-all\"/>\n    <action name=\"stop\" timeout=\"20s\"/>\n    <action name=\"start\" timeout=\"20s\"/>\n  </actions>\n</resource-agent>\n```\n\n\u4ee5\u4e0a\u3067\u3059\u3002\n"}