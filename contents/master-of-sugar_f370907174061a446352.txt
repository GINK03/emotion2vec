{"context": "\u3072\u3068\u307e\u305a\u30e1\u30e2\u7684\u306b\u3002\n\n\u524d\u63d0\n\u4ee5\u4e0b\u304c\u5b8c\u4e86\u3057\u3066\u3044\u308b\n\n\u3068\u306b\u304b\u304f\u3059\u3070\u3084\u304fEC2\u74b0\u5883\u3092\u4f5c\u308b\u30e1\u30e2\n\u3068\u306b\u304b\u304f\u3059\u3070\u3084\u304fEC2\u306bNodejs\u3092\u3044\u308c\u308b\u30e1\u30e2\n\n\nGit\u3092\u3044\u308c\u308b\nsudo yum -y install git\n\n\nRuby\u3092\u3044\u308c\u308b\u305f\u3081\u306e\u8272\u3005\nyum \u3067\u3069\u30fc\u30fc\u3093\u3002\nsudo yum -y install gcc-c++ glibc-headers openssl-devel readline libyaml-devel readline-devel zlib zlib-devel libffi-devel libxml2 libxslt libxml2-devel libxslt-devel sqlite-devel mysql mysql-server mysql-devel ImageMagick ImageMagick-devel epel-release\n\n\nrbenv\u3092\u3044\u308c\u308b\ngit clone https://github.com/sstephenson/rbenv.git ~/.rbenv\necho 'export PATH=\"$HOME/.rbenv/bin:$PATH\"' >> ~/.bash_profile\necho 'eval \"$(rbenv init -)\"' >> ~/.bash_profile\nsource .bash_profile\n\ngit clone https://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build\nrbenv rehash\n\nrbenv install -v 2.2.4\nrbenv global 2.2.4\nrbenv rehash\n\nruby -v\n\ngem install bundler\n\n\n\ndirectory\u3092\u6398\u308b\ncd /\nsudo chown [user] var\ncd var\nsudo mkdir www\ncd www\nsudo mkdir rails\n\n\u30ed\u30b0\u7528\nmkdir /var/www/rails/shared\nmkdir /var/www/rails/shared/log\n\n\nunicorn\u3092\u3044\u308c\u308b\ngroup :production, :staging do\n  gem 'unicorn'\nend\n\n\nunicorn.conf.rb\n# set lets\n$worker  = 2\n$timeout = 30\n$app_dir = '/var/www/rails/[project]' \n$listen  = File.expand_path '/tmp/unicorn.sock', $app_dir\n$pid     = File.expand_path '/var/www/rails/shared/tmp/pids/unicorn.pid', $app_dir\n$std_log = File.expand_path '/var/www/rails/shared/log/unicorn.log', $app_dir\n# set config\nworker_processes  $worker\nworking_directory $app_dir\nstderr_path $std_log\nstdout_path $std_log\ntimeout $timeout\nlisten  $listen\npid $pid\n# loading booster\npreload_app true\n# before starting processes\nbefore_fork do |server, worker|\n  defined?(ActiveRecord::Base) and ActiveRecord::Base.connection.disconnect!\n  old_pid = \"#{server.config[:pid]}.oldbin\"\n  if old_pid != server.pid\n    begin\n      Process.kill :QUIT, File.read(old_pid).to_i\n    rescue Errno::ENOENT, Errno::ESRCH\n    end\n  end\nend\n# after finishing processes\nafter_fork do |server, worker|\n  defined?(ActiveRecord::Base) and ActiveRecord::Base.establish_connection\nend\n\n\n\n\nMySql\u8a2d\u5b9a\nsudo vi /etc/my.cnf\n\n\u4ee5\u4e0b\u3092\u8ffd\u8a18\ncharacter-set-server=utf8\n\n\u8d77\u52d5\nsudo service mysqld start\n\nln -s /var/lib/mysql/mysql.sock /tmp/mysql.sock\n\n\nnginx\u3092\u3044\u308c\u308b\nsudo yum install nginx\n\nsudo vi /etc/nginx/conf.d/[project].conf\n\n# log directory\nerror_log  /var/www/rails/shared/log/nginx.error.log; \naccess_log /var/www/rails/shared/log/nginx.access.log; \n\n# max body size\nclient_max_body_size 2G;\nupstream app_server {\n  # for UNIX domain socket setups\n  server unix:/tmp/unicorn.sock fail_timeout=0; \n}\nserver {\n  listen 80;\n  server_name 52.197.122.210;\n  # nginx so increasing this is generally safe...\n  keepalive_timeout 5;\n  # path for static files\n  root /var/www/rails/[project]/public; \n  # page cache loading\n  try_files $uri/index.html $uri.html $uri @app;\n  location @app {\n    # HTTP headers\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header Host $http_host;\n    proxy_redirect off;\n    proxy_pass http://app_server;\n  }\n  # Rails error pages\n  error_page 500 502 503 504 /500.html;\n  location = /500.html {\n    root /var/www/rails/[project]/public; \n  }\n}\n\n\nGithub\nGithub\u306eDeploy Keys\u3092\u767b\u9332\u3057\u3066\u30d1\u30b9\u30ef\u30fc\u30c9\u306a\u3057\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3092\u3084\u308b\u3002\ncd ~\ngit clone git@github.com:yourrepo/[project].git \ncd [project]\n\nbundle install \nnpm install\n\n\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\nln -s ~/[project] /var/www/rails/[project] \n\n\n\u8d77\u52d5\nunicorn\u8d77\u52d5\nunicorn_rails -c /var/www/rails/[project]/config/unicorn.conf.rb -D -E staging\n\nnginx\u8d77\u52d5\nsudo service nginx start\n\n\n\u307e\u3068\u3081\n\n\u5730\u5473\u306b\u3084\u308b\u3053\u3068\u304c\u591a\u3044\n\u81ea\u52d5\u5316\u3057\u305f\u3044\n\u6bb4\u308a\u66f8\u304d\u306a\u306e\u3067\u3061\u3083\u3093\u3068\u307e\u3068\u3081\u305f\u3044\n\n\u4ee5\u4e0a\u3002\n\n\u3072\u3068\u307e\u305a\u30e1\u30e2\u7684\u306b\u3002\n\n\u524d\u63d0\n-------\n\u4ee5\u4e0b\u304c\u5b8c\u4e86\u3057\u3066\u3044\u308b\n\n - [\u3068\u306b\u304b\u304f\u3059\u3070\u3084\u304fEC2\u74b0\u5883\u3092\u4f5c\u308b\u30e1\u30e2](http://qiita.com/master-of-sugar/items/18fd684fa3938cdfe930)\n - [\u3068\u306b\u304b\u304f\u3059\u3070\u3084\u304fEC2\u306bNodejs\u3092\u3044\u308c\u308b\u30e1\u30e2](http://qiita.com/master-of-sugar/items/5bad195c9dda91c5eab1)\n\n\n\nGit\u3092\u3044\u308c\u308b\n------\n```\nsudo yum -y install git\n```\n\n\nRuby\u3092\u3044\u308c\u308b\u305f\u3081\u306e\u8272\u3005\n------\n\n`yum` \u3067\u3069\u30fc\u30fc\u3093\u3002\n\n```\nsudo yum -y install gcc-c++ glibc-headers openssl-devel readline libyaml-devel readline-devel zlib zlib-devel libffi-devel libxml2 libxslt libxml2-devel libxslt-devel sqlite-devel mysql mysql-server mysql-devel ImageMagick ImageMagick-devel epel-release\n```\n\nrbenv\u3092\u3044\u308c\u308b\n-----\n\n```\ngit clone https://github.com/sstephenson/rbenv.git ~/.rbenv\necho 'export PATH=\"$HOME/.rbenv/bin:$PATH\"' >> ~/.bash_profile\necho 'eval \"$(rbenv init -)\"' >> ~/.bash_profile\nsource .bash_profile\n\ngit clone https://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build\nrbenv rehash\n\nrbenv install -v 2.2.4\nrbenv global 2.2.4\nrbenv rehash\n\nruby -v\n\ngem install bundler\n\n```\n\n\ndirectory\u3092\u6398\u308b\n-----\n\n```\ncd /\nsudo chown [user] var\ncd var\nsudo mkdir www\ncd www\nsudo mkdir rails\n```\n\n\u30ed\u30b0\u7528\n\n```\nmkdir /var/www/rails/shared\nmkdir /var/www/rails/shared/log\n```\n\n\nunicorn\u3092\u3044\u308c\u308b\n------\n\n```Gemfile\ngroup :production, :staging do\n  gem 'unicorn'\nend\n```\n\n```unicorn.conf.rb\n# set lets\n$worker  = 2\n$timeout = 30\n$app_dir = '/var/www/rails/[project]' \n$listen  = File.expand_path '/tmp/unicorn.sock', $app_dir\n$pid     = File.expand_path '/var/www/rails/shared/tmp/pids/unicorn.pid', $app_dir\n$std_log = File.expand_path '/var/www/rails/shared/log/unicorn.log', $app_dir\n# set config\nworker_processes  $worker\nworking_directory $app_dir\nstderr_path $std_log\nstdout_path $std_log\ntimeout $timeout\nlisten  $listen\npid $pid\n# loading booster\npreload_app true\n# before starting processes\nbefore_fork do |server, worker|\n  defined?(ActiveRecord::Base) and ActiveRecord::Base.connection.disconnect!\n  old_pid = \"#{server.config[:pid]}.oldbin\"\n  if old_pid != server.pid\n    begin\n      Process.kill :QUIT, File.read(old_pid).to_i\n    rescue Errno::ENOENT, Errno::ESRCH\n    end\n  end\nend\n# after finishing processes\nafter_fork do |server, worker|\n  defined?(ActiveRecord::Base) and ActiveRecord::Base.establish_connection\nend\n\n```\n\n\nMySql\u8a2d\u5b9a\n-----\n\n```\nsudo vi /etc/my.cnf\n```\n\n\n\u4ee5\u4e0b\u3092\u8ffd\u8a18\n\n```\ncharacter-set-server=utf8\n```\n\n\n\u8d77\u52d5\n\n```\nsudo service mysqld start\n\nln -s /var/lib/mysql/mysql.sock /tmp/mysql.sock\n```\n\n\nnginx\u3092\u3044\u308c\u308b\n-----\n\n```\nsudo yum install nginx\n```\n\n```\nsudo vi /etc/nginx/conf.d/[project].conf\n```\n\n```\n# log directory\nerror_log  /var/www/rails/shared/log/nginx.error.log; \naccess_log /var/www/rails/shared/log/nginx.access.log; \n\n# max body size\nclient_max_body_size 2G;\nupstream app_server {\n  # for UNIX domain socket setups\n  server unix:/tmp/unicorn.sock fail_timeout=0; \n}\nserver {\n  listen 80;\n  server_name 52.197.122.210;\n  # nginx so increasing this is generally safe...\n  keepalive_timeout 5;\n  # path for static files\n  root /var/www/rails/[project]/public; \n  # page cache loading\n  try_files $uri/index.html $uri.html $uri @app;\n  location @app {\n    # HTTP headers\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header Host $http_host;\n    proxy_redirect off;\n    proxy_pass http://app_server;\n  }\n  # Rails error pages\n  error_page 500 502 503 504 /500.html;\n  location = /500.html {\n    root /var/www/rails/[project]/public; \n  }\n}\n```\n\n\n\nGithub\n-----\n\n[Github\u306eDeploy Keys\u3092\u767b\u9332\u3057\u3066\u30d1\u30b9\u30ef\u30fc\u30c9\u306a\u3057\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b](http://qiita.com/master-of-sugar/items/a9892879f6e9cb9f3c97)\u3092\u3084\u308b\u3002\n\n```\ncd ~\ngit clone git@github.com:yourrepo/[project].git \ncd [project]\n\nbundle install \nnpm install\n```\n\n\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\n\n```\nln -s ~/[project] /var/www/rails/[project] \n```\n\n\n\u8d77\u52d5\n-----\n\nunicorn\u8d77\u52d5\n\n```\nunicorn_rails -c /var/www/rails/[project]/config/unicorn.conf.rb -D -E staging\n```\n\nnginx\u8d77\u52d5\n\n```\nsudo service nginx start\n```\n\n\u307e\u3068\u3081\n-----\n - \u5730\u5473\u306b\u3084\u308b\u3053\u3068\u304c\u591a\u3044\n - \u81ea\u52d5\u5316\u3057\u305f\u3044\n - \u6bb4\u308a\u66f8\u304d\u306a\u306e\u3067\u3061\u3083\u3093\u3068\u307e\u3068\u3081\u305f\u3044\n\n\u4ee5\u4e0a\u3002\n", "tags": ["MySQL", "Ruby", "React", "Rails", "EC2"]}