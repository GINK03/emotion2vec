{"context": " More than 1 year has passed since last update.\u7121\u8077\u306f\u3058\u3081\u3066\u306e\u672c\u683c\u7684\u306a\u5e73\u65e5\u4e00\u9031\u9593\u3092\u904e\u3054\u3057\u3066\u4f53\u304c\u6163\u308c\u3066\u304d\u305f\u3002\n\n\u76ee\u7684\n\u30d5\u30a9\u30fc\u30e0\u306a\u3069\u306e\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3067\u3001ActiveRecord\u306b\u8a2d\u5b9a\u3057\u305f\u30d0\u30ea\u30c7\u30fc\u30bf\u30fc\u3092\u4f7f\u3044\u305f\u3044\u304cvalid?\u3067\u5168\u90e8\u3084\u3063\u3066\u3057\u307e\u3046\u306e\u306f\u306a\u3093\u3060\u304b\u4e71\u66b4\u306a\u6c17\u304c\u3057\u305f\u306e\u3067\u3001\u5fc5\u8981\u306a\u30ab\u30e9\u30e0\u3060\u3051\u3067\u3084\u308a\u305f\u304b\u3063\u305f\u3002\n\n\u524d\u63d0\u3068\u306a\u308b\u30e2\u30c7\u30eb\nclass Model < ActiveRecord::Base\n  validates :str, :txt, :bol,\n    presence: true\n\n  validate :validate_str\n\n  def validate_str\n    errors.add(:str, :validate_str) if str == '\u5931\u6557\u3059\u308b'\n  end\nend\n\n\n\u30d0\u30ea\u30c7\u30fc\u30bf\u30fc\u3092\u5f97\u308b\nModel.validators\n=> [#<ActiveRecord::Validations::PresenceValidator:0x007fbd8cc96c28 @attributes=[:str, :txt, :bol], @options={}>]\n\nModel._validators\n=> {:str=>[#<ActiveRecord::Validations::PresenceValidator:0x007fbd8cc96c28 @attributes=[:str, :txt, :bol], @options={}>], :txt=>[#<ActiveRecord::Validations::PresenceValidator:0x007fbd8cc96c28 @attributes=\n[:str, :txt, :bol], @options={}>], :bol=>[#<ActiveRecord::Validations::PresenceValidator:0x007fbd8cc96c28 @attributes=[:str, :txt, :bol], @options={}>]}\n\n\u30ab\u30e9\u30e0\u3054\u3068\u306e\u30d0\u30ea\u30c7\u30fc\u30bf\u30fc\u3092\u5229\u7528\u3059\u308b\u306b\u306f_validators\u306e\u65b9\u304c\u53d6\u308a\u56de\u3057\u304c\u826f\u3055\u305d\u3046\u306a\u306e\u3067\u305d\u3063\u3061\u3092\u4f7f\u3046\u3002\n\n\u30d0\u30ea\u30c7\u30fc\u30bf\u30fc\u306e\u4f7f\u3044\u65b9\nvalidator.validate(record)\n\n\u306a\u306e\u3067\u30b4\u30fc\nvalidator = Model._validators[:str].first\n\nmodel = Model.new\nvalidator.validate(model)\nmodel.errors.messages\n=> {:str=>[\"can't be blank\"], :txt=>[\"can't be blank\"], :bol=>[\"can't be blank\"]}\n\nstr\u3060\u3051\u691c\u67fb\u3057\u305f\u3044\u3093\u3060\u3051\u3069\u3001\u8a2d\u5b9a\u6642\u306b\u307e\u3068\u3081\u3066\u308b\u304b\u3089\u4e00\u7dd2\u306b\u3084\u3063\u3066\u304f\u308c\u3066\u3057\u307e\u3046\u3002\u7279\u5b9a\u306e\u30ab\u30e9\u30e0\u3060\u3051\u691c\u67fb\u3057\u305f\u3044\u3068\u3044\u3046\u6b32\u6c42\u306a\u306e\u3067\u3001\u4eca\u56de\u306e\u5834\u5408\u306f\u3046\u308c\u3057\u304f\u306a\u3044\u3002\nActiveRecord::Validations::PresenceValidator\u306e@attributes\u3092\u5897\u6e1b\u3055\u305b\u308b\u3053\u3068\u3067\u5bfe\u79f0\u3092\u7d5e\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u304c\u30013\u30ab\u30e9\u30e0\u3059\u3079\u3066\u540c\u3058ActiveRecord::Validations::PresenceValidator\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u898b\u3066\u3044\u308b\u306e\u3067\u3001\u3088\u304f\u306a\u3044\u3002\n\n\u5358\u4e00\u30ab\u30e9\u30e0\u7528\u30d0\u30ea\u30c7\u30fc\u30bf\u30fc\u3068\u3057\u3066\u8907\u88fd\u3059\u308b\nvalidates\u3067\u4f7f\u308f\u308c\u308bEachValidator\u306e\u521d\u671f\u5316\u306f\u3053\u3046\u306a\u3063\u3066\u3044\u308b\u3002\ndef initialize(options)\n  @attributes = Array(options.delete(:attributes))\n  raise ArgumentError, \":attributes cannot be blank\" if @attributes.empty?\n  super\n  check_validity!\nend\n\n\u306e\u3067\u3001@attributes\u306b\u76ee\u7684\u306e\u30ab\u30e9\u30e0\u306e\u307f\u304c\u5165\u308b\u3088\u3046\u306b\u3057\u3066\u4f5c\u6210\u3057\u306a\u304a\u3059\u3002\nonly_str = validator.class.new(validator.options.merge(attributes: :str))\n=> #<ActiveRecord::Validations::PresenceValidator:0x007f09150060e8 @attributes=[:str], @options={}>\n\nmodel = Model.new\nonly_str.validate(model)\nmodel.errors.messages\n=> {:str=>[\"can't be blank\"]}\n\n\nvalidate\u306e\u306f\u7121\u8996\u3055\u308c\u308b\nmodel = Model.new(str: '\u5931\u6557\u3059\u308b')\nonly_str.validate(model)\nmodel.errors.messages\n=> {}\n\nvalidate\u3067\u4ed8\u4e0e\u3055\u308c\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306f\u3042\u308b\u7a2e\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3067\u3042\u308a\u3001\u30ab\u30e9\u30e0\u306b\u7279\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3053\u306e\u65b9\u6cd5\u3067\u306f\u7121\u8996\u3055\u308c\u308b\u3002\nvalid?\u3067\u4e71\u66b4\u306b\u691c\u67fb\u3092\u3059\u308b\u306e\u3082\u3044\u3044\u304c\u3001\u3053\u308c\u3092\u6a5f\u306bEachValidator\u5316\u3057\u3066\u307f\u3066\u306f\u3044\u304b\u304c\u3067\u3057\u3087\u3046\u304b\u3002\uff08\u4eca\u65e5\u306fslim\u691c\u67fb\u3057\u305f\u304f\u3066mmmpa/slim_validation\u3068\u304b\u4f5c\u3063\u3066\u305f\uff09\n\u7121\u8077\u306f\u3058\u3081\u3066\u306e\u672c\u683c\u7684\u306a\u5e73\u65e5\u4e00\u9031\u9593\u3092\u904e\u3054\u3057\u3066\u4f53\u304c\u6163\u308c\u3066\u304d\u305f\u3002\n\n# \u76ee\u7684\n\n\u30d5\u30a9\u30fc\u30e0\u306a\u3069\u306e\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3067\u3001ActiveRecord\u306b\u8a2d\u5b9a\u3057\u305f\u30d0\u30ea\u30c7\u30fc\u30bf\u30fc\u3092\u4f7f\u3044\u305f\u3044\u304c`valid?`\u3067\u5168\u90e8\u3084\u3063\u3066\u3057\u307e\u3046\u306e\u306f\u306a\u3093\u3060\u304b\u4e71\u66b4\u306a\u6c17\u304c\u3057\u305f\u306e\u3067\u3001\u5fc5\u8981\u306a\u30ab\u30e9\u30e0\u3060\u3051\u3067\u3084\u308a\u305f\u304b\u3063\u305f\u3002\n\n## \u524d\u63d0\u3068\u306a\u308b\u30e2\u30c7\u30eb\n\n```rb\nclass Model < ActiveRecord::Base\n  validates :str, :txt, :bol,\n    presence: true\n\n  validate :validate_str\n\n  def validate_str\n    errors.add(:str, :validate_str) if str == '\u5931\u6557\u3059\u308b'\n  end\nend\n```\n\n# \u30d0\u30ea\u30c7\u30fc\u30bf\u30fc\u3092\u5f97\u308b\n\n```rb\nModel.validators\n=> [#<ActiveRecord::Validations::PresenceValidator:0x007fbd8cc96c28 @attributes=[:str, :txt, :bol], @options={}>]\n```\n\n```rb\nModel._validators\n=> {:str=>[#<ActiveRecord::Validations::PresenceValidator:0x007fbd8cc96c28 @attributes=[:str, :txt, :bol], @options={}>], :txt=>[#<ActiveRecord::Validations::PresenceValidator:0x007fbd8cc96c28 @attributes=\n[:str, :txt, :bol], @options={}>], :bol=>[#<ActiveRecord::Validations::PresenceValidator:0x007fbd8cc96c28 @attributes=[:str, :txt, :bol], @options={}>]}\n```\n\n\u30ab\u30e9\u30e0\u3054\u3068\u306e\u30d0\u30ea\u30c7\u30fc\u30bf\u30fc\u3092\u5229\u7528\u3059\u308b\u306b\u306f`_validators`\u306e\u65b9\u304c\u53d6\u308a\u56de\u3057\u304c\u826f\u3055\u305d\u3046\u306a\u306e\u3067\u305d\u3063\u3061\u3092\u4f7f\u3046\u3002\n\n# \u30d0\u30ea\u30c7\u30fc\u30bf\u30fc\u306e\u4f7f\u3044\u65b9\n\n```rb\nvalidator.validate(record)\n```\n\n\u306a\u306e\u3067\u30b4\u30fc\n\n```rb\nvalidator = Model._validators[:str].first\n\nmodel = Model.new\nvalidator.validate(model)\nmodel.errors.messages\n=> {:str=>[\"can't be blank\"], :txt=>[\"can't be blank\"], :bol=>[\"can't be blank\"]}\n```\n\n`str`\u3060\u3051\u691c\u67fb\u3057\u305f\u3044\u3093\u3060\u3051\u3069\u3001\u8a2d\u5b9a\u6642\u306b\u307e\u3068\u3081\u3066\u308b\u304b\u3089\u4e00\u7dd2\u306b\u3084\u3063\u3066\u304f\u308c\u3066\u3057\u307e\u3046\u3002\u7279\u5b9a\u306e\u30ab\u30e9\u30e0\u3060\u3051\u691c\u67fb\u3057\u305f\u3044\u3068\u3044\u3046\u6b32\u6c42\u306a\u306e\u3067\u3001\u4eca\u56de\u306e\u5834\u5408\u306f\u3046\u308c\u3057\u304f\u306a\u3044\u3002\n\n`ActiveRecord::Validations::PresenceValidator`\u306e`@attributes`\u3092\u5897\u6e1b\u3055\u305b\u308b\u3053\u3068\u3067\u5bfe\u79f0\u3092\u7d5e\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u304c\u30013\u30ab\u30e9\u30e0\u3059\u3079\u3066\u540c\u3058`ActiveRecord::Validations::PresenceValidator`\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u898b\u3066\u3044\u308b\u306e\u3067\u3001\u3088\u304f\u306a\u3044\u3002\n\n# \u5358\u4e00\u30ab\u30e9\u30e0\u7528\u30d0\u30ea\u30c7\u30fc\u30bf\u30fc\u3068\u3057\u3066\u8907\u88fd\u3059\u308b\n\n`validates`\u3067\u4f7f\u308f\u308c\u308b`EachValidator`\u306e\u521d\u671f\u5316\u306f\u3053\u3046\u306a\u3063\u3066\u3044\u308b\u3002\n\n```rb\ndef initialize(options)\n  @attributes = Array(options.delete(:attributes))\n  raise ArgumentError, \":attributes cannot be blank\" if @attributes.empty?\n  super\n  check_validity!\nend\n```\n\n\u306e\u3067\u3001`@attributes`\u306b\u76ee\u7684\u306e\u30ab\u30e9\u30e0\u306e\u307f\u304c\u5165\u308b\u3088\u3046\u306b\u3057\u3066\u4f5c\u6210\u3057\u306a\u304a\u3059\u3002\n\n```rb\nonly_str = validator.class.new(validator.options.merge(attributes: :str))\n=> #<ActiveRecord::Validations::PresenceValidator:0x007f09150060e8 @attributes=[:str], @options={}>\n\nmodel = Model.new\nonly_str.validate(model)\nmodel.errors.messages\n=> {:str=>[\"can't be blank\"]}\n```\n\n# `validate`\u306e\u306f\u7121\u8996\u3055\u308c\u308b\n\n```rb\nmodel = Model.new(str: '\u5931\u6557\u3059\u308b')\nonly_str.validate(model)\nmodel.errors.messages\n=> {}\n```\n\n`validate`\u3067\u4ed8\u4e0e\u3055\u308c\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306f\u3042\u308b\u7a2e\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3067\u3042\u308a\u3001\u30ab\u30e9\u30e0\u306b\u7279\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3053\u306e\u65b9\u6cd5\u3067\u306f\u7121\u8996\u3055\u308c\u308b\u3002\n\n`valid?`\u3067\u4e71\u66b4\u306b\u691c\u67fb\u3092\u3059\u308b\u306e\u3082\u3044\u3044\u304c\u3001\u3053\u308c\u3092\u6a5f\u306b`EachValidator`\u5316\u3057\u3066\u307f\u3066\u306f\u3044\u304b\u304c\u3067\u3057\u3087\u3046\u304b\u3002\uff08\u4eca\u65e5\u306fslim\u691c\u67fb\u3057\u305f\u304f\u3066[mmmpa/slim_validation](https://github.com/mmmpa/slim_validation)\u3068\u304b\u4f5c\u3063\u3066\u305f\uff09\n\n\n", "tags": ["Rails", "ActiveRecord"]}