{"context": "\n\n\u6e96\u5099\n\nAndroid \u306e BLE GATT \u901a\u4fe1\u30b5\u30f3\u30d7\u30eb\u30fb\u30b3\u30fc\u30c9\u306e\u5165\u624b\nAndroid \u3067 GATT \u901a\u4fe1\u30a2\u30d7\u30ea\u3092\u30b9\u30af\u30e9\u30c3\u30c1\u304b\u3089\u4f5c\u308b\u306e\u306f\u5927\u5909\u305d\u3046\u306a\u306e\u3067\u3001\u53c2\u8003\u306b\u306a\u308a\u305d\u3046\u306a\u306e\u3092\u63a2\u3057\u307e\u3057\u305f\u3002\n\u307e\u305a\u306f\u3001Android SDK \u672c\u5bb6\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u898b\u3066\u307f\u305f\u3093\u3067\u3059\u304c\u3001\u8907\u96d1\u3067 characteristics \u306e write \u304c\u306a\u3044\u305f\u3081\u65ad\u5ff5\u3002\n\u3053\u3061\u3089\u306e\u30b5\u30a4\u30c8\u304c\u308f\u304b\u308a\u3084\u3059\u304b\u3063\u305f\u306e\u3067\u3001\u3053\u3061\u3089\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\nAndroid\u306eBLE\u3067Characteristics\u306eRead/Write\u30b5\u30f3\u30d7\u30eb\u3092\u4f5c\u3063\u3066\u307f\u305f\n\nUUID\u306e\u751f\u6210\nBLE \u306e GATT \u901a\u4fe1\u3092\u3059\u308b\u305f\u3081\u306b\u306f\u3001\u30b5\u30fc\u30d3\u30b9\u3084\u30ad\u30e3\u30e9\u30af\u30bf\u30ea\u30b9\u30c6\u30a3\u30c3\u30af\u3068\u3044\u3046\u3082\u306e\u304c\u5fc5\u8981\u3068\u306a\u308a\u307e\u3059\u3002\n\u3053\u306e\u3042\u305f\u308a\u306e\u8a73\u3057\u3044\u3053\u3068\u306f\u3001\u3053\u3061\u3089\u306e\u30b5\u30a4\u30c8\u306b\u307e\u3068\u307e\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u3053\u3061\u3089\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\n\nBLE, GATT\u6982\u8981\n\u3010BLE\u3092\u4f7f\u3046\u3011GATT\uff08Generic Attribute Profile\uff09\u6982\u8981\n\nBLE \u306e\u30b5\u30fc\u30d3\u30b9\u3084\u30ad\u30e3\u30e9\u30af\u30bf\u30ea\u30b9\u30c6\u30a3\u30c3\u30af\u306b\u306f\u3001\u305d\u306e\u7a2e\u985e\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u306e UUID \u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u3088\u304f\u898b\u304b\u3051\u308b 16bit \u306e UUID \u306f Bluetooth \u306e SIG \u3067\u898f\u5b9a\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u3067\u3042\u308a\u3001\u72ec\u81ea\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u308b\u5834\u5408\u306f 128bit \u306e UUID \u3092\u4f7f\u3046\u3053\u3068\u306b\u306a\u308b\u3088\u3046\u3067\u3059\u3002\n\u4f5c\u308a\u305f\u3044 BLE Nano \u3068 Android \u9593\u306e\u901a\u4fe1\u306f\u3001\u72ec\u81ea\u306e\u30c7\u30fc\u30bf\u306e\u3084\u308a\u53d6\u308a\u306a\u306e\u3067\u3001\u72ec\u81ea\u306e\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u3066\u3044\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u3053\u3067\u3001Online UUID Generator\u306e\u30b5\u30a4\u30c8\u3092\u5229\u7528\u3057\u3066 128bit \u306e UUID \u3092\u30e9\u30f3\u30c0\u30e0\u751f\u6210\u3057\u307e\u3057\u305f\u3002\n\n\n\n\u7a2e\u985e\nUUID\n\n\n\n\nCustom Service\nff1ecf59-513e-4aa6-9db0-490a63ebb1ac\n\n\nread characteristics\ne3274236-89fa-4ac6-bd1c-4fe77ecdd331\n\n\nwrite characteristics\nd0dbb034-75a1-4cc4-8b59-1bce1ba6adc5\n\n\n\n\nBLE Nano \u5074\u306e service / characteristics \u8a2d\u5b9a\n\u4ee5\u524d\u306e\u8a18\u4e8b\u3067\u4f5c\u6210\u3057\u305f\u30b3\u30fc\u30c9\u306e UUID \u306e\u6307\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\u5909\u66f4\u524d\n\nmain.cpp\nuint16_t customServiceUUID  = 0xA000;\nuint16_t readCharUUID       = 0xA001;\nuint16_t writeCharUUID      = 0xA002;\n\n\n\u5909\u66f4\u5f8c\n\nmain.cpp\nstatic uint8_t customServiceUUID[16] = {0xff, 0x1e, 0xcf, 0x59, 0x51, 0x3e, 0x4a, 0xa6, 0x9d, 0xb0, 0x49, 0x0a, 0x63, 0xeb, 0xb1, 0xac};\nstatic uint8_t readCharUUID[16] = {0xe3, 0x27, 0x42, 0x36, 0x89, 0xfa, 0x4a, 0xc6, 0xbd, 0x1c, 0x4f, 0xe7, 0x7e, 0xcd, 0xd3, 0x31};\nstatic uint8_t writeCharUUID[16] = {0xd0, 0xdb, 0xb0, 0x34, 0x75, 0xa1, 0x4c, 0xc4, 0x8b, 0x59, 0x1b, 0xce, 0x1b, 0xa6, 0xad, 0xc5};\n\n\n\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u30d0\u30a4\u30ca\u30ea\u3092 BLE Nano \u306b\u66f8\u304d\u8fbc\u3093\u3060\u3089 BLE Nano \u5074\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\nAndroid GATT \u901a\u4fe1\u30b5\u30f3\u30d7\u30eb\u30fb\u30b3\u30fc\u30c9\u306e\u6539\u9020\nAndroid\u306eBLE\u3067Characteristics\u306eRead/Write\u30b5\u30f3\u30d7\u30eb\u3092\u4f5c\u3063\u3066\u307f\u305f \u3067\u3001github \u306b\u516c\u958b\u3057\u3066\u304f\u3060\u3055\u3063\u3066\u3044\u308b\u30b3\u30fc\u30c9\u3092\u30d9\u30fc\u30b9\u306b\u6539\u9020\u3057\u3066\u3044\u304d\u307e\u3059\u3002\u6539\u9020\u30dd\u30a4\u30f3\u30c8\u306f\u3053\u3061\u3089\u306b\u306a\u308a\u307e\u3059\u3002\n\nUUID \u306e\u8ffd\u52a0\n\u30c7\u30fc\u30bf\u901a\u4fe1\u30dc\u30bf\u30f3\u3092\u8ffd\u52a0\n\u72ec\u81ea\u30b5\u30fc\u30d3\u30b9\u767a\u898b\u6642\u306e\u51e6\u7406\u306e\u8ffd\u52a0\nGATT \u901a\u4fe1\u5207\u65ad\u6642\u306e\u51e6\u7406\u306e\u8ffd\u52a0\nLED ON/OFF \u30dc\u30bf\u30f3\u306e\u5236\u5fa1\u306e\u8ffd\u52a0\n\u53d7\u4fe1\u30dc\u30bf\u30f3\u306e\u5236\u5fa1\u306e\u8ffd\u52a0\n\n\nUUID \u306e\u8ffd\u52a0\nBleUuid.java \u3067 UUID \u306e\u5b9a\u7fa9\u3092\u3057\u3066\u3044\u308b\u306e\u3067\u3001BLE Nano \u3068 Android \u9593\u306e\u901a\u4fe1\u9593\u306b\u751f\u6210\u3057\u305f UUID \u3092\u8ffd\u52a0\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\nBleUuid.java\n    // BLE Nano Custom Service\n    public static final String SERVICE_BLENANO_CUSTOM = \"ff1ecf59-513e-4aa6-9db0-490a63ebb1ac\";\n    public static final String CHAR_CUSTOM_SERVICE_READ = \"e3274236-89fa-4ac6-bd1c-4fe77ecdd331\";\n    public static final String CHAR_CUSTOM_SERVICE_WRITE = \"d0dbb034-75a1-4cc4-8b59-1bce1ba6adc5\";\n\n\n\n\u30c7\u30fc\u30bf\u901a\u4fe1\u30dc\u30bf\u30f3\u306e\u8ffd\u52a0\nBLE Nano \u3068\u306e\u901a\u4fe1\u3092\u884c\u306a\u3046\u305f\u3081\u306e\u30dc\u30bf\u30f3\u3092\u3001app/res/layout/activity_device.xml \u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nactivity_device.xml\n    <ToggleButton\n        android:id=\"@+id/blenano_led_onoff_button\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\" />\n\n    <Button\n        android:id=\"@+id/blenano_read\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"@string/ble_nano_read\" />\n\n\nLED \u306e ON/OFF \u3092\u5236\u5fa1\u3059\u308b ToggleButton \u3068\u3001BLE Nano \u304b\u3089\u8fd4\u3063\u3066\u304f\u308b characteristics \u3092\u53d7\u4fe1\u3059\u308b Button \u3092\u305d\u308c\u305e\u308c\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\n\u8868\u793a\u3059\u308b\u6587\u5b57\u5217\u306f res/values/strings.xml \u3067\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002\n\nstrings.xml\n    <string name=\"ble_nano_read\">BLE Nano Read</string>\n\n\n\u3055\u3089\u306b\u3001\u8ffd\u52a0\u3057\u305f\u30dc\u30bf\u30f3\u306e\u305f\u3081\u306e\u30b3\u30fc\u30c9\u3092 DeviceActivity.java \u306b\u8ffd\u52a0\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\nDeviceActivity.java\npublic class DeviceActivity extends Activity implements View.OnClickListener {\n    private ToggleButton mWriteBleNanoLedOnOffButton;\n    private Button mReadBleNanoButton;\n:\n    protected void onCreate(Bundle savedInstanceState) {\n: \n        mWriteBleNanoLedOnOffButton = (ToggleButton) findViewById(R.id.blenano_led_onoff_button);\n        mWriteBleNanoLedOnOffButton.setOnClickListener(this);\n        mReadBleNanoButton = (Button) findViewById(R.id.blenano_read);\n        mReadBleNanoButton.setOnClickListener(this);\n    }\n    private void init() {\n:\n        mWriteBleNanoLedOnOffButton.setEnabled(false);\n        mReadBleNanoButton.setEnabled(false);\n:\n    }\n\n\n\u8ffd\u52a0\u3057\u305f\u30dc\u30bf\u30f3\u3092\u5236\u5fa1\u3059\u308b\u305f\u3081\u306e\u5909\u6570\u306e\u5b9a\u7fa9\u3068\u521d\u671f\u5316\u30b3\u30fc\u30c9\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u72ec\u81ea\u30b5\u30fc\u30d3\u30b9\u767a\u898b\u6642\u306e\u51e6\u7406\u306e\u8ffd\u52a0\nDeviceActivity.java \u306e onServicesDiscovered() \u306b\u3001\u72ec\u81ea\u30b5\u30fc\u30d3\u30b9\u3092\u767a\u898b\u3057\u305f\u3068\u304d\u306e\u51e6\u7406\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nDeviceActivity.java\npublic void onServicesDiscovered(BluetoothGatt gatt, int status) {\n    :\n    if (BleUuid.SERVICE_BLENANO_CUSTOM.equalsIgnoreCase(service.getUuid().toString())) {\n        runOnUiThread(new Runnable() {\n            public void run() {\n                mWriteBleNanoLedOnOffButton.setEnabled(true);\n                mReadBleNanoButton.setEnabled(true);\n            };\n        });\n        mWriteBleNanoLedOnOffButton.setTag(service.getCharacteristic(UUID.fromString(BleUuid.CHAR_CUSTOM_SERVICE_WRITE)));\n        mReadBleNanoButton.setTag(service.getCharacteristic(UUID.fromString(BleUuid.CHAR_CUSTOM_SERVICE_READ)));\n    }\n    :\n}\n\n\nsetEnabled(true) \u3067\u8ffd\u52a0\u3057\u305f\u30dc\u30bf\u30f3\u3092 Enable \u306b\u3057\u3001setTag \u3092\u4f7f\u3063\u3066\u72ec\u81ea\u30b5\u30fc\u30d3\u30b9\u306e Characteristic \u3092\u30dc\u30bf\u30f3\u306b\u5bfe\u5fdc\u4ed8\u3051\u3066\u3044\u307e\u3059\u3002\n\nGATT \u901a\u4fe1\u5207\u65ad\u6642\u306e\u51e6\u7406\u3092\u8ffd\u52a0\nGATT \u901a\u4fe1\u306e\u72b6\u614b\u304c\u5909\u5316\u3057\u305f\u3068\u304d\u306b\u5b9f\u884c\u3059\u308b onConnectionStateChange \u3068\u3044\u3046\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u304c\u30b5\u30f3\u30d7\u30eb\u306e\u4e2d\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u3053\u3053\u3067\u3001GATT \u901a\u4fe1\u304c\u5207\u65ad\u3055\u308c\u305f\u3068\u304d\u306b\u5404\u30dc\u30bf\u30f3\u3092 Disable \u3057\u3066\u3044\u308b\u306e\u3067\u3001\u8ffd\u52a0\u3057\u305f\u30dc\u30bf\u30f3\u306e\u5206\u3082\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nDeviceActivity.java\nprivate final BluetoothGattCallback mGattcallback = new BluetoothGattCallback() {\n    :\n    mWriteBleNanoLedOnOffButton.setEnabled(false);\n    mReadBleNanoButton.setEnabled(false);\n    :\n}\n\n\n\nLED ON/OFF \u30dc\u30bf\u30f3\u306e\u5236\u5fa1\u306e\u8ffd\u52a0\n\u30dc\u30bf\u30f3\u304c\u62bc\u3055\u308c\u305f\u3068\u304d\u306b\u547c\u3070\u308c\u308b onClick \u95a2\u6570\u306b\u3001LED ON/OFF \u306e Toggle Button \u306e\u51e6\u7406\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\nToggle Button \u304c checked \u306e\u72b6\u614b\u306e\u5834\u5408\u306fLED\u3092\u70b9\u706f\u3055\u305b\u308b\u305f\u3081\u306e\u5024 0x00 \u3092\u3001\u305d\u3046\u3067\u306a\u3044\u5834\u5408\u306f\u6d88\u706f\u3055\u305b\u308b\u305f\u3081\u306e\u5024 0x01 \u3092 data \u306b\u683c\u7d0d\u3057\u307e\u3059\u3002\n\u305d\u3057\u3066\u3001\u30bf\u30b0\u4ed8\u3051\u3057\u3066\u304a\u3044\u305f Characteristic \u3092\u4f7f\u3063\u3066\u3001data \u3092 BNE Nano \u306b\u9001\u4fe1\u3057\u307e\u3059\u3002\n\nDeviceActivity.java\npublic void onClick(View v) {\n    :\n    } else if (v.getId() == R.id.blenano_led_onoff_button) {\n        byte[] data = (mWriteBleNanoLedOnOffButton.isChecked())? new byte[] {(byte) 0x00} : new byte[] {(byte) 0x01};\n        if ((v.getTag() != null) && (v.getTag() instanceof BluetoothGattCharacteristic)) {\n            BluetoothGattCharacteristic ch = (BluetoothGattCharacteristic) v.getTag();\n            ch.setValue(data);\n            if (mConnGatt.writeCharacteristic(ch)) {\n                setProgressBarIndeterminateVisibility(true);\n            }\n        }\n    }\n}\n\n\n\n\u53d7\u4fe1\u30dc\u30bf\u30f3\u306e\u5236\u5fa1\u306e\u8ffd\u52a0\nBLE Nano \u306b\u4fe1\u53f7\u3092\u9001\u4fe1\u3059\u308b\u3068\u3001BLE Nano \u306f\u9001\u4fe1\u3057\u305f\u5024\u3092\u305d\u306e\u307e\u307e\u8fd4\u3057\u3066\u304d\u307e\u3059\u3002\nblenano_read \u30dc\u30bf\u30f3\u3067\u3001BLE Nano \u304b\u3089\u8fd4\u3063\u3066\u304d\u305f\u5024\u3092\u53d6\u5f97\u3057\u3066\u8868\u793a\u3057\u307e\u3059\u3002\n\nDeviceActivity.java\npublic void onClick(View v) {\n:\n    } else if (v.getId() == R.id.blenano_read) {\n        if ((v.getTag() != null) && (v.getTag() instanceof BluetoothGattCharacteristic)) {\n            BluetoothGattCharacteristic ch = (BluetoothGattCharacteristic) v.getTag();\n            if (mConnGatt.readCharacteristic(ch)) {\n                setProgressBarIndeterminateVisibility(true);\n            }\n        }\n    }\n}   \npublic void onCharacteristicRead(BluetoothGatt gatt, BluetoothGattCharacteristic characteristic, int status) {\n    if (status == BluetoothGatt.GATT_SUCCESS) {\n        if (BleUuid.CHAR_MANUFACTURER_NAME_STRING.equalsIgnoreCase(characteristic.getUuid().toString())) {\n             :\n        } else if (BleUuid.CHAR_CUSTOM_SERVICE_READ.equalsIgnoreCase(characteristic.getUuid().toString())) {\n            final byte[] val = characteristic.getValue();\n            runOnUiThread(new Runnable() {\n                public void run() {\n                ReadBleNanoButton.setText(getString(R.string.ble_nano_read)+\":\"+val[0]);\n                setProgressBarIndeterminateVisibility(false);\n            };\n        });\n    }\n}\n\n\n\u53d7\u4fe1\u30dc\u30bf\u30f3\u306e\u30af\u30ea\u30c3\u30af\u3092\u691c\u77e5\u3059\u308b\u3068\u3001\u30bf\u30b0\u4ed8\u3051\u3057\u3066\u304a\u3044\u305f Characteristic \u3092\u4f7f\u3063\u3066 BLE Nano \u304b\u3089\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u51fa\u3057\u307e\u3059\u3002\n\u305d\u3057\u3066\u3001\u8aad\u307f\u51fa\u3057\u304c\u5b8c\u4e86\u3059\u308b\u3068\u5b9f\u884c\u3055\u308c\u308b onCharacteristicRead \u95a2\u6570\u3067\u3001\u8aad\u307f\u51fa\u3057\u305f\u30c7\u30fc\u30bf val \u3092\u53d7\u4fe1\u30dc\u30bf\u30f3\u306b\u8868\u793a\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n\u52d5\u4f5c\u4f8b\nLED ON/OFF \u30dc\u30bf\u30f3\u3092 ON \u306b\u3057\u3066\u3001\u53d7\u4fe1\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u305f\u3068\u3053\u308d\u3002LED\u304c\u70b9\u706f\u3057\u3001\u53d7\u4fe1\u30dc\u30bf\u30f3\u306b 0 \u304c\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nLED ON/OFF \u30dc\u30bf\u30f3\u3092 OFF \u306b\u3057\u3066\u3001\u53d7\u4fe1\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u305f\u3068\u3053\u308d\u3002LED\u304c\u6d88\u706f\u3057\u3001\u53d7\u4fe1\u30dc\u30bf\u30f3\u306b 1 \u304c\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n# \u6e96\u5099\n## Android \u306e BLE GATT \u901a\u4fe1\u30b5\u30f3\u30d7\u30eb\u30fb\u30b3\u30fc\u30c9\u306e\u5165\u624b\n\nAndroid \u3067 GATT \u901a\u4fe1\u30a2\u30d7\u30ea\u3092\u30b9\u30af\u30e9\u30c3\u30c1\u304b\u3089\u4f5c\u308b\u306e\u306f\u5927\u5909\u305d\u3046\u306a\u306e\u3067\u3001\u53c2\u8003\u306b\u306a\u308a\u305d\u3046\u306a\u306e\u3092\u63a2\u3057\u307e\u3057\u305f\u3002\n\u307e\u305a\u306f\u3001[Android SDK \u672c\u5bb6\u306e\u30b5\u30f3\u30d7\u30eb](http://developer.android.com/guide/topics/connectivity/bluetooth-le.html)\u3092\u898b\u3066\u307f\u305f\u3093\u3067\u3059\u304c\u3001\u8907\u96d1\u3067 characteristics \u306e write \u304c\u306a\u3044\u305f\u3081\u65ad\u5ff5\u3002\n\u3053\u3061\u3089\u306e\u30b5\u30a4\u30c8\u304c\u308f\u304b\u308a\u3084\u3059\u304b\u3063\u305f\u306e\u3067\u3001\u3053\u3061\u3089\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\n\n[Android\u306eBLE\u3067Characteristics\u306eRead/Write\u30b5\u30f3\u30d7\u30eb\u3092\u4f5c\u3063\u3066\u307f\u305f](http://greety.sakura.ne.jp/redo/2013/11/androidblecharacteristicsreadwrite.html)\n\n## UUID\u306e\u751f\u6210\n\nBLE \u306e GATT \u901a\u4fe1\u3092\u3059\u308b\u305f\u3081\u306b\u306f\u3001\u30b5\u30fc\u30d3\u30b9\u3084\u30ad\u30e3\u30e9\u30af\u30bf\u30ea\u30b9\u30c6\u30a3\u30c3\u30af\u3068\u3044\u3046\u3082\u306e\u304c\u5fc5\u8981\u3068\u306a\u308a\u307e\u3059\u3002\n\u3053\u306e\u3042\u305f\u308a\u306e\u8a73\u3057\u3044\u3053\u3068\u306f\u3001\u3053\u3061\u3089\u306e\u30b5\u30a4\u30c8\u306b\u307e\u3068\u307e\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u3053\u3061\u3089\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\n\n- [BLE, GATT\u6982\u8981](http://blue-crystal.squares.net/doc/ble/gatt.html)\n- [\u3010BLE\u3092\u4f7f\u3046\u3011GATT\uff08Generic Attribute Profile\uff09\u6982\u8981](http://yegang.hatenablog.com/entry/2014/08/09/195246)\n\nBLE \u306e\u30b5\u30fc\u30d3\u30b9\u3084\u30ad\u30e3\u30e9\u30af\u30bf\u30ea\u30b9\u30c6\u30a3\u30c3\u30af\u306b\u306f\u3001\u305d\u306e\u7a2e\u985e\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u306e UUID \u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u3088\u304f\u898b\u304b\u3051\u308b 16bit \u306e UUID \u306f Bluetooth \u306e SIG \u3067\u898f\u5b9a\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u3067\u3042\u308a\u3001\u72ec\u81ea\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u308b\u5834\u5408\u306f 128bit \u306e UUID \u3092\u4f7f\u3046\u3053\u3068\u306b\u306a\u308b\u3088\u3046\u3067\u3059\u3002\n\n\u4f5c\u308a\u305f\u3044 BLE Nano \u3068 Android \u9593\u306e\u901a\u4fe1\u306f\u3001\u72ec\u81ea\u306e\u30c7\u30fc\u30bf\u306e\u3084\u308a\u53d6\u308a\u306a\u306e\u3067\u3001\u72ec\u81ea\u306e\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u3066\u3044\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u3053\u3067\u3001[Online UUID Generator](https://www.uuidgenerator.net/)\u306e\u30b5\u30a4\u30c8\u3092\u5229\u7528\u3057\u3066 128bit \u306e UUID \u3092\u30e9\u30f3\u30c0\u30e0\u751f\u6210\u3057\u307e\u3057\u305f\u3002\n\n|\u7a2e\u985e                 |UUID|\n|---------------------|----|\n|Custom Service|ff1ecf59-513e-4aa6-9db0-490a63ebb1ac|\n|read characteristics | e3274236-89fa-4ac6-bd1c-4fe77ecdd331|\n|write characteristics |d0dbb034-75a1-4cc4-8b59-1bce1ba6adc5|\n\n# BLE Nano \u5074\u306e service / characteristics \u8a2d\u5b9a\n\n[\u4ee5\u524d\u306e\u8a18\u4e8b](http://qiita.com/maki02/items/86e4b9348755a6d5bb41)\u3067\u4f5c\u6210\u3057\u305f\u30b3\u30fc\u30c9\u306e UUID \u306e\u6307\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\n\u5909\u66f4\u524d\n\n```cpp:main.cpp\nuint16_t customServiceUUID  = 0xA000;\nuint16_t readCharUUID       = 0xA001;\nuint16_t writeCharUUID      = 0xA002;\n```\n\n\u5909\u66f4\u5f8c\n\n```cpp:main.cpp\nstatic uint8_t customServiceUUID[16] = {0xff, 0x1e, 0xcf, 0x59, 0x51, 0x3e, 0x4a, 0xa6, 0x9d, 0xb0, 0x49, 0x0a, 0x63, 0xeb, 0xb1, 0xac};\nstatic uint8_t readCharUUID[16] = {0xe3, 0x27, 0x42, 0x36, 0x89, 0xfa, 0x4a, 0xc6, 0xbd, 0x1c, 0x4f, 0xe7, 0x7e, 0xcd, 0xd3, 0x31};\nstatic uint8_t writeCharUUID[16] = {0xd0, 0xdb, 0xb0, 0x34, 0x75, 0xa1, 0x4c, 0xc4, 0x8b, 0x59, 0x1b, 0xce, 0x1b, 0xa6, 0xad, 0xc5};\n```\n\n\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u30d0\u30a4\u30ca\u30ea\u3092 BLE Nano \u306b\u66f8\u304d\u8fbc\u3093\u3060\u3089 BLE Nano \u5074\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n# Android GATT \u901a\u4fe1\u30b5\u30f3\u30d7\u30eb\u30fb\u30b3\u30fc\u30c9\u306e\u6539\u9020\n\n[Android\u306eBLE\u3067Characteristics\u306eRead/Write\u30b5\u30f3\u30d7\u30eb\u3092\u4f5c\u3063\u3066\u307f\u305f](http://greety.sakura.ne.jp/redo/2013/11/androidblecharacteristicsreadwrite.html) \u3067\u3001github \u306b\u516c\u958b\u3057\u3066\u304f\u3060\u3055\u3063\u3066\u3044\u308b\u30b3\u30fc\u30c9\u3092\u30d9\u30fc\u30b9\u306b\u6539\u9020\u3057\u3066\u3044\u304d\u307e\u3059\u3002\u6539\u9020\u30dd\u30a4\u30f3\u30c8\u306f\u3053\u3061\u3089\u306b\u306a\u308a\u307e\u3059\u3002\n\n1. UUID \u306e\u8ffd\u52a0\n2. \u30c7\u30fc\u30bf\u901a\u4fe1\u30dc\u30bf\u30f3\u3092\u8ffd\u52a0\n3. \u72ec\u81ea\u30b5\u30fc\u30d3\u30b9\u767a\u898b\u6642\u306e\u51e6\u7406\u306e\u8ffd\u52a0\n4. GATT \u901a\u4fe1\u5207\u65ad\u6642\u306e\u51e6\u7406\u306e\u8ffd\u52a0\n5. LED ON/OFF \u30dc\u30bf\u30f3\u306e\u5236\u5fa1\u306e\u8ffd\u52a0\n6. \u53d7\u4fe1\u30dc\u30bf\u30f3\u306e\u5236\u5fa1\u306e\u8ffd\u52a0\n\n## UUID \u306e\u8ffd\u52a0\n\nBleUuid.java \u3067 UUID \u306e\u5b9a\u7fa9\u3092\u3057\u3066\u3044\u308b\u306e\u3067\u3001BLE Nano \u3068 Android \u9593\u306e\u901a\u4fe1\u9593\u306b\u751f\u6210\u3057\u305f UUID \u3092\u8ffd\u52a0\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n```java:BleUuid.java\n\t// BLE Nano Custom Service\n\tpublic static final String SERVICE_BLENANO_CUSTOM = \"ff1ecf59-513e-4aa6-9db0-490a63ebb1ac\";\n\tpublic static final String CHAR_CUSTOM_SERVICE_READ = \"e3274236-89fa-4ac6-bd1c-4fe77ecdd331\";\n\tpublic static final String CHAR_CUSTOM_SERVICE_WRITE = \"d0dbb034-75a1-4cc4-8b59-1bce1ba6adc5\";\n```\n\n## \u30c7\u30fc\u30bf\u901a\u4fe1\u30dc\u30bf\u30f3\u306e\u8ffd\u52a0\n\nBLE Nano \u3068\u306e\u901a\u4fe1\u3092\u884c\u306a\u3046\u305f\u3081\u306e\u30dc\u30bf\u30f3\u3092\u3001app/res/layout/activity_device.xml \u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```activity_device.xml\n    <ToggleButton\n        android:id=\"@+id/blenano_led_onoff_button\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\" />\n\n    <Button\n        android:id=\"@+id/blenano_read\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"@string/ble_nano_read\" />\n```\n\nLED \u306e ON/OFF \u3092\u5236\u5fa1\u3059\u308b ToggleButton \u3068\u3001BLE Nano \u304b\u3089\u8fd4\u3063\u3066\u304f\u308b characteristics \u3092\u53d7\u4fe1\u3059\u308b Button \u3092\u305d\u308c\u305e\u308c\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u8868\u793a\u3059\u308b\u6587\u5b57\u5217\u306f res/values/strings.xml \u3067\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002\n\n```strings.xml\n    <string name=\"ble_nano_read\">BLE Nano Read</string>\n```\n\n\u3055\u3089\u306b\u3001\u8ffd\u52a0\u3057\u305f\u30dc\u30bf\u30f3\u306e\u305f\u3081\u306e\u30b3\u30fc\u30c9\u3092 DeviceActivity.java \u306b\u8ffd\u52a0\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```DeviceActivity.java\npublic class DeviceActivity extends Activity implements View.OnClickListener {\n\tprivate ToggleButton mWriteBleNanoLedOnOffButton;\n\tprivate Button mReadBleNanoButton;\n:\n\tprotected void onCreate(Bundle savedInstanceState) {\n: \n\t\tmWriteBleNanoLedOnOffButton = (ToggleButton) findViewById(R.id.blenano_led_onoff_button);\n\t\tmWriteBleNanoLedOnOffButton.setOnClickListener(this);\n\t\tmReadBleNanoButton = (Button) findViewById(R.id.blenano_read);\n\t\tmReadBleNanoButton.setOnClickListener(this);\n\t}\n\tprivate void init() {\n:\n\t\tmWriteBleNanoLedOnOffButton.setEnabled(false);\n\t\tmReadBleNanoButton.setEnabled(false);\n:\n\t}\n```\n\n\u8ffd\u52a0\u3057\u305f\u30dc\u30bf\u30f3\u3092\u5236\u5fa1\u3059\u308b\u305f\u3081\u306e\u5909\u6570\u306e\u5b9a\u7fa9\u3068\u521d\u671f\u5316\u30b3\u30fc\u30c9\u306b\u306a\u308a\u307e\u3059\u3002\n\n## \u72ec\u81ea\u30b5\u30fc\u30d3\u30b9\u767a\u898b\u6642\u306e\u51e6\u7406\u306e\u8ffd\u52a0\n\nDeviceActivity.java \u306e onServicesDiscovered() \u306b\u3001\u72ec\u81ea\u30b5\u30fc\u30d3\u30b9\u3092\u767a\u898b\u3057\u305f\u3068\u304d\u306e\u51e6\u7406\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```DeviceActivity.java\npublic void onServicesDiscovered(BluetoothGatt gatt, int status) {\n\t:\n\tif (BleUuid.SERVICE_BLENANO_CUSTOM.equalsIgnoreCase(service.getUuid().toString())) {\n\t\trunOnUiThread(new Runnable() {\n\t\t\tpublic void run() {\n\t\t\t\tmWriteBleNanoLedOnOffButton.setEnabled(true);\n\t\t\t\tmReadBleNanoButton.setEnabled(true);\n\t\t\t};\n\t\t});\n\t\tmWriteBleNanoLedOnOffButton.setTag(service.getCharacteristic(UUID.fromString(BleUuid.CHAR_CUSTOM_SERVICE_WRITE)));\n\t\tmReadBleNanoButton.setTag(service.getCharacteristic(UUID.fromString(BleUuid.CHAR_CUSTOM_SERVICE_READ)));\n\t}\n\t:\n}\n```\n\nsetEnabled(true) \u3067\u8ffd\u52a0\u3057\u305f\u30dc\u30bf\u30f3\u3092 Enable \u306b\u3057\u3001setTag \u3092\u4f7f\u3063\u3066\u72ec\u81ea\u30b5\u30fc\u30d3\u30b9\u306e Characteristic \u3092\u30dc\u30bf\u30f3\u306b\u5bfe\u5fdc\u4ed8\u3051\u3066\u3044\u307e\u3059\u3002\n\n## GATT \u901a\u4fe1\u5207\u65ad\u6642\u306e\u51e6\u7406\u3092\u8ffd\u52a0\n\nGATT \u901a\u4fe1\u306e\u72b6\u614b\u304c\u5909\u5316\u3057\u305f\u3068\u304d\u306b\u5b9f\u884c\u3059\u308b onConnectionStateChange \u3068\u3044\u3046\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u304c\u30b5\u30f3\u30d7\u30eb\u306e\u4e2d\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u3053\u3053\u3067\u3001GATT \u901a\u4fe1\u304c\u5207\u65ad\u3055\u308c\u305f\u3068\u304d\u306b\u5404\u30dc\u30bf\u30f3\u3092 Disable \u3057\u3066\u3044\u308b\u306e\u3067\u3001\u8ffd\u52a0\u3057\u305f\u30dc\u30bf\u30f3\u306e\u5206\u3082\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```DeviceActivity.java\nprivate final BluetoothGattCallback mGattcallback = new BluetoothGattCallback() {\n\t:\n\tmWriteBleNanoLedOnOffButton.setEnabled(false);\n\tmReadBleNanoButton.setEnabled(false);\n\t:\n}\n```\n\n## LED ON/OFF \u30dc\u30bf\u30f3\u306e\u5236\u5fa1\u306e\u8ffd\u52a0\n\n\n\u30dc\u30bf\u30f3\u304c\u62bc\u3055\u308c\u305f\u3068\u304d\u306b\u547c\u3070\u308c\u308b onClick \u95a2\u6570\u306b\u3001LED ON/OFF \u306e Toggle Button \u306e\u51e6\u7406\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\nToggle Button \u304c checked \u306e\u72b6\u614b\u306e\u5834\u5408\u306fLED\u3092\u70b9\u706f\u3055\u305b\u308b\u305f\u3081\u306e\u5024 `0x00` \u3092\u3001\u305d\u3046\u3067\u306a\u3044\u5834\u5408\u306f\u6d88\u706f\u3055\u305b\u308b\u305f\u3081\u306e\u5024 `0x01` \u3092 data \u306b\u683c\u7d0d\u3057\u307e\u3059\u3002\n\u305d\u3057\u3066\u3001\u30bf\u30b0\u4ed8\u3051\u3057\u3066\u304a\u3044\u305f Characteristic \u3092\u4f7f\u3063\u3066\u3001data \u3092 BNE Nano \u306b\u9001\u4fe1\u3057\u307e\u3059\u3002\n\n```DeviceActivity.java\npublic void onClick(View v) {\n\t:\n\t} else if (v.getId() == R.id.blenano_led_onoff_button) {\n\t\tbyte[] data = (mWriteBleNanoLedOnOffButton.isChecked())? new byte[] {(byte) 0x00} : new byte[] {(byte) 0x01};\n\t\tif ((v.getTag() != null) && (v.getTag() instanceof BluetoothGattCharacteristic)) {\n\t\t\tBluetoothGattCharacteristic ch = (BluetoothGattCharacteristic) v.getTag();\n\t\t\tch.setValue(data);\n\t\t\tif (mConnGatt.writeCharacteristic(ch)) {\n\t\t\t\tsetProgressBarIndeterminateVisibility(true);\n\t\t\t}\n\t\t}\n\t}\n}\n```\n\n\n## \u53d7\u4fe1\u30dc\u30bf\u30f3\u306e\u5236\u5fa1\u306e\u8ffd\u52a0\n\nBLE Nano \u306b\u4fe1\u53f7\u3092\u9001\u4fe1\u3059\u308b\u3068\u3001BLE Nano \u306f\u9001\u4fe1\u3057\u305f\u5024\u3092\u305d\u306e\u307e\u307e\u8fd4\u3057\u3066\u304d\u307e\u3059\u3002\nblenano_read \u30dc\u30bf\u30f3\u3067\u3001BLE Nano \u304b\u3089\u8fd4\u3063\u3066\u304d\u305f\u5024\u3092\u53d6\u5f97\u3057\u3066\u8868\u793a\u3057\u307e\u3059\u3002\n\n```DeviceActivity.java\npublic void onClick(View v) {\n:\n\t} else if (v.getId() == R.id.blenano_read) {\n\t\tif ((v.getTag() != null) && (v.getTag() instanceof BluetoothGattCharacteristic)) {\n\t\t\tBluetoothGattCharacteristic ch = (BluetoothGattCharacteristic) v.getTag();\n\t\t\tif (mConnGatt.readCharacteristic(ch)) {\n\t\t\t\tsetProgressBarIndeterminateVisibility(true);\n\t\t\t}\n\t\t}\n\t}\n}\t\npublic void onCharacteristicRead(BluetoothGatt gatt, BluetoothGattCharacteristic characteristic, int status) {\n\tif (status == BluetoothGatt.GATT_SUCCESS) {\n\t\tif (BleUuid.CHAR_MANUFACTURER_NAME_STRING.equalsIgnoreCase(characteristic.getUuid().toString())) {\n\t\t\t :\n\t\t} else if (BleUuid.CHAR_CUSTOM_SERVICE_READ.equalsIgnoreCase(characteristic.getUuid().toString())) {\n\t\t\tfinal byte[] val = characteristic.getValue();\n\t\t\trunOnUiThread(new Runnable() {\n\t\t\t\tpublic void run() {\n\t\t\t\tReadBleNanoButton.setText(getString(R.string.ble_nano_read)+\":\"+val[0]);\n\t\t\t\tsetProgressBarIndeterminateVisibility(false);\n\t\t\t};\n\t\t});\n\t}\n}\n```\n\n\u53d7\u4fe1\u30dc\u30bf\u30f3\u306e\u30af\u30ea\u30c3\u30af\u3092\u691c\u77e5\u3059\u308b\u3068\u3001\u30bf\u30b0\u4ed8\u3051\u3057\u3066\u304a\u3044\u305f Characteristic \u3092\u4f7f\u3063\u3066 BLE Nano \u304b\u3089\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u51fa\u3057\u307e\u3059\u3002\n\u305d\u3057\u3066\u3001\u8aad\u307f\u51fa\u3057\u304c\u5b8c\u4e86\u3059\u308b\u3068\u5b9f\u884c\u3055\u308c\u308b onCharacteristicRead \u95a2\u6570\u3067\u3001\u8aad\u307f\u51fa\u3057\u305f\u30c7\u30fc\u30bf val \u3092\u53d7\u4fe1\u30dc\u30bf\u30f3\u306b\u8868\u793a\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n# \u52d5\u4f5c\u4f8b\n\nLED ON/OFF \u30dc\u30bf\u30f3\u3092 ON \u306b\u3057\u3066\u3001\u53d7\u4fe1\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u305f\u3068\u3053\u308d\u3002LED\u304c\u70b9\u706f\u3057\u3001\u53d7\u4fe1\u30dc\u30bf\u30f3\u306b 0 \u304c\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n![BNENanoLED_ON.PNG](https://qiita-image-store.s3.amazonaws.com/0/129898/0eae7ef5-3092-3bdf-010e-0cf07c70c9f3.png)\n\n\nLED ON/OFF \u30dc\u30bf\u30f3\u3092 OFF \u306b\u3057\u3066\u3001\u53d7\u4fe1\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u305f\u3068\u3053\u308d\u3002LED\u304c\u6d88\u706f\u3057\u3001\u53d7\u4fe1\u30dc\u30bf\u30f3\u306b 1 \u304c\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n![BNENanoLED_OFF.PNG](https://qiita-image-store.s3.amazonaws.com/0/129898/ce71459b-4a2b-46f8-6238-872ca63975c9.png)\n\n\n\n\n", "tags": ["BLEnano", "BLE", "Android"]}