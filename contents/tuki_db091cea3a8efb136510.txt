{"tags": ["db2", "\u5171\u901a\u8868\u5f0f", "SQL", "\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9", "Database"], "context": "\n\n\u306f\u3058\u3081\u306b\nDB2\u3092\u4f7f\u3063\u3066\u3044\u308b\u3068\u304d\u306b\u3001\u300c\u5185\u5bb9\u306f\u554f\u308f\u306a\u3044\uff08\u30ad\u30fc\u3068\u306a\u308b\u5217\u306eID\u3060\u3051\u4ed8\u3044\u3066\u3044\u308c\u3070\u3088\u3044\uff09\u304b\u3089\u5927\u91cf\u306e\u30ec\u30b3\u30fc\u30c9\u3092\u7d20\u65e9\u304f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u6295\u5165\u3057\u305f\u3044\u300d\u3068\u304d\u306eTips\u3067\u3059\u3002\nTPC-C\u3084TPC-H\u306e\u30c7\u30fc\u30bf\u3092\u4f7f\u3046\u624b\u3082\u3042\u308a\u307e\u3059\u304c\u3001dbgen\u306e\u3088\u3046\u306a\u30c7\u30fc\u30bf\u751f\u6210\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u306e\u3082\u624b\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u3002\u4eca\u56de\u306e\u3084\u308a\u65b9\u306f\u3001\u6570\u5206\u3067\u7c21\u5358\u306a\u30c7\u30fc\u30bf\u3092\u751f\u6210\u3059\u308b\u65b9\u6cd5\u3068\u3057\u3066\u91cd\u5b9d\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u624b\u9806\n\n\u5171\u901a\u8868\u5f0f\u3092\u4f7f\u3063\u3066\u4efb\u610f\u306e\u6570\u306e\u30ec\u30b3\u30fc\u30c9\u3092SELECT\u7d50\u679c\u3068\u3057\u3066\u53d6\u5f97\u3059\u308b\nSQL\u306e\u898f\u683c\u306b\u306f\u300c\u5171\u901a\u8868\u5f0f\u300d\u3068\u3044\u3046\u3001SQL\u306e\u8868\u73fe\u529b\u3092\u5f37\u5316\u3059\u308b\u4e0a\u3067\u5927\u5909\u4fbf\u5229\u306a\u6a5f\u80fd\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u306e\u5171\u901a\u8868\u5f0f\u3092\u5fdc\u7528\u3057\u3066\u3001\u6307\u5b9a\u3057\u305f\u30ec\u30b3\u30fc\u30c9\u6570\u3092\u8fd4\u5374\u3059\u308b\u3088\u3046\u306b\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u305f\u3068\u3048\u3070\u4e0b\u306eSQL\u3067\u306f\u3001\"with\"\u53e5\u3067\"temp\"\u3068\u3044\u3046\u5171\u901a\u8868\u3092\u5b9a\u7fa9\u3057\u3066\u304a\u308a\u3001\"as\"\u4ee5\u964d\u306e\u62ec\u5f27\u306e\u4e2d\u3067\u5217\u3092\u3072\u3068\u3064\u3060\u3051\u6301\u3064\u8868\u3092\u8a18\u8ff0\u3057\u3066\u3044\u307e\u3059\u3002\n\nselect.sql\nwith temp(a) as ( values(1) union all select a+1 from temp where a<5)\nselect \n    a, \n    current timestamp\nfrom temp\n\n\n\u3053\u306eSQL\u3092DB2\u306b\u6295\u5165\u3057\u3066\u307f\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b5\u4ef6\u306e\u30ec\u30b3\u30fc\u30c9\u304c\u8fd4\u5374\u3055\u308c\u307e\u3059\u3002SQL\u306e\"with\"\u53e5\u306b\u542b\u307e\u308c\u308b\"where a<5\"\u3067\u6307\u5b9a\u3057\u305f\u56de\u6570\u5206\u3060\u3051\"union all\"\u3067\u518d\u5e30\u7684\u306b\u53c2\u7167\u3057\u3066\u30ec\u30b3\u30fc\u30c9\u6570\u3092\u5897\u5e45\u3059\u308b\u3088\u3046\u306a\u8868\u73fe\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n$ db2 connect to sample\n\n   Database Connection Information\n\n Database server        = DB2/AIX64 10.5.6\n SQL authorization ID   = DB2V105\n Local database alias   = SAMPLE\n\n$ db2 \"with temp(a) as ( values(1) union all select a+1 from temp where a<5)\n> select\n>     a,\n>     current timestamp\n> from temp\"\n\nA           2\n----------- --------------------------\n          1 2016-11-15-18.00.11.489419\n          2 2016-11-15-18.00.11.489419\n          3 2016-11-15-18.00.11.489419\n          4 2016-11-15-18.00.11.489419\n          5 2016-11-15-18.00.11.489419\n\n  5 record(s) selected.\n\n\n\nSELECT\u304b\u3089\u5f97\u3089\u308c\u305f\u7d50\u679c\u3092\u76f4\u63a5\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u6295\u5165\u3059\u308b\uff08\u5c11\u91cf\uff09\n\u4ef6\u6570\u304c\u5c11\u306a\u3044\u3046\u3061\u306fSELECT\u306e\u7d50\u679c\u3092\u305d\u306e\u307e\u307eINSERT\u6587\u306b\u6295\u5165\u3059\u308b\"INSERT FROM SELECT\"\u304c\u4f7f\u3048\u307e\u3059\u3002\u524d\u8ff0\u3057\u305fSELECT\u3092INSERT\u306e\u5165\u529b\u306b\u3059\u308b\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304d\u307e\u3059\u3002\n\ninsert_from_select.sql\nconnect to sample;\n\ncreate table t1 (c1 int,c2 timestamp);\n\ninsert into t1\nwith temp(a) as ( values(1) union all select a+1 from temp where a<5)\nselect \n    a, \n    current timestamp\nfrom temp;\n\nselect count(*) from t1;\n\n\nINSERT INTO <\u8868> <SELECT\u6587>\u3068INSERT\u306e\u5f8c\u308d\u306bSELECT\u3092\u305d\u306e\u307e\u307e\u7d9a\u3051\u3066\u66f8\u304f\u3060\u3051\u3067\u3059\u3002\n\u3053\u306e\u4f8b\u3067\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u6d41\u308c\u3067\u51e6\u7406\u3092\u3057\u3066\u3044\u307e\u3059\u3002\n\u3000- \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u63a5\u7d9a\n\u3000- INSERT\u5bfe\u8c61\u306e\u8868\u3092\u4f5c\u6210\n\u3000- INSERT\u3092\u5b9f\u884c\n\u3000- \u4ef6\u6570\u3092\u30ab\u30a6\u30f3\u30c8\n\u30d5\u30a1\u30a4\u30eb\u3067SQL\u3092\u4e0e\u3048\u308b\u5834\u5408\u3001\u30b9\u30c6\u30fc\u30c8\u30e1\u30f3\u30c8\u306e\u7d42\u308f\u308a\u306b\u306f\";\"\u3067\u3001\u533a\u5207\u308a\u3092\u8868\u3059\u306e\u304cDB2\u306e\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\uff09\u304a\u4f5c\u6cd5\u306a\u306e\u3067\u3001\u7701\u7565\u3057\u306a\u3044\u3088\u3046\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n$ db2 -tvf insert_from_select.sql\nconnect to sample\n\n   Database Connection Information\n\n Database server        = DB2/AIX64 10.5.6\n SQL authorization ID   = DB2V105\n Local database alias   = SAMPLE\n\ncreate table t1 (c1 int,c2 timestamp)\nDB20000I  The SQL command completed successfully.\n\ninsert into t1 with temp(a) as ( values(1) union all select a+1 from temp where a<5) select a, current timestamp from temp\nDB20000I  The SQL command completed successfully.\n\nselect count(*) from t1\n\n1\n-----------\n          5\n\n  1 record(s) selected.\n\n\nSELECT\u304b\u3089\u5f97\u3089\u308c\u305f\u7d50\u679c\u3092\u76f4\u63a5\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u6295\u5165\u3059\u308b\uff08\u5927\u91cf\uff09\n\u30bf\u30a4\u30c8\u30eb\u306e\u3088\u3046\u306b\u5927\u91cf\u306e\u30ec\u30b3\u30fc\u30c9\u3092\u307e\u3068\u3081\u3066\u6295\u5165\u3057\u305f\u3044\u5834\u5408\u306f\u3001SQL\u306b\u3088\u308bINSERT\u3067\u306f\u901f\u5ea6\u3082\u9045\u304f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u30fb\u30ed\u30b0\u304c\u30d1\u30f3\u30af\u3059\u308b\u5371\u967a\u3082\u3042\u308a\u307e\u3059\u3002\n\u305d\u3093\u306a\u3068\u304d\u306b\u5f79\u7acb\u3064\u306e\u304c\u3001SELECT\u7d50\u679c\u3092LOAD\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u306b\u76f4\u63a5\u6295\u5165\u3059\u308b\u30c6\u30af\u30cb\u30c3\u30af\u3067\u3059\u3002\n\nload_from_cursor.sql\nconnect to sample;\n\ncreate table t2 (c1 int,c2 int,c3 char(20), c4 timestamp, c5 char(100));\n\ndeclare c1 cursor for\nwith temp(a) as ( values(1) union all select a+1 from temp where a<1000000)\nselect \n    a, \n    cast(rand() * 1000000 as int),  \n    cast(rand() * 1000000 as char(20)),\n    current timestamp,\n    repeat('char string ',8)\nfrom temp;\n\nload from c1 of cursor replace into t2;\n\nselect count(*) from t2;\n\n\n\u3053\u3093\u3069\u306e\u4f8b\u3067\u306fdeclare c1 cursor\u3068\u3044\u3046\u30b9\u30c6\u30fc\u30c8\u30e1\u30f3\u30c8\u304c\u767b\u5834\u3057\u307e\u3057\u305f\u3002\u3053\u308c\u306f\u3001\"\u30ab\u30fc\u30bd\u30eb\"\u3092\u5ba3\u8a00\u3059\u308b\u305f\u3081\u306e\u30b9\u30c6\u30fc\u30c8\u30e1\u30f3\u30c8\u3067\u3059\u3002\u30ab\u30fc\u30bd\u30eb\u306e\u8a73\u7d30\u306b\u3064\u3044\u3066\u306fWikipedia\u306a\u3069\u3092\u898b\u3066\u3044\u305f\u3060\u304f\u3068\u3057\u3066\u3002SELECT\u30b9\u30c6\u30fc\u30c8\u30e1\u30f3\u30c8\u306b\u5bfe\u3059\u308b\u30dd\u30a4\u30f3\u30bf\u30fc\uff08\u53c2\u7167\uff09\u306e\u3088\u3046\u306a\u3082\u306e\u3060\u3068\u601d\u3063\u3066\u304f\u3060\u3055\u3044\u3002\n\u3053\u3053\u3067\u306f\"c1\"\u3068\u3044\u3046\u540d\u524d\u3067100\u4e07\u4ef6\u3092\u8fd4\u5374\u3059\u308bSELECT\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u3066\u3001\u305d\u306eC1\u30ab\u30fc\u30bd\u30eb\u3092load from c1\u3068\u3044\u3046\u6307\u5b9a\u3067LOAD\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u306e\u5165\u529b\u306b\u3057\u3066\u3044\u307e\u3059\u3002\u3064\u307e\u308a\u3001100\u4e07\u4ef6\u306eSELECT\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067\u53d7\u3051\u53d6\u3063\u3066\u304b\u3089\u6295\u5165\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u30dd\u30a4\u30f3\u30bf\u30fc\u3068\u3057\u3066LOAD\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u304c\u76f4\u63a5\u8aad\u307f\u53d6\u308a\u3001\u305d\u306e\u307e\u307e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u306e\u5165\u529b\u3068\u3057\u3066\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\u52d5\u304b\u3057\u3066\u307f\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002LOAD\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u304b\u3089\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u305f\u304f\u3055\u3093\u51fa\u3066\u3044\u307e\u3059\u304c\u3001\u8981\u3059\u308b\u306bSELECT\u306b\u3088\u3063\u3066\u751f\u6210\u3055\u308c\u305f100\u4e07\u4ef6\u306e\u30c7\u30fc\u30bf\u304c\u3001LOAD\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u306b\u3088\u3063\u3066\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u6295\u5165\u3055\u308c\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n$ db2 -tvf load_from_cursor.sql\nconnect to sample\n\n   Database Connection Information\n\n Database server        = DB2/AIX64 10.5.6\n SQL authorization ID   = DB2V105\n Local database alias   = SAMPLE\n\n\ncreate table t2 (c1 int,c2 int,c3 char(20), c4 timestamp, c5 char(100))\nDB20000I  The SQL command completed successfully.\n\ndeclare c1 cursor for with temp(a) as ( values(1) union all select a+1 from temp where a<1000000) select a, cast(rand() * 1000000 as int), cast(rand() * 1000000 as char(20)), current timestamp, repeat('char string ',8) from temp\nDB20000I  The SQL command completed successfully.\n\nload from c1 of cursor replace into t2\nSQL3501W  The table space(s) in which the table resides will not be placed in\nbackup pending state since forward recovery is disabled for the database.\n\nSQL3039W  The memory available to LOAD for DATA BUFFER prohibits full LOAD\nparallelism.  Load parallelism of \"7\" will be used\n\nSQL1193I  The utility is beginning to load data from the SQL statement \" with\ntemp(a) as ( values(1) union all select a+1 from temp where ...\".\n\nSQL3500W  The utility is beginning the \"LOAD\" phase at time \"11/15/2016\n20:08:06.922900\".\n\nSQL3519W  Begin Load Consistency Point. Input record count = \"0\".\n\nSQL3520W  Load Consistency Point was successful.\n\nSQL3110N  The utility has completed processing.  \"1000000\" rows were read from\nthe input file.\n\nSQL3519W  Begin Load Consistency Point. Input record count = \"1000000\".\n\nSQL3520W  Load Consistency Point was successful.\n\nSQL3515W  The utility has finished the \"LOAD\" phase at time \"11/15/2016\n20:08:14.059412\".\n\n\nNumber of rows read         = 1000000\nNumber of rows skipped      = 0\nNumber of rows loaded       = 1000000\nNumber of rows rejected     = 0\nNumber of rows deleted      = 0\nNumber of rows committed    = 1000000\n\n\nselect count(*) from t2\n\n1\n-----------\n    1000000\n\n  1 record(s) selected.\n\n\u624b\u5143\u306e\u74b0\u5883\u3067\u52d5\u304b\u3057\u3066\u307f\u308b\u3068\u3001\u4e00\u6614\u524d\u306e\u30b5\u30fc\u30d0\u30fc\u3067\u308210\u79d2\u3050\u3089\u3044\u3067\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002\u8907\u96d1\u306a\u30c7\u30fc\u30bf\u306e\u4f5c\u6210\u306f\u306a\u304b\u306a\u304b\u96e3\u3057\u3044\u3067\u3059\u304c\u3001\u3061\u3087\u3053\u3063\u3068\u3057\u305f\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u306e\u4f5c\u6210\u306b\u306f\u4fbf\u5229\u3067\u3059\u3002\n\n\uff08\u304a\u307e\u3051\uff09PostgreSQL\u3060\u3068\u3069\u3046\u306a\u308b\u304b\n\u3069\u3046\u3084\u3089PostgreSQL\u3067\u3082\u5171\u901a\u8868\u5f0f\uff08\u5171\u901a\u30c6\u30fc\u30d6\u30eb\u5f0f\u3001CTE\uff09\u304c\u4f7f\u3048\u308b\u6a21\u69d8\u306a\u306e\u3067\u3001\u3069\u3053\u307e\u3067\u540c\u3058\u3088\u3046\u306b\u3067\u304d\u308b\u304b\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002PostgresSQL\u306f\u3042\u307e\u308a\u8a73\u3057\u304f\u306a\u3044\u306e\u3067\u3001\u3082\u3063\u3068\u3044\u3044\u65b9\u6cd5\u304c\u3042\u3063\u305f\u3089\u662f\u975e\u6559\u3048\u3066\u304f\u3060\u3055\u3044\u3002MySQL\u3082\u30018.0\u3067\u306fCTE\u306b\u5bfe\u5fdc\u3059\u308b\u69d8\u5b50\u3067\u3059\u306d\u3002\u305d\u306e\u3046\u3061\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\nPostgreSQL\u306e\u5834\u5408\u306f\u3001\u518d\u5e30\u7684\u306a\u53c2\u7167\u3092\u53ef\u80fd\u306b\u3059\u308b\u5834\u5408\u306b\u306f\"RECURSIVE\"\u3068\u3044\u3046\u30ad\u30fc\u30ef\u30fc\u30c9\u3092WITH\u53e5\u306b\u8ffd\u52a0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\u305d\u306e\u307b\u304b\u3001\u73fe\u5728\u6642\u523b\u3092\u8fd4\u3059\u305f\u3081\u306e\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\"CURRENT TIMESTAMP\"\u304b\u3089\"CURRENT_TIMESTAMP\"\u306b\u5909\u3048\u3066\u3044\u307e\u3059\u3002\nwith RECURSIVE temp(a) as ( values(1) union all select a+1 from temp where a<5)\nselect a,\n       current_timestamp\n from temp;'\n\n\u3053\u308c\u3092PostgreSQL\u306b\u6295\u5165\u3059\u308b\u3068\u3001DB2\u3068\u540c\u3058\u3088\u3046\u306b5\u4ef6\u306e\u7d50\u679c\u30bb\u30c3\u30c8\u304c\u623b\u3063\u3066\u304d\u307e\u3057\u305f\u3002\n$ sudo  -u postgres -i psql -c 'with RECURSIVE temp(a) as ( values(1) union all select a+1 from temp where a<5)\n> select a,\n>        current_timestamp\n>  from temp;'\n a |              now\n---+-------------------------------\n 1 | 2016-11-16 13:58:50.305138+00\n 2 | 2016-11-16 13:58:50.305138+00\n 3 | 2016-11-16 13:58:50.305138+00\n 4 | 2016-11-16 13:58:50.305138+00\n 5 | 2016-11-16 13:58:50.305138+00\n(5 rows)\n\nINSERT FROM SELECT\u3082\u3067\u304d\u307e\u3057\u305f\u3002\n$ sudo  -u postgres -i psql -c '\n> create table t2 (c1 int,c2 timestamp);\n>\n> insert into t2\n>  with RECURSIVE temp(a) as ( values(1) union all select a+1 from temp where a<5)\n>  select a,\n>        current_timestamp\n>  from temp;'\nINSERT 0 5\n\nSELECT\u3059\u308b\u3068\u3001\u5171\u901a\u8868\u5f0f\u3067\u6307\u5b9a\u3057\u305f5\u4ef6\u306e\u30c7\u30fc\u30bf\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n$ sudo  -u postgres -i psql -c 'select * from t2;'\n c1 |             c2\n----+----------------------------\n  1 | 2016-11-16 14:04:51.065885\n  2 | 2016-11-16 14:04:51.065885\n  3 | 2016-11-16 14:04:51.065885\n  4 | 2016-11-16 14:04:51.065885\n  5 | 2016-11-16 14:04:51.065885\n(5 rows)\n\nPostgreSQL\u306e\u307b\u3046\u306f\u3001INSERT FROM SELECT\u3060\u3051\u3067100\u4e07\u4ef6\u304c\u6295\u5165\u3067\u304d\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n$ sudo  -u postgres -i psql -c '\n> create table t3 (c1 int,c2 timestamp);\n>\n> insert into t3\n>  with RECURSIVE temp(a) as ( values(1) union all select a+1 from temp where a<1000000)\n>  select a,\n>        current_timestamp\n>  from temp;'\n\nINSERT 0 1000000\n\n\u78ba\u304b\u306b100\u4e07\u4ef6\u5165\u3063\u3066\u305d\u3046\u306a\u69d8\u5b50\n$ sudo  -u postgres -i psql -c 'select * from t3 order by c1 desc fetch first 10 rows only'\n   c1    |             c2\n---------+----------------------------\n 1000000 | 2016-11-16 14:07:13.553718\n  999999 | 2016-11-16 14:07:13.553718\n  999998 | 2016-11-16 14:07:13.553718\n  999997 | 2016-11-16 14:07:13.553718\n  999996 | 2016-11-16 14:07:13.553718\n  999995 | 2016-11-16 14:07:13.553718\n  999994 | 2016-11-16 14:07:13.553718\n  999993 | 2016-11-16 14:07:13.553718\n  999992 | 2016-11-16 14:07:13.553718\n  999991 | 2016-11-16 14:07:13.553718\n(10 rows)\n\n# \u306f\u3058\u3081\u306b\nDB2\u3092\u4f7f\u3063\u3066\u3044\u308b\u3068\u304d\u306b\u3001\u300c\u5185\u5bb9\u306f\u554f\u308f\u306a\u3044\uff08\u30ad\u30fc\u3068\u306a\u308b\u5217\u306eID\u3060\u3051\u4ed8\u3044\u3066\u3044\u308c\u3070\u3088\u3044\uff09\u304b\u3089\u5927\u91cf\u306e\u30ec\u30b3\u30fc\u30c9\u3092\u7d20\u65e9\u304f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u6295\u5165\u3057\u305f\u3044\u300d\u3068\u304d\u306eTips\u3067\u3059\u3002\n\nTPC-C\u3084TPC-H\u306e\u30c7\u30fc\u30bf\u3092\u4f7f\u3046\u624b\u3082\u3042\u308a\u307e\u3059\u304c\u3001dbgen\u306e\u3088\u3046\u306a\u30c7\u30fc\u30bf\u751f\u6210\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u306e\u3082\u624b\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u3002\u4eca\u56de\u306e\u3084\u308a\u65b9\u306f\u3001\u6570\u5206\u3067\u7c21\u5358\u306a\u30c7\u30fc\u30bf\u3092\u751f\u6210\u3059\u308b\u65b9\u6cd5\u3068\u3057\u3066\u91cd\u5b9d\u3057\u3066\u3044\u307e\u3059\u3002\n\n# \u624b\u9806\n## \u5171\u901a\u8868\u5f0f\u3092\u4f7f\u3063\u3066\u4efb\u610f\u306e\u6570\u306e\u30ec\u30b3\u30fc\u30c9\u3092SELECT\u7d50\u679c\u3068\u3057\u3066\u53d6\u5f97\u3059\u308b\nSQL\u306e\u898f\u683c\u306b\u306f\u300c\u5171\u901a\u8868\u5f0f\u300d\u3068\u3044\u3046\u3001SQL\u306e\u8868\u73fe\u529b\u3092\u5f37\u5316\u3059\u308b\u4e0a\u3067\u5927\u5909\u4fbf\u5229\u306a\u6a5f\u80fd\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u306e\u5171\u901a\u8868\u5f0f\u3092\u5fdc\u7528\u3057\u3066\u3001\u6307\u5b9a\u3057\u305f\u30ec\u30b3\u30fc\u30c9\u6570\u3092\u8fd4\u5374\u3059\u308b\u3088\u3046\u306b\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u305f\u3068\u3048\u3070\u4e0b\u306eSQL\u3067\u306f\u3001\"with\"\u53e5\u3067\"temp\"\u3068\u3044\u3046\u5171\u901a\u8868\u3092\u5b9a\u7fa9\u3057\u3066\u304a\u308a\u3001\"as\"\u4ee5\u964d\u306e\u62ec\u5f27\u306e\u4e2d\u3067\u5217\u3092\u3072\u3068\u3064\u3060\u3051\u6301\u3064\u8868\u3092\u8a18\u8ff0\u3057\u3066\u3044\u307e\u3059\u3002\n\n```sql:select.sql\nwith temp(a) as ( values(1) union all select a+1 from temp where a<5)\nselect \n\ta, \n\tcurrent timestamp\nfrom temp\n```\n\n\u3053\u306eSQL\u3092DB2\u306b\u6295\u5165\u3057\u3066\u307f\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b5\u4ef6\u306e\u30ec\u30b3\u30fc\u30c9\u304c\u8fd4\u5374\u3055\u308c\u307e\u3059\u3002SQL\u306e\"with\"\u53e5\u306b\u542b\u307e\u308c\u308b\"<Font color=\"blue\">where a<5</font>\"\u3067\u6307\u5b9a\u3057\u305f\u56de\u6570\u5206\u3060\u3051\"union all\"\u3067\u518d\u5e30\u7684\u306b\u53c2\u7167\u3057\u3066\u30ec\u30b3\u30fc\u30c9\u6570\u3092\u5897\u5e45\u3059\u308b\u3088\u3046\u306a\u8868\u73fe\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n```\n$ db2 connect to sample\n\n   Database Connection Information\n\n Database server        = DB2/AIX64 10.5.6\n SQL authorization ID   = DB2V105\n Local database alias   = SAMPLE\n\n$ db2 \"with temp(a) as ( values(1) union all select a+1 from temp where a<5)\n> select\n>     a,\n>     current timestamp\n> from temp\"\n\nA           2\n----------- --------------------------\n          1 2016-11-15-18.00.11.489419\n          2 2016-11-15-18.00.11.489419\n          3 2016-11-15-18.00.11.489419\n          4 2016-11-15-18.00.11.489419\n          5 2016-11-15-18.00.11.489419\n\n  5 record(s) selected.\n\n```\n## SELECT\u304b\u3089\u5f97\u3089\u308c\u305f\u7d50\u679c\u3092\u76f4\u63a5\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u6295\u5165\u3059\u308b\uff08\u5c11\u91cf\uff09\n\u4ef6\u6570\u304c\u5c11\u306a\u3044\u3046\u3061\u306fSELECT\u306e\u7d50\u679c\u3092\u305d\u306e\u307e\u307eINSERT\u6587\u306b\u6295\u5165\u3059\u308b\"INSERT FROM SELECT\"\u304c\u4f7f\u3048\u307e\u3059\u3002\u524d\u8ff0\u3057\u305fSELECT\u3092INSERT\u306e\u5165\u529b\u306b\u3059\u308b\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304d\u307e\u3059\u3002\n\n```sql:insert_from_select.sql\nconnect to sample;\n\ncreate table t1 (c1 int,c2 timestamp);\n\ninsert into t1\nwith temp(a) as ( values(1) union all select a+1 from temp where a<5)\nselect \n    a, \n    current timestamp\nfrom temp;\n\nselect count(*) from t1;\n```\n```INSERT INTO <\u8868> <SELECT\u6587>```\u3068INSERT\u306e\u5f8c\u308d\u306bSELECT\u3092\u305d\u306e\u307e\u307e\u7d9a\u3051\u3066\u66f8\u304f\u3060\u3051\u3067\u3059\u3002\n\u3053\u306e\u4f8b\u3067\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u6d41\u308c\u3067\u51e6\u7406\u3092\u3057\u3066\u3044\u307e\u3059\u3002\n\u3000- \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u63a5\u7d9a\n\u3000- INSERT\u5bfe\u8c61\u306e\u8868\u3092\u4f5c\u6210\n\u3000- INSERT\u3092\u5b9f\u884c\n\u3000- \u4ef6\u6570\u3092\u30ab\u30a6\u30f3\u30c8\n\n\u30d5\u30a1\u30a4\u30eb\u3067SQL\u3092\u4e0e\u3048\u308b\u5834\u5408\u3001\u30b9\u30c6\u30fc\u30c8\u30e1\u30f3\u30c8\u306e\u7d42\u308f\u308a\u306b\u306f\";\"\u3067\u3001\u533a\u5207\u308a\u3092\u8868\u3059\u306e\u304cDB2\u306e\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\uff09\u304a\u4f5c\u6cd5\u306a\u306e\u3067\u3001\u7701\u7565\u3057\u306a\u3044\u3088\u3046\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\n$ db2 -tvf insert_from_select.sql\nconnect to sample\n\n   Database Connection Information\n\n Database server        = DB2/AIX64 10.5.6\n SQL authorization ID   = DB2V105\n Local database alias   = SAMPLE\n\ncreate table t1 (c1 int,c2 timestamp)\nDB20000I  The SQL command completed successfully.\n\ninsert into t1 with temp(a) as ( values(1) union all select a+1 from temp where a<5) select a, current timestamp from temp\nDB20000I  The SQL command completed successfully.\n\nselect count(*) from t1\n\n1\n-----------\n          5\n\n  1 record(s) selected.\n```\n\n## SELECT\u304b\u3089\u5f97\u3089\u308c\u305f\u7d50\u679c\u3092\u76f4\u63a5\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u6295\u5165\u3059\u308b\uff08\u5927\u91cf\uff09\n\u30bf\u30a4\u30c8\u30eb\u306e\u3088\u3046\u306b\u5927\u91cf\u306e\u30ec\u30b3\u30fc\u30c9\u3092\u307e\u3068\u3081\u3066\u6295\u5165\u3057\u305f\u3044\u5834\u5408\u306f\u3001SQL\u306b\u3088\u308bINSERT\u3067\u306f\u901f\u5ea6\u3082\u9045\u304f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u30fb\u30ed\u30b0\u304c\u30d1\u30f3\u30af\u3059\u308b\u5371\u967a\u3082\u3042\u308a\u307e\u3059\u3002\n\u305d\u3093\u306a\u3068\u304d\u306b\u5f79\u7acb\u3064\u306e\u304c\u3001SELECT\u7d50\u679c\u3092LOAD\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u306b\u76f4\u63a5\u6295\u5165\u3059\u308b\u30c6\u30af\u30cb\u30c3\u30af\u3067\u3059\u3002\n\n```sql:load_from_cursor.sql\nconnect to sample;\n\ncreate table t2 (c1 int,c2 int,c3 char(20), c4 timestamp, c5 char(100));\n\ndeclare c1 cursor for\nwith temp(a) as ( values(1) union all select a+1 from temp where a<1000000)\nselect \n    a, \n    cast(rand() * 1000000 as int),  \n    cast(rand() * 1000000 as char(20)),\n    current timestamp,\n    repeat('char string ',8)\nfrom temp;\n\nload from c1 of cursor replace into t2;\n\nselect count(*) from t2;\n```\n\n\u3053\u3093\u3069\u306e\u4f8b\u3067\u306f```declare c1 cursor```\u3068\u3044\u3046\u30b9\u30c6\u30fc\u30c8\u30e1\u30f3\u30c8\u304c\u767b\u5834\u3057\u307e\u3057\u305f\u3002\u3053\u308c\u306f\u3001\"\u30ab\u30fc\u30bd\u30eb\"\u3092\u5ba3\u8a00\u3059\u308b\u305f\u3081\u306e\u30b9\u30c6\u30fc\u30c8\u30e1\u30f3\u30c8\u3067\u3059\u3002\u30ab\u30fc\u30bd\u30eb\u306e\u8a73\u7d30\u306b\u3064\u3044\u3066\u306fWikipedia\u306a\u3069\u3092\u898b\u3066\u3044\u305f\u3060\u304f\u3068\u3057\u3066\u3002SELECT\u30b9\u30c6\u30fc\u30c8\u30e1\u30f3\u30c8\u306b\u5bfe\u3059\u308b\u30dd\u30a4\u30f3\u30bf\u30fc\uff08\u53c2\u7167\uff09\u306e\u3088\u3046\u306a\u3082\u306e\u3060\u3068\u601d\u3063\u3066\u304f\u3060\u3055\u3044\u3002\n\u3053\u3053\u3067\u306f\"c1\"\u3068\u3044\u3046\u540d\u524d\u3067100\u4e07\u4ef6\u3092\u8fd4\u5374\u3059\u308bSELECT\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u3066\u3001\u305d\u306eC1\u30ab\u30fc\u30bd\u30eb\u3092```load from c1```\u3068\u3044\u3046\u6307\u5b9a\u3067LOAD\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u306e\u5165\u529b\u306b\u3057\u3066\u3044\u307e\u3059\u3002\u3064\u307e\u308a\u3001100\u4e07\u4ef6\u306eSELECT\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067\u53d7\u3051\u53d6\u3063\u3066\u304b\u3089\u6295\u5165\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u30dd\u30a4\u30f3\u30bf\u30fc\u3068\u3057\u3066LOAD\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u304c\u76f4\u63a5\u8aad\u307f\u53d6\u308a\u3001\u305d\u306e\u307e\u307e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u306e\u5165\u529b\u3068\u3057\u3066\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u52d5\u304b\u3057\u3066\u307f\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002LOAD\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u304b\u3089\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u305f\u304f\u3055\u3093\u51fa\u3066\u3044\u307e\u3059\u304c\u3001\u8981\u3059\u308b\u306bSELECT\u306b\u3088\u3063\u3066\u751f\u6210\u3055\u308c\u305f100\u4e07\u4ef6\u306e\u30c7\u30fc\u30bf\u304c\u3001LOAD\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u306b\u3088\u3063\u3066\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u6295\u5165\u3055\u308c\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n```\n$ db2 -tvf load_from_cursor.sql\nconnect to sample\n\n   Database Connection Information\n\n Database server        = DB2/AIX64 10.5.6\n SQL authorization ID   = DB2V105\n Local database alias   = SAMPLE\n\n\ncreate table t2 (c1 int,c2 int,c3 char(20), c4 timestamp, c5 char(100))\nDB20000I  The SQL command completed successfully.\n\ndeclare c1 cursor for with temp(a) as ( values(1) union all select a+1 from temp where a<1000000) select a, cast(rand() * 1000000 as int), cast(rand() * 1000000 as char(20)), current timestamp, repeat('char string ',8) from temp\nDB20000I  The SQL command completed successfully.\n\nload from c1 of cursor replace into t2\nSQL3501W  The table space(s) in which the table resides will not be placed in\nbackup pending state since forward recovery is disabled for the database.\n\nSQL3039W  The memory available to LOAD for DATA BUFFER prohibits full LOAD\nparallelism.  Load parallelism of \"7\" will be used\n\nSQL1193I  The utility is beginning to load data from the SQL statement \" with\ntemp(a) as ( values(1) union all select a+1 from temp where ...\".\n\nSQL3500W  The utility is beginning the \"LOAD\" phase at time \"11/15/2016\n20:08:06.922900\".\n\nSQL3519W  Begin Load Consistency Point. Input record count = \"0\".\n\nSQL3520W  Load Consistency Point was successful.\n\nSQL3110N  The utility has completed processing.  \"1000000\" rows were read from\nthe input file.\n\nSQL3519W  Begin Load Consistency Point. Input record count = \"1000000\".\n\nSQL3520W  Load Consistency Point was successful.\n\nSQL3515W  The utility has finished the \"LOAD\" phase at time \"11/15/2016\n20:08:14.059412\".\n\n\nNumber of rows read         = 1000000\nNumber of rows skipped      = 0\nNumber of rows loaded       = 1000000\nNumber of rows rejected     = 0\nNumber of rows deleted      = 0\nNumber of rows committed    = 1000000\n\n\nselect count(*) from t2\n\n1\n-----------\n    1000000\n\n  1 record(s) selected.\n```\n\n\n\u624b\u5143\u306e\u74b0\u5883\u3067\u52d5\u304b\u3057\u3066\u307f\u308b\u3068\u3001\u4e00\u6614\u524d\u306e\u30b5\u30fc\u30d0\u30fc\u3067\u308210\u79d2\u3050\u3089\u3044\u3067\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002\u8907\u96d1\u306a\u30c7\u30fc\u30bf\u306e\u4f5c\u6210\u306f\u306a\u304b\u306a\u304b\u96e3\u3057\u3044\u3067\u3059\u304c\u3001\u3061\u3087\u3053\u3063\u3068\u3057\u305f\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u306e\u4f5c\u6210\u306b\u306f\u4fbf\u5229\u3067\u3059\u3002\n\n\n# \uff08\u304a\u307e\u3051\uff09PostgreSQL\u3060\u3068\u3069\u3046\u306a\u308b\u304b\n\u3069\u3046\u3084\u3089PostgreSQL\u3067\u3082\u5171\u901a\u8868\u5f0f\uff08\u5171\u901a\u30c6\u30fc\u30d6\u30eb\u5f0f\u3001CTE\uff09\u304c[\u4f7f\u3048\u308b\u6a21\u69d8](https://www.postgresql.jp/document/9.3/html/queries-with.html)\u306a\u306e\u3067\u3001\u3069\u3053\u307e\u3067\u540c\u3058\u3088\u3046\u306b\u3067\u304d\u308b\u304b\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002PostgresSQL\u306f\u3042\u307e\u308a\u8a73\u3057\u304f\u306a\u3044\u306e\u3067\u3001\u3082\u3063\u3068\u3044\u3044\u65b9\u6cd5\u304c\u3042\u3063\u305f\u3089\u662f\u975e\u6559\u3048\u3066\u304f\u3060\u3055\u3044\u3002MySQL\u3082\u3001[8.0\u3067\u306fCTE\u306b\u5bfe\u5fdc\u3059\u308b\u69d8\u5b50](http://mysqlserverteam.com/mysql-8-0-labs-recursive-common-table-expressions-in-mysql-ctes/)\u3067\u3059\u306d\u3002\u305d\u306e\u3046\u3061\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\nPostgreSQL\u306e\u5834\u5408\u306f\u3001\u518d\u5e30\u7684\u306a\u53c2\u7167\u3092\u53ef\u80fd\u306b\u3059\u308b\u5834\u5408\u306b\u306f\"RECURSIVE\"\u3068\u3044\u3046\u30ad\u30fc\u30ef\u30fc\u30c9\u3092WITH\u53e5\u306b\u8ffd\u52a0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\u305d\u306e\u307b\u304b\u3001\u73fe\u5728\u6642\u523b\u3092\u8fd4\u3059\u305f\u3081\u306e\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\"CURRENT TIMESTAMP\"\u304b\u3089\"CURRENT_TIMESTAMP\"\u306b\u5909\u3048\u3066\u3044\u307e\u3059\u3002\n\n```\nwith RECURSIVE temp(a) as ( values(1) union all select a+1 from temp where a<5)\nselect a,\n       current_timestamp\n from temp;'\n```\n\n\u3053\u308c\u3092PostgreSQL\u306b\u6295\u5165\u3059\u308b\u3068\u3001DB2\u3068\u540c\u3058\u3088\u3046\u306b5\u4ef6\u306e\u7d50\u679c\u30bb\u30c3\u30c8\u304c\u623b\u3063\u3066\u304d\u307e\u3057\u305f\u3002\n\n```\n$ sudo  -u postgres -i psql -c 'with RECURSIVE temp(a) as ( values(1) union all select a+1 from temp where a<5)\n> select a,\n>        current_timestamp\n>  from temp;'\n a |              now\n---+-------------------------------\n 1 | 2016-11-16 13:58:50.305138+00\n 2 | 2016-11-16 13:58:50.305138+00\n 3 | 2016-11-16 13:58:50.305138+00\n 4 | 2016-11-16 13:58:50.305138+00\n 5 | 2016-11-16 13:58:50.305138+00\n(5 rows)\n```\n\nINSERT FROM SELECT\u3082\u3067\u304d\u307e\u3057\u305f\u3002\n\n```\n$ sudo  -u postgres -i psql -c '\n> create table t2 (c1 int,c2 timestamp);\n>\n> insert into t2\n>  with RECURSIVE temp(a) as ( values(1) union all select a+1 from temp where a<5)\n>  select a,\n>        current_timestamp\n>  from temp;'\nINSERT 0 5\n```\n\nSELECT\u3059\u308b\u3068\u3001\u5171\u901a\u8868\u5f0f\u3067\u6307\u5b9a\u3057\u305f5\u4ef6\u306e\u30c7\u30fc\u30bf\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```\n$ sudo  -u postgres -i psql -c 'select * from t2;'\n c1 |             c2\n----+----------------------------\n  1 | 2016-11-16 14:04:51.065885\n  2 | 2016-11-16 14:04:51.065885\n  3 | 2016-11-16 14:04:51.065885\n  4 | 2016-11-16 14:04:51.065885\n  5 | 2016-11-16 14:04:51.065885\n(5 rows)\n```\n\n\nPostgreSQL\u306e\u307b\u3046\u306f\u3001INSERT FROM SELECT\u3060\u3051\u3067100\u4e07\u4ef6\u304c\u6295\u5165\u3067\u304d\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\n```\n$ sudo  -u postgres -i psql -c '\n> create table t3 (c1 int,c2 timestamp);\n>\n> insert into t3\n>  with RECURSIVE temp(a) as ( values(1) union all select a+1 from temp where a<1000000)\n>  select a,\n>        current_timestamp\n>  from temp;'\n\nINSERT 0 1000000\n```\n\n\u78ba\u304b\u306b100\u4e07\u4ef6\u5165\u3063\u3066\u305d\u3046\u306a\u69d8\u5b50\n\n```\n$ sudo  -u postgres -i psql -c 'select * from t3 order by c1 desc fetch first 10 rows only'\n   c1    |             c2\n---------+----------------------------\n 1000000 | 2016-11-16 14:07:13.553718\n  999999 | 2016-11-16 14:07:13.553718\n  999998 | 2016-11-16 14:07:13.553718\n  999997 | 2016-11-16 14:07:13.553718\n  999996 | 2016-11-16 14:07:13.553718\n  999995 | 2016-11-16 14:07:13.553718\n  999994 | 2016-11-16 14:07:13.553718\n  999993 | 2016-11-16 14:07:13.553718\n  999992 | 2016-11-16 14:07:13.553718\n  999991 | 2016-11-16 14:07:13.553718\n(10 rows)\n```\n\n"}