{"context": "\u53c2\u8003\u306b\u3057\u305f\u30da\u30fc\u30b8\nWebSocket Server (Java)\n\u300cWebSphere Application Server Liberty Core\u300d\u3067\u65b0\u305f\u306b\u6b63\u5f0f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u305fWebSocket\u3092\u4f7f\u3063\u3066\u307f\u305f (1/6)\uff1aCodeZine\uff08\u30b3\u30fc\u30c9\u30b8\u30f3\uff09\nhttps://codezine.jp/article/detail/8418\nWebSocket Client (Java)\nWebSocket \u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u4f5c\u3063\u3066\u307f\u305f (Java \u3067)\nhttp://service.cresco.co.jp/blog/entry/184\n\nHelloEndPoint.java\npackage pkg;\n\nimport java.io.IOException;\nimport java.util.Set;\n\nimport javax.websocket.CloseReason;\nimport javax.websocket.EndpointConfig;\nimport javax.websocket.OnClose;\nimport javax.websocket.OnError;\nimport javax.websocket.OnMessage;\nimport javax.websocket.OnOpen;\nimport javax.websocket.Session;\nimport javax.websocket.server.ServerEndpoint;\n\n/**\n * Websocket Endpoint implementation class HelloEndPoint\n */\n\n@ServerEndpoint(\"/helloendpoint\")\npublic class HelloEndPoint {\n\n    // \u73fe\u5728\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u8a18\u9332\n    Session currentSession = null;\n\n    public HelloEndPoint() {\n        super();\n    }\n\n    /*\n     * \u63a5\u7d9a\u304c\u30aa\u30fc\u30d7\u30f3\u3057\u305f\u3068\u304d\n     */\n    @OnOpen\n    public void onOpen(Session session, EndpointConfig ec) {\n        this.currentSession = session;\n    }\n\n    /*\n     * \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u305f\u3068\u304d\n     */\n    @OnMessage\n    public void receiveMessage(String msg) throws IOException {\n        // \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u9001\u4fe1\u3059\u308b\n        this.currentSession.getBasicRemote().sendText(\"Hello \" + msg + \".\");\n\n        Set<Session> sessions = currentSession.getOpenSessions();\n        for (Session session : sessions) {\n            try {\n                session.getBasicRemote().sendText(\"Hello \" + msg + \".(2)\");\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n\n    /*\n     * \u63a5\u7d9a\u304c\u30af\u30ed\u30fc\u30ba\u3057\u305f\u3068\u304d\n     */\n    @OnClose\n    public void onClose(Session session, CloseReason reason) {\n        // ...\n    }\n\n    /*\n     * \u63a5\u7d9a\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\u3068\u304d\n     */\n    @OnError\n    public void onError(Throwable t) {\n        // ...\n    }\n\n}\n\n\n\nWebSocketClientMain\npackage pkg;\n\nimport java.net.URI;\n\nimport javax.websocket.ClientEndpoint;\nimport javax.websocket.ContainerProvider;\nimport javax.websocket.OnClose;\nimport javax.websocket.OnError;\nimport javax.websocket.OnMessage;\nimport javax.websocket.OnOpen;\nimport javax.websocket.Session;\nimport javax.websocket.WebSocketContainer;\n\n/**\n * Websocket Endpoint implementation class WebSocketClientMain\n */\n\n@ClientEndpoint\npublic class WebSocketClientMain {\n\n    public WebSocketClientMain() {\n        super();\n    }\n\n    @OnOpen\n    public void onOpen(Session session) {\n        /* \u30bb\u30c3\u30b7\u30e7\u30f3\u78ba\u7acb\u6642\u306e\u51e6\u7406 */\n        System.err.println(\"[\u30bb\u30c3\u30b7\u30e7\u30f3\u78ba\u7acb]\");\n    }\n\n    @OnMessage\n    public void onMessage(String message) {\n        /* \u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1\u6642\u306e\u51e6\u7406 */\n        System.err.println(\"[\u53d7\u4fe1]:\" + message);\n    }\n\n    @OnError\n    public void onError(Throwable th) {\n        /* \u30a8\u30e9\u30fc\u767a\u751f\u6642\u306e\u51e6\u7406 */\n    }\n\n    @OnClose\n    public void onClose(Session session) {\n        /* \u30bb\u30c3\u30b7\u30e7\u30f3\u89e3\u653e\u6642\u306e\u51e6\u7406 */\n    }\n\n    static public void main(String[] args) throws Exception {\n\n        // \u521d\u671f\u5316\u306e\u305f\u3081 WebSocket \u30b3\u30f3\u30c6\u30ca\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u53d6\u5f97\u3059\u308b\n        WebSocketContainer container = ContainerProvider\n                .getWebSocketContainer();\n        // \u30b5\u30fc\u30d0\u30fc\u30fb\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e URI\n        URI uri = URI\n                .create(\"ws://localhost:9080/hellowebsocket/helloendpoint\");\n        // \u30b5\u30fc\u30d0\u30fc\u30fb\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3068\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u78ba\u7acb\u3059\u308b\n        Session session = container.connectToServer(new WebSocketClientMain(),\n                uri);\n\n        session.getBasicRemote().sendText(\"\u3053\u3093\u306b\u3061\u306f\");\n\n        while (session.isOpen()) {\n            Thread.sleep(100 * 1000);\n            System.err.println(\"open\");\n        }\n\n    }\n\n}\n\n\n\n\u53c2\u8003\u306b\u3057\u305f\u30da\u30fc\u30b8\n\nWebSocket Server (Java)\n\n\u300cWebSphere Application Server Liberty Core\u300d\u3067\u65b0\u305f\u306b\u6b63\u5f0f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u305fWebSocket\u3092\u4f7f\u3063\u3066\u307f\u305f (1/6)\uff1aCodeZine\uff08\u30b3\u30fc\u30c9\u30b8\u30f3\uff09\nhttps://codezine.jp/article/detail/8418\n\n\nWebSocket Client (Java)\n\nWebSocket \u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u4f5c\u3063\u3066\u307f\u305f (Java \u3067)\nhttp://service.cresco.co.jp/blog/entry/184\n\n```java:HelloEndPoint.java\npackage pkg;\n\nimport java.io.IOException;\nimport java.util.Set;\n\nimport javax.websocket.CloseReason;\nimport javax.websocket.EndpointConfig;\nimport javax.websocket.OnClose;\nimport javax.websocket.OnError;\nimport javax.websocket.OnMessage;\nimport javax.websocket.OnOpen;\nimport javax.websocket.Session;\nimport javax.websocket.server.ServerEndpoint;\n\n/**\n * Websocket Endpoint implementation class HelloEndPoint\n */\n\n@ServerEndpoint(\"/helloendpoint\")\npublic class HelloEndPoint {\n\n\t// \u73fe\u5728\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u8a18\u9332\n\tSession currentSession = null;\n\n\tpublic HelloEndPoint() {\n\t\tsuper();\n\t}\n\n\t/*\n\t * \u63a5\u7d9a\u304c\u30aa\u30fc\u30d7\u30f3\u3057\u305f\u3068\u304d\n\t */\n\t@OnOpen\n\tpublic void onOpen(Session session, EndpointConfig ec) {\n\t\tthis.currentSession = session;\n\t}\n\n\t/*\n\t * \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u305f\u3068\u304d\n\t */\n\t@OnMessage\n\tpublic void receiveMessage(String msg) throws IOException {\n\t\t// \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u9001\u4fe1\u3059\u308b\n\t\tthis.currentSession.getBasicRemote().sendText(\"Hello \" + msg + \".\");\n\n\t\tSet<Session> sessions = currentSession.getOpenSessions();\n\t\tfor (Session session : sessions) {\n\t\t\ttry {\n\t\t\t\tsession.getBasicRemote().sendText(\"Hello \" + msg + \".(2)\");\n\t\t\t} catch (IOException e) {\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t}\n\t}\n\n\t/*\n\t * \u63a5\u7d9a\u304c\u30af\u30ed\u30fc\u30ba\u3057\u305f\u3068\u304d\n\t */\n\t@OnClose\n\tpublic void onClose(Session session, CloseReason reason) {\n\t\t// ...\n\t}\n\n\t/*\n\t * \u63a5\u7d9a\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\u3068\u304d\n\t */\n\t@OnError\n\tpublic void onError(Throwable t) {\n\t\t// ...\n\t}\n\n}\n```\n\n```java:WebSocketClientMain\npackage pkg;\n\nimport java.net.URI;\n\nimport javax.websocket.ClientEndpoint;\nimport javax.websocket.ContainerProvider;\nimport javax.websocket.OnClose;\nimport javax.websocket.OnError;\nimport javax.websocket.OnMessage;\nimport javax.websocket.OnOpen;\nimport javax.websocket.Session;\nimport javax.websocket.WebSocketContainer;\n\n/**\n * Websocket Endpoint implementation class WebSocketClientMain\n */\n\n@ClientEndpoint\npublic class WebSocketClientMain {\n\n\tpublic WebSocketClientMain() {\n\t\tsuper();\n\t}\n\n\t@OnOpen\n\tpublic void onOpen(Session session) {\n\t\t/* \u30bb\u30c3\u30b7\u30e7\u30f3\u78ba\u7acb\u6642\u306e\u51e6\u7406 */\n\t\tSystem.err.println(\"[\u30bb\u30c3\u30b7\u30e7\u30f3\u78ba\u7acb]\");\n\t}\n\n\t@OnMessage\n\tpublic void onMessage(String message) {\n\t\t/* \u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1\u6642\u306e\u51e6\u7406 */\n\t\tSystem.err.println(\"[\u53d7\u4fe1]:\" + message);\n\t}\n\n\t@OnError\n\tpublic void onError(Throwable th) {\n\t\t/* \u30a8\u30e9\u30fc\u767a\u751f\u6642\u306e\u51e6\u7406 */\n\t}\n\n\t@OnClose\n\tpublic void onClose(Session session) {\n\t\t/* \u30bb\u30c3\u30b7\u30e7\u30f3\u89e3\u653e\u6642\u306e\u51e6\u7406 */\n\t}\n\n\tstatic public void main(String[] args) throws Exception {\n\n\t\t// \u521d\u671f\u5316\u306e\u305f\u3081 WebSocket \u30b3\u30f3\u30c6\u30ca\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u53d6\u5f97\u3059\u308b\n\t\tWebSocketContainer container = ContainerProvider\n\t\t\t\t.getWebSocketContainer();\n\t\t// \u30b5\u30fc\u30d0\u30fc\u30fb\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e URI\n\t\tURI uri = URI\n\t\t\t\t.create(\"ws://localhost:9080/hellowebsocket/helloendpoint\");\n\t\t// \u30b5\u30fc\u30d0\u30fc\u30fb\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3068\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u78ba\u7acb\u3059\u308b\n\t\tSession session = container.connectToServer(new WebSocketClientMain(),\n\t\t\t\turi);\n\n\t\tsession.getBasicRemote().sendText(\"\u3053\u3093\u306b\u3061\u306f\");\n\n\t\twhile (session.isOpen()) {\n\t\t\tThread.sleep(100 * 1000);\n\t\t\tSystem.err.println(\"open\");\n\t\t}\n\n\t}\n\n}\n```\n\n\n\n", "tags": ["websocket", "Java"]}