{"context": " More than 1 year has passed since last update.rake assets:precompile\u3067\u51fa\u529b\u3055\u308c\u308b\u30d5\u30a1\u30a4\u30eb\u3092 Amazon S3 \u306a\u3069\u3067\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u3057\u305f\u3044\u5834\u5408\u3001asset_sync \u3068\u3044\u3046 gem \u304c\u4fbf\u5229\u305d\u3046\u306a\u306e\u3067\u4f7f\u3063\u3066\u307f\u307e\u3057\u305f\u3002\nasset_sync \u306frake assets:precompile\u5b9f\u884c\u6642\u306b Amazon S3 \u306b\u51fa\u529b\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u304f\u308c\u308b\u512a\u308c\u3082\u306e\u3067\u3059\u304c\u3001\u30c7\u30d7\u30ed\u30a4\u5148\u306e\u30b5\u30fc\u30d0\u30fc\u304c\u8907\u6570\u53f0\u3042\u308b\u5834\u5408\u3001\u8907\u6570\u53f0\u3067\u305d\u308c\u305e\u308crake assets:precompile\u3092\u5b9f\u884c\u3057\u3066\u3057\u307e\u3046\u306e\u306f\u5197\u9577\u3067\u3059\u3057\u3001on primary(:web)\u3068\u304b\u3059\u308b\u3068 manifest \u30d5\u30a1\u30a4\u30eb\u914d\u308b\u306e\u306f\u3069\u3046\u3057\u3088\u3046\u3002git \u306b push \u3059\u308b\u306e\u3082\u30ed\u30b0\u304c\u6c5a\u308c\u3066\u30a4\u30e4\u3060\u306a\u30fc\u3063\u3068\u3001\u3053\u308c\u307e\u305f\u60a9\u307f\u305d\u3046\u3067\u3059\u3002\n\u305d\u3053\u3067\u3001\u4eca\u56de\u306f\u30c7\u30d7\u30ed\u30a4\u6642\u306b\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u3067rake assets:precompile\u3092\u3057\u3066\u304b\u3089\u3001manifest \u30d5\u30a1\u30a4\u30eb\u3092\u30c7\u30d7\u30ed\u30a4\u5148\u30b5\u30fc\u30d0\u30fc\u306b\u914d\u308b\u65b9\u5f0f\u3092\u3068\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u4eca\u56de\u306e\u74b0\u5883\n\ncapistrano \u3068 rails\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 \u306f\u5225\u3005\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3067\u7ba1\u7406\nasset_sync \u306e\u8a2d\u5b9a\u306f dotenv-rails \u3067\u7ba1\u7406\n\u30c7\u30d7\u30ed\u30a4\u5148\u306e\u30b5\u30fc\u30d0\u30fc\u306f\u8907\u6570\u53f0\n\u74b0\u5883\u3054\u3068\u306b asset_sync \u3057\u305f\u308a\u3001\u901a\u5e38\u901a\u308a assets:precompile \u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u3044\n\n\n\u5404\u7a2e\u8a2d\u5b9a\n\nRails \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\nasset_sync \u3068\u3001\u305d\u306e\u8a2d\u5b9a\u5185\u5bb9\u306e\u7ba1\u7406\u306b dotenv-rails \u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\nGemfile\ngem 'asset_sync'\ngem 'dotenv-rails'\n\n\n\nconfig/asset_sync.yml\ndefaults: &defaults\n  enabled:               <%= ENV['ASSET_SYNC_ENABLED'] %>\n  fog_provider:          <%= ENV['ASSET_SYNC_PROVIDER'] %>\n  fog_directory:         <%= ENV['ASSET_SYNC_FOG_DIRECTORY'] %>\n  fog_region:            <%= ENV['ASSET_SYNC_FOG_REGION'] %>\n  fog_endpoint:          <%= ENV['ASSET_SYNC_FOG_ENDPOINT'] %>\n  aws_access_key_id:     <%= ENV['ASSET_SYNC_AWS_ACCESS_KEY_ID'] %>\n  aws_secret_access_key: <%= ENV['ASSET_SYNC_AWS_SECRET_ACCESS_KEY'] %>\n  existing_remote_files: 'keep'\n  manifest:              true\n  gzip_compression:      true\n\ndevelopment:\n  <<: *defaults\n\nstaging:\n  <<: *defaults\n\nproduction:\n  <<: *defaults\n\n\n\n.env\n# asset_sync\nASSET_SYNC_ENABLED=false\nASSET_SYNC_PROVIDER=''\nASSET_SYNC_FOG_DIRECTORY=''\nASSET_SYNC_FOG_REGION=''\nASSET_SYNC_FOG_ENDPOINT=''\nASSET_SYNC_AWS_ACCESS_KEY_ID=''\nASSET_SYNC_AWS_SECRET_ACCESS_KEY=''\n\n\n\nCapistrano\n\u4eca\u56de\u3001capistrano \u3068 Rails \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 \u306f\u5225\u3005\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3067\u7ba1\u7406\u3057\u3066\u3044\u305f\u305f\u3081\u3001\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u306b Rails \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3059\u308b\u30bf\u30b9\u30af\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u6700\u65b0\u30bd\u30fc\u30b9\u3092 git \u304b\u3089\u53d6\u5f97\u3057\u3001bundle install\u3001\u74b0\u5883\u5909\u6570\u3092\u7ba1\u7406\u3059\u308b .env \u30d5\u30a1\u30a4\u30eb\u3092\u8a2d\u7f6e\u3057\u3066\u3044\u307e\u3059\u3002\n\nlib/capistrano/tasks/application.cap\nnamespace :application do\n\n  desc 'Setup local application'\n  task :setup do\n    run_locally do\n      # application \u306e\u30bd\u30fc\u30b9\u3092\u53d6\u5f97\n      if test \"[ ! -d #{fetch(:application)} ]\"\n        execute :git, :clone, fetch(:repo_url), fetch(:application)\n      end\n\n      Dir.chdir(fetch(:application)) do\n        # \u6700\u65b0\u30bd\u30fc\u30b9\u3092\u53d6\u5f97\n        execute :git, :checkout, fetch(:branch)\n        execute :git, :fetch,    \"origin\"\n        execute :git, :reset,    \"--hard origin/#{fetch(:branch)}\"\n        # bundle install\n        Bundler.with_clean_env do \n          execute \"bundle install --path ./vendor/bundle\"\n        end\n\n        # .env \u3092\u8a2d\u7f6e\n        execute :rm, \"-rf .env\"\n        execute :ln, \"-s ../config/deploy/env/env.#{fetch(:rails_env)} .env\"\n      end\n    end\n  end\n\nend\n\n\n\u74b0\u5883\u3054\u3068\u306b asset_sync \u306e\u6709\u52b9/\u7121\u52b9\u3092\u5207\u308a\u66ff\u3048\u308b\u305f\u3081\u306b\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nconfig/deploy/production.rb\nset :asset_sync_enabled, true\n\n\nasset_sync \u306e\u30bf\u30b9\u30af\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\nasset_sync_enabled \u304c true \u306e\u5834\u5408\u306f\u3001asset_sync \u3092\u5b9f\u884c\u3057\u3001false \u306e\u5834\u5408\u306f\u901a\u5e38\u901a\u308a\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0\u30fc\u4e0a\u3067 assets:precompile \u3092\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u3002\n\nlib/capistrano/tasks/asset_sync.cap\nnamespace :deploy do\n  namespace :asset_sync do\n\n    desc 'Run asset_sync'\n    task :run do\n      if fetch(:asset_sync_enabled)\n        invoke 'application:setup'\n        invoke 'deploy:asset_sync:precompile'\n        invoke 'deploy:asset_sync:upload_manifest'\n        invoke 'deploy:asset_sync:cleanup'\n\n        Rake::Task['deploy:compile_assets'].clear_actions\n      end\n    end\n\n    desc 'Run assets:precompile'\n    task :precompile do\n      run_locally do\n        Dir.chdir(fetch(:application)) do\n          Bundler.with_clean_env do \n            execute \"bundle exec rake assets:precompile RAILS_ENV=#{fetch(:rails_env)} ASSET_SYNC_ENABLED=#{fetch(:asset_sync_enabled)}\"\n          end\n        end\n      end\n    end \n\n    desc 'Upload manifest'\n    task :upload_manifest do\n      Dir.chdir(fetch(:application)) do\n        on roles(fetch(:assets_roles)) do\n          if test \"[ ! -d #{release_path}/public/assets ]\"\n            execute \"mkdir -p #{release_path}/public/assets\"\n          end\n          file_path = Dir::glob('public/assets/manifest*').first\n          upload!(file_path, \"#{release_path}/public/assets/\")\n        end\n      end\n    end\n\n    desc 'Cleanup assets'\n    task :cleanup do\n      run_locally do\n        Dir.chdir(fetch(:application)) do\n          Bundler.with_clean_env do \n            execute \"bundle exec rake assets:clobber\"\n          end\n        end\n      end\n    end \n\n  end\nend\n\n\n\u30c7\u30d7\u30ed\u30a4\u6642\u306b\u30bf\u30b9\u30af\u304c\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nconfig/deploy.rb\nnamespace :deploy do\n  before :starting, 'asset_sync:run'\nend\n\n\n\nDeploy\n\u3042\u3068\u306f\u3001\n$ bundle exec cap production deploy\n\n\u3092\u5b9f\u884c\u3059\u308b\u3068\u30c7\u30d7\u30ed\u30a4\u6642\u306b asset_sync \u304c\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\n\u53c2\u8003\n\u4eca\u56de\u3001\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u3044\u305f\u8a18\u4e8b\u306f\u3053\u3061\u3089\u3067\u3059\u3002\nCapistrano3\u3067asset_sync\u3057\u3066\u304b\u3089\u30c7\u30d7\u30ed\u30a4\u3059\u308b\n<code>rake assets:precompile</code>\u3067\u51fa\u529b\u3055\u308c\u308b\u30d5\u30a1\u30a4\u30eb\u3092 Amazon S3 \u306a\u3069\u3067\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u3057\u305f\u3044\u5834\u5408\u3001asset_sync \u3068\u3044\u3046 gem \u304c\u4fbf\u5229\u305d\u3046\u306a\u306e\u3067\u4f7f\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\nasset_sync \u306f<code>rake assets:precompile</code>\u5b9f\u884c\u6642\u306b Amazon S3 \u306b\u51fa\u529b\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u304f\u308c\u308b\u512a\u308c\u3082\u306e\u3067\u3059\u304c\u3001\u30c7\u30d7\u30ed\u30a4\u5148\u306e\u30b5\u30fc\u30d0\u30fc\u304c\u8907\u6570\u53f0\u3042\u308b\u5834\u5408\u3001\u8907\u6570\u53f0\u3067\u305d\u308c\u305e\u308c<code>rake assets:precompile</code>\u3092\u5b9f\u884c\u3057\u3066\u3057\u307e\u3046\u306e\u306f\u5197\u9577\u3067\u3059\u3057\u3001<code>on primary(:web)</code>\u3068\u304b\u3059\u308b\u3068 manifest \u30d5\u30a1\u30a4\u30eb\u914d\u308b\u306e\u306f\u3069\u3046\u3057\u3088\u3046\u3002git \u306b push \u3059\u308b\u306e\u3082\u30ed\u30b0\u304c\u6c5a\u308c\u3066\u30a4\u30e4\u3060\u306a\u30fc\u3063\u3068\u3001\u3053\u308c\u307e\u305f\u60a9\u307f\u305d\u3046\u3067\u3059\u3002\n\n\u305d\u3053\u3067\u3001\u4eca\u56de\u306f\u30c7\u30d7\u30ed\u30a4\u6642\u306b\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u3067<code>rake assets:precompile</code>\u3092\u3057\u3066\u304b\u3089\u3001manifest \u30d5\u30a1\u30a4\u30eb\u3092\u30c7\u30d7\u30ed\u30a4\u5148\u30b5\u30fc\u30d0\u30fc\u306b\u914d\u308b\u65b9\u5f0f\u3092\u3068\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n\n## \u4eca\u56de\u306e\u74b0\u5883\n\n- capistrano \u3068 rails\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 \u306f\u5225\u3005\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3067\u7ba1\u7406\n- asset_sync \u306e\u8a2d\u5b9a\u306f dotenv-rails \u3067\u7ba1\u7406\n- \u30c7\u30d7\u30ed\u30a4\u5148\u306e\u30b5\u30fc\u30d0\u30fc\u306f\u8907\u6570\u53f0\n- \u74b0\u5883\u3054\u3068\u306b asset_sync \u3057\u305f\u308a\u3001\u901a\u5e38\u901a\u308a assets:precompile \u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u3044\n\n\n\n# \u5404\u7a2e\u8a2d\u5b9a\n\n## Rails \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\n\nasset_sync \u3068\u3001\u305d\u306e\u8a2d\u5b9a\u5185\u5bb9\u306e\u7ba1\u7406\u306b dotenv-rails \u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\n```rb:Gemfile\ngem 'asset_sync'\ngem 'dotenv-rails'\n```\n\n```erb:config/asset_sync.yml\ndefaults: &defaults\n  enabled:               <%= ENV['ASSET_SYNC_ENABLED'] %>\n  fog_provider:          <%= ENV['ASSET_SYNC_PROVIDER'] %>\n  fog_directory:         <%= ENV['ASSET_SYNC_FOG_DIRECTORY'] %>\n  fog_region:            <%= ENV['ASSET_SYNC_FOG_REGION'] %>\n  fog_endpoint:          <%= ENV['ASSET_SYNC_FOG_ENDPOINT'] %>\n  aws_access_key_id:     <%= ENV['ASSET_SYNC_AWS_ACCESS_KEY_ID'] %>\n  aws_secret_access_key: <%= ENV['ASSET_SYNC_AWS_SECRET_ACCESS_KEY'] %>\n  existing_remote_files: 'keep'\n  manifest:              true\n  gzip_compression:      true\n\ndevelopment:\n  <<: *defaults\n\nstaging:\n  <<: *defaults\n\nproduction:\n  <<: *defaults\n```\n\n```sh:.env\n# asset_sync\nASSET_SYNC_ENABLED=false\nASSET_SYNC_PROVIDER=''\nASSET_SYNC_FOG_DIRECTORY=''\nASSET_SYNC_FOG_REGION=''\nASSET_SYNC_FOG_ENDPOINT=''\nASSET_SYNC_AWS_ACCESS_KEY_ID=''\nASSET_SYNC_AWS_SECRET_ACCESS_KEY=''\n```\n\n\n## Capistrano\n\n\u4eca\u56de\u3001capistrano \u3068 Rails \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 \u306f\u5225\u3005\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3067\u7ba1\u7406\u3057\u3066\u3044\u305f\u305f\u3081\u3001\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u306b Rails \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3059\u308b\u30bf\u30b9\u30af\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u6700\u65b0\u30bd\u30fc\u30b9\u3092 git \u304b\u3089\u53d6\u5f97\u3057\u3001<code>bundle install</code>\u3001\u74b0\u5883\u5909\u6570\u3092\u7ba1\u7406\u3059\u308b .env \u30d5\u30a1\u30a4\u30eb\u3092\u8a2d\u7f6e\u3057\u3066\u3044\u307e\u3059\u3002\n\n```rb:lib/capistrano/tasks/application.cap\nnamespace :application do\n\n  desc 'Setup local application'\n  task :setup do\n    run_locally do\n      # application \u306e\u30bd\u30fc\u30b9\u3092\u53d6\u5f97\n      if test \"[ ! -d #{fetch(:application)} ]\"\n        execute :git, :clone, fetch(:repo_url), fetch(:application)\n      end\n\n      Dir.chdir(fetch(:application)) do\n        # \u6700\u65b0\u30bd\u30fc\u30b9\u3092\u53d6\u5f97\n        execute :git, :checkout, fetch(:branch)\n        execute :git, :fetch,    \"origin\"\n        execute :git, :reset,    \"--hard origin/#{fetch(:branch)}\"\n        # bundle install\n        Bundler.with_clean_env do \n          execute \"bundle install --path ./vendor/bundle\"\n        end\n\n        # .env \u3092\u8a2d\u7f6e\n        execute :rm, \"-rf .env\"\n        execute :ln, \"-s ../config/deploy/env/env.#{fetch(:rails_env)} .env\"\n      end\n    end\n  end\n\nend\n```\n\n\u74b0\u5883\u3054\u3068\u306b asset_sync \u306e\u6709\u52b9/\u7121\u52b9\u3092\u5207\u308a\u66ff\u3048\u308b\u305f\u3081\u306b\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```rb:config/deploy/production.rb\nset :asset_sync_enabled, true\n```\n\nasset_sync \u306e\u30bf\u30b9\u30af\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\nasset_sync_enabled \u304c true \u306e\u5834\u5408\u306f\u3001asset_sync \u3092\u5b9f\u884c\u3057\u3001false \u306e\u5834\u5408\u306f\u901a\u5e38\u901a\u308a\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0\u30fc\u4e0a\u3067 assets:precompile \u3092\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u3002\n\n```rb:lib/capistrano/tasks/asset_sync.cap\nnamespace :deploy do\n  namespace :asset_sync do\n\n    desc 'Run asset_sync'\n    task :run do\n      if fetch(:asset_sync_enabled)\n        invoke 'application:setup'\n        invoke 'deploy:asset_sync:precompile'\n        invoke 'deploy:asset_sync:upload_manifest'\n        invoke 'deploy:asset_sync:cleanup'\n\n        Rake::Task['deploy:compile_assets'].clear_actions\n      end\n    end\n\n    desc 'Run assets:precompile'\n    task :precompile do\n      run_locally do\n        Dir.chdir(fetch(:application)) do\n          Bundler.with_clean_env do \n            execute \"bundle exec rake assets:precompile RAILS_ENV=#{fetch(:rails_env)} ASSET_SYNC_ENABLED=#{fetch(:asset_sync_enabled)}\"\n          end\n        end\n      end\n    end \n\n    desc 'Upload manifest'\n    task :upload_manifest do\n      Dir.chdir(fetch(:application)) do\n        on roles(fetch(:assets_roles)) do\n          if test \"[ ! -d #{release_path}/public/assets ]\"\n            execute \"mkdir -p #{release_path}/public/assets\"\n          end\n          file_path = Dir::glob('public/assets/manifest*').first\n          upload!(file_path, \"#{release_path}/public/assets/\")\n        end\n      end\n    end\n\n    desc 'Cleanup assets'\n    task :cleanup do\n      run_locally do\n        Dir.chdir(fetch(:application)) do\n          Bundler.with_clean_env do \n            execute \"bundle exec rake assets:clobber\"\n          end\n        end\n      end\n    end \n\n  end\nend\n```\n\n\u30c7\u30d7\u30ed\u30a4\u6642\u306b\u30bf\u30b9\u30af\u304c\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```rb:config/deploy.rb\nnamespace :deploy do\n  before :starting, 'asset_sync:run'\nend\n```\n\n# Deploy\n\n\u3042\u3068\u306f\u3001\n\n```\n$ bundle exec cap production deploy\n```\n\n\u3092\u5b9f\u884c\u3059\u308b\u3068\u30c7\u30d7\u30ed\u30a4\u6642\u306b asset_sync \u304c\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\n\n# \u53c2\u8003\n\n\u4eca\u56de\u3001\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u3044\u305f\u8a18\u4e8b\u306f\u3053\u3061\u3089\u3067\u3059\u3002\n[Capistrano3\u3067asset_sync\u3057\u3066\u304b\u3089\u30c7\u30d7\u30ed\u30a4\u3059\u308b](http://qiita.com/rmacchoj7/items/f92568fd8970860f189e)\n\n\n\n", "tags": ["asset_sync1.1.0", "Rails4.2.1", "capistrano3.2.1"]}