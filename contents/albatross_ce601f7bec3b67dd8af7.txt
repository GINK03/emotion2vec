{"tags": ["ModSecurity2.8.0"], "context": " More than 1 year has passed since last update.ModSecurity \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f Nginx \u3092\u518d\u8d77\u52d5\u3059\u308b\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u4e0b\u8a18\u306e\u3088\u3046\u306a\u30af\u30a8\u30ea\u304c\u51fa\u308b\u3053\u3068\u306b\u6c17\u3065\u3044\u305f\u3002\n# tcpdump -nn -i eth0 port 53\n19:59:38.900056 IP 192.168.37.10.48175 > 204.13.200.240.53: 14893 A? GIXDQLRQFRGW6ZCTMVRXK4TJOR4SAU3U.MFXGIYLMN5XGKLBRFYZS4OJPGEXDGLRZ.FQ3S4OBPG4XDQIBSGAYDQLJQHEWTANJM.FBXHK3DMFEWDELRXFY3CYMDEHE3TCY3G.HE4WINTFHBTDENJUGRTDKNDFMU3GCMTG.GU3TCMTCGE2DAM3EMI2GG.1405076378.status.modsecurity.org. (238)\n19:59:39.079151 IP 204.13.200.240.53 > 192.168.37.10.48175: 14893*- 1/1/1 A 204.13.200.240 (388)\n\n\u3059\u3054\u304f\u76ee\u7acb\u3064\u306e\u3067\u6c17\u306b\u306a\u3063\u3066\u8abf\u67fb\n$ grep -r status.modsecurity.org *\napache2/msc_status_engine.h:#define STATUS_ENGINE_DNS_SUFFIX \"status.modsecurity.org\"\n$ grep -r STATUS_ENGINE_DNS_SUFFIX *\napache2/msc_status_engine.c:    length = str_enc_spl_len + strlen(STATUS_ENGINE_DNS_SUFFIX) +\napache2/msc_status_engine.c:            (long) ltime, STATUS_ENGINE_DNS_SUFFIX);\napache2/msc_status_engine.c:            \"information visit: http://%s/\", STATUS_ENGINE_DNS_SUFFIX);\napache2/msc_status_engine.h:#define STATUS_ENGINE_DNS_SUFFIX \"status.modsecurity.org\"\n\n\napache2/msc_status_engine.c\nint DSOLOCAL msc_status_engine_prepare_hostname (char *hostname, const char *plain_data,\n        int max_length)\n{\n/* \u6295\u7a3f\u8005\u306b\u3088\u308b\u7701\u7565 */\n    apr_snprintf(hostname, max_length, \"%s.%ld.%s\", hostname,\n            (long) ltime, STATUS_ENGINE_DNS_SUFFIX);\n\nfailed_enc_spl:\n    free(tmp);\nfailed_strdup:\nreturn_length:\nfailed_enc_spl_len:\n    return length;\n}\n\nint msc_status_engine_call (void) {\n/* \u6295\u7a3f\u8005\u306b\u3088\u308b\u7701\u7565 */\n    hostname_len = msc_status_engine_prepare_hostname(hostname, beacon_str,\n            hostname_len);\n    if (hostname_len < 0) {\n        goto failed_hostname;\n    }\n\n    /* Perform the DNS query. */\n    if (gethostbyname(hostname)) {\n        ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, NULL,\n            \"ModSecurity: StatusEngine call successfully sent. For more \" \\\n            \"information visit: http://%s/\", STATUS_ENGINE_DNS_SUFFIX);\n    } else {\n        ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, NULL,\n            \"ModSecurity: StatusEngine call failed. Query: %s\",\n            hostname);\n    }\n\n    ret = 0;\n\nfailed_hostname:\n    free(hostname);\nfailed_hostname_malloc:\nfailed_hostname_len:\n    free(beacon_str);\nfailed_beacon_string_malloc:\n\n    return ret;\n}\n\n\n2.8.0 \u304b\u3089\u8ffd\u52a0\u3055\u308c\u305f\u3088\u3046\u3060\u3002\n\u30db\u30b9\u30c8\u540d\u3068MAC\u30a2\u30c9\u30ec\u30b9\u3092\u30d9\u30fc\u30b9\u306b\u751f\u6210\u3057\u305f\u30af\u30a8\u30ea\u3092\u6295\u3052\u308b\u3089\u3057\u3044\u3002\nhttps://github.com/SpiderLabs/ModSecurity/commit/0c6a661c696e0cb248cf79e32a20aaccb95c3926\n\u30d1\u30c3\u3068\u898b\u3067\u602a\u3057\u304f\u3066\u5acc\u306a\u306e\u3067\u6b62\u3081\u305f\u3044\u3002\n$ grep -r msc_status_engine_call *\napache2/mod_security2.c:            msc_status_engine_call();\napache2/msc_status_engine.c:int msc_status_engine_call (void) {\napache2/msc_status_engine.h:int msc_status_engine_call(void);\nstandalone/api.c:        msc_status_engine_call();\n\n\napache2/mod_security2.c\n        if (status_engine_state != STATUS_ENGINE_DISABLED) {\n            msc_status_engine_call();\n        }\n        else {\n            ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, NULL,\n                    \"Status engine is currently disabled, enable it by set \" \\\n                    \"SecStatusEngine to On.\");\n        }\n\n\nSecStatusEngine On \u3067\u6709\u52b9\u306b\u306a\u308b\u3089\u3057\u3044\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u7121\u52b9\uff1f\nhttps://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#SecStatusEngine\n\u3068\u3044\u3046\u8a33\u3067\u3001SecStatusEngine Off \u3092\u8a2d\u5b9a\u3057\u3066\u89e3\u6c7a\u3002\nmodsecurity.conf-recommended \u3092\u305d\u306e\u307e\u307e\u30b3\u30d4\u30fc\u3057\u3066\u4f7f\u3063\u3066\u308b\u305b\u3044\u3067\u7406\u89e3\u3067\u304d\u3066\u3044\u306a\u3044\u306a\u3002\n\nModSecurity \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f Nginx \u3092\u518d\u8d77\u52d5\u3059\u308b\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u4e0b\u8a18\u306e\u3088\u3046\u306a\u30af\u30a8\u30ea\u304c\u51fa\u308b\u3053\u3068\u306b\u6c17\u3065\u3044\u305f\u3002\n\n```console\n# tcpdump -nn -i eth0 port 53\n19:59:38.900056 IP 192.168.37.10.48175 > 204.13.200.240.53: 14893 A? GIXDQLRQFRGW6ZCTMVRXK4TJOR4SAU3U.MFXGIYLMN5XGKLBRFYZS4OJPGEXDGLRZ.FQ3S4OBPG4XDQIBSGAYDQLJQHEWTANJM.FBXHK3DMFEWDELRXFY3CYMDEHE3TCY3G.HE4WINTFHBTDENJUGRTDKNDFMU3GCMTG.GU3TCMTCGE2DAM3EMI2GG.1405076378.status.modsecurity.org. (238)\n19:59:39.079151 IP 204.13.200.240.53 > 192.168.37.10.48175: 14893*- 1/1/1 A 204.13.200.240 (388)\n```\n\n\u3059\u3054\u304f\u76ee\u7acb\u3064\u306e\u3067\u6c17\u306b\u306a\u3063\u3066\u8abf\u67fb\n\n```console\n$ grep -r status.modsecurity.org *\napache2/msc_status_engine.h:#define STATUS_ENGINE_DNS_SUFFIX \"status.modsecurity.org\"\n$ grep -r STATUS_ENGINE_DNS_SUFFIX *\napache2/msc_status_engine.c:    length = str_enc_spl_len + strlen(STATUS_ENGINE_DNS_SUFFIX) +\napache2/msc_status_engine.c:            (long) ltime, STATUS_ENGINE_DNS_SUFFIX);\napache2/msc_status_engine.c:            \"information visit: http://%s/\", STATUS_ENGINE_DNS_SUFFIX);\napache2/msc_status_engine.h:#define STATUS_ENGINE_DNS_SUFFIX \"status.modsecurity.org\"\n```\n\n```c:apache2/msc_status_engine.c\nint DSOLOCAL msc_status_engine_prepare_hostname (char *hostname, const char *plain_data,\n        int max_length)\n{\n/* \u6295\u7a3f\u8005\u306b\u3088\u308b\u7701\u7565 */\n    apr_snprintf(hostname, max_length, \"%s.%ld.%s\", hostname,\n            (long) ltime, STATUS_ENGINE_DNS_SUFFIX);\n\nfailed_enc_spl:\n    free(tmp);\nfailed_strdup:\nreturn_length:\nfailed_enc_spl_len:\n    return length;\n}\n\nint msc_status_engine_call (void) {\n/* \u6295\u7a3f\u8005\u306b\u3088\u308b\u7701\u7565 */\n    hostname_len = msc_status_engine_prepare_hostname(hostname, beacon_str,\n            hostname_len);\n    if (hostname_len < 0) {\n        goto failed_hostname;\n    }\n\n    /* Perform the DNS query. */\n    if (gethostbyname(hostname)) {\n        ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, NULL,\n            \"ModSecurity: StatusEngine call successfully sent. For more \" \\\n            \"information visit: http://%s/\", STATUS_ENGINE_DNS_SUFFIX);\n    } else {\n        ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, NULL,\n            \"ModSecurity: StatusEngine call failed. Query: %s\",\n            hostname);\n    }\n\n    ret = 0;\n\nfailed_hostname:\n    free(hostname);\nfailed_hostname_malloc:\nfailed_hostname_len:\n    free(beacon_str);\nfailed_beacon_string_malloc:\n\n    return ret;\n}\n```\n\n2.8.0 \u304b\u3089\u8ffd\u52a0\u3055\u308c\u305f\u3088\u3046\u3060\u3002\n\u30db\u30b9\u30c8\u540d\u3068MAC\u30a2\u30c9\u30ec\u30b9\u3092\u30d9\u30fc\u30b9\u306b\u751f\u6210\u3057\u305f\u30af\u30a8\u30ea\u3092\u6295\u3052\u308b\u3089\u3057\u3044\u3002\nhttps://github.com/SpiderLabs/ModSecurity/commit/0c6a661c696e0cb248cf79e32a20aaccb95c3926\n\n\u30d1\u30c3\u3068\u898b\u3067\u602a\u3057\u304f\u3066\u5acc\u306a\u306e\u3067\u6b62\u3081\u305f\u3044\u3002\n\n```console\n$ grep -r msc_status_engine_call *\napache2/mod_security2.c:            msc_status_engine_call();\napache2/msc_status_engine.c:int msc_status_engine_call (void) {\napache2/msc_status_engine.h:int msc_status_engine_call(void);\nstandalone/api.c:        msc_status_engine_call();\n```\n\n```c:apache2/mod_security2.c\n        if (status_engine_state != STATUS_ENGINE_DISABLED) {\n            msc_status_engine_call();\n        }\n        else {\n            ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, NULL,\n                    \"Status engine is currently disabled, enable it by set \" \\\n                    \"SecStatusEngine to On.\");\n        }\n```\n\n\n`SecStatusEngine On` \u3067\u6709\u52b9\u306b\u306a\u308b\u3089\u3057\u3044\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u7121\u52b9\uff1f\nhttps://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#SecStatusEngine\n\n\u3068\u3044\u3046\u8a33\u3067\u3001`SecStatusEngine Off` \u3092\u8a2d\u5b9a\u3057\u3066\u89e3\u6c7a\u3002\nmodsecurity.conf-recommended \u3092\u305d\u306e\u307e\u307e\u30b3\u30d4\u30fc\u3057\u3066\u4f7f\u3063\u3066\u308b\u305b\u3044\u3067\u7406\u89e3\u3067\u304d\u3066\u3044\u306a\u3044\u306a\u3002\n\n"}