{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\uff1aSwift1.1 \u2192 Swift1.2 \u2192 Swift2.x\u3067\u5909\u66f4\u304c\u3042\u3063\u305fNSXMLParser\n\u73fe\u5728\u306fAPI\u304b\u3089\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066UITableView\u306b\u8868\u793a\u3059\u308b\u3088\u3046\u306a\u51e6\u7406\u3092\u3059\u308b\u5834\u5408\u3001\u30ec\u30b9\u30dd\u30f3\u30b9\u306fJSON\u3067\u53d7\u3051\u53d6\u308b\u5834\u5408\u304c\u591a\u3044\u304b\u3068\u601d\u3046\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306fSwift2.0\u3067XML\u306e\u89e3\u6790\uff06\u8aad\u307f\u8fbc\u307f\u3092\u3059\u308b\u5834\u5408\u306e\u5099\u5fd8\u9332\u3068\u3057\u3066\u8a18\u8f09\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\uff08\u516c\u958b\u3055\u308c\u3066\u3044\u308bAPI\u306f\u307b\u3068\u3093\u3069\u3069\u3061\u3089\u306e\u5f62\u5f0f\u3082\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u5834\u5408\u304c\u591a\u3044\uff09\n\n\u6ce8\u610f\u70b9\uff1aparser\u30e1\u30bd\u30c3\u30c9\u306eattributes attributeDict:\u304c\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u3088\u3063\u3066\u7570\u306a\u3063\u3066\u3044\u308b\nparser\u30e1\u30bd\u30c3\u30c9\u306b\u3064\u3044\u3066\u306f\u7279\u306b\u5927\u304d\u306a\u5909\u66f4\u70b9\u304c\u3042\u3063\u305f\u306e\u306f\u4e0b\u8a18\u306e\u90e8\u5206\u306b\u306a\u308a\u307e\u3059\u3002\n\u307e\u305f\u305d\u308c\u306b\u3088\u3063\u3066\u51e6\u7406\u3084\u4ed6\u306eparser\u30e1\u30bd\u30c3\u30c9\u306b\u3064\u3044\u3066\u3082optional\u306e\u4f4d\u7f6e\u3082\u5fae\u5999\u306b\u9055\u3063\u3066\u304f\u308b\u3068\u3053\u308d\u306b\u306f\u6ce8\u610f\u3057\u3066\u4e0b\u3055\u3044\u3002\nSwift1.1)\n\nxxx.swift\n\nparser(parser: NSXMLParser!, didStartElement elementName: String!, namespaceURI: String!, qualifiedName qName: String!, attributes attributeDict: NSDictionary!)\n\n\n\u2191attributeDict\u306fNSDictonary!\nSwift1.2)\n\nxxx.swift\n\nparser(parser: NSXMLParser!, didStartElement elementName: String!, namespaceURI: String!, qualifiedName qName: String!, attributes attributeDict: [NSObject : AnyObject]!)\n\n\n\u2191attributeDict\u306f[NSObject : AnyObject]!\nSwift2.x)\n\nxxx.swift\n\nparser(parser: NSXMLParser!, didStartElement elementName: String!, namespaceURI: String!, qualifiedName qName: String!, attributes attributeDict: [String : String])\n\n\n\u2191attributeDict\u306f[String : String]\n\u3053\u3093\u306a\u611f\u3058\u3067\u305d\u308c\u305e\u308c\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u7570\u306a\u308b\u3068\u5f53\u7136\u51e6\u7406\u3082\u5909\u308f\u3063\u3066\u304f\u308b\u305f\u3081\u3001Swift2.0\u3067XML\u3092\u89e3\u6790\u3059\u308b\u969b\u306e\u30dd\u30a4\u30f3\u30c8\u3092\u3056\u3063\u304f\u308a\u3068\u307e\u3068\u3081\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u30b3\u30fc\u30c9\uff1a\u5b9f\u969b\u306e\u51e6\u7406\u3067\u30dd\u30a4\u30f3\u30c8\u306b\u306a\u308b\u90e8\u5206\u306f\u3053\u3053\n\u25a0 \u4f7f\u7528API\uff1a\n\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u306f\u300c\u304a\u83d3\u5b50\u306e\u865c\u300dAPI\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\nhttp://www.sysbird.jp/toriko/webapi/\n\n\u5b9f\u969b\u306e\u3053\u306eAPI\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u306b\u95a2\u3057\u3066\u306f\u300c\u304a\u83d3\u5b50\u306e\u865c\u300d\u306e\u30da\u30fc\u30b8\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\n\u4eca\u56de\u306f\u4e0a\u8a18API\u3092\u4f7f\u7528\u3057\u3066\u30e9\u30f3\u30c0\u30e0\u3067\u30c7\u30fc\u30bf\u309230\u4ef6\u53d6\u5f97\u3059\u308b\u60f3\u5b9a\u3067\u66f8\u3044\u3066\u3044\u307e\u3059\nUITableView\u306b\u8868\u793a\u3059\u308b\u306e\u306f\u4ee5\u4e0b\u306e5\u3064\n\n\n\u304a\u83d3\u5b50\u540d\n\u304a\u83d3\u5b50\u306e\u30b5\u30e0\u30cd\u30a4\u30eb\n\u304a\u83d3\u5b50\u306e\u30e1\u30fc\u30ab\u30fc\u540d\n\u304a\u83d3\u5b50\u306e\u30ab\u30c6\u30b4\u30ea\u30fc\n\u304a\u83d3\u5b50\u306e\u5024\u6bb5\n\n\u203b\u3042\u307e\u308a\u7dba\u9e97\u306a\u51e6\u7406\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u53c2\u8003\u306b\u306a\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\n1. Delegate\u3084\u5909\u6570\u306e\u7528\u610f\n\nViewController.swift\uff08class\u306e\u5ba3\u8a00\u90e8\u5206\uff09\n\n//NSXMLParserDelegate\u3092\u8a18\u8f09\nclass ViewController: UIViewController, UITableViewDelegate, UITableViewDataSource, NSXMLParserDelegate\n\n\n\n\n2. \u30e1\u30f3\u30d0\u5909\u6570\u3084\u89e3\u6790\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3059\u308b\u5909\u6570\u3092\u7528\u610f\n\nViewController.swift\uff08\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5ba3\u8a00\u90e8\u5206\uff09\n\n//XML\u306e\u30d5\u30a3\u30fc\u30c9\u53d6\u5f97\u7528URL\nlet feedUrl : NSURL = NSURL(string:\"http://www.sysbird.jp/webapi/?apikey=guest&max=30&order=r\")!\n\n//XML\u306e\u73fe\u5728\u8981\u7d20\u540d\u3092\u5165\u308c\u308b\u5909\u6570\nvar currentElementName : String!\n\n//\u53d6\u5f97\u3059\u308b\u8981\u7d20\u540d(\u3068\u308a\u306f\u3058\u3081\u306e\u8981\u7d20)\nlet itemElementName : String  = \"item\"\n\n//\u53d6\u5f97\u3059\u308b\u8981\u7d20\u540d\u306e\u6c7a\u5b9a(item\u8981\u7d20\u306e\u4e0b\u306b\u3042\u308b\u3082\u306e)\nlet nameElementName  : String = \"name\"\nlet makerElementName : String = \"maker\"\nlet priceElementName : String = \"price\"\nlet typeElementName  : String = \"type\"\nlet urlElementName   : String = \"url\"\nlet imageElementName : String = \"image\"\n\n//\u5404\u30a8\u30ec\u30e1\u30f3\u30c8\u7528\u306e\u5909\u6570\nvar posts    = NSMutableArray()\nvar elements = NSMutableDictionary()\nvar element  = NSString()\nvar name     = NSMutableString()\nvar maker    = NSMutableString()\nvar price    = NSMutableString()\nvar type     = NSMutableString()\nvar url      = NSMutableString()\nvar image    = NSMutableString()\n\n\n\n\n3. viewDidLoad\u5185\u306e\u51e6\u7406\n\nViewController.swift\uff08viewDidLoad\u5185\uff09\n\noverride func viewDidLoad() {\n    super.viewDidLoad()\n\n    //\u89e3\u6790\u30c7\u30fc\u30bf\u683c\u7d0d\u7528\n    posts = []\n\n    //UITableView\u306b\u95a2\u3059\u308b\u51e6\u7406\u3092\u8a18\u8ff0 \n    ...(\u7701\u7565)...\n\n    //NSXMLParser\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u6e96\u5099\n    let parser : NSXMLParser = NSXMLParser(contentsOfURL: feedUrl)!\n\n    //XML\u30d1\u30fc\u30b5\u306e\u30c7\u30ea\u30b2\u30fc\u30c8\n    parser.delegate = self\n\n    //XML\u30d1\u30fc\u30b9\u306e\u5b9f\u884c\n    parser.parse()\n}\n\n\n\n\n4. XML\u30d1\u30fc\u30b9\u51e6\u7406\u5b9f\u884c\u958b\u59cb\u6642\u306b\u884c\u3046\u51e6\u7406\n\nViewController.swift\uff08NSXMLParser\uff09\n//\u4eca\u56de\u306f\u7279\u306b\u306a\u3044\u306e\u3067\u7a7a\u306e\u307e\u307e\nfunc parserDidStartDocument(parser: NSXMLParser) {\n}\n\n\n\n\n5. XML\u30d1\u30fc\u30b9\u51e6\u7406\u5b9f\u884c\u4e2d\u306b\u884c\u3046\u51e6\u7406\uff08NSXMLParser\uff09\nitem\u8981\u7d20\u3092\u898b\u3064\u3051\u308b \n\u203bXML\u306e\u8981\u7d20\u3092\u4e0a\u304b\u3089\u9806\u756a\u306b\u8abf\u3079\u3066\u3044\u304f\u30a4\u30e1\u30fc\u30b8\u3067\u51e6\u7406\u304c\u884c\u308f\u308c\u308b\u3002\n\nViewController.swift\uff08viewDidLoad\u5185\uff09\n\nfunc parser(parser: NSXMLParser, didStartElement elementName: String, namespaceURI: String?, qualifiedName qName: String?, attributes attributeDict: [String : String]) {\n\n   self.element = elementName\n\n   //\u8981\u7d20\u540d\u304c\u300citem\u300d\u306e\u8981\u7d20\u304c\u898b\u3064\u304b\u3063\u305f\u5834\u5408\u306b\u306f\u4e0a\u3067\u8a2d\u5b9a\u3057\u305f\u30e1\u30f3\u30d0\u5909\u6570\u3092\u521d\u671f\u5316\n   if (elementName as NSString).isEqualToString(self.itemElementName){\n       self.elements = [:]\n       self.name = \"\"\n       self.maker = \"\"\n       self.price = \"\"\n       self.type = \"\"\n       self.url = \"\"\n       self.image = \"\"\n    }\n}\n\n\n\n\n6. XML\u30d1\u30fc\u30b9\u51e6\u7406\u5b9f\u884c\u4e2d\u306b\u884c\u3046\u51e6\u7406\uff08NSXMLParser\uff09\nitem\u8981\u7d20\u5185\u304b\u3089\u3055\u3089\u306bname\u30fburl\u30fbprice\u30fbmaker\u30fburl\u30fbimage\u8981\u7d20\u3092\u898b\u3064\u3051\u3066item\u8981\u7d20\u3092\u898b\u3064\u3051\u305f\u969b\u306b\u7528\u610f\u3057\u305f\u5165\u308c\u7269\u306b\u5165\u308c\u3066\u3042\u3052\u308b\u3002\n\nViewController.swift\uff08NSXMLParser\uff09\nfunc parser(parser: NSXMLParser, foundCharacters string: String){\n\n    //\u3082\u3063\u3068\u30a8\u30ec\u30ac\u30f3\u30c8\u306b\u66f8\u304b\u306d\u3070...\n    if self.element.isEqualToString(self.nameElementName) {\n        self.name.appendString(\n            strip(string)\n        )\n    }\n\n    if self.element.isEqualToString(self.makerElementName) {\n        self.maker.appendString(\n            strip(string)\n        )\n    }\n\n    if self.element.isEqualToString(self.priceElementName) {\n        self.price.appendString(\n            strip(string)\n        )\n    }\n\n    if self.element.isEqualToString(self.typeElementName) {\n        self.type.appendString(\n            strip(string)\n        )\n    }\n\n    if self.element.isEqualToString(self.urlElementName) {\n        self.url.appendString(\n            strip(string)\n        )\n    }\n\n    if self.element.isEqualToString(self.imageElementName) {\n        self.image.appendString(\n            strip(string)\n        )\n    }\n}\n\n\n\n\u3053\u306e\u307e\u307e\u3060\u3068XML\u306e\u8981\u7d20\u3092\u53d6\u5f97\u3059\u308b\u969b\u306b\u4f59\u5206\u306a\u6539\u884c\u3084\u534a\u89d2\u30b9\u30da\u30fc\u30b9\u304c\u542b\u307e\u308c\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u6539\u884c\u3068\u534a\u89d2\u30b9\u30da\u30fc\u30b9\u306e\u9664\u53bb\u3092\u3059\u308b\u30e1\u30bd\u30c3\u30c9\u3082\u8ffd\u52a0\u3057\u3066\u304a\u304f\u3053\u3068\u306b\u3057\u307e\u3059\u3002\uff08\u6b63\u898f\u8868\u73fe\u3092\u4f7f\u3046\u3079\u304d\u3060\u306a...\uff09\n\nViewController.swift\uff08NSXMLParser\uff09\n//\u6539\u884c\u3068\u534a\u89d2\u30b9\u30da\u30fc\u30b9\u306e\u9664\u53bb\nfunc strip(str: String) -> String {\n    var strBr: String\n    var strSp: String\n    //\u6539\u884c\u9664\u53bb\n    strBr = str.stringByReplacingOccurrencesOfString(\"\\n\", withString: \"\", options: [], range: nil)\n    //\u534a\u89d2\u30b9\u30da\u30fc\u30b9\u9664\u53bb\n    strSp = strBr.stringByReplacingOccurrencesOfString(\" \", withString: \"\", options: [], range: nil)\n    return strSp\n}\n\n\n\n\n7. XML\u30d1\u30fc\u30b9\u51e6\u7406\u5b9f\u884c\u4e2d\u306b\u884c\u3046\u51e6\u7406\uff08NSXMLParser\uff09\n\u30bf\u30b0\u306e\u6700\u5f8c\u3092\u691c\u51fa\u3057\u305f\u969b\u306b\u53d6\u308a\u51fa\u3057\u305f\u3044\u8981\u7d20\u306b\u5408\u81f4\u3057\u3066\u3044\u305f\u5834\u5408\u306f\u3001\u89e3\u6790\u30c7\u30fc\u30bf\u683c\u7d0d\u7528\u3078\u5165\u308c\u308b\n\nViewController.swift\uff08NSXMLParser\uff09\nfunc parser(parser: NSXMLParser, didEndElement elementName: String, namespaceURI: String?, qualifiedName qName: String?) {\n\n    if (elementName as NSString).isEqualToString(self.itemElementName) {\n\n        //\u5404\u30e1\u30f3\u30d0\u5909\u6570\u304cnil\u3067\u306a\u3051\u308c\u3070\u30e1\u30f3\u30d0\u5909\u6570elements\u3078\u300c\u30ad\u30fc\u300d\u3068\u300c\u5024\u300d\u306e\u30da\u30a2\u3092\u683c\u7d0d\n        if !self.name.isEqual(nil) {\n            self.elements.setObject(self.name, forKey: self.nameElementName)\n        }\n\n        if !self.maker.isEqual(nil) {\n            self.elements.setObject(self.maker, forKey: self.makerElementName)\n        }\n\n        if !self.price.isEqual(nil) {\n            self.elements.setObject(self.price, forKey: self.priceElementName)\n        }\n\n        if !self.type.isEqual(nil) {\n            self.elements.setObject(self.type, forKey: self.typeElementName)\n        }\n\n        if !self.url.isEqual(nil) {\n            self.elements.setObject(self.url, forKey: self.urlElementName)\n        }\n\n        if !self.image.isEqual(nil) {\n            self.elements.setObject(self.image, forKey: self.imageElementName)\n        }\n        self.posts.addObject(self.elements)\n    }\n}\n\n\n\n\n\u304a\u308f\u308a\u306b. Swift\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u306e\u969b\u306f\u304d\u3061\u3063\u3068\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u78ba\u8a8d\u3057\u3066\u304a\u3053\u3046\n\u30bd\u30fc\u30b9\u7684\u306b\u306f\u3042\u307e\u308a\u7dba\u9e97\u3068\u306f\u8a00\u3048\u307e\u305b\u3093\u304c\u3001XML\u306e\u89e3\u6790\u51e6\u7406\u306e\u90e8\u5206\u3092\u4f5c\u6210\u3059\u308b\u969b\u306e\u53c2\u8003\u306b\u5c11\u3057\u3067\u3082\u304a\u5f79\u306b\u7acb\u3064\u3053\u3068\u304c\u3067\u304d\u308c\u3070\u5b09\u3057\u3044\u3067\u3059\u3002\n\n\u304a\u307e\u3051\u3068\u3044\u3046\u304bQuestion. \u753b\u50cf\u3092\u53d6\u5f97\u3059\u308b\u51e6\u7406\u306f\u3053\u308c\u3067\u3044\u3044\u306e\u3060\u308d\u3046\u304b...\n\nViewController.swift\uff08viewDidLoad\u5185\uff09\n//\u753b\u50cf \u203bimage\u8981\u7d20\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u305f\u5f8c\u306bnil\u306e\u53ef\u80fd\u6027\u3092\u30c1\u30a7\u30c3\u30af\nlet q_global: dispatch_queue_t = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);\nlet q_main: dispatch_queue_t   = dispatch_get_main_queue();\n\nlet imageParameter: String! = (posts.objectAtIndex(indexPath.row).valueForKey(\"image\")!.stringByAddingPercentEscapesUsingEncoding(NSUTF8StringEncoding))\n\n//URL\u304c\u3042\u308c\u3070\u753b\u50cf\u53d6\u5f97\u51e6\u7406\u3092\u5b9f\u884c\nif imageParameter != \"\" {\n\n    //\u30b5\u30e0\u30cd\u30a4\u30eb\u306eURL\u3092\u3082\u3068\u306b\u753b\u50cf\u30c7\u30fc\u30bf(NSData\u578b)\u3092\u4f5c\u6210\n    let imageURL = NSURL(string: imageParameter)\n\n    //\u975e\u540c\u671f\u3067URL\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\n    dispatch_async(q_global,{\n\n    //\u30b5\u30e0\u30cd\u30a4\u30eb\u306eURL\u3092\u3082\u3068\u306b\u753b\u50cf\u30c7\u30fc\u30bf(NSData\u578b)\u3092\u4f5c\u6210\n    var error: NSError?\n    var imageData: NSData?\n\n    //\u30c7\u30fc\u30bf\u304c\u53d6\u5f97\u3067\u304d\u308c\u3070\u6b63\u5e38\u51e6\u7406\n    do {\n        imageData = try NSData(contentsOfURL: imageURL!, options: [])\n\n        //Error\u304c\u8fd4\u3055\u308c\u305f\u5834\u5408\u306fimageData\u306bnil\u3092\u5165\u308c\u308b\n        } catch let error1 as NSError {\n            error = error1\n            imageData = nil\n\n        //\u305d\u308c\u4ee5\u5916\u306e\u4f8b\u5916\n        } catch {\n            fatalError()\n        }\n\n        if error != nil {\n\n            //nil\u306e\u6642\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u30a4\u30e1\u30fc\u30b8\u3092\u8868\u793a\u3057\u3066\u3042\u3052\u308b\n            let image: UIImage = UIImage(named: \"no_image.gif\")!\n            cell!.okashiImage?.image = image\n        }\n\n        //\u66f4\u65b0\u306f\u30e1\u30a4\u30f3\u30b9\u30ec\u30c3\u30c9\u3067\u884c\u3046\n        dispatch_async(q_main,{\n\n            //\u30a4\u30e1\u30fc\u30b8\u30c7\u30fc\u30bf\u304cnil\u3067\u306a\u3051\u308c\u3070\u30b5\u30e0\u30cd\u30a4\u30eb\u753b\u50cf\u3092\u8868\u793a\n            if((imageData) != nil){\n\n                //xib\u306e\u30b5\u30e0\u30cd\u30a4\u30eb\u30a8\u30ea\u30a2\u306b\u8868\u793a\u3059\u308b\n                let image: UIImage = UIImage(data: imageData!)!\n                cell!.okashiImage?.image = image\n                cell!.layoutSubviews()\n            }\n        })\n    })\n\n} else {\n\n    //nil\u306e\u6642\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u30a4\u30e1\u30fc\u30b8\u3092\u8868\u793a\u3057\u3066\u3042\u3052\u308b\n    let image: UIImage = UIImage(named: \"no_image.gif\")!\n    cell!.okashiImage?.image = image        \n}\n\n\n\n\u5b9f\u969b\u306b\u52d5\u3044\u3066\u3044\u308b\u30b5\u30f3\u30d7\u30eb\uff1a\nhttps://github.com/fumiyasac/XMLFeedSample\n\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\uff1a\n\n\u203b\uff08\u6700\u7d42\u30d0\u30fc\u30b8\u30e7\u30f3\uff092015/11/25\n\u203b\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u3082\u8fd1\u65e5\u884c\u3046\u4e88\u5b9a\u3067\u3059\u3002\u307e\u305f\u51e6\u7406\u306b\u95a2\u3059\u308b\u3054\u6307\u6458\u3082\u304a\u6c17\u8efd\u306b\u3069\u3046\u305e\uff01\n## \u306f\u3058\u3081\u306b\uff1aSwift1.1 \u2192 Swift1.2 \u2192 Swift2.x\u3067\u5909\u66f4\u304c\u3042\u3063\u305fNSXMLParser\n\n\u73fe\u5728\u306fAPI\u304b\u3089\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066UITableView\u306b\u8868\u793a\u3059\u308b\u3088\u3046\u306a\u51e6\u7406\u3092\u3059\u308b\u5834\u5408\u3001\u30ec\u30b9\u30dd\u30f3\u30b9\u306fJSON\u3067\u53d7\u3051\u53d6\u308b\u5834\u5408\u304c\u591a\u3044\u304b\u3068\u601d\u3046\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306fSwift2.0\u3067XML\u306e\u89e3\u6790\uff06\u8aad\u307f\u8fbc\u307f\u3092\u3059\u308b\u5834\u5408\u306e\u5099\u5fd8\u9332\u3068\u3057\u3066\u8a18\u8f09\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\uff08\u516c\u958b\u3055\u308c\u3066\u3044\u308bAPI\u306f\u307b\u3068\u3093\u3069\u3069\u3061\u3089\u306e\u5f62\u5f0f\u3082\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u5834\u5408\u304c\u591a\u3044\uff09\n\n## \u6ce8\u610f\u70b9\uff1aparser\u30e1\u30bd\u30c3\u30c9\u306eattributes attributeDict:\u304c\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u3088\u3063\u3066\u7570\u306a\u3063\u3066\u3044\u308b\n\nparser\u30e1\u30bd\u30c3\u30c9\u306b\u3064\u3044\u3066\u306f\u7279\u306b\u5927\u304d\u306a\u5909\u66f4\u70b9\u304c\u3042\u3063\u305f\u306e\u306f\u4e0b\u8a18\u306e\u90e8\u5206\u306b\u306a\u308a\u307e\u3059\u3002\n\u307e\u305f\u305d\u308c\u306b\u3088\u3063\u3066\u51e6\u7406\u3084\u4ed6\u306eparser\u30e1\u30bd\u30c3\u30c9\u306b\u3064\u3044\u3066\u3082optional\u306e\u4f4d\u7f6e\u3082\u5fae\u5999\u306b\u9055\u3063\u3066\u304f\u308b\u3068\u3053\u308d\u306b\u306f\u6ce8\u610f\u3057\u3066\u4e0b\u3055\u3044\u3002\n\nSwift1.1)\n\n```xxx.swift\n\nparser(parser: NSXMLParser!, didStartElement elementName: String!, namespaceURI: String!, qualifiedName qName: String!, attributes attributeDict: NSDictionary!)\n```\n\n\u2191attributeDict\u306fNSDictonary!\n\nSwift1.2)\n\n```xxx.swift\n\nparser(parser: NSXMLParser!, didStartElement elementName: String!, namespaceURI: String!, qualifiedName qName: String!, attributes attributeDict: [NSObject : AnyObject]!)\n```\n\n\u2191attributeDict\u306f[NSObject : AnyObject]!\n\nSwift2.x)\n\n```xxx.swift\n\nparser(parser: NSXMLParser!, didStartElement elementName: String!, namespaceURI: String!, qualifiedName qName: String!, attributes attributeDict: [String : String])\n```\n\n\u2191attributeDict\u306f[String : String]\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u305d\u308c\u305e\u308c\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u7570\u306a\u308b\u3068\u5f53\u7136\u51e6\u7406\u3082\u5909\u308f\u3063\u3066\u304f\u308b\u305f\u3081\u3001Swift2.0\u3067XML\u3092\u89e3\u6790\u3059\u308b\u969b\u306e\u30dd\u30a4\u30f3\u30c8\u3092\u3056\u3063\u304f\u308a\u3068\u307e\u3068\u3081\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n## \u30b3\u30fc\u30c9\uff1a\u5b9f\u969b\u306e\u51e6\u7406\u3067\u30dd\u30a4\u30f3\u30c8\u306b\u306a\u308b\u90e8\u5206\u306f\u3053\u3053\n\n\u25a0 \u4f7f\u7528API\uff1a\n\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u306f\u300c\u304a\u83d3\u5b50\u306e\u865c\u300dAPI\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\nhttp://www.sysbird.jp/toriko/webapi/\n\n+ \u5b9f\u969b\u306e\u3053\u306eAPI\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u306b\u95a2\u3057\u3066\u306f\u300c\u304a\u83d3\u5b50\u306e\u865c\u300d\u306e\u30da\u30fc\u30b8\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\n+ \u4eca\u56de\u306f\u4e0a\u8a18API\u3092\u4f7f\u7528\u3057\u3066\u30e9\u30f3\u30c0\u30e0\u3067\u30c7\u30fc\u30bf\u309230\u4ef6\u53d6\u5f97\u3059\u308b\u60f3\u5b9a\u3067\u66f8\u3044\u3066\u3044\u307e\u3059\n+ UITableView\u306b\u8868\u793a\u3059\u308b\u306e\u306f\u4ee5\u4e0b\u306e5\u3064\n\n1. \u304a\u83d3\u5b50\u540d\n2. \u304a\u83d3\u5b50\u306e\u30b5\u30e0\u30cd\u30a4\u30eb\n3. \u304a\u83d3\u5b50\u306e\u30e1\u30fc\u30ab\u30fc\u540d\n4. \u304a\u83d3\u5b50\u306e\u30ab\u30c6\u30b4\u30ea\u30fc\n5. \u304a\u83d3\u5b50\u306e\u5024\u6bb5\n\n\u203b\u3042\u307e\u308a\u7dba\u9e97\u306a\u51e6\u7406\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u53c2\u8003\u306b\u306a\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\n\n#### 1. Delegate\u3084\u5909\u6570\u306e\u7528\u610f\n```swift:ViewController.swift\uff08class\u306e\u5ba3\u8a00\u90e8\u5206\uff09\n\n//NSXMLParserDelegate\u3092\u8a18\u8f09\nclass ViewController: UIViewController, UITableViewDelegate, UITableViewDataSource, NSXMLParserDelegate\n\n```\n#### 2. \u30e1\u30f3\u30d0\u5909\u6570\u3084\u89e3\u6790\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3059\u308b\u5909\u6570\u3092\u7528\u610f\n```swift:ViewController.swift\uff08\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5ba3\u8a00\u90e8\u5206\uff09\n\n//XML\u306e\u30d5\u30a3\u30fc\u30c9\u53d6\u5f97\u7528URL\nlet feedUrl : NSURL = NSURL(string:\"http://www.sysbird.jp/webapi/?apikey=guest&max=30&order=r\")!\n\n//XML\u306e\u73fe\u5728\u8981\u7d20\u540d\u3092\u5165\u308c\u308b\u5909\u6570\nvar currentElementName : String!\n\n//\u53d6\u5f97\u3059\u308b\u8981\u7d20\u540d(\u3068\u308a\u306f\u3058\u3081\u306e\u8981\u7d20)\nlet itemElementName : String  = \"item\"\n\n//\u53d6\u5f97\u3059\u308b\u8981\u7d20\u540d\u306e\u6c7a\u5b9a(item\u8981\u7d20\u306e\u4e0b\u306b\u3042\u308b\u3082\u306e)\nlet nameElementName  : String = \"name\"\nlet makerElementName : String = \"maker\"\nlet priceElementName : String = \"price\"\nlet typeElementName  : String = \"type\"\nlet urlElementName   : String = \"url\"\nlet imageElementName : String = \"image\"\n\n//\u5404\u30a8\u30ec\u30e1\u30f3\u30c8\u7528\u306e\u5909\u6570\nvar posts    = NSMutableArray()\nvar elements = NSMutableDictionary()\nvar element  = NSString()\nvar name     = NSMutableString()\nvar maker    = NSMutableString()\nvar price    = NSMutableString()\nvar type     = NSMutableString()\nvar url      = NSMutableString()\nvar image    = NSMutableString()\n\n```\n\n#### 3. viewDidLoad\u5185\u306e\u51e6\u7406\n```swift:ViewController.swift\uff08viewDidLoad\u5185\uff09\n\noverride func viewDidLoad() {\n    super.viewDidLoad()\n\n    //\u89e3\u6790\u30c7\u30fc\u30bf\u683c\u7d0d\u7528\n    posts = []\n\n    //UITableView\u306b\u95a2\u3059\u308b\u51e6\u7406\u3092\u8a18\u8ff0 \n    ...(\u7701\u7565)...\n\n    //NSXMLParser\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u6e96\u5099\n    let parser : NSXMLParser = NSXMLParser(contentsOfURL: feedUrl)!\n\n    //XML\u30d1\u30fc\u30b5\u306e\u30c7\u30ea\u30b2\u30fc\u30c8\n    parser.delegate = self\n\n    //XML\u30d1\u30fc\u30b9\u306e\u5b9f\u884c\n    parser.parse()\n}\n\n```\n\n#### 4. XML\u30d1\u30fc\u30b9\u51e6\u7406\u5b9f\u884c\u958b\u59cb\u6642\u306b\u884c\u3046\u51e6\u7406\n```swift:ViewController.swift\uff08NSXMLParser\uff09\n//\u4eca\u56de\u306f\u7279\u306b\u306a\u3044\u306e\u3067\u7a7a\u306e\u307e\u307e\nfunc parserDidStartDocument(parser: NSXMLParser) {\n}\n\n```\n\n#### 5. XML\u30d1\u30fc\u30b9\u51e6\u7406\u5b9f\u884c\u4e2d\u306b\u884c\u3046\u51e6\u7406\uff08NSXMLParser\uff09\n\nitem\u8981\u7d20\u3092\u898b\u3064\u3051\u308b \n\u203bXML\u306e\u8981\u7d20\u3092\u4e0a\u304b\u3089\u9806\u756a\u306b\u8abf\u3079\u3066\u3044\u304f\u30a4\u30e1\u30fc\u30b8\u3067\u51e6\u7406\u304c\u884c\u308f\u308c\u308b\u3002\n\n````swift:ViewController.swift\uff08viewDidLoad\u5185\uff09\n\nfunc parser(parser: NSXMLParser, didStartElement elementName: String, namespaceURI: String?, qualifiedName qName: String?, attributes attributeDict: [String : String]) {\n\n   self.element = elementName\n\n   //\u8981\u7d20\u540d\u304c\u300citem\u300d\u306e\u8981\u7d20\u304c\u898b\u3064\u304b\u3063\u305f\u5834\u5408\u306b\u306f\u4e0a\u3067\u8a2d\u5b9a\u3057\u305f\u30e1\u30f3\u30d0\u5909\u6570\u3092\u521d\u671f\u5316\n   if (elementName as NSString).isEqualToString(self.itemElementName){\n       self.elements = [:]\n       self.name = \"\"\n       self.maker = \"\"\n       self.price = \"\"\n       self.type = \"\"\n       self.url = \"\"\n       self.image = \"\"\n    }\n}\n\n```\n\n#### 6. XML\u30d1\u30fc\u30b9\u51e6\u7406\u5b9f\u884c\u4e2d\u306b\u884c\u3046\u51e6\u7406\uff08NSXMLParser\uff09\n\nitem\u8981\u7d20\u5185\u304b\u3089\u3055\u3089\u306bname\u30fburl\u30fbprice\u30fbmaker\u30fburl\u30fbimage\u8981\u7d20\u3092\u898b\u3064\u3051\u3066item\u8981\u7d20\u3092\u898b\u3064\u3051\u305f\u969b\u306b\u7528\u610f\u3057\u305f\u5165\u308c\u7269\u306b\u5165\u308c\u3066\u3042\u3052\u308b\u3002\n\n````swift:ViewController.swift\uff08NSXMLParser\uff09\nfunc parser(parser: NSXMLParser, foundCharacters string: String){\n\n    //\u3082\u3063\u3068\u30a8\u30ec\u30ac\u30f3\u30c8\u306b\u66f8\u304b\u306d\u3070...\n    if self.element.isEqualToString(self.nameElementName) {\n        self.name.appendString(\n            strip(string)\n        )\n    }\n        \n    if self.element.isEqualToString(self.makerElementName) {\n        self.maker.appendString(\n            strip(string)\n        )\n    }\n        \n    if self.element.isEqualToString(self.priceElementName) {\n        self.price.appendString(\n            strip(string)\n        )\n    }\n  \n    if self.element.isEqualToString(self.typeElementName) {\n        self.type.appendString(\n            strip(string)\n        )\n    }\n  \n    if self.element.isEqualToString(self.urlElementName) {\n        self.url.appendString(\n            strip(string)\n        )\n    }\n   \n    if self.element.isEqualToString(self.imageElementName) {\n        self.image.appendString(\n            strip(string)\n        )\n    }\n}\n\n```\n\n\u3053\u306e\u307e\u307e\u3060\u3068XML\u306e\u8981\u7d20\u3092\u53d6\u5f97\u3059\u308b\u969b\u306b\u4f59\u5206\u306a\u6539\u884c\u3084\u534a\u89d2\u30b9\u30da\u30fc\u30b9\u304c\u542b\u307e\u308c\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u6539\u884c\u3068\u534a\u89d2\u30b9\u30da\u30fc\u30b9\u306e\u9664\u53bb\u3092\u3059\u308b\u30e1\u30bd\u30c3\u30c9\u3082\u8ffd\u52a0\u3057\u3066\u304a\u304f\u3053\u3068\u306b\u3057\u307e\u3059\u3002\uff08\u6b63\u898f\u8868\u73fe\u3092\u4f7f\u3046\u3079\u304d\u3060\u306a...\uff09\n\n````swift:ViewController.swift\uff08NSXMLParser\uff09\n//\u6539\u884c\u3068\u534a\u89d2\u30b9\u30da\u30fc\u30b9\u306e\u9664\u53bb\nfunc strip(str: String) -> String {\n    var strBr: String\n    var strSp: String\n    //\u6539\u884c\u9664\u53bb\n    strBr = str.stringByReplacingOccurrencesOfString(\"\\n\", withString: \"\", options: [], range: nil)\n    //\u534a\u89d2\u30b9\u30da\u30fc\u30b9\u9664\u53bb\n    strSp = strBr.stringByReplacingOccurrencesOfString(\" \", withString: \"\", options: [], range: nil)\n    return strSp\n}\n\n```\n\n#### 7. XML\u30d1\u30fc\u30b9\u51e6\u7406\u5b9f\u884c\u4e2d\u306b\u884c\u3046\u51e6\u7406\uff08NSXMLParser\uff09\n\n\u30bf\u30b0\u306e\u6700\u5f8c\u3092\u691c\u51fa\u3057\u305f\u969b\u306b\u53d6\u308a\u51fa\u3057\u305f\u3044\u8981\u7d20\u306b\u5408\u81f4\u3057\u3066\u3044\u305f\u5834\u5408\u306f\u3001\u89e3\u6790\u30c7\u30fc\u30bf\u683c\u7d0d\u7528\u3078\u5165\u308c\u308b\n\n````swift:ViewController.swift\uff08NSXMLParser\uff09\nfunc parser(parser: NSXMLParser, didEndElement elementName: String, namespaceURI: String?, qualifiedName qName: String?) {\n        \n    if (elementName as NSString).isEqualToString(self.itemElementName) {\n        \n        //\u5404\u30e1\u30f3\u30d0\u5909\u6570\u304cnil\u3067\u306a\u3051\u308c\u3070\u30e1\u30f3\u30d0\u5909\u6570elements\u3078\u300c\u30ad\u30fc\u300d\u3068\u300c\u5024\u300d\u306e\u30da\u30a2\u3092\u683c\u7d0d\n        if !self.name.isEqual(nil) {\n            self.elements.setObject(self.name, forKey: self.nameElementName)\n        }\n\n        if !self.maker.isEqual(nil) {\n            self.elements.setObject(self.maker, forKey: self.makerElementName)\n        }\n\n        if !self.price.isEqual(nil) {\n            self.elements.setObject(self.price, forKey: self.priceElementName)\n        }\n\n        if !self.type.isEqual(nil) {\n            self.elements.setObject(self.type, forKey: self.typeElementName)\n        }\n\n        if !self.url.isEqual(nil) {\n            self.elements.setObject(self.url, forKey: self.urlElementName)\n        }\n        \n        if !self.image.isEqual(nil) {\n            self.elements.setObject(self.image, forKey: self.imageElementName)\n        }\n        self.posts.addObject(self.elements)\n    }\n}\n\n```\n\n#### \u304a\u308f\u308a\u306b. Swift\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u306e\u969b\u306f\u304d\u3061\u3063\u3068\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u78ba\u8a8d\u3057\u3066\u304a\u3053\u3046\n\n\u30bd\u30fc\u30b9\u7684\u306b\u306f\u3042\u307e\u308a\u7dba\u9e97\u3068\u306f\u8a00\u3048\u307e\u305b\u3093\u304c\u3001XML\u306e\u89e3\u6790\u51e6\u7406\u306e\u90e8\u5206\u3092\u4f5c\u6210\u3059\u308b\u969b\u306e\u53c2\u8003\u306b\u5c11\u3057\u3067\u3082\u304a\u5f79\u306b\u7acb\u3064\u3053\u3068\u304c\u3067\u304d\u308c\u3070\u5b09\u3057\u3044\u3067\u3059\u3002\n\n#### \u304a\u307e\u3051\u3068\u3044\u3046\u304bQuestion. \u753b\u50cf\u3092\u53d6\u5f97\u3059\u308b\u51e6\u7406\u306f\u3053\u308c\u3067\u3044\u3044\u306e\u3060\u308d\u3046\u304b...\n\n````swift:ViewController.swift\uff08viewDidLoad\u5185\uff09\n//\u753b\u50cf \u203bimage\u8981\u7d20\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u305f\u5f8c\u306bnil\u306e\u53ef\u80fd\u6027\u3092\u30c1\u30a7\u30c3\u30af\nlet q_global: dispatch_queue_t = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);\nlet q_main: dispatch_queue_t   = dispatch_get_main_queue();\n\nlet imageParameter: String! = (posts.objectAtIndex(indexPath.row).valueForKey(\"image\")!.stringByAddingPercentEscapesUsingEncoding(NSUTF8StringEncoding))\n\n//URL\u304c\u3042\u308c\u3070\u753b\u50cf\u53d6\u5f97\u51e6\u7406\u3092\u5b9f\u884c\nif imageParameter != \"\" {\n\n    //\u30b5\u30e0\u30cd\u30a4\u30eb\u306eURL\u3092\u3082\u3068\u306b\u753b\u50cf\u30c7\u30fc\u30bf(NSData\u578b)\u3092\u4f5c\u6210\n    let imageURL = NSURL(string: imageParameter)\n\n    //\u975e\u540c\u671f\u3067URL\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\n    dispatch_async(q_global,{\n\n    //\u30b5\u30e0\u30cd\u30a4\u30eb\u306eURL\u3092\u3082\u3068\u306b\u753b\u50cf\u30c7\u30fc\u30bf(NSData\u578b)\u3092\u4f5c\u6210\n    var error: NSError?\n    var imageData: NSData?\n            \n    //\u30c7\u30fc\u30bf\u304c\u53d6\u5f97\u3067\u304d\u308c\u3070\u6b63\u5e38\u51e6\u7406\n    do {\n        imageData = try NSData(contentsOfURL: imageURL!, options: [])\n                    \n        //Error\u304c\u8fd4\u3055\u308c\u305f\u5834\u5408\u306fimageData\u306bnil\u3092\u5165\u308c\u308b\n        } catch let error1 as NSError {\n            error = error1\n            imageData = nil\n                \n        //\u305d\u308c\u4ee5\u5916\u306e\u4f8b\u5916\n        } catch {\n            fatalError()\n        }\n\n        if error != nil {\n                    \n            //nil\u306e\u6642\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u30a4\u30e1\u30fc\u30b8\u3092\u8868\u793a\u3057\u3066\u3042\u3052\u308b\n            let image: UIImage = UIImage(named: \"no_image.gif\")!\n            cell!.okashiImage?.image = image\n        }\n                \n        //\u66f4\u65b0\u306f\u30e1\u30a4\u30f3\u30b9\u30ec\u30c3\u30c9\u3067\u884c\u3046\n        dispatch_async(q_main,{\n\n            //\u30a4\u30e1\u30fc\u30b8\u30c7\u30fc\u30bf\u304cnil\u3067\u306a\u3051\u308c\u3070\u30b5\u30e0\u30cd\u30a4\u30eb\u753b\u50cf\u3092\u8868\u793a\n            if((imageData) != nil){\n                        \n                //xib\u306e\u30b5\u30e0\u30cd\u30a4\u30eb\u30a8\u30ea\u30a2\u306b\u8868\u793a\u3059\u308b\n                let image: UIImage = UIImage(data: imageData!)!\n                cell!.okashiImage?.image = image\n                cell!.layoutSubviews()\n            }\n        })\n    })\n        \n} else {\n            \n    //nil\u306e\u6642\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u30a4\u30e1\u30fc\u30b8\u3092\u8868\u793a\u3057\u3066\u3042\u3052\u308b\n    let image: UIImage = UIImage(named: \"no_image.gif\")!\n    cell!.okashiImage?.image = image        \n}\n\n```\n\n\u5b9f\u969b\u306b\u52d5\u3044\u3066\u3044\u308b\u30b5\u30f3\u30d7\u30eb\uff1a\nhttps://github.com/fumiyasac/XMLFeedSample\n\n\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\uff1a\n<img width=\"320\" alt=\"sample.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/17400/e4f48459-b7cc-0851-5fb9-6e19af57a075.png\">\n\n\u203b\uff08\u6700\u7d42\u30d0\u30fc\u30b8\u30e7\u30f3\uff092015/11/25\n\u203b\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u3082\u8fd1\u65e5\u884c\u3046\u4e88\u5b9a\u3067\u3059\u3002\u307e\u305f\u51e6\u7406\u306b\u95a2\u3059\u308b\u3054\u6307\u6458\u3082\u304a\u6c17\u8efd\u306b\u3069\u3046\u305e\uff01\n", "tags": ["Swift", "Swift2.0", "iOS"]}