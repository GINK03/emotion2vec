{"context": " More than 1 year has passed since last update.\n\n\u76ee\u7684\n\u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5468\u308a\u306e\u5b66\u7fd2\u306e\u305f\u3081\u3001KVM\u74b0\u5883\u3067\u3001OpenvSwitch\u3067\u30b2\u30b9\u30c8VM\u3092\u5916\u90e8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3068\u63a5\u7d9a\u3059\u308b\uff08\u4e0b\u56f3\uff09\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u305f\u306e\u3067\u3001\u305d\u306e\u624b\u9806\u30e1\u30e2\u3002\n\n\u6700\u7d42\u30a4\u30e1\u30fc\u30b8\n\n\n\u3000\u524d\u63d0\u6761\u4ef6\n\n\u30db\u30b9\u30c8\u306fCentOS6.6(64bit)\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\n\u30b2\u30b9\u30c8VM\u306eOS\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30e1\u30c7\u30a3\u30a2\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u6e08\n\n\n\u624b\u9806\n\nKVM\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# yum -y install qemu-kvm qemu-kvm-tools\n\n\n\u30b2\u30b9\u30c8VM\u306e\u4f5c\u6210\n\u5272\u611b\uff1alibvirt\u3067\u7ba1\u7406\u51fa\u6765\u308b\u3088\u3046\u306b\u4f5c\u6210\uff08virt-install\u7b49\uff09\u3002\n\nOpenvSwitch\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u4e8b\u524d\u6e96\u5099\n# yum -y install wget gcc make automake rpm-build redhat-rpm-config openssl-devel kernel-devel libtool\nLinuxBridge\u304c\u5b58\u5728\u3057\u3066\u3044\u305f\u3089\u524a\u9664\n# lsmod | grep bridge\n(bridge\u304c\u3042\u3063\u305f\u3089)\n# rmmod bridge\n\n\nOpenvSwitch\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# cd\n# wget http://openvswitch.org/releases/openvswitch-2.3.1.tar.gz\n# cp openvswitch-2.3.1.tar.gz ~/rpmbuild/SOURCES/\n# tar zxvf openvswitch-2.3.1.tar.gz\n# cd openvswitch-2.3.1\n# cp rhel/openvswitch-kmod.files ~/rpmbuild/SOURCES/\n# rpmbuild -bb rhel/openvswitch.spec\n# rpmbuild -bb rhel/openvswitch-kmod-rhel6.spec\n# cd ~/rpmbuild/RPMS/x86_64/\n# yum -y install openvswitch-2.3.1-1.x86_64.rpm kmod-openvswitch-2.3.1-1.el6.x86_64.rpm\n\n\nOpenvSwitch\u306e\u8d77\u52d5\u3001\u78ba\u8a8d\n# /etc/init.d/openvswitch start\n# ovs-vsctl show\nfba905c9-89dd-4ca5-8ba6-c873771c3fed\n    ovs_version: \"2.3.1\"\n\n\n\u4eee\u60f3\u30d6\u30ea\u30c3\u30b8\u306e\u8ffd\u52a0\n# ovs-vsctl add-br ovsbr0\n# ovs-vsctl add-port ovsbr0 eth0\n# ovs-vsctl show\nfba905c9-89dd-4ca5-8ba6-c873771c3fed\n    Bridge \"ovsbr0\"\n        Port \"ovsbr0\"\n            Interface \"ovsbr0\"\n                type: internal\n        Port \"eth0\"\n            Interface \"eth0\"\n    ovs_version: \"2.3.1\"\n\n\nIP\u30a2\u30c9\u30ec\u30b9\u306e\u8a2d\u5b9a\n# ifconfig eth0 0.0.0.0\n# ifconfig ovsbr0 192.168.0.3/24\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u8a2d\u5b9a\n# virsh shutdown gutestos\n# virsh edit guestos\n(\u4f8b)\n <interface type='bridge'>\n      <mac address='52:54:00:68:bf:42'/>\n      <source bridge='ovsbr0'/>\n      <virtualport type='openvswitch'>![ScreenClip.png](https://qiita-image-store.s3.amazonaws.com/0/50690/522b846f-fef9-e62c-1aa3-5823e1c6491e.png)\n\n      </virtualport>\n      <model type='virtio'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>\n    </interface>\n# virsh start guestos\n\n\n\u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u78ba\u8a8d\n\u4ee5\u4e0b\u306e\u4f8b\u3067\u306fvnet1\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\n# ovs-vsctl show\nfba905c9-89dd-4ca5-8ba6-c873771c3fed\n    Bridge \"ovsbr0\"\n        Port \"ovsbr0\"\n            Interface \"ovsbr0\"\n                type: internal\n        Port \"vnet1\"\n            Interface \"vnet1\"\n        Port \"eth0\"\n            Interface \"eth0\"\n    ovs_version: \"2.3.1\"\n\n\n\u30b2\u30b9\u30c8VM\u306e\u8a2d\u5b9a\nIP\u30a2\u30c9\u30ec\u30b9\u306e\u8a2d\u5b9a\uff08\u5272\u611b\uff09\n\u4ee5\u4e0a\u3002\n\n\u53c2\u8003\nKVM\u74b0\u5883\u3067Linux\u6a19\u6e96\u30d6\u30ea\u30c3\u30b8\u306e\u4ee3\u308f\u308a\u306bOpen vSwitch\u3092\u5229\u7528\u3059\u308b - \u63ee\u767a\u6027\u30e1\u30e2\u30ea\u642d\u8f09\u30a8\u30f3\u30b8\u30cb\u30a2\u306e\u65e5\u8a18 http://knqyf263.hatenablog.com/entry/2013/12/30/220214\nKVM\u304b\u3089br0(\u30d6\u30ea\u30c3\u30b8\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30a4\u30b9)\u304c\u9078\u629e\u3067\u304d\u306a\u3044\u3051\u3069\u4f55\u6545\u304b\u89e3\u6c7a\u3057\u305f\u4ef6 - qphoney\u8a18 http://qphoney.hatenadiary.com/entry/2011/12/01/184534\nCentOS 6.4 \u306b Open vSwitch 2.0.0 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b | CUBE SUGAR STORAGE http://momijiame.tumblr.com/post/68058348274/centos-6-4-open-vswitch-2-0-0\n## \u76ee\u7684\n\u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5468\u308a\u306e\u5b66\u7fd2\u306e\u305f\u3081\u3001KVM\u74b0\u5883\u3067\u3001OpenvSwitch\u3067\u30b2\u30b9\u30c8VM\u3092\u5916\u90e8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3068\u63a5\u7d9a\u3059\u308b\uff08\u4e0b\u56f3\uff09\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u305f\u306e\u3067\u3001\u305d\u306e\u624b\u9806\u30e1\u30e2\u3002\n\n## \u6700\u7d42\u30a4\u30e1\u30fc\u30b8\n![ScreenClip.png](https://qiita-image-store.s3.amazonaws.com/0/50690/d13630b3-1ea8-4ea5-0fd7-3bb672f4b04d.png)\n\n##\u3000\u524d\u63d0\u6761\u4ef6\n* \u30db\u30b9\u30c8\u306fCentOS6.6(64bit)\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\n* \u30b2\u30b9\u30c8VM\u306eOS\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30e1\u30c7\u30a3\u30a2\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u6e08\n\n## \u624b\u9806\n\n### KVM\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```\n# yum -y install qemu-kvm qemu-kvm-tools\n```\n\n### \u30b2\u30b9\u30c8VM\u306e\u4f5c\u6210\n\u5272\u611b\uff1alibvirt\u3067\u7ba1\u7406\u51fa\u6765\u308b\u3088\u3046\u306b\u4f5c\u6210\uff08virt-install\u7b49\uff09\u3002\n\n### OpenvSwitch\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n#### \u4e8b\u524d\u6e96\u5099\n`# yum -y install wget gcc make automake rpm-build redhat-rpm-config openssl-devel kernel-devel libtool`\n\nLinuxBridge\u304c\u5b58\u5728\u3057\u3066\u3044\u305f\u3089\u524a\u9664\n\n```\n# lsmod | grep bridge\n(bridge\u304c\u3042\u3063\u305f\u3089)\n# rmmod bridge\n```\n\n#### OpenvSwitch\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n# cd\n# wget http://openvswitch.org/releases/openvswitch-2.3.1.tar.gz\n# cp openvswitch-2.3.1.tar.gz ~/rpmbuild/SOURCES/\n# tar zxvf openvswitch-2.3.1.tar.gz\n# cd openvswitch-2.3.1\n# cp rhel/openvswitch-kmod.files ~/rpmbuild/SOURCES/\n# rpmbuild -bb rhel/openvswitch.spec\n# rpmbuild -bb rhel/openvswitch-kmod-rhel6.spec\n# cd ~/rpmbuild/RPMS/x86_64/\n# yum -y install openvswitch-2.3.1-1.x86_64.rpm kmod-openvswitch-2.3.1-1.el6.x86_64.rpm\n```\n#### OpenvSwitch\u306e\u8d77\u52d5\u3001\u78ba\u8a8d\n\n```\n# /etc/init.d/openvswitch start\n# ovs-vsctl show\nfba905c9-89dd-4ca5-8ba6-c873771c3fed\n    ovs_version: \"2.3.1\"\n```\n\n### \u4eee\u60f3\u30d6\u30ea\u30c3\u30b8\u306e\u8ffd\u52a0\n\n```\n# ovs-vsctl add-br ovsbr0\n# ovs-vsctl add-port ovsbr0 eth0\n# ovs-vsctl show\nfba905c9-89dd-4ca5-8ba6-c873771c3fed\n    Bridge \"ovsbr0\"\n        Port \"ovsbr0\"\n            Interface \"ovsbr0\"\n                type: internal\n        Port \"eth0\"\n            Interface \"eth0\"\n    ovs_version: \"2.3.1\"\n```\n\n### IP\u30a2\u30c9\u30ec\u30b9\u306e\u8a2d\u5b9a\n\n```\n# ifconfig eth0 0.0.0.0\n# ifconfig ovsbr0 192.168.0.3/24\n```\n\n### \u4eee\u60f3\u30de\u30b7\u30f3\u306e\u8a2d\u5b9a\n\n```\n# virsh shutdown gutestos\n# virsh edit guestos\n(\u4f8b)\n <interface type='bridge'>\n      <mac address='52:54:00:68:bf:42'/>\n      <source bridge='ovsbr0'/>\n      <virtualport type='openvswitch'>![ScreenClip.png](https://qiita-image-store.s3.amazonaws.com/0/50690/522b846f-fef9-e62c-1aa3-5823e1c6491e.png)\n\n      </virtualport>\n      <model type='virtio'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>\n    </interface>\n# virsh start guestos\n```\n\n### \u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u78ba\u8a8d\n\u4ee5\u4e0b\u306e\u4f8b\u3067\u306fvnet1\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\n\n```\n# ovs-vsctl show\nfba905c9-89dd-4ca5-8ba6-c873771c3fed\n    Bridge \"ovsbr0\"\n        Port \"ovsbr0\"\n            Interface \"ovsbr0\"\n                type: internal\n        Port \"vnet1\"\n            Interface \"vnet1\"\n        Port \"eth0\"\n            Interface \"eth0\"\n    ovs_version: \"2.3.1\"\n```\n\n### \u30b2\u30b9\u30c8VM\u306e\u8a2d\u5b9a\nIP\u30a2\u30c9\u30ec\u30b9\u306e\u8a2d\u5b9a\uff08\u5272\u611b\uff09\n\n\u4ee5\u4e0a\u3002\n\n## \u53c2\u8003\nKVM\u74b0\u5883\u3067Linux\u6a19\u6e96\u30d6\u30ea\u30c3\u30b8\u306e\u4ee3\u308f\u308a\u306bOpen vSwitch\u3092\u5229\u7528\u3059\u308b - \u63ee\u767a\u6027\u30e1\u30e2\u30ea\u642d\u8f09\u30a8\u30f3\u30b8\u30cb\u30a2\u306e\u65e5\u8a18 http://knqyf263.hatenablog.com/entry/2013/12/30/220214\n\nKVM\u304b\u3089br0(\u30d6\u30ea\u30c3\u30b8\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30a4\u30b9)\u304c\u9078\u629e\u3067\u304d\u306a\u3044\u3051\u3069\u4f55\u6545\u304b\u89e3\u6c7a\u3057\u305f\u4ef6 - qphoney\u8a18 http://qphoney.hatenadiary.com/entry/2011/12/01/184534\n\nCentOS 6.4 \u306b Open vSwitch 2.0.0 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b | CUBE SUGAR STORAGE http://momijiame.tumblr.com/post/68058348274/centos-6-4-open-vswitch-2-0-0\n", "tags": ["KVM", "OpenVSwitch", "\u4eee\u60f3\u5316", "Linux"]}