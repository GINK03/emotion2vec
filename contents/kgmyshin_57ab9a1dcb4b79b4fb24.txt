{"context": " More than 1 year has passed since last update.\n\n\u524d\u63d0\n\u30b7\u30e3\u30c1\u30af\u30bd\u30f3\u3067\u3001\u3080\u304b\u3064\u304f\u4e0a\u53f8\u306b\u732b\u8033\u3064\u3051\u3066\u548c\u3082\u3046\uff01\u3063\u3066\u3053\u3068\u3067\u4e0a\u53f8\u306b\u732b\u8033\u3064\u3051\u308b\u30ed\u30b8\u30c3\u30af\u3092\u66f8\u304f\u62c5\u5f53\u306b\u306a\u308a\u3001\u7121\u4e8b\u3067\u6765\u305f\u306e\u3067\u3053\u3053\u306b\u8a18\u3057\u307e\u3059\u3002\n\n\u6761\u4ef6\n\u753b\u50cf\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306f\u4ed6\u306e\u65b9\u304c\u62c5\u5f53\u3057\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u5f15\u6570\u3068\u3057\u3066\u53d7\u3051\u53d6\u308a\u307e\u3059\u3002\n\u305d\u3057\u3066\u3001\u53d7\u3051\u53d6\u3063\u305f\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u3092\u9854\u8a8d\u8b58\u306b\u901a\u3057\u3001\u305d\u306e\u7d50\u679c\u304b\u3089\u9854\u306e\u3044\u3044\u611f\u3058\u306e\u5ea7\u6a19\u306b\u732b\u8033\u3092\u4e57\u305b\u307e\u3059\u3002\n\n\u4f7f\u7528\u30e9\u30a4\u30d6\u30e9\u30ea\n\u9854\u8a8d\u8b58\u306e\u305f\u3081\u306bfaceplusplus\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\nfaceplusplus\u306fmashape\u8d8a\u3057\u306b\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\u3061\u306a\u307f\u306bmashape\u306f\u3044\u308d\u3093\u306aAPI\u3092\u307e\u3068\u3081\u3066\u7c21\u5358\u306b\u4f7f\u3048\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002\n\n\u9854\u8a8d\u8b58\n\u9854\u8a8d\u8b58\u306f\u4e0a\u8a18\u306b\u3082\u3042\u308b\u3088\u3046\u306bmashape\u8d8a\u3057\u306bfaceplusplus\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\u3044\u308d\u3044\u308d\u306a\u8a73\u3057\u3044\u7d50\u679c\u304c\u3068\u308c\u307e\u3059\u3002(\u6027\u5225\u3001\u5e74\u9f62\u3001\u7b11\u9854\u5ea6\u3068\u304b\u3082\uff01)\n\u4eca\u56de\u306f\u9854\u306e\u5e45\u3001\u9ad8\u3055\u3001\u4e2d\u5fc3\u5ea7\u6a19\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\u3061\u306a\u307f\u306b\u5ea7\u6a19\u306f\u30d4\u30af\u30bb\u30eb\u3058\u3083\u306a\u304f\u3066\u753b\u50cf\u306e\u7e26\u6a2a\u306e%\u3067\u8fd4\u3063\u3066\u304d\u307e\u3059\u306e\u3067\u3054\u6ce8\u610f\u3092\u3002\nrequire_once dirname(__FILE__).'/unirest-php/lib/Unirest.php';\n\n  :\n\n  $response = Unirest::get(\"https://faceplusplus-faceplusplus.p.mashape.com/detection/detect?attribute=glass,pose,gender,age,race,smiling&url=\" . $img_url,\n    array(\n      \"X-Mashape-Key\" => \"K74HWn5JLsmsh6Xrnh6FHDYPI2jzp18pxOpjsnnaIgcHRpvNCc\"\n    )\n  );\n\n  $face_width = $response->body->face[0]->position->width;\n  $face_height = $response->body->face[0]->position->height;\n  $face_center_x = $response->body->face[0]->position->center->x;\n  $face_center_y = $response->body->face[0]->position->center->y;\n\n\n\u753b\u50cf\u5408\u6210\n\u3084\u308b\u3079\u304d\u3053\u3068\u306f\u732b\u8033\u306e\u753b\u50cf\u3092\u9854\u306e\u30b5\u30a4\u30ba\u306b\u5408\u308f\u305b\u3066\u62e1\u7e2e\u3057\u3066\u3001\u9854\u306e\u4e2d\u5fc3\u753b\u50cf\u306a\u3069\u3092\u3082\u3068\u306b\u306e\u305b\u307e\u3059\u3002\n  // \u4e0a\u53f8\u306e\u753b\u50cf\u306e\u62e1\u5f35\u5b50\u3092\u3082\u3068\u306b\u753b\u50cf\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u308b\n  $path_splitted = explode(\".\", $path);\n  $ext = $path_splitted[count($path_splitted) - 1];\n  switch($ext) {\n    case 'png':\n      $base_image = imagecreatefrompng($path);\n      break;\n    case 'gif':\n      $base_image = imagecreatefromgif($path);\n      break;\n    case 'jpg':\n      $base_image = imagecreatefromjpeg($path);\n      break;\n    case 'jpeg':\n      $base_image = imagecreatefromjpeg($path);\n      break;\n    default:\n      break;\n  }\n\n  // \u732b\u8033\u753b\u50cf\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u308b\n  $nekomimi_path = \"nekomimi\";\n  $nekomimi = imagecreatefrompng($nekomimi_path);\n\n  // \u62e1\u7e2e\u3057\u3066\u3044\u304f\n  // \u732b\u8033\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u3092\u53d6\u5f97\n  list($width_nekomimi, $height_kami) = getimagesize($nekomimi_path);\n  // \u62e1\u7e2e\u5f8c\u306e\u732b\u8033\u753b\u50cf\u306e\u6a2a\u5e45\u3092 \u9854\u306e\u5e45 * 1.6 \u3068\u3059\u308b\u3002(1.6\u3068\u3044\u3046\u6570\u5b57\u306f\u4f7f\u3046\u732b\u8033\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306b\u3088\u3063\u3066\u5909\u308f\u308a\u5f97\u307e\u3059\u3002)\n  $new_width_nekomimi = $face_width * 1.6;\n  // \u62e1\u7e2e\u5f8c\u306e\u732b\u8033\u753b\u50cf\u306e\u9ad8\u3055\u306f\u62e1\u7e2e\u5f8c\u306e\u6a2a\u5e45\u3068\u5143\u306e\u5e45\u3092\u3082\u3068\u306b\u7b97\u51fa\u3059\u308b\n  $new_height_nekomimi = $height_kami * ( $new_width_nekomimi / $width_nekomimi);\n  // \u62e1\u7e2e\u6e08\u307f\u732b\u8033\u753b\u50cf\u3088\u3046\u306e\u7a7a\u306e\u753b\u50cf\u3092\u4f5c\u308b\n  $scaled_nekomimi = imagecreatetruecolor($width_base, $height_base);\n  // \u900f\u904e\u3092\u8a2d\u5b9a\u3059\u308b\n  $alpha = imagecolortransparent($nekomimi);\n  imagefill($scaled_nekomimi, 0, 0, $alpha);\n  imagecolortransparent($scaled_nekomimi, $alpha);\n  imagecolortransparent($base_image, $alpha);\n  // \u3053\u3053\u3067\u732b\u8033\u753b\u50cf\u3092\u62e1\u7e2e\u5c0f\u3059\u308b\n  imagecopyresampled($scaled_nekomimi, $nekomimi, 0, 0, 0, 0, $new_width_nekomimi, $new_height_nekomimi, $width_nekomimi, $height_nekomimi);\n\n  // \u732b\u8033\u753b\u50cf\u3092\u4e0a\u53f8\u753b\u50cf\u306b\u8cbc\u4ed8\u3051\u308b\u3002($face_center_y * 0.1\u306e\u3068\u3053\u308d\u306f\u88dc\u6b63\u3067\u3059)\n  $result = imagecopy($base_image, $scaled_nekomimi, $face_center_x - ($new_width_nekomimi / 2), $face_center_y - ($new_height_nekomimi / 2) + $face_center_y * 0.1, 0, 0, $width_base, $height_base);\n\n  imagepng($base_image, \"files2/\".$filename);\n\n  // \u304a\u4f5c\u6cd5\n  imagedestroy($nekomimi);\n  imagedestroy($scaled_nekomimi);\n  imagedestroy($base_image);\n\n\n\n\u5b9f\u969b\u306e\u30bd\u30fc\u30b9\n\u6700\u7d42\u7684\u306b\u4e0b\u8a18\u306b\u306a\u308a\u307e\u3057\u305f\n\napi.php\n<?php\nrequire_once dirname(__FILE__).'/unirest-php/lib/Unirest.php';\n\nfunction getSimilarCelebs($filename) {\n  $path = \"files/\".$filename;\n  $img_url = \"http://orenojs.ddo.jp/files/\".$filename;\n\n  $response = Unirest::get(\"https://faceplusplus-faceplusplus.p.mashape.com/detection/detect?attribute=glass,pose,gender,age,race,smiling&url=\" . $img_url,\n    array(\n      \"X-Mashape-Key\" => \"K74HWn5JLsmsh6Xrnh6FHDYPI2jzp18pxOpjsnnaIgcHRpvNCc\"\n    )\n  );\n\n  $face_width = $response->body->face[0]->position->width;\n  $face_height = $response->body->face[0]->position->height;\n  $face_center_x = $response->body->face[0]->position->center->x;\n  $face_center_y = $response->body->face[0]->position->center->y;\n\n  list($width_base, $height_base) = getimagesize($path);\n\n  $face_width = $width_base * ($face_width / 100);\n  $face_height = $height_base * ($face_height / 100);\n  $face_center_x = $width_base * ($face_center_x / 100);\n  $face_center_y = $height_base * ($face_center_y / 100);\n\n  // \u4e0a\u53f8\u306e\u753b\u50cf\u306e\u62e1\u5f35\u5b50\u3092\u3082\u3068\u306b\u753b\u50cf\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u308b\n  $path_splitted = explode(\".\", $path);\n  $ext = $path_splitted[count($path_splitted) - 1];\n  switch($ext) {\n    case 'png':\n      $base_image = imagecreatefrompng($path);\n      break;\n    case 'gif':\n      $base_image = imagecreatefromgif($path);\n      break;\n    case 'jpg':\n      $base_image = imagecreatefromjpeg($path);\n      break;\n    case 'jpeg':\n      $base_image = imagecreatefromjpeg($path);\n      break;\n    default:\n      break;\n  }\n\n  // \u732b\u8033\u753b\u50cf\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u308b\n  $nekomimi_path = \"nekomimi\";\n  $nekomimi = imagecreatefrompng($nekomimi_path);\n\n  // \u62e1\u7e2e\u3057\u3066\u3044\u304f\n  // \u732b\u8033\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u3092\u53d6\u5f97\n  list($width_nekomimi, $height_kami) = getimagesize($nekomimi_path);\n  // \u62e1\u7e2e\u5f8c\u306e\u732b\u8033\u753b\u50cf\u306e\u6a2a\u5e45\u3092 \u9854\u306e\u5e45 * 1.6 \u3068\u3059\u308b\u3002(1.6\u3068\u3044\u3046\u6570\u5b57\u306f\u4f7f\u3046\u732b\u8033\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306b\u3088\u3063\u3066\u5909\u308f\u308a\u5f97\u307e\u3059\u3002)\n  $new_width_nekomimi = $face_width * 1.6;\n  // \u62e1\u7e2e\u5f8c\u306e\u732b\u8033\u753b\u50cf\u306e\u9ad8\u3055\u306f\u62e1\u7e2e\u5f8c\u306e\u6a2a\u5e45\u3068\u5143\u306e\u5e45\u3092\u3082\u3068\u306b\u7b97\u51fa\u3059\u308b\n  $new_height_nekomimi = $height_kami * ( $new_width_nekomimi / $width_nekomimi);\n  // \u62e1\u7e2e\u6e08\u307f\u732b\u8033\u753b\u50cf\u3088\u3046\u306e\u7a7a\u306e\u753b\u50cf\u3092\u4f5c\u308b\n  $scaled_nekomimi = imagecreatetruecolor($width_base, $height_base);\n  // \u900f\u904e\u3092\u8a2d\u5b9a\u3059\u308b\n  $alpha = imagecolortransparent($nekomimi);\n  imagefill($scaled_nekomimi, 0, 0, $alpha);\n  imagecolortransparent($scaled_nekomimi, $alpha);\n  imagecolortransparent($base_image, $alpha);\n  // \u3053\u3053\u3067\u732b\u8033\u753b\u50cf\u3092\u62e1\u7e2e\u5c0f\u3059\u308b\n  imagecopyresampled($scaled_nekomimi, $nekomimi, 0, 0, 0, 0, $new_width_nekomimi, $new_height_nekomimi, $width_nekomimi, $height_nekomimi);\n\n  // \u732b\u8033\u753b\u50cf\u3092\u4e0a\u53f8\u753b\u50cf\u306b\u8cbc\u4ed8\u3051\u308b\u3002($face_center_y * 0.1\u306e\u3068\u3053\u308d\u306f\u88dc\u6b63\u3067\u3059)\n  $result = imagecopy($base_image, $scaled_nekomimi, $face_center_x - ($new_width_nekomimi / 2), $face_center_y - ($new_height_nekomimi / 2) + $face_center_y * 0.1, 0, 0, $width_base, $height_base);\n\n  imagepng($base_image, \"files2/\".$filename);\n\n  // \u304a\u4f5c\u6cd5\n  imagedestroy($nekomimi);\n  imagedestroy($scaled_nekomimi);\n  imagedestroy($base_image);\n\n  return $result;\n}\n\n?>\n\n\n\n\u611f\u60f3\nPHP\u666e\u6bb5\u4f7f\u308f\u306a\u3044\u3068\u3044\u3046\u304b\u3001\u3061\u3083\u3093\u3068PHP\u4f7f\u3063\u305f\u306e\u3063\u30663\u5e74\u304f\u3089\u3044\u524d\u306a\u306e\u3067\u6b7b\u306c\u307b\u3069\u6642\u9593\u304b\u304b\u308a\u307e\u3057\u305forz\n\n## \u524d\u63d0\n\u30b7\u30e3\u30c1\u30af\u30bd\u30f3\u3067\u3001\u3080\u304b\u3064\u304f\u4e0a\u53f8\u306b\u732b\u8033\u3064\u3051\u3066\u548c\u3082\u3046\uff01\u3063\u3066\u3053\u3068\u3067\u4e0a\u53f8\u306b\u732b\u8033\u3064\u3051\u308b\u30ed\u30b8\u30c3\u30af\u3092\u66f8\u304f\u62c5\u5f53\u306b\u306a\u308a\u3001\u7121\u4e8b\u3067\u6765\u305f\u306e\u3067\u3053\u3053\u306b\u8a18\u3057\u307e\u3059\u3002\n\n## \u6761\u4ef6\n\u753b\u50cf\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306f\u4ed6\u306e\u65b9\u304c\u62c5\u5f53\u3057\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u5f15\u6570\u3068\u3057\u3066\u53d7\u3051\u53d6\u308a\u307e\u3059\u3002\n\u305d\u3057\u3066\u3001\u53d7\u3051\u53d6\u3063\u305f\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u3092\u9854\u8a8d\u8b58\u306b\u901a\u3057\u3001\u305d\u306e\u7d50\u679c\u304b\u3089\u9854\u306e\u3044\u3044\u611f\u3058\u306e\u5ea7\u6a19\u306b\u732b\u8033\u3092\u4e57\u305b\u307e\u3059\u3002\n\n## \u4f7f\u7528\u30e9\u30a4\u30d6\u30e9\u30ea\n\u9854\u8a8d\u8b58\u306e\u305f\u3081\u306bfaceplusplus\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\nfaceplusplus\u306fmashape\u8d8a\u3057\u306b\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u3061\u306a\u307f\u306bmashape\u306f\u3044\u308d\u3093\u306aAPI\u3092\u307e\u3068\u3081\u3066\u7c21\u5358\u306b\u4f7f\u3048\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002\n\n## \u9854\u8a8d\u8b58\n\n\u9854\u8a8d\u8b58\u306f\u4e0a\u8a18\u306b\u3082\u3042\u308b\u3088\u3046\u306bmashape\u8d8a\u3057\u306bfaceplusplus\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\u3044\u308d\u3044\u308d\u306a\u8a73\u3057\u3044\u7d50\u679c\u304c\u3068\u308c\u307e\u3059\u3002(\u6027\u5225\u3001\u5e74\u9f62\u3001\u7b11\u9854\u5ea6\u3068\u304b\u3082\uff01)\n\u4eca\u56de\u306f\u9854\u306e\u5e45\u3001\u9ad8\u3055\u3001\u4e2d\u5fc3\u5ea7\u6a19\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\u3061\u306a\u307f\u306b\u5ea7\u6a19\u306f\u30d4\u30af\u30bb\u30eb\u3058\u3083\u306a\u304f\u3066\u753b\u50cf\u306e\u7e26\u6a2a\u306e%\u3067\u8fd4\u3063\u3066\u304d\u307e\u3059\u306e\u3067\u3054\u6ce8\u610f\u3092\u3002\n\n```\nrequire_once dirname(__FILE__).'/unirest-php/lib/Unirest.php';\n\n  :\n\n  $response = Unirest::get(\"https://faceplusplus-faceplusplus.p.mashape.com/detection/detect?attribute=glass,pose,gender,age,race,smiling&url=\" . $img_url,\n    array(\n      \"X-Mashape-Key\" => \"K74HWn5JLsmsh6Xrnh6FHDYPI2jzp18pxOpjsnnaIgcHRpvNCc\"\n    )\n  );\n\n  $face_width = $response->body->face[0]->position->width;\n  $face_height = $response->body->face[0]->position->height;\n  $face_center_x = $response->body->face[0]->position->center->x;\n  $face_center_y = $response->body->face[0]->position->center->y;\n```\n\n## \u753b\u50cf\u5408\u6210\n\n\u3084\u308b\u3079\u304d\u3053\u3068\u306f\u732b\u8033\u306e\u753b\u50cf\u3092\u9854\u306e\u30b5\u30a4\u30ba\u306b\u5408\u308f\u305b\u3066\u62e1\u7e2e\u3057\u3066\u3001\u9854\u306e\u4e2d\u5fc3\u753b\u50cf\u306a\u3069\u3092\u3082\u3068\u306b\u306e\u305b\u307e\u3059\u3002\n\n\n```\n  // \u4e0a\u53f8\u306e\u753b\u50cf\u306e\u62e1\u5f35\u5b50\u3092\u3082\u3068\u306b\u753b\u50cf\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u308b\n  $path_splitted = explode(\".\", $path);\n  $ext = $path_splitted[count($path_splitted) - 1];\n  switch($ext) {\n    case 'png':\n      $base_image = imagecreatefrompng($path);\n      break;\n    case 'gif':\n      $base_image = imagecreatefromgif($path);\n      break;\n    case 'jpg':\n      $base_image = imagecreatefromjpeg($path);\n      break;\n    case 'jpeg':\n      $base_image = imagecreatefromjpeg($path);\n      break;\n    default:\n      break;\n  }\n\n  // \u732b\u8033\u753b\u50cf\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u308b\n  $nekomimi_path = \"nekomimi\";\n  $nekomimi = imagecreatefrompng($nekomimi_path);\n  \n  // \u62e1\u7e2e\u3057\u3066\u3044\u304f\n  // \u732b\u8033\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u3092\u53d6\u5f97\n  list($width_nekomimi, $height_kami) = getimagesize($nekomimi_path);\n  // \u62e1\u7e2e\u5f8c\u306e\u732b\u8033\u753b\u50cf\u306e\u6a2a\u5e45\u3092 \u9854\u306e\u5e45 * 1.6 \u3068\u3059\u308b\u3002(1.6\u3068\u3044\u3046\u6570\u5b57\u306f\u4f7f\u3046\u732b\u8033\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306b\u3088\u3063\u3066\u5909\u308f\u308a\u5f97\u307e\u3059\u3002)\n  $new_width_nekomimi = $face_width * 1.6;\n  // \u62e1\u7e2e\u5f8c\u306e\u732b\u8033\u753b\u50cf\u306e\u9ad8\u3055\u306f\u62e1\u7e2e\u5f8c\u306e\u6a2a\u5e45\u3068\u5143\u306e\u5e45\u3092\u3082\u3068\u306b\u7b97\u51fa\u3059\u308b\n  $new_height_nekomimi = $height_kami * ( $new_width_nekomimi / $width_nekomimi);\n  // \u62e1\u7e2e\u6e08\u307f\u732b\u8033\u753b\u50cf\u3088\u3046\u306e\u7a7a\u306e\u753b\u50cf\u3092\u4f5c\u308b\n  $scaled_nekomimi = imagecreatetruecolor($width_base, $height_base);\n  // \u900f\u904e\u3092\u8a2d\u5b9a\u3059\u308b\n  $alpha = imagecolortransparent($nekomimi);\n  imagefill($scaled_nekomimi, 0, 0, $alpha);\n  imagecolortransparent($scaled_nekomimi, $alpha);\n  imagecolortransparent($base_image, $alpha);\n  // \u3053\u3053\u3067\u732b\u8033\u753b\u50cf\u3092\u62e1\u7e2e\u5c0f\u3059\u308b\n  imagecopyresampled($scaled_nekomimi, $nekomimi, 0, 0, 0, 0, $new_width_nekomimi, $new_height_nekomimi, $width_nekomimi, $height_nekomimi);\n\n  // \u732b\u8033\u753b\u50cf\u3092\u4e0a\u53f8\u753b\u50cf\u306b\u8cbc\u4ed8\u3051\u308b\u3002($face_center_y * 0.1\u306e\u3068\u3053\u308d\u306f\u88dc\u6b63\u3067\u3059)\n  $result = imagecopy($base_image, $scaled_nekomimi, $face_center_x - ($new_width_nekomimi / 2), $face_center_y - ($new_height_nekomimi / 2) + $face_center_y * 0.1, 0, 0, $width_base, $height_base);\n  \n  imagepng($base_image, \"files2/\".$filename);\n\n  // \u304a\u4f5c\u6cd5\n  imagedestroy($nekomimi);\n  imagedestroy($scaled_nekomimi);\n  imagedestroy($base_image);\n\n```\n\n## \u5b9f\u969b\u306e\u30bd\u30fc\u30b9\n\n\u6700\u7d42\u7684\u306b\u4e0b\u8a18\u306b\u306a\u308a\u307e\u3057\u305f\n\n```php:api.php\n<?php\nrequire_once dirname(__FILE__).'/unirest-php/lib/Unirest.php';\n\nfunction getSimilarCelebs($filename) {\n  $path = \"files/\".$filename;\n  $img_url = \"http://orenojs.ddo.jp/files/\".$filename;\n\n  $response = Unirest::get(\"https://faceplusplus-faceplusplus.p.mashape.com/detection/detect?attribute=glass,pose,gender,age,race,smiling&url=\" . $img_url,\n    array(\n      \"X-Mashape-Key\" => \"K74HWn5JLsmsh6Xrnh6FHDYPI2jzp18pxOpjsnnaIgcHRpvNCc\"\n    )\n  );\n\n  $face_width = $response->body->face[0]->position->width;\n  $face_height = $response->body->face[0]->position->height;\n  $face_center_x = $response->body->face[0]->position->center->x;\n  $face_center_y = $response->body->face[0]->position->center->y;\n\n  list($width_base, $height_base) = getimagesize($path);\n\n  $face_width = $width_base * ($face_width / 100);\n  $face_height = $height_base * ($face_height / 100);\n  $face_center_x = $width_base * ($face_center_x / 100);\n  $face_center_y = $height_base * ($face_center_y / 100);\n\n  // \u4e0a\u53f8\u306e\u753b\u50cf\u306e\u62e1\u5f35\u5b50\u3092\u3082\u3068\u306b\u753b\u50cf\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u308b\n  $path_splitted = explode(\".\", $path);\n  $ext = $path_splitted[count($path_splitted) - 1];\n  switch($ext) {\n    case 'png':\n      $base_image = imagecreatefrompng($path);\n      break;\n    case 'gif':\n      $base_image = imagecreatefromgif($path);\n      break;\n    case 'jpg':\n      $base_image = imagecreatefromjpeg($path);\n      break;\n    case 'jpeg':\n      $base_image = imagecreatefromjpeg($path);\n      break;\n    default:\n      break;\n  }\n\n  // \u732b\u8033\u753b\u50cf\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u308b\n  $nekomimi_path = \"nekomimi\";\n  $nekomimi = imagecreatefrompng($nekomimi_path);\n  \n  // \u62e1\u7e2e\u3057\u3066\u3044\u304f\n  // \u732b\u8033\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u3092\u53d6\u5f97\n  list($width_nekomimi, $height_kami) = getimagesize($nekomimi_path);\n  // \u62e1\u7e2e\u5f8c\u306e\u732b\u8033\u753b\u50cf\u306e\u6a2a\u5e45\u3092 \u9854\u306e\u5e45 * 1.6 \u3068\u3059\u308b\u3002(1.6\u3068\u3044\u3046\u6570\u5b57\u306f\u4f7f\u3046\u732b\u8033\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306b\u3088\u3063\u3066\u5909\u308f\u308a\u5f97\u307e\u3059\u3002)\n  $new_width_nekomimi = $face_width * 1.6;\n  // \u62e1\u7e2e\u5f8c\u306e\u732b\u8033\u753b\u50cf\u306e\u9ad8\u3055\u306f\u62e1\u7e2e\u5f8c\u306e\u6a2a\u5e45\u3068\u5143\u306e\u5e45\u3092\u3082\u3068\u306b\u7b97\u51fa\u3059\u308b\n  $new_height_nekomimi = $height_kami * ( $new_width_nekomimi / $width_nekomimi);\n  // \u62e1\u7e2e\u6e08\u307f\u732b\u8033\u753b\u50cf\u3088\u3046\u306e\u7a7a\u306e\u753b\u50cf\u3092\u4f5c\u308b\n  $scaled_nekomimi = imagecreatetruecolor($width_base, $height_base);\n  // \u900f\u904e\u3092\u8a2d\u5b9a\u3059\u308b\n  $alpha = imagecolortransparent($nekomimi);\n  imagefill($scaled_nekomimi, 0, 0, $alpha);\n  imagecolortransparent($scaled_nekomimi, $alpha);\n  imagecolortransparent($base_image, $alpha);\n  // \u3053\u3053\u3067\u732b\u8033\u753b\u50cf\u3092\u62e1\u7e2e\u5c0f\u3059\u308b\n  imagecopyresampled($scaled_nekomimi, $nekomimi, 0, 0, 0, 0, $new_width_nekomimi, $new_height_nekomimi, $width_nekomimi, $height_nekomimi);\n\n  // \u732b\u8033\u753b\u50cf\u3092\u4e0a\u53f8\u753b\u50cf\u306b\u8cbc\u4ed8\u3051\u308b\u3002($face_center_y * 0.1\u306e\u3068\u3053\u308d\u306f\u88dc\u6b63\u3067\u3059)\n  $result = imagecopy($base_image, $scaled_nekomimi, $face_center_x - ($new_width_nekomimi / 2), $face_center_y - ($new_height_nekomimi / 2) + $face_center_y * 0.1, 0, 0, $width_base, $height_base);\n  \n  imagepng($base_image, \"files2/\".$filename);\n\n  // \u304a\u4f5c\u6cd5\n  imagedestroy($nekomimi);\n  imagedestroy($scaled_nekomimi);\n  imagedestroy($base_image);\n\n  return $result;\n}\n\n?>\n```\n\n## \u611f\u60f3\nPHP\u666e\u6bb5\u4f7f\u308f\u306a\u3044\u3068\u3044\u3046\u304b\u3001\u3061\u3083\u3093\u3068PHP\u4f7f\u3063\u305f\u306e\u3063\u30663\u5e74\u304f\u3089\u3044\u524d\u306a\u306e\u3067\u6b7b\u306c\u307b\u3069\u6642\u9593\u304b\u304b\u308a\u307e\u3057\u305forz\n", "tags": ["faceplusplus", "PHP", "Mashape", "\u9854\u8a8d\u8b58"]}