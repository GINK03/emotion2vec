{"context": " More than 1 year has passed since last update.Stan \u3067\u6b20\u6e2c\u30c7\u30fc\u30bf\u306e\u76f8\u95a2\u4fc2\u6570\u3092\u63a8\u5b9a\u3057\u3066\u307f\u305f\u306e\u88dc\u8db3\u8cc7\u6599\u3067\u3059\u3002\n\u5b9f\u884c\u3057\u305f\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u5168\u4f53\u3067\u3059\u3002\n\nmodel.stan\ndata{\n  int<lower=0> N;\n  vector[2] y[N];\n  int<lower=0> Nmiss;\n  real x[Nmiss];\n}\nparameters {\n  vector[2] mu;\n  real<lower=0> var_x;\n  real<lower=0> var_y;\n  real cov;\n}\ntransformed parameters {\n  matrix[2,2] sigma;\n  sigma[1,1] <- var_x;\n  sigma[2,1] <- cov;\n  sigma[1,2] <- cov;\n  sigma[2,2] <- var_y;\n}\nmodel{\n  for(i in 1:N)\n    y[i] ~ multi_normal(mu, sigma);\n  for(i in 1:Nmiss)\n    x[i] ~ normal(mu[1], sqrt(sigma[1,1]));\n#    increment_log_prob(-0.5 * log(2 * pi() * sigma[1,1]) - 0.5 * ((x[i] - mu[1])^2)/sigma[1,1]);\n}\ngenerated quantities {\n  real cor;\n  cor <- cov / sqrt(var_x * var_y);\n}\n\n\n\nmain.R\nlibrary(rstan) \n\nset.seed(123)\nN <- 1000\nx <- rnorm(N, mean = 50, sd = 10)\ny <- 10 + 0.8 * x + rnorm(N, mean =0, sd = 7)\ndata <- data.frame(x, y)\ndata1 <- subset(data, x >= 60)\ndata2 <- subset(data, x < 60)\n\nset.seed(314)\ndatastan <- list(N=nrow(data1), y=data1, x=data2$x, Nmiss=nrow(data2))\nfit <- stan(file=\"model.stan\", data=datastan, iter=1000, chain=4)\ntraceplot(fit, ask=FALSE)\nprint(fit, digit=2)\n\n\n\n\u7d50\u679c\n               mean se_mean    sd     2.5%      25%      50%      75%    97.5% n_eff Rhat\nmu[1]         50.17    0.01  0.31    49.57    49.96    50.16    50.37    50.78   709 1.01\nmu[2]         47.91    0.11  2.02    43.73    46.63    47.91    49.19    51.87   320 1.01\nvar_x         99.02    0.16  4.66    90.17    95.93    98.97   102.08   108.24   872 1.00\nvar_y        153.43    1.57 26.75   109.73   134.96   151.41   168.48   211.08   292 1.02\ncov           99.73    0.73 13.26    74.21    91.13    99.59   108.24   126.37   331 1.02\nsigma[1,1]    99.02    0.16  4.66    90.17    95.93    98.97   102.08   108.24   872 1.00\nsigma[1,2]    99.73    0.73 13.26    74.21    91.13    99.59   108.24   126.37   331 1.02\nsigma[2,1]    99.73    0.73 13.26    74.21    91.13    99.59   108.24   126.37   331 1.02\nsigma[2,2]   153.43    1.57 26.75   109.73   134.96   151.41   168.48   211.08   292 1.02\ncor            0.81    0.00  0.04     0.71     0.79     0.81     0.84     0.87   785 1.01\nlp__       -3171.17    0.07  1.73 -3175.50 -3172.02 -3170.86 -3169.92 -3168.93   577 1.00\n\n\n[Stan \u3067\u6b20\u6e2c\u30c7\u30fc\u30bf\u306e\u76f8\u95a2\u4fc2\u6570\u3092\u63a8\u5b9a\u3057\u3066\u307f\u305f](http://www.slideshare.net/hoxo_m/stan-36896297)\u306e\u88dc\u8db3\u8cc7\u6599\u3067\u3059\u3002\n\n\u5b9f\u884c\u3057\u305f\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u5168\u4f53\u3067\u3059\u3002\n\n```stan:model.stan\ndata{\n  int<lower=0> N;\n  vector[2] y[N];\n  int<lower=0> Nmiss;\n  real x[Nmiss];\n}\nparameters {\n  vector[2] mu;\n  real<lower=0> var_x;\n  real<lower=0> var_y;\n  real cov;\n}\ntransformed parameters {\n  matrix[2,2] sigma;\n  sigma[1,1] <- var_x;\n  sigma[2,1] <- cov;\n  sigma[1,2] <- cov;\n  sigma[2,2] <- var_y;\n}\nmodel{\n  for(i in 1:N)\n    y[i] ~ multi_normal(mu, sigma);\n  for(i in 1:Nmiss)\n    x[i] ~ normal(mu[1], sqrt(sigma[1,1]));\n#    increment_log_prob(-0.5 * log(2 * pi() * sigma[1,1]) - 0.5 * ((x[i] - mu[1])^2)/sigma[1,1]);\n}\ngenerated quantities {\n  real cor;\n  cor <- cov / sqrt(var_x * var_y);\n}\n```\n\n```r:main.R\nlibrary(rstan) \n\nset.seed(123)\nN <- 1000\nx <- rnorm(N, mean = 50, sd = 10)\ny <- 10 + 0.8 * x + rnorm(N, mean =0, sd = 7)\ndata <- data.frame(x, y)\ndata1 <- subset(data, x >= 60)\ndata2 <- subset(data, x < 60)\n\nset.seed(314)\ndatastan <- list(N=nrow(data1), y=data1, x=data2$x, Nmiss=nrow(data2))\nfit <- stan(file=\"model.stan\", data=datastan, iter=1000, chain=4)\ntraceplot(fit, ask=FALSE)\nprint(fit, digit=2)\n```\n\n```:\u7d50\u679c\n               mean se_mean    sd     2.5%      25%      50%      75%    97.5% n_eff Rhat\nmu[1]         50.17    0.01  0.31    49.57    49.96    50.16    50.37    50.78   709 1.01\nmu[2]         47.91    0.11  2.02    43.73    46.63    47.91    49.19    51.87   320 1.01\nvar_x         99.02    0.16  4.66    90.17    95.93    98.97   102.08   108.24   872 1.00\nvar_y        153.43    1.57 26.75   109.73   134.96   151.41   168.48   211.08   292 1.02\ncov           99.73    0.73 13.26    74.21    91.13    99.59   108.24   126.37   331 1.02\nsigma[1,1]    99.02    0.16  4.66    90.17    95.93    98.97   102.08   108.24   872 1.00\nsigma[1,2]    99.73    0.73 13.26    74.21    91.13    99.59   108.24   126.37   331 1.02\nsigma[2,1]    99.73    0.73 13.26    74.21    91.13    99.59   108.24   126.37   331 1.02\nsigma[2,2]   153.43    1.57 26.75   109.73   134.96   151.41   168.48   211.08   292 1.02\ncor            0.81    0.00  0.04     0.71     0.79     0.81     0.84     0.87   785 1.01\nlp__       -3171.17    0.07  1.73 -3175.50 -3172.02 -3170.86 -3169.92 -3168.93   577 1.00\n```\n", "tags": ["R", "RStan2.3.0"]}