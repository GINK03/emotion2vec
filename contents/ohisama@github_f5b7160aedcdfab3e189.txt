{"context": " More than 1 year has passed since last update.\n\nevent\u3092\u4f7f\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n#include \"ch.h\"\n#include \"hal.h\"\n\n#define CONSOLE_WA_SIZE      THD_WORKING_AREA_SIZE(4096)\n#define cputs(msg)            chMsgSend(cdtp, (msg_t) msg)\nstatic thread_t * cdtp;\nstatic THD_FUNCTION(console_thread, arg)\n{\n    (void) arg;\n    while (!chThdShouldTerminateX())\n    {\n        thread_t * tp = chMsgWait();\n        puts((char *) chMsgGet(tp));\n        fflush(stdout);\n        chMsgRelease(tp, MSG_OK);\n    }\n}\nstatic THD_WORKING_AREA(waThread1, 1024);\nstatic THD_FUNCTION(Thread1, arg)\n{\n    eventmask_t m;\n    (void) arg;\n    chRegSetThreadName(\"green\");\n    while (TRUE)\n    {\n        m = chEvtWaitOne(ALL_EVENTS);\n        cputs(\"green on\");\n        chThdSleepMilliseconds(1000);\n        cputs(\"green off\");\n    }\n}\nstatic THD_WORKING_AREA(waThread2, 1024);\nstatic THD_FUNCTION(Thread2, arg)\n{\n    eventmask_t m;\n    (void) arg;\n    chRegSetThreadName(\"yellow\");\n    while (TRUE)\n    {\n        m = chEvtWaitOne(ALL_EVENTS);\n        cputs(\"yellow on\");\n        chThdSleepMilliseconds(1000);\n        cputs(\"yellow off\");\n    }\n}\nstatic THD_WORKING_AREA(waThread3, 1024);\nstatic THD_FUNCTION(Thread3, arg)\n{\n    eventmask_t m;\n    (void) arg;\n    chRegSetThreadName(\"red\");\n    while (TRUE)\n    {\n        m = chEvtWaitOne(ALL_EVENTS);\n        cputs(\"red on\");\n        chThdSleepMilliseconds(1000);\n        cputs(\"red off\");\n    }\n}\nint main(void)\n{\n    halInit();\n    chSysInit();\n    chEvtGetAndClearEvents(ALL_EVENTS);\n    int n;\n    n = 0;\n    cdtp = chThdCreateFromHeap(NULL, CONSOLE_WA_SIZE, NORMALPRIO, console_thread, NULL);\n    thread_t * tp1 = chThdCreateStatic(waThread1, sizeof(waThread1), NORMALPRIO + 1, Thread1, NULL);\n    thread_t * tp2 = chThdCreateStatic(waThread2, sizeof(waThread2), NORMALPRIO + 1, Thread2, NULL);\n    thread_t * tp3 = chThdCreateStatic(waThread3, sizeof(waThread3), NORMALPRIO + 1, Thread3, NULL);\n    while (!chThdShouldTerminateX())\n    {\n        n++;\n        if (n > 3) n = 1;\n        chThdSleepMilliseconds(1000);\n        if (n == 1) chEvtSignal((thread_t *) tp1, 1);\n        if (n == 2) chEvtSignal((thread_t *) tp2, 1);\n        if (n == 3) chEvtSignal((thread_t *) tp3, 1);\n    }\n    return 0;\n}\n\n\n## event\u3092\u4f7f\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n```\n#include \"ch.h\"\n#include \"hal.h\"\n\n#define CONSOLE_WA_SIZE\t\t THD_WORKING_AREA_SIZE(4096)\n#define cputs(msg)\t\t\t  chMsgSend(cdtp, (msg_t) msg)\nstatic thread_t * cdtp;\nstatic THD_FUNCTION(console_thread, arg)\n{\n\t(void) arg;\n\twhile (!chThdShouldTerminateX())\n\t{\n\t\tthread_t * tp = chMsgWait();\n\t\tputs((char *) chMsgGet(tp));\n\t\tfflush(stdout);\n\t\tchMsgRelease(tp, MSG_OK);\n\t}\n}\nstatic THD_WORKING_AREA(waThread1, 1024);\nstatic THD_FUNCTION(Thread1, arg)\n{\n\teventmask_t m;\n\t(void) arg;\n\tchRegSetThreadName(\"green\");\n\twhile (TRUE)\n\t{\n\t\tm = chEvtWaitOne(ALL_EVENTS);\n\t\tcputs(\"green on\");\n\t\tchThdSleepMilliseconds(1000);\n\t\tcputs(\"green off\");\n\t}\n}\nstatic THD_WORKING_AREA(waThread2, 1024);\nstatic THD_FUNCTION(Thread2, arg)\n{\n\teventmask_t m;\n\t(void) arg;\n\tchRegSetThreadName(\"yellow\");\n\twhile (TRUE)\n\t{\n\t\tm = chEvtWaitOne(ALL_EVENTS);\n\t\tcputs(\"yellow on\");\n\t\tchThdSleepMilliseconds(1000);\n\t\tcputs(\"yellow off\");\n\t}\n}\nstatic THD_WORKING_AREA(waThread3, 1024);\nstatic THD_FUNCTION(Thread3, arg)\n{\n\teventmask_t m;\n\t(void) arg;\n\tchRegSetThreadName(\"red\");\n\twhile (TRUE)\n\t{\n\t\tm = chEvtWaitOne(ALL_EVENTS);\n\t\tcputs(\"red on\");\n\t\tchThdSleepMilliseconds(1000);\n\t\tcputs(\"red off\");\n\t}\n}\nint main(void)\n{\n\thalInit();\n\tchSysInit();\n\tchEvtGetAndClearEvents(ALL_EVENTS);\n\tint n;\n\tn = 0;\n\tcdtp = chThdCreateFromHeap(NULL, CONSOLE_WA_SIZE, NORMALPRIO, console_thread, NULL);\n\tthread_t * tp1 = chThdCreateStatic(waThread1, sizeof(waThread1), NORMALPRIO + 1, Thread1, NULL);\n\tthread_t * tp2 = chThdCreateStatic(waThread2, sizeof(waThread2), NORMALPRIO + 1, Thread2, NULL);\n\tthread_t * tp3 = chThdCreateStatic(waThread3, sizeof(waThread3), NORMALPRIO + 1, Thread3, NULL);\n\twhile (!chThdShouldTerminateX())\n\t{\n\t\tn++;\n\t\tif (n > 3) n = 1;\n\t\tchThdSleepMilliseconds(1000);\n\t\tif (n == 1) chEvtSignal((thread_t *) tp1, 1);\n\t\tif (n == 2) chEvtSignal((thread_t *) tp2, 1);\n\t\tif (n == 3) chEvtSignal((thread_t *) tp3, 1);\n\t}\n\treturn 0;\n}\n\n```\n", "tags": ["chibios", "L\u30c1\u30ab", "event"]}