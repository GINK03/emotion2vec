{"context": " More than 1 year has passed since last update.\n\n\u5229\u7528\u30b1\u30fc\u30b9\n\u4f8b\u3048\u3070\u30012014-04-01\u304b\u3089\u672c\u65e5\u3067\u3042\u308b2014-05-19\u307e\u3067\u306e\u30e6\u30fc\u30b6id\u3092\u96c6\u8a08\u3084\u7d2f\u8a08\u3057\u305f\u3044\u5834\u5408\u306b\u3001\nTreasureData\u304c\u63d0\u4f9b\u3059\u308bUDF\u3067\u3042\u308bTD_TIME_ADD\u3092\u4f7f\u3044\u305f\u3044\u3002\n\u4f8b\u3048\u3070\u3001\u524d\u6708\u306e\u6307\u5b9a\u306b\u306f\u3001TD_TIME_ADD(time, '-1M', 'JST')\u306a\u3069\u3002\n\u3057\u304b\u3057\u3001\u73fe\u5728\u306f\u4e0a\u8a18\u306e\u3088\u3046\u306a\u3001TD_TIME_ADD\u3067Month\u3084Year\u3067\u306e\u52a0\u6e1b\u304c\u884c\u3048\u306a\u3044\u3002\nhttp://docs.treasuredata.com/articles/udfs#tdtimeadd\n\u305d\u306e\u305f\u3081\u3001TD_TIME_ADD(time, '-30d', 'JST')\u3092\u4f7f\u3063\u3066\u306e\u6307\u5b9a\u304c\u5fc5\u8981\u306b\u306a\u308b\u304c\u3001\u6708\u306e\u65e5\u6570\u306f\u4e0d\u5b9a\u3067\u3042\u308b\u305f\u3081\u3001\u4e0b\u8a18\u30b5\u30f3\u30d7\u30eb\u30af\u30a8\u30ea\u306e\u3088\u3046\u306a\u4e00\u5de5\u592b\u304c\u3044\u308b\u3002\n\n\u30b5\u30f3\u30d7\u30eb\u30af\u30a8\u30ea\n\u524d\u6708\u304b\u3089\u5404\u65e5\u6bce\u306e\u30e6\u30fc\u30b6\u6570\u306e\u96c6\u8a08\u3092\u884c\u3046\u30af\u30a8\u30ea\nSELECT \n  date_time,\n  COUNT(1) AS cnt\nFROM\n(\n SELECT \n   uid,\n   TD_TIME_FORMAT(time,'yyyy-MM-dd','JST') AS date_time,\n   TD_TIME_FORMAT(TD_SCHEDULED_TIME(),'yyyy-MM-dd','JST') AS now_datetime\n FROM access\n WHERE \n  time < TD_SCHEDULED_TIME()\n  AND time >= TD_TIME_ADD(TD_SCHEDULED_TIME(),'-64d','JST')\n) monthly\nWHERE (MONTH(now_datetime)- MONTH(date_time)) IN (0, 1, -11)\nGROUP BY\n  date_time\n\n\n\u30b5\u30f3\u30d7\u30eb\u30af\u30a8\u30ea\u8aac\u660e\n\n\u30b5\u30d6\u30af\u30a8\u30ea\u90e8\n\u3053\u306e\u30b5\u30d6\u30af\u30a8\u30ea\u3067\u306f\u3001\u30c6\u30fc\u30d6\u30eb\u304b\u3089\u5c11\u306a\u304f\u3068\u3082\u524d\u6708\u307e\u3067\u306e\u30c7\u30fc\u30bf\u304c\u5165\u308b\u671f\u9593\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\u3002\n2\u30f6\u6708*31\u65e5 = 62, Timezone\u306a\u3069\u3092\u8003\u616e\u3057\u3001\u5ff5\u306e\u305f\u3081+2\u3082\u3057\u3066\u3044\u308b\u3002\nTD_SCHEDULED_TIME()\u3092\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u30af\u30a8\u30ea\u3067\u306f\u306a\u304f\u5229\u7528\u3059\u308b\u3068\u3001\u73fe\u5728\u6642\u523b\u304c\u683c\u7d0d\u3055\u308c\u308b\u3002\n(\n SELECT \n   uid,\n   TD_TIME_FORMAT(time,'yyyy-MM-dd','JST') AS date_time,\n   TD_TIME_FORMAT(TD_SCHEDULED_TIME(),'yyyy-MM-dd','JST') AS now_datetime\n FROM access\n WHERE \n  time < TD_SCHEDULED_TIME()\n  AND time >= TD_TIME_ADD(TD_SCHEDULED_TIME(),'-64d','JST')\n) monthly\n\n\n\u6761\u4ef6\u90e8\nMonth\u306f\u3001\u65e5\u4ed8\u306e\u6587\u5b57\u5217\u304b\u3089\u6708\u306e\u307f\u3092int\u3067\u51fa\u529b\u3059\u308b\u95a2\u6570\u3002\n\u305d\u3053\u3067\u3001(\u96c6\u8a08\u65e5\u306e\u6708 - \u30ec\u30b3\u30fc\u30c9\u306e\u65e5\u4ed8\u306e\u6708)\u3092\u5b9f\u65bd\u3057\u3001\u305d\u306e\u5dee\u5206\u3092\u898b\u3066\u540c\u6708\u304b\u524d\u6708\u304b\u305d\u308c\u4ee5\u5916\u304b\u3092\u5224\u65ad\u3057\u3066\u3044\u308b\u3002\n\n0: \u540c\u6708\n1: \u524d\u6708\n-11: \u96c6\u8a08\u65e5\u306e\u6708\u304c1\u6708\u3001\u30ec\u30b3\u30fc\u30c9\u306e\u65e5\u4ed8\u306e\u6708\u304c12\u6708\u306e\u5834\u5408\n\nWHERE (MONTH(now_datetime)- MONTH(date_time)) IN (0, 1, -11)\n\n# \u5229\u7528\u30b1\u30fc\u30b9\n\u4f8b\u3048\u3070\u30012014-04-01\u304b\u3089\u672c\u65e5\u3067\u3042\u308b2014-05-19\u307e\u3067\u306e\u30e6\u30fc\u30b6id\u3092\u96c6\u8a08\u3084\u7d2f\u8a08\u3057\u305f\u3044\u5834\u5408\u306b\u3001\nTreasureData\u304c\u63d0\u4f9b\u3059\u308bUDF\u3067\u3042\u308bTD_TIME_ADD\u3092\u4f7f\u3044\u305f\u3044\u3002\n\u4f8b\u3048\u3070\u3001\u524d\u6708\u306e\u6307\u5b9a\u306b\u306f\u3001TD_TIME_ADD(time, '-1M', 'JST')\u306a\u3069\u3002\n\u3057\u304b\u3057\u3001\u73fe\u5728\u306f\u4e0a\u8a18\u306e\u3088\u3046\u306a\u3001TD_TIME_ADD\u3067Month\u3084Year\u3067\u306e\u52a0\u6e1b\u304c\u884c\u3048\u306a\u3044\u3002\nhttp://docs.treasuredata.com/articles/udfs#tdtimeadd\n\n\u305d\u306e\u305f\u3081\u3001TD_TIME_ADD(time, '-30d', 'JST')\u3092\u4f7f\u3063\u3066\u306e\u6307\u5b9a\u304c\u5fc5\u8981\u306b\u306a\u308b\u304c\u3001\u6708\u306e\u65e5\u6570\u306f\u4e0d\u5b9a\u3067\u3042\u308b\u305f\u3081\u3001\u4e0b\u8a18\u30b5\u30f3\u30d7\u30eb\u30af\u30a8\u30ea\u306e\u3088\u3046\u306a\u4e00\u5de5\u592b\u304c\u3044\u308b\u3002\n\n# \u30b5\u30f3\u30d7\u30eb\u30af\u30a8\u30ea\n\u524d\u6708\u304b\u3089\u5404\u65e5\u6bce\u306e\u30e6\u30fc\u30b6\u6570\u306e\u96c6\u8a08\u3092\u884c\u3046\u30af\u30a8\u30ea\n\n```sql\nSELECT \n  date_time,\n  COUNT(1) AS cnt\nFROM\n(\n SELECT \n   uid,\n   TD_TIME_FORMAT(time,'yyyy-MM-dd','JST') AS date_time,\n   TD_TIME_FORMAT(TD_SCHEDULED_TIME(),'yyyy-MM-dd','JST') AS now_datetime\n FROM access\n WHERE \n  time < TD_SCHEDULED_TIME()\n  AND time >= TD_TIME_ADD(TD_SCHEDULED_TIME(),'-64d','JST')\n) monthly\nWHERE (MONTH(now_datetime)- MONTH(date_time)) IN (0, 1, -11)\nGROUP BY\n  date_time\n```\n\n# \u30b5\u30f3\u30d7\u30eb\u30af\u30a8\u30ea\u8aac\u660e\n## \u30b5\u30d6\u30af\u30a8\u30ea\u90e8\n\u3053\u306e\u30b5\u30d6\u30af\u30a8\u30ea\u3067\u306f\u3001\u30c6\u30fc\u30d6\u30eb\u304b\u3089\u5c11\u306a\u304f\u3068\u3082\u524d\u6708\u307e\u3067\u306e\u30c7\u30fc\u30bf\u304c\u5165\u308b\u671f\u9593\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\u3002\n2\u30f6\u6708*31\u65e5 = 62, Timezone\u306a\u3069\u3092\u8003\u616e\u3057\u3001\u5ff5\u306e\u305f\u3081+2\u3082\u3057\u3066\u3044\u308b\u3002\n\nTD_SCHEDULED_TIME()\u3092\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u30af\u30a8\u30ea\u3067\u306f\u306a\u304f\u5229\u7528\u3059\u308b\u3068\u3001\u73fe\u5728\u6642\u523b\u304c\u683c\u7d0d\u3055\u308c\u308b\u3002\n\n```sql\n(\n SELECT \n   uid,\n   TD_TIME_FORMAT(time,'yyyy-MM-dd','JST') AS date_time,\n   TD_TIME_FORMAT(TD_SCHEDULED_TIME(),'yyyy-MM-dd','JST') AS now_datetime\n FROM access\n WHERE \n  time < TD_SCHEDULED_TIME()\n  AND time >= TD_TIME_ADD(TD_SCHEDULED_TIME(),'-64d','JST')\n) monthly\n```\n\n## \u6761\u4ef6\u90e8\nMonth\u306f\u3001\u65e5\u4ed8\u306e\u6587\u5b57\u5217\u304b\u3089\u6708\u306e\u307f\u3092int\u3067\u51fa\u529b\u3059\u308b\u95a2\u6570\u3002\n\u305d\u3053\u3067\u3001(\u96c6\u8a08\u65e5\u306e\u6708 - \u30ec\u30b3\u30fc\u30c9\u306e\u65e5\u4ed8\u306e\u6708)\u3092\u5b9f\u65bd\u3057\u3001\u305d\u306e\u5dee\u5206\u3092\u898b\u3066\u540c\u6708\u304b\u524d\u6708\u304b\u305d\u308c\u4ee5\u5916\u304b\u3092\u5224\u65ad\u3057\u3066\u3044\u308b\u3002\n\n- 0: \u540c\u6708\n- 1: \u524d\u6708\n- -11: \u96c6\u8a08\u65e5\u306e\u6708\u304c1\u6708\u3001\u30ec\u30b3\u30fc\u30c9\u306e\u65e5\u4ed8\u306e\u6708\u304c12\u6708\u306e\u5834\u5408\n\n```sql\nWHERE (MONTH(now_datetime)- MONTH(date_time)) IN (0, 1, -11)\n```\n\n", "tags": ["TreasureData"]}