{"context": " More than 1 year has passed since last update.SSH bundled with OSX cannot handle ECDSA/ED25519 even on Yosemite.\nSo, some people recommend updating OpenSSH using Homebrew or MacPorts.\nBut, what about ssh-add? The bundled version has very nice integration with OSX Keychain, where you don't have to enter the passphrase in each login. We want to keep the feature.\nI searched the Internet and found the information that I can pass --with-keychain-support to brew, but I couldn't find the information about MacPorts easily.\nAfter investigating OpenSSH Portfile, I have found that gsskex varient does the work.\nSo, to enable ssh-add keychain feature, use this:\nMacPorts\u306eOpenSSH\u3067\u30ad\u30fc\u30c1\u30a7\u30fc\u30f3\u3092\u6709\u52b9\u5316\u3059\u308b\u306b\u306f\u6b21\u306e\u3088\u3046\u306b\u3057\u307e\u3059\u3002\nsudo port install openssh +gsskex\n\nIt is the same that you need to modify the startup file to load the correct ssh-agent.\n\u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u3092\u66f8\u304d\u63db\u3048\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u306fHomebrew\u3068\u540c\u69d8\u3067\u3059\u3002\nsudo sed -i '' 's/\\/usr\\/bin\\/ssh-agent/\\/opt\\/local\\/bin\\/ssh-agent/' /System/Library/LaunchAgents/org.openbsd.ssh-agent.plist\nlaunchctl unload -w /System/Library/LaunchAgents/org.openbsd.ssh-agent.plist\nsudo killall ssh-agent\nlaunchctl load -w -S Aqua /System/Library/LaunchAgents/org.openbsd.ssh-agent.plist\nlaunchctl start org.openbsd.ssh-agent\nexport SSH_AUTH_SOCK=$(launchctl getenv SSH_AUTH_SOCK)\n\n\nFinally, I introduce part of my .profile, which set up the ssh preference in starting up bash.\nif [ \"$TERMINAL_NAME\" != \"Apple_Terminal\" ]; then\n    #10.9 or below\n    #export SSH_AUTH_SOCK=$(ls -1t /tmp/launch-*/Listeners|head -n 1)\n    #10.10 or later\n    export SSH_AUTH_SOCK=$(ls -1t /tmp/com.apple.launchd.*/Listeners|head -n 1)\nfi\n\n\nWell, I think GSSAPI has nothing to do with keychain, but the patch is put into one place...\n\n[Edit] in the MacPorts (and Homebrew) version, the keychain-related switch is -M, not -K.\n[Edit2] You should remove all keychains before switching ssh-agent, or it will ask you to load keychain using Aqua, which causes soft-freeze on SSH.\n\u691c\u7d22\u7528\uff1aMacPorts\u306eOpenSSH\u306essh-add\u3067\u30ad\u30fc\u30c1\u30a7\u30fc\u30f3\u3092\u5229\u7528\u3059\u308b\n\nSSH bundled with OSX cannot handle ECDSA/ED25519 even on Yosemite.\nSo, some people recommend updating OpenSSH using Homebrew or MacPorts.\nBut, what about `ssh-add`? The bundled version has very nice integration with OSX Keychain, where you don't have to enter the passphrase in each login. We want to keep the feature.\n\nI searched the Internet and found the information that I can pass `--with-keychain-support` to brew, but I couldn't find the information about MacPorts easily.\nAfter investigating OpenSSH Portfile, I have found that gsskex varient does the work.\n\nSo, to enable ssh-add keychain feature, use this:\nMacPorts\u306eOpenSSH\u3067\u30ad\u30fc\u30c1\u30a7\u30fc\u30f3\u3092\u6709\u52b9\u5316\u3059\u308b\u306b\u306f\u6b21\u306e\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```bash\nsudo port install openssh +gsskex\n```\n\nIt is the same that you need to modify the startup file to load the correct ssh-agent.\n\u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u3092\u66f8\u304d\u63db\u3048\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u306fHomebrew\u3068\u540c\u69d8\u3067\u3059\u3002\n\n```bash\nsudo sed -i '' 's/\\/usr\\/bin\\/ssh-agent/\\/opt\\/local\\/bin\\/ssh-agent/' /System/Library/LaunchAgents/org.openbsd.ssh-agent.plist\nlaunchctl unload -w /System/Library/LaunchAgents/org.openbsd.ssh-agent.plist\nsudo killall ssh-agent\nlaunchctl load -w -S Aqua /System/Library/LaunchAgents/org.openbsd.ssh-agent.plist\nlaunchctl start org.openbsd.ssh-agent\nexport SSH_AUTH_SOCK=$(launchctl getenv SSH_AUTH_SOCK)\n```\n\n---\n\nFinally, I introduce part of my .profile, which set up the ssh preference in starting up bash.\n\n```bash\nif [ \"$TERMINAL_NAME\" != \"Apple_Terminal\" ]; then\n\t#10.9 or below\n\t#export SSH_AUTH_SOCK=$(ls -1t /tmp/launch-*/Listeners|head -n 1)\n\t#10.10 or later\n\texport SSH_AUTH_SOCK=$(ls -1t /tmp/com.apple.launchd.*/Listeners|head -n 1)\nfi\n```\n\n---\n\nWell, I think GSSAPI has nothing to do with keychain, but the patch is put into one place...\n\n---\n\n[Edit] in the MacPorts (and Homebrew) version, the keychain-related switch is -M, not -K.\n[Edit2] **You should remove all keychains before switching ssh-agent, or it will ask you to load keychain using Aqua, which causes soft-freeze on SSH.**\n\n\u691c\u7d22\u7528\uff1aMacPorts\u306eOpenSSH\u306essh-add\u3067\u30ad\u30fc\u30c1\u30a7\u30fc\u30f3\u3092\u5229\u7528\u3059\u308b\n", "tags": ["OSX", "SSH", "macports"]}