{"context": "\n\n\u6982\u8981\nAWS Lambda\u3092\u4f7f\u3063\u3066\u6708~\u91d1\u306e19:00\u306bSlack\u3078\u9000\u52e4\u6642\u523b\u3092\u901a\u77e5\u3057\u3001\u6253\u523b\u3092\u4fc3\u3059\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u6295\u7a3f\u3059\u308b\u3002\n\nAWS Lambda\u3067\u306e\u5b9a\u671f\u5b9f\u884c\n\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb: \u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3055\u308c\u305f\u30a4\u30d9\u30f3\u30c8\u3067\u306e AWS Lambda \u306e\u4f7f\u7528\u3092\u53c2\u8003\u306b\u3059\u308b\u3068\u5b9f\u73fe\u3067\u304d\u305d\u3046\u306a\u306e\u3067\u3001\u3053\u306e\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3092\u53c2\u8003\u306b\u9032\u3081\u307e\u3059\u3002\n\nLambda\u95a2\u6570\u3092\u4f5c\u6210\n\nSelect blueprint\u3067\u300clambda-canary\u300d\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n\n\n\nConfigure triggers\u306e\u5404\u9805\u76ee\u3092\u8a18\u5165\u3057\u307e\u3059\u3002\n\n\nSchedule expression\u306e\u8a18\u5165\u65b9\u6cd5\u306b\u3064\u3044\u3066\u306f\u3053\u3061\u3089\u3092\u53c2\u8003\u306b\u6307\u5b9a\u3002\n\n\n\n\n\n\nLambda function handler and role\u3067\u306f\u3001Role*\u3001Policy templates\u306a\u3069\u306f\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u306b\u6cbf\u3063\u3066\u5165\u529b\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n\n\n\nNext\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001Review\u3067\u8a2d\u5b9a\u3092\u78ba\u8a8d\u5f8c\u300cCreate function\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057Lambda\u95a2\u6570\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\nLambda \u95a2\u6570\u3092\u30c6\u30b9\u30c8\n\n\u4f5c\u6210\u3057\u305f\u95a2\u6570\u3092\u9078\u629e\u3057\u3001 Test\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\u30c0\u30a4\u30a2\u30ed\u30b0\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001 Sample event template\u304b\u3089 Scheduled Event\u3092\u9078\u629e\u3057\u3001 Save and test\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\nExecution result\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u6210\u5426\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\n\nSlack\u3078\u901a\u77e5\u3059\u308b\u30b3\u30fc\u30c9\u3092\u66f8\u304f\nEnvironment variables\u306bSlack\u306eAPI token\u3092SLACK_API_TOKEN\u3068\u3057\u3066\u767b\u9332\u3057\u3001process.env.SLACK_API_TOKEN\u3067\u53c2\u7167\u3057\u307e\u3059\u3002\nvar https = require('https');\nvar qs = require('querystring');\n\nexports.handler = (event, context, callback) => {\n\n    var query = qs.stringify({\n        'token': process.env.SLACK_API_TOKEN,\n        'channel': \"CHANNEL_NAME\",\n        'text': \"@horie \u9000\u52e4\u3057\u307e\u3057\u3087\u3046\uff01\\nhttps://hoge.html\",\n        'mrkdwn': true,\n        'link_names': 1\n      });\n\n    var options = {\n        host: 'slack.com',\n        port: '443',\n        path: '/api/chat.postMessage?' + query,\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json; charset=utf-8\"'\n        }\n    };\n\n    var req = https.request(options, function(res) {\n        res.setEncoding('utf8');\n        res.on('data', function(res) {\n            callback(null, res);\n        });\n    });\n    req.on('error', (e) => {\n        callback(null, 'error' + e.message);\n    });\n    req.write('');\n    req.end();\n};\n\nTest\u3067\u95a2\u6570\u3092\u5b9f\u884c\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306bSlack\u306b\u901a\u77e5\u3055\u308c\u307e\u3059\u3002\n\n\u554f\u984c\u304c\u7121\u3051\u308c\u3070CloudWatch Events - Schedule\u3092Enable\u306b\u3057\u3066\u5b8c\u4e86\u3067\u3059\u3002\n\n\n\u307e\u3068\u3081\n\nAWS Lambda\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u3067\u30b5\u30fc\u30d0\u30fc\u30ec\u30b9\u3067\u9000\u52e4\u6642\u523b\u306e\u901a\u77e5\u3068\u6253\u523b\u3092\u4fc3\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u6253\u523b\u3092\u5fd8\u308c\u306a\u3044\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\uff01\n\n\n\u53c2\u8003\n\nhttps://docs.aws.amazon.com/ja_jp/lambda/latest/dg/with-scheduledevents-example.html\nhttp://dev.classmethod.jp/cloud/aws/aws-lambda-env-variables/\n\n\n# \u6982\u8981\n\nAWS Lambda\u3092\u4f7f\u3063\u3066\u6708~\u91d1\u306e19:00\u306bSlack\u3078\u9000\u52e4\u6642\u523b\u3092\u901a\u77e5\u3057\u3001\u6253\u523b\u3092\u4fc3\u3059\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u6295\u7a3f\u3059\u308b\u3002\n\n# AWS Lambda\u3067\u306e\u5b9a\u671f\u5b9f\u884c\n\n[\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb: \u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3055\u308c\u305f\u30a4\u30d9\u30f3\u30c8\u3067\u306e AWS Lambda \u306e\u4f7f\u7528](https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/with-scheduledevents-example.html)\u3092\u53c2\u8003\u306b\u3059\u308b\u3068\u5b9f\u73fe\u3067\u304d\u305d\u3046\u306a\u306e\u3067\u3001\u3053\u306e\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3092\u53c2\u8003\u306b\u9032\u3081\u307e\u3059\u3002\n\n# Lambda\u95a2\u6570\u3092\u4f5c\u6210\n\n- Select blueprint\u3067\u300clambda-canary\u300d\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n![lambda_1.png](https://qiita-image-store.s3.amazonaws.com/0/43438/1e971049-540d-59c6-ed23-ba6434095cd2.png \"lambda_1.png\")\n\n- **Configure triggers**\u306e\u5404\u9805\u76ee\u3092\u8a18\u5165\u3057\u307e\u3059\u3002\n\t- Schedule expression\u306e\u8a18\u5165\u65b9\u6cd5\u306b\u3064\u3044\u3066\u306f[\u3053\u3061\u3089](https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/tutorial-scheduled-events-schedule-expressions.html)\u3092\u53c2\u8003\u306b\u6307\u5b9a\u3002\n\n![lambda_2.png](https://qiita-image-store.s3.amazonaws.com/0/43438/ba2b4da1-c9d3-00ff-554d-2143a2e115a0.png \"lambda_2.png\")\n\n- **Lambda function handler and role**\u3067\u306f\u3001`Role*`\u3001`Policy templates`\u306a\u3069\u306f\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u306b\u6cbf\u3063\u3066\u5165\u529b\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n![lambda_3.png](https://qiita-image-store.s3.amazonaws.com/0/43438/ed8020fc-015a-5b49-265b-ea8f113ca6a1.png \"lambda_3.png\")\n\n- **Next**\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001Review\u3067\u8a2d\u5b9a\u3092\u78ba\u8a8d\u5f8c\u300cCreate function\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057Lambda\u95a2\u6570\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n# Lambda \u95a2\u6570\u3092\u30c6\u30b9\u30c8\n\n- \u4f5c\u6210\u3057\u305f\u95a2\u6570\u3092\u9078\u629e\u3057\u3001 **Test**\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n- \u30c0\u30a4\u30a2\u30ed\u30b0\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001 **Sample event template**\u304b\u3089 **Scheduled Event**\u3092\u9078\u629e\u3057\u3001 **Save and test**\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n- **Execution result**\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u6210\u5426\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n![lambda_4.png](https://qiita-image-store.s3.amazonaws.com/0/43438/33fdef65-78c2-a261-0b8c-314ce4b8f375.png \"lambda_4.png\")\n\n# Slack\u3078\u901a\u77e5\u3059\u308b\u30b3\u30fc\u30c9\u3092\u66f8\u304f\n\nEnvironment variables\u306bSlack\u306eAPI token\u3092`SLACK_API_TOKEN`\u3068\u3057\u3066\u767b\u9332\u3057\u3001`process.env.SLACK_API_TOKEN`\u3067\u53c2\u7167\u3057\u307e\u3059\u3002\n\n```javascript\nvar https = require('https');\nvar qs = require('querystring');\n\nexports.handler = (event, context, callback) => {\n    \n    var query = qs.stringify({\n        'token': process.env.SLACK_API_TOKEN,\n        'channel': \"CHANNEL_NAME\",\n        'text': \"@horie \u9000\u52e4\u3057\u307e\u3057\u3087\u3046\uff01\\nhttps://hoge.html\",\n        'mrkdwn': true,\n        'link_names': 1\n      });\n    \n    var options = {\n        host: 'slack.com',\n        port: '443',\n        path: '/api/chat.postMessage?' + query,\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json; charset=utf-8\"'\n        }\n    };\n    \n    var req = https.request(options, function(res) {\n        res.setEncoding('utf8');\n        res.on('data', function(res) {\n            callback(null, res);\n        });\n    });\n    req.on('error', (e) => {\n        callback(null, 'error' + e.message);\n    });\n    req.write('');\n    req.end();\n};\n```\n\nTest\u3067\u95a2\u6570\u3092\u5b9f\u884c\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306bSlack\u306b\u901a\u77e5\u3055\u308c\u307e\u3059\u3002\n\n![lambda_5.png](https://qiita-image-store.s3.amazonaws.com/0/43438/053ee98d-3640-4dea-17b5-8cad26e00fce.png \"lambda_5.png\")\n\n\u554f\u984c\u304c\u7121\u3051\u308c\u3070CloudWatch Events - Schedule\u3092Enable\u306b\u3057\u3066\u5b8c\u4e86\u3067\u3059\u3002\n\n![lambda_6.png](https://qiita-image-store.s3.amazonaws.com/0/43438/1e4351e8-9708-4003-ef07-543b16765ea6.png \"lambda_6.png\")\n\n# \u307e\u3068\u3081\n- AWS Lambda\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u3067\u30b5\u30fc\u30d0\u30fc\u30ec\u30b9\u3067\u9000\u52e4\u6642\u523b\u306e\u901a\u77e5\u3068\u6253\u523b\u3092\u4fc3\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n- \u6253\u523b\u3092\u5fd8\u308c\u306a\u3044\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\uff01\n\n# \u53c2\u8003\n- https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/with-scheduledevents-example.html\n- http://dev.classmethod.jp/cloud/aws/aws-lambda-env-variables/\n", "tags": ["lambda", "Slack", "AWS", "bot"]}