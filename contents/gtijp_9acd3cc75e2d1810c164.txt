{"context": " More than 1 year has passed since last update.\u524d\u56de\u3001\u300cWordPress\u30d7\u30e9\u30b0\u30a4\u30f3Throws SPAM Away\u3092\u4f7f\u3063\u3066MW WP Form\u306bNG\u30ef\u30fc\u30c9\u6307\u5b9a\u306a\u3069\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u8ffd\u52a0\u3059\u308b\u65b9\u6cd5\u300d\u3068\u3044\u3046\u30bf\u30a4\u30c8\u30eb\u3067MW WP Form\u306b\u300cNG\u30ef\u30fc\u30c9\u300d\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u8ffd\u52a0\u3059\u308b\u65b9\u6cd5\u3092\u66f8\u304d\u307e\u3057\u305f\u3002\nhttp://qiita.com/gtijp/items/65bf0af75140fe2774a1\n\u4eca\u56de\u306f\u3001\u305d\u3082\u305d\u3082\u57fa\u672c\u6a5f\u80fd\u3068\u3057\u3066\u300cThrows SPAM Away\u300d\u306e\u8a2d\u5b9a\u3092\u5229\u7528\u3057\u305f\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\u304c\u51fa\u6765\u3066\u3057\u307e\u3046\u3053\u3068\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\nWordPress\u30d7\u30e9\u30b0\u30a4\u30f3 MW WP Form\nhttps://wordpress.org/plugins/mw-wp-form/\n\u4eca\u306e\u79c1\u306b\u306f\u306a\u304f\u3066\u306f\u306a\u3089\u306a\u3044WordPress\u7528\u30e1\u30fc\u30eb\u30d5\u30a9\u30fc\u30e0\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3059\u3002\n\nWordPress\u30d7\u30e9\u30b0\u30a4\u30f3 Throws SPAM Away\nhttps://wordpress.org/plugins/throws-spam-away/\n\nThrows SPAM Away\u304c\u6709\u52b9\u5316\u3055\u308c\u3066\u3042\u308c\u3070\u305d\u306e\u8a2d\u5b9a\u3067\u52d5\u304d\u307e\u3059\u30d1\u30bf\u30fc\u30f3\nThrows SPAM Away\u306e\u30d0\u30fc\u30b8\u30e7\u30f32.7.1\u304b\u3089\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u8a2d\u5b9a\u3069\u304a\u308a\u306b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u52b9\u304b\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u305d\u306e\u3088\u3046\u306b\u6319\u52d5\u3055\u305b\u308b\u306b\u306f\u3069\u3046\u3059\u308c\u3070\u3088\u3044\u304b\u30fb\u30fb\u30fb\u4e0b\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3092 \u5229\u7528\u30c6\u30fc\u30de\u306e functions.php\u306b\u8ffd\u8a18\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u30b3\u30fc\u30c9\u5185\u306e\u300cmwform_validation_mw-wp-form-xxx\u300d\u306exxx\u306b\u306f\u5229\u7528\u3059\u308bMW WP Form\u3067\u4f5c\u6210\u3057\u305f\u30d5\u30a9\u30fc\u30e0ID\u3092\u5165\u308c\u3066\u304f\u3060\u3055\u3044\u3002\n\u307e\u305f\u3001\u300c\u4e0d\u6b63IP\u300d\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u306b\u3064\u3044\u3066\u306f\u30b3\u30fc\u30c9\u306e\u4e0b\u8a18\u90e8\u5206\u3092\u9069\u5b9c\u5909\u66f4\u3059\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u203b\u4e0d\u8981\u306a\u5834\u5408\u306f\u3053\u306e\u5206\u5c90\u81ea\u4f53\u3092\u524a\u9664\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n            if ( ! $chk_ip ) {\n                // \u4e0d\u6b63IP\u306f\u305d\u306e\u307e\u307e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n                header( 'Location: http://www.yahoo.co.jp' );\n                die;\n            }\n\n\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306e\u307e\u307e\u3067\u3059\u3068\u30d6\u30e9\u30c3\u30af\u30ea\u30b9\u30c8\u306b\u5165\u3063\u3066\u3044\u308bIP\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u3092Yahoo!\u3055\u3093\u306b\u98db\u3070\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u30fb\u30fb\u30fb\u3002Yahoo!\u3055\u3093\u3054\u3081\u3093\u306a\u3055\u3044\u3002\n\u8ffd\u8a18\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306f\u3053\u3061\u3089\u3067\u3059\u3002\n\u30d5\u30a9\u30fc\u30e0\u306e\u300ccontent\u300d\u3068\u3044\u3046\u540d\u524d\u306e\u9805\u76ee\u306b\u5bfe\u3057\u3066\u30c1\u30a7\u30c3\u30af\u3092\u304b\u3051\u308b\u30b3\u30fc\u30c9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u30b3\u30fc\u30c9\u4e2d\u306e\u300cmwform_validation_mw-wp-form-xxx\u300d\u306exxx\u306b\u306f MW WP Form\u3067\u4f5c\u6210\u3057\u305f\u30d5\u30a9\u30fc\u30e0\u306eID\u3092\u5165\u308c\u3066\u304f\u3060\u3055\u3044\u3002\n\nfunctions.php\u306b\u8ffd\u8a18\n/**\n * my_validation_mw\n * @param object $Validation\n * @param array $data\n * $Validation::set_rule\u306e\u5f15\u6570\u306f name\u5c5e\u6027\u5024, \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u540d, \u30aa\u30d7\u30b7\u30e7\u30f3\n */\nfunction my_validation_mw( $Validation, $data ) {\n        // content \u3068\u3044\u3046name\u3092\u3064\u3051\u305f\u30a8\u30ec\u30e1\u30f3\u30c8\u306b\u5bfe\u3057\u3066\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u304b\u3051\u308b\u3088\uff01\u3063\u3066\u3044\u3046\u610f\u5473\u3067\u3059\u3002\n    $Validation->set_rule( 'content', 'throws_spam_away' );\n\n    return $Validation;\n}\nadd_filter( 'mwform_validation_mw-wp-form-xxx', 'my_validation_mw', 10, 2 );\n\n/**\n * my_validation_rule\n * @param array $validation_rules \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u914d\u5217\n * @param string $key \u30d5\u30a9\u30fc\u30e0\u8b58\u5225\u5b50\n */\nfunction my_validation_rule( $validation_rules, $key ) {\n\n    // \u8ffd\u52a0\u3059\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f MW_Validation_Rule \u30af\u30e9\u30b9\u3092\u7d99\u627f\u3057\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n    $validation_rules[throws_spam_away'] = new MW_WP_Form_Validation_Rule_Throws_Spam_Away( $key );\n    return $validation_rules;\n}\nadd_filter( 'mwform_validation_rules', 'my_validation_rule', 10, 2 );\n\nclass MW_WP_Form_Validation_Rule_Throws_Spam_Away extends MW_WP_Form_Abstract_Validation_Rule {\n\n    /**\n     * \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u540d\u3092\u6307\u5b9a\n     * @var string\n     */\n    protected $name = 'throws_spam_away';\n\n    /**\n     * \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30c1\u30a7\u30c3\u30af\n     *\n     * @param string $key name\u5c5e\u6027\n     * @param array $option\n     * @return string \u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\n     */\n    public function rule( $key, array $options = array() ) {\n        include_once( WP_PLUGIN_DIR.'/throws-spam-away/throws_spam_away.class.php');\n\n        $throwsSpamAway = new ThrowsSpamAway();\n\n                // \u30c1\u30a7\u30c3\u30af\u7528\u306e\u6761\u4ef6\u3092\u7a7a\u306b\u3059\u308b\u3068Throws SPAM Away\u306e\u8a2d\u5b9a\u3067\u52d5\u304f\n        $args = array();\n        $value = $this->Data->get( $key );\n        $chk_result = $throwsSpamAway->validate_comment( \"\", $value, $args);\n        if ( !MWF_Functions::is_empty( $value ) ) {\n\n            // IP\u30a2\u30c9\u30ec\u30b9\u30c1\u30a7\u30c3\u30af\n            $ip = $_SERVER['REMOTE_ADDR'];\n            $chk_ip = $throwsSpamAway->ip_check( $ip );\n            if ( ! $chk_ip ) {\n                // \u4e0d\u6b63IP\u306f\u305d\u306e\u307e\u307e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n                header( 'Location: http://www.yahoo.co.jp' );\n                die;\n            }\n\n\n            if ( !$chk_result ) {\n                // \u30a8\u30e9\u30fc\u30bf\u30a4\u30d7\u3092\u53d6\u5f97\n                $error_type = $throwsSpamAway->error_type;\n                $message_str = \"\";\n                /** \n                    \u30a8\u30e9\u30fc\u7a2e\u985e\n                    'must_word'         \u5fc5\u9808\u30ad\u30fc\u30ef\u30fc\u30c9\n                    'ng_word'           NG\u30ef\u30fc\u30c9\n                    'url_count_over'    \u30ea\u30f3\u30af\u6570\u30aa\u30fc\u30d0\u30fc\n                    'not_japanese'      \u65e5\u672c\u8a9e\u4e0d\u8db3\n                */\n                switch ( $error_type ) {\n                    case \"must_word\":\n                        $message_str = \"\u5fc5\u9808\u30ad\u30fc\u30ef\u30fc\u30c9\u304c\u5165\u3063\u3066\u3044\u306a\u3044\u305f\u3081\u9001\u4fe1\u51fa\u6765\u307e\u305b\u3093 \";\n                        break;\n                    case \"ng_word\":\n                        $message_str = \"NG\u30ef\u30fc\u30c9\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u305f\u3081\u9001\u4fe1\u3067\u304d\u307e\u305b\u3093 \";\n                        break;\n                    case \"url_count_over\":\n                        $message_str = \"\u30ea\u30f3\u30af\u304c\u591a\u3059\u304e\u307e\u3059 \";\n                        break;\n                    case \"not_japanese\":\n                        $message_str = \"\u65e5\u672c\u8a9e\u304c\u542b\u307e\u308c\u306a\u3044\u304b\u65e5\u672c\u8a9e\u6587\u5b57\u6570\u304c\u5c11\u306a\u3044\u305f\u3081\u9001\u4fe1\u51fa\u6765\u307e\u305b\u3093 \";\n                        break;\n                    default:\n                        $message_str = \"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f:\".$error_type;\n                }\n                $defaults = array(\n                    'message' => $message_str\n                );\n            }\n            $options = array_merge( $defaults, $options );\n            return $options['message'];\n        }\n    }\n\n    /**\n     * \u8a2d\u5b9a\u30d1\u30cd\u30eb\u306b\u8ffd\u52a0\n     *\n     * @param numeric $key \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u30bb\u30c3\u30c8\u306e\u8b58\u5225\u756a\u53f7\n     * @param array $value \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u30bb\u30c3\u30c8\u306e\u5185\u5bb9\n     */\n    public function admin( $key, $value ) {\n    }\n}\n\n\n\u8ffd\u52a0\u5f8c\u306fThrows SPAM Away\u306e\u8a2d\u5b9a\u3067\u4e0b\u8a18\u306e\u30c1\u30a7\u30c3\u30af\u304c\u52b9\u304d\u307e\u3059\u3002\n\u30fb\u65e5\u672c\u8a9e\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u30a8\u30e9\u30fc\n\u30fb\u65e5\u672c\u8a9e\u306e\u6700\u4f4e\u6587\u5b57\u6570\uff08\u4e0a\u8a18\u304c\u6709\u52b9\u306e\u5834\u5408\uff09\n\u30fb\u30ea\u30f3\u30af\u3089\u3057\u304dURL\u6587\u5b57\u5217\u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u30a8\u30e9\u30fc\n\u30fb\u30ea\u30f3\u30af\u306e\u8a31\u5bb9\u6570\uff08\u4e0a\u8a18\u304c\u6709\u52b9\u306e\u5834\u5408\uff09\n\u30fbNG\u30ef\u30fc\u30c9\u306e\u8a2d\u5b9a\uff08\u30ab\u30f3\u30de\u533a\u5207\u308a\uff09\n\u30fb\u5fc5\u9808\u30ef\u30fc\u30c9\u306e\u8a2d\u5b9a\uff08\u30ab\u30f3\u30de\u533a\u5207\u308a\uff09\n\nThrows SPAM Away\u306e\u753b\u9762\u4e0a\u306f\u4e0b\u306e\u3088\u3046\u306a\u7b87\u6240\u306b\u306a\u308a\u307e\u3059\n\n\u203b\u65e5\u672c\u8a9e\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u30a8\u30e9\u30fc\u306b\u3059\u308b\u304b\u3000\uff06\u3000\u65e5\u672c\u8a9e\u6587\u5b57\u306e\u542b\u6709\u6570\uff08\u6700\u4f4e\u6587\u5b57\u6570\uff09\u8a2d\u5b9a\n\n\u203bURL\u3089\u3057\u304d\u6587\u5b57\u5217\u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u30a8\u30e9\u30fc\u306b\u3059\u308b\u304b \uff06 \u8a31\u5bb9\u6570\u8a2d\u5b9a\n\n\u203bNG\u30ef\u30fc\u30c9\u306e\u8a2d\u5b9a\n\n\u203b\u5fc5\u9808\u30ad\u30fc\u30ef\u30fc\u30c9\u306e\u8a2d\u5b9a\nThrows SPAM Away\u306e\u65b9\u3067\u306f\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3082\u8a2d\u5b9a\u51fa\u6765\u307e\u3059\u304c\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u4e0a\u306f\u305d\u306e\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5229\u7528\u3057\u307e\u305b\u3093\u3002\n\u4e0b\u8a18\u306e\u5404\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u4f7f\u3046\u3053\u3068\u3067\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3082UI\u304b\u3089\u5165\u529b\u3067\u304d\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n$err_not_japanese_msg = get_option( 'tsa_error_message', \"\u65e5\u672c\u8a9e\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u3044\u306a\u3044\u304b\u5c11\u306a\u3044\u3067\u3059\" );\n$err_must_word_msg = get_option( 'tsa_must_key_error_message', \"\u5fc5\u9808\u30ad\u30fc\u30ef\u30fc\u30c9\u304c\u5165\u3063\u3066\u3044\u307e\u305b\u3093\" );\n$err_ng_word_msg = get_option( 'tsa_ng_key_error_message',\"NG\u30ef\u30fc\u30c9\u306f\u5165\u3063\u3066\u3044\u307e\u3059\" );\n$err_url_count_over_msg = get_option( 'tsa_url_count_over_error_message', \"URL\u6587\u5b57\u5217\u304c\u3044\u3063\u3071\u3044\u3042\u308a\u307e\u3059\" );\n\n\u203bget_option\u306e\u7b2c\uff12\u5f15\u6570\u306f\u672a\u6307\u5b9a\u6642\u306b\u4ee3\u5165\u3055\u308c\u308b\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3068\u306a\u308a\u307e\u3059\u3002\n\u305f\u3060\u3057\u3001\u30b3\u30e1\u30f3\u30c8\u30b9\u30d1\u30e0\u5bfe\u7b56\u7528\u306b\u3082\u540c\u69d8\u306b\u9069\u7528\u3055\u308c\u3066\u3057\u307e\u3046\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u5b9f\u969b\u306b\u306f\u300c\u30b9\u30d1\u30e0\u30b3\u30e1\u30f3\u30c8\u300d\u306e\u30a8\u30e9\u30fc\u8868\u793a\u3092\u3057\u306a\u3044\uff08\u5143\u306e\u8a18\u4e8b\u306b\u3082\u3069\u3063\u3066\u304f\u308b\u6642\u9593\uff1d\uff10\uff09\u5834\u5408\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u308b\u3053\u3068\u306f\u306a\u304f\u95a2\u4fc2\u306a\u3044\u3067\u3059\u3002\n\n\u6700\u5f8c\u306b\u300cThrows SPAM Away\u300d\u306e\u8a2d\u5b9a\u753b\u9762\u3092\u5229\u7528\u3057\u306a\u3044\u5834\u5408\u3067\u306e\u5168\u90e8\u30c1\u30a7\u30c3\u30af\u30d1\u30bf\u30fc\u30f3\u3082\u63b2\u8f09\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u300c\u5fc5\u9808\u30ad\u30fc\u30ef\u30fc\u30c9\u300d\u3063\u3066\u3044\u3046\u7279\u6b8a\u306a\u30c1\u30a7\u30c3\u30af\u304c\u5165\u308b\u3068\u3081\u3093\u3069\u304f\u3055\u3044\u306a\u30fb\u30fb\u30fb\u3063\u3066\u500b\u4eba\u7684\u306b\u306f\u601d\u3044\u307e\u3059\u3002\n\u305f\u3060\u3001\u4f8b\u3048\u3070\u300c\u6295\u7a3f\u7528\u30b3\u30fc\u30c9\u300d\u307f\u305f\u3044\u306a\u3082\u306e\u3092\u8a2d\u5b9a\u3057\u3066\u3042\u3063\u3066\u305d\u308c\u3092\u5165\u308c\u3066\u304f\u308c\u306a\u304d\u3083\u30d5\u30a9\u30fc\u30e0\u9001\u4fe1\u3067\u304d\u306a\u3044\u5834\u5408\u306f\u3044\u3044\u304b\u306a\u30fb\u30fb\u30fb\u3063\u3066\u601d\u3044\u307e\u3059\u3002\n\u300c\u81ea\u7531\u6b04\u300d\u306e\u3088\u3046\u306a\u9805\u76ee\u306b\u306f\u300c\u65e5\u672c\u8a9e\u300d\u300cURL\u5236\u9650\u300d\u300cNG\u30ef\u30fc\u30c9\u300d\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u3066\n\u300c\u30d1\u30b9\u30b3\u30fc\u30c9\u300d\u307f\u305f\u3044\u306a\u9805\u76ee\u306b\u306f\u300c\u5fc5\u9808\u30ad\u30fc\u30ef\u30fc\u30c9\u300d\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u308b\u3088\u3046\u306a\u6d3b\u7528\u304c\u671f\u5f85\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u5168\u90e8\u4e57\u305b\u30d1\u30bf\u30fc\u30f3\n\u30d5\u30a9\u30fc\u30e0\u306e\u300ccontent\u300d\u3068\u3044\u3046\u540d\u524d\u306e\u9805\u76ee\u306b\u5bfe\u3057\u3066\u30c1\u30a7\u30c3\u30af\u3092\u304b\u3051\u308b\u30b3\u30fc\u30c9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u30b3\u30fc\u30c9\u4e2d\u306e\u300cmwform_validation_mw-wp-form-xxx\u300d\u306exxx\u306b\u306f MW WP Form\u3067\u4f5c\u6210\u3057\u305f\u30d5\u30a9\u30fc\u30e0\u306eID\u3092\u5165\u308c\u3066\u304f\u3060\u3055\u3044\u3002\n\nfunctions.php\n/**\n * my_validation_mw\n * @param object $Validation\n * @param array $data\n * $Validation::set_rule\u306e\u5f15\u6570\u306f name\u5c5e\u6027\u5024, \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u540d, \u30aa\u30d7\u30b7\u30e7\u30f3\n */\nfunction my_validation_mw( $Validation, $data ) {\n\n    $Validation->set_rule( 'content', 'throws_spam_away' );\n\n    return $Validation;\n}\nadd_filter( 'mwform_validation_mw-wp-form-xxx', 'my_validation_mw', 10, 2 );\n\n/**\n * my_validation_rule\n * @param array $validation_rules \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u914d\u5217\n * @param string $key \u30d5\u30a9\u30fc\u30e0\u8b58\u5225\u5b50\n */\nfunction my_validation_rule( $validation_rules, $key ) {\n\n    // \u8ffd\u52a0\u3059\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f MW_Validation_Rule \u30af\u30e9\u30b9\u3092\u7d99\u627f\u3057\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n    $validation_rules['throws_spam_away'] = new MW_WP_Form_Validation_Rule_Throws_Spam_Away( $key );\n    return $validation_rules;\n}\nadd_filter( 'mwform_validation_rules', 'my_validation_rule', 10, 2 );\n\nclass MW_WP_Form_Validation_Rule_Throws_Spam_Away extends MW_WP_Form_Abstract_Validation_Rule {\n\n    /**\n     * \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u540d\u3092\u6307\u5b9a\n     * @var string\n     */\n    protected $name = 'throws_spam_away';\n\n    /**\n     * \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30c1\u30a7\u30c3\u30af\n     *\n     * @param string $key name\u5c5e\u6027\n     * @param array $option\n     * @return string \u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\n     */\n    public function rule( $key, array $options = array() ) {\n        include_once( WP_PLUGIN_DIR.'/throws-spam-away/throws_spam_away.class.php');\n\n        $throwsSpamAway = new ThrowsSpamAway();\n\n        $args = array(\n              'post_id' => NULL,\n              'tsa_on_flg' => 1,    // \u65e5\u672c\u8a9e\u5229\u7528\u3057\u3066\u3044\u306a\u3044\u3068\u3060\u3081\uff01\n              'tsa_japanese_string_min_count' => 5, // \u65e5\u672c\u8a9e\u6587\u5b57\u304c\uff15\u6587\u5b57\u4ee5\u4e0a\u306a\u3051\u308c\u3070\u30a8\u30e9\u30fc\n              'tsa_ng_keywords' =>  \"\u79c1\u306f\u305f\u308f\u3057,\u99ac\u9e7f\",   // NG\u30ad\u30fc\u30ef\u30fc\u30c9\u6307\u5b9a\u306e\u307f\u884c\u3046\n              'tsa_must_keywords'   =>  \"\u30de\u30b9\u30c8\",    // \u300c\u30de\u30b9\u30c8\u300d\u3068\u3044\u3046\u6587\u5b57\u304c\u5165\u3063\u3066\u3044\u306a\u3051\u308c\u3070\u30a8\u30e9\u30fc\n              'tsa_url_count_check' =>  1,          // \u30ea\u30f3\u30af\u304c\u3042\u3063\u305f\u3089\u30c1\u30a7\u30c3\u30af\u3059\u308b\n              'tsa_ok_url_count'    =>  2           // \u30ea\u30f3\u30af\u304c\uff12\u500b\u3042\u3063\u305f\u3089\u30a8\u30e9\u30fc\n            );\n        $value = $this->Data->get( $key );\n        $chk_result = $throwsSpamAway->validate_comment( \"\", $value, $args);\n        if ( !MWF_Functions::is_empty( $value ) ) {\n\n            // IP\u30a2\u30c9\u30ec\u30b9\u30c1\u30a7\u30c3\u30af\n            $ip = $_SERVER['REMOTE_ADDR'];\n            $chk_ip = $throwsSpamAway->ip_check( $ip );\n            if ( ! $chk_ip ) {\n                // \u4e0d\u6b63IP\u306f\u305d\u306e\u307e\u307e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n                header( 'Location: http://www.yahoo.co.jp' );\n                die;\n            }\n\n\n            if ( !$chk_result ) {\n                // \u30a8\u30e9\u30fc\u30bf\u30a4\u30d7\u3092\u53d6\u5f97\n                $error_type = $throwsSpamAway->error_type;\n                $message_str = \"\";\n                /** \n                    \u30a8\u30e9\u30fc\u7a2e\u985e\n                    'must_word'         \u5fc5\u9808\u30ad\u30fc\u30ef\u30fc\u30c9\n                    'ng_word'           NG\u30ad\u30fc\u30ef\u30fc\u30c9\n                    'url_count_over'    \u30ea\u30f3\u30af\u6570\u30aa\u30fc\u30d0\u30fc\n                    'not_japanese'      \u65e5\u672c\u8a9e\u4e0d\u8db3\n                */\n                switch ( $error_type ) {\n                    case \"must_word\":\n                        $message_str = \"\u5fc5\u9808\u30ad\u30fc\u30ef\u30fc\u30c9\u304c\u5165\u3063\u3066\u3044\u306a\u3044\u305f\u3081\u9001\u4fe1\u51fa\u6765\u307e\u305b\u3093 \";\n                        break;\n                    case \"ng_word\":\n                        $message_str = \"NG\u30ad\u30fc\u30ef\u30fc\u30c9\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u305f\u3081\u9001\u4fe1\u3067\u304d\u307e\u305b\u3093 \";\n                        break;\n                    case \"url_count_over\":\n                        $message_str = \"\u30ea\u30f3\u30af\u304c\u591a\u3059\u304e\u307e\u3059 \";\n                        break;\n                    case \"not_japanese\":\n                        $message_str = \"\u65e5\u672c\u8a9e\u304c\u542b\u307e\u308c\u306a\u3044\u304b\u65e5\u672c\u8a9e\u6587\u5b57\u6570\u304c\u5c11\u306a\u3044\u305f\u3081\u9001\u4fe1\u51fa\u6765\u307e\u305b\u3093 \";\n                        break;\n                    default:\n                        $message_str = \"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f:\".$error_type;\n                }\n                $defaults = array(\n                    'message' => $message_str\n                );\n            }\n            $options = array_merge( $defaults, $options );\n            return $options['message'];\n        }\n    }\n\n    /**\n     * \u8a2d\u5b9a\u30d1\u30cd\u30eb\u306b\u8ffd\u52a0\n     *\n     * @param numeric $key \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u30bb\u30c3\u30c8\u306e\u8b58\u5225\u756a\u53f7\n     * @param array $value \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u30bb\u30c3\u30c8\u306e\u5185\u5bb9\n     */\n    public function admin( $key, $value ) {\n    }\n}\n\n\n\u8907\u6570\u306e\u9805\u76ee\u306b\u30c1\u30a7\u30c3\u30af\u3092\u304b\u3051\u308b\u5834\u5408\u306f\nset_rule \u3092\u5897\u3084\u3057\n\u9805\u76ee\u30c1\u30a7\u30c3\u30af\u306e\u5185\u5bb9\u3092\u305d\u308c\u305e\u308c\u5909\u3048\u305f\u3044\u5834\u5408\u306f\nmy_validation_rule \u306e $validation_rules \u306e\u30d0\u30ea\u30a8\u30fc\u30b7\u30e7\u30f3\u3092\u5897\u3084\u3057\n\u30c1\u30a7\u30c3\u30af\u30af\u30e9\u30b9\u3092\u5897\u3084\u3057\u3066\u5bfe\u5fdc\u3059\u308c\u3070\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u524d\u56de\u3001\u300cWordPress\u30d7\u30e9\u30b0\u30a4\u30f3Throws SPAM Away\u3092\u4f7f\u3063\u3066MW WP Form\u306bNG\u30ef\u30fc\u30c9\u6307\u5b9a\u306a\u3069\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u8ffd\u52a0\u3059\u308b\u65b9\u6cd5\u300d\u3068\u3044\u3046\u30bf\u30a4\u30c8\u30eb\u3067MW WP Form\u306b\u300cNG\u30ef\u30fc\u30c9\u300d\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u8ffd\u52a0\u3059\u308b\u65b9\u6cd5\u3092\u66f8\u304d\u307e\u3057\u305f\u3002\nhttp://qiita.com/gtijp/items/65bf0af75140fe2774a1\n\n\u4eca\u56de\u306f\u3001\u305d\u3082\u305d\u3082\u57fa\u672c\u6a5f\u80fd\u3068\u3057\u3066\u300cThrows SPAM Away\u300d\u306e\u8a2d\u5b9a\u3092\u5229\u7528\u3057\u305f\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\u304c\u51fa\u6765\u3066\u3057\u307e\u3046\u3053\u3068\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n#WordPress\u30d7\u30e9\u30b0\u30a4\u30f3 MW WP Form\nhttps://wordpress.org/plugins/mw-wp-form/\n\u4eca\u306e\u79c1\u306b\u306f\u306a\u304f\u3066\u306f\u306a\u3089\u306a\u3044WordPress\u7528\u30e1\u30fc\u30eb\u30d5\u30a9\u30fc\u30e0\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3059\u3002\n\n#WordPress\u30d7\u30e9\u30b0\u30a4\u30f3 Throws SPAM Away\nhttps://wordpress.org/plugins/throws-spam-away/\n\n\n\n##Throws SPAM Away\u304c\u6709\u52b9\u5316\u3055\u308c\u3066\u3042\u308c\u3070\u305d\u306e\u8a2d\u5b9a\u3067\u52d5\u304d\u307e\u3059\u30d1\u30bf\u30fc\u30f3\nThrows SPAM Away\u306e\u30d0\u30fc\u30b8\u30e7\u30f32.7.1\u304b\u3089\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u8a2d\u5b9a\u3069\u304a\u308a\u306b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u52b9\u304b\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\u305d\u306e\u3088\u3046\u306b\u6319\u52d5\u3055\u305b\u308b\u306b\u306f\u3069\u3046\u3059\u308c\u3070\u3088\u3044\u304b\u30fb\u30fb\u30fb\u4e0b\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3092 \u5229\u7528\u30c6\u30fc\u30de\u306e functions.php\u306b\u8ffd\u8a18\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u30b3\u30fc\u30c9\u5185\u306e\u300cmwform_validation_mw-wp-form-xxx\u300d\u306exxx\u306b\u306f\u5229\u7528\u3059\u308bMW WP Form\u3067\u4f5c\u6210\u3057\u305f\u30d5\u30a9\u30fc\u30e0ID\u3092\u5165\u308c\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u307e\u305f\u3001\u300c\u4e0d\u6b63IP\u300d\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u306b\u3064\u3044\u3066\u306f\u30b3\u30fc\u30c9\u306e\u4e0b\u8a18\u90e8\u5206\u3092\u9069\u5b9c\u5909\u66f4\u3059\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u203b\u4e0d\u8981\u306a\u5834\u5408\u306f\u3053\u306e\u5206\u5c90\u81ea\u4f53\u3092\u524a\u9664\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\n\t\t\tif ( ! $chk_ip ) {\n\t\t\t\t// \u4e0d\u6b63IP\u306f\u305d\u306e\u307e\u307e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n\t\t\t\theader( 'Location: http://www.yahoo.co.jp' );\n\t\t\t\tdie;\n\t\t\t}\n\n```\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306e\u307e\u307e\u3067\u3059\u3068\u30d6\u30e9\u30c3\u30af\u30ea\u30b9\u30c8\u306b\u5165\u3063\u3066\u3044\u308bIP\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u3092Yahoo!\u3055\u3093\u306b\u98db\u3070\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u30fb\u30fb\u30fb\u3002Yahoo!\u3055\u3093\u3054\u3081\u3093\u306a\u3055\u3044\u3002\n\n\u8ffd\u8a18\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306f\u3053\u3061\u3089\u3067\u3059\u3002\n\n\u30d5\u30a9\u30fc\u30e0\u306e\u300ccontent\u300d\u3068\u3044\u3046\u540d\u524d\u306e\u9805\u76ee\u306b\u5bfe\u3057\u3066\u30c1\u30a7\u30c3\u30af\u3092\u304b\u3051\u308b\u30b3\u30fc\u30c9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u30b3\u30fc\u30c9\u4e2d\u306e\u300cmwform_validation_mw-wp-form-xxx\u300d\u306exxx\u306b\u306f MW WP Form\u3067\u4f5c\u6210\u3057\u305f\u30d5\u30a9\u30fc\u30e0\u306eID\u3092\u5165\u308c\u3066\u304f\u3060\u3055\u3044\u3002\n\n```functions.php\u306b\u8ffd\u8a18\n/**\n * my_validation_mw\n * @param object $Validation\n * @param array $data\n * $Validation::set_rule\u306e\u5f15\u6570\u306f name\u5c5e\u6027\u5024, \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u540d, \u30aa\u30d7\u30b7\u30e7\u30f3\n */\nfunction my_validation_mw( $Validation, $data ) {\n        // content \u3068\u3044\u3046name\u3092\u3064\u3051\u305f\u30a8\u30ec\u30e1\u30f3\u30c8\u306b\u5bfe\u3057\u3066\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u304b\u3051\u308b\u3088\uff01\u3063\u3066\u3044\u3046\u610f\u5473\u3067\u3059\u3002\n\t$Validation->set_rule( 'content', 'throws_spam_away' );\n\n\treturn $Validation;\n}\nadd_filter( 'mwform_validation_mw-wp-form-xxx', 'my_validation_mw', 10, 2 );\n\n/**\n * my_validation_rule\n * @param array $validation_rules \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u914d\u5217\n * @param string $key \u30d5\u30a9\u30fc\u30e0\u8b58\u5225\u5b50\n */\nfunction my_validation_rule( $validation_rules, $key ) {\n\n    // \u8ffd\u52a0\u3059\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f MW_Validation_Rule \u30af\u30e9\u30b9\u3092\u7d99\u627f\u3057\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n    $validation_rules[throws_spam_away'] = new MW_WP_Form_Validation_Rule_Throws_Spam_Away( $key );\n    return $validation_rules;\n}\nadd_filter( 'mwform_validation_rules', 'my_validation_rule', 10, 2 );\n\nclass MW_WP_Form_Validation_Rule_Throws_Spam_Away extends MW_WP_Form_Abstract_Validation_Rule {\n\n\t/**\n\t * \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u540d\u3092\u6307\u5b9a\n\t * @var string\n\t */\n\tprotected $name = 'throws_spam_away';\n\n\t/**\n\t * \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30c1\u30a7\u30c3\u30af\n\t *\n\t * @param string $key name\u5c5e\u6027\n\t * @param array $option\n\t * @return string \u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\n\t */\n\tpublic function rule( $key, array $options = array() ) {\n\t\tinclude_once( WP_PLUGIN_DIR.'/throws-spam-away/throws_spam_away.class.php');\n\n\t\t$throwsSpamAway = new ThrowsSpamAway();\n\n                // \u30c1\u30a7\u30c3\u30af\u7528\u306e\u6761\u4ef6\u3092\u7a7a\u306b\u3059\u308b\u3068Throws SPAM Away\u306e\u8a2d\u5b9a\u3067\u52d5\u304f\n\t\t$args = array();\n\t\t$value = $this->Data->get( $key );\n\t\t$chk_result = $throwsSpamAway->validate_comment( \"\", $value, $args);\n\t\tif ( !MWF_Functions::is_empty( $value ) ) {\n\n\t\t\t// IP\u30a2\u30c9\u30ec\u30b9\u30c1\u30a7\u30c3\u30af\n\t\t\t$ip = $_SERVER['REMOTE_ADDR'];\n\t\t\t$chk_ip = $throwsSpamAway->ip_check( $ip );\n\t\t\tif ( ! $chk_ip ) {\n\t\t\t\t// \u4e0d\u6b63IP\u306f\u305d\u306e\u307e\u307e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n\t\t\t\theader( 'Location: http://www.yahoo.co.jp' );\n\t\t\t\tdie;\n\t\t\t}\n\n\n\t\t\tif ( !$chk_result ) {\n\t\t\t\t// \u30a8\u30e9\u30fc\u30bf\u30a4\u30d7\u3092\u53d6\u5f97\n\t\t\t\t$error_type = $throwsSpamAway->error_type;\n\t\t\t\t$message_str = \"\";\n\t\t\t\t/** \n\t\t\t\t\t\u30a8\u30e9\u30fc\u7a2e\u985e\n\t\t\t\t\t'must_word'\t\t\t\u5fc5\u9808\u30ad\u30fc\u30ef\u30fc\u30c9\n\t\t\t\t\t'ng_word'\t\t\tNG\u30ef\u30fc\u30c9\n\t\t\t\t\t'url_count_over'\t\u30ea\u30f3\u30af\u6570\u30aa\u30fc\u30d0\u30fc\n\t\t\t\t\t'not_japanese'\t\t\u65e5\u672c\u8a9e\u4e0d\u8db3\n\t\t\t\t*/\n\t\t\t\tswitch ( $error_type ) {\n\t\t\t\t\tcase \"must_word\":\n\t\t\t\t\t\t$message_str = \"\u5fc5\u9808\u30ad\u30fc\u30ef\u30fc\u30c9\u304c\u5165\u3063\u3066\u3044\u306a\u3044\u305f\u3081\u9001\u4fe1\u51fa\u6765\u307e\u305b\u3093 \";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"ng_word\":\n\t\t\t\t\t\t$message_str = \"NG\u30ef\u30fc\u30c9\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u305f\u3081\u9001\u4fe1\u3067\u304d\u307e\u305b\u3093 \";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"url_count_over\":\n\t\t\t\t\t\t$message_str = \"\u30ea\u30f3\u30af\u304c\u591a\u3059\u304e\u307e\u3059 \";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"not_japanese\":\n\t\t\t\t\t\t$message_str = \"\u65e5\u672c\u8a9e\u304c\u542b\u307e\u308c\u306a\u3044\u304b\u65e5\u672c\u8a9e\u6587\u5b57\u6570\u304c\u5c11\u306a\u3044\u305f\u3081\u9001\u4fe1\u51fa\u6765\u307e\u305b\u3093 \";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t$message_str = \"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f:\".$error_type;\n\t\t\t\t}\n\t\t\t\t$defaults = array(\n\t\t\t\t\t'message' => $message_str\n\t\t\t\t);\n\t\t\t}\n\t\t\t$options = array_merge( $defaults, $options );\n\t\t\treturn $options['message'];\n\t\t}\n\t}\n\n\t/**\n\t * \u8a2d\u5b9a\u30d1\u30cd\u30eb\u306b\u8ffd\u52a0\n\t *\n\t * @param numeric $key \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u30bb\u30c3\u30c8\u306e\u8b58\u5225\u756a\u53f7\n\t * @param array $value \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u30bb\u30c3\u30c8\u306e\u5185\u5bb9\n\t */\n\tpublic function admin( $key, $value ) {\n\t}\n}\n```\n\n\u8ffd\u52a0\u5f8c\u306fThrows SPAM Away\u306e\u8a2d\u5b9a\u3067\u4e0b\u8a18\u306e\u30c1\u30a7\u30c3\u30af\u304c\u52b9\u304d\u307e\u3059\u3002\n\u30fb\u65e5\u672c\u8a9e\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u30a8\u30e9\u30fc\n\u30fb\u65e5\u672c\u8a9e\u306e\u6700\u4f4e\u6587\u5b57\u6570\uff08\u4e0a\u8a18\u304c\u6709\u52b9\u306e\u5834\u5408\uff09\n\u30fb\u30ea\u30f3\u30af\u3089\u3057\u304dURL\u6587\u5b57\u5217\u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u30a8\u30e9\u30fc\n\u30fb\u30ea\u30f3\u30af\u306e\u8a31\u5bb9\u6570\uff08\u4e0a\u8a18\u304c\u6709\u52b9\u306e\u5834\u5408\uff09\n\u30fbNG\u30ef\u30fc\u30c9\u306e\u8a2d\u5b9a\uff08\u30ab\u30f3\u30de\u533a\u5207\u308a\uff09\n\u30fb\u5fc5\u9808\u30ef\u30fc\u30c9\u306e\u8a2d\u5b9a\uff08\u30ab\u30f3\u30de\u533a\u5207\u308a\uff09\n\n###Throws SPAM Away\u306e\u753b\u9762\u4e0a\u306f\u4e0b\u306e\u3088\u3046\u306a\u7b87\u6240\u306b\u306a\u308a\u307e\u3059\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-11-20 4.16.24.png](https://qiita-image-store.s3.amazonaws.com/0/37489/fb683b16-38ea-66c0-7d01-cb16e0aa63ff.png)\n\u203b\u65e5\u672c\u8a9e\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u30a8\u30e9\u30fc\u306b\u3059\u308b\u304b\u3000\uff06\u3000\u65e5\u672c\u8a9e\u6587\u5b57\u306e\u542b\u6709\u6570\uff08\u6700\u4f4e\u6587\u5b57\u6570\uff09\u8a2d\u5b9a\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-11-20 4.20.05.png](https://qiita-image-store.s3.amazonaws.com/0/37489/de17956e-e4d0-cbcd-a539-52be50f3b3bf.png)\n\u203bURL\u3089\u3057\u304d\u6587\u5b57\u5217\u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u30a8\u30e9\u30fc\u306b\u3059\u308b\u304b \uff06 \u8a31\u5bb9\u6570\u8a2d\u5b9a\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-11-20 4.21.29.png](https://qiita-image-store.s3.amazonaws.com/0/37489/3a16e793-0d7f-5d8e-2fb8-3bb69ed1dc8c.png)\n\u203bNG\u30ef\u30fc\u30c9\u306e\u8a2d\u5b9a\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-11-20 4.22.22.png](https://qiita-image-store.s3.amazonaws.com/0/37489/50ce4615-8b5f-9f55-a9a2-a8598dc7a012.png)\n\u203b\u5fc5\u9808\u30ad\u30fc\u30ef\u30fc\u30c9\u306e\u8a2d\u5b9a\n\nThrows SPAM Away\u306e\u65b9\u3067\u306f\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3082\u8a2d\u5b9a\u51fa\u6765\u307e\u3059\u304c\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u4e0a\u306f\u305d\u306e\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5229\u7528\u3057\u307e\u305b\u3093\u3002\n\u4e0b\u8a18\u306e\u5404\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u4f7f\u3046\u3053\u3068\u3067\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3082UI\u304b\u3089\u5165\u529b\u3067\u304d\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n```\n$err_not_japanese_msg = get_option( 'tsa_error_message', \"\u65e5\u672c\u8a9e\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u3044\u306a\u3044\u304b\u5c11\u306a\u3044\u3067\u3059\" );\n$err_must_word_msg = get_option( 'tsa_must_key_error_message', \"\u5fc5\u9808\u30ad\u30fc\u30ef\u30fc\u30c9\u304c\u5165\u3063\u3066\u3044\u307e\u305b\u3093\" );\n$err_ng_word_msg = get_option( 'tsa_ng_key_error_message',\"NG\u30ef\u30fc\u30c9\u306f\u5165\u3063\u3066\u3044\u307e\u3059\" );\n$err_url_count_over_msg = get_option( 'tsa_url_count_over_error_message', \"URL\u6587\u5b57\u5217\u304c\u3044\u3063\u3071\u3044\u3042\u308a\u307e\u3059\" );\n```\n\n\u203bget_option\u306e\u7b2c\uff12\u5f15\u6570\u306f\u672a\u6307\u5b9a\u6642\u306b\u4ee3\u5165\u3055\u308c\u308b\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u305f\u3060\u3057\u3001\u30b3\u30e1\u30f3\u30c8\u30b9\u30d1\u30e0\u5bfe\u7b56\u7528\u306b\u3082\u540c\u69d8\u306b\u9069\u7528\u3055\u308c\u3066\u3057\u307e\u3046\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u5b9f\u969b\u306b\u306f\u300c\u30b9\u30d1\u30e0\u30b3\u30e1\u30f3\u30c8\u300d\u306e\u30a8\u30e9\u30fc\u8868\u793a\u3092\u3057\u306a\u3044\uff08\u5143\u306e\u8a18\u4e8b\u306b\u3082\u3069\u3063\u3066\u304f\u308b\u6642\u9593\uff1d\uff10\uff09\u5834\u5408\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u308b\u3053\u3068\u306f\u306a\u304f\u95a2\u4fc2\u306a\u3044\u3067\u3059\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-11-20 4.42.47.png](https://qiita-image-store.s3.amazonaws.com/0/37489/5b52455b-6c28-460d-5e61-2337167e8ad3.png)\n\n\n\u6700\u5f8c\u306b\u300cThrows SPAM Away\u300d\u306e\u8a2d\u5b9a\u753b\u9762\u3092\u5229\u7528\u3057\u306a\u3044\u5834\u5408\u3067\u306e\u5168\u90e8\u30c1\u30a7\u30c3\u30af\u30d1\u30bf\u30fc\u30f3\u3082\u63b2\u8f09\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u300c\u5fc5\u9808\u30ad\u30fc\u30ef\u30fc\u30c9\u300d\u3063\u3066\u3044\u3046\u7279\u6b8a\u306a\u30c1\u30a7\u30c3\u30af\u304c\u5165\u308b\u3068\u3081\u3093\u3069\u304f\u3055\u3044\u306a\u30fb\u30fb\u30fb\u3063\u3066\u500b\u4eba\u7684\u306b\u306f\u601d\u3044\u307e\u3059\u3002\n\n\u305f\u3060\u3001\u4f8b\u3048\u3070\u300c\u6295\u7a3f\u7528\u30b3\u30fc\u30c9\u300d\u307f\u305f\u3044\u306a\u3082\u306e\u3092\u8a2d\u5b9a\u3057\u3066\u3042\u3063\u3066\u305d\u308c\u3092\u5165\u308c\u3066\u304f\u308c\u306a\u304d\u3083\u30d5\u30a9\u30fc\u30e0\u9001\u4fe1\u3067\u304d\u306a\u3044\u5834\u5408\u306f\u3044\u3044\u304b\u306a\u30fb\u30fb\u30fb\u3063\u3066\u601d\u3044\u307e\u3059\u3002\n\u300c\u81ea\u7531\u6b04\u300d\u306e\u3088\u3046\u306a\u9805\u76ee\u306b\u306f\u300c\u65e5\u672c\u8a9e\u300d\u300cURL\u5236\u9650\u300d\u300cNG\u30ef\u30fc\u30c9\u300d\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u3066\n\u300c\u30d1\u30b9\u30b3\u30fc\u30c9\u300d\u307f\u305f\u3044\u306a\u9805\u76ee\u306b\u306f\u300c\u5fc5\u9808\u30ad\u30fc\u30ef\u30fc\u30c9\u300d\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u308b\u3088\u3046\u306a\u6d3b\u7528\u304c\u671f\u5f85\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n##\u5168\u90e8\u4e57\u305b\u30d1\u30bf\u30fc\u30f3\n\n\u30d5\u30a9\u30fc\u30e0\u306e\u300ccontent\u300d\u3068\u3044\u3046\u540d\u524d\u306e\u9805\u76ee\u306b\u5bfe\u3057\u3066\u30c1\u30a7\u30c3\u30af\u3092\u304b\u3051\u308b\u30b3\u30fc\u30c9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u30b3\u30fc\u30c9\u4e2d\u306e\u300cmwform_validation_mw-wp-form-xxx\u300d\u306exxx\u306b\u306f MW WP Form\u3067\u4f5c\u6210\u3057\u305f\u30d5\u30a9\u30fc\u30e0\u306eID\u3092\u5165\u308c\u3066\u304f\u3060\u3055\u3044\u3002\n\n```functions.php\n/**\n * my_validation_mw\n * @param object $Validation\n * @param array $data\n * $Validation::set_rule\u306e\u5f15\u6570\u306f name\u5c5e\u6027\u5024, \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u540d, \u30aa\u30d7\u30b7\u30e7\u30f3\n */\nfunction my_validation_mw( $Validation, $data ) {\n\n\t$Validation->set_rule( 'content', 'throws_spam_away' );\n\n\treturn $Validation;\n}\nadd_filter( 'mwform_validation_mw-wp-form-xxx', 'my_validation_mw', 10, 2 );\n\n/**\n * my_validation_rule\n * @param array $validation_rules \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u914d\u5217\n * @param string $key \u30d5\u30a9\u30fc\u30e0\u8b58\u5225\u5b50\n */\nfunction my_validation_rule( $validation_rules, $key ) {\n\n    // \u8ffd\u52a0\u3059\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f MW_Validation_Rule \u30af\u30e9\u30b9\u3092\u7d99\u627f\u3057\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n    $validation_rules['throws_spam_away'] = new MW_WP_Form_Validation_Rule_Throws_Spam_Away( $key );\n    return $validation_rules;\n}\nadd_filter( 'mwform_validation_rules', 'my_validation_rule', 10, 2 );\n\nclass MW_WP_Form_Validation_Rule_Throws_Spam_Away extends MW_WP_Form_Abstract_Validation_Rule {\n\n\t/**\n\t * \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u540d\u3092\u6307\u5b9a\n\t * @var string\n\t */\n\tprotected $name = 'throws_spam_away';\n\n\t/**\n\t * \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30c1\u30a7\u30c3\u30af\n\t *\n\t * @param string $key name\u5c5e\u6027\n\t * @param array $option\n\t * @return string \u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\n\t */\n\tpublic function rule( $key, array $options = array() ) {\n\t\tinclude_once( WP_PLUGIN_DIR.'/throws-spam-away/throws_spam_away.class.php');\n\n\t\t$throwsSpamAway = new ThrowsSpamAway();\n\n\t\t$args = array(\n\t\t\t  'post_id' => NULL,\n\t\t\t  'tsa_on_flg' => 1,\t// \u65e5\u672c\u8a9e\u5229\u7528\u3057\u3066\u3044\u306a\u3044\u3068\u3060\u3081\uff01\n\t\t\t  'tsa_japanese_string_min_count' => 5,\t// \u65e5\u672c\u8a9e\u6587\u5b57\u304c\uff15\u6587\u5b57\u4ee5\u4e0a\u306a\u3051\u308c\u3070\u30a8\u30e9\u30fc\n\t\t\t  'tsa_ng_keywords'\t=>\t\"\u79c1\u306f\u305f\u308f\u3057,\u99ac\u9e7f\",\t// NG\u30ad\u30fc\u30ef\u30fc\u30c9\u6307\u5b9a\u306e\u307f\u884c\u3046\n\t\t\t  'tsa_must_keywords'\t=>\t\"\u30de\u30b9\u30c8\",\t// \u300c\u30de\u30b9\u30c8\u300d\u3068\u3044\u3046\u6587\u5b57\u304c\u5165\u3063\u3066\u3044\u306a\u3051\u308c\u3070\u30a8\u30e9\u30fc\n\t\t\t  'tsa_url_count_check'\t=>\t1,\t\t\t// \u30ea\u30f3\u30af\u304c\u3042\u3063\u305f\u3089\u30c1\u30a7\u30c3\u30af\u3059\u308b\n\t\t\t  'tsa_ok_url_count'\t=>\t2\t\t\t// \u30ea\u30f3\u30af\u304c\uff12\u500b\u3042\u3063\u305f\u3089\u30a8\u30e9\u30fc\n\t\t\t);\n\t\t$value = $this->Data->get( $key );\n\t\t$chk_result = $throwsSpamAway->validate_comment( \"\", $value, $args);\n\t\tif ( !MWF_Functions::is_empty( $value ) ) {\n\n\t\t\t// IP\u30a2\u30c9\u30ec\u30b9\u30c1\u30a7\u30c3\u30af\n\t\t\t$ip = $_SERVER['REMOTE_ADDR'];\n\t\t\t$chk_ip = $throwsSpamAway->ip_check( $ip );\n\t\t\tif ( ! $chk_ip ) {\n\t\t\t\t// \u4e0d\u6b63IP\u306f\u305d\u306e\u307e\u307e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n\t\t\t\theader( 'Location: http://www.yahoo.co.jp' );\n\t\t\t\tdie;\n\t\t\t}\n\n\n\t\t\tif ( !$chk_result ) {\n\t\t\t\t// \u30a8\u30e9\u30fc\u30bf\u30a4\u30d7\u3092\u53d6\u5f97\n\t\t\t\t$error_type = $throwsSpamAway->error_type;\n\t\t\t\t$message_str = \"\";\n\t\t\t\t/** \n\t\t\t\t\t\u30a8\u30e9\u30fc\u7a2e\u985e\n\t\t\t\t\t'must_word'\t\t\t\u5fc5\u9808\u30ad\u30fc\u30ef\u30fc\u30c9\n\t\t\t\t\t'ng_word'\t\t\tNG\u30ad\u30fc\u30ef\u30fc\u30c9\n\t\t\t\t\t'url_count_over'\t\u30ea\u30f3\u30af\u6570\u30aa\u30fc\u30d0\u30fc\n\t\t\t\t\t'not_japanese'\t\t\u65e5\u672c\u8a9e\u4e0d\u8db3\n\t\t\t\t*/\n\t\t\t\tswitch ( $error_type ) {\n\t\t\t\t\tcase \"must_word\":\n\t\t\t\t\t\t$message_str = \"\u5fc5\u9808\u30ad\u30fc\u30ef\u30fc\u30c9\u304c\u5165\u3063\u3066\u3044\u306a\u3044\u305f\u3081\u9001\u4fe1\u51fa\u6765\u307e\u305b\u3093 \";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"ng_word\":\n\t\t\t\t\t\t$message_str = \"NG\u30ad\u30fc\u30ef\u30fc\u30c9\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u305f\u3081\u9001\u4fe1\u3067\u304d\u307e\u305b\u3093 \";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"url_count_over\":\n\t\t\t\t\t\t$message_str = \"\u30ea\u30f3\u30af\u304c\u591a\u3059\u304e\u307e\u3059 \";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"not_japanese\":\n\t\t\t\t\t\t$message_str = \"\u65e5\u672c\u8a9e\u304c\u542b\u307e\u308c\u306a\u3044\u304b\u65e5\u672c\u8a9e\u6587\u5b57\u6570\u304c\u5c11\u306a\u3044\u305f\u3081\u9001\u4fe1\u51fa\u6765\u307e\u305b\u3093 \";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t$message_str = \"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f:\".$error_type;\n\t\t\t\t}\n\t\t\t\t$defaults = array(\n\t\t\t\t\t'message' => $message_str\n\t\t\t\t);\n\t\t\t}\n\t\t\t$options = array_merge( $defaults, $options );\n\t\t\treturn $options['message'];\n\t\t}\n\t}\n\n\t/**\n\t * \u8a2d\u5b9a\u30d1\u30cd\u30eb\u306b\u8ffd\u52a0\n\t *\n\t * @param numeric $key \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u30bb\u30c3\u30c8\u306e\u8b58\u5225\u756a\u53f7\n\t * @param array $value \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u30bb\u30c3\u30c8\u306e\u5185\u5bb9\n\t */\n\tpublic function admin( $key, $value ) {\n\t}\n}\n```\n\n\u8907\u6570\u306e\u9805\u76ee\u306b\u30c1\u30a7\u30c3\u30af\u3092\u304b\u3051\u308b\u5834\u5408\u306f\nset_rule \u3092\u5897\u3084\u3057\n\u9805\u76ee\u30c1\u30a7\u30c3\u30af\u306e\u5185\u5bb9\u3092\u305d\u308c\u305e\u308c\u5909\u3048\u305f\u3044\u5834\u5408\u306f\nmy_validation_rule \u306e $validation_rules \u306e\u30d0\u30ea\u30a8\u30fc\u30b7\u30e7\u30f3\u3092\u5897\u3084\u3057\n\u30c1\u30a7\u30c3\u30af\u30af\u30e9\u30b9\u3092\u5897\u3084\u3057\u3066\u5bfe\u5fdc\u3059\u308c\u3070\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n", "tags": ["WordPress", "form", "MW_WP_Form", "Throws_SPAM_Away", "\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3"]}