{"context": "\n\nDeferred \u3067\u306a\u3044\u5834\u5408\n\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u51e6\u7406\u3092\u5f93\u6765\u306e success, error, complete \u3067\u6307\u5b9a\u3059\u308b\u65b9\u6cd5\u3002\n\u3053\u3093\u306a\u611f\u3058\u3067\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u7279\u6709\u306e\u5171\u901a\u51e6\u7406\u306a\u3069\u3092\u8ffd\u52a0\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u591a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u5b9f\u88c5\n\nvar myAjax = function(arg) {\n    var opt = $.extend({}, $.ajaxSettings, arg);\n\n    opt.success = (function(func) {\n        return function(data, statusText, jqXHR) {\n            console.log('success\u6642\u306e\u5171\u901a\u51e6\u7406 ...');\n\n            if (func) {\n                func(data, statusText, jqXHR);\n            }\n        };\n    })(opt.success);\n\n    opt.error = (function(func) {\n        return function(jqXHR, statusText, errorThrown) {\n            console.log('error\u6642\u306e\u5171\u901a\u51e6\u7406 ...');\n\n            if (func) {\n                func(jqXHR, statusText, errorThrown);\n            }\n        };\n    })(opt.error);\n\n    opt.complete = (function(func) {\n        return function(jqXHR, statusText) {\n            console.log('complete\u6642\u306e\u5171\u901a\u51e6\u7406 ...');\n\n            if (func) {\n                func(jqXHR, statusText);\n            }\n        };\n    })(opt.complete);\n\n    return $.ajax(opt);\n};\n\n\n\n\u4f7f\u3044\u65b9\nmyAjax({\n    url: '/hoge',\n    type: 'GET',\n    dataType: 'json',\n    data: {\n        param1: 'value1',\n        param2: 'value2'\n    },\n    success: function(json, statusText, jqXHR) {\n        console.log('SUCCESS!');\n    },\n    error: function(jqXHR, statusText, errorThrown) {\n        console.log('ERROR!');\n    },\n    complete: function(jqXHR, statusText) {\n        console.log('COMPLETE!');\n    }\n});\n\n\n\u5b9f\u884c\u7d50\u679c\nsuccess\u6642\u306e\u5171\u901a\u51e6\u7406 ...\nSUCCESS!\ncomplete\u6642\u306e\u5171\u901a\u51e6\u7406 ...\nCOMPLETE!\n\n\nDeferred \u306a\u5834\u5408\n\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u51e6\u7406\u3092Promise\u306e done, fail, always \u3067\u6307\u5b9a\u3059\u308b\u65b9\u6cd5\u3002\n\n\u5b9f\u88c5\n\n\u30dd\u30a4\u30f3\u30c8\n\n\njQuery1.8\u4ee5\u964d\u3001$.ajax \u306e\u7d50\u679c(jqXHR)\u306fXMLHttpRequest\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u30fb\u30e1\u30bd\u30c3\u30c9\u306b\u52a0\u3048\u3066\u3001Promise\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u30fb\u30e1\u30bd\u30c3\u30c9\u3082\u5b9f\u88c5\u3057\u3066\u3044\u308b\nreturn \u6642\u3001(myAjax\u5185\u3067\u751f\u6210\u3057\u305f) Deferred\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092Promise\u5316( defer.promise() )\u3057\u3001\u5916\u90e8\u304b\u3089\u306f then()\u3001done()\u3001fail() \u3068\u3044\u3063\u305f\u30e1\u30bd\u30c3\u30c9\u4ee5\u5916\u3001Deferred\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u64cd\u4f5c\u51fa\u6765\u306a\u3044\u3088\u3046\u306b\u3059\u308b\nreturn \u6642\u3001(myAjax\u5185\u3067\u751f\u6210\u3057\u305f) Deferred\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b $.ajax \u306e\u7d50\u679c(jqXHR) \u3092\u30de\u30fc\u30b8\u3059\u308b\u3053\u3068\u3067\u3001\u5143\u3005\u306ejqXHR\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u30fb\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u7528\u3067\u304d\u308b\u306e\u306f\u305d\u306e\u307e\u307e\u306b\u3001\u5916\u90e8\u304b\u3089\u51e6\u7406(done\u3001fail)\u3092\u6ce8\u5165\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u306e\u304c\u30df\u30bd\n\n\n\nvar myAjax = function(arg) {\n    var opt = $.extend({}, $.ajaxSettings, arg);\n    var jqXHR = $.ajax(opt);\n\n    var defer = $.Deferred();\n\n    jqXHR.done(function(data, statusText, jqXHR) {\n        console.log('done(=success)\u6642\u306e\u5171\u901a\u51e6\u7406 ...');\n\n        // defer.resovle \u3067\u306f\u306a\u304f\u3066 defer.resolveWith \u3067\n        // myAjax(...).done() \u5185\u3067\u306ethis\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\n        // \u660e\u793a\u7684\u306b\u6307\u5b9a\u3059\u308b\n        defer.resolveWith(this, arguments);\n    });\n\n    jqXHR.fail(function(jqXHR, statusText, errorThrown) {\n        console.log('fail(=error)\u6642\u306e\u5171\u901a\u51e6\u7406 ...');\n\n        // defer.reject \u3067\u306f\u306a\u304f\u3066 defer.rejectWith \u3067\n        // myAjax(...).fail() \u5185\u3067\u306ethis\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\n        // \u660e\u793a\u7684\u306b\u6307\u5b9a\u3059\u308b\n        defer.rejectWith(this, arguments);\n    });\n\n    jqXHR.always(function() {\n        console.log('always(=complete)\u6642\u306e\u5171\u901a\u51e6\u7406 ...');\n    });\n\n    return $.extend({}, jqXHR, defer.promise());\n};\n\n\n\u4f7f\u3044\u65b9\nmyAjax({\n    url: '/hoge',\n    type: 'GET',\n    dataType: 'json',\n    data: {\n        param1: 'value1',\n        param2: 'value2'\n    }\n}).done(function(json, statusText, jqXHR) {\n    console.log('DONE!');\n}).fail(function(jqXHR, statusText, errorThrown) {\n    console.log('FAIL!');\n}).always(function() {\n    console.log('ALWAYS!');\n});\n\n\n\u5b9f\u884c\u7d50\u679c\ndone(=success)\u6642\u306e\u5171\u901a\u51e6\u7406 ...\nDONE!\nalways(=complete)\u6642\u306e\u5171\u901a\u51e6\u7406 ...\nALWAYS!\n\n\n\u30cf\u30de\u3063\u305f\u30dd\u30a4\u30f3\u30c8\n\n\u2460 \u30e9\u30c3\u30d1\u30fc\u5185\u3067Deferred\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3057\u306a\u3044\u5834\u5408\n\u3064\u307e\u308a\u3001\nvar myAjax = function(arg) {\n    var opt = $.extend({}, $.ajaxSettings, arg);\n    var jqXHR = $.ajax(opt);\n\n    jqXHR.done(function(data, statusText, jqXHR) {\n        console.log('done(=success)\u6642\u306e\u5171\u901a\u51e6\u7406 ...');\n    });\n\n    jqXHR.always(function() {\n        console.log('always(=complete)\u6642\u306e\u5171\u901a\u51e6\u7406 ...');\n    });\n\n    return jqXHR;\n};\n\nmyAjax({\n// ...\n}).done(function(json, statusText, jqXHR) {\n    console.log('DONE!');\n}).always(function() {\n    console.log('ALWAYS!');\n});\n\n\u3060\u3068\u3069\u3046\u306a\u308b\u304b\uff1f\n\u3053\u3046\u306a\u308b\u3002\ndone(=success)\u6642\u306e\u5171\u901a\u51e6\u7406 ...\nDONE!\nalways(=complete)\u6642\u306e\u5171\u901a\u51e6\u7406 ...\nALWAYS!\n\n\u3048\uff1f\u3044\u3044\u3093\u3058\u3083\u306a\u3044\u306e\uff1f\n\u3067\u3082\u3001\u3053\u3093\u306a\u6642\u30c0\u30e1\nvar myAjax = function(arg) {\n    var opt = $.extend({}, $.ajaxSettings, arg);\n    var jqXHR = $.ajax(opt);\n\n    jqXHR.done(function(data, statusText, jqXHR) {\n        if (data.isXXX) {\n            console.log('\u4f55\u304b\u3092\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3057\u3066\u3001\u3053\u306e\u5834\u5408\u306f\u3053\u3053\u3067done\u3092\u7d42\u308f\u308a\u305f\u3044\uff01');\n            return;\n        }\n    });\n\n    jqXHR.always(function() {\n        console.log('always(=complete)\u6642\u306e\u5171\u901a\u51e6\u7406 ...');\n    });\n\n    return jqXHR;\n};\n\n\u7d50\u679c\u3002\n\u4f55\u304b\u3092\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3057\u3066\u3001\u3053\u306e\u5834\u5408\u306f\u3053\u3053\u3067done\u3092\u7d42\u308f\u308a\u305f\u3044\uff01\nDONE!\u3000\u3000\u2190\u2605\u3053\u306e\u51e6\u7406\u306f\u5b9f\u884c\u3057\u305f\u304f\u306a\u3044\u2605\nalways(=complete)\u6642\u306e\u5171\u901a\u51e6\u7406 ...\nALWAYS!\n\ndone/fail\u306e\u5171\u901a\u51e6\u7406\u5185\u3067done/fail\u3092\u5207\u308a\u4e0a\u3052\u3089\u308c\u306a\u3044\u3002\n\u3053\u308c\u306f\u3053\u3046\u66f8\u3044\u305f\u306e\u3068\u540c\u3058\n$.ajax({\n// ...\n}).done(function() {\n    if (data.isXXX) {\n        console.log('\u4f55\u304b\u3092\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3057\u3066\u3001\u3053\u306e\u5834\u5408\u306f\u3053\u3053\u3067done\u3092\u7d42\u308f\u308a\u305f\u3044\uff01');\n        return;\n    }\n}).done(function() {\n    console.log('DONE!');\n})...\n\n2\u3064\u306edone\u304c\u5225\u3005\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u51e6\u7406\u3068\u3057\u3066\u30a4\u30d9\u30f3\u30c8\u30ad\u30e5\u30fc\u306b\u5165\u308c\u3089\u308c\u3066\u9806\u756a(=FIFO)\u306b\u5b9f\u884c\u3055\u308c\u308b\u305f\u3081\u3002\n\n\u2461 \u30e9\u30c3\u30d1\u30fc\u304creturn\u3059\u308bDeferred(Promise)\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306emerge\u9806\u304c\u9006\n\u3082\u3057\u3001\nvar myAjax = function(arg) {\n    var opt = $.extend({}, $.ajaxSettings, arg);\n    var jqXHR = $.ajax(opt);\n\n    var defer = $.Deferred();\n\n// ...\n\n    // return $.extend({}, jqXHR, defer.promise());\n    return $.extend({}, defer.promise(), jqXHR);\n};\n\n\u3068\u3059\u308b\u3068\u3001defer\u306edone\u3084fail\u304cjqXHR\u306e\u305d\u308c\u3089\u3067\u4e0a\u66f8\u304d\u3055\u308c\u3066\u3057\u307e\u3046\u305f\u3081\u3001\u2460\u3068\u540c\u3058\u7d50\u679c\u306b\u306a\u308b\u3002\n\n\u2462 \u30e9\u30c3\u30d1\u30fc\u306edone/fail\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u95a2\u6570\u5185\u3067\u53c2\u7167\u3059\u308bthis\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\n\u4e0b\u8a18\u306e\u3088\u3046\u306bdefer.resolve\u3067\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u95a2\u6570(done)\u3092\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u4f55\u306e\u554f\u984c\u3082\u306a\u3055\u305d\u3046\u3060\u3051\u3069...\nvar myAjax = function(arg) {\n    var opt = $.extend({}, $.ajaxSettings, arg);\n    var jqXHR = $.ajax(opt);\n\n    var defer = $.Deferred();\n\n    jqXHR.done(function(data, statusText, jqXHR) {\n        console.log('done(=success)\u6642\u306e\u5171\u901a\u51e6\u7406 ...');\n\n        // \u2605 \u2193\u2193\u2193 \u2605\n        defer.resolve(data, statusText, jqXHR); \n        // \u2605 \u2191\u2191\u2191 \u2605\n    });\n\n// ...\n\n    return $.extend({}, jqXHR, defer.promise());\n};\n\nmyAjax({\n// ...\n}).done(function() {\n        // \u2193 \u3053\u306ethis\u306f\u4f55\u8005\uff1f\uff1f\n    console.log(this);\n})...\n\nmyAjax\u5b9f\u884c\u6642\u306edone\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u5185\u306ethis\u3092\u898b\u3066\u307f\u308b\u3068\nmyAjax\u5185\u3067\u751f\u6210\u3057\u305fDeferred(Promise)\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u76f8\u5f53\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n\u305d\u3053\u3067\u4e0b\u8a18\u306e\u3088\u3046\u306bdefer.resolveWith\u3067\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u95a2\u6570\u5185\u3067\u306ethis\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u660e\u793a\u7684\u306b\u6307\u5b9a\u3057\u3066\u3042\u3052\u308b\u3068...\nvar myAjax = function(arg) {\n    var opt = $.extend({}, $.ajaxSettings, arg);\n    var jqXHR = $.ajax(opt);\n\n    var defer = $.Deferred();\n\n    jqXHR.done(function(data, statusText, jqXHR) {\n        console.log('done(=success)\u6642\u306e\u5171\u901a\u51e6\u7406 ...');\n\n        // \u2605 \u2193\u2193\u2193 \u2605\n        defer.resolveWith(this, arguments);\n        // \u2605 \u2191\u2191\u2191 \u2605\n    });\n\n// ...\n\n    return $.extend({}, jqXHR, defer.promise());\n};\n\nmyAjax({\n// ...\n}).done(function() {\n        // \u2193 \u3053\u306ethis\u306f\u4f55\u8005\uff1f\uff1f\n    console.log(this);\n})...\n\n\u30d0\u30c3\u30c1\u30ea\u5143\u3005\u306e$.ajax\u306ethis\u76f8\u5f53\u306b\ud83d\udc4d\n\n## Deferred \u3067\u306a\u3044\u5834\u5408\n\n\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u51e6\u7406\u3092\u5f93\u6765\u306e ```success```, ```error```, ```complete``` \u3067\u6307\u5b9a\u3059\u308b\u65b9\u6cd5\u3002\n\u3053\u3093\u306a\u611f\u3058\u3067\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u7279\u6709\u306e\u5171\u901a\u51e6\u7406\u306a\u3069\u3092\u8ffd\u52a0\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u591a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n### \u5b9f\u88c5\n\n```javascript\n\nvar myAjax = function(arg) {\n\tvar opt = $.extend({}, $.ajaxSettings, arg);\n\n\topt.success = (function(func) {\n\t\treturn function(data, statusText, jqXHR) {\n\t\t\tconsole.log('success\u6642\u306e\u5171\u901a\u51e6\u7406 ...');\n\n\t\t\tif (func) {\n\t\t\t\tfunc(data, statusText, jqXHR);\n\t\t\t}\n\t\t};\n\t})(opt.success);\n\t\n\topt.error = (function(func) {\n\t\treturn function(jqXHR, statusText, errorThrown) {\n\t\t\tconsole.log('error\u6642\u306e\u5171\u901a\u51e6\u7406 ...');\n\n\t\t\tif (func) {\n\t\t\t\tfunc(jqXHR, statusText, errorThrown);\n\t\t\t}\n\t\t};\n\t})(opt.error);\n\n\topt.complete = (function(func) {\n\t\treturn function(jqXHR, statusText) {\n\t\t\tconsole.log('complete\u6642\u306e\u5171\u901a\u51e6\u7406 ...');\n\n\t\t\tif (func) {\n\t\t\t\tfunc(jqXHR, statusText);\n\t\t\t}\n\t\t};\n\t})(opt.complete);\n\n\treturn $.ajax(opt);\n};\n\n```\n\n### \u4f7f\u3044\u65b9\n\n```javascript\nmyAjax({\n\turl: '/hoge',\n\ttype: 'GET',\n\tdataType: 'json',\n\tdata: {\n\t\tparam1: 'value1',\n\t\tparam2: 'value2'\n\t},\n\tsuccess: function(json, statusText, jqXHR) {\n\t\tconsole.log('SUCCESS!');\n\t},\n\terror: function(jqXHR, statusText, errorThrown) {\n\t\tconsole.log('ERROR!');\n\t},\n\tcomplete: function(jqXHR, statusText) {\n\t\tconsole.log('COMPLETE!');\n\t}\n});\n```\n\n### \u5b9f\u884c\u7d50\u679c\n\n```\nsuccess\u6642\u306e\u5171\u901a\u51e6\u7406 ...\nSUCCESS!\ncomplete\u6642\u306e\u5171\u901a\u51e6\u7406 ...\nCOMPLETE!\n```\n\n## Deferred \u306a\u5834\u5408\n\n\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u51e6\u7406\u3092Promise\u306e ```done```, ```fail```, ```always``` \u3067\u6307\u5b9a\u3059\u308b\u65b9\u6cd5\u3002\n\n### \u5b9f\u88c5\n\n- \u30dd\u30a4\u30f3\u30c8\n  + jQuery1.8\u4ee5\u964d\u3001$.ajax \u306e\u7d50\u679c(jqXHR)\u306f```XMLHttpRequest```\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u30fb\u30e1\u30bd\u30c3\u30c9\u306b\u52a0\u3048\u3066\u3001```Promise```\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u30fb\u30e1\u30bd\u30c3\u30c9\u3082\u5b9f\u88c5\u3057\u3066\u3044\u308b\n  + return \u6642\u3001(myAjax\u5185\u3067\u751f\u6210\u3057\u305f) Deferred\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092Promise\u5316( defer.promise() )\u3057\u3001\u5916\u90e8\u304b\u3089\u306f then()\u3001done()\u3001fail() \u3068\u3044\u3063\u305f\u30e1\u30bd\u30c3\u30c9\u4ee5\u5916\u3001Deferred\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u64cd\u4f5c\u51fa\u6765\u306a\u3044\u3088\u3046\u306b\u3059\u308b\n  + return \u6642\u3001(myAjax\u5185\u3067\u751f\u6210\u3057\u305f) Deferred\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b $.ajax \u306e\u7d50\u679c(jqXHR) \u3092\u30de\u30fc\u30b8\u3059\u308b\u3053\u3068\u3067\u3001\u5143\u3005\u306ejqXHR\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u30fb\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u7528\u3067\u304d\u308b\u306e\u306f\u305d\u306e\u307e\u307e\u306b\u3001\u5916\u90e8\u304b\u3089\u51e6\u7406(done\u3001fail)\u3092\u6ce8\u5165\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u306e\u304c\u30df\u30bd\n\n```javascript\nvar myAjax = function(arg) {\n\tvar opt = $.extend({}, $.ajaxSettings, arg);\n\tvar jqXHR = $.ajax(opt);\n\n\tvar defer = $.Deferred();\n\n\tjqXHR.done(function(data, statusText, jqXHR) {\n\t\tconsole.log('done(=success)\u6642\u306e\u5171\u901a\u51e6\u7406 ...');\n\n\t\t// defer.resovle \u3067\u306f\u306a\u304f\u3066 defer.resolveWith \u3067\n\t\t// myAjax(...).done() \u5185\u3067\u306ethis\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\n\t\t// \u660e\u793a\u7684\u306b\u6307\u5b9a\u3059\u308b\n\t\tdefer.resolveWith(this, arguments);\n\t});\n\n\tjqXHR.fail(function(jqXHR, statusText, errorThrown) {\n\t\tconsole.log('fail(=error)\u6642\u306e\u5171\u901a\u51e6\u7406 ...');\n\n\t\t// defer.reject \u3067\u306f\u306a\u304f\u3066 defer.rejectWith \u3067\n\t\t// myAjax(...).fail() \u5185\u3067\u306ethis\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\n\t\t// \u660e\u793a\u7684\u306b\u6307\u5b9a\u3059\u308b\n\t\tdefer.rejectWith(this, arguments);\n\t});\n\n\tjqXHR.always(function() {\n\t\tconsole.log('always(=complete)\u6642\u306e\u5171\u901a\u51e6\u7406 ...');\n\t});\n\t\n\treturn $.extend({}, jqXHR, defer.promise());\n};\n```\n\n### \u4f7f\u3044\u65b9\n\n```javascript\nmyAjax({\n\turl: '/hoge',\n\ttype: 'GET',\n\tdataType: 'json',\n\tdata: {\n\t\tparam1: 'value1',\n\t\tparam2: 'value2'\n\t}\n}).done(function(json, statusText, jqXHR) {\n\tconsole.log('DONE!');\n}).fail(function(jqXHR, statusText, errorThrown) {\n\tconsole.log('FAIL!');\n}).always(function() {\n\tconsole.log('ALWAYS!');\n});\n```\n\n### \u5b9f\u884c\u7d50\u679c\n\n```\ndone(=success)\u6642\u306e\u5171\u901a\u51e6\u7406 ...\nDONE!\nalways(=complete)\u6642\u306e\u5171\u901a\u51e6\u7406 ...\nALWAYS!\n```\n\n###  \u30cf\u30de\u3063\u305f\u30dd\u30a4\u30f3\u30c8\n\n#### \u2460 \u30e9\u30c3\u30d1\u30fc\u5185\u3067Deferred\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3057\u306a\u3044\u5834\u5408\n\n\u3064\u307e\u308a\u3001\n\n```javascript\nvar myAjax = function(arg) {\n    var opt = $.extend({}, $.ajaxSettings, arg);\n    var jqXHR = $.ajax(opt);\n\n    jqXHR.done(function(data, statusText, jqXHR) {\n        console.log('done(=success)\u6642\u306e\u5171\u901a\u51e6\u7406 ...');\n    });\n\n    jqXHR.always(function() {\n        console.log('always(=complete)\u6642\u306e\u5171\u901a\u51e6\u7406 ...');\n    });\n\n    return jqXHR;\n};\n\nmyAjax({\n// ...\n}).done(function(json, statusText, jqXHR) {\n\tconsole.log('DONE!');\n}).always(function() {\n\tconsole.log('ALWAYS!');\n});\n```\n\n\u3060\u3068\u3069\u3046\u306a\u308b\u304b\uff1f\n\u3053\u3046\u306a\u308b\u3002\n\n```\ndone(=success)\u6642\u306e\u5171\u901a\u51e6\u7406 ...\nDONE!\nalways(=complete)\u6642\u306e\u5171\u901a\u51e6\u7406 ...\nALWAYS!\n```\n\n\u3048\uff1f\u3044\u3044\u3093\u3058\u3083\u306a\u3044\u306e\uff1f\n\u3067\u3082\u3001\u3053\u3093\u306a\u6642\u30c0\u30e1\n\n```javascript\nvar myAjax = function(arg) {\n\tvar opt = $.extend({}, $.ajaxSettings, arg);\n\tvar jqXHR = $.ajax(opt);\n\n\tjqXHR.done(function(data, statusText, jqXHR) {\n\t\tif (data.isXXX) {\n\t\t\tconsole.log('\u4f55\u304b\u3092\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3057\u3066\u3001\u3053\u306e\u5834\u5408\u306f\u3053\u3053\u3067done\u3092\u7d42\u308f\u308a\u305f\u3044\uff01');\n\t\t\treturn;\n\t\t}\n\t});\n\n\tjqXHR.always(function() {\n\t\tconsole.log('always(=complete)\u6642\u306e\u5171\u901a\u51e6\u7406 ...');\n\t});\n\n\treturn jqXHR;\n};\n```\n\n\u7d50\u679c\u3002\n\n```\n\u4f55\u304b\u3092\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3057\u3066\u3001\u3053\u306e\u5834\u5408\u306f\u3053\u3053\u3067done\u3092\u7d42\u308f\u308a\u305f\u3044\uff01\nDONE!\u3000\u3000\u2190\u2605\u3053\u306e\u51e6\u7406\u306f\u5b9f\u884c\u3057\u305f\u304f\u306a\u3044\u2605\nalways(=complete)\u6642\u306e\u5171\u901a\u51e6\u7406 ...\nALWAYS!\n```\n\ndone/fail\u306e\u5171\u901a\u51e6\u7406\u5185\u3067done/fail\u3092\u5207\u308a\u4e0a\u3052\u3089\u308c\u306a\u3044\u3002\n\u3053\u308c\u306f\u3053\u3046\u66f8\u3044\u305f\u306e\u3068\u540c\u3058\n\n```javascript\n$.ajax({\n// ...\n}).done(function() {\n\tif (data.isXXX) {\n\t\tconsole.log('\u4f55\u304b\u3092\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3057\u3066\u3001\u3053\u306e\u5834\u5408\u306f\u3053\u3053\u3067done\u3092\u7d42\u308f\u308a\u305f\u3044\uff01');\n\t\treturn;\n\t}\n}).done(function() {\n\tconsole.log('DONE!');\n})...\n```\n\n2\u3064\u306edone\u304c\u5225\u3005\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u51e6\u7406\u3068\u3057\u3066\u30a4\u30d9\u30f3\u30c8\u30ad\u30e5\u30fc\u306b\u5165\u308c\u3089\u308c\u3066\u9806\u756a(=FIFO)\u306b\u5b9f\u884c\u3055\u308c\u308b\u305f\u3081\u3002\n\n#### \u2461 \u30e9\u30c3\u30d1\u30fc\u304creturn\u3059\u308bDeferred(Promise)\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306emerge\u9806\u304c\u9006\n\n\u3082\u3057\u3001\n\n\n```javascript\nvar myAjax = function(arg) {\n\tvar opt = $.extend({}, $.ajaxSettings, arg);\n\tvar jqXHR = $.ajax(opt);\n\n\tvar defer = $.Deferred();\n\n// ...\n\t\n\t// return $.extend({}, jqXHR, defer.promise());\n\treturn $.extend({}, defer.promise(), jqXHR);\n};\n```\n\n\u3068\u3059\u308b\u3068\u3001```defer```\u306edone\u3084fail\u304c```jqXHR```\u306e\u305d\u308c\u3089\u3067\u4e0a\u66f8\u304d\u3055\u308c\u3066\u3057\u307e\u3046\u305f\u3081\u3001\u2460\u3068\u540c\u3058\u7d50\u679c\u306b\u306a\u308b\u3002\n\n#### \u2462 \u30e9\u30c3\u30d1\u30fc\u306edone/fail\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u95a2\u6570\u5185\u3067\u53c2\u7167\u3059\u308bthis\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\n\n\u4e0b\u8a18\u306e\u3088\u3046\u306b```defer.resolve```\u3067\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u95a2\u6570(```done```)\u3092\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u4f55\u306e\u554f\u984c\u3082\u306a\u3055\u305d\u3046\u3060\u3051\u3069...\n\n```javascript\nvar myAjax = function(arg) {\n\tvar opt = $.extend({}, $.ajaxSettings, arg);\n\tvar jqXHR = $.ajax(opt);\n\n\tvar defer = $.Deferred();\n\n\tjqXHR.done(function(data, statusText, jqXHR) {\n\t\tconsole.log('done(=success)\u6642\u306e\u5171\u901a\u51e6\u7406 ...');\n\n\t\t// \u2605 \u2193\u2193\u2193 \u2605\n\t\tdefer.resolve(data, statusText, jqXHR); \n\t\t// \u2605 \u2191\u2191\u2191 \u2605\n\t});\n\n// ...\n\t\n\treturn $.extend({}, jqXHR, defer.promise());\n};\n\nmyAjax({\n// ...\n}).done(function() {\n        // \u2193 \u3053\u306ethis\u306f\u4f55\u8005\uff1f\uff1f\n\tconsole.log(this);\n})...\n```\n\nmyAjax\u5b9f\u884c\u6642\u306e```done```\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u5185\u306ethis\u3092\u898b\u3066\u307f\u308b\u3068\nmyAjax\u5185\u3067\u751f\u6210\u3057\u305fDeferred(Promise)\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u76f8\u5f53\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n![Pentan 2.png](https://qiita-image-store.s3.amazonaws.com/0/3899/81db566b-87b3-4a7f-5760-18b047564669.png \"Pentan 2.png\")\n\n\u305d\u3053\u3067\u4e0b\u8a18\u306e\u3088\u3046\u306b```defer.resolveWith```\u3067\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u95a2\u6570\u5185\u3067\u306ethis\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u660e\u793a\u7684\u306b\u6307\u5b9a\u3057\u3066\u3042\u3052\u308b\u3068...\n\n\n```javascript\nvar myAjax = function(arg) {\n\tvar opt = $.extend({}, $.ajaxSettings, arg);\n\tvar jqXHR = $.ajax(opt);\n\n\tvar defer = $.Deferred();\n\n\tjqXHR.done(function(data, statusText, jqXHR) {\n\t\tconsole.log('done(=success)\u6642\u306e\u5171\u901a\u51e6\u7406 ...');\n\n\t\t// \u2605 \u2193\u2193\u2193 \u2605\n\t\tdefer.resolveWith(this, arguments);\n\t\t// \u2605 \u2191\u2191\u2191 \u2605\n\t});\n\n// ...\n\t\n\treturn $.extend({}, jqXHR, defer.promise());\n};\n\nmyAjax({\n// ...\n}).done(function() {\n        // \u2193 \u3053\u306ethis\u306f\u4f55\u8005\uff1f\uff1f\n\tconsole.log(this);\n})...\n```\n\n\u30d0\u30c3\u30c1\u30ea\u5143\u3005\u306e$.ajax\u306ethis\u76f8\u5f53\u306b\ud83d\udc4d\n\n![Pentan.png](https://qiita-image-store.s3.amazonaws.com/0/3899/d11489b8-677a-338c-9a34-defc4b5650d7.png \"Pentan.png\")\n\n", "tags": ["jQuery", "Ajax", "JavaScript", "Deferred", "promise"]}