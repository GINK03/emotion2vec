{"tags": ["kintone", "Slack", "JavaScript", "bot"], "context": "kintone Advent Calendar 2016 \u306e24\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\u4eca\u591c\u306f\u30af\u30ea\u30b9\u30de\u30b9\u30a4\u30f4\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u30af\u30ea\u30b9\u30de\u30b9\u30d7\u30ec\u30bc\u30f3\u30c8\u3092\u4f55\u306b\u3059\u308b\u304b\u60a9\u3093\u3067\u3044\u308b\u4eba\u3082\u591a\u3044\u306e\u3067\u306f\u306a\u3044\u3067\u3057\u3087\u3046\u304b\uff1f\n\u79c1\u306f\u3001\u512a\u67d4\u4e0d\u65ad\u306a\u306e\u3067\u5168\u7136\u9078\u3079\u307e\u305b\u3093\u30fb\u30fb\u30fborz\n\u305d\u3093\u306a\u60a9\u3081\u308b\u65b9\u306b\u304a\u304f\u308bslack kintone \u9023\u643a\u3092\u8003\u3048\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u7406\u60f3\u5f62\n\u7406\u60f3\u5f62\u306f\u3001\u307e\u305a\u9069\u5f53\u306b\u30d4\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u305f\u3044\u304f\u3064\u304b\u306e\u5546\u54c1\u3092kintone\u306b\u3044\u308c\u3066\u304a\u304d\u307e\u3059\u3002\nslack\u3067\u300c\u30d7\u30ec\u30bc\u30f3\u30c8\u3092\u6c7a\u3081\u308b\u300d\u3068\u3064\u3076\u3084\u304f\u3068\u3001kintone\u306b\u5165\u308c\u3066\u304a\u3044\u305f\u30d7\u30ec\u30bc\u30f3\u30c8\u304b\u3089\u30e9\u30f3\u30c0\u30e0\u3067\u9078\u3093\u3067\u3068\u3063\u3066\u304d\u3066\u304f\u308c\u308bbot\u7684\u306a\u3084\u3064\u3092\u4f5c\u308d\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u512a\u67d4\u4e0d\u65ad\u306a\u306e\u3067\u3001\u767b\u9332\u3057\u3066\u304a\u3044\u305f\u30d7\u30ec\u30bc\u30f3\u30c8\u3092\u30e9\u30f3\u30c0\u30e0\u306b\u9078\u3093\u3067\u304f\u308c\u308b\u3068\u5c1a\u3088\u3044\u3067\u3059\u3002\n\nkintone\u306e\u6e96\u5099\n\u4eca\u56de\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b7\u30f3\u30d7\u30eb\u306a\u30a2\u30d7\u30ea\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\n\n\n\n\n\u30d5\u30a3\u30fc\u30eb\u30c9\u540d\n\u30d5\u30a3\u30fc\u30eb\u30c9\u30bf\u30a4\u30d7\n\u30d5\u30a3\u30fc\u30eb\u30c9\u30b3\u30fc\u30c9\n\u3000\u5099\u8003\n\n\n\n\n\u54c1\u540d\n\u6587\u5b57\u5217(1\u884c)\nitem\n\n\n\n\u5024\u6bb5\n\u6570\u5024\nprice\n\n\n\n\u8a73\u7d30\n\u6587\u5b57\u5217(\u8907\u6570\u884c)\u3000\u3000\u3000\u3000\u3000\ndetails\n\n\n\n\u30b9\u30c6\u30fc\u30bf\u30b9\n\u30e9\u30b8\u30aa\u30dc\u30bf\u30f3\nstatus\n\u9078\u629e\u80a2\u306f\u300c\u6e21\u3057\u3066\u306a\u3044\u300d\u300c\u6e21\u3057\u305f\u300d\n\n\n\u30ea\u30f3\u30af\n\u30ea\u30f3\u30af              \u3000\nitem_link\n\n\n\n\n\u8a66\u3057\u306b\u3044\u304f\u3064\u304b\u30d7\u30ec\u30bc\u30f3\u30c8\u3092\u767b\u9332\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u8ff7\u3063\u305f\u306e\u3067\u3001\u6700\u8fd1\u6d41\u884c\u308a\u306e\u54c1\u3005\u3092\u3002PPAP\u3002\n\n\u307e\u305f\u3001\u5f8c\u307b\u3069\u4f7f\u3046\u306e\u3067 \u30a2\u30d7\u30ea\u306e\u8a2d\u5b9a\u3092\u5909\u66f4 \u2192 \u8a2d\u5b9a \u2192 API\u30c8\u30fc\u30af\u30f3 \u3088\u308aAPI\u30c8\u30fc\u30af\u30f3\u3092\u767a\u884c\u3057\u3066\u304a\u304d\u307e\u3059\u3002\u53c2\u8003 \n\u30a2\u30af\u30bb\u30b9\u6a29\u306f\u3001\u300c\u30ec\u30b3\u30fc\u30c9\u95b2\u89a7\u300d\u300c\u30ec\u30b3\u30fc\u30c9\u8ffd\u52a0\u300d\u300c\u30ec\u30b3\u30fc\u30c9\u7de8\u96c6\u300d\u3092\u4e0e\u3048\u3066\u304a\u304d\u307e\u3059\u3002\n\n\nSlack\u306eBotKit\u306e\u6e96\u5099\n\u3053\u3061\u3089\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3001\u30b5\u30af\u30b5\u30af\u6e96\u5099\u3092\u9032\u3081\u307e\u3059\u3002\nBot creation page\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3001\u65b0\u3057\u3044bot\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u540d\u524d\u306f\u300ckintone_bot\u300d\u306b\u3057\u307e\u3057\u305f\u3002\n\n\u6b21\u306b\u3001npm\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u305f\u74b0\u5883\u3067\u3054\u306b\u3087\u3054\u306b\u3087\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n(node\u3084\u3089\u3082\u308d\u3082\u308d\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f\u304c\u3001\u74b0\u5883\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u306f\u5272\u611b\u3057\u307e\u3059\u3002)\n# mkdir /slack_work\n# cd /slack_work\n# git clone https://github.com/howdyai/botkit.git\n# cd botkit/\n# token='\u53d6\u5f97\u3057\u305f\u30c8\u30fc\u30af\u30f3' node slack_bot.js\n\n\u53c2\u8003\u8a18\u4e8b\u901a\u308a\u3001kintone_bot\u3092\u62db\u5f85\u3057\u3066\u6328\u62f6\u3057\u305f\u3089kintone_bot\u304c\u558b\u308a\u307e\u3057\u305f\u3063\uff01\uff01\n\n\u3053\u308c\u3067\u3082\u3061\u3087\u3063\u3068\u6e80\u8db3\u3057\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u3055\u3089\u306b\u6539\u9020\u3057\u3066kintone\u306e\u30c7\u30fc\u30bf\u3092\u4f7f\u3063\u3066\u558b\u3089\u305b\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nSlack\u306eBotKit\u3092\u3044\u3058\u3063\u3066\u307f\u308b\nBotkit\u3067Slack\u306eBot\u3092\u30b5\u30af\u30c3\u3068\u4f5c\u308b\u65b9\u6cd5\u3092\u53c2\u8003\u306b\u3001kintone\u9023\u643a bot\u3092\u4f5c\u3063\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u3084\u308a\u305f\u3044\u3053\u3068\u306f2\u3064\u3002\n\nkintone\u306b\u767b\u9332\u3057\u305f\u30d7\u30ec\u30bc\u30f3\u30c8\u3092\u30e9\u30f3\u30c0\u30e0\u3067\u9078\u3093\u3067\u30b5\u30b8\u30a7\u30b9\u30c8\u3057\u3066\u304f\u308c\u308b\u3002\n\u8d08\u3063\u305f\u30d7\u30ec\u30bc\u30f3\u30c8\u306f\u3001\u30d7\u30ec\u30bc\u30f3\u30c8\u540d\u3092\u8a9e\u308a\u304b\u3051\u308b\u3068\u300c\u6e21\u3057\u305f\u300d\u30d5\u30e9\u30b0\u66f4\u65b0\u3057\u3066\u304f\u308c\u308b\u3002\n\n\u6e96\u5099\u3068\u3057\u3066\u3001\u30d5\u30e9\u30b0\u66f4\u65b0\u306e\u969b\u306b\u30d7\u30ec\u30bc\u30f3\u30c8\u540d\u3092\u6307\u5b9a\u3057\u305f\u3044\u305f\u3081\u3001kintone\u5074\u3067\u30d5\u30a3\u30fc\u30eb\u30c9\u540d\u300c\u54c1\u540d\u300d\u306e\u5024\u306e\u91cd\u8907\u3092\u7981\u6b62\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u307e\u305f\u3001\u3053\u308c\u306b\u3088\u3063\u3066\u300c\u54c1\u540d\u300d\u3082\u305d\u308c\u305e\u308c\u30e6\u30cb\u30fc\u30af\u306a\u3082\u306e\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\nslack_bot.js\u3092\u7de8\u96c6\u3057\u3066kintone\u3068\u901a\u4fe1\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n:slack_bot.js\n/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n           ______     ______     ______   __  __     __     ______\n          /\\  == \\   /\\  __ \\   /\\__  _\\ /\\ \\/ /    /\\ \\   /\\__  _\\\n          \\ \\  __<   \\ \\ \\/\\ \\  \\/_/\\ \\/ \\ \\  _\"-.  \\ \\ \\  \\/_/\\ \\/\n           \\ \\_____\\  \\ \\_____\\    \\ \\_\\  \\ \\_\\ \\_\\  \\ \\_\\    \\ \\_\\\n            \\/_____/   \\/_____/     \\/_/   \\/_/\\/_/   \\/_/     \\/_/\n\n\nThis is a sample Slack bot built with Botkit.\n\nThis bot demonstrates many of the core features of Botkit:\n\n* Connect to Slack using the real time API\n* Receive messages based on \"spoken\" patterns\n* Reply to messages\n* Use the conversation system to ask questions\n* Use the built in storage system to store and retrieve information\n  for a user.\n\n# RUN THE BOT:\n\n  Get a Bot token from Slack:\n\n    -> http://my.slack.com/services/new/bot\n\n  Run your bot from the command line:\n\n    token=<MY TOKEN> node slack_bot.js\n\n# USE THE BOT:\n\n  Find your bot inside Slack to send it a direct message.\n\n  Say: \"Hello\"\n\n  The bot will reply \"Hello!\"\n\n  Say: \"who are you?\"\n\n  The bot will tell you its name, where it is running, and for how long.\n\n  Say: \"Call me <nickname>\"\n\n  Tell the bot your nickname. Now you are friends.\n\n  Say: \"who am I?\"\n\n  The bot will tell you your nickname, if it knows one for you.\n\n  Say: \"shutdown\"\n\n  The bot will ask if you are sure, and then shut itself down.\n\n  Make sure to invite your bot into other channels using /invite @<my bot>!\n\n# EXTEND THE BOT:\n\n  Botkit has many features for building cool and useful bots!\n\n  Read all about it here:\n\n    -> http://howdy.ai/botkit\n\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/\n\n\nif (!process.env.token) {\n    console.log('Error: Specify token in environment');\n    process.exit(1);\n}\n\nvar Botkit = require('./lib/Botkit.js');\nvar os = require('os');\nvar request = require('request');\nvar DOMAIN = 'your domain';\nvar APP_ID = 'app number';\nvar API_TOKEN = 'your API token';\nvar BASE_URL = 'https://' + DOMAIN + '/k/v1/';\nvar headers = {'X-Cybozu-API-Token': API_TOKEN}\nvar controller = Botkit.slackbot({\n    debug: true,\n});\nvar bot = controller.spawn({\n    token: process.env.token\n}).startRTM();\nvar myIds = [];\n\ncontroller.hears(['Choose a gift.'], 'direct_mention, mention', function(bot, message){\n    var query = 'give_status in (\"\u6e21\u3057\u3066\u306a\u3044\")'\n    var body_get = {\n      app: APP_ID,\n      query: query\n    }\n    var options_get = {\n      url: BASE_URL + 'records.json',\n      method: 'GET',\n      headers: headers,\n      'Content-Type': 'application/json',\n      json: body_get\n    }\n    request(options_get, function(error, response, body){\n      var records = body.records;\n      if(records.length > 0){\n        myIds = [];\n        for(var i = 0; i < records.length; i++){\n          myIds.push(i);\n        }\n        var myIndex = myIds[Math.floor(Math.random() * myIds.length)];\n        bot.reply(message, records[myIndex].my_item.value+'\u3092\u30d7\u30ec\u30bc\u30f3\u30c8\u3057\u307e\u3057\u3087\u3046\uff01 \\n \u30ea\u30f3\u30af:' + records[myIndex].item_link.value);\n      }else{\n        bot.reply(message, '\u4eca\u5e74\u306e\u30d7\u30ec\u30bc\u30f3\u30c8\u306f\u306a\u304f\u306a\u308a\u307e\u3057\u305f\u3002');\n      }\n    });\n});\n\ncontroller.hears(['I gave a present.'], 'direct_mention, mention', function(bot, message){\n  bot.startConversation(message, function(err, convo){\n    convo.ask('What is your item name ?', function(resp, convo){\n      var item_name = resp.text;\n      var body_update = {\n        app: APP_ID,\n        updateKey: {\n          \"field\":\"my_item\",\n          \"value\":item_name\n        },\n        record: {\n          \"give_status\" : {\n            \"value\" : \"\u6e21\u3057\u305f\"\n          }\n        }  \n      }\n      var option_put = {\n        url: BASE_URL + 'record.json',\n        method: 'PUT',\n        headers: headers,\n        'Content-Type': 'application/json',\n        json: body_update\n      }\n      request(option_put, function(error, response, body){\n        console.log(JSON.stringify(response));\n        if(response.statusCode == 200){\n          bot.reply(message, item_name + '\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u300c\u6e21\u3057\u305f\u300d\u306b\u5909\u66f4\u3057\u307e\u3057\u305f\uff01');\n        }else{\n          bot.reply(message, 'Error');\n        }\n        convo.stop();\n      });\n    });\n  });\n});\n\n\n\n\u30d7\u30ec\u30bc\u30f3\u30c8\u3092\u65e9\u901f\u9078\u3093\u3067\u307f\u308b\n\u3067\u306f\u3001\u65e9\u901f\u30d7\u30ec\u30bc\u30f3\u30c8\u3092\u9078\u3093\u3067\u307f\u307e\u3059\u3002\ntoken=\"your token\" node slack_bot.js \u3000\n\u3067bot\u3092\u8d77\u52d5\u5f8c\u3001Choose a gift.\u3068\u8a9e\u308a\u304b\u3051\u3066\u307f\u307e\u3059\u3002\n\n\u304a\u304a\u3063\u3002\u30e9\u30f3\u30c0\u30e0\u306b\u9078\u3079\u3066\u308b\u306e\u304b\u602a\u3057\u3044\u306e\u3067\u3082\u3046\u4e00\u5ea6\u30fb\u30fb\u30fb\n\n\u4eca\u5ea6\u306f\u30da\u30f3\u304c\u9078\u3070\u308c\u307e\u3057\u305f\u306d\u3002\n\u3053\u306e\u30da\u30f3\u306f\u65e9\u901f\u30d7\u30ec\u30bc\u30f3\u30c8\u3057\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u306e\u3067\u3001\u6e21\u3057\u305f\u30d5\u30e9\u30b0\u3092\u4ed8\u3051\u3066\u307f\u307e\u3059\u3002\nI gave a present.\u3068\u8a9e\u308a\u304b\u3051\u4f1a\u8a71\u3092\u697d\u3057\u307f\u307e\u3059\u3002\n\n\u30d5\u30e9\u30b0\u304c\u5909\u308f\u3063\u305f\u3063\u307d\u3044\u306e\u3067kintone\u3092\u307f\u3066\u307f\u307e\u3059\u3002\n\n\u7121\u4e8b\u306b\u30d5\u30e9\u30b0\u306e\u5909\u66f4\u304c\u3067\u304d\u307e\u3057\u305f\u3002\nPPAP\u266a\n\n\u6240\u611f\n\u306a\u304b\u306a\u304b\u697d\u3057\u304fkintone\u9023\u643a\u3067\u304d\u307e\u3057\u305f\u3002\n\u4eca\u5ea6\u306f\u3001Amazon Lex\u9023\u643a\u306a\u3093\u304b\u3082\u3084\u3063\u3066\u307f\u305f\u3044\u306a\u3041\u3068\u601d\u3044\u307e\u3059\u3002\n[kintone Advent Calendar 2016](http://qiita.com/advent-calendar/2016/kintone) \u306e24\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\n\u4eca\u591c\u306f\u30af\u30ea\u30b9\u30de\u30b9\u30a4\u30f4\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u30af\u30ea\u30b9\u30de\u30b9\u30d7\u30ec\u30bc\u30f3\u30c8\u3092\u4f55\u306b\u3059\u308b\u304b\u60a9\u3093\u3067\u3044\u308b\u4eba\u3082\u591a\u3044\u306e\u3067\u306f\u306a\u3044\u3067\u3057\u3087\u3046\u304b\uff1f\n\u79c1\u306f\u3001\u512a\u67d4\u4e0d\u65ad\u306a\u306e\u3067\u5168\u7136\u9078\u3079\u307e\u305b\u3093\u30fb\u30fb\u30fborz\n\n\u305d\u3093\u306a\u60a9\u3081\u308b\u65b9\u306b\u304a\u304f\u308bslack kintone \u9023\u643a\u3092\u8003\u3048\u3066\u307f\u307e\u3057\u305f\u3002\n\n#\u7406\u60f3\u5f62\n\u7406\u60f3\u5f62\u306f\u3001\u307e\u305a\u9069\u5f53\u306b\u30d4\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u305f\u3044\u304f\u3064\u304b\u306e\u5546\u54c1\u3092kintone\u306b\u3044\u308c\u3066\u304a\u304d\u307e\u3059\u3002\nslack\u3067\u300c\u30d7\u30ec\u30bc\u30f3\u30c8\u3092\u6c7a\u3081\u308b\u300d\u3068\u3064\u3076\u3084\u304f\u3068\u3001kintone\u306b\u5165\u308c\u3066\u304a\u3044\u305f\u30d7\u30ec\u30bc\u30f3\u30c8\u304b\u3089\u30e9\u30f3\u30c0\u30e0\u3067\u9078\u3093\u3067\u3068\u3063\u3066\u304d\u3066\u304f\u308c\u308bbot\u7684\u306a\u3084\u3064\u3092\u4f5c\u308d\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n![risou.png](https://qiita-image-store.s3.amazonaws.com/0/83679/b9a08622-ba5a-5637-4656-64891d6787d7.png)\n\n\u512a\u67d4\u4e0d\u65ad\u306a\u306e\u3067\u3001\u767b\u9332\u3057\u3066\u304a\u3044\u305f\u30d7\u30ec\u30bc\u30f3\u30c8\u3092\u30e9\u30f3\u30c0\u30e0\u306b\u9078\u3093\u3067\u304f\u308c\u308b\u3068\u5c1a\u3088\u3044\u3067\u3059\u3002\n\n#kintone\u306e\u6e96\u5099\n\u4eca\u56de\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b7\u30f3\u30d7\u30eb\u306a\u30a2\u30d7\u30ea\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\n![\u30d7\u30ec\u30bc\u30f3\u30c8capture.PNG](https://qiita-image-store.s3.amazonaws.com/0/83679/00d2534c-d7e6-888a-b92b-1e5b3467dbff.png)\n\n| \u30d5\u30a3\u30fc\u30eb\u30c9\u540d       |       \u30d5\u30a3\u30fc\u30eb\u30c9\u30bf\u30a4\u30d7 |    \u30d5\u30a3\u30fc\u30eb\u30c9\u30b3\u30fc\u30c9    | \u3000\u5099\u8003   |\n|:-----------------:|:------------------:|:------------------:|:------------------:|\n| \u54c1\u540d             |\u6587\u5b57\u5217(1\u884c)             |item        |        |\n| \u5024\u6bb5             |\u6570\u5024                    |price       |        |     \n| \u8a73\u7d30             |\u6587\u5b57\u5217(\u8907\u6570\u884c)\u3000\u3000\u3000\u3000\u3000 |details     |        |   \n| \u30b9\u30c6\u30fc\u30bf\u30b9       |\u30e9\u30b8\u30aa\u30dc\u30bf\u30f3            |status       |   \u9078\u629e\u80a2\u306f\u300c\u6e21\u3057\u3066\u306a\u3044\u300d\u300c\u6e21\u3057\u305f\u300d     |    \n| \u30ea\u30f3\u30af           |\u30ea\u30f3\u30af              \u3000 |item_link    |         |\n\n\u8a66\u3057\u306b\u3044\u304f\u3064\u304b\u30d7\u30ec\u30bc\u30f3\u30c8\u3092\u767b\u9332\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u8ff7\u3063\u305f\u306e\u3067\u3001\u6700\u8fd1\u6d41\u884c\u308a\u306e\u54c1\u3005\u3092\u3002PPAP\u3002\n![capture1.PNG](https://qiita-image-store.s3.amazonaws.com/0/83679/ca5dccf8-e11c-0085-b821-16efe63c3b52.png)\n\n\u307e\u305f\u3001\u5f8c\u307b\u3069\u4f7f\u3046\u306e\u3067 \u30a2\u30d7\u30ea\u306e\u8a2d\u5b9a\u3092\u5909\u66f4 \u2192 \u8a2d\u5b9a \u2192 API\u30c8\u30fc\u30af\u30f3 \u3088\u308aAPI\u30c8\u30fc\u30af\u30f3\u3092\u767a\u884c\u3057\u3066\u304a\u304d\u307e\u3059\u3002[\u53c2\u8003](https://help.cybozu.com/ja/k/user/api_token.html) \n\u30a2\u30af\u30bb\u30b9\u6a29\u306f\u3001\u300c\u30ec\u30b3\u30fc\u30c9\u95b2\u89a7\u300d\u300c\u30ec\u30b3\u30fc\u30c9\u8ffd\u52a0\u300d\u300c\u30ec\u30b3\u30fc\u30c9\u7de8\u96c6\u300d\u3092\u4e0e\u3048\u3066\u304a\u304d\u307e\u3059\u3002\n![apiToken.PNG](https://qiita-image-store.s3.amazonaws.com/0/83679/98ba2b19-02e8-946e-1b77-0a142ba4772f.png)\n\n#Slack\u306eBotKit\u306e\u6e96\u5099\n[\u3053\u3061\u3089](http://dotnsf.blog.jp/archives/1054134334.html)\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3001\u30b5\u30af\u30b5\u30af\u6e96\u5099\u3092\u9032\u3081\u307e\u3059\u3002\n[Bot creation page](https://my.slack.com/services/new/bot)\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3001\u65b0\u3057\u3044bot\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u540d\u524d\u306f\u300ckintone_bot\u300d\u306b\u3057\u307e\u3057\u305f\u3002\n![slack-bot.PNG](https://qiita-image-store.s3.amazonaws.com/0/83679/dda51245-5474-439a-0c45-68dbf55af808.png)\n\n\u6b21\u306b\u3001npm\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u305f\u74b0\u5883\u3067\u3054\u306b\u3087\u3054\u306b\u3087\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n(node\u3084\u3089\u3082\u308d\u3082\u308d\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f\u304c\u3001\u74b0\u5883\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u306f\u5272\u611b\u3057\u307e\u3059\u3002)\n\n```\n# mkdir /slack_work\n# cd /slack_work\n# git clone https://github.com/howdyai/botkit.git\n# cd botkit/\n# token='\u53d6\u5f97\u3057\u305f\u30c8\u30fc\u30af\u30f3' node slack_bot.js\n```\n\n\u53c2\u8003\u8a18\u4e8b\u901a\u308a\u3001kintone_bot\u3092\u62db\u5f85\u3057\u3066\u6328\u62f6\u3057\u305f\u3089kintone_bot\u304c\u558b\u308a\u307e\u3057\u305f\u3063\uff01\uff01\n![slack-kin-bot.PNG](https://qiita-image-store.s3.amazonaws.com/0/83679/b1a82eb4-6836-cefd-5e93-53c17059efaa.png)\n\n\u3053\u308c\u3067\u3082\u3061\u3087\u3063\u3068\u6e80\u8db3\u3057\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u3055\u3089\u306b\u6539\u9020\u3057\u3066kintone\u306e\u30c7\u30fc\u30bf\u3092\u4f7f\u3063\u3066\u558b\u3089\u305b\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n#Slack\u306eBotKit\u3092\u3044\u3058\u3063\u3066\u307f\u308b\n[Botkit\u3067Slack\u306eBot\u3092\u30b5\u30af\u30c3\u3068\u4f5c\u308b\u65b9\u6cd5](http://toach.click/slack-botkit/)\u3092\u53c2\u8003\u306b\u3001kintone\u9023\u643a bot\u3092\u4f5c\u3063\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u3084\u308a\u305f\u3044\u3053\u3068\u306f2\u3064\u3002\n\n- kintone\u306b\u767b\u9332\u3057\u305f\u30d7\u30ec\u30bc\u30f3\u30c8\u3092\u30e9\u30f3\u30c0\u30e0\u3067\u9078\u3093\u3067\u30b5\u30b8\u30a7\u30b9\u30c8\u3057\u3066\u304f\u308c\u308b\u3002\n- \u8d08\u3063\u305f\u30d7\u30ec\u30bc\u30f3\u30c8\u306f\u3001\u30d7\u30ec\u30bc\u30f3\u30c8\u540d\u3092\u8a9e\u308a\u304b\u3051\u308b\u3068\u300c\u6e21\u3057\u305f\u300d\u30d5\u30e9\u30b0\u66f4\u65b0\u3057\u3066\u304f\u308c\u308b\u3002\n\n\u6e96\u5099\u3068\u3057\u3066\u3001\u30d5\u30e9\u30b0\u66f4\u65b0\u306e\u969b\u306b\u30d7\u30ec\u30bc\u30f3\u30c8\u540d\u3092\u6307\u5b9a\u3057\u305f\u3044\u305f\u3081\u3001kintone\u5074\u3067\u30d5\u30a3\u30fc\u30eb\u30c9\u540d\u300c\u54c1\u540d\u300d\u306e\u5024\u306e\u91cd\u8907\u3092\u7981\u6b62\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n![cyoufuku-kinshi.PNG](https://qiita-image-store.s3.amazonaws.com/0/83679/30aa609c-e414-4c71-3faa-c548bb9778cc.png)\n\n\u307e\u305f\u3001\u3053\u308c\u306b\u3088\u3063\u3066\u300c\u54c1\u540d\u300d\u3082\u305d\u308c\u305e\u308c\u30e6\u30cb\u30fc\u30af\u306a\u3082\u306e\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n![index.PNG](https://qiita-image-store.s3.amazonaws.com/0/83679/85d1c281-6008-f416-6544-d8ac52086d81.png)\n\nslack_bot.js\u3092\u7de8\u96c6\u3057\u3066kintone\u3068\u901a\u4fe1\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```js\n:slack_bot.js\n/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n           ______     ______     ______   __  __     __     ______\n          /\\  == \\   /\\  __ \\   /\\__  _\\ /\\ \\/ /    /\\ \\   /\\__  _\\\n          \\ \\  __<   \\ \\ \\/\\ \\  \\/_/\\ \\/ \\ \\  _\"-.  \\ \\ \\  \\/_/\\ \\/\n           \\ \\_____\\  \\ \\_____\\    \\ \\_\\  \\ \\_\\ \\_\\  \\ \\_\\    \\ \\_\\\n            \\/_____/   \\/_____/     \\/_/   \\/_/\\/_/   \\/_/     \\/_/\n\n\nThis is a sample Slack bot built with Botkit.\n\nThis bot demonstrates many of the core features of Botkit:\n\n* Connect to Slack using the real time API\n* Receive messages based on \"spoken\" patterns\n* Reply to messages\n* Use the conversation system to ask questions\n* Use the built in storage system to store and retrieve information\n  for a user.\n\n# RUN THE BOT:\n\n  Get a Bot token from Slack:\n\n    -> http://my.slack.com/services/new/bot\n\n  Run your bot from the command line:\n\n    token=<MY TOKEN> node slack_bot.js\n\n# USE THE BOT:\n\n  Find your bot inside Slack to send it a direct message.\n\n  Say: \"Hello\"\n\n  The bot will reply \"Hello!\"\n\n  Say: \"who are you?\"\n\n  The bot will tell you its name, where it is running, and for how long.\n\n  Say: \"Call me <nickname>\"\n\n  Tell the bot your nickname. Now you are friends.\n\n  Say: \"who am I?\"\n\n  The bot will tell you your nickname, if it knows one for you.\n\n  Say: \"shutdown\"\n\n  The bot will ask if you are sure, and then shut itself down.\n\n  Make sure to invite your bot into other channels using /invite @<my bot>!\n\n# EXTEND THE BOT:\n\n  Botkit has many features for building cool and useful bots!\n\n  Read all about it here:\n\n    -> http://howdy.ai/botkit\n\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/\n\n\nif (!process.env.token) {\n    console.log('Error: Specify token in environment');\n    process.exit(1);\n}\n\nvar Botkit = require('./lib/Botkit.js');\nvar os = require('os');\nvar request = require('request');\nvar DOMAIN = 'your domain';\nvar APP_ID = 'app number';\nvar API_TOKEN = 'your API token';\nvar BASE_URL = 'https://' + DOMAIN + '/k/v1/';\nvar headers = {'X-Cybozu-API-Token': API_TOKEN}\nvar controller = Botkit.slackbot({\n    debug: true,\n});\nvar bot = controller.spawn({\n    token: process.env.token\n}).startRTM();\nvar myIds = [];\n\ncontroller.hears(['Choose a gift.'], 'direct_mention, mention', function(bot, message){\n    var query = 'give_status in (\"\u6e21\u3057\u3066\u306a\u3044\")'\n    var body_get = {\n      app: APP_ID,\n      query: query\n    }\n    var options_get = {\n      url: BASE_URL + 'records.json',\n      method: 'GET',\n      headers: headers,\n      'Content-Type': 'application/json',\n      json: body_get\n    }\n    request(options_get, function(error, response, body){\n      var records = body.records;\n      if(records.length > 0){\n        myIds = [];\n        for(var i = 0; i < records.length; i++){\n          myIds.push(i);\n        }\n        var myIndex = myIds[Math.floor(Math.random() * myIds.length)];\n        bot.reply(message, records[myIndex].my_item.value+'\u3092\u30d7\u30ec\u30bc\u30f3\u30c8\u3057\u307e\u3057\u3087\u3046\uff01 \\n \u30ea\u30f3\u30af:' + records[myIndex].item_link.value);\n      }else{\n        bot.reply(message, '\u4eca\u5e74\u306e\u30d7\u30ec\u30bc\u30f3\u30c8\u306f\u306a\u304f\u306a\u308a\u307e\u3057\u305f\u3002');\n      }\n    });\n});\n\ncontroller.hears(['I gave a present.'], 'direct_mention, mention', function(bot, message){\n  bot.startConversation(message, function(err, convo){\n    convo.ask('What is your item name ?', function(resp, convo){\n      var item_name = resp.text;\n      var body_update = {\n        app: APP_ID,\n        updateKey: {\n          \"field\":\"my_item\",\n          \"value\":item_name\n        },\n        record: {\n          \"give_status\" : {\n            \"value\" : \"\u6e21\u3057\u305f\"\n          }\n        }  \n      }\n      var option_put = {\n        url: BASE_URL + 'record.json',\n        method: 'PUT',\n        headers: headers,\n        'Content-Type': 'application/json',\n        json: body_update\n      }\n      request(option_put, function(error, response, body){\n        console.log(JSON.stringify(response));\n        if(response.statusCode == 200){\n          bot.reply(message, item_name + '\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u300c\u6e21\u3057\u305f\u300d\u306b\u5909\u66f4\u3057\u307e\u3057\u305f\uff01');\n        }else{\n          bot.reply(message, 'Error');\n        }\n        convo.stop();\n      });\n    });\n  });\n});\n\n```\n\n#\u30d7\u30ec\u30bc\u30f3\u30c8\u3092\u65e9\u901f\u9078\u3093\u3067\u307f\u308b\n\u3067\u306f\u3001\u65e9\u901f\u30d7\u30ec\u30bc\u30f3\u30c8\u3092\u9078\u3093\u3067\u307f\u307e\u3059\u3002\n`token=\"your token\" node slack_bot.js` \u3000\n\u3067bot\u3092\u8d77\u52d5\u5f8c\u3001Choose a gift.\u3068\u8a9e\u308a\u304b\u3051\u3066\u307f\u307e\u3059\u3002\n![choose-gifts.PNG](https://qiita-image-store.s3.amazonaws.com/0/83679/f9631680-e6c2-eada-99df-26500e5ca87f.png)\n\n\n\u304a\u304a\u3063\u3002\u30e9\u30f3\u30c0\u30e0\u306b\u9078\u3079\u3066\u308b\u306e\u304b\u602a\u3057\u3044\u306e\u3067\u3082\u3046\u4e00\u5ea6\u30fb\u30fb\u30fb\n![choose-pip.PNG](https://qiita-image-store.s3.amazonaws.com/0/83679/7cb1996a-d201-97d8-cf8f-dc503214506e.png)\n\n\u4eca\u5ea6\u306f\u30da\u30f3\u304c\u9078\u3070\u308c\u307e\u3057\u305f\u306d\u3002\n\u3053\u306e\u30da\u30f3\u306f\u65e9\u901f\u30d7\u30ec\u30bc\u30f3\u30c8\u3057\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u306e\u3067\u3001\u6e21\u3057\u305f\u30d5\u30e9\u30b0\u3092\u4ed8\u3051\u3066\u307f\u307e\u3059\u3002\nI gave a present.\u3068\u8a9e\u308a\u304b\u3051\u4f1a\u8a71\u3092\u697d\u3057\u307f\u307e\u3059\u3002\n![flag-change.PNG](https://qiita-image-store.s3.amazonaws.com/0/83679/0a77283e-0793-00bf-22de-c5f681b098fa.png)\n\n\u30d5\u30e9\u30b0\u304c\u5909\u308f\u3063\u305f\u3063\u307d\u3044\u306e\u3067kintone\u3092\u307f\u3066\u307f\u307e\u3059\u3002\n![kintone.PNG](https://qiita-image-store.s3.amazonaws.com/0/83679/94b2a74a-98b8-643e-f719-b8ba7f54b56a.png)\n\n\u7121\u4e8b\u306b\u30d5\u30e9\u30b0\u306e\u5909\u66f4\u304c\u3067\u304d\u307e\u3057\u305f\u3002\nPPAP\u266a\n\n#\u6240\u611f\n\u306a\u304b\u306a\u304b\u697d\u3057\u304fkintone\u9023\u643a\u3067\u304d\u307e\u3057\u305f\u3002\n\u4eca\u5ea6\u306f\u3001[Amazon Lex](https://aws.amazon.com/jp/lex/)\u9023\u643a\u306a\u3093\u304b\u3082\u3084\u3063\u3066\u307f\u305f\u3044\u306a\u3041\u3068\u601d\u3044\u307e\u3059\u3002\n"}