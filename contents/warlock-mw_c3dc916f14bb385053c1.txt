{"context": " More than 1 year has passed since last update.Hadoop \u3068 HBase \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u3067\u304d\u305f\u306e\u3067\u3001\nThrift \u3092\u5165\u308c\u3066 PHP \u3067 HBase \u306e\u30c7\u30fc\u30bf\u3092\u8868\u793a\u3055\u305b\u3066\u307f\u308b\n\n\u4f9d\u5b58\u30e9\u30a4\u30d6\u30e9\u30ea\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nyum\n # yum install -y automake libtool flex pkgconfig gcc-c++ boost-devel libevent-devel zlib-devel python-devel ruby-devel\n\n\n\u30b3\u30f3\u30d1\u30a4\u30eb\nyum \u3067 bison \u3092\u5165\u308c\u308b\u3068\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u4f4e\u3044\u305f\u3081\u3001\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\nshell-session\n # wget -P /usr/local/src http://ftp.gnu.org/gnu/bison/bison-3.0.2.tar.gz\n # tar zxvf /usr/local/src/bison-3.0.2.tar.gz -C /usr/local/src\n # cd /usr/local/src/bison-3.0.2\n # ./configure\n # make\n # make install\n\n\nThrift \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ngit \u3092\u4f7f\u7528\u3059\u308b\u516c\u5f0f\u306e\u624b\u9806\u3067\u306f\u3001\nconfigure \u3067 Makefile.in \u304c\u7121\u3044\u3068\u304b\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u305f\u3081\u3001\ntar.gz \u3092\u843d\u3068\u3057\u3001\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\nshell-session\n # wget -P /usr/loca/src http://ftp.kddilabs.jp/infosystems/apache/thrift/0.9.1/thrift-0.9.1.tar.gz\n # tar zxvf /usr/local/src/thrift-0.9.1.tar.gz -C /usr/local/src\n # cd /usr/local/src/thrift-0.9.1\n # ./configure\n # make\n\nmake \u3067\u3053\u3051\u308b\u30fb\u30fb\u30fbC++ \u3069\u3046\u306e\u3053\u3046\u306e\u8a00\u3063\u3066\u308b\u30fb\u30fb\u30fb\n\u9014\u65b9\u306b\u66ae\u308c\u3001\u30c0\u30e1\u5143\u3067 make \u3067\u3053\u3051\u305f\u76f4\u5f8c\u306b\u9023\u7d9a\u3067 make\uff01\nshell-session\n # make\n\n\u4f55\u6545\u304b\u901a\u3063\u305fw\u4f55\u3053\u308cw\nshell-session\n # make install\n\nwhich \u3067\u78ba\u8a8d\u3057\u305f\u3068\u3053\u308d\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u3066\u308b\u3088\u3046\u3060\n\u52d5\u304f\u304b\u602a\u3057\u3044\u306e\u3067\u30c6\u30b9\u30c8\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u4f5c\u6210\u3057\u3066\u307f\u308b\nHBase \u3092\u5c55\u958b\u3057\u305f\u30d5\u30a9\u30eb\u30c0\u304b\u3089\u3001\u30d5\u30a1\u30a4\u30eb\u3092\u30d1\u30af\u3063\u3066\u304f\u308b\nshell-session\n # mkdir /usr/local/src/tmp\n # cp /usr/local/src/hbase-0.98.4/hbase-thrift/src/main/resources/org/apache/hadoop/hbase/thrift/Hbase.thrift /usr/local/src/tmp/\n # cd /usr/local/src/tmp\n # thrift -gen php Hbase.thrift\n\ngen-php/Hbase/ \u5185\u306b\u3001Hbase.php, Types.php \u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308c\u3070\u3001\u30aa\u30c3\u30b1\u30fc\nThrift \u3092\u5c55\u958b\u3057\u305f\u30d5\u30a9\u30eb\u30c0\u304b\u3089\u3001PHP \u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30b3\u30d4\u30fc\nshell-session\n # cp /usr/local/src/thrift-0.9.1/lib/php/lib/Thrift /usr/local/src/tmp/gen-php/Hbase/\n\n\u4f5c\u6210\u3059\u308b\u6e96\u5099\u304c\u5b8c\u4e86\u3057\u305f\u306e\u3067\u3001\u30c6\u30b9\u30c8\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u4f5c\u6210\u3059\u308b\nHBase \u306b tbl \u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3057\u3001\u9069\u5f53\u306a\u30d5\u30a1\u30df\u30ea\u30fc\u30fb\u30ab\u30e9\u30e0\u306b\u30c7\u30fc\u30bf\u3092\u7a81\u3063\u8fbc\u3093\u3067\u304a\u304f\n/usr/local/src/tmp/gen-php/Hbase/test.php \n\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f(\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059)\nphp\nfunction autoload($className)\n{\n    $className = ltrim($className, '\\\\');\n    $fileName  = '';\n    $namespace = '';\n    if($lastNsPos = strrpos($className, '\\\\')) {\n        $namespace = substr($className, 0, $lastNsPos);\n        $className = substr($className, $lastNsPos + 1);\n        $fileName  = str_replace('\\\\', DIRECTORY_SEPARATOR, $namespace) . DIRECTORY_SEPARATOR;\n    }\n    $fileName .= str_replace('_', DIRECTORY_SEPARATOR, $className) . '.php';\n    require $fileName;\n}\nspl_autoload_register('autoload');\ninclude 'Hbase.php';\ninclude 'Types.php';\nuse \\Thrift\\Transport\\TSocket;\nuse \\Thrift\\Transport\\TBufferedTransport;\nuse \\Thrift\\Protocol\\TBinaryProtocol;\nuse Hbase\\HbaseClient;\nuse Hbase\\ColumnDescriptor;\nuse Hbase\\Mutation;\nuse Hbase\\TScan;\n$server = 'localhost';\n$port = 9090;\ntry {\n    $socket = new TSocket($server, $port);\n    $socket->setRecvTimeout(5000);\n    $transport = new TBufferedTransport($socket);\n    $protocol = new TBinaryProtocol($transport);\n    $client = new HbaseClient($protocol);\n    $transport->open();\n    var_dump($client->getTableNames());\n    $scan = new TScan();\n    $scan = $client->scannerOpenWithScan('tbl', $scan, null);\n    var_dump($client->scannerGetList($scan, 2));\n} catch (TException $e) {\n    error_log('TException');\n    error_log($e);\n} catch (Exception $e) {\n    error_log('Exception');\n    error_log($e);\n}\n\nQiita \u306b\u30af\u30e9\u30b9\u8f09\u305b\u308b\u6642\u3001\u3069\u3046\u3084\u3063\u305f\u3089\u7dba\u9e97\u306b\u306a\u308b\u3093\u3060\u30fb\u30fb\u30fb\n\u5b9f\u884c\nshell-session\n # php test.php\n\n\u7d50\u679c\ntext\narray(1) {\n  [0]=>\n  string(3) \"tbl\"\n}\narray(2) {\n  [0]=>\n  object(Hbase\\TRowResult)#7 (3) {\n    [\"row\"]=>\n    string(5) \"test1\"\n    [\"columns\"]=>\n    array(3) {\n      [\"family:c1\"]=>\n      object(Hbase\\TCell)#9 (2) {\n        [\"value\"]=>\n        string(2) \"v1\"\n        [\"timestamp\"]=>\n        int(1407204133668)\n      }\n      [\"family:c2\"]=>\n      object(Hbase\\TCell)#10 (2) {\n        [\"value\"]=>\n        string(2) \"v2\"\n        [\"timestamp\"]=>\n        int(1407204189821)\n      }\n      [\"family:c3\"]=>\n      object(Hbase\\TCell)#11 (2) {\n        [\"value\"]=>\n        string(2) \"v3\"\n        [\"timestamp\"]=>\n        int(1407204289202)\n      }\n    }\n    [\"sortedColumns\"]=>\n    NULL\n  }\n  [1]=>\n  object(Hbase\\TRowResult)#8 (3) {\n    [\"row\"]=>\n    string(5) \"test2\"\n    [\"columns\"]=>\n    array(1) {\n      [\"family:c1\"]=>\n      object(Hbase\\TCell)#13 (2) {\n        [\"value\"]=>\n        string(2) \"v1\"\n        [\"timestamp\"]=>\n        int(1407204303127)\n      }\n    }\n    [\"sortedColumns\"]=>\n    NULL\n  }\n\n\u3053\u3093\u306a\u304b\u3093\u3058\u3067\u51fa\u529b\u3055\u308c\u308c\u3070\u3001\u5b8c\u4e86\n\u30e9\u30a4\u30d6\u30e9\u30ea\u306b Thrift2 \u3063\u3066\u3042\u3063\u305f\u3051\u3069\u3001\u307e\u3063\u305f\u304f\u4f7f\u3044\u65b9\u5206\u304b\u3089\u3093w\n\u6b21\u306f Hadoop 2 \u53f0\u69cb\u6210\u3067\u30b5\u30fc\u30d0\u30fc\u69cb\u7bc9\u3057\u3066\u307f\u3088\u3046\u304b\u306a\nHadoop \u3068 HBase \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u3067\u304d\u305f\u306e\u3067\u3001\nThrift \u3092\u5165\u308c\u3066 PHP \u3067 HBase \u306e\u30c7\u30fc\u30bf\u3092\u8868\u793a\u3055\u305b\u3066\u307f\u308b\n\n#\u4f9d\u5b58\u30e9\u30a4\u30d6\u30e9\u30ea\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n###yum\n```shell-session\n # yum install -y automake libtool flex pkgconfig gcc-c++ boost-devel libevent-devel zlib-devel python-devel ruby-devel\n```\n\n###\u30b3\u30f3\u30d1\u30a4\u30eb\nyum \u3067 bison \u3092\u5165\u308c\u308b\u3068\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u4f4e\u3044\u305f\u3081\u3001\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\n```shell-session\n # wget -P /usr/local/src http://ftp.gnu.org/gnu/bison/bison-3.0.2.tar.gz\n # tar zxvf /usr/local/src/bison-3.0.2.tar.gz -C /usr/local/src\n # cd /usr/local/src/bison-3.0.2\n # ./configure\n # make\n # make install\n```\n\n# Thrift \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ngit \u3092\u4f7f\u7528\u3059\u308b[\u516c\u5f0f](http://thrift.apache.org/docs/install/centos)\u306e\u624b\u9806\u3067\u306f\u3001\nconfigure \u3067 Makefile.in \u304c\u7121\u3044\u3068\u304b\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u305f\u3081\u3001\ntar.gz \u3092\u843d\u3068\u3057\u3001\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\n```shell-session\n # wget -P /usr/loca/src http://ftp.kddilabs.jp/infosystems/apache/thrift/0.9.1/thrift-0.9.1.tar.gz\n # tar zxvf /usr/local/src/thrift-0.9.1.tar.gz -C /usr/local/src\n # cd /usr/local/src/thrift-0.9.1\n # ./configure\n # make\n```\n\nmake \u3067\u3053\u3051\u308b\u30fb\u30fb\u30fbC++ \u3069\u3046\u306e\u3053\u3046\u306e\u8a00\u3063\u3066\u308b\u30fb\u30fb\u30fb\n\u9014\u65b9\u306b\u66ae\u308c\u3001\u30c0\u30e1\u5143\u3067 make \u3067\u3053\u3051\u305f\u76f4\u5f8c\u306b\u9023\u7d9a\u3067 make\uff01\n```shell-session\n # make\n```\n\n\u4f55\u6545\u304b\u901a\u3063\u305fw\u4f55\u3053\u308cw\n```shell-session\n # make install\n```\n\nwhich \u3067\u78ba\u8a8d\u3057\u305f\u3068\u3053\u308d\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u3066\u308b\u3088\u3046\u3060\n\u52d5\u304f\u304b\u602a\u3057\u3044\u306e\u3067\u30c6\u30b9\u30c8\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u4f5c\u6210\u3057\u3066\u307f\u308b\n\nHBase \u3092\u5c55\u958b\u3057\u305f\u30d5\u30a9\u30eb\u30c0\u304b\u3089\u3001\u30d5\u30a1\u30a4\u30eb\u3092\u30d1\u30af\u3063\u3066\u304f\u308b\n```shell-session\n # mkdir /usr/local/src/tmp\n # cp /usr/local/src/hbase-0.98.4/hbase-thrift/src/main/resources/org/apache/hadoop/hbase/thrift/Hbase.thrift /usr/local/src/tmp/\n # cd /usr/local/src/tmp\n # thrift -gen php Hbase.thrift\n```\ngen-php/Hbase/ \u5185\u306b\u3001Hbase.php, Types.php \u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308c\u3070\u3001\u30aa\u30c3\u30b1\u30fc\n\nThrift \u3092\u5c55\u958b\u3057\u305f\u30d5\u30a9\u30eb\u30c0\u304b\u3089\u3001PHP \u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30b3\u30d4\u30fc\n```shell-session\n # cp /usr/local/src/thrift-0.9.1/lib/php/lib/Thrift /usr/local/src/tmp/gen-php/Hbase/\n```\n\n\u4f5c\u6210\u3059\u308b\u6e96\u5099\u304c\u5b8c\u4e86\u3057\u305f\u306e\u3067\u3001\u30c6\u30b9\u30c8\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u4f5c\u6210\u3059\u308b\nHBase \u306b tbl \u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3057\u3001\u9069\u5f53\u306a\u30d5\u30a1\u30df\u30ea\u30fc\u30fb\u30ab\u30e9\u30e0\u306b\u30c7\u30fc\u30bf\u3092\u7a81\u3063\u8fbc\u3093\u3067\u304a\u304f\n/usr/local/src/tmp/gen-php/Hbase/test.php \n[\u53c2\u8003](http://d.hatena.ne.jp/shimooka/20130828/1377686595)\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f(\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059)\n```php\nfunction autoload($className)\n{\n    $className = ltrim($className, '\\\\');\n    $fileName  = '';\n    $namespace = '';\n    if($lastNsPos = strrpos($className, '\\\\')) {\n        $namespace = substr($className, 0, $lastNsPos);\n        $className = substr($className, $lastNsPos + 1);\n        $fileName  = str_replace('\\\\', DIRECTORY_SEPARATOR, $namespace) . DIRECTORY_SEPARATOR;\n    }\n    $fileName .= str_replace('_', DIRECTORY_SEPARATOR, $className) . '.php';\n    require $fileName;\n}\nspl_autoload_register('autoload');\ninclude 'Hbase.php';\ninclude 'Types.php';\nuse \\Thrift\\Transport\\TSocket;\nuse \\Thrift\\Transport\\TBufferedTransport;\nuse \\Thrift\\Protocol\\TBinaryProtocol;\nuse Hbase\\HbaseClient;\nuse Hbase\\ColumnDescriptor;\nuse Hbase\\Mutation;\nuse Hbase\\TScan;\n$server = 'localhost';\n$port = 9090;\ntry {\n    $socket = new TSocket($server, $port);\n    $socket->setRecvTimeout(5000);\n    $transport = new TBufferedTransport($socket);\n    $protocol = new TBinaryProtocol($transport);\n    $client = new HbaseClient($protocol);\n    $transport->open();\n    var_dump($client->getTableNames());\n    $scan = new TScan();\n    $scan = $client->scannerOpenWithScan('tbl', $scan, null);\n    var_dump($client->scannerGetList($scan, 2));\n} catch (TException $e) {\n    error_log('TException');\n    error_log($e);\n} catch (Exception $e) {\n    error_log('Exception');\n    error_log($e);\n}\n```\nQiita \u306b\u30af\u30e9\u30b9\u8f09\u305b\u308b\u6642\u3001\u3069\u3046\u3084\u3063\u305f\u3089\u7dba\u9e97\u306b\u306a\u308b\u3093\u3060\u30fb\u30fb\u30fb\n\n\u5b9f\u884c\n```shell-session\n # php test.php\n```\n\n\u7d50\u679c\n```text\narray(1) {\n  [0]=>\n  string(3) \"tbl\"\n}\narray(2) {\n  [0]=>\n  object(Hbase\\TRowResult)#7 (3) {\n    [\"row\"]=>\n    string(5) \"test1\"\n    [\"columns\"]=>\n    array(3) {\n      [\"family:c1\"]=>\n      object(Hbase\\TCell)#9 (2) {\n        [\"value\"]=>\n        string(2) \"v1\"\n        [\"timestamp\"]=>\n        int(1407204133668)\n      }\n      [\"family:c2\"]=>\n      object(Hbase\\TCell)#10 (2) {\n        [\"value\"]=>\n        string(2) \"v2\"\n        [\"timestamp\"]=>\n        int(1407204189821)\n      }\n      [\"family:c3\"]=>\n      object(Hbase\\TCell)#11 (2) {\n        [\"value\"]=>\n        string(2) \"v3\"\n        [\"timestamp\"]=>\n        int(1407204289202)\n      }\n    }\n    [\"sortedColumns\"]=>\n    NULL\n  }\n  [1]=>\n  object(Hbase\\TRowResult)#8 (3) {\n    [\"row\"]=>\n    string(5) \"test2\"\n    [\"columns\"]=>\n    array(1) {\n      [\"family:c1\"]=>\n      object(Hbase\\TCell)#13 (2) {\n        [\"value\"]=>\n        string(2) \"v1\"\n        [\"timestamp\"]=>\n        int(1407204303127)\n      }\n    }\n    [\"sortedColumns\"]=>\n    NULL\n  }\n```\n\u3053\u3093\u306a\u304b\u3093\u3058\u3067\u51fa\u529b\u3055\u308c\u308c\u3070\u3001\u5b8c\u4e86\n\n\u30e9\u30a4\u30d6\u30e9\u30ea\u306b Thrift2 \u3063\u3066\u3042\u3063\u305f\u3051\u3069\u3001\u307e\u3063\u305f\u304f\u4f7f\u3044\u65b9\u5206\u304b\u3089\u3093w\n\u6b21\u306f Hadoop 2 \u53f0\u69cb\u6210\u3067\u30b5\u30fc\u30d0\u30fc\u69cb\u7bc9\u3057\u3066\u307f\u3088\u3046\u304b\u306a\n", "tags": ["HBase", "hadoop", "thrift"]}