{"context": "\u524d\u56de\nfluentd\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066Rails\u306e\u30ed\u30b0\u3092\u898b\u3084\u3059\u304f\u3059\u308b\uff08\u524d\u7de8\uff09\n\nfluentd\u3068td-agent\u306e\u9055\u3044\nfluentd\u3068td-agent\u306e\u9055\u3044\n-\u3000td-agent\u306fFluentd\u306e\u5b89\u5b9a\u7248\n-\u3000gem install\u3059\u308b\u306e\u306fFluentd\u3001RPM\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306e\u306ftd-agent\n-\u3000gem install\u3067\u3082RPM\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3082fluent-cat\u304c\u540c\u68b1\u3055\u308c\u308b\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\nRPM\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ncurl -L https://toolbelt.treasuredata.com/sh/install-redhat-td-agent2.sh | sh\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u78ba\u8a8d\n\n$ td-agent --version\ntd-agent 0.12.29\n\n\u5b9f\u884c\u30e6\u30fc\u30b6\u306e\u5909\u66f4\n$ vi /etc/td-agent/td-agent.conf\n- TD_AGENT_USER=td-agent\n- TD_AGENT_GROUP=td-agent\n+ TD_AGENT_USER=root\n+ TD_AGENT_GROUP=root\n\n\n\u8d77\u52d5\u3001\u30ea\u30ed\u30fc\u30c9\u3001\u505c\u6b62\n$sudo service td-agent start\n$sudo service td-agent reload\n$sudo service td-agent stop\n\nfluent-cat\u306e\u4f7f\u3044\u65b9\n\nfluent-cat\u306e\u5834\u6240\n/opt/td-agent/embedded/bin/fluent-cat\n\n\u74b0\u5883\u5909\u6570\u306b\u8ffd\u52a0\nexport PATH=$PATH:/opt/td-agent/embedded/bin/\n\n\u30ed\u30b0\u51fa\u529b\u30c6\u30b9\u30c8\necho '{\"first\":\"hello\"}' | fluent-cat debug.test\n\n\u6b8b\u308a\u30bf\u30b9\u30af\n\ngem install fluent-plugin-rewrite\n\n$ vi /vagrant/config/environments/development.rb\u8a2d\u5b9a\u5909\u66f4\n\n\nconfig.logger = Logger.new(config.paths[\"log\"].first)\nconfig.logger.formatter = Logger::Formatter.new\n\n\n\n$ vi /vagrant/config/environment.rb\u8a2d\u5b9a\u5909\u66f4\uff08*1\uff09\n\n/etc/td-agent/td-agent.conf\u8a2d\u5b9a\u5909\u66f4\uff08<source><match>\u8ffd\u52a0\uff09\n\u30ed\u30b0\u78ba\u8a8d\n\n*1\nclass Logger\n  class Formatter\n    def call(severity, time, progname, msg)\n      if msg.class.to_s == \"String\"\n        msg = msg.gsub(/\\n/, \"\")\n        if msg.present? && !msg.include?(\"assets\") && !msg.include?(\"erb\")\n          format = \"[%s %d] %5s -- %s: \\'%s\\'\\n\"\n          format % [\"#{time.strftime('%Y-%m-%d %H:%M:%S')}.#{'%06d' % time.usec.to_s}\",$$, severity, progname, msg2str(msg)]\n        end\n      end\n    end\n  end\nend \n\n\u524d\u56de\n[fluentd\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066Rails\u306e\u30ed\u30b0\u3092\u898b\u3084\u3059\u304f\u3059\u308b\uff08\u524d\u7de8\uff09](http://qiita.com/fk_2000/items/d9577b182bed5f06c960)\n\n# fluentd\u3068td-agent\u306e\u9055\u3044\n[fluentd\u3068td-agent\u306e\u9055\u3044](http://tsunokawa.hatenablog.com/entry/20120723/p1)\n\n-\u3000td-agent\u306fFluentd\u306e\u5b89\u5b9a\u7248\n-\u3000gem install\u3059\u308b\u306e\u306fFluentd\u3001RPM\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306e\u306ftd-agent\n-\u3000gem install\u3067\u3082RPM\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3082fluent-cat\u304c\u540c\u68b1\u3055\u308c\u308b\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\n\nRPM\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n`curl -L https://toolbelt.treasuredata.com/sh/install-redhat-td-agent2.sh | sh`\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u78ba\u8a8d\n```\n$ td-agent --version\ntd-agent 0.12.29\n```\n\n\u5b9f\u884c\u30e6\u30fc\u30b6\u306e\u5909\u66f4\n`$ vi /etc/td-agent/td-agent.conf`\n\n\n```diff:\n- TD_AGENT_USER=td-agent\n- TD_AGENT_GROUP=td-agent\n+ TD_AGENT_USER=root\n+ TD_AGENT_GROUP=root\n```\n\n# \u8d77\u52d5\u3001\u30ea\u30ed\u30fc\u30c9\u3001\u505c\u6b62\n\n`$sudo service td-agent start`\n`$sudo service td-agent reload`\n`$sudo service td-agent stop`\n\n# fluent-cat\u306e\u4f7f\u3044\u65b9\n\n## fluent-cat\u306e\u5834\u6240\n\n`/opt/td-agent/embedded/bin/fluent-cat`\n\n## \u74b0\u5883\u5909\u6570\u306b\u8ffd\u52a0\n`export PATH=$PATH:/opt/td-agent/embedded/bin/`\n\n## \u30ed\u30b0\u51fa\u529b\u30c6\u30b9\u30c8\n`echo '{\"first\":\"hello\"}' | fluent-cat debug.test`\n\n## \u6b8b\u308a\u30bf\u30b9\u30af\n- `gem install fluent-plugin-rewrite`\n- `$ vi /vagrant/config/environments/development.rb`\u8a2d\u5b9a\u5909\u66f4\n    - config.logger = Logger.new(config.paths[\"log\"].first)\n    - config.logger.formatter = Logger::Formatter.new\n- `$ vi /vagrant/config/environment.rb`\u8a2d\u5b9a\u5909\u66f4\uff08*1\uff09\n- `/etc/td-agent/td-agent.conf`\u8a2d\u5b9a\u5909\u66f4\uff08&lt;source&gt;&lt;match&gt;\u8ffd\u52a0\uff09\n- \u30ed\u30b0\u78ba\u8a8d\n\n*1\n\n```\nclass Logger\n  class Formatter\n    def call(severity, time, progname, msg)\n      if msg.class.to_s == \"String\"\n        msg = msg.gsub(/\\n/, \"\")\n        if msg.present? && !msg.include?(\"assets\") && !msg.include?(\"erb\")\n          format = \"[%s %d] %5s -- %s: \\'%s\\'\\n\"\n          format % [\"#{time.strftime('%Y-%m-%d %H:%M:%S')}.#{'%06d' % time.usec.to_s}\",$$, severity, progname, msg2str(msg)]\n        end\n      end\n    end\n  end\nend \n``` \n\n\n", "tags": ["RubyOnRails", "fluentd", "td-agent"]}