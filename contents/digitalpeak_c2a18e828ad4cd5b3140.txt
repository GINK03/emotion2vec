{"context": "\n\n\u76ee\u7684\n\n\u6a19\u6e96\u30e1\u30c8\u30ea\u30c3\u30af\u4ee5\u5916\u306e\u30e1\u30c8\u30ea\u30c3\u30af\u3092\u53d6\u5f97\u3059\u308b\n\n\nApache\u306e\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30c3\u30af\u3092\u53d6\u5f97\u3059\u308b\n\n\n\n\n\u65b9\u6cd5\n\nMackerel\u516c\u5f0fPlugin\u3092\u4f7f\u7528\n\n\n\nmackerel-agent-plugins\n\n\nREADME\u3092\u898b\u3066\u3001\u74b0\u5883\u6bce\u306b\u8a2d\u5b9a\u3059\u308b\n\n\n\n\n\n\n\u78ba\u8a8d\n\n\u30b7\u30b9\u30c6\u30e0\u30e1\u30c8\u30ea\u30c3\u30af\n\n# curl -X GET -H \"X-Api-Key: *************\" https://mackerel.io/api/v0/hosts/******/metric-names | jq '.'\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100   839  100   839    0     0   4801      0 --:--:-- --:--:-- --:--:--  4821\n{\n  \"names\": [\n    \"cpu.guest.percentage\",\n    \"cpu.idle.percentage\",\n    \"cpu.iowait.percentage\",\n    \"cpu.irq.percentage\",\n    \"cpu.nice.percentage\",\n    \"cpu.softirq.percentage\",\n    \"cpu.steal.percentage\",\n    \"cpu.system.percentage\",\n    \"cpu.user.percentage\",\n    \"disk.xvda.reads.delta\",\n    \"disk.xvda.writes.delta\",\n    \"disk.xvda1.reads.delta\",\n    \"disk.xvda1.writes.delta\",\n    \"filesystem.xvda1.size\",\n    \"filesystem.xvda1.used\",\n    \"interface.eth0.rxBytes.delta\",\n    \"interface.eth0.txBytes.delta\",\n    \"loadavg5\",\n    \"memory.active\",\n    \"memory.available\",\n    \"memory.buffers\",\n    \"memory.cached\",\n    \"memory.free\",\n    \"memory.inactive\",\n    \"memory.swap_cached\",\n    \"memory.swap_free\",\n    \"memory.swap_total\",\n    \"memory.total\",\n    \"memory.used\"\n  ]\n}\n\n\n\u8a2d\u5b9a\n\n Usage\n\n\n mackerel-plugin-apache2\n\n\n\n conf\n\n\n/etc/httpd/conf.d/mackerel_apache2.conf\nListen 1080\nExtendedStatus On\n<VirtualHost 127.0.0.1:1080>\n    <Location /server-status>\n        SetHandler server-status\n        Order deny,allow\n        Deny from all\n        Allow from localhost\n    </Location>\n</VirtualHost>\n\n\n\n/etc/mackerel-agent/mackerel-agent.conf\n--- mackerel-agent.conf 2016-09-07 11:28:56.428350098 +0900\n+++ mackerel-agent.conf.orig    2016-09-06 19:36:14.908554933 +0900\n@@ -20,9 +20,6 @@\n #   By default, the plugin accesses to http://127.0.0.1/server-status?auto\n # [plugin.metrics.apache2]\n # command = \"mackerel-plugin-apache2\"\n-[plugin.metrics.apache2]\n-command = \"/usr/bin/mackerel-plugin-apache2 -p 1080\"\n-type = \"metric\"\n\n # Plugin for EC2 CPU Credit\n # [plugin.metrics.aws-ec2_cpucredit]\n\n\n\n\u9069\u7528\n# systemctl restart httpd;systemctl restart mackerel-agent\n\nexcute\n\n# /usr/bin/./mackerel-plugin-apache2 -p 1080\napache2.scoreboard.score-_  4.000000    1473224125\napache2.scoreboard.score-.  251.000000  1473224125\napache2.workers.busy_workers    1.000000    1473224125\napache2.workers.idle_workers    4.000000    1473224125\napache2.bytes.bytes_sent    0.000000    1473224125\napache2.req.requests    8.571429    1473224125\n\n\n\u78ba\u8a8d\n\n\n\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u304c\u5897\u3048\u3066\u3044\u308b\n\n\n\n# curl -X GET -H \"X-Api-Key: *************\" https://mackerel.io/api/v0/hosts/******/metric-names | jq '.'\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100   839  100   839    0     0   5327      0 --:--:-- --:--:-- --:--:--  5310\n{\n  \"names\": [\n    \"cpu.guest.percentage\",\n    \"cpu.idle.percentage\",\n    \"cpu.iowait.percentage\",\n    \"cpu.irq.percentage\",\n    \"cpu.nice.percentage\",\n    \"cpu.softirq.percentage\",\n    \"cpu.steal.percentage\",\n    \"cpu.system.percentage\",\n    \"cpu.user.percentage\",\n    \"custom.apache2.bytes.bytes_sent\",\n    \"custom.apache2.req.requests\",\n    \"custom.apache2.scoreboard.score-.\",\n    \"custom.apache2.scoreboard.score-_\",\n    \"custom.apache2.workers.busy_workers\",\n    \"custom.apache2.workers.idle_workers\",\n    \"disk.xvda.reads.delta\",\n    \"disk.xvda.writes.delta\",\n    \"disk.xvda1.reads.delta\",\n    \"disk.xvda1.writes.delta\",\n    \"filesystem.xvda1.size,\n    \"filesystem.xvda1.used\",\n    \"interface.eth0.rxBytes.delta\",\n    \"interface.eth0.txBytes.delta\",\n    \"loadavg5\",\n    \"memory.active\",\n    \"memory.available\",\n    \"memory.buffers\",\n    \"memory.cached\",\n    \"memory.free\",\n    \"memory.inactive\",\n    \"memory.swap_cached\",\n    \"memory.swap_free\",\n    \"memory.swap_total\",\n    \"memory.total\",\n    \"memory.used\"\n  ]\n}\n\n\n# \u76ee\u7684\n* \u6a19\u6e96\u30e1\u30c8\u30ea\u30c3\u30af\u4ee5\u5916\u306e\u30e1\u30c8\u30ea\u30c3\u30af\u3092\u53d6\u5f97\u3059\u308b\n    * Apache\u306e\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30c3\u30af\u3092\u53d6\u5f97\u3059\u308b\n\n# \u65b9\u6cd5\n* Mackerel\u516c\u5f0fPlugin\u3092\u4f7f\u7528\n    * [mackerel-agent-plugins](https://github.com/mackerelio/mackerel-agent-plugins)\n        * [README](https://github.com/mackerelio/mackerel-agent-plugins#installation)\u3092\u898b\u3066\u3001\u74b0\u5883\u6bce\u306b\u8a2d\u5b9a\u3059\u308b\n\n# \u78ba\u8a8d\n\n* \u30b7\u30b9\u30c6\u30e0\u30e1\u30c8\u30ea\u30c3\u30af\n\n```bash\n# curl -X GET -H \"X-Api-Key: *************\" https://mackerel.io/api/v0/hosts/******/metric-names | jq '.'\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100   839  100   839    0     0   4801      0 --:--:-- --:--:-- --:--:--  4821\n{\n  \"names\": [\n    \"cpu.guest.percentage\",\n    \"cpu.idle.percentage\",\n    \"cpu.iowait.percentage\",\n    \"cpu.irq.percentage\",\n    \"cpu.nice.percentage\",\n    \"cpu.softirq.percentage\",\n    \"cpu.steal.percentage\",\n    \"cpu.system.percentage\",\n    \"cpu.user.percentage\",\n    \"disk.xvda.reads.delta\",\n    \"disk.xvda.writes.delta\",\n    \"disk.xvda1.reads.delta\",\n    \"disk.xvda1.writes.delta\",\n    \"filesystem.xvda1.size\",\n    \"filesystem.xvda1.used\",\n    \"interface.eth0.rxBytes.delta\",\n    \"interface.eth0.txBytes.delta\",\n    \"loadavg5\",\n    \"memory.active\",\n    \"memory.available\",\n    \"memory.buffers\",\n    \"memory.cached\",\n    \"memory.free\",\n    \"memory.inactive\",\n    \"memory.swap_cached\",\n    \"memory.swap_free\",\n    \"memory.swap_total\",\n    \"memory.total\",\n    \"memory.used\"\n  ]\n}\n```\n\n\n# \u8a2d\u5b9a\n*  Usage\n    *  [mackerel-plugin-apache2](https://github.com/mackerelio/mackerel-agent-plugins/tree/master/mackerel-plugin-apache2#usage)\n*  conf\n\n```bash:/etc/httpd/conf.d/mackerel_apache2.conf\nListen 1080\nExtendedStatus On\n<VirtualHost 127.0.0.1:1080>\n    <Location /server-status>\n        SetHandler server-status\n        Order deny,allow\n        Deny from all\n        Allow from localhost\n    </Location>\n</VirtualHost>\n```\n```bash:/etc/mackerel-agent/mackerel-agent.conf\n--- mackerel-agent.conf\t2016-09-07 11:28:56.428350098 +0900\n+++ mackerel-agent.conf.orig\t2016-09-06 19:36:14.908554933 +0900\n@@ -20,9 +20,6 @@\n #   By default, the plugin accesses to http://127.0.0.1/server-status?auto\n # [plugin.metrics.apache2]\n # command = \"mackerel-plugin-apache2\"\n-[plugin.metrics.apache2]\n-command = \"/usr/bin/mackerel-plugin-apache2 -p 1080\"\n-type = \"metric\"\n \n # Plugin for EC2 CPU Credit\n # [plugin.metrics.aws-ec2_cpucredit]\n```\n\n* \u9069\u7528\n* \n```bash\n# systemctl restart httpd;systemctl restart mackerel-agent\n```\n\n* excute\n\n```bash\n# /usr/bin/./mackerel-plugin-apache2 -p 1080\napache2.scoreboard.score-_\t4.000000\t1473224125\napache2.scoreboard.score-.\t251.000000\t1473224125\napache2.workers.busy_workers\t1.000000\t1473224125\napache2.workers.idle_workers\t4.000000\t1473224125\napache2.bytes.bytes_sent\t0.000000\t1473224125\napache2.req.requests\t8.571429\t1473224125\n```\n\n* \u78ba\u8a8d\n    * \u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u304c\u5897\u3048\u3066\u3044\u308b\n\n```bash\n# curl -X GET -H \"X-Api-Key: *************\" https://mackerel.io/api/v0/hosts/******/metric-names | jq '.'\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100   839  100   839    0     0   5327      0 --:--:-- --:--:-- --:--:--  5310\n{\n  \"names\": [\n    \"cpu.guest.percentage\",\n    \"cpu.idle.percentage\",\n    \"cpu.iowait.percentage\",\n    \"cpu.irq.percentage\",\n    \"cpu.nice.percentage\",\n    \"cpu.softirq.percentage\",\n    \"cpu.steal.percentage\",\n    \"cpu.system.percentage\",\n    \"cpu.user.percentage\",\n    \"custom.apache2.bytes.bytes_sent\",\n    \"custom.apache2.req.requests\",\n    \"custom.apache2.scoreboard.score-.\",\n    \"custom.apache2.scoreboard.score-_\",\n    \"custom.apache2.workers.busy_workers\",\n    \"custom.apache2.workers.idle_workers\",\n    \"disk.xvda.reads.delta\",\n    \"disk.xvda.writes.delta\",\n    \"disk.xvda1.reads.delta\",\n    \"disk.xvda1.writes.delta\",\n    \"filesystem.xvda1.size,\n    \"filesystem.xvda1.used\",\n    \"interface.eth0.rxBytes.delta\",\n    \"interface.eth0.txBytes.delta\",\n    \"loadavg5\",\n    \"memory.active\",\n    \"memory.available\",\n    \"memory.buffers\",\n    \"memory.cached\",\n    \"memory.free\",\n    \"memory.inactive\",\n    \"memory.swap_cached\",\n    \"memory.swap_free\",\n    \"memory.swap_total\",\n    \"memory.total\",\n    \"memory.used\"\n  ]\n}\n\n```\n\n", "tags": ["Mackerel"]}