{"context": "\u6628\u4eca\u306eWeb\u30b5\u30a4\u30c8\u306b\u304a\u3044\u3066\u3001\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u304c\u7121\u3044\u30b5\u30a4\u30c8\u306f\u3042\u307e\u308a\u898b\u304b\u3051\u307e\u305b\u3093\u3002\nSEO\u5bfe\u7b56\u4e0a\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306f\u3068\u3066\u3082\u91cd\u8981\u3067\u3059\u3002\nYesod \u3067\u306e\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306e\u751f\u6210\u65b9\u6cd5\u3068\u3057\u3066 yesod-sitemap \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5229\u7528\u3057\u305f\u65b9\u6cd5\u3092\u3054\u7d39\u4ecb\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u6e96\u5099\n\nscaffolded\u30b5\u30a4\u30c8\u306e\u751f\u6210\n$ stack new sitemap-example yesod-simple && cd sitemap-example\n$ stack build yesod-bin cabal-install --install-ghc\n$ stack exec cabal update\n\n\n\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u304c\u6b63\u3057\u304f\u751f\u6210\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306b\u3001\u3044\u304f\u3064\u304b\u4f59\u5206\u306a\u30cf\u30f3\u30c9\u30e9\u3082\u751f\u6210\u3057\u307e\u3059\u3002\n\n\u30cf\u30f3\u30c9\u30e9\u306e\u751f\u6210\n$ stack exec yesod add-handlerLink1\nName of route (without trailing R): Link1\nEnter route pattern (ex: /entry/#EntryId): /link1\nEnter space-separated list of methods (ex: GET POST): GET\n\n$ stack exec yesod add-handler\nName of route (without trailing R): Link2\nEnter route pattern (ex: /entry/#EntryId): /link2\nEnter space-separated list of methods (ex: GET POST): GET\n\n$ stack exec yesod add-handler\nName of route (without trailing R): Link3\nEnter route pattern (ex: /entry/#EntryId): /link1/link3\nEnter space-separated list of methods (ex: GET POST): GET\n\n$ stack exec yesod add-handler\nName of route (without trailing R): Sitemap\nEnter route pattern (ex: /entry/#EntryId): /sitemap.xml\nEnter space-separated list of methods (ex: GET POST): GET\n\n\n\nyesod-sitemap\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ stack install yesod-sitemap\n\n\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u5b9f\u884c\n$ stack exec yesod devel\n\n\nhttp://localhost:3000/sitemap.xml \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u73fe\u6642\u70b9\u3067\u306f Not yet implemented: getSitemapR \u3068\u306a\u3063\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002\n\nyesod-sitemap \u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u5229\u7528\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u5229\u7528\u3067\u304d\u306a\u3044\u306e\u3067\u3001yesod-sitemap \u30d1\u30c3\u30b1\u30fc\u30b8\u3092 cabal \u30d5\u30a1\u30a4\u30eb\u306e build-depends \u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nsitemap-example.cabal\n...\n                 , containers\n                 , vector\n                 , time\n                 , case-insensitive\n                 , wai\n                 , yesod-sitemap -- \u8ffd\u52a0\n...\n\n\n\n\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u3092\u751f\u6210\u3059\u308b\u65b9\u6cd5\n\u307e\u305a\u3001Yesod.Sitemap \u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\nHandler/Sitemap.hs\nmodule Handler.Sitemap where\n\nimport Import\n\nimport Yesod.Sitemap\n\ngetSitemapR :: Handler Html\ngetSitemapR = error \"Not yet implemented: getSitemapR\"\n\n\nyesod-sitemap \u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u975e\u5e38\u306b\u30b3\u30f3\u30d1\u30af\u30c8\u306a\u305f\u3081\u3001\u30c7\u30fc\u30bf\u578b\u306f2\u3064\u3057\u304b\u3042\u308a\u307e\u305b\u3093\u3002\n\nyesod-sitemap\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u578b\ndata SitemapUrl url = SitemapUrl\n    { sitemapLoc :: url\n    , sitemapLastMod :: Maybe UTCTime\n    , sitemapChangeFreq :: Maybe SitemapChangeFreq\n    , sitemapPriority :: Maybe Double\n    }\n\ndata SitemapChangeFreq = Always\n                       | Hourly\n                       | Daily\n                       | Weekly\n                       | Monthly\n                       | Yearly\n                       | Never\n\n\n\n\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306e\u751f\u6210\u65b9\u6cd5\nsitemapList \u3092\u4f7f\u3063\u305f\u65b9\u6cd5\u3067\u306f SitemapUrl \u578b\u306e\u30ea\u30b9\u30c8\u3068\u3057\u3066\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306b\u8a18\u8f09\u3059\u308b\u5185\u5bb9\u3092\u53d7\u3051\u53d6\u308a\u3001\u5b9f\u969b\u306e\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u3092\u751f\u6210\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u4f7f\u3044\u65b9\u306e\u4f8b\u793a\u306e\u305f\u3081\u3001SitemapUrl \u578b\u306e\u5024\u306e\u307b\u3068\u3093\u3069\u3092 Nothing \u3068\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u5b9f\u969b\u306b\u306f\u66f4\u65b0\u65e5\u3084\u512a\u5148\u5ea6\u306a\u3069\u3092\u5b9a\u7fa9\u3057\u305f\u65b9\u304c\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\nsitemapList\u95a2\u6570\u3092\u4f7f\u3063\u305f\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306e\u751f\u6210\u4f8b\nmodule Handler.Sitemap where\n\nimport Import\nimport Yesod.Sitemap (sitemapList, SitemapUrl(SitemapUrl))\n\ngetSitemapR :: Handler TypedContent\ngetSitemapR = sitemapList $ map defaultSitemap [HomeR, Link1R, Link2R, Link3R]\n\ndefaultSitemap :: Route site -> SitemapUrl (Route site)\ndefaultSitemap route = SitemapUrl route Nothing Nothing Nothing\n\n\n\n\u751f\u6210\u3055\u308c\u308b\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n  <url><loc>http://localhost:3000/</loc></url>\n  <url><loc>http://localhost:3000/link1</loc></url>\n  <url><loc>http://localhost:3000/link2</loc></url>\n  <url><loc>http://localhost:3000/link1/link3</loc></url>\n</urlset>\n\n\nsitemap \u95a2\u6570\u3092\u4f7f\u3063\u3066\u3082\u4e0a\u8a18\u3068\u540c\u3058\u7d50\u679c\u3092\u751f\u6210\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u672c\u6765\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304b\u3089\u8aad\u307f\u53d6\u3063\u305f\u5024\u3092\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306b\u3059\u308b\u969b\u306a\u3069\u3067\u5229\u7528\u3057\u307e\u3059\u3002\n\nsitemap\u95a2\u6570\u3092\u4f7f\u3063\u305f\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306e\u751f\u6210\u4f8b\nmodule Handler.Sitemap where\n\nimport Import\nimport Yesod.Sitemap (SitemapUrl(SitemapUrl), sitemap)\nimport qualified Data.Conduit.List as CL (sourceList, map)\n\ngetSitemapR :: Handler TypedContent\ngetSitemapR = sitemap routes\n  where routes = CL.sourceList [HomeR, Link1R, Link2R, Link3R] $= CL.map defaultSitemap\n\ndefaultSitemap :: Route site -> SitemapUrl (Route site)\ndefaultSitemap route = SitemapUrl route Nothing Nothing Nothing\n\n\n\n\u751f\u6210\u3055\u308c\u308b\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n  <url><loc>http://localhost:3000/</loc></url>\n  <url><loc>http://localhost:3000/link1</loc></url>\n  <url><loc>http://localhost:3000/link2</loc></url>\n  <url><loc>http://localhost:3000/link1/link3</loc></url>\n</urlset>\n\n\n\nrobots \u30d5\u30a1\u30a4\u30eb\nsitemap.xml \u306e\u5834\u6240\u3092\u30ed\u30dc\u30c3\u30c8\u306b\u4f1d\u3048\u308b\u305f\u3081\u3001robots \u30d5\u30a1\u30a4\u30eb\u3092\u9069\u5207\u306b\u8a2d\u5b9a\u3057\u3066\u304f\u308c\u308b\u95a2\u6570\u3082\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nscaffolded \u30b5\u30a4\u30c8\u3067\u306f Handler/Common.hs \u306b getRobotsR \u95a2\u6570\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nHandler/Common.hs\n-- | Common handler functions.\nmodule Handler.Common where\n\nimport Data.FileEmbed (embedFile)\nimport Import\nimport Yesod.Sitemap (robots)\n\n-- These handlers embed files in the executable at compile time to avoid a\n-- runtime dependency, and for efficiency.\n\ngetFaviconR :: Handler TypedContent\ngetFaviconR = do cacheSeconds $ 60 * 60 * 24 * 30 -- cache for a month\n                 return $ TypedContent \"image/x-icon\"\n                        $ toContent $(embedFile \"config/favicon.ico\")\n\ngetRobotsR :: Handler TypedContent\ngetRobotsR = do\n  contents <- robots SitemapR\n  return $ TypedContent typePlain $ toContent contents\n\n\n\n\u751f\u6210\u3055\u308c\u308brobots.txt\nSitemap: http://localhost:3000/sitemap.xml\nUser-agent: *\n\n\nhttp://localhost:3000/robots.txt \u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001\u9069\u5207\u306b\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306eURL\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\u4eca\u56de\u306f\u7d39\u4ecb\u3057\u3066\u3044\u307e\u305b\u3093\u304c\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u4fdd\u5b58\u3057\u305f\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u304b\u3089\u52d5\u7684\u306b\u751f\u6210\u3059\u308b\u65b9\u6cd5\u3082Simpler streaming responses\u3067\u7d39\u4ecb\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u898f\u6a21\u304c\u5c0f\u3055\u3044\u5834\u5408\u306f\u578b\u5b89\u5168URL\u3092\u5217\u6319\u3059\u308b\u65b9\u6cd5\u3067\u3082\u554f\u984c\u7121\u3055\u305d\u3046\u3067\u3059\u304c\u3001\u5927\u898f\u6a21\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u306a\u3063\u3066\u304f\u308b\u3068\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u7528\u3044\u305f\u65b9\u6cd5\u3068\u306a\u3063\u3066\u304f\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001\u9650\u3089\u308c\u305f\u5834\u9762\u3067\u3059\u304c config/route \u306e\u5185\u5bb9\u3092\u305d\u306e\u307e\u307e\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306b\u3057\u3066\u3057\u307e\u3048\u3070\u826f\u3044\u3068\u3044\u3046\u3053\u3068\u3067\u3042\u308c\u3070\u3001\u6b21\u306e\u3088\u3046\u306b\u3059\u308c\u3070\u826f\u3044\u3067\u3057\u3087\u3046\u3002\n\nconfig/route \u306e\u5185\u5bb9\u3092\u57fa\u306b\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u3092\u751f\u6210\n\u30d1\u30b9\u304c\u5168\u3066\u660e\u793a\u7684\u306b\u5217\u6319\u3055\u308c\u3066\u3044\u308b\u524d\u63d0\u3067\u3059\u3002\u30d1\u30b9\u306e\u30d1\u30bf\u30fc\u30f3\u304c\u542b\u307e\u308c\u308b\u5834\u5408\u306f\u6b63\u3057\u3044\u7d50\u679c\u306b\u306a\u308a\u307e\u305b\u3093\u3002\u307e\u305f\u3001\u4eca\u56de\u306f\u8d77\u52d5\u6642\u306b config/route \u306e\u5185\u5bb9\u3092\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\u30a2\u30af\u30bb\u30b9\u6642\u306b\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\u307e\u305a\u306f\u3001\u8d77\u52d5\u6642\u306b config/route \u3092\u8aad\u307f\u8fbc\u307f\u3001\u305d\u306e\u5185\u5bb9\u3092\u4fdd\u5b58\u3059\u308b\u305f\u3081\u306b Foundation \u3092\u4fee\u6b63\u3057\u307e\u3059\u3002\n\nFoundation.hs\ndata App = App\n    { appSettings       :: AppSettings\n    , appStatic         :: Static -- ^ Settings for static file serving.\n    , appHttpManager    :: Manager\n    , appLogger         :: Logger\n    , appSitemapRoutes  :: [Text]  -- \u8ffd\u8a18\n    }\n\n\nApplication.hs \u306b\u8d77\u52d5\u6642\u306e config/route \u8aad\u307f\u8fbc\u307f\u51e6\u7406\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\nApplication.hs\nmakeFoundation :: AppSettings -> IO App\nmakeFoundation appSettings = do\n    -- Some basic initializations: HTTP connection manager, logger, and static\n    -- subsite.\n    appHttpManager <- newManager\n    appLogger <- newStdoutLoggerSet defaultBufSize >>= makeYesodLogger\n    appStatic <-\n        (if appMutableStatic appSettings then staticDevel else static)\n        (appStaticDir appSettings)\n\n    -- \u8ffd\u8a18\n    appSitemapRoutes <- readFile \"config/routes\" >>= return . lines\n\n    -- Return the foundation\n    return App {..}\n\n\n\u6700\u5f8c\u306b\u30cf\u30f3\u30c9\u30e9\u95a2\u6570\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\nHandler/Sitemap.hs\nmodule Handler.Sitemap where\n\nimport Import\nimport Yesod.Sitemap (SitemapUrl(SitemapUrl), sitemap)\n\nimport qualified Data.Conduit.List as CL (sourceList, map, filter, mapMaybe)\n\ngetSitemapR :: Handler TypedContent\ngetSitemapR = do\n  master <- getYesod\n  let contents = CL.sourceList $ appSitemapRoutes master\n  let routes = contents $= CL.mapMaybe (headMay.tailDef.words) $= CL.mapMaybe readRoute $= CL.filter (/= SitemapR) $= CL.map defaultSitemap\n\n  sitemap routes\n\ndefaultSitemap :: Route site -> SitemapUrl (Route site)\ndefaultSitemap route = SitemapUrl route Nothing Nothing Nothing\n\nreadRoute :: Text -> Maybe (Route App)\nreadRoute = readMay . otoList\n\n\n\u3053\u3053\u3067\u3001readMay, headMay, tailDef \u306a\u3069\u306e\u898b\u306a\u308c\u306a\u3044\u95a2\u6570\u304c\u51fa\u3066\u304d\u307e\u3059\u3002\u3053\u308c\u306f\u3001safe\u30d1\u30c3\u30b1\u30fc\u30b8\u3060\u3063\u305f\u308a\u3001mono-traversal \u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u95a2\u6570\u9054\u3067\u3059\u3002\nYesod \u3067\u306f\u6a19\u6e96\u7684\u306a Prelude \u306e\u4ee3\u308f\u308a\u306b\u3001\u3088\u308a\u30e2\u30c0\u30f3\u306a classy-prelude \u3092\u63a1\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u6163\u308c\u308b\u307e\u3067\u5c11\u3057\u9055\u548c\u611f\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u4f7f\u3063\u3066\u307f\u308b\u3068\u7d50\u69cb\u826f\u304b\u3063\u305f\u308a\u3057\u307e\u3059\u3002\n\n\u307e\u3068\u3081\nyesod-sitemap \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f7f\u3063\u305f\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306e\u751f\u6210\u65b9\u6cd5\u304c\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u304b\u3068\u8a00\u308f\u308c\u308b\u3068\u826f\u304f\u308f\u304b\u308a\u307e\u305b\u3093\u30fb\u30fb\u30fb\u3002\n\u50d5\u304c\u8abf\u3079\u305f\u9650\u308a\u3067\u306f\u3001\u305d\u306e\u4ed6\u306b Yesod \u306e\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306e\u751f\u6210\u3092\u88dc\u52a9\u3057\u3066\u304f\u308c\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u4ed6\u306b\u826f\u3044\u65b9\u6cd5\u304c\u3042\u308c\u3070\u6559\u3048\u3066\u6b32\u3057\u3044\u3067\u3059\u3002\n\u4ee5\u4e0a\u3001\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306e\u751f\u6210\u65b9\u6cd5\u306b\u3064\u3044\u3066\u3067\u3057\u305f\u3002\n\n\u53c2\u8003\n\nyesod-sitemap\nSimpler streaming responses\nSitemap.hs - schoolofhaskell.com\n\n\u6628\u4eca\u306eWeb\u30b5\u30a4\u30c8\u306b\u304a\u3044\u3066\u3001\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u304c\u7121\u3044\u30b5\u30a4\u30c8\u306f\u3042\u307e\u308a\u898b\u304b\u3051\u307e\u305b\u3093\u3002\n\nSEO\u5bfe\u7b56\u4e0a\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306f\u3068\u3066\u3082\u91cd\u8981\u3067\u3059\u3002\n\nYesod \u3067\u306e\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306e\u751f\u6210\u65b9\u6cd5\u3068\u3057\u3066 `yesod-sitemap` \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5229\u7528\u3057\u305f\u65b9\u6cd5\u3092\u3054\u7d39\u4ecb\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n# \u6e96\u5099\n\n```bash:scaffolded\u30b5\u30a4\u30c8\u306e\u751f\u6210\n$ stack new sitemap-example yesod-simple && cd sitemap-example\n$ stack build yesod-bin cabal-install --install-ghc\n$ stack exec cabal update\n```\n\n\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u304c\u6b63\u3057\u304f\u751f\u6210\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306b\u3001\u3044\u304f\u3064\u304b\u4f59\u5206\u306a\u30cf\u30f3\u30c9\u30e9\u3082\u751f\u6210\u3057\u307e\u3059\u3002\n\n```bash:\u30cf\u30f3\u30c9\u30e9\u306e\u751f\u6210\n$ stack exec yesod add-handlerLink1\nName of route (without trailing R): Link1\nEnter route pattern (ex: /entry/#EntryId): /link1\nEnter space-separated list of methods (ex: GET POST): GET\n\n$ stack exec yesod add-handler\nName of route (without trailing R): Link2\nEnter route pattern (ex: /entry/#EntryId): /link2\nEnter space-separated list of methods (ex: GET POST): GET\n\n$ stack exec yesod add-handler\nName of route (without trailing R): Link3\nEnter route pattern (ex: /entry/#EntryId): /link1/link3\nEnter space-separated list of methods (ex: GET POST): GET\n\n$ stack exec yesod add-handler\nName of route (without trailing R): Sitemap\nEnter route pattern (ex: /entry/#EntryId): /sitemap.xml\nEnter space-separated list of methods (ex: GET POST): GET\n```\n\n```bash:yesod-sitemap\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ stack install yesod-sitemap\n```\n\n```bash:\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u5b9f\u884c\n$ stack exec yesod devel\n```\n\nhttp://localhost:3000/sitemap.xml \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u73fe\u6642\u70b9\u3067\u306f `Not yet implemented: getSitemapR` \u3068\u306a\u3063\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002\n\n# yesod-sitemap \u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u5229\u7528\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u5229\u7528\u3067\u304d\u306a\u3044\u306e\u3067\u3001`yesod-sitemap` \u30d1\u30c3\u30b1\u30fc\u30b8\u3092 `cabal` \u30d5\u30a1\u30a4\u30eb\u306e `build-depends` \u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```haskell:sitemap-example.cabal\n...\n                 , containers\n                 , vector\n                 , time\n                 , case-insensitive\n                 , wai\n                 , yesod-sitemap -- \u8ffd\u52a0\n...\n```\n\n# \u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u3092\u751f\u6210\u3059\u308b\u65b9\u6cd5\n\n\u307e\u305a\u3001`Yesod.Sitemap` \u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\n```haskell:Handler/Sitemap.hs\nmodule Handler.Sitemap where\n\nimport Import\n\nimport Yesod.Sitemap\n\ngetSitemapR :: Handler Html\ngetSitemapR = error \"Not yet implemented: getSitemapR\"\n```\n\n`yesod-sitemap` \u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u975e\u5e38\u306b\u30b3\u30f3\u30d1\u30af\u30c8\u306a\u305f\u3081\u3001\u30c7\u30fc\u30bf\u578b\u306f2\u3064\u3057\u304b\u3042\u308a\u307e\u305b\u3093\u3002\n\n```haskell:yesod-sitemap\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u578b\ndata SitemapUrl url = SitemapUrl\n    { sitemapLoc :: url\n    , sitemapLastMod :: Maybe UTCTime\n    , sitemapChangeFreq :: Maybe SitemapChangeFreq\n    , sitemapPriority :: Maybe Double\n    }\n\ndata SitemapChangeFreq = Always\n                       | Hourly\n                       | Daily\n                       | Weekly\n                       | Monthly\n                       | Yearly\n                       | Never\n```\n\n## \u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306e\u751f\u6210\u65b9\u6cd5\n\n`sitemapList` \u3092\u4f7f\u3063\u305f\u65b9\u6cd5\u3067\u306f `SitemapUrl` \u578b\u306e\u30ea\u30b9\u30c8\u3068\u3057\u3066\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306b\u8a18\u8f09\u3059\u308b\u5185\u5bb9\u3092\u53d7\u3051\u53d6\u308a\u3001\u5b9f\u969b\u306e\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u3092\u751f\u6210\u3057\u307e\u3059\u3002\n\n\u3053\u3053\u3067\u306f\u4f7f\u3044\u65b9\u306e\u4f8b\u793a\u306e\u305f\u3081\u3001`SitemapUrl` \u578b\u306e\u5024\u306e\u307b\u3068\u3093\u3069\u3092 `Nothing` \u3068\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u5b9f\u969b\u306b\u306f\u66f4\u65b0\u65e5\u3084\u512a\u5148\u5ea6\u306a\u3069\u3092\u5b9a\u7fa9\u3057\u305f\u65b9\u304c\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n```haskell:sitemapList\u95a2\u6570\u3092\u4f7f\u3063\u305f\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306e\u751f\u6210\u4f8b\nmodule Handler.Sitemap where\n\nimport Import\nimport Yesod.Sitemap (sitemapList, SitemapUrl(SitemapUrl))\n\ngetSitemapR :: Handler TypedContent\ngetSitemapR = sitemapList $ map defaultSitemap [HomeR, Link1R, Link2R, Link3R]\n\ndefaultSitemap :: Route site -> SitemapUrl (Route site)\ndefaultSitemap route = SitemapUrl route Nothing Nothing Nothing\n```\n\n```xml:\u751f\u6210\u3055\u308c\u308b\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n  <url><loc>http://localhost:3000/</loc></url>\n  <url><loc>http://localhost:3000/link1</loc></url>\n  <url><loc>http://localhost:3000/link2</loc></url>\n  <url><loc>http://localhost:3000/link1/link3</loc></url>\n</urlset>\n```\n\n`sitemap` \u95a2\u6570\u3092\u4f7f\u3063\u3066\u3082\u4e0a\u8a18\u3068\u540c\u3058\u7d50\u679c\u3092\u751f\u6210\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u672c\u6765\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304b\u3089\u8aad\u307f\u53d6\u3063\u305f\u5024\u3092\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306b\u3059\u308b\u969b\u306a\u3069\u3067\u5229\u7528\u3057\u307e\u3059\u3002\n\n```haskell:sitemap\u95a2\u6570\u3092\u4f7f\u3063\u305f\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306e\u751f\u6210\u4f8b\nmodule Handler.Sitemap where\n\nimport Import\nimport Yesod.Sitemap (SitemapUrl(SitemapUrl), sitemap)\nimport qualified Data.Conduit.List as CL (sourceList, map)\n\ngetSitemapR :: Handler TypedContent\ngetSitemapR = sitemap routes\n  where routes = CL.sourceList [HomeR, Link1R, Link2R, Link3R] $= CL.map defaultSitemap\n\ndefaultSitemap :: Route site -> SitemapUrl (Route site)\ndefaultSitemap route = SitemapUrl route Nothing Nothing Nothing\n```\n\n```xml:\u751f\u6210\u3055\u308c\u308b\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n  <url><loc>http://localhost:3000/</loc></url>\n  <url><loc>http://localhost:3000/link1</loc></url>\n  <url><loc>http://localhost:3000/link2</loc></url>\n  <url><loc>http://localhost:3000/link1/link3</loc></url>\n</urlset>\n```\n\n\n\n# robots \u30d5\u30a1\u30a4\u30eb\n\n`sitemap.xml` \u306e\u5834\u6240\u3092\u30ed\u30dc\u30c3\u30c8\u306b\u4f1d\u3048\u308b\u305f\u3081\u3001`robots` \u30d5\u30a1\u30a4\u30eb\u3092\u9069\u5207\u306b\u8a2d\u5b9a\u3057\u3066\u304f\u308c\u308b\u95a2\u6570\u3082\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nscaffolded \u30b5\u30a4\u30c8\u3067\u306f `Handler/Common.hs` \u306b `getRobotsR` \u95a2\u6570\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```haskell:Handler/Common.hs\n-- | Common handler functions.\nmodule Handler.Common where\n\nimport Data.FileEmbed (embedFile)\nimport Import\nimport Yesod.Sitemap (robots)\n\n-- These handlers embed files in the executable at compile time to avoid a\n-- runtime dependency, and for efficiency.\n\ngetFaviconR :: Handler TypedContent\ngetFaviconR = do cacheSeconds $ 60 * 60 * 24 * 30 -- cache for a month\n                 return $ TypedContent \"image/x-icon\"\n                        $ toContent $(embedFile \"config/favicon.ico\")\n\ngetRobotsR :: Handler TypedContent\ngetRobotsR = do\n  contents <- robots SitemapR\n  return $ TypedContent typePlain $ toContent contents\n```\n\n```text:\u751f\u6210\u3055\u308c\u308brobots.txt\nSitemap: http://localhost:3000/sitemap.xml\nUser-agent: *\n```\n\nhttp://localhost:3000/robots.txt \u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001\u9069\u5207\u306b\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306eURL\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n\u4eca\u56de\u306f\u7d39\u4ecb\u3057\u3066\u3044\u307e\u305b\u3093\u304c\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u4fdd\u5b58\u3057\u305f\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u304b\u3089\u52d5\u7684\u306b\u751f\u6210\u3059\u308b\u65b9\u6cd5\u3082[Simpler streaming responses](http://www.yesodweb.com/blog/2013/03/simpler-streaming-responses)\u3067\u7d39\u4ecb\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u898f\u6a21\u304c\u5c0f\u3055\u3044\u5834\u5408\u306f\u578b\u5b89\u5168URL\u3092\u5217\u6319\u3059\u308b\u65b9\u6cd5\u3067\u3082\u554f\u984c\u7121\u3055\u305d\u3046\u3067\u3059\u304c\u3001\u5927\u898f\u6a21\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u306a\u3063\u3066\u304f\u308b\u3068\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u7528\u3044\u305f\u65b9\u6cd5\u3068\u306a\u3063\u3066\u304f\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u307e\u305f\u3001\u9650\u3089\u308c\u305f\u5834\u9762\u3067\u3059\u304c `config/route` \u306e\u5185\u5bb9\u3092\u305d\u306e\u307e\u307e\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306b\u3057\u3066\u3057\u307e\u3048\u3070\u826f\u3044\u3068\u3044\u3046\u3053\u3068\u3067\u3042\u308c\u3070\u3001\u6b21\u306e\u3088\u3046\u306b\u3059\u308c\u3070\u826f\u3044\u3067\u3057\u3087\u3046\u3002\n\n# config/route \u306e\u5185\u5bb9\u3092\u57fa\u306b\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u3092\u751f\u6210\n\n\u30d1\u30b9\u304c\u5168\u3066\u660e\u793a\u7684\u306b\u5217\u6319\u3055\u308c\u3066\u3044\u308b\u524d\u63d0\u3067\u3059\u3002\u30d1\u30b9\u306e\u30d1\u30bf\u30fc\u30f3\u304c\u542b\u307e\u308c\u308b\u5834\u5408\u306f\u6b63\u3057\u3044\u7d50\u679c\u306b\u306a\u308a\u307e\u305b\u3093\u3002\u307e\u305f\u3001\u4eca\u56de\u306f\u8d77\u52d5\u6642\u306b `config/route` \u306e\u5185\u5bb9\u3092\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\u30a2\u30af\u30bb\u30b9\u6642\u306b\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\n\u307e\u305a\u306f\u3001\u8d77\u52d5\u6642\u306b `config/route` \u3092\u8aad\u307f\u8fbc\u307f\u3001\u305d\u306e\u5185\u5bb9\u3092\u4fdd\u5b58\u3059\u308b\u305f\u3081\u306b `Foundation` \u3092\u4fee\u6b63\u3057\u307e\u3059\u3002\n\n```haskell:Foundation.hs\ndata App = App\n    { appSettings       :: AppSettings\n    , appStatic         :: Static -- ^ Settings for static file serving.\n    , appHttpManager    :: Manager\n    , appLogger         :: Logger\n    , appSitemapRoutes  :: [Text]  -- \u8ffd\u8a18\n    }\n```\n\n`Application.hs` \u306b\u8d77\u52d5\u6642\u306e `config/route` \u8aad\u307f\u8fbc\u307f\u51e6\u7406\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\n```haskell:Application.hs\nmakeFoundation :: AppSettings -> IO App\nmakeFoundation appSettings = do\n    -- Some basic initializations: HTTP connection manager, logger, and static\n    -- subsite.\n    appHttpManager <- newManager\n    appLogger <- newStdoutLoggerSet defaultBufSize >>= makeYesodLogger\n    appStatic <-\n        (if appMutableStatic appSettings then staticDevel else static)\n        (appStaticDir appSettings)\n\n    -- \u8ffd\u8a18\n    appSitemapRoutes <- readFile \"config/routes\" >>= return . lines\n\n    -- Return the foundation\n    return App {..}\n```\n\n\u6700\u5f8c\u306b\u30cf\u30f3\u30c9\u30e9\u95a2\u6570\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n```haskell:Handler/Sitemap.hs\nmodule Handler.Sitemap where\n\nimport Import\nimport Yesod.Sitemap (SitemapUrl(SitemapUrl), sitemap)\n\nimport qualified Data.Conduit.List as CL (sourceList, map, filter, mapMaybe)\n\ngetSitemapR :: Handler TypedContent\ngetSitemapR = do\n  master <- getYesod\n  let contents = CL.sourceList $ appSitemapRoutes master\n  let routes = contents $= CL.mapMaybe (headMay.tailDef.words) $= CL.mapMaybe readRoute $= CL.filter (/= SitemapR) $= CL.map defaultSitemap\n\n  sitemap routes\n\ndefaultSitemap :: Route site -> SitemapUrl (Route site)\ndefaultSitemap route = SitemapUrl route Nothing Nothing Nothing\n\nreadRoute :: Text -> Maybe (Route App)\nreadRoute = readMay . otoList\n```\n\n\u3053\u3053\u3067\u3001`readMay`, `headMay`, `tailDef` \u306a\u3069\u306e\u898b\u306a\u308c\u306a\u3044\u95a2\u6570\u304c\u51fa\u3066\u304d\u307e\u3059\u3002\u3053\u308c\u306f\u3001`safe`\u30d1\u30c3\u30b1\u30fc\u30b8\u3060\u3063\u305f\u308a\u3001`mono-traversal` \u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u95a2\u6570\u9054\u3067\u3059\u3002\n\nYesod \u3067\u306f\u6a19\u6e96\u7684\u306a `Prelude` \u306e\u4ee3\u308f\u308a\u306b\u3001\u3088\u308a\u30e2\u30c0\u30f3\u306a `classy-prelude` \u3092\u63a1\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u6163\u308c\u308b\u307e\u3067\u5c11\u3057\u9055\u548c\u611f\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u4f7f\u3063\u3066\u307f\u308b\u3068\u7d50\u69cb\u826f\u304b\u3063\u305f\u308a\u3057\u307e\u3059\u3002\n\n# \u307e\u3068\u3081\n`yesod-sitemap` \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f7f\u3063\u305f\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306e\u751f\u6210\u65b9\u6cd5\u304c\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u304b\u3068\u8a00\u308f\u308c\u308b\u3068\u826f\u304f\u308f\u304b\u308a\u307e\u305b\u3093\u30fb\u30fb\u30fb\u3002\n\n\u50d5\u304c\u8abf\u3079\u305f\u9650\u308a\u3067\u306f\u3001\u305d\u306e\u4ed6\u306b Yesod \u306e\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306e\u751f\u6210\u3092\u88dc\u52a9\u3057\u3066\u304f\u308c\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u4ed6\u306b\u826f\u3044\u65b9\u6cd5\u304c\u3042\u308c\u3070\u6559\u3048\u3066\u6b32\u3057\u3044\u3067\u3059\u3002\n\n\u4ee5\u4e0a\u3001\u30b5\u30a4\u30c8\u30de\u30c3\u30d7\u306e\u751f\u6210\u65b9\u6cd5\u306b\u3064\u3044\u3066\u3067\u3057\u305f\u3002\n\n# \u53c2\u8003\n\n * [yesod-sitemap](https://github.com/yesodweb/yesod/tree/master/yesod-sitemap)\n * [Simpler streaming responses](http://www.yesodweb.com/blog/2013/03/simpler-streaming-responses)\n * [Sitemap.hs - schoolofhaskell.com](https://github.com/fpco/schoolofhaskell.com/blob/master/src/Handler/Sitemap.hs)\n", "tags": ["yesod", "Haskell", "AdventCalendar"]}