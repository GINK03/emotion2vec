{"context": " More than 1 year has passed since last update.\u524d\u56de\u8a18\u4e8b\u306e\u7d9a\u304d\u3067\u3059\u3002\n\u30bf\u30b9\u30af\u8ffd\u52a0\u306b\u3042\u305f\u308a\u3001\u30e1\u30f3\u30d0\u30fc\u306e\u30ea\u30b9\u30c8\u3092\u53d6\u5f97\u3057\u3066\u304d\u3066\u304b\u3089\u8ffd\u52a0\u3057\u307e\u3059\u3002\nAPI\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306f\u3053\u3061\u3089\u3067\u3059\u3002\nhttp://developer.chatwork.com/ja/endpoint_rooms.html#GET-rooms-room_id-members\n[JavaScript] \u975e\u540c\u671f\u51e6\u7406\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u5730\u7344\u304b\u3089\u629c\u3051\u51fa\u3059\u65b9\u6cd5\u3092\u53c2\u8003\u306basync/await\u306eaa\u3092\u4f7f\u3063\u3066\u540c\u671f\u7684\u306b\u51e6\u7406\u3092\u66f8\u3044\u3066\u307f\u307e\u3059\u3002\n$ npm i aa request\n\n\nchtask.js\n'use strict';\n\nif (!process.env.chtoken) {\n    console.log('Error: Specify token in environment');\n    process.exit(1);\n}\n\nlet aa = require('aa');\nlet request = require('request');\nconst ROOM_ID = '43484166';\n\n//\u30bf\u30b9\u30af\u8ffd\u52a0\nfunction addTask(text, userList){\n  let task = {\n    body: text,\n    limit: 0,\n    to_ids: userList,\n  };\n\n  let options = {\n      url: `https://api.chatwork.com/v1/rooms/${ROOM_ID}/tasks`,\n      headers: {\n          'X-ChatWorkToken': process.env.chtoken\n      },\n      form: task,\n      json: true\n  };\n\n  return new Promise((resolve,reject) => {\n    request.post(options, (error, response, body) => {\n      if(error) reject('error: '+ response.statusCode);\n      resolve(body);\n    });\n  });\n\n}\n\n//\u30e1\u30f3\u30d0\u30fc\u53d6\u5f97\nfunction getMember(){\n  let options = {\n      url: `https://api.chatwork.com/v1/rooms/${ROOM_ID}/members`,\n      headers: {\n          'X-ChatWorkToken': process.env.chtoken\n      },\n      json: true\n  };\n\n  return new Promise((resolve,reject) => {\n    request.get(options, (error, response, users) => {\n      if(error) reject('error: '+ response.statusCode);\n      let userList = '';\n      for (let i = 0, len = users.length; i < len; i++) {\n        userList += users[i].account_id;\n        if(len !== i+1) userList += ',';\n      }\n      resolve(userList);\n    });\n  });\n}\n\n//\u540c\u671f\u5b9f\u884c\naa(function*() {\n  let userList = yield getMember();\n  let res = yield addTask('message', userList);\n  return res;\n}).then(\n  function (val) { console.info('ok: ',val); },\n  function (err) { console.error('ng: ',err); }\n);\n\n\n\n\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n$ chtoken=xxxxxxxxx node chtask.js\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u30bf\u30b9\u30af\u8ffd\u52a0\u3067\u304d\u307e\u3057\u305f\u3002\n\nAPI\u3092\u4e8c\u56de\u6295\u3052\u308b\u3042\u305f\u308a\u306f\u975e\u540c\u671f\u51e6\u7406\u306e\u7df4\u7fd2\u306b\u306a\u308a\u307e\u3059\u306d\u301c\n\n[\u524d\u56de\u8a18\u4e8b](http://qiita.com/n0bisuke/items/61b15080aac41d12ebbe)\u306e\u7d9a\u304d\u3067\u3059\u3002\n\n\u30bf\u30b9\u30af\u8ffd\u52a0\u306b\u3042\u305f\u308a\u3001\u30e1\u30f3\u30d0\u30fc\u306e\u30ea\u30b9\u30c8\u3092\u53d6\u5f97\u3057\u3066\u304d\u3066\u304b\u3089\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nAPI\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306f\u3053\u3061\u3089\u3067\u3059\u3002\n\nhttp://developer.chatwork.com/ja/endpoint_rooms.html#GET-rooms-room_id-members\n\n[[JavaScript] \u975e\u540c\u671f\u51e6\u7406\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u5730\u7344\u304b\u3089\u629c\u3051\u51fa\u3059\u65b9\u6cd5](http://qiita.com/LightSpeedC/items/7980a6e790d6cb2d6dad)\u3092\u53c2\u8003\u306basync/await\u306eaa\u3092\u4f7f\u3063\u3066\u540c\u671f\u7684\u306b\u51e6\u7406\u3092\u66f8\u3044\u3066\u307f\u307e\u3059\u3002\n\n```bash\n$ npm i aa request\n```\n\n```chtask.js\n'use strict';\n\nif (!process.env.chtoken) {\n    console.log('Error: Specify token in environment');\n    process.exit(1);\n}\n\nlet aa = require('aa');\nlet request = require('request');\nconst ROOM_ID = '43484166';\n\n//\u30bf\u30b9\u30af\u8ffd\u52a0\nfunction addTask(text, userList){\n  let task = {\n    body: text,\n    limit: 0,\n    to_ids: userList,\n  };\n\n  let options = {\n      url: `https://api.chatwork.com/v1/rooms/${ROOM_ID}/tasks`,\n      headers: {\n          'X-ChatWorkToken': process.env.chtoken\n      },\n      form: task,\n      json: true\n  };\n\n  return new Promise((resolve,reject) => {\n    request.post(options, (error, response, body) => {\n      if(error) reject('error: '+ response.statusCode);\n      resolve(body);\n    });\n  });\n\n}\n\n//\u30e1\u30f3\u30d0\u30fc\u53d6\u5f97\nfunction getMember(){\n  let options = {\n      url: `https://api.chatwork.com/v1/rooms/${ROOM_ID}/members`,\n      headers: {\n          'X-ChatWorkToken': process.env.chtoken\n      },\n      json: true\n  };\n\n  return new Promise((resolve,reject) => {\n    request.get(options, (error, response, users) => {\n      if(error) reject('error: '+ response.statusCode);\n      let userList = '';\n      for (let i = 0, len = users.length; i < len; i++) {\n        userList += users[i].account_id;\n        if(len !== i+1) userList += ',';\n      }\n      resolve(userList);\n    });\n  });\n}\n\n//\u540c\u671f\u5b9f\u884c\naa(function*() {\n  let userList = yield getMember();\n  let res = yield addTask('message', userList);\n  return res;\n}).then(\n  function (val) { console.info('ok: ',val); },\n  function (err) { console.error('ng: ',err); }\n);\n\n```\n\n\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\n```bash\n$ chtoken=xxxxxxxxx node chtask.js\n```\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u30bf\u30b9\u30af\u8ffd\u52a0\u3067\u304d\u307e\u3057\u305f\u3002\n\n\u0010![](https://i.gyazo.com/a9cf108ef1720b99bd9c33c9e64f7ca9.png)\n\n\nAPI\u3092\u4e8c\u56de\u6295\u3052\u308b\u3042\u305f\u308a\u306f\u975e\u540c\u671f\u51e6\u7406\u306e\u7df4\u7fd2\u306b\u306a\u308a\u307e\u3059\u306d\u301c\n", "tags": ["chatwork", "Node.js", "JavaScript", "es2015"]}