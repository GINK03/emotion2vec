{"tags": ["openstack"], "context": " More than 1 year has passed since last update.\n\nOpenStack Install (compat Openstack-havana 2013.2-1.el6)\nOpenstack\u306e\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304b\u3089\u3001\u5b9f\u969b\u306b\u4f7f\u7528\u3057\u305f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30b3\u30de\u30f3\u30c9\u3092\u30e1\u30e2\u306b\u8d77\u3053\u3057\u307e\u3057\u305f\u3002\n\u60f3\u5b9a\u74b0\u5883\u306fCentOS6.4\uff08minimal\uff09\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30dc\u30ea\u30e5\u30fc\u30e0\u306fNFS\u74b0\u5883\u3002\n\n1. Local settings\n\nMySQL\nLocalinstall\u3059\u308b\u306e\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304f\u3053\u3068\u3002\nyum localinstall MySQL-shared-compat-5.6.14-1.linux_glibc2.5.x86_64.rpm\nyum localinstall MySQL-server-5.6.14-1.linux_glibc2.5.x86_64.rpm\nyum localinstall MySQL-server-5.6.14-1.linux_glibc2.5.x86_64.rpm\nyum localinstall MySQL-client-5.6.14-1.linux_glibc2.5.x86_64.rpm\n\nservice mysql start\nchkconfig mysql on\nmysql_secure_installation\n\n\nInstall Repo\nyum install http://repos.fedorapeople.org/repos/openstack/openstack-havana/rdo-release-havana-6.noarch.rpm\nyum install http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm\n\n\nInstall Openstack-util,Apache Qpid\nyum install openstack-utils\nyum -y install qpid-cpp-server memcached\n\n\nqpid config\nvi /etc/qpidd.conf\n\nauth=no\n\nservice qpidd start\nchkconfig qpidd on\n\n\n2. Install Keystone\nyum install openstack-keystone python-keystoneclient\n\n\nDB config\nopenstack-config --set /etc/keystone/keystone.conf \\\nsql connection mysql://keystone:keystone@localhost/keystone\n\nopenstack-db --init --service keystone --password keystone\n\n\nCreate Token\nADMIN_TOKEN=$(openssl rand -hex 10)\necho $ADMIN_TOKEN\nopenstack-config --set /etc/keystone/keystone.conf DEFAULT \\\nadmin_token $ADMIN_TOKEN\n\nkeystone-manage pki_setup --keystone-user keystone --keystone-group keystone\nchown -R keystone:keystone /etc/keystone/* /var/log/keystone/keystone.log\n\nservice openstack-keystone start\nchkconfig openstack-keystone on\n\n\nDefine users, tenants, and roles\nexport OS_SERVICE_TOKEN=$ADMIN_TOKEN\nexport OS_SERVICE_ENDPOINT=http://openstack_host:35357/v2.0\n\nkeystone tenant-create --name=admin --description=\"Admin Tenant\"\nkeystone tenant-create --name=service --description=\"Service Tenant\"\n\nkeystone user-create --name=admin --pass=admin\nkeystone role-create --name=admin\n\n\nCreate a service entry for the Identity Service.\nkeystone service-create --name=keystone --type=identity --description=\"Keystone Identity Service\"\n\nkeystone endpoint-create \\\n  --service-id=above_display_sid \\\n  --publicurl=http://openstack_host:5000/v2.0 \\\n  --internalurl=http://openstack_host:5000/v2.0 \\\n  --adminurl=http://openstack_host:35357/v2.0\n\n\n3. Install the Image Service\n\nDB config\nopenstack-config --set /etc/glance/glance-api.conf \\\n   DEFAULT sql_connection mysql://glance:glance@localhost/glance\nopenstack-config --set /etc/glance/glance-registry.conf \\\n   DEFAULT sql_connection mysql://glance:glance@localhost:/glance\nopenstack-db --init --service glance --password glance\n\n\nCreate a user entry for the Image Service\nkeystone user-create --name=glance --pass=glance\nkeystone user-role-add --user=glance --tenant=service --role=admin\n\n\nConfig authtoken\nopenstack-config --set /etc/glance/glance-api.conf keystone_authtoken \\\n   auth_host openstack_host\nopenstack-config --set /etc/glance/glance-api.conf keystone_authtoken \\\n   admin_user glance\nopenstack-config --set /etc/glance/glance-api.conf keystone_authtoken \\\n   admin_tenant_name service\nopenstack-config --set /etc/glance/glance-api.conf keystone_authtoken \\\n   admin_password glance\nopenstack-config --set /etc/glance/glance-registry.conf \\\n  keystone_authtoken auth_host openstack_host\nopenstack-config --set /etc/glance/glance-registry.conf \\\n   keystone_authtoken admin_user glance\nopenstack-config --set /etc/glance/glance-registry.conf \\\n   keystone_authtoken admin_tenant_name service\nopenstack-config --set /etc/glance/glance-registry.conf \\\n   keystone_authtoken admin_password glance\n\n\nConfig authtoken (glance-api-paste)\ncp /usr/share/glance/glance-api-dist-paste.ini /etc/glance/glance-api-paste.ini\ncp /usr/share/glance/glance-registry-dist-paste.ini /etc/glance/glance-registry-paste.ini\n\nvi /etc/glance/glance-api-paste.ini\nvi /etc/glance/glance-registry-paste.ini\n\n\n[filter:authtoken]\n\n[filter:authtoken]\npaste.filter_factory=keystoneclient.middleware.auth_token:filter_factory\nauth_host=controller\nadmin_user=glance\nadmin_tenant_name=service\nadmin_password=GLANCE_PASS\n\n\nCreate a service entry for the Identity Service.\nkeystone service-create --name=glance --type=image \\\n  --description=\"Glance Image Service\"\n\nkeystone endpoint-create \\\n  --service-id=above_display_sid \\\n  --publicurl=http://openstack_host:9292 \\\n  --internalurl=http://openstack_host:9292 \\\n  --adminurl=http://openstack_host:9292\n\nservice openstack-glance-api start\nservice openstack-glance-registry start\nchkconfig openstack-glance-api on\nchkconfig openstack-glance-registry on\n\n\nVerify\nmkdir images\ncd images/\nwget http://cdn.download.cirros-cloud.net/0.3.1/cirros-0.3.1-x86_64-disk.img\n\nglance image-create --name=\"CirrOS 0.3.1\" --disk-format=qcow2 \\\n  --container-format=bare --is-public=true < cirros-0.3.1-x86_64-disk.img\n\n\n4. Install the Compute controller services\nyum install openstack-nova python-novaclient\n\n\nSetting DB\nopenstack-config --set /etc/nova/nova.conf \\\n  database connection mysql://nova:nova@localhost/nova\n\nopenstack-db --init --service nova --password NOVA_DBPASS\n\n\nConfig\nopenstack-config --set /etc/nova/nova.conf DEFAULT my_ip nova_ip_address\nopenstack-config --set /etc/nova/nova.conf DEFAULT vncserver_listen nova_ip_address\nopenstack-config --set /etc/nova/nova.conf DEFAULT vncserver_proxyclient_address nova_ip_address\n\n\nCreate a user entry for the Compute Service.\nkeystone user-create --name=nova --pass=nova\nkeystone user-role-add --user=nova --tenant=service --role=admin\n\n\nConfig Auth\nopenstack-config --set /etc/nova/nova.conf DEFAULT auth_strategy keystone\nopenstack-config --set /etc/nova/nova.conf DEFAULT auth_host openstack_host\nopenstack-config --set /etc/nova/nova.conf DEFAULT admin_user nova\nopenstack-config --set /etc/nova/nova.conf DEFAULT admin_tenant_name service\nopenstack-config --set /etc/nova/nova.conf DEFAULT admin_password nova\n\n\nedit api e.g. https://bugs.launchpad.net/nova/+bug/1237334\n\nvi /etc/nova/nova.conf\n\n# a list of APIs to enable by default (list value)\n#enabled_apis=ec2,osapi_compute,metadata\nenabled_apis=ec2,osapi_compute\n\n\nCreate a service entry for the Identity Service.\nkeystone service-create --name=nova --type=compute \\\n  --description=\"Nova Compute service\"\n\nkeystone endpoint-create \\\n  --service-id=cb15dabf3b164ddda40e74bc32bcbe85 \\\n  --publicurl=http://openstack01:8774/v2/%\\(tenant_id\\)s \\\n  --internalurl=http://openstack01:8774/v2/%\\(tenant_id\\)s \\\n  --adminurl=http://openstack01:8774/v2/%\\(tenant_id\\)s\n\n\nConfig qpid\nopenstack-config --set /etc/nova/nova.conf \\\n  DEFAULT rpc_backend nova.openstack.common.rpc.impl_qpid\nopenstack-config --set /etc/nova/nova.conf DEFAULT qpid_hostname openstack01\n\nservice openstack-nova-api start\nservice openstack-nova-cert start\nservice openstack-nova-consoleauth start\nservice openstack-nova-scheduler start\nservice openstack-nova-conductor start\nservice openstack-nova-novncproxy start\nchkconfig openstack-nova-api on\nchkconfig openstack-nova-cert on\nchkconfig openstack-nova-consoleauth on\nchkconfig openstack-nova-scheduler on\nchkconfig openstack-nova-conductor on\nchkconfig openstack-nova-novncproxy on\n\n\nConfigure a Compute node\nservice libvirtd start\nservice messagebus start\nchkconfig libvirtd on\nchkconfig messagebus on\nservice openstack-nova-compute start\nchkconfig openstack-nova-compute on\n\n\nConfig network\nopenstack-config --set /etc/nova/nova.conf DEFAULT \\\n  network_manager nova.network.manager.FlatDHCPManager\nopenstack-config --set /etc/nova/nova.conf DEFAULT \\\n  firewall_driver nova.virt.libvirt.firewall.IptablesFirewallDriver\nopenstack-config --set /etc/nova/nova.conf DEFAULT network_size 254\nopenstack-config --set /etc/nova/nova.conf DEFAULT allow_same_net_traffic False\nopenstack-config --set /etc/nova/nova.conf DEFAULT multi_host True\nopenstack-config --set /etc/nova/nova.conf DEFAULT send_arp_for_ha True\nopenstack-config --set /etc/nova/nova.conf DEFAULT share_dhcp_address True\nopenstack-config --set /etc/nova/nova.conf DEFAULT force_dhcp_release True\nopenstack-config --set /etc/nova/nova.conf DEFAULT flat_interface eth1\nopenstack-config --set /etc/nova/nova.conf DEFAULT flat_network_bridge br100\nopenstack-config --set /etc/nova/nova.conf DEFAULT public_interface eth1\n\nservice openstack-nova-metadata-api start\nchkconfig openstack-nova-metadata-api on\n\nservice openstack-nova-network start\nchkconfig openstack-nova-network on\n\n\n\nomake\nfor i in cert compute conductor console consoleauth metadata-api novncproxy network; do\nservice openstack-nova-$i restart\ndone\n\n\nCreate nova-network\nsource keystonerc\nnova network-create vmnet --fixed-range-v4=10.0.0.0/24 \\\n  --bridge-interface=br100 --multi-host=T\n\n# backup iptables (or stop iptables)\niptables-save > iptables-origin\n\niptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 35357 -j ACCEPT\niptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 8774 -j ACCEPT\niptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 9292 -j ACCEPT\niptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 5000 -j ACCEPT\n\n\n5. Install the dashboard\nyum install memcached python-memcached python-pbr mod_wsgi openstack-dashboard\n\n\nConfig dashboard\nvi /etc/openstack-dashboard/local_settings\n\n\nMemcache\n\nCACHES = {\n'default': {\n'BACKEND' : 'django.core.cache.backends.memcached.MemcachedCache',\n'LOCATION' : '127.0.0.1:11211'\n}\n}\n\n\nDashboard ACL\n\nALLOWED_HOSTS = ['localhost', 'my-desktop']\n\n\nCompute Node\n\nOPENSTACK_HOST = \"openstack_host\"\n\nservice httpd start\nservice memcached start\nchkconfig httpd on\nchkconfig memcached on\n\n\n6. Install and configure a Block Storage Service controller\nyum install openstack-cinder openstack-utils openstack-selinux\n\n\nSetting DB\nopenstack-config --set /etc/cinder/cinder.conf \\\n        database connection mysql://cinder:cinder@localhost/cinder\n\nopenstack-db --init --service cinder --password cinder\n\n\nCreate a user entry for the Block storage Service.\nkeystone user-create --name=cinder --pass=cinder \nkeystone user-role-add --user=cinder --tenant=service --role=admin\n\nopenstack-config --set /etc/cinder/cinder.conf \\\n  DEFAULT rpc_backend cinder.openstack.common.rpc.impl_qpid\nopenstack-config --set /etc/cinder/cinder.conf \\\n  DEFAULT qpid_hostname openstack01\n\n\nCreate a service entry for the Block storage Service.\nkeystone service-create --name=cinder --type=volume \\\n  --description=\"Cinder Volume Service\"\n\nkeystone endpoint-create \\\n  --service-id=above_display_sid \\\n  --publicurl=http://openstack01:8776/v1/%\\(tenant_id\\)s \\\n  --internalurl=http://openstack01:8776/v1/%\\(tenant_id\\)s \\\n  --adminurl=http://openstack01:8776/v1/%\\(tenant_id\\)s\n\nkeystone endpoint-create \\\n  --service-id=above_display_sid \\\n  --publicurl=http://openstack01:8776/v2/%\\(tenant_id\\)s \\\n  --internalurl=http://openstack01:8776/v2/%\\(tenant_id\\)s \\\n  --adminurl=http://openstack01:8776/v2/%\\(tenant_id\\)s\n\n\nSetting NFS\n\nDriver(nova.conf)\nvi /etc/nova/nova.conf\n\n# Libvirt handlers for remote volumes. (list value)\nlibvirt_volume_drivers=iscsi=nova.virt.libvirt.volume.LibvirtISCSIVolumeDriver,iser=nova.virt.libvirt.volume.LibvirtISERVolumeDriver,local=nova.virt.libvirt.volume.LibvirtVolumeDriver,fake=nova.virt.libvirt.volume.LibvirtFakeVolumeDriver,rbd=nova.virt.libvirt.volume.LibvirtNetVolumeDriver,sheepdog=nova.virt.libvirt.volume.LibvirtNetVolumeDriver,nfs=nova.virt.libvirt.volume.LibvirtNFSVolumeDriver,aoe=nova.virt.libvirt.volume.LibvirtAOEVolumeDriver,glusterfs=nova.virt.libvirt.volume.LibvirtGlusterfsVolumeDriver,fibre_channel=nova.virt.libvirt.volume.LibvirtFibreChannelVolumeDriver,scality=nova.virt.libvirt.volume.LibvirtScalityVolumeDriver\n\n\nDisk list\nvi /etc/cinder/shares\n\nNFS_STORAGE:/openstack\n\n\nMount\nvi /etc/cinder/cinder.conf\n\n\nDisk list\n\n# File with the list of available nfs shares (string value)\nnfs_shares_config=/etc/cinder/shares\n\n\nMount point\n\n# Base dir containing mount points for nfs shares. (string\n# value)\nnfs_mount_point_base=/var/lib/cinder/nfs\n\n\nCreate rootwrap.d\nmkdir -p /etc/cinder/rootwrap.d\nchgrp -R cinder /etc/cinder/rootwrap.d\nvi /etc/cinder/rootwrap.d/volume.filters\n\n\n[Filters]\n# cinder/volume/nfs.py\nstat: CommandFilter, /usr/bin/stat, root\nmount: CommandFilter, /bin/mount, root\ndf: CommandFilter, /bin/df, root\ntruncate: CommandFilter, /usr/bin/truncate, root\nchmod: CommandFilter, /bin/chmod, root\nrm: CommandFilter, /bin/rm, root\n\nservice openstack-cinder-api start\nservice openstack-cinder-scheduler start\nchkconfig openstack-cinder-api on\nchkconfig openstack-cinder-scheduler on\nservice openstack-cinder-volume start\nchkconfig openstack-cinder-volume on\n\n# OpenStack Install (compat Openstack-havana 2013.2-1.el6)\nOpenstack\u306e\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304b\u3089\u3001\u5b9f\u969b\u306b\u4f7f\u7528\u3057\u305f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30b3\u30de\u30f3\u30c9\u3092\u30e1\u30e2\u306b\u8d77\u3053\u3057\u307e\u3057\u305f\u3002\n\u60f3\u5b9a\u74b0\u5883\u306fCentOS6.4\uff08minimal\uff09\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30dc\u30ea\u30e5\u30fc\u30e0\u306fNFS\u74b0\u5883\u3002\n\n## 1. Local settings\n\n### MySQL\nLocalinstall\u3059\u308b\u306e\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304f\u3053\u3068\u3002\n\n```\nyum localinstall MySQL-shared-compat-5.6.14-1.linux_glibc2.5.x86_64.rpm\nyum localinstall MySQL-server-5.6.14-1.linux_glibc2.5.x86_64.rpm\nyum localinstall MySQL-server-5.6.14-1.linux_glibc2.5.x86_64.rpm\nyum localinstall MySQL-client-5.6.14-1.linux_glibc2.5.x86_64.rpm\n\nservice mysql start\nchkconfig mysql on\nmysql_secure_installation\n```\n\n### Install Repo\n```\nyum install http://repos.fedorapeople.org/repos/openstack/openstack-havana/rdo-release-havana-6.noarch.rpm\nyum install http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm\n```\n### Install Openstack-util,Apache Qpid\n```\nyum install openstack-utils\nyum -y install qpid-cpp-server memcached\n```\n#### qpid config \n```\nvi /etc/qpidd.conf\n\nauth=no\n```\n```\nservice qpidd start\nchkconfig qpidd on\n```\n\n## 2. Install Keystone\n```\nyum install openstack-keystone python-keystoneclient\n```\n\n### DB config\n```\nopenstack-config --set /etc/keystone/keystone.conf \\\nsql connection mysql://keystone:keystone@localhost/keystone\n\nopenstack-db --init --service keystone --password keystone\n```\n### Create Token\n```\nADMIN_TOKEN=$(openssl rand -hex 10)\necho $ADMIN_TOKEN\nopenstack-config --set /etc/keystone/keystone.conf DEFAULT \\\nadmin_token $ADMIN_TOKEN\n\nkeystone-manage pki_setup --keystone-user keystone --keystone-group keystone\nchown -R keystone:keystone /etc/keystone/* /var/log/keystone/keystone.log\n```\n```\nservice openstack-keystone start\nchkconfig openstack-keystone on\n```\n\n### Define users, tenants, and roles\n\n```\nexport OS_SERVICE_TOKEN=$ADMIN_TOKEN\nexport OS_SERVICE_ENDPOINT=http://openstack_host:35357/v2.0\n\nkeystone tenant-create --name=admin --description=\"Admin Tenant\"\nkeystone tenant-create --name=service --description=\"Service Tenant\"\n\nkeystone user-create --name=admin --pass=admin\nkeystone role-create --name=admin\n```\n### Create a service entry for the Identity Service.\n```\nkeystone service-create --name=keystone --type=identity --description=\"Keystone Identity Service\"\n\nkeystone endpoint-create \\\n  --service-id=above_display_sid \\\n  --publicurl=http://openstack_host:5000/v2.0 \\\n  --internalurl=http://openstack_host:5000/v2.0 \\\n  --adminurl=http://openstack_host:35357/v2.0\n```\n\n\n\n## 3. Install the Image Service\n\n### DB config\n```\nopenstack-config --set /etc/glance/glance-api.conf \\\n   DEFAULT sql_connection mysql://glance:glance@localhost/glance\nopenstack-config --set /etc/glance/glance-registry.conf \\\n   DEFAULT sql_connection mysql://glance:glance@localhost:/glance\nopenstack-db --init --service glance --password glance\n```\n### Create a user entry for the Image Service\n```\nkeystone user-create --name=glance --pass=glance\nkeystone user-role-add --user=glance --tenant=service --role=admin\n```\n\n### Config authtoken\n```\nopenstack-config --set /etc/glance/glance-api.conf keystone_authtoken \\\n   auth_host openstack_host\nopenstack-config --set /etc/glance/glance-api.conf keystone_authtoken \\\n   admin_user glance\nopenstack-config --set /etc/glance/glance-api.conf keystone_authtoken \\\n   admin_tenant_name service\nopenstack-config --set /etc/glance/glance-api.conf keystone_authtoken \\\n   admin_password glance\nopenstack-config --set /etc/glance/glance-registry.conf \\\n  keystone_authtoken auth_host openstack_host\nopenstack-config --set /etc/glance/glance-registry.conf \\\n   keystone_authtoken admin_user glance\nopenstack-config --set /etc/glance/glance-registry.conf \\\n   keystone_authtoken admin_tenant_name service\nopenstack-config --set /etc/glance/glance-registry.conf \\\n   keystone_authtoken admin_password glance\n```\n### Config authtoken (glance-api-paste)\n```\ncp /usr/share/glance/glance-api-dist-paste.ini /etc/glance/glance-api-paste.ini\ncp /usr/share/glance/glance-registry-dist-paste.ini /etc/glance/glance-registry-paste.ini\n```\n```\nvi /etc/glance/glance-api-paste.ini\nvi /etc/glance/glance-registry-paste.ini\n```\n - [filter:authtoken]\n\n```\n[filter:authtoken]\npaste.filter_factory=keystoneclient.middleware.auth_token:filter_factory\nauth_host=controller\nadmin_user=glance\nadmin_tenant_name=service\nadmin_password=GLANCE_PASS\n```\n\n### Create a service entry for the Identity Service.\n```\nkeystone service-create --name=glance --type=image \\\n  --description=\"Glance Image Service\"\n\nkeystone endpoint-create \\\n  --service-id=above_display_sid \\\n  --publicurl=http://openstack_host:9292 \\\n  --internalurl=http://openstack_host:9292 \\\n  --adminurl=http://openstack_host:9292\n```\n```\nservice openstack-glance-api start\nservice openstack-glance-registry start\nchkconfig openstack-glance-api on\nchkconfig openstack-glance-registry on\n```\n\n### Verify\n```\nmkdir images\ncd images/\nwget http://cdn.download.cirros-cloud.net/0.3.1/cirros-0.3.1-x86_64-disk.img\n\nglance image-create --name=\"CirrOS 0.3.1\" --disk-format=qcow2 \\\n  --container-format=bare --is-public=true < cirros-0.3.1-x86_64-disk.img\n```\n\n## 4. Install the Compute controller services\n\n```\nyum install openstack-nova python-novaclient\n```\n\n### Setting DB\n```\nopenstack-config --set /etc/nova/nova.conf \\\n  database connection mysql://nova:nova@localhost/nova\n\nopenstack-db --init --service nova --password NOVA_DBPASS\n```\n\n### Config\n```\nopenstack-config --set /etc/nova/nova.conf DEFAULT my_ip nova_ip_address\nopenstack-config --set /etc/nova/nova.conf DEFAULT vncserver_listen nova_ip_address\nopenstack-config --set /etc/nova/nova.conf DEFAULT vncserver_proxyclient_address nova_ip_address\n```\n\n### Create a user entry for the Compute Service.\n```\nkeystone user-create --name=nova --pass=nova\nkeystone user-role-add --user=nova --tenant=service --role=admin\n```\n\n### Config Auth\n```\nopenstack-config --set /etc/nova/nova.conf DEFAULT auth_strategy keystone\nopenstack-config --set /etc/nova/nova.conf DEFAULT auth_host openstack_host\nopenstack-config --set /etc/nova/nova.conf DEFAULT admin_user nova\nopenstack-config --set /etc/nova/nova.conf DEFAULT admin_tenant_name service\nopenstack-config --set /etc/nova/nova.conf DEFAULT admin_password nova\n```\n\n### edit api e.g. https://bugs.launchpad.net/nova/+bug/1237334\n\n```\nvi /etc/nova/nova.conf\n```\n```\n# a list of APIs to enable by default (list value)\n#enabled_apis=ec2,osapi_compute,metadata\nenabled_apis=ec2,osapi_compute\n```\n\n### Create a service entry for the Identity Service.\n```\nkeystone service-create --name=nova --type=compute \\\n  --description=\"Nova Compute service\"\n\nkeystone endpoint-create \\\n  --service-id=cb15dabf3b164ddda40e74bc32bcbe85 \\\n  --publicurl=http://openstack01:8774/v2/%\\(tenant_id\\)s \\\n  --internalurl=http://openstack01:8774/v2/%\\(tenant_id\\)s \\\n  --adminurl=http://openstack01:8774/v2/%\\(tenant_id\\)s\n```\n\n### Config qpid\n```\nopenstack-config --set /etc/nova/nova.conf \\\n  DEFAULT rpc_backend nova.openstack.common.rpc.impl_qpid\nopenstack-config --set /etc/nova/nova.conf DEFAULT qpid_hostname openstack01\n```\n\n```\nservice openstack-nova-api start\nservice openstack-nova-cert start\nservice openstack-nova-consoleauth start\nservice openstack-nova-scheduler start\nservice openstack-nova-conductor start\nservice openstack-nova-novncproxy start\nchkconfig openstack-nova-api on\nchkconfig openstack-nova-cert on\nchkconfig openstack-nova-consoleauth on\nchkconfig openstack-nova-scheduler on\nchkconfig openstack-nova-conductor on\nchkconfig openstack-nova-novncproxy on\n```\n\n\n### Configure a Compute node\n```\nservice libvirtd start\nservice messagebus start\nchkconfig libvirtd on\nchkconfig messagebus on\nservice openstack-nova-compute start\nchkconfig openstack-nova-compute on\n```\n### Config network\n```\nopenstack-config --set /etc/nova/nova.conf DEFAULT \\\n  network_manager nova.network.manager.FlatDHCPManager\nopenstack-config --set /etc/nova/nova.conf DEFAULT \\\n  firewall_driver nova.virt.libvirt.firewall.IptablesFirewallDriver\nopenstack-config --set /etc/nova/nova.conf DEFAULT network_size 254\nopenstack-config --set /etc/nova/nova.conf DEFAULT allow_same_net_traffic False\nopenstack-config --set /etc/nova/nova.conf DEFAULT multi_host True\nopenstack-config --set /etc/nova/nova.conf DEFAULT send_arp_for_ha True\nopenstack-config --set /etc/nova/nova.conf DEFAULT share_dhcp_address True\nopenstack-config --set /etc/nova/nova.conf DEFAULT force_dhcp_release True\nopenstack-config --set /etc/nova/nova.conf DEFAULT flat_interface eth1\nopenstack-config --set /etc/nova/nova.conf DEFAULT flat_network_bridge br100\nopenstack-config --set /etc/nova/nova.conf DEFAULT public_interface eth1\n\nservice openstack-nova-metadata-api start\nchkconfig openstack-nova-metadata-api on\n\nservice openstack-nova-network start\nchkconfig openstack-nova-network on\n\n```\n\n#### omake\n```\nfor i in cert compute conductor console consoleauth metadata-api novncproxy network; do\nservice openstack-nova-$i restart\ndone\n```\n\n### Create nova-network\n```\nsource keystonerc\nnova network-create vmnet --fixed-range-v4=10.0.0.0/24 \\\n  --bridge-interface=br100 --multi-host=T\n\n# backup iptables (or stop iptables)\niptables-save > iptables-origin\n\niptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 35357 -j ACCEPT\niptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 8774 -j ACCEPT\niptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 9292 -j ACCEPT\niptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 5000 -j ACCEPT\n```\n\n## 5. Install the dashboard\n```\nyum install memcached python-memcached python-pbr mod_wsgi openstack-dashboard\n```\n\n### Config dashboard \n```\nvi /etc/openstack-dashboard/local_settings\n```\n\n - Memcache\n\n```\nCACHES = {\n'default': {\n'BACKEND' : 'django.core.cache.backends.memcached.MemcachedCache',\n'LOCATION' : '127.0.0.1:11211'\n}\n}\n```\n\n - Dashboard ACL\n\n```\nALLOWED_HOSTS = ['localhost', 'my-desktop']\n```\n\n - Compute Node\n\n```\nOPENSTACK_HOST = \"openstack_host\"\n```\n  \n```\nservice httpd start\nservice memcached start\nchkconfig httpd on\nchkconfig memcached on\n```\n\n## 6. Install and configure a Block Storage Service controller\n```\nyum install openstack-cinder openstack-utils openstack-selinux\n```\n\n### Setting DB\n```\nopenstack-config --set /etc/cinder/cinder.conf \\\n        database connection mysql://cinder:cinder@localhost/cinder\n\nopenstack-db --init --service cinder --password cinder\n```\n\n### Create a user entry for the Block storage Service. \n```\nkeystone user-create --name=cinder --pass=cinder \nkeystone user-role-add --user=cinder --tenant=service --role=admin\n\nopenstack-config --set /etc/cinder/cinder.conf \\\n  DEFAULT rpc_backend cinder.openstack.common.rpc.impl_qpid\nopenstack-config --set /etc/cinder/cinder.conf \\\n  DEFAULT qpid_hostname openstack01\n```\n\n### Create a service entry for the Block storage Service.\n```\nkeystone service-create --name=cinder --type=volume \\\n  --description=\"Cinder Volume Service\"\n\nkeystone endpoint-create \\\n  --service-id=above_display_sid \\\n  --publicurl=http://openstack01:8776/v1/%\\(tenant_id\\)s \\\n  --internalurl=http://openstack01:8776/v1/%\\(tenant_id\\)s \\\n  --adminurl=http://openstack01:8776/v1/%\\(tenant_id\\)s\n\nkeystone endpoint-create \\\n  --service-id=above_display_sid \\\n  --publicurl=http://openstack01:8776/v2/%\\(tenant_id\\)s \\\n  --internalurl=http://openstack01:8776/v2/%\\(tenant_id\\)s \\\n  --adminurl=http://openstack01:8776/v2/%\\(tenant_id\\)s\n```\n\n### \n\n### Setting NFS\n\n#### Driver(nova.conf)\n```\nvi /etc/nova/nova.conf\n```\n```\n# Libvirt handlers for remote volumes. (list value)\nlibvirt_volume_drivers=iscsi=nova.virt.libvirt.volume.LibvirtISCSIVolumeDriver,iser=nova.virt.libvirt.volume.LibvirtISERVolumeDriver,local=nova.virt.libvirt.volume.LibvirtVolumeDriver,fake=nova.virt.libvirt.volume.LibvirtFakeVolumeDriver,rbd=nova.virt.libvirt.volume.LibvirtNetVolumeDriver,sheepdog=nova.virt.libvirt.volume.LibvirtNetVolumeDriver,nfs=nova.virt.libvirt.volume.LibvirtNFSVolumeDriver,aoe=nova.virt.libvirt.volume.LibvirtAOEVolumeDriver,glusterfs=nova.virt.libvirt.volume.LibvirtGlusterfsVolumeDriver,fibre_channel=nova.virt.libvirt.volume.LibvirtFibreChannelVolumeDriver,scality=nova.virt.libvirt.volume.LibvirtScalityVolumeDriver\n```\n\n#### Disk list\n``` \nvi /etc/cinder/shares\n\nNFS_STORAGE:/openstack\n```\n\n#### Mount\n```\nvi /etc/cinder/cinder.conf\n```\n\n - Disk list\n\n```\n# File with the list of available nfs shares (string value)\nnfs_shares_config=/etc/cinder/shares\n```\n\n - Mount point\n\n```\n# Base dir containing mount points for nfs shares. (string\n# value)\nnfs_mount_point_base=/var/lib/cinder/nfs\n```\n\n#### Create rootwrap.d\n```\nmkdir -p /etc/cinder/rootwrap.d\nchgrp -R cinder /etc/cinder/rootwrap.d\nvi /etc/cinder/rootwrap.d/volume.filters\n\n\n[Filters]\n# cinder/volume/nfs.py\nstat: CommandFilter, /usr/bin/stat, root\nmount: CommandFilter, /bin/mount, root\ndf: CommandFilter, /bin/df, root\ntruncate: CommandFilter, /usr/bin/truncate, root\nchmod: CommandFilter, /bin/chmod, root\nrm: CommandFilter, /bin/rm, root\n```\n\n```\nservice openstack-cinder-api start\nservice openstack-cinder-scheduler start\nchkconfig openstack-cinder-api on\nchkconfig openstack-cinder-scheduler on\nservice openstack-cinder-volume start\nchkconfig openstack-cinder-volume on\n```"}