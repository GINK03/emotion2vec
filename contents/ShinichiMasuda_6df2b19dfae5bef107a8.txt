{"context": "GMO\u30af\u30e9\u30a6\u30c9ALTUS(\u30a2\u30eb\u30bf\u30b9)\u3068\u5951\u7d04\u3057\u3066\u3001\u958b\u767a\u3057\u305fDjango\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092 Nginx + uWSGI + MySQL + Python3 \u306e\u74b0\u5883\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u306e\u3067\u3001\u5b9f\u884c\u3057\u305f\u64cd\u4f5c\u3092\u5099\u5fd8\u9332\u3068\u3057\u3066\u6b8b\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u5358\u306a\u308b\u4f5c\u696d\u30e1\u30e2\u306a\u306e\u3067\u3001\u5fc5\u305a\u3057\u3082\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3067\u306f\u306a\u3044\u3053\u3068\u306b\u3054\u6ce8\u610f\u4e0b\u3055\u3044\u3002\u9593\u9055\u3044\u3084\u4e0d\u8db3\u304c\u3042\u308c\u3070\u9060\u616e\u306a\u304f\u3054\u6307\u6458\u4e0b\u3055\u3044\uff08\u7b11\uff09\n\n\u904b\u7528\u74b0\u5883\n\u307e\u305a\u3001WSGI(Web Server Gateway Interface)\u3068\u306f\u3001Python\u3067\u8a18\u8ff0\u3057\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068Web\u30b5\u30fc\u30d0\u30fc\u306e\u9593\u306e\u6a19\u6e96\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9(PEP333)\u3067\u3001uWSGI\u306fWSGI\u4ed5\u69d8\u306b\u5f93\u3063\u305fWeb\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u52d5\u304b\u3059\u3053\u3068\u304c\u3067\u304d\u308bWeb\u30b5\u30fc\u30d0\u30fc\u3092\u6307\u3057\u307e\u3059\u3002\nDjango\u3067\u4f5c\u6210\u3057\u305f\u30a2Web\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306fWSGI\u3067\u52d5\u4f5c\u3059\u308b\u3088\u3046\u306b\u8a2d\u8a08\u3057\u3066\u3044\u3066\u3001\u69d8\u3005\u306a\u69cb\u6210\u3067\u904b\u7528\u3067\u304d\u308b\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306fPycon2015\u306eYuri Umezaki\u3055\u3093\u306e\u767a\u8868\uff08uWSGI/Docker\u3092\u5229\u7528\u3057\u305fWeb\u30b5\u30fc\u30d3\u30b9\u904b\u7528\u4e8b\u4f8b\uff09\u3092\u53c2\u8003\u306b\u4ee5\u4e0b\u306e\u69cb\u6210\u3067\u69cb\u7bc9\u3057\u307e\u3057\u305f\u3002\n\nGMO\u30af\u30e9\u30a6\u30c9ALTUS Basic\u30d7\u30e9\u30f3\nUbuntu 16.04.1 LTS (GNU/Linux 4.4.0-47-generic x86_64)\nNginx 1.11.6\nuWSGI 2.0.14\nMySQL 5.7.16\nPython 3.5.2\nDjango 1.10.3\n\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u69cb\u6210\nWeb Browser <--> Nginx <--> socket <--> uWSGI <--> Djnago <--> MySQL\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\n/\n\u2514\u2500\u2500 var/\n    \u2514\u2500\u2500 www/\n        \u2514\u2500\u2500 example.jp/           <- \u30c7\u30d7\u30ed\u30a4\u5148\u306e\u30d5\u30a9\u30eb\u30c0\n            \u251c\u2500\u2500 venv/             <- \u4eee\u60f3\u74b0\u5883\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n            \u2502   \u251c\u2500\u2500 app           <- Django\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30eb\u30fc\u30c8(django-admin startproject app \u3067\u4f5c\u6210)\n            \u2502   \u2502   \u2514 main        <- Django\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30c8(python manage.py startapp main)\n            \u2502   \u251c\u2500\u2500 uwsgi.ini     <- uwsgi\u306e\u8d77\u52d5\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u7ba1\u7406\u3059\u308bINI\u30d5\u30a1\u30a4\u30eb\n            \u2502   \u2514\u2500\u2500 uwsgi_params  <- uswgi\u306e\u5909\u6570\u3092\u683c\u7d0d\u3059\u308b\u30d5\u30a1\u30a4\u30eb\n            \u2514\u2500\u2500 static            <- \u9759\u7684\u30d5\u30a1\u30a4\u30eb\u3092\u683c\u7d0d\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n\n\n\u30b5\u30fc\u30d0\u30fc\u306e\u521d\u671f\u8a2d\u5b9a\n\n1. \u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u306e\u8a2d\u5b9a\n\nGMO\u30af\u30e9\u30a6\u30c9ALTUS\u306b\u306f\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u3092\u753b\u9762\u304b\u3089\u8a2d\u5b9a\u3067\u304d\u308b\u6a5f\u80fd\u304c\u3042\u308b\u306e\u3067\u3001GMO\u30af\u30e9\u30a6\u30c9 ALTUS\u30a2\u30eb\u30bf\u30b9 Basic\u30b7\u30ea\u30fc\u30ba \u30ac\u30a4\u30c9 - \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u65b0\u898f\u4f5c\u6210\u306b\u5f93\u3063\u3066\u3001\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u307e\u305a\u3001\u300c22\u300d\u3068\u300c80\u300d\u306e\u307f\u30dd\u30fc\u30c8\u3092\u89e3\u653e\u3057\u307e\u3057\u305f\u3002\n\n2. \u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\u306b\u30ed\u30b0\u30a4\u30f3\n\nGMO\u30af\u30e9\u30a6\u30c9ALTUS - Basic\u30d7\u30e9\u30f3\u306eUbuntu\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3067\u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u4f5c\u6210\u3067\u304d\u305f\u3089\u3001\u300ccloud\u300d\u3068\u3044\u3046\u30e6\u30fc\u30b6\u30fc\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u307e\u3059\u3002\u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\u4f5c\u6210\u5f8c\u306b\u3001\u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\u306e\u30ed\u30b0\u30a4\u30f3\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u30c0\u30a4\u30a2\u30ed\u30b0\u306b\u8868\u793a\u3057\u307e\u3059\u3002\u4ed6\u306e\u753b\u9762\u3067\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u306e\u3067\u3001\u5fd8\u308c\u306a\u3044\u3088\u3046\u30e1\u30e2\u3057\u307e\u3059\u3002\n\n3. SSH\u30dd\u30fc\u30c8\u306e\u5909\u66f4\u3068root\u30e6\u30fc\u30b6\u30fc\u306b\u3088\u308b\u30ed\u30b0\u30a4\u30f3\u306e\u7981\u6b62\n\nSSH\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u300c22\u300d\u306f\u3088\u304f\u30cf\u30c3\u30ad\u30f3\u30b0\u653b\u6483\u3092\u53d7\u3051\u308b\u306e\u3067\u300122\u304b\u3089\u4ed6\u306e\u756a\u53f7(\u4eca\u56de\u306f2222)\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\u307e\u305f\u3001root\u30e6\u30fc\u30b6\u30fc\u306b\u3088\u308b\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u306b\u3064\u3044\u3066\u306f\u3001\u300cPermitRootLogin prohibit-password\u300d\u3067\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u3082\u3067\u304d\u306a\u3044\u72b6\u614b\u306b\u3042\u308b\u306e\u3067\u3001\u6700\u4f4e\u9650\u5fc5\u8981\u306a\u8a2d\u5b9a\u306f\u5b8c\u4e86\u3057\u305f\u72b6\u614b\u3067\u3059\u304c\u3001\u5ff5\u306e\u305f\u3081\u3001root \u30e6\u30fc\u30b6\u30fc\u306b\u3088\u308b SSH \u30ed\u30b0\u30a4\u30f3\u306f\u4e00\u5207\u7981\u6b62\u3057\u307e\u3059\u3002\n# sshd_config\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\n[cloud]$ sudo vi /etc/ssh/sshd_config\n[sudo] password for cloud:          <- cloud\u30e6\u30fc\u30b6\u30fc\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\n\n\n/etc/ssh/sshd_config\n# What ports, IPs and protocols we listen for\n-Port 22\n+Port 2222\n(\u4e2d\u7565)\n\n# Authentication:\n(\u4e2d\u7565)\n-PermitRootLogin prohibit-password\n+PermitRootLogin no\n\n\n\n4. SSH\u30b5\u30fc\u30d3\u30b9\u306e\u518d\u8d77\u52d5\n\n\u4eca\u307e\u3067\u306e\u5909\u66f4\u3092\u53cd\u6620\u3059\u308b\u305f\u3081\u306bSSH\u30b5\u30fc\u30d3\u30b9\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n[cloud]$ sudo service ssh restart\n\n\u518d\u8d77\u52d5\u3067\u304d\u305f\u3089\u3001\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u3067\u300c22\u300d\u306e\u30dd\u30fc\u30c8\u3092\u9589\u3058\u3066\u3001\u300c2222\u300d\u306e\u30dd\u30fc\u30c8\u3092\u958b\u653e\u3057\u307e\u3059\u3002\u30dd\u30fc\u30c8\u306e\u958b\u9589\u304c\u3067\u304d\u305f\u3089\u3001\n\n\u30dd\u30fc\u30c8\u300c22\u300d\u306b\u3088\u308b\u63a5\u7d9a\u306f\u62d2\u5426\u3059\u308b\u3053\u3068\n\u30dd\u30fc\u30c8\u300c2222\u300d\u3001root\u30e6\u30fc\u30b6\u30fc\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u306a\u3044\u3053\u3068\n\u30dd\u30fc\u30c8\u300c2222\u300d\u3001cloud\u30e6\u30fc\u30b6\u30fc\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3053\u3068\n\n\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n5. \u516c\u958b\u9375\u8a8d\u8a3c\u306b\u3088\u308bSSH\u63a5\u7d9a\n\nSSH\u30dd\u30fc\u30c8\u306e\u5909\u66f4\u3068root\u30e6\u30fc\u30b6\u30fc\u306b\u3088\u308b\u30ed\u30b0\u30a4\u30f3\u306e\u7981\u6b62\u3067root\u30e6\u30fc\u30b6\u30fc\u3067\u76f4\u63a5\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3053\u3068\u3092\u7981\u6b62\u3057\u3001\u4e00\u822c\u30e6\u30fc\u30b6\u30fc\u3067\u306e\u307f\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u5909\u66f4\u3057\u307e\u3057\u305f\u304c\u3001\u3088\u308a\u5b89\u5168\u306b\u4f7f\u3046\u305f\u3081\u306b\u516c\u958b\u9375\u8a8d\u8a3c\u3092\u4f7f\u3063\u3066\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u516c\u958b\u9375\u8a8d\u8a3c\u306b\u3064\u3044\u3066\u77e5\u308a\u305f\u3044\u65b9\u306f\u300c\u3088\u304f\u5206\u304b\u308b\u516c\u958b\u9375\u8a8d\u8a3c\u300d\uff5e\u521d\u5fc3\u8005\u3067\u3082\u3088\u304f\u308f\u304b\u308b\uff01VPS\u306b\u3088\u308bWeb\u30b5\u30fc\u30d0\u30fc\u904b\u7528\u8b1b\u5ea7(2)\u3092\u53c2\u8003\u306b\u3057\u3066\u4e0b\u3055\u3044\u3002\n\u307e\u305f\u3001\u50d5\u306fSSH\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068\u3057\u3066Tera Term\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001Tera Term\u306b\u304a\u3051\u308b\u516c\u958b\u9375\u8a8d\u8a3c\u306e\u8a2d\u5b9a\u65b9\u6cd5\u306b\u3064\u3044\u3066\u306f\u516c\u958b\u9375\u8a8d\u8a3c\u306b\u3088\u308bSSH\u63a5\u7d9a - Tera Term\u306e\u4f7f\u3044\u65b9\u3084SSH\u516c\u958b\u9375\u6697\u53f7\u5316\u65b9\u5f0f\uff0dTera Term\u3067\u516c\u958b\u9375\u8a8d\u8a3c\u30ed\u30b0\u30a4\u30f3\u3092\u53c2\u8003\u306b\u3057\u3066\u4e0b\u3055\u3044\u3002\n\u4e0a\u8a18\u30ea\u30f3\u30af\u5148\u306b\u5f93\u3063\u3066\u3001Tera Term\u3067\u516c\u958b\u9375\u8a8d\u8a3c\u306e\u8a2d\u5b9a\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001\n\n/etc/ssh/sshd_config\n# Change to no to disable tunnelled clear text passwords\n-#PasswordAuthentication yes\n+PasswordAuthentication no\n\n\n\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\u7de8\u96c6\u3067\u304d\u305f\u3089\u30014. SSH\u30b5\u30fc\u30d3\u30b9\u306e\u518d\u8d77\u52d5\u306e\u3088\u3046\u306bSSH\u30b5\u30fc\u30d3\u30b9\u3092\u518d\u8d77\u52d5\u3057\u3066\u3001\u8a8d\u8a3c\u65b9\u6cd5\u304c\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u304b\u3089\u516c\u958b\u9375\u8a8d\u8a3c\u306b\u5207\u308a\u66ff\u308f\u3063\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n6. \u30d1\u30c3\u30b1\u30fc\u30b8\u7ba1\u7406\u30b7\u30b9\u30c6\u30e0\u306e\u66f4\u65b0\n\napt-get\u306fDebian\u7cfb\u306e\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\uff08Debian\u3084Ubuntu\uff09\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u7ba1\u7406\u30b7\u30b9\u30c6\u30e0\u3067\u3042\u308bAPT(Advanced Package Tool)\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u5229\u7528\u3057\u3066\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u64cd\u4f5c\u30fb\u7ba1\u7406\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3044\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u4f9d\u5b58\u95a2\u4fc2\u3082\u542b\u3081\u3066\u4e00\u62ec\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb/\u30a2\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u307e\u3059\u3002\n# \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u7ba1\u7406\u3059\u308b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u66f4\u65b0\uff08\u30d1\u30c3\u30b1\u30fc\u30b8\u81ea\u4f53\u306f\u66f4\u65b0\u3057\u306a\u3044\uff09\n[cloud]$ sudo apt-get update\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u66f4\u65b0\n[cloud]$ sudo apt-get upgrade\n\n\u53c2\u8003\uff1a\n\u3010Ubuntu\u3011apt-get\u3067\u30d1\u30c3\u30b1\u30fc\u30b8\u3092install / uninstall / upgrade\napt-get\u306e\u4f7f\u3044\u65b9\napt-get - \u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u64cd\u4f5c\u30fb\u7ba1\u7406 - Linux\u30b3\u30de\u30f3\u30c9\nAPT HOWTO (Obsolete Documentation) \u7b2c3\u7ae0 - \u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u7ba1\u7406\nUbuntu/apt\u30b3\u30de\u30f3\u30c9\u306e\u64cd\u4f5c\u30ed\u30b0\u306e\u5728\u51e6\u3068\u78ba\u8a8d\u65b9\u6cd5\n\n7. \u30ed\u30b1\u30fc\u30eb(\u8a00\u8a9e\u306a\u3069)\u3092\u65e5\u672c\u5411\u3051\u306b\u5909\u66f4\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30ed\u30b1\u30fc\u30eb\u304c\u82f1\u8a9e\u570f\u5411\u3051\u3067\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u3084\u65e5\u4ed8\u3092\u82f1\u8a9e\u570f\u5411\u3051\u306b\u8868\u793a\u3059\u308b\u306e\u3067\u3001\u30ed\u30b1\u30fc\u30eb\u3092\u65e5\u672c\u5411\u3051\u306b\u5909\u66f4\u3059\u308b\u3002\n# \u5909\u66f4\u524d\u306e\u30ed\u30b1\u30fc\u30eb\u3092\u78ba\u8a8d\n[cloud]$ locale\n\n# \u82f1\u8a9e\u570f\u306e\u30ed\u30b1\u30fc\u30eb\u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\n[cloud]$ date\nFri Dec 16 10:01:01 JST 2016\n\n# \u65e5\u672c\u8a9e\u30d1\u30c3\u30af\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n[cloud]$ sudo apt-get install language-pack-ja\n\n# \u30ed\u30b1\u30fc\u30eb\u3092\u66f4\u65b0\n[cloud]$ sudo update-locale LANG=ja_JP.UTF-8\n\n# OS\u306e\u518d\u8d77\u52d5\n[cloud]$ sudo shutdown -r now\n\n# \u5909\u66f4\u5f8c\u306e\u30ed\u30b1\u30fc\u30eb\u3092\u78ba\u8a8d\n[cloud]$ locale\n\n# \u65e5\u672c\u8a9e\u570f\u306e\u30ed\u30b1\u30fc\u30eb\u306b\u5909\u308f\u3063\u305f\u3053\u3068\u3092\u78ba\u8a8d\n[cloud]$ date\n\n\n8. \u6642\u523b\u306e\u540c\u671f\n\nUbuntu\u306f15.04\u307e\u3067\u306fntpdate\u3092\u4f7f\u3063\u3066\u6642\u523b\u306e\u540c\u671f\u3092\u884c\u3063\u3066\u3044\u307e\u3057\u305f\u304c\u300115.10\u304b\u3089\u306fSystemd\u306e\u6a5f\u80fd\u3092\u4f7f\u3063\u3066\u6642\u523b\u306e\u540c\u671f\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\u521d\u671f\u8a2d\u5b9a\u3067\u306f\u6642\u523b\u306e\u540c\u671f\u306b\u300cntp.ubuntu.com\u300d\u3068\u3044\u3046NTP\u30b5\u30fc\u30d0\u30fc\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3001NICT(\u60c5\u5831\u901a\u4fe1\u7814\u7a76\u6a5f\u69cb)\u306eNTP\u30b5\u30fc\u30d0\u30fc(ntp.nict.jp)\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n# \u6642\u523b\u540c\u671f\u306e\u8a2d\u5b9a\u3092\u78ba\u8a8d\n[cloud]$ systemctl -l status systemd-timesyncd\n\n# \u6642\u523b\u306e\u53d6\u5f97\u5148\u3092\u5909\u66f4\n[cloud]$ sudo sed -i 's/#NTP=/NTP=ntp.nict.jp/g' /etc/systemd/timesyncd.conf\n\n? # OS\u306e\u518d\u8d77\u52d5\n? sudo shutdown -r now\n\n# \u6642\u523b\u540c\u671f\u30b5\u30fc\u30d3\u30b9\u3092\u518d\u8d77\u52d5\n[cloud]$ sudo systemctl restart systemd-timesyncd.service\n\n# \u6642\u523b\u540c\u671f\u306e\u8a2d\u5b9a\u3092\u78ba\u8a8d\n[cloud]$ systemctl -l status systemd-timesyncd\n\n# \u6642\u523b\u3092\u8868\u793a\n[cloud]$ date\n\n\u203b\u53c2\u8003\uff1a\nUbuntu 16.04\u306815.10\u3067\u6642\u523b\u5408\u308f\u305b\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b\nsystemd\u308f\u304b\u3089\u3093\n\nNginx\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\n\u5f8c\u7a0b\u3001Nginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306b\u3042\u305f\u308a\u3001Nginx\u3068\u3044\u3046\u30b0\u30eb\u30fc\u30d7\u3068Nginx\u3068\u3044\u3046\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u306a\u3044\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u4e0b\u8a18\u306e\u5272\u308a\u5f53\u3066\u30dd\u30ea\u30b7\u30fc\u306b\u5f93\u3063\u3066\u3001100\u756a\u4ee3\u306e\u30b0\u30eb\u30fc\u30d7ID\u3068\u30e6\u30fc\u30b6\u30fcID\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\n\n\u7528\u9014\n\u7bc4\u56f2\n\n\n\n\n\u30b7\u30b9\u30c6\u30e0\u7ba1\u7406\u8005\n0 - 99\n\n\n\u30b7\u30b9\u30c6\u30e0\u30a2\u30ab\u30a6\u30f3\u30c8\n100 - 999\n\n\n\u30e6\u30fc\u30b6\u30fc\u30a2\u30ab\u30a6\u30f3\u30c8\n1000 - 29999\n\n\n\u4e88\u7d04\n30000 - 59999\n\n\n\n# \u4f7f\u7528\u6e08\u307f\u306e\u30b0\u30eb\u30fc\u30d7ID\u3092\u78ba\u8a8d\n[cloud]$ cat /etc/group\n\n# nginx\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\n[cloud]$ sudo groupadd -g [\u30b0\u30eb\u30fc\u30d7ID] nginx\n\n# \u4f7f\u7528\u6e08\u307f\u306e\u30e6\u30fc\u30b6\u30fcID\u3092\u78ba\u8a8d\n[cloud]$ cat /etc/passwd\n\n# nginx\u30b0\u30eb\u30fc\u30d7\u306b\u5c5e\u3059\u308bnginx\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\n[cloud]$ sudo useradd -g nginx -u [\u30e6\u30fc\u30b6\u30fcID] -d /nonexistent -s /bin/false nginx\n\n\n\u5171\u7528\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u3068\u3057\u3066app\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n# app\u30e6\u30fc\u30b6\u30fc\u3092\u8ffd\u52a0\n[cloud]$ sudo useradd app -g nginx\n\n# app\u30e6\u30fc\u30b6\u30fc\u3092\u78ba\u8a8d\n[cloud]$ sudo cat /etc/passwd\n\n# app\u30e6\u30fc\u30b6\u30fc\u306e\u6240\u5c5e\u30b0\u30eb\u30fc\u30d7\u3092\u78ba\u8a8d\n[cloud]$ sudo groups app\n\n# app\u30e6\u30fc\u30b6\u30fc\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\n[cloud]$ sudo passwd app\n\n# app\u30e6\u30fc\u30b6\u30fc\u306b\u5207\u308a\u66ff\u3048\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\n[cloud]$ su app\n\n# app\u30e6\u30fc\u30b6\u30fc\u304b\u3089\u30ed\u30b0\u30a2\u30a6\u30c8\n[app]$ exit\n\n\nPython\u306e\u8a2d\u5b9a\n\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u30b0\u30ed\u30fc\u30d0\u30eb\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3054\u3068\u306b\u72ec\u7acb\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u4f7f\u3044\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002Python3.3\u304b\u3089virtualenv\u306b\u4ee3\u308f\u308apyvenv\u3068\u3044\u3046\u306e\u304c\u4f7f\u7528\u3067\u304d\u308b\u3088\u3046\u306a\u306e\u3067\u3001pyvenv\u3092\u4f7f\u3046\u3002\n# GMO\u30af\u30e9\u30a6\u30c9ALTUS\u306eUbuntu 16.04\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u306fPython\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u3002\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u306ePython\u3092\u78ba\u8a8d\u3002\n[cloud]$ python3 -V\n\n# pip\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n[cloud]$ sudo apt install python3-pip\n\n# pip\u3092\u66f4\u65b0\n[cloud]$ pip3 install --upgrade pip\n\n# pyvenv\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n[cloud]$ sudo apt install python3-venv\n\n\u53c2\u8003\uff1a\npyenv\u3068venv\u3067Python3\u958b\u767a\u74b0\u5883\u3092\u6574\u3048\u308b\nWindows\u3067pyenv\u3068\u304bvirtualenv\u3092\u4f7f\u304a\u3046\u3068\u601d\u3063\u305f\u3068\u304d\u306b\u5b66\u3093\u3060\u3053\u3068\u306e\u30e1\u30e2\n\nNginx\u306e\u8a2d\u5b9a\n\u5f8c\u3005\u3001WEB\u30b5\u30a4\u30c8\u306e\u9ad8\u901f\u5316\u30fb\u6700\u9069\u5316\u3082\u5b9f\u65bd\u3057\u305f\u3044\u306e\u3067\u3001\u4eca\u56de\u306fGoogle\u304c\u958b\u767a\u3057\u305fPageSpeed\u30e2\u30b8\u30e5\u30fc\u30eb(ngx_pagespeed)\u3092Nginx\u306b\u7d44\u307f\u8fbc\u3093\u3067\u5229\u7528\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002Google\u304c\u7528\u610f\u3057\u305f\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f7f\u3063\u3066Nginx + ngx_pagespeed\u3092\u30bd\u30fc\u30b9\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n# unzip\u30b3\u30de\u30f3\u30c9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n[cloud]$ sudo apt-get install unzip\n\n# OpenSSL\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n[cloud]$ sudo apt-get install libssl-dev\n\n# PCRE\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u306f\u6b63\u898f\u8868\u73fe\u30e9\u30a4\u30d6\u30e9\u30ea\n# URL\u306erewrite\u3084Location\u306e\u6307\u5b9a\u3067\u6b63\u898f\u8868\u73fe\u306b\u3088\u308b\u30de\u30c3\u30c1\u30f3\u30b0\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\n[cloud]$ sudo apt-get install libpcre3-dev\n\n# \u30d0\u30c3\u30d5\u30a1\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u5148\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\n[cloud]$ sudo mkdir -p /var/cache/nginx/client_temp\n\n# \u30d0\u30c3\u30d5\u30a1\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u5148\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6240\u6709\u8005\u3092\u5909\u66f4\n[cloud]$ sudo chown nginx:root /var/cache/nginx/client_temp\n\n# \u30d0\u30c3\u30d5\u30a1\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u5148\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6a29\u9650\u3092\u5909\u66f4\n[cloud]$ sudo chmod 700 /var/cache/nginx/client_temp\n\n# root\u30e6\u30fc\u30b6\u30fc\u306b\u5207\u308a\u66ff\u3048\n[cloud]$ sudo su -\n\n# \u6700\u65b0\u306eNginx\u3068PageSpeed\u30e2\u30b8\u30e5\u30fc\u30eb(ngx_pagespeed)\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n[root]$ bash <(curl -f -L -sS https://ngxpagespeed.com/install) --nginx-version latest -b /usr/local/src\n\n# \u9014\u4e2d\u3067\u8ffd\u52a0\u306econfigure\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3067\u304d\u308b\u30c0\u30a4\u30a2\u30ed\u30b0\u304c\u51fa\u308b\u306e\u3067\u3001\u8ffd\u52a0\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b\n(\u4e2d\u7565)\nAbout to build nginx.  Do you have any additional ./configure\narguments you would like to set?  For example, if you would like\nto build nginx with https support give --with-http_ssl_module\nIf you don't have any, just press enter.\n> --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-file-aio --with-threads --with-ipv6 --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-mail --with-mail_ssl_module --with-stream --with-stream_ssl_module --with-cc-opt='-g -O2 -fstack-protector-strong -Wformat -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2' --with-ld-opt='-Wl,-Bsymbolic-functions -Wl,-z,relro -Wl,-z,now -Wl,--as-needed'\n\n# root\u30e6\u30fc\u30b6\u30fc\u304b\u3089\u30ed\u30b0\u30a2\u30a6\u30c8\n[root]$ exit\n\n# Nginx\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\n[cloud]$ nginx -V\n\n# Nginx\u3092\u8d77\u52d5\n[cloud]$ sudo nginx\n\nNginx\u3092\u8d77\u52d5\u5f8c\u3001http://[IP\u30a2\u30c9\u30ec\u30b9]\u306b\u30d6\u30e9\u30a6\u30b6\u3067\u63a5\u7d9a\u3057\u3066\u3001Nginx\u306eWelcome\u30da\u30fc\u30b8\u304c\u8868\u793a\u3067\u304d\u308c\u3070OK\uff01\nngx_pagespeed\u306e\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f\u3001\u5f8c\u65e5UP\u3059\u308b\u904b\u7528\u7de8\u3067\u7d39\u4ecb\u3059\u308b\u3068\u3057\u3066\u3001\u4eca\u56de\u306f\u53d6\u308a\u6562\u3048\u305a\u6a5f\u80fd\u3092\u6709\u52b9\u306b\u3059\u308b\u90e8\u5206\u306e\u307f\u3092\u78ba\u8a8d\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n/etc/nginx/nginx.conf\u306eserver\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306bPageSpeed\u3092\u6709\u52b9\u306b\u3059\u308b\u8a2d\u5b9a\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002nginx.conf\u306eserver\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306b\n\n/etc/nginx/nginx.conf\nhttp {\n    (\u4e2d\u7565)\n    server {\n         (\u4e2d\u7565)\n+        pagespeed on;\n+        pagespeed RewriteLevel CoreFilters;\n+        pagespeed FileCachePath /var/cache/ngx_pagespeed_cache;\n+        pagespeed EnableFilters collapse_whitespace,trim_urls,remove_comments;\n         (\u4e2d\u7565)\n    }\n\n}\n\n\n\u3092\u8ffd\u8a18\u3067\u304d\u308c\u3070Nginx\u3092\u518d\u8d77\u52d5\u3057\u3066\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u306b\u300cX-Page-Speed:1.11.33.4-0\u300d\u304c\u3042\u308c\u3070OK\uff01\n# Nginx\u3092\u518d\u8d77\u52d5\n[cloud]$ sudo nginx -s reload\n\n# \u30ea\u30af\u30a8\u30b9\u30c8\u3092\u6295\u3052\u3001\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u30fc\u3092\u30c1\u30a7\u30c3\u30af\n[cloud]$ curl -I 'http://localhost/' | grep X-Page-Speed\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\nX-Page-Speed: 1.11.33.4-0\n\n\u53c2\u8003\uff1a\nBuild ngx_pagespeed From Source\nNginx + PageSpeed(ngx_pagespeed)\u3092\u5c0e\u5165\u3057\u3066 WEB\u30b5\u30a4\u30c8\u3092\u9ad8\u901f\u5316\u3059\u308b\u65b9\u6cd5\nnginx\u9023\u8f091\u56de\u76ee: nginx\u306e\u7d39\u4ecb\nPageSpeed\u3092\u4f7f\u3063\u3066Web\u30b5\u30a4\u30c8\u3092\u6700\u9069\u5316\u30fb\u9ad8\u901f\u5316\u3057\u3088\u3046\nNGINX-1.5.12. \u30b3\u30f3\u30d1\u30a4\u30eb\u3000\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\n[Debian][CentOS][Ubuntu]\u30e6\u30fc\u30b6ID\u306e\u30dd\u30ea\u30b7\u30fc\u3001\u5272\u308a\u5f53\u3066\u30eb\u30fc\u30eb\u306b\u3064\u3044\u3066\u8abf\u3079\u308b\nUbuntu Policy Manual - 9.2.2 UID and GID classes\n\nMySQL\u306e\u8a2d\u5b9a\n# MySQL5.7\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo apt-get -y install mysql-server-5.7\n\n# root\u30e6\u30fc\u30b6\u30fc\u3067\u30ed\u30b0\u30a4\u30f3\n$ mysql -u root -p\n\n# \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\nmysql> CREATE DATABASE `[\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d]` DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;\n\n# mysql\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u9078\u629e\nmysql> USE 'mysql';\n\n# \u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u8868\u793a\nmysql> select user,host from mysql.user;\n\n# \u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\uff06\u4f5c\u6210\u3057\u305f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u5bfe\u3057\u3066\u6a29\u9650(CREATE, ALTER, REFERENCES, INDEX, SELECT, UPDATE, INSERT, DELETE)\u4ed8\u4e0e\nmysql> GRANT CREATE,ALTER,REFERENCES,INDEX,SELECT,UPDATE,INSERT,DELETE ON [\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d].* TO '[\u30e6\u30fc\u30b6\u30fc\u540d]'@'localhost' IDENTIFIED BY '[\u30d1\u30b9\u30ef\u30fc\u30c9]';\n\n# \u4f5c\u6210\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u306e\u6a29\u9650\u3092\u78ba\u8a8d\nmysql> SHOW GRANTS for '[\u30e6\u30fc\u30b6\u30fc\u540d]'@'localhost';\n\n# MySQL\u304b\u3089\u30ed\u30b0\u30a2\u30a6\u30c8\nmysql> exit\n\n\u203b\u53c2\u8003\nMySQL \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nUsing MySQL with Django - Access denied for user '@'localhost\nMySQL/\u30e6\u30fc\u30b6\u3068DB\u4f5c\u6210\n\n\u30c7\u30d7\u30ed\u30a4\u5148\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\n# \u30c7\u30d7\u30ed\u30a4\u5148\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\n[cloud]$ sudo mkdir -p /var/www/example.jp\n\n# \u30c7\u30d7\u30ed\u30a4\u5148\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6240\u6709\u8005\u3092\u5909\u66f4\n[cloud]$ sudo chown root:nginx /var/www/example.jp\n\n# \u30c7\u30d7\u30ed\u30a4\u5148\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6a29\u9650\u3092\u5909\u66f4\n[cloud]$ sudo chmod g+w /var/www/example.jp\n\n# app\u30e6\u30fc\u30b6\u30fc\u3078\u5207\u308a\u66ff\u3048\n$ su app\n\n# venv\u3068\u3044\u3046\u4eee\u60f3\u74b0\u5883\u3092\u4f5c\u6210\u3002\n[app]$ /usr/bin/pyvenv /var/www/example.jp/venv\n\n# \u4f5c\u6210\u3057\u305f\u4eee\u60f3\u74b0\u5883\u3092\u6709\u52b9\u5316\u3002\u4eee\u60f3\u74b0\u5883\u304c\u6709\u52b9\u5316\u306b\u306a\u308b\u3068\u300c([evn\u540d])\u300d\u304c\u30b7\u30a7\u30eb\u306e\u5148\u982d\u306b\u3064\u304f\u3002\n[app]$ source /var/www/example.jp/venv/bin/activate\n\n# \u4eee\u60f3\u74b0\u5883\u306epip\u3092\u6700\u65b0\u306b\u66f4\u65b0\n(venv)[app]$ pip install --upgrade pip\n\n# \u4eee\u60f3\u74b0\u5883\u306bDjango\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n(venv)[app]$ pip install Django\n\n# \u4eee\u60f3\u74b0\u5883\u306buWSGI\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n(venv)[app]$ pip install uwsgi\n\n# Django\u304b\u3089MySQL\u306b\u63a5\u7d9a\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3001\u4eee\u60f3\u74b0\u5883\u306bPyMySQL\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n(venv)[app]$ pip install PyMySQL\n\n# \u4e00\u65e6\u4eee\u60f3\u74b0\u5883\u3092\u7121\u52b9\u306b\u3059\u308b\n(venv)[app]$ deactivate\n\n\u4f5c\u6210\u3057\u305fDjango\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u65b9\u6cd5\u3068\u3057\u3066\u306fGit\u3092\u4f7f\u3063\u305f\u308aFTP\u30bd\u30d5\u30c8\u3092\u4f7f\u3063\u305f\u308a\u8272\u3005\u65b9\u6cd5\u306f\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u53d6\u308a\u6562\u3048\u305a\u3001FTP\u30bd\u30d5\u30c8\u3092\u4f7f\u3063\u3066\u30b5\u30fc\u30d0\u30fc\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\u4f5c\u6210\u3057\u305fDjango\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092FTP\u30bd\u30d5\u30c8\u3067\u300c/var/www/example.jp/venv/\u300d\u914d\u4e0b\u306bapp\u30e6\u30fc\u30b6\u30fc\u3067\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\u3057\u304b\u3057\u3001\u516c\u958b\u9375\u8a8d\u8a3c\u306b\u3088\u308bSSH\u63a5\u7d9a\u3067\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u3092\u7981\u6b62\u3057\u3066\u516c\u958b\u9375\u8a8d\u8a3c\u3067\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3057\u305f\u306e\u3067\u3001FTP\u30bd\u30d5\u30c8\u3067\u3082\u516c\u958b\u9375\u8a8d\u8a3c\u3067\u304d\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002\n\u50d5\u306fFTP\u30bd\u30d5\u30c8\u3068\u3057\u3066WinSCP\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001WinSCP\u3067\u306fPuTTY\u5f62\u5f0f\u306e\u79d8\u5bc6\u9375\u306b\u3057\u304b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u516c\u958b\u9375\u8a8d\u8a3c\u306b\u3088\u308bSSH\u63a5\u7d9a\u3067\u4f5c\u6210\u3057\u305f\u79d8\u5bc6\u9375\u3092PuTTY\u5f62\u5f0f\u306b\u5909\u63db\u3057\u307e\u3057\u305f\u3002\n\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u304b\u3089\u7de8\u96c6\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3001\u300c\u9ad8\u5ea6\u306a\u30b5\u30a4\u30c8\u306e\u8a2d\u5b9a\u300d\u3092\u753b\u9762\u3092\u8868\u793a\u3057\u307e\u3059\u3002\u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u306e\u300cSSH\u300d\u21d2\u300c\u8a8d\u8a3c\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3001\u300c\u79d8\u5bc6\u9375\u300d\u306e\u300c\u30d5\u30a1\u30a4\u30eb\u9078\u629e\u300d\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001\u300c\u79d8\u5bc6\u9375\u306e\u9078\u629e\u300d\u753b\u9762\u304c\u51fa\u73fe\u3059\u308b\u306e\u3067\u3001\u516c\u958b\u9375\u8a8d\u8a3c\u306b\u3088\u308bSSH\u63a5\u7d9a\u3067\u4f5c\u6210\u3057\u305f\u79d8\u5bc6\u9375\u3092\u9078\u629e\u3059\u308b\u3068\u3001\u81ea\u52d5\u7684\u306bPuTTY\u5f62\u5f0f\u306e\u79d8\u5bc6\u9375\u306b\u5909\u63db\u3057\u307e\u3059\u3002\n\nuWSGI\u306e\u8a2d\u5b9a\n# app\u30e6\u30fc\u30b6\u30fc\u304b\u3089\u30ed\u30b0\u30a2\u30a6\u30c8\n[app]$ exit\n\n# uWSGI\u306esocket\u30d5\u30a1\u30a4\u30eb\u3068pid\u30d5\u30a1\u30a4\u30eb\u3092\u683c\u7d0d\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\n[cloud]$ sudo mkdir -p /var/run/uwsgi\n\n# uWSGI\u306esocket\u30d5\u30a1\u30a4\u30eb\u3068pid\u30d5\u30a1\u30a4\u30eb\u3092\u683c\u7d0d\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6240\u6709\u8005\u3092\u5909\u66f4\n[cloud]$ sudo chown root:nginx /var/run/uwsgi\n\n# uWSGI\u306esocket\u30d5\u30a1\u30a4\u30eb\u3068pid\u30d5\u30a1\u30a4\u30eb\u3092\u683c\u7d0d\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6a29\u9650\u3092\u5909\u66f4\n[cloud]$ sudo chmod g+w /var/run/uwsgi\n\n# uWSGI\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u683c\u7d0d\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\n[cloud]$ sudo mkdir -p /var/log/uwsgi\n\nuWSGI\u306e\u305f\u3081\u306e\u5909\u6570\u3092\u5b9a\u7fa9\u3059\u308b\u30d5\u30a1\u30a4\u30eb(uwsgi_params)\u3092\u3001/var/www/example.jp/venv/\u914d\u4e0b\u306b\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n/var/www/example.jp/venv/uwsgi_params\nuwsgi_param  QUERY_STRING       $query_string;\nuwsgi_param  REQUEST_METHOD     $request_method;\nuwsgi_param  CONTENT_TYPE       $content_type;\nuwsgi_param  CONTENT_LENGTH     $content_length;\n\nuwsgi_param  REQUEST_URI        $request_uri;\nuwsgi_param  PATH_INFO          $document_uri;\nuwsgi_param  DOCUMENT_ROOT      $document_root;\nuwsgi_param  SERVER_PROTOCOL    $server_protocol;\nuwsgi_param  REQUEST_SCHEME     $scheme;\nuwsgi_param  HTTPS              $https if_not_empty;\n\nuwsgi_param  REMOTE_ADDR        $remote_addr;\nuwsgi_param  REMOTE_PORT        $remote_port;\nuwsgi_param  SERVER_PORT        $server_port;\nuwsgi_param  SERVER_NAME        $server_name;\n\n\nuWSGI\u306e\u8d77\u52d5\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3057\u305fuwsgi.ini\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n/var/www/example.jp/venv/uwsgi.ini\n[uwsgi]\nuid = nginx\ngid = nginx\n\n# Django-related settings\n# the base directory (full path)\n# \u81ea\u5206\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3057\u3066\u4e0b\u3055\u3044\nchdir = /var/www/example.jp/venv/app\n\n# Django's wsgi file\n# \u81ea\u5206\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3057\u3066\u4e0b\u3055\u3044(\u57fa\u672c\u7684\u306b\u306f\u300cDjango\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d.wsgi\u300d\u3092\u8a2d\u5b9a)\nmodule = app.wsgi\n\n# the virtualenv (full path)\n# \u81ea\u5206\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3057\u3066\u4e0b\u3055\u3044\nhome = /var/www/example.jp/venv\n\n\n# process-related settings\n# master\nmaster = true\n\n# maximum number of worker processes\nprocesses = 2\n\nthreads = 1\n\n# the socket (use the full path to be safe\nsocket = /var/run/uwsgi/master.sock\n\npidfile = /var/run/uwsgi/master.pid\n\n# ... with appropriate permissions - may be needed\nchmod-socket = 666\n\n# clear environment on exit\nvacuum = true\n\nthunder-lock = true\n\nmax-requests = 6000\nmax-requests-delta = 300\n\n# log\nlogto = /var/log/uwsgi/uwsgi.log\ndeamonize = /var/log/uwsgi/uwsgi-@(exec://date +%Y-%m-%d).log\nlog-reopen = true\n\n\n\nNginx\u306e\u8a2d\u5b9a\n\u4eca\u5f8c\u3001\u8907\u6570\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u540c\u4e00\u30b5\u30fc\u30d0\u30fc\u3067\u904b\u7528\u3059\u308b\u5834\u5408\u3082\u60f3\u5b9a\u3057\u3066\u4eee\u60f3\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\u300c/etc/nginx/sites-available\u300d\u3068\u300c/etc/nginx/sites-enabled\u300d\u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u3001\n\u300c/etc/nginx/sites-available\u300d\u306b\u306f\u4eee\u60f3\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u683c\u7d0d\u3057\u307e\u3059\u3002\nNginx\u304c\u8d77\u52d5\u3057\u305f\u6642\u306b\u300c/etc/nginx/sites-enabled\u300d\u914d\u4e0b\u3092\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u3057\u3066\u3001\u300c/etc/nginx/sites-enabled\u300d\u3067\u306f\u300c/etc/nginx/sites-available\u300d\u914d\u4e0b\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3078\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u5f35\u3063\u305f\u308a\u524a\u9664\u3057\u305f\u308a\u3059\u308b\u3053\u3068\u3067\u3001\u4eee\u60f3\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\u3092\u6709\u52b9\u306b\u3057\u305f\u308a\u7121\u52b9\u306b\u3057\u305f\u308a\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u7ba1\u7406\u3092\u697d\u306b\u3057\u307e\u3059\u3002\n# \u4eee\u60f3\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u683c\u7d0d\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\n[cloud]$ sudo mkdir /etc/nginx/sites-available\n\n# \u6709\u52b9\u306b\u3057\u305f\u3044\u4eee\u60f3\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3078\u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u683c\u7d0d\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\n[cloud]$ sudo mkdir /etc/nginx/sites-enabled\n\n\u300c/etc/nginx/sites-available/\u300d\u914d\u4e0b\u306b\u4eee\u60f3\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n/etc/nginx/sites-available/example.jp\n# the upstream component nginx needs to connect to\nupstream django {\n    # for a file socket\n    server unix:///var/run/uwsgi/master.sock;\n}\n\n# configuration of the server\nserver {\n    # the port your site will be served on\n    listen      80;\n    # the domain name it will serve for\n    # substitute your machine's IP address or FQDN\n    server_name [IP\u30a2\u30c9\u30ec\u30b9\u307e\u305f\u306f\u30c9\u30e1\u30a4\u30f3];\n    charset     utf-8;\n\n    # max upload size\n    # Django media\n    location /static {\n        # your Django project's static files - amend as required\n        # \u81ea\u5206\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3057\u3066\u4e0b\u3055\u3044\u3002\n        alias /var/www/example.jp/static;\n    }\n\n    # Finally, send all non-media requests to the Django server.\n    location / {\n        uwsgi_pass  django;\n        # the uwsgi_params file you installed\n        # \u81ea\u5206\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3057\u3066\u4e0b\u3055\u3044\u3002\n        include     /var/www/example.jp/venv/uwsgi_params;\n    }\n}\n\n\n\u4eee\u60f3\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3067\u304d\u305f\u3089\u3001\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u5f35\u308a\u307e\u3059\u3002\n# \u6709\u52b9\u306b\u3057\u305f\u3044\u4eee\u60f3\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3078\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u5f35\u308b\n[cloud]$ sudo ln -s /etc/nginx/sites-available/example.jp /etc/nginx/sites-enabled/example.jp\n\n\u300c/etc/nginx/sites-enabled/\u300d\u914d\u4e0b\u3092\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306bhttp\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n/etc/nginx/nginx.conf\nhttp {\n     (\u4e2d\u7565)\n     #gzip  on;\n+    include /etc/nginx/sites-enabled/*;\n     (\u4e2d\u7565)\n}\n\n\nOS\u3092\u518d\u8d77\u52d5\u3057\u3066\u3082Nginx\u3092\u81ea\u52d5\u3067\u8d77\u52d5\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u300c/etc/systemd/system/nginx.service\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n/etc/systemd/system/nginx.service\n[Unit]\nDescription=The NGINX HTTP and reverse proxy server\nAfter=syslog.target network.target remote-fs.target nss-lookup.target\n\n[Service]\nType=forking\nPIDFile=/run/nginx.pid\nExecStartPre=/usr/sbin/nginx -t\nExecStart=/usr/sbin/nginx\nExecReload=/bin/kill -s HUP $MAINPID\nExecStop=/bin/kill -s QUIT $MAINPID\nPrivateTmp=true\n\n[Install]\nWantedBy=multi-user.target\n\n\n\u300c/etc/systemd/system/nginx.service\u300d\u304c\u4f5c\u6210\u51fa\u6765\u305f\u3089\u3001\n# Nginx\u304c\u8d77\u52d5\u3057\u305f\u72b6\u614b\u306a\u306e\u3067\u3001\u505c\u6b62\u3059\u308b\n# \u3082\u3057\u300cPID\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304f\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u300d\u306a\u3069\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u305f\u5834\u5408\u306fOS\u3092\u518d\u8d77\u52d5\u3059\u308b\n[cloud]$ sudo nginx -s stop\n\n# \u30b5\u30fc\u30d3\u30b9\u306e\u958b\u59cb\n[cloud]$ sudo systemctl start nginx\n\n# \u30b5\u30fc\u30d3\u30b9\u306e\u505c\u6b62\n[cloud]$ sudo systemctl stop nginx\n\n# \u30b5\u30fc\u30d3\u30b9\u306e\u81ea\u52d5\u8d77\u52d5\u306e\u6709\u52b9\u5316\n[cloud]$ sudo systemctl enable nginx\n\n# \u30b5\u30fc\u30d3\u30b9\u306e\u958b\u59cb\n[cloud]$ sudo systemctl start nginx\n\n\u3092\u5b9f\u884c\u3057\u3066\u3001\u30b5\u30fc\u30d3\u30b9\u306e\u958b\u59cb\uff0f\u505c\u6b62\u3092\u5b9f\u884c\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u5f8c\u3001Nginx\u3092\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066\u767b\u9332\u3057\u307e\u3059\u3002\n\n\u30b5\u30fc\u30d3\u30b9\u306e\u4ed6\u306e\u30b3\u30de\u30f3\u30c9\n# \u30b5\u30fc\u30d3\u30b9\u306e\u518d\u8d77\u52d5\n$ sudo systemctl restart [\u30b5\u30fc\u30d3\u30b9\u540d]\n\n# \u30b5\u30fc\u30d3\u30b9\u306e\u81ea\u52d5\u8d77\u52d5\u306e\u7121\u52b9\u5316\n$ sudo systemctl disable [\u30b5\u30fc\u30d3\u30b9\u540d]\n\n# \u30b5\u30fc\u30d3\u30b9\u306e\u7a3c\u52d5\u72b6\u614b\u3092\u78ba\u8a8d\n$ sudo systemctl status [\u30b5\u30fc\u30d3\u30b9\u540d]\n\n# \u30b5\u30fc\u30d3\u30b9\u306b\u542b\u3080\u5168\u3066\u306e\u30d7\u30ed\u30bb\u30b9\u3092Kill\u3059\u308b\n$ sudo systemctl kill -s9 [\u30b5\u30fc\u30d3\u30b9\u540d]\n\n\n\u53c2\u8003\uff1a\n\u8efd\u91cf\u3067\u9ad8\u901f\u306a\u30a6\u30a7\u30d6\u30b5\u30fc\u30d0Nginx\u3092\u3001Ubuntu 12.04\u306b\u5c0e\u5165\u3059\u308b(\u8a2d\u5b9a\u7de8\u305d\u306e\uff11)\nNGINX systemd service file\n\nDjnago\u306e\u521d\u671f\u8a2d\u5b9a\nMySQL\u306b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3084\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3057\u305f\u3044\u306e\u3067\u3001Django\u306eDB\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n# \u4eee\u60f3\u74b0\u5883\u3092\u6709\u52b9\u5316\n[app]$ source /var/www/example.jp/venv/bin/activate\n\n# \u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n(venv)[app]$ python /var/www/example.jp/venv/pornstar/manage.py makemigrations app\n\n# \u5b9f\u884c\u3059\u308b\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3092SQL\u306e\u5f62\u5f0f\u3067\u78ba\u8a8d\n(venv)[app]$ python /var/www/example.jp/venv/pornstar/manage.py sqlmigrate app 0001\n\n# \u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\n(venv)[app]$ python /var/www/example.jp/venv/pornstar/manage.py migrate\n\n\u307e\u305f\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u306b\u95a2\u3057\u3066\u3082\u904b\u7528\u74b0\u5883\u3067\u516c\u958b\u3057\u3084\u3059\u3044\u72b6\u614b\u306b\u3059\u308b\u305f\u3081\u306b\u3001\u305d\u308c\u305e\u308c\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089\u7279\u5b9a\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30b3\u30d4\u30fc\u3057\u3066\u96c6\u3081\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u306b\u6307\u5b9a\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\nDjango\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306esettings.py\u3092\u7de8\u96c6\u3057\u3066STATIC_ROOT\u3092\u8ffd\u52a0\u3057\u3066\u3001STATICFILES_DIRS\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u307e\u3059\u3002\n\n/var/www/example.jp/venv/app/app/settings.py\n# Static files (CSS, JavaScript, Images)\n# https://docs.djangoproject.com/en/1.10/howto/static-files/\n\nSTATIC_URL = '/static/'\n+STATIC_ROOT = '/var/www/example.jp/static/'\n(\u4e2d\u7565)\n-STATICFILES_DIRS = (\n-    os.path.join(BASE_DIR, \"static\"),\n-)\n+#STATICFILES_DIRS = (\n+#    os.path.join(BASE_DIR, \"static\"),\n+#)\n\n\n# \u9759\u7684\u30d5\u30a1\u30a4\u30eb\u306e\u30b3\u30d4\u30fc\n(venv)[app]$ python /var/www/example.jp/venv/app/manage.py collectstatic\n\n# \u4eee\u60f3\u74b0\u5883\u3092\u7121\u52b9\u5316\n(venv)[app]$ deactivate\n\n\u53c2\u8003\uff1a\n\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u306e\u516c\u958b\u65b9\u6cd5\n\nuWSGI\u306e\u81ea\u52d5\u8d77\u52d5\u306e\u8a2d\u5b9a\nNginx\u3068\u540c\u69d8\u3001OS\u3092\u518d\u8d77\u52d5\u3057\u3066\u3082uWSGI\u3082\u81ea\u52d5\u3067\u8d77\u52d5\u3059\u308b\u3088\u3046\u306b\u300c/etc/systemd/system/uwsgi.service\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n/etc/systemd/system/uwsgi.service\n# uwsgi.service\n[Unit]\nDescription=uWSGI\nAfter=syslog.target\n\n[Service]\nExecStartPre=/bin/bash -c 'mkdir -p /var/run/uwsgi; chown root:nginx /var/run/uwsgi; chmod g+w /var/run/uwsgi;'\nExecStart=/bin/bash -c 'source /var/www/example.jp/venv/bin/activate; uwsgi --ini /var/www/example.jp/venv/uwsgi.ini'\n#Restart=always\nRestart=on-failure\nKillSignal=SIGQUIT\nType=notify\nStandardError=syslog\nNotifyAccess=all\n\n[Install]\nWantedBy=multi-user.target\n\n\n\u300cExecStartPre\u300d\u306f\u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\u524d\u306b\u5b9f\u884c\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3092\u6307\u5b9a\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3059\u304c\u3001\u5b9f\u884c\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3068\u3057\u3066uWSGI\u306epid\u30d5\u30a1\u30a4\u30eb\u3068socket\u30d5\u30a1\u30a4\u30eb\u3092\u683c\u7d0d\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(/var/run/uwsgi)\u3092\u4f5c\u6210\u3059\u308b\u3088\u3046\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\u306a\u305c\u306a\u3089\u3001\u300c/var/run\u300d\u306f\u300c/run\u300d\u3078\u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3067\u3042\u308a\u3001\u3055\u3089\u306b\u300c/run\u300d\u304ctmpfs\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3067\u30de\u30a6\u30f3\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\u3059\u308b\u3068\u3001OS\u3092\u518d\u8d77\u52d5\u3059\u308b\u3068\u300c/run(=/var/run)\u300d\u914d\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u5168\u3066\u524a\u9664\u3057\u307e\u3059\u306e\u3067\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u7121\u3044\u6642\u306b\u5099\u3048\u3066\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3092\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\u30b5\u30fc\u30d3\u30b9\u306e\u958b\u59cb\uff0f\u505c\u6b62\u3092\u5b9f\u884c\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u3001\u81ea\u52d5\u8d77\u52d5\u3092\u6709\u52b9\u5316\u3057\u307e\u3059\u3002\n# \u30b5\u30fc\u30d3\u30b9\u306e\u958b\u59cb\n[cloud]$ sudo systemctl start uwsgi\n\n# \u30b5\u30fc\u30d3\u30b9\u306e\u505c\u6b62\n[cloud]$ sudo systemctl stop uwsgi\n\n# \u30b5\u30fc\u30d3\u30b9\u306e\u81ea\u52d5\u8d77\u52d5\u306e\u6709\u52b9\u5316\n[cloud]$ sudo systemctl enable uwsgi\n\n# \u30b5\u30fc\u30d3\u30b9\u306e\u958b\u59cb\n[cloud]$ sudo systemctl start uwsgi\n\n\nDjango\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f4\u65b0\n\n/var/www/example.jp/venv/app/app/settings.py\n(\u4e2d\u7565)\n# SECURITY WARNING: don't run with debug turned on in production!\n-DEBUG = True\n+DEBUG = False\n-ALLOWED_HOSTS = []\n+ALLOWED_HOSTS = ['IP\u30a2\u30c9\u30ec\u30b9\u307e\u305f\u306f\u30c9\u30e1\u30a4\u30f3']\n(\u4e2d\u7565)\n\n\n\u30d6\u30e9\u30a6\u30b6\u3067http://[IP\u30a2\u30c9\u30ec\u30b9\u307e\u305f\u306f\u30c9\u30e1\u30a4\u30f3]\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u8868\u793a\u3067\u304d\u308c\u3070OK\uff01\n\n\u52d5\u4f5c\u3057\u306a\u3044\u6642\n\nInternal Error (\u30b5\u30fc\u30d0\u30fc\u5185\u90e8\u30a8\u30e9\u30fc)\n\nNginx\u306e\u30a8\u30e9\u30fc\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb(/var/log/nginx/error.log)\u3084uWSGI\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb(/var/log/uwsgi/uwsgi.log)\u3092\u78ba\u8a8d\u3057\u3066\u3001\u30a8\u30e9\u30fc\u3092\u7279\u5b9a\u3059\u308b\u3002\n\n\u53c2\u8003\u6587\u732e\n\nNginx \u306b uWSGI + Django \u30a2\u30d7\u30ea \u3092\u7d44\u307f\u8fbc\u3080\nnginx + uWSGI + Flask\u3092\u8a66\u3057\u3066\u307f\u308b\nCentOS 7 + Nginx \u3067 Django \u30a2\u30d7\u30ea\u3092\u516c\u958b\u3059\u308b\u307e\u3067\u306e\u624b\u9806\nuWSGI \u3067 Django \u3092\u4f7f\u3046\u65b9\u6cd5\nDjango \u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9 - \u30c7\u30d7\u30ed\u30a4 - \u30b5\u30fc\u30d0\u30fc\nDjango\u306e\u74b0\u5883\u69cb\u7bc9(Ubuntu Server, Apache, PostgreSQL)\nApache\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304b\u3089Django\u306e\u30c7\u30d7\u30ed\u30a4\u307e\u3067\n\u4fbf\u5229\u3067\u8d85\u5f37\u529b\u306aWSGI\u30b5\u30fc\u30d0\u30fc uWSGI \u3092\u4f7f\u3063\u3066\u307f\u3088\u3046\nPython Flask\u30a2\u30d7\u30ea\u3092 nginx + uWSGI \u74b0\u5883\u4e0b\u3078\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u306e\u3067\u30e1\u30e2\nSetting up Django and your web server with uWSGI and nginx\n\nGMO\u30af\u30e9\u30a6\u30c9ALTUS(\u30a2\u30eb\u30bf\u30b9)\u3068\u5951\u7d04\u3057\u3066\u3001\u958b\u767a\u3057\u305fDjango\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092 Nginx + uWSGI + MySQL + Python3 \u306e\u74b0\u5883\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u306e\u3067\u3001\u5b9f\u884c\u3057\u305f\u64cd\u4f5c\u3092\u5099\u5fd8\u9332\u3068\u3057\u3066\u6b8b\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u5358\u306a\u308b\u4f5c\u696d\u30e1\u30e2\u306a\u306e\u3067\u3001\u5fc5\u305a\u3057\u3082\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3067\u306f\u306a\u3044\u3053\u3068\u306b\u3054\u6ce8\u610f\u4e0b\u3055\u3044\u3002\u9593\u9055\u3044\u3084\u4e0d\u8db3\u304c\u3042\u308c\u3070\u9060\u616e\u306a\u304f\u3054\u6307\u6458\u4e0b\u3055\u3044\uff08\u7b11\uff09\n\n#\u904b\u7528\u74b0\u5883\n\u307e\u305a\u3001WSGI(Web Server Gateway Interface)\u3068\u306f\u3001Python\u3067\u8a18\u8ff0\u3057\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068Web\u30b5\u30fc\u30d0\u30fc\u306e\u9593\u306e\u6a19\u6e96\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9(PEP333)\u3067\u3001uWSGI\u306fWSGI\u4ed5\u69d8\u306b\u5f93\u3063\u305fWeb\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u52d5\u304b\u3059\u3053\u3068\u304c\u3067\u304d\u308bWeb\u30b5\u30fc\u30d0\u30fc\u3092\u6307\u3057\u307e\u3059\u3002\n\nDjango\u3067\u4f5c\u6210\u3057\u305f\u30a2Web\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306fWSGI\u3067\u52d5\u4f5c\u3059\u308b\u3088\u3046\u306b\u8a2d\u8a08\u3057\u3066\u3044\u3066\u3001\u69d8\u3005\u306a\u69cb\u6210\u3067\u904b\u7528\u3067\u304d\u308b\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306fPycon2015\u306eYuri Umezaki\u3055\u3093\u306e\u767a\u8868\uff08[uWSGI/Docker\u3092\u5229\u7528\u3057\u305fWeb\u30b5\u30fc\u30d3\u30b9\u904b\u7528\u4e8b\u4f8b](https://www.youtube.com/watch?v=zsoqAf-c3_s&index=23&list=PLMkWB0UjwFGkE3BIm4qpwaK5oPrmLLJoT)\uff09\u3092\u53c2\u8003\u306b\u4ee5\u4e0b\u306e\u69cb\u6210\u3067\u69cb\u7bc9\u3057\u307e\u3057\u305f\u3002\n\n- GMO\u30af\u30e9\u30a6\u30c9ALTUS Basic\u30d7\u30e9\u30f3\n- Ubuntu 16.04.1 LTS (GNU/Linux 4.4.0-47-generic x86_64)\n- Nginx 1.11.6\n- uWSGI 2.0.14\n- MySQL 5.7.16\n- Python 3.5.2\n- Django 1.10.3\n\n\n# \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u69cb\u6210\nWeb Browser <--> Nginx <--> socket <--> uWSGI <--> Djnago <--> MySQL\n\n\n#\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\n```\n/\n\u2514\u2500\u2500 var/\n    \u2514\u2500\u2500 www/\n        \u2514\u2500\u2500 example.jp/           <- \u30c7\u30d7\u30ed\u30a4\u5148\u306e\u30d5\u30a9\u30eb\u30c0\n            \u251c\u2500\u2500 venv/             <- \u4eee\u60f3\u74b0\u5883\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n            \u2502   \u251c\u2500\u2500 app           <- Django\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30eb\u30fc\u30c8(django-admin startproject app \u3067\u4f5c\u6210)\n            \u2502   \u2502   \u2514 main        <- Django\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30c8(python manage.py startapp main)\n            \u2502   \u251c\u2500\u2500 uwsgi.ini     <- uwsgi\u306e\u8d77\u52d5\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u7ba1\u7406\u3059\u308bINI\u30d5\u30a1\u30a4\u30eb\n            \u2502   \u2514\u2500\u2500 uwsgi_params  <- uswgi\u306e\u5909\u6570\u3092\u683c\u7d0d\u3059\u308b\u30d5\u30a1\u30a4\u30eb\n            \u2514\u2500\u2500 static            <- \u9759\u7684\u30d5\u30a1\u30a4\u30eb\u3092\u683c\u7d0d\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n```\n\n#\u30b5\u30fc\u30d0\u30fc\u306e\u521d\u671f\u8a2d\u5b9a\n####1. \u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u306e\u8a2d\u5b9a\n***\nGMO\u30af\u30e9\u30a6\u30c9ALTUS\u306b\u306f\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u3092\u753b\u9762\u304b\u3089\u8a2d\u5b9a\u3067\u304d\u308b\u6a5f\u80fd\u304c\u3042\u308b\u306e\u3067\u3001[GMO\u30af\u30e9\u30a6\u30c9 ALTUS\u30a2\u30eb\u30bf\u30b9 Basic\u30b7\u30ea\u30fc\u30ba \u30ac\u30a4\u30c9 - \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u65b0\u898f\u4f5c\u6210](https://support.gmocloud.com/pf/guide/basic/console/make_security.html)\u306b\u5f93\u3063\u3066\u3001\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u307e\u305a\u3001\u300c22\u300d\u3068\u300c80\u300d\u306e\u307f\u30dd\u30fc\u30c8\u3092\u89e3\u653e\u3057\u307e\u3057\u305f\u3002\n\n\n####2. \u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\u306b\u30ed\u30b0\u30a4\u30f3\n***\nGMO\u30af\u30e9\u30a6\u30c9ALTUS - Basic\u30d7\u30e9\u30f3\u306eUbuntu\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3067\u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u4f5c\u6210\u3067\u304d\u305f\u3089\u3001\u300ccloud\u300d\u3068\u3044\u3046\u30e6\u30fc\u30b6\u30fc\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u307e\u3059\u3002\u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\u4f5c\u6210\u5f8c\u306b\u3001\u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\u306e\u30ed\u30b0\u30a4\u30f3\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u30c0\u30a4\u30a2\u30ed\u30b0\u306b\u8868\u793a\u3057\u307e\u3059\u3002\u4ed6\u306e\u753b\u9762\u3067\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u306e\u3067\u3001\u5fd8\u308c\u306a\u3044\u3088\u3046\u30e1\u30e2\u3057\u307e\u3059\u3002\n\n\n####3. SSH\u30dd\u30fc\u30c8\u306e\u5909\u66f4\u3068root\u30e6\u30fc\u30b6\u30fc\u306b\u3088\u308b\u30ed\u30b0\u30a4\u30f3\u306e\u7981\u6b62\n***\nSSH\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u300c22\u300d\u306f\u3088\u304f\u30cf\u30c3\u30ad\u30f3\u30b0\u653b\u6483\u3092\u53d7\u3051\u308b\u306e\u3067\u300122\u304b\u3089\u4ed6\u306e\u756a\u53f7(\u4eca\u56de\u306f2222)\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\u307e\u305f\u3001root\u30e6\u30fc\u30b6\u30fc\u306b\u3088\u308b\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u306b\u3064\u3044\u3066\u306f\u3001\u300cPermitRootLogin prohibit-password\u300d\u3067\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u3082\u3067\u304d\u306a\u3044\u72b6\u614b\u306b\u3042\u308b\u306e\u3067\u3001\u6700\u4f4e\u9650\u5fc5\u8981\u306a\u8a2d\u5b9a\u306f\u5b8c\u4e86\u3057\u305f\u72b6\u614b\u3067\u3059\u304c\u3001\u5ff5\u306e\u305f\u3081\u3001root \u30e6\u30fc\u30b6\u30fc\u306b\u3088\u308b SSH \u30ed\u30b0\u30a4\u30f3\u306f\u4e00\u5207\u7981\u6b62\u3057\u307e\u3059\u3002\n\n```\n# sshd_config\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\n[cloud]$ sudo vi /etc/ssh/sshd_config\n[sudo] password for cloud:          <- cloud\u30e6\u30fc\u30b6\u30fc\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\n```\n\n```diff:/etc/ssh/sshd_config\n# What ports, IPs and protocols we listen for\n-Port 22\n+Port 2222\n(\u4e2d\u7565)\n\n# Authentication:\n(\u4e2d\u7565)\n-PermitRootLogin prohibit-password\n+PermitRootLogin no\n```\n\n\n####4. SSH\u30b5\u30fc\u30d3\u30b9\u306e\u518d\u8d77\u52d5\n***\n\u4eca\u307e\u3067\u306e\u5909\u66f4\u3092\u53cd\u6620\u3059\u308b\u305f\u3081\u306bSSH\u30b5\u30fc\u30d3\u30b9\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```\n[cloud]$ sudo service ssh restart\n```\n\n\u518d\u8d77\u52d5\u3067\u304d\u305f\u3089\u3001\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u3067\u300c22\u300d\u306e\u30dd\u30fc\u30c8\u3092\u9589\u3058\u3066\u3001\u300c2222\u300d\u306e\u30dd\u30fc\u30c8\u3092\u958b\u653e\u3057\u307e\u3059\u3002\u30dd\u30fc\u30c8\u306e\u958b\u9589\u304c\u3067\u304d\u305f\u3089\u3001\n\n- \u30dd\u30fc\u30c8\u300c22\u300d\u306b\u3088\u308b\u63a5\u7d9a\u306f\u62d2\u5426\u3059\u308b\u3053\u3068\n- \u30dd\u30fc\u30c8\u300c2222\u300d\u3001root\u30e6\u30fc\u30b6\u30fc\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u306a\u3044\u3053\u3068\n- \u30dd\u30fc\u30c8\u300c2222\u300d\u3001cloud\u30e6\u30fc\u30b6\u30fc\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3053\u3068\n\n\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\n####5. \u516c\u958b\u9375\u8a8d\u8a3c\u306b\u3088\u308bSSH\u63a5\u7d9a\n***\n[SSH\u30dd\u30fc\u30c8\u306e\u5909\u66f4\u3068root\u30e6\u30fc\u30b6\u30fc\u306b\u3088\u308b\u30ed\u30b0\u30a4\u30f3\u306e\u7981\u6b62](#3-ssh\u30dd\u30fc\u30c8\u306e\u5909\u66f4\u3068root\u30e6\u30fc\u30b6\u30fc\u306b\u3088\u308b\u30ed\u30b0\u30a4\u30f3\u306e\u7981\u6b62)\u3067root\u30e6\u30fc\u30b6\u30fc\u3067\u76f4\u63a5\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3053\u3068\u3092\u7981\u6b62\u3057\u3001\u4e00\u822c\u30e6\u30fc\u30b6\u30fc\u3067\u306e\u307f\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u5909\u66f4\u3057\u307e\u3057\u305f\u304c\u3001\u3088\u308a\u5b89\u5168\u306b\u4f7f\u3046\u305f\u3081\u306b\u516c\u958b\u9375\u8a8d\u8a3c\u3092\u4f7f\u3063\u3066\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\u516c\u958b\u9375\u8a8d\u8a3c\u306b\u3064\u3044\u3066\u77e5\u308a\u305f\u3044\u65b9\u306f[\u300c\u3088\u304f\u5206\u304b\u308b\u516c\u958b\u9375\u8a8d\u8a3c\u300d\uff5e\u521d\u5fc3\u8005\u3067\u3082\u3088\u304f\u308f\u304b\u308b\uff01VPS\u306b\u3088\u308bWeb\u30b5\u30fc\u30d0\u30fc\u904b\u7528\u8b1b\u5ea7(2)](http://knowledge.sakura.ad.jp/beginner/3543/)\u3092\u53c2\u8003\u306b\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n\u307e\u305f\u3001\u50d5\u306fSSH\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068\u3057\u3066Tera Term\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001Tera Term\u306b\u304a\u3051\u308b\u516c\u958b\u9375\u8a8d\u8a3c\u306e\u8a2d\u5b9a\u65b9\u6cd5\u306b\u3064\u3044\u3066\u306f[\u516c\u958b\u9375\u8a8d\u8a3c\u306b\u3088\u308bSSH\u63a5\u7d9a - Tera Term\u306e\u4f7f\u3044\u65b9](http://webkaru.net/linux/tera-term-ssh-login-public-key/)\u3084[SSH\u516c\u958b\u9375\u6697\u53f7\u5316\u65b9\u5f0f\uff0dTera Term\u3067\u516c\u958b\u9375\u8a8d\u8a3c\u30ed\u30b0\u30a4\u30f3](http://www.j-oosk.com/teraterm/authorized_keys/306/)\u3092\u53c2\u8003\u306b\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n\u4e0a\u8a18\u30ea\u30f3\u30af\u5148\u306b\u5f93\u3063\u3066\u3001Tera Term\u3067\u516c\u958b\u9375\u8a8d\u8a3c\u306e\u8a2d\u5b9a\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001\n\n```diff:/etc/ssh/sshd_config\n# Change to no to disable tunnelled clear text passwords\n-#PasswordAuthentication yes\n+PasswordAuthentication no\n```\n\n\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n\u7de8\u96c6\u3067\u304d\u305f\u3089\u3001[4. SSH\u30b5\u30fc\u30d3\u30b9\u306e\u518d\u8d77\u52d5](#4-ssh\u30b5\u30fc\u30d3\u30b9\u306e\u518d\u8d77\u52d5)\u306e\u3088\u3046\u306bSSH\u30b5\u30fc\u30d3\u30b9\u3092\u518d\u8d77\u52d5\u3057\u3066\u3001\u8a8d\u8a3c\u65b9\u6cd5\u304c\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u304b\u3089\u516c\u958b\u9375\u8a8d\u8a3c\u306b\u5207\u308a\u66ff\u308f\u3063\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\n####6. \u30d1\u30c3\u30b1\u30fc\u30b8\u7ba1\u7406\u30b7\u30b9\u30c6\u30e0\u306e\u66f4\u65b0\n***\napt-get\u306fDebian\u7cfb\u306e\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\uff08Debian\u3084Ubuntu\uff09\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u7ba1\u7406\u30b7\u30b9\u30c6\u30e0\u3067\u3042\u308bAPT(Advanced Package Tool)\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u5229\u7528\u3057\u3066\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u64cd\u4f5c\u30fb\u7ba1\u7406\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3044\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u4f9d\u5b58\u95a2\u4fc2\u3082\u542b\u3081\u3066\u4e00\u62ec\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb/\u30a2\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u307e\u3059\u3002\n\n```\n# \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u7ba1\u7406\u3059\u308b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u66f4\u65b0\uff08\u30d1\u30c3\u30b1\u30fc\u30b8\u81ea\u4f53\u306f\u66f4\u65b0\u3057\u306a\u3044\uff09\n[cloud]$ sudo apt-get update\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u66f4\u65b0\n[cloud]$ sudo apt-get upgrade\n```\n\u53c2\u8003\uff1a\n[\u3010Ubuntu\u3011apt-get\u3067\u30d1\u30c3\u30b1\u30fc\u30b8\u3092install / uninstall / upgrade](http://kawatama.net/web/296)\n[apt-get\u306e\u4f7f\u3044\u65b9](http://d.hatena.ne.jp/liquidfunc/20110503/1304349183)\n[apt-get - \u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u64cd\u4f5c\u30fb\u7ba1\u7406 - Linux\u30b3\u30de\u30f3\u30c9](http://webkaru.net/linux/apt-get-command/)\n[APT HOWTO (Obsolete Documentation) \u7b2c3\u7ae0 - \u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u7ba1\u7406](https://www.debian.org/doc/manuals/apt-howto/ch-apt-get.ja.html)\n[Ubuntu/apt\u30b3\u30de\u30f3\u30c9\u306e\u64cd\u4f5c\u30ed\u30b0\u306e\u5728\u51e6\u3068\u78ba\u8a8d\u65b9\u6cd5](http://linux.just4fun.biz/Ubuntu/apt%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%AE%E6%93%8D%E4%BD%9C%E3%83%AD%E3%82%B0%E3%81%AE%E5%9C%A8%E5%87%A6%E3%81%A8%E7%A2%BA%E8%AA%8D%E6%96%B9%E6%B3%95.html)\n\n\n####7. \u30ed\u30b1\u30fc\u30eb(\u8a00\u8a9e\u306a\u3069)\u3092\u65e5\u672c\u5411\u3051\u306b\u5909\u66f4\n***\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30ed\u30b1\u30fc\u30eb\u304c\u82f1\u8a9e\u570f\u5411\u3051\u3067\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u3084\u65e5\u4ed8\u3092\u82f1\u8a9e\u570f\u5411\u3051\u306b\u8868\u793a\u3059\u308b\u306e\u3067\u3001\u30ed\u30b1\u30fc\u30eb\u3092\u65e5\u672c\u5411\u3051\u306b\u5909\u66f4\u3059\u308b\u3002\n\n```\n# \u5909\u66f4\u524d\u306e\u30ed\u30b1\u30fc\u30eb\u3092\u78ba\u8a8d\n[cloud]$ locale\n\n# \u82f1\u8a9e\u570f\u306e\u30ed\u30b1\u30fc\u30eb\u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\n[cloud]$ date\nFri Dec 16 10:01:01 JST 2016\n\n# \u65e5\u672c\u8a9e\u30d1\u30c3\u30af\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n[cloud]$ sudo apt-get install language-pack-ja\n\n# \u30ed\u30b1\u30fc\u30eb\u3092\u66f4\u65b0\n[cloud]$ sudo update-locale LANG=ja_JP.UTF-8\n\n# OS\u306e\u518d\u8d77\u52d5\n[cloud]$ sudo shutdown -r now\n\n# \u5909\u66f4\u5f8c\u306e\u30ed\u30b1\u30fc\u30eb\u3092\u78ba\u8a8d\n[cloud]$ locale\n\n# \u65e5\u672c\u8a9e\u570f\u306e\u30ed\u30b1\u30fc\u30eb\u306b\u5909\u308f\u3063\u305f\u3053\u3068\u3092\u78ba\u8a8d\n[cloud]$ date\n```\n\n\n####8. \u6642\u523b\u306e\u540c\u671f\n***\nUbuntu\u306f15.04\u307e\u3067\u306fntpdate\u3092\u4f7f\u3063\u3066\u6642\u523b\u306e\u540c\u671f\u3092\u884c\u3063\u3066\u3044\u307e\u3057\u305f\u304c\u300115.10\u304b\u3089\u306fSystemd\u306e\u6a5f\u80fd\u3092\u4f7f\u3063\u3066\u6642\u523b\u306e\u540c\u671f\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\u521d\u671f\u8a2d\u5b9a\u3067\u306f\u6642\u523b\u306e\u540c\u671f\u306b\u300cntp.ubuntu.com\u300d\u3068\u3044\u3046NTP\u30b5\u30fc\u30d0\u30fc\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3001NICT(\u60c5\u5831\u901a\u4fe1\u7814\u7a76\u6a5f\u69cb)\u306eNTP\u30b5\u30fc\u30d0\u30fc(ntp.nict.jp)\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```\n# \u6642\u523b\u540c\u671f\u306e\u8a2d\u5b9a\u3092\u78ba\u8a8d\n[cloud]$ systemctl -l status systemd-timesyncd\n\n# \u6642\u523b\u306e\u53d6\u5f97\u5148\u3092\u5909\u66f4\n[cloud]$ sudo sed -i 's/#NTP=/NTP=ntp.nict.jp/g' /etc/systemd/timesyncd.conf\n\n? # OS\u306e\u518d\u8d77\u52d5\n? sudo shutdown -r now\n\n# \u6642\u523b\u540c\u671f\u30b5\u30fc\u30d3\u30b9\u3092\u518d\u8d77\u52d5\n[cloud]$ sudo systemctl restart systemd-timesyncd.service\n\n# \u6642\u523b\u540c\u671f\u306e\u8a2d\u5b9a\u3092\u78ba\u8a8d\n[cloud]$ systemctl -l status systemd-timesyncd\n\n# \u6642\u523b\u3092\u8868\u793a\n[cloud]$ date\n```\n\u203b\u53c2\u8003\uff1a\n[Ubuntu 16.04\u306815.10\u3067\u6642\u523b\u5408\u308f\u305b\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b](http://sicklylife.hatenablog.com/entry/2016/02/03/201557)\n[systemd\u308f\u304b\u3089\u3093](http://qiita.com/lastcat_/items/0344315894db41e1836a)\n\n\n# Nginx\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\n\u5f8c\u7a0b\u3001Nginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306b\u3042\u305f\u308a\u3001Nginx\u3068\u3044\u3046\u30b0\u30eb\u30fc\u30d7\u3068Nginx\u3068\u3044\u3046\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u306a\u3044\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u4e0b\u8a18\u306e\u5272\u308a\u5f53\u3066\u30dd\u30ea\u30b7\u30fc\u306b\u5f93\u3063\u3066\u3001100\u756a\u4ee3\u306e\u30b0\u30eb\u30fc\u30d7ID\u3068\u30e6\u30fc\u30b6\u30fcID\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n| \u7528\u9014              | \u7bc4\u56f2 |\n| ----------------- |------------|\n| \u30b7\u30b9\u30c6\u30e0\u7ba1\u7406\u8005     | 0 - 99 |\n| \u30b7\u30b9\u30c6\u30e0\u30a2\u30ab\u30a6\u30f3\u30c8 | 100 - 999 |\n| \u30e6\u30fc\u30b6\u30fc\u30a2\u30ab\u30a6\u30f3\u30c8 | 1000 - 29999 |\n| \u4e88\u7d04              | 30000 - 59999 |\n\n```\n# \u4f7f\u7528\u6e08\u307f\u306e\u30b0\u30eb\u30fc\u30d7ID\u3092\u78ba\u8a8d\n[cloud]$ cat /etc/group\n\n# nginx\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\n[cloud]$ sudo groupadd -g [\u30b0\u30eb\u30fc\u30d7ID] nginx\n\n# \u4f7f\u7528\u6e08\u307f\u306e\u30e6\u30fc\u30b6\u30fcID\u3092\u78ba\u8a8d\n[cloud]$ cat /etc/passwd\n\n# nginx\u30b0\u30eb\u30fc\u30d7\u306b\u5c5e\u3059\u308bnginx\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\n[cloud]$ sudo useradd -g nginx -u [\u30e6\u30fc\u30b6\u30fcID] -d /nonexistent -s /bin/false nginx\n```\n\n#\u5171\u7528\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u3068\u3057\u3066app\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\n# app\u30e6\u30fc\u30b6\u30fc\u3092\u8ffd\u52a0\n[cloud]$ sudo useradd app -g nginx\n\n# app\u30e6\u30fc\u30b6\u30fc\u3092\u78ba\u8a8d\n[cloud]$ sudo cat /etc/passwd\n\n# app\u30e6\u30fc\u30b6\u30fc\u306e\u6240\u5c5e\u30b0\u30eb\u30fc\u30d7\u3092\u78ba\u8a8d\n[cloud]$ sudo groups app\n\n# app\u30e6\u30fc\u30b6\u30fc\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\n[cloud]$ sudo passwd app\n\n# app\u30e6\u30fc\u30b6\u30fc\u306b\u5207\u308a\u66ff\u3048\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\n[cloud]$ su app\n\n# app\u30e6\u30fc\u30b6\u30fc\u304b\u3089\u30ed\u30b0\u30a2\u30a6\u30c8\n[app]$ exit\n```\n\n\n# Python\u306e\u8a2d\u5b9a\n\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u30b0\u30ed\u30fc\u30d0\u30eb\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3054\u3068\u306b\u72ec\u7acb\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u4f7f\u3044\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002Python3.3\u304b\u3089virtualenv\u306b\u4ee3\u308f\u308apyvenv\u3068\u3044\u3046\u306e\u304c\u4f7f\u7528\u3067\u304d\u308b\u3088\u3046\u306a\u306e\u3067\u3001pyvenv\u3092\u4f7f\u3046\u3002\n#####\n```\n# GMO\u30af\u30e9\u30a6\u30c9ALTUS\u306eUbuntu 16.04\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u306fPython\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u3002\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u306ePython\u3092\u78ba\u8a8d\u3002\n[cloud]$ python3 -V\n\n# pip\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n[cloud]$ sudo apt install python3-pip\n\n# pip\u3092\u66f4\u65b0\n[cloud]$ pip3 install --upgrade pip\n\n# pyvenv\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n[cloud]$ sudo apt install python3-venv\n```\n\u53c2\u8003\uff1a\n[pyenv\u3068venv\u3067Python3\u958b\u767a\u74b0\u5883\u3092\u6574\u3048\u308b](http://blog.muuny-blue.info/b3ddb7c5b10be95dbc3f9152c58becce.html)\n[Windows\u3067pyenv\u3068\u304bvirtualenv\u3092\u4f7f\u304a\u3046\u3068\u601d\u3063\u305f\u3068\u304d\u306b\u5b66\u3093\u3060\u3053\u3068\u306e\u30e1\u30e2](http://qiita.com/nobolis/items/12a464557f2ae007e9a1)\n\n\n# Nginx\u306e\u8a2d\u5b9a\n\u5f8c\u3005\u3001WEB\u30b5\u30a4\u30c8\u306e\u9ad8\u901f\u5316\u30fb\u6700\u9069\u5316\u3082\u5b9f\u65bd\u3057\u305f\u3044\u306e\u3067\u3001\u4eca\u56de\u306fGoogle\u304c\u958b\u767a\u3057\u305fPageSpeed\u30e2\u30b8\u30e5\u30fc\u30eb(ngx_pagespeed)\u3092Nginx\u306b\u7d44\u307f\u8fbc\u3093\u3067\u5229\u7528\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002Google\u304c\u7528\u610f\u3057\u305f\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f7f\u3063\u3066Nginx + ngx_pagespeed\u3092\u30bd\u30fc\u30b9\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n# unzip\u30b3\u30de\u30f3\u30c9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n[cloud]$ sudo apt-get install unzip\n\n# OpenSSL\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n[cloud]$ sudo apt-get install libssl-dev\n\n# PCRE\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u306f\u6b63\u898f\u8868\u73fe\u30e9\u30a4\u30d6\u30e9\u30ea\n# URL\u306erewrite\u3084Location\u306e\u6307\u5b9a\u3067\u6b63\u898f\u8868\u73fe\u306b\u3088\u308b\u30de\u30c3\u30c1\u30f3\u30b0\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\n[cloud]$ sudo apt-get install libpcre3-dev\n\n# \u30d0\u30c3\u30d5\u30a1\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u5148\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\n[cloud]$ sudo mkdir -p /var/cache/nginx/client_temp\n\n# \u30d0\u30c3\u30d5\u30a1\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u5148\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6240\u6709\u8005\u3092\u5909\u66f4\n[cloud]$ sudo chown nginx:root /var/cache/nginx/client_temp\n\n# \u30d0\u30c3\u30d5\u30a1\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u5148\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6a29\u9650\u3092\u5909\u66f4\n[cloud]$ sudo chmod 700 /var/cache/nginx/client_temp\n\n# root\u30e6\u30fc\u30b6\u30fc\u306b\u5207\u308a\u66ff\u3048\n[cloud]$ sudo su -\n\n# \u6700\u65b0\u306eNginx\u3068PageSpeed\u30e2\u30b8\u30e5\u30fc\u30eb(ngx_pagespeed)\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n[root]$ bash <(curl -f -L -sS https://ngxpagespeed.com/install) --nginx-version latest -b /usr/local/src\n\n# \u9014\u4e2d\u3067\u8ffd\u52a0\u306econfigure\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3067\u304d\u308b\u30c0\u30a4\u30a2\u30ed\u30b0\u304c\u51fa\u308b\u306e\u3067\u3001\u8ffd\u52a0\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b\n(\u4e2d\u7565)\nAbout to build nginx.  Do you have any additional ./configure\narguments you would like to set?  For example, if you would like\nto build nginx with https support give --with-http_ssl_module\nIf you don't have any, just press enter.\n> --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-file-aio --with-threads --with-ipv6 --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-mail --with-mail_ssl_module --with-stream --with-stream_ssl_module --with-cc-opt='-g -O2 -fstack-protector-strong -Wformat -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2' --with-ld-opt='-Wl,-Bsymbolic-functions -Wl,-z,relro -Wl,-z,now -Wl,--as-needed'\n\n# root\u30e6\u30fc\u30b6\u30fc\u304b\u3089\u30ed\u30b0\u30a2\u30a6\u30c8\n[root]$ exit\n\n# Nginx\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\n[cloud]$ nginx -V\n\n# Nginx\u3092\u8d77\u52d5\n[cloud]$ sudo nginx\n```\n\nNginx\u3092\u8d77\u52d5\u5f8c\u3001http://[IP\u30a2\u30c9\u30ec\u30b9]\u306b\u30d6\u30e9\u30a6\u30b6\u3067\u63a5\u7d9a\u3057\u3066\u3001Nginx\u306eWelcome\u30da\u30fc\u30b8\u304c\u8868\u793a\u3067\u304d\u308c\u3070OK\uff01\n\nngx_pagespeed\u306e\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f\u3001\u5f8c\u65e5UP\u3059\u308b\u904b\u7528\u7de8\u3067\u7d39\u4ecb\u3059\u308b\u3068\u3057\u3066\u3001\u4eca\u56de\u306f\u53d6\u308a\u6562\u3048\u305a\u6a5f\u80fd\u3092\u6709\u52b9\u306b\u3059\u308b\u90e8\u5206\u306e\u307f\u3092\u78ba\u8a8d\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n/etc/nginx/nginx.conf\u306eserver\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306bPageSpeed\u3092\u6709\u52b9\u306b\u3059\u308b\u8a2d\u5b9a\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002nginx.conf\u306eserver\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306b\n\n```diff:/etc/nginx/nginx.conf\nhttp {\n    (\u4e2d\u7565)\n    server {\n         (\u4e2d\u7565)\n+        pagespeed on;\n+        pagespeed RewriteLevel CoreFilters;\n+        pagespeed FileCachePath /var/cache/ngx_pagespeed_cache;\n+        pagespeed EnableFilters collapse_whitespace,trim_urls,remove_comments;\n         (\u4e2d\u7565)\n    }\n\n}\n```\n\n\u3092\u8ffd\u8a18\u3067\u304d\u308c\u3070Nginx\u3092\u518d\u8d77\u52d5\u3057\u3066\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u306b\u300cX-Page-Speed:1.11.33.4-0\u300d\u304c\u3042\u308c\u3070OK\uff01\n\n```\n# Nginx\u3092\u518d\u8d77\u52d5\n[cloud]$ sudo nginx -s reload\n\n# \u30ea\u30af\u30a8\u30b9\u30c8\u3092\u6295\u3052\u3001\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u30fc\u3092\u30c1\u30a7\u30c3\u30af\n[cloud]$ curl -I 'http://localhost/' | grep X-Page-Speed\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\nX-Page-Speed: 1.11.33.4-0\n```\n\n\u53c2\u8003\uff1a\n[Build ngx_pagespeed From Source](https://developers.google.com/speed/pagespeed/module/build_ngx_pagespeed_from_source)\n[Nginx + PageSpeed(ngx_pagespeed)\u3092\u5c0e\u5165\u3057\u3066 WEB\u30b5\u30a4\u30c8\u3092\u9ad8\u901f\u5316\u3059\u308b\u65b9\u6cd5](http://www.e-agency.co.jp/column/20130621.html)\n[nginx\u9023\u8f091\u56de\u76ee: nginx\u306e\u7d39\u4ecb](https://heartbeats.jp/hbblog/2012/01/nginx01.html)\n[PageSpeed\u3092\u4f7f\u3063\u3066Web\u30b5\u30a4\u30c8\u3092\u6700\u9069\u5316\u30fb\u9ad8\u901f\u5316\u3057\u3088\u3046](http://knowledge.sakura.ad.jp/tech/1599/)\n[NGINX-1.5.12. \u30b3\u30f3\u30d1\u30a4\u30eb\u3000\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806](http://face-web.websample.jp/2014/07/nginx-1-5-12/)\n[[Debian][CentOS][Ubuntu]\u30e6\u30fc\u30b6ID\u306e\u30dd\u30ea\u30b7\u30fc\u3001\u5272\u308a\u5f53\u3066\u30eb\u30fc\u30eb\u306b\u3064\u3044\u3066\u8abf\u3079\u308b](http://d.hatena.ne.jp/spidy_spidy/20080411/1207924144)\n[Ubuntu Policy Manual - 9.2.2 UID and GID classes](http://people.canonical.com/~cjwatson/ubuntu-policy/policy.html/ch-opersys.html#s9.2.2)\n\n\n#MySQL\u306e\u8a2d\u5b9a\n```\n# MySQL5.7\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo apt-get -y install mysql-server-5.7\n\n# root\u30e6\u30fc\u30b6\u30fc\u3067\u30ed\u30b0\u30a4\u30f3\n$ mysql -u root -p\n\n# \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\nmysql> CREATE DATABASE `[\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d]` DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;\n\n# mysql\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u9078\u629e\nmysql> USE 'mysql';\n\n# \u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u8868\u793a\nmysql> select user,host from mysql.user;\n\n# \u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\uff06\u4f5c\u6210\u3057\u305f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u5bfe\u3057\u3066\u6a29\u9650(CREATE, ALTER, REFERENCES, INDEX, SELECT, UPDATE, INSERT, DELETE)\u4ed8\u4e0e\nmysql> GRANT CREATE,ALTER,REFERENCES,INDEX,SELECT,UPDATE,INSERT,DELETE ON [\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d].* TO '[\u30e6\u30fc\u30b6\u30fc\u540d]'@'localhost' IDENTIFIED BY '[\u30d1\u30b9\u30ef\u30fc\u30c9]';\n\n# \u4f5c\u6210\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u306e\u6a29\u9650\u3092\u78ba\u8a8d\nmysql> SHOW GRANTS for '[\u30e6\u30fc\u30b6\u30fc\u540d]'@'localhost';\n\n# MySQL\u304b\u3089\u30ed\u30b0\u30a2\u30a6\u30c8\nmysql> exit\n```\n\u203b\u53c2\u8003\n[MySQL \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb](https://www.server-world.info/query?os=Ubuntu_16.04&p=mysql)\n[Using MySQL with Django - Access denied for user '@'localhost](http://stackoverflow.com/questions/11170133/using-mysql-with-django-access-denied-for-user-localhost)\n[MySQL/\u30e6\u30fc\u30b6\u3068DB\u4f5c\u6210](http://wiki.minaco.net/index.php?MySQL%2F%E3%83%A6%E3%83%BC%E3%82%B6%E3%81%A8DB%E4%BD%9C%E6%88%90)\n\n\n# \u30c7\u30d7\u30ed\u30a4\u5148\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\n```\n# \u30c7\u30d7\u30ed\u30a4\u5148\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\n[cloud]$ sudo mkdir -p /var/www/example.jp\n\n# \u30c7\u30d7\u30ed\u30a4\u5148\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6240\u6709\u8005\u3092\u5909\u66f4\n[cloud]$ sudo chown root:nginx /var/www/example.jp\n\n# \u30c7\u30d7\u30ed\u30a4\u5148\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6a29\u9650\u3092\u5909\u66f4\n[cloud]$ sudo chmod g+w /var/www/example.jp\n\n# app\u30e6\u30fc\u30b6\u30fc\u3078\u5207\u308a\u66ff\u3048\n$ su app\n\n# venv\u3068\u3044\u3046\u4eee\u60f3\u74b0\u5883\u3092\u4f5c\u6210\u3002\n[app]$ /usr/bin/pyvenv /var/www/example.jp/venv\n\n# \u4f5c\u6210\u3057\u305f\u4eee\u60f3\u74b0\u5883\u3092\u6709\u52b9\u5316\u3002\u4eee\u60f3\u74b0\u5883\u304c\u6709\u52b9\u5316\u306b\u306a\u308b\u3068\u300c([evn\u540d])\u300d\u304c\u30b7\u30a7\u30eb\u306e\u5148\u982d\u306b\u3064\u304f\u3002\n[app]$ source /var/www/example.jp/venv/bin/activate\n\n# \u4eee\u60f3\u74b0\u5883\u306epip\u3092\u6700\u65b0\u306b\u66f4\u65b0\n(venv)[app]$ pip install --upgrade pip\n\n# \u4eee\u60f3\u74b0\u5883\u306bDjango\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n(venv)[app]$ pip install Django\n\n# \u4eee\u60f3\u74b0\u5883\u306buWSGI\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n(venv)[app]$ pip install uwsgi\n\n# Django\u304b\u3089MySQL\u306b\u63a5\u7d9a\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3001\u4eee\u60f3\u74b0\u5883\u306bPyMySQL\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n(venv)[app]$ pip install PyMySQL\n\n# \u4e00\u65e6\u4eee\u60f3\u74b0\u5883\u3092\u7121\u52b9\u306b\u3059\u308b\n(venv)[app]$ deactivate\n```\n\u4f5c\u6210\u3057\u305fDjango\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u65b9\u6cd5\u3068\u3057\u3066\u306fGit\u3092\u4f7f\u3063\u305f\u308aFTP\u30bd\u30d5\u30c8\u3092\u4f7f\u3063\u305f\u308a\u8272\u3005\u65b9\u6cd5\u306f\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u53d6\u308a\u6562\u3048\u305a\u3001FTP\u30bd\u30d5\u30c8\u3092\u4f7f\u3063\u3066\u30b5\u30fc\u30d0\u30fc\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n\u4f5c\u6210\u3057\u305fDjango\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092FTP\u30bd\u30d5\u30c8\u3067\u300c/var/www/example.jp/venv/\u300d\u914d\u4e0b\u306bapp\u30e6\u30fc\u30b6\u30fc\u3067\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\u3057\u304b\u3057\u3001[\u516c\u958b\u9375\u8a8d\u8a3c\u306b\u3088\u308bSSH\u63a5\u7d9a](#5-\u516c\u958b\u9375\u8a8d\u8a3c\u306b\u3088\u308bssh\u63a5\u7d9a)\u3067\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u3092\u7981\u6b62\u3057\u3066\u516c\u958b\u9375\u8a8d\u8a3c\u3067\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3057\u305f\u306e\u3067\u3001FTP\u30bd\u30d5\u30c8\u3067\u3082\u516c\u958b\u9375\u8a8d\u8a3c\u3067\u304d\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002\n\n\u50d5\u306fFTP\u30bd\u30d5\u30c8\u3068\u3057\u3066WinSCP\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001WinSCP\u3067\u306fPuTTY\u5f62\u5f0f\u306e\u79d8\u5bc6\u9375\u306b\u3057\u304b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001[\u516c\u958b\u9375\u8a8d\u8a3c\u306b\u3088\u308bSSH\u63a5\u7d9a](#5-\u516c\u958b\u9375\u8a8d\u8a3c\u306b\u3088\u308bssh\u63a5\u7d9a)\u3067\u4f5c\u6210\u3057\u305f\u79d8\u5bc6\u9375\u3092PuTTY\u5f62\u5f0f\u306b\u5909\u63db\u3057\u307e\u3057\u305f\u3002\n\n\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u304b\u3089\u7de8\u96c6\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3001\u300c\u9ad8\u5ea6\u306a\u30b5\u30a4\u30c8\u306e\u8a2d\u5b9a\u300d\u3092\u753b\u9762\u3092\u8868\u793a\u3057\u307e\u3059\u3002\u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u306e\u300cSSH\u300d\u21d2\u300c\u8a8d\u8a3c\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3001\u300c\u79d8\u5bc6\u9375\u300d\u306e\u300c\u30d5\u30a1\u30a4\u30eb\u9078\u629e\u300d\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001\u300c\u79d8\u5bc6\u9375\u306e\u9078\u629e\u300d\u753b\u9762\u304c\u51fa\u73fe\u3059\u308b\u306e\u3067\u3001[\u516c\u958b\u9375\u8a8d\u8a3c\u306b\u3088\u308bSSH\u63a5\u7d9a](#5-\u516c\u958b\u9375\u8a8d\u8a3c\u306b\u3088\u308bssh\u63a5\u7d9a)\u3067\u4f5c\u6210\u3057\u305f\u79d8\u5bc6\u9375\u3092\u9078\u629e\u3059\u308b\u3068\u3001\u81ea\u52d5\u7684\u306bPuTTY\u5f62\u5f0f\u306e\u79d8\u5bc6\u9375\u306b\u5909\u63db\u3057\u307e\u3059\u3002\n\n# uWSGI\u306e\u8a2d\u5b9a\n```\n# app\u30e6\u30fc\u30b6\u30fc\u304b\u3089\u30ed\u30b0\u30a2\u30a6\u30c8\n[app]$ exit\n\n# uWSGI\u306esocket\u30d5\u30a1\u30a4\u30eb\u3068pid\u30d5\u30a1\u30a4\u30eb\u3092\u683c\u7d0d\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\n[cloud]$ sudo mkdir -p /var/run/uwsgi\n\n# uWSGI\u306esocket\u30d5\u30a1\u30a4\u30eb\u3068pid\u30d5\u30a1\u30a4\u30eb\u3092\u683c\u7d0d\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6240\u6709\u8005\u3092\u5909\u66f4\n[cloud]$ sudo chown root:nginx /var/run/uwsgi\n\n# uWSGI\u306esocket\u30d5\u30a1\u30a4\u30eb\u3068pid\u30d5\u30a1\u30a4\u30eb\u3092\u683c\u7d0d\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6a29\u9650\u3092\u5909\u66f4\n[cloud]$ sudo chmod g+w /var/run/uwsgi\n\n# uWSGI\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u683c\u7d0d\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\n[cloud]$ sudo mkdir -p /var/log/uwsgi\n```\n\nuWSGI\u306e\u305f\u3081\u306e\u5909\u6570\u3092\u5b9a\u7fa9\u3059\u308b\u30d5\u30a1\u30a4\u30eb(uwsgi_params)\u3092\u3001/var/www/example.jp/venv/\u914d\u4e0b\u306b\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```vim:/var/www/example.jp/venv/uwsgi_params\nuwsgi_param  QUERY_STRING       $query_string;\nuwsgi_param  REQUEST_METHOD     $request_method;\nuwsgi_param  CONTENT_TYPE       $content_type;\nuwsgi_param  CONTENT_LENGTH     $content_length;\n\nuwsgi_param  REQUEST_URI        $request_uri;\nuwsgi_param  PATH_INFO          $document_uri;\nuwsgi_param  DOCUMENT_ROOT      $document_root;\nuwsgi_param  SERVER_PROTOCOL    $server_protocol;\nuwsgi_param  REQUEST_SCHEME     $scheme;\nuwsgi_param  HTTPS              $https if_not_empty;\n\nuwsgi_param  REMOTE_ADDR        $remote_addr;\nuwsgi_param  REMOTE_PORT        $remote_port;\nuwsgi_param  SERVER_PORT        $server_port;\nuwsgi_param  SERVER_NAME        $server_name;\n```\n\nuWSGI\u306e\u8d77\u52d5\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3057\u305fuwsgi.ini\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```vim:/var/www/example.jp/venv/uwsgi.ini\n[uwsgi]\nuid = nginx\ngid = nginx\n\n# Django-related settings\n# the base directory (full path)\n# \u81ea\u5206\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3057\u3066\u4e0b\u3055\u3044\nchdir = /var/www/example.jp/venv/app\n\n# Django's wsgi file\n# \u81ea\u5206\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3057\u3066\u4e0b\u3055\u3044(\u57fa\u672c\u7684\u306b\u306f\u300cDjango\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d.wsgi\u300d\u3092\u8a2d\u5b9a)\nmodule = app.wsgi\n\n# the virtualenv (full path)\n# \u81ea\u5206\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3057\u3066\u4e0b\u3055\u3044\nhome = /var/www/example.jp/venv\n\n\n# process-related settings\n# master\nmaster = true\n\n# maximum number of worker processes\nprocesses = 2\n\nthreads = 1\n\n# the socket (use the full path to be safe\nsocket = /var/run/uwsgi/master.sock\n\npidfile = /var/run/uwsgi/master.pid\n\n# ... with appropriate permissions - may be needed\nchmod-socket = 666\n\n# clear environment on exit\nvacuum = true\n\nthunder-lock = true\n\nmax-requests = 6000\nmax-requests-delta = 300\n\n# log\nlogto = /var/log/uwsgi/uwsgi.log\ndeamonize = /var/log/uwsgi/uwsgi-@(exec://date +%Y-%m-%d).log\nlog-reopen = true\n```\n\n# Nginx\u306e\u8a2d\u5b9a\n\u4eca\u5f8c\u3001\u8907\u6570\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u540c\u4e00\u30b5\u30fc\u30d0\u30fc\u3067\u904b\u7528\u3059\u308b\u5834\u5408\u3082\u60f3\u5b9a\u3057\u3066\u4eee\u60f3\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u300c/etc/nginx/sites-available\u300d\u3068\u300c/etc/nginx/sites-enabled\u300d\u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u3001\n\u300c/etc/nginx/sites-available\u300d\u306b\u306f\u4eee\u60f3\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u683c\u7d0d\u3057\u307e\u3059\u3002\n\nNginx\u304c\u8d77\u52d5\u3057\u305f\u6642\u306b\u300c/etc/nginx/sites-enabled\u300d\u914d\u4e0b\u3092\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u3057\u3066\u3001\u300c/etc/nginx/sites-enabled\u300d\u3067\u306f\u300c/etc/nginx/sites-available\u300d\u914d\u4e0b\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3078\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u5f35\u3063\u305f\u308a\u524a\u9664\u3057\u305f\u308a\u3059\u308b\u3053\u3068\u3067\u3001\u4eee\u60f3\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\u3092\u6709\u52b9\u306b\u3057\u305f\u308a\u7121\u52b9\u306b\u3057\u305f\u308a\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u7ba1\u7406\u3092\u697d\u306b\u3057\u307e\u3059\u3002\n\n```\n# \u4eee\u60f3\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u683c\u7d0d\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\n[cloud]$ sudo mkdir /etc/nginx/sites-available\n\n# \u6709\u52b9\u306b\u3057\u305f\u3044\u4eee\u60f3\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3078\u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u683c\u7d0d\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\n[cloud]$ sudo mkdir /etc/nginx/sites-enabled\n```\n\n\u300c/etc/nginx/sites-available/\u300d\u914d\u4e0b\u306b\u4eee\u60f3\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```vi:/etc/nginx/sites-available/example.jp\n# the upstream component nginx needs to connect to\nupstream django {\n    # for a file socket\n    server unix:///var/run/uwsgi/master.sock;\n}\n\n# configuration of the server\nserver {\n    # the port your site will be served on\n    listen      80;\n    # the domain name it will serve for\n    # substitute your machine's IP address or FQDN\n    server_name [IP\u30a2\u30c9\u30ec\u30b9\u307e\u305f\u306f\u30c9\u30e1\u30a4\u30f3];\n    charset     utf-8;\n\n    # max upload size\n    # Django media\n    location /static {\n        # your Django project's static files - amend as required\n        # \u81ea\u5206\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3057\u3066\u4e0b\u3055\u3044\u3002\n        alias /var/www/example.jp/static;\n    }\n\n    # Finally, send all non-media requests to the Django server.\n    location / {\n        uwsgi_pass  django;\n        # the uwsgi_params file you installed\n        # \u81ea\u5206\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3057\u3066\u4e0b\u3055\u3044\u3002\n        include     /var/www/example.jp/venv/uwsgi_params;\n    }\n}\n```\n\n\u4eee\u60f3\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3067\u304d\u305f\u3089\u3001\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u5f35\u308a\u307e\u3059\u3002\n\n```\n# \u6709\u52b9\u306b\u3057\u305f\u3044\u4eee\u60f3\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3078\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u5f35\u308b\n[cloud]$ sudo ln -s /etc/nginx/sites-available/example.jp /etc/nginx/sites-enabled/example.jp\n```\n\n\u300c/etc/nginx/sites-enabled/\u300d\u914d\u4e0b\u3092\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306bhttp\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```diff:/etc/nginx/nginx.conf\nhttp {\n     (\u4e2d\u7565)\n     #gzip  on;\n+    include /etc/nginx/sites-enabled/*;\n     (\u4e2d\u7565)\n}\n```\n\nOS\u3092\u518d\u8d77\u52d5\u3057\u3066\u3082Nginx\u3092\u81ea\u52d5\u3067\u8d77\u52d5\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u300c/etc/systemd/system/nginx.service\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```vim:/etc/systemd/system/nginx.service\n[Unit]\nDescription=The NGINX HTTP and reverse proxy server\nAfter=syslog.target network.target remote-fs.target nss-lookup.target\n\n[Service]\nType=forking\nPIDFile=/run/nginx.pid\nExecStartPre=/usr/sbin/nginx -t\nExecStart=/usr/sbin/nginx\nExecReload=/bin/kill -s HUP $MAINPID\nExecStop=/bin/kill -s QUIT $MAINPID\nPrivateTmp=true\n\n[Install]\nWantedBy=multi-user.target\n```\n\n\u300c/etc/systemd/system/nginx.service\u300d\u304c\u4f5c\u6210\u51fa\u6765\u305f\u3089\u3001\n\n```\n# Nginx\u304c\u8d77\u52d5\u3057\u305f\u72b6\u614b\u306a\u306e\u3067\u3001\u505c\u6b62\u3059\u308b\n# \u3082\u3057\u300cPID\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304f\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u300d\u306a\u3069\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u305f\u5834\u5408\u306fOS\u3092\u518d\u8d77\u52d5\u3059\u308b\n[cloud]$ sudo nginx -s stop\n\n# \u30b5\u30fc\u30d3\u30b9\u306e\u958b\u59cb\n[cloud]$ sudo systemctl start nginx\n\n# \u30b5\u30fc\u30d3\u30b9\u306e\u505c\u6b62\n[cloud]$ sudo systemctl stop nginx\n\n# \u30b5\u30fc\u30d3\u30b9\u306e\u81ea\u52d5\u8d77\u52d5\u306e\u6709\u52b9\u5316\n[cloud]$ sudo systemctl enable nginx\n\n# \u30b5\u30fc\u30d3\u30b9\u306e\u958b\u59cb\n[cloud]$ sudo systemctl start nginx\n```\n\n\u3092\u5b9f\u884c\u3057\u3066\u3001\u30b5\u30fc\u30d3\u30b9\u306e\u958b\u59cb\uff0f\u505c\u6b62\u3092\u5b9f\u884c\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u5f8c\u3001Nginx\u3092\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066\u767b\u9332\u3057\u307e\u3059\u3002\n\n```vim:\u30b5\u30fc\u30d3\u30b9\u306e\u4ed6\u306e\u30b3\u30de\u30f3\u30c9\n# \u30b5\u30fc\u30d3\u30b9\u306e\u518d\u8d77\u52d5\n$ sudo systemctl restart [\u30b5\u30fc\u30d3\u30b9\u540d]\n\n# \u30b5\u30fc\u30d3\u30b9\u306e\u81ea\u52d5\u8d77\u52d5\u306e\u7121\u52b9\u5316\n$ sudo systemctl disable [\u30b5\u30fc\u30d3\u30b9\u540d]\n\n# \u30b5\u30fc\u30d3\u30b9\u306e\u7a3c\u52d5\u72b6\u614b\u3092\u78ba\u8a8d\n$ sudo systemctl status [\u30b5\u30fc\u30d3\u30b9\u540d]\n\n# \u30b5\u30fc\u30d3\u30b9\u306b\u542b\u3080\u5168\u3066\u306e\u30d7\u30ed\u30bb\u30b9\u3092Kill\u3059\u308b\n$ sudo systemctl kill -s9 [\u30b5\u30fc\u30d3\u30b9\u540d]\n```\n\n\u53c2\u8003\uff1a\n[\u8efd\u91cf\u3067\u9ad8\u901f\u306a\u30a6\u30a7\u30d6\u30b5\u30fc\u30d0Nginx\u3092\u3001Ubuntu 12.04\u306b\u5c0e\u5165\u3059\u308b(\u8a2d\u5b9a\u7de8\u305d\u306e\uff11)](http://blog.kondoyoshiyuki.com/2012/12/09/setting-1-nginx-on-ubuntu-12-04/)\n[NGINX systemd service file](https://www.nginx.com/resources/wiki/start/topics/examples/systemd/)\n\n# Djnago\u306e\u521d\u671f\u8a2d\u5b9a\n\nMySQL\u306b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3084\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3057\u305f\u3044\u306e\u3067\u3001Django\u306eDB\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\n# \u4eee\u60f3\u74b0\u5883\u3092\u6709\u52b9\u5316\n[app]$ source /var/www/example.jp/venv/bin/activate\n\n# \u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n(venv)[app]$ python /var/www/example.jp/venv/pornstar/manage.py makemigrations app\n\n# \u5b9f\u884c\u3059\u308b\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3092SQL\u306e\u5f62\u5f0f\u3067\u78ba\u8a8d\n(venv)[app]$ python /var/www/example.jp/venv/pornstar/manage.py sqlmigrate app 0001\n\n# \u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\n(venv)[app]$ python /var/www/example.jp/venv/pornstar/manage.py migrate\n```\n\n\u307e\u305f\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u306b\u95a2\u3057\u3066\u3082\u904b\u7528\u74b0\u5883\u3067\u516c\u958b\u3057\u3084\u3059\u3044\u72b6\u614b\u306b\u3059\u308b\u305f\u3081\u306b\u3001\u305d\u308c\u305e\u308c\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089\u7279\u5b9a\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30b3\u30d4\u30fc\u3057\u3066\u96c6\u3081\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u306b\u6307\u5b9a\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\nDjango\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306esettings.py\u3092\u7de8\u96c6\u3057\u3066STATIC_ROOT\u3092\u8ffd\u52a0\u3057\u3066\u3001STATICFILES_DIRS\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u307e\u3059\u3002\n\n```diff:/var/www/example.jp/venv/app/app/settings.py\n# Static files (CSS, JavaScript, Images)\n# https://docs.djangoproject.com/en/1.10/howto/static-files/\n\nSTATIC_URL = '/static/'\n+STATIC_ROOT = '/var/www/example.jp/static/'\n(\u4e2d\u7565)\n-STATICFILES_DIRS = (\n-    os.path.join(BASE_DIR, \"static\"),\n-)\n+#STATICFILES_DIRS = (\n+#    os.path.join(BASE_DIR, \"static\"),\n+#)\n```\n\n```\n# \u9759\u7684\u30d5\u30a1\u30a4\u30eb\u306e\u30b3\u30d4\u30fc\n(venv)[app]$ python /var/www/example.jp/venv/app/manage.py collectstatic\n\n# \u4eee\u60f3\u74b0\u5883\u3092\u7121\u52b9\u5316\n(venv)[app]$ deactivate\n```\n\u53c2\u8003\uff1a\n[\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u306e\u516c\u958b\u65b9\u6cd5](http://docs.djangoproject.jp/en/latest/howto/static-files.html)\n\n\n#uWSGI\u306e\u81ea\u52d5\u8d77\u52d5\u306e\u8a2d\u5b9a\nNginx\u3068\u540c\u69d8\u3001OS\u3092\u518d\u8d77\u52d5\u3057\u3066\u3082uWSGI\u3082\u81ea\u52d5\u3067\u8d77\u52d5\u3059\u308b\u3088\u3046\u306b\u300c/etc/systemd/system/uwsgi.service\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```vim:/etc/systemd/system/uwsgi.service\n# uwsgi.service\n[Unit]\nDescription=uWSGI\nAfter=syslog.target\n\n[Service]\nExecStartPre=/bin/bash -c 'mkdir -p /var/run/uwsgi; chown root:nginx /var/run/uwsgi; chmod g+w /var/run/uwsgi;'\nExecStart=/bin/bash -c 'source /var/www/example.jp/venv/bin/activate; uwsgi --ini /var/www/example.jp/venv/uwsgi.ini'\n#Restart=always\nRestart=on-failure\nKillSignal=SIGQUIT\nType=notify\nStandardError=syslog\nNotifyAccess=all\n\n[Install]\nWantedBy=multi-user.target\n```\n\n\u300cExecStartPre\u300d\u306f\u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\u524d\u306b\u5b9f\u884c\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3092\u6307\u5b9a\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3059\u304c\u3001\u5b9f\u884c\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3068\u3057\u3066uWSGI\u306epid\u30d5\u30a1\u30a4\u30eb\u3068socket\u30d5\u30a1\u30a4\u30eb\u3092\u683c\u7d0d\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(/var/run/uwsgi)\u3092\u4f5c\u6210\u3059\u308b\u3088\u3046\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u306a\u305c\u306a\u3089\u3001\u300c/var/run\u300d\u306f\u300c/run\u300d\u3078\u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3067\u3042\u308a\u3001\u3055\u3089\u306b\u300c/run\u300d\u304ctmpfs\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3067\u30de\u30a6\u30f3\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\u3059\u308b\u3068\u3001OS\u3092\u518d\u8d77\u52d5\u3059\u308b\u3068\u300c/run(=/var/run)\u300d\u914d\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u5168\u3066\u524a\u9664\u3057\u307e\u3059\u306e\u3067\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u7121\u3044\u6642\u306b\u5099\u3048\u3066\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3092\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30b5\u30fc\u30d3\u30b9\u306e\u958b\u59cb\uff0f\u505c\u6b62\u3092\u5b9f\u884c\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u3001\u81ea\u52d5\u8d77\u52d5\u3092\u6709\u52b9\u5316\u3057\u307e\u3059\u3002\n\n```\n# \u30b5\u30fc\u30d3\u30b9\u306e\u958b\u59cb\n[cloud]$ sudo systemctl start uwsgi\n\n# \u30b5\u30fc\u30d3\u30b9\u306e\u505c\u6b62\n[cloud]$ sudo systemctl stop uwsgi\n\n# \u30b5\u30fc\u30d3\u30b9\u306e\u81ea\u52d5\u8d77\u52d5\u306e\u6709\u52b9\u5316\n[cloud]$ sudo systemctl enable uwsgi\n\n# \u30b5\u30fc\u30d3\u30b9\u306e\u958b\u59cb\n[cloud]$ sudo systemctl start uwsgi\n```\n\n\n# Django\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f4\u65b0\n```diff:/var/www/example.jp/venv/app/app/settings.py\n(\u4e2d\u7565)\n# SECURITY WARNING: don't run with debug turned on in production!\n-DEBUG = True\n+DEBUG = False\n-ALLOWED_HOSTS = []\n+ALLOWED_HOSTS = ['IP\u30a2\u30c9\u30ec\u30b9\u307e\u305f\u306f\u30c9\u30e1\u30a4\u30f3']\n(\u4e2d\u7565)\n```\n\n\u30d6\u30e9\u30a6\u30b6\u3067http://[IP\u30a2\u30c9\u30ec\u30b9\u307e\u305f\u306f\u30c9\u30e1\u30a4\u30f3]\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u8868\u793a\u3067\u304d\u308c\u3070OK\uff01\n\n#\u52d5\u4f5c\u3057\u306a\u3044\u6642\n- Internal Error (\u30b5\u30fc\u30d0\u30fc\u5185\u90e8\u30a8\u30e9\u30fc)\n\nNginx\u306e\u30a8\u30e9\u30fc\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb(/var/log/nginx/error.log)\u3084uWSGI\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb(/var/log/uwsgi/uwsgi.log)\u3092\u78ba\u8a8d\u3057\u3066\u3001\u30a8\u30e9\u30fc\u3092\u7279\u5b9a\u3059\u308b\u3002\n\n\n#\u53c2\u8003\u6587\u732e\n1. [Nginx \u306b uWSGI + Django \u30a2\u30d7\u30ea \u3092\u7d44\u307f\u8fbc\u3080](https://www.saintsouth.net/blog/setup-django-app-with-uwsgi-and-nginx/)\n1. [nginx + uWSGI + Flask\u3092\u8a66\u3057\u3066\u307f\u308b](http://d.hatena.ne.jp/plasticscafe/20110331/1301543987)\n1. [CentOS 7 + Nginx \u3067 Django \u30a2\u30d7\u30ea\u3092\u516c\u958b\u3059\u308b\u307e\u3067\u306e\u624b\u9806](http://kodak-ism.com/how-to-release-django-app-on-centos7-and-nginx/)\n1. [uWSGI \u3067 Django \u3092\u4f7f\u3046\u65b9\u6cd5](http://docs.djangoproject.jp/en/latest/howto/deployment/wsgi/uwsgi.html)\n1. [Django \u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9 - \u30c7\u30d7\u30ed\u30a4 - \u30b5\u30fc\u30d0\u30fc](http://django-best-practice-ja.readthedocs.io/ja/latest/deployment/servers.html)\n1. [Django\u306e\u74b0\u5883\u69cb\u7bc9(Ubuntu Server, Apache, PostgreSQL)](http://yura2.hateblo.jp/entry/2015/04/05/Django%E3%81%AE%E7%92%B0%E5%A2%83%E6%A7%8B%E7%AF%89(Ubuntu_Server,_Apache,_PostgreSQL))\n1. [Apache\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304b\u3089Django\u306e\u30c7\u30d7\u30ed\u30a4\u307e\u3067](http://akiniwa.hatenablog.jp/entry/2013/09/24/150412)\n1. [\u4fbf\u5229\u3067\u8d85\u5f37\u529b\u306aWSGI\u30b5\u30fc\u30d0\u30fc uWSGI \u3092\u4f7f\u3063\u3066\u307f\u3088\u3046](http://d.hatena.ne.jp/m-hiyama/20120312/1331513519)\n1. [Python Flask\u30a2\u30d7\u30ea\u3092 nginx + uWSGI \u74b0\u5883\u4e0b\u3078\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u306e\u3067\u30e1\u30e2](https://zafiel.wingall.com/archives/7513)\n1. [Setting up Django and your web server with uWSGI and nginx](https://uwsgi-docs.readthedocs.io/en/latest/tutorials/Django_and_nginx.html)\n", "tags": ["Django", "nginx", "MySQL", "Python", "Ubuntu"]}