{"tags": ["elb", "AWS"], "context": " More than 1 year has passed since last update.\u7279\u5fb4\u3092\u3064\u3089\u3064\u3089\u3068\u307e\u3068\u3081\u3066\u307f\u308b\u3002\nOverview\nhttp://docs.amazonwebservices.com/ElasticLoadBalancing/latest/DeveloperGuide/arch-loadbalancing.html\n\n\u751f\u5b58\u78ba\u8a8d\u3092\u3059\u308b\u3088\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067ELB\u306b\u95a2\u9023\u4ed8\u3051\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u751f\u304d\u3066\u308b\u304b\u78ba\u8a8d\u3059\u308b\u30ea\u30af\u30a8\u30b9\u30c8\u3092ELB\u306f\u9001\u308b\u3088\u3002\nport\u3084\u30ea\u30af\u30a8\u30b9\u30c8\u5148\u306eURL\u306f\u6307\u5b9a\u3067\u304d\u308b\u3088\u3002\n\u81ea\u5206\u306f\u5c02\u7528\u306eendpoint\u4f5c\u3063\u3066\u305d\u308c\u3067\u78ba\u8a8d\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u308b\u3088\uff01\n\u3061\u306a\u307f\u306b\u3001\u52d5\u7684\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u52d5\u3044\u3066\u3044\u308b\u306a\u3089\u305d\u3063\u3061\u3067\u53d7\u3051\u53d6\u3063\u305f\u307b\u3046\u304c\u3044\u3044\u3088\u3002\n\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u3060\u3068Apache\u3084nginx\u304c\u843d\u3061\u3066\u306a\u3044\u306e\u306f\u78ba\u8a8d\u51fa\u6765\u308b\u3051\u3069\u3001\n\u5965\u306eunicorn\u3084mongrel\u3084passenger\u3089\u3078\u3093\u3067\u8a70\u307e\u3063\u3066\u308b\u304b\u3082\u3088\uff01\n\nSSL\u697d\u30c1\u30f3\u3060\u3088\n\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u30fc\u306b\u8a3c\u660e\u66f8\u3068\u79d8\u5bc6\u9375\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u3060\u3051\u3067\u3044\u3044\u3088\u3002\n\u305d\u308c\u305e\u308c\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u8a3c\u660e\u66f8\u305f\u3061\u3092\u914d\u5099\u3057\u305f\u308a\u3001\n\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u306a\u3044\u306e\u3067\u697d\u3060\u3088\u3002\n\u3068\u3044\u3046\u306e\u3082\u3001SSL Termination\u3068\u3057\u3066\u77e5\u3089\u308c\u3066\u3044\u308b\u3051\u3069\u3001\nclient\u3068ELB\u306e\u9593\u306fHTTPS\u3067\u901a\u4fe1\u3059\u308b\u3051\u3069\u3001\nELB\u3068instance(s)\u306e\u9593\u306fHTTP(port=80)\u3067\u901a\u4fe1\u3059\u308b\u3088\u3002\n\nclient\u306eIP\u3082\u3068\u308c\u308b\u3088\nclient\u3068app\u30b5\u30fc\u30d0\u30fc\u306e\u307f\u3060\u3063\u305f\u3089\u3001\n\u9593\u306b\u90aa\u9b54\u3059\u308b\u5974\u306f\u3044\u306a\u304b\u3063\u305f\u306e\u3067\u7c21\u5358\u306bclient\u306eIP\u304c\u3068\u308c\u305f\u3051\u3069\u3001\n\u9593\u306bELB\u304c\u3044\u308b\u304b\u3089app\u30b5\u30fc\u30d0\u30fc\u304b\u3089remote_ip\u3092\u3068\u308d\u3046\u3068\u3059\u308b\u3068ELB\u306eIP\u306b\u306a\u3063\u3061\u3083\u3046\u3088\u3002\u840e\u3048\u3002\n\u3067\u3082\u3001\u3061\u3083\u3093\u3068\u5bfe\u51e6\u6cd5\u304c\u3042\u3063\u3066\u3001\nrequest header\u306b\u4ee5\u4e0b\u306eheader\u304c\u4ed8\u4e0e\u3055\u308c\u308b\u3088\uff01\nX-Forwarded-For: clientIPAddress\n\n\u7c21\u5358\u3060\u306d\uff01\n\u305f\u3060\u3001\u5834\u5408\u306b\u3088\u3063\u3066\u306fELB\u304c\u8907\u6570\u679a\u565b\u3093\u3067\u308b\u5834\u5408\u304c\u3042\u3063\u3066\u3001\n\u8a73\u3057\u304f\u306f\u5272\u611b\u3059\u308b\u3051\u3069\u3001\u8907\u6570\u306eIP\u30a2\u30c9\u30ec\u30b9\u304c\u5165\u3063\u3066\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u3088\uff01\nX-Forwarded-For: clientIPAddress, previousLoadBalancerIPAddress\n\n\u6c17\u3092\u3064\u3051\u3066\u306d\uff01\u81ea\u5206\u306f\u3053\u308c\u3067\u5c11\u3057\u30cf\u30de\u3063\u305f\u3053\u3068\u304c\u3042\u308b\u3088\uff01\n\nclient\u3068\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u3082\u3068\u308c\u308b\u3088\n\u4f8b\u3048\u3070\u3001HTTP\u3067\u304d\u305f\u3072\u3068\u306fHTTPS\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3057\u305f\u3044\u3068\u3059\u308b\u3002\n\u3067\u3082\u3001\u5148\u306e\u901a\u308aELB\u3068instance\u306e\u9593\u306e\u901a\u4fe1\u306f\u5e38\u306bHTTP\uff08\u306b\u3057\u306a\u3044\u306e\u3082\u3067\u304d\u308b\u3051\u3069\u3001\u30e1\u30ea\u30c3\u30c8\u304c\u306d\uff09\u3060\u304b\u3089\u3001\nclient\u3068ELB\u9593\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u304c\u5206\u304b\u3089\u306a\u3044\u3088\uff01\n\u306a\u306e\u3067\u3001IP\u306e\u3068\u304d\u3068\u540c\u69d8\u306bheader\u3092\u4ed8\u4e0e\u3059\u308b\u3088\uff01\nX-Forwarded-Proto: originatingProtocol\n\n\u3053\u308c\u3067\u5206\u304b\u308b\u306d\uff01\ninstance\u306f\u3053\u306eheader\u3092\u307f\u3066http\u30a2\u30af\u30bb\u30b9\u306e\u4eba\u306fhttps\u306e\u30a2\u30c9\u30ec\u30b9\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3059\u308b\u3068\u304b\u3059\u308b\u3093\u3060\u306d\u3002\n--\n\u7d50\u5c40\u306f\u305f\u3060\u306e\u548c\u8a33\u306a\u3093\u3060\u3051\u3069\u3001\n\u3086\u308b\u30fc\u304f\u66f8\u3044\u3066\u307f\u305f\u3002\n\n\u7279\u5fb4\u3092\u3064\u3089\u3064\u3089\u3068\u307e\u3068\u3081\u3066\u307f\u308b\u3002\n\nOverview\nhttp://docs.amazonwebservices.com/ElasticLoadBalancing/latest/DeveloperGuide/arch-loadbalancing.html\n\n# \u751f\u5b58\u78ba\u8a8d\u3092\u3059\u308b\u3088\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067ELB\u306b\u95a2\u9023\u4ed8\u3051\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u751f\u304d\u3066\u308b\u304b\u78ba\u8a8d\u3059\u308b\u30ea\u30af\u30a8\u30b9\u30c8\u3092ELB\u306f\u9001\u308b\u3088\u3002\n\nport\u3084\u30ea\u30af\u30a8\u30b9\u30c8\u5148\u306eURL\u306f\u6307\u5b9a\u3067\u304d\u308b\u3088\u3002\n\u81ea\u5206\u306f\u5c02\u7528\u306eendpoint\u4f5c\u3063\u3066\u305d\u308c\u3067\u78ba\u8a8d\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u308b\u3088\uff01\n\n\u3061\u306a\u307f\u306b\u3001\u52d5\u7684\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u52d5\u3044\u3066\u3044\u308b\u306a\u3089\u305d\u3063\u3061\u3067\u53d7\u3051\u53d6\u3063\u305f\u307b\u3046\u304c\u3044\u3044\u3088\u3002\n\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u3060\u3068Apache\u3084nginx\u304c\u843d\u3061\u3066\u306a\u3044\u306e\u306f\u78ba\u8a8d\u51fa\u6765\u308b\u3051\u3069\u3001\n\u5965\u306eunicorn\u3084mongrel\u3084passenger\u3089\u3078\u3093\u3067\u8a70\u307e\u3063\u3066\u308b\u304b\u3082\u3088\uff01\n\n# SSL\u697d\u30c1\u30f3\u3060\u3088\n\n\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u30fc\u306b\u8a3c\u660e\u66f8\u3068\u79d8\u5bc6\u9375\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u3060\u3051\u3067\u3044\u3044\u3088\u3002\n\u305d\u308c\u305e\u308c\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u8a3c\u660e\u66f8\u305f\u3061\u3092\u914d\u5099\u3057\u305f\u308a\u3001\n\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u306a\u3044\u306e\u3067\u697d\u3060\u3088\u3002\n\n\u3068\u3044\u3046\u306e\u3082\u3001SSL Termination\u3068\u3057\u3066\u77e5\u3089\u308c\u3066\u3044\u308b\u3051\u3069\u3001\nclient\u3068ELB\u306e\u9593\u306fHTTPS\u3067\u901a\u4fe1\u3059\u308b\u3051\u3069\u3001\nELB\u3068instance(s)\u306e\u9593\u306fHTTP(port=80)\u3067\u901a\u4fe1\u3059\u308b\u3088\u3002\n\n# client\u306eIP\u3082\u3068\u308c\u308b\u3088\n\nclient\u3068app\u30b5\u30fc\u30d0\u30fc\u306e\u307f\u3060\u3063\u305f\u3089\u3001\n\u9593\u306b\u90aa\u9b54\u3059\u308b\u5974\u306f\u3044\u306a\u304b\u3063\u305f\u306e\u3067\u7c21\u5358\u306bclient\u306eIP\u304c\u3068\u308c\u305f\u3051\u3069\u3001\n\u9593\u306bELB\u304c\u3044\u308b\u304b\u3089app\u30b5\u30fc\u30d0\u30fc\u304b\u3089remote_ip\u3092\u3068\u308d\u3046\u3068\u3059\u308b\u3068ELB\u306eIP\u306b\u306a\u3063\u3061\u3083\u3046\u3088\u3002\u840e\u3048\u3002\n\n\u3067\u3082\u3001\u3061\u3083\u3093\u3068\u5bfe\u51e6\u6cd5\u304c\u3042\u3063\u3066\u3001\nrequest header\u306b\u4ee5\u4e0b\u306eheader\u304c\u4ed8\u4e0e\u3055\u308c\u308b\u3088\uff01\n\n```\nX-Forwarded-For: clientIPAddress\n```\n\n\u7c21\u5358\u3060\u306d\uff01\n\n\u305f\u3060\u3001\u5834\u5408\u306b\u3088\u3063\u3066\u306fELB\u304c\u8907\u6570\u679a\u565b\u3093\u3067\u308b\u5834\u5408\u304c\u3042\u3063\u3066\u3001\n\u8a73\u3057\u304f\u306f\u5272\u611b\u3059\u308b\u3051\u3069\u3001\u8907\u6570\u306eIP\u30a2\u30c9\u30ec\u30b9\u304c\u5165\u3063\u3066\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u3088\uff01\n\n```\nX-Forwarded-For: clientIPAddress, previousLoadBalancerIPAddress\n```\n\n\u6c17\u3092\u3064\u3051\u3066\u306d\uff01\u81ea\u5206\u306f\u3053\u308c\u3067\u5c11\u3057\u30cf\u30de\u3063\u305f\u3053\u3068\u304c\u3042\u308b\u3088\uff01\n\n# client\u3068\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u3082\u3068\u308c\u308b\u3088\n\n\u4f8b\u3048\u3070\u3001HTTP\u3067\u304d\u305f\u3072\u3068\u306fHTTPS\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3057\u305f\u3044\u3068\u3059\u308b\u3002\n\u3067\u3082\u3001\u5148\u306e\u901a\u308aELB\u3068instance\u306e\u9593\u306e\u901a\u4fe1\u306f\u5e38\u306bHTTP\uff08\u306b\u3057\u306a\u3044\u306e\u3082\u3067\u304d\u308b\u3051\u3069\u3001\u30e1\u30ea\u30c3\u30c8\u304c\u306d\uff09\u3060\u304b\u3089\u3001\nclient\u3068ELB\u9593\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u304c\u5206\u304b\u3089\u306a\u3044\u3088\uff01\n\n\u306a\u306e\u3067\u3001IP\u306e\u3068\u304d\u3068\u540c\u69d8\u306bheader\u3092\u4ed8\u4e0e\u3059\u308b\u3088\uff01\n\n```\nX-Forwarded-Proto: originatingProtocol\n```\n\n\u3053\u308c\u3067\u5206\u304b\u308b\u306d\uff01\ninstance\u306f\u3053\u306eheader\u3092\u307f\u3066http\u30a2\u30af\u30bb\u30b9\u306e\u4eba\u306fhttps\u306e\u30a2\u30c9\u30ec\u30b9\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3059\u308b\u3068\u304b\u3059\u308b\u3093\u3060\u306d\u3002\n\n--\n\n\u7d50\u5c40\u306f\u305f\u3060\u306e\u548c\u8a33\u306a\u3093\u3060\u3051\u3069\u3001\n\u3086\u308b\u30fc\u304f\u66f8\u3044\u3066\u307f\u305f\u3002"}