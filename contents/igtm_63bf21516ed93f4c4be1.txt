{"tags": ["sqlite", "pouchdb", "Cordova"], "context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u3053\u3053\u3067\u884c\u3063\u3066\u308b\u3088\u3046\u306b\u3001\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u30a2\u30d7\u30ea\u3067localstorage\u3092\u4f7f\u3046\u306e\u306f\u3088\u308d\u3057\u304f\u306a\u3044\u3002\n\u306a\u306e\u3067SQLite\u3092\u4f7f\u3046\u3002\n\u6163\u308c\u89aa\u3057\u3093\u3060JSON\u3067\u6271\u3048\u308bPouchDB\u304c\u3088\u3055\u6c17\u306a\u306e\u3067\u4f7f\u3063\u3066\u307f\u305f\u3002\n\n\u57fa\u672c\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb(\u3053\u308c\u304c\uff11\u756a\u308f\u304b\u308a\u3084\u3059\u3044)\n\nionic+PouchDB+SQLite\n\n\n\u88dc\u8db3\n\n\u30c6\u30fc\u30d6\u30eb\u306ftype\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u8868\u73fe\nDB\u4fdd\u5b58\u5834\u6240:/Users/[username]/Library/Developer/CoreSimulator/Devices/[id]/data/Containers/Data/Application/[id]/Documents\n\n\u5168\u4ef6\u53d6\u5f97:DB.allDocs({ include_docs: true, attachments: true })\n\n\n\n\u4f8b)DB.allDocs\u306e\u8fd4\u5374\u5024\n{\"total_rows\":253,\n\"offset\":0,\n\"rows\":[\n    {\"id\":\"000C105E-A22C-F4EA-A184-85C22E979B99\",\n    \"key\":\"000C105E-A22C-F4EA-A184-85C22E979B99\",\n    \"value\":{\"rev\":\"1-cc517b7f911eedde487b9a0bf4e520fb\"},\n    \"doc\":{\"id\":68,\n            \"name\":\"test\",\n            \"age\":25,\n            \"type\":\"users\",\n            \"_id\":\"000C105E-A22C-F4EA-A184-85C22E979B99\",\n            \"_rev\":\"1-cc517b7f911eedde487b9a0bf4e520fb\"\n            }\n    },..\n\n\n\nDB\u306b\u5909\u66f4\u304c\u3042\u308b\u3054\u3068\u306b_rev\u304c\u5909\u308f\u308b\u306e\u3067\u5909\u66f4\u3057\u305f\u5f8c\u5e30\u3063\u3066\u304f\u308brev\u3092_rev\u306b\u5165\u308c\u306a\u304a\u3059\u5fc5\u8981\u3042\u308a\u3002\n\n\n\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9(on iOS Simulator)\nSQLite\u306f\u9045\u3044\u3089\u3057\u3044\u306e\u3067\u8a08\u6e2c\n// 397ms \u304b\u304b\u3063\u305f\nfunction removeAll(){\n            var data = [];\n            return $q.when(_db.allDocs({\n                include_docs: true,\n                attachments: true\n            })).then(function(res){\n                var rows = res.rows;\n                for(var i=0;i<rows.length;i++){\n                    var doc = rows[i].doc;\n                    doc._deleted = true;\n                    data.push(doc);\n                }\n                return $q.when(_db.bulkDocs(data));\n            });\n        }\n\n\u78ba\u304b\u306blocalstorage\u3088\u308a\u306f\u9045\u3044\n\u7279\u306bwindows\u3068\u304b\u306f\u3082\u3063\u3068\u9045\u3044\u3089\u3057\u3044\n\n\u5de5\u592b\n\n\u6bce\u56deDB\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u306e\u306f\u6642\u9593\u3082\u304b\u304b\u308b\u3057\u3001angular\u306edata-binding\u3082\u751f\u304b\u305b\u306a\u3044\u3093\u3067\u3001$rootScope.$VM\u306bDB\u3068\u540c\u671f\u3055\u305b\u3066\u4fdd\u6301\u3055\u305b\u3066\u304a\u304f\u3002\u305d\u308c\u3092\u30e9\u30c3\u30d4\u30f3\u30b0\u3057\u305fModelFactory\u3067\u3082\u4f5c\u3063\u3066\u3001find\u306e\u6642\u306f\u5168\u3066$VM\u304b\u3089\u53d6\u5f97\u3002\u5909\u66f4\u3092\u52a0\u3048\u308b\u5834\u5408\u306fDB\u306b\u5909\u66f4\u3092\u52a0\u3048\u3066\u3001\u8fd4\u3063\u3066\u304d\u305fobject\u306erev\u3092$VM\u306b\u3042\u308b_rev\u3092\u305d\u308c\u305e\u308cid\u3068_id\u3067\u6bd4\u8f03\u30eb\u30fc\u30d7\u3057\u3066\u5165\u308c\u306a\u304a\u3059\u3002\u6700\u5f8c\u306b_rev\u304c\u65b0\u3057\u304f\u306a\u3063\u305fobject\u3092$VM\u306b\u5165\u308c\u306a\u304a\u3059\u3063\u3066\u884c\u304f\u5f62\u3092\u3068\u308b\u3002\u8d77\u52d5\u6642\u306b\u5168\u3066$VM\u306b\u5165\u308c\u3066\u304b\u3089\u3053\u308c\u3089\u3092\u884c\u3048\u3070\u3046\u307e\u304f\u5c11\u306a\u3044DB\u30a2\u30af\u30bb\u30b9\u56de\u6570\u3067\u904b\u7528\u3067\u304d\u305d\u3046\u3002\n\n_id\u4ee5\u5916\u306e\u691c\u7d22\u304c\u3081\u3093\u3069\u304f\u3055\u3044\u306e\u3067_id\u306eprefix\u691c\u7d22\u3092\u4f7f\u3063\u3066table\u5168\u4ef6\u53d6\u5f97\u3068\u304b\u51fa\u6765\u308b\u3088\u3046\u306b\u3001{_id:\"users-1\"}\u307f\u305f\u3044\u306b\u3059\u308b\u3068\u3044\u3044\u3002\n\n{\"ok\":true,\"id\":\"users-1\",\"rev\":\"84-1092ef4c3c55010372d3b86ee96e2aa4\"}\n\n\n\u516c\u5f0fAPI\u7b49\n\nPouchDB API\niOS Data Storage Guide\n\n### \u306f\u3058\u3081\u306b\n[\u3053\u3053](http://gonehybrid.com/dont-assume-localstorage-will-always-work-in-your-hybrid-app/)\u3067\u884c\u3063\u3066\u308b\u3088\u3046\u306b\u3001\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u30a2\u30d7\u30ea\u3067localstorage\u3092\u4f7f\u3046\u306e\u306f\u3088\u308d\u3057\u304f\u306a\u3044\u3002\n\u306a\u306e\u3067SQLite\u3092\u4f7f\u3046\u3002\n\u6163\u308c\u89aa\u3057\u3093\u3060JSON\u3067\u6271\u3048\u308b[PouchDB](http://pouchdb.com/)\u304c\u3088\u3055\u6c17\u306a\u306e\u3067\u4f7f\u3063\u3066\u307f\u305f\u3002\n\n### \u57fa\u672c\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb(\u3053\u308c\u304c\uff11\u756a\u308f\u304b\u308a\u3084\u3059\u3044)\n- [ionic+PouchDB+SQLite](http://gonehybrid.com/how-to-use-pouchdb-sqlite-for-local-storage-in-your-ionic-app/)\n\n\n### \u88dc\u8db3\n- [\u30c6\u30fc\u30d6\u30eb\u306f`type`\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u8868\u73fe](http://stackoverflow.com/questions/30066753/pouchdb-structure)\n- DB\u4fdd\u5b58\u5834\u6240:`/Users/[username]/Library/Developer/CoreSimulator/Devices/[id]/data/Containers/Data/Application/[id]/Documents`\n- \u5168\u4ef6\u53d6\u5f97:`DB.allDocs({ include_docs: true, attachments: true })`\n\n``` \u4f8b)DB.allDocs\u306e\u8fd4\u5374\u5024\n{\"total_rows\":253,\n\"offset\":0,\n\"rows\":[\n\t{\"id\":\"000C105E-A22C-F4EA-A184-85C22E979B99\",\n\t\"key\":\"000C105E-A22C-F4EA-A184-85C22E979B99\",\n\t\"value\":{\"rev\":\"1-cc517b7f911eedde487b9a0bf4e520fb\"},\n\t\"doc\":{\"id\":68,\n\t\t\t\"name\":\"test\",\n\t\t\t\"age\":25,\n\t\t\t\"type\":\"users\",\n\t\t\t\"_id\":\"000C105E-A22C-F4EA-A184-85C22E979B99\",\n\t\t\t\"_rev\":\"1-cc517b7f911eedde487b9a0bf4e520fb\"\n\t\t\t}\n\t},..\n```\n- DB\u306b\u5909\u66f4\u304c\u3042\u308b\u3054\u3068\u306b`_rev`\u304c\u5909\u308f\u308b\u306e\u3067\u5909\u66f4\u3057\u305f\u5f8c\u5e30\u3063\u3066\u304f\u308b`rev`\u3092`_rev`\u306b\u5165\u308c\u306a\u304a\u3059\u5fc5\u8981\u3042\u308a\u3002\n\n\n### \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9(on iOS Simulator)\nSQLite\u306f\u9045\u3044\u3089\u3057\u3044\u306e\u3067\u8a08\u6e2c\n\n``` \u5168\u4ef6\u524a\u9664(81rows)\n// 397ms \u304b\u304b\u3063\u305f\nfunction removeAll(){\n            var data = [];\n            return $q.when(_db.allDocs({\n                include_docs: true,\n                attachments: true\n            })).then(function(res){\n                var rows = res.rows;\n                for(var i=0;i<rows.length;i++){\n                    var doc = rows[i].doc;\n                    doc._deleted = true;\n                    data.push(doc);\n                }\n                return $q.when(_db.bulkDocs(data));\n            });\n        }\n```\n\u78ba\u304b\u306blocalstorage\u3088\u308a\u306f\u9045\u3044\n[\u7279\u306bwindows\u3068\u304b\u306f\u3082\u3063\u3068\u9045\u3044\u3089\u3057\u3044](http://sqlite.1065341.n5.nabble.com/Windows-slow-vs-iOS-OSX-fast-Performance-td65794.html)\n##### \u5de5\u592b\n- \u6bce\u56deDB\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u306e\u306f\u6642\u9593\u3082\u304b\u304b\u308b\u3057\u3001angular\u306edata-binding\u3082\u751f\u304b\u305b\u306a\u3044\u3093\u3067\u3001`$rootScope.$VM`\u306bDB\u3068\u540c\u671f\u3055\u305b\u3066\u4fdd\u6301\u3055\u305b\u3066\u304a\u304f\u3002\u305d\u308c\u3092\u30e9\u30c3\u30d4\u30f3\u30b0\u3057\u305fModelFactory\u3067\u3082\u4f5c\u3063\u3066\u3001find\u306e\u6642\u306f\u5168\u3066$VM\u304b\u3089\u53d6\u5f97\u3002\u5909\u66f4\u3092\u52a0\u3048\u308b\u5834\u5408\u306fDB\u306b\u5909\u66f4\u3092\u52a0\u3048\u3066\u3001\u8fd4\u3063\u3066\u304d\u305fobject\u306e`rev`\u3092$VM\u306b\u3042\u308b`_rev`\u3092\u305d\u308c\u305e\u308c`id`\u3068`_id`\u3067\u6bd4\u8f03\u30eb\u30fc\u30d7\u3057\u3066\u5165\u308c\u306a\u304a\u3059\u3002\u6700\u5f8c\u306b`_rev`\u304c\u65b0\u3057\u304f\u306a\u3063\u305fobject\u3092$VM\u306b\u5165\u308c\u306a\u304a\u3059\u3063\u3066\u884c\u304f\u5f62\u3092\u3068\u308b\u3002\u8d77\u52d5\u6642\u306b\u5168\u3066`$VM`\u306b\u5165\u308c\u3066\u304b\u3089\u3053\u308c\u3089\u3092\u884c\u3048\u3070\u3046\u307e\u304f\u5c11\u306a\u3044DB\u30a2\u30af\u30bb\u30b9\u56de\u6570\u3067\u904b\u7528\u3067\u304d\u305d\u3046\u3002\n- `_id`\u4ee5\u5916\u306e\u691c\u7d22\u304c\u3081\u3093\u3069\u304f\u3055\u3044\u306e\u3067`_id`\u306e[prefix\u691c\u7d22](http://pouchdb.com/api.html#prefix-search)\u3092\u4f7f\u3063\u3066table\u5168\u4ef6\u53d6\u5f97\u3068\u304b\u51fa\u6765\u308b\u3088\u3046\u306b\u3001`{_id:\"users-1\"}`\u307f\u305f\u3044\u306b\u3059\u308b\u3068\u3044\u3044\u3002\n\n``` \u4f8b)\u5909\u66f4\u304c\u5b8c\u4e86\u3057\u305f\u5f8c\u5e30\u3063\u3066\u304f\u308bobject\n{\"ok\":true,\"id\":\"users-1\",\"rev\":\"84-1092ef4c3c55010372d3b86ee96e2aa4\"}\n```\n\n### \u516c\u5f0fAPI\u7b49\n- [PouchDB API](http://pouchdb.com/api.html)\n- [iOS Data Storage Guide](https://developer.apple.com/icloud/documentation/data-storage/index.html)\n"}