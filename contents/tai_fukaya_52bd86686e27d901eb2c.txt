{"context": "\n\n\u52d5\u6a5f\n\u3042\u308b\u30a4\u30d9\u30f3\u30c8\u3067\u56f3\u5f62\u304c\u53ef\u5909\u3059\u308b\u591a\u89d2\u5f62\u3068\u91cd\u306a\u308b\u306a\u3089\u3070\u3001\u8272\u3092\u5857\u308b\u3068\u3044\u3046\u5b9f\u88c5\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\u4eca\u5f8c\u3082\u5b9f\u88c5\u3059\u308b\u6a5f\u4f1a\u306f\u3042\u308b\u306e\u3067\u3001\u5099\u5fd8\u9332\u3068\u3057\u3066\u3001\u6b8b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u3061\u306a\u307f\u306b\u3001three.js\u3092\u4f7f\u3063\u3066\u3044\u308b\u524d\u63d0\u3068\u306a\u308a\u307e\u3059\u3002\n\n\n\u5224\u5b9a\u65b9\u6cd5\n\u5927\u304d\u304f\u5206\u3051\u308b\u3068\u3001\uff12\u3064\u306e\u51e6\u7406\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u5186\u304c\u591a\u89d2\u5f62\u306e\u8fba\u3068\u63a5\u3059\u308b\n\u5186\u306e\u4e2d\u5fc3\u304c\u591a\u89d2\u5f62\u306e\u4e2d\u306b\u5b58\u5728\u3059\u308b\n\n\u591a\u89d2\u5f62\u304c\u591a\u89d2\u5f62\u3068\u91cd\u306a\u308b\u304b\u3068\u3044\u3046\u3053\u3068\u306f\u3001\u5404\u70b9\u306b\u3064\u3044\u3066\u3001\u3044\u305a\u308c\u304b\u304c\u591a\u89d2\u5f62\u306e\u4e2d\u306b\u5b58\u5728\u3059\u308b\u304b\u306a\u306e\u3067\u3001\uff12\u306e\u307f\u5b9f\u88c5\u3059\u308c\u3070\u3001OK\u3067\u3059\u304c\u3001\u5186\u3068\u306a\u308b\u30681\u306e\u5b9f\u88c5\u3082\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u5b9f\u88c5\n\n\u5186\u304c\u591a\u89d2\u5f62\u306e\u8fba\u3068\u63a5\u3059\u308b\n\u5186\u306e\u4e2d\u5fc3\u3068\u7dda\u5206\u3068\u306e\u8ddd\u96e2\u304c\u3001\u5186\u306e\u534a\u5f84\u4ee5\u5185\u3067\u3042\u308c\u3070\u3001\u63a5\u3059\u308b\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u30ea\u30f3\u30af\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u307e\u3059\u3002\nhttp://1st.geocities.jp/shift486909/program/collision.html\n\u300c2.\u5186\u304c\u30ec\u30fc\u30b6\u30fc\u306e\u7dda\u5206\u306b\u89e6\u308c\u3066\u306a\u3044\u304c\u3069\u3046\u304b\u300d\u3092\u53c2\u8003\u306b\u3001\u5185\u7a4d\u3092\u4f7f\u3046\u65b9\u6cd5\u3067\u5b9f\u88c5\u3057\u307e\u3057\u305f\u3002\n\nCircleUtil.js\nvar CIRCLE_UTIL = {\n    /*\n    \u5186\u304c\u591a\u89d2\u5f62\u3068\u63a5\u3059\u308b\n    */\n    isTouchedShape : function (cent, radius, shapeVertices) {\n        var count = shapeVertices.length;\n        for (var i = 0; i < count; i++) {\n            var isCrossed = CIRCLE_UTIL.isTouchedLine(cent, radius, shapeVertices[i], shapeVertices[(i+1)%shapeVertices]);\n            if (isCrossed) {\n                return true;\n            }\n        }\n        return false;\n    },\n    /*\n    \u5186\u304c\u7dda\u3068\u63a5\u3059\u308b\u3002\n    */\n    isTouchedLine: function (cent, radius, v0, v1) {\n        var v0c = new THREE.Vector3();\n        var v01 = new THREE.Vector3();\n        var v1c = new THREE.Vector3();\n        v0c.subVectors(v0, cent);\n        v1c.subVectors(v1, cent);\n        v01.subVectors(v0, p1);\n        var v0cLen = v0c.length(), v01Len = v01.length();\n        var dot = v01.dot(v0c);\n        var k = dot/Math.pow(v01Len, 2);\n        // \u5404\u7aef\u3078\u306e\u8ddd\u96e2\u304c\u534a\u5f84\u3088\u308a\u5c0f\u3055\u3044\u304b\n        if (v0c.length() < radius || v1c.length() < radius) {\n            return true;\n        }\n        // \u7dda\u5206\u4e0a\u306b\u3042\u308b\u304b\n        if (k < 0 || k > 1) {\n            return false;\n        }\n        // \u534a\u5f84\u3088\u308a\u3001\u7dda\u5206\u3078\u306e\u8ddd\u96e2\u304c\u8fd1\u3044\u304b\u3069\u3046\u304b\n        return Math.pow(v0cLen, 2) - Math.pow(dot, 2)/Math.pow(v01Len, 2) < Math.pow(radius, 2);\n    }\n};\n\n\n\u5186\u306e\u4e2d\u70b9\u3068\u534a\u5f84\u3001\u591a\u89d2\u5f62\u306e\u70b9\u3092\u5f15\u6570\u306b\u6e21\u305b\u3070\u3001\u63a5\u3059\u308b\u304b\u3069\u3046\u304b\u5224\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\n\u5186\u306e\u4e2d\u5fc3\u304c\u591a\u89d2\u5f62\u306e\u4e2d\u306b\u5b58\u5728\u3059\u308b\n\u70b9\u304c\u591a\u89d2\u5f62\u306e\u4e2d\u306b\u5b58\u5728\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5224\u5b9a\u3057\u307e\u3059\u3002\n\u3053\u3061\u3089\u306f\u3001\u4ee5\u4e0b\u306e\u30ea\u30f3\u30af\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\nhttp://www.nttpc.co.jp/technology/number_algorithm.html\nCrossing Number Algorithm\u306e\u307b\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u307b\u307c\u305d\u306e\u307e\u307e\u3067\u3059\u304c\u30fb\u30fb\u30fb\u3002\n\nPointUtil.js\nvar POINT_UTIL = {\n    /*\n    \u70b9\u304c\u591a\u89d2\u5f62\u306e\u4e2d\u306b\u3042\u308b\n    Crossing Number Algorithm\n\n    \u591a\u89d2\u5f62\u304c\u9589\u3058\u3066\u3044\u308b\u3053\u3068\uff08\u59cb\u70b9\u3068\u7d42\u70b9\u304c\u540c\u3058\uff09\n    \u81ea\u5df1\u4ea4\u5dee\u306f\u307b\u3069\u304f\u5fc5\u8981\u3042\u308a\n    */\n    isInShape : function (point, shapeVertices) {\n        var count = 0;\n        var vertexCount = shapeVertices.length;\n\n        for (var i = 0; i < vertexCount; i++) {\n            var p0 = shapeVertices[i];\n            var p1 = shapeVertices[(i+1)%vertexCount];\n\n            if (\n                // \u4e0a\u5411\u304d\n                ((p0.y <= point.y) && (p1.y > point.y))\n                // \u4e0b\u5411\u304d\n                || ((p0.y > point.y) && (p1.y <= point.y))) {\n                    // \u8fba\u306f\u53f3\u5074\u3001\u91cd\u306a\u3089\u306a\u3044\n                    var intersectionX = p0.x + (point.y - p0.y) * (p1.x - p0.x) / (p1.y - p0.y);\n                    if (point.x < intersectionX) {\n                        ++count;\n                    }\n            }\n        }\n        // \u5947\u6570\u3067\u3042\u308c\u3070\u3001\u5185\u90e8\u306b\u3042\u308b\n        return !!(count%2);\n    }\n};\n\n\n\u30b3\u30e1\u30f3\u30c8\u306b\u3082\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u304c\u3001\u591a\u89d2\u5f62\u306e\u8fba\u304c\u4ea4\u5dee\u3057\u3066\u3044\u308b\u7b87\u6240\u304c\u3042\u308b\u5834\u5408\u3001\u305d\u308c\u3092\u307b\u3069\u304f\u306a\u308a\u3001\u5225\u306e\u591a\u89d2\u5f62\u3068\u3057\u3066\u3001\u5206\u5272\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\n\u5b9f\u88c5\u4f8b\n\u3053\u308c\u3092\u7d44\u307f\u5408\u308f\u305b\u308c\u3070\u3001\u4f8b\u3048\u3070\u3001\u3053\u3093\u306a\u304b\u3093\u3058\u3067\u3001\u5186\u3068\u591a\u89d2\u5f62\u304c\u91cd\u306a\u308b\u3053\u3068\u304c\u5224\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\nexample.js\nrenderer.domElement.addEventListener('mousemove', function(e){\n    var centroid = new THREE.Vector3(e.offsetX, e.offsetY, 0);\n    circle.position.x = centroid.x;\n    circle.position.y = centroid.y;\n    // \u5186\u304c\u591a\u89d2\u5f62\u306e\u8fba\u306b\u63a5\u305b\u305a\u3001\u5185\u90e8\u306b\u3042\u308b\u5834\u5408\n    if (POINT_UTIL.isInShape(centroid, vertices)\n        || CIRCLE_UTIL.isTouchedShape(centroid, radius, vertices)) {\n        line.material.color = new THREE.Color(0xff0000);\n    } else {\n        line.material.color = new THREE.Color(0xffffff);\n    }\n});\n\n\n\n# \u52d5\u6a5f\n\u3042\u308b\u30a4\u30d9\u30f3\u30c8\u3067\u56f3\u5f62\u304c\u53ef\u5909\u3059\u308b\u591a\u89d2\u5f62\u3068\u91cd\u306a\u308b\u306a\u3089\u3070\u3001\u8272\u3092\u5857\u308b\u3068\u3044\u3046\u5b9f\u88c5\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\u4eca\u5f8c\u3082\u5b9f\u88c5\u3059\u308b\u6a5f\u4f1a\u306f\u3042\u308b\u306e\u3067\u3001\u5099\u5fd8\u9332\u3068\u3057\u3066\u3001\u6b8b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u3061\u306a\u307f\u306b\u3001three.js\u3092\u4f7f\u3063\u3066\u3044\u308b\u524d\u63d0\u3068\u306a\u308a\u307e\u3059\u3002\n![collision_001.png](https://qiita-image-store.s3.amazonaws.com/0/68909/be986419-b269-ee00-59fe-39ff3abb8df1.png \"collision_001.png\")\n\n# \u5224\u5b9a\u65b9\u6cd5\n\u5927\u304d\u304f\u5206\u3051\u308b\u3068\u3001\uff12\u3064\u306e\u51e6\u7406\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\n1. \u5186\u304c\u591a\u89d2\u5f62\u306e\u8fba\u3068\u63a5\u3059\u308b\n2. \u5186\u306e\u4e2d\u5fc3\u304c\u591a\u89d2\u5f62\u306e\u4e2d\u306b\u5b58\u5728\u3059\u308b\n\n\u591a\u89d2\u5f62\u304c\u591a\u89d2\u5f62\u3068\u91cd\u306a\u308b\u304b\u3068\u3044\u3046\u3053\u3068\u306f\u3001\u5404\u70b9\u306b\u3064\u3044\u3066\u3001\u3044\u305a\u308c\u304b\u304c\u591a\u89d2\u5f62\u306e\u4e2d\u306b\u5b58\u5728\u3059\u308b\u304b\u306a\u306e\u3067\u3001\uff12\u306e\u307f\u5b9f\u88c5\u3059\u308c\u3070\u3001OK\u3067\u3059\u304c\u3001\u5186\u3068\u306a\u308b\u30681\u306e\u5b9f\u88c5\u3082\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\n# \u5b9f\u88c5\n## \u5186\u304c\u591a\u89d2\u5f62\u306e\u8fba\u3068\u63a5\u3059\u308b\n\u5186\u306e\u4e2d\u5fc3\u3068\u7dda\u5206\u3068\u306e\u8ddd\u96e2\u304c\u3001\u5186\u306e\u534a\u5f84\u4ee5\u5185\u3067\u3042\u308c\u3070\u3001\u63a5\u3059\u308b\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u306e\u30ea\u30f3\u30af\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u307e\u3059\u3002\nhttp://1st.geocities.jp/shift486909/program/collision.html\n\n\u300c2.\u5186\u304c\u30ec\u30fc\u30b6\u30fc\u306e\u7dda\u5206\u306b\u89e6\u308c\u3066\u306a\u3044\u304c\u3069\u3046\u304b\u300d\u3092\u53c2\u8003\u306b\u3001\u5185\u7a4d\u3092\u4f7f\u3046\u65b9\u6cd5\u3067\u5b9f\u88c5\u3057\u307e\u3057\u305f\u3002\n\n```javascript:CircleUtil.js\nvar CIRCLE_UTIL = {\n\t/*\n\t\u5186\u304c\u591a\u89d2\u5f62\u3068\u63a5\u3059\u308b\n\t*/\n\tisTouchedShape : function (cent, radius, shapeVertices) {\n\t\tvar count = shapeVertices.length;\n\t\tfor (var i = 0; i < count; i++) {\n\t\t\tvar isCrossed = CIRCLE_UTIL.isTouchedLine(cent, radius, shapeVertices[i], shapeVertices[(i+1)%shapeVertices]);\n\t\t\tif (isCrossed) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t},\n\t/*\n\t\u5186\u304c\u7dda\u3068\u63a5\u3059\u308b\u3002\n\t*/\n\tisTouchedLine: function (cent, radius, v0, v1) {\n\t\tvar v0c = new THREE.Vector3();\n\t\tvar v01 = new THREE.Vector3();\n\t\tvar v1c = new THREE.Vector3();\n\t\tv0c.subVectors(v0, cent);\n\t\tv1c.subVectors(v1, cent);\n\t\tv01.subVectors(v0, p1);\n\t\tvar v0cLen = v0c.length(), v01Len = v01.length();\n\t\tvar dot = v01.dot(v0c);\n\t\tvar k = dot/Math.pow(v01Len, 2);\n\t\t// \u5404\u7aef\u3078\u306e\u8ddd\u96e2\u304c\u534a\u5f84\u3088\u308a\u5c0f\u3055\u3044\u304b\n\t\tif (v0c.length() < radius || v1c.length() < radius) {\n\t\t\treturn true;\n\t\t}\n\t\t// \u7dda\u5206\u4e0a\u306b\u3042\u308b\u304b\n\t\tif (k < 0 || k > 1) {\n\t\t\treturn false;\n\t\t}\n\t\t// \u534a\u5f84\u3088\u308a\u3001\u7dda\u5206\u3078\u306e\u8ddd\u96e2\u304c\u8fd1\u3044\u304b\u3069\u3046\u304b\n\t\treturn Math.pow(v0cLen, 2) - Math.pow(dot, 2)/Math.pow(v01Len, 2) < Math.pow(radius, 2);\n\t}\n};\n```\n\n\u5186\u306e\u4e2d\u70b9\u3068\u534a\u5f84\u3001\u591a\u89d2\u5f62\u306e\u70b9\u3092\u5f15\u6570\u306b\u6e21\u305b\u3070\u3001\u63a5\u3059\u308b\u304b\u3069\u3046\u304b\u5224\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n![collision_002.png](https://qiita-image-store.s3.amazonaws.com/0/68909/3a28b44b-2d5d-87ce-c7ba-2c2d7e41816a.png \"collision_002.png\")\n\n## \u5186\u306e\u4e2d\u5fc3\u304c\u591a\u89d2\u5f62\u306e\u4e2d\u306b\u5b58\u5728\u3059\u308b\n\u70b9\u304c\u591a\u89d2\u5f62\u306e\u4e2d\u306b\u5b58\u5728\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5224\u5b9a\u3057\u307e\u3059\u3002\n\n\u3053\u3061\u3089\u306f\u3001\u4ee5\u4e0b\u306e\u30ea\u30f3\u30af\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\nhttp://www.nttpc.co.jp/technology/number_algorithm.html\n\nCrossing Number Algorithm\u306e\u307b\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u307b\u307c\u305d\u306e\u307e\u307e\u3067\u3059\u304c\u30fb\u30fb\u30fb\u3002\n\n```javascript:PointUtil.js\nvar POINT_UTIL = {\n\t/*\n\t\u70b9\u304c\u591a\u89d2\u5f62\u306e\u4e2d\u306b\u3042\u308b\n\tCrossing Number Algorithm\n\n\t\u591a\u89d2\u5f62\u304c\u9589\u3058\u3066\u3044\u308b\u3053\u3068\uff08\u59cb\u70b9\u3068\u7d42\u70b9\u304c\u540c\u3058\uff09\n\t\u81ea\u5df1\u4ea4\u5dee\u306f\u307b\u3069\u304f\u5fc5\u8981\u3042\u308a\n\t*/\n\tisInShape : function (point, shapeVertices) {\n\t\tvar count = 0;\n\t\tvar vertexCount = shapeVertices.length;\n\n\t\tfor (var i = 0; i < vertexCount; i++) {\n\t\t\tvar p0 = shapeVertices[i];\n\t\t\tvar p1 = shapeVertices[(i+1)%vertexCount];\n\t\t\t\n\t\t\tif (\n\t\t\t\t// \u4e0a\u5411\u304d\n\t\t\t\t((p0.y <= point.y) && (p1.y > point.y))\n\t\t\t\t// \u4e0b\u5411\u304d\n\t\t\t\t|| ((p0.y > point.y) && (p1.y <= point.y))) {\n\t\t\t\t\t// \u8fba\u306f\u53f3\u5074\u3001\u91cd\u306a\u3089\u306a\u3044\n\t\t\t\t\tvar intersectionX = p0.x + (point.y - p0.y) * (p1.x - p0.x) / (p1.y - p0.y);\n\t\t\t\t\tif (point.x < intersectionX) {\n\t\t\t\t\t\t++count;\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// \u5947\u6570\u3067\u3042\u308c\u3070\u3001\u5185\u90e8\u306b\u3042\u308b\n\t\treturn !!(count%2);\n\t}\n};\n```\n\u30b3\u30e1\u30f3\u30c8\u306b\u3082\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u304c\u3001\u591a\u89d2\u5f62\u306e\u8fba\u304c\u4ea4\u5dee\u3057\u3066\u3044\u308b\u7b87\u6240\u304c\u3042\u308b\u5834\u5408\u3001\u305d\u308c\u3092\u307b\u3069\u304f\u306a\u308a\u3001\u5225\u306e\u591a\u89d2\u5f62\u3068\u3057\u3066\u3001\u5206\u5272\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n![collision_003.png](https://qiita-image-store.s3.amazonaws.com/0/68909/ec6fcaab-8ab7-0c8e-756e-181a84a77f2a.png \"collision_003.png\")\n\n# \u5b9f\u88c5\u4f8b\n\u3053\u308c\u3092\u7d44\u307f\u5408\u308f\u305b\u308c\u3070\u3001\u4f8b\u3048\u3070\u3001\u3053\u3093\u306a\u304b\u3093\u3058\u3067\u3001\u5186\u3068\u591a\u89d2\u5f62\u304c\u91cd\u306a\u308b\u3053\u3068\u304c\u5224\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```javascript:example.js\nrenderer.domElement.addEventListener('mousemove', function(e){\n\tvar centroid = new THREE.Vector3(e.offsetX, e.offsetY, 0);\n\tcircle.position.x = centroid.x;\n\tcircle.position.y = centroid.y;\n\t// \u5186\u304c\u591a\u89d2\u5f62\u306e\u8fba\u306b\u63a5\u305b\u305a\u3001\u5185\u90e8\u306b\u3042\u308b\u5834\u5408\n\tif (POINT_UTIL.isInShape(centroid, vertices)\n\t\t|| CIRCLE_UTIL.isTouchedShape(centroid, radius, vertices)) {\n\t\tline.material.color = new THREE.Color(0xff0000);\n\t} else {\n\t\tline.material.color = new THREE.Color(0xffffff);\n\t}\n});\n```\n", "tags": ["three.js", "JavaScript"]}