{"context": "\n\u52d5\u4f5c\u74b0\u5883\nC++ Builder XE4\n\n\n\u95a2\u9023 http://qiita.com/7of9/items/2159bbba0dce8bd8add4\nvmware\u306e\u30b2\u30b9\u30c8OS\u3068\u30db\u30b9\u30c8OS\u9593\u306e\u901a\u4fe1\u306b\u3064\u3044\u3066\u8abf\u67fb\u4e2d\u3002\nhttps://msdn.microsoft.com/ja-jp/library/windows/desktop/aa365592.aspx\n\u306b\u304a\u3044\u3066Named Pipe Client\u306e\u5b9f\u88c5\u4f8b\u304c\u898b\u3064\u304b\u3063\u305f\u3002\n\u30b3\u30fc\u30c9\u306f\u304a\u305d\u3089\u304fwin32api\u306a\u306e\u304b\u3068\u601d\u3046(\u3088\u304f\u5206\u304b\u3063\u3066\u3044\u306a\u3044)\u3002\nC++ Builder XE4\u4e0a\u3067connect\u307e\u3067\u5b9f\u88c5\u3057\u3066\u307f\u305f\u3002\n\ncode\n\nUnit1.cpp\n//---------------------------------------------------------------------------\n\n#include <vcl.h>\n#pragma hdrstop\n\n#include <windows.h>\n//#include <conio.h>\n#include <tchar.h>\n\n#include \"Unit1.h\"\n//---------------------------------------------------------------------------\n#pragma package(smart_init)\n#pragma resource \"*.dfm\"\nTForm1 *Form1;\n//---------------------------------------------------------------------------\n\n#define BUFSIZE (512)\n\n\n__fastcall TForm1::TForm1(TComponent* Owner)\n    : TForm(Owner)\n{\n}\n//---------------------------------------------------------------------------\nvoid __fastcall TForm1::Button1Click(TObject *Sender)\n{\n    HANDLE hPipe;\n    LPTSTR lpvMessage=TEXT(\"Default message from client.\");\n    TCHAR  chBuf[BUFSIZE];\n    BOOL   fSuccess = FALSE;\n    DWORD  cbRead, cbToWrite, cbWritten, dwMode;\n    LPTSTR lpszPipename = TEXT(\"\\\\\\\\.\\\\pipe\\\\com_1\");\n\n    while(1)\n    {\n      hPipe = CreateFile(\n         lpszPipename,   // pipe name\n         GENERIC_READ |  // read and write access\n         GENERIC_WRITE,\n         0,              // no sharing\n         NULL,           // default security attributes\n         OPEN_EXISTING,  // opens existing pipe\n         0,              // default attributes\n         NULL);          // no template file\n\n        // Break if the pipe handle is valid.\n        if (hPipe != INVALID_HANDLE_VALUE) {\n            break;\n        }\n\n        if (GetLastError() != ERROR_PIPE_BUSY) {\n            String msg = String().sprintf(L\"Could not open pipe. GLE=%d\\n\", GetLastError());\n            Memo1->Lines->Add(msg);\n            return; // error\n        }\n\n        if (! WaitNamedPipe(lpszPipename, 20000)) {\n            Memo1->Lines->Add(L\"Could not open pipe: 20 second wait timed out.\");\n            return; // error\n        }\n    }\n\n    Memo1->Lines->Add(L\"Connected\");\n}\n//---------------------------------------------------------------------------\n\n\n\n\u5b9f\u884c\nvmware\u306e\u30b2\u30b9\u30c8OS\u3092\u8d77\u52d5\u3002 named pipe\u30b5\u30fc\u30d0\u30fc\u3068\u3057\u3066\u3044\u308b\u3002\nnamed pipe\u306f\"\\\\.\\pipe\\com_1\"\u3002\n\u30db\u30b9\u30c8OS\u4e0a\u306b\u3066\u4e0a\u8a18\u3092\u30d3\u30eb\u30c9\u3057\u305f\u30bd\u30d5\u30c8\u3092\u5b9f\u884c\u3057\u3001Memo1\u306b\"Connected\"\u304c\u8868\u793a\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u305f\u3002\n```txt:\u52d5\u4f5c\u74b0\u5883\nC++ Builder XE4\n```\n\n\u95a2\u9023 http://qiita.com/7of9/items/2159bbba0dce8bd8add4\n\nvmware\u306e\u30b2\u30b9\u30c8OS\u3068\u30db\u30b9\u30c8OS\u9593\u306e\u901a\u4fe1\u306b\u3064\u3044\u3066\u8abf\u67fb\u4e2d\u3002\n\nhttps://msdn.microsoft.com/ja-jp/library/windows/desktop/aa365592.aspx\n\u306b\u304a\u3044\u3066Named Pipe Client\u306e\u5b9f\u88c5\u4f8b\u304c\u898b\u3064\u304b\u3063\u305f\u3002\n\n\u30b3\u30fc\u30c9\u306f\u304a\u305d\u3089\u304fwin32api\u306a\u306e\u304b\u3068\u601d\u3046(\u3088\u304f\u5206\u304b\u3063\u3066\u3044\u306a\u3044)\u3002\n\nC++ Builder XE4\u4e0a\u3067connect\u307e\u3067\u5b9f\u88c5\u3057\u3066\u307f\u305f\u3002\n\n## code\n\n```Unit1.cpp\n//---------------------------------------------------------------------------\n\n#include <vcl.h>\n#pragma hdrstop\n\n#include <windows.h>\n//#include <conio.h>\n#include <tchar.h>\n\n#include \"Unit1.h\"\n//---------------------------------------------------------------------------\n#pragma package(smart_init)\n#pragma resource \"*.dfm\"\nTForm1 *Form1;\n//---------------------------------------------------------------------------\n\n#define BUFSIZE (512)\n\n\n__fastcall TForm1::TForm1(TComponent* Owner)\n\t: TForm(Owner)\n{\n}\n//---------------------------------------------------------------------------\nvoid __fastcall TForm1::Button1Click(TObject *Sender)\n{\n\tHANDLE hPipe;\n\tLPTSTR lpvMessage=TEXT(\"Default message from client.\");\n\tTCHAR  chBuf[BUFSIZE];\n\tBOOL   fSuccess = FALSE;\n\tDWORD  cbRead, cbToWrite, cbWritten, dwMode;\n\tLPTSTR lpszPipename = TEXT(\"\\\\\\\\.\\\\pipe\\\\com_1\");\n\n\twhile(1)\n\t{\n      hPipe = CreateFile(\n         lpszPipename,   // pipe name\n         GENERIC_READ |  // read and write access\n         GENERIC_WRITE,\n\t\t 0,              // no sharing\n         NULL,           // default security attributes\n         OPEN_EXISTING,  // opens existing pipe\n         0,              // default attributes\n         NULL);          // no template file\n\n\t\t// Break if the pipe handle is valid.\n\t\tif (hPipe != INVALID_HANDLE_VALUE) {\n\t\t\tbreak;\n\t\t}\n\n\t\tif (GetLastError() != ERROR_PIPE_BUSY) {\n\t\t\tString msg = String().sprintf(L\"Could not open pipe. GLE=%d\\n\", GetLastError());\n\t\t\tMemo1->Lines->Add(msg);\n\t\t\treturn; // error\n\t\t}\n\n\t\tif (! WaitNamedPipe(lpszPipename, 20000)) {\n\t\t\tMemo1->Lines->Add(L\"Could not open pipe: 20 second wait timed out.\");\n\t\t\treturn; // error\n\t\t}\n\t}\n\n\tMemo1->Lines->Add(L\"Connected\");\n}\n//---------------------------------------------------------------------------\n```\n\n## \u5b9f\u884c\n\nvmware\u306e\u30b2\u30b9\u30c8OS\u3092\u8d77\u52d5\u3002 named pipe\u30b5\u30fc\u30d0\u30fc\u3068\u3057\u3066\u3044\u308b\u3002\nnamed pipe\u306f\"\\\\\\\\.\\\\pipe\\\\com_1\"\u3002\n\n\u30db\u30b9\u30c8OS\u4e0a\u306b\u3066\u4e0a\u8a18\u3092\u30d3\u30eb\u30c9\u3057\u305f\u30bd\u30d5\u30c8\u3092\u5b9f\u884c\u3057\u3001Memo1\u306b\"Connected\"\u304c\u8868\u793a\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u305f\u3002\n\n", "tags": ["cppBuilder", "namedPipe", "todo"]}