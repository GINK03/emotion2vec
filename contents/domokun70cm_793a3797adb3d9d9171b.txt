{"tags": ["Mackerel", "PowerShell"], "context": " \u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u65e5\u304b\u30891\u5e74\u4ee5\u4e0a\u304c\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002\u4e00\u901a\u308a\u53e9\u3044\u3066\u307f\u307e\u3057\u305f\u3002\n\u4e00\u89a7\u306f\u3053\u3061\u3089\u3067\u3059\u3002\nAPI\u4ed5\u69d8\uff08v0\uff09\n\u4e00\u90e8\u3001\u4f7f\u3044\u65b9\u304c\u3088\u304f\u308f\u304b\u3089\u305a\u78ba\u8a8d\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n\u6e96\u5099\n\n\u30d8\u30c3\u30c0\u30fc\u3092\u5909\u6570\u306b\u683c\u7d0d\nX-Api-Key\u306e\u307f\u5fc5\u9808\n\n\u30b3\u30de\u30f3\u30c9\n$headers = New-Object \"System.Collections.Generic.Dictionary[[String],[String]]\"\n$headers.Add(\"X-API-KEY\", '12345678901234567890123456789012345678901234')\n\n\n\n\u30db\u30b9\u30c8\n\n\u30db\u30b9\u30c8\u60c5\u5831\u306e\u767b\u9332\n\n\u4ed5\u69d8\nPOST /api/v0/hosts\n\n\n\n\u30b3\u30de\u30f3\u30c9\n$hostinfo = @\"\n{\n    \"name\":  \"ip-172-31-5-222\",\n    \"meta\":  {\n        \"agent-name\":  \"\",\n        \"agent-revision\":  \"\",\n        \"agent-version\":  \"\",\n        \"block_device\":  \"\",\n        \"cloud\":  \"\",\n        \"cpu\":  \"\",\n        \"filesystem\":  \"\",\n        \"kernel\":  \"\",\n        \"memory\":  \"\"\n    }\n}\n\"@\n\n\n\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/hosts -Method Post -Headers $headers -Body $hostinfo -ContentType 'application/json' | ConvertTo-Json\n\n\n\n\u7d50\u679c\n{\n    \"id\":  \"12345678901\"\n}\n\n\n\n\u30db\u30b9\u30c8\u60c5\u5831\u306e\u53d6\u5f97\n\n\u4ed5\u69d8\nGET /api/v0/hosts/<hostId>\n\n\n\n\u30b3\u30de\u30f3\u30c9\n$hostid='***********'\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/hosts/$hostid -Method Get -Headers $headers | ConvertTo-Json\n\n\n\n\u7d50\u679c\n{\n    \"host\":  {\n                 \"name\":  \"ip-172-31-5-181\",\n                 \"nickname\":  null,\n                 \"displayName\":  \"ip-172-31-5-181\",\n                 \"meta\":  {\n                              \"agent-name\":  \"mackerel-agent/0.20.1 (Revision e2f8eea)\",\n                              \"agent-revision\":  \"e2f8eea\",\n                              \"agent-version\":  \"0.20.1\",\n                              \"block_device\":  \"@{xvda=}\",\n                              \"cloud\":  \"@{metadata=; provider=ec2}\",\n                              \"cpu\":  \"\",\n                              \"filesystem\":  \"@{/dev/xvda1=; devtmpfs=; tmpfs=}\",\n                              \"kernel\":  \"@{machine=x86_64; name=Linux; os=GNU/Linux; release=3.14.48-33.39.amzn1.x86_64; version=#1 SMP Tue Jul 14 23:43:07 UTC 2015}\",\n                              \"memory\":  \"@{active=96488kB; anon_pages=15940kB; bounce=0kB; buffers=15192kB; cached=132992kB; commit_limit=510092kB; committed_as=62384kB; dirty=0kB; free=812880kB; inactive=67644kB; mapped=7452kB; nfs_unstable=0kB; page_tables=1816kB; slab=30512kB; slab_reclaimable=23232kB; slab_unreclaim=7280kB; swap_cached=0kB; swap_free=0kB; swap_total=0kB; total=1020184kB; vmalloc_chunk=34359732811kB; vmalloc_total=34359738367kB; vmalloc_used=2408kB; writeback=0kB}\"\n                          },\n                 \"type\":  \"unknown\",\n                 \"status\":  \"working\",\n                 \"memo\":  \"\",\n                 \"isRetired\":  false,\n                 \"id\":  \"2tkWrBNdu1Q\",\n                 \"createdAt\":  1439969560,\n                 \"roles\":  {\n                               \"Linux\":  \"Management\"\n                           },\n                 \"interfaces\":  [\n                                    \"@{ipAddress=172.31.5.181; ipv6Address=fe80::497:4dff:feac:3601; macAddress=06:97:4d:ac:36:01; name=eth0}\"\n                                ]\n             }\n}\n\n\n\n\u30db\u30b9\u30c8\u60c5\u5831\u306e\u66f4\u65b0\n\n\u4ed5\u69d8\nPUT /api/v0/hosts/<hostId>\n\n\n\n\u30b3\u30de\u30f3\u30c9\n$hostinfo = @\"\n{\n    \"name\":  \"ip-172-31-5-111\",\n    \"meta\":  {\n        \"agent-name\":  \"\",\n        \"agent-revision\":  \"\",\n        \"agent-version\":  \"\",\n        \"block_device\":  \"\",\n        \"cloud\":  \"\",\n        \"cpu\":  \"\",\n        \"filesystem\":  \"\",\n        \"kernel\":  \"\",\n        \"memory\":  \"\"\n    }\n}\n\"@\n\n\n\n$hostid='12345678901'\n\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/hosts/$hostid -Method Put -Headers $headers -Body $hostinfo -ContentType 'application/json' | ConvertTo-Json\n\n\n\n\u7d50\u679c\n{\n    \"id\":  \"12345678901\"\n}\n\n\n\n\u30db\u30b9\u30c8\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u66f4\u65b0\n\n\u4ed5\u69d8\nPOST /api/v0/hosts/<hostId>/status\n\n\n\n\u30b3\u30de\u30f3\u30c9\n$status = @\"\n{\n  \"status\": \"maintenance\"\n}\n\"@\n\n\n\n$hostid='12345678901'\n\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/hosts/$hostid/status -Method Post -Headers $headers -Body $status -ContentType 'application/json' | ConvertTo-Json\n\n\n\n\u7d50\u679c\n{\n    \"success\":  true\n}\n\n\n\n\u30db\u30b9\u30c8\u306e\u9000\u5f79\n\n\u4ed5\u69d8\nPOST /api/v0/hosts/<hostId>/retire\n\n\n\n\u30b3\u30de\u30f3\u30c9\n$hostid='12345678901'\n\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/hosts/$hostid/retire -Method Post -Headers $headers -Body $status -ContentType 'application/json' | ConvertTo-Json\n\n\n\n\u7d50\u679c\n{\n    \"success\":  true\n}\n\n\n\n\n\u30db\u30b9\u30c8\u306e\u4e00\u89a7\n\n\u4ed5\u69d8\nGET /api/v0/hosts.json\n\n\n\n\u30b3\u30de\u30f3\u30c9\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/hosts.json -Method Get -Headers $headers | ConvertTo-Json\n\n\n\n\u7d50\u679c\n{\n    \"hosts\":  [\n                  {\n                      \"name\":  \"ip-172-31-5-181\",\n                      \"nickname\":  null,\n                      \"displayName\":  \"ip-172-31-5-181\",\n                      \"meta\":  \"@{agent-name=mackerel-agent/0.20.1 (Revision e2f8eea); agent-revision=e2f8eea; agent-version=0.20.1; block_device=; cloud=; cpu=System.Object[]; filesystem=; kernel=; memory=}\",\n                      \"type\":  \"unknown\",\n                      \"status\":  \"working\",\n                      \"memo\":  \"\",\n                      \"isRetired\":  false,\n                      \"id\":  \"***********\",\n                      \"createdAt\":  1439969560,\n                      \"roles\":  \"@{Linux=System.Object[]}\",\n                      \"interfaces\":  \"\"\n                  },\n                  {\n                      \"name\":  \"WIN-B4UEJ133OJN\",\n                      \"nickname\":  null,\n                      \"displayName\":  \"WIN-B4UEJ133OJN\",\n                      \"meta\":  \"@{agent-name=mackerel-agent/0.20.1 (Revision e2f8eea); agent-revision=e2f8eea; agent-version=0.20.1; block_device=; cpu=System.Object[]; filesystem=; kernel=; memory=}\",\n                      \"type\":  \"unknown\",\n                      \"status\":  \"working\",\n                      \"memo\":  \"\",\n                      \"isRetired\":  false,\n                      \"id\":  \"***********\",\n                      \"createdAt\":  1439969458,\n                      \"roles\":  \"@{Windows=System.Object[]}\",\n                      \"interfaces\":  \"\"\n                  }\n              ]\n}\n\n\n\n\u30e1\u30c8\u30ea\u30c3\u30af\n\n\u30e1\u30c8\u30ea\u30c3\u30af\u306e\u6295\u7a3f\n\n\u4ed5\u69d8\nPOST /api/v0/tsdb\n\n\n\n\u30b3\u30de\u30f3\u30c9\n$hostid='***********'\n\n$date1 = Get-Date -Date \"01/01/1970\"\n$date2 = Get-Date\n$date = (New-TimeSpan -Start $date1 -End $date2).TotalSeconds\n$epoch_jst = [math]::Truncate($date)\n$epoch_utc = $epoch_jst - 32400\n\n$metric=@\"\n[{\n    \"hostId\": `\"$hostid`\",\n    \"name\": \"custom.foo.bar\",\n    \"time\": $epoch_utc,\n    \"value\": 30\n}]\n\"@\n\n\n\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/tsdb -Method Post -Headers $headers -Body $metric -ContentType 'application/json' | ConvertTo-Json\n\n\n\n\u7d50\u679c\n{\n    \"success\":  true\n}\n\n\n\n\u30e1\u30c8\u30ea\u30c3\u30af\u306e\u6700\u65b0\u5024\u306e\u53d6\u5f97\n\n\u4ed5\u69d8\nGET /api/v0/tsdb/latest\n\n\n\n\u30b3\u30de\u30f3\u30c9\n$hostid='***********'\n$name='custom.foo.bar'\n$url=@\"\nhttps://mackerel.io/api/v0/tsdb/latest?hostId=$hostid&name=$name\n\"@\n\n\n\nInvoke-RestMethod -Uri $url -Method Get -Headers $headers | ConvertTo-Json\n\n\n\n\u7d50\u679c\n{\n    \"tsdbLatest\":  {\n                       \"***********\":  {\n                                           \"custom.foo.bar\":  \"@{time=1440345600; value=30.0}\"\n                                       }\n                   }\n}\n\n\n\n\u30b0\u30e9\u30d5\u5b9a\u7fa9\u306e\u6295\u7a3f\uff08\u672a\u78ba\u8a8d\uff09\n\n\u4ed5\u69d8\nPOST /api/v0/graph-defs/create\n\n\n\n\u30b3\u30de\u30f3\u30c9\n$graphname='custom.foo'\n$graphlabel='foo001'\n\n$metricname='bar'\n$metriclabel='bar002'\n\n$graph=@\"\n[\n  {\n    \"graphs\": {\n      ${graphname}: {\n        \"label\": \"${graphlabel}\",\n        \"unit\": \"integer\",\n        \"metrics\": [\n          {\n            \"name\": \"${metricname}\",\n            \"label\": \"${metriclabel}\",\n            \"stacked\": false\n          }\n        ]\n      }\n    }\n  }\n]\n\"@\n\n\n\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/graph-defs/create -Method Post -Headers $headers -Body $graph -ContentType 'application/json' | ConvertTo-Json\n\n\n\n\u7d50\u679c\n\u672a\u78ba\u8a8d\n\nInvoke-RestMethod : {\"error\":\"Invalid Parameter: obj[0].name error.path.missing.\"}\n\u767a\u751f\u5834\u6240 \u884c:1 \u6587\u5b57:1\n+ Invoke-RestMethod -Uri https://mackerel.io/api/v0/graph-defs/create -Method Post ...\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n    + CategoryInfo          : InvalidOperation: (System.Net.HttpWebRequest:HttpWebRequest) [Invoke-RestMethod]\u3001WebException\n    + FullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeRestMethodCommand\n\n\n\n\u30b5\u30fc\u30d3\u30b9\u30e1\u30c8\u30ea\u30c3\u30af\u306e\u6295\u7a3f\n\n\u4ed5\u69d8\nPOST /api/v0/services/<serviceName>/tsdb\n\n\n\n\u30b3\u30de\u30f3\u30c9\n$metricname='Sample.foo'\n$servicename='Linux'\n\n$date1 = Get-Date -Date \"01/01/1970\"\n$date2 = Get-Date\n$date = (New-TimeSpan -Start $date1 -End $date2).TotalSeconds\n$epoch_jst = [math]::Truncate($date)\n$epoch_utc = $epoch_jst - 32400\n\n$metric=@\"\n[{\n    \"name\": \"Sample.foo\",\n    \"time\": $epoch_utc,\n    \"value\": 30\n}]\n\"@\n\n\n\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/services/${servicename}/tsdb -Method Post -Headers $headers -Body $metric -ContentType 'application/json' | ConvertTo-Json\n\n\n\n\u7d50\u679c\n{\n    \"success\":  true\n}\n\n\n\n\u30c1\u30a7\u30c3\u30af\u76e3\u8996\u7d50\u679c\u306e\u6295\u7a3f\uff08\u672a\u78ba\u8a8d\uff09\n\n\u4ed5\u69d8\nPOST /api/v0/monitoring/checks/report\n\n\n\n\u30b3\u30de\u30f3\u30c9\n$hostid='***********'\n\n$date1 = Get-Date -Date \"01/01/1970\"\n$date2 = Get-Date\n$date = (New-TimeSpan -Start $date1 -End $date2).TotalSeconds\n$epoch_jst = [math]::Truncate($date)\n$epoch_utc = $epoch_jst - 32400\n\n$report=@\"\n{\n  \"reports\": [\n    {\n      \"source\": [\n        {\n          \"type\": \"host\",\n          \"hostId\": \"${hostid}\"\n        }\n      ],\n      \"name\": \"Service Status\",\n      \"status\": \"CRITICAL\",\n      \"message\": \"Service is stopped.\",\n      \"occurredAt\": ${epoch_utc}\n    }\n  ] \n}\n\"@\n\n\n\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/monitoring/checks/report -Method Post -Headers $headers -Body $report -ContentType 'application/json' | ConvertTo-Json\n\n\n\n\u7d50\u679c\n\u672a\u78ba\u8a8d\n\nInvoke-RestMethod : {\"error\":\"Invalid Parameter: obj.reports[0].source error.expected.jsstring.\"}\n\u767a\u751f\u5834\u6240 \u884c:1 \u6587\u5b57:1\n+ Invoke-RestMethod -Uri https://mackerel.io/api/v0/monitoring/checks/report -Meth ...\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n    + CategoryInfo          : InvalidOperation: (System.Net.HttpWebRequest:HttpWebRequest) [Invoke-RestMethod]\u3001WebException\n    + FullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeRestMethodCommand\n\n\n\n\u76e3\u8996\u8a2d\u5b9a\n\n\u76e3\u8996\u8a2d\u5b9a\u306e\u767b\u9332\n\n\u4ed5\u69d8\nPOST /api/v0/monitors\n\n\n\n\u30b3\u30de\u30f3\u30c9\n$monitorsettings = @\"\n{\n    \"type\":  \"host\",\n    \"name\":  \"DISK %\",\n    \"metric\":  \"disk%\",\n    \"operator\":  \">\",\n    \"warning\":  70.0,\n    \"critical\":  90.0,\n    \"duration\":  3\n}\n\"@\n\n\n\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/monitors -Method Post -Headers $headers -Body $monitorsettings -ContentType 'application/json' | ConvertTo-Json\n\n\n\n\n\u7d50\u679c\n{\n    \"id\":  \"***********\",\n    \"type\":  \"host\",\n    \"name\":  \"DISK%\",\n    \"metric\":  \"disk%\",\n    \"operator\":  \"\\u003e\",\n    \"warning\":  70.0,\n    \"critical\":  90.0,\n    \"duration\":  3,\n    \"scopes\":  [\n\n               ],\n    \"excludeScopes\":  [\n\n                      ]\n}\n\n\n\n\u76e3\u8996\u8a2d\u5b9a\u306e\u53d6\u5f97\n\n\u4ed5\u69d8\nGET /api/v0/monitors\n\n\n\n\u30b3\u30de\u30f3\u30c9\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/monitors -Method Get -Headers $headers | ConvertTo-Json\n\n\n\n\u7d50\u679c\n{\n    \"monitors\":  [\n                     {\n                         \"id\":  \"***********\",\n                         \"type\":  \"connectivity\",\n                         \"scopes\":  \"\",\n                         \"excludeScopes\":  \"\"\n                     },\n                     {\n                         \"id\":  \"***********\",\n                         \"type\":  \"host\",\n                         \"name\":  \"CPU %\",\n                         \"metric\":  \"cpu%\",\n                         \"operator\":  \"\\u003e\",\n                         \"warning\":  70.0,\n                         \"critical\":  90.0,\n                         \"duration\":  3,\n                         \"scopes\":  \"\",\n                         \"excludeScopes\":  \"\"\n                     }\n                 ]\n}\n\n\n\n\u76e3\u8996\u8a2d\u5b9a\u306e\u66f4\u65b0\n\n\u4ed5\u69d8\nPUT /api/v0/monitors/<monitorId>\n\n\n\n\u30b3\u30de\u30f3\u30c9\n\n$monitorsettings = @\"\n{\n    \"type\":  \"host\",\n    \"name\":  \"DISK %\",\n    \"metric\":  \"disk%\",\n    \"operator\":  \">\",\n    \"warning\":  70.0,\n    \"critical\":  80.0,\n    \"duration\":  3\n}\n\"@\n\n\n\n$monitorid='***********'\n\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/monitors/$monitorid -Method Put -Headers $headers -Body $monitorsettings -ContentType 'application/json' | ConvertTo-Json\n\n\n\n\u7d50\u679c\n{\n    \"id\":  \"***********\"\n}\n\n\n\n\u76e3\u8996\u8a2d\u5b9a\u306e\u524a\u9664\n\n\u4ed5\u69d8\nDELETE/api/v0/monitors/<monitorId>\n\n\n\n\u30b3\u30de\u30f3\u30c9\n$monitorid = '***********'\n\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/monitors/$monitorid -Method Delete -Headers $headers -ContentType 'application/json' | ConvertTo-Json\n\n\n\n\u7d50\u679c\n{\n    \"id\":  \"***********\",\n    \"type\":  \"host\",\n    \"name\":  \"DISK %\",\n    \"metric\":  \"disk%\",\n    \"operator\":  \"\\u003e\",\n    \"warning\":  70.0,\n    \"critical\":  90.0,\n    \"duration\":  3,\n    \"scopes\":  [\n\n               ],\n    \"excludeScopes\":  [\n\n                      ]\n}\n\n\n\u4e00\u901a\u308a\u53e9\u3044\u3066\u307f\u307e\u3057\u305f\u3002\n\u4e00\u89a7\u306f\u3053\u3061\u3089\u3067\u3059\u3002\n[API\u4ed5\u69d8\uff08v0\uff09](http://help-ja.mackerel.io/entry/spec/api/v0)\n\n\u4e00\u90e8\u3001\u4f7f\u3044\u65b9\u304c\u3088\u304f\u308f\u304b\u3089\u305a\u78ba\u8a8d\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n\n# \u6e96\u5099\n## \u30d8\u30c3\u30c0\u30fc\u3092\u5909\u6570\u306b\u683c\u7d0d\nX-Api-Key\u306e\u307f\u5fc5\u9808\n\n```ps1:\u30b3\u30de\u30f3\u30c9\n$headers = New-Object \"System.Collections.Generic.Dictionary[[String],[String]]\"\n$headers.Add(\"X-API-KEY\", '12345678901234567890123456789012345678901234')\n```\n\n\n# \u30db\u30b9\u30c8\n## \u30db\u30b9\u30c8\u60c5\u5831\u306e\u767b\u9332\n\n```text:\u4ed5\u69d8\nPOST /api/v0/hosts\n```\n\n```ps1:\u30b3\u30de\u30f3\u30c9\n$hostinfo = @\"\n{\n    \"name\":  \"ip-172-31-5-222\",\n    \"meta\":  {\n        \"agent-name\":  \"\",\n        \"agent-revision\":  \"\",\n        \"agent-version\":  \"\",\n        \"block_device\":  \"\",\n        \"cloud\":  \"\",\n        \"cpu\":  \"\",\n        \"filesystem\":  \"\",\n        \"kernel\":  \"\",\n        \"memory\":  \"\"\n    }\n}\n\"@\n\n\n\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/hosts -Method Post -Headers $headers -Body $hostinfo -ContentType 'application/json' | ConvertTo-Json\n```\n\n```json:\u7d50\u679c\n{\n    \"id\":  \"12345678901\"\n}\n```\n\n## \u30db\u30b9\u30c8\u60c5\u5831\u306e\u53d6\u5f97\n```text:\u4ed5\u69d8\nGET /api/v0/hosts/<hostId>\n```\n\n```ps1:\u30b3\u30de\u30f3\u30c9\n$hostid='***********'\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/hosts/$hostid -Method Get -Headers $headers | ConvertTo-Json\n```\n\n```json:\u7d50\u679c\n{\n    \"host\":  {\n                 \"name\":  \"ip-172-31-5-181\",\n                 \"nickname\":  null,\n                 \"displayName\":  \"ip-172-31-5-181\",\n                 \"meta\":  {\n                              \"agent-name\":  \"mackerel-agent/0.20.1 (Revision e2f8eea)\",\n                              \"agent-revision\":  \"e2f8eea\",\n                              \"agent-version\":  \"0.20.1\",\n                              \"block_device\":  \"@{xvda=}\",\n                              \"cloud\":  \"@{metadata=; provider=ec2}\",\n                              \"cpu\":  \"\",\n                              \"filesystem\":  \"@{/dev/xvda1=; devtmpfs=; tmpfs=}\",\n                              \"kernel\":  \"@{machine=x86_64; name=Linux; os=GNU/Linux; release=3.14.48-33.39.amzn1.x86_64; version=#1 SMP Tue Jul 14 23:43:07 UTC 2015}\",\n                              \"memory\":  \"@{active=96488kB; anon_pages=15940kB; bounce=0kB; buffers=15192kB; cached=132992kB; commit_limit=510092kB; committed_as=62384kB; dirty=0kB; free=812880kB; inactive=67644kB; mapped=7452kB; nfs_unstable=0kB; page_tables=1816kB; slab=30512kB; slab_reclaimable=23232kB; slab_unreclaim=7280kB; swap_cached=0kB; swap_free=0kB; swap_total=0kB; total=1020184kB; vmalloc_chunk=34359732811kB; vmalloc_total=34359738367kB; vmalloc_used=2408kB; writeback=0kB}\"\n                          },\n                 \"type\":  \"unknown\",\n                 \"status\":  \"working\",\n                 \"memo\":  \"\",\n                 \"isRetired\":  false,\n                 \"id\":  \"2tkWrBNdu1Q\",\n                 \"createdAt\":  1439969560,\n                 \"roles\":  {\n                               \"Linux\":  \"Management\"\n                           },\n                 \"interfaces\":  [\n                                    \"@{ipAddress=172.31.5.181; ipv6Address=fe80::497:4dff:feac:3601; macAddress=06:97:4d:ac:36:01; name=eth0}\"\n                                ]\n             }\n}\n```\n\n## \u30db\u30b9\u30c8\u60c5\u5831\u306e\u66f4\u65b0\n```text:\u4ed5\u69d8\nPUT /api/v0/hosts/<hostId>\n```\n\n```ps1:\u30b3\u30de\u30f3\u30c9\n$hostinfo = @\"\n{\n    \"name\":  \"ip-172-31-5-111\",\n    \"meta\":  {\n        \"agent-name\":  \"\",\n        \"agent-revision\":  \"\",\n        \"agent-version\":  \"\",\n        \"block_device\":  \"\",\n        \"cloud\":  \"\",\n        \"cpu\":  \"\",\n        \"filesystem\":  \"\",\n        \"kernel\":  \"\",\n        \"memory\":  \"\"\n    }\n}\n\"@\n\n\n\n$hostid='12345678901'\n\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/hosts/$hostid -Method Put -Headers $headers -Body $hostinfo -ContentType 'application/json' | ConvertTo-Json\n```\n\n```json:\u7d50\u679c\n{\n    \"id\":  \"12345678901\"\n}\n```\n\n## \u30db\u30b9\u30c8\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u66f4\u65b0\n```text:\u4ed5\u69d8\nPOST /api/v0/hosts/<hostId>/status\n```\n\n```ps1:\u30b3\u30de\u30f3\u30c9\n$status = @\"\n{\n  \"status\": \"maintenance\"\n}\n\"@\n\n\n\n$hostid='12345678901'\n\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/hosts/$hostid/status -Method Post -Headers $headers -Body $status -ContentType 'application/json' | ConvertTo-Json\n```\n\n```json:\u7d50\u679c\n{\n    \"success\":  true\n}\n```\n\n## \u30db\u30b9\u30c8\u306e\u9000\u5f79\n```text:\u4ed5\u69d8\nPOST /api/v0/hosts/<hostId>/retire\n```\n\n```ps1:\u30b3\u30de\u30f3\u30c9\n$hostid='12345678901'\n\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/hosts/$hostid/retire -Method Post -Headers $headers -Body $status -ContentType 'application/json' | ConvertTo-Json\n```\n\n```json:\u7d50\u679c\n{\n    \"success\":  true\n}\n\n```\n\n## \u30db\u30b9\u30c8\u306e\u4e00\u89a7\n```text:\u4ed5\u69d8\nGET /api/v0/hosts.json\n```\n\n```ps1:\u30b3\u30de\u30f3\u30c9\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/hosts.json -Method Get -Headers $headers | ConvertTo-Json\n```\n\n```json:\u7d50\u679c\n{\n    \"hosts\":  [\n                  {\n                      \"name\":  \"ip-172-31-5-181\",\n                      \"nickname\":  null,\n                      \"displayName\":  \"ip-172-31-5-181\",\n                      \"meta\":  \"@{agent-name=mackerel-agent/0.20.1 (Revision e2f8eea); agent-revision=e2f8eea; agent-version=0.20.1; block_device=; cloud=; cpu=System.Object[]; filesystem=; kernel=; memory=}\",\n                      \"type\":  \"unknown\",\n                      \"status\":  \"working\",\n                      \"memo\":  \"\",\n                      \"isRetired\":  false,\n                      \"id\":  \"***********\",\n                      \"createdAt\":  1439969560,\n                      \"roles\":  \"@{Linux=System.Object[]}\",\n                      \"interfaces\":  \"\"\n                  },\n                  {\n                      \"name\":  \"WIN-B4UEJ133OJN\",\n                      \"nickname\":  null,\n                      \"displayName\":  \"WIN-B4UEJ133OJN\",\n                      \"meta\":  \"@{agent-name=mackerel-agent/0.20.1 (Revision e2f8eea); agent-revision=e2f8eea; agent-version=0.20.1; block_device=; cpu=System.Object[]; filesystem=; kernel=; memory=}\",\n                      \"type\":  \"unknown\",\n                      \"status\":  \"working\",\n                      \"memo\":  \"\",\n                      \"isRetired\":  false,\n                      \"id\":  \"***********\",\n                      \"createdAt\":  1439969458,\n                      \"roles\":  \"@{Windows=System.Object[]}\",\n                      \"interfaces\":  \"\"\n                  }\n              ]\n}\n```\n\n\n# \u30e1\u30c8\u30ea\u30c3\u30af\n## \u30e1\u30c8\u30ea\u30c3\u30af\u306e\u6295\u7a3f\n```text:\u4ed5\u69d8\nPOST /api/v0/tsdb\n```\n\n```ps1:\u30b3\u30de\u30f3\u30c9\n$hostid='***********'\n\n$date1 = Get-Date -Date \"01/01/1970\"\n$date2 = Get-Date\n$date = (New-TimeSpan -Start $date1 -End $date2).TotalSeconds\n$epoch_jst = [math]::Truncate($date)\n$epoch_utc = $epoch_jst - 32400\n\n$metric=@\"\n[{\n    \"hostId\": `\"$hostid`\",\n    \"name\": \"custom.foo.bar\",\n    \"time\": $epoch_utc,\n    \"value\": 30\n}]\n\"@\n\n\n\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/tsdb -Method Post -Headers $headers -Body $metric -ContentType 'application/json' | ConvertTo-Json\n```\n\n```text:\u7d50\u679c\n{\n    \"success\":  true\n}\n```\n\n## \u30e1\u30c8\u30ea\u30c3\u30af\u306e\u6700\u65b0\u5024\u306e\u53d6\u5f97\n```text:\u4ed5\u69d8\nGET /api/v0/tsdb/latest\n```\n\n```ps1:\u30b3\u30de\u30f3\u30c9\n$hostid='***********'\n$name='custom.foo.bar'\n$url=@\"\nhttps://mackerel.io/api/v0/tsdb/latest?hostId=$hostid&name=$name\n\"@\n\n\n\nInvoke-RestMethod -Uri $url -Method Get -Headers $headers | ConvertTo-Json\n```\n\n```text:\u7d50\u679c\n{\n    \"tsdbLatest\":  {\n                       \"***********\":  {\n                                           \"custom.foo.bar\":  \"@{time=1440345600; value=30.0}\"\n                                       }\n                   }\n}\n```\n\n## \u30b0\u30e9\u30d5\u5b9a\u7fa9\u306e\u6295\u7a3f\uff08\u672a\u78ba\u8a8d\uff09\n```text:\u4ed5\u69d8\nPOST /api/v0/graph-defs/create\n```\n\n```ps1:\u30b3\u30de\u30f3\u30c9\n$graphname='custom.foo'\n$graphlabel='foo001'\n\n$metricname='bar'\n$metriclabel='bar002'\n\n$graph=@\"\n[\n  {\n    \"graphs\": {\n      ${graphname}: {\n        \"label\": \"${graphlabel}\",\n        \"unit\": \"integer\",\n        \"metrics\": [\n          {\n            \"name\": \"${metricname}\",\n            \"label\": \"${metriclabel}\",\n            \"stacked\": false\n          }\n        ]\n      }\n    }\n  }\n]\n\"@\n\n\n\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/graph-defs/create -Method Post -Headers $headers -Body $graph -ContentType 'application/json' | ConvertTo-Json\n```\n\n```text:\u7d50\u679c\n\u672a\u78ba\u8a8d\n\nInvoke-RestMethod : {\"error\":\"Invalid Parameter: obj[0].name error.path.missing.\"}\n\u767a\u751f\u5834\u6240 \u884c:1 \u6587\u5b57:1\n+ Invoke-RestMethod -Uri https://mackerel.io/api/v0/graph-defs/create -Method Post ...\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n    + CategoryInfo          : InvalidOperation: (System.Net.HttpWebRequest:HttpWebRequest) [Invoke-RestMethod]\u3001WebException\n    + FullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeRestMethodCommand\n```\n\n## \u30b5\u30fc\u30d3\u30b9\u30e1\u30c8\u30ea\u30c3\u30af\u306e\u6295\u7a3f\n```text:\u4ed5\u69d8\nPOST /api/v0/services/<serviceName>/tsdb\n```\n\n```ps1:\u30b3\u30de\u30f3\u30c9\n$metricname='Sample.foo'\n$servicename='Linux'\n\n$date1 = Get-Date -Date \"01/01/1970\"\n$date2 = Get-Date\n$date = (New-TimeSpan -Start $date1 -End $date2).TotalSeconds\n$epoch_jst = [math]::Truncate($date)\n$epoch_utc = $epoch_jst - 32400\n\n$metric=@\"\n[{\n    \"name\": \"Sample.foo\",\n    \"time\": $epoch_utc,\n    \"value\": 30\n}]\n\"@\n\n\n\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/services/${servicename}/tsdb -Method Post -Headers $headers -Body $metric -ContentType 'application/json' | ConvertTo-Json\n```\n\n```text:\u7d50\u679c\n{\n    \"success\":  true\n}\n```\n\n## \u30c1\u30a7\u30c3\u30af\u76e3\u8996\u7d50\u679c\u306e\u6295\u7a3f\uff08\u672a\u78ba\u8a8d\uff09\n```text:\u4ed5\u69d8\nPOST /api/v0/monitoring/checks/report\n```\n\n```ps1:\u30b3\u30de\u30f3\u30c9\n$hostid='***********'\n\n$date1 = Get-Date -Date \"01/01/1970\"\n$date2 = Get-Date\n$date = (New-TimeSpan -Start $date1 -End $date2).TotalSeconds\n$epoch_jst = [math]::Truncate($date)\n$epoch_utc = $epoch_jst - 32400\n\n$report=@\"\n{\n  \"reports\": [\n    {\n      \"source\": [\n        {\n          \"type\": \"host\",\n          \"hostId\": \"${hostid}\"\n        }\n      ],\n      \"name\": \"Service Status\",\n      \"status\": \"CRITICAL\",\n      \"message\": \"Service is stopped.\",\n      \"occurredAt\": ${epoch_utc}\n    }\n  ] \n}\n\"@\n\n\n\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/monitoring/checks/report -Method Post -Headers $headers -Body $report -ContentType 'application/json' | ConvertTo-Json\n```\n\n```text:\u7d50\u679c\n\u672a\u78ba\u8a8d\n\nInvoke-RestMethod : {\"error\":\"Invalid Parameter: obj.reports[0].source error.expected.jsstring.\"}\n\u767a\u751f\u5834\u6240 \u884c:1 \u6587\u5b57:1\n+ Invoke-RestMethod -Uri https://mackerel.io/api/v0/monitoring/checks/report -Meth ...\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n    + CategoryInfo          : InvalidOperation: (System.Net.HttpWebRequest:HttpWebRequest) [Invoke-RestMethod]\u3001WebException\n    + FullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeRestMethodCommand\n```\n\n\n# \u76e3\u8996\u8a2d\u5b9a\n## \u76e3\u8996\u8a2d\u5b9a\u306e\u767b\u9332\n```text:\u4ed5\u69d8\nPOST /api/v0/monitors\n```\n\n```ps1:\u30b3\u30de\u30f3\u30c9\n$monitorsettings = @\"\n{\n    \"type\":  \"host\",\n    \"name\":  \"DISK %\",\n    \"metric\":  \"disk%\",\n    \"operator\":  \">\",\n    \"warning\":  70.0,\n    \"critical\":  90.0,\n    \"duration\":  3\n}\n\"@\n\n\n\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/monitors -Method Post -Headers $headers -Body $monitorsettings -ContentType 'application/json' | ConvertTo-Json\n\n```\n\n```json:\u7d50\u679c\n{\n    \"id\":  \"***********\",\n    \"type\":  \"host\",\n    \"name\":  \"DISK%\",\n    \"metric\":  \"disk%\",\n    \"operator\":  \"\\u003e\",\n    \"warning\":  70.0,\n    \"critical\":  90.0,\n    \"duration\":  3,\n    \"scopes\":  [\n\n               ],\n    \"excludeScopes\":  [\n\n                      ]\n}\n```\n\n## \u76e3\u8996\u8a2d\u5b9a\u306e\u53d6\u5f97\n```text:\u4ed5\u69d8\nGET /api/v0/monitors\n```\n\n```ps1:\u30b3\u30de\u30f3\u30c9\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/monitors -Method Get -Headers $headers | ConvertTo-Json\n```\n\n```json:\u7d50\u679c\n{\n    \"monitors\":  [\n                     {\n                         \"id\":  \"***********\",\n                         \"type\":  \"connectivity\",\n                         \"scopes\":  \"\",\n                         \"excludeScopes\":  \"\"\n                     },\n                     {\n                         \"id\":  \"***********\",\n                         \"type\":  \"host\",\n                         \"name\":  \"CPU %\",\n                         \"metric\":  \"cpu%\",\n                         \"operator\":  \"\\u003e\",\n                         \"warning\":  70.0,\n                         \"critical\":  90.0,\n                         \"duration\":  3,\n                         \"scopes\":  \"\",\n                         \"excludeScopes\":  \"\"\n                     }\n                 ]\n}\n```\n\n## \u76e3\u8996\u8a2d\u5b9a\u306e\u66f4\u65b0\n```text:\u4ed5\u69d8\nPUT /api/v0/monitors/<monitorId>\n```\n\n```ps1:\u30b3\u30de\u30f3\u30c9\n\n$monitorsettings = @\"\n{\n    \"type\":  \"host\",\n    \"name\":  \"DISK %\",\n    \"metric\":  \"disk%\",\n    \"operator\":  \">\",\n    \"warning\":  70.0,\n    \"critical\":  80.0,\n    \"duration\":  3\n}\n\"@\n\n\n\n$monitorid='***********'\n\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/monitors/$monitorid -Method Put -Headers $headers -Body $monitorsettings -ContentType 'application/json' | ConvertTo-Json\n```\n\n```json:\u7d50\u679c\n{\n    \"id\":  \"***********\"\n}\n```\n\n## \u76e3\u8996\u8a2d\u5b9a\u306e\u524a\u9664\n```text:\u4ed5\u69d8\nDELETE/api/v0/monitors/<monitorId>\n```\n\n```ps1:\u30b3\u30de\u30f3\u30c9\n$monitorid = '***********'\n\nInvoke-RestMethod -Uri https://mackerel.io/api/v0/monitors/$monitorid -Method Delete -Headers $headers -ContentType 'application/json' | ConvertTo-Json\n```\n\n```json:\u7d50\u679c\n{\n    \"id\":  \"***********\",\n    \"type\":  \"host\",\n    \"name\":  \"DISK %\",\n    \"metric\":  \"disk%\",\n    \"operator\":  \"\\u003e\",\n    \"warning\":  70.0,\n    \"critical\":  90.0,\n    \"duration\":  3,\n    \"scopes\":  [\n\n               ],\n    \"excludeScopes\":  [\n\n                      ]\n}\n```\n"}