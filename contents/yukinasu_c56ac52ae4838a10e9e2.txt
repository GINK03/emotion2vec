{"context": " More than 1 year has passed since last update.\u3053\u3093\u306b\u3061\u306f\u3001yukinasu\u3067\u3059\u3002\n\u4eca\u56de\u306f\u3001Google Compute Engine(\u4ee5\u964d\u3001GCE\u3068\u8a18\u8ff0)\u306eImage\u3092Google Cloud Storage(\u4ee5\u964d\u3001GCS\u3068\u8a18\u8ff0)\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u65b9\u6cd5\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\u3053\u306e\u65b9\u6cd5\u3092\u5229\u7528\u3059\u308b\u3068\n* \u81ea\u5206\u304c\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u305fImage\u3092\u5171\u6709\u3059\u308b\n* \u8907\u6570\u306e\u30b5\u30fc\u30d0\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3068\u304d\u306eBase\u3068\u306a\u308bCustomImage\u3092\u4f5c\u6210\u3059\u308b\n\u3053\u3068\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u3053\u306e\u8a18\u4e8b\u306fGCE\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306eExport an image to Google Cloud Storage\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n1. temporary disk (\u4e00\u6642\u4fdd\u5b58\u7528disk)\u3092\u4f5c\u6210\n\u3053\u306edisk\u306froot persistent disk (\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5bfe\u8c61\u306edisk)\u3092tar\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u56fa\u3081\u308b\u969b\u306e\u3001\u30d5\u30a1\u30a4\u30eb\u4fdd\u5b58\u9818\u57df\u3068\u3057\u3066\u4f7f\u7528\u3055\u308c\u308b\u4e00\u6642\u4fdd\u5b58\u7528\u306edisk\u3068\u306a\u308a\u307e\u3059\u3002\n\u6ce8\u610f\u3057\u306a\u304f\u3066\u306f\u3044\u3051\u306a\u3044\u3053\u3068\u306f\u3001\u3053\u306edisk\u306e\u5185\u5bb9\u304ctar\u306b\u4fdd\u5b58\u3055\u308c\u308b\u8a33\u3067\u306f\u306a\u3044\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002\n$ gcloud compute disks create TEMPORARY_DISK_NAME \\\n    --project PROJECT_NAME \\\n    --zone ZONE_NAME \\\n\n\n2. Instance\u306b\u4e00\u6642\u4fdd\u5b58\u7528disk\u3092\u9069\u7528\n1.\u3067\u4f5c\u6210\u3057\u305ftemporary disk\u3092Instance\u306b\u9069\u7528\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u306f\u6b21\u306e\uff12\u901a\u308a\u306e\u65b9\u6cd5\u304c\u6709\u308a\u307e\u3059\u3002\n\n2.1 \u65b0\u898f\u306bInstance\u3092\u4f5c\u6210\u3059\u308b\u5834\u5408\nroot persistent disk\u306eInstance\u304c\u307e\u3060\u4f5c\u6210\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u3001gcloud compute instances create\u30b3\u30de\u30f3\u30c9\u3092\u7528\u3044\u3066\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\u3068\u540c\u6642\u306btemporary disk\u306e\u9069\u7528\u3092\u884c\u3044\u307e\u3059\u3002\n$ gcloud compute instances create INSTANCE_NAME \\\n    --project PROJECT_NAME \\\n    --zone ZONE_NAME \\\n    --image IMAGE_NAME \\\n    --disk \\\n      name=TEMPORARY_DISK_NAME \\\n      device-name=TEMPORARY_DISK_NAME \\\n    --scopes storage-rw\n\nGCS\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u306e\u3067\u3001--scopes storage-rw\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u30b9\u30c8\u30ec\u30fc\u30b8\u3078\u306e\u8aad\u307f\u8fbc\u307f\u30fb\u66f8\u304d\u8fbc\u307f\u306e\u6a29\u9650\u3092\u4ed8\u52a0\u3057\u307e\u3059\u3002\n\n2.2 \u65e2\u5b58\u306eInstance\u306b\u9069\u7528\u3059\u308b\u5834\u5408\n\u65e2\u306b\u7a3c\u50cd\u3057\u3066\u3044\u308bInstance\u306b\u5bfe\u3057\u3066disk\u3092\u9069\u7528\u3059\u308b\u5834\u5408\u306f\u3001gcloud compute instances attach-disk\u30b3\u30de\u30f3\u30c9\u3092\u7528\u3044\u3066temporary disk\u3092\u9069\u7528\u3057\u307e\u3059\u3002\n$ gcloud compute instances attach-disk INSTANCE_NAME \\\n    --project PROJECT_NAME \\\n    --zone ZONE_NAME \\\n    --disk TEMPORARY_DISK_NAME \\\n    --device-name TEMPORARY_DISK_NAME \\\n\n\u65e2\u5b58\u306eInstance\u306b\u9069\u7528\u3059\u308b\u5834\u5408\u306f\u3001Storage\u306b\u5bfe\u3059\u308b\u66f8\u304d\u8fbc\u307f\u6a29\u9650\u304c\u306a\u3044\u3068GCS\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u306a\u3044\u306e\u3067\u3001\u4e88\u3081\u6a29\u9650\u304c\u5b58\u5728\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n3. \u8d77\u52d5\u3057\u305fInstance\u306bSSH\u3067\u63a5\u7d9a\nssh\u3067\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u306b\u95a2\u3057\u3066\u306fGCE\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306eConnecting to an instance using ssh\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n$ gcloud compute ssh INSTANCE_NAME \\\n    --project PROJECT_NAME \\\n    --zone ZONE_NAME\n\n\n4. \u3069\u3053\u306b\u30c7\u30a3\u30b9\u30af\u306e\u30c7\u30fc\u30bf\u304c\u5b58\u5728\u3059\u308b\u304b\u3092\u78ba\u8a8d\nInstance\u306bAttach\u3055\u308c\u305fdisk\u306f/dev/disk/by-id/\u914d\u4e0b\u306bgoogle-\u306e\u63a5\u982d\u8a9e\uff0bdisk\u540d\u306e\u5f62\u3067\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\nme@instance:~$ ls -l /dev/disk/by-id/google-*\nlrwxrwxrwx 1 root root  9 Jul 29 17:56 /dev/disk/by-id/google-persistent-disk-0 -> ../../sda\nlrwxrwxrwx 1 root root 10 Jul 29 17:56 /dev/disk/by-id/google-persistent-disk-0-part1 -> ../../sda1\nlrwxrwxrwx 1 root root  9 Aug 25 18:16 /dev/disk/by-id/google-temporary-disk -> ../../sdb\n\n\u3053\u306e\u5834\u5408\u306f\u3001google-persistent-disk-0\u304croot persistent disk\u3001google-temporary-disk\u304ctemporary disk\u3067\u3059\u3002\n\n5. temporary disk\u3092\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3057\u30de\u30a6\u30f3\u30c8\nsafe_format_and_mount\u3092\u7528\u3044\u3066temporary disk\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3068\u30de\u30a6\u30f3\u30c8\u3092\u884c\u3044\u307e\u3059\u3002\nme@instance:~$ sudo mkdir /mnt/tmp\nme@instance:~$ sudo /usr/share/google/safe_format_and_mount -m \"mkfs.ext4 -F\" /dev/sdb /mnt/tmp\n\n4.\u3067\u78ba\u8a8d\u6642\u306btemporary disk\u306f/dev/sdb\u306b\u5b58\u5728\u3059\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u5bfe\u8c61\u306b\u306f/dev/sdb\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\nsafe_format_and_mount\u306fcompute-image-packages\u306b\u542b\u307e\u308c\u3066\u3044\u308b\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3067GCE\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u7528\u610f\u3055\u308c\u3066\u3044\u308bImage\u306b\u306f\u4e88\u3081\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3082\u3057\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306b\u306fwget\u306a\u3069\u3092\u7528\u3044\u3066compute-image-packages\u306ereleases\u304b\u3089\u6700\u65b0\u306etar.gz\u30d5\u30a1\u30a4\u30eb\u3092\u53d6\u5f97\u3059\u308c\u3070\u3001\u5229\u7528\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n6. \u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u305froot persistent disk\u3092tar\u30d5\u30a1\u30a4\u30eb\u5316\n\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u305froot persistent disk\u3092image\u5316\u3057tar\u30d5\u30a1\u30a4\u30eb\u306b\u56fa\u3081\u307e\u3059\u3002\n\u3053\u306e\u51e6\u7406\u3092\u5b9f\u884c\u3059\u308b\u307e\u3067\u306bImage\u306b\u542b\u3081\u305f\u3044\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3084\u30d5\u30a1\u30a4\u30eb\u306e\u914d\u7f6e\u3092\u7d42\u308f\u3089\u305b\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\nroot persistent disk\u3092tar\u30d5\u30a1\u30a4\u30eb\u306b\u56fa\u3081\u308b\u306b\u306fgcimagebundle\u3092\u7528\u3044\u307e\u3059\u3002\ngcimagebundle\u3082safe_format_and_mount\u3068\u540c\u3058\u304f\u3001compute-image-packages\u306b\u542b\u307e\u308c\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u306e\u3067\u3001\u57fa\u672c\u7684\u306b\u4e88\u3081\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nme@instance:~$ sudo gcimagebundle -d /dev/sda -o /mnt/tmp/ --log_file=/tmp/abc.log\n\n\u4e0a\u8a18\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u6b21\u306e\u5834\u6240\u306bImage\u306etar\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n/mnt/tmp/HEX-NUMBER.image.tar.gz\n\n\n7. GCS\u3078Image\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\nInstance\u306b\u30d7\u30ea\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308bgsutil\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30c4\u30fc\u30eb\u3092\u7528\u3044\u3066GCS\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n7.1 Bucket\u3092\u4f5c\u6210\n\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3092\u7528\u3044\u3066\u3001Bucket\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nBucket\u306e\u547d\u540d\u306b\u95a2\u3057\u3066\u306fBucket and Object Naming Guidelines\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nme@instance:~$ gsutil mb gs://BUCKET_NAME\n\n\n7.2 Bucket\u306bImage\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3092\u7528\u3044\u3066\u30017.1\u3067\u4f5c\u6210\u3057\u305fBucket\u306bImage\u306etar\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\nme@instance:~$ gsutil cp /mnt/tmp/IMAGE_NAME.image.tar.gz gs://BUCKET_NAME\n\n\n\u304a\u308f\u308a\u306b\n\u4ee5\u4e0a\u3067\u3001GCE\u304b\u3089GCS\u306bImage\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u4e00\u89a7\u306e\u6d41\u308c\u306f\u7d42\u4e86\u3067\u3059\u3002\n\u3053\u308c\u3092\u5fdc\u7528\u3059\u308c\u3070\u3001disk\u304b\u3089\u3060\u3051\u3067\u306a\u304f\u3001Snapshot\u304b\u3089Instance\u3092\u4f5c\u6210\u3057\u3001Image\u5316\u3057\u3066GCS\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3082\u53ef\u80fd\u3067\u3059\u3002\n\n\u3053\u3093\u306b\u3061\u306f\u3001[yukinasu](https://twitter.com/yukinasu715)\u3067\u3059\u3002\n\u4eca\u56de\u306f\u3001Google Compute Engine(\u4ee5\u964d\u3001GCE\u3068\u8a18\u8ff0)\u306eImage\u3092Google Cloud Storage(\u4ee5\u964d\u3001GCS\u3068\u8a18\u8ff0)\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u65b9\u6cd5\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n\u3053\u306e\u65b9\u6cd5\u3092\u5229\u7528\u3059\u308b\u3068\n* \u81ea\u5206\u304c\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u305fImage\u3092\u5171\u6709\u3059\u308b\n* \u8907\u6570\u306e\u30b5\u30fc\u30d0\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3068\u304d\u306eBase\u3068\u306a\u308bCustomImage\u3092\u4f5c\u6210\u3059\u308b\n\u3053\u3068\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u3053\u306e\u8a18\u4e8b\u306fGCE\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e[Export an image to Google Cloud Storage](https://cloud.google.com/compute/docs/images#export_an_image_to_google_cloud_storage)\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n## 1. temporary disk (\u4e00\u6642\u4fdd\u5b58\u7528disk)\u3092\u4f5c\u6210\n\u3053\u306edisk\u306froot persistent disk (\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5bfe\u8c61\u306edisk)\u3092tar\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u56fa\u3081\u308b\u969b\u306e\u3001\u30d5\u30a1\u30a4\u30eb\u4fdd\u5b58\u9818\u57df\u3068\u3057\u3066\u4f7f\u7528\u3055\u308c\u308b\u4e00\u6642\u4fdd\u5b58\u7528\u306edisk\u3068\u306a\u308a\u307e\u3059\u3002\n\u6ce8\u610f\u3057\u306a\u304f\u3066\u306f\u3044\u3051\u306a\u3044\u3053\u3068\u306f\u3001\u3053\u306edisk\u306e\u5185\u5bb9\u304ctar\u306b\u4fdd\u5b58\u3055\u308c\u308b\u8a33\u3067\u306f\u306a\u3044\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002\n\n```bash\n$ gcloud compute disks create TEMPORARY_DISK_NAME \\\n    --project PROJECT_NAME \\\n    --zone ZONE_NAME \\\n```\n\n## 2. Instance\u306b\u4e00\u6642\u4fdd\u5b58\u7528disk\u3092\u9069\u7528\n1.\u3067\u4f5c\u6210\u3057\u305ftemporary disk\u3092Instance\u306b\u9069\u7528\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u306f\u6b21\u306e\uff12\u901a\u308a\u306e\u65b9\u6cd5\u304c\u6709\u308a\u307e\u3059\u3002\n\n### 2.1 \u65b0\u898f\u306bInstance\u3092\u4f5c\u6210\u3059\u308b\u5834\u5408\nroot persistent disk\u306eInstance\u304c\u307e\u3060\u4f5c\u6210\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u3001`gcloud compute instances create`\u30b3\u30de\u30f3\u30c9\u3092\u7528\u3044\u3066\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\u3068\u540c\u6642\u306btemporary disk\u306e\u9069\u7528\u3092\u884c\u3044\u307e\u3059\u3002\n\n```bash\n$ gcloud compute instances create INSTANCE_NAME \\\n    --project PROJECT_NAME \\\n    --zone ZONE_NAME \\\n    --image IMAGE_NAME \\\n    --disk \\\n      name=TEMPORARY_DISK_NAME \\\n      device-name=TEMPORARY_DISK_NAME \\\n    --scopes storage-rw\n```\n\nGCS\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u306e\u3067\u3001`--scopes storage-rw`\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u30b9\u30c8\u30ec\u30fc\u30b8\u3078\u306e\u8aad\u307f\u8fbc\u307f\u30fb\u66f8\u304d\u8fbc\u307f\u306e\u6a29\u9650\u3092\u4ed8\u52a0\u3057\u307e\u3059\u3002\n\n### 2.2 \u65e2\u5b58\u306eInstance\u306b\u9069\u7528\u3059\u308b\u5834\u5408\n\u65e2\u306b\u7a3c\u50cd\u3057\u3066\u3044\u308bInstance\u306b\u5bfe\u3057\u3066disk\u3092\u9069\u7528\u3059\u308b\u5834\u5408\u306f\u3001`gcloud compute instances attach-disk`\u30b3\u30de\u30f3\u30c9\u3092\u7528\u3044\u3066temporary disk\u3092\u9069\u7528\u3057\u307e\u3059\u3002\n\n```bash\n$ gcloud compute instances attach-disk INSTANCE_NAME \\\n    --project PROJECT_NAME \\\n    --zone ZONE_NAME \\\n    --disk TEMPORARY_DISK_NAME \\\n    --device-name TEMPORARY_DISK_NAME \\\n```\n\n\u65e2\u5b58\u306eInstance\u306b\u9069\u7528\u3059\u308b\u5834\u5408\u306f\u3001Storage\u306b\u5bfe\u3059\u308b\u66f8\u304d\u8fbc\u307f\u6a29\u9650\u304c\u306a\u3044\u3068GCS\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u306a\u3044\u306e\u3067\u3001\u4e88\u3081\u6a29\u9650\u304c\u5b58\u5728\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n## 3. \u8d77\u52d5\u3057\u305fInstance\u306bSSH\u3067\u63a5\u7d9a\nssh\u3067\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u306b\u95a2\u3057\u3066\u306fGCE\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e[Connecting to an instance using ssh](https://cloud.google.com/compute/docs/instances#sshing)\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```bash\n$ gcloud compute ssh INSTANCE_NAME \\\n    --project PROJECT_NAME \\\n    --zone ZONE_NAME\n```\n\n## 4. \u3069\u3053\u306b\u30c7\u30a3\u30b9\u30af\u306e\u30c7\u30fc\u30bf\u304c\u5b58\u5728\u3059\u308b\u304b\u3092\u78ba\u8a8d\nInstance\u306bAttach\u3055\u308c\u305fdisk\u306f`/dev/disk/by-id/`\u914d\u4e0b\u306b`google-`\u306e\u63a5\u982d\u8a9e\uff0bdisk\u540d\u306e\u5f62\u3067\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\n```bash\nme@instance:~$ ls -l /dev/disk/by-id/google-*\nlrwxrwxrwx 1 root root  9 Jul 29 17:56 /dev/disk/by-id/google-persistent-disk-0 -> ../../sda\nlrwxrwxrwx 1 root root 10 Jul 29 17:56 /dev/disk/by-id/google-persistent-disk-0-part1 -> ../../sda1\nlrwxrwxrwx 1 root root  9 Aug 25 18:16 /dev/disk/by-id/google-temporary-disk -> ../../sdb\n```\n\n\u3053\u306e\u5834\u5408\u306f\u3001`google-persistent-disk-0`\u304croot persistent disk\u3001`google-temporary-disk`\u304ctemporary disk\u3067\u3059\u3002\n\n## 5. temporary disk\u3092\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3057\u30de\u30a6\u30f3\u30c8\n[safe_format_and_mount](https://github.com/GoogleCloudPlatform/compute-image-packages/blob/master/google-startup-scripts%2Fusr%2Fshare%2Fgoogle%2Fsafe_format_and_mount)\u3092\u7528\u3044\u3066temporary disk\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3068\u30de\u30a6\u30f3\u30c8\u3092\u884c\u3044\u307e\u3059\u3002\n\n```bash\nme@instance:~$ sudo mkdir /mnt/tmp\nme@instance:~$ sudo /usr/share/google/safe_format_and_mount -m \"mkfs.ext4 -F\" /dev/sdb /mnt/tmp\n```\n\n4.\u3067\u78ba\u8a8d\u6642\u306btemporary disk\u306f`/dev/sdb`\u306b\u5b58\u5728\u3059\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u5bfe\u8c61\u306b\u306f`/dev/sdb`\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\nsafe_format_and_mount\u306f[compute-image-packages](https://github.com/GoogleCloudPlatform/compute-image-packages)\u306b\u542b\u307e\u308c\u3066\u3044\u308b\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3067GCE\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u7528\u610f\u3055\u308c\u3066\u3044\u308bImage\u306b\u306f\u4e88\u3081\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3082\u3057\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306b\u306f[wget](https://www.gnu.org/software/wget/)\u306a\u3069\u3092\u7528\u3044\u3066compute-image-packages\u306e[releases](https://github.com/GoogleCloudPlatform/compute-image-packages/releases)\u304b\u3089\u6700\u65b0\u306etar.gz\u30d5\u30a1\u30a4\u30eb\u3092\u53d6\u5f97\u3059\u308c\u3070\u3001\u5229\u7528\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n## 6. \u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u305froot persistent disk\u3092tar\u30d5\u30a1\u30a4\u30eb\u5316\n\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u305froot persistent disk\u3092image\u5316\u3057tar\u30d5\u30a1\u30a4\u30eb\u306b\u56fa\u3081\u307e\u3059\u3002\n\u3053\u306e\u51e6\u7406\u3092\u5b9f\u884c\u3059\u308b\u307e\u3067\u306bImage\u306b\u542b\u3081\u305f\u3044\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3084\u30d5\u30a1\u30a4\u30eb\u306e\u914d\u7f6e\u3092\u7d42\u308f\u3089\u305b\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\nroot persistent disk\u3092tar\u30d5\u30a1\u30a4\u30eb\u306b\u56fa\u3081\u308b\u306b\u306f[gcimagebundle](https://github.com/GoogleCloudPlatform/compute-image-packages/tree/master/gcimagebundle)\u3092\u7528\u3044\u307e\u3059\u3002\ngcimagebundle\u3082safe_format_and_mount\u3068\u540c\u3058\u304f\u3001compute-image-packages\u306b\u542b\u307e\u308c\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u306e\u3067\u3001\u57fa\u672c\u7684\u306b\u4e88\u3081\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```bash\nme@instance:~$ sudo gcimagebundle -d /dev/sda -o /mnt/tmp/ --log_file=/tmp/abc.log\n```\n\n\u4e0a\u8a18\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u6b21\u306e\u5834\u6240\u306bImage\u306etar\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\n```\n/mnt/tmp/HEX-NUMBER.image.tar.gz\n```\n\n## 7. GCS\u3078Image\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\nInstance\u306b\u30d7\u30ea\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b[gsutil](https://cloud.google.com/storage/docs/gsutil)\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30c4\u30fc\u30eb\u3092\u7528\u3044\u3066GCS\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n### 7.1 Bucket\u3092\u4f5c\u6210\n\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3092\u7528\u3044\u3066\u3001Bucket\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nBucket\u306e\u547d\u540d\u306b\u95a2\u3057\u3066\u306f[Bucket and Object Naming Guidelines](https://cloud.google.com/storage/docs/bucketnaming?_ga=1.253453708.444133757.1413786301)\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```bash\nme@instance:~$ gsutil mb gs://BUCKET_NAME\n```\n\n### 7.2 Bucket\u306bImage\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3092\u7528\u3044\u3066\u30017.1\u3067\u4f5c\u6210\u3057\u305fBucket\u306bImage\u306etar\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n```bash\nme@instance:~$ gsutil cp /mnt/tmp/IMAGE_NAME.image.tar.gz gs://BUCKET_NAME\n```\n\n## \u304a\u308f\u308a\u306b\n\u4ee5\u4e0a\u3067\u3001GCE\u304b\u3089GCS\u306bImage\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u4e00\u89a7\u306e\u6d41\u308c\u306f\u7d42\u4e86\u3067\u3059\u3002\n\u3053\u308c\u3092\u5fdc\u7528\u3059\u308c\u3070\u3001disk\u304b\u3089\u3060\u3051\u3067\u306a\u304f\u3001Snapshot\u304b\u3089Instance\u3092\u4f5c\u6210\u3057\u3001Image\u5316\u3057\u3066GCS\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3082\u53ef\u80fd\u3067\u3059\u3002\n", "tags": ["googlecomputeengine", "GoogleCloudStorage", "GoogleCloudPlatform"]}