{"context": "2012\u5e74\u3054\u308d\u306b\u66f8\u3044\u305f\u3082\u306e\u306e\u3046\u308d\u899a\u3048\u7248\u3002\n\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u304c\u30c7\u30ab\u3059\u304e\u3066mod_php\u3067\u6271\u3046\u306b\u306f\u554f\u984c\u304c\u3042\u3063\u305f\u3053\u3068\u3068\u3001\u300c\u5168\u3066\u306e\u30c6\u30ad\u30b9\u30c8\u3092\u4e00\u62ec\u3067\u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u5909\u63db\u3057\u306a\u3044\u3068\u3001\u5909\u63db\u30df\u30b9\u304c\u767a\u751f\u3059\u308b\u300d\u30b1\u30fc\u30b9\u304c\u3042\u3063\u305f\u305f\u3081\u3001\u3053\u306e\u69d8\u306a\u5f37\u786c\u7b56\u3092\u53d6\u3063\u305f\u3002\n// SJIS\u3058\u3083\u306a\u304f\u3066SJIS-win\u3001EUC-JP\u3058\u3083\u306a\u304f\u3066eucJP-win\u3092\u4f7f\u3046\u3079\u304d\n$from_encoding = 'SJIS-win';\n$to_encoding = 'UTF-8';\n$file_path = '/path_to_csv/file.csv';\n\n// PHP\u30b3\u30de\u30f3\u30c9\u3067\u4e00\u62ec\u5909\u63db\u3059\u308b\u3068\u3044\u3046\u66b4\u6319\n$command = sprintf(\"echo mb_convert_encoding(file_get_contents('%s'), '%s', '%s');\", $file_path, $to_encoding, $from_encoding);\n\n// \u5909\u63db\u6e08\u307f\u306e\"\u51fa\u529b\"\u3092\u30d7\u30ed\u30bb\u30b9\u30cf\u30f3\u30c9\u30eb\u3068\u3057\u3066\u63e1\u308b\n$handle = popen(sprintf('%s -r %s', escapeshellarg(sprintf('%s/php', PHP_BINDIR)), escapeshellarg($command)), 'rb');\n\n// \u5f8c\u306f\u666e\u901a\u306eCSV\u51e6\u7406\n$in_body = false;    // \u30d5\u30e9\u30b0\u3068\u3057\u304b\u4f7f\u308f\u306a\u3044\u306a\u3089\u30d5\u30e9\u30b0\u3067\u3088\u304f\u306d\nwhile (($row = fgetcsv($handle, 4000)) !== FALSE) {\n    if ($in_body === false) {\n        $in_body = true;\n        continue;\n    }\n\n    if ($row === [null]) {\n        continue;\n    }\n\n    if (count($row) !== 3) {\n        throw new \\RuntimeException('Unexpected number of column');\n    }\n\n    var_dump($row);\n}\nfclose($handle);\n\n\n2012\u5e74\u3054\u308d\u306b\u66f8\u3044\u305f\u3082\u306e\u306e\u3046\u308d\u899a\u3048\u7248\u3002\n\n\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u304c\u30c7\u30ab\u3059\u304e\u3066mod_php\u3067\u6271\u3046\u306b\u306f\u554f\u984c\u304c\u3042\u3063\u305f\u3053\u3068\u3068\u3001\u300c\u5168\u3066\u306e\u30c6\u30ad\u30b9\u30c8\u3092\u4e00\u62ec\u3067\u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u5909\u63db\u3057\u306a\u3044\u3068\u3001\u5909\u63db\u30df\u30b9\u304c\u767a\u751f\u3059\u308b\u300d\u30b1\u30fc\u30b9\u304c\u3042\u3063\u305f\u305f\u3081\u3001\u3053\u306e\u69d8\u306a\u5f37\u786c\u7b56\u3092\u53d6\u3063\u305f\u3002\n\n```php\n// SJIS\u3058\u3083\u306a\u304f\u3066SJIS-win\u3001EUC-JP\u3058\u3083\u306a\u304f\u3066eucJP-win\u3092\u4f7f\u3046\u3079\u304d\n$from_encoding = 'SJIS-win';\n$to_encoding = 'UTF-8';\n$file_path = '/path_to_csv/file.csv';\n\n// PHP\u30b3\u30de\u30f3\u30c9\u3067\u4e00\u62ec\u5909\u63db\u3059\u308b\u3068\u3044\u3046\u66b4\u6319\n$command = sprintf(\"echo mb_convert_encoding(file_get_contents('%s'), '%s', '%s');\", $file_path, $to_encoding, $from_encoding);\n\n// \u5909\u63db\u6e08\u307f\u306e\"\u51fa\u529b\"\u3092\u30d7\u30ed\u30bb\u30b9\u30cf\u30f3\u30c9\u30eb\u3068\u3057\u3066\u63e1\u308b\n$handle = popen(sprintf('%s -r %s', escapeshellarg(sprintf('%s/php', PHP_BINDIR)), escapeshellarg($command)), 'rb');\n\n// \u5f8c\u306f\u666e\u901a\u306eCSV\u51e6\u7406\n$in_body = false;    // \u30d5\u30e9\u30b0\u3068\u3057\u304b\u4f7f\u308f\u306a\u3044\u306a\u3089\u30d5\u30e9\u30b0\u3067\u3088\u304f\u306d\nwhile (($row = fgetcsv($handle, 4000)) !== FALSE) {\n\tif ($in_body === false) {\n\t\t$in_body = true;\n\t\tcontinue;\n\t}\n\n\tif ($row === [null]) {\n\t\tcontinue;\n\t}\n\n\tif (count($row) !== 3) {\n\t\tthrow new \\RuntimeException('Unexpected number of column');\n\t}\n\n\tvar_dump($row);\n}\nfclose($handle);\n```\n", "tags": ["PHP", "CSV"]}