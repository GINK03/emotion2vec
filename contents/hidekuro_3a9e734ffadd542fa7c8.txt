{"context": "\n\n\u306f\u3058\u3081\u306b\nConsul \u306f\u516c\u5f0f\u30a4\u30e1\u30fc\u30b8 library/consul \u304c\u3042\u308b\u306e\u306b\u3001\u307f\u3093\u306a progrium/consul \u4f7f\u3044\u3088\u308b\u3002\n\u60c5\u5831\u304c\u8db3\u308a\u306a\u3044\u3093\u304b\u306a\uff1f\u3088\u3063\u3057\u3083\u7acb\u3066\u3066\u307f\u3088\uff01\n\n\u30cf\u30f3\u30ba\u30aa\u30f3\n\u304a\u624b\u5143\u306e docker-machine / virtualbox \u3067\u8a66\u305b\u308b\u30b3\u30d4\u30da\u30b9\u30af\u30ea\u30d7\u30c8\n# create machines (consul0, consul1, consul2)\nfor i in 0 1 2; do\n  docker-machine create -d virtualbox --virtualbox-memory 512 consul$i\ndone\n\n# start consul servers\nfor i in 0 1 2; do\n  docker $(docker-machine config consul$i) run \\\n    -d \\\n    --name consul$i \\\n    -p 8300-8302:8300-8302/tcp \\\n    -p 8301-8302:8301-8302/udp \\\n    -p 8400:8400/tcp \\\n    -p 8500:8500/tcp \\\n    -p 8600:8600/tcp \\\n    -p 8600:8600/udp \\\n    consul agent \\\n      -server \\\n      -node consul$i \\\n      -ui \\\n      -client 0.0.0.0 \\\n      -advertise $(docker-machine ip consul$i) \\\n      -retry-join $(docker-machine ip consul0) \\\n      -bootstrap-expect 3\ndone\n\n\u3057\u3070\u3089\u304f\u3057\u305f\u3089 http://$(docker-machine ip consul0):8500/ui \u306b\u30a2\u30af\u30bb\u30b9\u3002\nSERVICES \u3084\u2026\n\nNODES \u3092\u898b\u308b\u3068\u3001\u6b63\u5e38\u306a consul \u304c3\u3064\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n\u3053\u3053\u3067 consul0 \u3092\u843d\u3068\u3057\u3066\u307f\u307e\u3059\u3002\ndocker $(docker-machine config consul0) stop consul0\n\nconsul0 \u306f\u843d\u3068\u3057\u3066\u308b\u306e\u3067\u3001 consul1 \u306e IP \u3067\u30a2\u30af\u30bb\u30b9\u3002\nhttp://$(docker-machine ip consul1):8500/ui\nSERVICES \u3084\u2026\n\nNODES \u3092\u898b\u308b\u3068\u3001 consul0 \u306b\u969c\u5bb3\u304c\u8d77\u304d\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n\u518d\u5ea6\u3001 consul0 \u3092\u5fa9\u65e7\u3055\u305b\u308b\u3068\u30af\u30e9\u30b9\u30bf\u306e\u30ce\u30fc\u30c9\u306b\u3082\u53cd\u6620\u3055\u308c\u307e\u3059\u3002\ndocker $(docker-machine config consul0) start consul0\n\n\n\u904a\u3073\u7d42\u308f\u3063\u3066\u5168\u90e8\u6d88\u3059\u3068\u304d\u306f\nfor i in 0 1 2; do\n  docker $(docker-machine config consul$i) rm -f consul$i\n  docker-machine rm -f consul$i\ndone\n\n\n\u89e3\u8aac\n\u8981\u70b9\u3060\u3051\u8efd\u304f\u3002\n\ndocker-machine create ...\n\n\u5b9f\u904b\u7528\u3059\u308b\u6642\u306e\u30b5\u30fc\u30d0\u30fc3\u53f0\u306b\u898b\u7acb\u3066\u3066 VirtualBox VM \u3067 Docker \u30db\u30b9\u30c8\u30923\u3064\u4f5c\u3063\u3066\u3044\u307e\u3059\u3002\n--virtualbox-memory 512 \u306f\u305f\u3060\u306e\u30e1\u30e2\u30ea\u7bc0\u7d04\u306a\u306e\u3067\u7121\u304f\u3066\u3082OK\u3002\n\u4ed8\u3051\u306a\u304b\u3063\u305f\u5834\u5408\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306f 1024MB \u3067\u3059\u3002\u591a\u5206 Consul \u3067\u3053\u3093\u306a\u306b\u3044\u3089\u306a\u3044\u3002\ndocker-machine \u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u30d1\u30d6\u30ea\u30c3\u30af\u30af\u30e9\u30a6\u30c9\u5411\u3051\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u9069\u5207\u306b\u8a2d\u5b9a\u3059\u308c\u3070\u3001\u305d\u306e\u307e\u307e\u4e0a\u4f4d\u74b0\u5883\u306b\u3082\u53cd\u6620\u3067\u304d\u305d\u3046\u3067\u3059\u3002\n\n-p \u306e\u30dd\u30fc\u30c8\nConsul \u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 \u306b\u8a18\u8f09\u304c\u3042\u308a\u307e\u3059\u3002\n\nServer RPC (Default 8300). This is used by servers to handle incoming requests from other agents. TCP only.\n\nSerf LAN (Default 8301). This is used to handle gossip in the LAN. Required by all agents. TCP and UDP.\n\nSerf WAN (Default 8302). This is used by servers to gossip over the WAN to other servers. TCP and UDP.\n\nCLI RPC (Default 8400). This is used by all agents to handle RPC from the CLI. TCP only.\n\nHTTP API (Default 8500). This is used by clients to talk to the HTTP API. TCP only.\n\nDNS Interface (Default 8600). Used to resolve DNS queries. TCP and UDP.\n\n\nDocker \u306e EXPOSE \u5411\u3051\u306b\u307e\u3068\u3081\u308b\u3068\n\n8300-8302/tcp\n8301-8302/udp\n8400/tcp\n8500/tcp\n8600/tcp\n8600/udp\n\n\n-server\n\n\u30b5\u30fc\u30d0\u30fc\u30e2\u30fc\u30c9\u3067\u8d77\u52d5\u3002\n\u3053\u308c\u304c\u306a\u3044\u5834\u5408\u306f\u554f\u3044\u5408\u308f\u305b\u30b3\u30de\u30f3\u30c9\u306a\u3069\u3092\u767a\u884c\u3059\u308b\u305f\u3081\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30e2\u30fc\u30c9\u306b\u306a\u308a\u307e\u3059\u3002\n\n-node consul$i\n\nconsul \u30af\u30e9\u30b9\u30bf\u5185\u3067\u306e\u30ce\u30fc\u30c9\u540d\u3092\u3064\u3051\u3066\u3044\u307e\u3059\u3002\n\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306f\u3001 consul agent \u3092\u8d77\u52d5\u3059\u308b\u30de\u30b7\u30f3\u306e hostname \u304c\u63a1\u7528\u3055\u308c\u307e\u3059\u3002\n\n-ui -client 0.0.0.0\n\nWeb UI \u3092\u6709\u52b9\u306b\u3057\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u6a5f\u80fd\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u30d0\u30a4\u30f3\u30c9\u3059\u308b\uff08\u8981\u306f\u53d7\u3051\u5165\u308c\u308b\uff09 IP \u3092 0.0.0.0 \uff08\u3069\u3053\u304b\u3089\u3067\u3082\uff09\u306b\u5909\u66f4\u3057\u3066\u3044\u307e\u3059\u3002\n-client \u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f 127.0.0.1 \u30eb\u30fc\u30d7\u30d0\u30c3\u30af\u306e\u307f\u3067\u3001\u3053\u308c\u3060\u3068\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u306b\u4e0d\u90fd\u5408\u3067\u3059\u3002\nConsul \u30af\u30e9\u30b9\u30bf\u3092\u53ce\u3081\u308b\u30b5\u30d6\u30cd\u30c3\u30c8\u3084 VPC \u7a0b\u5ea6\u306e\u7bc4\u56f2\u304c\u9069\u5207\u3067\u3059\u304c\u3001\u3053\u308c\u306f Docker \u30db\u30b9\u30c8\u81ea\u4f53\u306e\u30a4\u30f3\u30d5\u30e9\u30ec\u30d9\u30eb\u3067\u7d5e\u308b\u3079\u304d\u306a\u306e\u3067\u3001\u3053\u3053\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u5024\u306f\u7a81\u304d\u8a70\u3081\u3059\u304e\u306a\u304f\u3066\u3082\u826f\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n-advertise $(docker-machine ip consul$i)\n\n\u4ed6\u306e\u30af\u30e9\u30b9\u30bf\u30e1\u30f3\u30d0\u30fc\u304b\u3089\u3053\u306e consul server \u3092\u6307\u3057\u793a\u3059\u305f\u3081\u306e IP \u3092\u30bb\u30c3\u30c8\u3057\u307e\u3059\u3002\n\n-retry-join $(docker-machine ip consul0)\n\n\u65e2\u5b58\u30b5\u30fc\u30d0\u30fc\u306b\u53c2\u52a0\u4ea4\u6e09\u3057\u3066\u30af\u30e9\u30b9\u30bf\u3092\u958b\u59cb\u3059\u308b -join \u306e\u4fbf\u5229\u7248\u3002\n\u3053\u306e\u4f8b\u3067\u306f\u3044\u305a\u308c\u306e\u30b5\u30fc\u30d0\u30fc\u3082 consul0 \u3092\u53c2\u52a0\u5148\u306b\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n-join \u306f\u5358\u767a\u3067\u30c8\u30e9\u30a4\u3057\u3066\u30df\u30b9\u3063\u305f\u3089\u7d42\u4e86\u3067\u3059\u304c\u3001\u3053\u3061\u3089\u306f\u30ea\u30c8\u30e9\u30a4\u3057\u7d9a\u3051\u3066\u304f\u308c\u307e\u3059\u3002\n\n-bootstrap-expect 3\n\n-bootstrap \uff08\u30ea\u30fc\u30c0\u30fc\u306e\u9078\u51fa\u306a\u3069\u3001\u30af\u30e9\u30b9\u30bf\u306e\u6e96\u5099\u3092\u884c\u3046\u30e2\u30fc\u30c9\u3067\u8d77\u52d5\u3059\u308b\uff09\u306e\u4fbf\u5229\u7248\u3002\njoin \u3057\u3066\u304f\u308b\u30ce\u30fc\u30c9\u304c\u6307\u5b9a\u6570\u306b\u306a\u308b\u307e\u3067\u5f85\u6a5f\u3057\u3001\u6307\u5b9a\u6570\u306b\u306a\u308b\u3068\u30d6\u30fc\u30c8\u30b9\u30c8\u30e9\u30c3\u30d7\u3092\u884c\u3044\u3001\u30ea\u30fc\u30c0\u30fc\u3092\u81ea\u52d5\u9078\u51fa\u3057\u3066\u30af\u30e9\u30b9\u30bf\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\u3053\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u3001\u6b21\u306e\u3044\u305a\u308c\u304b\u306b\u6e96\u62e0\u3059\u308b\u3088\u3046\u306b\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u30af\u30e9\u30b9\u30bf\u306b\u53c2\u52a0\u3059\u308b\u30b5\u30fc\u30d0\u30fc\u306e\u6570\u3092\u6c7a\u3081\u3066\u304a\u3044\u3066\u3001\u5168\u3066\u306e\u30b5\u30fc\u30d0\u30fc\u3067\u540c\u3058\u6570\u5024\u3092\u6307\u5b9a\u3059\u308b\u3002\n\u30e1\u30f3\u30d0\u30fc\u306f\u6570\u5024\u3092\u6307\u5b9a\u305b\u305a\u306b\u3001\u30ea\u30fc\u30c0\u30fc\u3060\u3051\u6570\u5024\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n\u4eca\u56de\u306f1\u756a\u76ee\u306e\u624b\u6cd5\u3092\u53d6\u308a\u307e\u3057\u305f\u3002\nConsul \u30af\u30e9\u30b9\u30bf\u306e\u904b\u7528\u306f3\u53f0\u307e\u305f\u306f5\u53f0\uff08\u305d\u306e\u4e0a\u306f7\u53f0\uff09\u304c\u63a8\u5968\u3055\u308c\u3066\u3044\u307e\u3059 \u3057\u3001\u3069\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u30fb\u3069\u306e\u30be\u30fc\u30f3\u306b\u7f6e\u304f\u304b\u3059\u3089\u6c7a\u3081\u3065\u3089\u3044\u30ea\u30fc\u30c0\u30fc\u3092\u6c7a\u3081\u308b\u3088\u308a\u3001\u30af\u30e9\u30b9\u30bf\u306e\u898f\u6a21\u3092\u3042\u3089\u304b\u3058\u3081\u6c7a\u3081\u308b\u307b\u3046\u304c\u697d\u3067\u3057\u3087\u3046\u3002\n\n\u304a\u308f\u308a\u306b\n\u4eca\u56de\u69cb\u7bc9\u3057\u305f\u3088\u3046\u306a\u30af\u30e9\u30b9\u30bf\u306f\u3001\u3069\u306e\u30ce\u30fc\u30c9\u3092\u53c2\u7167\u3057\u3066\u3082\u540c\u3058\u4ed5\u4e8b\u3092\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\u3053\u308c\u3092\u6d3b\u304b\u3057\u3066 \u3010consul0 \u21d4 swarm-manager0\u3011 \u306e\u3088\u3046\u306a\u7d44\u307f\u5408\u308f\u305b\u3092 0~2 \u307e\u3067\u4f5c\u308a\u3001 Plan for Swarm in production \u306b\u3042\u308b\u3088\u3046\u306a\u9ad8\u53ef\u7528\u6027 Swarm \u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u3063\u3066\u307f\u305f\u3044\u3067\u3059\u306d\u3002\n\u3066\u3044\u3046\u304b\u6700\u521d\u305d\u308c\u304c\u3084\u308a\u305f\u304b\u3063\u305f\u306e\u306b\u3069\u3046\u3057\u3066\u3053\u3046\u306a\u3063\u305f\u3002\n\u66f8\u304d\u307e\u3057\u305f \u2192 \u672c\u756a\u74b0\u5883\u306b\u3082\u4f7f\u3048\u308b\u9ad8\u53ef\u7528\u6027\u304b\u3064\u30b9\u30b1\u30fc\u30e9\u30d6\u30eb\u306a Docker Swarm + Consul \u30af\u30e9\u30b9\u30bf\u3092\u69cb\u7bc9\nconsul0~2 \u3092\u7acb\u3066\u308b\u4f5c\u696d\u3082\u30011\u679a\u306e docker-compose.yml \u3067\u30de\u30b7\u30f3\u3092\u6307\u5b9a\u3057\u3066\u6d41\u3059\u65b9\u6cd5\u304c\u3042\u308c\u3070\u3082\u3063\u3068\u30b9\u30de\u30fc\u30c8\u306b\u306a\u3063\u305f\u304b\u3082\u3002\uff08--engine-label \u3068 constraints \u3067\u51fa\u6765\u305f\u3088\u3046\u306a\u2026\u3067\u304d\u306a\u304b\u3063\u305f\u3088\u3046\u306a\u2026\uff09\n\u4ee5\u4e0a\u3067\u3059\u3002\n# \u306f\u3058\u3081\u306b\n\nConsul \u306f\u516c\u5f0f\u30a4\u30e1\u30fc\u30b8 [library/consul](https://hub.docker.com/_/consul/) \u304c\u3042\u308b\u306e\u306b\u3001\u307f\u3093\u306a [progrium/consul](https://hub.docker.com/r/progrium/consul/) \u4f7f\u3044\u3088\u308b\u3002\n\n**\u60c5\u5831\u304c\u8db3\u308a\u306a\u3044\u3093\u304b\u306a\uff1f\u3088\u3063\u3057\u3083\u7acb\u3066\u3066\u307f\u3088\uff01**\n\n# \u30cf\u30f3\u30ba\u30aa\u30f3\n\n\u304a\u624b\u5143\u306e docker-machine / virtualbox \u3067\u8a66\u305b\u308b\u30b3\u30d4\u30da\u30b9\u30af\u30ea\u30d7\u30c8\n\n```bash\n# create machines (consul0, consul1, consul2)\nfor i in 0 1 2; do\n  docker-machine create -d virtualbox --virtualbox-memory 512 consul$i\ndone\n\n# start consul servers\nfor i in 0 1 2; do\n  docker $(docker-machine config consul$i) run \\\n    -d \\\n    --name consul$i \\\n    -p 8300-8302:8300-8302/tcp \\\n    -p 8301-8302:8301-8302/udp \\\n    -p 8400:8400/tcp \\\n    -p 8500:8500/tcp \\\n    -p 8600:8600/tcp \\\n    -p 8600:8600/udp \\\n    consul agent \\\n      -server \\\n      -node consul$i \\\n      -ui \\\n      -client 0.0.0.0 \\\n      -advertise $(docker-machine ip consul$i) \\\n      -retry-join $(docker-machine ip consul0) \\\n      -bootstrap-expect 3\ndone\n```\n\n\u3057\u3070\u3089\u304f\u3057\u305f\u3089 `http://$(docker-machine ip consul0):8500/ui` \u306b\u30a2\u30af\u30bb\u30b9\u3002\n\n**SERVICES** \u3084\u2026\n\n![services.png](https://qiita-image-store.s3.amazonaws.com/0/27017/19c3a8bd-6451-6aa1-eeb6-59757dca29c3.png)\n\n**NODES** \u3092\u898b\u308b\u3068\u3001\u6b63\u5e38\u306a consul \u304c3\u3064\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n![nodes.png](https://qiita-image-store.s3.amazonaws.com/0/27017/0881f144-be72-77fe-399c-24dc83c663b3.png)\n\n\n\u3053\u3053\u3067 consul0 \u3092\u843d\u3068\u3057\u3066\u307f\u307e\u3059\u3002\n\n```bash\ndocker $(docker-machine config consul0) stop consul0\n```\n\nconsul0 \u306f\u843d\u3068\u3057\u3066\u308b\u306e\u3067\u3001 consul1 \u306e IP \u3067\u30a2\u30af\u30bb\u30b9\u3002\n`http://$(docker-machine ip consul1):8500/ui`\n\n**SERVICES** \u3084\u2026\n\n![fail.png](https://qiita-image-store.s3.amazonaws.com/0/27017/a1650678-b316-e47d-a358-65839ae8244f.png)\n\n**NODES** \u3092\u898b\u308b\u3068\u3001 consul0 \u306b\u969c\u5bb3\u304c\u8d77\u304d\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n![fail1.png](https://qiita-image-store.s3.amazonaws.com/0/27017/dea32e8e-763f-0adb-bf9d-aeb6b1cb04a5.png)\n\n\u518d\u5ea6\u3001 consul0 \u3092\u5fa9\u65e7\u3055\u305b\u308b\u3068\u30af\u30e9\u30b9\u30bf\u306e\u30ce\u30fc\u30c9\u306b\u3082\u53cd\u6620\u3055\u308c\u307e\u3059\u3002\n\n```bash\ndocker $(docker-machine config consul0) start consul0\n```\n\n![nodes.png](https://qiita-image-store.s3.amazonaws.com/0/27017/0fbd2fe8-6dbe-253f-1b2e-25e7b893abdc.png)\n\n\u904a\u3073\u7d42\u308f\u3063\u3066\u5168\u90e8\u6d88\u3059\u3068\u304d\u306f\n\n```bash\nfor i in 0 1 2; do\n  docker $(docker-machine config consul$i) rm -f consul$i\n  docker-machine rm -f consul$i\ndone\n```\n\n# \u89e3\u8aac\n\n\u8981\u70b9\u3060\u3051\u8efd\u304f\u3002\n\n## `docker-machine create ...`\n\n\u5b9f\u904b\u7528\u3059\u308b\u6642\u306e\u30b5\u30fc\u30d0\u30fc3\u53f0\u306b\u898b\u7acb\u3066\u3066 VirtualBox VM \u3067 Docker \u30db\u30b9\u30c8\u30923\u3064\u4f5c\u3063\u3066\u3044\u307e\u3059\u3002\n\n`--virtualbox-memory 512` \u306f\u305f\u3060\u306e\u30e1\u30e2\u30ea\u7bc0\u7d04\u306a\u306e\u3067\u7121\u304f\u3066\u3082OK\u3002\n\u4ed8\u3051\u306a\u304b\u3063\u305f\u5834\u5408\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306f 1024MB \u3067\u3059\u3002\u591a\u5206 Consul \u3067\u3053\u3093\u306a\u306b\u3044\u3089\u306a\u3044\u3002\n\ndocker-machine \u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u30d1\u30d6\u30ea\u30c3\u30af\u30af\u30e9\u30a6\u30c9\u5411\u3051\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u9069\u5207\u306b\u8a2d\u5b9a\u3059\u308c\u3070\u3001\u305d\u306e\u307e\u307e\u4e0a\u4f4d\u74b0\u5883\u306b\u3082\u53cd\u6620\u3067\u304d\u305d\u3046\u3067\u3059\u3002\n\n## `-p` \u306e\u30dd\u30fc\u30c8\n\n[Consul \u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](https://www.consul.io/docs/agent/options.html#ports) \u306b\u8a18\u8f09\u304c\u3042\u308a\u307e\u3059\u3002\n\n* Server RPC (Default **8300**). This is used by servers to handle incoming requests from other agents. **TCP only.**\n* Serf LAN (Default **8301**). This is used to handle gossip in the LAN. Required by all agents. **TCP and UDP.**\n* Serf WAN (Default **8302**). This is used by servers to gossip over the WAN to other servers. **TCP and UDP.**\n* CLI RPC (Default **8400**). This is used by all agents to handle RPC from the CLI. **TCP only.**\n* HTTP API (Default **8500**). This is used by clients to talk to the HTTP API. **TCP only.**\n* DNS Interface (Default **8600**). Used to resolve DNS queries. **TCP and UDP.**\n\nDocker \u306e EXPOSE \u5411\u3051\u306b\u307e\u3068\u3081\u308b\u3068\n\n* 8300-8302/tcp\n* 8301-8302/udp\n* 8400/tcp\n* 8500/tcp\n* 8600/tcp\n* 8600/udp\n\n\n## `-server`\n\n\u30b5\u30fc\u30d0\u30fc\u30e2\u30fc\u30c9\u3067\u8d77\u52d5\u3002\n\u3053\u308c\u304c\u306a\u3044\u5834\u5408\u306f\u554f\u3044\u5408\u308f\u305b\u30b3\u30de\u30f3\u30c9\u306a\u3069\u3092\u767a\u884c\u3059\u308b\u305f\u3081\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30e2\u30fc\u30c9\u306b\u306a\u308a\u307e\u3059\u3002\n\n## `-node consul$i`\n\nconsul \u30af\u30e9\u30b9\u30bf\u5185\u3067\u306e\u30ce\u30fc\u30c9\u540d\u3092\u3064\u3051\u3066\u3044\u307e\u3059\u3002\n\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306f\u3001 consul agent \u3092\u8d77\u52d5\u3059\u308b\u30de\u30b7\u30f3\u306e hostname \u304c\u63a1\u7528\u3055\u308c\u307e\u3059\u3002\n\n## `-ui -client 0.0.0.0`\n\nWeb UI \u3092\u6709\u52b9\u306b\u3057\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u6a5f\u80fd\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u30d0\u30a4\u30f3\u30c9\u3059\u308b\uff08\u8981\u306f\u53d7\u3051\u5165\u308c\u308b\uff09 IP \u3092 `0.0.0.0` \uff08\u3069\u3053\u304b\u3089\u3067\u3082\uff09\u306b\u5909\u66f4\u3057\u3066\u3044\u307e\u3059\u3002\n\n`-client` \u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f `127.0.0.1` \u30eb\u30fc\u30d7\u30d0\u30c3\u30af\u306e\u307f\u3067\u3001\u3053\u308c\u3060\u3068\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u306b\u4e0d\u90fd\u5408\u3067\u3059\u3002\n\nConsul \u30af\u30e9\u30b9\u30bf\u3092\u53ce\u3081\u308b\u30b5\u30d6\u30cd\u30c3\u30c8\u3084 VPC \u7a0b\u5ea6\u306e\u7bc4\u56f2\u304c\u9069\u5207\u3067\u3059\u304c\u3001\u3053\u308c\u306f Docker \u30db\u30b9\u30c8\u81ea\u4f53\u306e\u30a4\u30f3\u30d5\u30e9\u30ec\u30d9\u30eb\u3067\u7d5e\u308b\u3079\u304d\u306a\u306e\u3067\u3001\u3053\u3053\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u5024\u306f\u7a81\u304d\u8a70\u3081\u3059\u304e\u306a\u304f\u3066\u3082\u826f\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n## `-advertise $(docker-machine ip consul$i)`\n\n\u4ed6\u306e\u30af\u30e9\u30b9\u30bf\u30e1\u30f3\u30d0\u30fc\u304b\u3089\u3053\u306e consul server \u3092\u6307\u3057\u793a\u3059\u305f\u3081\u306e IP \u3092\u30bb\u30c3\u30c8\u3057\u307e\u3059\u3002\n\n## `-retry-join $(docker-machine ip consul0)`\n\n\u65e2\u5b58\u30b5\u30fc\u30d0\u30fc\u306b\u53c2\u52a0\u4ea4\u6e09\u3057\u3066\u30af\u30e9\u30b9\u30bf\u3092\u958b\u59cb\u3059\u308b `-join` \u306e\u4fbf\u5229\u7248\u3002\n\u3053\u306e\u4f8b\u3067\u306f\u3044\u305a\u308c\u306e\u30b5\u30fc\u30d0\u30fc\u3082 consul0 \u3092\u53c2\u52a0\u5148\u306b\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n`-join` \u306f\u5358\u767a\u3067\u30c8\u30e9\u30a4\u3057\u3066\u30df\u30b9\u3063\u305f\u3089\u7d42\u4e86\u3067\u3059\u304c\u3001\u3053\u3061\u3089\u306f\u30ea\u30c8\u30e9\u30a4\u3057\u7d9a\u3051\u3066\u304f\u308c\u307e\u3059\u3002\n\n## `-bootstrap-expect 3`\n\n`-bootstrap` \uff08\u30ea\u30fc\u30c0\u30fc\u306e\u9078\u51fa\u306a\u3069\u3001\u30af\u30e9\u30b9\u30bf\u306e\u6e96\u5099\u3092\u884c\u3046\u30e2\u30fc\u30c9\u3067\u8d77\u52d5\u3059\u308b\uff09\u306e\u4fbf\u5229\u7248\u3002\n\njoin \u3057\u3066\u304f\u308b\u30ce\u30fc\u30c9\u304c\u6307\u5b9a\u6570\u306b\u306a\u308b\u307e\u3067\u5f85\u6a5f\u3057\u3001\u6307\u5b9a\u6570\u306b\u306a\u308b\u3068\u30d6\u30fc\u30c8\u30b9\u30c8\u30e9\u30c3\u30d7\u3092\u884c\u3044\u3001\u30ea\u30fc\u30c0\u30fc\u3092\u81ea\u52d5\u9078\u51fa\u3057\u3066\u30af\u30e9\u30b9\u30bf\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\n\u3053\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u3001\u6b21\u306e\u3044\u305a\u308c\u304b\u306b\u6e96\u62e0\u3059\u308b\u3088\u3046\u306b\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n* \u30af\u30e9\u30b9\u30bf\u306b\u53c2\u52a0\u3059\u308b\u30b5\u30fc\u30d0\u30fc\u306e\u6570\u3092\u6c7a\u3081\u3066\u304a\u3044\u3066\u3001\u5168\u3066\u306e\u30b5\u30fc\u30d0\u30fc\u3067\u540c\u3058\u6570\u5024\u3092\u6307\u5b9a\u3059\u308b\u3002\n* \u30e1\u30f3\u30d0\u30fc\u306f\u6570\u5024\u3092\u6307\u5b9a\u305b\u305a\u306b\u3001\u30ea\u30fc\u30c0\u30fc\u3060\u3051\u6570\u5024\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n\u4eca\u56de\u306f1\u756a\u76ee\u306e\u624b\u6cd5\u3092\u53d6\u308a\u307e\u3057\u305f\u3002\n\n[Consul \u30af\u30e9\u30b9\u30bf\u306e\u904b\u7528\u306f3\u53f0\u307e\u305f\u306f5\u53f0\uff08\u305d\u306e\u4e0a\u306f7\u53f0\uff09\u304c\u63a8\u5968\u3055\u308c\u3066\u3044\u307e\u3059](https://www.consul.io/docs/internals/consensus.html#deployment_table) \u3057\u3001\u3069\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u30fb\u3069\u306e\u30be\u30fc\u30f3\u306b\u7f6e\u304f\u304b\u3059\u3089\u6c7a\u3081\u3065\u3089\u3044\u30ea\u30fc\u30c0\u30fc\u3092\u6c7a\u3081\u308b\u3088\u308a\u3001\u30af\u30e9\u30b9\u30bf\u306e\u898f\u6a21\u3092\u3042\u3089\u304b\u3058\u3081\u6c7a\u3081\u308b\u307b\u3046\u304c\u697d\u3067\u3057\u3087\u3046\u3002\n\n# \u304a\u308f\u308a\u306b\n\n\u4eca\u56de\u69cb\u7bc9\u3057\u305f\u3088\u3046\u306a\u30af\u30e9\u30b9\u30bf\u306f\u3001\u3069\u306e\u30ce\u30fc\u30c9\u3092\u53c2\u7167\u3057\u3066\u3082\u540c\u3058\u4ed5\u4e8b\u3092\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\n\u3053\u308c\u3092\u6d3b\u304b\u3057\u3066 \u3010consul0 \u21d4 swarm-manager0\u3011 \u306e\u3088\u3046\u306a\u7d44\u307f\u5408\u308f\u305b\u3092 0~2 \u307e\u3067\u4f5c\u308a\u3001 [Plan for Swarm in production](https://docs.docker.com/swarm/plan-for-production/) \u306b\u3042\u308b\u3088\u3046\u306a\u9ad8\u53ef\u7528\u6027 Swarm \u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u3063\u3066\u307f\u305f\u3044\u3067\u3059\u306d\u3002\n\n~~\u3066\u3044\u3046\u304b\u6700\u521d\u305d\u308c\u304c\u3084\u308a\u305f\u304b\u3063\u305f\u306e\u306b\u3069\u3046\u3057\u3066\u3053\u3046\u306a\u3063\u305f\u3002~~\n**\u66f8\u304d\u307e\u3057\u305f** \u2192 [\u672c\u756a\u74b0\u5883\u306b\u3082\u4f7f\u3048\u308b\u9ad8\u53ef\u7528\u6027\u304b\u3064\u30b9\u30b1\u30fc\u30e9\u30d6\u30eb\u306a Docker Swarm + Consul \u30af\u30e9\u30b9\u30bf\u3092\u69cb\u7bc9](http://qiita.com/hidekuro/items/77a5bd181219dab9f63e)\n\nconsul0~2 \u3092\u7acb\u3066\u308b\u4f5c\u696d\u3082\u30011\u679a\u306e docker-compose.yml \u3067\u30de\u30b7\u30f3\u3092\u6307\u5b9a\u3057\u3066\u6d41\u3059\u65b9\u6cd5\u304c\u3042\u308c\u3070\u3082\u3063\u3068\u30b9\u30de\u30fc\u30c8\u306b\u306a\u3063\u305f\u304b\u3082\u3002\uff08`--engine-label` \u3068 `constraints` \u3067\u51fa\u6765\u305f\u3088\u3046\u306a\u2026\u3067\u304d\u306a\u304b\u3063\u305f\u3088\u3046\u306a\u2026\uff09\n\n\u4ee5\u4e0a\u3067\u3059\u3002\n", "tags": ["consul", "docker", "docker-machine"]}