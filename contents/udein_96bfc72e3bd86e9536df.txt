{"context": "\n\n\u306f\u3058\u3081\u306b\n\n\u4e0b\u8a18\u306e\u8a18\u4e8b\u3067 Ruby \u3092\u53d6\u308a\u5dfb\u304f\u57fa\u672c\u7684\u306a\u8a00\u8449\u306b\u3064\u3044\u3066\u6574\u7406\u3057\u305f\u3002\n\nRuby\u899a\u66f8 - Ruby / RubyGem / rvm / rbenv / Bundler\n\n\u672c\u7a3f\u306f\u305d\u308c\u306b\u7d9a\u304d\u3001\u30e1\u30a4\u30f3\u3068\u306a\u308b Itamae \u3068 Serverspec \u3092\u4f7f\u7528\u3057\u305f\u81ea\u52d5\u69cb\u6210\u7ba1\u7406\u306e\u5c0e\u5165\u306b\u95a2\u3059\u308b\u74b0\u5883\u69cb\u7bc9\u306e\u624b\u9806\u306b\u3064\u3044\u3066\u8a18\u8f09\u3059\u308b\u3002\n\n\u524d\u63d0\u6761\u4ef6\n\n\u672c\u7a3f\u306e\u4f5c\u6210\u306b\u3042\u305f\u308a\u3001\u4e0b\u8a18\u306e\u4f5c\u696d\u74b0\u5883\u304a\u3088\u3073\u69cb\u7bc9\u74b0\u5883\u3092\u524d\u63d0\u3068\u3059\u308b\u3002\n\n\u4f5c\u696d\u74b0\u5883\n\n\u672c\u8a18\u4e8b\u306e\u4f5c\u6210\u306b\u3042\u305f\u308a\u4f7f\u7528\u3057\u305f\u4f5c\u696d\u74b0\u5883\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3002\n\n\n\n\u9805\u76ee\n\u5185\u5bb9\n\u30d0\u30fc\u30b8\u30e7\u30f3\n\n\n\n\nOS\nmacOS\nSierra 10.12.3\n\n\nVM\nVirtualBox\n5.1.14 r112924\n\n\n\u305d\u306e\u4ed6\nVagrant\n1.8.7\n\n\n\n\n\u69cb\u7bc9\u74b0\u5883\n\n\u672c\u8a18\u4e8b\u304c\u69cb\u7bc9\u5bfe\u8c61\u3068\u3059\u308b\u30b7\u30b9\u30c6\u30e0\u306e\u4e3b\u8981\u306a\u30bd\u30d5\u30c8\u306e\u69cb\u6210\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3002\n\n\n\n\u9805\u76ee\n\u5185\u5bb9\n\u30d0\u30fc\u30b8\u30e7\u30f3\n\u30db\u30b9\u30c8 A\n\u30db\u30b9\u30c8 B\n\n\n\n\nOS\nbento/centos-6.8\n-\n\u25cb\n\u25cb\n\n\nS/W\nrbenv\n1.1.0-2-g4f8925a\n\u25cb\n-\n\n\nS/W\nruby-build\n-\n\u25cb\n-\n\n\nS/W\nBundler\nversion 1.14.6\n\u25cb\n-\n\n\nS/W\nItamae\nv1.9.10\n\u25cb\n-\n\n\nS/W\nServerspec\n2.38.0\n\u25cb\n-\n\n\n\nVagrant \u306e Box \u306e\u69cb\u6210\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3002\n\nVagrant\n  # config.vm.box = \"bento/centos-6.8\"\n  config.vm.define \"host\" do |node|\n    node.vm.box = \"bento/centos-6.8\"\n    node.vm.hostname = \"host\"\n    node.vm.network :private_network, ip: \"192.168.33.10\"\n  end\n  config.vm.define \"web\" do |node|\n    node.vm.box = \"bento/centos-6.8\"\n    node.vm.hostname = \"web\"\n    node.vm.network :private_network, ip: \"192.168.33.11\"\n  end\n\n\n\n\u69cb\u7bc9\u624b\u9806\n\n\n1. Ruby\u306e\u5c0e\u5165\n\nrbenv\u3092\u4f7f\u7528\u3057\u305fRuby\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\u306e\u6982\u8981\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3002\n\nRuby\u306e\u30d3\u30eb\u30c9\u74b0\u5883\uff08gcc\u306a\u3069\uff09\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nrbenv + rbenv-build \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n.bash_profile \u306bPATH\u3092\u901a\u3057\u3066\u8a2d\u5b9a\u3092\u9069\u7528\n\nRuby \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u4e00\u89a7\u306e\u78ba\u8a8d\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nrbenv global \u3067\u74b0\u5883\u5168\u4f53\u306b\u8a2d\u5b9a\u3092\u9069\u7528\n\n\u672c\u624b\u9806\u306b\u95a2\u3059\u308b\u8a73\u7d30\u306a\u30b3\u30de\u30f3\u30c9\u306b\u3064\u3044\u3066\u306f\u4e0b\u8a18\u304c\u8a73\u3057\u3044\u3002\n\nrbenv \u3092\u5229\u7528\u3057\u305f Ruby \u74b0\u5883\u306e\u69cb\u7bc9 - Developers.IO\n\n\n2. Bundler\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\nCommand\n// Bundle\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ gem install bundler\n\n// bundler \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\n$ bundler -v\nBundler version 1.14.6\n\n\n\n\u4f7f\u7528\u65b9\u6cd5\n\nbundler \u306e\u57fa\u672c\u7684\u306a\u4f7f\u7528\u65b9\u6cd5\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3002\n\n\nGemfile \u3092\u4f5c\u6210\u3059\u308b\n\u4f7f\u7528\u3057\u305f\u3044 gem \u3092 Gemfile \u306b\u8a18\u8ff0\u3059\u308b\n\nGemfile \u306b\u30ea\u30b9\u30c8\u5316\u3057\u305fgem\u3092\u4e00\u62ec\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fgem\u3092\u30d7\u30ed\u30b0\u30e9\u30e0\u30bd\u30fc\u30b9\u4e0a\u3067\u30ed\u30fc\u30c9\n\nbundle exec \u3092\u6700\u521d\u306b\u3064\u3051\u3066\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\n\n\u30b3\u30de\u30f3\u30c9\u4f8b\u3092\u4e0b\u8a18\u306b\u8a18\u3059\u3002\n\nCommand\n// 1. Gemfile \u3092\u4f5c\u6210\u3059\u308b\n$ bundle init\n\n// 2. Gemfile \u306b\u4f7f\u7528\u3057\u305f\u3044gem\u3092\u8a18\u8ff0\u3059\u308b\n$ vim Gemfile\n\n// 3. Gemfile \u306b\u30ea\u30b9\u30c8\u5316\u3057\u305fgem\u3092\u4e00\u62ec\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ bundle install --path vendor/bundle\n\n// 4. bundle exec \u3092\u6700\u521d\u306b\u3064\u3051\u3066\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\uff08\u4e0b\u8a18\u306f\u4e00\u4f8b\uff09\n$ bundle exec ruby foo.rb\n\n\n\n3. Itamae \u3068 Serverspec\n\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\n\n\u305d\u308c\u305e\u308c\u306b\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3068\u306a\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\u304c\u3042\u308b\u3002\n\nItamae\n.\n\u251c\u2500\u2500 cookbooks\n\u2502   \u2514\u2500\u2500 nginx\n\u2502       \u251c\u2500\u2500 default.rb\n\u2502       \u251c\u2500\u2500 files\n\u2502       \u2502   \u2514\u2500\u2500 etc\n\u2502       \u2502       \u2514\u2500\u2500 nginx\n\u2502       \u2502           \u2514\u2500\u2500 conf.d\n\u2502       \u2502               \u2514\u2500\u2500 static.conf\n\u2502       \u2514\u2500\u2500 templates\n\u2502           \u2514\u2500\u2500 etc\n\u2502               \u2514\u2500\u2500 nginx\n\u2502                   \u2514\u2500\u2500 conf.d\n\u2502                       \u2514\u2500\u2500 dynamic.conf\n\u2514\u2500\u2500 roles\n    \u2514\u2500\u2500 web.rb\n\nBest Practice \u00b7 itamae-kitchen/itamae Wiki \u00b7 GitHub\n\nServerspec\n.\n\u251c\u2500\u2500 Rakefile\n\u251c\u2500\u2500 spec\n\u2502          \u251c\u2500\u2500 ap\n\u2502          \u2502        \u251c\u2500\u2500 mysqlclient_spec.rb\n\u2502          \u2502        \u251c\u2500\u2500 nodejs_spec.rb\n\u2502          \u2502        \u251c\u2500\u2500 rvm_spec.rb\n\u2502          \u2502        \u2514\u2500\u2500 sqlite_spec.rb\n\u2502          \u251c\u2500\u2500 base\n\u2502          \u2502        \u251c\u2500\u2500 build-essential_spec.rb\n\u2502          \u2502        \u2514\u2500\u2500 git_spec.rb\n\u2502          \u251c\u2500\u2500 db\n\u2502          \u2502        \u2514\u2500\u2500 mysql_spec.rb\n\u2502          \u2514\u2500\u2500 spec_helper.rb\n\n[ ap / base/ db ] \u306f\u30db\u30b9\u30c8\u540d\u3002\n[Serverspec]Serverspec\u306e\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3092\u30ed\u30fc\u30eb\u5358\u4f4d\u3067\u7ba1\u7406\u3059\u308b - \u57ce\u967d\u4eba\u306e\u672c\u68da\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u524d\u8ff0\u306e\u60c5\u5831\u3092\u53c2\u8003\u306b\u3001\u5b9f\u969b\u306b Itamae \u3068 Serverspec \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\nCommand\n// \u4efb\u610f\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30d5\u30a9\u30eb\u30c0\u3092\u4f5c\u6210\u3059\u308b\n$ mkdir ~/sample && cd $_\n\n// --------------------------\n// Itamae \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n// --------------------------\n$ mkdir ~/sample/itamae && cd $_\n\n// Gemfile\u3092\u4f5c\u6210\u3059\u308b\n$ bundle init\n\n// Gemfile\u3092\u7de8\u96c6\u3059\u308b\u3002\uff08\u30d2\u30a2\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u4f7f\u7528\uff09\n$ cat << EOS > Gemfile\nsource \"https://rubygems.org\"\n\ngem 'itamae'\ngem 'thor', \"0.19.1\"\ngem 'rake'\nEOS\n\n// Gemfile \u306b\u30ea\u30b9\u30c8\u5316\u3057\u305fgem\u3092\u4e00\u62ec\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ bundle install --path vendor/bundle\n\n// --------------------------\n// Serverspec \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n// --------------------------\n$ mkdir ~/sample/serverspec && cd $_\n\n// Gemfile\u3092\u4f5c\u6210\u3059\u308b\n$ bundle init\n\n// Gemfile\u3092\u7de8\u96c6\u3059\u308b\u3000\uff08\u30d2\u30a2\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u4f7f\u7528\uff09\n$ cat << EOS > Gemfile\nsource \"https://rubygems.org\"\n\ngem 'serverspec'\ngem 'rake'\nEOS\n\n// Gemfile \u306b\u30ea\u30b9\u30c8\u5316\u3057\u305fgem\u3092\u4e00\u62ec\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ bundle install --path vendor/bundle\n\n\n\nItamae\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u78ba\u8a8d\u3068\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u6e96\u5099\nItamae\u304c\u6b63\u5e38\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u51fa\u6765\u305f\u304b\u3069\u3046\u304b\u78ba\u8a8d\u3057\u3001\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u306b\u6cbf\u3063\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u7528\u610f\u3059\u308b\u3002\n\nCommand\n// Itamae\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u78ba\u8a8d\n$ cd ~/sample/itamae\n$ bundle exec itamae help\n\n$ mkdir cookbooks\n$ mkdir roles\n\n\n\nServerspec\u306e\u521d\u671f\u5316\nserverspec-init \u30b3\u30de\u30f3\u30c9\u3067\u69cb\u7bc9\u5bfe\u8c61\u306e\u30b7\u30b9\u30c6\u30e0\u306b\u95a2\u3059\u308b\u60c5\u5831\u3092\u5165\u529b\u3057\u3001\u521d\u671f\u5316\u64cd\u4f5c\u3092\u884c\u3046\u3002\n\u3053\u3053\u3067\u306f\u30ea\u30e2\u30fc\u30c8Linux\u3078ssh\u3067\u63a5\u7d9a\u3059\u308b\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\uff08Exec(Local)\u306b\u3064\u3044\u3066\u306f\u6587\u732e\u304c\u5c11\u306a\u304f\u4f7f\u7528\u65b9\u6cd5\u3092\u628a\u63e1\u3057\u304d\u308c\u3066\u3044\u306a\u3044\u3002\u3002\uff09\n\nCommand\n// Serverspec\u306e\u521d\u671f\u5316\n$ cd ~/sample/serverspec\n$ bundle exec serverspec-init\nSelect OS type:\n\n  1) UN*X\n  2) Windows\n\nSelect number: 1\n\nSelect a backend type:\n\n  1) SSH\n  2) Exec (local)\n\nSelect number: 1\n\nVagrant instance y/n: n\nInput target host name: web\n + spec/\n + spec/web/\n + spec/web/sample_spec.rb\n + spec/spec_helper.rb\n + Rakefile\n + .rspec\n\n\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\n\u7d50\u679c\u3001\u4f5c\u6210\u3055\u308c\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\uff08\u7565\uff09\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3002\n$ cd ~/sample\n$ tree . -L 2\n.\n\u251c\u2500\u2500 itamae\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Gemfile\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Gemfile.lock\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 cookbooks\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 roles\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 vendor\n\u2514\u2500\u2500 serverspec\n    \u251c\u2500\u2500 Gemfile\n    \u251c\u2500\u2500 Gemfile.lock\n    \u251c\u2500\u2500 Rakefile\n    \u251c\u2500\u2500 spec\n    \u2514\u2500\u2500 vendor\n\n\n\u52d5\u4f5c\u78ba\u8a8d\n\u3053\u308c\u3067 Itamae \u3068 Serverspec \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u51fa\u6765\u305f\u306e\u3067\u3001\u8a66\u3057\u306b\u30ea\u30e2\u30fc\u30c8\u30db\u30b9\u30c8\u306bhttpd\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u307f\u308b\u3002\n\u307e\u305a\u306f\u30b3\u30de\u30f3\u30c9\u3092\u697d\u306b\u3059\u308b\u305f\u3081\u306bssh\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\uff08\u672c\u984c\u3068\u306f\u5c11\u3057\u7570\u306a\u308b\u306e\u3067\u3055\u3089\u3063\u3068\u6d41\u3059\u3002\uff09\n\ncommand\n// Vagrant \u306e\u4ed6\u65b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078\u306e\u63a5\u7d9a\u8a2d\u5b9a\n$ cat << EOS > ~/.ssh/config\nHost web\n HostName 192.168.33.11\nEOS\n\n$ chmod 600 ~/.ssh/config\n$ ssh-keygen -t rsa\n$ ssh-copy-id web\n$ ssh web\n$ exit\n\n\n\u4e0b\u8a18\u3067Itamae\u3068Serverspec\u306e\u521d\u6b69\u7684\u306a\u4f7f\u7528\u3092\u3057\u3066\u307f\u308b\u3002\n\nCommand\n// --------------------------\n// Itamae / \u30ec\u30b7\u30d4\u4f5c\u6210\n// --------------------------\n// Itamae \u306e\u30ec\u30b7\u30d4\u3092\u4f5c\u6210\n$ echo \"package 'httpd'\" > ~/sample/itamae/cookbooks/recipe.rb\n\n// --------------------------\n// Serverspec / \u30c6\u30b9\u30c8\u3092\u4f5c\u6210\n// --------------------------\n// Serverspec\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n$ cat << EOS > ~/sample/serverspec/spec/web/httpd_spec.rb\nrequire 'spec_helper'\n\ndescribe package('httpd') do\n  it { should be_installed }\nend\nEOS\n\n// --------------------------\n// Itamae / \u30ec\u30b7\u30d4\u306e\u6b63\u5e38\u6027\u78ba\u8a8d\n// --------------------------\n// Itamae \u306e\u30c9\u30e9\u30a4\u30e9\u30f3\n$ cd ~/sample/itamae\n$ bundle exec itamae ssh -h web cookbooks/recipe.rb -n\n INFO : Starting Itamae...\n INFO : Recipe: /home/vagrant/sample/cookbooks/recipe.rb\n INFO :   package[httpd] installed will change from 'false' to 'true'\n\n// --------------------------\n// Serverspec / \u30a8\u30e9\u30fc\u30d1\u30bf\u30fc\u30f3\u306e\u52d5\u4f5c\u78ba\u8a8d\n// --------------------------\n// Serverspec\u306e\u30a8\u30e9\u30fc\u30d1\u30bf\u30fc\u30f3\n$ cd ~/sample/serverspec\n$ rm spec/web/sample_spec.rb\n$ bundle exec rake spec\n/home/vagrant/.rbenv/versions/2.2.6/bin/ruby -I/home/vagrant/sample/vendor/bundle/ruby/2.2.0/gems/rspec-core-3.5.4/lib:/home/vagrant/sample/vendor/bundle/ruby/2.2.0/gems/rspec-support-3.5.0/lib /home/vagrant/sample/vendor/bundle/ruby/2.2.0/gems/rspec-core-3.5.4/exe/rspec --pattern spec/web/\\*_spec.rb\n\nPackage \"httpd\"\n  should be installed (FAILED - 1)\n\nPackage \"httpd\"\n  should be installed (FAILED - 2)\n\nService \"httpd\"\n  should be enabled (FAILED - 3)\n  should be running (FAILED - 4)\n\nPort \"80\"\n  should be listening (FAILED - 5)\n\nFailures:\n\n  1) Package \"httpd\" should be installed\n     On host `web'\n     Failure/Error: it { should be_installed }\n       expected Package \"httpd\" to be installed\n       sudo -p 'Password: ' /bin/sh -c rpm\\ -q\\ httpd\n       package httpd is not installed\n\n     # ./spec/web/httpd_spec.rb:8:in `block (2 levels) in <top (required)>'\n\n  2) Package \"httpd\" should be installed\n     On host `web'\n     Failure/Error: it { should be_installed }\n       expected Package \"httpd\" to be installed\n       sudo -p 'Password: ' /bin/sh -c rpm\\ -q\\ httpd\n       package httpd is not installed\n\n     # ./spec/web/sample_spec.rb:4:in `block (2 levels) in <top (required)>'\n\n  3) Service \"httpd\" should be enabled\n     On host `web'\n     Failure/Error: it { should be_enabled }\n       expected Service \"httpd\" to be enabled\n       sudo -p 'Password: ' /bin/sh -c chkconfig\\ --list\\ httpd\\ \\|\\ grep\\ 3:on\n\n     # ./spec/web/sample_spec.rb:12:in `block (2 levels) in <top (required)>'\n\n  4) Service \"httpd\" should be running\n     On host `web'\n     Failure/Error: it { should be_running }\n       expected Service \"httpd\" to be running\n       sudo -p 'Password: ' /bin/sh -c ps\\ aux\\ \\|\\ grep\\ -w\\ --\\ httpd\\ \\|\\ grep\\ -qv\\ grep\n\n     # ./spec/web/sample_spec.rb:13:in `block (2 levels) in <top (required)>'\n\n  5) Port \"80\" should be listening\n     On host `web'\n     Failure/Error: it { should be_listening }\n       expected Port \"80\" to be listening\n       sudo -p 'Password: ' /bin/sh -c netstat\\ -tunl\\ \\|\\ grep\\ --\\ :80\\\\\\\n\n     # ./spec/web/sample_spec.rb:27:in `block (2 levels) in <top (required)>'\n\nFinished in 0.37589 seconds (files took 0.73406 seconds to load)\n5 examples, 5 failures\n\nFailed examples:\n\nrspec ./spec/web/httpd_spec.rb:8 # Package \"httpd\" should be installed\nrspec ./spec/web/sample_spec.rb:4 # Package \"httpd\" should be installed\nrspec ./spec/web/sample_spec.rb:12 # Service \"httpd\" should be enabled\nrspec ./spec/web/sample_spec.rb:13 # Service \"httpd\" should be running\nrspec ./spec/web/sample_spec.rb:27 # Port \"80\" should be listening\n\n/home/vagrant/.rbenv/versions/2.2.6/bin/ruby -I/home/vagrant/sample/vendor/bundle/ruby/2.2.0/gems/rspec-core-3.5.4/lib:/home/vagrant/sample/vendor/bundle/ruby/2.2.0/gems/rspec-support-3.5.0/lib /home/vagrant/sample/vendor/bundle/ruby/2.2.0/gems/rspec-core-3.5.4/exe/rspec --pattern spec/web/\\*_spec.rb failed\n\n// --------------------------\n// Itamae / httpd\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n// --------------------------\n// Itamae \u3092\u4f7f\u7528\u3057\u3066\u81ea\u52d5\u69cb\u7bc9\n$ cd ~/sample/itamae\n$ bundle exec itamae ssh -h web cookbooks/recipe.rb\n INFO : Starting Itamae...\n INFO : Recipe: /home/vagrant/sample/cookbooks/recipe.rb\n INFO :   package[httpd] installed will change from 'false' to 'true'\n\n// --------------------------\n// Serverspec / \u6b63\u5e38\u30d1\u30bf\u30fc\u30f3\u306e\u52d5\u4f5c\u78ba\u8a8d\n// --------------------------\n// Serverspec\u3092\u4f7f\u7528\u3057\u3066\u81ea\u52d5\u30c6\u30b9\u30c8\n$ cd ~/sample/serverspec\n$ bundle exec rake spec\n/home/vagrant/.rbenv/versions/2.2.6/bin/ruby -I/home/vagrant/sample/serverspec/vendor/bundle/ruby/2.2.0/gems/rspec-core-3.5.4/lib:/home/vagrant/sample/serverspec/vendor/bundle/ruby/2.2.0/gems/rspec-support-3.5.0/lib /home/vagrant/sample/serverspec/vendor/bundle/ruby/2.2.0/gems/rspec-core-3.5.4/exe/rspec --pattern spec/web/\\*_spec.rb\n\nPackage \"httpd\"\n  should be installed\n\nFinished in 0.52577 seconds (files took 0.30729 seconds to load)\n1 example, 0 failures\n\n\n\n\n\u30b7\u30e7\u30ed\u30ab\u30ec 1 \u65e5\u76ee | \u4ffa\u306e\u677f\u524d\u4fee\u696d\u65e5\u8a18 \u301c itamae \u3067\u30e6\u30fc\u30b6\u30fc\u3092\u8907\u6570\u306e\u30b0\u30eb\u30fc\u30d7\u306b\u6240\u5c5e\u3055\u305b\u308b\u30e1\u30e2 \u301c - \u3088\u3046\u3078\u3044\u306e\u65e5\u3005\u7cbe\u9032XP\n\n\u4ee5\u4e0a\u306e\u624b\u9806\u3067 Itame \u3068 Serverspec \u3092\u4f7f\u7528\u3059\u308b\u6e96\u5099\u304c\u51fa\u6765\u305f\u3002\n\u3042\u3068\u306f\u30d9\u30b9\u30c8\u30fb\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u306b\u6cbf\u3063\u305f\u69cb\u6210\u3092\u610f\u8b58\u3057\u306a\u304c\u3089\u3001 Serverspec\u3067\u671f\u5f85\u69cb\u6210\u306e\u8a18\u8f09 \u21e2 Itamae\u3067\u81ea\u52d5\u69cb\u6210 \u3092\u7e70\u308a\u8fd4\u3057\u3066\u30a4\u30f3\u30d5\u30e9\u306eTDD\u3092\u5b9f\u884c\u3057\u3066\u3044\u304f\u3053\u3068\u304c\u51fa\u6765\u308b\u3002\n\nrbenv-build \u306b\u95a2\u3059\u308b\u65e5\u672c\u8a9e\u6587\u732e\u304c\u5c11\u306a\u304f\u306a\u304b\u306a\u304b\u7406\u89e3\u3057\u304d\u308c\u3066\u3044\u306a\u3044\u3002\n\nGitHub : rbenv-build\n\n\n\nruby-build is an rbenv plugin that provides an rbenv install command to compile and install different versions of Ruby on UNIX-like systems.\nYou can also use ruby-build without rbenv in environments where you need precise control over Ruby version installation.\n\u5f15\u7528 : ruby-build - GitHub\n\n# **\u306f\u3058\u3081\u306b**\n\n\u4e0b\u8a18\u306e\u8a18\u4e8b\u3067 Ruby \u3092\u53d6\u308a\u5dfb\u304f\u57fa\u672c\u7684\u306a\u8a00\u8449\u306b\u3064\u3044\u3066\u6574\u7406\u3057\u305f\u3002\n\n* [Ruby\u899a\u66f8 - Ruby / RubyGem / rvm / rbenv / Bundler](http://qiita.com/udein/items/3f35fb98b0f9e023475c)\n\n\u672c\u7a3f\u306f\u305d\u308c\u306b\u7d9a\u304d\u3001\u30e1\u30a4\u30f3\u3068\u306a\u308b **Itamae** \u3068 **Serverspec** \u3092\u4f7f\u7528\u3057\u305f\u81ea\u52d5\u69cb\u6210\u7ba1\u7406\u306e\u5c0e\u5165\u306b\u95a2\u3059\u308b\u74b0\u5883\u69cb\u7bc9\u306e\u624b\u9806\u306b\u3064\u3044\u3066\u8a18\u8f09\u3059\u308b\u3002\n\n# **\u524d\u63d0\u6761\u4ef6**\n\n\u672c\u7a3f\u306e\u4f5c\u6210\u306b\u3042\u305f\u308a\u3001\u4e0b\u8a18\u306e\u4f5c\u696d\u74b0\u5883\u304a\u3088\u3073\u69cb\u7bc9\u74b0\u5883\u3092\u524d\u63d0\u3068\u3059\u308b\u3002\n\n## **\u4f5c\u696d\u74b0\u5883**\n\n\u672c\u8a18\u4e8b\u306e\u4f5c\u6210\u306b\u3042\u305f\u308a\u4f7f\u7528\u3057\u305f\u4f5c\u696d\u74b0\u5883\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3002\n\n|\u9805\u76ee|\u5185\u5bb9|\u30d0\u30fc\u30b8\u30e7\u30f3|\n|:--|:--|:--|\n|OS|macOS|Sierra 10.12.3|\n|VM|VirtualBox|5.1.14 r112924|\n|\u305d\u306e\u4ed6|Vagrant|1.8.7|\n\n## **\u69cb\u7bc9\u74b0\u5883**\n\n\u672c\u8a18\u4e8b\u304c\u69cb\u7bc9\u5bfe\u8c61\u3068\u3059\u308b\u30b7\u30b9\u30c6\u30e0\u306e\u4e3b\u8981\u306a\u30bd\u30d5\u30c8\u306e\u69cb\u6210\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3002\n\n|\u9805\u76ee|\u5185\u5bb9|\u30d0\u30fc\u30b8\u30e7\u30f3|\u30db\u30b9\u30c8 A|\u30db\u30b9\u30c8 B|\n|:--|:--|:--|:--|:--|\n|OS|bento/centos-6.8|-|\u25cb|\u25cb|\n|S/W|rbenv|1.1.0-2-g4f8925a|\u25cb|-|\n|S/W|ruby-build|-|\u25cb|-|\n|S/W|Bundler|version 1.14.6|\u25cb|-|\n|S/W|Itamae|v1.9.10|\u25cb|-|\n|S/W|Serverspec|2.38.0|\u25cb|-|\n\nVagrant \u306e Box \u306e\u69cb\u6210\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3002\n\n```bash:Vagrant\n  # config.vm.box = \"bento/centos-6.8\"\n  config.vm.define \"host\" do |node|\n    node.vm.box = \"bento/centos-6.8\"\n    node.vm.hostname = \"host\"\n    node.vm.network :private_network, ip: \"192.168.33.10\"\n  end\n  config.vm.define \"web\" do |node|\n    node.vm.box = \"bento/centos-6.8\"\n    node.vm.hostname = \"web\"\n    node.vm.network :private_network, ip: \"192.168.33.11\"\n  end\n```\n\n\n# **\u69cb\u7bc9\u624b\u9806**\n\n## **1. Ruby\u306e\u5c0e\u5165**\n\nrbenv\u3092\u4f7f\u7528\u3057\u305fRuby\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\u306e\u6982\u8981\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3002\n\n1. Ruby\u306e\u30d3\u30eb\u30c9\u74b0\u5883\uff08gcc\u306a\u3069\uff09\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n2. **rbenv** + **rbenv-build** \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n3. **.bash_profile** \u306bPATH\u3092\u901a\u3057\u3066\u8a2d\u5b9a\u3092\u9069\u7528\n4. **Ruby** \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u4e00\u89a7\u306e\u78ba\u8a8d\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n5. **rbenv global** \u3067\u74b0\u5883\u5168\u4f53\u306b\u8a2d\u5b9a\u3092\u9069\u7528\n\n\u672c\u624b\u9806\u306b\u95a2\u3059\u308b\u8a73\u7d30\u306a\u30b3\u30de\u30f3\u30c9\u306b\u3064\u3044\u3066\u306f\u4e0b\u8a18\u304c\u8a73\u3057\u3044\u3002\n\n* [rbenv \u3092\u5229\u7528\u3057\u305f Ruby \u74b0\u5883\u306e\u69cb\u7bc9 - Developers.IO](http://dev.classmethod.jp/server-side/language/build-ruby-environment-by-rbenv/)\n\n## **2. Bundler**\n\n### **\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb**\n\n```console:Command\n// Bundle\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ gem install bundler\n\n// bundler \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\n$ bundler -v\nBundler version 1.14.6\n```\n\n### **\u4f7f\u7528\u65b9\u6cd5**\n\n**bundler** \u306e\u57fa\u672c\u7684\u306a\u4f7f\u7528\u65b9\u6cd5\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3002\n\n1. **Gemfile** \u3092\u4f5c\u6210\u3059\u308b\n2. \u4f7f\u7528\u3057\u305f\u3044 **gem** \u3092 **Gemfile** \u306b\u8a18\u8ff0\u3059\u308b\n3. **Gemfile** \u306b\u30ea\u30b9\u30c8\u5316\u3057\u305fgem\u3092\u4e00\u62ec\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n4. \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fgem\u3092\u30d7\u30ed\u30b0\u30e9\u30e0\u30bd\u30fc\u30b9\u4e0a\u3067\u30ed\u30fc\u30c9\n5. **bundle exec** \u3092\u6700\u521d\u306b\u3064\u3051\u3066\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\n\n\u30b3\u30de\u30f3\u30c9\u4f8b\u3092\u4e0b\u8a18\u306b\u8a18\u3059\u3002\n\n```console:Command\n// 1. Gemfile \u3092\u4f5c\u6210\u3059\u308b\n$ bundle init\n\n// 2. Gemfile \u306b\u4f7f\u7528\u3057\u305f\u3044gem\u3092\u8a18\u8ff0\u3059\u308b\n$ vim Gemfile\n\n// 3. Gemfile \u306b\u30ea\u30b9\u30c8\u5316\u3057\u305fgem\u3092\u4e00\u62ec\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ bundle install --path vendor/bundle\n\n// 4. bundle exec \u3092\u6700\u521d\u306b\u3064\u3051\u3066\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\uff08\u4e0b\u8a18\u306f\u4e00\u4f8b\uff09\n$ bundle exec ruby foo.rb\n```\n\n## **3. Itamae \u3068 Serverspec**\n\n### **\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210**\n\n\u305d\u308c\u305e\u308c\u306b\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3068\u306a\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\u304c\u3042\u308b\u3002\n\n#### Itamae\n\n```\n.\n\u251c\u2500\u2500 cookbooks\n\u2502   \u2514\u2500\u2500 nginx\n\u2502       \u251c\u2500\u2500 default.rb\n\u2502       \u251c\u2500\u2500 files\n\u2502       \u2502   \u2514\u2500\u2500 etc\n\u2502       \u2502       \u2514\u2500\u2500 nginx\n\u2502       \u2502           \u2514\u2500\u2500 conf.d\n\u2502       \u2502               \u2514\u2500\u2500 static.conf\n\u2502       \u2514\u2500\u2500 templates\n\u2502           \u2514\u2500\u2500 etc\n\u2502               \u2514\u2500\u2500 nginx\n\u2502                   \u2514\u2500\u2500 conf.d\n\u2502                       \u2514\u2500\u2500 dynamic.conf\n\u2514\u2500\u2500 roles\n    \u2514\u2500\u2500 web.rb\n```\n\n[Best Practice \u00b7 itamae-kitchen/itamae Wiki \u00b7 GitHub](https://github.com/itamae-kitchen/itamae/wiki/Best-Practice)\n\n#### Serverspec\n\n```\n.\n\u251c\u2500\u2500 Rakefile\n\u251c\u2500\u2500 spec\n\u2502          \u251c\u2500\u2500 ap\n\u2502          \u2502        \u251c\u2500\u2500 mysqlclient_spec.rb\n\u2502          \u2502        \u251c\u2500\u2500 nodejs_spec.rb\n\u2502          \u2502        \u251c\u2500\u2500 rvm_spec.rb\n\u2502          \u2502        \u2514\u2500\u2500 sqlite_spec.rb\n\u2502          \u251c\u2500\u2500 base\n\u2502          \u2502        \u251c\u2500\u2500 build-essential_spec.rb\n\u2502          \u2502        \u2514\u2500\u2500 git_spec.rb\n\u2502          \u251c\u2500\u2500 db\n\u2502          \u2502        \u2514\u2500\u2500 mysql_spec.rb\n\u2502          \u2514\u2500\u2500 spec_helper.rb\n```\n\n[ ap / base/ db ] \u306f\u30db\u30b9\u30c8\u540d\u3002\n\n[[Serverspec]Serverspec\u306e\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3092\u30ed\u30fc\u30eb\u5358\u4f4d\u3067\u7ba1\u7406\u3059\u308b - \u57ce\u967d\u4eba\u306e\u672c\u68da](http://d.hatena.ne.jp/minamijoyo/20150225/p1)\n\n### **\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb**\n\n\u524d\u8ff0\u306e\u60c5\u5831\u3092\u53c2\u8003\u306b\u3001\u5b9f\u969b\u306b **Itamae** \u3068 **Serverspec** \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\n```console:Command\n// \u4efb\u610f\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30d5\u30a9\u30eb\u30c0\u3092\u4f5c\u6210\u3059\u308b\n$ mkdir ~/sample && cd $_\n\n// --------------------------\n// Itamae \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n// --------------------------\n$ mkdir ~/sample/itamae && cd $_\n\n// Gemfile\u3092\u4f5c\u6210\u3059\u308b\n$ bundle init\n\n// Gemfile\u3092\u7de8\u96c6\u3059\u308b\u3002\uff08\u30d2\u30a2\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u4f7f\u7528\uff09\n$ cat << EOS > Gemfile\nsource \"https://rubygems.org\"\n\ngem 'itamae'\ngem 'thor', \"0.19.1\"\ngem 'rake'\nEOS\n\n// Gemfile \u306b\u30ea\u30b9\u30c8\u5316\u3057\u305fgem\u3092\u4e00\u62ec\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ bundle install --path vendor/bundle\n\n// --------------------------\n// Serverspec \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n// --------------------------\n$ mkdir ~/sample/serverspec && cd $_\n\n// Gemfile\u3092\u4f5c\u6210\u3059\u308b\n$ bundle init\n\n// Gemfile\u3092\u7de8\u96c6\u3059\u308b\u3000\uff08\u30d2\u30a2\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u4f7f\u7528\uff09\n$ cat << EOS > Gemfile\nsource \"https://rubygems.org\"\n\ngem 'serverspec'\ngem 'rake'\nEOS\n\n// Gemfile \u306b\u30ea\u30b9\u30c8\u5316\u3057\u305fgem\u3092\u4e00\u62ec\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ bundle install --path vendor/bundle\n```\n\n#### Itamae\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u78ba\u8a8d\u3068\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u6e96\u5099\n\nItamae\u304c\u6b63\u5e38\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u51fa\u6765\u305f\u304b\u3069\u3046\u304b\u78ba\u8a8d\u3057\u3001\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u306b\u6cbf\u3063\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u7528\u610f\u3059\u308b\u3002\n\n```console:Command\n// Itamae\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u78ba\u8a8d\n$ cd ~/sample/itamae\n$ bundle exec itamae help\n\n$ mkdir cookbooks\n$ mkdir roles\n```\n\n#### Serverspec\u306e\u521d\u671f\u5316\n\nserverspec-init \u30b3\u30de\u30f3\u30c9\u3067\u69cb\u7bc9\u5bfe\u8c61\u306e\u30b7\u30b9\u30c6\u30e0\u306b\u95a2\u3059\u308b\u60c5\u5831\u3092\u5165\u529b\u3057\u3001\u521d\u671f\u5316\u64cd\u4f5c\u3092\u884c\u3046\u3002\n\u3053\u3053\u3067\u306f\u30ea\u30e2\u30fc\u30c8Linux\u3078ssh\u3067\u63a5\u7d9a\u3059\u308b\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\uff08Exec(Local)\u306b\u3064\u3044\u3066\u306f\u6587\u732e\u304c\u5c11\u306a\u304f\u4f7f\u7528\u65b9\u6cd5\u3092\u628a\u63e1\u3057\u304d\u308c\u3066\u3044\u306a\u3044\u3002\u3002\uff09\n\n```console:Command\n// Serverspec\u306e\u521d\u671f\u5316\n$ cd ~/sample/serverspec\n$ bundle exec serverspec-init\nSelect OS type:\n\n  1) UN*X\n  2) Windows\n\nSelect number: 1\n\nSelect a backend type:\n\n  1) SSH\n  2) Exec (local)\n\nSelect number: 1\n\nVagrant instance y/n: n\nInput target host name: web\n + spec/\n + spec/web/\n + spec/web/sample_spec.rb\n + spec/spec_helper.rb\n + Rakefile\n + .rspec\n```\n\n#### \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\n\n\u7d50\u679c\u3001\u4f5c\u6210\u3055\u308c\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\uff08\u7565\uff09\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3002\n\n```\n$ cd ~/sample\n$ tree . -L 2\n.\n\u251c\u2500\u2500 itamae\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Gemfile\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Gemfile.lock\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 cookbooks\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 roles\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 vendor\n\u2514\u2500\u2500 serverspec\n    \u251c\u2500\u2500 Gemfile\n    \u251c\u2500\u2500 Gemfile.lock\n    \u251c\u2500\u2500 Rakefile\n    \u251c\u2500\u2500 spec\n    \u2514\u2500\u2500 vendor\n```\n\n#### \u52d5\u4f5c\u78ba\u8a8d\n\n\u3053\u308c\u3067 Itamae \u3068 Serverspec \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u51fa\u6765\u305f\u306e\u3067\u3001\u8a66\u3057\u306b\u30ea\u30e2\u30fc\u30c8\u30db\u30b9\u30c8\u306bhttpd\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u307f\u308b\u3002\n\n\u307e\u305a\u306f\u30b3\u30de\u30f3\u30c9\u3092\u697d\u306b\u3059\u308b\u305f\u3081\u306bssh\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\uff08\u672c\u984c\u3068\u306f\u5c11\u3057\u7570\u306a\u308b\u306e\u3067\u3055\u3089\u3063\u3068\u6d41\u3059\u3002\uff09\n\n```console:command\n// Vagrant \u306e\u4ed6\u65b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078\u306e\u63a5\u7d9a\u8a2d\u5b9a\n$ cat << EOS > ~/.ssh/config\nHost web\n HostName 192.168.33.11\nEOS\n\n$ chmod 600 ~/.ssh/config\n$ ssh-keygen -t rsa\n$ ssh-copy-id web\n$ ssh web\n$ exit\n```\n\n\u4e0b\u8a18\u3067Itamae\u3068Serverspec\u306e\u521d\u6b69\u7684\u306a\u4f7f\u7528\u3092\u3057\u3066\u307f\u308b\u3002\n\n```console:Command\n// --------------------------\n// Itamae / \u30ec\u30b7\u30d4\u4f5c\u6210\n// --------------------------\n// Itamae \u306e\u30ec\u30b7\u30d4\u3092\u4f5c\u6210\n$ echo \"package 'httpd'\" > ~/sample/itamae/cookbooks/recipe.rb\n\n// --------------------------\n// Serverspec / \u30c6\u30b9\u30c8\u3092\u4f5c\u6210\n// --------------------------\n// Serverspec\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n$ cat << EOS > ~/sample/serverspec/spec/web/httpd_spec.rb\nrequire 'spec_helper'\n\ndescribe package('httpd') do\n  it { should be_installed }\nend\nEOS\n\n// --------------------------\n// Itamae / \u30ec\u30b7\u30d4\u306e\u6b63\u5e38\u6027\u78ba\u8a8d\n// --------------------------\n// Itamae \u306e\u30c9\u30e9\u30a4\u30e9\u30f3\n$ cd ~/sample/itamae\n$ bundle exec itamae ssh -h web cookbooks/recipe.rb -n\n INFO : Starting Itamae...\n INFO : Recipe: /home/vagrant/sample/cookbooks/recipe.rb\n INFO :   package[httpd] installed will change from 'false' to 'true'\n\n// --------------------------\n// Serverspec / \u30a8\u30e9\u30fc\u30d1\u30bf\u30fc\u30f3\u306e\u52d5\u4f5c\u78ba\u8a8d\n// --------------------------\n// Serverspec\u306e\u30a8\u30e9\u30fc\u30d1\u30bf\u30fc\u30f3\n$ cd ~/sample/serverspec\n$ rm spec/web/sample_spec.rb\n$ bundle exec rake spec\n/home/vagrant/.rbenv/versions/2.2.6/bin/ruby -I/home/vagrant/sample/vendor/bundle/ruby/2.2.0/gems/rspec-core-3.5.4/lib:/home/vagrant/sample/vendor/bundle/ruby/2.2.0/gems/rspec-support-3.5.0/lib /home/vagrant/sample/vendor/bundle/ruby/2.2.0/gems/rspec-core-3.5.4/exe/rspec --pattern spec/web/\\*_spec.rb\n\nPackage \"httpd\"\n  should be installed (FAILED - 1)\n\nPackage \"httpd\"\n  should be installed (FAILED - 2)\n\nService \"httpd\"\n  should be enabled (FAILED - 3)\n  should be running (FAILED - 4)\n\nPort \"80\"\n  should be listening (FAILED - 5)\n\nFailures:\n\n  1) Package \"httpd\" should be installed\n     On host `web'\n     Failure/Error: it { should be_installed }\n       expected Package \"httpd\" to be installed\n       sudo -p 'Password: ' /bin/sh -c rpm\\ -q\\ httpd\n       package httpd is not installed\n\n     # ./spec/web/httpd_spec.rb:8:in `block (2 levels) in <top (required)>'\n\n  2) Package \"httpd\" should be installed\n     On host `web'\n     Failure/Error: it { should be_installed }\n       expected Package \"httpd\" to be installed\n       sudo -p 'Password: ' /bin/sh -c rpm\\ -q\\ httpd\n       package httpd is not installed\n\n     # ./spec/web/sample_spec.rb:4:in `block (2 levels) in <top (required)>'\n\n  3) Service \"httpd\" should be enabled\n     On host `web'\n     Failure/Error: it { should be_enabled }\n       expected Service \"httpd\" to be enabled\n       sudo -p 'Password: ' /bin/sh -c chkconfig\\ --list\\ httpd\\ \\|\\ grep\\ 3:on\n\n     # ./spec/web/sample_spec.rb:12:in `block (2 levels) in <top (required)>'\n\n  4) Service \"httpd\" should be running\n     On host `web'\n     Failure/Error: it { should be_running }\n       expected Service \"httpd\" to be running\n       sudo -p 'Password: ' /bin/sh -c ps\\ aux\\ \\|\\ grep\\ -w\\ --\\ httpd\\ \\|\\ grep\\ -qv\\ grep\n\n     # ./spec/web/sample_spec.rb:13:in `block (2 levels) in <top (required)>'\n\n  5) Port \"80\" should be listening\n     On host `web'\n     Failure/Error: it { should be_listening }\n       expected Port \"80\" to be listening\n       sudo -p 'Password: ' /bin/sh -c netstat\\ -tunl\\ \\|\\ grep\\ --\\ :80\\\\\\\n\n     # ./spec/web/sample_spec.rb:27:in `block (2 levels) in <top (required)>'\n\nFinished in 0.37589 seconds (files took 0.73406 seconds to load)\n5 examples, 5 failures\n\nFailed examples:\n\nrspec ./spec/web/httpd_spec.rb:8 # Package \"httpd\" should be installed\nrspec ./spec/web/sample_spec.rb:4 # Package \"httpd\" should be installed\nrspec ./spec/web/sample_spec.rb:12 # Service \"httpd\" should be enabled\nrspec ./spec/web/sample_spec.rb:13 # Service \"httpd\" should be running\nrspec ./spec/web/sample_spec.rb:27 # Port \"80\" should be listening\n\n/home/vagrant/.rbenv/versions/2.2.6/bin/ruby -I/home/vagrant/sample/vendor/bundle/ruby/2.2.0/gems/rspec-core-3.5.4/lib:/home/vagrant/sample/vendor/bundle/ruby/2.2.0/gems/rspec-support-3.5.0/lib /home/vagrant/sample/vendor/bundle/ruby/2.2.0/gems/rspec-core-3.5.4/exe/rspec --pattern spec/web/\\*_spec.rb failed\n\n// --------------------------\n// Itamae / httpd\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n// --------------------------\n// Itamae \u3092\u4f7f\u7528\u3057\u3066\u81ea\u52d5\u69cb\u7bc9\n$ cd ~/sample/itamae\n$ bundle exec itamae ssh -h web cookbooks/recipe.rb\n INFO : Starting Itamae...\n INFO : Recipe: /home/vagrant/sample/cookbooks/recipe.rb\n INFO :   package[httpd] installed will change from 'false' to 'true'\n\n// --------------------------\n// Serverspec / \u6b63\u5e38\u30d1\u30bf\u30fc\u30f3\u306e\u52d5\u4f5c\u78ba\u8a8d\n// --------------------------\n// Serverspec\u3092\u4f7f\u7528\u3057\u3066\u81ea\u52d5\u30c6\u30b9\u30c8\n$ cd ~/sample/serverspec\n$ bundle exec rake spec\n/home/vagrant/.rbenv/versions/2.2.6/bin/ruby -I/home/vagrant/sample/serverspec/vendor/bundle/ruby/2.2.0/gems/rspec-core-3.5.4/lib:/home/vagrant/sample/serverspec/vendor/bundle/ruby/2.2.0/gems/rspec-support-3.5.0/lib /home/vagrant/sample/serverspec/vendor/bundle/ruby/2.2.0/gems/rspec-core-3.5.4/exe/rspec --pattern spec/web/\\*_spec.rb\n\nPackage \"httpd\"\n  should be installed\n\nFinished in 0.52577 seconds (files took 0.30729 seconds to load)\n1 example, 0 failures\n\n```\n\n* [\u30b7\u30e7\u30ed\u30ab\u30ec 1 \u65e5\u76ee | \u4ffa\u306e\u677f\u524d\u4fee\u696d\u65e5\u8a18 \u301c itamae \u3067\u30e6\u30fc\u30b6\u30fc\u3092\u8907\u6570\u306e\u30b0\u30eb\u30fc\u30d7\u306b\u6240\u5c5e\u3055\u305b\u308b\u30e1\u30e2 \u301c - \u3088\u3046\u3078\u3044\u306e\u65e5\u3005\u7cbe\u9032XP](http://inokara.hateblo.jp/category/serverspec)\n\n\u4ee5\u4e0a\u306e\u624b\u9806\u3067 **Itame** \u3068 **Serverspec** \u3092\u4f7f\u7528\u3059\u308b\u6e96\u5099\u304c\u51fa\u6765\u305f\u3002\n\u3042\u3068\u306f\u30d9\u30b9\u30c8\u30fb\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u306b\u6cbf\u3063\u305f\u69cb\u6210\u3092\u610f\u8b58\u3057\u306a\u304c\u3089\u3001 **Serverspec\u3067\u671f\u5f85\u69cb\u6210\u306e\u8a18\u8f09** \u21e2 **Itamae\u3067\u81ea\u52d5\u69cb\u6210** \u3092\u7e70\u308a\u8fd4\u3057\u3066\u30a4\u30f3\u30d5\u30e9\u306eTDD\u3092\u5b9f\u884c\u3057\u3066\u3044\u304f\u3053\u3068\u304c\u51fa\u6765\u308b\u3002\n\n\n---\n\n**rbenv-build** \u306b\u95a2\u3059\u308b\u65e5\u672c\u8a9e\u6587\u732e\u304c\u5c11\u306a\u304f\u306a\u304b\u306a\u304b\u7406\u89e3\u3057\u304d\u308c\u3066\u3044\u306a\u3044\u3002\n\n* GitHub : [rbenv-build](https://github.com/rbenv/ruby-build)\n\n> ruby-build is an rbenv plugin that provides an rbenv install command to compile and install different versions of Ruby on UNIX-like systems.\n>\n> You can also use ruby-build without rbenv in environments where you need precise control over Ruby version installation.\n\u5f15\u7528 : [ruby-build - GitHub](https://github.com/rbenv/ruby-build#ruby-build)\n\n", "tags": ["bundler", "itamae", "serverspec"]}