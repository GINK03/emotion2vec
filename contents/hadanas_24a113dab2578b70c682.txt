{"context": "\u6708\u3005\u306e\u96fb\u529b\u4f7f\u7528\u91cf\u306f\u8acb\u6c42\u66f8\u3092\u898b\u308c\u3070\u308f\u304b\u308b\u3051\u308c\u3069\u3001\u300c\u3069\u306e\u6a5f\u5668\u304c\u6d88\u8cbb\u3057\u3066\u3044\u308b\u306e\u304b\u300d\u300c\u30d4\u30fc\u30af\u4f7f\u7528\u91cf\u306f\u3069\u306e\u304f\u3089\u3044\u304b\u300d\u306a\u3069\u898b\u3066\u307f\u305f\u304b\u3063\u305f\u306e\u3068\u3001\u96fb\u529b\u4f1a\u793e\u3084\u6599\u91d1\u30d7\u30e9\u30f3\u9078\u3073\u306e\u53c2\u8003\u306b\u306a\u308c\u3070\u3063\u3066\u3053\u3068\u3067\u3002\n\n\u4f7f\u3063\u305f\u3082\u306e\n\n\n\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\n\nRaspberry Pi 3\nWi-SUN USB\u30c9\u30f3\u30b0\u30eb\n\n\n\n\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\n\nGrafana\nInfluxDB\nGo\n\n\n\n\u53c2\u8003\u306b\u3057\u305f\u8a18\u4e8b\n\n\u30b9\u30de\u30fc\u30c8\u30e1\u30fc\u30bf\u30fc\u306e\u60c5\u5831\u3092\u6700\u5b89\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u3067\u5f15\u3063\u3053\u629c\u304f\n\n\n\n\n\u624b\u9806\n\u4e0b\u6e96\u5099\u306f\u53c2\u8003\u8a18\u4e8b\u306e\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u6e96\u5099\u3068\u540c\u3058\u3067\u3059\u3002\n\n\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nGo\ngolang-1.7-src_1.7.1-2_armhf.deb\ngolang-1.7-go_1.7.1-2_armhf.deb\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3089 path \u3092\u901a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n$ export PATH=${PATH}:/usr/lib/go-1.7/bin\n$ export GOROOT=/usr/lib/go-1.7\n\n\u30d3\u30eb\u30c9\u30c4\u30fc\u30eb\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n$ export GOPATH=~/.go\n$ go get github.com/constabulary/gb/...\n$ go get github.com/constabulary/gb/cmd/gb-vendor\n\n\nInfluxDB\ninfluxdb_1.0.0-1_armhf.deb\n\nGrafana\ngrafana_3.1.1-1470786449_armhf.deb\n\n\u30d3\u30eb\u30c9\n\u30bd\u30fc\u30b9\u306f github \u3067\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002\n$ git clone https://github.com/hadanas/smartmeter.git\n\n$ cd smartmeter\n\n$ gb vendor restore\n\n$ pushd vendor/src/golang.org/x/sys/unix\n$ chmod +x *.sh *.pl\n$ GOOS=linux GOARCH=arm ./mkall.sh\n$ popd\n\n$ gb build\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo install bin/smartmeter /usr/local/bin/smartmeter\n$ sudo install smartmeter.conf /etc/smartmeter.conf\n\n\n\u8a2d\u5b9a\n\nInfluxDB\nudp\u30bb\u30af\u30b7\u30e7\u30f3\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n/etc/influxdb/influxdb.conf\n[[udp]]\n  enabled = true\n  bind-address = \"127.0.0.1:8089\"\n  database = \"wattmeter\"\n\n\n\nsystemd\n\n/lib/systemd/system/smartmeter.service\n[Unit]\nDescription=Smartmeter\nAfter=influxdb.service\n\n[Service]\nExecStart=/usr/local/bin/smartmeter -c /etc/smartmeter.conf\nWorkingDirectory=/var/lib/smartmeter\nRestart=always\nType=simple\nUser=smartmeter\nGroup=smartmeter\n\n[Install]\nWantedBy=multi-user.target\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u3044\u305f\u3089systemd\u306b\u53cd\u6620\u3055\u305b\u307e\u3059\u3002\n$ systemctl daemon-reload\n\n\nsmartmeter\nB\u30eb\u30fc\u30c8\u306eID\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n/etc/smartmeter.conf\n[routeb]\nid = \"00000000000000000000000000000000\"\npassword = \"************\"\n\n\n\n\u8d77\u52d5\n\u8a2d\u5b9a\u304c\u7d42\u308f\u3063\u305f\u3089\u3001\u8d77\u52d5\u3057\u307e\u3059\u3002\n# systemctl start influxdb\n# systemctl start smartmeter\n# systemctl start grafana-server\n\nGrafana\u306b\u30b0\u30e9\u30d5\u3092\u66f8\u304b\u305b\u308b\u3068\u3053\u308d\u306e\u8aac\u660e\u306f\u5272\u611b  \nWatt, WattHour\u306b\u305d\u308c\u305e\u308c\u96fb\u529b\u3001\u96fb\u529b\u91cf\u306e\u5024\u304c\u5165\u3063\u3066\u3044\u307e\u3059\u3002\n$ influx\nVisit https://enterprise.influxdata.com to register for updates, InfluxDB server management, and monitoring.\nConnected to http://localhost:8086 version 1.0.0\nInfluxDB shell version: 1.0.0\n> use wattmeter\nUsing database wattmeter\n> show measurements\nname: measurements\n------------------\nname\nWatt\nWattHour\n\n> select * from Watt limit 1\nname: Watt\n----------\ntime            watt\n1472351032206787174 292\n\n> select * from WattHour limit 1\nname: WattHour\n--------------\ntime            watthour\n1472351400000000000 3074.8\n\n\u30d6\u30e9\u30a6\u30b6\u3067\u8868\u793a\u3055\u305b\u305f\u3068\u3053\u308d\n\nRaspberry PI \u3060\u3068\u3053\u3093\u306a\u611f\u3058\u3002\n\n\u6708\u3005\u306e\u96fb\u529b\u4f7f\u7528\u91cf\u306f\u8acb\u6c42\u66f8\u3092\u898b\u308c\u3070\u308f\u304b\u308b\u3051\u308c\u3069\u3001\u300c\u3069\u306e\u6a5f\u5668\u304c\u6d88\u8cbb\u3057\u3066\u3044\u308b\u306e\u304b\u300d\u300c\u30d4\u30fc\u30af\u4f7f\u7528\u91cf\u306f\u3069\u306e\u304f\u3089\u3044\u304b\u300d\u306a\u3069\u898b\u3066\u307f\u305f\u304b\u3063\u305f\u306e\u3068\u3001\u96fb\u529b\u4f1a\u793e\u3084\u6599\u91d1\u30d7\u30e9\u30f3\u9078\u3073\u306e\u53c2\u8003\u306b\u306a\u308c\u3070\u3063\u3066\u3053\u3068\u3067\u3002\n\n# \u4f7f\u3063\u305f\u3082\u306e\n\n* \u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\n * [Raspberry Pi 3](https://www.raspberrypi.org/products/raspberry-pi-3-model-b/)\n * [Wi-SUN USB\u30c9\u30f3\u30b0\u30eb](https://www.amazon.co.jp/gp/product/B01FLAP3FK/)\n\n* \u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\n * [Grafana](http://grafana.org)\n * [InfluxDB](https://www.influxdata.com/time-series-platform/influxdb/)\n * [Go](https://golang.org)\n\n* \u53c2\u8003\u306b\u3057\u305f\u8a18\u4e8b\n * [\u30b9\u30de\u30fc\u30c8\u30e1\u30fc\u30bf\u30fc\u306e\u60c5\u5831\u3092\u6700\u5b89\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u3067\u5f15\u3063\u3053\u629c\u304f](http://qiita.com/rukihena/items/82266ed3a43e4b652adb)\n\n# \u624b\u9806\n\n\u4e0b\u6e96\u5099\u306f[\u53c2\u8003\u8a18\u4e8b](http://qiita.com/rukihena/items/82266ed3a43e4b652adb)\u306e\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u6e96\u5099\u3068\u540c\u3058\u3067\u3059\u3002\n\n## \u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n### Go\n[golang-1.7-src_1.7.1-2_armhf.deb](http://ftp.jp.debian.org/debian/pool/main/g/golang-1.7/golang-1.7-src_1.7.1-2_armhf.deb)\n[golang-1.7-go_1.7.1-2_armhf.deb](http://ftp.jp.debian.org/debian/pool/main/g/golang-1.7/golang-1.7-go_1.7.1-2_armhf.deb)\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3089 path \u3092\u901a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n$ export PATH=${PATH}:/usr/lib/go-1.7/bin\n$ export GOROOT=/usr/lib/go-1.7\n```\n\n\u30d3\u30eb\u30c9\u30c4\u30fc\u30eb\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n$ export GOPATH=~/.go\n$ go get github.com/constabulary/gb/...\n$ go get github.com/constabulary/gb/cmd/gb-vendor\n```\n\n##### InfluxDB\n[influxdb_1.0.0-1_armhf.deb](https://repos.influxdata.com/debian/pool/stable/i/influxdb/influxdb_1.0.0-1_armhf.deb)\n\n##### Grafana\n[grafana_3.1.1-1470786449_armhf.deb](https://github.com/fg2it/grafana-on-raspberry/blob/master/jessie/v3.1.1/grafana_3.1.1-1470786449_armhf.deb)\n\n\n## \u30d3\u30eb\u30c9\n\u30bd\u30fc\u30b9\u306f [github](https://github.com/hadanas/smartmeter) \u3067\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002\n\n```\n$ git clone https://github.com/hadanas/smartmeter.git\n\n$ cd smartmeter\n\n$ gb vendor restore\n\n$ pushd vendor/src/golang.org/x/sys/unix\n$ chmod +x *.sh *.pl\n$ GOOS=linux GOARCH=arm ./mkall.sh\n$ popd\n\n$ gb build\n```\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n$ sudo install bin/smartmeter /usr/local/bin/smartmeter\n$ sudo install smartmeter.conf /etc/smartmeter.conf\n```\n\n## \u8a2d\u5b9a\n\n##### InfluxDB\nudp\u30bb\u30af\u30b7\u30e7\u30f3\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n```/etc/influxdb/influxdb.conf\n[[udp]]\n  enabled = true\n  bind-address = \"127.0.0.1:8089\"\n  database = \"wattmeter\"\n```\n\n#### systemd\n\n```/lib/systemd/system/smartmeter.service\n[Unit]\nDescription=Smartmeter\nAfter=influxdb.service\n\n[Service]\nExecStart=/usr/local/bin/smartmeter -c /etc/smartmeter.conf\nWorkingDirectory=/var/lib/smartmeter\nRestart=always\nType=simple\nUser=smartmeter\nGroup=smartmeter\n\n[Install]\nWantedBy=multi-user.target\n```\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u3044\u305f\u3089systemd\u306b\u53cd\u6620\u3055\u305b\u307e\u3059\u3002\n\n```\n$ systemctl daemon-reload\n```\n\n#### smartmeter\n\nB\u30eb\u30fc\u30c8\u306eID\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```/etc/smartmeter.conf\n[routeb]\nid = \"00000000000000000000000000000000\"\npassword = \"************\"\n```\n\n## \u8d77\u52d5\n\u8a2d\u5b9a\u304c\u7d42\u308f\u3063\u305f\u3089\u3001\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```\n# systemctl start influxdb\n# systemctl start smartmeter\n# systemctl start grafana-server\n```\n\nGrafana\u306b\u30b0\u30e9\u30d5\u3092\u66f8\u304b\u305b\u308b\u3068\u3053\u308d\u306e\u8aac\u660e\u306f\u5272\u611b :astonished: \nWatt, WattHour\u306b\u305d\u308c\u305e\u308c\u96fb\u529b\u3001\u96fb\u529b\u91cf\u306e\u5024\u304c\u5165\u3063\u3066\u3044\u307e\u3059\u3002\n\n```\n$ influx\nVisit https://enterprise.influxdata.com to register for updates, InfluxDB server management, and monitoring.\nConnected to http://localhost:8086 version 1.0.0\nInfluxDB shell version: 1.0.0\n> use wattmeter\nUsing database wattmeter\n> show measurements\nname: measurements\n------------------\nname\nWatt\nWattHour\n\n> select * from Watt limit 1\nname: Watt\n----------\ntime\t\t\twatt\n1472351032206787174\t292\n\n> select * from WattHour limit 1\nname: WattHour\n--------------\ntime\t\t\twatthour\n1472351400000000000\t3074.8\n```\n\n\n\u30d6\u30e9\u30a6\u30b6\u3067\u8868\u793a\u3055\u305b\u305f\u3068\u3053\u308d\n![screenshot.jpg](https://qiita-image-store.s3.amazonaws.com/0/141835/ca7e7ad8-3e03-28d6-ddb2-bbc126c87359.jpeg)\n\nRaspberry PI \u3060\u3068\u3053\u3093\u306a\u611f\u3058\u3002\n![raspberrypi3.jpg](https://qiita-image-store.s3.amazonaws.com/0/141835/3c776686-2ac6-bfaf-2199-8674b8318d61.jpeg)\n", "tags": ["influxdb", "grafana", "RaspberryPi", "Go"]}