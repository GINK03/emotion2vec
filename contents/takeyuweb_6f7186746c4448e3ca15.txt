{"context": " More than 1 year has passed since last update.OpsWorks\u3067Rails\u30a2\u30d7\u30ea\u3092\u904b\u7528\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306b\u5bfe\u5fdc\u3059\u308b\u306b\u3042\u305f\u308a\u3001nginx\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\u30ab\u30b9\u30bf\u30e0JSON\u306f\u3001\u8a2d\u5b9a\u3092\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u306b\u542b\u3081\u3089\u308c\u306a\u3044\u306e\u3067\u7ba1\u7406\u304c\u3057\u8f9b\u3044\u305f\u3081\u3042\u307e\u308a\u597d\u304d\u3067\u306a\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u8abf\u3079\u3066\u307f\u308b\u3068 Custom Cookbooks \u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u5185\u306b customize.rb\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u304f\u3053\u3068\u3067\u3001nginx\u3092\u306f\u3058\u3081\u3068\u3059\u308bbuilt-in cookbooks\u306e\u8a2d\u5b9a\u304c\u3067\u304d\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\n\u3010AWS\u767a\u8868\u3011AWS OpsWorks \u304c Chef 11.10 \u3092\u30b5\u30dd\u30fc\u30c8\n\nChef\u306b\u542b\u307e\u308c\u308bRuby\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3082\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u307e\u305f\u3001\u30d3\u30eb\u30c8\u30a4\u30f3\u30af\u30c3\u30af\u30d6\u30c3\u30af\u306e\u305f\u3081\u306e\u975e\u5e38\u306b\u4fbf\u5229\u306a\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u6a5f\u80fd\u3092\u7528\u610f\u3057\u307e\u3057\u305f\u3002\u30af\u30c3\u30af\u30d6\u30c3\u30af\u306eattributes\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306bcustomize.rb\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u304f\u3060\u3051\u3067\u3001OpsWorks\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\nOverriding AWS OpsWorks Attributes Using Custom Cookbook Attributes\n\nCustom JSON is a convenient way to override AWS OpsWorks stack configuration and built-in cookbook attributes, but it has some limitations. In particular, you must enter custom JSON manually for each use, so you have no robust way to manage the definitions. A better approach is often to use custom cookbook attribute files to override built-in attributes. Doing so allows you to place the definitions under source control.\n\n\u3053\u306e\u65b9\u6cd5\u306a\u3089\u3001\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u5185\u5bb9\u3082\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u306b\u542b\u3081\u308b\u3053\u3068\u304c\u3067\u304d\u3001\u8a2d\u5b9a\u6f0f\u308c\u306a\u3069\u306e\u30ea\u30b9\u30af\u3092\u6e1b\u3089\u3059\u3053\u3068\u304c\u3067\u304d\u305d\u3046\u3067\u3059\u3002\n\n\u5b9f\u73fe\u3057\u305f\u3044\u3053\u3068\n\n\n\u30d3\u30eb\u30c8\u30a4\u30f3\u30af\u30c3\u30af\u30d6\u30c3\u30af\u306e\u6319\u52d5\u3092\u5909\u66f4\u3059\u308b\n\nnginx \n\n\nclient_max_body_size\nproxy_send_timeout\n\n\n\n\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u53ef\u80fd\u306b\u3059\u308b\n\n\u30ab\u30b9\u30bf\u30e0JSON\u3092\u4f7f\u7528\u3057\u306a\u3044\n\n\n\u5143\u30ec\u30b7\u30d4\u3092Fork\u3059\u308b\u306a\u3069\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u5bfe\u5fdc\u304c\u9762\u5012\u306a\u3053\u3068\u306f\u3057\u306a\u3044\n\n\n\u624b\u9806\n\n\u5bfe\u8c61\u306e\u30af\u30c3\u30af\u30d6\u30c3\u30af\u306e\u5185\u5bb9\u3092\u78ba\u8a8d\nCustom Chef Cookbooks\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4f5c\u6210\ncustomize.rb\u3092\u914d\u7f6e\nStack\u306bCustom Chef Cookbooks\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u767b\u9332\u30fb\u66f4\u65b0\nUpdate Custom Cookbooks\n\u30ec\u30b7\u30d4\u5b9f\u884c\n\n\n1. \u5bfe\u8c61\u306e\u30af\u30c3\u30af\u30d6\u30c3\u30af\u306e\u5185\u5bb9\u3092\u78ba\u8a8d\nChef Cookbooks for the AWS OpsWorks Service\u304b\u3089\u76ee\u7684\u306e\u30ec\u30b7\u30d4\u3092\u8aad\u3093\u3067\u8a2d\u5b9a\u5024\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\nnginx\u306a\u3089\u3053\u306e\u3078\u3093\u3002\n# increase if you accept large uploads\ndefault[:nginx][:client_max_body_size] = \"4m\"\n\ndefault[:nginx][:proxy_read_timeout] = 60\n\n\n2. Custom Chef Cookbooks\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4f5c\u6210\nCustom Chef Cookbooks\u306f\u5404\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306esite-cookbooks\u306b\u5c55\u958b\u3055\u308c\u307e\u3059\u3002\n\u30ea\u30dd\u30b8\u30c8\u30ea\u5185\u306bsite-cookbooks\u3092\u4f5c\u6210\u3059\u308b\u306e\u3067\u306f\u306a\u3044\u3053\u3068\u306b\u6ce8\u610f\u3057\u3066\u4e0b\u3055\u3044\u3002\n$ mkdir site-cookbooks\n$ git init\n$ touch README.md\n$ git add .\n$ git commit -m 'first commit'\n$ git remote add origin https://github.com/xxxxxx/myproject-cookboooks.git\n$ git push origin master\n\n\u5f53\u7136\u3067\u3059\u304c\u3059\u3067\u306b\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067Custom Chef Cookbooks\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u306e\u3067\u3042\u308c\u3070\u3001\u305d\u308c\u3092\u4f7f\u3048\u3070\u826f\u3044\u306e\u3067\u65b0\u305f\u306b\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n3. customize.rb\u3092\u914d\u7f6e\nCustom Chef Cookbooks\u30ea\u30dd\u30b8\u30c8\u30ea\u5185\u306bcustomize.rb\u3092\u914d\u7f6e\u3057\u307e\u3059\u3002\n\u5834\u6240\u306f\u3001\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u305f\u3044Cookbook\u540d/attributes/customize.rb\u3067\u3059\u3002\n\u4e01\u5ea6\u5bfe\u8c61\u306e\u30af\u30c3\u30af\u30d6\u30c3\u30af\u306b\u30b5\u30f3\u30d7\u30eb\u306ecustomize.rb\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u30b3\u30d4\u30fc\u3057\u3066\u540c\u3058\u3088\u3046\u306b\u914d\u7f6e\u3059\u308c\u3070\u3088\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u306e\u4ed6\u306e\u30ec\u30b7\u30d4\u3084\u8a2d\u5b9a\uff08nginx.rb\u3068\u304b\uff09\u7b49\u306f\u4e0d\u8981\u3067\u3059\u3002\nnginx/attributes/customize.rb\n###\n# This is the place to override the nginx cookbook's default attributes.\n#\n# Do not edit THIS file directly. Instead, create\n# \"nginx/attributes/customize.rb\" in your cookbook repository and\n# put the overrides in YOUR customize.rb file.\n###\n\n# The following shows how to disable NGinx compression:\n#\n#normal[:nginx][:gzip] = 'off'\n#normal[:nginx][:gzip_static] = 'off'\n\n# for Upload\nnormal[:nginx][:client_max_body_size] = \"10m\"\nnormal[:nginx][:proxy_send_timeout] = \"300\"\n\n\u3053\u3053\u3067\u306fclient_max_body_size\u309210MB\u3001 proxy_send_timeout\u3092300\u79d2\u306b\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\n\u5b8c\u6210\u3057\u305f\u3089push\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u306a\u304a\u3001\u4eca\u50d5\u304c\u9032\u3081\u3066\u3044\u308b\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u3082\u306e\u306f\u3053\u3093\u306a\u611f\u3058\u306e\u914d\u7f6e\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\n4. Stack\u306bCustom Chef Cookbooks\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u767b\u9332\n\u30b9\u30bf\u30c3\u30af\u306e\u8a2d\u5b9a\u3092\u958b\u304d\u3001User custom Chef Cookbooks\u306b\u3001\u4f5c\u6210\u3057\u305fCookbooks\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n\u306a\u304a\u3001GitHub\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u3001SSH\u3092\u4f7f\u3044\u307e\u3059\u304c\u3001\u666e\u901a\u306b22\u756a\u30dd\u30fc\u30c8\u3067\u63a5\u7d9a\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u3053\u3068\u304c\u591a\u3044\u306e\u3067\nssh://git@ssh.github.com:443/xxxxxx/myproject-cookboooks.git\n\u306e\u3088\u3046\u306bSSL\u306e\u30dd\u30fc\u30c8\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n5. Update Custom Cookbooks\n\u8a2d\u5b9a\u3059\u308b\u3060\u3051\u3067\u306f\u53cd\u6620\u3055\u308c\u306a\u3044\u306e\u3067\u3001\u30b9\u30bf\u30c3\u30af\u306eRun Command\u3088\u308a\u3001Update Custom Cookbooks\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n\u3053\u308c\u306b\u3088\u308a\u3001\u5404\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e/opt/aws/opsworks/current/site-cookbooks\u306b\u4f5c\u6210\u3057\u305f\u30ec\u30b7\u30d4\u304c\u914d\u7f6e\u3055\u308c\u307e\u3059\u3002\n\n6. \u30ec\u30b7\u30d4\u5b9f\u884c\nnginx\u306e\u30ec\u30b7\u30d4\u306fRails App Server\u3067\u3042\u308c\u3070\u901a\u5e38\u306e\u30c7\u30d7\u30ed\u30a4\u6642\u306b\u5b9f\u884c\u3055\u308c\u308b\u306f\u305a\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u306f\u624b\u52d5\u3067\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\u30b9\u30bf\u30c3\u30af\u306eRun COmmand\u3088\u308aExecute Recipes\u3092\u9078\u629e\u3057\u3001Recipes to execute\u3067nginx\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f4\u65b0\u3059\u308b\u30ec\u30b7\u30d4\u3092\u9078\u629e\u3057\u307e\u3059\u3002\nnginx::stop,nginx::default\n\n\u3053\u3053\u3067\u306fnginx\u3092\u3044\u3063\u305f\u3093\u505c\u6b62\u3057\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f4\u65b0\u3001\u8d77\u52d5\u3059\u308b\u3068\u3044\u3046\u6307\u5b9a\u3092\u3057\u3066\u307f\u307e\u3057\u305f\u3002\u73fe\u5b9f\u306b\u306f\u3001\u81ea\u5206\u3067reload\u3068\u304b\u7528\u610f\u3057\u305f\u65b9\u304c\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\nExecute Recipes\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3068\u3001\u30ec\u30b7\u30d4\u306e\u5b9f\u884c\u304c\u6210\u529f\u3057\u3001nginx\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3082\u66f4\u65b0\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u751f\u6210\u3055\u308c\u305f\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff08/etc/nginx/nginx.conf\uff09\nuser nginx;\nworker_processes  10;\n\nerror_log  /var/log/nginx/error.log;\npid        /var/run/nginx.pid;\n\nevents {\n  worker_connections  1024;\n}\n\nhttp {\n  include       /etc/nginx/mime.types;\n  default_type  application/octet-stream;\n\n\n  access_log    /var/log/nginx/access.log;\n\n  sendfile on;\n  tcp_nopush on;\n  tcp_nodelay on;\n\n  keepalive_timeout  65;\n\n  gzip  on;\n  gzip_static  on;\n  gzip_http_version 1.0;\n  gzip_comp_level 2;\n  gzip_proxied any;\n  gzip_types application/x-javascript application/xhtml+xml application/xml application/xml+rss text/css text/javascript text/plain text/xml;\n  gzip_vary on;\n  gzip_disable \"MSIE [1-6].(?!.*SV1)\";\n\n  client_max_body_size 11m;\n\n  server_names_hash_bucket_size 64;\n\n  include /etc/nginx/conf.d/*.conf;\n  include /etc/nginx/sites-enabled/*;\n}\n\n\u5b9f\u884c\u30ed\u30b0\n[2014-10-13T00:51:12+00:00] INFO: Processing service[nginx] action nothing (nginx::service line 1)\n[2014-10-13T00:51:12+00:00] INFO: Processing service[nginx] action stop (nginx::stop line 3)\n[2014-10-13T00:51:13+00:00] INFO: service[nginx] stopped\n[2014-10-13T00:51:13+00:00] INFO: Processing package[nginx] action install (nginx::default line 21)\n[2014-10-13T00:51:17+00:00] INFO: Processing directory[/etc/nginx] action create (nginx::default line 23)\n[2014-10-13T00:51:17+00:00] INFO: Processing directory[/var/log/nginx] action create (nginx::default line 29)\n[2014-10-13T00:51:17+00:00] INFO: Processing directory[/etc/nginx/sites-available] action create (nginx::default line 36)\n[2014-10-13T00:51:17+00:00] INFO: Processing directory[/etc/nginx/sites-enabled] action create (nginx::default line 36)\n[2014-10-13T00:51:17+00:00] INFO: Processing directory[/etc/nginx/conf.d] action create (nginx::default line 36)\n[2014-10-13T00:51:17+00:00] INFO: Processing template[/usr/sbin/nxensite] action create (nginx::default line 44)\n[2014-10-13T00:51:17+00:00] INFO: Processing template[/usr/sbin/nxdissite] action create (nginx::default line 44)\n[2014-10-13T00:51:17+00:00] INFO: Processing template[nginx.conf] action create (nginx::default line 52)\n[2014-10-13T00:51:17+00:00] INFO: template[nginx.conf] backed up to /root/.chef/local-mode-cache/backup/etc/nginx/nginx.conf.chef-20141013005117.675539\n[2014-10-13T00:51:17+00:00] INFO: template[nginx.conf] updated file contents /etc/nginx/nginx.conf\n[2014-10-13T00:51:17+00:00] INFO: Processing template[/etc/nginx/sites-available/default] action create (nginx::default line 60)\n[2014-10-13T00:51:17+00:00] INFO: Processing service[nginx] action enable (nginx::default line 69)\n[2014-10-13T00:51:18+00:00] INFO: Processing service[nginx] action start (nginx::default line 69)\n[2014-10-13T00:51:18+00:00] INFO: service[nginx] started\n\n\n\n[OpsWorks](http://aws.amazon.com/jp/opsworks/)\u3067Rails\u30a2\u30d7\u30ea\u3092\u904b\u7528\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306b\u5bfe\u5fdc\u3059\u308b\u306b\u3042\u305f\u308a\u3001nginx\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\n\u30ab\u30b9\u30bf\u30e0JSON\u306f\u3001\u8a2d\u5b9a\u3092\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u306b\u542b\u3081\u3089\u308c\u306a\u3044\u306e\u3067\u7ba1\u7406\u304c\u3057\u8f9b\u3044\u305f\u3081\u3042\u307e\u308a\u597d\u304d\u3067\u306a\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u8abf\u3079\u3066\u307f\u308b\u3068 Custom Cookbooks \u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u5185\u306b customize.rb\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u304f\u3053\u3068\u3067\u3001nginx\u3092\u306f\u3058\u3081\u3068\u3059\u308bbuilt-in cookbooks\u306e\u8a2d\u5b9a\u304c\u3067\u304d\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\n\n[\u3010AWS\u767a\u8868\u3011AWS OpsWorks \u304c Chef 11.10 \u3092\u30b5\u30dd\u30fc\u30c8](http://aws.typepad.com/aws_japan/2014/03/aws-opsworks-now-supports-chef-1110.html)\n\n> Chef\u306b\u542b\u307e\u308c\u308bRuby\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3082\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u307e\u305f\u3001\u30d3\u30eb\u30c8\u30a4\u30f3\u30af\u30c3\u30af\u30d6\u30c3\u30af\u306e\u305f\u3081\u306e\u975e\u5e38\u306b\u4fbf\u5229\u306a\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u6a5f\u80fd\u3092\u7528\u610f\u3057\u307e\u3057\u305f\u3002\u30af\u30c3\u30af\u30d6\u30c3\u30af\u306eattributes\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306bcustomize.rb\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u304f\u3060\u3051\u3067\u3001OpsWorks\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n[Overriding AWS OpsWorks Attributes Using Custom Cookbook Attributes](http://docs.aws.amazon.com/opsworks/latest/userguide/workingcookbook-cookbook-attributes.html)\n\n> Custom JSON is a convenient way to override AWS OpsWorks stack configuration and built-in cookbook attributes, but it has some limitations. In particular, you must enter custom JSON manually for each use, so you have no robust way to manage the definitions. A better approach is often to use custom cookbook attribute files to override built-in attributes. Doing so allows you to place the definitions under source control.\n\n**\u3053\u306e\u65b9\u6cd5\u306a\u3089\u3001\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u5185\u5bb9\u3082\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u306b\u542b\u3081\u308b\u3053\u3068\u304c\u3067\u304d\u3001\u8a2d\u5b9a\u6f0f\u308c\u306a\u3069\u306e\u30ea\u30b9\u30af\u3092\u6e1b\u3089\u3059\u3053\u3068\u304c\u3067\u304d\u305d\u3046**\u3067\u3059\u3002\n\n\n## \u5b9f\u73fe\u3057\u305f\u3044\u3053\u3068\n\n- **\u30d3\u30eb\u30c8\u30a4\u30f3\u30af\u30c3\u30af\u30d6\u30c3\u30af\u306e\u6319\u52d5\u3092\u5909\u66f4\u3059\u308b**\n  - nginx \n     - `client_max_body_size`\n     - `proxy_send_timeout`\n- **\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u53ef\u80fd\u306b\u3059\u308b**\n  - \u30ab\u30b9\u30bf\u30e0JSON\u3092\u4f7f\u7528\u3057\u306a\u3044\n- \u5143\u30ec\u30b7\u30d4\u3092Fork\u3059\u308b\u306a\u3069\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u5bfe\u5fdc\u304c\u9762\u5012\u306a\u3053\u3068\u306f\u3057\u306a\u3044\n\n\n## \u624b\u9806\n\n1. \u5bfe\u8c61\u306e\u30af\u30c3\u30af\u30d6\u30c3\u30af\u306e\u5185\u5bb9\u3092\u78ba\u8a8d\n2. Custom Chef Cookbooks\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4f5c\u6210\n3. customize.rb\u3092\u914d\u7f6e\n4. Stack\u306bCustom Chef Cookbooks\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u767b\u9332\u30fb\u66f4\u65b0\n5. Update Custom Cookbooks\n6. \u30ec\u30b7\u30d4\u5b9f\u884c\n\n## 1. \u5bfe\u8c61\u306e\u30af\u30c3\u30af\u30d6\u30c3\u30af\u306e\u5185\u5bb9\u3092\u78ba\u8a8d\n\n**[Chef Cookbooks for the AWS OpsWorks Service](https://github.com/aws/opsworks-cookbooks)**\u304b\u3089\u76ee\u7684\u306e\u30ec\u30b7\u30d4\u3092\u8aad\u3093\u3067\u8a2d\u5b9a\u5024\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n[nginx\u306a\u3089\u3053\u306e\u3078\u3093\u3002](https://github.com/aws/opsworks-cookbooks/blob/release-chef-11.10/nginx/attributes/nginx.rb)\n\n    # increase if you accept large uploads\n    default[:nginx][:client_max_body_size] = \"4m\"\n \n    default[:nginx][:proxy_read_timeout] = 60\n\n\n## 2. Custom Chef Cookbooks\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4f5c\u6210\n\nCustom Chef Cookbooks\u306f\u5404\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306esite-cookbooks\u306b\u5c55\u958b\u3055\u308c\u307e\u3059\u3002\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u5185\u306bsite-cookbooks\u3092\u4f5c\u6210\u3059\u308b\u306e\u3067\u306f\u306a\u3044\u3053\u3068\u306b\u6ce8\u610f\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n    $ mkdir site-cookbooks\n    $ git init\n    $ touch README.md\n    $ git add .\n    $ git commit -m 'first commit'\n    $ git remote add origin https://github.com/xxxxxx/myproject-cookboooks.git\n    $ git push origin master\n\n\u5f53\u7136\u3067\u3059\u304c\u3059\u3067\u306b\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067Custom Chef Cookbooks\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u306e\u3067\u3042\u308c\u3070\u3001\u305d\u308c\u3092\u4f7f\u3048\u3070\u826f\u3044\u306e\u3067\u65b0\u305f\u306b\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n## 3. customize.rb\u3092\u914d\u7f6e\n\nCustom Chef Cookbooks\u30ea\u30dd\u30b8\u30c8\u30ea\u5185\u306bcustomize.rb\u3092\u914d\u7f6e\u3057\u307e\u3059\u3002\n\n\u5834\u6240\u306f\u3001`\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u305f\u3044Cookbook\u540d/attributes/customize.rb`\u3067\u3059\u3002\n\n\u4e01\u5ea6\u5bfe\u8c61\u306e\u30af\u30c3\u30af\u30d6\u30c3\u30af\u306b\u30b5\u30f3\u30d7\u30eb\u306ecustomize.rb\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u30b3\u30d4\u30fc\u3057\u3066\u540c\u3058\u3088\u3046\u306b\u914d\u7f6e\u3059\u308c\u3070\u3088\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n**\u305d\u306e\u4ed6\u306e\u30ec\u30b7\u30d4\u3084\u8a2d\u5b9a\uff08nginx.rb\u3068\u304b\uff09\u7b49\u306f\u4e0d\u8981**\u3067\u3059\u3002\n\n`nginx/attributes/customize.rb`\n\n    ###\n    # This is the place to override the nginx cookbook's default attributes.\n    #\n    # Do not edit THIS file directly. Instead, create\n    # \"nginx/attributes/customize.rb\" in your cookbook repository and\n    # put the overrides in YOUR customize.rb file.\n    ###\n    \n    # The following shows how to disable NGinx compression:\n    #\n    #normal[:nginx][:gzip] = 'off'\n    #normal[:nginx][:gzip_static] = 'off'\n    \n    # for Upload\n    normal[:nginx][:client_max_body_size] = \"10m\"\n    normal[:nginx][:proxy_send_timeout] = \"300\"\n\n\u3053\u3053\u3067\u306f`client_max_body_size`\u309210MB\u3001 `proxy_send_timeout`\u3092300\u79d2\u306b\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\n\n\u5b8c\u6210\u3057\u305f\u3089push\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u306a\u304a\u3001\u4eca\u50d5\u304c\u9032\u3081\u3066\u3044\u308b\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u3082\u306e\u306f\u3053\u3093\u306a\u611f\u3058\u306e\u914d\u7f6e\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n![custom chef cookbooks](http://i.imgur.com/tZ3E7ir.png)\n\n\n## 4. Stack\u306bCustom Chef Cookbooks\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u767b\u9332\n\n\u30b9\u30bf\u30c3\u30af\u306e\u8a2d\u5b9a\u3092\u958b\u304d\u3001**User custom Chef Cookbooks**\u306b\u3001\u4f5c\u6210\u3057\u305fCookbooks\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n![Edit Stack](http://i.imgur.com/IzDG1Yn.png)\n\n\u306a\u304a\u3001GitHub\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u3001SSH\u3092\u4f7f\u3044\u307e\u3059\u304c\u3001\u666e\u901a\u306b22\u756a\u30dd\u30fc\u30c8\u3067\u63a5\u7d9a\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u3053\u3068\u304c\u591a\u3044\u306e\u3067\n\n`ssh://git@ssh.github.com:443/xxxxxx/myproject-cookboooks.git`\n\n\u306e\u3088\u3046\u306bSSL\u306e\u30dd\u30fc\u30c8\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n## 5. Update Custom Cookbooks\n\n\u8a2d\u5b9a\u3059\u308b\u3060\u3051\u3067\u306f\u53cd\u6620\u3055\u308c\u306a\u3044\u306e\u3067\u3001\u30b9\u30bf\u30c3\u30af\u306e`Run Command`\u3088\u308a\u3001**Update Custom Cookbooks**\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n![Update Custom Cookbooks](http://i.imgur.com/rt60Es0.png)\n\n\u3053\u308c\u306b\u3088\u308a\u3001\u5404\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e`/opt/aws/opsworks/current/site-cookbooks`\u306b\u4f5c\u6210\u3057\u305f\u30ec\u30b7\u30d4\u304c\u914d\u7f6e\u3055\u308c\u307e\u3059\u3002\n\n## 6. \u30ec\u30b7\u30d4\u5b9f\u884c\n\nnginx\u306e\u30ec\u30b7\u30d4\u306fRails App Server\u3067\u3042\u308c\u3070\u901a\u5e38\u306e\u30c7\u30d7\u30ed\u30a4\u6642\u306b\u5b9f\u884c\u3055\u308c\u308b\u306f\u305a\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u306f\u624b\u52d5\u3067\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u30b9\u30bf\u30c3\u30af\u306e`Run COmmand`\u3088\u308a**Execute Recipes**\u3092\u9078\u629e\u3057\u3001**Recipes to execute**\u3067nginx\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f4\u65b0\u3059\u308b\u30ec\u30b7\u30d4\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n    nginx::stop,nginx::default\n\n\u3053\u3053\u3067\u306fnginx\u3092\u3044\u3063\u305f\u3093\u505c\u6b62\u3057\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f4\u65b0\u3001\u8d77\u52d5\u3059\u308b\u3068\u3044\u3046\u6307\u5b9a\u3092\u3057\u3066\u307f\u307e\u3057\u305f\u3002\u73fe\u5b9f\u306b\u306f\u3001\u81ea\u5206\u3067reload\u3068\u304b\u7528\u610f\u3057\u305f\u65b9\u304c\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n**Execute Recipes**\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3068\u3001\u30ec\u30b7\u30d4\u306e\u5b9f\u884c\u304c\u6210\u529f\u3057\u3001nginx\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3082\u66f4\u65b0\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n![Run result](http://i.imgur.com/tqYU5cw.png)\n\n\u751f\u6210\u3055\u308c\u305f\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff08`/etc/nginx/nginx.conf`\uff09\n\n    user nginx;\n    worker_processes  10;\n    \n    error_log  /var/log/nginx/error.log;\n    pid        /var/run/nginx.pid;\n    \n    events {\n      worker_connections  1024;\n    }\n    \n    http {\n      include       /etc/nginx/mime.types;\n      default_type  application/octet-stream;\n    \n    \n      access_log    /var/log/nginx/access.log;\n    \n      sendfile on;\n      tcp_nopush on;\n      tcp_nodelay on;\n    \n      keepalive_timeout  65;\n    \n      gzip  on;\n      gzip_static  on;\n      gzip_http_version 1.0;\n      gzip_comp_level 2;\n      gzip_proxied any;\n      gzip_types application/x-javascript application/xhtml+xml application/xml application/xml+rss text/css text/javascript text/plain text/xml;\n      gzip_vary on;\n      gzip_disable \"MSIE [1-6].(?!.*SV1)\";\n    \n      client_max_body_size 11m;\n    \n      server_names_hash_bucket_size 64;\n    \n      include /etc/nginx/conf.d/*.conf;\n      include /etc/nginx/sites-enabled/*;\n    }\n\n\n\u5b9f\u884c\u30ed\u30b0\n    \n    [2014-10-13T00:51:12+00:00] INFO: Processing service[nginx] action nothing (nginx::service line 1)\n    [2014-10-13T00:51:12+00:00] INFO: Processing service[nginx] action stop (nginx::stop line 3)\n    [2014-10-13T00:51:13+00:00] INFO: service[nginx] stopped\n    [2014-10-13T00:51:13+00:00] INFO: Processing package[nginx] action install (nginx::default line 21)\n    [2014-10-13T00:51:17+00:00] INFO: Processing directory[/etc/nginx] action create (nginx::default line 23)\n    [2014-10-13T00:51:17+00:00] INFO: Processing directory[/var/log/nginx] action create (nginx::default line 29)\n    [2014-10-13T00:51:17+00:00] INFO: Processing directory[/etc/nginx/sites-available] action create (nginx::default line 36)\n    [2014-10-13T00:51:17+00:00] INFO: Processing directory[/etc/nginx/sites-enabled] action create (nginx::default line 36)\n    [2014-10-13T00:51:17+00:00] INFO: Processing directory[/etc/nginx/conf.d] action create (nginx::default line 36)\n    [2014-10-13T00:51:17+00:00] INFO: Processing template[/usr/sbin/nxensite] action create (nginx::default line 44)\n    [2014-10-13T00:51:17+00:00] INFO: Processing template[/usr/sbin/nxdissite] action create (nginx::default line 44)\n    [2014-10-13T00:51:17+00:00] INFO: Processing template[nginx.conf] action create (nginx::default line 52)\n    [2014-10-13T00:51:17+00:00] INFO: template[nginx.conf] backed up to /root/.chef/local-mode-cache/backup/etc/nginx/nginx.conf.chef-20141013005117.675539\n    [2014-10-13T00:51:17+00:00] INFO: template[nginx.conf] updated file contents /etc/nginx/nginx.conf\n    [2014-10-13T00:51:17+00:00] INFO: Processing template[/etc/nginx/sites-available/default] action create (nginx::default line 60)\n    [2014-10-13T00:51:17+00:00] INFO: Processing service[nginx] action enable (nginx::default line 69)\n    [2014-10-13T00:51:18+00:00] INFO: Processing service[nginx] action start (nginx::default line 69)\n    [2014-10-13T00:51:18+00:00] INFO: service[nginx] started\n    \n", "tags": ["opsworks", "AWS"]}