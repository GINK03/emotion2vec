{"tags": ["PHP5.3", "FuelPHP1.6"], "context": " More than 1 year has passed since last update.http://qiita.com/hiro_y/items/0476bcf39a77ca184009 \u306b\u66f8\u3044\u3066\u3042\u308b\u3053\u3068\u3092 FuelPHP \u3067\u3084\u308b\u3068\u304d\u306b\u3069\u3046\u3084\u308b\u306e\u304c\u3044\u3044\u304b\u3063\u3066\u3044\u3046\u8a71\u3002\n\u7406\u5c48\u306f\u4e00\u7dd2\u3067\u3059\u3002\n<?php\n\nclass Image_Gd extends \\Fuel\\Core\\Image_Gd {\n\n    public function _orientation()\n    {\n        if ( function_exists('exif_read_data'))\n        {\n            try\n            {\n                $exif = exif_read_data($this->image_fullpath);\n            }\n            catch (Exception $e)\n            {\n                Log::error($e->getMessage());\n                return;\n            }\n\n            if (isset($exif['Orientation']))\n            {\n                $orientation = $exif['Orientation'];\n\n                if ($orientation == 2)\n                {\n                    $this->flip('horizontal');\n                }\n                else if ($orientation == 3)\n                {\n                    $this->rotate(180);\n                }\n                else if ($orientation == 4)\n                {\n                    $this->flip('vertical');\n                }\n                else if ($orientation == 5)\n                {\n                    $this->rotate(-90);\n                    $this->flip('vertical');\n                }\n                else if ($orientation == 6)\n                {\n                    $this->rotate(90);\n                }\n                else if ($orientation == 7)\n                {\n                    $this->rotate(90);\n                    $this->flip('vertical');\n                }\n                else if ($orientation == 8)\n                {\n                    $this->rotate(-90);\n                }\n            }\n        }\n        else\n        {\n            $this->debug(\"Exif information is not defined.\");\n        }\n    }\n}\n\n<?php\n\nabstract class Image_Driver extends \\Fuel\\Core\\Image_Driver\n{\n    public function orientation()\n    {\n        $this->queue('orientation');\n        return $this;\n    }\n}\n\n<?php\n\nclass Image extends \\Fuel\\Core\\Image {\n\n    /**\n     * @return  Image_Driver\n     */\n    public static function orientation()\n    {\n        return static::instance()->orientation();\n    }\n\n}\n\n\u3042\u3068\u306f fuel/app/bootstrap.php \u306b\n<?php\n\nAutoloader::add_classes(array(\n    'Image' => APPPATH.'classes/image.php',\n    'Image_Driver' => APPPATH.'classes/image/driver.php',\n    'Image_Gd' => APPPATH.'classes/image/gd.php'\n));\n\n\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\u3053\u3046\u3059\u308b\u3068\u3001preset \u306e action \u3068\u3057\u3066 orientation \u3068\u3044\u3046\u306e\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3001\u753b\u50cf\u3092\u56de\u8ee2\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n\u3044\u308d\u3044\u308d\u629c\u3051\u3066\u305f\u306e\u3067\u8ffd\u8a18\u3057\u307e\u3057\u305f\u3002\nhttp://qiita.com/hiro_y/items/0476bcf39a77ca184009 \u306b\u66f8\u3044\u3066\u3042\u308b\u3053\u3068\u3092 FuelPHP \u3067\u3084\u308b\u3068\u304d\u306b\u3069\u3046\u3084\u308b\u306e\u304c\u3044\u3044\u304b\u3063\u3066\u3044\u3046\u8a71\u3002\n\n\u7406\u5c48\u306f\u4e00\u7dd2\u3067\u3059\u3002\n\n```php:\n<?php\n\nclass Image_Gd extends \\Fuel\\Core\\Image_Gd {\n\n\tpublic function _orientation()\n\t{\n\t\tif ( function_exists('exif_read_data'))\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\t$exif = exif_read_data($this->image_fullpath);\n\t\t\t}\n\t\t\tcatch (Exception $e)\n\t\t\t{\n\t\t\t\tLog::error($e->getMessage());\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (isset($exif['Orientation']))\n\t\t\t{\n\t\t\t\t$orientation = $exif['Orientation'];\n\n\t\t\t\tif ($orientation == 2)\n\t\t\t\t{\n\t\t\t\t\t$this->flip('horizontal');\n\t\t\t\t}\n\t\t\t\telse if ($orientation == 3)\n\t\t\t\t{\n\t\t\t\t\t$this->rotate(180);\n\t\t\t\t}\n\t\t\t\telse if ($orientation == 4)\n\t\t\t\t{\n\t\t\t\t\t$this->flip('vertical');\n\t\t\t\t}\n\t\t\t\telse if ($orientation == 5)\n\t\t\t\t{\n\t\t\t\t\t$this->rotate(-90);\n\t\t\t\t\t$this->flip('vertical');\n\t\t\t\t}\n\t\t\t\telse if ($orientation == 6)\n\t\t\t\t{\n\t\t\t\t\t$this->rotate(90);\n\t\t\t\t}\n\t\t\t\telse if ($orientation == 7)\n\t\t\t\t{\n\t\t\t\t\t$this->rotate(90);\n\t\t\t\t\t$this->flip('vertical');\n\t\t\t\t}\n\t\t\t\telse if ($orientation == 8)\n\t\t\t\t{\n\t\t\t\t\t$this->rotate(-90);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$this->debug(\"Exif information is not defined.\");\n\t\t}\n\t}\n}\n```\n\n```php:\n<?php\n\nabstract class Image_Driver extends \\Fuel\\Core\\Image_Driver\n{\n\tpublic function orientation()\n\t{\n\t\t$this->queue('orientation');\n\t\treturn $this;\n\t}\n}\n```\n\n```php:\n<?php\n\nclass Image extends \\Fuel\\Core\\Image {\n\n\t/**\n\t * @return  Image_Driver\n\t */\n\tpublic static function orientation()\n\t{\n\t\treturn static::instance()->orientation();\n\t}\n\n}\n```\n\n\u3042\u3068\u306f fuel/app/bootstrap.php \u306b\n\n```php:\n<?php\n\nAutoloader::add_classes(array(\n\t'Image' => APPPATH.'classes/image.php',\n\t'Image_Driver' => APPPATH.'classes/image/driver.php',\n\t'Image_Gd' => APPPATH.'classes/image/gd.php'\n));\n```\n\n\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n\u3053\u3046\u3059\u308b\u3068\u3001preset \u306e action \u3068\u3057\u3066 orientation \u3068\u3044\u3046\u306e\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3001\u753b\u50cf\u3092\u56de\u8ee2\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n----\n\n\u3044\u308d\u3044\u308d\u629c\u3051\u3066\u305f\u306e\u3067\u8ffd\u8a18\u3057\u307e\u3057\u305f\u3002"}