{"context": " More than 1 year has passed since last update.PRML 2.3.6\u306b\u8a18\u8f09\u306e\u901a\u308a\u3001\u30ac\u30a6\u30b9\u5206\u5e03\u306b\u5f93\u3046\u89b3\u6e2c\u5024x\u304c\u4e0e\u3048\u3089\u308c\u305f\u3068\u304d\u3001\u305d\u306e\u30ac\u30a6\u30b9\u5206\u5e03\u306e\u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u5171\u5f79\u4e8b\u524d\u5206\u5e03\u3092\u7528\u3044\u3066\u3001x\u306e\u89b3\u6e2c\u6bce\u306b\u4e8b\u5f8c\u5206\u5e03\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u9010\u6b21\u6c42\u3081\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u30d9\u30a4\u30ba\u63a8\u5b9a\u3092\u305d\u308c\u305e\u308c\u884c\u3044\u307e\u3059\u3002\n\nx\u306e\u7cbe\u5ea6\u304c\u65e2\u77e5\u3068\u3057\u3066\u3001\u5171\u5f79\u4e8b\u524d\u5206\u5e03\u3068\u3057\u3066\u30ac\u30a6\u30b9\u5206\u5e03p(u)=N(u|nu,nv)\u3092\u7528\u3044\u3066\u3001x\u306e\u5e73\u5747\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u5f8c\u5206\u5e03\u3092\u6c42\u3081\u307e\u3059\u3002\nx\u306e\u5e73\u5747\u304c\u65e2\u77e5\u3068\u3057\u3066\u3001\u5171\u5f79\u4e8b\u524d\u5206\u5e03\u3068\u3057\u3066\u30ac\u30f3\u30de\u5206\u5e03p(\u03bb)=Gam(\u03bb|ga,gb)\u3092\u7528\u3044\u3066\u3001x\u306e\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u5f8c\u5206\u5e03\u3092\u6c42\u3081\u307e\u3059\u3002\nx\u306e\u5e73\u5747\u3068\u7cbe\u5ea6\u304c\u672a\u77e5\u3068\u3057\u3066\u3001\u5171\u5f79\u4e8b\u524d\u5206\u5e03\u3068\u3057\u3066\u30ac\u30a6\u30b9-\u30ac\u30f3\u30de\u5206\u5e03\uff08\u6b63\u898f-\u30ac\u30f3\u30de\u5206\u5e03\uff09p(u,\u03bb)=N(u|ngu,(ngbeta*\u03bb)^(-1))Gam(\u03bb|nga,ngb)\u3092\u7528\u3044\u3066\u3001x\u306e\u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u540c\u6642\u4e8b\u5f8c\u5206\u5e03\u3092\u6c42\u3081\u307e\u3059\u3002\n\nx\u306e\u30d7\u30ed\u30c3\u30c8\u306b\u91cd\u306d\u3066\u3001\u4ee5\u4e0b\u3092\u793a\u3057\u307e\u3059\u3002\n\nx\u306e\u7cbe\u5ea6\u304c\u65e2\u77e5\u3068\u3057\u3066\u3001x\u306e\u5e73\u5747\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u5f8c\u5206\u5e03\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\nx\u306e\u5e73\u5747\u304c\u65e2\u77e5\u3068\u3057\u3066\u3001x\u306e\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u5f8c\u5206\u5e03\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\u3092\u3001x\u306b\u304a\u3051\u308b\u6a19\u6e96\u504f\u5dee\u306b\u5909\u63db\u3057\u3066\u65e2\u77e5\u306ex\u306e\u5e73\u5747\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u8db3\u3057\u305f\u3082\u306e\nx\u306e\u5e73\u5747\u3068\u7cbe\u5ea6\u304c\u672a\u77e5\u3068\u3057\u3066\u3001x\u306e\u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u5f8c\u5206\u5e03\u306e\u5e73\u5747\u5468\u8fba\u5206\u5e03\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\nx\u306e\u5e73\u5747\u3068\u7cbe\u5ea6\u304c\u672a\u77e5\u3068\u3057\u3066\u3001x\u306e\u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u5f8c\u5206\u5e03\u306e\u7cbe\u5ea6\u5468\u8fba\u5206\u5e03\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\u3092\u3001x\u306b\u304a\u3051\u308b\u6a19\u6e96\u504f\u5dee\u306b\u5909\u63db\u3057\u3066\u3001\u4e8b\u5f8c\u5206\u5e03\u306e\u5e73\u5747\u5468\u8fba\u5206\u5e03\u306e\u671f\u5f85\u5024\u306b\u8db3\u3057\u305f\u3082\u306e\n\n\u307e\u305f\u3001\u4e00\u5b9a\u306e\u89b3\u6e2c\u6bce\u306b\u3001\u305d\u306e\u6642\u70b9\u306e\u5e73\u5747\u30d1\u30e9\u30e1\u30fc\u30bf\u4e8b\u524d\u5206\u5e03\u3001\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u4e8b\u524d\u5206\u5e03\u3001\u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u540c\u6642\u4e8b\u524d\u5206\u5e03\u3092\u3001\u305d\u306e\u4e8b\u524d\u5206\u5e03\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\u3001\u304a\u3088\u3073x\u3092\u751f\u6210\u3057\u305f\u771f\u306e\u5024\u3068\u3068\u3082\u306b\u793a\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001\u4e8b\u524d\u5206\u5e03\u306b\u306f\u3001\u7121\u60c5\u5831\u4e8b\u524d\u5206\u5e03\u306b\u8fd1\u304f\u306a\u308b\u3088\u3046\u3001\u5927\u304d\u306a\u5206\u6563\u3092\u6301\u3064\u5206\u5e03\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\nframe()\nset.seed(0)\npar(mfrow=c(4, 6))\nlayout(matrix(c(rep(1, 6), t(matrix(2:(3 * 6 + 1), 3))), 4, byrow=T), heights=c(3, 1, 1, 1))\npar(mar=c(2.3, 2.5, 1, 0.1))\npar(mgp=c(1.3, .5, 0))\nurange <- c(148, 152)\nlrange <- c(0, 0.5)\nx1 <- seq(urange[1], urange[2], 0.1)\nx2 <- seq(lrange[1], lrange[2], 0.01)\n\n# \u30b5\u30f3\u30d7\u30eb\u306e\u751f\u6210\nN <- 20\nU <- 150\nV <- 4\nx <- rnorm(N, U, sqrt(V))\nxrange <- c(min(x), max(x))\n# \u5e73\u5747\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u524d\u5206\u5e03\nnu <- 0\nnv <- 1.0E+6  # \u5e73\u5747\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u524d\u5206\u5e03\u306e\u5206\u6563nv\u3092\u5927\u304d\u304f\u53d6\u308b\n# \u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u524d\u5206\u5e03\nga <- 1\ngb <- 1.0E-6  # \u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u524d\u5206\u5e03\u306e\u5206\u6563ga/gb\u3092\u5927\u304d\u304f\u53d6\u308b\n# \u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u524d\u5206\u5e03\nngu <- 0\nngbeta <- 1.0E-6  # \u5e73\u5747\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u524d\u5206\u5e03\u306e\u5206\u6563(ngbeta*\u03bb)^-1\u3092\u5927\u304d\u304f\u53d6\u308b\nnga <- 1\nngb <- 1.0E-6  # \u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u524d\u5206\u5e03\u306e\u5206\u6563nga/ngb\u3092\u5927\u304d\u304f\u53d6\u308b\n\nd <- data.frame(nu=nu, nv=nv, ga=ga, gb=gb, ngu=ngu, ngbeta=ngbeta, nga=nga, ngb=ngb)\nfor (n in 1:N) {\n    Nml <- 1\n    uml <- x[n] / Nml\n    vml <- (x[n] - U) ^ 2 / Nml\n    # \u7cbe\u5ea6\u304c\u65e2\u77e5\u306e\u6642\u306e\u5e73\u5747\u30d1\u30e9\u30e1\u30fc\u30bfu\u306e\u4e8b\u5f8c\u5206\u5e03N(u|nu,nv)\u3092\u66f4\u65b0\n    nu <- (V * nu + Nml * nv * uml) / (Nml * nv + V)\n    nv <- 1 / (1 / nv + Nml / V)\n    # \u5e73\u5747\u304c\u65e2\u77e5\u306e\u6642\u306e\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u03bb\u306e\u4e8b\u5f8c\u5206\u5e03Gam(\u03bb|ga,gb)\u3092\u66f4\u65b0\n    ga <- ga + Nml / 2\n    gb <- gb + Nml * vml / 2\n    # \u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf(u,\u03bb)\u306e\u4e8b\u5f8c\u5206\u5e03N(u|ngu,(ngbeta*\u03bb)^(-1))Gam(\u03bb|nga,ngb)\u3092\u66f4\u65b0\n    nga <- nga + Nml / 2\n    ngb <- ngb + (Nml * 0 + ngbeta * Nml * (uml - ngu) ^ 2 / (ngbeta + Nml)) / 2\n    ngu <- (Nml * uml + ngbeta * ngu) / (Nml + ngbeta)\n    ngbeta <- ngbeta + Nml\n    d <- rbind(d, c(nu, nv, ga, gb, ngu, ngbeta, nga, ngb))\n}\n\n# \u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u4e8b\u524d\u5206\u5e03\u306e\u671f\u5f85\u5024\nd$gexp <- d$ga / d$gb\n# \u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u4e8b\u524d\u5206\u5e03\u306e\u5206\u6563\nd$gvar <- d$ga / d$gb ^ 2\n# \u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u4e8b\u524d\u5206\u5e03\u306e\u5e73\u5747\u5468\u8fba\u5206\u5e03\u306e\u5206\u6563\nd$nguvar <- d$ngb / (d$ngbeta * (d$nga - 1))\n# \u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u4e8b\u524d\u5206\u5e03\u306e\u7cbe\u5ea6\u5468\u8fba\u5206\u5e03\u306e\u671f\u5f85\u5024\nd$nglexp <- d$nga / d$ngb\n# \u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u4e8b\u524d\u5206\u5e03\u306e\u7cbe\u5ea6\u5468\u8fba\u5206\u5e03\u306e\u5206\u6563\nd$nglvar <- d$nga / d$ngb ^ 2\n\n# \u89b3\u6e2c\u5024\nplot(x, pch=19, cex=1, xlim=c(1, N), ylim=xrange, xlab=\"n\")\nabline(h=U)\nabline(h=U + sqrt(V) * c(-1, 1), lty=2)\n# x\u306e\u5e73\u5747\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u5f8c\u5206\u5e03\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\npar(new=T)\nplot(d$nu[-1], type=\"o\", col=2, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\npar(new=T)\nplot((d$nu + sqrt(d$nv))[-1], type=\"l\", lty=2, col=2, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\npar(new=T)\nplot((d$nu - sqrt(d$nv))[-1], type=\"l\", lty=2, col=2, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\n# x\u306e\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u5f8c\u5206\u5e03\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\npar(new=T)\nplot((U + sqrt(1 / d$gexp))[-1], type=\"o\", col=3, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\npar(new=T)\nplot((U + sqrt(1 / (d$gexp + sqrt(d$gvar))))[-1], type=\"l\", lty=2, col=3, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\npar(new=T)\nplot((U + sqrt(1 / (d$gexp - sqrt(d$gvar))))[-1], type=\"l\", lty=2, col=3, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\n# x\u306e\u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u5f8c\u5206\u5e03\u306e\u5e73\u5747\u5468\u8fba\u5206\u5e03\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\npar(new=T)\nplot(d$ngu[-1], type=\"o\", col=4, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\npar(new=T)\nplot((d$ngu - sqrt(d$nguvar))[-1], type=\"l\", lty=2, col=4, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\npar(new=T)\nplot((d$ngu + sqrt(d$nguvar))[-1], type=\"l\", lty=2, col=4, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\n# x\u306e\u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u5f8c\u5206\u5e03\u306e\u7cbe\u5ea6\u5468\u8fba\u5206\u5e03\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\npar(new=T)\nplot((d$ngu + sqrt(1 / d$nglexp))[-1], type=\"o\", col=6, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\npar(new=T)\nplot((d$ngu + sqrt(1 / (d$nglexp + sqrt(d$nglvar))))[-1], type=\"l\", lty=2, col=6, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\npar(new=T)\nplot((d$ngu + sqrt(1 / (d$nglexp - sqrt(d$nglvar))))[-1], type=\"l\", lty=2, col=6, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\nlegend(\"bottomright\", legend=c(\n    \"p(u):E(u|X)\u00b1\u221a(Var(u|X))\", \n    \"p(\u03bb):150+\u221a(1/(E(\u03bb|X)\u00b1\u221a(Var(\u03bb|X))))\", \n    \"p(u,\u03bb):E(u|X)\u00b1\u221a(Var(u|X))\", \n    \"p(u,\u03bb):E(u|X)+\u221a(1/(E(\u03bb|X)\u00b1\u221a(Var(\u03bb|X))))\"), \n    col=c(2, 3, 4, 6), pch=1)\n\nfor (n in c(1, (1:5) * N / 5)) {\n    # \u5e73\u5747\u30d1\u30e9\u30e1\u30fc\u30bf\u4e8b\u524d\u5206\u5e03\u3068\u305d\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\n    curve(dnorm(x, d$nu[n], sqrt(d$nv[n])), col=2, xlim=urange, xlab=\"u\", ylab=\"p(u)\")\n    abline(v=d$nu[n], col=2)\n    abline(v=d$nu[n] + sqrt(d$nv[n]) * c(-1, 1), col=2, lty=2)\n    abline(v=U)\n    title(paste0(\"p(u)#\", n), cex.main=1.0)\n    # \u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u4e8b\u524d\u5206\u5e03\u3068\u305d\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\n    curve(dgamma(x, d$ga[n], rate=d$gb[n]), col=3, xlim=lrange, xlab=\"\u03bb\", ylab=\"p(\u03bb)\")\n    abline(v=d$gexp[n], col=3)\n    abline(v=d$gexp[n] + sqrt(d$gvar[n]) * c(-1, 1), col=3, lty=2)\n    abline(v=1/V)\n    title(paste0(\"p(\u03bb)#\", n), cex.main=1.0)\n    # \u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u4e8b\u524d\u5206\u5e03\u3068\u305d\u306e\u5404\u5468\u8fba\u5206\u5e03\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\n    p <- outer(x1, x2, Vectorize(function(x1, x2) \n        dnorm(x1, d$ngu[n], sqrt(1 / (d$ngbeta[n] * x2))) * dgamma(x2, d$nga[n], rate=d$ngb[n])\n        ))\n    image(x1, x2, p, xlab=expression(mu), ylab=expression(lambda), col=rainbow(450)[256:1])\n    abline(v=d$ngu[n], col=4)\n    abline(v=d$ngu[n] + sqrt(d$nguvar[n]) * c(-1, 1), col=4, lty=2)\n    abline(h=d$nglexp[n], col=6)\n    abline(h=d$nglexp[n] + sqrt(d$nglvar[n]) * c(-1, 1), col=6, lty=2)\n    points(U, 1/V)\n    title(paste0(\"p(u,\u03bb)#\", n), cex.main=1.0)\n}\n\nPRML 2.3.6\u306b\u8a18\u8f09\u306e\u901a\u308a\u3001\u30ac\u30a6\u30b9\u5206\u5e03\u306b\u5f93\u3046\u89b3\u6e2c\u5024x\u304c\u4e0e\u3048\u3089\u308c\u305f\u3068\u304d\u3001\u305d\u306e\u30ac\u30a6\u30b9\u5206\u5e03\u306e\u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u5171\u5f79\u4e8b\u524d\u5206\u5e03\u3092\u7528\u3044\u3066\u3001x\u306e\u89b3\u6e2c\u6bce\u306b\u4e8b\u5f8c\u5206\u5e03\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u9010\u6b21\u6c42\u3081\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u306e\u30d9\u30a4\u30ba\u63a8\u5b9a\u3092\u305d\u308c\u305e\u308c\u884c\u3044\u307e\u3059\u3002\n\n* x\u306e\u7cbe\u5ea6\u304c\u65e2\u77e5\u3068\u3057\u3066\u3001\u5171\u5f79\u4e8b\u524d\u5206\u5e03\u3068\u3057\u3066\u30ac\u30a6\u30b9\u5206\u5e03p(u)=N(u|nu,nv)\u3092\u7528\u3044\u3066\u3001x\u306e\u5e73\u5747\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u5f8c\u5206\u5e03\u3092\u6c42\u3081\u307e\u3059\u3002\n* x\u306e\u5e73\u5747\u304c\u65e2\u77e5\u3068\u3057\u3066\u3001\u5171\u5f79\u4e8b\u524d\u5206\u5e03\u3068\u3057\u3066\u30ac\u30f3\u30de\u5206\u5e03p(\u03bb)=Gam(\u03bb|ga,gb)\u3092\u7528\u3044\u3066\u3001x\u306e\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u5f8c\u5206\u5e03\u3092\u6c42\u3081\u307e\u3059\u3002\n* x\u306e\u5e73\u5747\u3068\u7cbe\u5ea6\u304c\u672a\u77e5\u3068\u3057\u3066\u3001\u5171\u5f79\u4e8b\u524d\u5206\u5e03\u3068\u3057\u3066\u30ac\u30a6\u30b9-\u30ac\u30f3\u30de\u5206\u5e03\uff08\u6b63\u898f-\u30ac\u30f3\u30de\u5206\u5e03\uff09p(u,\u03bb)=N(u|ngu,(ngbeta*\u03bb)^(-1))Gam(\u03bb|nga,ngb)\u3092\u7528\u3044\u3066\u3001x\u306e\u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u540c\u6642\u4e8b\u5f8c\u5206\u5e03\u3092\u6c42\u3081\u307e\u3059\u3002\n\nx\u306e\u30d7\u30ed\u30c3\u30c8\u306b\u91cd\u306d\u3066\u3001\u4ee5\u4e0b\u3092\u793a\u3057\u307e\u3059\u3002\n\n* x\u306e\u7cbe\u5ea6\u304c\u65e2\u77e5\u3068\u3057\u3066\u3001x\u306e\u5e73\u5747\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u5f8c\u5206\u5e03\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\n* x\u306e\u5e73\u5747\u304c\u65e2\u77e5\u3068\u3057\u3066\u3001x\u306e\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u5f8c\u5206\u5e03\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\u3092\u3001x\u306b\u304a\u3051\u308b\u6a19\u6e96\u504f\u5dee\u306b\u5909\u63db\u3057\u3066\u65e2\u77e5\u306ex\u306e\u5e73\u5747\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u8db3\u3057\u305f\u3082\u306e\n* x\u306e\u5e73\u5747\u3068\u7cbe\u5ea6\u304c\u672a\u77e5\u3068\u3057\u3066\u3001x\u306e\u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u5f8c\u5206\u5e03\u306e\u5e73\u5747\u5468\u8fba\u5206\u5e03\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\n* x\u306e\u5e73\u5747\u3068\u7cbe\u5ea6\u304c\u672a\u77e5\u3068\u3057\u3066\u3001x\u306e\u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u5f8c\u5206\u5e03\u306e\u7cbe\u5ea6\u5468\u8fba\u5206\u5e03\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\u3092\u3001x\u306b\u304a\u3051\u308b\u6a19\u6e96\u504f\u5dee\u306b\u5909\u63db\u3057\u3066\u3001\u4e8b\u5f8c\u5206\u5e03\u306e\u5e73\u5747\u5468\u8fba\u5206\u5e03\u306e\u671f\u5f85\u5024\u306b\u8db3\u3057\u305f\u3082\u306e\n\n\u307e\u305f\u3001\u4e00\u5b9a\u306e\u89b3\u6e2c\u6bce\u306b\u3001\u305d\u306e\u6642\u70b9\u306e\u5e73\u5747\u30d1\u30e9\u30e1\u30fc\u30bf\u4e8b\u524d\u5206\u5e03\u3001\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u4e8b\u524d\u5206\u5e03\u3001\u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u540c\u6642\u4e8b\u524d\u5206\u5e03\u3092\u3001\u305d\u306e\u4e8b\u524d\u5206\u5e03\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\u3001\u304a\u3088\u3073x\u3092\u751f\u6210\u3057\u305f\u771f\u306e\u5024\u3068\u3068\u3082\u306b\u793a\u3057\u307e\u3059\u3002\n\n\u306a\u304a\u3001\u4e8b\u524d\u5206\u5e03\u306b\u306f\u3001\u7121\u60c5\u5831\u4e8b\u524d\u5206\u5e03\u306b\u8fd1\u304f\u306a\u308b\u3088\u3046\u3001\u5927\u304d\u306a\u5206\u6563\u3092\u6301\u3064\u5206\u5e03\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n![](https://dl.dropboxusercontent.com/sh/cwfemibvr7gk4cy/OZp6F_f20w/25.NormalDistributionBayesInference.png)\n\n```r\nframe()\nset.seed(0)\npar(mfrow=c(4, 6))\nlayout(matrix(c(rep(1, 6), t(matrix(2:(3 * 6 + 1), 3))), 4, byrow=T), heights=c(3, 1, 1, 1))\npar(mar=c(2.3, 2.5, 1, 0.1))\npar(mgp=c(1.3, .5, 0))\nurange <- c(148, 152)\nlrange <- c(0, 0.5)\nx1 <- seq(urange[1], urange[2], 0.1)\nx2 <- seq(lrange[1], lrange[2], 0.01)\n\n# \u30b5\u30f3\u30d7\u30eb\u306e\u751f\u6210\nN <- 20\nU <- 150\nV <- 4\nx <- rnorm(N, U, sqrt(V))\nxrange <- c(min(x), max(x))\n# \u5e73\u5747\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u524d\u5206\u5e03\nnu <- 0\nnv <- 1.0E+6  # \u5e73\u5747\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u524d\u5206\u5e03\u306e\u5206\u6563nv\u3092\u5927\u304d\u304f\u53d6\u308b\n# \u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u524d\u5206\u5e03\nga <- 1\ngb <- 1.0E-6  # \u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u524d\u5206\u5e03\u306e\u5206\u6563ga/gb\u3092\u5927\u304d\u304f\u53d6\u308b\n# \u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u524d\u5206\u5e03\nngu <- 0\nngbeta <- 1.0E-6  # \u5e73\u5747\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u524d\u5206\u5e03\u306e\u5206\u6563(ngbeta*\u03bb)^-1\u3092\u5927\u304d\u304f\u53d6\u308b\nnga <- 1\nngb <- 1.0E-6  # \u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u524d\u5206\u5e03\u306e\u5206\u6563nga/ngb\u3092\u5927\u304d\u304f\u53d6\u308b\n\nd <- data.frame(nu=nu, nv=nv, ga=ga, gb=gb, ngu=ngu, ngbeta=ngbeta, nga=nga, ngb=ngb)\nfor (n in 1:N) {\n\tNml <- 1\n\tuml <- x[n] / Nml\n\tvml <- (x[n] - U) ^ 2 / Nml\n\t# \u7cbe\u5ea6\u304c\u65e2\u77e5\u306e\u6642\u306e\u5e73\u5747\u30d1\u30e9\u30e1\u30fc\u30bfu\u306e\u4e8b\u5f8c\u5206\u5e03N(u|nu,nv)\u3092\u66f4\u65b0\n\tnu <- (V * nu + Nml * nv * uml) / (Nml * nv + V)\n\tnv <- 1 / (1 / nv + Nml / V)\n\t# \u5e73\u5747\u304c\u65e2\u77e5\u306e\u6642\u306e\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u03bb\u306e\u4e8b\u5f8c\u5206\u5e03Gam(\u03bb|ga,gb)\u3092\u66f4\u65b0\n\tga <- ga + Nml / 2\n\tgb <- gb + Nml * vml / 2\n\t# \u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf(u,\u03bb)\u306e\u4e8b\u5f8c\u5206\u5e03N(u|ngu,(ngbeta*\u03bb)^(-1))Gam(\u03bb|nga,ngb)\u3092\u66f4\u65b0\n\tnga <- nga + Nml / 2\n\tngb <- ngb + (Nml * 0 + ngbeta * Nml * (uml - ngu) ^ 2 / (ngbeta + Nml)) / 2\n\tngu <- (Nml * uml + ngbeta * ngu) / (Nml + ngbeta)\n\tngbeta <- ngbeta + Nml\n\td <- rbind(d, c(nu, nv, ga, gb, ngu, ngbeta, nga, ngb))\n}\n\n# \u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u4e8b\u524d\u5206\u5e03\u306e\u671f\u5f85\u5024\nd$gexp <- d$ga / d$gb\n# \u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u4e8b\u524d\u5206\u5e03\u306e\u5206\u6563\nd$gvar <- d$ga / d$gb ^ 2\n# \u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u4e8b\u524d\u5206\u5e03\u306e\u5e73\u5747\u5468\u8fba\u5206\u5e03\u306e\u5206\u6563\nd$nguvar <- d$ngb / (d$ngbeta * (d$nga - 1))\n# \u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u4e8b\u524d\u5206\u5e03\u306e\u7cbe\u5ea6\u5468\u8fba\u5206\u5e03\u306e\u671f\u5f85\u5024\nd$nglexp <- d$nga / d$ngb\n# \u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u4e8b\u524d\u5206\u5e03\u306e\u7cbe\u5ea6\u5468\u8fba\u5206\u5e03\u306e\u5206\u6563\nd$nglvar <- d$nga / d$ngb ^ 2\n\n# \u89b3\u6e2c\u5024\nplot(x, pch=19, cex=1, xlim=c(1, N), ylim=xrange, xlab=\"n\")\nabline(h=U)\nabline(h=U + sqrt(V) * c(-1, 1), lty=2)\n# x\u306e\u5e73\u5747\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u5f8c\u5206\u5e03\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\npar(new=T)\nplot(d$nu[-1], type=\"o\", col=2, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\npar(new=T)\nplot((d$nu + sqrt(d$nv))[-1], type=\"l\", lty=2, col=2, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\npar(new=T)\nplot((d$nu - sqrt(d$nv))[-1], type=\"l\", lty=2, col=2, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\n# x\u306e\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u5f8c\u5206\u5e03\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\npar(new=T)\nplot((U + sqrt(1 / d$gexp))[-1], type=\"o\", col=3, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\npar(new=T)\nplot((U + sqrt(1 / (d$gexp + sqrt(d$gvar))))[-1], type=\"l\", lty=2, col=3, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\npar(new=T)\nplot((U + sqrt(1 / (d$gexp - sqrt(d$gvar))))[-1], type=\"l\", lty=2, col=3, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\n# x\u306e\u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u5f8c\u5206\u5e03\u306e\u5e73\u5747\u5468\u8fba\u5206\u5e03\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\npar(new=T)\nplot(d$ngu[-1], type=\"o\", col=4, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\npar(new=T)\nplot((d$ngu - sqrt(d$nguvar))[-1], type=\"l\", lty=2, col=4, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\npar(new=T)\nplot((d$ngu + sqrt(d$nguvar))[-1], type=\"l\", lty=2, col=4, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\n# x\u306e\u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e8b\u5f8c\u5206\u5e03\u306e\u7cbe\u5ea6\u5468\u8fba\u5206\u5e03\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\npar(new=T)\nplot((d$ngu + sqrt(1 / d$nglexp))[-1], type=\"o\", col=6, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\npar(new=T)\nplot((d$ngu + sqrt(1 / (d$nglexp + sqrt(d$nglvar))))[-1], type=\"l\", lty=2, col=6, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\npar(new=T)\nplot((d$ngu + sqrt(1 / (d$nglexp - sqrt(d$nglvar))))[-1], type=\"l\", lty=2, col=6, xlim=c(1, N), ylim=xrange, xlab=\"\", ylab=\"\", axes=F)\nlegend(\"bottomright\", legend=c(\n\t\"p(u):E(u|X)\u00b1\u221a(Var(u|X))\", \n\t\"p(\u03bb):150+\u221a(1/(E(\u03bb|X)\u00b1\u221a(Var(\u03bb|X))))\", \n\t\"p(u,\u03bb):E(u|X)\u00b1\u221a(Var(u|X))\", \n\t\"p(u,\u03bb):E(u|X)+\u221a(1/(E(\u03bb|X)\u00b1\u221a(Var(\u03bb|X))))\"), \n\tcol=c(2, 3, 4, 6), pch=1)\n\nfor (n in c(1, (1:5) * N / 5)) {\n\t# \u5e73\u5747\u30d1\u30e9\u30e1\u30fc\u30bf\u4e8b\u524d\u5206\u5e03\u3068\u305d\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\n\tcurve(dnorm(x, d$nu[n], sqrt(d$nv[n])), col=2, xlim=urange, xlab=\"u\", ylab=\"p(u)\")\n\tabline(v=d$nu[n], col=2)\n\tabline(v=d$nu[n] + sqrt(d$nv[n]) * c(-1, 1), col=2, lty=2)\n\tabline(v=U)\n\ttitle(paste0(\"p(u)#\", n), cex.main=1.0)\n\t# \u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u4e8b\u524d\u5206\u5e03\u3068\u305d\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\n\tcurve(dgamma(x, d$ga[n], rate=d$gb[n]), col=3, xlim=lrange, xlab=\"\u03bb\", ylab=\"p(\u03bb)\")\n\tabline(v=d$gexp[n], col=3)\n\tabline(v=d$gexp[n] + sqrt(d$gvar[n]) * c(-1, 1), col=3, lty=2)\n\tabline(v=1/V)\n\ttitle(paste0(\"p(\u03bb)#\", n), cex.main=1.0)\n\t# \u5e73\u5747\u30fb\u7cbe\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u4e8b\u524d\u5206\u5e03\u3068\u305d\u306e\u5404\u5468\u8fba\u5206\u5e03\u306e\u671f\u5f85\u5024\u3068\u6a19\u6e96\u504f\u5dee\n\tp <- outer(x1, x2, Vectorize(function(x1, x2) \n\t\tdnorm(x1, d$ngu[n], sqrt(1 / (d$ngbeta[n] * x2))) * dgamma(x2, d$nga[n], rate=d$ngb[n])\n\t\t))\n\timage(x1, x2, p, xlab=expression(mu), ylab=expression(lambda), col=rainbow(450)[256:1])\n\tabline(v=d$ngu[n], col=4)\n\tabline(v=d$ngu[n] + sqrt(d$nguvar[n]) * c(-1, 1), col=4, lty=2)\n\tabline(h=d$nglexp[n], col=6)\n\tabline(h=d$nglexp[n] + sqrt(d$nglvar[n]) * c(-1, 1), col=6, lty=2)\n\tpoints(U, 1/V)\n\ttitle(paste0(\"p(u,\u03bb)#\", n), cex.main=1.0)\n}\n```\n", "tags": ["R", "PRML"]}