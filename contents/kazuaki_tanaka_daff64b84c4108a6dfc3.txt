{"context": " More than 1 year has passed since last update.\u3053\u306e\u8a18\u4e8b\u3067\u306f\uff0cmruby/c\u306e\u03b1\u7248\u3092PSoC5 Prototyping Kit\uff08CY8CKIT-059\uff09\u3067\u52d5\u304b\u3059\u624b\u9806\u3092\u793a\u3057\u307e\u3059\uff0e\n\nPSoC4 Prototyping Kit\uff08CY8CKIT-049\uff09\u3082\u540c\u69d8\u306e\u624b\u9806\u3067\u53ef\u80fd\u3067\u3059\uff0e\n\nmruby/c\u306f\uff0c\u5b9f\u884c\u6642\u306b\u5fc5\u8981\u306a\u8cc7\u6e90\u304c\u5c11\u306a\u304f\u306a\u308b\u3088\u3046\u306b\u3057\u305f mruby\u306e\u5b9f\u88c5\u3067\u3059\uff0e64KB\u4ee5\u4e0b\u3067\u306e\u52d5\u4f5c\u3092\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\uff0e\u73fe\u5728\uff0c\u03b1\u7248\u3092\u914d\u5e03\u3057\u3066\u304a\u308a\u307e\u3059\uff0e\nmruby/c \u03b1\u7248\u306e\u5165\u624b\u306b\u3064\u3044\u3066\u306f\uff0c\u3057\u307e\u306d\u30bd\u30d5\u30c8\u958b\u767a\u30bb\u30f3\u30bf\u30fc\uff08ITOC\uff09\u306emruby/c \u306e\u53d6\u308a\u7d44\u307f\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\uff0e\n\n\u5fc5\u8981\u306a\u3082\u306e\n\nCY8CKIT-059\nPSoC Creator\nmruby/c \u03b1\u7248\nmruby OSS\u7248\uff08mruby\u30d5\u30a9\u30fc\u30e9\u30e0\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u307e\u3059\uff09\n\n\n\u5168\u4f53\u306e\u6d41\u308c\n\n\u7c21\u5358\u306aC\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3059\u308b\n1\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306bmruby/c\u3092\u8ffd\u52a0\u3059\u308b\nmruby\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\uff0c2\u306b\u7d44\u8fbc\u3080\n\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\n\u7a7a\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\uff0e\n\n\u3082\u3057\u300cTarget hardware\u300d\u306b\u300cCY8CKIT-059\u300d\u304c\u51fa\u3066\u3053\u306a\u3044\u5834\u5408\u306f\uff0c\u300cTarget device\u300d\u3067\u300cCY8C5888LTI-LP097\u300d\u3092\u9078\u629e\u3057\u307e\u3059\uff0e\n\nPSoC4\u306e\u5834\u5408\u306f\u300cCY8CKIT-049\u300d\u307e\u305f\u306f\u300cCY8C4247AZI-M485\u300d\u306b\u306a\u308a\u307e\u3059\uff0e\n\n\u6b21\u306e\u753b\u9762\u3067\u306f\u300cEmpty Schematic\u300d\u3092\u9078\u629e\u3057\u307e\u3059\uff0e\u6b21\u306b\uff0c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d\u306a\u3069\u3092\u5165\u529b\u3057\u307e\u3059\uff0e\u3053\u3053\u3067\u306f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d\u3092\u300cmrubyc_sample\u300d\u3068\u3057\u3066\u3044\u307e\u3059\uff0e\n\n\nLED\u3092\u70b9\u6ec5\u3055\u305b\u308b\n\u56de\u8def\u56f3\u306bDigital Output Pin\u3092\u8ffd\u52a0\u3057\u307e\u3059\uff0e\n\n\u3053\u306ePin\u3092\u30c0\u30d6\u30eb\u30af\u30ea\u30c3\u30af\u3057\u3066\uff0c\u8a2d\u5b9a\u3057\u307e\u3059\uff0e\n\n\n\u300cName\u300d\u3092\u300cLED\u300d\u306b\u3059\u308b\n\u300cHW connection\u300d\u306e\u30c1\u30a7\u30c3\u30af\u3092\u5916\u3059\n\n\n\u30d4\u30f3\u3092\u8a2d\u5b9a\u3059\u308b\n<\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d>.cydwr \u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304d\uff0cLED\u306e\u30dd\u30fc\u30c8\u3092\u300cP2[1]\u300d\u306b\u8a2d\u5b9a\u3057\u307e\u3059\uff0e\n\n\nPSoC4\u306e\u5834\u5408\u306f\uff0cLED\u306e\u30dd\u30fc\u30c8\u306f\u300cP1[6]\u300d\u306b\u306a\u308a\u307e\u3059\uff0e\n\n\n\u30d3\u30eb\u30c9\u3059\u308b\n\u3053\u3053\u3067\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u30d3\u30eb\u30c9\u3057\u307e\u3059\uff0e\n\u30d3\u30eb\u30c9\u3059\u308b\u3053\u3068\u3067\uff0c\u5148\u307b\u3069\u8a2d\u5b9a\u3057\u305fLED\u306e\u51fa\u529b\u306b\u95a2\u3059\u308b\u30b3\u30fc\u30c9\u304c\u81ea\u52d5\u751f\u6210\u3055\u308c\u307e\u3059\uff0e\n\nC\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4f5c\u6210\nmain.c\u306emain\u95a2\u6570\u3092\u6b21\u306e\u3088\u3046\u306b\u4f5c\u6210\u3057\u307e\u3059\uff0e\n\nmain\u95a2\u6570\nint main()\n{\n    CyGlobalIntEnable; /* Enable global interrupts. */\n\n    /* Place your initialization/startup code here (e.g. MyInst_Start()) */\n\n    for(;;)\n    {\n        /* Place your application code here. */\n        LED_Write(1);\n        CyDelay(200);\n        LED_Write(0);\n        CyDelay(200);\n    }\n}\n\n\n\n\u5b9f\u884c\n\u30d3\u30eb\u30c9\u3092\u884c\u3044\uff0c[Debug]-[Program]\u3067\u30dc\u30fc\u30c9\u306b\u66f8\u304d\u8fbc\u307e\u308c\u307e\u3059\uff0e\u30dc\u30fc\u30c9\u4e0a\u306eLED\u304c\u70b9\u6ec5\u3059\u308c\u3070OK\u3067\u3059\uff0e\n\n\nmruby/c \u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\u3059\u308b\nmruby/c \u03b1\u7248\u3092\u89e3\u51cd\u3057\u3066\u5f97\u3089\u308c\u308b src\u30d5\u30a9\u30eb\u30c0\u5185\u306e\u4ee5\u4e0b\u306e\u3059\u3079\u3066\u306e\u30d5\u30a1\u30a4\u30eb\uff08xxx.c\u3068xxx.h\uff09\u3092\uff0cPSoC Creator\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30d5\u30a9\u30eb\u30c0\uff08main.c\u304c\u3042\u308b\u30d5\u30a9\u30eb\u30c0\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\uff09\uff0e\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3059\u308b\n[Project]-[Existing Item...]\u3067\uff0cmruby/c \u03b1\u7248\u306e\u30d5\u30a1\u30a4\u30eb\uff08xxx.c\uff09\u3092\u8ffd\u52a0\u3057\u307e\u3059\uff0e\u8907\u6570\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u9078\u629e\u3057\u3066\uff0c\u4e00\u5ea6\u306b\u8ffd\u52a0\u3067\u304d\u307e\u3059\uff0e\n\n\u30e1\u30bd\u30c3\u30c9\u306e\u8ffd\u52a0\nC\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u4f7f\u7528\u3057\u305fLED_Write\u95a2\u6570\u3068CyDelay\u95a2\u6570\u3092\uff0cmruby\u304b\u3089\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\uff0eObject\u30af\u30e9\u30b9\u306b\u305d\u308c\u305e\u308c\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u8ffd\u52a0\u3057\u307e\u3059\uff0e\nclass.c\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304d\uff0c\u4ee5\u4e0b\u3092\u8ffd\u52a0\uff0c\u4fee\u6b63\u3057\u307e\u3059\uff0e\n\n\u8ffd\u52a0\u3059\u308b\u30d8\u30c3\u30c0\u30d5\u30a1\u30a4\u30eb\n#include \"LED.h\"\n#include \"CyLib.h\"\n\n\n\n\u8ffd\u52a0\u3059\u308b\u95a2\u6570\nmrb_value c_led(struct VM *vm, mrb_value v)\n{\n  LED_Write( v.value.i );\n  return v;\n}\n\nmrb_value c_delay(struct VM *vm, mrb_value v)\n{\n  CyDelay(v.value.i);\n  return v;\n}\n\n\n\nmrb_init_class_object\u95a2\u6570\u3092\u66f8\u304d\u63db\u3048\u308b\nstatic void mrb_init_class_object(void)\n{\n  // Class\n  static_class_object = mrb_class_alloc(\"Object\", -1);\n  // Methods\n  mrb_define_method(static_class_object, \"led\", c_led);\n  mrb_define_method(static_class_object, \"delay\", c_delay);\n}\n\n\nmrb_init_class_object\u95a2\u6570\u5185\u306emrb_define_method\u95a2\u6570\u306b\u3088\u308a\uff0cC\u306e\u95a2\u6570\u3068mruby\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u5bfe\u5fdc\u4ed8\u3051\u307e\u3059\uff0e\n\n\nmruby\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4f5c\u6210\n\u6b21\u306emruby\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092 sample.rb \u3068\u3057\u3066\u4f5c\u6210\u3057\u307e\u3059\uff0eC\u3067\u4f5c\u3063\u305f\u30d7\u30ed\u30b0\u30e9\u30e0\u3068\u9055\u3046\u30bf\u30a4\u30df\u30f3\u30b0\u3067LED\u304c\u70b9\u6ec5\u3057\u307e\u3059\uff0e\n\nsample.rb\nled 1\ndelay 100\nled 0\ndelay 900\n\n\n\nmrbc\u306b\u3088\u308b\u30b3\u30f3\u30d1\u30a4\u30eb\nsample.rb \u3092 mruby\uff08OSS\u7248\uff09\u3067\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066 sample.c \u3092\u4f5c\u6210\u3057\u307e\u3059\uff0esample.c\u3092PSoC\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u5185\u306emain.c\u3068\u540c\u3058\u30d5\u30a9\u30eb\u30c0\u306b\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304d\u307e\u3059\uff0e\n  mrbc -E -Bary sample.rb \n\n\nmain.c \u3092\u66f8\u304d\u63db\u3048\uff0cC\u304b\u3089mruby\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u547c\u3073\u51fa\u3059\nmain.c\u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3057\u307e\u3059\uff0e\n\n\u30d8\u30c3\u30c0\u30d5\u30a1\u30a4\u30eb\u306e\u8ffd\u52a0\n#include \"vm.h\" \n#include \"load.h\" \n#include \"errorcode.h\" \n#include \"static.h\" \n#include \"sample.c\"\n\n\nmrubyc\u95a2\u6570\u3092\u8ffd\u52a0\u3057\u307e\u3059\uff0e\n\nmrubyc\u95a2\u6570\nint mrubyc(void)\n{\n  struct VM *vm;\n\n  init_static();\n\n  vm = vm_open();\n  if( vm == 0 ){\n    printf(\"VM open Error\\n\");\n    return -1;\n  }\n\n  int ret = loca_mrb_array(vm, ary);\n  if( ret != NO_ERROR ){\n    printf(\"MRB Load Error (%04x_%04x)\\n\", ret>>16, ret&0xffff);\n    return -1;\n  }\n\n  vm_boot( vm );\n\n  int keep_execute = 1;\n  while( keep_execute ){\n    if( vm_run_step(vm) < 0 ){\n      keep_execute = 0;\n    }\n  }\n\n  vm_close( vm );\n\n  return 0;\n}\n\n\n\nmain\u95a2\u6570\nint main()\n{\n    CyGlobalIntEnable; /* Enable global interrupts. */\n\n    /* Place your initialization/startup code here (e.g. MyInst_Start()) */\n\n    for(;;)\n    {\n        /* Place your application code here. */\n        mrubyc();\n    }\n}\n\n\n\n\u30d3\u30eb\u30c9\u3068\u5b9f\u884c\n\u30d3\u30eb\u30c9\u3092\u884c\u3044\uff0c[Debug]-[Program]\u3067\u30dc\u30fc\u30c9\u306b\u66f8\u304d\u8fbc\u307e\u308c\u307e\u3059\uff0e\u30dc\u30fc\u30c9\u4e0a\u306eLED\u304c\u70b9\u6ec5\u3059\u308c\u3070OK\u3067\u3059\uff0e\n\n\u5c11\u3005\u9577\u3044\u8aac\u660e\u3068\u306a\u308a\u307e\u3057\u305f\u304c\uff0c\u4ee5\u4e0a\u3067 mruby/c \u03b1\u7248\u3092 PSoC5\u3067\u52d5\u304b\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\uff0e\n\n\u3053\u306e\u8a18\u4e8b\u3067\u306f\uff0cmruby/c\u306e\u03b1\u7248\u3092PSoC5 Prototyping Kit\uff08CY8CKIT-059\uff09\u3067\u52d5\u304b\u3059\u624b\u9806\u3092\u793a\u3057\u307e\u3059\uff0e\n\n> PSoC4 Prototyping Kit\uff08CY8CKIT-049\uff09\u3082\u540c\u69d8\u306e\u624b\u9806\u3067\u53ef\u80fd\u3067\u3059\uff0e\n\nmruby/c\u306f\uff0c\u5b9f\u884c\u6642\u306b\u5fc5\u8981\u306a\u8cc7\u6e90\u304c\u5c11\u306a\u304f\u306a\u308b\u3088\u3046\u306b\u3057\u305f mruby\u306e\u5b9f\u88c5\u3067\u3059\uff0e64KB\u4ee5\u4e0b\u3067\u306e\u52d5\u4f5c\u3092\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\uff0e\u73fe\u5728\uff0c\u03b1\u7248\u3092\u914d\u5e03\u3057\u3066\u304a\u308a\u307e\u3059\uff0e\n\nmruby/c \u03b1\u7248\u306e\u5165\u624b\u306b\u3064\u3044\u3066\u306f\uff0c[\u3057\u307e\u306d\u30bd\u30d5\u30c8\u958b\u767a\u30bb\u30f3\u30bf\u30fc\uff08ITOC\uff09](http://www.s-itoc.jp/)\u306e[mruby/c \u306e\u53d6\u308a\u7d44\u307f](http://www.s-itoc.jp/news/10)\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\uff0e\n\n# \u5fc5\u8981\u306a\u3082\u306e\n\n- CY8CKIT-059\n- PSoC Creator\n- mruby/c \u03b1\u7248\n- mruby OSS\u7248\uff08[mruby\u30d5\u30a9\u30fc\u30e9\u30e0](http://forum.mruby.org/)\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u307e\u3059\uff09\n\n# \u5168\u4f53\u306e\u6d41\u308c\n\n1. \u7c21\u5358\u306aC\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3059\u308b\n2. 1\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306bmruby/c\u3092\u8ffd\u52a0\u3059\u308b\n3. mruby\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\uff0c2\u306b\u7d44\u8fbc\u3080\n\n# \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\n\n\u7a7a\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\uff0e\n\n![img01.png](https://qiita-image-store.s3.amazonaws.com/0/104404/0c7904b8-1767-941b-9479-969a7c8fed0a.png)\n\n\u3082\u3057\u300cTarget hardware\u300d\u306b\u300cCY8CKIT-059\u300d\u304c\u51fa\u3066\u3053\u306a\u3044\u5834\u5408\u306f\uff0c\u300cTarget device\u300d\u3067\u300cCY8C5888LTI-LP097\u300d\u3092\u9078\u629e\u3057\u307e\u3059\uff0e\n\n> PSoC4\u306e\u5834\u5408\u306f\u300cCY8CKIT-049\u300d\u307e\u305f\u306f\u300cCY8C4247AZI-M485\u300d\u306b\u306a\u308a\u307e\u3059\uff0e\n\n\u6b21\u306e\u753b\u9762\u3067\u306f\u300cEmpty Schematic\u300d\u3092\u9078\u629e\u3057\u307e\u3059\uff0e\u6b21\u306b\uff0c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d\u306a\u3069\u3092\u5165\u529b\u3057\u307e\u3059\uff0e\u3053\u3053\u3067\u306f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d\u3092\u300cmrubyc_sample\u300d\u3068\u3057\u3066\u3044\u307e\u3059\uff0e\n\n![img02.png](https://qiita-image-store.s3.amazonaws.com/0/104404/f91a922c-995b-4e8d-07d6-eb0f87f79c7c.png)\n\n# LED\u3092\u70b9\u6ec5\u3055\u305b\u308b\n\n\u56de\u8def\u56f3\u306bDigital Output Pin\u3092\u8ffd\u52a0\u3057\u307e\u3059\uff0e\n\n![img03.png](https://qiita-image-store.s3.amazonaws.com/0/104404/037a3356-885c-041a-38d8-c1af484099aa.png)\n\n\u3053\u306ePin\u3092\u30c0\u30d6\u30eb\u30af\u30ea\u30c3\u30af\u3057\u3066\uff0c\u8a2d\u5b9a\u3057\u307e\u3059\uff0e\n\n![img04.png](https://qiita-image-store.s3.amazonaws.com/0/104404/e8c196e8-0dc6-71db-2fc5-8511d9a956ec.png)\n\n- \u300cName\u300d\u3092\u300cLED\u300d\u306b\u3059\u308b\n- \u300cHW connection\u300d\u306e\u30c1\u30a7\u30c3\u30af\u3092\u5916\u3059\n\n# \u30d4\u30f3\u3092\u8a2d\u5b9a\u3059\u308b\n\n<\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d>.cydwr \u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304d\uff0cLED\u306e\u30dd\u30fc\u30c8\u3092\u300cP2[1]\u300d\u306b\u8a2d\u5b9a\u3057\u307e\u3059\uff0e\n\n![img05.png](https://qiita-image-store.s3.amazonaws.com/0/104404/58aedf53-a653-4eae-a22a-cb0442b29e39.png)\n\n> PSoC4\u306e\u5834\u5408\u306f\uff0cLED\u306e\u30dd\u30fc\u30c8\u306f\u300cP1[6]\u300d\u306b\u306a\u308a\u307e\u3059\uff0e\n\n\n# \u30d3\u30eb\u30c9\u3059\u308b\n\n\u3053\u3053\u3067\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u30d3\u30eb\u30c9\u3057\u307e\u3059\uff0e\n\n\u30d3\u30eb\u30c9\u3059\u308b\u3053\u3068\u3067\uff0c\u5148\u307b\u3069\u8a2d\u5b9a\u3057\u305fLED\u306e\u51fa\u529b\u306b\u95a2\u3059\u308b\u30b3\u30fc\u30c9\u304c\u81ea\u52d5\u751f\u6210\u3055\u308c\u307e\u3059\uff0e\n\n# C\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4f5c\u6210\n\nmain.c\u306emain\u95a2\u6570\u3092\u6b21\u306e\u3088\u3046\u306b\u4f5c\u6210\u3057\u307e\u3059\uff0e\n\n```c:main\u95a2\u6570\nint main()\n{\n    CyGlobalIntEnable; /* Enable global interrupts. */\n\n    /* Place your initialization/startup code here (e.g. MyInst_Start()) */\n\n    for(;;)\n    {\n        /* Place your application code here. */\n        LED_Write(1);\n        CyDelay(200);\n        LED_Write(0);\n        CyDelay(200);\n    }\n}\n```\n\n# \u5b9f\u884c\n\n\u30d3\u30eb\u30c9\u3092\u884c\u3044\uff0c[Debug]-[Program]\u3067\u30dc\u30fc\u30c9\u306b\u66f8\u304d\u8fbc\u307e\u308c\u307e\u3059\uff0e\u30dc\u30fc\u30c9\u4e0a\u306eLED\u304c\u70b9\u6ec5\u3059\u308c\u3070OK\u3067\u3059\uff0e\n\n-----\n\n# mruby/c \u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\u3059\u308b\n\nmruby/c \u03b1\u7248\u3092\u89e3\u51cd\u3057\u3066\u5f97\u3089\u308c\u308b src\u30d5\u30a9\u30eb\u30c0\u5185\u306e\u4ee5\u4e0b\u306e\u3059\u3079\u3066\u306e\u30d5\u30a1\u30a4\u30eb\uff08xxx.c\u3068xxx.h\uff09\u3092\uff0cPSoC Creator\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30d5\u30a9\u30eb\u30c0\uff08main.c\u304c\u3042\u308b\u30d5\u30a9\u30eb\u30c0\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\uff09\uff0e\n\n# \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3059\u308b\n\n[Project]-[Existing Item...]\u3067\uff0cmruby/c \u03b1\u7248\u306e\u30d5\u30a1\u30a4\u30eb\uff08xxx.c\uff09\u3092\u8ffd\u52a0\u3057\u307e\u3059\uff0e\u8907\u6570\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u9078\u629e\u3057\u3066\uff0c\u4e00\u5ea6\u306b\u8ffd\u52a0\u3067\u304d\u307e\u3059\uff0e\n\n# \u30e1\u30bd\u30c3\u30c9\u306e\u8ffd\u52a0\n\nC\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u4f7f\u7528\u3057\u305fLED_Write\u95a2\u6570\u3068CyDelay\u95a2\u6570\u3092\uff0cmruby\u304b\u3089\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\uff0eObject\u30af\u30e9\u30b9\u306b\u305d\u308c\u305e\u308c\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u8ffd\u52a0\u3057\u307e\u3059\uff0e\n\nclass.c\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304d\uff0c\u4ee5\u4e0b\u3092\u8ffd\u52a0\uff0c\u4fee\u6b63\u3057\u307e\u3059\uff0e\n\n```c:\u8ffd\u52a0\u3059\u308b\u30d8\u30c3\u30c0\u30d5\u30a1\u30a4\u30eb\n#include \"LED.h\"\n#include \"CyLib.h\"\n```\n\n```c:\u8ffd\u52a0\u3059\u308b\u95a2\u6570\nmrb_value c_led(struct VM *vm, mrb_value v)\n{\n  LED_Write( v.value.i );\n  return v;\n}\n\nmrb_value c_delay(struct VM *vm, mrb_value v)\n{\n  CyDelay(v.value.i);\n  return v;\n}\n```\n\n```c:mrb_init_class_object\u95a2\u6570\u3092\u66f8\u304d\u63db\u3048\u308b\nstatic void mrb_init_class_object(void)\n{\n  // Class\n  static_class_object = mrb_class_alloc(\"Object\", -1);\n  // Methods\n  mrb_define_method(static_class_object, \"led\", c_led);\n  mrb_define_method(static_class_object, \"delay\", c_delay);\n}\n```\n\nmrb_init_class_object\u95a2\u6570\u5185\u306emrb_define_method\u95a2\u6570\u306b\u3088\u308a\uff0cC\u306e\u95a2\u6570\u3068mruby\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u5bfe\u5fdc\u4ed8\u3051\u307e\u3059\uff0e\n\n-----\n\n# mruby\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4f5c\u6210\n\n\u6b21\u306emruby\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092 sample.rb \u3068\u3057\u3066\u4f5c\u6210\u3057\u307e\u3059\uff0eC\u3067\u4f5c\u3063\u305f\u30d7\u30ed\u30b0\u30e9\u30e0\u3068\u9055\u3046\u30bf\u30a4\u30df\u30f3\u30b0\u3067LED\u304c\u70b9\u6ec5\u3057\u307e\u3059\uff0e\n\n```ruby:sample.rb\nled 1\ndelay 100\nled 0\ndelay 900\n```\n\n# mrbc\u306b\u3088\u308b\u30b3\u30f3\u30d1\u30a4\u30eb\n\nsample.rb \u3092 mruby\uff08OSS\u7248\uff09\u3067\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066 sample.c \u3092\u4f5c\u6210\u3057\u307e\u3059\uff0esample.c\u3092PSoC\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u5185\u306emain.c\u3068\u540c\u3058\u30d5\u30a9\u30eb\u30c0\u306b\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304d\u307e\u3059\uff0e\n\n```\n  mrbc -E -Bary sample.rb \n```\n\n# main.c \u3092\u66f8\u304d\u63db\u3048\uff0cC\u304b\u3089mruby\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u547c\u3073\u51fa\u3059\n\nmain.c\u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3057\u307e\u3059\uff0e\n\n```c:\u30d8\u30c3\u30c0\u30d5\u30a1\u30a4\u30eb\u306e\u8ffd\u52a0\n#include \"vm.h\" \n#include \"load.h\" \n#include \"errorcode.h\" \n#include \"static.h\" \n#include \"sample.c\"\n```\n\nmrubyc\u95a2\u6570\u3092\u8ffd\u52a0\u3057\u307e\u3059\uff0e\n\n```c:mrubyc\u95a2\u6570\nint mrubyc(void)\n{\n  struct VM *vm;\n\n  init_static();\n\n  vm = vm_open();\n  if( vm == 0 ){\n    printf(\"VM open Error\\n\");\n    return -1;\n  }\n\n  int ret = loca_mrb_array(vm, ary);\n  if( ret != NO_ERROR ){\n    printf(\"MRB Load Error (%04x_%04x)\\n\", ret>>16, ret&0xffff);\n    return -1;\n  }\n\n  vm_boot( vm );\n\n  int keep_execute = 1;\n  while( keep_execute ){\n    if( vm_run_step(vm) < 0 ){\n      keep_execute = 0;\n    }\n  }\n\n  vm_close( vm );\n\n  return 0;\n}\n```\n\n```c:main\u95a2\u6570\nint main()\n{\n    CyGlobalIntEnable; /* Enable global interrupts. */\n\n    /* Place your initialization/startup code here (e.g. MyInst_Start()) */\n\n    for(;;)\n    {\n        /* Place your application code here. */\n        mrubyc();\n    }\n}\n```\n\n# \u30d3\u30eb\u30c9\u3068\u5b9f\u884c\n\n\u30d3\u30eb\u30c9\u3092\u884c\u3044\uff0c[Debug]-[Program]\u3067\u30dc\u30fc\u30c9\u306b\u66f8\u304d\u8fbc\u307e\u308c\u307e\u3059\uff0e\u30dc\u30fc\u30c9\u4e0a\u306eLED\u304c\u70b9\u6ec5\u3059\u308c\u3070OK\u3067\u3059\uff0e\n\n\n----\n\n\u5c11\u3005\u9577\u3044\u8aac\u660e\u3068\u306a\u308a\u307e\u3057\u305f\u304c\uff0c\u4ee5\u4e0a\u3067 mruby/c \u03b1\u7248\u3092 PSoC5\u3067\u52d5\u304b\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\uff0e\n\n", "tags": ["mruby_c", "C", "mruby", "PSoC"]}