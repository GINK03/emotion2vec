{"tags": ["AWS", "route53", "aws-cli"], "context": " \u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u65e5\u304b\u30891\u5e74\u4ee5\u4e0a\u304c\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002\u300cRoute53 \u306b Internet facing ELB \u306e ALIAS \u30ec\u30b3\u30fc\u30c9\u3092\u4e00\u767a\u3067\u767b\u9332\u3059\u308b\u300d\u3068\u307b\u3068\u3093\u3069\u540c\u3058\u3067\u3001\u9055\u3044\u306f json \u306e\u4f5c\u6210\u3060\u3051\u3067\u3059\u3002\n# \u767b\u9332\u5148\u306e Route53 \u306e DNS \u540d\ndns_name=\"aws.example.com\"\n\n# \u767b\u9332\u5148\u306e Route53 \u306e\u30be\u30fc\u30f3\u306e ID \u3092\u53d6\u5f97\nzone_id=\"$(aws route53 list-hosted-zones-by-name --dns-name \"$dns_name\" \\\n  --query 'HostedZones[].Id' --output text)\"\n\n# \u30be\u30fc\u30f3 ID \u304b\u3089\u4f59\u8a08\u306a\u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u9664\u53bb\nzone_id=${zone_id##*/}\n\n# change-resource-record-sets \u306e\u5165\u529b\u306b\u306a\u308b JSON \u3092\u4f5c\u6210\njson=\"$(\n  aws ec2 describe-instances | jq --arg domain \"$dns_name\" '{\n    Changes: [\n      .Reservations[].Instances[] | select(.PublicIpAddress != null) | {\n        Action: \"UPSERT\",\n        ResourceRecordSet: {\n          Name: (.Tags[] | select(.Key == \"Name\").Value + \".\" + $domain),\n          Type: \"A\",\n          TTL: 60,\n          ResourceRecords: [{\n            Value: .PublicIpAddress\n          }]\n        }\n      }\n    ]\n  }'\n)\"\n\n# Route53 \u306b \u30ec\u30b3\u30fc\u30c9\u3092\u767b\u9332\u3059\u308b\naws route53 change-resource-record-sets --hosted-zone-id \"$zone_id\" --change-batch \"$json\"\n\n\u300c[Route53 \u306b Internet facing ELB \u306e ALIAS \u30ec\u30b3\u30fc\u30c9\u3092\u4e00\u767a\u3067\u767b\u9332\u3059\u308b](http://qiita.com/ngyuki/items/6764620f3c811dc0e9f6)\u300d\u3068\u307b\u3068\u3093\u3069\u540c\u3058\u3067\u3001\u9055\u3044\u306f json \u306e\u4f5c\u6210\u3060\u3051\u3067\u3059\u3002\n\n```sh\n# \u767b\u9332\u5148\u306e Route53 \u306e DNS \u540d\ndns_name=\"aws.example.com\"\n\n# \u767b\u9332\u5148\u306e Route53 \u306e\u30be\u30fc\u30f3\u306e ID \u3092\u53d6\u5f97\nzone_id=\"$(aws route53 list-hosted-zones-by-name --dns-name \"$dns_name\" \\\n  --query 'HostedZones[].Id' --output text)\"\n\n# \u30be\u30fc\u30f3 ID \u304b\u3089\u4f59\u8a08\u306a\u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u9664\u53bb\nzone_id=${zone_id##*/}\n\n# change-resource-record-sets \u306e\u5165\u529b\u306b\u306a\u308b JSON \u3092\u4f5c\u6210\njson=\"$(\n  aws ec2 describe-instances | jq --arg domain \"$dns_name\" '{\n    Changes: [\n      .Reservations[].Instances[] | select(.PublicIpAddress != null) | {\n        Action: \"UPSERT\",\n        ResourceRecordSet: {\n          Name: (.Tags[] | select(.Key == \"Name\").Value + \".\" + $domain),\n          Type: \"A\",\n          TTL: 60,\n          ResourceRecords: [{\n            Value: .PublicIpAddress\n          }]\n        }\n      }\n    ]\n  }'\n)\"\n\n# Route53 \u306b \u30ec\u30b3\u30fc\u30c9\u3092\u767b\u9332\u3059\u308b\naws route53 change-resource-record-sets --hosted-zone-id \"$zone_id\" --change-batch \"$json\"\n```\n"}