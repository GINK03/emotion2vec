{"context": "\n\n\u307e\u3068\u3081\nCowboy \u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u66f8\u3044\u3066\u3042\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u53c2\u8003\u306b\u3059\u308b\u3002\nhttp://ninenines.eu/docs/en/cowboy/2.0/guide/resp/#_sending_files\n\u3082\u3063\u3068\u8a73\u7d30\u304c\u3057\u308a\u305f\u3051\u308c\u3070 Ranch \u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8aad\u3080\u3002\nhttp://ninenines.eu/docs/en/ranch/1.2/guide/transports/#_sending_files\n\n\u76ee\u7684\n\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u306f\u308f\u304b\u3063\u3066\u308b\u306e\u3067 Cowboy \u7d4c\u7531\u3067\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3092\u3055\u305b\u305f\u3044\u3002\n\n\u5b9f\u88c5\nsendfile \u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb\u304c\u4f7f\u3063\u3066\u7c21\u5358\u306b\u8fd4\u305b\u308b\u306e\u3067\u3001\u30b3\u30fc\u30c9\u3082\u30b7\u30f3\u30d7\u30eb\u3060\u3002\n\n\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u306f filelib:file_size/1 \u3067\u53d6\u5f97\u3067\u304d\u308b\u3002\n\u30d5\u30a1\u30a4\u30eb\u540d\u306f filename:basename/1 \u3067\u53d6\u5f97\u3067\u304d\u308b\u3002\n\nhandle(Req, Filepath, Filename, FileSize) ->\n    F = fun(Socket, Transport) ->\n                Transport:sendfile(Socket, Filepath)\n        end,\n    Req2 = cowboy_req:set_resp_body_fun(FileSize, F, Req),\n    Req3 = cowboy_req:reply(200, [{<<\"content-type\">>, <<\"application/octet-stream\">>},\n                           {<<\"content-disposition\">>,\n                            <<\"attachment; filename=\", Filename/binary>>}], Req2),\n    {ok, Req3, undefined}.\n\n\n\n\u86c7\u8db3\nTLS \u7d4c\u7531\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u306f Erlang \u3067 TLS \u3092\u51e6\u7406\u306f\u305b\u305a\u3001 WhatsApp/stud: The Scalable TLS Unwrapping Daemon \u3084 varnish/hitch: A scalable TLS proxy by Varnish Software. \u306e\u3088\u3046\u306a\u30b9\u30b1\u30fc\u30eb\u3059\u308b TLS Proxy \u3092\u524d\u6bb5\u306b\u7f6e\u304f\u4e8b\u3002\n## \u307e\u3068\u3081\n\nCowboy \u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u66f8\u3044\u3066\u3042\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u53c2\u8003\u306b\u3059\u308b\u3002\n\nhttp://ninenines.eu/docs/en/cowboy/2.0/guide/resp/#_sending_files\n\n\u3082\u3063\u3068\u8a73\u7d30\u304c\u3057\u308a\u305f\u3051\u308c\u3070 Ranch \u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8aad\u3080\u3002\n\nhttp://ninenines.eu/docs/en/ranch/1.2/guide/transports/#_sending_files\n\n\n## \u76ee\u7684\n\n\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u306f\u308f\u304b\u3063\u3066\u308b\u306e\u3067 Cowboy \u7d4c\u7531\u3067\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3092\u3055\u305b\u305f\u3044\u3002\n\n## \u5b9f\u88c5\n\nsendfile \u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb\u304c\u4f7f\u3063\u3066\u7c21\u5358\u306b\u8fd4\u305b\u308b\u306e\u3067\u3001\u30b3\u30fc\u30c9\u3082\u30b7\u30f3\u30d7\u30eb\u3060\u3002\n\n- \u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u306f filelib:file_size/1 \u3067\u53d6\u5f97\u3067\u304d\u308b\u3002\n- \u30d5\u30a1\u30a4\u30eb\u540d\u306f filename:basename/1 \u3067\u53d6\u5f97\u3067\u304d\u308b\u3002\n\n```erlang\nhandle(Req, Filepath, Filename, FileSize) ->\n    F = fun(Socket, Transport) ->\n                Transport:sendfile(Socket, Filepath)\n        end,\n    Req2 = cowboy_req:set_resp_body_fun(FileSize, F, Req),\n    Req3 = cowboy_req:reply(200, [{<<\"content-type\">>, <<\"application/octet-stream\">>},\n                           {<<\"content-disposition\">>,\n                            <<\"attachment; filename=\", Filename/binary>>}], Req2),\n    {ok, Req3, undefined}.\n\n```\n\n## \u86c7\u8db3\n\nTLS \u7d4c\u7531\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u306f Erlang \u3067 TLS \u3092\u51e6\u7406\u306f\u305b\u305a\u3001 [WhatsApp/stud: The Scalable TLS Unwrapping Daemon](https://github.com/WhatsApp/stud) \u3084 [varnish/hitch: A scalable TLS proxy by Varnish Software.](https://github.com/varnish/hitch) \u306e\u3088\u3046\u306a\u30b9\u30b1\u30fc\u30eb\u3059\u308b TLS Proxy \u3092\u524d\u6bb5\u306b\u7f6e\u304f\u4e8b\u3002\n", "tags": ["Erlang", "cowboy"]}