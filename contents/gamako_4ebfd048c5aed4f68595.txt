{"context": " More than 1 year has passed since last update.\u3053\u3061\u3089\u304b\u3089\u306e\u7d9a\u304d\u3067\u3059\u3002\nLLVM bitcode\u57fa\u790e\u77e5\u8b58\nhttp://qiita.com/gamako/items/f37dbb05de9d3832ce6b\nXcode7\u304b\u3089\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u6709\u52b9\u306b\u306a\u3063\u305fembed-bitcode\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u3069\u3093\u306a\u50cd\u304d\u3092\u3057\u3066\u3044\u308b\u304b\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u3075\u3064\u3046\u306eo\u30d5\u30a1\u30a4\u30eb\n\u307e\u305a\u524d\u56de\u3068\u540c\u3058HelloWorld\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u304b\u3089\u3001\u3075\u3064\u3046\u306bo\u30d5\u30a1\u30a4\u30eb\u3092\u51fa\u529b\u3057\u3066\u307f\u307e\u3059\u3002\nclang -c sample.c -o sample.o\n\n\u4e2d\u8eab\u306f\u30d0\u30a4\u30ca\u30ea\u306a\u306e\u3067\u3001hexdump\u3057\u3066\u307f\u307e\u3059\u3002\n% hexdump -C -v sample.o\n00000000  cf fa ed fe 07 00 00 01  03 00 00 00 01 00 00 00  |................|\n00000010  04 00 00 00 00 02 00 00  00 20 00 00 00 00 00 00  |......... ......|\n00000020  19 00 00 00 88 01 00 00  00 00 00 00 00 00 00 00  |................|\n00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|\n00000040  98 00 00 00 00 00 00 00  20 02 00 00 00 00 00 00  |........ .......|\n00000050  98 00 00 00 00 00 00 00  07 00 00 00 07 00 00 00  |................|\n00000060  04 00 00 00 00 00 00 00  5f 5f 74 65 78 74 00 00  |........__text..|\n\n...\n\n00000300  00 5f 6d 61 69 6e 00 5f  70 72 69 6e 74 66 00 4c  |._main._printf.L|\n00000310  5f 2e 73 74 72 00 00 00                           |_.str...|\n00000318\n\nllvm-objdump\u30b3\u30de\u30f3\u30c9\u3067\u3001\u3082\u3046\u5c11\u3057\u4eba\u9593\u306b\u512a\u3057\u3044\u51fa\u529b\u3092\u3057\u3066\u304f\u308c\u307e\u3059\u3002\u5f53\u305f\u308a\u524d\u3067\u3059\u304c\u3001\u3053\u306e\u4e2d\u306bbitcode\u306e\u60c5\u5831\u306f\u542b\u307e\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n% /usr/local/Cellar/llvm/3.6.1/bin/llvm-objdump -private-headers -section-headers -disassemble -s sample.o\n\nsample.o:   file format Mach-O 64-bit x86-64\n\nDisassembly of section __TEXT,__text:\n_main:\n       0:   55                                              pushq   %rbp\n       1:   48 89 e5                                        movq    %rsp, %rbp\n       4:   48 83 ec 10                                     subq    $16, %rsp\n       8:   48 8d 3d 00 00 00 00                            leaq    (%rip), %rdi\n       f:   c7 45 fc 00 00 00 00                            movl    $0, -4(%rbp)\n      16:   b0 00                                           movb    $0, %al\n      18:   e8 00 00 00 00                                  callq   0\n      1d:   31 c9                                           xorl    %ecx, %ecx\n      1f:   89 45 f8                                        movl    %eax, -8(%rbp)\n      22:   89 c8                                           movl    %ecx, %eax\n      24:   48 83 c4 10                                     addq    $16, %rsp\n      28:   5d                                              popq    %rbp\n      29:   c3                                              retq\nSections:\nIdx Name          Size      Address          Type\n  0 __text        0000002a 0000000000000000 TEXT\n  1 __cstring     0000000e 000000000000002a DATA\n  2 __compact_unwind 00000020 0000000000000038 DATA\n  3 __eh_frame    00000040 0000000000000058 DATA\nContents of section __text:\n 0000 554889e5 4883ec10 488d3d00 000000c7  UH..H...H.=.....\n 0010 45fc0000 0000b000 e8000000 0031c989  E............1..\n 0020 45f889c8 4883c410 5dc3               E...H...].\nContents of section __cstring:\n 002a 48656c6c 6f2c2057 6f726c64 0a00      Hello, World..\nContents of section __compact_unwind:\n 0038 00000000 00000000 2a000000 00000001  ........*.......\n 0048 00000000 00000000 00000000 00000000  ................\nContents of section __eh_frame:\n 0058 14000000 00000000 037a5200 01781001  .........zR..x..\n 0068 100c0708 90010000 24000000 1c000000  ........$.......\n 0078 88ffffff ffffffff 2a000000 00000000  ........*.......\n 0088 00410e10 8602430d 06000000 00000000  .A....C.........\nMach header\n      magic cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags\nMH_MAGIC_64  X86_64        ALL  0x00      OBJECT     4        512 SUBSECTIONS_VIA_SYMBOLS\nLoad command 0\n\n...\n\n\nosx\u306eotool\u30b3\u30de\u30f3\u30c9\u3067\u3082\u4e2d\u8eab\u3092\u307f\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n% otool -hfavltVdoj sample.o\nsample.o:\nMach header\n      magic cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags\nMH_MAGIC_64  X86_64        ALL  0x00      OBJECT     4        512 SUBSECTIONS_VIA_SYMBOLS\n\n...\n\n\n\nembed-bitcode\u3067bitcode\u3092\u57cb\u3081\u8fbc\u3080\nXcode7 beta\u306eclang\u3067-fembed-bitcode\u3092\u3064\u3051\u3066\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u3063\u3066\u307f\u307e\u3059\n% /Applications/Xcode-beta.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang -c -fembed-bitcode sample.c -o sample1.o\n\n\u51fa\u529b\u3055\u308c\u305f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u30b5\u30a4\u30ba\u306f\u3001\u5148\u307b\u3069\u306e\u3082\u306e\u306b\u6bd4\u3079\u3066\u304b\u306a\u308a\u5927\u304d\u3044\u3088\u3046\u3067\u3059\u3002\n% ls -al\n...\n-rw-r--r--   1 gamako  staff    75  9  4 13:43 sample.c\n-rw-r--r--   1 gamako  staff   792  9  4 14:38 sample.o\n-rw-r--r--   1 gamako  staff  2676  9  4 15:25 sample1.o\n\n\u4e2d\u8eab\u3092\u30c0\u30f3\u30d7\u3057\u3066\u307f\u307e\u3057\u3087\u3046\n% hexdump -C -v sample1.o\n00000000  cf fa ed fe 07 00 00 01  03 00 00 00 01 00 00 00  |................|\n00000010  04 00 00 00 a0 02 00 00  00 20 00 00 00 00 00 00  |......... ......|\n00000020  19 00 00 00 28 02 00 00  00 00 00 00 00 00 00 00  |....(...........|\n00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|\n\n...\n\n00000a40  00 5f 6d 61 69 6e 00 5f  70 72 69 6e 74 66 00 5f  |._main._printf._|\n00000a50  6c 6c 76 6d 2e 63 6d 64  6c 69 6e 65 00 5f 6c 6c  |llvm.cmdline._ll|\n00000a60  76 6d 2e 65 6d 62 65 64  64 65 64 2e 6d 6f 64 75  |vm.embedded.modu|\n00000a70  6c 65 00 00                                       |le..|\n00000a74\n\nllvm-objdump\u3067\u4e2d\u8eab\u3092\u898b\u3066\u307f\u308b\u3068\u3001bitcode\u3068cmdline\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u304c\u5897\u3048\u3066\u3044\u308b\u306e\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n% /usr/local/Cellar/llvm/3.6.1/bin/llvm-objdump -private-headers -section-headers -disassemble -s sample1.o\n\nsample1.o:  file format Mach-O 64-bit x86-64\n\nDisassembly of section __TEXT,__text:\n_main:\n       0:   55                                           \n\n...\n\nSections:\nIdx Name          Size      Address          Type\n  0 __text        0000002a 0000000000000000 TEXT\n  1 __cstring     0000000e 000000000000002a DATA\n  2 __bitcode     00000640 0000000000000040 DATA\n  3 __cmdline     00000042 0000000000000680 DATA\n  4 __compact_unwind 00000020 00000000000006c8 DATA\n  5 __eh_frame    00000040 00000000000006e8 DATA\nContents of section __text:\n 0000 554889e5 4883ec10 488d3d1b 000000c7  UH..H...H.=.....\n 0010 45fc0000 0000b000 e8000000 0031c989  E............1..\n 0020 45f889c8 4883c410 5dc3               E...H...].\nContents of section __cstring:\n 002a 48656c6c 6f2c2057 6f726c64 0a00      Hello, World..\nContents of section __bitcode:\n 0040 dec0170b 00000000 14000000 28060000  ............(...\n 0050 07000001 4243c0de 210c0000 87010000  ....BC..!.......\n 0060 0b822000 02000000 12000000 07812391  .. ...........#.\n 0070 41c80449 06103239 9201840c 25050819  A..I..29....%...\n 0080 1e048b62 80104502 42920b42 84103214  ...b..E.B..B..2.\n\n...\n\n 0640 14010000 61200000 0b000000 1304412c  ....a ........A,\n 0650 10000000 03000000 34230064 43190230  ........4#.dC..0\n 0660 18830100 3311ca40 0c8311c1 00002306  ....3..@......#.\n 0670 04001c42 12000000 00000000 00000000  ...B............\nContents of section __cmdline:\n 0680 2d747269 706c6500 7838365f 36342d61  -triple.x86_64-a\n 0690 70706c65 2d6d6163 6f737831 302e3130  pple-macosx10.10\n 06a0 2e30002d 656d6974 2d6f626a 002d6469  .0.-emit-obj.-di\n 06b0 7361626c 652d6c6c 766d2d6f 70747a6e  sable-llvm-optzn\n 06c0 7300                                 s.\nContents of section __compact_unwind:\n 06c8 00000000 00000000 2a000000 00000001  ........*.......\n 06d8 00000000 00000000 00000000 00000000  ................\nContents of section __eh_frame:\n 06e8 14000000 00000000 037a5200 01781001  .........zR..x..\n 06f8 100c0708 90010000 24000000 1c000000  ........$.......\n 0708 f8f8ffff ffffffff 2a000000 00000000  ........*.......\n 0718 00410e10 8602430d 06000000 00000000  .A....C.........\nMach header\n      magic cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags\nMH_MAGIC_64  X86_64        ALL  0x00      OBJECT     4        672 SUBSECTIONS_VIA_SYMBOLS\nLoad command 0\n\n...\n\nSection\n  sectname __bitcode\n   segname __LLVM\n      addr 0x0000000000000040\n      size 0x0000000000000640\n    offset 768\n     align 2^4 (16)\n    reloff 0\n    nreloc 0\n      type S_REGULAR\nattributes (none)\n reserved1 0\n reserved2 0\nSection\n  sectname __cmdline\n   segname __LLVM\n      addr 0x0000000000000680\n      size 0x0000000000000042\n    offset 2368\n     align 2^4 (16)\n    reloff 0\n    nreloc 0\n      type S_REGULAR\nattributes (none)\n reserved1 0\n reserved2 0\nSection\n  sectname __compact_unwind\n...\n\n\nbitcode\u306e\u629c\u304d\u51fa\u3057\nbitcode\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u306foffset\u304c768\u3067size\u304c0x640\u3068\u3042\u308b\u306e\u3067\u3001\u3053\u306e\u90e8\u5206\u3092\u30d5\u30a1\u30a4\u30eb\u306b\u629c\u304d\u51fa\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002dd\u30b3\u30de\u30f3\u30c9\u3067\u3067\u304d\u307e\u3059\u3002\n% dd if=sample1.o bs=1 skip=768 count=0x640  of=sample1.bc\n1600+0 records in\n1600+0 records out\n1600 bytes transferred in 0.002806 secs (570217 bytes/sec)\n\n% hexdump -C -v sample1.bc\n00000000  de c0 17 0b 00 00 00 00  14 00 00 00 28 06 00 00  |............(...|\n00000010  07 00 00 01 42 43 c0 de  21 0c 00 00 87 01 00 00  |....BC..!.......|\n00000020  0b 82 20 00 02 00 00 00  12 00 00 00 07 81 23 91  |.. ...........#.|\n\n...\n\n00000620  18 83 01 00 33 11 ca 40  0c 83 11 c1 00 00 23 06  |....3..@......#.|\n00000630  04 00 1c 42 12 00 00 00  00 00 00 00 00 00 00 00  |...B............|\n00000640\n\n\u629c\u304d\u51fa\u3057\u305f\u90e8\u5206\u306fllvm-dis\u30b3\u30de\u30f3\u30c9\u3067LLVM IR\u306e\u30c6\u30ad\u30b9\u30c8\u306b\u5909\u63db\u3067\u304d\u307e\u3059\u3002\n% /usr/local/Cellar/llvm/3.6.1/bin/llvm-dis sample1.bc\n\n% cat sample1.ll\n; ModuleID = 'sample1.bc'\ntarget datalayout = \"e-m:o-i64:64-f80:128-n8:16:32:64-S128\"\ntarget triple = \"x86_64-apple-macosx10.10.0\"\n\n@.str = private unnamed_addr constant [14 x i8] c\"Hello, World\\0A\\00\", align 1\n\n; Function Attrs: nounwind ssp uwtable\ndefine i32 @main() #0 {\n  %1 = alloca i32, align 4\n  store i32 0, i32* %1\n  %2 = call i32 (i8*, ...)* @printf(i8* getelementptr inbounds ([14 x i8]* @.str, i32 0, i32 0))\n  ret i32 0\n}\n\ndeclare i32 @printf(i8*, ...) #1\n\nattributes #0 = { nounwind ssp uwtable \"less-precise-fpmad\"=\"false\" \"no-frame-pointer-elim\"=\"true\" \"no-frame-pointer-elim-non-leaf\" \"no-infs-fp-math\"=\"false\" \"no-nans-fp-math\"=\"false\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"core2\" \"target-features\"=\"+ssse3,+cx16,+sse,+sse2,+sse3\" \"unsafe-fp-math\"=\"false\" \"use-soft-float\"=\"false\" }\nattributes #1 = { \"less-precise-fpmad\"=\"false\" \"no-frame-pointer-elim\"=\"true\" \"no-frame-pointer-elim-non-leaf\" \"no-infs-fp-math\"=\"false\" \"no-nans-fp-math\"=\"false\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"core2\" \"target-features\"=\"+ssse3,+cx16,+sse,+sse2,+sse3\" \"unsafe-fp-math\"=\"false\" \"use-soft-float\"=\"false\" }\n\n!llvm.module.flags = !{!0}\n!llvm.ident = !{!1}\n\n!0 = !{i32 1, !\"PIC Level\", i32 2}\n!1 = !{!\"Apple LLVM version 7.0.0 (clang-700.0.72)\"}\n\n\n\u30bd\u30fc\u30b9\u304b\u3089\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u305fbitcode\u3068\u306e\u6bd4\u8f03\n\u3053\u308c\u3092xcode7 beta\u306eclang\u3067\u51fa\u529b\u3057\u305fbitcode\u3068\u6bd4\u8f03\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n% /Applications/Xcode-beta.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang -c -emit-llvm sample.c\n\n% hexdump -C -v sample.bc\n00000000  de c0 17 0b 00 00 00 00  14 00 00 00 38 06 00 00  |............8...|\n00000010  07 00 00 01 42 43 c0 de  21 0c 00 00 8b 01 00 00  |....BC..!.......|\n00000020  0b 82 20 00 02 00 00 00  12 00 00 00 07 81 23 91  |.. ...........#.|\n\n...\n\n00000630  04 00 1c 42 12 21 31 00  02 00 00 00 0b 0a 60 08  |...B.!1.......`.|\n00000640  04 03 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|\n00000650\n\n% /usr/local/Cellar/llvm/3.6.1/bin/llvm-dis sample.bc\n\n% cat sample.ll\n; ModuleID = 'sample.bc'\ntarget datalayout = \"e-m:o-i64:64-f80:128-n8:16:32:64-S128\"\ntarget triple = \"x86_64-apple-macosx10.10.0\"\n\n@.str = private unnamed_addr constant [14 x i8] c\"Hello, World\\0A\\00\", align 1\n\n; Function Attrs: nounwind ssp uwtable\ndefine i32 @main() #0 {\n  %1 = alloca i32, align 4\n  store i32 0, i32* %1\n  %2 = call i32 (i8*, ...)* @printf(i8* getelementptr inbounds ([14 x i8]* @.str, i32 0, i32 0))\n  ret i32 0\n}\n\ndeclare i32 @printf(i8*, ...) #1\n\nattributes #0 = { nounwind ssp uwtable \"less-precise-fpmad\"=\"false\" \"no-frame-pointer-elim\"=\"true\" \"no-frame-pointer-elim-non-leaf\" \"no-infs-fp-math\"=\"false\" \"no-nans-fp-math\"=\"false\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"core2\" \"target-features\"=\"+ssse3,+cx16,+sse,+sse2,+sse3\" \"unsafe-fp-math\"=\"false\" \"use-soft-float\"=\"false\" }\nattributes #1 = { \"less-precise-fpmad\"=\"false\" \"no-frame-pointer-elim\"=\"true\" \"no-frame-pointer-elim-non-leaf\" \"no-infs-fp-math\"=\"false\" \"no-nans-fp-math\"=\"false\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"core2\" \"target-features\"=\"+ssse3,+cx16,+sse,+sse2,+sse3\" \"unsafe-fp-math\"=\"false\" \"use-soft-float\"=\"false\" }\n\n!llvm.module.flags = !{!0}\n!llvm.ident = !{!1}\n\n!0 = !{i32 1, !\"PIC Level\", i32 2}\n!1 = !{!\"Apple LLVM version 7.0.0 (clang-700.0.72)\"}\n\nbitcode\u306e\u4e2d\u8eab\u3068\u30b5\u30a4\u30ba\u306f\u82e5\u5e72\u9055\u3046\u3088\u3046\u3067\u3059\u304c\u3001\u3001\u3001\n% ls -al\n...\n-rw-r--r--   1 gamako  staff  1616  9  4 15:38 sample.bc\n-rw-r--r--   1 gamako  staff  1268  9  4 15:43 sample.ll\n-rw-r--r--   1 gamako  staff  1600  9  4 15:47 sample1.bc\n-rw-r--r--   1 gamako  staff  1269  9  4 15:55 sample1.ll\n\nll\u30d5\u30a1\u30a4\u30eb\u306ediff\u3092\u3068\u3063\u3066\u307f\u308b\u3068\u308f\u304b\u308b\u3088\u3046\u306b\u3001\u4e2d\u306e\u60c5\u5831\u306f\u307b\u307c\u540c\u4e00\u3067\u3042\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n% diff sample.ll sample1.ll\n1c1\n< ; ModuleID = 'sample.bc'\n---\n> ; ModuleID = 'sample1.bc'\n\n\n__cmdline\u30bb\u30af\u30b7\u30e7\u30f3\n\u4e00\u65b9__cmdline\u30bb\u30af\u30b7\u30e7\u30f3\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u3002\u30d3\u30eb\u30c9\u6642\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u306b\u307f\u3048\u307e\u3059\u3002\u3053\u308c\u3092\u30d2\u30f3\u30c8\u306b\u30b9\u30c8\u30a2\u5074\u3067\u306e\u518d\u6700\u9069\u5316\u304c\u884c\u308f\u308c\u308b\u306e\u3067\u3057\u3087\u3046\u3002\nContents of section __cmdline:\n 0680 2d747269 706c6500 7838365f 36342d61  -triple.x86_64-a\n 0690 70706c65 2d6d6163 6f737831 302e3130  pple-macosx10.10\n 06a0 2e30002d 656d6974 2d6f626a 002d6469  .0.-emit-obj.-di\n 06b0 7361626c 652d6c6c 766d2d6f 70747a6e  sable-llvm-optzn\n 06c0 7300                                 s.\n\n\n\n\u6700\u5f8c\u306b\nXcode\u3067\u306e\u30d3\u30eb\u30c9\u306b\u3064\u3044\u3066\u306f\u3001\u3053\u3061\u3089\u3082\u53c2\u8003\u306b\u3069\u3046\u305e\nXcode\u3067Archive\u4ee5\u5916\u306e\u30d3\u30eb\u30c9\u7d50\u679c\u306b\u306fbitcode\u304c\u57cb\u3081\u8fbc\u307e\u308c\u306a\u3044\nhttp://qiita.com/gamako/items/66d3a8164678e525a26e\n\n\n\u3053\u3061\u3089\u304b\u3089\u306e\u7d9a\u304d\u3067\u3059\u3002\nLLVM bitcode\u57fa\u790e\u77e5\u8b58\nhttp://qiita.com/gamako/items/f37dbb05de9d3832ce6b\n\n\n\n\nXcode7\u304b\u3089\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u6709\u52b9\u306b\u306a\u3063\u305fembed-bitcode\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u3069\u3093\u306a\u50cd\u304d\u3092\u3057\u3066\u3044\u308b\u304b\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n# \u3075\u3064\u3046\u306eo\u30d5\u30a1\u30a4\u30eb\n\n\u307e\u305a\u524d\u56de\u3068\u540c\u3058HelloWorld\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u304b\u3089\u3001\u3075\u3064\u3046\u306bo\u30d5\u30a1\u30a4\u30eb\u3092\u51fa\u529b\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\nclang -c sample.c -o sample.o\n```\n\n\u4e2d\u8eab\u306f\u30d0\u30a4\u30ca\u30ea\u306a\u306e\u3067\u3001hexdump\u3057\u3066\u307f\u307e\u3059\u3002\n\n```bash\n% hexdump -C -v sample.o\n00000000  cf fa ed fe 07 00 00 01  03 00 00 00 01 00 00 00  |................|\n00000010  04 00 00 00 00 02 00 00  00 20 00 00 00 00 00 00  |......... ......|\n00000020  19 00 00 00 88 01 00 00  00 00 00 00 00 00 00 00  |................|\n00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|\n00000040  98 00 00 00 00 00 00 00  20 02 00 00 00 00 00 00  |........ .......|\n00000050  98 00 00 00 00 00 00 00  07 00 00 00 07 00 00 00  |................|\n00000060  04 00 00 00 00 00 00 00  5f 5f 74 65 78 74 00 00  |........__text..|\n\n...\n\n00000300  00 5f 6d 61 69 6e 00 5f  70 72 69 6e 74 66 00 4c  |._main._printf.L|\n00000310  5f 2e 73 74 72 00 00 00                           |_.str...|\n00000318\n```\n\nllvm-objdump\u30b3\u30de\u30f3\u30c9\u3067\u3001\u3082\u3046\u5c11\u3057\u4eba\u9593\u306b\u512a\u3057\u3044\u51fa\u529b\u3092\u3057\u3066\u304f\u308c\u307e\u3059\u3002\u5f53\u305f\u308a\u524d\u3067\u3059\u304c\u3001\u3053\u306e\u4e2d\u306bbitcode\u306e\u60c5\u5831\u306f\u542b\u307e\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n\n```bash\n% /usr/local/Cellar/llvm/3.6.1/bin/llvm-objdump -private-headers -section-headers -disassemble -s sample.o\n\nsample.o:\tfile format Mach-O 64-bit x86-64\n\nDisassembly of section __TEXT,__text:\n_main:\n       0:\t55                                           \tpushq\t%rbp\n       1:\t48 89 e5                                     \tmovq\t%rsp, %rbp\n       4:\t48 83 ec 10                                  \tsubq\t$16, %rsp\n       8:\t48 8d 3d 00 00 00 00                         \tleaq\t(%rip), %rdi\n       f:\tc7 45 fc 00 00 00 00                         \tmovl\t$0, -4(%rbp)\n      16:\tb0 00                                        \tmovb\t$0, %al\n      18:\te8 00 00 00 00                               \tcallq\t0\n      1d:\t31 c9                                        \txorl\t%ecx, %ecx\n      1f:\t89 45 f8                                     \tmovl\t%eax, -8(%rbp)\n      22:\t89 c8                                        \tmovl\t%ecx, %eax\n      24:\t48 83 c4 10                                  \taddq\t$16, %rsp\n      28:\t5d                                           \tpopq\t%rbp\n      29:\tc3                                           \tretq\nSections:\nIdx Name          Size      Address          Type\n  0 __text        0000002a 0000000000000000 TEXT\n  1 __cstring     0000000e 000000000000002a DATA\n  2 __compact_unwind 00000020 0000000000000038 DATA\n  3 __eh_frame    00000040 0000000000000058 DATA\nContents of section __text:\n 0000 554889e5 4883ec10 488d3d00 000000c7  UH..H...H.=.....\n 0010 45fc0000 0000b000 e8000000 0031c989  E............1..\n 0020 45f889c8 4883c410 5dc3               E...H...].\nContents of section __cstring:\n 002a 48656c6c 6f2c2057 6f726c64 0a00      Hello, World..\nContents of section __compact_unwind:\n 0038 00000000 00000000 2a000000 00000001  ........*.......\n 0048 00000000 00000000 00000000 00000000  ................\nContents of section __eh_frame:\n 0058 14000000 00000000 037a5200 01781001  .........zR..x..\n 0068 100c0708 90010000 24000000 1c000000  ........$.......\n 0078 88ffffff ffffffff 2a000000 00000000  ........*.......\n 0088 00410e10 8602430d 06000000 00000000  .A....C.........\nMach header\n      magic cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags\nMH_MAGIC_64  X86_64        ALL  0x00      OBJECT     4        512 SUBSECTIONS_VIA_SYMBOLS\nLoad command 0\n\n...\n\n```\n\nosx\u306eotool\u30b3\u30de\u30f3\u30c9\u3067\u3082\u4e2d\u8eab\u3092\u307f\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```\n% otool -hfavltVdoj sample.o\nsample.o:\nMach header\n      magic cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags\nMH_MAGIC_64  X86_64        ALL  0x00      OBJECT     4        512 SUBSECTIONS_VIA_SYMBOLS\n\n...\n\n```\n\n# embed-bitcode\u3067bitcode\u3092\u57cb\u3081\u8fbc\u3080\n\nXcode7 beta\u306eclang\u3067-fembed-bitcode\u3092\u3064\u3051\u3066\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u3063\u3066\u307f\u307e\u3059\n\n```\n% /Applications/Xcode-beta.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang -c -fembed-bitcode sample.c -o sample1.o\n```\n\n\u51fa\u529b\u3055\u308c\u305f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u30b5\u30a4\u30ba\u306f\u3001\u5148\u307b\u3069\u306e\u3082\u306e\u306b\u6bd4\u3079\u3066\u304b\u306a\u308a\u5927\u304d\u3044\u3088\u3046\u3067\u3059\u3002\n\n```\n% ls -al\n...\n-rw-r--r--   1 gamako  staff    75  9  4 13:43 sample.c\n-rw-r--r--   1 gamako  staff   792  9  4 14:38 sample.o\n-rw-r--r--   1 gamako  staff  2676  9  4 15:25 sample1.o\n```\n\n\u4e2d\u8eab\u3092\u30c0\u30f3\u30d7\u3057\u3066\u307f\u307e\u3057\u3087\u3046\n\n```\n% hexdump -C -v sample1.o\n00000000  cf fa ed fe 07 00 00 01  03 00 00 00 01 00 00 00  |................|\n00000010  04 00 00 00 a0 02 00 00  00 20 00 00 00 00 00 00  |......... ......|\n00000020  19 00 00 00 28 02 00 00  00 00 00 00 00 00 00 00  |....(...........|\n00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|\n\n...\n\n00000a40  00 5f 6d 61 69 6e 00 5f  70 72 69 6e 74 66 00 5f  |._main._printf._|\n00000a50  6c 6c 76 6d 2e 63 6d 64  6c 69 6e 65 00 5f 6c 6c  |llvm.cmdline._ll|\n00000a60  76 6d 2e 65 6d 62 65 64  64 65 64 2e 6d 6f 64 75  |vm.embedded.modu|\n00000a70  6c 65 00 00                                       |le..|\n00000a74\n```\n\nllvm-objdump\u3067\u4e2d\u8eab\u3092\u898b\u3066\u307f\u308b\u3068\u3001__bitcode\u3068__cmdline\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u304c\u5897\u3048\u3066\u3044\u308b\u306e\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n```\n% /usr/local/Cellar/llvm/3.6.1/bin/llvm-objdump -private-headers -section-headers -disassemble -s sample1.o\n\nsample1.o:\tfile format Mach-O 64-bit x86-64\n\nDisassembly of section __TEXT,__text:\n_main:\n       0:\t55                                           \n       \n...\n       \nSections:\nIdx Name          Size      Address          Type\n  0 __text        0000002a 0000000000000000 TEXT\n  1 __cstring     0000000e 000000000000002a DATA\n  2 __bitcode     00000640 0000000000000040 DATA\n  3 __cmdline     00000042 0000000000000680 DATA\n  4 __compact_unwind 00000020 00000000000006c8 DATA\n  5 __eh_frame    00000040 00000000000006e8 DATA\nContents of section __text:\n 0000 554889e5 4883ec10 488d3d1b 000000c7  UH..H...H.=.....\n 0010 45fc0000 0000b000 e8000000 0031c989  E............1..\n 0020 45f889c8 4883c410 5dc3               E...H...].\nContents of section __cstring:\n 002a 48656c6c 6f2c2057 6f726c64 0a00      Hello, World..\nContents of section __bitcode:\n 0040 dec0170b 00000000 14000000 28060000  ............(...\n 0050 07000001 4243c0de 210c0000 87010000  ....BC..!.......\n 0060 0b822000 02000000 12000000 07812391  .. ...........#.\n 0070 41c80449 06103239 9201840c 25050819  A..I..29....%...\n 0080 1e048b62 80104502 42920b42 84103214  ...b..E.B..B..2.\n\n...\n\n 0640 14010000 61200000 0b000000 1304412c  ....a ........A,\n 0650 10000000 03000000 34230064 43190230  ........4#.dC..0\n 0660 18830100 3311ca40 0c8311c1 00002306  ....3..@......#.\n 0670 04001c42 12000000 00000000 00000000  ...B............\nContents of section __cmdline:\n 0680 2d747269 706c6500 7838365f 36342d61  -triple.x86_64-a\n 0690 70706c65 2d6d6163 6f737831 302e3130  pple-macosx10.10\n 06a0 2e30002d 656d6974 2d6f626a 002d6469  .0.-emit-obj.-di\n 06b0 7361626c 652d6c6c 766d2d6f 70747a6e  sable-llvm-optzn\n 06c0 7300                                 s.\nContents of section __compact_unwind:\n 06c8 00000000 00000000 2a000000 00000001  ........*.......\n 06d8 00000000 00000000 00000000 00000000  ................\nContents of section __eh_frame:\n 06e8 14000000 00000000 037a5200 01781001  .........zR..x..\n 06f8 100c0708 90010000 24000000 1c000000  ........$.......\n 0708 f8f8ffff ffffffff 2a000000 00000000  ........*.......\n 0718 00410e10 8602430d 06000000 00000000  .A....C.........\nMach header\n      magic cputype cpusubtype  caps    filetype ncmds sizeofcmds      flags\nMH_MAGIC_64  X86_64        ALL  0x00      OBJECT     4        672 SUBSECTIONS_VIA_SYMBOLS\nLoad command 0\n\n...\n\nSection\n  sectname __bitcode\n   segname __LLVM\n      addr 0x0000000000000040\n      size 0x0000000000000640\n    offset 768\n     align 2^4 (16)\n    reloff 0\n    nreloc 0\n      type S_REGULAR\nattributes (none)\n reserved1 0\n reserved2 0\nSection\n  sectname __cmdline\n   segname __LLVM\n      addr 0x0000000000000680\n      size 0x0000000000000042\n    offset 2368\n     align 2^4 (16)\n    reloff 0\n    nreloc 0\n      type S_REGULAR\nattributes (none)\n reserved1 0\n reserved2 0\nSection\n  sectname __compact_unwind\n...\n```\n\n\n## bitcode\u306e\u629c\u304d\u51fa\u3057\n\nbitcode\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u306foffset\u304c768\u3067size\u304c0x640\u3068\u3042\u308b\u306e\u3067\u3001\u3053\u306e\u90e8\u5206\u3092\u30d5\u30a1\u30a4\u30eb\u306b\u629c\u304d\u51fa\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002dd\u30b3\u30de\u30f3\u30c9\u3067\u3067\u304d\u307e\u3059\u3002\n\n```\n% dd if=sample1.o bs=1 skip=768 count=0x640  of=sample1.bc\n1600+0 records in\n1600+0 records out\n1600 bytes transferred in 0.002806 secs (570217 bytes/sec)\n```\n```\n% hexdump -C -v sample1.bc\n00000000  de c0 17 0b 00 00 00 00  14 00 00 00 28 06 00 00  |............(...|\n00000010  07 00 00 01 42 43 c0 de  21 0c 00 00 87 01 00 00  |....BC..!.......|\n00000020  0b 82 20 00 02 00 00 00  12 00 00 00 07 81 23 91  |.. ...........#.|\n\n...\n\n00000620  18 83 01 00 33 11 ca 40  0c 83 11 c1 00 00 23 06  |....3..@......#.|\n00000630  04 00 1c 42 12 00 00 00  00 00 00 00 00 00 00 00  |...B............|\n00000640\n```\n\n\u629c\u304d\u51fa\u3057\u305f\u90e8\u5206\u306fllvm-dis\u30b3\u30de\u30f3\u30c9\u3067LLVM IR\u306e\u30c6\u30ad\u30b9\u30c8\u306b\u5909\u63db\u3067\u304d\u307e\u3059\u3002\n\n```\n% /usr/local/Cellar/llvm/3.6.1/bin/llvm-dis sample1.bc\n```\n```\n% cat sample1.ll\n; ModuleID = 'sample1.bc'\ntarget datalayout = \"e-m:o-i64:64-f80:128-n8:16:32:64-S128\"\ntarget triple = \"x86_64-apple-macosx10.10.0\"\n\n@.str = private unnamed_addr constant [14 x i8] c\"Hello, World\\0A\\00\", align 1\n\n; Function Attrs: nounwind ssp uwtable\ndefine i32 @main() #0 {\n  %1 = alloca i32, align 4\n  store i32 0, i32* %1\n  %2 = call i32 (i8*, ...)* @printf(i8* getelementptr inbounds ([14 x i8]* @.str, i32 0, i32 0))\n  ret i32 0\n}\n\ndeclare i32 @printf(i8*, ...) #1\n\nattributes #0 = { nounwind ssp uwtable \"less-precise-fpmad\"=\"false\" \"no-frame-pointer-elim\"=\"true\" \"no-frame-pointer-elim-non-leaf\" \"no-infs-fp-math\"=\"false\" \"no-nans-fp-math\"=\"false\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"core2\" \"target-features\"=\"+ssse3,+cx16,+sse,+sse2,+sse3\" \"unsafe-fp-math\"=\"false\" \"use-soft-float\"=\"false\" }\nattributes #1 = { \"less-precise-fpmad\"=\"false\" \"no-frame-pointer-elim\"=\"true\" \"no-frame-pointer-elim-non-leaf\" \"no-infs-fp-math\"=\"false\" \"no-nans-fp-math\"=\"false\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"core2\" \"target-features\"=\"+ssse3,+cx16,+sse,+sse2,+sse3\" \"unsafe-fp-math\"=\"false\" \"use-soft-float\"=\"false\" }\n\n!llvm.module.flags = !{!0}\n!llvm.ident = !{!1}\n\n!0 = !{i32 1, !\"PIC Level\", i32 2}\n!1 = !{!\"Apple LLVM version 7.0.0 (clang-700.0.72)\"}\n```\n\n# \u30bd\u30fc\u30b9\u304b\u3089\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u305fbitcode\u3068\u306e\u6bd4\u8f03\n\n\u3053\u308c\u3092xcode7 beta\u306eclang\u3067\u51fa\u529b\u3057\u305fbitcode\u3068\u6bd4\u8f03\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```\n% /Applications/Xcode-beta.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang -c -emit-llvm sample.c\n```\n```\n% hexdump -C -v sample.bc\n00000000  de c0 17 0b 00 00 00 00  14 00 00 00 38 06 00 00  |............8...|\n00000010  07 00 00 01 42 43 c0 de  21 0c 00 00 8b 01 00 00  |....BC..!.......|\n00000020  0b 82 20 00 02 00 00 00  12 00 00 00 07 81 23 91  |.. ...........#.|\n\n...\n\n00000630  04 00 1c 42 12 21 31 00  02 00 00 00 0b 0a 60 08  |...B.!1.......`.|\n00000640  04 03 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|\n00000650\n```\n```\n% /usr/local/Cellar/llvm/3.6.1/bin/llvm-dis sample.bc\n```\n```\n% cat sample.ll\n; ModuleID = 'sample.bc'\ntarget datalayout = \"e-m:o-i64:64-f80:128-n8:16:32:64-S128\"\ntarget triple = \"x86_64-apple-macosx10.10.0\"\n\n@.str = private unnamed_addr constant [14 x i8] c\"Hello, World\\0A\\00\", align 1\n\n; Function Attrs: nounwind ssp uwtable\ndefine i32 @main() #0 {\n  %1 = alloca i32, align 4\n  store i32 0, i32* %1\n  %2 = call i32 (i8*, ...)* @printf(i8* getelementptr inbounds ([14 x i8]* @.str, i32 0, i32 0))\n  ret i32 0\n}\n\ndeclare i32 @printf(i8*, ...) #1\n\nattributes #0 = { nounwind ssp uwtable \"less-precise-fpmad\"=\"false\" \"no-frame-pointer-elim\"=\"true\" \"no-frame-pointer-elim-non-leaf\" \"no-infs-fp-math\"=\"false\" \"no-nans-fp-math\"=\"false\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"core2\" \"target-features\"=\"+ssse3,+cx16,+sse,+sse2,+sse3\" \"unsafe-fp-math\"=\"false\" \"use-soft-float\"=\"false\" }\nattributes #1 = { \"less-precise-fpmad\"=\"false\" \"no-frame-pointer-elim\"=\"true\" \"no-frame-pointer-elim-non-leaf\" \"no-infs-fp-math\"=\"false\" \"no-nans-fp-math\"=\"false\" \"stack-protector-buffer-size\"=\"8\" \"target-cpu\"=\"core2\" \"target-features\"=\"+ssse3,+cx16,+sse,+sse2,+sse3\" \"unsafe-fp-math\"=\"false\" \"use-soft-float\"=\"false\" }\n\n!llvm.module.flags = !{!0}\n!llvm.ident = !{!1}\n\n!0 = !{i32 1, !\"PIC Level\", i32 2}\n!1 = !{!\"Apple LLVM version 7.0.0 (clang-700.0.72)\"}\n```\n\nbitcode\u306e\u4e2d\u8eab\u3068\u30b5\u30a4\u30ba\u306f\u82e5\u5e72\u9055\u3046\u3088\u3046\u3067\u3059\u304c\u3001\u3001\u3001\n\n```\n% ls -al\n...\n-rw-r--r--   1 gamako  staff  1616  9  4 15:38 sample.bc\n-rw-r--r--   1 gamako  staff  1268  9  4 15:43 sample.ll\n-rw-r--r--   1 gamako  staff  1600  9  4 15:47 sample1.bc\n-rw-r--r--   1 gamako  staff  1269  9  4 15:55 sample1.ll\n```\n\nll\u30d5\u30a1\u30a4\u30eb\u306ediff\u3092\u3068\u3063\u3066\u307f\u308b\u3068\u308f\u304b\u308b\u3088\u3046\u306b\u3001\u4e2d\u306e\u60c5\u5831\u306f\u307b\u307c\u540c\u4e00\u3067\u3042\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n```\n% diff sample.ll sample1.ll\n1c1\n< ; ModuleID = 'sample.bc'\n---\n> ; ModuleID = 'sample1.bc'\n```\n\n# __cmdline\u30bb\u30af\u30b7\u30e7\u30f3\n\n\u4e00\u65b9__cmdline\u30bb\u30af\u30b7\u30e7\u30f3\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u3002\u30d3\u30eb\u30c9\u6642\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u306b\u307f\u3048\u307e\u3059\u3002\u3053\u308c\u3092\u30d2\u30f3\u30c8\u306b\u30b9\u30c8\u30a2\u5074\u3067\u306e\u518d\u6700\u9069\u5316\u304c\u884c\u308f\u308c\u308b\u306e\u3067\u3057\u3087\u3046\u3002\n\n```\nContents of section __cmdline:\n 0680 2d747269 706c6500 7838365f 36342d61  -triple.x86_64-a\n 0690 70706c65 2d6d6163 6f737831 302e3130  pple-macosx10.10\n 06a0 2e30002d 656d6974 2d6f626a 002d6469  .0.-emit-obj.-di\n 06b0 7361626c 652d6c6c 766d2d6f 70747a6e  sable-llvm-optzn\n 06c0 7300                                 s.\n\n```\n\n# \u6700\u5f8c\u306b\n\nXcode\u3067\u306e\u30d3\u30eb\u30c9\u306b\u3064\u3044\u3066\u306f\u3001\u3053\u3061\u3089\u3082\u53c2\u8003\u306b\u3069\u3046\u305e\n\nXcode\u3067Archive\u4ee5\u5916\u306e\u30d3\u30eb\u30c9\u7d50\u679c\u306b\u306fbitcode\u304c\u57cb\u3081\u8fbc\u307e\u308c\u306a\u3044\nhttp://qiita.com/gamako/items/66d3a8164678e525a26e\n\n\n\n", "tags": ["iOS9", "Xcode", "LLVM", "bitcode"]}