{"tags": ["openid_connect", "oauth2", "mod_auth_openidc"], "context": "\n\n\u306f\u3058\u3081\u306b\nOpenID Connect 1.0\u306eJava\u306b\u3088\u308bOP\u30b5\u30fc\u30d0\u30fc\u306e\u30b9\u30af\u30e9\u30c3\u30c1\u5b9f\u88c5\u3092Apache\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308bmod_auth_openidc\u3068\u9023\u643a\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u524d\u63d0\n\u8aac\u660e\u306e\u305f\u3081\u306bFQDN\u306fmyop.example.com\u3068\u3057\u3066\u3044\u307e\u3059\u3002\n- CentOS7\u30d9\u30fc\u30b9\n- Apache(443)\u3068Tomcat(8080)\u304c\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3053\u3068\n- Apache\u306b\u306fSSL\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u304c\u6b63\u3057\u304f\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\uff08\u91cd\u8981\uff01\uff09\n\nOP\u5074\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nOP\u30b5\u30fc\u30d0\u30fc\u306e\u30b9\u30af\u30e9\u30c3\u30c1\u5b9f\u88c5\u4f8b(myop.war)\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066/usr/share/tomcat/webapps\u914d\u4e0b\u306b\u914d\u7f6e\u3057\u307e\u3059\u3002\nhttps://github.com/namikitakeo/myop\nTomcat\u3092\u8d77\u52d5\u3057\u3066\u52d5\u4f5c\u78ba\u8a8d\u3057\u307e\u3059\u3002\nservice tomcat start\ncurl http://myop.example.com:8080/myop/.well-known/openid-configuration\n{\"response_types_supported\":[\"id_token\",\"token\",\"token id_token\"],\"scopes_supported\":[\"openid\",\"profile\",\"email\",\"address\",\"phone\"],\"issuer\":\"https://myop.example.com/myop\",\"authorization_endpoint\":\"https://myop.example.com/myop/authorize\",\"jwks_uri\":\"https://myop.example.com/myop/jwk_uri\",\"id_token_signing_alg_values_supported\":[\"RS256\"]}\ncurl http://myop.example.com:8080/myop/jwk_uri\n{\"keys\":[{\"kty\":\"RSA\",\"kid\":\"public.key\",\"use\":\"sig\",\"alg\":\"RS256\",\"n\":\"AJ56Fm5BN0rQqvRLUGhR6IBjNZWiXRpQ5FVFSgBizmQtD1wNGqjOeK0jKLtE-oTGXSbUTCkTzH1HUQcZwJJ79wGmhC04lPVUnQ0SwQl-K63mm0GgrTgZDHv55MOf_eB832Gu39iJ2QvjjGwNVgAbb3aU4V6f6KFTu6cZtKO9WHCWwbEV4VoSNJOFZyZUl-GoxC86o66PcckePzsjstjHaDtNU7zidJiKT0bZ0WtcQLbzxOY2e1KOLDCUkUmD3c-XSIREWVvpMNszNWQ9w6HkxUkCls71g_aumW7WlDCI8AkAcsJxh7nPZKJFBRMAeA2MqtbebEq3KUZVlax675R3Ouk\",\"e\":\"AQAB\"}]}\n\nRP\u5074\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nRPM\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\nhttps://github.com/pingidentity/mod_auth_openidc/releases\nhttps://dl.fedoraproject.org/pub/epel/7/x86_64/h/\nRPM\u30d5\u30a1\u30a4\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nrpm -i mod_auth_openidc-1.8.8-1.el7.centos.x86_64.rpm hiredis-0.12.1-1.el7.x86_64.rpm\n\nOP\u5074\u306e\u8a2d\u5b9a\n\uff1cLocation /myop\uff1e\nProxyPass ajp://localhost:8009/myop\nOrder allow,deny\nAllow from all\n\uff1c/Location\uff1e\n\n\nRP\u5074\u306e\u8a2d\u5b9a\nOIDCProviderMetadataURL https://myop.example.com/myop/.well-known/openid-configuration\nOIDCClientID myop\nOIDCClientSecret password\nOIDCRedirectURI https://myop.example.com/cgi-bin/redirect_uri\nOIDCCryptoPassphrase \uff1cpassword\uff1e\nOIDCResponseType \"token id_token\"\nOIDCScope \"openid profile phone email address\"\nOIDCAuthRequestParams prompt=consent\n# OIDCAuthRequestParams prompt=login%20consent\n# OIDCAuthRequestParams prompt=login&login_hint=george\n\n\uff1cLocation /cgi-bin\\\uff1e\nAuthType openid-connect\nRequire valid-user\n\uff1c/Location\uff1e\n\n\nRS\u5074\u306e\u8a2d\u5b9a\nOIDCOAuthIntrospectionEndpoint https://myop.example.com/myop/tokeninfo\nOIDCOAuthIntrospectionEndpointMethod GET\nOIDCOAuthIntrospectionTokenParamName access_token\nOIDCOAuthRemoteUserClaim openid\n# OIDCSSLValidateServer Off\n\n\uff1cLocation /myrs\uff1e\nAuthtype oauth20\nRequire claim scope:openid\n# Require claim openid:george\n# Require claim issued_to:myop\nProxyPass ajp://localhost:8009/myop\nOrder allow,deny\nAllow from all\n\uff1c/Location\uff1e\n\n\n\u52d5\u4f5c\u78ba\u8a8d\n\u30c6\u30b9\u30c8\u7528CGI(landing)\u3092\u7528\u610f\u3057\u3066\u4ee5\u4e0b\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002/cgi-bin\u914d\u4e0b\u306fmod_auth_openidc\u3067\u4fdd\u8b77\u3055\u308c\u3066\u3044\u308b\u306e\u3067OP\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u307e\u3059\u3002george/costanza\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308c\u3070\u6210\u529f\u3067\u3059\u3002\nhttps://myop.example.com/cgi-bin/landing\n#!/usr/bin/perl\nprint \"Content-type: text/html; charset=UTF-8\\n\\n\";\nprint \"\";\nprint \"\uff1chead\uff1e\";\nprint \"\uff1c/head\uff1e\";\nprint \"\uff1cbody\uff1e\";\n$val = $ENV{$var};\n$val =~ s|\\n|\\\\n|g;\n$val =~ s|\"|\\\\\"|g;\nprint \"Hello, \";\nprint \"$ENV{\\\"OIDC_CLAIM_sub\\\"}\";\nprint \"curl -k https://myop.example.com/myop/.well-known/openid-configuration\";\nprint \"curl -k https://myop.example.com/myop/tokeninfo?access_token=$ENV{\\\"OIDC_access_token\\\"}\";\nprint \"curl -k -H \\\"Authorization: Bearer $ENV{\\\"OIDC_access_token\\\"}\\\" https://myop.example.com/myrs/userinfo\";\n\nprint \"\uff1ca href=\\\"https://myop.example.com/cgi-bin/redirect_uri?logout=https://myop.example.com/myop/logout\\\"\uff1elogout\uff1c/a\uff1e\";\nprint \"\uff1c/body\uff1e\";\nprint \"\uff1c/html\uff1e\";\n\n\n\u6700\u5f8c\u306b\n\u308f\u304b\u308a\u305a\u3089\u3044\u90e8\u5206\u304c\u3042\u308a\u307e\u3057\u305f\u3089\u8ffd\u8a18\u3044\u305f\u3057\u307e\u3059\u3002\n#\u306f\u3058\u3081\u306b\nOpenID Connect 1.0\u306eJava\u306b\u3088\u308bOP\u30b5\u30fc\u30d0\u30fc\u306e\u30b9\u30af\u30e9\u30c3\u30c1\u5b9f\u88c5\u3092Apache\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308bmod_auth_openidc\u3068\u9023\u643a\u3057\u3066\u307f\u307e\u3059\u3002\n\n#\u524d\u63d0\n\u8aac\u660e\u306e\u305f\u3081\u306bFQDN\u306fmyop.example.com\u3068\u3057\u3066\u3044\u307e\u3059\u3002\n- CentOS7\u30d9\u30fc\u30b9\n- Apache(443)\u3068Tomcat(8080)\u304c\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3053\u3068\n- Apache\u306b\u306fSSL\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u304c\u6b63\u3057\u304f\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\uff08\u91cd\u8981\uff01\uff09\n\n#OP\u5074\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nOP\u30b5\u30fc\u30d0\u30fc\u306e\u30b9\u30af\u30e9\u30c3\u30c1\u5b9f\u88c5\u4f8b(myop.war)\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066/usr/share/tomcat/webapps\u914d\u4e0b\u306b\u914d\u7f6e\u3057\u307e\u3059\u3002\nhttps://github.com/namikitakeo/myop\n\nTomcat\u3092\u8d77\u52d5\u3057\u3066\u52d5\u4f5c\u78ba\u8a8d\u3057\u307e\u3059\u3002\nservice tomcat start\ncurl http://myop.example.com:8080/myop/.well-known/openid-configuration\n\n{\"response_types_supported\":[\"id_token\",\"token\",\"token id_token\"],\"scopes_supported\":[\"openid\",\"profile\",\"email\",\"address\",\"phone\"],\"issuer\":\"https://myop.example.com/myop\",\"authorization_endpoint\":\"https://myop.example.com/myop/authorize\",\"jwks_uri\":\"https://myop.example.com/myop/jwk_uri\",\"id_token_signing_alg_values_supported\":[\"RS256\"]}\n\ncurl http://myop.example.com:8080/myop/jwk_uri\n{\"keys\":[{\"kty\":\"RSA\",\"kid\":\"public.key\",\"use\":\"sig\",\"alg\":\"RS256\",\"n\":\"AJ56Fm5BN0rQqvRLUGhR6IBjNZWiXRpQ5FVFSgBizmQtD1wNGqjOeK0jKLtE-oTGXSbUTCkTzH1HUQcZwJJ79wGmhC04lPVUnQ0SwQl-K63mm0GgrTgZDHv55MOf_eB832Gu39iJ2QvjjGwNVgAbb3aU4V6f6KFTu6cZtKO9WHCWwbEV4VoSNJOFZyZUl-GoxC86o66PcckePzsjstjHaDtNU7zidJiKT0bZ0WtcQLbzxOY2e1KOLDCUkUmD3c-XSIREWVvpMNszNWQ9w6HkxUkCls71g_aumW7WlDCI8AkAcsJxh7nPZKJFBRMAeA2MqtbebEq3KUZVlax675R3Ouk\",\"e\":\"AQAB\"}]}\n\n#RP\u5074\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nRPM\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\nhttps://github.com/pingidentity/mod_auth_openidc/releases\nhttps://dl.fedoraproject.org/pub/epel/7/x86_64/h/\n\nRPM\u30d5\u30a1\u30a4\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nrpm -i mod_auth_openidc-1.8.8-1.el7.centos.x86_64.rpm hiredis-0.12.1-1.el7.x86_64.rpm\n\n#OP\u5074\u306e\u8a2d\u5b9a\n<pre>\n\uff1cLocation /myop\uff1e\nProxyPass ajp://localhost:8009/myop\nOrder allow,deny\nAllow from all\n\uff1c/Location\uff1e\n</pre>\n\n#RP\u5074\u306e\u8a2d\u5b9a\n<pre>\nOIDCProviderMetadataURL https://myop.example.com/myop/.well-known/openid-configuration\nOIDCClientID myop\nOIDCClientSecret password\nOIDCRedirectURI https://myop.example.com/cgi-bin/redirect_uri\nOIDCCryptoPassphrase \uff1cpassword\uff1e\nOIDCResponseType \"token id_token\"\nOIDCScope \"openid profile phone email address\"\nOIDCAuthRequestParams prompt=consent\n# OIDCAuthRequestParams prompt=login%20consent\n# OIDCAuthRequestParams prompt=login&login_hint=george\n\n\uff1cLocation /cgi-bin\\\uff1e\nAuthType openid-connect\nRequire valid-user\n\uff1c/Location\uff1e\n</pre>\n\n#RS\u5074\u306e\u8a2d\u5b9a\n<pre>\nOIDCOAuthIntrospectionEndpoint https://myop.example.com/myop/tokeninfo\nOIDCOAuthIntrospectionEndpointMethod GET\nOIDCOAuthIntrospectionTokenParamName access_token\nOIDCOAuthRemoteUserClaim openid\n# OIDCSSLValidateServer Off\n\n\uff1cLocation /myrs\uff1e\nAuthtype oauth20\nRequire claim scope:openid\n# Require claim openid:george\n# Require claim issued_to:myop\nProxyPass ajp://localhost:8009/myop\nOrder allow,deny\nAllow from all\n\uff1c/Location\uff1e\n</pre>\n\n#\u52d5\u4f5c\u78ba\u8a8d\n\u30c6\u30b9\u30c8\u7528CGI(landing)\u3092\u7528\u610f\u3057\u3066\u4ee5\u4e0b\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002/cgi-bin\u914d\u4e0b\u306fmod_auth_openidc\u3067\u4fdd\u8b77\u3055\u308c\u3066\u3044\u308b\u306e\u3067OP\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u307e\u3059\u3002george/costanza\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308c\u3070\u6210\u529f\u3067\u3059\u3002\nhttps://myop.example.com/cgi-bin/landing\n\n<pre>\n#!/usr/bin/perl\nprint \"Content-type: text/html; charset=UTF-8\\n\\n\";\nprint \"<html>\";\nprint \"\uff1chead\uff1e\";\nprint \"\uff1c/head\uff1e\";\nprint \"\uff1cbody\uff1e\";\n$val = $ENV{$var};\n$val =~ s|\\n|\\\\n|g;\n$val =~ s|\"|\\\\\"|g;\nprint \"Hello, \";\nprint \"$ENV{\\\"OIDC_CLAIM_sub\\\"}<p>\";\nprint \"curl -k https://myop.example.com/myop/.well-known/openid-configuration<p>\";\nprint \"curl -k https://myop.example.com/myop/tokeninfo?access_token=$ENV{\\\"OIDC_access_token\\\"}<p>\";\nprint \"curl -k -H \\\"Authorization: Bearer $ENV{\\\"OIDC_access_token\\\"}\\\" https://myop.example.com/myrs/userinfo<p>\";\n\nprint \"\uff1ca href=\\\"https://myop.example.com/cgi-bin/redirect_uri?logout=https://myop.example.com/myop/logout\\\"\uff1elogout\uff1c/a\uff1e\";\nprint \"\uff1c/body\uff1e\";\nprint \"\uff1c/html\uff1e\";\n</pre>\n\n#\u6700\u5f8c\u306b\n\u308f\u304b\u308a\u305a\u3089\u3044\u90e8\u5206\u304c\u3042\u308a\u307e\u3057\u305f\u3089\u8ffd\u8a18\u3044\u305f\u3057\u307e\u3059\u3002\n"}