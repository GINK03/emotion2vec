{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u306a\u3093\u3067Active Directory\u3058\u3083\u306a\u3044\u306e\u3001\u3068\u3044\u3046\u3064\u3063\u3053\u307f\u306f\u306a\u3057\u3067\u304a\u9858\u3044\u3057\u307e\u3059(;>\u03c9<)\nWMI\u304b\u3089\u30e6\u30fc\u30b6\u540d\u3092\u53d6\u5f97\u3057\u3066\u3001ner user \u3067\u5730\u9053\u306b\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u51fa\u529b\u5f62\u5f0f\n\nYYYYMMDD_\u30b5\u30fc\u30d0\u540d.csv\n\"\u30e6\u30fc\u30b6\u540d\",\"\u30a2\u30ab\u30a6\u30f3\u30c8\u6709\u52b9\",\"\u6700\u7d42\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u65e5\u6642\",\"\u30d1\u30b9\u30ef\u30fc\u30c9\u6709\u52b9\u671f\u9593\",\"\u6700\u7d42\u30ed\u30b0\u30aa\u30f3\u65e5\u6642\",\"\u6240\u5c5e\u30b0\u30eb\u30fc\u30d7\"\n\"Administrator\",\"Yes\",\"2015/09/01\",\"2015/10/13\",\"2015/09/17\",\"*Administrators\u3000\"\n\n\n\n\u30bd\u30fc\u30b9\n\nuserdataList.ps1\n#\u51fa\u529b\u30d1\u30b9\u4f5c\u6210\n$d = Get-Date -Format \"yyyyMMdd\"\n$mypath = Split-Path $myInvocation.MyCommand.Path -Parent\n$path = $mypath + $d + \"_\" + $env:computerName + \".csv\"\n\n#WMI\u3092\u53d6\u308a\u51fa\u3059\n$WMIResult = Get-WmiObject -q \"SELECT Name From Win32_UserAccount Where LocalAccount=True\"\n\n#\u30ab\u30b9\u30bf\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8(\u8981\u7d20\u306e\u5165\u308c\u7269)\n$Datas = New-Object System.Collections.ArrayList\n\n$WMIResult | %{ ($_.name) } | %{\n\n        # \u30ab\u30b9\u30bf\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u8981\u7d20\u4f5c\u6210\n        $Data = New-Object PSObject | Select-Object \u30e6\u30fc\u30b6\u540d, \u30a2\u30ab\u30a6\u30f3\u30c8\u6709\u52b9, \u6700\u7d42\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u65e5\u6642,\u30d1\u30b9\u30ef\u30fc\u30c9\u6709\u52b9\u671f\u9593,\u6700\u7d42\u30ed\u30b0\u30aa\u30f3\u65e5\u6642,\u6240\u5c5e\u30b0\u30eb\u30fc\u30d7\n\n        #\u30e6\u30fc\u30b6\u60c5\u5831\u306e\u53d6\u5f97\n        $detailUser = net user $_\n\n        #\u30ab\u30b9\u30bf\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u8981\u7d20\u306b\u5024\u3092\u8a2d\u5b9a\n        $Data.\u30e6\u30fc\u30b6\u540d =  ($detailUser[0] -replace '\\s+','\u25a0').Split(\"\u25a0\")[1]     \n        $Data.\u30a2\u30ab\u30a6\u30f3\u30c8\u6709\u52b9 =  ($detailUser[5] -replace '\\s+','\u25a0').Split(\"\u25a0\")[1]  \n        $Data.\u6700\u7d42\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u65e5\u6642 = ($detailUser[8] -replace '\\s+','\u25a0').Split(\"\u25a0\")[1]     \n        $Data.\u30d1\u30b9\u30ef\u30fc\u30c9\u6709\u52b9\u671f\u9593 = ($detailUser[9] -replace '\\s+','\u25a0').Split(\"\u25a0\")[1] \n        $Data.\u6700\u7d42\u30ed\u30b0\u30aa\u30f3\u65e5\u6642 = ($detailUser[18] -replace '\\s+','\u25a0').Split(\"\u25a0\")[1] \n\n        #\u30ed\u30fc\u30ab\u30eb\u30b0\u30eb\u30fc\u30d7\u306f\u53ef\u5909\u306a\u306e\u3067\u3001\u76f4\u5f8c\u306e\u30b0\u30ed\u30fc\u30d0\u30eb\u30b0\u30eb\u30fc\u30d7\u306e\u958b\u59cb\u4f4d\u7f6e\u3092\u53d6\u5f97\u3059\u308b\n        #\u521d\u671f\u5024\n        $count = 0\n\n        $ln = foreach($e In $detailUser){if ($e -match \"\u30b0\u30ed\u30fc\u30d0\u30eb\"){$count}$count += 1}\n        $joinGroup = \"\"\n        for ($i=0; $i -lt ($ln - 22) ; $i++){\n\n           $hoge = ($detailUser[22+$i] -replace '\\s+','')\n           $joinGroup += $hoge.Substring($hoge.IndexOf(\"*\")) + \"\u3000\"\n\n        }\n\n        $Data.\u6240\u5c5e\u30b0\u30eb\u30fc\u30d7 = $joinGroup\n\n        # \u30ab\u30b9\u30bf\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u8981\u7d20\u3092\u8ffd\u52a0\n        [void]$Datas.Add($Data)    \n\n } \n $Datas |Export-Csv -Path $path -EnCoding default -Force -NoTypeInformation\n\n\n\n\u30ab\u30b9\u30bf\u30e0\n\u4ed6\u306e\u60c5\u5831\u304c\u5fc5\u8981\u306a\u5834\u5408\u306f\u3001\u4e0b\u8a18\u3092\u3082\u3068\u306b\u300c\u30ab\u30b9\u30bf\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u8981\u7d20\u4f5c\u6210/\u5024\u3092\u8a2d\u5b9a\u300d\u8fba\u308a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\n\n\n\u884c\u756a\u53f7($detailUser)\n\u60c5\u5831($Data.)\n\n\n\n\n0\n\u30e6\u30fc\u30b6\u30fc\u540d\n\n\n1\n\u30d5\u30eb \u30cd\u30fc\u30e0\n\n\n2\n\u30b3\u30e1\u30f3\u30c8\n\n\n3\n\u30e6\u30fc\u30b6\u30fc\u306e\u30b3\u30e1\u30f3\u30c8\n\n\n4\n\u56fd\u30b3\u30fc\u30c9\n\n\n5\n\u30a2\u30ab\u30a6\u30f3\u30c8\u6709\u52b9\n\n\n6\n\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u671f\u9650\n\n\n7\n(\u7a7a\u884c)\n\n\n8\n\u6700\u7d42\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u65e5\u6642\n\n\n9\n\u30d1\u30b9\u30ef\u30fc\u30c9\u6709\u52b9\u671f\u9593\n\n\n10\n\u30d1\u30b9\u30ef\u30fc\u30c9\u6b21\u56de\u5909\u66f4\u53ef\u80fd\u65e5\u6642\n\n\n11\n\u30d1\u30b9\u30ef\u30fc\u30c9\u3042\u308a\n\n\n12\n\u30e6\u30fc\u30b6\u30fc\u306b\u3088\u308b\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u53ef\u80fd\n\n\n13\n(\u7a7a\u884c)\n\n\n14\n\u30ed\u30b0\u30aa\u30f3\u53ef\u80fd\u306a\u30ef\u30fc\u30af\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3\n\n\n15\n\u30ed\u30b0\u30aa\u30f3 \u30b9\u30af\u30ea\u30d7\u30c8\n\n\n16\n\u30e6\u30fc\u30b6\u30fc \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\n\n\n17\n\u30db\u30fc\u30e0 \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n\n\n18\n\u6700\u7d42\u30ed\u30b0\u30aa\u30f3\u65e5\u6642\n\n\n19\n(\u7a7a\u884c)\n\n\n20\n\u30ed\u30b0\u30aa\u30f3\u53ef\u80fd\u6642\u9593\n\n\n21\n(\u7a7a\u884c)\n\n\n22\n\u6240\u5c5e\u3057\u3066\u3044\u308b\u30ed\u30fc\u30ab\u30eb \u30b0\u30eb\u30fc\u30d7\n\n\n\n\n\n\n\n\u6240\u5c5e\u3057\u3066\u3044\u308b\u30b0\u30ed\u30fc\u30d0\u30eb \u30b0\u30eb\u30fc\u30d7\n\n\n\n# \u306f\u3058\u3081\u306b\n\u306a\u3093\u3067Active Directory\u3058\u3083\u306a\u3044\u306e\u3001\u3068\u3044\u3046\u3064\u3063\u3053\u307f\u306f\u306a\u3057\u3067\u304a\u9858\u3044\u3057\u307e\u3059(;>\u03c9<)\nWMI\u304b\u3089\u30e6\u30fc\u30b6\u540d\u3092\u53d6\u5f97\u3057\u3066\u3001```ner user``` \u3067\u5730\u9053\u306b\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066\u3044\u307e\u3059\u3002\n\n# \u51fa\u529b\u5f62\u5f0f\n\n```YYYYMMDD_\u30b5\u30fc\u30d0\u540d.csv\n\"\u30e6\u30fc\u30b6\u540d\",\"\u30a2\u30ab\u30a6\u30f3\u30c8\u6709\u52b9\",\"\u6700\u7d42\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u65e5\u6642\",\"\u30d1\u30b9\u30ef\u30fc\u30c9\u6709\u52b9\u671f\u9593\",\"\u6700\u7d42\u30ed\u30b0\u30aa\u30f3\u65e5\u6642\",\"\u6240\u5c5e\u30b0\u30eb\u30fc\u30d7\"\n\"Administrator\",\"Yes\",\"2015/09/01\",\"2015/10/13\",\"2015/09/17\",\"*Administrators\u3000\"\n```\n# \u30bd\u30fc\u30b9\n\n```userdataList.ps1\n#\u51fa\u529b\u30d1\u30b9\u4f5c\u6210\n$d = Get-Date -Format \"yyyyMMdd\"\n$mypath = Split-Path $myInvocation.MyCommand.Path -Parent\n$path = $mypath + $d + \"_\" + $env:computerName + \".csv\"\n\n#WMI\u3092\u53d6\u308a\u51fa\u3059\n$WMIResult = Get-WmiObject -q \"SELECT Name From Win32_UserAccount Where LocalAccount=True\"\n\n#\u30ab\u30b9\u30bf\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8(\u8981\u7d20\u306e\u5165\u308c\u7269)\n$Datas = New-Object System.Collections.ArrayList\n\n$WMIResult | %{ ($_.name) } | %{\n\n        # \u30ab\u30b9\u30bf\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u8981\u7d20\u4f5c\u6210\n        $Data = New-Object PSObject | Select-Object \u30e6\u30fc\u30b6\u540d, \u30a2\u30ab\u30a6\u30f3\u30c8\u6709\u52b9, \u6700\u7d42\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u65e5\u6642,\u30d1\u30b9\u30ef\u30fc\u30c9\u6709\u52b9\u671f\u9593,\u6700\u7d42\u30ed\u30b0\u30aa\u30f3\u65e5\u6642,\u6240\u5c5e\u30b0\u30eb\u30fc\u30d7\n\n        #\u30e6\u30fc\u30b6\u60c5\u5831\u306e\u53d6\u5f97\n        $detailUser = net user $_\n       \n        #\u30ab\u30b9\u30bf\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u8981\u7d20\u306b\u5024\u3092\u8a2d\u5b9a\n        $Data.\u30e6\u30fc\u30b6\u540d =  ($detailUser[0] -replace '\\s+','\u25a0').Split(\"\u25a0\")[1]     \n        $Data.\u30a2\u30ab\u30a6\u30f3\u30c8\u6709\u52b9 =  ($detailUser[5] -replace '\\s+','\u25a0').Split(\"\u25a0\")[1]  \n        $Data.\u6700\u7d42\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u65e5\u6642 = ($detailUser[8] -replace '\\s+','\u25a0').Split(\"\u25a0\")[1]     \n        $Data.\u30d1\u30b9\u30ef\u30fc\u30c9\u6709\u52b9\u671f\u9593 = ($detailUser[9] -replace '\\s+','\u25a0').Split(\"\u25a0\")[1] \n        $Data.\u6700\u7d42\u30ed\u30b0\u30aa\u30f3\u65e5\u6642 = ($detailUser[18] -replace '\\s+','\u25a0').Split(\"\u25a0\")[1] \n        \n        #\u30ed\u30fc\u30ab\u30eb\u30b0\u30eb\u30fc\u30d7\u306f\u53ef\u5909\u306a\u306e\u3067\u3001\u76f4\u5f8c\u306e\u30b0\u30ed\u30fc\u30d0\u30eb\u30b0\u30eb\u30fc\u30d7\u306e\u958b\u59cb\u4f4d\u7f6e\u3092\u53d6\u5f97\u3059\u308b\n        #\u521d\u671f\u5024\n        $count = 0\n        \n        $ln = foreach($e In $detailUser){if ($e -match \"\u30b0\u30ed\u30fc\u30d0\u30eb\"){$count}$count += 1}\n        $joinGroup = \"\"\n        for ($i=0; $i -lt ($ln - 22) ; $i++){\n           \n           $hoge = ($detailUser[22+$i] -replace '\\s+','')\n           $joinGroup += $hoge.Substring($hoge.IndexOf(\"*\")) + \"\u3000\"\n           \n        }\n        \n        $Data.\u6240\u5c5e\u30b0\u30eb\u30fc\u30d7 = $joinGroup\n        \n        # \u30ab\u30b9\u30bf\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u8981\u7d20\u3092\u8ffd\u52a0\n        [void]$Datas.Add($Data)    \n      \n } \n $Datas |Export-Csv -Path $path -EnCoding default -Force -NoTypeInformation\n```\n\n# \u30ab\u30b9\u30bf\u30e0\n\u4ed6\u306e\u60c5\u5831\u304c\u5fc5\u8981\u306a\u5834\u5408\u306f\u3001\u4e0b\u8a18\u3092\u3082\u3068\u306b\u300c\u30ab\u30b9\u30bf\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u8981\u7d20\u4f5c\u6210/\u5024\u3092\u8a2d\u5b9a\u300d\u8fba\u308a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\n| \u884c\u756a\u53f7($detailUser) | \u60c5\u5831($Data.) |\n|:-----------|:------------|\n|0|\u30e6\u30fc\u30b6\u30fc\u540d                         |\n|1|\u30d5\u30eb \u30cd\u30fc\u30e0                        |\n|2|\u30b3\u30e1\u30f3\u30c8                           |\n|3|\u30e6\u30fc\u30b6\u30fc\u306e\u30b3\u30e1\u30f3\u30c8                 |\n|4|\u56fd\u30b3\u30fc\u30c9                           |\n|5|\u30a2\u30ab\u30a6\u30f3\u30c8\u6709\u52b9                     |\n|6|\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u671f\u9650                   |\n|7|(\u7a7a\u884c)                           |\n|8|\u6700\u7d42\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u65e5\u6642             |\n|9|\u30d1\u30b9\u30ef\u30fc\u30c9\u6709\u52b9\u671f\u9593                 |\n|10|\u30d1\u30b9\u30ef\u30fc\u30c9\u6b21\u56de\u5909\u66f4\u53ef\u80fd\u65e5\u6642        |\n|11|\u30d1\u30b9\u30ef\u30fc\u30c9\u3042\u308a                    |\n|12|\u30e6\u30fc\u30b6\u30fc\u306b\u3088\u308b\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u53ef\u80fd  |\n|13|(\u7a7a\u884c)                          |\n|14|\u30ed\u30b0\u30aa\u30f3\u53ef\u80fd\u306a\u30ef\u30fc\u30af\u30b9\u30c6\u30fc\u30b7\u30e7\u30f3  |\n|15|\u30ed\u30b0\u30aa\u30f3 \u30b9\u30af\u30ea\u30d7\u30c8               |\n|16|\u30e6\u30fc\u30b6\u30fc \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb             |\n|17|\u30db\u30fc\u30e0 \u30c7\u30a3\u30ec\u30af\u30c8\u30ea               |\n|18|\u6700\u7d42\u30ed\u30b0\u30aa\u30f3\u65e5\u6642                  |\n|19|(\u7a7a\u884c)                      |\n|20|\u30ed\u30b0\u30aa\u30f3\u53ef\u80fd\u6642\u9593                  |\n|21|(\u7a7a\u884c)                            |\n|22|\u6240\u5c5e\u3057\u3066\u3044\u308b\u30ed\u30fc\u30ab\u30eb \u30b0\u30eb\u30fc\u30d7     |\n|  |                                  |\n|  |\u6240\u5c5e\u3057\u3066\u3044\u308b\u30b0\u30ed\u30fc\u30d0\u30eb \u30b0\u30eb\u30fc\u30d7   | \n", "tags": ["PowerShell", "CSV", "WMI"]}