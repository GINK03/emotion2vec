{"tags": ["collectd", "AWS", "CloudWatch"], "context": "CloudWatch\u306e\u6a19\u6e96\u30e1\u30c8\u30ea\u30c3\u30af\u3067\u306f\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u3068disk\u4f7f\u7528\u91cf\u304c\u53d6\u308c\u306a\u3044\u306e\u3067\n\u3053\u308c\u307e\u3067\u306f\n\u516c\u5f0f\u306eCloudWatchMonitoringScripts \u3092cron\u3067cloudwatch\u306bput\u3057\u3066\u3044\u304f\u5fc5\u8981\u304c\u3042\u3063\u305f\n\u3042\u3068perl\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u8272\u3005\u5fc5\u8981\n\uff08\u53e4\u3044\u305b\u3044\u306a\u306e\u304b\u6700\u65b0\u306eamazonlinux\u3067\u306f\u8272\u3005\u8db3\u308a\u306a\u304b\u3063\u305f\uff09\n\u3081\u3093\u3069\u304f\u3055\u3044\u306e\u3067\u4f55\u304b\u65b0\u3057\u3044\u3084\u308a\u65b9\u306a\u3044\u304b\u306a\u3068\u601d\u3063\u3066\u3044\u305f\u3068\u3053\u308d\n\u516c\u5f0f\u3067collectd\u306e\u8a18\u4e8b\u304c\uff01\n\u3057\u304b\u3057amazonlinux\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u304b\u3089\u5f15\u3063\u5f35\u3063\u3066\u3053\u308c\u308bcollectd\u306f\u307e\u30605.4.1\n5.5\u4ee5\u964d\u3067\u306a\u3044\u3068df\u304c\u53d6\u308c\u306a\u3044\u3089\u3057\u3044\n\u65b0\u3057\u3044 collectd \u306e CloudWatch \u30d7\u30e9\u30b0\u30a4\u30f3\n\u306a\u306e\u3067collectd\u306e\u516c\u5f0f\u304b\u3089\u6700\u65b0\u3092\u5f15\u3063\u5f35\u3063\u3066\u3053\u3088\u3046\n\ncollectd\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ wget https://storage.googleapis.com/collectd-tarballs/collectd-5.6.1.tar.bz2   or  collectd-5.5.2.tar.bz2\n$ tar xvf collectd-5.6.1.tar.bz2\n$ cd collectd-5.6.1\n$ ./configure\n$ make\n\n\u30a8\u30e9\u30fc\u304c\u767a\u751f\nCan't locate ExtUtils/MakeMaker.pm in @INC\n\nperl\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo yum install perl-ExtUtils-MakeMaker\n\n$ make clean\n$ ./configure\n$ make && make install\n\n\nCloudWatch-Plugin\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ git clone https://github.com/awslabs/collectd-cloudwatch.git\n$ collectd-cloudwatch\n$ ./src/setup.py\n\nInstalling dependencies ... OK\nInstalling python dependencies ... OK\nDownloading plugin ... OK\nExtracting plugin ... OK\nMoving to collectd plugins directory ... OK\nCopying CloudWatch plugin include file ... OK\n\nChoose AWS region for published metrics:\n  1. Automatic [ap-northeast-1]\n  2. Custom\nEnter choice [1]: 1\n\nChoose hostname for published metrics:\n  1. EC2 instance id [\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID]\n  2. Custom\nEnter choice [1]: 1\n\nChoose authentication method:\n  1. IAM Role [\u30ed\u30fc\u30eb\u540d]\n  2. IAM User\nEnter choice [1]: 1\n\nChoose how to install CloudWatch plugin in collectd:\n  1. Do not modify existing collectd configuration\n  2. Add plugin to the existing configuration\n  3. Use CloudWatch recommended configuration (4 metrics)\nEnter choice [3]: 3\nPlugin configuration written successfully.\nCreating backup of the original configuration ... OK\nReplacing collectd configuration ... OK\nReplacing whitelist configuration ... OK\nStopping collectd process ... NOT OK\nStarting collectd process ... OK\n\n/opt/collectd-plugins/cloudwatch/config/whitelist.conf\n\u306b\u306f\u65e2\u306b\u4ee5\u4e0b\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u5165\u3063\u3066\u3044\u308b\u306e\u3067cloudwatch\u3067\u3057\u3070\u3089\u304f\u5f85\u3064\u3068\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308b\ndf-root-percent_bytes-used\nmemory--percent-used\nswap--percent-used\ncpu--percent-active\n\n\u5f8c\u306fcollectd\u3092daemon\u767b\u9332\u3057\u3066\u5b8c\u4e86\nautoscale\u3084AMI\u30b3\u30d4\u30fc\u3060\u3068\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\u304c\u9055\u3046\u305f\u3081\u52d5\u304b\u306a\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u306e\u3067\n\u518d\u5ea6plugin\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3092\u3059\u308b\u3068\u3088\u3044\nCloudWatch\u306e\u6a19\u6e96\u30e1\u30c8\u30ea\u30c3\u30af\u3067\u306f\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u3068disk\u4f7f\u7528\u91cf\u304c\u53d6\u308c\u306a\u3044\u306e\u3067\n\u3053\u308c\u307e\u3067\u306f\n\u516c\u5f0f\u306eCloudWatchMonitoringScripts \u3092cron\u3067cloudwatch\u306bput\u3057\u3066\u3044\u304f\u5fc5\u8981\u304c\u3042\u3063\u305f\n\u3042\u3068perl\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u8272\u3005\u5fc5\u8981\n\uff08\u53e4\u3044\u305b\u3044\u306a\u306e\u304b\u6700\u65b0\u306eamazonlinux\u3067\u306f\u8272\u3005\u8db3\u308a\u306a\u304b\u3063\u305f\uff09\n\n\u3081\u3093\u3069\u304f\u3055\u3044\u306e\u3067\u4f55\u304b\u65b0\u3057\u3044\u3084\u308a\u65b9\u306a\u3044\u304b\u306a\u3068\u601d\u3063\u3066\u3044\u305f\u3068\u3053\u308d\n\u516c\u5f0f\u3067collectd\u306e\u8a18\u4e8b\u304c\uff01\n\n\u3057\u304b\u3057amazonlinux\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u304b\u3089\u5f15\u3063\u5f35\u3063\u3066\u3053\u308c\u308bcollectd\u306f\u307e\u30605.4.1\n5.5\u4ee5\u964d\u3067\u306a\u3044\u3068df\u304c\u53d6\u308c\u306a\u3044\u3089\u3057\u3044\n[\u65b0\u3057\u3044 collectd \u306e CloudWatch \u30d7\u30e9\u30b0\u30a4\u30f3](https://aws.amazon.com/jp/blogs/news/new-cloudwatch-plugin-for-collectd/)\n\n\u306a\u306e\u3067collectd\u306e\u516c\u5f0f\u304b\u3089\u6700\u65b0\u3092\u5f15\u3063\u5f35\u3063\u3066\u3053\u3088\u3046\n\n## collectd\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```\n$ wget https://storage.googleapis.com/collectd-tarballs/collectd-5.6.1.tar.bz2   or  collectd-5.5.2.tar.bz2\n$ tar xvf collectd-5.6.1.tar.bz2\n$ cd collectd-5.6.1\n$ ./configure\n$ make\n```\n\n\u30a8\u30e9\u30fc\u304c\u767a\u751f\n\n```\nCan't locate ExtUtils/MakeMaker.pm in @INC\n```\n\nperl\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n$ sudo yum install perl-ExtUtils-MakeMaker\n```\n\n```\n$ make clean\n$ ./configure\n$ make && make install\n```\n\n## CloudWatch-Plugin\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```\n$ git clone https://github.com/awslabs/collectd-cloudwatch.git\n$ collectd-cloudwatch\n$ ./src/setup.py\n```\n\n```\nInstalling dependencies ... OK\nInstalling python dependencies ... OK\nDownloading plugin ... OK\nExtracting plugin ... OK\nMoving to collectd plugins directory ... OK\nCopying CloudWatch plugin include file ... OK\n\nChoose AWS region for published metrics:\n  1. Automatic [ap-northeast-1]\n  2. Custom\nEnter choice [1]: 1\n\nChoose hostname for published metrics:\n  1. EC2 instance id [\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID]\n  2. Custom\nEnter choice [1]: 1\n\nChoose authentication method:\n  1. IAM Role [\u30ed\u30fc\u30eb\u540d]\n  2. IAM User\nEnter choice [1]: 1\n\nChoose how to install CloudWatch plugin in collectd:\n  1. Do not modify existing collectd configuration\n  2. Add plugin to the existing configuration\n  3. Use CloudWatch recommended configuration (4 metrics)\nEnter choice [3]: 3\nPlugin configuration written successfully.\nCreating backup of the original configuration ... OK\nReplacing collectd configuration ... OK\nReplacing whitelist configuration ... OK\nStopping collectd process ... NOT OK\nStarting collectd process ... OK\n```\n\n`/opt/collectd-plugins/cloudwatch/config/whitelist.conf`\n\u306b\u306f\u65e2\u306b\u4ee5\u4e0b\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u5165\u3063\u3066\u3044\u308b\u306e\u3067cloudwatch\u3067\u3057\u3070\u3089\u304f\u5f85\u3064\u3068\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308b\n\n```\ndf-root-percent_bytes-used\nmemory--percent-used\nswap--percent-used\ncpu--percent-active\n```\n\n\u5f8c\u306fcollectd\u3092daemon\u767b\u9332\u3057\u3066\u5b8c\u4e86\n\nautoscale\u3084AMI\u30b3\u30d4\u30fc\u3060\u3068\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\u304c\u9055\u3046\u305f\u3081\u52d5\u304b\u306a\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u306e\u3067\n\u518d\u5ea6plugin\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3092\u3059\u308b\u3068\u3088\u3044\n"}