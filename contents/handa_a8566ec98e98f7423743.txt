{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u691c\u8a3c\u3067\u305f\u307e\u306b\u74b0\u5883\u304c\u5fc5\u8981\u306b\u306a\u308b\u3053\u3068\u304c\u3042\u308b\u306e\u3067\u3001vCenter Server 5.5\u3092EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308bCloudFormation\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\nAWS Management Portal for vCenter \u306e\u691c\u8a3c\u74b0\u5883\u3092\u4f5c\u308b\u3068\u304d\u306a\u3069\u306b\u304a\u3059\u3059\u3081\u3067\u3059\u3002\n\u306a\u304a\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306f\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u3092\u3057\u3066\u3044\u307e\u3059\u3002\n\uff08\u9700\u8981\u304c\u3042\u308b\u306e\u304b\u308f\u304b\u308a\u307e\u305b\u3093\u304c\uff09\u4ed6\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u672a\u78ba\u8a8d\u3067\u3059\u306e\u3067\u3054\u6ce8\u610f\u304f\u3060\u3055\u3044\u3002\n\n\u4f7f\u3044\u65b9\n\n\u4e8b\u524d\u6e96\u5099\nvCenter Server \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30e1\u30c7\u30a3\u30a2\u3092\u30b3\u30d4\u30fc\u3057\u305f EBS Snapshot\u3092\u6e96\u5099\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nVMware\u793e\u306eWeb\u30b5\u30a4\u30c8\u304b\u3089ISO\u3092\u53d6\u5f97\u3057\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e0a\u306a\u3069\u3067\u30b3\u30d4\u30fc\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nWindows Server 2012\u4ee5\u964d\u3067\u3042\u308c\u3070ISO\u3092\u76f4\u63a5\u30de\u30a6\u30f3\u30c8\u3067\u304d\u308b\u306e\u3067\u4f5c\u696d\u304c\u6357\u308a\u307e\u3059\u3002\n\n\u4f7f\u7528\u624b\u9806\n\u6b21\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u306eCloudFormation\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u30b3\u30d4\u30fc\u3057\u3066\u9069\u5f53\u306a\u30d5\u30a1\u30a4\u30eb\u306b\u4fdd\u5b58\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nManagement Console \u304b\u3089\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3059\u308b\u3068\u305d\u306e\u307e\u307eCloudFormation\u30b9\u30bf\u30c3\u30af\u3068\u3057\u3066vCenter Server\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305fWindows Server 2012 R2\u304c\u5c55\u958b\u3055\u308c\u307e\u3059\u3002\n\u30b9\u30bf\u30c3\u30af\u4f5c\u6210\u6642\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u3057\u3066\u4ee5\u4e0b\u306e\u60c5\u5831\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nWindows Server 2012 R2 Base AMI\u306eAMI ID\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30bf\u30a4\u30d7\n\u30ad\u30fc\u30da\u30a2\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u30b5\u30d6\u30cd\u30c3\u30c8ID\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3059\u308bVPC ID\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u30bd\u30fc\u30b9IP\uff08TCP 3389\u3001443\u3001905\u304c\u8a31\u53ef\u3055\u308c\u307e\u3059\uff09\nvCenter Server\u7ba1\u7406\u8005\u30e6\u30fc\u30b6\u30fc(Administrator@vsphere.local)\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\n\u4e8b\u524d\u6e96\u5099\u3067\u4f5c\u6210\u3057\u305fSnapshot ID\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u30ea\u30bd\u30fc\u30b9\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\nvCenter Server\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30e1\u30c7\u30a3\u30a2\u304c\u30a2\u30bf\u30c3\u30c1\u3055\u308c\u305fWindows Server 2012 R2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\nvCenter Server\u7528\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u5f8c\u3001\u30ea\u30e2\u30fc\u30c8\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3068\u3001vCenter Server \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u304c\u81ea\u52d5\u3067\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3059\u308b\u307e\u306710\u5206\uff5e20\u5206\u7a0b\u5ea6\u304b\u304b\u308b\u306e\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u306e\u30a6\u30a4\u30f3\u30c9\u30a6\u304c\u6d88\u3048\u308b\u307e\u3067\u305d\u306e\u307e\u307e\u5f85\u3063\u3066\u304f\u3060\u3055\u3044\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3059\u308b\u3068\u3001\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u306evSphere Client\u304b\u3089vCenter Server\u306b\u63a5\u7d9a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\nCloudFormation\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n{\n    \"AWSTemplateFormatVersion\": \"2010-09-09\",\n    \"Description\": \"vCenter Server installed on Windows Server 2012 R2\",\n    \"Parameters\": {\n        \"AmiId\":{\n            \"Type\":\"String\",\n            \"Default\":\"ami-3f18f23f\",\n            \"Description\":\"Windows Server 2012 R2 Base AMI Id.Default AMI is for Tokyo region.\"\n        },\n        \"InstanceType\":{\n            \"Type\":\"String\",\n            \"Default\":\"m3.large\",\n            \"Description\":\"Instance type\"\n        },\n        \"KeyPair\":{\n            \"Type\":\"AWS::EC2::KeyPair::KeyName\",\n            \"Description\":\"Key pair name\"\n        },\n        \"SubnetId\":{\n            \"Type\":\"AWS::EC2::Subnet::Id\",\n            \"Description\":\"Subnet Id\"\n        },\n        \"VpcId\":{\n            \"Type\":\"AWS::EC2::VPC::Id\",\n            \"Description\":\"Vpc Id\"\n        },\n        \"SecurityGroupSourceCidr\":{\n            \"Type\":\"String\",\n            \"Default\":\"0.0.0.0/0\",\n            \"Description\":\"Security Group Source Cidr for TCP 3389, 443, 905\"\n        },\n        \"vCenterPassword\":{\n            \"Type\":\"String\",\n            \"Description\":\"Password for vCenter Admin user(Administrator@vsphere.local)\",\n            \"NoEcho\":\"True\"\n        },\n        \"vCenterMediaSnapshotId\":{\n            \"Type\":\"String\",\n            \"Description\":\"vCenter Media SnapshotId\"\n        }\n    },\n    \"Resources\": {\n        \"vCenterSecurityGroup\":{\n           \"Type\" : \"AWS::EC2::SecurityGroup\",\n           \"Properties\" : {\n              \"GroupDescription\" : \"Allow http to client host\",\n              \"VpcId\" : {\"Ref\" : \"VpcId\"},\n              \"SecurityGroupIngress\" : [{\n                    \"IpProtocol\" : \"tcp\",\n                    \"FromPort\" : \"3389\",\n                    \"ToPort\" : \"3389\",\n                    \"CidrIp\" : {\"Ref\" : \"SecurityGroupSourceCidr\"}\n                 },\n                 {\n                    \"IpProtocol\" : \"tcp\",\n                    \"FromPort\" : \"443\",\n                    \"ToPort\" : \"443\",\n                    \"CidrIp\" : {\"Ref\" : \"SecurityGroupSourceCidr\"}\n                 },\n                 {\n                    \"IpProtocol\" : \"tcp\",\n                    \"FromPort\" : \"905\",\n                    \"ToPort\" : \"905\",\n                    \"CidrIp\" : {\"Ref\" : \"SecurityGroupSourceCidr\"}\n                 }],\n              \"SecurityGroupEgress\" : [{\n                 \"IpProtocol\" : \"-1\",\n                 \"CidrIp\" : \"0.0.0.0/0\"\n              }]\n           }\n        },\n        \"vCenterInstance\": {\n            \"Type\": \"AWS::EC2::Instance\",\n            \"Metadata\": {\n                \"AWS::CloudFormation::Init\": {\n                    \"config\": {\n                        \"files\": {\n                            \"c:\\\\cfn\\\\scripts\\\\installer5.5u1.bat\": {\n                                \"content\": {\n                                    \"Fn::Join\": [\n                                        \"\",\n                                        [\n                                            \"start /wait D:\\\\vSphere-Client\\\\VMware-viclient.exe /S /v\\\" /qr \\\"\",\n                                            \"\\n\",\n                                            \"SET /P IP=< C:\\\\cfn\\\\scripts\\\\ip.txt\",\n                                            \"\\n\",\n                                            \"start /wait msiexec.exe /i \\\"D:\\\\Single Sign-On\\\\VMware-SSO-Server.msi\\\" /qr SSO_HTTPS_PORT=7444 DEPLOYMODE=FIRSTDOMAIN ADMINPASSWORD=\",\n                                            {\"Ref\":\"vCenterPassword\"},\n                                            \" SSO_SITE=mysite  /l*v \\\"C:\\\\cfn\\\\log\\\\vim-sso-msi.log\\\" \",\n                                            \"\\n\",\n                                            \"start /wait D:\\\\\\\"Inventory Service\\\"\\\\VMware-inventory-service.exe /S /v\\\" QUERY_SERVICE_NUKE_DATABASE=0 SSO_ADMIN_USER=\\\\\\\"administrator@vsphere.local\\\\\\\" SSO_ADMIN_PASSWORD=\\\\\\\"\",\n                                            {\"Ref\":\"vCenterPassword\"},\n                                            \"\\\\\\\" LS_URL=\\\"https://%IP%:7444/lookupservice/sdk\\\" HTTPS_PORT=10443 FEDERATION_PORT=10111 XDB_PORT=10109 TOMCAT_MAX_MEMORY_OPTION=S /L*V \\\\\\\"C:\\\\cfn\\\\log\\\\vim-qs-msi.log\\\\\\\" /qr\\\" \",\n                                            \"\\n\",\n                                            \"start /wait D:\\\\vCenter-Server\\\\VMware-vcserver.exe /S /v\\\"/qr DB_SERVER_TYPE=Bundled FORMAT_DB=1 SSO_ADMIN_USER=\\\\\\\"administrator@vsphere.local\\\\\\\" SSO_ADMIN_PASSWORD=\\\\\\\"\",\n                                            {\"Ref\":\"vCenterPassword\"},\n                                            \"\\\\\\\" LS_URL=\\\\\\\"https://%IP%:7444/lookupservice/sdk\\\\\\\" IS_URL=\\\\\\\"https://%IP%:10443/\\\\\\\" VC_ADMIN_USER=administrator@vsphere.local /L*v \\\\\\\"C:\\\\cfn\\\\log\\\\vmvcsvr.log\\\\\\\" \",\n                                            \"\\n\",\n                                            \"del \\\"C:\\\\Users\\\\Administrator\\\\AppData\\\\Roaming\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Startup\\\\setup.bat\\\" \"\n                                        ]\n                                    ]\n                                }\n                            },\n                            \"C:\\\\Users\\\\Administrator\\\\AppData\\\\Roaming\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Startup\\\\setup.bat\": {\n                                \"content\": {\n                                    \"Fn::Join\": [\n                                        \"\",\n                                        [\n                                        \"C:\\\\cfn\\\\scripts\\\\installer5.5u1.bat\"\n                                        ]\n                                    ]\n                                }\n                            }\n                        },\n                        \"commands\": {\n                            \"1-setTimeZone\": {\n                                \"command\": \"tzutil /s \\\"Tokyo Standard Time\\\" \"\n                            },\n                            \"2-setInstallMedia\": {\n                                \"command\": \"powershell \\\"Get-Disk |Where-Object {$_.OperationalStatus -eq 'Offline'} | Set-Disk -IsOffline $false \\\" \"\n                            },\n                            \"3-getPrivateIp\": {\n                                \"command\": \"powershell \\\"Get-WMIObject Win32_NetworkAdapterConfiguration | Where-Object {$_.DHCPEnabled -eq $true} |%{$_.IPAddress} |Out-File C:\\\\cfn\\\\scripts\\\\ip.txt -encoding Default\\\" \"\n                            }\n                        }\n                    }\n                }\n            },\n            \"Properties\": {\n                \"ImageId\": {\"Ref\":\"AmiId\"},\n                \"InstanceType\": {\"Ref\":\"InstanceType\"},\n                \"NetworkInterfaces\": [\n                    {\n                        \"DeviceIndex\": \"0\",\n                        \"SubnetId\": {\"Ref\":\"SubnetId\"},\n                        \"GroupSet\": [\n                             {\"Fn::GetAtt\":[\"vCenterSecurityGroup\",\"GroupId\"]}\n                        ],\n                        \"AssociatePublicIpAddress\": true\n                    }\n                ],\n                \"KeyName\": {\"Ref\":\"KeyPair\"},\n                \"BlockDeviceMappings\": [\n                    {\n                        \"DeviceName\": \"/dev/sda1\",\n                        \"Ebs\": {\n                            \"VolumeSize\": \"80\",\n                            \"VolumeType\": \"gp2\"\n                        }\n                    },\n                    {\n                        \"DeviceName\": \"/dev/xvdf\",\n                        \"Ebs\": {\n                            \"SnapshotId\": {\"Ref\":\"vCenterMediaSnapshotId\"},\n                            \"VolumeSize\": \"5\",\n                            \"VolumeType\": \"gp2\"\n                        }\n                    }\n                ],\n                \"UserData\": {\n                    \"Fn::Base64\": {\n                        \"Fn::Join\": [\n                            \"\",\n                            [\n                                \"<script>\\n\",\n                                \"cfn-init.exe -v -s \",\n                                {\n                                    \"Ref\": \"AWS::StackId\"\n                                },\n                                \" -r vCenterInstance\",\n                                \" --region \",\n                                {\n                                    \"Ref\": \"AWS::Region\"\n                                },\n                                \"\\n\",\n                                \"</script>\"\n                            ]\n                        ]\n                    }\n                }\n            }\n        }\n    },\n    \"Outputs\": {\n        \"Instance\": {\n            \"Value\": {\n                \"Fn::GetAtt\": [\n                    \"vCenterInstance\",\n                    \"PublicDnsName\"\n                ]\n            },\n            \"Description\": \"DNS Name of the newly created EC2 instance\"\n        },\n        \"Command\": {\n            \"Value\": {\n                \"Fn::Join\": [\n                    \"\",\n                    [\n                        \"mstsc /v:\",\n                        {\n                            \"Fn::GetAtt\": [\n                                \"vCenterInstance\",\n                                \"PublicDnsName\"\n                            ]\n                        }\n                    ]\n                ]\n            },\n            \"Description\": \"Command to connect the instance.\"\n        }\n    }\n}\n\n# \u306f\u3058\u3081\u306b\n\u691c\u8a3c\u3067\u305f\u307e\u306b\u74b0\u5883\u304c\u5fc5\u8981\u306b\u306a\u308b\u3053\u3068\u304c\u3042\u308b\u306e\u3067\u3001vCenter Server 5.5\u3092EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308bCloudFormation\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n[AWS Management Portal for vCenter](http://aws.amazon.com/jp/ec2/vcenter-portal/) \u306e\u691c\u8a3c\u74b0\u5883\u3092\u4f5c\u308b\u3068\u304d\u306a\u3069\u306b\u304a\u3059\u3059\u3081\u3067\u3059\u3002\n\n\u306a\u304a\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306f\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u3092\u3057\u3066\u3044\u307e\u3059\u3002\n\uff08\u9700\u8981\u304c\u3042\u308b\u306e\u304b\u308f\u304b\u308a\u307e\u305b\u3093\u304c\uff09\u4ed6\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u672a\u78ba\u8a8d\u3067\u3059\u306e\u3067\u3054\u6ce8\u610f\u304f\u3060\u3055\u3044\u3002\n\n# \u4f7f\u3044\u65b9\n\n##\u4e8b\u524d\u6e96\u5099\nvCenter Server \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30e1\u30c7\u30a3\u30a2\u3092\u30b3\u30d4\u30fc\u3057\u305f EBS Snapshot\u3092\u6e96\u5099\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nVMware\u793e\u306eWeb\u30b5\u30a4\u30c8\u304b\u3089ISO\u3092\u53d6\u5f97\u3057\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e0a\u306a\u3069\u3067\u30b3\u30d4\u30fc\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nWindows Server 2012\u4ee5\u964d\u3067\u3042\u308c\u3070ISO\u3092\u76f4\u63a5\u30de\u30a6\u30f3\u30c8\u3067\u304d\u308b\u306e\u3067\u4f5c\u696d\u304c\u6357\u308a\u307e\u3059\u3002\n\n##\u4f7f\u7528\u624b\u9806\n\u6b21\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u306eCloudFormation\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u30b3\u30d4\u30fc\u3057\u3066\u9069\u5f53\u306a\u30d5\u30a1\u30a4\u30eb\u306b\u4fdd\u5b58\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nManagement Console \u304b\u3089\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3059\u308b\u3068\u305d\u306e\u307e\u307eCloudFormation\u30b9\u30bf\u30c3\u30af\u3068\u3057\u3066vCenter Server\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305fWindows Server 2012 R2\u304c\u5c55\u958b\u3055\u308c\u307e\u3059\u3002\n\u30b9\u30bf\u30c3\u30af\u4f5c\u6210\u6642\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u3057\u3066\u4ee5\u4e0b\u306e\u60c5\u5831\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n- Windows Server 2012 R2 Base AMI\u306eAMI ID\n- \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30bf\u30a4\u30d7\n- \u30ad\u30fc\u30da\u30a2\n- \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u30b5\u30d6\u30cd\u30c3\u30c8ID\n- \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3059\u308bVPC ID\n- \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u30bd\u30fc\u30b9IP\uff08TCP 3389\u3001443\u3001905\u304c\u8a31\u53ef\u3055\u308c\u307e\u3059\uff09\n- vCenter Server\u7ba1\u7406\u8005\u30e6\u30fc\u30b6\u30fc(Administrator@vsphere.local)\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\n- \u4e8b\u524d\u6e96\u5099\u3067\u4f5c\u6210\u3057\u305fSnapshot ID\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u30ea\u30bd\u30fc\u30b9\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\n- vCenter Server\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30e1\u30c7\u30a3\u30a2\u304c\u30a2\u30bf\u30c3\u30c1\u3055\u308c\u305fWindows Server 2012 R2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\n- vCenter Server\u7528\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u5f8c\u3001\u30ea\u30e2\u30fc\u30c8\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3068\u3001vCenter Server \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u304c\u81ea\u52d5\u3067\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3059\u308b\u307e\u306710\u5206\uff5e20\u5206\u7a0b\u5ea6\u304b\u304b\u308b\u306e\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u306e\u30a6\u30a4\u30f3\u30c9\u30a6\u304c\u6d88\u3048\u308b\u307e\u3067\u305d\u306e\u307e\u307e\u5f85\u3063\u3066\u304f\u3060\u3055\u3044\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3059\u308b\u3068\u3001\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u306evSphere Client\u304b\u3089vCenter Server\u306b\u63a5\u7d9a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n![\u7121\u984c.png](https://qiita-image-store.s3.amazonaws.com/0/51577/3bacad57-0818-2112-cea4-b2844099e158.png)\n\n\n# CloudFormation\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n```\n{\n    \"AWSTemplateFormatVersion\": \"2010-09-09\",\n    \"Description\": \"vCenter Server installed on Windows Server 2012 R2\",\n    \"Parameters\": {\n        \"AmiId\":{\n            \"Type\":\"String\",\n            \"Default\":\"ami-3f18f23f\",\n            \"Description\":\"Windows Server 2012 R2 Base AMI Id.Default AMI is for Tokyo region.\"\n        },\n        \"InstanceType\":{\n            \"Type\":\"String\",\n            \"Default\":\"m3.large\",\n            \"Description\":\"Instance type\"\n        },\n        \"KeyPair\":{\n            \"Type\":\"AWS::EC2::KeyPair::KeyName\",\n            \"Description\":\"Key pair name\"\n        },\n        \"SubnetId\":{\n            \"Type\":\"AWS::EC2::Subnet::Id\",\n            \"Description\":\"Subnet Id\"\n        },\n        \"VpcId\":{\n            \"Type\":\"AWS::EC2::VPC::Id\",\n            \"Description\":\"Vpc Id\"\n        },\n        \"SecurityGroupSourceCidr\":{\n            \"Type\":\"String\",\n            \"Default\":\"0.0.0.0/0\",\n            \"Description\":\"Security Group Source Cidr for TCP 3389, 443, 905\"\n        },\n        \"vCenterPassword\":{\n            \"Type\":\"String\",\n            \"Description\":\"Password for vCenter Admin user(Administrator@vsphere.local)\",\n            \"NoEcho\":\"True\"\n        },\n        \"vCenterMediaSnapshotId\":{\n            \"Type\":\"String\",\n            \"Description\":\"vCenter Media SnapshotId\"\n        }\n    },\n    \"Resources\": {\n        \"vCenterSecurityGroup\":{\n           \"Type\" : \"AWS::EC2::SecurityGroup\",\n           \"Properties\" : {\n              \"GroupDescription\" : \"Allow http to client host\",\n              \"VpcId\" : {\"Ref\" : \"VpcId\"},\n              \"SecurityGroupIngress\" : [{\n                    \"IpProtocol\" : \"tcp\",\n                    \"FromPort\" : \"3389\",\n                    \"ToPort\" : \"3389\",\n                    \"CidrIp\" : {\"Ref\" : \"SecurityGroupSourceCidr\"}\n                 },\n                 {\n                    \"IpProtocol\" : \"tcp\",\n                    \"FromPort\" : \"443\",\n                    \"ToPort\" : \"443\",\n                    \"CidrIp\" : {\"Ref\" : \"SecurityGroupSourceCidr\"}\n                 },\n                 {\n                    \"IpProtocol\" : \"tcp\",\n                    \"FromPort\" : \"905\",\n                    \"ToPort\" : \"905\",\n                    \"CidrIp\" : {\"Ref\" : \"SecurityGroupSourceCidr\"}\n                 }],\n              \"SecurityGroupEgress\" : [{\n                 \"IpProtocol\" : \"-1\",\n                 \"CidrIp\" : \"0.0.0.0/0\"\n              }]\n           }\n        },\n        \"vCenterInstance\": {\n            \"Type\": \"AWS::EC2::Instance\",\n            \"Metadata\": {\n                \"AWS::CloudFormation::Init\": {\n                    \"config\": {\n                        \"files\": {\n                            \"c:\\\\cfn\\\\scripts\\\\installer5.5u1.bat\": {\n                                \"content\": {\n                                    \"Fn::Join\": [\n                                        \"\",\n                                        [\n                                            \"start /wait D:\\\\vSphere-Client\\\\VMware-viclient.exe /S /v\\\" /qr \\\"\",\n                                            \"\\n\",\n                                            \"SET /P IP=< C:\\\\cfn\\\\scripts\\\\ip.txt\",\n                                            \"\\n\",\n                                            \"start /wait msiexec.exe /i \\\"D:\\\\Single Sign-On\\\\VMware-SSO-Server.msi\\\" /qr SSO_HTTPS_PORT=7444 DEPLOYMODE=FIRSTDOMAIN ADMINPASSWORD=\",\n                                            {\"Ref\":\"vCenterPassword\"},\n                                            \" SSO_SITE=mysite  /l*v \\\"C:\\\\cfn\\\\log\\\\vim-sso-msi.log\\\" \",\n                                            \"\\n\",\n                                            \"start /wait D:\\\\\\\"Inventory Service\\\"\\\\VMware-inventory-service.exe /S /v\\\" QUERY_SERVICE_NUKE_DATABASE=0 SSO_ADMIN_USER=\\\\\\\"administrator@vsphere.local\\\\\\\" SSO_ADMIN_PASSWORD=\\\\\\\"\",\n                                            {\"Ref\":\"vCenterPassword\"},\n                                            \"\\\\\\\" LS_URL=\\\"https://%IP%:7444/lookupservice/sdk\\\" HTTPS_PORT=10443 FEDERATION_PORT=10111 XDB_PORT=10109 TOMCAT_MAX_MEMORY_OPTION=S /L*V \\\\\\\"C:\\\\cfn\\\\log\\\\vim-qs-msi.log\\\\\\\" /qr\\\" \",\n                                            \"\\n\",\n                                            \"start /wait D:\\\\vCenter-Server\\\\VMware-vcserver.exe /S /v\\\"/qr DB_SERVER_TYPE=Bundled FORMAT_DB=1 SSO_ADMIN_USER=\\\\\\\"administrator@vsphere.local\\\\\\\" SSO_ADMIN_PASSWORD=\\\\\\\"\",\n                                            {\"Ref\":\"vCenterPassword\"},\n                                            \"\\\\\\\" LS_URL=\\\\\\\"https://%IP%:7444/lookupservice/sdk\\\\\\\" IS_URL=\\\\\\\"https://%IP%:10443/\\\\\\\" VC_ADMIN_USER=administrator@vsphere.local /L*v \\\\\\\"C:\\\\cfn\\\\log\\\\vmvcsvr.log\\\\\\\" \",\n                                            \"\\n\",\n                                            \"del \\\"C:\\\\Users\\\\Administrator\\\\AppData\\\\Roaming\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Startup\\\\setup.bat\\\" \"\n                                        ]\n                                    ]\n                                }\n                            },\n                            \"C:\\\\Users\\\\Administrator\\\\AppData\\\\Roaming\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Startup\\\\setup.bat\": {\n                                \"content\": {\n                                    \"Fn::Join\": [\n                                        \"\",\n                                        [\n                                        \"C:\\\\cfn\\\\scripts\\\\installer5.5u1.bat\"\n                                        ]\n                                    ]\n                                }\n                            }\n                        },\n                        \"commands\": {\n                            \"1-setTimeZone\": {\n                                \"command\": \"tzutil /s \\\"Tokyo Standard Time\\\" \"\n                            },\n                            \"2-setInstallMedia\": {\n                                \"command\": \"powershell \\\"Get-Disk |Where-Object {$_.OperationalStatus -eq 'Offline'} | Set-Disk -IsOffline $false \\\" \"\n                            },\n                            \"3-getPrivateIp\": {\n                                \"command\": \"powershell \\\"Get-WMIObject Win32_NetworkAdapterConfiguration | Where-Object {$_.DHCPEnabled -eq $true} |%{$_.IPAddress} |Out-File C:\\\\cfn\\\\scripts\\\\ip.txt -encoding Default\\\" \"\n                            }\n                        }\n                    }\n                }\n            },\n            \"Properties\": {\n                \"ImageId\": {\"Ref\":\"AmiId\"},\n                \"InstanceType\": {\"Ref\":\"InstanceType\"},\n                \"NetworkInterfaces\": [\n                    {\n                        \"DeviceIndex\": \"0\",\n                        \"SubnetId\": {\"Ref\":\"SubnetId\"},\n                        \"GroupSet\": [\n                             {\"Fn::GetAtt\":[\"vCenterSecurityGroup\",\"GroupId\"]}\n                        ],\n                        \"AssociatePublicIpAddress\": true\n                    }\n                ],\n                \"KeyName\": {\"Ref\":\"KeyPair\"},\n                \"BlockDeviceMappings\": [\n                    {\n                        \"DeviceName\": \"/dev/sda1\",\n                        \"Ebs\": {\n                            \"VolumeSize\": \"80\",\n                            \"VolumeType\": \"gp2\"\n                        }\n                    },\n                    {\n                        \"DeviceName\": \"/dev/xvdf\",\n                        \"Ebs\": {\n                            \"SnapshotId\": {\"Ref\":\"vCenterMediaSnapshotId\"},\n                            \"VolumeSize\": \"5\",\n                            \"VolumeType\": \"gp2\"\n                        }\n                    }\n                ],\n                \"UserData\": {\n                    \"Fn::Base64\": {\n                        \"Fn::Join\": [\n                            \"\",\n                            [\n                                \"<script>\\n\",\n                                \"cfn-init.exe -v -s \",\n                                {\n                                    \"Ref\": \"AWS::StackId\"\n                                },\n                                \" -r vCenterInstance\",\n                                \" --region \",\n                                {\n                                    \"Ref\": \"AWS::Region\"\n                                },\n                                \"\\n\",\n                                \"</script>\"\n                            ]\n                        ]\n                    }\n                }\n            }\n        }\n    },\n    \"Outputs\": {\n        \"Instance\": {\n            \"Value\": {\n                \"Fn::GetAtt\": [\n                    \"vCenterInstance\",\n                    \"PublicDnsName\"\n                ]\n            },\n            \"Description\": \"DNS Name of the newly created EC2 instance\"\n        },\n        \"Command\": {\n            \"Value\": {\n                \"Fn::Join\": [\n                    \"\",\n                    [\n                        \"mstsc /v:\",\n                        {\n                            \"Fn::GetAtt\": [\n                                \"vCenterInstance\",\n                                \"PublicDnsName\"\n                            ]\n                        }\n                    ]\n                ]\n            },\n            \"Description\": \"Command to connect the instance.\"\n        }\n    }\n}\n```\n", "tags": ["AWS", "EC2", "CloudFormation", "vSphere", "vCenter"]}