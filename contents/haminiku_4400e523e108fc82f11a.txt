{"context": "\n\n\u6982\u8981\n\u52c9\u5f37\u3059\u308b\u305f\u3081\u306b\u3001\u975e\u540c\u671f\u3067\u4e26\u5217HTTP\u901a\u4fe1\u3057\u306610\u306eURL\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u66f8\u3044\u3066\u3001\u5b9f\u884c\u901f\u5ea6\u3092\u6bd4\u8f03\u691c\u8a3c\u3057\u307e\u3059\u3002\u6700\u5f8c\u306bErlang\u6709\u8b58\u8005\u306b\u30b3\u30fc\u30c9\u898b\u305b\u305f\u3089\u3001\u304b\u306a\u308a\u53b3\u3057\u3081\u306e\u6307\u6458\u3092\u9802\u3044\u305f\u306e\u3067\u305d\u306e\u70b9\u306b\u3064\u3044\u3066\u6700\u671f\u306b\u66f8\u3044\u3066\u307e\u3059\u3002\n\u25a0 \u540c\u671f\u3057\u3066\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5b9f\u884c\n\n\u25a0 \u975e\u540c\u671f\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5b9f\u884c\n\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u6a5f\u80fd\u306e\u307f\u5b9f\u88c5\nHTTP\u901a\u4fe1\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u306b\u4fdd\u5b58\u3059\u308b\n\nhttp_downloader_2\n%%%-------------------------------------------------------------------\n%%% @doc\n%%% http\u901a\u4fe1\n%%% \u53c2\u8003: http://erlang.org/doc/apps/inets/http_client.html\n%%% @end\n%%% Created : 26. 5 2016 15:54\n%%%-------------------------------------------------------------------\n-module(http_downloader_2).\n\n%% API\n-export([main/0]).\n\n%% main\nmain() ->\n    Url = \"http://www.erlang.org\",\n    Body = http_request(Url),\n    file_writer(Body, \"/tmp/download/output.dat\"),\n    ok.\n\n%% printer\nprint(Message) -> io:format(\"E: ~p~n\",[Message]).\n\n%% http \u901a\u4fe1\u3057\u3066Body\u3092\u8fd4\u3059\nhttp_request(URL) ->\n    inets:start(),\n    {ok, {{Version, 200, ReasonPhrase}, Headers, Body}} = httpc:request(URL),\n    Body.\n\n%% file\u306b\u4fdd\u5b58\u3059\u308b\nfile_writer(Body, FilePath) ->\n    file:write_file(FilePath, Body, [binary, write]).\n\n\n\n\u5b9f\u884c\n>>> erlc ./http_downloader_2.erl\n>>> erl -noshell -s http_downloader_2 main -s init stop\n>>> ls -lta /tmp/download/output.dat \n-rw-r--r--  1 ******  wheel  12740  5 27 16:55 /tmp/download/output.dat\n\n\n\n\n\u30d7\u30ed\u30bb\u30b91\u3064\u3067\u9806\u756a\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\uff08\u540c\u671f\u3057\u3066\u5b9f\u884c\uff09\n\u30d7\u30ed\u30bb\u30b9\u30921\u3064\u751f\u6210(spawn)\u3057\u3066\u9806\u756a\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u30e2\u30c7\u30eb\n\nhttp_downloader_4\n%%%-------------------------------------------------------------------\n%%% @doc\n%%% \u30d7\u30ed\u30bb\u30b91\u3064\u3067\u9806\u756a\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\n%%%\n%%% @end\n%%% Created : 26. 5 2016 15:54\n%%%-------------------------------------------------------------------\n-module(http_downloader_4).\n\n%% API\n-export([main/0, download_process/0]).\n\n%% main\nmain() ->\n    Urls = [\"http://erlang.org/doc/man/httpc.html\",\n     \"http://erlang.org/doc/apps/inets/http_client.html\",\n     \"http://erlang.org/doc/apps/inets/inets_services.html#id60923\",\n     \"http://erlang.org/doc/apps/inets/release_notes.html\",\n     \"http://erlang.2086793.n4.nabble.com/Question-re-io-format-and-string-handling-td2109722.html\",\n     \"http://www.erlang.org/mailman/listinfo/erlang-questions\",\n     \"http://stackoverflow.com/questions/7595128/how-to-optimize-the-receive-loop-for-thousands-of-messages-in-erlang\",\n     \"http://stackoverflow.com/jobs\",\n     \"http://stackoverflow.com/tags\",\n     \"http://stackoverflow.com/questions/tagged/c%23\"],\n\n    %% downloader \u30d7\u30ed\u30bb\u30b9\u3092\u751f\u6210\u3059\u308b\n    Pid2 = spawn(?MODULE, download_process, []),\n\n    Receiver = fun(Url) ->\n        %% \u30d7\u30ed\u30bb\u30b9\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u6295\u3052\u308b\n        Pid2 ! {self(), Url},\n\n        %% \u30d7\u30ed\u30bb\u30b9\u304b\u3089\u306e\u5fdc\u7b54\u3092\u5f85\u3064\n        receive\n            {Pid2, Msg} ->\n                print(\"Download Finish:  \" ++ Msg)\n        end\n    end,\n\n    lists:foreach(Receiver, Urls),\n\n    %% \u30d7\u30ed\u30bb\u30b9\u306e\u505c\u6b62\n    Pid2 ! stop.\n\n%% printer\nprint(Message) -> io:format(\"E: ~p~n\",[Message]).\n\n%% download\u7528\u306e\u30d7\u30ed\u30bb\u30b9\ndownload_process() ->\n    receive\n        {From, Msg} ->\n            %% download\u51e6\u7406\n            downloader(Msg),\n\n            %% \u5fdc\u7b54\u3092\u8fd4\u3059\n            From ! {self(), Msg},\n            download_process();\n        stop ->\n            true\n    end.\n\n%% http\u901a\u4fe1\u3057\u3066file\u306b\u4fdd\u5b58\u3059\u308b\ndownloader(Url) ->\n    Body = http_request(Url),\n    Path = path_generator(Url),\n    file_writer(Body, Path),\n    ok.\n\n%% URL\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u3092\u751f\u6210\u3059\u308b\u3002\npath_generator(Url) ->\n    FileName = name_generator(Url),\n    Path = string:concat(\"/tmp/download/\", FileName),\n    Path.\n\n%% URL\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u751f\u6210\u3059\u308b\u3002\nname_generator(Url) ->\n    {ok, Result} = http_uri:parse(Url),\n    {Scheme, UserInfo, Host, Port, Path, Query} = Result,\n    %% \"/\" \u3092\u524a\u9664\u3057\u3066\u6587\u5b57\u5217\u306b\u5909\u63db\n    re:replace(Path, \"/\", \"\", [global, {return, list}]).\n\n%% http \u901a\u4fe1\u3057\u3066Body\u3092\u8fd4\u3059\nhttp_request(URL) ->\n    inets:start(),\n    {ok, {{Version, 200, ReasonPhrase}, Headers, Body}} = httpc:request(URL),\n    Body.\n\n%% file\u306b\u4fdd\u5b58\u3059\u308b\nfile_writer(Body, FilePath) ->\n    file:write_file(FilePath, Body, [binary, write]).\n\n\n\n\n\u5b9f\u884c\nrm -rf /tmp/download/*\nerlc ./http_downloader_4.erl\necho \"+++++++++++++\"\nerl -noshell -s http_downloader_4 main -s init stop\necho \"+++++++++++++\"\nls -lta /tmp/download/\n\n\n\n\n\u5b9f\u884c\u7d50\u679c\nE: \"Download Finish:  http://erlang.org/doc/man/httpc.html\"\nE: \"Download Finish:  http://erlang.org/doc/apps/inets/http_client.html\"\nE: \"Download Finish:  http://erlang.org/doc/apps/inets/inets_services.html#id60923\"\nE: \"Download Finish:  http://erlang.org/doc/apps/inets/release_notes.html\"\nE: \"Download Finish:  http://erlang.2086793.n4.nabble.com/Question-re-io-format-and-string-handling-td2109722.html\"\nE: \"Download Finish:  http://www.erlang.org/mailman/listinfo/erlang-questions\"\nE: \"Download Finish:  http://stackoverflow.com/questions/7595128/how-to-optimize-the-receive-loop-for-thousands-of-messages-in-erlang\"\nE: \"Download Finish:  http://stackoverflow.com/jobs\"\nE: \"Download Finish:  http://stackoverflow.com/tags\"\nE: \"Download Finish:  http://stackoverflow.com/questions/tagged/c%23\"\n+++++++++++++\ntotal 1104\ndrwxr-xr-x  12 ****  wheel     408  5 27 18:00 .\n-rw-r--r--   1 ****  wheel   95746  5 27 18:00 questionstaggedc%23\n-rw-r--r--   1 ****  wheel   85691  5 27 18:00 jobs\n-rw-r--r--   1 ****  wheel   91712  5 27 18:00 questions7595128how-to-optimize-the-receive-loop-for-thousands-of-messages-in-erlang\n-rw-r--r--   1 ****  wheel   67743  5 27 18:00 tags\n-rw-r--r--   1 ****  wheel    6266  5 27 18:00 mailmanlistinfoerlang-questions\n-rw-r--r--   1 ****  wheel  117721  5 27 18:00 Question-re-io-format-and-string-handling-td2109722.html\n-rw-r--r--   1 ****  wheel    9012  5 27 18:00 docappsinetshttp_client.html\n-rw-r--r--   1 ****  wheel    6574  5 27 18:00 docappsinetsinets_services.html\n-rw-r--r--   1 ****  wheel    7011  5 27 18:00 docappsinetsrelease_notes.html\n-rw-r--r--   1 ****  wheel   57479  5 27 18:00 docmanhttpc.html\ndrwxrwxrwt  28 root   wheel     952  5 27 16:24 ..\n\n\n\n\u8907\u6570\u30d7\u30ed\u30bb\u30b9\u3067\u975e\u540c\u671f\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n\ndwn.erl\n%%%-------------------------------------------------------------------\n%%% @author hami\n%%% @copyright (C) 2016, <COMPANY>\n%%% @doc\n%%%\n%%% @end\n%%% Created : 30. 5 2016 12:36\n%%%-------------------------------------------------------------------\n-module(dwn).\n-author(\"hami\").\n\n%% API\n-export([main/0, download/1]).\n\nmain() ->\n  Urls = [\"http://erlang.org/doc/man/httpc.html\",\n    \"http://erlang.org/doc/apps/inets/http_client.html\",\n    \"http://erlang.org/doc/apps/inets/inets_services.html#id60923\",\n    \"http://erlang.org/doc/apps/inets/release_notes.html\",\n    \"http://erlang.2086793.n4.nabble.com/Question-re-io-format-and-string-handling-td2109722.html\",\n    \"http://www.erlang.org/mailman/listinfo/erlang-questions\",\n    \"http://stackoverflow.com/questions/7595128/how-to-optimize-the-receive-loop-for-thousands-of-messages-in-erlang\",\n    \"http://stackoverflow.com/jobs\",\n    \"http://stackoverflow.com/tags\",\n    \"http://stackoverflow.com/questions/tagged/c%23\"],\n\n  %% \u30de\u30eb\u30c1\u30d7\u30ed\u30bb\u30b9\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u958b\u59cb\n  downloader(self(), Urls),\n\n  %% \u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5b8c\u4e86\u3092\u53d7\u4fe1\u3059\u308b\n  receiver_download_finish(length(Urls)),\n  ok.\n\n%% \u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30d7\u30ed\u30bb\u30b9\u304b\u3089\u53d7\u4fe1\u3059\u308b\nreceiver_download_finish(0) -> ok;\nreceiver_download_finish(N) when N > 0 ->\n    receive\n      {Msg} ->\n        print(Msg),\n        receiver_download_finish(N - 1);\n      stop ->\n        true\n    end.\n\n%% \u975e\u540c\u671f\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30d7\u30ed\u30bb\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u308b\ndownloader(MainPid, Urls) ->\n  Starter = fun(X) ->\n    %% \u30d7\u30ed\u30bb\u30b9\u306e\u751f\u6210\n    Pid2 = spawn(?MODULE, download, [MainPid]),\n\n    %% \u30d7\u30ed\u30bb\u30b9\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u6295\u3052\u308b\n    Pid2 ! {X} end,\n\n  lists:foreach(Starter, Urls),\n  ok.\n\n%% \u7acb\u3061\u4e0a\u3052\u308b\u30d7\u30ed\u30bb\u30b9\ndownload(MainPid) ->\n  receive\n    {Url} ->\n      %% \u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5b9f\u884c\n      download_and_write_file(Url),\n\n      %% \u5b8c\u4e86\u3057\u305f\u65e8\u3092\u901a\u77e5\u3059\u308b\n      MainPid ! {Url};\n    stop ->\n      true\n  end.\n\n%% printer\nprint(Message) -> io:format(\"E: ~p~n\",[Message]).\n\n\n%% http\u901a\u4fe1\u3057\u3066file\u306b\u4fdd\u5b58\u3059\u308b\ndownload_and_write_file(Url) ->\n  Body = http_request(Url),\n  Path = path_generator(Url),\n  file_writer(Body, Path),\n  ok.\n\n%% URL\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u3092\u751f\u6210\u3059\u308b\u3002\npath_generator(Url) ->\n  FileName = name_generator(Url),\n  Path = string:concat(\"/tmp/download/\", FileName),\n  Path.\n\n%% URL\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u751f\u6210\u3059\u308b\u3002\nname_generator(Url) ->\n  {ok, Result} = http_uri:parse(Url),\n  {Scheme, UserInfo, Host, Port, Path, Query} = Result,\n  %% \"/\" \u3092\u524a\u9664\u3057\u3066\u6587\u5b57\u5217\u306b\u5909\u63db\n  re:replace(Path, \"/\", \"\", [global, {return, list}]).\n\n%% http \u901a\u4fe1\u3057\u3066Body\u3092\u8fd4\u3059\nhttp_request(URL) ->\n  inets:start(),\n  {ok, {{Version, 200, ReasonPhrase}, Headers, Body}} = httpc:request(URL),\n  Body.\n\n%% file\u306b\u4fdd\u5b58\u3059\u308b\nfile_writer(Body, FilePath) ->\n  file:write_file(FilePath, Body, [binary, write]).\n\n\n\n\n\u30b3\u30f3\u30d1\u30a4\u30eb\u3068\u5b9f\u884c\n# \u30b3\u30f3\u30d1\u30a4\u30eb\u3068\u5b9f\u884c\necho \"+++++++++++++\"\nerlc ./dwn.erl\necho \"+++++++++++++\"\ntime erl -noshell -s dwn main -s init stop\necho \"+++++++++++++\"\n\n\n\n\n\u5b9f\u884c\u7d50\u679c\n+++++++++++++\nE: \"http://stackoverflow.com/questions/7595128/how-to-optimize-the-receive-loop-for-thousands-of-messages-in-erlang\"\nE: \"http://stackoverflow.com/tags\"\nE: \"http://stackoverflow.com/questions/tagged/c%23\"\nE: \"http://stackoverflow.com/jobs\"\nE: \"http://erlang.2086793.n4.nabble.com/Question-re-io-format-and-string-handling-td2109722.html\"\nE: \"http://erlang.org/doc/apps/inets/http_client.html\"\nE: \"http://erlang.org/doc/apps/inets/release_notes.html\"\nE: \"http://erlang.org/doc/apps/inets/inets_services.html#id60923\"\nE: \"http://erlang.org/doc/man/httpc.html\"\nE: \"http://www.erlang.org/mailman/listinfo/erlang-questions\"\n\nreal    0m3.462s\nuser    0m0.258s\nsys 0m0.142s\n+++++++++++++\n```shell-session:\u5b9f\u884c\u7d50\u679c\n\n\n\n\nErlang\u6709\u8b58\u8005\u306b\u30b3\u30fc\u30c9\u898b\u305b\u305f\u7d50\u679c\n\u30ed\u30b8\u30c3\u30af\u306f\u6b63\u3057\u3044\u304c\u3001\u696d\u52d9\u3067\u306f\u6b21\u306e3\u3064\u306e\u95a2\u6570\u306f\u57fa\u672c\u7684\u306b\u5229\u7528\u305b\u305a\u3001behavior\u3092\u5229\u7528\u3059\u308b\u3068\u30a2\u30c9\u30d0\u30a4\u30b9\u3092\u9802\u304d\u307e\u3057\u305f\u3002\n\u25a0 \u696d\u52d9\u3067Erlang\u66f8\u304f\u3068\u304d\u306f\u3001\u6b21\u306e3\u3064\u306e\u95a2\u6570\u3092\u307b\u307c\u5229\u7528\u3057\u306a\u3044\n1. spawn \u7981\u6b62\n2. receive \u7981\u6b62\n3. Pid ! {} \u7981\u6b62\n\u25a0 \u5bfe\u7b56\n\u9069\u5207\u306bbehavior\u3092\u4f7f\u3063\u3066\u66f8\u304d\u76f4\u305d\u3046\n1. application\n2. supervisor\n3. gen_server\n4. gen_fsm\n\n\u6b21\u306e\u5b66\u7fd2\n\u6b21\u306fbehavior\u3092\u4f7f\u3063\u3066\u4e26\u884c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u66f8\u304d\u76f4\u3057\u3066\u307f\u307e\u3059\n# \u6982\u8981\n\u52c9\u5f37\u3059\u308b\u305f\u3081\u306b\u3001\u975e\u540c\u671f\u3067\u4e26\u5217HTTP\u901a\u4fe1\u3057\u306610\u306eURL\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u66f8\u3044\u3066\u3001\u5b9f\u884c\u901f\u5ea6\u3092\u6bd4\u8f03\u691c\u8a3c\u3057\u307e\u3059\u3002\u6700\u5f8c\u306bErlang\u6709\u8b58\u8005\u306b\u30b3\u30fc\u30c9\u898b\u305b\u305f\u3089\u3001\u304b\u306a\u308a\u53b3\u3057\u3081\u306e\u6307\u6458\u3092\u9802\u3044\u305f\u306e\u3067\u305d\u306e\u70b9\u306b\u3064\u3044\u3066\u6700\u671f\u306b\u66f8\u3044\u3066\u307e\u3059\u3002\n\n\u25a0 \u540c\u671f\u3057\u3066\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5b9f\u884c\n<img width=\"497\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-06-02 17.14.13.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/65312/8c6ebbc8-5034-c356-4394-a052eb3f93a3.png\">\n\n\u25a0 \u975e\u540c\u671f\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5b9f\u884c\n<img width=\"606\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-06-02 17.14.34.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/65312/bc9e744a-d2c9-9684-e2f5-18914d1826be.png\">\n\n\n# \u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u6a5f\u80fd\u306e\u307f\u5b9f\u88c5\nHTTP\u901a\u4fe1\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u306b\u4fdd\u5b58\u3059\u308b\n\n```erlang:http_downloader_2\n%%%-------------------------------------------------------------------\n%%% @doc\n%%% http\u901a\u4fe1\n%%% \u53c2\u8003: http://erlang.org/doc/apps/inets/http_client.html\n%%% @end\n%%% Created : 26. 5 2016 15:54\n%%%-------------------------------------------------------------------\n-module(http_downloader_2).\n\n%% API\n-export([main/0]).\n\n%% main\nmain() ->\n    Url = \"http://www.erlang.org\",\n    Body = http_request(Url),\n    file_writer(Body, \"/tmp/download/output.dat\"),\n    ok.\n\n%% printer\nprint(Message) -> io:format(\"E: ~p~n\",[Message]).\n\n%% http \u901a\u4fe1\u3057\u3066Body\u3092\u8fd4\u3059\nhttp_request(URL) ->\n    inets:start(),\n    {ok, {{Version, 200, ReasonPhrase}, Headers, Body}} = httpc:request(URL),\n    Body.\n\n%% file\u306b\u4fdd\u5b58\u3059\u308b\nfile_writer(Body, FilePath) ->\n    file:write_file(FilePath, Body, [binary, write]).\n```\n\n```shell-session:\u5b9f\u884c\n>>> erlc ./http_downloader_2.erl\n>>> erl -noshell -s http_downloader_2 main -s init stop\n>>> ls -lta /tmp/download/output.dat \n-rw-r--r--  1 ******  wheel  12740  5 27 16:55 /tmp/download/output.dat\n\n```\n\n# \u30d7\u30ed\u30bb\u30b91\u3064\u3067\u9806\u756a\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\uff08\u540c\u671f\u3057\u3066\u5b9f\u884c\uff09\n\u30d7\u30ed\u30bb\u30b9\u30921\u3064\u751f\u6210(spawn)\u3057\u3066\u9806\u756a\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u30e2\u30c7\u30eb\n\n```erlang:http_downloader_4\n%%%-------------------------------------------------------------------\n%%% @doc\n%%% \u30d7\u30ed\u30bb\u30b91\u3064\u3067\u9806\u756a\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\n%%%\n%%% @end\n%%% Created : 26. 5 2016 15:54\n%%%-------------------------------------------------------------------\n-module(http_downloader_4).\n\n%% API\n-export([main/0, download_process/0]).\n\n%% main\nmain() ->\n    Urls = [\"http://erlang.org/doc/man/httpc.html\",\n     \"http://erlang.org/doc/apps/inets/http_client.html\",\n     \"http://erlang.org/doc/apps/inets/inets_services.html#id60923\",\n     \"http://erlang.org/doc/apps/inets/release_notes.html\",\n     \"http://erlang.2086793.n4.nabble.com/Question-re-io-format-and-string-handling-td2109722.html\",\n     \"http://www.erlang.org/mailman/listinfo/erlang-questions\",\n     \"http://stackoverflow.com/questions/7595128/how-to-optimize-the-receive-loop-for-thousands-of-messages-in-erlang\",\n     \"http://stackoverflow.com/jobs\",\n     \"http://stackoverflow.com/tags\",\n     \"http://stackoverflow.com/questions/tagged/c%23\"],\n\n    %% downloader \u30d7\u30ed\u30bb\u30b9\u3092\u751f\u6210\u3059\u308b\n    Pid2 = spawn(?MODULE, download_process, []),\n\n    Receiver = fun(Url) ->\n        %% \u30d7\u30ed\u30bb\u30b9\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u6295\u3052\u308b\n        Pid2 ! {self(), Url},\n\n        %% \u30d7\u30ed\u30bb\u30b9\u304b\u3089\u306e\u5fdc\u7b54\u3092\u5f85\u3064\n        receive\n            {Pid2, Msg} ->\n                print(\"Download Finish:  \" ++ Msg)\n        end\n    end,\n\n    lists:foreach(Receiver, Urls),\n\n\t%% \u30d7\u30ed\u30bb\u30b9\u306e\u505c\u6b62\n\tPid2 ! stop.\n\n%% printer\nprint(Message) -> io:format(\"E: ~p~n\",[Message]).\n\n%% download\u7528\u306e\u30d7\u30ed\u30bb\u30b9\ndownload_process() ->\n\treceive\n\t\t{From, Msg} ->\n\t\t    %% download\u51e6\u7406\n\t\t    downloader(Msg),\n\n\t\t    %% \u5fdc\u7b54\u3092\u8fd4\u3059\n\t\t\tFrom ! {self(), Msg},\n\t\t\tdownload_process();\n\t\tstop ->\n\t\t\ttrue\n\tend.\n\n%% http\u901a\u4fe1\u3057\u3066file\u306b\u4fdd\u5b58\u3059\u308b\ndownloader(Url) ->\n    Body = http_request(Url),\n    Path = path_generator(Url),\n    file_writer(Body, Path),\n    ok.\n\n%% URL\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u3092\u751f\u6210\u3059\u308b\u3002\npath_generator(Url) ->\n    FileName = name_generator(Url),\n    Path = string:concat(\"/tmp/download/\", FileName),\n    Path.\n\n%% URL\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u751f\u6210\u3059\u308b\u3002\nname_generator(Url) ->\n    {ok, Result} = http_uri:parse(Url),\n    {Scheme, UserInfo, Host, Port, Path, Query} = Result,\n    %% \"/\" \u3092\u524a\u9664\u3057\u3066\u6587\u5b57\u5217\u306b\u5909\u63db\n    re:replace(Path, \"/\", \"\", [global, {return, list}]).\n\n%% http \u901a\u4fe1\u3057\u3066Body\u3092\u8fd4\u3059\nhttp_request(URL) ->\n    inets:start(),\n    {ok, {{Version, 200, ReasonPhrase}, Headers, Body}} = httpc:request(URL),\n    Body.\n\n%% file\u306b\u4fdd\u5b58\u3059\u308b\nfile_writer(Body, FilePath) ->\n    file:write_file(FilePath, Body, [binary, write]).\n\n```\n\n```shell-session:\u5b9f\u884c\nrm -rf /tmp/download/*\nerlc ./http_downloader_4.erl\necho \"+++++++++++++\"\nerl -noshell -s http_downloader_4 main -s init stop\necho \"+++++++++++++\"\nls -lta /tmp/download/\n\n```\n\n```shell-session:\u5b9f\u884c\u7d50\u679c\nE: \"Download Finish:  http://erlang.org/doc/man/httpc.html\"\nE: \"Download Finish:  http://erlang.org/doc/apps/inets/http_client.html\"\nE: \"Download Finish:  http://erlang.org/doc/apps/inets/inets_services.html#id60923\"\nE: \"Download Finish:  http://erlang.org/doc/apps/inets/release_notes.html\"\nE: \"Download Finish:  http://erlang.2086793.n4.nabble.com/Question-re-io-format-and-string-handling-td2109722.html\"\nE: \"Download Finish:  http://www.erlang.org/mailman/listinfo/erlang-questions\"\nE: \"Download Finish:  http://stackoverflow.com/questions/7595128/how-to-optimize-the-receive-loop-for-thousands-of-messages-in-erlang\"\nE: \"Download Finish:  http://stackoverflow.com/jobs\"\nE: \"Download Finish:  http://stackoverflow.com/tags\"\nE: \"Download Finish:  http://stackoverflow.com/questions/tagged/c%23\"\n+++++++++++++\ntotal 1104\ndrwxr-xr-x  12 ****  wheel     408  5 27 18:00 .\n-rw-r--r--   1 ****  wheel   95746  5 27 18:00 questionstaggedc%23\n-rw-r--r--   1 ****  wheel   85691  5 27 18:00 jobs\n-rw-r--r--   1 ****  wheel   91712  5 27 18:00 questions7595128how-to-optimize-the-receive-loop-for-thousands-of-messages-in-erlang\n-rw-r--r--   1 ****  wheel   67743  5 27 18:00 tags\n-rw-r--r--   1 ****  wheel    6266  5 27 18:00 mailmanlistinfoerlang-questions\n-rw-r--r--   1 ****  wheel  117721  5 27 18:00 Question-re-io-format-and-string-handling-td2109722.html\n-rw-r--r--   1 ****  wheel    9012  5 27 18:00 docappsinetshttp_client.html\n-rw-r--r--   1 ****  wheel    6574  5 27 18:00 docappsinetsinets_services.html\n-rw-r--r--   1 ****  wheel    7011  5 27 18:00 docappsinetsrelease_notes.html\n-rw-r--r--   1 ****  wheel   57479  5 27 18:00 docmanhttpc.html\ndrwxrwxrwt  28 root   wheel     952  5 27 16:24 ..\n```\n\n# \u8907\u6570\u30d7\u30ed\u30bb\u30b9\u3067\u975e\u540c\u671f\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n<img width=\"606\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-06-02 17.14.34.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/65312/ec09f021-134d-25bf-6332-c197c2e8df1d.png\">\n\n```erlang:dwn.erl\n%%%-------------------------------------------------------------------\n%%% @author hami\n%%% @copyright (C) 2016, <COMPANY>\n%%% @doc\n%%%\n%%% @end\n%%% Created : 30. 5 2016 12:36\n%%%-------------------------------------------------------------------\n-module(dwn).\n-author(\"hami\").\n\n%% API\n-export([main/0, download/1]).\n\nmain() ->\n  Urls = [\"http://erlang.org/doc/man/httpc.html\",\n    \"http://erlang.org/doc/apps/inets/http_client.html\",\n    \"http://erlang.org/doc/apps/inets/inets_services.html#id60923\",\n    \"http://erlang.org/doc/apps/inets/release_notes.html\",\n    \"http://erlang.2086793.n4.nabble.com/Question-re-io-format-and-string-handling-td2109722.html\",\n    \"http://www.erlang.org/mailman/listinfo/erlang-questions\",\n    \"http://stackoverflow.com/questions/7595128/how-to-optimize-the-receive-loop-for-thousands-of-messages-in-erlang\",\n    \"http://stackoverflow.com/jobs\",\n    \"http://stackoverflow.com/tags\",\n    \"http://stackoverflow.com/questions/tagged/c%23\"],\n\n  %% \u30de\u30eb\u30c1\u30d7\u30ed\u30bb\u30b9\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u958b\u59cb\n  downloader(self(), Urls),\n\n  %% \u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5b8c\u4e86\u3092\u53d7\u4fe1\u3059\u308b\n  receiver_download_finish(length(Urls)),\n  ok.\n\n%% \u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30d7\u30ed\u30bb\u30b9\u304b\u3089\u53d7\u4fe1\u3059\u308b\nreceiver_download_finish(0) -> ok;\nreceiver_download_finish(N) when N > 0 ->\n    receive\n      {Msg} ->\n        print(Msg),\n        receiver_download_finish(N - 1);\n      stop ->\n        true\n    end.\n\n%% \u975e\u540c\u671f\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30d7\u30ed\u30bb\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u308b\ndownloader(MainPid, Urls) ->\n  Starter = fun(X) ->\n    %% \u30d7\u30ed\u30bb\u30b9\u306e\u751f\u6210\n    Pid2 = spawn(?MODULE, download, [MainPid]),\n\n    %% \u30d7\u30ed\u30bb\u30b9\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u6295\u3052\u308b\n    Pid2 ! {X} end,\n\n  lists:foreach(Starter, Urls),\n  ok.\n\n%% \u7acb\u3061\u4e0a\u3052\u308b\u30d7\u30ed\u30bb\u30b9\ndownload(MainPid) ->\n  receive\n    {Url} ->\n      %% \u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5b9f\u884c\n      download_and_write_file(Url),\n\n      %% \u5b8c\u4e86\u3057\u305f\u65e8\u3092\u901a\u77e5\u3059\u308b\n      MainPid ! {Url};\n    stop ->\n      true\n  end.\n\n%% printer\nprint(Message) -> io:format(\"E: ~p~n\",[Message]).\n\n\n%% http\u901a\u4fe1\u3057\u3066file\u306b\u4fdd\u5b58\u3059\u308b\ndownload_and_write_file(Url) ->\n  Body = http_request(Url),\n  Path = path_generator(Url),\n  file_writer(Body, Path),\n  ok.\n\n%% URL\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u3092\u751f\u6210\u3059\u308b\u3002\npath_generator(Url) ->\n  FileName = name_generator(Url),\n  Path = string:concat(\"/tmp/download/\", FileName),\n  Path.\n\n%% URL\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u751f\u6210\u3059\u308b\u3002\nname_generator(Url) ->\n  {ok, Result} = http_uri:parse(Url),\n  {Scheme, UserInfo, Host, Port, Path, Query} = Result,\n  %% \"/\" \u3092\u524a\u9664\u3057\u3066\u6587\u5b57\u5217\u306b\u5909\u63db\n  re:replace(Path, \"/\", \"\", [global, {return, list}]).\n\n%% http \u901a\u4fe1\u3057\u3066Body\u3092\u8fd4\u3059\nhttp_request(URL) ->\n  inets:start(),\n  {ok, {{Version, 200, ReasonPhrase}, Headers, Body}} = httpc:request(URL),\n  Body.\n\n%% file\u306b\u4fdd\u5b58\u3059\u308b\nfile_writer(Body, FilePath) ->\n  file:write_file(FilePath, Body, [binary, write]).\n\n```\n\n```shell-session:\u30b3\u30f3\u30d1\u30a4\u30eb\u3068\u5b9f\u884c\n# \u30b3\u30f3\u30d1\u30a4\u30eb\u3068\u5b9f\u884c\necho \"+++++++++++++\"\nerlc ./dwn.erl\necho \"+++++++++++++\"\ntime erl -noshell -s dwn main -s init stop\necho \"+++++++++++++\"\n\n```\n\n```shell-session:\u5b9f\u884c\u7d50\u679c\n+++++++++++++\nE: \"http://stackoverflow.com/questions/7595128/how-to-optimize-the-receive-loop-for-thousands-of-messages-in-erlang\"\nE: \"http://stackoverflow.com/tags\"\nE: \"http://stackoverflow.com/questions/tagged/c%23\"\nE: \"http://stackoverflow.com/jobs\"\nE: \"http://erlang.2086793.n4.nabble.com/Question-re-io-format-and-string-handling-td2109722.html\"\nE: \"http://erlang.org/doc/apps/inets/http_client.html\"\nE: \"http://erlang.org/doc/apps/inets/release_notes.html\"\nE: \"http://erlang.org/doc/apps/inets/inets_services.html#id60923\"\nE: \"http://erlang.org/doc/man/httpc.html\"\nE: \"http://www.erlang.org/mailman/listinfo/erlang-questions\"\n\nreal\t0m3.462s\nuser\t0m0.258s\nsys\t0m0.142s\n+++++++++++++\n```shell-session:\u5b9f\u884c\u7d50\u679c\n\n```\n\n# Erlang\u6709\u8b58\u8005\u306b\u30b3\u30fc\u30c9\u898b\u305b\u305f\u7d50\u679c\n\u30ed\u30b8\u30c3\u30af\u306f\u6b63\u3057\u3044\u304c\u3001\u696d\u52d9\u3067\u306f\u6b21\u306e3\u3064\u306e\u95a2\u6570\u306f\u57fa\u672c\u7684\u306b\u5229\u7528\u305b\u305a\u3001behavior\u3092\u5229\u7528\u3059\u308b\u3068\u30a2\u30c9\u30d0\u30a4\u30b9\u3092\u9802\u304d\u307e\u3057\u305f\u3002\n\n\u25a0 \u696d\u52d9\u3067Erlang\u66f8\u304f\u3068\u304d\u306f\u3001\u6b21\u306e3\u3064\u306e\u95a2\u6570\u3092\u307b\u307c\u5229\u7528\u3057\u306a\u3044\n1. spawn \u7981\u6b62\n2. receive \u7981\u6b62\n3. Pid ! {} \u7981\u6b62\n\n\u25a0 \u5bfe\u7b56\n\u9069\u5207\u306bbehavior\u3092\u4f7f\u3063\u3066\u66f8\u304d\u76f4\u305d\u3046\n1. application\n2. supervisor\n3. gen_server\n4. gen_fsm\n\n# \u6b21\u306e\u5b66\u7fd2\n\u6b21\u306fbehavior\u3092\u4f7f\u3063\u3066\u4e26\u884c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u66f8\u304d\u76f4\u3057\u3066\u307f\u307e\u3059\n\n\n\n\n\n\n\n", "tags": ["Erlang"]}