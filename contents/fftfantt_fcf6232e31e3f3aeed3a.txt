{"context": "csvde\u3067\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3057\u305fActiveDirectory\u306e\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\u3092VBScript\u3067\u8aad\u307f\u8fbc\u307f\u3001\u5fc5\u8981\u9805\u76ee\u3092\u914d\u5217\u306b\u683c\u7d0d\u3059\u308b\u969b\u306e\u30e1\u30e2\u3067\u3059\u3002\n\u30fbcsvde\u3067\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3057\u305fUNICODE\u306eCSV\u3092\u8aad\u307f\u8fbc\u3080\n\u30fb\u30d8\u30c3\u30c0\u30fc\u3092\u8aad\u307f\u8fbc\u307f\u5fc5\u8981\u306a\u9805\u76ee\u306eINDEX\u756a\u53f7\u3092\u53d6\u5f97\n\u30fb\u30c7\u30fc\u30bf\u90e8\u5206\u3092\u914d\u5217\u306b\u5165\u308c\u308b\uff08\u30ec\u30b3\u30fc\u30c9\u306e\u9664\u5916\u3042\u308a\uff09\n\u3042\u3068\u306f\u3001INDEX\u756a\u53f7\u3092\u6307\u5b9a\u3057\u3066\u610f\u56f3\u3057\u305f\u5217\u9806\u306b\u3057\u3066\u3001Shift_JIS\u306b\u3057\u3066\u66f8\u304d\u51fa\u3057\u305f\u308a\uff08\u30a8\u30af\u30bb\u30eb\u3067\u958b\u3044\u305f\u3068\u304d\u306b\u3061\u3083\u3093\u3068\u30ab\u30f3\u30de\u533a\u5207\u308a\u3067\u5217\u304c\u5206\u304b\u308c\u307e\u3059\uff09\u3001\u5224\u5b9a\u306b\u4f7f\u3063\u305f\u308a\u3001\u30e1\u30fc\u30eb\u98db\u3070\u3057\u305f\u308a\u3057\u3066\u4f7f\u3048\u307e\u3059\u3002\n\u6700\u521d\u304b\u3089\u9805\u76ee\u3092\u6307\u5b9a\u3057\u3066\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u6307\u5b9a\u3082\u3067\u304d\u307e\u3059\u304c\u3001Dn\u306e\u9805\u76ee\u306f\u6b8b\u3063\u3066\u3057\u307e\u3046\u306e\u3068\u30011\u65e51\u56de\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3057\u305fAD\u306e\u30c7\u30fc\u30bf\u3092\u8907\u6570\u306e\u7528\u9014\u3067\u4f7f\u7528\u3059\u308b\u3068\u304d\u306b\u3001\u3053\u306e\u65b9\u304c\u6c4e\u7528\u7684\u3060\u3068\u601d\u3063\u3066\u4f5c\u308a\u307e\u3057\u305f\u3002\n\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3067\u9805\u76ee\u304c\u5897\u3048\u3066\u3082\u3001\u5143\u3005\u306e\u9805\u76ee\u540d\u304c\u5909\u308f\u3089\u306a\u3051\u308c\u3070\u4f7f\u3048\u307e\u3059\u3057\u306d\u3002\n\u305f\u3060\u3001SQL\u5206\u304b\u308b\u3088\u3063\u3066\u4eba\u306f\u300cADO\u3092\u4f7f\u3063\u3066CSV\u30d5\u30a1\u30a4\u30eb\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u65b9\u6cd5\u300d\u3092\u8abf\u3079\u3066\u305d\u3061\u3089\u3092\u4f7f\u3046\u3053\u3068\u3092\u5f37\u304f\u63a8\u5968\u3057\u307e\u3059\u3001\u3042\u304f\u307e\u3067\u3082\u3053\u3093\u306a\u65b9\u6cd5\u3082\u3042\u308b\u3088\u3063\u3066\u3053\u3068\u3067\u30fb\u30fb\u30fb\n(\u30ed\u30af\u306b\u8abf\u3079\u3082\u305b\u305a\u306b\u3068\u308a\u3042\u3048\u305a\u4f5c\u6210\u3057\u305f\u306a\u3093\u3066\u3068\u3066\u3082\u8a00\u3048\u306a\u3044(^_^;))\n'*****************************************\n'\u30e1\u30a4\u30f3\u51e6\u7406\n'*****************************************\n\n '\u5fc5\u8981\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n  Set FSO = CreateObject(\"Scripting.FileSystemObject\")\n  Set objWShell = CreateObject(\"WScript.Shell\")\n\n 'AD\u30c7\u30fc\u30bf\u3092\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\n  objWShell.Run \"cmd /c csvde -u -f ExportAD.csv -r objectCategory=user\",1,True\n\n  '\u30d8\u30c3\u30c0\u30fc\u3092\u914d\u5217\u306b\u683c\u7d0d\n  Set oFile1 = FSO.OpenTextFile(InputFile, 1, , -1)\n  Line1 = oFile1.ReadLine\n  CountArr = ArrCount(Line1,\",\")\n  ArrInput Line1 , ArrHead1 , CountArr , \",\"\n\n '\u4e00\u81f4\u3059\u308b\u540d\u524d\u306eINDEX\u53d6\u5f97\n  memberOfNum = ArrSearch(\"memberOf\",ArrHead1)\n  sAMAccountNameNum = ArrSearch(\"sAMAccountName\",ArrHead1)\n  departmentNum = ArrSearch(\"department\",ArrHead1)\n  displayNameNum = ArrSearch(\"displayName\",ArrHead1)\n  pwdLastSetNum = ArrSearch(\"pwdLastSet\",ArrHead1)\n  lastLogonTimestampNum = ArrSearch(\"lastLogonTimestamp\",ArrHead1)\n  mailNum = ArrSearch(\"mail\",ArrHead1)\n\n'  AD\u30c7\u30fc\u30bf\u3092\u914d\u5217\u306b\u683c\u7d0d\n  Do      \n    LoopSW1 = 1\n    Do Until oFile1.AtEndOfLine = True\n      Line1 = oFile1.ReadLine\n      ArrInput Line1 , ArrData1 , ArrCount(Line1,\",\") , \",\"\n      'TEST\u30e6\u30fc\u30b6\u30fc\u306f\u9664\u5916\n      If InStr(ArrData1(memberOfNum),\"test_users\") = 0 and Then\n        LoopSW1 = 0\n        Exit Do\n      End if\n    Loop\n  Loop\n\n\n'*****************************************\n'\u7279\u5b9a\u306e\u5024\u304c\u5165\u3063\u305f\u914d\u5217\u306eINDEX\u3092\u8fd4\u3059\n'*****************************************\nFunction ArrSearch(SearchStr,ArrData)\n  Dim MaxArr\n  Dim X\n  ErrProcedure= \"ArrSearch\"\n  MaxArr = UBound(ArrData)\n  For X = 0 To MaxArr\n    if SearchStr = ArrData(X) Then\n      ArrSearch = X\n      Exit For\n    End if\n  Next\nEnd Function\n\n\n'*****************************************\n'\uff11\u884c\u306e\u914d\u5217\u683c\u7d0d\u306b\u5fc5\u8981\u306a\u6700\u5927Index\u5024\u3092\u8fd4\u3059\n'*****************************************\nFunction ArrCount(StrLine,CutStr)\n  Dim X\n  Dim MaxStr\n  Dim PSW\n  ErrProcedure= \"ArrCount\"\n  ArrCount = 0\n  if CutStr = \"\" then CutStr=\",\"\n  MaxStr = Len(StrLine)\n  if MaxStr <= 0 then Exit Function\n  For X = 1 To MaxStr\n    if Mid(StrLine,X,1) = \"\"\"\" then\n      if PSW = 0 then\n        PSW = 1\n      Else\n        PSW = 0\n      End if\n    End if\n    if Mid(StrLine,X,1) = CutStr and PSW = 0 then ArrCount = ArrCount + 1 \n  Next\nEnd Function\n\n\n'*****************************************\n'\uff11\u884c\u3092\u914d\u5217\u306b\u683c\u7d0d\u3059\u308b\n'*****************************************\nSub  ArrInput (ByVal StrLine,ByRef ArrData,ByVal ArrCount,ByVal CutStr)\n  Dim X1\n  Dim X2\n  Dim StrText\n  Dim MaxStr\n  Dim PSW\n  PSW = 0\n  ReDim ArrData(ArrCount)\n  MaxStr = Len(StrLine)\n  if MaxStr <= 0 then Exit Sub\n  For X1 = 1 To MaxStr\n    if Mid(StrLine,X1,1) = \"\"\"\" then\n      if PSW = 0 then\n        PSW = 1\n      Else\n        PSW = 0\n      End if\n    End if\n    if Mid(StrLine,X1,1) = CutStr and PSW = 0 then \n      ArrData(X2) = StrText\n      X2 = X2 + 1\n      StrText = \"\"\n      if X2 > ArrCount Then Exit For\n    End if\n    if  Mid(StrLine,X1,1) <> \"\"\"\" and Mid(StrLine,X1,1) <> CutStr or Mid(StrLine,X1,1) = CutStr and PSW = 1 then\n        StrText = StrText & Mid(StrLine,X1,1)\n    End if   \n  Next\nEnd Sub\n\n\ncsvde\u3067\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3057\u305fActiveDirectory\u306e\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\u3092VBScript\u3067\u8aad\u307f\u8fbc\u307f\u3001\u5fc5\u8981\u9805\u76ee\u3092\u914d\u5217\u306b\u683c\u7d0d\u3059\u308b\u969b\u306e\u30e1\u30e2\u3067\u3059\u3002\n\n\u30fbcsvde\u3067\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3057\u305fUNICODE\u306eCSV\u3092\u8aad\u307f\u8fbc\u3080\n\u30fb\u30d8\u30c3\u30c0\u30fc\u3092\u8aad\u307f\u8fbc\u307f\u5fc5\u8981\u306a\u9805\u76ee\u306eINDEX\u756a\u53f7\u3092\u53d6\u5f97\n\u30fb\u30c7\u30fc\u30bf\u90e8\u5206\u3092\u914d\u5217\u306b\u5165\u308c\u308b\uff08\u30ec\u30b3\u30fc\u30c9\u306e\u9664\u5916\u3042\u308a\uff09\n\n\u3042\u3068\u306f\u3001INDEX\u756a\u53f7\u3092\u6307\u5b9a\u3057\u3066\u610f\u56f3\u3057\u305f\u5217\u9806\u306b\u3057\u3066\u3001Shift_JIS\u306b\u3057\u3066\u66f8\u304d\u51fa\u3057\u305f\u308a\uff08\u30a8\u30af\u30bb\u30eb\u3067\u958b\u3044\u305f\u3068\u304d\u306b\u3061\u3083\u3093\u3068\u30ab\u30f3\u30de\u533a\u5207\u308a\u3067\u5217\u304c\u5206\u304b\u308c\u307e\u3059\uff09\u3001\u5224\u5b9a\u306b\u4f7f\u3063\u305f\u308a\u3001\u30e1\u30fc\u30eb\u98db\u3070\u3057\u305f\u308a\u3057\u3066\u4f7f\u3048\u307e\u3059\u3002\n\n\u6700\u521d\u304b\u3089\u9805\u76ee\u3092\u6307\u5b9a\u3057\u3066\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u6307\u5b9a\u3082\u3067\u304d\u307e\u3059\u304c\u3001Dn\u306e\u9805\u76ee\u306f\u6b8b\u3063\u3066\u3057\u307e\u3046\u306e\u3068\u30011\u65e51\u56de\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3057\u305fAD\u306e\u30c7\u30fc\u30bf\u3092\u8907\u6570\u306e\u7528\u9014\u3067\u4f7f\u7528\u3059\u308b\u3068\u304d\u306b\u3001\u3053\u306e\u65b9\u304c\u6c4e\u7528\u7684\u3060\u3068\u601d\u3063\u3066\u4f5c\u308a\u307e\u3057\u305f\u3002\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3067\u9805\u76ee\u304c\u5897\u3048\u3066\u3082\u3001\u5143\u3005\u306e\u9805\u76ee\u540d\u304c\u5909\u308f\u3089\u306a\u3051\u308c\u3070\u4f7f\u3048\u307e\u3059\u3057\u306d\u3002\n\n\u305f\u3060\u3001SQL\u5206\u304b\u308b\u3088\u3063\u3066\u4eba\u306f\u300cADO\u3092\u4f7f\u3063\u3066CSV\u30d5\u30a1\u30a4\u30eb\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u65b9\u6cd5\u300d\u3092\u8abf\u3079\u3066\u305d\u3061\u3089\u3092\u4f7f\u3046\u3053\u3068\u3092\u5f37\u304f\u63a8\u5968\u3057\u307e\u3059\u3001\u3042\u304f\u307e\u3067\u3082\u3053\u3093\u306a\u65b9\u6cd5\u3082\u3042\u308b\u3088\u3063\u3066\u3053\u3068\u3067\u30fb\u30fb\u30fb\n(\u30ed\u30af\u306b\u8abf\u3079\u3082\u305b\u305a\u306b\u3068\u308a\u3042\u3048\u305a\u4f5c\u6210\u3057\u305f\u306a\u3093\u3066\u3068\u3066\u3082\u8a00\u3048\u306a\u3044(^_^;))\n\n\n```vbnet\n'*****************************************\n'\u30e1\u30a4\u30f3\u51e6\u7406\n'*****************************************\n\n '\u5fc5\u8981\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n  Set FSO = CreateObject(\"Scripting.FileSystemObject\")\n  Set objWShell = CreateObject(\"WScript.Shell\")\n\n 'AD\u30c7\u30fc\u30bf\u3092\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\n  objWShell.Run \"cmd /c csvde -u -f ExportAD.csv -r objectCategory=user\",1,True\n\n  '\u30d8\u30c3\u30c0\u30fc\u3092\u914d\u5217\u306b\u683c\u7d0d\n  Set oFile1 = FSO.OpenTextFile(InputFile, 1, , -1)\n  Line1 = oFile1.ReadLine\n  CountArr = ArrCount(Line1,\",\")\n  ArrInput Line1 , ArrHead1 , CountArr , \",\"\n\n '\u4e00\u81f4\u3059\u308b\u540d\u524d\u306eINDEX\u53d6\u5f97\n  memberOfNum = ArrSearch(\"memberOf\",ArrHead1)\n  sAMAccountNameNum = ArrSearch(\"sAMAccountName\",ArrHead1)\n  departmentNum = ArrSearch(\"department\",ArrHead1)\n  displayNameNum = ArrSearch(\"displayName\",ArrHead1)\n  pwdLastSetNum = ArrSearch(\"pwdLastSet\",ArrHead1)\n  lastLogonTimestampNum = ArrSearch(\"lastLogonTimestamp\",ArrHead1)\n  mailNum = ArrSearch(\"mail\",ArrHead1)\n\n'  AD\u30c7\u30fc\u30bf\u3092\u914d\u5217\u306b\u683c\u7d0d\n  Do      \n    LoopSW1 = 1\n    Do Until oFile1.AtEndOfLine = True\n      Line1 = oFile1.ReadLine\n      ArrInput Line1 , ArrData1 , ArrCount(Line1,\",\") , \",\"\n      'TEST\u30e6\u30fc\u30b6\u30fc\u306f\u9664\u5916\n      If InStr(ArrData1(memberOfNum),\"test_users\") = 0 and Then\n        LoopSW1 = 0\n        Exit Do\n      End if\n    Loop\n  Loop\n\n\n'*****************************************\n'\u7279\u5b9a\u306e\u5024\u304c\u5165\u3063\u305f\u914d\u5217\u306eINDEX\u3092\u8fd4\u3059\n'*****************************************\nFunction ArrSearch(SearchStr,ArrData)\n  Dim MaxArr\n  Dim X\n  ErrProcedure= \"ArrSearch\"\n  MaxArr = UBound(ArrData)\n  For X = 0 To MaxArr\n    if SearchStr = ArrData(X) Then\n      ArrSearch = X\n      Exit For\n    End if\n  Next\nEnd Function\n\n\n'*****************************************\n'\uff11\u884c\u306e\u914d\u5217\u683c\u7d0d\u306b\u5fc5\u8981\u306a\u6700\u5927Index\u5024\u3092\u8fd4\u3059\n'*****************************************\nFunction ArrCount(StrLine,CutStr)\n  Dim X\n  Dim MaxStr\n  Dim PSW\n  ErrProcedure= \"ArrCount\"\n  ArrCount = 0\n  if CutStr = \"\" then CutStr=\",\"\n  MaxStr = Len(StrLine)\n  if MaxStr <= 0 then Exit Function\n  For X = 1 To MaxStr\n    if Mid(StrLine,X,1) = \"\"\"\" then\n      if PSW = 0 then\n        PSW = 1\n      Else\n        PSW = 0\n      End if\n    End if\n    if Mid(StrLine,X,1) = CutStr and PSW = 0 then ArrCount = ArrCount + 1 \n  Next\nEnd Function\n\n\n'*****************************************\n'\uff11\u884c\u3092\u914d\u5217\u306b\u683c\u7d0d\u3059\u308b\n'*****************************************\nSub  ArrInput (ByVal StrLine,ByRef ArrData,ByVal ArrCount,ByVal CutStr)\n  Dim X1\n  Dim X2\n  Dim StrText\n  Dim MaxStr\n  Dim PSW\n  PSW = 0\n  ReDim ArrData(ArrCount)\n  MaxStr = Len(StrLine)\n  if MaxStr <= 0 then Exit Sub\n  For X1 = 1 To MaxStr\n    if Mid(StrLine,X1,1) = \"\"\"\" then\n      if PSW = 0 then\n        PSW = 1\n      Else\n        PSW = 0\n      End if\n    End if\n    if Mid(StrLine,X1,1) = CutStr and PSW = 0 then \n      ArrData(X2) = StrText\n      X2 = X2 + 1\n      StrText = \"\"\n      if X2 > ArrCount Then Exit For\n    End if\n    if  Mid(StrLine,X1,1) <> \"\"\"\" and Mid(StrLine,X1,1) <> CutStr or Mid(StrLine,X1,1) = CutStr and PSW = 1 then\n        StrText = StrText & Mid(StrLine,X1,1)\n    End if   \n  Next\nEnd Sub\n\n```\n", "tags": ["VBScript"]}