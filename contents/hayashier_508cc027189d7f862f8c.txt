{"context": "\n\nOpsWorks\u306e\u5b9f\u884c\n\n\u30ab\u30b9\u30bf\u30e0Chef\u30ec\u30b7\u30d4\u306e\u4f5c\u6210\n\n\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\nmkdir -p ops-works-base/base/recipes\nvim ops-works-base/base/recipes/install.rb\n\nPHP\u306b\u3088\u308bWeb\u30b5\u30fc\u30d0\u69cb\u7bc9\u3059\u308b\u7c21\u5358\u306a\u30ec\u30b7\u30d4\u306f\u4f8b\u3048\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n\ninstall.rb\npackage \"vim-enhanced\" do\n  action :install\nend\n\n%w{php mysql-server httpd}.each do |p|\n  package p do\n    action :install\n  end\nend\n\nservice \"httpd\" do\n  action [:start, :enable]\nend\n\n\n\nGutHub\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u7f6e\u304f\nGitHub\u4e2d\u306b\u30ec\u30dd\u30b8\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001\u305d\u3061\u3089\u306b\u76f4\u4e0b\u306bbase\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u6765\u308b\u3088\u3046\u306b\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\u3059\u308b\u3002\n\u3053\u3053\u3067\u306fops-works-base\u3068\u3044\u3046\u30ec\u30dd\u30b8\u30c8\u30ea\u540d\u3068\u3059\u308b\u3002\n\nOpsWorks\u306e\u8a2d\u5b9a\n1.\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089[OpsWorks]\u3092\u9078\u629e\n2.[Add stack]\u3092\u9078\u629e\n3.\u4ee5\u4e0b\u306e4\u3064\u3092\u8a2d\u5b9a\u3059\u308b\u3002Default SSH key\u3084Repository URL\u306f\u9069\u5b9c\u81ea\u5206\u306e\u4f7f\u3063\u3066\u3044\u308bSSH Key\u306e\u7269\u306b\u7f6e\u304d\u63db\u3048\u308b\u3002\nStack name: SampleStack\nDefault SSH key:aws-test\nUse custom Chef cookbooks: Yes\nRepository URL: https://github.com/xxxxxxx/ops-works-base.git\n\u305d\u308c\u4ee5\u5916\u306eVPC\u306e\u8a2d\u5b9a\u306a\u3069\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u307e\u307e\u9032\u3081\u308b\u3002\n4.[Add stack]\u3092\u9078\u629e\n5.[Add a layer]\u3092\u9078\u629e\nName: Sample Web Server\nShort name: sample\n6.[Add layer]\u3092\u9078\u629e\n7.Layers\u306e\u753b\u9762\u306b\u306a\u308b\u306e\u3067\u3001\u4f5c\u6210\u3057\u305flayer\u306b\u5bfe\u3057\u3066\u3001[Add instance]\u3092\u9078\u629e\n8.[New]\u306e\u30bf\u30d6\u304b\u3089\u3001\u5fc5\u8981\u4e8b\u9805\u3092\u5165\u529b\u3059\u308b\u3002\n\u3053\u3053\u3067\u306f\u3001Hostname\u306f\u8a18\u5165\u3057\u3066\u3001Size\u3092t2micro\u306b\u5909\u66f4\u3057\u3066\u3001\u6b8b\u308a\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u306b\u3059\u308b\u3002SSH key\u306f\u9069\u5f53\u306a\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u304a\u304f\u3002\nHostname: sample\nSize: t2.micro\n9.\u4f5c\u6210\u3057\u305fhost\u306b\u5bfe\u3057\u3066\u3001[start]\u3092\u9078\u629e\u3002\n10.\u8d77\u52d5\u3057\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eStatus\u304cOnline\u306b\u306a\u3063\u305f\u3089\u3001[Stack]\u3092\u9078\u629e\u3057\u3066[Run command]\u3092\u9078\u629e\u3002\u2028\n\u2028\n\u2028\u2028Command: Execute Recipes\nRecipes to execute: basic::install\n\u2028\u2028\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u5b9f\u884c\u3059\u308b\u3002\u3053\u3053\u3067\u306f\u3001\u6b8b\u308a\u5168\u3066\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u3067\u884c\u3046\u3002\n\u4e0a\u8a18\u306e\u5b9f\u884c\u7d50\u679c\u304c\u6210\u529f\u3059\u308c\u3070\u5b8c\u4e86\u3002Chefbook\u3067\u306e\u8a2d\u5b9a\u5185\u5bb9\u304c\u30b5\u30fc\u30d0\u306b\u53cd\u6620\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u6ce8\u610f\u70b9\n\nChef\u5358\u4f53\u3068OpsWorks\u306b\u304a\u3051\u308b\u9055\u3044\n\nCookbooks\u30d5\u30a1\u30a4\u30eb\u4ee5\u5916\u306e\u30d5\u30a1\u30a4\u30eb(solo.json,solo.rb\u7b49)\u306fGitHub\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u542b\u3081\u308b\u5fc5\u8981\u304c\u306a\u3044\u3002\nChef\u3067\u306frecipe\u30d5\u30a1\u30a4\u30eb\u3092knife cookbook create\u3092\u7528\u3044\u3066\u4f5c\u6210\u3059\u308b\u304c\u3001OpsWorks\u3067\u306f\u5fc5\u8981\u306aruby\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066\u9069\u5207\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4e2d\u306b\u914d\u7f6e\u3059\u308b\u5f62\u3067GitHub\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u304a\u3051\u3070\u826f\u3044\u3002\n\n\nChef \u8981\u70b9\u304a\u3055\u3089\u3044\nChef\u306b\u306f\u4ee5\u4e0b\u306e2\u7a2e\u985e\u306b\u3088\u308b\u65b9\u6cd5\u304c\u3042\u308b\u3002\n\n\u30b9\u30bf\u30f3\u30c9\u30a2\u30ed\u30f3\u69cb\u6210\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8/\u30b5\u30fc\u30d0\u69cb\u6210(Chef Server)\n\n\u3053\u3053\u3067\u306f\u3001\u30b9\u30bf\u30f3\u30c9\u30a2\u30ed\u30f3\u69cb\u6210\u3068\u3057\u3066chef-solo\u306b\u3088\u308b\u65b9\u6cd5\u3092\u53d6\u308a\u4e0a\u3052\u308b\u3002\n\u306a\u304a\u3001chef-solo\u304cdepricated\u306a\u4e88\u5b9a\u306a\u306e\u3067\u3001\u4ee3\u308f\u308a\u306bChef Client Local Mode\u3092\u4f7f\u3046\u3053\u3068\u304c\u63a8\u5968\u3055\u308c\u3066\u3044\u308b\u3002\nhttps://blog.chef.io/2014/06/24/from-solo-to-zero-migrating-to-chef-client-local-mode/\n\nchef-solo\u306b\u3088\u308b\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\n\u6700\u4f4e\u3001recipe\u30d5\u30a1\u30a4\u30eb\u3068solo.rb,solo,json\u306e3\u3064\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3059\u308b\u3053\u3068\u3067\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u304c\u53ef\u80fd\u306b\u306a\u308b\u3002\n\nChef\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ncurl -L https://www.opscode.com/chef/install.sh | sudo bash\n\n\nCookbook\u4f5c\u6210\nbasic\u3068\u3044\u3046\u540d\u524d\u306eCookbook\u306e\u4f5c\u6210\nknife cookbook create basic -o /opt/chef-test/\n\n\nChef \u30d5\u30a1\u30a4\u30eb\u69cb\u6210\n$ tree /opt/chef-test/\n/opt/chef-test/\n\u251c\u2500\u2500 basic\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 CHANGELOG.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 README.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 attributes\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 definitions\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 files\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 default\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 libraries\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 metadata.rb\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 providers\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 recipes\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 default.rb\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 install.rb\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 resources\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 templates\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 default\n\u251c\u2500\u2500 solo.json\n\u2514\u2500\u2500 solo.rb\n\n18 directories, 16 files\n\nfiles: \u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\ntemlates: \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\nattributes: \u30ec\u30b7\u30d4\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u5024\n\nPHP Web\u30b5\u30fc\u30d0\u69cb\u7bc9\nvim /opt/chef-test/basic/recipes/install.rb\n\npackage \"vim-enhanced\" do\n  action :install\nend\n\n%w{php mysql-server httpd}.each do |p|\n  package p do\n    action :install\n  end\nend\n\nservice \"httpd\" do\n  action [:start, :enable]\nend\n\nchef-solo\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\nvim /opt/chef-test/solo.rb\n\n\nsolo.rb\nbase = File.expand_path('..', __FILE__)\ncookbook_path [base]\n\n\n\n\u203b\u6ce8\u610f\u70b9\ncookbook_path\u306f/opt/chef-test\u306bCookbook\u3092\u7f6e\u304f\u306e\u3067\u3042\u308c\u3070\u3001\u3053\u306e\u307e\u307e\u7d76\u5bfe\u30d1\u30b9\u3067\u66f8\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u7d76\u5bfe\u30d1\u30b9\u3092\u76f4\u66f8\u304d\u3057\u3066\u3082\u826f\u3044\u304c\u6c4e\u7528\u6027\u304c\u4e0b\u304c\u308b\u306e\u3067\u3001\u3053\u3053\u3067\u306fFile.expand_path()\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u3002\ncookbook_path['/opt/chef-test/']\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3057\u3066\u3082\u826f\u3044\u3002\n\u5b9f\u884c\u3059\u308bRecipe\u3092\u6307\u5b9a\u3059\u308bJSON\u306e\u4f5c\u6210\nvim /opt/chef-test/solo.json\n\n\nsolo.json\n{\n  \"run_list\" : [\n    \"recipe[basic::install]\"\n  ]\n}\n\n\n$ cd /opt/chef-test\n$ sudo chef-solo -c solo.rb -j solo.json\n[2016-09-13T02:03:21+00:00] INFO: Started chef-zero at chefzero://localhost:8889 with repository at /opt/chef-test\n  One version per cookbook\n\n[2016-09-13T02:03:21+00:00] INFO: Forking chef instance to converge...\n[2016-09-13T02:03:21+00:00] INFO: *** Chef 12.13.37 ***\n[2016-09-13T02:03:21+00:00] INFO: Platform: x86_64-linux\n[2016-09-13T02:03:21+00:00] INFO: Chef-client pid: 26603\n[2016-09-13T02:03:23+00:00] INFO: HTTP Request Returned 404 Not Found: Object not found: chefzero://localhost:8889/nodes/test1.localdomain\n[2016-09-13T02:03:23+00:00] INFO: Setting the run_list to [\"recipe[basic::install]\"] from CLI options\n[2016-09-13T02:03:23+00:00] INFO: Run List is [recipe[basic::install]]\n[2016-09-13T02:03:23+00:00] INFO: Run List expands to [basic::install]\n[2016-09-13T02:03:23+00:00] INFO: Starting Chef Run for test1.localdomain\n[2016-09-13T02:03:23+00:00] INFO: Running start handlers\n[2016-09-13T02:03:23+00:00] INFO: Start handlers complete.\n[2016-09-13T02:03:23+00:00] INFO: HTTP Request Returned 404 Not Found: Object not found:\n[2016-09-13T02:03:23+00:00] WARN: Cookbook 'local-mode-cache' is empty or entirely chefignored at /home/ec2-user/local-mode-cache\n[2016-09-13T02:03:23+00:00] INFO: Loading cookbooks [basic@0.1.0]\n[2016-09-13T02:03:23+00:00] INFO: Storing updated cookbooks/basic/CHANGELOG.md in the cache.\n[2016-09-13T02:03:23+00:00] INFO: Storing updated cookbooks/basic/metadata.rb in the cache.\n[2016-09-13T02:03:23+00:00] INFO: Storing updated cookbooks/basic/recipes/install.rb in the cache.\n[2016-09-13T02:03:23+00:00] INFO: Storing updated cookbooks/basic/recipes/default.rb in the cache.\n[2016-09-13T02:03:23+00:00] INFO: Storing updated cookbooks/basic/README.md in the cache.\n[2016-09-13T02:03:23+00:00] INFO: Processing yum_package[vim-enhanced] action install (basic::install line 1)\n[2016-09-13T02:03:24+00:00] INFO: Processing yum_package[php] action install (basic::install line 6)\n[2016-09-13T02:03:24+00:00] INFO: Processing yum_package[mysql-server] action install (basic::install line 6)\n[2016-09-13T02:03:24+00:00] INFO: Processing yum_package[httpd] action install (basic::install line 6)\n[2016-09-13T02:03:24+00:00] INFO: Processing service[httpd] action start (basic::install line 11)\n[2016-09-13T02:03:24+00:00] INFO: Processing service[httpd] action enable (basic::install line 11)\n[2016-09-13T02:03:24+00:00] INFO: Chef Run complete in 1.189445961 seconds\n[2016-09-13T02:03:24+00:00] INFO: Running report handlers\n[2016-09-13T02:03:24+00:00] INFO: Report handlers complete\n\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u53d6\u308a\u8fbc\u307f\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u53d6\u308a\u8fbc\u307f\u65b9\u306b\u3064\u3044\u3066\u3001template\u3068cookbook_file\u306e\u305d\u308c\u305e\u308c\u306b\u3088\u308b\u65b9\u6cd5\u3092\u53d6\u308a\u4e0a\u3052\u308b\u3002\u4e21\u8005\u306e\u9055\u3044\u306f\u3001template\u304c\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u3092\u5bfe\u8c61\u3068\u3057\u3066\u3044\u308b\u306e\u306b\u5bfe\u3057\u3066\u3001cookbook_file\u306f.erb\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u307f\u53ef\u80fd\u3067\u52d5\u7684\u306a\u8a2d\u5b9a\u304c\u53ef\u80fd\u3067\u3042\u308b\u3002\n\n\u4e88\u3081\u7528\u610f\u3057\u3066\u304a\u3044\u305fhttpd.conf\u3092\u7528\u3044\u308b\u5834\u5408 by template\n\u7528\u610f\u3057\u305fhttpd.conf\u3092http.conf.erb\u3068\u3057\u3066\u304a\u304d\u3001templates/default\u4ee5\u4e0b\u306b\u7f6e\u304f\u3002\u307e\u305f\u3001recipe\u30d5\u30a1\u30a4\u30eb\u4e2d\u306e\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3067httpd\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304b\u3089\u3001\u8aad\u307f\u8fbc\u3080\u5ba3\u8a00\u306e\u524d\u306btemplate\u3092\u7528\u3044\u3066\u3001\u4ee5\u4e0b\u3092\u8ffd\u8a18\u3059\u308b\u3002\ntemplate '/etc/httpd/conf/httpd.conf' do\n  source 'httpd.conf.erb'\n  action :create\nend\n\n\nPHP\u306e\u5404\u7a2e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066php.ini\u306e\u5185\u5bb9\u3092Web\u30b5\u30fc\u30d0\u306b\u53cd\u6620 by cookbook_file\nhttpd\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u5f8c\u306b\u4ee5\u4e0b\u3092recipe\u30d5\u30a1\u30a4\u30eb\u4e2d\u306e\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u306b\u5b9a\u7fa9\u3059\u308b\u3002\n\u2028%w[php php-devel php-mbstring gd-devel php-gd php-mysql].each do |pkg|\n        yum_package pkg do\n          action :install\n        end\nend\n\ncookbook_file \"/etc/php.ini\" do\n  mode 0644\n  notifies :reload, 'service[httpd]'\nend\n\n\n\u53c2\u8003\n\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\nhttps://aws.amazon.com/jp/opsworks/\nAWS OpsWorks\u3067\u30ab\u30b9\u30bf\u30e0Chef\u30ec\u30b7\u30d4\u3092\u5b9f\u884c\u3092\u3059\u308b\u65b9\u6cd5\nhttp://aws.typepad.com/sajp/2014/05/opsworks-custom-recipe.html\nChef\u3067\u30b5\u30fc\u30d0\u3092\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5 \u5165\u9580\u7de8 [httpd,php,mysql\u3092\u4e00\u767a\u3067\u5165\u308c\u308b]\nhttp://tkoyama1988.hatenablog.com/entry/2015/01/05/144656\nChef\u30ec\u30b7\u30d4\u9006\u5f15\u304d\u30e1\u30e2\nhttp://qiita.com/makoto_kw/items/53a84380559c087eb8fb\n#OpsWorks\u306e\u5b9f\u884c\n##\u30ab\u30b9\u30bf\u30e0Chef\u30ec\u30b7\u30d4\u306e\u4f5c\u6210\n###\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\n```bash\nmkdir -p ops-works-base/base/recipes\nvim ops-works-base/base/recipes/install.rb\n```\nPHP\u306b\u3088\u308bWeb\u30b5\u30fc\u30d0\u69cb\u7bc9\u3059\u308b\u7c21\u5358\u306a\u30ec\u30b7\u30d4\u306f\u4f8b\u3048\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n\n```install.rb\npackage \"vim-enhanced\" do\n  action :install\nend\n\n%w{php mysql-server httpd}.each do |p|\n  package p do\n    action :install\n  end\nend\n\nservice \"httpd\" do\n  action [:start, :enable]\nend\n```\n\n###GutHub\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u7f6e\u304f\nGitHub\u4e2d\u306b\u30ec\u30dd\u30b8\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001\u305d\u3061\u3089\u306b\u76f4\u4e0b\u306bbase\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u6765\u308b\u3088\u3046\u306b\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\u3059\u308b\u3002\n\u3053\u3053\u3067\u306f```ops-works-base```\u3068\u3044\u3046\u30ec\u30dd\u30b8\u30c8\u30ea\u540d\u3068\u3059\u308b\u3002\n\n##OpsWorks\u306e\u8a2d\u5b9a\n1.\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089[OpsWorks]\u3092\u9078\u629e\n2.[Add stack]\u3092\u9078\u629e\n\n3.\u4ee5\u4e0b\u306e4\u3064\u3092\u8a2d\u5b9a\u3059\u308b\u3002Default SSH key\u3084Repository URL\u306f\u9069\u5b9c\u81ea\u5206\u306e\u4f7f\u3063\u3066\u3044\u308bSSH Key\u306e\u7269\u306b\u7f6e\u304d\u63db\u3048\u308b\u3002\n\nStack name: SampleStack\nDefault SSH key:aws-test\n\nUse custom Chef cookbooks: Yes\nRepository URL: https://github.com/xxxxxxx/ops-works-base.git\n\n\u305d\u308c\u4ee5\u5916\u306eVPC\u306e\u8a2d\u5b9a\u306a\u3069\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u307e\u307e\u9032\u3081\u308b\u3002\n\n4.[Add stack]\u3092\u9078\u629e\n5.[Add a layer]\u3092\u9078\u629e\n\nName: Sample Web Server\nShort name: sample\n\n6.[Add layer]\u3092\u9078\u629e\n\n\n7.Layers\u306e\u753b\u9762\u306b\u306a\u308b\u306e\u3067\u3001\u4f5c\u6210\u3057\u305flayer\u306b\u5bfe\u3057\u3066\u3001[Add instance]\u3092\u9078\u629e\n\n8.[New]\u306e\u30bf\u30d6\u304b\u3089\u3001\u5fc5\u8981\u4e8b\u9805\u3092\u5165\u529b\u3059\u308b\u3002\n\u3053\u3053\u3067\u306f\u3001Hostname\u306f\u8a18\u5165\u3057\u3066\u3001Size\u3092t2micro\u306b\u5909\u66f4\u3057\u3066\u3001\u6b8b\u308a\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u306b\u3059\u308b\u3002SSH key\u306f\u9069\u5f53\u306a\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u304a\u304f\u3002\n\nHostname: sample\nSize: t2.micro\n\n\n9.\u4f5c\u6210\u3057\u305fhost\u306b\u5bfe\u3057\u3066\u3001[start]\u3092\u9078\u629e\u3002\n10.\u8d77\u52d5\u3057\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eStatus\u304cOnline\u306b\u306a\u3063\u305f\u3089\u3001[Stack]\u3092\u9078\u629e\u3057\u3066[Run command]\u3092\u9078\u629e\u3002\u2028\n\u2028\n\u2028\u2028Command: Execute Recipes\nRecipes to execute: basic::install\n\n\u2028\u2028\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u5b9f\u884c\u3059\u308b\u3002\u3053\u3053\u3067\u306f\u3001\u6b8b\u308a\u5168\u3066\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u3067\u884c\u3046\u3002\n\n\u4e0a\u8a18\u306e\u5b9f\u884c\u7d50\u679c\u304c\u6210\u529f\u3059\u308c\u3070\u5b8c\u4e86\u3002Chefbook\u3067\u306e\u8a2d\u5b9a\u5185\u5bb9\u304c\u30b5\u30fc\u30d0\u306b\u53cd\u6620\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\n#\u6ce8\u610f\u70b9\n##Chef\u5358\u4f53\u3068OpsWorks\u306b\u304a\u3051\u308b\u9055\u3044\n\n- Cookbooks\u30d5\u30a1\u30a4\u30eb\u4ee5\u5916\u306e\u30d5\u30a1\u30a4\u30eb(solo.json,solo.rb\u7b49)\u306fGitHub\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u542b\u3081\u308b\u5fc5\u8981\u304c\u306a\u3044\u3002\n- Chef\u3067\u306frecipe\u30d5\u30a1\u30a4\u30eb\u3092```knife cookbook create```\u3092\u7528\u3044\u3066\u4f5c\u6210\u3059\u308b\u304c\u3001OpsWorks\u3067\u306f\u5fc5\u8981\u306aruby\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066\u9069\u5207\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4e2d\u306b\u914d\u7f6e\u3059\u308b\u5f62\u3067GitHub\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u304a\u3051\u3070\u826f\u3044\u3002\n\n\n#Chef \u8981\u70b9\u304a\u3055\u3089\u3044\nChef\u306b\u306f\u4ee5\u4e0b\u306e2\u7a2e\u985e\u306b\u3088\u308b\u65b9\u6cd5\u304c\u3042\u308b\u3002\n\n* \u30b9\u30bf\u30f3\u30c9\u30a2\u30ed\u30f3\u69cb\u6210\n* \u30af\u30e9\u30a4\u30a2\u30f3\u30c8/\u30b5\u30fc\u30d0\u69cb\u6210(Chef Server)\n\n\u3053\u3053\u3067\u306f\u3001\u30b9\u30bf\u30f3\u30c9\u30a2\u30ed\u30f3\u69cb\u6210\u3068\u3057\u3066chef-solo\u306b\u3088\u308b\u65b9\u6cd5\u3092\u53d6\u308a\u4e0a\u3052\u308b\u3002\n\n\u306a\u304a\u3001chef-solo\u304cdepricated\u306a\u4e88\u5b9a\u306a\u306e\u3067\u3001\u4ee3\u308f\u308a\u306bChef Client Local Mode\u3092\u4f7f\u3046\u3053\u3068\u304c\u63a8\u5968\u3055\u308c\u3066\u3044\u308b\u3002\nhttps://blog.chef.io/2014/06/24/from-solo-to-zero-migrating-to-chef-client-local-mode/\n\n##chef-solo\u306b\u3088\u308b\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\n\u6700\u4f4e\u3001recipe\u30d5\u30a1\u30a4\u30eb\u3068solo.rb,solo,json\u306e3\u3064\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3059\u308b\u3053\u3068\u3067\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u304c\u53ef\u80fd\u306b\u306a\u308b\u3002\n\n###Chef\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\ncurl -L https://www.opscode.com/chef/install.sh | sudo bash\n```\n\n##Cookbook\u4f5c\u6210\nbasic\u3068\u3044\u3046\u540d\u524d\u306eCookbook\u306e\u4f5c\u6210\n\n```bash\nknife cookbook create basic -o /opt/chef-test/\n```\n\n###Chef \u30d5\u30a1\u30a4\u30eb\u69cb\u6210\n\n```bash\n$ tree /opt/chef-test/\n/opt/chef-test/\n\u251c\u2500\u2500 basic\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 CHANGELOG.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 README.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 attributes\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 definitions\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 files\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 default\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 libraries\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 metadata.rb\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 providers\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 recipes\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 default.rb\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 install.rb\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 resources\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 templates\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 default\n\u251c\u2500\u2500 solo.json\n\u2514\u2500\u2500 solo.rb\n\n18 directories, 16 files\n```\n\nfiles: \u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\ntemlates: \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\nattributes: \u30ec\u30b7\u30d4\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u5024\n\n###PHP Web\u30b5\u30fc\u30d0\u69cb\u7bc9\n```bash\nvim /opt/chef-test/basic/recipes/install.rb\n```\n\n```\npackage \"vim-enhanced\" do\n  action :install\nend\n\n%w{php mysql-server httpd}.each do |p|\n  package p do\n    action :install\n  end\nend\n\nservice \"httpd\" do\n  action [:start, :enable]\nend\n```\n\n\nchef-solo\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n\n```bash\nvim /opt/chef-test/solo.rb\n```\n\n\n```solo.rb\nbase = File.expand_path('..', __FILE__)\ncookbook_path [base]\n```\n\n###\u203b\u6ce8\u610f\u70b9\ncookbook_path\u306f```/opt/chef-test```\u306bCookbook\u3092\u7f6e\u304f\u306e\u3067\u3042\u308c\u3070\u3001\u3053\u306e\u307e\u307e\u7d76\u5bfe\u30d1\u30b9\u3067\u66f8\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u7d76\u5bfe\u30d1\u30b9\u3092\u76f4\u66f8\u304d\u3057\u3066\u3082\u826f\u3044\u304c\u6c4e\u7528\u6027\u304c\u4e0b\u304c\u308b\u306e\u3067\u3001\u3053\u3053\u3067\u306fFile.expand_path()\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u3002\n```cookbook_path['/opt/chef-test/']```\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3057\u3066\u3082\u826f\u3044\u3002\n\n\n\u5b9f\u884c\u3059\u308bRecipe\u3092\u6307\u5b9a\u3059\u308bJSON\u306e\u4f5c\u6210\n\n```bash\nvim /opt/chef-test/solo.json\n```\n\n```solo.json\n{\n  \"run_list\" : [\n    \"recipe[basic::install]\"\n  ]\n}\n```\n\n\n```bash\n$ cd /opt/chef-test\n$ sudo chef-solo -c solo.rb -j solo.json\n[2016-09-13T02:03:21+00:00] INFO: Started chef-zero at chefzero://localhost:8889 with repository at /opt/chef-test\n  One version per cookbook\n\n[2016-09-13T02:03:21+00:00] INFO: Forking chef instance to converge...\n[2016-09-13T02:03:21+00:00] INFO: *** Chef 12.13.37 ***\n[2016-09-13T02:03:21+00:00] INFO: Platform: x86_64-linux\n[2016-09-13T02:03:21+00:00] INFO: Chef-client pid: 26603\n[2016-09-13T02:03:23+00:00] INFO: HTTP Request Returned 404 Not Found: Object not found: chefzero://localhost:8889/nodes/test1.localdomain\n[2016-09-13T02:03:23+00:00] INFO: Setting the run_list to [\"recipe[basic::install]\"] from CLI options\n[2016-09-13T02:03:23+00:00] INFO: Run List is [recipe[basic::install]]\n[2016-09-13T02:03:23+00:00] INFO: Run List expands to [basic::install]\n[2016-09-13T02:03:23+00:00] INFO: Starting Chef Run for test1.localdomain\n[2016-09-13T02:03:23+00:00] INFO: Running start handlers\n[2016-09-13T02:03:23+00:00] INFO: Start handlers complete.\n[2016-09-13T02:03:23+00:00] INFO: HTTP Request Returned 404 Not Found: Object not found:\n[2016-09-13T02:03:23+00:00] WARN: Cookbook 'local-mode-cache' is empty or entirely chefignored at /home/ec2-user/local-mode-cache\n[2016-09-13T02:03:23+00:00] INFO: Loading cookbooks [basic@0.1.0]\n[2016-09-13T02:03:23+00:00] INFO: Storing updated cookbooks/basic/CHANGELOG.md in the cache.\n[2016-09-13T02:03:23+00:00] INFO: Storing updated cookbooks/basic/metadata.rb in the cache.\n[2016-09-13T02:03:23+00:00] INFO: Storing updated cookbooks/basic/recipes/install.rb in the cache.\n[2016-09-13T02:03:23+00:00] INFO: Storing updated cookbooks/basic/recipes/default.rb in the cache.\n[2016-09-13T02:03:23+00:00] INFO: Storing updated cookbooks/basic/README.md in the cache.\n[2016-09-13T02:03:23+00:00] INFO: Processing yum_package[vim-enhanced] action install (basic::install line 1)\n[2016-09-13T02:03:24+00:00] INFO: Processing yum_package[php] action install (basic::install line 6)\n[2016-09-13T02:03:24+00:00] INFO: Processing yum_package[mysql-server] action install (basic::install line 6)\n[2016-09-13T02:03:24+00:00] INFO: Processing yum_package[httpd] action install (basic::install line 6)\n[2016-09-13T02:03:24+00:00] INFO: Processing service[httpd] action start (basic::install line 11)\n[2016-09-13T02:03:24+00:00] INFO: Processing service[httpd] action enable (basic::install line 11)\n[2016-09-13T02:03:24+00:00] INFO: Chef Run complete in 1.189445961 seconds\n[2016-09-13T02:03:24+00:00] INFO: Running report handlers\n[2016-09-13T02:03:24+00:00] INFO: Report handlers complete\n```\n\n[](\nsolo.json\u3067\u306eRecipe\u306e\u6307\u5b9a\u540d\u304c\u9593\u9055\u3063\u3066\u3044\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u00a5\n\u00a5\n```bash\u00a5\n================================================================================\u00a5\nError Resolving Cookbooks for Run List:\u00a5\n================================================================================\u00a5\n\u00a5\nMissing Cookbooks:\u00a5\n------------------\u00a5\nNo such cookbook: apache:install\u00a5\n\u00a5\nExpanded Run List:\u00a5\n------------------\u00a5\n* apache:install\u00a5\n\u00a5\nPlatform:\u00a5\n---------\u00a5\nx86_64-linux\u00a5\n```\u00a5\n)\n\n##\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u53d6\u308a\u8fbc\u307f\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u53d6\u308a\u8fbc\u307f\u65b9\u306b\u3064\u3044\u3066\u3001```template```\u3068```cookbook_file```\u306e\u305d\u308c\u305e\u308c\u306b\u3088\u308b\u65b9\u6cd5\u3092\u53d6\u308a\u4e0a\u3052\u308b\u3002\u4e21\u8005\u306e\u9055\u3044\u306f\u3001```template```\u304c\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u3092\u5bfe\u8c61\u3068\u3057\u3066\u3044\u308b\u306e\u306b\u5bfe\u3057\u3066\u3001```cookbook_file```\u306f```.erb```\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u307f\u53ef\u80fd\u3067\u52d5\u7684\u306a\u8a2d\u5b9a\u304c\u53ef\u80fd\u3067\u3042\u308b\u3002\n\n\n###\u4e88\u3081\u7528\u610f\u3057\u3066\u304a\u3044\u305fhttpd.conf\u3092\u7528\u3044\u308b\u5834\u5408 by template\n\u7528\u610f\u3057\u305f```httpd.conf```\u3092```http.conf.erb```\u3068\u3057\u3066\u304a\u304d\u3001templates/default\u4ee5\u4e0b\u306b\u7f6e\u304f\u3002\u307e\u305f\u3001recipe\u30d5\u30a1\u30a4\u30eb\u4e2d\u306e\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3067httpd\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304b\u3089\u3001\u8aad\u307f\u8fbc\u3080\u5ba3\u8a00\u306e\u524d\u306btemplate\u3092\u7528\u3044\u3066\u3001\u4ee5\u4e0b\u3092\u8ffd\u8a18\u3059\u308b\u3002\n\n```\ntemplate '/etc/httpd/conf/httpd.conf' do\n  source 'httpd.conf.erb'\n  action :create\nend\n```\n\n###PHP\u306e\u5404\u7a2e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066php.ini\u306e\u5185\u5bb9\u3092Web\u30b5\u30fc\u30d0\u306b\u53cd\u6620 by cookbook_file\nhttpd\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u5f8c\u306b\u4ee5\u4e0b\u3092recipe\u30d5\u30a1\u30a4\u30eb\u4e2d\u306e\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u306b\u5b9a\u7fa9\u3059\u308b\u3002\n\n```rb\n\u2028%w[php php-devel php-mbstring gd-devel php-gd php-mysql].each do |pkg|\n        yum_package pkg do\n          action :install\n        end\nend\n\ncookbook_file \"/etc/php.ini\" do\n  mode 0644\n  notifies :reload, 'service[httpd]'\nend\n```\n\n\n#\u53c2\u8003\n\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\nhttps://aws.amazon.com/jp/opsworks/\nAWS OpsWorks\u3067\u30ab\u30b9\u30bf\u30e0Chef\u30ec\u30b7\u30d4\u3092\u5b9f\u884c\u3092\u3059\u308b\u65b9\u6cd5\nhttp://aws.typepad.com/sajp/2014/05/opsworks-custom-recipe.html\nChef\u3067\u30b5\u30fc\u30d0\u3092\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5 \u5165\u9580\u7de8 [httpd,php,mysql\u3092\u4e00\u767a\u3067\u5165\u308c\u308b]\nhttp://tkoyama1988.hatenablog.com/entry/2015/01/05/144656\nChef\u30ec\u30b7\u30d4\u9006\u5f15\u304d\u30e1\u30e2\nhttp://qiita.com/makoto_kw/items/53a84380559c087eb8fb\n", "tags": ["opsworks", "chef", "chef-solo", "AWS", "EC2"]}