{"context": "\n\n\u76ee\u7684\u3068\u30b4\u30fc\u30eb\n\nTomcat\u3092\u5229\u7528\u3057\u305f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u3002\nWindows\u74b0\u5883\u306eTomcat(8\u7cfb)\u3092\u4f7f\u3044\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u3092\u884c\u3046\u3002\n\n\n\u8a8d\u8a3c\u5f8c\u306e\u30a2\u30af\u30bb\u30b9\u5236\u5fa1\u307e\u3067\u306f\u884c\u308f\u306a\u3044\n\n\n\n\n\u5fc5\u8981\u306a\u4f5c\u696d\n\n\u5165\u624b\uff06\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3082\u306e\n\n\nJDK8 ( keytools\u3092\u5229\u7528 )\nTomcat8 ( 8.0.20 )\nOpenSSL\u306eWindows\u30d0\u30a4\u30ca\u30ea ( 1.0.2a )\n\n\n\u69cb\u7bc9\u4f5c\u696d\n\n\nOpenSSL\u306e\u8a2d\u5b9a\u3092\u9069\u7528\u3059\u308b\nOpenSSL\u306b\u3066\u691c\u8a3c\u7528\u306e\u8a8d\u8a3c\u5c40(\u30eb\u30fc\u30c8CA)\u3092\u305f\u3066\u308b\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u306e\u4e00\u5f0f\u751f\u6210\n\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u306e\u4e00\u5f0f\u4f5c\u6210\nTomcat\u306b\u5bfe\u3057\u3066\u30ad\u30fc\u30b9\u30c8\u30a2\u3092\u6709\u52b9\u306b\u3059\u308b\n\n\n\u691c\u8a3c\u74b0\u5883\n\n\npleiades All in one Eclipse 4.4.2 SR1 64bit JRE\u30d0\u30f3\u30c9\u30eb\u3042\u308a\nTomcat\u306e\u8a2d\u5b9a\u3084\u5b9f\u884c\u306f Eclipse WTP\u304b\u3089\u5b9f\u65bd\u3002\n\n\n\n\n\u672c\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u767b\u5834\u3059\u308b\u5358\u8a9e\n\n\n\n\u7528\u8a9e(\u548c\u540d)\n\u7528\u8a9e(\u82f1\u8a9e)\n\u5bfe\u8c61\u6280\u8853\n\u6982\u8981\n\n\n\n\n\u30ad\u30fc\u30b9\u30c8\u30a2\nkeystore\nJava Keytool\n\u6697\u53f7\u3067\u6271\u3046\u30d5\u30a1\u30a4\u30eb\u3092\u683c\u7d0d\u3002\u4eca\u56de\u306f\u516c\u958b\u9375\u6697\u53f7\u65b9\u5f0f\u306e\u4e00\u5f0f\u3092\u6271\u3044\u3001Tomcat8\u306b\u3053\u308c\u3089\u3092\u8aad\u307e\u305b\u308b\u3002\n\n\n\u8a8d\u8a3c\u5c40\nCA\nPKI\n\u516c\u958b\u9375\u6697\u53f7\u3067\u6271\u3046\u9375\u306e\u59a5\u5f53\u6027\u3092\u691c\u8a3c\u3059\u308b\u3002\u8a8d\u8a3c\u5c40\u306f\u8907\u6570\u306e\u968e\u5c64\u3092\u6301\u3064\u3053\u3068\u304c\u53ef\u80fd\u3067\u3001\u968e\u5c64\u306e\u9802\u70b9\u3092\u30eb\u30fc\u30c8CA\u3068\u547c\u3076\u3002\n\n\n\u8a3c\u660e\u66f8\u767a\u884c\u8981\u6c42\nCSR\nPKI\n\u8a3c\u660e\u66f8\u3092\u5229\u7528\u3059\u308b\u5074\u304c\u3001\u8a8d\u8a3c\u5c40\u306b\u8a3c\u660e\u66f8\u306e\u767a\u884c\u3092\u8981\u6c42\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u306a\u5185\u5bb9\u3092\u8a18\u3057\u305f\u30d5\u30a1\u30a4\u30eb\n\n\n\u516c\u958b\u9375\nPublicKey\nPKI\n\u79d8\u5bc6\u9375\u306b\u3088\u3063\u3066\u6697\u53f7\u5316\u3055\u308c\u305f\u3082\u306e\u3092\u5fa9\u53f7\u3059\u308b\u305f\u3081\u306e\u9375\u3067\u3001\u8a8d\u8a3c\u5c40\u304b\u3089\u767a\u884c\u3055\u308c\u305f\u8a3c\u660e\u66f8\u306e\u69cb\u6210\u8981\u7d20\u306e1\u3064\u3002\n\n\n\u79d8\u5bc6\u9375\nPrivateKey\nPKI\n\u6697\u53f7\u5316\u3059\u308b\u305f\u3081\u306e\u9375\u3002\u516c\u958b\u9375\u3068\u306f\u7570\u306a\u308a\u79d8\u5bc6\u9375\u306f\u7d76\u5bfe\u306b\u516c\u958b\u3057\u3066\u306f\u3044\u3051\u306a\u3044\u3002\n\n\n\u8a3c\u660e\u66f8\ncertification\nPKI\nCA\u306e\u7f72\u540d\u304c\u3064\u3044\u305f\u516c\u958b\u9375\u3002\n\n\n\u7f72\u540d\nsignature\nPKI\n\u8a3c\u660e\u66f8\u306e\u59a5\u5f53\u6027\u691c\u8a3c\u306b\u5229\u7528\u3002\u7f72\u540d\u306b\u306fSHA-256\u306a\u3069\u306e\u30cf\u30c3\u30b7\u30e5\u95a2\u6570\u3092\u7528\u3044\u308b\u3002\u96fb\u5b50\u7f72\u540d\u306e\u7565\u3067\u3001CA\u304c\u8a3c\u660e\u66f8\u306b\u5bfe\u3057\u3066\u7f72\u540d\u3092\u4ed8\u4e0e\u3059\u308b\u3002\n\n\n\u8a3c\u660e\u66f8\u5931\u52b9\u30ea\u30b9\u30c8\nCRL\nPKI\nCA\u306b\u3088\u308a\u7121\u52b9\u5316\u3057\u305f\u8a3c\u660e\u66f8\u306e\u30ea\u30b9\u30c8\u3002CRL\u3082\u96fb\u5b50\u8a3c\u660e\u66f8\u3068\u540c\u69d8\u3001CA\u306e\u7f72\u540d\u304c\u4ed8\u4e0e\u3055\u308c\u3066\u3044\u308b\u3002\u5931\u52b9\u30ea\u30b9\u30c8\u304c\u306a\u304f\u3066\u3082\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u306f\u52d5\u4f5c\u3059\u308b\u304c\u3001\u5931\u52b9\u30ea\u30b9\u30c8\u306b\u306f\u4f55\u3089\u304b\u306e\u7406\u7531\u3067\u7121\u52b9\u5316\u3057\u305f\u8a3c\u660e\u66f8\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u6b63\u5f0f\u904b\u7528\u6642\u306b\u306f\u4e0d\u53ef\u6b20\u3067\u3042\u308b\u3002\n\n\n\u9375\u30da\u30a2\nkeypair\nPKI\n\u516c\u958b\u9375\u6697\u53f7\u65b9\u5f0f\u306b\u304a\u3051\u308b\u79d8\u5bc6\u9375\u3068\u516c\u958b\u9375\u306e\u30da\u30a2\u306e\u3053\u3068\u3002\n\n\n\n\nOpenSSL\u306e\u8a2d\u5b9a\nOpenSSL\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u5fc5\u9808\u3068\u306a\u308a\u307e\u3059\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u3067\u3082\u52d5\u4f5c\u3057\u307e\u3059\u304c\u3001\u4eca\u56de\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f https://gist.github.com/A-pZ/4b79b9a47829da076bbb \u306b\u3066\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002\u5185\u5bb9\u306f\u307b\u307c\u30c7\u30d5\u30a9\u30eb\u30c8\u3068\u540c\u3058\u3067\u3059\u304c\u3001\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30ab\u30ec\u30f3\u30c8\u306b\u3057\u3066\u3044\u308b\u3053\u3068\u3068\u3001\u8a3c\u660e\u66f8\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u5c11\u3057\u3086\u308b\u304f\u3057\u3066\u3044\u307e\u3059\uff08\u5fc5\u9808\u6761\u4ef6\u306f\u3001\u767a\u884c\u8005\u304c\u540c\u3058\u3067\u3042\u308b\u3053\u3068\uff09\n\u3055\u3089\u306bopenssl\u306e\u5c55\u958b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3066\u3001\u4ee5\u4e0b\u306e\u8ffd\u52a0\u4f5c\u696d\u304c\u5fc5\u8981\u3067\u3059\u3002\n\nindex.txt \u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3001\u30c6\u30ad\u30b9\u30c8\u306e\u4e2d\u306f00\u306e\u307f\u8a18\u5165\u3059\u308b\ncrlnumber \u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3001\u30c6\u30ad\u30b9\u30c8\u306e\u4e2d\u306f00\u306e\u307f\u8a18\u5165\u3059\u308b\nserial(\u62e1\u5f35\u5b50\u306a\u3057)\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3001\u4e2d\u8eab\u306f\u7a7a\u3068\u3059\u308b\nnewcerts\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\ncrl\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\n\n\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u969b\u306b\u306f \u5fc5\u305aBOM\u306a\u3057UTF-8\u3067 \u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u4ee5\u4e0a\u306e\u4f5c\u696d\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001\u6e96\u5099\u5b8c\u4e86\u3067\u3059\u3002\n\nCA\u306e\u69cb\u7bc9\n\u7ba1\u7406\u8005\u6a29\u9650\u3067\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u958b\u304d\u3001OpenSSL\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u79fb\u52d5\u3057\u3066openssl\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\ncmd.exe\nC:\\Windows\\system32>cd C:\\openssl-1.0.2a-x64_86-win64\n\nC:\\openssl-1.0.2a-x64_86-win64>openssl\nOpenSSL>\n\n\n\nCA\u306e\u79d8\u5bc6\u9375\u3092\u751f\u6210\u3059\u308b\n\nopenssl.exe\nOpenSSL> genrsa -out ca.key 2048 -config openssl.cfg\nLoading 'screen' into random state - done\nGenerating RSA private key, 2048 bit long modulus\n..........................................................................................................................................+++\n..+++\ne is 65537 (0x10001)\n\n\n\u3053\u308c\u3067CA\u306e\u79d8\u5bc6\u9375\u304c ca.key \u306e\u540d\u524d\u3067\u751f\u6210\u3055\u308c\u307e\u3059\u3002\u5f8c\u308d\u306e\u6570\u5b57\u306f\u9375\u9577\u3067\u3001\u30d3\u30c3\u30c8\u6570\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n\u9375\u9577\u306f\u9577\u3044\u307b\u3069\u5805\u7262\u3067\u3059\u304c\u3001\u9577\u3055\u306b\u6bd4\u4f8b\u3057\u3066\u6697\u53f7/\u5fa9\u53f7\u306e\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u3002\u4eca\u56de\u306f2015\u5e74\u6642\u70b9\u3067\u4e00\u822c\u7684\u306b\u4f7f\u308f\u308c\u308b2048\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n\nCA\u306e\u8a3c\u660e\u66f8\u3092\u4f5c\u6210\u3059\u308b\u3002\n\u8a3c\u660e\u66f8\u306e\u4f5c\u6210\u624b\u9806\u306f\u3001\u4ee5\u4e0b\u306e\u9806\u3067\u884c\u3044\u307e\u3059\n\n\u8a3c\u660e\u66f8\u767a\u884c\u8981\u6c42(CSR)\u3092\u4f5c\u6210\u3059\u308b\nCA\u306f\u3001\u53d7\u3051\u53d6\u3063\u305fCSR\u304b\u3089\u8a3c\u660e\u66f8\u3092\u4f5c\u6210\u3059\u308b(=CA\u306e\u7f72\u540d\u3092\u3064\u3051\u308b)\n\u8a3c\u660e\u66f8\u3092\u8981\u6c42\u8005\u306b\u8fd4\u3059\n\nCA\u81ea\u8eab\u306e\u8a3c\u660e\u66f8\u306fCA\u304c\u81ea\u3089\u7f72\u540d\u3057\u307e\u3059\u3002\u3053\u308c\u3092 \u81ea\u5df1\u7f72\u540d\u8a3c\u660e\u66f8 \u3068\u547c\u3073\u307e\u3059\u3002\n\u3067\u306fCSR\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nopenssl.exe\nOpenSSL> req -new -key ca.key -out ca.csr -config openssl.cfg\nLoading 'screen' into random state - done\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [AU]:JP\nState or Province Name (full name) [Some-State]:Tokyo\nLocality Name (eg, city) []:Shinagawa\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:Capybara-Local\nOrganizational Unit Name (eg, section) []:Section1\nCommon Name (e.g. server FQDN or YOUR name) []:a-pz.jp\nEmail Address []:ca@a-pz.jp\n\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:password\nAn optional company name []:capy\n\n\n\u3053\u308c\u3067\u3001CA\u306e\u8a3c\u660e\u66f8\u767a\u884c\u8981\u6c42 ca.csr\u304c\u3067\u304d\u307e\u3057\u305f\u3002\u6b21\u306b\u8a3c\u660e\u66f8\u3092\u4f5c\u308a\u307e\u3059\u3002\n\nopenssl.exe\nOpenSSL> x509 -req -in ca.csr -signkey ca.key -out ca.crt\nLoading 'screen' into random state - done\nSignature ok\nsubject=/C=JP/ST=Tokyo/L=Shinagawa/O=Capybara-Local/OU=Section1/CN=a-pz.jp/emailAddress=ca@a-pz.jp\nGetting Private key\n\n\n\u3053\u308c\u3067\u3001ca.crt\u306e\u540d\u524d\u3067\u3001\u81ea\u5df1\u7f72\u540d\u306eCA\u8a3c\u660e\u66f8\u304c\u5b8c\u6210\u3057\u307e\u3057\u305f\u3002\u30d6\u30e9\u30a6\u30b6\u3067\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u306e\u3067\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u8a3c\u660e\u66f8\u304c\u898b\u308c\u308b\uff1d\u6b63\u3057\u304f\u767a\u884c\u3067\u304d\u307e\u3057\u305f\u3001\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002\n\n\u3057\u304b\u3057\u3053\u306eCA\u306e\u8a3c\u660e\u66f8\u306f\u767a\u884c\u3057\u305f\u3060\u3051\u3067\u3001\u7279\u306bPC\u3078\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u308b\u308f\u3051\u3067\u306f\u306a\u3044\u305f\u3081\u300c\u3053\u306eCA\u8a3c\u660e\u66f8\u306f\u4fe1\u983c\u3067\u304d\u307e\u305b\u3093\u3088\u300d\u3068\u8b66\u544a\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\nCA\u306b\u95a2\u3059\u308b\u4f5c\u696d\u306f\u3053\u3053\u307e\u3067\u3067\u3059\u3002\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u306e\u767a\u884c\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u306e\u767a\u884c\u624b\u9806\u306f\u3001CA\u306e\u8a3c\u660e\u66f8\u306e\u767a\u884c\u624b\u9806\u3068\u540c\u3058\u6d41\u308c\u3067\u3059\u3002\n\n\u79d8\u5bc6\u9375\u4f5c\u6210\nCSR\u4f5c\u6210\nCA\u304c\u7f72\u540d\u3057\u3066\u8a3c\u660e\u66f8\u3092\u767a\u884c\u3059\u308b\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u308bP12\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\n\n\n\u79d8\u5bc6\u9375\u306e\u4f5c\u6210\n\nopenssl.exe\nOpenSSL> genrsa -out client.key 2048 -config openssl.cfg\nLoading 'screen' into random state - done\nGenerating RSA private key, 2048 bit long modulus\n.......................................+++\n........................................................+++\ne is 65537 (0x10001)\nOpenSSL>\n\n\nclient.key\u304c\u751f\u6210\u3055\u308c\u307e\u3057\u305f\u3002\n\nCSR\u306e\u4f5c\u6210\n\u8a3c\u660e\u66f8\u767a\u884c\u8981\u6c42\u3092\u4f5c\u308a\u307e\u3059\u3002\nOpenSSL\u304b\u3089\u4ee5\u4e0b\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\nopenssl.exe\nOpenSSL> req -new -key client.key -out client.csr -config openssl.cfg\nLoading 'screen' into random state - done\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [AU]:JP\nState or Province Name (full name) [Some-State]:Tokyo\nLocality Name (eg, city) []:Shinagawa\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:Capybara-Private\nOrganizational Unit Name (eg, section) []:Private\nCommon Name (e.g. server FQDN or YOUR name) []:A-pZ\nEmail Address []:a-pz@a-pz.jp\n\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:password\nAn optional company name []:localtest\n\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u306e\u767a\u884c\nCSR\u304c\u3067\u304d\u305f\u3089\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u3092CA\u304b\u3089\u767a\u884c\u3057\u307e\u3059\u3002\n\nopenssl.exe\nOpenSSL> ca -config openssl.cfg -out client.crt -infiles client.csr\nUsing configuration from openssl.cfg\nLoading 'screen' into random state - done\nCheck that the request matches the signature\nSignature ok\nCertificate Details:\n        Serial Number: 1 (0x1)\n        Validity\n            Not Before: Jun 15 08:09:51 2015 GMT\n            Not After : Jun 14 08:09:51 2016 GMT\n        Subject:\n            countryName               = JP\n            stateOrProvinceName       = Tokyo\n            organizationName          = Capybara-Private\n            organizationalUnitName    = Private\n            commonName                = A-pZ\n            emailAddress              = a-pz@a-pz.jp\n        X509v3 extensions:\n            X509v3 Basic Constraints:\n                CA:FALSE\n            Netscape Comment:\n                OpenSSL Generated Certificate\n            X509v3 Subject Key Identifier:\n                CF:13:D1:41:DC:21:D1:05:26:4E:94:C9:9A:51:8A:93:AB:10:65:0E\n            X509v3 Authority Key Identifier:\n                DirName:/C=JP/ST=Tokyo/L=Shinagawa/O=Capybara-Local/OU=Section1/CN=a-pz.jp/emailAddress=ca@a-pz.jp\n                serial:AC:38:88:67:35:14:17:2F\n\nCertificate is to be certified until Jun 14 08:09:51 2016 GMT (365 days)\nSign the certificate? [y/n]:y\n\n\n1 out of 1 certificate requests certified, commit? [y/n]y\nWrite out database with 1 new entries\nData Base Updated\n\n\n\u3053\u308c\u3067\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8 client.crt\u304c\u751f\u6210\u3055\u308c\u3001\u9375\u306e\u30da\u30a2\u304c\u3067\u304d\u307e\u3057\u305f\uff01\n\nP12\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308b\nP12\u30d5\u30a1\u30a4\u30eb\u306f\u96fb\u5b50\u8a3c\u660e\u66f8\u306e\u9375\u30da\u30a2\u304c\u30bb\u30c3\u30c8\u306b\u306a\u3063\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u308b\u5f62\u5f0f\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002Windows\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5834\u5408\u306f\u3001\u3053\u306ep12\u5f62\u5f0f\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30d6\u30eb\u30af\u30ea\u30c3\u30af\u3059\u308b\u3060\u3051\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u304c\u8d77\u52d5\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u306fP12\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\u307e\u3067\u3092\u76ee\u6a19\u3068\u3057\u307e\u3059\u3002\n\n\u6b63\u5f0f\u306f PKCS#12 \u5f62\u5f0f\u3067\u3059\u304c\u3001\u62e1\u5f35\u5b50\u30923\u6587\u5b57\u306b\u3059\u308b\u6163\u4f8b\u304b\u3089 p12\u30d5\u30a1\u30a4\u30eb\u3068\u547c\u3076\u65b9\u305f\u3061\u3082\u3044\u307e\u3059\u3002\n\nOpenSSL\u3092\u4f7f\u3044\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u3068\u79d8\u5bc6\u9375\u304b\u3089P12\u30d5\u30a1\u30a4\u30eb\u3092\u751f\u6210\u3057\u307e\u3059\u3002\n\nopenssl.exe\nOpenSSL> pkcs12 -export -in client.crt -inkey client.key -out client.p12 -name tomcat -CAfile ca.crt -caname root -chain\nLoading 'screen' into random state - done\nEnter Export Password:\nVerifying - Enter Export Password:\n\n\n\n\u6210\u529f\u3059\u308b\u3068\u3001client.p12\u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n\nkeystore(\u30ad\u30fc\u30b9\u30c8\u30a2)\u306b\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u3092\u4f5c\u6210\u3059\u308b\n\u5fc5\u8981\u306a\u4f5c\u696d\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3067\u3059\u3002\n\n\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u306e\u9375\u30da\u30a2\u4f5c\u6210\n\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u4f5c\u6210\n\n\n\u30b5\u30fc\u30d0\u306e\u9375\u30da\u30a2\u306e\u4f5c\u6210 \u3068 \u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u4f5c\u6210\nTomcat\u7528\u306e\u9375\u30da\u30a2\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u4f5c\u6210\u306fKeytool\u304b\u3089\u884c\u3044\u307e\u3059\u3002\u307e\u305f\u3001\u9375\u3092\u4fdd\u7ba1\u3059\u308b\u5834\u6240\uff08\u30d5\u30a1\u30a4\u30eb\uff09\u3092\u30ad\u30fc\u30b9\u30c8\u30a2\u3068\u547c\u3073\u307e\u3059\u304c\u3001Tomcat\u306b\u8aad\u307f\u8fbc\u307e\u305b\u308b\u30ad\u30fc\u30b9\u30c8\u30a2\u3082\u540c\u6642\u306b\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nkeytool\u306f\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u5b58\u5728\u3057\u306a\u3044\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u540d\u524d\u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u30ad\u30fc\u30b9\u30c8\u30a2\u3082\u65b0\u898f\u4f5c\u6210\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\n\u79d8\u5bc6\u9375\u306f keytool \u304b\u3089\u751f\u6210\u3057\u3001\u516c\u958b\u9375\u306fCA\u306e\u8a3c\u660e\u66f8\u3092\u4f5c\u6210\u3057\u305fOpenSSL\u304b\u3089\u751f\u6210\u3057\u307e\u3059\u3002\n\n\u79d8\u5bc6\u9375\u306e\u751f\u6210\nkeytool\u3092\u4f7f\u3044\u307e\u3059\u3002OpenSSL\u306e\u3068\u304d\u3068\u306f\u7570\u306a\u308a\u3001\u8a3c\u660e\u66f8\u306e\u60c5\u5831\u3092\u5165\u529b\u3059\u308b\u9806\u756a\u306f\u771f\u9006\u3067\u3059\u3002\n\u59d3\u540d\u306e\u90e8\u5206\u306f\u3001\u30b5\u30fc\u30d0\u306e\u30c9\u30e1\u30a4\u30f3\u3082\u3057\u304f\u306fIP\u30a2\u30c9\u30ec\u30b9\u306b\u3057\u3066\u304f\u3060\u3055\u3044\n\nkeytool.exe\nC:\\openssl-1.0.2a-x64_86-win64>keytool -genkey -alias tomcat -keyalg RSA -keystore tomcat.jks\n\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044:\n  \u59d3\u540d\u306f\u4f55\u3067\u3059\u304b\u3002\n    [Unknown]:  <\u30b5\u30fc\u30d0\u306e\u30c9\u30e1\u30a4\u30f3\u306a\u3044\u3057\u306fIP\u30a2\u30c9\u30ec\u30b9>\n  \u7d44\u7e54\u5358\u4f4d\u540d\u306f\u4f55\u3067\u3059\u304b\u3002\n    [Unknown]:  Capybara-Server\n  \u7d44\u7e54\u540d\u306f\u4f55\u3067\u3059\u304b\u3002\n    [Unknown]:  Capybara\n  \u90fd\u5e02\u540d\u307e\u305f\u306f\u5730\u57df\u540d\u306f\u4f55\u3067\u3059\u304b\u3002\n    [Unknown]:  Shinagawa\n  \u90fd\u9053\u5e9c\u770c\u540d\u307e\u305f\u306f\u5dde\u540d\u306f\u4f55\u3067\u3059\u304b\u3002\n    [Unknown]:  Tokyo\n  \u3053\u306e\u5358\u4f4d\u306b\u8a72\u5f53\u3059\u308b2\u6587\u5b57\u306e\u56fd\u30b3\u30fc\u30c9\u306f\u4f55\u3067\u3059\u304b\u3002\n    [Unknown]:  JP\nCN=A-pZ, OU=Capybara-Server, O=Capybara, L=Shinagawa, ST=Tokyo, C=JP\u3067\u3088\u308d\u3057\u3044\u3067\u3059\u304b\u3002\n\n\n<tomcat>\u306e\u9375\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\n        (\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3068\u540c\u3058\u5834\u5408\u306fRETURN\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044):[\u3053\u3053\u3067\u306fRETURN\u3068\u3059\u308b]\n\n\n\u3053\u308c\u3067\u30ad\u30fc\u30b9\u30c8\u30a2\u306b\u79d8\u5bc6\u9375\u304c\u751f\u6210\u3055\u308c\u307e\u3057\u305f\u3002\u30ad\u30fc\u30b9\u30c8\u30a2\u306b\u683c\u7d0d\u3057\u3066\u3044\u308b\u8a3c\u660e\u66f8\u3084\u9375\u306e\u4e00\u89a7\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u4e2d\u8eab\u4e00\u89a7\u3092\u898b\u308b\u306b\u306f\u3001\u540c\u3058\u304fkeytool\u3092\u4f7f\u3044\u307e\u3059\u3002\n\nkeytool.exe\nC:\\openssl-1.0.2a-x64_86-win64>keytool -list -keystore tomcat.jks\n\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044:\n\n\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u30bf\u30a4\u30d7: JKS\n\u30ad\u30fc\u30b9\u30c8\u30a2\u30fb\u30d7\u30ed\u30d0\u30a4\u30c0: SUN\n\n\u30ad\u30fc\u30b9\u30c8\u30a2\u306b\u306f1\u30a8\u30f3\u30c8\u30ea\u304c\u542b\u307e\u308c\u307e\u3059\n\ntomcat,2015/06/16, PrivateKeyEntry,\n\u8a3c\u660e\u66f8\u306e\u30d5\u30a3\u30f3\u30ac\u30d7\u30ea\u30f3\u30c8(SHA1): 30:21:E2:FA:0D:23:8A:DF:18:7A:5D:57:D3:11:D0:B0:23:3C:3B:82\n\n\ntomcat\u306e\u540d\u524d\u3067\u3001PrivateKeyEntry\u304c\u3042\u308a\u307e\u3059\u306d\u3002\n\n\u8a3c\u660e\u66f8\u767a\u884c\u8981\u6c42(CSR)\u3092\u51fa\u3059\nkeytool\u304b\u3089\u884c\u3044\u307e\u3059\u3002\u5148\u307b\u3069\u306e\u79d8\u5bc6\u9375\u751f\u6210\u306e\u3068\u304d\u306b\u5165\u529b\u3057\u305f\u60c5\u5831\u3092\u3082\u3068\u306bCSR\u3092\u767a\u884c\u3057\u307e\u3059\u3002\n\nkeytool.exe\nC:\\openssl-1.0.2a-x64_86-win64>keytool -certreq -alias tomcat -file tomcat.csr -keystore tomcat.jks \n\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044: [\u30d1\u30b9\u30ef\u30fc\u30c9]\n\n\n\u3053\u308c\u3067\u8a3c\u660e\u66f8\u767a\u884c\u8981\u6c42(CSR)\u3067\u3042\u308b tomcat.csr\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n\nCA\u304cCSR\u3092\u53d7\u3051\u3066\u7f72\u540d\u3057\u3001\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u3092\u751f\u6210\u3059\u308b\nCA\u306b\u3088\u308b\u7f72\u540d\u306fOpenSSL\u304c\u884c\u3044\u307e\u3059\u3002\n\nopenssl.exe\nOpenSSL> ca -config openssl.cfg -out tomcat.crt -infiles tomcat.csr\nUsing configuration from openssl.cfg\nLoading 'screen' into random state - done\nCheck that the request matches the signature\nSignature ok\nCertificate Details:\n        Serial Number: 2 (0x2)\n        Validity\n            Not Before: Jun 16 01:50:00 2015 GMT\n            Not After : Jun 15 01:50:00 2016 GMT\n        Subject:\n            countryName               = JP\n            stateOrProvinceName       = Tokyo\n            organizationName          = Capybara\n            organizationalUnitName    = Capybara-Server\n            commonName                = <\u30b5\u30fc\u30d0\u306e\u30c9\u30e1\u30a4\u30f3\u306a\u3044\u3057\u306fIP\u30a2\u30c9\u30ec\u30b9>\n        X509v3 extensions:\n            X509v3 Basic Constraints:\n                CA:FALSE\n            Netscape Comment:\n                OpenSSL Generated Certificate\n            X509v3 Subject Key Identifier:\n                76:81:19:AB:F2:D4:75:CF:1F:86:6D:75:BD:42:A5:49:EA:21:57:70\n            X509v3 Authority Key Identifier:\n                DirName:/C=JP/ST=Tokyo/L=Shinagawa/O=Capybara-Local/OU=Section1/CN=a-pz.jp/emailAddress=ca@a-pz.jp\n                serial:AC:38:88:67:35:14:17:2F\n\nCertificate is to be certified until Jun 15 01:50:00 2016 GMT (365 days)\nSign the certificate? [y/n]:y\n\n\n1 out of 1 certificate requests certified, commit? [y/n]y\nWrite out database with 1 new entries\nData Base Updated\n\n\n\u3053\u308c\u3067\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u304c tomcat.crt\u306e\u540d\u524d\u3067 \u3067\u304d\u307e\u3057\u305f\u3002\n\n\u30ad\u30fc\u30b9\u30c8\u30a2\u306b\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u3092\u30a4\u30f3\u30dd\u30fc\u30c8\u3059\u308b\n\u3067\u304d\u3042\u304c\u3063\u305f\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u3092\u3001\u30ad\u30fc\u30b9\u30c8\u30a2\u3078\u30a4\u30f3\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002\n\nkeytool.exe\nC:\\openssl-1.0.2a-x64_86-win64>keytool -import -alias tomcat -trustcacerts -file tomcat.crt -keystore tomcat.jks\n\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044:\n\u8a3c\u660e\u66f8\u5fdc\u7b54\u304c\u30ad\u30fc\u30b9\u30c8\u30a2\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3057\u305f\n\n\n\u9375\u30da\u30a2\u306a\u306e\u3067\u3001-alias\u306f \u79d8\u5bc6\u9375\u3068\u540c\u3058 tomcat \u306b\u5fc5\u305a\u3057\u307e\u3059\u3002\n\u7121\u4e8b\u5165\u3063\u305f\u3088\u3046\u3067\u3059\u306d\uff01\n\u4ee5\u4e0a\u3067\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u306e\u4f5c\u6210\u4f5c\u696d\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\nTomcat\u306b\u5bfe\u3057\u3066\u30ad\u30fc\u30b9\u30c8\u30a2\u3092\u6709\u52b9\u306b\u3059\u308b\nTomcat\u7528\u306e\u9375\u30da\u30a2\u304c\u683c\u7d0d\u3057\u3066\u3042\u308b\u30ad\u30fc\u30b9\u30c8\u30a2 tomcat.jks \u3092\u3001Tomcat\u306b\u8aad\u307f\u8fbc\u307e\u305b\u307e\u3059\u3002\n\u8a2d\u5b9a\u306fTomcat\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea/conf/server.xml\u306b\u3066\u884c\u3044\u307e\u3059\u3002\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u76f4\u5f8c\u306e\u8a2d\u5b9a\u3067\u306f\u3001SSL\u306e\u8a2d\u5b9a\u306f\u30b3\u30e1\u30f3\u30c8\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002server.xml\u306e\u4e2d\u304b\u3089 Connector\u8981\u7d20\u3092\u63a2\u3057\u3001\u305d\u306e\u6b21\u306e\u884c\u306b\u4ee5\u4e0b\u306e\u5185\u5bb9\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nserver.xml(\u629c\u7c8b)\n<Connector  maxThreads=\"150\" port=\"8443\"\n            protocol=\"org.apache.coyote.http11.Http11NioProtocol\"\n            scheme=\"https\" secure=\"true\" sslProtocol=\"TLS\"\n            SSLEnabled=\"true\" disableUploadTimeout=\"true\"\n            acceptCount=\"100\" debug=\"0\"\n            keyAlias=\"tomcat\" clientAuth=\"true\"\n            keystorePass=\"password\" keystoreFile=\"./conf/tomcat.jks\" keystoreType=\"JKS\"\n            truststorePass=\"password\" truststoreFile=\"./conf/tomcat.jks\" truststoreType=\"JKS\"\n/>\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u7528\u306b\u8ffd\u52a0\u3057\u305f\u5c5e\u6027\u3092\u4ee5\u4e0b\u306b\u5217\u6319\u3057\u307e\u3059\u3002\n\n\n\n\u5c5e\u6027\u540d\n\u8aac\u660e\n\n\n\n\nclientAuth\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u306e\u6709\u7121\n\n\ntruststorePass\n\u8a3c\u660e\u66f8\u30c1\u30a7\u30fc\u30f3\u3092\u542b\u3081\u305f\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\n\n\ntruststoreFile\n\u8a3c\u660e\u66f8\u30c1\u30a7\u30fc\u30f3\u3092\u542b\u3081\u305f\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u30d5\u30a1\u30a4\u30eb\u540d\n\n\ntruststoreType\n\u8a3c\u660e\u66f8\u30c1\u30a7\u30fc\u30f3\u3092\u542b\u3081\u305f\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u30d5\u30a1\u30a4\u30eb\u5f62\u5f0f\n\n\n\n\n\u8a2d\u5b9a\u306e\u8a73\u7d30\u306b\u3064\u3044\u3066\u306f https://tomcat.apache.org/tomcat-8.0-doc/ssl-howto.html#Configuration \u3092\u53c2\u7167\u306b\u3002\n\n\u4ee5\u4e0a\u3067Tomcat\u3067HTTPS\u304c\u6709\u52b9\u306b\u306a\u308a\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u3082\u6709\u52b9\u306b\u306a\u308a\u307e\u3059\uff08\u6697\u53f7\u5316\u30d7\u30ed\u30c8\u30b3\u30eb\u306fTLS1.2\u304c\u9078\u3070\u308c\u307e\u3059)\n\nWeb\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u3092\u6709\u52b9\u306b\u3059\u308b\n\u30b5\u30fc\u30d0\u5074\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u3092\u6709\u52b9\u306b\u3057\u307e\u3057\u305f\u304c\u3001\u642d\u8f09\u3059\u308bWeb\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u3082\u8a2d\u5b9a\u304c\u5fc5\u8981\u3067\u3059\u3002\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\uff08\u8a3c\u660e\u66f8\u306e\u63d0\u793a\uff09\u306e\u307f\u884c\u3046\u306e\u304c\u4eca\u56de\u306e\u76ee\u7684\u3067\u3059\u306e\u3067\u3001\u8a2d\u5b9a\u306f\u975e\u5e38\u306b\u7c21\u7d20\u3067\u3059\u3002\nweb.xml\u306b\u6b21\u306e\u4e00\u5f0f\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\u305f\u3044\u3066\u3044\u306e\u5834\u5408\u306f\u6700\u4e0b\u90e8\u3067\u826f\u3044\u3067\u3059\u3002\n\nweb.xml\n<login-config>\n    <auth-method>CLIENT-CERT</auth-method>\n    <realm-name>[\u4efb\u610f\u306e\u82f1\u6570\u3067\u540d\u524d\u3092\u3064\u3051\u308b]</realm-name>\n</login-config>\n\n\n\u4ee5\u4e0a\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u3001Tomcat\u3092\u8d77\u52d5\u3057\u3066\u52d5\u4f5c\u78ba\u8a8d\u3092\u3057\u307e\u3059\u3002\nhttp://[\u30b5\u30fc\u30d0\u306e\u30c9\u30e1\u30a4\u30f3\u306a\u3044\u3057\u306fIP\u30a2\u30c9\u30ec\u30b9]:8443/ \u4ee5\u4e0b\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u6b21\u306e\u753b\u9762\u306b\u3042\u308b\u3088\u3046\u306b\u8a3c\u660e\u66f8\u9078\u629e\u306e\u30dd\u30c3\u30d7\u30a2\u30c3\u30d7\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\u6709\u52b9\u306a\u8a3c\u660e\u66f8\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308c\u3070\u3053\u306e\u753b\u9762\u306e\u3088\u3046\u306b\u8a3c\u660e\u66f8\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n\u9078\u629e\u5f8c\u3001OK\u3092\u62bc\u3057\u3066\u30ea\u30af\u30a8\u30b9\u30c8\u3057\u305fURL\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u5b8c\u4e86\u3067\u3059\u3002\n\u304a\u75b2\u308c\u69d8\u3067\u3057\u305f\uff01\n# \u76ee\u7684\u3068\u30b4\u30fc\u30eb\n\n* Tomcat\u3092\u5229\u7528\u3057\u305f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u3002\n* Windows\u74b0\u5883\u306eTomcat(8\u7cfb)\u3092\u4f7f\u3044\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u3092\u884c\u3046\u3002\n * \u8a8d\u8a3c\u5f8c\u306e\u30a2\u30af\u30bb\u30b9\u5236\u5fa1\u307e\u3067\u306f\u884c\u308f\u306a\u3044\n\n## \u5fc5\u8981\u306a\u4f5c\u696d\n\n- \u5165\u624b\uff06\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3082\u306e\n - JDK8 ( keytools\u3092\u5229\u7528 )\n - Tomcat8 ( 8.0.20 )\n - OpenSSL\u306eWindows\u30d0\u30a4\u30ca\u30ea ( 1.0.2a )\n- \u69cb\u7bc9\u4f5c\u696d\n - OpenSSL\u306e\u8a2d\u5b9a\u3092\u9069\u7528\u3059\u308b\n - OpenSSL\u306b\u3066\u691c\u8a3c\u7528\u306e\u8a8d\u8a3c\u5c40(\u30eb\u30fc\u30c8CA)\u3092\u305f\u3066\u308b\n - \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u306e\u4e00\u5f0f\u751f\u6210\n - \u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u306e\u4e00\u5f0f\u4f5c\u6210\n - Tomcat\u306b\u5bfe\u3057\u3066\u30ad\u30fc\u30b9\u30c8\u30a2\u3092\u6709\u52b9\u306b\u3059\u308b\n- \u691c\u8a3c\u74b0\u5883\n - pleiades All in one Eclipse 4.4.2 SR1 64bit JRE\u30d0\u30f3\u30c9\u30eb\u3042\u308a\n - Tomcat\u306e\u8a2d\u5b9a\u3084\u5b9f\u884c\u306f Eclipse WTP\u304b\u3089\u5b9f\u65bd\u3002\n\n## \u672c\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u767b\u5834\u3059\u308b\u5358\u8a9e\n\n|\u7528\u8a9e(\u548c\u540d)|\u7528\u8a9e(\u82f1\u8a9e)|\u5bfe\u8c61\u6280\u8853|\u6982\u8981|\n|:----|:--|:--|:--|\n|\u30ad\u30fc\u30b9\u30c8\u30a2|keystore|Java Keytool|\u6697\u53f7\u3067\u6271\u3046\u30d5\u30a1\u30a4\u30eb\u3092\u683c\u7d0d\u3002\u4eca\u56de\u306f\u516c\u958b\u9375\u6697\u53f7\u65b9\u5f0f\u306e\u4e00\u5f0f\u3092\u6271\u3044\u3001Tomcat8\u306b\u3053\u308c\u3089\u3092\u8aad\u307e\u305b\u308b\u3002|\n|\u8a8d\u8a3c\u5c40|CA|PKI|\u516c\u958b\u9375\u6697\u53f7\u3067\u6271\u3046\u9375\u306e\u59a5\u5f53\u6027\u3092\u691c\u8a3c\u3059\u308b\u3002\u8a8d\u8a3c\u5c40\u306f\u8907\u6570\u306e\u968e\u5c64\u3092\u6301\u3064\u3053\u3068\u304c\u53ef\u80fd\u3067\u3001\u968e\u5c64\u306e\u9802\u70b9\u3092\u30eb\u30fc\u30c8CA\u3068\u547c\u3076\u3002|\n|\u8a3c\u660e\u66f8\u767a\u884c\u8981\u6c42|CSR|PKI|\u8a3c\u660e\u66f8\u3092\u5229\u7528\u3059\u308b\u5074\u304c\u3001\u8a8d\u8a3c\u5c40\u306b\u8a3c\u660e\u66f8\u306e\u767a\u884c\u3092\u8981\u6c42\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u306a\u5185\u5bb9\u3092\u8a18\u3057\u305f\u30d5\u30a1\u30a4\u30eb|\n|\u516c\u958b\u9375|PublicKey|PKI|\u79d8\u5bc6\u9375\u306b\u3088\u3063\u3066\u6697\u53f7\u5316\u3055\u308c\u305f\u3082\u306e\u3092\u5fa9\u53f7\u3059\u308b\u305f\u3081\u306e\u9375\u3067\u3001\u8a8d\u8a3c\u5c40\u304b\u3089\u767a\u884c\u3055\u308c\u305f\u8a3c\u660e\u66f8\u306e\u69cb\u6210\u8981\u7d20\u306e1\u3064\u3002|\n|\u79d8\u5bc6\u9375|PrivateKey|PKI|\u6697\u53f7\u5316\u3059\u308b\u305f\u3081\u306e\u9375\u3002\u516c\u958b\u9375\u3068\u306f\u7570\u306a\u308a\u79d8\u5bc6\u9375\u306f\u7d76\u5bfe\u306b\u516c\u958b\u3057\u3066\u306f\u3044\u3051\u306a\u3044\u3002|\n|\u8a3c\u660e\u66f8|certification|PKI|CA\u306e\u7f72\u540d\u304c\u3064\u3044\u305f\u516c\u958b\u9375\u3002|\n|\u7f72\u540d|signature|PKI|\u8a3c\u660e\u66f8\u306e\u59a5\u5f53\u6027\u691c\u8a3c\u306b\u5229\u7528\u3002\u7f72\u540d\u306b\u306fSHA-256\u306a\u3069\u306e\u30cf\u30c3\u30b7\u30e5\u95a2\u6570\u3092\u7528\u3044\u308b\u3002\u96fb\u5b50\u7f72\u540d\u306e\u7565\u3067\u3001CA\u304c\u8a3c\u660e\u66f8\u306b\u5bfe\u3057\u3066\u7f72\u540d\u3092\u4ed8\u4e0e\u3059\u308b\u3002|\n|\u8a3c\u660e\u66f8\u5931\u52b9\u30ea\u30b9\u30c8|CRL|PKI|CA\u306b\u3088\u308a\u7121\u52b9\u5316\u3057\u305f\u8a3c\u660e\u66f8\u306e\u30ea\u30b9\u30c8\u3002CRL\u3082\u96fb\u5b50\u8a3c\u660e\u66f8\u3068\u540c\u69d8\u3001CA\u306e\u7f72\u540d\u304c\u4ed8\u4e0e\u3055\u308c\u3066\u3044\u308b\u3002\u5931\u52b9\u30ea\u30b9\u30c8\u304c\u306a\u304f\u3066\u3082\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u306f\u52d5\u4f5c\u3059\u308b\u304c\u3001\u5931\u52b9\u30ea\u30b9\u30c8\u306b\u306f\u4f55\u3089\u304b\u306e\u7406\u7531\u3067\u7121\u52b9\u5316\u3057\u305f\u8a3c\u660e\u66f8\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u6b63\u5f0f\u904b\u7528\u6642\u306b\u306f\u4e0d\u53ef\u6b20\u3067\u3042\u308b\u3002|\n|\u9375\u30da\u30a2|keypair|PKI|\u516c\u958b\u9375\u6697\u53f7\u65b9\u5f0f\u306b\u304a\u3051\u308b\u79d8\u5bc6\u9375\u3068\u516c\u958b\u9375\u306e\u30da\u30a2\u306e\u3053\u3068\u3002|\n\n## OpenSSL\u306e\u8a2d\u5b9a\n\nOpenSSL\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u5fc5\u9808\u3068\u306a\u308a\u307e\u3059\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u3067\u3082\u52d5\u4f5c\u3057\u307e\u3059\u304c\u3001\u4eca\u56de\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f https://gist.github.com/A-pZ/4b79b9a47829da076bbb \u306b\u3066\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002\u5185\u5bb9\u306f\u307b\u307c\u30c7\u30d5\u30a9\u30eb\u30c8\u3068\u540c\u3058\u3067\u3059\u304c\u3001\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30ab\u30ec\u30f3\u30c8\u306b\u3057\u3066\u3044\u308b\u3053\u3068\u3068\u3001\u8a3c\u660e\u66f8\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u5c11\u3057\u3086\u308b\u304f\u3057\u3066\u3044\u307e\u3059\uff08\u5fc5\u9808\u6761\u4ef6\u306f\u3001\u767a\u884c\u8005\u304c\u540c\u3058\u3067\u3042\u308b\u3053\u3068\uff09\n\n\u3055\u3089\u306bopenssl\u306e\u5c55\u958b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3066\u3001\u4ee5\u4e0b\u306e\u8ffd\u52a0\u4f5c\u696d\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n* index.txt \u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3001\u30c6\u30ad\u30b9\u30c8\u306e\u4e2d\u306f00\u306e\u307f\u8a18\u5165\u3059\u308b\n* crlnumber \u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3001\u30c6\u30ad\u30b9\u30c8\u306e\u4e2d\u306f00\u306e\u307f\u8a18\u5165\u3059\u308b\n* serial(\u62e1\u5f35\u5b50\u306a\u3057)\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3001\u4e2d\u8eab\u306f\u7a7a\u3068\u3059\u308b\n* newcerts\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\n* crl\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\n\n\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u969b\u306b\u306f **\u5fc5\u305aBOM\u306a\u3057UTF-8\u3067** \u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u4ee5\u4e0a\u306e\u4f5c\u696d\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001\u6e96\u5099\u5b8c\u4e86\u3067\u3059\u3002\n\n## CA\u306e\u69cb\u7bc9\n\n\u7ba1\u7406\u8005\u6a29\u9650\u3067\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u958b\u304d\u3001OpenSSL\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u79fb\u52d5\u3057\u3066openssl\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```cmd.exe\nC:\\Windows\\system32>cd C:\\openssl-1.0.2a-x64_86-win64\n\nC:\\openssl-1.0.2a-x64_86-win64>openssl\nOpenSSL>\n```\n\n### CA\u306e\u79d8\u5bc6\u9375\u3092\u751f\u6210\u3059\u308b\n\n```openssl.exe\nOpenSSL> genrsa -out ca.key 2048 -config openssl.cfg\nLoading 'screen' into random state - done\nGenerating RSA private key, 2048 bit long modulus\n..........................................................................................................................................+++\n..+++\ne is 65537 (0x10001)\n```\n\n\u3053\u308c\u3067CA\u306e\u79d8\u5bc6\u9375\u304c ca.key \u306e\u540d\u524d\u3067\u751f\u6210\u3055\u308c\u307e\u3059\u3002\u5f8c\u308d\u306e\u6570\u5b57\u306f\u9375\u9577\u3067\u3001\u30d3\u30c3\u30c8\u6570\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n> \u9375\u9577\u306f\u9577\u3044\u307b\u3069\u5805\u7262\u3067\u3059\u304c\u3001\u9577\u3055\u306b\u6bd4\u4f8b\u3057\u3066\u6697\u53f7/\u5fa9\u53f7\u306e\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u3002\u4eca\u56de\u306f2015\u5e74\u6642\u70b9\u3067\u4e00\u822c\u7684\u306b\u4f7f\u308f\u308c\u308b2048\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n### CA\u306e\u8a3c\u660e\u66f8\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n\u8a3c\u660e\u66f8\u306e\u4f5c\u6210\u624b\u9806\u306f\u3001\u4ee5\u4e0b\u306e\u9806\u3067\u884c\u3044\u307e\u3059\n\n1. \u8a3c\u660e\u66f8\u767a\u884c\u8981\u6c42(CSR)\u3092\u4f5c\u6210\u3059\u308b\n2. CA\u306f\u3001\u53d7\u3051\u53d6\u3063\u305fCSR\u304b\u3089\u8a3c\u660e\u66f8\u3092\u4f5c\u6210\u3059\u308b(=CA\u306e\u7f72\u540d\u3092\u3064\u3051\u308b)\n3. \u8a3c\u660e\u66f8\u3092\u8981\u6c42\u8005\u306b\u8fd4\u3059\n\nCA\u81ea\u8eab\u306e\u8a3c\u660e\u66f8\u306fCA\u304c\u81ea\u3089\u7f72\u540d\u3057\u307e\u3059\u3002\u3053\u308c\u3092 **\u81ea\u5df1\u7f72\u540d\u8a3c\u660e\u66f8** \u3068\u547c\u3073\u307e\u3059\u3002\n\n\u3067\u306fCSR\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```openssl.exe\nOpenSSL> req -new -key ca.key -out ca.csr -config openssl.cfg\nLoading 'screen' into random state - done\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [AU]:JP\nState or Province Name (full name) [Some-State]:Tokyo\nLocality Name (eg, city) []:Shinagawa\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:Capybara-Local\nOrganizational Unit Name (eg, section) []:Section1\nCommon Name (e.g. server FQDN or YOUR name) []:a-pz.jp\nEmail Address []:ca@a-pz.jp\n\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:password\nAn optional company name []:capy\n```\n\n\u3053\u308c\u3067\u3001CA\u306e\u8a3c\u660e\u66f8\u767a\u884c\u8981\u6c42 ca.csr\u304c\u3067\u304d\u307e\u3057\u305f\u3002\u6b21\u306b\u8a3c\u660e\u66f8\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n```openssl.exe\nOpenSSL> x509 -req -in ca.csr -signkey ca.key -out ca.crt\nLoading 'screen' into random state - done\nSignature ok\nsubject=/C=JP/ST=Tokyo/L=Shinagawa/O=Capybara-Local/OU=Section1/CN=a-pz.jp/emailAddress=ca@a-pz.jp\nGetting Private key\n```\n\n\u3053\u308c\u3067\u3001ca.crt\u306e\u540d\u524d\u3067\u3001\u81ea\u5df1\u7f72\u540d\u306eCA\u8a3c\u660e\u66f8\u304c\u5b8c\u6210\u3057\u307e\u3057\u305f\u3002\u30d6\u30e9\u30a6\u30b6\u3067\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u306e\u3067\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n![rootca.png](https://qiita-image-store.s3.amazonaws.com/0/13268/e27f5e5b-3acc-4056-0b0c-a77ee8eaf8fd.png)\n\n\u8a3c\u660e\u66f8\u304c\u898b\u308c\u308b\uff1d\u6b63\u3057\u304f\u767a\u884c\u3067\u304d\u307e\u3057\u305f\u3001\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002\n> \u3057\u304b\u3057\u3053\u306eCA\u306e\u8a3c\u660e\u66f8\u306f\u767a\u884c\u3057\u305f\u3060\u3051\u3067\u3001\u7279\u306bPC\u3078\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u308b\u308f\u3051\u3067\u306f\u306a\u3044\u305f\u3081\u300c\u3053\u306eCA\u8a3c\u660e\u66f8\u306f\u4fe1\u983c\u3067\u304d\u307e\u305b\u3093\u3088\u300d\u3068\u8b66\u544a\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\nCA\u306b\u95a2\u3059\u308b\u4f5c\u696d\u306f\u3053\u3053\u307e\u3067\u3067\u3059\u3002\n\n## \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u306e\u767a\u884c\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u306e\u767a\u884c\u624b\u9806\u306f\u3001CA\u306e\u8a3c\u660e\u66f8\u306e\u767a\u884c\u624b\u9806\u3068\u540c\u3058\u6d41\u308c\u3067\u3059\u3002\n\n1. \u79d8\u5bc6\u9375\u4f5c\u6210\n2. CSR\u4f5c\u6210\n3. CA\u304c\u7f72\u540d\u3057\u3066\u8a3c\u660e\u66f8\u3092\u767a\u884c\u3059\u308b\n4. \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u308bP12\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\n\n### \u79d8\u5bc6\u9375\u306e\u4f5c\u6210\n\n```openssl.exe\nOpenSSL> genrsa -out client.key 2048 -config openssl.cfg\nLoading 'screen' into random state - done\nGenerating RSA private key, 2048 bit long modulus\n.......................................+++\n........................................................+++\ne is 65537 (0x10001)\nOpenSSL>\n```\n\nclient.key\u304c\u751f\u6210\u3055\u308c\u307e\u3057\u305f\u3002\n\n### CSR\u306e\u4f5c\u6210\n\n\u8a3c\u660e\u66f8\u767a\u884c\u8981\u6c42\u3092\u4f5c\u308a\u307e\u3059\u3002\n\nOpenSSL\u304b\u3089\u4ee5\u4e0b\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\n```openssl.exe\nOpenSSL> req -new -key client.key -out client.csr -config openssl.cfg\nLoading 'screen' into random state - done\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [AU]:JP\nState or Province Name (full name) [Some-State]:Tokyo\nLocality Name (eg, city) []:Shinagawa\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:Capybara-Private\nOrganizational Unit Name (eg, section) []:Private\nCommon Name (e.g. server FQDN or YOUR name) []:A-pZ\nEmail Address []:a-pz@a-pz.jp\n\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:password\nAn optional company name []:localtest\n```\n\n### \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u306e\u767a\u884c\n\nCSR\u304c\u3067\u304d\u305f\u3089\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u3092CA\u304b\u3089\u767a\u884c\u3057\u307e\u3059\u3002\n\n```openssl.exe\nOpenSSL> ca -config openssl.cfg -out client.crt -infiles client.csr\nUsing configuration from openssl.cfg\nLoading 'screen' into random state - done\nCheck that the request matches the signature\nSignature ok\nCertificate Details:\n        Serial Number: 1 (0x1)\n        Validity\n            Not Before: Jun 15 08:09:51 2015 GMT\n            Not After : Jun 14 08:09:51 2016 GMT\n        Subject:\n            countryName               = JP\n            stateOrProvinceName       = Tokyo\n            organizationName          = Capybara-Private\n            organizationalUnitName    = Private\n            commonName                = A-pZ\n            emailAddress              = a-pz@a-pz.jp\n        X509v3 extensions:\n            X509v3 Basic Constraints:\n                CA:FALSE\n            Netscape Comment:\n                OpenSSL Generated Certificate\n            X509v3 Subject Key Identifier:\n                CF:13:D1:41:DC:21:D1:05:26:4E:94:C9:9A:51:8A:93:AB:10:65:0E\n            X509v3 Authority Key Identifier:\n                DirName:/C=JP/ST=Tokyo/L=Shinagawa/O=Capybara-Local/OU=Section1/CN=a-pz.jp/emailAddress=ca@a-pz.jp\n                serial:AC:38:88:67:35:14:17:2F\n\nCertificate is to be certified until Jun 14 08:09:51 2016 GMT (365 days)\nSign the certificate? [y/n]:y\n\n\n1 out of 1 certificate requests certified, commit? [y/n]y\nWrite out database with 1 new entries\nData Base Updated\n```\n\n\u3053\u308c\u3067\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8 client.crt\u304c\u751f\u6210\u3055\u308c\u3001\u9375\u306e\u30da\u30a2\u304c\u3067\u304d\u307e\u3057\u305f\uff01\n\n### P12\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308b\n\nP12\u30d5\u30a1\u30a4\u30eb\u306f\u96fb\u5b50\u8a3c\u660e\u66f8\u306e\u9375\u30da\u30a2\u304c\u30bb\u30c3\u30c8\u306b\u306a\u3063\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u308b\u5f62\u5f0f\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002Windows\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5834\u5408\u306f\u3001\u3053\u306ep12\u5f62\u5f0f\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30d6\u30eb\u30af\u30ea\u30c3\u30af\u3059\u308b\u3060\u3051\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u304c\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n\u3053\u3053\u3067\u306fP12\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\u307e\u3067\u3092\u76ee\u6a19\u3068\u3057\u307e\u3059\u3002\n\n> \u6b63\u5f0f\u306f PKCS#12 \u5f62\u5f0f\u3067\u3059\u304c\u3001\u62e1\u5f35\u5b50\u30923\u6587\u5b57\u306b\u3059\u308b\u6163\u4f8b\u304b\u3089 p12\u30d5\u30a1\u30a4\u30eb\u3068\u547c\u3076\u65b9\u305f\u3061\u3082\u3044\u307e\u3059\u3002\n\nOpenSSL\u3092\u4f7f\u3044\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u3068\u79d8\u5bc6\u9375\u304b\u3089P12\u30d5\u30a1\u30a4\u30eb\u3092\u751f\u6210\u3057\u307e\u3059\u3002\n\n```openssl.exe\nOpenSSL> pkcs12 -export -in client.crt -inkey client.key -out client.p12 -name tomcat -CAfile ca.crt -caname root -chain\nLoading 'screen' into random state - done\nEnter Export Password:\nVerifying - Enter Export Password:\n\n```\n\n\u6210\u529f\u3059\u308b\u3068\u3001client.p12\u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n\n## keystore(\u30ad\u30fc\u30b9\u30c8\u30a2)\u306b\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u3092\u4f5c\u6210\u3059\u308b\n\n\u5fc5\u8981\u306a\u4f5c\u696d\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3067\u3059\u3002\n\n* \u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u306e\u9375\u30da\u30a2\u4f5c\u6210\n* \u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u4f5c\u6210\n\n### \u30b5\u30fc\u30d0\u306e\u9375\u30da\u30a2\u306e\u4f5c\u6210 \u3068 \u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u4f5c\u6210\n\nTomcat\u7528\u306e\u9375\u30da\u30a2\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u4f5c\u6210\u306fKeytool\u304b\u3089\u884c\u3044\u307e\u3059\u3002\u307e\u305f\u3001\u9375\u3092\u4fdd\u7ba1\u3059\u308b\u5834\u6240\uff08\u30d5\u30a1\u30a4\u30eb\uff09\u3092\u30ad\u30fc\u30b9\u30c8\u30a2\u3068\u547c\u3073\u307e\u3059\u304c\u3001Tomcat\u306b\u8aad\u307f\u8fbc\u307e\u305b\u308b\u30ad\u30fc\u30b9\u30c8\u30a2\u3082\u540c\u6642\u306b\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n> keytool\u306f\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u5b58\u5728\u3057\u306a\u3044\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u540d\u524d\u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u30ad\u30fc\u30b9\u30c8\u30a2\u3082\u65b0\u898f\u4f5c\u6210\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\n\u79d8\u5bc6\u9375\u306f keytool \u304b\u3089\u751f\u6210\u3057\u3001\u516c\u958b\u9375\u306fCA\u306e\u8a3c\u660e\u66f8\u3092\u4f5c\u6210\u3057\u305fOpenSSL\u304b\u3089\u751f\u6210\u3057\u307e\u3059\u3002\n\n#### \u79d8\u5bc6\u9375\u306e\u751f\u6210\n\nkeytool\u3092\u4f7f\u3044\u307e\u3059\u3002OpenSSL\u306e\u3068\u304d\u3068\u306f\u7570\u306a\u308a\u3001\u8a3c\u660e\u66f8\u306e\u60c5\u5831\u3092\u5165\u529b\u3059\u308b\u9806\u756a\u306f\u771f\u9006\u3067\u3059\u3002\n\n**\u59d3\u540d\u306e\u90e8\u5206\u306f\u3001\u30b5\u30fc\u30d0\u306e\u30c9\u30e1\u30a4\u30f3\u3082\u3057\u304f\u306fIP\u30a2\u30c9\u30ec\u30b9\u306b\u3057\u3066\u304f\u3060\u3055\u3044**\n\n```keytool.exe\nC:\\openssl-1.0.2a-x64_86-win64>keytool -genkey -alias tomcat -keyalg RSA -keystore tomcat.jks\n\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044:\n  \u59d3\u540d\u306f\u4f55\u3067\u3059\u304b\u3002\n    [Unknown]:  <\u30b5\u30fc\u30d0\u306e\u30c9\u30e1\u30a4\u30f3\u306a\u3044\u3057\u306fIP\u30a2\u30c9\u30ec\u30b9>\n  \u7d44\u7e54\u5358\u4f4d\u540d\u306f\u4f55\u3067\u3059\u304b\u3002\n    [Unknown]:  Capybara-Server\n  \u7d44\u7e54\u540d\u306f\u4f55\u3067\u3059\u304b\u3002\n    [Unknown]:  Capybara\n  \u90fd\u5e02\u540d\u307e\u305f\u306f\u5730\u57df\u540d\u306f\u4f55\u3067\u3059\u304b\u3002\n    [Unknown]:  Shinagawa\n  \u90fd\u9053\u5e9c\u770c\u540d\u307e\u305f\u306f\u5dde\u540d\u306f\u4f55\u3067\u3059\u304b\u3002\n    [Unknown]:  Tokyo\n  \u3053\u306e\u5358\u4f4d\u306b\u8a72\u5f53\u3059\u308b2\u6587\u5b57\u306e\u56fd\u30b3\u30fc\u30c9\u306f\u4f55\u3067\u3059\u304b\u3002\n    [Unknown]:  JP\nCN=A-pZ, OU=Capybara-Server, O=Capybara, L=Shinagawa, ST=Tokyo, C=JP\u3067\u3088\u308d\u3057\u3044\u3067\u3059\u304b\u3002\n  [\u3044\u3044\u3048]:  y\n\n<tomcat>\u306e\u9375\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\n        (\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3068\u540c\u3058\u5834\u5408\u306fRETURN\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044):[\u3053\u3053\u3067\u306fRETURN\u3068\u3059\u308b]\n```\n\n\u3053\u308c\u3067\u30ad\u30fc\u30b9\u30c8\u30a2\u306b\u79d8\u5bc6\u9375\u304c\u751f\u6210\u3055\u308c\u307e\u3057\u305f\u3002\u30ad\u30fc\u30b9\u30c8\u30a2\u306b\u683c\u7d0d\u3057\u3066\u3044\u308b\u8a3c\u660e\u66f8\u3084\u9375\u306e\u4e00\u89a7\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u4e2d\u8eab\u4e00\u89a7\u3092\u898b\u308b\u306b\u306f\u3001\u540c\u3058\u304fkeytool\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n```keytool.exe\nC:\\openssl-1.0.2a-x64_86-win64>keytool -list -keystore tomcat.jks\n\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044:\n\n\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u30bf\u30a4\u30d7: JKS\n\u30ad\u30fc\u30b9\u30c8\u30a2\u30fb\u30d7\u30ed\u30d0\u30a4\u30c0: SUN\n\n\u30ad\u30fc\u30b9\u30c8\u30a2\u306b\u306f1\u30a8\u30f3\u30c8\u30ea\u304c\u542b\u307e\u308c\u307e\u3059\n\ntomcat,2015/06/16, PrivateKeyEntry,\n\u8a3c\u660e\u66f8\u306e\u30d5\u30a3\u30f3\u30ac\u30d7\u30ea\u30f3\u30c8(SHA1): 30:21:E2:FA:0D:23:8A:DF:18:7A:5D:57:D3:11:D0:B0:23:3C:3B:82\n```\n\ntomcat\u306e\u540d\u524d\u3067\u3001PrivateKeyEntry\u304c\u3042\u308a\u307e\u3059\u306d\u3002\n\n#### \u8a3c\u660e\u66f8\u767a\u884c\u8981\u6c42(CSR)\u3092\u51fa\u3059\n\nkeytool\u304b\u3089\u884c\u3044\u307e\u3059\u3002\u5148\u307b\u3069\u306e\u79d8\u5bc6\u9375\u751f\u6210\u306e\u3068\u304d\u306b\u5165\u529b\u3057\u305f\u60c5\u5831\u3092\u3082\u3068\u306bCSR\u3092\u767a\u884c\u3057\u307e\u3059\u3002\n\n```keytool.exe\nC:\\openssl-1.0.2a-x64_86-win64>keytool -certreq -alias tomcat -file tomcat.csr -keystore tomcat.jks \n\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044: [\u30d1\u30b9\u30ef\u30fc\u30c9]\n```\n\n\u3053\u308c\u3067\u8a3c\u660e\u66f8\u767a\u884c\u8981\u6c42(CSR)\u3067\u3042\u308b tomcat.csr\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n\n#### CA\u304cCSR\u3092\u53d7\u3051\u3066\u7f72\u540d\u3057\u3001\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u3092\u751f\u6210\u3059\u308b\n\nCA\u306b\u3088\u308b\u7f72\u540d\u306fOpenSSL\u304c\u884c\u3044\u307e\u3059\u3002\n\n```openssl.exe\nOpenSSL> ca -config openssl.cfg -out tomcat.crt -infiles tomcat.csr\nUsing configuration from openssl.cfg\nLoading 'screen' into random state - done\nCheck that the request matches the signature\nSignature ok\nCertificate Details:\n        Serial Number: 2 (0x2)\n        Validity\n            Not Before: Jun 16 01:50:00 2015 GMT\n            Not After : Jun 15 01:50:00 2016 GMT\n        Subject:\n            countryName               = JP\n            stateOrProvinceName       = Tokyo\n            organizationName          = Capybara\n            organizationalUnitName    = Capybara-Server\n            commonName                = <\u30b5\u30fc\u30d0\u306e\u30c9\u30e1\u30a4\u30f3\u306a\u3044\u3057\u306fIP\u30a2\u30c9\u30ec\u30b9>\n        X509v3 extensions:\n            X509v3 Basic Constraints:\n                CA:FALSE\n            Netscape Comment:\n                OpenSSL Generated Certificate\n            X509v3 Subject Key Identifier:\n                76:81:19:AB:F2:D4:75:CF:1F:86:6D:75:BD:42:A5:49:EA:21:57:70\n            X509v3 Authority Key Identifier:\n                DirName:/C=JP/ST=Tokyo/L=Shinagawa/O=Capybara-Local/OU=Section1/CN=a-pz.jp/emailAddress=ca@a-pz.jp\n                serial:AC:38:88:67:35:14:17:2F\n\nCertificate is to be certified until Jun 15 01:50:00 2016 GMT (365 days)\nSign the certificate? [y/n]:y\n\n\n1 out of 1 certificate requests certified, commit? [y/n]y\nWrite out database with 1 new entries\nData Base Updated\n```\n\n\u3053\u308c\u3067\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u304c tomcat.crt\u306e\u540d\u524d\u3067 \u3067\u304d\u307e\u3057\u305f\u3002\n\n#### \u30ad\u30fc\u30b9\u30c8\u30a2\u306b\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u3092\u30a4\u30f3\u30dd\u30fc\u30c8\u3059\u308b\n\n\u3067\u304d\u3042\u304c\u3063\u305f\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u3092\u3001\u30ad\u30fc\u30b9\u30c8\u30a2\u3078\u30a4\u30f3\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002\n\n```keytool.exe\nC:\\openssl-1.0.2a-x64_86-win64>keytool -import -alias tomcat -trustcacerts -file tomcat.crt -keystore tomcat.jks\n\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044:\n\u8a3c\u660e\u66f8\u5fdc\u7b54\u304c\u30ad\u30fc\u30b9\u30c8\u30a2\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3057\u305f\n```\n\n\u9375\u30da\u30a2\u306a\u306e\u3067\u3001-alias\u306f \u79d8\u5bc6\u9375\u3068\u540c\u3058 tomcat \u306b\u5fc5\u305a\u3057\u307e\u3059\u3002\n\u7121\u4e8b\u5165\u3063\u305f\u3088\u3046\u3067\u3059\u306d\uff01\n\n\u4ee5\u4e0a\u3067\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u306e\u4f5c\u6210\u4f5c\u696d\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n## Tomcat\u306b\u5bfe\u3057\u3066\u30ad\u30fc\u30b9\u30c8\u30a2\u3092\u6709\u52b9\u306b\u3059\u308b\n\nTomcat\u7528\u306e\u9375\u30da\u30a2\u304c\u683c\u7d0d\u3057\u3066\u3042\u308b\u30ad\u30fc\u30b9\u30c8\u30a2 tomcat.jks \u3092\u3001Tomcat\u306b\u8aad\u307f\u8fbc\u307e\u305b\u307e\u3059\u3002\n\n\u8a2d\u5b9a\u306fTomcat\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea/conf/server.xml\u306b\u3066\u884c\u3044\u307e\u3059\u3002\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u76f4\u5f8c\u306e\u8a2d\u5b9a\u3067\u306f\u3001SSL\u306e\u8a2d\u5b9a\u306f\u30b3\u30e1\u30f3\u30c8\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002server.xml\u306e\u4e2d\u304b\u3089 Connector\u8981\u7d20\u3092\u63a2\u3057\u3001\u305d\u306e\u6b21\u306e\u884c\u306b\u4ee5\u4e0b\u306e\u5185\u5bb9\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```xml:server.xml(\u629c\u7c8b)\n<Connector \tmaxThreads=\"150\" port=\"8443\"\n\t\t\tprotocol=\"org.apache.coyote.http11.Http11NioProtocol\"\n\t\t\tscheme=\"https\" secure=\"true\" sslProtocol=\"TLS\"\n\t\t\tSSLEnabled=\"true\" disableUploadTimeout=\"true\"\n\t\t\tacceptCount=\"100\" debug=\"0\"\n\t\t\tkeyAlias=\"tomcat\" clientAuth=\"true\"\n\t\t\tkeystorePass=\"password\" keystoreFile=\"./conf/tomcat.jks\" keystoreType=\"JKS\"\n\t\t\ttruststorePass=\"password\" truststoreFile=\"./conf/tomcat.jks\" truststoreType=\"JKS\"\n/>\n```\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u7528\u306b\u8ffd\u52a0\u3057\u305f\u5c5e\u6027\u3092\u4ee5\u4e0b\u306b\u5217\u6319\u3057\u307e\u3059\u3002\n\n|\u5c5e\u6027\u540d|\u8aac\u660e|\n|:--|:--|\n|clientAuth|\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u306e\u6709\u7121|\n|truststorePass|\u8a3c\u660e\u66f8\u30c1\u30a7\u30fc\u30f3\u3092\u542b\u3081\u305f\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u30d1\u30b9\u30ef\u30fc\u30c9|\n|truststoreFile|\u8a3c\u660e\u66f8\u30c1\u30a7\u30fc\u30f3\u3092\u542b\u3081\u305f\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u30d5\u30a1\u30a4\u30eb\u540d|\n|truststoreType|\u8a3c\u660e\u66f8\u30c1\u30a7\u30fc\u30f3\u3092\u542b\u3081\u305f\u30ad\u30fc\u30b9\u30c8\u30a2\u306e\u30d5\u30a1\u30a4\u30eb\u5f62\u5f0f|\n\n> \u8a2d\u5b9a\u306e\u8a73\u7d30\u306b\u3064\u3044\u3066\u306f https://tomcat.apache.org/tomcat-8.0-doc/ssl-howto.html#Configuration \u3092\u53c2\u7167\u306b\u3002\n\n\u4ee5\u4e0a\u3067Tomcat\u3067HTTPS\u304c\u6709\u52b9\u306b\u306a\u308a\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u3082\u6709\u52b9\u306b\u306a\u308a\u307e\u3059\uff08\u6697\u53f7\u5316\u30d7\u30ed\u30c8\u30b3\u30eb\u306fTLS1.2\u304c\u9078\u3070\u308c\u307e\u3059)\n\n### Web\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u3092\u6709\u52b9\u306b\u3059\u308b\n\n\u30b5\u30fc\u30d0\u5074\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\u3092\u6709\u52b9\u306b\u3057\u307e\u3057\u305f\u304c\u3001\u642d\u8f09\u3059\u308bWeb\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u3082\u8a2d\u5b9a\u304c\u5fc5\u8981\u3067\u3059\u3002\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a8d\u8a3c\uff08\u8a3c\u660e\u66f8\u306e\u63d0\u793a\uff09\u306e\u307f\u884c\u3046\u306e\u304c\u4eca\u56de\u306e\u76ee\u7684\u3067\u3059\u306e\u3067\u3001\u8a2d\u5b9a\u306f\u975e\u5e38\u306b\u7c21\u7d20\u3067\u3059\u3002\n\nweb.xml\u306b\u6b21\u306e\u4e00\u5f0f\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\u305f\u3044\u3066\u3044\u306e\u5834\u5408\u306f\u6700\u4e0b\u90e8\u3067\u826f\u3044\u3067\u3059\u3002\n\n```xml:web.xml\n<login-config>\n\t<auth-method>CLIENT-CERT</auth-method>\n\t<realm-name>[\u4efb\u610f\u306e\u82f1\u6570\u3067\u540d\u524d\u3092\u3064\u3051\u308b]</realm-name>\n</login-config>\n```\n\n\u4ee5\u4e0a\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u3001Tomcat\u3092\u8d77\u52d5\u3057\u3066\u52d5\u4f5c\u78ba\u8a8d\u3092\u3057\u307e\u3059\u3002\n\nhttp://[\u30b5\u30fc\u30d0\u306e\u30c9\u30e1\u30a4\u30f3\u306a\u3044\u3057\u306fIP\u30a2\u30c9\u30ec\u30b9]:8443/ \u4ee5\u4e0b\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u6b21\u306e\u753b\u9762\u306b\u3042\u308b\u3088\u3046\u306b\u8a3c\u660e\u66f8\u9078\u629e\u306e\u30dd\u30c3\u30d7\u30a2\u30c3\u30d7\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n\u6709\u52b9\u306a\u8a3c\u660e\u66f8\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308c\u3070\u3053\u306e\u753b\u9762\u306e\u3088\u3046\u306b\u8a3c\u660e\u66f8\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n![selectcert.png](https://qiita-image-store.s3.amazonaws.com/0/13268/e807ef49-0fb6-0bef-866f-5950ffd65740.png)\n\n\u9078\u629e\u5f8c\u3001OK\u3092\u62bc\u3057\u3066\u30ea\u30af\u30a8\u30b9\u30c8\u3057\u305fURL\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u5b8c\u4e86\u3067\u3059\u3002\n\n\u304a\u75b2\u308c\u69d8\u3067\u3057\u305f\uff01\n", "tags": ["openssl1.0.2a", "Tomcat8", "pki"]}