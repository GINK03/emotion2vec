{"context": " More than 1 year has passed since last update.Clojure\u3067\u306eAES\u6697\u53f7\u5316\u3059\u308b\u30b3\u30fc\u30c9\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\nJava\u306e\u6a19\u6e96\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3063\u3066\u3067\u304d\u308b\u306e\u3067\u305d\u3093\u306a\u306b\u96e3\u3057\u304f\u306a\u3044\u3067\u3059\u306d\u3002\n\naes.clj\n(import '[java.security SecureRandom Key]\n        '[javax.crypto KeyGenerator Cipher]\n        '[javax.crypto.spec IvParameterSpec]\n        '[java.security.spec AlgorithmParameterSpec])\n\n(defn ^bytes rand-bytes [n]\n  (let [b (byte-array n)]\n    (.. (SecureRandom.) (nextBytes b))\n    b))\n\n(defn ^Key aes-genkey [^long bits]\n  {:pre[(#{128 192 256} bits)]}\n  (let [kg (KeyGenerator/getInstance \"AES\")]\n    (.init kg bits)\n    (.generateKey kg)))\n\n(def ^:dynamic *aes-mode* \"AES/CBC/PKCS5Padding\")\n\n(defn- ^bytes aes-*code [^long mode ^bytes bytes ^Key key ^AlgorithmParameterSpec spec]\n  (let [c (Cipher/getInstance *aes-mode*)]\n    (if spec\n      (.init c mode key spec)\n      (.init c mode key))\n    (.doFinal c bytes)))\n\n(defn ^bytes aes-encode [^bytes bytes ^Key key & [^AlgorithmParameterSpec spec]]\n  (aes-*code Cipher/ENCRYPT_MODE bytes key spec))\n\n(defn ^bytes aes-decode [^bytes bytes ^Key key & [^AlgorithmParameterSpec spec]]\n  (aes-*code Cipher/DECRYPT_MODE bytes key spec))\n\n\n\u4f7f\u3044\u65b9\u306f\u3053\u3093\u306a\u611f\u3058\u3067\n(def k (aes-genkey 128))\n(def iv (rand-bytes 16))\n(def encoded (aes-encode (byte-array 2) k (IvParameterSpec. iv)))\n(def decoded (aes-decode encoded k (IvParameterSpec. iv)))\n\n(binding [*aes-mode* \"AES/ECB/NoPadding\"] \n  (let [e (aes-encode (byte-array 16) k)]\n    (seq (aes-decode e k))))\n\n*aes-mode*\u306b\u306f\u4ee5\u4e0b\u306e\u3082\u306e\u304c\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u3002\n\nAES/CBC/NoPadding\nAES/CBC/PKCS5Padding\nAES/ECB/NoPadding\nAES/ECB/PKCS5Padding \n\nCBC\u306fAES\u9375\u306f\u540c\u3058\u3067\u3082\u6697\u53f7\u5316\u306e\u305f\u3073\u306bIV(Initialization Vector)\u3092\u5909\u3048\u308b\u3053\u3068\u3067\u3001\u540c\u3058\u5e73\u6587\u3067\u3082\u7570\u306a\u308b\u6697\u53f7\u6587\u306b\u3059\u308b\u65b9\u5f0f\u3067\u3059\u3002\u5fa9\u53f7\u3059\u308b\u5074\u306b\u306f\u6697\u53f7\u5316\u306e\u305f\u3073\u306bIV\u3092\u6559\u3048\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nECB\u3067\u306f\u9375\u304c\u540c\u3058\u306a\u3089\u540c\u3058\u5e73\u6587\u306b\u306f\u540c\u3058\u6697\u53f7\u6587\u304c\u51fa\u529b\u3055\u308c\u308b\u306e\u3067\u3001\u6697\u53f7\u5f37\u5ea6\u306f\u5f31\u304f\u306a\u308a\u307e\u3059\u3002\nNoPadding\u306f\u5e73\u6587\u304cAES\u306e\u30d6\u30ed\u30c3\u30af\u9577\u3067\u3042\u308b16\u30d0\u30a4\u30c8\u306e\u500d\u6570\u3067\u3042\u308b\u3068\u78ba\u5b9a\u3057\u3066\u3044\u308b\u5834\u5408\u306b\u306e\u307f\u4f7f\u3048\u307e\u3059\u300216\u306e\u500d\u6570\u3067\u306a\u3044\u5834\u5408\u306f\u4f8b\u5916\u304c\u767a\u751f\u3057\u307e\u3059\u3002\nPKCS5Padding\u306f\u5e73\u6587\u304c16\u30d0\u30a4\u30c8\u306e\u500d\u6570\u3067\u3042\u308b\u3068\u306f\u9650\u3089\u306a\u3044\u5834\u5408\u306b\u4f7f\u3044\u307e\u3059\u3002\uff08\u65b9\u5f0f\u3068\u3057\u3066\u306f\u30d0\u30a4\u30c8\u6570\u309216\u3067\u5272\u3063\u305f\u4f59\u308a\u304c1\u306e\u3068\u304d\u306f0x0f\u309215\u30d0\u30a4\u30c8\u8ffd\u52a0\u3001\u4f59\u308a\u304c2\u306e\u3068\u304d\u306f0x0e\u309214\u30d0\u30a4\u30c8\u8ffd\u52a0\u3001\u4f59\u308a\u304c15\u306e\u3068\u304d\u306f0x01\u30921\u30d0\u30a4\u30c8\u8ffd\u52a0\u3001\u305d\u3057\u3066\u4f59\u308a\u304c0\u306e\u3068\u304d\u306f0x10\u309216\u30d0\u30a4\u30c8\u8ffd\u52a0\u3057\u307e\u3059\uff09\n\u203b\u306a\u304a\u3001\u6b63\u5f0f\u306a\u540d\u79f0\u3068\u3057\u3066\u306fPKCS#7 Padding\u3068\u306a\u308b\u3088\u3046\u3067\u3059\u3002PKCS#5 Padding\u306fDES\u306e\u9803\u306e\u30d6\u30ed\u30c3\u30af\u9577\u304c8\u30d0\u30a4\u30c8\u306e\u3068\u304d\u306e\u540d\u79f0\u3068\u306e\u3053\u3068\u3002Bouncy Castle\u3067\u306fPKCS7\u306e\u540d\u79f0\u306b\u306a\u3063\u3066\u3044\u305f\u3068\u601d\u3044\u307e\u3059\u3002\n\u203b\u3061\u306a\u307f\u306b\u3001\u5fa9\u53f7\u306e\u969b\u306bPadding\u95a2\u9023\u306e\u4f8b\u5916\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u3001Padding\u306e\u8aa4\u308a\u3067\u306f\u306a\u304f\u5fa9\u53f7\u306e\u5931\u6557\uff08\u9375\u3001IV\u306e\u8aa4\u308a\uff09\u3067\u3042\u308b\u30b1\u30fc\u30b9\u304c\u307b\u3068\u3093\u3069\u3067\u3059\u3002\nAES\u306e\u9375\u9577\u306fOracle JDK\u3067\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f128\u30d3\u30c3\u30c8\u3057\u304b\u4f7f\u3048\u307e\u305b\u3093\u3002192, 256\u30d3\u30c3\u30c8\u3067\u4f7f\u3044\u305f\u3044\u5834\u5408\u306fJava Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066jre/lib/security\u306b\u914d\u7f6e\uff08\u4e0a\u66f8\u304d\uff09\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u3053\u306e\u51e6\u7f6e\u3092\u884c\u308f\u306a\u3044\u3068java.security.InvalidKeyException: Illegal key size\u306e\u3088\u3046\u306a\u4f8b\u5916\u304c\u767a\u751f\u3057\u307e\u3059\u3002\nClojure\u3067\u306eAES\u6697\u53f7\u5316\u3059\u308b\u30b3\u30fc\u30c9\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\nJava\u306e\u6a19\u6e96\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3063\u3066\u3067\u304d\u308b\u306e\u3067\u305d\u3093\u306a\u306b\u96e3\u3057\u304f\u306a\u3044\u3067\u3059\u306d\u3002\n\n```aes.clj\n(import '[java.security SecureRandom Key]\n        '[javax.crypto KeyGenerator Cipher]\n        '[javax.crypto.spec IvParameterSpec]\n        '[java.security.spec AlgorithmParameterSpec])\n\n(defn ^bytes rand-bytes [n]\n  (let [b (byte-array n)]\n    (.. (SecureRandom.) (nextBytes b))\n    b))\n\n(defn ^Key aes-genkey [^long bits]\n  {:pre[(#{128 192 256} bits)]}\n  (let [kg (KeyGenerator/getInstance \"AES\")]\n    (.init kg bits)\n    (.generateKey kg)))\n\n(def ^:dynamic *aes-mode* \"AES/CBC/PKCS5Padding\")\n\n(defn- ^bytes aes-*code [^long mode ^bytes bytes ^Key key ^AlgorithmParameterSpec spec]\n  (let [c (Cipher/getInstance *aes-mode*)]\n    (if spec\n      (.init c mode key spec)\n      (.init c mode key))\n    (.doFinal c bytes)))\n\n(defn ^bytes aes-encode [^bytes bytes ^Key key & [^AlgorithmParameterSpec spec]]\n  (aes-*code Cipher/ENCRYPT_MODE bytes key spec))\n\n(defn ^bytes aes-decode [^bytes bytes ^Key key & [^AlgorithmParameterSpec spec]]\n  (aes-*code Cipher/DECRYPT_MODE bytes key spec))\n```\n\n\u4f7f\u3044\u65b9\u306f\u3053\u3093\u306a\u611f\u3058\u3067\n\n```clj\n(def k (aes-genkey 128))\n(def iv (rand-bytes 16))\n(def encoded (aes-encode (byte-array 2) k (IvParameterSpec. iv)))\n(def decoded (aes-decode encoded k (IvParameterSpec. iv)))\n\n(binding [*aes-mode* \"AES/ECB/NoPadding\"] \n  (let [e (aes-encode (byte-array 16) k)]\n    (seq (aes-decode e k))))\n```\n\n`*aes-mode*`\u306b\u306f\u4ee5\u4e0b\u306e\u3082\u306e\u304c\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u3002\n\n* AES/CBC/NoPadding\n* AES/CBC/PKCS5Padding\n* AES/ECB/NoPadding\n* AES/ECB/PKCS5Padding \n\nCBC\u306fAES\u9375\u306f\u540c\u3058\u3067\u3082\u6697\u53f7\u5316\u306e\u305f\u3073\u306bIV(Initialization Vector)\u3092\u5909\u3048\u308b\u3053\u3068\u3067\u3001\u540c\u3058\u5e73\u6587\u3067\u3082\u7570\u306a\u308b\u6697\u53f7\u6587\u306b\u3059\u308b\u65b9\u5f0f\u3067\u3059\u3002\u5fa9\u53f7\u3059\u308b\u5074\u306b\u306f\u6697\u53f7\u5316\u306e\u305f\u3073\u306bIV\u3092\u6559\u3048\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nECB\u3067\u306f\u9375\u304c\u540c\u3058\u306a\u3089\u540c\u3058\u5e73\u6587\u306b\u306f\u540c\u3058\u6697\u53f7\u6587\u304c\u51fa\u529b\u3055\u308c\u308b\u306e\u3067\u3001\u6697\u53f7\u5f37\u5ea6\u306f\u5f31\u304f\u306a\u308a\u307e\u3059\u3002\n\nNoPadding\u306f\u5e73\u6587\u304cAES\u306e\u30d6\u30ed\u30c3\u30af\u9577\u3067\u3042\u308b16\u30d0\u30a4\u30c8\u306e\u500d\u6570\u3067\u3042\u308b\u3068\u78ba\u5b9a\u3057\u3066\u3044\u308b\u5834\u5408\u306b\u306e\u307f\u4f7f\u3048\u307e\u3059\u300216\u306e\u500d\u6570\u3067\u306a\u3044\u5834\u5408\u306f\u4f8b\u5916\u304c\u767a\u751f\u3057\u307e\u3059\u3002\nPKCS5Padding\u306f\u5e73\u6587\u304c16\u30d0\u30a4\u30c8\u306e\u500d\u6570\u3067\u3042\u308b\u3068\u306f\u9650\u3089\u306a\u3044\u5834\u5408\u306b\u4f7f\u3044\u307e\u3059\u3002\uff08\u65b9\u5f0f\u3068\u3057\u3066\u306f\u30d0\u30a4\u30c8\u6570\u309216\u3067\u5272\u3063\u305f\u4f59\u308a\u304c1\u306e\u3068\u304d\u306f0x0f\u309215\u30d0\u30a4\u30c8\u8ffd\u52a0\u3001\u4f59\u308a\u304c2\u306e\u3068\u304d\u306f0x0e\u309214\u30d0\u30a4\u30c8\u8ffd\u52a0\u3001\u4f59\u308a\u304c15\u306e\u3068\u304d\u306f0x01\u30921\u30d0\u30a4\u30c8\u8ffd\u52a0\u3001\u305d\u3057\u3066\u4f59\u308a\u304c0\u306e\u3068\u304d\u306f0x10\u309216\u30d0\u30a4\u30c8\u8ffd\u52a0\u3057\u307e\u3059\uff09\n\n\u203b\u306a\u304a\u3001\u6b63\u5f0f\u306a\u540d\u79f0\u3068\u3057\u3066\u306fPKCS#7 Padding\u3068\u306a\u308b\u3088\u3046\u3067\u3059\u3002PKCS#5 Padding\u306fDES\u306e\u9803\u306e\u30d6\u30ed\u30c3\u30af\u9577\u304c8\u30d0\u30a4\u30c8\u306e\u3068\u304d\u306e\u540d\u79f0\u3068\u306e\u3053\u3068\u3002Bouncy Castle\u3067\u306fPKCS7\u306e\u540d\u79f0\u306b\u306a\u3063\u3066\u3044\u305f\u3068\u601d\u3044\u307e\u3059\u3002\n\u203b\u3061\u306a\u307f\u306b\u3001\u5fa9\u53f7\u306e\u969b\u306bPadding\u95a2\u9023\u306e\u4f8b\u5916\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u3001Padding\u306e\u8aa4\u308a\u3067\u306f\u306a\u304f\u5fa9\u53f7\u306e\u5931\u6557\uff08\u9375\u3001IV\u306e\u8aa4\u308a\uff09\u3067\u3042\u308b\u30b1\u30fc\u30b9\u304c\u307b\u3068\u3093\u3069\u3067\u3059\u3002\n\nAES\u306e\u9375\u9577\u306fOracle JDK\u3067\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f128\u30d3\u30c3\u30c8\u3057\u304b\u4f7f\u3048\u307e\u305b\u3093\u3002192, 256\u30d3\u30c3\u30c8\u3067\u4f7f\u3044\u305f\u3044\u5834\u5408\u306fJava Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066jre/lib/security\u306b\u914d\u7f6e\uff08\u4e0a\u66f8\u304d\uff09\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u3053\u306e\u51e6\u7f6e\u3092\u884c\u308f\u306a\u3044\u3068`java.security.InvalidKeyException: Illegal key size`\u306e\u3088\u3046\u306a\u4f8b\u5916\u304c\u767a\u751f\u3057\u307e\u3059\u3002\n", "tags": ["Clojure1.6.0", "Java", "\u6697\u53f7\u5316"]}