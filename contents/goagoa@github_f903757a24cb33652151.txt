{"tags": ["AWS", "AWS_SDK", "PHP"], "context": " More than 1 year has passed since last update.\u5fc5\u8981\u74b0\u5883\u306e\u78ba\u8a8d\nSDK\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u306e\u4f5c\u6210\n\u306f\u5272\u611b\n\u30c7\u30d7\u30ed\u30a4\u30c4\u30fc\u30eb\u3067\u3088\u304f\u3042\u308bEC2\u306eRole\u3092\u5143\u306b\u30c7\u30d7\u30ed\u30a4\u5148\u306eIP\u3092\u53d6\u5f97\u3059\u308b\u611f\u3058\u3067\u3059\u3002\nrequire_once(realpath(__DIR__ .\"/../vendor/autoload.php\")); // \u5225\u306e\u968e\u5c64\u3067\u5229\u7528\u3059\u308b\u306e\u3067\n\nuse Aws\\Ec2\\Ec2Client;\n\n$keys = array(\n        'key'   => '**********************',\n        'secret' => '*********************************',\n    );\n$config = array(\n    'credentials' => $keys,\n    'region' => 'ap-northeast-1',\n    'version' => 'latest',\n);\n\n$ec2 = new Ec2Client($config);\n$instances = $ec2->describeInstances(array(\n    'Filters' => array(\n        array(\n            'Name' => 'instance-state-name','Values' => array('running'),\n        ),\n    ),\n));\n\n$role = 'app'; // \u63a2\u3057\u305f\u3044Role\n$hosts = array();\n$reservations = $instances['Reservations'];\nforeach ($reservations as $reservation) {\n    $instances = $reservation['Instances'];\n    foreach ($instances as $instance) {\n        foreach ($instance['Tags'] as $tag) {\n            if ($tag['Key'] === 'Role') {\n                if ($tag['Value'] === $role) {\n                    $hosts[] = $instance['PrivateIpAddress'];\n                    break;\n                }\n            }\n        }\n    }\n}\n\nvar_dump($hosts);\n\n\u5fc5\u8981\u74b0\u5883\u306e\u78ba\u8a8d\nSDK\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u306e\u4f5c\u6210\n\u306f\u5272\u611b\n\n\u30c7\u30d7\u30ed\u30a4\u30c4\u30fc\u30eb\u3067\u3088\u304f\u3042\u308bEC2\u306eRole\u3092\u5143\u306b\u30c7\u30d7\u30ed\u30a4\u5148\u306eIP\u3092\u53d6\u5f97\u3059\u308b\u611f\u3058\u3067\u3059\u3002\n\n```\nrequire_once(realpath(__DIR__ .\"/../vendor/autoload.php\")); // \u5225\u306e\u968e\u5c64\u3067\u5229\u7528\u3059\u308b\u306e\u3067\n\nuse Aws\\Ec2\\Ec2Client;\n\n$keys = array(\n\t\t'key'\t=> '**********************',\n\t\t'secret' => '*********************************',\n\t);\n$config = array(\n\t'credentials' => $keys,\n\t'region' => 'ap-northeast-1',\n\t'version' => 'latest',\n);\n\n$ec2 = new Ec2Client($config);\n$instances = $ec2->describeInstances(array(\n\t'Filters' => array(\n\t\tarray(\n\t\t\t'Name' => 'instance-state-name','Values' => array('running'),\n\t\t),\n\t),\n));\n\n$role = 'app'; // \u63a2\u3057\u305f\u3044Role\n$hosts = array();\n$reservations = $instances['Reservations'];\nforeach ($reservations as $reservation) {\n\t$instances = $reservation['Instances'];\n\tforeach ($instances as $instance) {\n\t\tforeach ($instance['Tags'] as $tag) {\n\t\t\tif ($tag['Key'] === 'Role') {\n\t\t\t\tif ($tag['Value'] === $role) {\n\t\t\t\t\t$hosts[] = $instance['PrivateIpAddress'];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nvar_dump($hosts);\n```\n"}