{"context": "\n\n\u524d\u63d0\nAWS\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3059\u3067\u306b\u3042\u308b\n\u3053\u3053\u306e\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3092\u57fa\u672c\u306b\u9032\u3081\u308b\n\nAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u3092Stackdriver Monitoring \u306b\u63a5\u7d9a\u3059\u308b\u3002\n\u3053\u3053\u3092\u53c2\u8003\u306b\n\n\u627f\u8a8d\u8a8d\u8a3c\u60c5\u5831\u3092\u4f5c\u6210\u3059\u308b\n\u3053\u3053\u3092\u53c2\u8003\u306b\n\n\u30ed\u30b0 \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nAWS\u306b\u3066\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u30bf\u30bf\u30fc\u30f3\uff01\ncurl -sSO https://dl.google.com/cloudagents/install-logging-agent.sh\nsha256sum install-logging-agent.sh\n\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u30b3\u30de\u30f3\u30c9\uff08\u30d5\u30a1\u30a4\u30eb\u306e\u540c\u4e00\u6027\u3092\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306e\u6570\u5024\uff09\u306e\u51fa\u529b\u7d50\u679c\n07ca6e522885b9696013aaddde48bf2675429e57081c70080a9a1364a411b395  install-logging-agent.sh\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u5b9f\u884c\nsudo bash install-logging-agent.sh\n\n\u30ed\u30b0\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3068\u306f\uff1f\n\u30ed\u30b0\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f fluentd \u3092\u30d9\u30fc\u30b9\u3068\u3057\u3066\u304a\u308a\u3001Google Compute Engine \u3084 Amazon EC2 \u306e\u4eee\u60f3\u30de\u30b7\u30f3\uff08VM\uff09\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e0a\u3067\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\u3053\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u3001\u4e00\u822c\u7684\u306a\u30b5\u30fc\u30c9\u30d1\u30fc\u30c6\u30a3\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3084\u30b7\u30b9\u30c6\u30e0 \u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u304b\u3089 Stackdriver Logging \u306b\u30ed\u30b0\u3092\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u3057\u307e\u3059\u3002\u30ed\u30b0 \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u3059\u3079\u3066\u306e VM \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3053\u3068\u3092\u304a\u3059\u3059\u3081\u3057\u307e\u3059\u3002\n\nlog\u306b\u66f8\u304d\u8fbc\u3093\u3067\u307f\u308b\nAWS\u306e\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067\nlogger \"hello my first log\"\n\u2193\u66f8\u304d\u8fbc\u307e\u308c\u3066\u3044\u308b\uff01\n\n\nPHP\u3067\u6311\u6226\u3057\u3066\u307f\u308b\n\nGoogle API \u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\nAPI Manager-> StackdriverLogging API->\u8a8d\u8a3c\u60c5\u5831\nGoogle-Cloud-PHP\u306eAPI\u4ed5\u69d8\u306f\u3053\u3053\u304b\u3089\n<\u30b3\u30f3\u30dd\u30fc\u30b6\u3092\u30a4\u30f3\u30b9\u30c8\u30eb>\ncurl -sS https://getcomposer.org/installer | php\ncomposer.json\u306b\u4ee5\u4e0b\u3092\u66f8\u304d\u8fbc\u3080\n\nsample.json\n    \"require\": {\n        \"monolog/monolog\": \"1.2.*\"\n    }\n\n\nphp composer.phar install\ncomposer require google/cloud\n\u3053\u3093\u306a\u30a8\u30e9\u30fc\u304c\u3067\u3066\u304d\u305f\u3089\nInstallation failed, reverting ./composer.json to its original content.\nThe following exception is caused by a lack of memory or swap, or not having swap configured\nCheck https://getcomposer.org/doc/articles/troubleshooting.md#proc-open-fork-failed-errors for details\n\u2193\u3053\u308c\u3067\u89e3\u6c7a\n/bin/dd if=/dev/zero of=/var/swap.1 bs=1M count=1024\npecl install grpc\ncomposer require google/gax && composer require google/proto-client-php\nsudo mv ~/composer.phar /usr/local/bin/composer\n\n\u8a18\u8ff0\u65b9\u6cd5\n\nsample.php\n<?php\nrequire 'vendor/autoload.php';\n\nuse Google\\Cloud\\Logging\\LoggingClient;\n\n$logging = new LoggingClient([\n\n    'keyFilePath' => '/etc/google/auth/application_default_credentials.json',//\u2190\u5404\u3005\u306ekeyfilePath\u3092\u8a2d\u5b9a\n    'projectId' => 'XXXXXXX'//\u2190\u5404\u3005\u306eprojectId\u3092\u8a2d\u5b9a\n]);\n\n\n// Get a logger instance.\n$logger = $logging->logger('syslog');//\u2190log\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\n\n// Write a log entry.\n$logger->write('my message from php ');//\u2190\u51fa\u529b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8a18\u8f09\n\n//\u2193\u3053\u3053\u304b\u3089\u306f\u30ed\u30b0\u3092\u53d6\u5f97\u3057\u3066\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u8868\u793a\u3059\u308b\u2193\n// List log entries from a specific log.\n$entries = $logging->entries([\n    'filter' => 'logName = projects/hoge/logs/syslog'//\u2190\u8868\u793a\u3057\u305f\u3044\u30ed\u30b0\u306e\u30d1\u30b9\u3092\u8a18\u8f09\n]);\n\nforeach ($entries as $entry) {\n    echo $entry->info()['textPayload'] . \"\\n\";//\u2190\u30eb\u30fc\u30d7\u3067\u30ed\u30b0\u3092\u51fa\u529b\n}\n\n\n\u3082\u3061\u308d\u3093\u30ed\u30b0\u30d3\u30e5\u30fc\u30a2\u304b\u3089\u3082\u30ed\u30b0\u306f\u898b\u308c\u307e\u3059\u3002\n<\u30ed\u30b0\u30d3\u30e5\u30fc\u30a2\u304b\u3089\u306a\u3089\u9ad8\u5ea6\u306a\u691c\u7d22\u3092\u6307\u5b9a\u3067\u304d\u308b>\n\u4f8b)\nresource.type=\"aws_ec2_instance\"\n\"Jan 25\" AND (\"pid 29718\" OR \"pid 29629\")\n\nLoggingClient\u306e\u8a73\u3057\u3044\u4ed5\u69d8\u306f\u2193\nhttp://googlecloudplatform.github.io/google-cloud-php/#/docs/v0.20.1/logging/loggingclient\n\n\u305d\u306e\u4ed6\n\"Project Name\" \u3068 \"Project ID\"\u306e\u9055\u3044\u306f?\nProject Name \u306f\u3001\u30e6\u30fc\u30b6\u304c\u4efb\u610f\u3067\u3064\u3051\u308c\u308b\u3082\u306e\u3067\u3059\u3002\n\u4e00\u65b9 Project ID \u30b0\u30fc\u30b0\u30eb\u30af\u30e9\u30a6\u30c9\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30e9\u30a4\u30d6\u30e9\u30ea\u306b\u8a8d\u8a3c\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n#\u524d\u63d0\nAWS\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3059\u3067\u306b\u3042\u308b\n[\u3053\u3053](https://cloud.google.com/logging/docs/agent/installation)\u306e\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3092\u57fa\u672c\u306b\u9032\u3081\u308b\n\n#AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u3092Stackdriver Monitoring \u306b\u63a5\u7d9a\u3059\u308b\u3002\n[\u3053\u3053](https://cloud.google.com/monitoring/accounts/guide#monitor-aws-project)\u3092\u53c2\u8003\u306b\n\n\n#\u627f\u8a8d\u8a8d\u8a3c\u60c5\u5831\u3092\u4f5c\u6210\u3059\u308b\n[\u3053\u3053](https://cloud.google.com/logging/docs/agent/authorization#configuring_client_id_authorization)\u3092\u53c2\u8003\u306b\n\n#\u30ed\u30b0 \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nAWS\u306b\u3066\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u30bf\u30bf\u30fc\u30f3\uff01\n\ncurl -sSO https://dl.google.com/cloudagents/install-logging-agent.sh\nsha256sum install-logging-agent.sh\n\n\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u30b3\u30de\u30f3\u30c9\uff08\u30d5\u30a1\u30a4\u30eb\u306e\u540c\u4e00\u6027\u3092\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306e\u6570\u5024\uff09\u306e\u51fa\u529b\u7d50\u679c\n07ca6e522885b9696013aaddde48bf2675429e57081c70080a9a1364a411b395  install-logging-agent.sh\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u5b9f\u884c\nsudo bash install-logging-agent.sh\n\n#\u30ed\u30b0\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3068\u306f\uff1f\n\u30ed\u30b0\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f fluentd \u3092\u30d9\u30fc\u30b9\u3068\u3057\u3066\u304a\u308a\u3001Google Compute Engine \u3084 Amazon EC2 \u306e\u4eee\u60f3\u30de\u30b7\u30f3\uff08VM\uff09\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e0a\u3067\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\u3053\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u3001\u4e00\u822c\u7684\u306a\u30b5\u30fc\u30c9\u30d1\u30fc\u30c6\u30a3\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3084\u30b7\u30b9\u30c6\u30e0 \u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u304b\u3089 Stackdriver Logging \u306b\u30ed\u30b0\u3092\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u3057\u307e\u3059\u3002\u30ed\u30b0 \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u3059\u3079\u3066\u306e VM \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3053\u3068\u3092\u304a\u3059\u3059\u3081\u3057\u307e\u3059\u3002\n\n#log\u306b\u66f8\u304d\u8fbc\u3093\u3067\u307f\u308b\nAWS\u306e\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067\nlogger \"hello my first log\"\n\n\u2193\u66f8\u304d\u8fbc\u307e\u308c\u3066\u3044\u308b\uff01\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-01-25 14.59.38.png](https://qiita-image-store.s3.amazonaws.com/0/95143/22c0bcf6-0044-11af-0148-ee968d08cce7.png)\n\n\n#PHP\u3067\u6311\u6226\u3057\u3066\u307f\u308b\n\n##Google API \u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\n\nAPI Manager-> StackdriverLogging API->\u8a8d\u8a3c\u60c5\u5831\n\nGoogle-Cloud-PHP\u306eAPI\u4ed5\u69d8\u306f[\u3053\u3053](https://github.com/googlecloudplatform/google-cloud-php)\u304b\u3089\n\n**<\u30b3\u30f3\u30dd\u30fc\u30b6\u3092\u30a4\u30f3\u30b9\u30c8\u30eb>**\ncurl -sS https://getcomposer.org/installer | php\n\n**composer.json\u306b\u4ee5\u4e0b\u3092\u66f8\u304d\u8fbc\u3080**\n\n```json:sample.json\n    \"require\": {\n        \"monolog/monolog\": \"1.2.*\"\n    }\n```\nphp composer.phar install\ncomposer require google/cloud\n\n**\u3053\u3093\u306a\u30a8\u30e9\u30fc\u304c\u3067\u3066\u304d\u305f\u3089**\nInstallation failed, reverting ./composer.json to its original content.\nThe following exception is caused by a lack of memory or swap, or not having swap configured\nCheck https://getcomposer.org/doc/articles/troubleshooting.md#proc-open-fork-failed-errors for details\n\n**\u2193\u3053\u308c\u3067\u89e3\u6c7a**\n/bin/dd if=/dev/zero of=/var/swap.1 bs=1M count=1024\n\npecl install grpc\ncomposer require google/gax && composer require google/proto-client-php\nsudo mv ~/composer.phar /usr/local/bin/composer\n\n#\u8a18\u8ff0\u65b9\u6cd5\n```php:sample.php\n<?php\nrequire 'vendor/autoload.php';\n\nuse Google\\Cloud\\Logging\\LoggingClient;\n\n$logging = new LoggingClient([\n\n    'keyFilePath' => '/etc/google/auth/application_default_credentials.json',//\u2190\u5404\u3005\u306ekeyfilePath\u3092\u8a2d\u5b9a\n    'projectId' => 'XXXXXXX'//\u2190\u5404\u3005\u306eprojectId\u3092\u8a2d\u5b9a\n]);\n\n\n// Get a logger instance.\n$logger = $logging->logger('syslog');//\u2190log\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\n\n// Write a log entry.\n$logger->write('my message from php ');//\u2190\u51fa\u529b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8a18\u8f09\n\n//\u2193\u3053\u3053\u304b\u3089\u306f\u30ed\u30b0\u3092\u53d6\u5f97\u3057\u3066\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u8868\u793a\u3059\u308b\u2193\n// List log entries from a specific log.\n$entries = $logging->entries([\n    'filter' => 'logName = projects/hoge/logs/syslog'//\u2190\u8868\u793a\u3057\u305f\u3044\u30ed\u30b0\u306e\u30d1\u30b9\u3092\u8a18\u8f09\n]);\n\nforeach ($entries as $entry) {\n    echo $entry->info()['textPayload'] . \"\\n\";//\u2190\u30eb\u30fc\u30d7\u3067\u30ed\u30b0\u3092\u51fa\u529b\n}\n```\n\u3082\u3061\u308d\u3093\u30ed\u30b0\u30d3\u30e5\u30fc\u30a2\u304b\u3089\u3082\u30ed\u30b0\u306f\u898b\u308c\u307e\u3059\u3002\n\n**<\u30ed\u30b0\u30d3\u30e5\u30fc\u30a2\u304b\u3089\u306a\u3089\u9ad8\u5ea6\u306a\u691c\u7d22\u3092\u6307\u5b9a\u3067\u304d\u308b>**\n\u4f8b)\nresource.type=\"aws_ec2_instance\"\n\"Jan 25\" AND (\"pid 29718\" OR \"pid 29629\")\n\n#LoggingClient\u306e\u8a73\u3057\u3044\u4ed5\u69d8\u306f\u2193\nhttp://googlecloudplatform.github.io/google-cloud-php/#/docs/v0.20.1/logging/loggingclient\n\n\n#\u305d\u306e\u4ed6\n**\"Project Name\" \u3068 \"Project ID\"\u306e\u9055\u3044\u306f?**\nProject Name \u306f\u3001\u30e6\u30fc\u30b6\u304c\u4efb\u610f\u3067\u3064\u3051\u308c\u308b\u3082\u306e\u3067\u3059\u3002\n\u4e00\u65b9 Project ID \u30b0\u30fc\u30b0\u30eb\u30af\u30e9\u30a6\u30c9\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30e9\u30a4\u30d6\u30e9\u30ea\u306b\u8a8d\u8a3c\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n", "tags": ["log", "StackdriverLogging", "AWS", "gcp"]}