{"context": " More than 1 year has passed since last update.Hapi.js\u3068Socket.IO\u306e\u7df4\u7fd2\u3068\u3057\u3066\u3001\u524d\u56de\u306fSocket.IO\u30b5\u30fc\u30d0\u30fc\u5074\u3067setInterval\u306e5\u79d2\u9593\u9694\u3067\u30c0\u30df\u30fc\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092emit\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\u4eca\u56de\u306f\u3082\u3046\u5c11\u3057\u5b9f\u8df5\u7684\u306bTwitter Streaming API\u306ePOST statuses/filter\u304b\u3089\u6307\u5b9a\u3057\u305f\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u691c\u7d22\u3057\u3066\u30d6\u30e9\u30a6\u30b6\u3078\u8868\u793a\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u306b\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\n\u9069\u5f53\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u30ea\u30dd\u30b8\u30c8\u30ea\u306f\u3053\u3061\u3089\u3067\u3059\u3002\n$ ~/node_apps/docker-hapi-twitter\n$ tree -aL 2\n.\n\u251c\u2500\u2500 .dockerignore\n\u251c\u2500\u2500 .env\n\u251c\u2500\u2500 .gitignore\n\u251c\u2500\u2500 Dockerfile\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 app.js\n\u251c\u2500\u2500 docker-compose.yml\n\u251c\u2500\u2500 node_modules -> /dist/node_modules\n\u251c\u2500\u2500 package.json\n\u2514\u2500\u2500 templates\n    \u2514\u2500\u2500 index.html\n\n\napp.js\napp.js\u304c\u30a8\u30f3\u30c8\u30ea\u30dd\u30a4\u30f3\u30c8\u3067\u3059\u3002\u901a\u5e38\u306eHTTP\u30b5\u30fc\u30d0\u30fc\u3068Socket.IO\u30b5\u30fc\u30d0\u30fc\u306e2\u3064\u3092\u30e9\u30d9\u30eb\u3092\u4ed8\u3051\u3066\u8d77\u52d5\u3057\u3066\u3044\u307e\u3059\u3002Socket.IO\u30b5\u30fc\u30d0\u30fc\u306e\u65b9\u306f\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u3057\u3066twitter.js\u30d5\u30a1\u30a4\u30eb\u306b\u5b9f\u88c5\u3057\u307e\u3057\u305f\u3002\n\n~/node_apps/docker-hapi-twitter/app.js\n'user strict';\n\nvar Hapi = require('hapi'),\n    server = new Hapi.Server(),\n    Path = require('path');\nrequire('dotenv').load();\n\nserver.connection({ port: process.env.API_PORT, labels: ['api'] });\nserver.connection({ port: process.env.SOCKETIO_PORT, labels: ['twitter'] });\n\nserver.views({\n    engines: {\n        html: require('handlebars')\n    },\n    path: Path.join(__dirname, 'templates')\n});\n\nserver.select('api').route({\n    method: 'GET',\n    path: '/',\n    handler: function (request, reply) {\n        reply.view('index',\n                   { socketio_host: (process.env.PUBLIC_IP+':'\n                                     +process.env.SOCKETIO_PORT)});\n    }\n});\n\nserver.register(require('./twitter'), function(err) {\n    if(err) throw err;\n    server.start();\n});\n\n\n\n\ntwitter.js\nTwitter API\u306e\u8a8d\u8a3c\u60c5\u5831\u3084Socket.IO\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u306a\u3069\u306fdotenv\u304c\u7ba1\u7406\u3059\u308b.env\u30d5\u30a1\u30a4\u30eb\u306b\u5b9a\u7fa9\u3057\u307e\u3059\u3002.env.default\u3092\u30ea\u30cd\u30fc\u30e0\u3057\u3066\u4f7f\u3044\u307e\u3059\u3002\n\n~/node_apps/docker-hapi-twitter/.env\nPUBLIC_IP=\nSOCKETIO_PORT=8088\nAPI_PORT=8000\nTWITTER_KEY=\nTWITTER_SECRET=\nTWITTER_TOKEN=\nTWITTER_TOKEN_SECRET=\n\n\ntwitter.js\u306bhapi\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u3057\u3066Twitter Streaming API\u306ePOST statuses/filter\u3092\u5b9f\u88c5\u3057\u3066\u3044\u304d\u307e\u3059\u3002Node.js\u306eTwitter\u7528\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u3044\u304f\u3064\u304b\u3042\u308a\u307e\u3059\u304c\u3001twit\u304c\u6c17\u306b\u5165\u3063\u3066\u3044\u307e\u3059\u3002\n\n~/node_apps/docker-hapi-twitter/twitter.js\nvar Twit = require('twit'),\n    moment = require('moment-timezone'),\n    _ = require('lodash'),\n    colors = require('colors');\n\nvar T = new Twit({\n    consumer_key: process.env.TWITTER_KEY,\n    consumer_secret: process.env.TWITTER_SECRET,\n    access_token: process.env.TWITTER_TOKEN,\n    access_token_secret: process.env.TWITTER_TOKEN_SECRET\n});\n\nfunction formatDate(created_date){\n    return moment(new Date(created_date)).tz(\"Asia/Tokyo\").format();\n}\n\nfunction createUrl(screen_name,id_str){\n    return 'https://twitter.com/'+screen_name+'/status/'+id_str;\n}\n\nfunction pluckPath(data,path,key,suffix) {\n    return _.pluck(_.get(data,path),key)\n            .map(function(x) {return suffix+x})\n            .toString();\n}\n\nfunction extractData(s) {\n    return {\n        id: s.id_str,\n        url: createUrl(s.user.screen_name,s.id_str),\n        profile_image_url: s.user.profile_image_url,\n        created_at: formatDate(s.created_at),\n        lang: s.lang,\n        name: s.user.name,\n        screen_name: s.user.screen_name,\n        user_url: s.user.url || '',\n        text: s.text,\n        source: s.source,\n        expanded_url: _.get(s,'entities.urls[0].expanded_url',''),\n        hashtags: pluckPath(s,'entities.hashtags','text',\"#\"),\n        user_mentions: pluckPath(s,'entities.user_mentions','screen_name',\"@\"),\n        retweeted_status: s.retweeted_status ? true : false\n    }\n}\n\nfunction prettyPrint(tweet) {\n    console.log('tweet: '.magenta.bold + tweet.text);\n    console.log('by:'.green + ' @' + tweet.screen_name);\n    console.log('date:'.cyan + ' ' + tweet.created_at);\n    console.log('--------------------------------------------------------------------------------'.yellow);\n}\n\nexports.register = function(server,options,next) {\n\n    var io = require('socket.io')(server.select('twitter').listener),\n        track = 'babymetal',\n        stream = null,\n        users = [];\n\n    io.sockets.on('connection', function(socket) {\n\n        if(!_.includes(users, socket.id)) {\n            users.push(socket.id);\n        }\n\n        var con_msg = socket.id + ' connected, now: ' + users.length; \n        console.log(con_msg);\n        socket.emit('connected', con_msg);\n\n        socket.on('disconnect', function() {\n            _.pull(users, socket.id);\n            var discon_msg = socket.id + ' disconnected, now: ' + users.length; \n            console.log(discon_msg);\n        });\n\n        socket.on('start stream', function() {\n            console.log(socket.id + ' start twitter stream');\n            if (stream === null) {\n                stream =  T.stream('statuses/filter',\n                                   {track: track,\n                                    language: 'ja'});\n            };\n            stream.on('tweet', function(tweet) {\n                if(users.length > 0) {\n                    var data = extractData(tweet);\n                    prettyPrint(data);\n                    socket.emit('new tweet', data);\n                } else {\n                    stream.stop();\n                    stream = null;\n                    console.log('stop twitter stream');\n                }\n            });\n        });\n    });\n\n    next();\n};\n\nexports.register.attributes = {\n    name: 'hapi-twitter'\n};\n\n\n\n\u7c21\u5358\u306a\u4ed5\u69d8\nNode.js\u3068Socket.IO\u3001Twitter Streaming API\u306e\u4f7f\u3044\u65b9\u306f\u4ee5\u4e0b\u3092\u53c2\u8003\u306b\u3057\u3066\u306a\u308b\u3079\u304f\u52b9\u7387\u7684\u306a\u30ea\u30b9\u30ca\u30fc\u306e\u4f7f\u3044\u65b9\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\nNode.js, Socket.io and the Twitter Streaming API in Heroku\nUsing the Twitter Stream API to Visualize Tweets on Google Maps\n\n\u7c21\u5358\u306a\u4ed5\u69d8\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\n\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089Socket.IO\u306e\u63a5\u7d9a\u304c\u6765\u3066\u304b\u3089Twitter\u306e\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u958b\u59cb\u3059\u308b\n\u63a5\u7d9a\u3057\u3066\u3044\u308bSocket.IO\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u306a\u304f\u306a\u3063\u305f\u3089Twitter\u306e\u30b9\u30c8\u30ea\u30fc\u30e0\u306f\u9589\u3058\u308b\n\n\n\u6b21\u56de\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092Reagent\u3067\n\u30ad\u30fc\u30ef\u30fc\u30c9\u306f\u56fa\u5b9a\u3067babymetal\u306b\u3057\u3066\u3044\u307e\u3059\u3002Socket.IO\u30b5\u30fc\u30d0\u30fc\u304c\u3067\u304d\u305f\u306e\u3067\u3001\u6b21\u56de\u306f\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u753b\u9762\u304b\u3089\u5165\u529b\u3067\u304d\u308b\u3088\u3046\u306a\u30d5\u30a9\u30fc\u30e0\u3092React\u3068Reagent\u3067\u4f5c\u6210\u3059\u308b\u4e88\u5b9a\u3067\u3059\u3002\u6700\u7d42\u7684\u306b\u306fClojure\u3068ClojureScript\u306e\u30d5\u30eb\u30b9\u30bf\u30c3\u30af\u306b\u3057\u305f\u3044\u3067\u3059\u3002\n\nindex.html\nindex.html\u306fHandlebars\u3092\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u4f7f\u3044\u307e\u3057\u305f\u3002Socket.IO\u306e1.0\u304b\u3089socket.io.js\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306fcdnjs\u3067\u914d\u5e03\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u4eca\u56de\u306fhapi\u304c\u30b5\u30fc\u30d0\u30fc\u3092\u8907\u6570\u8d77\u52d5\u3067\u304d\u308b\u3053\u3068\u306e\u78ba\u8a8d\u306e\u305f\u3081Socket.IO\u30b5\u30fc\u30d0\u30fc\u306e\u30dd\u30fc\u30c8\u3092Handlebars\u306b{{socketio_host}}\u3092\u6e21\u3057\u3066URL\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n~/node_apps/docker-hapi-twitter/templates/index.html\n<!DOCTYPE html>\n<html lang=\"ja\">\n  <head>\n    <meta charset=\"utf-8\">\n    <title>tweet</title>\n    <script src=\"//ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js\"></script>\n    <script src=\"http://{{socketio_host}}/socket.io/socket.io.js\"></script>\n    <script>\n      $(function() {\n        if(io !== undefined) {\n          var socket = io.connect(\"http://{{socketio_host}}\");\n          socket.on(\"connected\", function(msg) {\n            console.log(msg);\n            socket.emit(\"start stream\");\n          });\n          socket.on(\"new tweet\", function(tweet){\n            console.log(tweet);\n            var img = '<img src=\"' + tweet.profile_image_url + '\" width=\"48\" height=\"48\" />';\n            var tweetEl = \n              '<div>'\n              + '<a href=\"' + tweet.url + '\" target=\"_blank\">' + img + '</a>'\n              + '<span style=\"padding-left:15px\">' + tweet.name + ' @' + tweet.screen_name\n              + ' - ' + tweet.created_at\n              + '</span>'\n              + '<p>' + tweet.text  + '</p>'\n              + '</div>';\n            $(\"#tweets\").prepend(tweetEl);\n          });\n        }\n      });\n    </script>\n  </head>\n  <body>\n    <div id=\"tweets\"></div>\n  </body>\n</html>\n\n\n\n\u30d6\u30e9\u30a6\u30b6\u3067\u78ba\u8a8d\nDocker Compose\u3067\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ cd ~/node_apps/docker-hapi-twitter\n$ docker-compose up\n\n\u30d6\u30e9\u30a6\u30b6\u3067hapi\u306eHTTP\u30b5\u30fc\u30d0\u30fc\u306eURL\u3092\u958b\u304f\u3068Socket.IO\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u30b5\u30fc\u30d0\u30fc\u3068\u63a5\u7d9a\u3092\u59cb\u3081\u307e\u3059\u3002\nhttp://xxx.xxx.xxx.xxx:8000/\n\u30b9\u30c8\u30ea\u30fc\u30e0\u3067\u53d6\u5f97\u3057\u305ftweet\u306f\u5c11\u3057\u3060\u3051\u6574\u5f62\u3057\u3066#tweets\u306ediv\u306bprepend\u3057\u307e\u3059\u3002tweet\u306e\u30c6\u30ad\u30b9\u30c8\u672c\u6587\u3068\u3001\u30e6\u30fc\u30b6\u30fc\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u30a4\u30e1\u30fc\u30b8\u3001tweet\u306eURL\u3001\u30e6\u30fc\u30b6\u30fc\u540d\u306a\u3069\u8868\u793a\u3057\u307e\u3059\u3002\n\n~/node_apps/docker-hapi-twitter/templates/index.html\nvar tweetEl = \n  '<div>'\n  + '<a href=\"' + tweet.url + '\" target=\"_blank\">' + img + '</a>'\n  + '<span style=\"padding-left:15px\">' + tweet.name + ' @' + tweet.screen_name\n  + ' - ' + tweet.created_at\n  + '</span>'\n  + '<p>' + tweet.text  + '</p>'\n  + '</div>';\n\n\n\n[Hapi.js](http://hapijs.com/)\u3068[Socket.IO\u306e\u7df4\u7fd2](http://qiita.com/masato/items/3886a23c9bf827068f05)\u3068\u3057\u3066\u3001\u524d\u56de\u306fSocket.IO\u30b5\u30fc\u30d0\u30fc\u5074\u3067setInterval\u306e5\u79d2\u9593\u9694\u3067\u30c0\u30df\u30fc\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092emit\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\u4eca\u56de\u306f\u3082\u3046\u5c11\u3057\u5b9f\u8df5\u7684\u306bTwitter Streaming API\u306e[POST statuses/filter](https://dev.twitter.com/streaming/reference/post/statuses/filter)\u304b\u3089\u6307\u5b9a\u3057\u305f\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u691c\u7d22\u3057\u3066\u30d6\u30e9\u30a6\u30b6\u3078\u8868\u793a\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u306b\u3057\u3066\u307f\u307e\u3059\u3002\n\n\n## \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\n\n\u9069\u5f53\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u30ea\u30dd\u30b8\u30c8\u30ea\u306f[\u3053\u3061\u3089](https://github.com/masato/docker-hapi-twitter)\u3067\u3059\u3002\n\n```bash\n$ ~/node_apps/docker-hapi-twitter\n$ tree -aL 2\n.\n\u251c\u2500\u2500 .dockerignore\n\u251c\u2500\u2500 .env\n\u251c\u2500\u2500 .gitignore\n\u251c\u2500\u2500 Dockerfile\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 app.js\n\u251c\u2500\u2500 docker-compose.yml\n\u251c\u2500\u2500 node_modules -> /dist/node_modules\n\u251c\u2500\u2500 package.json\n\u2514\u2500\u2500 templates\n    \u2514\u2500\u2500 index.html\n```\n\n### app.js\n\napp.js\u304c\u30a8\u30f3\u30c8\u30ea\u30dd\u30a4\u30f3\u30c8\u3067\u3059\u3002\u901a\u5e38\u306eHTTP\u30b5\u30fc\u30d0\u30fc\u3068Socket.IO\u30b5\u30fc\u30d0\u30fc\u306e2\u3064\u3092\u30e9\u30d9\u30eb\u3092\u4ed8\u3051\u3066\u8d77\u52d5\u3057\u3066\u3044\u307e\u3059\u3002Socket.IO\u30b5\u30fc\u30d0\u30fc\u306e\u65b9\u306f\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u3057\u3066`twitter.js`\u30d5\u30a1\u30a4\u30eb\u306b\u5b9f\u88c5\u3057\u307e\u3057\u305f\u3002\n\n```js:~/node_apps/docker-hapi-twitter/app.js\n'user strict';\n\nvar Hapi = require('hapi'),\n    server = new Hapi.Server(),\n    Path = require('path');\nrequire('dotenv').load();\n\nserver.connection({ port: process.env.API_PORT, labels: ['api'] });\nserver.connection({ port: process.env.SOCKETIO_PORT, labels: ['twitter'] });\n\nserver.views({\n    engines: {\n        html: require('handlebars')\n    },\n    path: Path.join(__dirname, 'templates')\n});\n\nserver.select('api').route({\n    method: 'GET',\n    path: '/',\n    handler: function (request, reply) {\n        reply.view('index',\n                   { socketio_host: (process.env.PUBLIC_IP+':'\n                                     +process.env.SOCKETIO_PORT)});\n    }\n});\n\nserver.register(require('./twitter'), function(err) {\n    if(err) throw err;\n    server.start();\n});\n\n```\n\n### twitter.js\n\nTwitter API\u306e\u8a8d\u8a3c\u60c5\u5831\u3084Socket.IO\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u306a\u3069\u306f[dotenv](https://www.npmjs.com/package/dotenv)\u304c\u7ba1\u7406\u3059\u308b`.env`\u30d5\u30a1\u30a4\u30eb\u306b\u5b9a\u7fa9\u3057\u307e\u3059\u3002`.env.default`\u3092\u30ea\u30cd\u30fc\u30e0\u3057\u3066\u4f7f\u3044\u307e\u3059\u3002\n\n```bash:~/node_apps/docker-hapi-twitter/.env\nPUBLIC_IP=\nSOCKETIO_PORT=8088\nAPI_PORT=8000\nTWITTER_KEY=\nTWITTER_SECRET=\nTWITTER_TOKEN=\nTWITTER_TOKEN_SECRET=\n```\n\ntwitter.js\u306bhapi\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u3057\u3066Twitter Streaming API\u306e[POST statuses/filter](https://dev.twitter.com/streaming/reference/post/statuses/filter)\u3092\u5b9f\u88c5\u3057\u3066\u3044\u304d\u307e\u3059\u3002Node.js\u306eTwitter\u7528\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u3044\u304f\u3064\u304b\u3042\u308a\u307e\u3059\u304c\u3001[twit](https://github.com/ttezel/twit)\u304c\u6c17\u306b\u5165\u3063\u3066\u3044\u307e\u3059\u3002\n\n```js:~/node_apps/docker-hapi-twitter/twitter.js\nvar Twit = require('twit'),\n    moment = require('moment-timezone'),\n    _ = require('lodash'),\n    colors = require('colors');\n\nvar T = new Twit({\n    consumer_key: process.env.TWITTER_KEY,\n    consumer_secret: process.env.TWITTER_SECRET,\n    access_token: process.env.TWITTER_TOKEN,\n    access_token_secret: process.env.TWITTER_TOKEN_SECRET\n});\n\nfunction formatDate(created_date){\n    return moment(new Date(created_date)).tz(\"Asia/Tokyo\").format();\n}\n\nfunction createUrl(screen_name,id_str){\n    return 'https://twitter.com/'+screen_name+'/status/'+id_str;\n}\n\nfunction pluckPath(data,path,key,suffix) {\n    return _.pluck(_.get(data,path),key)\n            .map(function(x) {return suffix+x})\n            .toString();\n}\n\nfunction extractData(s) {\n    return {\n        id: s.id_str,\n        url: createUrl(s.user.screen_name,s.id_str),\n        profile_image_url: s.user.profile_image_url,\n        created_at: formatDate(s.created_at),\n        lang: s.lang,\n        name: s.user.name,\n        screen_name: s.user.screen_name,\n        user_url: s.user.url || '',\n        text: s.text,\n        source: s.source,\n        expanded_url: _.get(s,'entities.urls[0].expanded_url',''),\n        hashtags: pluckPath(s,'entities.hashtags','text',\"#\"),\n        user_mentions: pluckPath(s,'entities.user_mentions','screen_name',\"@\"),\n        retweeted_status: s.retweeted_status ? true : false\n    }\n}\n\nfunction prettyPrint(tweet) {\n    console.log('tweet: '.magenta.bold + tweet.text);\n    console.log('by:'.green + ' @' + tweet.screen_name);\n    console.log('date:'.cyan + ' ' + tweet.created_at);\n    console.log('--------------------------------------------------------------------------------'.yellow);\n}\n\nexports.register = function(server,options,next) {\n\n    var io = require('socket.io')(server.select('twitter').listener),\n        track = 'babymetal',\n        stream = null,\n        users = [];\n\n    io.sockets.on('connection', function(socket) {\n\n        if(!_.includes(users, socket.id)) {\n            users.push(socket.id);\n        }\n\n        var con_msg = socket.id + ' connected, now: ' + users.length; \n        console.log(con_msg);\n        socket.emit('connected', con_msg);\n\n        socket.on('disconnect', function() {\n            _.pull(users, socket.id);\n            var discon_msg = socket.id + ' disconnected, now: ' + users.length; \n            console.log(discon_msg);\n        });\n\n        socket.on('start stream', function() {\n            console.log(socket.id + ' start twitter stream');\n            if (stream === null) {\n                stream =  T.stream('statuses/filter',\n                                   {track: track,\n                                    language: 'ja'});\n            };\n            stream.on('tweet', function(tweet) {\n                if(users.length > 0) {\n                    var data = extractData(tweet);\n                    prettyPrint(data);\n                    socket.emit('new tweet', data);\n                } else {\n                    stream.stop();\n                    stream = null;\n                    console.log('stop twitter stream');\n                }\n            });\n        });\n    });\n\n    next();\n};\n\nexports.register.attributes = {\n    name: 'hapi-twitter'\n};\n```\n\n### \u7c21\u5358\u306a\u4ed5\u69d8\n\nNode.js\u3068Socket.IO\u3001Twitter Streaming API\u306e\u4f7f\u3044\u65b9\u306f\u4ee5\u4e0b\u3092\u53c2\u8003\u306b\u3057\u3066\u306a\u308b\u3079\u304f\u52b9\u7387\u7684\u306a\u30ea\u30b9\u30ca\u30fc\u306e\u4f7f\u3044\u65b9\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n* [Node.js, Socket.io and the Twitter Streaming API in Heroku](http://ikertxu.tumblr.com/post/56686134143/node-js-socket-io-and-the-twitter-streaming-api)\n* [Using the Twitter Stream API to Visualize Tweets on Google Maps](http://blog.safe.com/2014/03/twitter-stream-api-map/)\n\n\u7c21\u5358\u306a\u4ed5\u69d8\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\n\n* \u30d6\u30e9\u30a6\u30b6\u304b\u3089Socket.IO\u306e\u63a5\u7d9a\u304c\u6765\u3066\u304b\u3089Twitter\u306e\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u958b\u59cb\u3059\u308b\n* \u63a5\u7d9a\u3057\u3066\u3044\u308bSocket.IO\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u306a\u304f\u306a\u3063\u305f\u3089Twitter\u306e\u30b9\u30c8\u30ea\u30fc\u30e0\u306f\u9589\u3058\u308b\n\n### \u6b21\u56de\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092Reagent\u3067\n\n\u30ad\u30fc\u30ef\u30fc\u30c9\u306f\u56fa\u5b9a\u3067`babymetal`\u306b\u3057\u3066\u3044\u307e\u3059\u3002Socket.IO\u30b5\u30fc\u30d0\u30fc\u304c\u3067\u304d\u305f\u306e\u3067\u3001\u6b21\u56de\u306f\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u753b\u9762\u304b\u3089\u5165\u529b\u3067\u304d\u308b\u3088\u3046\u306a\u30d5\u30a9\u30fc\u30e0\u3092[React](http://facebook.github.io/react/)\u3068[Reagent](http://holmsand.github.io/reagent/)\u3067\u4f5c\u6210\u3059\u308b\u4e88\u5b9a\u3067\u3059\u3002\u6700\u7d42\u7684\u306b\u306fClojure\u3068ClojureScript\u306e\u30d5\u30eb\u30b9\u30bf\u30c3\u30af\u306b\u3057\u305f\u3044\u3067\u3059\u3002\n\n### index.html\n\nindex.html\u306f[Handlebars](http://handlebarsjs.com/)\u3092\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u4f7f\u3044\u307e\u3057\u305f\u3002Socket.IO\u306e1.0\u304b\u3089`socket.io.js`\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306f[cdnjs](http://cdnjs.com/libraries/socket.io)\u3067\u914d\u5e03\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u4eca\u56de\u306fhapi\u304c\u30b5\u30fc\u30d0\u30fc\u3092\u8907\u6570\u8d77\u52d5\u3067\u304d\u308b\u3053\u3068\u306e\u78ba\u8a8d\u306e\u305f\u3081Socket.IO\u30b5\u30fc\u30d0\u30fc\u306e\u30dd\u30fc\u30c8\u3092Handlebars\u306b`{{socketio_host}}`\u3092\u6e21\u3057\u3066URL\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\n```html:~/node_apps/docker-hapi-twitter/templates/index.html\n<!DOCTYPE html>\n<html lang=\"ja\">\n  <head>\n    <meta charset=\"utf-8\">\n    <title>tweet</title>\n    <script src=\"//ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js\"></script>\n    <script src=\"http://{{socketio_host}}/socket.io/socket.io.js\"></script>\n    <script>\n      $(function() {\n        if(io !== undefined) {\n          var socket = io.connect(\"http://{{socketio_host}}\");\n          socket.on(\"connected\", function(msg) {\n            console.log(msg);\n            socket.emit(\"start stream\");\n          });\n          socket.on(\"new tweet\", function(tweet){\n            console.log(tweet);\n            var img = '<img src=\"' + tweet.profile_image_url + '\" width=\"48\" height=\"48\" />';\n            var tweetEl = \n              '<div>'\n              + '<a href=\"' + tweet.url + '\" target=\"_blank\">' + img + '</a>'\n              + '<span style=\"padding-left:15px\">' + tweet.name + ' @' + tweet.screen_name\n              + ' - ' + tweet.created_at\n              + '</span>'\n              + '<p>' + tweet.text  + '</p>'\n              + '</div>';\n            $(\"#tweets\").prepend(tweetEl);\n          });\n        }\n      });\n    </script>\n  </head>\n  <body>\n    <div id=\"tweets\"></div>\n  </body>\n</html>\n```\n\n## \u30d6\u30e9\u30a6\u30b6\u3067\u78ba\u8a8d\n\nDocker Compose\u3067\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash\n$ cd ~/node_apps/docker-hapi-twitter\n$ docker-compose up\n```\n\n\u30d6\u30e9\u30a6\u30b6\u3067hapi\u306eHTTP\u30b5\u30fc\u30d0\u30fc\u306eURL\u3092\u958b\u304f\u3068Socket.IO\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u30b5\u30fc\u30d0\u30fc\u3068\u63a5\u7d9a\u3092\u59cb\u3081\u307e\u3059\u3002\n\nhttp://xxx.xxx.xxx.xxx:8000/\n\n\u30b9\u30c8\u30ea\u30fc\u30e0\u3067\u53d6\u5f97\u3057\u305ftweet\u306f\u5c11\u3057\u3060\u3051\u6574\u5f62\u3057\u3066`#tweets`\u306ediv\u306bprepend\u3057\u307e\u3059\u3002tweet\u306e\u30c6\u30ad\u30b9\u30c8\u672c\u6587\u3068\u3001\u30e6\u30fc\u30b6\u30fc\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u30a4\u30e1\u30fc\u30b8\u3001tweet\u306eURL\u3001\u30e6\u30fc\u30b6\u30fc\u540d\u306a\u3069\u8868\u793a\u3057\u307e\u3059\u3002\n\n\n```html:~/node_apps/docker-hapi-twitter/templates/index.html\nvar tweetEl = \n  '<div>'\n  + '<a href=\"' + tweet.url + '\" target=\"_blank\">' + img + '</a>'\n  + '<span style=\"padding-left:15px\">' + tweet.name + ' @' + tweet.screen_name\n  + ' - ' + tweet.created_at\n  + '</span>'\n  + '<p>' + tweet.text  + '</p>'\n  + '</div>';\n```\n\n![tweet-stream.png](https://qiita-image-store.s3.amazonaws.com/0/43745/8fd5dd9e-3202-13be-5d27-d45d31282371.png)\n", "tags": ["Hapi.js8.6.1", "Socket.io1.3.5", "Twitter", "twit1.1.20", "Node.js0.12.4"]}