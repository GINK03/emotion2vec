{"context": " More than 1 year has passed since last update.\n\n\u69cb\u7bc9\u74b0\u5883\n\n\n\nName\nVersion\n\n\n\n\nUbuntu\n14.04 x64 (Server)\n\n\nJava\n7\n\n\nGlassfish\n4.0\n\n\nActiveMQ\n5.9.1\n\n\n\n\nActiveMQ\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u306a\u304a\u3001ActiveMQ 5.9.1\u306fJava8\u672a\u5bfe\u5fdc\u3067\u3001Java8\u74b0\u5883\u3060\u3068\u8d77\u52d5\u3057\u306a\u3044\u3063\u307d\u3044\u306e\u3067\u3001Java7\u3092\u5229\u7528\u3057\u307e\u3059\u3002\u624b\u3063\u53d6\u308a\u65e9\u304fPPA\u304b\u3089\u53d6\u5f97\u3057\u307e\u3059\u3002\n\nJava7\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo apt-get install software-properties-common\nsudo apt-add-repository ppa:webupd8team/java\nsudo apt-get update\nsudo apt-get install oracle-java7-installer\n\n\nActiveMQ\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\nActiveMQ\n# ActiveMQ\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nmkdir /tmp/activemq && cd /tmp/activemq\nwget http://ftp.tsukuba.wide.ad.jp/software/apache/activemq/5.9.1/apache-activemq-5.9.1-bin.tar.gz\ntar xzf apache-activemq-5.9.1-bin.tar.gz\nsudo mv apache-activemq-5.9.1 /opt/activemq\n\n# \u5c02\u7528\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\nsudo adduser --disabled-login --gecos 'ActiveMQ' activemq\nsudo chown -R activemq:activemq /opt/activemq\n\n# \u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u8a2d\u5b9a\nsudo ln -sf /opt/activemq/bin/activemq /etc/init.d/\nsudo update-rc.d activemq defaults 21\n\n# \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\nsudo /etc/init.d/activemq setup /etc/default/activemq\nsudo chown root:nogroup /etc/default/activemq\nsudo chmod 600 /etc/default/activemq\n\n#\n# \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u4fee\u6b63 \u8d77\u52d5\u30e6\u30fc\u30b6\u30fc\u7b49\n# ACTIVEMQ_USER=\"\"\n#   -> ACTIVEMQ_USER=\"activemq\"\n#\nsudo editor /etc/default/activemq\n\nsudo -u activemq -H chmod 600 /opt/activemq/conf/jmx.access\nsudo -u activemq -H chmod 600 /opt/activemq/conf/jmx.password\n\n# \u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\nsudo service activemq start\n\n\nActiveMQ\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u306b\u306f\u3001\u30d6\u30e9\u30a6\u30b6\u3067http://localhost:8161/\u306b\u30a2\u30af\u30bb\u30b9\u51fa\u6765\u308c\u3070OK\u3067\u3059\u3002\u521d\u671fID/PW\u306fadmin/admin\u3067\u3059\u3002\n\nGlassFish\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nJava7\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3042\u308b\u3001\u307e\u305f\u306fJAVA_HOME\u304c\u8a2d\u5b9a\u3057\u3066\u3042\u308b\u3053\u3068\u304c\u524d\u63d0\u6761\u4ef6\u3067\u3059\u3002\n\nGlassFish\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n# GlassFish\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nmkdir /tmp/glassfish && cd /tmp/glassfish\nwget http://download.java.net/glassfish/4.0/release/glassfish-4.0.zip\nunzip glassfish-4.0.zip\nsudo mv glassfish4 /opt/glassfish\n\n# \u5c02\u7528\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\nsudo adduser --disabled-login --gecos 'GlassFish' glassfish\nsudo chown -R glassfish:glassfish /opt/glassfish\n\n# \u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\uff08gist\u304b\u3089\uff09\ncd $HOME\nwget https://gist.githubusercontent.com/noxi515/ac07c72f9337b6336ad8/raw/fd13ddaf729ac494e97e1ec3bf72bcbec1840735/gistfile1.txt\nsudo mv gistfile1.txt /etc/init.d/glassfish\nsudo chmod +x /etc/init.d/glassfish\nsudo update-rc.d glassfish defaults 21\n\n# \u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\nsudo service glassfish start\n\n\nActiveMQ Resource Adapter\nasadmin\u304c\u30d1\u30b9\u306b\u901a\u3063\u3066\u306a\u3044\u3068\u8f9b\u3044\u306e\u3067\u3001\u30d1\u30b9\u3092\u901a\u3057\u307e\u3059\u3002\n\nasadmin\u3092\u30d1\u30b9\u306b\u8ffd\u52a0\ncd $HOME\necho '# GlassFish' >> .bash_profile\necho 'GF_HOME=/opt/glassfish' >> .bash_profile\necho 'PATH=$PATH:$GF_HOME/bin' >> .bash_profile\nsource .bash_profile\n\n\n\u30ea\u30bd\u30fc\u30b9\u30a2\u30c0\u30d7\u30bf\u30fc\u3092GlassFish\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u307e\u3059\u3002\n\nResourceAdapter\n# ActiveMQ ResourceAdapter\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nwget http://repo1.maven.org/maven2/org/apache/activemq/activemq-rar/5.9.1/activemq-rar-5.9.1.rar\n\n# Glassfish\u306b'activemq'\u3068\u3044\u3046\u540d\u524d\u3067\u30c7\u30d7\u30ed\u30a4\nasadmin deploy --name activemq activemq-rar-5.9.1.rar\n\n# ActiveMQ\u30ea\u30bd\u30fc\u30b9\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u4f5c\u6210\nasadmin create-resource-adapter-config --threadpoolid thread-pool-1 --property ServerUrl=\\\"tcp://localhost:61616\\\":UserName=admin:Password=admin activemq\n\n# \u30b3\u30cd\u30af\u30bf\u30fc\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb\u4f5c\u6210\nasadmin create-connector-connection-pool --raname activemq --connectiondefinition javax.jms.ConnectionFactory --ping true jms/activeMQConnectionFactory-Connection-Pool\n\n# \u30b3\u30cd\u30af\u30bf\u30fc\u4f5c\u6210\nasadmin create-connector-resource --poolname jms/activeMQConnectionFactory-Connection-Pool --enabled true jms/activeMQConnectionFactory\n\n# JMS\u306e\u7ba1\u7406\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\nasadmin create-admin-object --raname activemq --restype javax.jms.Queue --property PhysicalName=jms/queue/sample jms/queue/sample\n\n\n\u30ea\u30bd\u30fc\u30b9\u30a2\u30c0\u30d7\u30bf\u30fc\u3092GlassFish\u306b\u30c7\u30d7\u30ed\u30a4\u30fb\u8a2d\u5b9a\u3059\u308b\u3068\u3053\u308d\u306fGlassFish\u306e\u753b\u9762\u304b\u3089\u3082\u3082\u3061\u308d\u3093\u51fa\u6765\u307e\u3059\u3002\n\u7ba1\u7406\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\u6642\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u306bPhysicalName=jms/queue/sample\u3092\u8a2d\u5b9a\u3057\u306a\u3044\u3068\u3001@Resource\u3067\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u3055\u308c\u308bQueue\u5185\u90e8\u304cnull\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1\n\u30bd\u30fc\u30b9\u306f\u3053\u3061\u3089\u3002\n\nDeploy\ngit clone https://github.com/noxi515/javaee-jms-sample.git\ncd javaee-jms-sample\n\n# \u30d3\u30eb\u30c9\nmvn package\n\n# \u30c7\u30d7\u30ed\u30a4\nasadmin deploy target/javaee-jms-1.0-SNAPSHOT.war\n\n\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\n\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u3059\u308b\u305f\u3081\u3060\u3051\u306eBean\u3092\u4f5c\u308a\u307e\u3059\u3002\n\u5148\u306b\u4f5c\u6210\u3057\u305fActiveMQ\u3068\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3084\u7ba1\u7406\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u53d6\u5f97\u3057\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3057\u307e\u3059\u3002\n\nMessageProducerBean.java\npackage jp.noxi.sample.ejb;\n\nimport java.io.Serializable;\n\nimport javax.annotation.Nonnull;\n\n/**\n * Message sender interface\n */\npublic interface MessageProducerBean extends Serializable {\n\n    /**\n     * Send message.\n     */\n    void send(@Nonnull String message) throws Exception;\n}\n\n\n\nMessageProducerBeanImpl.java\npackage jp.noxi.sample.ejb;\n\nimport javax.annotation.Nonnull;\nimport javax.annotation.Resource;\nimport javax.ejb.Stateless;\nimport javax.jms.Connection;\nimport javax.jms.ConnectionFactory;\nimport javax.jms.MessageProducer;\nimport javax.jms.Queue;\nimport javax.jms.Session;\nimport javax.jms.TextMessage;\n\n/**\n * Message sender implementation\n */\n@Stateless\npublic class MessageProducerBeanImpl implements MessageProducerBean {\n\n    private static final long serialVersionUID = 1L;\n\n    // \u4e0a\u3067\u4f5c\u6210\u3057\u305f\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u30a4\u30f3\u30b8\u30a7\u30af\u30c8\u3055\u308c\u308b\n    @Resource(mappedName = \"jms/activeMQConnectionFactory\")\n    private ConnectionFactory connectionFactory;\n\n    // \u4e0a\u3067\u4f5c\u6210\u3057\u305f\u7ba1\u7406\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\uff08\u30ad\u30e5\u30fc\uff09\u304c\u30a4\u30f3\u30b8\u30a7\u30af\u30c8\u3055\u308c\u308b\n    @Resource(mappedName = \"jms/queue/sample\")\n    private Queue queue;\n\n    @Override\n    public void send(@Nonnull String text) throws Exception {\n        try (Connection connection = connectionFactory.createConnection();\n             Session session = connection.createSession(true, 0);\n             MessageProducer producer = session.createProducer(queue)) {\n            TextMessage message = session.createTextMessage(text);\n\n            // MQ\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\n            producer.send(message);\n        }\n    }\n\n}\n\n\n@Resource\u3092\u4ed8\u4e0e\u3059\u308b\u3053\u3068\u3067GlassFish\u4e0a\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002javax.naming.InitialContext#lookup\u7d4c\u7531\u3067\u3082\u53d6\u5f97\u51fa\u6765\u308b\u306e\u3067\u3001\u52d5\u7684\u306b\u53d6\u5f97\u3057\u305f\u3044\u5834\u5408\u306f\u3053\u3061\u3089\u3002\n\u6b63\u5e38\u306b\u9001\u4fe1\u51fa\u6765\u308c\u3070\u3001http://localhost:8161/admin/queues.jsp \u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001ActiveMQ\u306e\u7ba1\u7406\u753b\u9762\u4e0a\u3067\u30ad\u30e5\u30fc\u306b\u8caf\u307e\u3063\u3066\u3044\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u6570\u304c\u898b\u3089\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1\n\u4e0a\u3067\u9001\u4fe1\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308bMessageBean\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nSampleMessageBean.java\npackage jp.noxi.sample.jms;\n\nimport javax.ejb.ActivationConfigProperty;\nimport javax.ejb.MessageDriven;\nimport javax.ejb.Stateless;\nimport javax.jms.JMSException;\nimport javax.jms.Message;\nimport javax.jms.MessageListener;\nimport javax.jms.TextMessage;\n\n/**\n * Message receiver\n */\n@MessageDriven(activationConfig = {\n        @ActivationConfigProperty(propertyName = \"destinationType\", propertyValue = \"javax.jms.Queue\"),\n        @ActivationConfigProperty(propertyName = \"destination\", propertyValue = \"jms/queue/sample\"),\n})\npublic class SampleMessageBean implements MessageListener {\n\n    @Override\n    public void onMessage(Message message) {\n        try {\n            String text = ((TextMessage) message).getText();\n            System.out.println(text);\n        } catch (JMSException e) {\n            e.printStackTrace();\n        }\n    }\n\n}\n\n\n@MessageDriven\u3092\u4ed8\u4e0e\u3059\u308b\u3053\u3068\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002@ActivationConfigProperty\u3067\u8a73\u7d30\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\nActiveMQ\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u306b\u3042\u305f\u308a\u3001\u5fc5\u8981\u306a\u30d7\u30ed\u30d1\u30c6\u30a3\u30fc\u306fdestination\u3068destinationType\u3067\u3059\u3002\n\u3053\u306e\u307e\u307e\u30c7\u30d7\u30ed\u30a4\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001GlassFish\u306f\u6b8b\u5ff5\u306a\u3053\u3068\u306b\u4f5c\u6210\u3057\u305fActiveMQ\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3067\u306f\u306a\u304f\u3001GlassFish\u540c\u5c01\u306eOpenMQ\u306e\u5b9f\u88c5\u3092\u4f7f\u304a\u3046\u3068\u3057\u3066\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3059\u3002\u3053\u306eSampleMessageBean\u3067\u5229\u7528\u3059\u308b\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u7b49\u306e\u8a2d\u5b9a\u3092\u660e\u793a\u7684\u306b\u793a\u3059\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nsrc/java/webapp/WEB-INF/glassfish-ejb-jar.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE glassfish-ejb-jar PUBLIC \"-//GlassFish.org//DTD GlassFish Application Server 3.1 EJB 3.1//EN\" \"http://glassfish.org/dtds/glassfish-ejb-jar_3_1-1.dtd\">\n<glassfish-ejb-jar>\n    <enterprise-beans>\n        <ejb>\n            <ejb-name>SampleMessageBean</ejb-name>\n            <mdb-connection-factory>\n                <jndi-name>jms/activeMQConnectionFactory</jndi-name>\n            </mdb-connection-factory>\n            <mdb-resource-adapter>\n                <resource-adapter-mid>activemq</resource-adapter-mid>\n            </mdb-resource-adapter>\n        </ejb>\n    </enterprise-beans>\n</glassfish-ejb-jar>\n\n\n\u30d9\u30f3\u30c0\u30fc\u5b9f\u88c5\u306b\u983c\u308b\u306e\u306f\u766a\u3067\u3059\u304c\u3001\u3053\u306e\u3088\u3046\u306bEJB\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\u9001\u53d7\u4fe1\u3092\u8a66\u3057\u3066\u307f\u308b\n\u4eca\u56de\u4f5c\u6210\u3057\u305f\u30b5\u30f3\u30d7\u30eb\u306fURL\u53e9\u3051\u3070\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\nhttp://localhost:8080/javaee-jms-1.0-SNAPSHOT/sample?message=hoge\n\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308c\u3070\u3001hoge\u304c\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u672c\u6587\u3068\u306a\u3063\u3066\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n\u305f\u3060\u3057\u30ed\u30b0\u306e\u8a2d\u5b9a\u3068\u304b\u5168\u304f\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u304d\u3061\u3093\u3068\u53d7\u4fe1\u3055\u308c\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u306f\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u6539\u4fee\u3059\u308b\u304b\u3001ActiveMQ\u306e\u7ba1\u7406\u753b\u9762\u3067Dequeued\u304c\u5897\u3048\u3066\u3044\u304f\u3053\u3068\u3092\u898b\u3066\u4e0b\u3055\u3044\u3002\n\n\u7d42\u308f\u308a\u306b\nJavaEE\u3068\u304b\u3001Qiita\u3058\u3083\u4eba\u6c17\u306a\u3044\u3088\u306d\u3002\u304b\u306a\u3057\u3044\u3002\n\n# \u69cb\u7bc9\u74b0\u5883\n| Name | Version |\n|---|---|\n| Ubuntu | 14.04 x64 (Server) |\n| Java | 7 |\n| Glassfish | 4.0 |\n| ActiveMQ | 5.9.1 |\n\n\n# ActiveMQ\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u306a\u304a\u3001ActiveMQ 5.9.1\u306fJava8\u672a\u5bfe\u5fdc\u3067\u3001Java8\u74b0\u5883\u3060\u3068\u8d77\u52d5\u3057\u306a\u3044\u3063\u307d\u3044\u306e\u3067\u3001Java7\u3092\u5229\u7528\u3057\u307e\u3059\u3002\u624b\u3063\u53d6\u308a\u65e9\u304fPPA\u304b\u3089\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n\n```bash:Java7\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo apt-get install software-properties-common\nsudo apt-add-repository ppa:webupd8team/java\nsudo apt-get update\nsudo apt-get install oracle-java7-installer\n```\n\nActiveMQ\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\n```bash:ActiveMQ\n# ActiveMQ\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nmkdir /tmp/activemq && cd /tmp/activemq\nwget http://ftp.tsukuba.wide.ad.jp/software/apache/activemq/5.9.1/apache-activemq-5.9.1-bin.tar.gz\ntar xzf apache-activemq-5.9.1-bin.tar.gz\nsudo mv apache-activemq-5.9.1 /opt/activemq\n\n# \u5c02\u7528\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\nsudo adduser --disabled-login --gecos 'ActiveMQ' activemq\nsudo chown -R activemq:activemq /opt/activemq\n\n# \u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u8a2d\u5b9a\nsudo ln -sf /opt/activemq/bin/activemq /etc/init.d/\nsudo update-rc.d activemq defaults 21\n\n# \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\nsudo /etc/init.d/activemq setup /etc/default/activemq\nsudo chown root:nogroup /etc/default/activemq\nsudo chmod 600 /etc/default/activemq\n\n#\n# \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u4fee\u6b63 \u8d77\u52d5\u30e6\u30fc\u30b6\u30fc\u7b49\n# ACTIVEMQ_USER=\"\"\n#   -> ACTIVEMQ_USER=\"activemq\"\n#\nsudo editor /etc/default/activemq\n\nsudo -u activemq -H chmod 600 /opt/activemq/conf/jmx.access\nsudo -u activemq -H chmod 600 /opt/activemq/conf/jmx.password\n\n# \u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\nsudo service activemq start\n```\n\nActiveMQ\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u306b\u306f\u3001\u30d6\u30e9\u30a6\u30b6\u3067[http://localhost:8161/](http://localhost:8161/)\u306b\u30a2\u30af\u30bb\u30b9\u51fa\u6765\u308c\u3070OK\u3067\u3059\u3002\u521d\u671fID/PW\u306fadmin/admin\u3067\u3059\u3002\n\n\n# GlassFish\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nJava7\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3042\u308b\u3001\u307e\u305f\u306f`JAVA_HOME`\u304c\u8a2d\u5b9a\u3057\u3066\u3042\u308b\u3053\u3068\u304c\u524d\u63d0\u6761\u4ef6\u3067\u3059\u3002\n\n## GlassFish\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\n```bash\n# GlassFish\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nmkdir /tmp/glassfish && cd /tmp/glassfish\nwget http://download.java.net/glassfish/4.0/release/glassfish-4.0.zip\nunzip glassfish-4.0.zip\nsudo mv glassfish4 /opt/glassfish\n\n# \u5c02\u7528\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\nsudo adduser --disabled-login --gecos 'GlassFish' glassfish\nsudo chown -R glassfish:glassfish /opt/glassfish\n\n# \u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\uff08gist\u304b\u3089\uff09\ncd $HOME\nwget https://gist.githubusercontent.com/noxi515/ac07c72f9337b6336ad8/raw/fd13ddaf729ac494e97e1ec3bf72bcbec1840735/gistfile1.txt\nsudo mv gistfile1.txt /etc/init.d/glassfish\nsudo chmod +x /etc/init.d/glassfish\nsudo update-rc.d glassfish defaults 21\n\n# \u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\nsudo service glassfish start\n```\n\n## ActiveMQ Resource Adapter\n\nasadmin\u304c\u30d1\u30b9\u306b\u901a\u3063\u3066\u306a\u3044\u3068\u8f9b\u3044\u306e\u3067\u3001\u30d1\u30b9\u3092\u901a\u3057\u307e\u3059\u3002\n\n```bash:asadmin\u3092\u30d1\u30b9\u306b\u8ffd\u52a0\ncd $HOME\necho '# GlassFish' >> .bash_profile\necho 'GF_HOME=/opt/glassfish' >> .bash_profile\necho 'PATH=$PATH:$GF_HOME/bin' >> .bash_profile\nsource .bash_profile\n```\n\n\u30ea\u30bd\u30fc\u30b9\u30a2\u30c0\u30d7\u30bf\u30fc\u3092GlassFish\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u307e\u3059\u3002\n\n```bash:ResourceAdapter\n# ActiveMQ ResourceAdapter\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nwget http://repo1.maven.org/maven2/org/apache/activemq/activemq-rar/5.9.1/activemq-rar-5.9.1.rar\n\n# Glassfish\u306b'activemq'\u3068\u3044\u3046\u540d\u524d\u3067\u30c7\u30d7\u30ed\u30a4\nasadmin deploy --name activemq activemq-rar-5.9.1.rar\n\n# ActiveMQ\u30ea\u30bd\u30fc\u30b9\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u4f5c\u6210\nasadmin create-resource-adapter-config --threadpoolid thread-pool-1 --property ServerUrl=\\\"tcp://localhost:61616\\\":UserName=admin:Password=admin activemq\n\n# \u30b3\u30cd\u30af\u30bf\u30fc\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb\u4f5c\u6210\nasadmin create-connector-connection-pool --raname activemq --connectiondefinition javax.jms.ConnectionFactory --ping true jms/activeMQConnectionFactory-Connection-Pool\n\n# \u30b3\u30cd\u30af\u30bf\u30fc\u4f5c\u6210\nasadmin create-connector-resource --poolname jms/activeMQConnectionFactory-Connection-Pool --enabled true jms/activeMQConnectionFactory\n\n# JMS\u306e\u7ba1\u7406\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\nasadmin create-admin-object --raname activemq --restype javax.jms.Queue --property PhysicalName=jms/queue/sample jms/queue/sample\n```\n\n\u30ea\u30bd\u30fc\u30b9\u30a2\u30c0\u30d7\u30bf\u30fc\u3092GlassFish\u306b\u30c7\u30d7\u30ed\u30a4\u30fb\u8a2d\u5b9a\u3059\u308b\u3068\u3053\u308d\u306fGlassFish\u306e\u753b\u9762\u304b\u3089\u3082\u3082\u3061\u308d\u3093\u51fa\u6765\u307e\u3059\u3002\n\u7ba1\u7406\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\u6642\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u306b`PhysicalName=jms/queue/sample`\u3092\u8a2d\u5b9a\u3057\u306a\u3044\u3068\u3001@Resource\u3067\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u3055\u308c\u308bQueue\u5185\u90e8\u304cnull\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n# \u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1\n\n\u30bd\u30fc\u30b9\u306f[\u3053\u3061\u3089](https://github.com/noxi515/javaee-jms-sample)\u3002\n\n```bash:Deploy\ngit clone https://github.com/noxi515/javaee-jms-sample.git\ncd javaee-jms-sample\n\n# \u30d3\u30eb\u30c9\nmvn package\n\n# \u30c7\u30d7\u30ed\u30a4\nasadmin deploy target/javaee-jms-1.0-SNAPSHOT.war\n```\n\n## \u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\n\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u3059\u308b\u305f\u3081\u3060\u3051\u306eBean\u3092\u4f5c\u308a\u307e\u3059\u3002\n\u5148\u306b\u4f5c\u6210\u3057\u305fActiveMQ\u3068\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3084\u7ba1\u7406\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u53d6\u5f97\u3057\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3057\u307e\u3059\u3002\n\n```MessageProducerBean.java\npackage jp.noxi.sample.ejb;\n\nimport java.io.Serializable;\n\nimport javax.annotation.Nonnull;\n\n/**\n * Message sender interface\n */\npublic interface MessageProducerBean extends Serializable {\n\n    /**\n     * Send message.\n     */\n    void send(@Nonnull String message) throws Exception;\n}\n```\n\n```MessageProducerBeanImpl.java\npackage jp.noxi.sample.ejb;\n\nimport javax.annotation.Nonnull;\nimport javax.annotation.Resource;\nimport javax.ejb.Stateless;\nimport javax.jms.Connection;\nimport javax.jms.ConnectionFactory;\nimport javax.jms.MessageProducer;\nimport javax.jms.Queue;\nimport javax.jms.Session;\nimport javax.jms.TextMessage;\n\n/**\n * Message sender implementation\n */\n@Stateless\npublic class MessageProducerBeanImpl implements MessageProducerBean {\n\n    private static final long serialVersionUID = 1L;\n\n    // \u4e0a\u3067\u4f5c\u6210\u3057\u305f\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u30a4\u30f3\u30b8\u30a7\u30af\u30c8\u3055\u308c\u308b\n    @Resource(mappedName = \"jms/activeMQConnectionFactory\")\n    private ConnectionFactory connectionFactory;\n\n    // \u4e0a\u3067\u4f5c\u6210\u3057\u305f\u7ba1\u7406\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\uff08\u30ad\u30e5\u30fc\uff09\u304c\u30a4\u30f3\u30b8\u30a7\u30af\u30c8\u3055\u308c\u308b\n    @Resource(mappedName = \"jms/queue/sample\")\n    private Queue queue;\n\n    @Override\n    public void send(@Nonnull String text) throws Exception {\n        try (Connection connection = connectionFactory.createConnection();\n             Session session = connection.createSession(true, 0);\n             MessageProducer producer = session.createProducer(queue)) {\n            TextMessage message = session.createTextMessage(text);\n\n            // MQ\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\n            producer.send(message);\n        }\n    }\n\n}\n```\n\n`@Resource`\u3092\u4ed8\u4e0e\u3059\u308b\u3053\u3068\u3067GlassFish\u4e0a\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002`javax.naming.InitialContext#lookup`\u7d4c\u7531\u3067\u3082\u53d6\u5f97\u51fa\u6765\u308b\u306e\u3067\u3001\u52d5\u7684\u306b\u53d6\u5f97\u3057\u305f\u3044\u5834\u5408\u306f\u3053\u3061\u3089\u3002\n\n\u6b63\u5e38\u306b\u9001\u4fe1\u51fa\u6765\u308c\u3070\u3001http://localhost:8161/admin/queues.jsp \u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001ActiveMQ\u306e\u7ba1\u7406\u753b\u9762\u4e0a\u3067\u30ad\u30e5\u30fc\u306b\u8caf\u307e\u3063\u3066\u3044\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u6570\u304c\u898b\u3089\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n## \u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1\n\n\u4e0a\u3067\u9001\u4fe1\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308bMessageBean\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```SampleMessageBean.java\npackage jp.noxi.sample.jms;\n\nimport javax.ejb.ActivationConfigProperty;\nimport javax.ejb.MessageDriven;\nimport javax.ejb.Stateless;\nimport javax.jms.JMSException;\nimport javax.jms.Message;\nimport javax.jms.MessageListener;\nimport javax.jms.TextMessage;\n\n/**\n * Message receiver\n */\n@MessageDriven(activationConfig = {\n        @ActivationConfigProperty(propertyName = \"destinationType\", propertyValue = \"javax.jms.Queue\"),\n        @ActivationConfigProperty(propertyName = \"destination\", propertyValue = \"jms/queue/sample\"),\n})\npublic class SampleMessageBean implements MessageListener {\n\n    @Override\n    public void onMessage(Message message) {\n        try {\n            String text = ((TextMessage) message).getText();\n            System.out.println(text);\n        } catch (JMSException e) {\n            e.printStackTrace();\n        }\n    }\n\n}\n```\n\n`@MessageDriven`\u3092\u4ed8\u4e0e\u3059\u308b\u3053\u3068\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002`@ActivationConfigProperty`\u3067\u8a73\u7d30\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\nActiveMQ\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u306b\u3042\u305f\u308a\u3001\u5fc5\u8981\u306a\u30d7\u30ed\u30d1\u30c6\u30a3\u30fc\u306f`destination`\u3068`destinationType`\u3067\u3059\u3002\n\n\u3053\u306e\u307e\u307e\u30c7\u30d7\u30ed\u30a4\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001GlassFish\u306f\u6b8b\u5ff5\u306a\u3053\u3068\u306b\u4f5c\u6210\u3057\u305fActiveMQ\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3067\u306f\u306a\u304f\u3001GlassFish\u540c\u5c01\u306eOpenMQ\u306e\u5b9f\u88c5\u3092\u4f7f\u304a\u3046\u3068\u3057\u3066\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3059\u3002\u3053\u306eSampleMessageBean\u3067\u5229\u7528\u3059\u308b\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u7b49\u306e\u8a2d\u5b9a\u3092\u660e\u793a\u7684\u306b\u793a\u3059\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```src/java/webapp/WEB-INF/glassfish-ejb-jar.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE glassfish-ejb-jar PUBLIC \"-//GlassFish.org//DTD GlassFish Application Server 3.1 EJB 3.1//EN\" \"http://glassfish.org/dtds/glassfish-ejb-jar_3_1-1.dtd\">\n<glassfish-ejb-jar>\n    <enterprise-beans>\n        <ejb>\n            <ejb-name>SampleMessageBean</ejb-name>\n            <mdb-connection-factory>\n                <jndi-name>jms/activeMQConnectionFactory</jndi-name>\n            </mdb-connection-factory>\n            <mdb-resource-adapter>\n                <resource-adapter-mid>activemq</resource-adapter-mid>\n            </mdb-resource-adapter>\n        </ejb>\n    </enterprise-beans>\n</glassfish-ejb-jar>\n```\n\n\u30d9\u30f3\u30c0\u30fc\u5b9f\u88c5\u306b\u983c\u308b\u306e\u306f\u766a\u3067\u3059\u304c\u3001\u3053\u306e\u3088\u3046\u306bEJB\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n# \u9001\u53d7\u4fe1\u3092\u8a66\u3057\u3066\u307f\u308b\n\n\u4eca\u56de\u4f5c\u6210\u3057\u305f[\u30b5\u30f3\u30d7\u30eb](https://github.com/noxi515/javaee-jms-sample)\u306fURL\u53e9\u3051\u3070\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n`http://localhost:8080/javaee-jms-1.0-SNAPSHOT/sample?message=hoge`\n\n\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308c\u3070\u3001`hoge`\u304c\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u672c\u6587\u3068\u306a\u3063\u3066\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n\u305f\u3060\u3057\u30ed\u30b0\u306e\u8a2d\u5b9a\u3068\u304b\u5168\u304f\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u304d\u3061\u3093\u3068\u53d7\u4fe1\u3055\u308c\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u306f\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u6539\u4fee\u3059\u308b\u304b\u3001ActiveMQ\u306e\u7ba1\u7406\u753b\u9762\u3067Dequeued\u304c\u5897\u3048\u3066\u3044\u304f\u3053\u3068\u3092\u898b\u3066\u4e0b\u3055\u3044\u3002\n\n# \u7d42\u308f\u308a\u306b\n\nJavaEE\u3068\u304b\u3001Qiita\u3058\u3083\u4eba\u6c17\u306a\u3044\u3088\u306d\u3002\u304b\u306a\u3057\u3044\u3002\n", "tags": ["Java7", "glassfish4.0", "ActiveMQ5.9.1"]}