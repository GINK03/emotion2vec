{"tags": ["googleapi", "Android"], "context": " More than 1 year has passed since last update.\n\n\u6982\u8981\n\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089apk\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u5b9f\u9a13\u306e\u30e1\u30e2\u3002\n\n\u4f55\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\uff1f\n\nCircleCI\u306a\u3069\u3068\u9023\u643a\u3059\u308c\u3070\u4eca\u307e\u3067\u624b\u4f5c\u696d\u3067\u3084\u3063\u3066\u3044\u305fGooglePlay\u3078\u306eapk\u306e\u30a2\u30c3\u30ed\u30fc\u30c9\u304cPullRequest\u30d9\u30fc\u30b9\u3067\u81ea\u52d5\u3067\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\u30a2\u30d7\u30ea\u306e\u8aac\u660e\u6587\u3001\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u304cGit\u3067\u7ba1\u7406\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u305d\u3046\u3002\n\u03b1\u3001\u03b2\u30c6\u30b9\u30c8\u304c\u3084\u308a\u3084\u3059\u304f\u306a\u308b\u304b\u3082\u3002\nHubot\u306b\u3001android deploy\u3068\u304b\u8a71\u3057\u304b\u3051\u308b\u3068production\u306b\u30a2\u30d7\u30ea\u3092\u516c\u958b\u3068\u304b\u3082\u3067\u304d\u305d\u3046\u3002\n\n\nGoogle APIs Client Library\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u8272\u3005\u3068\u8abf\u3079\u305f\u7d50\u679c\u3001 Python\u306eGoogle APIs Client Library\u3092\u4f7f\u3046\u306e\u304c\u4e00\u756a\u7c21\u5358\u306b\u5b9f\u73fe\u3067\u304d\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306fpip\u3067\u3002\n$ pip install google-api-python-client\n\n\n\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u767b\u9332\nOAuth\u8a8d\u8a3c\u306b\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u5fc5\u8981\u306b\u306a\u308b\u306e\u3067\u4f5c\u6210\u3059\u308b\u3002\n1.DeveloperAPI\u3068\u30ea\u30f3\u30af\nDeveloper Console\u306e\u5de6\u30e1\u30cb\u30e5\u30fc\u300c\u8a2d\u5b9a\u2192API\u30a2\u30af\u30bb\u30b9\u300d\u3067DeveloperAPI\u3092\u30aa\u30f3\u306b\u3059\u308b\nhttps://play.google.com/apps/publish/#ApiAccessPlace\n\n2.\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u4f5c\u6210\nAPI\u30a2\u30af\u30bb\u30b9\u30da\u30fc\u30b8\u306e\u4e0b\u306e\u65b9\u306e\u300c\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\n3.Developer Console\u306b\u79fb\u52d5 \nDeveloper Console\u3078\u306e\u30ea\u30f3\u30af\u304b\u3089Developer Console\u3078\u79fb\u52d5\u3057\u3001\u300cAPI\u3068\u8a8d\u8a3c\u300d\u3067\u300c\u65b0\u3057\u3044\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3002\n\n\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u30c1\u30a7\u30c3\u30af\u3057\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n\u4f5c\u6210\u304c\u5b8c\u4e86\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u3001Google Play Android Developer-1234abcd.p12\u3068\u3044\u3046key\u30d5\u30a1\u30a4\u30eb\u304c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u308b\u3002\n\n\u8a8d\u8a3c\u60c5\u5831\u306b\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3068\u3044\u3046\u9805\u76ee(\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u3001\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3001\u8a3c\u660e\u66f8\u30d5\u30a3\u30f3\u30ac\u30fc\u30d7\u30ea\u30f3\u30c8)\u3068\u3044\u3046\u9805\u76ee\u304c\u51fa\u6765\u3066\u3044\u308c\u3070OK\u3002\n\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306e\u5b9f\u884c\nGoogle Play\u306bapk\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u308a\u3001\u7d39\u4ecb\u6587\u3092\u66f4\u65b0\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u304cGitHub\u306b\u306a\u308b\u306e\u3067\u305d\u308c\u3092\u3068\u308a\u3042\u3048\u305aclone\u3057\u3066\u307f\u308b\u3002\n$ git clone git@github.com:googlesamples/android-play-publisher-api.git\n\nREADME\u306eFirst request using OAuth2: Service accounts\u3092\u53c2\u8003\u306b\u4f5c\u696d\u3059\u308b\u3002\n1.basic_list_apks_service_account.py\u3092\u7de8\u96c6\u3057\u3066\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u8ffd\u52a0\u3059\u308b\n26\u884c\u76ee\u306e\u4ee5\u4e0b\u306e\u90e8\u5206\u3092\u7de8\u96c6\u3059\u308b\u3002\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306f\u3001Developer Console\u306e\u8a8d\u8a3c\u60c5\u5831\u306b\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u3002  \nSERVICE_ACCOUNT_EMAIL = (\n    'ENTER_YOUR_SERVICE_ACCOUNT_EMAIL_HERE@developer.gserviceaccount.com')\n\n2.key\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\n38\u884c\u76ee\u3067key\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u308b\u306e\u3067\u3001\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u6210\u3057\u305f\u6642\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305fkey\u30d5\u30a1\u30a4\u30eb\u306b\u5909\u66f4\u3057(key\u30d5\u30a1\u30a4\u30eb\u306e\u540d\u524d\u3092\u5909\u66f4\u3057\u3066\u3057\u307e\u3063\u3066\u3082\u826f\u3044)\u3001key\u30d5\u30a1\u30a4\u30eb\u3092\u540c\u4e00\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304f\u3002\n3.\u30b5\u30f3\u30d7\u30eb\u3092\u5b9f\u884c\u3059\u308b\n$ python basic_list_apks_service_account.py com.myapp.package\n\n\u30a8\u30e9\u30fc\u304c\u3067\u308b\u3002\n$ python basic_list_apks_service_account.py jp.horie1024.myapp\nTraceback (most recent call last):\n  File \"basic_list_apks_service_account.py\", line 78, in <module>\n    main()\n  File \"basic_list_apks_service_account.py\", line 49, in main\n    scope='https://www.googleapis.com/auth/androidpublisher')\n  File \"/usr/local/lib/python2.7/site-packages/oauth2client/util.py\", line 132, in positional_wrapper\n    return wrapped(*args, **kwargs)\n  File \"/usr/local/lib/python2.7/site-packages/oauth2client/client.py\", line 1364, in __init__\n    _RequireCryptoOrDie()\n  File \"/usr/local/lib/python2.7/site-packages/oauth2client/client.py\", line 1318, in _RequireCryptoOrDie\n    raise CryptoUnavailableError('No crypto library available')\noauth2client.client.CryptoUnavailableError: No crypto library available\n\npy-openssl\u304c\u5fc5\u8981\u3089\u3057\u3044\u306e\u3067pip\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ pip install PyOpenSSL\n\n\u3082\u3046\u4e00\u5ea6\u5b9f\u884c\u3002\n$ python basic_list_apks_service_account.py jp.horie1024.myapp\nversionCode: 1, binary.sha1: b650430a19joihfel2lasiwbf38188d8d\n\n\u3046\u307e\u304f\u3044\u3063\u305f\u3002\n\nGooglePlay\u306b\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089apk\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u307f\u308b\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306b\u306f\u3001\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f7f\u7528\u3057\u3066apk\u3092GooglePlay\u3078\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u306a\u304b\u3063\u305f\u306e\u3067\u5e7e\u3064\u304b\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u53c2\u8003\u306b\u66f8\u3044\u3066\u307f\u308b\u3002\nclone\u3057\u3066\u304d\u305f\u30b5\u30f3\u30d7\u30eb\u306b\u306f\u3001\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f7f\u7528\u3057\u306a\u3044\u3067apk\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u3068\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f7f\u7528\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u304c\u3042\u308b\u306e\u3067\u4e8c\u3064\u3092\u8aad\u307f\u304f\u3089\u3079\u3066\u307f\u308b\u3002\u4e8c\u3064\u306e\u30b5\u30f3\u30d7\u30eb\u306f\u3001\u3069\u3061\u3089\u3082service\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u3066\u3044\u3066\u3001\u8a8d\u8a3c\u90e8\u5206\u306e\u9055\u3044\u306e\u307f\u3060\u3063\u305f\u3002\u306a\u306e\u3067\u3053\u308c\u3089\u4e8c\u3064\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u7d44\u307f\u5408\u308f\u3066\u307f\u308b\u3002\n\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f7f\u7528\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u3092\u30d9\u30fc\u30b9\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u305f\u3002\n#!/usr/bin/python\n#\n# Copyright 2014 Google Inc. All Rights Reserved.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#      http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\nimport argparse\n\nfrom apiclient.discovery import build\nimport httplib2\nfrom oauth2client import client\n\n# aplha\u3001beta\u3001production\u306a\u3069\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5f8c\u306e\u516c\u958b\u30ec\u30d9\u30eb\u306e\u6307\u5b9a\u3092\u8ffd\u52a0\nTRACK = 'alpha'\n\nSERVICE_ACCOUNT_EMAIL = (\n    'ENTER_YOUR_SERVICE_ACCOUNT_EMAIL_HERE@developer.gserviceaccount.com')\n\nargparser = argparse.ArgumentParser(add_help=False)\nargparser.add_argument('package_name',\n                       help='The package name. Example: com.android.sample')\n\n# apk_file\u3078\u306e\u30d1\u30b9\u3092\u5f15\u6570\u3067\u53d7\u3051\u53d6\u308b\u51e6\u7406\u8ffd\u52a0\nargparser.add_argument('apk_file',\n                       nargs='?',\n                       default='test.apk',\n                       help='The path to the APK file to upload.')\n\n\ndef main():\n  f = file('key.p12', 'rb')\n  key = f.read()\n  f.close()\n\n  credentials = client.SignedJwtAssertionCredentials(\n      SERVICE_ACCOUNT_EMAIL,\n      key,\n      scope='https://www.googleapis.com/auth/androidpublisher')\n  http = httplib2.Http()\n  http = credentials.authorize(http)\n\n  service = build('androidpublisher', 'v2', http=http)\n\n  flags = argparser.parse_args()\n\n  package_name = flags.package_name\n  apk_file = flags.apk_file\n\n  # try\u4ee5\u4e0b\u306fhttps://github.com/googlesamples/android-play-publisher-api/blob/master/v2/python/basic_upload_apks.py\u306e\u30b3\u30fc\u30c9\u3092\u4f7f\u7528\n  try:\n    edit_request = service.edits().insert(body={}, packageName=package_name)\n    result = edit_request.execute()\n    edit_id = result['id']\n\n    apk_response = service.edits().apks().upload(\n        editId=edit_id,\n        packageName=package_name,\n        media_body=apk_file).execute()\n\n    print 'Version code %d has been uploaded' % apk_response['versionCode']\n\n    track_response = service.edits().tracks().update(\n        editId=edit_id,\n        track=TRACK,\n        packageName=package_name,\n        body={u'versionCodes': [apk_response['versionCode']]}).execute()\n\n    print 'Track %s is set for version code(s) %s' % (\n        track_response['track'], str(track_response['versionCodes']))\n\n    commit_request = service.edits().commit(\n        editId=edit_id, packageName=package_name).execute()\n\n    print 'Edit \"%s\" has been committed' % (commit_request['id'])\n\n  except client.AccessTokenRefreshError:\n    print ('The credentials have been revoked or expired, please re-run the '\n           'application to re-authorize')\n\nif __name__ == '__main__':\n  main()\n\n\u5b9f\u884c\n$ python upload_apks_service_account.py jp.horie1024.myapp /PATH/TO/APK/app-release.apk\n\n\u30a8\u30e9\u30fc\u304c\u3067\u308b\u3002\n$ python upload_apks_service_account.py jp.horie1024.myapp /PATH/TO/APK/app-release.apk\nVersion code 1 has been uploaded\nTrack alpha is set for version code(s) [1]\nTraceback (most recent call last):\n  File \"upload_apks_service_account.py\", line 71, in <module>\n    main()\n  File \"upload_apks_service_account.py\", line 62, in main\n    editId=edit_id, packageName=package_name).execute()\n  File \"/usr/local/lib/python2.7/site-packages/oauth2client/util.py\", line 132, in positional_wrapper\n    return wrapped(*args, **kwargs)\n  File \"/usr/local/lib/python2.7/site-packages/googleapiclient/http.py\", line 723, in execute\n    raise HttpError(resp, content, uri=self.uri)\ngoogleapiclient.errors.HttpError: <HttpError 401 when requesting https://www.googleapis.com/androidpublisher/v2/applications/jp.horie1024.myapp/edits/0455029384756893:commit?alt=json returned \"The current user has insufficient permissions to perform the requested operation.\">\n\n\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u6a29\u9650\u304c\u8db3\u308a\u306a\u3044\u306e\u3067\u3001DeveloperConsole\u306e\u30e6\u30fc\u30b6\u30fc\u30a2\u30ab\u30a6\u30f3\u30c8\u3068\u6a29\u9650\u3067\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u6a29\u9650\u3092\u8ffd\u52a0\u3057\u3001\u3082\u3046\u4e00\u5ea6\u5b9f\u884c\u3002\n$ python upload_apks_service_account.py jp.horie1024.myapp /PATH/TO/APK/app-release.apk\nVersion code 1 has been uploaded\nTrack alpha is set for version code(s) [1]\nEdit \"128240713345872934\" has been committed\n\n\u3046\u307e\u304f\u3044\u3063\u305f\u3002\n\n\u53c2\u8003\n\nhttps://speakerdeck.com/gfx/androidapurifalseririsusitemasuka-number-potatotips\nhttp://www.slideshare.net/sakebook/google-play-developer-api\nhttps://developers.google.com/discovery/libraries\nhttp://stackoverflow.com/questions/27305867/google-api-access-using-service-account-oauth2client-client-cryptounavailableerr\nhttps://developers.google.com/android-publisher/api-ref/\nhttps://developers.google.com/android-publisher/api-ref/edits/insert\nhttps://developers.google.com/android-publisher/api-ref/edits#resource\n\n\n\u8ffd\u8a18\n\u3053\u3061\u3089\u306eGradlePlugin\u3092\u4f7f\u7528\u3059\u308b\u3068\u3088\u308a\u7c21\u5358\u306bGooglePlay\u3078\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3092\u81ea\u52d5\u5316\u3067\u304d\u307e\u3059\u3002\n\nhttps://github.com/Triple-T/gradle-play-publisher\n\n\u3053\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306b\u3064\u3044\u3066\u7d39\u4ecb\u3057\u305f\u30b9\u30e9\u30a4\u30c9\u306f\u3053\u3061\u3089\u3067\u3059\u3002\n\n# \u6982\u8981\n\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089apk\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u5b9f\u9a13\u306e\u30e1\u30e2\u3002\n\n# \u4f55\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\uff1f\n* CircleCI\u306a\u3069\u3068\u9023\u643a\u3059\u308c\u3070\u4eca\u307e\u3067\u624b\u4f5c\u696d\u3067\u3084\u3063\u3066\u3044\u305fGooglePlay\u3078\u306eapk\u306e\u30a2\u30c3\u30ed\u30fc\u30c9\u304cPullRequest\u30d9\u30fc\u30b9\u3067\u81ea\u52d5\u3067\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n* \u30a2\u30d7\u30ea\u306e\u8aac\u660e\u6587\u3001\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u304cGit\u3067\u7ba1\u7406\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u305d\u3046\u3002\n* \u03b1\u3001\u03b2\u30c6\u30b9\u30c8\u304c\u3084\u308a\u3084\u3059\u304f\u306a\u308b\u304b\u3082\u3002\n* Hubot\u306b\u3001android deploy\u3068\u304b\u8a71\u3057\u304b\u3051\u308b\u3068production\u306b\u30a2\u30d7\u30ea\u3092\u516c\u958b\u3068\u304b\u3082\u3067\u304d\u305d\u3046\u3002\n\n# Google APIs Client Library\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u8272\u3005\u3068\u8abf\u3079\u305f\u7d50\u679c\u3001 Python\u306eGoogle APIs Client Library\u3092\u4f7f\u3046\u306e\u304c\u4e00\u756a\u7c21\u5358\u306b\u5b9f\u73fe\u3067\u304d\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306fpip\u3067\u3002\n\n```bash\n$ pip install google-api-python-client\n```\n\n# \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u767b\u9332\n\nOAuth\u8a8d\u8a3c\u306b\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u5fc5\u8981\u306b\u306a\u308b\u306e\u3067\u4f5c\u6210\u3059\u308b\u3002\n\n1.DeveloperAPI\u3068\u30ea\u30f3\u30af\nDeveloper Console\u306e\u5de6\u30e1\u30cb\u30e5\u30fc\u300c\u8a2d\u5b9a\u2192API\u30a2\u30af\u30bb\u30b9\u300d\u3067DeveloperAPI\u3092\u30aa\u30f3\u306b\u3059\u308b\nhttps://play.google.com/apps/publish/#ApiAccessPlace\n![](https://qiita-image-store.s3.amazonaws.com/0/43438/6a7b2f69-c396-1ba7-2720-97f2893071eb.png \"1.png\")\n\n\n2.\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u4f5c\u6210\nAPI\u30a2\u30af\u30bb\u30b9\u30da\u30fc\u30b8\u306e\u4e0b\u306e\u65b9\u306e\u300c\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n![](https://qiita-image-store.s3.amazonaws.com/0/43438/348f478d-346a-fcb1-dbac-b2ddf5d169af.png \"2.png\")\n\n\n3.Developer Console\u306b\u79fb\u52d5 \nDeveloper Console\u3078\u306e\u30ea\u30f3\u30af\u304b\u3089Developer Console\u3078\u79fb\u52d5\u3057\u3001\u300cAPI\u3068\u8a8d\u8a3c\u300d\u3067\u300c\u65b0\u3057\u3044\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3002\n![](https://qiita-image-store.s3.amazonaws.com/0/43438/617d3c3e-eac6-0c26-ab40-8325e96270ef.png \"3.png\")\n\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u30c1\u30a7\u30c3\u30af\u3057\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u3092\u4f5c\u6210\u3059\u308b\u3002\n![](https://qiita-image-store.s3.amazonaws.com/0/43438/5355eb24-50ef-78b1-d34e-afd9bb9fcf38.png \"4.png\")\n\n\u4f5c\u6210\u304c\u5b8c\u4e86\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u3001Google Play Android Developer-1234abcd.p12\u3068\u3044\u3046key\u30d5\u30a1\u30a4\u30eb\u304c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u308b\u3002\n![](https://qiita-image-store.s3.amazonaws.com/0/43438/0e6d83a0-9182-0eb5-d34b-abf8eb051e36.png \"5.png\")\n\n\n\u8a8d\u8a3c\u60c5\u5831\u306b\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3068\u3044\u3046\u9805\u76ee(\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u3001\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3001\u8a3c\u660e\u66f8\u30d5\u30a3\u30f3\u30ac\u30fc\u30d7\u30ea\u30f3\u30c8)\u3068\u3044\u3046\u9805\u76ee\u304c\u51fa\u6765\u3066\u3044\u308c\u3070OK\u3002\n\n# \u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306e\u5b9f\u884c\n\nGoogle Play\u306bapk\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u308a\u3001\u7d39\u4ecb\u6587\u3092\u66f4\u65b0\u3059\u308b[\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9](https://github.com/googlesamples/android-play-publisher-api/tree/master/v2/python)\u304cGitHub\u306b\u306a\u308b\u306e\u3067\u305d\u308c\u3092\u3068\u308a\u3042\u3048\u305aclone\u3057\u3066\u307f\u308b\u3002\n\n```bash\n$ git clone git@github.com:googlesamples/android-play-publisher-api.git\n```\n\nREADME\u306e[First request using OAuth2: Service accounts](https://github.com/googlesamples/android-play-publisher-api/tree/master/v2/python#first-request-using-oauth2-service-accounts)\u3092\u53c2\u8003\u306b\u4f5c\u696d\u3059\u308b\u3002\n\n1.basic_list_apks_service_account.py\u3092\u7de8\u96c6\u3057\u3066\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u8ffd\u52a0\u3059\u308b  \n[26\u884c\u76ee](https://github.com/googlesamples/android-play-publisher-api/blob/master/v2/python/basic_list_apks_service_account.py#L26)\u306e\u4ee5\u4e0b\u306e\u90e8\u5206\u3092\u7de8\u96c6\u3059\u308b\u3002\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306f\u3001Developer Console\u306e\u8a8d\u8a3c\u60c5\u5831\u306b\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u3002  \n\n```python\nSERVICE_ACCOUNT_EMAIL = (\n    'ENTER_YOUR_SERVICE_ACCOUNT_EMAIL_HERE@developer.gserviceaccount.com')\n```\n2.key\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f  \n[38\u884c\u76ee](https://github.com/googlesamples/android-play-publisher-api/blob/master/v2/python/basic_list_apks_service_account.py#L38)\u3067key\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u308b\u306e\u3067\u3001\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u6210\u3057\u305f\u6642\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305fkey\u30d5\u30a1\u30a4\u30eb\u306b\u5909\u66f4\u3057(key\u30d5\u30a1\u30a4\u30eb\u306e\u540d\u524d\u3092\u5909\u66f4\u3057\u3066\u3057\u307e\u3063\u3066\u3082\u826f\u3044)\u3001key\u30d5\u30a1\u30a4\u30eb\u3092\u540c\u4e00\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304f\u3002\n\n3.\u30b5\u30f3\u30d7\u30eb\u3092\u5b9f\u884c\u3059\u308b\n\n```bash\n$ python basic_list_apks_service_account.py com.myapp.package\n```\n\n\u30a8\u30e9\u30fc\u304c\u3067\u308b\u3002\n\n```bash\n$ python basic_list_apks_service_account.py jp.horie1024.myapp\nTraceback (most recent call last):\n  File \"basic_list_apks_service_account.py\", line 78, in <module>\n    main()\n  File \"basic_list_apks_service_account.py\", line 49, in main\n    scope='https://www.googleapis.com/auth/androidpublisher')\n  File \"/usr/local/lib/python2.7/site-packages/oauth2client/util.py\", line 132, in positional_wrapper\n    return wrapped(*args, **kwargs)\n  File \"/usr/local/lib/python2.7/site-packages/oauth2client/client.py\", line 1364, in __init__\n    _RequireCryptoOrDie()\n  File \"/usr/local/lib/python2.7/site-packages/oauth2client/client.py\", line 1318, in _RequireCryptoOrDie\n    raise CryptoUnavailableError('No crypto library available')\noauth2client.client.CryptoUnavailableError: No crypto library available\n```\n[py-openssl\u304c\u5fc5\u8981\u3089\u3057\u3044](http://stackoverflow.com/questions/27305867/google-api-access-using-service-account-oauth2client-client-cryptounavailableerr)\u306e\u3067pip\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\n$ pip install PyOpenSSL\n```\n\n\u3082\u3046\u4e00\u5ea6\u5b9f\u884c\u3002\n\n```bash\n$ python basic_list_apks_service_account.py jp.horie1024.myapp\nversionCode: 1, binary.sha1: b650430a19joihfel2lasiwbf38188d8d\n```\n\u3046\u307e\u304f\u3044\u3063\u305f\u3002\n\n# GooglePlay\u306b\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089apk\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u307f\u308b\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306b\u306f\u3001\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f7f\u7528\u3057\u3066apk\u3092GooglePlay\u3078\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u306a\u304b\u3063\u305f\u306e\u3067\u5e7e\u3064\u304b\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u53c2\u8003\u306b\u66f8\u3044\u3066\u307f\u308b\u3002\n\nclone\u3057\u3066\u304d\u305f\u30b5\u30f3\u30d7\u30eb\u306b\u306f\u3001[\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f7f\u7528\u3057\u306a\u3044\u3067apk\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u30b5\u30f3\u30d7\u30eb](https://github.com/googlesamples/android-play-publisher-api/blob/master/v2/python/basic_upload_apks.py)\u3068[\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f7f\u7528\u3059\u308b\u30b5\u30f3\u30d7\u30eb](https://github.com/googlesamples/android-play-publisher-api/blob/master/v2/python/basic_list_apks_service_account.py)\u304c\u3042\u308b\u306e\u3067\u4e8c\u3064\u3092\u8aad\u307f\u304f\u3089\u3079\u3066\u307f\u308b\u3002\u4e8c\u3064\u306e\u30b5\u30f3\u30d7\u30eb\u306f\u3001\u3069\u3061\u3089\u3082service\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u3066\u3044\u3066\u3001\u8a8d\u8a3c\u90e8\u5206\u306e\u9055\u3044\u306e\u307f\u3060\u3063\u305f\u3002\u306a\u306e\u3067\u3053\u308c\u3089\u4e8c\u3064\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u7d44\u307f\u5408\u308f\u3066\u307f\u308b\u3002\n\n[\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f7f\u7528\u3059\u308b\u30b5\u30f3\u30d7\u30eb](https://github.com/googlesamples/android-play-publisher-api/blob/master/v2/python/basic_list_apks_service_account.py)\u3092\u30d9\u30fc\u30b9\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u305f\u3002\n\n```python\n#!/usr/bin/python\n#\n# Copyright 2014 Google Inc. All Rights Reserved.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#      http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\nimport argparse\n\nfrom apiclient.discovery import build\nimport httplib2\nfrom oauth2client import client\n\n# aplha\u3001beta\u3001production\u306a\u3069\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5f8c\u306e\u516c\u958b\u30ec\u30d9\u30eb\u306e\u6307\u5b9a\u3092\u8ffd\u52a0\nTRACK = 'alpha'\n\nSERVICE_ACCOUNT_EMAIL = (\n    'ENTER_YOUR_SERVICE_ACCOUNT_EMAIL_HERE@developer.gserviceaccount.com')\n\nargparser = argparse.ArgumentParser(add_help=False)\nargparser.add_argument('package_name',\n                       help='The package name. Example: com.android.sample')\n\n# apk_file\u3078\u306e\u30d1\u30b9\u3092\u5f15\u6570\u3067\u53d7\u3051\u53d6\u308b\u51e6\u7406\u8ffd\u52a0\nargparser.add_argument('apk_file',\n                       nargs='?',\n                       default='test.apk',\n                       help='The path to the APK file to upload.')\n\n\ndef main():\n  f = file('key.p12', 'rb')\n  key = f.read()\n  f.close()\n\n  credentials = client.SignedJwtAssertionCredentials(\n      SERVICE_ACCOUNT_EMAIL,\n      key,\n      scope='https://www.googleapis.com/auth/androidpublisher')\n  http = httplib2.Http()\n  http = credentials.authorize(http)\n\n  service = build('androidpublisher', 'v2', http=http)\n\n  flags = argparser.parse_args()\n\n  package_name = flags.package_name\n  apk_file = flags.apk_file\n\n  # try\u4ee5\u4e0b\u306fhttps://github.com/googlesamples/android-play-publisher-api/blob/master/v2/python/basic_upload_apks.py\u306e\u30b3\u30fc\u30c9\u3092\u4f7f\u7528\n  try:\n    edit_request = service.edits().insert(body={}, packageName=package_name)\n    result = edit_request.execute()\n    edit_id = result['id']\n\n    apk_response = service.edits().apks().upload(\n        editId=edit_id,\n        packageName=package_name,\n        media_body=apk_file).execute()\n\n    print 'Version code %d has been uploaded' % apk_response['versionCode']\n\n    track_response = service.edits().tracks().update(\n        editId=edit_id,\n        track=TRACK,\n        packageName=package_name,\n        body={u'versionCodes': [apk_response['versionCode']]}).execute()\n\n    print 'Track %s is set for version code(s) %s' % (\n        track_response['track'], str(track_response['versionCodes']))\n\n    commit_request = service.edits().commit(\n        editId=edit_id, packageName=package_name).execute()\n\n    print 'Edit \"%s\" has been committed' % (commit_request['id'])\n\n  except client.AccessTokenRefreshError:\n    print ('The credentials have been revoked or expired, please re-run the '\n           'application to re-authorize')\n\nif __name__ == '__main__':\n  main()\n```\n\n\u5b9f\u884c\n\n```bash\n$ python upload_apks_service_account.py jp.horie1024.myapp /PATH/TO/APK/app-release.apk\n```\n\u30a8\u30e9\u30fc\u304c\u3067\u308b\u3002\n\n```bash\n$ python upload_apks_service_account.py jp.horie1024.myapp /PATH/TO/APK/app-release.apk\nVersion code 1 has been uploaded\nTrack alpha is set for version code(s) [1]\nTraceback (most recent call last):\n  File \"upload_apks_service_account.py\", line 71, in <module>\n    main()\n  File \"upload_apks_service_account.py\", line 62, in main\n    editId=edit_id, packageName=package_name).execute()\n  File \"/usr/local/lib/python2.7/site-packages/oauth2client/util.py\", line 132, in positional_wrapper\n    return wrapped(*args, **kwargs)\n  File \"/usr/local/lib/python2.7/site-packages/googleapiclient/http.py\", line 723, in execute\n    raise HttpError(resp, content, uri=self.uri)\ngoogleapiclient.errors.HttpError: <HttpError 401 when requesting https://www.googleapis.com/androidpublisher/v2/applications/jp.horie1024.myapp/edits/0455029384756893:commit?alt=json returned \"The current user has insufficient permissions to perform the requested operation.\">\n```\n\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u6a29\u9650\u304c\u8db3\u308a\u306a\u3044\u306e\u3067\u3001DeveloperConsole\u306e\u30e6\u30fc\u30b6\u30fc\u30a2\u30ab\u30a6\u30f3\u30c8\u3068\u6a29\u9650\u3067\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u6a29\u9650\u3092\u8ffd\u52a0\u3057\u3001\u3082\u3046\u4e00\u5ea6\u5b9f\u884c\u3002\n\n```bash\n$ python upload_apks_service_account.py jp.horie1024.myapp /PATH/TO/APK/app-release.apk\nVersion code 1 has been uploaded\nTrack alpha is set for version code(s) [1]\nEdit \"128240713345872934\" has been committed\n```\n\n\u3046\u307e\u304f\u3044\u3063\u305f\u3002\n\n# \u53c2\u8003\n* https://speakerdeck.com/gfx/androidapurifalseririsusitemasuka-number-potatotips\n* http://www.slideshare.net/sakebook/google-play-developer-api\n* https://developers.google.com/discovery/libraries\n* http://stackoverflow.com/questions/27305867/google-api-access-using-service-account-oauth2client-client-cryptounavailableerr\n* https://developers.google.com/android-publisher/api-ref/\n* https://developers.google.com/android-publisher/api-ref/edits/insert\n* https://developers.google.com/android-publisher/api-ref/edits#resource\n\n# \u8ffd\u8a18\n\u3053\u3061\u3089\u306eGradlePlugin\u3092\u4f7f\u7528\u3059\u308b\u3068\u3088\u308a\u7c21\u5358\u306bGooglePlay\u3078\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3092\u81ea\u52d5\u5316\u3067\u304d\u307e\u3059\u3002\n\n* https://github.com/Triple-T/gradle-play-publisher\n\n\u3053\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306b\u3064\u3044\u3066\u7d39\u4ecb\u3057\u305f\u30b9\u30e9\u30a4\u30c9\u306f[\u3053\u3061\u3089](https://speakerdeck.com/horie1024/googleplayhefalseatupurodozi-dong-hua-woshi-sitemita)\u3067\u3059\u3002\n"}