{"context": " More than 1 year has passed since last update.\n\n\u6982\u8981\nGo\u3067felicalib.dll\u3092\u4f7f\u3063\u3066IDM/PMM\u3092\u53d6\u5f97\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u3002\n\u30bd\u30fc\u30b9\u81ea\u4f53\u306fDLL\u306e\u547c\u3073\u51fa\u3057\u3092\u3057\u3066\u308b\u3060\u3051\u306a\u306e\u3067\u3001\u3069\u3061\u3089\u304b\u3068\u8a00\u3048\u3070\u899a\u66f8\u3002\n(felicalib.dll\u306b\u5bfe\u3059\u308b\u30d1\u30b9\u304c\u30cf\u30fc\u30c9\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3055\u308c\u3066\u308b\u306e\u3067\u4fee\u6b63\u3057\u3066\u304f\u3060\u3055\u3044\u3002)\nhttps://github.com/mau4x/nfc-sample\n\n\u5fc5\u8981\u306a\u3082\u306e\n\nGolang 32bit\u7248\n\n\nfelicalib.dll\u304c64bit\u5bfe\u5fdc\u3057\u3066\u306a\u3044\u306e\u306732bit\u7248\u3067\u3002\u6b21\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u5bfe\u5fdc\u3059\u308b\u3068\u306e\u66f8\u304d\u8fbc\u307f\u304b\u3089\u306f\u3084\u4e94\u5e74\u2026\n\n\nPaSoRi\n\n\nRC-S380\u3067\u30c6\u30b9\u30c8\n\n\nNFC/Felica\u30dd\u30fc\u30c8\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2(v5.4.3.4\u3092\u5229\u7528)\n\n\nhttp://www.sony.co.jp/Products/felica/consumer/download/felicaportsoftware.html?j-short=fsc_dl\n\n\nFelicalib.dll(v0.4.2\u3092\u5229\u7528)\n\n\nhttp://felicalib.tmurakam.org/\n\n\n\n\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n\nnfc-sample.go\npackage main\n\nimport (\n    \"log\"\n    \"syscall\"\n    \"unsafe\"\n)\n\nfunc main() {\n    // \u3053\u3053\u306bfelicalib.dll\u306e\u30d1\u30b9\u3092\u5165\u529b\u3002\n    var tPath = \"D:/tools/felicalib-0.4.2/felicalib.dll\"\n\n    dll, err := syscall.LoadDLL(tPath)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer dll.Release()\n\n    // define procedures\n    pasori_open, err := dll.FindProc(\"pasori_open\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    pasori_close, err := dll.FindProc(\"pasori_close\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    pasori_init, err := dll.FindProc(\"pasori_init\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    felica_polling, err := dll.FindProc(\"felica_polling\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    felica_free, err := dll.FindProc(\"felica_free\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    felica_getidm, err := dll.FindProc(\"felica_getidm\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    felica_getpmm, err := dll.FindProc(\"felica_getpmm\")\n    if err != nil {\n        log.Fatal(err)\n    }\n//  felica_read_without_encryption02, err := dll.FindProc(\"felica_read_without_encryption02\")\n//  if err != nil {\n//      log.Fatal(err)\n//  }\n\n    // error\u30c1\u30a7\u30c3\u30af\u306f\u3001\u7b2c\u4e00\u8fd4\u308a\u5024\u306e\u7d50\u679c\u3092\u5224\u5b9a\n    // \u7b2c\u4e09\u8fd4\u308a\u5024(lastErr)\u306f\u3044\u3064\u3082success\n    // lastErr != nil\u3067\u30c1\u30a7\u30c3\u30af\u3059\u308b\u3068\u3001success\u306e\u3068\u304d\u3082\u5024\u304c\u5165\u3063\u3066\u3044\u308b\u3002\n    tPasori, _, _ := pasori_open.Call(0)\n    println(\"open\", tPasori)\n    if(tPasori == uintptr(0)) {\n        log.Fatal(\"\u591a\u5206\u3001\u7aef\u672b\u304c\u63a5\u7d9a\u3055\u308c\u3066\u306a\u3044\")\n    }\n    defer pasori_close.Call(tPasori)\n\n    ret, _, _ := pasori_init.Call(tPasori)\n    println(\"init\", ret)\n    if(ret != 0) {\n        log.Fatal(\"\u30a8\u30e9\u30fc\u51fa\u308b\u3053\u3068\u3042\u308b\u306e\uff1f\")\n    }\n\n    // tFelica\u306f\u3001C\u5074\u3067\u5185\u90e8\u7684\u306b\u30e1\u30e2\u30ea\u78ba\u4fdd\u3055\u308c\u3066\u308b\u3002\n    // \u5f93\u3063\u3066\u591a\u5206\u958b\u653e\u3057\u306a\u3044\u3068\u99c4\u76ee\n    tFelica, _, _ := felica_polling.Call(tPasori, 0xFFFF, 0, 0)\n    println(\"poll\", tFelica)\n    if(tFelica == uintptr(0)) {\n        log.Fatal(\"NFC\u30ab\u30fc\u30c9\u306e\u8aad\u307f\u8fbc\u307f\u5931\u6557\u3002\")\n    }\n    defer felica_free.Call(tFelica)\n\n    // tFelica\u3067\u78ba\u4fdd\u3055\u308c\u3048\u3044\u308b\u9818\u57df\u306e\u4e00\u90e8\u3092\u53d6\u5f97\u3059\u308b\u3002\n    // \u5f93\u3063\u3066\u3001\u5931\u6557\u3059\u308b\u3053\u3068\u306f\u307e\u305a\u306a\u3044\u3002\n    tIdm := uint64(1) // make([]byte, 8) \u307b\u3093\u3068\u306fbyte[8]\u3067\u53d6\u308a\u305f\u3044\u3093\u3060\u3051\u3069\u3001\u3061\u3087\u3044\u3084\u308a\u65b9\u4e0d\u660eorz\n    felica_getidm.Call(tFelica, uintptr(unsafe.Pointer(&tIdm)))\n    println(\"gIdm\", tIdm)\n\n    tPmm := uint64(1)\n    felica_getpmm.Call(tFelica, uintptr(unsafe.Pointer(&tPmm)))\n    println(\"gPmm\", tPmm)\n}\n\n\n# \u6982\u8981\nGo\u3067felicalib.dll\u3092\u4f7f\u3063\u3066IDM/PMM\u3092\u53d6\u5f97\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u3002\n\u30bd\u30fc\u30b9\u81ea\u4f53\u306fDLL\u306e\u547c\u3073\u51fa\u3057\u3092\u3057\u3066\u308b\u3060\u3051\u306a\u306e\u3067\u3001\u3069\u3061\u3089\u304b\u3068\u8a00\u3048\u3070\u899a\u66f8\u3002\n(felicalib.dll\u306b\u5bfe\u3059\u308b\u30d1\u30b9\u304c\u30cf\u30fc\u30c9\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3055\u308c\u3066\u308b\u306e\u3067\u4fee\u6b63\u3057\u3066\u304f\u3060\u3055\u3044\u3002)\n\nhttps://github.com/mau4x/nfc-sample\n\n# \u5fc5\u8981\u306a\u3082\u306e\n* Golang 32bit\u7248\n    * felicalib.dll\u304c64bit\u5bfe\u5fdc\u3057\u3066\u306a\u3044\u306e\u306732bit\u7248\u3067\u3002\u6b21\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u5bfe\u5fdc\u3059\u308b\u3068\u306e\u66f8\u304d\u8fbc\u307f\u304b\u3089\u306f\u3084\u4e94\u5e74\u2026\n* PaSoRi\n    * RC-S380\u3067\u30c6\u30b9\u30c8\n* NFC/Felica\u30dd\u30fc\u30c8\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2(v5.4.3.4\u3092\u5229\u7528)\n    * http://www.sony.co.jp/Products/felica/consumer/download/felicaportsoftware.html?j-short=fsc_dl\n* Felicalib.dll(v0.4.2\u3092\u5229\u7528)\n    * http://felicalib.tmurakam.org/\n\n# \u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n\n```go:nfc-sample.go\npackage main\n\nimport (\n\t\"log\"\n\t\"syscall\"\n\t\"unsafe\"\n)\n\nfunc main() {\n\t// \u3053\u3053\u306bfelicalib.dll\u306e\u30d1\u30b9\u3092\u5165\u529b\u3002\n\tvar tPath = \"D:/tools/felicalib-0.4.2/felicalib.dll\"\n\n\tdll, err := syscall.LoadDLL(tPath)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tdefer dll.Release()\n\n\t// define procedures\n\tpasori_open, err := dll.FindProc(\"pasori_open\")\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tpasori_close, err := dll.FindProc(\"pasori_close\")\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tpasori_init, err := dll.FindProc(\"pasori_init\")\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tfelica_polling, err := dll.FindProc(\"felica_polling\")\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tfelica_free, err := dll.FindProc(\"felica_free\")\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tfelica_getidm, err := dll.FindProc(\"felica_getidm\")\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tfelica_getpmm, err := dll.FindProc(\"felica_getpmm\")\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n//\tfelica_read_without_encryption02, err := dll.FindProc(\"felica_read_without_encryption02\")\n//\tif err != nil {\n//\t\tlog.Fatal(err)\n//\t}\n\n\t// error\u30c1\u30a7\u30c3\u30af\u306f\u3001\u7b2c\u4e00\u8fd4\u308a\u5024\u306e\u7d50\u679c\u3092\u5224\u5b9a\n\t// \u7b2c\u4e09\u8fd4\u308a\u5024(lastErr)\u306f\u3044\u3064\u3082success\n\t// lastErr != nil\u3067\u30c1\u30a7\u30c3\u30af\u3059\u308b\u3068\u3001success\u306e\u3068\u304d\u3082\u5024\u304c\u5165\u3063\u3066\u3044\u308b\u3002\n\ttPasori, _, _ := pasori_open.Call(0)\n\tprintln(\"open\", tPasori)\n\tif(tPasori == uintptr(0)) {\n\t\tlog.Fatal(\"\u591a\u5206\u3001\u7aef\u672b\u304c\u63a5\u7d9a\u3055\u308c\u3066\u306a\u3044\")\n\t}\n\tdefer pasori_close.Call(tPasori)\n\n\tret, _, _ := pasori_init.Call(tPasori)\n\tprintln(\"init\", ret)\n\tif(ret != 0) {\n\t\tlog.Fatal(\"\u30a8\u30e9\u30fc\u51fa\u308b\u3053\u3068\u3042\u308b\u306e\uff1f\")\n\t}\n\n\t// tFelica\u306f\u3001C\u5074\u3067\u5185\u90e8\u7684\u306b\u30e1\u30e2\u30ea\u78ba\u4fdd\u3055\u308c\u3066\u308b\u3002\n\t// \u5f93\u3063\u3066\u591a\u5206\u958b\u653e\u3057\u306a\u3044\u3068\u99c4\u76ee\n\ttFelica, _, _ := felica_polling.Call(tPasori, 0xFFFF, 0, 0)\n\tprintln(\"poll\", tFelica)\n\tif(tFelica == uintptr(0)) {\n\t\tlog.Fatal(\"NFC\u30ab\u30fc\u30c9\u306e\u8aad\u307f\u8fbc\u307f\u5931\u6557\u3002\")\n\t}\n\tdefer felica_free.Call(tFelica)\n\n\t// tFelica\u3067\u78ba\u4fdd\u3055\u308c\u3048\u3044\u308b\u9818\u57df\u306e\u4e00\u90e8\u3092\u53d6\u5f97\u3059\u308b\u3002\n\t// \u5f93\u3063\u3066\u3001\u5931\u6557\u3059\u308b\u3053\u3068\u306f\u307e\u305a\u306a\u3044\u3002\n\ttIdm := uint64(1) // make([]byte, 8) \u307b\u3093\u3068\u306fbyte[8]\u3067\u53d6\u308a\u305f\u3044\u3093\u3060\u3051\u3069\u3001\u3061\u3087\u3044\u3084\u308a\u65b9\u4e0d\u660eorz\n\tfelica_getidm.Call(tFelica, uintptr(unsafe.Pointer(&tIdm)))\n\tprintln(\"gIdm\", tIdm)\n\n\ttPmm := uint64(1)\n\tfelica_getpmm.Call(tFelica, uintptr(unsafe.Pointer(&tPmm)))\n\tprintln(\"gPmm\", tPmm)\n}\n```\n", "tags": ["Go", "golang", "FeliCa", "NFC", "Windows"]}