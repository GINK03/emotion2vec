{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u5bb6\u306e\u5916\u304b\u3089\u81ea\u5b85\u306e\u30de\u30b7\u30f3\u3084\u30b5\u30fc\u30d0\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3044\u306a\u3041\u3068\u601d\u3063\u3066\u8abf\u3079\u3066\u3044\u305f\u3089\nVPN(L2TP/IPsec)\u3068\u3044\u3046\u65b9\u6cd5\u3067\u5b9f\u73fe\u51fa\u6765\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u69cb\u7bc9\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u305d\u306e\u6642\u306e\u69cb\u7bc9\u624b\u9806\u306e\u30e1\u30e2\u3002\n\n\u74b0\u5883\u306b\u3064\u3044\u3066\n\nOS\nCentOS 6.5\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\nlibreswan\nxl2tpd\n\n\u305d\u306e\u4ed6\n\u4e0b\u8a18\u306e\u624b\u9806\u306f\u5168\u3066 root \u30e6\u30fc\u30b6\u3067\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u3002\n\n1.\u5916\u90e8\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u8ffd\u52a0\nlibreswan\u3001xl2tpd \u306fCentOS\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u306f\u542b\u307e\u308c\u3066\u3044\u306a\u3044\u306e\u3067\n\u8ffd\u52a0\u30ea\u30dd\u30b8\u30c8\u30ea(epel)\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n# rpm -ivh http://ftp.riken.jp/Linux/fedora/epel/6/x86_64/epel-release-6-8.noarch.rpm\nyum\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u305f\u6642\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306fepel\u3092\u53c2\u7167\u3057\u306a\u3044\u69d8\u306b\u7121\u52b9\u5316\u3057\u3066\u304a\u304f\u3002\n\n/etc/yum.repos.d/epel.repo\n[epel]\nenabled=1\n\u2193\u306b\u4fee\u6b63\nenabled=0\n\n\n\n2.libreswan xl2tpd \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n# yum -y install --enablerepo=epel libreswan xl2tpd lsof\n\n3.\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u4fee\u6b63\n\nxl2tpd\u306e\u8a2d\u5b9a\n\nl2tp\u63a5\u7d9a\u3059\u308b\u969b\u306e\u52d5\u4f5c(\u8a8d\u8a3c\u3084IP\u5272\u5f53)\u306b\u95a2\u3059\u308b\u8a2d\u5b9a\n\n/etc/xl2tpd/xl2tpd.conf\n[lns default]\nip range = 192.168.1.128-192.168.1.254\nlocal ip = 192.168.1.99\n\u2193\u306b\u4fee\u6b63(\u5404\u81ea\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u308b)\nip range = 192.168.1.50-192.168.1.100\nlocal ip = 192.168.1.49\n\n\u2193\u30b3\u30e1\u30f3\u30c8\u89e3\u9664(\u884c\u982d\u306e ; \u524a\u9664)\nrequire chap = yes\n\n\n\n\u5404\u9805\u76ee\u306e\u8aac\u660e\n\u30fbip range\n\u3000VPN\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3078\u5272\u308a\u632f\u308bIP\u30a2\u30c9\u30ec\u30b9\u7bc4\u56f2\u3092\u6307\u5b9a\n\u30fblocal ip\n\u3000\u30b5\u30fc\u30d0\u81ea\u8eab\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u8a2d\u5b9a\n\u30fbrequire chap\n\u3000chap\u306b\u3088\u308b\u8a8d\u8a3c\u60c5\u5831\u6697\u53f7\u5316\u3092\u8a2d\u5b9a\n\n\u30c8\u30f3\u30cd\u30ea\u30f3\u30b0\u306b\u95a2\u3059\u308b\u8a2d\u5b9a\n\n/etc/ppp/options.xl2tpd\nms-dns  8.8.8.8\n\u2193\u306b\u4fee\u6b63(\u5404\u81ea\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u308b)\nms-dns  192.168.1.1\n\nmtu 1280\nmru 1280\n\u2193\u306b\u4fee\u6b63(\u5404\u81ea\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u308b)\nmtu 1240\nmru 1240\n\n\u2193\u8ffd\u8a18\nnetmask 255.255.255.0\npersist\nrequire-mschap-v2\nlogfile /var/log/xl2tpd.log\n\n\nMTU/MRU\u306e\u8a2d\u5b9a\u306f\u3001\u5404\u74b0\u5883\u3067\u6570\u5024\u304c\u5909\u308f\u308a\u307e\u3059\u3002\n\u300cping mtu \u6e2c\u5b9a\u300d\u7b49\u3067\u30b0\u30b0\u3063\u3066\u3001\u6700\u9069\u306a\u5024\u3092\u8abf\u3079\u3066\u4e0b\u3055\u3044\u3002\n\n\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u3063\u3066\u304a\u304f\n# touch /var/log/xl2tpd.log\n\nipsec\u306e\u8a2d\u5b9a\n\n/etc/ipsec.conf\n#version 2\n#plutodebug=none\n#klipsdebug=none\nvirtual_private=%v4:10.0.0.0/8,%v4:\u30fb\u30fb\u30fb(\u4e2d\u7565)\n#include /etc/ipsec.d/*.conf\n\u2193\u306b\u4fee\u6b63\nversion 2\nplutodebug=none\nklipsdebug=none\nvirtual_private=%v4:192.168.1.0/24\ninclude /etc/ipsec.d/*.conf\n\n\n\n/etc/ipsec.d/l2tp-psk.conf\nconn L2TP-PSK-NAT\n  rightsubnet=0.0.0.0/0\n  forceencaps=yes\n  also=L2TP-PSK-noNAT\n\nconn L2TP-PSK-noNAT\n  #iOS\u7528\u306e\u8a2d\u5b9a\n  dpddelay=10\n  dpdtimeout=20\n  dpdaction=clear\n  #iOS\u7528\u306e\u8a2d\u5b9a \u3053\u3053\u307e\u3067\n  authby=secret\n  pfs=no\n  auto=add\n  keyingtries=3\n  rekey=no\n  ikelifetime=8h\n  keylife=1h\n  type=transport\n  left=%defaultroute\n  leftprotoport=17/1701\n  right=%any\n  rightprotoport=17/%any\n\n\n\n\u4e8b\u524d\u5171\u6709\u9375\u306e\u8a2d\u5b9a\n\n/etc/ipsec.d/default.secrets\n: PSK \"keyword\"\n\n\n\u7ba1\u7406\u8005\u4ee5\u5916\u306f\u64cd\u4f5c\u304c\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u8a2d\u5b9a\n# chmod 600 /etc/ipsec.d/default.secrets\n\n\u30e6\u30fc\u30b6ID\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u8a2d\u5b9a\n\n/etc/ppp/chap-secrets\n\"user1\" * \"password1\" *\n\n\n\u7ba1\u7406\u8005\u4ee5\u5916\u306f\u64cd\u4f5c\u304c\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u8a2d\u5b9a\n# chmod 600 /etc/ppp/chap-secrets\nipsec\u30b5\u30fc\u30d3\u30b9\u3068l2tp\u30b5\u30fc\u30d3\u30b9\u306e\u8d77\u52d5\u3068\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\n# service xl2tpd start\n# chkconfig xl2tpd on\n# service ipsec start\n# chkconfig ipsec on\n\n4.\u305d\u306e\u4ed6\u306e\u74b0\u5883\u8a2d\u5b9a\n\nSELinux\u306e\u7121\u52b9\u5316\n\n/etc/sysconfig/selinux\nSELINUX=enforcing\n\u2193\u306b\u4fee\u6b63\nSELINUX=disabled\n\n\n\n\u30ab\u30fc\u30cd\u30eb\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u5909\u66f4\nip\u30d5\u30a9\u30ef\u30fc\u30c9\u3092\u6709\u52b9\u5316\nip\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3092\u7121\u52b9\u5316\nrp_filter\u306e\u7121\u52b9\u5316\n\n/etc/sysctl.conf\nnet.ipv4.ip_forward = 1 \u2190\u4fee\u6b63\n\n\u4ee5\u4e0b\u306f\u8ffd\u8a18\nnet.core.xfrm_larval_drop = 1\nnet.ipv4.conf.all.send_redirects = 0\nnet.ipv4.conf.default.send_redirects = 0\nnet.ipv4.conf.eth0.send_redirects = 0\nnet.ipv4.conf.eth1.send_redirects = 0\nnet.ipv4.conf.lo.send_redirects = 0\nnet.ipv4.conf.all.accept_redirects = 0\nnet.ipv4.conf.default.accept_redirects = 0\nnet.ipv4.conf.eth0.accept_redirects = 0\nnet.ipv4.conf.eth1.accept_redirects = 0\nnet.ipv4.conf.lo.accept_redirects = 0\nnet.ipv4.conf.all.rp_filter = 0\nnet.ipv4.conf.default.rp_filter = 0\nnet.ipv4.conf.eth0.rp_filter = 0\nnet.ipv4.conf.lo.rp_filter = 0\n\n\n\niptables\u306e\u8a2d\u5b9a\n\n/etc/sysconfig/iptables\n*nat\n:PREROUTING ACCEPT [0:0]\n:POSTROUTING ACCEPT [0:0]\n:OUTPUT ACCEPT [0:0]\n-A POSTROUTING -s 192.168.1.0/24 -j MASQUERADE\nCOMMIT\n\n*filter\n:INPUT ACCEPT [0:0]\n:FORWARD ACCEPT [0:0]\n:OUTPUT ACCEPT [4:528]\n-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT\n-A INPUT -p icmp -j ACCEPT\n-A INPUT -i lo -j ACCEPT\n-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT\n-A INPUT -p udp -m udp --dport 1701 -j ACCEPT\n-A INPUT -p udp -m udp --dport 500 -j ACCEPT\n-A INPUT -p udp -m udp --dport 4500 -j ACCEPT\n-A INPUT -j REJECT --reject-with icmp-host-prohibited\n-A FORWARD -i ppp+ -j ACCEPT\n-A FORWARD -o ppp+ -j ACCEPT\n-A FORWARD -j REJECT --reject-with icmp-host-prohibited\nCOMMIT\n\n\n\u8a2d\u5b9a\u5185\u5bb9\u306e\u78ba\u8a8d\n# ipsec verify\n\u2193\u307f\u305f\u3044\u306b\u306a\u3063\u3066\u308c\u3070OK\nVerifying installed system and configuration files\n\nVersion check and ipsec on-path                     [OK]\nLibreswan 3.12 (netkey) on 2.6.32-431.el6.x86_64\nChecking for IPsec support in kernel                [OK]\n NETKEY: Testing XFRM related proc values\n         ICMP default/send_redirects                [OK]\n         ICMP default/accept_redirects              [OK]\n         XFRM larval drop                           [OK]\nPluto ipsec.conf syntax                             [OK]\nHardware random device                              [N/A]\nChecking rp_filter                                  [OK]\nChecking that pluto is running                      [OK]\n Pluto listening for IKE on udp 500                 [OK]\n Pluto listening for IKE/NAT-T on udp 4500          [OK]\n Pluto ipsec.secret syntax                          [OK]\nChecking 'ip' command                               [OK]\nChecking 'iptables' command                         [OK]\nChecking 'prelink' command does not interfere with FIPSChecking for obsolete ipsec.conf options             [OK]\nOpportunistic Encryption                            [DISABLED]\n\n\u30c0\u30e1\u306a\u4f8b\n\u3053\u3046\u3044\u3046\u306e\u304c\u51fa\u3066\u305f\u3089\u3001\u8a2d\u5b9a\u30df\u30b9\u304c\u306a\u3044\u304b\u898b\u76f4\u3059\nChecking rp_filter                                  [ENABLED]\n /proc/sys/net/ipv4/conf/default/rp_filter          [ENABLED]\n /proc/sys/net/ipv4/conf/lo/rp_filter               [ENABLED]\n /proc/sys/net/ipv4/conf/eth0/rp_filter             [ENABLED]\nOpportunistic Encryption                            [DISABLED]\n\n\n5.\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u8a2d\u5b9a(iPhone)\n\u8a2d\u5b9a -> \u4e00\u822c -> VPN -> VPN\u69cb\u6210\u3092\u8ffd\u52a0...\n\n\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u306b\u306f [/etc/ipsec.d/default.secrets] \u306e\u8a2d\u5b9a\u5024\u3092\n\u30a2\u30ab\u30a6\u30f3\u30c8\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u306b\u306f[/etc/ppp/chap-secrets] \u306e\u8a2d\u5b9a\u5024\u3092\u5165\u529b\u3057\u3066\u4fdd\u5b58\u3002\n\u8a2d\u5b9a\u5f8c\u3001VPN\u3092on\u306b\u3057\u3066\u3001iPhone\u306e\u53f3\u4e0a\u306b[VPN]\u306e\u6587\u5b57\u304c\u51fa\u308c\u3070\u6210\u529f\u3002\n\u4ee5\u4e0a\n\n#\u306f\u3058\u3081\u306b\n\u5bb6\u306e\u5916\u304b\u3089\u81ea\u5b85\u306e\u30de\u30b7\u30f3\u3084\u30b5\u30fc\u30d0\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3044\u306a\u3041\u3068\u601d\u3063\u3066\u8abf\u3079\u3066\u3044\u305f\u3089\nVPN(L2TP/IPsec)\u3068\u3044\u3046\u65b9\u6cd5\u3067\u5b9f\u73fe\u51fa\u6765\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u69cb\u7bc9\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u305d\u306e\u6642\u306e\u69cb\u7bc9\u624b\u9806\u306e\u30e1\u30e2\u3002\n\n##\u74b0\u5883\u306b\u3064\u3044\u3066\n###OS\nCentOS 6.5\n###\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\nlibreswan\nxl2tpd\n###\u305d\u306e\u4ed6\n\u4e0b\u8a18\u306e\u624b\u9806\u306f\u5168\u3066 root \u30e6\u30fc\u30b6\u3067\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n#1.\u5916\u90e8\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u8ffd\u52a0\nlibreswan\u3001xl2tpd \u306fCentOS\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u306f\u542b\u307e\u308c\u3066\u3044\u306a\u3044\u306e\u3067\n\u8ffd\u52a0\u30ea\u30dd\u30b8\u30c8\u30ea(epel)\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n`# rpm -ivh http://ftp.riken.jp/Linux/fedora/epel/6/x86_64/epel-release-6-8.noarch.rpm`\n\nyum\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u305f\u6642\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306fepel\u3092\u53c2\u7167\u3057\u306a\u3044\u69d8\u306b\u7121\u52b9\u5316\u3057\u3066\u304a\u304f\u3002\n\n```yum:/etc/yum.repos.d/epel.repo\n[epel]\nenabled=1\n\u2193\u306b\u4fee\u6b63\nenabled=0\n```\n\n#2.libreswan xl2tpd \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\n`# yum -y install --enablerepo=epel libreswan xl2tpd lsof`\n\n#3.\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u4fee\u6b63\n##xl2tpd\u306e\u8a2d\u5b9a\n###l2tp\u63a5\u7d9a\u3059\u308b\u969b\u306e\u52d5\u4f5c(\u8a8d\u8a3c\u3084IP\u5272\u5f53)\u306b\u95a2\u3059\u308b\u8a2d\u5b9a\n\n```xl2tpd:/etc/xl2tpd/xl2tpd.conf\n[lns default]\nip range = 192.168.1.128-192.168.1.254\nlocal ip = 192.168.1.99\n\u2193\u306b\u4fee\u6b63(\u5404\u81ea\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u308b)\nip range = 192.168.1.50-192.168.1.100\nlocal ip = 192.168.1.49\n\n\u2193\u30b3\u30e1\u30f3\u30c8\u89e3\u9664(\u884c\u982d\u306e ; \u524a\u9664)\nrequire chap = yes\n```\n\n####\u5404\u9805\u76ee\u306e\u8aac\u660e\n\b\u30fbip range\n\u3000VPN\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3078\u5272\u308a\u632f\u308bIP\u30a2\u30c9\u30ec\u30b9\u7bc4\u56f2\u3092\u6307\u5b9a\n\b\u30fblocal ip\n\u3000\u30b5\u30fc\u30d0\u81ea\u8eab\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u8a2d\u5b9a\n\b\u30fbrequire chap\n\u3000chap\u306b\u3088\u308b\u8a8d\u8a3c\u60c5\u5831\u6697\u53f7\u5316\u3092\u8a2d\u5b9a\n\n###\u30c8\u30f3\u30cd\u30ea\u30f3\u30b0\u306b\u95a2\u3059\u308b\u8a2d\u5b9a\n```xl2tpd:/etc/ppp/options.xl2tpd\nms-dns  8.8.8.8\n\u2193\u306b\u4fee\u6b63(\u5404\u81ea\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u308b)\nms-dns  192.168.1.1\n\nmtu 1280\nmru 1280\n\u2193\u306b\u4fee\u6b63(\u5404\u81ea\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u308b)\nmtu 1240\nmru 1240\n\n\u2193\u8ffd\u8a18\nnetmask 255.255.255.0\npersist\nrequire-mschap-v2\nlogfile /var/log/xl2tpd.log\n```\n\nMTU/MRU\u306e\u8a2d\u5b9a\u306f\u3001\u5404\u74b0\u5883\u3067\u6570\u5024\u304c\u5909\u308f\u308a\u307e\u3059\u3002\n\u300cping mtu \u6e2c\u5b9a\u300d\u7b49\u3067\u30b0\u30b0\u3063\u3066\u3001\u6700\u9069\u306a\u5024\u3092\u8abf\u3079\u3066\u4e0b\u3055\u3044\u3002\n\n###\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u3063\u3066\u304a\u304f\n\n`# touch /var/log/xl2tpd.log`\n\n###ipsec\u306e\u8a2d\u5b9a\n\n```ipsec:/etc/ipsec.conf\n#version 2\n#plutodebug=none\n#klipsdebug=none\nvirtual_private=%v4:10.0.0.0/8,%v4:\u30fb\u30fb\u30fb(\u4e2d\u7565)\n#include /etc/ipsec.d/*.conf\n\u2193\u306b\u4fee\u6b63\nversion 2\nplutodebug=none\nklipsdebug=none\nvirtual_private=%v4:192.168.1.0/24\ninclude /etc/ipsec.d/*.conf\n```\n\n```xl2tpd:/etc/ipsec.d/l2tp-psk.conf\nconn L2TP-PSK-NAT\n  rightsubnet=0.0.0.0/0\n  forceencaps=yes\n  also=L2TP-PSK-noNAT\n\nconn L2TP-PSK-noNAT\n  #iOS\u7528\u306e\u8a2d\u5b9a\n  dpddelay=10\n  dpdtimeout=20\n  dpdaction=clear\n  #iOS\u7528\u306e\u8a2d\u5b9a \u3053\u3053\u307e\u3067\n  authby=secret\n  pfs=no\n  auto=add\n  keyingtries=3\n  rekey=no\n  ikelifetime=8h\n  keylife=1h\n  type=transport\n  left=%defaultroute\n  leftprotoport=17/1701\n  right=%any\n  rightprotoport=17/%any\n```\n\n####\u4e8b\u524d\u5171\u6709\u9375\u306e\u8a2d\u5b9a\n\n```xl2tpd:/etc/ipsec.d/default.secrets\n: PSK \"keyword\"\n```\n\n\u7ba1\u7406\u8005\u4ee5\u5916\u306f\u64cd\u4f5c\u304c\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u8a2d\u5b9a\n\n`# chmod 600 /etc/ipsec.d/default.secrets`\n\n####\u30e6\u30fc\u30b6ID\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u8a2d\u5b9a\n```ipsec:/etc/ppp/chap-secrets\n\"user1\" * \"password1\" *\n```\n\n\u7ba1\u7406\u8005\u4ee5\u5916\u306f\u64cd\u4f5c\u304c\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u8a2d\u5b9a\n\n`# chmod 600 /etc/ppp/chap-secrets`\n\nipsec\u30b5\u30fc\u30d3\u30b9\u3068l2tp\u30b5\u30fc\u30d3\u30b9\u306e\u8d77\u52d5\u3068\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\n\n\n`# service xl2tpd start`\n`# chkconfig xl2tpd on`\n`# service ipsec start`\n`# chkconfig ipsec on`\n\n\n\n#4.\u305d\u306e\u4ed6\u306e\u74b0\u5883\u8a2d\u5b9a\n##SELinux\u306e\u7121\u52b9\u5316\n```selinux:/etc/sysconfig/selinux\nSELINUX=enforcing\n\u2193\u306b\u4fee\u6b63\nSELINUX=disabled\n```\n\n##\u30ab\u30fc\u30cd\u30eb\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u5909\u66f4\nip\u30d5\u30a9\u30ef\u30fc\u30c9\u3092\u6709\u52b9\u5316\nip\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3092\u7121\u52b9\u5316\nrp_filter\u306e\u7121\u52b9\u5316\n\n```sysctl:/etc/sysctl.conf\nnet.ipv4.ip_forward = 1 \u2190\u4fee\u6b63\n\n\u4ee5\u4e0b\u306f\u8ffd\u8a18\nnet.core.xfrm_larval_drop = 1\nnet.ipv4.conf.all.send_redirects = 0\nnet.ipv4.conf.default.send_redirects = 0\nnet.ipv4.conf.eth0.send_redirects = 0\nnet.ipv4.conf.eth1.send_redirects = 0\nnet.ipv4.conf.lo.send_redirects = 0\nnet.ipv4.conf.all.accept_redirects = 0\nnet.ipv4.conf.default.accept_redirects = 0\nnet.ipv4.conf.eth0.accept_redirects = 0\nnet.ipv4.conf.eth1.accept_redirects = 0\nnet.ipv4.conf.lo.accept_redirects = 0\nnet.ipv4.conf.all.rp_filter = 0\nnet.ipv4.conf.default.rp_filter = 0\nnet.ipv4.conf.eth0.rp_filter = 0\nnet.ipv4.conf.lo.rp_filter = 0\n```\n\n##iptables\u306e\u8a2d\u5b9a\n\n```iptables:/etc/sysconfig/iptables\n*nat\n:PREROUTING ACCEPT [0:0]\n:POSTROUTING ACCEPT [0:0]\n:OUTPUT ACCEPT [0:0]\n-A POSTROUTING -s 192.168.1.0/24 -j MASQUERADE\nCOMMIT\n\n*filter\n:INPUT ACCEPT [0:0]\n:FORWARD ACCEPT [0:0]\n:OUTPUT ACCEPT [4:528]\n-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT\n-A INPUT -p icmp -j ACCEPT\n-A INPUT -i lo -j ACCEPT\n-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT\n-A INPUT -p udp -m udp --dport 1701 -j ACCEPT\n-A INPUT -p udp -m udp --dport 500 -j ACCEPT\n-A INPUT -p udp -m udp --dport 4500 -j ACCEPT\n-A INPUT -j REJECT --reject-with icmp-host-prohibited\n-A FORWARD -i ppp+ -j ACCEPT\n-A FORWARD -o ppp+ -j ACCEPT\n-A FORWARD -j REJECT --reject-with icmp-host-prohibited\nCOMMIT\n```\n\n\u8a2d\u5b9a\u5185\u5bb9\u306e\u78ba\u8a8d\n\n`# ipsec verify`\n\n\u2193\u307f\u305f\u3044\u306b\u306a\u3063\u3066\u308c\u3070OK\n\n```\nVerifying installed system and configuration files\n\nVersion check and ipsec on-path                   \t[OK]\nLibreswan 3.12 (netkey) on 2.6.32-431.el6.x86_64\nChecking for IPsec support in kernel              \t[OK]\n NETKEY: Testing XFRM related proc values\n         ICMP default/send_redirects              \t[OK]\n         ICMP default/accept_redirects            \t[OK]\n         XFRM larval drop                         \t[OK]\nPluto ipsec.conf syntax                           \t[OK]\nHardware random device                            \t[N/A]\nChecking rp_filter                                \t[OK]\nChecking that pluto is running                    \t[OK]\n Pluto listening for IKE on udp 500               \t[OK]\n Pluto listening for IKE/NAT-T on udp 4500        \t[OK]\n Pluto ipsec.secret syntax                        \t[OK]\nChecking 'ip' command                             \t[OK]\nChecking 'iptables' command                       \t[OK]\nChecking 'prelink' command does not interfere with FIPSChecking for obsolete ipsec.conf options          \t[OK]\nOpportunistic Encryption                          \t[DISABLED]\n```\n\n\u30c0\u30e1\u306a\u4f8b\n\u3053\u3046\u3044\u3046\u306e\u304c\u51fa\u3066\u305f\u3089\u3001\u8a2d\u5b9a\u30df\u30b9\u304c\u306a\u3044\u304b\u898b\u76f4\u3059\n\n```\nChecking rp_filter                                \t[ENABLED]\n /proc/sys/net/ipv4/conf/default/rp_filter        \t[ENABLED]\n /proc/sys/net/ipv4/conf/lo/rp_filter             \t[ENABLED]\n /proc/sys/net/ipv4/conf/eth0/rp_filter           \t[ENABLED]\nOpportunistic Encryption                          \t[DISABLED]\n```\n\n#5.\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u8a2d\u5b9a(iPhone)\n\n\u8a2d\u5b9a -> \u4e00\u822c -> VPN -> VPN\u69cb\u6210\u3092\u8ffd\u52a0...\n\n![image.jpg](https://qiita-image-store.s3.amazonaws.com/0/64421/fe0358c9-7a86-fb0d-9210-dfe8c91eaea6.jpeg \"image.jpg\")\n\n\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u306b\u306f [/etc/ipsec.d/default.secrets] \u306e\u8a2d\u5b9a\u5024\u3092\n\u30a2\u30ab\u30a6\u30f3\u30c8\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u306b\u306f[/etc/ppp/chap-secrets] \u306e\u8a2d\u5b9a\u5024\u3092\u5165\u529b\u3057\u3066\u4fdd\u5b58\u3002\n\n\u8a2d\u5b9a\u5f8c\u3001VPN\u3092on\u306b\u3057\u3066\u3001iPhone\u306e\u53f3\u4e0a\u306b[VPN]\u306e\u6587\u5b57\u304c\u51fa\u308c\u3070\u6210\u529f\u3002\n\n\n\n\u4ee5\u4e0a\n", "tags": ["ipsec", "l2tp", "VPN", "Linux"]}