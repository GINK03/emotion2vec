{"context": " More than 1 year has passed since last update.\n\nDocker on Vagrant on Ubuntu on VirtualBox\u306eLAMP(LAPP)\u958b\u767a\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\n\n\u52d5\u6a5f\n\u666e\u6bb5\u306fWindows7+VirtualBox+Vagrant\u3067LAMP(LAPP)\u958b\u767a\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001VM\u304c\u5897\u3048\u3066\u30c7\u30a3\u30b9\u30af\u3092\u5727\u8feb\u3057\u3066\u304d\u305f\u306e\u3067\u3001Docker on Vagrant on Ubuntu on VirtualBox\u3067\u958b\u767a\u74b0\u5883\u3092\u8efd\u91cf\u5316\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u3001Vagrant\u3092\u4f7f\u7528\u3059\u308b\u611f\u899a\u3067Docker\u3092\u4f7f\u3048\u308b\u3053\u3068\u3092\u76ee\u6a19\u3068\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001\u958b\u767a\u74b0\u5883\u306e\u69cb\u7bc9\u3092\u76ee\u7684\u3068\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u672c\u756a\u74b0\u5883\u3067Docker\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u306f\u60f3\u5b9a\u3057\u3066\u307e\u305b\u3093\u3002\n\n\u524d\u63d0\n\nVirtualBox\u3067VM\u30921\u53f0\u69cb\u7bc9\u3057\u3066\u305d\u308c\u4e0a\u306bUbuntu+Vagrant+Docker\u3092\u69cb\u7bc9\u3057\u307e\u3059\nVM\u306b\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30c0\u30d7\u30bf\u30fc\u30922\u500b\u3064\u3051\u307e\u3059\n\n\n\u30a2\u30c0\u30d7\u30bf\u30fc1: NAT\n\u30a2\u30c0\u30d7\u30bf\u30fc2: \u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30a2\u30c0\u30d7\u30bf\u30fc\n\n\nDocker\u306e\u30b3\u30f3\u30c6\u30ca\u306b\u306f\u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30a2\u30c0\u30d7\u30bf\u30fc\u7d4c\u7531\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3082\u306e\u3068\u3057\u307e\u3059\n\n\n\u305d\u306e\u305f\u3081\u30db\u30b9\u30c8\u4ee5\u5916\u306e\u30de\u30b7\u30f3\u304b\u3089\u306f\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u305b\u3093\n\u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30a2\u30c0\u30d7\u30bf\u30fc\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306f192.168.77.0/24\u3068\u3057\u3001IP\u30a2\u30c9\u30ec\u30b9\u306b192.168.77.200\u3092\u5272\u308a\u5f53\u3066\u307e\u3059\nDocker\u306e\u30b3\u30f3\u30c6\u30ca\u306b\u306f\u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30a2\u30c0\u30d7\u30bf\u30fc\u306eIP\u30a8\u30a4\u30ea\u30a2\u30b9\u3092\u5272\u308a\u5f53\u3066\u3066\u3044\u304d\u307e\u3059\n\u306a\u304a\u672a\u78ba\u8a8d\u3067\u3059\u304c\u3001\u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30a2\u30c0\u30d7\u30bf\u30fc\u306e\u66ff\u308f\u308a\u306b\u30d6\u30ea\u30c3\u30b8\u30a2\u30c0\u30d7\u30bf\u30fc\u306b\u3059\u308b\u3068\u30db\u30b9\u30c8\u4ee5\u5916\u306e\u30de\u30b7\u30f3\u304b\u3089\u3082\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u306b\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\n\n\nVM\u306b\u306fUbuntu 14.04\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\n\n\nCentOS 7.1\u3067\u3082\u30c1\u30e3\u30ec\u30f3\u30b8\u3057\u307e\u3057\u305f\u304cdevice mapper\u306e\u6027\u80fd\u304c\u60aa\u304b\u3063\u305f\u306e\u3067aufs\u306eUbuntu\u3092\u9078\u3073\u307e\u3057\u305f\n\n\nUbuntu\u4e0a\u306b\u300cdockeruser\u300d\u3068\u3044\u3046\u4f5c\u696d\u7528\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3057\u3066\u305d\u306e\u30e6\u30fc\u30b6\u3067Vagrant\u3068Docker\u3092\u5229\u7528\u3057\u307e\u3059\nLAMP(LAPP)\u74b0\u5883\u69cb\u7bc9\u306b\u306f\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u30c4\u30fc\u30eb\u306eAnsible\u3092\u5229\u7528\u3057\u307e\u3059\n\u78ba\u8a8d\u3057\u305f\u74b0\u5883\u306fWindows7+VirtualBox 4.3.28\u3001\u78ba\u8a8d\u3057\u305f\u65e5\u4ed8\u306f2015\u5e748\u670831\u65e5\u3067\u3059\n\n\n\u624b\u9806\n\n1. Ubuntu 14.04 Server\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb(ubuntu-14.04.3-server-amd64.iso)\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\nhttp://releases.ubuntu.com/14.04/\n\n\n2. VirtualBox\u3067VM\u3092\u4f5c\u6210\n\u307e\u305a\u3001\u4eca\u56de\u306e\u74b0\u5883\u7528\u306b\u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u65b0\u305f\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002VirtualBox\u30de\u30cd\u30fc\u30b8\u30e3\u30fc\u304b\u3089\u74b0\u5883\u8a2d\u5b9a\u3092\u958b\u304d\u307e\u3059\u3002\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u8ffd\u52a0\u3059\u308b\u30dc\u30bf\u30f3\u3067\u3001\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\u8ffd\u52a0\u3057\u305f\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u9078\u629e\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306bDHCP\u3092\u30aa\u30d5\u306b\u3057\u305f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002(\u203b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30c9\u30ec\u30b9\u306f\u5404\u81ea\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u8abf\u6574\u3057\u3066\u304f\u3060\u3055\u3044\u3002)\n\n\n\u8a2d\u5b9a\u3057\u305f\u3089\u74b0\u5883\u8a2d\u5b9a\u3092\u9589\u3058\u307e\u3059\u3002\n\u6b21\u306b\u3001VM\u3092\u65b0\u898f\u4f5c\u6210\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u300cdocker\u300d\u3068\u3044\u3046\u540d\u524d\u3067\u4f5c\u6210\u3057\u307e\u3059\u3002OS\u306fUbuntu 64bit\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n\u30e1\u30e2\u30ea\u30fc\u30b5\u30a4\u30ba\u306f\u5404\u81ea\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u8abf\u6574\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u3053\u3067\u306f512MB\u3067\u9032\u3081\u307e\u3059\u3002\n\n\u4eee\u60f3\u30cf\u30fc\u30c9\u30c9\u30e9\u30a4\u30d6\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u3053\u3053\u3067\u306fVDI\u5f62\u5f0f\u306720GB\u306e\u53ef\u5909\u3067\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u5404\u81ea\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u8abf\u6574\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\n\nVM\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001\u8d77\u52d5\u3059\u308b\u524d\u306b\u4e00\u90e8\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\u307e\u305a\u3001\u30b7\u30b9\u30c6\u30e0\u306e\u8d77\u52d5\u9806\u5e8f\u306e\u30d5\u30ed\u30c3\u30d4\u30fc\u306e\u30c1\u30a7\u30c3\u30af\u3092\u306f\u305a\u3057\u3001\u30dd\u30a4\u30f3\u30c6\u30a3\u30f3\u30b0\u30c7\u30d0\u30a4\u30b9\u3092PS/2 \u30de\u30a6\u30b9\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n\u6b21\u306b\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u306eCD/DVD\u30c9\u30e9\u30a4\u30d6\u3067Ubuntu 14.04\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb(ubuntu-14.04.3-server-amd64.iso)\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n\u6b21\u306b\u3001\u30aa\u30fc\u30c7\u30a3\u30aa\u3092\u7121\u52b9\u5316\u3057\u307e\u3059\u3002\n\n\u6b21\u306b\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u30a2\u30c0\u30d7\u30bf\u30fc2\u3092\u6709\u52b9\u5316\u3057\u3066\u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u9078\u629e\u3057\u307e\u3059\u3002\u3053\u306e\u969b\u3001\u5148\u307b\u3069\u8ffd\u52a0\u3057\u305f\u65b9\u306e\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n\u6700\u5f8c\u306b\u3001USB\u3067USB\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3092\u7121\u52b9\u5316\u3057\u307e\u3059\u3002\n\n\n(\u30aa\u30d7\u30b7\u30e7\u30f3)NAT\u306e\u8a2d\u5b9a\u5909\u66f4\nVirtualBox\u306fNAT\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u306710.0.2.0/24\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u5272\u308a\u5f53\u3066\u307e\u3059\u3002\u3053\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30c9\u30ec\u30b9\u3092\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u5408\u306f\u3001VBoxManage\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002Windows\u3067\u306f\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u8d77\u52d5\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3059\u308b\u3068\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30c9\u30ec\u30b9\u3092192.168.156.0/24\u306b\u5909\u66f4\u3067\u304d\u307e\u3059\u3002\n\"C:\\Program Files\\Oracle\\VirtualBox\\VBoxManage\" modifyvm \"docker\" --natnet1 \"192.168.156/24\"\n\n\u307e\u305f\u3001\u30ce\u30fc\u30c8PC\u306a\u3069\u3092\u4f7f\u7528\u3057\u3066\u3044\u3066\u30db\u30b9\u30c8\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u7121\u7dda\u306a\u3069\u3067\u5207\u308a\u66ff\u308f\u308a\u3084\u3059\u3044\u74b0\u5883\u306e\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3053\u3068\u3067\u30b2\u30b9\u30c8\u306eDNS\u306e\u8a2d\u5b9a\u5909\u66f4\u304c\u5fc5\u8981\u306a\u304f\u306a\u308a\u307e\u3059\u3002\n\"C:\\Program Files\\Oracle\\VirtualBox\\VBoxManage\" modifyvm \"docker\" --natdnsproxy1 on\n\n\n3. Ubuntu 14.04 Server\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4f5c\u6210\u3057\u305fVM\u3092\u8d77\u52d5\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u6700\u521d\u306f\u8a00\u8a9e\u3092\u9078\u629e\u3057\u307e\u3059\u3002\u30ab\u30fc\u30bd\u30eb\u30ad\u30fc\u3067\u65e5\u672c\u8a9e\u3092\u9078\u3093\u3067\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\nUbuntu Server\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u9078\u629e\u3057\u3066\u72b6\u614b\u3067\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u30ab\u30fc\u30bd\u30eb\u30ad\u30fc\u3067Japanese\u3092\u9078\u629e\u3057\u3066\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u300c\u306f\u3044\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u300c\u65e5\u672c\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u300c\u3044\u3044\u3048\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u300c\u65e5\u672c\u8a9e\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u300c\u65e5\u672c\u8a9e\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u300ceth0\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u30db\u30b9\u30c8\u540d\u306f\u3053\u3053\u3067\u306f\u300cdocker\u300d\u306b\u5909\u66f4\u3057\u3066\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u3053\u3053\u3067\u306f\u300cdockeruser\u300d\u3068\u5165\u529b\u3057\u3066\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u300cdockeruser\u300d\u3068\u5165\u529b\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u305d\u306e\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\ndockeruser\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u9069\u5207\u306b\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u300c\u3044\u3044\u3048\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u300c\u306f\u3044\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u300c\u30c7\u30a3\u30b9\u30af\u5168\u4f53\u3092\u4f7f\u3044LVM\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3059\u308b\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u305d\u306e\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u300c\u306f\u3044\u300d\u3092\u9078\u629e\u3057\u3066\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u305d\u306e\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u300c\u306f\u3044\u300d\u3092\u9078\u629e\u3057\u3066\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u958b\u59cb\u3055\u308c\u308b\u306e\u3067\u3057\u3070\u3089\u304f\u5f85\u3064\u3068\u3001\u30d7\u30ed\u30ad\u30b7\u8a2d\u5b9a\u306e\u753b\u9762\u306b\u306a\u308a\u307e\u3059\u3002\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u5834\u5408\u306f\u305d\u306e\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u300c\u81ea\u52d5\u7684\u306b\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u306a\u3044\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u30b9\u30da\u30fc\u30b9\u30ad\u30fc\u3067\u300cOpenSSH Server\u300d\u3092\u9078\u629e\u3057\u3066\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u3057\u3070\u3089\u304f\u5f85\u3064\u3068\u4ee5\u4e0b\u306e\u753b\u9762\u306b\u306a\u308a\u307e\u3059\u3002\u300c\u306f\u3044\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u6700\u5f8c\u306b\u300c\u7d9a\u3051\u308b\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n\u3053\u308c\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n4. OS\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u306e\u521d\u671f\u8a2d\u5b9a\ndockeruser\u30e6\u30fc\u30b6\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u4f5c\u696d\u3057\u307e\u3059\u3002\n\u307e\u305a\u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30a2\u30c0\u30d7\u30bf\u30fc\u306b\u56fa\u5b9aIP\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u306f192.168.77.200\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u300csudo vi\u300d\u306a\u3069\u3057\u3066\u300c/etc/network/interfaces\u300d\u306b\u4ee5\u4e0b\u306e\u5185\u5bb9\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\nauto eth1\niface eth1 inet static\naddress 192.168.77.200\nnetwork 192.168.77.0\nnetmask 255.255.255.0\nbroadcast 192.168.77.255\n\n\u8ffd\u8a18\u3057\u305f\u3089\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u6709\u52b9\u5316\u3057\u307e\u3059\u3002\n$ sudo ifup eth1\n\n\u3053\u3053\u307e\u3067\u306e\u8a2d\u5b9a\u3067\u30db\u30b9\u30c8\u304b\u3089ssh\u3067192.168.77.200\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u6b21\u306b\u3001sudo\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\u4eca\u56de\u306fdockeruser\u30e6\u30fc\u30b6\u3067\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u529b\u306a\u3057\u3067\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n$ echo 'dockeruser ALL=(ALL) NOPASSWD:ALL' | sudo tee -a /etc/sudoers.d/dockeruser\n\n\u6b21\u306b\u3001grub\u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n$ sudo sed -ri 's/^GRUB_TIMEOUT=.*$/GRUB_TIMEOUT=0/' /etc/default/grub\n$ sudo update-grub\n\n\u6b21\u306b\u3001\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u66f4\u65b0\u3057\u3066\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ sudo apt-get update\n$ sudo apt-get -y upgrade\n$ sudo reboot\n\n\u6b21\u306b\u3001sshd\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\u4eca\u56de\u306fsshd\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092eth1\u306b\u9650\u5b9a\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\u3053\u308c\u306fUbuntu\u306esshd\u3068Docker\u30b3\u30f3\u30c6\u30ca\u306esshd\u306e\u7af6\u5408\u3092\u907f\u3051\u308b\u305f\u3081\u3067\u3059\u3002\n$ sudo sed -ri 's/^X11Forwarding\\s.*$/X11Forwarding no/g' /etc/ssh/sshd_config\n$ cat << 'EOT' | sudo tee -a /etc/ssh/sshd_config\nAddressFamily inet\nListenAddress 127.0.0.1\nListenAddress 192.168.77.200\nUseDNS no\nGSSAPIAuthentication no\nEOT\n$ sudo service ssh restart\n\n\u6b21\u306b\u3001VirtualBox\u306eGuest Additions\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002VirtualBox\u306e\u30e1\u30cb\u30e5\u30fc\u304b\u3089\u300cGuest Additions\u306eCD\u30a4\u30e1\u30fc\u30b8\u3092\u633f\u5165\u300d\u3092\u9078\u3093\u3067\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n$ sudo apt-get -y install build-essential module-assistant dkms\n$ sudo m-a prepare\n$ sudo mount /dev/cdrom /mnt\n$ sudo sh /mnt/VBoxLinuxAdditions.run --nox11\n$ sudo umount /mnt\n$ sudo eject\n$ sudo reboot\n\n\n5. ntp\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u6642\u523b\u540c\u671f\u306e\u305f\u3081\u306bntp\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ sudo sed -ri 's/^NTPSERVERS=.*$/NTPSERVERS=\"ntp.jst.mfeed.ad.jp\"/' /etc/default/ntpdate\n$ sudo apt-get -y install ntp\n$ cat <<'EOT' | sudo tee /etc/ntp.conf\ndriftfile /var/lib/ntp/ntp.drift\nstatistics loopstats peerstats clockstats\nfilegen loopstats file loopstats type day enable\nfilegen peerstats file peerstats type day enable\nfilegen clockstats file clockstats type day enable\nserver ntp1.jst.mfeed.ad.jp\nserver ntp2.jst.mfeed.ad.jp\nserver ntp3.jst.mfeed.ad.jp\nrestrict -4 default kod notrap nomodify nopeer noquery\nrestrict -6 default kod notrap nomodify nopeer noquery\nrestrict 127.0.0.1\nrestrict ::1\nEOT\n$ sudo service ntp restart\n\n\n6. Samba\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nWindows\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306bSamba\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u306fdockeruser\u30e6\u30fc\u30b6\u306b\u5bfe\u3057\u3066\u30d1\u30b9\u30ef\u30fc\u30c9\u304cdockeruser\u3067\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u306a\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u9069\u5b9c\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n$ sudo apt-get -y install samba\n$ cat <<'EOT' | sudo tee /etc/samba/smb.conf\n[global]\n        workgroup = MYGROUP\n        server string = %h server (Samba, Ubuntu)\n        wins support = no\n        dns proxy = no\n        interfaces = 192.168.77.0/24 eth1\n        bind interfaces only = yes\n        log file = /var/log/samba/log.%m\n        max log size = 1000\n        syslog = 0\n        panic action = /usr/share/samba/panic-action %d\n        server role = standalone server\n        passdb backend = tdbsam\n        obey pam restrictions = yes\n        unix password sync = no\n        map to guest = bad user\n        usershare allow guests = no\n        local master = no\n        os level = 1\n        preferred master = no\n        wins proxy = no\n        load printers = no\n        cups options = raw\n        printcap name = /dev/null\n        printing = bsd\n        disable spoolss = yes\n        max protocol = SMB2\n        smb ports = 445\n        disable netbios = yes\n        nmbd bind explicit broadcast = no\n        dos filetimes = yes\n\n[homes]\n        comment = Home Directories\n        browseable = no\n        valid users = %S\n        writable = yes\n        create mask = 0664\n        directory mask = 0775\nEOT\n$ sudo service smbd restart\n$ sudo service nmbd restart\n$ echo -e \"dockeruser\\ndockeruser\" | sudo pdbedit -a -t -u dockeruser\n\n\u8a2d\u5b9a\u304c\u5b8c\u4e86\u3057\u305f\u3089\u30db\u30b9\u30c8\u304b\u3089\u300c\\192.168.77.200\\dockeruser\u300d\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u3059\u3002\n\n7. Docker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u307e\u305a\u306f\u3058\u3081\u306bsysctl\u306e\u8a2d\u5b9a\u5909\u66f4\u3092\u884c\u3044\u307e\u3059\u3002\n$ sudo sed -ri 's/^#net.ipv4.ip_forward=1/net.ipv4.ip_forward=1/' /etc/sysctl.conf\n$ sudo sysctl net.ipv4.conf.all.forwarding=1\n\n\u6b21\u306b\u3001Docker\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ curl -sSL https://get.docker.com/ | sh\n$ sudo usermod -aG docker dockeruser\n$ newgrp docker\n$ newgrp dockeruser\n\n\n8. Vagrant\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u6b21\u306b\u3001Vagrant\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ curl -L https://dl.bintray.com/mitchellh/vagrant/vagrant_1.7.4_x86_64.deb -o vagrant_1.7.4_x86_64.deb\n$ echo -n 'dcd2c2b5d7ae2183d82b8b363979901474ba8d2006410576ada89d7fa7668336 vagrant_1.7.4_x86_64.deb' | sha256sum -c -\n$ sudo dpkg -i vagrant_1.7.4_x86_64.deb\n\n\u3042\u3068\u3067\u4f7f\u7528\u3059\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n$ vagrant plugin install vagrant-triggers\n\n\n9. Ansible\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4eca\u56de\u306f\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u30c4\u30fc\u30eb\u3068\u3057\u3066Ansible\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u307f\u307e\u3059\u3002\n$ sudo apt-get -y install software-properties-common\n$ sudo apt-add-repository -y ppa:ansible/ansible\n$ sudo apt-get update\n$ sudo apt-get -y install ansible\n\n\nVagrant\u7d4c\u7531\u3067Docker\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u7acb\u3061\u4e0a\u3052\u308b\nCentOS6\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u7acb\u3061\u4e0a\u3052\u3066\u307f\u307e\u3059\u3002dockeruser\u30e6\u30fc\u30b6\u306e\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6e96\u5099\u3057\u307e\u3059\u3002\n\u2514\u2500\u2500 vm1\n    \u251c\u2500\u2500 build\n    \u2514\u2500\u2500 data\n\n\u300cvm1/Vagrantfile\u300d\u3092\u4ee5\u4e0b\u306e\u5185\u5bb9\u3067\u4f5c\u6210\u3057\u307e\u3059\u3002Vagrantfile\u4e2d\u306eip_alias_index\u3001ip_alias_address\u3001d.name\u3092\u8abf\u6574\u3059\u308b\u3053\u3068\u3067\u5225\u306e\u30b3\u30f3\u30c6\u30ca\u3082\u540c\u69d8\u306b\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002\nip_alias_dev = \"eth1\"\nip_alias_index = \"1\"\nip_alias_address = \"192.168.77.201\"\nip_alias_netmask = \"24\"\n\nVagrant.configure(\"2\") do |config|\n  config.vm.synced_folder \"./data\", \"/vagrant\"\n  config.vm.provider \"docker\" do |d|\n    d.name = \"vm1\"\n    d.build_dir = \"./build\"\n    d.cmd = [ \"/usr/sbin/sshd\", \"-D\" ]\n    d.has_ssh = true\n    d.ports = []\n    for p in [ 22, 80, 443, 3306, 5432 ] do\n      d.ports.push(ip_alias_address + \":\" + p.to_s + \":\" + p.to_s)\n    end\n  end\n  config.trigger.before [:up] do\n    info 'Setting up ip alias ' + ip_alias_dev + ':' + ip_alias_index + ' ' + ip_alias_address + '/' + ip_alias_netmask\n    cmd = '/sbin/ip addr show ' + ip_alias_dev + ' >/dev/null 2>&1 && ((/sbin/ip addr show ' + ip_alias_dev + ' | grep -F \\'inet ' + ip_alias_address + '/' + ip_alias_netmask + '\\' >/dev/null 2>&1) || /usr/bin/sudo /sbin/ip addr add ' + ip_alias_address + '/' + ip_alias_netmask + ' dev ' + ip_alias_dev + ' label ' + ip_alias_dev + ':' + ip_alias_index + ')'\n    `#{cmd}`\n  end\nend\n\n\n\u300cvm1/build/Dockerfile\u300d\u3092\u4ee5\u4e0b\u306e\u5185\u5bb9\u3067\u4f5c\u6210\u3057\u307e\u3059\u3002\nFROM centos:centos6\nMAINTAINER sadapon2008 <sadapon2008@gmail.com>\n\nRUN echo 'include_only=.jp' >>/etc/yum/pluginconf.d/fastestmirror.conf\n\nRUN yum -y update\n\nRUN echo -n 'root:vagrant' | chpasswd\n\nRUN groupadd vagrant\nRUN useradd -g vagrant vagrant\nRUN echo -n 'vagrant:vagrant' | chpasswd\n\nRUN mkdir -p /home/vagrant/.ssh\nRUN echo 'ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ== vagrant insecure public key' > /home/vagrant/.ssh/authorized_keys\nRUN chown -R vagrant:vagrant /home/vagrant/.ssh\nRUN chmod 700 /home/vagrant/.ssh\nRUN chmod 600 /home/vagrant/.ssh/authorized_keys\n\nRUN yum -y install sudo\nRUN echo 'vagrant ALL=(ALL) NOPASSWD:ALL' >>/etc/sudoers.d/vagrant\n\nRUN yum -y install openssh-server openssh-clients\nRUN sed -ri 's/^#AddressFamily any/AddressFamily inet/' /etc/ssh/sshd_config\nRUN sed -ri 's/^#UseDNS yes/UseDNS no/' /etc/ssh/sshd_config\nRUN sed -ri 's/^GSSAPIAuthentication yes/GSSAPIAuthentication no/' /etc/ssh/sshd_config\nRUN service sshd start\nRUN service sshd stop\n\nRUN yum -y clean all\n\nEXPOSE 22\n\nCMD ['/usr/sbin/sshd', '-D']\n\n\u300cvm1\u300d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3057\u3066\u3001\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ cd ~/vm1\n$ vagrant up --provider=docker\n$ vagrant status\n\n\u30b3\u30f3\u30c6\u30ca\u3092\u505c\u6b62\u3059\u308b\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n$ cd ~/vm1\n$ vagrant halt\n$ vagrant status\n\n\nAnsible\u3067LAPP\u74b0\u5883\u3092\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3059\u308b\nCentOS6+Apache+PHP+PostgreSQL\u306eLAPP\u74b0\u5883\u3092Ansible\u3067\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3057\u3066\u307f\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u3001foo\u30e6\u30fc\u30b6(\u30d1\u30b9\u30ef\u30fc\u30c9\u3082foo)\u3092\u4f5c\u6210\u3057\u3001\u30b3\u30f3\u30c6\u30ca\u5185\u306e\u300c/vagrant\u300d\u4ee5\u4e0b\u306bApache\u3068PostgreSQL\u306e\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3059\u3002\u30b3\u30f3\u30c6\u30ca\u5185\u306e\u300c/vagrant\u300d\u306f\u300cvm1/data\u300d\u3068\u30ea\u30f3\u30af\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u30db\u30b9\u30c8\u304b\u3089Samba\u7d4c\u7531\u3067\u3053\u3053\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3053\u3068\u3067\u30bd\u30fc\u30b9\u306e\u7de8\u96c6\u306a\u3069\u304c\u53ef\u80fd\u3067\u3059\u3002(PostgreSQL\u306e\u30e6\u30fc\u30b6\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u306fpostgres\u3068postgres\u306b\u306a\u308a\u307e\u3059\u3002)\n$ sudo apt-get -y install git\n$ cd ~/vm1\n$ git clone https://github.com/sadapon2008/ansible-roles roles\n\n\u4ee5\u4e0b\u306e\u5185\u5bb9\u306e\u300cvm1/playbook.yml\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n---\n- name: for\n  hosts: all\n  sudo: yes\n  roles:\n    - { role: centos6-docker-common, main_username: \"{{ main_username }}\", main_password: \"{{ main_password }}\" }\n    - { role: centos6-apache, main_username: \"{{ main_username }}\", docroot: \"{{ docroot }}\", cake_env_mode: \"{{ cake_env_mode }}\" }\n    - { role: centos6-remi-php56 }\n    - { role: centos6-pgdg-postgresql94, dbroot: \"{{ dbroot }}\", permit_network: \"{{ permit_network }}\" }\n\n\n\u300cvm1/Vagrantfile\u300d\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\nip_alias_dev = \"eth1\"\nip_alias_index = \"1\"\nip_alias_address = \"192.168.77.201\"\nip_alias_netmask = \"24\"\n\nVagrant.configure(\"2\") do |config|\n  config.vm.synced_folder \"./data\", \"/vagrant\"\n  config.vm.provider \"docker\" do |d|\n    d.name = \"vm1\"\n    d.build_dir = \"./build\"\n    d.cmd = [ \"/usr/sbin/sshd\", \"-D\" ]\n    d.has_ssh = true\n    d.ports = []\n    for p in [ 22, 80, 443, 3306, 5432 ] do\n      d.ports.push(ip_alias_address + \":\" + p.to_s + \":\" + p.to_s)\n    end\n  end\n  config.trigger.before [:up] do\n    info 'Setting up ip alias ' + ip_alias_dev + ':' + ip_alias_index + ' ' + ip_alias_address + '/' + ip_alias_netmask\n    cmd = '/sbin/ip addr show ' + ip_alias_dev + ' >/dev/null 2>&1 && ((/sbin/ip addr show ' + ip_alias_dev + ' | grep -F \\'inet ' + ip_alias_address + '/' + ip_alias_netmask + '\\' >/dev/null 2>&1) || /usr/bin/sudo /sbin/ip addr add ' + ip_alias_address + '/' + ip_alias_netmask + ' dev ' + ip_alias_dev + ' label ' + ip_alias_dev + ':' + ip_alias_index + ')'\n    `#{cmd}`\n  end\n  config.vm.provision \"ansible\" do |ansible|\n    ansible.playbook = \"playbook.yml\"\n    ansible.extra_vars = {\n      main_username: 'foo',\n      main_password: `openssl passwd -salt salty -1 foo`,\n      docroot: '/vagrant/www/html/htdocs',\n      cake_env_mode: 'development',\n      dbroot: '/vagrant/lib/pgsql/9.4',\n      permit_network: '192.168.77.0/24'\n    }\n  end\nend\n\n\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u72b6\u614b\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3057\u307e\u3059\u3002\n$ cd ~/vm1\n$ vagrant provision\n\n\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u304c\u6210\u529f\u3059\u308b\u3068\u3001\u30db\u30b9\u30c8\u306e\u30d6\u30e9\u30a6\u30b6\u306a\u3069\u304b\u3089\u300chttp://192.168.77.201/\u300d\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u308a\u3001pgAdmin III\u306a\u3069\u3067192.168.77.201:5432\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u308a\u3067\u304d\u307e\u3059\u3002\n\n\u672a\u89e3\u6c7a\u306e\u554f\u984c\n\n\u30dd\u30fc\u30c8\u306e\u30de\u30c3\u30d7\u3092\u5909\u66f4\u3059\u308b\u306b\u306fDocker\u3067\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3057\u3066\u5225\u9014\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3057\u76f4\u3055\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3088\u3046\u3067\u3059(iptables\u30b3\u30de\u30f3\u30c9\u3092\u99c6\u4f7f\u3059\u308c\u3070\u3067\u304d\u306a\u3044\u3053\u3068\u3082\u306a\u3044\u3088\u3046\u3067\u3059\u304c\u30fb\u30fb\u30fb)\n\n# Docker on Vagrant on Ubuntu on VirtualBox\u306eLAMP(LAPP)\u958b\u767a\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\n\n## \u52d5\u6a5f\n\n\u666e\u6bb5\u306fWindows7+VirtualBox+Vagrant\u3067LAMP(LAPP)\u958b\u767a\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001VM\u304c\u5897\u3048\u3066\u30c7\u30a3\u30b9\u30af\u3092\u5727\u8feb\u3057\u3066\u304d\u305f\u306e\u3067\u3001Docker on Vagrant on Ubuntu on VirtualBox\u3067\u958b\u767a\u74b0\u5883\u3092\u8efd\u91cf\u5316\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u3001Vagrant\u3092\u4f7f\u7528\u3059\u308b\u611f\u899a\u3067Docker\u3092\u4f7f\u3048\u308b\u3053\u3068\u3092\u76ee\u6a19\u3068\u3057\u307e\u3059\u3002\n\n\u306a\u304a\u3001\u958b\u767a\u74b0\u5883\u306e\u69cb\u7bc9\u3092\u76ee\u7684\u3068\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u672c\u756a\u74b0\u5883\u3067Docker\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u306f\u60f3\u5b9a\u3057\u3066\u307e\u305b\u3093\u3002\n\n## \u524d\u63d0\n\n- VirtualBox\u3067VM\u30921\u53f0\u69cb\u7bc9\u3057\u3066\u305d\u308c\u4e0a\u306bUbuntu+Vagrant+Docker\u3092\u69cb\u7bc9\u3057\u307e\u3059\n- VM\u306b\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30c0\u30d7\u30bf\u30fc\u30922\u500b\u3064\u3051\u307e\u3059\n  - \u30a2\u30c0\u30d7\u30bf\u30fc1: NAT\n  - \u30a2\u30c0\u30d7\u30bf\u30fc2: \u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30a2\u30c0\u30d7\u30bf\u30fc\n- Docker\u306e\u30b3\u30f3\u30c6\u30ca\u306b\u306f\u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30a2\u30c0\u30d7\u30bf\u30fc\u7d4c\u7531\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3082\u306e\u3068\u3057\u307e\u3059\n  - \u305d\u306e\u305f\u3081\u30db\u30b9\u30c8\u4ee5\u5916\u306e\u30de\u30b7\u30f3\u304b\u3089\u306f\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u305b\u3093\n  - \u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30a2\u30c0\u30d7\u30bf\u30fc\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306f192.168.77.0/24\u3068\u3057\u3001IP\u30a2\u30c9\u30ec\u30b9\u306b192.168.77.200\u3092\u5272\u308a\u5f53\u3066\u307e\u3059\n  - Docker\u306e\u30b3\u30f3\u30c6\u30ca\u306b\u306f\u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30a2\u30c0\u30d7\u30bf\u30fc\u306eIP\u30a8\u30a4\u30ea\u30a2\u30b9\u3092\u5272\u308a\u5f53\u3066\u3066\u3044\u304d\u307e\u3059\n  - \u306a\u304a\u672a\u78ba\u8a8d\u3067\u3059\u304c\u3001\u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30a2\u30c0\u30d7\u30bf\u30fc\u306e\u66ff\u308f\u308a\u306b\u30d6\u30ea\u30c3\u30b8\u30a2\u30c0\u30d7\u30bf\u30fc\u306b\u3059\u308b\u3068\u30db\u30b9\u30c8\u4ee5\u5916\u306e\u30de\u30b7\u30f3\u304b\u3089\u3082\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u306b\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\n- VM\u306b\u306fUbuntu 14.04\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\n  - CentOS 7.1\u3067\u3082\u30c1\u30e3\u30ec\u30f3\u30b8\u3057\u307e\u3057\u305f\u304cdevice mapper\u306e\u6027\u80fd\u304c\u60aa\u304b\u3063\u305f\u306e\u3067aufs\u306eUbuntu\u3092\u9078\u3073\u307e\u3057\u305f\n- Ubuntu\u4e0a\u306b\u300cdockeruser\u300d\u3068\u3044\u3046\u4f5c\u696d\u7528\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3057\u3066\u305d\u306e\u30e6\u30fc\u30b6\u3067Vagrant\u3068Docker\u3092\u5229\u7528\u3057\u307e\u3059\n- LAMP(LAPP)\u74b0\u5883\u69cb\u7bc9\u306b\u306f\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u30c4\u30fc\u30eb\u306eAnsible\u3092\u5229\u7528\u3057\u307e\u3059\n- \u78ba\u8a8d\u3057\u305f\u74b0\u5883\u306fWindows7+VirtualBox 4.3.28\u3001\u78ba\u8a8d\u3057\u305f\u65e5\u4ed8\u306f2015\u5e748\u670831\u65e5\u3067\u3059\n\n## \u624b\u9806\n\n### 1. Ubuntu 14.04 Server\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb(ubuntu-14.04.3-server-amd64.iso)\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n- http://releases.ubuntu.com/14.04/\n\n### 2. VirtualBox\u3067VM\u3092\u4f5c\u6210\n\n\u307e\u305a\u3001\u4eca\u56de\u306e\u74b0\u5883\u7528\u306b\u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u65b0\u305f\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002VirtualBox\u30de\u30cd\u30fc\u30b8\u30e3\u30fc\u304b\u3089\u74b0\u5883\u8a2d\u5b9a\u3092\u958b\u304d\u307e\u3059\u3002\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u8ffd\u52a0\u3059\u308b\u30dc\u30bf\u30f3\u3067\u3001\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n![fig01.png](https://qiita-image-store.s3.amazonaws.com/0/54004/67c32298-9f6f-1e34-42cb-df8e72c393a3.png)\n\n\u8ffd\u52a0\u3057\u305f\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u9078\u629e\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306bDHCP\u3092\u30aa\u30d5\u306b\u3057\u305f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002(\u203b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30c9\u30ec\u30b9\u306f\u5404\u81ea\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u8abf\u6574\u3057\u3066\u304f\u3060\u3055\u3044\u3002)\n\n![fig02.png](https://qiita-image-store.s3.amazonaws.com/0/54004/62649ede-f782-db96-57fa-0b2c9457c0be.png)\n\n![fig03.png](https://qiita-image-store.s3.amazonaws.com/0/54004/43ffb599-aa91-485d-bd98-6a7308c22153.png)\n\n\u8a2d\u5b9a\u3057\u305f\u3089\u74b0\u5883\u8a2d\u5b9a\u3092\u9589\u3058\u307e\u3059\u3002\n\n\u6b21\u306b\u3001VM\u3092\u65b0\u898f\u4f5c\u6210\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u300cdocker\u300d\u3068\u3044\u3046\u540d\u524d\u3067\u4f5c\u6210\u3057\u307e\u3059\u3002OS\u306fUbuntu 64bit\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n![fig04.png](https://qiita-image-store.s3.amazonaws.com/0/54004/95d53cbd-4050-7a22-06e7-9fa7bf7ecbc9.png)\n\n\u30e1\u30e2\u30ea\u30fc\u30b5\u30a4\u30ba\u306f\u5404\u81ea\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u8abf\u6574\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u3053\u3067\u306f512MB\u3067\u9032\u3081\u307e\u3059\u3002\n\n![fig05.png](https://qiita-image-store.s3.amazonaws.com/0/54004/fb375f84-fe9d-2c43-9cbd-459694169ff5.png)\n\n\u4eee\u60f3\u30cf\u30fc\u30c9\u30c9\u30e9\u30a4\u30d6\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n![fig06.png](https://qiita-image-store.s3.amazonaws.com/0/54004/de6b4f10-3fd6-1c7d-cd05-998eccebfae8.png)\n\n\u3053\u3053\u3067\u306fVDI\u5f62\u5f0f\u306720GB\u306e\u53ef\u5909\u3067\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u5404\u81ea\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u8abf\u6574\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n![fig07.png](https://qiita-image-store.s3.amazonaws.com/0/54004/9a274bfb-afef-529a-687d-d6c68dd32fc3.png)\n\n![fig08.png](https://qiita-image-store.s3.amazonaws.com/0/54004/7c586981-529a-d9e7-e27c-2d601e562563.png)\n\n![fig09.png](https://qiita-image-store.s3.amazonaws.com/0/54004/5d671756-a516-433a-4b2c-40bf024fa5ab.png)\n\nVM\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001\u8d77\u52d5\u3059\u308b\u524d\u306b\u4e00\u90e8\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\n\u307e\u305a\u3001\u30b7\u30b9\u30c6\u30e0\u306e\u8d77\u52d5\u9806\u5e8f\u306e\u30d5\u30ed\u30c3\u30d4\u30fc\u306e\u30c1\u30a7\u30c3\u30af\u3092\u306f\u305a\u3057\u3001\u30dd\u30a4\u30f3\u30c6\u30a3\u30f3\u30b0\u30c7\u30d0\u30a4\u30b9\u3092PS/2 \u30de\u30a6\u30b9\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n![fig10.png](https://qiita-image-store.s3.amazonaws.com/0/54004/f144f465-2d50-f640-deb6-1ff77b37d070.png)\n\n\u6b21\u306b\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u306eCD/DVD\u30c9\u30e9\u30a4\u30d6\u3067Ubuntu 14.04\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb(ubuntu-14.04.3-server-amd64.iso)\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n![fig11.png](https://qiita-image-store.s3.amazonaws.com/0/54004/edf5ecc2-608b-8f73-f072-87c287291308.png)\n\n\u6b21\u306b\u3001\u30aa\u30fc\u30c7\u30a3\u30aa\u3092\u7121\u52b9\u5316\u3057\u307e\u3059\u3002\n\n![fig12.png](https://qiita-image-store.s3.amazonaws.com/0/54004/e680da28-b67b-0dd9-5d9d-997dcc199f61.png)\n\n\u6b21\u306b\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u30a2\u30c0\u30d7\u30bf\u30fc2\u3092\u6709\u52b9\u5316\u3057\u3066\u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u9078\u629e\u3057\u307e\u3059\u3002\u3053\u306e\u969b\u3001\u5148\u307b\u3069\u8ffd\u52a0\u3057\u305f\u65b9\u306e\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n![fig13.png](https://qiita-image-store.s3.amazonaws.com/0/54004/c12ca9b9-4c2a-a023-a0b9-1fc5df67ba30.png)\n\n\u6700\u5f8c\u306b\u3001USB\u3067USB\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3092\u7121\u52b9\u5316\u3057\u307e\u3059\u3002\n\n![fig14.png](https://qiita-image-store.s3.amazonaws.com/0/54004/ac2a40f4-061e-fb43-4e6a-e503de584174.png)\n\n### (\u30aa\u30d7\u30b7\u30e7\u30f3)NAT\u306e\u8a2d\u5b9a\u5909\u66f4\n\nVirtualBox\u306fNAT\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u306710.0.2.0/24\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u5272\u308a\u5f53\u3066\u307e\u3059\u3002\u3053\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30c9\u30ec\u30b9\u3092\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u5408\u306f\u3001VBoxManage\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002Windows\u3067\u306f\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u8d77\u52d5\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3059\u308b\u3068\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30c9\u30ec\u30b9\u3092192.168.156.0/24\u306b\u5909\u66f4\u3067\u304d\u307e\u3059\u3002\n\n```\n\"C:\\Program Files\\Oracle\\VirtualBox\\VBoxManage\" modifyvm \"docker\" --natnet1 \"192.168.156/24\"\n```\n\n\u307e\u305f\u3001\u30ce\u30fc\u30c8PC\u306a\u3069\u3092\u4f7f\u7528\u3057\u3066\u3044\u3066\u30db\u30b9\u30c8\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u7121\u7dda\u306a\u3069\u3067\u5207\u308a\u66ff\u308f\u308a\u3084\u3059\u3044\u74b0\u5883\u306e\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3053\u3068\u3067\u30b2\u30b9\u30c8\u306eDNS\u306e\u8a2d\u5b9a\u5909\u66f4\u304c\u5fc5\u8981\u306a\u304f\u306a\u308a\u307e\u3059\u3002\n\n```\n\"C:\\Program Files\\Oracle\\VirtualBox\\VBoxManage\" modifyvm \"docker\" --natdnsproxy1 on\n```\n\n### 3. Ubuntu 14.04 Server\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u4f5c\u6210\u3057\u305fVM\u3092\u8d77\u52d5\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n\u6700\u521d\u306f\u8a00\u8a9e\u3092\u9078\u629e\u3057\u307e\u3059\u3002\u30ab\u30fc\u30bd\u30eb\u30ad\u30fc\u3067\u65e5\u672c\u8a9e\u3092\u9078\u3093\u3067\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig15.png](https://qiita-image-store.s3.amazonaws.com/0/54004/4bed7573-776b-b499-0311-602b2639e148.png)\n\nUbuntu Server\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u9078\u629e\u3057\u3066\u72b6\u614b\u3067\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig16.png](https://qiita-image-store.s3.amazonaws.com/0/54004/769e5b54-8383-8427-ae35-af2366e35a22.png)\n\n\u30ab\u30fc\u30bd\u30eb\u30ad\u30fc\u3067Japanese\u3092\u9078\u629e\u3057\u3066\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig17.png](https://qiita-image-store.s3.amazonaws.com/0/54004/35dc4625-5063-647a-98bb-60f0271b9f46.png)\n\n\u300c\u306f\u3044\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig18.png](https://qiita-image-store.s3.amazonaws.com/0/54004/f244b6f0-c8c2-2373-b832-b74e74bc40f9.png)\n\n\u300c\u65e5\u672c\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig19.png](https://qiita-image-store.s3.amazonaws.com/0/54004/7c79ab38-1f89-6128-f28c-51b7c8bcfce5.png)\n\n\u300c\u3044\u3044\u3048\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig20.png](https://qiita-image-store.s3.amazonaws.com/0/54004/eea23d34-29dc-a4ff-dfd7-caf353198915.png)\n\n\u300c\u65e5\u672c\u8a9e\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig21.png](https://qiita-image-store.s3.amazonaws.com/0/54004/534a5dd4-5a54-bbe9-1a4a-1892ad5724f6.png)\n\n\u300c\u65e5\u672c\u8a9e\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig22.png](https://qiita-image-store.s3.amazonaws.com/0/54004/9703d331-43e8-8b36-66d6-43caa8461de1.png)\n\n\u300ceth0\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig23.png](https://qiita-image-store.s3.amazonaws.com/0/54004/a6887319-6b89-7550-4e81-6371aac10c0a.png)\n\n\u30db\u30b9\u30c8\u540d\u306f\u3053\u3053\u3067\u306f\u300cdocker\u300d\u306b\u5909\u66f4\u3057\u3066\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig24.png](https://qiita-image-store.s3.amazonaws.com/0/54004/7ead70ab-eb93-af88-e598-90d22ff042c9.png)\n\n\u3053\u3053\u3067\u306f\u300cdockeruser\u300d\u3068\u5165\u529b\u3057\u3066\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig25.png](https://qiita-image-store.s3.amazonaws.com/0/54004/6d19332c-b430-46b3-a646-de843458dbf3.png)\n\n\u300cdockeruser\u300d\u3068\u5165\u529b\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u305d\u306e\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig26.png](https://qiita-image-store.s3.amazonaws.com/0/54004/f09dd67e-8aaf-4da9-f6b5-a2809f07dd9e.png)\n\ndockeruser\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u9069\u5207\u306b\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig27.png](https://qiita-image-store.s3.amazonaws.com/0/54004/ab07ad73-27bd-ef8f-a683-c31ab65df518.png)\n\n\u300c\u3044\u3044\u3048\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig28.png](https://qiita-image-store.s3.amazonaws.com/0/54004/2ec42cda-0ba3-ce33-8620-8a371c17acdd.png)\n\n\u300c\u306f\u3044\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig29.png](https://qiita-image-store.s3.amazonaws.com/0/54004/fd0e8836-c4f8-f2bf-e9fe-b8cc4a2b3b45.png)\n\n\u300c\u30c7\u30a3\u30b9\u30af\u5168\u4f53\u3092\u4f7f\u3044LVM\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3059\u308b\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig30.png](https://qiita-image-store.s3.amazonaws.com/0/54004/5276efba-9288-f5ae-4ff5-9d7c1a2af447.png)\n\n\u305d\u306e\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig31.png](https://qiita-image-store.s3.amazonaws.com/0/54004/852c2750-a919-d5b2-4747-93d3c2d0d518.png)\n\n\u300c\u306f\u3044\u300d\u3092\u9078\u629e\u3057\u3066\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig32.png](https://qiita-image-store.s3.amazonaws.com/0/54004/bf1dc2f4-1da3-d71a-2075-72e0779776f2.png)\n\n\n\u305d\u306e\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig33.png](https://qiita-image-store.s3.amazonaws.com/0/54004/0d0087fd-e69f-118f-7909-3501429f8f09.png)\n\n\u300c\u306f\u3044\u300d\u3092\u9078\u629e\u3057\u3066\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig34.png](https://qiita-image-store.s3.amazonaws.com/0/54004/75765959-aa58-c06a-1608-dfc0bdc6e3fe.png)\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u958b\u59cb\u3055\u308c\u308b\u306e\u3067\u3057\u3070\u3089\u304f\u5f85\u3064\u3068\u3001\u30d7\u30ed\u30ad\u30b7\u8a2d\u5b9a\u306e\u753b\u9762\u306b\u306a\u308a\u307e\u3059\u3002\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u5834\u5408\u306f\u305d\u306e\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig35.png](https://qiita-image-store.s3.amazonaws.com/0/54004/6959686a-63ef-5154-14d1-19762239c935.png)\n\n\u300c\u81ea\u52d5\u7684\u306b\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u306a\u3044\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig36.png](https://qiita-image-store.s3.amazonaws.com/0/54004/b4b5a35b-49b3-eba7-efe5-d34b06fb3ce8.png)\n\n\u30b9\u30da\u30fc\u30b9\u30ad\u30fc\u3067\u300cOpenSSH Server\u300d\u3092\u9078\u629e\u3057\u3066\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig37.png](https://qiita-image-store.s3.amazonaws.com/0/54004/f339cd85-42f8-804f-4fb4-e16bc6cc0086.png)\n\n\u3057\u3070\u3089\u304f\u5f85\u3064\u3068\u4ee5\u4e0b\u306e\u753b\u9762\u306b\u306a\u308a\u307e\u3059\u3002\u300c\u306f\u3044\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig38.png](https://qiita-image-store.s3.amazonaws.com/0/54004/2b5a4cca-262e-7a78-14a7-d8fc743e01a3.png)\n\n\u6700\u5f8c\u306b\u300c\u7d9a\u3051\u308b\u300d\u3092\u9078\u629e\u3057\u305f\u307e\u307e\u30a8\u30f3\u30bf\u30fc\u30ad\u30fc\u3092\u62bc\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n![fig39.png](https://qiita-image-store.s3.amazonaws.com/0/54004/ddcef161-4781-6a55-faf6-0320fcdb08ff.png)\n\n\u3053\u308c\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n### 4. OS\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u306e\u521d\u671f\u8a2d\u5b9a\n\ndockeruser\u30e6\u30fc\u30b6\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u4f5c\u696d\u3057\u307e\u3059\u3002\n\n\u307e\u305a\u30db\u30b9\u30c8\u30aa\u30f3\u30ea\u30fc\u30a2\u30c0\u30d7\u30bf\u30fc\u306b\u56fa\u5b9aIP\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u306f192.168.77.200\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u300csudo vi\u300d\u306a\u3069\u3057\u3066\u300c/etc/network/interfaces\u300d\u306b\u4ee5\u4e0b\u306e\u5185\u5bb9\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\n```\nauto eth1\niface eth1 inet static\naddress 192.168.77.200\nnetwork 192.168.77.0\nnetmask 255.255.255.0\nbroadcast 192.168.77.255\n```\n\n\u8ffd\u8a18\u3057\u305f\u3089\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u6709\u52b9\u5316\u3057\u307e\u3059\u3002\n\n```\n$ sudo ifup eth1\n```\n\n\u3053\u3053\u307e\u3067\u306e\u8a2d\u5b9a\u3067\u30db\u30b9\u30c8\u304b\u3089ssh\u3067192.168.77.200\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u6b21\u306b\u3001sudo\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\u4eca\u56de\u306fdockeruser\u30e6\u30fc\u30b6\u3067\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u529b\u306a\u3057\u3067\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n$ echo 'dockeruser ALL=(ALL) NOPASSWD:ALL' | sudo tee -a /etc/sudoers.d/dockeruser\n```\n\n\u6b21\u306b\u3001grub\u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```\n$ sudo sed -ri 's/^GRUB_TIMEOUT=.*$/GRUB_TIMEOUT=0/' /etc/default/grub\n$ sudo update-grub\n```\n\n\u6b21\u306b\u3001\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u66f4\u65b0\u3057\u3066\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```\n$ sudo apt-get update\n$ sudo apt-get -y upgrade\n$ sudo reboot\n```\n\n\u6b21\u306b\u3001sshd\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\u4eca\u56de\u306fsshd\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092eth1\u306b\u9650\u5b9a\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\u3053\u308c\u306fUbuntu\u306esshd\u3068Docker\u30b3\u30f3\u30c6\u30ca\u306esshd\u306e\u7af6\u5408\u3092\u907f\u3051\u308b\u305f\u3081\u3067\u3059\u3002\n\n```\n$ sudo sed -ri 's/^X11Forwarding\\s.*$/X11Forwarding no/g' /etc/ssh/sshd_config\n$ cat << 'EOT' | sudo tee -a /etc/ssh/sshd_config\nAddressFamily inet\nListenAddress 127.0.0.1\nListenAddress 192.168.77.200\nUseDNS no\nGSSAPIAuthentication no\nEOT\n$ sudo service ssh restart\n```\n\n\u6b21\u306b\u3001VirtualBox\u306eGuest Additions\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002VirtualBox\u306e\u30e1\u30cb\u30e5\u30fc\u304b\u3089\u300cGuest Additions\u306eCD\u30a4\u30e1\u30fc\u30b8\u3092\u633f\u5165\u300d\u3092\u9078\u3093\u3067\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\n$ sudo apt-get -y install build-essential module-assistant dkms\n$ sudo m-a prepare\n$ sudo mount /dev/cdrom /mnt\n$ sudo sh /mnt/VBoxLinuxAdditions.run --nox11\n$ sudo umount /mnt\n$ sudo eject\n$ sudo reboot\n```\n\n### 5. ntp\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u6642\u523b\u540c\u671f\u306e\u305f\u3081\u306bntp\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n$ sudo sed -ri 's/^NTPSERVERS=.*$/NTPSERVERS=\"ntp.jst.mfeed.ad.jp\"/' /etc/default/ntpdate\n$ sudo apt-get -y install ntp\n$ cat <<'EOT' | sudo tee /etc/ntp.conf\ndriftfile /var/lib/ntp/ntp.drift\nstatistics loopstats peerstats clockstats\nfilegen loopstats file loopstats type day enable\nfilegen peerstats file peerstats type day enable\nfilegen clockstats file clockstats type day enable\nserver ntp1.jst.mfeed.ad.jp\nserver ntp2.jst.mfeed.ad.jp\nserver ntp3.jst.mfeed.ad.jp\nrestrict -4 default kod notrap nomodify nopeer noquery\nrestrict -6 default kod notrap nomodify nopeer noquery\nrestrict 127.0.0.1\nrestrict ::1\nEOT\n$ sudo service ntp restart\n```\n\n\n### 6. Samba\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nWindows\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306bSamba\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u306fdockeruser\u30e6\u30fc\u30b6\u306b\u5bfe\u3057\u3066\u30d1\u30b9\u30ef\u30fc\u30c9\u304cdockeruser\u3067\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u306a\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u9069\u5b9c\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\n$ sudo apt-get -y install samba\n$ cat <<'EOT' | sudo tee /etc/samba/smb.conf\n[global]\n        workgroup = MYGROUP\n        server string = %h server (Samba, Ubuntu)\n        wins support = no\n        dns proxy = no\n        interfaces = 192.168.77.0/24 eth1\n        bind interfaces only = yes\n        log file = /var/log/samba/log.%m\n        max log size = 1000\n        syslog = 0\n        panic action = /usr/share/samba/panic-action %d\n        server role = standalone server\n        passdb backend = tdbsam\n        obey pam restrictions = yes\n        unix password sync = no\n        map to guest = bad user\n        usershare allow guests = no\n        local master = no\n        os level = 1\n        preferred master = no\n        wins proxy = no\n        load printers = no\n        cups options = raw\n        printcap name = /dev/null\n        printing = bsd\n        disable spoolss = yes\n        max protocol = SMB2\n        smb ports = 445\n        disable netbios = yes\n        nmbd bind explicit broadcast = no\n        dos filetimes = yes\n\n[homes]\n        comment = Home Directories\n        browseable = no\n        valid users = %S\n        writable = yes\n        create mask = 0664\n        directory mask = 0775\nEOT\n$ sudo service smbd restart\n$ sudo service nmbd restart\n$ echo -e \"dockeruser\\ndockeruser\" | sudo pdbedit -a -t -u dockeruser\n```\n\n\u8a2d\u5b9a\u304c\u5b8c\u4e86\u3057\u305f\u3089\u30db\u30b9\u30c8\u304b\u3089\u300c\\\\192.168.77.200\\dockeruser\u300d\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u3059\u3002\n\n### 7. Docker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u307e\u305a\u306f\u3058\u3081\u306bsysctl\u306e\u8a2d\u5b9a\u5909\u66f4\u3092\u884c\u3044\u307e\u3059\u3002\n\n```\n$ sudo sed -ri 's/^#net.ipv4.ip_forward=1/net.ipv4.ip_forward=1/' /etc/sysctl.conf\n$ sudo sysctl net.ipv4.conf.all.forwarding=1\n```\n\n\u6b21\u306b\u3001Docker\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n$ curl -sSL https://get.docker.com/ | sh\n$ sudo usermod -aG docker dockeruser\n$ newgrp docker\n$ newgrp dockeruser\n```\n\n### 8. Vagrant\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u6b21\u306b\u3001Vagrant\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n$ curl -L https://dl.bintray.com/mitchellh/vagrant/vagrant_1.7.4_x86_64.deb -o vagrant_1.7.4_x86_64.deb\n$ echo -n 'dcd2c2b5d7ae2183d82b8b363979901474ba8d2006410576ada89d7fa7668336 vagrant_1.7.4_x86_64.deb' | sha256sum -c -\n$ sudo dpkg -i vagrant_1.7.4_x86_64.deb\n```\n\n\u3042\u3068\u3067\u4f7f\u7528\u3059\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n$ vagrant plugin install vagrant-triggers\n```\n\n### 9. Ansible\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u4eca\u56de\u306f\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u30c4\u30fc\u30eb\u3068\u3057\u3066Ansible\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\n$ sudo apt-get -y install software-properties-common\n$ sudo apt-add-repository -y ppa:ansible/ansible\n$ sudo apt-get update\n$ sudo apt-get -y install ansible\n```\n\n## Vagrant\u7d4c\u7531\u3067Docker\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u7acb\u3061\u4e0a\u3052\u308b\n\nCentOS6\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u7acb\u3061\u4e0a\u3052\u3066\u307f\u307e\u3059\u3002dockeruser\u30e6\u30fc\u30b6\u306e\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6e96\u5099\u3057\u307e\u3059\u3002\n\n```\n\u2514\u2500\u2500 vm1\n    \u251c\u2500\u2500 build\n    \u2514\u2500\u2500 data\n```\n\n\u300cvm1/Vagrantfile\u300d\u3092\u4ee5\u4e0b\u306e\u5185\u5bb9\u3067\u4f5c\u6210\u3057\u307e\u3059\u3002Vagrantfile\u4e2d\u306eip_alias_index\u3001ip_alias_address\u3001d.name\u3092\u8abf\u6574\u3059\u308b\u3053\u3068\u3067\u5225\u306e\u30b3\u30f3\u30c6\u30ca\u3082\u540c\u69d8\u306b\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002\n\n\n```\nip_alias_dev = \"eth1\"\nip_alias_index = \"1\"\nip_alias_address = \"192.168.77.201\"\nip_alias_netmask = \"24\"\n\nVagrant.configure(\"2\") do |config|\n  config.vm.synced_folder \"./data\", \"/vagrant\"\n  config.vm.provider \"docker\" do |d|\n    d.name = \"vm1\"\n    d.build_dir = \"./build\"\n    d.cmd = [ \"/usr/sbin/sshd\", \"-D\" ]\n    d.has_ssh = true\n    d.ports = []\n    for p in [ 22, 80, 443, 3306, 5432 ] do\n      d.ports.push(ip_alias_address + \":\" + p.to_s + \":\" + p.to_s)\n    end\n  end\n  config.trigger.before [:up] do\n    info 'Setting up ip alias ' + ip_alias_dev + ':' + ip_alias_index + ' ' + ip_alias_address + '/' + ip_alias_netmask\n    cmd = '/sbin/ip addr show ' + ip_alias_dev + ' >/dev/null 2>&1 && ((/sbin/ip addr show ' + ip_alias_dev + ' | grep -F \\'inet ' + ip_alias_address + '/' + ip_alias_netmask + '\\' >/dev/null 2>&1) || /usr/bin/sudo /sbin/ip addr add ' + ip_alias_address + '/' + ip_alias_netmask + ' dev ' + ip_alias_dev + ' label ' + ip_alias_dev + ':' + ip_alias_index + ')'\n    `#{cmd}`\n  end\nend\n\n```\n\n\u300cvm1/build/Dockerfile\u300d\u3092\u4ee5\u4e0b\u306e\u5185\u5bb9\u3067\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\n```\nFROM centos:centos6\nMAINTAINER sadapon2008 <sadapon2008@gmail.com>\n\nRUN echo 'include_only=.jp' >>/etc/yum/pluginconf.d/fastestmirror.conf\n\nRUN yum -y update\n\nRUN echo -n 'root:vagrant' | chpasswd\n\nRUN groupadd vagrant\nRUN useradd -g vagrant vagrant\nRUN echo -n 'vagrant:vagrant' | chpasswd\n\nRUN mkdir -p /home/vagrant/.ssh\nRUN echo 'ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ== vagrant insecure public key' > /home/vagrant/.ssh/authorized_keys\nRUN chown -R vagrant:vagrant /home/vagrant/.ssh\nRUN chmod 700 /home/vagrant/.ssh\nRUN chmod 600 /home/vagrant/.ssh/authorized_keys\n\nRUN yum -y install sudo\nRUN echo 'vagrant ALL=(ALL) NOPASSWD:ALL' >>/etc/sudoers.d/vagrant\n\nRUN yum -y install openssh-server openssh-clients\nRUN sed -ri 's/^#AddressFamily any/AddressFamily inet/' /etc/ssh/sshd_config\nRUN sed -ri 's/^#UseDNS yes/UseDNS no/' /etc/ssh/sshd_config\nRUN sed -ri 's/^GSSAPIAuthentication yes/GSSAPIAuthentication no/' /etc/ssh/sshd_config\nRUN service sshd start\nRUN service sshd stop\n\nRUN yum -y clean all\n\nEXPOSE 22\n\nCMD ['/usr/sbin/sshd', '-D']\n```\n\n\u300cvm1\u300d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3057\u3066\u3001\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n\n```\n$ cd ~/vm1\n$ vagrant up --provider=docker\n$ vagrant status\n```\n\n\u30b3\u30f3\u30c6\u30ca\u3092\u505c\u6b62\u3059\u308b\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```\n$ cd ~/vm1\n$ vagrant halt\n$ vagrant status\n```\n\n## Ansible\u3067LAPP\u74b0\u5883\u3092\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3059\u308b\n\nCentOS6+Apache+PHP+PostgreSQL\u306eLAPP\u74b0\u5883\u3092Ansible\u3067\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3057\u3066\u307f\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u3001foo\u30e6\u30fc\u30b6(\u30d1\u30b9\u30ef\u30fc\u30c9\u3082foo)\u3092\u4f5c\u6210\u3057\u3001\u30b3\u30f3\u30c6\u30ca\u5185\u306e\u300c/vagrant\u300d\u4ee5\u4e0b\u306bApache\u3068PostgreSQL\u306e\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3059\u3002\u30b3\u30f3\u30c6\u30ca\u5185\u306e\u300c/vagrant\u300d\u306f\u300cvm1/data\u300d\u3068\u30ea\u30f3\u30af\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u30db\u30b9\u30c8\u304b\u3089Samba\u7d4c\u7531\u3067\u3053\u3053\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3053\u3068\u3067\u30bd\u30fc\u30b9\u306e\u7de8\u96c6\u306a\u3069\u304c\u53ef\u80fd\u3067\u3059\u3002(PostgreSQL\u306e\u30e6\u30fc\u30b6\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u306fpostgres\u3068postgres\u306b\u306a\u308a\u307e\u3059\u3002)\n\n```\n$ sudo apt-get -y install git\n$ cd ~/vm1\n$ git clone https://github.com/sadapon2008/ansible-roles roles\n```\n\n\u4ee5\u4e0b\u306e\u5185\u5bb9\u306e\u300cvm1/playbook.yml\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\n```\n---\n- name: for\n  hosts: all\n  sudo: yes\n  roles:\n    - { role: centos6-docker-common, main_username: \"{{ main_username }}\", main_password: \"{{ main_password }}\" }\n    - { role: centos6-apache, main_username: \"{{ main_username }}\", docroot: \"{{ docroot }}\", cake_env_mode: \"{{ cake_env_mode }}\" }\n    - { role: centos6-remi-php56 }\n    - { role: centos6-pgdg-postgresql94, dbroot: \"{{ dbroot }}\", permit_network: \"{{ permit_network }}\" }\n\n```\n\n\u300cvm1/Vagrantfile\u300d\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```\nip_alias_dev = \"eth1\"\nip_alias_index = \"1\"\nip_alias_address = \"192.168.77.201\"\nip_alias_netmask = \"24\"\n\nVagrant.configure(\"2\") do |config|\n  config.vm.synced_folder \"./data\", \"/vagrant\"\n  config.vm.provider \"docker\" do |d|\n    d.name = \"vm1\"\n    d.build_dir = \"./build\"\n    d.cmd = [ \"/usr/sbin/sshd\", \"-D\" ]\n    d.has_ssh = true\n    d.ports = []\n    for p in [ 22, 80, 443, 3306, 5432 ] do\n      d.ports.push(ip_alias_address + \":\" + p.to_s + \":\" + p.to_s)\n    end\n  end\n  config.trigger.before [:up] do\n    info 'Setting up ip alias ' + ip_alias_dev + ':' + ip_alias_index + ' ' + ip_alias_address + '/' + ip_alias_netmask\n    cmd = '/sbin/ip addr show ' + ip_alias_dev + ' >/dev/null 2>&1 && ((/sbin/ip addr show ' + ip_alias_dev + ' | grep -F \\'inet ' + ip_alias_address + '/' + ip_alias_netmask + '\\' >/dev/null 2>&1) || /usr/bin/sudo /sbin/ip addr add ' + ip_alias_address + '/' + ip_alias_netmask + ' dev ' + ip_alias_dev + ' label ' + ip_alias_dev + ':' + ip_alias_index + ')'\n    `#{cmd}`\n  end\n  config.vm.provision \"ansible\" do |ansible|\n    ansible.playbook = \"playbook.yml\"\n    ansible.extra_vars = {\n      main_username: 'foo',\n      main_password: `openssl passwd -salt salty -1 foo`,\n      docroot: '/vagrant/www/html/htdocs',\n      cake_env_mode: 'development',\n      dbroot: '/vagrant/lib/pgsql/9.4',\n      permit_network: '192.168.77.0/24'\n    }\n  end\nend\n```\n\n\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u72b6\u614b\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3057\u307e\u3059\u3002\n\n```\n$ cd ~/vm1\n$ vagrant provision\n```\n\n\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u304c\u6210\u529f\u3059\u308b\u3068\u3001\u30db\u30b9\u30c8\u306e\u30d6\u30e9\u30a6\u30b6\u306a\u3069\u304b\u3089\u300chttp://192.168.77.201/\u300d\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u308a\u3001pgAdmin III\u306a\u3069\u3067192.168.77.201:5432\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u308a\u3067\u304d\u307e\u3059\u3002\n\n## \u672a\u89e3\u6c7a\u306e\u554f\u984c\n\n- \u30dd\u30fc\u30c8\u306e\u30de\u30c3\u30d7\u3092\u5909\u66f4\u3059\u308b\u306b\u306fDocker\u3067\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3057\u3066\u5225\u9014\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3057\u76f4\u3055\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3088\u3046\u3067\u3059(iptables\u30b3\u30de\u30f3\u30c9\u3092\u99c6\u4f7f\u3059\u308c\u3070\u3067\u304d\u306a\u3044\u3053\u3068\u3082\u306a\u3044\u3088\u3046\u3067\u3059\u304c\u30fb\u30fb\u30fb)\n", "tags": ["Ansible", "vagrant", "docker", "Ubuntu", "lamp"]}