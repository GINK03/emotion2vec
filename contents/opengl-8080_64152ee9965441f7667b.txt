{"context": "OutOfMemoryError (\u4ee5\u4e0b OOME)\u304c\u8d77\u3053\u3063\u305f\u3068\u304d\u306b\u304a\u624b\u4e0a\u3052\u72b6\u614b\u306b\u306a\u3089\u306a\u3044\u305f\u3081\u306b\u3082\u3001 Java \u306e\u30e1\u30e2\u30ea\u7ba1\u7406\u306e\u4ed5\u7d44\u307f\u3068\u304b\u3001 OOME \u304c\u8d77\u3053\u3063\u305f\u3068\u304d\u306e\u8abf\u67fb\u65b9\u6cd5\u3068\u304b\u3092\u8abf\u3079\u308b\u3002\n\n\u74b0\u5883\n\nOS\nWindows 7\n\nJava\n> java -version\njava version \"1.8.0_74\"\nJava(TM) SE Runtime Environment (build 1.8.0_74-b02)\nJava HotSpot(TM) 64-Bit Server VM (build 25.74-b02, mixed mode)\n\nJava 8 \u3067\u3001 Oracle \u306e JVM \u3092\u524d\u63d0\u3068\u3057\u305f\u8a71\u3067\u3059\u3002\n\nJava \u306e\u30e1\u30e2\u30ea\u7ba1\u7406\n\u3053\u308c\u3092\u77e5\u3063\u3066\u304a\u304b\u306a\u3044\u3068\u3001 OOME \u304c\u8d77\u3053\u3063\u3066\u3082\u3001\u30e1\u30e2\u30ea\u5185\u3067\u4f55\u304c\u8d77\u3053\u3063\u3066\u3044\u3066\u3001\u3069\u3053\u3092\u8abf\u67fb\u3059\u3079\u304d\u3067\u3001\u3069\u306e\u3088\u3046\u306b\u5bfe\u51e6\u3057\u305f\u3089\u3044\u3044\u306e\u304b\u304c\u5224\u65ad\u3067\u304d\u306a\u3044\u3002\n\u306a\u306e\u3067\u3001\u307e\u305a\u306f\u3001\u305d\u3082\u305d\u3082 Java \u304c\u3069\u3046\u3084\u3063\u3066\u30e1\u30e2\u30ea\u3092\u7ba1\u7406\u3057\u3066\u3044\u308b\u306e\u304b\u3092\u77e5\u308b\u3002\n\u3057\u304b\u3057\u3001\u5b9f\u969b\u8abf\u3079\u3066\u307f\u305f\u3089\u4e88\u60f3\u901a\u308a\u3068\u3044\u3046\u304b\u306a\u3093\u3068\u3044\u3046\u304b\u3001\u91cf\u304c\u591a\u304f\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u3002\n\u306a\u306e\u3067\u3001\u500b\u3005\u306e\u7528\u8a9e\u306e\u8aac\u660e\u306f\u672b\u5c3e\u306e \u7528\u8a9e\u96c6 \u306b\u62bc\u3057\u8fbc\u3081\u305f\u306e\u3067\u3001\u3053\u3053\u3067\u306f\u3056\u3063\u304f\u308a\u3068\u3057\u305f\u6982\u8981\u3060\u3051\u8a18\u8f09\u3059\u308b\u3002\n\n\u30e1\u30e2\u30ea\u306e\u69cb\u9020\n\n\u8d85\u3056\u3063\u304f\u308a\u3068\u3057\u305f\u3001\u30e1\u30e2\u30ea\u69cb\u9020\u3092\u8868\u3057\u305f\u56f3\u3002\n\u304a\u304a\u304d\u304f\u3001\u30d2\u30fc\u30d7\uff08Heap\uff09\u9818\u57df\u3068\u30cd\u30a4\u30c6\u30a3\u30d6\uff08Native\uff09\u9818\u57df\u306e\uff12\u3064\u306e\u9818\u57df\u304c\u3042\u308b\u3002\n\u30d2\u30fc\u30d7\u306f Java \u30d7\u30ed\u30b0\u30e9\u30e0\u304c\u4f7f\u3046\u9818\u57df\u3067\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u4e0a\u3067\u751f\u6210\u3057\u305f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u3001\u3053\u306e\u30d2\u30fc\u30d7\u9818\u57df\u306b\u914d\u7f6e\u3055\u308c\u308b\u3002\n\u4e00\u65b9\u3001\u30cd\u30a4\u30c6\u30a3\u30d6\u9818\u57df\u306f JVM \u304c\u52d5\u304f\u306e\u306b\u5fc5\u8981\u306a\u30e1\u30e2\u30ea\u3084\u30b9\u30ec\u30c3\u30c9\u306e\u30b9\u30bf\u30c3\u30af\u3092\u7ba1\u7406\u3059\u308b\u306e\u306b\u4f7f\u7528\u3055\u308c\u308b\u3002\n\n\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\n\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\uff08\u4ee5\u4e0b GC\uff09\u3068\u306f\u3001\u30d2\u30fc\u30d7\u9818\u57df\u306b\u5b58\u5728\u3059\u308b\u4f7f\u308f\u308c\u3066\u3044\u306a\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u898b\u3064\u3051\u51fa\u3057\u3001\u81ea\u52d5\u3067\u524a\u9664\u3057\u3066\u304f\u308c\u308b\u4ed5\u7d44\u307f\u3092\u8a00\u3046\u3002\n\u4e00\u53e3\u306b GC \u3068\u8a00\u3063\u3066\u3082\u3001\n\nMinor GC\nMajor GC\nFull GC\nScavenge GC\nCopy GC\nMark & Sweep GC\nSerial GC\nParallel GC\nConcurrent GC\n\n\u3068\u304b\u3044\u3063\u3071\u3044\u3042\u3063\u3066\u3001\u521d\u898b\u3060\u3068\u308f\u3051\u304c\u308f\u304b\u3089\u306a\u304f\u306a\u308b\u3002\n\u3053\u306e\u8fba\u306e\u9055\u3044\u3092\u7406\u89e3\u3057\u3066\u3044\u306a\u3044\u3068\u3001\u3044\u3056\u30e1\u30e2\u30ea\u306e\u72b6\u614b\u3084\u767a\u751f\u3057\u305f GC \u306e\u60c5\u5831\u3068\u304b\u3092\u898b\u3066\u3082\u3001\u610f\u5473\u304c\u5206\u304b\u3089\u306a\u304f\u9014\u65b9\u306b\u66ae\u308c\u3066\u3057\u307e\u3046\u3002\n\u306a\u306e\u3067\u3001\u3053\u308c\u3089\u306e\u9055\u3044\u306b\u3064\u3044\u3066\u3082\u77e5\u3063\u3066\u304a\u3044\u305f\u307b\u3046\u304c\u826f\u3044\u3068\u601d\u3046\u3002\n\u500b\u3005\u306e\u610f\u5473\u306f \u7528\u8a9e\u96c6 \u306b\u307e\u3068\u3081\u305f\u306e\u3067\u3001\u305d\u3061\u3089\u3092\u53c2\u7167\u306e\u3053\u3068\u3002\n\nOOME \u306e\u7a2e\u985e\nOOME \u306f\u69d8\u3005\u306a\u8981\u56e0\u3067\u767a\u751f\u3059\u308b\u3002\n\n\u30d2\u30fc\u30d7\u9818\u57df\u304c\u8db3\u308a\u306a\u304f\u306a\u3063\u305f\u3002\n\nPermanent \u9818\u57df\u304c\u8db3\u308a\u306a\u304f\u306a\u3063\u305f\uff08Java 7 \u307e\u3067\uff09\nFull GC \u304c\u9ad8\u983b\u5ea6\u3067\u5b9f\u884c\u3055\u308c\u305f\u3002\n\u30b9\u30ec\u30c3\u30c9\u3092\u5927\u91cf\u306b\u4f5c\u308a\u3059\u304e\u3066\u30cd\u30a4\u30c6\u30a3\u30d6\u30e1\u30e2\u30ea\u304c\u8db3\u308a\u306a\u304f\u306a\u3063\u305f\u3002\netc...\n\n\u4eca\u56de\u306f\u3001\u306a\u3093\u3060\u304b\u3093\u3060\u3067\u958b\u767a\u3057\u3066\u3066\u4e00\u756a\u906d\u9047\u3059\u308b\u983b\u5ea6\u304c\u591a\u3044\u3068\uff08\u52dd\u624b\u306b\uff09\u601d\u3063\u3066\u3044\u308b\u3001\u30d2\u30fc\u30d7\u304c\u8db3\u308a\u306a\u3044\u30b1\u30fc\u30b9\u306b\u7d5e\u3063\u3066\u8abf\u67fb\u65b9\u6cd5\u3068\u5bfe\u51e6\u65b9\u6cd5\u3092\u52c9\u5f37\u3059\u308b\u3002\n\u203b\u4eca\u5f8c\u3001\u5358\u306b OOME \u3068\u66f8\u3044\u305f\u5834\u5408\u3001\u305d\u308c\u306f\u30d2\u30fc\u30d7\u4e0d\u8db3\u3092\u7531\u6765\u3068\u3059\u308b OOME \u306e\u3053\u3068\u3092\u6307\u3057\u307e\u3059\u3002\n\nOOME \u304c\u767a\u751f\u3059\u308b\u8981\u56e0\n\u304a\u304a\u307e\u304b\u306b\u8a00\u3046\u3068\u3001\u4ee5\u4e0b\u306e\u3044\u305a\u308c\u304b\u306b\u306a\u308b\u3002\n\n\u5358\u7d14\u306b\u30e1\u30e2\u30ea\u304c\u8db3\u308a\u3066\u3044\u306a\u3044\u3002\n\u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u554f\u984c\u304c\u3042\u308a\u3001\u30e1\u30e2\u30ea\u306e\u89e3\u653e\u5fd8\u308c\u3084\u4e0d\u8981\u306a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5927\u91cf\u751f\u6210\u306a\u3069\u304c\u767a\u751f\u3057\u3066\u3044\u308b\u3002\n\n\u524d\u8005\u306a\u3089\u3001\u5358\u7d14\u306b\u30d2\u30fc\u30d7\u9818\u57df\u3092\u5897\u3084\u305b\u3070\u3044\u3044\u3002\n\uff08\u53b3\u5bc6\u306b\u306f\u3001\u7121\u99c4\u306b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4fdd\u6301\u3057\u3066\u3044\u3066\u6539\u826f\u306e\u4f59\u5730\u304c\u3042\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u304c\u3001\u4eca\u56de\u306f\u305d\u3053\u307e\u3067\u306f\u8003\u3048\u306a\u3044\uff09\n\u5f8c\u8005\u306e\u5834\u5408\u306f\u3001\u554f\u984c\u7b87\u6240\u3092\u7279\u5b9a\u3057\u3066\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u6539\u4fee\u3057\u306a\u3051\u308c\u3070\u3001\u3069\u3093\u306a\u306b\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba\u3092\u5897\u3084\u3057\u3066\u3082\u610f\u5473\u304c\u7121\u3044\uff08\u5834\u5408\u306b\u3088\u3063\u3066\u306f\u89e3\u6c7a\u3059\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u3051\u3069\u3001\u6839\u672c\u89e3\u6c7a\u306b\u306f\u306a\u3089\u306a\u3044\uff09\u3002\n\u767a\u751f\u3057\u305f OOME \u304c\u3069\u3061\u3089\u3092\u539f\u56e0\u3068\u3057\u3066\u308b\u304b\u3092\u8abf\u3079\u308b\u305f\u3081\u306b\u306f\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30e1\u30e2\u30ea\u306e\u72b6\u614b\u3092\u8abf\u67fb\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\n\n\u554f\u984c\u306e\u5207\u308a\u5206\u3051\u65b9\n\n\u554f\u984c\u306a\u3055\u305d\u3046\u306a\u30d2\u30fc\u30d7\n\n\n\u30d2\u30fc\u30d7\u306e\u4f7f\u7528\u91cf\u304c\u540c\u3058\u9ad8\u3055\u306e\u6ce2\u72b6\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u3001\u52d5\u3044\u3066\u3044\u308b\u9650\u308a\u5c11\u3057\u305a\u3064\u3060\u304c\u30d2\u30fc\u30d7\u3092\u6d88\u8cbb\u3057\u3066\u3044\u304f\u3002\n\u3057\u304b\u3057\u3001\u3042\u308b\u7a0b\u5ea6\u3059\u308b\u3068\u30de\u30a4\u30ca\u30fc\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u304c\u767a\u52d5\u3059\u308b\u3002\n\n\n\u3059\u308b\u3068\u3001\u4f7f\u3063\u3066\u3044\u306a\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u524a\u9664\u3055\u308c\u308b\u306e\u3067\u3001\u305d\u306e\u5206\u306e\u9818\u57df\u304c\u78ba\u4fdd\u3055\u308c\u308b\u3053\u3068\u306b\u306a\u308b\u3002\n\n\n\u30b0\u30e9\u30d5\u304c\u5c71\u306b\u306a\u308b\u306e\u306f\u3001\u3053\u306e\u30de\u30a4\u30ca\u30fc\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u7e70\u308a\u8fd4\u3057\u3066\u3044\u308b\u305f\u3081\u3002\nGC \u5f8c\u306e\u30e1\u30e2\u30ea\u9818\u57df\u304c\u4e00\u5b9a\u3068\u3044\u3046\u3053\u3068\u306f\u3001\u4e0d\u8981\u306a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u3061\u3083\u3093\u3068\u6bce\u56de\u89e3\u653e\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u3092\u8868\u3057\u3066\u3044\u308b\u3002\n\n\n\u5358\u7d14\u306b\u30b5\u30a4\u30ba\u304c\u8db3\u308a\u306a\u3055\u305d\u3046\n\n\u8d77\u52d5\u6642\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba\u3092\u5897\u3084\u3057\u305f\u7d50\u679c\u3001\u2191\u306e\u554f\u984c\u306a\u3055\u305d\u3046\u306a\u30d2\u30fc\u30d7\u306e\u5f62\u306b\u843d\u3061\u7740\u3044\u305f\u5834\u5408\u3001\u5358\u7d14\u306b\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba\u304c\u8db3\u308a\u3066\u3044\u306a\u304b\u3063\u305f\u3068\u3044\u3046\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002\n\u305f\u3060\u3057\u3001\u300c\u7121\u99c4\u306b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3057\u3066\u3044\u305f\u300d\u3068\u3044\u3046\u53ef\u80fd\u6027\u3082\u3042\u308b\u306e\u3067\u3001\u5c11\u306a\u304f\u3068\u3082 OOME \u304c\u767a\u751f\u3057\u305f\u5834\u6240\u306f\u7279\u5b9a\u3057\u3066\u304a\u3044\u305f\u307b\u3046\u304c\u3044\u3044\u3068\u601d\u3046\u3002\n\n\n\u30e1\u30e2\u30ea\u30ea\u30fc\u30af\u3063\u307d\u3044\u30d2\u30fc\u30d7\n\n\n\u30d2\u30fc\u30d7\u306e\u4f7f\u7528\u91cf\u304c\u53f3\u80a9\u4e0a\u304c\u308a\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\u4f55\u56de\u304b GC \u304c\u767a\u52d5\u3057\u3066\u3044\u308b\u304c\u3001\u305d\u306e\u305f\u3073\u306b\u6700\u4f4e\u5024\u304c\u4e0a\u6607\u3057\u3066\u3044\u3063\u3066\u3044\u308b\u3002\n\n\n\u4e0a\u6607\u3057\u305f\u5206\u3060\u3051\u3001\u958b\u653e\u3055\u308c\u3066\u3044\u306a\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u5b58\u5728\u3057\u3066\u3044\u308b\u3068\u3044\u3046\u3053\u3068\u3092\u8868\u3057\u3066\u3044\u308b\u3002\n\n\n\u3053\u3046\u306a\u308b\u3068\u3001\u3069\u3053\u304b\u306b\u89e3\u653e\u6f0f\u308c\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u3042\u308b\u3053\u3068\u3092\u7591\u3063\u305f\u65b9\u304c\u3044\u3044\u3002\n\n\n\u30d0\u30ab\u3067\u304b\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u3063\u305f\n\n\nOOME \u304c\u767a\u751f\u3059\u308b\u307e\u3067\u306f\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba\u306f\u5b89\u5b9a\u3057\u3066\u3044\u305f\u306e\u306b\u3001\u3044\u304d\u306a\u308a\u7206\u767a\u7684\u306b\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba\u304c\u5927\u304d\u304f\u306a\u3063\u3066\u843d\u3061\u305f\u3088\u3046\u306a\u72b6\u614b\u3002\n\u30d0\u30ab\u3067\u304b\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u3044\u304d\u306a\u308a\u751f\u6210\uff08\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3093\u3067\u30e1\u30e2\u30ea\u4e0a\u306b\u5168\u3066\u5c55\u958b\u3057\u305f\u3068\u304b\uff09\u3057\u305f\u305b\u3044\u3067\u3001\u30e1\u30e2\u30ea\u304c\u8db3\u308a\u306a\u304f\u306a\u308a\u843d\u3061\u308b\u3068\u3044\u3046\u30b1\u30fc\u30b9\u3002\n\u3053\u306e\u5834\u5408\u306f\u3001 OOME \u304c\u767a\u751f\u3057\u305f\u77ac\u9593\u306e\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u53d6\u5f97\u3057\u3066\u304a\u3044\u3066\u3001\u539f\u56e0\u7b87\u6240\u3092\u7279\u5b9a\u3057\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u30ed\u30b8\u30c3\u30af\u3092\u4fee\u6b63\u3059\u308b\u3002\n\n\n\u30e1\u30e2\u30ea\u30ea\u30fc\u30af\u3057\u306a\u3044\u306e\u3067\u3042\u308c\u3070\u3001\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba\u3092\u5897\u3084\u3057\u3066\u5bfe\u5fdc\u3068\u3044\u3046\u306e\u3082\u3042\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\n\n\n\n\u8abf\u67fb\u306b\u5229\u7528\u3067\u304d\u308b\u30c4\u30fc\u30eb\u985e\u306e\u4f7f\u3044\u65b9\n\n\u9006\u5f15\u304d\n\n\u30d2\u30fc\u30d7\u4f7f\u7528\u91cf\u306e\u5909\u5316\u3092\u78ba\u8a8d\u3059\u308b\n\njconsole\nGC \u30ed\u30b0\u3068 GC Viwer\njstat\nHeapStats\njvisualvm\n\n\nOOME \u306e\u767a\u751f\u5834\u6240\u7279\u5b9a\u3059\u308b\n\n\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u306e\u53d6\u5f97\n\n\njcmd\njmap\nOOME \u304c\u767a\u751f\u3057\u305f\u3068\u304d\u306b\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u53d6\u5f97\u3059\u308b\n\n\nHeapStats\njvisualvm\nEclipse Memory Analyzer\n\n\njcmd\nJDK7 \u304b\u3089\u306b\u4ed8\u5c5e\u3057\u3066\u3044\u308b\u30c4\u30fc\u30eb\u3002\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u304b\u3089\u5b9f\u884c\u3059\u308b\u3002\nJDK7 \u4ee5\u964d\u306a\u3089\u3001\u57fa\u672c\u306f\u3053\u306e\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3046\u3002\nJVM \u3092\u6307\u5b9a\u3057\u3066\u30e1\u30e2\u30ea\u6d88\u8cbb\u91cf\u306e\u591a\u3044\u3082\u306e\u9806\u306b\u30af\u30e9\u30b9\u3092\u30ea\u30b9\u30c8\u30a2\u30c3\u30d7\u3057\u305f\u308a\u3067\u304d\u308b\u3002\n\n\u57fa\u672c\u69cb\u6587\n> jcmd <pid | main class> <command> [options]\n\n\n\u4f8b\n> jcmd 1234 GC.heap_dump heap.hprof\n\n\n\n\npid \u307e\u305f\u306f main class \u306f\u5fc5\u9808\u3060\u304c\u3001\u7279\u306b\u6307\u5b9a\u3067\u304d\u308b\u30d7\u30ed\u30bb\u30b9\u304c\u7121\u3044\u306e\u3067\u3042\u308c\u3070 0 \u3092\u6307\u5b9a\u3067\u304d\u308b\u3002\n\n0 \u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u73fe\u5728\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u5168\u3066\u306e Java \u30d7\u30ed\u30bb\u30b9\u304c\u5bfe\u8c61\u306b\u306a\u308b\u3002\n\u53b3\u5bc6\u306b\u306f\u3001\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b JVM \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3054\u3068\u306b\u6307\u5b9a\u3067\u304d\u308b\u30b3\u30de\u30f3\u30c9\u304c\u7570\u306a\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u306e\u3067\u3001\u30d7\u30ed\u30bb\u30b9\u3054\u3068\u306b pid \u3092\u6307\u5b9a\u3057\u3066\u30d8\u30eb\u30d7\u3084\u5b9f\u884c\u3067\u304d\u308b\u30b3\u30de\u30f3\u30c9\u4e00\u89a7\u3092\u78ba\u8a8d\u3057\u305f\u307b\u3046\u304c\u78ba\u5b9f\u3002\n\n\n\u4f7f\u7528\u3067\u304d\u308b\u30b3\u30de\u30f3\u30c9\u3092\u4e00\u89a7\u3067\u78ba\u8a8d\u3059\u308b\n> jcmd 0 help\n4136:\nThe following commands are available:\nJFR.stop\nJFR.start\nJFR.dump\nJFR.check\nVM.native_memory\nVM.check_commercial_features\nVM.unlock_commercial_features\nManagementAgent.stop\nManagementAgent.start_local\nManagementAgent.start\nGC.rotate_log\nThread.print\nGC.class_stats\nGC.class_histogram\nGC.heap_dump\nGC.run_finalization\nGC.run\nVM.uptime\nVM.flags\nVM.system_properties\nVM.command_line\nVM.version\nhelp\n\nFor more information about a specific command use 'help <command>'.\n\n\n\u30b3\u30de\u30f3\u30c9\u306e\u30d8\u30eb\u30d7\u3092\u78ba\u8a8d\u3059\u308b\n> jcmd 0 help GC.heap_dump\n4136:\nGC.heap_dump\nGenerate a HPROF format dump of the Java heap.\n\nImpact: High: Depends on Java heap size and content. Request a full GC unless the '-all' option is specified.\n\nPermission: java.lang.management.ManagementPermission(monitor)\n\nSyntax : GC.heap_dump [options] <filename>\n\nArguments:\n        filename :  Name of the dump file (STRING, no default value)\n\nOptions: (options must be specified using the <key> or <key>=<value> syntax)\n        -all : [optional] Dump all objects, including unreachable objects (BOOLEAN, false)\n\n\n\u73fe\u5728\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b Java \u30d7\u30ed\u30bb\u30b9\u3092\u8868\u793a\u3059\u308b\n> jcmd -l\n4136\n12748 sun.tools.jcmd.JCmd -l\n\n\n\njps \u306e\u4ee3\u308f\u308a\u306b\u3053\u3061\u3089\u3082\u3064\u304b\u3048\u308b\u3002\n\n\n\u30b7\u30b9\u30c6\u30e0\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5168\u3066\u51fa\u529b\u3059\u308b\n> jcmd 12636 VM.system_properties\n12636:\n#Mon Mar 07 23:51:16 JST 2016\njava.vendor=Oracle Corporation\nsun.java.launcher=SUN_STANDARD\n\uff08\u4ee5\u4e0b\u7565\uff09\n\n\nVM \u306e\u30d5\u30e9\u30b0\u3092\u5168\u3066\u51fa\u529b\u3059\u308b\n> jcmd 12636 VM.flags\n12636:\n-XX:CICompilerCount=4 -XX:InitialHeapSize=268435456 -XX:MaxHeapSize=536870912 -XX:MaxNewSize=178782208 -XX:MinHeapDeltaBytes=524288 -XX:NewSize=89128960 -XX:OldSize=179306496 -XX:+PrintGC -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseFastUnorderedTimeStamps -XX:-UseLargePagesIndividualAllocation -XX:+UseParallelGC\n\n\n\u30af\u30e9\u30b9\u30fb\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u3092\u51fa\u529b\u3059\u308b\n> jcmd 12636 GC.class_histogram > class_histogram.txt\n\n\nclass_histogram.txt\n12636:\n\n num     #instances         #bytes  class name\n----------------------------------------------\n   1:         63670        5482832  [C\n   2:          5782        1799000  [B\n   3:         19643        1728584  java.lang.reflect.Method\n   4:         63355        1520520  java.lang.String\n   5:         11215        1253456  java.lang.Class\n   6:         36380        1164160  java.util.HashMap$Node\n   7:         13166        1138904  [Ljava.util.HashMap$Node;\n   8:         18932         757280  java.util.LinkedHashMap$Entry\n   9:         22985         735520  java.util.concurrent.ConcurrentHashMap$Node\n  10:         11475         718880  [Ljava.lang.Object;\n\uff08\u4ee5\u4e0b\u7565\uff09\n\n\n\n\u30af\u30e9\u30b9\u3054\u3068\u306b\u30e1\u30e2\u30ea\u6d88\u8cbb\u91cf\u306e\u591a\u3044\u3082\u306e\u9806\u306b\u4e00\u89a7\u3092\u8868\u793a\u3059\u308b\u3002\n\n\n\n[C \u3068 [B \u306f\u3001\u305f\u3076\u3093 char \u3068 byte \u306e\u914d\u5217\n\n\nVM \u3078\u306e\u8ca0\u8377\u306f\u5927\u304d\u3044\u3002\n\n\n\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u53d6\u5f97\u3059\u308b\n\n> jcmd 12636 GC.heap_dump heapdmp.hprof\n\n\n\u30b3\u30de\u30f3\u30c9\u306e\u5f15\u6570\u306b\u51fa\u529b\u5148\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u6307\u5b9a\u3059\u308b\u3002\n\u76f8\u5bfe\u30d1\u30b9\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u5bfe\u8c61\u306e VM \u306e\u30ab\u30ec\u30f3\u30c8\u30d5\u30a9\u30eb\u30c0\u304c\u8d77\u70b9\u306b\u306a\u308b\u306e\u3067\u6ce8\u610f\uff08jcmd \u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u5834\u6240\u3067\u306f\u306a\u3044\uff09\u3002\nVM \u3078\u306e\u8ca0\u8377\u306f\u5927\u304d\u3044\u3002\n\njmap \u30b3\u30de\u30f3\u30c9\u3067\u3082\u53d6\u5f97\u3067\u304d\u308b\u3051\u3069\u3001 jcmd \u3092\u4f7f\u3046\u65b9\u304c\u63a8\u5968\u3089\u3057\u3044\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001 Full GC \u304c\u5b9f\u884c\u3055\u308c\u305f\u3046\u3048\u3067\u30c0\u30f3\u30d7\u304c\u53d6\u5f97\u3055\u308c\u308b\u3002\n\n\nGC \u3092\u5b9f\u884c\u3055\u305b\u305a\u306b\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u53d6\u5f97\u3059\u308b\n> jcmd 12636 GC.heap_dump -all heapdmp.hprof\n\n\n\n-all \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u308b\u3068\u3001 GC \u3092\u5b9f\u884c\u3055\u305b\u305a\u306b\u3001\u305d\u306e\u307e\u307e\u306e\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u53d6\u5f97\u3067\u304d\u308b\u3002\n\n\n\u5168\u3066\u306e\u30b9\u30ec\u30c3\u30c9\u306e\u30b9\u30bf\u30c3\u30af\u30c8\u30ec\u30fc\u30b9\u3092\u51fa\u529b\u3059\u308b\n> jcmd 12636 Thread.print > ThreadPrint.txt\n\n\nThreadPrint.txt\n12636:\n2016-03-08 00:04:45\nFull thread dump Java HotSpot(TM) 64-Bit Server VM (25.74-b02 mixed mode):\n\n\"cached5\" #125 prio=5 os_prio=0 tid=0x0000000060209000 nid=0x2e7c waiting on condition [0x000000006610e000]\n   java.lang.Thread.State: WAITING (parking)\n    at sun.misc.Unsafe.park(Native Method)\n    - parking to wait for  <0x00000000e0432a40> (a java.util.concurrent.SynchronousQueue$TransferStack)\n    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\n    at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:458)\n    at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)\n\uff08\u4ee5\u4e0b\u7565\uff09\n\n\n\nVM \u3078\u306e\u5f71\u97ff\u306f\u4e2d\u7a0b\u5ea6\u3002\n\n\njmap\nJDK \u306b\u4ed8\u5c5e\u3057\u3066\u3044\u308b\u30c4\u30fc\u30eb\u3002JDK 6 \u4ee5\u524d\u306e VM \u304b\u3089\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u53d6\u3063\u305f\u308a\u3057\u305f\u3044\u5834\u5408\u306f\u3053\u3061\u3089\u3092\u4f7f\u3046\u3002\n\uff08Java 7 \u4ee5\u4e0a\u306f jcmd \u3092\u4f7f\u3046\uff09\n\n\u57fa\u672c\u69cb\u6587\n> jmap [option] <pid>\n\n\n\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u53d6\u5f97\u3059\u308b\n\n> jmap -dump:format=b,file=my_heap_dump.hprof 5192\n\n\n\n-dump:format=b \u306f\u56fa\u5b9a\u3002\n\nfile=<\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9> \u3067\u3001\u30c0\u30f3\u30d7\u30d5\u30a1\u30a4\u30eb\u306e\u51fa\u529b\u5148\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n\n\u30d2\u30fc\u30d7\u9818\u57df\u306e\u60c5\u5831\u3092\u51fa\u529b\u3059\u308b\n> jmap -heap 5192\nAttaching to process ID 5192, please wait...\nDebugger attached successfully.\nServer compiler detected.\nJVM version is 25.74-b02\n\nusing thread-local object allocation.\nParallel GC with 8 thread(s)\n\nHeap Configuration:\n   MinHeapFreeRatio         = 0\n   MaxHeapFreeRatio         = 100\n   MaxHeapSize              = 536870912 (512.0MB)\n   NewSize                  = 89128960 (85.0MB)\n   MaxNewSize               = 178782208 (170.5MB)\n   OldSize                  = 179306496 (171.0MB)\n   NewRatio                 = 2\n   SurvivorRatio            = 8\n   MetaspaceSize            = 21807104 (20.796875MB)\n   CompressedClassSpaceSize = 1073741824 (1024.0MB)\n   MaxMetaspaceSize         = 17592186044415 MB\n   G1HeapRegionSize         = 0 (0.0MB)\n\nHeap Usage:\nPS Young Generation\nEden Space:\n   capacity = 128974848 (123.0MB)\n   used     = 18571016 (17.71070098876953MB)\n   free     = 110403832 (105.28929901123047MB)\n   14.398943893308562% used\nFrom Space:\n   capacity = 21495808 (20.5MB)\n   used     = 0 (0.0MB)\n   free     = 21495808 (20.5MB)\n   0.0% used\nTo Space:\n   capacity = 20971520 (20.0MB)\n   used     = 0 (0.0MB)\n   free     = 20971520 (20.0MB)\n   0.0% used\nPS Old Generation\n   capacity = 241172480 (230.0MB)\n   used     = 26622312 (25.389015197753906MB)\n   free     = 214550168 (204.6109848022461MB)\n   11.038702259893002% used\n\n21472 interned Strings occupying 1915464 bytes.\n\n\n\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u3092\u51fa\u529b\u3059\u308b\n> jmap -histo 5192 > histogram.txt\n\n\nhistogram.txt\n num     #instances         #bytes  class name\n----------------------------------------------\n   1:         11178       17514456  [I\n   2:         71332        6582488  [C\n   3:          6461        2612328  [B\n   4:         19673        1731224  java.lang.reflect.Method\n   5:         67223        1613352  java.lang.String\n   6:         11220        1254040  java.lang.Class\n   7:         36592        1170944  java.util.HashMap$Node\n   8:         13409        1154280  [Ljava.util.HashMap$Node;\n   9:         17503         980168  java.util.concurrent.ConcurrentHashMap$ValueIterator\n  10:         13625         841032  [Ljava.lang.Object;\n  11:         18958         758320  java.util.LinkedHashMap$Entry\n  12:         22981         735392  java.util.concurrent.ConcurrentHashMap$Node\n  13:         13674         656352  java.util.HashMap\n  14:         10003         560168  java.util.LinkedHashMap\n  15:         28543         456688  java.lang.Object\n  16:          6327         455544  java.lang.reflect.Field\n\uff08\u4ee5\u4e0b\u7565\uff09\n\n\n\njstat\nJDK \u306b\u4ed8\u5c5e\u3057\u3066\u3044\u308b\u30b3\u30de\u30f3\u30c9\u30c4\u30fc\u30eb\u3002\nJVM \u306e\u7d71\u8a08\u60c5\u5831\u3092\u30e2\u30cb\u30bf\u30fc\u3067\u304d\u308b\u3002\u8a66\u9a13\u7684\u306a\u3082\u306e\u3067\u3001\u30b5\u30dd\u30fc\u30c8\u5bfe\u8c61\u5916\u3089\u3057\u3044\u3002\n\n\u57fa\u672c\n\n\u69cb\u6587\uff08\u7c21\u6613\u7248\uff09\n> jstat <startOption> <pid> [interval[s|ms]] [count]\n\n\n\n\u4f8b\n> jstat -gc 1776\n S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT\n19456.0 21504.0 17170.9  0.0   131584.0 52202.1   182784.0   20159.6   49792.0 48738.2 6528.0 6377.2      6    0.079   2      0.118    0.197\n\n\n\n\u76e3\u8996\u3057\u305f\u3044\u5185\u5bb9\u3054\u3068\u306b startOption \u3092\u5207\u308a\u66ff\u3048\u308b\u3002\n\npid \u306f\u3001\u5bfe\u8c61\u306e JVM \u306e\u30d7\u30ed\u30bb\u30b9ID\u3002\n\n\n\u4e00\u5b9a\u9593\u9694\u3067\u51fa\u529b\u3059\u308b\n> jstat -class 32024 1s\nLoaded  Bytes  Unloaded  Bytes     Time\n 10613 18500.1        0     0.0       5.03\n 10613 18500.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n\uff08\u4ee5\u4e0b\u6c38\u9060\u306b\u7d9a\u304f\uff09\n\n\n\npid \u306e\u5f8c\u308d\u306b 1s \u3068\u304b 100ms \u3068\u304b\u66f8\u304f\u3068\u3001\u305d\u306e\u9593\u9694\u3067\u7e70\u308a\u8fd4\u3057\u60c5\u5831\u3092\u51fa\u529b\u3067\u304d\u308b\u3002\n\u6642\u9593\u306e\u5358\u4f4d\uff08s or ms\uff09\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u30df\u30ea\u79d2\u6271\u3044\u306b\u306a\u308b\u3002\n\n\n\u6307\u5b9a\u56de\u6570\u51fa\u529b\u3057\u305f\u3089\u7d42\u4e86\u3059\u308b\n> jstat -class 32024 1s 3\nLoaded  Bytes  Unloaded  Bytes     Time\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n\n>\n\n\n\ninterval \u306e\u5f8c\u308d\u306b\u6570\u5024\u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u305d\u306e\u6570\u3060\u3051\u51fa\u529b\u3057\u305f\u3089\u76e3\u8996\u3092\u7d42\u4e86\u3055\u305b\u3089\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306f\u7121\u9650\u3001\u3064\u307e\u308a\u6c38\u9060\u306b\u76e3\u8996\u3092\u7d9a\u3051\u308b\u3002\n\n\n\u6307\u5b9a\u56de\u6570\u3054\u3068\u306b\u30d8\u30c3\u30c0\u30fc\u3092\u518d\u8868\u793a\u3059\u308b\n> jstat -class -h5 32024 1s\nLoaded  Bytes  Unloaded  Bytes     Time\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\nLoaded  Bytes  Unloaded  Bytes     Time\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n\uff08\u7701\u7565\uff09\n\n\n\nstartOption \u3068 pid \u306e\u9593\u306b -h<\u8868\u793a\u9593\u9694> \u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u6307\u5b9a\u3057\u305f\u8868\u793a\u9593\u9694\u3054\u3068\u306b\u30d8\u30c3\u30c0\u30fc\u304c\u518d\u8868\u793a\u3055\u308c\u308b\u3002\n\n\n\u5404 startOption\n\u3044\u304f\u3064\u304b\u306e\u7a2e\u985e\u304c\u3042\u308b\u304c\u3001\u51fa\u529b\u5185\u5bb9\u304c\u91cd\u8907\u3057\u3066\u3044\u308b\u3082\u306e\u3082\u3042\u308a\u3001\u3069\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u4f55\u3092\u51fa\u529b\u3059\u308b\u306e\u304b\u304c\u308f\u304b\u308a\u3065\u3089\u3044\u3002\n\u306a\u306e\u3067\u3001\u8868\u306b\u307e\u3068\u3081\u305f\u3002\n\u8868\u306b\u306a\u3044\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u3064\u3044\u3066\u306f \u516c\u5f0f\u306e help \u3092\u53c2\u7167\u3002\n\n\u81ea\u5206\u304c\u78ba\u8a8d\u3057\u305f\u3044\u60c5\u5831\u3092\u6c7a\u3081\u3066\u3001\u305d\u308c\u3092\u51fa\u529b\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u9078\u629e\u3059\u308c\u3070\u3044\u3044\u3068\u601d\u3046\u3002\n\njvisualvm\nJVM \u306e\u72b6\u614b\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b GUI \u3067\u5206\u6790\uff08\u30d7\u30ed\u30d5\u30a1\u30a4\u30ea\u30f3\u30b0\uff09\u3059\u308b\u305f\u3081\u306e\u30c4\u30fc\u30eb\u3002\nJDK \u306b\u4ed8\u5c5e\u3057\u3066\u3044\u308b\u3002\n\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067 jvisualvm \u3068\u5165\u529b\u3059\u308c\u3070\u5b9f\u884c\u3067\u304d\u308b\uff08\u30d1\u30b9\u304c\u901a\u3063\u3066\u3044\u308c\u3070\uff09\u3002\n\n\u5de6\u306e\u300c\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u300d\u306b\u3001\u73fe\u5728\u30ed\u30fc\u30ab\u30eb\u3067\u8d77\u52d5\u3057\u3066\u3044\u308b JVM \u304c\u4e00\u89a7\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u3002\n\u8abf\u67fb\u3057\u305f\u3044 JVM \u3092\u30c0\u30d6\u30eb\u30af\u30ea\u30c3\u30af\u3057\u3066\u958b\u304f\u3068\u3001\u305d\u306e JVM \u306b\u63a5\u7d9a\u3057\u3066\u8abf\u67fb\u3092\u958b\u59cb\u3067\u304d\u308b\u3002\n\u30bf\u30d6\u3054\u3068\u306b\u3001\u8272\u3005\u306a\u60c5\u5831\u304c\u898b\u308c\u308b\u3002\n\n\n\n\u30bf\u30d6\u540d\n\u5185\u5bb9\n\n\n\n\n\u6982\u8981\n\u5bfe\u8c61\u306e JVM \u306e\u57fa\u672c\u7684\u306a\u60c5\u5831\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n\n\u76e3\u8996\nCPU \u5229\u7528\u72b6\u6cc1\u30fb\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u30fb\u30af\u30e9\u30b9\u30ed\u30fc\u30c9\u6570\u30fb\u30b9\u30ec\u30c3\u30c9\u306e\u72b6\u6cc1\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n\n\u30b9\u30ec\u30c3\u30c9\n\u5404\u30b9\u30ec\u30c3\u30c9\u306e\u72b6\u614b\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n\n\u30b5\u30f3\u30d7\u30e9\u30fb\u30d7\u30ed\u30d5\u30a1\u30a4\u30e9\nCPU \u4f7f\u7528\u7387\u3068\u30e1\u30e2\u30ea\u4f7f\u7528\u7387\u306e\u8a73\u7d30\u306a\u60c5\u5831\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n\n\n\n\u30b5\u30f3\u30d7\u30e9\u3068\u30d7\u30ed\u30d5\u30a1\u30a4\u30e9\u306e\u9055\u3044\n\u30b5\u30f3\u30d7\u30e9\u306f\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3078\u306e\u5f71\u97ff\u304c\u5c0f\u3055\u3044\u304c\u3001\u60c5\u5831\u304c\u6f0f\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30e9\u306f\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3078\u306e\u5f71\u97ff\u304c\u5927\u304d\u3044\u304c\u3001\u60c5\u5831\u306b\u6f0f\u308c\u304c\u306a\u3044\u3002\n\u30b5\u30f3\u30d7\u30e9\u306f\u3001\u5b9a\u671f\u7684\u306b JVM \u304b\u3089\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066\u7d50\u679c\u3092\u51fa\u529b\u3059\u308b\u3002\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30e9\u306f\u3001\u76e3\u8996\u60c5\u5831\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b\u9001\u4fe1\u3059\u308b\u3088\u3046\u306b\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30d0\u30a4\u30c8\u30b3\u30fc\u30c9\u3092\u66f8\u304d\u5909\u3048\u308b\u3002\n\u30b5\u30f3\u30d7\u30e9\u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u5bfe\u3059\u308b\u5f71\u97ff\u304c\u5c0f\u3055\u304f\u6bd4\u8f03\u7684\u9ad8\u901f\u306b\u52d5\u4f5c\u3059\u308b\u304c\u3001\u60c5\u5831\u3092\u53d6\u5f97\u3057\u305f\u77ac\u9593\u306e\u60c5\u5831\u3057\u304b\u53d6\u308c\u306a\u3044\u3002\n\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066\u3044\u306a\u3044\u6642\u9593\u306b\u3001\u305f\u307e\u305f\u307e\u30db\u30c3\u30c8\u30b9\u30dd\u30c3\u30c8\u3068\u306a\u308b\u90e8\u5206\u304c\u5b9f\u884c\u3055\u308c\u3066\u3044\u305f\u308a\u3059\u308b\u3068\u3001\u305d\u306e\u5206\u306e\u60c5\u5831\u304c\u6f0f\u308c\u308b\u3053\u3068\u306b\u306a\u308b\u3002\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30e9\u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30d0\u30a4\u30c8\u30b3\u30fc\u30c9\u3092\u3044\u3058\u308b\u305f\u3081\u5f71\u97ff\u3092\u4e0e\u3048\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u3001\u304b\u3064\u52d5\u4f5c\u306b\u6642\u9593\u3082\u304b\u304b\u308b\u3002\n\u3057\u304b\u3057\u3001\u968f\u6642\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089\u60c5\u5831\u304c\u9023\u643a\u3055\u308c\u308b\u306e\u3067\u30b5\u30f3\u30d7\u30e9\u3068\u6bd4\u8f03\u3057\u3066\u60c5\u5831\u306b\u6f0f\u308c\u304c\u306a\u3044\u3002\n\u305f\u3076\u3093\u3001\u305d\u3093\u306a\u9055\u3044\u304c\u3042\u308b\u3063\u307d\u3044\u3002\nJava \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9 \u306e\u300c3.3 \u30d7\u30ed\u30d5\u30a1\u30a4\u30ea\u30f3\u30b0\u30c4\u30fc\u30eb\u300d\u306b\u3001\u305d\u306e\u3078\u3093\u306e\u8a73\u7d30\u306a\u8aac\u660e\u304c\u8f09\u3063\u3066\u3044\u308b\u3002\n\n\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u53d6\u5f97\u3057\u3066\u5185\u5bb9\u3092\u78ba\u8a8d\u3059\u308b\n\n\u300c\u76e3\u8996\u300d\u30bf\u30d6\u3092\u958b\u304d\u3001\u300c\u30d2\u30fc\u30d7\u300d\u30c0\u30f3\u30d7\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u304c\u53d6\u5f97\u3067\u304d\u308b\u3002\n\u305f\u3060\u3057\u3001\u3053\u3053\u3067\u53d6\u5f97\u3067\u304d\u308b\u30c0\u30f3\u30d7\u306f GC \u5f8c\u306e\u60c5\u5831\u306b\u306a\u308b\u3063\u307d\u3044\u3002\n\n\nGC \u3055\u305b\u305a\u306b\u53d6\u5f97\u3057\u305f\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u898b\u305f\u3044\u5834\u5408\u306f\u3001\u5225\u9014 jcmd \u306a\u3069\u3067\u53d6\u5f97\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u300c\u30d5\u30a1\u30a4\u30eb\u300d\u2192\u300c\u8aad\u307f\u8fbc\u307f\u300d\u3067\u958b\u304f\u3002\n\n\n\n\n\n\u30af\u30e9\u30b9\u3054\u3068\u306e\u30e1\u30e2\u30ea\u6d88\u8cbb\u91cf\u306e\u4e00\u89a7\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\u30af\u30e9\u30b9\u3092\u30c0\u30d6\u30eb\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001\u305d\u306e\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4e00\u89a7\u3068\u53c2\u7167\u5143\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n\n\n\u5de6\u306e\u300c\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u300d\u306b\u3001\u9078\u629e\u3057\u305f\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u4e00\u89a7\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u3002\n\u8a73\u7d30\u3092\u78ba\u8a8d\u3057\u305f\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u9078\u629e\u3059\u308b\u3068\u3001\u53f3\u306e\u300c\u30d5\u30a3\u30fc\u30eb\u30c9\u300d\u3068\u300c\u53c2\u7167\u300d\u306b\u8a73\u7d30\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\u300c\u30d5\u30a3\u30fc\u30eb\u30c9\u300d\u306b\u306f\u3001\u305d\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u6301\u3064\u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u60c5\u5831\u304c\u3001\n\u300c\u53c2\u7167\u300d\u306b\u306f\u3001\u305d\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53c2\u7167\u3057\u3066\u3044\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u4e00\u89a7\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\n\njconsole\nJVM \u306e\u8a73\u7d30\u306a\u30e1\u30e2\u30ea\u72b6\u6cc1\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u78ba\u8a8d\u3067\u304d\u308b GUI \u30c4\u30fc\u30eb\u3002\nJDK \u306b\u4ed8\u5c5e\u3057\u3066\u3044\u308b\u3002\n\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067 jconsole \u3068\u5165\u529b\u3059\u308c\u3070\u5b9f\u884c\u3067\u304d\u308b\uff08\u30d1\u30b9\u304c\u901a\u3063\u3066\u3044\u308c\u3070\uff09\u3002\n\n\u8d77\u52d5\u3057\u305f\u3089\u3001\u73fe\u5728\u30ed\u30fc\u30ab\u30eb\u3067\u8d77\u52d5\u3057\u3066\u3044\u308b JVM \u306e\u4e00\u89a7\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\u63a5\u7d9a\u3057\u305f\u3044\u30d7\u30ed\u30bb\u30b9\u3092\u9078\u629e\u3057\u3066\u3001\u300c\u63a5\u7d9a\u300d\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3002\n\n\n\u4f7f\u3044\u65b9\u306f\u3001\u307e\u3041\u3001\u898b\u305f\u307e\u3093\u307e\u3002\n\u30e1\u30e2\u30ea\u4f7f\u7528\u7387\u3001\u30b9\u30ec\u30c3\u30c9\u6570\u3001\u30ed\u30fc\u30c9\u3055\u308c\u305f\u30af\u30e9\u30b9\u6570\u3001 CPU \u4f7f\u7528\u7387\u304c\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306a\u30b0\u30e9\u30d5\u3067\u8868\u793a\u3055\u308c\u308b\u3002\n\u30bf\u30d6\u3092\u5207\u308a\u66ff\u3048\u308c\u3070\u3001\u305d\u308c\u305e\u308c\u306e\u8a73\u7d30\u60c5\u5831\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n\n\n\u300c\u30e1\u30e2\u30ea\u30fc\u300d\u30bf\u30d6\u3092\u958b\u3051\u3070\u3001\u30e1\u30e2\u30ea\u306e\u8a73\u7d30\u306a\u60c5\u5831\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\u300c\u30c1\u30e3\u30fc\u30c8\u300d\u3067\u3001\u8868\u793a\u3059\u308b\u30e1\u30e2\u30ea\u9818\u57df\u306e\u7a2e\u5225\u3092\u9078\u629e\u3067\u304d\u308b\u3002\n\n\n\u53f3\u4e0b\u306e\u300c\u30d2\u30fc\u30d7\u300d\u300c\u975e\u30d2\u30fc\u30d7\u300d\u3068\u66f8\u3044\u3066\u3044\u308b\u7dd1\u306e\u3068\u3053\u308d\u3067\u3082\u3001\u8868\u793a\u3059\u308b\u9818\u57df\u3092\u9078\u629e\u3067\u304d\u308b\u3002\n\n\n\n\nEclipse Memory Analyzer Tool\n\nEclipse Memory Analyzer Open Source Project\n\n\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u306e\u5185\u5bb9\u3092\u8abf\u67fb\u3059\u308b\u305f\u3081\u306e GUI \u30c4\u30fc\u30eb\u3002\nmat \u3068\u7565\u3055\u308c\u305f\u308a\u3059\u308b\u3002\nEclipse \u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u308b\u3002\nEclipse \u7121\u3057\u3067\u3001\u5358\u72ec\u3067\u52d5\u304b\u3059\u3053\u3068\u3082\u53ef\u80fd\u3002\n\u4eca\u56de\u306f\u3001\u5358\u72ec\u3067\u52d5\u304b\u3057\u305f\u5834\u5408\u306e\u4f7f\u3044\u65b9\u3092\u30e1\u30e2\u3059\u308b\u3002\n\n\n\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u958b\u304f\n\n[File] \u2192 [Open Heap Dump]\n\u958b\u304d\u305f\u3044\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u9078\u629e\u3059\u308b\u3002\n\n\n\nOOME \u306e\u8abf\u67fb\u306e\u5834\u5408\u306f\u3001\u3068\u308a\u3042\u3048\u305a\u4e00\u756a\u4e0a\u3092\u9078\u3079\u3070\u826f\u3044\u3002\n\n\n\u30e1\u30e2\u30ea\u30ea\u30fc\u30af\u306e\u539f\u56e0\u3068\u601d\u308f\u308c\u308b\u7b87\u6240\u3092\u5206\u6790\u3057\u3066\u30ec\u30dd\u30fc\u30c8\u3092\u751f\u6210\u3057\u3066\u304f\u308c\u308b\u3002\n\n\n\n\nLeak Suspects Report\n\n\n\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u89e3\u6790\u3057\u305f\u7d50\u679c\u3001\u30e1\u30e2\u30ea\u30ea\u30fc\u30af\u304c\u7591\u308f\u308c\u308b\u7b87\u6240\u304c\u5186\u30b0\u30e9\u30d5\u3067\u8868\u793a\u3055\u308c\u308b\u3002\n\u4e0b\u306e\u300cProblem Suspect 1\u300d\u306b\u306f\u3001 ConcurrentHashMap \u304c\u5168\u4f53\u306e 95.03% \u3092\u5360\u3081\u3066\u3044\u308b\u3068\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u3002\n\u300cDetails\u300d\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001\u8a73\u7d30\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\n\n\n\u91cd\u305f\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\uff08CuncurrentHashMap\uff09\u3092\u53c2\u7167\u3057\u3066\u3044\u308b\u4ed6\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u30c4\u30ea\u30fc\u69cb\u9020\u3067\u8868\u793a\u3057\u3066\u3044\u308b\u3002\n\n\n\n\u91cd\u305f\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\uff08CuncurrentHashMap\uff09\u306e\u4e2d\u8eab\u3092\u30c4\u30ea\u30fc\u69cb\u9020\u3067\u8868\u793a\u3057\u3066\u3044\u308b\u3002\n\n\n\n\u30af\u30e9\u30b9\u5225\u306b\u3001\u30e1\u30e2\u30ea\u6d88\u8cbb\u91cf\u306e\u591a\u3044\u3082\u306e\u3092\u8868\u793a\u3057\u3066\u3044\u308b\u3002\n\n\u3068\u308a\u3042\u3048\u305a\u3001\u4e00\u756a\u91cd\u3044\u3089\u3057\u3044 ConcurrentHashMap \u3092\u30af\u30ea\u30c3\u30af\u3057\u3066 [List Objects] \u2192 [with outcoming references] \u3092\u9078\u629e\u3059\u308b\u3002\n\n\n\n\u6307\u5b9a\u3057\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3068\u3001\u305d\u306e\u4e2d\u8eab\u304c\u30c4\u30ea\u30fc\u3067\u8868\u793a\u3055\u308c\u308b\u3002\n\u300cShallow Heap\u300d\u304c\u3001\u305d\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5358\u72ec\u3067\u306e\u30b5\u30a4\u30ba\u3092\u8868\u3057\u3066\u3044\u308b\u3002\n\u300cRetained Heap\u300d\u304c\u3001\u305d\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u6301\u3064\u4ed6\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u542b\u3081\u305f\u30b5\u30a4\u30ba\u3092\u8868\u3057\u3066\u3044\u308b\u3002\n\u3068\u308a\u3042\u3048\u305a\u3001\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3044\u30e4\u30c4\u3092\u6398\u3063\u3066\u3044\u3063\u3066\u307f\u308b\u3002\n\n\n\n\u6700\u7d42\u7684\u306b\u3001BigObject \u3068\u304b\u3044\u3046\u30af\u30e9\u30b9\u304c\u5de8\u5927\u306a byte \u306e\u4e09\u6b21\u5143\u914d\u5217\u3092\u6301\u3063\u3066\u3044\u308b\u3068\u3053\u308d\u307e\u3067\u8fbf\u308a\u7740\u3044\u305f\u3002\n\u3053\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u3001\u5b9f\u969b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n\nMyResource.java\npackage sample.oome;\n\nimport java.io.Serializable;\n\nimport javax.enterprise.context.SessionScoped;\nimport javax.ws.rs.GET;\nimport javax.ws.rs.Path;\nimport javax.ws.rs.QueryParam;\n\n@Path(\"\")\n@SessionScoped\npublic class MyResource implements Serializable {\n    private static final long serialVersionUID = 1L;\n\n    private BigObject bigObject;\n\n    @GET\n    public void execute(@QueryParam(\"size\") int size) {\n        this.bigObject = new BigObject(size);\n        System.out.println(\"done (\" + size + \")\");\n    }\n\n    public static class BigObject {\n        public byte[][][] data;\n\n        public BigObject(int size) {\n            this.data = new byte[1024][1024][size];\n        }\n    }\n}\n\n\n\n\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30b3\u30fc\u30d7\u306e\u30ea\u30bd\u30fc\u30b9\u30af\u30e9\u30b9\u306b\u3001\u5de8\u5927\u306a\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\uff08BigObject\uff09\u3092\u4fdd\u5b58\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n\u3053\u308c\u304c\u6e9c\u307e\u308a\u6e9c\u307e\u3063\u3066 OOME \u306b\u306a\u3063\u3066\u3044\u305f\u3002\nMemory Analyzer \u3092\u4f7f\u3048\u3070\u3001\u3053\u3093\u306a\u611f\u3058\u3067 OOME \u306e\u539f\u56e0\u7b87\u6240\u3092\u8abf\u67fb\u3067\u304d\u308b\u3002\n\n\nGC Viewer\nGC \u30ed\u30b0\u3092\u30b0\u30e9\u30d5\u3067\u8868\u793a\u3059\u308b\u30c4\u30fc\u30eb\u3002\n\u8a73\u3057\u304f\u306f\u3053\u3061\u3089\u3002\n\nHeapStats\n\n\nNTT \u306e OSS \u30bb\u30f3\u30bf\u304c\u958b\u767a\u3057\u305f JVM \u306e\u72b6\u614b\u3092\u76e3\u8996\u3059\u308b\u30c4\u30fc\u30eb\u3002\nOSS\uff08GPL v2\uff09\u3002\n\u5e73\u5e38\u6642\u304b\u3089 JVM \u3092\u76e3\u8996\u3057\u3066\u60c5\u5831\u3092\u53ce\u96c6\u3059\u308b\u3053\u3068\u3067\u3001\u7570\u5e38\u3092\u4e8b\u524d\u306b\u691c\u77e5\u3057\u3066\u30a2\u30e9\u30fc\u30c8\u3092\u4e0a\u3052\u305f\u308a\u3001\u969c\u5bb3\u767a\u751f\u6642\u306e\u60c5\u5831\u306e\u53ce\u96c6\u3092\u7701\u529b\u5316\u3057\u305f\u308a\u3067\u304d\u308b\u3002\n\n\n\u52d5\u4f5c\u78ba\u8a8d\u3057\u305f\u3068\u304d\u306e\u74b0\u5883\n\n\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u52d5\u304b\u3059\u74b0\u5883\n\n\nCentOS 6.3 (VMware)\nJava 1.8.0_65 (Oracle JDK)\n\n\n\u30a2\u30ca\u30e9\u30a4\u30b6\u3092\u52d5\u304b\u3059\u74b0\u5883\n\n\nWindows 7\nJava 1.8.0_74\n\n\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\n\u3053\u3061\u3089\u306b\u3042\u308b\u30ea\u30f3\u30af \u304b\u3089\u3001 rpm \u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304f\u308b\u3002\nCentOS 6 \u306f RHEL6 \u76f8\u5f53\u306a\u306e\u3067\u3001 heapstats-2.0.1-0.el6.x86_64.rpm \u3092\u843d\u3068\u3059\u3053\u3068\u306b\u3057\u305f\u3002\n\u4eca\u56de\u306f Oracle \u306e Java \u3092\u5165\u308c\u3066\u3044\u305f\u304c\u3001 OpenJDK \u306e\u5834\u5408\u306f debuginfo \u3068\u304b\u3044\u3046\u306e\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3089\u3057\u3044\n\n# rpm \u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n$ wget http://icedtea.wildebeest.org/download/heapstats/heapstats-2.0.1/bin/agent/el6/x86_64/heapstats-2.0.1-0.el6.x86_64.rpm\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo rpm -ivh heapstats-2.0.1-0.el6.x86_64.rpm\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\n$ java -agentlib:heapstats -version\nheapstats INFO: HeapStats 2.0.1\nheapstats INFO: Supported processor features: AVX\nheapstats INFO: Agent Attach Enable = true\n\uff08\u7565\uff09\nheapstats INFO: Kill on Error = false\njava version \"1.8.0_65\"\nJava(TM) SE Runtime Environment (build 1.8.0_65-b17)\nJava HotSpot(TM) 64-Bit Server VM (build 25.65-b01, mixed mode)\n\n\n\u8d77\u52d5\n# HeapStats \u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u5dee\u3057\u8fbc\u3093\u3067 Java \u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u8d77\u52d5\u3059\u308b\n$ java -agentpath:/usr/lib64/heapstats/libheapstats.so \uff08\u7565\uff09\nheapstats INFO: HeapStats 2.0.1\nheapstats INFO: Supported processor features: AVX\nheapstats INFO: Agent Attach Enable = true\nheapstats INFO: SnapShot FileName = heapstats_snapshot.dat\nheapstats INFO: Heap Log FileName = heapstats_log.csv\nheapstats INFO: Archive FileName = heapstats_analyze.zip\n\uff08\u7565\uff09\n\n\n\n-agentpath \u3067 HeapStats \u306e so \u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n\n\u74b0\u5883\u5909\u6570\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u65b9\u6cd5\u306a\u3069\u3082\u5b58\u5728\u3059\u308b\uff081.3 \u8d77\u52d5 | HeapStats \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\uff09\u3002\n\n\n\u8d77\u52d5\u3059\u308b\u3068\u3001\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u51fa\u529b\u3055\u308c\u308b\u3002\n\n\n\nheapstats_snapshot.dat\n\nFull GC \u304c\u767a\u751f\u3057\u305f\u3068\u304d\u306a\u3069\u306e\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u304c\u4fdd\u5b58\u3055\u308c\u308b\u30d5\u30a1\u30a4\u30eb\u3002\n\n\n\nheapstats_log.csv\n\n\u30d2\u30fc\u30d7\u3084 CPU \u306a\u3069\u306e\u7c21\u6613\u306a\u60c5\u5831\u3092\u51fa\u529b\u3057\u305f\u30ed\u30b0\u3002\n\n\n\n\n\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\uff15\u5206\u9593\u9694\u3067\u51fa\u529b\u3055\u308c\u308b\u3002\n\n\nOOME \u304c\u767a\u751f\u3057\u305f\u5834\u5408\u3084\u3001\u30e6\u30fc\u30b6\u30fc\u304c\u660e\u793a\u7684\u306b\u51fa\u529b\u3092\u6307\u793a\u3057\u305f\u5834\u5408\u306b\u3082\u51fa\u529b\u3055\u308c\u308b\u3002\n\n\n\u30d5\u30a1\u30a4\u30eb\u306e\u540d\u524d\u3084\u5834\u6240\u3001\u305d\u306e\u4ed6\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306b\u95a2\u3059\u308b\u69d8\u3005\u306a\u6319\u52d5\u306f\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u4efb\u610f\u306b\u5909\u66f4\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n\n\u8a73\u3057\u304f\u306f HeapStats/jp/\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8 \u3092\u53c2\u7167\u3002\n\n\n\n\n\u30a2\u30ca\u30e9\u30a4\u30b6\u3067\u78ba\u8a8d\u3059\u308b\n\n\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u53ce\u96c6\u3057\u305f\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3084\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306f\u3001\u30a2\u30ca\u30e9\u30a4\u30b6\u3068\u547c\u3070\u308c\u308b GUI \u30c4\u30fc\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u843d\u3068\u3057\u3066\u304d\u305f\u5834\u6240\u306b\u3001\u30a2\u30ca\u30e9\u30a4\u30b6\u3082\u7f6e\u3044\u3066\u3042\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u843d\u3068\u3057\u3066\u304f\u308b\uff08heapstats-analyzer-2.0.1-bin.zip\uff09\u3002\n\u89e3\u51cd\u3057\u305f\u3089\u3001\u4e2d\u306b heapstats-analyzer.jar \u304c\u5165\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u30c0\u30d6\u30eb\u30af\u30ea\u30c3\u30af\u3067\u8d77\u52d5\u3059\u308b\u3002\n\n\n\n[Log Data] \u30bf\u30d6\u3067\u3001\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n\n[Log File] \u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u958b\u304f\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u9078\u629e\u3059\u308b\u3002\n[Range] \u3067\u3001\u78ba\u8a8d\u3057\u305f\u3044\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u671f\u9593\u3092\u9078\u629e\u3059\u308b\u3002\n[OK] \u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001\u30ed\u30b0\u306e\u5185\u5bb9\u304c\u30b0\u30e9\u30d5\u306b\u306a\u3063\u3066\u8868\u793a\u3055\u308c\u308b\u3002\n\n\n\n\n\n[SnapShot Data] \u30bf\u30d6\u3067\u3001\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n\n[Log File] \u306e\u5834\u5408\u3068\u540c\u3058\u8981\u9818\u3067\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304f\u3002\n\n\n\n\n\n[Histogram] \u30bf\u30d6\u3084 [SnapShot Data]\u30bf\u30d6\u3067\u3001\u30af\u30e9\u30b9\u3054\u3068\u306e\u30d2\u30fc\u30d7\u5360\u6709\u7387\u306a\u3069\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\u307e\u305f\u3001 [SnapShot Data] \u30bf\u30d6\u3067\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u9078\u629e\u3057\u305f\u72b6\u614b\u3067 [Reference Tree] \u3092\u9078\u629e\u3059\u308c\u3070\u3001\u305d\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u53c2\u7167\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u95a2\u9023\u3092\u30b0\u30e9\u30d5\u30a3\u30ab\u30eb\u306b\u8fbf\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n\n\n\u8a73\u3057\u3044\u4f7f\u3044\u65b9\u306f \u65e5\u672c\u8a9e\u306e\u30de\u30cb\u30e5\u30a2\u30eb \u304c\u3042\u308b\u306e\u3067\u3001\u305d\u3061\u3089\u3092\u53c2\u7167\u3002\n\n\nJVM \u306e\u30aa\u30d7\u30b7\u30e7\u30f3\n\nGC \u306e\u60c5\u5831\u3092\u51fa\u529b\u3059\u308b\n\n\u57fa\u672c\njava -verbose:gc \uff08\u7565\uff09\n\nGC (Allocation Failure)\n305284K->307692K(450048K), 0.0386887 secs]\n\nGC (Allocation Failure)\n366572K->369612K(450048K), 0.0429775 secs]\n\nFull GC (Ergonomics)\n369612K->357147K(466432K), 0.1287979 secs]\n\n\n\u8d77\u52d5\u6642\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306b -verbose:gc \u3068\u6307\u5b9a\u3059\u308b\u3068\u3001 GC \u304c\u8d77\u3053\u3063\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u6a19\u6e96\u51fa\u529b\u306b GC \u306e\u60c5\u5831\u304c\u51fa\u529b\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\nGC \u3068\u3060\u3051\u51fa\u3066\u3044\u308b\u306e\u306f\u3001 Full GC \u4ee5\u5916\u306e GC \u304c\u767a\u751f\u3057\u305f\u3053\u3068\u3092\u8868\u3057\u3066\u3044\u308b\uff08Young \u9818\u57df\u306e GC \u3068\u304b\uff09\u3002\n\nFull GC \u3068\u51fa\u3066\u3044\u308b\u306e\u306f\u3001\u305d\u306e\u3082\u306e\u305a\u3070\u308a Full GC \u304c\u767a\u751f\u3057\u305f\u3053\u3068\u3092\u8868\u3057\u3066\u3044\u308b\u3002\n\n369612K->357147K \u306f\u3001 GC \u524d\u5f8c\u306e\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u3092\u8868\u3057\u3066\u3044\u308b\u3002\n\n\n\u30ed\u30b0\u306b\u51fa\u529b\u3059\u308b\n\njava -Xloggc:./gclog/gc.log \uff08\u7565\uff09\n\n\ngclog/gc.log\n\uff08\u7565\uff09\n1.115: [GC (Allocation Failure)  65536K->13595K(251392K), 0.0172892 secs]\n1.619: [GC (Metadata GC Threshold)  59048K->17654K(316928K), 0.0186921 secs]\n1.638: [Full GC (Metadata GC Threshold)  17654K->14363K(316928K), 0.0809789 secs]\n9.061: [GC (Metadata GC Threshold)  119609K->33977K(316928K), 0.0129435 secs]\n9.074: [Full GC (Metadata GC Threshold)  33977K->28176K(354304K), 0.0658862 secs]\n9.914: [GC (Allocation Failure)  159248K->38718K(376320K), 0.0071812 secs]\n14.349: [GC (Allocation Failure)  191806K->44894K(376320K), 0.0180813 secs]\n16.044: [GC (Allocation Failure)  197982K->58932K(346624K), 0.0185405 secs]\n17.062: [GC (Allocation Failure)  182324K->84387K(361472K), 0.0193260 secs]\n\uff08\u7565\uff09\n\n\n\n\n-Xloggc:<GC\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u51fa\u529b\u5148\u30d1\u30b9> \u3092\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001 GC \u306e\u30ed\u30b0\u3092\u30d5\u30a1\u30a4\u30eb\u306b\u51fa\u529b\u3067\u304d\u308b\u3002\n\n\n\u65e2\u306b\u540c\u540d\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u3001\u30d5\u30a1\u30a4\u30eb\u304c\u4e0a\u66f8\u304d\u3055\u308c\u308b\u306e\u3067\u6ce8\u610f\u3002\n\u8d77\u52d5\u6642\u306e\u65e5\u6642\u3092\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u542b\u3081\u3066\u304a\u3051\u3070\u3001\u8aa4\u3063\u3066\u4e0a\u66f8\u304d\u3057\u3066\u3057\u307e\u3046\u3053\u3068\u3092\u9632\u3052\u308b\u3002\n\n\n\u5148\u982d\u306e\u6570\u5b57\u306f\u3001 JVM \u304c\u8d77\u52d5\u3055\u308c\u3066\u304b\u3089\u306e\u7d4c\u904e\u6642\u9593\u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\u3002\n\n\n\u6642\u523b\u3092\u51fa\u529b\u3059\u308b\n> java -Xloggc:./gclog/gc.log -XX:+PrintGCDateStamps \uff08\u7565\uff09\n\n\ngc.log\n\uff08\u7565\uff09\n2016-03-12T23:33:18.100+0900: 1.043: [GC (Allocation Failure)  65536K->13533K(251392K), 0.0164784 secs]\n2016-03-12T23:33:18.637+0900: 1.580: [GC (Metadata GC Threshold)  60735K->17423K(316928K), 0.0091990 secs]\n2016-03-12T23:33:18.646+0900: 1.589: [Full GC (Metadata GC Threshold)  17423K->14261K(316928K), 0.0382588 secs]\n2016-03-12T23:33:26.067+0900: 9.009: [GC (Metadata GC Threshold)  119162K->33976K(316928K), 0.0249904 secs]\n2016-03-12T23:33:26.092+0900: 9.034: [Full GC (Metadata GC Threshold)  33976K->28238K(346624K), 0.0769754 secs]\n2016-03-12T23:33:27.057+0900: 10.000: [GC (Allocation Failure)  159310K->38719K(368640K), 0.0075372 secs]\n2016-03-12T23:34:17.486+0900: 60.428: [GC (Allocation Failure)  191807K->72288K(368640K), 0.0504215 secs]\n2016-03-12T23:34:18.894+0900: 61.836: [GC (Allocation Failure)  225376K->86442K(311296K), 0.0200902 secs]\n\uff08\u7565\uff09\n\n\n\n\n-XX:+PrintGCDateStamps \u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u3067\u3001 GC \u30ed\u30b0\u306b\u305d\u306e\u3068\u304d\u306e\u6642\u523b\u3082\u51fa\u529b\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n\n\u8a73\u7d30\u306a GC \u30ed\u30b0\u3092\u51fa\u529b\u3055\u305b\u308b\n> java -Xloggc:./gclog/gc.log -XX:+PrintGCDetails \uff08\u7565\uff09\n\n\ngc.log\n\uff08\u7565\uff09\n1.037: [GC (Allocation Failure) [PSYoungGen: 65536K->10743K(76288K)] 65536K->13596K(251392K), 0.0106704 secs] [Times: user=0.00 sys=0.00, real=0.01 secs] \n1.566: [GC (Metadata GC Threshold) [PSYoungGen: 57946K->10731K(76288K)] 60799K->17543K(251392K), 0.0091160 secs] [Times: user=0.05 sys=0.02, real=0.01 secs] \n1.575: [Full GC (Metadata GC Threshold) [PSYoungGen: 10731K->0K(76288K)] [ParOldGen: 6812K->14259K(175104K)] 17543K->14259K(251392K), [Metaspace: 20821K->20821K(1067008K)], 0.0362780 secs] [Times: user=0.08 sys=0.00, real=0.04 secs] \n8.644: [GC (Allocation Failure) [PSYoungGen: 65536K->10750K(76288K)] 79795K->28913K(251392K), 0.0212910 secs] [Times: user=0.11 sys=0.02, real=0.02 secs] \n8.995: [GC (Metadata GC Threshold) [PSYoungGen: 42809K->10746K(96256K)] 60972K->29332K(271360K), 0.0082032 secs] [Times: user=0.00 sys=0.00, real=0.01 secs] \n9.003: [Full GC (Metadata GC Threshold) [PSYoungGen: 10746K->0K(96256K)] [ParOldGen: 18585K->20171K(192000K)] 29332K->20171K(288256K), [Metaspace: 34754K->34754K(1081344K)], 0.0700618 secs] [Times: user=0.47 sys=0.00, real=0.07 secs] \n9.238: [GC (Allocation Failure) [PSYoungGen: 85504K->1118K(96256K)] 105675K->21289K(288256K), 0.0043759 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] \n10.587: [GC (Allocation Failure) [PSYoungGen: 86622K->17111K(143872K)] 106793K->37291K(335872K), 0.0245291 secs] [Times: user=0.11 sys=0.00, real=0.02 secs] \n19.645: [GC (Allocation Failure) [PSYoungGen: 141527K->21483K(145920K)] 161707K->49982K(337920K), 0.0182595 secs] [Times: user=0.08 sys=0.00, real=0.02 secs] \n\uff08\u7565\uff09\n\n\n\n\n-XX:+PrintGCDetails \u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u3067\u3001\u3088\u308a\u8a73\u7d30\u306a\u60c5\u5831\u3092\u51fa\u529b\u3055\u305b\u3089\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n\n\u9818\u57df\u3054\u3068\u306e\u30e1\u30e2\u30ea\u91cf\u306e\u5909\u5316\u306a\u3069\u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\n\n\n\n\n\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3055\u305b\u308b\n> java -Xloggc:./gclog/gc.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=5 -XX:GCLogFileSize=10k \uff08\u7565\uff09\n\n\n\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u304c\uff11\u5468\u56de\u3063\u305f\u5f8c\u306e\u72b6\u614b\ngclog> dir\n2016/03/12  23:52    <DIR>          .\n2016/03/12  23:52    <DIR>          ..\n2016/03/12  23:52            10,594 gc.log.0\n2016/03/12  23:52             1,302 gc.log.1.current\n2016/03/12  23:52            10,458 gc.log.2\n2016/03/12  23:52            10,515 gc.log.3\n2016/03/12  23:52            10,519 gc.log.4\n\n\n\nGC \u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3055\u305b\u308b\u5834\u5408\u306f\u3001\u8d77\u52d5\u6642\u306b\u6b21\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n\n-XX:+UseGCLogFileRotation\n-XX:NumberOfGCLogFiles=<\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u6570>\n-XX:GCLogFileSize=<\uff11\u30d5\u30a1\u30a4\u30eb\u306e\u6700\u5927\u30b5\u30a4\u30ba>\n\n\n\u30b5\u30a4\u30ba\u306f k \u3084 m \u306a\u3069\u3067\u30ad\u30ed\u30d0\u30a4\u30c8\u30fb\u30e1\u30ac\u30d0\u30a4\u30c8\u3092\u6307\u5b9a\u3067\u304d\u308b\u3002\n\u307e\u305a\u6700\u521d\u306b gc.log.0.current \u304c\u751f\u6210\u3055\u308c\u308b\u3002\n\u6b21\u306b\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3059\u308b\u3068 gc.log.1.current \u304c\u751f\u6210\u3055\u308c\u3001\u305d\u3061\u3089\u306b\u30ed\u30b0\u304c\u5410\u304b\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n\n\ngc.log.0.current \u306f gc.log.0 \u3068\u3044\u3046\u540d\u524d\u306b\u30ea\u30cd\u30fc\u30e0\u3055\u308c\u308b\u3002\n\n\n\u540c\u3058\u3088\u3046\u306b\u3057\u3066\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u7e70\u308a\u8fd4\u3057\u3066\u3044\u304d\u3001 NumberOfGCLogFiles \u3067\u6307\u5b9a\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u6570\u3092\u8d85\u3048\u305f\u3089\u518d\u3073 gc.log.0 \u306b\u30ed\u30b0\u304c\u51fa\u529b\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\u73fe\u5728\u51fa\u529b\u3057\u3066\u3044\u308b\u30d5\u30a1\u30a4\u30eb\u306f\u3001\u672b\u5c3e\u306b .current \u304c\u4ed8\u304f\u3002\n\n\nGC \u30ed\u30b0\u3092\u30b0\u30e9\u30d5\u3067\u78ba\u8a8d\u3059\u308b\n\n\n\nGC Viewer \u3068\u3044\u3046 GUI \u306e\u30c4\u30fc\u30eb\u3092\u4f7f\u3046\u3053\u3068\u3067\u3001 GC \u30ed\u30b0\u3092\u30b0\u30e9\u30d5\u3067\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n\n\u306a\u3093\u304b\u3001 -XX:+PrintGCDateStamps \u3092\u6307\u5b9a\u3057\u3066\u3044\u306a\u3044\u3068\u30ed\u30b0\u306e\u89e3\u6790\u3067\u30a8\u30e9\u30fc\u306b\u306a\u308b\u6c17\u304c\u3059\u308b\u3002\u3002\u3002\uff1f\n\n\n\u30aa\u30ea\u30b8\u30ca\u30eb\u306e\u4f5c\u8005\u306b\u3088\u308b\u958b\u767a\u306f 2008 \u5e74\u306e\u6642\u70b9\u3067\u7d42\u4e86\u3057\u3066\u3044\u308b\u304c\u3001\u5225\u306e\u4eba\u304c GitHub \u4e0a \u3067\u958b\u767a\u3092\u7d9a\u3051\u3066\u3044\u308b\u3002\n\nGitHub \u304b\u3089\u5b9f\u884c\u53ef\u80fd jar \u3092\u843d\u3068\u3057\u3066\u304f\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\u30c0\u30d6\u30eb\u30af\u30ea\u30c3\u30af\u3067\u8d77\u52d5\u3057\u3066\u3001 GC \u30ed\u30b0\u3092\u30c9\u30e9\u30c3\u30b0\uff06\u30c9\u30ed\u30c3\u30d7\u3059\u308c\u3070\u958b\u304f\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n\n\n[View] \u3067\u30b0\u30e9\u30d5\u306e\u8868\u793a\u975e\u8868\u793a\u3092\u5207\u308a\u66ff\u3048\u3089\u308c\u308b\u3002\n\n\n\u4e0a\u56f3\u306f\u3001\u30d2\u30fc\u30d7\u306e\u5909\u5316\u3060\u3051\u3092\u8868\u793a\u3057\u3066\u3044\u308b\u3002\n\n\n\u30c4\u30fc\u30eb\u30d0\u30fc\u306b\u3042\u308b\u6642\u8a08\u307f\u305f\u3044\u306a\u30de\u30fc\u30af\uff08\u62e1\u5927\u7387\u306e\u5de6\uff09\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001\u30ed\u30b0\u3092\u76e3\u8996\u3057\u3066\u5909\u66f4\u304c\u3042\u308c\u3070\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u8868\u793a\u3092\u66f4\u65b0\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\u666e\u6bb5\u304b\u3089 GC \u30ed\u30b0\u3092\u51fa\u529b\u3055\u305b\u3066\u304a\u3044\u3066\u3001\u30d2\u30fc\u30d7\u306e\u5909\u5316\u306b\u4e0d\u81ea\u7136\u306a\u69d8\u5b50\u306f\u7121\u3044\u304b\u3092\u78ba\u8a8d\u3059\u308b\u306e\u306b\u5229\u7528\u3059\u308b\u3002\n\n\nGC \u304c\u767a\u751f\u3057\u305f\u306e\u306b\u30d2\u30fc\u30d7\u306e\u30b5\u30a4\u30ba\u304c\u3069\u3093\u3069\u3093\u5897\u3048\u3066\u3044\u3063\u3066\u3044\u305f\u3089\u3001\u306a\u3093\u304b\u602a\u3057\u3044\u3068\u3044\u3046\u5408\u56f3\u3002\n\u4e0a\u56f3\u306e\u30ed\u30b0\u3067\u306f\u3001 GC \u306e\u5ea6\u306b\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba\u304c\u307b\u307c\u540c\u3058\u30b5\u30a4\u30ba\u306b\u4e0b\u304c\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u554f\u984c\u306f\u306a\u3055\u3052\u3068\u5224\u65ad\u3067\u304d\u308b\u3002\n\n\n\n\nOOME \u304c\u767a\u751f\u3057\u305f\u3068\u304d\u306b\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u81ea\u52d5\u3067\u53d6\u5f97\u3059\u308b\n\n> java -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=./hprof/ \uff08\u7565\uff09\n\n\nOOME\u304c\u767a\u751f\u3057\u305f\u3068\u304d\u306e\u6a19\u6e96\u51fa\u529b\nDumping heap to ./hprof/\\java_pid21072.hprof ...\nHeap dump file created [454844605 bytes in 0.602 secs]\n\n[2016-03-13T00:38:01.923+0900] [Payara 4.1] [WARNING] [] [javax.enterprise.web] [tid: _ThreadID=17 _ThreadName=http-listener(2)] [timeMillis: 1457797081923] [levelValue: 900] [[StandardWrapperValve[sample.oome.MyApplication]: Servlet.service() for servlet sample.oome.MyApplication threw exception\njava.lang.OutOfMemoryError: Java heap space\n        at sample.oome.MyResource$BigObject.<init>(MyResource.java:24)\n        at sample.oome.MyResource.execute(MyResource.java:16)\n\uff08\u7565\uff09\n\n\n\n\u51fa\u529b\u3055\u308c\u305f\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\nhprof> dir /b\njava_pid21072.hprof\n\n\n\n\n-XX:+HeapDumpOnOutOfMemoryError \u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001 OOME \u304c\u767a\u751f\u3057\u305f\u3068\u304d\u306b\u81ea\u52d5\u3067\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u51fa\u529b\u3055\u305b\u3089\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n-XX:HeapDumpPath=<\u51fa\u529b\u5148\u30d5\u30a9\u30eb\u30c0> \u3067\u3001\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u306e\u51fa\u529b\u5148\u3092\u6307\u5b9a\u3067\u304d\u308b\u3002\n\n\n\u30d5\u30a1\u30a4\u30eb\u540d\u306f java_pid<\u30d7\u30ed\u30bb\u30b9ID>.hprof \u3068\u3044\u3046\u540d\u524d\u306b\u306a\u308b\u3002\n\n\n\u540c\u3058\u30d7\u30ed\u30bb\u30b9\u3067\u306f\u3001\u4e00\u5ea6 OOME \u3067\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u304c\u51fa\u529b\u3055\u308c\u308b\u3068\u3001\u4ee5\u5f8c OOME \u304c\u767a\u751f\u3057\u3066\u3082\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u51fa\u529b\u3057\u306a\u304f\u306a\u308b\u6a21\u69d8\u3002\n\n\n\u307e\u3041\u3001 OOME \u304c\u51fa\u305f\u6642\u70b9\u3067\u30e1\u30e2\u30ea\u306e\u72b6\u614b\u304c\u4fdd\u8a3c\u3055\u308c\u306a\u3044\u304b\u3089\u3001\u4e00\u65e6\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u505c\u6b62\u3055\u305b\u308b\u3079\u304d\u306a\u306e\u3060\u308d\u3046\u3002\n\n\n\n\n\u7528\u8a9e\u96c6\n\n\u30d2\u30fc\u30d7\n\n\u30d2\u30fc\u30d7\u30e1\u30e2\u30ea\u3002\nJava \u30d7\u30ed\u30b0\u30e9\u30e0\u4e0a\u3067\u751f\u6210\u3057\u305f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u914d\u7f6e\u3055\u308c\u308b\u30e1\u30e2\u30ea\u9818\u57df\u3002\n\u4e00\u822c\u7684\u306b\u300c\u30d2\u30fc\u30d7\u300d\u3068\u8a00\u3046\u3068\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u304c\u52d5\u304f\u305f\u3081\u306b\u78ba\u4fdd\u3055\u308c\u305f\u30e1\u30e2\u30ea\u9818\u57df\u306e\u3053\u3068\u3092\u6307\u3059\u3002\n\n\n\u30d2\u30fc\u30d7\u3068\u306f\uff5cheap\uff5c\u30d2\u30fc\u30d7\u9818\u57df - \u610f\u5473/\u5b9a\u7fa9 \uff1a IT\u7528\u8a9e\u8f9e\u5178\n\u3057\u304b\u3057\u3001 JVM \u3067\u306e\u6587\u8108\u3067\u306f\u3001\u5358\u306b\u300c\u30d2\u30fc\u30d7\u300d\u3068\u8a00\u3046\u3068 JVM \u4e0a\u3067\u52d5\u304f Java \u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u305f\u3081\u306e\u30e1\u30e2\u30ea\u9818\u57df\u306e\u3053\u3068\u3092\u6307\u3059\u3002\nJVM \u304c\u52d5\u304f\u3068\u304d\u306f\u3001 Java \u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u305f\u3081\u4ee5\u5916\u306b\u3082 JVM \u81ea\u8eab\u306e\u305f\u3081\u306e\u30e1\u30e2\u30ea\u9818\u57df\u306a\u3069\u3082\u78ba\u4fdd\u3055\u308c\u308b\u3002\n\n\nJVM \u306e\u30e1\u30e2\u30ea\u7a7a\u9593\u306e\u8aac\u660e\u3067\u300cC \u30d2\u30fc\u30d7\u300d\u3068\u3044\u3046\u8868\u73fe\u304c\u3042\u308b\u5834\u5408\u3001\u305d\u306e\u300c\u30d2\u30fc\u30d7\u300d\u306f\u4e00\u822c\u7528\u8a9e\u306e\u610f\u5473\u3067\u306e\u300c\u30d2\u30fc\u30d7\u300d\u306e\u3053\u3068\u3060\u3068\u601d\u3046\u3002\n\n\nJVM \u3067\u306e\u6587\u8108\u3067\u306f\u3001\u300cC \u30d2\u30fc\u30d7\u300d\u306f\u30cd\u30a4\u30c6\u30a3\u30d6\u9818\u57df\u306e\u3053\u3068\u306b\u306a\u308b\u3002\n\n\n\n\nPermanent \u9818\u57df\n\n\u30af\u30e9\u30b9\u3084\u30e1\u30bd\u30c3\u30c9\u306e\u30e1\u30bf\u60c5\u5831\u306a\u3069\u3001\u9759\u7684\u306a\u60c5\u5831\u304c\u683c\u7d0d\u3055\u308c\u308b\u3002\n\n\nDI \u30b3\u30f3\u30c6\u30ca\u3068\u304b\u304c\u30af\u30e9\u30b9\u3092\u52d5\u7684\u306b\u30ed\u30fc\u30c9\u3059\u308b\u3068\u3001\u3053\u306e\u9818\u57df\u304c\u6d88\u8cbb\u3055\u308c\u3066\u3044\u304d OOME \u304c\u767a\u751f\u3057\u3084\u3059\u3044\u3002\n\n\n\u975e\u30d2\u30fc\u30d7\u9818\u57df\u3002\n\n\n\u30d2\u30fc\u30d7\u9818\u57df\u3067\u306f\u306a\u3044\u304c\u3001\u30cd\u30a4\u30c6\u30a3\u30d6\u9818\u57df\u3067\u3082\u306a\u3044\u9818\u57df\u3002\n\n\nJava 8 \u3067\u5ec3\u6b62\u3055\u308c\u3001\u4ee3\u308f\u308a\u306b Metaspace \u3068\u547c\u3070\u308c\u308b\u9818\u57df\u304c\u8ffd\u52a0\u3055\u308c\u305f\u3002\n\n\nMetaspace\n\nJava 8 \u304b\u3089\u63a1\u7528\u3055\u308c\u305f\u3001 Permanent \u9818\u57df\u306b\u4ee3\u308f\u308b\u30e1\u30e2\u30ea\u9818\u57df\u3002\n\u30cd\u30a4\u30c6\u30a3\u30d6\u9818\u57df\u306b\u78ba\u4fdd\u3055\u308c\u308b\u3002\n\n\n\u30cd\u30a4\u30c6\u30a3\u30d6\u9818\u57df\n\nNative Area \u3068\u304b\u3001\u5358\u306b Native \u3068\u304b\u3002\nJVM \u304c\u52d5\u304f\u305f\u3081\u306e\u30e1\u30e2\u30ea\u3060\u3063\u305f\u308a\u30b9\u30ec\u30c3\u30c9\u306e\u30b9\u30bf\u30c3\u30af\u306e\u60c5\u5831\u304c\u683c\u7d0d\u3055\u308c\u305f\u308a\u3059\u308b\u9818\u57df\u3002\n\n\nYoung \u9818\u57df\n\n\u30d2\u30fc\u30d7\u306e\u4e00\u90e8\u3002\n\u751f\u6210\u3055\u308c\u3066\u304b\u3089\u306e\u6642\u9593\u304c\u307e\u3060\u77ed\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u914d\u7f6e\u3055\u308c\u308b\u9818\u57df\u3002\nYoung \u9818\u57df\u306f\u3001\u3055\u3089\u306b Eden \u9818\u57df\u3068\uff12\u3064\u306e Survivor \u9818\u57df\u306b\u5206\u304b\u308c\u308b\u3002\nNew \u9818\u57df\u3068\u3082\u547c\u3070\u308c\u308b\u3002\n\n\nEden \u9818\u57df\n\nYoung \u9818\u57df\u306e\u4e00\u90e8\u3002\n\u65b0\u898f\u4f5c\u6210\u3055\u308c\u305f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u3001\u307e\u305a\u3053\u306e\u9818\u57df\u306b\u914d\u7f6e\u3055\u308c\u308b\u3002\n\n\nSurvivor \u9818\u57df\n\nYoung \u9818\u57df\u306e\u4e00\u90e8\u3002\nEden \u9818\u57df\u304c\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3055\u308c\u308b\u3068\u304d\u306b\u3001\u307e\u3060\u5229\u7528\u3055\u308c\u3066\u3044\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f Survivor \u9818\u57df\u306b\u79fb\u52d5\u3055\u308c\u308b\u3002\nYoung \u9818\u57df\u5185\u306b\u306f\uff12\u3064\u306e Survivor \u9818\u57df\u304c\u7528\u610f\u3055\u308c\u3066\u304a\u308a\u3001\u3069\u3061\u3089\u304b\u4e00\u65b9\u306f\u5fc5\u305a\u7a7a\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\u8a73\u3057\u304f\u306f Java\u6280\u8853\u6700\u524d\u7dda - \u300c\u30e1\u30e2\u30ea\u30fc\u3092\u610f\u8b58\u3057\u3066\u307f\u3088\u3046\u300d\u7b2c2\u56de\u3000GC\u306e\u4ed5\u7d44\u307f\u3092\u7406\u89e3\u3059\u308b\uff1aITpro \u3092\u53c2\u7167\u3002\n\n\nOld \u9818\u57df\n\n\u30d2\u30fc\u30d7\u306e\u4e00\u90e8\u3002\nSurvivor \u9818\u57df\u306e\u4e2d\u3067\u3082\u7279\u306b\u9577\u6642\u9593\u751f\u304d\u7d9a\u3051\u3066\u3044\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u9000\u907f\u3055\u308c\u308b\u5834\u6240\u3002\nTenured \u9818\u57df\u3068\u3082\u547c\u3070\u308c\u308b\u3002\n\n\n\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\n\nGarbage Collection\nGC\n\u30d2\u30fc\u30d7\u30e1\u30e2\u30ea\u306b\u914d\u7f6e\u3055\u308c\u305f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u3046\u3061\u3001\u4f7f\u308f\u308c\u3066\u3044\u306a\u3044\u3082\u306e\u3092\u7834\u68c4\u3057\u30e1\u30e2\u30ea\u306e\u7a7a\u304d\u9818\u57df\u3092\u78ba\u4fdd\u3059\u308b\u6a5f\u80fd\u30fb\u4ed5\u7d44\u307f\u3002\n\n\nStop the World\n\n\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u3068\u304d\u306b\u767a\u751f\u3059\u308b\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b9\u30ec\u30c3\u30c9\u304c\u5b8c\u5168\u306b\u505c\u6b62\u3059\u308b\u73fe\u8c61\u3001\u307e\u305f\u305d\u306e\u6642\u9593\u3002\n\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3067\u306f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u53c2\u7167\u3092\u8fbf\u3063\u305f\u308a\u3001\u5fc5\u8981\u3067\u3042\u308c\u3070\u30b3\u30f3\u30d1\u30af\u30c8\u5316\u3057\u305f\u308a\u3059\u308b\u3002\n\n\n\u3053\u306e\u9593\u306b\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u30e1\u30e2\u30ea\u3092\u53c2\u7167\u3057\u305f\u308a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u95a2\u9023\u3092\u66f8\u304d\u5909\u3048\u305f\u308a\u3059\u308b\u3068\u3001\u6b63\u78ba\u306b\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u304c\u3067\u304d\u306a\u304f\u306a\u308b\u3002\n\u306a\u306e\u3067\u3001\u3069\u3046\u3057\u3066\u3082\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b9\u30ec\u30c3\u30c9\u3092\u6b62\u3081\u3066\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u304c\u5c02\u6709\u3059\u308b\u6642\u9593\u304c\u5fc5\u8981\u306b\u306a\u308b\u3002\n\u3053\u308c\u304c Stop the World.\n\n\nSTW \u3068\u7701\u7565\u3055\u308c\u305f\u308a\u3059\u308b\u3053\u3068\u3082\u3042\u308b\u3002\n\u6700\u521d\u3001\u67d0\u5438\u8840\u9b3c\u306e\u5fc5\u6bba\u6280\u3092\u5143\u306b\u3057\u305f\u30cd\u30bf\u3068\u601d\u3063\u3066\u305f\u3051\u3069\u3001\u6b63\u5f0f\u306a\u7528\u8a9e\u3089\u3057\u3044\u3002\n\n\n\u30b3\u30f3\u30d1\u30af\u30c8\u5316\n\n\u65ad\u7247\u5316\u3057\u305f\u30e1\u30e2\u30ea\u3092\u6574\u7406\u3057\u3066\u3001\u307e\u3068\u307e\u3063\u305f\u7a7a\u304d\u9818\u57df\u3092\u78ba\u4fdd\u3059\u308b\u3053\u3068\u3002\n\n\n\u30de\u30a4\u30ca\u30fc\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\n\nMinor Garbage Collection\nYoung \u9818\u57df\uff08Eden, Survivor\uff09\u304c\u3044\u3063\u3071\u3044\u306b\u306a\u3063\u305f\u3068\u304d\u306b\u5b9f\u884c\u3055\u308c\u308b\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3002\n\n\nScavenge GC\n\n\u4e16\u4ee3\u5225 GC \u3067\u5b9f\u884c\u3055\u308c\u308b\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u306e\u624b\u6cd5\u306e\uff11\u3064\u3002\n\n\n\u5bfe\u8c61\u30e1\u30e2\u30ea\u9818\u57df\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u8abf\u3079\u3001\u4f7f\u7528\u3057\u3066\u3044\u306a\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u7834\u68c4\u3057\u3001\u4f7f\u7528\u3057\u3066\u3044\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u5225\u306e\u9818\u57df\u306b\u79fb\u52d5\u3059\u308b\u3002\n\u5bfe\u8c61\u30e1\u30e2\u30ea\u9818\u57df\u304c\u9650\u3089\u308c\u3066\u304a\u308a\u3001\u6700\u5f8c\u306f\u5bfe\u8c61\u306e\u30e1\u30e2\u30ea\u9818\u57df\u304c\u7a7a\u306b\u306a\u308b\u306e\u3067\u30b3\u30f3\u30d1\u30af\u30c8\u5316\u3059\u308b\u5fc5\u8981\u304c\u306a\u304f\u3001\u9ad8\u901f\u306b\u52d5\u4f5c\u3059\u308b\u3002\n\n\n\u30de\u30a4\u30ca\u30fc\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3067\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u3002\n\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u79fb\u52d5\u3059\u308b\u3060\u3051\u306a\u306e\u3067\u3001 Copy GC \u3068\u3082\u547c\u3070\u308c\u308b\u3002\nStop the World \u306e\u6642\u9593\u306f\u77ed\u3044\u3002\n\n\nCopy GC\n\nScavenge GC \u306e\u3053\u3068\u3002\n\n\n\u30e1\u30b8\u30e3\u30fc\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\n\nMajor Garbage Collection\nOld \u9818\u57df\u304c\u3044\u3063\u3071\u3044\u306b\u306a\u3063\u305f\u3068\u304d\u306b\u5b9f\u884c\u3055\u308c\u308b\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3002\n\n\n\u53b3\u5bc6\u306b\u306f\u8272\u3005\u8907\u96d1\u306a\u6761\u4ef6\u304c\u3042\u308b\u3089\u3057\u3044\u3051\u3069\u3001\u305d\u306e\u3078\u3093\u306f CMS GC \u304a\u3055\u3089\u3044 - sugarlife's blog \u3092\u53c2\u7167\u306e\u3053\u3068\u3002\n\n\n\u30b3\u30f3\u30d1\u30af\u30c8\u5316\u306f\u884c\u308f\u306a\u3044\u3002\n\n\n\u30d5\u30eb\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\n\nFull Garbage Collection\nFull GC\n\u5168\u30e1\u30e2\u30ea\u9818\u57df\uff08Permanent \u3082\u542b\u3080\uff09\u3092\u5bfe\u8c61\u306b\u3057\u305f\u5927\u898f\u6a21\u306a\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3002\n\u65ad\u7247\u5316\u306e\u305f\u3081 Old \u9818\u57df\u306e\u7a7a\u304d\u9818\u57df\u304c\u8db3\u308a\u306a\u3044\u3068\u304d\u3084\u3001\u4ed6\u306e GC \u3067\u306e\u56de\u53ce\u304c\u9593\u306b\u5408\u308f\u306a\u3044\u3088\u3046\u306a\u3068\u304d\u306b\u5b9f\u884c\u3055\u308c\u308b\u3002\n\u30b3\u30f3\u30ab\u30ec\u30f3\u30c8\u3067\u306f\u306a\u3044 Mark & Sweep \u3092\u5b9f\u884c\u3057\u3066\u3001\u66f4\u306b\u30b3\u30f3\u30d1\u30af\u30c8\u5316\u3082\u884c\u3046\u3002\n\u5fc5\u7136\u7684\u306b Stop the World \u306f\u9577\u304f\u306a\u308b\u3002\n\n\nMark & Sweep\n\n\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u306e\u624b\u6cd5\u306e\uff11\u3064\u3002\n\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\uff12\u3064\u306e\u30d5\u30a7\u30fc\u30ba\u306b\u5206\u3051\u3066\u5b9f\u884c\u3059\u308b\u3002\n\n\n\u6700\u521d\u306e\u30d5\u30a7\u30fc\u30ba\u3067\u306f\u3001\u4f7f\u7528\u3057\u3066\u3044\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u53c2\u7167\u3092\u8fbf\u308a\u306a\u304c\u3089\u30de\u30fc\u30af\u3092\u4ed8\u3051\u3066\u3044\u304d\u3001\u4f7f\u7528\u3057\u3066\u3044\u306a\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u7279\u5b9a\u3059\u308b\u3002\n\u6b21\u306e\u30d5\u30a7\u30fc\u30b9\u3067\u306f\u3001\u4f7f\u7528\u3057\u3066\u3044\u306a\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u30e1\u30e2\u30ea\u4e0a\u304b\u3089\u524a\u9664\u3059\u308b\u3002\n\n\n\u30d5\u30eb\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3067\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u3002\n\n\n\u30b7\u30ea\u30a2\u30eb GC\n\nSerial GC\n\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u306e\u5b9f\u884c\u65b9\u6cd5\u306e\uff11\u3064\u3002\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u306e\u30b9\u30ec\u30c3\u30c9\u304c\u4ea4\u4e92\u306b\u5b9f\u884c\u3055\u308c\u308b\u3002\n\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u7528\u306e\u30b9\u30ec\u30c3\u30c9\u306f\uff11\u3064\u3060\u3051\u3057\u304b\u4f7f\u7528\u3055\u308c\u306a\u3044\u3002\n\u30b7\u30f3\u30b0\u30eb\u30b3\u30a2\u306e\u30de\u30b7\u30f3\u3067\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3002\n\n\n\u30d1\u30e9\u30ec\u30eb GC\n\nParallel GC\n\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u306e\u5b9f\u884c\u65b9\u6cd5\u306e\uff11\u3064\u3002\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u306e\u30b9\u30ec\u30c3\u30c9\u304c\u4ea4\u4e92\u306b\u5b9f\u884c\u3055\u308c\u308b\u306e\u306f\u30b7\u30ea\u30a2\u30eb GC \u3068\u540c\u3058\u3002\n\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u7528\u306e\u30b9\u30ec\u30c3\u30c9\u304c\u8907\u6570\u4f7f\u7528\u3055\u308c\u308b\u70b9\u304c\u30d1\u30e9\u30ec\u30eb\u3002\n\u30de\u30eb\u30c1\u30b3\u30a2\u306e\u30de\u30b7\u30f3\u3067\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3002\n\n\nConcurrent Mark & Sweep GC\n\nConcurrent GC \u3068\u304b CMS \u3068\u547c\u3070\u308c\u305f\u308a\u3082\u3059\u308b\u3002\nMark & Sweep \u306e\u51e6\u7406\u3092\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b9\u30ec\u30c3\u30c9\u3068\u540c\u6642\u4e26\u884c\u3067\u884c\u3046\u624b\u6cd5\u3002\n\n\n\u5b8c\u5168\u306a\u540c\u6642\u4e26\u884c\u3067\u306f\u306a\u304f\u3001\u6700\u521d\u3068\u9014\u4e2d\u3067 Stop the World \u304c\u767a\u751f\u3059\u308b\u3002\n\n\nStop the World \u306e\u6642\u9593\u306f\u77ed\u3044\u3002\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30c8\u304c\u540c\u6642\u306b\u5b9f\u884c\u3055\u308c\u308b\u306e\u3067\u3001\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\uff08\u5358\u4f4d\u6642\u9593\u3042\u305f\u308a\u306e\u51e6\u7406\u4ef6\u6570\uff09\u306f\u4e0b\u304c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002\n\n\n\u4ee3\u308f\u308a\u306b\u3001 Stop the World \u306e\u6642\u9593\u306f\u77ed\u3044\u306e\u3067\u30ec\u30b9\u30dd\u30f3\u30b9\u30bf\u30a4\u30e0\uff08\u51e6\u7406\u7d50\u679c\u304c\u8fd4\u3055\u308c\u308b\u307e\u3067\u306e\u6642\u9593\uff09\u306f\u4e0a\u304c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002\n\n\n\u30e1\u30b8\u30e3\u30fc\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3067\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u3002\n\n\nG1 GC\n\nGarbage First GC\n\u30e1\u30e2\u30ea\u306e\u5927\u5bb9\u91cf\u5316\u306b\u4f34\u3044\u3001\u4eca\u307e\u3067\u306e\u4e16\u4ee3\u5225 GC \u3067\u306f\u7121\u99c4\u304c\u591a\u3044\u3068\u3044\u3046\u3053\u3068\u3067\u8003\u3048\u51fa\u3055\u308c\u305f GC\u3002\nJava 7 \u304b\u3089\u63a1\u7528\u3055\u308c\u3001 Java 9 \u3067\u30c7\u30d5\u30a9\u30eb\u30c8\u5316\u3059\u308b\u4e88\u5b9a\u3002\n\u30d2\u30fc\u30d7\u9818\u57df\u3092\u300c\u30ea\u30fc\u30b8\u30e7\u30f3\u300d\u3068\u547c\u3070\u308c\u308b\u533a\u57df\u3067\u7b49\u5206\u5272\u3057\u3001\u4e16\u4ee3\u5225\u306b\u7ba1\u7406\u3059\u308b\u3002\n\n\n\u5206\u5272\u3057\u305f\u9818\u57df\u3092 Eden, Survivor, Old \u3068\u3057\u3066\u4f7f\u3046\u3002\n\u307e\u305a Eden \u306b\u914d\u7f6e\u3057\u3066\u3001\u3044\u3063\u3071\u3044\u306b\u306a\u3063\u305f\u3089 Survivor, \u305d\u3057\u3066 Old \u306b\u79fb\u3057\u3066\u3044\u304f\u8003\u3048\u65b9\u306f\u540c\u3058\u3002\n\n\n\n\n\u4e16\u4ee3\u5225GC\n\nHotStop VM \u3067\u63a1\u7528\u3055\u308c\u305f\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u306e\u624b\u6cd5\u3002\n\u30d2\u30fc\u30d7\u9818\u57df\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u751f\u5b58\u671f\u9593\u306e\u9577\u3055\u306b\u5408\u308f\u305b\u3066 Young \u9818\u57df\u3068 Old \u9818\u57df\u306b\u5206\u5272\u3057\u3066\u3001\u6bb5\u968e\u7684\u306b\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n\nHotSpot VM\n\nJVM \u3067\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u9ad8\u901f\u5316\u306e\u305f\u3081\u306e\u6280\u8853\u3001\u307e\u305f\u305d\u306e\u6280\u8853\u3092\u63a1\u7528\u3057\u305f JVM \u306e\u3053\u3068\u3002\nHotSpot - \u3059\u306a\u308f\u3061\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4e2d\u3067\u3082\u7279\u306b\u5b9f\u884c\u983b\u5ea6\u306e\u9ad8\u3044\u90e8\u5206\u3092\u7279\u5b9a\u3057\u3066\u3001\u305d\u306e\u90e8\u5206\u3092\u512a\u5148\u7684\u306b\u6a5f\u68b0\u8a9e\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u5b9f\u884c\u3059\u308b\u624b\u6cd5\u30fb\u4ed5\u7d44\u307f\u3002\n\n\n\uff11\u56de\u3057\u304b\u5b9f\u884c\u3057\u306a\u3044\u30b3\u30fc\u30c9\u3092\u6a5f\u68b0\u8a9e\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u306e\u306f\u7121\u99c4\u304c\u5927\u304d\u3044\u306e\u3067\u3001\u305d\u3046\u3044\u3046\u90e8\u5206\u306f\u30a4\u30f3\u30bf\u30d7\u30ea\u30bf\u3067\u5b9f\u884c\u3057\u3066\u3001\u4f55\u56de\u3082\u5b9f\u884c\u3055\u308c\u308b\u90e8\u5206\uff08HotSpot\uff09\u3060\u3051\u3092\u6a5f\u68b0\u8a9e\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u9ad8\u901f\u5316\u3057\u3088\u3046\u3001\u3068\u3044\u3046\u8003\u3048\u65b9\u3002\n\n\n\u300c\u4e00\u822c\u7684\u306a\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u3001\u5b9f\u884c\u6642\u9593\u306e 80% \u304c\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e 20 % \u3067\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u300d\u3068\u3044\u3046\u6cd5\u5247\u304c\u3082\u3068\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n\nJust In Time Compiler\n\nJIT \u30b3\u30f3\u30d1\u30a4\u30e9\n\u4e2d\u9593\u8a00\u8a9e\u306a\u3069\u5b9f\u884c\u74b0\u5883\u306b\u4f9d\u5b58\u3057\u306a\u3044\u5f62\u5f0f\u3067\u66f8\u304b\u308c\u305f\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u3001\u5b9f\u884c\u76f4\u524d\uff08Just In Time\uff09\u306b\u5b9f\u884c\u74b0\u5883\u306b\u5408\u308f\u305b\u305f\u6a5f\u68b0\u8a9e\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u5b9f\u884c\u3059\u308b\u624b\u6cd5\u30fb\u6a5f\u80fd\u3002\n\n\n\u30a4\u30f3\u30bf\u30d7\u30ea\u30bf\u306f\u9010\u6b21\u30bd\u30fc\u30b9\u3092\u8aad\u307f\u306a\u304c\u3089\u5b9f\u884c\u3059\u308b\u306e\u3067\u3001\u3061\u3087\u3063\u3068\u9055\u3046\u3002\n\n\n\u5b9f\u884c\u74b0\u5883\u306b\u4f9d\u5b58\u3057\u306a\u3044\u5f62\u5f0f\u3067\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u914d\u5e03\u3067\u304d\u3001\u304b\u3064\u5b9f\u884c\u901f\u5ea6\u306f\u4e88\u3081\u6a5f\u68b0\u8a9e\u3067\u4f5c\u6210\u3055\u308c\u305f\u30d7\u30ed\u30b0\u30e9\u30e0\u3068\u5f15\u3051\u3092\u53d6\u3089\u306a\u3044\u3068\u3044\u3046\u7279\u5fb4\u304c\u3042\u308b\u3002\n\n\n\u53c2\u8003\n\n\u5168\u822c\n\nAmazon.co.jp\uff1a Java\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9: Scott Oaks, \u30a2\u30af\u30ed\u30af\u30a8\u30b9\u30c8\u30c6\u30af\u30ce\u30ed\u30b8\u30fc\u682a\u5f0f\u4f1a\u793e, \u5bfa\u7530 \u4f73\u592e, \u7267\u91ce \u8061: \u672c\n\n\n\u30e1\u30e2\u30ea\u7ba1\u7406\u306e\u4ed5\u7d44\u307f\n\nJava\u6280\u8853\u6700\u524d\u7dda - \u300cJava SE 6\u5b8c\u5168\u653b\u7565\u300dGarbage First GC\uff1aITpro\nJava\u6280\u8853\u6700\u524d\u7dda - \u300c\u30e1\u30e2\u30ea\u30fc\u3092\u610f\u8b58\u3057\u3066\u307f\u3088\u3046\u300d\u7b2c2\u56de\u3000GC\u306e\u4ed5\u7d44\u307f\u3092\u7406\u89e3\u3059\u308b\uff1aITpro\nJava\u6280\u8853\u6700\u524d\u7dda - \u300c\u30e1\u30e2\u30ea\u30fc\u3092\u610f\u8b58\u3057\u3066\u307f\u3088\u3046\u300d\u7b2c4\u56de\u3000\u9032\u5316\u3059\u308b\u30e1\u30e2\u30ea\u30fc\u7ba1\u7406\uff1aITpro\nGarbage First Garbage Collection (G1 GC) #jjug_ccc #ccc_cd6\nCMS GC \u304a\u3055\u3089\u3044 - sugarlife's blog\nMetaspace \u3092 OpenJDK \u5b9f\u88c5\u304b\u3089\u898b\u3066\u307f\u3088\u3046\uff01 | \u672b\u6c38\u606d\u6b63 | SlideShare\nJava 8\u3067PermGen\u306eOutOfMemoryError\u554f\u984c\u306f\u89e3\u6c7a\u3055\u308c\u308b\u306e\u304b\uff1f\nJava8\u306eHotSpotVM\u304b\u3089Permanent\u9818\u57df\u304c\u6d88\u3048\u305f\u7406\u7531\u3068\u305d\u306e\u5f71\u97ff | \u30ae\u30fc\u30af\u3092\u76ee\u6307\u3057\u3066\nJava Garbage Collection Basics\nGarbage Collection\u306b\u3064\u3044\u3066\u3061\u3087\u3063\u3068\u8abf\u3079\u3066\u307f\u305f - wyukawa\u2019s blog\nJava\u306f\u3069\u306e\u3088\u3046\u306b\u52d5\u304f\u306e\u304b\uff5e\u30b9\u30e9\u30a4\u30c9\u3067\u308f\u304b\u308bJVM\u306e\u4ed5\u7d44\u307f\n\u7b2c9\u56de\u3000\uff3b\u6700\u7d42\u56de\uff3dHotSpot JVM\u306eGC\u3092\u9078\u629e\u3057\u3088\u3046\uff1aJava\u306f\u3069\u306e\u3088\u3046\u306b\u52d5\u304f\u306e\u304b\uff5e\u56f3\u89e3\u3067\u308f\u304b\u308bJVM\u306e\u4ed5\u7d44\u307f\uff5cgihyo.jp \u2026 \u6280\u8853\u8a55\u8ad6\u793e\nJIT\u30b3\u30f3\u30d1\u30a4\u30e9\u3068\u306f\uff5c\u5b9f\u884c\u6642\u30b3\u30f3\u30d1\u30a4\u30e9\uff5c\u30b8\u30e3\u30b9\u30c8\u30a4\u30f3\u30bf\u30a4\u30e0\u30b3\u30f3\u30d1\u30a4\u30e9 - \u610f\u5473/\u5b9a\u7fa9 \uff1a IT\u7528\u8a9e\u8f9e\u5178\njava memory structure heap permanent native | Google \u753b\u50cf\u691c\u7d22\n\n\nOOME \u306e\u8abf\u67fb\u65b9\u6cd5\u306a\u3069\n\nJava\u30c8\u30e9\u30d6\u30eb\u306b\u5099\u3048\u3088\u3046 #jjug_ccc #ccc_h2\n\u307e\u3058\u3081\u306bJVM\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0: \u7b2c2\u56de GC\u30ed\u30b0\u3092\u307f\u308b\n\u4eba\u751f\u697d\u3057\u307e\u306a\u304d\u3083\u3082\u3063\u305f\u3044\u306a\u3044\uff01: java\u306eOutOfMemory\u6642\u306e\u30d2\u30fc\u30d7\u306e\u5206\u6790\u306b\u30c1\u30e3\u30ec\u30f3\u30b8\uff08jhat\uff09\n\n\n\u30c4\u30fc\u30eb\u985e\n\njcmd\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\njcmd\njmap - \u30e1\u30e2\u30ea\u30fc\u30de\u30c3\u30d7\njstat\njvisualvm\u3092\u4f7f\u3063\u305fCPU\u30d7\u30ed\u30d5\u30a1\u30a4\u30ea\u30f3\u30b0 - Java\u3067\u753b\u50cf\u30d3\u30e5\u30fc\u30a2\u3092\u958b\u767a\u3057\u3066\u307f\u308b\u65e5\u8a18\nProfiling Vs. Sampling in Java's VisualVM\njava - Difference between sampling and profiling in jVisualvm - Stack Overflow\nHeapStats: Introduction and Technical Preview\nHeapStats/jp - IcedTea\n\nOutOfMemoryError (\u4ee5\u4e0b OOME)\u304c\u8d77\u3053\u3063\u305f\u3068\u304d\u306b\u304a\u624b\u4e0a\u3052\u72b6\u614b\u306b\u306a\u3089\u306a\u3044\u305f\u3081\u306b\u3082\u3001 Java \u306e\u30e1\u30e2\u30ea\u7ba1\u7406\u306e\u4ed5\u7d44\u307f\u3068\u304b\u3001 OOME \u304c\u8d77\u3053\u3063\u305f\u3068\u304d\u306e\u8abf\u67fb\u65b9\u6cd5\u3068\u304b\u3092\u8abf\u3079\u308b\u3002\n\n# \u74b0\u5883\n## OS\nWindows 7\n\n## Java\n```text\n> java -version\njava version \"1.8.0_74\"\nJava(TM) SE Runtime Environment (build 1.8.0_74-b02)\nJava HotSpot(TM) 64-Bit Server VM (build 25.74-b02, mixed mode)\n```\n\nJava 8 \u3067\u3001 Oracle \u306e JVM \u3092\u524d\u63d0\u3068\u3057\u305f\u8a71\u3067\u3059\u3002\n\n# Java \u306e\u30e1\u30e2\u30ea\u7ba1\u7406\n\u3053\u308c\u3092\u77e5\u3063\u3066\u304a\u304b\u306a\u3044\u3068\u3001 OOME \u304c\u8d77\u3053\u3063\u3066\u3082\u3001\u30e1\u30e2\u30ea\u5185\u3067\u4f55\u304c\u8d77\u3053\u3063\u3066\u3044\u3066\u3001\u3069\u3053\u3092\u8abf\u67fb\u3059\u3079\u304d\u3067\u3001\u3069\u306e\u3088\u3046\u306b\u5bfe\u51e6\u3057\u305f\u3089\u3044\u3044\u306e\u304b\u304c\u5224\u65ad\u3067\u304d\u306a\u3044\u3002\n\u306a\u306e\u3067\u3001\u307e\u305a\u306f\u3001\u305d\u3082\u305d\u3082 Java \u304c\u3069\u3046\u3084\u3063\u3066\u30e1\u30e2\u30ea\u3092\u7ba1\u7406\u3057\u3066\u3044\u308b\u306e\u304b\u3092\u77e5\u308b\u3002\n\n\u3057\u304b\u3057\u3001\u5b9f\u969b\u8abf\u3079\u3066\u307f\u305f\u3089\u4e88\u60f3\u901a\u308a\u3068\u3044\u3046\u304b\u306a\u3093\u3068\u3044\u3046\u304b\u3001\u91cf\u304c\u591a\u304f\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u3002\n\u306a\u306e\u3067\u3001\u500b\u3005\u306e\u7528\u8a9e\u306e\u8aac\u660e\u306f\u672b\u5c3e\u306e [\u7528\u8a9e\u96c6](#\u7528\u8a9e\u96c6) \u306b\u62bc\u3057\u8fbc\u3081\u305f\u306e\u3067\u3001\u3053\u3053\u3067\u306f\u3056\u3063\u304f\u308a\u3068\u3057\u305f\u6982\u8981\u3060\u3051\u8a18\u8f09\u3059\u308b\u3002\n\n## \u30e1\u30e2\u30ea\u306e\u69cb\u9020\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/7664c5a7-521d-babb-2332-0b3a67ae5f99.jpeg)\n\n\u8d85\u3056\u3063\u304f\u308a\u3068\u3057\u305f\u3001\u30e1\u30e2\u30ea\u69cb\u9020\u3092\u8868\u3057\u305f\u56f3\u3002\n\n\u304a\u304a\u304d\u304f\u3001[\u30d2\u30fc\u30d7\uff08Heap\uff09\u9818\u57df](#\u30d2\u30fc\u30d7)\u3068[\u30cd\u30a4\u30c6\u30a3\u30d6\uff08Native\uff09\u9818\u57df](#\u30cd\u30a4\u30c6\u30a3\u30d6\u9818\u57df)\u306e\uff12\u3064\u306e\u9818\u57df\u304c\u3042\u308b\u3002\n\n\u30d2\u30fc\u30d7\u306f Java \u30d7\u30ed\u30b0\u30e9\u30e0\u304c\u4f7f\u3046\u9818\u57df\u3067\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u4e0a\u3067\u751f\u6210\u3057\u305f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u3001\u3053\u306e\u30d2\u30fc\u30d7\u9818\u57df\u306b\u914d\u7f6e\u3055\u308c\u308b\u3002\n\u4e00\u65b9\u3001\u30cd\u30a4\u30c6\u30a3\u30d6\u9818\u57df\u306f JVM \u304c\u52d5\u304f\u306e\u306b\u5fc5\u8981\u306a\u30e1\u30e2\u30ea\u3084\u30b9\u30ec\u30c3\u30c9\u306e\u30b9\u30bf\u30c3\u30af\u3092\u7ba1\u7406\u3059\u308b\u306e\u306b\u4f7f\u7528\u3055\u308c\u308b\u3002\n\n## \u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\n[\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3](#\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3)\uff08\u4ee5\u4e0b GC\uff09\u3068\u306f\u3001\u30d2\u30fc\u30d7\u9818\u57df\u306b\u5b58\u5728\u3059\u308b\u4f7f\u308f\u308c\u3066\u3044\u306a\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u898b\u3064\u3051\u51fa\u3057\u3001\u81ea\u52d5\u3067\u524a\u9664\u3057\u3066\u304f\u308c\u308b\u4ed5\u7d44\u307f\u3092\u8a00\u3046\u3002\n\n\u4e00\u53e3\u306b GC \u3068\u8a00\u3063\u3066\u3082\u3001\n\n- [Minor GC](#\u30de\u30a4\u30ca\u30fc\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3)\n- [Major GC](#\u30e1\u30b8\u30e3\u30fc\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3)\n- [Full GC](#\u30d5\u30eb\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3)\n- [Scavenge GC](#scavenge-gc)\n- [Copy GC](#copy-gc)\n- [Mark & Sweep GC](#mark--sweep)\n- [Serial GC](#\u30b7\u30ea\u30a2\u30eb-gc)\n- [Parallel GC](#\u30d1\u30e9\u30ec\u30eb-gc)\n- [Concurrent GC](#concurrent-mark--sweep-gc)\n\n\u3068\u304b\u3044\u3063\u3071\u3044\u3042\u3063\u3066\u3001\u521d\u898b\u3060\u3068\u308f\u3051\u304c\u308f\u304b\u3089\u306a\u304f\u306a\u308b\u3002\n\n\u3053\u306e\u8fba\u306e\u9055\u3044\u3092\u7406\u89e3\u3057\u3066\u3044\u306a\u3044\u3068\u3001\u3044\u3056\u30e1\u30e2\u30ea\u306e\u72b6\u614b\u3084\u767a\u751f\u3057\u305f GC \u306e\u60c5\u5831\u3068\u304b\u3092\u898b\u3066\u3082\u3001\u610f\u5473\u304c\u5206\u304b\u3089\u306a\u304f\u9014\u65b9\u306b\u66ae\u308c\u3066\u3057\u307e\u3046\u3002\n\u306a\u306e\u3067\u3001\u3053\u308c\u3089\u306e\u9055\u3044\u306b\u3064\u3044\u3066\u3082\u77e5\u3063\u3066\u304a\u3044\u305f\u307b\u3046\u304c\u826f\u3044\u3068\u601d\u3046\u3002\n\n\u500b\u3005\u306e\u610f\u5473\u306f [\u7528\u8a9e\u96c6](#\u7528\u8a9e\u96c6) \u306b\u307e\u3068\u3081\u305f\u306e\u3067\u3001\u305d\u3061\u3089\u3092\u53c2\u7167\u306e\u3053\u3068\u3002\n\n# OOME \u306e\u7a2e\u985e\nOOME \u306f\u69d8\u3005\u306a\u8981\u56e0\u3067\u767a\u751f\u3059\u308b\u3002\n\n- \u30d2\u30fc\u30d7\u9818\u57df\u304c\u8db3\u308a\u306a\u304f\u306a\u3063\u305f\u3002\n- [Permanent \u9818\u57df](#permanent-\u9818\u57df)\u304c\u8db3\u308a\u306a\u304f\u306a\u3063\u305f\uff08Java 7 \u307e\u3067\uff09\n- Full GC \u304c\u9ad8\u983b\u5ea6\u3067\u5b9f\u884c\u3055\u308c\u305f\u3002\n- \u30b9\u30ec\u30c3\u30c9\u3092\u5927\u91cf\u306b\u4f5c\u308a\u3059\u304e\u3066\u30cd\u30a4\u30c6\u30a3\u30d6\u30e1\u30e2\u30ea\u304c\u8db3\u308a\u306a\u304f\u306a\u3063\u305f\u3002\n- etc...\n\n\u4eca\u56de\u306f\u3001\u306a\u3093\u3060\u304b\u3093\u3060\u3067\u958b\u767a\u3057\u3066\u3066\u4e00\u756a\u906d\u9047\u3059\u308b\u983b\u5ea6\u304c\u591a\u3044\u3068\uff08<span class=\"small\">\u52dd\u624b\u306b</span>\uff09\u601d\u3063\u3066\u3044\u308b\u3001\u30d2\u30fc\u30d7\u304c\u8db3\u308a\u306a\u3044\u30b1\u30fc\u30b9\u306b\u7d5e\u3063\u3066\u8abf\u67fb\u65b9\u6cd5\u3068\u5bfe\u51e6\u65b9\u6cd5\u3092\u52c9\u5f37\u3059\u308b\u3002\n\n\u203b\u4eca\u5f8c\u3001\u5358\u306b OOME \u3068\u66f8\u3044\u305f\u5834\u5408\u3001\u305d\u308c\u306f\u30d2\u30fc\u30d7\u4e0d\u8db3\u3092\u7531\u6765\u3068\u3059\u308b OOME \u306e\u3053\u3068\u3092\u6307\u3057\u307e\u3059\u3002\n\n# OOME \u304c\u767a\u751f\u3059\u308b\u8981\u56e0\n\u304a\u304a\u307e\u304b\u306b\u8a00\u3046\u3068\u3001\u4ee5\u4e0b\u306e\u3044\u305a\u308c\u304b\u306b\u306a\u308b\u3002\n\n1. \u5358\u7d14\u306b\u30e1\u30e2\u30ea\u304c\u8db3\u308a\u3066\u3044\u306a\u3044\u3002\n1. \u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u554f\u984c\u304c\u3042\u308a\u3001\u30e1\u30e2\u30ea\u306e\u89e3\u653e\u5fd8\u308c\u3084\u4e0d\u8981\u306a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5927\u91cf\u751f\u6210\u306a\u3069\u304c\u767a\u751f\u3057\u3066\u3044\u308b\u3002\n\n\u524d\u8005\u306a\u3089\u3001\u5358\u7d14\u306b\u30d2\u30fc\u30d7\u9818\u57df\u3092\u5897\u3084\u305b\u3070\u3044\u3044\u3002\n\uff08\u53b3\u5bc6\u306b\u306f\u3001\u7121\u99c4\u306b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4fdd\u6301\u3057\u3066\u3044\u3066\u6539\u826f\u306e\u4f59\u5730\u304c\u3042\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u304c\u3001\u4eca\u56de\u306f\u305d\u3053\u307e\u3067\u306f\u8003\u3048\u306a\u3044\uff09\n\n\u5f8c\u8005\u306e\u5834\u5408\u306f\u3001\u554f\u984c\u7b87\u6240\u3092\u7279\u5b9a\u3057\u3066\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u6539\u4fee\u3057\u306a\u3051\u308c\u3070\u3001\u3069\u3093\u306a\u306b\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba\u3092\u5897\u3084\u3057\u3066\u3082\u610f\u5473\u304c\u7121\u3044\uff08\u5834\u5408\u306b\u3088\u3063\u3066\u306f\u89e3\u6c7a\u3059\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u3051\u3069\u3001\u6839\u672c\u89e3\u6c7a\u306b\u306f\u306a\u3089\u306a\u3044\uff09\u3002\n\n\u767a\u751f\u3057\u305f OOME \u304c\u3069\u3061\u3089\u3092\u539f\u56e0\u3068\u3057\u3066\u308b\u304b\u3092\u8abf\u3079\u308b\u305f\u3081\u306b\u306f\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30e1\u30e2\u30ea\u306e\u72b6\u614b\u3092\u8abf\u67fb\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\n\n\n# \u554f\u984c\u306e\u5207\u308a\u5206\u3051\u65b9\n## \u554f\u984c\u306a\u3055\u305d\u3046\u306a\u30d2\u30fc\u30d7\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/d0b711f5-72ff-8488-838e-e311595c6d11.jpeg)\n\n- \u30d2\u30fc\u30d7\u306e\u4f7f\u7528\u91cf\u304c\u540c\u3058\u9ad8\u3055\u306e\u6ce2\u72b6\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n- \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u3001\u52d5\u3044\u3066\u3044\u308b\u9650\u308a\u5c11\u3057\u305a\u3064\u3060\u304c\u30d2\u30fc\u30d7\u3092\u6d88\u8cbb\u3057\u3066\u3044\u304f\u3002\n- \u3057\u304b\u3057\u3001\u3042\u308b\u7a0b\u5ea6\u3059\u308b\u3068\u30de\u30a4\u30ca\u30fc\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u304c\u767a\u52d5\u3059\u308b\u3002\n    - \u3059\u308b\u3068\u3001\u4f7f\u3063\u3066\u3044\u306a\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u524a\u9664\u3055\u308c\u308b\u306e\u3067\u3001\u305d\u306e\u5206\u306e\u9818\u57df\u304c\u78ba\u4fdd\u3055\u308c\u308b\u3053\u3068\u306b\u306a\u308b\u3002\n- \u30b0\u30e9\u30d5\u304c\u5c71\u306b\u306a\u308b\u306e\u306f\u3001\u3053\u306e\u30de\u30a4\u30ca\u30fc\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u7e70\u308a\u8fd4\u3057\u3066\u3044\u308b\u305f\u3081\u3002\n- GC \u5f8c\u306e\u30e1\u30e2\u30ea\u9818\u57df\u304c\u4e00\u5b9a\u3068\u3044\u3046\u3053\u3068\u306f\u3001\u4e0d\u8981\u306a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u3061\u3083\u3093\u3068\u6bce\u56de\u89e3\u653e\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u3092\u8868\u3057\u3066\u3044\u308b\u3002\n\n## \u5358\u7d14\u306b\u30b5\u30a4\u30ba\u304c\u8db3\u308a\u306a\u3055\u305d\u3046\n- \u8d77\u52d5\u6642\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba\u3092\u5897\u3084\u3057\u305f\u7d50\u679c\u3001\u2191\u306e\u554f\u984c\u306a\u3055\u305d\u3046\u306a\u30d2\u30fc\u30d7\u306e\u5f62\u306b\u843d\u3061\u7740\u3044\u305f\u5834\u5408\u3001\u5358\u7d14\u306b\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba\u304c\u8db3\u308a\u3066\u3044\u306a\u304b\u3063\u305f\u3068\u3044\u3046\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002\n- \u305f\u3060\u3057\u3001\u300c\u7121\u99c4\u306b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3057\u3066\u3044\u305f\u300d\u3068\u3044\u3046\u53ef\u80fd\u6027\u3082\u3042\u308b\u306e\u3067\u3001\u5c11\u306a\u304f\u3068\u3082 OOME \u304c\u767a\u751f\u3057\u305f\u5834\u6240\u306f\u7279\u5b9a\u3057\u3066\u304a\u3044\u305f\u307b\u3046\u304c\u3044\u3044\u3068\u601d\u3046\u3002\n\n## \u30e1\u30e2\u30ea\u30ea\u30fc\u30af\u3063\u307d\u3044\u30d2\u30fc\u30d7\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/67e3c601-5f94-8811-8a10-c379fb682070.jpeg)\n\n- \u30d2\u30fc\u30d7\u306e\u4f7f\u7528\u91cf\u304c\u53f3\u80a9\u4e0a\u304c\u308a\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n- \u4f55\u56de\u304b GC \u304c\u767a\u52d5\u3057\u3066\u3044\u308b\u304c\u3001\u305d\u306e\u305f\u3073\u306b\u6700\u4f4e\u5024\u304c\u4e0a\u6607\u3057\u3066\u3044\u3063\u3066\u3044\u308b\u3002\n    - \u4e0a\u6607\u3057\u305f\u5206\u3060\u3051\u3001\u958b\u653e\u3055\u308c\u3066\u3044\u306a\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u5b58\u5728\u3057\u3066\u3044\u308b\u3068\u3044\u3046\u3053\u3068\u3092\u8868\u3057\u3066\u3044\u308b\u3002\n- \u3053\u3046\u306a\u308b\u3068\u3001\u3069\u3053\u304b\u306b\u89e3\u653e\u6f0f\u308c\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u3042\u308b\u3053\u3068\u3092\u7591\u3063\u305f\u65b9\u304c\u3044\u3044\u3002\n\n## \u30d0\u30ab\u3067\u304b\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u3063\u305f\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/449eb0da-0257-0664-d93d-836f78c1b893.jpeg)\n\n- OOME \u304c\u767a\u751f\u3059\u308b\u307e\u3067\u306f\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba\u306f\u5b89\u5b9a\u3057\u3066\u3044\u305f\u306e\u306b\u3001\u3044\u304d\u306a\u308a\u7206\u767a\u7684\u306b\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba\u304c\u5927\u304d\u304f\u306a\u3063\u3066\u843d\u3061\u305f\u3088\u3046\u306a\u72b6\u614b\u3002\n- \u30d0\u30ab\u3067\u304b\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u3044\u304d\u306a\u308a\u751f\u6210\uff08\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3093\u3067\u30e1\u30e2\u30ea\u4e0a\u306b\u5168\u3066\u5c55\u958b\u3057\u305f\u3068\u304b\uff09\u3057\u305f\u305b\u3044\u3067\u3001\u30e1\u30e2\u30ea\u304c\u8db3\u308a\u306a\u304f\u306a\u308a\u843d\u3061\u308b\u3068\u3044\u3046\u30b1\u30fc\u30b9\u3002\n- \u3053\u306e\u5834\u5408\u306f\u3001 [OOME \u304c\u767a\u751f\u3057\u305f\u77ac\u9593\u306e\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u53d6\u5f97\u3057\u3066\u304a\u3044\u3066](#oome_heap_dump)\u3001\u539f\u56e0\u7b87\u6240\u3092\u7279\u5b9a\u3057\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u30ed\u30b8\u30c3\u30af\u3092\u4fee\u6b63\u3059\u308b\u3002\n    - \u30e1\u30e2\u30ea\u30ea\u30fc\u30af\u3057\u306a\u3044\u306e\u3067\u3042\u308c\u3070\u3001\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba\u3092\u5897\u3084\u3057\u3066\u5bfe\u5fdc\u3068\u3044\u3046\u306e\u3082\u3042\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\n\n# \u8abf\u67fb\u306b\u5229\u7528\u3067\u304d\u308b\u30c4\u30fc\u30eb\u985e\u306e\u4f7f\u3044\u65b9\n## \u9006\u5f15\u304d\n### \u30d2\u30fc\u30d7\u4f7f\u7528\u91cf\u306e\u5909\u5316\u3092\u78ba\u8a8d\u3059\u308b\n- [jconsole](#jconsole)\n- [GC \u30ed\u30b0\u3068 GC Viwer](#gcviwer)\n- [jstat](#jstat)\n- [HeapStats](#heapstats)\n- [jvisualvm](#jvisualvm)\n\n### OOME \u306e\u767a\u751f\u5834\u6240\u7279\u5b9a\u3059\u308b\n- \u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u306e\u53d6\u5f97\n    - [jcmd](#jcmd_heap_dump)\n    - [jmap](#jmap_head_dump)\n    - [OOME \u304c\u767a\u751f\u3057\u305f\u3068\u304d\u306b\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u53d6\u5f97\u3059\u308b](#oome_heap_dump)\n- [HeapStats](#heapstats)\n- [jvisualvm](#jvisualvm)\n- [Eclipse Memory Analyzer](#eclipse_memory_analyzer)\n\n\n## jcmd\nJDK7 \u304b\u3089\u306b\u4ed8\u5c5e\u3057\u3066\u3044\u308b\u30c4\u30fc\u30eb\u3002\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u304b\u3089\u5b9f\u884c\u3059\u308b\u3002\nJDK7 \u4ee5\u964d\u306a\u3089\u3001\u57fa\u672c\u306f\u3053\u306e\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3046\u3002\n\nJVM \u3092\u6307\u5b9a\u3057\u3066\u30e1\u30e2\u30ea\u6d88\u8cbb\u91cf\u306e\u591a\u3044\u3082\u306e\u9806\u306b\u30af\u30e9\u30b9\u3092\u30ea\u30b9\u30c8\u30a2\u30c3\u30d7\u3057\u305f\u308a\u3067\u304d\u308b\u3002\n\n### \u57fa\u672c\u69cb\u6587\n```text\n> jcmd <pid | main class> <command> [options]\n```\n\n```text:\u4f8b\n> jcmd 1234 GC.heap_dump heap.hprof\n```\n\n- `pid` \u307e\u305f\u306f `main class` \u306f\u5fc5\u9808\u3060\u304c\u3001\u7279\u306b\u6307\u5b9a\u3067\u304d\u308b\u30d7\u30ed\u30bb\u30b9\u304c\u7121\u3044\u306e\u3067\u3042\u308c\u3070 `0` \u3092\u6307\u5b9a\u3067\u304d\u308b\u3002\n- `0` \u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u73fe\u5728\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u5168\u3066\u306e Java \u30d7\u30ed\u30bb\u30b9\u304c\u5bfe\u8c61\u306b\u306a\u308b\u3002\n- \u53b3\u5bc6\u306b\u306f\u3001\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b JVM \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3054\u3068\u306b\u6307\u5b9a\u3067\u304d\u308b\u30b3\u30de\u30f3\u30c9\u304c\u7570\u306a\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u306e\u3067\u3001\u30d7\u30ed\u30bb\u30b9\u3054\u3068\u306b `pid` \u3092\u6307\u5b9a\u3057\u3066\u30d8\u30eb\u30d7\u3084\u5b9f\u884c\u3067\u304d\u308b\u30b3\u30de\u30f3\u30c9\u4e00\u89a7\u3092\u78ba\u8a8d\u3057\u305f\u307b\u3046\u304c\u78ba\u5b9f\u3002\n\n### \u4f7f\u7528\u3067\u304d\u308b\u30b3\u30de\u30f3\u30c9\u3092\u4e00\u89a7\u3067\u78ba\u8a8d\u3059\u308b\n```text\n> jcmd 0 help\n4136:\nThe following commands are available:\nJFR.stop\nJFR.start\nJFR.dump\nJFR.check\nVM.native_memory\nVM.check_commercial_features\nVM.unlock_commercial_features\nManagementAgent.stop\nManagementAgent.start_local\nManagementAgent.start\nGC.rotate_log\nThread.print\nGC.class_stats\nGC.class_histogram\nGC.heap_dump\nGC.run_finalization\nGC.run\nVM.uptime\nVM.flags\nVM.system_properties\nVM.command_line\nVM.version\nhelp\n\nFor more information about a specific command use 'help <command>'.\n```\n\n### \u30b3\u30de\u30f3\u30c9\u306e\u30d8\u30eb\u30d7\u3092\u78ba\u8a8d\u3059\u308b\n```text\n> jcmd 0 help GC.heap_dump\n4136:\nGC.heap_dump\nGenerate a HPROF format dump of the Java heap.\n\nImpact: High: Depends on Java heap size and content. Request a full GC unless the '-all' option is specified.\n\nPermission: java.lang.management.ManagementPermission(monitor)\n\nSyntax : GC.heap_dump [options] <filename>\n\nArguments:\n        filename :  Name of the dump file (STRING, no default value)\n\nOptions: (options must be specified using the <key> or <key>=<value> syntax)\n        -all : [optional] Dump all objects, including unreachable objects (BOOLEAN, false)\n```\n\n### \u73fe\u5728\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b Java \u30d7\u30ed\u30bb\u30b9\u3092\u8868\u793a\u3059\u308b\n```\n> jcmd -l\n4136\n12748 sun.tools.jcmd.JCmd -l\n```\n\n- `jps` \u306e\u4ee3\u308f\u308a\u306b\u3053\u3061\u3089\u3082\u3064\u304b\u3048\u308b\u3002\n\n### \u30b7\u30b9\u30c6\u30e0\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5168\u3066\u51fa\u529b\u3059\u308b\n```\n> jcmd 12636 VM.system_properties\n12636:\n#Mon Mar 07 23:51:16 JST 2016\njava.vendor=Oracle Corporation\nsun.java.launcher=SUN_STANDARD\n\uff08\u4ee5\u4e0b\u7565\uff09\n```\n\n### VM \u306e\u30d5\u30e9\u30b0\u3092\u5168\u3066\u51fa\u529b\u3059\u308b\n```\n> jcmd 12636 VM.flags\n12636:\n-XX:CICompilerCount=4 -XX:InitialHeapSize=268435456 -XX:MaxHeapSize=536870912 -XX:MaxNewSize=178782208 -XX:MinHeapDeltaBytes=524288 -XX:NewSize=89128960 -XX:OldSize=179306496 -XX:+PrintGC -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseFastUnorderedTimeStamps -XX:-UseLargePagesIndividualAllocation -XX:+UseParallelGC\n```\n\n### \u30af\u30e9\u30b9\u30fb\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u3092\u51fa\u529b\u3059\u308b\n```\n> jcmd 12636 GC.class_histogram > class_histogram.txt\n```\n\n```text:class_histogram.txt\n12636:\n\n num     #instances         #bytes  class name\n----------------------------------------------\n   1:         63670        5482832  [C\n   2:          5782        1799000  [B\n   3:         19643        1728584  java.lang.reflect.Method\n   4:         63355        1520520  java.lang.String\n   5:         11215        1253456  java.lang.Class\n   6:         36380        1164160  java.util.HashMap$Node\n   7:         13166        1138904  [Ljava.util.HashMap$Node;\n   8:         18932         757280  java.util.LinkedHashMap$Entry\n   9:         22985         735520  java.util.concurrent.ConcurrentHashMap$Node\n  10:         11475         718880  [Ljava.lang.Object;\n\uff08\u4ee5\u4e0b\u7565\uff09\n```\n\n- \u30af\u30e9\u30b9\u3054\u3068\u306b\u30e1\u30e2\u30ea\u6d88\u8cbb\u91cf\u306e\u591a\u3044\u3082\u306e\u9806\u306b\u4e00\u89a7\u3092\u8868\u793a\u3059\u308b\u3002\n    - `[C` \u3068 `[B` \u306f\u3001\u305f\u3076\u3093 `char` \u3068 `byte` \u306e\u914d\u5217\n- VM \u3078\u306e\u8ca0\u8377\u306f\u5927\u304d\u3044\u3002\n\n### <span id=\"jcmd_heap_dump\">\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u53d6\u5f97\u3059\u308b</span>\n```\n> jcmd 12636 GC.heap_dump heapdmp.hprof\n```\n\n- \u30b3\u30de\u30f3\u30c9\u306e\u5f15\u6570\u306b\u51fa\u529b\u5148\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u6307\u5b9a\u3059\u308b\u3002\n- \u76f8\u5bfe\u30d1\u30b9\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u5bfe\u8c61\u306e VM \u306e\u30ab\u30ec\u30f3\u30c8\u30d5\u30a9\u30eb\u30c0\u304c\u8d77\u70b9\u306b\u306a\u308b\u306e\u3067\u6ce8\u610f\uff08`jcmd` \u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u5834\u6240\u3067\u306f\u306a\u3044\uff09\u3002\n- VM \u3078\u306e\u8ca0\u8377\u306f\u5927\u304d\u3044\u3002\n- `jmap` \u30b3\u30de\u30f3\u30c9\u3067\u3082\u53d6\u5f97\u3067\u304d\u308b\u3051\u3069\u3001 `jcmd` \u3092\u4f7f\u3046\u65b9\u304c\u63a8\u5968\u3089\u3057\u3044\u3002\n- \u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001 Full GC \u304c\u5b9f\u884c\u3055\u308c\u305f\u3046\u3048\u3067\u30c0\u30f3\u30d7\u304c\u53d6\u5f97\u3055\u308c\u308b\u3002\n\n#### GC \u3092\u5b9f\u884c\u3055\u305b\u305a\u306b\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u53d6\u5f97\u3059\u308b\n```\n> jcmd 12636 GC.heap_dump -all heapdmp.hprof\n```\n\n- `-all` \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u308b\u3068\u3001 GC \u3092\u5b9f\u884c\u3055\u305b\u305a\u306b\u3001\u305d\u306e\u307e\u307e\u306e\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u53d6\u5f97\u3067\u304d\u308b\u3002\n\n\n### \u5168\u3066\u306e\u30b9\u30ec\u30c3\u30c9\u306e\u30b9\u30bf\u30c3\u30af\u30c8\u30ec\u30fc\u30b9\u3092\u51fa\u529b\u3059\u308b\n```\n> jcmd 12636 Thread.print > ThreadPrint.txt\n```\n\n```text:ThreadPrint.txt\n12636:\n2016-03-08 00:04:45\nFull thread dump Java HotSpot(TM) 64-Bit Server VM (25.74-b02 mixed mode):\n\n\"cached5\" #125 prio=5 os_prio=0 tid=0x0000000060209000 nid=0x2e7c waiting on condition [0x000000006610e000]\n   java.lang.Thread.State: WAITING (parking)\n\tat sun.misc.Unsafe.park(Native Method)\n\t- parking to wait for  <0x00000000e0432a40> (a java.util.concurrent.SynchronousQueue$TransferStack)\n\tat java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\n\tat java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:458)\n\tat java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)\n\uff08\u4ee5\u4e0b\u7565\uff09\n```\n\n- VM \u3078\u306e\u5f71\u97ff\u306f\u4e2d\u7a0b\u5ea6\u3002\n\n## jmap\nJDK \u306b\u4ed8\u5c5e\u3057\u3066\u3044\u308b\u30c4\u30fc\u30eb\u3002JDK 6 \u4ee5\u524d\u306e VM \u304b\u3089\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u53d6\u3063\u305f\u308a\u3057\u305f\u3044\u5834\u5408\u306f\u3053\u3061\u3089\u3092\u4f7f\u3046\u3002\n\uff08Java 7 \u4ee5\u4e0a\u306f jcmd \u3092\u4f7f\u3046\uff09\n\n### \u57fa\u672c\u69cb\u6587\n```\n> jmap [option] <pid>\n```\n\n### <span id=\"jmap_head_dump\">\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u53d6\u5f97\u3059\u308b</span>\n```\n> jmap -dump:format=b,file=my_heap_dump.hprof 5192\n```\n\n- `-dump:format=b` \u306f\u56fa\u5b9a\u3002\n- `file=<\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9>` \u3067\u3001\u30c0\u30f3\u30d7\u30d5\u30a1\u30a4\u30eb\u306e\u51fa\u529b\u5148\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n### \u30d2\u30fc\u30d7\u9818\u57df\u306e\u60c5\u5831\u3092\u51fa\u529b\u3059\u308b\n```\n> jmap -heap 5192\nAttaching to process ID 5192, please wait...\nDebugger attached successfully.\nServer compiler detected.\nJVM version is 25.74-b02\n\nusing thread-local object allocation.\nParallel GC with 8 thread(s)\n\nHeap Configuration:\n   MinHeapFreeRatio         = 0\n   MaxHeapFreeRatio         = 100\n   MaxHeapSize              = 536870912 (512.0MB)\n   NewSize                  = 89128960 (85.0MB)\n   MaxNewSize               = 178782208 (170.5MB)\n   OldSize                  = 179306496 (171.0MB)\n   NewRatio                 = 2\n   SurvivorRatio            = 8\n   MetaspaceSize            = 21807104 (20.796875MB)\n   CompressedClassSpaceSize = 1073741824 (1024.0MB)\n   MaxMetaspaceSize         = 17592186044415 MB\n   G1HeapRegionSize         = 0 (0.0MB)\n\nHeap Usage:\nPS Young Generation\nEden Space:\n   capacity = 128974848 (123.0MB)\n   used     = 18571016 (17.71070098876953MB)\n   free     = 110403832 (105.28929901123047MB)\n   14.398943893308562% used\nFrom Space:\n   capacity = 21495808 (20.5MB)\n   used     = 0 (0.0MB)\n   free     = 21495808 (20.5MB)\n   0.0% used\nTo Space:\n   capacity = 20971520 (20.0MB)\n   used     = 0 (0.0MB)\n   free     = 20971520 (20.0MB)\n   0.0% used\nPS Old Generation\n   capacity = 241172480 (230.0MB)\n   used     = 26622312 (25.389015197753906MB)\n   free     = 214550168 (204.6109848022461MB)\n   11.038702259893002% used\n\n21472 interned Strings occupying 1915464 bytes.\n```\n\n### \u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u3092\u51fa\u529b\u3059\u308b\n```\n> jmap -histo 5192 > histogram.txt\n```\n\n```text:histogram.txt\n num     #instances         #bytes  class name\n----------------------------------------------\n   1:         11178       17514456  [I\n   2:         71332        6582488  [C\n   3:          6461        2612328  [B\n   4:         19673        1731224  java.lang.reflect.Method\n   5:         67223        1613352  java.lang.String\n   6:         11220        1254040  java.lang.Class\n   7:         36592        1170944  java.util.HashMap$Node\n   8:         13409        1154280  [Ljava.util.HashMap$Node;\n   9:         17503         980168  java.util.concurrent.ConcurrentHashMap$ValueIterator\n  10:         13625         841032  [Ljava.lang.Object;\n  11:         18958         758320  java.util.LinkedHashMap$Entry\n  12:         22981         735392  java.util.concurrent.ConcurrentHashMap$Node\n  13:         13674         656352  java.util.HashMap\n  14:         10003         560168  java.util.LinkedHashMap\n  15:         28543         456688  java.lang.Object\n  16:          6327         455544  java.lang.reflect.Field\n\uff08\u4ee5\u4e0b\u7565\uff09\n```\n\n## jstat\nJDK \u306b\u4ed8\u5c5e\u3057\u3066\u3044\u308b\u30b3\u30de\u30f3\u30c9\u30c4\u30fc\u30eb\u3002\nJVM \u306e\u7d71\u8a08\u60c5\u5831\u3092\u30e2\u30cb\u30bf\u30fc\u3067\u304d\u308b\u3002\u8a66\u9a13\u7684\u306a\u3082\u306e\u3067\u3001\u30b5\u30dd\u30fc\u30c8\u5bfe\u8c61\u5916\u3089\u3057\u3044\u3002\n\n### \u57fa\u672c\n```text:\u69cb\u6587\uff08\u7c21\u6613\u7248\uff09\n> jstat <startOption> <pid> [interval[s|ms]] [count]\n```\n\n```text:\u4f8b\n> jstat -gc 1776\n S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT\n19456.0 21504.0 17170.9  0.0   131584.0 52202.1   182784.0   20159.6   49792.0 48738.2 6528.0 6377.2      6    0.079   2      0.118    0.197\n```\n\n- \u76e3\u8996\u3057\u305f\u3044\u5185\u5bb9\u3054\u3068\u306b `startOption` \u3092\u5207\u308a\u66ff\u3048\u308b\u3002\n- `pid` \u306f\u3001\u5bfe\u8c61\u306e JVM \u306e\u30d7\u30ed\u30bb\u30b9ID\u3002\n\n### \u4e00\u5b9a\u9593\u9694\u3067\u51fa\u529b\u3059\u308b\n```\n> jstat -class 32024 1s\nLoaded  Bytes  Unloaded  Bytes     Time\n 10613 18500.1        0     0.0       5.03\n 10613 18500.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n\uff08\u4ee5\u4e0b\u6c38\u9060\u306b\u7d9a\u304f\uff09\n```\n\n- `pid` \u306e\u5f8c\u308d\u306b `1s` \u3068\u304b `100ms` \u3068\u304b\u66f8\u304f\u3068\u3001\u305d\u306e\u9593\u9694\u3067\u7e70\u308a\u8fd4\u3057\u60c5\u5831\u3092\u51fa\u529b\u3067\u304d\u308b\u3002\n- \u6642\u9593\u306e\u5358\u4f4d\uff08`s` or `ms`\uff09\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u30df\u30ea\u79d2\u6271\u3044\u306b\u306a\u308b\u3002\n\n### \u6307\u5b9a\u56de\u6570\u51fa\u529b\u3057\u305f\u3089\u7d42\u4e86\u3059\u308b\n```\n> jstat -class 32024 1s 3\nLoaded  Bytes  Unloaded  Bytes     Time\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n\n>\n```\n\n- `interval` \u306e\u5f8c\u308d\u306b\u6570\u5024\u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u305d\u306e\u6570\u3060\u3051\u51fa\u529b\u3057\u305f\u3089\u76e3\u8996\u3092\u7d42\u4e86\u3055\u305b\u3089\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n- \u30c7\u30d5\u30a9\u30eb\u30c8\u306f\u7121\u9650\u3001\u3064\u307e\u308a\u6c38\u9060\u306b\u76e3\u8996\u3092\u7d9a\u3051\u308b\u3002\n\n### \u6307\u5b9a\u56de\u6570\u3054\u3068\u306b\u30d8\u30c3\u30c0\u30fc\u3092\u518d\u8868\u793a\u3059\u308b\n```\n> jstat -class -h5 32024 1s\nLoaded  Bytes  Unloaded  Bytes     Time\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\nLoaded  Bytes  Unloaded  Bytes     Time\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n 10614 18501.1        0     0.0       5.03\n\uff08\u7701\u7565\uff09\n```\n\n- `startOption` \u3068 `pid` \u306e\u9593\u306b `-h<\u8868\u793a\u9593\u9694>` \u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u6307\u5b9a\u3057\u305f\u8868\u793a\u9593\u9694\u3054\u3068\u306b\u30d8\u30c3\u30c0\u30fc\u304c\u518d\u8868\u793a\u3055\u308c\u308b\u3002\n\n\n### \u5404 startOption\n\u3044\u304f\u3064\u304b\u306e\u7a2e\u985e\u304c\u3042\u308b\u304c\u3001\u51fa\u529b\u5185\u5bb9\u304c\u91cd\u8907\u3057\u3066\u3044\u308b\u3082\u306e\u3082\u3042\u308a\u3001\u3069\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u4f55\u3092\u51fa\u529b\u3059\u308b\u306e\u304b\u304c\u308f\u304b\u308a\u3065\u3089\u3044\u3002\n\u306a\u306e\u3067\u3001\u8868\u306b\u307e\u3068\u3081\u305f\u3002\n\n\u8868\u306b\u306a\u3044\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u3064\u3044\u3066\u306f [\u516c\u5f0f\u306e help](https://docs.oracle.com/javase/jp/8/docs/technotes/tools/windows/jstat.html#BEHIGDGJ) \u3092\u53c2\u7167\u3002\n\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/065db81e-8295-9022-0e13-901a4f1f8b4a.jpeg)\n\n\u81ea\u5206\u304c\u78ba\u8a8d\u3057\u305f\u3044\u60c5\u5831\u3092\u6c7a\u3081\u3066\u3001\u305d\u308c\u3092\u51fa\u529b\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u9078\u629e\u3059\u308c\u3070\u3044\u3044\u3068\u601d\u3046\u3002\n\n## jvisualvm\nJVM \u306e\u72b6\u614b\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b GUI \u3067\u5206\u6790\uff08\u30d7\u30ed\u30d5\u30a1\u30a4\u30ea\u30f3\u30b0\uff09\u3059\u308b\u305f\u3081\u306e\u30c4\u30fc\u30eb\u3002\nJDK \u306b\u4ed8\u5c5e\u3057\u3066\u3044\u308b\u3002\n\n\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067 `jvisualvm` \u3068\u5165\u529b\u3059\u308c\u3070\u5b9f\u884c\u3067\u304d\u308b\uff08\u30d1\u30b9\u304c\u901a\u3063\u3066\u3044\u308c\u3070\uff09\u3002\n\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/cbc0b866-9570-9845-f1dd-174a26c7f866.jpeg)\n\n\u5de6\u306e\u300c\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u300d\u306b\u3001\u73fe\u5728\u30ed\u30fc\u30ab\u30eb\u3067\u8d77\u52d5\u3057\u3066\u3044\u308b JVM \u304c\u4e00\u89a7\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u3002\n\u8abf\u67fb\u3057\u305f\u3044 JVM \u3092\u30c0\u30d6\u30eb\u30af\u30ea\u30c3\u30af\u3057\u3066\u958b\u304f\u3068\u3001\u305d\u306e JVM \u306b\u63a5\u7d9a\u3057\u3066\u8abf\u67fb\u3092\u958b\u59cb\u3067\u304d\u308b\u3002\n\n\u30bf\u30d6\u3054\u3068\u306b\u3001\u8272\u3005\u306a\u60c5\u5831\u304c\u898b\u308c\u308b\u3002\n\n\u30bf\u30d6\u540d | \u5185\u5bb9\n---|---\n\u6982\u8981 | \u5bfe\u8c61\u306e JVM \u306e\u57fa\u672c\u7684\u306a\u60c5\u5831\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\u76e3\u8996 | CPU \u5229\u7528\u72b6\u6cc1\u30fb\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u30fb\u30af\u30e9\u30b9\u30ed\u30fc\u30c9\u6570\u30fb\u30b9\u30ec\u30c3\u30c9\u306e\u72b6\u6cc1\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\u30b9\u30ec\u30c3\u30c9 | \u5404\u30b9\u30ec\u30c3\u30c9\u306e\u72b6\u614b\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\u30b5\u30f3\u30d7\u30e9\u30fb\u30d7\u30ed\u30d5\u30a1\u30a4\u30e9 | CPU \u4f7f\u7528\u7387\u3068\u30e1\u30e2\u30ea\u4f7f\u7528\u7387\u306e\u8a73\u7d30\u306a\u60c5\u5831\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n### \u30b5\u30f3\u30d7\u30e9\u3068\u30d7\u30ed\u30d5\u30a1\u30a4\u30e9\u306e\u9055\u3044\n\u30b5\u30f3\u30d7\u30e9\u306f\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3078\u306e\u5f71\u97ff\u304c\u5c0f\u3055\u3044\u304c\u3001\u60c5\u5831\u304c\u6f0f\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30e9\u306f\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3078\u306e\u5f71\u97ff\u304c\u5927\u304d\u3044\u304c\u3001\u60c5\u5831\u306b\u6f0f\u308c\u304c\u306a\u3044\u3002\n\n\u30b5\u30f3\u30d7\u30e9\u306f\u3001\u5b9a\u671f\u7684\u306b JVM \u304b\u3089\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066\u7d50\u679c\u3092\u51fa\u529b\u3059\u308b\u3002\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30e9\u306f\u3001\u76e3\u8996\u60c5\u5831\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b\u9001\u4fe1\u3059\u308b\u3088\u3046\u306b\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30d0\u30a4\u30c8\u30b3\u30fc\u30c9\u3092\u66f8\u304d\u5909\u3048\u308b\u3002\n\n\u30b5\u30f3\u30d7\u30e9\u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u5bfe\u3059\u308b\u5f71\u97ff\u304c\u5c0f\u3055\u304f\u6bd4\u8f03\u7684\u9ad8\u901f\u306b\u52d5\u4f5c\u3059\u308b\u304c\u3001\u60c5\u5831\u3092\u53d6\u5f97\u3057\u305f\u77ac\u9593\u306e\u60c5\u5831\u3057\u304b\u53d6\u308c\u306a\u3044\u3002\n\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066\u3044\u306a\u3044\u6642\u9593\u306b\u3001\u305f\u307e\u305f\u307e\u30db\u30c3\u30c8\u30b9\u30dd\u30c3\u30c8\u3068\u306a\u308b\u90e8\u5206\u304c\u5b9f\u884c\u3055\u308c\u3066\u3044\u305f\u308a\u3059\u308b\u3068\u3001\u305d\u306e\u5206\u306e\u60c5\u5831\u304c\u6f0f\u308c\u308b\u3053\u3068\u306b\u306a\u308b\u3002\n\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30e9\u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30d0\u30a4\u30c8\u30b3\u30fc\u30c9\u3092\u3044\u3058\u308b\u305f\u3081\u5f71\u97ff\u3092\u4e0e\u3048\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u3001\u304b\u3064\u52d5\u4f5c\u306b\u6642\u9593\u3082\u304b\u304b\u308b\u3002\n\u3057\u304b\u3057\u3001\u968f\u6642\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089\u60c5\u5831\u304c\u9023\u643a\u3055\u308c\u308b\u306e\u3067\u30b5\u30f3\u30d7\u30e9\u3068\u6bd4\u8f03\u3057\u3066\u60c5\u5831\u306b\u6f0f\u308c\u304c\u306a\u3044\u3002\n\n\u305f\u3076\u3093\u3001\u305d\u3093\u306a\u9055\u3044\u304c\u3042\u308b\u3063\u307d\u3044\u3002\n\n[Java \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9][3] \u306e\u300c3.3 \u30d7\u30ed\u30d5\u30a1\u30a4\u30ea\u30f3\u30b0\u30c4\u30fc\u30eb\u300d\u306b\u3001\u305d\u306e\u3078\u3093\u306e\u8a73\u7d30\u306a\u8aac\u660e\u304c\u8f09\u3063\u3066\u3044\u308b\u3002\n\n\n### \u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u53d6\u5f97\u3057\u3066\u5185\u5bb9\u3092\u78ba\u8a8d\u3059\u308b\n- \u300c\u76e3\u8996\u300d\u30bf\u30d6\u3092\u958b\u304d\u3001\u300c\u30d2\u30fc\u30d7\u300d\u30c0\u30f3\u30d7\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u304c\u53d6\u5f97\u3067\u304d\u308b\u3002\n- \u305f\u3060\u3057\u3001\u3053\u3053\u3067\u53d6\u5f97\u3067\u304d\u308b\u30c0\u30f3\u30d7\u306f GC \u5f8c\u306e\u60c5\u5831\u306b\u306a\u308b\u3063\u307d\u3044\u3002\n    - GC \u3055\u305b\u305a\u306b\u53d6\u5f97\u3057\u305f\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u898b\u305f\u3044\u5834\u5408\u306f\u3001\u5225\u9014 `jcmd` \u306a\u3069\u3067\u53d6\u5f97\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u300c\u30d5\u30a1\u30a4\u30eb\u300d\u2192\u300c\u8aad\u307f\u8fbc\u307f\u300d\u3067\u958b\u304f\u3002\n\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/3555e87b-b8e1-5051-7afe-15d670233f35.jpeg)\n\n- \u30af\u30e9\u30b9\u3054\u3068\u306e\u30e1\u30e2\u30ea\u6d88\u8cbb\u91cf\u306e\u4e00\u89a7\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n- \u30af\u30e9\u30b9\u3092\u30c0\u30d6\u30eb\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001\u305d\u306e\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4e00\u89a7\u3068\u53c2\u7167\u5143\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/2da00f35-98bb-6ca6-0ec7-973c26e730ab.jpeg)\n\n- \u5de6\u306e\u300c\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u300d\u306b\u3001\u9078\u629e\u3057\u305f\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u4e00\u89a7\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u3002\n- \u8a73\u7d30\u3092\u78ba\u8a8d\u3057\u305f\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u9078\u629e\u3059\u308b\u3068\u3001\u53f3\u306e\u300c\u30d5\u30a3\u30fc\u30eb\u30c9\u300d\u3068\u300c\u53c2\u7167\u300d\u306b\u8a73\u7d30\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n- \u300c\u30d5\u30a3\u30fc\u30eb\u30c9\u300d\u306b\u306f\u3001\u305d\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u6301\u3064\u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u60c5\u5831\u304c\u3001\n- \u300c\u53c2\u7167\u300d\u306b\u306f\u3001\u305d\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53c2\u7167\u3057\u3066\u3044\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u4e00\u89a7\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\n## jconsole\nJVM \u306e\u8a73\u7d30\u306a\u30e1\u30e2\u30ea\u72b6\u6cc1\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u78ba\u8a8d\u3067\u304d\u308b GUI \u30c4\u30fc\u30eb\u3002\nJDK \u306b\u4ed8\u5c5e\u3057\u3066\u3044\u308b\u3002\n\n\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067 `jconsole` \u3068\u5165\u529b\u3059\u308c\u3070\u5b9f\u884c\u3067\u304d\u308b\uff08\u30d1\u30b9\u304c\u901a\u3063\u3066\u3044\u308c\u3070\uff09\u3002\n\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/091cb5cd-1014-a0d7-47cf-697e32924055.jpeg)\n\n\u8d77\u52d5\u3057\u305f\u3089\u3001\u73fe\u5728\u30ed\u30fc\u30ab\u30eb\u3067\u8d77\u52d5\u3057\u3066\u3044\u308b JVM \u306e\u4e00\u89a7\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\u63a5\u7d9a\u3057\u305f\u3044\u30d7\u30ed\u30bb\u30b9\u3092\u9078\u629e\u3057\u3066\u3001\u300c\u63a5\u7d9a\u300d\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3002\n\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/b45bfe5b-396d-baff-3bf1-6bcd3eba1cfb.jpeg)\n\n- \u4f7f\u3044\u65b9\u306f\u3001\u307e\u3041\u3001\u898b\u305f\u307e\u3093\u307e\u3002\n- \u30e1\u30e2\u30ea\u4f7f\u7528\u7387\u3001\u30b9\u30ec\u30c3\u30c9\u6570\u3001\u30ed\u30fc\u30c9\u3055\u308c\u305f\u30af\u30e9\u30b9\u6570\u3001 CPU \u4f7f\u7528\u7387\u304c\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306a\u30b0\u30e9\u30d5\u3067\u8868\u793a\u3055\u308c\u308b\u3002\n- \u30bf\u30d6\u3092\u5207\u308a\u66ff\u3048\u308c\u3070\u3001\u305d\u308c\u305e\u308c\u306e\u8a73\u7d30\u60c5\u5831\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/4dbd2ec3-e0ba-23da-e8a6-6909a1268669.jpeg)\n\n- \u300c\u30e1\u30e2\u30ea\u30fc\u300d\u30bf\u30d6\u3092\u958b\u3051\u3070\u3001\u30e1\u30e2\u30ea\u306e\u8a73\u7d30\u306a\u60c5\u5831\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n- \u300c\u30c1\u30e3\u30fc\u30c8\u300d\u3067\u3001\u8868\u793a\u3059\u308b\u30e1\u30e2\u30ea\u9818\u57df\u306e\u7a2e\u5225\u3092\u9078\u629e\u3067\u304d\u308b\u3002\n    - \u53f3\u4e0b\u306e\u300c\u30d2\u30fc\u30d7\u300d\u300c\u975e\u30d2\u30fc\u30d7\u300d\u3068\u66f8\u3044\u3066\u3044\u308b\u7dd1\u306e\u3068\u3053\u308d\u3067\u3082\u3001\u8868\u793a\u3059\u308b\u9818\u57df\u3092\u9078\u629e\u3067\u304d\u308b\u3002\n\n## <span id=\"eclipse_memory_analyzer\">Eclipse Memory Analyzer Tool</span>\n[Eclipse Memory Analyzer Open Source Project](http://www.eclipse.org/mat/)\n\n- \u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u306e\u5185\u5bb9\u3092\u8abf\u67fb\u3059\u308b\u305f\u3081\u306e GUI \u30c4\u30fc\u30eb\u3002\n- mat \u3068\u7565\u3055\u308c\u305f\u308a\u3059\u308b\u3002\n- Eclipse \u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u308b\u3002\n- Eclipse \u7121\u3057\u3067\u3001\u5358\u72ec\u3067\u52d5\u304b\u3059\u3053\u3068\u3082\u53ef\u80fd\u3002\n- \u4eca\u56de\u306f\u3001\u5358\u72ec\u3067\u52d5\u304b\u3057\u305f\u5834\u5408\u306e\u4f7f\u3044\u65b9\u3092\u30e1\u30e2\u3059\u308b\u3002\n\n### \u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u958b\u304f\n- [File] \u2192 [Open Heap Dump]\n- \u958b\u304d\u305f\u3044\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u9078\u629e\u3059\u308b\u3002\n\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/2aec74fd-0039-08fe-7dbd-7b8e9e75609f.jpeg)\n\n- OOME \u306e\u8abf\u67fb\u306e\u5834\u5408\u306f\u3001\u3068\u308a\u3042\u3048\u305a\u4e00\u756a\u4e0a\u3092\u9078\u3079\u3070\u826f\u3044\u3002\n    - \u30e1\u30e2\u30ea\u30ea\u30fc\u30af\u306e\u539f\u56e0\u3068\u601d\u308f\u308c\u308b\u7b87\u6240\u3092\u5206\u6790\u3057\u3066\u30ec\u30dd\u30fc\u30c8\u3092\u751f\u6210\u3057\u3066\u304f\u308c\u308b\u3002\n\n### Leak Suspects Report\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/c1d56c5c-8ce5-e4e5-d21f-4bdaf3a17c9d.jpeg)\n\n- \u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u89e3\u6790\u3057\u305f\u7d50\u679c\u3001\u30e1\u30e2\u30ea\u30ea\u30fc\u30af\u304c\u7591\u308f\u308c\u308b\u7b87\u6240\u304c\u5186\u30b0\u30e9\u30d5\u3067\u8868\u793a\u3055\u308c\u308b\u3002\n- \u4e0b\u306e\u300cProblem Suspect 1\u300d\u306b\u306f\u3001 `ConcurrentHashMap` \u304c\u5168\u4f53\u306e `95.03%` \u3092\u5360\u3081\u3066\u3044\u308b\u3068\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u3002\n- \u300cDetails\u300d\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001\u8a73\u7d30\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/a62b810b-dd25-3c5a-427e-80d515e4eb99.jpeg)\n\n- \u91cd\u305f\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\uff08`CuncurrentHashMap`\uff09\u3092\u53c2\u7167\u3057\u3066\u3044\u308b\u4ed6\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u30c4\u30ea\u30fc\u69cb\u9020\u3067\u8868\u793a\u3057\u3066\u3044\u308b\u3002\n\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/792ee1f7-e68f-cde6-cb8b-95cc8c731fa2.jpeg)\n\n- \u91cd\u305f\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\uff08`CuncurrentHashMap`\uff09\u306e\u4e2d\u8eab\u3092\u30c4\u30ea\u30fc\u69cb\u9020\u3067\u8868\u793a\u3057\u3066\u3044\u308b\u3002\n\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/d25812c4-9966-312f-142c-02c19cea7d82.jpeg)\n\n- \u30af\u30e9\u30b9\u5225\u306b\u3001\u30e1\u30e2\u30ea\u6d88\u8cbb\u91cf\u306e\u591a\u3044\u3082\u306e\u3092\u8868\u793a\u3057\u3066\u3044\u308b\u3002\n\n\u3068\u308a\u3042\u3048\u305a\u3001\u4e00\u756a\u91cd\u3044\u3089\u3057\u3044 `ConcurrentHashMap` \u3092\u30af\u30ea\u30c3\u30af\u3057\u3066 [List Objects] \u2192 [with outcoming references] \u3092\u9078\u629e\u3059\u308b\u3002\n\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/16cf78cd-da71-9127-f186-cd521d19aa04.jpeg)\n\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/1f0530e0-adb8-cb01-e16e-2b4a1e0491bf.jpeg)\n\n- \u6307\u5b9a\u3057\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3068\u3001\u305d\u306e\u4e2d\u8eab\u304c\u30c4\u30ea\u30fc\u3067\u8868\u793a\u3055\u308c\u308b\u3002\n- \u300cShallow Heap\u300d\u304c\u3001\u305d\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5358\u72ec\u3067\u306e\u30b5\u30a4\u30ba\u3092\u8868\u3057\u3066\u3044\u308b\u3002\n- \u300cRetained Heap\u300d\u304c\u3001\u305d\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u6301\u3064\u4ed6\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u542b\u3081\u305f\u30b5\u30a4\u30ba\u3092\u8868\u3057\u3066\u3044\u308b\u3002\n- \u3068\u308a\u3042\u3048\u305a\u3001\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3044\u30e4\u30c4\u3092\u6398\u3063\u3066\u3044\u3063\u3066\u307f\u308b\u3002\n\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/d7c83f46-cc3e-1f6f-6b9f-8cfb1f5bd80a.jpeg)\n\n- \u6700\u7d42\u7684\u306b\u3001`BigObject` \u3068\u304b\u3044\u3046\u30af\u30e9\u30b9\u304c\u5de8\u5927\u306a `byte` \u306e\u4e09\u6b21\u5143\u914d\u5217\u3092\u6301\u3063\u3066\u3044\u308b\u3068\u3053\u308d\u307e\u3067\u8fbf\u308a\u7740\u3044\u305f\u3002\n- \u3053\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u3001\u5b9f\u969b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n```java:MyResource.java\npackage sample.oome;\n\nimport java.io.Serializable;\n\nimport javax.enterprise.context.SessionScoped;\nimport javax.ws.rs.GET;\nimport javax.ws.rs.Path;\nimport javax.ws.rs.QueryParam;\n\n@Path(\"\")\n@SessionScoped\npublic class MyResource implements Serializable {\n    private static final long serialVersionUID = 1L;\n    \n    private BigObject bigObject;\n    \n    @GET\n    public void execute(@QueryParam(\"size\") int size) {\n        this.bigObject = new BigObject(size);\n        System.out.println(\"done (\" + size + \")\");\n    }\n    \n    public static class BigObject {\n        public byte[][][] data;\n        \n        public BigObject(int size) {\n            this.data = new byte[1024][1024][size];\n        }\n    }\n}\n```\n\n- \u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30b3\u30fc\u30d7\u306e\u30ea\u30bd\u30fc\u30b9\u30af\u30e9\u30b9\u306b\u3001\u5de8\u5927\u306a\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\uff08`BigObject`\uff09\u3092\u4fdd\u5b58\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n- \u3053\u308c\u304c\u6e9c\u307e\u308a\u6e9c\u307e\u3063\u3066 OOME \u306b\u306a\u3063\u3066\u3044\u305f\u3002\n- Memory Analyzer \u3092\u4f7f\u3048\u3070\u3001\u3053\u3093\u306a\u611f\u3058\u3067 OOME \u306e\u539f\u56e0\u7b87\u6240\u3092\u8abf\u67fb\u3067\u304d\u308b\u3002\n\n## GC Viewer\nGC \u30ed\u30b0\u3092\u30b0\u30e9\u30d5\u3067\u8868\u793a\u3059\u308b\u30c4\u30fc\u30eb\u3002\n\n[\u8a73\u3057\u304f\u306f\u3053\u3061\u3089](#gcviwer)\u3002\n\n## <span id=\"heapstats\">HeapStats</span>\n- NTT \u306e OSS \u30bb\u30f3\u30bf\u304c\u958b\u767a\u3057\u305f JVM \u306e\u72b6\u614b\u3092\u76e3\u8996\u3059\u308b\u30c4\u30fc\u30eb\u3002\n- OSS\uff08GPL v2\uff09\u3002\n- \u5e73\u5e38\u6642\u304b\u3089 JVM \u3092\u76e3\u8996\u3057\u3066\u60c5\u5831\u3092\u53ce\u96c6\u3059\u308b\u3053\u3068\u3067\u3001\u7570\u5e38\u3092\u4e8b\u524d\u306b\u691c\u77e5\u3057\u3066\u30a2\u30e9\u30fc\u30c8\u3092\u4e0a\u3052\u305f\u308a\u3001\u969c\u5bb3\u767a\u751f\u6642\u306e\u60c5\u5831\u306e\u53ce\u96c6\u3092\u7701\u529b\u5316\u3057\u305f\u308a\u3067\u304d\u308b\u3002\n\n### \u52d5\u4f5c\u78ba\u8a8d\u3057\u305f\u3068\u304d\u306e\u74b0\u5883\n- \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u52d5\u304b\u3059\u74b0\u5883\n    - CentOS 6.3 (VMware)\n    - Java 1.8.0_65 (Oracle JDK)\n- \u30a2\u30ca\u30e9\u30a4\u30b6\u3092\u52d5\u304b\u3059\u74b0\u5883\n    - Windows 7\n    - Java 1.8.0_74\n\n### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n#### \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n- [\u3053\u3061\u3089\u306b\u3042\u308b\u30ea\u30f3\u30af](http://icedtea.classpath.org/wiki/HeapStats/jp#.E3.83.80.E3.82.A6.E3.83.B3.E3.83.AD.E3.83.BC.E3.83.89) \u304b\u3089\u3001 rpm \u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304f\u308b\u3002\n- CentOS 6 \u306f RHEL6 \u76f8\u5f53\u306a\u306e\u3067\u3001 `heapstats-2.0.1-0.el6.x86_64.rpm` \u3092\u843d\u3068\u3059\u3053\u3068\u306b\u3057\u305f\u3002\n- \u4eca\u56de\u306f Oracle \u306e Java \u3092\u5165\u308c\u3066\u3044\u305f\u304c\u3001 OpenJDK \u306e\u5834\u5408\u306f [debuginfo](http://icedtea.classpath.org/wiki/HeapStats/jp/%E3%82%A8%E3%83%BC%E3%82%B8%E3%82%A7%E3%83%B3%E3%83%88#RPM.E3.83.91.E3.83.83.E3.82.B1.E3.83.BC.E3.82.B8.E3.82.92.E3.82.A4.E3.83.B3.E3.82.B9.E3.83.88.E3.83.BC.E3.83.AB.E3.81.99.E3.82.8B) \u3068\u304b\u3044\u3046\u306e\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3089\u3057\u3044\n\n```bash\n# rpm \u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n$ wget http://icedtea.wildebeest.org/download/heapstats/heapstats-2.0.1/bin/agent/el6/x86_64/heapstats-2.0.1-0.el6.x86_64.rpm\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo rpm -ivh heapstats-2.0.1-0.el6.x86_64.rpm\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\n$ java -agentlib:heapstats -version\nheapstats INFO: HeapStats 2.0.1\nheapstats INFO: Supported processor features: AVX\nheapstats INFO: Agent Attach Enable = true\n\uff08\u7565\uff09\nheapstats INFO: Kill on Error = false\njava version \"1.8.0_65\"\nJava(TM) SE Runtime Environment (build 1.8.0_65-b17)\nJava HotSpot(TM) 64-Bit Server VM (build 25.65-b01, mixed mode)\n```\n\n### \u8d77\u52d5\n```bash\n# HeapStats \u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u5dee\u3057\u8fbc\u3093\u3067 Java \u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u8d77\u52d5\u3059\u308b\n$ java -agentpath:/usr/lib64/heapstats/libheapstats.so \uff08\u7565\uff09\nheapstats INFO: HeapStats 2.0.1\nheapstats INFO: Supported processor features: AVX\nheapstats INFO: Agent Attach Enable = true\nheapstats INFO: SnapShot FileName = heapstats_snapshot.dat\nheapstats INFO: Heap Log FileName = heapstats_log.csv\nheapstats INFO: Archive FileName = heapstats_analyze.zip\n\uff08\u7565\uff09\n```\n\n- `-agentpath` \u3067 HeapStats \u306e `so` \u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3059\u308b\u3002\n    - \u74b0\u5883\u5909\u6570\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u65b9\u6cd5\u306a\u3069\u3082\u5b58\u5728\u3059\u308b\uff08[1.3 \u8d77\u52d5 | HeapStats \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8](http://icedtea.classpath.org/wiki/HeapStats/jp/%E3%82%A8%E3%83%BC%E3%82%B8%E3%82%A7%E3%83%B3%E3%83%88#.E8.B5.B7.E5.8B.95)\uff09\u3002\n- \u8d77\u52d5\u3059\u308b\u3068\u3001\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u51fa\u529b\u3055\u308c\u308b\u3002\n    - `heapstats_snapshot.dat`\n        - Full GC \u304c\u767a\u751f\u3057\u305f\u3068\u304d\u306a\u3069\u306e\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u304c\u4fdd\u5b58\u3055\u308c\u308b\u30d5\u30a1\u30a4\u30eb\u3002\n    - `heapstats_log.csv`\n        - \u30d2\u30fc\u30d7\u3084 CPU \u306a\u3069\u306e\u7c21\u6613\u306a\u60c5\u5831\u3092\u51fa\u529b\u3057\u305f\u30ed\u30b0\u3002\n- \u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\uff15\u5206\u9593\u9694\u3067\u51fa\u529b\u3055\u308c\u308b\u3002\n    - OOME \u304c\u767a\u751f\u3057\u305f\u5834\u5408\u3084\u3001\u30e6\u30fc\u30b6\u30fc\u304c\u660e\u793a\u7684\u306b\u51fa\u529b\u3092\u6307\u793a\u3057\u305f\u5834\u5408\u306b\u3082\u51fa\u529b\u3055\u308c\u308b\u3002\n- \u30d5\u30a1\u30a4\u30eb\u306e\u540d\u524d\u3084\u5834\u6240\u3001\u305d\u306e\u4ed6\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306b\u95a2\u3059\u308b\u69d8\u3005\u306a\u6319\u52d5\u306f\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u4efb\u610f\u306b\u5909\u66f4\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n    - \u8a73\u3057\u304f\u306f [HeapStats/jp/\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8](http://icedtea.classpath.org/wiki/HeapStats/jp/%E3%82%A8%E3%83%BC%E3%82%B8%E3%82%A7%E3%83%B3%E3%83%88) \u3092\u53c2\u7167\u3002\n\n### \u30a2\u30ca\u30e9\u30a4\u30b6\u3067\u78ba\u8a8d\u3059\u308b\n- \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u53ce\u96c6\u3057\u305f\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3084\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306f\u3001\u30a2\u30ca\u30e9\u30a4\u30b6\u3068\u547c\u3070\u308c\u308b GUI \u30c4\u30fc\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u308b\u3002\n- \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u843d\u3068\u3057\u3066\u304d\u305f\u5834\u6240\u306b\u3001\u30a2\u30ca\u30e9\u30a4\u30b6\u3082\u7f6e\u3044\u3066\u3042\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u843d\u3068\u3057\u3066\u304f\u308b\uff08`heapstats-analyzer-2.0.1-bin.zip`\uff09\u3002\n- \u89e3\u51cd\u3057\u305f\u3089\u3001\u4e2d\u306b `heapstats-analyzer.jar` \u304c\u5165\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u30c0\u30d6\u30eb\u30af\u30ea\u30c3\u30af\u3067\u8d77\u52d5\u3059\u308b\u3002\n\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/6404ce1d-b6ce-ac02-1e66-a58ab50c427a.jpeg)\n\n- [Log Data] \u30bf\u30d6\u3067\u3001\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n    - [Log File] \u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u958b\u304f\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u9078\u629e\u3059\u308b\u3002\n    - [Range] \u3067\u3001\u78ba\u8a8d\u3057\u305f\u3044\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u671f\u9593\u3092\u9078\u629e\u3059\u308b\u3002\n    - [OK] \u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001\u30ed\u30b0\u306e\u5185\u5bb9\u304c\u30b0\u30e9\u30d5\u306b\u306a\u3063\u3066\u8868\u793a\u3055\u308c\u308b\u3002\n\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/fa462f7d-8b20-d335-4f40-f803b2864bf2.jpeg)\n\n- [SnapShot Data] \u30bf\u30d6\u3067\u3001\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n    - [Log File] \u306e\u5834\u5408\u3068\u540c\u3058\u8981\u9818\u3067\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304f\u3002\n\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/3bde136f-d667-2b9c-f5b2-e651c6bafbc6.jpeg)\n\n- [Histogram] \u30bf\u30d6\u3084 [SnapShot Data]\u30bf\u30d6\u3067\u3001\u30af\u30e9\u30b9\u3054\u3068\u306e\u30d2\u30fc\u30d7\u5360\u6709\u7387\u306a\u3069\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n- \u307e\u305f\u3001 [SnapShot Data] \u30bf\u30d6\u3067\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u9078\u629e\u3057\u305f\u72b6\u614b\u3067 [Reference Tree] \u3092\u9078\u629e\u3059\u308c\u3070\u3001\u305d\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u53c2\u7167\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u95a2\u9023\u3092\u30b0\u30e9\u30d5\u30a3\u30ab\u30eb\u306b\u8fbf\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/f79e1d31-affc-8fcd-93c0-694c591a370c.jpeg)\n\n- \u8a73\u3057\u3044\u4f7f\u3044\u65b9\u306f [\u65e5\u672c\u8a9e\u306e\u30de\u30cb\u30e5\u30a2\u30eb](http://icedtea.classpath.org/wiki/HeapStats/jp/%E3%82%A2%E3%83%8A%E3%83%A9%E3%82%A4%E3%82%B6) \u304c\u3042\u308b\u306e\u3067\u3001\u305d\u3061\u3089\u3092\u53c2\u7167\u3002\n\n\n\n# JVM \u306e\u30aa\u30d7\u30b7\u30e7\u30f3\n## GC \u306e\u60c5\u5831\u3092\u51fa\u529b\u3059\u308b\n### \u57fa\u672c\n```\njava -verbose:gc \uff08\u7565\uff09\n```\n\n```\nGC (Allocation Failure)\n305284K->307692K(450048K), 0.0386887 secs]\n\nGC (Allocation Failure)\n366572K->369612K(450048K), 0.0429775 secs]\n\nFull GC (Ergonomics)\n369612K->357147K(466432K), 0.1287979 secs]\n```\n\n- \u8d77\u52d5\u6642\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306b `-verbose:gc` \u3068\u6307\u5b9a\u3059\u308b\u3068\u3001 GC \u304c\u8d77\u3053\u3063\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u6a19\u6e96\u51fa\u529b\u306b GC \u306e\u60c5\u5831\u304c\u51fa\u529b\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n- `GC` \u3068\u3060\u3051\u51fa\u3066\u3044\u308b\u306e\u306f\u3001 Full GC \u4ee5\u5916\u306e GC \u304c\u767a\u751f\u3057\u305f\u3053\u3068\u3092\u8868\u3057\u3066\u3044\u308b\uff08Young \u9818\u57df\u306e GC \u3068\u304b\uff09\u3002\n- `Full GC` \u3068\u51fa\u3066\u3044\u308b\u306e\u306f\u3001\u305d\u306e\u3082\u306e\u305a\u3070\u308a Full GC \u304c\u767a\u751f\u3057\u305f\u3053\u3068\u3092\u8868\u3057\u3066\u3044\u308b\u3002\n- `369612K->357147K` \u306f\u3001 GC \u524d\u5f8c\u306e\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u3092\u8868\u3057\u3066\u3044\u308b\u3002\n\n### <span id=\"gc_log\">\u30ed\u30b0\u306b\u51fa\u529b\u3059\u308b</span>\n```\njava -Xloggc:./gclog/gc.log \uff08\u7565\uff09\n```\n\n```text:gclog/gc.log\n\uff08\u7565\uff09\n1.115: [GC (Allocation Failure)  65536K->13595K(251392K), 0.0172892 secs]\n1.619: [GC (Metadata GC Threshold)  59048K->17654K(316928K), 0.0186921 secs]\n1.638: [Full GC (Metadata GC Threshold)  17654K->14363K(316928K), 0.0809789 secs]\n9.061: [GC (Metadata GC Threshold)  119609K->33977K(316928K), 0.0129435 secs]\n9.074: [Full GC (Metadata GC Threshold)  33977K->28176K(354304K), 0.0658862 secs]\n9.914: [GC (Allocation Failure)  159248K->38718K(376320K), 0.0071812 secs]\n14.349: [GC (Allocation Failure)  191806K->44894K(376320K), 0.0180813 secs]\n16.044: [GC (Allocation Failure)  197982K->58932K(346624K), 0.0185405 secs]\n17.062: [GC (Allocation Failure)  182324K->84387K(361472K), 0.0193260 secs]\n\uff08\u7565\uff09\n```\n\n- `-Xloggc:<GC\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u51fa\u529b\u5148\u30d1\u30b9>` \u3092\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001 GC \u306e\u30ed\u30b0\u3092\u30d5\u30a1\u30a4\u30eb\u306b\u51fa\u529b\u3067\u304d\u308b\u3002\n    - \u65e2\u306b\u540c\u540d\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u3001\u30d5\u30a1\u30a4\u30eb\u304c\u4e0a\u66f8\u304d\u3055\u308c\u308b\u306e\u3067\u6ce8\u610f\u3002\n    - \u8d77\u52d5\u6642\u306e\u65e5\u6642\u3092\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u542b\u3081\u3066\u304a\u3051\u3070\u3001\u8aa4\u3063\u3066\u4e0a\u66f8\u304d\u3057\u3066\u3057\u307e\u3046\u3053\u3068\u3092\u9632\u3052\u308b\u3002\n- \u5148\u982d\u306e\u6570\u5b57\u306f\u3001 JVM \u304c\u8d77\u52d5\u3055\u308c\u3066\u304b\u3089\u306e\u7d4c\u904e\u6642\u9593\u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\u3002\n\n\n### \u6642\u523b\u3092\u51fa\u529b\u3059\u308b\n```\n> java -Xloggc:./gclog/gc.log -XX:+PrintGCDateStamps \uff08\u7565\uff09\n```\n\n```text:gc.log\n\uff08\u7565\uff09\n2016-03-12T23:33:18.100+0900: 1.043: [GC (Allocation Failure)  65536K->13533K(251392K), 0.0164784 secs]\n2016-03-12T23:33:18.637+0900: 1.580: [GC (Metadata GC Threshold)  60735K->17423K(316928K), 0.0091990 secs]\n2016-03-12T23:33:18.646+0900: 1.589: [Full GC (Metadata GC Threshold)  17423K->14261K(316928K), 0.0382588 secs]\n2016-03-12T23:33:26.067+0900: 9.009: [GC (Metadata GC Threshold)  119162K->33976K(316928K), 0.0249904 secs]\n2016-03-12T23:33:26.092+0900: 9.034: [Full GC (Metadata GC Threshold)  33976K->28238K(346624K), 0.0769754 secs]\n2016-03-12T23:33:27.057+0900: 10.000: [GC (Allocation Failure)  159310K->38719K(368640K), 0.0075372 secs]\n2016-03-12T23:34:17.486+0900: 60.428: [GC (Allocation Failure)  191807K->72288K(368640K), 0.0504215 secs]\n2016-03-12T23:34:18.894+0900: 61.836: [GC (Allocation Failure)  225376K->86442K(311296K), 0.0200902 secs]\n\uff08\u7565\uff09\n```\n\n- `-XX:+PrintGCDateStamps` \u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u3067\u3001 GC \u30ed\u30b0\u306b\u305d\u306e\u3068\u304d\u306e\u6642\u523b\u3082\u51fa\u529b\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n### \u8a73\u7d30\u306a GC \u30ed\u30b0\u3092\u51fa\u529b\u3055\u305b\u308b\n```\n> java -Xloggc:./gclog/gc.log -XX:+PrintGCDetails \uff08\u7565\uff09\n```\n\n```text:gc.log\n\uff08\u7565\uff09\n1.037: [GC (Allocation Failure) [PSYoungGen: 65536K->10743K(76288K)] 65536K->13596K(251392K), 0.0106704 secs] [Times: user=0.00 sys=0.00, real=0.01 secs] \n1.566: [GC (Metadata GC Threshold) [PSYoungGen: 57946K->10731K(76288K)] 60799K->17543K(251392K), 0.0091160 secs] [Times: user=0.05 sys=0.02, real=0.01 secs] \n1.575: [Full GC (Metadata GC Threshold) [PSYoungGen: 10731K->0K(76288K)] [ParOldGen: 6812K->14259K(175104K)] 17543K->14259K(251392K), [Metaspace: 20821K->20821K(1067008K)], 0.0362780 secs] [Times: user=0.08 sys=0.00, real=0.04 secs] \n8.644: [GC (Allocation Failure) [PSYoungGen: 65536K->10750K(76288K)] 79795K->28913K(251392K), 0.0212910 secs] [Times: user=0.11 sys=0.02, real=0.02 secs] \n8.995: [GC (Metadata GC Threshold) [PSYoungGen: 42809K->10746K(96256K)] 60972K->29332K(271360K), 0.0082032 secs] [Times: user=0.00 sys=0.00, real=0.01 secs] \n9.003: [Full GC (Metadata GC Threshold) [PSYoungGen: 10746K->0K(96256K)] [ParOldGen: 18585K->20171K(192000K)] 29332K->20171K(288256K), [Metaspace: 34754K->34754K(1081344K)], 0.0700618 secs] [Times: user=0.47 sys=0.00, real=0.07 secs] \n9.238: [GC (Allocation Failure) [PSYoungGen: 85504K->1118K(96256K)] 105675K->21289K(288256K), 0.0043759 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] \n10.587: [GC (Allocation Failure) [PSYoungGen: 86622K->17111K(143872K)] 106793K->37291K(335872K), 0.0245291 secs] [Times: user=0.11 sys=0.00, real=0.02 secs] \n19.645: [GC (Allocation Failure) [PSYoungGen: 141527K->21483K(145920K)] 161707K->49982K(337920K), 0.0182595 secs] [Times: user=0.08 sys=0.00, real=0.02 secs] \n\uff08\u7565\uff09\n```\n\n- `-XX:+PrintGCDetails` \u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u3067\u3001\u3088\u308a\u8a73\u7d30\u306a\u60c5\u5831\u3092\u51fa\u529b\u3055\u305b\u3089\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n    - \u9818\u57df\u3054\u3068\u306e\u30e1\u30e2\u30ea\u91cf\u306e\u5909\u5316\u306a\u3069\u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\n\n### \u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3055\u305b\u308b\n```\n> java -Xloggc:./gclog/gc.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=5 -XX:GCLogFileSize=10k \uff08\u7565\uff09\n```\n\n```text:\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u304c\uff11\u5468\u56de\u3063\u305f\u5f8c\u306e\u72b6\u614b\ngclog> dir\n2016/03/12  23:52    <DIR>          .\n2016/03/12  23:52    <DIR>          ..\n2016/03/12  23:52            10,594 gc.log.0\n2016/03/12  23:52             1,302 gc.log.1.current\n2016/03/12  23:52            10,458 gc.log.2\n2016/03/12  23:52            10,515 gc.log.3\n2016/03/12  23:52            10,519 gc.log.4\n```\n\n- GC \u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3055\u305b\u308b\u5834\u5408\u306f\u3001\u8d77\u52d5\u6642\u306b\u6b21\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b\u3002\n    - `-XX:+UseGCLogFileRotation`\n    - `-XX:NumberOfGCLogFiles=<\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u6570>`\n    - `-XX:GCLogFileSize=<\uff11\u30d5\u30a1\u30a4\u30eb\u306e\u6700\u5927\u30b5\u30a4\u30ba>`\n- \u30b5\u30a4\u30ba\u306f `k` \u3084 `m` \u306a\u3069\u3067\u30ad\u30ed\u30d0\u30a4\u30c8\u30fb\u30e1\u30ac\u30d0\u30a4\u30c8\u3092\u6307\u5b9a\u3067\u304d\u308b\u3002\n- \u307e\u305a\u6700\u521d\u306b `gc.log.0.current` \u304c\u751f\u6210\u3055\u308c\u308b\u3002\n- \u6b21\u306b\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3059\u308b\u3068 `gc.log.1.current` \u304c\u751f\u6210\u3055\u308c\u3001\u305d\u3061\u3089\u306b\u30ed\u30b0\u304c\u5410\u304b\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n    - `gc.log.0.current` \u306f `gc.log.0` \u3068\u3044\u3046\u540d\u524d\u306b\u30ea\u30cd\u30fc\u30e0\u3055\u308c\u308b\u3002\n- \u540c\u3058\u3088\u3046\u306b\u3057\u3066\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u7e70\u308a\u8fd4\u3057\u3066\u3044\u304d\u3001 `NumberOfGCLogFiles` \u3067\u6307\u5b9a\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u6570\u3092\u8d85\u3048\u305f\u3089\u518d\u3073 `gc.log.0` \u306b\u30ed\u30b0\u304c\u51fa\u529b\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n- \u73fe\u5728\u51fa\u529b\u3057\u3066\u3044\u308b\u30d5\u30a1\u30a4\u30eb\u306f\u3001\u672b\u5c3e\u306b `.current` \u304c\u4ed8\u304f\u3002\n\n### <span id=\"gcviwer\">GC \u30ed\u30b0\u3092\u30b0\u30e9\u30d5\u3067\u78ba\u8a8d\u3059\u308b</span>\n- [GC Viewer](http://www.tagtraum.com/gcviewer.html) \u3068\u3044\u3046 GUI \u306e\u30c4\u30fc\u30eb\u3092\u4f7f\u3046\u3053\u3068\u3067\u3001 GC \u30ed\u30b0\u3092\u30b0\u30e9\u30d5\u3067\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n    - \u306a\u3093\u304b\u3001 `-XX:+PrintGCDateStamps` \u3092\u6307\u5b9a\u3057\u3066\u3044\u306a\u3044\u3068\u30ed\u30b0\u306e\u89e3\u6790\u3067\u30a8\u30e9\u30fc\u306b\u306a\u308b\u6c17\u304c\u3059\u308b\u3002\u3002\u3002\uff1f\n- \u30aa\u30ea\u30b8\u30ca\u30eb\u306e\u4f5c\u8005\u306b\u3088\u308b\u958b\u767a\u306f 2008 \u5e74\u306e\u6642\u70b9\u3067\u7d42\u4e86\u3057\u3066\u3044\u308b\u304c\u3001\u5225\u306e\u4eba\u304c [GitHub \u4e0a](https://github.com/chewiebug/GCViewer) \u3067\u958b\u767a\u3092\u7d9a\u3051\u3066\u3044\u308b\u3002\n- [GitHub \u304b\u3089\u5b9f\u884c\u53ef\u80fd jar](https://github.com/chewiebug/GCViewer/releases) \u3092\u843d\u3068\u3057\u3066\u304f\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n- \u30c0\u30d6\u30eb\u30af\u30ea\u30c3\u30af\u3067\u8d77\u52d5\u3057\u3066\u3001 GC \u30ed\u30b0\u3092\u30c9\u30e9\u30c3\u30b0\uff06\u30c9\u30ed\u30c3\u30d7\u3059\u308c\u3070\u958b\u304f\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n![oome.jpg](https://qiita-image-store.s3.amazonaws.com/0/28302/aa7bb570-b97b-bacb-a038-64f1cc7586c5.jpeg)\n\n- [View] \u3067\u30b0\u30e9\u30d5\u306e\u8868\u793a\u975e\u8868\u793a\u3092\u5207\u308a\u66ff\u3048\u3089\u308c\u308b\u3002\n    - \u4e0a\u56f3\u306f\u3001\u30d2\u30fc\u30d7\u306e\u5909\u5316\u3060\u3051\u3092\u8868\u793a\u3057\u3066\u3044\u308b\u3002\n- \u30c4\u30fc\u30eb\u30d0\u30fc\u306b\u3042\u308b\u6642\u8a08\u307f\u305f\u3044\u306a\u30de\u30fc\u30af\uff08\u62e1\u5927\u7387\u306e\u5de6\uff09\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001\u30ed\u30b0\u3092\u76e3\u8996\u3057\u3066\u5909\u66f4\u304c\u3042\u308c\u3070\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u8868\u793a\u3092\u66f4\u65b0\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n- \u666e\u6bb5\u304b\u3089 GC \u30ed\u30b0\u3092\u51fa\u529b\u3055\u305b\u3066\u304a\u3044\u3066\u3001\u30d2\u30fc\u30d7\u306e\u5909\u5316\u306b\u4e0d\u81ea\u7136\u306a\u69d8\u5b50\u306f\u7121\u3044\u304b\u3092\u78ba\u8a8d\u3059\u308b\u306e\u306b\u5229\u7528\u3059\u308b\u3002\n    - GC \u304c\u767a\u751f\u3057\u305f\u306e\u306b\u30d2\u30fc\u30d7\u306e\u30b5\u30a4\u30ba\u304c\u3069\u3093\u3069\u3093\u5897\u3048\u3066\u3044\u3063\u3066\u3044\u305f\u3089\u3001\u306a\u3093\u304b\u602a\u3057\u3044\u3068\u3044\u3046\u5408\u56f3\u3002\n    - \u4e0a\u56f3\u306e\u30ed\u30b0\u3067\u306f\u3001 GC \u306e\u5ea6\u306b\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba\u304c\u307b\u307c\u540c\u3058\u30b5\u30a4\u30ba\u306b\u4e0b\u304c\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u554f\u984c\u306f\u306a\u3055\u3052\u3068\u5224\u65ad\u3067\u304d\u308b\u3002\n\n## <span id=\"oome_heap_dump\">OOME \u304c\u767a\u751f\u3057\u305f\u3068\u304d\u306b\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u81ea\u52d5\u3067\u53d6\u5f97\u3059\u308b</span>\n```\n> java -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=./hprof/ \uff08\u7565\uff09\n```\n\n```text:OOME\u304c\u767a\u751f\u3057\u305f\u3068\u304d\u306e\u6a19\u6e96\u51fa\u529b\nDumping heap to ./hprof/\\java_pid21072.hprof ...\nHeap dump file created [454844605 bytes in 0.602 secs]\n\n[2016-03-13T00:38:01.923+0900] [Payara 4.1] [WARNING] [] [javax.enterprise.web] [tid: _ThreadID=17 _ThreadName=http-listener(2)] [timeMillis: 1457797081923] [levelValue: 900] [[StandardWrapperValve[sample.oome.MyApplication]: Servlet.service() for servlet sample.oome.MyApplication threw exception\njava.lang.OutOfMemoryError: Java heap space\n        at sample.oome.MyResource$BigObject.<init>(MyResource.java:24)\n        at sample.oome.MyResource.execute(MyResource.java:16)\n\uff08\u7565\uff09\n```\n\n```text:\u51fa\u529b\u3055\u308c\u305f\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\nhprof> dir /b\njava_pid21072.hprof\n```\n\n- `-XX:+HeapDumpOnOutOfMemoryError` \u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001 OOME \u304c\u767a\u751f\u3057\u305f\u3068\u304d\u306b\u81ea\u52d5\u3067\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u51fa\u529b\u3055\u305b\u3089\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n- `-XX:HeapDumpPath=<\u51fa\u529b\u5148\u30d5\u30a9\u30eb\u30c0>` \u3067\u3001\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u306e\u51fa\u529b\u5148\u3092\u6307\u5b9a\u3067\u304d\u308b\u3002\n    - \u30d5\u30a1\u30a4\u30eb\u540d\u306f `java_pid<\u30d7\u30ed\u30bb\u30b9ID>.hprof` \u3068\u3044\u3046\u540d\u524d\u306b\u306a\u308b\u3002\n- \u540c\u3058\u30d7\u30ed\u30bb\u30b9\u3067\u306f\u3001\u4e00\u5ea6 OOME \u3067\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u304c\u51fa\u529b\u3055\u308c\u308b\u3068\u3001\u4ee5\u5f8c OOME \u304c\u767a\u751f\u3057\u3066\u3082\u30d2\u30fc\u30d7\u30c0\u30f3\u30d7\u3092\u51fa\u529b\u3057\u306a\u304f\u306a\u308b\u6a21\u69d8\u3002\n    - \u307e\u3041\u3001 OOME \u304c\u51fa\u305f\u6642\u70b9\u3067\u30e1\u30e2\u30ea\u306e\u72b6\u614b\u304c\u4fdd\u8a3c\u3055\u308c\u306a\u3044\u304b\u3089\u3001\u4e00\u65e6\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u505c\u6b62\u3055\u305b\u308b\u3079\u304d\u306a\u306e\u3060\u308d\u3046\u3002\n\n\n\n# \u7528\u8a9e\u96c6\n## \u30d2\u30fc\u30d7\n- \u30d2\u30fc\u30d7\u30e1\u30e2\u30ea\u3002\n- Java \u30d7\u30ed\u30b0\u30e9\u30e0\u4e0a\u3067\u751f\u6210\u3057\u305f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u914d\u7f6e\u3055\u308c\u308b\u30e1\u30e2\u30ea\u9818\u57df\u3002\n- \u4e00\u822c\u7684\u306b\u300c\u30d2\u30fc\u30d7\u300d\u3068\u8a00\u3046\u3068\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u304c\u52d5\u304f\u305f\u3081\u306b\u78ba\u4fdd\u3055\u308c\u305f\u30e1\u30e2\u30ea\u9818\u57df\u306e\u3053\u3068\u3092\u6307\u3059\u3002\n    - [\u30d2\u30fc\u30d7\u3068\u306f\uff5cheap\uff5c\u30d2\u30fc\u30d7\u9818\u57df - \u610f\u5473/\u5b9a\u7fa9 \uff1a IT\u7528\u8a9e\u8f9e\u5178](http://e-words.jp/w/%E3%83%92%E3%83%BC%E3%83%97.html)\n    - \u3057\u304b\u3057\u3001 JVM \u3067\u306e\u6587\u8108\u3067\u306f\u3001\u5358\u306b\u300c\u30d2\u30fc\u30d7\u300d\u3068\u8a00\u3046\u3068 JVM \u4e0a\u3067\u52d5\u304f Java \u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u305f\u3081\u306e\u30e1\u30e2\u30ea\u9818\u57df\u306e\u3053\u3068\u3092\u6307\u3059\u3002\n    - JVM \u304c\u52d5\u304f\u3068\u304d\u306f\u3001 Java \u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u305f\u3081\u4ee5\u5916\u306b\u3082 JVM \u81ea\u8eab\u306e\u305f\u3081\u306e\u30e1\u30e2\u30ea\u9818\u57df\u306a\u3069\u3082\u78ba\u4fdd\u3055\u308c\u308b\u3002\n- JVM \u306e\u30e1\u30e2\u30ea\u7a7a\u9593\u306e\u8aac\u660e\u3067\u300cC \u30d2\u30fc\u30d7\u300d\u3068\u3044\u3046\u8868\u73fe\u304c\u3042\u308b\u5834\u5408\u3001\u305d\u306e\u300c\u30d2\u30fc\u30d7\u300d\u306f\u4e00\u822c\u7528\u8a9e\u306e\u610f\u5473\u3067\u306e\u300c\u30d2\u30fc\u30d7\u300d\u306e\u3053\u3068\u3060\u3068\u601d\u3046\u3002\n    - JVM \u3067\u306e\u6587\u8108\u3067\u306f\u3001\u300cC \u30d2\u30fc\u30d7\u300d\u306f\u30cd\u30a4\u30c6\u30a3\u30d6\u9818\u57df\u306e\u3053\u3068\u306b\u306a\u308b\u3002\n\n## Permanent \u9818\u57df\n- \u30af\u30e9\u30b9\u3084\u30e1\u30bd\u30c3\u30c9\u306e\u30e1\u30bf\u60c5\u5831\u306a\u3069\u3001\u9759\u7684\u306a\u60c5\u5831\u304c\u683c\u7d0d\u3055\u308c\u308b\u3002\n    - DI \u30b3\u30f3\u30c6\u30ca\u3068\u304b\u304c\u30af\u30e9\u30b9\u3092\u52d5\u7684\u306b\u30ed\u30fc\u30c9\u3059\u308b\u3068\u3001\u3053\u306e\u9818\u57df\u304c\u6d88\u8cbb\u3055\u308c\u3066\u3044\u304d OOME \u304c\u767a\u751f\u3057\u3084\u3059\u3044\u3002\n- \u975e\u30d2\u30fc\u30d7\u9818\u57df\u3002\n    - \u30d2\u30fc\u30d7\u9818\u57df\u3067\u306f\u306a\u3044\u304c\u3001\u30cd\u30a4\u30c6\u30a3\u30d6\u9818\u57df\u3067\u3082\u306a\u3044\u9818\u57df\u3002\n- Java 8 \u3067\u5ec3\u6b62\u3055\u308c\u3001\u4ee3\u308f\u308a\u306b Metaspace \u3068\u547c\u3070\u308c\u308b\u9818\u57df\u304c\u8ffd\u52a0\u3055\u308c\u305f\u3002\n\n## Metaspace\n- Java 8 \u304b\u3089\u63a1\u7528\u3055\u308c\u305f\u3001 Permanent \u9818\u57df\u306b\u4ee3\u308f\u308b\u30e1\u30e2\u30ea\u9818\u57df\u3002\n- \u30cd\u30a4\u30c6\u30a3\u30d6\u9818\u57df\u306b\u78ba\u4fdd\u3055\u308c\u308b\u3002\n\n## \u30cd\u30a4\u30c6\u30a3\u30d6\u9818\u57df\n- Native Area \u3068\u304b\u3001\u5358\u306b Native \u3068\u304b\u3002\n- JVM \u304c\u52d5\u304f\u305f\u3081\u306e\u30e1\u30e2\u30ea\u3060\u3063\u305f\u308a\u30b9\u30ec\u30c3\u30c9\u306e\u30b9\u30bf\u30c3\u30af\u306e\u60c5\u5831\u304c\u683c\u7d0d\u3055\u308c\u305f\u308a\u3059\u308b\u9818\u57df\u3002\n\n## Young \u9818\u57df\n- \u30d2\u30fc\u30d7\u306e\u4e00\u90e8\u3002\n- \u751f\u6210\u3055\u308c\u3066\u304b\u3089\u306e\u6642\u9593\u304c\u307e\u3060\u77ed\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u914d\u7f6e\u3055\u308c\u308b\u9818\u57df\u3002\n- Young \u9818\u57df\u306f\u3001\u3055\u3089\u306b Eden \u9818\u57df\u3068\uff12\u3064\u306e Survivor \u9818\u57df\u306b\u5206\u304b\u308c\u308b\u3002\n- New \u9818\u57df\u3068\u3082\u547c\u3070\u308c\u308b\u3002\n\n## Eden \u9818\u57df\n- Young \u9818\u57df\u306e\u4e00\u90e8\u3002\n- \u65b0\u898f\u4f5c\u6210\u3055\u308c\u305f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u3001\u307e\u305a\u3053\u306e\u9818\u57df\u306b\u914d\u7f6e\u3055\u308c\u308b\u3002\n\n## Survivor \u9818\u57df\n- Young \u9818\u57df\u306e\u4e00\u90e8\u3002\n- Eden \u9818\u57df\u304c\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3055\u308c\u308b\u3068\u304d\u306b\u3001\u307e\u3060\u5229\u7528\u3055\u308c\u3066\u3044\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f Survivor \u9818\u57df\u306b\u79fb\u52d5\u3055\u308c\u308b\u3002\n- Young \u9818\u57df\u5185\u306b\u306f\uff12\u3064\u306e Survivor \u9818\u57df\u304c\u7528\u610f\u3055\u308c\u3066\u304a\u308a\u3001\u3069\u3061\u3089\u304b\u4e00\u65b9\u306f\u5fc5\u305a\u7a7a\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n- \u8a73\u3057\u304f\u306f [Java\u6280\u8853\u6700\u524d\u7dda - \u300c\u30e1\u30e2\u30ea\u30fc\u3092\u610f\u8b58\u3057\u3066\u307f\u3088\u3046\u300d\u7b2c2\u56de\u3000GC\u306e\u4ed5\u7d44\u307f\u3092\u7406\u89e3\u3059\u308b\uff1aITpro][1] \u3092\u53c2\u7167\u3002\n\n## Old \u9818\u57df\n- \u30d2\u30fc\u30d7\u306e\u4e00\u90e8\u3002\n- Survivor \u9818\u57df\u306e\u4e2d\u3067\u3082\u7279\u306b\u9577\u6642\u9593\u751f\u304d\u7d9a\u3051\u3066\u3044\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u9000\u907f\u3055\u308c\u308b\u5834\u6240\u3002\n- Tenured \u9818\u57df\u3068\u3082\u547c\u3070\u308c\u308b\u3002\n\n## \u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\n- Garbage Collection\n- GC\n- \u30d2\u30fc\u30d7\u30e1\u30e2\u30ea\u306b\u914d\u7f6e\u3055\u308c\u305f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u3046\u3061\u3001\u4f7f\u308f\u308c\u3066\u3044\u306a\u3044\u3082\u306e\u3092\u7834\u68c4\u3057\u30e1\u30e2\u30ea\u306e\u7a7a\u304d\u9818\u57df\u3092\u78ba\u4fdd\u3059\u308b\u6a5f\u80fd\u30fb\u4ed5\u7d44\u307f\u3002\n\n## Stop the World\n- \u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u3068\u304d\u306b\u767a\u751f\u3059\u308b\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b9\u30ec\u30c3\u30c9\u304c\u5b8c\u5168\u306b\u505c\u6b62\u3059\u308b\u73fe\u8c61\u3001\u307e\u305f\u305d\u306e\u6642\u9593\u3002\n- \u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3067\u306f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u53c2\u7167\u3092\u8fbf\u3063\u305f\u308a\u3001\u5fc5\u8981\u3067\u3042\u308c\u3070\u30b3\u30f3\u30d1\u30af\u30c8\u5316\u3057\u305f\u308a\u3059\u308b\u3002\n    - \u3053\u306e\u9593\u306b\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u30e1\u30e2\u30ea\u3092\u53c2\u7167\u3057\u305f\u308a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u95a2\u9023\u3092\u66f8\u304d\u5909\u3048\u305f\u308a\u3059\u308b\u3068\u3001\u6b63\u78ba\u306b\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u304c\u3067\u304d\u306a\u304f\u306a\u308b\u3002\n    - \u306a\u306e\u3067\u3001\u3069\u3046\u3057\u3066\u3082\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b9\u30ec\u30c3\u30c9\u3092\u6b62\u3081\u3066\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u304c\u5c02\u6709\u3059\u308b\u6642\u9593\u304c\u5fc5\u8981\u306b\u306a\u308b\u3002\n    - \u3053\u308c\u304c Stop the World.\n- STW \u3068\u7701\u7565\u3055\u308c\u305f\u308a\u3059\u308b\u3053\u3068\u3082\u3042\u308b\u3002\n- <del><span class=\"small\">\u6700\u521d\u3001\u67d0\u5438\u8840\u9b3c\u306e\u5fc5\u6bba\u6280\u3092\u5143\u306b\u3057\u305f\u30cd\u30bf\u3068\u601d\u3063\u3066\u305f\u3051\u3069\u3001\u6b63\u5f0f\u306a\u7528\u8a9e\u3089\u3057\u3044\u3002</span></del>\n\n## \u30b3\u30f3\u30d1\u30af\u30c8\u5316\n- \u65ad\u7247\u5316\u3057\u305f\u30e1\u30e2\u30ea\u3092\u6574\u7406\u3057\u3066\u3001\u307e\u3068\u307e\u3063\u305f\u7a7a\u304d\u9818\u57df\u3092\u78ba\u4fdd\u3059\u308b\u3053\u3068\u3002\n\n## \u30de\u30a4\u30ca\u30fc\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\n- Minor Garbage Collection\n- Young \u9818\u57df\uff08Eden, Survivor\uff09\u304c\u3044\u3063\u3071\u3044\u306b\u306a\u3063\u305f\u3068\u304d\u306b\u5b9f\u884c\u3055\u308c\u308b\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3002\n\n## Scavenge GC\n- \u4e16\u4ee3\u5225 GC \u3067\u5b9f\u884c\u3055\u308c\u308b\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u306e\u624b\u6cd5\u306e\uff11\u3064\u3002\n    - \u5bfe\u8c61\u30e1\u30e2\u30ea\u9818\u57df\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u8abf\u3079\u3001\u4f7f\u7528\u3057\u3066\u3044\u306a\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u7834\u68c4\u3057\u3001\u4f7f\u7528\u3057\u3066\u3044\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u5225\u306e\u9818\u57df\u306b\u79fb\u52d5\u3059\u308b\u3002\n    - \u5bfe\u8c61\u30e1\u30e2\u30ea\u9818\u57df\u304c\u9650\u3089\u308c\u3066\u304a\u308a\u3001\u6700\u5f8c\u306f\u5bfe\u8c61\u306e\u30e1\u30e2\u30ea\u9818\u57df\u304c\u7a7a\u306b\u306a\u308b\u306e\u3067\u30b3\u30f3\u30d1\u30af\u30c8\u5316\u3059\u308b\u5fc5\u8981\u304c\u306a\u304f\u3001\u9ad8\u901f\u306b\u52d5\u4f5c\u3059\u308b\u3002\n- \u30de\u30a4\u30ca\u30fc\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3067\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u3002\n- \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u79fb\u52d5\u3059\u308b\u3060\u3051\u306a\u306e\u3067\u3001 Copy GC \u3068\u3082\u547c\u3070\u308c\u308b\u3002\n- Stop the World \u306e\u6642\u9593\u306f\u77ed\u3044\u3002\n\n## Copy GC\n- Scavenge GC \u306e\u3053\u3068\u3002\n\n## \u30e1\u30b8\u30e3\u30fc\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\n- Major Garbage Collection\n- Old \u9818\u57df\u304c\u3044\u3063\u3071\u3044\u306b\u306a\u3063\u305f\u3068\u304d\u306b\u5b9f\u884c\u3055\u308c\u308b\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3002\n    - \u53b3\u5bc6\u306b\u306f\u8272\u3005\u8907\u96d1\u306a\u6761\u4ef6\u304c\u3042\u308b\u3089\u3057\u3044\u3051\u3069\u3001\u305d\u306e\u3078\u3093\u306f [CMS GC \u304a\u3055\u3089\u3044 - sugarlife's blog][2] \u3092\u53c2\u7167\u306e\u3053\u3068\u3002\n- \u30b3\u30f3\u30d1\u30af\u30c8\u5316\u306f\u884c\u308f\u306a\u3044\u3002\n\n## \u30d5\u30eb\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\n- Full Garbage Collection\n- Full GC\n- \u5168\u30e1\u30e2\u30ea\u9818\u57df\uff08Permanent \u3082\u542b\u3080\uff09\u3092\u5bfe\u8c61\u306b\u3057\u305f\u5927\u898f\u6a21\u306a\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3002\n- \u65ad\u7247\u5316\u306e\u305f\u3081 Old \u9818\u57df\u306e\u7a7a\u304d\u9818\u57df\u304c\u8db3\u308a\u306a\u3044\u3068\u304d\u3084\u3001\u4ed6\u306e GC \u3067\u306e\u56de\u53ce\u304c\u9593\u306b\u5408\u308f\u306a\u3044\u3088\u3046\u306a\u3068\u304d\u306b\u5b9f\u884c\u3055\u308c\u308b\u3002\n- \u30b3\u30f3\u30ab\u30ec\u30f3\u30c8**\u3067\u306f\u306a\u3044** Mark & Sweep \u3092\u5b9f\u884c\u3057\u3066\u3001\u66f4\u306b\u30b3\u30f3\u30d1\u30af\u30c8\u5316\u3082\u884c\u3046\u3002\n- \u5fc5\u7136\u7684\u306b Stop the World \u306f\u9577\u304f\u306a\u308b\u3002\n\n## Mark & Sweep\n- \u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u306e\u624b\u6cd5\u306e\uff11\u3064\u3002\n- \u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\uff12\u3064\u306e\u30d5\u30a7\u30fc\u30ba\u306b\u5206\u3051\u3066\u5b9f\u884c\u3059\u308b\u3002\n    - \u6700\u521d\u306e\u30d5\u30a7\u30fc\u30ba\u3067\u306f\u3001\u4f7f\u7528\u3057\u3066\u3044\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u53c2\u7167\u3092\u8fbf\u308a\u306a\u304c\u3089\u30de\u30fc\u30af\u3092\u4ed8\u3051\u3066\u3044\u304d\u3001\u4f7f\u7528\u3057\u3066\u3044\u306a\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u7279\u5b9a\u3059\u308b\u3002\n    - \u6b21\u306e\u30d5\u30a7\u30fc\u30b9\u3067\u306f\u3001\u4f7f\u7528\u3057\u3066\u3044\u306a\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u30e1\u30e2\u30ea\u4e0a\u304b\u3089\u524a\u9664\u3059\u308b\u3002\n- \u30d5\u30eb\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3067\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u3002\n\n## \u30b7\u30ea\u30a2\u30eb GC\n- Serial GC\n- \u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u306e\u5b9f\u884c\u65b9\u6cd5\u306e\uff11\u3064\u3002\n- \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u306e\u30b9\u30ec\u30c3\u30c9\u304c\u4ea4\u4e92\u306b\u5b9f\u884c\u3055\u308c\u308b\u3002\n- \u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u7528\u306e\u30b9\u30ec\u30c3\u30c9\u306f\uff11\u3064\u3060\u3051\u3057\u304b\u4f7f\u7528\u3055\u308c\u306a\u3044\u3002\n- \u30b7\u30f3\u30b0\u30eb\u30b3\u30a2\u306e\u30de\u30b7\u30f3\u3067\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3002\n\n## \u30d1\u30e9\u30ec\u30eb GC\n- Parallel GC\n- \u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u306e\u5b9f\u884c\u65b9\u6cd5\u306e\uff11\u3064\u3002\n- \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u306e\u30b9\u30ec\u30c3\u30c9\u304c\u4ea4\u4e92\u306b\u5b9f\u884c\u3055\u308c\u308b\u306e\u306f\u30b7\u30ea\u30a2\u30eb GC \u3068\u540c\u3058\u3002\n- \u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u7528\u306e\u30b9\u30ec\u30c3\u30c9\u304c\u8907\u6570\u4f7f\u7528\u3055\u308c\u308b\u70b9\u304c\u30d1\u30e9\u30ec\u30eb\u3002\n- \u30de\u30eb\u30c1\u30b3\u30a2\u306e\u30de\u30b7\u30f3\u3067\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3002\n\n## Concurrent Mark & Sweep GC\n- Concurrent GC \u3068\u304b CMS \u3068\u547c\u3070\u308c\u305f\u308a\u3082\u3059\u308b\u3002\n- Mark & Sweep \u306e\u51e6\u7406\u3092\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b9\u30ec\u30c3\u30c9\u3068\u540c\u6642\u4e26\u884c\u3067\u884c\u3046\u624b\u6cd5\u3002\n    - \u5b8c\u5168\u306a\u540c\u6642\u4e26\u884c\u3067\u306f\u306a\u304f\u3001\u6700\u521d\u3068\u9014\u4e2d\u3067 Stop the World \u304c\u767a\u751f\u3059\u308b\u3002\n- Stop the World \u306e\u6642\u9593\u306f\u77ed\u3044\u3002\n- \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30c8\u304c\u540c\u6642\u306b\u5b9f\u884c\u3055\u308c\u308b\u306e\u3067\u3001\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\uff08\u5358\u4f4d\u6642\u9593\u3042\u305f\u308a\u306e\u51e6\u7406\u4ef6\u6570\uff09\u306f\u4e0b\u304c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002\n    - \u4ee3\u308f\u308a\u306b\u3001 Stop the World \u306e\u6642\u9593\u306f\u77ed\u3044\u306e\u3067\u30ec\u30b9\u30dd\u30f3\u30b9\u30bf\u30a4\u30e0\uff08\u51e6\u7406\u7d50\u679c\u304c\u8fd4\u3055\u308c\u308b\u307e\u3067\u306e\u6642\u9593\uff09\u306f\u4e0a\u304c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002\n- \u30e1\u30b8\u30e3\u30fc\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3067\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u3002\n\n## G1 GC\n- Garbage First GC\n- \u30e1\u30e2\u30ea\u306e\u5927\u5bb9\u91cf\u5316\u306b\u4f34\u3044\u3001\u4eca\u307e\u3067\u306e\u4e16\u4ee3\u5225 GC \u3067\u306f\u7121\u99c4\u304c\u591a\u3044\u3068\u3044\u3046\u3053\u3068\u3067\u8003\u3048\u51fa\u3055\u308c\u305f GC\u3002\n- Java 7 \u304b\u3089\u63a1\u7528\u3055\u308c\u3001 Java 9 \u3067\u30c7\u30d5\u30a9\u30eb\u30c8\u5316\u3059\u308b\u4e88\u5b9a\u3002\n- \u30d2\u30fc\u30d7\u9818\u57df\u3092\u300c\u30ea\u30fc\u30b8\u30e7\u30f3\u300d\u3068\u547c\u3070\u308c\u308b\u533a\u57df\u3067\u7b49\u5206\u5272\u3057\u3001\u4e16\u4ee3\u5225\u306b\u7ba1\u7406\u3059\u308b\u3002\n    - \u5206\u5272\u3057\u305f\u9818\u57df\u3092 Eden, Survivor, Old \u3068\u3057\u3066\u4f7f\u3046\u3002\n    - \u307e\u305a Eden \u306b\u914d\u7f6e\u3057\u3066\u3001\u3044\u3063\u3071\u3044\u306b\u306a\u3063\u305f\u3089 Survivor, \u305d\u3057\u3066 Old \u306b\u79fb\u3057\u3066\u3044\u304f\u8003\u3048\u65b9\u306f\u540c\u3058\u3002\n\n## \u4e16\u4ee3\u5225GC\n- HotStop VM \u3067\u63a1\u7528\u3055\u308c\u305f\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u306e\u624b\u6cd5\u3002\n- \u30d2\u30fc\u30d7\u9818\u57df\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u751f\u5b58\u671f\u9593\u306e\u9577\u3055\u306b\u5408\u308f\u305b\u3066 Young \u9818\u57df\u3068 Old \u9818\u57df\u306b\u5206\u5272\u3057\u3066\u3001\u6bb5\u968e\u7684\u306b\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n## HotSpot VM\n- JVM \u3067\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u9ad8\u901f\u5316\u306e\u305f\u3081\u306e\u6280\u8853\u3001\u307e\u305f\u305d\u306e\u6280\u8853\u3092\u63a1\u7528\u3057\u305f JVM \u306e\u3053\u3068\u3002\n- HotSpot - \u3059\u306a\u308f\u3061\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4e2d\u3067\u3082\u7279\u306b\u5b9f\u884c\u983b\u5ea6\u306e\u9ad8\u3044\u90e8\u5206\u3092\u7279\u5b9a\u3057\u3066\u3001\u305d\u306e\u90e8\u5206\u3092\u512a\u5148\u7684\u306b\u6a5f\u68b0\u8a9e\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u5b9f\u884c\u3059\u308b\u624b\u6cd5\u30fb\u4ed5\u7d44\u307f\u3002\n    - \uff11\u56de\u3057\u304b\u5b9f\u884c\u3057\u306a\u3044\u30b3\u30fc\u30c9\u3092\u6a5f\u68b0\u8a9e\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u306e\u306f\u7121\u99c4\u304c\u5927\u304d\u3044\u306e\u3067\u3001\u305d\u3046\u3044\u3046\u90e8\u5206\u306f\u30a4\u30f3\u30bf\u30d7\u30ea\u30bf\u3067\u5b9f\u884c\u3057\u3066\u3001\u4f55\u56de\u3082\u5b9f\u884c\u3055\u308c\u308b\u90e8\u5206\uff08HotSpot\uff09\u3060\u3051\u3092\u6a5f\u68b0\u8a9e\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u9ad8\u901f\u5316\u3057\u3088\u3046\u3001\u3068\u3044\u3046\u8003\u3048\u65b9\u3002\n- \u300c\u4e00\u822c\u7684\u306a\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u3001\u5b9f\u884c\u6642\u9593\u306e 80% \u304c\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e 20 % \u3067\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u300d\u3068\u3044\u3046\u6cd5\u5247\u304c\u3082\u3068\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n## Just In Time Compiler\n- JIT \u30b3\u30f3\u30d1\u30a4\u30e9\n- \u4e2d\u9593\u8a00\u8a9e\u306a\u3069\u5b9f\u884c\u74b0\u5883\u306b\u4f9d\u5b58\u3057\u306a\u3044\u5f62\u5f0f\u3067\u66f8\u304b\u308c\u305f\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u3001\u5b9f\u884c\u76f4\u524d\uff08Just In Time\uff09\u306b\u5b9f\u884c\u74b0\u5883\u306b\u5408\u308f\u305b\u305f\u6a5f\u68b0\u8a9e\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u5b9f\u884c\u3059\u308b\u624b\u6cd5\u30fb\u6a5f\u80fd\u3002\n    - \u30a4\u30f3\u30bf\u30d7\u30ea\u30bf\u306f\u9010\u6b21\u30bd\u30fc\u30b9\u3092\u8aad\u307f\u306a\u304c\u3089\u5b9f\u884c\u3059\u308b\u306e\u3067\u3001\u3061\u3087\u3063\u3068\u9055\u3046\u3002\n- \u5b9f\u884c\u74b0\u5883\u306b\u4f9d\u5b58\u3057\u306a\u3044\u5f62\u5f0f\u3067\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u914d\u5e03\u3067\u304d\u3001\u304b\u3064\u5b9f\u884c\u901f\u5ea6\u306f\u4e88\u3081\u6a5f\u68b0\u8a9e\u3067\u4f5c\u6210\u3055\u308c\u305f\u30d7\u30ed\u30b0\u30e9\u30e0\u3068\u5f15\u3051\u3092\u53d6\u3089\u306a\u3044\u3068\u3044\u3046\u7279\u5fb4\u304c\u3042\u308b\u3002\n\n\n\n# \u53c2\u8003\n## \u5168\u822c\n- [Amazon.co.jp\uff1a Java\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9: Scott Oaks, \u30a2\u30af\u30ed\u30af\u30a8\u30b9\u30c8\u30c6\u30af\u30ce\u30ed\u30b8\u30fc\u682a\u5f0f\u4f1a\u793e, \u5bfa\u7530 \u4f73\u592e, \u7267\u91ce \u8061: \u672c][3]\n\n## \u30e1\u30e2\u30ea\u7ba1\u7406\u306e\u4ed5\u7d44\u307f\n- [Java\u6280\u8853\u6700\u524d\u7dda - \u300cJava SE 6\u5b8c\u5168\u653b\u7565\u300dGarbage First GC\uff1aITpro](http://itpro.nikkeibp.co.jp/article/COLUMN/20100208/344358/?rt=nocnt)\n- [Java\u6280\u8853\u6700\u524d\u7dda - \u300c\u30e1\u30e2\u30ea\u30fc\u3092\u610f\u8b58\u3057\u3066\u307f\u3088\u3046\u300d\u7b2c2\u56de\u3000GC\u306e\u4ed5\u7d44\u307f\u3092\u7406\u89e3\u3059\u308b\uff1aITpro][1]\n- [Java\u6280\u8853\u6700\u524d\u7dda - \u300c\u30e1\u30e2\u30ea\u30fc\u3092\u610f\u8b58\u3057\u3066\u307f\u3088\u3046\u300d\u7b2c4\u56de\u3000\u9032\u5316\u3059\u308b\u30e1\u30e2\u30ea\u30fc\u7ba1\u7406\uff1aITpro](http://itpro.nikkeibp.co.jp/article/COLUMN/20060626/241719/?ST=ittrend)\n- [Garbage First Garbage Collection (G1 GC) #jjug_ccc #ccc_cd6](http://www.slideshare.net/YujiKubota/garbage-first-garbage-collection)\n- [CMS GC \u304a\u3055\u3089\u3044 - sugarlife's blog][2]\n- [Metaspace \u3092 OpenJDK \u5b9f\u88c5\u304b\u3089\u898b\u3066\u307f\u3088\u3046\uff01 | \u672b\u6c38\u606d\u6b63 | SlideShare](http://www.slideshare.net/YaSuenag/metaspace)\n- [Java 8\u3067PermGen\u306eOutOfMemoryError\u554f\u984c\u306f\u89e3\u6c7a\u3055\u308c\u308b\u306e\u304b\uff1f](http://www.infoq.com/jp/news/2013/03/java-8-permgen-metaspace)\n- [Java8\u306eHotSpotVM\u304b\u3089Permanent\u9818\u57df\u304c\u6d88\u3048\u305f\u7406\u7531\u3068\u305d\u306e\u5f71\u97ff | \u30ae\u30fc\u30af\u3092\u76ee\u6307\u3057\u3066](http://equj65.net/tech/java8hotspot/)\n- [Java Garbage Collection Basics](http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/gc01/index.html)\n- [Garbage Collection\u306b\u3064\u3044\u3066\u3061\u3087\u3063\u3068\u8abf\u3079\u3066\u307f\u305f - wyukawa\u2019s blog](http://d.hatena.ne.jp/wyukawa/20130103/1357211148)\n- [Java\u306f\u3069\u306e\u3088\u3046\u306b\u52d5\u304f\u306e\u304b\uff5e\u30b9\u30e9\u30a4\u30c9\u3067\u308f\u304b\u308bJVM\u306e\u4ed5\u7d44\u307f](http://www.slideshare.net/ChihiroIto1/java-16802525)\n- [\u7b2c9\u56de\u3000\uff3b\u6700\u7d42\u56de\uff3dHotSpot JVM\u306eGC\u3092\u9078\u629e\u3057\u3088\u3046\uff1aJava\u306f\u3069\u306e\u3088\u3046\u306b\u52d5\u304f\u306e\u304b\uff5e\u56f3\u89e3\u3067\u308f\u304b\u308bJVM\u306e\u4ed5\u7d44\u307f\uff5cgihyo.jp \u2026 \u6280\u8853\u8a55\u8ad6\u793e](http://gihyo.jp/dev/serial/01/jvm-arc/0009)\n- [JIT\u30b3\u30f3\u30d1\u30a4\u30e9\u3068\u306f\uff5c\u5b9f\u884c\u6642\u30b3\u30f3\u30d1\u30a4\u30e9\uff5c\u30b8\u30e3\u30b9\u30c8\u30a4\u30f3\u30bf\u30a4\u30e0\u30b3\u30f3\u30d1\u30a4\u30e9 - \u610f\u5473/\u5b9a\u7fa9 \uff1a IT\u7528\u8a9e\u8f9e\u5178](http://e-words.jp/w/JIT%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%A9.html)\n- [java memory structure heap permanent native | Google \u753b\u50cf\u691c\u7d22](https://www.google.co.jp/search?q=java+memory+structure+heap+permanent&espv=2&biw=1351&bih=967&source=lnms&tbm=isch&sa=X&ved=0ahUKEwiVyP2IgqvLAhVk5KYKHcGeABAQ_AUIBigB#tbm=isch&q=java+memory+structure+heap+permanent+native&imgrc=IKPN6q0BTUsMAM%3A)\n\n## OOME \u306e\u8abf\u67fb\u65b9\u6cd5\u306a\u3069\n- [Java\u30c8\u30e9\u30d6\u30eb\u306b\u5099\u3048\u3088\u3046 #jjug_ccc #ccc_h2](http://www.slideshare.net/agetsuma/java-34815905)\n- [\u307e\u3058\u3081\u306bJVM\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0: \u7b2c2\u56de GC\u30ed\u30b0\u3092\u307f\u308b](http://x1.inkenkun.com/archives/372)\n- [\u4eba\u751f\u697d\u3057\u307e\u306a\u304d\u3083\u3082\u3063\u305f\u3044\u306a\u3044\uff01: java\u306eOutOfMemory\u6642\u306e\u30d2\u30fc\u30d7\u306e\u5206\u6790\u306b\u30c1\u30e3\u30ec\u30f3\u30b8\uff08jhat\uff09](http://hayachi617.blogspot.jp/2014/02/javaoutofmemoryjhat.html)\n\n## \u30c4\u30fc\u30eb\u985e\n- [jcmd\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3](https://docs.oracle.com/javase/jp/8/docs/technotes/guides/troubleshoot/tooldescr006.html)\n- [jcmd](https://docs.oracle.com/javase/jp/8/docs/technotes/tools/windows/jcmd.html)\n- [jmap - \u30e1\u30e2\u30ea\u30fc\u30de\u30c3\u30d7](https://docs.oracle.com/javase/jp/6/technotes/tools/share/jmap.html)\n- [jstat](https://docs.oracle.com/javase/jp/8/docs/technotes/tools/windows/jstat.html)\n- [jvisualvm\u3092\u4f7f\u3063\u305fCPU\u30d7\u30ed\u30d5\u30a1\u30a4\u30ea\u30f3\u30b0 - Java\u3067\u753b\u50cf\u30d3\u30e5\u30fc\u30a2\u3092\u958b\u767a\u3057\u3066\u307f\u308b\u65e5\u8a18](http://d.hatena.ne.jp/jgb/20090228/1235828238)\n- [Profiling Vs. Sampling in Java's VisualVM](https://blog.idrsolutions.com/2014/04/profiling-vs-sampling-java-visualvm/)\n- [java - Difference between sampling and profiling in jVisualvm - Stack Overflow](http://stackoverflow.com/questions/12130107/difference-between-sampling-and-profiling-in-jvisualvm)\n- [HeapStats: Introduction and Technical Preview](http://www.slideshare.net/YujiKubota/heapstats)\n- [HeapStats/jp - IcedTea](http://icedtea.classpath.org/wiki/HeapStats/jp#HeapStats.E3.81.A8.E3.81.AF.3F)\n\n\n\n[1]: http://itpro.nikkeibp.co.jp/article/COLUMN/20060612/240657/?rt=nocnt\n[2]: http://cco.hatenablog.jp/entry/2014/12/01/162240\n[3]: http://www.amazon.co.jp/Java%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9-Scott-Oaks/dp/4873117186/ref=sr_1_1?ie=UTF8&qid=1457135672&sr=8-1&keywords=java+%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9\n", "tags": ["Java", "OutOfMemoryError", "JVM"]}