{"context": "BCP\u30b3\u30de\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066\u30d1\u6307\u5b9a\u3057\u305f\u30c6\u30fc\u30d6\u30eb\u3092CSV\u30d5\u30a1\u30a4\u30eb\u306b\u5410\u304d\u51fa\u3059\u30b9\u30c8\u30a2\u30c9\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u30fc\u306e\u4f5c\u308a\u65b9\u3067\u3059\u3002\n\u305f\u3060\u3057BCP\u30b3\u30de\u30f3\u30c9\u3067\u306f\u30d8\u30c3\u30c0\u30fc\u884c\u304c\u51fa\u529b\u3055\u308c\u306a\u3044\u306e\u3067\u3001SQL\u306b\u5de5\u592b\u3092\u3057\u3066\u3044\u307e\u3059\u3002\nBCP\u30b3\u30de\u30f3\u30c9\u306f\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u304b\u3089\u5b9f\u884c\u3067\u304d\u308b\u30b3\u30de\u30f3\u30c9\u3067\u3001\u3053\u308c\u3092\u5229\u7528\u3059\u308b\u306b\u306f\u5148\u306bxp_cmdshell\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\nxp_cmdshell\u30b5\u30fc\u30d0\u30fc\u69cb\u6210\u30aa\u30d7\u30b7\u30e7\u30f3\n-- To allow advanced options to be changed.  \nEXEC sp_configure 'show advanced options', 1;  \nGO  \n-- To update the currently configured value for advanced options.  \nRECONFIGURE;  \nGO  \n-- To enable the feature.  \nEXEC sp_configure 'xp_cmdshell', 1;  \nGO  \n-- To update the currently configured value for this feature.  \nRECONFIGURE;  \nGO  \n\n\n\u4ee5\u4e0b\u306e\u30b9\u30c8\u30a2\u30c9\u3092\u4f5c\u308a\u307e\u3059\u3002\n\nExportCSV\nUSE [HOGEHOGE]\nGO\n/****** Object:  StoredProcedure [dbo].[ExportCSV]    Script Date: 2016/08/25 17:18:11 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n-- =============================================\n-- Author:      <Author,,Name>\n-- Create date: <Create Date,,>\n-- Description: <Description,,>\n-- =============================================\nCREATE PROCEDURE [dbo].[ExportCSV]\n    -- Add the parameters for the stored procedure here\n    @TableName NVARCHAR(100),\n    @FilePath  NVARCHAR(255)\nAS\nBEGIN\n\n    SET NOCOUNT ON;\n    DECLARE @raw_sql nvarchar(4000)\n\n    DECLARE @columnHeader VARCHAR(8000)\n    SELECT @columnHeader = COALESCE(@columnHeader+',' ,'')+ ''''+column_name +'''' FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = @TableName\n\n\n    DECLARE @ColumnList VARCHAR(8000)\n    SELECT @ColumnList = COALESCE(@ColumnList+',' ,'')+ 'CAST(['+column_name +'] AS VARCHAR)' FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME =@TableName\n\n--  PRINT @ColumnList\n\n    SELECT @raw_sql = 'SELECT '+ @columnHeader +' UNION ALL SELECT ' + @ColumnList + ' FROM [' + @TableName +']'\n\n--  PRINT @raw_SQL\n--  EXECUTE sp_executesql  @raw_sql\n\n\n    DECLARE @sql VARCHAR(8000);\n    SELECT  @sql = 'bcp \"'+@raw_sql+ '\" queryout '+@FilePath +' -c -t, -T -S' + @@servername + ' -d '+DB_NAME() \n\n    EXEC master..xp_cmdshell @sql\n\nEND\n\n\n\n\u30b9\u30c8\u30a2\u30c9\u3092\u547c\u3073\u51fa\u3059\u3068CSV\u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n\n\u30b9\u30c8\u30a2\u30c9\u3092\u547c\u3073\u51fa\u3059\u3002\nEXEC dbo.ExportCSV '\u30c6\u30fc\u30d6\u30eb\u540d','c:\\tmp\\test.csv'\n\n\nBCP\u30b3\u30de\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066\u30d1\u6307\u5b9a\u3057\u305f\u30c6\u30fc\u30d6\u30eb\u3092CSV\u30d5\u30a1\u30a4\u30eb\u306b\u5410\u304d\u51fa\u3059\u30b9\u30c8\u30a2\u30c9\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u30fc\u306e\u4f5c\u308a\u65b9\u3067\u3059\u3002\n\u305f\u3060\u3057BCP\u30b3\u30de\u30f3\u30c9\u3067\u306f\u30d8\u30c3\u30c0\u30fc\u884c\u304c\u51fa\u529b\u3055\u308c\u306a\u3044\u306e\u3067\u3001SQL\u306b\u5de5\u592b\u3092\u3057\u3066\u3044\u307e\u3059\u3002\n\nBCP\u30b3\u30de\u30f3\u30c9\u306f\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u304b\u3089\u5b9f\u884c\u3067\u304d\u308b\u30b3\u30de\u30f3\u30c9\u3067\u3001\u3053\u308c\u3092\u5229\u7528\u3059\u308b\u306b\u306f\u5148\u306bxp_cmdshell\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```sql:xp_cmdshell\u30b5\u30fc\u30d0\u30fc\u69cb\u6210\u30aa\u30d7\u30b7\u30e7\u30f3\n-- To allow advanced options to be changed.  \nEXEC sp_configure 'show advanced options', 1;  \nGO  \n-- To update the currently configured value for advanced options.  \nRECONFIGURE;  \nGO  \n-- To enable the feature.  \nEXEC sp_configure 'xp_cmdshell', 1;  \nGO  \n-- To update the currently configured value for this feature.  \nRECONFIGURE;  \nGO  \n```\n\n\u4ee5\u4e0b\u306e\u30b9\u30c8\u30a2\u30c9\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n```sql:ExportCSV\nUSE [HOGEHOGE]\nGO\n/****** Object:  StoredProcedure [dbo].[ExportCSV]    Script Date: 2016/08/25 17:18:11 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n-- =============================================\n-- Author:\t\t<Author,,Name>\n-- Create date: <Create Date,,>\n-- Description:\t<Description,,>\n-- =============================================\nCREATE PROCEDURE [dbo].[ExportCSV]\n\t-- Add the parameters for the stored procedure here\n\t@TableName NVARCHAR(100),\n\t@FilePath  NVARCHAR(255)\nAS\nBEGIN\n\t\n\tSET NOCOUNT ON;\n\tDECLARE @raw_sql nvarchar(4000)\n\n\tDECLARE @columnHeader VARCHAR(8000)\n\tSELECT @columnHeader = COALESCE(@columnHeader+',' ,'')+ ''''+column_name +'''' FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = @TableName\n\n\n\tDECLARE @ColumnList VARCHAR(8000)\n\tSELECT @ColumnList = COALESCE(@ColumnList+',' ,'')+ 'CAST(['+column_name +'] AS VARCHAR)' FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME =@TableName\n\n--\tPRINT @ColumnList\n\n\tSELECT @raw_sql = 'SELECT '+ @columnHeader +' UNION ALL SELECT ' + @ColumnList + ' FROM [' + @TableName +']'\n\n--\tPRINT @raw_SQL\n--\tEXECUTE sp_executesql  @raw_sql\n\n\n\tDECLARE @sql VARCHAR(8000);\n\tSELECT  @sql = 'bcp \"'+@raw_sql+ '\" queryout '+@FilePath +' -c -t, -T -S' + @@servername + ' -d '+DB_NAME()\t\n\t\n\tEXEC master..xp_cmdshell @sql\n\t\nEND\n\n```\n\n\n\u30b9\u30c8\u30a2\u30c9\u3092\u547c\u3073\u51fa\u3059\u3068CSV\u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n\n```sql:\u30b9\u30c8\u30a2\u30c9\u3092\u547c\u3073\u51fa\u3059\u3002\nEXEC dbo.ExportCSV '\u30c6\u30fc\u30d6\u30eb\u540d','c:\\tmp\\test.csv'\n```\n\n\n", "tags": ["SQLServer"]}