{"context": " More than 1 year has passed since last update.\n\ndjango-floppyforms GeoDjango\n\nGeoDjango widgets\n\n$ pip install django-floppyforms\n\nINSTALLED_APPS += ('floppyforms', )\n\n\nmodes.py: Venue\nfrom django.contrib.gis.db import models\n\nclass Place(models.Model):\n    location = models.PointField(null=True, blank=True, default=None)\n    # ....\n\nclass Venue(Place):\n    # ....\n\nIn [2]: Venue.objects.get(id=4).location.geojson\nOut[2]: '{\"type\": \"Point\", \"coordinates\": [139.6968165369083, 35.65804003941925]}'\n\n\nviews.py\ndef detail(request, id):\n    venue = models.Venue.objects.get(id=id)\n\n    # \u8868\u793a\u3060\u3051\u3069\u3082floppyforms\u306e\u30d5\u30a9\u30fc\u30e0\u3092\u3064\u304f\u3063\u3066\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3059\u308b\n    form = forms.VenueForm(instance=venue)\n\n    return TemplateResponse(\n        request, 'maps/venue/detail.html',\n        dict(request=request, instance=venue, form=form, venue=venue,))\n\n\nforms.py\nimport floppyforms\n\n\nGoogle Map \u3092\u3064\u304b\u3063\u305fPoint\u30a6\u30a3\u30b8\u30a7\u30c3\u30c8\u5b9a\u7fa9\n\nclass GmapPointWidget(\n        floppyforms.gis.BaseGMapWidget,\n        floppyforms.gis.widgets.PointWidget):\n    template_name = 'guides/gmap.html'    # Gooogle Map\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\n\n\nVenue \u306e\u30d5\u30a9\u30fc\u30e0\n\nclass VenueForm(floppyforms.ModelForm):\n    class Meta:\n        model = models.Venue\n        exclude = []\n        widgets = {\n            'location': GmapPointWidget(attrs={\n                'map_width': 1000, 'map_height': 700,\n            }),\n        }\n\n\ngmap.html\n{% extends \"floppyforms/gis/openlayers.html\" %}\n{# http://django-floppyforms.readthedocs.org/en/latest/geodjango.html#javascript-library #}\n\n{% block options %}\n{{ block.super }}\n// \u3053\u3053\u3067Google Map\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3059\u308b\noptions['base_layer'] = new OpenLayers.Layer.Google(\n  \"Google Streets\", {numZoomLevels: 20, units: 'm'});\noptions['point_zoom'] = 20;\n{% endblock %}\n\n\nvenue/detail.html : \u5730\u56f3\u306e\u8868\u793a\n\n\u6570\u884c\u3067\u8868\u793a\u3055\u308c\u307e\u3059\n\n\nhead\u3067\u30a2\u30bb\u30c3\u30c8\u8aad\u307f\u8fbc\u307f\n{% block head_style%}{{ block.super}}\n<script src=\"{% static 'floppyforms/js/MapWidget.js' %}\"></script>\n{{ form.media }}      // \u5fc5\u9808\n{% endblock %}\n\n\n\u4ee5\u4e0b\u306e\u69d8\u306b\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3055\u308c\u307e\u3059\n\n<script src=\"/static/floppyforms/js/MapWidget.js\"></script>\n<script type=\"text/javascript\" src=\"/static/floppyforms/openlayers/OpenLayers.js\"></script>\n<script type=\"text/javascript\" src=\"/static/floppyforms/js/MapWidget.js\"></script>\n<script type=\"text/javascript\" src=\"https://maps.google.com/maps/api/js?v=3&amp;sensor=false\"></script>\n\n\n\u30de\u30c3\u30d7\u306e\u8868\u793a\n\n1\u884c\u3067\u3059\n\n{% block content %}\n  ....\n  {{ form.location }}\n{% endblock %}\n\n\n\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u7d50\u679c\n\n<style type=\"text/css\">\n    #id_location_map { width: 1000px; height: 700px; }\n    #id_location_map .aligned label { float: inherit; }\n    #id_location_span_map { position: relative; vertical-align: top; float: left; }\n    #id_location { display: none; }\n    .olControlEditingToolbar .olControlModifyFeatureItemActive {\n        background-image: url(\"/static/admin/img/gis/move_vertex_on.png\");\n        background-repeat: no-repeat;\n    }\n    .olControlEditingToolbar .olControlModifyFeatureItemInactive {\n        background-image: url(\"/static/admin/img/gis/move_vertex_off.png\");\n        background-repeat: no-repeat;\n    }\n</style>\n\n<span id=\"id_location_span_map\">\n    <div id=\"id_location_map\"></div>\n    <a href=\"javascript:map_location.clearFeatures()\">Delete all Features</a>\n\n    <textarea name=\"location\" rows=\"10\" map_width=\"1000\" map_height=\"700\" cols=\"40\" geom_type=\"POINT\" id=\"id_location\">POINT (15550978.4823299963027 4253669.654012895189226)</textarea>\n\n    <script type=\"text/javascript\">\n        var map_options = {};\n\nvar options = {\n            geom_type: OpenLayers.Geometry.Point,\n            id: 'id_location',\n            is_collection: false,\n            is_linestring: false,\n            is_point: true,\n            is_polygon: false,\n            map_id: 'id_location_map',\n            map_options: map_options,\n            map_srid: 3857,\n            name: 'location'\n        };\noptions['base_layer'] = new OpenLayers.Layer.Google(\n  \"Google Streets\", {numZoomLevels: 20, units: 'm'});\noptions['point_zoom'] = 20;\n\nvar map_location = new MapWidget(options);\n    </script>\n</span>\n\n\n\u30de\u30fc\u30ab\u30fc\u3092\u8ffd\u52a0\u3059\u308b\u306a\u3069\n\n\u751f\u6210\u3055\u308c\u305f map_location \u306b OpenLayers 2 Marker \u3067\u8ffd\u52a0\u3057\u307e\u3059\n\n{% block bottom_script %} {{ block.super }}\n<script>\n{# http://dev.openlayers.org/docs/files/OpenLayers/Marker-js.html #}\n\n// \u5ea7\u6a19\u7cfb\nvar EPSG_4236 = new OpenLayers.Projection(\"EPSG:4326\");\nvar EPSG_900913 = new OpenLayers.Projection(\"EPSG:900913\");\n\n// \u30de\u30fc\u30ab\u30fc\u30ec\u30a4\u30e4\nvar markers = new OpenLayers.Layer.Markers( \"Markers\" );\nmap_location.map.addLayer(markers);\n\n// \u30a2\u30a4\u30b3\u30f3\nvar size = new OpenLayers.Size(50,50);\nvar icon = new OpenLayers.Icon('/static/guides/plate7.512.png', size);\n\n// Google Map\u7528\u306b\u5909\u63db\u3057\u305f\u4f4d\u7f6e\u3092\u4f5c\u6210\nvar p = {{ instance.location.geojson|safe }};   // Venue.location \u306e\u4f4d\u7f6e\nvar pos = new OpenLayers.LonLat(\n    p.coordinates[0], p.coordinates[1]).transform(EPSG_4236, EPSG_900913);\n\n// \u30de\u30fc\u30ab\u30fc\nvar mark = new OpenLayers.Marker(pos, icon);\n\n// \u30de\u30fc\u30ab\u30fc\u8ffd\u52a0\nmarkers.addMarker(mark);\n\n</script>\n{% endblock %}\n\n\n\n## django-floppyforms GeoDjango\n\n- [GeoDjango widgets](http://django-floppyforms.readthedocs.org/en/latest/geodjango.html)\n\n~~~bash\n$ pip install django-floppyforms\n~~~\n\n~~~py\nINSTALLED_APPS += ('floppyforms', )\n~~~\n\n## modes.py: Venue\n\n~~~py\nfrom django.contrib.gis.db import models\n~~~\n\n~~~py\nclass Place(models.Model):\n    location = models.PointField(null=True, blank=True, default=None)\n    # ....\n\nclass Venue(Place):\n    # ....\n~~~\n\n~~~py\nIn [2]: Venue.objects.get(id=4).location.geojson\nOut[2]: '{\"type\": \"Point\", \"coordinates\": [139.6968165369083, 35.65804003941925]}'\n~~~\n\n## views.py\n\n~~~py\ndef detail(request, id):\n    venue = models.Venue.objects.get(id=id)\n\n    # \u8868\u793a\u3060\u3051\u3069\u3082floppyforms\u306e\u30d5\u30a9\u30fc\u30e0\u3092\u3064\u304f\u3063\u3066\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3059\u308b\n    form = forms.VenueForm(instance=venue)\n\n    return TemplateResponse(\n        request, 'maps/venue/detail.html',\n        dict(request=request, instance=venue, form=form, venue=venue,))\n~~~    \n\n## forms.py\n\n~~~py\nimport floppyforms\n~~~\n\n- Google Map \u3092\u3064\u304b\u3063\u305fPoint\u30a6\u30a3\u30b8\u30a7\u30c3\u30c8\u5b9a\u7fa9\n\n~~~py\nclass GmapPointWidget(\n        floppyforms.gis.BaseGMapWidget,\n        floppyforms.gis.widgets.PointWidget):\n    template_name = 'guides/gmap.html'    # Gooogle Map\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\n~~~\n\n- Venue \u306e\u30d5\u30a9\u30fc\u30e0\n\n~~~py\nclass VenueForm(floppyforms.ModelForm):\n    class Meta:\n        model = models.Venue\n        exclude = []\n        widgets = {\n            'location': GmapPointWidget(attrs={\n                'map_width': 1000, 'map_height': 700,\n            }),\n        }\n~~~~        \n\n## gmap.html\n\n~~~html\n{% extends \"floppyforms/gis/openlayers.html\" %}\n{# http://django-floppyforms.readthedocs.org/en/latest/geodjango.html#javascript-library #}\n\n{% block options %}\n{{ block.super }}\n// \u3053\u3053\u3067Google Map\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3059\u308b\noptions['base_layer'] = new OpenLayers.Layer.Google(\n  \"Google Streets\", {numZoomLevels: 20, units: 'm'});\noptions['point_zoom'] = 20;\n{% endblock %}\n~~~\n\n## venue/detail.html : \u5730\u56f3\u306e\u8868\u793a\n\n- \u6570\u884c\u3067\u8868\u793a\u3055\u308c\u307e\u3059\n\n### head\u3067\u30a2\u30bb\u30c3\u30c8\u8aad\u307f\u8fbc\u307f\n\n~~~html\n{% block head_style%}{{ block.super}}\n<script src=\"{% static 'floppyforms/js/MapWidget.js' %}\"></script>\n{{ form.media }}      // \u5fc5\u9808\n{% endblock %}\n~~~\n\n- \u4ee5\u4e0b\u306e\u69d8\u306b\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3055\u308c\u307e\u3059\n\n~~~html\n<script src=\"/static/floppyforms/js/MapWidget.js\"></script>\n<script type=\"text/javascript\" src=\"/static/floppyforms/openlayers/OpenLayers.js\"></script>\n<script type=\"text/javascript\" src=\"/static/floppyforms/js/MapWidget.js\"></script>\n<script type=\"text/javascript\" src=\"https://maps.google.com/maps/api/js?v=3&amp;sensor=false\"></script>\n~~~\n\n### \u30de\u30c3\u30d7\u306e\u8868\u793a\n\n- 1\u884c\u3067\u3059\n\n~~~html\n{% block content %}\n  ....\n  {{ form.location }}\n{% endblock %}\n~~~\n\n- \u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u7d50\u679c\n\n~~~html\n<style type=\"text/css\">\n\t#id_location_map { width: 1000px; height: 700px; }\n\t#id_location_map .aligned label { float: inherit; }\n\t#id_location_span_map { position: relative; vertical-align: top; float: left; }\n\t#id_location { display: none; }\n\t.olControlEditingToolbar .olControlModifyFeatureItemActive {\n\t\tbackground-image: url(\"/static/admin/img/gis/move_vertex_on.png\");\n\t\tbackground-repeat: no-repeat;\n\t}\n\t.olControlEditingToolbar .olControlModifyFeatureItemInactive {\n\t\tbackground-image: url(\"/static/admin/img/gis/move_vertex_off.png\");\n\t\tbackground-repeat: no-repeat;\n\t}\n</style>\n\n<span id=\"id_location_span_map\">\n\t<div id=\"id_location_map\"></div>\n\t<a href=\"javascript:map_location.clearFeatures()\">Delete all Features</a>\n\n\t<textarea name=\"location\" rows=\"10\" map_width=\"1000\" map_height=\"700\" cols=\"40\" geom_type=\"POINT\" id=\"id_location\">POINT (15550978.4823299963027 4253669.654012895189226)</textarea>\n\n\t<script type=\"text/javascript\">\n\t\tvar map_options = {};\n\nvar options = {\n\t\t\tgeom_type: OpenLayers.Geometry.Point,\n\t\t\tid: 'id_location',\n\t\t\tis_collection: false,\n\t\t\tis_linestring: false,\n\t\t\tis_point: true,\n\t\t\tis_polygon: false,\n\t\t\tmap_id: 'id_location_map',\n\t\t\tmap_options: map_options,\n\t\t\tmap_srid: 3857,\n\t\t\tname: 'location'\n\t\t};\noptions['base_layer'] = new OpenLayers.Layer.Google(\n  \"Google Streets\", {numZoomLevels: 20, units: 'm'});\noptions['point_zoom'] = 20;\n\nvar map_location = new MapWidget(options);\n\t</script>\n</span>\n~~~\n\n## \u30de\u30fc\u30ab\u30fc\u3092\u8ffd\u52a0\u3059\u308b\u306a\u3069\n\n- \u751f\u6210\u3055\u308c\u305f map_location \u306b [OpenLayers 2 Marker](http://dev.openlayers.org/docs/files/OpenLayers/Marker-js.html) \u3067\u8ffd\u52a0\u3057\u307e\u3059\n\n~~~html\n{% block bottom_script %} {{ block.super }}\n<script>\n{# http://dev.openlayers.org/docs/files/OpenLayers/Marker-js.html #}\n\n// \u5ea7\u6a19\u7cfb\nvar EPSG_4236 = new OpenLayers.Projection(\"EPSG:4326\");\nvar EPSG_900913 = new OpenLayers.Projection(\"EPSG:900913\");\n\n// \u30de\u30fc\u30ab\u30fc\u30ec\u30a4\u30e4\nvar markers = new OpenLayers.Layer.Markers( \"Markers\" );\nmap_location.map.addLayer(markers);\n\n// \u30a2\u30a4\u30b3\u30f3\nvar size = new OpenLayers.Size(50,50);\nvar icon = new OpenLayers.Icon('/static/guides/plate7.512.png', size);\n\n// Google Map\u7528\u306b\u5909\u63db\u3057\u305f\u4f4d\u7f6e\u3092\u4f5c\u6210\nvar p = {{ instance.location.geojson|safe }};   // Venue.location \u306e\u4f4d\u7f6e\nvar pos = new OpenLayers.LonLat(\n    p.coordinates[0], p.coordinates[1]).transform(EPSG_4236, EPSG_900913);\n\n// \u30de\u30fc\u30ab\u30fc\nvar mark = new OpenLayers.Marker(pos, icon);\n\n// \u30de\u30fc\u30ab\u30fc\u8ffd\u52a0\nmarkers.addMarker(mark);\n\n</script>\n{% endblock %}\n~~~\n\n![](https://raw.githubusercontent.com/hdknr/scriptogr.am/fcb11148fc517fdcb042efd8698e1c4a4b05a91b/django/geodjango/django-floppyforms.marker.png)\n", "tags": ["GeoDjango", "Django", "Openlayers"]}