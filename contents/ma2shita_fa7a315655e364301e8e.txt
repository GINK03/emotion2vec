{"context": " More than 1 year has passed since last update.Ruby\u3067RESTful\u306aAPI\u30b5\u30fc\u30d0\u3092\u4f5c\u308b\u306e\u306b\u5f79\u7acb\u3064Grape\u3067\u3059\u304c\u3001\u305c\u3072\u3068\u3082\u4e00\u7dd2\u306b\u4f7f\u3044\u305f\u3044\u306e\u304cGrape::Entity\u3067\u3059\nGrape::Entity\u306fView\u7684\u306a\u5f79\u5272\u3092\u679c\u305f\u3057\u3001DB\u306e\u5024\u3092present\u3059\u308b\u3060\u3051\u3067\u3001Entity\u3067\u6307\u5b9a\u3057\u305f\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u4f5c\u3063\u3066\u304f\u308c\u3001\u6700\u7d42\u7684\u306a\u51fa\u529b\u6574\u5f62\u3092Grape\u304c\u884c\u3063\u3066\u304f\u308c\u307e\u3059\n\u3053\u308c\u3067\u3001DB\u304b\u3089\u306e\u5024\u3092map\u7b49\u3092\u99c6\u4f7f\u3057\u3066Hash\u69cb\u9020\u3092\u4f5c\u308b...\u305d\u3093\u306a\u4eba\u751f\u3068\u306f\u6c7a\u5225\u3067\u3059\n\u65e5\u672c\u8a9e\u60c5\u5831\u304c\u5c11\u306a\u3044\u306e\u3067\u3059\u304c\u3001\u30b3\u30fc\u30c9\u30b5\u30f3\u30d7\u30eb\u3084spec\u304c\u5145\u5b9f\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u5b9f\u88c5\u3067\u56f0\u308b\u3053\u3068\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u4e00\u5bfe\u591a\u306a\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u8868\u73fe\u3059\u308b\u65b9\u6cd5\u304c\u4e4f\u3057\u304b\u3063\u305f\u306e\u3067\u3001\u30e1\u30e2\u4ee3\u308f\u308a\u306b\u6b8b\u3057\u3066\u304a\u304d\u307e\u3059\n\nRuby 2.1.5\nGrape 0.11.0\nGrape::Entity 0.4.4\n\n\n\u30c7\u30fc\u30bf\u69cb\u9020\nParent\u3068Children\u30c6\u30fc\u30d6\u30eb\u3092\u7528\u610f\u3001Parent/Child\u3068\u3044\u3046\u30e2\u30c7\u30eb\u540d\u3067\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\nParent:Child = 1:N \u3067\u3059\n\u203bORM\u306bSequel\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u304c\u3001ActiveRecord\u3067\u3082\u540c\u3058\u3067\u3059\n\n001_devel_collection.rb\nSequel.migration do\n  up do\n    create_table :children do\n      primary_key :id\n      Integer :parent_id\n      String  :name\n      String  :birth_day\n    end\n\n    create_table :parents do\n      primary_key :id\n      String :name\n      String :addr\n    end\n  end\n\n  down do\n    drop_table :children\n    drop_table :parents\n  end\nend\n\n\n\napp/models/child.rb\nclass Child < Sequel::Model\n  many_to_one :parent\nend\n\n\n\napp/models/parent.rb\nclass Parent < Sequel::Model\n  one_to_many :child\nend\n\n\n\nAPI\u5b9f\u88c5\nGrape\u81ea\u4f53\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7b49\u306fconfig.ru\u306b\u3064\u3044\u3066\u306f\u5272\u611b\n\napi.rb\nmodule API::Entities\n  class Child < Grape::Entity\n    expose :name, as: \"name\"\n    # birth_day column in DB does not expose (hide)\n  end\n\n  class Parent < Grape::Entity\n    expose :name,  as: \"parent_name\"\n    expose :addr\n    expose :child, as: \"children\", using: API::Entities::Child\n  end\nend\n\nclass MyAPI < Grape::API\n  prefix \"/api\"\n  format :json\n  desc \"Testing collection expose w/ grape-entity\"\n  get \"/collection/:name\" do\n    pt = Parent.find(name: params[:name])\n    present pt, with: API::Entities::Parent\n  end\nend\n\n\n\u3053\u308c\u3067\u3001\u4e0b\u8a18\u306e\u901a\u308achildren\u3068\u3044\u3046Hash key\u306e\u4e0b\u306b\u914d\u5217\u3067child\u304c\u4e26\u3073\u307e\u3059\n$ curl http://localhost:9292/api/collection/pname1\n{\"parent_name\":\"pname1\",\"addr\":\"Streat Name\",\"children\":[{\"name\":\"c1\"},{\"name\":\"c2\"}]}\n\n\nRSpec\ncurl\u3067\u30c6\u30b9\u30c8\u3059\u308b\u306e\u306f\u5fcd\u3073\u306a\u3044\u306e\u3067\u3001RSpec\u3082\u7f6e\u3044\u3066\u304a\u304d\u307e\u3059\nspec/spec_helper.rb\u306f\u5272\u611b\u3057\u307e\u3059\u304c\u3001\u3053\u306e\u3042\u305f\u308a\u306egem\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\nrequire \"rack/test\"\nrequire \"rspec/its\"\nrequire \"rspec/json_matcher\"\nRSpec.configuration.include RSpec::JsonMatcher\nrequire \"json\"\nrequire \"database_cleaner\"\n\n\nspec/api_spec.rb\nrequire \"spec_helper\"\n\ndescribe MyAPI do\n  include Rack::Test::Methods\n  def app ; described_class ; end\n\n  before {\n    p1 = Parent.create(name: \"pname1\", addr: \"Streat Name\")\n    p1.add_child(name: \"c1\")\n    p1.add_child(name: \"c2\")\n    Parent.create(name: \"p2\")\n  }\n\n  context \"get\" do\n    subject { get \"/api/collection/pname1\" }\n    let(:result) do\n      {\n        parent_name: \"pname1\",\n        addr:        \"Streat Name\",\n        children:    [\n                       {name: \"c1\"},\n                       {name: \"c2\"}\n                     ]\n      }\n    end\n    its(:body) { should be_json_as result }\n  end\nend\n\n\n\n\u307e\u3068\u3081\n\u5b9f\u88c5\u30b3\u30fc\u30c9\u304c\u3001\u305f\u3063\u305f2\u884c\u3068\u3044\u3046\u3068\u3053\u308d\u304c\u975e\u5e38\u306b\u3088\u308d\u3057\u3044\u3067\u3059\n    pt = Parent.find(name: params[:name])\n    present pt, with: API::Entities::Parent\n\n\u307e\u305f\u3001DB\u306b\u306fchildren.birth_day\u3068\u3044\u3046\u30ab\u30e9\u30e0\u3092\u4f5c\u6210\u3057\u3066\u3044\u307e\u3059\u304c\u3001API::Entities::Child\u3067\u306fexpose\u306e\u6307\u5b9a\u3092\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u51fa\u529b\u3092\u96a0\u3059\u3053\u3068\u306b\u6210\u529f\u3057\u3066\u3044\u307e\u3059\nDB\u304b\u3089\u306f\u53d6\u5f97\u3055\u308c\u3066\u3057\u307e\u3063\u3066\u3044\u308b\u306e\u3067\u901a\u4fe1\u91cf\u3067\u306f\u4e0d\u5229\u3067\u3059\u304c\u3001\u5ba3\u8a00\u7684\u306b\u30b3\u30fc\u30c9\u304c\u66f8\u3051\u308b\u305f\u3081\u4fdd\u5b88\u6027\u306f\u6975\u3081\u3066\u9ad8\u3044\u306e\u3067\u306f\u306a\u3044\u3067\u3057\u3087\u3046\u304b\nRuby\u3067RESTful\u306aAPI\u30b5\u30fc\u30d0\u3092\u4f5c\u308b\u306e\u306b\u5f79\u7acb\u3064[Grape](https://github.com/intridea/grape)\u3067\u3059\u304c\u3001\u305c\u3072\u3068\u3082\u4e00\u7dd2\u306b\u4f7f\u3044\u305f\u3044\u306e\u304c[Grape::Entity](https://github.com/intridea/grape-entity)\u3067\u3059\n\n[Grape::Entity](https://github.com/intridea/grape-entity)\u306fView\u7684\u306a\u5f79\u5272\u3092\u679c\u305f\u3057\u3001DB\u306e\u5024\u3092`present`\u3059\u308b\u3060\u3051\u3067\u3001Entity\u3067\u6307\u5b9a\u3057\u305f\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u4f5c\u3063\u3066\u304f\u308c\u3001\u6700\u7d42\u7684\u306a\u51fa\u529b\u6574\u5f62\u3092[Grape](https://github.com/intridea/grape)\u304c\u884c\u3063\u3066\u304f\u308c\u307e\u3059\n\n\u3053\u308c\u3067\u3001DB\u304b\u3089\u306e\u5024\u3092map\u7b49\u3092\u99c6\u4f7f\u3057\u3066Hash\u69cb\u9020\u3092\u4f5c\u308b...\u305d\u3093\u306a\u4eba\u751f\u3068\u306f\u6c7a\u5225\u3067\u3059\n\n\u65e5\u672c\u8a9e\u60c5\u5831\u304c\u5c11\u306a\u3044\u306e\u3067\u3059\u304c\u3001\u30b3\u30fc\u30c9\u30b5\u30f3\u30d7\u30eb\u3084spec\u304c\u5145\u5b9f\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u5b9f\u88c5\u3067\u56f0\u308b\u3053\u3068\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u4e00\u5bfe\u591a\u306a\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u8868\u73fe\u3059\u308b\u65b9\u6cd5\u304c\u4e4f\u3057\u304b\u3063\u305f\u306e\u3067\u3001\u30e1\u30e2\u4ee3\u308f\u308a\u306b\u6b8b\u3057\u3066\u304a\u304d\u307e\u3059\n\n- Ruby 2.1.5\n- Grape 0.11.0\n- Grape::Entity 0.4.4\n\n\u30c7\u30fc\u30bf\u69cb\u9020\n----------\n\nParent\u3068Children\u30c6\u30fc\u30d6\u30eb\u3092\u7528\u610f\u3001Parent/Child\u3068\u3044\u3046\u30e2\u30c7\u30eb\u540d\u3067\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\nParent:Child = 1:N \u3067\u3059\n\n\u203bORM\u306b[Sequel](http://sequel.jeremyevans.net/)\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u304c\u3001ActiveRecord\u3067\u3082\u540c\u3058\u3067\u3059\n\n```rb:001_devel_collection.rb\nSequel.migration do\n  up do\n    create_table :children do\n      primary_key :id\n      Integer :parent_id\n      String  :name\n      String  :birth_day\n    end\n\n    create_table :parents do\n      primary_key :id\n      String :name\n      String :addr\n    end\n  end\n\n  down do\n    drop_table :children\n    drop_table :parents\n  end\nend\n```\n\n```rb:app/models/child.rb \nclass Child < Sequel::Model\n  many_to_one :parent\nend\n```\n\n```rb:app/models/parent.rb \nclass Parent < Sequel::Model\n  one_to_many :child\nend\n```\n\nAPI\u5b9f\u88c5\n-------\n\nGrape\u81ea\u4f53\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7b49\u306fconfig.ru\u306b\u3064\u3044\u3066\u306f\u5272\u611b\n\n```rb:api.rb\nmodule API::Entities\n  class Child < Grape::Entity\n    expose :name, as: \"name\"\n    # birth_day column in DB does not expose (hide)\n  end\n\n  class Parent < Grape::Entity\n    expose :name,  as: \"parent_name\"\n    expose :addr\n    expose :child, as: \"children\", using: API::Entities::Child\n  end\nend\n\nclass MyAPI < Grape::API\n  prefix \"/api\"\n  format :json\n  desc \"Testing collection expose w/ grape-entity\"\n  get \"/collection/:name\" do\n    pt = Parent.find(name: params[:name])\n    present pt, with: API::Entities::Parent\n  end\nend\n```\n\n\u3053\u308c\u3067\u3001\u4e0b\u8a18\u306e\u901a\u308a`children`\u3068\u3044\u3046Hash key\u306e\u4e0b\u306b\u914d\u5217\u3067child\u304c\u4e26\u3073\u307e\u3059\n\n```console\n$ curl http://localhost:9292/api/collection/pname1\n{\"parent_name\":\"pname1\",\"addr\":\"Streat Name\",\"children\":[{\"name\":\"c1\"},{\"name\":\"c2\"}]}\n```\n\nRSpec\n-----\n\ncurl\u3067\u30c6\u30b9\u30c8\u3059\u308b\u306e\u306f\u5fcd\u3073\u306a\u3044\u306e\u3067\u3001RSpec\u3082\u7f6e\u3044\u3066\u304a\u304d\u307e\u3059\n\n`spec/spec_helper.rb`\u306f\u5272\u611b\u3057\u307e\u3059\u304c\u3001\u3053\u306e\u3042\u305f\u308a\u306egem\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\n\n```rb\nrequire \"rack/test\"\nrequire \"rspec/its\"\nrequire \"rspec/json_matcher\"\nRSpec.configuration.include RSpec::JsonMatcher\nrequire \"json\"\nrequire \"database_cleaner\"\n```\n\n```rb:spec/api_spec.rb\nrequire \"spec_helper\"\n\ndescribe MyAPI do\n  include Rack::Test::Methods\n  def app ; described_class ; end\n\n  before {\n    p1 = Parent.create(name: \"pname1\", addr: \"Streat Name\")\n    p1.add_child(name: \"c1\")\n    p1.add_child(name: \"c2\")\n    Parent.create(name: \"p2\")\n  }\n\n  context \"get\" do\n    subject { get \"/api/collection/pname1\" }\n    let(:result) do\n      {\n        parent_name: \"pname1\",\n        addr:        \"Streat Name\",\n        children:    [\n                       {name: \"c1\"},\n                       {name: \"c2\"}\n                     ]\n      }\n    end\n    its(:body) { should be_json_as result }\n  end\nend\n```\n\n\n\n\u307e\u3068\u3081\n------\n\n\u5b9f\u88c5\u30b3\u30fc\u30c9\u304c\u3001\u305f\u3063\u305f2\u884c\u3068\u3044\u3046\u3068\u3053\u308d\u304c\u975e\u5e38\u306b\u3088\u308d\u3057\u3044\u3067\u3059\n\n```rb\n    pt = Parent.find(name: params[:name])\n    present pt, with: API::Entities::Parent\n```\n\n\n\u307e\u305f\u3001DB\u306b\u306f`children.birth_day`\u3068\u3044\u3046\u30ab\u30e9\u30e0\u3092\u4f5c\u6210\u3057\u3066\u3044\u307e\u3059\u304c\u3001`API::Entities::Child`\u3067\u306fexpose\u306e\u6307\u5b9a\u3092\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u51fa\u529b\u3092\u96a0\u3059\u3053\u3068\u306b\u6210\u529f\u3057\u3066\u3044\u307e\u3059\n\nDB\u304b\u3089\u306f\u53d6\u5f97\u3055\u308c\u3066\u3057\u307e\u3063\u3066\u3044\u308b\u306e\u3067\u901a\u4fe1\u91cf\u3067\u306f\u4e0d\u5229\u3067\u3059\u304c\u3001\u5ba3\u8a00\u7684\u306b\u30b3\u30fc\u30c9\u304c\u66f8\u3051\u308b\u305f\u3081\u4fdd\u5b88\u6027\u306f\u6975\u3081\u3066\u9ad8\u3044\u306e\u3067\u306f\u306a\u3044\u3067\u3057\u3087\u3046\u304b\n", "tags": ["grape0.11.0", "grape-entity0.4.4", "Ruby2.1.5"]}