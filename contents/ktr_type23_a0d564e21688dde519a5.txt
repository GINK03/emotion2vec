{"context": " More than 1 year has passed since last update.\n\n\u30d3\u30eb\u30c9\u30d5\u30a1\u30a4\u30eb\nscalatest\u306f\u5fc5\u9808\u3067\u306f\u306a\u3044\u304c\u3001Matchers\u3092\u4f7f\u3044\u305f\u304b\u3063\u305f\u306e\u3067\u8ffd\u52a0\u3057\u3066\u3044\u308b\u3002\nassertThat(\"result\", is(\"expected\") \u3067\u306f\u306a\u304f\u3001 \"result\" should be(\"expected\") \u307f\u305f\u3044\u306b\u8a55\u4fa1\u3057\u305f\u304b\u3063\u305f\u3002\n\nbuild.sbt\nlibraryDependencies ++= Seq(\n  \"org.scalatest\" % \"scalatest_2.11\" % \"2.2.4\" % \"test\",\n  \"org.apache.camel\" % \"camel-testng\" % \"2.15.0\" % \"test\"\n)\n\n\n\npom.xml\n    <dependency>\n      <groupId>org.apache.camel</groupId>\n      <artifactId>camel-test</artifactId>\n      <version>2.15.0</version>\n      <scope>test</scope>\n    </dependency>\n    <dependency>\n      <groupId>org.scalatest</groupId>\n      <artifactId>scalatest_2.11</artifactId>\n      <version>2.2.4</version>\n      <scope>test</scope>\n    </dependency>\n\n\n\nSample\n\u6050\u3089\u304f\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3092\u898b\u308c\u3070\u3001\u3084\u308a\u305f\u3044\u3053\u3068\u306e\u307b\u3068\u3093\u3069\u304c\u89e3\u6c7a\u51fa\u6765\u3066\u3057\u307e\u3046\u304b\u3082\u3002\n\u30b5\u30f3\u30d7\u30eb\u306f\u305b\u3063\u304b\u304f\u306a\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u70b9\u3092\u5de5\u592b\u3057\u3066\u307f\u305f\u3002\n\nproperties\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3093\u3067\u30c6\u30b9\u30c8\u3002\nExchange\u306e\u5024\u3092\u8a55\u4fa1\u51fa\u6765\u308b\u3088\u3046\u306b\u3059\u308b\u3002(\u8a73\u7d30\u306f\u5f8c\u8ff0\u306eTips\u53c2\u7167)\n\n\ncamel-test\u304c\u63d0\u4f9b\u3059\u308b\u65e2\u5b58\u306eorg.apache.camel.test.junit4.CamelTestSupport\u3067\u306f\u3001Route\u901a\u904e\u5f8c\u306eExchange\u306e\u72b6\u614b\u3092\u53d6\u5f97\u51fa\u6765\u306a\u3044\u305f\u3081\u8a55\u4fa1\u304c\u51fa\u6765\u306a\u3044\u3002\n\n\n\n\u3053\u308c\u3067\u4e00\u6c17\u306b\u30c6\u30b9\u30c8\u306e\u5e45\u304c\u5e83\u304c\u308b\u306f\u305a\u3002\n(RouteBuilder\u5185\u306eMock\u5316\u3084\u5206\u5c90\u306b\u3064\u3044\u3066\u306f\u3001\u660e\u78ba\u306a\u7b54\u3048\u304c\u898b\u3064\u304b\u3063\u3066\u306a\u3044\u306e\u3067\u5f8c\u8ff0\u306eTips\u3067\u7d39\u4ecb\u3002)\n\nPropertiesRouteBuilderTest.scala\npackage jp.den3umegumi.experimental.camel.route\n\nimport org.apache.camel.CamelContext\nimport org.apache.camel.builder.RouteBuilder\nimport org.apache.camel.component.properties.PropertiesComponent\nimport org.apache.camel.impl.DefaultCamelContext\nimport org.apache.camel.scala.dsl.builder.{RouteBuilderSupport, ScalaRouteBuilder}\nimport org.junit.Test\n\nclass PropertiesRouteBuilderTest  extends CamelTestSupportExtension with RouteBuilderSupport {\n\n  override def createRouteBuilder: RouteBuilder = new ScalaRouteBuilder(context = new DefaultCamelContext) {\n    \"direct:property-read-route\" ==> {\n      setHeader(\"h_foo\", simple(\"properties:foo\"))\n      // javaDSL \u306b\u306f BuilderSupport#simple(String value, Class<?> resultType)\u304c\u3042\u308a\n      // \u623b\u308a\u5024\u3092\u6307\u5b9a\u3067\u304d\u308b\u304cscala\u306f\u4e0d\u53ef\n      setHeader(\"h_num\", simple(\"properties:num\"))\n      setHeader(\"h_num\", _.in(\"h_num\").asInstanceOf[String].toInt)\n    }\n  }\n\n  override protected def createCamelContext: CamelContext = {\n    val context = super.createCamelContext()\n    context.addComponent(\"properties\", new PropertiesComponent(\"classpath:jp/den3umegumi/experimental/camel/route/PropertiesRouteBuilderTest.properties\"))\n    context\n  }\n\n  @Test\n  def propertyRead = {\n    // \u4e0b\u8a18\u306eTips\u3092\u53c2\u7167\n    val in = sendBodyWithReceiveExchange(\"direct:property-read-route\", \"\").getIn\n    in.getHeader(\"h_foo\") should be(\"bar\")\n    in.getHeader(\"h_num\") should be(1234)\n  }\n}\n\n\n\ndef createRouteBuilder: RouteBuilder\n\u30c6\u30b9\u30c8\u5bfe\u8c61\u306eRouteBuilder\u3092\u751f\u6210\u3059\u308b\u95a2\u6570\u3002\n\u4eca\u56de\u306f\u30c6\u30b9\u30c8\u306eRouteBuilder\u3092\u30c6\u30b9\u30c8\u30af\u30e9\u30b9\u5185\u3067\u5b9a\u7fa9&\u751f\u6210\u3002\n\u3053\u3046\u3059\u308b\u3053\u3068\u3067\u5b9f\u9a13\u30b3\u30fc\u30c9\u3068\u52d5\u4f5c\u30b3\u30fc\u30c9\u304c1\u30af\u30e9\u30b9\u5185\u3067\u7c21\u5358\u306b\u8a18\u8ff0\u51fa\u6765\u308b\u3002\n\u6050\u3089\u304f\u901a\u5e38\u306e\u4f7f\u3044\u65b9\u306f\u4f5c\u6210\u3057\u305fRouteBuilder\u3092new\u3059\u308b\u3002\n  override def createRouteBuilder: RouteBuilder = new ScalaRouteBuilder(context = new DefaultCamelContext) {\n    \"direct:property-read-route\" ==> {\n      setHeader(\"h_foo\", simple(\"properties:foo\"))\n      // java \u306b\u306f BuilderSupport#simple(String value, Class<?> resultType)\u304c\u3042\u308a\n      // \u623b\u308a\u5024\u3092\u6307\u5b9a\u3067\u304d\u308b\u304cscala\u306f\u4e0d\u53ef\n      setHeader(\"h_num\", simple(\"properties:num\"))\n      setHeader(\"h_num\", _.in(\"h_num\").asInstanceOf[String].toInt)\n    }\n  }\n\n\nproperty\u30d5\u30a1\u30a4\u30eb\u8aad\u307f\u8fbc\u307f\ncreateCamelContext \u3092overrirde\u3057\u3066\u751f\u6210\u3057\u305fCamelContext\u306bPropertyComponent\u3092add\u3059\u308b\u3002\n  override protected def createCamelContext: CamelContext = {\n    val context = super.createCamelContext()\n    context.addComponent(\"properties\", new PropertiesComponent(\"classpath:jp/den3umegumi/experimental/camel/route/PropertiesRouteBuilderTest.properties\"))\n    context\n  }\n\n\nTips\n\nRouteBuilder\u901a\u904e\u5f8c\u306eExchange\u306e\u5024\u3092\u8a55\u4fa1\u3059\u308b\n\u30b5\u30f3\u30d7\u30eb\u3067\u306fBody\u3057\u304b\u9001\u4fe1\u51fa\u6765\u306a\u3044\u304c\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066Header\u3092\u9001\u4fe1\u3059\u308b\u62e1\u5f35Method\u3082\u4f5c\u6210\u3059\u308b\u3002\n\nCamelTestSupportExtension.scala\npackage jp.den3umegumi.experimental.camel.route\n\nimport org.apache.camel.test.junit4.CamelTestSupport\nimport org.apache.camel.{Exchange, Processor}\nimport org.scalatest.Matchers\n\nclass CamelTestSupportExtension extends CamelTestSupport with Matchers {\n\n  def sendBodyWithReceiveExchange(endpointUri: String, body: Any): Exchange = template.send(endpointUri, new Processor {\n    def process(exchange: Exchange) {\n      val in = exchange.getIn\n      in.setBody(body)\n    }\n  })\n}\n\n\n\nmock\u5316\n\u73fe\u5728\u306ecamel\u3067\u306fRoute\u306e\u4e00\u90e8\u3092mock\u5316\u3059\u308b\u3053\u3068\u306f\u51fa\u6765\u306a\u3044\u3002\n\u305d\u306e\u305f\u3081DB\u30a2\u30af\u30bb\u30b9\u3084\u5916\u90e8\u901a\u4fe1\u3092\u884c\u3046\u7b87\u6240\u306a\u3069\u306f\u95a2\u6570\u5207\u308a\u51fa\u3057\u3092\u3057\u3066\u3001\u5bfe\u8c61\u30af\u30e9\u30b9\u3092\u7d99\u627f\u3057\u305f\u30af\u30e9\u30b9\u3092\u5b9a\u7fa9\u3059\u308b\u306e\u304c\u826f\u3055\u305d\u3046\u3002\n\u5f31\u70b9\u306f1\u3064\u306e\u30c6\u30b9\u30c8\u30af\u30e9\u30b9\u5185\u306b\u8907\u6570\u306e\u30b1\u30fc\u30b9\u304c\u8a18\u8ff0\u3057\u3065\u3089\u3044\u3002\n\noverride\u3057\u305f\u95a2\u6570\u306e\u4e2d\u3067\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3067\u8a2d\u5b9a\u3055\u308c\u305fHeader\u3092\u5224\u65ad\u3059\u308b\u3002(Property\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u3063\u305f\u308a)\n1\u30af\u30e9\u30b91\u30b1\u30fc\u30b9\u3067\u8a18\u8ff0\u3059\u308b\u3002\n\n\u3068\u3044\u3046\u3088\u3046\u306a\u5bfe\u7b56\u304c\u8003\u3048\u3089\u308c\u308b\u3051\u3069\u3001\u3069\u3063\u3061\u3082\u53ef\u8aad\u6027\u60aa\u305d\u3046\u3002\n\u4f8b\n\nMockRouteBuilder.scala\npackage jp.den3umegumi.experimental.camel.route\n\nimport org.apache.camel.CamelContext\nimport org.apache.camel.impl.DefaultCamelContext\nimport org.apache.camel.scala.dsl.builder.ScalaRouteBuilder\n\nclass MockRouteBuilder(context: CamelContext = new DefaultCamelContext) extends ScalaRouteBuilder(context: CamelContext) {\n\n  private[route] def callAPI = {\n    // \u306a\u3093\u304b\u5916\u90e8\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u308a\n    -->(\"mock:callAPI\")\n    setHeader(\"result\", \"foo\")\n  }\n\n  \"direct:mockroutebuilder\" ==> {\n    callAPI\n    choice {\n      when (_.in(\"result\") == \"foo\") -->(\"mock:foo\")\n      otherwise -->(\"mock:not-foo\")\n    }\n    -->(\"mock:mockroutebuilder-end\")\n  }\n}\n\n\n\nMockRouteBuilderTest.scala\npackage jp.den3umegumi.experimental.camel.route\n\nimport org.apache.camel.builder.RouteBuilder\nimport org.apache.camel.impl.DefaultCamelContext\nimport org.apache.camel.scala.dsl.builder.RouteBuilderSupport\nimport org.apache.camel.test.junit4.CamelTestSupport\nimport org.junit.Test\nimport org.scalatest.Matchers\n\nclass MockRouteBuilderTest extends CamelTestSupport with Matchers with RouteBuilderSupport {\n\n  override def createRouteBuilder: RouteBuilder = new MockRouteBuilder(context = new DefaultCamelContext) {\n    override def callAPI = {\n      -->(\"mock:mock-callAPI\")\n      setHeader(\"result\", \"bar\")\n    }\n  }\n\n  @Test\n  def resultNotFoo = {\n    getMockEndpoint(\"mock:callAPI\").expectedMessageCount(0)\n    getMockEndpoint(\"mock:mock-callAPI\").expectedMessageCount(1)\n    getMockEndpoint(\"mock:foo\").expectedMessageCount(0)\n    getMockEndpoint(\"mock:not-foo\").expectedMessageCount(1)\n    template.sendBody(\"direct:mockroutebuilder\", \"\")\n    assertMockEndpointsSatisfied\n  }\n}\n\n\n\n# \u30d3\u30eb\u30c9\u30d5\u30a1\u30a4\u30eb\nscalatest\u306f\u5fc5\u9808\u3067\u306f\u306a\u3044\u304c\u3001Matchers\u3092\u4f7f\u3044\u305f\u304b\u3063\u305f\u306e\u3067\u8ffd\u52a0\u3057\u3066\u3044\u308b\u3002\n``` assertThat(\"result\", is(\"expected\")``` \u3067\u306f\u306a\u304f\u3001 ```\"result\" should be(\"expected\")``` \u307f\u305f\u3044\u306b\u8a55\u4fa1\u3057\u305f\u304b\u3063\u305f\u3002\n\n``` build.sbt\nlibraryDependencies ++= Seq(\n  \"org.scalatest\" % \"scalatest_2.11\" % \"2.2.4\" % \"test\",\n  \"org.apache.camel\" % \"camel-testng\" % \"2.15.0\" % \"test\"\n)\n```\n\n``` pom.xml\n    <dependency>\n      <groupId>org.apache.camel</groupId>\n      <artifactId>camel-test</artifactId>\n      <version>2.15.0</version>\n      <scope>test</scope>\n    </dependency>\n    <dependency>\n      <groupId>org.scalatest</groupId>\n      <artifactId>scalatest_2.11</artifactId>\n      <version>2.2.4</version>\n      <scope>test</scope>\n    </dependency>\n```\n\n# Sample\n\n\u6050\u3089\u304f\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3092\u898b\u308c\u3070\u3001\u3084\u308a\u305f\u3044\u3053\u3068\u306e\u307b\u3068\u3093\u3069\u304c\u89e3\u6c7a\u51fa\u6765\u3066\u3057\u307e\u3046\u304b\u3082\u3002\n\n\u30b5\u30f3\u30d7\u30eb\u306f\u305b\u3063\u304b\u304f\u306a\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u70b9\u3092\u5de5\u592b\u3057\u3066\u307f\u305f\u3002\n\n1. properties\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3093\u3067\u30c6\u30b9\u30c8\u3002\n1. Exchange\u306e\u5024\u3092\u8a55\u4fa1\u51fa\u6765\u308b\u3088\u3046\u306b\u3059\u308b\u3002(\u8a73\u7d30\u306f\u5f8c\u8ff0\u306eTips\u53c2\u7167)\n  - camel-test\u304c\u63d0\u4f9b\u3059\u308b\u65e2\u5b58\u306e```org.apache.camel.test.junit4.CamelTestSupport```\u3067\u306f\u3001Route\u901a\u904e\u5f8c\u306eExchange\u306e\u72b6\u614b\u3092\u53d6\u5f97\u51fa\u6765\u306a\u3044\u305f\u3081\u8a55\u4fa1\u304c\u51fa\u6765\u306a\u3044\u3002\n\n\u3053\u308c\u3067\u4e00\u6c17\u306b\u30c6\u30b9\u30c8\u306e\u5e45\u304c\u5e83\u304c\u308b\u306f\u305a\u3002\n(RouteBuilder\u5185\u306eMock\u5316\u3084\u5206\u5c90\u306b\u3064\u3044\u3066\u306f\u3001\u660e\u78ba\u306a\u7b54\u3048\u304c\u898b\u3064\u304b\u3063\u3066\u306a\u3044\u306e\u3067\u5f8c\u8ff0\u306eTips\u3067\u7d39\u4ecb\u3002)\n\n```PropertiesRouteBuilderTest.scala\npackage jp.den3umegumi.experimental.camel.route\n\nimport org.apache.camel.CamelContext\nimport org.apache.camel.builder.RouteBuilder\nimport org.apache.camel.component.properties.PropertiesComponent\nimport org.apache.camel.impl.DefaultCamelContext\nimport org.apache.camel.scala.dsl.builder.{RouteBuilderSupport, ScalaRouteBuilder}\nimport org.junit.Test\n\nclass PropertiesRouteBuilderTest  extends CamelTestSupportExtension with RouteBuilderSupport {\n\n  override def createRouteBuilder: RouteBuilder = new ScalaRouteBuilder(context = new DefaultCamelContext) {\n    \"direct:property-read-route\" ==> {\n      setHeader(\"h_foo\", simple(\"properties:foo\"))\n      // javaDSL \u306b\u306f BuilderSupport#simple(String value, Class<?> resultType)\u304c\u3042\u308a\n      // \u623b\u308a\u5024\u3092\u6307\u5b9a\u3067\u304d\u308b\u304cscala\u306f\u4e0d\u53ef\n      setHeader(\"h_num\", simple(\"properties:num\"))\n      setHeader(\"h_num\", _.in(\"h_num\").asInstanceOf[String].toInt)\n    }\n  }\n\n  override protected def createCamelContext: CamelContext = {\n    val context = super.createCamelContext()\n    context.addComponent(\"properties\", new PropertiesComponent(\"classpath:jp/den3umegumi/experimental/camel/route/PropertiesRouteBuilderTest.properties\"))\n    context\n  }\n\n  @Test\n  def propertyRead = {\n    // \u4e0b\u8a18\u306eTips\u3092\u53c2\u7167\n    val in = sendBodyWithReceiveExchange(\"direct:property-read-route\", \"\").getIn\n    in.getHeader(\"h_foo\") should be(\"bar\")\n    in.getHeader(\"h_num\") should be(1234)\n  }\n}\n```\n\n## def createRouteBuilder: RouteBuilder\n\n\u30c6\u30b9\u30c8\u5bfe\u8c61\u306eRouteBuilder\u3092\u751f\u6210\u3059\u308b\u95a2\u6570\u3002\n\u4eca\u56de\u306f\u30c6\u30b9\u30c8\u306eRouteBuilder\u3092\u30c6\u30b9\u30c8\u30af\u30e9\u30b9\u5185\u3067\u5b9a\u7fa9&\u751f\u6210\u3002\n\u3053\u3046\u3059\u308b\u3053\u3068\u3067\u5b9f\u9a13\u30b3\u30fc\u30c9\u3068\u52d5\u4f5c\u30b3\u30fc\u30c9\u304c1\u30af\u30e9\u30b9\u5185\u3067\u7c21\u5358\u306b\u8a18\u8ff0\u51fa\u6765\u308b\u3002\n\u6050\u3089\u304f\u901a\u5e38\u306e\u4f7f\u3044\u65b9\u306f\u4f5c\u6210\u3057\u305fRouteBuilder\u3092new\u3059\u308b\u3002\n\n```scala\n  override def createRouteBuilder: RouteBuilder = new ScalaRouteBuilder(context = new DefaultCamelContext) {\n    \"direct:property-read-route\" ==> {\n      setHeader(\"h_foo\", simple(\"properties:foo\"))\n      // java \u306b\u306f BuilderSupport#simple(String value, Class<?> resultType)\u304c\u3042\u308a\n      // \u623b\u308a\u5024\u3092\u6307\u5b9a\u3067\u304d\u308b\u304cscala\u306f\u4e0d\u53ef\n      setHeader(\"h_num\", simple(\"properties:num\"))\n      setHeader(\"h_num\", _.in(\"h_num\").asInstanceOf[String].toInt)\n    }\n  }\n```\n\n\n# property\u30d5\u30a1\u30a4\u30eb\u8aad\u307f\u8fbc\u307f\ncreateCamelContext \u3092overrirde\u3057\u3066\u751f\u6210\u3057\u305fCamelContext\u306bPropertyComponent\u3092add\u3059\u308b\u3002\n\n```scala\n  override protected def createCamelContext: CamelContext = {\n    val context = super.createCamelContext()\n    context.addComponent(\"properties\", new PropertiesComponent(\"classpath:jp/den3umegumi/experimental/camel/route/PropertiesRouteBuilderTest.properties\"))\n    context\n  }\n```\n\n\n# Tips\n\n## RouteBuilder\u901a\u904e\u5f8c\u306eExchange\u306e\u5024\u3092\u8a55\u4fa1\u3059\u308b\n\n\u30b5\u30f3\u30d7\u30eb\u3067\u306fBody\u3057\u304b\u9001\u4fe1\u51fa\u6765\u306a\u3044\u304c\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066Header\u3092\u9001\u4fe1\u3059\u308b\u62e1\u5f35Method\u3082\u4f5c\u6210\u3059\u308b\u3002\n\n```CamelTestSupportExtension.scala\npackage jp.den3umegumi.experimental.camel.route\n\nimport org.apache.camel.test.junit4.CamelTestSupport\nimport org.apache.camel.{Exchange, Processor}\nimport org.scalatest.Matchers\n\nclass CamelTestSupportExtension extends CamelTestSupport with Matchers {\n\n  def sendBodyWithReceiveExchange(endpointUri: String, body: Any): Exchange = template.send(endpointUri, new Processor {\n    def process(exchange: Exchange) {\n      val in = exchange.getIn\n      in.setBody(body)\n    }\n  })\n}\n```\n\n\n\n## mock\u5316\n\u73fe\u5728\u306ecamel\u3067\u306fRoute\u306e\u4e00\u90e8\u3092mock\u5316\u3059\u308b\u3053\u3068\u306f\u51fa\u6765\u306a\u3044\u3002\n\u305d\u306e\u305f\u3081DB\u30a2\u30af\u30bb\u30b9\u3084\u5916\u90e8\u901a\u4fe1\u3092\u884c\u3046\u7b87\u6240\u306a\u3069\u306f\u95a2\u6570\u5207\u308a\u51fa\u3057\u3092\u3057\u3066\u3001\u5bfe\u8c61\u30af\u30e9\u30b9\u3092\u7d99\u627f\u3057\u305f\u30af\u30e9\u30b9\u3092\u5b9a\u7fa9\u3059\u308b\u306e\u304c\u826f\u3055\u305d\u3046\u3002\n\u5f31\u70b9\u306f1\u3064\u306e\u30c6\u30b9\u30c8\u30af\u30e9\u30b9\u5185\u306b\u8907\u6570\u306e\u30b1\u30fc\u30b9\u304c\u8a18\u8ff0\u3057\u3065\u3089\u3044\u3002\n\n1. override\u3057\u305f\u95a2\u6570\u306e\u4e2d\u3067\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3067\u8a2d\u5b9a\u3055\u308c\u305fHeader\u3092\u5224\u65ad\u3059\u308b\u3002(Property\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u3063\u305f\u308a)\n1. 1\u30af\u30e9\u30b91\u30b1\u30fc\u30b9\u3067\u8a18\u8ff0\u3059\u308b\u3002\n\n\u3068\u3044\u3046\u3088\u3046\u306a\u5bfe\u7b56\u304c\u8003\u3048\u3089\u308c\u308b\u3051\u3069\u3001\u3069\u3063\u3061\u3082\u53ef\u8aad\u6027\u60aa\u305d\u3046\u3002\n\n\n\u4f8b\n\n```MockRouteBuilder.scala\npackage jp.den3umegumi.experimental.camel.route\n\nimport org.apache.camel.CamelContext\nimport org.apache.camel.impl.DefaultCamelContext\nimport org.apache.camel.scala.dsl.builder.ScalaRouteBuilder\n\nclass MockRouteBuilder(context: CamelContext = new DefaultCamelContext) extends ScalaRouteBuilder(context: CamelContext) {\n\n  private[route] def callAPI = {\n    // \u306a\u3093\u304b\u5916\u90e8\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u308a\n    -->(\"mock:callAPI\")\n    setHeader(\"result\", \"foo\")\n  }\n\n  \"direct:mockroutebuilder\" ==> {\n    callAPI\n    choice {\n      when (_.in(\"result\") == \"foo\") -->(\"mock:foo\")\n      otherwise -->(\"mock:not-foo\")\n    }\n    -->(\"mock:mockroutebuilder-end\")\n  }\n}\n```\n\n```MockRouteBuilderTest.scala\npackage jp.den3umegumi.experimental.camel.route\n\nimport org.apache.camel.builder.RouteBuilder\nimport org.apache.camel.impl.DefaultCamelContext\nimport org.apache.camel.scala.dsl.builder.RouteBuilderSupport\nimport org.apache.camel.test.junit4.CamelTestSupport\nimport org.junit.Test\nimport org.scalatest.Matchers\n\nclass MockRouteBuilderTest extends CamelTestSupport with Matchers with RouteBuilderSupport {\n\n  override def createRouteBuilder: RouteBuilder = new MockRouteBuilder(context = new DefaultCamelContext) {\n    override def callAPI = {\n      -->(\"mock:mock-callAPI\")\n      setHeader(\"result\", \"bar\")\n    }\n  }\n\n  @Test\n  def resultNotFoo = {\n    getMockEndpoint(\"mock:callAPI\").expectedMessageCount(0)\n    getMockEndpoint(\"mock:mock-callAPI\").expectedMessageCount(1)\n    getMockEndpoint(\"mock:foo\").expectedMessageCount(0)\n    getMockEndpoint(\"mock:not-foo\").expectedMessageCount(1)\n    template.sendBody(\"direct:mockroutebuilder\", \"\")\n    assertMockEndpointsSatisfied\n  }\n}\n```\n\n", "tags": ["Scala", "test", "camel"]}