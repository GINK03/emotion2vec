{"tags": ["test-kitchen", "serverspec", "docker"], "context": " \u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u65e5\u304b\u30891\u5e74\u4ee5\u4e0a\u304c\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u7d4c\u7def\n\u3053\u3061\u3089\u306eTest-Kitchen\u3067Serverspec\u3084Infrataster\u3092Shell-Verifier\u304b\u3089\u5b9f\u884c\u306e\u6700\u5f8c\u306e\u65b9\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304b\u308c\u3066\u3044\u307e\u3057\u305f\u3002\n\n\u3055\u3066\u3001verify\u30b9\u30c6\u30c3\u30d7\u304c\u65e9\u304f\u306a\u3063\u305f\u306e\u3067\u3001Vagrant\u30c9\u30e9\u30a4\u30d0\u30fc\u3067\u306f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u306b\u8981\u3059\u308b\u6642\u9593\u304c\u76ee\u7acb\u3061\u307e\u3059\u3002\n\u30b3\u30fc\u30d2\u30fc\u306e\u304a\u304b\u308f\u308a\u3092\u6c72\u307f\u306b\u884c\u3063\u3066\u3082\u3044\u3044\u3093\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u3055\u3089\u306bkitchen-docker_cli\u306a\u3069\u3068\u4f75\u7528\u3059\u308b\u3068\u3001kitchen test\u304c\u4f11\u61a9\u3092\u53d6\u308b\u9593\u3082\u306a\u304f\u7d42\u308f\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u306d\u3002\n\n\u632f\u308a\u304b\u306a\uff1f\u3063\u3066\u601d\u3063\u3066\u3084\u3063\u3066\u307f\u307e\u3059\u3002\n\u305f\u3057\u304b\u306b\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\u3068busser\u306b\u3088\u308b\u8af8\u3005\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u6642\u9593\u304c\u307b\u3068\u3093\u3069\u7121\u304f\u306a\u308b\u306e\u3067\u3001\u304b\u306a\u308a\u901f\u304f\u306a\u308a\u305d\u3046\u3067\u3059\u306d\u3002\n\u3061\u306a\u307f\u306bDockerCli-Driver\u3063\u3066\u306a\u3093\u3060\u3068\u3044\u3046\u65b9\u306f\u3053\u306e\u8fba\u3092\u3070\u3002\n\n\u6e96\u5099\n\u3053\u3093\u306a\u611f\u3058\u3067\u3002\n\nGemfile\nsource \"https://rubygems.org\"\n\ngem 'kitchen-verifier-shell'\ngem 'kitchen-docker_cli'\ngem 'kitchen-vagrant'\ngem 'serverspec'\ngem 'docker-api'\n\n\n.kitchen.yml\u306fsuite\u6bce\u306bDriver\u3092\u66ff\u3048\u305f\u308a\u306f\u666e\u901a\u306f\u3042\u307e\u308a\u3057\u306a\u3044\u306e\u3067\u3001\u3061\u3087\u3063\u3068\u5909\u5247\u6c17\u5473\u3067\u3059\u30021\n\n.kitchen.yml\n---\nprovisioner:\n  name: chef_zero\n\nplatforms:\n  - name: ubuntu-14.04\n\nsuites:\n  - name: vagrant\n    driver:\n      name: vagrant\n    run_list:\n      - recipe[example::default]\n      # \u30c7\u30d5\u30a9\u30eb\u30c8\u306ebusser\u3067Serverspec\u5b9f\u884c\n  - name: docker_cli\n    driver:\n      name: docker_cli\n    transport:\n      name: docker_cli\n    run_list:\n      - recipe[example::default]\n    verifier:\n      name: shell\n      command: ./bin/rspec test/integration/docker_cli/serverspec/example_spec.rb\n      # \u30ed\u30fc\u30ab\u30eb\u304b\u3089shell-verifier\u3067Serverspec\u5b9f\u884c\n\n\n\u30d7\u30ed\u30d3\u30b8\u30e7\u30f3\u306b\u4f7f\u3046bootstrap.sh\u3092\u3001\u53c2\u8003\u5143\u8a18\u4e8b\u3068\u540c\u3058\u3067\u9069\u5f53\u306b\u30fb\u30fb\u30fb\u3068\u601d\u3063\u305f\u3093\u3067\u3059\u304cbusser\u306fChef(omnibus)\u3067\u4f7f\u3063\u3066\u308bRuby\u3067\u52d5\u304f\u306e\u3067recipe\u3092\u7528\u610f\u3057\u307e\u3059\u3002\n\nrecipes/default.rb\nexecute 'apt-get update -y' do\n  user 'root'\nend\n\npackage 'nginx'\n\n\nVagrant-Driver\u00d7Busser-Verifier\u306eServerspec\u306e\u5185\u5bb9\u306f\u7279\u7b46\u3059\u3079\u304d\u70b9\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u3053\u3093\u306a\u611f\u3058\u3002\n\ntest/integration/vagrant/serverspec/example_spec.rb\nrequire 'serverspec'\n\nset :backend, :exec\n\ndescribe package('nginx') do\n  it { should be_installed }\nend\n\n\nDockerCli-Driver\u00d7Shell-Verifier\u306eServerspec\u306e\u5185\u5bb9\u306b\u304a\u3051\u308b\u30dd\u30a4\u30f3\u30c8\u306f\u4e00\u70b9\u3002\nShell-Verifier\u306fKITCHEN_XXX\u3068\u3044\u3046\u74b0\u5883\u5909\u6570\u3067Driver\u304b\u3089\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306estate\u60c5\u5831\u3092\u53d7\u3051\u53d6\u308b\u4ed5\u69d8\uff082015.07.03\u73fe\u5728\uff09\u3067\u3059\u306e\u3067\u3001Serverspec(Specinfra)\u306eDocker Backend\u3067\u4f7f\u7528\u3059\u308b\u30b3\u30f3\u30c6\u30caID\u3092KITCHEN_CONTAINER_ID\u3068\u3044\u3046\u74b0\u5883\u5909\u6570\u3092\u4f7f\u3063\u3066\u6307\u5b9a\u3057\u307e\u3059\u3002\n\ntest/integration/docker_cli/serverspec/example_spec.rb\nrequire 'serverspec'\n\nset :backend, :docker\nset :docker_container, ENV['KITCHEN_CONTAINER_ID']\n\ndescribe package('nginx') do\n  it { should be_installed }\nend\n\n\n\n\u6bd4\u3079\u3066\u307f\u3088\u3046\n\nVagrant-Driver\n$ time ./bin/kitchen test vagrant -l warn\n\nreal    4m14.127s\nuser    0m11.521s\nsys     0m3.548s\n\n\n\nDockerCli-Driver\n$ time ./bin/kitchen test docker-cli -l warn\n\n.\n\nFinished in 4.27 seconds (files took 0.54292 seconds to load)\n1 example, 0 failures\n\n\nreal    1m57.060s\nuser    0m4.537s\nsys     0m0.932s\n\n\n4\u5206\u5f37\u21922\u5206\u5f31\u3067\u534a\u5206\u4ee5\u4e0b\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u30b3\u30fc\u30d2\u30fc\u3092\u5165\u308c\u308b\u6642\u9593\u304c\u3042\u308b\u304b\u306f\u30b3\u30fc\u30d2\u30fc\u30e1\u30fc\u30ab\u30fc\u307e\u3067\u306e\u8ddd\u96e2\u6b21\u7b2c\u3063\u3066\u611f\u3058\u3067\u3059\u304c\u3001\u304b\u306a\u308a\u9055\u3044\u307e\u3059\u306d\u3002\n\u3061\u306a\u307f\u306b\u3001Verifier\u65b9\u5f0f\u306e\u5dee\u7570\u3092\u9664\u3044\u3066Driver\u9593\u306e\u9055\u3044\u3092\u898b\u308b\u305f\u3081\u306bconverge\u3092\u6d41\u3059\u3068\u3053\u3093\u306a\u611f\u3058\u3002\n\nVagrant-Driver\n$ time ./bin/kitchen converge vagrant -l warn\n\nreal    2m46.553s\nuser    0m6.068s\nsys     0m2.041s\n\n\n\nDockerCli-Driver\n$ time ./bin/kitchen converge docker-cli -l warn\n\nreal    1m27.959s\nuser    0m3.111s\nsys     0m0.603s\n\n\n\u3053\u308c\u3082\u534a\u5206\u304f\u3089\u3044\u3067\u3057\u305f\u306d\u3002\n4\u5206\u5f37\u306e\u3046\u3061\uff11\u5206\u5f37\u306fChef\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u304c\u5360\u3081\u3066\u3044\u308b\u306e\u3067\u3001\u79c1\u306e\u74b0\u5883\uff08MBA2013mid\u7279\u76db\u308a\uff09\u3067\u306fVagrant-Driver\u2192DockerCli-Driver\u3001Busser-Verifier\u2192Shell-Verifier\u306e\u5909\u66f4\u3067\u305d\u308c\u305e\u308c\uff11\u5206\u5f37\u306e\u77ed\u7e2e\u3068\u3044\u3046\u611f\u3058\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\n\n\n\u666e\u6bb5\u3084\u308b\u3068\u3057\u305f\u3089\u3001\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306b\u89e6\u308b\u3068\u304b\u3067Docker\u30b3\u30f3\u30c6\u30ca\u4e0a\u3058\u3083\u5b9f\u884c\u3067\u304d\u306a\u3044\u3084\u3064\u304c\u305f\u307e\u306b\u3042\u308b\u306e\u3067\u3001\u305d\u306e\u6642\u3060\u3051\u5207\u308a\u66ff\u3048\u308b\u3068\u304b\u304f\u3089\u3044\u00a0\u21a9\n\n\n\n# \u7d4c\u7def\n\u3053\u3061\u3089\u306e[Test-Kitchen\u3067Serverspec\u3084Infrataster\u3092Shell-Verifier\u304b\u3089\u5b9f\u884c](http://qiita.com/sawanoboly/items/4898bb4f277e5cacfb6c)\u306e\u6700\u5f8c\u306e\u65b9\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304b\u308c\u3066\u3044\u307e\u3057\u305f\u3002\n\n> \u3055\u3066\u3001verify\u30b9\u30c6\u30c3\u30d7\u304c\u65e9\u304f\u306a\u3063\u305f\u306e\u3067\u3001Vagrant\u30c9\u30e9\u30a4\u30d0\u30fc\u3067\u306f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u306b\u8981\u3059\u308b\u6642\u9593\u304c\u76ee\u7acb\u3061\u307e\u3059\u3002\n\u30b3\u30fc\u30d2\u30fc\u306e\u304a\u304b\u308f\u308a\u3092\u6c72\u307f\u306b\u884c\u3063\u3066\u3082\u3044\u3044\u3093\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u3055\u3089\u306bkitchen-docker_cli\u306a\u3069\u3068\u4f75\u7528\u3059\u308b\u3068\u3001kitchen test\u304c\u4f11\u61a9\u3092\u53d6\u308b\u9593\u3082\u306a\u304f\u7d42\u308f\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u306d\u3002\n\n\u632f\u308a\u304b\u306a\uff1f\u3063\u3066\u601d\u3063\u3066\u3084\u3063\u3066\u307f\u307e\u3059\u3002\n\n\u305f\u3057\u304b\u306b\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\u3068busser\u306b\u3088\u308b\u8af8\u3005\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u6642\u9593\u304c\u307b\u3068\u3093\u3069\u7121\u304f\u306a\u308b\u306e\u3067\u3001\u304b\u306a\u308a\u901f\u304f\u306a\u308a\u305d\u3046\u3067\u3059\u306d\u3002\n\n\u3061\u306a\u307f\u306bDockerCli-Driver\u3063\u3066\u306a\u3093\u3060\u3068\u3044\u3046\u65b9\u306f[\u3053\u306e\u8fba](http://qiita.com/Marcy/items/5814a2ae647a6e25a44d#%E6%A7%8B%E6%88%90%E6%96%B9%E6%B3%95)\u3092\u3070\u3002\n\n# \u6e96\u5099\n\u3053\u3093\u306a\u611f\u3058\u3067\u3002\n\n```rb:Gemfile\nsource \"https://rubygems.org\"\n\ngem 'kitchen-verifier-shell'\ngem 'kitchen-docker_cli'\ngem 'kitchen-vagrant'\ngem 'serverspec'\ngem 'docker-api'\n```\n\n`.kitchen.yml`\u306fsuite\u6bce\u306bDriver\u3092\u66ff\u3048\u305f\u308a\u306f\u666e\u901a\u306f\u3042\u307e\u308a\u3057\u306a\u3044\u306e\u3067\u3001\u3061\u3087\u3063\u3068\u5909\u5247\u6c17\u5473\u3067\u3059\u3002[^1]\n\n```yaml:.kitchen.yml\n---\nprovisioner:\n  name: chef_zero\n\nplatforms:\n  - name: ubuntu-14.04\n\nsuites:\n  - name: vagrant\n    driver:\n      name: vagrant\n    run_list:\n      - recipe[example::default]\n      # \u30c7\u30d5\u30a9\u30eb\u30c8\u306ebusser\u3067Serverspec\u5b9f\u884c\n  - name: docker_cli\n    driver:\n      name: docker_cli\n    transport:\n      name: docker_cli\n    run_list:\n      - recipe[example::default]\n    verifier:\n      name: shell\n      command: ./bin/rspec test/integration/docker_cli/serverspec/example_spec.rb\n      # \u30ed\u30fc\u30ab\u30eb\u304b\u3089shell-verifier\u3067Serverspec\u5b9f\u884c\n```\n\n\u30d7\u30ed\u30d3\u30b8\u30e7\u30f3\u306b\u4f7f\u3046bootstrap.sh\u3092\u3001[\u53c2\u8003\u5143\u8a18\u4e8b](http://qiita.com/sawanoboly/items/4898bb4f277e5cacfb6c)\u3068\u540c\u3058\u3067\u9069\u5f53\u306b\u30fb\u30fb\u30fb\u3068\u601d\u3063\u305f\u3093\u3067\u3059\u304cbusser\u306fChef(omnibus)\u3067\u4f7f\u3063\u3066\u308bRuby\u3067\u52d5\u304f\u306e\u3067recipe\u3092\u7528\u610f\u3057\u307e\u3059\u3002\n\n```rb:recipes/default.rb\nexecute 'apt-get update -y' do\n  user 'root'\nend\n\npackage 'nginx'\n````\n\n`Vagrant-Driver`\u00d7`Busser-Verifier`\u306eServerspec\u306e\u5185\u5bb9\u306f\u7279\u7b46\u3059\u3079\u304d\u70b9\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u3053\u3093\u306a\u611f\u3058\u3002\n\n```rb:test/integration/vagrant/serverspec/example_spec.rb\nrequire 'serverspec'\n\nset :backend, :exec\n\ndescribe package('nginx') do\n  it { should be_installed }\nend\n```\n\n`DockerCli-Driver`\u00d7`Shell-Verifier`\u306eServerspec\u306e\u5185\u5bb9\u306b\u304a\u3051\u308b\u30dd\u30a4\u30f3\u30c8\u306f\u4e00\u70b9\u3002\nShell-Verifier\u306f`KITCHEN_XXX`\u3068\u3044\u3046\u74b0\u5883\u5909\u6570\u3067Driver\u304b\u3089\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306estate\u60c5\u5831\u3092\u53d7\u3051\u53d6\u308b\u4ed5\u69d8\uff082015.07.03\u73fe\u5728\uff09\u3067\u3059\u306e\u3067\u3001Serverspec(Specinfra)\u306eDocker Backend\u3067\u4f7f\u7528\u3059\u308b\u30b3\u30f3\u30c6\u30caID\u3092`KITCHEN_CONTAINER_ID`\u3068\u3044\u3046\u74b0\u5883\u5909\u6570\u3092\u4f7f\u3063\u3066\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```rb:test/integration/docker_cli/serverspec/example_spec.rb\nrequire 'serverspec'\n\nset :backend, :docker\nset :docker_container, ENV['KITCHEN_CONTAINER_ID']\n\ndescribe package('nginx') do\n  it { should be_installed }\nend\n```\n\n# \u6bd4\u3079\u3066\u307f\u3088\u3046\n\n```shell-session:Vagrant-Driver\n$ time ./bin/kitchen test vagrant -l warn\n\nreal\t4m14.127s\nuser\t0m11.521s\nsys \t0m3.548s\n```\n\n```shell-session:DockerCli-Driver\n$ time ./bin/kitchen test docker-cli -l warn\n\n.\n\nFinished in 4.27 seconds (files took 0.54292 seconds to load)\n1 example, 0 failures\n\n\nreal\t1m57.060s\nuser\t0m4.537s\nsys \t0m0.932s\n```\n\n**4\u5206\u5f37\u21922\u5206\u5f31\u3067\u534a\u5206\u4ee5\u4e0b**\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u30b3\u30fc\u30d2\u30fc\u3092\u5165\u308c\u308b\u6642\u9593\u304c\u3042\u308b\u304b\u306f\u30b3\u30fc\u30d2\u30fc\u30e1\u30fc\u30ab\u30fc\u307e\u3067\u306e\u8ddd\u96e2\u6b21\u7b2c\u3063\u3066\u611f\u3058\u3067\u3059\u304c\u3001\u304b\u306a\u308a\u9055\u3044\u307e\u3059\u306d\u3002\n\n\u3061\u306a\u307f\u306b\u3001Verifier\u65b9\u5f0f\u306e\u5dee\u7570\u3092\u9664\u3044\u3066Driver\u9593\u306e\u9055\u3044\u3092\u898b\u308b\u305f\u3081\u306b`converge`\u3092\u6d41\u3059\u3068\u3053\u3093\u306a\u611f\u3058\u3002\n\n```shell-session:Vagrant-Driver\n$ time ./bin/kitchen converge vagrant -l warn\n\nreal\t2m46.553s\nuser\t0m6.068s\nsys \t0m2.041s\n```\n\n```shell-session:DockerCli-Driver\n$ time ./bin/kitchen converge docker-cli -l warn\n\nreal\t1m27.959s\nuser\t0m3.111s\nsys \t0m0.603s\n```\n\n\u3053\u308c\u3082**\u534a\u5206\u304f\u3089\u3044**\u3067\u3057\u305f\u306d\u3002\n\n**4\u5206\u5f37**\u306e\u3046\u3061**\uff11\u5206\u5f37\u306fChef\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u304c\u5360\u3081\u3066\u3044\u308b**\u306e\u3067\u3001\u79c1\u306e\u74b0\u5883\uff08MBA2013mid\u7279\u76db\u308a\uff09\u3067\u306f**Vagrant-Driver\u2192DockerCli-Driver\u3001Busser-Verifier\u2192Shell-Verifier\u306e\u5909\u66f4\u3067\u305d\u308c\u305e\u308c\uff11\u5206\u5f37\u306e\u77ed\u7e2e\u3068\u3044\u3046\u611f\u3058**\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n[^1]: \u666e\u6bb5\u3084\u308b\u3068\u3057\u305f\u3089\u3001\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306b\u89e6\u308b\u3068\u304b\u3067Docker\u30b3\u30f3\u30c6\u30ca\u4e0a\u3058\u3083\u5b9f\u884c\u3067\u304d\u306a\u3044\u3084\u3064\u304c\u305f\u307e\u306b\u3042\u308b\u306e\u3067\u3001\u305d\u306e\u6642\u3060\u3051\u5207\u308a\u66ff\u3048\u308b\u3068\u304b\u304f\u3089\u3044\n"}