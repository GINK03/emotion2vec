{"context": " More than 1 year has passed since last update.\nd.hatena.ne.jp/toriimiyukki/20120124/1327417154\nvar net = require('net');\nsocket.connect(data.msPort, data.msAddr);\nsocket.setEncoding('utf-8');\nsocket.on('connect', function() {\n    console.log('connected');\n    socket.write('<thread thread=\"' + data.msThread + '\" res_from=\"' + data.resFrom + '\" version=\"20061206\" >' + \"\\0\");\n});\nsocket.on('data', function(data) {\n    console.log(data);\n});\n\n\n\u30b0\u30fc\u30b0\u30eb\u3067\u691c\u7d22\u3059\u308b\u3068\u898b\u3064\u304b\u308b\u3053\u306e\u30b3\u30fc\u30c9\u7247\u3067\u306f\u3001getplayerstatus\u3092\u53d6\u5f97\u3057\u306a\u3044\u306e\u3067\u52d5\u304d\u307e\u305b\u3093\u3002\n\n\n\n\u624b\u52d5\u3067API\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3001\u8a72\u5f53\u7b87\u6240\u3092\u66f8\u304d\u63db\u3048\u308b\u3068\u52d5\u304d\u307e\u3059\u3002\n\n\n\ndata.msPort: <getplayerstatus><ms><port>\n\u306e\u5024\n\ndata.msAddr: <getplayerstatus><ms><addr>\n\u306e\u5024\n\ndata.msThread: <getplayerstatus><ms><thread>\n\u306e\u5024\n\ndata.resFrom: -1000~0 \u30b3\u30e1\u30f3\u30c8\u958b\u59cb\u4f4d\u7f6e\n\n\n\n\n\n\u4f8b\n\nsuck.js\nvar net= require('net');\nvar socket= net.connect(2811,'omsg101.live.nicovideo.jp');\nsocket.on('connect', function(){\n  console.log('connected');\n  socket.setEncoding('utf-8');\n  socket.write('<thread thread=\"1435806943\" res_from=\"-5\" version=\"20061206\" />\\0');\n});\nsocket.on('data',function(data){\n  console.log(data);\n});\n\n\n\ndata\n<thread resultcode=\"0\" thread=\"1435806943\" last_res=\"2836\" ticket=\"0x1dfc9b00\" revision=\"1\" server_time=\"1431262237\"/><chat thread=\"1435806943\" vpos=\"6450700\" date=\"1431261909\" date_usec=\"57301\" mail=\"184\" user_id=\"Idj1TdXOGrERXdFOUdiTX4sKIB0\" anonymity=\"1\" locale=\"jp\">v(\uff9f\u0414\uff9f)v\uff1c\u266a \uff76\uff67\uff70\uff86\uff70 \uff76\uff67\uff70\uff86\uff70 \uff7c\uff6e\uff87\uff80\uff9e\uff70 \uff76\uff7c\uff9e\uff76\uff7c\uff9e \uff8a\uff9e\uff70\uff8c\uff9e\uff70 \uff7f\uff91\uff80\uff9e\uff70 \uff8a\uff9f\uff6f! \u266c</chat><chat>...</chat>\n\n\nThis sucks.\n\u3053\u306e\u8a18\u4e8b\u3067\u306f\u3001\u30ed\u30b0\u30a4\u30f3\u304b\u3089\u9806\u3092\u8ffd\u3063\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\n\n\u30ed\u30b0\u30a4\u30f3\nhttps://secure.nicovideo.jp/secure/login\u306bmail_tel\u3068password\u3092POST\u3057\u307e\u3059\u3002\nrequest\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n$ npm install request\n$ node login.js\n\n\nlogin.js\n\nvar request= require('request');\n\nrequest.post({\n  url: 'https://secure.nicovideo.jp/secure/login',\n  form: {\n    mail_tel: 'your@mail.address',\n    password: '********',\n  },\n},function(error,response){\n  if(error!=null) throw error;\n\n  var session= null;\n  var cookies= response.headers['set-cookie'] || [];\n  for(var i=0; i<cookies.length; i++){\n    var cookie= cookies[i];\n    if(cookie.match(/^user_session=user_session/)){\n      session= cookie.slice(0,cookie.indexOf(';')+1);\n    }\n  }\n\n  console.log(response.headers['set-cookie']);\n  console.log(session);\n});\n\n\n\u30ed\u30b0\u30a4\u30f3\u304c\u6b63\u5e38\u3067\u3042\u308c\u3070\n\nresponse.headers['set-cookie']\n\n[ 'nicosid=1431257919.1222609129; expires=Wed, 07-May-2025 11:38:39 GMT; path=/; domain=.nicovideo.jp',\n  'user_session=deleted; expires=Thu, 01-Jan-1970 00:00:01 GMT',\n  'user_session=deleted; expires=Thu, 01-Jan-1970 00:00:01 GMT; path=/',\n  'user_session=deleted; expires=Thu, 01-Jan-1970 00:00:01 GMT; path=/; domain=.nicovideo.jp',\n  'user_session=user_session_000000_0000000000000000000000000000000000000000000000000000000000000000; expires=Tue, 09-Jun-2015 11:38:39 GMT; path=/; domain=.nicovideo.jp',\n  'repair_history=deleted; expires=Thu, 01-Jan-1970 00:00:01 GMT; path=/; domain=.nicovideo.jp' ]\n\n\n\nsession\nuser_session=user_session_000000_0000000000000000000000000000000000000000000000000000000000000000;\n\n\n\u306e\u3088\u3046\u306a\u5024\u304c\u8fd4\u308a\u307e\u3059\u3002\u6700\u7d42\u7684\u306b\u4f7f\u7528\u3059\u308b\u306e\u306fsession\u306e\u307f\u3067\u3059\u3002\n\n\u4ee5\u964d\u306f\u3053\u306esession\u3092\u4f7f\u3044\u307e\u308f\u3057\u307e\u3059\u3002session\u306f\u3057\u3070\u3089\u304f\u6709\u52b9\u3067\u3001\u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u5024\u3092\u4fdd\u5b58\u3057\u3066\u304a\u304f\u3053\u3068\u3067\u3001\u30e1\u30bd\u30c3\u30c9\u6bce\u306b\u30ed\u30b0\u30a4\u30f3\u51e6\u7406\u3092\u631f\u307e\u305a\u306b\u6e08\u3080\u3067\u3057\u3087\u3046\u3002\n\n\n\u30d7\u30ec\u30a4\u30e4\u30fc\uff08\u30b3\u30e1\u30f3\u30c8\u30b5\u30fc\u30d0\u30fc\uff09\u60c5\u5831\u306e\u53d6\u5f97\n\u3067\u306f\u65e9\u901f\u3001getplayerstatus\u304c\u4f7f\u7528\u53ef\u80fd\u306b\u306a\u3063\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n\ngetplayerstatus.js\nvar request= require('request');\nrequest({\n  url: 'http://live.nicovideo.jp/api/getplayerstatus/nsen/hotaru',\n  headers: {\n    Cookie: session,\n  },\n},function(error,response){\n  if(error!=null) throw error;\n\n  console.log(response.body);\n});\n\n\n\nresponse.body\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<getplayerstatus status=\"ok\" time=\"1431262800\"><stream><id>lv220580424</id><title>Nsen - \u86cd\u306e\u5149\u30c1\u30e3\u30f3\u30cd\u30eb</title><description>Nsen\u304b\u3089\u306e\u53bb\u308a\u969b\u306b\u81ea\u4e3b\u7684\u306b\u304a\u7acb\u3061\u5bc4\u308a\u4e0b\u3055\u3044\u3002Nsen\u3092\u3054\u582a\u80fd\u9802\u3044\u305f\u5f8c\u3001\u307e\u305f\u3001\u30cd\u30c3\u30c8\u30b5\u30fc\u30d5\u30a3\u30f3\u3092\u7d42\u3048\u7720\u308a\u306b\u3064\u304f\u6642\u306a\u3069\u306b\u30aa\u30b9\u30b9\u30e1\u3067\u3059\u3002</description>...</stream>\n...\n<ms><addr>omsg101.live.nicovideo.jp</addr><port>2811</port><thread>1435806943</thread></ms>\n...\n</getplayerstatus>\n\n\n\u30d7\u30ec\u30a4\u30e4\u30fc\uff08\u30b3\u30e1\u30f3\u30c8\u30b5\u30fc\u30d0\u30fc\uff09\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\ngetplayerstatus\u306f nsen,  lv***,  co***\u306e\uff13\u7a2e\u985e\u304c\u4f7f\u7528\u53ef\u80fd\u3067\u3059\u3002\n\ncheerio\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u3066\u3001\u5fc5\u8981\u306a\u5024\u3060\u3051\u3092\u53d6\u308a\u51fa\u3057\u307e\u3059\u3002\n$ npm install cheerio\n$ node getplayerstatus.js\n\n\ngetplayerstatus.js\nvar request= require('request');\nvar cheerio= require('cheerio');\n\nrequest({\n  url: 'http://live.nicovideo.jp/api/getplayerstatus/nsen/hotaru',\n  headers: {\n    Cookie: session,\n  },\n},function(error,response){\n  if(error!=null) throw error;\n\n  var $= cheerio.load(response.body);\n  console.log($('getplayerstatus ms port').text());\n  console.log($('getplayerstatus ms addr').text());\n  console.log($('getplayerstatus ms thread').text());\n});\n\n\n\nconsole.log\n2811\nomsg101.live.nicovideo.jp\n1435806943\n\n\n\n\u30d7\u30ec\u30a4\u30e4\u30fc\u3078\u63a5\u7d9a\u3059\u308b\n\u3053\u308c\u307e\u3067\u306e\u30b3\u30fc\u30c9\u3092\u7e4b\u304e\u3042\u308f\u305b\u3066\u3001\u30b3\u30e1\u30f3\u30c8\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\nnicolive.js\n// Dependencies\nvar request= require('request');\nvar cheerio= require('cheerio');\nvar net= require('net');\n\n// Demonstration\nprocess.nextTick(function(){\n  // Environment\n  var id= 'your@mail.address';\n  var pw= '********';\n  var live_id= 'nsen/hotaru';\n\n  // Boot\n  nicolive.login(id,pw,function(error,session){\n    if(error!=null) throw error;\n\n    nicolive.fetchThread(live_id,session,function(error,thread){\n      if(error!=null) throw error;\n\n      nicolive.view(thread,function(error,viewer){\n        if(error!=null) throw error;\n\n        viewer.on('data',function(data){\n          console.log(data);\n        });\n      });\n    });\n  });\n});\n\n// Methods\nnicolive= {\n  login: function(id,pw,callback){\n    request.post({\n      url: 'https://secure.nicovideo.jp/secure/login',\n      form: {\n        mail_tel: id,\n        password: pw,\n      },\n    },function(error,response){\n      if(error!=null) return callback(error);\n\n      var session= null;\n      var cookies= response.headers['set-cookie'] || [];\n      for(var i=0; i<cookies.length; i++){\n        var cookie= cookies[i];\n        if(cookie.match(/^user_session=user_session/)){\n          session= cookie.slice(0,cookie.indexOf(';')+1);\n        }\n      }\n      if(session==null) return callback(new Error('Invalid user'));\n\n      callback(null,session);\n    });\n  },\n  fetchThread: function(live_id,session,callback){\n    request({\n      url: 'http://live.nicovideo.jp/api/getplayerstatus/'+live_id,\n      headers: {\n        Cookie: session,\n      },\n    },function(error,response){\n      if(error!=null) return callback(error);\n\n      var $= cheerio.load(response.body);\n      callback(null,{\n        port: $('getplayerstatus ms port').text(),\n        addr: $('getplayerstatus ms addr').text(),\n        thread: $('getplayerstatus ms thread').text(),\n      });\n    });\n  },\n  view: function(thread,callback){\n    var viewer= net.connect(thread.port,thread.addr);\n    viewer.on('connect', function(){\n      viewer.setEncoding('utf-8');\n      viewer.write('<thread thread=\"'+thread.thread+'\" res_from=\"-5\" version=\"20061206\" />\\0');\n\n      callback(null,viewer);\n    });\n  },\n}\n\nmodule.exports= nicolive;\n\n\n$ node nicolive.js\n\n\nconsole.log(data);\n<thread resultcode=\"0\" thread=\"1435806943\" last_res=\"2836\" ticket=\"0x1dfc9b00\" revision=\"1\" server_time=\"1431262237\"/><chat thread=\"1435806943\" vpos=\"6450700\" date=\"1431261909\" date_usec=\"57301\" mail=\"184\" user_id=\"Idj1TdXOGrERXdFOUdiTX4sKIB0\" anonymity=\"1\" locale=\"jp\">v(\uff9f\u0414\uff9f)v\uff1c\u266a \uff76\uff67\uff70\uff86\uff70 \uff76\uff67\uff70\uff86\uff70 \uff7c\uff6e\uff87\uff80\uff9e\uff70 \uff76\uff7c\uff9e\uff76\uff7c\uff9e \uff8a\uff9e\uff70\uff8c\uff9e\uff70 \uff7f\uff91\uff80\uff9e\uff70 \uff8a\uff9f\uff6f! \u266c</chat><chat>...</chat>\n\n\n\n\u6210\u679c\u7269\uff08Electron\u88fd\u30b3\u30e1\u30f3\u30c8\u30d3\u30e5\u30fc\u30a2\u30fc\uff09\n\n\nedgy-comment-viewer/59naga - Latest release | github\nnicolive/59naga Command line comment viewer | github\nnicolive.io/59naga \u30cb\u30b3\u30cb\u30b3\u751f\u653e\u9001\u306e\u30b3\u30e1\u30f3\u30c8\u30b5\u30fc\u30d0\u30fc\u306e\u5bc4\u751f\u30b5\u30fc\u30d0\u30fc | github\nnicolive.berabou.me/59naga HTML5\u30b3\u30e1\u30f3\u30c8\u30d3\u30e5\u30fc\u30a2\u30fc | github\n\n\n\u53c2\u8003\n\nrequest | npm\ncheerio | npm\nniconico\u306e\u30e1\u30c3\u30bb\u30fc\u30b8(\u30b3\u30e1\u30f3\u30c8)\u30b5\u30fc\u30d0\u30fc\u306e\u30bf\u30b0\u3084\u9001\u308a\u65b9\u306e\u8aac\u660e - \u795e\u306e\u5473\u564c\u6c41\u9752\u6d77\n\u30cb\u30b3\u30cb\u30b3API\u30ea\u30b9\u30c8wiki\nnode-nicovideo-api/Ragg- | github\n\n```js:d.hatena.ne.jp/toriimiyukki/20120124/1327417154\nvar net = require('net');\nsocket.connect(data.msPort, data.msAddr);\nsocket.setEncoding('utf-8');\nsocket.on('connect', function() {\n    console.log('connected');\n    socket.write('<thread thread=\"' + data.msThread + '\" res_from=\"' + data.resFrom + '\" version=\"20061206\" >' + \"\\0\");\n});\nsocket.on('data', function(data) {\n    console.log(data);\n});\n```\n[\u30b0\u30fc\u30b0\u30eb\u3067\u691c\u7d22\u3059\u308b\u3068\u898b\u3064\u304b\u308b\u3053\u306e\u30b3\u30fc\u30c9\u7247\u3067\u306f](http://d.hatena.ne.jp/toriimiyukki/20120124/1327417154)\u3001__getplayerstatus\u3092\u53d6\u5f97\u3057\u306a\u3044\u306e\u3067__\u52d5\u304d\u307e\u305b\u3093\u3002\n\n> * [\u624b\u52d5\u3067API\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066](http://live.nicovideo.jp/api/getplayerstatus/nsen/hotaru)\u3001\u8a72\u5f53\u7b87\u6240\u3092\u66f8\u304d\u63db\u3048\u308b\u3068\u52d5\u304d\u307e\u3059\u3002\n  * `data.msPort`: &lt;getplayerstatus&gt;&lt;ms&gt;&lt;port&gt;\n\u306e\u5024\n  * `data.msAddr`: &lt;getplayerstatus&gt;&lt;ms&gt;&lt;addr&gt;\n\u306e\u5024\n  * `data.msThread`: &lt;getplayerstatus&gt;&lt;ms&gt;&lt;thread&gt;\n\u306e\u5024\n  * `data.resFrom`: `-1000~0` \u30b3\u30e1\u30f3\u30c8\u958b\u59cb\u4f4d\u7f6e\n\n## \u4f8b\n\n```js:suck.js\nvar net= require('net');\nvar socket= net.connect(2811,'omsg101.live.nicovideo.jp');\nsocket.on('connect', function(){\n  console.log('connected');\n  socket.setEncoding('utf-8');\n  socket.write('<thread thread=\"1435806943\" res_from=\"-5\" version=\"20061206\" />\\0');\n});\nsocket.on('data',function(data){\n  console.log(data);\n});\n```\n```xml:data\n<thread resultcode=\"0\" thread=\"1435806943\" last_res=\"2836\" ticket=\"0x1dfc9b00\" revision=\"1\" server_time=\"1431262237\"/><chat thread=\"1435806943\" vpos=\"6450700\" date=\"1431261909\" date_usec=\"57301\" mail=\"184\" user_id=\"Idj1TdXOGrERXdFOUdiTX4sKIB0\" anonymity=\"1\" locale=\"jp\">v(\uff9f\u0414\uff9f)v\uff1c\u266a \uff76\uff67\uff70\uff86\uff70 \uff76\uff67\uff70\uff86\uff70 \uff7c\uff6e\uff87\uff80\uff9e\uff70 \uff76\uff7c\uff9e\uff76\uff7c\uff9e \uff8a\uff9e\uff70\uff8c\uff9e\uff70 \uff7f\uff91\uff80\uff9e\uff70 \uff8a\uff9f\uff6f! \u266c</chat><chat>...</chat>\n```\n\n__This sucks.__\n\u3053\u306e\u8a18\u4e8b\u3067\u306f\u3001\u30ed\u30b0\u30a4\u30f3\u304b\u3089\u9806\u3092\u8ffd\u3063\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\n\n## \u30ed\u30b0\u30a4\u30f3\n`https://secure.nicovideo.jp/secure/login`\u306b`mail_tel`\u3068`password`\u3092`POST`\u3057\u307e\u3059\u3002\n[request](https://www.npmjs.com/package/request)\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n```bash\n$ npm install request\n$ node login.js\n```\n```js:login.js\n\nvar request= require('request');\n\nrequest.post({\n  url: 'https://secure.nicovideo.jp/secure/login',\n  form: {\n    mail_tel: 'your@mail.address',\n    password: '********',\n  },\n},function(error,response){\n  if(error!=null) throw error;\n\n  var session= null;\n  var cookies= response.headers['set-cookie'] || [];\n  for(var i=0; i<cookies.length; i++){\n    var cookie= cookies[i];\n    if(cookie.match(/^user_session=user_session/)){\n      session= cookie.slice(0,cookie.indexOf(';')+1);\n    }\n  }\n  \n  console.log(response.headers['set-cookie']);\n  console.log(session);\n});\n```\n\n\u30ed\u30b0\u30a4\u30f3\u304c\u6b63\u5e38\u3067\u3042\u308c\u3070\n\n```js:response.headers['set-cookie']\n\n[ 'nicosid=1431257919.1222609129; expires=Wed, 07-May-2025 11:38:39 GMT; path=/; domain=.nicovideo.jp',\n  'user_session=deleted; expires=Thu, 01-Jan-1970 00:00:01 GMT',\n  'user_session=deleted; expires=Thu, 01-Jan-1970 00:00:01 GMT; path=/',\n  'user_session=deleted; expires=Thu, 01-Jan-1970 00:00:01 GMT; path=/; domain=.nicovideo.jp',\n  'user_session=user_session_000000_0000000000000000000000000000000000000000000000000000000000000000; expires=Tue, 09-Jun-2015 11:38:39 GMT; path=/; domain=.nicovideo.jp',\n  'repair_history=deleted; expires=Thu, 01-Jan-1970 00:00:01 GMT; path=/; domain=.nicovideo.jp' ]\n```\n```js:session\nuser_session=user_session_000000_0000000000000000000000000000000000000000000000000000000000000000;\n```\n\u306e\u3088\u3046\u306a\u5024\u304c\u8fd4\u308a\u307e\u3059\u3002\u6700\u7d42\u7684\u306b\u4f7f\u7528\u3059\u308b\u306e\u306f`session`\u306e\u307f\u3067\u3059\u3002\n\n> \u4ee5\u964d\u306f\u3053\u306e`session`\u3092\u4f7f\u3044\u307e\u308f\u3057\u307e\u3059\u3002`session`\u306f\u3057\u3070\u3089\u304f\u6709\u52b9\u3067\u3001\u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u5024\u3092\u4fdd\u5b58\u3057\u3066\u304a\u304f\u3053\u3068\u3067\u3001\u30e1\u30bd\u30c3\u30c9\u6bce\u306b\u30ed\u30b0\u30a4\u30f3\u51e6\u7406\u3092\u631f\u307e\u305a\u306b\u6e08\u3080\u3067\u3057\u3087\u3046\u3002\n\n## \u30d7\u30ec\u30a4\u30e4\u30fc\uff08\u30b3\u30e1\u30f3\u30c8\u30b5\u30fc\u30d0\u30fc\uff09\u60c5\u5831\u306e\u53d6\u5f97\n\n\u3067\u306f\u65e9\u901f\u3001getplayerstatus\u304c\u4f7f\u7528\u53ef\u80fd\u306b\u306a\u3063\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n\n```js:getplayerstatus.js\nvar request= require('request');\nrequest({\n  url: 'http://live.nicovideo.jp/api/getplayerstatus/nsen/hotaru',\n  headers: {\n    Cookie: session,\n  },\n},function(error,response){\n  if(error!=null) throw error;\n\n  console.log(response.body);\n});\n```\n```xml:response.body\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<getplayerstatus status=\"ok\" time=\"1431262800\"><stream><id>lv220580424</id><title>Nsen - \u86cd\u306e\u5149\u30c1\u30e3\u30f3\u30cd\u30eb</title><description>Nsen\u304b\u3089\u306e\u53bb\u308a\u969b\u306b\u81ea\u4e3b\u7684\u306b\u304a\u7acb\u3061\u5bc4\u308a\u4e0b\u3055\u3044\u3002Nsen\u3092\u3054\u582a\u80fd\u9802\u3044\u305f\u5f8c\u3001\u307e\u305f\u3001\u30cd\u30c3\u30c8\u30b5\u30fc\u30d5\u30a3\u30f3\u3092\u7d42\u3048\u7720\u308a\u306b\u3064\u304f\u6642\u306a\u3069\u306b\u30aa\u30b9\u30b9\u30e1\u3067\u3059\u3002</description>...</stream>\n...\n<ms><addr>omsg101.live.nicovideo.jp</addr><port>2811</port><thread>1435806943</thread></ms>\n...\n</getplayerstatus>\n```\n\n\u30d7\u30ec\u30a4\u30e4\u30fc\uff08\u30b3\u30e1\u30f3\u30c8\u30b5\u30fc\u30d0\u30fc\uff09\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n> getplayerstatus\u306f [nsen](http://live.nicovideo.jp/api/getplayerstatus/nsen/vocaloid),  [lv***](http://live.nicovideo.jp/api/getplayerstatus/lv220346524),  [co***](http://live.nicovideo.jp/api/getplayerstatus/co2183236)\u306e\uff13\u7a2e\u985e\u304c\u4f7f\u7528\u53ef\u80fd\u3067\u3059\u3002\n\n[cheerio](https://github.com/cheeriojs/cheerio)\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u3066\u3001\u5fc5\u8981\u306a\u5024\u3060\u3051\u3092\u53d6\u308a\u51fa\u3057\u307e\u3059\u3002\n\n```bash\n$ npm install cheerio\n$ node getplayerstatus.js\n```\n```js:getplayerstatus.js\nvar request= require('request');\nvar cheerio= require('cheerio');\n\nrequest({\n  url: 'http://live.nicovideo.jp/api/getplayerstatus/nsen/hotaru',\n  headers: {\n    Cookie: session,\n  },\n},function(error,response){\n  if(error!=null) throw error;\n\n  var $= cheerio.load(response.body);\n  console.log($('getplayerstatus ms port').text());\n  console.log($('getplayerstatus ms addr').text());\n  console.log($('getplayerstatus ms thread').text());\n});\n```\n```js:console.log\n2811\nomsg101.live.nicovideo.jp\n1435806943\n```\n\n## \u30d7\u30ec\u30a4\u30e4\u30fc\u3078\u63a5\u7d9a\u3059\u308b\n\u3053\u308c\u307e\u3067\u306e\u30b3\u30fc\u30c9\u3092\u7e4b\u304e\u3042\u308f\u305b\u3066\u3001\u30b3\u30e1\u30f3\u30c8\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n```js:nicolive.js\n// Dependencies\nvar request= require('request');\nvar cheerio= require('cheerio');\nvar net= require('net');\n\n// Demonstration\nprocess.nextTick(function(){\n  // Environment\n  var id= 'your@mail.address';\n  var pw= '********';\n  var live_id= 'nsen/hotaru';\n\n  // Boot\n  nicolive.login(id,pw,function(error,session){\n    if(error!=null) throw error;\n\n    nicolive.fetchThread(live_id,session,function(error,thread){\n      if(error!=null) throw error;\n\n      nicolive.view(thread,function(error,viewer){\n        if(error!=null) throw error;\n\n        viewer.on('data',function(data){\n          console.log(data);\n        });\n      });\n    });\n  });\n});\n\n// Methods\nnicolive= {\n  login: function(id,pw,callback){\n    request.post({\n      url: 'https://secure.nicovideo.jp/secure/login',\n      form: {\n        mail_tel: id,\n        password: pw,\n      },\n    },function(error,response){\n      if(error!=null) return callback(error);\n\n      var session= null;\n      var cookies= response.headers['set-cookie'] || [];\n      for(var i=0; i<cookies.length; i++){\n        var cookie= cookies[i];\n        if(cookie.match(/^user_session=user_session/)){\n          session= cookie.slice(0,cookie.indexOf(';')+1);\n        }\n      }\n      if(session==null) return callback(new Error('Invalid user'));\n\n      callback(null,session);\n    });\n  },\n  fetchThread: function(live_id,session,callback){\n    request({\n      url: 'http://live.nicovideo.jp/api/getplayerstatus/'+live_id,\n      headers: {\n        Cookie: session,\n      },\n    },function(error,response){\n      if(error!=null) return callback(error);\n\n      var $= cheerio.load(response.body);\n      callback(null,{\n        port: $('getplayerstatus ms port').text(),\n        addr: $('getplayerstatus ms addr').text(),\n        thread: $('getplayerstatus ms thread').text(),\n      });\n    });\n  },\n  view: function(thread,callback){\n    var viewer= net.connect(thread.port,thread.addr);\n    viewer.on('connect', function(){\n      viewer.setEncoding('utf-8');\n      viewer.write('<thread thread=\"'+thread.thread+'\" res_from=\"-5\" version=\"20061206\" />\\0');\n\n      callback(null,viewer);\n    });\n  },\n}\n\nmodule.exports= nicolive;\n```\n\n```bash\n$ node nicolive.js\n```\n```xml:console.log(data);\n<thread resultcode=\"0\" thread=\"1435806943\" last_res=\"2836\" ticket=\"0x1dfc9b00\" revision=\"1\" server_time=\"1431262237\"/><chat thread=\"1435806943\" vpos=\"6450700\" date=\"1431261909\" date_usec=\"57301\" mail=\"184\" user_id=\"Idj1TdXOGrERXdFOUdiTX4sKIB0\" anonymity=\"1\" locale=\"jp\">v(\uff9f\u0414\uff9f)v\uff1c\u266a \uff76\uff67\uff70\uff86\uff70 \uff76\uff67\uff70\uff86\uff70 \uff7c\uff6e\uff87\uff80\uff9e\uff70 \uff76\uff7c\uff9e\uff76\uff7c\uff9e \uff8a\uff9e\uff70\uff8c\uff9e\uff70 \uff7f\uff91\uff80\uff9e\uff70 \uff8a\uff9f\uff6f! \u266c</chat><chat>...</chat>\n```\n\n## \u6210\u679c\u7269\uff08Electron\u88fd\u30b3\u30e1\u30f3\u30c8\u30d3\u30e5\u30fc\u30a2\u30fc\uff09\n![d06cf958-ebda-11e4-9d22-5f9420129523.png](https://qiita-image-store.s3.amazonaws.com/0/28576/59adc15b-9d61-439b-7392-62b98daaddfa.png)\n\n* [edgy-comment-viewer/59naga - Latest release | github](https://github.com/59naga/edgy-comment-viewer/releases/latest)\n* [nicolive/59naga Command line comment viewer | github](https://github.com/59naga/nicolive)\n* [nicolive.io/59naga \u30cb\u30b3\u30cb\u30b3\u751f\u653e\u9001\u306e\u30b3\u30e1\u30f3\u30c8\u30b5\u30fc\u30d0\u30fc\u306e\u5bc4\u751f\u30b5\u30fc\u30d0\u30fc | github](https://github.com/59naga/nicolive.io)\n* [nicolive.berabou.me/59naga HTML5\u30b3\u30e1\u30f3\u30c8\u30d3\u30e5\u30fc\u30a2\u30fc | github](https://github.com/59naga/nicolive.berabou.me)\n\n## \u53c2\u8003\n* [request | npm](https://www.npmjs.com/package/request)\n* [cheerio | npm](https://www.npmjs.com/package/cheerio)\n* [niconico\u306e\u30e1\u30c3\u30bb\u30fc\u30b8(\u30b3\u30e1\u30f3\u30c8)\u30b5\u30fc\u30d0\u30fc\u306e\u30bf\u30b0\u3084\u9001\u308a\u65b9\u306e\u8aac\u660e - \u795e\u306e\u5473\u564c\u6c41\u9752\u6d77](https://web.archive.org/web/20141224124355/http://blog.goo.ne.jp/hocomodashi/e/3ef374ad09e79ed5c50f3584b3712d61)\n* [\u30cb\u30b3\u30cb\u30b3API\u30ea\u30b9\u30c8wiki](http://www59.atwiki.jp/nicoapi/)\n* [node-nicovideo-api/Ragg- | github](https://github.com/Ragg-/node-nicovideo-api)\n", "tags": ["Electron", "atom-shell", "Node.js"]}