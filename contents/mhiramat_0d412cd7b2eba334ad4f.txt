{"context": "\n\n\u3053\u308c\u306f\u4f55\u304b\nIntel\u304c2\u5e74\u307b\u3069\u524d\u306b\u4eee\u60f3\u74b0\u5883\u3068\u30b3\u30f3\u30c6\u30ca\u3092\u7d44\u307f\u5408\u308f\u305b\u305fClear Container\u3092\u767a\u8868\u3057\u307e\u3057\u305f\u304c\u3001\u5b9f\u88c5\u3092\u8abf\u3079\u308b\u306e\u3092\u9762\u5012\u304f\u3055\u304c\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\u4eca\u56deLPC\u3067\u300cQemu\u30689pfs\u3092\u7d44\u307f\u5408\u308f\u305b\u305f\u300d\u3068\u3044\u3046\u8a71\u3092\u805e\u3044\u305f\u306e\u3067\u3001\u65e9\u901fMINCS(Mini Container Shellscripts)\u306b\u5b9f\u88c5\u3057\u3066\u3001\u5b9f\u969b\u306b\u3069\u3046\u52d5\u304f\u306e\u304b\u3092\u8a66\u3057\u307e\u3057\u305f\u3002\u3061\u3087\u3046\u3069Linux Advent Calender\u304c\u3042\u3063\u305f\u306e\u3067\u5831\u544a\u3057\u307e\u3059\u3002\n\nMINCS Qemu mode\nMINCS Qemu mode\u306f\u6307\u5b9a\u3057\u305f\u30b3\u30f3\u30c6\u30carootfs\u306e\u4e0a\u3067\u3001Qemu\u3092\u4f7f\u3063\u305f\u30b3\u30f3\u30c6\u30ca\u3092\u5b9f\u884c\u3059\u308b\u30e2\u30fc\u30c9\u3067\u3059\u3002\u5358\u7d14\u306b\u9762\u767d\u3044\u306e\u3067\u5b9f\u88c5\u3057\u305f\u611f\u3058\u3067\u3001\u9694\u96e2\u6027\u306f\u9ad8\u3044\u3082\u306e\u306e\u3001\u3042\u307e\u308a\u5b9f\u7528\u6027\u306f\u306a\u3044\u3067\u3059\uff08\u7b11\uff09\u3002Clear Container\u3068\u306f\u9055\u3044\u3001MINCS\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u52d5\u4f5c\u30e2\u30fc\u30c9\u306e\u4e00\u3064\u3068\u3057\u3066\u52d5\u304d\u307e\u3059\u3002\uff08\u540c\u3058\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u3063\u3066\u666e\u901a\u306e\u30b3\u30f3\u30c6\u30ca\u3068Qemu\u30b3\u30f3\u30c6\u30ca\u306e\u4e21\u65b9\u3092\u8a66\u305b\u307e\u3059\uff09\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5\nMINCS\u81ea\u4f53\u306fgithub\u304b\u3089\u30c1\u30a7\u30c3\u30af\u30a2\u30a6\u30c8\u3059\u308b\u3060\u3051\u3067\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n\n $ git clone https://github.com/mhiramat/mincs.git\n\nMINCS\u306f\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306a\u306e\u3067\u7279\u306b\u30d3\u30eb\u30c9\u306e\u5fc5\u8981\u306f\u306a\u3044\u306e\u3067\u3059\u304c\u3001Qemu\u30e2\u30fc\u30c9\u306fQemu(KVM)\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u4e0a\u3067\u52d5\u304fLinux\u3092\u30d3\u30eb\u30c9\u3057\u306a\u3051\u308c\u3070\u52d5\u304d\u307e\u305b\u3093\u3002\u4e88\u3081Linux\u30ab\u30fc\u30cd\u30eb\u3068Busybox\u304c\u30d3\u30eb\u30c9\u3067\u304d\u308b\u74b0\u5883\u3067\u3042\u308c\u3070\u3001MINCS\u5185\u306eermine-breeder\u3092\u5b9f\u884c\u3059\u308b\u3068\u30db\u30b9\u30c8\u74b0\u5883\u5411\u3051\u306e\uff08\u591a\u5206x86_64\u5411\u3051\u306e)ermine\u30a4\u30e1\u30fc\u30b8\u304c\u30d3\u30eb\u30c9\u3067\u304d\u307e\u3059\u3002\n $ cd mincs\n $ ./ermine-breeder build\n\n\u30aa\u30d7\u30b7\u30e7\u30f3\u3068\u3057\u3066--config\u3067\u30b3\u30f3\u30d5\u30a3\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u6e21\u305b\u308b\u306e\u3067\u3059\u304c\u3001samples/ermine/smallconfig\u3092\u6e21\u3059\u3068\u5272\u3068\u3044\u3044\u611f\u3058\u306b\u5c0f\u3055\u3044\u76ee\u306e\u30a4\u30e1\u30fc\u30b8\u304c\u30d3\u30eb\u30c9\u3055\u308c\u307e\u3059\u3002\n $ ./ermine-breeder build --config samples/ermine/smallconfig\n\n\u304a\u4f7f\u3044\u306e\u74b0\u5883\u306b\u3069\u3046\u3057\u3066\u3082\u30ab\u30fc\u30cd\u30eb\u30d3\u30eb\u30c9\u74b0\u5883\u3092\u4f5c\u308b\u306e\u306f\u5acc\u3060\uff01\u3068\u3044\u3046\u5834\u5408\u306f\u3001Docker\u3067\u74b0\u5883\u3092\u4f5c\u308b\u304b\u3001debootstrap\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u4e0a\u3067ermine-breeder\u306bselfbuild\u30b3\u30de\u30f3\u30c9\u3092\u6e21\u305b\u3070\u3001\u81ea\u5206\u3067\u74b0\u5883\u3092\u4f5c\u3063\u3066\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\n $ ./ermine-breeder selfbuild\n\n\n\u4f7f\u3044\u65b9\n\u7279\u6b8a\u306a\u4f7f\u3044\u65b9\u306f\u7279\u306b\u5fc5\u8981\u306a\u304f\u3001--qemu\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u308b\u3060\u3051\u52d5\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070\u73fe\u5728\u306e\u30eb\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u4e0a\u3067Qemu\u30b3\u30f3\u30c6\u30ca\u3092\u52d5\u304b\u3059\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n $ sudo ./minc --qemu\n\ndebootstrap\u3084docker\u304b\u3089\u501f\u308a\u3066\u304d\u305f\u30b3\u30f3\u30c6\u30ca\u306e\u30eb\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u304c\u3042\u308b\u306a\u3089\u3001\u305d\u308c\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3082\u51fa\u6765\u307e\u3059\u3002\n $ sudo ./minc --qemu -r ./debian-root/\n\n\u3055\u3089\u306b\u3001\u975e\u7279\u6a29\u30e6\u30fc\u30b6\u30b3\u30f3\u30c6\u30ca\u3092Qemu\u30e2\u30fc\u30c9\u3067\u52d5\u304b\u3059\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n $ ./minc --qemu --nopriv ./nonroot-root/\n\n\nQemu Container\u306e\u57fa\u672c\u7684\u306a\u4ed5\u7d44\u307f\n\u7686\u3055\u3093\u3054\u5b58\u77e5\u306e\u901a\u308a\u3001Qemu\u3067\u306f\u30c7\u30a3\u30b9\u30af\u30a4\u30e1\u30fc\u30b8\u3092\u30d6\u30ed\u30c3\u30af\u30c7\u30d0\u30a4\u30b9\u3068\u3057\u3066\u898b\u305b\u308b\u3060\u3051\u3067\u306f\u306a\u304f\u3001\u30db\u30b9\u30c8\u306e\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30929pfs\u7d4c\u7531\u3067\u30b2\u30b9\u30c8\u306b\u898b\u305b\u308b\u6a5f\u80fd\u304c\u3042\u308a\u307e\u3059\u3002\u4e00\u65b9\u3001Linux\u30ab\u30fc\u30cd\u30eb\u5074\u306b\u306f9pfs\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068\u306a\u3063\u3066\u30de\u30a6\u30f3\u30c8\u3059\u308b\u6a5f\u80fd\u304c\u3042\u308a\u307e\u3059\u3002Intel\u306eClear Container\u306f\u57fa\u672c\u7684\u306b\u3053\u306e\u4ed5\u7d44\u307f\u3092\u5229\u7528\u3057\u3066\u3001\u30db\u30b9\u30c8\u5074\u3067\u7528\u610f\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\uff08\u4e00\u822c\u306b\u306fRootfs\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\uff09\u3092\u30b2\u30b9\u30c8\u5074\u3067\u30de\u30a6\u30f3\u30c8\u3057\u3001\u305d\u3053\u306bchroot(\u3042\u308b\u3044\u306fpivot_root\u304bswitch_root)\u3059\u308b\u3053\u3068\u3067\u5b9f\u88c5\u3057\u3066\u3044\u308b\u3068\u8003\u3048\u3089\u308c\u307e\u3059\u3002\n\u3053\u306e\u6a5f\u80fd\u3092\u30b3\u30f3\u30c6\u30ca\u306b\u5b9f\u88c5\u3059\u308b\u306b\u3042\u305f\u3063\u3066\u306e\u524d\u63d0\u6761\u4ef6\u3092\u8003\u3048\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u307e\u305a\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u4f7f\u3046\u306e\u3067\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u4e0a\u3067\u52d5\u304b\u3059\u30b3\u30f3\u30c6\u30caOS\u3001\u3064\u307e\u308aLinux\u30ab\u30fc\u30cd\u30eb\u53ca\u3073\u30b3\u30f3\u30c6\u30ca\u30a8\u30f3\u30b8\u30f3\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\u4eee\u60f3\u30de\u30b7\u30f3\u4e0a\u3067\u30b3\u30f3\u30c6\u30ca\u30a8\u30f3\u30b8\u30f3\u3092\u52d5\u304b\u3055\u305a\u3001\u76f4\u63a5\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3092Qemu\u4e0a\u3067\u52d5\u304b\u3059\u65b9\u6cd5\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u4e00\u822c\u306e\u30b3\u30f3\u30c6\u30ca\u3068\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089\u898b\u305f\u6642\u306e\u74b0\u5883\u304c\u9055\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u4f59\u308a\u304a\u52e7\u3081\u306f\u3067\u304d\u307e\u305b\u3093\u3002Intel\u306eClear Container\u3067\u306f\u3053\u306eOS\u90e8\u5206\u3092Clear Linux\u3068\u547c\u3093\u3067\u3044\u307e\u3059\u3002\n\u30b3\u30f3\u30c6\u30caOS\u306b\u6700\u4f4e\u9650\u5fc5\u8981\u306a\u306e\u306f\u3001KVM\u74b0\u5883\u3067\u8d77\u52d5\u3059\u308b\u3053\u3068\u30019pfs(virtio 9pfs)\u306e\u30de\u30a6\u30f3\u30c8\u304c\u3067\u304d\u308b\u3053\u3068\u3001\u305d\u3057\u3066\u540d\u524d\u7a7a\u9593\u6a5f\u80fd\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u3053\u3068\u3067\u3059\u3002\u305d\u306e\u4ed6\u3001\u9ad8\u901f\u8d77\u52d5\u3084\u30b5\u30a4\u30ba\u306e\u6700\u5c0f\u5316\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u9694\u96e2\u6a5f\u80fd\u306a\u3069\u3082\u3042\u308b\u3068\u5b09\u3057\u3044\u7279\u5fb4\u3067\u3057\u3087\u3046\u3002\n\u307e\u305f\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u52d5\u304b\u3059\u74b0\u5883\u3092\u4f5c\u308b\u305f\u3081\u306e\u30b3\u30f3\u30c6\u30ca\u304c\u5fc5\u8981\u3067\u3059\u3002\u3053\u308c\u306f\u5fc5\u9808\u3067\u306f\u306a\u3044\u3067\u3059\u304c\u3001\u30db\u30b9\u30c8\u5074\u3067\u30b3\u30f3\u30c6\u30ca\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u69d8\u5b50\u3092\u3001\u4ed6\u306e\u30e6\u30fc\u30b6\u304b\u3089\u898b\u3048\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u52b9\u679c\u304c\u3042\u308a\u307e\u3059\u3002\n\nMINCS\u3067\u306e\u30b3\u30f3\u30c6\u30caOS\u306e\u5b9f\u88c5\nMINCS\u3067\u306f\u4eee\u60f3\u30de\u30b7\u30f3\u4e0a\u3067\u52d5\u304b\u3059\u30b3\u30f3\u30c6\u30ca\u7528OS\u3092\u5b9f\u88c5\u3059\u308b\u306b\u3042\u305f\u308a\u3001busybox+libcap+Linux\u3092\u4f7f\u3044\u307e\u3057\u305f\uff08\u4f5c\u308a\u59cb\u3081\u306fboot2minc\u3092\u30d9\u30fc\u30b9\u306b\u3057\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u30e9\u30a4\u30bb\u30f3\u30b9\u306e\u3053\u3068\u3082\u3042\u3063\u305f\u306e\u3067\u5b8c\u5168\u306b\u4f5c\u308a\u306a\u304a\u3057\u307e\u3057\u305f\uff09\u3002\u3061\u306a\u307f\u306bBusybox\u306e1.24\u304b\u3089\u306funshare\u30b3\u30de\u30f3\u30c9\u3082\u5b9f\u88c5\u3055\u308c\u3066\u304a\u308a\u3001\u57fa\u672c\u7684\u306a\u30b3\u30f3\u30c6\u30ca\u306e\u6a5f\u80fd\u306fBusybox\u3060\u3051\u3067\u5b9f\u73fe\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002libcap\u304c\u5fc5\u8981\u306a\u7406\u7531\u306f\u65e2\u306b\u66f8\u304d\u307e\u3057\u305f\u3002\n9pfs\u306e\u30de\u30a6\u30f3\u30c8\u6a5f\u80fd\u3084\u540d\u524d\u7a7a\u9593\u306a\u3069\u306f\u30ab\u30fc\u30cd\u30eb\u306e\u30b3\u30f3\u30d5\u30a3\u30b0\u3067\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002MINCS\u3067\u306f\u3053\u308c\u3092ermine\uff08\u30aa\u30b3\u30b8\u30e7\uff091\u3068\u540d\u3065\u3051\u3066\u3044\u307e\u3059\u3002\u307e\u305f\u3001qemu\u4e0a\u3067\u8d77\u52d5\u3055\u305b\u308b\u3053\u3068\u304c\u76ee\u7684\u306a\u306e\u3067\u3001ISO\u30a4\u30e1\u30fc\u30b8\u3067\u306f\u306a\u304f\u3001\u666e\u901a\u306bbzImage\u3068initramfs\u3092\u4f7f\u3046\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\u30b5\u30a4\u30ba\u306b\u95a2\u3057\u3066\u8a00\u3048\u3070\u3001\u6b86\u3069\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u6a5f\u80fd\u3092\u6709\u52b9\u306b\u3057\u305f\u3060\u3051\u3067\u3059\u304c\u30018MB\u7a0b\u5ea6\u3067\u5b9f\u88c5\u304c\u3067\u304d\u3066\u3044\u307e\u3059\u3002\u8a66\u3057\u306b\u7c21\u5358\u306b\u4e0d\u8981\u306a\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u524a\u3063\u305f\u3068\u3053\u308d\u3001\u30ab\u30fc\u30cd\u30eb\uff0bbusybox\u30675MB\u3092\u5207\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3057\u305f\u3002\u591a\u5206\u3082\u3046\u5c11\u3057\u524a\u308b\u3053\u3068\u306f\u53ef\u80fd\u3067\u3057\u3087\u3046\u3002\n\n9pfs\u306b\u3088\u308b\u30db\u30b9\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30de\u30a6\u30f3\u30c8\nQemu\u306ewiki\u306b\u66f8\u3044\u3066\u3044\u308b\u901a\u308a\u8a2d\u5b9a\u3059\u308c\u3070\u30db\u30b9\u30c8\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30b2\u30b9\u30c8\u304b\u3089\u30de\u30a6\u30f3\u30c8\u3067\u304d\u307e\u3059\u3002Qemu\u306e\u8d77\u52d5\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u4ee5\u4e0b\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3067\u30db\u30b9\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3068mount_tag\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n    -virtfs fsdriver,id=[id],path=[path to share],security_model=[mapped|passthrough|none][,writeout=writeout][,readonly]\n     [,socket=socket|sock_fd=sock_fd],mount_tag=[mount tag]\n\n\u30b2\u30b9\u30c8\u304b\u3089\u306f\u3001mount_tag\u3067\u6307\u5b9a\u3057\u305f\u6587\u5b57\u5217\u3092\u30c7\u30d0\u30a4\u30b9\u3068\u3057\u3066\u30de\u30a6\u30f3\u30c8\u3059\u308c\u3070OK\u3067\u3059\u3002\u30aa\u30d7\u30b7\u30e7\u30f3\u3067trans=virtio\u3092\u6e21\u3059\u306e\u3092\u5fd8\u308c\u306a\u3044\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u30029pfs\u306b\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f7f\u3063\u305f\u30de\u30a6\u30f3\u30c8\u65b9\u6cd5\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u30db\u30b9\u30c8\u304b\u3089\u3057\u304b\u6e21\u3055\u306a\u3044\u306e\u3067\u3042\u308c\u3070virtio\u3067\u76f4\u63a5\u6e21\u3059\u307b\u3046\u304c\u52b9\u7387\u7684\u3067\u3057\u304b\u3082\u7c21\u6f54\u3067\u3059\u3002\nmount -t 9p -o trans=virtio [mount tag] [mount point] -oversion=9p2000.L\n\n\n\u6307\u5b9a\u3055\u308c\u305f\u30b3\u30f3\u30c6\u30ca\u306e\u81ea\u52d5\u5b9f\u884c\nErmine\u3067\u306f\u3001\u30b3\u30f3\u30c6\u30ca\u306erootfs\u3092\u6307\u5b9a\u3055\u308c\u305f\u5834\u5408\u306f\u30b3\u30f3\u30c6\u30ca\u3092\u81ea\u52d5\u5b9f\u884c\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\u30b3\u30f3\u30c6\u30ca\u306erootfs\u3092\u6307\u5b9a\u3055\u308c\u305f\u304b\u3069\u3046\u304b\u306f\u3001kernel\u306e\u30d6\u30fc\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3088\u3063\u3066\u6319\u52d5\u3092\u5909\u3048\u308b\u3053\u3068\u304c\u8003\u3048\u3089\u308c\u307e\u3059\u304c\u3001\u5c06\u6765\u7684\u306b\u30ab\u30fc\u30cd\u30eb\u306e\u30d1\u30e9\u30e1\u30bf\u3068\u885d\u7a81\u3057\u306a\u3044\u304b\u3069\u3046\u304b\u304c\u5fc3\u914d\u306b\u306a\u308a\u307e\u3059\u3002\n\u305d\u3053\u3067Ermine\u3067\u306f\u3001\u5358\u306b\u4e8b\u524d\u306b\u6c7a\u3081\u305fmount_tag(minc)\u3092\u6307\u5b9a\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u304b\u3069\u3046\u304b\u3060\u3051\u3067\u5224\u65ad\u3057\u307e\u3059\u3002\u30de\u30a6\u30f3\u30c8\u304c\u4e0d\u53ef\u80fd\u3067\u3042\u308c\u3070\u3001\u305d\u306e\u307e\u307e\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u7528\u306ebusybox shell(/bin/sh)\u306b\u79fb\u52d5\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001minc\u306e\u8d77\u52d5\u30d1\u30e9\u30e1\u30bf\u306e\u3046\u3061\u3001\u30db\u30b9\u30c8\u540d\u306a\u3069\u306fqemu\u5185\u90e8\u306b\u4f1d\u3048\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u3053\u3067qemu\u5185\u90e8\u3067\u8d77\u52d5\u3059\u308bminc\u30b3\u30de\u30f3\u30c9\u306f\u5916\u90e8\u304b\u3089\u4e0e\u3048\u3089\u308c\u308b\u3088\u3046\u30019pfs\u3067\u30de\u30a6\u30f3\u30c8\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3042\u308brun.sh\u3092\u81ea\u52d5\u5b9f\u884c\u3059\u308b\u3053\u3068\u3068\u3057\u307e\u3059\u3002\n\nermine-breeder\n  cat > mincshell.sh << EOF\n#!/bin/sh\n\nrun_minc() {\nif mount -t 9p -o trans=virtio minc /mnt -oversion=9p2000.L,posixacl,cache=loose\n ; then\n  if [ -f /mnt/run.sh ]; then\n    /bin/cttyhack sh /mnt/run.sh\n    exec poweroff\n  fi\nfi\n}\n\n\n\u3053\u306erun.sh\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306bminc-exec\u5185\u90e8\u3067\u52d5\u7684\u306b\u4f5c\u6210\u3057\u3066\u3044\u307e\u3059\u3002\n\nlibexec/minc-exec\n    MINC_GUEST_OPT=\"-r /mnt/root --name `hostname`\"\n    if [ -z \"$MINC_DIRECT\" ]; then\n      # if the host mounts overlayfs on rootfs, guest skips it.\n      MINC_GUEST_OPT=\"$MINC_GUEST_OPT -D\"\n    fi\n    echo \"#!/bin/sh\" > $MINC_TMPDIR/run.sh\n    echo \"minc $MINC_GUEST_OPT \\\"$@\\\"\" >> $MINC_TMPDIR/run.sh\n\n\n\u30b3\u30e1\u30f3\u30c8\u306b\u3042\u308b\u3088\u3046\u306b\u3001\u5b9f\u306foverlayfs\u306e\u51e6\u7406\u306f\u30db\u30b9\u30c8\u5074\u3067\u884c\u3044\u3001Qemu\u5185\u90e8\u3067\u306f9pfs\u3067\u898b\u3048\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u76f4\u63a5\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u3046\u3059\u308b\u3053\u3068\u3067\u4e00\u3005\u30b2\u30b9\u30c8\u5074\u306b\u8907\u6570\u306eoverlay\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u898b\u305b\u308b\u5fc5\u8981\u6027\u3092\u306a\u304f\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001\u30b2\u30b9\u30c8\u306b\u898b\u305b\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3082\u3001\u30b3\u30f3\u30c6\u30ca\u3092\u5b9f\u884c\u3057\u305f\u3044\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u305d\u306e\u3082\u306e\u3067\u306f\u306a\u304f\u3001\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u542b\u3080\u3082\u3046\u4e00\u3064\u4e0a\u306e\u4e00\u6642\u30c7\u30a3\u30ec\u30af\u30c8\u30ea($MINC_TMPDIR)\u3092\u898b\u305b\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u3063\u3066\u3001\u3053\u306e\u4e00\u6642\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4e0a\u306erun.sh\u304c\u30b3\u30f3\u30c6\u30ca\u5185\u90e8\u304b\u3089\u898b\u3048\u306a\u3044\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\ninitramfs\u3068pivot_root\n\u6700\u8fd1\u306e\u30ab\u30fc\u30cd\u30eb\u3067\u306f\u3001initrd\u304b\u3089initramfs\u306b\u6a19\u6e96\u306eon-memory boot\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u304c\u5909\u308f\u3063\u3066\u3044\u307e\u3059\u3002initramfs\u306fLinux\u30ab\u30fc\u30cd\u30eb\u3067\u306f\u300crootfs\u300d\u3068\u3044\u3046\u540d\u524d\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3068\u3057\u3066\u8a8d\u8b58\u3055\u308c\u307e\u3059\u3002\u3068\u3053\u308d\u304c\u3053\u308c\u306f\u30eb\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u5c02\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306a\u306e\u3067\u3001pivot_root\u3059\u308b\u306a\u3069\u3057\u3066\u5225\u306e\u7b87\u6240\u306b\u30de\u30a6\u30f3\u30c8\u3057\u3066\u4f7f\u3046\u3053\u3068\u304c\u51fa\u6765\u307e\u305b\u3093\u3002\ninitramfs\u3067\u306fswitch_root\u3092\u4f7f\u3046\u3053\u3068\u3067\u65b0\u3057\u3044\u30eb\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306b\u30de\u30a6\u30f3\u30c8\u30dd\u30a4\u30f3\u30c8\u3092\u5207\u308a\u66ff\u3048\u53ef\u80fd\u306a\u306e\u3067\u3059\u304c\u3001ermine\u3067\u306fswitch_root\u306f\u4f7f\u3044\u307e\u305b\u3093\u3002\u7406\u7531\u306f\u7c21\u5358\u3067\u3001\u30b3\u30f3\u30c6\u30ca\u304c\u7d42\u4e86\u3057\u305f\u6642\u306b\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u843d\u3068\u3057\u305f\u3044\u306e\u3067\u3001initramfs\u4e0a\u306epoweroff\u30b3\u30de\u30f3\u30c9\u3092\u547c\u3073\u51fa\u3057\u3066\u3044\u308b\u304b\u3089\u3067\u3059\u3002switch_root\u3092\u4f7f\u3063\u3066\u5207\u308a\u66ff\u3048\u305f\u5834\u5408\u3001\u5143\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u6d88\u3055\u308c\u3066\u3057\u307e\u3046\u306e\u3067poweroff\u3082\u4f7f\u3048\u306a\u3044\u3068\u3044\u3046\u8a33\u3067\u3059\u3002\n\u305f\u3060\u3001\u3044\u305a\u308c\u306f\u88cf\u3067\u8d70\u3063\u3066\u3044\u308binit\u304b\u3089powerdown\u3059\u308c\u3070\u3044\u3044\u306e\u3067\u3001\u6700\u7d42\u7684\u306b\u306fswitch_root\u306b\u4e57\u308a\u63db\u3048\u308b\u306e\u304c\u597d\u307e\u3057\u3044\u3067\u3057\u3087\u3046\u3002\uff08switch_root\u306f\u5143\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u5168\u90e8\u6d88\u3057\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u307e\u3042\u5b89\u5168\u3068\u3044\u3048\u3070\u5b89\u5168\u3067\u3059\uff09\n\nShutdown message\nMINCS\u306eqemu\u30e2\u30fc\u30c9\u3067\u306f\u4eee\u60f3\u74b0\u5883\u306ettyS0\u3092\u73fe\u5728\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3059\u308b\u3053\u3068\u3067\u3001\u901a\u5e38\u306e\u30b3\u30f3\u30c6\u30ca\u30e2\u30fc\u30c9\u3068\u306e\u540c\u69d8\u306b\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\u3057\u304b\u3057inittab\u3092\u304d\u3061\u3093\u3068\u8a2d\u5b9a\u3057\u306a\u3044\u3068\u3001\u30ab\u30fc\u30cd\u30eb\u306e\u8d77\u52d5\u30ed\u30b0\u3084\u7d42\u4e86\u30ed\u30b0\u304c\u8868\u793a\u3055\u308c\u3066\u3057\u307e\u3044\u3001\u30e6\u30fc\u30b6\u304b\u3089\u898b\u305f\u6642\u306b\u3001qemu\u306e\u90e8\u5206\u304c\u900f\u904e\u7684\u306b\u6271\u3048\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\u57fa\u672c\u7684\u306a\u65b9\u91dd\u3068\u3057\u3066\u306f\u3001\u30ab\u30fc\u30cd\u30eb\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306fttyS0\u306b\u51fa\u3055\u306a\u3044\u3001\u3057\u304b\u3057\u30b3\u30f3\u30c6\u30ca\u306fttyS0\u306b\u51fa\u3057\u305f\u3044\u3001\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\u305d\u3053\u3067inittab\u3067\u5de5\u592b\u3092\u3057\u3001\u30ab\u30fc\u30cd\u30eb\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3092ttyS0\u306b\u51fa\u3055\u306a\u3044\u3088\u3046\u306b\u3057\u305f\u4e0a\u3067\u3001/sbin/init\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u51fa\u529b\u3057\uff08\u3064\u307e\u308a\u8868\u793a\u3055\u308c\u306a\u3044\uff09\u3001ttyS0\u4e0a\u3067\u30b7\u30a7\u30eb\u3092\u52d5\u304b\u3059\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\ninittab\n::sysinit:/etc/rc.local\n::restart:/sbin/init\n::ctrlaltdel:/sbin/reboot\nttyS0::respawn:/bin/cttyhack /mincshell.sh\n\n\n\u672c\u5f53\u306f/sbin/init\u306e\u4ee3\u308f\u308a\u306b/bin/sh\u3092\u76f4\u63a5\u53e9\u3051\u3070\u826f\u3044\u306e\u304b\u3082\u3057\u308c\u306a\u3044\u3067\u3059\u304c\u3001\u3044\u305a\u308c\u306b\u3057\u3066\u3082\u30b3\u30f3\u30c6\u30ca\u7d42\u4e86\u6642\u306b\u81ea\u52d5\u7684\u306bpoweroff\u30b3\u30de\u30f3\u30c9\u3092\u53e9\u3044\u3066qemu\u3092\u7d42\u4e86\u3055\u305b\u305f\u3044\u306e\u3067\u73fe\u5728\u306e\u5b9f\u88c5\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\nQemu Container mode\u306e\u5229\u70b9\nMINCS\u306eQemu\u30e2\u30fc\u30c9\u6a5f\u80fd\u3092\u4f7f\u3046\u3068\u3001\u975e\u7279\u6a29\u30e6\u30fc\u30b6\u3067\u3042\u3063\u3066\u3082\u4eee\u60f3\u74b0\u5883\u5185\u3067\u306f\u7279\u6a29\u30e6\u30fc\u30b6\u306b\u306a\u308b\u305f\u3081\u3001overlayfs\u306a\u3069\u304c\u4f7f\u3044\u305f\u3044\u653e\u984c\u306b\u306a\u308b\u3068\u3044\u3046\u7279\u5178\u304c\u3042\u308a\u307e\u3059\u3002\u5f93\u6765\u306e\u975e\u7279\u6a29\u30b3\u30f3\u30c6\u30ca\u306f\u4f7f\u3044\u3084\u3059\u304f\u3066\u3082overlayfs\u3092\u4f7f\u3063\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u30b3\u30f3\u30c6\u30ca\u306erootfs\u3078\u306e\u5909\u66f4\u304c\u305d\u306e\u307e\u307e\u6b8b\u3063\u3066\u3057\u307e\u3046\u3068\u3044\u3046\u554f\u984c\u304c\u3042\u308a\u307e\u3057\u305f\u3002\u4eee\u60f3\u74b0\u5883\u3092\u4f7f\u3046\u3053\u3068\u3067\u3053\u306e\u70b9\u3092\u89e3\u6d88\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\n\u307e\u305f\u3001\u30b7\u30b9\u30c6\u30e0\u5168\u4f53\u3092VM\u306b\u3059\u308b\u3053\u3068\u3067\u3001\u5225\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u30a8\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u306b\u3082\u7528\u3044\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u30592\u3002\n\nQemu Container mode\u306e\u8ab2\u984c\n\u305f\u3060\u3057\u3001\u6b20\u70b9\u3082\u3042\u308a\u307e\u3059\u3002\u4f8b\u3048\u3070\u8d77\u52d5\u30fb\u7d42\u4e86\u306b\u304b\u304b\u308b\u6642\u9593\u304c\u9577\u3044\u3053\u3068\uff08\u3053\u308c\u306f\u4eee\u60f3\u30de\u30b7\u30f3\u81ea\u4f53\u306e\u521d\u671f\u5316\u306e\u9045\u3055\u3068\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u5185\u306eLinux\u81ea\u4f53\u306e\u8d77\u52d5\u306e\u9045\u3055\u304c\u539f\u56e0\u3067\u3059\u306e\u3067\u3001\u6700\u9069\u5316\u3092\u884c\u3048\u3070\u30de\u30b7\u306b\u306a\u308a\u307e\u3059\uff09\u3001\u30b3\u30f3\u30c6\u30ca\u306e\u7d42\u4e86\u6642\u306e\u623b\u308a\u5024\u304c\u5f97\u3089\u308c\u306a\u3044\u3053\u3068\u3001\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u304c\u591a\u3044\u3053\u3068\uff08\u3053\u308c\u3082\u6700\u9069\u5316\u3067\u306a\u3093\u3068\u304b\u306a\u308b\uff06KSM\u3067\u8efd\u6e1b\u304c\u53ef\u80fd\u3060\u304c\u3001\u96a3\u304b\u3089\u30e1\u30e2\u30ea\u5185\u5bb9\u3092\u4e88\u6e2c\u3055\u308c\u308b\u8106\u5f31\u6027\u306e\u6307\u6458\u3082\u3042\u308a\uff09\u306a\u3069\u304c\u3042\u308a\u307e\u3059\u3002\n\u3055\u3089\u306b\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u81ea\u4f53\u306b\u3044\u304f\u3089CPU\u3068\u30e1\u30e2\u30ea\u3092\u5272\u308a\u5f53\u3066\u308b\u304b\u3092\u660e\u78ba\u306b\u3057\u306a\u3044\u3068\u4f7f\u3044\u306b\u304f\u3044\u306e\u3082\u5b9f\u7528\u4e0a\u306f\u554f\u984c\u306b\u306a\u308b\u3067\u3057\u3087\u3046\u3002\u30b3\u30f3\u30c6\u30ca\u3092\u4f7f\u3046\u591a\u304f\u306e\u5834\u5408\u3001\u76ee\u7684\u306f\u30d1\u30c3\u30b1\u30fc\u30b8\u5316\u3055\u308c\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5b9f\u884c\u74b0\u5883\u3092\u7c21\u5358\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u3066\u5b9f\u884c\u3057\u305f\u3044\u3001\u3068\u3044\u3046\u7c21\u6f54\u306a\u7406\u7531\u3060\u3068\u601d\u308f\u308c\u307e\u3059\u3002\u305d\u306e\u5834\u5408\u304d\u3063\u3061\u308a\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u5272\u5f53\u8a2d\u8a08\u3092\u3059\u308b\u3068\u3001\u67d4\u8edf\u6027\u3084\u7c21\u6f54\u6027\u304c\u5931\u308f\u308c\u3066\u3001\u9762\u5012\u306a\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\nErmine\u3067\u306f\u73fe\u72b6\u3001Qemu\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u306a\u306e\u3067VM\u30ea\u30bd\u30fc\u30b9\u306f\u975e\u5e38\u306b\u5c11\u306a\u3044\u3067\u3059\u304c\u3001\u3053\u308c\u3082\u6700\u9069\u5024\u304c\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u306e\u3067\u5909\u66f4\u304c\u3057\u306b\u304f\u3044\u306e\u304c\u96e3\u70b9\u3067\u3059\u3002\n\n\n\n\n\u767d\u304f\u3066\u30af\u30ea\u30a2\u306a\u30df\u30f3\u30af\u304b\u3089\u3002\u3061\u306a\u307f\u306bermine\u306e\u30d3\u30eb\u30c9\u30b9\u30af\u30ea\u30d7\u30c8(ermine-breeder)\u3092\u542b\u3080MINCS\u672c\u4f53\u306fMIT\u30e9\u30a4\u30bb\u30f3\u30b9\u306a\u306e\u306b\u3001\u30d3\u30eb\u30c9\u3057\u305fermine\u306e\u30a4\u30e1\u30fc\u30b8\u306fGPLv2(linux)\u3068v3(busybox)\u306e\u6df7\u5728\u3068\u306a\u308b\u306e\u3067\u3001\u914d\u5e03\u5f62\u614b\u306f\u6ce8\u610f\u304c\u5fc5\u8981\u3002\u00a0\u21a9\n\n\nErmine\u3067\u306f\u73fe\u5728\u3001x86_64\u4ee5\u5916\u306barm\u3068arm64\u306e\u30b5\u30dd\u30fc\u30c8\u3092\u3057\u3066\u3044\u307e\u3059\u3002\u4ed6\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306b\u3064\u3044\u3066\u306f\u3001\u30ab\u30fc\u30cd\u30eb\u3068busybox, libcap\u306e\u30af\u30ed\u30b9\u30d3\u30eb\u30c9\u304c\u53ef\u80fd\u306a\u3089\u5bfe\u5fdc\u53ef\u80fd\u3067\u3059\u3002\u00a0\u21a9\n\n\n\n#\u3053\u308c\u306f\u4f55\u304b\nIntel\u304c2\u5e74\u307b\u3069\u524d\u306b\u4eee\u60f3\u74b0\u5883\u3068\u30b3\u30f3\u30c6\u30ca\u3092\u7d44\u307f\u5408\u308f\u305b\u305fClear Container\u3092\u767a\u8868\u3057\u307e\u3057\u305f\u304c\u3001\u5b9f\u88c5\u3092\u8abf\u3079\u308b\u306e\u3092\u9762\u5012\u304f\u3055\u304c\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\u4eca\u56deLPC\u3067\u300cQemu\u30689pfs\u3092\u7d44\u307f\u5408\u308f\u305b\u305f\u300d\u3068\u3044\u3046\u8a71\u3092\u805e\u3044\u305f\u306e\u3067\u3001\u65e9\u901f[MINCS](https://github.com/mhiramat/mincs)(Mini Container Shellscripts)\u306b\u5b9f\u88c5\u3057\u3066\u3001\u5b9f\u969b\u306b\u3069\u3046\u52d5\u304f\u306e\u304b\u3092\u8a66\u3057\u307e\u3057\u305f\u3002\u3061\u3087\u3046\u3069Linux Advent Calender\u304c\u3042\u3063\u305f\u306e\u3067\u5831\u544a\u3057\u307e\u3059\u3002\n\n#MINCS Qemu mode\nMINCS Qemu mode\u306f\u6307\u5b9a\u3057\u305f\u30b3\u30f3\u30c6\u30carootfs\u306e\u4e0a\u3067\u3001Qemu\u3092\u4f7f\u3063\u305f\u30b3\u30f3\u30c6\u30ca\u3092\u5b9f\u884c\u3059\u308b\u30e2\u30fc\u30c9\u3067\u3059\u3002\u5358\u7d14\u306b\u9762\u767d\u3044\u306e\u3067\u5b9f\u88c5\u3057\u305f\u611f\u3058\u3067\u3001\u9694\u96e2\u6027\u306f\u9ad8\u3044\u3082\u306e\u306e\u3001\u3042\u307e\u308a\u5b9f\u7528\u6027\u306f\u306a\u3044\u3067\u3059\uff08\u7b11\uff09\u3002Clear Container\u3068\u306f\u9055\u3044\u3001MINCS\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u52d5\u4f5c\u30e2\u30fc\u30c9\u306e\u4e00\u3064\u3068\u3057\u3066\u52d5\u304d\u307e\u3059\u3002\uff08\u540c\u3058\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u3063\u3066\u666e\u901a\u306e\u30b3\u30f3\u30c6\u30ca\u3068Qemu\u30b3\u30f3\u30c6\u30ca\u306e\u4e21\u65b9\u3092\u8a66\u305b\u307e\u3059\uff09\n\n##\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5\nMINCS\u81ea\u4f53\u306fgithub\u304b\u3089\u30c1\u30a7\u30c3\u30af\u30a2\u30a6\u30c8\u3059\u308b\u3060\u3051\u3067\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n```\n $ git clone https://github.com/mhiramat/mincs.git\n```\nMINCS\u306f\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306a\u306e\u3067\u7279\u306b\u30d3\u30eb\u30c9\u306e\u5fc5\u8981\u306f\u306a\u3044\u306e\u3067\u3059\u304c\u3001Qemu\u30e2\u30fc\u30c9\u306fQemu(KVM)\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u4e0a\u3067\u52d5\u304fLinux\u3092\u30d3\u30eb\u30c9\u3057\u306a\u3051\u308c\u3070\u52d5\u304d\u307e\u305b\u3093\u3002\u4e88\u3081Linux\u30ab\u30fc\u30cd\u30eb\u3068Busybox\u304c\u30d3\u30eb\u30c9\u3067\u304d\u308b\u74b0\u5883\u3067\u3042\u308c\u3070\u3001MINCS\u5185\u306e`ermine-breeder`\u3092\u5b9f\u884c\u3059\u308b\u3068\u30db\u30b9\u30c8\u74b0\u5883\u5411\u3051\u306e\uff08\u591a\u5206x86_64\u5411\u3051\u306e)ermine\u30a4\u30e1\u30fc\u30b8\u304c\u30d3\u30eb\u30c9\u3067\u304d\u307e\u3059\u3002\n\n```\n $ cd mincs\n $ ./ermine-breeder build\n```\n\u30aa\u30d7\u30b7\u30e7\u30f3\u3068\u3057\u3066`--config`\u3067\u30b3\u30f3\u30d5\u30a3\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u6e21\u305b\u308b\u306e\u3067\u3059\u304c\u3001`samples/ermine/smallconfig`\u3092\u6e21\u3059\u3068\u5272\u3068\u3044\u3044\u611f\u3058\u306b\u5c0f\u3055\u3044\u76ee\u306e\u30a4\u30e1\u30fc\u30b8\u304c\u30d3\u30eb\u30c9\u3055\u308c\u307e\u3059\u3002\n\n```\n $ ./ermine-breeder build --config samples/ermine/smallconfig\n```\n\n\u304a\u4f7f\u3044\u306e\u74b0\u5883\u306b\u3069\u3046\u3057\u3066\u3082\u30ab\u30fc\u30cd\u30eb\u30d3\u30eb\u30c9\u74b0\u5883\u3092\u4f5c\u308b\u306e\u306f\u5acc\u3060\uff01\u3068\u3044\u3046\u5834\u5408\u306f\u3001Docker\u3067\u74b0\u5883\u3092\u4f5c\u308b\u304b\u3001debootstrap\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u4e0a\u3067`ermine-breeder`\u306b`selfbuild`\u30b3\u30de\u30f3\u30c9\u3092\u6e21\u305b\u3070\u3001\u81ea\u5206\u3067\u74b0\u5883\u3092\u4f5c\u3063\u3066\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\n\n```\n $ ./ermine-breeder selfbuild\n```\n\n\n##\u4f7f\u3044\u65b9\n\u7279\u6b8a\u306a\u4f7f\u3044\u65b9\u306f\u7279\u306b\u5fc5\u8981\u306a\u304f\u3001`--qemu`\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u308b\u3060\u3051\u52d5\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070\u73fe\u5728\u306e\u30eb\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u4e0a\u3067Qemu\u30b3\u30f3\u30c6\u30ca\u3092\u52d5\u304b\u3059\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```\n $ sudo ./minc --qemu\n```\n\ndebootstrap\u3084docker\u304b\u3089\u501f\u308a\u3066\u304d\u305f\u30b3\u30f3\u30c6\u30ca\u306e\u30eb\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u304c\u3042\u308b\u306a\u3089\u3001\u305d\u308c\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3082\u51fa\u6765\u307e\u3059\u3002\n\n```\n $ sudo ./minc --qemu -r ./debian-root/\n```\n\u3055\u3089\u306b\u3001\u975e\u7279\u6a29\u30e6\u30fc\u30b6\u30b3\u30f3\u30c6\u30ca\u3092Qemu\u30e2\u30fc\u30c9\u3067\u52d5\u304b\u3059\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\n```\n $ ./minc --qemu --nopriv ./nonroot-root/\n```\n\n#Qemu Container\u306e\u57fa\u672c\u7684\u306a\u4ed5\u7d44\u307f\n\u7686\u3055\u3093\u3054\u5b58\u77e5\u306e\u901a\u308a\u3001Qemu\u3067\u306f\u30c7\u30a3\u30b9\u30af\u30a4\u30e1\u30fc\u30b8\u3092\u30d6\u30ed\u30c3\u30af\u30c7\u30d0\u30a4\u30b9\u3068\u3057\u3066\u898b\u305b\u308b\u3060\u3051\u3067\u306f\u306a\u304f\u3001\u30db\u30b9\u30c8\u306e\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30929pfs\u7d4c\u7531\u3067\u30b2\u30b9\u30c8\u306b\u898b\u305b\u308b\u6a5f\u80fd\u304c\u3042\u308a\u307e\u3059\u3002\u4e00\u65b9\u3001Linux\u30ab\u30fc\u30cd\u30eb\u5074\u306b\u306f9pfs\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068\u306a\u3063\u3066\u30de\u30a6\u30f3\u30c8\u3059\u308b\u6a5f\u80fd\u304c\u3042\u308a\u307e\u3059\u3002Intel\u306eClear Container\u306f\u57fa\u672c\u7684\u306b\u3053\u306e\u4ed5\u7d44\u307f\u3092\u5229\u7528\u3057\u3066\u3001\u30db\u30b9\u30c8\u5074\u3067\u7528\u610f\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\uff08\u4e00\u822c\u306b\u306fRootfs\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\uff09\u3092\u30b2\u30b9\u30c8\u5074\u3067\u30de\u30a6\u30f3\u30c8\u3057\u3001\u305d\u3053\u306bchroot(\u3042\u308b\u3044\u306fpivot_root\u304bswitch_root)\u3059\u308b\u3053\u3068\u3067\u5b9f\u88c5\u3057\u3066\u3044\u308b\u3068\u8003\u3048\u3089\u308c\u307e\u3059\u3002\n\n\u3053\u306e\u6a5f\u80fd\u3092\u30b3\u30f3\u30c6\u30ca\u306b\u5b9f\u88c5\u3059\u308b\u306b\u3042\u305f\u3063\u3066\u306e\u524d\u63d0\u6761\u4ef6\u3092\u8003\u3048\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u307e\u305a\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u4f7f\u3046\u306e\u3067\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u4e0a\u3067\u52d5\u304b\u3059\u30b3\u30f3\u30c6\u30caOS\u3001\u3064\u307e\u308aLinux\u30ab\u30fc\u30cd\u30eb\u53ca\u3073\u30b3\u30f3\u30c6\u30ca\u30a8\u30f3\u30b8\u30f3\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\u4eee\u60f3\u30de\u30b7\u30f3\u4e0a\u3067\u30b3\u30f3\u30c6\u30ca\u30a8\u30f3\u30b8\u30f3\u3092\u52d5\u304b\u3055\u305a\u3001\u76f4\u63a5\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3092Qemu\u4e0a\u3067\u52d5\u304b\u3059\u65b9\u6cd5\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u4e00\u822c\u306e\u30b3\u30f3\u30c6\u30ca\u3068\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089\u898b\u305f\u6642\u306e\u74b0\u5883\u304c\u9055\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u4f59\u308a\u304a\u52e7\u3081\u306f\u3067\u304d\u307e\u305b\u3093\u3002Intel\u306eClear Container\u3067\u306f\u3053\u306eOS\u90e8\u5206\u3092Clear Linux\u3068\u547c\u3093\u3067\u3044\u307e\u3059\u3002\n\u30b3\u30f3\u30c6\u30caOS\u306b\u6700\u4f4e\u9650\u5fc5\u8981\u306a\u306e\u306f\u3001KVM\u74b0\u5883\u3067\u8d77\u52d5\u3059\u308b\u3053\u3068\u30019pfs(virtio 9pfs)\u306e\u30de\u30a6\u30f3\u30c8\u304c\u3067\u304d\u308b\u3053\u3068\u3001\u305d\u3057\u3066\u540d\u524d\u7a7a\u9593\u6a5f\u80fd\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u3053\u3068\u3067\u3059\u3002\u305d\u306e\u4ed6\u3001\u9ad8\u901f\u8d77\u52d5\u3084\u30b5\u30a4\u30ba\u306e\u6700\u5c0f\u5316\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u9694\u96e2\u6a5f\u80fd\u306a\u3069\u3082\u3042\u308b\u3068\u5b09\u3057\u3044\u7279\u5fb4\u3067\u3057\u3087\u3046\u3002\n\u307e\u305f\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u52d5\u304b\u3059\u74b0\u5883\u3092\u4f5c\u308b\u305f\u3081\u306e\u30b3\u30f3\u30c6\u30ca\u304c\u5fc5\u8981\u3067\u3059\u3002\u3053\u308c\u306f\u5fc5\u9808\u3067\u306f\u306a\u3044\u3067\u3059\u304c\u3001\u30db\u30b9\u30c8\u5074\u3067\u30b3\u30f3\u30c6\u30ca\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u69d8\u5b50\u3092\u3001\u4ed6\u306e\u30e6\u30fc\u30b6\u304b\u3089\u898b\u3048\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u52b9\u679c\u304c\u3042\u308a\u307e\u3059\u3002\n\n## MINCS\u3067\u306e\u30b3\u30f3\u30c6\u30caOS\u306e\u5b9f\u88c5\nMINCS\u3067\u306f\u4eee\u60f3\u30de\u30b7\u30f3\u4e0a\u3067\u52d5\u304b\u3059\u30b3\u30f3\u30c6\u30ca\u7528OS\u3092\u5b9f\u88c5\u3059\u308b\u306b\u3042\u305f\u308a\u3001busybox+libcap+Linux\u3092\u4f7f\u3044\u307e\u3057\u305f\uff08\u4f5c\u308a\u59cb\u3081\u306f[boot2minc](https://github.com/mhiramat/boot2minc)\u3092\u30d9\u30fc\u30b9\u306b\u3057\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u30e9\u30a4\u30bb\u30f3\u30b9\u306e\u3053\u3068\u3082\u3042\u3063\u305f\u306e\u3067\u5b8c\u5168\u306b\u4f5c\u308a\u306a\u304a\u3057\u307e\u3057\u305f\uff09\u3002\u3061\u306a\u307f\u306bBusybox\u306e1.24\u304b\u3089\u306funshare\u30b3\u30de\u30f3\u30c9\u3082\u5b9f\u88c5\u3055\u308c\u3066\u304a\u308a\u3001\u57fa\u672c\u7684\u306a\u30b3\u30f3\u30c6\u30ca\u306e\u6a5f\u80fd\u306fBusybox\u3060\u3051\u3067\u5b9f\u73fe\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002libcap\u304c\u5fc5\u8981\u306a\u7406\u7531\u306f[\u65e2\u306b\u66f8\u304d\u307e\u3057\u305f](http://qiita.com/mhiramat/items/5edd7eb479f9dca45b9c#chroot%E3%81%A8pivot_root)\u3002\n9pfs\u306e\u30de\u30a6\u30f3\u30c8\u6a5f\u80fd\u3084\u540d\u524d\u7a7a\u9593\u306a\u3069\u306f\u30ab\u30fc\u30cd\u30eb\u306e\u30b3\u30f3\u30d5\u30a3\u30b0\u3067\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002MINCS\u3067\u306f\u3053\u308c\u3092ermine\uff08\u30aa\u30b3\u30b8\u30e7\uff09[^1]\u3068\u540d\u3065\u3051\u3066\u3044\u307e\u3059\u3002\u307e\u305f\u3001qemu\u4e0a\u3067\u8d77\u52d5\u3055\u305b\u308b\u3053\u3068\u304c\u76ee\u7684\u306a\u306e\u3067\u3001ISO\u30a4\u30e1\u30fc\u30b8\u3067\u306f\u306a\u304f\u3001\u666e\u901a\u306bbzImage\u3068initramfs\u3092\u4f7f\u3046\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\u30b5\u30a4\u30ba\u306b\u95a2\u3057\u3066\u8a00\u3048\u3070\u3001\u6b86\u3069\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u6a5f\u80fd\u3092\u6709\u52b9\u306b\u3057\u305f\u3060\u3051\u3067\u3059\u304c\u30018MB\u7a0b\u5ea6\u3067\u5b9f\u88c5\u304c\u3067\u304d\u3066\u3044\u307e\u3059\u3002\u8a66\u3057\u306b\u7c21\u5358\u306b\u4e0d\u8981\u306a\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u524a\u3063\u305f\u3068\u3053\u308d\u3001\u30ab\u30fc\u30cd\u30eb\uff0bbusybox\u30675MB\u3092\u5207\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3057\u305f\u3002\u591a\u5206\u3082\u3046\u5c11\u3057\u524a\u308b\u3053\u3068\u306f\u53ef\u80fd\u3067\u3057\u3087\u3046\u3002\n\n[^1]: \u767d\u304f\u3066\u30af\u30ea\u30a2\u306a\u30df\u30f3\u30af\u304b\u3089\u3002\u3061\u306a\u307f\u306bermine\u306e\u30d3\u30eb\u30c9\u30b9\u30af\u30ea\u30d7\u30c8(ermine-breeder)\u3092\u542b\u3080MINCS\u672c\u4f53\u306fMIT\u30e9\u30a4\u30bb\u30f3\u30b9\u306a\u306e\u306b\u3001\u30d3\u30eb\u30c9\u3057\u305fermine\u306e\u30a4\u30e1\u30fc\u30b8\u306fGPLv2(linux)\u3068v3(busybox)\u306e\u6df7\u5728\u3068\u306a\u308b\u306e\u3067\u3001\u914d\u5e03\u5f62\u614b\u306f\u6ce8\u610f\u304c\u5fc5\u8981\u3002\n\n###9pfs\u306b\u3088\u308b\u30db\u30b9\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30de\u30a6\u30f3\u30c8\n[Qemu\u306ewiki](http://wiki.qemu.org/Documentation/9psetup)\u306b\u66f8\u3044\u3066\u3044\u308b\u901a\u308a\u8a2d\u5b9a\u3059\u308c\u3070\u30db\u30b9\u30c8\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30b2\u30b9\u30c8\u304b\u3089\u30de\u30a6\u30f3\u30c8\u3067\u304d\u307e\u3059\u3002Qemu\u306e\u8d77\u52d5\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u4ee5\u4e0b\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3067\u30db\u30b9\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3068*mount_tag*\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```\n    -virtfs fsdriver,id=[id],path=[path to share],security_model=[mapped|passthrough|none][,writeout=writeout][,readonly]\n     [,socket=socket|sock_fd=sock_fd],mount_tag=[mount tag]\n```\n\n\u30b2\u30b9\u30c8\u304b\u3089\u306f\u3001*mount_tag*\u3067\u6307\u5b9a\u3057\u305f\u6587\u5b57\u5217\u3092\u30c7\u30d0\u30a4\u30b9\u3068\u3057\u3066\u30de\u30a6\u30f3\u30c8\u3059\u308c\u3070OK\u3067\u3059\u3002\u30aa\u30d7\u30b7\u30e7\u30f3\u3067trans=virtio\u3092\u6e21\u3059\u306e\u3092\u5fd8\u308c\u306a\u3044\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u30029pfs\u306b\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f7f\u3063\u305f\u30de\u30a6\u30f3\u30c8\u65b9\u6cd5\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u30db\u30b9\u30c8\u304b\u3089\u3057\u304b\u6e21\u3055\u306a\u3044\u306e\u3067\u3042\u308c\u3070virtio\u3067\u76f4\u63a5\u6e21\u3059\u307b\u3046\u304c\u52b9\u7387\u7684\u3067\u3057\u304b\u3082\u7c21\u6f54\u3067\u3059\u3002\n\n```\nmount -t 9p -o trans=virtio [mount tag] [mount point] -oversion=9p2000.L\n```\n\n\n###\u6307\u5b9a\u3055\u308c\u305f\u30b3\u30f3\u30c6\u30ca\u306e\u81ea\u52d5\u5b9f\u884c\nErmine\u3067\u306f\u3001\u30b3\u30f3\u30c6\u30ca\u306erootfs\u3092\u6307\u5b9a\u3055\u308c\u305f\u5834\u5408\u306f\u30b3\u30f3\u30c6\u30ca\u3092\u81ea\u52d5\u5b9f\u884c\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\u30b3\u30f3\u30c6\u30ca\u306erootfs\u3092\u6307\u5b9a\u3055\u308c\u305f\u304b\u3069\u3046\u304b\u306f\u3001kernel\u306e\u30d6\u30fc\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3088\u3063\u3066\u6319\u52d5\u3092\u5909\u3048\u308b\u3053\u3068\u304c\u8003\u3048\u3089\u308c\u307e\u3059\u304c\u3001\u5c06\u6765\u7684\u306b\u30ab\u30fc\u30cd\u30eb\u306e\u30d1\u30e9\u30e1\u30bf\u3068\u885d\u7a81\u3057\u306a\u3044\u304b\u3069\u3046\u304b\u304c\u5fc3\u914d\u306b\u306a\u308a\u307e\u3059\u3002\n\u305d\u3053\u3067Ermine\u3067\u306f\u3001\u5358\u306b\u4e8b\u524d\u306b\u6c7a\u3081\u305f*mount_tag*(`minc`)\u3092\u6307\u5b9a\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u304b\u3069\u3046\u304b\u3060\u3051\u3067\u5224\u65ad\u3057\u307e\u3059\u3002\u30de\u30a6\u30f3\u30c8\u304c\u4e0d\u53ef\u80fd\u3067\u3042\u308c\u3070\u3001\u305d\u306e\u307e\u307e\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u7528\u306ebusybox shell(/bin/sh)\u306b\u79fb\u52d5\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001minc\u306e\u8d77\u52d5\u30d1\u30e9\u30e1\u30bf\u306e\u3046\u3061\u3001\u30db\u30b9\u30c8\u540d\u306a\u3069\u306fqemu\u5185\u90e8\u306b\u4f1d\u3048\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u3053\u3067qemu\u5185\u90e8\u3067\u8d77\u52d5\u3059\u308bminc\u30b3\u30de\u30f3\u30c9\u306f\u5916\u90e8\u304b\u3089\u4e0e\u3048\u3089\u308c\u308b\u3088\u3046\u30019pfs\u3067\u30de\u30a6\u30f3\u30c8\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3042\u308b`run.sh`\u3092\u81ea\u52d5\u5b9f\u884c\u3059\u308b\u3053\u3068\u3068\u3057\u307e\u3059\u3002\n\n```bash:ermine-breeder\n  cat > mincshell.sh << EOF\n#!/bin/sh\n\nrun_minc() {\nif mount -t 9p -o trans=virtio minc /mnt -oversion=9p2000.L,posixacl,cache=loose\n ; then\n  if [ -f /mnt/run.sh ]; then\n    /bin/cttyhack sh /mnt/run.sh\n    exec poweroff\n  fi\nfi\n}\n```\n\u3053\u306e`run.sh`\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306bminc-exec\u5185\u90e8\u3067\u52d5\u7684\u306b\u4f5c\u6210\u3057\u3066\u3044\u307e\u3059\u3002\n\n```bash:libexec/minc-exec\n    MINC_GUEST_OPT=\"-r /mnt/root --name `hostname`\"\n    if [ -z \"$MINC_DIRECT\" ]; then\n      # if the host mounts overlayfs on rootfs, guest skips it.\n      MINC_GUEST_OPT=\"$MINC_GUEST_OPT -D\"\n    fi\n    echo \"#!/bin/sh\" > $MINC_TMPDIR/run.sh\n    echo \"minc $MINC_GUEST_OPT \\\"$@\\\"\" >> $MINC_TMPDIR/run.sh\n```\n\u30b3\u30e1\u30f3\u30c8\u306b\u3042\u308b\u3088\u3046\u306b\u3001\u5b9f\u306foverlayfs\u306e\u51e6\u7406\u306f\u30db\u30b9\u30c8\u5074\u3067\u884c\u3044\u3001Qemu\u5185\u90e8\u3067\u306f9pfs\u3067\u898b\u3048\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u76f4\u63a5\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u3046\u3059\u308b\u3053\u3068\u3067\u4e00\u3005\u30b2\u30b9\u30c8\u5074\u306b\u8907\u6570\u306eoverlay\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u898b\u305b\u308b\u5fc5\u8981\u6027\u3092\u306a\u304f\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001\u30b2\u30b9\u30c8\u306b\u898b\u305b\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3082\u3001\u30b3\u30f3\u30c6\u30ca\u3092\u5b9f\u884c\u3057\u305f\u3044\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u305d\u306e\u3082\u306e\u3067\u306f\u306a\u304f\u3001\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u542b\u3080\u3082\u3046\u4e00\u3064\u4e0a\u306e\u4e00\u6642\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(`$MINC_TMPDIR`)\u3092\u898b\u305b\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u3063\u3066\u3001\u3053\u306e\u4e00\u6642\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4e0a\u306e`run.sh`\u304c\u30b3\u30f3\u30c6\u30ca\u5185\u90e8\u304b\u3089\u898b\u3048\u306a\u3044\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n###initramfs\u3068pivot_root\n\u6700\u8fd1\u306e\u30ab\u30fc\u30cd\u30eb\u3067\u306f\u3001initrd\u304b\u3089initramfs\u306b\u6a19\u6e96\u306eon-memory boot\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u304c\u5909\u308f\u3063\u3066\u3044\u307e\u3059\u3002initramfs\u306fLinux\u30ab\u30fc\u30cd\u30eb\u3067\u306f\u300crootfs\u300d\u3068\u3044\u3046\u540d\u524d\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3068\u3057\u3066\u8a8d\u8b58\u3055\u308c\u307e\u3059\u3002\u3068\u3053\u308d\u304c\u3053\u308c\u306f\u30eb\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u5c02\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306a\u306e\u3067\u3001pivot_root\u3059\u308b\u306a\u3069\u3057\u3066\u5225\u306e\u7b87\u6240\u306b\u30de\u30a6\u30f3\u30c8\u3057\u3066\u4f7f\u3046\u3053\u3068\u304c\u51fa\u6765\u307e\u305b\u3093\u3002\ninitramfs\u3067\u306fswitch_root\u3092\u4f7f\u3046\u3053\u3068\u3067\u65b0\u3057\u3044\u30eb\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306b\u30de\u30a6\u30f3\u30c8\u30dd\u30a4\u30f3\u30c8\u3092\u5207\u308a\u66ff\u3048\u53ef\u80fd\u306a\u306e\u3067\u3059\u304c\u3001ermine\u3067\u306fswitch_root\u306f\u4f7f\u3044\u307e\u305b\u3093\u3002\u7406\u7531\u306f\u7c21\u5358\u3067\u3001\u30b3\u30f3\u30c6\u30ca\u304c\u7d42\u4e86\u3057\u305f\u6642\u306b\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u843d\u3068\u3057\u305f\u3044\u306e\u3067\u3001initramfs\u4e0a\u306epoweroff\u30b3\u30de\u30f3\u30c9\u3092\u547c\u3073\u51fa\u3057\u3066\u3044\u308b\u304b\u3089\u3067\u3059\u3002switch_root\u3092\u4f7f\u3063\u3066\u5207\u308a\u66ff\u3048\u305f\u5834\u5408\u3001\u5143\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u6d88\u3055\u308c\u3066\u3057\u307e\u3046\u306e\u3067poweroff\u3082\u4f7f\u3048\u306a\u3044\u3068\u3044\u3046\u8a33\u3067\u3059\u3002\n\u305f\u3060\u3001\u3044\u305a\u308c\u306f\u88cf\u3067\u8d70\u3063\u3066\u3044\u308binit\u304b\u3089powerdown\u3059\u308c\u3070\u3044\u3044\u306e\u3067\u3001\u6700\u7d42\u7684\u306b\u306fswitch_root\u306b\u4e57\u308a\u63db\u3048\u308b\u306e\u304c\u597d\u307e\u3057\u3044\u3067\u3057\u3087\u3046\u3002\uff08switch_root\u306f\u5143\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u5168\u90e8\u6d88\u3057\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u307e\u3042\u5b89\u5168\u3068\u3044\u3048\u3070\u5b89\u5168\u3067\u3059\uff09\n\n\n\n###Shutdown message\nMINCS\u306eqemu\u30e2\u30fc\u30c9\u3067\u306f\u4eee\u60f3\u74b0\u5883\u306ettyS0\u3092\u73fe\u5728\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3059\u308b\u3053\u3068\u3067\u3001\u901a\u5e38\u306e\u30b3\u30f3\u30c6\u30ca\u30e2\u30fc\u30c9\u3068\u306e\u540c\u69d8\u306b\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\u3057\u304b\u3057inittab\u3092\u304d\u3061\u3093\u3068\u8a2d\u5b9a\u3057\u306a\u3044\u3068\u3001\u30ab\u30fc\u30cd\u30eb\u306e\u8d77\u52d5\u30ed\u30b0\u3084\u7d42\u4e86\u30ed\u30b0\u304c\u8868\u793a\u3055\u308c\u3066\u3057\u307e\u3044\u3001\u30e6\u30fc\u30b6\u304b\u3089\u898b\u305f\u6642\u306b\u3001qemu\u306e\u90e8\u5206\u304c\u900f\u904e\u7684\u306b\u6271\u3048\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\u57fa\u672c\u7684\u306a\u65b9\u91dd\u3068\u3057\u3066\u306f\u3001\u30ab\u30fc\u30cd\u30eb\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306fttyS0\u306b\u51fa\u3055\u306a\u3044\u3001\u3057\u304b\u3057\u30b3\u30f3\u30c6\u30ca\u306fttyS0\u306b\u51fa\u3057\u305f\u3044\u3001\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\u305d\u3053\u3067inittab\u3067\u5de5\u592b\u3092\u3057\u3001\u30ab\u30fc\u30cd\u30eb\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3092ttyS0\u306b\u51fa\u3055\u306a\u3044\u3088\u3046\u306b\u3057\u305f\u4e0a\u3067\u3001/sbin/init\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u51fa\u529b\u3057\uff08\u3064\u307e\u308a\u8868\u793a\u3055\u308c\u306a\u3044\uff09\u3001ttyS0\u4e0a\u3067\u30b7\u30a7\u30eb\u3092\u52d5\u304b\u3059\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\n```:inittab\n::sysinit:/etc/rc.local\n::restart:/sbin/init\n::ctrlaltdel:/sbin/reboot\nttyS0::respawn:/bin/cttyhack /mincshell.sh\n```\n\n\u672c\u5f53\u306f/sbin/init\u306e\u4ee3\u308f\u308a\u306b/bin/sh\u3092\u76f4\u63a5\u53e9\u3051\u3070\u826f\u3044\u306e\u304b\u3082\u3057\u308c\u306a\u3044\u3067\u3059\u304c\u3001\u3044\u305a\u308c\u306b\u3057\u3066\u3082\u30b3\u30f3\u30c6\u30ca\u7d42\u4e86\u6642\u306b\u81ea\u52d5\u7684\u306bpoweroff\u30b3\u30de\u30f3\u30c9\u3092\u53e9\u3044\u3066qemu\u3092\u7d42\u4e86\u3055\u305b\u305f\u3044\u306e\u3067\u73fe\u5728\u306e\u5b9f\u88c5\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\n##Qemu Container mode\u306e\u5229\u70b9\nMINCS\u306eQemu\u30e2\u30fc\u30c9\u6a5f\u80fd\u3092\u4f7f\u3046\u3068\u3001\u975e\u7279\u6a29\u30e6\u30fc\u30b6\u3067\u3042\u3063\u3066\u3082\u4eee\u60f3\u74b0\u5883\u5185\u3067\u306f\u7279\u6a29\u30e6\u30fc\u30b6\u306b\u306a\u308b\u305f\u3081\u3001overlayfs\u306a\u3069\u304c\u4f7f\u3044\u305f\u3044\u653e\u984c\u306b\u306a\u308b\u3068\u3044\u3046\u7279\u5178\u304c\u3042\u308a\u307e\u3059\u3002\u5f93\u6765\u306e\u975e\u7279\u6a29\u30b3\u30f3\u30c6\u30ca\u306f\u4f7f\u3044\u3084\u3059\u304f\u3066\u3082overlayfs\u3092\u4f7f\u3063\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u30b3\u30f3\u30c6\u30ca\u306erootfs\u3078\u306e\u5909\u66f4\u304c\u305d\u306e\u307e\u307e\u6b8b\u3063\u3066\u3057\u307e\u3046\u3068\u3044\u3046\u554f\u984c\u304c\u3042\u308a\u307e\u3057\u305f\u3002\u4eee\u60f3\u74b0\u5883\u3092\u4f7f\u3046\u3053\u3068\u3067\u3053\u306e\u70b9\u3092\u89e3\u6d88\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\n\u307e\u305f\u3001\u30b7\u30b9\u30c6\u30e0\u5168\u4f53\u3092VM\u306b\u3059\u308b\u3053\u3068\u3067\u3001\u5225\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u30a8\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u306b\u3082\u7528\u3044\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059[^2]\u3002\n\n[^2]: Ermine\u3067\u306f\u73fe\u5728\u3001x86_64\u4ee5\u5916\u306barm\u3068arm64\u306e\u30b5\u30dd\u30fc\u30c8\u3092\u3057\u3066\u3044\u307e\u3059\u3002\u4ed6\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306b\u3064\u3044\u3066\u306f\u3001\u30ab\u30fc\u30cd\u30eb\u3068busybox, libcap\u306e\u30af\u30ed\u30b9\u30d3\u30eb\u30c9\u304c\u53ef\u80fd\u306a\u3089\u5bfe\u5fdc\u53ef\u80fd\u3067\u3059\u3002\n\n## Qemu Container mode\u306e\u8ab2\u984c\n\u305f\u3060\u3057\u3001\u6b20\u70b9\u3082\u3042\u308a\u307e\u3059\u3002\u4f8b\u3048\u3070\u8d77\u52d5\u30fb\u7d42\u4e86\u306b\u304b\u304b\u308b\u6642\u9593\u304c\u9577\u3044\u3053\u3068\uff08\u3053\u308c\u306f\u4eee\u60f3\u30de\u30b7\u30f3\u81ea\u4f53\u306e\u521d\u671f\u5316\u306e\u9045\u3055\u3068\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u5185\u306eLinux\u81ea\u4f53\u306e\u8d77\u52d5\u306e\u9045\u3055\u304c\u539f\u56e0\u3067\u3059\u306e\u3067\u3001\u6700\u9069\u5316\u3092\u884c\u3048\u3070\u30de\u30b7\u306b\u306a\u308a\u307e\u3059\uff09\u3001\u30b3\u30f3\u30c6\u30ca\u306e\u7d42\u4e86\u6642\u306e\u623b\u308a\u5024\u304c\u5f97\u3089\u308c\u306a\u3044\u3053\u3068\u3001\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u304c\u591a\u3044\u3053\u3068\uff08\u3053\u308c\u3082\u6700\u9069\u5316\u3067\u306a\u3093\u3068\u304b\u306a\u308b\uff06KSM\u3067\u8efd\u6e1b\u304c\u53ef\u80fd\u3060\u304c\u3001\u96a3\u304b\u3089\u30e1\u30e2\u30ea\u5185\u5bb9\u3092\u4e88\u6e2c\u3055\u308c\u308b\u8106\u5f31\u6027\u306e\u6307\u6458\u3082\u3042\u308a\uff09\u306a\u3069\u304c\u3042\u308a\u307e\u3059\u3002\n\u3055\u3089\u306b\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u81ea\u4f53\u306b\u3044\u304f\u3089CPU\u3068\u30e1\u30e2\u30ea\u3092\u5272\u308a\u5f53\u3066\u308b\u304b\u3092\u660e\u78ba\u306b\u3057\u306a\u3044\u3068\u4f7f\u3044\u306b\u304f\u3044\u306e\u3082\u5b9f\u7528\u4e0a\u306f\u554f\u984c\u306b\u306a\u308b\u3067\u3057\u3087\u3046\u3002\u30b3\u30f3\u30c6\u30ca\u3092\u4f7f\u3046\u591a\u304f\u306e\u5834\u5408\u3001\u76ee\u7684\u306f\u30d1\u30c3\u30b1\u30fc\u30b8\u5316\u3055\u308c\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5b9f\u884c\u74b0\u5883\u3092\u7c21\u5358\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u3066\u5b9f\u884c\u3057\u305f\u3044\u3001\u3068\u3044\u3046\u7c21\u6f54\u306a\u7406\u7531\u3060\u3068\u601d\u308f\u308c\u307e\u3059\u3002\u305d\u306e\u5834\u5408\u304d\u3063\u3061\u308a\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u5272\u5f53\u8a2d\u8a08\u3092\u3059\u308b\u3068\u3001\u67d4\u8edf\u6027\u3084\u7c21\u6f54\u6027\u304c\u5931\u308f\u308c\u3066\u3001\u9762\u5012\u306a\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\nErmine\u3067\u306f\u73fe\u72b6\u3001Qemu\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u306a\u306e\u3067VM\u30ea\u30bd\u30fc\u30b9\u306f\u975e\u5e38\u306b\u5c11\u306a\u3044\u3067\u3059\u304c\u3001\u3053\u308c\u3082\u6700\u9069\u5024\u304c\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u306e\u3067\u5909\u66f4\u304c\u3057\u306b\u304f\u3044\u306e\u304c\u96e3\u70b9\u3067\u3059\u3002\n", "tags": ["ShellScript", "container", "QEMU", "ClearLinux", "Linux"]}