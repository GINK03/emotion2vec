{"context": " More than 1 year has passed since last update.\u3046\u30fc\u3093\u3001\u30bf\u30a4\u30c8\u30eb\u304b\u3089\u3057\u3066\u30c0\u30fc\u30c6\u30a3\u306a\u4f5c\u308a\u3084\u306d \u5f61(-)(-)\nCLOB\u578b\u306e\u5217 \u3092 1\u884c\u3060\u3051\u53d6\u5f97\u3059\u308b \u30ea\u30c6\u30e9\u30ebSQL \u3092 \u5f15\u6570\u306b\u3057\u3066\u3001\n\u305d\u306e CLOB\u578b\u306e\u30c7\u30fc\u30bf\u3092 2000\u6587\u5b57\u305a\u3064\u5206\u89e3\u3057\u3066 \u8907\u6570\u30ec\u30b3\u30fc\u30c9\u3068\u3057\u3066\n\u8fd4\u5374\u3059\u308b Table Function \u3092 \u4f5c\u6210\u3057\u307e\u3059\u3002\n-- Package\u5b9a\u7fa9\nCREATE OR REPLACE PACKAGE clob_2_mrow_vc2\nIS\n  -- Table Function \u304c \u8fd4\u3059\u578b\u5b9a\u7fa9\n  TYPE tp_mr_vc2 IS TABLE OF VARCHAR2(4000);\n  -- Table Function \u306e \u5b9a\u7fa9\n  FUNCTION sql_2_mr_vc2(\n      in_v_sql IN VARCHAR2\n  )\n  RETURN tp_mr_vc2 PIPELINED;\nEND clob_2_mrow_vc2;\n/\n\n-- Package\u672c\u4f53\u306e\u5b9a\u7fa9\nCREATE OR REPLACE PACKAGE BODY clob_2_mrow_vc2\nIS\n  -- Table Function\u672c\u4f53\n  FUNCTION sql_2_mr_vc2(\n      in_v_sql IN VARCHAR2\n  )\n  RETURN tp_mr_vc2 PIPELINED\n  IS\n    -- \u5909\u6570\u5b9a\u7fa9\n    rec        VARCHAR2(4000); -- Table Function \u304c \u8fd4\u3059\u884c\n    c_clob     CLOB;           -- CLOB\u30c7\u30fc\u30bf\n    i_length   INTEGER;        -- CLOB\u30c7\u30fc\u30bf\u306e\u30d0\u30a4\u30c8\u6570\n    i_offset   INTEGER;        -- CLOB\u30c7\u30fc\u30bf\u64cd\u4f5c\u6642\u306eoffset\n  BEGIN\n    --\u52d5\u7684SQL\u3092\u5b9f\u884c\u3057\u3066CLOB\u3092\u53d6\u5f97\n    EXECUTE IMMEDIATE in_v_sql INTO c_clob;\n    -- \u521d\u671f\u5316\n    i_length := DBMS_LOB.GETLENGTH(c_clob);\n    i_offset := 1;\n    --CLOB\u30c7\u30fc\u30bf \u3092 2000\u6587\u5b57\u305a\u3064 \u5207\u308a\u51fa\u3057\u3066 \u30ec\u30b3\u30fc\u30c9\u3068\u3057\u3066\u8fd4\u5374\n    LOOP\n      rec := DBMS_LOB.SUBSTR(c_clob, 2000, i_offset);\n      PIPE ROW(rec);\n      i_offset := i_offset + 2000;\n      EXIT WHEN i_offset > i_length;\n    END LOOP;\n    RETURN;\n  END sql_2_mr_vc2;\nEND clob_2_mrow_vc2;\n/\n\n\u5b9f\u884c\u7d50\u679c\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3002\u60f3\u5b9a\u901a\u308a\u52d5\u3044\u305f\u3051\u3069\u3001\u7d50\u5c40\u4f7f\u3044\u9053\u7121\u3044\u3084\u306a\u2026\u5f61(-)(-)\nSQL> SET LINESIZE 300\nSQL> SET PAGESIZE 1000\nSQL> SELECT LENGTH(COLUMN_VALUE) FROM TABLE(\n  2    clob_2_mrow_vc2.sql_2_mr_vc2(\n  3      'SELECT SQL_TEXT FROM DBA_HIST_SQLTEXT WHERE DBID = 2461204241 AND SQL_ID = ''grtrhkkshy2wh'''\n  4    )\n  5  );\n\nLENGTH(COLUMN_VALUE)\n--------------------\n                2000\n                2000\n                2000\n                2000\n                  \uff1a\n                2000\n                2000\n                2000\n                 498\n\n57 rows selected.\n\nSQL>\n\n\u3046\u30fc\u3093\u3001\u30bf\u30a4\u30c8\u30eb\u304b\u3089\u3057\u3066\u30c0\u30fc\u30c6\u30a3\u306a\u4f5c\u308a\u3084\u306d \u5f61(-)(-)\n\nCLOB\u578b\u306e\u5217 \u3092 1\u884c\u3060\u3051\u53d6\u5f97\u3059\u308b \u30ea\u30c6\u30e9\u30ebSQL \u3092 \u5f15\u6570\u306b\u3057\u3066\u3001\n\u305d\u306e CLOB\u578b\u306e\u30c7\u30fc\u30bf\u3092 2000\u6587\u5b57\u305a\u3064\u5206\u89e3\u3057\u3066 \u8907\u6570\u30ec\u30b3\u30fc\u30c9\u3068\u3057\u3066\n\u8fd4\u5374\u3059\u308b Table Function \u3092 \u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```sql:\n-- Package\u5b9a\u7fa9\nCREATE OR REPLACE PACKAGE clob_2_mrow_vc2\nIS\n  -- Table Function \u304c \u8fd4\u3059\u578b\u5b9a\u7fa9\n  TYPE tp_mr_vc2 IS TABLE OF VARCHAR2(4000);\n  -- Table Function \u306e \u5b9a\u7fa9\n  FUNCTION sql_2_mr_vc2(\n      in_v_sql IN VARCHAR2\n  )\n  RETURN tp_mr_vc2 PIPELINED;\nEND clob_2_mrow_vc2;\n/\n\n-- Package\u672c\u4f53\u306e\u5b9a\u7fa9\nCREATE OR REPLACE PACKAGE BODY clob_2_mrow_vc2\nIS\n  -- Table Function\u672c\u4f53\n  FUNCTION sql_2_mr_vc2(\n      in_v_sql IN VARCHAR2\n  )\n  RETURN tp_mr_vc2 PIPELINED\n  IS\n    -- \u5909\u6570\u5b9a\u7fa9\n    rec        VARCHAR2(4000); -- Table Function \u304c \u8fd4\u3059\u884c\n    c_clob     CLOB;           -- CLOB\u30c7\u30fc\u30bf\n    i_length   INTEGER;        -- CLOB\u30c7\u30fc\u30bf\u306e\u30d0\u30a4\u30c8\u6570\n    i_offset   INTEGER;        -- CLOB\u30c7\u30fc\u30bf\u64cd\u4f5c\u6642\u306eoffset\n  BEGIN\n    --\u52d5\u7684SQL\u3092\u5b9f\u884c\u3057\u3066CLOB\u3092\u53d6\u5f97\n    EXECUTE IMMEDIATE in_v_sql INTO c_clob;\n    -- \u521d\u671f\u5316\n    i_length := DBMS_LOB.GETLENGTH(c_clob);\n    i_offset := 1;\n    --CLOB\u30c7\u30fc\u30bf \u3092 2000\u6587\u5b57\u305a\u3064 \u5207\u308a\u51fa\u3057\u3066 \u30ec\u30b3\u30fc\u30c9\u3068\u3057\u3066\u8fd4\u5374\n    LOOP\n      rec := DBMS_LOB.SUBSTR(c_clob, 2000, i_offset);\n      PIPE ROW(rec);\n      i_offset := i_offset + 2000;\n      EXIT WHEN i_offset > i_length;\n    END LOOP;\n    RETURN;\n  END sql_2_mr_vc2;\nEND clob_2_mrow_vc2;\n/\n```\n\n\u5b9f\u884c\u7d50\u679c\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3002\u60f3\u5b9a\u901a\u308a\u52d5\u3044\u305f\u3051\u3069\u3001\u7d50\u5c40\u4f7f\u3044\u9053\u7121\u3044\u3084\u306a\u2026\u5f61(-)(-)\n\n```sql:\nSQL> SET LINESIZE 300\nSQL> SET PAGESIZE 1000\nSQL> SELECT LENGTH(COLUMN_VALUE) FROM TABLE(\n  2    clob_2_mrow_vc2.sql_2_mr_vc2(\n  3      'SELECT SQL_TEXT FROM DBA_HIST_SQLTEXT WHERE DBID = 2461204241 AND SQL_ID = ''grtrhkkshy2wh'''\n  4    )\n  5  );\n\nLENGTH(COLUMN_VALUE)\n--------------------\n                2000\n                2000\n                2000\n                2000\n                  \uff1a\n                2000\n                2000\n                2000\n                 498\n\n57 rows selected.\n\nSQL>\n```\n", "tags": ["oracle", "Database", "plsql"]}