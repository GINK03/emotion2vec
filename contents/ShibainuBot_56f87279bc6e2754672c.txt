{"context": "\n\n\u74b0\u5883\n\nUnity5.5\nDOTween\n\n\n\u30b3\u30fc\u30c9\n\ntest.cs\nusing System.Collections;\nusing System.Collections.Generic;\nusing UnityEngine;\n\nusing DG.Tweening;\n\n[RequireComponent(typeof(Camera)),ExecuteInEditMode]\npublic class FadeEffect : MonoBehaviour {\n\n    private Material material;\n\n    private bool isFade;\n    private float _black;\n\n    [SerializeField]\n    private float fadeDuration;\n\n    void Awake()\n    {\n        material = new Material (Shader.Find (\"Custom/Fade\"));\n    }\n\n    void Start()\n    {\n\n        StartCoroutine (gameLogic());\n\n    }\n\n    IEnumerator gameLogic()\n    {\n\n        yield return FadeOut ();\n\n        Debug.Log (\"Done FadeOut\");\n\n        yield return FadeIn ();\n\n        Debug.Log (\"Done FadeIn\");\n\n    }\n\n    public IEnumerator FadeOut()\n    {\n        isFade = true;\n\n        DOTween.To (black => _black = black, 1.0f, 0.0f, fadeDuration)\n            .OnComplete (() => {\n                isFade = false;\n        });\n\n        yield return new WaitWhile (() => isFade == true);\n\n    }\n\n    public IEnumerator FadeIn()\n    {\n        isFade = true;\n\n        DOTween.To (black => _black = black, 0.0f, 1.0f, fadeDuration)\n            .OnComplete (() => {\n                isFade = false;\n            });\n\n        yield return new WaitWhile (() => isFade == true);\n    }\n\n    void OnRenderImage(RenderTexture source, RenderTexture destination)\n    {\n        if (isFade) {\n            UpdateMaterial ();\n            Graphics.Blit (source, destination, material);\n        }\n    }\n\n    void UpdateMaterial()\n    {\n        material.SetFloat (\"_Black\", _black);\n    }\n}\n\n\n\nFade.shader\nShader \"Custom/Fade\"\n{\n    Properties\n    {\n        _MainTex (\"Texture\", 2D) = \"white\" {}\n        _Black (\"black\", float) = 0.0 \n    }\n    SubShader\n    {\n        // No culling or depth\n        Cull Off ZWrite Off ZTest Always\n\n        Pass\n        {\n            CGPROGRAM\n            #pragma vertex vert\n            #pragma fragment frag\n\n            #include \"UnityCG.cginc\"\n\n            struct appdata\n            {\n                float4 vertex : POSITION;\n                float2 uv : TEXCOORD0;\n            };\n\n            struct v2f\n            {\n                float2 uv : TEXCOORD0;\n                float4 vertex : SV_POSITION;\n            };\n\n            v2f vert (appdata v)\n            {\n                v2f o;\n                o.vertex = mul(UNITY_MATRIX_MVP, v.vertex);\n                o.uv = v.uv;\n                return o;\n            }\n\n            sampler2D _MainTex;\n            float _Black;\n\n            fixed4 frag (v2f i) : SV_Target\n            {\n                fixed4 col = tex2D(_MainTex, i.uv);\n                col = col * _Black;\n                return col;\n            }\n            ENDCG\n        }\n    }\n}\n\n\n\n\n\u8aac\u660e\nScript\u304b\u3089material\u306eBlack\u3092DOTween\u3067\u6307\u5b9a\u6642\u9593\u30671.0/0.0\u306b\u306a\u308b\u3088\u3046\u306b\u66f4\u65b0\u3002\nfragment\u30b7\u30a7\u30fc\u30c0\u30fc\u5074\u3067Property\u306eBlack\u3092\u5168\u30d4\u30af\u30bb\u30eb\u306b\u52a0\u7b97\u3002\n\u4f7f\u3044\u65b9\u3068\u3057\u3066\u306fFadeOut\u306e\u5f8c\u306b\u4f55\u304b\u51e6\u7406\u3092\u3057\u3066\u304b\u3089FadeIn\u547d\u4ee4\u3092\u51fa\u3059\u611f\u3058\u3067\u3059\u3002\n\n# \u74b0\u5883\n\n* Unity5.5\n* DOTween\n\n# \u30b3\u30fc\u30c9\n\n```csharp:test.cs\nusing System.Collections;\nusing System.Collections.Generic;\nusing UnityEngine;\n\nusing DG.Tweening;\n\n[RequireComponent(typeof(Camera)),ExecuteInEditMode]\npublic class FadeEffect : MonoBehaviour {\n\n    private Material material;\n\n    private bool isFade;\n    private float _black;\n\n    [SerializeField]\n    private float fadeDuration;\n\n    void Awake()\n    {\n        material = new Material (Shader.Find (\"Custom/Fade\"));\n    }\n\n    void Start()\n    {\n\n        StartCoroutine (gameLogic());\n\n    }\n\n    IEnumerator gameLogic()\n    {\n\n        yield return FadeOut ();\n\n        Debug.Log (\"Done FadeOut\");\n\n        yield return FadeIn ();\n\n        Debug.Log (\"Done FadeIn\");\n\n    }\n\n    public IEnumerator FadeOut()\n    {\n        isFade = true;\n\n        DOTween.To (black => _black = black, 1.0f, 0.0f, fadeDuration)\n            .OnComplete (() => {\n                isFade = false;\n        });\n\n        yield return new WaitWhile (() => isFade == true);\n\n    }\n\n    public IEnumerator FadeIn()\n    {\n        isFade = true;\n\n        DOTween.To (black => _black = black, 0.0f, 1.0f, fadeDuration)\n            .OnComplete (() => {\n                isFade = false;\n            });\n\n        yield return new WaitWhile (() => isFade == true);\n    }\n\n    void OnRenderImage(RenderTexture source, RenderTexture destination)\n    {\n        if (isFade) {\n            UpdateMaterial ();\n            Graphics.Blit (source, destination, material);\n        }\n    }\n\n    void UpdateMaterial()\n    {\n        material.SetFloat (\"_Black\", _black);\n    }\n}\n```\n\n```glsl:Fade.shader\nShader \"Custom/Fade\"\n{\n\tProperties\n\t{\n\t\t_MainTex (\"Texture\", 2D) = \"white\" {}\n        _Black (\"black\", float) = 0.0 \n\t}\n\tSubShader\n\t{\n\t\t// No culling or depth\n\t\tCull Off ZWrite Off ZTest Always\n\n\t\tPass\n\t\t{\n\t\t\tCGPROGRAM\n\t\t\t#pragma vertex vert\n\t\t\t#pragma fragment frag\n\t\t\t\n\t\t\t#include \"UnityCG.cginc\"\n\n\t\t\tstruct appdata\n\t\t\t{\n\t\t\t\tfloat4 vertex : POSITION;\n\t\t\t\tfloat2 uv : TEXCOORD0;\n\t\t\t};\n\n\t\t\tstruct v2f\n\t\t\t{\n\t\t\t\tfloat2 uv : TEXCOORD0;\n\t\t\t\tfloat4 vertex : SV_POSITION;\n\t\t\t};\n\n\t\t\tv2f vert (appdata v)\n\t\t\t{\n\t\t\t\tv2f o;\n\t\t\t\to.vertex = mul(UNITY_MATRIX_MVP, v.vertex);\n\t\t\t\to.uv = v.uv;\n\t\t\t\treturn o;\n\t\t\t}\n\t\t\t\n\t\t\tsampler2D _MainTex;\n            float _Black;\n\n\t\t\tfixed4 frag (v2f i) : SV_Target\n\t\t\t{\n\t\t\t\tfixed4 col = tex2D(_MainTex, i.uv);\n                col = col * _Black;\n\t\t\t\treturn col;\n\t\t\t}\n\t\t\tENDCG\n\t\t}\n\t}\n}\n\n```\n\n# \u8aac\u660e\n\nScript\u304b\u3089material\u306e_Black\u3092DOTween\u3067\u6307\u5b9a\u6642\u9593\u30671.0/0.0\u306b\u306a\u308b\u3088\u3046\u306b\u66f4\u65b0\u3002\nfragment\u30b7\u30a7\u30fc\u30c0\u30fc\u5074\u3067Property\u306e_Black\u3092\u5168\u30d4\u30af\u30bb\u30eb\u306b\u52a0\u7b97\u3002\n\n\u4f7f\u3044\u65b9\u3068\u3057\u3066\u306fFadeOut\u306e\u5f8c\u306b\u4f55\u304b\u51e6\u7406\u3092\u3057\u3066\u304b\u3089FadeIn\u547d\u4ee4\u3092\u51fa\u3059\u611f\u3058\u3067\u3059\u3002\n\n![Fade.gif](https://qiita-image-store.s3.amazonaws.com/0/141994/3e6daa3d-4a6c-ed5b-b654-279733e6d67a.gif)\n\n", "tags": ["Shader", "Unity"]}