{"context": "CentOS7\u306e\u6a19\u6e96\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u305d\u306e\u307e\u307e\u6d3b\u7528\u3057\u307e\u3059\u3002systemctl\u3084firewall-cmd\u3068\u3044\u3063\u305fCentOS7\u306e\u30b3\u30de\u30f3\u30c9\u3092\u30d9\u30fc\u30b9\u306b\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\u307e\u305f\u3001\u306a\u308b\u3079\u304fsudo\u3067\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\uff08\u30ab\u30ec\u30f3\u30c8\u30e6\u30fc\u30b6\u30fc\u3067\u6df7\u4e71\u3057\u306a\u3044\u3088\u3046\u306b\uff09\n\nRails\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u73fe\u5728CentOS7\u306e\u6a19\u6e96\u3067\u306fRuby2.0\u3068Rails4.2\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u53ef\u80fd\u3067\u3059\u3002\nRails\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb on CentOS7\nRedmine\u306e\u6700\u65b0\u306e\u8981\u4ef6\u3092\u898b\u308b\u3068\u3001Ruby2.0\u306f\u5bfe\u5fdc\u3002Rails\u306f4.1\u304c\u5fc5\u8981\u3068\u66f8\u3044\u3066\u3042\u308b\u306e\u3067\u3001\u304a\u305d\u3089\u304f4.2\u3067\u5927\u4e08\u592b\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\nImageMagick\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u753b\u50cf\u306e\u7de8\u96c6\u306b\u4f7f\u308f\u308c\u307e\u3059\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum\u3067\u666e\u901a\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n$ sudo yum install ImageMagick-devel\n\n\nnginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nreverse proxy\u3068\u3057\u3066nginx\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\nredmine\u672c\u4f53\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u6642\u306bnginx\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u4e0e\u3048\u305f\u3044\u306e\u3067\u3001\u4e88\u3081\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u30e6\u30fc\u30b6\u30fc\u304c\u51fa\u6765\u4e0a\u304c\u3063\u3066\u3044\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\nyum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo yum install nginx\n\n\u30b5\u30fc\u30d3\u30b9\u6709\u52b9\u5316\n$ sudo systemctl enable nginx\nln -s '/usr/lib/systemd/system/nginx.service' '/etc/systemd/system/multi-user.target.wants/nginx.service'\n\nnginx\u8d77\u52d5\n$ sudo systemctl start nginx\n\n\u30b9\u30c6\u30fc\u30bf\u30b9\u78ba\u8a8d\n$ sudo systemctl status nginx\nnginx.service - The nginx HTTP and reverse proxy server\n   Loaded: loaded (/usr/lib/systemd/system/nginx.service; enabled)\n   Active: active (running) since Fri 2015-02-00 00:00:00 JST; 10s ago\n  Process: 22314 ExecStart=/usr/sbin/nginx (code=exited, status=0/SUCCESS)\n  Process: 22312 ExecStartPre=/usr/sbin/nginx -t (code=exited, status=0/SUCCESS)\n...\u7701\u7565...\n\n\nFire Wall\u30dd\u30fc\u30c8\u958b\u653e\n\u5916\u90e8\u304b\u3089\u30dd\u30fc\u30c880\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306b\u3001firewall\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n$ sudo firewall-cmd --add-service=http --permanent\n$ sudo firewall-cmd --reload\n\nredmine\u3078\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u306f\u3042\u3068\u3067\u3084\u308a\u307e\u3059\u3002\n\nMariaDB(MySQL\u4e92\u63dbDB)\nCentOS7\u3067\u306fMySQL\u3067\u306f\u306a\u304fMariaDB\u304c\u6a19\u6e96\u306a\u306e\u3067\u3053\u3061\u3089\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ndevel\u3068server\u304c\u5fc5\u8981\u3067\u3059\u3002\n$ sudo yum install mariadb-devel mariadb-server\n\n\u30b5\u30fc\u30d0\u30fc\u306e\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u30bb\u30c3\u30c8\u3092utf8\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\uff08\u672a\u3060latin1\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u306a\u3093\u3067\u3059\u306d\u2026\uff09\n$ sudo vi /etc/my.cnf.d/server.cnf\n\n\n/etc/my.cnf.d/server.cnf\n#\n# These groups are read by MariaDB server.\n# Use it for options that only the server (but not clients) should see\n#\n# See the examples of server my.cnf files in /usr/share/mysql/\n#\n\n# this is read by the standalone daemon and embedded servers\n[server]\n\n# this is only for the mysqld standalone daemon\n[mysqld]\n## \u8ffd\u52a0 ##\ncharacter-set-server=utf8\n\n# this is only for embedded server\n[embedded]\n\n...\u4ee5\u4e0b\u7701\u7565...\n\n\n\n\u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\n$ sudo systemctl enable mariadb\n$ sudo systemctl restart mariadb\n\n\nroot\u30d1\u30b9\u30ef\u30fc\u30c9\n\u521d\u671f\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u306a\u3057\u3067\u5371\u967a\u306a\u306e\u3067\u3001\u65b0\u3057\u3044\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n$ mysqladmin password -u root\nEnter password:\nNew password:\nConfirm new password:\n\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u4f5c\u6210\n\nmysql\n$ mysql -u root -p\nMariaDB [(none)]>create database redmine;\nMariaDB [(none)]>create user 'redmine'@'localhost' identified by 'redmine_pass';\nMariaDB [(none)]>grant all privileges on redmine.* to 'redmine'@'localhost';\nMariaDB [(none)]>exit;\n\n\n\nredmine\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u305f\u3081\u3001root\u6a29\u9650\uff08wheel\uff09\u3067\u306a\u3044\u5c02\u7528\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ sudo useradd redmine\n$ sudo passwd redmine\n\n\nRedmine\u672c\u4f53\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3068\u5c55\u958b\n\u672c\u5bb6\u304b\u3089redmine-3.2.1\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n$ cd ~/\n$ curl -O http://www.redmine.org/releases/redmine-3.2.1.tar.gz\n$ tar -xvf redmine-3.2.1.tar.gz\n$ sudo mv redmine-3.2.1 /var/lib\n$ cd /var/lib/redmine-3.2.1\n$ sudo chmod -R 755 files log public/plugin_assets\n$ sudo chown -R redmine:nginx .\n\n\nDB\u306e\u8a2d\u5b9a\n\u5f15\u304d\u7d9a\u304d/var/lib/redmine-3.2.1\u3067\u4f5c\u696d\u3057\u307e\u3059\u3002\n\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fDB\u306e\u30e6\u30fc\u30b6\u30fc\u540d\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n$ sudo -u redmine cp config/database.yml.example config/database.yml\n$ sudo -u redmine vi config/database.yml\n\n\nconfig/database.yml\n...\u7701\u7565...\n\nproduction:\n  adapter: mysql2\n  database: redmine\n  host: localhost\n  username: redmine\n  password: redmine_pass\n  encoding: utf8\n\n...\u7701\u7565...\n\n\n\nbundler\u3067gems\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nGemfile\u306brails\u3092\u7a3c\u50cd\u3055\u305b\u308bRack Server\u3068\u3057\u3066puma\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\uff08unicorn\u3088\u308a\u6d41\u884c\u3063\u3066\u308b\uff1f\uff06\u5c0e\u5165\u304c\u697d\u3060\u3063\u305f\u306e\u3067\uff09\nGemfile 17\u884c\u76ee\u3042\u305f\u308a\u306bpuma\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n$ sudo -u redmine vi Gemfile\n\n\nGemfile\n...\u7701\u7565...\ngem \"protected_attributes\"\ngem \"actionpack-action_caching\"\ngem \"actionpack-xml_parser\"\ngem \"roadie-rails\"\ngem \"puma\"\n...\u7701\u7565...\n\n\nnokogiri-1.6.6.2\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3088\u3046\u3068\u3057\u3066\u3001C\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u53c2\u7167\u3057\u3088\u3046\u3068\u3057\u307e\u3059\u3002\u305d\u306e\u307e\u307e\u3060\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308b\u306e\u3067\u3001config\u3067--use-system-libraries\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3057\u3066\u304b\u3089bundle install\u3057\u307e\u3059\u3002\n\u203brails\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\u3067\u3084\u3063\u3066\u3044\u308b\u306e\u3067\u4e0d\u8981\u3067\u3057\u305f\n\u4eca\u56de\u306fMySql(MariaDB)\u3092\u4f7f\u7528\u3059\u308b\u306e\u3067\u3001\u672c\u5bb6\u3067\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308b\u901a\u308apostgresql\u3068sqlite\u306f\u9664\u5916\u3057\u307e\u3059\u3002\n$ sudo -u redmine -E /var/lib/redmine-3.2.1/bin/bundle install --path vendor/bundle --without development test postgresql sqlite\n\n\n\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30a2\u79d8\u5bc6\u9375\u751f\u6210\nrake\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u751f\u6210\u3057\u307e\u3059\u3002\n$ sudo -u redmine /home/redmine/bin/bundle exec rake generate_secret_token\n\n\nDB\u30c6\u30fc\u30d6\u30eb\u521d\u671f\u5316\n$ sudo -u redmine RAILS_ENV=production /home/redmine/bin/bundle exec rake db:migrate\n\n\u65b0\u898f\u306e\u5834\u5408\u306f\u521d\u671f\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30c7\u30fc\u30bf\u3092\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\u79fb\u884c\u306e\u5834\u5408\u306f\u3053\u306e\u624b\u9806\u3092\u98db\u3070\u3057\u3066\u3001\u30c7\u30fc\u30bf\u3092\u30a4\u30f3\u30dd\u30fc\u30c8\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u8a00\u8a9e\u3092\u8a0a\u304b\u308c\u305f\u3089\u65e5\u672c\u8a9eja\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n$ sudo -u redmine RAILS_ENV=production /home/redmine/bin/bundle exec rake redmine:load_default_data\n\nSelect language: ar, az, bg, bs, ca, cs, da, de, el, en, en-GB, es, es-PA, et, eu, fa, fi, fr, gl, he, hr, hu, id, it, ja, ko, lt, lv, mk, mn, nl, no, pl, pt, pt-BR, ro, ru, sk, sl, sq, sr, sr-YU, sv, th, tr, uk, vi, zh, zh-TW [en] ja\n\n\nWebrick\u3067\u30c6\u30b9\u30c8\n\u3068\u308a\u3042\u3048\u305a\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067webrick\u8d77\u52d5\u3057\u307e\u3059\u3002curl\u3067\u30da\u30fc\u30b8\u306e\u30bd\u30fc\u30b9\u304c\u53d6\u5f97\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ cd /var/lib/redmine-3.2.1\n$ sudo -u redmine /home/redmine/bin/bundle exec rails server webrick -e production &\n$ curl http://localhost:3000\n\u30b5\u30fc\u30d0\u30fc\u3092\u505c\u6b62\u3059\u308b\u3068\u304d\n$ fg\nCtrl+C\n\n\u5916\u90e8\u304b\u3089\u30d6\u30e9\u30a6\u30b6\u3067\u53c2\u7167\u3057\u305f\u3051\u308c\u3070\u3001firewall-cmd\u3067\u30dd\u30fc\u30c83000\u756a\u958b\u3051\u3066\u304f\u3060\u3055\u3044\u3002\n\u307e\u305f\u3001\u3059\u3079\u3066\u306e\u30a2\u30c9\u30ec\u30b9\u304b\u3089\u5f85\u3061\u53d7\u3051\u308b\u3088\u3046\u3001-b 0.0.0.0\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n$ sudo firewall-cmd --add-port=3000/tcp\n$ rails server webrick -e production -b 0.0.0.0 &\n\u30b5\u30fc\u30d0\u30fc\u3092\u505c\u6b62\u3059\u308b\u3068\u304d\n$ fg\nCtrl+C\n\n\npuma\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8a18\u8ff0\n$ cd /var/lib/redmine-3.2.1\n$ sudo -u redmine vi config/puma.rb\n\n\npuma.rb\napp_root = '/var/lib/redmine-3.2.1'\n\ndirectory app_root\nenvironment 'production'\npidfile \"#{app_root}/tmp/pids/puma.pid\"\nstate_path \"#{app_root}/tmp/pids/puma.state\"\nbind \"unix://#{app_root}/tmp/sockets/redmine.sock\"\nactivate_control_app\n\n\n\npuma\u3067\u30c6\u30b9\u30c8\npuma\u3067\u30c6\u30b9\u30c8\u3057\u3066\u307f\u307e\u3059\u3002\u30bd\u30b1\u30c3\u30c8\u7d4c\u7531\n$ cd /var/lib/redmine-3.2.1\n$ sudo -u redmine bin/bundle exec puma \n\n\u7a3c\u50cd\u3057\u3066\u3044\u308b\u3053\u3068\u306f\u308f\u304b\u308a\u307e\u3059\u304c\u3001curl\u3067unix\u30bd\u30b1\u30c3\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b--unix-socket\u306fCentOS Linux release 7.1.1503\u6a19\u6e96\u306e7.29.0\u3067\u306f\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u30a8\u30e9\u30fc\u304c\u306a\u3044\u3053\u3068\u3060\u3051\u78ba\u8a8d\u3002\u65b9\u6cd5\u77e5\u3063\u3066\u308b\u4eba\u3044\u305f\u3089\u304a\u3057\u3048\u3066\u304f\u3060\u3055\u3044\u3002\uff08\u7d20\u76f4\u306b7.40\u3044\u308c\u308c\u3070\u826f\u3044\u3093\u3060\u3051\u3069\uff09\n\ndaemon\u5316\nsystemd\u3067\u8d77\u52d5\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\nservice\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n$ sudo vi /usr/lib/systemd/system/redmine.service\n\n\n/usr/lib/systemd/system/redmine.service\n[Unit]\nDescription=Redmine on PUMA\nAfter=network.target\n\n[Service]\nType=simple\nExecStart=/var/lib/redmine-3.2.1/bin/bundle exec pumactl -F /var/lib/redmine-3.2.1/config/puma.rb start\nKillMode=process\nKillSignal=SIGQUIT\nUser=redmine\nGroup=nginx\n\n[Install]\nWantedBy=multi-user.target\n\n\n\nsystemd\u304b\u3089\u8d77\u52d5\u3059\u308b\nsystem\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3057\u305f\u306e\u3067\u3001\u8a2d\u5b9a\u3092\u30ea\u30ed\u30fc\u30c9\n$ sudo systemctl daemon-reload\n\n\u81ea\u52d5\u8d77\u52d5\u3092\u6709\u52b9\u306b\u3059\u308b\n$ sudo systemctl enable redmine\n\n\u958b\u59cb\n$ sudo systemctl start redmine\n\n\u6b63\u3057\u304f\u958b\u59cb\u3055\u308c\u305f\u304b\u78ba\u8a8d\n$ sudo systemctl status redmine\n\nActive: active (running)\u306b\u306a\u3063\u3066\u3044\u308c\u3070OK\n\n\nnginx\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3059\u308b\n\u30b5\u30fc\u30d0\u30fc\u8a2d\u5b9a\u3068\u3001\u30ed\u30b1\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n$ sudo vi /etc/nginx/conf.d/redmine_server.conf\n\n\n/etc/nginx/conf.d/redmine_server.conf\nupstream redmine {\n  server unix:/var/lib/redmine-3.2.1/tmp/sockets/redmine.sock;\n}\n\n\n$ sudo vi /etc/nginx/default.d/redmine.conf\n\n\n/etc/nginx/default.d/redmine.conf\nlocation / {\n  root /var/lib/redmine-3.2.1/public;\n  access_log  /var/log/nginx/redmine_access.log;\n  error_log   /var/log/nginx/redmine_error.log;\n\n  try_files $uri $uri/index.html $uri.html @redmine;\n}\n\nlocation @redmine {\n  proxy_read_timeout    300;\n  proxy_connect_timeout 300;\n  proxy_redirect        off;\n  proxy_set_header Host      $http_host;\n  proxy_set_header X-Real-IP $remote_addr;\n\n  proxy_pass http://redmine;\n}\n\n\n\u8a2d\u5b9a\u304c\u6709\u52b9\u304b\u78ba\u8a8d\u3057\u3066\u3001\u30ea\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\u78ba\u8a8d\n$ sudo nginx -t\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n\n\u30ea\u30ed\u30fc\u30c9\n$ sudo systemctl reload nginx\n\n\n\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u5834\u5408\nlocation\u8a2d\u5b9a\u3092\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\n$ sudo vi /etc/nginx/default.d/redmine.conf\n\n\n/etc/nginx/default.d/redmine.conf\nlocation /redmine {\n  root /var/lib/redmine-3.2.1/public;\n  access_log  /var/log/nginx/redmine_access.log  main;\n  error_log  /var/log/nginx/redmine_error.log  main;\n\n  try_files $uri $uri/index.html $uri.html @redmine;\n}\n\nlocation @redmine {\n  proxy_read_timeout    300;\n  proxy_connect_timeout 300;\n  proxy_redirect        off;\n\n  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n  proxy_set_header Host            $http_host;\n  proxy_set_header X-Real-IP       $remote_addr;\n\n  proxy_pass http://redmine;\n}\n\n\n\u3055\u3089\u306b\u3001relative_url_root\u306b\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u767b\u9332\u3057\u3066\u3001\u30eb\u30fc\u30c8\u30d1\u30b9\"/\"\u306b\u30de\u30c3\u30d7\u3059\u308b\u3088\u3046\u3001redmine\u306e\u8a2d\u5b9a\u3082\u5909\u66f4\u3057\u307e\u3059\u3002\n\u53c2\u8003\n$ sudo -u redmine vi /var/lib/redmine-3.2.1/config/environment.rb\n\n\n/var/lib/redmine-3.2.1/config/environment.rb\n# \u672b\u5c3e\u306b\u8ffd\u52a0\nRedmine::Utils::relative_url_root = \"/redmine\"\n\n\n$ sudo -u redmine vi /var/lib/redmine-3.2.1/config.ru\n\n\n/var/lib/redmine-3.2.1/config.ru\n#run RedmineApp::Application\nmap ActionController::Base.relative_url_root || \"/\" do\n  run RedmineApp::Application\nend\n\n\n\nSELinux\u7121\u52b9\u5316\n\u7c21\u5358\u306e\u305f\u3081\u3001SELinux\u3092Permissive\u306b\u3057\u307e\u3059\u3002\n\u518d\u8d77\u52d5\u3057\u305f\u3068\u304d\u306bpermissive\u306b\u306a\u308b\u3088\u3046\u3001\u8a2d\u5b9a\u5909\u66f4\u3057\u307e\u3059\u3002\n$ sudo vi /etc/sysconfig/selinux\n\n7\u884c\u76ee\n\n/etc/sysconfig/selinux\nSELINUX=permissive \n\n\n\u518d\u8d77\u52d5\u3059\u308b\u307e\u3067\u53cd\u6620\u3055\u308c\u306a\u3044\u306e\u3067\u3001\u660e\u793a\u7684\u306b\u5373\u6642\u53cd\u6620\u3059\u308b\u3002\n$ sudo setenforce 0\n\n\n\u78ba\u8a8d\nWeb\u30d6\u30e9\u30a6\u30b6\u3067\u78ba\u8a8d\u3057\u307e\u3059\u3002\nhttp://[yourhost]/\n\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u5834\u5408\u306f\nhttp://[yourhost]/redmine\n\u753b\u50cf\u306f\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u8a2d\u5b9a\u3057\u305f\u4f8b\u3002\n\n\n\u5b9f\u7528\u5316\u306e\u305f\u3081\u306b\u8ffd\u52a0\u3067\u3084\u308b\u3079\u304d\u3053\u3068\n\u3053\u3053\u306b\u306f\u66f8\u3044\u3066\u307e\u305b\u3093\u304c\u3001\u5b9f\u7528\u3059\u308b\u306b\u306f\n\u30fb\u7ba1\u7406\u8005\u306e\u30e1\u30fc\u30eb\u8a2d\u5b9a\uff08\u30e1\u30fc\u30eb\u901a\u77e5\uff09\n\u30fbSSL\u3092\u901a\u3059\uff08nginx\u306b\u8a2d\u5b9a\uff09\n\u30fb\u5b9a\u671f\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\n\u306a\u3069\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nCentOS7\u306e\u6a19\u6e96\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u305d\u306e\u307e\u307e\u6d3b\u7528\u3057\u307e\u3059\u3002`systemctl`\u3084`firewall-cmd`\u3068\u3044\u3063\u305fCentOS7\u306e\u30b3\u30de\u30f3\u30c9\u3092\u30d9\u30fc\u30b9\u306b\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\u307e\u305f\u3001\u306a\u308b\u3079\u304fsudo\u3067\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\uff08\u30ab\u30ec\u30f3\u30c8\u30e6\u30fc\u30b6\u30fc\u3067\u6df7\u4e71\u3057\u306a\u3044\u3088\u3046\u306b\uff09\n\n##Rails\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u73fe\u5728CentOS7\u306e\u6a19\u6e96\u3067\u306fRuby2.0\u3068Rails4.2\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u53ef\u80fd\u3067\u3059\u3002\n[Rails\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb on CentOS7](http://qiita.com/egnr-in-6matroom/items/c84a1d3896f1015be8d2)\nRedmine\u306e\u6700\u65b0\u306e\u8981\u4ef6\u3092\u898b\u308b\u3068\u3001Ruby2.0\u306f\u5bfe\u5fdc\u3002Rails\u306f4.1\u304c\u5fc5\u8981\u3068\u66f8\u3044\u3066\u3042\u308b\u306e\u3067\u3001\u304a\u305d\u3089\u304f4.2\u3067\u5927\u4e08\u592b\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\n##ImageMagick\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u753b\u50cf\u306e\u7de8\u96c6\u306b\u4f7f\u308f\u308c\u307e\u3059\u3002\n\n###\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum\u3067\u666e\u901a\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\n```bash:\n$ sudo yum install ImageMagick-devel\n```\n\n## nginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nreverse proxy\u3068\u3057\u3066nginx\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\nredmine\u672c\u4f53\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u6642\u306bnginx\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u4e0e\u3048\u305f\u3044\u306e\u3067\u3001\u4e88\u3081\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u30e6\u30fc\u30b6\u30fc\u304c\u51fa\u6765\u4e0a\u304c\u3063\u3066\u3044\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```\nyum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo yum install nginx\n\n\u30b5\u30fc\u30d3\u30b9\u6709\u52b9\u5316\n$ sudo systemctl enable nginx\nln -s '/usr/lib/systemd/system/nginx.service' '/etc/systemd/system/multi-user.target.wants/nginx.service'\n\nnginx\u8d77\u52d5\n$ sudo systemctl start nginx\n\n\u30b9\u30c6\u30fc\u30bf\u30b9\u78ba\u8a8d\n$ sudo systemctl status nginx\nnginx.service - The nginx HTTP and reverse proxy server\n   Loaded: loaded (/usr/lib/systemd/system/nginx.service; enabled)\n   Active: active (running) since Fri 2015-02-00 00:00:00 JST; 10s ago\n  Process: 22314 ExecStart=/usr/sbin/nginx (code=exited, status=0/SUCCESS)\n  Process: 22312 ExecStartPre=/usr/sbin/nginx -t (code=exited, status=0/SUCCESS)\n...\u7701\u7565...\n```\n\n###Fire Wall\u30dd\u30fc\u30c8\u958b\u653e\n\u5916\u90e8\u304b\u3089\u30dd\u30fc\u30c880\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306b\u3001firewall\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```bash:\n$ sudo firewall-cmd --add-service=http --permanent\n$ sudo firewall-cmd --reload\n```\n\nredmine\u3078\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u306f\u3042\u3068\u3067\u3084\u308a\u307e\u3059\u3002\n\n\n##MariaDB(MySQL\u4e92\u63dbDB)\nCentOS7\u3067\u306fMySQL\u3067\u306f\u306a\u304fMariaDB\u304c\u6a19\u6e96\u306a\u306e\u3067\u3053\u3061\u3089\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n###\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ndevel\u3068server\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n```bash:\n$ sudo yum install mariadb-devel mariadb-server\n```\n\u30b5\u30fc\u30d0\u30fc\u306e\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u30bb\u30c3\u30c8\u3092utf8\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\uff08\u672a\u3060latin1\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u306a\u3093\u3067\u3059\u306d\u2026\uff09\n\n```bash:\n$ sudo vi /etc/my.cnf.d/server.cnf\n```\n\n```text:/etc/my.cnf.d/server.cnf\n#\n# These groups are read by MariaDB server.\n# Use it for options that only the server (but not clients) should see\n#\n# See the examples of server my.cnf files in /usr/share/mysql/\n#\n\n# this is read by the standalone daemon and embedded servers\n[server]\n\n# this is only for the mysqld standalone daemon\n[mysqld]\n## \u8ffd\u52a0 ##\ncharacter-set-server=utf8\n\n# this is only for embedded server\n[embedded]\n\n...\u4ee5\u4e0b\u7701\u7565...\n```\n\n###\u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\n\n```bash:\n$ sudo systemctl enable mariadb\n$ sudo systemctl restart mariadb\n```\n\n###root\u30d1\u30b9\u30ef\u30fc\u30c9\n\u521d\u671f\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u306a\u3057\u3067\u5371\u967a\u306a\u306e\u3067\u3001\u65b0\u3057\u3044\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```bash:\n$ mysqladmin password -u root\nEnter password:\nNew password:\nConfirm new password:\n```\n\n###\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u4f5c\u6210\n\n```mysql:mysql\n$ mysql -u root -p\nMariaDB [(none)]>create database redmine;\nMariaDB [(none)]>create user 'redmine'@'localhost' identified by 'redmine_pass';\nMariaDB [(none)]>grant all privileges on redmine.* to 'redmine'@'localhost';\nMariaDB [(none)]>exit;\n```\n##redmine\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u305f\u3081\u3001root\u6a29\u9650\uff08wheel\uff09\u3067\u306a\u3044\u5c02\u7528\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash:\n$ sudo useradd redmine\n$ sudo passwd redmine\n```\n\n##Redmine\u672c\u4f53\n###\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3068\u5c55\u958b\n\u672c\u5bb6\u304b\u3089redmine-3.2.1\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n```bash:\n$ cd ~/\n$ curl -O http://www.redmine.org/releases/redmine-3.2.1.tar.gz\n$ tar -xvf redmine-3.2.1.tar.gz\n$ sudo mv redmine-3.2.1 /var/lib\n$ cd /var/lib/redmine-3.2.1\n$ sudo chmod -R 755 files log public/plugin_assets\n$ sudo chown -R redmine:nginx .\n```\n\n###DB\u306e\u8a2d\u5b9a\n\u5f15\u304d\u7d9a\u304d`/var/lib/redmine-3.2.1`\u3067\u4f5c\u696d\u3057\u307e\u3059\u3002\n\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fDB\u306e\u30e6\u30fc\u30b6\u30fc\u540d\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```bash:\n$ sudo -u redmine cp config/database.yml.example config/database.yml\n$ sudo -u redmine vi config/database.yml\n```\n\n```yaml:config/database.yml\n...\u7701\u7565...\n\nproduction:\n  adapter: mysql2\n  database: redmine\n  host: localhost\n  username: redmine\n  password: redmine_pass\n  encoding: utf8\n\n...\u7701\u7565...\n```\n\n###bundler\u3067gems\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nGemfile\u306brails\u3092\u7a3c\u50cd\u3055\u305b\u308bRack Server\u3068\u3057\u3066puma\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\uff08unicorn\u3088\u308a\u6d41\u884c\u3063\u3066\u308b\uff1f\uff06\u5c0e\u5165\u304c\u697d\u3060\u3063\u305f\u306e\u3067\uff09\nGemfile 17\u884c\u76ee\u3042\u305f\u308a\u306bpuma\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```bash:\n$ sudo -u redmine vi Gemfile\n```\n\n```ruby:Gemfile\n...\u7701\u7565...\ngem \"protected_attributes\"\ngem \"actionpack-action_caching\"\ngem \"actionpack-xml_parser\"\ngem \"roadie-rails\"\ngem \"puma\"\n...\u7701\u7565...\n```\n\n~~nokogiri-1.6.6.2\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3088\u3046\u3068\u3057\u3066\u3001C\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u53c2\u7167\u3057\u3088\u3046\u3068\u3057\u307e\u3059\u3002\u305d\u306e\u307e\u307e\u3060\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308b\u306e\u3067\u3001config\u3067`--use-system-libraries`\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3057\u3066\u304b\u3089bundle install\u3057\u307e\u3059\u3002~~\n\u203brails\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\u3067\u3084\u3063\u3066\u3044\u308b\u306e\u3067\u4e0d\u8981\u3067\u3057\u305f\n\n\u4eca\u56de\u306fMySql(MariaDB)\u3092\u4f7f\u7528\u3059\u308b\u306e\u3067\u3001\u672c\u5bb6\u3067\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308b\u901a\u308apostgresql\u3068sqlite\u306f\u9664\u5916\u3057\u307e\u3059\u3002\n\n```bash:\n$ sudo -u redmine -E /var/lib/redmine-3.2.1/bin/bundle install --path vendor/bundle --without development test postgresql sqlite\n```\n\n###\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30a2\u79d8\u5bc6\u9375\u751f\u6210\nrake\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u751f\u6210\u3057\u307e\u3059\u3002\n\n\n```bash:\n$ sudo -u redmine /home/redmine/bin/bundle exec rake generate_secret_token\n```\n\n###DB\u30c6\u30fc\u30d6\u30eb\u521d\u671f\u5316\n```bash:\n$ sudo -u redmine RAILS_ENV=production /home/redmine/bin/bundle exec rake db:migrate\n```\n\n\u65b0\u898f\u306e\u5834\u5408\u306f\u521d\u671f\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30c7\u30fc\u30bf\u3092\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\u79fb\u884c\u306e\u5834\u5408\u306f\u3053\u306e\u624b\u9806\u3092\u98db\u3070\u3057\u3066\u3001\u30c7\u30fc\u30bf\u3092\u30a4\u30f3\u30dd\u30fc\u30c8\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u8a00\u8a9e\u3092\u8a0a\u304b\u308c\u305f\u3089\u65e5\u672c\u8a9e`ja`\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\n```bash:\n$ sudo -u redmine RAILS_ENV=production /home/redmine/bin/bundle exec rake redmine:load_default_data\n\nSelect language: ar, az, bg, bs, ca, cs, da, de, el, en, en-GB, es, es-PA, et, eu, fa, fi, fr, gl, he, hr, hu, id, it, ja, ko, lt, lv, mk, mn, nl, no, pl, pt, pt-BR, ro, ru, sk, sl, sq, sr, sr-YU, sv, th, tr, uk, vi, zh, zh-TW [en] ja\n```\n\n##Webrick\u3067\u30c6\u30b9\u30c8\n\u3068\u308a\u3042\u3048\u305a\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067webrick\u8d77\u52d5\u3057\u307e\u3059\u3002curl\u3067\u30da\u30fc\u30b8\u306e\u30bd\u30fc\u30b9\u304c\u53d6\u5f97\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\n$ cd /var/lib/redmine-3.2.1\n$ sudo -u redmine /home/redmine/bin/bundle exec rails server webrick -e production &\n$ curl http://localhost:3000\n\u30b5\u30fc\u30d0\u30fc\u3092\u505c\u6b62\u3059\u308b\u3068\u304d\n$ fg\nCtrl+C\n```\n\n\u5916\u90e8\u304b\u3089\u30d6\u30e9\u30a6\u30b6\u3067\u53c2\u7167\u3057\u305f\u3051\u308c\u3070\u3001firewall-cmd\u3067\u30dd\u30fc\u30c83000\u756a\u958b\u3051\u3066\u304f\u3060\u3055\u3044\u3002\n\u307e\u305f\u3001\u3059\u3079\u3066\u306e\u30a2\u30c9\u30ec\u30b9\u304b\u3089\u5f85\u3061\u53d7\u3051\u308b\u3088\u3046\u3001`-b 0.0.0.0`\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```bash:\n$ sudo firewall-cmd --add-port=3000/tcp\n$ rails server webrick -e production -b 0.0.0.0 &\n\u30b5\u30fc\u30d0\u30fc\u3092\u505c\u6b62\u3059\u308b\u3068\u304d\n$ fg\nCtrl+C\n```\n## puma\n\n###\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8a18\u8ff0\n\n```bash:\n$ cd /var/lib/redmine-3.2.1\n$ sudo -u redmine vi config/puma.rb\n```\n\n```ruby:puma.rb\napp_root = '/var/lib/redmine-3.2.1'\n\ndirectory app_root\nenvironment 'production'\npidfile \"#{app_root}/tmp/pids/puma.pid\"\nstate_path \"#{app_root}/tmp/pids/puma.state\"\nbind \"unix://#{app_root}/tmp/sockets/redmine.sock\"\nactivate_control_app\n```\n\n### puma\u3067\u30c6\u30b9\u30c8\npuma\u3067\u30c6\u30b9\u30c8\u3057\u3066\u307f\u307e\u3059\u3002\u30bd\u30b1\u30c3\u30c8\u7d4c\u7531\n\n```bash:\n$ cd /var/lib/redmine-3.2.1\n$ sudo -u redmine bin/bundle exec puma \n```\n\n\u7a3c\u50cd\u3057\u3066\u3044\u308b\u3053\u3068\u306f\u308f\u304b\u308a\u307e\u3059\u304c\u3001curl\u3067unix\u30bd\u30b1\u30c3\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b`--unix-socket`\u306f`CentOS Linux release 7.1.1503`\u6a19\u6e96\u306e7.29.0\u3067\u306f\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u30a8\u30e9\u30fc\u304c\u306a\u3044\u3053\u3068\u3060\u3051\u78ba\u8a8d\u3002\u65b9\u6cd5\u77e5\u3063\u3066\u308b\u4eba\u3044\u305f\u3089\u304a\u3057\u3048\u3066\u304f\u3060\u3055\u3044\u3002\uff08\u7d20\u76f4\u306b7.40\u3044\u308c\u308c\u3070\u826f\u3044\u3093\u3060\u3051\u3069\uff09\n\n## daemon\u5316\nsystemd\u3067\u8d77\u52d5\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n###service\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n```\n$ sudo vi /usr/lib/systemd/system/redmine.service\n```\n\n```text:/usr/lib/systemd/system/redmine.service\n[Unit]\nDescription=Redmine on PUMA\nAfter=network.target\n\n[Service]\nType=simple\nExecStart=/var/lib/redmine-3.2.1/bin/bundle exec pumactl -F /var/lib/redmine-3.2.1/config/puma.rb start\nKillMode=process\nKillSignal=SIGQUIT\nUser=redmine\nGroup=nginx\n\n[Install]\nWantedBy=multi-user.target\n```\n\n###systemd\u304b\u3089\u8d77\u52d5\u3059\u308b\n\n```bash:\nsystem\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3057\u305f\u306e\u3067\u3001\u8a2d\u5b9a\u3092\u30ea\u30ed\u30fc\u30c9\n$ sudo systemctl daemon-reload\n\n\u81ea\u52d5\u8d77\u52d5\u3092\u6709\u52b9\u306b\u3059\u308b\n$ sudo systemctl enable redmine\n\n\u958b\u59cb\n$ sudo systemctl start redmine\n\n\u6b63\u3057\u304f\u958b\u59cb\u3055\u308c\u305f\u304b\u78ba\u8a8d\n$ sudo systemctl status redmine\n\nActive: active (running)\u306b\u306a\u3063\u3066\u3044\u308c\u3070OK\n```\n\n## nginx\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3059\u308b\n\u30b5\u30fc\u30d0\u30fc\u8a2d\u5b9a\u3068\u3001\u30ed\u30b1\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```bash:\n$ sudo vi /etc/nginx/conf.d/redmine_server.conf\n```\n\n```text:/etc/nginx/conf.d/redmine_server.conf\nupstream redmine {\n  server unix:/var/lib/redmine-3.2.1/tmp/sockets/redmine.sock;\n}\n```\n\n```bash:\n$ sudo vi /etc/nginx/default.d/redmine.conf\n```\n\n```text:/etc/nginx/default.d/redmine.conf\nlocation / {\n  root /var/lib/redmine-3.2.1/public;\n  access_log  /var/log/nginx/redmine_access.log;\n  error_log   /var/log/nginx/redmine_error.log;\n\n  try_files $uri $uri/index.html $uri.html @redmine;\n}\n\nlocation @redmine {\n  proxy_read_timeout    300;\n  proxy_connect_timeout 300;\n  proxy_redirect        off;\n  proxy_set_header Host      $http_host;\n  proxy_set_header X-Real-IP $remote_addr;\n\n  proxy_pass http://redmine;\n}\n```\n\n\u8a2d\u5b9a\u304c\u6709\u52b9\u304b\u78ba\u8a8d\u3057\u3066\u3001\u30ea\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n```bash:\n\u78ba\u8a8d\n$ sudo nginx -t\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n\n\u30ea\u30ed\u30fc\u30c9\n$ sudo systemctl reload nginx\n```\n\n###\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u5834\u5408\nlocation\u8a2d\u5b9a\u3092\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\n\n```bash:\n$ sudo vi /etc/nginx/default.d/redmine.conf\n```\n\n```text:/etc/nginx/default.d/redmine.conf\nlocation /redmine {\n  root /var/lib/redmine-3.2.1/public;\n  access_log  /var/log/nginx/redmine_access.log  main;\n  error_log  /var/log/nginx/redmine_error.log  main;\n\n  try_files $uri $uri/index.html $uri.html @redmine;\n}\n\nlocation @redmine {\n  proxy_read_timeout    300;\n  proxy_connect_timeout 300;\n  proxy_redirect        off;\n\n  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n  proxy_set_header Host            $http_host;\n  proxy_set_header X-Real-IP       $remote_addr;\n\n  proxy_pass http://redmine;\n}\n```\n\u3055\u3089\u306b\u3001relative_url_root\u306b\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u767b\u9332\u3057\u3066\u3001\u30eb\u30fc\u30c8\u30d1\u30b9\"/\"\u306b\u30de\u30c3\u30d7\u3059\u308b\u3088\u3046\u3001redmine\u306e\u8a2d\u5b9a\u3082\u5909\u66f4\u3057\u307e\u3059\u3002\n[\u53c2\u8003](http://www.redmine.org/projects/redmine/wiki/HowTo_Install_Redmine_in_a_sub-URI)\n\n\n```bash:\n$ sudo -u redmine vi /var/lib/redmine-3.2.1/config/environment.rb\n```\n\n```rb:/var/lib/redmine-3.2.1/config/environment.rb\n# \u672b\u5c3e\u306b\u8ffd\u52a0\nRedmine::Utils::relative_url_root = \"/redmine\"\n```\n\n```bash:\n$ sudo -u redmine vi /var/lib/redmine-3.2.1/config.ru\n```\n```rb:/var/lib/redmine-3.2.1/config.ru\n#run RedmineApp::Application\nmap ActionController::Base.relative_url_root || \"/\" do\n  run RedmineApp::Application\nend\n```\n\n##SELinux\u7121\u52b9\u5316\n\u7c21\u5358\u306e\u305f\u3081\u3001SELinux\u3092Permissive\u306b\u3057\u307e\u3059\u3002\n\n\u518d\u8d77\u52d5\u3057\u305f\u3068\u304d\u306bpermissive\u306b\u306a\u308b\u3088\u3046\u3001\u8a2d\u5b9a\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```bash:\n$ sudo vi /etc/sysconfig/selinux\n```\n\n7\u884c\u76ee\n\n```text:/etc/sysconfig/selinux\nSELINUX=permissive \n```\n\n\u518d\u8d77\u52d5\u3059\u308b\u307e\u3067\u53cd\u6620\u3055\u308c\u306a\u3044\u306e\u3067\u3001\u660e\u793a\u7684\u306b\u5373\u6642\u53cd\u6620\u3059\u308b\u3002\n\n```bash:\n$ sudo setenforce 0\n```\n\n##\u78ba\u8a8d\nWeb\u30d6\u30e9\u30a6\u30b6\u3067\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\nhttp://[yourhost]/\n\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u5834\u5408\u306f\nhttp://[yourhost]/redmine\n\n\u753b\u50cf\u306f\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u8a2d\u5b9a\u3057\u305f\u4f8b\u3002\n![redmine_browser.PNG](https://qiita-image-store.s3.amazonaws.com/0/69798/deb82519-612f-a455-414f-54f7b0a6436f.png)\n\n##\u5b9f\u7528\u5316\u306e\u305f\u3081\u306b\u8ffd\u52a0\u3067\u3084\u308b\u3079\u304d\u3053\u3068\n\u3053\u3053\u306b\u306f\u66f8\u3044\u3066\u307e\u305b\u3093\u304c\u3001\u5b9f\u7528\u3059\u308b\u306b\u306f\n\u30fb\u7ba1\u7406\u8005\u306e\u30e1\u30fc\u30eb\u8a2d\u5b9a[\uff08\u30e1\u30fc\u30eb\u901a\u77e5\uff09](http://redmine.jp/faq/general/mail_notification/)\n\u30fbSSL\u3092\u901a\u3059[\uff08nginx\u306b\u8a2d\u5b9a\uff09](http://nginx.org/en/docs/http/configuring_https_servers.html)\n\u30fb[\u5b9a\u671f\u30d0\u30c3\u30af\u30a2\u30c3\u30d7](http://redmine.jp/faq/system_management/backup/)\n\u306a\u3069\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n", "tags": ["Redmine3.2.1", "CentOS7", "Rails4", "mariadb5.5", "nginx"]}