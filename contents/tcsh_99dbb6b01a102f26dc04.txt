{"context": " More than 1 year has passed since last update.PHP\u3067\u3001Twilio\u306b\u84c4\u7a4d\u3055\u308c\u305f\u9332\u97f3\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u4e00\u89a7\u3092\u8868\u793a\u3057\u3066\u307f\u307e\u3059\u3002\n\u307e\u305f\u3001\u9332\u97f3\u30c7\u30fc\u30bf\u306e\u518d\u751f\u3084\u524a\u9664\u3082\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u524d\u63d0\u6761\u4ef6\n\n\u516c\u958b\u30b5\u30fc\u30d0\u74b0\u5883\n\n(\u53c2\u8003) Amazon Linux\u74b0\u5883\u306e\u69cb\u7bc9\n\n\n\u30ad\u30fc\u30da\u30a2\u306e\u4f5c\u6210 (\u65b0\u898f): http://qiita.com/tcsh/items/59303d9506ca7d13f744\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210 (Public): http://qiita.com/tcsh/items/ae8f1f0d706237327c5a\n\n\n\n\n\nWeb\u30b5\u30fc\u30d0 + PHP\u74b0\u5883\n\nTwilio Post\u7528\u30b5\u30fc\u30d0\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u3066\u307f\u308b (AmazonLinux + nginx + php-fpm): \n\n\nTwilio\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\n\nTwilio\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4fdd\u6709\u3057\u3066\u3044\u308b\u3053\u3068\u3002\n\n\nTwilio\u306e\u96fb\u8a71\u756a\u53f7\nTwilio\u306e\u8a8d\u8a3c\u60c5\u5831 (ACCOUNT SID / AUTH TOKEN)\n\n\n\n\nTwilio+PHP\u74b0\u5883\n\nPHP (5.4\u4ee5\u4e0a\u3092\u60f3\u5b9a)\nTwilio PHP SDK\n\n(\u53c2\u8003) Twilio\u3067\u96fb\u8a71\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u308b (\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u74b0\u5883: Twilio PHP SDK): http://qiita.com/tcsh/items/d0449909f20916fff159\n\n0. \u4e8b\u524d\u6e96\u5099\n\nTwilio\u30a2\u30ab\u30a6\u30f3\u30c8\u60c5\u5831\u306e\u8a2d\u5b9a\nTwilio\u306e\u300c\u306f\u3058\u3081\u3088\u3046\u300d\u753b\u9762\u304b\u3089\u4ee5\u4e0b\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066\u5909\u6570\u306b\u683c\u7d0d\u3057\u307e\u3059\u3002\n\nACCOUNT SID\nAUTH TOKEN\n\u96fb\u8a71\u756a\u53f7\n\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nTWILIO_ACCOUNT_SID='ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'\nTWILIO_AUTH_TOKEN='xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'\nTEL_TWILIO_ORIGIN=<Twilio\u3067\u53d6\u5f97\u3057\u305f\u96fb\u8a71\u756a\u53f7>\n\n\n\n1. \u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\n\n1.1. \u30d5\u30a1\u30a4\u30eb\u7f6e\u304d\u5834\u306e\u4f5c\u6210\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nDIR_HTML='/usr/share/nginx/html'\nDIR_PHP_SCRIPT=\"${DIR_HTML}/sysadm\"\nURL_PHP_SCRIPT=$(echo ${DIR_PHP_SCRIPT} | sed \"s|${DIR_HTML}||\" )\n\n\n\n\u30b3\u30de\u30f3\u30c9\nsudo mkdir -p ${DIR_PHP_SCRIPT} \\\n  && ls ${DIR_PHP_SCRIPT}\n\n\n\n1.2. \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nDIR_TWILIO_APP=\"${HOME}/app/twilio-admin-app\" \\\n  && echo ${DIR_TWILIO_APP}\nAPP_NAME=$(echo ${DIR_TWILIO_APP} | sed 's|^.*/||') \\\n  && echo ${APP_NAME}\n\n\n\n\u30b3\u30de\u30f3\u30c9\nmkdir -p ${DIR_TWILIO_APP} \\\n  && cd ${DIR_TWILIO_APP}\n\n\n\n1.3. composer\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u30b3\u30de\u30f3\u30c9\ncd ${DIR_TWILIO_APP} \\\n  && mkdir bin \\\n  && curl -sS https://getcomposer.org/installer | \\\n  php -- --install-dir=bin --filename=composer\n\n\n\n\u7d50\u679c(\u4f8b)\n      #!/usr/bin/env php\n      All settings correct for using Composer\n      Downloading...\n\n      Composer successfully installed to: /Users/taro/app/twilio-php/composer.phar\n      Use it: php bin/composer\n\n\n\n1.4. Twilio PHP SDK\u306e\u5c0e\u5165\n\u53c2\u8003: https://jp.twilio.com/docs/php/install\n\n\u30b3\u30de\u30f3\u30c9\ncd ${DIR_TWILIO_APP} \\\n  && ./bin/composer require twilio/sdk\n\n\n\n\u7d50\u679c(\u4f8b)\n      Using version ^4.2 for twilio/sdk\n      ./composer.json has been created\n      Loading composer repositories with package information\n      Updating dependencies (including require-dev)\n        - Installing twilio/sdk (4.2.1)\n          Downloading: 100%\n\n      Writing lock file\n      Generating autoload files\n\n\n\n\u30b3\u30de\u30f3\u30c9\nls ${DIR_TWILIO_APP}/vendor/twilio/sdk/Services/Twilio.php > /dev/null 2>&1 \\\n  && echo $?\n\n\n\n\u7d50\u679c(\u4f8b\n0\n\n\nTwilio PHP\u30e9\u30a4\u30d6\u30e9\u30ea\u30d5\u30a1\u30a4\u30eb\u306e\u4f4d\u7f6e\u3092\u5909\u6570\u306b\u53d6\u308a\u8fbc\u307f\u307e\u3059\u3002\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nFILE_LIB_TWILIO=\"vendor/twilio/sdk/Services/Twilio.php\" \\\n  && ls ${FILE_LIB_TWILIO} > /dev/null 2>&1 \\\n  && echo $?\n\n\n\n\u7d50\u679c(\u4f8b)\n0\n\n\n\n2. \u96fb\u8a71\u9332\u97f3\u30a2\u30d7\u30ea\u306e\u4f5c\u6210\n\u30b5\u30fc\u30d0\u4e0a\u306b\u96fb\u8a71\u53d7\u4fe1\u30a2\u30d7\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n2.1. Twilio\u306b\u9332\u97f3\u3055\u308c\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u4e00\u89a7\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f5c\u6210\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nFILE_PHP_SCRIPT='list-records.php'\nFILE_CSS='main.css'\n\n\n\n\u5909\u6570\u306e\u78ba\u8a8d\"\ncat << ETX\n\n  APP_NAME:           ${APP_NAME}\n  FILE_PHP_SCRIPT:    ${FILE_PHP_SCRIPT}\n  TWILIO_ACCOUNT_SID: ${TWILIO_ACCOUNT_SID}\n  TWILIO_AUTH_TOKEN:  ${TWILIO_AUTH_TOKEN}\n  FILE_CSS:           ${FILE_CSS}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\ncat << EOF > ${FILE_PHP_SCRIPT}\n<!DOCTYPE html>\n<!-- author: Toshiaki Enami -->\n<meta charset=\"UTF-8\">\n<title>List Records</title>\n<link rel=\"stylesheet\" type=\"text/css\" href=\"main.css\">\n<script src=\"//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js\"></script>\n<script>\n  function del(sid){\n      \\$.ajax({\n        url: 'delete-record.php',\n        type: 'post',\n        dataType: 'json',\n        data: { \n          RecordingSid: sid\n        }\n      })\n      .done(function (response) {\n          location.reload();\n      })\n      .fail(function () {\n          location.reload();\n\n      });\n    };\n</script>\n\n<hr />\n\n<table>\n  <caption>\u9332\u97f3\u30ea\u30b9\u30c8</caption>\n  <thead>\n    <tr><th scope=\"col\">DateCreated</th><th scope=\"col\">From</th><th scope=\"col\">To</th><th scope=\"col\">Duration</th><th scope=\"col\">Action</th></tr>\n  </thead>\n  <tbody>\n  <?php\n    require('${FILE_LIB_TWILIO}'); \n    \\$account_sid = '${TWILIO_ACCOUNT_SID}'; \n    \\$auth_token = '${TWILIO_AUTH_TOKEN}'; \n    \\$client = new Services_Twilio(\\$account_sid, \\$auth_token); \n    \\$recordings = \\$client->account->recordings->getIterator(0, 50, array(   \n    )); \n    foreach (\\$recordings as \\$recording) {\n      //var_dump(\\$recording);\n      \\$i = 0;\n      echo '<tr >';\n      if (\\$i == 0) {\n        echo '<th scope=\"row\">' . \\$recording->date_created . '</th>';\n        \\$i++;\n      }\n      \\$call_sid = \\$recording->call_sid;\n      echo \"<td>\" . getCaller(\\$client, \\$call_sid, \"from\") . \"</td>\";\n      echo \"<td>\" . getCaller(\\$client, \\$call_sid, \"to\") . \"</td>\";\n      echo \"<td>\" . \\$recording->duration . \"</td>\";\n      echo \"<td><a href='https://api.twilio.com\" . \\$recording->uri . \".wav'>Play</a><br /><a onclick='del(\\\"\" . \\$recording->sid . \"\\\")'>Delete</a></td>\";\n      echo \"</tr >\";\n    }\n\n    function getCaller(\\$client, \\$callSid, \\$type){\n      \\$call = \\$client->account->calls->get(\\$callSid);\n      if(\\$type == \"from\"){\n        return \\$call->from;\n      } elseif(\\$type == \"to\"){\n        return \\$call->to;\n      } else {\n        return NULL;\n      }\n    }\n  ?>\n  </tbody>\n</table>\nEOF\n\ncat ${FILE_PHP_SCRIPT}\n\n\n\u52d5\u4f5c\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u30b3\u30de\u30f3\u30c9\nphp ${FILE_PHP_SCRIPT}\n\n\n\n\u7d50\u679c(\u4f8b)\n<!DOCTYPE html>\n<!-- author: Toshiaki Enami -->\n<meta charset=\"UTF-8\">\n<title>List Records</title>\n<link rel=\"stylesheet\" type=\"text/css\" href=\"main.css\">\n<script src=\"//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js\"></script>\n<script>\n  function del(sid){\n      $.ajax({\n        url: 'delete-record.php',\n        type: 'post',\n        dataType: 'json',\n        data: { \n          RecordingSid: sid\n        }\n      })\n      .done(function (response) {\n          location.reload();\n      })\n      .fail(function () {\n          location.reload();\n\n      });\n    };\n</script>\n\n<hr />\n\n<table>\n  <caption>\u9332\u97f3\u30ea\u30b9\u30c8</caption>\n  <thead>\n    <tr><th scope=\"col\">DateCreated</th><th scope=\"col\">From</th><th scope=\"col\">To</th><th scope=\"col\">Duration</th><th scope=\"col\">Action</th></tr>\n  </thead>\n  <tbody>\n  <tr ><th scope=\"row\">Sat, 10 Oct 2015 00:28:38 +0000</th><td>+819018480135</td><td>+815031717400</td><td>2</td><td><a href='https://api.twilio.com/2010-04-01/Accounts/ACee27e8a970548a537b8ea8c4f0dd7bd4/Recordings/REd57ab0d42b29e7b7ad63710a4294066e.wav'>Play</a><br /><a onclick='del(\"REd57ab0d42b29e7b7ad63710a4294066e\")'>Delete</a></td></tr >  </tbody>\n</table>\n\n\n\n2.2. CSS\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\ncat << EOF > ${FILE_CSS}\ntable, th, td {\n    border: 1px solid #D4E0EE;\n    border-collapse: collapse;\n    font-family: \"Trebuchet MS\", Arial, sans-serif;\n    color: #555;\n}\n\ncaption {\n    font-size: 150%;\n    font-weight: bold;\n    margin: 5px;\n}\n\ntd, th {\n    padding: 4px;\n}\n\nthead th {\n    text-align: center;\n    background: #E6EDF5;\n    color: #4F76A3;\n    font-size: 100% !important;\n}\n\ntbody th {\n    font-weight: bold;\n}\n\ntbody tr { background: #FCFDFE; }\n\ntbody tr.odd { background: #F7F9FC; }\n\ntable a:link {\n    color: #718ABE;\n    text-decoration: none;\n}\n\ntable a:visited {\n    color: #718ABE;\n    text-decoration: none;\n}\n\ntable a:hover {\n    color: #718ABE;\n    text-decoration: underline !important;\n}\n\ntfoot th, tfoot td {\n    font-size: 85%;\n}\nEOF\n\ncat ${FILE_CSS}\n\n\n\n2.3. \u9332\u97f3\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\nFILE_PHP_SCRIPT='delete-record.php'\n\n\n\n\u30b3\u30de\u30f3\u30c9\ncat << EOF > ${FILE_PHP_SCRIPT}\n<?php\n// author: Toshiaki Enami\nrequire('${FILE_LIB_TWILIO}');\n\\$account_sid = '${TWILIO_ACCOUNT_SID}';\n\\$auth_token = '${TWILIO_AUTH_TOKEN}';\n\\$client = new Services_Twilio(\\$account_sid, \\$auth_token);\n\nheader('Content-Type: application/json');\n// Need to validate paratmer\n\\$client->account->recordings->delete(\\$_POST['RecordingSid']);\necho \"Done\";\nEOF\n\ncat ${FILE_PHP_SCRIPT}\n\n\n\n3. Web\u30b5\u30fc\u30d0\u306e\u516c\u958b\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u914d\u7f6e\n\n\u30b3\u30de\u30f3\u30c9\nsudo cp -R ${DIR_TWILIO_APP} ${DIR_PHP_SCRIPT}/ \\\n  && cat ${DIR_PHP_SCRIPT}/${APP_NAME}/${FILE_PHP_SCRIPT} \\\n  && cat ${DIR_PHP_SCRIPT}/${APP_NAME}/${FILE_CSS}  \n\n\n\n4. \u30b9\u30af\u30ea\u30d7\u30c8\u306e\u52d5\u4f5c\u78ba\u8a8d\n\u30d6\u30e9\u30a6\u30b6\u3067 http://<\u30db\u30b9\u30c8>/sysadm/twilio-admin-app/list-records.php \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u9332\u97f3\u30c7\u30fc\u30bf\u306e\u4e00\u89a7\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308c\u3070OK\u3067\u3059\u3002\n\nPlay\u30ea\u30f3\u30af\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001\u9332\u97f3\u30c7\u30fc\u30bf\u304c\u518d\u751f\u3055\u308c\u307e\u3059\u3002\nDelete\u30ea\u30f3\u30af\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001\u9332\u97f3\u30c7\u30fc\u30bf\u304c\u524a\u9664\u3055\u308c\u307e\u3059\u3002\n\n\n5. Twilio\u306e\u30ed\u30b0\u78ba\u8a8d\n\n\u30ed\u30b0\u30a4\u30f3: http://twilio.kddi-web.com\n\n\u753b\u9762: https://jp.twilio.com/user/account/log/calls\n\n\u524a\u9664\u3057\u305f\u9332\u97f3\u30c7\u30fc\u30bf\u304c\u5b58\u5728\u3057\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002(\u53d7\u4fe1\u8a18\u9332\u81ea\u4f53\u306f\u6b8b\u3063\u3066\u3044\u307e\u3059\u3002)\n\n\n\n\n\u5b8c\u4e86\n\nPHP\u3067\u3001Twilio\u306b\u84c4\u7a4d\u3055\u308c\u305f\u9332\u97f3\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u4e00\u89a7\u3092\u8868\u793a\u3057\u3066\u307f\u307e\u3059\u3002\n\u307e\u305f\u3001\u9332\u97f3\u30c7\u30fc\u30bf\u306e\u518d\u751f\u3084\u524a\u9664\u3082\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3059\u3002\n\n\n# \u524d\u63d0\u6761\u4ef6\n\n## \u516c\u958b\u30b5\u30fc\u30d0\u74b0\u5883\n\n* (\u53c2\u8003) Amazon Linux\u74b0\u5883\u306e\u69cb\u7bc9\n   * \u30ad\u30fc\u30da\u30a2\u306e\u4f5c\u6210 (\u65b0\u898f): http://qiita.com/tcsh/items/59303d9506ca7d13f744\n   * \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210 (Public): http://qiita.com/tcsh/items/ae8f1f0d706237327c5a\n\n\n## Web\u30b5\u30fc\u30d0 + PHP\u74b0\u5883\n\n* Twilio Post\u7528\u30b5\u30fc\u30d0\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u3066\u307f\u308b (AmazonLinux + nginx + php-fpm): \n\n\n\n## Twilio\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\n\n* Twilio\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4fdd\u6709\u3057\u3066\u3044\u308b\u3053\u3068\u3002\n  * Twilio\u306e\u96fb\u8a71\u756a\u53f7\n  * Twilio\u306e\u8a8d\u8a3c\u60c5\u5831 (ACCOUNT SID / AUTH TOKEN)\n\n\n## Twilio+PHP\u74b0\u5883\n\n* PHP (5.4\u4ee5\u4e0a\u3092\u60f3\u5b9a)\n* Twilio PHP SDK\n\n(\u53c2\u8003) Twilio\u3067\u96fb\u8a71\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u308b (\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u74b0\u5883: Twilio PHP SDK): http://qiita.com/tcsh/items/d0449909f20916fff159\n\n\n# 0. \u4e8b\u524d\u6e96\u5099\n\n## Twilio\u30a2\u30ab\u30a6\u30f3\u30c8\u60c5\u5831\u306e\u8a2d\u5b9a\n\nTwilio\u306e\u300c\u306f\u3058\u3081\u3088\u3046\u300d\u753b\u9762\u304b\u3089\u4ee5\u4e0b\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066\u5909\u6570\u306b\u683c\u7d0d\u3057\u307e\u3059\u3002\n\n* ACCOUNT SID\n\n* AUTH TOKEN\n\n* \u96fb\u8a71\u756a\u53f7\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nTWILIO_ACCOUNT_SID='ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'\nTWILIO_AUTH_TOKEN='xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'\nTEL_TWILIO_ORIGIN=<Twilio\u3067\u53d6\u5f97\u3057\u305f\u96fb\u8a71\u756a\u53f7>\n```\n\n\n# 1. \u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\n\n## 1.1. \u30d5\u30a1\u30a4\u30eb\u7f6e\u304d\u5834\u306e\u4f5c\u6210\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a\nDIR_HTML='/usr/share/nginx/html'\nDIR_PHP_SCRIPT=\"${DIR_HTML}/sysadm\"\nURL_PHP_SCRIPT=$(echo ${DIR_PHP_SCRIPT} | sed \"s|${DIR_HTML}||\" )\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nsudo mkdir -p ${DIR_PHP_SCRIPT} \\\n  && ls ${DIR_PHP_SCRIPT}\n```\n\n\n\n## 1.2. \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nDIR_TWILIO_APP=\"${HOME}/app/twilio-admin-app\" \\\n  && echo ${DIR_TWILIO_APP}\nAPP_NAME=$(echo ${DIR_TWILIO_APP} | sed 's|^.*/||') \\\n  && echo ${APP_NAME}\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9\nmkdir -p ${DIR_TWILIO_APP} \\\n  && cd ${DIR_TWILIO_APP}\n```\n\n\n\n## 1.3. composer\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash:\u30b3\u30de\u30f3\u30c9:\ncd ${DIR_TWILIO_APP} \\\n  && mkdir bin \\\n  && curl -sS https://getcomposer.org/installer | \\\n  php -- --install-dir=bin --filename=composer\n```\n\n```text:\u7d50\u679c(\u4f8b):\n      #!/usr/bin/env php\n      All settings correct for using Composer\n      Downloading...\n\n      Composer successfully installed to: /Users/taro/app/twilio-php/composer.phar\n      Use it: php bin/composer\n```\n\n\n## 1.4. Twilio PHP SDK\u306e\u5c0e\u5165\n\n\u53c2\u8003: https://jp.twilio.com/docs/php/install\n\n\n```bash:\u30b3\u30de\u30f3\u30c9:\ncd ${DIR_TWILIO_APP} \\\n  && ./bin/composer require twilio/sdk\n```\n\n```text:\u7d50\u679c(\u4f8b):\n      Using version ^4.2 for twilio/sdk\n      ./composer.json has been created\n      Loading composer repositories with package information\n      Updating dependencies (including require-dev)\n        - Installing twilio/sdk (4.2.1)\n          Downloading: 100%\n\n      Writing lock file\n      Generating autoload files\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9\nls ${DIR_TWILIO_APP}/vendor/twilio/sdk/Services/Twilio.php > /dev/null 2>&1 \\\n  && echo $?\n```\n\n```text:\u7d50\u679c(\u4f8b:\n0\n```\n\nTwilio PHP\u30e9\u30a4\u30d6\u30e9\u30ea\u30d5\u30a1\u30a4\u30eb\u306e\u4f4d\u7f6e\u3092\u5909\u6570\u306b\u53d6\u308a\u8fbc\u307f\u307e\u3059\u3002\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nFILE_LIB_TWILIO=\"vendor/twilio/sdk/Services/Twilio.php\" \\\n  && ls ${FILE_LIB_TWILIO} > /dev/null 2>&1 \\\n  && echo $?\n```\n\n```text:\u7d50\u679c(\u4f8b):\n0\n```\n\n\n# 2. \u96fb\u8a71\u9332\u97f3\u30a2\u30d7\u30ea\u306e\u4f5c\u6210\n\n\u30b5\u30fc\u30d0\u4e0a\u306b\u96fb\u8a71\u53d7\u4fe1\u30a2\u30d7\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n## 2.1. Twilio\u306b\u9332\u97f3\u3055\u308c\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u4e00\u89a7\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f5c\u6210\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nFILE_PHP_SCRIPT='list-records.php'\nFILE_CSS='main.css'\n```\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d\"\ncat << ETX\n\n  APP_NAME:           ${APP_NAME}\n  FILE_PHP_SCRIPT:    ${FILE_PHP_SCRIPT}\n  TWILIO_ACCOUNT_SID: ${TWILIO_ACCOUNT_SID}\n  TWILIO_AUTH_TOKEN:  ${TWILIO_AUTH_TOKEN}\n  FILE_CSS:           ${FILE_CSS}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\ncat << EOF > ${FILE_PHP_SCRIPT}\n<!DOCTYPE html>\n<!-- author: Toshiaki Enami -->\n<meta charset=\"UTF-8\">\n<title>List Records</title>\n<link rel=\"stylesheet\" type=\"text/css\" href=\"main.css\">\n<script src=\"//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js\"></script>\n<script>\n  function del(sid){\n      \\$.ajax({\n        url: 'delete-record.php',\n        type: 'post',\n        dataType: 'json',\n        data: { \n          RecordingSid: sid\n        }\n      })\n      .done(function (response) {\n          location.reload();\n      })\n      .fail(function () {\n          location.reload();\n          \n      });\n    };\n</script>\n\n<hr />\n\n<table>\n  <caption>\u9332\u97f3\u30ea\u30b9\u30c8</caption>\n  <thead>\n    <tr><th scope=\"col\">DateCreated</th><th scope=\"col\">From</th><th scope=\"col\">To</th><th scope=\"col\">Duration</th><th scope=\"col\">Action</th></tr>\n  </thead>\n  <tbody>\n  <?php\n    require('${FILE_LIB_TWILIO}'); \n    \\$account_sid = '${TWILIO_ACCOUNT_SID}'; \n    \\$auth_token = '${TWILIO_AUTH_TOKEN}'; \n    \\$client = new Services_Twilio(\\$account_sid, \\$auth_token); \n    \\$recordings = \\$client->account->recordings->getIterator(0, 50, array(   \n    )); \n    foreach (\\$recordings as \\$recording) {\n      //var_dump(\\$recording);\n      \\$i = 0;\n      echo '<tr >';\n      if (\\$i == 0) {\n        echo '<th scope=\"row\">' . \\$recording->date_created . '</th>';\n        \\$i++;\n      }\n      \\$call_sid = \\$recording->call_sid;\n      echo \"<td>\" . getCaller(\\$client, \\$call_sid, \"from\") . \"</td>\";\n      echo \"<td>\" . getCaller(\\$client, \\$call_sid, \"to\") . \"</td>\";\n      echo \"<td>\" . \\$recording->duration . \"</td>\";\n      echo \"<td><a href='https://api.twilio.com\" . \\$recording->uri . \".wav'>Play</a><br /><a onclick='del(\\\"\" . \\$recording->sid . \"\\\")'>Delete</a></td>\";\n      echo \"</tr >\";\n    }\n    \n    function getCaller(\\$client, \\$callSid, \\$type){\n      \\$call = \\$client->account->calls->get(\\$callSid);\n      if(\\$type == \"from\"){\n        return \\$call->from;\n      } elseif(\\$type == \"to\"){\n        return \\$call->to;\n      } else {\n        return NULL;\n      }\n    }\n  ?>\n  </tbody>\n</table>\nEOF\n\ncat ${FILE_PHP_SCRIPT}\n```\n\n\u52d5\u4f5c\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nphp ${FILE_PHP_SCRIPT}\n```\n\n```text:\u7d50\u679c(\u4f8b):\n<!DOCTYPE html>\n<!-- author: Toshiaki Enami -->\n<meta charset=\"UTF-8\">\n<title>List Records</title>\n<link rel=\"stylesheet\" type=\"text/css\" href=\"main.css\">\n<script src=\"//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js\"></script>\n<script>\n  function del(sid){\n      $.ajax({\n        url: 'delete-record.php',\n        type: 'post',\n        dataType: 'json',\n        data: { \n          RecordingSid: sid\n        }\n      })\n      .done(function (response) {\n          location.reload();\n      })\n      .fail(function () {\n          location.reload();\n\n      });\n    };\n</script>\n\n<hr />\n\n<table>\n  <caption>\u9332\u97f3\u30ea\u30b9\u30c8</caption>\n  <thead>\n    <tr><th scope=\"col\">DateCreated</th><th scope=\"col\">From</th><th scope=\"col\">To</th><th scope=\"col\">Duration</th><th scope=\"col\">Action</th></tr>\n  </thead>\n  <tbody>\n  <tr ><th scope=\"row\">Sat, 10 Oct 2015 00:28:38 +0000</th><td>+819018480135</td><td>+815031717400</td><td>2</td><td><a href='https://api.twilio.com/2010-04-01/Accounts/ACee27e8a970548a537b8ea8c4f0dd7bd4/Recordings/REd57ab0d42b29e7b7ad63710a4294066e.wav'>Play</a><br /><a onclick='del(\"REd57ab0d42b29e7b7ad63710a4294066e\")'>Delete</a></td></tr >  </tbody>\n</table>\n```\n\n## 2.2. CSS\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\n\n```bash:\u30b3\u30de\u30f3\u30c9:\ncat << EOF > ${FILE_CSS}\ntable, th, td {\n\tborder: 1px solid #D4E0EE;\n\tborder-collapse: collapse;\n\tfont-family: \"Trebuchet MS\", Arial, sans-serif;\n\tcolor: #555;\n}\n\ncaption {\n\tfont-size: 150%;\n\tfont-weight: bold;\n\tmargin: 5px;\n}\n\ntd, th {\n\tpadding: 4px;\n}\n\nthead th {\n\ttext-align: center;\n\tbackground: #E6EDF5;\n\tcolor: #4F76A3;\n\tfont-size: 100% !important;\n}\n\ntbody th {\n\tfont-weight: bold;\n}\n\ntbody tr { background: #FCFDFE; }\n\ntbody tr.odd { background: #F7F9FC; }\n\ntable a:link {\n\tcolor: #718ABE;\n\ttext-decoration: none;\n}\n\ntable a:visited {\n\tcolor: #718ABE;\n\ttext-decoration: none;\n}\n\ntable a:hover {\n\tcolor: #718ABE;\n\ttext-decoration: underline !important;\n}\n\ntfoot th, tfoot td {\n\tfont-size: 85%;\n}\nEOF\n\ncat ${FILE_CSS}\n```\n\n## 2.3. \u9332\u97f3\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f5c\u6210\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nFILE_PHP_SCRIPT='delete-record.php'\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\ncat << EOF > ${FILE_PHP_SCRIPT}\n<?php\n// author: Toshiaki Enami\nrequire('${FILE_LIB_TWILIO}');\n\\$account_sid = '${TWILIO_ACCOUNT_SID}';\n\\$auth_token = '${TWILIO_AUTH_TOKEN}';\n\\$client = new Services_Twilio(\\$account_sid, \\$auth_token);\n\nheader('Content-Type: application/json');\n// Need to validate paratmer\n\\$client->account->recordings->delete(\\$_POST['RecordingSid']);\necho \"Done\";\nEOF\n\ncat ${FILE_PHP_SCRIPT}\n```\n\n# 3. Web\u30b5\u30fc\u30d0\u306e\u516c\u958b\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u914d\u7f6e\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nsudo cp -R ${DIR_TWILIO_APP} ${DIR_PHP_SCRIPT}/ \\\n  && cat ${DIR_PHP_SCRIPT}/${APP_NAME}/${FILE_PHP_SCRIPT} \\\n  && cat ${DIR_PHP_SCRIPT}/${APP_NAME}/${FILE_CSS}  \n```\n\n\n# 4. \u30b9\u30af\u30ea\u30d7\u30c8\u306e\u52d5\u4f5c\u78ba\u8a8d\n\n\u30d6\u30e9\u30a6\u30b6\u3067 http://<\u30db\u30b9\u30c8>/sysadm/twilio-admin-app/list-records.php \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u9332\u97f3\u30c7\u30fc\u30bf\u306e\u4e00\u89a7\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308c\u3070OK\u3067\u3059\u3002\n\n- Play\u30ea\u30f3\u30af\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001\u9332\u97f3\u30c7\u30fc\u30bf\u304c\u518d\u751f\u3055\u308c\u307e\u3059\u3002\n- Delete\u30ea\u30f3\u30af\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001\u9332\u97f3\u30c7\u30fc\u30bf\u304c\u524a\u9664\u3055\u308c\u307e\u3059\u3002\n\n\n# 5. Twilio\u306e\u30ed\u30b0\u78ba\u8a8d\n\n- \u30ed\u30b0\u30a4\u30f3: http://twilio.kddi-web.com\n- \u753b\u9762: https://jp.twilio.com/user/account/log/calls\n   - \u524a\u9664\u3057\u305f\u9332\u97f3\u30c7\u30fc\u30bf\u304c\u5b58\u5728\u3057\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002(\u53d7\u4fe1\u8a18\u9332\u81ea\u4f53\u306f\u6b8b\u3063\u3066\u3044\u307e\u3059\u3002)\n\n\n\n# \u5b8c\u4e86\n\n\n\n", "tags": ["twilio", "PHP", "nginx", "php-fpm"]}