{"context": " More than 1 year has passed since last update.\u8907\u6570\u5217index\u306e\u9806\u5e8f\u3092\u6c7a\u3081\u308b\u6642\u306b\u3069\u3046\u3044\u3046\u9806\u756a\u3067\u4e26\u3079\u307e\u3059\u304b\u3063\u3066\u3044\u3046\u3068\n\u9078\u629e\u6027\u306e\u9ad8\u3044\u5217\u304b\u3089\u4e26\u3079\u308b\u306e\u304c\u539f\u5247\n\u305d\u308c\u3058\u3083\u3001\u6700\u8fd1\u306eDB\u3067\u30bb\u30aa\u30ea\u30fc\u901a\u308a\u306eindex\u3068\u305d\u3046\u3058\u3083\u306a\u3044\u9806\u5e8f\u306eindex\u3067\u3069\u308c\u304f\u3089\u3044\u5dee\u304c\u51fa\u308b\u3082\u3093\u306a\u306e\u3001\u3068\u3044\u3046\u306e\u3092\u5358\u7d14\u306a\u30b1\u30fc\u30b9\u3067\u8a66\u3057\u3066\u307f\u308b\nDB:MariaDB 10.0.11\nOS:Ubuntu 14.04\n\u30de\u30b7\u30f3:thinkpad t440p(ssd)\n\n\u30c6\u30fc\u30d6\u30eb\u3068index\n\u30c6\u30fc\u30d6\u30eb\u3068\u30c6\u30b9\u30c8\u306f\u524d\u56de\u3082\u4f7f\u7528\u3057\u305f\u306e\u3092\u6d41\u7528\u3059\u308b\nhttp://qiita.com/k_o_gj/items/a663692c3389ec7cc29d\nCREATE TABLE event_test(\n id          BIGINT AUTO_INCREMENT,\n event_id    INT    NOT NULL    DEFAULT 0,\n user_id     INT    NOT NULL    DEFAULT 0,\n status      INT    NOT NULL    DEFAULT 0,\n create_time DATETIME   NOT NULL,\n update_time DATETIME   NOT NULL,\n delete_time DATETIME   NOT NULL,\n PRIMARY KEY (id),\n KEY (user_id,event_id)\n)ENGINE=InnoDB  DEFAULT CHARSET=utf8;\n\n\u4f8b\u3048\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30af\u30a8\u30ea\u3092\u51fa\u3059\u3068\u3059\u308b\u3068\u3001user_id\u306b\u30de\u30c3\u30c1\u3059\u308b\u884c\u306e\u307b\u3046\u304c\u5c11\u306a\u3044\u306e\u3067user_id\u304cindex\u9806\u5e8f\u306e\u5148\u306b\u304f\u308b\u3079\u304d\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308b\nselect * from event_test where event_id = 4 AND user_id = 38651;\n\nMariaDB [my_test]> select sum(event_id = 4), sum(user_id = 38651) from event_test\\G\n*************************** 1. row ***************************\n   sum(event_id = 4): 2309567\nsum(user_id = 38651): 12\n1 row in set (8.30 sec)\n\ntable\u5168\u4f53\u3067\u307f\u3066\u3082user_id\u306e\u307b\u3046\u304c\u9078\u629e\u6027\u304c\u9ad8\u3044\u306e\u3067index\u9806\u5e8f\u306f(user_id,event_id)\u306e\u307b\u3046\u304c(event_id,user_id)\u3088\u308agood\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308b\n\nMariaDB [my_test]> select count(distinct event_id)/count(*) AS eid_selectivity, count(distinct user_id)/count(*) AS uid_selectivity, count(*) from event_test\\G\n*************************** 1. row ***************************\neid_selectivity: 0.0000\nuid_selectivity: 0.0866\n       count(*): 34623542\n1 row in set (11.68 sec)\n\n\n\u30c6\u30b9\u30c8\n\u30c6\u30b9\u30c8\u306fsysbench\u306eselect.lua\u306eevent\u95a2\u6570\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3061\u3087\u3063\u3068\u5909\u66f4\u3057\u3066\u5b9f\u884c\n4\u30b9\u30ec\u30c3\u30c9\u30675\u5206\u9593\u8efd\u3044\u691c\u7d22\u3092\u3057\u7d9a\u3051\u308b\nfunction event(thread_id)\n   local eid\n   eid = sb_rand(0, 1000000)%15\n   rs = db_query(\"SELECT * FROM event_test WHERE event_id=\" .. eid .. \" AND user_id=\" .. sb_rand(0,3000000))\nend\n\n\n./bin/sysbench --test=/tests/db/my_select_test.lua --db-driver=mysql --mysql-user=user --mysql-password=pass --mysql-host=127.0.0.1 --mysql-db=my_test --mysql-table-engine=innodb --num-threads=4 --max-requests=0 --max-time=300 run\n\n\n\u7d50\u679c1\nRunning the test with following options:\nNumber of threads: 4\nRandom number generator seed is 0 and will be ignored\n\n\nThreads started!\n\nOLTP test statistics:\n    queries performed:\n        read:                            10064763\n        write:                           0\n        other:                           0\n        total:                           10064763\n    transactions:                        0      (0.00 per sec.)\n    deadlocks:                           0      (0.00 per sec.)\n    read/write requests:                 10064763 (33549.20 per sec.)\n    other operations:                    0      (0.00 per sec.)\n\nGeneral statistics:\n    total time:                          300.0001s\n    total number of events:              10064763\n    total time taken by event execution: 1188.5505s\n    response time:\n         min:                                  0.07ms\n         avg:                                  0.12ms\n         max:                                 16.24ms\n         approx.  95 percentile:               0.14ms\n\nThreads fairness:\n    events (avg/stddev):           2516190.7500/6959.39\n    execution time (avg/stddev):   297.1376/0.01\n\n\n\u7d50\u679c2(index\u3092\u5165\u308c\u66ff\u3048\u3066\u8a66\u3059)\nKEY (user_id, event_id)\u3092KEY (event_id,user_id)\u306b\u5909\u66f4\u3057\u3066\u5b9f\u884c\nRunning the test with following options:\nNumber of threads: 4\nRandom number generator seed is 0 and will be ignored\n\n\nThreads started!\n\nOLTP test statistics:\n    queries performed:\n        read:                            9831949\n        write:                           0\n        other:                           0\n        total:                           9831949\n    transactions:                        0      (0.00 per sec.)\n    deadlocks:                           0      (0.00 per sec.)\n    read/write requests:                 9831949 (32772.17 per sec.)\n    other operations:                    0      (0.00 per sec.)\n\nGeneral statistics:\n    total time:                          300.0091s\n    total number of events:              9831949\n    total time taken by event execution: 1188.7031s\n    response time:\n         min:                                  0.07ms\n         avg:                                  0.12ms\n         max:                                 54.46ms\n         approx.  95 percentile:               0.14ms\n\nThreads fairness:\n    events (avg/stddev):           2457987.2500/5045.16\n    execution time (avg/stddev):   297.1758/0.01\n\n\u76ee\u3092\u898b\u5f35\u308b\u307b\u3069\u306e\u5dee\u7570\u306f\u306a\u3044\n\u5358\u7d14\u306a\u30b1\u30fc\u30b9\u306b\u304a\u3044\u3066\u306f\u9806\u5e8f\u304c\u5b9f\u884c\u7d50\u679c\u306b\u5f71\u97ff\u3057\u3066\u304f\u308b\u3053\u3068\u306f\u306a\u3055\u305d\u3046\n\u8907\u6570\u5217index\u306e\u9806\u5e8f\u3092\u6c7a\u3081\u308b\u6642\u306b\u3069\u3046\u3044\u3046\u9806\u756a\u3067\u4e26\u3079\u307e\u3059\u304b\u3063\u3066\u3044\u3046\u3068\n\u9078\u629e\u6027\u306e\u9ad8\u3044\u5217\u304b\u3089\u4e26\u3079\u308b\u306e\u304c\u539f\u5247\n\n\u305d\u308c\u3058\u3083\u3001\u6700\u8fd1\u306eDB\u3067\u30bb\u30aa\u30ea\u30fc\u901a\u308a\u306eindex\u3068\u305d\u3046\u3058\u3083\u306a\u3044\u9806\u5e8f\u306eindex\u3067\u3069\u308c\u304f\u3089\u3044\u5dee\u304c\u51fa\u308b\u3082\u3093\u306a\u306e\u3001\u3068\u3044\u3046\u306e\u3092\u5358\u7d14\u306a\u30b1\u30fc\u30b9\u3067\u8a66\u3057\u3066\u307f\u308b\n\nDB:MariaDB 10.0.11\nOS:Ubuntu 14.04\n\u30de\u30b7\u30f3:thinkpad t440p(ssd)\n\n#\u30c6\u30fc\u30d6\u30eb\u3068index\n\n\u30c6\u30fc\u30d6\u30eb\u3068\u30c6\u30b9\u30c8\u306f\u524d\u56de\u3082\u4f7f\u7528\u3057\u305f\u306e\u3092\u6d41\u7528\u3059\u308b\nhttp://qiita.com/k_o_gj/items/a663692c3389ec7cc29d\n\n```\nCREATE TABLE event_test(\n id    \t     BIGINT\tAUTO_INCREMENT,\n event_id    INT\tNOT NULL\tDEFAULT 0,\n user_id     INT\tNOT NULL\tDEFAULT 0,\n status\t     INT\tNOT NULL\tDEFAULT 0,\n create_time DATETIME\tNOT NULL,\n update_time DATETIME\tNOT NULL,\n delete_time DATETIME\tNOT NULL,\n PRIMARY KEY (id),\n KEY (user_id,event_id)\n)ENGINE=InnoDB\tDEFAULT CHARSET=utf8;\n```\n\u4f8b\u3048\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30af\u30a8\u30ea\u3092\u51fa\u3059\u3068\u3059\u308b\u3068\u3001user_id\u306b\u30de\u30c3\u30c1\u3059\u308b\u884c\u306e\u307b\u3046\u304c\u5c11\u306a\u3044\u306e\u3067user_id\u304cindex\u9806\u5e8f\u306e\u5148\u306b\u304f\u308b\u3079\u304d\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308b\n\n```\nselect * from event_test where event_id = 4 AND user_id = 38651;\n\nMariaDB [my_test]> select sum(event_id = 4), sum(user_id = 38651) from event_test\\G\n*************************** 1. row ***************************\n   sum(event_id = 4): 2309567\nsum(user_id = 38651): 12\n1 row in set (8.30 sec)\n```\n\ntable\u5168\u4f53\u3067\u307f\u3066\u3082user_id\u306e\u307b\u3046\u304c\u9078\u629e\u6027\u304c\u9ad8\u3044\u306e\u3067index\u9806\u5e8f\u306f(user_id,event_id)\u306e\u307b\u3046\u304c(event_id,user_id)\u3088\u308agood\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308b\n```\nMariaDB [my_test]> select count(distinct event_id)/count(*) AS eid_selectivity, count(distinct user_id)/count(*) AS uid_selectivity, count(*) from event_test\\G\n*************************** 1. row ***************************\neid_selectivity: 0.0000\nuid_selectivity: 0.0866\n       count(*): 34623542\n1 row in set (11.68 sec)\n```\n\n#\u30c6\u30b9\u30c8\n\n\u30c6\u30b9\u30c8\u306fsysbench\u306eselect.lua\u306eevent\u95a2\u6570\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3061\u3087\u3063\u3068\u5909\u66f4\u3057\u3066\u5b9f\u884c\n4\u30b9\u30ec\u30c3\u30c9\u30675\u5206\u9593\u8efd\u3044\u691c\u7d22\u3092\u3057\u7d9a\u3051\u308b\n\n```\nfunction event(thread_id)\n   local eid\n   eid = sb_rand(0, 1000000)%15\n   rs = db_query(\"SELECT * FROM event_test WHERE event_id=\" .. eid .. \" AND user_id=\" .. sb_rand(0,3000000))\nend\n\n\n./bin/sysbench --test=/tests/db/my_select_test.lua --db-driver=mysql --mysql-user=user --mysql-password=pass --mysql-host=127.0.0.1 --mysql-db=my_test --mysql-table-engine=innodb --num-threads=4 --max-requests=0 --max-time=300 run\n```\n\n#\u7d50\u679c1\n```\nRunning the test with following options:\nNumber of threads: 4\nRandom number generator seed is 0 and will be ignored\n\n\nThreads started!\n\nOLTP test statistics:\n    queries performed:\n        read:                            10064763\n        write:                           0\n        other:                           0\n        total:                           10064763\n    transactions:                        0      (0.00 per sec.)\n    deadlocks:                           0      (0.00 per sec.)\n    read/write requests:                 10064763 (33549.20 per sec.)\n    other operations:                    0      (0.00 per sec.)\n\nGeneral statistics:\n    total time:                          300.0001s\n    total number of events:              10064763\n    total time taken by event execution: 1188.5505s\n    response time:\n         min:                                  0.07ms\n         avg:                                  0.12ms\n         max:                                 16.24ms\n         approx.  95 percentile:               0.14ms\n\nThreads fairness:\n    events (avg/stddev):           2516190.7500/6959.39\n    execution time (avg/stddev):   297.1376/0.01\n```\n\n\n#\u7d50\u679c2(index\u3092\u5165\u308c\u66ff\u3048\u3066\u8a66\u3059)\nKEY (user_id, event_id)\u3092KEY (event_id,user_id)\u306b\u5909\u66f4\u3057\u3066\u5b9f\u884c\n\n```\nRunning the test with following options:\nNumber of threads: 4\nRandom number generator seed is 0 and will be ignored\n\n\nThreads started!\n\nOLTP test statistics:\n    queries performed:\n        read:                            9831949\n        write:                           0\n        other:                           0\n        total:                           9831949\n    transactions:                        0      (0.00 per sec.)\n    deadlocks:                           0      (0.00 per sec.)\n    read/write requests:                 9831949 (32772.17 per sec.)\n    other operations:                    0      (0.00 per sec.)\n\nGeneral statistics:\n    total time:                          300.0091s\n    total number of events:              9831949\n    total time taken by event execution: 1188.7031s\n    response time:\n         min:                                  0.07ms\n         avg:                                  0.12ms\n         max:                                 54.46ms\n         approx.  95 percentile:               0.14ms\n\nThreads fairness:\n    events (avg/stddev):           2457987.2500/5045.16\n    execution time (avg/stddev):   297.1758/0.01\n```\n\n\u76ee\u3092\u898b\u5f35\u308b\u307b\u3069\u306e\u5dee\u7570\u306f\u306a\u3044\n\u5358\u7d14\u306a\u30b1\u30fc\u30b9\u306b\u304a\u3044\u3066\u306f\u9806\u5e8f\u304c\u5b9f\u884c\u7d50\u679c\u306b\u5f71\u97ff\u3057\u3066\u304f\u308b\u3053\u3068\u306f\u306a\u3055\u305d\u3046\n", "tags": ["mariadb", "MySQL", "sysbench", "Database"]}