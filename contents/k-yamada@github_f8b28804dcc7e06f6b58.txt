{"context": "\n\n\u53c2\u8003\n\ngitbucket\u2192hubot\u2192slack\u9023\u643a\n\n\n\u8a2d\u5b9a\u65b9\u6cd5\n\nhubot\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u88c5\n\n\u4f7f\u7528\u3057\u3066\u3044\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\n\ncharltoons/hipchatter\n\n\n\u30b9\u30af\u30ea\u30d7\u30c8\n\n# Description:\n#   gitbucket to Hubot\n#\n# Commands:\n#   None\n#\n\nHipchatter = require('hipchatter')\nhipchatter = new Hipchatter(your_auth_token)\n\nmodule.exports = (robot) ->\n  robot.router.post \"/hubot/gitbucket-to-hubot/:room/:room_notification_token\", (req, res) ->\n    { room } = req.params\n    { room_notification_token } = req.params\n    { body } = req\n\n    try\n      if body.payload\n        json = JSON.parse body.payload\n        for i in [json.commits.length-1..0]\n          message  = \"<a href='#{json.pusher.html_url}'>#{json.commits[i].author.name}</a> pushed to branch #{json.ref} of <a href='#{json.repository.html_url}'>#{json.repository.full_name}</a> <br>\"\n          message += \"- #{json.commits[i].message} (<a href='#{json.commits[i].html_url}'>#{json.commits[i].id.substring(0, 7)}</a>)\"\n\n          if message?\n            hipchatter.notify room,\n              message: message\n              color: \"yellow\"\n              message_format: 'html'\n              token: room_notification_token\n            , (err) ->\n              if err == null\n                res.end \"OK\"\n              else\n                console.log(\"error: #{err.message}\")\n                res.end \"Error\"\n          else\n            robot.messageRoom room, \"gitbucket integration error.\"\n            res.end \"Error\"\n    catch error\n      robot.send\n      res.end \"Error\"\n\n\n\ngitbucket\u306e\u8a2d\u5b9a\n\n\u30ea\u30dd\u30b8\u30c8\u30ea > Settings > Service Hooks\nWebHook URLS\u306bhttp://your.hubot.site:9999/hubot/gitbucket-to-hubot/room_name/room_notification_token\u3092\u5165\u529b\u3057\u3066\u300cTest Hook\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u4e0b\n\n\nroom_name\u3068room_notification_token\u306b\u306f\u9069\u5207\u306a\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\nroom_name\u304c\u65e5\u672c\u8a9e\u306e\u5834\u5408\u306f\u6b63\u5e38\u306b\u9001\u4fe1\u3055\u308c\u306a\u3044\u306e\u3067\u3001\u4ee3\u308f\u308a\u306b\u305d\u306eRoom\u306eAPI ID\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\n\n\nhipchat\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u305f\u3089\u6210\u529f\n\u300cAdd\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u4e0b\u3059\u308b\n\n\n\u6ce8\u610f\u4e8b\u9805\n\nRoom\u540d\u306b\u65e5\u672c\u8a9e\u3084\u7a7a\u767d\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u3068\u52d5\u304b\u306a\u3044\u3002\n\n# \u53c2\u8003\n- [gitbucket\u2192hubot\u2192slack\u9023\u643a](http://qiita.com/yo-iida/items/be265427faf44f6d6f96)\n\n# \u8a2d\u5b9a\u65b9\u6cd5\n\n## hubot\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u88c5\n\n#### \u4f7f\u7528\u3057\u3066\u3044\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\n\n- [charltoons/hipchatter](https://github.com/charltoons/hipchatter)\n\n#### \u30b9\u30af\u30ea\u30d7\u30c8\n\n```coffeescript\n\n# Description:\n#   gitbucket to Hubot\n#\n# Commands:\n#   None\n#\n\nHipchatter = require('hipchatter')\nhipchatter = new Hipchatter(your_auth_token)\n\nmodule.exports = (robot) ->\n  robot.router.post \"/hubot/gitbucket-to-hubot/:room/:room_notification_token\", (req, res) ->\n    { room } = req.params\n    { room_notification_token } = req.params\n    { body } = req\n\n    try\n      if body.payload\n        json = JSON.parse body.payload\n        for i in [json.commits.length-1..0]\n          message  = \"<a href='#{json.pusher.html_url}'>#{json.commits[i].author.name}</a> pushed to branch #{json.ref} of <a href='#{json.repository.html_url}'>#{json.repository.full_name}</a> <br>\"\n          message += \"- #{json.commits[i].message} (<a href='#{json.commits[i].html_url}'>#{json.commits[i].id.substring(0, 7)}</a>)\"\n\n          if message?\n            hipchatter.notify room,\n              message: message\n              color: \"yellow\"\n              message_format: 'html'\n              token: room_notification_token\n            , (err) ->\n              if err == null\n                res.end \"OK\"\n              else\n                console.log(\"error: #{err.message}\")\n                res.end \"Error\"\n          else\n            robot.messageRoom room, \"gitbucket integration error.\"\n            res.end \"Error\"\n    catch error\n      robot.send\n      res.end \"Error\"\n\n```\n\n## gitbucket\u306e\u8a2d\u5b9a\n\n- \u30ea\u30dd\u30b8\u30c8\u30ea > Settings > Service Hooks\n- WebHook URLS\u306b`http://your.hubot.site:9999/hubot/gitbucket-to-hubot/room_name/room_notification_token`\u3092\u5165\u529b\u3057\u3066\u300cTest Hook\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u4e0b\n - room_name\u3068room_notification_token\u306b\u306f\u9069\u5207\u306a\u5024\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\n - room_name\u304c\u65e5\u672c\u8a9e\u306e\u5834\u5408\u306f\u6b63\u5e38\u306b\u9001\u4fe1\u3055\u308c\u306a\u3044\u306e\u3067\u3001\u4ee3\u308f\u308a\u306b\u305d\u306eRoom\u306e`API ID`\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\n- hipchat\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u305f\u3089\u6210\u529f\n- \u300cAdd\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u4e0b\u3059\u308b\n\n## \u6ce8\u610f\u4e8b\u9805\n\n* Room\u540d\u306b\u65e5\u672c\u8a9e\u3084\u7a7a\u767d\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u3068\u52d5\u304b\u306a\u3044\u3002\n", "tags": ["GitBucket", "Hubot", "hipchat"]}