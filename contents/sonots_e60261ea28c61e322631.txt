{"context": " More than 1 year has passed since last update.cloud init \u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u30db\u30b9\u30c8\u3092\u518d\u8d77\u52d5\u305b\u305a\u306b\u4f55\u5ea6\u3082\u5b9f\u884c\u3057\u3066\u958b\u767a\u3059\u308b\u306b\u306f\u6b21\u306e\u3088\u3046\u306b\u3059\u308c\u3070\u3088\u3044\u3088\u3046\u3060\n\n\u524d\u63d0\u77e5\u8b58\n/etc/cloud/cloud.cfg \u306b\u306f\ncloud_init_modules:\n\n...\n\n# The modules that run in the 'config' stage\ncloud_config_modules:\n\n... \n\n# The modules that run in the 'final' stage\ncloud_final_modules:\n\n\u306e\uff13\u3064\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u304c\u3042\u308b\u3002\u5b9f\u884c\u30bf\u30a4\u30df\u30f3\u30b0\u306b\u3064\u3044\u3066\u306f Amazon Linux\u306ecloud-init\u306e\u52d5\u304d\u306b\u3064\u3044\u3066\u8abf\u3079\u3066\u307f\u305f \u306e\u8a18\u4e8b\u3092\u53c2\u7167\u3059\u308b\u3068\u826f\u3044\u3002\n\n\u958b\u767a\u5b9f\u884c\u306e\u3084\u308a\u65b9\n\u305d\u308c\u305e\u308c\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9f\u884c\u3059\u308c\u3070\u826f\u3044\n\uff11. cloud_init_modules \u30bb\u30af\u30b7\u30e7\u30f3\u306e\u5b9f\u884c\nrm -rf /var/lib/cloud/* && \\\n  cloud-init --debug init --local && \\\n  cloud-init --debug init\n\n\uff12. cloud_config_modules \u30bb\u30af\u30b7\u30e7\u30f3\u306e\u5b9f\u884c\nrm -rf /var/lib/cloud/* && \\\n  cloud-init init --local && \\\n  cloud-init init && \\\n  cloud-init --debug modules --mode config\n\n\uff13. cloud_final_modules \u30bb\u30af\u30b7\u30e7\u30f3\u306e\u5b9f\u884c\nrm -rf /var/lib/cloud/* && \\\n  cloud-init init --local && \\\n  cloud-init init && \\\n  cloud-init modules --mode config && \\\n  cloud-init --debug modules --mode final\n\n\n\u88dc\u8db3\n/var/lib/cloud \u306e\u4e0b\u306f\u3053\u3093\u306a\u304b\u3093\u3058\u3067\u3001status.json \u3084 sem \u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u306b init \u304c\u5b9f\u884c\u305a\u307f\u3067\u3042\u308b\u3053\u3068\u306a\u3069\u304c\u8a18\u9332\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u6d88\u3055\u306a\u3044\u3068\u518d\u5b9f\u884c\u3067\u304d\u306a\u304f\u306a\u3063\u3066\u3044\u308b\u3002(status.json \u3092\u6d88\u3059\u3060\u3051\u3067\u306f\u30c0\u30e1\u3060\u3063\u305f)\n# tree /var/lib/cloud/\n/var/lib/cloud/\n\u251c\u2500\u2500 data\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 instance-id\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 previous-datasource\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 previous-instance-id\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 status.json\n\u251c\u2500\u2500 handlers\n\u251c\u2500\u2500 instance -> /var/lib/cloud/instances/i-5d1d98af\n\u251c\u2500\u2500 instances\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 i-5d1d98af\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 cloud-config.txt\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 datasource\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 handlers\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 obj.pkl\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 scripts\n\u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 runcmd\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 sem\n\u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 consume_data\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 user-data.txt\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 user-data.txt.i\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 vendor-data.txt\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 vendor-data.txt.i\n\u251c\u2500\u2500 scripts\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 per-boot\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 per-instance\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 per-once\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 vendor\n\u251c\u2500\u2500 seed\n\u2514\u2500\u2500 sem\n\n\u6d88\u3057\u305f\u4e0a\u3067\u3001\n\n\ncloud-init init --local (/etc/init.d/cloud-init-local start)\n\ncloud-init init (/etc/init.d/cloud-init start)\n\ncloud-init modules --mode config (/etc/init.d/cloud-config start)\n\ncloud-init modules --mode final (/etc/init.d/cloud-final start)\n\n\u306e\u9806\u756a\u3067\u5b9f\u884c\u3055\u308c\u308b\u306e\u304c\u524d\u63d0\u3068\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3001final \u3092\u5b9f\u884c\u3059\u308b\u306b\u306f\u3001\u524d\uff13\u3064\u3092\u5b9f\u884c\u3059\u308b\u3002\n\u4f8b\u3048\u3070\u3001runcmd: \u3067\u6307\u5b9a\u3057\u305f\u30b3\u30de\u30f3\u30c9\u306f config \u30b9\u30c6\u30fc\u30b8\u3067 scripts/runcmd \u304c\u751f\u6210\u3055\u308c\u3001final \u30b9\u30c6\u30fc\u30b8\u3067\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u3060\u3002\u306a\u306e\u3067 final \u3060\u3051\u5b9f\u884c\u3057\u3066\u3082\u30d5\u30a1\u30a4\u30eb\u304c\u306a\u304f\u3066\u4f55\u3082\u51e6\u7406\u3055\u308c\u306a\u3044\u3002\n\n\u304a\u308f\u308a\u306b\n\u3082\u3063\u3068\u3046\u307e\u3044\u65b9\u6cd5\u304c\u3042\u308c\u3070\u60c5\u5831 welcome\ncloud init \u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u30db\u30b9\u30c8\u3092\u518d\u8d77\u52d5\u305b\u305a\u306b\u4f55\u5ea6\u3082\u5b9f\u884c\u3057\u3066\u958b\u767a\u3059\u308b\u306b\u306f\u6b21\u306e\u3088\u3046\u306b\u3059\u308c\u3070\u3088\u3044\u3088\u3046\u3060\n\n## \u524d\u63d0\u77e5\u8b58\n\n/etc/cloud/cloud.cfg \u306b\u306f\n\n```\ncloud_init_modules:\n\n...\n\n# The modules that run in the 'config' stage\ncloud_config_modules:\n\n... \n\n# The modules that run in the 'final' stage\ncloud_final_modules:\n```\n\n\u306e\uff13\u3064\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u304c\u3042\u308b\u3002\u5b9f\u884c\u30bf\u30a4\u30df\u30f3\u30b0\u306b\u3064\u3044\u3066\u306f [Amazon Linux\u306ecloud-init\u306e\u52d5\u304d\u306b\u3064\u3044\u3066\u8abf\u3079\u3066\u307f\u305f](http://dev.classmethod.jp/cloud/aws/probe-cloud-init) \u306e\u8a18\u4e8b\u3092\u53c2\u7167\u3059\u308b\u3068\u826f\u3044\u3002\n\n## \u958b\u767a\u5b9f\u884c\u306e\u3084\u308a\u65b9\n\n\u305d\u308c\u305e\u308c\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9f\u884c\u3059\u308c\u3070\u826f\u3044\n\n\uff11. `cloud_init_modules` \u30bb\u30af\u30b7\u30e7\u30f3\u306e\u5b9f\u884c\n\n```\nrm -rf /var/lib/cloud/* && \\\n  cloud-init --debug init --local && \\\n  cloud-init --debug init\n```\n\n\uff12. `cloud_config_modules` \u30bb\u30af\u30b7\u30e7\u30f3\u306e\u5b9f\u884c\n\n```\nrm -rf /var/lib/cloud/* && \\\n  cloud-init init --local && \\\n  cloud-init init && \\\n  cloud-init --debug modules --mode config\n```\n\n\uff13. `cloud_final_modules` \u30bb\u30af\u30b7\u30e7\u30f3\u306e\u5b9f\u884c\n\n```\nrm -rf /var/lib/cloud/* && \\\n  cloud-init init --local && \\\n  cloud-init init && \\\n  cloud-init modules --mode config && \\\n  cloud-init --debug modules --mode final\n```\n\n## \u88dc\u8db3\n\n`/var/lib/cloud` \u306e\u4e0b\u306f\u3053\u3093\u306a\u304b\u3093\u3058\u3067\u3001status.json \u3084 sem \u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u306b init \u304c\u5b9f\u884c\u305a\u307f\u3067\u3042\u308b\u3053\u3068\u306a\u3069\u304c\u8a18\u9332\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u6d88\u3055\u306a\u3044\u3068\u518d\u5b9f\u884c\u3067\u304d\u306a\u304f\u306a\u3063\u3066\u3044\u308b\u3002(status.json \u3092\u6d88\u3059\u3060\u3051\u3067\u306f\u30c0\u30e1\u3060\u3063\u305f)\n\n\n```\n# tree /var/lib/cloud/\n/var/lib/cloud/\n\u251c\u2500\u2500 data\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 instance-id\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 previous-datasource\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 previous-instance-id\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 status.json\n\u251c\u2500\u2500 handlers\n\u251c\u2500\u2500 instance -> /var/lib/cloud/instances/i-5d1d98af\n\u251c\u2500\u2500 instances\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 i-5d1d98af\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 cloud-config.txt\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 datasource\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 handlers\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 obj.pkl\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 scripts\n\u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 runcmd\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 sem\n\u2502\u00a0\u00a0     \u2502\u00a0\u00a0 \u2514\u2500\u2500 consume_data\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 user-data.txt\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 user-data.txt.i\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 vendor-data.txt\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 vendor-data.txt.i\n\u251c\u2500\u2500 scripts\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 per-boot\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 per-instance\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 per-once\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 vendor\n\u251c\u2500\u2500 seed\n\u2514\u2500\u2500 sem\n```\n\n\u6d88\u3057\u305f\u4e0a\u3067\u3001\n\n1. `cloud-init init --local` (`/etc/init.d/cloud-init-local start`)\n1. `cloud-init init` (`/etc/init.d/cloud-init start`)\n1. `cloud-init modules --mode config` (`/etc/init.d/cloud-config start`)\n1. `cloud-init modules --mode final` (`/etc/init.d/cloud-final start`)\n\n\u306e\u9806\u756a\u3067\u5b9f\u884c\u3055\u308c\u308b\u306e\u304c\u524d\u63d0\u3068\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3001final \u3092\u5b9f\u884c\u3059\u308b\u306b\u306f\u3001\u524d\uff13\u3064\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n\u4f8b\u3048\u3070\u3001`runcmd:` \u3067\u6307\u5b9a\u3057\u305f\u30b3\u30de\u30f3\u30c9\u306f config \u30b9\u30c6\u30fc\u30b8\u3067 `scripts/runcmd` \u304c\u751f\u6210\u3055\u308c\u3001final \u30b9\u30c6\u30fc\u30b8\u3067\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u3060\u3002\u306a\u306e\u3067 final \u3060\u3051\u5b9f\u884c\u3057\u3066\u3082\u30d5\u30a1\u30a4\u30eb\u304c\u306a\u304f\u3066\u4f55\u3082\u51e6\u7406\u3055\u308c\u306a\u3044\u3002\n\n# \u304a\u308f\u308a\u306b\n\n\u3082\u3063\u3068\u3046\u307e\u3044\u65b9\u6cd5\u304c\u3042\u308c\u3070\u60c5\u5831 welcome\n", "tags": ["AWS", "cloud-init"]}