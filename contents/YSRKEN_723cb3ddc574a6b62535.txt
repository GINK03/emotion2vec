{"context": " More than 1 year has passed since last update.\n\n\u6982\u8981\n\u3000\u767a\u7aef\u3001AtCoder\u4ee3\u8868\u53d6\u7de0\u5f79\u793e\u9577\u306echokudai\u6c0f\u3068\u3001\u65b0\u5352\u6587\u7cfb\u30d7\u30ed\u30b0\u30e9\u30de\u517c\u30de\u30f3\u30ac\u5bb6\uff5c\u8150\u5973\u5b50\u306e\u3061\u3087\u307e\u3069\u6c0f\u3068\u306e\u6b21\u306e\u3088\u3046\u306a\u3084\u308a\u53d6\u308a\u304b\u3089\u3067\u3057\u305f\u3002\n\u3000\u3000https://twitter.com/chokudai/status/690039649268580352\n\u3000\u7aef\u7684\u306b\u8a00\u3048\u3070\u3001\u300cA\u554f\u984c\u304c\u89e3\u3051\u308c\u3070\u30d7\u30ed\u30b0\u30e9\u30de\u306a\u3093\u3067\u3059\u3088\u306d\uff1f\u3058\u3083\u3042\u3053\u308c\u89e3\u3044\u3066\u304f\u3060\u3055\u3044\uff1e\uff1c\u300d\u3068\u3044\u3046chokudai\u6c0f\u304b\u3089\u306e\u6311\u6226\u72b6\u3067\u3059\u306d\u3002\u3042\u307e\u308a\u306e\u96e3\u6613\u5ea6\u306b\u3061\u3087\u307e\u3069\u6c0f\u306f\u65e9\u3005\u306b\u30ae\u30d6\u30a2\u30c3\u30d7\u3057\u3001\u5f8c\u304b\u3089\u53c2\u52a0\u3057\u305f\u79c1\u3082\u305d\u306e\u96e3\u6613\u5ea6\u306b\u76ee\u3092\u5265\u304d\u307e\u3057\u305f\u3002\n\u3000\u4ee5\u4e0b\u306f\u3053\u306e\u554f\u984c\u306e\u89e3\u8aac\u8a18\u4e8b\u3068\u306a\u308a\u307e\u3059\u3002\u30cd\u30bf\u30d0\u30ec\u3092\u907f\u3051\u305f\u3044\u4eba\u306f\u4f55\u3082\u898b\u305a\u306b\u307e\u305a\u306f\u89e3\u3044\u3066\u307f\u307e\u3057\u3087\u3046\uff1e\uff1c\n\u3000\u3000A - Accumulation\n\n\u307e\u305a\u306f\u554f\u984c\u306e\u610f\u56f3\u3092\u3064\u304b\u307f\u307e\u3057\u3087\u3046\n\u3000\u554f\u984c\u6587\u3092\u8aad\u3081\u3070\u5206\u304b\u308a\u307e\u3059\u304c\u3001\u968f\u5206\u3068\u6570\u5b66\u3063\u307d\u3044\u554f\u984c\u3067\u3059\u3002\u305d\u308c\u3082\u3001\u6574\u6570\u8ad6\u306e\u9999\u308a\u304c\u30d3\u30f3\u30d3\u30f3\u306b\u3057\u307e\u3059\u3002\n\u3000\u5e78\u3044\u64ec\u4f3c\u30b3\u30fc\u30c9\u304c\u4e0e\u3048\u3089\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u300c\u3069\u3093\u306a\u51e6\u7406\u3092\u3057\u3066\u3044\u308b\u304b\u300d\u306f\u7c21\u5358\u306b\u3064\u304b\u3080\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u306d\u3002Ruby\u3067\u66f8\u304f\u3068\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\ncode1.rb\n=begin\n\u5165\u529b\uff1a\n  N\n  X,T,A,B,C\n\u5165\u529b\u306e\u6761\u4ef6\uff1a\n  1 \u2266 N \u2266 10^6\n  1 \u2266 T,C \u2266 10^9\n  0 \u2266 X,A,B \uff1c C\n=end\n\nN = gets.to_i\nx,T,A,B,C = gets.split.map(&:to_i)\ns = 0\nN.times{\n  s += x\n  T.times{\n    x = (A * x + B) % C\n  }\n}\nputs s\n\n\n\u3000\u2026\u2026\u3053\u3046\u3057\u3066\u898b\u308b\u3068\u5206\u304b\u308b\u3088\u3046\u306b\u3001\u7d20\u6734\u306a\u30b3\u30fc\u30c9\u3060\u3068\u300cx = (A * x + B) % C\u300d\u304cN\u00d7T\u56de\u5b9f\u884c\u3055\u308c\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\u5165\u529b\u306e\u6761\u4ef6\u304b\u3089\u3001\u305d\u308c\u304c\u6700\u592710^15(100\u4eac)\u56de\u3082\u7e70\u308a\u8fd4\u3055\u308c\u308b\u3053\u3068\u306b\u306a\u308b\u306e\u3067\u3001\u554f\u984c\u306e\u6761\u4ef6(2sec)\u3092\u8003\u616e\u3059\u308b\u3068\u5230\u5e95\u9593\u306b\u5408\u3044\u307e\u305b\u3093\u3002\u5b9f\u969b\u3001\u63d0\u51fa\u3057\u3066\u307f\u308b\u3068\u60e8\u61ba\u305f\u308b\u6210\u7e3e\u3067\u3057\u305f\u3002\n\u3000\u3000http://xmascontest2015noon.contest.atcoder.jp/submissions/616130\n\n\u6b21\u306b\u9ad8\u901f\u5316\u3092\u691c\u8a0e\u3057\u307e\u3059\n\u3000\u4e0a\u8a18\u30bd\u30fc\u30b9\u3092\u3088\u304f\u8aad\u3093\u3067\u307f\u308b\u3068\u3001\u300cs\u306bx\u3092\u8db3\u3059\u2192x\u306b\u5bfe\u3057\u3066\u51e6\u7406\u3059\u308b\u2192s\u306bx\u3092\u8db3\u3059\u2192\u2026\u2026\u300d\u3068\u3044\u3063\u305f\u51e6\u7406\u624b\u9806\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\u3053\u306e\u300cx\u306b\u5bfe\u3057\u3066\u51e6\u7406\u3059\u308b\u300d\u90e8\u5206\u306b\u5927\u304d\u304f\u8a08\u7b97\u6642\u9593\u3092\u53d6\u3089\u308c\u3066\u3044\u308b\u306e\u304c\u554f\u984c\u306a\u306e\u3067\u3059\u3002\u3046\u307e\u304f\u5de5\u592b\u3057\u3066\u8a08\u7b97\u91cf\u3092\u524a\u308c\u306a\u3044\u3067\u3057\u3087\u3046\u304b\uff1f\n\u3000\u305d\u3093\u306a\u6642\u306b\u767b\u5834\u3059\u308b\u306e\u304c\u6574\u6570\u8ad6\u3067\u3059\u3002\u305d\u3053\u305d\u3053\u9577\u304f\u306a\u308b\u306e\u3067\u5225\u306b\u5206\u3051\u307e\u3059\u3002\n\n\u6574\u6570\u8ad6\u306e\u57fa\u790e(\u3056\u3063\u304f\u308a)\n\u3000\u307e\u305a\u3001\u5270\u4f59\u8a08\u7b97\u306b\u3064\u3044\u3066\u6574\u7406\u3057\u307e\u3057\u3087\u3046\u3002\u6574\u6570A\u3092\u6574\u6570B\u3067\u5272\u3063\u305f\u4f59\u308a\u304c\u6574\u6570C\u3067\u3042\u308b\u3068\u304d\u3001\u9069\u5f53\u306a\u6574\u6570N\u3092\u7528\u3044\u3066A=B\u00d7N+CA=B\u00d7N+CA=B\u00d7N+C\u3068\u8868\u73fe\u3055\u308c\u307e\u3059\u3002\u5c0f\u3055\u306a\u6570\u3067\u4f8b\u3048\u308c\u3070\u3001A=25,B=7,C=4\u3067\u3042\u308b\u969b\u300125=7\u00d73+425=7\u00d73+425=7\u00d73+4\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u306d\u3002\n\u3000\u3053\u3053\u3067\u8a18\u53f7(modp)(modp)\\pmod{p}\u3092\u5c0e\u5165\u3057\u307e\u3059\u3002\u610f\u5473\u3068\u3057\u3066\u306f\u3001\u300c\u6cd5p\u306e\u4e16\u754c\u306b\u304a\u3044\u3066\u300d\u3068\u306a\u308a\u307e\u3059\u3002\u3053\u306e\u4e16\u754c\u306e\u5143\u3067\u306f\u3001\u300cp\u3067\u5272\u3063\u305f\u969b\u306e\u4f59\u308a\u304c\u540c\u3058\u6570\u306f\u7b49\u3057\u3044\u3068\u898b\u306a\u3059\u300d\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u5c0f\u3055\u306a\u6570\u3067\u4f8b\u3048\u3070\u300125=18=11=4(mod7)25=18=11=4(mod7)25=18=11=4\\pmod{7}\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u306d\u3002\n\u3000\u3053\u306e\u4e0d\u601d\u8b70\u306a\u4e16\u754c\u306e\u5143\u3067\u3082\u3001\u56db\u5247\u6f14\u7b97\u306f\u540c\u69d8\u306b\u6210\u308a\u7acb\u3061\u307e\u3059(\u305f\u3060\u3057\u9664\u6cd5\u306b\u3064\u3044\u3066\u306f\u591a\u5c11\u3084\u3084\u3053\u3057\u3044)\u3002\u3064\u307e\u308a\u30014\u00d76\u30828\u00d73\u308224\u3068\u7b49\u3057\u304f\u306a\u308a\u307e\u3059\u3002\u305f\u3060\u3057\u5148\u307b\u3069\u306e\u30eb\u30fc\u30eb\u304b\u3089\u30017\u00d73+3=24=3=66=7\u00d79+3(mod7)7\u00d73+3=24=3=66=7\u00d79+3(mod7)7\u00d73+3=24=3=66=7\u00d79+3\\pmod{7}\u3068\u306a\u308a\u307e\u3059\u304c\u3002\n\n\u8a08\u7b97\u91cf\u524a\u6e1b\u6cd5\u305d\u306e1\uff1a\u8a08\u7b97\u3092\u307e\u3068\u3081\u308b\n\u3000\u3053\u306e\u6574\u6570\u8ad6\u306e\u6027\u8cea\u3092\u7528\u3044\u308b\u3068\u3001\u300cx\u306b\u5bfe\u3057\u3066\u51e6\u7406\u3059\u308b\u300d\u90e8\u5206\u3092\u30b3\u30f3\u30d1\u30af\u30c8\u306b\u307e\u3068\u3081\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u3000\u6cd5C\u306e\u4e16\u754c\u306e\u5143\u3067\u3082\u56db\u5247\u6f14\u7b97\u304c\u6210\u308a\u7acb\u3064\u306e\u3067\u3001f(x)=A\u00d7x+Bf(x)=A\u00d7x+Bf(x)=A\u00d7x+B\u3068\u3057\u3066\u3001g(x,t)=f(f(f(...(x))))g(x,t)=f(f(f(...(x))))g(x,t)=f(f(f(...(x))))\u3068\u7f6e\u304f\u3068(\u305f\u3060\u3057f\u304ct\u500b\u5165\u308c\u5b50\u306b\u306a\u3063\u3066\u3044\u308b)\u3001\u9069\u5f53\u306a\u6574\u6570P,Q\u3092\u7528\u3044\u3066g(x,t)=P\u00d7x+Qg(x,t)=P\u00d7x+Qg(x,t)=P\u00d7x+Q\u3068\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3064\u307e\u308a\u3001\u4e8b\u524d\u306bP\u3068Q\u3092\u8a08\u7b97\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u3001\u300cx\u306b\u5bfe\u3057\u3066\u51e6\u7406\u3059\u308b\u300d\u90e8\u5206\u306e\u8a08\u7b97\u304c\u77ac\u6642\u306b\u7d42\u308f\u308b\u3053\u3068\u306b\u306a\u308b\u306e\u3067\u3059\u3002\n\u3000P\u3068Q\u306e\u8a08\u7b97\u65b9\u6cd5\u3067\u3059\u304c\u3001A\u00d7(P\u00d7x+Q)+B=A\u00d7P\u00d7x+A\u00d7Q+BA\u00d7(P\u00d7x+Q)+B=A\u00d7P\u00d7x+A\u00d7Q+BA\u00d7(P\u00d7x+Q)+B=A\u00d7P\u00d7x+A\u00d7Q+B\u306a\u306e\u3067\u3001P\u2190A\u00d7P,Q\u2190A\u00d7Q+BP\u2190A\u00d7P,Q\u2190A\u00d7Q+BP\u2190A\u00d7P, Q\u2190A\u00d7Q+B\u3068\u3059\u308b\u51e6\u7406\u3092(T-1)\u56de\u7e70\u308a\u8fd4\u305b\u3070\u30aa\u30fc\u30b1\u30fc\u3067\u3059\u3002\u3053\u308c\u3092Ruby\u3067\u66f8\u304f\u3068\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\ncode2.rb\nN = gets.to_i\nx,T,A,B,C = gets.split.map(&:to_i)\np,q = A,B\n(T - 1).times{\n  p = (A * p) % C\n  q = (A * q + B) % C\n}\ns = 0\nN.times{\n  s += x\n  x = (p * x + q) % C\n}\nputs s\n\n\n\u3000\u30eb\u30fc\u30d7\u5185\u3067\u3055\u308a\u6c17\u306a\u304f\u3001\u6bce\u56deC\u3067\u5270\u4f59\u3092\u53d6\u3063\u3066\u3044\u308b\u3053\u3068\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u5225\u306bT\u30eb\u30fc\u30d7\u304c\u7d42\u308f\u3063\u305f\u5f8c\u306b\u5270\u4f59\u3092\u53d6\u308c\u3070\u3044\u3044\u306e\u3067\u3059\u304c\u3001p\u3084q\u306e\u6841\u6570\u304c\u5927\u304d\u304f\u306a\u308a\u3059\u304e\u308b\u306e\u3092\u5270\u4f59\u306b\u3088\u3063\u3066\u6291\u3048\u3066\u3044\u307e\u3059\u3002\n\u3000\u305f\u3060\u3057\u3001\u5b9f\u306e\u3068\u3053\u308d\u3001\u3053\u308c\u3067\u3082\u307e\u3060\u8a08\u7b97\u91cf\u306f\u591a\u3044\u3067\u3059\u3002\u3082\u3063\u3068\u5de5\u592b\u3057\u306a\u3051\u308c\u3070\u3001\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3092\u5168\u3066\u901a\u904e\u3055\u305b\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\n\u3000\u3000http://xmascontest2015noon.contest.atcoder.jp/submissions/617963\n\n\u8a08\u7b97\u91cf\u524a\u6e1b\u6cd5\u305d\u306e2\uff1a\u30d0\u30a4\u30ca\u30ea\u6cd5\n\u3000\u305d\u3082\u305d\u3082\u3001\u5148\u306b\u66f8\u3044\u305f\u901a\u308a\u3001\u300cf(x)\u3092t\u56de\u9069\u7528\u3059\u308b\u3053\u3068\u300d\u306f\u3001\u300cf(x)\u3092t/2\u56de\u9069\u7528\u3057\u3066\u304b\u3089\u3001f(x)\u3092t/2\u56de\u9069\u7528\u3059\u308b\u300d\u3053\u3068\u3068\u540c\u3058\u3067\u3059(\u5165\u308c\u5b50\u306a\u306e\u3067)\u3002\u8981\u3059\u308b\u306b\u3001g(x,t/2)=P\u2032\u00d7x+Q\u2032g(x,t/2)=P\u2032\u00d7x+Q\u2032g(x,t/2)=P'\u00d7x+Q'\u3068\u7f6e\u304f\u3068\u3001g(x,t)=P\u2032\u00d7(P\u2032\u00d7x+Q\u2032)+Q\u2032=P\u2032\u00d7P\u2032\u00d7x+P\u2032\u00d7Q\u2032+Q\u2032g(x,t)=P\u2032\u00d7(P\u2032\u00d7x+Q\u2032)+Q\u2032=P\u2032\u00d7P\u2032\u00d7x+P\u2032\u00d7Q\u2032+Q\u2032g(x,t)=P'\u00d7(P'\u00d7x+Q')+Q'=P'\u00d7P'\u00d7x+P'\u00d7Q'+Q'\u3068\u306a\u308a\u307e\u3059\u3002\n\u3000\u3053\u306e\u3053\u3068\u304b\u3089\u3001\u554f\u984c\u30b5\u30a4\u30ba\u30921/2\u500d\u306b\u3057\u3066\u304b\u3089\u305d\u306e\u7d50\u679c\u3092\u518d\u5229\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u8a08\u7b97\u91cf\u3092\u5927\u5e45\u306b\u524a\u6e1b\u3067\u304d\u308b\u3068\u5206\u304b\u308a\u307e\u3059\u3002\u3053\u306e\u767a\u60f3\u306f\u4e00\u822c\u306b\u30d0\u30a4\u30ca\u30ea\u6cd5\u3068\u547c\u3070\u308c\u3001\u5e83\u304f\u306f\u5206\u5272\u7d71\u6cbb\u6cd5\u306e\u4e00\u3064\u3068\u3057\u3066\u5206\u985e\u3055\u308c\u307e\u3059\u3002\n\u3000\u307e\u305a\u306f\u3053\u308c\u3092\u518d\u5e30\u95a2\u6570\u3068\u3057\u3066\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u5177\u4f53\u7684\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\ncode3.rb\ndef calc(a,b,c,t)\n    return a,b if t == 1\n    p1,q1 = calc(a,b,c,t/2)\n    p,q = (p1*p1)%c,(p1*q1+q1)%c\n    p,q = (a*p)%c,(a*q+b)%c if t % 2 == 1\n    return p,q\nend\n\nN = gets.to_i\nx,T,A,B,C = gets.split.map(&:to_i)\np,q = calc(A,B,C,T)\ns = 0\nN.times{\n  s += x\n  x = (p * x + q) % C\n}\nputs s\n\n\n\u3000\u3053\u3053\u3067\u30dd\u30a4\u30f3\u30c8\u3068\u3057\u3066\u306f\u3001t\u304c\u5076\u6570\u3068\u306f\u9650\u3089\u306a\u3044\u3053\u3068\u304b\u3089\u3001\u305d\u308c\u3092\u8003\u616e\u3057\u3066\u518d\u5e30\u95a2\u6570\u5185\u304c\u5197\u9577\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3067\u3059\u3002\u3068\u306f\u3044\u3048\u3053\u308c\u3067\u3082\u5341\u5206\u306b\u901f\u304f\u3001\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3092\u697d\u3005\u3068\u901a\u904e\u3057\u307e\u3059\u3002\n\u3000\u3000http://xmascontest2015noon.contest.atcoder.jp/submissions/617992\n\u3000\u3088\u308a\u9ad8\u901f\u5316\u3057\u305f\u3044\u5834\u5408\u306f\u3001\u518d\u5e30\u95a2\u6570\u3067\u306f\u306a\u304f\u76f4\u63a5\u66f8\u304d\u4e0b\u305b\u3070\u3088\u3044\u3067\u3057\u3087\u3046\u3002\u3064\u307e\u308a\u3001\u300cf(x)\u30922^n\u56de\u9069\u7528\u300d\u3057\u305f\u969b\u306e\u4fc2\u6570p,q\u3092\u5225\u9014\u8a08\u7b97\u3057\u3066\u304a\u304d\u3001\u5f8c\u306f\u305d\u308c\u3092\u7e4b\u304e\u5408\u308f\u305b\u308b\u3060\u3051\u3067\u8a08\u7b97\u304c\u5b8c\u4e86\u3057\u307e\u3059\u3002\n\ncode4.rb\ndef calc(p,q,a,b,c)\n    return (a*p)%c,(a*q+b)%c\nend\nn = gets.to_i\nx,t,A,B,C = gets.split.map(&:to_i)\np,q = 1,0\np_,q_ = A,B\nwhile t >= 1\n    if t % 2 == 1 then\n        p,q = calc(p,q,p_,q_,C)\n    end\n    p_,q_ = calc(p_,q_,p_,q_,C)\n    t /= 2\nend\ns = 0\nn.times{\n  s += x\n  x = (p * x + q) % C\n}\nputs s\n\n\n\u3000\u5b9f\u969b\u3001\u5b9f\u884c\u7d50\u679c\u3092\u898b\u3066\u3082\u3001\u518d\u5e30\u95a2\u6570\u3088\u308a\u901f\u3044\u7d50\u679c\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\u3067\u306f\u3001\u3053\u306e\u30b3\u30fc\u30c9\u304c\u6700\u9069\u306a\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\n\u3000\u3000http://xmascontest2015noon.contest.atcoder.jp/submissions/618027\n\n\u8a08\u7b97\u91cf\u524a\u6e1b\u6cd5\u305d\u306e3\uff1a\u66f4\u306b\u4e00\u5de5\u592b\uff01\n\u3000\u3053\u3053\u3067f(x)\u306e\u5f0f\u3092\u601d\u3044\u51fa\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\u3042\u308c\u30921\u56de\u5165\u308c\u5b50\u306b\u3059\u308b\u3068f(f(x))=A\u00d7A\u00d7x+A\u00d7B+Bf(f(x))=A\u00d7A\u00d7x+A\u00d7B+Bf(f(x))=A\u00d7A\u00d7x+A\u00d7B+B\u3068\u306a\u308a\u307e\u3059\u304c\u3001\u3053\u306e\u307e\u307e\u5165\u308c\u5b50\u306b\u3057\u7d9a\u3051\u308b\u3068\u3069\u3046\u306a\u308b\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\n\u3000\u2026\u2026\u7b54\u3048\u306f\u3001g(x,t)=At\u00d7x+At\u22121\u00d7B+At\u22122\u00d7B+...+A\u00d7B+Bg(x,t)=At\u00d7x+At\u22121\u00d7B+At\u22122\u00d7B+...+A\u00d7B+Bg(x,t)=A^t\u00d7x+A^{t-1}\u00d7B+A^{t-2}\u00d7B+...+A\u00d7B+B\u3067\u3059\u3002A=0,1\u306a\u3089\u81ea\u660e\u3067\u3059\u306e\u3067\u3001\u4ee5\u4e0b\u306fA\u22672\u3067\u8003\u3048\u307e\u3059\u3002\n\u3000\u7b49\u6bd4\u6570\u5217\u306e\u548c\u306e\u516c\u5f0f\u304b\u3089\u3001At\u22121+At\u22122+...+A+1=(At\u22121)/(A\u22121)At\u22121+At\u22122+...+A+1=(At\u22121)/(A\u22121)A^{t-1}+A^{t-2}+...+A+1=(A^t-1)/(A-1)\u3068\u306a\u308a\u307e\u3059\u306e\u3067\u3001g(x,t)=At\u00d7x+(At\u22121)/(A\u22121)\u00d7Bg(x,t)=At\u00d7x+(At\u22121)/(A\u22121)\u00d7Bg(x,t)=A^t\u00d7x+(A^t-1)/(A-1)\u00d7B\u3068\u306a\u308a\u307e\u3059\u3002\u305f\u3060\u3001p\u304cq\u3067\u5272\u308a\u5207\u308c\u308b\u969b\u3001(p/q)modr=(pmodqr)/q(p/q)modr=(pmodqr)/q(p/q)\\bmod r=(p \\bmod qr)/q\u304c\u6210\u7acb\u3057\u307e\u3059\u306e\u3067\u3001(At\u22121)/(A\u22121)modC=([At\u22121]mod[C(A\u22121)])/[A\u22121](At\u22121)/(A\u22121)modC=([At\u22121]mod[C(A\u22121)])/[A\u22121](A^t-1)/(A-1) \\bmod C=([A^t-1] \\bmod [C(A-1)]) / [A-1]\u3068\u5909\u5f62\u3067\u304d\u307e\u3059\u3002\u4ee5\u4e0a\u3092\u8e0f\u307e\u3048\u3066\u30bd\u30fc\u30b9\u306b\u843d\u3068\u3057\u3053\u3080\u3068\u3053\u3093\u306a\u611f\u3058\u3002\n\ncode5.rb\ndef powmod(a,t,p)\n    r = 1\n    b = a\n    while t > 0\n        if t % 2 == 1 then\n            r = r * b % p\n        end\n        b = b * b % p\n        t /= 2\n    end\n    return r\nend\n\nn = gets.to_i\nx,T,A,B,C = gets.split.map(&:to_i)\n\np = powmod(A,T,C)\nq = (powmod(A,T,C*(A-1))+(C*(A-1)-1))/(A-1)*B\n\ns = 0\nn.times{\n  s += x\n  x = (p * x + q) % C\n}\nputs s\n\n\n\u3000\u2026\u2026\u3048\u3001\u3053\u306e\u65b9\u304c\u5197\u9577\u3060\u308d\u3063\u3066\u3001\u305d\u3001\u30bd\u30f3\u30ca\u30b3\u30c8\u30ca\u30a4\u30e8\u3002\n\u3000\u3000http://xmascontest2015noon.contest.atcoder.jp/submissions/618063\n\u3000\u3061\u306a\u307f\u306b\u4e0a\u8a18\u306e\u77ed\u7e2e\u30a2\u30a4\u30c7\u30a3\u30a2\u306f\u3053\u306e\u30c4\u30a4\u30fc\u30c8\u304b\u3089\u3067\u3057\u305f\u3002\u63d0\u6848\u8005\u306b\u3088\u308b\u3001\u3088\u308a\u6d17\u7df4\u3055\u308c\u305f\u30b3\u30fc\u30c9\u3082\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\n\u3000\u3000http://xmascontest2015noon.contest.atcoder.jp/submissions/615387\n\n\u307e\u3068\u3081\n\u3000\u9014\u4e2d\u304b\u3089\u9ad8\u901f\u5316\u3068\u3044\u3046\u3088\u308a\u77e5\u6075\u6bd4\u3079\u306a\u65b9\u5411\u306b\u8131\u7dda\u3057\u307e\u3057\u305f\u304c\u3001\u300c\u5206\u5272\u3067\u304d\u308c\u3070\u697d\u306b\u306a\u308b\u300d\u3053\u3068\u306f\u5206\u304b\u3063\u3066\u3044\u305f\u3060\u3051\u305f\u3067\u3057\u3087\u3046\u304b\u3002\n\u3000\u3061\u306a\u307f\u306b\u79c1\u306e\u5834\u5408\u3001\u6700\u521d\u306f\u30e1\u30e2\u5316\u3057\u3066\u306a\u3093\u3068\u304b\u4e57\u308a\u5207\u3063\u305f\u8a18\u61b6\u304c\u3042\u308a\u307e\u3059\uff1e\uff1c\n# \u6982\u8981\n\u3000\u767a\u7aef\u3001[AtCoder](http://atcoder.jp/)\u4ee3\u8868\u53d6\u7de0\u5f79\u793e\u9577\u306e[chokudai](https://twitter.com/chokudai)\u6c0f\u3068\u3001\u65b0\u5352\u6587\u7cfb\u30d7\u30ed\u30b0\u30e9\u30de\u517c\u30de\u30f3\u30ac\u5bb6\uff5c\u8150\u5973\u5b50\u306e[\u3061\u3087\u307e\u3069](https://twitter.com/chomado)\u6c0f\u3068\u306e\u6b21\u306e\u3088\u3046\u306a\u3084\u308a\u53d6\u308a\u304b\u3089\u3067\u3057\u305f\u3002\n\u3000\u3000[https://twitter.com/chokudai/status/690039649268580352](https://twitter.com/chokudai/status/690039649268580352)\n\u3000\u7aef\u7684\u306b\u8a00\u3048\u3070\u3001\u300cA\u554f\u984c\u304c\u89e3\u3051\u308c\u3070\u30d7\u30ed\u30b0\u30e9\u30de\u306a\u3093\u3067\u3059\u3088\u306d\uff1f**\u3058\u3083\u3042\u3053\u308c\u89e3\u3044\u3066\u304f\u3060\u3055\u3044\uff1e\uff1c**\u300d\u3068\u3044\u3046chokudai\u6c0f\u304b\u3089\u306e\u6311\u6226\u72b6\u3067\u3059\u306d\u3002\u3042\u307e\u308a\u306e\u96e3\u6613\u5ea6\u306b\u3061\u3087\u307e\u3069\u6c0f\u306f\u65e9\u3005\u306b\u30ae\u30d6\u30a2\u30c3\u30d7\u3057\u3001\u5f8c\u304b\u3089\u53c2\u52a0\u3057\u305f\u79c1\u3082**\u305d\u306e\u96e3\u6613\u5ea6\u306b\u76ee\u3092\u5265\u304d\u307e\u3057\u305f**\u3002\n\u3000\u4ee5\u4e0b\u306f\u3053\u306e\u554f\u984c\u306e\u89e3\u8aac\u8a18\u4e8b\u3068\u306a\u308a\u307e\u3059\u3002\u30cd\u30bf\u30d0\u30ec\u3092\u907f\u3051\u305f\u3044\u4eba\u306f\u4f55\u3082\u898b\u305a\u306b\u307e\u305a\u306f\u89e3\u3044\u3066\u307f\u307e\u3057\u3087\u3046\uff1e\uff1c\n\u3000\u3000[A - Accumulation](http://xmascontest2015noon.contest.atcoder.jp/tasks/xmascontest2015_a)\n\n# \u307e\u305a\u306f\u554f\u984c\u306e\u610f\u56f3\u3092\u3064\u304b\u307f\u307e\u3057\u3087\u3046\n\u3000\u554f\u984c\u6587\u3092\u8aad\u3081\u3070\u5206\u304b\u308a\u307e\u3059\u304c\u3001\u968f\u5206\u3068**\u6570\u5b66\u3063\u307d\u3044**\u554f\u984c\u3067\u3059\u3002\u305d\u308c\u3082\u3001\u6574\u6570\u8ad6\u306e\u9999\u308a\u304c\u30d3\u30f3\u30d3\u30f3\u306b\u3057\u307e\u3059\u3002\n\u3000\u5e78\u3044\u64ec\u4f3c\u30b3\u30fc\u30c9\u304c\u4e0e\u3048\u3089\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u300c\u3069\u3093\u306a\u51e6\u7406\u3092\u3057\u3066\u3044\u308b\u304b\u300d\u306f\u7c21\u5358\u306b\u3064\u304b\u3080\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u306d\u3002Ruby\u3067\u66f8\u304f\u3068\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n```code1.rb\n=begin\n\u5165\u529b\uff1a\n  N\n  X,T,A,B,C\n\u5165\u529b\u306e\u6761\u4ef6\uff1a\n  1 \u2266 N \u2266 10^6\n  1 \u2266 T,C \u2266 10^9\n  0 \u2266 X,A,B \uff1c C\n=end\n\nN = gets.to_i\nx,T,A,B,C = gets.split.map(&:to_i)\ns = 0\nN.times{\n  s += x\n  T.times{\n    x = (A * x + B) % C\n  }\n}\nputs s\n```\n\n\u3000\u2026\u2026\u3053\u3046\u3057\u3066\u898b\u308b\u3068\u5206\u304b\u308b\u3088\u3046\u306b\u3001\u7d20\u6734\u306a\u30b3\u30fc\u30c9\u3060\u3068\u300cx = (A * x + B) % C\u300d\u304cN\u00d7T\u56de\u5b9f\u884c\u3055\u308c\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\u5165\u529b\u306e\u6761\u4ef6\u304b\u3089\u3001\u305d\u308c\u304c\u6700\u592710^15(100\u4eac)\u56de\u3082\u7e70\u308a\u8fd4\u3055\u308c\u308b\u3053\u3068\u306b\u306a\u308b\u306e\u3067\u3001\u554f\u984c\u306e\u6761\u4ef6(2sec)\u3092\u8003\u616e\u3059\u308b\u3068\u5230\u5e95\u9593\u306b\u5408\u3044\u307e\u305b\u3093\u3002\u5b9f\u969b\u3001\u63d0\u51fa\u3057\u3066\u307f\u308b\u3068\u60e8\u61ba\u305f\u308b\u6210\u7e3e\u3067\u3057\u305f\u3002\n\u3000\u3000[http://xmascontest2015noon.contest.atcoder.jp/submissions/616130](http://xmascontest2015noon.contest.atcoder.jp/submissions/616130)\n\n# \u6b21\u306b\u9ad8\u901f\u5316\u3092\u691c\u8a0e\u3057\u307e\u3059\n\u3000\u4e0a\u8a18\u30bd\u30fc\u30b9\u3092\u3088\u304f\u8aad\u3093\u3067\u307f\u308b\u3068\u3001\u300cs\u306bx\u3092\u8db3\u3059\u2192x\u306b\u5bfe\u3057\u3066\u51e6\u7406\u3059\u308b\u2192s\u306bx\u3092\u8db3\u3059\u2192\u2026\u2026\u300d\u3068\u3044\u3063\u305f\u51e6\u7406\u624b\u9806\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\u3053\u306e\u300cx\u306b\u5bfe\u3057\u3066\u51e6\u7406\u3059\u308b\u300d\u90e8\u5206\u306b\u5927\u304d\u304f\u8a08\u7b97\u6642\u9593\u3092\u53d6\u3089\u308c\u3066\u3044\u308b\u306e\u304c\u554f\u984c\u306a\u306e\u3067\u3059\u3002\u3046\u307e\u304f\u5de5\u592b\u3057\u3066\u8a08\u7b97\u91cf\u3092\u524a\u308c\u306a\u3044\u3067\u3057\u3087\u3046\u304b\uff1f\n\u3000\u305d\u3093\u306a\u6642\u306b\u767b\u5834\u3059\u308b\u306e\u304c\u6574\u6570\u8ad6\u3067\u3059\u3002\u305d\u3053\u305d\u3053\u9577\u304f\u306a\u308b\u306e\u3067\u5225\u306b\u5206\u3051\u307e\u3059\u3002\n\n## \u6574\u6570\u8ad6\u306e\u57fa\u790e(\u3056\u3063\u304f\u308a)\n\u3000\u307e\u305a\u3001\u5270\u4f59\u8a08\u7b97\u306b\u3064\u3044\u3066\u6574\u7406\u3057\u307e\u3057\u3087\u3046\u3002\u6574\u6570A\u3092\u6574\u6570B\u3067\u5272\u3063\u305f\u4f59\u308a\u304c\u6574\u6570C\u3067\u3042\u308b\u3068\u304d\u3001\u9069\u5f53\u306a\u6574\u6570N\u3092\u7528\u3044\u3066$A=B\u00d7N+C$\u3068\u8868\u73fe\u3055\u308c\u307e\u3059\u3002\u5c0f\u3055\u306a\u6570\u3067\u4f8b\u3048\u308c\u3070\u3001A=25,B=7,C=4\u3067\u3042\u308b\u969b\u3001$25=7\u00d73+4$\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u306d\u3002\n\u3000\u3053\u3053\u3067\u8a18\u53f7$\\pmod{p}$\u3092\u5c0e\u5165\u3057\u307e\u3059\u3002\u610f\u5473\u3068\u3057\u3066\u306f\u3001**\u300c\u6cd5p\u306e\u4e16\u754c\u306b\u304a\u3044\u3066\u300d**\u3068\u306a\u308a\u307e\u3059\u3002\u3053\u306e\u4e16\u754c\u306e\u5143\u3067\u306f\u3001**\u300cp\u3067\u5272\u3063\u305f\u969b\u306e\u4f59\u308a\u304c\u540c\u3058\u6570\u306f\u7b49\u3057\u3044\u3068\u898b\u306a\u3059\u300d**\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u5c0f\u3055\u306a\u6570\u3067\u4f8b\u3048\u3070\u3001$25=18=11=4\\pmod{7}$\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u306d\u3002\n\u3000\u3053\u306e\u4e0d\u601d\u8b70\u306a\u4e16\u754c\u306e\u5143\u3067\u3082\u3001\u56db\u5247\u6f14\u7b97\u306f\u540c\u69d8\u306b\u6210\u308a\u7acb\u3061\u307e\u3059(\u305f\u3060\u3057\u9664\u6cd5\u306b\u3064\u3044\u3066\u306f\u591a\u5c11\u3084\u3084\u3053\u3057\u3044)\u3002\u3064\u307e\u308a\u30014\u00d76\u30828\u00d73\u308224\u3068\u7b49\u3057\u304f\u306a\u308a\u307e\u3059\u3002\u305f\u3060\u3057\u5148\u307b\u3069\u306e\u30eb\u30fc\u30eb\u304b\u3089\u3001$7\u00d73+3=24=3=66=7\u00d79+3\\pmod{7}$\u3068\u306a\u308a\u307e\u3059\u304c\u3002\n\n## \u8a08\u7b97\u91cf\u524a\u6e1b\u6cd5\u305d\u306e1\uff1a\u8a08\u7b97\u3092\u307e\u3068\u3081\u308b\n\u3000\u3053\u306e\u6574\u6570\u8ad6\u306e\u6027\u8cea\u3092\u7528\u3044\u308b\u3068\u3001\u300cx\u306b\u5bfe\u3057\u3066\u51e6\u7406\u3059\u308b\u300d\u90e8\u5206\u3092\u30b3\u30f3\u30d1\u30af\u30c8\u306b\u307e\u3068\u3081\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u3000\u6cd5C\u306e\u4e16\u754c\u306e\u5143\u3067\u3082\u56db\u5247\u6f14\u7b97\u304c\u6210\u308a\u7acb\u3064\u306e\u3067\u3001$f(x)=A\u00d7x+B$\u3068\u3057\u3066\u3001$g(x,t)=f(f(f(...(x))))$\u3068\u7f6e\u304f\u3068(\u305f\u3060\u3057f\u304ct\u500b\u5165\u308c\u5b50\u306b\u306a\u3063\u3066\u3044\u308b)\u3001\u9069\u5f53\u306a\u6574\u6570P,Q\u3092\u7528\u3044\u3066$g(x,t)=P\u00d7x+Q$\u3068\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3064\u307e\u308a\u3001\u4e8b\u524d\u306bP\u3068Q\u3092\u8a08\u7b97\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u3001\u300cx\u306b\u5bfe\u3057\u3066\u51e6\u7406\u3059\u308b\u300d\u90e8\u5206\u306e\u8a08\u7b97\u304c\u77ac\u6642\u306b\u7d42\u308f\u308b\u3053\u3068\u306b\u306a\u308b\u306e\u3067\u3059\u3002\n\u3000P\u3068Q\u306e\u8a08\u7b97\u65b9\u6cd5\u3067\u3059\u304c\u3001$A\u00d7(P\u00d7x+Q)+B=A\u00d7P\u00d7x+A\u00d7Q+B$\u306a\u306e\u3067\u3001$P\u2190A\u00d7P, Q\u2190A\u00d7Q+B$\u3068\u3059\u308b\u51e6\u7406\u3092(T-1)\u56de\u7e70\u308a\u8fd4\u305b\u3070\u30aa\u30fc\u30b1\u30fc\u3067\u3059\u3002\u3053\u308c\u3092Ruby\u3067\u66f8\u304f\u3068\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```code2.rb\nN = gets.to_i\nx,T,A,B,C = gets.split.map(&:to_i)\np,q = A,B\n(T - 1).times{\n  p = (A * p) % C\n  q = (A * q + B) % C\n}\ns = 0\nN.times{\n  s += x\n  x = (p * x + q) % C\n}\nputs s\n```\n\n\u3000\u30eb\u30fc\u30d7\u5185\u3067\u3055\u308a\u6c17\u306a\u304f\u3001\u6bce\u56deC\u3067\u5270\u4f59\u3092\u53d6\u3063\u3066\u3044\u308b\u3053\u3068\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u5225\u306bT\u30eb\u30fc\u30d7\u304c\u7d42\u308f\u3063\u305f\u5f8c\u306b\u5270\u4f59\u3092\u53d6\u308c\u3070\u3044\u3044\u306e\u3067\u3059\u304c\u3001p\u3084q\u306e\u6841\u6570\u304c\u5927\u304d\u304f\u306a\u308a\u3059\u304e\u308b\u306e\u3092\u5270\u4f59\u306b\u3088\u3063\u3066\u6291\u3048\u3066\u3044\u307e\u3059\u3002\n\u3000\u305f\u3060\u3057\u3001\u5b9f\u306e\u3068\u3053\u308d\u3001\u3053\u308c\u3067\u3082\u307e\u3060\u8a08\u7b97\u91cf\u306f\u591a\u3044\u3067\u3059\u3002\u3082\u3063\u3068\u5de5\u592b\u3057\u306a\u3051\u308c\u3070\u3001\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3092\u5168\u3066\u901a\u904e\u3055\u305b\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\n\u3000\u3000[http://xmascontest2015noon.contest.atcoder.jp/submissions/617963](http://xmascontest2015noon.contest.atcoder.jp/submissions/617963)\n\n## \u8a08\u7b97\u91cf\u524a\u6e1b\u6cd5\u305d\u306e2\uff1a\u30d0\u30a4\u30ca\u30ea\u6cd5\n\u3000\u305d\u3082\u305d\u3082\u3001\u5148\u306b\u66f8\u3044\u305f\u901a\u308a\u3001\u300cf(x)\u3092t\u56de\u9069\u7528\u3059\u308b\u3053\u3068\u300d\u306f\u3001\u300cf(x)\u3092t/2\u56de\u9069\u7528\u3057\u3066\u304b\u3089\u3001f(x)\u3092t/2\u56de\u9069\u7528\u3059\u308b\u300d\u3053\u3068\u3068\u540c\u3058\u3067\u3059(\u5165\u308c\u5b50\u306a\u306e\u3067)\u3002\u8981\u3059\u308b\u306b\u3001$g(x,t/2)=P'\u00d7x+Q'$\u3068\u7f6e\u304f\u3068\u3001$g(x,t)=P'\u00d7(P'\u00d7x+Q')+Q'=P'\u00d7P'\u00d7x+P'\u00d7Q'+Q'$\u3068\u306a\u308a\u307e\u3059\u3002\n\u3000\u3053\u306e\u3053\u3068\u304b\u3089\u3001\u554f\u984c\u30b5\u30a4\u30ba\u30921/2\u500d\u306b\u3057\u3066\u304b\u3089\u305d\u306e\u7d50\u679c\u3092\u518d\u5229\u7528\u3059\u308b\u3053\u3068\u3067\u3001**\u8a08\u7b97\u91cf\u3092\u5927\u5e45\u306b\u524a\u6e1b\u3067\u304d\u308b**\u3068\u5206\u304b\u308a\u307e\u3059\u3002\u3053\u306e\u767a\u60f3\u306f\u4e00\u822c\u306b**\u30d0\u30a4\u30ca\u30ea\u6cd5**\u3068\u547c\u3070\u308c\u3001\u5e83\u304f\u306f**\u5206\u5272\u7d71\u6cbb\u6cd5\u306e\u4e00\u3064**\u3068\u3057\u3066\u5206\u985e\u3055\u308c\u307e\u3059\u3002\n\u3000\u307e\u305a\u306f\u3053\u308c\u3092\u518d\u5e30\u95a2\u6570\u3068\u3057\u3066\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u5177\u4f53\u7684\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n```code3.rb\ndef calc(a,b,c,t)\n\treturn a,b if t == 1\n\tp1,q1 = calc(a,b,c,t/2)\n\tp,q = (p1*p1)%c,(p1*q1+q1)%c\n\tp,q = (a*p)%c,(a*q+b)%c if t % 2 == 1\n\treturn p,q\nend\n\nN = gets.to_i\nx,T,A,B,C = gets.split.map(&:to_i)\np,q = calc(A,B,C,T)\ns = 0\nN.times{\n  s += x\n  x = (p * x + q) % C\n}\nputs s\n```\n\n\u3000\u3053\u3053\u3067\u30dd\u30a4\u30f3\u30c8\u3068\u3057\u3066\u306f\u3001t\u304c\u5076\u6570\u3068\u306f\u9650\u3089\u306a\u3044\u3053\u3068\u304b\u3089\u3001\u305d\u308c\u3092\u8003\u616e\u3057\u3066\u518d\u5e30\u95a2\u6570\u5185\u304c\u5197\u9577\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3067\u3059\u3002\u3068\u306f\u3044\u3048\u3053\u308c\u3067\u3082\u5341\u5206\u306b\u901f\u304f\u3001\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3092\u697d\u3005\u3068\u901a\u904e\u3057\u307e\u3059\u3002\n\u3000\u3000[http://xmascontest2015noon.contest.atcoder.jp/submissions/617992](http://xmascontest2015noon.contest.atcoder.jp/submissions/617992)\n\u3000\u3088\u308a\u9ad8\u901f\u5316\u3057\u305f\u3044\u5834\u5408\u306f\u3001\u518d\u5e30\u95a2\u6570\u3067\u306f\u306a\u304f\u76f4\u63a5\u66f8\u304d\u4e0b\u305b\u3070\u3088\u3044\u3067\u3057\u3087\u3046\u3002\u3064\u307e\u308a\u3001\u300cf(x)\u30922^n\u56de\u9069\u7528\u300d\u3057\u305f\u969b\u306e\u4fc2\u6570p,q\u3092\u5225\u9014\u8a08\u7b97\u3057\u3066\u304a\u304d\u3001\u5f8c\u306f\u305d\u308c\u3092\u7e4b\u304e\u5408\u308f\u305b\u308b\u3060\u3051\u3067\u8a08\u7b97\u304c\u5b8c\u4e86\u3057\u307e\u3059\u3002\n\n```code4.rb\ndef calc(p,q,a,b,c)\n\treturn (a*p)%c,(a*q+b)%c\nend\nn = gets.to_i\nx,t,A,B,C = gets.split.map(&:to_i)\np,q = 1,0\np_,q_ = A,B\nwhile t >= 1\n\tif t % 2 == 1 then\n\t\tp,q = calc(p,q,p_,q_,C)\n\tend\n\tp_,q_ = calc(p_,q_,p_,q_,C)\n\tt /= 2\nend\ns = 0\nn.times{\n  s += x\n  x = (p * x + q) % C\n}\nputs s\n```\n\n\u3000\u5b9f\u969b\u3001\u5b9f\u884c\u7d50\u679c\u3092\u898b\u3066\u3082\u3001\u518d\u5e30\u95a2\u6570\u3088\u308a\u901f\u3044\u7d50\u679c\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\u3067\u306f\u3001\u3053\u306e\u30b3\u30fc\u30c9\u304c\u6700\u9069\u306a\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\n\u3000\u3000[http://xmascontest2015noon.contest.atcoder.jp/submissions/618027](http://xmascontest2015noon.contest.atcoder.jp/submissions/618027)\n\n## \u8a08\u7b97\u91cf\u524a\u6e1b\u6cd5\u305d\u306e3\uff1a\u66f4\u306b\u4e00\u5de5\u592b\uff01\n\u3000\u3053\u3053\u3067f(x)\u306e\u5f0f\u3092\u601d\u3044\u51fa\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\u3042\u308c\u30921\u56de\u5165\u308c\u5b50\u306b\u3059\u308b\u3068$f(f(x))=A\u00d7A\u00d7x+A\u00d7B+B$\u3068\u306a\u308a\u307e\u3059\u304c\u3001\u3053\u306e\u307e\u307e\u5165\u308c\u5b50\u306b\u3057\u7d9a\u3051\u308b\u3068\u3069\u3046\u306a\u308b\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\n\u3000\u2026\u2026\u7b54\u3048\u306f\u3001$g(x,t)=A^t\u00d7x+A^{t-1}\u00d7B+A^{t-2}\u00d7B+...+A\u00d7B+B$\u3067\u3059\u3002A=0,1\u306a\u3089\u81ea\u660e\u3067\u3059\u306e\u3067\u3001\u4ee5\u4e0b\u306fA\u22672\u3067\u8003\u3048\u307e\u3059\u3002\n\u3000\u7b49\u6bd4\u6570\u5217\u306e\u548c\u306e\u516c\u5f0f\u304b\u3089\u3001$A^{t-1}+A^{t-2}+...+A+1=(A^t-1)/(A-1)$\u3068\u306a\u308a\u307e\u3059\u306e\u3067\u3001$g(x,t)=A^t\u00d7x+(A^t-1)/(A-1)\u00d7B$\u3068\u306a\u308a\u307e\u3059\u3002\u305f\u3060\u3001p\u304cq\u3067\u5272\u308a\u5207\u308c\u308b\u969b\u3001$(p/q)\\bmod r=(p \\bmod qr)/q$\u304c\u6210\u7acb\u3057\u307e\u3059\u306e\u3067\u3001$(A^t-1)/(A-1) \\bmod C=([A^t-1] \\bmod [C(A-1)]) / [A-1]$\u3068\u5909\u5f62\u3067\u304d\u307e\u3059\u3002\u4ee5\u4e0a\u3092\u8e0f\u307e\u3048\u3066\u30bd\u30fc\u30b9\u306b\u843d\u3068\u3057\u3053\u3080\u3068\u3053\u3093\u306a\u611f\u3058\u3002\n\n```code5.rb\ndef powmod(a,t,p)\n\tr = 1\n\tb = a\n\twhile t > 0\n\t\tif t % 2 == 1 then\n\t\t\tr = r * b % p\n\t\tend\n\t\tb = b * b % p\n\t\tt /= 2\n\tend\n\treturn r\nend\n \nn = gets.to_i\nx,T,A,B,C = gets.split.map(&:to_i)\n \np = powmod(A,T,C)\nq = (powmod(A,T,C*(A-1))+(C*(A-1)-1))/(A-1)*B\n \ns = 0\nn.times{\n  s += x\n  x = (p * x + q) % C\n}\nputs s\n```\n\n\u3000\u2026\u2026\u3048\u3001\u3053\u306e\u65b9\u304c\u5197\u9577\u3060\u308d\u3063\u3066\u3001\u305d\u3001\u30bd\u30f3\u30ca\u30b3\u30c8\u30ca\u30a4\u30e8\u3002\n\u3000\u3000[http://xmascontest2015noon.contest.atcoder.jp/submissions/618063](http://xmascontest2015noon.contest.atcoder.jp/submissions/618063)\n\u3000\u3061\u306a\u307f\u306b[\u4e0a\u8a18\u306e\u77ed\u7e2e\u30a2\u30a4\u30c7\u30a3\u30a2\u306f\u3053\u306e\u30c4\u30a4\u30fc\u30c8\u304b\u3089](https://twitter.com/angel_p_57/status/690599136903593984)\u3067\u3057\u305f\u3002\u63d0\u6848\u8005\u306b\u3088\u308b\u3001\u3088\u308a\u6d17\u7df4\u3055\u308c\u305f\u30b3\u30fc\u30c9\u3082\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\n\u3000\u3000[http://xmascontest2015noon.contest.atcoder.jp/submissions/615387](http://xmascontest2015noon.contest.atcoder.jp/submissions/615387)\n\n# \u307e\u3068\u3081\n\u3000\u9014\u4e2d\u304b\u3089\u9ad8\u901f\u5316\u3068\u3044\u3046\u3088\u308a\u77e5\u6075\u6bd4\u3079\u306a\u65b9\u5411\u306b\u8131\u7dda\u3057\u307e\u3057\u305f\u304c\u3001**\u300c\u5206\u5272\u3067\u304d\u308c\u3070\u697d\u306b\u306a\u308b\u300d**\u3053\u3068\u306f\u5206\u304b\u3063\u3066\u3044\u305f\u3060\u3051\u305f\u3067\u3057\u3087\u3046\u304b\u3002\n\u3000\u3061\u306a\u307f\u306b\u79c1\u306e\u5834\u5408\u3001\u6700\u521d\u306f**[\u30e1\u30e2\u5316\u3057\u3066\u306a\u3093\u3068\u304b\u4e57\u308a\u5207\u3063\u305f\u8a18\u61b6\u304c\u3042\u308a\u307e\u3059\uff1e\uff1c](http://xmascontest2015noon.contest.atcoder.jp/submissions/615269)**\n", "tags": ["Ruby", "AtCoder", "A\u554f\u984c", "\u6574\u6570\u8ad6", "\u30d0\u30a4\u30ca\u30ea\u6cd5"]}