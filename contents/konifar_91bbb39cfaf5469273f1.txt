{"tags": ["Retrofit", "Android"], "context": " More than 1 year has passed since last update.Android\u3067API\u3068\u3084\u308a\u53d6\u308a\u3059\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u3057\u3066\u3001Square\u793e\u306eRetrofit\u304c\u3042\u308a\u307e\u3059\u3002\n\u3053\u3093\u306a\u611f\u3058\u3067\u3068\u3066\u3082\u7c21\u6f54\u306b\u51e6\u7406\u304c\u8a18\u8ff0\u3067\u304d\u307e\u3059\u3002\nMainApplication.API.getUsers(new Callback<List<User>>() {\n    @Override\n    public void failure(RetrofitError e) {\n        //\n    }\n\n    @Override\n    public void success(List<User> users, Response response) {\n        //\n    }\n});\n\n\u30e1\u30ea\u30c3\u30c8\u3092\u307e\u3068\u3081\u308b\u3068\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\nCallback\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u30e1\u30bd\u30c3\u30c9\u304c\u308f\u304b\u308a\u3084\u3059\u304f\u3066\u3044\u3044\u611f\u3058\u3002\nURL\u3092\u5404\u51e6\u7406\u306e\u4e2d\u3067\u306f\u306a\u304f\u5225\u306e\u30af\u30e9\u30b9\u306b\u307e\u3068\u3081\u3066\u66f8\u3044\u3066\u304a\u304f\u3053\u3068\u304c\u3067\u304d\u3066\u898b\u901a\u3057\u304c\u3044\u3044\u3002\nGson\u3067\u306eparse\u3082\u521d\u671f\u5316\u51e6\u7406\u3067\u8a18\u8ff0\u3057\u3066\u304a\u3051\u3070\u5404\u51e6\u7406\u306e\u4e2d\u3067\u66f8\u304b\u306a\u304f\u3066\u3044\u3044\u3002\nRestAdapter\u3068\u3044\u3046\u30af\u30e9\u30b9\u3092\u4f7f\u3046\u3053\u3068\u3067DI\u3057\u3084\u3059\u304f\u306a\u308b\u3002\n\u30e2\u30c3\u30af\u7528\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3082\u68b1\u5305\u3055\u308c\u3066\u304a\u308a\u30c6\u30b9\u30c8\u3082\u66f8\u304d\u3084\u3059\u3044\u3002\n\n\u4fbf\u5229\u306a\u3093\u3067\u3059\u304c\u3001\u5b9f\u969b\u306b\u4f7f\u3046\u5834\u5408\u306b\u30a2\u30ec\u3069\u3046\u3084\u3063\u305f\u3089\u3044\u3044\u306e\uff1f\u3063\u3066\u3053\u3068\u304c\u3042\u3063\u305f\u306e\u3067\u307e\u3068\u3081\u3066\u304a\u3053\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n1. Gson\u306a\u3069\u3067convert\u3059\u308b\u524d\u306b\u4f55\u304b\u51e6\u7406\u3092\u3057\u305f\u3044\n\u521d\u671f\u5316\u6642\u306b\u3001setConverter\u3067\u72ec\u81ea\u306eCoverter\u30af\u30e9\u30b9\u3092\u30bb\u30c3\u30c8\u3057\u307e\u3059\u3002\u3061\u3087\u3063\u3068\u6c5a\u3044\u3067\u3059\u304c\u3002\u3002\npublic static final ApiService API = new RestAdapter.Builder()\n            .setEndpoint(\"\")\n            .setConverter(new CustomGsonConverter())\n            .build()\n            .create(ApiService.class);\n\npublic class CustomGsonConverter extends GsonConverter {\n\n    private Gson gson;\n\n    public CustomGsonConverter() {\n        this(new GsonBuilder().setDateFormat(\"yyyy-MM-dd HH:mm:ss\").create());\n    }\n\n    public ApiGsonConverter(Gson gson) {\n        super(gson);\n        this.gson = gson;\n    }\n\n    @Override\n    public Object fromBody(TypedInput body, Type type) throws ConversionException {\n        String charset = \"UTF-8\";\n        if (body.mimeType() != null) {\n            charset = MimeUtil.parseCharset(body.mimeType());\n        }\n\n        InputStreamReader isr = null;\n        try {\n            ByteArrayOutputStream baos = inputStreamToOutputStream(body.in());\n\n            // \u3053\u3053\u3067\u4f55\u304b\u3059\u308b\n\n            isr = new InputStreamReader(new ByteArrayInputStream(baos.toByteArray()), charset);\n            return gson.fromJson(isr, type);\n        } catch (IOException e) {\n            throw new ConversionException(e);\n        } catch (JsonParseException e) {\n            throw new ConversionException(e);\n        } finally {\n            if (isr != null) {\n                try {\n                    isr.close();\n                } catch (IOException ignored) {\n                }\n            }\n        }\n    }\n\n\n2. \u901a\u4fe1\u6642\u306bsession_store_key\u3092\u4ed5\u8fbc\u307f\u305f\u3044\n\u521d\u671f\u5316\u6642\u306b\u3001setRequestInterceptor\u3067\u72ec\u81ea\u306eInterceptor\u30af\u30e9\u30b9\u3092\u30bb\u30c3\u30c8\u3057\u307e\u3059\u3002\npublic static final ApiService API = new RestAdapter.Builder()\n            .setEndpoint(\"\")\n            .setRequestInterceptor(new CustomRequestInterceptor())\n            .build()\n            .create(ApiService.class);\n\npublic class CustomRequestInterceptor implements RequestInterceptor {\n\n    private static final String HEADER_COOKIE = \"Cookie\";\n    private static final String EQ = \"=\";\n\n    @Override\n    public void intercept(RequestInterceptor.RequestFacade request) {\n        request.addHeader(HEADER_COOKIE, Constants.SESSION_STORE_KEY + EQ + \"sessionId\");\n    }\n}\n\n\n3. \u901a\u4fe1\u30a8\u30e9\u30fc\u304c\u8d77\u304d\u305f\u6642\u306b\u5171\u901a\u51e6\u7406\u3092\u3057\u305f\u3044\n\u521d\u671f\u5316\u6642\u306b\u3001setErrorHandler\u3067\u72ec\u81ea\u306eErrorHandler\u30af\u30e9\u30b9\u3092\u30bb\u30c3\u30c8\u3057\u307e\u3059\u3002\npublic static final ApiService API = new RestAdapter.Builder()\n            .setEndpoint(\"\")\n            .setErrorHandler(new CustomErrorHandler())\n            .build()\n            .create(ApiService.class);\n\npublic class CustomErrorHandler implements ErrorHandler {\n\n    @Override\n    public Throwable handleError(RetrofitError cause) {\n        try {\n            Response response = cause.getResponse();\n            // \u3053\u3053\u3067\u4f55\u304b\u3059\u308b\n        } catch (Exception e) {\n            //\n        }\n        return cause;\n    }\n}\n\n\n4. \u901a\u4fe1\u6642\u9593\u3092\u8a08\u6e2c\u3057\u305f\u3044\n\u521d\u671f\u5316\u6642\u306b\u3001setProfiler\u3067\u72ec\u81ea\u306eProfiler\u30af\u30e9\u30b9\u3092\u30bb\u30c3\u30c8\u3057\u307e\u3059\u3002\npublic static final ApiService API = new RestAdapter.Builder()\n            .setEndpoint(\"\")\n            .setProfiler(new CustomProfiler())\n            .build()\n            .create(ApiService.class);\n\npublic class CustomProfiler implements Profiler {\n    @Override\n    public Object beforeCall() {\n        // afterCall\u306b\u6e21\u3057\u305f\u3044\u30c7\u30fc\u30bf\u304c\u3042\u308c\u3070\u3053\u3053\u3067\u8fd4\u3059\n        return null;\n    }\n\n    @Override\n    public void afterCall(RequestInformation requestInfo, long elapsedTime,\n                          int statusCode, Object beforeCallData) {\n        try {\n            // \u3053\u3053\u3067\u4f55\u304b\u3059\u308b\u3002beforeCallData\u306b\u306f\u3001beforeCall()\u3067\u8fd4\u3055\u308c\u305fObject\u304c\u5165\u308b\n        } catch (Exception e) {\n            //\n        }\n    }\n}\n\nAndroid\u3067API\u3068\u3084\u308a\u53d6\u308a\u3059\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u3057\u3066\u3001Square\u793e\u306e[Retrofit](http://square.github.io/retrofit/)\u304c\u3042\u308a\u307e\u3059\u3002\n\u3053\u3093\u306a\u611f\u3058\u3067\u3068\u3066\u3082\u7c21\u6f54\u306b\u51e6\u7406\u304c\u8a18\u8ff0\u3067\u304d\u307e\u3059\u3002\n\n```java\nMainApplication.API.getUsers(new Callback<List<User>>() {\n    @Override\n    public void failure(RetrofitError e) {\n        //\n    }\n\n    @Override\n    public void success(List<User> users, Response response) {\n        //\n    }\n});\n``` \n\n\u30e1\u30ea\u30c3\u30c8\u3092\u307e\u3068\u3081\u308b\u3068\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n* Callback\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u30e1\u30bd\u30c3\u30c9\u304c\u308f\u304b\u308a\u3084\u3059\u304f\u3066\u3044\u3044\u611f\u3058\u3002\n* URL\u3092\u5404\u51e6\u7406\u306e\u4e2d\u3067\u306f\u306a\u304f\u5225\u306e\u30af\u30e9\u30b9\u306b\u307e\u3068\u3081\u3066\u66f8\u3044\u3066\u304a\u304f\u3053\u3068\u304c\u3067\u304d\u3066\u898b\u901a\u3057\u304c\u3044\u3044\u3002\n* Gson\u3067\u306eparse\u3082\u521d\u671f\u5316\u51e6\u7406\u3067\u8a18\u8ff0\u3057\u3066\u304a\u3051\u3070\u5404\u51e6\u7406\u306e\u4e2d\u3067\u66f8\u304b\u306a\u304f\u3066\u3044\u3044\u3002\n* RestAdapter\u3068\u3044\u3046\u30af\u30e9\u30b9\u3092\u4f7f\u3046\u3053\u3068\u3067DI\u3057\u3084\u3059\u304f\u306a\u308b\u3002\n* \u30e2\u30c3\u30af\u7528\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3082\u68b1\u5305\u3055\u308c\u3066\u304a\u308a\u30c6\u30b9\u30c8\u3082\u66f8\u304d\u3084\u3059\u3044\u3002\n\n\u4fbf\u5229\u306a\u3093\u3067\u3059\u304c\u3001\u5b9f\u969b\u306b\u4f7f\u3046\u5834\u5408\u306b\u30a2\u30ec\u3069\u3046\u3084\u3063\u305f\u3089\u3044\u3044\u306e\uff1f\u3063\u3066\u3053\u3068\u304c\u3042\u3063\u305f\u306e\u3067\u307e\u3068\u3081\u3066\u304a\u3053\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n\n#1. Gson\u306a\u3069\u3067convert\u3059\u308b\u524d\u306b\u4f55\u304b\u51e6\u7406\u3092\u3057\u305f\u3044\n\u521d\u671f\u5316\u6642\u306b\u3001`setConverter`\u3067\u72ec\u81ea\u306eCoverter\u30af\u30e9\u30b9\u3092\u30bb\u30c3\u30c8\u3057\u307e\u3059\u3002\u3061\u3087\u3063\u3068\u6c5a\u3044\u3067\u3059\u304c\u3002\u3002\n\n```java\npublic static final ApiService API = new RestAdapter.Builder()\n            .setEndpoint(\"\")\n            .setConverter(new CustomGsonConverter())\n            .build()\n            .create(ApiService.class);\n```\n\n```java\npublic class CustomGsonConverter extends GsonConverter {\n\n    private Gson gson;\n\n    public CustomGsonConverter() {\n        this(new GsonBuilder().setDateFormat(\"yyyy-MM-dd HH:mm:ss\").create());\n    }\n\n    public ApiGsonConverter(Gson gson) {\n        super(gson);\n        this.gson = gson;\n    }\n\n    @Override\n    public Object fromBody(TypedInput body, Type type) throws ConversionException {\n        String charset = \"UTF-8\";\n        if (body.mimeType() != null) {\n            charset = MimeUtil.parseCharset(body.mimeType());\n        }\n\n        InputStreamReader isr = null;\n        try {\n            ByteArrayOutputStream baos = inputStreamToOutputStream(body.in());\n\n            // \u3053\u3053\u3067\u4f55\u304b\u3059\u308b\n\n            isr = new InputStreamReader(new ByteArrayInputStream(baos.toByteArray()), charset);\n            return gson.fromJson(isr, type);\n        } catch (IOException e) {\n            throw new ConversionException(e);\n        } catch (JsonParseException e) {\n            throw new ConversionException(e);\n        } finally {\n            if (isr != null) {\n                try {\n                    isr.close();\n                } catch (IOException ignored) {\n                }\n            }\n        }\n    }\n```\n\n\n#2. \u901a\u4fe1\u6642\u306bsession_store_key\u3092\u4ed5\u8fbc\u307f\u305f\u3044\n\u521d\u671f\u5316\u6642\u306b\u3001`setRequestInterceptor `\u3067\u72ec\u81ea\u306eInterceptor\u30af\u30e9\u30b9\u3092\u30bb\u30c3\u30c8\u3057\u307e\u3059\u3002\n\n```java\npublic static final ApiService API = new RestAdapter.Builder()\n            .setEndpoint(\"\")\n            .setRequestInterceptor(new CustomRequestInterceptor())\n            .build()\n            .create(ApiService.class);\n```\n\n```java\npublic class CustomRequestInterceptor implements RequestInterceptor {\n\n    private static final String HEADER_COOKIE = \"Cookie\";\n    private static final String EQ = \"=\";\n\n    @Override\n    public void intercept(RequestInterceptor.RequestFacade request) {\n        request.addHeader(HEADER_COOKIE, Constants.SESSION_STORE_KEY + EQ + \"sessionId\");\n    }\n}\n```\n\n#3. \u901a\u4fe1\u30a8\u30e9\u30fc\u304c\u8d77\u304d\u305f\u6642\u306b\u5171\u901a\u51e6\u7406\u3092\u3057\u305f\u3044\n\u521d\u671f\u5316\u6642\u306b\u3001`setErrorHandler`\u3067\u72ec\u81ea\u306eErrorHandler\u30af\u30e9\u30b9\u3092\u30bb\u30c3\u30c8\u3057\u307e\u3059\u3002\n\n```java\npublic static final ApiService API = new RestAdapter.Builder()\n            .setEndpoint(\"\")\n            .setErrorHandler(new CustomErrorHandler())\n            .build()\n            .create(ApiService.class);\n```\n\n```java\npublic class CustomErrorHandler implements ErrorHandler {\n\n    @Override\n    public Throwable handleError(RetrofitError cause) {\n        try {\n            Response response = cause.getResponse();\n            // \u3053\u3053\u3067\u4f55\u304b\u3059\u308b\n        } catch (Exception e) {\n            //\n        }\n        return cause;\n    }\n}\n```\n\n#4. \u901a\u4fe1\u6642\u9593\u3092\u8a08\u6e2c\u3057\u305f\u3044\n\u521d\u671f\u5316\u6642\u306b\u3001`setProfiler`\u3067\u72ec\u81ea\u306eProfiler\u30af\u30e9\u30b9\u3092\u30bb\u30c3\u30c8\u3057\u307e\u3059\u3002\n\n```java\npublic static final ApiService API = new RestAdapter.Builder()\n            .setEndpoint(\"\")\n            .setProfiler(new CustomProfiler())\n            .build()\n            .create(ApiService.class);\n```\n\n```java\npublic class CustomProfiler implements Profiler {\n    @Override\n    public Object beforeCall() {\n        // afterCall\u306b\u6e21\u3057\u305f\u3044\u30c7\u30fc\u30bf\u304c\u3042\u308c\u3070\u3053\u3053\u3067\u8fd4\u3059\n        return null;\n    }\n\n    @Override\n    public void afterCall(RequestInformation requestInfo, long elapsedTime,\n                          int statusCode, Object beforeCallData) {\n        try {\n            // \u3053\u3053\u3067\u4f55\u304b\u3059\u308b\u3002beforeCallData\u306b\u306f\u3001beforeCall()\u3067\u8fd4\u3055\u308c\u305fObject\u304c\u5165\u308b\n        } catch (Exception e) {\n            //\n        }\n    }\n}\n```\n"}