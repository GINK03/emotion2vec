{"context": "\n\n\u7d4c\u7def\ndatastore\u304b\u3089exporter\u3067RDB\u306b\u30c7\u30fc\u30bf\u79fb\u884c\u3002\n\u305d\u306e\u969b\u306bdatastore\u306e\u8a72\u5f53\u306ekind\u304b\u3089\u79fb\u884c\u5148\u306eDB\u306e\u30c6\u30fc\u30d6\u30eb\u306b\u540c\u3058\u30ec\u30b3\u30fc\u30c9\u6570\u304c\u79fb\u884c\u3067\u304d\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u305f\u3044\u3002\n\n\u554f\u984c\nGAE datastore\u3092\u53c2\u7167\u3059\u308bdatastoreView\u3067\u306fselect count(*) ...\u304c\u51fa\u6765\u306a\u3044\n\n\u5bfe\u5fdc\u65b9\u6cd5\ndatastoreView\u3067\u8868\u793a\u3055\u308c\u308b\u30c7\u30fc\u30bf\u3092\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0\u3057\u3066\u30ab\u30a6\u30f3\u30c8\n\n\u9762\u5012\u3060\u3063\u305f\u3053\u3068\n\n\u73fe\u72b6\u306edatastoreView\u306f\u30c7\u30fc\u30bf\u3092\u975e\u540c\u671f\u3067\u8aad\u307f\u8fbc\u3093\u3067\u3044\u308b\u306e\u3067\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0\u304c\u56f0\u96e3\n\u53e4\u3044datastoreView\u3067\u30d1\u30e9\u30fc\u30e1\u30fc\u30bf\u306blimit\u3068offset\u3092\u6e21\u3057\u306a\u304c\u3089\u30da\u30fc\u30b8\u9077\u79fb\u3057\u3066\u30ab\u30a6\u30f3\u30c8\u3057\u3066\u3044\u3063\u305f\u3002\n\u3057\u304b\u3082limit\u306f200\u304c\u4e0a\u9650...\n\n\n\u65e7datastoreView\nhttps://appengine.google.com/datastore/explorer?app_id=\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3ID\u540d&namespace=NameSpace\u540d&kind=kind\u540d\n\n\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0\u306e\u30b5\u30f3\u30d7\u30eb\ngoogle\u306e\u30ed\u30b0\u30a4\u30f3\u306fE\u30e1\u30fc\u30eb\u5165\u529b\u3057\u3066\u304b\u3089\u9077\u79fb\u3057\u3066\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u529b\u306e\uff12\u6bb5\u968e\u306b\u306a\u308b\u3002\nMechanize\u3067\u5bfe\u5fdc\u3059\u308b\u306b\u3082\u3061\u3087\u3063\u3068\u9762\u5012\n\nsample.rb\n  agent = Mechanize.new\n  # \u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u306a\u3044\u6642\u306b\u65e7DataStore\u306eURL\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u305f\u5148\u306bURL\n  agent.get 'https://accounts.google.com/ServiceLogin?service=ah&passive=true&continue=XXXXXXXXXXX'\n\n  form = agent.page.forms.find {|f| f.form_node['id'] == \"gaia_loginform\"}\n\n  form.field_with(:id => \"Email\").value = 'google\u306e\u30a2\u30ab\u30a6\u30f3\u30c8'\n\n  form.click_button\n  form = agent.page.forms.find {|f| f.form_node['id'] == \"gaia_loginform\"}\n\n  form.field_with(:name => \"Passwd\").value = 'google\u306e\u30d1\u30b9\u30ef\u30fc\u30c9'\n\n  form.click_button\n\n  limit_count   = 200\n  offset_count  = 0\n\n  begin\n    # \u53d6\u5f97\u3057\u305f\u3044DataStore\u306ekind\u3084namespace\u3092\u6307\u5b9a\u3057\u305fURL\n    page = agent.get(\"https://appengine.google.com/datastore/explorer?\uff1c\u307b\u3052\u307b\u3052\uff1e+where+type+%3D+%2710%27&limit=#{limit_count}&offset=#{offset_count}\").content.toutf8\n    doc = Nokogiri::HTML.parse(page)\n    result = doc.xpath(\"//table/tbody/tr\").count\n    offset_count += limit_count\n    puts \"result:#{result}\"\n  end while result == limit_count\n\n  amount = limit_count * (page_count - 1) + result\n  puts \"amount:#{amount}\nend\n\n\n\n## \u7d4c\u7def\ndatastore\u304b\u3089exporter\u3067RDB\u306b\u30c7\u30fc\u30bf\u79fb\u884c\u3002\n\u305d\u306e\u969b\u306bdatastore\u306e\u8a72\u5f53\u306ekind\u304b\u3089\u79fb\u884c\u5148\u306eDB\u306e\u30c6\u30fc\u30d6\u30eb\u306b\u540c\u3058\u30ec\u30b3\u30fc\u30c9\u6570\u304c\u79fb\u884c\u3067\u304d\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u305f\u3044\u3002\n\n## \u554f\u984c\nGAE datastore\u3092\u53c2\u7167\u3059\u308bdatastoreView\u3067\u306fselect count(*) ...\u304c\u51fa\u6765\u306a\u3044\n\n## \u5bfe\u5fdc\u65b9\u6cd5\ndatastoreView\u3067\u8868\u793a\u3055\u308c\u308b\u30c7\u30fc\u30bf\u3092\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0\u3057\u3066\u30ab\u30a6\u30f3\u30c8\n\n## \u9762\u5012\u3060\u3063\u305f\u3053\u3068\n* \u73fe\u72b6\u306edatastoreView\u306f\u30c7\u30fc\u30bf\u3092\u975e\u540c\u671f\u3067\u8aad\u307f\u8fbc\u3093\u3067\u3044\u308b\u306e\u3067\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0\u304c\u56f0\u96e3\n* \u53e4\u3044datastoreView\u3067\u30d1\u30e9\u30fc\u30e1\u30fc\u30bf\u306blimit\u3068offset\u3092\u6e21\u3057\u306a\u304c\u3089\u30da\u30fc\u30b8\u9077\u79fb\u3057\u3066\u30ab\u30a6\u30f3\u30c8\u3057\u3066\u3044\u3063\u305f\u3002  \n\u3057\u304b\u3082limit\u306f200\u304c\u4e0a\u9650...\n\n#### \u65e7datastoreView\nhttps://appengine.google.com/datastore/explorer?app_id=\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3ID\u540d&namespace=NameSpace\u540d&kind=kind\u540d\n\n## \u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0\u306e\u30b5\u30f3\u30d7\u30eb\n\ngoogle\u306e\u30ed\u30b0\u30a4\u30f3\u306fE\u30e1\u30fc\u30eb\u5165\u529b\u3057\u3066\u304b\u3089\u9077\u79fb\u3057\u3066\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u529b\u306e\uff12\u6bb5\u968e\u306b\u306a\u308b\u3002\nMechanize\u3067\u5bfe\u5fdc\u3059\u308b\u306b\u3082\u3061\u3087\u3063\u3068\u9762\u5012\n\n```sample.rb\n  agent = Mechanize.new\n  # \u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u306a\u3044\u6642\u306b\u65e7DataStore\u306eURL\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u305f\u5148\u306bURL\n  agent.get 'https://accounts.google.com/ServiceLogin?service=ah&passive=true&continue=XXXXXXXXXXX'\n\n  form = agent.page.forms.find {|f| f.form_node['id'] == \"gaia_loginform\"}\n\n  form.field_with(:id => \"Email\").value = 'google\u306e\u30a2\u30ab\u30a6\u30f3\u30c8'\n\n  form.click_button\n  form = agent.page.forms.find {|f| f.form_node['id'] == \"gaia_loginform\"}\n\n  form.field_with(:name => \"Passwd\").value = 'google\u306e\u30d1\u30b9\u30ef\u30fc\u30c9'\n\n  form.click_button\n\n  limit_count   = 200\n  offset_count  = 0\n\n  begin\n    # \u53d6\u5f97\u3057\u305f\u3044DataStore\u306ekind\u3084namespace\u3092\u6307\u5b9a\u3057\u305fURL\n    page = agent.get(\"https://appengine.google.com/datastore/explorer?\uff1c\u307b\u3052\u307b\u3052\uff1e+where+type+%3D+%2710%27&limit=#{limit_count}&offset=#{offset_count}\").content.toutf8\n    doc = Nokogiri::HTML.parse(page)\n    result = doc.xpath(\"//table/tbody/tr\").count\n    offset_count += limit_count\n    puts \"result:#{result}\"\n  end while result == limit_count\n\n  amount = limit_count * (page_count - 1) + result\n  puts \"amount:#{amount}\nend\n```\n", "tags": ["Ruby", "Nokogiri", "Mechanize", "GAE"]}