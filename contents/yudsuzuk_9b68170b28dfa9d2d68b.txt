{"tags": ["Finance", "Python", "pandas"], "context": "\u6b86\u3069\u306e\u6295\u8cc7\u5bb6\u304c\u682a\u5f0f\u5e02\u5834\u304b\u3089\u9000\u5834\u3055\u305b\u3089\u308c\u308b\u7406\u7531\u306e\u4e00\u3064\u306b\u30ea\u30b9\u30af\u7ba1\u7406\u304c\u51fa\u6765\u306a\u3044\u3053\u3068\u304c\u6319\u3052\u3089\u308c\u307e\u3059\u3002\n\u8cb7\u3063\u305f\u77ac\u9593\u304b\u3089\u682a\u4fa1\u304c\u4e0b\u304c\u308a\u59cb\u3081\u3001\u3044\u3064\u304b\u306f\u4e0a\u304c\u308b\u3060\u308d\u3046\u3068\u697d\u89b3\u7684\u306b\u601d\u3063\u3066\u3044\u3066\u3082\u3001\u3069\u3093\u3069\u3093\u4e0b\u304c\u308a\u7d9a\u3051\u3001\u5869\u6f2c\u3051\u3057\u3066\u3057\u307e\u3046\u3002\u640d\u5207\u308a\u30e9\u30a4\u30f3\u3092\u6c7a\u3081\u3066\u3044\u306a\u3044\u3068\u8d77\u3053\u308a\u3046\u308b\u554f\u984c\u3067\u3059\u3002\n\nValue at Risk(VaR)\u3067\u30ea\u30b9\u30af\u7ba1\u7406\u3057\u3088\u3046\n\nValue at Risk\u3068\u306f\u30ea\u30b9\u30af\u5206\u6790\u306e\u624b\u6cd5\u306e\u4e00\u3064\u3067\u3001\u3042\u308b\u671f\u9593\u306b\u4f55%\u306e\u78ba\u7387\u3067\u3069\u306e\u3050\u3089\u3044\u8cc7\u7523\u304c\u6e1b\u3063\u3066\u3057\u307e\u3046\u53ef\u80fd\u6027\u304c\u3042\u308b\u304b\u3092\u898b\u7a4d\u3082\u308a\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u671f\u9593100\u65e5\u306b\u3064\u3044\u3066\u4fe1\u983c\u6c34\u6e9699%\u3067VaR\u304c5\u5104\u5186\u3067\u3042\u308b\u3068\u306f\n\n100\u65e5\u9593\u306b\u308f\u305f\u308a\u3001\u8a55\u4fa1\u640d\u306f99%\u306e\u78ba\u7387\u3067\u6700\u59275\u5104\u5186\u306b\u304a\u3055\u307e\u308b\u3002\n\u305f\u3060\u3057100 - 99 = 1%\u306e\u78ba\u7387\u30675\u5104\u5186\u4ee5\u4e0a\u306e\u640d\u5931\u3068\u306a\u308b\u3002\n\n\u3068\u3044\u3046\u3082\u306e\u3067\u3059\u3002\n\u3053\u306eVaR\u304c\u308f\u304b\u308c\u3070\u3001 \u300c\u3053\u306e\u9298\u67c4\u306b\u6295\u8cc7\u3059\u308c\u3070\u3001\u3053\u306e\u671f\u9593\u3044\u304f\u3089\u4e0b\u304c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u306e\u3067\u3001\u3053\u306e\u3050\u3089\u3044\u4e0b\u304c\u3063\u305f\u3089\u640d\u5207\u308a\u3057\u3088\u3046\u300d\u3068\u3001\u640d\u5207\u308a\u30e9\u30a4\u30f3\u3092\u6c7a\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u3001\u5727\u5012\u7684\u306b\u30ea\u30b9\u30af\u7ba1\u7406\u3057\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u3002\n\n\u5e7e\u4f55\u30d6\u30e9\u30a6\u30f3\u904b\u52d5\u30e2\u30c7\u30eb\u3068\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u6cd5\u3067VaR\u3092\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3059\u308b\n\n\u5e7e\u4f55\u30d6\u30e9\u30a6\u30f3\u904b\u52d5\u30e2\u30c7\u30eb\u3068\u306f\n\u682a\u4fa1\u4e88\u6e2c\u306b\u304a\u3044\u3066\u3001\u3053\u308c\u307e\u3067\u306e\u4fa1\u683c\u3068\u3068\u308a\u5f97\u308b\u5024\u306e\u7bc4\u56f2\u3067\u30e2\u30c7\u30eb\u5316\u3059\u308b\u624b\u6cd5\u306e\u4e00\u3064\u306b\u5e7e\u4f55\u30d6\u30e9\u30a6\u30f3\u904b\u52d5\u30e2\u30c7\u30eb\u304c\u3042\u308a\u307e\u3059\u3002\n\u5e7e\u4f55\u30d6\u30e9\u30a6\u30f3\u904b\u52d5\u30e2\u30c7\u30eb (geometric Brownian motion (GBM))\u306f\u3001\u30a4\u30ae\u30ea\u30b9\u306e\u690d\u7269\u5b66\u8005\u30ed\u30d0\u30fc\u30c8\u30fb\u30d6\u30e9\u30a6\u30f3\u304c\u8003\u6848\u3057\u305f\u30e2\u30c7\u30eb\u3067\u3001\u6c34\u306b\u6d6e\u304b\u3079\u305f\u82b1\u7c89\u306e\u5fae\u7c92\u5b50\u304c\u3001\u307e\u308b\u3067\u751f\u304d\u7269\u306e\u3088\u3046\u306b\u9707\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u304b\u3089\u540d\u4ed8\u3051\u3089\u308c\u307e\u3057\u305f\u3002\u6c34\u306b\u6d6e\u3044\u305f\u82b1\u7c89\u306f\u3001\u4eca\u306e\u5834\u6240\u304b\u3089\u30e9\u30f3\u30c0\u30e0\u306b\u6b21\u306e\u5834\u6240\u306b\u79fb\u52d5\u3057\u307e\u3059\u3002\u3053\u306e\u3068\u304d\u3001\u5c11\u3057\u3057\u304b\u52d5\u304b\u306a\u3044\u3053\u3068\u3082\u3042\u308c\u3070\u3001\u304b\u306a\u308a\u306e\u8ddd\u96e2\u52d5\u304f\u3053\u3068\u3082\u3042\u308b\u3067\u3057\u3087\u3046\u3002\u3053\u308c\u306f\u30e9\u30f3\u30c0\u30e0\u306a\u73fe\u8c61\u3067\u3059\u304c\u3001\u79fb\u52d5\u8ddd\u96e2\u306f\u3053\u308c\u307e\u3067\u306e\u5e73\u5747\u7684\u306a\u79fb\u52d5\u8ddd\u96e2\u306b\u4f9d\u5b58\u3057\u307e\u3059\u3002\n\u5e7e\u4f55\u30d6\u30e9\u30a6\u30f3\u904b\u52d5\u30e2\u30c7\u30eb\u3067\u682a\u4fa1\u306e\u30e2\u30c7\u30eb\u306b\u4f7f\u308f\u308c\u308b\u5f0f\u304c\u4ee5\u4e0b\u306b\u306a\u308a\u307e\u3059\u3002\n\\begin{aligned}\n\\Delta S = S(\u03bc\\Delta t + \\sigma \\varepsilon \\sqrt{\\Delta t  })\n\\end{aligned}\n{\\begin{aligned}\n\\Delta S = S(\u03bc\\Delta t + \\sigma \\varepsilon \\sqrt{\\Delta t  })\n\\end{aligned}\n}{\\begin{aligned}\n\\Delta S = S(\u03bc\\Delta t + \\sigma \\varepsilon \\sqrt{\\Delta t  })\n\\end{aligned}\n}\nS: \u682a\u4fa1\n\u03bc: \u5e73\u5747\u7684\u306a\u5909\u52d5\u306e\u5024\n\u03c3: \u6a19\u6e96\u504f\u5dee\n\u0394t: \u6642\u9593\u306e\u9593\u9694\n\u03b5: \u30e9\u30f3\u30c0\u30e0\u306a\u5024\n\u53f3\u8fba\u306e\u6700\u521d\u306e\u9805\u306f\u30c9\u30ea\u30d5\u30c8\uff08drift\uff09\u3001\uff12\u3064\u76ee\u306e\u9805\u306f\u30b7\u30e7\u30c3\u30af\uff08shock\uff09\u3068\u547c\u3070\u308c\u307e\u3059\u3002\n\u03b5\u306f\u30e9\u30f3\u30c0\u30e0\u306a\u5024\u306a\u306e\u3067\u3001\u3053\u306e\u30e2\u30c7\u30eb\u3092\u4f7f\u3063\u3066\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3059\u308b\u306b\u306f\u30e9\u30f3\u30c0\u30e0\u5024\u3092\u767a\u751f\u3055\u305b\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30e9\u30f3\u30c0\u30e0\u5024\u3092\u767a\u751f\u3055\u305b\u308b\u305f\u3081\u306b\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u6cd5\u3068\u3044\u3046\u624b\u6cd5\u3092\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\n\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u6cd5\u306b\u3064\u3044\u3066\u306f\u4e0b\u8a18\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nhttps://unit.aist.go.jp/diversity/ja/jst/teens/montecarlo.htm\n\nGoogle\u793e\u306e\u682a\u4fa1\u3092\u4f7f\u3063\u3066VaR\u3092\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3057\u3066\u307f\u308b\n\u3067\u306fGoogle\u793e\u306e\u682a\u4fa1\u3092\u4f7f\u3063\u3066VaR\u3092\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u3053\u3053\u3067\u306fPython3\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\nGoogle\u306e\u682a\u4fa1\u3092\u53d6\u5f97\npandas\u306eDataReader\u3092\u4f7f\u3046\u3068\u7c21\u5358\u306b\u682a\u4fa1\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\nhttp://pandas.pydata.org/pandas-docs/stable/remote_data.html\n\u4eca\u56de\u306fYahoo! Inc\u304c\u63d0\u4f9b\u3057\u3066\u3044\u308b\u682a\u4fa1\u30c7\u30fc\u30bf\u3092\u4f7f\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\nimport pandas as pd\nfrom pandas import Series,DataFrame\nimport numpy as np\n\n# \u53ef\u8996\u5316\u7528\u30bb\u30c3\u30c8\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set_style('whitegrid')\n%matplotlib inline\n\n# Yahoo! Inc\u304b\u3089\u30d5\u30a1\u30a4\u30ca\u30f3\u30b9\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\nfrom pandas.io.data import DataReader\n\n# Python\u3067\u65e5\u4ed8\u3068\u6642\u523b\u3092\u6271\u3046\u305f\u3081\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\nfrom datetime import datetime\n\n# \u76f4\u8fd1\u306e3\u5e74\u306e\u30c7\u30fc\u30bf\u3092\u4f7f\u7528\nend = datetime.now()\nstart = datetime(end.year - 3,end.month,end.day)\n\n# Yahoo! Inc\u304b\u3089Google\u306e\u682a\u4fa1\u3092\u53d6\u5f97\nclosing_df = DataReader(['GOOG'],'yahoo',start,end)['Adj Close']\n\n# \u53d6\u5f97\u3057\u305f\u682a\u4fa1\u3092\u8868\u793a\nclosing_df['GOOG'].head()\n\n\n\nOpen : \u59cb\u5024\nHigh : \u9ad8\u5024\nLow : \u5b89\u5024\nClose : \u7d42\u5024\nVolume: \u51fa\u6765\u9ad8\nAdj Close : \u8abf\u6574\u5f8c\u7d42\u5024\n\n\nGoogle\u793e\u306e\u682a\u4fa1\u3092\u4f7f\u3063\u3066\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u3092\u4f7f\u3063\u3066\u307f\u308b\n\n\u524d\u6e96\u5099\nrets = closing_df.pct_change().dropna()\n\n# 3\u5e74\u3092\u57fa\u6e96\u306b\u3059\u308b\ndays = 365 * 3\n\n# 1\u65e5\u5206\u306e\u5dee\u5206\ndt = 1/days\n\n# \u65e5\u3005\u306e\u5909\u52d5\u306e\u5e73\u5747\nmu = rets.mean()['GOOG']\n\n# \u30dc\u30e9\u30c6\u30a3\u30ea\u30c6\u30a3\u3092\u5909\u52d5\u306e\u6a19\u6e96\u504f\u5dee\u3067\u8a08\u7b97\nsigma = rets.std()['GOOG']\n\n\n\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u6cd5\u3092\u884c\u3046\u95a2\u6570\n\u6700\u521d\u306e\u4fa1\u683c\u3001\u65e5\u6570\u3001\u5e73\u5747\u3001\u30dc\u30e9\u30c6\u30a3\u30ea\u30c6\u30a3\u3092\u4f7f\u7528\u3057\u3066\u3001\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u6cd5\u3092\u884c\u3046\u95a2\u6570\u3092\u4f5c\u308a\u307e\u3059\u3002\ndef stock_monte_carlo(start_price,days,mu,sigma):    \n    price = np.zeros(days)\n    price[0] = start_price\n    shock = np.zeros(days)\n    drift = np.zeros(days)\n\n    # \u5e7e\u4f55\u30d6\u30e9\u30a6\u30f3\u904b\u52d5\u30e2\u30c7\u30eb\u306b\u5f93\u3063\u3066shock\u3068Drift\u3092\u8a08\u7b97\n    for x in range(1,days):\n        shock[x] = np.random.normal(loc=mu * dt, scale=sigma * np.sqrt(dt))\n        drift[x] = mu * dt\n        price[x] = price[x-1] + (price[x-1] * (drift[x] + shock[x]))\n\n    return price\n\n\u3067\u306f5\u56de\u682a\u4fa1\u3092\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3057\u3066\u307f\u307e\u3059\u3002\nstart_price = DataReader('GOOG','yahoo',start,end).iloc[0,5]\n\nfor run in range(5):\n    plt.plot(stock_monte_carlo(start_price,days,mu,sigma))\nplt.xlabel(\"Days\")\nplt.ylabel(\"Price\")  \nplt.title('Monte Carlo Analysis for Google')\n\n\n\u682a\u4fa1\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\u3067\u306f5\u56de\u3067\u306f\u306a\u304f1\u4e07\u56de\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u305d\u306e\u7d50\u679c\u3092\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u306b\u3057\u3066\u307f\u307e\u3059\u3002\nruns = 10000\n\nsimulations = np.zeros(runs)\n\nnp.set_printoptions(threshold=5)\n\nfor run in range(runs):    \n    simulations[run] = stock_monte_carlo(start_price,days,mu,sigma)[days-1];\n\nplt.hist(simulations,bins=200)\n\n\n\u3067\u304d\u307e\u3057\u305f\u3002\n\u3067\u306fVaR\u3092\u898b\u7a4d\u3082\u3063\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\nplt.hist(simulations,bins=200)\n\n# 1\u30d1\u30fc\u30bb\u30f3\u30bf\u30a4\u30eb\u306e\u4f4d\u7f6e\u8a2d\u5b9a\nq = np.percentile(simulations, 1)\n\n# \u30d7\u30ed\u30c3\u30c8\u7528\u2193\n\n# \u6700\u521d\u306e\u682a\u4fa1\nplt.figtext(0.6, 0.8, s=\"Start price: {:0.2f}\".format(start_price))\n\n# \u6700\u7d42\u7684\u306a\u682a\u4fa1\u306e\u5e73\u5747\u5024\nplt.figtext(0.6, 0.7, \"Mean final price: {:0.2f}\".format(simulations.mean()))\n\n# Value at Risk (\u4fe1\u983c\u533a\u959399%\uff09\nplt.figtext(0.6, 0.6, \"VaR(0.99): {:0.2f}\".format(start_price - q))\n\n# 1\u30d1\u30fc\u30bb\u30f3\u30bf\u30a4\u30eb\nplt.figtext(0.15, 0.6, \"q(0.99): {:0.2f}\".format(q))\n\n# 1% \u30af\u30a9\u30f3\u30bf\u30a4\u30eb\u306b\u8d64\u7dda\u3092\u63cf\u753b\nplt.axvline(x=q, linewidth=4, color='r')\n\n\n\u3053\u308c\u3067Google\u793e\u306e\u682a\u4fa1\u306eVaR\u3092\u8a08\u7b97\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3057\u305f\uff01\uff01\n\u3053\u308c\u306b\u3088\u3063\u3066510.25\u30c9\u30eb\u304b\u308999%\u306e\u78ba\u7387\u3067\u6700\u5927\u3067\u4e0b\u304c\u308b\u53ef\u80fd\u6027\u304c493.40\u30c9\u30eb\u3068\u3044\u3046\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\n493.40\u30c9\u30eb\u3092\u5272\u3063\u305f\u3089\u306a\u306b\u304b\u304a\u304b\u3057\u3044\u3053\u3068\u304c\u8d77\u304d\u3066\u3044\u308b\u306e\u3067\u3001\u5fc5\u305a\u640d\u5207\u308a\u3057\u307e\u3057\u3087\u3046\u3002\n\u53c2\u8003\nhttps://ja.m.wikipedia.org/wiki/\u5e7e\u4f55\u30d6\u30e9\u30a6\u30f3\u904b\u52d5\nhttps://www.udemy.com/python-jp/learn/v4/\n\n\u6b86\u3069\u306e\u6295\u8cc7\u5bb6\u304c\u682a\u5f0f\u5e02\u5834\u304b\u3089\u9000\u5834\u3055\u305b\u3089\u308c\u308b\u7406\u7531\u306e\u4e00\u3064\u306b\u30ea\u30b9\u30af\u7ba1\u7406\u304c\u51fa\u6765\u306a\u3044\u3053\u3068\u304c\u6319\u3052\u3089\u308c\u307e\u3059\u3002\n\u8cb7\u3063\u305f\u77ac\u9593\u304b\u3089\u682a\u4fa1\u304c\u4e0b\u304c\u308a\u59cb\u3081\u3001\u3044\u3064\u304b\u306f\u4e0a\u304c\u308b\u3060\u308d\u3046\u3068\u697d\u89b3\u7684\u306b\u601d\u3063\u3066\u3044\u3066\u3082\u3001\u3069\u3093\u3069\u3093\u4e0b\u304c\u308a\u7d9a\u3051\u3001\u5869\u6f2c\u3051\u3057\u3066\u3057\u307e\u3046\u3002\u640d\u5207\u308a\u30e9\u30a4\u30f3\u3092\u6c7a\u3081\u3066\u3044\u306a\u3044\u3068\u8d77\u3053\u308a\u3046\u308b\u554f\u984c\u3067\u3059\u3002\n\n### Value at Risk(VaR)\u3067\u30ea\u30b9\u30af\u7ba1\u7406\u3057\u3088\u3046\n![VaR_ja.JPG](https://qiita-image-store.s3.amazonaws.com/0/3962/9043340f-f99f-50e9-6b45-4007d7b86d68.jpeg \"VaR_ja.JPG\")\n\nValue at Risk\u3068\u306f\u30ea\u30b9\u30af\u5206\u6790\u306e\u624b\u6cd5\u306e\u4e00\u3064\u3067\u3001\u3042\u308b\u671f\u9593\u306b\u4f55%\u306e\u78ba\u7387\u3067\u3069\u306e\u3050\u3089\u3044\u8cc7\u7523\u304c\u6e1b\u3063\u3066\u3057\u307e\u3046\u53ef\u80fd\u6027\u304c\u3042\u308b\u304b\u3092\u898b\u7a4d\u3082\u308a\u307e\u3059\u3002\n\n\u4f8b\u3048\u3070\u671f\u9593100\u65e5\u306b\u3064\u3044\u3066\u4fe1\u983c\u6c34\u6e9699%\u3067VaR\u304c5\u5104\u5186\u3067\u3042\u308b\u3068\u306f\n\n- 100\u65e5\u9593\u306b\u308f\u305f\u308a\u3001\u8a55\u4fa1\u640d\u306f99%\u306e\u78ba\u7387\u3067\u6700\u59275\u5104\u5186\u306b\u304a\u3055\u307e\u308b\u3002\n- \u305f\u3060\u3057100 - 99 = 1%\u306e\u78ba\u7387\u30675\u5104\u5186\u4ee5\u4e0a\u306e\u640d\u5931\u3068\u306a\u308b\u3002\n\n\u3068\u3044\u3046\u3082\u306e\u3067\u3059\u3002\n\n\u3053\u306eVaR\u304c\u308f\u304b\u308c\u3070\u3001 \u300c\u3053\u306e\u9298\u67c4\u306b\u6295\u8cc7\u3059\u308c\u3070\u3001\u3053\u306e\u671f\u9593\u3044\u304f\u3089\u4e0b\u304c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u306e\u3067\u3001\u3053\u306e\u3050\u3089\u3044\u4e0b\u304c\u3063\u305f\u3089\u640d\u5207\u308a\u3057\u3088\u3046\u300d\u3068\u3001\u640d\u5207\u308a\u30e9\u30a4\u30f3\u3092\u6c7a\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u3001\u5727\u5012\u7684\u306b\u30ea\u30b9\u30af\u7ba1\u7406\u3057\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u3002\n\n### \u5e7e\u4f55\u30d6\u30e9\u30a6\u30f3\u904b\u52d5\u30e2\u30c7\u30eb\u3068\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u6cd5\u3067VaR\u3092\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3059\u308b\n#### \u5e7e\u4f55\u30d6\u30e9\u30a6\u30f3\u904b\u52d5\u30e2\u30c7\u30eb\u3068\u306f\n\u682a\u4fa1\u4e88\u6e2c\u306b\u304a\u3044\u3066\u3001\u3053\u308c\u307e\u3067\u306e\u4fa1\u683c\u3068\u3068\u308a\u5f97\u308b\u5024\u306e\u7bc4\u56f2\u3067\u30e2\u30c7\u30eb\u5316\u3059\u308b\u624b\u6cd5\u306e\u4e00\u3064\u306b\u5e7e\u4f55\u30d6\u30e9\u30a6\u30f3\u904b\u52d5\u30e2\u30c7\u30eb\u304c\u3042\u308a\u307e\u3059\u3002\n\u5e7e\u4f55\u30d6\u30e9\u30a6\u30f3\u904b\u52d5\u30e2\u30c7\u30eb (geometric Brownian motion (GBM))\u306f\u3001\u30a4\u30ae\u30ea\u30b9\u306e\u690d\u7269\u5b66\u8005\u30ed\u30d0\u30fc\u30c8\u30fb\u30d6\u30e9\u30a6\u30f3\u304c\u8003\u6848\u3057\u305f\u30e2\u30c7\u30eb\u3067\u3001\u6c34\u306b\u6d6e\u304b\u3079\u305f\u82b1\u7c89\u306e\u5fae\u7c92\u5b50\u304c\u3001\u307e\u308b\u3067\u751f\u304d\u7269\u306e\u3088\u3046\u306b\u9707\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u304b\u3089\u540d\u4ed8\u3051\u3089\u308c\u307e\u3057\u305f\u3002\u6c34\u306b\u6d6e\u3044\u305f\u82b1\u7c89\u306f\u3001\u4eca\u306e\u5834\u6240\u304b\u3089\u30e9\u30f3\u30c0\u30e0\u306b\u6b21\u306e\u5834\u6240\u306b\u79fb\u52d5\u3057\u307e\u3059\u3002\u3053\u306e\u3068\u304d\u3001\u5c11\u3057\u3057\u304b\u52d5\u304b\u306a\u3044\u3053\u3068\u3082\u3042\u308c\u3070\u3001\u304b\u306a\u308a\u306e\u8ddd\u96e2\u52d5\u304f\u3053\u3068\u3082\u3042\u308b\u3067\u3057\u3087\u3046\u3002\u3053\u308c\u306f\u30e9\u30f3\u30c0\u30e0\u306a\u73fe\u8c61\u3067\u3059\u304c\u3001\u79fb\u52d5\u8ddd\u96e2\u306f\u3053\u308c\u307e\u3067\u306e\u5e73\u5747\u7684\u306a\u79fb\u52d5\u8ddd\u96e2\u306b\u4f9d\u5b58\u3057\u307e\u3059\u3002\n\n\u5e7e\u4f55\u30d6\u30e9\u30a6\u30f3\u904b\u52d5\u30e2\u30c7\u30eb\u3067\u682a\u4fa1\u306e\u30e2\u30c7\u30eb\u306b\u4f7f\u308f\u308c\u308b\u5f0f\u304c\u4ee5\u4e0b\u306b\u306a\u308a\u307e\u3059\u3002\n\n```math\n\\begin{aligned}\n\\Delta S = S(\u03bc\\Delta t + \\sigma \\varepsilon \\sqrt{\\Delta t  })\n\\end{aligned}\n```\n\nS: \u682a\u4fa1\n\u03bc: \u5e73\u5747\u7684\u306a\u5909\u52d5\u306e\u5024\n\u03c3: \u6a19\u6e96\u504f\u5dee\n\u0394t: \u6642\u9593\u306e\u9593\u9694\n\u03b5: \u30e9\u30f3\u30c0\u30e0\u306a\u5024\n\n\u53f3\u8fba\u306e\u6700\u521d\u306e\u9805\u306f\u30c9\u30ea\u30d5\u30c8\uff08drift\uff09\u3001\uff12\u3064\u76ee\u306e\u9805\u306f\u30b7\u30e7\u30c3\u30af\uff08shock\uff09\u3068\u547c\u3070\u308c\u307e\u3059\u3002\n\u03b5\u306f\u30e9\u30f3\u30c0\u30e0\u306a\u5024\u306a\u306e\u3067\u3001\u3053\u306e\u30e2\u30c7\u30eb\u3092\u4f7f\u3063\u3066\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3059\u308b\u306b\u306f\u30e9\u30f3\u30c0\u30e0\u5024\u3092\u767a\u751f\u3055\u305b\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30e9\u30f3\u30c0\u30e0\u5024\u3092\u767a\u751f\u3055\u305b\u308b\u305f\u3081\u306b\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u6cd5\u3068\u3044\u3046\u624b\u6cd5\u3092\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\n\n\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u6cd5\u306b\u3064\u3044\u3066\u306f\u4e0b\u8a18\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nhttps://unit.aist.go.jp/diversity/ja/jst/teens/montecarlo.htm\n\n### Google\u793e\u306e\u682a\u4fa1\u3092\u4f7f\u3063\u3066VaR\u3092\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3057\u3066\u307f\u308b\n\n\u3067\u306fGoogle\u793e\u306e\u682a\u4fa1\u3092\u4f7f\u3063\u3066VaR\u3092\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u3053\u3053\u3067\u306fPython3\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\n##### Google\u306e\u682a\u4fa1\u3092\u53d6\u5f97\npandas\u306eDataReader\u3092\u4f7f\u3046\u3068\u7c21\u5358\u306b\u682a\u4fa1\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\nhttp://pandas.pydata.org/pandas-docs/stable/remote_data.html\n\n\u4eca\u56de\u306fYahoo! Inc\u304c\u63d0\u4f9b\u3057\u3066\u3044\u308b\u682a\u4fa1\u30c7\u30fc\u30bf\u3092\u4f7f\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```ipython\nimport pandas as pd\nfrom pandas import Series,DataFrame\nimport numpy as np\n\n# \u53ef\u8996\u5316\u7528\u30bb\u30c3\u30c8\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nsns.set_style('whitegrid')\n%matplotlib inline\n\n# Yahoo! Inc\u304b\u3089\u30d5\u30a1\u30a4\u30ca\u30f3\u30b9\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\nfrom pandas.io.data import DataReader\n\n# Python\u3067\u65e5\u4ed8\u3068\u6642\u523b\u3092\u6271\u3046\u305f\u3081\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\nfrom datetime import datetime\n\n# \u76f4\u8fd1\u306e3\u5e74\u306e\u30c7\u30fc\u30bf\u3092\u4f7f\u7528\nend = datetime.now()\nstart = datetime(end.year - 3,end.month,end.day)\n\n# Yahoo! Inc\u304b\u3089Google\u306e\u682a\u4fa1\u3092\u53d6\u5f97\nclosing_df = DataReader(['GOOG'],'yahoo',start,end)['Adj Close']\n\n# \u53d6\u5f97\u3057\u305f\u682a\u4fa1\u3092\u8868\u793a\nclosing_df['GOOG'].head()\n```\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-11-05 11.12.32.png](https://qiita-image-store.s3.amazonaws.com/0/3962/46ac5050-c2bd-7151-571d-2bfd1151b9cd.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-11-05 11.12.32.png\")\n\n- Open : \u59cb\u5024\n- High : \u9ad8\u5024\n- Low : \u5b89\u5024\n- Close : \u7d42\u5024\n- Volume: \u51fa\u6765\u9ad8\n- Adj Close : \u8abf\u6574\u5f8c\u7d42\u5024\n\n#### Google\u793e\u306e\u682a\u4fa1\u3092\u4f7f\u3063\u3066\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u3092\u4f7f\u3063\u3066\u307f\u308b\n\n##### \u524d\u6e96\u5099\n\n```\nrets = closing_df.pct_change().dropna()\n\n# 3\u5e74\u3092\u57fa\u6e96\u306b\u3059\u308b\ndays = 365 * 3\n\n# 1\u65e5\u5206\u306e\u5dee\u5206\ndt = 1/days\n\n# \u65e5\u3005\u306e\u5909\u52d5\u306e\u5e73\u5747\nmu = rets.mean()['GOOG']\n\n# \u30dc\u30e9\u30c6\u30a3\u30ea\u30c6\u30a3\u3092\u5909\u52d5\u306e\u6a19\u6e96\u504f\u5dee\u3067\u8a08\u7b97\nsigma = rets.std()['GOOG']\n```\n\n##### \u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u6cd5\u3092\u884c\u3046\u95a2\u6570\n\n\u6700\u521d\u306e\u4fa1\u683c\u3001\u65e5\u6570\u3001\u5e73\u5747\u3001\u30dc\u30e9\u30c6\u30a3\u30ea\u30c6\u30a3\u3092\u4f7f\u7528\u3057\u3066\u3001\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u6cd5\u3092\u884c\u3046\u95a2\u6570\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n```\ndef stock_monte_carlo(start_price,days,mu,sigma):    \n    price = np.zeros(days)\n    price[0] = start_price\n    shock = np.zeros(days)\n    drift = np.zeros(days)\n    \n    # \u5e7e\u4f55\u30d6\u30e9\u30a6\u30f3\u904b\u52d5\u30e2\u30c7\u30eb\u306b\u5f93\u3063\u3066shock\u3068Drift\u3092\u8a08\u7b97\n    for x in range(1,days):\n    \tshock[x] = np.random.normal(loc=mu * dt, scale=sigma * np.sqrt(dt))\n        drift[x] = mu * dt\n        price[x] = price[x-1] + (price[x-1] * (drift[x] + shock[x]))\n        \n    return price\n```\n\n\u3067\u306f5\u56de\u682a\u4fa1\u3092\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\nstart_price = DataReader('GOOG','yahoo',start,end).iloc[0,5]\n\nfor run in range(5):\n    plt.plot(stock_monte_carlo(start_price,days,mu,sigma))\nplt.xlabel(\"Days\")\nplt.ylabel(\"Price\")  \nplt.title('Monte Carlo Analysis for Google')\n```\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-11-05 12.12.34.png](https://qiita-image-store.s3.amazonaws.com/0/3962/eac52ad3-f0ad-2e4a-33e7-f74ea3bf5909.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-11-05 12.12.34.png\")\n\n\u682a\u4fa1\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\u3067\u306f5\u56de\u3067\u306f\u306a\u304f1\u4e07\u56de\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u305d\u306e\u7d50\u679c\u3092\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u306b\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\nruns = 10000\n\nsimulations = np.zeros(runs)\n\nnp.set_printoptions(threshold=5)\n\nfor run in range(runs):    \n    simulations[run] = stock_monte_carlo(start_price,days,mu,sigma)[days-1];\n    \nplt.hist(simulations,bins=200)\n```\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-11-05 12.16.20.png](https://qiita-image-store.s3.amazonaws.com/0/3962/db5a24e5-6d47-fc05-68a4-985b1a581efc.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-11-05 12.16.20.png\")\n\n\u3067\u304d\u307e\u3057\u305f\u3002\n\u3067\u306fVaR\u3092\u898b\u7a4d\u3082\u3063\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n```\nplt.hist(simulations,bins=200)\n\n# 1\u30d1\u30fc\u30bb\u30f3\u30bf\u30a4\u30eb\u306e\u4f4d\u7f6e\u8a2d\u5b9a\nq = np.percentile(simulations, 1)\n\n# \u30d7\u30ed\u30c3\u30c8\u7528\u2193\n\n# \u6700\u521d\u306e\u682a\u4fa1\nplt.figtext(0.6, 0.8, s=\"Start price: {:0.2f}\".format(start_price))\n\n# \u6700\u7d42\u7684\u306a\u682a\u4fa1\u306e\u5e73\u5747\u5024\nplt.figtext(0.6, 0.7, \"Mean final price: {:0.2f}\".format(simulations.mean()))\n\n# Value at Risk (\u4fe1\u983c\u533a\u959399%\uff09\nplt.figtext(0.6, 0.6, \"VaR(0.99): {:0.2f}\".format(start_price - q))\n\n# 1\u30d1\u30fc\u30bb\u30f3\u30bf\u30a4\u30eb\nplt.figtext(0.15, 0.6, \"q(0.99): {:0.2f}\".format(q))\n\n# 1% \u30af\u30a9\u30f3\u30bf\u30a4\u30eb\u306b\u8d64\u7dda\u3092\u63cf\u753b\nplt.axvline(x=q, linewidth=4, color='r')\n```\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-11-05 12.19.13.png](https://qiita-image-store.s3.amazonaws.com/0/3962/6072e8ed-d226-507c-b43c-b5181b878a3d.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-11-05 12.19.13.png\")\n\n\u3053\u308c\u3067Google\u793e\u306e\u682a\u4fa1\u306eVaR\u3092\u8a08\u7b97\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3057\u305f\uff01\uff01\n\n\u3053\u308c\u306b\u3088\u3063\u3066510.25\u30c9\u30eb\u304b\u308999%\u306e\u78ba\u7387\u3067\u6700\u5927\u3067\u4e0b\u304c\u308b\u53ef\u80fd\u6027\u304c493.40\u30c9\u30eb\u3068\u3044\u3046\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\n493.40\u30c9\u30eb\u3092\u5272\u3063\u305f\u3089\u306a\u306b\u304b\u304a\u304b\u3057\u3044\u3053\u3068\u304c\u8d77\u304d\u3066\u3044\u308b\u306e\u3067\u3001\u5fc5\u305a\u640d\u5207\u308a\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u53c2\u8003\nhttps://ja.m.wikipedia.org/wiki/\u5e7e\u4f55\u30d6\u30e9\u30a6\u30f3\u904b\u52d5\nhttps://www.udemy.com/python-jp/learn/v4/\n\n\n\n\n"}