{"context": "PhantomJS Lambda Template\u306e\u958b\u767a\u8005\u304c phantomjs-lambda-pack  \u3092\u65b0\u3057\u304f\u30ea\u30ea\u30fc\u30b9\u3057\u3066\u3044\u305f\u306e\u3067\u3001\u3053\u308c\u3092\u4f7f\u3063\u3066Lambda\u4e0a\u3067PhantomJS\u3092\u52d5\u4f5c\u3055\u305b\u3066\u307f\u307e\u3059\u3002\n\n\u74b0\u5883\u69cb\u7bc9\u3068\u521d\u671f\u8a2d\u5b9a\n$ mkdir lambda-phantomjs && cd  lambda-phantomjs\n$ npm init\n$ npm install phantomjs-lambda-pack --save\n\nindex.js\u306fREADME.md \u306eusage\u306b\u66f8\u304b\u308c\u3066\u3044\u308b\u5185\u5bb9\u3067\u307e\u305a\u306f\u8a66\u3057\u307e\u3059\u3002\n% cat index.js \n'use strict';\nconst phantomjsLambdaPack = require('phantomjs-lambda-pack');\nconst exec = phantomjsLambdaPack.exec;\n\nexports.handler = (event, context, callback) => {\n    exec('-v', (error, stdout, stderr) => {\n        if (error) {\n            console.error(`exec error: ${error}`);\n            return;\n        }\n\n        console.log(`phantom version: ${stdout}`);\n        console.log(`Should have no error: ${stderr}`);\n\n        callback(error, 'fin!!');\n    });\n};\n\n\nLambda Function\u306e\u8a2d\u5b9a\u3068\u5b9f\u884c\nFunction Package\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u3089\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\uff08\u4f7f\u7528\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u3001Code entry type\u3067\u3001\u300eUpload a .ZIP file\u300f\u3092\u9078\u629e\u3057\u3066\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u30b5\u30a4\u30ba(10MB\u4ee5\u4e0b\uff09\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\uff09\n\n\n\n\u8a2d\u5b9a\u9805\u76ee\n\u8a2d\u5b9a\u5024\n\n\n\n\nRuntime\nNode.js 4.3\n\n\nHandler\nlambda-phantomjs/index.handler\n\n\nMemory(MB)\n1024\n\n\nTimeout\n5 min\n\n\n\n\u521d\u56de\u5b9f\u884c\u6642\u306f 1min \u3060\u3068 Timeout \u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\u306e\u3067\u30015min \u3068\u3057\u3066\u3044\u307e\u3059\u3002\n\u5b9f\u884c\u7d50\u679c\u3092\u898b\u308b\u30682\u5206\u3050\u3089\u3044\u3092\u898b\u3066\u304a\u3051\u3070\u5927\u4e08\u592b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\uff082\u56de\u76ee\u4ee5\u964d\u306e\u5b9f\u884c\u6642\u306f 4000 ms \u524d\u5f8c\u3050\u3089\u3044\u3067\u5b89\u5b9a\u3057\u307e\u3059\u3002\uff09\n\n\u5b9f\u884c\u7d50\u679c\nLog output \u3092\u78ba\u8a8d\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9f\u884c\u3055\u308c\u305f\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n2016-11-24T10:02:46.845Z    f39f30db-b22c-11e6-94f0-653737dc93be    exec phantom:  -v\n2016-11-24T10:02:47.105Z    f39f30db-b22c-11e6-94f0-653737dc93be    phantom version: 2.1.1\n\n2016-11-24T10:02:47.105Z    f39f30db-b22c-11e6-94f0-653737dc93be    Should have no error: \nEND RequestId: f39f30db-b22c-11e6-94f0-653737dc93be\nREPORT RequestId: f39f30db-b22c-11e6-94f0-653737dc93be  Duration: 75160.69 ms   Billed Duration: 75200 ms   Memory Size: 1024 MB    Max Memory Used: 401 MB PhantomJS\n\nphantomjs-lambda-pack \u3092\u4f7f\u3046\u3068 PhantomJS \u306e 2.1.1 \u304c\u4f7f\u308f\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\u5185\u90e8\u3067\u306f phantomjs-prebuilt \u304c\u4f7f\u308f\u308c\u3066\u3044\u308b\u306e\u3067\u3001phantomjs-prebuilt \u304c\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u306e PhantomJS \u304c\u4f7f\u308f\u308c\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u5b9f\u969b\u306bPhantomJS\u3092\u4f7f\u3063\u3066Scraping\nGoogle\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066Page\u306eTitle\u3092\u53d6\u5f97\u3001\u304a\u3088\u3073\u8868\u793a\u3057\u305f\u30da\u30fc\u30b8\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092S3\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u307f\u307e\u3059\u3002\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3067\u3059\u3002\nindex.js \u3068\u540c\u3058\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u968e\u5c64\u306b phantomjs-script.js \u3068\u3044\u3046\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u3066\u3044\u307e\u3059\u3002\n.\n\u251c\u2500\u2500 index.js\n\u251c\u2500\u2500 node_modules\n\u2502   \u251c\u2500\u2500 aws-sdk\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 phantomjs-lambda-pack\n\u2502\n\u251c\u2500\u2500 package.json\n\u2514\u2500\u2500 phantomjs-script.js\n\n\u4e8b\u524d\u306b aws-sdk \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304a\u3088\u3073\u3001Lambda\u306e\u5b9f\u884c\u30ed\u30fc\u30eb\u306bS3 \u3078\u306e\u66f8\u304d\u8fbc\u307f\u6a29\u9650\u3092\u4ed8\u4e0e\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nhandler \u306e\u4e2d\u3067 phantomjs-script.js \u3092\u547c\u3073\u51fa\u3057\u3066\u3044\u307e\u3059\u3002\n\nindex.js\n'use strict';\nconst phantomjsLambdaPack = require('phantomjs-lambda-pack');\nconst exec = phantomjsLambdaPack.exec;\nconst path = require('path');\nconst fs = require('fs');\nconst AWS = require('aws-sdk');\nAWS.config.region = 'ap-northeast-1';\n\nexports.handler = (event, context, callback) => {\n    const scriptPath = path.join(__dirname, 'phantomjs-script.js');\n    exec(scriptPath, (error, stdout, stderr) => {\n        if (error) {\n            console.error(`exec error: ${error}`);\n            return;\n        }\n\n        console.log(`Result: ${stdout}`);\n        console.log(`Should have no error: ${stderr}`);\n\n       // \u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092S3\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\n       const tmp_file_path = path.join(__dirname, 'google.png');\n       const params = {Bucket: 'bucketName', Key: 'screen/google.png', Body: fs.createReadStream(tmp_file_path),};\n       new AWS.S3().upload(params, (error, data) => {\n           callback(error, 'fin!!');\n       });\n    })\n}\n\n\n\nphantomjs-script.js\n// headless\u30d6\u30e9\u30a6\u30b6\u3092\u4f5c\u6210\nvar page = require('webpage').create();\npage.settings.userAgent = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/44.0.2403.157 Safari/537.36';\npage.settings.javascriptEnabled = true;\npage.settings.loadImages = false;//Script is much faster with this field set to false\nphantom.cookiesEnabled = true;\nphantom.javascriptEnabled = true;\n\n//URL\u3092\u958b\u304f\npage.open('http://www.google.com', function(status) {\n  //\u30d6\u30e9\u30a6\u30b6\u5185\u3067JS\u3092\u4ecb\u3057\u3066\u30c7\u30fc\u30bf\u3092\u53d6\u5f97  \n  var title = page.evaluate(function() {\n    return document.title;\n  });\n  page.render('google.png');\n  console.log('Page title is ' + title);\n  phantom.exit();\n});\n\n\n\n\n\u5b9f\u884c\u7d50\u679c\u3068\u3057\u3066 Log output \u306b Result: Page title is Google \u304c\u51fa\u529b\u3055\u308c\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u304c\u78ba\u8a8d\u3067\u304d\u308c\u3070\u3001\u554f\u984c\u306a\u304f\u5b9f\u884c\u3055\u308c\u305f\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n\nTips\u3068\u304b\n\njQuery\u3092\u4f7f\u3044\u305f\u3044\njQuery\u3092\u4f7f\u3063\u3066DOM\u3092\u30d1\u30fc\u30b9\u3057\u305f\u3044\u3068\u304d\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b includeJs \u3092\u4f7f\u3063\u3066\u66f8\u3051\u307e\u3059\u3002\n\nphantomjs-script.js\n//\u7701\u7565\n\npage.open('http://www.google.com', function(status) {\n    page.includeJs('https://code.jquery.com/jquery-3.1.1.slim.min.js', function() {\n        //\u30d6\u30e9\u30a6\u30b6\u5185\u3067JS\u3092\u4ecb\u3057\u3066\u30c7\u30fc\u30bf\u3092\u53d6\u5f97  \n        var title = page.evaluate(function() {\n            return $('title').text();\n        });\n        console.log('Page title is ' + title);\n        phantom.exit();\n    });\n});\n\n\n\nPhantomJS\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u6e21\u3057\u305f\u3044\nexec\u306e\u5f15\u6570\u3068\u3057\u3066\u914d\u5217\u3092\u6e21\u3057\u3001PhantomJS\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3067 system.args \u3092\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u3053\u3068\u3067\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u6e21\u305b\u307e\u3059\u3002\n\nindex.js\n// \u7701\u7565\n\nexports.handler = (event, context, callback) => {\n    const scriptPath = path.join(__dirname, 'phantomjs-script.js');\n    const childArgs = [\n        scriptPath,\n        'args1',\n    ];\n    exec(childArgs, (error, stdout, stderr) => {\n        if (error) {\n            console.error(`exec error: ${error}`);\n            return;\n        }\n\n        console.log(`Result: ${stdout}`);\n        console.log(`Should have no error: ${stderr}`);\n    });\n\n\n\nphantomjs-script.js\nvar system = require('system');\nvar args = system.args;\n\nconsole.log(args.length);\nconsole.log(args[1]);\n\n// \u7701\u7565\n\n\n\nevaluate\u306b\u5916\u90e8\u3067\u5b9a\u7fa9\u3057\u305f\u5909\u6570\u3092\u4f7f\u7528\u3059\u308b\n\u5916\u90e8\u3067\u5b9a\u7fa9\u3057\u305f\u5909\u6570\u3092\u4f7f\u3046\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\nphantomjs-script.js\n  var hoge = 'fuga';\n  var title = page.evaluate(function(s) {\n    console.log(s);\n    return document.title;\n  }, hoge);\n\n\n[PhantomJS Lambda Template](https://github.com/justengland/phantom-lambda-template)\u306e\u958b\u767a\u8005\u304c [phantomjs-lambda-pack](https://github.com/justengland/phantomjs-lambda-pack)  \u3092\u65b0\u3057\u304f\u30ea\u30ea\u30fc\u30b9\u3057\u3066\u3044\u305f\u306e\u3067\u3001\u3053\u308c\u3092\u4f7f\u3063\u3066Lambda\u4e0a\u3067PhantomJS\u3092\u52d5\u4f5c\u3055\u305b\u3066\u307f\u307e\u3059\u3002\n\n### \u74b0\u5883\u69cb\u7bc9\u3068\u521d\u671f\u8a2d\u5b9a\n\n```\n$ mkdir lambda-phantomjs && cd  lambda-phantomjs\n$ npm init\n$ npm install phantomjs-lambda-pack --save\n```\n\nindex.js\u306fREADME.md \u306eusage\u306b\u66f8\u304b\u308c\u3066\u3044\u308b\u5185\u5bb9\u3067\u307e\u305a\u306f\u8a66\u3057\u307e\u3059\u3002\n\n```\n% cat index.js \n'use strict';\nconst phantomjsLambdaPack = require('phantomjs-lambda-pack');\nconst exec = phantomjsLambdaPack.exec;\n\nexports.handler = (event, context, callback) => {\n    exec('-v', (error, stdout, stderr) => {\n        if (error) {\n            console.error(`exec error: ${error}`);\n            return;\n        }\n\n        console.log(`phantom version: ${stdout}`);\n        console.log(`Should have no error: ${stderr}`);\n\n        callback(error, 'fin!!');\n    });\n};\n```\n\n#### Lambda Function\u306e\u8a2d\u5b9a\u3068\u5b9f\u884c\n\nFunction Package\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u3089\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\uff08\u4f7f\u7528\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u3001Code entry type\u3067\u3001\u300eUpload a .ZIP file\u300f\u3092\u9078\u629e\u3057\u3066\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u30b5\u30a4\u30ba(10MB\u4ee5\u4e0b\uff09\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\uff09\n\n|\u8a2d\u5b9a\u9805\u76ee  |\u8a2d\u5b9a\u5024  |\n|---|---|\n| Runtime | Node.js 4.3 |\n| Handler | lambda-phantomjs/index.handler |\n| Memory(MB) | 1024 |\n| Timeout | 5 min |\n\n\u521d\u56de\u5b9f\u884c\u6642\u306f 1min \u3060\u3068 Timeout \u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\u306e\u3067\u30015min \u3068\u3057\u3066\u3044\u307e\u3059\u3002\n\u5b9f\u884c\u7d50\u679c\u3092\u898b\u308b\u30682\u5206\u3050\u3089\u3044\u3092\u898b\u3066\u304a\u3051\u3070\u5927\u4e08\u592b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\uff082\u56de\u76ee\u4ee5\u964d\u306e\u5b9f\u884c\u6642\u306f 4000 ms \u524d\u5f8c\u3050\u3089\u3044\u3067\u5b89\u5b9a\u3057\u307e\u3059\u3002\uff09\n\n##### \u5b9f\u884c\u7d50\u679c\n\nLog output \u3092\u78ba\u8a8d\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9f\u884c\u3055\u308c\u305f\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n```\n2016-11-24T10:02:46.845Z\tf39f30db-b22c-11e6-94f0-653737dc93be\texec phantom:  -v\n2016-11-24T10:02:47.105Z\tf39f30db-b22c-11e6-94f0-653737dc93be\tphantom version: 2.1.1\n\n2016-11-24T10:02:47.105Z\tf39f30db-b22c-11e6-94f0-653737dc93be\tShould have no error: \nEND RequestId: f39f30db-b22c-11e6-94f0-653737dc93be\nREPORT RequestId: f39f30db-b22c-11e6-94f0-653737dc93be\tDuration: 75160.69 ms\tBilled Duration: 75200 ms \tMemory Size: 1024 MB\tMax Memory Used: 401 MB\tPhantomJS\n```\n\nphantomjs-lambda-pack \u3092\u4f7f\u3046\u3068 PhantomJS \u306e 2.1.1 \u304c\u4f7f\u308f\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\u5185\u90e8\u3067\u306f [phantomjs-prebuilt](https://www.npmjs.com/package/phantomjs-prebuilt) \u304c\u4f7f\u308f\u308c\u3066\u3044\u308b\u306e\u3067\u3001phantomjs-prebuilt \u304c\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u306e PhantomJS \u304c\u4f7f\u308f\u308c\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n### \u5b9f\u969b\u306bPhantomJS\u3092\u4f7f\u3063\u3066Scraping\n\nGoogle\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066Page\u306eTitle\u3092\u53d6\u5f97\u3001\u304a\u3088\u3073\u8868\u793a\u3057\u305f\u30da\u30fc\u30b8\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092S3\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u307f\u307e\u3059\u3002\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3067\u3059\u3002\nindex.js \u3068\u540c\u3058\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u968e\u5c64\u306b phantomjs-script.js \u3068\u3044\u3046\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u3066\u3044\u307e\u3059\u3002\n\n```\n.\n\u251c\u2500\u2500 index.js\n\u251c\u2500\u2500 node_modules\n\u2502   \u251c\u2500\u2500 aws-sdk\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 phantomjs-lambda-pack\n\u2502\n\u251c\u2500\u2500 package.json\n\u2514\u2500\u2500 phantomjs-script.js\n```\n\n\u4e8b\u524d\u306b aws-sdk \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304a\u3088\u3073\u3001Lambda\u306e\u5b9f\u884c\u30ed\u30fc\u30eb\u306bS3 \u3078\u306e\u66f8\u304d\u8fbc\u307f\u6a29\u9650\u3092\u4ed8\u4e0e\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nhandler \u306e\u4e2d\u3067 phantomjs-script.js \u3092\u547c\u3073\u51fa\u3057\u3066\u3044\u307e\u3059\u3002\n\n```index.js\n'use strict';\nconst phantomjsLambdaPack = require('phantomjs-lambda-pack');\nconst exec = phantomjsLambdaPack.exec;\nconst path = require('path');\nconst fs = require('fs');\nconst AWS = require('aws-sdk');\nAWS.config.region = 'ap-northeast-1';\n\nexports.handler = (event, context, callback) => {\n    const scriptPath = path.join(__dirname, 'phantomjs-script.js');\n    exec(scriptPath, (error, stdout, stderr) => {\n        if (error) {\n            console.error(`exec error: ${error}`);\n            return;\n        }\n\n        console.log(`Result: ${stdout}`);\n        console.log(`Should have no error: ${stderr}`);\n\n       // \u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092S3\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\n       const tmp_file_path = path.join(__dirname, 'google.png');\n       const params = {Bucket: 'bucketName', Key: 'screen/google.png', Body: fs.createReadStream(tmp_file_path),};\n       new AWS.S3().upload(params, (error, data) => {\n           callback(error, 'fin!!');\n       });\n    })\n}\n```\n\n```phantomjs-script.js\n// headless\u30d6\u30e9\u30a6\u30b6\u3092\u4f5c\u6210\nvar page = require('webpage').create();\npage.settings.userAgent = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/44.0.2403.157 Safari/537.36';\npage.settings.javascriptEnabled = true;\npage.settings.loadImages = false;//Script is much faster with this field set to false\nphantom.cookiesEnabled = true;\nphantom.javascriptEnabled = true;\n\n//URL\u3092\u958b\u304f\npage.open('http://www.google.com', function(status) {\n  //\u30d6\u30e9\u30a6\u30b6\u5185\u3067JS\u3092\u4ecb\u3057\u3066\u30c7\u30fc\u30bf\u3092\u53d6\u5f97  \n  var title = page.evaluate(function() {\n    return document.title;\n  });\n  page.render('google.png');\n  console.log('Page title is ' + title);\n  phantom.exit();\n});\n\n\n```\n\n\u5b9f\u884c\u7d50\u679c\u3068\u3057\u3066 Log output \u306b Result: Page title is Google \u304c\u51fa\u529b\u3055\u308c\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u304c\u78ba\u8a8d\u3067\u304d\u308c\u3070\u3001\u554f\u984c\u306a\u304f\u5b9f\u884c\u3055\u308c\u305f\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n![google.png](https://qiita-image-store.s3.amazonaws.com/0/17814/e673fccc-f6c7-00c6-d750-b2891440a6e1.png)\n\n### Tips\u3068\u304b\n\n#### jQuery\u3092\u4f7f\u3044\u305f\u3044\n\njQuery\u3092\u4f7f\u3063\u3066DOM\u3092\u30d1\u30fc\u30b9\u3057\u305f\u3044\u3068\u304d\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b includeJs \u3092\u4f7f\u3063\u3066\u66f8\u3051\u307e\u3059\u3002\n\n```phantomjs-script.js\n//\u7701\u7565\n\npage.open('http://www.google.com', function(status) {\n    page.includeJs('https://code.jquery.com/jquery-3.1.1.slim.min.js', function() {\n        //\u30d6\u30e9\u30a6\u30b6\u5185\u3067JS\u3092\u4ecb\u3057\u3066\u30c7\u30fc\u30bf\u3092\u53d6\u5f97  \n        var title = page.evaluate(function() {\n            return $('title').text();\n        });\n        console.log('Page title is ' + title);\n        phantom.exit();\n    });\n});\n```\n\n#### PhantomJS\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u6e21\u3057\u305f\u3044\nexec\u306e\u5f15\u6570\u3068\u3057\u3066\u914d\u5217\u3092\u6e21\u3057\u3001PhantomJS\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3067 system.args \u3092\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u3053\u3068\u3067\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u6e21\u305b\u307e\u3059\u3002\n\n\n```index.js\n// \u7701\u7565\n\nexports.handler = (event, context, callback) => {\n    const scriptPath = path.join(__dirname, 'phantomjs-script.js');\n    const childArgs = [\n        scriptPath,\n        'args1',\n    ];\n    exec(childArgs, (error, stdout, stderr) => {\n        if (error) {\n            console.error(`exec error: ${error}`);\n            return;\n        }\n\n        console.log(`Result: ${stdout}`);\n        console.log(`Should have no error: ${stderr}`);\n    });\n```\n\n```phantomjs-script.js\nvar system = require('system');\nvar args = system.args;\n\nconsole.log(args.length);\nconsole.log(args[1]);\n\n// \u7701\u7565\n```\n\n#### evaluate\u306b\u5916\u90e8\u3067\u5b9a\u7fa9\u3057\u305f\u5909\u6570\u3092\u4f7f\u7528\u3059\u308b\n\n\u5916\u90e8\u3067\u5b9a\u7fa9\u3057\u305f\u5909\u6570\u3092\u4f7f\u3046\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```phantomjs-script.js\n  var hoge = 'fuga';\n  var title = page.evaluate(function(s) {\n    console.log(s);\n    return document.title;\n  }, hoge);\n```\n", "tags": ["lambda", "PhantomJS", "Node.js"]}