{"context": "\u81ea\u5206\u7528\u306e\u30e1\u30e2\n\n\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u3068Mackerel\u306e\u9023\u643a\u30c4\u30fc\u30eb\u300csackerel\u300d\u3092\u5b9f\u88c5\u3057\u305f\u6642\u306e\u30e1\u30e2\u3002\n\nmackerel-agent\u306e0.34.0\u306b\u3066AWS\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u305d\u3046\u3067\u3059\u3002\n\u8a73\u7d30\u306fMackerel\u30d6\u30ed\u30b08\u670819\u65e5\u306e\u8a18\u4e8b\u306b\u3042\u308a\u307e\u3057\u305f\u3002\n\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u5074\u3067\u3069\u3046\u3044\u3046\u98a8\u306b\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u884c\u3063\u3066\u3044\u308b\u304b\u6c17\u306b\u306a\u3063\u305f\u306e\u3067\u8abf\u3079\u307e\u3057\u305f\u3002\n\u4ee5\u4e0b\u306f\u57f7\u7b46\u6642\u70b9\u3067\u306emaster\u30d6\u30e9\u30f3\u30c1\u6700\u65b0\u30b3\u30df\u30c3\u30c8(cd6a67a)\u3092\u5143\u306b\u8abf\u67fb\u3057\u3066\u3044\u307e\u3059\u3002\n\u4eca\u5f8c\u306e\u958b\u767a\u306b\u3088\u308a\u51e6\u7406\u65b9\u6cd5\u304c\u5909\u66f4\u306b\u306a\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u30db\u30b9\u30c8\u60c5\u5831\u306e\u53ce\u96c6(command/command.go)\n\u305d\u308c\u3089\u3057\u3044\u3082\u306e\u304c\u4ee5\u4e0b\u306b\u3042\u308a\u307e\u3057\u305f\u3002\n\u5f15\u7528\u5143 : command/command.go#L472\n\ncommand/command.go\n// collectHostSpecs collects host specs (correspond to \"name\", \"meta\", \"interfaces\" and \"customIdentifier\" fields in API v0)\nfunc collectHostSpecs() (string, map[string]interface{}, []spec.NetInterface, string, error) {\n    // (\u7701\u7565)\n\n    // 479\u884c\u76ee\u301c\n    cGen := spec.SuggestCloudGenerator()\n\n    // (\u7701\u7565)\n\n    // 485\u884c\u76ee\u301c\n    var customIdentifier string\n    if cGen != nil {\n        customIdentifier, err = cGen.SuggestCustomIdentifier()\n        if err != nil {\n            logger.Warningf(\"Error while suggesting custom identifier. err: %s\", err.Error())\n        }\n    }\n\n    // (\u7701\u7565)\n\n\ncollectHostSpecs()\u306fMackerel\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u30db\u30b9\u30c8\u306e\u60c5\u5831\u3092\u53ce\u96c6\u3059\u308b\u305f\u3081\u306e\u3082\u306e\u306e\u3088\u3046\u3067\u3059\u3002\n\u305d\u306e\u4e2d\u3067CustomIdentifire\u3068\u3044\u3046\u5024\u306e\u53ce\u96c6\u306e\u305f\u3081\u306bspec.SuggestCloudGenerator()\u3092\u547c\u3093\u3067\u3044\u307e\u3059\u3002\n\u3053\u3044\u3064\u306eSuggestCustomIdentifier()\u304cCustomIdentifier\u3092\u8fd4\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u3067\u3059\u306d\u3002\nCustomIdentifire\u306f\u30de\u30cb\u30e5\u30a2\u30eb\u306a\u3069\u306b\u8a18\u8f09\u306f\u306a\u3044\u3067\u3059\u304c\u3001Mackerel\u306e\u30db\u30b9\u30c8ID\u3068\u306f\u5225\u306b\n\u4efb\u610f\u306eID\u3092\u6301\u305f\u305b\u308b\u305f\u3081\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u3088\u3046\u3067\u3059\u3002\nGET /api/v0/hosts\u306a\u3069\u306e\u3001\u30db\u30b9\u30c8\u60c5\u5831\u53c2\u7167API\u3067\u3082\u30ec\u30b9\u30dd\u30f3\u30b9\u5185\u306b\u5024\u304c\u304d\u3061\u3093\u3068\u542b\u307e\u308c\u3066\u3044\u307e\u3057\u305f\u3002\n\u305d\u308c\u3067\u306f\u547c\u3070\u308c\u308b\u5148\u306espec.SuggestCloudGenerator()\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u30af\u30e9\u30a6\u30c9\u4e8b\u696d\u8005\u3054\u3068\u306bCustomIdentifire\u306e\u751f\u6210\u3092\u3059\u308b(spec/cloug.go)\n\u5f15\u7528\u5143 : spec/cloud.go#L47\n\nspec/cloud.go\n// SuggestCloudGenerator returns suitable CloudGenerator\nfunc SuggestCloudGenerator() *CloudGenerator {\n    if isEC2() {\n        return &CloudGenerator{&EC2Generator{ec2BaseURL}}\n    }\n    if isGCE() {\n        return &CloudGenerator{&GCEGenerator{gceMetaURL}}\n    }\n\n    return nil\n}\n\n\nCustomIdentifire\u3092\u751f\u6210\u3059\u308b\u305f\u3081\u306e\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u3092\u4f5c\u6210\u3057\u3066\u8fd4\u3059\u30d5\u30a1\u30af\u30c8\u30ea\u30e1\u30bd\u30c3\u30c9\u3067\u3059\u3002\n\u3053\u3053\u3067isEC2()\u307e\u305f\u306fisGCE()\u3067\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3092\u5224\u5b9a\u3057\u3001\u9069\u5207\u306a\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u3092\u4f5c\u6210\u3057\u3066\u3044\u307e\u3059\u3002\n\u3082\u3057\u5bfe\u5fdc\u30af\u30e9\u30a6\u30c9\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3092\u5897\u3084\u3057\u305f\u3044\u5834\u5408\u306f\u3053\u3053\u306b\u8ffd\u52a0\u5bfe\u5fdc\u3067\u3059\u306d\uff01\n(\u904e\u53bb\u306e\u30bd\u30fc\u30b9\u306bDigitalOcean\u5bfe\u5fdc\u306e\u6b8b\u9ab8\u304c\u3042\u3063\u305f\u308a\u3057\u307e\u3059)\n\u5f15\u7528\u5143 : spec/cloud.go#L59\n\nspec/cloug.do\nfunc isEC2() bool {\n    cl := http.Client{\n        Timeout: timeout,\n    }\n    // '/ami-id` is may be aws specific URL\n    // (\u7b46\u8005\u6ce8 : ec2BaseURL := \"http://169.254.169.254/latest/meta-data\")\n    resp, err := cl.Get(ec2BaseURL.String() + \"/ami-id\")\n    if err != nil {\n        return false\n    }\n    defer resp.Body.Close()\n\n    return resp.StatusCode == 200\n}\n\n\n\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3066\u5224\u5b9a\u3057\u3066\u3044\u307e\u3059\u306d\u3002\nEC2\u3067\u3042\u308b\u304b\u306e\u5224\u5b9a\u3067\u3001/ami-id\u3092\u30ea\u30af\u30a8\u30b9\u30c8\u3059\u308b\u3053\u3068\u3067OpenStack\u306a\u3069\u3068\u533a\u5225\u3059\u308b\u3088\u3046\u3067\u3059\u306d\u3002\n\u5b9f\u969b\u306eCustomIdentifire\u751f\u6210\u51e6\u7406\u306f\u4ee5\u4e0b\u306b\u3042\u308a\u307e\u3059\u3002\n\u5f15\u7528\u5143 : spec/cloud.go#L156\n\nspec/cloud.go\n// SuggestCustomIdentifier suggests the identifier of the EC2 instance\nfunc (g *EC2Generator) SuggestCustomIdentifier() (string, error) {\n    client := http.Client{Timeout: timeout}\n    key := \"instance-id\"\n    resp, err := client.Get(g.baseURL.String() + \"/\" + key)\n\n    // (\u7701\u7565)\n\n    instanceID := string(body)\n\n    // (\u7701\u7565)\n\n    return instanceID + \".ec2.amazonaws.com\", nil\n}\n\n\n\u30e1\u30bf\u30c7\u30fc\u30bf\u304b\u3089\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\u3092\u53d6\u5f97\u3057\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID.ec2.amazonaws.com\u3092\u8fd4\u3059\u3060\u3051\u3067\u3059\u3002\nAWS\u3084GCE\u4ee5\u5916\u306e\u30af\u30e9\u30a6\u30c9\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u5bfe\u5fdc\u3059\u308b\u5834\u5408\u306f\u3053\u3053\u3082\u5b9f\u88c5\u304c\u5fc5\u8981\u3067\u3059\u306d\u3002\n\n\u53ce\u96c6\u3057\u305fCustomIdentifier\u306f\u4ee5\u4e0b\u3067Mackerel\u3078\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n\n\u30db\u30b9\u30c8\u60c5\u5831\u306e\u767b\u9332\n\u5f15\u7528\u5143 : command/command.go#L29\n\ncommand/command.go\n\n// prepareHost collects specs of the host and sends them to Mackerel server.\n// A unique host-id is returned by the server if one is not specified.\nfunc prepareHost(conf *config.Config, api *mackerel.API) (*mackerel.Host, error) {\n    // (\u7701\u7565)\n\n            // (66\u884c\u76ee\u301c)\n            doRetry(func() error {\n                hostID, lastErr = api.CreateHost(mackerel.HostSpec{\n                    Name:             hostname,\n                    Meta:             meta,\n                    Interfaces:       interfaces,\n                    RoleFullnames:    conf.Roles,\n                    DisplayName:      conf.DisplayName,\n                    CustomIdentifier: customIdentifier,\n                })\n                return filterErrorForRetry(lastErr)\n            })\n\n    // (\u7701\u7565)\n\n}\n\n\n\n\u30db\u30b9\u30c8\u60c5\u5831\u306e\u66f4\u65b0\n\u5f15\u7528\u5143 : command/command.go#L501\n\ncommand/command.go\n// UpdateHostSpecs updates the host information that is already registered on Mackerel.\nfunc (c *Context) UpdateHostSpecs() {\n    // (\u7701\u7565)\n\n    hostname, meta, interfaces, customIdentifier, err := collectHostSpecs()\n\n    // (\u7701\u7565)\n\n    err = c.API.UpdateHost(c.Host.ID, mackerel.HostSpec{\n        Name:             hostname,\n        Meta:             meta,\n        Interfaces:       interfaces,\n        RoleFullnames:    c.Config.Roles,\n        Checks:           c.Config.CheckNames(),\n        DisplayName:      c.Config.DisplayName,\n        CustomIdentifier: customIdentifier,\n    })\n\n    // (\u7701\u7565)\n}\n\n\n\n\u3068\u3044\u3046\u308f\u3051\u3067\u3001\u5b9f\u88c5\u3092\u898b\u3066\u307f\u307e\u3057\u305f\u3002\nmackerel-agent\u5074\u3067\u30ab\u30b9\u30bf\u30e0ID\u3092\u751f\u6210\u3059\u308b\u3068\u4f55\u304c\u5b09\u3057\u3044\u304b\u3068\u3044\u3046\u3068\u3001AWS\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u307f\u305f\u3044\u306a\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u30ec\u30b9\u76e3\u8996\u306b\u5bfe\u3057\u3001\u5f8c\u304b\u3089\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u6642\u306b\u540c\u4e00\u30db\u30b9\u30c8\u304b\u306e\u5224\u5b9a\u304c\u3067\u304d\u308b\u3093\u3067\u3059\u306d\u3002\n\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u3068Mackerel\u306e\u9023\u643a\u30c4\u30fc\u30eb\u300csackerel\u300d\u304c\u307e\u3055\u306b\u3053\u308c\u304c\u5fc5\u8981\u3067\u3057\u305f\u3002\n\u4ee5\u4e0a\u3067\u3059\u3002\n\u81ea\u5206\u7528\u306e\u30e1\u30e2\n\n![logo.png](https://qiita-image-store.s3.amazonaws.com/0/20668/acbf5c13-e6bc-ee0f-f00f-4416660c0854.png)\n\n\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u3068Mackerel\u306e\u9023\u643a\u30c4\u30fc\u30eb\u300c[sackerel](https://github.com/sacloud/sackerel/)\u300d\u3092\u5b9f\u88c5\u3057\u305f\u6642\u306e\u30e1\u30e2\u3002\n\n---\n\n[mackerel-agent](https://github.com/mackerelio/mackerel-agent/blob/002d9512fc794df20a8a78a664e0e8b672684b07/command/command.go#L472)\u306e0.34.0\u306b\u3066AWS\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u305d\u3046\u3067\u3059\u3002\n\u8a73\u7d30\u306f[Mackerel\u30d6\u30ed\u30b08\u670819\u65e5\u306e\u8a18\u4e8b](https://mackerel.io/ja/blog/entry/weekly/20160819)\u306b\u3042\u308a\u307e\u3057\u305f\u3002\n\n\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u5074\u3067\u3069\u3046\u3044\u3046\u98a8\u306b\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u884c\u3063\u3066\u3044\u308b\u304b\u6c17\u306b\u306a\u3063\u305f\u306e\u3067\u8abf\u3079\u307e\u3057\u305f\u3002\n\n**\u4ee5\u4e0b\u306f\u57f7\u7b46\u6642\u70b9\u3067\u306emaster\u30d6\u30e9\u30f3\u30c1\u6700\u65b0\u30b3\u30df\u30c3\u30c8[(cd6a67a)](https://github.com/mackerelio/mackerel-agent/tree/cd6a67acfa4970d21891885b01a165e6e399a498)\u3092\u5143\u306b\u8abf\u67fb\u3057\u3066\u3044\u307e\u3059\u3002\n\u4eca\u5f8c\u306e\u958b\u767a\u306b\u3088\u308a\u51e6\u7406\u65b9\u6cd5\u304c\u5909\u66f4\u306b\u306a\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002**\n\n### \u30db\u30b9\u30c8\u60c5\u5831\u306e\u53ce\u96c6(command/command.go)\n\n\u305d\u308c\u3089\u3057\u3044\u3082\u306e\u304c\u4ee5\u4e0b\u306b\u3042\u308a\u307e\u3057\u305f\u3002\n\n\u5f15\u7528\u5143 : [command/command.go#L472](https://github.com/mackerelio/mackerel-agent/blob/002d9512fc794df20a8a78a664e0e8b672684b07/command/command.go#L472)\n\n```go:command/command.go\n// collectHostSpecs collects host specs (correspond to \"name\", \"meta\", \"interfaces\" and \"customIdentifier\" fields in API v0)\nfunc collectHostSpecs() (string, map[string]interface{}, []spec.NetInterface, string, error) {\n\t// (\u7701\u7565)\n\n\t// 479\u884c\u76ee\u301c\n\tcGen := spec.SuggestCloudGenerator()\n\n\t// (\u7701\u7565)\n\n\t// 485\u884c\u76ee\u301c\n\tvar customIdentifier string\n\tif cGen != nil {\n\t\tcustomIdentifier, err = cGen.SuggestCustomIdentifier()\n\t\tif err != nil {\n\t\t\tlogger.Warningf(\"Error while suggesting custom identifier. err: %s\", err.Error())\n\t\t}\n\t}\n\n\t// (\u7701\u7565)\n```\n\n`collectHostSpecs()`\u306fMackerel\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u30db\u30b9\u30c8\u306e\u60c5\u5831\u3092\u53ce\u96c6\u3059\u308b\u305f\u3081\u306e\u3082\u306e\u306e\u3088\u3046\u3067\u3059\u3002\n\u305d\u306e\u4e2d\u3067`CustomIdentifire`\u3068\u3044\u3046\u5024\u306e\u53ce\u96c6\u306e\u305f\u3081\u306b`spec.SuggestCloudGenerator()`\u3092\u547c\u3093\u3067\u3044\u307e\u3059\u3002\n\u3053\u3044\u3064\u306e`SuggestCustomIdentifier()`\u304c`CustomIdentifier`\u3092\u8fd4\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u3067\u3059\u306d\u3002\n\n`CustomIdentifire`\u306f\u30de\u30cb\u30e5\u30a2\u30eb\u306a\u3069\u306b\u8a18\u8f09\u306f\u306a\u3044\u3067\u3059\u304c\u3001Mackerel\u306e\u30db\u30b9\u30c8ID\u3068\u306f\u5225\u306b\n\u4efb\u610f\u306eID\u3092\u6301\u305f\u305b\u308b\u305f\u3081\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u3088\u3046\u3067\u3059\u3002\n`GET /api/v0/hosts`\u306a\u3069\u306e\u3001\u30db\u30b9\u30c8\u60c5\u5831\u53c2\u7167API\u3067\u3082\u30ec\u30b9\u30dd\u30f3\u30b9\u5185\u306b\u5024\u304c\u304d\u3061\u3093\u3068\u542b\u307e\u308c\u3066\u3044\u307e\u3057\u305f\u3002\n\n\u305d\u308c\u3067\u306f\u547c\u3070\u308c\u308b\u5148\u306e`spec.SuggestCloudGenerator()`\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n### \u30af\u30e9\u30a6\u30c9\u4e8b\u696d\u8005\u3054\u3068\u306bCustomIdentifire\u306e\u751f\u6210\u3092\u3059\u308b(spec/cloug.go)\n\n\u5f15\u7528\u5143 : [spec/cloud.go#L47](https://github.com/mackerelio/mackerel-agent/blob/master/spec/cloud.go#L47)\n\n```go:spec/cloud.go\n// SuggestCloudGenerator returns suitable CloudGenerator\nfunc SuggestCloudGenerator() *CloudGenerator {\n\tif isEC2() {\n\t\treturn &CloudGenerator{&EC2Generator{ec2BaseURL}}\n\t}\n\tif isGCE() {\n\t\treturn &CloudGenerator{&GCEGenerator{gceMetaURL}}\n\t}\n\n\treturn nil\n}\n```\n\n`CustomIdentifire`\u3092\u751f\u6210\u3059\u308b\u305f\u3081\u306e\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u3092\u4f5c\u6210\u3057\u3066\u8fd4\u3059\u30d5\u30a1\u30af\u30c8\u30ea\u30e1\u30bd\u30c3\u30c9\u3067\u3059\u3002\n\u3053\u3053\u3067`isEC2()`\u307e\u305f\u306f`isGCE()`\u3067\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3092\u5224\u5b9a\u3057\u3001\u9069\u5207\u306a\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u3092\u4f5c\u6210\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u3082\u3057\u5bfe\u5fdc\u30af\u30e9\u30a6\u30c9\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3092\u5897\u3084\u3057\u305f\u3044\u5834\u5408\u306f\u3053\u3053\u306b\u8ffd\u52a0\u5bfe\u5fdc\u3067\u3059\u306d\uff01\n([\u904e\u53bb\u306e\u30bd\u30fc\u30b9](https://github.com/mackerelio/mackerel-agent/commit/f527e708550fef3119709505af0d72576e56b2da)\u306bDigitalOcean\u5bfe\u5fdc\u306e\u6b8b\u9ab8\u304c\u3042\u3063\u305f\u308a\u3057\u307e\u3059)\n\n\u5f15\u7528\u5143 : [spec/cloud.go#L59](https://github.com/mackerelio/mackerel-agent/blob/master/spec/cloud.go#L59)\n\n```go:spec/cloug.do\nfunc isEC2() bool {\n\tcl := http.Client{\n\t\tTimeout: timeout,\n\t}\n\t// '/ami-id` is may be aws specific URL\n\t// (\u7b46\u8005\u6ce8 : ec2BaseURL := \"http://169.254.169.254/latest/meta-data\")\n\tresp, err := cl.Get(ec2BaseURL.String() + \"/ami-id\")\n\tif err != nil {\n\t\treturn false\n\t}\n\tdefer resp.Body.Close()\n\n\treturn resp.StatusCode == 200\n}\n```\n\n[\u30e1\u30bf\u30c7\u30fc\u30bf](http://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/ec2-instance-metadata.html)\u3092\u53d6\u5f97\u3057\u3066\u5224\u5b9a\u3057\u3066\u3044\u307e\u3059\u306d\u3002\nEC2\u3067\u3042\u308b\u304b\u306e\u5224\u5b9a\u3067\u3001`/ami-id`\u3092\u30ea\u30af\u30a8\u30b9\u30c8\u3059\u308b\u3053\u3068\u3067OpenStack\u306a\u3069\u3068\u533a\u5225\u3059\u308b\u3088\u3046\u3067\u3059\u306d\u3002\n\n\u5b9f\u969b\u306e`CustomIdentifire`\u751f\u6210\u51e6\u7406\u306f\u4ee5\u4e0b\u306b\u3042\u308a\u307e\u3059\u3002\n\n\u5f15\u7528\u5143 : [spec/cloud.go#L156](https://github.com/mackerelio/mackerel-agent/blob/master/spec/cloud.go#L156)\n\n```go:spec/cloud.go\n// SuggestCustomIdentifier suggests the identifier of the EC2 instance\nfunc (g *EC2Generator) SuggestCustomIdentifier() (string, error) {\n\tclient := http.Client{Timeout: timeout}\n\tkey := \"instance-id\"\n\tresp, err := client.Get(g.baseURL.String() + \"/\" + key)\n\n\t// (\u7701\u7565)\n\n\tinstanceID := string(body)\n\n\t// (\u7701\u7565)\n\n\treturn instanceID + \".ec2.amazonaws.com\", nil\n}\n```\n\n\u30e1\u30bf\u30c7\u30fc\u30bf\u304b\u3089\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\u3092\u53d6\u5f97\u3057\u3001`\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID.ec2.amazonaws.com`\u3092\u8fd4\u3059\u3060\u3051\u3067\u3059\u3002\n\n\nAWS\u3084GCE\u4ee5\u5916\u306e\u30af\u30e9\u30a6\u30c9\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u5bfe\u5fdc\u3059\u308b\u5834\u5408\u306f\u3053\u3053\u3082\u5b9f\u88c5\u304c\u5fc5\u8981\u3067\u3059\u306d\u3002\n\n---\n\n\u53ce\u96c6\u3057\u305f`CustomIdentifier`\u306f\u4ee5\u4e0b\u3067Mackerel\u3078\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n\n#### \u30db\u30b9\u30c8\u60c5\u5831\u306e\u767b\u9332\n\n\u5f15\u7528\u5143 : [command/command.go#L29](https://github.com/mackerelio/mackerel-agent/blob/002d9512fc794df20a8a78a664e0e8b672684b07/command/command.go#L501)\n\n```go:command/command.go\n\n// prepareHost collects specs of the host and sends them to Mackerel server.\n// A unique host-id is returned by the server if one is not specified.\nfunc prepareHost(conf *config.Config, api *mackerel.API) (*mackerel.Host, error) {\n\t// (\u7701\u7565)\n\n\t\t\t// (66\u884c\u76ee\u301c)\n\t\t\tdoRetry(func() error {\n\t\t\t\thostID, lastErr = api.CreateHost(mackerel.HostSpec{\n\t\t\t\t\tName:             hostname,\n\t\t\t\t\tMeta:             meta,\n\t\t\t\t\tInterfaces:       interfaces,\n\t\t\t\t\tRoleFullnames:    conf.Roles,\n\t\t\t\t\tDisplayName:      conf.DisplayName,\n\t\t\t\t\tCustomIdentifier: customIdentifier,\n\t\t\t\t})\n\t\t\t\treturn filterErrorForRetry(lastErr)\n\t\t\t})\n\n\t// (\u7701\u7565)\n\n}\n```\n\n#### \u30db\u30b9\u30c8\u60c5\u5831\u306e\u66f4\u65b0\n\n\u5f15\u7528\u5143 : [command/command.go#L501](https://github.com/mackerelio/mackerel-agent/blob/002d9512fc794df20a8a78a664e0e8b672684b07/command/command.go#L501)\n\n```go:command/command.go\n// UpdateHostSpecs updates the host information that is already registered on Mackerel.\nfunc (c *Context) UpdateHostSpecs() {\n\t// (\u7701\u7565)\n\n\thostname, meta, interfaces, customIdentifier, err := collectHostSpecs()\n\n\t// (\u7701\u7565)\n\n\terr = c.API.UpdateHost(c.Host.ID, mackerel.HostSpec{\n\t\tName:             hostname,\n\t\tMeta:             meta,\n\t\tInterfaces:       interfaces,\n\t\tRoleFullnames:    c.Config.Roles,\n\t\tChecks:           c.Config.CheckNames(),\n\t\tDisplayName:      c.Config.DisplayName,\n\t\tCustomIdentifier: customIdentifier,\n\t})\n\n\t// (\u7701\u7565)\n}\n```\n\n---\n\n\u3068\u3044\u3046\u308f\u3051\u3067\u3001\u5b9f\u88c5\u3092\u898b\u3066\u307f\u307e\u3057\u305f\u3002\nmackerel-agent\u5074\u3067\u30ab\u30b9\u30bf\u30e0ID\u3092\u751f\u6210\u3059\u308b\u3068\u4f55\u304c\u5b09\u3057\u3044\u304b\u3068\u3044\u3046\u3068\u3001AWS\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u307f\u305f\u3044\u306a\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u30ec\u30b9\u76e3\u8996\u306b\u5bfe\u3057\u3001\u5f8c\u304b\u3089\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u6642\u306b\u540c\u4e00\u30db\u30b9\u30c8\u304b\u306e\u5224\u5b9a\u304c\u3067\u304d\u308b\u3093\u3067\u3059\u306d\u3002\n\n\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u3068Mackerel\u306e\u9023\u643a\u30c4\u30fc\u30eb\u300c[sackerel](https://github.com/sacloud/sackerel/)\u300d\u304c\u307e\u3055\u306b\u3053\u308c\u304c\u5fc5\u8981\u3067\u3057\u305f\u3002\n\n\u4ee5\u4e0a\u3067\u3059\u3002\n", "tags": ["Mackerel", "golang", "Go"]}