{"tags": ["Terraform", "AWS", "Hashicorp", "Terraforming", "\u69cb\u6210\u7ba1\u7406"], "context": "terrafrom \u306f\u3001\u30a4\u30f3\u30d5\u30e9\u306e\u69cb\u7bc9\u3084\u8a2d\u5b9a\u306a\u3069\u3092\u30b3\u30fc\u30c9\u3067\u8868\u73fe\u3057\u3066\u7ba1\u7406\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u30c4\u30fc\u30eb\u3067\u3059\u3002AWS \u3084 Azure\u3001 Heroku \u306a\u3069\u69d8\u3005\u306a\u74b0\u5883\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\n\u3053\u306e\u8cc7\u6599\u306f\u30e9\u30d3\u30c3\u30c8\u30cf\u30a6\u30b9\u793e\u5185\u3067\u958b\u50ac\u3055\u308c\u308b\u3001 AWS \u30ea\u30bd\u30fc\u30b9\u3092 terrform \u3067\u7ba1\u7406\u3059\u308b\u305f\u3081\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u5411\u3051\u306b\u4f5c\u6210\u3057\u305f\u8cc7\u6599\u306b\u306a\u308a\u307e\u3059\u3002AWS \u69cb\u6210\u7ba1\u7406\u3092\u30b3\u30fc\u30c9\u3067\u7ba1\u7406\u3057\u305f\u3044\u306a\u3069\u3068\u601d\u3063\u3066\u3044\u308b\u65b9\u306e\u306a\u304b\u306b\u3082\u3001\u3053\u3046\u3044\u3063\u305f\u30c4\u30fc\u30eb\u304c\u9762\u5012\u81ed\u305d\u3046\u3060\u3068\u304b\u3001\u3059\u3050\u4f7f\u3048\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3044\u305d\u3046\u3060\u3068\u304a\u601d\u3044\u306e\u65b9\u304c\u591a\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u304c\u3001 terraform \u306e\u6319\u52d5\u306f\u3068\u3066\u3082\u30b7\u30f3\u30d7\u30eb\u3067\u5b66\u7fd2\u30b3\u30b9\u30c8\u306f\u3082\u306e\u3059\u3054\u3044\u4f4e\u3044\u30c4\u30fc\u30eb\u3067\u3059\u3002\u307e\u305f AWS \u69cb\u6210\u3092\u30b3\u30fc\u30c9\u5316\u3059\u308b\u3053\u3068\u3067\u3088\u308a\u6df1\u304f AWS \u306b\u3064\u3044\u3066\u7406\u89e3\u3059\u308b\u3053\u3068\u3067\u304d\u308b\u5074\u9762\u3082\u3042\u308b\u3068\u8003\u3048\u3066\u3044\u307e\u3059\u3002\n\u662f\u975e\u3053\u306e\u6a5f\u4f1a\u306b terraform \u306b\u5165\u9580\u3057\u3066\u307f\u307e\u305b\u3093\u304b...\uff1f \u3053\u306e\u8a18\u4e8b\u306e\u901a\u308a\u306b\u30b3\u30de\u30f3\u30c9\u3092\u5165\u529b\u3057\u3066\u3044\u3051\u3070\u3001\u304d\u3063\u3068\u3042\u306a\u305f\u3082\uff11\u6642\u9593\u3082\u3057\u306a\u3044\u3046\u3061\u306b terraform \u3092\u4f7f\u3044\u3053\u306a\u305b\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u3067\u3057\u3087\u3046\u3002\n\n1. \u74b0\u5883\u69cb\u7bc9\n\u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u306f terraform v0.7.4 \u3092\u524d\u63d0\u3068\u3057\u3066\u8a71\u3092\u9032\u3081\u307e\u3059\n\nMac \u306e\u5834\u5408\n\nhttps://www.terraform.io/downloads.html\n\nbrew install terraform \u3067\u3082\u53ef\n\n\nWindows \u306e\u5834\u5408\nhttps://www.terraform.io/downloads.html\n\nAWS \u5074\u306e\u6e96\u5099\n\u3042\u3089\u304b\u3058\u3081terraform\u3067\u7528\u3044\u308bIAM\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\n\n\nIAM \u30e6\u30fc\u30b6\u30fc\u7ba1\u7406\u30da\u30fc\u30b8\u306b\u30a2\u30af\u30bb\u30b9\n\u65b0\u898f\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\n\u5fc5\u8981\u306a\u30dd\u30ea\u30b7\u30fc\u306e\u30a2\u30bf\u30c3\u30c1\naccess_key, secret_key \u306e\u4f5c\u6210\n\n\n2. S3 bucket \u3092\u7ba1\u7406\u3059\u308b\n\u307e\u305a\u306f S3 bucket \u3092\u4f5c\u3063\u305f\u308a\u5909\u66f4\u3057\u305f\u308a\u58ca\u3057\u305f\u308a\u3057\u3066\u904a\u3093\u3067\u307f\u307e\u3057\u3087\u3046\u3002\u4e0b\u6e96\u5099\u3068\u3057\u3066\u3001\u9069\u5f53\u306a\u4f5c\u696d\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u6b21\u306b AWS \u30ea\u30bd\u30fc\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u3092\u66f8\u304d\u307e\u3059\u3002\n\nvariable.tf\nprovider \"aws\" {\n  region     = \"ap-northeast-1\"\n  access_key = \"***************\"\n  secret_key = \"***************\"\n}\n\n\n\n2-1. S3 bucket \u3092\u4f5c\u308b\n\u65e9\u901f S3 bucket \u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u6b21\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u305f\u3060\u3057 bucket \u306e\u540d\u79f0\u306f\u30b0\u30ed\u30fc\u30d0\u30eb\u3067\u4e00\u610f\u306b\u306a\u308b\u3088\u3046\u306b\u5b9a\u3081\u3066\u304f\u3060\u3055\u3044\u3002\n\ns3.tf\nresource \"aws_s3_bucket\" \"terraform_tutorial\" {\n    bucket = \"com.github.53ningen.terraform.tutorial\" # S3 bucket \u540d\u306f global \u3067\u4e00\u610f\u306b\u306a\u308b\u3088\u3046\u306b\n    acl = \"private\"\n    versioning {\n        enabled = true\n    }\n}\n\n\n\u4ee5\u4e0a\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u3063\u305f\u3089\u3001terraform validate \u3067\u6b63\u3057\u3044 .tf \u30d5\u30a1\u30a4\u30eb\u3092\u8a18\u8ff0\u3067\u304d\u3066\u3044\u308b\u304b\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u304d\u3063\u3068\u4e0a\u8a18\u306e\u901a\u308a\u306b\u66f8\u3051\u3070\u554f\u984c\u306a\u304f\u30b3\u30de\u30f3\u30c9\u304c\u901a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u3064\u3065\u3044\u3066 terraform plan \u30b3\u30de\u30f3\u30c9\u3067\u3001\u3053\u308c\u304b\u3089\u3069\u306e\u3088\u3046\u306a\u3053\u3068\u304c\u5b9f\u884c\u3055\u308c\u308b\u306e\u304b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u3053\u306e\u64cd\u4f5c\u306f\u5e38\u306b\u5b89\u5168\u3067\u3001AWS\u306b\u5bfe\u3057\u3066\u60c5\u5831\u306e\u8aad\u307f\u3068\u308a\u64cd\u4f5c\u3057\u304b\u884c\u308f\u308c\u307e\u305b\u3093\u3002\n% terraform plan\nRefreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n\n\nThe Terraform execution plan has been generated and is shown below.\nResources are shown in alphabetical order for quick scanning. Green resources\nwill be created (or destroyed and then created if an existing resource\nexists), yellow resources are being changed in-place, and red resources\nwill be destroyed. Cyan entries are data sources to be read.\n\nNote: You didn't specify an \"-out\" parameter to save this plan, so when\n\"apply\" is called, Terraform can't guarantee this is what will execute.\n\n+ aws_s3_bucket.terraform_tutorial\n    acceleration_status:         \"<computed>\"\n    acl:                         \"private\"\n    arn:                         \"<computed>\"\n    bucket:                      \"com.github.53ningen.terraform.tutorial\"\n    force_destroy:               \"false\"\n    hosted_zone_id:              \"<computed>\"\n    policy:                      \"<computed>\"\n    region:                      \"<computed>\"\n    request_payer:               \"<computed>\"\n    versioning.#:                \"1\"\n    versioning.69840937.enabled: \"true\"\n    website_domain:              \"<computed>\"\n    website_endpoint:            \"<computed>\"\n\n\nPlan: 1 to add, 0 to change, 0 to destroy.\n\n+ aws_s3_bucket.terraform_tutorial \u3068\u3042\u308b\u3088\u3046\u306b S3 \u306e bucket \u304c\u4f5c\u6210\u3055\u308c\u308b\u3053\u3068\u304c\u78ba\u8a8d\u51fa\u6765\u305f\u306e\u3067 terraform apply \u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u969b\u306b\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n% terraform apply\naws_s3_bucket.terraform_tutorial: Creating...\n  acceleration_status:         \"\" => \"<computed>\"\n  acl:                         \"\" => \"private\"\n  arn:                         \"\" => \"<computed>\"\n  bucket:                      \"\" => \"com.github.53ningen.terraform.tutorial\"\n  force_destroy:               \"\" => \"false\"\n  hosted_zone_id:              \"\" => \"<computed>\"\n  policy:                      \"\" => \"<computed>\"\n  region:                      \"\" => \"<computed>\"\n  request_payer:               \"\" => \"<computed>\"\n  versioning.#:                \"\" => \"1\"\n  versioning.69840937.enabled: \"\" => \"true\"\n  website_domain:              \"\" => \"<computed>\"\n  website_endpoint:            \"\" => \"<computed>\"\naws_s3_bucket.terraform_tutorial: Creation complete\n\nApply complete! Resources: 1 added, 0 changed, 0 destroyed.\n\nThe state of your infrastructure has been saved to the path\nbelow. This state is required to modify and destroy your\ninfrastructure, so keep it safe. To inspect the complete state\nuse the `terraform show` command.\n\nState path: terraform.tfstate\n\n\u7121\u4e8b\u3001\u6210\u529f\u3057\u305f\u3088\u3046\u3067\u3059\u306e\u3067\u3001\u3068\u308a\u3042\u3048\u305a aws cli \u304b\u3089 s3 bucket \u304c\u672c\u5f53\u306b\u5b58\u5728\u3059\u308b\u306e\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n% aws s3 ls\n...\n2016-10-10 17:28:13 com.github.53ningen.terraform.tutorial\n...\n\n\u3061\u3083\u3093\u3068 s3.tf \u30d5\u30a1\u30a4\u30eb\u3067\u6307\u5b9a\u3057\u305f com.github.53ningen.terraform.tutorial \u3068\u3044\u3046\u540d\u524d\u306e bucket \u304c\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\u3055\u3066\u3001terraform apply \u304c\u7121\u4e8b\u306b\u6210\u529f\u3057\u305f\u3042\u3068\u306b\u306f terraform.tfstate \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u304c\u3067\u304d\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n% ls -a\n.  ..  .git  s3.tf  terraform.tfstate  variable.tf\n\n\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u8eab\u306f\u30ea\u30e2\u30fc\u30c8\uff08\u4eca\u306e\u5834\u5408AWS\uff09\u306e\u72b6\u614b\u3092\u4fdd\u5b58\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u306e\u4e2d\u306b\u306f\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3084\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u304c\u3075\u304f\u307e\u308c\u3066\u3044\u308b\u305f\u3081\u3001git \u7ba1\u7406\u5bfe\u8c61\u5916\u306b\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u7ba1\u7406\u306b\u3064\u3044\u3066\u306f\u306e\u3061\u307b\u3069 \u300cremote state \u306e\u7ba1\u7406\u300d\u306e\u7bc0\u3067\u3054\u8aac\u660e\u3057\u307e\u3059\u3002\u3068\u308a\u3042\u3048\u305a\u4ee5\u4e0b\u306e\u3088\u3046\u306a .gitignore \u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n.gitignore\n.DS_Store\n*.tfstate\n*.tfstate.backup\nvendor/bundle\n.bundle/\nconfig.tfvars\n.terraform/\n\n\n\n2-2. S3 bucket \u306e\u72b6\u614b\u3092\u5909\u66f4\u3059\u308b\n\u3055\u304d\u307b\u3069\u4f5c\u3063\u305f S3 bucket \u306f\u30d0\u30fc\u30b8\u30e7\u30cb\u30f3\u30b0\u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u308c\u3092\u7121\u52b9\u306b\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002s3.tf \u3092\u6b21\u306e\u3088\u3046\u306b\u4fee\u6b63\u3057\u307e\u3059\u3002\nresource \"aws_s3_bucket\" \"terraform_tutorial\" {\n    bucket = \"com.github.53ningen.terraform.tutorial\" # S3 bucket \u540d\u306f global \u3067\u4e00\u610f\u306b\u306a\u308b\u3088\u3046\u306b\n    acl = \"private\"\n    versioning {\n-       enabled = true\n+       enabled = false\n   }\n}\n\n\u7d9a\u3044\u3066 terraform validate \u30b3\u30de\u30f3\u30c9\u3067 tf \u30d5\u30a1\u30a4\u30eb\u306e\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u3092\u691c\u8a3c\u3057\u3001 terraform plan \u3067 AWS \u30ea\u30bd\u30fc\u30b9\u306b\u5bfe\u3057\u3066\u3069\u3046\u306e\u3088\u3046\u306a\u5909\u66f4\u304c\u884c\u308f\u308c\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n% terraform plan\nRefreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n\naws_s3_bucket.terraform_tutorial: Refreshing state... (ID: com.github.53ningen.terraform.tutorial)\n\nThe Terraform execution plan has been generated and is shown below.\nResources are shown in alphabetical order for quick scanning. Green resources\nwill be created (or destroyed and then created if an existing resource\nexists), yellow resources are being changed in-place, and red resources\nwill be destroyed. Cyan entries are data sources to be read.\n\nNote: You didn't specify an \"-out\" parameter to save this plan, so when\n\"apply\" is called, Terraform can't guarantee this is what will execute.\n\n~ aws_s3_bucket.terraform_tutorial\n    versioning.2972667452.enabled: \"\" => \"false\"\n    versioning.69840937.enabled:   \"true\" => \"false\"\n\n\nPlan: 0 to add, 1 to change, 0 to destroy.\n\nPlan: 0 to add, 1 to change, 0 to destroy. \u3068\u3042\u308b\u306e\u3067\u3001\u65e2\u5b58\u306e S3 \u306f\u524a\u9664\u3055\u308c\u305a\u3001\u8868\u793a\u3055\u308c\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u307f\u304c\u5909\u66f4\u3055\u308c\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\u78ba\u8a8d\u3092\u3057\u305f\u3089 apply \u3092\u3059\u308c\u3070 S3 \u306e\u72b6\u614b\u306e\u5909\u66f4\u306f\u5b8c\u4e86\u3067\u3059\u3002\n% terraform apply\naws_s3_bucket.terraform_tutorial: Refreshing state... (ID: com.github.53ningen.terraform.tutorial)\naws_s3_bucket.terraform_tutorial: Modifying...\n  versioning.2972667452.enabled: \"\" => \"false\"\n  versioning.69840937.enabled:   \"true\" => \"false\"\naws_s3_bucket.terraform_tutorial: Modifications complete\n\nApply complete! Resources: 0 added, 1 changed, 0 destroyed.\n\nThe state of your infrastructure has been saved to the path\nbelow. This state is required to modify and destroy your\ninfrastructure, so keep it safe. To inspect the complete state\nuse the `terraform show` command.\n\nState path: terraform.tfstate\n\n\n2-3. S3 bucket \u3092\u7834\u68c4\u3059\u308b\n\u3055\u3066\u3001\u3044\u307e\u307e\u3067\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3068\u3057\u3066 S3 bucket \u3092\u4f5c\u6210\u3057\u3066\u304d\u307e\u3057\u305f\u304c\u3001\u4e0d\u8981\u306a\u306e\u3067\u524a\u9664\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002terraform destroy \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3048\u3070 OK \u3067\u3059\u304c\u3001\u3053\u306e\u64cd\u4f5c\u3082\u3084\u306f\u308a\u5b9f\u884c\u3059\u308b\u524d\u306b\u78ba\u8a8d\u3057\u3066\u304a\u304d\u305f\u3044\u3082\u306e\u3067\u3059\u3002\u305d\u3093\u306a\u5834\u5408\u306f\u307e\u305a terraform plan --destroy \u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u3053\u308c\u3067 terraform destroy \u6642\u306e\u5b9f\u884c\u8a08\u753b\u3092\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n% terraform plan --destroy\nRefreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n\naws_s3_bucket.terraform_tutorial_tfsate: Refreshing state... (ID: com.github.53ningen.terraform.tutorial.tfstate)\n\nThe Terraform execution plan has been generated and is shown below.\nResources are shown in alphabetical order for quick scanning. Green resources\nwill be created (or destroyed and then created if an existing resource\nexists), yellow resources are being changed in-place, and red resources\nwill be destroyed. Cyan entries are data sources to be read.\n\nNote: You didn't specify an \"-out\" parameter to save this plan, so when\n\"apply\" is called, Terraform can't guarantee this is what will execute.\n\n- aws_s3_bucket.terraform_tutorial_tfsate\n\n\nPlan: 0 to add, 0 to change, 1 to destroy.\n\n\u5b9f\u884c\u8a08\u753b\u306b\u554f\u984c\u304c\u306a\u3055\u305d\u3046\u3067\u3042\u308c\u3070\u3001terraform destroy \u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n% terraform destroy\nDo you really want to destroy?\n  Terraform will delete all your managed infrastructure.\n  There is no undo. Only 'yes' will be accepted to confirm.\n\n  Enter a value: yes\n\naws_s3_bucket.terraform_tutorial: Refreshing state... (ID: com.github.53ningen.terraform.tutorial)\naws_s3_bucket.terraform_tutorial: Destroying...\naws_s3_bucket.terraform_tutorial: Destruction complete\n\nDestroy complete! Resources: 1 destroyed.\n\nterraform destroy \u3092\u5b9f\u884c\u3059\u308b\u3068\u672c\u5f53\u306b\u30ea\u30bd\u30fc\u30b9\u3092\u524a\u9664\u3057\u3066\u826f\u3044\u306e\u304b\u805e\u304b\u308c\u307e\u3059\u3002yes \u3068\u5165\u529b\u3059\u308b\u3068\u3001\u3053\u3053\u307e\u3067\u306b\u4f5c\u3063\u305f S3 bucket \u306f\u524a\u9664\u3055\u308c\u307e\u3059\u3002\n\n2-4. tf \u30d5\u30a1\u30a4\u30eb\u3092\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3059\u308b\nterrform fmt \u3067\u30d5\u30a1\u30a4\u30eb\u3092\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3067\u304d\u307e\u3059\n% terraform fmt\nremote_state.tf\nvariable.tf\n\n\n2-5. terraform \u57fa\u672c\u30b3\u30de\u30f3\u30c9\u306e\u307e\u3068\u3081\n\u4ee5\u4e0a\u3067 terraform \u306e\u57fa\u672c\u7684\u306a 5 \u30b3\u30de\u30f3\u30c9\u306f\u7406\u89e3\u3067\u304d\u305f\u304b\u3068\u601d\u3044\u307e\u3059\u3002\u307e\u3068\u3081\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\nterraform validate: .tf \u30d5\u30a1\u30a4\u30eb\u306e\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u3092\u691c\u8a3c\u3059\u308b\n\nterraform plan: terraform \u304c\u3053\u308c\u304b\u3089\u884c\u3046\u5b9f\u884c\u8a08\u753b\u3092\u8868\u793a\u3059\u308b\u3002--destroy \u30aa\u30d7\u30b7\u30e7\u30f3\u3067 destroy \u6642\u306e\u5b9f\u884c\u8a08\u753b\u3092\u8868\u793a\u3067\u304d\u308b\u3002\n\nterraform apply: plan \u3092\u5b9f\u884c\u3059\u308b\u3002\n\nterraform destroy: terraform \u3067\u4f5c\u3063\u305f\u30ea\u30bd\u30fc\u30b9\u3092\u7834\u68c4\u3059\u308b\n\nterraform fmt: tf\u30d5\u30a1\u30a4\u30eb\u3092\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3059\u308b\n\n\u57fa\u672c\u7684\u306b\u306f apply \u306e\u524d\u306b\u304b\u306a\u3089\u305a plan \u3067\u5b9f\u884c\u8a08\u753b\u3092\u78ba\u8a8d\u3059\u308b\u3053\u3068\u3092\u5fb9\u5e95\u3057\u3066\u304f\u3060\u3055\u3044\u3002 destroy \u306f\u5b9f\u969b\u306b\u306f\u307b\u3068\u3093\u3069\u4f7f\u3046\u3053\u3068\u306f\u306a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u307e\u305f\u3001terraform.tfstate \u3092 git \u3067\u7ba1\u7406\u3057\u305f\u308a\u3001\u4ed6\u4eba\u306e\u76ee\u306b\u89e6\u308c\u308b\u3088\u3046\u306a\u72b6\u614b\u306b\u3057\u306a\u3044\u3053\u3068\u3092\u304a\u5fd8\u308c\u306a\u304f\u3002\n\n3. remote state \u3092\u7ba1\u7406\u3059\u308b\nterraform.tfstate \u30d5\u30a1\u30a4\u30eb\u306f\u30ea\u30e2\u30fc\u30c8\u306e\u72b6\u614b\u3092\u7ba1\u7406\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002apply \u304c\u6210\u529f\u3059\u308b\u3068\u3001\u3069\u306e\u3088\u3046\u306a\u30ea\u30bd\u30fc\u30b9\u304c\u3069\u306e\u3088\u3046\u306a\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u4f5c\u6210\u3055\u308c\u305f\u306e\u304b\u3092\u7d30\u304b\u304f\u8a18\u9332\u3057\u3066\u3044\u307e\u3059\u3002\ntfstate \u30d5\u30a1\u30a4\u30eb\u3092\u8aa4\u3063\u3066\u524a\u9664\u3059\u308b\u3068 terraform \u306f\u30ea\u30e2\u30fc\u30c8\u306b\u30ea\u30bd\u30fc\u30b9\u304c\u5b58\u5728\u3057\u306a\u3044\u3068\u8a8d\u8b58\u3057\u3066\u3001tf \u30d5\u30a1\u30a4\u30eb\u306b\u5b9a\u7fa9\u3055\u308c\u305f\u69cb\u6210\u3092\u65b0\u898f\u4f5c\u6210\u3057\u3088\u3046\u3068\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u3057\u304c\u3063\u3066\u4f55\u3089\u304b\u306e\u5f62\u3067\u3001\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u7ba1\u7406\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001\u79d8\u533f\u60c5\u5831\u304c\u591a\u5206\u306b\u542b\u307e\u308c\u3066\u3044\u308b\u305f\u3081\u5358\u7d14\u306b git \u3067\u7ba1\u7406\u3059\u308b\u308f\u3051\u306b\u306f\u3044\u304d\u307e\u305b\u3093\u3002\n\u7ba1\u7406\u3059\u308b\u65b9\u6cd5\u306f\u4f55\u901a\u308a\u304b\u3042\u308b\u306e\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u306f private \u306a S3 bucket \u3092\u4f7f\u3063\u3066\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u7ba1\u7406\u3059\u308b\u65b9\u6cd5\u3092\u3054\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n3-1. tfsate\u7ba1\u7406\u7528 S3 bucket \u306e\u4f5c\u6210\nS3 bucket \u306e\u4f5c\u6210\u306f\u524d\u7bc0\u3067\u3084\u3063\u305f\u306e\u3067\u3082\u3046\u304d\u3063\u3068\u7406\u89e3\u3067\u304d\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u5fa9\u7fd2\u304c\u3066\u3089\u3084\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002remote_state.tf \u3068\u3044\u3046\u540d\u524d\u3067\u6b21\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\nresource \"aws_s3_bucket\" \"terraform_tutorial_tfsate\" {\n    bucket = \"com.github.53ningen.terraform.tutorial.tfstate\" # S3 bucket \u540d\u306f global \u3067\u4e00\u610f\u306b\u306a\u308b\u3088\u3046\u306b\n    acl = \"private\"\n    versioning {\n        enabled = true\n    }\n}\n\nterraform plan \u3067\u5b9f\u884c\u8a08\u753b\u3092\u78ba\u8a8d\u3057\u305f\u306e\u3061\u3001terraform apply \u3067 bucket \u3092\u4f5c\u6210\u3057\u307e\u3059\u3002terraform \u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u3088\u308b\u3068 versioning \u3092\u6709\u52b9\u306b\u3059\u308b\u3053\u3068\u304c\u63a8\u5968\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n3-2. tfstate\u7ba1\u7406\u8a2d\u5b9a\u3092\u884c\u3046\n\u7121\u4e8b S3 bucket \u304c\u4f5c\u6210\u3055\u308c\u305f\u3089 terraform remote config \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066 tfstate \u30d5\u30a1\u30a4\u30eb\u306e\u7ba1\u7406\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u306e bucket \u3084 access_key \u306a\u3069\u306f\u81ea\u5206\u306e\u3082\u306e\u306b\u9069\u5b9c\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n% terraform remote config \\\n    -backend=S3 \\\n    -backend-config=\"bucket=com.github.53ningen.terraform.tutorial.tfstate\" \\\n    -backend-config=\"region=ap-northeast-1\" \\\n    -backend-config=\"key=terraform.tfstate\" \\\n    -backend-config=\"access_key=${access_key}\" \\\n    -backend-config=\"secret_key=${ecret_key}\"\nRemote state management enabled\nRemote state configured and pulled.\n\n\u3053\u3053\u3067 key \u3068\u3044\u3046\u306e\u306f S3 \u4e0a\u3067\u3069\u306e\u3088\u3046\u306a\u540d\u524d\u3067 tfstate \u30d5\u30a1\u30a4\u30eb\u3092\u7ba1\u7406\u3059\u308b\u304b\u3068\u3044\u3046\u6307\u5b9a\u306b\u306a\u308a\u307e\u3059\u3002\u4eca\u30b3\u30de\u30f3\u30c9\u304c\u7121\u4e8b\u901a\u308b\u3068\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3042\u3063\u305f terraform.tfstate \u306f\u304d\u3063\u3068 .terraform \u4e0b\u306b\u79fb\u52d5\u3059\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n3-3. remote \u306b tfstate \u3092 push \u3059\u308b\n\u3055\u3066\u3001\u7ba1\u7406\u8a2d\u5b9a\u304c\u7121\u4e8b\u304a\u308f\u3063\u305f\u3089 S3 \u306b tfstate \u30d5\u30a1\u30a4\u30eb\u3092\u8ee2\u9001\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n% terraform remote push\nState successfully pushed!\n\n\u30ea\u30e2\u30fc\u30c8\u3078\u306e terraform apply \u3092\u884c\u3063\u305f\u5834\u5408\u306f\u5fc5\u305a terraform remote push \u3092\u884c\u3044\u307e\u3057\u3087\u3046\u3002\n\n3-4. remote \u304b\u3089 tfstate \u3092 pull \u3059\u308b\n\u666e\u901a\u306b\u3044\u304b\u306e\u3088\u3046\u306a\u611f\u3058\u306b\u306a\u308a\u307e\u3059\u3002\u8907\u6570\u4eba\u3067\u306e\u958b\u767a\u3067\u3001\u4ed6\u4eba\u304c apply \u3057\u305f\u3042\u3068\u306e remote state \u3092\u53cd\u6620\u3055\u305b\u305f\u3044\u5834\u5408\u306a\u3069\u306b\u4f7f\u3044\u307e\u3059\u3002\n% terraform remote pull\nLocal and remote state in sync\n\n\n4. \u3088\u308a\u9ad8\u5ea6\u306a\u30ea\u30bd\u30fc\u30b9\u5b9a\u7fa9\u3092\u884c\u3046\n\n4-1. \u5909\u6570\u3092\u7528\u3044\u308b\naws \u306e access_key \u3084 secret_key \u3092 variable.tf \u306b\u76f4\u63a5\u66f8\u304d\u8fbc\u3093\u3067\u3044\u307e\u3059\u304c\u3001\u5909\u6570\u3068\u3044\u3046\u6a5f\u80fd\u3092\u4f7f\u3048\u3070\u3001\u5b9f\u884c\u6642\u306b\u6307\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\nvariable.tf\nprovider \"aws\" {\n  region = \"ap-northeast-1\"\n  access_key = \"${var.access_key}\"\n  secret_key = \"${var.secret_key}\"\n}\n\nvariable \"access_key\" {}\nvariable \"secret_key\" {}\n\n\n\u3053\u306e\u3088\u3046\u306b\u3057\u305f\u4e0a\u3067\u3001terraform plan \u3092\u5b9f\u884c\u3059\u308b\u3068\u5404\u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u3057\u3066\u3069\u306e\u5024\u3092\u3068\u308b\u304b\u3092\u5bfe\u8a71\u5f0f\u306b\u5c0b\u306d\u3089\u308c\u307e\u3059\u3002\n% terraform plan\nvar.access_key\n  Enter a value: hoge\n\nvar.secret_key\n  Enter a value: fuga\n\nRefreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n\n...\u4ee5\u4e0b\u7565\n\n\u307e\u305f\u3001\u6b21\u306e\u3088\u3046\u306b\u5909\u6570\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u6307\u5b9a\u3057\u3066\u304a\u304f\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\nvariable.tf\nprovider \"aws\" {\n  region = \"${var.region}\"\n  access_key = \"${var.access_key}\"\n  secret_key = \"${var.secret_key}\"\n}\n\nvariable \"access_key\" {}\nvariable \"secret_key\" {}\nvariable \"region\" {\n  default = \"ap-northeast-1\"\n}\n\n\n\n4-2. \u74b0\u5883\u5909\u6570\u3092\u7528\u3044\u308b\nCLI\u304b\u3089 access_key \u3084 secret_key \u3092\u6bce\u56de\u6307\u5b9a\u3059\u308b\u306e\u3082\u9762\u5012\u306a\u306e\u3067\u3001\u74b0\u5883\u5909\u6570\u3092\u7528\u3044\u308b\u3068\u697d\u305d\u3046\u3067\u3059\u3002terraform \u3067\u306f TF_VAR_ \u3068\u3044\u3046\u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u304c\u3064\u3044\u305f\u74b0\u5883\u5909\u6570\u3092 .tf \u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u3067\u7528\u3044\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3055\u3063\u305d\u304f\u3001\u3053\u308c\u3092\u7528\u3044\u3066 access_key, secret_key \u3092\u74b0\u5883\u5909\u6570\u304b\u3089\u53d6\u3063\u3066\u304f\u308b\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3057\u3087\u3046\u3002\n% echo 'export TF_VAR_MY_AWS_ACCESS_KEY=XXXXXXXXXXX' >> ~/.bash_profile\n% echo 'export TF_VAR_MY_AWS_SECRET_KEY=XXXXXXXXXXX' >> ~/.bash_profile\n% source ~/.bash_profile\n\n\u7d9a\u3044\u3066 variable.tf \u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3057\u3087\u3046\n\nvariable.tf\nprovider \"aws\" {\n  region = \"${var.region}\"\n  access_key = \"${var.MY_AWS_ACCESS_KEY}\"\n  secret_key = \"${var.MY_AWS_SECRET_KEY}\"\n}\n\nvariable \"MY_AWS_ACCESS_KEY\" {}\nvariable \"MY_AWS_SECRET_KEY\" {}\nvariable \"region\" {\n  default = \"ap-northeast-1\"\n}\n\n\nterraform plan \u3092\u5909\u6570\u6307\u5b9a\u306a\u3057\u3067\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308c\u3070\u3001\u7121\u4e8b\u74b0\u5883\u5909\u6570\u306e\u5229\u7528\u304c\u3067\u304d\u3066\u3044\u308b\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n4-3. \u4f9d\u5b58\u7ba1\u7406\u306e\u3042\u308b\u30ea\u30bd\u30fc\u30b9\u5b9a\u7fa9\u3092\u884c\u3046\n\u3088\u308a\u8907\u96d1\u306a\u30ea\u30bd\u30fc\u30b9\u3092\u69cb\u6210\u3059\u308b\u3068\u304d\u306b\u306f\u3001\u30ea\u30bd\u30fc\u30b9\u540c\u58eb\u306b\u4f9d\u5b58\u95a2\u4fc2\u304c\u751f\u3058\u307e\u3059\u3002\u305f\u3068\u3048\u3070 terraform \u3067\u4f5c\u6210\u3057\u305f IAM \u30e6\u30fc\u30b6\u30fc\u306b\u30dd\u30ea\u30b7\u30fc\u3092\u30a2\u30bf\u30c3\u30c1\u3057\u305f\u3044\u3068\u304d\u306b\u3001\u30ea\u30bd\u30fc\u30b9\u9593\u306b\u4f9d\u5b58\u304c\u751f\u3058\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u3044\u307e\u3001 IAM \u30e6\u30fc\u30b6\u30fc cocoa \u3055\u3093\u3092\u4f5c\u6210\u3057 IAMReadOnlyAccess \u30dd\u30ea\u30b7\u30fc\u3092\u30a2\u30bf\u30c3\u30c1\u3057\u305f\u3044\u3068\u3057\u307e\u3059\u3002\u305d\u306e\u5834\u5408\u306e .tf \u30d5\u30a1\u30a4\u30eb\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3059\u308c\u3070OK\u3067\u3059\u3002\n\niam.tf\n# IAM \u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\nresource \"aws_iam_user\" \"cocoa\" {\n  name = \"cocoa\"\n  path = \"/\"\n}\n\n# IAM \u30dd\u30ea\u30b7\u30fc\u306e\u30a2\u30bf\u30c3\u30c1\nresource \"aws_iam_policy_attachment\" \"IAMReadOnlyAccess-policy-attachment\" {\n  name       = \"IAMReadOnlyAccess-policy-attachment\"\n\n  # IAMReadOnlyAccess \u306e ARN\n  policy_arn = \"arn:aws:iam::aws:policy/IAMReadOnlyAccess\"\n  groups     = []\n\n  # \u4e0a\u3067\u5b9a\u7fa9\u3057\u305f cocoa \u30e6\u30fc\u30b6\u30fc\u306e name \u3092\u53c2\u7167\u3057\u3066\u3044\u308b\n  users      = [\"${aws_iam_user.cocoa.name}\"]  \n  roles      = []\n}\n\n\nterraform plan \u3092\u5b9f\u884c\u3059\u308b\u3068\u4f9d\u5b58\u95a2\u4fc2\u304c\u89e3\u6c7a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3067\u3057\u3087\u3046\u3002\n% terraform plan\nRefreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n\naws_s3_bucket.terraform_tutorial_tfsate: Refreshing state... (ID: com.github.53ningen.terraform.tutorial.tfstate)\n\nThe Terraform execution plan has been generated and is shown below.\nResources are shown in alphabetical order for quick scanning. Green resources\nwill be created (or destroyed and then created if an existing resource\nexists), yellow resources are being changed in-place, and red resources\nwill be destroyed. Cyan entries are data sources to be read.\n\nNote: You didn't specify an \"-out\" parameter to save this plan, so when\n\"apply\" is called, Terraform can't guarantee this is what will execute.\n\n+ aws_iam_policy_attachment.IAMReadOnlyAccess-policy-attachment\n    name:             \"IAMReadOnlyAccess-policy-attachment\"\n    policy_arn:       \"arn:aws:iam::aws:policy/IAMReadOnlyAccess\"\n    users.#:          \"1\"\n    users.3920907786: \"cocoa\"\n\n+ aws_iam_user.cocoa\n    arn:           \"<computed>\"\n    force_destroy: \"false\"\n    name:          \"cocoa\"\n    path:          \"/\"\n    unique_id:     \"<computed>\"\n\n\nPlan: 2 to add, 0 to change, 0 to destroy.\n\n\n4-4. \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u3046\n\u8907\u96d1\u306a\u30ea\u30bd\u30fc\u30b9\u3092\u7ba1\u7406\u3059\u308b\u3068\u304d\u306b\u306f\u8a2d\u5b9a\u3060\u3051\u3092\u307e\u3068\u3081\u305f\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u4f7f\u3048\u308b\u3068\u4fbf\u5229\u305d\u3046\u3067\u3059\u3002 terraform \u306b\u306f\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u3046\u4ed5\u7d44\u307f\u3082\u5099\u308f\u3063\u3066\u3044\u307e\u3059\u3002\u4eca\u56de\u306f AWS \u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u6307\u5b9a\u3092\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u5207\u308a\u51fa\u3057\u307e\u3057\u3087\u3046\u3002variable.tf \u306e region \u5909\u6570\u304b\u3089 default \u5024\u3092\u524a\u9664\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nprovider \"aws\" {\n  region = \"${var.region}\"\n  access_key = \"${var.access_key}\"\n  secret_key = \"${var.secret_key}\"\n}\n\nvariable \"access_key\" {}\nvariable \"secret_key\" {}\nvariable \"region\" {\n-  default = \"ap-northeast-1\"\n}\n\n\u305d\u3057\u3066 config.tfvars \u3068\u3044\u3046\u540d\u524d\u3067\u6b21\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3057\u307e\u3057\u3087\u3046\u3002\n\nconfig.tfvars\nregion = \"ap-northeast-1\"\n\n\n\u3042\u3068\u306f terraform plan \u3084 terraform apply \u6642\u306b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3057\u3066\u3042\u3052\u308c\u3070OK\u3067\u3059\u3002\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u6307\u5b9a\u306f -var-file= \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u3044\u307e\u3059\u3002\n% terraform plan -var-file=./config.tfvars\nRefreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n\n# \u4ee5\u4e0b\u7565\n\n\n4-5. \u51fa\u529b\u3092\u884c\u3046\nterrform apply \u5f8c\u306b\u4f5c\u6210\u3055\u308c\u305f\u30ea\u30bd\u30fc\u30b9\u306eARN\u304c\u77e5\u308a\u305f\u3044\u5834\u5408\u306a\u3069\u306f output \u3068\u3044\u3046\u6a5f\u80fd\u3092\u4f7f\u3046\u3068\u3088\u3044\u3067\u3057\u3087\u3046\u3002\u305f\u3068\u3048\u3070\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f cocoa \u30e6\u30fc\u30b6\u30fc\u306eARN\u3092\u51fa\u529b\u3055\u305b\u308b\u306b\u306f\u6b21\u306e\u3088\u3046\u306b\u3059\u308c\u3070 OK \u3067\u3059\u3002\nresource \"aws_iam_user\" \"cocoa\" {\n  name = \"cocoa\"\n  path = \"/\"\n}\n\n# IAM policy attatchments\n\nresource \"aws_iam_policy_attachment\" \"IAMReadOnlyAccess-policy-attachment\" {\n  name       = \"IAMReadOnlyAccess-policy-attachment\"\n  policy_arn = \"arn:aws:iam::aws:policy/IAMReadOnlyAccess\"\n  groups     = []\n  users      = [\"${aws_iam_user.cocoa.name}\"]\n  roles      = []\n}\n\n+ output \"cocoa_arn\" {\n+   value = \"${aws_iam_user.cocoa.arn}\"\n+ }\n\nterraform plan, terraform apply \u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u3087\u3046\n% terraform apply\naws_iam_user.cocoa: Refreshing state... (ID: cocoa)\naws_s3_bucket.terraform_tutorial_tfsate: Refreshing state... (ID: com.github.53ningen.terraform.tutorial.tfstate)\naws_iam_policy_attachment.IAMReadOnlyAccess-policy-attachment: Refreshing state... (ID: IAMReadOnlyAccess-policy-attachment)\n\nApply complete! Resources: 0 added, 0 changed, 0 destroyed.\n\nOutputs:\n\ncocoa_arn = arn:aws:iam::XXXXXXXXXXXX:user/cocoa\n\n\u3057\u3063\u304b\u308a\u3068 ARN \u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n5. \u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u8907\u6570\u306e\u30b9\u30c6\u30fc\u30b8\u3078\u306e\u5bfe\u5fdc\nterraform \u306f\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u7f6e\u304b\u308c\u3066\u3044\u308b .tf \u30d5\u30a1\u30a4\u30eb\u3092\u5b9f\u884c\u3059\u308b\u3068\u3044\u3046\u3068\u3066\u3082\u5358\u7d14\u306a\u3075\u308b\u307e\u3044\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002\u3057\u304b\u3057\u8907\u6570\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u69cb\u9020\u5316\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u3092\u4fdd\u5b58\u3057\u305f\u3044\u5834\u5408\u3084\u3001\u8907\u6570\u306e\u30b9\u30c6\u30fc\u30b8\u3092\u4f5c\u308b\u305f\u3081\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u3060\u3051\u5909\u3048\u3066\u547c\u3073\u51fa\u3057\u305f\u3044\u306a\u3069\u3055\u307e\u3056\u307e\u306b\u7406\u7531\u306b\u3088\u308a\u3001\u7570\u306a\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4e0b\u306b\u3042\u308b\u3082\u306e\u3092\u547c\u3073\u51fa\u3057\u305f\u3044\u3053\u3068\u304c\u3042\u308b\u3067\u3057\u3087\u3046\u3002\u305d\u306e\u3068\u304d\u306b\u4f7f\u3048\u308b\u306e\u304c\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u3044\u3046\u6a5f\u80fd\u3067\u3059\u3002\n\n5-1. \u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u5229\u7528\u306e\u57fa\u790e\n\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8a66\u3059\u305f\u3081\u306b\u307e\u305a\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\u3092\u4f5c\u308a\u307e\u3057\u3087\u3046\u3002\n% tree\n.\n\u251c\u2500\u2500 dev\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 modules.tf\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 variable.tf\n\u251c\u2500\u2500 modules\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 s3\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 s3.tf\n\u2514\u2500\u2500 prod\n    \u251c\u2500\u2500 modules.tf\n    \u2514\u2500\u2500 variable.tf\n\nmodules \u306b \u305d\u308c\u305e\u308c\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u304f\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\u4eca\u56de\u306f\u30b5\u30f3\u30d7\u30eb\u3068\u3057\u3066 dev/prod \u5411\u304d\u305d\u308c\u305e\u308c\u306e S3 bucket \u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u307e\u305a\u306f modules/s3/s3.tf \u306e\u4e2d\u8eab\u304b\u3089\u3002\n\nmodules/s3/s3.tf\nresource \"aws_s3_bucket\" \"tutorial_s3\" {\n  bucket = \"${var.env}.53nigen.github.com.tutorial.s3\" # S3 bucket \u540d\u306f global \u3067\u4e00\u610f\u306b\u306a\u308b\u3088\u3046\u306b\n  acl    = \"private\"\n\n  versioning {\n    enabled = false\n  }\n}\n\nvariable \"env\" {}\n\n\n\u7d9a\u3044\u3066 dev/modules.tf, prod/modules.tf \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u306b\u305d\u308c\u305e\u308c\u3001modules/s3 \u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u53d6\u308a\u8fbc\u3093\u3067\u5b9f\u884c\u3059\u308b\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u307f\u307e\u3057\u3087\u3046\u3002modules \u3068\u3044\u3046\u65b0\u305f\u306a\u69cb\u6587\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\ndev/modules.tf\nmodule \"s3\" {\n  source = \"../modules/s3\"  # \u3053\u3053\u3067\u8aad\u307f\u8fbc\u3080\u30d1\u30b9\u3092\u6307\u5b9a\n\n  env = \"${var.env}\"\n}\n\nvariable \"env\" {\n  default = \"dev\"  # prod \u306e\u307b\u3046\u306b\u306f prod \u3068\u66f8\u3044\u3066\u304f\u3060\u3055\u3044\n}\n\n\n\u6700\u5f8c\u306b\u3001dev/variable.tf, prod/variable.tf \u306b\u5bfe\u3057\u3066\u3001AWS \u3092\u64cd\u4f5c\u3059\u308b\u8a2d\u5b9a\u5024\u306a\u3069\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\ndev/variable.tf\nprovider \"aws\" {\n  region = \"${var.region}\"\n  access_key = \"${var.access_key}\"\n  secret_key = \"${var.secret_key}\"\n}\n\nvariable \"access_key\" {}\nvariable \"secret_key\" {}\nvariable \"region\" {\n  default = \"ap-northeast-1\"\n}\n\n\n\u3053\u308c\u3067\u6e96\u5099\u304c\u6574\u3044\u307e\u3057\u305f\u3002dev \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4e0b\u304b\u3089\u5b9f\u884c\u3059\u308b\u3068 dev \u74b0\u5883\u5411\u3051\u306e\u69cb\u6210\u3001prod \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4e0b\u304b\u3089\u5b9f\u884c\u3059\u308b\u3068 prod \u74b0\u5883\u5411\u3051\u306e\u69cb\u6210\u3092\u7ba1\u7406\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 dev \u74b0\u5883\u5411\u3051\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u5b9f\u969b\u306b\u4f5c\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002 dev \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3057\u3066\u3001terraform get \u3092\u5b9f\u884c\u3057\u3066\u4f9d\u5b58\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30b3\u30fc\u30c9\u3092\u53d6\u308a\u8fbc\u307f\u3092\u524d\u3082\u3063\u3066\u3084\u3063\u3066\u304a\u304f\u4ee5\u5916\u306f\u3001\u3044\u307e\u307e\u3067\u3068\u57fa\u672c\u7684\u306b\u306f\u540c\u3058\u64cd\u4f5c\u3067 OK \u3067\u3059\u3002\n% cd dev/                                                                                                     % terraform get                                                                                               \nGet: file:///Users/yuki_yanagi/tutoterra/sample/modules/s3\n% terraform plan                                                                                              Refreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n\n\nThe Terraform execution plan has been generated and is shown below.\nResources are shown in alphabetical order for quick scanning. Green resources\nwill be created (or destroyed and then created if an existing resource\nexists), yellow resources are being changed in-place, and red resources\nwill be destroyed. Cyan entries are data sources to be read.\n\nNote: You didn't specify an \"-out\" parameter to save this plan, so when\n\"apply\" is called, Terraform can't guarantee this is what will execute.\n\n+ module.s3.aws_s3_bucket.tutorial_s3\n    acceleration_status:           \"<computed>\"\n    acl:                           \"private\"\n    arn:                           \"<computed>\"\n    bucket:                        \"dev.53nigen.github.com.tutorial.s3\"\n    force_destroy:                 \"false\"\n    hosted_zone_id:                \"<computed>\"\n    policy:                        \"<computed>\"\n    region:                        \"<computed>\"\n    request_payer:                 \"<computed>\"\n    versioning.#:                  \"1\"\n    versioning.2972667452.enabled: \"false\"\n    website_domain:                \"<computed>\"\n    website_endpoint:              \"<computed>\"\n\n\nPlan: 1 to add, 0 to change, 0 to destroy.\n% terraform apply\nmodule.s3.aws_s3_bucket.tutorial_s3: Creating...\n  acceleration_status:           \"\" => \"<computed>\"\n  acl:                           \"\" => \"private\"\n  arn:                           \"\" => \"<computed>\"\n  bucket:                        \"\" => \"dev.53nigen.github.com.tutorial.s3\"\n  force_destroy:                 \"\" => \"false\"\n  hosted_zone_id:                \"\" => \"<computed>\"\n  policy:                        \"\" => \"<computed>\"\n  region:                        \"\" => \"<computed>\"\n  request_payer:                 \"\" => \"<computed>\"\n  versioning.#:                  \"\" => \"1\"\n  versioning.2972667452.enabled: \"\" => \"false\"\n  website_domain:                \"\" => \"<computed>\"\n  website_endpoint:              \"\" => \"<computed>\"\nmodule.s3.aws_s3_bucket.tutorial_s3: Creation complete\n\nApply complete! Resources: 1 added, 0 changed, 0 destroyed.\n\nThe state of your infrastructure has been saved to the path\nbelow. This state is required to modify and destroy your\ninfrastructure, so keep it safe. To inspect the complete state\nuse the `terraform show` command.\n\nState path: terraform.tfstate\n\n\n5-2. \u8907\u6570\u30b9\u30c6\u30fc\u30b8\u3078\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u7528\u3044\u305f\u306e\u5bfe\u5fdc\u4f8b\n\u3053\u306e\u3088\u3046\u306a\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u6a5f\u80fd\u3092\u7528\u3044\u3066 dev \u3084 production \u306a\u3069\u8907\u6570\u306e\u30b9\u30c6\u30fc\u30b8\u5411\u3051\u306b\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u308b\u3088\u3046\u306b\u66f4\u751f\u3059\u308b\u5834\u5408\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\u3068\u3057\u3066\u7279\u306b\u6c7a\u307e\u3063\u3066\u3044\u308b\u3082\u306e\u306f\u306a\u3044\u306e\u3067\u3059\u304c\u3001\u512a\u308c\u305f\u3082\u306e\u3068\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5f62\u304c\u3042\u308b\u306e\u3067\u3001\u53c2\u8003\u306b\u3057\u306a\u304c\u3089\u9032\u3081\u308b\u3068\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u30aa\u30ec\u30aa\u30ecterraform\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\nTerraform\u306b\u304a\u3051\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\n\n\n6. \u65e2\u5b58\u306eAWS\u30ea\u30bd\u30fc\u30b9\u3092 terraform \u3067\u7ba1\u7406\u3059\u308b\n\n6-1. terraforming \u306e\u5c0e\u5165\nterraforming \u306f\u65e2\u5b58\u306eAWS\u30ea\u30bd\u30fc\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066terraform\u306e\u30b3\u30fc\u30c9\u3092\u751f\u6210\u3057\u3066\u304f\u308c\u305f\u308a\u3001tfstate\u3092\u751f\u6210\u3057\u3066\u304f\u308c\u305f\u308a\u3059\u308b\u30c4\u30fc\u30eb\u3067\u3059\u3002\u5c0e\u5165\u306f Gemfile \u306b\u6b21\u306e\u3088\u3046\u306b\u66f8\u3044\u3066\u3001bundle install \u3059\u308c\u3070OK\u3067\u3059\u3002\n\nGemfile\nsource \"https://rubygems.org\"\n\ngem 'terraforming', '0.10.0'\n\n\n\n6-2. \u65e2\u5b58\u306e IAM user \u3092 terraform \u3067\u7ba1\u7406\u3059\u308b\nAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u6301\u3063\u3066\u3044\u308b\u307b\u307c\u5168\u3066\u306e\u4eba\u306f\u3001\u3059\u3067\u306b IAM user \u306a\u3069\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u6301\u3063\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u5f93\u3063\u3066\u3001\u307e\u305a\u3053\u3053\u3092 terraform \u3067\u7ba1\u7406\u3059\u308b\u5f62\u306b\u3057\u307e\u3057\u3087\u3046\u3002\u6b21\u306e\u3088\u3046\u306b\u3059\u308b\u3068\u73fe\u5728\u306eIAM user\u30ea\u30bd\u30fc\u30b9\u306b\u5fdc\u3058\u305fHCL\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n% terraforming iamu --profile default\nresource \"aws_iam_user\" \"gomi_ningen\" {\n    name = \"gomi_ningen\"\n    path = \"/\"\n}\n\n\u3053\u308c\u3092\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304d\u51fa\u3057\u307e\u3057\u3087\u3046\u3002\n\niam.tf\nresource \"aws_iam_user\" \"gomi_ningen\" {\n    name = \"gomi_ningen\"\n    path = \"/\"\n}\n\n\n\u307e\u305f\u30ea\u30e2\u30fc\u30c8\u306e\u72b6\u614b\u3092\u624b\u5143\u306e .tfstate \u30d5\u30a1\u30a4\u30eb\u306b\u53cd\u6620\u3055\u305b\u306a\u3051\u308c\u3070\u3001terraform \u306f\u30ea\u30bd\u30fc\u30b9\u3092\u65b0\u898f\u306b\u4f5c\u6210\u3057\u3088\u3046\u3068\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\nterraforming iamu --tfstate --profile default --merge=.terraform/terraform.tfstate\n\u51fa\u529b\u3092\u307f\u3066\u554f\u984c\u306a\u3055\u305d\u3046\u3067\u3042\u308c\u3070\u3001\u3053\u306e\u30b3\u30de\u30f3\u30c9\u306b --overwrite \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u52a0\u3057\u3066\u53cd\u6620\u3055\u305b\u307e\u3059\u3002\u3053\u306e\u306e\u3061\u306b terraform plan \u3092\u3057\u3066\u5dee\u5206\u304c\u3067\u306a\u3051\u308c\u3070\u3001\u6674\u308c\u3066 IAM user \u306e\u7ba1\u7406\u3092 terraform \u306b\u79fb\u884c\u3067\u304d\u305f\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\nterraform plan \u6642\u306b\u3082\u3057\u3082\u3001 destroy \u3055\u308c\u308b\u30ea\u30bd\u30fc\u30b9\u304c\u8868\u793a\u3055\u308c\u305f\u3068\u3057\u305f\u3089\u3001\u65e2\u5b58\u306e\u30ea\u30bd\u30fc\u30b9\u3084\u30b7\u30b9\u30c6\u30e0\u304c\u7834\u58ca\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u7279\u306b\u614e\u91cd\u306b\u64cd\u4f5c\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u307e\u305f\u3001IAM policy \u306a\u3069\u306b\u3064\u3044\u3066\u306f JSON \u306e\u6539\u884c\u4f4d\u7f6e\u3084\u30a4\u30f3\u30c7\u30f3\u30c8\u306a\u3069\u304c\u5dee\u5206\u3068\u3057\u3066\u51fa\u3084\u3059\u3044\u306e\u3067\u3001\u60a9\u3093\u3060\u3068\u304d\u306f\u305d\u306e\u3042\u305f\u308a\u304c\u65e2\u5b58\u306e\u30dd\u30ea\u30b7\u30fc\u8a2d\u5b9a\u3068\u98df\u3044\u9055\u3063\u3066\u3044\u306a\u3044\u304b\u78ba\u8a8d\u3059\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002\n\u3055\u3066\u3001terraforming \u306f\u3088\u304f\u4f7f\u308f\u308c\u308b\u307b\u3068\u3093\u3069\u306e AWS \u30ea\u30bd\u30fc\u30b9\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u307e\u305a\u306f\u3053\u308c\u3092\u4f7f\u3063\u3066\u3067\u304d\u308b\u3068\u3053\u308d\u307e\u3067 terraform \u306b\u79fb\u884c\u3059\u308b\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002v0.7.0 \u3067\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u3082\u306e\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\n% terraforming help\nCommands:\n  terraforming asg             # AutoScaling Group\n  terraforming dbpg            # Database Parameter Group\n  terraforming dbsg            # Database Security Group\n  terraforming dbsn            # Database Subnet Group\n  terraforming ec2             # EC2\n  terraforming ecc             # ElastiCache Cluster\n  terraforming ecsn            # ElastiCache Subnet Group\n  terraforming eip             # EIP\n  terraforming elb             # ELB\n  terraforming help [COMMAND]  # Describe available commands or one specific command\n  terraforming iamg            # IAM Group\n  terraforming iamgm           # IAM Group Membership\n  terraforming iamgp           # IAM Group Policy\n  terraforming iamip           # IAM Instance Profile\n  terraforming iamp            # IAM Policy\n  terraforming iampa           # IAM Policy Attachment\n  terraforming iamr            # IAM Role\n  terraforming iamrp           # IAM Role Policy\n  terraforming iamu            # IAM User\n  terraforming iamup           # IAM User Policy\n  terraforming igw             # Internet Gateway\n  terraforming lc              # Launch Configuration\n  terraforming nacl            # Network ACL\n  terraforming nat             # NAT Gateway\n  terraforming nif             # Network Interface\n  terraforming r53r            # Route53 Record\n  terraforming r53z            # Route53 Hosted Zone\n  terraforming rds             # RDS\n  terraforming rs              # Redshift\n  terraforming rt              # Route Table\n  terraforming rta             # Route Table Association\n  terraforming s3              # S3\n  terraforming sg              # Security Group\n  terraforming sn              # Subnet\n  terraforming sqs             # SQS\n  terraforming vgw             # VPN Gateway\n  terraforming vpc             # VPC\n\n\n6-3. terraform \u306e\u30b3\u30fc\u30c9\u3092\u7ba1\u7406\u3059\u308b\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\n\u500b\u4eba\u30a2\u30ab\u30a6\u30f3\u30c8\u306eaws\u69cb\u6210\u3092open\u306agithub repository\u306b\u914d\u7f6e\u3059\u308b\u306e\u306f\u3001\u306f\u3070\u304b\u3089\u308c\u308b\u306e\u3067 code commit \u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u304a\u304f\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002\n\ncode_commit.tf\n# \u3053\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u306eAWS\u69cb\u6210\u3092\u7ba1\u7406\u3059\u308bterraform\u30b3\u30fc\u30c9\u3092\u914d\u7f6e\u3059\u308b\u30ec\u30dd\u30b8\u30c8\u30ea\nresource \"aws_codecommit_repository\" \"my-terraform\" {\n  repository_name = \"my-terraform\"\n  description = \"terrform\"\n}\n\n\ncode commit \u4e0a\u306b\u4f5c\u6210\u3057\u305f\u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u30dd\u30ea\u30b7\u30fc\u306e\u30a2\u30bf\u30c3\u30c1\u3001\u306a\u3089\u3073\u306b\u516c\u958b\u9375\u767b\u9332\u3082 terraform \u3092\u4f7f\u3063\u3066\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\niam.tf\n#...\n\nresource \"aws_iam_policy_attachment\" \"my_codecommit_policy_attachment\" {\n  name       = \"my_terraform_codecommit_policy_attachment\"\n  policy_arn = \"arn:aws:iam::aws:policy/AWSCodeCommitPowerUser\"\n  groups     = []\n  users      = [\"${aws_iam_user.gomi_ningen.name}\"]\n  roles      = []\n}\n\nresource \"aws_iam_user_ssh_key\" \"gomi_ningen\" {\n    username = \"${aws_iam_user.gomi_ningen.name}\"\n    encoding = \"PEM\"\n    public_key = <<EOF\n######################\n##### public_key #####\n######################\nEOF\n}\n\noutput \"aws_iam_user_ssh_key.gomi_ningen.ssh_key_id\"  {\n    value = \"${aws_iam_user_ssh_key.gomi_ningen.ssh_public_key_id}\"\n}\n\n\n\u3053\u306e\u72b6\u614b\u3067 terraform plan, terraform apply \u3092\u3057\u3066\u307f\u307e\u3059\n% terraform apply                                                                                                                                                     aws_s3_bucket.my_terraform_tfstate: Refreshing state... (ID: com.53ningen.aws.terraform.tfstates)\naws_codecommit_repository.my-terraform: Refreshing state... (ID: my-terraform)\n\n# \u4e2d\u7565\n\nOutputs:\n\naws_iam_user_ssh_key.gomi_ningen.ssh_key_id = XXXXXXXXXXXX\n\n\u3059\u308b\u3068\u4ee5\u4e0a\u306e\u3088\u3046\u306b\u4f5c\u6210\u3055\u308c\u305f ssh_public_key_id \u304c\u51fa\u529b\u3055\u308c\u308b\u306e\u3067\u3001\u3042\u3068\u306f\u3053\u3044\u3064\u3092 ~/.ssh/config \u306b\u53cd\u6620\u3055\u305b\u308c\u3070\u624b\u5143\u306e\u30de\u30b7\u30f3\u304b\u3089\u4f5c\u6210\u3057\u305f code commit \u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u758e\u901a\u304c\u3068\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n~/.ssh/config\nHost git-codecommit.*.amazonaws.com\n  User XXXXXXXXXXXX\n  IdentityFile ~/.ssh/id_rsa\n\n\n\n6-4. terraform import\nT.B.D\n\n7. \u69cb\u6210\u7ba1\u7406\u65b9\u6cd5\u306e\u6574\u7406\n\n7-1. \u500b\u4eba\u958b\u767a\u306e\u5834\u5408\n\u500b\u4eba\u306eAWS\u30ea\u30bd\u30fc\u30b9\u3092\u7ba1\u7406\u3059\u308b\u5834\u5408\u306f\u5927\u304d\u304f\u5206\u3051\u3066\u6b21\u306e2\u3064\u306e\u65b9\u6cd5\u304c\u3042\u308b\u304b\u3068\u601d\u3044\u307e\u3059\n\n\n.tfstate \u3054\u3068 git \u3067\u7ba1\u7406\u3057\u3066\u3001 code commit \u306b\u3076\u3061\u3053\u3080\n\n.tfstate \u306f S3 \u3067\u7ba1\u7406\u3001\u30b3\u30fc\u30c9\u306f code commit \u3067\u7ba1\u7406\n\n\n7-2. \u30c1\u30fc\u30e0\u958b\u767a\u306e\u5834\u5408\n\n\n.tfstate \u306f\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u4e0a\u306e\u7406\u7531\u304b\u3089 S3 \u3067\u7ba1\u7406\u3059\u308b\u3053\u3068\u304c\u671b\u307e\u3057\u3044\n\n.tfstate \u3084\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u306a\u3069\u3092\u542b\u3080\u3082\u306e\u3092\u30b3\u30df\u30c3\u30c8\u305b\u305a\u3001GitHub Enterprise, code commit, GitHub private repository \u306b push \u3059\u308b\n\nterrafrom \u306f\u3001\u30a4\u30f3\u30d5\u30e9\u306e\u69cb\u7bc9\u3084\u8a2d\u5b9a\u306a\u3069\u3092\u30b3\u30fc\u30c9\u3067\u8868\u73fe\u3057\u3066\u7ba1\u7406\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u30c4\u30fc\u30eb\u3067\u3059\u3002AWS \u3084 Azure\u3001 Heroku \u306a\u3069\u69d8\u3005\u306a\u74b0\u5883\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u3053\u306e\u8cc7\u6599\u306f\u30e9\u30d3\u30c3\u30c8\u30cf\u30a6\u30b9\u793e\u5185\u3067\u958b\u50ac\u3055\u308c\u308b\u3001 AWS \u30ea\u30bd\u30fc\u30b9\u3092 terrform \u3067\u7ba1\u7406\u3059\u308b\u305f\u3081\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u5411\u3051\u306b\u4f5c\u6210\u3057\u305f\u8cc7\u6599\u306b\u306a\u308a\u307e\u3059\u3002AWS \u69cb\u6210\u7ba1\u7406\u3092\u30b3\u30fc\u30c9\u3067\u7ba1\u7406\u3057\u305f\u3044\u306a\u3069\u3068\u601d\u3063\u3066\u3044\u308b\u65b9\u306e\u306a\u304b\u306b\u3082\u3001\u3053\u3046\u3044\u3063\u305f\u30c4\u30fc\u30eb\u304c\u9762\u5012\u81ed\u305d\u3046\u3060\u3068\u304b\u3001\u3059\u3050\u4f7f\u3048\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3044\u305d\u3046\u3060\u3068\u304a\u601d\u3044\u306e\u65b9\u304c\u591a\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u304c\u3001 terraform \u306e\u6319\u52d5\u306f\u3068\u3066\u3082\u30b7\u30f3\u30d7\u30eb\u3067\u5b66\u7fd2\u30b3\u30b9\u30c8\u306f\u3082\u306e\u3059\u3054\u3044\u4f4e\u3044\u30c4\u30fc\u30eb\u3067\u3059\u3002\u307e\u305f AWS \u69cb\u6210\u3092\u30b3\u30fc\u30c9\u5316\u3059\u308b\u3053\u3068\u3067\u3088\u308a\u6df1\u304f AWS \u306b\u3064\u3044\u3066\u7406\u89e3\u3059\u308b\u3053\u3068\u3067\u304d\u308b\u5074\u9762\u3082\u3042\u308b\u3068\u8003\u3048\u3066\u3044\u307e\u3059\u3002\n\n\u662f\u975e\u3053\u306e\u6a5f\u4f1a\u306b terraform \u306b\u5165\u9580\u3057\u3066\u307f\u307e\u305b\u3093\u304b...\uff1f \u3053\u306e\u8a18\u4e8b\u306e\u901a\u308a\u306b\u30b3\u30de\u30f3\u30c9\u3092\u5165\u529b\u3057\u3066\u3044\u3051\u3070\u3001\u304d\u3063\u3068\u3042\u306a\u305f\u3082\uff11\u6642\u9593\u3082\u3057\u306a\u3044\u3046\u3061\u306b terraform \u3092\u4f7f\u3044\u3053\u306a\u305b\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u3067\u3057\u3087\u3046\u3002\n\n\n\n## 1. \u74b0\u5883\u69cb\u7bc9\n\n\u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u306f `terraform v0.7.4` \u3092\u524d\u63d0\u3068\u3057\u3066\u8a71\u3092\u9032\u3081\u307e\u3059\n\n### Mac \u306e\u5834\u5408\n\n* [https://www.terraform.io/downloads.html](https://www.terraform.io/downloads.html)\n* `brew install terraform` \u3067\u3082\u53ef\n\n### Windows \u306e\u5834\u5408\n\n[https://www.terraform.io/downloads.html](https://www.terraform.io/downloads.html)\n\n### AWS \u5074\u306e\u6e96\u5099\n\n\u3042\u3089\u304b\u3058\u3081terraform\u3067\u7528\u3044\u308bIAM\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\n\n1. [IAM \u30e6\u30fc\u30b6\u30fc\u7ba1\u7406\u30da\u30fc\u30b8](https://console.aws.amazon.com/iam/home?region=ap-northeast-1#users)\u306b\u30a2\u30af\u30bb\u30b9\n2. \u65b0\u898f\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\n3. \u5fc5\u8981\u306a\u30dd\u30ea\u30b7\u30fc\u306e\u30a2\u30bf\u30c3\u30c1\n4. access_key, secret_key \u306e\u4f5c\u6210\n\n## 2. S3 bucket \u3092\u7ba1\u7406\u3059\u308b\n\n\u307e\u305a\u306f S3 bucket \u3092\u4f5c\u3063\u305f\u308a\u5909\u66f4\u3057\u305f\u308a\u58ca\u3057\u305f\u308a\u3057\u3066\u904a\u3093\u3067\u307f\u307e\u3057\u3087\u3046\u3002\u4e0b\u6e96\u5099\u3068\u3057\u3066\u3001\u9069\u5f53\u306a\u4f5c\u696d\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u6b21\u306b AWS \u30ea\u30bd\u30fc\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u3092\u66f8\u304d\u307e\u3059\u3002\n\n```file:variable.tf\nprovider \"aws\" {\n  region     = \"ap-northeast-1\"\n  access_key = \"***************\"\n  secret_key = \"***************\"\n}\n```\n\n### 2-1. S3 bucket \u3092\u4f5c\u308b\n\n\u65e9\u901f S3 bucket \u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u6b21\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u305f\u3060\u3057 **bucket \u306e\u540d\u79f0\u306f\u30b0\u30ed\u30fc\u30d0\u30eb\u3067\u4e00\u610f\u306b\u306a\u308b\u3088\u3046\u306b\u5b9a\u3081\u3066\u304f\u3060\u3055\u3044\u3002**\n\n```file:s3.tf\nresource \"aws_s3_bucket\" \"terraform_tutorial\" {\n    bucket = \"com.github.53ningen.terraform.tutorial\" # S3 bucket \u540d\u306f global \u3067\u4e00\u610f\u306b\u306a\u308b\u3088\u3046\u306b\n    acl = \"private\"\n    versioning {\n        enabled = true\n    }\n}\n```\n\n\u4ee5\u4e0a\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u3063\u305f\u3089\u3001`terraform validate` \u3067\u6b63\u3057\u3044 `.tf` \u30d5\u30a1\u30a4\u30eb\u3092\u8a18\u8ff0\u3067\u304d\u3066\u3044\u308b\u304b\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u304d\u3063\u3068\u4e0a\u8a18\u306e\u901a\u308a\u306b\u66f8\u3051\u3070\u554f\u984c\u306a\u304f\u30b3\u30de\u30f3\u30c9\u304c\u901a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u3064\u3065\u3044\u3066 `terraform plan` \u30b3\u30de\u30f3\u30c9\u3067\u3001\u3053\u308c\u304b\u3089\u3069\u306e\u3088\u3046\u306a\u3053\u3068\u304c\u5b9f\u884c\u3055\u308c\u308b\u306e\u304b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u3053\u306e\u64cd\u4f5c\u306f\u5e38\u306b\u5b89\u5168\u3067\u3001AWS\u306b\u5bfe\u3057\u3066\u60c5\u5831\u306e\u8aad\u307f\u3068\u308a\u64cd\u4f5c\u3057\u304b\u884c\u308f\u308c\u307e\u305b\u3093\u3002\n\n```\n% terraform plan\nRefreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n\n\nThe Terraform execution plan has been generated and is shown below.\nResources are shown in alphabetical order for quick scanning. Green resources\nwill be created (or destroyed and then created if an existing resource\nexists), yellow resources are being changed in-place, and red resources\nwill be destroyed. Cyan entries are data sources to be read.\n\nNote: You didn't specify an \"-out\" parameter to save this plan, so when\n\"apply\" is called, Terraform can't guarantee this is what will execute.\n\n+ aws_s3_bucket.terraform_tutorial\n    acceleration_status:         \"<computed>\"\n    acl:                         \"private\"\n    arn:                         \"<computed>\"\n    bucket:                      \"com.github.53ningen.terraform.tutorial\"\n    force_destroy:               \"false\"\n    hosted_zone_id:              \"<computed>\"\n    policy:                      \"<computed>\"\n    region:                      \"<computed>\"\n    request_payer:               \"<computed>\"\n    versioning.#:                \"1\"\n    versioning.69840937.enabled: \"true\"\n    website_domain:              \"<computed>\"\n    website_endpoint:            \"<computed>\"\n\n\nPlan: 1 to add, 0 to change, 0 to destroy.\n```\n\n`+ aws_s3_bucket.terraform_tutorial` \u3068\u3042\u308b\u3088\u3046\u306b S3 \u306e bucket \u304c\u4f5c\u6210\u3055\u308c\u308b\u3053\u3068\u304c\u78ba\u8a8d\u51fa\u6765\u305f\u306e\u3067 `terraform apply` \u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u969b\u306b\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```\n% terraform apply\naws_s3_bucket.terraform_tutorial: Creating...\n  acceleration_status:         \"\" => \"<computed>\"\n  acl:                         \"\" => \"private\"\n  arn:                         \"\" => \"<computed>\"\n  bucket:                      \"\" => \"com.github.53ningen.terraform.tutorial\"\n  force_destroy:               \"\" => \"false\"\n  hosted_zone_id:              \"\" => \"<computed>\"\n  policy:                      \"\" => \"<computed>\"\n  region:                      \"\" => \"<computed>\"\n  request_payer:               \"\" => \"<computed>\"\n  versioning.#:                \"\" => \"1\"\n  versioning.69840937.enabled: \"\" => \"true\"\n  website_domain:              \"\" => \"<computed>\"\n  website_endpoint:            \"\" => \"<computed>\"\naws_s3_bucket.terraform_tutorial: Creation complete\n\nApply complete! Resources: 1 added, 0 changed, 0 destroyed.\n\nThe state of your infrastructure has been saved to the path\nbelow. This state is required to modify and destroy your\ninfrastructure, so keep it safe. To inspect the complete state\nuse the `terraform show` command.\n\nState path: terraform.tfstate\n```\n\n\u7121\u4e8b\u3001\u6210\u529f\u3057\u305f\u3088\u3046\u3067\u3059\u306e\u3067\u3001\u3068\u308a\u3042\u3048\u305a aws cli \u304b\u3089 s3 bucket \u304c\u672c\u5f53\u306b\u5b58\u5728\u3059\u308b\u306e\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```\n% aws s3 ls\n...\n2016-10-10 17:28:13 com.github.53ningen.terraform.tutorial\n...\n```\n\n\u3061\u3083\u3093\u3068 `s3.tf` \u30d5\u30a1\u30a4\u30eb\u3067\u6307\u5b9a\u3057\u305f `com.github.53ningen.terraform.tutorial` \u3068\u3044\u3046\u540d\u524d\u306e bucket \u304c\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\u3055\u3066\u3001`terraform apply` \u304c\u7121\u4e8b\u306b\u6210\u529f\u3057\u305f\u3042\u3068\u306b\u306f `terraform.tfstate` \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u304c\u3067\u304d\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n```\n% ls -a\n.  ..  .git  s3.tf  terraform.tfstate  variable.tf\n```\n\n\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u8eab\u306f\u30ea\u30e2\u30fc\u30c8\uff08\u4eca\u306e\u5834\u5408AWS\uff09\u306e\u72b6\u614b\u3092\u4fdd\u5b58\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u306e\u4e2d\u306b\u306f\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3084\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u304c\u3075\u304f\u307e\u308c\u3066\u3044\u308b\u305f\u3081\u3001`git` \u7ba1\u7406\u5bfe\u8c61\u5916\u306b\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u7ba1\u7406\u306b\u3064\u3044\u3066\u306f\u306e\u3061\u307b\u3069 \u300cremote state \u306e\u7ba1\u7406\u300d\u306e\u7bc0\u3067\u3054\u8aac\u660e\u3057\u307e\u3059\u3002\u3068\u308a\u3042\u3048\u305a\u4ee5\u4e0b\u306e\u3088\u3046\u306a `.gitignore` \u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n```file:.gitignore\n.DS_Store\n*.tfstate\n*.tfstate.backup\nvendor/bundle\n.bundle/\nconfig.tfvars\n.terraform/\n```\n\n### 2-2. S3 bucket \u306e\u72b6\u614b\u3092\u5909\u66f4\u3059\u308b\n\n\u3055\u304d\u307b\u3069\u4f5c\u3063\u305f S3 bucket \u306f\u30d0\u30fc\u30b8\u30e7\u30cb\u30f3\u30b0\u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u308c\u3092\u7121\u52b9\u306b\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002`s3.tf` \u3092\u6b21\u306e\u3088\u3046\u306b\u4fee\u6b63\u3057\u307e\u3059\u3002\n\n```diff\nresource \"aws_s3_bucket\" \"terraform_tutorial\" {\n    bucket = \"com.github.53ningen.terraform.tutorial\" # S3 bucket \u540d\u306f global \u3067\u4e00\u610f\u306b\u306a\u308b\u3088\u3046\u306b\n    acl = \"private\"\n    versioning {\n-       enabled = true\n+       enabled = false\n   }\n}\n```\n\n\u7d9a\u3044\u3066 `terraform validate` \u30b3\u30de\u30f3\u30c9\u3067 `tf` \u30d5\u30a1\u30a4\u30eb\u306e\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u3092\u691c\u8a3c\u3057\u3001 `terraform plan` \u3067 AWS \u30ea\u30bd\u30fc\u30b9\u306b\u5bfe\u3057\u3066\u3069\u3046\u306e\u3088\u3046\u306a\u5909\u66f4\u304c\u884c\u308f\u308c\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n\n```\n% terraform plan\nRefreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n\naws_s3_bucket.terraform_tutorial: Refreshing state... (ID: com.github.53ningen.terraform.tutorial)\n\nThe Terraform execution plan has been generated and is shown below.\nResources are shown in alphabetical order for quick scanning. Green resources\nwill be created (or destroyed and then created if an existing resource\nexists), yellow resources are being changed in-place, and red resources\nwill be destroyed. Cyan entries are data sources to be read.\n\nNote: You didn't specify an \"-out\" parameter to save this plan, so when\n\"apply\" is called, Terraform can't guarantee this is what will execute.\n\n~ aws_s3_bucket.terraform_tutorial\n    versioning.2972667452.enabled: \"\" => \"false\"\n    versioning.69840937.enabled:   \"true\" => \"false\"\n\n\nPlan: 0 to add, 1 to change, 0 to destroy.\n```\n\n`Plan: 0 to add, 1 to change, 0 to destroy.` \u3068\u3042\u308b\u306e\u3067\u3001\u65e2\u5b58\u306e S3 \u306f\u524a\u9664\u3055\u308c\u305a\u3001\u8868\u793a\u3055\u308c\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u307f\u304c\u5909\u66f4\u3055\u308c\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\u78ba\u8a8d\u3092\u3057\u305f\u3089 `apply` \u3092\u3059\u308c\u3070 S3 \u306e\u72b6\u614b\u306e\u5909\u66f4\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n```\n% terraform apply\naws_s3_bucket.terraform_tutorial: Refreshing state... (ID: com.github.53ningen.terraform.tutorial)\naws_s3_bucket.terraform_tutorial: Modifying...\n  versioning.2972667452.enabled: \"\" => \"false\"\n  versioning.69840937.enabled:   \"true\" => \"false\"\naws_s3_bucket.terraform_tutorial: Modifications complete\n\nApply complete! Resources: 0 added, 1 changed, 0 destroyed.\n\nThe state of your infrastructure has been saved to the path\nbelow. This state is required to modify and destroy your\ninfrastructure, so keep it safe. To inspect the complete state\nuse the `terraform show` command.\n\nState path: terraform.tfstate\n```\n\n### 2-3. S3 bucket \u3092\u7834\u68c4\u3059\u308b\n\n\u3055\u3066\u3001\u3044\u307e\u307e\u3067\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3068\u3057\u3066 S3 bucket \u3092\u4f5c\u6210\u3057\u3066\u304d\u307e\u3057\u305f\u304c\u3001\u4e0d\u8981\u306a\u306e\u3067\u524a\u9664\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002`terraform destroy` \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3048\u3070 OK \u3067\u3059\u304c\u3001\u3053\u306e\u64cd\u4f5c\u3082\u3084\u306f\u308a\u5b9f\u884c\u3059\u308b\u524d\u306b\u78ba\u8a8d\u3057\u3066\u304a\u304d\u305f\u3044\u3082\u306e\u3067\u3059\u3002\u305d\u3093\u306a\u5834\u5408\u306f\u307e\u305a `terraform plan --destroy` \u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u3053\u308c\u3067 `terraform destroy` \u6642\u306e\u5b9f\u884c\u8a08\u753b\u3092\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```\n% terraform plan --destroy\nRefreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n\naws_s3_bucket.terraform_tutorial_tfsate: Refreshing state... (ID: com.github.53ningen.terraform.tutorial.tfstate)\n\nThe Terraform execution plan has been generated and is shown below.\nResources are shown in alphabetical order for quick scanning. Green resources\nwill be created (or destroyed and then created if an existing resource\nexists), yellow resources are being changed in-place, and red resources\nwill be destroyed. Cyan entries are data sources to be read.\n\nNote: You didn't specify an \"-out\" parameter to save this plan, so when\n\"apply\" is called, Terraform can't guarantee this is what will execute.\n\n- aws_s3_bucket.terraform_tutorial_tfsate\n\n\nPlan: 0 to add, 0 to change, 1 to destroy.\n```\n\n\u5b9f\u884c\u8a08\u753b\u306b\u554f\u984c\u304c\u306a\u3055\u305d\u3046\u3067\u3042\u308c\u3070\u3001`terraform destroy` \u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```\n% terraform destroy\nDo you really want to destroy?\n  Terraform will delete all your managed infrastructure.\n  There is no undo. Only 'yes' will be accepted to confirm.\n\n  Enter a value: yes\n\naws_s3_bucket.terraform_tutorial: Refreshing state... (ID: com.github.53ningen.terraform.tutorial)\naws_s3_bucket.terraform_tutorial: Destroying...\naws_s3_bucket.terraform_tutorial: Destruction complete\n\nDestroy complete! Resources: 1 destroyed.\n```\n\n`terraform destroy` \u3092\u5b9f\u884c\u3059\u308b\u3068\u672c\u5f53\u306b\u30ea\u30bd\u30fc\u30b9\u3092\u524a\u9664\u3057\u3066\u826f\u3044\u306e\u304b\u805e\u304b\u308c\u307e\u3059\u3002`yes` \u3068\u5165\u529b\u3059\u308b\u3068\u3001\u3053\u3053\u307e\u3067\u306b\u4f5c\u3063\u305f S3 bucket \u306f\u524a\u9664\u3055\u308c\u307e\u3059\u3002\n\n### 2-4. tf \u30d5\u30a1\u30a4\u30eb\u3092\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3059\u308b\n\n`terrform fmt` \u3067\u30d5\u30a1\u30a4\u30eb\u3092\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3067\u304d\u307e\u3059\n\n```\n% terraform fmt\nremote_state.tf\nvariable.tf\n```\n\n### 2-5. terraform \u57fa\u672c\u30b3\u30de\u30f3\u30c9\u306e\u307e\u3068\u3081\n\n\u4ee5\u4e0a\u3067 terraform \u306e\u57fa\u672c\u7684\u306a 5 \u30b3\u30de\u30f3\u30c9\u306f\u7406\u89e3\u3067\u304d\u305f\u304b\u3068\u601d\u3044\u307e\u3059\u3002\u307e\u3068\u3081\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n* `terraform validate`: `.tf` \u30d5\u30a1\u30a4\u30eb\u306e\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u3092\u691c\u8a3c\u3059\u308b\n* `terraform plan`: terraform \u304c\u3053\u308c\u304b\u3089\u884c\u3046\u5b9f\u884c\u8a08\u753b\u3092\u8868\u793a\u3059\u308b\u3002`--destroy` \u30aa\u30d7\u30b7\u30e7\u30f3\u3067 destroy \u6642\u306e\u5b9f\u884c\u8a08\u753b\u3092\u8868\u793a\u3067\u304d\u308b\u3002\n* `terraform apply`: plan \u3092\u5b9f\u884c\u3059\u308b\u3002\n* `terraform destroy`: terraform \u3067\u4f5c\u3063\u305f\u30ea\u30bd\u30fc\u30b9\u3092\u7834\u68c4\u3059\u308b\n* `terraform fmt`: tf\u30d5\u30a1\u30a4\u30eb\u3092\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3059\u308b\n\n**\u57fa\u672c\u7684\u306b\u306f `apply` \u306e\u524d\u306b\u304b\u306a\u3089\u305a `plan` \u3067\u5b9f\u884c\u8a08\u753b\u3092\u78ba\u8a8d\u3059\u308b\u3053\u3068\u3092\u5fb9\u5e95\u3057\u3066\u304f\u3060\u3055\u3044\u3002** `destroy` \u306f\u5b9f\u969b\u306b\u306f\u307b\u3068\u3093\u3069\u4f7f\u3046\u3053\u3068\u306f\u306a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u307e\u305f\u3001`terraform.tfstate` \u3092 git \u3067\u7ba1\u7406\u3057\u305f\u308a\u3001\u4ed6\u4eba\u306e\u76ee\u306b\u89e6\u308c\u308b\u3088\u3046\u306a\u72b6\u614b\u306b\u3057\u306a\u3044\u3053\u3068\u3092\u304a\u5fd8\u308c\u306a\u304f\u3002\n\n## 3. remote state \u3092\u7ba1\u7406\u3059\u308b\n\n`terraform.tfstate` \u30d5\u30a1\u30a4\u30eb\u306f\u30ea\u30e2\u30fc\u30c8\u306e\u72b6\u614b\u3092\u7ba1\u7406\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002`apply` \u304c\u6210\u529f\u3059\u308b\u3068\u3001\u3069\u306e\u3088\u3046\u306a\u30ea\u30bd\u30fc\u30b9\u304c\u3069\u306e\u3088\u3046\u306a\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u4f5c\u6210\u3055\u308c\u305f\u306e\u304b\u3092\u7d30\u304b\u304f\u8a18\u9332\u3057\u3066\u3044\u307e\u3059\u3002\n\n`tfstate` \u30d5\u30a1\u30a4\u30eb\u3092\u8aa4\u3063\u3066\u524a\u9664\u3059\u308b\u3068 terraform \u306f\u30ea\u30e2\u30fc\u30c8\u306b\u30ea\u30bd\u30fc\u30b9\u304c\u5b58\u5728\u3057\u306a\u3044\u3068\u8a8d\u8b58\u3057\u3066\u3001`tf` \u30d5\u30a1\u30a4\u30eb\u306b\u5b9a\u7fa9\u3055\u308c\u305f\u69cb\u6210\u3092\u65b0\u898f\u4f5c\u6210\u3057\u3088\u3046\u3068\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u3057\u304c\u3063\u3066\u4f55\u3089\u304b\u306e\u5f62\u3067\u3001\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u7ba1\u7406\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001\u79d8\u533f\u60c5\u5831\u304c\u591a\u5206\u306b\u542b\u307e\u308c\u3066\u3044\u308b\u305f\u3081\u5358\u7d14\u306b git \u3067\u7ba1\u7406\u3059\u308b\u308f\u3051\u306b\u306f\u3044\u304d\u307e\u305b\u3093\u3002\n\n\u7ba1\u7406\u3059\u308b\u65b9\u6cd5\u306f\u4f55\u901a\u308a\u304b\u3042\u308b\u306e\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u306f private \u306a S3 bucket \u3092\u4f7f\u3063\u3066\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u7ba1\u7406\u3059\u308b\u65b9\u6cd5\u3092\u3054\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n### 3-1. tfsate\u7ba1\u7406\u7528 S3 bucket \u306e\u4f5c\u6210\n\nS3 bucket \u306e\u4f5c\u6210\u306f\u524d\u7bc0\u3067\u3084\u3063\u305f\u306e\u3067\u3082\u3046\u304d\u3063\u3068\u7406\u89e3\u3067\u304d\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u5fa9\u7fd2\u304c\u3066\u3089\u3084\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002`remote_state.tf` \u3068\u3044\u3046\u540d\u524d\u3067\u6b21\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```\nresource \"aws_s3_bucket\" \"terraform_tutorial_tfsate\" {\n    bucket = \"com.github.53ningen.terraform.tutorial.tfstate\" # S3 bucket \u540d\u306f global \u3067\u4e00\u610f\u306b\u306a\u308b\u3088\u3046\u306b\n    acl = \"private\"\n    versioning {\n        enabled = true\n    }\n}\n```\n\n`terraform plan` \u3067\u5b9f\u884c\u8a08\u753b\u3092\u78ba\u8a8d\u3057\u305f\u306e\u3061\u3001`terraform apply` \u3067 bucket \u3092\u4f5c\u6210\u3057\u307e\u3059\u3002terraform \u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u3088\u308b\u3068 `versioning` \u3092\u6709\u52b9\u306b\u3059\u308b\u3053\u3068\u304c\u63a8\u5968\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n### 3-2. tfstate\u7ba1\u7406\u8a2d\u5b9a\u3092\u884c\u3046\n\n\u7121\u4e8b S3 bucket \u304c\u4f5c\u6210\u3055\u308c\u305f\u3089 `terraform remote config` \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066 tfstate \u30d5\u30a1\u30a4\u30eb\u306e\u7ba1\u7406\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u306e `bucket` \u3084 `access_key` \u306a\u3069\u306f\u81ea\u5206\u306e\u3082\u306e\u306b\u9069\u5b9c\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\n% terraform remote config \\\n    -backend=S3 \\\n    -backend-config=\"bucket=com.github.53ningen.terraform.tutorial.tfstate\" \\\n    -backend-config=\"region=ap-northeast-1\" \\\n    -backend-config=\"key=terraform.tfstate\" \\\n    -backend-config=\"access_key=${access_key}\" \\\n    -backend-config=\"secret_key=${ecret_key}\"\nRemote state management enabled\nRemote state configured and pulled.\n```\n\n\u3053\u3053\u3067 `key` \u3068\u3044\u3046\u306e\u306f S3 \u4e0a\u3067\u3069\u306e\u3088\u3046\u306a\u540d\u524d\u3067 tfstate \u30d5\u30a1\u30a4\u30eb\u3092\u7ba1\u7406\u3059\u308b\u304b\u3068\u3044\u3046\u6307\u5b9a\u306b\u306a\u308a\u307e\u3059\u3002\u4eca\u30b3\u30de\u30f3\u30c9\u304c\u7121\u4e8b\u901a\u308b\u3068\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3042\u3063\u305f `terraform.tfstate` \u306f\u304d\u3063\u3068 `.terraform` \u4e0b\u306b\u79fb\u52d5\u3059\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n### 3-3. remote \u306b tfstate \u3092 push \u3059\u308b\n\n\u3055\u3066\u3001\u7ba1\u7406\u8a2d\u5b9a\u304c\u7121\u4e8b\u304a\u308f\u3063\u305f\u3089 S3 \u306b tfstate \u30d5\u30a1\u30a4\u30eb\u3092\u8ee2\u9001\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n```\n% terraform remote push\nState successfully pushed!\n```\n\n\u30ea\u30e2\u30fc\u30c8\u3078\u306e `terraform apply` \u3092\u884c\u3063\u305f\u5834\u5408\u306f\u5fc5\u305a `terraform remote push` \u3092\u884c\u3044\u307e\u3057\u3087\u3046\u3002\n\n### 3-4. remote \u304b\u3089 tfstate \u3092 pull \u3059\u308b\n\n\u666e\u901a\u306b\u3044\u304b\u306e\u3088\u3046\u306a\u611f\u3058\u306b\u306a\u308a\u307e\u3059\u3002\u8907\u6570\u4eba\u3067\u306e\u958b\u767a\u3067\u3001\u4ed6\u4eba\u304c `apply` \u3057\u305f\u3042\u3068\u306e remote state \u3092\u53cd\u6620\u3055\u305b\u305f\u3044\u5834\u5408\u306a\u3069\u306b\u4f7f\u3044\u307e\u3059\u3002\n\n```\n% terraform remote pull\nLocal and remote state in sync\n```\n\n## 4. \u3088\u308a\u9ad8\u5ea6\u306a\u30ea\u30bd\u30fc\u30b9\u5b9a\u7fa9\u3092\u884c\u3046\n### 4-1. \u5909\u6570\u3092\u7528\u3044\u308b\n\naws \u306e `access_key` \u3084 `secret_key` \u3092 `variable.tf` \u306b\u76f4\u63a5\u66f8\u304d\u8fbc\u3093\u3067\u3044\u307e\u3059\u304c\u3001\u5909\u6570\u3068\u3044\u3046\u6a5f\u80fd\u3092\u4f7f\u3048\u3070\u3001\u5b9f\u884c\u6642\u306b\u6307\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```file:variable.tf\nprovider \"aws\" {\n  region = \"ap-northeast-1\"\n  access_key = \"${var.access_key}\"\n  secret_key = \"${var.secret_key}\"\n}\n\nvariable \"access_key\" {}\nvariable \"secret_key\" {}\n```\n\n\u3053\u306e\u3088\u3046\u306b\u3057\u305f\u4e0a\u3067\u3001`terraform plan` \u3092\u5b9f\u884c\u3059\u308b\u3068\u5404\u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u3057\u3066\u3069\u306e\u5024\u3092\u3068\u308b\u304b\u3092\u5bfe\u8a71\u5f0f\u306b\u5c0b\u306d\u3089\u308c\u307e\u3059\u3002\n\n```\n% terraform plan\nvar.access_key\n  Enter a value: hoge\n\nvar.secret_key\n  Enter a value: fuga\n\nRefreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n\n...\u4ee5\u4e0b\u7565\n```\n\n\u307e\u305f\u3001\u6b21\u306e\u3088\u3046\u306b\u5909\u6570\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u6307\u5b9a\u3057\u3066\u304a\u304f\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\n```file:variable.tf\nprovider \"aws\" {\n  region = \"${var.region}\"\n  access_key = \"${var.access_key}\"\n  secret_key = \"${var.secret_key}\"\n}\n\nvariable \"access_key\" {}\nvariable \"secret_key\" {}\nvariable \"region\" {\n  default = \"ap-northeast-1\"\n}\n```\n\n### 4-2. \u74b0\u5883\u5909\u6570\u3092\u7528\u3044\u308b\n\nCLI\u304b\u3089 `access_key` \u3084 `secret_key` \u3092\u6bce\u56de\u6307\u5b9a\u3059\u308b\u306e\u3082\u9762\u5012\u306a\u306e\u3067\u3001\u74b0\u5883\u5909\u6570\u3092\u7528\u3044\u308b\u3068\u697d\u305d\u3046\u3067\u3059\u3002terraform \u3067\u306f `TF_VAR_` \u3068\u3044\u3046\u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u304c\u3064\u3044\u305f\u74b0\u5883\u5909\u6570\u3092 `.tf` \u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u3067\u7528\u3044\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3055\u3063\u305d\u304f\u3001\u3053\u308c\u3092\u7528\u3044\u3066 `access_key`, `secret_key` \u3092\u74b0\u5883\u5909\u6570\u304b\u3089\u53d6\u3063\u3066\u304f\u308b\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3057\u3087\u3046\u3002\n\n```\n% echo 'export TF_VAR_MY_AWS_ACCESS_KEY=XXXXXXXXXXX' >> ~/.bash_profile\n% echo 'export TF_VAR_MY_AWS_SECRET_KEY=XXXXXXXXXXX' >> ~/.bash_profile\n% source ~/.bash_profile\n```\n\n\u7d9a\u3044\u3066 `variable.tf` \u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3057\u3087\u3046\n\n```file:variable.tf\nprovider \"aws\" {\n  region = \"${var.region}\"\n  access_key = \"${var.MY_AWS_ACCESS_KEY}\"\n  secret_key = \"${var.MY_AWS_SECRET_KEY}\"\n}\n\nvariable \"MY_AWS_ACCESS_KEY\" {}\nvariable \"MY_AWS_SECRET_KEY\" {}\nvariable \"region\" {\n  default = \"ap-northeast-1\"\n}\n```\n\n`terraform plan` \u3092\u5909\u6570\u6307\u5b9a\u306a\u3057\u3067\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308c\u3070\u3001\u7121\u4e8b\u74b0\u5883\u5909\u6570\u306e\u5229\u7528\u304c\u3067\u304d\u3066\u3044\u308b\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n### 4-3. \u4f9d\u5b58\u7ba1\u7406\u306e\u3042\u308b\u30ea\u30bd\u30fc\u30b9\u5b9a\u7fa9\u3092\u884c\u3046\n\n\u3088\u308a\u8907\u96d1\u306a\u30ea\u30bd\u30fc\u30b9\u3092\u69cb\u6210\u3059\u308b\u3068\u304d\u306b\u306f\u3001\u30ea\u30bd\u30fc\u30b9\u540c\u58eb\u306b\u4f9d\u5b58\u95a2\u4fc2\u304c\u751f\u3058\u307e\u3059\u3002\u305f\u3068\u3048\u3070 terraform \u3067\u4f5c\u6210\u3057\u305f IAM \u30e6\u30fc\u30b6\u30fc\u306b\u30dd\u30ea\u30b7\u30fc\u3092\u30a2\u30bf\u30c3\u30c1\u3057\u305f\u3044\u3068\u304d\u306b\u3001\u30ea\u30bd\u30fc\u30b9\u9593\u306b\u4f9d\u5b58\u304c\u751f\u3058\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u3044\u307e\u3001 IAM \u30e6\u30fc\u30b6\u30fc `cocoa` \u3055\u3093\u3092\u4f5c\u6210\u3057 `IAMReadOnlyAccess` \u30dd\u30ea\u30b7\u30fc\u3092\u30a2\u30bf\u30c3\u30c1\u3057\u305f\u3044\u3068\u3057\u307e\u3059\u3002\u305d\u306e\u5834\u5408\u306e `.tf` \u30d5\u30a1\u30a4\u30eb\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3059\u308c\u3070OK\u3067\u3059\u3002\n\n```file:iam.tf\n# IAM \u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\nresource \"aws_iam_user\" \"cocoa\" {\n  name = \"cocoa\"\n  path = \"/\"\n}\n\n# IAM \u30dd\u30ea\u30b7\u30fc\u306e\u30a2\u30bf\u30c3\u30c1\nresource \"aws_iam_policy_attachment\" \"IAMReadOnlyAccess-policy-attachment\" {\n  name       = \"IAMReadOnlyAccess-policy-attachment\"\n  \n  # IAMReadOnlyAccess \u306e ARN\n  policy_arn = \"arn:aws:iam::aws:policy/IAMReadOnlyAccess\"\n  groups     = []\n  \n  # \u4e0a\u3067\u5b9a\u7fa9\u3057\u305f cocoa \u30e6\u30fc\u30b6\u30fc\u306e name \u3092\u53c2\u7167\u3057\u3066\u3044\u308b\n  users      = [\"${aws_iam_user.cocoa.name}\"]  \n  roles      = []\n}\n```\n\n`terraform plan` \u3092\u5b9f\u884c\u3059\u308b\u3068\u4f9d\u5b58\u95a2\u4fc2\u304c\u89e3\u6c7a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3067\u3057\u3087\u3046\u3002\n\n```\n% terraform plan\nRefreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n\naws_s3_bucket.terraform_tutorial_tfsate: Refreshing state... (ID: com.github.53ningen.terraform.tutorial.tfstate)\n\nThe Terraform execution plan has been generated and is shown below.\nResources are shown in alphabetical order for quick scanning. Green resources\nwill be created (or destroyed and then created if an existing resource\nexists), yellow resources are being changed in-place, and red resources\nwill be destroyed. Cyan entries are data sources to be read.\n\nNote: You didn't specify an \"-out\" parameter to save this plan, so when\n\"apply\" is called, Terraform can't guarantee this is what will execute.\n\n+ aws_iam_policy_attachment.IAMReadOnlyAccess-policy-attachment\n    name:             \"IAMReadOnlyAccess-policy-attachment\"\n    policy_arn:       \"arn:aws:iam::aws:policy/IAMReadOnlyAccess\"\n    users.#:          \"1\"\n    users.3920907786: \"cocoa\"\n\n+ aws_iam_user.cocoa\n    arn:           \"<computed>\"\n    force_destroy: \"false\"\n    name:          \"cocoa\"\n    path:          \"/\"\n    unique_id:     \"<computed>\"\n\n\nPlan: 2 to add, 0 to change, 0 to destroy.\n```\n\n### 4-4. \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u3046\n\n\u8907\u96d1\u306a\u30ea\u30bd\u30fc\u30b9\u3092\u7ba1\u7406\u3059\u308b\u3068\u304d\u306b\u306f\u8a2d\u5b9a\u3060\u3051\u3092\u307e\u3068\u3081\u305f\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u4f7f\u3048\u308b\u3068\u4fbf\u5229\u305d\u3046\u3067\u3059\u3002 terraform \u306b\u306f\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u3046\u4ed5\u7d44\u307f\u3082\u5099\u308f\u3063\u3066\u3044\u307e\u3059\u3002\u4eca\u56de\u306f AWS \u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u6307\u5b9a\u3092\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u5207\u308a\u51fa\u3057\u307e\u3057\u3087\u3046\u3002`variable.tf` \u306e `region` \u5909\u6570\u304b\u3089 default \u5024\u3092\u524a\u9664\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```diff\nprovider \"aws\" {\n  region = \"${var.region}\"\n  access_key = \"${var.access_key}\"\n  secret_key = \"${var.secret_key}\"\n}\n\nvariable \"access_key\" {}\nvariable \"secret_key\" {}\nvariable \"region\" {\n-  default = \"ap-northeast-1\"\n}\n```\n\n\u305d\u3057\u3066 `config.tfvars` \u3068\u3044\u3046\u540d\u524d\u3067\u6b21\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3057\u307e\u3057\u3087\u3046\u3002\n\n```file:config.tfvars\nregion = \"ap-northeast-1\"\n```\n\n\u3042\u3068\u306f `terraform plan` \u3084 `terraform apply` \u6642\u306b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3057\u3066\u3042\u3052\u308c\u3070OK\u3067\u3059\u3002\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u6307\u5b9a\u306f `-var-file=` \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n```\n% terraform plan -var-file=./config.tfvars\nRefreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n\n# \u4ee5\u4e0b\u7565\n```\n\n### 4-5. \u51fa\u529b\u3092\u884c\u3046\n\n`terrform apply` \u5f8c\u306b\u4f5c\u6210\u3055\u308c\u305f\u30ea\u30bd\u30fc\u30b9\u306eARN\u304c\u77e5\u308a\u305f\u3044\u5834\u5408\u306a\u3069\u306f `output` \u3068\u3044\u3046\u6a5f\u80fd\u3092\u4f7f\u3046\u3068\u3088\u3044\u3067\u3057\u3087\u3046\u3002\u305f\u3068\u3048\u3070\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f cocoa \u30e6\u30fc\u30b6\u30fc\u306eARN\u3092\u51fa\u529b\u3055\u305b\u308b\u306b\u306f\u6b21\u306e\u3088\u3046\u306b\u3059\u308c\u3070 OK \u3067\u3059\u3002\n\n```diff\nresource \"aws_iam_user\" \"cocoa\" {\n  name = \"cocoa\"\n  path = \"/\"\n}\n\n# IAM policy attatchments\n\nresource \"aws_iam_policy_attachment\" \"IAMReadOnlyAccess-policy-attachment\" {\n  name       = \"IAMReadOnlyAccess-policy-attachment\"\n  policy_arn = \"arn:aws:iam::aws:policy/IAMReadOnlyAccess\"\n  groups     = []\n  users      = [\"${aws_iam_user.cocoa.name}\"]\n  roles      = []\n}\n\n+ output \"cocoa_arn\" {\n+   value = \"${aws_iam_user.cocoa.arn}\"\n+ }\n```\n\n`terraform plan`, `terraform apply` \u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u3087\u3046\n\n```\n% terraform apply\naws_iam_user.cocoa: Refreshing state... (ID: cocoa)\naws_s3_bucket.terraform_tutorial_tfsate: Refreshing state... (ID: com.github.53ningen.terraform.tutorial.tfstate)\naws_iam_policy_attachment.IAMReadOnlyAccess-policy-attachment: Refreshing state... (ID: IAMReadOnlyAccess-policy-attachment)\n\nApply complete! Resources: 0 added, 0 changed, 0 destroyed.\n\nOutputs:\n\ncocoa_arn = arn:aws:iam::XXXXXXXXXXXX:user/cocoa\n```\n\n\u3057\u3063\u304b\u308a\u3068 ARN \u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n## 5. \u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u8907\u6570\u306e\u30b9\u30c6\u30fc\u30b8\u3078\u306e\u5bfe\u5fdc\n\nterraform \u306f\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u7f6e\u304b\u308c\u3066\u3044\u308b `.tf` \u30d5\u30a1\u30a4\u30eb\u3092\u5b9f\u884c\u3059\u308b\u3068\u3044\u3046\u3068\u3066\u3082\u5358\u7d14\u306a\u3075\u308b\u307e\u3044\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002\u3057\u304b\u3057\u8907\u6570\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u69cb\u9020\u5316\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u3092\u4fdd\u5b58\u3057\u305f\u3044\u5834\u5408\u3084\u3001\u8907\u6570\u306e\u30b9\u30c6\u30fc\u30b8\u3092\u4f5c\u308b\u305f\u3081\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u3060\u3051\u5909\u3048\u3066\u547c\u3073\u51fa\u3057\u305f\u3044\u306a\u3069\u3055\u307e\u3056\u307e\u306b\u7406\u7531\u306b\u3088\u308a\u3001\u7570\u306a\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4e0b\u306b\u3042\u308b\u3082\u306e\u3092\u547c\u3073\u51fa\u3057\u305f\u3044\u3053\u3068\u304c\u3042\u308b\u3067\u3057\u3087\u3046\u3002\u305d\u306e\u3068\u304d\u306b\u4f7f\u3048\u308b\u306e\u304c\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u3044\u3046\u6a5f\u80fd\u3067\u3059\u3002\n\n### 5-1. \u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u5229\u7528\u306e\u57fa\u790e\n\n\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8a66\u3059\u305f\u3081\u306b\u307e\u305a\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\u3092\u4f5c\u308a\u307e\u3057\u3087\u3046\u3002\n\n```\n% tree\n.\n\u251c\u2500\u2500 dev\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 modules.tf\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 variable.tf\n\u251c\u2500\u2500 modules\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 s3\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 s3.tf\n\u2514\u2500\u2500 prod\n    \u251c\u2500\u2500 modules.tf\n    \u2514\u2500\u2500 variable.tf\n```\n\nmodules \u306b \u305d\u308c\u305e\u308c\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u304f\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\u4eca\u56de\u306f\u30b5\u30f3\u30d7\u30eb\u3068\u3057\u3066 dev/prod \u5411\u304d\u305d\u308c\u305e\u308c\u306e S3 bucket \u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u307e\u305a\u306f `modules/s3/s3.tf` \u306e\u4e2d\u8eab\u304b\u3089\u3002\n\n```file:modules/s3/s3.tf\nresource \"aws_s3_bucket\" \"tutorial_s3\" {\n  bucket = \"${var.env}.53nigen.github.com.tutorial.s3\" # S3 bucket \u540d\u306f global \u3067\u4e00\u610f\u306b\u306a\u308b\u3088\u3046\u306b\n  acl    = \"private\"\n\n  versioning {\n    enabled = false\n  }\n}\n\nvariable \"env\" {}\n```\n\n\u7d9a\u3044\u3066 `dev/modules.tf`, `prod/modules.tf` \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u306b\u305d\u308c\u305e\u308c\u3001`modules/s3` \u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u53d6\u308a\u8fbc\u3093\u3067\u5b9f\u884c\u3059\u308b\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u307f\u307e\u3057\u3087\u3046\u3002`modules` \u3068\u3044\u3046\u65b0\u305f\u306a\u69cb\u6587\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n```file:dev/modules.tf\nmodule \"s3\" {\n  source = \"../modules/s3\"  # \u3053\u3053\u3067\u8aad\u307f\u8fbc\u3080\u30d1\u30b9\u3092\u6307\u5b9a\n\n  env = \"${var.env}\"\n}\n\nvariable \"env\" {\n  default = \"dev\"  # prod \u306e\u307b\u3046\u306b\u306f prod \u3068\u66f8\u3044\u3066\u304f\u3060\u3055\u3044\n}\n```\n\n\u6700\u5f8c\u306b\u3001`dev/variable.tf`, `prod/variable.tf` \u306b\u5bfe\u3057\u3066\u3001AWS \u3092\u64cd\u4f5c\u3059\u308b\u8a2d\u5b9a\u5024\u306a\u3069\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n```file:dev/variable.tf\nprovider \"aws\" {\n  region = \"${var.region}\"\n  access_key = \"${var.access_key}\"\n  secret_key = \"${var.secret_key}\"\n}\n\nvariable \"access_key\" {}\nvariable \"secret_key\" {}\nvariable \"region\" {\n  default = \"ap-northeast-1\"\n}\n```\n\n\u3053\u308c\u3067\u6e96\u5099\u304c\u6574\u3044\u307e\u3057\u305f\u3002`dev` \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4e0b\u304b\u3089\u5b9f\u884c\u3059\u308b\u3068 dev \u74b0\u5883\u5411\u3051\u306e\u69cb\u6210\u3001`prod` \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4e0b\u304b\u3089\u5b9f\u884c\u3059\u308b\u3068 prod \u74b0\u5883\u5411\u3051\u306e\u69cb\u6210\u3092\u7ba1\u7406\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 dev \u74b0\u5883\u5411\u3051\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u5b9f\u969b\u306b\u4f5c\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002 `dev` \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3057\u3066\u3001`terraform get` \u3092\u5b9f\u884c\u3057\u3066\u4f9d\u5b58\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30b3\u30fc\u30c9\u3092\u53d6\u308a\u8fbc\u307f\u3092\u524d\u3082\u3063\u3066\u3084\u3063\u3066\u304a\u304f\u4ee5\u5916\u306f\u3001\u3044\u307e\u307e\u3067\u3068\u57fa\u672c\u7684\u306b\u306f\u540c\u3058\u64cd\u4f5c\u3067 OK \u3067\u3059\u3002\n\n```\n% cd dev/                                                                                                     % terraform get                                                                                               \nGet: file:///Users/yuki_yanagi/tutoterra/sample/modules/s3\n% terraform plan                                                                                              Refreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n\n\nThe Terraform execution plan has been generated and is shown below.\nResources are shown in alphabetical order for quick scanning. Green resources\nwill be created (or destroyed and then created if an existing resource\nexists), yellow resources are being changed in-place, and red resources\nwill be destroyed. Cyan entries are data sources to be read.\n\nNote: You didn't specify an \"-out\" parameter to save this plan, so when\n\"apply\" is called, Terraform can't guarantee this is what will execute.\n\n+ module.s3.aws_s3_bucket.tutorial_s3\n    acceleration_status:           \"<computed>\"\n    acl:                           \"private\"\n    arn:                           \"<computed>\"\n    bucket:                        \"dev.53nigen.github.com.tutorial.s3\"\n    force_destroy:                 \"false\"\n    hosted_zone_id:                \"<computed>\"\n    policy:                        \"<computed>\"\n    region:                        \"<computed>\"\n    request_payer:                 \"<computed>\"\n    versioning.#:                  \"1\"\n    versioning.2972667452.enabled: \"false\"\n    website_domain:                \"<computed>\"\n    website_endpoint:              \"<computed>\"\n\n\nPlan: 1 to add, 0 to change, 0 to destroy.\n% terraform apply\nmodule.s3.aws_s3_bucket.tutorial_s3: Creating...\n  acceleration_status:           \"\" => \"<computed>\"\n  acl:                           \"\" => \"private\"\n  arn:                           \"\" => \"<computed>\"\n  bucket:                        \"\" => \"dev.53nigen.github.com.tutorial.s3\"\n  force_destroy:                 \"\" => \"false\"\n  hosted_zone_id:                \"\" => \"<computed>\"\n  policy:                        \"\" => \"<computed>\"\n  region:                        \"\" => \"<computed>\"\n  request_payer:                 \"\" => \"<computed>\"\n  versioning.#:                  \"\" => \"1\"\n  versioning.2972667452.enabled: \"\" => \"false\"\n  website_domain:                \"\" => \"<computed>\"\n  website_endpoint:              \"\" => \"<computed>\"\nmodule.s3.aws_s3_bucket.tutorial_s3: Creation complete\n\nApply complete! Resources: 1 added, 0 changed, 0 destroyed.\n\nThe state of your infrastructure has been saved to the path\nbelow. This state is required to modify and destroy your\ninfrastructure, so keep it safe. To inspect the complete state\nuse the `terraform show` command.\n\nState path: terraform.tfstate\n```\n\n\n### 5-2. \u8907\u6570\u30b9\u30c6\u30fc\u30b8\u3078\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u7528\u3044\u305f\u306e\u5bfe\u5fdc\u4f8b\n\n\u3053\u306e\u3088\u3046\u306a\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u6a5f\u80fd\u3092\u7528\u3044\u3066 dev \u3084 production \u306a\u3069\u8907\u6570\u306e\u30b9\u30c6\u30fc\u30b8\u5411\u3051\u306b\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u308b\u3088\u3046\u306b\u66f4\u751f\u3059\u308b\u5834\u5408\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\u3068\u3057\u3066\u7279\u306b\u6c7a\u307e\u3063\u3066\u3044\u308b\u3082\u306e\u306f\u306a\u3044\u306e\u3067\u3059\u304c\u3001\u512a\u308c\u305f\u3082\u306e\u3068\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5f62\u304c\u3042\u308b\u306e\u3067\u3001\u53c2\u8003\u306b\u3057\u306a\u304c\u3089\u9032\u3081\u308b\u3068\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n* [\u30aa\u30ec\u30aa\u30ecterraform\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9](http://qiita.com/eigo_s/items/02264a5a7ad0ff6c5387)\n* [Terraform\u306b\u304a\u3051\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9](http://dev.classmethod.jp/devops/directory-layout-bestpractice-in-terraform/)\n\n## 6. \u65e2\u5b58\u306eAWS\u30ea\u30bd\u30fc\u30b9\u3092 terraform \u3067\u7ba1\u7406\u3059\u308b\n### 6-1. terraforming \u306e\u5c0e\u5165\n\nterraforming \u306f\u65e2\u5b58\u306eAWS\u30ea\u30bd\u30fc\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066terraform\u306e\u30b3\u30fc\u30c9\u3092\u751f\u6210\u3057\u3066\u304f\u308c\u305f\u308a\u3001tfstate\u3092\u751f\u6210\u3057\u3066\u304f\u308c\u305f\u308a\u3059\u308b\u30c4\u30fc\u30eb\u3067\u3059\u3002\u5c0e\u5165\u306f `Gemfile` \u306b\u6b21\u306e\u3088\u3046\u306b\u66f8\u3044\u3066\u3001`bundle install` \u3059\u308c\u3070OK\u3067\u3059\u3002\n\n```file:Gemfile\nsource \"https://rubygems.org\"\n\ngem 'terraforming', '0.10.0'\n```\n\n### 6-2. \u65e2\u5b58\u306e IAM user \u3092 terraform \u3067\u7ba1\u7406\u3059\u308b\n\nAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u6301\u3063\u3066\u3044\u308b\u307b\u307c\u5168\u3066\u306e\u4eba\u306f\u3001\u3059\u3067\u306b IAM user \u306a\u3069\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u6301\u3063\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u5f93\u3063\u3066\u3001\u307e\u305a\u3053\u3053\u3092 terraform \u3067\u7ba1\u7406\u3059\u308b\u5f62\u306b\u3057\u307e\u3057\u3087\u3046\u3002\u6b21\u306e\u3088\u3046\u306b\u3059\u308b\u3068\u73fe\u5728\u306eIAM user\u30ea\u30bd\u30fc\u30b9\u306b\u5fdc\u3058\u305fHCL\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\n```sh\n% terraforming iamu --profile default\nresource \"aws_iam_user\" \"gomi_ningen\" {\n    name = \"gomi_ningen\"\n    path = \"/\"\n}\n```\n\n\u3053\u308c\u3092\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304d\u51fa\u3057\u307e\u3057\u3087\u3046\u3002\n\n```file:iam.tf\nresource \"aws_iam_user\" \"gomi_ningen\" {\n    name = \"gomi_ningen\"\n    path = \"/\"\n}\n```\n\n\u307e\u305f\u30ea\u30e2\u30fc\u30c8\u306e\u72b6\u614b\u3092\u624b\u5143\u306e `.tfstate` \u30d5\u30a1\u30a4\u30eb\u306b\u53cd\u6620\u3055\u305b\u306a\u3051\u308c\u3070\u3001terraform \u306f\u30ea\u30bd\u30fc\u30b9\u3092\u65b0\u898f\u306b\u4f5c\u6210\u3057\u3088\u3046\u3068\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n`terraforming iamu --tfstate --profile default --merge=.terraform/terraform.tfstate`\n\n\u51fa\u529b\u3092\u307f\u3066\u554f\u984c\u306a\u3055\u305d\u3046\u3067\u3042\u308c\u3070\u3001\u3053\u306e\u30b3\u30de\u30f3\u30c9\u306b `--overwrite` \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u52a0\u3057\u3066\u53cd\u6620\u3055\u305b\u307e\u3059\u3002\u3053\u306e\u306e\u3061\u306b `terraform plan` \u3092\u3057\u3066\u5dee\u5206\u304c\u3067\u306a\u3051\u308c\u3070\u3001\u6674\u308c\u3066 IAM user \u306e\u7ba1\u7406\u3092 terraform \u306b\u79fb\u884c\u3067\u304d\u305f\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n`terraform plan` \u6642\u306b\u3082\u3057\u3082\u3001 **destroy** \u3055\u308c\u308b\u30ea\u30bd\u30fc\u30b9\u304c\u8868\u793a\u3055\u308c\u305f\u3068\u3057\u305f\u3089\u3001\u65e2\u5b58\u306e\u30ea\u30bd\u30fc\u30b9\u3084\u30b7\u30b9\u30c6\u30e0\u304c\u7834\u58ca\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u7279\u306b\u614e\u91cd\u306b\u64cd\u4f5c\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u307e\u305f\u3001IAM policy \u306a\u3069\u306b\u3064\u3044\u3066\u306f JSON \u306e\u6539\u884c\u4f4d\u7f6e\u3084\u30a4\u30f3\u30c7\u30f3\u30c8\u306a\u3069\u304c\u5dee\u5206\u3068\u3057\u3066\u51fa\u3084\u3059\u3044\u306e\u3067\u3001\u60a9\u3093\u3060\u3068\u304d\u306f\u305d\u306e\u3042\u305f\u308a\u304c\u65e2\u5b58\u306e\u30dd\u30ea\u30b7\u30fc\u8a2d\u5b9a\u3068\u98df\u3044\u9055\u3063\u3066\u3044\u306a\u3044\u304b\u78ba\u8a8d\u3059\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002\n\n\u3055\u3066\u3001terraforming \u306f\u3088\u304f\u4f7f\u308f\u308c\u308b\u307b\u3068\u3093\u3069\u306e AWS \u30ea\u30bd\u30fc\u30b9\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u307e\u305a\u306f\u3053\u308c\u3092\u4f7f\u3063\u3066\u3067\u304d\u308b\u3068\u3053\u308d\u307e\u3067 terraform \u306b\u79fb\u884c\u3059\u308b\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002v0.7.0 \u3067\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u3082\u306e\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\n\n```\n% terraforming help\nCommands:\n  terraforming asg             # AutoScaling Group\n  terraforming dbpg            # Database Parameter Group\n  terraforming dbsg            # Database Security Group\n  terraforming dbsn            # Database Subnet Group\n  terraforming ec2             # EC2\n  terraforming ecc             # ElastiCache Cluster\n  terraforming ecsn            # ElastiCache Subnet Group\n  terraforming eip             # EIP\n  terraforming elb             # ELB\n  terraforming help [COMMAND]  # Describe available commands or one specific command\n  terraforming iamg            # IAM Group\n  terraforming iamgm           # IAM Group Membership\n  terraforming iamgp           # IAM Group Policy\n  terraforming iamip           # IAM Instance Profile\n  terraforming iamp            # IAM Policy\n  terraforming iampa           # IAM Policy Attachment\n  terraforming iamr            # IAM Role\n  terraforming iamrp           # IAM Role Policy\n  terraforming iamu            # IAM User\n  terraforming iamup           # IAM User Policy\n  terraforming igw             # Internet Gateway\n  terraforming lc              # Launch Configuration\n  terraforming nacl            # Network ACL\n  terraforming nat             # NAT Gateway\n  terraforming nif             # Network Interface\n  terraforming r53r            # Route53 Record\n  terraforming r53z            # Route53 Hosted Zone\n  terraforming rds             # RDS\n  terraforming rs              # Redshift\n  terraforming rt              # Route Table\n  terraforming rta             # Route Table Association\n  terraforming s3              # S3\n  terraforming sg              # Security Group\n  terraforming sn              # Subnet\n  terraforming sqs             # SQS\n  terraforming vgw             # VPN Gateway\n  terraforming vpc             # VPC\n```\n\n### 6-3. terraform \u306e\u30b3\u30fc\u30c9\u3092\u7ba1\u7406\u3059\u308b\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\n\n\u500b\u4eba\u30a2\u30ab\u30a6\u30f3\u30c8\u306eaws\u69cb\u6210\u3092open\u306agithub repository\u306b\u914d\u7f6e\u3059\u308b\u306e\u306f\u3001\u306f\u3070\u304b\u3089\u308c\u308b\u306e\u3067 code commit \u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u304a\u304f\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002\n\n```file:code_commit.tf\n# \u3053\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u306eAWS\u69cb\u6210\u3092\u7ba1\u7406\u3059\u308bterraform\u30b3\u30fc\u30c9\u3092\u914d\u7f6e\u3059\u308b\u30ec\u30dd\u30b8\u30c8\u30ea\nresource \"aws_codecommit_repository\" \"my-terraform\" {\n  repository_name = \"my-terraform\"\n  description = \"terrform\"\n}\n```\n\ncode commit \u4e0a\u306b\u4f5c\u6210\u3057\u305f\u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u30dd\u30ea\u30b7\u30fc\u306e\u30a2\u30bf\u30c3\u30c1\u3001\u306a\u3089\u3073\u306b\u516c\u958b\u9375\u767b\u9332\u3082 terraform \u3092\u4f7f\u3063\u3066\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```file:iam.tf\n#...\n\nresource \"aws_iam_policy_attachment\" \"my_codecommit_policy_attachment\" {\n  name       = \"my_terraform_codecommit_policy_attachment\"\n  policy_arn = \"arn:aws:iam::aws:policy/AWSCodeCommitPowerUser\"\n  groups     = []\n  users      = [\"${aws_iam_user.gomi_ningen.name}\"]\n  roles      = []\n}\n\nresource \"aws_iam_user_ssh_key\" \"gomi_ningen\" {\n    username = \"${aws_iam_user.gomi_ningen.name}\"\n    encoding = \"PEM\"\n    public_key = <<EOF\n######################\n##### public_key #####\n######################\nEOF\n}\n\noutput \"aws_iam_user_ssh_key.gomi_ningen.ssh_key_id\"  {\n    value = \"${aws_iam_user_ssh_key.gomi_ningen.ssh_public_key_id}\"\n}\n```\n\n\u3053\u306e\u72b6\u614b\u3067 `terraform plan`, `terraform apply` \u3092\u3057\u3066\u307f\u307e\u3059\n\n```\n% terraform apply                                                                                                                                                     aws_s3_bucket.my_terraform_tfstate: Refreshing state... (ID: com.53ningen.aws.terraform.tfstates)\naws_codecommit_repository.my-terraform: Refreshing state... (ID: my-terraform)\n\n# \u4e2d\u7565\n\nOutputs:\n\naws_iam_user_ssh_key.gomi_ningen.ssh_key_id = XXXXXXXXXXXX\n```\n\n\u3059\u308b\u3068\u4ee5\u4e0a\u306e\u3088\u3046\u306b\u4f5c\u6210\u3055\u308c\u305f `ssh_public_key_id` \u304c\u51fa\u529b\u3055\u308c\u308b\u306e\u3067\u3001\u3042\u3068\u306f\u3053\u3044\u3064\u3092 `~/.ssh/config` \u306b\u53cd\u6620\u3055\u305b\u308c\u3070\u624b\u5143\u306e\u30de\u30b7\u30f3\u304b\u3089\u4f5c\u6210\u3057\u305f code commit \u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u758e\u901a\u304c\u3068\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```file:~/.ssh/config\nHost git-codecommit.*.amazonaws.com\n  User XXXXXXXXXXXX\n  IdentityFile ~/.ssh/id_rsa\n```\n\n### 6-4. terraform import\n\nT.B.D\n\n\n## 7. \u69cb\u6210\u7ba1\u7406\u65b9\u6cd5\u306e\u6574\u7406\n### 7-1. \u500b\u4eba\u958b\u767a\u306e\u5834\u5408\n\n\u500b\u4eba\u306eAWS\u30ea\u30bd\u30fc\u30b9\u3092\u7ba1\u7406\u3059\u308b\u5834\u5408\u306f\u5927\u304d\u304f\u5206\u3051\u3066\u6b21\u306e2\u3064\u306e\u65b9\u6cd5\u304c\u3042\u308b\u304b\u3068\u601d\u3044\u307e\u3059\n\n* `.tfstate` \u3054\u3068 git \u3067\u7ba1\u7406\u3057\u3066\u3001 code commit \u306b\u3076\u3061\u3053\u3080\n* `.tfstate` \u306f S3 \u3067\u7ba1\u7406\u3001\u30b3\u30fc\u30c9\u306f code commit \u3067\u7ba1\u7406\n\n### 7-2. \u30c1\u30fc\u30e0\u958b\u767a\u306e\u5834\u5408\n\n* `.tfstate` \u306f\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u4e0a\u306e\u7406\u7531\u304b\u3089 S3 \u3067\u7ba1\u7406\u3059\u308b\u3053\u3068\u304c\u671b\u307e\u3057\u3044\n* `.tfstate` \u3084\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u306a\u3069\u3092\u542b\u3080\u3082\u306e\u3092\u30b3\u30df\u30c3\u30c8\u305b\u305a\u3001GitHub Enterprise, code commit, GitHub private repository \u306b push \u3059\u308b\n"}