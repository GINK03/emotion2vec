{"context": "\n\n\u3068\u308a\u3042\u3048\u305a0sim\u3067\u901a\u4fe1\u3067\u304d\u308b\u3088\u3046\u306b\n\n\u4eca\u56de\u306e\u6a5f\u6750\n\u30eb\u30fc\u30bf\u30fc:RTX1200\nUSBLTE\u30e2\u30c7\u30e0:LG L-02C\nsim:so-net 0SIM(\u6a19\u6e96sim)\n\n\u3068\u308a\u3042\u3048\u305aGUI\u3067\u8a2d\u5b9a\n\u56fa\u5b9a\u8cbb0\u5186\uff010 SIM\u3068YAMAHA RTX1200\u3067\u56de\u7dda\u5197\u9577\u5316\u3057\u3066\u307f\u308b\n\u3092\u53c2\u8003\u306b\u8272\u3005\u8a2d\u5b9a\n\u3068\u308a\u3042\u3048\u305aLAN\u30b1\u30fc\u30d6\u30eb\u3092\u5f15\u3063\u3053\u629c\u3044\u3066\u8a2d\u5b9a\u304c\u3046\u307e\u304f\u884c\u3063\u3066\u308b\u304b\u78ba\u8a8d\n2016/11/08 09:46:57: LAN2: link down\n2016/11/08 09:47:47: PP[02] IP Commencing: UDP 192.168.0.1:51333 > 111.221.77.169:40014\n2016/11/08 09:47:47: PP[02] Calling so-net.jp with usb1\n2016/11/08 09:47:47: USB[1] SEND [ATD*99***1#]\n2016/11/08 09:47:47: USB[1] RECV [CONNECT]\n2016/11/08 09:47:47: USB[1] Connected\n2016/11/08 09:47:48: PP[02] PPP/IPCP up  (Local: 100.66.251.104, Remote: None)\n2016/11/08 09:48:47: LAN2: link up (1000BASE-T Full Duplex)\n2016/11/08 09:50:58: PP[02] Disconnecting, cause [Data transaction timer (SEND) expired]\n2016/11/08 09:50:58: USB[1] SEND SIGNAL [DTR=OFF]\n2016/11/08 09:50:58: USB[1] RECV [NO CARRIER]\n2016/11/08 09:51:02: PP[02] Disconnected, cause [Data transaction timer (SEND) expired]\n2016/11/08 09:51:02: [MOBILE] Signal Strength (0-5): 5 [|||] (usb1)\n\n\u554f\u984c\u306a\u3055\u305d\u3046\u3067\u3059\u306d\u3001\u56de\u7dda\u3092\u623b\u3059\u3068\u52dd\u624b\u306b\u5207\u308c\u3066\u304f\u308c\u307e\u3059\n\n\u8ffd\u52a0\u306e\u8a2d\u5b9a\n\u3055\u30fc\u3066\u3001\u67081\u3067\u30ea\u30df\u30c3\u30c8\u3092\u30ea\u30bb\u30c3\u30c8\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u306e\u30683\u30f6\u6708\u901a\u4fe1\u304c\u306a\u3044\u3068\u52dd\u624b\u306b\u89e3\u7d04\u3055\u308c\u308b\u306e\u3067\u305d\u308c\u7528\u306blua\u3092\u66f8\u304d\u307e\u3059\n\nmonthly_kirikae.lua\n--------------------------##  \u8a2d\u5b9a\u5024  ##--------------------------------\n-- \u30e1\u30fc\u30eb\u306e\u8a2d\u5b9a\nmail_tbl = {                -- \u2605\n    smtp_address = \"example.com,\n    smtp_auth_name = \"hoge\",\n    smtp_auth_password = \"hogehoge\",\n    smtp_auth_protocol = \"\u9069\u5207\u306b\",\n    from = \"hoge@example.com\",\n    to = \"hogehoge@example.jp\",\n}\n\n-- \u30e1\u30fc\u30eb\u306e\u9001\u4fe1\u306b\u5931\u6557\u3057\u305f\u6642\u306b\u51fa\u529b\u3059\u308b SYSLOG \u306e\u30ec\u30d9\u30eb\uff08info, debug, notice\uff09\nlog_level = \"\u304a\u597d\u304d\u306b\"      -- \u2605\n\n----------------------##  \u8a2d\u5b9a\u5024\u3053\u3053\u307e\u3067  ##----------------------------\n-- \u73fe\u5728\u306e\u65e5\u6642\u3092\u53d6\u5f97\u3059\u308b\u95a2\u6570                               --\n------------------------------------------------------------\nfunction time_stamp()\n    local t\n\n    t = os.date(\"*t\")\n    return string.format(\"%d/%02d/%02d %02d:%02d:%02d\", \n        t.year, t.month, t.day, t.hour, t.min, t.sec)\nend\n\n------------------------------------------------------------\n\n----------------------## \u30e1\u30a4\u30f3\u30eb\u30fc\u30c1\u30f3 ## ----------------------------\n\nstr, rtn = rt.command(\"lan shutdown lan2\") --\u30e1\u30a4\u30f3\u56de\u7dda\u304c\u3064\u306a\u304c\u3063\u3066\u308bI/F\u3092shutdown\nwhile (loss ~= 0) do --loss\u7387\u304c0\uff05\u306b\u306a\u308b\u307e\u3067\u3046\u3061\u7d9a\u3051\u308b\n   rtn, str = rt.command(\"ping -c 1 8.8.8.8\") --\u3068\u308a\u3042\u3048\u305a\uff11\u56degoogle\u306ePublicDNS\u3078\n    if (rtn) and (str) then\n        loss = string.match(str, \"(%d+)%.%d+%%\")      -- \u30d1\u30b1\u30c3\u30c8\u30ed\u30b9\u7387\uff08NNN.N%\uff09\u306e\u6574\u6570\u90e8\u3092\u62bd\u51fa\n        if (loss ~= nil) then\n            loss = tonumber(loss)\n        end\n    end\nend\nrtn, str = rt.command(\"no lan shutdown lan2\") --\u30e1\u30a4\u30f3\u56de\u7dda\u304c\u3064\u306a\u304c\u3063\u3066\u308bI/F\u3092Up\n rtn, str = rt.command(\"clear mobile access limitation\") --\u30e2\u30d0\u30a4\u30eb\u56de\u7dda\u306e\u4f7f\u7528\u91cf\u3092\u30ea\u30bb\u30c3\u30c8\n\n---------------------------##\u30e1\u30fc\u30eb\u9001\u4fe1\u90e8##----------------------------------------\n       mail_tbl.subject = string.format(\"monthly reset (%s)\", time_stamp())\n        mail_tbl.text = string.format(\"\u30de\u30f3\u30b9\u30ea\u30fc\u306e\u901a\u4fe1\u6599\u30ea\u30bb\u30c3\u30c8\u304c\u6210\u529f\u3057\u307e\u3057\u305f\")\n       rtn2 = rt.mail(mail_tbl)\n        if (not rtn2) then\n            rt.syslog(log_level, \"failed to send mail. monthly_kirikae.lua\")\n        end\n\n\n\u3042\u3068\u306f\u8a2d\u5b9a\u306b\u6bce\u6708\u3055\u305b\u308b\u3088\u3046\u306b\u66f8\u304d\u8fbc\u3093\u3067\u7d42\u308f\u308a\u3067\u3059\nschedule at 1 */1 03:00 * lua monthly_kirikae.lua\n\n\n\u7d42\u308f\u308a\u306b\nsyslog\u3092\u76e3\u8996\u3057\u3066\u5207\u308a\u66ff\u308f\u3063\u305f\u3089\u30e1\u30fc\u30eb\u3092\u9001\u308b\u3088\u3046\u306alua\u3092\u66f8\u3044\u305f\u306e\u3067\u3059\u304c\u52d5\u4f5c\u3057\u307e\u305b\u3093\n\u30d8\u30eb\u30d7\uff01\n\u3068\u308a\u3042\u3048\u305a\u7dca\u6025\u7684\u306b\u7e4b\u3052\u3089\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u3067\u826f\u3057\u3068\u3057\u307e\u3059\n#\u3068\u308a\u3042\u3048\u305a0sim\u3067\u901a\u4fe1\u3067\u304d\u308b\u3088\u3046\u306b\n##\u4eca\u56de\u306e\u6a5f\u6750\n\u30eb\u30fc\u30bf\u30fc:RTX1200\nUSBLTE\u30e2\u30c7\u30e0:LG L-02C\nsim:so-net 0SIM(\u6a19\u6e96sim)\n##\u3068\u308a\u3042\u3048\u305aGUI\u3067\u8a2d\u5b9a\n[\u56fa\u5b9a\u8cbb0\u5186\uff010 SIM\u3068YAMAHA RTX1200\u3067\u56de\u7dda\u5197\u9577\u5316\u3057\u3066\u307f\u308b](https://matsu.teraren.com/blog/2016/02/14/0sim-rtx1200/)\n\u3092\u53c2\u8003\u306b\u8272\u3005\u8a2d\u5b9a\n\n\u3068\u308a\u3042\u3048\u305aLAN\u30b1\u30fc\u30d6\u30eb\u3092\u5f15\u3063\u3053\u629c\u3044\u3066\u8a2d\u5b9a\u304c\u3046\u307e\u304f\u884c\u3063\u3066\u308b\u304b\u78ba\u8a8d\n\n```logos\n2016/11/08 09:46:57: LAN2: link down\n2016/11/08 09:47:47: PP[02] IP Commencing: UDP 192.168.0.1:51333 > 111.221.77.169:40014\n2016/11/08 09:47:47: PP[02] Calling so-net.jp with usb1\n2016/11/08 09:47:47: USB[1] SEND [ATD*99***1#]\n2016/11/08 09:47:47: USB[1] RECV [CONNECT]\n2016/11/08 09:47:47: USB[1] Connected\n2016/11/08 09:47:48: PP[02] PPP/IPCP up  (Local: 100.66.251.104, Remote: None)\n2016/11/08 09:48:47: LAN2: link up (1000BASE-T Full Duplex)\n2016/11/08 09:50:58: PP[02] Disconnecting, cause [Data transaction timer (SEND) expired]\n2016/11/08 09:50:58: USB[1] SEND SIGNAL [DTR=OFF]\n2016/11/08 09:50:58: USB[1] RECV [NO CARRIER]\n2016/11/08 09:51:02: PP[02] Disconnected, cause [Data transaction timer (SEND) expired]\n2016/11/08 09:51:02: [MOBILE] Signal Strength (0-5): 5 [|||] (usb1)\n```\n\n\u554f\u984c\u306a\u3055\u305d\u3046\u3067\u3059\u306d\u3001\u56de\u7dda\u3092\u623b\u3059\u3068\u52dd\u624b\u306b\u5207\u308c\u3066\u304f\u308c\u307e\u3059\n\n##\u8ffd\u52a0\u306e\u8a2d\u5b9a\n\u3055\u30fc\u3066\u3001\u67081\u3067\u30ea\u30df\u30c3\u30c8\u3092\u30ea\u30bb\u30c3\u30c8\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u306e\u30683\u30f6\u6708\u901a\u4fe1\u304c\u306a\u3044\u3068\u52dd\u624b\u306b\u89e3\u7d04\u3055\u308c\u308b\u306e\u3067\u305d\u308c\u7528\u306blua\u3092\u66f8\u304d\u307e\u3059\n\n```lua:monthly_kirikae.lua\n--------------------------##  \u8a2d\u5b9a\u5024  ##--------------------------------\n-- \u30e1\u30fc\u30eb\u306e\u8a2d\u5b9a\nmail_tbl = {\t\t\t\t-- \u2605\n\tsmtp_address = \"example.com,\n    smtp_auth_name = \"hoge\",\n    smtp_auth_password = \"hogehoge\",\n    smtp_auth_protocol = \"\u9069\u5207\u306b\",\n\tfrom = \"hoge@example.com\",\n\tto = \"hogehoge@example.jp\",\n}\n\n-- \u30e1\u30fc\u30eb\u306e\u9001\u4fe1\u306b\u5931\u6557\u3057\u305f\u6642\u306b\u51fa\u529b\u3059\u308b SYSLOG \u306e\u30ec\u30d9\u30eb\uff08info, debug, notice\uff09\nlog_level = \"\u304a\u597d\u304d\u306b\"\t\t-- \u2605\n\n----------------------##  \u8a2d\u5b9a\u5024\u3053\u3053\u307e\u3067  ##----------------------------\n-- \u73fe\u5728\u306e\u65e5\u6642\u3092\u53d6\u5f97\u3059\u308b\u95a2\u6570                               --\n------------------------------------------------------------\nfunction time_stamp()\n\tlocal t\n\n\tt = os.date(\"*t\")\n\treturn string.format(\"%d/%02d/%02d %02d:%02d:%02d\", \n\t\tt.year, t.month, t.day, t.hour, t.min, t.sec)\nend\n\n------------------------------------------------------------\n\n----------------------## \u30e1\u30a4\u30f3\u30eb\u30fc\u30c1\u30f3 ## ----------------------------\n\nstr, rtn = rt.command(\"lan shutdown lan2\") --\u30e1\u30a4\u30f3\u56de\u7dda\u304c\u3064\u306a\u304c\u3063\u3066\u308bI/F\u3092shutdown\nwhile (loss ~= 0) do --loss\u7387\u304c0\uff05\u306b\u306a\u308b\u307e\u3067\u3046\u3061\u7d9a\u3051\u308b\n   rtn, str = rt.command(\"ping -c 1 8.8.8.8\") --\u3068\u308a\u3042\u3048\u305a\uff11\u56degoogle\u306ePublicDNS\u3078\n    if (rtn) and (str) then\n\t    loss = string.match(str, \"(%d+)%.%d+%%\")      -- \u30d1\u30b1\u30c3\u30c8\u30ed\u30b9\u7387\uff08NNN.N%\uff09\u306e\u6574\u6570\u90e8\u3092\u62bd\u51fa\n\t    if (loss ~= nil) then\n\t\t    loss = tonumber(loss)\n        end\n    end\nend\nrtn, str = rt.command(\"no lan shutdown lan2\") --\u30e1\u30a4\u30f3\u56de\u7dda\u304c\u3064\u306a\u304c\u3063\u3066\u308bI/F\u3092Up\n rtn, str = rt.command(\"clear mobile access limitation\") --\u30e2\u30d0\u30a4\u30eb\u56de\u7dda\u306e\u4f7f\u7528\u91cf\u3092\u30ea\u30bb\u30c3\u30c8\n\n---------------------------##\u30e1\u30fc\u30eb\u9001\u4fe1\u90e8##----------------------------------------\n       mail_tbl.subject = string.format(\"monthly reset (%s)\", time_stamp())\n\t\tmail_tbl.text = string.format(\"\u30de\u30f3\u30b9\u30ea\u30fc\u306e\u901a\u4fe1\u6599\u30ea\u30bb\u30c3\u30c8\u304c\u6210\u529f\u3057\u307e\u3057\u305f\")\n       rtn2 = rt.mail(mail_tbl)\n\t\tif (not rtn2) then\n\t\t\trt.syslog(log_level, \"failed to send mail. monthly_kirikae.lua\")\n\t\tend\n```\n\n\u3042\u3068\u306f\u8a2d\u5b9a\u306b\u6bce\u6708\u3055\u305b\u308b\u3088\u3046\u306b\u66f8\u304d\u8fbc\u3093\u3067\u7d42\u308f\u308a\u3067\u3059\n\n```\nschedule at 1 */1 03:00 * lua monthly_kirikae.lua\n```\n\n#\u7d42\u308f\u308a\u306b\nsyslog\u3092\u76e3\u8996\u3057\u3066\u5207\u308a\u66ff\u308f\u3063\u305f\u3089\u30e1\u30fc\u30eb\u3092\u9001\u308b\u3088\u3046\u306alua\u3092\u66f8\u3044\u305f\u306e\u3067\u3059\u304c\u52d5\u4f5c\u3057\u307e\u305b\u3093\n\u30d8\u30eb\u30d7\uff01\n\n\u3068\u308a\u3042\u3048\u305a\u7dca\u6025\u7684\u306b\u7e4b\u3052\u3089\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u3067\u826f\u3057\u3068\u3057\u307e\u3059\n", "tags": ["yamaha", "rtx1200", "0sim", "Router", "Lua"]}