{"context": "\u3053\u306e\u8a18\u4e8b\u306f\u3001\u5358\u7d14\u306b\u8a2d\u5b9a\u3057\u3066\u307f\u308b\u6a5f\u4f1a\u304c\u3042\u308a\u307e\u3057\u305f\u306e\u3067\u3001\u305d\u306e\u4f5c\u696d\u30e1\u30e2\u7684\u5185\u5bb9\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u5b9f\u65bd\u3059\u308b\u8a2d\u5b9a\n\nApache\u306eDocumentRoot (/var/www/html) \u3092samba\u3067\u5171\u6709\u3059\u308b\n\n\n\u691c\u8a3c\u76ee\u7684\u3063\u3066\u3053\u3068\u3067\u8a66\u3057\u3066\u307e\u3059...\n\u76f4\u306bsamba\u3058\u3083\u306a\u304f\u3066\u3001\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u4f7f\u3046\u3068\u304b\u3001git\u7ba1\u7406\u3067\u51fa\u6765\u4e0a\u304c\u3063\u305f\u3089\u69cb\u6210\u7ba1\u7406\u30c4\u30fc\u30eb\u3068\u304b\u3067\u9069\u7528\u3068\u304b\u306e\u307b\u3046\u304c\u671b\u307e\u3057\u3044\u3067\u3059\n\n\nVagrant\u3067\u306eCentOS\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u3064\u3044\u3066\u306f\u7701\u7565\nMac(Host\u5074\uff09\u306f 192.168.331, CentOS\u5074\u306f 192.168.33.10 \n\n\nVirtualBox / CentOS\u5074\uff1a\n\u5229\u7528\u3057\u305f\u306e\u306f\u3053\u3061\u3089\u3002(CentOS7\u3067\u306a\u304f\u3066\u3059\u307f\u307e\u305b\u3093...)\n$ uname -a\nLinux localhost.localdomain 2.6.32-573.7.1.el6.x86_64 #1 SMP Tue Sep 22 22:00:00 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\n\n$ cat /etc/redhat-release \nCentOS release 6.7 (Final)\n\n\nSamba\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nyum install httpd\nyum install samba4\n\n\u5099\u8003\uff1a\n\nepel\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u305f\u72b6\u614b\u3067\u3059\u304c\u3001\"yum install samba\" \u3068\u3059\u308b\u3068\u3001Samba 3.x\u7cfb\u304c\u5165\u308a\u307e\u3059\nSamba4\u7cfb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u969b\u306f\u3001samba4 \u3068\u660e\u793a\u304c\u5fc5\u8981\u3067\u3059\nsamba3\u3092\u5165\u308c\u305f\u4e0a\u3067samba4\u3092\u5165\u308c\u308b\u5834\u5408\u306f\u3001\u4f9d\u5b58\u95a2\u4fc2\u3067\u6012\u3089\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\n\n\n\u3044\u3063\u305f\u3093 yum erase samba \u3057\u3066\u304b\u3089samba4\u3092\u5165\u308c\u307e\u3057\u3087\u3046\n\n\n\n$ httpd -v\nServer version: Apache/2.2.15 (Unix)\nServer built:   Nov 18 2016 23:48:55\n\n$ smbd -V\nVersion 4.2.10\n\n\nApache\u306e\u8d77\u52d5\u30e6\u30fc\u30b6\u306e\u78ba\u8a8d\n\u5168\u3066user: apache\u3067\u8d77\u52d5\u3057\u3066\u3044\u308b\u306e\u3092\u78ba\u8a8d\n$ ps -elf | grep [a]pache\n5 S apache    2448  2446  0  80   0 - 43828 inet_c 09:41 ?        00:00:00 /usr/sbin/httpd\n5 S apache    2449  2446  0  80   0 - 43828 semtim 09:41 ?        00:00:00 /usr/sbin/httpd\n\n-- [\u4ee5\u4e0b\u7565] --\n\n\n/var/www/html \u306e\u6a29\u9650\u8a2d\u5b9a\nyum install\u306e\u76f4\u5f8c\u3060\u3068\u3001Owner\u304croot\u3067\u3059\u3002\nOwner\u3068\u30b0\u30eb\u30fc\u30d7\u3092\u5909\u66f4\u3057\u3001setgid\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n# chown -R apache:apache /var/www/html\n# chmod g+s /var/www/html\n\n# ls -la /var/www/\n\n....\ndrwxrwsr-x   3 apache apache 4096 12\u6708 23 12:50 2016 html # s\u304c\u4ed8\u304d\u307e\u3059\n\n\nSamba\u306e\u30d7\u30ed\u30bb\u30b9\u306e\u78ba\u8a8d\nsamba\u306frootd\u3067\u4e0a\u304c\u308b\u3093\u3067\u3059\u306d....\n# ps -elf | grep [s]mb\n5 S root      3788     1  0  80   0 - 91918 poll_s 13:18 ?        00:00:00 smbd\n1 S root      3791  3788  0  80   0 - 91918 poll_s 13:18 ?        00:00:00 smbd\n5 S root      3793  3788  0  80   0 - 92496 poll_s 13:18 ?        00:00:00 smbd\n\n\nsmb.conf \u306e\u7de8\u96c6\n\u4eca\u56de\u306fsamba\u3068\u8a00\u3048\u3069Windows\u306f\u767b\u5834\u3057\u306a\u3044 / AD\u3082\u3044\u306a\u3044\u306e\u3067\u3001\u30b7\u30f3\u30d7\u30eb\u306b\u3002\n# vi /etc/samba/smb.conf\n\n\n[global]\n   unix charset = UTF-8\n   dos charset = CP932\n   max protocol = SMB2\n\n   # \u4eca\u56deVagrant\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af 192.168.33 \u3092\u8a31\u53ef\n   hosts allow = 192.168.33. 127.   \n   log level = 2\n   workgroup = WORKGROUP\n   server string = Samba Server Version %v\n   security = user\n   passdb backend = tdbsam\n   load printers = yes\n   cups options = raw\n\n   # \u63a5\u7d9a\u5143\u306eIP\u6bce\u306b\u30ed\u30b0\u304c\u51fa\u307e\u3059\u3001\u3046\u307e\u304f\u3044\u304b\u306a\u304b\u3063\u305f\u3089\u3053\u3053\u3092\u898b\u308b\n   log file = /var/log/samba/log.%m  \n   max log size = 1000\n   syslog = 0\n\n[homes]\n   comment = Home Directories\n   path = %H/samba\n   browseable = no\n   writable = yes\n   vfs objects = recycle\n   recycle:repository = .recycle\n   recycle:keeptree = no\n   recycle:versions = yes\n   recycle:touch = no\n   recycle:maxsize = 0\n   recycle:exclude = *.tmp ~$*\n\n[apache_docroot]\n   comment = Web\n   path = /var/www/html\n   browseable = no\n   writable = yes\n   vfs objects = recycle\n\n   # samba\u3067\u306e\u30a2\u30af\u30bb\u30b9\u306f\u5f37\u5236\u7684\u306buser: apache\u306b\u4e38\u3081\u3061\u3083\u3046\n   # force\u304c\u5acc\u306a\u5834\u5408\u306fOS\u5074\u3067samba\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u30e6\u30fc\u30b6\u3092apache\u30b0\u30eb\u30fc\u30d7\u306b\u6240\u5c5e\u3055\u305b\u308b\n   force user = apache\u3000\u3000\u3000\n   force group = apache\n   recycle:repository = .recycle\n   recycle:keeptree = no\n   recycle:versions = yes\n   recycle:touch = no\n   recycle:maxsize = 0\n   recycle:exclude = *.tmp ~$*\n\n   # /var/www/html \u4ee5\u4e0b\u306f\u6307\u5b9a\u30b0\u30eb\u30fc\u30d7\u306a\u3089\u8aad\u307f\u66f8\u304d\u5909\u66f4\u53ef\u80fd\u306b\u3057\u305f\u3044\u306e\u3067\u3001umask\u8a2d\u5b9a\n   create mask = 0664\n   directory mask = 0775\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u59a5\u5f53\u6027\u306e\u78ba\u8a8d\u3092\u3057\u307e\u3059\u3002 \ntestparm\u30b3\u30de\u30f3\u30c9\u3067\u3001\u30c1\u30a7\u30c3\u30af\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n# testparm\n\nLoad smb config files from /etc/samba/smb.conf\nrlimit_max: increasing rlimit_max (1024) to minimum Windows limit (16384)\nProcessing section \"[homes]\"\nProcessing section \"[apache_docroot]\"\nLoaded services file OK.\nServer role: ROLE_DOMAIN_MEMBER\nPress enter to see a dump of your service definitions\n\n\u30ea\u30bf\u30fc\u30f3\u3059\u308b\u3068\u3001\u78ba\u8a8d\u306e\u305f\u3081\u8a2d\u5b9a\u5185\u5bb9\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\n\n-- [\u4ee5\u4e0b\u7565] --\n\n\n\nuseradd \u3067 OS & samba\u53cc\u65b9\u3067\u5229\u7528\u3059\u308b\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\napache\u30b0\u30eb\u30fc\u30d7\u306b\u6240\u5c5e\u3055\u305b\u305f\u3044\u306e\u3067\u3001\u307e\u305a\u78ba\u8a8d\u3002\n# id apache\nuid=48(apache) gid=48(apache) \u6240\u5c5e\u30b0\u30eb\u30fc\u30d7=48(apache)\n\n\u30b0\u30eb\u30fc\u30d7\u3092\u6307\u5b9a\u3057\u3066\u3001smbuser\u3068\u3044\u3046\u540d\u524d\u306e\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n# useradd -u 500 -G apache smbuser\n\n\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n# id smbuser\nuid=500(smbuser) gid=500(smbuser) \u6240\u5c5e\u30b0\u30eb\u30fc\u30d7=500(smbuser),48(apache)\n\n# passwd smbuser\n\u30e6\u30fc\u30b6\u30fc smbuser \u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5909\u66f4\u3002\n\n-- [ \u4ee5\u4e0b\u7565 ] --\n\n\n\u30e6\u30fc\u30b6\uff1asmbuser \u3092samba\u7d4c\u7531\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3001samba\u7528\u306e\u8a2d\u5b9a\u3092\u5b9f\u65bd\u3057\u307e\u3059\u3002\n(pdbedit\u3092\u5229\u7528)\n\u57fa\u672c\u306fOS\u4e0a\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3068\u63c3\u3048\u307e\u3059\u3002\n# pdbedit -a smbuser\nnew password:\nretype new password:\nUnix username:        smbuser\n\n[\u4ee5\u4e0b\u7565]\n\n# pdbedit -L\nsmbuser:500:\n\n\n\nSSH\u3067\u306esamba\u7528\u30e6\u30fc\u30b6\u306e\u30ed\u30b0\u30a4\u30f3\u78ba\u8a8d\n\u307e\u305a\u306fSSH\u304b\u3089\u63a5\u7d9a\u3067\u304d\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ ssh smbuser@192.168.33.10\nsmbuser@192.168.33.10's password: \nLast login: Fri Dec 23 10:36:33 2016 from 192.168.33.1\n[smbuser@localhost ~]$ \n\n\nsamba\u30e6\u30fc\u30b6\u306esamba\u7d4c\u7531\u3067\u306e\u30a2\u30af\u30bb\u30b9\u78ba\u8a8d (Mac\u304b\u3089)\n\u63a5\u7d9a\u306fWindows\u3067\u306f\u306a\u304fMac\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\u3084\u308b\u3053\u3068\uff1a\n\napache\u7528\u306e/var/www/html \u3092\u3001Mac\u4e0a\u306esmb_apache\u3068\u3044\u3046\u30d5\u30a9\u30eb\u30c0\u306b\u5272\u308a\u5f53\u3066\u308b\n\u8aad\u307f\u66f8\u304d\u53ef\u80fd\u306a\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n\n\u30d5\u30a1\u30a4\u30f3\u30c0\u304b\u3089\u300c\u30b5\u30fc\u30d0\u306b\u63a5\u7d9a\u300d\u3067\u3082OK\u3067\u3059\u304c\u3001\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u304b\u3089\u306e\u307b\u3046\u304c\u3001\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u5229\u7528\u3057\u3066\u8aad\u307f\u66f8\u304d\u30b3\u30d4\u30fc\u3057\u3084\u3059\u3044\u306e\u3067\u3001mount_smbfs \u3092\u4f7f\u3044\u307e\u3059\u3002\u63a5\u7d9a\u89e3\u9664\u306e\u3068\u304d\u306f\u3001umount \u3067OK\u3067\u3059\u3002\n\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u308c\u308b\u3068\u3001\u3046\u307e\u304f\u63a5\u7d9a\u3067\u304d\u3066\u3082\u300csuccess!\u300d\u3068\u304b\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u51fa\u307e\u305b\u3093\u3002\nls \u3068\u304b\u3067\u3061\u3083\u3093\u3068\u30de\u30a6\u30f3\u30c8\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u53c2\u8003: Mac\u3067\u30bf\u30fc\u30df\u30ca\u30eb\u304b\u3089Samba\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b by @mach3 \u3055\u307e\n\n# \u3069\u3053\u3067\u3082\u3044\u3044\u306e\u3067\u30de\u30a6\u30f3\u30c8\u30dd\u30a4\u30f3\u30c8\u7528\u306e\u7a7a\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210\n$ mkdir smb_apache\n\n# \u63a5\u7d9a\u5b9f\u65bd\n$ mount_smbfs //smbuser@192.168.33.10/apache_docroot smb_apache\nPassword for 192.168.33.10:   # \u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u308c\u308b\n\n$ ls -la smb_apache\n\ntotal 6208\ndrwx------   1 xxx  staff  16384 12 23 21:58 .\ndrwxr-xr-x  19 xxx  staff    646 12 23 21:29 ..\n-rwx------@  1 xxx  staff   6148 12 23 20:07 .DS_Store\n-rwx------   1 xxx  staff   4096 12 23 20:06 ._.DS_Store\ndrwx------   1 xxx  staff  16384 12 23 21:50 .recycle\n-rwx------   1 xxx  staff      7 12 23 21:58 data.txt\n\n$ umound smb_apache # \u63a5\u7d9a\u65ad\n\n\n\u304a\u597d\u304d\u306a\u30a8\u30c7\u30a3\u30bf\u3067Samba\u7d4c\u7531\u3067\u66f8\u304d\u8fbc\u307f\nsmb.conf \u3067 force user = apache, force group = apache\u3000\u3068\u3057\u3066\u3044\u308b\u306e\u3067\u3001smbuser \u3068\u3057\u3066\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3044\u3066\u3082\u3001\u66f8\u304d\u8fbc\u3093\u3060\u30d5\u30a1\u30a4\u30eb\u3092CentOS\u5074\u304b\u3089\u898b\u308b\u3068\u3001Owner/Group \u3068\u3082\u306bapache:apache\u306b\u306a\u308a\u307e\u3059\u3002\nforce ... \u304c\u5acc\u306a\u5834\u5408\u306f\u3001\u4e0a\u8a18\u306b\u66f8\u3044\u305f\u901a\u308a\u3001samba\u3067\u30a2\u30af\u30bb\u30b9\u3055\u305b\u308b\u30e6\u30fc\u30b6\u3092apache\u30b0\u30eb\u30fc\u30d7\u306b\u6240\u5c5e\u3055\u305b\u3066\u304a\u304d\u3001setgid\u3082\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u5834\u5408\n\u30b5\u30fc\u30d0\u5074\u306e /var/log/samba/log.%m  (\u4eca\u56de\u306e\u4f8b\u3060\u3068 /var/log/samba/log.192.168.33.1 )\u3092\u898b\u3066\u898b\u307e\u3057\u3087\u3046\u3002\n\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n# tail -2  /var/log/samba/log.192.168.33.1 \n\n# \u6210\u529f\u306e\u5834\u5408\n[2016/12/23 15:39:36.538770,  2] ../source3/auth/auth.c:305(auth_check_ntlm_password)\n  check_ntlm_password:  authentication for user [smbuser] -> [smbuser] -> [smbuser] succeeded\n\n# \u5931\u6557\u306e\u5834\u5408  \n[2016/12/23 11:34:33.483544,  2] ../source3/auth/auth.c:315(auth_check_ntlm_password)\n  check_ntlm_password:  Authentication for user [smbuser] -> [smbuser] FAILED with error xxxxx \n\n\n\u4ee5\u4e0a\u3001\u30e1\u30e2\u3067\u3057\u305f\u3002\n\n\u3053\u306e\u8a18\u4e8b\u306f\u3001\u5358\u7d14\u306b\u8a2d\u5b9a\u3057\u3066\u307f\u308b\u6a5f\u4f1a\u304c\u3042\u308a\u307e\u3057\u305f\u306e\u3067\u3001\u305d\u306e\u4f5c\u696d\u30e1\u30e2\u7684\u5185\u5bb9\u306b\u306a\u308a\u307e\u3059\u3002\n\n### \u5b9f\u65bd\u3059\u308b\u8a2d\u5b9a\n\n- Apache\u306eDocumentRoot (/var/www/html) \u3092samba\u3067\u5171\u6709\u3059\u308b\n - \u691c\u8a3c\u76ee\u7684\u3063\u3066\u3053\u3068\u3067\u8a66\u3057\u3066\u307e\u3059...\n - \u76f4\u306bsamba\u3058\u3083\u306a\u304f\u3066\u3001\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u4f7f\u3046\u3068\u304b\u3001git\u7ba1\u7406\u3067\u51fa\u6765\u4e0a\u304c\u3063\u305f\u3089\u69cb\u6210\u7ba1\u7406\u30c4\u30fc\u30eb\u3068\u304b\u3067\u9069\u7528\u3068\u304b\u306e\u307b\u3046\u304c\u671b\u307e\u3057\u3044\u3067\u3059\n- Vagrant\u3067\u306eCentOS\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u3064\u3044\u3066\u306f\u7701\u7565\n- Mac(Host\u5074\uff09\u306f 192.168.331, CentOS\u5074\u306f 192.168.33.10 \n\n\n### VirtualBox / CentOS\u5074\uff1a\n\n\u5229\u7528\u3057\u305f\u306e\u306f\u3053\u3061\u3089\u3002(CentOS7\u3067\u306a\u304f\u3066\u3059\u307f\u307e\u305b\u3093...)\n\n```\n$ uname -a\nLinux localhost.localdomain 2.6.32-573.7.1.el6.x86_64 #1 SMP Tue Sep 22 22:00:00 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\n\n$ cat /etc/redhat-release \nCentOS release 6.7 (Final)\n```\n\n### Samba\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n- yum install httpd\n- yum install samba4\n\n**\u5099\u8003\uff1a**\n\n- epel\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u305f\u72b6\u614b\u3067\u3059\u304c\u3001\"yum install samba\" \u3068\u3059\u308b\u3068\u3001Samba 3.x\u7cfb\u304c\u5165\u308a\u307e\u3059\n- Samba4\u7cfb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u969b\u306f\u3001samba4 \u3068\u660e\u793a\u304c\u5fc5\u8981\u3067\u3059\n- samba3\u3092\u5165\u308c\u305f\u4e0a\u3067samba4\u3092\u5165\u308c\u308b\u5834\u5408\u306f\u3001\u4f9d\u5b58\u95a2\u4fc2\u3067\u6012\u3089\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\n - \u3044\u3063\u305f\u3093 yum erase samba \u3057\u3066\u304b\u3089samba4\u3092\u5165\u308c\u307e\u3057\u3087\u3046\n\n```\n$ httpd -v\nServer version: Apache/2.2.15 (Unix)\nServer built:   Nov 18 2016 23:48:55\n\n$ smbd -V\nVersion 4.2.10\n```\n\n### Apache\u306e\u8d77\u52d5\u30e6\u30fc\u30b6\u306e\u78ba\u8a8d\n\n\u5168\u3066user: apache\u3067\u8d77\u52d5\u3057\u3066\u3044\u308b\u306e\u3092\u78ba\u8a8d\n\n```\n$ ps -elf | grep [a]pache\n5 S apache    2448  2446  0  80   0 - 43828 inet_c 09:41 ?        00:00:00 /usr/sbin/httpd\n5 S apache    2449  2446  0  80   0 - 43828 semtim 09:41 ?        00:00:00 /usr/sbin/httpd\n\n-- [\u4ee5\u4e0b\u7565] --\n```\n\n### /var/www/html \u306e\u6a29\u9650\u8a2d\u5b9a\n\nyum install\u306e\u76f4\u5f8c\u3060\u3068\u3001Owner\u304croot\u3067\u3059\u3002\nOwner\u3068\u30b0\u30eb\u30fc\u30d7\u3092\u5909\u66f4\u3057\u3001setgid\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n# chown -R apache:apache /var/www/html\n# chmod g+s /var/www/html\n\n# ls -la /var/www/\n\n....\ndrwxrwsr-x   3 apache apache 4096 12\u6708 23 12:50 2016 html # s\u304c\u4ed8\u304d\u307e\u3059\n```\n\n\n### Samba\u306e\u30d7\u30ed\u30bb\u30b9\u306e\u78ba\u8a8d\n\nsamba\u306frootd\u3067\u4e0a\u304c\u308b\u3093\u3067\u3059\u306d....\n\n```\n# ps -elf | grep [s]mb\n5 S root      3788     1  0  80   0 - 91918 poll_s 13:18 ?        00:00:00 smbd\n1 S root      3791  3788  0  80   0 - 91918 poll_s 13:18 ?        00:00:00 smbd\n5 S root      3793  3788  0  80   0 - 92496 poll_s 13:18 ?        00:00:00 smbd\n```\n\n### smb.conf \u306e\u7de8\u96c6\n\n\u4eca\u56de\u306fsamba\u3068\u8a00\u3048\u3069Windows\u306f\u767b\u5834\u3057\u306a\u3044 / AD\u3082\u3044\u306a\u3044\u306e\u3067\u3001\u30b7\u30f3\u30d7\u30eb\u306b\u3002\n\n```\n# vi /etc/samba/smb.conf\n\n\n[global]\n   unix charset = UTF-8\n   dos charset = CP932\n   max protocol = SMB2\n   \n   # \u4eca\u56deVagrant\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af 192.168.33 \u3092\u8a31\u53ef\n   hosts allow = 192.168.33. 127.   \n   log level = 2\n   workgroup = WORKGROUP\n   server string = Samba Server Version %v\n   security = user\n   passdb backend = tdbsam\n   load printers = yes\n   cups options = raw\n   \n   # \u63a5\u7d9a\u5143\u306eIP\u6bce\u306b\u30ed\u30b0\u304c\u51fa\u307e\u3059\u3001\u3046\u307e\u304f\u3044\u304b\u306a\u304b\u3063\u305f\u3089\u3053\u3053\u3092\u898b\u308b\n   log file = /var/log/samba/log.%m  \n   max log size = 1000\n   syslog = 0\n\n[homes]\n   comment = Home Directories\n   path = %H/samba\n   browseable = no\n   writable = yes\n   vfs objects = recycle\n   recycle:repository = .recycle\n   recycle:keeptree = no\n   recycle:versions = yes\n   recycle:touch = no\n   recycle:maxsize = 0\n   recycle:exclude = *.tmp ~$*\n\n[apache_docroot]\n   comment = Web\n   path = /var/www/html\n   browseable = no\n   writable = yes\n   vfs objects = recycle\n   \n   # samba\u3067\u306e\u30a2\u30af\u30bb\u30b9\u306f\u5f37\u5236\u7684\u306buser: apache\u306b\u4e38\u3081\u3061\u3083\u3046\n   # force\u304c\u5acc\u306a\u5834\u5408\u306fOS\u5074\u3067samba\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u30e6\u30fc\u30b6\u3092apache\u30b0\u30eb\u30fc\u30d7\u306b\u6240\u5c5e\u3055\u305b\u308b\n   force user = apache\u3000\u3000\u3000\n   force group = apache\n   recycle:repository = .recycle\n   recycle:keeptree = no\n   recycle:versions = yes\n   recycle:touch = no\n   recycle:maxsize = 0\n   recycle:exclude = *.tmp ~$*\n   \n   # /var/www/html \u4ee5\u4e0b\u306f\u6307\u5b9a\u30b0\u30eb\u30fc\u30d7\u306a\u3089\u8aad\u307f\u66f8\u304d\u5909\u66f4\u53ef\u80fd\u306b\u3057\u305f\u3044\u306e\u3067\u3001umask\u8a2d\u5b9a\n   create mask = 0664\n   directory mask = 0775\n   \n```\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u59a5\u5f53\u6027\u306e\u78ba\u8a8d\u3092\u3057\u307e\u3059\u3002 \ntestparm\u30b3\u30de\u30f3\u30c9\u3067\u3001\u30c1\u30a7\u30c3\u30af\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\n```\n# testparm\n\nLoad smb config files from /etc/samba/smb.conf\nrlimit_max: increasing rlimit_max (1024) to minimum Windows limit (16384)\nProcessing section \"[homes]\"\nProcessing section \"[apache_docroot]\"\nLoaded services file OK.\nServer role: ROLE_DOMAIN_MEMBER\nPress enter to see a dump of your service definitions\n\n\u30ea\u30bf\u30fc\u30f3\u3059\u308b\u3068\u3001\u78ba\u8a8d\u306e\u305f\u3081\u8a2d\u5b9a\u5185\u5bb9\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\n\n-- [\u4ee5\u4e0b\u7565] --\n\n```\n\t\t\n### useradd \u3067 OS & samba\u53cc\u65b9\u3067\u5229\u7528\u3059\u308b\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\n\napache\u30b0\u30eb\u30fc\u30d7\u306b\u6240\u5c5e\u3055\u305b\u305f\u3044\u306e\u3067\u3001\u307e\u305a\u78ba\u8a8d\u3002\n\n```\n# id apache\nuid=48(apache) gid=48(apache) \u6240\u5c5e\u30b0\u30eb\u30fc\u30d7=48(apache)\n```\n\n\u30b0\u30eb\u30fc\u30d7\u3092\u6307\u5b9a\u3057\u3066\u3001smbuser\u3068\u3044\u3046\u540d\u524d\u306e\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\n# useradd -u 500 -G apache smbuser\n```\n\n\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```\n# id smbuser\nuid=500(smbuser) gid=500(smbuser) \u6240\u5c5e\u30b0\u30eb\u30fc\u30d7=500(smbuser),48(apache)\n\n# passwd smbuser\n\u30e6\u30fc\u30b6\u30fc smbuser \u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5909\u66f4\u3002\n\n-- [ \u4ee5\u4e0b\u7565 ] --\n\n```\t\n\n\u30e6\u30fc\u30b6\uff1asmbuser \u3092samba\u7d4c\u7531\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3001samba\u7528\u306e\u8a2d\u5b9a\u3092\u5b9f\u65bd\u3057\u307e\u3059\u3002\n(pdbedit\u3092\u5229\u7528)\n\n\u57fa\u672c\u306fOS\u4e0a\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3068\u63c3\u3048\u307e\u3059\u3002\n\n```\n# pdbedit -a smbuser\nnew password:\nretype new password:\nUnix username:        smbuser\n\n[\u4ee5\u4e0b\u7565]\n\n# pdbedit -L\nsmbuser:500:\n\n```\n\n### SSH\u3067\u306esamba\u7528\u30e6\u30fc\u30b6\u306e\u30ed\u30b0\u30a4\u30f3\u78ba\u8a8d\n\n\u307e\u305a\u306fSSH\u304b\u3089\u63a5\u7d9a\u3067\u304d\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\n$ ssh smbuser@192.168.33.10\nsmbuser@192.168.33.10's password: \nLast login: Fri Dec 23 10:36:33 2016 from 192.168.33.1\n[smbuser@localhost ~]$ \n```\n\n### samba\u30e6\u30fc\u30b6\u306esamba\u7d4c\u7531\u3067\u306e\u30a2\u30af\u30bb\u30b9\u78ba\u8a8d (Mac\u304b\u3089)\n\n\u63a5\u7d9a\u306fWindows\u3067\u306f\u306a\u304fMac\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n**\u3084\u308b\u3053\u3068\uff1a**\n\n- apache\u7528\u306e/var/www/html \u3092\u3001Mac\u4e0a\u306esmb_apache\u3068\u3044\u3046\u30d5\u30a9\u30eb\u30c0\u306b\u5272\u308a\u5f53\u3066\u308b\n- \u8aad\u307f\u66f8\u304d\u53ef\u80fd\u306a\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n\n\u30d5\u30a1\u30a4\u30f3\u30c0\u304b\u3089\u300c\u30b5\u30fc\u30d0\u306b\u63a5\u7d9a\u300d\u3067\u3082OK\u3067\u3059\u304c\u3001\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u304b\u3089\u306e\u307b\u3046\u304c\u3001\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u5229\u7528\u3057\u3066\u8aad\u307f\u66f8\u304d\u30b3\u30d4\u30fc\u3057\u3084\u3059\u3044\u306e\u3067\u3001mount_smbfs \u3092\u4f7f\u3044\u307e\u3059\u3002\u63a5\u7d9a\u89e3\u9664\u306e\u3068\u304d\u306f\u3001umount \u3067OK\u3067\u3059\u3002\n\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u308c\u308b\u3068\u3001\u3046\u307e\u304f\u63a5\u7d9a\u3067\u304d\u3066\u3082\u300csuccess!\u300d\u3068\u304b\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u51fa\u307e\u305b\u3093\u3002\nls \u3068\u304b\u3067\u3061\u3083\u3093\u3068\u30de\u30a6\u30f3\u30c8\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n\n- \u53c2\u8003: [Mac\u3067\u30bf\u30fc\u30df\u30ca\u30eb\u304b\u3089Samba\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b](http://qiita.com/mach3/items/e7021b9e50f2b536a86b) by @mach3 \u3055\u307e\n\n```\n# \u3069\u3053\u3067\u3082\u3044\u3044\u306e\u3067\u30de\u30a6\u30f3\u30c8\u30dd\u30a4\u30f3\u30c8\u7528\u306e\u7a7a\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210\n$ mkdir smb_apache\n\n# \u63a5\u7d9a\u5b9f\u65bd\n$ mount_smbfs //smbuser@192.168.33.10/apache_docroot smb_apache\nPassword for 192.168.33.10:   # \u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u308c\u308b\n\n$ ls -la smb_apache\n\ntotal 6208\ndrwx------   1 xxx  staff  16384 12 23 21:58 .\ndrwxr-xr-x  19 xxx  staff    646 12 23 21:29 ..\n-rwx------@  1 xxx  staff   6148 12 23 20:07 .DS_Store\n-rwx------   1 xxx  staff   4096 12 23 20:06 ._.DS_Store\ndrwx------   1 xxx  staff  16384 12 23 21:50 .recycle\n-rwx------   1 xxx  staff      7 12 23 21:58 data.txt\n\n$ umound smb_apache # \u63a5\u7d9a\u65ad\n```\n\n### \u304a\u597d\u304d\u306a\u30a8\u30c7\u30a3\u30bf\u3067Samba\u7d4c\u7531\u3067\u66f8\u304d\u8fbc\u307f\n\nsmb.conf \u3067 force user = apache, force group = apache\u3000\u3068\u3057\u3066\u3044\u308b\u306e\u3067\u3001smbuser \u3068\u3057\u3066\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3044\u3066\u3082\u3001\u66f8\u304d\u8fbc\u3093\u3060\u30d5\u30a1\u30a4\u30eb\u3092CentOS\u5074\u304b\u3089\u898b\u308b\u3068\u3001Owner/Group \u3068\u3082\u306bapache:apache\u306b\u306a\u308a\u307e\u3059\u3002\n\nforce ... \u304c\u5acc\u306a\u5834\u5408\u306f\u3001\u4e0a\u8a18\u306b\u66f8\u3044\u305f\u901a\u308a\u3001samba\u3067\u30a2\u30af\u30bb\u30b9\u3055\u305b\u308b\u30e6\u30fc\u30b6\u3092apache\u30b0\u30eb\u30fc\u30d7\u306b\u6240\u5c5e\u3055\u305b\u3066\u304a\u304d\u3001setgid\u3082\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n\n### \u3046\u307e\u304f\u3044\u304b\u306a\u3044\u5834\u5408\n\n\u30b5\u30fc\u30d0\u5074\u306e /var/log/samba/log.%m  (\u4eca\u56de\u306e\u4f8b\u3060\u3068 /var/log/samba/log.192.168.33.1 )\u3092\u898b\u3066\u898b\u307e\u3057\u3087\u3046\u3002\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n```\n# tail -2  /var/log/samba/log.192.168.33.1 \n\n# \u6210\u529f\u306e\u5834\u5408\n[2016/12/23 15:39:36.538770,  2] ../source3/auth/auth.c:305(auth_check_ntlm_password)\n  check_ntlm_password:  authentication for user [smbuser] -> [smbuser] -> [smbuser] succeeded\n  \n# \u5931\u6557\u306e\u5834\u5408  \n[2016/12/23 11:34:33.483544,  2] ../source3/auth/auth.c:315(auth_check_ntlm_password)\n  check_ntlm_password:  Authentication for user [smbuser] -> [smbuser] FAILED with error xxxxx \n```\n\n---------------------\n\n\u4ee5\u4e0a\u3001\u30e1\u30e2\u3067\u3057\u305f\u3002\n", "tags": ["CentOS", "Mac", "vagrant", "samba"]}