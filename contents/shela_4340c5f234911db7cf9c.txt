{"tags": ["ExcelVBA"], "context": " More than 1 year has passed since last update.\n\n\u6982\u8981\nWindows API\u3092\u5229\u7528\u3057\u305f\u30d1\u30a4\u30d7\u51e6\u7406\u3092ExcelVBA\u3067\u5b9f\u88c5\u3057\u3066\u307f\u305f\u306e\u3067\u307e\u3068\u3081\u3066\u304a\u304f\u3002\u30d1\u30a4\u30d7\u51e6\u7406\u306e\u984c\u6750\u306f\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u72487Zip\u3092\u5229\u7528\u3057\u305ftar-gz\u5f62\u5f0f\u3067\u306e\u5727\u7e2e\u3067\u3042\u308b\u3002\n7Zip\u3067tar-gz\u5f62\u5f0f\u306e\u5727\u7e2e\u3092\u884c\u3046\u5834\u5408\u306f\u4e00\u5ea6tar\u5f62\u5f0f\u306b\u3057\u305f\u3042\u3068gzip\u3067\u5727\u7e2e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u304c\u3001\u4e00\u5ea6tar\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u305f\u5f8cgzip\u5727\u7e2e\u3059\u308b\u3068gzip\u30d5\u30a1\u30a4\u30eb\u306btar\u30d5\u30a1\u30a4\u30eb\u306e\u60c5\u5831\u304c\u683c\u7d0d\u3055\u308c\u3066\u30c0\u30b5\u3044\u30027Zip\u306b\u306f\u6a19\u6e96\u51fa\u529b\u306b\u5727\u7e2e\u30c7\u30fc\u30bf\u3092\u5410\u304d\u51fa\u3057\u305f\u308a\u6a19\u6e96\u5165\u529b\u306e\u30c7\u30fc\u30bf\u3092\u5727\u7e2e\u3059\u308b\u6a5f\u80fd\u304c\u3042\u308b\u306e\u3067\u3001\u3053\u308c\u3068\u30d1\u30a4\u30d7\u3092\u7d44\u307f\u5408\u308f\u305b\u3066tar\u30d5\u30a1\u30a4\u30eb\u60c5\u5831\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u306a\u3044tar-gz\u5f62\u5f0f\u306e\u5727\u7e2e\u3092\u884c\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\u306a\u304a\u3001ExcelVBA\u3092\u4f7f\u3063\u305f\u306e\u306f\u958b\u767a\u74b0\u5883\u3092\u7528\u610f\u3067\u304d\u306a\u304b\u3063\u305f\u3060\u3051\u3067ExcelVBA\u3067\u3042\u308b\u7406\u7531\u306f\u5168\u304f\u306a\u3044\u3002\n\nWindows API\u306e\u5ba3\u8a00\u306b\u3064\u3044\u3066\nExcelVBA\u3067\u30d1\u30a4\u30d7\u51e6\u7406\u3092\u884c\u3046\u306b\u306fWindows API\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u306b\u306a\u308b\u304c\u3001Windows API\u3092\u5229\u7528\u3059\u308b\u306b\u306f\u4f7f\u7528\u3059\u308b\u95a2\u6570\u3084\u69cb\u9020\u4f53\u3001\u5b9a\u6570\u3092\u5ba3\u8a00\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002MSDN\u30e9\u30a4\u30d6\u30e9\u30ea\u306eC/C++\u7528\u306e\u95a2\u6570\u5b9a\u7fa9\u3092\u53c2\u7167\u3057\u3066VBA\u7528\u306b\u66f8\u304d\u63db\u3048\u3066\u3044\u304f\u3053\u3068\u306b\u306a\u308b\u304c\u3001\u3053\u308c\u304c\u7d50\u69cb\u5927\u5909\u3002\u5b9f\u306fMicrosoft\u304cVB/VBA\u7528\u306e\u95a2\u6570\u5b9a\u7fa9\u3092\u516c\u958b\u3057\u3066\u304f\u308c\u3066\u3044\u308b\u306e\u3067\u3053\u308c\u3092\u5229\u7528\u3059\u308b\u3068\u7c21\u5358\u3002\nx86\u7248\nVisual Basic Win32 API Declarations\nx64\u7248\nOffice 2010 Help Files: Win32API_PtrSafe with 64-bit Support\n\n\u30b3\u30fc\u30c9\nx64\u7248Excel\u7528\u306e\u30b3\u30fc\u30c9\u3060\u304c\u3001PtrSafe\u3092\u524a\u9664\u3057\u3066LongPtr\u3092Long\u306b\u4fee\u6b63\u3059\u308c\u3070x86\u7248\u3067\u3082\u52d5\u304f\u306f\u305a\u3002\n\n\u6a19\u6e96\u30e2\u30b8\u30e5\u30fc\u30eb\nOption Explicit\n\nPrivate Declare PtrSafe Sub ZeroMemory Lib \"kernel32\" Alias \"RtlZeroMemory\" ( _\n    ByRef dest As Any, _\n    ByVal numBytes As LongPtr)\n\nPrivate Declare PtrSafe Function CreatePipe Lib \"kernel32\" ( _\n    ByRef phReadPipe As LongPtr, _\n    ByRef phWritePipe As LongPtr, _\n    ByRef lpPipeAttributes As SECURITY_ATTRIBUTES, _\n    ByVal nSize As Long) As Long\n\nPrivate Declare PtrSafe Function SetHandleInformation Lib \"kernel32\" ( _\n    ByVal hObject As LongPtr, _\n    ByVal dwMask As Long, _\n    ByVal dwFlags As Long) As Long\n\nPrivate Declare PtrSafe Function CreateProcess Lib \"kernel32\" Alias \"CreateProcessA\" ( _\n    ByVal lpApplicationName As String, _\n    ByVal lpCommandLine As String, _\n    ByRef lpProcessAttributes As SECURITY_ATTRIBUTES, _\n    ByRef lpThreadAttributes As SECURITY_ATTRIBUTES, _\n    ByVal bInheritHandles As Long, _\n    ByVal dwCreationFlags As Long, _\n    ByRef lpEnvironment As Any, _\n    ByVal lpCurrentDriectory As String, _\n    ByRef lpStartupInfo As STARTUPINFO, _\n    ByRef lpProcessInformation As PROCESS_INFORMATION) As Long\n\nPrivate Declare PtrSafe Function GetStdHandle Lib \"kernel32\" ( _\n    ByVal nStdHandle As Long) As LongPtr\n\nPrivate Declare PtrSafe Function PeekNamedPipe Lib \"kernel32\" ( _\n    ByVal hNamedPipe As LongPtr, _\n    ByRef lpBuffer As Any, _\n    ByVal nBufferSize As Long, _\n    ByRef lpBytesRead As Long, _\n    ByRef lpTotalBytesAvail As Long, _\n    ByRef lpBytesLeftThisMessage As Long) As Long\n\nPrivate Declare PtrSafe Function ReadFile Lib \"kernel32\" ( _\n    ByVal hFile As LongPtr, _\n    ByRef lpBuffer As Any, _\n    ByVal nNumberOfBytesToRead As Long, _\n    ByRef lpNumberOfBytesRead As Long, _\n    ByRef lpOverlapped As OVERLAPPED) As Long\n\nPrivate Declare PtrSafe Function WriteFile Lib \"kernel32\" ( _\n    ByVal hFile As LongPtr, _\n    ByRef lpBuffer As Any, _\n    ByVal nNumberOfBytesToWrite As Long, _\n    ByRef lpNumberOfBytesWritten As Long, _\n    ByRef lpOverlapped As OVERLAPPED) As Long\n\nPrivate Declare PtrSafe Function GetExitCodeProcess Lib \"kernel32\" ( _\n    ByVal hProcess As LongPtr, _\n    ByRef lpExitCode As Long) As Long\n\nPrivate Declare PtrSafe Function CloseHandle Lib \"kernel32\" ( _\n    ByVal hObject As LongPtr) As Long\n\nPrivate Type SECURITY_ATTRIBUTES\n    nLength As Long\n    lpSecurityDescriptor As LongPtr\n    bInheritHandle As Long\nEnd Type\n\nPrivate Type STARTUPINFO\n    cb As Long\n    lpReserved As String\n    lpDesktop As String\n    lpTitle As String\n    dwX As Long\n    dwY As Long\n    dwXSize As Long\n    dwYSize As Long\n    dwXCountChars As Long\n    dwYCountChars As Long\n    dwFillAttribute As Long\n    dwFlags As Long\n    wShowWindow As Integer\n    cbReserved2 As Integer\n    lpReserved2 As LongPtr\n    hStdInput As LongPtr\n    hStdOutput As LongPtr\n    hStdError As LongPtr\nEnd Type\n\nPrivate Type PROCESS_INFORMATION\n    hProcess As LongPtr\n    hThread As LongPtr\n    dwProcessId As Long\n    dwThreadId As Long\nEnd Type\n\nPrivate Type OVERLAPPED\n    Internal As LongPtr\n    InternalHigh As LongPtr\n    offset As Long\n    OffsetHigh As Long\n    hEvent As LongPtr\nEnd Type\n\nPrivate Const HANDLE_FLAG_INHERIT = &H1\n\nPrivate Const STD_INPUT_HANDLE = -10&\nPrivate Const STD_OUTPUT_HANDLE = -11&\nPrivate Const STD_ERROR_HANDLE = -12&\n\nPrivate Const STARTF_USESHOWWINDOW = &H1\nPrivate Const STARTF_USESTDHANDLES = &H100\nPrivate Const SW_HIDE = 0\n\nPrivate Const STILL_ACTIVE = &H103\n\n'TAR-GZ\u5f62\u5f0f\u3067\u5727\u7e2e\u3059\u308b\n'7Zip\u3092\u5229\u7528\u3001TAR\u5f62\u5f0f\u3067\u5727\u7e2e\u3057\u305f\u7d50\u679c\u3092\u6a19\u6e96\u5165\u529b\u304b\u3089\u53d7\u3051\u53d6\u3063\u3066GZIP\u5727\u7e2e\u3059\u308b\u3053\u3068\u3067TAR-GZ\u5f62\u5f0f\u3067\u5727\u7e2e\u3059\u308b\n'\u30b3\u30de\u30f3\u30c9: 7z a dummy -ttar -so \"\u5727\u7e2e\u5bfe\u8c61\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\" | 7z a \"\u5727\u7e2e\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\" -tgzip -si\nPublic Function makeTarGz() As Boolean\n\n    Const SEVEN_ZIP_PATH As String = \"C:\\Users\\shela\\Desktop\\7z\\7z.exe\" '7Zip\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\n    Const TARGET_PATH As String = \"C:\\Users\\shela\\Desktop\\7z\\History.txt\"    '\u5727\u7e2e\u5bfe\u8c61\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\n    Const TGZ_PATH As String = \"C:\\Users\\shela\\Desktop\\7z\\History.tgz\"   '\u5727\u7e2e\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\n    Const BUFSIZE As Integer = 1024 '\u30d0\u30c3\u30d5\u30a1\u30b5\u30a4\u30ba\n\n    Dim sa As SECURITY_ATTRIBUTES\n    Dim hInRead As LongPtr\n    Dim hInWrite As LongPtr\n    Dim hOutRead As LongPtr\n    Dim hOutWrite As LongPtr\n\n    Dim pi1 As PROCESS_INFORMATION\n    Dim pi2 As PROCESS_INFORMATION\n    Dim si1 As STARTUPINFO\n    Dim si2 As STARTUPINFO\n    Dim saAttr As SECURITY_ATTRIBUTES\n    Dim commandLine1 As String\n    Dim commandLine2 As String\n\n    Dim dwRead As Long\n    Dim dwWritten As Long\n    Dim buffer(BUFSIZE - 1) As Byte\n    Dim ov1 As OVERLAPPED\n    Dim ov2 As OVERLAPPED\n    Dim exitCode1 As Long\n    Dim exitCode2 As Long\n\n    Call ZeroMemory(sa, Len(sa))\n    sa.nLength = Len(sa)\n    sa.bInheritHandle = 1&\n    sa.lpSecurityDescriptor = 0&\n\n    '\u51fa\u529b\u5074\u30d1\u30a4\u30d7\u306e\u4f5c\u6210\n    If CreatePipe(hOutRead, hOutWrite, sa, 0) = 0 Then\n        MsgBox \"\u30d1\u30a4\u30d7\u306e\u4f5c\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9:\" & Err.LastDllError, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n        GoTo Error\n    End If\n\n    '\u51fa\u529b\u5074\u8aad\u307f\u8fbc\u307f\u30cf\u30f3\u30c9\u30eb\u3092\u5b50\u30d7\u30ed\u30bb\u30b9\u306b\u7d99\u627f\u3067\u304d\u306a\u304f\u3059\u308b\n    If SetHandleInformation(hOutRead, HANDLE_FLAG_INHERIT, 0) = 0 Then\n        MsgBox \"\u51fa\u529b\u5074\u8aad\u307f\u8fbc\u307f\u30cf\u30f3\u30c9\u30eb\u306e\u7d99\u627f\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9:\" & Err.LastDllError, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n        GoTo Error\n    End If\n\n    '\u5165\u529b\u5074\u30d1\u30a4\u30d7\u306e\u4f5c\u6210\n    If CreatePipe(hInRead, hInWrite, sa, 0) = 0 Then\n        MsgBox \"\u30d1\u30a4\u30d7\u306e\u4f5c\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9:\" & Err.LastDllError, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n        GoTo Error\n    End If\n\n    '\u5165\u529b\u5074\u66f8\u304d\u8fbc\u307f\u30cf\u30f3\u30c9\u30eb\u3092\u5b50\u30d7\u30ed\u30bb\u30b9\u306b\u7d99\u627f\u3067\u304d\u306a\u304f\u3059\u308b\n    If SetHandleInformation(hInWrite, HANDLE_FLAG_INHERIT, 0) = 0 Then\n        MsgBox \"\u5165\u529b\u5074\u66f8\u304d\u8fbc\u307f\u30cf\u30f3\u30c9\u30eb\u306e\u7d99\u627f\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9:\" & Err.LastDllError, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n        GoTo Error\n    End If\n\n    '\u30b3\u30de\u30f3\u30c9\u751f\u6210\n    'TAR\u5727\u7e2e->\u6a19\u6e96\u51fa\u529b\n    commandLine1 = \"\"\"\" & SEVEN_ZIP_PATH & \"\"\" a dummy -ttar -so \"\"\" & TARGET_PATH & \"\"\"\"\n    '\u6a19\u6e96\u5165\u529b->GZIP\u5727\u7e2e\n    commandLine2 = \"\"\"\" & SEVEN_ZIP_PATH & \"\"\" a \"\"\" & TGZ_PATH & \"\"\" -tgzip -si\"\n\n    Call ZeroMemory(si1, Len(si1))\n    si1.cb = Len(si1)\n    si1.hStdInput = GetStdHandle(STD_INPUT_HANDLE)\n    si1.hStdOutput = hOutWrite\n    si1.hStdError = GetStdHandle(STD_ERROR_HANDLE)\n    si1.dwFlags = STARTF_USESTDHANDLES Or STARTF_USESHOWWINDOW\n    si1.wShowWindow = SW_HIDE\n\n    Call ZeroMemory(si2, Len(si2))\n    si2.cb = Len(si2)\n    si2.hStdInput = hInRead\n    si2.hStdOutput = GetStdHandle(STD_OUTPUT_HANDLE)\n    si2.hStdError = GetStdHandle(STD_ERROR_HANDLE)\n    si2.dwFlags = STARTF_USESTDHANDLES Or STARTF_USESHOWWINDOW\n    si2.wShowWindow = SW_HIDE\n\n    '\u30d7\u30ed\u30bb\u30b9\u751f\u6210(TAR\u5727\u7e2e)\n    If CreateProcess(vbNullString, commandLine1, saAttr, saAttr, 1&, 0&, 0&, vbNullString, si1, pi1) = 0 Then\n        MsgBox \"\u30d7\u30ed\u30bb\u30b9\u751f\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9:\" & Err.LastDllError, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n        GoTo Error\n    End If\n\n    Call CloseHandle(pi1.hThread)\n\n    '\u30d7\u30ed\u30bb\u30b9\u751f\u6210(GZIP\u5727\u7e2e)\n    If CreateProcess(vbNullString, commandLine2, saAttr, saAttr, 1&, 0&, 0&, vbNullString, si2, pi2) = 0 Then\n        MsgBox \"\u30d7\u30ed\u30bb\u30b9\u751f\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9:\" & Err.LastDllError, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n        GoTo Error\n    End If\n\n    Call CloseHandle(pi2.hThread)\n\n    Do While True\n        '\u7d42\u4e86\u30b9\u30c6\u30fc\u30bf\u30b9\u30b3\u30fc\u30c9\u306e\u53d6\u5f97\n        If GetExitCodeProcess(pi1.hProcess, exitCode1) = 0 Then\n            MsgBox \"\u7d42\u4e86\u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9:\" & Err.LastDllError, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n            GoTo Error\n        End If\n\n        If GetExitCodeProcess(pi2.hProcess, exitCode2) = 0 Then\n            MsgBox \"\u7d42\u4e86\u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9:\" & Err.LastDllError, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n            GoTo Error\n        End If\n\n        '\u51fa\u529b\u5074\u30d1\u30a4\u30d7\u304b\u3089\u30c7\u30fc\u30bf\u304c\u8aad\u3081\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n        If PeekNamedPipe(hOutRead, 0&, 0, 0&, dwRead, ByVal 0) = 0 Then\n            MsgBox \"\u30d1\u30a4\u30d7\u304b\u3089\u30c7\u30fc\u30bf\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9:\" & Err.LastDllError, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n            GoTo Error\n        End If\n\n        If dwRead > 0 Then\n            Erase buffer\n            '\u51fa\u529b\u5074\u30d1\u30a4\u30d7\u304b\u3089\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u53d6\u308b\n            If ReadFile(hOutRead, buffer(0), UBound(buffer) + 1, dwRead, ov1) = 0 Then\n                Exit Do\n            End If\n\n            '\u8aad\u307f\u53d6\u3063\u305f\u30c7\u30fc\u30bf\u3092\u5165\u529b\u5074\u30d1\u30a4\u30d7\u306b\u66f8\u304d\u8fbc\u3080\n            If WriteFile(hInWrite, buffer(0), dwRead, dwWritten, ov2) = 0 Then\n                Exit Do\n            End If\n        Else\n            If exitCode1 <> STILL_ACTIVE Or exitCode2 <> STILL_ACTIVE Then\n                Exit Do\n            End If\n        End If\n\n        DoEvents\n    Loop\n\n    Call CloseHandle(pi1.hProcess)\n    Call CloseHandle(hOutWrite)\n    Call CloseHandle(hOutRead)\n\n    '\u7d42\u4e86\u30b3\u30fc\u30c9\u30c1\u30a7\u30c3\u30af\n    If exitCode1 <> 0 And exitCode1 <> STILL_ACTIVE Then\n        MsgBox \"\u7570\u5e38\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002\u7d42\u4e86\u30b3\u30fc\u30c9:\" & exitCode1, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n        GoTo Error\n    ElseIf exitCode2 <> 0 And exitCode2 <> STILL_ACTIVE Then\n        MsgBox \"\u7570\u5e38\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002\u7d42\u4e86\u30b3\u30fc\u30c9:\" & exitCode2, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n        GoTo Error\n    End If\n\n    '\u5165\u529b\u5074\u66f8\u304d\u8fbc\u307f\u30cf\u30f3\u30c9\u30eb\u3092\u9589\u3058\u308b\u3053\u3068\u3067\u30d7\u30ed\u30bb\u30b9(GZIP\u5727\u7e2e)\u306e\u8aad\u307f\u8fbc\u307f\u3092\u7d42\u4e86\u3055\u305b\u308b\n    Call CloseHandle(hInWrite)\n\n    '\u30d7\u30ed\u30bb\u30b9(GZIP\u5727\u7e2e)\u7d42\u4e86\u307e\u3067\u5f85\u6a5f\n    Do\n        If GetExitCodeProcess(pi2.hProcess, exitCode2) = 0 Then\n            MsgBox \"\u7d42\u4e86\u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9:\" & Err.LastDllError, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n            GoTo Error\n        End If\n        DoEvents\n    Loop While exitCode2 = STILL_ACTIVE\n\n    Call CloseHandle(pi2.hProcess)\n    Call CloseHandle(hInRead)\n\n    '\u30d7\u30ed\u30bb\u30b9(GZIP\u5727\u7e2e)\u306e\u7d42\u4e86\u30b3\u30fc\u30c9\u30c1\u30a7\u30c3\u30af\n    If exitCode2 <> 0 Then\n        MsgBox \"\u7570\u5e38\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002\u7d42\u4e86\u30b3\u30fc\u30c9:\" & exitCode2, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n        GoTo Error\n    End If\n\n    MsgBox \"\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002\", Buttons:=vbInformation, Title:=\"\u5b8c\u4e86\"\n    makeTarGz = True\n    Exit Function\n\n'\u30a8\u30e9\u30fc\u51e6\u7406\nError:\n    makeTarGz = False\n\n    Call CloseHandle(pi1.hThread)\n    Call CloseHandle(pi1.hProcess)\n    Call CloseHandle(pi2.hThread)\n    Call CloseHandle(pi2.hProcess)\n    Call CloseHandle(hOutWrite)\n    Call CloseHandle(hOutRead)\n    Call CloseHandle(hInRead)\n    Call CloseHandle(hInWrite)\nEnd Function\n\n\n\n\u6ce8\u610f\u70b9\u306a\u3069\n\n\u30d1\u30a4\u30d7\u306e\u8aad\u307f\u66f8\u304d\nReadFile\u95a2\u6570\u3067\u30d1\u30a4\u30d7\u304b\u3089\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u3080\u5834\u5408\u3001\u4ed6\u306e\u30d7\u30ed\u30bb\u30b9\u304b\u3089\u30d1\u30a4\u30d7\u306b\u30c7\u30fc\u30bf\u304c\u66f8\u304d\u8fbc\u307e\u308c\u308b\u307e\u3067\u51e6\u7406\u3092\u30d6\u30ed\u30c3\u30af\u3059\u308b\u3002WriteFile\u95a2\u6570\u3067\u30d1\u30a4\u30d7\u306b\u30c7\u30fc\u30bf\u3092\u66f8\u304d\u8fbc\u3080\u5834\u5408\u3001\u30d1\u30a4\u30d7\u306e\u30d0\u30c3\u30d5\u30a1\u304c\u3044\u3063\u3071\u3044\u306b\u306a\u308b\u3068ReadFile\u95a2\u6570\u306a\u3069\u3067\u30d1\u30a4\u30d7\u304b\u3089\u30c7\u30fc\u30bf\u304c\u8aad\u307f\u51fa\u3055\u308c\u3066\u30d0\u30c3\u30d5\u30a1\u304c\u30af\u30ea\u30a2\u3055\u308c\u306a\u3044\u9650\u308a\u6b8b\u308a\u306e\u30c7\u30fc\u30bf\u3092\u66f8\u304d\u8fbc\u3081\u305a\u51e6\u7406\u3092\u30d6\u30ed\u30c3\u30af\u3059\u308b\u3002\nAnonymous Pipe Operations\n\u4e0a\u8a18\u30b3\u30fc\u30c9\u306e\u3088\u3046\u306b\u81ea\u5206\u3067\u30d1\u30a4\u30d7\u306e\u8aad\u307f\u66f8\u304d\u3092\u5236\u5fa1\u3059\u308b\u5834\u5408\u3001\u6307\u5b9a\u3059\u308b\u30d0\u30c3\u30d5\u30a1\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3059\u304e\u305f\u308a\u51e6\u7406\u306e\u6d41\u308c\u3092\u9593\u9055\u3048\u3066\u5b9f\u88c5\u3059\u308b\u3060\u3051\u3067\u7c21\u5358\u306b\u505c\u6b62\u3057\u306a\u3044\u30d7\u30ed\u30b0\u30e9\u30e0\u304c\u3067\u304d\u3066\u3057\u307e\u3046\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u3002\n7Zip\u3067\u306f-ao(Overwrite mode)\u30b9\u30a4\u30c3\u30c1\u3092\u3064\u3051\u306a\u3044\u9650\u308a\u6307\u5b9a\u3057\u305f\u5727\u7e2e\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3059\u308b\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308b\u304c\u3001(7Zip\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u78ba\u8a8d\u3057\u305f\u308f\u3051\u3067\u306f\u306a\u3044\u304c)\u3053\u306e\u30c1\u30a7\u30c3\u30af\u306f\u30d1\u30a4\u30d7\u304b\u3089\u30c7\u30fc\u30bf\u304c\u8aad\u307f\u51fa\u3055\u308c\u305f\u5f8c\u3067\u884c\u308f\u308c\u308b\u3088\u3046\u3067\u3001WriteFile\u95a2\u6570\u3067\u66f8\u304d\u8fbc\u3082\u3046\u3068\u3057\u3066\u3044\u308b\u30c7\u30fc\u30bf\u30b5\u30a4\u30ba\u304c\u30d1\u30a4\u30d7\u306e\u30d0\u30c3\u30d5\u30a1\u30b5\u30a4\u30ba\u3092\u8d85\u3048\u3066\u3044\u30667Zip\u5074\u306e\u8aad\u307f\u51fa\u3057\u30b5\u30a4\u30ba\u304cWriteFile\u95a2\u6570\u3067\u66f8\u304d\u8fbc\u3082\u3046\u3068\u3057\u3066\u3044\u308b\u30c7\u30fc\u30bf\u30b5\u30a4\u30ba\u3088\u308a\u5c0f\u3055\u3044\u5834\u5408\u3001WriteFile\u95a2\u6570\u306e\u3068\u3053\u308d\u3067\u51e6\u7406\u304c\u6b62\u307e\u3063\u3066\u3057\u307e\u3063\u3066\u30d7\u30ed\u30bb\u30b9\u306e\u7d42\u4e86\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u53c2\u7167\u3057\u3088\u3046\u306b\u3082\u3067\u304d\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u3002\n\u3053\u306e\u5834\u5408\u306f\u3001WriteFile\u95a2\u6570\u3067\u66f8\u304d\u8fbc\u3082\u3046\u3068\u3057\u3066\u3044\u308b\u30c7\u30fc\u30bf\u30b5\u30a4\u30ba\u3092\u5c0f\u3055\u304f\u3059\u308b\u304b\u3001\u30d1\u30a4\u30d7\u306e\u30d0\u30c3\u30d5\u30a1\u30b5\u30a4\u30ba\u3092\u5927\u304d\u304f\u3059\u308b\u3053\u3068\u3067\u56de\u907f\u3067\u304d\u308b\u3002\n\nPeekNamedPipe\u95a2\u6570\n\u533f\u540d\u30d1\u30a4\u30d7\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u306e\u306b\u306a\u305cNamed\uff1f\u3068\u5c11\u3057\u6c17\u306b\u306a\u308b\u304c\u3001PeekNamedPipe\u95a2\u6570\u306f\u30d1\u30a4\u30d7\u5185\u306b\u30c7\u30fc\u30bf\u304c\u5b58\u5728\u3057\u3066\u3044\u306a\u3044\u5834\u5408\u3067\u3082\u5373\u5ea7\u306b\u5fdc\u7b54\u3092\u8fd4\u3057\u30d1\u30a4\u30d7\u304b\u3089\u8aad\u307f\u53d6\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u7dcf\u30d0\u30a4\u30c8\u6570\u3092\u53d6\u5f97\u3067\u304d\u308b\u306e\u3067\u3001ReadFile\u95a2\u6570\u3067\u30c7\u30fc\u30bf\u3092\u8aad\u3080\u524d\u306e\u30c1\u30a7\u30c3\u30af\u3092\u884c\u3063\u3066\u3044\u308b\u3002\n\n\u30d1\u30a4\u30d7\u306e\u30c7\u30fc\u30bf\u306e\u7d42\u7aef\n\u30d1\u30a4\u30d7\u306b\u66f8\u304d\u8fbc\u3080\u30c7\u30fc\u30bf\u306f\u30d0\u30c3\u30d5\u30a1\u30b5\u30a4\u30ba\u3092\u8d85\u3048\u306a\u3051\u308c\u3070\u4f55\u56de\u306b\u5206\u3051\u3066\u66f8\u304d\u8fbc\u3093\u3067\u3082\u554f\u984c\u306a\u3044\u306e\u3067\u3001\u5b50\u30d7\u30ed\u30bb\u30b9\u304c\u30d1\u30a4\u30d7\u304b\u3089\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u51fa\u3059\u5834\u5408\u3069\u3053\u307e\u3067(\u4f55\u56de)\u8aad\u3081\u3070\u30c7\u30fc\u30bf\u306e\u7d42\u7aef\u306b\u306a\u308b\u304b\u3042\u3089\u304b\u3058\u3081\u77e5\u308b\u3053\u3068\u306f\u3067\u304d\u306a\u3044\u3002\u30c7\u30fc\u30bf\u306e\u7d42\u7aef\u304c\u5206\u304b\u3089\u306a\u3051\u308c\u3070ReadFile\u95a2\u6570\u306f\u8aad\u307f\u51fa\u3057\u30d0\u30c3\u30d5\u30a1\u304c\u3044\u3063\u3071\u3044\u306b\u306a\u308b\u307e\u3067\u5ef6\u3005\u3068\u30c7\u30fc\u30bf\u3092\u5f85\u3061\u7d9a\u3051\u3066\u3057\u307e\u3046\u3002\u3053\u308c\u3067\u306f\u56f0\u308b\u306e\u3067\u3001CloseHandle\u95a2\u6570\u3092\u547c\u3093\u3067\u66f8\u304d\u8fbc\u307f\u5074\u30cf\u30f3\u30c9\u30eb\u3092\u30af\u30ed\u30fc\u30ba\u3059\u308b\u3053\u3068\u3067\u5b50\u30d7\u30ed\u30bb\u30b9\u304c\u30c7\u30fc\u30bf\u306e\u7d42\u7aef\u3092\u5206\u304b\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n\n\u30d1\u30a4\u30d7\u306e\u30cf\u30f3\u30c9\u30eb\u306e\u7d99\u627f\nCreatePipe\u95a2\u6570\u3067\u30d1\u30a4\u30d7\u3092\u4f5c\u6210\u3059\u308b\u969b\u3001SECURITY_ATTRIBUTES\u69cb\u9020\u4f53\u306ebInheritHandle\u30d5\u30a3\u30fc\u30eb\u30c9\u3067\u5b50\u30d7\u30ed\u30bb\u30b9\u306b\u30cf\u30f3\u30c9\u30eb\u3092\u7d99\u627f\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3067\u304d\u308b\u3002\u30cf\u30f3\u30c9\u30eb\u3092\u7d99\u627f\u3059\u308b\u3068\u5b50\u30d7\u30ed\u30bb\u30b9\u304b\u3089\u3082\u30d1\u30a4\u30d7\u3092\u64cd\u4f5c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\u305f\u3060\u3057\u3001\u66f8\u304d\u8fbc\u307f\u3068\u8aad\u307f\u8fbc\u307f\u306e\u4e21\u65b9\u306e\u30cf\u30f3\u30c9\u30eb\u3092\u7d99\u627f\u3055\u305b\u3066\u3057\u307e\u3046\u3068\u89aa\u30d7\u30ed\u30bb\u30b9\u304b\u3089\u66f8\u304d\u8fbc\u307f\u5074\u30cf\u30f3\u30c9\u30eb\u3092\u30af\u30ed\u30fc\u30ba\u3057\u3066\u3082\u30d1\u30a4\u30d7\u306e\u30c7\u30fc\u30bf\u306e\u7d42\u7aef\u304c\u5206\u304b\u3089\u306a\u304f\u306a\u308b(\u5b50\u30d7\u30ed\u30bb\u30b9\u5074\u304b\u3089\u306f\u307e\u3060\u66f8\u304d\u8fbc\u307f\u5074\u30cf\u30f3\u30c9\u30eb\u3092\u64cd\u4f5c\u3067\u304d\u308b\u305f\u3081)\u3068\u3044\u3063\u305f\u554f\u984c\u304c\u767a\u751f\u3059\u308b\u306e\u3067\u3001SetHandleInformation\u95a2\u6570\u3084DuplicateHandle\u95a2\u6570\u3092\u5229\u7528\u3057\u3066\u7247\u5074\u306e\u30cf\u30f3\u30c9\u30eb\u3060\u3051\u3092\u7d99\u627f\u3067\u304d\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n\u4e0a\u8a18\u30b3\u30fc\u30c9\u3067\u306f\u3001SECURITY_ATTRIBUTES\u69cb\u9020\u4f53\u3067\u3072\u3068\u307e\u305a\u8aad\u307f\u66f8\u304d\u4e21\u65b9\u306e\u30cf\u30f3\u30c9\u30eb\u3092\u7d99\u627f\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057SetHandleInformation\u95a2\u6570\u3067\u4e00\u65b9\u306e\u30cf\u30f3\u30c9\u30eb\u3092\u7d99\u627f\u3057\u306a\u3044\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u76f4\u3057\u3066\u3044\u308b\u304c\u3001SECURITY_ATTRIBUTES\u69cb\u9020\u4f53\u3067\u306f\u4e21\u65b9\u306e\u30cf\u30f3\u30c9\u30eb\u3092\u7d99\u627f\u3057\u306a\u3044\u3088\u3046\u306b\u8a2d\u5b9a\u3057SetHandleInformation\u95a2\u6570\u3067\u4e00\u65b9\u306e\u30cf\u30f3\u30c9\u30eb\u3092\u7d99\u627f\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u76f4\u3059\u3068\u3044\u3046\u3084\u308a\u65b9\u3067\u3082\u3088\u3044\u3002\n\n\u7d42\u4e86\u30b3\u30fc\u30c9\nGetExitCodeProcess\u95a2\u6570\u306e\u7b2c2\u5f15\u6570\u306e\u5024\u3067\u30d7\u30ed\u30bb\u30b9\u304c\u307e\u3060\u5b9f\u884c\u4e2d(STILL_ACTIVE)\u306a\u306e\u304b\u7d42\u4e86\u3057\u305f\u306e\u304b\u3092\u691c\u77e5\u3057\u3066\u3044\u308b\u304c\u3001\u5b9f\u884c\u3057\u3066\u3044\u308b\u30d7\u30ed\u30bb\u30b9\u304c\u30a8\u30e9\u30fc\u6642\u306bSTILL_ACTIVE\u3068\u540c\u3058\u5024(259)\u3092\u8fd4\u3059\u3088\u3046\u306a\u4f5c\u308a\u306b\u306a\u3063\u3066\u3044\u308b\u3068\u3001\u4e07\u4e00\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u306b\u7d42\u4e86\u3057\u306a\u3044\u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u6ce8\u610f\u3002\n\n## \u6982\u8981\n\nWindows API\u3092\u5229\u7528\u3057\u305f\u30d1\u30a4\u30d7\u51e6\u7406\u3092ExcelVBA\u3067\u5b9f\u88c5\u3057\u3066\u307f\u305f\u306e\u3067\u307e\u3068\u3081\u3066\u304a\u304f\u3002\u30d1\u30a4\u30d7\u51e6\u7406\u306e\u984c\u6750\u306f\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u72487Zip\u3092\u5229\u7528\u3057\u305ftar-gz\u5f62\u5f0f\u3067\u306e\u5727\u7e2e\u3067\u3042\u308b\u3002\n\n7Zip\u3067tar-gz\u5f62\u5f0f\u306e\u5727\u7e2e\u3092\u884c\u3046\u5834\u5408\u306f\u4e00\u5ea6tar\u5f62\u5f0f\u306b\u3057\u305f\u3042\u3068gzip\u3067\u5727\u7e2e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u304c\u3001\u4e00\u5ea6tar\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u305f\u5f8cgzip\u5727\u7e2e\u3059\u308b\u3068gzip\u30d5\u30a1\u30a4\u30eb\u306btar\u30d5\u30a1\u30a4\u30eb\u306e\u60c5\u5831\u304c\u683c\u7d0d\u3055\u308c\u3066\u30c0\u30b5\u3044\u30027Zip\u306b\u306f\u6a19\u6e96\u51fa\u529b\u306b\u5727\u7e2e\u30c7\u30fc\u30bf\u3092\u5410\u304d\u51fa\u3057\u305f\u308a\u6a19\u6e96\u5165\u529b\u306e\u30c7\u30fc\u30bf\u3092\u5727\u7e2e\u3059\u308b\u6a5f\u80fd\u304c\u3042\u308b\u306e\u3067\u3001\u3053\u308c\u3068\u30d1\u30a4\u30d7\u3092\u7d44\u307f\u5408\u308f\u305b\u3066tar\u30d5\u30a1\u30a4\u30eb\u60c5\u5831\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u306a\u3044tar-gz\u5f62\u5f0f\u306e\u5727\u7e2e\u3092\u884c\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n\u306a\u304a\u3001ExcelVBA\u3092\u4f7f\u3063\u305f\u306e\u306f\u958b\u767a\u74b0\u5883\u3092\u7528\u610f\u3067\u304d\u306a\u304b\u3063\u305f\u3060\u3051\u3067ExcelVBA\u3067\u3042\u308b\u7406\u7531\u306f\u5168\u304f\u306a\u3044\u3002\n\n## Windows API\u306e\u5ba3\u8a00\u306b\u3064\u3044\u3066\n\nExcelVBA\u3067\u30d1\u30a4\u30d7\u51e6\u7406\u3092\u884c\u3046\u306b\u306fWindows API\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u306b\u306a\u308b\u304c\u3001Windows API\u3092\u5229\u7528\u3059\u308b\u306b\u306f\u4f7f\u7528\u3059\u308b\u95a2\u6570\u3084\u69cb\u9020\u4f53\u3001\u5b9a\u6570\u3092\u5ba3\u8a00\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002MSDN\u30e9\u30a4\u30d6\u30e9\u30ea\u306eC/C++\u7528\u306e\u95a2\u6570\u5b9a\u7fa9\u3092\u53c2\u7167\u3057\u3066VBA\u7528\u306b\u66f8\u304d\u63db\u3048\u3066\u3044\u304f\u3053\u3068\u306b\u306a\u308b\u304c\u3001\u3053\u308c\u304c\u7d50\u69cb\u5927\u5909\u3002\u5b9f\u306fMicrosoft\u304cVB/VBA\u7528\u306e\u95a2\u6570\u5b9a\u7fa9\u3092\u516c\u958b\u3057\u3066\u304f\u308c\u3066\u3044\u308b\u306e\u3067\u3053\u308c\u3092\u5229\u7528\u3059\u308b\u3068\u7c21\u5358\u3002\n\nx86\u7248\n[Visual Basic Win32 API Declarations](https://www.microsoft.com/en-us/download/details.aspx?id=12427)\n\nx64\u7248\n[Office 2010 Help Files: Win32API_PtrSafe with 64-bit Support](https://www.microsoft.com/en-us/download/details.aspx?id=9970)\n\n## \u30b3\u30fc\u30c9\n\nx64\u7248Excel\u7528\u306e\u30b3\u30fc\u30c9\u3060\u304c\u3001PtrSafe\u3092\u524a\u9664\u3057\u3066LongPtr\u3092Long\u306b\u4fee\u6b63\u3059\u308c\u3070x86\u7248\u3067\u3082\u52d5\u304f\u306f\u305a\u3002\n\n```vbnet:\u6a19\u6e96\u30e2\u30b8\u30e5\u30fc\u30eb\nOption Explicit\n\nPrivate Declare PtrSafe Sub ZeroMemory Lib \"kernel32\" Alias \"RtlZeroMemory\" ( _\n    ByRef dest As Any, _\n    ByVal numBytes As LongPtr)\n\nPrivate Declare PtrSafe Function CreatePipe Lib \"kernel32\" ( _\n    ByRef phReadPipe As LongPtr, _\n    ByRef phWritePipe As LongPtr, _\n    ByRef lpPipeAttributes As SECURITY_ATTRIBUTES, _\n    ByVal nSize As Long) As Long\n\nPrivate Declare PtrSafe Function SetHandleInformation Lib \"kernel32\" ( _\n    ByVal hObject As LongPtr, _\n    ByVal dwMask As Long, _\n    ByVal dwFlags As Long) As Long\n\nPrivate Declare PtrSafe Function CreateProcess Lib \"kernel32\" Alias \"CreateProcessA\" ( _\n    ByVal lpApplicationName As String, _\n    ByVal lpCommandLine As String, _\n    ByRef lpProcessAttributes As SECURITY_ATTRIBUTES, _\n    ByRef lpThreadAttributes As SECURITY_ATTRIBUTES, _\n    ByVal bInheritHandles As Long, _\n    ByVal dwCreationFlags As Long, _\n    ByRef lpEnvironment As Any, _\n    ByVal lpCurrentDriectory As String, _\n    ByRef lpStartupInfo As STARTUPINFO, _\n    ByRef lpProcessInformation As PROCESS_INFORMATION) As Long\n\nPrivate Declare PtrSafe Function GetStdHandle Lib \"kernel32\" ( _\n    ByVal nStdHandle As Long) As LongPtr\n\nPrivate Declare PtrSafe Function PeekNamedPipe Lib \"kernel32\" ( _\n    ByVal hNamedPipe As LongPtr, _\n    ByRef lpBuffer As Any, _\n    ByVal nBufferSize As Long, _\n    ByRef lpBytesRead As Long, _\n    ByRef lpTotalBytesAvail As Long, _\n    ByRef lpBytesLeftThisMessage As Long) As Long\n\nPrivate Declare PtrSafe Function ReadFile Lib \"kernel32\" ( _\n    ByVal hFile As LongPtr, _\n    ByRef lpBuffer As Any, _\n    ByVal nNumberOfBytesToRead As Long, _\n    ByRef lpNumberOfBytesRead As Long, _\n    ByRef lpOverlapped As OVERLAPPED) As Long\n\nPrivate Declare PtrSafe Function WriteFile Lib \"kernel32\" ( _\n    ByVal hFile As LongPtr, _\n    ByRef lpBuffer As Any, _\n    ByVal nNumberOfBytesToWrite As Long, _\n    ByRef lpNumberOfBytesWritten As Long, _\n    ByRef lpOverlapped As OVERLAPPED) As Long\n\nPrivate Declare PtrSafe Function GetExitCodeProcess Lib \"kernel32\" ( _\n    ByVal hProcess As LongPtr, _\n    ByRef lpExitCode As Long) As Long\n\nPrivate Declare PtrSafe Function CloseHandle Lib \"kernel32\" ( _\n    ByVal hObject As LongPtr) As Long\n\nPrivate Type SECURITY_ATTRIBUTES\n    nLength As Long\n    lpSecurityDescriptor As LongPtr\n    bInheritHandle As Long\nEnd Type\n\nPrivate Type STARTUPINFO\n    cb As Long\n    lpReserved As String\n    lpDesktop As String\n    lpTitle As String\n    dwX As Long\n    dwY As Long\n    dwXSize As Long\n    dwYSize As Long\n    dwXCountChars As Long\n    dwYCountChars As Long\n    dwFillAttribute As Long\n    dwFlags As Long\n    wShowWindow As Integer\n    cbReserved2 As Integer\n    lpReserved2 As LongPtr\n    hStdInput As LongPtr\n    hStdOutput As LongPtr\n    hStdError As LongPtr\nEnd Type\n\nPrivate Type PROCESS_INFORMATION\n    hProcess As LongPtr\n    hThread As LongPtr\n    dwProcessId As Long\n    dwThreadId As Long\nEnd Type\n\nPrivate Type OVERLAPPED\n    Internal As LongPtr\n    InternalHigh As LongPtr\n    offset As Long\n    OffsetHigh As Long\n    hEvent As LongPtr\nEnd Type\n\nPrivate Const HANDLE_FLAG_INHERIT = &H1\n\nPrivate Const STD_INPUT_HANDLE = -10&\nPrivate Const STD_OUTPUT_HANDLE = -11&\nPrivate Const STD_ERROR_HANDLE = -12&\n\nPrivate Const STARTF_USESHOWWINDOW = &H1\nPrivate Const STARTF_USESTDHANDLES = &H100\nPrivate Const SW_HIDE = 0\n\nPrivate Const STILL_ACTIVE = &H103\n\n'TAR-GZ\u5f62\u5f0f\u3067\u5727\u7e2e\u3059\u308b\n'7Zip\u3092\u5229\u7528\u3001TAR\u5f62\u5f0f\u3067\u5727\u7e2e\u3057\u305f\u7d50\u679c\u3092\u6a19\u6e96\u5165\u529b\u304b\u3089\u53d7\u3051\u53d6\u3063\u3066GZIP\u5727\u7e2e\u3059\u308b\u3053\u3068\u3067TAR-GZ\u5f62\u5f0f\u3067\u5727\u7e2e\u3059\u308b\n'\u30b3\u30de\u30f3\u30c9: 7z a dummy -ttar -so \"\u5727\u7e2e\u5bfe\u8c61\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\" | 7z a \"\u5727\u7e2e\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\" -tgzip -si\nPublic Function makeTarGz() As Boolean\n\n    Const SEVEN_ZIP_PATH As String = \"C:\\Users\\shela\\Desktop\\7z\\7z.exe\" '7Zip\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\n    Const TARGET_PATH As String = \"C:\\Users\\shela\\Desktop\\7z\\History.txt\"    '\u5727\u7e2e\u5bfe\u8c61\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\n    Const TGZ_PATH As String = \"C:\\Users\\shela\\Desktop\\7z\\History.tgz\"   '\u5727\u7e2e\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\n    Const BUFSIZE As Integer = 1024 '\u30d0\u30c3\u30d5\u30a1\u30b5\u30a4\u30ba\n\n    Dim sa As SECURITY_ATTRIBUTES\n    Dim hInRead As LongPtr\n    Dim hInWrite As LongPtr\n    Dim hOutRead As LongPtr\n    Dim hOutWrite As LongPtr\n    \n    Dim pi1 As PROCESS_INFORMATION\n    Dim pi2 As PROCESS_INFORMATION\n    Dim si1 As STARTUPINFO\n    Dim si2 As STARTUPINFO\n    Dim saAttr As SECURITY_ATTRIBUTES\n    Dim commandLine1 As String\n    Dim commandLine2 As String\n\n    Dim dwRead As Long\n    Dim dwWritten As Long\n    Dim buffer(BUFSIZE - 1) As Byte\n    Dim ov1 As OVERLAPPED\n    Dim ov2 As OVERLAPPED\n    Dim exitCode1 As Long\n    Dim exitCode2 As Long\n    \n    Call ZeroMemory(sa, Len(sa))\n    sa.nLength = Len(sa)\n    sa.bInheritHandle = 1&\n    sa.lpSecurityDescriptor = 0&\n\n    '\u51fa\u529b\u5074\u30d1\u30a4\u30d7\u306e\u4f5c\u6210\n    If CreatePipe(hOutRead, hOutWrite, sa, 0) = 0 Then\n        MsgBox \"\u30d1\u30a4\u30d7\u306e\u4f5c\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9:\" & Err.LastDllError, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n        GoTo Error\n    End If\n\n    '\u51fa\u529b\u5074\u8aad\u307f\u8fbc\u307f\u30cf\u30f3\u30c9\u30eb\u3092\u5b50\u30d7\u30ed\u30bb\u30b9\u306b\u7d99\u627f\u3067\u304d\u306a\u304f\u3059\u308b\n    If SetHandleInformation(hOutRead, HANDLE_FLAG_INHERIT, 0) = 0 Then\n        MsgBox \"\u51fa\u529b\u5074\u8aad\u307f\u8fbc\u307f\u30cf\u30f3\u30c9\u30eb\u306e\u7d99\u627f\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9:\" & Err.LastDllError, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n        GoTo Error\n    End If\n\n    '\u5165\u529b\u5074\u30d1\u30a4\u30d7\u306e\u4f5c\u6210\n    If CreatePipe(hInRead, hInWrite, sa, 0) = 0 Then\n        MsgBox \"\u30d1\u30a4\u30d7\u306e\u4f5c\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9:\" & Err.LastDllError, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n        GoTo Error\n    End If\n\n    '\u5165\u529b\u5074\u66f8\u304d\u8fbc\u307f\u30cf\u30f3\u30c9\u30eb\u3092\u5b50\u30d7\u30ed\u30bb\u30b9\u306b\u7d99\u627f\u3067\u304d\u306a\u304f\u3059\u308b\n    If SetHandleInformation(hInWrite, HANDLE_FLAG_INHERIT, 0) = 0 Then\n        MsgBox \"\u5165\u529b\u5074\u66f8\u304d\u8fbc\u307f\u30cf\u30f3\u30c9\u30eb\u306e\u7d99\u627f\u8a2d\u5b9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9:\" & Err.LastDllError, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n        GoTo Error\n    End If\n\n    '\u30b3\u30de\u30f3\u30c9\u751f\u6210\n    'TAR\u5727\u7e2e->\u6a19\u6e96\u51fa\u529b\n    commandLine1 = \"\"\"\" & SEVEN_ZIP_PATH & \"\"\" a dummy -ttar -so \"\"\" & TARGET_PATH & \"\"\"\"\n    '\u6a19\u6e96\u5165\u529b->GZIP\u5727\u7e2e\n    commandLine2 = \"\"\"\" & SEVEN_ZIP_PATH & \"\"\" a \"\"\" & TGZ_PATH & \"\"\" -tgzip -si\"\n    \n    Call ZeroMemory(si1, Len(si1))\n    si1.cb = Len(si1)\n    si1.hStdInput = GetStdHandle(STD_INPUT_HANDLE)\n    si1.hStdOutput = hOutWrite\n    si1.hStdError = GetStdHandle(STD_ERROR_HANDLE)\n    si1.dwFlags = STARTF_USESTDHANDLES Or STARTF_USESHOWWINDOW\n    si1.wShowWindow = SW_HIDE\n\n    Call ZeroMemory(si2, Len(si2))\n    si2.cb = Len(si2)\n    si2.hStdInput = hInRead\n    si2.hStdOutput = GetStdHandle(STD_OUTPUT_HANDLE)\n    si2.hStdError = GetStdHandle(STD_ERROR_HANDLE)\n    si2.dwFlags = STARTF_USESTDHANDLES Or STARTF_USESHOWWINDOW\n    si2.wShowWindow = SW_HIDE\n\n    '\u30d7\u30ed\u30bb\u30b9\u751f\u6210(TAR\u5727\u7e2e)\n    If CreateProcess(vbNullString, commandLine1, saAttr, saAttr, 1&, 0&, 0&, vbNullString, si1, pi1) = 0 Then\n        MsgBox \"\u30d7\u30ed\u30bb\u30b9\u751f\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9:\" & Err.LastDllError, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n        GoTo Error\n    End If\n    \n    Call CloseHandle(pi1.hThread)\n    \n    '\u30d7\u30ed\u30bb\u30b9\u751f\u6210(GZIP\u5727\u7e2e)\n    If CreateProcess(vbNullString, commandLine2, saAttr, saAttr, 1&, 0&, 0&, vbNullString, si2, pi2) = 0 Then\n        MsgBox \"\u30d7\u30ed\u30bb\u30b9\u751f\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9:\" & Err.LastDllError, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n        GoTo Error\n    End If\n    \n    Call CloseHandle(pi2.hThread)\n\n    Do While True\n        '\u7d42\u4e86\u30b9\u30c6\u30fc\u30bf\u30b9\u30b3\u30fc\u30c9\u306e\u53d6\u5f97\n        If GetExitCodeProcess(pi1.hProcess, exitCode1) = 0 Then\n            MsgBox \"\u7d42\u4e86\u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9:\" & Err.LastDllError, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n            GoTo Error\n        End If\n        \n        If GetExitCodeProcess(pi2.hProcess, exitCode2) = 0 Then\n            MsgBox \"\u7d42\u4e86\u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9:\" & Err.LastDllError, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n            GoTo Error\n        End If\n        \n        '\u51fa\u529b\u5074\u30d1\u30a4\u30d7\u304b\u3089\u30c7\u30fc\u30bf\u304c\u8aad\u3081\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n        If PeekNamedPipe(hOutRead, 0&, 0, 0&, dwRead, ByVal 0) = 0 Then\n            MsgBox \"\u30d1\u30a4\u30d7\u304b\u3089\u30c7\u30fc\u30bf\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9:\" & Err.LastDllError, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n            GoTo Error\n        End If\n        \n        If dwRead > 0 Then\n            Erase buffer\n            '\u51fa\u529b\u5074\u30d1\u30a4\u30d7\u304b\u3089\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u53d6\u308b\n            If ReadFile(hOutRead, buffer(0), UBound(buffer) + 1, dwRead, ov1) = 0 Then\n                Exit Do\n            End If\n        \n            '\u8aad\u307f\u53d6\u3063\u305f\u30c7\u30fc\u30bf\u3092\u5165\u529b\u5074\u30d1\u30a4\u30d7\u306b\u66f8\u304d\u8fbc\u3080\n            If WriteFile(hInWrite, buffer(0), dwRead, dwWritten, ov2) = 0 Then\n                Exit Do\n            End If\n        Else\n            If exitCode1 <> STILL_ACTIVE Or exitCode2 <> STILL_ACTIVE Then\n                Exit Do\n            End If\n        End If\n\n        DoEvents\n    Loop\n    \n    Call CloseHandle(pi1.hProcess)\n    Call CloseHandle(hOutWrite)\n    Call CloseHandle(hOutRead)\n    \n    '\u7d42\u4e86\u30b3\u30fc\u30c9\u30c1\u30a7\u30c3\u30af\n    If exitCode1 <> 0 And exitCode1 <> STILL_ACTIVE Then\n        MsgBox \"\u7570\u5e38\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002\u7d42\u4e86\u30b3\u30fc\u30c9:\" & exitCode1, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n        GoTo Error\n    ElseIf exitCode2 <> 0 And exitCode2 <> STILL_ACTIVE Then\n        MsgBox \"\u7570\u5e38\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002\u7d42\u4e86\u30b3\u30fc\u30c9:\" & exitCode2, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n        GoTo Error\n    End If\n\n    '\u5165\u529b\u5074\u66f8\u304d\u8fbc\u307f\u30cf\u30f3\u30c9\u30eb\u3092\u9589\u3058\u308b\u3053\u3068\u3067\u30d7\u30ed\u30bb\u30b9(GZIP\u5727\u7e2e)\u306e\u8aad\u307f\u8fbc\u307f\u3092\u7d42\u4e86\u3055\u305b\u308b\n    Call CloseHandle(hInWrite)\n\n    '\u30d7\u30ed\u30bb\u30b9(GZIP\u5727\u7e2e)\u7d42\u4e86\u307e\u3067\u5f85\u6a5f\n    Do\n        If GetExitCodeProcess(pi2.hProcess, exitCode2) = 0 Then\n            MsgBox \"\u7d42\u4e86\u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9:\" & Err.LastDllError, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n            GoTo Error\n        End If\n        DoEvents\n    Loop While exitCode2 = STILL_ACTIVE\n    \n    Call CloseHandle(pi2.hProcess)\n    Call CloseHandle(hInRead)\n    \n    '\u30d7\u30ed\u30bb\u30b9(GZIP\u5727\u7e2e)\u306e\u7d42\u4e86\u30b3\u30fc\u30c9\u30c1\u30a7\u30c3\u30af\n    If exitCode2 <> 0 Then\n        MsgBox \"\u7570\u5e38\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002\u7d42\u4e86\u30b3\u30fc\u30c9:\" & exitCode2, Buttons:=vbCritical, Title:=\"\u30a8\u30e9\u30fc\"\n        GoTo Error\n    End If\n\n    MsgBox \"\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002\", Buttons:=vbInformation, Title:=\"\u5b8c\u4e86\"\n    makeTarGz = True\n    Exit Function\n\n'\u30a8\u30e9\u30fc\u51e6\u7406\nError:\n    makeTarGz = False\n    \n    Call CloseHandle(pi1.hThread)\n    Call CloseHandle(pi1.hProcess)\n    Call CloseHandle(pi2.hThread)\n    Call CloseHandle(pi2.hProcess)\n    Call CloseHandle(hOutWrite)\n    Call CloseHandle(hOutRead)\n    Call CloseHandle(hInRead)\n    Call CloseHandle(hInWrite)\nEnd Function\n```\n\n## \u6ce8\u610f\u70b9\u306a\u3069\n\n#### \u30d1\u30a4\u30d7\u306e\u8aad\u307f\u66f8\u304d\n\nReadFile\u95a2\u6570\u3067\u30d1\u30a4\u30d7\u304b\u3089\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u3080\u5834\u5408\u3001\u4ed6\u306e\u30d7\u30ed\u30bb\u30b9\u304b\u3089\u30d1\u30a4\u30d7\u306b\u30c7\u30fc\u30bf\u304c\u66f8\u304d\u8fbc\u307e\u308c\u308b\u307e\u3067\u51e6\u7406\u3092\u30d6\u30ed\u30c3\u30af\u3059\u308b\u3002WriteFile\u95a2\u6570\u3067\u30d1\u30a4\u30d7\u306b\u30c7\u30fc\u30bf\u3092\u66f8\u304d\u8fbc\u3080\u5834\u5408\u3001\u30d1\u30a4\u30d7\u306e\u30d0\u30c3\u30d5\u30a1\u304c\u3044\u3063\u3071\u3044\u306b\u306a\u308b\u3068ReadFile\u95a2\u6570\u306a\u3069\u3067\u30d1\u30a4\u30d7\u304b\u3089\u30c7\u30fc\u30bf\u304c\u8aad\u307f\u51fa\u3055\u308c\u3066\u30d0\u30c3\u30d5\u30a1\u304c\u30af\u30ea\u30a2\u3055\u308c\u306a\u3044\u9650\u308a\u6b8b\u308a\u306e\u30c7\u30fc\u30bf\u3092\u66f8\u304d\u8fbc\u3081\u305a\u51e6\u7406\u3092\u30d6\u30ed\u30c3\u30af\u3059\u308b\u3002\n\n[Anonymous Pipe Operations](https://msdn.microsoft.com/ja-jp/library/windows/desktop/aa365141%28v=vs.85%29.aspx)\n\n\u4e0a\u8a18\u30b3\u30fc\u30c9\u306e\u3088\u3046\u306b\u81ea\u5206\u3067\u30d1\u30a4\u30d7\u306e\u8aad\u307f\u66f8\u304d\u3092\u5236\u5fa1\u3059\u308b\u5834\u5408\u3001\u6307\u5b9a\u3059\u308b\u30d0\u30c3\u30d5\u30a1\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3059\u304e\u305f\u308a\u51e6\u7406\u306e\u6d41\u308c\u3092\u9593\u9055\u3048\u3066\u5b9f\u88c5\u3059\u308b\u3060\u3051\u3067\u7c21\u5358\u306b\u505c\u6b62\u3057\u306a\u3044\u30d7\u30ed\u30b0\u30e9\u30e0\u304c\u3067\u304d\u3066\u3057\u307e\u3046\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u3002\n\n7Zip\u3067\u306f-ao(Overwrite mode)\u30b9\u30a4\u30c3\u30c1\u3092\u3064\u3051\u306a\u3044\u9650\u308a\u6307\u5b9a\u3057\u305f\u5727\u7e2e\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3059\u308b\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308b\u304c\u3001(7Zip\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u78ba\u8a8d\u3057\u305f\u308f\u3051\u3067\u306f\u306a\u3044\u304c)\u3053\u306e\u30c1\u30a7\u30c3\u30af\u306f\u30d1\u30a4\u30d7\u304b\u3089\u30c7\u30fc\u30bf\u304c\u8aad\u307f\u51fa\u3055\u308c\u305f\u5f8c\u3067\u884c\u308f\u308c\u308b\u3088\u3046\u3067\u3001WriteFile\u95a2\u6570\u3067\u66f8\u304d\u8fbc\u3082\u3046\u3068\u3057\u3066\u3044\u308b\u30c7\u30fc\u30bf\u30b5\u30a4\u30ba\u304c\u30d1\u30a4\u30d7\u306e\u30d0\u30c3\u30d5\u30a1\u30b5\u30a4\u30ba\u3092\u8d85\u3048\u3066\u3044\u30667Zip\u5074\u306e\u8aad\u307f\u51fa\u3057\u30b5\u30a4\u30ba\u304cWriteFile\u95a2\u6570\u3067\u66f8\u304d\u8fbc\u3082\u3046\u3068\u3057\u3066\u3044\u308b\u30c7\u30fc\u30bf\u30b5\u30a4\u30ba\u3088\u308a\u5c0f\u3055\u3044\u5834\u5408\u3001WriteFile\u95a2\u6570\u306e\u3068\u3053\u308d\u3067\u51e6\u7406\u304c\u6b62\u307e\u3063\u3066\u3057\u307e\u3063\u3066\u30d7\u30ed\u30bb\u30b9\u306e\u7d42\u4e86\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u53c2\u7167\u3057\u3088\u3046\u306b\u3082\u3067\u304d\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u3002\n\u3053\u306e\u5834\u5408\u306f\u3001WriteFile\u95a2\u6570\u3067\u66f8\u304d\u8fbc\u3082\u3046\u3068\u3057\u3066\u3044\u308b\u30c7\u30fc\u30bf\u30b5\u30a4\u30ba\u3092\u5c0f\u3055\u304f\u3059\u308b\u304b\u3001\u30d1\u30a4\u30d7\u306e\u30d0\u30c3\u30d5\u30a1\u30b5\u30a4\u30ba\u3092\u5927\u304d\u304f\u3059\u308b\u3053\u3068\u3067\u56de\u907f\u3067\u304d\u308b\u3002\n\n#### PeekNamedPipe\u95a2\u6570\n\n\u533f\u540d\u30d1\u30a4\u30d7\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u306e\u306b\u306a\u305cNamed\uff1f\u3068\u5c11\u3057\u6c17\u306b\u306a\u308b\u304c\u3001PeekNamedPipe\u95a2\u6570\u306f\u30d1\u30a4\u30d7\u5185\u306b\u30c7\u30fc\u30bf\u304c\u5b58\u5728\u3057\u3066\u3044\u306a\u3044\u5834\u5408\u3067\u3082\u5373\u5ea7\u306b\u5fdc\u7b54\u3092\u8fd4\u3057\u30d1\u30a4\u30d7\u304b\u3089\u8aad\u307f\u53d6\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u7dcf\u30d0\u30a4\u30c8\u6570\u3092\u53d6\u5f97\u3067\u304d\u308b\u306e\u3067\u3001ReadFile\u95a2\u6570\u3067\u30c7\u30fc\u30bf\u3092\u8aad\u3080\u524d\u306e\u30c1\u30a7\u30c3\u30af\u3092\u884c\u3063\u3066\u3044\u308b\u3002\n\n#### \u30d1\u30a4\u30d7\u306e\u30c7\u30fc\u30bf\u306e\u7d42\u7aef\n\n\u30d1\u30a4\u30d7\u306b\u66f8\u304d\u8fbc\u3080\u30c7\u30fc\u30bf\u306f\u30d0\u30c3\u30d5\u30a1\u30b5\u30a4\u30ba\u3092\u8d85\u3048\u306a\u3051\u308c\u3070\u4f55\u56de\u306b\u5206\u3051\u3066\u66f8\u304d\u8fbc\u3093\u3067\u3082\u554f\u984c\u306a\u3044\u306e\u3067\u3001\u5b50\u30d7\u30ed\u30bb\u30b9\u304c\u30d1\u30a4\u30d7\u304b\u3089\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u51fa\u3059\u5834\u5408\u3069\u3053\u307e\u3067(\u4f55\u56de)\u8aad\u3081\u3070\u30c7\u30fc\u30bf\u306e\u7d42\u7aef\u306b\u306a\u308b\u304b\u3042\u3089\u304b\u3058\u3081\u77e5\u308b\u3053\u3068\u306f\u3067\u304d\u306a\u3044\u3002\u30c7\u30fc\u30bf\u306e\u7d42\u7aef\u304c\u5206\u304b\u3089\u306a\u3051\u308c\u3070ReadFile\u95a2\u6570\u306f\u8aad\u307f\u51fa\u3057\u30d0\u30c3\u30d5\u30a1\u304c\u3044\u3063\u3071\u3044\u306b\u306a\u308b\u307e\u3067\u5ef6\u3005\u3068\u30c7\u30fc\u30bf\u3092\u5f85\u3061\u7d9a\u3051\u3066\u3057\u307e\u3046\u3002\u3053\u308c\u3067\u306f\u56f0\u308b\u306e\u3067\u3001CloseHandle\u95a2\u6570\u3092\u547c\u3093\u3067\u66f8\u304d\u8fbc\u307f\u5074\u30cf\u30f3\u30c9\u30eb\u3092\u30af\u30ed\u30fc\u30ba\u3059\u308b\u3053\u3068\u3067\u5b50\u30d7\u30ed\u30bb\u30b9\u304c\u30c7\u30fc\u30bf\u306e\u7d42\u7aef\u3092\u5206\u304b\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n\n#### \u30d1\u30a4\u30d7\u306e\u30cf\u30f3\u30c9\u30eb\u306e\u7d99\u627f\n\nCreatePipe\u95a2\u6570\u3067\u30d1\u30a4\u30d7\u3092\u4f5c\u6210\u3059\u308b\u969b\u3001SECURITY_ATTRIBUTES\u69cb\u9020\u4f53\u306ebInheritHandle\u30d5\u30a3\u30fc\u30eb\u30c9\u3067\u5b50\u30d7\u30ed\u30bb\u30b9\u306b\u30cf\u30f3\u30c9\u30eb\u3092\u7d99\u627f\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3067\u304d\u308b\u3002\u30cf\u30f3\u30c9\u30eb\u3092\u7d99\u627f\u3059\u308b\u3068\u5b50\u30d7\u30ed\u30bb\u30b9\u304b\u3089\u3082\u30d1\u30a4\u30d7\u3092\u64cd\u4f5c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\u305f\u3060\u3057\u3001\u66f8\u304d\u8fbc\u307f\u3068\u8aad\u307f\u8fbc\u307f\u306e\u4e21\u65b9\u306e\u30cf\u30f3\u30c9\u30eb\u3092\u7d99\u627f\u3055\u305b\u3066\u3057\u307e\u3046\u3068\u89aa\u30d7\u30ed\u30bb\u30b9\u304b\u3089\u66f8\u304d\u8fbc\u307f\u5074\u30cf\u30f3\u30c9\u30eb\u3092\u30af\u30ed\u30fc\u30ba\u3057\u3066\u3082\u30d1\u30a4\u30d7\u306e\u30c7\u30fc\u30bf\u306e\u7d42\u7aef\u304c\u5206\u304b\u3089\u306a\u304f\u306a\u308b(\u5b50\u30d7\u30ed\u30bb\u30b9\u5074\u304b\u3089\u306f\u307e\u3060\u66f8\u304d\u8fbc\u307f\u5074\u30cf\u30f3\u30c9\u30eb\u3092\u64cd\u4f5c\u3067\u304d\u308b\u305f\u3081)\u3068\u3044\u3063\u305f\u554f\u984c\u304c\u767a\u751f\u3059\u308b\u306e\u3067\u3001SetHandleInformation\u95a2\u6570\u3084DuplicateHandle\u95a2\u6570\u3092\u5229\u7528\u3057\u3066\u7247\u5074\u306e\u30cf\u30f3\u30c9\u30eb\u3060\u3051\u3092\u7d99\u627f\u3067\u304d\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n\u4e0a\u8a18\u30b3\u30fc\u30c9\u3067\u306f\u3001SECURITY_ATTRIBUTES\u69cb\u9020\u4f53\u3067\u3072\u3068\u307e\u305a\u8aad\u307f\u66f8\u304d\u4e21\u65b9\u306e\u30cf\u30f3\u30c9\u30eb\u3092\u7d99\u627f\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057SetHandleInformation\u95a2\u6570\u3067\u4e00\u65b9\u306e\u30cf\u30f3\u30c9\u30eb\u3092\u7d99\u627f\u3057\u306a\u3044\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u76f4\u3057\u3066\u3044\u308b\u304c\u3001SECURITY_ATTRIBUTES\u69cb\u9020\u4f53\u3067\u306f\u4e21\u65b9\u306e\u30cf\u30f3\u30c9\u30eb\u3092\u7d99\u627f\u3057\u306a\u3044\u3088\u3046\u306b\u8a2d\u5b9a\u3057SetHandleInformation\u95a2\u6570\u3067\u4e00\u65b9\u306e\u30cf\u30f3\u30c9\u30eb\u3092\u7d99\u627f\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u76f4\u3059\u3068\u3044\u3046\u3084\u308a\u65b9\u3067\u3082\u3088\u3044\u3002\n\n#### \u7d42\u4e86\u30b3\u30fc\u30c9\n\nGetExitCodeProcess\u95a2\u6570\u306e\u7b2c2\u5f15\u6570\u306e\u5024\u3067\u30d7\u30ed\u30bb\u30b9\u304c\u307e\u3060\u5b9f\u884c\u4e2d(STILL_ACTIVE)\u306a\u306e\u304b\u7d42\u4e86\u3057\u305f\u306e\u304b\u3092\u691c\u77e5\u3057\u3066\u3044\u308b\u304c\u3001\u5b9f\u884c\u3057\u3066\u3044\u308b\u30d7\u30ed\u30bb\u30b9\u304c\u30a8\u30e9\u30fc\u6642\u306bSTILL_ACTIVE\u3068\u540c\u3058\u5024(259)\u3092\u8fd4\u3059\u3088\u3046\u306a\u4f5c\u308a\u306b\u306a\u3063\u3066\u3044\u308b\u3068\u3001\u4e07\u4e00\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u306b\u7d42\u4e86\u3057\u306a\u3044\u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u6ce8\u610f\u3002\n"}