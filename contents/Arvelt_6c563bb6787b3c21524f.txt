{"context": "\u30bf\u30a4\u30c8\u30eb\u3067\u8a00\u3044\u305f\u3044\u3053\u3068\u3092\u3044\u3044\u307e\u3057\u305f\u3002\nancestor query\u3092\u4f7f\u3046\u3053\u3068\u306b\u3088\u308aStrongly consistent\u304c\u9069\u7528\u3055\u308c\u307e\u3059\u3002\nfrom google.appengine.ext import ndb\n\nclass Customer(ndb.Model):\n    name = ndb.StringProperty()\n\nclass Purchase(ndb.Model):\n   price = ndb.IntegerProperty()\n\ncustomer_entity = Customer(name='me', id='aaa@example.com')\npurchase1 = Purchase(parent=customer_entity.key, price=100)\npurchase2 = Purchase(parent=customer_entity.key, price=200)\npurchase1.put()\npurchase2.put()\nprint Purchase.query(ancestor=customer_entity.key).fetch()\n#[Purchase(key=Key('Customer', 'aaa@example.com', 'Purchase', 5414888608366592), price=200), Purchase(key=Key('Customer', 'aaa@example.com', 'Purchase', 5977838561787904), price=100)]\n\nkey = ndb.Key('user', 'bbb@example.com')\npurchase3 = Purchase(parent=key, price=100)\npurchase4 = Purchase(parent=key, price=200)\npurchase3.put()\npurchase4.put()\nprint Purchase.query(ancestor=key).fetch()\n#[Purchase(key=Key('user', 'bbb@example.com', 'Purchase', 4711201166589952), price=200), Purchase(key=Key('user', 'bbb@example.com', 'Purchase', 6540788515209216), price=100)]\n\n\n\n\u30bf\u30a4\u30c8\u30eb\u3067\u8a00\u3044\u305f\u3044\u3053\u3068\u3092\u3044\u3044\u307e\u3057\u305f\u3002\nancestor query\u3092\u4f7f\u3046\u3053\u3068\u306b\u3088\u308a[Strongly consistent](https://cloud.google.com/datastore/docs/concepts/structuring_for_strong_consistency)\u304c\u9069\u7528\u3055\u308c\u307e\u3059\u3002\n\n```python\nfrom google.appengine.ext import ndb\n\nclass Customer(ndb.Model):\n    name = ndb.StringProperty()\n\nclass Purchase(ndb.Model):\n   price = ndb.IntegerProperty()\n\ncustomer_entity = Customer(name='me', id='aaa@example.com')\npurchase1 = Purchase(parent=customer_entity.key, price=100)\npurchase2 = Purchase(parent=customer_entity.key, price=200)\npurchase1.put()\npurchase2.put()\nprint Purchase.query(ancestor=customer_entity.key).fetch()\n#[Purchase(key=Key('Customer', 'aaa@example.com', 'Purchase', 5414888608366592), price=200), Purchase(key=Key('Customer', 'aaa@example.com', 'Purchase', 5977838561787904), price=100)]\n\nkey = ndb.Key('user', 'bbb@example.com')\npurchase3 = Purchase(parent=key, price=100)\npurchase4 = Purchase(parent=key, price=200)\npurchase3.put()\npurchase4.put()\nprint Purchase.query(ancestor=key).fetch()\n#[Purchase(key=Key('user', 'bbb@example.com', 'Purchase', 4711201166589952), price=200), Purchase(key=Key('user', 'bbb@example.com', 'Purchase', 6540788515209216), price=100)]\n```\n", "tags": ["GAE", "Python"]}