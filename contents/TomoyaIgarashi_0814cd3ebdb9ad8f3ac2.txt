{"tags": ["Ruby", "Gem", "Rails", "HTTPAcceptLanguage"], "context": " More than 1 year has passed since last update.\n\n\u74b0\u5883\n\nshell\n$ gem -v\n2.1.11\n$ ruby -v\n2.0.0 (2013-06-27 patchlevel 247) [x86_64-linux]\n$ rails -v\nRails 3.2.15\n$ bundle -v\nBundler version 1.3.5\n\n\n\n\u5b9f\u88c5\n\nGemfile\n# \u5168\u3066\u306eGroup\u306b\u5c5e\u3059\u3088\u3046\u306b\u8ffd\u52a0\u3059\u308b\u3002\ngem 'http_accept_language'\n\n\n\nconfig/application.rb\n@@ -40,6 +40,10 @@ class Application < Rails::Application\n      # The default locale is :en and all translations from config/locales/*.rb,yml are auto loaded.\n      # config.i18n.load_path += Dir[Rails.root.join('my', 'locales', '*.{rb,yml}').to_s]\n      # config.i18n.default_locale = :de\n +    config.i18n.default_locale = :en\n +\n +    # see:http://batsov.com/articles/2012/09/12/setting-up-fallback-locale-s-in-rails-3/\n +    config.i18n.fallbacks = [:en]\n\n@@ -83,5 +87,20 @@ class Application < Rails::Application\n\n +    # Setting for http_accept_language\n +    class HTTPAcceptLanguageToI18nLocale\n +      def initialize(app)\n +        @app = app\n +      end\n +\n +      def call(env)\n +        I18n.locale = env.http_accept_language.compatible_language_from(I18n.available_locales)\n +        @app.call(env)\n +      end\n +    end\n +\n +    config.middleware.use HttpAcceptLanguage::Middleware\n +    config.middleware.use HTTPAcceptLanguageToI18nLocale\n\n\n\u203b LINE Number\u306f\u74b0\u5883\u306b\u3088\u308a\u7570\u306a\u308a\u307e\u3059\u3002\n\n\nconfig.i18n.fallbacks\u306bAccept-Language\u306b\u6709\u52b9\u3067\u306a\u3044\u30ed\u30b1\u30fc\u30eb\u60c5\u5831\u304c\u5165\u3063\u3066\u3044\u305f\u5834\u5408\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\ncompatible_language_from\u306f\u3001\u5f15\u6570\u306b\u6307\u5b9a\u3055\u308c\u305f\u30ed\u30b1\u30fc\u30eb\u306e\u4e2d\u304b\u3089HTTP_ACCEPT_LANGUAGE\u306b\u6307\u5b9a\u3055\u308c\u305f\u30ed\u30b1\u30fc\u30eb\u306b\u30de\u30c3\u30c1\u3057\u305f\u5024\u3092\u8fd4\u3059\u3002\n\nconfig.middleware.use HTTPAcceptLanguageToI18nLocale\u306e\u524d\u306bconfig.middleware.use HttpAcceptLanguage::Middleware\u3068\u8a18\u8ff0\u3059\u308b\u3053\u3068\u3002\u3053\u3046\u3059\u308b\u3053\u3068\u306b\u3088\u308a\u3001env\u306bhttp_accept_language\u304c\u8ffd\u52a0\u3055\u308c\u308b\u3002\n\n\n\u7d50\u679c\n\npry\n3.2.15@2.0.0 (main)> I18n.available_locales\n=> [\n    [ 0] :en,\n    [ 1] :\"en-gb\",\n    [ 2] :\"pt-br\",\n    [ 3] :\"en-us\",\n    [ 4] :\"en-bork\",\n    [ 5] :\"en-ind\",\n    [ 6] :fr,\n    [ 7] :nl,\n    [ 8] :pl,\n    [ 9] :\"en-au\",\n    [10] :\"en-ca\",\n    [11] :sk,\n    [12] :ja,\n    [13] :\"nb-no\",\n    [14] :es,\n    [15] :vi,\n    [16] :de,\n    [17] :\"de-ch\"\n]\n\n3.2.15@2.0.0 (main)> env.http_accept_language\n=> #<HttpAcceptLanguage::Parser:0x007f21062d2e58 @header=\"en\", @user_preferred_languages=[\"en\"]>\n3.2.15@2.0.0 (main)> I18n.locale\n=> :en\n\n3.2.15@2.0.0 (main)> env.http_accept_language\n=> #<HttpAcceptLanguage::Parser:0x007f210d45a990 @header=\"fr\", @user_preferred_languages=[\"fr\"]>\n3.2.15@2.0.0 (main)> I18n.locale\n=> :fr\n\n3.2.15@2.0.0 (main)> env.http_accept_language\n=> #<HttpAcceptLanguage::Parser:0x007f210e234a48 @header=\"it\", @user_preferred_languages=[\"it\"]>\n3.2.15@2.0.0 (main)> I18n.locale\n=> :en\n\n\n\n\n## \u74b0\u5883\n```sh:shell\n$ gem -v\n2.1.11\n$ ruby -v\n2.0.0 (2013-06-27 patchlevel 247) [x86_64-linux]\n$ rails -v\nRails 3.2.15\n$ bundle -v\nBundler version 1.3.5\n```\n\n## \u5b9f\u88c5\n```rb:Gemfile\n# \u5168\u3066\u306eGroup\u306b\u5c5e\u3059\u3088\u3046\u306b\u8ffd\u52a0\u3059\u308b\u3002\ngem 'http_accept_language'\n```\n\n```diff:config/application.rb\n@@ -40,6 +40,10 @@ class Application < Rails::Application\n      # The default locale is :en and all translations from config/locales/*.rb,yml are auto loaded.\n      # config.i18n.load_path += Dir[Rails.root.join('my', 'locales', '*.{rb,yml}').to_s]\n      # config.i18n.default_locale = :de\n +    config.i18n.default_locale = :en\n +\n +    # see:http://batsov.com/articles/2012/09/12/setting-up-fallback-locale-s-in-rails-3/\n +    config.i18n.fallbacks = [:en]\n\n@@ -83,5 +87,20 @@ class Application < Rails::Application\n  \n +    # Setting for http_accept_language\n +    class HTTPAcceptLanguageToI18nLocale\n +      def initialize(app)\n +        @app = app\n +      end\n +\n +      def call(env)\n +        I18n.locale = env.http_accept_language.compatible_language_from(I18n.available_locales)\n +        @app.call(env)\n +      end\n +    end\n +\n +    config.middleware.use HttpAcceptLanguage::Middleware\n +    config.middleware.use HTTPAcceptLanguageToI18nLocale\n```\n\u203b LINE Number\u306f\u74b0\u5883\u306b\u3088\u308a\u7570\u306a\u308a\u307e\u3059\u3002\n\n- ```config.i18n.fallbacks```\u306bAccept-Language\u306b\u6709\u52b9\u3067\u306a\u3044\u30ed\u30b1\u30fc\u30eb\u60c5\u5831\u304c\u5165\u3063\u3066\u3044\u305f\u5834\u5408\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n- ```compatible_language_from ```\u306f\u3001\u5f15\u6570\u306b\u6307\u5b9a\u3055\u308c\u305f\u30ed\u30b1\u30fc\u30eb\u306e\u4e2d\u304b\u3089HTTP_ACCEPT_LANGUAGE\u306b\u6307\u5b9a\u3055\u308c\u305f\u30ed\u30b1\u30fc\u30eb\u306b\u30de\u30c3\u30c1\u3057\u305f\u5024\u3092\u8fd4\u3059\u3002\n- ```config.middleware.use HTTPAcceptLanguageToI18nLocale```\u306e\u524d\u306b```config.middleware.use HttpAcceptLanguage::Middleware```\u3068\u8a18\u8ff0\u3059\u308b\u3053\u3068\u3002\u3053\u3046\u3059\u308b\u3053\u3068\u306b\u3088\u308a\u3001```env```\u306b```http_accept_language```\u304c\u8ffd\u52a0\u3055\u308c\u308b\u3002\n\n## \u7d50\u679c\n```rb:pry\n3.2.15@2.0.0 (main)> I18n.available_locales\n=> [\n    [ 0] :en,\n    [ 1] :\"en-gb\",\n    [ 2] :\"pt-br\",\n    [ 3] :\"en-us\",\n    [ 4] :\"en-bork\",\n    [ 5] :\"en-ind\",\n    [ 6] :fr,\n    [ 7] :nl,\n    [ 8] :pl,\n    [ 9] :\"en-au\",\n    [10] :\"en-ca\",\n    [11] :sk,\n    [12] :ja,\n    [13] :\"nb-no\",\n    [14] :es,\n    [15] :vi,\n    [16] :de,\n    [17] :\"de-ch\"\n]\n\n3.2.15@2.0.0 (main)> env.http_accept_language\n=> #<HttpAcceptLanguage::Parser:0x007f21062d2e58 @header=\"en\", @user_preferred_languages=[\"en\"]>\n3.2.15@2.0.0 (main)> I18n.locale\n=> :en\n\n3.2.15@2.0.0 (main)> env.http_accept_language\n=> #<HttpAcceptLanguage::Parser:0x007f210d45a990 @header=\"fr\", @user_preferred_languages=[\"fr\"]>\n3.2.15@2.0.0 (main)> I18n.locale\n=> :fr\n\n3.2.15@2.0.0 (main)> env.http_accept_language\n=> #<HttpAcceptLanguage::Parser:0x007f210e234a48 @header=\"it\", @user_preferred_languages=[\"it\"]>\n3.2.15@2.0.0 (main)> I18n.locale\n=> :en\n\n```\n"}