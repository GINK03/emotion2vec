{"context": " More than 1 year has passed since last update.Clojure \u306b\u306f Compojure \u3068\u3044\u3046 Rails \u3068\u304b Sinatra \u3092\u4f7f\u3063\u3066\u3044\u305f/\u4f7f\u3063\u305f\u3053\u3068\u304c\u3042\u308b\u4eba\u306b\u3068\u3063\u3066\u306f\u6bd4\u8f03\u7684\u99b4\u67d3\u307f\u3084\u3059\u3044 DSL \u3092\u63d0\u4f9b\u3057\u3066\u304f\u308c\u308b \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30e9\u30a4\u30d6\u30e9\u30ea \u304c\u5b58\u5728\u3057\u307e\u3059 1 \u3002\u3053\u308c\u306f\u6bd4\u8f03\u7684\u7c21\u5358\u306b\u5c0e\u5165\u51fa\u6765\u308b\u306e\u3068\u3001\u65e5\u672c\u8a9e\u306e\u66f8\u7c4d/\u60c5\u5831\u7b49\u3067\u3082 Compojure \u3070\u304b\u308a\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u304b\u306a\u308a\u306e\u4eba\u304c\u305d\u306e\u5b58\u5728\u3092\u77e5\u3063\u3066\u3044\u308b\u3053\u3068\u3067\u3057\u3087\u3046\u3002\n\u3055\u3066\u3001 Compojure \u60aa\u304f\u306a\u3044\u3068\u601d\u3046\u306e\u3067\u3059\u304c Web \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u308b\u4e0a\u3067\u304b\u306a\u308a\u3057\u3093\u3069\u3044\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002\u5177\u4f53\u7684\u306b\u306f Compojure \u3092\u4f7f\u3063\u3066 Web \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u66f8\u304f\u3068\u304d\u306b\u306f\u3001 HTML \u306e\u4e2d\u306b\u57cb\u3081\u8fbc\u3080 URI \u3092\u5168\u3066\u30cf\u30fc\u30c9\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3057\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002 Rails \u306a\u3069\u4ed6\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306b\u6163\u308c\u3066\u3044\u308b\u65b9\u306b\u3068\u3063\u3066\u306f\u60aa\u5922\u3067\u3059\u3088\u306d\u3002 wtf... \u3068\u601d\u308f\u305a\u53e3\u304b\u3089\u51fa\u3066\u304f\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u307e\u305f\u30de\u30af\u30ed\u3067\u8a18\u8ff0\u3059\u308b\u305f\u3081\u3001\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u4f55\u304b\u3057\u3089\u306e\u30c7\u30fc\u30bf\u304b\u3089\u751f\u6210\u3059\u308b\u306a\u3069\u3068\u3044\u3046\u3053\u3068\u3082\u96e3\u3057\u3044\u3067\u3059\u3002\n\u3068\u3044\u3046\u3068\u3053\u308d\u3067\u3082\u3046\u5c11\u3057\u4fbf\u5229\u306b\u4f7f\u3048\u308b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\nbidi\n\nhttps://github.com/juxt/bidi\n\n\u7c21\u5358\u306b\u8aac\u660e\u3059\u308b\u3068 Clojure \u754c\u9688\u3067\u306f\u6709\u540d\u306a JUXT \u3068\u3044\u3046\u4f1a\u793e\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001\u305d\u3053\u304c\u4f5c\u3063\u3066\u3044\u308b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002\n\u3053\u308c\u306e\u7279\u5fb4\u306f URI \u306e\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u3068\u5f62\u6210\u3060\u3051\u3092\u3061\u3083\u3093\u3068\u3084\u308b\u3088\u3046\u306b\u4f5c\u3089\u308c\u3066\u3044\u3066\u3001\u304b\u3064 Compojure \u306e\u3088\u3046\u306a DSL \u3092\u4f7f\u308f\u305a\u306b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u30c7\u30fc\u30bf\u3068\u3057\u3066\u5b9a\u7fa9\u51fa\u6765\u308b\u3053\u3068\u3067\u3059\u3002\u3055\u3089\u306b\u8a00\u3046\u3068\u5358\u7d14\u306a\u30c7\u30fc\u30bf\u306a\u306e\u3067\u3001 Reader Conditionals \u3092\u4f7f\u3048\u3070\u7c21\u5358\u306b ClojureScript \u3067\u3082\u540c\u3058\u30c7\u30fc\u30bf\u304c\u4f7f\u3048\u307e\u3059\u3057\u3001 bidi \u306f ClojureScript \u304b\u3089\u3082\u4f7f\u3048\u308b\u3088\u3046\u306b\u4f5c\u3089\u308c\u3066\u3044\u308b\u306e\u3067\u7c21\u5358\u306b\u30b5\u30fc\u30d0\u30fc/\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u4e21\u65b9\u304b\u3089\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u8208\u5473\u304c\u3042\u308b\u4eba\u306f bidi \u306e README \u3092\u3058\u3063\u304f\u308a\u8aad\u3093\u3067\u307f\u3066\u304f\u3060\u3055\u3044\u3002\u4eca\u56de\u306f\u5b9f\u969b\u306b bidi \u3092\u4f7f\u3063\u3066\u7c21\u5358\u306b Web \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7684\u306a\u3082\u306e\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n$ lein new bidi-test\n\n\u3055\u304f\u3063\u3068\u3072\u306a\u5f62\u3092\u4f5c\u6210\u3057\u3066 project.clj \u3092\u6b21\u306e\u3088\u3046\u306b\u4fee\u6b63\u3057\u307e\u3059\u3002\n(defproject bidi-test \"0.1.0-SNAPSHOT\"\n  :description \"FIXME: write description\"\n  :url \"http://example.com/FIXME\"\n  :license {:name \"Eclipse Public License\"\n            :url \"http://www.eclipse.org/legal/epl-v10.html\"}\n  :dependencies [[org.clojure/clojure \"1.7.0\"]\n                 [ring \"1.4.0\"]\n                 [bidi \"1.21.1\"] ;; \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30e9\u30a4\u30d6\u30e9\u30ea!!\n                 [hiccup \"1.0.5\"]])\n\nring \u3068 bidi \u305d\u308c\u304b\u3089 hiccup \u3092\u8db3\u3057\u307e\u3057\u305f\u3002 hiccup \u306f HTML \u3092\u5410\u304f DSL \u3092\u63d0\u4f9b\u3057\u3066\u304f\u308c\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059(\u3068\u306f\u3044\u3048 Clojure \u306e\u30d9\u30af\u30bf\u30fc\u30c7\u30fc\u30bf\u3092 HTML \u306b\u5909\u63db\u3059\u308b\u3068\u3044\u3046\u306e\u304c\u6b63\u3057\u3044\u3088\u3046\u306a\u6c17\u3082\u3057\u307e\u3059\u304c)\u3002\n\u307e\u305a\u306f\u672c\u984c\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u5b9a\u7fa9\u3057\u307e\u3057\u3087\u3046\u3002\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u51fa\u6765\u307e\u3059\u3002\n;; src/bidi_test/routes.clj\n(ns bidi-test.routes)\n\n(def main\n  [\"/\" {\"users\" :user-index\n        [\"users/\" [#\"\\d+\" :id]] :user-show}])\n\n\u7c21\u5358\u3067\u3059\u306d\u3002\u8a73\u3057\u3044\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u5b9a\u7fa9\u65b9\u6cd5\u7b49\u306f README \u306b\u8b72\u308b\u3068\u3057\u3066\u3001\u7c21\u5358\u306b\u8aac\u660e\u3059\u308b\u3068 URI \u304c \"/users\" \u3067\u3042\u308c\u3070 :user-index \u3092\u8fd4\u5374\u3057\u3001 \"/users/:id\" \u306a URI \u3067\u3042\u308c\u3070 :user-show \u3092\u8fd4\u5374\u3057\u307e\u3059\u3002\n\u5177\u4f53\u7684\u306b\u306f bidi \u3067\u3053\u3046\u3044\u3046\u98a8\u306b\u4f7f\u3048\u307e\u3059\u3002\nuser> (require '[bidi.bidi :as bidi])\nnil\nuser> (require '[bidi-test.routes :as routes])\nnil\nuser> (bidi/match-route routes/main \"/users\")\n{:handler :user-index}\nuser> (bidi/match-route routes/main \"/users/1\")\n{:route-params {:id \"1\"}, :handler :user-show}\nuser> (bidi/path-for routes/main :user-index)\n\"/users\"\nuser> (bidi/path-for routes/main :user-show :id 1)\n\"/users/1\"\n\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u5b9a\u7fa9\u65b9\u6cd5\u304c\u5206\u304b\u3063\u305f\u3068\u3053\u308d\u3067\u6b21\u306b\u9032\u307f\u307e\u3057\u3087\u3046\u3002\n;; src/bidi_test/core.clj\n(ns bidi-test.core\n  (:require [bidi.bidi :as bidi]\n            [bidi.ring :as br]\n            [bidi-test.handlers]\n            [bidi-test.routes :as routes]\n            [bidi-test.utils :refer [ring-handlers]]\n            [ring.adapter.jetty :as server]))\n\n(defonce server (atom nil))\n\n(defn match-handler [k]\n  (->> (ring-handlers)\n       (filter #(= (:ring-handler (meta %))\n                   k))\n       first))\n\n(extend-protocol br/Ring\n  clojure.lang.Keyword\n  (request [k req _]\n    (let [handler (match-handler k)]\n      (handler req))))\n\n(def app\n  (br/make-handler routes/main))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (server/run-jetty #'app {:port 3000 :join? false}))))\n\n(defn stop-server []\n  (when @server\n    (.stop @server)\n    (reset! server nil)))\n\n\u3088\u304f\u3042\u308b\u7d20\u6734\u306a\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5/\u505c\u6b62\u3059\u308b\u95a2\u6570\u3068\u5e7e\u3064\u304b\u898b\u6163\u308c\u306a\u3044\u3082\u306e\u304c\u3042\u308a\u307e\u3059\u306d\u3002\u3061\u3087\u3063\u3068\u8aac\u660e\u3057\u307e\u3057\u3087\u3046\u3002\n\u307e\u305a app \u306f Ring \u30cf\u30f3\u30c9\u30e9\u30fc\u3067\u3059\u3002 bidi.ring/make-handler \u95a2\u6570\u306b\u5148\u307b\u3069\u5b9a\u7fa9\u3057\u3066\u304a\u3044\u305f\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u5b9a\u7fa9\u3092\u6e21\u3059\u3053\u3068\u3067\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u306e URI \u306b\u30de\u30c3\u30c1\u3059\u308b\u30cf\u30f3\u30c9\u30e9\u30fc\u3092\u5b9f\u884c\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u4eca\u56de\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u5b9a\u7fa9\u3092\u3057\u305f\u969b\u306b URI \u306b\u5bfe\u3057\u3066\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u7d10\u4ed8\u3051\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\u306a\u306e\u3067\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u5143\u306b\u30cf\u30f3\u30c9\u30e9\u30fc\u95a2\u6570\u3092\u63a2\u3057\u3066\u547c\u3073\u51fa\u3059\u90e8\u5206\u3092\u5b9f\u88c5\u3057\u3066\u3084\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u308c\u304c extend-protocol br/Ring \u90e8\u5206\u3067\u3059\u306d\u3002\u3053\u3053\u3067 clojure.lang.Keyword \u3092\u62e1\u5f35\u3057\u3001 request \u95a2\u6570(\u3053\u308c\u306f make-handler \u5185\u90e8\u3067\u547c\u3073\u51fa\u3055\u308c\u308b\u95a2\u6570)\u304c\u547c\u3073\u51fa\u3055\u308c\u305f\u3068\u304d\u306b\u5bfe\u5fdc\u51fa\u6765\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002 match-handler \u95a2\u6570\u306f Ring \u30cf\u30f3\u30c9\u30e9\u30fc\u306e\u30ea\u30b9\u30c8\u304b\u3089\u30ad\u30fc\u30ef\u30fc\u30c9\u3068\u4e00\u81f4\u3059\u308b\u30e1\u30bf\u60c5\u5831\u3092\u6301\u3063\u305f\u95a2\u6570\u3092\u63a2\u3057\u307e\u3059\u3002 Ring \u30cf\u30f3\u30c9\u30e9\u30fc\u306e\u30ea\u30b9\u30c8\u3092\u8fd4\u3059\u95a2\u6570\u306e\u5b9a\u7fa9\u306f\u5225\u306e\u3068\u3053\u308d\u3067\u884c\u3063\u3066\u3044\u3066\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n;; src/bidi_test/utils.clj\n(ns bidi-test.utils)\n\n(defn ring-handler? [var]\n  (contains? (meta var) :ring-handler))\n\n(defn ring-handlers []\n  (->> (all-ns)\n       (mapcat ns-interns)\n       (map second)\n       (filter ring-handler?)))\n\n\u66f8\u3044\u3066\u3042\u308b\u901a\u308a\u3067\u3059\u304c\u3001\u5168\u3066\u306e\u30cd\u30fc\u30e0\u30b9\u30da\u30fc\u30b9\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b Var \u3092\u6301\u3063\u3066\u304d\u3066\u3001\u7279\u5b9a\u306e\u30e1\u30bf\u60c5\u5831\u3092\u4fdd\u6301\u3057\u3066\u3044\u308b\u304b\u3092\u898b\u3066\u3044\u307e\u3059\u3002\n\u6700\u5f8c\u306b\u5b9f\u969b\u306e\u30cf\u30f3\u30c9\u30e9\u30fc\u306e\u5b9a\u7fa9\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n;; src/bidi_test/handlers.clj\n(ns bidi-test.handlers\n  (:require [bidi.bidi :as bidi]\n            [bidi-test.routes :as routes]\n            [hiccup.core :as html]\n            [ring.util.response :as res]))\n\n(def users\n  [{:id 1 :name \"ayato_p\"}\n   {:id 2 :name \"alea12\"}\n   {:id 3 :name \"zer0_u\"}\n   {:id 4 :name \"gaaamii\"}\n   {:id 5 :name \"karur4n\"}])\n\n(defn ^{:ring-handler :user-index} user-index [req]\n  (-> [:div\n       [:ul\n        (for [{:keys [id name]} users]\n          [:li [:a {:href (bidi/path-for routes/main :user-show :id id)} name]])]]\n      html/html\n      res/response\n      (res/content-type \"text/html; charset=utf-8\")))\n\n(defn ^{:ring-handler :user-show} user-show [req]\n  (let [id (Long/parseLong (get-in req [:params :id]))\n        user (first (filter #(= id (:id %)) users))]\n    (-> [:h1 (:name user) \"!\"]\n        html/html\n        res/response\n        (res/content-type \"text/html; charset=utf-8\"))))\n\n^{:ring-handler :user-index} \u3068\u3044\u3046\u3088\u3046\u306a\u611f\u3058\u3067\u30e1\u30bf\u60c5\u5831\u3092\u304f\u3063\u3064\u3051\u3066\u3044\u307e\u3059\u3002\u52ff\u8ad6\u3053\u308c\u306f\u5197\u9577\u306a\u306e\u3067 Ring \u30cf\u30f3\u30c9\u30e9\u30fc\u3092\u5b9a\u7fa9\u3059\u308b\u305f\u3081\u306e\u30de\u30af\u30ed\u3092\u66f8\u3044\u3066\u3082\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u3057\u3066\u5b9f\u969b\u306b\u5148\u307b\u3069\u8aac\u660e\u3057\u305f\u3088\u3046\u306b (bidi/path-for routes/main :user-show :id id) \u3053\u306e\u3088\u3046\u306b\u95a2\u6570\u3092\u547c\u3073\u51fa\u3059\u3053\u3068\u3067\u5b9f\u969b\u306b\u5fc5\u8981\u3068\u306a\u308b URI \u3092\u5f97\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\u30cf\u30fc\u30c9\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3067 URI \u66f8\u3044\u3066 str \u3067\u7d50\u5408\u3068\u304b\u5acc\u3067\u3059\u3088\u306d :)\n\u5b9f\u969b\u306b\u3053\u306e\u30b3\u30fc\u30c9\u306f REPL \u4e0a\u3067 (require 'bidi-test.core) (bidi-test.core/start-server) \u3068\u3059\u308c\u3070\u52d5\u304d\u307e\u3059\u306e\u3067\u662f\u975e\u624b\u5143\u3067\u52d5\u304b\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u6700\u5f8c\u306b\n\u3060\u30fc\u3063\u3068\u66f8\u3044\u305f\u306e\u3067\u8aac\u660e\u304c\u624b\u629c\u304d\u3067\u5206\u304b\u308a\u96e3\u3044\u3068\u601d\u3044\u307e\u3059\u304c\u3001 Compojure \u4ee5\u5916\u306b\u3082\u30a4\u30ab\u3057\u305f\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u3042\u308b\u3093\u3060\u3088!!\u3068\u3044\u3046\u306e\u304c\u4f1d\u308f\u308c\u3070\u3044\u3044\u304b\u306a\u30fc\u3068\u601d\u3044\u307e\u3059\u3002\u307e\u305f\u4eca\u56de\u306f\u30cf\u30f3\u30c9\u30e9\u30fc\u95a2\u6570\u3092\u30e1\u30bf\u60c5\u5831\u304b\u3089\u63a2\u3057\u307e\u3057\u305f\u304c\u9069\u5f53\u306b\u30ad\u30fc\u30ef\u30fc\u30c9\u3068\u95a2\u6570\u3092\u7d10\u4ed8\u3051\u308b\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u3092\u4f5c\u3063\u3066\u3082\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u3042\u3001 Compojure \u306f Web \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u306f\u306a\u304f\u3066 \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30e9\u30a4\u30d6\u30e9\u30ea \u3067\u3059 2 \u3002\n\n\n\n\n\"Compojure is really just a routing library, not a framework.\"\u00a0\u21a9\n\n\nbidi \u306e README \u306b\u3082\u3042\u308a\u307e\u3059\u304c RouteOne \u3084 Pedestal \u306a\u3069\u3068\u3044\u3063\u305f\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u6ca2\u5c71\u5b58\u5728\u3059\u308b\u306e\u3067\u597d\u307f\u306e\u3082\u306e\u3092\u63a2\u3057\u3066\u307f\u3066\u3082\u3044\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u00a0\u21a9\n\n\n\nClojure \u306b\u306f Compojure \u3068\u3044\u3046 Rails \u3068\u304b Sinatra \u3092\u4f7f\u3063\u3066\u3044\u305f/\u4f7f\u3063\u305f\u3053\u3068\u304c\u3042\u308b\u4eba\u306b\u3068\u3063\u3066\u306f\u6bd4\u8f03\u7684\u99b4\u67d3\u307f\u3084\u3059\u3044 DSL \u3092\u63d0\u4f9b\u3057\u3066\u304f\u308c\u308b **\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30e9\u30a4\u30d6\u30e9\u30ea** \u304c\u5b58\u5728\u3057\u307e\u3059 [^1] \u3002\u3053\u308c\u306f\u6bd4\u8f03\u7684\u7c21\u5358\u306b\u5c0e\u5165\u51fa\u6765\u308b\u306e\u3068\u3001\u65e5\u672c\u8a9e\u306e\u66f8\u7c4d/\u60c5\u5831\u7b49\u3067\u3082 Compojure \u3070\u304b\u308a\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u304b\u306a\u308a\u306e\u4eba\u304c\u305d\u306e\u5b58\u5728\u3092\u77e5\u3063\u3066\u3044\u308b\u3053\u3068\u3067\u3057\u3087\u3046\u3002\n\n\u3055\u3066\u3001 Compojure \u60aa\u304f\u306a\u3044\u3068\u601d\u3046\u306e\u3067\u3059\u304c Web \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u308b\u4e0a\u3067\u304b\u306a\u308a\u3057\u3093\u3069\u3044\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002\u5177\u4f53\u7684\u306b\u306f Compojure \u3092\u4f7f\u3063\u3066 Web \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u66f8\u304f\u3068\u304d\u306b\u306f\u3001 HTML \u306e\u4e2d\u306b\u57cb\u3081\u8fbc\u3080 URI \u3092\u5168\u3066\u30cf\u30fc\u30c9\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3057\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002 Rails \u306a\u3069\u4ed6\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306b\u6163\u308c\u3066\u3044\u308b\u65b9\u306b\u3068\u3063\u3066\u306f\u60aa\u5922\u3067\u3059\u3088\u306d\u3002 wtf... \u3068\u601d\u308f\u305a\u53e3\u304b\u3089\u51fa\u3066\u304f\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u307e\u305f\u30de\u30af\u30ed\u3067\u8a18\u8ff0\u3059\u308b\u305f\u3081\u3001\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u4f55\u304b\u3057\u3089\u306e\u30c7\u30fc\u30bf\u304b\u3089\u751f\u6210\u3059\u308b\u306a\u3069\u3068\u3044\u3046\u3053\u3068\u3082\u96e3\u3057\u3044\u3067\u3059\u3002\n\n\u3068\u3044\u3046\u3068\u3053\u308d\u3067\u3082\u3046\u5c11\u3057\u4fbf\u5229\u306b\u4f7f\u3048\u308b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n## bidi\n\n* https://github.com/juxt/bidi\n\n\u7c21\u5358\u306b\u8aac\u660e\u3059\u308b\u3068 Clojure \u754c\u9688\u3067\u306f\u6709\u540d\u306a JUXT \u3068\u3044\u3046\u4f1a\u793e\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001\u305d\u3053\u304c\u4f5c\u3063\u3066\u3044\u308b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002\n\u3053\u308c\u306e\u7279\u5fb4\u306f URI \u306e\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u3068\u5f62\u6210\u3060\u3051\u3092\u3061\u3083\u3093\u3068\u3084\u308b\u3088\u3046\u306b\u4f5c\u3089\u308c\u3066\u3044\u3066\u3001\u304b\u3064 Compojure \u306e\u3088\u3046\u306a DSL \u3092\u4f7f\u308f\u305a\u306b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u30c7\u30fc\u30bf\u3068\u3057\u3066\u5b9a\u7fa9\u51fa\u6765\u308b\u3053\u3068\u3067\u3059\u3002\u3055\u3089\u306b\u8a00\u3046\u3068\u5358\u7d14\u306a\u30c7\u30fc\u30bf\u306a\u306e\u3067\u3001 Reader Conditionals \u3092\u4f7f\u3048\u3070\u7c21\u5358\u306b ClojureScript \u3067\u3082\u540c\u3058\u30c7\u30fc\u30bf\u304c\u4f7f\u3048\u307e\u3059\u3057\u3001 bidi \u306f ClojureScript \u304b\u3089\u3082\u4f7f\u3048\u308b\u3088\u3046\u306b\u4f5c\u3089\u308c\u3066\u3044\u308b\u306e\u3067\u7c21\u5358\u306b\u30b5\u30fc\u30d0\u30fc/\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u4e21\u65b9\u304b\u3089\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n\u8208\u5473\u304c\u3042\u308b\u4eba\u306f bidi \u306e README \u3092\u3058\u3063\u304f\u308a\u8aad\u3093\u3067\u307f\u3066\u304f\u3060\u3055\u3044\u3002\u4eca\u56de\u306f\u5b9f\u969b\u306b bidi \u3092\u4f7f\u3063\u3066\u7c21\u5358\u306b Web \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7684\u306a\u3082\u306e\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```clj\n$ lein new bidi-test\n```\n\n\u3055\u304f\u3063\u3068\u3072\u306a\u5f62\u3092\u4f5c\u6210\u3057\u3066 project.clj \u3092\u6b21\u306e\u3088\u3046\u306b\u4fee\u6b63\u3057\u307e\u3059\u3002\n\n```clj\n(defproject bidi-test \"0.1.0-SNAPSHOT\"\n  :description \"FIXME: write description\"\n  :url \"http://example.com/FIXME\"\n  :license {:name \"Eclipse Public License\"\n            :url \"http://www.eclipse.org/legal/epl-v10.html\"}\n  :dependencies [[org.clojure/clojure \"1.7.0\"]\n                 [ring \"1.4.0\"]\n                 [bidi \"1.21.1\"] ;; \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30e9\u30a4\u30d6\u30e9\u30ea!!\n                 [hiccup \"1.0.5\"]])\n```\n\nring \u3068 bidi \u305d\u308c\u304b\u3089 hiccup \u3092\u8db3\u3057\u307e\u3057\u305f\u3002 hiccup \u306f HTML \u3092\u5410\u304f DSL \u3092\u63d0\u4f9b\u3057\u3066\u304f\u308c\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059(\u3068\u306f\u3044\u3048 Clojure \u306e\u30d9\u30af\u30bf\u30fc\u30c7\u30fc\u30bf\u3092 HTML \u306b\u5909\u63db\u3059\u308b\u3068\u3044\u3046\u306e\u304c\u6b63\u3057\u3044\u3088\u3046\u306a\u6c17\u3082\u3057\u307e\u3059\u304c)\u3002\n\n\u307e\u305a\u306f\u672c\u984c\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u5b9a\u7fa9\u3057\u307e\u3057\u3087\u3046\u3002\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u51fa\u6765\u307e\u3059\u3002\n\n```clj\n;; src/bidi_test/routes.clj\n(ns bidi-test.routes)\n\n(def main\n  [\"/\" {\"users\" :user-index\n        [\"users/\" [#\"\\d+\" :id]] :user-show}])\n```\n\n\u7c21\u5358\u3067\u3059\u306d\u3002\u8a73\u3057\u3044\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u5b9a\u7fa9\u65b9\u6cd5\u7b49\u306f README \u306b\u8b72\u308b\u3068\u3057\u3066\u3001\u7c21\u5358\u306b\u8aac\u660e\u3059\u308b\u3068 URI \u304c `\"/users\"` \u3067\u3042\u308c\u3070 `:user-index` \u3092\u8fd4\u5374\u3057\u3001 `\"/users/:id\"` \u306a URI \u3067\u3042\u308c\u3070 `:user-show` \u3092\u8fd4\u5374\u3057\u307e\u3059\u3002\n\n\u5177\u4f53\u7684\u306b\u306f bidi \u3067\u3053\u3046\u3044\u3046\u98a8\u306b\u4f7f\u3048\u307e\u3059\u3002\n\n```clj\nuser> (require '[bidi.bidi :as bidi])\nnil\nuser> (require '[bidi-test.routes :as routes])\nnil\nuser> (bidi/match-route routes/main \"/users\")\n{:handler :user-index}\nuser> (bidi/match-route routes/main \"/users/1\")\n{:route-params {:id \"1\"}, :handler :user-show}\nuser> (bidi/path-for routes/main :user-index)\n\"/users\"\nuser> (bidi/path-for routes/main :user-show :id 1)\n\"/users/1\"\n```\n\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u5b9a\u7fa9\u65b9\u6cd5\u304c\u5206\u304b\u3063\u305f\u3068\u3053\u308d\u3067\u6b21\u306b\u9032\u307f\u307e\u3057\u3087\u3046\u3002\n\n```clj\n;; src/bidi_test/core.clj\n(ns bidi-test.core\n  (:require [bidi.bidi :as bidi]\n            [bidi.ring :as br]\n            [bidi-test.handlers]\n            [bidi-test.routes :as routes]\n            [bidi-test.utils :refer [ring-handlers]]\n            [ring.adapter.jetty :as server]))\n\n(defonce server (atom nil))\n\n(defn match-handler [k]\n  (->> (ring-handlers)\n       (filter #(= (:ring-handler (meta %))\n                   k))\n       first))\n\n(extend-protocol br/Ring\n  clojure.lang.Keyword\n  (request [k req _]\n    (let [handler (match-handler k)]\n      (handler req))))\n\n(def app\n  (br/make-handler routes/main))\n\n(defn start-server []\n  (when-not @server\n    (reset! server (server/run-jetty #'app {:port 3000 :join? false}))))\n\n(defn stop-server []\n  (when @server\n    (.stop @server)\n    (reset! server nil)))\n```\n\n\u3088\u304f\u3042\u308b\u7d20\u6734\u306a\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5/\u505c\u6b62\u3059\u308b\u95a2\u6570\u3068\u5e7e\u3064\u304b\u898b\u6163\u308c\u306a\u3044\u3082\u306e\u304c\u3042\u308a\u307e\u3059\u306d\u3002\u3061\u3087\u3063\u3068\u8aac\u660e\u3057\u307e\u3057\u3087\u3046\u3002\n\u307e\u305a `app` \u306f Ring \u30cf\u30f3\u30c9\u30e9\u30fc\u3067\u3059\u3002 `bidi.ring/make-handler` \u95a2\u6570\u306b\u5148\u307b\u3069\u5b9a\u7fa9\u3057\u3066\u304a\u3044\u305f\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u5b9a\u7fa9\u3092\u6e21\u3059\u3053\u3068\u3067\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u306e URI \u306b\u30de\u30c3\u30c1\u3059\u308b\u30cf\u30f3\u30c9\u30e9\u30fc\u3092\u5b9f\u884c\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u4eca\u56de\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u5b9a\u7fa9\u3092\u3057\u305f\u969b\u306b URI \u306b\u5bfe\u3057\u3066\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u7d10\u4ed8\u3051\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\u306a\u306e\u3067\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u5143\u306b\u30cf\u30f3\u30c9\u30e9\u30fc\u95a2\u6570\u3092\u63a2\u3057\u3066\u547c\u3073\u51fa\u3059\u90e8\u5206\u3092\u5b9f\u88c5\u3057\u3066\u3084\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u308c\u304c `extend-protocol br/Ring` \u90e8\u5206\u3067\u3059\u306d\u3002\u3053\u3053\u3067 `clojure.lang.Keyword` \u3092\u62e1\u5f35\u3057\u3001 `request` \u95a2\u6570(\u3053\u308c\u306f `make-handler` \u5185\u90e8\u3067\u547c\u3073\u51fa\u3055\u308c\u308b\u95a2\u6570)\u304c\u547c\u3073\u51fa\u3055\u308c\u305f\u3068\u304d\u306b\u5bfe\u5fdc\u51fa\u6765\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002 `match-handler` \u95a2\u6570\u306f Ring \u30cf\u30f3\u30c9\u30e9\u30fc\u306e\u30ea\u30b9\u30c8\u304b\u3089\u30ad\u30fc\u30ef\u30fc\u30c9\u3068\u4e00\u81f4\u3059\u308b\u30e1\u30bf\u60c5\u5831\u3092\u6301\u3063\u305f\u95a2\u6570\u3092\u63a2\u3057\u307e\u3059\u3002 Ring \u30cf\u30f3\u30c9\u30e9\u30fc\u306e\u30ea\u30b9\u30c8\u3092\u8fd4\u3059\u95a2\u6570\u306e\u5b9a\u7fa9\u306f\u5225\u306e\u3068\u3053\u308d\u3067\u884c\u3063\u3066\u3044\u3066\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```clj\n;; src/bidi_test/utils.clj\n(ns bidi-test.utils)\n\n(defn ring-handler? [var]\n  (contains? (meta var) :ring-handler))\n\n(defn ring-handlers []\n  (->> (all-ns)\n       (mapcat ns-interns)\n       (map second)\n       (filter ring-handler?)))\n```\n\n\u66f8\u3044\u3066\u3042\u308b\u901a\u308a\u3067\u3059\u304c\u3001\u5168\u3066\u306e\u30cd\u30fc\u30e0\u30b9\u30da\u30fc\u30b9\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b Var \u3092\u6301\u3063\u3066\u304d\u3066\u3001\u7279\u5b9a\u306e\u30e1\u30bf\u60c5\u5831\u3092\u4fdd\u6301\u3057\u3066\u3044\u308b\u304b\u3092\u898b\u3066\u3044\u307e\u3059\u3002\n\n\u6700\u5f8c\u306b\u5b9f\u969b\u306e\u30cf\u30f3\u30c9\u30e9\u30fc\u306e\u5b9a\u7fa9\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```clj\n;; src/bidi_test/handlers.clj\n(ns bidi-test.handlers\n  (:require [bidi.bidi :as bidi]\n            [bidi-test.routes :as routes]\n            [hiccup.core :as html]\n            [ring.util.response :as res]))\n\n(def users\n  [{:id 1 :name \"ayato_p\"}\n   {:id 2 :name \"alea12\"}\n   {:id 3 :name \"zer0_u\"}\n   {:id 4 :name \"gaaamii\"}\n   {:id 5 :name \"karur4n\"}])\n\n(defn ^{:ring-handler :user-index} user-index [req]\n  (-> [:div\n       [:ul\n        (for [{:keys [id name]} users]\n          [:li [:a {:href (bidi/path-for routes/main :user-show :id id)} name]])]]\n      html/html\n      res/response\n      (res/content-type \"text/html; charset=utf-8\")))\n\n(defn ^{:ring-handler :user-show} user-show [req]\n  (let [id (Long/parseLong (get-in req [:params :id]))\n        user (first (filter #(= id (:id %)) users))]\n    (-> [:h1 (:name user) \"!\"]\n        html/html\n        res/response\n        (res/content-type \"text/html; charset=utf-8\"))))\n```\n\n`^{:ring-handler :user-index}` \u3068\u3044\u3046\u3088\u3046\u306a\u611f\u3058\u3067\u30e1\u30bf\u60c5\u5831\u3092\u304f\u3063\u3064\u3051\u3066\u3044\u307e\u3059\u3002\u52ff\u8ad6\u3053\u308c\u306f\u5197\u9577\u306a\u306e\u3067 Ring \u30cf\u30f3\u30c9\u30e9\u30fc\u3092\u5b9a\u7fa9\u3059\u308b\u305f\u3081\u306e\u30de\u30af\u30ed\u3092\u66f8\u3044\u3066\u3082\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u3057\u3066\u5b9f\u969b\u306b\u5148\u307b\u3069\u8aac\u660e\u3057\u305f\u3088\u3046\u306b `(bidi/path-for routes/main :user-show :id id)` \u3053\u306e\u3088\u3046\u306b\u95a2\u6570\u3092\u547c\u3073\u51fa\u3059\u3053\u3068\u3067\u5b9f\u969b\u306b\u5fc5\u8981\u3068\u306a\u308b URI \u3092\u5f97\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\u30cf\u30fc\u30c9\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3067 URI \u66f8\u3044\u3066 `str` \u3067\u7d50\u5408\u3068\u304b\u5acc\u3067\u3059\u3088\u306d :)\n\n\u5b9f\u969b\u306b\u3053\u306e\u30b3\u30fc\u30c9\u306f REPL \u4e0a\u3067 `(require 'bidi-test.core) (bidi-test.core/start-server)` \u3068\u3059\u308c\u3070\u52d5\u304d\u307e\u3059\u306e\u3067\u662f\u975e\u624b\u5143\u3067\u52d5\u304b\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\n## \u6700\u5f8c\u306b\n\n\u3060\u30fc\u3063\u3068\u66f8\u3044\u305f\u306e\u3067\u8aac\u660e\u304c\u624b\u629c\u304d\u3067\u5206\u304b\u308a\u96e3\u3044\u3068\u601d\u3044\u307e\u3059\u304c\u3001 Compojure \u4ee5\u5916\u306b\u3082\u30a4\u30ab\u3057\u305f\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u3042\u308b\u3093\u3060\u3088!!\u3068\u3044\u3046\u306e\u304c\u4f1d\u308f\u308c\u3070\u3044\u3044\u304b\u306a\u30fc\u3068\u601d\u3044\u307e\u3059\u3002\u307e\u305f\u4eca\u56de\u306f\u30cf\u30f3\u30c9\u30e9\u30fc\u95a2\u6570\u3092\u30e1\u30bf\u60c5\u5831\u304b\u3089\u63a2\u3057\u307e\u3057\u305f\u304c\u9069\u5f53\u306b\u30ad\u30fc\u30ef\u30fc\u30c9\u3068\u95a2\u6570\u3092\u7d10\u4ed8\u3051\u308b\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u3092\u4f5c\u3063\u3066\u3082\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u3042\u3001 Compojure \u306f Web \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u306f\u306a\u304f\u3066 **\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30e9\u30a4\u30d6\u30e9\u30ea** \u3067\u3059 [^2] \u3002\n\n[^1]: [\"Compojure is really just a routing library, not a framework.\"](http://www.lispcast.com/what-web-framework-should-i-use)\n[^2]: bidi \u306e README \u306b\u3082\u3042\u308a\u307e\u3059\u304c RouteOne \u3084 Pedestal \u306a\u3069\u3068\u3044\u3063\u305f\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u6ca2\u5c71\u5b58\u5728\u3059\u308b\u306e\u3067\u597d\u307f\u306e\u3082\u306e\u3092\u63a2\u3057\u3066\u307f\u3066\u3082\u3044\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n", "tags": ["Clojure", "ClojureScript"]}