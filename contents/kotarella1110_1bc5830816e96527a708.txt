{"context": " More than 1 year has passed since last update.\n\n\u524d\u7f6e\u304d\nFuelPHP \u306e\u30ed\u30b0\u3092 fluentd \u3067 tail \u3057\u305f\u3044\u3068\u8003\u3048\u305f\u306e\u3067\u3059\u304c\u3001FuelPHP\u306f\u30ed\u30b0\u3092\u65e5\u6bce\u306b\u5225\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304d\u51fa\u3059\u306e\u3067 tail \u51fa\u6765\u306a\u3044\u3002\u53d6\u308a\u6562\u3048\u305a\u30b0\u30b0\u3063\u3066\u307f\u305f\u7d50\u679c\u3001\u3053\u3061\u3089\u304c\u975e\u5e38\u306b\u53c2\u8003\u306b\u306a\u3063\u305f\u3002\u6b86\u3069\u306e\u65b9\u304c\u3053\u3061\u3089\u306e\u8a18\u4e8b\u3067\u4e8b\u8db3\u308a\u308b\u306f\u305a\u3067\u3042\u308b\u3002\n\u81ea\u5206\u306e\u5834\u5408\u306f\u3001 FuelPHP \u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30ed\u30b0\u51fa\u529b\u306f\u305d\u306e\u307e\u307e\u51fa\u529b\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u305f\u304b\u3063\u305f\u305f\u3081\u3001\u5148\u7a0b\u306e\u8a18\u4e8b\u306e\n\n\u65b9\u6cd52 MonologFluentHandler\u3092\u4f7f\u3046\n\n\u3092\u8a66\u3057\u3066\u307f\u305f\u304c\u3088\u304f\u5206\u304b\u3089\u305a\u8ae6\u3081\u305f\u2026\u3002\n\u305d\u306e\u305f\u3081\u3001 \u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u51fa\u529b \u3068 fluentd \u7528\u306e\u51fa\u529b \u4e8c\u3064\u306e\u51fa\u529b\u3092\u884c\u3048\u308b\u3088\u3046\u306b\u81ea\u5206\u306a\u308a\u306b Log \u30af\u30e9\u30b9\u3092\u62e1\u5f35\u3057\u305f\u3002\n\nFuelPHP \u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u3092\u78ba\u8a8d\n\nFuelPHP \u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30ed\u30b0\u51fa\u529b\u5148\nfuel/app/logs/Y/m/d.php\n\nconfig \u306e\u78ba\u8a8d\n\nfuel/app/config/config.php\n\u2026\n'log_threshold'    => Fuel::L_WARNING,\n'log_path'         => APPPATH.'logs/',\n'log_date_format'  => 'Y-m-d H:i:s',\n\u2026\n\n\n\ncore \u306e\u78ba\u8a8d\ninitialize() \u30e1\u30bd\u30c3\u30c9\u5185\u3092\u629c\u7c8b\u3002\n\nfuel/app/core/classes/log.php\n\u2026\n            // determine the name and location of the logfile\n            $path     = \\Config::get('log_path', APPPATH.'logs'.DS);\n            $filename = \\Config::get('log_file', null);\n\n            if(empty($filename))\n            {\n                $rootpath = $path.date('Y').DS;\n                $filepath = $path.date('Y/m').DS;\n                $filename = $filepath.date('d').'.php';\n            }\n            else\n            {\n                $rootpath = $path;\n                $filepath = $path;\n                $filename = $path.$filename;\n            }\n\u2026\n\n\n$filename = \\Config::get('log_file', null); \u306e\u901a\u308a\u3001config \u306b \u2018log_file\u2019  => 'filename' \u3092\u8ffd\u8a18\u3059\u308b\u3053\u3068\u3067\u3001\u65e5\u6bce\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u306f\u306a\u304f\u305d\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u51fa\u529b\u3055\u308c\u308b\u3002\n\nLog \u30af\u30e9\u30b9\u306e\u62e1\u5f35\n\u4eca\u56de\u306f\u3001 \u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u51fa\u529b \u3068 fluentd \u7528\u306e\u51fa\u529b \u4e8c\u3064\u306e\u51fa\u529b\u3092\u884c\u3044 fluentd \u7528\u306e\u51fa\u529b\u3092 tail \u3067\u53d6\u308c\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u306e\u3067 Log \u30af\u30e9\u30b9\u3092\u62e1\u5f35\u3059\u308b\u3002\n\nfuel/app/classes/log.php \u306b Log \u30af\u30e9\u30b9\u3092\u8ffd\u52a0\n\u62e1\u5f35\u3057\u305f\u30b3\u30a2\u30af\u30e9\u30b9\u304c\u4ed6\u306e\u30b3\u30a2\u30af\u30e9\u30b9\u304b\u3089\u3082\u4f7f\u7528\u3055\u308c\u308b\u3088\u3046\u306b\u3059\u308b\u306b\u306f\u3001 \u5143\u306e\u30b3\u30a2\u30af\u30e9\u30b9\u3068\u540c\u3058\u540d\u524d\u3067\u30af\u30e9\u30b9\u3092\u62e1\u5f35\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\"fuel/app/classes/log.php\" \u306b Log \u30af\u30e9\u30b9\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8ffd\u52a0\u3059\u308b\u3002\n\nfuel/app/classes/log.php\nclass Log extends \\Fuel\\Core\\Log {}\n\n\n\nfuel/app/bootstrap.php \u306e\u4fee\u6b63\n\u30b3\u30a2\u30af\u30e9\u30b9\u3068\u540c\u3058\u540d\u524d\u3092\u6301\u3064\u30af\u30e9\u30b9\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u7121\u8996\u3055\u308c\u308b\u3002 \u30aa\u30fc\u30c8\u30ed\u30fc\u30c0\u306b\u7f6e\u304d\u63db\u3048\u305f\u30af\u30e9\u30b9\u3092\u8a8d\u8b58\u3055\u305b\u308b\u306b\u306f\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30d6\u30fc\u30c8\u30b9\u30c8\u30e9\u30c3\u30d7\u30d5\u30a1\u30a4\u30eb\u3067\u767b\u9332\u3059\u308b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u305f\u3081\u3001\u30b3\u30e1\u30f3\u30c8\u3067\u8aac\u660e\u3055\u308c\u3066\u3044\u308b\u901a\u308a\u306b Log \u30af\u30e9\u30b9\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\nfuel/app/bootstrap.php\n\u2026\nAutoloader::add_classes(array(\n    // Add classes you want to override here\n    // Example: 'View' => APPPATH.'classes/view.php',\n    'Log' => APPPATH.'classes/log.php'\n));\n\u2026\n\n\n\ninitialize() \u30e1\u30bd\u30c3\u30c9\u306e Override\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3001fuel/app/classes/log.php Log \u30af\u30e9\u30b9\u5185\u306b initialize() \u30e1\u30bd\u30c3\u30c9\u3092\u8ffd\u8a18\u3059\u308b\u3002\n\u30b3\u30a2\u30af\u30e9\u30b9\u306e initialize() \u30e1\u30bd\u30c3\u30c9\u3092 Override \u3057\u3001 \u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u51fa\u529b \u3068 fluentd \u7528\u306e\u51fa\u529b \u4e8c\u3064\u306e\u51fa\u529b\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\u203b \u3082\u3063\u3068\u826f\u3044 Log \u30af\u30e9\u30b9\u306e\u62e1\u5f35\u306e\u4ed5\u65b9\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u306e\u3067\u3001\u53c2\u8003\u7a0b\u5ea6\u306b\u3054\u89a7\u306b\u306a\u3063\u3066\u304f\u3060\u3055\u3044\u3002\n\nfuel/app/classes/log.php\n<?php\n/**\n * Fuel is a fast, lightweight, community driven PHP5 framework.\n *\n * @package    Fuel\n * @version    1.7\n * @author     Fuel Development Team\n * @license    MIT License\n * @copyright  2010 - 2015 Fuel Development Team\n * @link       http://fuelphp.com\n */\n\n/**\n * Log core class facade for the Monolog composer package.\n *\n * This class will provide the interface between the Fuel v1.x class API\n * and the Monolog package, in preparation for FuelPHP v2.0\n */\nclass Log extends \\Fuel\\Core\\Log\n{\n    /**\n     * initialize the created the monolog instance\n     */\n    public static function initialize()\n    {\n        // load the file config\n        \\Config::load('file', true);\n\n        // determine the name and location of the logfile\n        $path     = \\Config::get('log_path', APPPATH.'logs'.DS);\n        $filename = \\Config::get('log_file', null);\n\n        $paths[] =\n        [\n            'rootpath' => APPPATH.'logs'.DS.date('Y').DS,\n            'filepath' => APPPATH.'logs'.DS.date('Y/m').DS,\n            'filename' => APPPATH.'logs'.DS.date('Y/m').DS.date('d').'.php'\n        ];\n\n        if( ! empty($filename))\n        {\n            $paths[] =\n            [\n                'rootpath' => $path,\n                'filepath' => $path,\n                'filename' => $path.$filename\n            ];\n        }\n\n        foreach ($paths as $path)\n        {\n            // make sure the log directories exist\n            try\n            {\n                // get the required folder permissions\n                $permission = \\Config::get('file.chmod.folders', 0777);\n\n                if ( ! is_dir($path['rootpath']))\n                {\n                    mkdir($path['rootpath'], 0777, true);\n                    chmod($path['rootpath'], $permission);\n                }\n                if ( ! is_dir($path['filepath']))\n                {\n                    mkdir($path['filepath'], 0777, true);\n                    chmod($path['filepath'], $permission);\n                }\n\n                $handle = fopen($path['filename'], 'a');\n            }\n            catch (\\Exception $e)\n            {\n                \\Config::set('log_threshold', \\Fuel::L_NONE);\n                throw new \\FuelException('Unable to create or write to the log file. Please check the permissions on '.\\Config::get('log_path').'. ('.$e->getMessage().')');\n            }\n\n            if ( ! filesize($path['filename']))\n            {\n                fwrite($handle, \"<?php defined('COREPATH') or exit('No direct script access allowed'); ?>\".PHP_EOL.PHP_EOL);\n                chmod($path['filename'], \\Config::get('file.chmod.files', 0666));\n            }\n            fclose($handle);\n\n            // create the streamhandler, and activate the handler\n            $stream = new \\Monolog\\Handler\\StreamHandler($path['filename'], \\Monolog\\Logger::DEBUG);\n            $formatter = new \\Monolog\\Formatter\\LineFormatter(\"%level_name% - %datetime% --> %message%\".PHP_EOL, \"Y-m-d H:i:s\");\n            $stream->setFormatter($formatter);\n            static::$monolog->pushHandler($stream);\n        }\n    }\n}\n\n\nconfig \u306b 'log_file' => 'filename' \u306e\u6307\u5b9a\u304c\u3042\u308b\u5834\u5408\u306f\u3001 \u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u51fa\u529b \u3068 fluentd \u7528\u306e\u51fa\u529b \u4e8c\u3064\u306e\u51fa\u529b\u3092\u884c\u3044\u3001\u6307\u5b9a\u304c\u306a\u3044\u5834\u5408\u306f\u3001\u4eca\u307e\u3067\u901a\u308a \u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u51fa\u529b \u4e00\u3064\u306e\u51fa\u529b\u306e\u307f\u3092\u884c\u3046\u3002  \n\nfuel/app/config/config.php \u306e\u4fee\u6b63\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3001config \u306b 'log_path' => '/var/log/fuelphp/' 'log_file' => 'error.log' \u3092\u8ffd\u8a18\u3059\u308b\u3002\n\nfuel/app/config/config.php\n\u2026\n    'log_threshold'    => Fuel::L_WARNING,\n-   'log_path'         => APPPATH.'logs/',\n+   'log_path'         => '/var/log/fuelphp/',\n+   'log_file'         => 'error.log',\n    'log_date_format'  => 'Y-m-d H:i:s',\n\u2026\n\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u3092\u884c\u3063\u305f\u5834\u5408\u306f\u51fa\u529b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n\n\n\n\u51fa\u529b\n\u51fa\u529b\u5148\n\n\n\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\nfuel/app/logs/Y/m/d.php\n\n\nfluentd \u7528\n/var/log/fuelphp/error.log\n\n\n\n\nlogrotate \u3092\u4ed5\u639b\u3051\u308b\n\u3053\u306e\u307e\u307e\u3060\u3068 fluentd \u7528 \u306b\u51fa\u529b\u3057\u305f\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u304c\u5de8\u5927\u5316\u3057\u7d9a\u3051\u308b\u305f\u3081\u3001 /etc/logrotate.d/fuelphp \u3092\u4f5c\u6210\u3057\u3001logrotate\u3092\u4ed5\u639b\u3051\u3066\u304a\u304f\u3053\u3068\u304c\u671b\u307e\u3057\u3044\u3002\n\n/etc/logrotate.d/fuelphp\n/var/log/fuelphp/error.log {\n    daily\n    rotate 30\n    compress\n    delaycompress\n    notifempty\n    create 666 www-data www-data\n}\n\n\n\nfluentd \u3067 tail \u3059\u308b\n\n/etc/td-agent/td-agent.conf\n\u2026\n<source>\n  type tail\n  path /var/log/fuelphp/error.log\n  format /^(?<level>[^ ]*) - (?<time>[^ ]* [^ ]*) --> (?<message>.*)$/\n  time_format %Y-%m-%d %H:%M:%S\n  tag \u4efb\u610f\u306etag\u540d\n  pos_file /var/log/td-agent/\u4efb\u610f\u306epos_file\u540d.pos\n</source>\n\u2026\n\n\n\n\u53c2\u8003 URL\n\nFuelPHP\u306e\u30ed\u30b0\u3092fluentd\u306e\u5165\u529b\u306b | Imai blog\niact.tech - fuelPHP: \u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u4e3b\u529b\u5148\u3092\u5909\u66f4\nCore \u306e\u62e1\u5f35 - \u6982\u8981 - FuelPHP \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\n\n\n## \u524d\u7f6e\u304d\n\nFuelPHP \u306e\u30ed\u30b0\u3092 fluentd \u3067 tail \u3057\u305f\u3044\u3068\u8003\u3048\u305f\u306e\u3067\u3059\u304c\u3001FuelPHP\u306f\u30ed\u30b0\u3092\u65e5\u6bce\u306b\u5225\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304d\u51fa\u3059\u306e\u3067 tail \u51fa\u6765\u306a\u3044\u3002\u53d6\u308a\u6562\u3048\u305a\u30b0\u30b0\u3063\u3066\u307f\u305f\u7d50\u679c\u3001[\u3053\u3061\u3089](http://blog.glatts.com/blog/imai/?p=1022 \"FuelPHP\u306e\u30ed\u30b0\u3092fluentd\u306e\u5165\u529b\u306b | Imai blog\")\u304c\u975e\u5e38\u306b\u53c2\u8003\u306b\u306a\u3063\u305f\u3002\u6b86\u3069\u306e\u65b9\u304c\u3053\u3061\u3089\u306e\u8a18\u4e8b\u3067\u4e8b\u8db3\u308a\u308b\u306f\u305a\u3067\u3042\u308b\u3002  \n\u81ea\u5206\u306e\u5834\u5408\u306f\u3001 FuelPHP \u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30ed\u30b0\u51fa\u529b\u306f\u305d\u306e\u307e\u307e\u51fa\u529b\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u305f\u304b\u3063\u305f\u305f\u3081\u3001\u5148\u7a0b\u306e\u8a18\u4e8b\u306e\n\n> \u65b9\u6cd52 MonologFluentHandler\u3092\u4f7f\u3046\n\n\u3092\u8a66\u3057\u3066\u307f\u305f\u304c\u3088\u304f\u5206\u304b\u3089\u305a\u8ae6\u3081\u305f\u2026\u3002  \n\u305d\u306e\u305f\u3081\u3001 **\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u51fa\u529b** \u3068 **fluentd \u7528\u306e\u51fa\u529b** \u4e8c\u3064\u306e\u51fa\u529b\u3092\u884c\u3048\u308b\u3088\u3046\u306b\u81ea\u5206\u306a\u308a\u306b Log \u30af\u30e9\u30b9\u3092\u62e1\u5f35\u3057\u305f\u3002\n\n## FuelPHP \u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u3092\u78ba\u8a8d\n\n### FuelPHP \u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30ed\u30b0\u51fa\u529b\u5148\n\n`fuel/app/logs/Y/m/d.php`\n\n### config \u306e\u78ba\u8a8d\n\n```fuel/app/config/config.php\n\u2026\n'log_threshold'    => Fuel::L_WARNING,\n'log_path'         => APPPATH.'logs/',\n'log_date_format'  => 'Y-m-d H:i:s',\n\u2026\n```\n\n### core \u306e\u78ba\u8a8d\n\n`initialize()` \u30e1\u30bd\u30c3\u30c9\u5185\u3092\u629c\u7c8b\u3002\n\n```fuel/app/core/classes/log.php\n\u2026\n\t\t\t// determine the name and location of the logfile\n\t\t\t$path     = \\Config::get('log_path', APPPATH.'logs'.DS);\n\t\t\t$filename = \\Config::get('log_file', null);\n\n\t\t\tif(empty($filename))\n\t\t\t{\n\t\t\t\t$rootpath = $path.date('Y').DS;\n\t\t\t\t$filepath = $path.date('Y/m').DS;\n\t\t\t\t$filename = $filepath.date('d').'.php';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$rootpath = $path;\n\t\t\t\t$filepath = $path;\n\t\t\t\t$filename = $path.$filename;\n\t\t\t}\n\u2026\n```\n\n`$filename = \\Config::get('log_file', null);` \u306e\u901a\u308a\u3001config \u306b `\u2018log_file\u2019  => 'filename'` \u3092\u8ffd\u8a18\u3059\u308b\u3053\u3068\u3067\u3001\u65e5\u6bce\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u306f\u306a\u304f\u305d\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u51fa\u529b\u3055\u308c\u308b\u3002\n\n## Log \u30af\u30e9\u30b9\u306e\u62e1\u5f35\n\n\u4eca\u56de\u306f\u3001 **\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u51fa\u529b** \u3068 **fluentd \u7528\u306e\u51fa\u529b** \u4e8c\u3064\u306e\u51fa\u529b\u3092\u884c\u3044 fluentd \u7528\u306e\u51fa\u529b\u3092 tail \u3067\u53d6\u308c\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u306e\u3067 Log \u30af\u30e9\u30b9\u3092\u62e1\u5f35\u3059\u308b\u3002\n\n### `fuel/app/classes/log.php` \u306b Log \u30af\u30e9\u30b9\u3092\u8ffd\u52a0\n\n\u62e1\u5f35\u3057\u305f\u30b3\u30a2\u30af\u30e9\u30b9\u304c\u4ed6\u306e\u30b3\u30a2\u30af\u30e9\u30b9\u304b\u3089\u3082\u4f7f\u7528\u3055\u308c\u308b\u3088\u3046\u306b\u3059\u308b\u306b\u306f\u3001 \u5143\u306e\u30b3\u30a2\u30af\u30e9\u30b9\u3068\u540c\u3058\u540d\u524d\u3067\u30af\u30e9\u30b9\u3092\u62e1\u5f35\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\"fuel/app/classes/log.php\" \u306b Log \u30af\u30e9\u30b9\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8ffd\u52a0\u3059\u308b\u3002\n\n```fuel/app/classes/log.php\nclass Log extends \\Fuel\\Core\\Log {}\n```\n\n### `fuel/app/bootstrap.php` \u306e\u4fee\u6b63\n\n\u30b3\u30a2\u30af\u30e9\u30b9\u3068\u540c\u3058\u540d\u524d\u3092\u6301\u3064\u30af\u30e9\u30b9\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u7121\u8996\u3055\u308c\u308b\u3002 \u30aa\u30fc\u30c8\u30ed\u30fc\u30c0\u306b\u7f6e\u304d\u63db\u3048\u305f\u30af\u30e9\u30b9\u3092\u8a8d\u8b58\u3055\u305b\u308b\u306b\u306f\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30d6\u30fc\u30c8\u30b9\u30c8\u30e9\u30c3\u30d7\u30d5\u30a1\u30a4\u30eb\u3067\u767b\u9332\u3059\u308b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u305f\u3081\u3001\u30b3\u30e1\u30f3\u30c8\u3067\u8aac\u660e\u3055\u308c\u3066\u3044\u308b\u901a\u308a\u306b Log \u30af\u30e9\u30b9\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n```fuel/app/bootstrap.php\n\u2026\nAutoloader::add_classes(array(\n\t// Add classes you want to override here\n\t// Example: 'View' => APPPATH.'classes/view.php',\n\t'Log' => APPPATH.'classes/log.php'\n));\n\u2026\n```\n\n### `initialize()` \u30e1\u30bd\u30c3\u30c9\u306e Override\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3001`fuel/app/classes/log.php Log` \u30af\u30e9\u30b9\u5185\u306b `initialize()` \u30e1\u30bd\u30c3\u30c9\u3092\u8ffd\u8a18\u3059\u308b\u3002  \n\u30b3\u30a2\u30af\u30e9\u30b9\u306e `initialize()` \u30e1\u30bd\u30c3\u30c9\u3092 Override \u3057\u3001 **\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u51fa\u529b** \u3068 **fluentd \u7528\u306e\u51fa\u529b** \u4e8c\u3064\u306e\u51fa\u529b\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n\u203b \u3082\u3063\u3068\u826f\u3044 Log \u30af\u30e9\u30b9\u306e\u62e1\u5f35\u306e\u4ed5\u65b9\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u306e\u3067\u3001\u53c2\u8003\u7a0b\u5ea6\u306b\u3054\u89a7\u306b\u306a\u3063\u3066\u304f\u3060\u3055\u3044\u3002\n\n```fuel/app/classes/log.php\n<?php\n/**\n * Fuel is a fast, lightweight, community driven PHP5 framework.\n *\n * @package    Fuel\n * @version    1.7\n * @author     Fuel Development Team\n * @license    MIT License\n * @copyright  2010 - 2015 Fuel Development Team\n * @link       http://fuelphp.com\n */\n\n/**\n * Log core class facade for the Monolog composer package.\n *\n * This class will provide the interface between the Fuel v1.x class API\n * and the Monolog package, in preparation for FuelPHP v2.0\n */\nclass Log extends \\Fuel\\Core\\Log\n{\n\t/**\n\t * initialize the created the monolog instance\n\t */\n\tpublic static function initialize()\n\t{\n\t\t// load the file config\n\t\t\\Config::load('file', true);\n\n\t\t// determine the name and location of the logfile\n\t\t$path     = \\Config::get('log_path', APPPATH.'logs'.DS);\n\t\t$filename = \\Config::get('log_file', null);\n\n\t\t$paths[] =\n\t\t[\n\t\t\t'rootpath' => APPPATH.'logs'.DS.date('Y').DS,\n\t\t\t'filepath' => APPPATH.'logs'.DS.date('Y/m').DS,\n\t\t\t'filename' => APPPATH.'logs'.DS.date('Y/m').DS.date('d').'.php'\n\t\t];\n\n\t\tif( ! empty($filename))\n\t\t{\n\t\t\t$paths[] =\n\t\t\t[\n\t\t\t\t'rootpath' => $path,\n\t\t\t\t'filepath' => $path,\n\t\t\t\t'filename' => $path.$filename\n\t\t\t];\n\t\t}\n\n\t\tforeach ($paths as $path)\n\t\t{\n\t\t\t// make sure the log directories exist\n\t\t\ttry\n\t\t\t{\n\t\t\t\t// get the required folder permissions\n\t\t\t\t$permission = \\Config::get('file.chmod.folders', 0777);\n\n\t\t\t\tif ( ! is_dir($path['rootpath']))\n\t\t\t\t{\n\t\t\t\t\tmkdir($path['rootpath'], 0777, true);\n\t\t\t\t\tchmod($path['rootpath'], $permission);\n\t\t\t\t}\n\t\t\t\tif ( ! is_dir($path['filepath']))\n\t\t\t\t{\n\t\t\t\t\tmkdir($path['filepath'], 0777, true);\n\t\t\t\t\tchmod($path['filepath'], $permission);\n\t\t\t\t}\n\n\t\t\t\t$handle = fopen($path['filename'], 'a');\n\t\t\t}\n\t\t\tcatch (\\Exception $e)\n\t\t\t{\n\t\t\t\t\\Config::set('log_threshold', \\Fuel::L_NONE);\n\t\t\t\tthrow new \\FuelException('Unable to create or write to the log file. Please check the permissions on '.\\Config::get('log_path').'. ('.$e->getMessage().')');\n\t\t\t}\n\n\t\t\tif ( ! filesize($path['filename']))\n\t\t\t{\n\t\t\t\tfwrite($handle, \"<?php defined('COREPATH') or exit('No direct script access allowed'); ?>\".PHP_EOL.PHP_EOL);\n\t\t\t\tchmod($path['filename'], \\Config::get('file.chmod.files', 0666));\n\t\t\t}\n\t\t\tfclose($handle);\n\n\t\t\t// create the streamhandler, and activate the handler\n\t\t\t$stream = new \\Monolog\\Handler\\StreamHandler($path['filename'], \\Monolog\\Logger::DEBUG);\n\t\t\t$formatter = new \\Monolog\\Formatter\\LineFormatter(\"%level_name% - %datetime% --> %message%\".PHP_EOL, \"Y-m-d H:i:s\");\n\t\t\t$stream->setFormatter($formatter);\n\t\t\tstatic::$monolog->pushHandler($stream);\n\t\t}\n\t}\n}\n```\n\nconfig \u306b `'log_file' => 'filename'` \u306e\u6307\u5b9a\u304c\u3042\u308b\u5834\u5408\u306f\u3001 **\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u51fa\u529b** \u3068 **fluentd \u7528\u306e\u51fa\u529b** \u4e8c\u3064\u306e\u51fa\u529b\u3092\u884c\u3044\u3001\u6307\u5b9a\u304c\u306a\u3044\u5834\u5408\u306f\u3001\u4eca\u307e\u3067\u901a\u308a **\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u51fa\u529b** \u4e00\u3064\u306e\u51fa\u529b\u306e\u307f\u3092\u884c\u3046\u3002  \n\n### `fuel/app/config/config.php` \u306e\u4fee\u6b63\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3001config \u306b `'log_path' => '/var/log/fuelphp/'` `'log_file' => 'error.log'` \u3092\u8ffd\u8a18\u3059\u308b\u3002\n\n```diff:fuel/app/config/config.php\n\u2026\n\t'log_threshold'    => Fuel::L_WARNING,\n-\t'log_path'         => APPPATH.'logs/',\n+\t'log_path'         => '/var/log/fuelphp/',\n+\t'log_file'         => 'error.log',\n\t'log_date_format'  => 'Y-m-d H:i:s',\n\u2026\n```\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u3092\u884c\u3063\u305f\u5834\u5408\u306f\u51fa\u529b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n\n| \u51fa\u529b       | \u51fa\u529b\u5148                     |\n|:-----------|:--------------------------|\n| \u30c7\u30d5\u30a9\u30eb\u30c8  | fuel/app/logs/Y/m/d.php    |\n| fluentd \u7528 | /var/log/fuelphp/error.log |\n\n### logrotate \u3092\u4ed5\u639b\u3051\u308b\n\n\u3053\u306e\u307e\u307e\u3060\u3068 fluentd \u7528 \u306b\u51fa\u529b\u3057\u305f\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u304c\u5de8\u5927\u5316\u3057\u7d9a\u3051\u308b\u305f\u3081\u3001 `/etc/logrotate.d/fuelphp` \u3092\u4f5c\u6210\u3057\u3001logrotate\u3092\u4ed5\u639b\u3051\u3066\u304a\u304f\u3053\u3068\u304c\u671b\u307e\u3057\u3044\u3002\n\n```/etc/logrotate.d/fuelphp\n/var/log/fuelphp/error.log {\n\tdaily\n\trotate 30\n\tcompress\n\tdelaycompress\n\tnotifempty\n\tcreate 666 www-data www-data\n}\n```\n\n## fluentd \u3067 tail \u3059\u308b\n\n```/etc/td-agent/td-agent.conf\n\u2026\n<source>\n  type tail\n  path /var/log/fuelphp/error.log\n  format /^(?<level>[^ ]*) - (?<time>[^ ]* [^ ]*) --> (?<message>.*)$/\n  time_format %Y-%m-%d %H:%M:%S\n  tag \u4efb\u610f\u306etag\u540d\n  pos_file /var/log/td-agent/\u4efb\u610f\u306epos_file\u540d.pos\n</source>\n\u2026\n```\n\n## \u53c2\u8003 URL\n\n* [FuelPHP\u306e\u30ed\u30b0\u3092fluentd\u306e\u5165\u529b\u306b | Imai blog](http://blog.glatts.com/blog/imai/?p=1022 \"FuelPHP\u306e\u30ed\u30b0\u3092fluentd\u306e\u5165\u529b\u306b | Imai blog\")\n* [iact.tech - fuelPHP: \u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u4e3b\u529b\u5148\u3092\u5909\u66f4](http://iact-tech.tumblr.com/post/114033084205/fuelphp-%E3%83%AD%E3%82%B0%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%B8%BB%E5%8A%9B%E5%85%88%E3%82%92%E5%A4%89%E6%9B%B4 \"iact.tech - fuelPHP: \u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u4e3b\u529b\u5148\u3092\u5909\u66f4\")\n* [Core \u306e\u62e1\u5f35 - \u6982\u8981 - FuelPHP \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](http://fuelphp.jp/docs/1.7/general/extending_core.html \"Core \u306e\u62e1\u5f35 - \u6982\u8981 - FuelPHP \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\")\n", "tags": ["FuelPHP", "fluentd"]}