{"context": "\n\n\u5168\u4e16\u754c\u304c\u6ce3\u3044\u305f\uff01Amazon Linux Container Image\uff01\n\nNew Amazon Linux Container Image for Cloud and On-Premises Workloads | AWS Blog\nhttps://aws.amazon.com/jp/blogs/aws/new-amazon-linux-container-image-for-cloud-and-on-premises-workloads/\n\n\u3064\u3044\u306b\u624b\u5143\u306b Amazon Linux \u304c\uff01\uff01\uff01\n\nAWS Lambda \u3067\u30cd\u30a4\u30c6\u30a3\u30d6\u30e9\u30a4\u30d6\u30e9\u30ea(.so)\u3092\u53c2\u7167\u3059\u308bpython\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30d9\u30f3\u30c0\u30ea\u30f3\u30b0\u3059\u308b\u306e\u306b\u4f7f\u3063\u3066\u307f\u308b\nAmazon Linux Container Image\u3092\u4f7f\u3048\u3070\n\u4eca\u307e\u3067\u30cd\u30a4\u30c6\u30a3\u30d6\u30e9\u30a4\u30d6\u30e9\u30ea(.so)\u3092\u4f7f\u3046python\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f5c\u308b\u306e\u306b\nEC2\u3067Amazon Linux\u3092\u8d77\u52d5\u3057\u3066\u4f5c\u3063\u3066\u305f\u3068\u3053\u308d\u306e\u624b\u9593\u304c\u6e1b\u308b\uff01\n\u304a\u8ca1\u5e03\u306b\u3082\u512a\u3057\u3044\uff01\n\n\u6e96\u5099\n\n\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3092 pull \u3057\u3066\u304a\u304f\n\nAmazon Linux Container Image - Amazon ECR\nhttp://docs.aws.amazon.com/AmazonECR/latest/userguide/amazon_linux_container_image.html\n\n\u3092\u53c2\u7167\u3002\n\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3002\n$ docker run -it 137112412989.dkr.ecr.us-west-2.amazonaws.com/amazonlinux:latest cat  /etc/system-release\nAmazon Linux AMI release 2016.09\n$\n\n\u78ba\u304b\u306bAmazon Linux! (\u611f\u6d99)\n\n\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\nlambda\u306e\u4e2d\u3067\u6301\u3063\u3066\u3044\u308b\u753b\u50cf\u3092\u30ea\u30b5\u30a4\u30ba\u3057\u3066\n/tmp/ \u306b\u51fa\u529b\u3057\u3066\nlambda\u306e\u4e2d\u306b\u7f6e\u304d\u3063\u3071\u306a\u3057\u3067\u7d42\u4e86\u3059\u308b\n\u610f\u5473\u306e\u306a\u3044\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u3059\u3002\nServerless Framework v1\u3067\u3059\u3002\nhttps://github.com/imura81gt/lambda-and-amazon-linux-container/tree/qiita\n\u5404\u7a2e\u30d5\u30a1\u30a4\u30eb\u306b\u3064\u3044\u3066\u88dc\u8db3\u3059\u308b\u3068\n\n\u4e00\u89a7\n$ tree -FL 1 test/\ntest\n\u251c\u2500\u2500 Dockerfile  # Amazon Linux\u30b3\u30f3\u30c6\u30ca\n\u251c\u2500\u2500 event.json  # ServerlessFramework\n\u251c\u2500\u2500 handler.py  # ServerlessFramework\n\u251c\u2500\u2500 lena_std.tif # \u753b\u50cf\u30d5\u30a1\u30a4\u30eb\n\u251c\u2500\u2500 requirements.txt # pip\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30d1\u30c3\u30b1\u30fc\u30b8(pip freeze >> requirements.txt)\n\u251c\u2500\u2500 serverless.yml  # ServerlessFramework\n\u251c\u2500\u2500 setup.cfg  # Amazon Linux\u306bPillow\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306e\u306b\u5fc5\u8981\u3060\u3063\u305f\n\u2514\u2500\u2500 yum.list # Pillow\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306e\u306b\u5fc5\u8981\u306ayum repo\u7ba1\u7406\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\n\n1 directory, 8 files\n\n\nDockerfile\nFROM 137112412989.dkr.ecr.us-west-2.amazonaws.com/amazonlinux:latest\n\nRUN mkdir /app\n\nWORKDIR /app\n\n# lambda\u306f python2.7\u3067\u52d5\u304f\nRUN yum install python27 python27-pip python27-devel python27-libs gcc  -y\n\nADD . .\n# pip\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u4f9d\u5b58\u3057\u3066\u3044\u308b\u30e2\u30ce\u306f yum.list \u306b\u66f8\u3044\u3068\u304f\n# ONBUILD RUN \u3068\u304b\u306b\u3059\u308c\u3070\u3088\u304b\u3063\u305f\u304b\u3082\nRUN yum install $(echo $(cat yum.list)) -y\n\nCMD pip install --no-cache-dir -r /app/requirements.txt -t /app/vendor\n\n\nNG\u30d1\u30bf\u30fc\u30f3  \u30cd\u30a4\u30c6\u30a3\u30d6\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3046python\u30d1\u30c3\u30b1\u30fc\u30b8\u3092OSX\u4e0a\u3067pip\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3089\u2026\n\u307e\u3061\u304c\u3063\u3066 OSX \u4e0a\u3067 pip install \u3057\u305f\u30e2\u30ce\u3092\u305d\u306e\u307e\u307e Lambda \u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u3089\u2026\n$ cd test\n$ # OSX\u3084CentOS\u4e0a\u3067 pip install \u3057\u305f\n$ # \u30cd\u30a4\u30c6\u30a3\u30d6\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3046\u30d1\u30c3\u30b1\u30fc\u30b8\n$ # (ex.Pillow)\u306fLambda\u4e0a\u3067\u306f\u52d5\u304b\u306a\u3044\u3002\n$ pip install -r requirements.txt -t vendor/\n$ $(npm bin)/sls deploy\n$ $(npm bin)/sls invoke -f hello\n\n\u30a8\u30e9\u30fc\u304c\u51fa\u308b\n{\n    \"errorMessage\": \"Unable to import module 'handler'\"\n\n}\n\n\u30ed\u30b0\u3092\u898b\u308b\u3068\n$ $(npm bin)/sls logs -f hello\n\nUnable to import module 'handler': /var/task/vendor/PIL/_imaging.so: invalid ELF header \u3068\u51fa\u3066\u307e\u3059\u3002\nSTART RequestId: fea3d675-a59c-11e6-9977-9db5192e5233 Version: $LATEST\nUnable to import module 'handler': /var/task/vendor/PIL/_imaging.so: invalid ELF header\n\nEND RequestId: fea3d675-a59c-11e6-9977-9db5192e5233\nREPORT RequestId: fea3d675-a59c-11e6-9977-9db5192e5233  Duration: 0.24 ms   Billed Duration: 100 ms     Memory Size: 1024 MB    Max Memory Used: 32 MB\n\n\nOK\u30d1\u30bf\u30fc\u30f3 Amazon Linux Contaier Image\u3092\u4f7f\u3046\nAmazon Linux Container Images \u3092pull\u3057\u3066\u304a\u304f\nhttp://docs.aws.amazon.com/AmazonECR/latest/userguide/amazon_linux_container_image.html\n$ cd test\n$ rm -rf vendor/\n$ docker build . -t amazon-py\n$ docker run -it -v $(pwd)/vendor:/app/vendor:rw -t amazon-py\n$ $(npm bin)/sls deploy\n$ $(npm bin)/sls invoke -t hello\n\n\u5b9f\u884c\u7d50\u679c\u306f\nnull\n\n\u30ed\u30b0\u306b\u3082\u30a8\u30e9\u30fc\u306a\u3057\n$ $(npm bin)/sls logs -f hello\n\nSTART RequestId: e9003709-a59e-11e6-b541-0f7fe552a859 Version: $LATEST\nEND RequestId: e9003709-a59e-11e6-b541-0f7fe552a859\nREPORT RequestId: e9003709-a59e-11e6-b541-0f7fe552a859  Duration: 169.37 ms Billed Duration: 200 ms     Memory Size: 1024 MB    Max Memory Used: 33 MB\n\n\n\u671f\u5f85\nDynamoDB Local \u307f\u305f\u3044\u306a\u611f\u3058\u3067\u3001 Lambda Local\u304c\u8a95\u751f\u3059\u308b\u3068\u3044\u3044\u306a\u3041\u3002\n\n\u8ffd\u8a18\uff082017/01/27\uff09\n\nServerless Framework Plugin \u3092\u4f7f\u3046\u65b9\u6cd5\nServerless Framework\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u306f\n\nServerless Framework\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5229\u7528\u3057\u305f\u5916\u90e8\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u7ba1\u7406 \uff5c Developers.IO\nhttp://dev.classmethod.jp/cloud/aws/managing-external-modules-with-serverless-framework-plugin/\n\n\u306b\u304b\u304b\u308c\u3066\u3044\u308b\n\nUnitedIncome/serverless-python-requirements: Serverless plugin to bundle Python packages\n\nhttps://github.com/UnitedIncome/serverless-python-requirements\n\n\n\u3092\u4f7f\u3046\u306e\u304c\u7c21\u5358\u3067\u826f\u3055\u305d\u3046\u3067\u3059\u3002\n\uff08https://github.com/lambci/docker-lambda\u304c\u4f7f\u308f\u308c\u3066\u3044\u308b\u3068\u306e\u3053\u3068\u3002\uff09\n\uff08\u30a2\u30f3\u30aa\u30d5\u30b7\u30e3\u30eb\u306a\u306e\u3067\u6c17\u3092\u3064\u3051\u3066\u306d\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u304c\u3001\u500b\u4eba\u306e\u9069\u5f53Dockerfile\u3088\u308a\u306f\u5b89\u5fc3\u304b\u3068\uff09\n\nLambda Local\u3068\u304b\u8a00\u3063\u3066\u305f\u3093\u3060\u4ffa\u2026\ngreengrass\u304c\u305d\u306e\u3046\u3061\u30d3\u30eb\u30c9\u74b0\u5883\u3092\u62c5\u3063\u3066\u304f\u308c\u308b\u3093\u3067\u3057\u3087\u3046\u304d\u3063\u3068\u3002\n\u5168\u4e16\u754c\u304c\u6ce3\u3044\u305f\uff01Amazon Linux Container Image\uff01\n================\n\n> New Amazon Linux Container Image for Cloud and On-Premises Workloads | AWS Blog\nhttps://aws.amazon.com/jp/blogs/aws/new-amazon-linux-container-image-for-cloud-and-on-premises-workloads/\n\n\u3064\u3044\u306b\u624b\u5143\u306b Amazon Linux \u304c\uff01\uff01\uff01\n\nAWS Lambda \u3067\u30cd\u30a4\u30c6\u30a3\u30d6\u30e9\u30a4\u30d6\u30e9\u30ea(.so)\u3092\u53c2\u7167\u3059\u308bpython\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30d9\u30f3\u30c0\u30ea\u30f3\u30b0\u3059\u308b\u306e\u306b\u4f7f\u3063\u3066\u307f\u308b\n================\n\nAmazon Linux Container Image\u3092\u4f7f\u3048\u3070\n\u4eca\u307e\u3067\u30cd\u30a4\u30c6\u30a3\u30d6\u30e9\u30a4\u30d6\u30e9\u30ea(.so)\u3092\u4f7f\u3046python\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f5c\u308b\u306e\u306b\nEC2\u3067Amazon Linux\u3092\u8d77\u52d5\u3057\u3066\u4f5c\u3063\u3066\u305f\u3068\u3053\u308d\u306e\u624b\u9593\u304c\u6e1b\u308b\uff01\n\u304a\u8ca1\u5e03\u306b\u3082\u512a\u3057\u3044\uff01\n\n\u6e96\u5099\n---------------\n\n### \u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3092 pull \u3057\u3066\u304a\u304f\n\n> Amazon Linux Container Image - Amazon ECR\n> http://docs.aws.amazon.com/AmazonECR/latest/userguide/amazon_linux_container_image.html\n\n\u3092\u53c2\u7167\u3002\n\n\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3002\n\n```\n$ docker run -it 137112412989.dkr.ecr.us-west-2.amazonaws.com/amazonlinux:latest cat  /etc/system-release\nAmazon Linux AMI release 2016.09\n$\n```\n\n\u78ba\u304b\u306bAmazon Linux! (\u611f\u6d99)\n\n\n### \u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\n\nlambda\u306e\u4e2d\u3067\u6301\u3063\u3066\u3044\u308b\u753b\u50cf\u3092\u30ea\u30b5\u30a4\u30ba\u3057\u3066\n/tmp/ \u306b\u51fa\u529b\u3057\u3066\nlambda\u306e\u4e2d\u306b\u7f6e\u304d\u3063\u3071\u306a\u3057\u3067\u7d42\u4e86\u3059\u308b\n\u610f\u5473\u306e\u306a\u3044\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u3059\u3002\nServerless Framework v1\u3067\u3059\u3002\n\nhttps://github.com/imura81gt/lambda-and-amazon-linux-container/tree/qiita\n\n\u5404\u7a2e\u30d5\u30a1\u30a4\u30eb\u306b\u3064\u3044\u3066\u88dc\u8db3\u3059\u308b\u3068\n\n#### \u4e00\u89a7\n\n```\n$ tree -FL 1 test/\ntest\n\u251c\u2500\u2500 Dockerfile  # Amazon Linux\u30b3\u30f3\u30c6\u30ca\n\u251c\u2500\u2500 event.json  # ServerlessFramework\n\u251c\u2500\u2500 handler.py  # ServerlessFramework\n\u251c\u2500\u2500 lena_std.tif # \u753b\u50cf\u30d5\u30a1\u30a4\u30eb\n\u251c\u2500\u2500 requirements.txt # pip\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30d1\u30c3\u30b1\u30fc\u30b8(pip freeze >> requirements.txt)\n\u251c\u2500\u2500 serverless.yml  # ServerlessFramework\n\u251c\u2500\u2500 setup.cfg  # Amazon Linux\u306bPillow\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306e\u306b\u5fc5\u8981\u3060\u3063\u305f\n\u2514\u2500\u2500 yum.list # Pillow\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306e\u306b\u5fc5\u8981\u306ayum repo\u7ba1\u7406\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\n\n1 directory, 8 files\n```\n\n\n#### Dockerfile\n\n```\nFROM 137112412989.dkr.ecr.us-west-2.amazonaws.com/amazonlinux:latest\n\nRUN mkdir /app\n\nWORKDIR /app\n\n# lambda\u306f python2.7\u3067\u52d5\u304f\nRUN yum install python27 python27-pip python27-devel python27-libs gcc  -y\n\nADD . .\n# pip\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u4f9d\u5b58\u3057\u3066\u3044\u308b\u30e2\u30ce\u306f yum.list \u306b\u66f8\u3044\u3068\u304f\n# ONBUILD RUN \u3068\u304b\u306b\u3059\u308c\u3070\u3088\u304b\u3063\u305f\u304b\u3082\nRUN yum install $(echo $(cat yum.list)) -y\n\nCMD pip install --no-cache-dir -r /app/requirements.txt -t /app/vendor\n```\n\nNG\u30d1\u30bf\u30fc\u30f3 :bomb: \u30cd\u30a4\u30c6\u30a3\u30d6\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3046python\u30d1\u30c3\u30b1\u30fc\u30b8\u3092OSX\u4e0a\u3067pip\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3089\u2026\n---------------\n\n\u307e\u3061\u304c\u3063\u3066 OSX \u4e0a\u3067 pip install \u3057\u305f\u30e2\u30ce\u3092\u305d\u306e\u307e\u307e Lambda \u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u3089\u2026\n\n```\n$ cd test\n$ # OSX\u3084CentOS\u4e0a\u3067 pip install \u3057\u305f\n$ # \u30cd\u30a4\u30c6\u30a3\u30d6\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3046\u30d1\u30c3\u30b1\u30fc\u30b8\n$ # (ex.Pillow)\u306fLambda\u4e0a\u3067\u306f\u52d5\u304b\u306a\u3044\u3002\n$ pip install -r requirements.txt -t vendor/\n$ $(npm bin)/sls deploy\n$ $(npm bin)/sls invoke -f hello\n```\n\n\u30a8\u30e9\u30fc\u304c\u51fa\u308b\n\n```\n{\n    \"errorMessage\": \"Unable to import module 'handler'\"\n\n}\n```\n\n\u30ed\u30b0\u3092\u898b\u308b\u3068\n\n```\n$ $(npm bin)/sls logs -f hello\n```\n\n`Unable to import module 'handler': /var/task/vendor/PIL/_imaging.so: invalid ELF header` \u3068\u51fa\u3066\u307e\u3059\u3002\n\n```\nSTART RequestId: fea3d675-a59c-11e6-9977-9db5192e5233 Version: $LATEST\nUnable to import module 'handler': /var/task/vendor/PIL/_imaging.so: invalid ELF header\n\nEND RequestId: fea3d675-a59c-11e6-9977-9db5192e5233\nREPORT RequestId: fea3d675-a59c-11e6-9977-9db5192e5233\tDuration: 0.24 ms\tBilled Duration: 100 ms \tMemory Size: 1024 MB\tMax Memory Used: 32 MB\n```\n\nOK\u30d1\u30bf\u30fc\u30f3:star: Amazon Linux Contaier Image\u3092\u4f7f\u3046\n-----------\n\nAmazon Linux Container Images \u3092pull\u3057\u3066\u304a\u304f\nhttp://docs.aws.amazon.com/AmazonECR/latest/userguide/amazon_linux_container_image.html\n\n\n```\n$ cd test\n$ rm -rf vendor/\n$ docker build . -t amazon-py\n$ docker run -it -v $(pwd)/vendor:/app/vendor:rw -t amazon-py\n$ $(npm bin)/sls deploy\n$ $(npm bin)/sls invoke -t hello\n```\n\n\u5b9f\u884c\u7d50\u679c\u306f\n\n```\nnull\n```\n\n\u30ed\u30b0\u306b\u3082\u30a8\u30e9\u30fc\u306a\u3057\n\n```\n$ $(npm bin)/sls logs -f hello\n```\n\n```\nSTART RequestId: e9003709-a59e-11e6-b541-0f7fe552a859 Version: $LATEST\nEND RequestId: e9003709-a59e-11e6-b541-0f7fe552a859\nREPORT RequestId: e9003709-a59e-11e6-b541-0f7fe552a859\tDuration: 169.37 ms\tBilled Duration: 200 ms \tMemory Size: 1024 MB\tMax Memory Used: 33 MB\n```\n\n\n\u671f\u5f85\n================\n\nDynamoDB Local \u307f\u305f\u3044\u306a\u611f\u3058\u3067\u3001 Lambda Local\u304c\u8a95\u751f\u3059\u308b\u3068\u3044\u3044\u306a\u3041\u3002\n\n\n\u8ffd\u8a18\uff082017/01/27\uff09\n================\n\nServerless Framework Plugin \u3092\u4f7f\u3046\u65b9\u6cd5\n-----\n\nServerless Framework\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u306f\n\n>   Serverless Framework\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5229\u7528\u3057\u305f\u5916\u90e8\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u7ba1\u7406 \uff5c Developers.IO\n>   http://dev.classmethod.jp/cloud/aws/managing-external-modules-with-serverless-framework-plugin/\n\n\u306b\u304b\u304b\u308c\u3066\u3044\u308b\n\n>   UnitedIncome/serverless-python-requirements: Serverless plugin to bundle Python packages\n> >   https://github.com/UnitedIncome/serverless-python-requirements\n\n\n\u3092\u4f7f\u3046\u306e\u304c\u7c21\u5358\u3067\u826f\u3055\u305d\u3046\u3067\u3059\u3002\n\n\uff08https://github.com/lambci/docker-lambda\u304c\u4f7f\u308f\u308c\u3066\u3044\u308b\u3068\u306e\u3053\u3068\u3002\uff09\n\n\uff08\u30a2\u30f3\u30aa\u30d5\u30b7\u30e3\u30eb\u306a\u306e\u3067\u6c17\u3092\u3064\u3051\u3066\u306d\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u304c\u3001\u500b\u4eba\u306e\u9069\u5f53Dockerfile\u3088\u308a\u306f\u5b89\u5fc3\u304b\u3068\uff09\n\n\nLambda Local\u3068\u304b\u8a00\u3063\u3066\u305f\u3093\u3060\u4ffa\u2026\n-----\n\ngreengrass\u304c\u305d\u306e\u3046\u3061\u30d3\u30eb\u30c9\u74b0\u5883\u3092\u62c5\u3063\u3066\u304f\u308c\u308b\u3093\u3067\u3057\u3087\u3046\u304d\u3063\u3068\u3002\n\n", "tags": ["serverless", "docker", "Python", "AWS", "lambda"]}