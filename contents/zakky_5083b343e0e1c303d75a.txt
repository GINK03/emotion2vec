{"context": " More than 1 year has passed since last update.\n\nAmazon Inspector\u3068\u306f\nre:Invent\u3067\u767a\u8868\u306b\u306a\u3063\u305f\u65b0\u30b5\u30fc\u30d3\u30b9\u3067\u3001\u57f7\u7b46\u73fe\u5728\u306fPreview\u3067 us-west-2 (\u30aa\u30ec\u30b4\u30f3)\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u3057\u304b\u3042\u308a\u307e\u305b\u3093\u3002\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u4ed5\u8fbc\u3080\u3053\u3068\u3067\u3001OS\u3084\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u8a2d\u5b9a\u3057\u305f\u30eb\u30fc\u30eb\u306b\u6cbf\u3063\u3066\u3044\u308b\u304b\u8a3a\u65ad\u3092\u884c\u3063\u3066\u304f\u308c\u308b\u30b5\u30fc\u30d3\u30b9\u3067\u3059\u3002\nAWS CLI\u3092\u5229\u7528\u3057\u3066\u3001\u305d\u3093\u306aAWS Inspector\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u524d\u63d0\u6761\u4ef6\n\n\u30c7\u30d5\u30a9\u30eb\u30c8VPC\u306e\u5b58\u5728\n\u30c7\u30d5\u30a9\u30eb\u30c8VPC\u304c\u5b58\u5728\u3059\u308b\u3053\u3068\u3002\n\nInspector\u3078\u306e\u6a29\u9650\nInspector\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\nEC2\u3078\u306e\u6a29\u9650\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8d77\u52d5\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\nAWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\nAWS CLI 1.9.9\n\n\n\u30b3\u30de\u30f3\u30c9\naws --version\n\n\n\n\u7d50\u679c(\u4f8b)\n      aws-cli/1.9.9 Python/2.6.6 Linux/2.6.32 botocore/1.3.9\n\n\n\n0. \u4e8b\u524d\u4f5c\u696d\n\n0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u6c7a\u5b9a\nInspector\u306f\u73fe\u5728Preview\u3067us-west-2(\u30aa\u30ec\u30b4\u30f3)\u306b\u3057\u304b\u306a\u3044\u306e\u3067\u30aa\u30ec\u30b4\u30f3\u306b\u3057\u307e\u3059\u3002\n(\u30ab\u30ec\u30f3\u30c8\u30e6\u30fc\u30b6\u304c\u5229\u7528\u3059\u308b\u30ab\u30ec\u30f3\u30c8\u30ea\u30fc\u30b8\u30e7\u30f3\u3082\u5207\u308a\u5909\u308f\u308a\u307e\u3059\u3002)\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nexport AWS_DEFAULT_REGION='us-west-2'\n\n\n\n0.2. \u5909\u6570\u306e\u78ba\u8a8d\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3068\u30ea\u30fc\u30b8\u30e7\u30f3\u304c\u60f3\u5b9a\u306e\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws configure list\n\n\n\n\u7d50\u679c(\u4f8b)\n            Name                    Value             Type    Location\n            ----                    -----             ----    --------\n         profile                <not set>             None    None\n      access_key     ****************M73Q shared-credentials-file\n      secret_key     ****************YWg/ shared-credentials-file\n          region                us-west-2              env    AWS_DEFAULT_REGION\n\n\n\n0.3. AWS\u30a2\u30ab\u30a6\u30f3\u30c8ID\u306e\u53d6\u5f97\n\n\u30b3\u30de\u30f3\u30c9\nAWS_ID=$( aws iam get-user --query 'User.Arn' --output text | sed 's/^.*:://' | sed 's/:.*$//' ) && echo ${AWS_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\n      454200CLI555\n\n\n\n1. \u8a3a\u65ad\u7528EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6e96\u5099\n\n1.1. VPCID\u306e\u53d6\u5f97\n\n\u30b3\u30de\u30f3\u30c9\nVPC_ID=`aws ec2 describe-vpcs --filters Name=isDefault,Values=true --query 'Vpcs[].VpcId' --output text` && echo ${VPC_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\n      vpc-xxxxxxxx\n\n\n\n1.2. \u30ad\u30fc\u30da\u30a2\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\nEC2_KEY_NAME=\"handson\" && echo ${EC2_KEY_NAME}\nFILE_SSH_KEY=\"${HOME}/.ssh/${EC2_KEY_NAME}.pem\" && echo ${FILE_SSH_KEY}\naws ec2 create-key-pair --key-name ${EC2_KEY_NAME} --query 'KeyMaterial' --output text > ${FILE_SSH_KEY} && cat ${FILE_SSH_KEY} && chmod 600 ${FILE_SSH_KEY}\n\n\n\n\u7d50\u679c(\u4f8b)\n      -----BEGIN RSA PRIVATE KEY-----\n      MIIEogIBAAKCAQEAly2hbGNZKdoInU5W7UkXiIiOPKnNsBvGtJonl6oEE/KPtilnpYwwsE9+R+d0\n      cBoqNYy2QPjSB2VWq8h2Fb7oaZsttGCQ2ULPJMU8q10JBYnAlke+kvyj2LPBuIJtvVTnZ5NokJbc\n      Dh9gN27kFcWYE2099Iu9m3Mz6uPR8c2pzgoSzqapcgn3mtZV7av4mSX//siHhwx8k8RT3dCm+IFR\n      \uff08\u672c\u5f53\u306f\u3082\u3063\u3068\u9577\u3044\uff09\n      oY0qjQ3QLUM9/fbcL+U4mDsiBotbAp70yTFJupREYrA5AoGAS6aP6xl/QW4hS/r1HZZLgbd5uWdn\n      Alcjcxy1fed70YVZDHTZUTTIxRCu/ZedvHQovSgmG+PwZhkvhFd15QtBLfLAjL3W9cE1qhUGIi7S\n      PqRjDB83ivjFRa3fBunC0ebWnCE0E53yzujRZvBPFmAtdDh7nIpevHXJCm0cmZCVuq4=\n      -----END RSA PRIVATE KEY-----\n\n\n\n1.3. \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\nSG_NAME=\"handson\"\naws ec2 create-security-group --group-name ${SG_NAME} --description ${SG_NAME} --vpc-id ${VPC_ID}\nSG_ID=`aws ec2 describe-security-groups --filter Name=group-name,Values=${SG_NAME} --query 'SecurityGroups[].GroupId' --output text` && echo ${SG_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n          \"GroupId\": \"sg-59c3e63d\"\n      }\n\n      sg-59c3e63d\n\n\n\u5916\u90e8\u304b\u3089\u306eHTTP\u63a5\u7d9a\u3068SSH\u30ed\u30b0\u30a4\u30f3\u3092\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306b\u8ffd\u52a0\n\uff0812.34.56.789/32 \u306f\u9069\u5b9c\u81ea\u5206\u306e\u30a2\u30c9\u30ec\u30b9\u3078\u66f8\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\uff09\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 authorize-security-group-ingress --group-id ${SG_ID} --protocol 'tcp' --port 80 --cidr 0.0.0.0/0\naws ec2 authorize-security-group-ingress --group-id ${SG_ID} --protocol 'tcp' --port 22 --cidr 12.34.56.789/32\n\n\n\n\u7d50\u679c(\u4f8b)\n      (\u623b\u308a\u5024\u306a\u3057)\n\n\n\n1.4. \u8a3a\u65ad\u8a66\u9a13\u7528EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u69cb\u7bc9\nAMI ID\u306e\u53d6\u5f97:\n\n\u30b3\u30de\u30f3\u30c9\nAMI_NAME='amzn-ami-hvm-2015.09.0.x86_64-gp2'\nAMI_ID=`aws ec2 describe-images --filters Name=name,Values=${AMI_NAME} --query 'Images[].ImageId' --output text` && echo ${AMI_ID}\n\n\n\n\u7d50\u679c\n      ami-9ff7e8af\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5:\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 run-instances --image-id ${AMI_ID} --associate-public-ip-address --instance-type t2.micro --key-name ${EC2_KEY_NAME} --region ${AWS_DEFAULT_REGION} --security-group-ids ${SG_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n          \"OwnerId\": \"454200CLI555\",\n          \"ReservationId\": \"r-a112f757\",\n          \"Groups\": [],\n          \"Instances\": [\n              {\n                  \"Monitoring\": {\n                      \"State\": \"disabled\"\n                  },\n                  \"PublicDnsName\": \"\",\n                  \"RootDeviceType\": \"ebs\",\n                  \"State\": {\n                      \"Code\": 0,\n                      \"Name\": \"pending\"\n                  },\n                  \"EbsOptimized\": false,\n                  \"LaunchTime\": \"2015-11-25T15:05:31.000Z\",\n                  \"PrivateIpAddress\": \"172.31.18.115\",\n                  \"ProductCodes\": [],\n                  \"VpcId\": \"vpc-fd543898\",\n                  \"StateTransitionReason\": \"\",\n                  \"InstanceId\": \"i-3ef4b3fa\",\n                  \"ImageId\": \"ami-9ff7e8af\",\n                  \"PrivateDnsName\": \"ip-172-31-18-115.us-west-2.compute.internal\",\n                  \"KeyName\": \"handson\",\n                  \"SecurityGroups\": [\n                      {\n                          \"GroupName\": \"handson\",\n                          \"GroupId\": \"sg-59c3e63d\"\n                      }\n                  ],\n                  \"ClientToken\": \"\",\n                  \"SubnetId\": \"subnet-8e0870eb\",\n                  \"InstanceType\": \"t2.micro\",\n                  \"NetworkInterfaces\": [\n                      {\n                          \"Status\": \"in-use\",\n                          \"MacAddress\": \"02:99:bc:70:59:33\",\n                          \"SourceDestCheck\": true,\n                          \"VpcId\": \"vpc-fd543898\",\n                          \"Description\": \"\",\n                          \"NetworkInterfaceId\": \"eni-6954d410\",\n                          \"PrivateIpAddresses\": [\n                              {\n                                  \"PrivateDnsName\": \"ip-172-31-18-115.us-west-2.compute.internal\",\n                                  \"Primary\": true,\n                                  \"PrivateIpAddress\": \"172.31.18.115\"\n                              }\n                          ],\n                          \"PrivateDnsName\": \"ip-172-31-18-115.us-west-2.compute.internal\",\n                          \"Attachment\": {\n                              \"Status\": \"attaching\",\n                              \"DeviceIndex\": 0,\n                              \"DeleteOnTermination\": true,\n                              \"AttachmentId\": \"eni-attach-7dc5d676\",\n                              \"AttachTime\": \"2015-11-25T15:05:31.000Z\"\n                          },\n                          \"Groups\": [\n                              {\n                                  \"GroupName\": \"handson\",\n                                  \"GroupId\": \"sg-59c3e63d\"\n                              }\n                          ],\n                          \"SubnetId\": \"subnet-8e0870eb\",\n                          \"OwnerId\": \"454200CLI555\",\n                          \"PrivateIpAddress\": \"172.31.18.115\"\n                      }\n                  ],\n                  \"SourceDestCheck\": true,\n                  \"Placement\": {\n                      \"Tenancy\": \"default\",\n                      \"GroupName\": \"\",\n                      \"AvailabilityZone\": \"us-west-2b\"\n                  },\n                  \"Hypervisor\": \"xen\",\n                  \"BlockDeviceMappings\": [],\n                  \"Architecture\": \"x86_64\",\n                  \"StateReason\": {\n                      \"Message\": \"pending\",\n                      \"Code\": \"pending\"\n                  },\n                  \"RootDeviceName\": \"/dev/xvda\",\n                  \"VirtualizationType\": \"hvm\",\n                  \"AmiLaunchIndex\": 0\n              }\n          ]\n      }\n\n\n\n1.5. \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078\u306e\u30bf\u30b0\u4ed8\u3051\nInspector\u306e\u8abf\u67fb\u5bfe\u8c61\u3068\u3059\u308b\u305f\u3081\u306e\u8b58\u5225\u7528\u306bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078\u4efb\u610f\u306e\u30bf\u30b0\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u8a2d\u5b9a\u3057\u305f\u30bf\u30b0\u3092Inspector\u5074\u3067\u3082\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001\u3053\u308c\u304c\u8abf\u67fb\u5bfe\u8c61\u306e\u8b58\u5225\u5b50\u306b\u306a\u308a\u307e\u3059\u3002\nKey\u3092 inspector \u3001Value\u3092 handson \u3068\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nTAG_KEY='inspector'\nTAG_VALUE='handson'\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\u306e\u53d6\u5f97\n\n\u30b3\u30de\u30f3\u30c9\nEC2_INSTANCE_ID=`aws ec2 describe-instances --query 'Reservations[].Instances[].InstanceId' --output text` && echo ${EC2_INSTANCE_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\n      i-3ef4b3fa\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30bf\u30b0\u3092\u8a2d\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 create-tags --resources ${EC2_INSTANCE_ID} --tags Key=\"${TAG_KEY}\",Value=\"${TAG_VALUE}\"\n\n\n\n\u7d50\u679c\n      (\u623b\u308a\u5024\u306a\u3057)\n\n\n\n1.6. \u30d1\u30d6\u30ea\u30c3\u30afIP\u30a2\u30c9\u30ec\u30b9\u306e\u53d6\u5f97\n\n\u30b3\u30de\u30f3\u30c9\nEC2_PUBLIC_IP=`aws ec2 describe-instances --instance-id ${EC2_INSTANCE_ID} --query \"Reservations[].Instances[].PublicIpAddress\" --output text` && echo ${EC2_PUBLIC_IP}\n\n\n\n\u7d50\u679c(\u4f8b)\n      54.xxx.xxx.xxx\n\n\n\n1.7. SSH\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078\u30ed\u30b0\u30a4\u30f3\n\u8d77\u52d5\u5b8c\u4e86\u307e\u3067\u6570\u5206\u304b\u304b\u308a\u307e\u3059\u3002\u3061\u3087\u3063\u3068\u30d3\u30fc\u30eb\u3067\u3082\u98f2\u3093\u3067\u304b\u3089\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3078\u9032\u307f\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\nssh -l ec2-user -i ${FILE_SSH_KEY} ${EC2_PUBLIC_IP}\n\n\n\n\u7d50\u679c(\u4f8b)\n      The authenticity of host '54.xxx.xxx.xxx (54.xxx.xxx.xxx)' can't be established.\n      RSA key fingerprint is xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx.\n      Are you sure you want to continue connecting (yes/no)?\n\n\n\n\u5165\u529b\nyes\n\n\n\n\u7d50\u679c(\u4f8b)\n      Warning: Permanently added '54.xxx.xxx.xxx' (RSA) to the list of known hosts.\n\n             __|  __|_  )\n             _|  (     /   Amazon Linux AMI\n            ___|\\___|___|\n\n      https://aws.amazon.com/amazon-linux-ami/2015.09-release-notes/\n      3 package(s) needed for security, out of 28 available\n      Run \"sudo yum update\" to apply all updates.\n      [ec2-user@ip-172-31-21-47 ~]$\n\n\n\n1.8. Inspector\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u516c\u5f0f\u30b5\u30a4\u30c8\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\nwget https://s3-us-west-2.amazonaws.com/inspector.agent.us-west-2/latest/install\n\n\n\n\u7d50\u679c(\u4f8b)\n      --2015-11-26 12:41:58--  https://s3-us-west-2.amazonaws.com/inspector.agent.us-west-2/latest/install\n      s3-us-west-2.amazonaws.com \u3092DNS\u306b\u554f\u3044\u3042\u308f\u305b\u3066\u3044\u307e\u3059... 54.231.176.46\n      s3-us-west-2.amazonaws.com|54.231.176.46|:443 \u306b\u63a5\u7d9a\u3057\u3066\u3044\u307e\u3059... \u63a5\u7d9a\u3057\u307e\u3057\u305f\u3002\n      HTTP \u306b\u3088\u308b\u63a5\u7d9a\u8981\u6c42\u3092\u9001\u4fe1\u3057\u307e\u3057\u305f\u3001\u5fdc\u7b54\u3092\u5f85\u3063\u3066\u3044\u307e\u3059... 200 OK\n      \u9577\u3055: 10436 (10K) [binary/octet-stream]\n      `install' \u306b\u4fdd\u5b58\u4e2d\n\n      100%[======================================>] 10,436      --.-K/s \u6642\u9593 0s\n\n      2015-11-26 12:41:58 (22.9 MB/s) - `install' \u3078\u4fdd\u5b58\u5b8c\u4e86 [10436/10436]\n\n\nroot\u6a29\u9650\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\nsudo bash ./install\n\n\n\n\u7d50\u679c(\u4f8b)\n      Validated signature with:\n      Validated package sha256 hash matches expected value.\n      Installing with yum...\n      \u8aad\u307f\u8fbc\u3093\u3060\u30d7\u30e9\u30b0\u30a4\u30f3:priorities, update-motd, upgrade-helper\n      /tmp/inspector.b3nZ9iRz/InspectorAgent-1.0.96.0-100096.x86_64.rpm \u3092\u8abf\u3079\u3066\u3044\u307e\u3059: InspectorAgent-1.0.96.0-100096.x86_64\n      /tmp/inspector.b3nZ9iRz/InspectorAgent-1.0.96.0-100096.x86_64.rpm \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u3068\u3057\u3066\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\n      \u4f9d\u5b58\u6027\u306e\u89e3\u6c7a\u3092\u3057\u3066\u3044\u307e\u3059\n      --> \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u78ba\u8a8d\u3092\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u3002\n      ---> \u30d1\u30c3\u30b1\u30fc\u30b8 InspectorAgent.x86_64 0:1.0.96.0-100096 \u3092 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n      --> \u4f9d\u5b58\u6027\u306e\u51e6\u7406\u3092\u3057\u3066\u3044\u307e\u3059: libpcap \u306e\u30d1\u30c3\u30b1\u30fc\u30b8: InspectorAgent-1.0.96.0-100096.x86_64\n      --> \u4f9d\u5b58\u6027\u306e\u51e6\u7406\u3092\u3057\u3066\u3044\u307e\u3059: libpcap.so.1()(64bit) \u306e\u30d1\u30c3\u30b1\u30fc\u30b8: InspectorAgent-1.0.96.0-100096.x86_64\n      --> \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u78ba\u8a8d\u3092\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u3002\n      ---> \u30d1\u30c3\u30b1\u30fc\u30b8 libpcap.x86_64 14:1.4.0-1.20130826git2dbcaa1.10.amzn1 \u3092 \u30a4\u30f3\u30b9 \u30c8\u30fc\u30eb\n      --> \u4f9d\u5b58\u6027\u89e3\u6c7a\u3092\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002\n\n      \u4f9d\u5b58\u6027\u3092\u89e3\u6c7a\u3057\u307e\u3057\u305f\n\n      ================================================================================\n       Package  \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u30fc\n                       \u30d0\u30fc\u30b8\u30e7\u30f3        \u30ea\u30dd\u30b8\u30c8\u30ea\u30fc                            \u5bb9\u91cf\n      ================================================================================\n      \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4e2d:\n       InspectorAgent\n                x86_64 1.0.96.0-100096   /InspectorAgent-1.0.96.0-100096.x86_64  19 M\n      \u4f9d\u5b58\u6027\u95a2\u9023\u3067\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u3057\u307e\u3059:\n       libpcap  x86_64 14:1.4.0-1.20130826git2dbcaa1.10.amzn1\n                                         amzn-main                              144 k\n\n      \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u8981\u7d04\n      ================================================================================\n      \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb  1 \u30d1\u30c3\u30b1\u30fc\u30b8 (+1 \u500b\u306e\u4f9d\u5b58\u95a2\u4fc2\u306e\u30d1\u30c3\u30b1\u30fc\u30b8)\n\n      \u5408\u8a08\u5bb9\u91cf: 19 M\n      \u7dcf\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5bb9\u91cf: 144 k\n      \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5bb9\u91cf: 19 M\n      Downloading packages:\n      libpcap-1.4.0-1.20130826git2dbcaa1.10.amzn1.x86_64.rpm   | 144 kB     00:00\n      Running transaction check\n      Running transaction test\n      Transaction test succeeded\n      Running transaction\n        \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4e2d          : 14:libpcap-1.4.0-1.20130826git2dbcaa1.10.amzn   1/2\n        \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4e2d          : InspectorAgent-1.0.96.0-100096.x86_64           2/2\n      crond ???????????: [  OK  ]\n        \u691c\u8a3c\u4e2d                  : InspectorAgent-1.0.96.0-100096.x86_64           1/2\n        \u691c\u8a3c\u4e2d                  : 14:libpcap-1.4.0-1.20130826git2dbcaa1.10.amzn   2/2\n\n      \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb:\n        InspectorAgent.x86_64 0:1.0.96.0-100096\n\n      \u4f9d\u5b58\u6027\u95a2\u9023\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f:\n        libpcap.x86_64 14:1.4.0-1.20130826git2dbcaa1.10.amzn1\n\n      \u5b8c\u4e86\u3057\u307e\u3057\u305f!\n      \u8aad\u307f\u8fbc\u3093\u3060\u30d7\u30e9\u30b0\u30a4\u30f3:priorities, update-motd, upgrade-helper\n      \u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb /var/run/yum.pid \u304c\u5b58\u5728\u3057\u307e\u3059: PID 2589 \u3068\u3057\u3066\u5225\u306b\u5b9f\u884c\u3055\u308c\u3066\u3044\u307e \u3059\u3002\n      Another app is currently holding the yum lock; waiting for it to exit...\n       \u4ed6\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3: yum\n         \u30e1\u30e2\u30ea\u30fc:  35 M RSS (244 MB VSZ)\n          \u958b\u59cb   : Thu Nov 26 05:03:34 2015 - 00:01 \u79d2\u7d4c\u904e\n          \u72b6\u614b   : \u5b9f\u884c\u4e2d\u3001PID: 2589\n      /tmp/inspector.b3nZ9iRz/InspectorAgent-1.0.96.0-100096.x86_64.rpm \u3092\u8abf\u3079\u3066\u3044\u307e\u3059: InspectorAgent-1.0.96.0-100096.x86_64\n      \u30a8\u30e9\u30fc: \u4f55\u3082\u3057\u307e\u305b\u3093\n\n      Notice:\n      By installing the Amazon Inspector Agent, you agree that your use is subject to the terms of your existing\n      AWS Customer Agreement or other agreement with Amazon Web Services, Inc. or its affiliates governing your\n      use of AWS services. You may not install and use the Amazon Inspector Agent unless you have an account in\n      good standing with AWS.\n      *  *  *\n      Current running agent reports version as: 1.0.96.0\n      This install script was created to install agent version: 1.0.96.0\n      In most cases, these version numbers should be the same.\n      HTTP/1.1 200 OK\n      x-amz-id-2: h1O/eI8QEiOnWHehL+UMGOzOwxf7L9vfZamw+n7g8a0FtF155FJRV4XdytcM1X0LrcgPckGRUmg=\n      x-amz-request-id: 777F555AA4F364F6\n      Date: Thu, 26 Nov 2015 05:03:41 GMT\n      Last-Modified: Wed, 11 Nov 2015 18:27:01 GMT\n      ETag: \"7861805d4dfb5cf7e2d2972cea567ca7\"\n      Accept-Ranges: bytes\n      Content-Type: binary/octet-stream\n      Content-Length: 10998\n      Server: AmazonS3\n\n\n\n1.9. nginx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u30b5\u30f3\u30d7\u30eb\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u3057\u3066nginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\nsudo yum -y install nginx ; sudo chkconfig nginx on\n\n\n\n\u7d50\u679c(\u4f8b)\n      \u8aad\u307f\u8fbc\u3093\u3060\u30d7\u30e9\u30b0\u30a4\u30f3:priorities, update-motd, upgrade-helper\n      amzn-main/latest                                         | 2.1 kB     00:00\n      \u4f9d\u5b58\u6027\u306e\u89e3\u6c7a\u3092\u3057\u3066\u3044\u307e\u3059\n      --> \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u78ba\u8a8d\u3092\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u3002\n      ---> \u30d1\u30c3\u30b1\u30fc\u30b8 nginx.x86_64 1:1.8.0-10.25.amzn1 \u3092 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n      \uff08\u4e2d\u7565\u3002\u304b\u306a\u308a\u306e\u884c\u6570\u304c\u6d41\u308c\u307e\u3059\uff09\n\n      \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb:\n        nginx.x86_64 1:1.8.0-10.25.amzn1\n\n      \u4f9d\u5b58\u6027\u95a2\u9023\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f:\n        GeoIP.x86_64 0:1.4.8-1.5.amzn1             gd.x86_64 0:2.0.35-11.10.amzn1\n        gperftools-libs.x86_64 0:2.0-11.5.amzn1    libXpm.x86_64 0:3.5.10-2.9.amzn1\n        libunwind.x86_64 0:1.1-10.8.amzn1\n\n      \u5b8c\u4e86\u3057\u307e\u3057\u305f!\n\n\n\n1.10. \u518d\u8d77\u52d5\n\u518d\u8d77\u52d5\u3057\u306a\u3044\u3068\u6709\u52b9\u306b\u306a\u3089\u306a\u3044\u306e\u3067\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\nsudo reboot\n\n\n\n\u7d50\u679c(\u4f8b)\n      Broadcast message from ec2-user@ip-172-31-21-47\n              (/dev/pts/0) at 5:10 ...\n\n      The system is going down for reboot NOW!\n      Connection to 54.xxx.xxx.xxx closed by remote host.\n      Connection to 54.xxx.xxx.xxx closed.\n\n\n\u4ee5\u4e0a\u3067\u8a3a\u65ad\u7528EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f\u6e96\u5099\u5b8c\u4e86\u3067\u3059\u3002\n\uff08\u591a\u5206\u52d5\u304f\u306e\u3067\u7701\u7565\u3057\u307e\u3059\u304c\u3001\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3084nginx\u306e\u52d5\u4f5c\u78ba\u8a8d\u306f\u9069\u5b9c\u884c\u3063\u3066\u304f\u3060\u3055\u3044\uff09\n\n2. IAM\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n\n2.1. \u30ed\u30fc\u30eb\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u4f5c\u6210\n\u3082\u3046\u8a3a\u65ad\u7528EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3053\u3068\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u518d\u3073\u7ba1\u7406\u7528\u7aef\u672b\u304b\u3089\u4f5c\u696d\u3092\u7d9a\u3051\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\nIAM_ROLE_NAME=\"inspector\"\nFILE_ROLE_DOC=\"iam-role-${IAM_ROLE_NAME}.json\" && echo ${FILE_ROLE_DOC}\n\n\n\n\u7d50\u679c\n      iam-role-inspector.json\n\n\n\n\u30b3\u30de\u30f3\u30c9\ncat << EOF > ${FILE_ROLE_DOC}\n{\n          \"Version\": \"2012-10-17\",\n          \"Statement\": [\n                  {\n                      \"Action\": \"sts:AssumeRole\",\n                      \"Principal\": {\n                          \"Service\": \"inspector.amazonaws.com\"\n                      },\n                      \"Effect\": \"Allow\",\n                      \"Sid\": \"\"\n                  }\n          ]\n}\nEOF\n\n\nJSON\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u58ca\u308c\u3066\u306a\u3044\u304b\u5fc5\u305a\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\njsonlint -q ${FILE_ROLE_DOC}\n\n\n\n2.2. \u30ed\u30fc\u30eb\u30dd\u30ea\u30b7\u30fc\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\nFILE_ROLE_POLICY_DOC=\"iam-role-${IAM_ROLE_NAME}-policy.json\" && echo ${FILE_ROLE_POLICY_DOC}\n\n\n\n\u7d50\u679c\n      iam-role-inspector-policy.json\n\n\n\n\u30b3\u30de\u30f3\u30c9\ncat << EOF > ${FILE_ROLE_POLICY_DOC}\n{\n        \"Version\": \"2012-10-17\",\n        \"Statement\": [\n          {\n            \"Action\": [\n              \"ec2:Describe*\"\n            ],\n            \"Effect\": \"Allow\",\n            \"Resource\": \"*\"\n          }\n        ]\n}\nEOF\n\n\nJSON\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u58ca\u308c\u3066\u306a\u3044\u304b\u5fc5\u305a\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\njsonlint -q ${FILE_ROLE_POLICY_DOC}\n\n\n\n2.3. \u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n          IAM_ROLE_NAME: ${IAM_ROLE_NAME}\n          FILE_ROLE_DOC: ${FILE_ROLE_DOC}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws iam create-role --role-name ${IAM_ROLE_NAME} --assume-role-policy-document file://${FILE_ROLE_DOC}\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n          \"Role\": {\n              \"AssumeRolePolicyDocument\": {\n                  \"Version\": \"2012-10-17\",\n                  \"Statement\": [\n                      {\n                          \"Action\": \"sts:AssumeRole\",\n                          \"Sid\": \"\",\n                          \"Effect\": \"Allow\",\n                          \"Principal\": {\n                              \"Service\": \"inspector.amazonaws.com\"\n                          }\n                      }\n                  ]\n              },\n              \"RoleId\": \"AROAIJJMSMXYT5ZXYUZCM\",\n              \"CreateDate\": \"2015-11-26T01:57:27.629Z\",\n              \"RoleName\": \"inspector\",\n              \"Path\": \"/\",\n              \"Arn\": \"arn:aws:iam::454200CLI555:role/inspector\"\n          }\n      }\n\n\n\n2.4. \u30ed\u30fc\u30eb\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws iam get-role --role-name ${IAM_ROLE_NAME}\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n          \"Role\": {\n              \"AssumeRolePolicyDocument\": {\n                  \"Version\": \"2012-10-17\",\n                  \"Statement\": [\n                      {\n                          \"Action\": \"sts:AssumeRole\",\n                          \"Principal\": {\n                              \"Service\": \"inspector.amazonaws.com\"\n                          },\n                          \"Effect\": \"Allow\",\n                          \"Sid\": \"\"\n                      }\n                  ]\n              },\n              \"RoleId\": \"AROAIJJMSMXYT5ZXYUZCM\",\n              \"CreateDate\": \"2015-11-26T01:57:27Z\",\n              \"RoleName\": \"inspector\",\n              \"Path\": \"/\",\n              \"Arn\": \"arn:aws:iam::454200CLI555:role/inspector\"\n          }\n      }\n\n\n\n2.5. \u30ed\u30fc\u30eb\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\nIAM_ROLE_POLICY_NAME=\"${IAM_ROLE_NAME}-policy\"\n\n\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n          IAM_ROLE_NAME:        ${IAM_ROLE_NAME}\n          IAM_ROLE_POLICY_NAME: ${IAM_ROLE_POLICY_NAME}\n          FILE_ROLE_POLICY_DOC: ${FILE_ROLE_POLICY_DOC}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws iam put-role-policy --role-name ${IAM_ROLE_NAME} --policy-name ${IAM_ROLE_POLICY_NAME} --policy-document file://${FILE_ROLE_POLICY_DOC}\n\n\n\n\u7d50\u679c(\u4f8b)\n      (\u623b\u308a\u5024\u306a\u3057)\n\n\n\n2.6. \u30ed\u30fc\u30eb\u30dd\u30ea\u30b7\u30fc\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws iam get-role-policy --role-name ${IAM_ROLE_NAME} --policy-name ${IAM_ROLE_POLICY_NAME}\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n          \"RoleName\": \"inspector\",\n          \"PolicyDocument\": {\n              \"Version\": \"2012-10-17\",\n              \"Statement\": [\n                  {\n                      \"Action\": [\n                          \"ec2:Describe*\"\n                      ],\n                      \"Resource\": \"*\",\n                      \"Effect\": \"Allow\"\n                  }\n              ]\n          },\n          \"PolicyName\": \"inspector-policy\"\n      }\n\n\n\n2.7. IAM\u30ed\u30fc\u30eb\u306eARN\u53d6\u5f97\n\n\u30b3\u30de\u30f3\u30c9\nIAM_ROLE_ARN=`aws iam get-role --role-name ${IAM_ROLE_NAME} --query 'Role.Arn' --output text` && echo ${IAM_ROLE_ARN}\n\n\n\n\u7d50\u679c(\u4f8b)\n      arn:aws:iam::454200CLI555:role/inspector\n\n\n\n3. Inspector\u306e\u69cb\u7bc9\n\n3.1. Inspector\u3078\u306eIAM Role\u8a2d\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\naws inspector register-cross-account-access-role --role-arn ${IAM_ROLE_ARN}\n\n\n\n\u7d50\u679c\n      {\n          \"message\": \"Cross-account access role registered successfully\"\n      }\n\n\n\n3.2. Resource Group\u306e\u4f5c\u6210\n\u8a3a\u65ad\u5bfe\u8c61\u3068\u3059\u308bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u4ed8\u4e0e\u3057\u305f\u30bf\u30b0\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\u9805\u756a1.5.\u3068\u540c\u3058\u30bf\u30b0\u306e\u5185\u5bb9\u3067\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\nRESOURCE_GROUP_ARN=`aws inspector create-resource-group --resource-group-tags \"[{\\\"key\\\":\\\"${TAG_KEY}\\\",\\\"values\\\":[\\\"${TAG_VALUE}\\\"]}]\" --output text` && echo ${RESOURCE_GROUP_ARN}\n\n\n\n\u7d50\u679c(\u4f8b)\n      arn:aws:inspector:us-west-2:454200CLI555:resourcegroup/0-zje554OG\n\n\n\n3.3. Application\u306e\u4f5c\u6210\nResource Group\u3092\u7528\u3044\u3066Application\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\nAPPLICATION_NAME=\"handson\"\nAPPLICATION_ARN=`aws inspector create-application --application-name \"${APPLICATION_NAME}\" --resource-group-arn ${RESOURCE_GROUP_ARN} --output text` && echo ${APPLICATION_ARN}\n\n\n\n\u7d50\u679c(\u4f8b)\n      arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn\n\n\n\n3.4. \u5b9f\u884c\u3057\u305f\u3044\u8a3a\u65ad\u306e\u9078\u629e\nRules Packages \u4e00\u89a7\u304b\u3089\u3069\u306e\u8a3a\u65ad\u3092\u884c\u3046\u304b\u6c7a\u3081\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws inspector list-rules-packages\n\n\n\n\u7d50\u679c\n      {\n          \"rulesPackageArnList\": [\n              \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-11B9DBXp\",\n              \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-LfLjwILF\",\n              \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-LzUxcT5A\",\n              \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-Pv9mELS9\",\n              \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-X1KXtawP\",\n              \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-ldNfZf6r\"\n          ]\n      }\n\n\n\u306a\u3093\u3068CLI\u3067\u306farn\u4e00\u89a7\u304c\u51fa\u529b\u3055\u308c\u308b\u306e\u307f\u3067\u3001\u5185\u5bb9\u4e00\u89a7\u306f\u51fa\u306a\u3044\u306e\u3067\u3059\u3002\ndescribe-rules-package\u30b3\u30de\u30f3\u30c9\u3067\uff11\u3064\u305a\u3064arn\u3092\u6307\u5b9a\u3057\u3066\u5185\u5bb9\u3092\u78ba\u8a8d\u3059\u308b\u5fc5\u8981\u304c\u6709\u308a\u307e\u3059\u3002\u3068\u308a\u3048\u3042\u305a\uff11\u756a\u4e0b\u3092\u3002\n\n\u30b3\u30de\u30f3\u30c9\nRULES_PACKAGE_ARN=\"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-ldNfZf6r\"\naws inspector describe-rules-package --rules-package-arn ${RULES_PACKAGE_ARN}\n\n\n\n\u7d50\u679c\n      {\n          \"rulesPackage\": {\n              \"description\": {\n                  \"parameters\": [],\n                  \"key\": {\n                      \"id\": \"rule package description id\",\n                      \"facility\": \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-ldNfZf6r\"\n                  }\n              },\n              \"rulesPackageName\": \"PCI DSS 3.0 Readiness\",\n              \"rulesPackageArn\": \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-ldNfZf6r\",\n              \"version\": \"1.0\",\n              \"provider\": \"Amazon Web Services, Inc.\"\n          }\n      }\n\n\nPCI DSS 3.0 \u6e96\u62e0\u304b\u3069\u3046\u304b\u8a3a\u65ad\u3059\u308b\u3082\u306e\u3060\u305d\u3046\u3067\u3002\u5acc\u306a\u97ff\u304d\u3067\u3059\u304c\u4eca\u56de\u306f\u3053\u308c\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\n3.5. Assessment\u306e\u4f5c\u6210\n\u8a3a\u65ad\u3092\u884c\u3046\u30eb\u30fc\u30eb(Assessment)\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u5b9a\u671f\u5b9f\u884c\u3059\u308b\u8a3a\u65ad\u9593\u9694\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n900\u79d2(15\u5206)\u304c\u6700\u77ed\u3067\u3053\u3053\u3067\u306f900\u79d2\u3068\u3057\u307e\u3059\u304c\u983b\u5ea6\u304c\u77ed\u3051\u308c\u3070\u305d\u308c\u3060\u3051\u8cbb\u7528\u304c\u304b\u3055\u3080\u306e\u3067\u3054\u5229\u7528\u306f\u8a08\u753b\u7684\u306b\u3002\n\n\u30b3\u30de\u30f3\u30c9\nDURATION=900\nASSESSMENT_NAME=\"handson\"\nASSESSMENT_ARN=`aws inspector create-assessment --application-arn ${APPLICATION_ARN} --assessment-name ${ASSESSMENT_NAME} --duration-in-seconds ${DURATION} --output text` && echo ${ASSESSMENT_ARN}\n\n\n\n\u7d50\u679c(\u4f8b)\n      arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-ScIKJCEp\n\n\nAssessment\u306b\u5148\u307b\u3069\u9078\u3093\u3060Rules Package\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws inspector attach-assessment-and-rules-package --assessment-arn ${ASSESSMENT_ARN} --rules-package-arn ${RULES_PACKAGE_ARN}\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n          \"message\": \"Successfully attached arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-ScIKJCEp to arn:aws:inspector:us-west-2:758058086616:rulespackage/0-ldNfZf6r\"\n      }\n\n\n\n3.6. \u8a3a\u65ad\u306e\u958b\u59cb\nAssessment\u306e\u30c7\u30fc\u30bf\u53ce\u96c6\u3092\u958b\u59cb\u3055\u305b\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws inspector start-data-collection --assessment-arn ${ASSESSMENT_ARN}\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n          \"message\": \"Successfully started data collection for assessment with ID: arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-6mIhKNCv\"\n      }\n\n\n\u7d9a\u3044\u3066Assessment\u306e\u5b9f\u884c\n\n\u30b3\u30de\u30f3\u30c9\naws inspector run-assessment --assessment-arn ${ASSESSMENT_ARN} --run-name ${RUN_NAME}\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n          \"runArn\": \"arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-ScIKJCEp/run/0-WKlfMrre\"\n      }\n\n\n\u8a3a\u65ad\u5b8c\u4e86\u307e\u3067\uff11\uff15\u5206\u304b\u304b\u308a\u307e\u3059\u3002\n\u30d3\u30fc\u30eb\u3092\u304a\u304b\u308f\u308a\u3057\u3066\u3086\u3063\u304f\u308a\u98f2\u307f\u306a\u304c\u3089\u5f85\u3061\u307e\u3057\u3087\u3046\u3002\n\n4. \u8a3a\u65ad\u7d50\u679c\u306e\u78ba\u8a8d\n\n4.1. \u7d50\u679c\u4e00\u89a7\u306e\u8868\u793a\n\n\u30b3\u30de\u30f3\u30c9\naws inspector list-findings\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n          \"findingArnList\": [\n              \"arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ/finding/null-0bmtREUN\",\n              \"arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ/finding/null-AoYzKyUy\",\n              \"arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ/finding/null-EJnIeL9F\",\n              \"arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ/finding/null-HnUxQBpi\",\n              \"arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ/finding/null-NbTqUn34\",\n              \"arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ/finding/null-UfR5otmV\",\n              \"arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ/finding/null-X3Ff03Ny\"\n          ]\n      }\n\n\nCLI\u3067\u3059\u304b\u3089\u308f\u304b\u308a\u3084\u3059\u304f\u8868\u793a\u3055\u308c\u308b\u308f\u3051\u304c\u3042\u308a\u307e\u305b\u3093\u3002\n\u7d50\u679c\u306earn\u4e00\u89a7\u304c\u51fa\u529b\u3055\u308c\u308b\u306e\u3067\u3053\u308c\u3089\u3092\uff11\u3064\u305a\u3064\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u3066\u3044\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n4.2. \u7d50\u679c\u306e\u5185\u5bb9\u78ba\u8a8d\n\u7d50\u679c\u4e00\u89a7\u306eFinding arn\u3092\u6307\u5b9a\u3057\u3066\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\nFINDING_ARN=\"arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ/finding/null-0bmtREUN\"\naws inspector describe-finding --finding-arn ${FINDING_ARN}\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n          \"finding\": {\n              \"runArn\": \"arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ\",\n              \"severity\": \"Informational\",\n              \"recommendation\": {\n                  \"parameters\": [\n                      {\n                          \"name\": \"INSECURE_PROTOCOL_LIST\",\n                          \"value\": \"www-http (port 80, World Wide Web HTTP), smtp (port 25, Simple Mail Transfer)\"\n                      },\n                      {\n                          \"name\": \"INSTANCE_ID\",\n                          \"value\": \"i-ba7b3a7e\"\n                      }\n                  ],\n                  \"key\": {\n                      \"id\": \"PCI DSS Requirement 1.1.6 - Use Secure Protocols-recommendation\",\n                      \"facility\": \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-ldNfZf6r\"\n                  }\n              },\n              \"rulesPackageArn\": \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-ldNfZf6r\",\n              \"userAttributes\": [],\n              \"findingArn\": \"arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ/finding/null-0bmtREUN\",\n              \"ruleName\": \"PCI DSS Requirement 1.1.6 - Use Secure Protocols\",\n              \"finding\": {\n                  \"parameters\": [\n                      {\n                          \"name\": \"INSECURE_PROTOCOL_LIST\",\n                          \"value\": \"www-http (port 80, World Wide Web HTTP), smtp (port 25, Simple Mail Transfer)\"\n                      },\n                      {\n                          \"name\": \"INSTANCE_ID\",\n                          \"value\": \"i-ba7b3a7e\"\n                      }\n                  ],\n                  \"key\": {\n                      \"id\": \"PCI DSS Requirement 1.1.6 - Use Secure Protocols-finding\",\n                      \"facility\": \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-ldNfZf6r\"\n                  }\n              },\n              \"attributes\": [\n                  {\n                      \"value\": \"www-http (port 80, World Wide Web HTTP), smtp (port 25, Simple Mail Transfer)\",\n                      \"key\": \"INSECURE_PROTOCOL_LIST\"\n                  },\n                  {\n                      \"value\": \"i-ba7b3a7e\",\n                      \"key\": \"INSTANCE_ID\"\n                  }\n              ],\n              \"agentId\": \"i-ba7b3a7e\",\n              \"description\": {\n                  \"parameters\": [\n                      {\n                          \"name\": \"INSECURE_PROTOCOL_LIST\",\n                          \"value\": \"www-http (port 80, World Wide Web HTTP), smtp (port 25, Simple Mail Transfer)\"\n                      },\n                      {\n                          \"name\": \"INSTANCE_ID\",\n                          \"value\": \"i-ba7b3a7e\"\n                      }\n                  ],\n                  \"key\": {\n                      \"id\": \"PCI DSS Requirement 1.1.6 - Use Secure Protocols-description\",\n                      \"facility\": \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-ldNfZf6r\"\n                  }\n              }\n          }\n      }\n\n\n\u30bb\u30ad\u30e5\u30a2\u3067\u306a\u3044\u30d7\u30ed\u30c8\u30b3\u30eb(HTTP,SMTP)\u304c\u4f7f\u308f\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u6307\u6458\u3055\u308c\u3066\u3044\u307e\u3059\u306d\u3002\n\u3053\u308c\u3089\u306fPCI DSS 3.0\u3067\u306f\u4f7f\u7528\u304c\u7981\u6b62\u3055\u308c\u3066\u3044\u307e\u3059\u304b\u3089\u305d\u306e\u901a\u308a\u3067\u3054\u3056\u3044\u307e\u3059\u3002\n\u7d50\u679c\u4e00\u89a7\u306earn\u6570\u3060\u3051\u3053\u308c\u3092\u7e70\u308a\u8fd4\u3057\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n\n5. \u307e\u3068\u3081\nInspector\u306f\u8a2d\u5b9a\u3057\u305f\u9593\u9694\u3067\u5b9a\u671f\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\u8a3a\u65ad\u7d50\u679c\u3092\u3082\u3068\u306b\u5bfe\u7b56\u3092\u884c\u3046\u3068\u3001\u6b21\u56de\u8a3a\u65ad\u3067\u6307\u6458\u3055\u308c\u306a\u304f\u306a\u308a\u307e\u3059\u3002\nFindings\u304c\u4f55\u3082\u51fa\u529b\u3055\u308c\u306a\u304f\u306a\u308b\u72b6\u614b\u3092\u76ee\u6307\u3059\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\u3053\u308c\u3067\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u304c\u5411\u4e0a\u3059\u308b\u3068\u826f\u3044\u3067\u3059\u306d\u3002\n\n6. Inspector\u5168\u524a\u9664\u306e\u65b9\u6cd5\n\u4f7f\u3044\u7d9a\u3051\u308b\u5834\u5408\u306f\u5f53\u7136\u3053\u306e\u9805\u76ee\u306f\u5fc5\u8981\u6709\u308a\u307e\u305b\u3093\u3002\n\u4ee5\u4e0b\u306f\u524a\u9664\u65b9\u6cd5\u3067\u3059\u3002\u57fa\u672c\u7684\u306b\u69cb\u7bc9\u3057\u305f\u9006\u306e\u9806\u5e8f\u306b\u524a\u9664\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n6.1. Run\u306e\u524a\u9664\nRun\u4e00\u89a7\u3067\u52d5\u4f5c\u4e2d\u306eRun arn\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws inspector list-runs\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n          \"runArnList\": [\n              \"arn:aws:inspector:us-west-2:454214976215:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ\"\n          ]\n      }\n\n\n\u53d6\u5f97\u3057\u305farn\u3092\u6307\u5b9a\u3057\u3066Run\u3092\u524a\u9664\n\n\u30b3\u30de\u30f3\u30c9\naws inspector delete-run --run-arn arn:aws:inspector:us-west-2:454214976215:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n          \"message\": \"Successfully deleted run arn:aws:inspector:us-west-2:454214976215:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ\"\n      }\n\n\n\n6.2. Assessment\u306e\u524a\u9664\nAssessment\u4e00\u89a7\u304b\u3089Assessment arn\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws inspector list-assessments\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n          \"assessmentArnList\": [\n              \"arn:aws:inspector:us-west-2:454214976215:application/0-q3ClefUn/assessment/0-6mIhKNCv\"\n          ]\n      }\n\n\n\u53d6\u5f97\u3057\u305farn\u3092\u6307\u5b9a\u3057\u3066Assessment\u3092\u524a\u9664\n\n\u30b3\u30de\u30f3\u30c9\naws inspector delete-assessment --assessment-arn arn:aws:inspector:us-west-2:454214976215:application/0-q3ClefUn/assessment/0-6mIhKNCv\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n          \"message\": \"Successfully deleted assessment arn:aws:inspector:us-west-2:454214976215:application/0-q3ClefUn/assessment/0-6mIhKNCv\"\n      }\n\n\n\n6.3. Application\u306e\u524a\u9664\nApplication\u4e00\u89a7\u304b\u3089Application arn\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws inspector list-applications\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n          \"applicationArnList\": [\n              \"arn:aws:inspector:us-west-2:454214976215:application/0-q3ClefUn\"\n          ]\n      }\n\n\n\u53d6\u5f97\u3057\u305farn\u3092\u6307\u5b9a\u3057\u3066Application\u3092\u524a\u9664\n\n\u30b3\u30de\u30f3\u30c9\naws inspector delete-application --application-arn arn:aws:inspector:us-west-2:454214976215:application/0-q3ClefUn\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n          \"message\": \"Successfully deleted application arn:aws:inspector:us-west-2:454214976215:application/0-q3ClefUn\"\n      }\n\n\n\n6.4. \u30d0\u30b0\uff1f\n\u73fe\u5728Preview\u3060\u304b\u3089\u3067\u3057\u3087\u3046\u304b\u3001Resource Group\u3092\u524a\u9664\u3059\u308b\u65b9\u6cd5\u304c\u3042\u308a\u307e\u305b\u3093\u3002\n\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u306fResource Group\u306f\u898b\u3048\u305aApplication\u306e\u5185\u90e8\u3067\u5236\u5fa1\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u3067\u3001Application\u3092\u524a\u9664\u3059\u308b\u3068\u5185\u90e8\u51e6\u7406\u3067\u540c\u6642\u306b\u524a\u9664\u3055\u308c\u307e\u3059\u304cCLI\u3067\u306f\u524a\u9664\u3067\u304d\u307e\u305b\u3093\u3002\n\u653e\u7f6e\u3057\u3066\u3082\u8cbb\u7528\u306f\u767a\u751f\u3057\u306a\u3044\u3057\u7121\u8996\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\n6.5. \u305d\u306e\u4ed6\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9, IAM\u30ed\u30fc\u30eb\u306a\u3069\u305d\u306e\u4ed6\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u524a\u9664\u306b\u3064\u3044\u3066\u306f\u672c\u984c\u304b\u3089\u305d\u308c\u307e\u3059\u306e\u3067\u5272\u611b\u3057\u307e\u3059\u3002\n\n\u5b8c\u4e86\nInspector\u306f\u7121\u6599\u67a0\u304c\u7121\u3044\u306e\u3067\u3001\u30cf\u30f3\u30ba\u30aa\u30f3\u5b8c\u4e86\u5f8c\u306f\u8ab2\u91d1\u3092\u907f\u3051\u305f\u3044\u5834\u5408\u306f\u524a\u9664\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nAmazon Inspector\u3068\u306f\n======\nre:Invent\u3067\u767a\u8868\u306b\u306a\u3063\u305f\u65b0\u30b5\u30fc\u30d3\u30b9\u3067\u3001\u57f7\u7b46\u73fe\u5728\u306fPreview\u3067 us-west-2 (\u30aa\u30ec\u30b4\u30f3)\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u3057\u304b\u3042\u308a\u307e\u305b\u3093\u3002\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u4ed5\u8fbc\u3080\u3053\u3068\u3067\u3001OS\u3084\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u8a2d\u5b9a\u3057\u305f\u30eb\u30fc\u30eb\u306b\u6cbf\u3063\u3066\u3044\u308b\u304b\u8a3a\u65ad\u3092\u884c\u3063\u3066\u304f\u308c\u308b\u30b5\u30fc\u30d3\u30b9\u3067\u3059\u3002\nAWS CLI\u3092\u5229\u7528\u3057\u3066\u3001\u305d\u3093\u306aAWS Inspector\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\n\u524d\u63d0\u6761\u4ef6\n========\n\n\u30c7\u30d5\u30a9\u30eb\u30c8VPC\u306e\u5b58\u5728\n--------------\n\n\u30c7\u30d5\u30a9\u30eb\u30c8VPC\u304c\u5b58\u5728\u3059\u308b\u3053\u3068\u3002\n\n\nInspector\u3078\u306e\u6a29\u9650\n--------------\n\nInspector\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\n\nEC2\u3078\u306e\u6a29\u9650\n----------\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8d77\u52d5\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\n\nAWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n-------------------\n\n\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\n* AWS CLI 1.9.9\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws --version\n```\n```text:\u7d50\u679c(\u4f8b):\n      aws-cli/1.9.9 Python/2.6.6 Linux/2.6.32 botocore/1.3.9\n```\n\n0. \u4e8b\u524d\u4f5c\u696d\n===========\n\n\n0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u6c7a\u5b9a\n---------------------\n\nInspector\u306f\u73fe\u5728Preview\u3067us-west-2(\u30aa\u30ec\u30b4\u30f3)\u306b\u3057\u304b\u306a\u3044\u306e\u3067\u30aa\u30ec\u30b4\u30f3\u306b\u3057\u307e\u3059\u3002\n(\u30ab\u30ec\u30f3\u30c8\u30e6\u30fc\u30b6\u304c\u5229\u7528\u3059\u308b\u30ab\u30ec\u30f3\u30c8\u30ea\u30fc\u30b8\u30e7\u30f3\u3082\u5207\u308a\u5909\u308f\u308a\u307e\u3059\u3002)\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nexport AWS_DEFAULT_REGION='us-west-2'\n```\n\n0.2. \u5909\u6570\u306e\u78ba\u8a8d\n---------------\n\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3068\u30ea\u30fc\u30b8\u30e7\u30f3\u304c\u60f3\u5b9a\u306e\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws configure list\n```\n```text:\u7d50\u679c(\u4f8b):\n            Name                    Value             Type    Location\n            ----                    -----             ----    --------\n         profile                <not set>             None    None\n      access_key     ****************M73Q shared-credentials-file\n      secret_key     ****************YWg/ shared-credentials-file\n          region                us-west-2              env    AWS_DEFAULT_REGION\n```\n\n0.3. AWS\u30a2\u30ab\u30a6\u30f3\u30c8ID\u306e\u53d6\u5f97\n--------------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nAWS_ID=$( aws iam get-user --query 'User.Arn' --output text | sed 's/^.*:://' | sed 's/:.*$//' ) && echo ${AWS_ID}\n```\n```text:\u7d50\u679c(\u4f8b):\n      454200CLI555\n```\n\n\n1. \u8a3a\u65ad\u7528EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6e96\u5099\n===========\n\n1.1. VPCID\u306e\u53d6\u5f97\n-----------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nVPC_ID=`aws ec2 describe-vpcs --filters Name=isDefault,Values=true --query 'Vpcs[].VpcId' --output text` && echo ${VPC_ID}\n```\n```text:\u7d50\u679c(\u4f8b):\n      vpc-xxxxxxxx\n```\n\n1.2. \u30ad\u30fc\u30da\u30a2\u306e\u4f5c\u6210\n-----------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nEC2_KEY_NAME=\"handson\" && echo ${EC2_KEY_NAME}\nFILE_SSH_KEY=\"${HOME}/.ssh/${EC2_KEY_NAME}.pem\" && echo ${FILE_SSH_KEY}\naws ec2 create-key-pair --key-name ${EC2_KEY_NAME} --query 'KeyMaterial' --output text > ${FILE_SSH_KEY} && cat ${FILE_SSH_KEY} && chmod 600 ${FILE_SSH_KEY}\n```\n```text:\u7d50\u679c(\u4f8b):\n      -----BEGIN RSA PRIVATE KEY-----\n      MIIEogIBAAKCAQEAly2hbGNZKdoInU5W7UkXiIiOPKnNsBvGtJonl6oEE/KPtilnpYwwsE9+R+d0\n      cBoqNYy2QPjSB2VWq8h2Fb7oaZsttGCQ2ULPJMU8q10JBYnAlke+kvyj2LPBuIJtvVTnZ5NokJbc\n      Dh9gN27kFcWYE2099Iu9m3Mz6uPR8c2pzgoSzqapcgn3mtZV7av4mSX//siHhwx8k8RT3dCm+IFR\n      \uff08\u672c\u5f53\u306f\u3082\u3063\u3068\u9577\u3044\uff09\n      oY0qjQ3QLUM9/fbcL+U4mDsiBotbAp70yTFJupREYrA5AoGAS6aP6xl/QW4hS/r1HZZLgbd5uWdn\n      Alcjcxy1fed70YVZDHTZUTTIxRCu/ZedvHQovSgmG+PwZhkvhFd15QtBLfLAjL3W9cE1qhUGIi7S\n      PqRjDB83ivjFRa3fBunC0ebWnCE0E53yzujRZvBPFmAtdDh7nIpevHXJCm0cmZCVuq4=\n      -----END RSA PRIVATE KEY-----\n```\n\n1.3. \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210\n-----------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nSG_NAME=\"handson\"\naws ec2 create-security-group --group-name ${SG_NAME} --description ${SG_NAME} --vpc-id ${VPC_ID}\nSG_ID=`aws ec2 describe-security-groups --filter Name=group-name,Values=${SG_NAME} --query 'SecurityGroups[].GroupId' --output text` && echo ${SG_ID}\n```\n```text:\u7d50\u679c(\u4f8b):\n      {\n          \"GroupId\": \"sg-59c3e63d\"\n      }\n\n      sg-59c3e63d\n```\n\n\u5916\u90e8\u304b\u3089\u306eHTTP\u63a5\u7d9a\u3068SSH\u30ed\u30b0\u30a4\u30f3\u3092\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306b\u8ffd\u52a0\n\uff0812.34.56.789/32 \u306f\u9069\u5b9c\u81ea\u5206\u306e\u30a2\u30c9\u30ec\u30b9\u3078\u66f8\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\uff09\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws ec2 authorize-security-group-ingress --group-id ${SG_ID} --protocol 'tcp' --port 80 --cidr 0.0.0.0/0\naws ec2 authorize-security-group-ingress --group-id ${SG_ID} --protocol 'tcp' --port 22 --cidr 12.34.56.789/32\n```\n```text:\u7d50\u679c(\u4f8b):\n      (\u623b\u308a\u5024\u306a\u3057)\n```\n\n1.4. \u8a3a\u65ad\u8a66\u9a13\u7528EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u69cb\u7bc9\n------------------------\nAMI ID\u306e\u53d6\u5f97:\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nAMI_NAME='amzn-ami-hvm-2015.09.0.x86_64-gp2'\nAMI_ID=`aws ec2 describe-images --filters Name=name,Values=${AMI_NAME} --query 'Images[].ImageId' --output text` && echo ${AMI_ID}\n```\n```text:\u7d50\u679c:\n      ami-9ff7e8af\n```\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5:\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws ec2 run-instances --image-id ${AMI_ID} --associate-public-ip-address --instance-type t2.micro --key-name ${EC2_KEY_NAME} --region ${AWS_DEFAULT_REGION} --security-group-ids ${SG_ID}\n```\n```text:\u7d50\u679c(\u4f8b):\n      {\n          \"OwnerId\": \"454200CLI555\",\n          \"ReservationId\": \"r-a112f757\",\n          \"Groups\": [],\n          \"Instances\": [\n              {\n                  \"Monitoring\": {\n                      \"State\": \"disabled\"\n                  },\n                  \"PublicDnsName\": \"\",\n                  \"RootDeviceType\": \"ebs\",\n                  \"State\": {\n                      \"Code\": 0,\n                      \"Name\": \"pending\"\n                  },\n                  \"EbsOptimized\": false,\n                  \"LaunchTime\": \"2015-11-25T15:05:31.000Z\",\n                  \"PrivateIpAddress\": \"172.31.18.115\",\n                  \"ProductCodes\": [],\n                  \"VpcId\": \"vpc-fd543898\",\n                  \"StateTransitionReason\": \"\",\n                  \"InstanceId\": \"i-3ef4b3fa\",\n                  \"ImageId\": \"ami-9ff7e8af\",\n                  \"PrivateDnsName\": \"ip-172-31-18-115.us-west-2.compute.internal\",\n                  \"KeyName\": \"handson\",\n                  \"SecurityGroups\": [\n                      {\n                          \"GroupName\": \"handson\",\n                          \"GroupId\": \"sg-59c3e63d\"\n                      }\n                  ],\n                  \"ClientToken\": \"\",\n                  \"SubnetId\": \"subnet-8e0870eb\",\n                  \"InstanceType\": \"t2.micro\",\n                  \"NetworkInterfaces\": [\n                      {\n                          \"Status\": \"in-use\",\n                          \"MacAddress\": \"02:99:bc:70:59:33\",\n                          \"SourceDestCheck\": true,\n                          \"VpcId\": \"vpc-fd543898\",\n                          \"Description\": \"\",\n                          \"NetworkInterfaceId\": \"eni-6954d410\",\n                          \"PrivateIpAddresses\": [\n                              {\n                                  \"PrivateDnsName\": \"ip-172-31-18-115.us-west-2.compute.internal\",\n                                  \"Primary\": true,\n                                  \"PrivateIpAddress\": \"172.31.18.115\"\n                              }\n                          ],\n                          \"PrivateDnsName\": \"ip-172-31-18-115.us-west-2.compute.internal\",\n                          \"Attachment\": {\n                              \"Status\": \"attaching\",\n                              \"DeviceIndex\": 0,\n                              \"DeleteOnTermination\": true,\n                              \"AttachmentId\": \"eni-attach-7dc5d676\",\n                              \"AttachTime\": \"2015-11-25T15:05:31.000Z\"\n                          },\n                          \"Groups\": [\n                              {\n                                  \"GroupName\": \"handson\",\n                                  \"GroupId\": \"sg-59c3e63d\"\n                              }\n                          ],\n                          \"SubnetId\": \"subnet-8e0870eb\",\n                          \"OwnerId\": \"454200CLI555\",\n                          \"PrivateIpAddress\": \"172.31.18.115\"\n                      }\n                  ],\n                  \"SourceDestCheck\": true,\n                  \"Placement\": {\n                      \"Tenancy\": \"default\",\n                      \"GroupName\": \"\",\n                      \"AvailabilityZone\": \"us-west-2b\"\n                  },\n                  \"Hypervisor\": \"xen\",\n                  \"BlockDeviceMappings\": [],\n                  \"Architecture\": \"x86_64\",\n                  \"StateReason\": {\n                      \"Message\": \"pending\",\n                      \"Code\": \"pending\"\n                  },\n                  \"RootDeviceName\": \"/dev/xvda\",\n                  \"VirtualizationType\": \"hvm\",\n                  \"AmiLaunchIndex\": 0\n              }\n          ]\n      }\n```\n\n1.5. \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078\u306e\u30bf\u30b0\u4ed8\u3051\n----------------------\nInspector\u306e\u8abf\u67fb\u5bfe\u8c61\u3068\u3059\u308b\u305f\u3081\u306e\u8b58\u5225\u7528\u306bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078\u4efb\u610f\u306e\u30bf\u30b0\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u8a2d\u5b9a\u3057\u305f\u30bf\u30b0\u3092Inspector\u5074\u3067\u3082\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001\u3053\u308c\u304c\u8abf\u67fb\u5bfe\u8c61\u306e\u8b58\u5225\u5b50\u306b\u306a\u308a\u307e\u3059\u3002\nKey\u3092 inspector \u3001Value\u3092 handson \u3068\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nTAG_KEY='inspector'\nTAG_VALUE='handson'\n```\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\u306e\u53d6\u5f97\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nEC2_INSTANCE_ID=`aws ec2 describe-instances --query 'Reservations[].Instances[].InstanceId' --output text` && echo ${EC2_INSTANCE_ID}\n```\n```text:\u7d50\u679c(\u4f8b):\n      i-3ef4b3fa\n```\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30bf\u30b0\u3092\u8a2d\u5b9a\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws ec2 create-tags --resources ${EC2_INSTANCE_ID} --tags Key=\"${TAG_KEY}\",Value=\"${TAG_VALUE}\"\n```\n```text:\u7d50\u679c:\n      (\u623b\u308a\u5024\u306a\u3057)\n```\n\n1.6. \u30d1\u30d6\u30ea\u30c3\u30afIP\u30a2\u30c9\u30ec\u30b9\u306e\u53d6\u5f97\n----------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nEC2_PUBLIC_IP=`aws ec2 describe-instances --instance-id ${EC2_INSTANCE_ID} --query \"Reservations[].Instances[].PublicIpAddress\" --output text` && echo ${EC2_PUBLIC_IP}\n```\n```text:\u7d50\u679c(\u4f8b):\n      54.xxx.xxx.xxx\n```\n\n1.7. SSH\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078\u30ed\u30b0\u30a4\u30f3\n----------------\n\u8d77\u52d5\u5b8c\u4e86\u307e\u3067\u6570\u5206\u304b\u304b\u308a\u307e\u3059\u3002\u3061\u3087\u3063\u3068\u30d3\u30fc\u30eb\u3067\u3082\u98f2\u3093\u3067\u304b\u3089\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3078\u9032\u307f\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nssh -l ec2-user -i ${FILE_SSH_KEY} ${EC2_PUBLIC_IP}\n```\n```text:\u7d50\u679c(\u4f8b):\n      The authenticity of host '54.xxx.xxx.xxx (54.xxx.xxx.xxx)' can't be established.\n      RSA key fingerprint is xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx.\n      Are you sure you want to continue connecting (yes/no)?\n```\n\n```text:\u5165\u529b\nyes\n```\n```text:\u7d50\u679c(\u4f8b):\n      Warning: Permanently added '54.xxx.xxx.xxx' (RSA) to the list of known hosts.\n      \n             __|  __|_  )\n             _|  (     /   Amazon Linux AMI\n            ___|\\___|___|\n      \n      https://aws.amazon.com/amazon-linux-ami/2015.09-release-notes/\n      3 package(s) needed for security, out of 28 available\n      Run \"sudo yum update\" to apply all updates.\n      [ec2-user@ip-172-31-21-47 ~]$\n```\n\n1.8. Inspector\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n---------------------\n\u516c\u5f0f\u30b5\u30a4\u30c8\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nwget https://s3-us-west-2.amazonaws.com/inspector.agent.us-west-2/latest/install\n```\n```text:\u7d50\u679c(\u4f8b):\n      --2015-11-26 12:41:58--  https://s3-us-west-2.amazonaws.com/inspector.agent.us-west-2/latest/install\n      s3-us-west-2.amazonaws.com \u3092DNS\u306b\u554f\u3044\u3042\u308f\u305b\u3066\u3044\u307e\u3059... 54.231.176.46\n      s3-us-west-2.amazonaws.com|54.231.176.46|:443 \u306b\u63a5\u7d9a\u3057\u3066\u3044\u307e\u3059... \u63a5\u7d9a\u3057\u307e\u3057\u305f\u3002\n      HTTP \u306b\u3088\u308b\u63a5\u7d9a\u8981\u6c42\u3092\u9001\u4fe1\u3057\u307e\u3057\u305f\u3001\u5fdc\u7b54\u3092\u5f85\u3063\u3066\u3044\u307e\u3059... 200 OK\n      \u9577\u3055: 10436 (10K) [binary/octet-stream]\n      `install' \u306b\u4fdd\u5b58\u4e2d\n      \n      100%[======================================>] 10,436      --.-K/s \u6642\u9593 0s\n      \n      2015-11-26 12:41:58 (22.9 MB/s) - `install' \u3078\u4fdd\u5b58\u5b8c\u4e86 [10436/10436]\n```\n\nroot\u6a29\u9650\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3044\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nsudo bash ./install\n```\n```text:\u7d50\u679c(\u4f8b):\n      Validated signature with:\n      Validated package sha256 hash matches expected value.\n      Installing with yum...\n      \u8aad\u307f\u8fbc\u3093\u3060\u30d7\u30e9\u30b0\u30a4\u30f3:priorities, update-motd, upgrade-helper\n      /tmp/inspector.b3nZ9iRz/InspectorAgent-1.0.96.0-100096.x86_64.rpm \u3092\u8abf\u3079\u3066\u3044\u307e\u3059: InspectorAgent-1.0.96.0-100096.x86_64\n      /tmp/inspector.b3nZ9iRz/InspectorAgent-1.0.96.0-100096.x86_64.rpm \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u3068\u3057\u3066\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\n      \u4f9d\u5b58\u6027\u306e\u89e3\u6c7a\u3092\u3057\u3066\u3044\u307e\u3059\n      --> \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u78ba\u8a8d\u3092\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u3002\n      ---> \u30d1\u30c3\u30b1\u30fc\u30b8 InspectorAgent.x86_64 0:1.0.96.0-100096 \u3092 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n      --> \u4f9d\u5b58\u6027\u306e\u51e6\u7406\u3092\u3057\u3066\u3044\u307e\u3059: libpcap \u306e\u30d1\u30c3\u30b1\u30fc\u30b8: InspectorAgent-1.0.96.0-100096.x86_64\n      --> \u4f9d\u5b58\u6027\u306e\u51e6\u7406\u3092\u3057\u3066\u3044\u307e\u3059: libpcap.so.1()(64bit) \u306e\u30d1\u30c3\u30b1\u30fc\u30b8: InspectorAgent-1.0.96.0-100096.x86_64\n      --> \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u78ba\u8a8d\u3092\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u3002\n      ---> \u30d1\u30c3\u30b1\u30fc\u30b8 libpcap.x86_64 14:1.4.0-1.20130826git2dbcaa1.10.amzn1 \u3092 \u30a4\u30f3\u30b9 \u30c8\u30fc\u30eb\n      --> \u4f9d\u5b58\u6027\u89e3\u6c7a\u3092\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002\n      \n      \u4f9d\u5b58\u6027\u3092\u89e3\u6c7a\u3057\u307e\u3057\u305f\n      \n      ================================================================================\n       Package  \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u30fc\n                       \u30d0\u30fc\u30b8\u30e7\u30f3        \u30ea\u30dd\u30b8\u30c8\u30ea\u30fc                            \u5bb9\u91cf\n      ================================================================================\n      \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4e2d:\n       InspectorAgent\n                x86_64 1.0.96.0-100096   /InspectorAgent-1.0.96.0-100096.x86_64  19 M\n      \u4f9d\u5b58\u6027\u95a2\u9023\u3067\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u3057\u307e\u3059:\n       libpcap  x86_64 14:1.4.0-1.20130826git2dbcaa1.10.amzn1\n                                         amzn-main                              144 k\n      \n      \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u8981\u7d04\n      ================================================================================\n      \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb  1 \u30d1\u30c3\u30b1\u30fc\u30b8 (+1 \u500b\u306e\u4f9d\u5b58\u95a2\u4fc2\u306e\u30d1\u30c3\u30b1\u30fc\u30b8)\n      \n      \u5408\u8a08\u5bb9\u91cf: 19 M\n      \u7dcf\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5bb9\u91cf: 144 k\n      \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5bb9\u91cf: 19 M\n      Downloading packages:\n      libpcap-1.4.0-1.20130826git2dbcaa1.10.amzn1.x86_64.rpm   | 144 kB     00:00\n      Running transaction check\n      Running transaction test\n      Transaction test succeeded\n      Running transaction\n        \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4e2d          : 14:libpcap-1.4.0-1.20130826git2dbcaa1.10.amzn   1/2\n        \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4e2d          : InspectorAgent-1.0.96.0-100096.x86_64           2/2\n      crond ???????????: [  OK  ]\n        \u691c\u8a3c\u4e2d                  : InspectorAgent-1.0.96.0-100096.x86_64           1/2\n        \u691c\u8a3c\u4e2d                  : 14:libpcap-1.4.0-1.20130826git2dbcaa1.10.amzn   2/2\n      \n      \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb:\n        InspectorAgent.x86_64 0:1.0.96.0-100096\n      \n      \u4f9d\u5b58\u6027\u95a2\u9023\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f:\n        libpcap.x86_64 14:1.4.0-1.20130826git2dbcaa1.10.amzn1\n      \n      \u5b8c\u4e86\u3057\u307e\u3057\u305f!\n      \u8aad\u307f\u8fbc\u3093\u3060\u30d7\u30e9\u30b0\u30a4\u30f3:priorities, update-motd, upgrade-helper\n      \u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb /var/run/yum.pid \u304c\u5b58\u5728\u3057\u307e\u3059: PID 2589 \u3068\u3057\u3066\u5225\u306b\u5b9f\u884c\u3055\u308c\u3066\u3044\u307e \u3059\u3002\n      Another app is currently holding the yum lock; waiting for it to exit...\n       \u4ed6\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3: yum\n         \u30e1\u30e2\u30ea\u30fc:  35 M RSS (244 MB VSZ)\n          \u958b\u59cb   : Thu Nov 26 05:03:34 2015 - 00:01 \u79d2\u7d4c\u904e\n          \u72b6\u614b   : \u5b9f\u884c\u4e2d\u3001PID: 2589\n      /tmp/inspector.b3nZ9iRz/InspectorAgent-1.0.96.0-100096.x86_64.rpm \u3092\u8abf\u3079\u3066\u3044\u307e\u3059: InspectorAgent-1.0.96.0-100096.x86_64\n      \u30a8\u30e9\u30fc: \u4f55\u3082\u3057\u307e\u305b\u3093\n      \n      Notice:\n      By installing the Amazon Inspector Agent, you agree that your use is subject to the terms of your existing\n      AWS Customer Agreement or other agreement with Amazon Web Services, Inc. or its affiliates governing your\n      use of AWS services. You may not install and use the Amazon Inspector Agent unless you have an account in\n      good standing with AWS.\n      *  *  *\n      Current running agent reports version as: 1.0.96.0\n      This install script was created to install agent version: 1.0.96.0\n      In most cases, these version numbers should be the same.\n      HTTP/1.1 200 OK\n      x-amz-id-2: h1O/eI8QEiOnWHehL+UMGOzOwxf7L9vfZamw+n7g8a0FtF155FJRV4XdytcM1X0LrcgPckGRUmg=\n      x-amz-request-id: 777F555AA4F364F6\n      Date: Thu, 26 Nov 2015 05:03:41 GMT\n      Last-Modified: Wed, 11 Nov 2015 18:27:01 GMT\n      ETag: \"7861805d4dfb5cf7e2d2972cea567ca7\"\n      Accept-Ranges: bytes\n      Content-Type: binary/octet-stream\n      Content-Length: 10998\n      Server: AmazonS3\n```\n\n1.9. nginx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n---------------------\n\u30b5\u30f3\u30d7\u30eb\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u3057\u3066nginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nsudo yum -y install nginx ; sudo chkconfig nginx on\n```\n```text:\u7d50\u679c(\u4f8b):\n      \u8aad\u307f\u8fbc\u3093\u3060\u30d7\u30e9\u30b0\u30a4\u30f3:priorities, update-motd, upgrade-helper\n      amzn-main/latest                                         | 2.1 kB     00:00\n      \u4f9d\u5b58\u6027\u306e\u89e3\u6c7a\u3092\u3057\u3066\u3044\u307e\u3059\n      --> \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u78ba\u8a8d\u3092\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u3002\n      ---> \u30d1\u30c3\u30b1\u30fc\u30b8 nginx.x86_64 1:1.8.0-10.25.amzn1 \u3092 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n      \n      \uff08\u4e2d\u7565\u3002\u304b\u306a\u308a\u306e\u884c\u6570\u304c\u6d41\u308c\u307e\u3059\uff09\n      \n      \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb:\n        nginx.x86_64 1:1.8.0-10.25.amzn1\n      \n      \u4f9d\u5b58\u6027\u95a2\u9023\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f:\n        GeoIP.x86_64 0:1.4.8-1.5.amzn1             gd.x86_64 0:2.0.35-11.10.amzn1\n        gperftools-libs.x86_64 0:2.0-11.5.amzn1    libXpm.x86_64 0:3.5.10-2.9.amzn1\n        libunwind.x86_64 0:1.1-10.8.amzn1\n      \n      \u5b8c\u4e86\u3057\u307e\u3057\u305f!\n```\n\n1.10. \u518d\u8d77\u52d5\n---------------------\n\u518d\u8d77\u52d5\u3057\u306a\u3044\u3068\u6709\u52b9\u306b\u306a\u3089\u306a\u3044\u306e\u3067\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nsudo reboot\n```\n```text:\u7d50\u679c(\u4f8b):\n      Broadcast message from ec2-user@ip-172-31-21-47\n              (/dev/pts/0) at 5:10 ...\n      \n      The system is going down for reboot NOW!\n      Connection to 54.xxx.xxx.xxx closed by remote host.\n      Connection to 54.xxx.xxx.xxx closed.\n```\n\u4ee5\u4e0a\u3067\u8a3a\u65ad\u7528EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f\u6e96\u5099\u5b8c\u4e86\u3067\u3059\u3002\n\uff08\u591a\u5206\u52d5\u304f\u306e\u3067\u7701\u7565\u3057\u307e\u3059\u304c\u3001\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3084nginx\u306e\u52d5\u4f5c\u78ba\u8a8d\u306f\u9069\u5b9c\u884c\u3063\u3066\u304f\u3060\u3055\u3044\uff09\n\n\n2. IAM\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n==================\n\n2.1. \u30ed\u30fc\u30eb\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u4f5c\u6210\n-----------------------------\n\u3082\u3046\u8a3a\u65ad\u7528EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3053\u3068\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u518d\u3073\u7ba1\u7406\u7528\u7aef\u672b\u304b\u3089\u4f5c\u696d\u3092\u7d9a\u3051\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nIAM_ROLE_NAME=\"inspector\"\nFILE_ROLE_DOC=\"iam-role-${IAM_ROLE_NAME}.json\" && echo ${FILE_ROLE_DOC}\n```\n```text:\u7d50\u679c:\n      iam-role-inspector.json\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\ncat << EOF > ${FILE_ROLE_DOC}\n{\n          \"Version\": \"2012-10-17\",\n          \"Statement\": [\n                  {\n                      \"Action\": \"sts:AssumeRole\",\n                      \"Principal\": {\n                          \"Service\": \"inspector.amazonaws.com\"\n                      },\n                      \"Effect\": \"Allow\",\n                      \"Sid\": \"\"\n                  }\n          ]\n}\nEOF\n```\n\nJSON\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u58ca\u308c\u3066\u306a\u3044\u304b\u5fc5\u305a\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\njsonlint -q ${FILE_ROLE_DOC}\n```\n\n2.2. \u30ed\u30fc\u30eb\u30dd\u30ea\u30b7\u30fc\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u4f5c\u6210\n-------------------------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nFILE_ROLE_POLICY_DOC=\"iam-role-${IAM_ROLE_NAME}-policy.json\" && echo ${FILE_ROLE_POLICY_DOC}\n```\n```text:\u7d50\u679c:\n      iam-role-inspector-policy.json\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat << EOF > ${FILE_ROLE_POLICY_DOC}\n{\n        \"Version\": \"2012-10-17\",\n        \"Statement\": [\n          {\n            \"Action\": [\n              \"ec2:Describe*\"\n            ],\n            \"Effect\": \"Allow\",\n            \"Resource\": \"*\"\n          }\n        ]\n}\nEOF\n```\nJSON\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u58ca\u308c\u3066\u306a\u3044\u304b\u5fc5\u305a\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\njsonlint -q ${FILE_ROLE_POLICY_DOC}\n```\n\n2.3. \u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n-----------------\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n          IAM_ROLE_NAME: ${IAM_ROLE_NAME}\n          FILE_ROLE_DOC: ${FILE_ROLE_DOC}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws iam create-role --role-name ${IAM_ROLE_NAME} --assume-role-policy-document file://${FILE_ROLE_DOC}\n```\n```text:\u7d50\u679c(\u4f8b):\n      {\n          \"Role\": {\n              \"AssumeRolePolicyDocument\": {\n                  \"Version\": \"2012-10-17\",\n                  \"Statement\": [\n                      {\n                          \"Action\": \"sts:AssumeRole\",\n                          \"Sid\": \"\",\n                          \"Effect\": \"Allow\",\n                          \"Principal\": {\n                              \"Service\": \"inspector.amazonaws.com\"\n                          }\n                      }\n                  ]\n              },\n              \"RoleId\": \"AROAIJJMSMXYT5ZXYUZCM\",\n              \"CreateDate\": \"2015-11-26T01:57:27.629Z\",\n              \"RoleName\": \"inspector\",\n              \"Path\": \"/\",\n              \"Arn\": \"arn:aws:iam::454200CLI555:role/inspector\"\n          }\n      }\n```\n\n2.4. \u30ed\u30fc\u30eb\u306e\u78ba\u8a8d\n-----------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws iam get-role --role-name ${IAM_ROLE_NAME}\n```\n```text:\u7d50\u679c(\u4f8b):\n      {\n          \"Role\": {\n              \"AssumeRolePolicyDocument\": {\n                  \"Version\": \"2012-10-17\",\n                  \"Statement\": [\n                      {\n                          \"Action\": \"sts:AssumeRole\",\n                          \"Principal\": {\n                              \"Service\": \"inspector.amazonaws.com\"\n                          },\n                          \"Effect\": \"Allow\",\n                          \"Sid\": \"\"\n                      }\n                  ]\n              },\n              \"RoleId\": \"AROAIJJMSMXYT5ZXYUZCM\",\n              \"CreateDate\": \"2015-11-26T01:57:27Z\",\n              \"RoleName\": \"inspector\",\n              \"Path\": \"/\",\n              \"Arn\": \"arn:aws:iam::454200CLI555:role/inspector\"\n          }\n      }\n```\n\n2.5. \u30ed\u30fc\u30eb\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\n-------------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nIAM_ROLE_POLICY_NAME=\"${IAM_ROLE_NAME}-policy\"\n```\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n          IAM_ROLE_NAME:        ${IAM_ROLE_NAME}\n          IAM_ROLE_POLICY_NAME: ${IAM_ROLE_POLICY_NAME}\n          FILE_ROLE_POLICY_DOC: ${FILE_ROLE_POLICY_DOC}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws iam put-role-policy --role-name ${IAM_ROLE_NAME} --policy-name ${IAM_ROLE_POLICY_NAME} --policy-document file://${FILE_ROLE_POLICY_DOC}\n```\n```text:\u7d50\u679c(\u4f8b):\n      (\u623b\u308a\u5024\u306a\u3057)\n```\n\n2.6. \u30ed\u30fc\u30eb\u30dd\u30ea\u30b7\u30fc\u306e\u78ba\u8a8d\n-------------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws iam get-role-policy --role-name ${IAM_ROLE_NAME} --policy-name ${IAM_ROLE_POLICY_NAME}\n```\n```text:\u7d50\u679c(\u4f8b):\n      {\n          \"RoleName\": \"inspector\",\n          \"PolicyDocument\": {\n              \"Version\": \"2012-10-17\",\n              \"Statement\": [\n                  {\n                      \"Action\": [\n                          \"ec2:Describe*\"\n                      ],\n                      \"Resource\": \"*\",\n                      \"Effect\": \"Allow\"\n                  }\n              ]\n          },\n          \"PolicyName\": \"inspector-policy\"\n      }\n```\n\n2.7. IAM\u30ed\u30fc\u30eb\u306eARN\u53d6\u5f97\n-----------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nIAM_ROLE_ARN=`aws iam get-role --role-name ${IAM_ROLE_NAME} --query 'Role.Arn' --output text` && echo ${IAM_ROLE_ARN}\n```\n```text:\u7d50\u679c(\u4f8b):\n      arn:aws:iam::454200CLI555:role/inspector\n```\n\n\n3. Inspector\u306e\u69cb\u7bc9\n====================\n\n3.1. Inspector\u3078\u306eIAM Role\u8a2d\u5b9a\n----------------------\n```bash:\u30b3\u30de\u30f3\u30c9:\naws inspector register-cross-account-access-role --role-arn ${IAM_ROLE_ARN}\n```\n```text:\u7d50\u679c:\n      {\n          \"message\": \"Cross-account access role registered successfully\"\n      }\n```\n\n3.2. Resource Group\u306e\u4f5c\u6210\n----------------------\n\u8a3a\u65ad\u5bfe\u8c61\u3068\u3059\u308bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u4ed8\u4e0e\u3057\u305f\u30bf\u30b0\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\u9805\u756a1.5.\u3068\u540c\u3058\u30bf\u30b0\u306e\u5185\u5bb9\u3067\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nRESOURCE_GROUP_ARN=`aws inspector create-resource-group --resource-group-tags \"[{\\\"key\\\":\\\"${TAG_KEY}\\\",\\\"values\\\":[\\\"${TAG_VALUE}\\\"]}]\" --output text` && echo ${RESOURCE_GROUP_ARN}\n```\n```text:\u7d50\u679c(\u4f8b):\n      arn:aws:inspector:us-west-2:454200CLI555:resourcegroup/0-zje554OG\n```\n\n3.3. Application\u306e\u4f5c\u6210\n----------------------\nResource Group\u3092\u7528\u3044\u3066Application\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nAPPLICATION_NAME=\"handson\"\nAPPLICATION_ARN=`aws inspector create-application --application-name \"${APPLICATION_NAME}\" --resource-group-arn ${RESOURCE_GROUP_ARN} --output text` && echo ${APPLICATION_ARN}\n```\n```text:\u7d50\u679c(\u4f8b):\n      arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn\n```\n\n3.4. \u5b9f\u884c\u3057\u305f\u3044\u8a3a\u65ad\u306e\u9078\u629e\n----------------------\nRules Packages \u4e00\u89a7\u304b\u3089\u3069\u306e\u8a3a\u65ad\u3092\u884c\u3046\u304b\u6c7a\u3081\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws inspector list-rules-packages\n```\n```text:\u7d50\u679c:\n      {\n          \"rulesPackageArnList\": [\n              \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-11B9DBXp\",\n              \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-LfLjwILF\",\n              \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-LzUxcT5A\",\n              \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-Pv9mELS9\",\n              \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-X1KXtawP\",\n              \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-ldNfZf6r\"\n          ]\n      }\n```\n\u306a\u3093\u3068CLI\u3067\u306farn\u4e00\u89a7\u304c\u51fa\u529b\u3055\u308c\u308b\u306e\u307f\u3067\u3001\u5185\u5bb9\u4e00\u89a7\u306f\u51fa\u306a\u3044\u306e\u3067\u3059\u3002\ndescribe-rules-package\u30b3\u30de\u30f3\u30c9\u3067\uff11\u3064\u305a\u3064arn\u3092\u6307\u5b9a\u3057\u3066\u5185\u5bb9\u3092\u78ba\u8a8d\u3059\u308b\u5fc5\u8981\u304c\u6709\u308a\u307e\u3059\u3002\u3068\u308a\u3048\u3042\u305a\uff11\u756a\u4e0b\u3092\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nRULES_PACKAGE_ARN=\"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-ldNfZf6r\"\naws inspector describe-rules-package --rules-package-arn ${RULES_PACKAGE_ARN}\n```\n```text:\u7d50\u679c:\n      {\n          \"rulesPackage\": {\n              \"description\": {\n                  \"parameters\": [],\n                  \"key\": {\n                      \"id\": \"rule package description id\",\n                      \"facility\": \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-ldNfZf6r\"\n                  }\n              },\n              \"rulesPackageName\": \"PCI DSS 3.0 Readiness\",\n              \"rulesPackageArn\": \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-ldNfZf6r\",\n              \"version\": \"1.0\",\n              \"provider\": \"Amazon Web Services, Inc.\"\n          }\n      }\n```\nPCI DSS 3.0 \u6e96\u62e0\u304b\u3069\u3046\u304b\u8a3a\u65ad\u3059\u308b\u3082\u306e\u3060\u305d\u3046\u3067\u3002\u5acc\u306a\u97ff\u304d\u3067\u3059\u304c\u4eca\u56de\u306f\u3053\u308c\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\n3.5. Assessment\u306e\u4f5c\u6210\n----------------------\n\u8a3a\u65ad\u3092\u884c\u3046\u30eb\u30fc\u30eb(Assessment)\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u5b9a\u671f\u5b9f\u884c\u3059\u308b\u8a3a\u65ad\u9593\u9694\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n900\u79d2(15\u5206)\u304c\u6700\u77ed\u3067\u3053\u3053\u3067\u306f900\u79d2\u3068\u3057\u307e\u3059\u304c\u983b\u5ea6\u304c\u77ed\u3051\u308c\u3070\u305d\u308c\u3060\u3051\u8cbb\u7528\u304c\u304b\u3055\u3080\u306e\u3067\u3054\u5229\u7528\u306f\u8a08\u753b\u7684\u306b\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nDURATION=900\nASSESSMENT_NAME=\"handson\"\nASSESSMENT_ARN=`aws inspector create-assessment --application-arn ${APPLICATION_ARN} --assessment-name ${ASSESSMENT_NAME} --duration-in-seconds ${DURATION} --output text` && echo ${ASSESSMENT_ARN}\n```\n```text:\u7d50\u679c(\u4f8b):\n      arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-ScIKJCEp\n```\n\nAssessment\u306b\u5148\u307b\u3069\u9078\u3093\u3060Rules Package\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws inspector attach-assessment-and-rules-package --assessment-arn ${ASSESSMENT_ARN} --rules-package-arn ${RULES_PACKAGE_ARN}\n```\n```text:\u7d50\u679c(\u4f8b):\n      {\n          \"message\": \"Successfully attached arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-ScIKJCEp to arn:aws:inspector:us-west-2:758058086616:rulespackage/0-ldNfZf6r\"\n      }\n```\n\n3.6. \u8a3a\u65ad\u306e\u958b\u59cb\n----------------------\nAssessment\u306e\u30c7\u30fc\u30bf\u53ce\u96c6\u3092\u958b\u59cb\u3055\u305b\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws inspector start-data-collection --assessment-arn ${ASSESSMENT_ARN}\n```\n```text:\u7d50\u679c(\u4f8b):\n      {\n          \"message\": \"Successfully started data collection for assessment with ID: arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-6mIhKNCv\"\n      }\n```\n\n\u7d9a\u3044\u3066Assessment\u306e\u5b9f\u884c\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws inspector run-assessment --assessment-arn ${ASSESSMENT_ARN} --run-name ${RUN_NAME}\n```\n```text:\u7d50\u679c(\u4f8b):\n      {\n          \"runArn\": \"arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-ScIKJCEp/run/0-WKlfMrre\"\n      }\n```\n\u8a3a\u65ad\u5b8c\u4e86\u307e\u3067\uff11\uff15\u5206\u304b\u304b\u308a\u307e\u3059\u3002\n\u30d3\u30fc\u30eb\u3092\u304a\u304b\u308f\u308a\u3057\u3066\u3086\u3063\u304f\u308a\u98f2\u307f\u306a\u304c\u3089\u5f85\u3061\u307e\u3057\u3087\u3046\u3002\n\n\n4. \u8a3a\u65ad\u7d50\u679c\u306e\u78ba\u8a8d\n=================\n\n4.1. \u7d50\u679c\u4e00\u89a7\u306e\u8868\u793a\n--------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws inspector list-findings\n```\n```text:\u7d50\u679c(\u4f8b):\n      {\n          \"findingArnList\": [\n              \"arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ/finding/null-0bmtREUN\",\n              \"arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ/finding/null-AoYzKyUy\",\n              \"arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ/finding/null-EJnIeL9F\",\n              \"arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ/finding/null-HnUxQBpi\",\n              \"arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ/finding/null-NbTqUn34\",\n              \"arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ/finding/null-UfR5otmV\",\n              \"arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ/finding/null-X3Ff03Ny\"\n          ]\n      }\n```\nCLI\u3067\u3059\u304b\u3089\u308f\u304b\u308a\u3084\u3059\u304f\u8868\u793a\u3055\u308c\u308b\u308f\u3051\u304c\u3042\u308a\u307e\u305b\u3093\u3002\n\u7d50\u679c\u306earn\u4e00\u89a7\u304c\u51fa\u529b\u3055\u308c\u308b\u306e\u3067\u3053\u308c\u3089\u3092\uff11\u3064\u305a\u3064\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u3066\u3044\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n4.2. \u7d50\u679c\u306e\u5185\u5bb9\u78ba\u8a8d\n---------------------\n\u7d50\u679c\u4e00\u89a7\u306eFinding arn\u3092\u6307\u5b9a\u3057\u3066\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nFINDING_ARN=\"arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ/finding/null-0bmtREUN\"\naws inspector describe-finding --finding-arn ${FINDING_ARN}\n```\n```text:\u7d50\u679c(\u4f8b):\n      {\n          \"finding\": {\n              \"runArn\": \"arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ\",\n              \"severity\": \"Informational\",\n              \"recommendation\": {\n                  \"parameters\": [\n                      {\n                          \"name\": \"INSECURE_PROTOCOL_LIST\",\n                          \"value\": \"www-http (port 80, World Wide Web HTTP), smtp (port 25, Simple Mail Transfer)\"\n                      },\n                      {\n                          \"name\": \"INSTANCE_ID\",\n                          \"value\": \"i-ba7b3a7e\"\n                      }\n                  ],\n                  \"key\": {\n                      \"id\": \"PCI DSS Requirement 1.1.6 - Use Secure Protocols-recommendation\",\n                      \"facility\": \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-ldNfZf6r\"\n                  }\n              },\n              \"rulesPackageArn\": \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-ldNfZf6r\",\n              \"userAttributes\": [],\n              \"findingArn\": \"arn:aws:inspector:us-west-2:454200CLI555:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ/finding/null-0bmtREUN\",\n              \"ruleName\": \"PCI DSS Requirement 1.1.6 - Use Secure Protocols\",\n              \"finding\": {\n                  \"parameters\": [\n                      {\n                          \"name\": \"INSECURE_PROTOCOL_LIST\",\n                          \"value\": \"www-http (port 80, World Wide Web HTTP), smtp (port 25, Simple Mail Transfer)\"\n                      },\n                      {\n                          \"name\": \"INSTANCE_ID\",\n                          \"value\": \"i-ba7b3a7e\"\n                      }\n                  ],\n                  \"key\": {\n                      \"id\": \"PCI DSS Requirement 1.1.6 - Use Secure Protocols-finding\",\n                      \"facility\": \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-ldNfZf6r\"\n                  }\n              },\n              \"attributes\": [\n                  {\n                      \"value\": \"www-http (port 80, World Wide Web HTTP), smtp (port 25, Simple Mail Transfer)\",\n                      \"key\": \"INSECURE_PROTOCOL_LIST\"\n                  },\n                  {\n                      \"value\": \"i-ba7b3a7e\",\n                      \"key\": \"INSTANCE_ID\"\n                  }\n              ],\n              \"agentId\": \"i-ba7b3a7e\",\n              \"description\": {\n                  \"parameters\": [\n                      {\n                          \"name\": \"INSECURE_PROTOCOL_LIST\",\n                          \"value\": \"www-http (port 80, World Wide Web HTTP), smtp (port 25, Simple Mail Transfer)\"\n                      },\n                      {\n                          \"name\": \"INSTANCE_ID\",\n                          \"value\": \"i-ba7b3a7e\"\n                      }\n                  ],\n                  \"key\": {\n                      \"id\": \"PCI DSS Requirement 1.1.6 - Use Secure Protocols-description\",\n                      \"facility\": \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-ldNfZf6r\"\n                  }\n              }\n          }\n      }\n```\n\u30bb\u30ad\u30e5\u30a2\u3067\u306a\u3044\u30d7\u30ed\u30c8\u30b3\u30eb(HTTP,SMTP)\u304c\u4f7f\u308f\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u6307\u6458\u3055\u308c\u3066\u3044\u307e\u3059\u306d\u3002\n\u3053\u308c\u3089\u306fPCI DSS 3.0\u3067\u306f\u4f7f\u7528\u304c\u7981\u6b62\u3055\u308c\u3066\u3044\u307e\u3059\u304b\u3089\u305d\u306e\u901a\u308a\u3067\u3054\u3056\u3044\u307e\u3059\u3002\n\n\u7d50\u679c\u4e00\u89a7\u306earn\u6570\u3060\u3051\u3053\u308c\u3092\u7e70\u308a\u8fd4\u3057\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n\n\n5. \u307e\u3068\u3081\n===========\nInspector\u306f\u8a2d\u5b9a\u3057\u305f\u9593\u9694\u3067\u5b9a\u671f\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\u8a3a\u65ad\u7d50\u679c\u3092\u3082\u3068\u306b\u5bfe\u7b56\u3092\u884c\u3046\u3068\u3001\u6b21\u56de\u8a3a\u65ad\u3067\u6307\u6458\u3055\u308c\u306a\u304f\u306a\u308a\u307e\u3059\u3002\nFindings\u304c\u4f55\u3082\u51fa\u529b\u3055\u308c\u306a\u304f\u306a\u308b\u72b6\u614b\u3092\u76ee\u6307\u3059\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\u3053\u308c\u3067\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u304c\u5411\u4e0a\u3059\u308b\u3068\u826f\u3044\u3067\u3059\u306d\u3002\n\n\n6. Inspector\u5168\u524a\u9664\u306e\u65b9\u6cd5\n===========\n\u4f7f\u3044\u7d9a\u3051\u308b\u5834\u5408\u306f\u5f53\u7136\u3053\u306e\u9805\u76ee\u306f\u5fc5\u8981\u6709\u308a\u307e\u305b\u3093\u3002\n\u4ee5\u4e0b\u306f\u524a\u9664\u65b9\u6cd5\u3067\u3059\u3002\u57fa\u672c\u7684\u306b\u69cb\u7bc9\u3057\u305f\u9006\u306e\u9806\u5e8f\u306b\u524a\u9664\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n6.1. Run\u306e\u524a\u9664\n--------------\nRun\u4e00\u89a7\u3067\u52d5\u4f5c\u4e2d\u306eRun arn\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws inspector list-runs\n```\n```text:\u7d50\u679c(\u4f8b):\n      {\n          \"runArnList\": [\n              \"arn:aws:inspector:us-west-2:454214976215:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ\"\n          ]\n      }\n```\n\u53d6\u5f97\u3057\u305farn\u3092\u6307\u5b9a\u3057\u3066Run\u3092\u524a\u9664\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws inspector delete-run --run-arn arn:aws:inspector:us-west-2:454214976215:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ\n```\n```text:\u7d50\u679c(\u4f8b):\n      {\n          \"message\": \"Successfully deleted run arn:aws:inspector:us-west-2:454214976215:application/0-q3ClefUn/assessment/0-6mIhKNCv/run/0-iyUhAnQZ\"\n      }\n```\n\n6.2. Assessment\u306e\u524a\u9664\n--------------\nAssessment\u4e00\u89a7\u304b\u3089Assessment arn\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws inspector list-assessments\n```\n```text:\u7d50\u679c(\u4f8b):\n      {\n          \"assessmentArnList\": [\n              \"arn:aws:inspector:us-west-2:454214976215:application/0-q3ClefUn/assessment/0-6mIhKNCv\"\n          ]\n      }\n```\n\u53d6\u5f97\u3057\u305farn\u3092\u6307\u5b9a\u3057\u3066Assessment\u3092\u524a\u9664\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws inspector delete-assessment --assessment-arn arn:aws:inspector:us-west-2:454214976215:application/0-q3ClefUn/assessment/0-6mIhKNCv\n```\n```text:\u7d50\u679c(\u4f8b):\n      {\n          \"message\": \"Successfully deleted assessment arn:aws:inspector:us-west-2:454214976215:application/0-q3ClefUn/assessment/0-6mIhKNCv\"\n      }\n```\n\n6.3. Application\u306e\u524a\u9664\n--------------\nApplication\u4e00\u89a7\u304b\u3089Application arn\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws inspector list-applications\n```\n```text:\u7d50\u679c(\u4f8b):\n      {\n          \"applicationArnList\": [\n              \"arn:aws:inspector:us-west-2:454214976215:application/0-q3ClefUn\"\n          ]\n      }\n```\n\u53d6\u5f97\u3057\u305farn\u3092\u6307\u5b9a\u3057\u3066Application\u3092\u524a\u9664\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws inspector delete-application --application-arn arn:aws:inspector:us-west-2:454214976215:application/0-q3ClefUn\n```\n```text:\u7d50\u679c(\u4f8b):\n      {\n          \"message\": \"Successfully deleted application arn:aws:inspector:us-west-2:454214976215:application/0-q3ClefUn\"\n      }\n```\n\n6.4. \u30d0\u30b0\uff1f\n--------------\n\u73fe\u5728Preview\u3060\u304b\u3089\u3067\u3057\u3087\u3046\u304b\u3001Resource Group\u3092\u524a\u9664\u3059\u308b\u65b9\u6cd5\u304c\u3042\u308a\u307e\u305b\u3093\u3002\n\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u306fResource Group\u306f\u898b\u3048\u305aApplication\u306e\u5185\u90e8\u3067\u5236\u5fa1\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u3067\u3001Application\u3092\u524a\u9664\u3059\u308b\u3068\u5185\u90e8\u51e6\u7406\u3067\u540c\u6642\u306b\u524a\u9664\u3055\u308c\u307e\u3059\u304cCLI\u3067\u306f\u524a\u9664\u3067\u304d\u307e\u305b\u3093\u3002\n\u653e\u7f6e\u3057\u3066\u3082\u8cbb\u7528\u306f\u767a\u751f\u3057\u306a\u3044\u3057\u7121\u8996\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\n6.5. \u305d\u306e\u4ed6\n--------------\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9, IAM\u30ed\u30fc\u30eb\u306a\u3069\u305d\u306e\u4ed6\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u524a\u9664\u306b\u3064\u3044\u3066\u306f\u672c\u984c\u304b\u3089\u305d\u308c\u307e\u3059\u306e\u3067\u5272\u611b\u3057\u307e\u3059\u3002\n\n\n\u5b8c\u4e86\n====\n\nInspector\u306f\u7121\u6599\u67a0\u304c\u7121\u3044\u306e\u3067\u3001\u30cf\u30f3\u30ba\u30aa\u30f3\u5b8c\u4e86\u5f8c\u306f\u8ab2\u91d1\u3092\u907f\u3051\u305f\u3044\u5834\u5408\u306f\u524a\u9664\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n", "tags": ["AWS", "awscli", "aws-cli", "Inspector"]}