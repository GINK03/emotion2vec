{"context": "\n\n\u6982\u8981\n\n\u3084\u3063\u305f\u3053\u3068\n\u6700\u8fd1\u53c2\u52a0\u3057\u305f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u304c\u53d6\u3089\u308c\u3066\u306a\u3044\u3068\u77e5\u3063\u3066\u3001\u6025\u907d\u30b9\u30af\u30ea\u30d7\u30c8\u66f8\u304d\u307e\u3057\u305f\u3002\n\u6700\u8fd1\u306f\u3001\u306a\u3093\u3067\u3082 Slack \u306b\u901a\u77e5\u3059\u308b\u306e\u304c\u6d41\u884c\u308a\u3063\u307d\u3044\u306e\u3067\u3001\u30a2\u30a4\u30b3\u30f3\u3084\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3084\u3089\u3092\u5de5\u592b\u3057\u3066\u3001\u3061\u3087\u3063\u3068\u3060\u3051 ChatOps \u3063\u307d\u304f\u3057\u3066\u307f\u307e\u3057\u305f (\u305d\u306e\u3046\u3061\u901a\u77e5\u3060\u3051\u3067\u306a\u304f\u3053\u3061\u3089\u304b\u3089\u304a\u9858\u3044\u3082\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u3044)\u3002\n\n\u7d50\u679c\n\n\u5199\u771f\u306f\u30cf\u30c1\u30ef\u30f3\u30c0\u30a4\u30d0\u30fc\u304b\u3089\u62dd\u501f (\u30e1\u30a4\u30c9\u3055\u3093\u3068\u3044\u3048\u3070\u5f7c\u5973\u3057\u304b\u601d\u3044\u6d6e\u304b\u3070\u306a\u304b\u3063\u305f\u2026)\u3002\n\n\u53c2\u8003\nmysqldump\u3067\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u304b\u3089\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u306a\u3044\n[10\u5206\u3067\u51fa\u6765\u308b]\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u7d50\u679c\u3092slack\u306b\u6295\u7a3f\nString contains in Bash\n\n\u8a73\u7d30\n\n1. mysqldump \u3092 cron \u304b\u3089\u81ea\u52d5\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3059\u308b\n\u00bb mysql_config_editor set --user=backup_user --password\nEnter password: \n\nHOME \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b .mylogin.cnf \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u304c\u51fa\u6765\u4e0a\u304c\u308a\u307e\u3059\u3002\n\u4e2d\u8eab\u306f\u3053\u3093\u306a\u304b\u3093\u3058\u3002\n\u00bb cat .mylogin.cnf \n\n\n'f3:\u0283????o\u076fJ 4a???VG5h_??E?qfCN?iA? }cd5??:??X?\n                                               \u0406??V??lP?!v_ ya???VN5h_??E?qtCN?iP? }cd5??:??E?\n                                                                                              \u0406??Q??\n\n\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3082\u81ea\u52d5\u3067 600 \u306b\u306a\u308a\u307e\u3059\u3002\n\n2. \u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u7528\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u304f\n\u51e6\u7406\u306e\u6d41\u308c\u306f\u3053\u3093\u306a\u304b\u3093\u3058\n\nmysqldump \u3092\u5b9f\u884c\u3059\u308b\n\u5727\u7e2e\u3059\u308b\nrsync \u3067\u5225\u306e\u30db\u30b9\u30c8\u3078\u30b3\u30d4\u30fc\u3059\u308b\n\u4e00\u5b9a\u671f\u9593\u3092\u904e\u304e\u305f\u30c0\u30f3\u30d7\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3059\u308b\n\nrsync \u304c\u30d1\u30b9\u30ef\u30fc\u30c9\u306a\u3057\u3067\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u3042\u3089\u304b\u3058\u3081\u9375\u306e\u767b\u9332\u306f\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\nbackup_db.sh\n#!/bin/bash\n\nset -u\numask 077\n\nDIR='/home/nunulk/db/backup'\nREMOTE_HOST='192.168.0.10'\nPREFIX=`date +%Y%m%d`\nSQL=$PREFIX.sql\n\nmysqldump --all-databases > $DIR/$SQL\nif [ ! -f $DIR/$SQL -o ! -s $DIR/$SQL ]; then\n  echo \"[fail] mysqldump \u304c\u5931\u6557\u3057\u305f\u3063\u307d\u3044\u3067\u3059\u3002\"\n  exit 1\nfi\n\ngzip -f $DIR/$SQL\nZIP=$PREFIX.sql.gz\nrsync -av --delete -e ssh $DIR/ $REMOTE_HOST:$DIR/\nif [ $? -ne 0 ]; then\n  echo \"[fail] rsync \u304c\u5931\u6557\u3057\u305f\u3063\u307d\u3044\u3067\u3059\u3002\"\n  exit 1\nfi\n\nDAYS=30\nif date -v 1d > /dev/null 2>&1; then\n  PREFIX=`date -v -${DAYS}d +%Y%m%d`\nelse\n  PREFIX=`date --date \"${DAYS} days ago\" +%Y%m%d`\nfi\n\nrm -f $DIR/$PREFIX.sql.gz\n\nSIZE=`ls -lh $DIR/$ZIP | awk '{print $5}'`\necho \"$ZIP ($SIZE) \u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\"\n\n\nmysqldump \u3068 rsync \u304c\u5931\u6557\u3057\u305f\u5834\u5408\u306f\u3001\u6a19\u6e96\u51fa\u529b\u306b [fail] \u3068\u3044\u3046\u6587\u5b57\u3092\u5165\u308c\u3066\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5410\u304f\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u3053\u308c\u306b\u3088\u308a\u3001\u6210\u529f\u6642\u3068\u5931\u6557\u6642\u3068\u3067\u3001Slack \u306b\u901a\u77e5\u3059\u308b\u969b\u306e\u6319\u52d5\u3092\u5206\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\ndate \u30b3\u30de\u30f3\u30c9\u306e\u6319\u52d5\u304c\u3001GNU/Linux\u7cfb\u3068BSD\u7cfb\u3067\u7570\u306a\u3063\u3066\u3044\u3066\u3001\u30ed\u30fc\u30ab\u30eb\u306e Mac \u3067\u30c6\u30b9\u30c8\u3059\u308b\u3068\u304d\u306b\u3044\u3061\u3044\u3061\u30b3\u30e1\u30f3\u30c8\u5165\u308c\u66ff\u3048\u308b\u306e\u9762\u5012\u3060\u3063\u305f\u306e\u3067\u3001\u81ea\u52d5\u3067\u5224\u5225\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u51fa\u529b\u30e1\u30c3\u30bb\u30fc\u30b8\u306b\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u3092\u5165\u308c\u305f\u306e\u306f\u3001\u30c7\u30fc\u30bf\u304c\u65e5\u3005\u5897\u3048\u3066\u3044\u304f\uff1d\u30b5\u30fc\u30d3\u30b9\u304c\u6210\u9577\u3057\u3066\u3044\u308b\u3001\u3068\u3044\u3046\u5b9f\u611f\u3092\u5f97\u305f\u304b\u3063\u305f\u304b\u3089\u3067\u3059\u304c\u3001\u3044\u307e\u306e\u3068\u3053\u308d\u3042\u307e\u308a\u5897\u3048\u3066\u3044\u307e\u305b\u3093(\u7b11)\u3002\n[2016/05/25 15:11 \u4fee\u6b63]\nscp \u3060\u3068\u30ea\u30e2\u30fc\u30c8\u30db\u30b9\u30c8\u306b\u30d5\u30a1\u30a4\u30eb\u304c\u6e9c\u307e\u308b\u4e00\u65b9\u306a\u306e\u3067\u3001rsync \u306b\u66f8\u304d\u63db\u3048\u307e\u3057\u305f\u3002\n\n\u5909\u66f4\u524d.sh\nscp $DIR/$ZIP $REMOTE_HOST:$DIR\nif [ $? -ne 0 ]; then\n  echo \"[fail] scp \u304c\u5931\u6557\u3057\u305f\u3063\u307d\u3044\u3067\u3059\u3002\"\n  exit 1\nfi\n\n\n\u2193\n\n\u5909\u66f4\u5f8c.sh\nrsync -av --delete -e ssh $REMOTE_HOST:$DIR/ $DIR/\nif [ $? -ne 0 ]; then\n  echo \"[fail] rsync \u304c\u5931\u6557\u3057\u305f\u3063\u307d\u3044\u3067\u3059\u3002\"\n  exit 1\nfi\n\n\n[2016/05/26 08:36 \u4fee\u6b63]\nrsync \u3067 REMOTE_HOST \u306e\u4f4d\u7f6e\u304c\u9006\u3060\u3063\u305f\u306e\u3067\u76f4\u3057\u307e\u3057\u305f\u3002\nrsync -av --delete -e ssh $DIR/ $REMOTE_HOST:$DIR/\n\n\n3. Slack \u901a\u77e5\u7528\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u304f\ntt2004d \u3055\u3093\u306e\u66f8\u304b\u308c\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u307b\u307c\u4e38\u30d1\u30af\u30ea\u3067\u3059\u3002 \n\u5909\u3048\u305f\u3068\u3053\u308d\u306f\u3001\u4ee5\u4e0b\u306e\u90e8\u5206\u3002\n\nnotify_backup.sh\nif [[ \"$MESSAGE\" == *fail* ]]; then\n    COLOR=\"danger\"\n    TITLE=${TITLE:-\"\u304a\u4ed5\u4e8b\u4e0a\u624b\u304f\u884c\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u30fc\uff01 :see_no_evil:\"}\nelse\n    COLOR=\"good\"\n    TITLE=${TITLE:-\"\u304a\u4ed5\u4e8b\u7d42\u308f\u308a\u307e\u3057\u305f\u3088 :heart:\"}\nfi\n\ncurl -s -S -X POST --data-urlencode \\\n  \"payload={ \\\n  \\\"channel\\\": \\\"${CHANNEL}\\\", \\\"username\\\": \\\"${BOTNAME}\\\", \\\n  \\\"icon_emoji\\\": \\\"${FACEICON}\\\", \\\"text\\\": \\\"${TITLE}\\\", \\\n  \\\"attachments\\\": [{\\\"color\\\": \\\"${COLOR}\\\",\\\"text\\\": \\\"${MESSAGE}\\\"}] \\\n}\" ${WEBHOOKURL} > /dev/null\n\n\n\u5909\u6570\u306e\u4e2d\u306b\u3001\u3042\u308b\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\u65b9\u6cd5\u304c\u3001\n[[ \"$hoge\" == *fuga* ]]\n\n\u3067\u3067\u304d\u308b\u3063\u3066\u3044\u3046\u306e\u306f\u77e5\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u3061\u3087\u3063\u3068\u8abf\u3079\u3066\u307f\u305f\u3093\u3067\u3059\u304c\u3001[[ ]] \u3092\u4f7f\u3046\u3068\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u304c\u3067\u304d\u308b\u307f\u305f\u3044\u3067\u3059\u306d\u3002\n\u3042\u3068\u3001\u6210\u529f\u304b\u5931\u6557\u304b\u30d1\u30c3\u3068\u898b\u3067\u5206\u304b\u308b\u3088\u3046\u306b\u7dd1\u3068\u8d64\u3067\u8272\u5206\u3051\u3057\u305f\u3044\u306a\u3041\u3068\u601d\u3063\u305f\u306e\u3067\u3001text \u3067\u306f\u306a\u304f attachments.text \u306b\u5165\u308c\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\ncolor \u306f\u3082\u3061\u308d\u3093\u30ab\u30e9\u30fc\u30b3\u30fc\u30c9\u3067\u6307\u5b9a\u3067\u304d\u307e\u3059\u304c\u3001good (\u7dd1)\u3001danger (\u8d64) \u3063\u3066\u3044\u3046\u6307\u5b9a\u3082\u3067\u304d\u308b\u306e\u3067\u3001\u4eca\u56de\u306f\u3053\u308c\u3089\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\n\n4. cron \u306b\u30bb\u30c3\u30c8\n0 3 * * * /home/nunulk/bin/backup_db.sh | /home/nunulk/bin/notify_backup.sh\n\n\u6bce\u65e5\u5348\u524d3\u6642\u306b\u5b9f\u884c\u3002\n2016-12-24 \u8ffd\u8a18\n\nanacron \u7de8\nanacron \u3067\u30b8\u30e7\u30d6\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3057\u3066\u3044\u308b\u30db\u30b9\u30c8\u306b\u8f09\u305b\u305f\u3089\u52d5\u304b\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u5099\u5fd8\u9332\u304c\u3066\u3089\u8ffd\u8a18\u3057\u307e\u3059\u3002\n/etc/anacrontab \u306b HOME \u3082\u3057\u304f\u306f MYSQL_TEST_LOGIN_FILE \u74b0\u5883\u5909\u6570\u3092\u30bb\u30c3\u30c8\u3057\u306a\u3044\u3068\u3001.mylogin.cnf \u3092\u8aad\u307f\u306b\u884c\u3063\u3066\u304f\u308c\u306a\u3044\u306e\u3067\u3001mysqldump \u304c\u5931\u6557\u3057\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u306f\u3001MYSQL_TEST_LOGIN_FILE \u74b0\u5883\u5909\u6570\u3092\u30bb\u30c3\u30c8\u3057\u305f anacrontab \u3067\u3059\u3002\n# /etc/anacrontab: configuration file for anacron\n\n# See anacron(8) and anacrontab(5) for details.\n\nSHELL=/bin/sh\nPATH=/sbin:/bin:/usr/sbin:/usr/bin\nMAILTO=root\nMYSQL_TEST_LOGIN_FILE=/root/.mylogin.cnf\n\n\u3053\u308c\u3067\u3001\n\n\u4e0a\u624b\u304f\u3044\u304d\u307e\u3057\u305f\u3002\n\u8ffd\u8a18\u3053\u3053\u307e\u3067\n\n\u307e\u3068\u3081\n\n\u81ea\u52d5\u3067\u5b9f\u884c\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u7d50\u679c\u3092\u901a\u77e5\u3059\u308b\u3088\u3046\u306b\u3059\u308b\u3068\u5931\u6557\u306b\u6c17\u3065\u3051\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3046\u308c\u3057\u3044\nSlack \u3060\u3068\u30a2\u30a4\u30b3\u30f3\u6307\u5b9a\u3067\u304d\u305f\u308a\u7d75\u6587\u5b57\u5165\u308c\u3089\u308c\u305f\u308a\u3057\u3066\u697d\u3057\u3044\n\n##\u6982\u8981\n\n###\u3084\u3063\u305f\u3053\u3068\n\n\u6700\u8fd1\u53c2\u52a0\u3057\u305f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u304c\u53d6\u3089\u308c\u3066\u306a\u3044\u3068\u77e5\u3063\u3066\u3001\u6025\u907d\u30b9\u30af\u30ea\u30d7\u30c8\u66f8\u304d\u307e\u3057\u305f\u3002\n\u6700\u8fd1\u306f\u3001\u306a\u3093\u3067\u3082 Slack \u306b\u901a\u77e5\u3059\u308b\u306e\u304c\u6d41\u884c\u308a\u3063\u307d\u3044\u306e\u3067\u3001\u30a2\u30a4\u30b3\u30f3\u3084\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3084\u3089\u3092\u5de5\u592b\u3057\u3066\u3001\u3061\u3087\u3063\u3068\u3060\u3051 ChatOps \u3063\u307d\u304f\u3057\u3066\u307f\u307e\u3057\u305f (\u305d\u306e\u3046\u3061\u901a\u77e5\u3060\u3051\u3067\u306a\u304f\u3053\u3061\u3089\u304b\u3089\u304a\u9858\u3044\u3082\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u3044)\u3002\n\n###\u7d50\u679c\n\n![Screen Shot 2016-05-25 at 12.46.50 PM.png](https://qiita-image-store.s3.amazonaws.com/0/121976/562e0b57-d794-a546-a4de-ee5b92a80712.png \"Screen Shot 2016-05-25 at 12.46.50 PM.png\")\n\n\u5199\u771f\u306f\u30cf\u30c1\u30ef\u30f3\u30c0\u30a4\u30d0\u30fc\u304b\u3089\u62dd\u501f (\u30e1\u30a4\u30c9\u3055\u3093\u3068\u3044\u3048\u3070\u5f7c\u5973\u3057\u304b\u601d\u3044\u6d6e\u304b\u3070\u306a\u304b\u3063\u305f\u2026)\u3002\n\n###\u53c2\u8003\n\n[mysqldump\u3067\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u304b\u3089\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u306a\u3044](http://qiita.com/yuya373/items/ef5ca2ceae52c8c85d76)\n\n[[10\u5206\u3067\u51fa\u6765\u308b]\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u7d50\u679c\u3092slack\u306b\u6295\u7a3f](http://qiita.com/tt2004d/items/50d79d1569c0ace118d6)\n\n[String contains in Bash](http://stackoverflow.com/questions/229551/string-contains-in-bash)\n\n##\u8a73\u7d30\n\n###1. mysqldump \u3092 cron \u304b\u3089\u81ea\u52d5\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3059\u308b\n\n```console\n\u00bb mysql_config_editor set --user=backup_user --password\nEnter password: \n```\n\nHOME \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b .mylogin.cnf \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u304c\u51fa\u6765\u4e0a\u304c\u308a\u307e\u3059\u3002\n\n\u4e2d\u8eab\u306f\u3053\u3093\u306a\u304b\u3093\u3058\u3002\n\n```console\n\u00bb cat .mylogin.cnf \n\n\n'f3:\u0283????o\u076fJ 4a???VG5h_??E?qfCN?iA? }cd5??:??X?\n                                               \u0406??V??lP?!v_ ya???VN5h_??E?qtCN?iP? }cd5??:??E?\n                                                                                              \u0406??Q??\n```\n\n\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3082\u81ea\u52d5\u3067 600 \u306b\u306a\u308a\u307e\u3059\u3002\n\n###2. \u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u7528\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u304f\n\n\u51e6\u7406\u306e\u6d41\u308c\u306f\u3053\u3093\u306a\u304b\u3093\u3058\n\n1. mysqldump \u3092\u5b9f\u884c\u3059\u308b\n2. \u5727\u7e2e\u3059\u308b\n3. rsync \u3067\u5225\u306e\u30db\u30b9\u30c8\u3078\u30b3\u30d4\u30fc\u3059\u308b\n4. \u4e00\u5b9a\u671f\u9593\u3092\u904e\u304e\u305f\u30c0\u30f3\u30d7\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3059\u308b\n\nrsync \u304c\u30d1\u30b9\u30ef\u30fc\u30c9\u306a\u3057\u3067\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u3042\u3089\u304b\u3058\u3081\u9375\u306e\u767b\u9332\u306f\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n```backup_db.sh\n#!/bin/bash\n\nset -u\numask 077\n\nDIR='/home/nunulk/db/backup'\nREMOTE_HOST='192.168.0.10'\nPREFIX=`date +%Y%m%d`\nSQL=$PREFIX.sql\n\nmysqldump --all-databases > $DIR/$SQL\nif [ ! -f $DIR/$SQL -o ! -s $DIR/$SQL ]; then\n  echo \"[fail] mysqldump \u304c\u5931\u6557\u3057\u305f\u3063\u307d\u3044\u3067\u3059\u3002\"\n  exit 1\nfi\n\ngzip -f $DIR/$SQL\nZIP=$PREFIX.sql.gz\nrsync -av --delete -e ssh $DIR/ $REMOTE_HOST:$DIR/\nif [ $? -ne 0 ]; then\n  echo \"[fail] rsync \u304c\u5931\u6557\u3057\u305f\u3063\u307d\u3044\u3067\u3059\u3002\"\n  exit 1\nfi\n\nDAYS=30\nif date -v 1d > /dev/null 2>&1; then\n  PREFIX=`date -v -${DAYS}d +%Y%m%d`\nelse\n  PREFIX=`date --date \"${DAYS} days ago\" +%Y%m%d`\nfi\n\nrm -f $DIR/$PREFIX.sql.gz\n\nSIZE=`ls -lh $DIR/$ZIP | awk '{print $5}'`\necho \"$ZIP ($SIZE) \u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\"\n```\n\nmysqldump \u3068 rsync \u304c\u5931\u6557\u3057\u305f\u5834\u5408\u306f\u3001\u6a19\u6e96\u51fa\u529b\u306b [fail] \u3068\u3044\u3046\u6587\u5b57\u3092\u5165\u308c\u3066\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5410\u304f\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u3053\u308c\u306b\u3088\u308a\u3001\u6210\u529f\u6642\u3068\u5931\u6557\u6642\u3068\u3067\u3001Slack \u306b\u901a\u77e5\u3059\u308b\u969b\u306e\u6319\u52d5\u3092\u5206\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\ndate \u30b3\u30de\u30f3\u30c9\u306e\u6319\u52d5\u304c\u3001GNU/Linux\u7cfb\u3068BSD\u7cfb\u3067\u7570\u306a\u3063\u3066\u3044\u3066\u3001\u30ed\u30fc\u30ab\u30eb\u306e Mac \u3067\u30c6\u30b9\u30c8\u3059\u308b\u3068\u304d\u306b\u3044\u3061\u3044\u3061\u30b3\u30e1\u30f3\u30c8\u5165\u308c\u66ff\u3048\u308b\u306e\u9762\u5012\u3060\u3063\u305f\u306e\u3067\u3001\u81ea\u52d5\u3067\u5224\u5225\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\n\u51fa\u529b\u30e1\u30c3\u30bb\u30fc\u30b8\u306b\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u3092\u5165\u308c\u305f\u306e\u306f\u3001\u30c7\u30fc\u30bf\u304c\u65e5\u3005\u5897\u3048\u3066\u3044\u304f\uff1d\u30b5\u30fc\u30d3\u30b9\u304c\u6210\u9577\u3057\u3066\u3044\u308b\u3001\u3068\u3044\u3046\u5b9f\u611f\u3092\u5f97\u305f\u304b\u3063\u305f\u304b\u3089\u3067\u3059\u304c\u3001\u3044\u307e\u306e\u3068\u3053\u308d\u3042\u307e\u308a\u5897\u3048\u3066\u3044\u307e\u305b\u3093(\u7b11)\u3002\n\n[2016/05/25 15:11 \u4fee\u6b63]\n\nscp \u3060\u3068\u30ea\u30e2\u30fc\u30c8\u30db\u30b9\u30c8\u306b\u30d5\u30a1\u30a4\u30eb\u304c\u6e9c\u307e\u308b\u4e00\u65b9\u306a\u306e\u3067\u3001rsync \u306b\u66f8\u304d\u63db\u3048\u307e\u3057\u305f\u3002\n\n```\u5909\u66f4\u524d.sh\nscp $DIR/$ZIP $REMOTE_HOST:$DIR\nif [ $? -ne 0 ]; then\n  echo \"[fail] scp \u304c\u5931\u6557\u3057\u305f\u3063\u307d\u3044\u3067\u3059\u3002\"\n  exit 1\nfi\n```\n\n\u2193\n\n```\u5909\u66f4\u5f8c.sh\nrsync -av --delete -e ssh $REMOTE_HOST:$DIR/ $DIR/\nif [ $? -ne 0 ]; then\n  echo \"[fail] rsync \u304c\u5931\u6557\u3057\u305f\u3063\u307d\u3044\u3067\u3059\u3002\"\n  exit 1\nfi\n```\n\n[2016/05/26 08:36 \u4fee\u6b63]\n\nrsync \u3067 REMOTE_HOST \u306e\u4f4d\u7f6e\u304c\u9006\u3060\u3063\u305f\u306e\u3067\u76f4\u3057\u307e\u3057\u305f\u3002\n\n```\nrsync -av --delete -e ssh $DIR/ $REMOTE_HOST:$DIR/\n```\n\n###3. Slack \u901a\u77e5\u7528\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u304f\n\ntt2004d \u3055\u3093\u306e\u66f8\u304b\u308c\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u307b\u307c\u4e38\u30d1\u30af\u30ea\u3067\u3059\u3002 :bow:\n\n\u5909\u3048\u305f\u3068\u3053\u308d\u306f\u3001\u4ee5\u4e0b\u306e\u90e8\u5206\u3002\n\n```notify_backup.sh\nif [[ \"$MESSAGE\" == *fail* ]]; then\n    COLOR=\"danger\"\n    TITLE=${TITLE:-\"\u304a\u4ed5\u4e8b\u4e0a\u624b\u304f\u884c\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u30fc\uff01 :see_no_evil:\"}\nelse\n    COLOR=\"good\"\n    TITLE=${TITLE:-\"\u304a\u4ed5\u4e8b\u7d42\u308f\u308a\u307e\u3057\u305f\u3088 :heart:\"}\nfi\n\ncurl -s -S -X POST --data-urlencode \\\n  \"payload={ \\\n  \\\"channel\\\": \\\"${CHANNEL}\\\", \\\"username\\\": \\\"${BOTNAME}\\\", \\\n  \\\"icon_emoji\\\": \\\"${FACEICON}\\\", \\\"text\\\": \\\"${TITLE}\\\", \\\n  \\\"attachments\\\": [{\\\"color\\\": \\\"${COLOR}\\\",\\\"text\\\": \\\"${MESSAGE}\\\"}] \\\n}\" ${WEBHOOKURL} > /dev/null\n```\n\n\u5909\u6570\u306e\u4e2d\u306b\u3001\u3042\u308b\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\u65b9\u6cd5\u304c\u3001\n\n```bash\n[[ \"$hoge\" == *fuga* ]]\n```\n\n\u3067\u3067\u304d\u308b\u3063\u3066\u3044\u3046\u306e\u306f\u77e5\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u3061\u3087\u3063\u3068\u8abf\u3079\u3066\u307f\u305f\u3093\u3067\u3059\u304c\u3001[[ ]] \u3092\u4f7f\u3046\u3068\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u304c\u3067\u304d\u308b\u307f\u305f\u3044\u3067\u3059\u306d\u3002\n\n\u3042\u3068\u3001\u6210\u529f\u304b\u5931\u6557\u304b\u30d1\u30c3\u3068\u898b\u3067\u5206\u304b\u308b\u3088\u3046\u306b\u7dd1\u3068\u8d64\u3067\u8272\u5206\u3051\u3057\u305f\u3044\u306a\u3041\u3068\u601d\u3063\u305f\u306e\u3067\u3001text \u3067\u306f\u306a\u304f attachments.text \u306b\u5165\u308c\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\ncolor \u306f\u3082\u3061\u308d\u3093\u30ab\u30e9\u30fc\u30b3\u30fc\u30c9\u3067\u6307\u5b9a\u3067\u304d\u307e\u3059\u304c\u3001good (\u7dd1)\u3001danger (\u8d64) \u3063\u3066\u3044\u3046\u6307\u5b9a\u3082\u3067\u304d\u308b\u306e\u3067\u3001\u4eca\u56de\u306f\u3053\u308c\u3089\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\n\n###4. cron \u306b\u30bb\u30c3\u30c8\n\n```console\n0 3 * * * /home/nunulk/bin/backup_db.sh | /home/nunulk/bin/notify_backup.sh\n```\n\n\u6bce\u65e5\u5348\u524d3\u6642\u306b\u5b9f\u884c\u3002\n\n__2016-12-24 \u8ffd\u8a18__\n\n### anacron \u7de8\n\nanacron \u3067\u30b8\u30e7\u30d6\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3057\u3066\u3044\u308b\u30db\u30b9\u30c8\u306b\u8f09\u305b\u305f\u3089\u52d5\u304b\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u5099\u5fd8\u9332\u304c\u3066\u3089\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\n/etc/anacrontab \u306b HOME \u3082\u3057\u304f\u306f MYSQL_TEST_LOGIN_FILE \u74b0\u5883\u5909\u6570\u3092\u30bb\u30c3\u30c8\u3057\u306a\u3044\u3068\u3001.mylogin.cnf \u3092\u8aad\u307f\u306b\u884c\u3063\u3066\u304f\u308c\u306a\u3044\u306e\u3067\u3001mysqldump \u304c\u5931\u6557\u3057\u307e\u3059\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/121976/366e31e4-0f62-1e5b-51a8-2c3f0db7df79.png)\n\n\u4ee5\u4e0b\u306f\u3001MYSQL_TEST_LOGIN_FILE \u74b0\u5883\u5909\u6570\u3092\u30bb\u30c3\u30c8\u3057\u305f anacrontab \u3067\u3059\u3002\n\n```/etc/anacrontab\n# /etc/anacrontab: configuration file for anacron\n\n# See anacron(8) and anacrontab(5) for details.\n\nSHELL=/bin/sh\nPATH=/sbin:/bin:/usr/sbin:/usr/bin\nMAILTO=root\nMYSQL_TEST_LOGIN_FILE=/root/.mylogin.cnf\n```\n\n\u3053\u308c\u3067\u3001\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/121976/76133a19-2eba-074b-7b6d-6c4ec0a3240c.png)\n\n\u4e0a\u624b\u304f\u3044\u304d\u307e\u3057\u305f\u3002\n\n__\u8ffd\u8a18\u3053\u3053\u307e\u3067__\n\n##\u307e\u3068\u3081\n\n- \u81ea\u52d5\u3067\u5b9f\u884c\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u7d50\u679c\u3092\u901a\u77e5\u3059\u308b\u3088\u3046\u306b\u3059\u308b\u3068\u5931\u6557\u306b\u6c17\u3065\u3051\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3046\u308c\u3057\u3044\n- Slack \u3060\u3068\u30a2\u30a4\u30b3\u30f3\u6307\u5b9a\u3067\u304d\u305f\u308a\u7d75\u6587\u5b57\u5165\u308c\u3089\u308c\u305f\u308a\u3057\u3066\u697d\u3057\u3044\n\n", "tags": ["Slack", "mysqldump", "Bash", "ShellScript"]}