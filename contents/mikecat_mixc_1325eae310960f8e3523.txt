{"tags": ["Brainf*ck", "Verilog"], "context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\nBrain*uck\u3092\u8a08\u7b97\u6a5f\u3068\u898b\u7acb\u3066\u3066\u5b9f\u88c5\u3059\u308b - Qiita\n\u3092\u8aad\u307f\u307e\u3057\u305f\u3002\n\u524d\u534a\u306f\u8208\u5473\u6df1\u3044\u3053\u3068\u304c\u66f8\u304b\u308c\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u6700\u7d42\u7684\u306b\u3067\u304d\u305f\u3082\u306e\u306f\u547d\u4ee4\u3092\u8aad\u307f\u53d6\u3063\u3066\u305d\u308c\u306b\u5408\u308f\u305b\u305f\u51e6\u7406\u3092\u884c\u3046\u3001\u3069\u3053\u306b\u3067\u3082\u3042\u308b\u3088\u3046\u306aBrainf*ck\u30a4\u30f3\u30bf\u30d7\u30ea\u30bf\u3067\u3057\u305f\u3002\n(\u9006\u306b\u5b9f\u969b\u306eCPU\u3001\u4f8b\u3048\u30708086\u306e\u30a4\u30f3\u30bf\u30d7\u30ea\u30bf\u3082\u300c\u547d\u4ee4\u3092\u8aad\u307f\u53d6\u3063\u3066\u305d\u308c\u306b\u5408\u308f\u305b\u305f\u51e6\u7406\u3092\u884c\u3046\u300d\u3082\u306e\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u3053\u3068\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u2026)\n\u305d\u3053\u3067\u3001Verilog\u3092\u7528\u3044\u3066\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u6210\u679c\u7269\n\u5b9f\u88c5\u3057\u305f\u3082\u306e\u3092GitHub\u306b\u4e0a\u3052\u307e\u3057\u305f\u3002\n\u3053\u306e\u8a18\u4e8b\u3067\u306f\u3053\u306e\u30b3\u30fc\u30c9\u306e\u4e00\u90e8\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n\u3068\u308a\u3042\u3048\u305a\u5b9f\u88c5\u3059\u308b\n\n\u30e1\u30e2\u30ea\n\u30e1\u30e2\u30ea(RAM)\u306f\u30a2\u30c9\u30ec\u30b9\u5e45\u3068\u30c7\u30fc\u30bf\u5e45\u3092\u6307\u5b9a\u3057\u3066\u4f5c\u6210\u3067\u304d\u307e\u3059\u3002\u4eca\u56de\u4f7f\u7528\u3059\u308b\u30e1\u30e2\u30ea\u306e\u30e2\u30c7\u30eb\u3067\u306f\u3001\u30af\u30ed\u30c3\u30af\u306e\u7acb\u3061\u4e0a\u304c\u308a\u3067\u6307\u5b9a\u3057\u305f\u30a2\u30c9\u30ec\u30b9\u306e\u30c7\u30fc\u30bf\u304c\u8aad\u307f\u51fa\u3055\u308c\u3001WE\u304cHIGH\u306a\u3089\u3070\u6307\u5b9a\u3055\u308c\u305f\u30c7\u30fc\u30bf\u304c\u6307\u5b9a\u3055\u308c\u305f\u30a2\u30c9\u30ec\u30b9\u306b\u66f8\u304d\u8fbc\u307e\u308c\u307e\u3059\u3002\u8aad\u307f\u51fa\u3055\u308c\u308b\u30c7\u30fc\u30bf\u306f\u66f8\u304d\u8fbc\u307e\u308c\u308b\u524d\u306e\u3082\u306e\u3068\u306a\u308a\u307e\u3059\u3002\nmodule ram(clk, data_read, data_write, addr, we);\n    parameter ADDR_WIDTH = 15;\n    parameter DATA_WIDTH = 8;\n\n    input clk;\n    output [DATA_WIDTH-1:0] data_read;\n    input [DATA_WIDTH-1:0] data_write;\n    input [ADDR_WIDTH-1:0] addr;\n    input we;\n\n    reg [DATA_WIDTH-1:0] data_read;\n    reg [DATA_WIDTH-1:0] mem[0:(1<<ADDR_WIDTH)-1];\n\n    always @(posedge clk) begin\n        data_read <= mem[addr];\n        if (we) mem[addr] <= data_write;\n    end\nendmodule\n\n\nCPU\n\u4eca\u56de\u5b9f\u88c5\u3059\u308bCPU\u306b\u304a\u3044\u3066\u306f\u3001\n\n\u547d\u4ee4\u30d5\u30a7\u30c3\u30c1(IF)\n\u547d\u4ee4\u5b9f\u884c(EX)\n\u5b9f\u884c\u7d50\u679c\u306e\u66f8\u304d\u8fbc\u307f(WB)\n\n\u306e3\u30b9\u30c6\u30fc\u30b8\u3092\u8003\u3048\u307e\u3059\u3002\n\u307e\u305f\u3001\u8d77\u52d5\u76f4\u5f8c\u306b\u30c7\u30fc\u30bf\u30e1\u30e2\u30ea\u306e\u5185\u5bb9\u30920\u306b\u521d\u671f\u5316\u3057\u307e\u3059\u3002\n\n\u547d\u4ee4\u30d5\u30a7\u30c3\u30c1\n\u30e1\u30e2\u30ea\u304b\u3089\u547d\u4ee4\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u3001\u30ec\u30b8\u30b9\u30bf\u306b\u683c\u7d0d\u3057\u307e\u3059\u3002\u305d\u3057\u3066\u3001\u6b21\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5099\u3048\u3066\u30d7\u30ed\u30b0\u30e9\u30e0\u30ab\u30a6\u30f3\u30bf\u3092\u9032\u3081\u307e\u3059\u3002\ndata_we <= 0;\ninput_read <= 0;\noutput_write <= 0;\nif (pc < prog_size) begin\n    inst <= inst_load_data;\n    jumpptr <= jumpptr_load_data;\n    pc <= pc + 1;\n    phase <= `CPU_PHASE_EX;\nend else begin\n    inst <= 0;\n    halted <= 1;\nend\n\n\n\u547d\u4ee4\u5b9f\u884c\n\u8aad\u307f\u8fbc\u3093\u3060\u547d\u4ee4\u30c7\u30fc\u30bf\u306b\u5fdc\u3058\u305f\u51e6\u7406\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u30e1\u30e2\u30ea\u3078\u306e\u66f8\u304d\u8fbc\u307f\u304c\u5fc5\u8981\u306a\u5834\u5408\u306f\u3001\u3053\u306e\u6642\u70b9\u3067\u66f8\u304d\u8fbc\u307f\u6307\u793a\u3092\u767a\u884c\u3057\u3001\u6b21\u306e\u30af\u30ed\u30c3\u30af\u3067\u66f8\u304d\u8fbc\u307e\u305b\u307e\u3059\u3002\n\u307e\u305f\u3001\u30b8\u30e3\u30f3\u30d7\u3092\u3059\u308b\u5834\u5408\u306f\u30d5\u30a7\u30c3\u30c1\u3059\u308b\u30a2\u30c9\u30ec\u30b9\u3092\u3053\u3053\u3067\u66f8\u304d\u63db\u3048\u3066\u304a\u304b\u306a\u3044\u3068\u3001\u6b21\u306e\u30d5\u30a7\u30c3\u30c1\u306b\u9593\u306b\u5408\u3044\u307e\u305b\u3093\u3002\n\u307e\u305f\u3001\u5165\u51fa\u529b\u306e\u6e96\u5099\u304c\u3067\u304d\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u3001\u3067\u304d\u308b\u307e\u3067\u5f85\u6a5f\u3057\u307e\u3059\u3002\ncase (inst)\n`CPU_INST_RIGHT: begin\n    data_ptr <= data_ptr + 1;\n    phase <= `CPU_PHASE_WB;\nend\n`CPU_INST_LEFT: begin\n    data_ptr <= data_ptr - 1;\n    phase <= `CPU_PHASE_WB;\nend\n`CPU_INST_INC: begin\n    data_store_data <= data_load_data + 1;\n    data_we <= 1;\n    phase <= `CPU_PHASE_WB;\nend\n`CPU_INST_DEC: begin\n    data_store_data <= data_load_data - 1;\n    data_we <= 1;\n    phase <= `CPU_PHASE_WB;\nend\n`CPU_INST_WHILE: begin\n    if (data_load_data == 0) begin\n        pc <= jumpptr;\n    end\n    phase <= `CPU_PHASE_WB;\nend\n`CPU_INST_WEND: begin\n    if (data_load_data != 0) begin\n        pc <= jumpptr;\n    end\n    phase <= `CPU_PHASE_WB;\nend\n`CPU_INST_IN: begin\n    if (input_valid) begin\n        data_store_data <= input_data;\n        data_we <= 1;\n        input_read <= 1;\n        phase <= `CPU_PHASE_WB;\n    end\nend\n`CPU_INST_OUT: begin\n    if (~output_busy) begin\n        output_data <= data_load_data;\n        output_write <= 1;\n        phase <= `CPU_PHASE_WB;\n    end\nend\ndefault: begin\n    phase <= `CPU_PHASE_WB;\nend\nendcase\n\n\n\u5b9f\u884c\u7d50\u679c\u306e\u66f8\u304d\u8fbc\u307f\n\u30e1\u30e2\u30ea\u3084\u51fa\u529b\u30dd\u30fc\u30c8\u306b\u66f8\u304d\u8fbc\u3080\u6307\u793a\u3092\u51fa\u3057\u305f\u5f8c\u3001\u66f8\u304d\u8fbc\u307e\u308c\u308b\u306e\u3092\u5f85\u3061\u3064\u3064\u3001\u66f8\u304d\u8fbc\u3080\u6307\u793a\u3092\u89e3\u9664\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001\u4eca\u56de\u306e\u30e1\u30e2\u30ea\u306e\u4ed5\u69d8\u3067\u306f\u30e1\u30e2\u30ea\u306b\u66f8\u304d\u8fbc\u3080\u6307\u793a\u3092\u51fa\u3057\u305f\u5f8c\u66f8\u304d\u8fbc\u3093\u3060\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u51fa\u305b\u308b\u307e\u3067\u306b\u306f2\u30af\u30ed\u30c3\u30af\u304b\u304b\u308b\u306e\u3067\u3001\u6b21\u306e\u547d\u4ee4\u5b9f\u884c\u3092\u305d\u306e\u5f8c\u306b\u3059\u308b\u5f79\u5272\u3082\u3042\u308a\u307e\u3059\u3002\ncase (inst)\n`CPU_INST_RIGHT: begin\n    phase <= `CPU_PHASE_IF;\nend\n`CPU_INST_LEFT: begin\n    phase <= `CPU_PHASE_IF;\nend\n`CPU_INST_INC: begin\n    data_we <= 0;\n    phase <= `CPU_PHASE_IF;\nend\n`CPU_INST_DEC: begin\n    data_we <= 0;\n    phase <= `CPU_PHASE_IF;\nend\n`CPU_INST_WHILE: begin\n    phase <= `CPU_PHASE_IF;\nend\n`CPU_INST_WEND: begin\n    phase <= `CPU_PHASE_IF;\nend\n`CPU_INST_IN: begin\n    data_we <= 0;\n    input_read <= 0;\n    phase <= `CPU_PHASE_IF;\nend\n`CPU_INST_OUT: begin\n    output_write <= 0;\n    phase <= `CPU_PHASE_IF;\nend\ndefault: begin\n    phase <= `CPU_PHASE_IF;\nend\nendcase\n\n\nCPU\u3092\u6539\u826f\u3059\u308b\n\u4e0a\u306eCPU\u306e\u5b9f\u88c5\u3067\u3082\u52d5\u4f5c\u3057\u307e\u3059\u304c\u30011\u547d\u4ee4\u306e\u5b9f\u884c\u306b\u5fc5\u305a3\u30af\u30ed\u30c3\u30af\u304b\u304b\u3063\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u3067\u306f\u52b9\u7387\u304c\u60aa\u3044\u306e\u3067\u3001\u3082\u3046\u5c11\u3057\u901f\u304f\u3057\u307e\u3057\u3087\u3046\u3002\n\u524d\u306e\u547d\u4ee4\u306e\u5b9f\u884c\u304c\u5b8c\u4e86\u3059\u308b\u524d\u306b\u6b21\u306e\u547d\u4ee4\u306e\u5b9f\u884c\u3092\u958b\u59cb\u3059\u308b\u3001\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u51e6\u7406\u306e\u3088\u3046\u306a\u3082\u306e\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\n\u6642\u7cfb\u5217\u9806\u306b\u3084\u308b\u3079\u304d\u51e6\u7406\u3092\u8ffd\u3063\u3066\u307f\u308b\n\u3084\u308b\u3079\u304d\u51e6\u7406\u3092\u6642\u7cfb\u5217\u306b\u6cbf\u3063\u3066\u30c6\u30fc\u30d6\u30eb\u306b\u3057\u3066\u307f\u308b\u3068\u3001\u305d\u308c\u305e\u308c\u306e\u72b6\u6cc1\u3067\u4f55\u3092\u3059\u308b\u3079\u304d\u304b\u304c\u308f\u304b\u308a\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u3002\n\n\n\n\u6642\u523b\n\u30d7\u30ed\u30b0\u30e9\u30e0\u30ab\u30a6\u30f3\u30bf\n\u30c7\u30fc\u30bf\u30dd\u30a4\u30f3\u30bf\n\u30d5\u30a7\u30c3\u30c1\u3057\u305f\u547d\u4ee4\n\u5b9f\u884c\u3057\u305f\u547d\u4ee4\n\u7d50\u679c\u3092\u66f8\u304d\u8fbc\u3093\u3060\u547d\u4ee4\n\u30c7\u30fc\u30bf\u8aad\u307f\u66f8\u304d\u306e\u30a2\u30c9\u30ec\u30b9\n\u8aad\u307f\u8fbc\u307e\u308c\u308b\u30c7\u30fc\u30bf\n\u66f8\u304d\u8fbc\u3080\u30c7\u30fc\u30bf\n\u30c7\u30fc\u30bf\u3092\u66f8\u304d\u8fbc\u3080\u304b\n\u30e1\u30e2\n\n\n\n\n0\n0\n0\n0\n0\n0\n0\n0\n*\n0\n\u5b9f\u884c\u958b\u59cb\n\n\n1\n1\n0\n+\n0\n0\n0\n0\n*\n0\nNOP\u3092\u5b9f\u884c\n\n\n2\n2\n0\n>\n+\n0\n0\n0\n1\n1\n+\u3092\u5b9f\u884c\n\n\n3\n3\n1\n+\n>\n+\n1\n0\n*\n0\n>\u3092\u5b9f\u884c\n\n\n4\n3\n1\n+\n>\n+\n1\n0\n*\n0\n\u30c7\u30fc\u30bf\u8aad\u307f\u8fbc\u307f\u306e\u305f\u3081\u30b9\u30c8\u30fc\u30eb\n\n\n5\n4\n1\n+\n+\n>\n1\n0\n1\n1\n+\u3092\u5b9f\u884c\n\n\n6\n5\n1\n>\n+\n+\n1\n0\n2\n1\n+\u3092\u5b9f\u884c\u3001\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\n\n\n7\n6\n2\n[\n>\n+\n2\n1\n*\n0\n>\u3092\u5b9f\u884c\n\n\n8\n6\n2\n[\n>\n+\n2\n0\n*\n0\n\u30c7\u30fc\u30bf\u8aad\u307f\u8fbc\u307f\u306e\u305f\u3081\u30b9\u30c8\u30fc\u30eb\n\n\n9\n10\n2\n0\n[\n>\n2\n0\n*\n0\n[\u3092\u5b9f\u884c\u3001\u30b8\u30e3\u30f3\u30d7\u3092\u884c\u3046\n\n\n10\n11\n2\n]\n0\n0\n2\n0\n*\n0\nNOP\u3092\u5b9f\u884c\n\n\n11\n12\n2\n>\n]\n0\n2\n0\n*\n0\n]\u3092\u5b9f\u884c\u3001\u30b8\u30e3\u30f3\u30d7\u3092\u884c\u308f\u306a\u3044\n\n\n12\n13\n3\nIN\n>\n]\n3\n0\n*\n0\n>\u3092\u5b9f\u884c\n\n\n13\n14\n3\nIN\nIN\n>\n3\n0\n30(\u5165\u529b\u30c7\u30fc\u30bf)\n1\nIN\u3092\u5b9f\u884c\n\n\n14\n14\n3\nIN\nIN\n>\n3\n0\n*\n0\nIN\u3092\u5b9f\u884c(\u5f37\u5236\u5f85\u6a5f)\n\n\n15\n14\n3\nIN\nIN\n>\n3\n0\n*\n0\nIN\u3092\u5b9f\u884c(\u5165\u529b\u30dd\u30fc\u30c8\u5f85\u6a5f)\n\n\n16\n15\n3\n+\nIN\nIN\n3\n0\n40(\u5165\u529b\u30c7\u30fc\u30bf)\n1\nIN\u3092\u5b9f\u884c\n\n\n17\n16\n3\nOUT\n+\nIN\n3\n0\n41\n1\n+\u3092\u5b9f\u884c\u3001\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\n\n\n18\n17\n3\nOUT\nOUT\n+\n3\n40\n*\n0\nOUT\u3092\u5b9f\u884c\u3001\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\n\n\n19\n17\n3\nOUT\nOUT\n+\n3\n41\n*\n0\nOUT\u3092\u5b9f\u884c(\u5f37\u5236\u5f85\u6a5f)\n\n\n20\n17\n3\nOUT\nOUT\n+\n3\n41\n*\n0\nOUT\u3092\u5b9f\u884c(\u51fa\u529b\u30dd\u30fc\u30c8\u5f85\u6a5f)\n\n\n21\n18\n3\n>\nOUT\n+\n3\n41\n*\n0\nOUT\u3092\u5b9f\u884c\n\n\n22\n19\n4\n>\n>\nOUT\n4\n41\n*\n0\n>\u3092\u5b9f\u884c\n\n\n23\n20\n5\nOUT\n>\n>\n5\n0\n*\n0\n>\u3092\u5b9f\u884c\n\n\n24\n20\n5\nOUT\n>\n>\n5\n0\n*\n0\n\u30c7\u30fc\u30bf\u8aad\u307f\u8fbc\u307f\u306e\u305f\u3081\u30b9\u30c8\u30fc\u30eb\n\n\n25\n20\n5\nOUT\n>\n>\n5\n0\n*\n0\nOUT\u3092\u5b9f\u884c(\u51fa\u529b\u30dd\u30fc\u30c8\u5f85\u6a5f)\n\n\n26\n21\n5\nIN\nOUT\n>\n5\n0\n*\n0\nOUT\u3092\u5b9f\u884c\n\n\n27\n22\n5\n0\nIN\nOUT\n5\n0\n0\n1\nIN\u3092\u5b9f\u884c\n\n\n28\n22\n5\n0\n0\nIN\n5\n0\n*\n0\nhalt\n\n\n29\n22\n5\n0\n0\n0\n5\n0\n*\n0\nhalt\n\n\n\n\u57fa\u672c\u7684\u306b\u524d\u306b\u5b9f\u884c\u3057\u305f\u547d\u4ee4\u306b\u5fdc\u3058\u3066\u5b9f\u884c\u3092\u88dc\u6b63\u3057\u3064\u3064\u3001\u30d5\u30a7\u30c3\u30c1\u3057\u305f\u547d\u4ee4\u3092\u5b9f\u884c\u3059\u308c\u3070\u3044\u3044\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n\u547d\u4ee4\u30d5\u30a7\u30c3\u30c1\n\u57fa\u672c\u7684\u306bpc(\u30d7\u30ed\u30b0\u30e9\u30e0\u30ab\u30a6\u30f3\u30bf)\u304c\u6307\u3059\u30a2\u30c9\u30ec\u30b9\u306e\u30e1\u30e2\u30ea\u306e\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u3080\u306e\u3067\u3059\u304c\u3001\n\u4eca\u56de\u306e\u5b9f\u88c5\u3067\u306fpc\u304c\u5909\u5316\u3057\u3066\u304b\u3089\u30e1\u30e2\u30ea\u304b\u3089\u8aad\u307f\u51fa\u3055\u308c\u308b\u30c7\u30fc\u30bf\u304c\u5909\u5316\u3059\u308b\u307e\u3067\u306b\u306f1\u30af\u30ed\u30c3\u30af\u306e\u9045\u5ef6\u304c\u3042\u308b\u306e\u3067\u3001\n\u3053\u306e\u9045\u5ef6\u3092\u3054\u307e\u304b\u3059\u305f\u3081\u306b\u30e1\u30e2\u30ea\u306b1\u30af\u30ed\u30c3\u30af\u5f8c\u306epc\u306e\u5024\u3092\u6e21\u3057\u3066\u3042\u3052\u307e\u3059\u3002\n\u3055\u3089\u306b\u3001\u30b8\u30e3\u30f3\u30d7\u3092\u884c\u3063\u305f\u76f4\u5f8c\u306f\u30d7\u30ed\u30b0\u30e9\u30e0\u30ab\u30a6\u30f3\u30bf\u306e\u5909\u5316\u306b\u30e1\u30e2\u30ea\u304c\u8ffd\u3044\u3064\u304b\u306a\u3044\u306e\u3067\u3001\n\u547d\u4ee4\u3092\u30d5\u30a7\u30c3\u30c1\u305b\u305a\u306b\u30c0\u30df\u30fc\u306e\u547d\u4ee4\u3092\u6e21\u3057\u3066\u3042\u3052\u307e\u3059\u3002\n\u307e\u305f\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u6700\u5f8c\u306b\u5230\u9054\u3057\u305f\u3089\u30d5\u30a7\u30c3\u30c1\u3092\u505c\u6b62\u3057\u3001\u30c0\u30df\u30fc\u306e\u547d\u4ee4\u3092\u683c\u7d0d\u3057\u307e\u3059\u3002\nassign next_pc = (~rst_i || ~ready) ? 0 :\n    (do_stall || io_wait) ? pc :\n    do_jump ? jumpptr :\n    (pc < prog_size) ? pc + 1 :\n    pc;\n\n// \u547d\u4ee4\u30d5\u30a7\u30c3\u30c1\nif (do_jump) begin\n    // \u30b8\u30e3\u30f3\u30d7\n    inst_if <= 0;\n    pc <= jumpptr;\nend else if (pc < prog_size) begin\n    // \u547d\u4ee4\u30d5\u30a7\u30c3\u30c1\n    inst_if <= inst_load_data;\n    jumpptr <= jumpptr_load_data;\n    pc <= pc + 1;\nend else begin\n    // \u5b9f\u884c\u7d42\u4e86\n    inst_if <= 0;\n    halted <= 1;\nend\n\n\n\u30c7\u30fc\u30bf\u306e\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\n\u30e1\u30e2\u30ea\u306e\u5024\u3092\u66f8\u304d\u63db\u3048\u308b\u6307\u793a\u3092\u51fa\u3057\u305f\u76f4\u5f8c\u306f\u3001\u307e\u3060\u305d\u306e\u5024\u304c\u30e1\u30e2\u30ea\u304b\u3089\u51fa\u3066\u6765\u307e\u305b\u3093\u3002\n\u3057\u304b\u3057\u3001\u66f8\u304d\u63db\u3048\u308b\u6307\u793a\u3092\u51fa\u3057\u305f\u3068\u3044\u3046\u3053\u3068\u306f\u51fa\u3066\u304f\u308b\u306f\u305a\u306e\u5024\u306fCPU\u304c\u6301\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u306e\u5024\u3092\u4f7f\u3046\u3053\u3068\u3067\u51e6\u7406\u304c\u3067\u304d\u307e\u3059\u3002\n\u66f8\u304d\u8fbc\u307f\u6307\u793a\u3092\u51fa\u3057\u3066\u304b\u3089\u5b9f\u969b\u306b\u66f8\u304d\u8fbc\u307e\u308c\u308b\u307e\u3067\u306e\u9593\u306f2\u30af\u30ed\u30c3\u30af\u306a\u306e\u3067\u3001\u305d\u306e\u9593\u6307\u793a\u3092\u51fa\u3057\u305f\u5024\u3092\u4f7f\u308f\u305b\u307e\u3059\u3002\n// \u76f4\u524d\u307e\u305f\u306f\u305d\u306e\u524d\u306b\u5b9f\u884c\u3057\u305f\u547d\u4ee4\u304c\u30e1\u30e2\u30ea\u306b\u66f8\u304d\u8fbc\u3080\u547d\u4ee4\u306e\u3068\u304d\u3001\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3059\u308b\nwire do_forwarding = (forwarding_count > 0);\n// \u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u53cd\u6620\u3057\u305f\u30e1\u30e2\u30ea\u306e\u5024\nwire [7:0] load_data = do_forwarding ? data_store_data : data_load_data;\n\n// \u6b21\u306b\u5b9f\u884c\u3059\u308b\u306e\u304c\u30e1\u30e2\u30ea\u306b\u66f8\u304d\u8fbc\u3080\u547d\u4ee4\u304b\nwire inst_if_mem = (inst_if == `CPU_INST_INC || inst_if == `CPU_INST_DEC || inst_if == `CPU_INST_IN);\n\nforwarding_count <= inst_if_mem ? 2 :\n    (forwarding_count > 0) ? forwarding_count - 1 : 0;\n\n\n\u30b9\u30c8\u30fc\u30eb\n\u30c7\u30fc\u30bf\u30dd\u30a4\u30f3\u30bf\u3092\u5909\u66f4\u3057\u305f\u76f4\u5f8c\u306f\u30e1\u30e2\u30ea\u304b\u3089\u5909\u66f4\u524d\u306e\u30a2\u30c9\u30ec\u30b9\u306e\u5024\u304c\u51fa\u3066\u304a\u308a\u3001\u3057\u304b\u3082\u305d\u306e\u5024\u3092CPU\u304c\u6301\u3063\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u30e1\u30e2\u30ea\u306e\u5024\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u306f\u30e1\u30e2\u30ea\u304b\u3089\u5909\u66f4\u5f8c\u306e\u30a2\u30c9\u30ec\u30b9\u306e\u5024\u304c\u51fa\u3066\u304f\u308b\u307e\u30671\u30af\u30ed\u30c3\u30af\u5f85\u3064\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u307e\u305f\u3001\u5165\u529b\u307e\u305f\u306f\u51fa\u529b\u304c\u9023\u7d9a\u3059\u308b\u5834\u5408\u3082\u3001\u30dd\u30fc\u30c8\u64cd\u4f5c\u306b\u3088\u3063\u3066\u30dd\u30fc\u30c8\u306e\u72b6\u614b(\u6b21\u306e\u5165\u529b\u30c7\u30fc\u30bf\u304c\u3042\u308b\u304b\u3001\u6b21\u306e\u51fa\u529b\u3092\u53d7\u3051\u5165\u308c\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u304b)\u304c\u5909\u5316\u3059\u308b\u3053\u3068\u304c\u8003\u3048\u3089\u308c\u308b\u304c\u3001\u64cd\u4f5c\u3057\u305f\u76f4\u5f8c\u306f\u3053\u306e\u5909\u5316\u304c\u53cd\u6620\u3055\u308c\u306a\u3044\u3053\u3068\u304c\u8003\u3048\u3089\u308c\u308b\u306e\u3067\u3001\u53cd\u6620\u3055\u308c\u308b\u307e\u30671\u30af\u30ed\u30c3\u30af\u5f85\u6a5f\u3057\u307e\u3059\u3002\n// \u76f4\u524d\u306b\u5b9f\u884c\u3057\u305f\u547d\u4ee4\u304c\u30c7\u30fc\u30bf\u30dd\u30a4\u30f3\u30bf\u306e\u5909\u66f4\u3067\u3001\n// \u5b9f\u884c\u3059\u308b\u547d\u4ee4\u304c\u30e1\u30e2\u30ea\u3092\u4f7f\u7528\u3059\u308b\u547d\u4ee4\u306e\u3068\u304d\u3001\u30b9\u30c8\u30fc\u30eb\u3059\u308b (\u65b0\u3057\u3044\u4f4d\u7f6e\u306e\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u3080\u305f\u3081)\nwire do_stall_mem = (\n    inst_ex == `CPU_INST_RIGHT || inst_ex == `CPU_INST_LEFT\n) && (\n    inst_if == `CPU_INST_INC || inst_if == `CPU_INST_DEC ||\n    inst_if == `CPU_INST_WHILE || inst_if == `CPU_INST_WEND ||\n    inst_if == `CPU_INST_OUT\n);\n// \u5165\u529b\u307e\u305f\u306f\u51fa\u529b\u304c\u9023\u7d9a\u3059\u308b\u3068\u304d\u3001\u30b9\u30c8\u30fc\u30eb\u3059\u308b (\u5165\u51fa\u529b\u30dd\u30fc\u30c8\u306e\u72b6\u614b\u304c\u66f4\u65b0\u3055\u308c\u308b\u306e\u3092\u5f85\u3064\u305f\u3081)\nwire do_stall_io = (inst_if == `CPU_INST_IN && inst_ex == `CPU_INST_IN) ||\n    (inst_if == `CPU_INST_OUT && inst_ex == `CPU_INST_OUT);\n\nwire do_stall = (do_stall_mem | do_stall_io) & ~stalled;\n\n\n\u547d\u4ee4\u5b9f\u884c\n\u547d\u4ee4\u3068\u30c7\u30fc\u30bf\u306b\u5fdc\u3058\u3066\u3001\u6b21\u306e\u30e1\u30e2\u30ea\u306e\u72b6\u614b\u3084\u30c7\u30fc\u30bf\u30dd\u30a4\u30f3\u30bf\u306e\u5024\u3001\u5165\u51fa\u529b\u30dd\u30fc\u30c8\u3078\u306e\u6307\u793a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n// \u547d\u4ee4\u5b9f\u884c\ndata_ptr <= (inst_if == `CPU_INST_RIGHT) ? data_ptr + 1 :\n    (inst_if == `CPU_INST_LEFT) ? data_ptr - 1 :\n    data_ptr;\ndata_store_data <= (inst_if == `CPU_INST_INC) ? load_data + 1 :\n    (inst_if == `CPU_INST_DEC) ? load_data - 1 :\n    (inst_if == `CPU_INST_IN) ? input_data :\n    data_store_data;\ndata_we <= inst_if_mem;\nforwarding_count <= inst_if_mem ? 2 :\n    (forwarding_count > 0) ? forwarding_count - 1 : 0;\ninput_read <= inst_if == `CPU_INST_IN;\noutput_write <= inst_if == `CPU_INST_OUT;\noutput_data <= load_data;\n\n\nCPU\u306e\u6bd4\u8f03\n\"hello, world\"\u3092\u51fa\u529b\u3059\u308b\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5b9f\u884c\u3057\u3066\u7d50\u679c\u3092\u6bd4\u8f03\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\nhello_world.bf\n++++++++[>+++++++++++++<-]>.---.+++++++..+++.<++++++[>-----------<-]>-.<\n+++[>----<-]>.<+++++++[>++++++++++++<-]>+++.--------.+++.------.--------.\n>++++++++++.\n\n\n\n\u6700\u521d\u306eCPU\n\u521d\u671f\u5316\u5b8c\u4e86\u304b\u3089\u5b9f\u884c\u7d42\u4e86\u307e\u30671459\u30af\u30ed\u30c3\u30af\u304b\u304b\u308a\u307e\u3057\u305f\u3002\n\u898f\u5247\u6b63\u3057\u304f1\u547d\u4ee4\u30923\u30af\u30ed\u30c3\u30af\u3067\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n\u6539\u826f\u3057\u305fCPU\n\u521d\u671f\u5316\u5b8c\u4e86\u304b\u3089\u5b9f\u884c\u7d42\u4e86\u307e\u3067563\u30af\u30ed\u30c3\u30af\u304b\u304b\u308a\u3001\u6700\u521d\u306eCPU\u306b\u6bd4\u3079\u3066\u3053\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u5834\u5408\u306f\u7d042.59\u500d\u901f\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n\u30b9\u30c8\u30fc\u30eb\u3084\u30b8\u30e3\u30f3\u30d7\u306a\u3069\u306e\u4f8b\u5916\u3092\u9664\u3044\u3066\u30011\u547d\u4ee4\u3042\u305f\u308a1\u30af\u30ed\u30c3\u30af\u3067\u5b9f\u884c\u3067\u304d\u3066\u3044\u307e\u3059\u3002\n\n\n\u307e\u3068\u3081\nVerilog\u3092\u7528\u3044\u3066Brainf*ck\u306e\u30a4\u30f3\u30bf\u30d7\u30ea\u30bf(Brainf*ck\u3092\u547d\u4ee4\u30bb\u30c3\u30c8\u3068\u3059\u308bCPU)\u3092\u5b9f\u88c5\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\u307e\u305f\u3001\u524d\u306e\u547d\u4ee4\u306e\u5b9f\u884c\u304c\u5b8c\u4e86\u3059\u308b\u524d\u306b\u6b21\u306e\u547d\u4ee4\u306e\u5b9f\u884c\u3092\u59cb\u3081\u308b\u3053\u3068\u3067\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u5b9f\u884c\u306b\u304b\u304b\u308b\u30af\u30ed\u30c3\u30af\u6570\u3092\u6e1b\u3089\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n# \u306f\u3058\u3081\u306b\n\n[Brain*uck\u3092\u8a08\u7b97\u6a5f\u3068\u898b\u7acb\u3066\u3066\u5b9f\u88c5\u3059\u308b - Qiita](http://qiita.com/quwahara/items/db57b02e9528cfaa0d6e)\n\u3092\u8aad\u307f\u307e\u3057\u305f\u3002\n\u524d\u534a\u306f\u8208\u5473\u6df1\u3044\u3053\u3068\u304c\u66f8\u304b\u308c\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u6700\u7d42\u7684\u306b\u3067\u304d\u305f\u3082\u306e\u306f\u547d\u4ee4\u3092\u8aad\u307f\u53d6\u3063\u3066\u305d\u308c\u306b\u5408\u308f\u305b\u305f\u51e6\u7406\u3092\u884c\u3046\u3001\u3069\u3053\u306b\u3067\u3082\u3042\u308b\u3088\u3046\u306aBrainf*ck\u30a4\u30f3\u30bf\u30d7\u30ea\u30bf\u3067\u3057\u305f\u3002\n(\u9006\u306b\u5b9f\u969b\u306eCPU\u3001\u4f8b\u3048\u3070[8086\u306e\u30a4\u30f3\u30bf\u30d7\u30ea\u30bf](https://github.com/mikecat/8086interpreter)\u3082\u300c\u547d\u4ee4\u3092\u8aad\u307f\u53d6\u3063\u3066\u305d\u308c\u306b\u5408\u308f\u305b\u305f\u51e6\u7406\u3092\u884c\u3046\u300d\u3082\u306e\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u3053\u3068\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u2026)\n\u305d\u3053\u3067\u3001Verilog\u3092\u7528\u3044\u3066\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n# \u6210\u679c\u7269\n\n\u5b9f\u88c5\u3057\u305f\u3082\u306e\u3092[GitHub](https://github.com/mikecat/brainfuck_verilog)\u306b\u4e0a\u3052\u307e\u3057\u305f\u3002\n\u3053\u306e\u8a18\u4e8b\u3067\u306f\u3053\u306e\u30b3\u30fc\u30c9\u306e\u4e00\u90e8\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n# \u3068\u308a\u3042\u3048\u305a\u5b9f\u88c5\u3059\u308b\n\n## \u30e1\u30e2\u30ea\n\n\u30e1\u30e2\u30ea(RAM)\u306f\u30a2\u30c9\u30ec\u30b9\u5e45\u3068\u30c7\u30fc\u30bf\u5e45\u3092\u6307\u5b9a\u3057\u3066\u4f5c\u6210\u3067\u304d\u307e\u3059\u3002\u4eca\u56de\u4f7f\u7528\u3059\u308b\u30e1\u30e2\u30ea\u306e\u30e2\u30c7\u30eb\u3067\u306f\u3001\u30af\u30ed\u30c3\u30af\u306e\u7acb\u3061\u4e0a\u304c\u308a\u3067\u6307\u5b9a\u3057\u305f\u30a2\u30c9\u30ec\u30b9\u306e\u30c7\u30fc\u30bf\u304c\u8aad\u307f\u51fa\u3055\u308c\u3001`WE`\u304cHIGH\u306a\u3089\u3070\u6307\u5b9a\u3055\u308c\u305f\u30c7\u30fc\u30bf\u304c\u6307\u5b9a\u3055\u308c\u305f\u30a2\u30c9\u30ec\u30b9\u306b\u66f8\u304d\u8fbc\u307e\u308c\u307e\u3059\u3002\u8aad\u307f\u51fa\u3055\u308c\u308b\u30c7\u30fc\u30bf\u306f\u66f8\u304d\u8fbc\u307e\u308c\u308b\u524d\u306e\u3082\u306e\u3068\u306a\u308a\u307e\u3059\u3002\n\n```verilog\nmodule ram(clk, data_read, data_write, addr, we);\n\tparameter ADDR_WIDTH = 15;\n\tparameter DATA_WIDTH = 8;\n\n\tinput clk;\n\toutput [DATA_WIDTH-1:0] data_read;\n\tinput [DATA_WIDTH-1:0] data_write;\n\tinput [ADDR_WIDTH-1:0] addr;\n\tinput we;\n\n\treg [DATA_WIDTH-1:0] data_read;\n\treg [DATA_WIDTH-1:0] mem[0:(1<<ADDR_WIDTH)-1];\n\n\talways @(posedge clk) begin\n\t\tdata_read <= mem[addr];\n\t\tif (we) mem[addr] <= data_write;\n\tend\nendmodule\n```\n\n## CPU\n\n\u4eca\u56de\u5b9f\u88c5\u3059\u308bCPU\u306b\u304a\u3044\u3066\u306f\u3001\n\n* \u547d\u4ee4\u30d5\u30a7\u30c3\u30c1(IF)\n* \u547d\u4ee4\u5b9f\u884c(EX)\n* \u5b9f\u884c\u7d50\u679c\u306e\u66f8\u304d\u8fbc\u307f(WB)\n\n\u306e3\u30b9\u30c6\u30fc\u30b8\u3092\u8003\u3048\u307e\u3059\u3002\n\u307e\u305f\u3001\u8d77\u52d5\u76f4\u5f8c\u306b\u30c7\u30fc\u30bf\u30e1\u30e2\u30ea\u306e\u5185\u5bb9\u30920\u306b\u521d\u671f\u5316\u3057\u307e\u3059\u3002\n\n### \u547d\u4ee4\u30d5\u30a7\u30c3\u30c1\n\n\u30e1\u30e2\u30ea\u304b\u3089\u547d\u4ee4\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u3001\u30ec\u30b8\u30b9\u30bf\u306b\u683c\u7d0d\u3057\u307e\u3059\u3002\u305d\u3057\u3066\u3001\u6b21\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5099\u3048\u3066\u30d7\u30ed\u30b0\u30e9\u30e0\u30ab\u30a6\u30f3\u30bf\u3092\u9032\u3081\u307e\u3059\u3002\n\n```verilog\ndata_we <= 0;\ninput_read <= 0;\noutput_write <= 0;\nif (pc < prog_size) begin\n\tinst <= inst_load_data;\n\tjumpptr <= jumpptr_load_data;\n\tpc <= pc + 1;\n\tphase <= `CPU_PHASE_EX;\nend else begin\n\tinst <= 0;\n\thalted <= 1;\nend\n```\n\n### \u547d\u4ee4\u5b9f\u884c\n\n\u8aad\u307f\u8fbc\u3093\u3060\u547d\u4ee4\u30c7\u30fc\u30bf\u306b\u5fdc\u3058\u305f\u51e6\u7406\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u30e1\u30e2\u30ea\u3078\u306e\u66f8\u304d\u8fbc\u307f\u304c\u5fc5\u8981\u306a\u5834\u5408\u306f\u3001\u3053\u306e\u6642\u70b9\u3067\u66f8\u304d\u8fbc\u307f\u6307\u793a\u3092\u767a\u884c\u3057\u3001\u6b21\u306e\u30af\u30ed\u30c3\u30af\u3067\u66f8\u304d\u8fbc\u307e\u305b\u307e\u3059\u3002\n\u307e\u305f\u3001\u30b8\u30e3\u30f3\u30d7\u3092\u3059\u308b\u5834\u5408\u306f\u30d5\u30a7\u30c3\u30c1\u3059\u308b\u30a2\u30c9\u30ec\u30b9\u3092\u3053\u3053\u3067\u66f8\u304d\u63db\u3048\u3066\u304a\u304b\u306a\u3044\u3068\u3001\u6b21\u306e\u30d5\u30a7\u30c3\u30c1\u306b\u9593\u306b\u5408\u3044\u307e\u305b\u3093\u3002\n\u307e\u305f\u3001\u5165\u51fa\u529b\u306e\u6e96\u5099\u304c\u3067\u304d\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u3001\u3067\u304d\u308b\u307e\u3067\u5f85\u6a5f\u3057\u307e\u3059\u3002\n\n```verilog\ncase (inst)\n`CPU_INST_RIGHT: begin\n\tdata_ptr <= data_ptr + 1;\n\tphase <= `CPU_PHASE_WB;\nend\n`CPU_INST_LEFT: begin\n\tdata_ptr <= data_ptr - 1;\n\tphase <= `CPU_PHASE_WB;\nend\n`CPU_INST_INC: begin\n\tdata_store_data <= data_load_data + 1;\n\tdata_we <= 1;\n\tphase <= `CPU_PHASE_WB;\nend\n`CPU_INST_DEC: begin\n\tdata_store_data <= data_load_data - 1;\n\tdata_we <= 1;\n\tphase <= `CPU_PHASE_WB;\nend\n`CPU_INST_WHILE: begin\n\tif (data_load_data == 0) begin\n\t\tpc <= jumpptr;\n\tend\n\tphase <= `CPU_PHASE_WB;\nend\n`CPU_INST_WEND: begin\n\tif (data_load_data != 0) begin\n\t\tpc <= jumpptr;\n\tend\n\tphase <= `CPU_PHASE_WB;\nend\n`CPU_INST_IN: begin\n\tif (input_valid) begin\n\t\tdata_store_data <= input_data;\n\t\tdata_we <= 1;\n\t\tinput_read <= 1;\n\t\tphase <= `CPU_PHASE_WB;\n\tend\nend\n`CPU_INST_OUT: begin\n\tif (~output_busy) begin\n\t\toutput_data <= data_load_data;\n\t\toutput_write <= 1;\n\t\tphase <= `CPU_PHASE_WB;\n\tend\nend\ndefault: begin\n\tphase <= `CPU_PHASE_WB;\nend\nendcase\n```\n\n### \u5b9f\u884c\u7d50\u679c\u306e\u66f8\u304d\u8fbc\u307f\n\n\u30e1\u30e2\u30ea\u3084\u51fa\u529b\u30dd\u30fc\u30c8\u306b\u66f8\u304d\u8fbc\u3080\u6307\u793a\u3092\u51fa\u3057\u305f\u5f8c\u3001\u66f8\u304d\u8fbc\u307e\u308c\u308b\u306e\u3092\u5f85\u3061\u3064\u3064\u3001\u66f8\u304d\u8fbc\u3080\u6307\u793a\u3092\u89e3\u9664\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001\u4eca\u56de\u306e\u30e1\u30e2\u30ea\u306e\u4ed5\u69d8\u3067\u306f\u30e1\u30e2\u30ea\u306b\u66f8\u304d\u8fbc\u3080\u6307\u793a\u3092\u51fa\u3057\u305f\u5f8c\u66f8\u304d\u8fbc\u3093\u3060\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u51fa\u305b\u308b\u307e\u3067\u306b\u306f2\u30af\u30ed\u30c3\u30af\u304b\u304b\u308b\u306e\u3067\u3001\u6b21\u306e\u547d\u4ee4\u5b9f\u884c\u3092\u305d\u306e\u5f8c\u306b\u3059\u308b\u5f79\u5272\u3082\u3042\u308a\u307e\u3059\u3002\n\n```verilog\ncase (inst)\n`CPU_INST_RIGHT: begin\n\tphase <= `CPU_PHASE_IF;\nend\n`CPU_INST_LEFT: begin\n\tphase <= `CPU_PHASE_IF;\nend\n`CPU_INST_INC: begin\n\tdata_we <= 0;\n\tphase <= `CPU_PHASE_IF;\nend\n`CPU_INST_DEC: begin\n\tdata_we <= 0;\n\tphase <= `CPU_PHASE_IF;\nend\n`CPU_INST_WHILE: begin\n\tphase <= `CPU_PHASE_IF;\nend\n`CPU_INST_WEND: begin\n\tphase <= `CPU_PHASE_IF;\nend\n`CPU_INST_IN: begin\n\tdata_we <= 0;\n\tinput_read <= 0;\n\tphase <= `CPU_PHASE_IF;\nend\n`CPU_INST_OUT: begin\n\toutput_write <= 0;\n\tphase <= `CPU_PHASE_IF;\nend\ndefault: begin\n\tphase <= `CPU_PHASE_IF;\nend\nendcase\n```\n\n# CPU\u3092\u6539\u826f\u3059\u308b\n\n\u4e0a\u306eCPU\u306e\u5b9f\u88c5\u3067\u3082\u52d5\u4f5c\u3057\u307e\u3059\u304c\u30011\u547d\u4ee4\u306e\u5b9f\u884c\u306b\u5fc5\u305a3\u30af\u30ed\u30c3\u30af\u304b\u304b\u3063\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u3067\u306f\u52b9\u7387\u304c\u60aa\u3044\u306e\u3067\u3001\u3082\u3046\u5c11\u3057\u901f\u304f\u3057\u307e\u3057\u3087\u3046\u3002\n\u524d\u306e\u547d\u4ee4\u306e\u5b9f\u884c\u304c\u5b8c\u4e86\u3059\u308b\u524d\u306b\u6b21\u306e\u547d\u4ee4\u306e\u5b9f\u884c\u3092\u958b\u59cb\u3059\u308b\u3001\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u51e6\u7406\u306e\u3088\u3046\u306a\u3082\u306e\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\n## \u6642\u7cfb\u5217\u9806\u306b\u3084\u308b\u3079\u304d\u51e6\u7406\u3092\u8ffd\u3063\u3066\u307f\u308b\n\n\u3084\u308b\u3079\u304d\u51e6\u7406\u3092\u6642\u7cfb\u5217\u306b\u6cbf\u3063\u3066\u30c6\u30fc\u30d6\u30eb\u306b\u3057\u3066\u307f\u308b\u3068\u3001\u305d\u308c\u305e\u308c\u306e\u72b6\u6cc1\u3067\u4f55\u3092\u3059\u308b\u3079\u304d\u304b\u304c\u308f\u304b\u308a\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u3002\n\n|\u6642\u523b|\u30d7\u30ed\u30b0\u30e9\u30e0\u30ab\u30a6\u30f3\u30bf|\u30c7\u30fc\u30bf\u30dd\u30a4\u30f3\u30bf|\u30d5\u30a7\u30c3\u30c1\u3057\u305f\u547d\u4ee4|\u5b9f\u884c\u3057\u305f\u547d\u4ee4|\u7d50\u679c\u3092\u66f8\u304d\u8fbc\u3093\u3060\u547d\u4ee4|\u30c7\u30fc\u30bf\u8aad\u307f\u66f8\u304d\u306e\u30a2\u30c9\u30ec\u30b9|\u8aad\u307f\u8fbc\u307e\u308c\u308b\u30c7\u30fc\u30bf|\u66f8\u304d\u8fbc\u3080\u30c7\u30fc\u30bf|\u30c7\u30fc\u30bf\u3092\u66f8\u304d\u8fbc\u3080\u304b|\u30e1\u30e2|\n|---|---|---|---|---|---|---|---|---|---|---|\n|0|0|0|0|0|0|0|0|*|0|\u5b9f\u884c\u958b\u59cb|\n|1|1|0|+|0|0|0|0|*|0|NOP\u3092\u5b9f\u884c|\n|2|2|0|&gt;|+|0|0|0|1|1|+\u3092\u5b9f\u884c|\n|3|3|1|+|&gt;|+|1|0|*|0|&gt;\u3092\u5b9f\u884c|\n|4|3|1|+|&gt;|+|1|0|*|0|\u30c7\u30fc\u30bf\u8aad\u307f\u8fbc\u307f\u306e\u305f\u3081\u30b9\u30c8\u30fc\u30eb|\n|5|4|1|+|+|&gt;|1|0|1|1|+\u3092\u5b9f\u884c|\n|6|5|1|&gt;|+|+|1|0|2|1|+\u3092\u5b9f\u884c\u3001\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0|\n|7|6|2|[|&gt;|+|2|1|*|0|&gt;\u3092\u5b9f\u884c|\n|8|6|2|[|&gt;|+|2|0|*|0|\u30c7\u30fc\u30bf\u8aad\u307f\u8fbc\u307f\u306e\u305f\u3081\u30b9\u30c8\u30fc\u30eb|\n|9|10|2|0|[|&gt;|2|0|*|0|[\u3092\u5b9f\u884c\u3001\u30b8\u30e3\u30f3\u30d7\u3092\u884c\u3046|\n|10|11|2|]|0|0|2|0|*|0|NOP\u3092\u5b9f\u884c|\n|11|12|2|&gt;|]|0|2|0|*|0|]\u3092\u5b9f\u884c\u3001\u30b8\u30e3\u30f3\u30d7\u3092\u884c\u308f\u306a\u3044|\n|12|13|3|IN|&gt;|]|3|0|*|0|&gt;\u3092\u5b9f\u884c|\n|13|14|3|IN|IN|&gt;|3|0|30(\u5165\u529b\u30c7\u30fc\u30bf)|1|IN\u3092\u5b9f\u884c|\n|14|14|3|IN|IN|&gt;|3|0|*|0|IN\u3092\u5b9f\u884c(\u5f37\u5236\u5f85\u6a5f)|\n|15|14|3|IN|IN|&gt;|3|0|*|0|IN\u3092\u5b9f\u884c(\u5165\u529b\u30dd\u30fc\u30c8\u5f85\u6a5f)|\n|16|15|3|+|IN|IN|3|0|40(\u5165\u529b\u30c7\u30fc\u30bf)|1|IN\u3092\u5b9f\u884c|\n|17|16|3|OUT|+|IN|3|0|41|1|+\u3092\u5b9f\u884c\u3001\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0|\n|18|17|3|OUT|OUT|+|3|40|*|0|OUT\u3092\u5b9f\u884c\u3001\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0|\n|19|17|3|OUT|OUT|+|3|41|*|0|OUT\u3092\u5b9f\u884c(\u5f37\u5236\u5f85\u6a5f)|\n|20|17|3|OUT|OUT|+|3|41|*|0|OUT\u3092\u5b9f\u884c(\u51fa\u529b\u30dd\u30fc\u30c8\u5f85\u6a5f)|\n|21|18|3|&gt;|OUT|+|3|41|*|0|OUT\u3092\u5b9f\u884c|\n|22|19|4|&gt;|&gt;|OUT|4|41|*|0|&gt;\u3092\u5b9f\u884c|\n|23|20|5|OUT|&gt;|&gt;|5|0|*|0|&gt;\u3092\u5b9f\u884c|\n|24|20|5|OUT|&gt;|&gt;|5|0|*|0|\u30c7\u30fc\u30bf\u8aad\u307f\u8fbc\u307f\u306e\u305f\u3081\u30b9\u30c8\u30fc\u30eb|\n|25|20|5|OUT|&gt;|&gt;|5|0|*|0|OUT\u3092\u5b9f\u884c(\u51fa\u529b\u30dd\u30fc\u30c8\u5f85\u6a5f)|\n|26|21|5|IN|OUT|&gt;|5|0|*|0|OUT\u3092\u5b9f\u884c|\n|27|22|5|0|IN|OUT|5|0|0|1|IN\u3092\u5b9f\u884c|\n|28|22|5|0|0|IN|5|0|*|0|halt|\n|29|22|5|0|0|0|5|0|*|0|halt|\n\n\u57fa\u672c\u7684\u306b\u524d\u306b\u5b9f\u884c\u3057\u305f\u547d\u4ee4\u306b\u5fdc\u3058\u3066\u5b9f\u884c\u3092\u88dc\u6b63\u3057\u3064\u3064\u3001\u30d5\u30a7\u30c3\u30c1\u3057\u305f\u547d\u4ee4\u3092\u5b9f\u884c\u3059\u308c\u3070\u3044\u3044\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n## \u547d\u4ee4\u30d5\u30a7\u30c3\u30c1\n\n\u57fa\u672c\u7684\u306b`pc`(\u30d7\u30ed\u30b0\u30e9\u30e0\u30ab\u30a6\u30f3\u30bf)\u304c\u6307\u3059\u30a2\u30c9\u30ec\u30b9\u306e\u30e1\u30e2\u30ea\u306e\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u3080\u306e\u3067\u3059\u304c\u3001\n\u4eca\u56de\u306e\u5b9f\u88c5\u3067\u306f`pc`\u304c\u5909\u5316\u3057\u3066\u304b\u3089\u30e1\u30e2\u30ea\u304b\u3089\u8aad\u307f\u51fa\u3055\u308c\u308b\u30c7\u30fc\u30bf\u304c\u5909\u5316\u3059\u308b\u307e\u3067\u306b\u306f1\u30af\u30ed\u30c3\u30af\u306e\u9045\u5ef6\u304c\u3042\u308b\u306e\u3067\u3001\n\u3053\u306e\u9045\u5ef6\u3092\u3054\u307e\u304b\u3059\u305f\u3081\u306b\u30e1\u30e2\u30ea\u306b1\u30af\u30ed\u30c3\u30af\u5f8c\u306e`pc`\u306e\u5024\u3092\u6e21\u3057\u3066\u3042\u3052\u307e\u3059\u3002\n\n\u3055\u3089\u306b\u3001\u30b8\u30e3\u30f3\u30d7\u3092\u884c\u3063\u305f\u76f4\u5f8c\u306f\u30d7\u30ed\u30b0\u30e9\u30e0\u30ab\u30a6\u30f3\u30bf\u306e\u5909\u5316\u306b\u30e1\u30e2\u30ea\u304c\u8ffd\u3044\u3064\u304b\u306a\u3044\u306e\u3067\u3001\n\u547d\u4ee4\u3092\u30d5\u30a7\u30c3\u30c1\u305b\u305a\u306b\u30c0\u30df\u30fc\u306e\u547d\u4ee4\u3092\u6e21\u3057\u3066\u3042\u3052\u307e\u3059\u3002\n\n\u307e\u305f\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u6700\u5f8c\u306b\u5230\u9054\u3057\u305f\u3089\u30d5\u30a7\u30c3\u30c1\u3092\u505c\u6b62\u3057\u3001\u30c0\u30df\u30fc\u306e\u547d\u4ee4\u3092\u683c\u7d0d\u3057\u307e\u3059\u3002\n\n```verilog\nassign next_pc = (~rst_i || ~ready) ? 0 :\n\t(do_stall || io_wait) ? pc :\n\tdo_jump ? jumpptr :\n\t(pc < prog_size) ? pc + 1 :\n\tpc;\n\n// \u547d\u4ee4\u30d5\u30a7\u30c3\u30c1\nif (do_jump) begin\n\t// \u30b8\u30e3\u30f3\u30d7\n\tinst_if <= 0;\n\tpc <= jumpptr;\nend else if (pc < prog_size) begin\n\t// \u547d\u4ee4\u30d5\u30a7\u30c3\u30c1\n\tinst_if <= inst_load_data;\n\tjumpptr <= jumpptr_load_data;\n\tpc <= pc + 1;\nend else begin\n\t// \u5b9f\u884c\u7d42\u4e86\n\tinst_if <= 0;\n\thalted <= 1;\nend\n```\n\n## \u30c7\u30fc\u30bf\u306e\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\n\n\u30e1\u30e2\u30ea\u306e\u5024\u3092\u66f8\u304d\u63db\u3048\u308b\u6307\u793a\u3092\u51fa\u3057\u305f\u76f4\u5f8c\u306f\u3001\u307e\u3060\u305d\u306e\u5024\u304c\u30e1\u30e2\u30ea\u304b\u3089\u51fa\u3066\u6765\u307e\u305b\u3093\u3002\n\u3057\u304b\u3057\u3001\u66f8\u304d\u63db\u3048\u308b\u6307\u793a\u3092\u51fa\u3057\u305f\u3068\u3044\u3046\u3053\u3068\u306f\u51fa\u3066\u304f\u308b\u306f\u305a\u306e\u5024\u306fCPU\u304c\u6301\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u306e\u5024\u3092\u4f7f\u3046\u3053\u3068\u3067\u51e6\u7406\u304c\u3067\u304d\u307e\u3059\u3002\n\u66f8\u304d\u8fbc\u307f\u6307\u793a\u3092\u51fa\u3057\u3066\u304b\u3089\u5b9f\u969b\u306b\u66f8\u304d\u8fbc\u307e\u308c\u308b\u307e\u3067\u306e\u9593\u306f2\u30af\u30ed\u30c3\u30af\u306a\u306e\u3067\u3001\u305d\u306e\u9593\u6307\u793a\u3092\u51fa\u3057\u305f\u5024\u3092\u4f7f\u308f\u305b\u307e\u3059\u3002\n\n```verilog\n// \u76f4\u524d\u307e\u305f\u306f\u305d\u306e\u524d\u306b\u5b9f\u884c\u3057\u305f\u547d\u4ee4\u304c\u30e1\u30e2\u30ea\u306b\u66f8\u304d\u8fbc\u3080\u547d\u4ee4\u306e\u3068\u304d\u3001\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3059\u308b\nwire do_forwarding = (forwarding_count > 0);\n// \u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u53cd\u6620\u3057\u305f\u30e1\u30e2\u30ea\u306e\u5024\nwire [7:0] load_data = do_forwarding ? data_store_data : data_load_data;\n\n// \u6b21\u306b\u5b9f\u884c\u3059\u308b\u306e\u304c\u30e1\u30e2\u30ea\u306b\u66f8\u304d\u8fbc\u3080\u547d\u4ee4\u304b\nwire inst_if_mem = (inst_if == `CPU_INST_INC || inst_if == `CPU_INST_DEC || inst_if == `CPU_INST_IN);\n\nforwarding_count <= inst_if_mem ? 2 :\n\t(forwarding_count > 0) ? forwarding_count - 1 : 0;\n```\n\n## \u30b9\u30c8\u30fc\u30eb\n\n\u30c7\u30fc\u30bf\u30dd\u30a4\u30f3\u30bf\u3092\u5909\u66f4\u3057\u305f\u76f4\u5f8c\u306f\u30e1\u30e2\u30ea\u304b\u3089\u5909\u66f4\u524d\u306e\u30a2\u30c9\u30ec\u30b9\u306e\u5024\u304c\u51fa\u3066\u304a\u308a\u3001\u3057\u304b\u3082\u305d\u306e\u5024\u3092CPU\u304c\u6301\u3063\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u30e1\u30e2\u30ea\u306e\u5024\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u306f\u30e1\u30e2\u30ea\u304b\u3089\u5909\u66f4\u5f8c\u306e\u30a2\u30c9\u30ec\u30b9\u306e\u5024\u304c\u51fa\u3066\u304f\u308b\u307e\u30671\u30af\u30ed\u30c3\u30af\u5f85\u3064\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u307e\u305f\u3001\u5165\u529b\u307e\u305f\u306f\u51fa\u529b\u304c\u9023\u7d9a\u3059\u308b\u5834\u5408\u3082\u3001\u30dd\u30fc\u30c8\u64cd\u4f5c\u306b\u3088\u3063\u3066\u30dd\u30fc\u30c8\u306e\u72b6\u614b(\u6b21\u306e\u5165\u529b\u30c7\u30fc\u30bf\u304c\u3042\u308b\u304b\u3001\u6b21\u306e\u51fa\u529b\u3092\u53d7\u3051\u5165\u308c\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u304b)\u304c\u5909\u5316\u3059\u308b\u3053\u3068\u304c\u8003\u3048\u3089\u308c\u308b\u304c\u3001\u64cd\u4f5c\u3057\u305f\u76f4\u5f8c\u306f\u3053\u306e\u5909\u5316\u304c\u53cd\u6620\u3055\u308c\u306a\u3044\u3053\u3068\u304c\u8003\u3048\u3089\u308c\u308b\u306e\u3067\u3001\u53cd\u6620\u3055\u308c\u308b\u307e\u30671\u30af\u30ed\u30c3\u30af\u5f85\u6a5f\u3057\u307e\u3059\u3002\n\n```verilog\n// \u76f4\u524d\u306b\u5b9f\u884c\u3057\u305f\u547d\u4ee4\u304c\u30c7\u30fc\u30bf\u30dd\u30a4\u30f3\u30bf\u306e\u5909\u66f4\u3067\u3001\n// \u5b9f\u884c\u3059\u308b\u547d\u4ee4\u304c\u30e1\u30e2\u30ea\u3092\u4f7f\u7528\u3059\u308b\u547d\u4ee4\u306e\u3068\u304d\u3001\u30b9\u30c8\u30fc\u30eb\u3059\u308b (\u65b0\u3057\u3044\u4f4d\u7f6e\u306e\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u3080\u305f\u3081)\nwire do_stall_mem = (\n\tinst_ex == `CPU_INST_RIGHT || inst_ex == `CPU_INST_LEFT\n) && (\n\tinst_if == `CPU_INST_INC || inst_if == `CPU_INST_DEC ||\n\tinst_if == `CPU_INST_WHILE || inst_if == `CPU_INST_WEND ||\n\tinst_if == `CPU_INST_OUT\n);\n// \u5165\u529b\u307e\u305f\u306f\u51fa\u529b\u304c\u9023\u7d9a\u3059\u308b\u3068\u304d\u3001\u30b9\u30c8\u30fc\u30eb\u3059\u308b (\u5165\u51fa\u529b\u30dd\u30fc\u30c8\u306e\u72b6\u614b\u304c\u66f4\u65b0\u3055\u308c\u308b\u306e\u3092\u5f85\u3064\u305f\u3081)\nwire do_stall_io = (inst_if == `CPU_INST_IN && inst_ex == `CPU_INST_IN) ||\n\t(inst_if == `CPU_INST_OUT && inst_ex == `CPU_INST_OUT);\n\nwire do_stall = (do_stall_mem | do_stall_io) & ~stalled;\n```\n\n\n## \u547d\u4ee4\u5b9f\u884c\n\n\u547d\u4ee4\u3068\u30c7\u30fc\u30bf\u306b\u5fdc\u3058\u3066\u3001\u6b21\u306e\u30e1\u30e2\u30ea\u306e\u72b6\u614b\u3084\u30c7\u30fc\u30bf\u30dd\u30a4\u30f3\u30bf\u306e\u5024\u3001\u5165\u51fa\u529b\u30dd\u30fc\u30c8\u3078\u306e\u6307\u793a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```verilog\n// \u547d\u4ee4\u5b9f\u884c\ndata_ptr <= (inst_if == `CPU_INST_RIGHT) ? data_ptr + 1 :\n\t(inst_if == `CPU_INST_LEFT) ? data_ptr - 1 :\n\tdata_ptr;\ndata_store_data <= (inst_if == `CPU_INST_INC) ? load_data + 1 :\n\t(inst_if == `CPU_INST_DEC) ? load_data - 1 :\n\t(inst_if == `CPU_INST_IN) ? input_data :\n\tdata_store_data;\ndata_we <= inst_if_mem;\nforwarding_count <= inst_if_mem ? 2 :\n\t(forwarding_count > 0) ? forwarding_count - 1 : 0;\ninput_read <= inst_if == `CPU_INST_IN;\noutput_write <= inst_if == `CPU_INST_OUT;\noutput_data <= load_data;\n```\n\n# CPU\u306e\u6bd4\u8f03\n\n\"hello, world\"\u3092\u51fa\u529b\u3059\u308b\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5b9f\u884c\u3057\u3066\u7d50\u679c\u3092\u6bd4\u8f03\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n```bf:hello_world.bf\n++++++++[>+++++++++++++<-]>.---.+++++++..+++.<++++++[>-----------<-]>-.<\n+++[>----<-]>.<+++++++[>++++++++++++<-]>+++.--------.+++.------.--------.\n>++++++++++.\n```\n\n## \u6700\u521d\u306eCPU\n\n\u521d\u671f\u5316\u5b8c\u4e86\u304b\u3089\u5b9f\u884c\u7d42\u4e86\u307e\u30671459\u30af\u30ed\u30c3\u30af\u304b\u304b\u308a\u307e\u3057\u305f\u3002\n\u898f\u5247\u6b63\u3057\u304f1\u547d\u4ee4\u30923\u30af\u30ed\u30c3\u30af\u3067\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u3002\n![\u6700\u521d\u306eCPU\u306e\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u7d50\u679c](https://qiita-image-store.s3.amazonaws.com/0/99656/032aa415-0f46-b365-5d9f-06f83d5efe67.png)\n\n## \u6539\u826f\u3057\u305fCPU\n\n\u521d\u671f\u5316\u5b8c\u4e86\u304b\u3089\u5b9f\u884c\u7d42\u4e86\u307e\u3067563\u30af\u30ed\u30c3\u30af\u304b\u304b\u308a\u3001\u6700\u521d\u306eCPU\u306b\u6bd4\u3079\u3066\u3053\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u5834\u5408\u306f\u7d042.59\u500d\u901f\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n\u30b9\u30c8\u30fc\u30eb\u3084\u30b8\u30e3\u30f3\u30d7\u306a\u3069\u306e\u4f8b\u5916\u3092\u9664\u3044\u3066\u30011\u547d\u4ee4\u3042\u305f\u308a1\u30af\u30ed\u30c3\u30af\u3067\u5b9f\u884c\u3067\u304d\u3066\u3044\u307e\u3059\u3002\n![\u6539\u826f\u3057\u305fCPU\u306e\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u7d50\u679c](https://qiita-image-store.s3.amazonaws.com/0/99656/c754a4ff-de6e-a3ee-2c57-4fedd7495c67.png)\n\n\n# \u307e\u3068\u3081\n\nVerilog\u3092\u7528\u3044\u3066Brainf*ck\u306e\u30a4\u30f3\u30bf\u30d7\u30ea\u30bf(Brainf*ck\u3092\u547d\u4ee4\u30bb\u30c3\u30c8\u3068\u3059\u308bCPU)\u3092\u5b9f\u88c5\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\u307e\u305f\u3001\u524d\u306e\u547d\u4ee4\u306e\u5b9f\u884c\u304c\u5b8c\u4e86\u3059\u308b\u524d\u306b\u6b21\u306e\u547d\u4ee4\u306e\u5b9f\u884c\u3092\u59cb\u3081\u308b\u3053\u3068\u3067\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u5b9f\u884c\u306b\u304b\u304b\u308b\u30af\u30ed\u30c3\u30af\u6570\u3092\u6e1b\u3089\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n"}