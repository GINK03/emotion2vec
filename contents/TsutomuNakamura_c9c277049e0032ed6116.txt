{"tags": ["Linux", "lvm"], "context": " More than 1 year has passed since last update.\n\n\u524d\u56de\u8a18\u4e8b\nLVM\u3067\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u4f5c\u6210\u3001\u62e1\u5f35\u3001\u7e2e\u5c0f\u3001\u8907\u88fd\n\nLVM \u3067RAID1 \u3092\u69cb\u7bc9\u3059\u308b\n\u6b21\u306fRAID1 \u306e\u4e0a\u306bLVM \u3092\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u4eca\u5ea6\u306fRAID1 \u306e\u4e0a\u306bLVM \u3092\u69cb\u7bc9\u3057\u3001\u9ad8\u53ef\u7528\u6027\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002\n\n\u7269\u7406\u30c7\u30d0\u30a4\u30b9\u306e\u69cb\u6210\u3068\u3057\u3066\u306fLVM\u3067\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u4f5c\u6210\u3001\u62e1\u5f35\u3001\u7e2e\u5c0f\u3001\u8907\u88fd \u3068\u540c\u3058\u30c7\u30d0\u30a4\u30b9\u69cb\u6210\u3067\u5b9f\u65bd\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n/dev/md0 \u3092/dev/sdb1 \u3068/dev/sdc1 \u3067\u3001/dev/md1 \u3092/dev/sdd1 \u3068/dev/sde1 \u3067\u69cb\u7bc9\u3057\u3001\u3053\u308c\u3089\u304cLVM \u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306e\u7269\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u5fc5\u8981\u306a\u5bb9\u91cf\u306e\u898b\u7a4d\u3082\u308a\u306b\u3064\u3044\u3066\n\u666e\u6bb5\u3001\u7269\u7406\u7684\u306aRAID1 \u3092\u69cb\u7bc9\u3059\u308b\u5834\u5408\u3001\u7269\u7406\u30c7\u30d0\u30a4\u30b9(\u4f8b\u3048\u30701\u53f0 100GB \u5bb9\u91cf\u306eHDD) \u30922 \u53f0\u3067RAID1 \u3092\u69cb\u7bc9\u3057\u3066\u3082\u3001\u5229\u7528\u3067\u304d\u308b\u5bb9\u91cf\u306f\u7269\u7406\u30c7\u30d0\u30a4\u30b91 \u53f0\u5206\u306e100 GB \u306e\u5bb9\u91cf\u3057\u304b\u4f7f\u7528\u3067\u304d\u306a\u3044\u3053\u3068\u306f\u3001RAID1 \u69cb\u7bc9\u7d4c\u9a13\u8005\u3067\u3042\u308c\u3070\u3001\u7406\u89e3\u3067\u304d\u308b\u3067\u3057\u3087\u3046\u3002\nLVM \u4e0a\u3067RAID1 \u3092\u69cb\u7bc9\u3059\u308b\u5834\u5408\u306f\u3001\u5bb9\u91cf\u306e\u898b\u7a4d\u3082\u308a\u611f\u899a\u304c\u82e5\u5e72\u7570\u306a\u308b\u70b9\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u4f8b\u3048\u3070\u3001100 GB \u306eRAID1 \u9818\u57df\u3092\u4f5c\u6210\u3057\u305f\u3044\u5834\u5408\u306f\u3001\u305d\u306e2 \u500d\u306e\u9818\u57df\u304c\u5fc5\u8981\u3067\u3001\u307e\u305a\u7269\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u5408\u8a08\u3067200 GB \u306e\u9818\u57df\u3092\u78ba\u4fdd(\u3067\u304d\u308c\u3070\u3082\u3046\u5c11\u3057\u4f59\u88d5\u3092\u3082\u3063\u3066\u78ba\u4fdd)\u3057\u3001\u305d\u308c\u3092\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u30b0\u30eb\u30fc\u30d7\u306b\u52a0\u3048\u3001RAID1 \u3092\u69cb\u7bc9\u3057\u3001100 GB \u306eRAID1 \u5229\u7528\u53ef\u80fd\u9818\u57df\u304c\u3067\u304d\u308b\u3068\u3044\u3063\u305f\u611f\u899a\u3067\u898b\u7a4d\u3082\u308a\u307e\u3059\u3002\n\u3082\u3057\u304f\u306f\u9055\u3046\u8003\u3048\u65b9\u3068\u3057\u3066\u3001\u6700\u521d\u306b200GB \u306e\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u305f\u5834\u5408\u306f\u3001\u305d\u306e\u4e0a\u3067\u69cb\u7bc9\u3067\u304d\u308bRAID1 \u9818\u57df\u306f100GB \u4ee5\u4e0b\u306b\u306a\u308b\u3068\u3044\u3046\u3053\u3068\u3092\u7406\u89e3\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u4e00\u756a\u6700\u521d\u3001\u81ea\u5206\u306f\u3053\u308c\u3067\u5931\u6557\u3057\u307e\u3057\u305f...(\uff1b\u00b4\u0414`A)\n\n\u30c7\u30d0\u30a4\u30b9\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u524a\u9664\n\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u518d\u5ea6\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u3053\u308c\u3088\u308a\u524d\u306e\u624b\u9806\u3067\u65e2\u306b\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u6b21\u306e\u3088\u3046\u306a\u624b\u9806\u3067\u4e00\u65e6\u524a\u9664\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n$ sudo fdisk /dev/sdb\n\nCommand (m for help): d\nSelected partition 1\n\nCommand (m for help): w\nThe partition table has been altered!\n\nCalling ioctl() to re-read partition table.\nSyncing disks.\n\n\n/dev/sdb \u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u524a\u9664\u3057\u305f\u3089\u3001\u4ed6\u306e\u30c7\u30d0\u30a4\u30b9\u306b\u3082\u69cb\u6210\u3092\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n$ for I in {c,d,e,f}; do sudo sfdisk -d /dev/sdb | sudo sfdisk /dev/sd${I} --force; done\n\n\n\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u4f5c\u6210\n\u65b0\u305f\u306bfdisk \u30b3\u30de\u30f3\u30c9\u3067\u5404\u30c7\u30d0\u30a4\u30b9\u306b20GB \u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ sudo fdisk /dev/sdb\nDevice contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel\nBuilding a new DOS disklabel with disk identifier 0xccc65e15.\nChanges will remain in memory only, until you decide to write them.\nAfter that, of course, the previous content won't be recoverable.\n\nWarning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)\n\nCommand (m for help): n\nPartition type:\n   p   primary (0 primary, 0 extended, 4 free)\n   e   extended\nSelect (default p): p\nPartition number (1-4, default 1): 1\nFirst sector (2048-83886079, default 2048): \nUsing default value 2048\nLast sector, +sectors or +size{K,M,G} (2048-83886079, default 83886079): +20G\n\nCommand (m for help): t\nSelected partition 1\nHex code (type L to list codes): 8e\nChanged system type of partition 1 to 8e (Linux LVM)\n\nCommand (m for help): w\nThe partition table has been altered!\n\nCalling ioctl() to re-read partition table.\nSyncing disks.\n\n\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u4ed6\u30c7\u30d0\u30a4\u30b9\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n$ for I in {c,d,e}; do sudo sfdisk -d /dev/sdb | sudo sfdisk /dev/sd${I} --force; done\n\n\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002\n$ sudo pvcreate /dev/sdb1 /dev/sdc1 /dev/sdd1 /dev/sde1\n$ sudo vgcreate lvg-share /dev/sdb1 /dev/sdc1 /dev/sdd1 /dev/sde1\n$ sudo lvcreate --name public --size 18G lvg-share\n$ sudo lvcreate --name media --size 8GB lvg-share\n$ sudo lvcreate --name document --size 6GB lvg-share\n\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ sudo mkfs.ext4 /dev/lvg-share/public\n$ sudo mkfs.xfs /dev/lvg-share/media\n$ sudo mkfs.reiserfs /dev/lvg-share/document\n\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001\u4e00\u65e6\u30de\u30a6\u30f3\u30c8\u3057\u3066\u307f\u307e\u3059\u3002\n$ sudo mount /dev/lvg-share/public /mnt/public\n$ sudo mount /dev/lvg-share/media /mnt/media\n$ sudo mount /dev/lvg-share/document /mnt/document\n$ df -h\n.......\n/dev/mapper/lvg--share-public     18G   44M   17G   1% /mnt/public\n/dev/mapper/lvg--share-media     8.0G   33M  8.0G   1% /mnt/media\n/dev/mapper/lvg--share-document  7.0G   33M  7.0G   1% /mnt/document\n\n\n\u65e2\u5b58\u30c7\u30fc\u30bf\u306e\u9000\u907f\n\u3053\u3053\u3067\u3001/dev/sdc1(/dev/md0 \u306e\u30bb\u30ab\u30f3\u30c0\u30ea)\u3068/dev/sde1(/dev/md1 \u306e\u30bb\u30ab\u30f3\u30c0\u30ea)\u306e\u30c7\u30fc\u30bf\u3092\u6b8b\u308a\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3(/dev/sdb1, /dev/sdd1)\u306b\u9000\u907f\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u3053\u306e2 \u3064\u306e\u7269\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u306f\u3001\u5f8c\u307b\u3069RAID1 \u3092\u69cb\u7bc9\u3059\u308b\u3068\u304d\u306b\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u3057\u3066\u3001RAID1 \u306e\u30bb\u30ab\u30f3\u30c0\u30ea\u30dc\u30ea\u30e5\u30fc\u30e0\u3068\u3057\u3066\u8ffd\u52a0\u3057\u307e\u3059\u304c\u3001\u65e2\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\u30c7\u30fc\u30bf\u3092\u5931\u308f\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u306e\u65b9\u6cd5\u3067\u3059\u3002\n\u307e\u305a\u3001\u73fe\u5728\u306e\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n$ sudo pvdisplay\n  --- Physical volume ---\n  PV Name               /dev/sdb1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               511\n  Allocated PE          4608\n  PV UUID               Sf0Pph-cQxd-fRJH-1TdU-iiCR-WjmF-w9fdxL\n\n  --- Physical volume ---\n  PV Name               /dev/sdc1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               1535\n  Allocated PE          3584\n  PV UUID               u0oCVN-FH5t-nsXn-32zr-x0wL-PLEH-Bm5pQO\n\n  --- Physical volume ---\n  PV Name               /dev/sdd1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               5119\n  Allocated PE          0\n  PV UUID               Qaj34D-N5Fj-ktA1-OO5M-lwf2-COM5-VzABEK\n\n  --- Physical volume ---\n  PV Name               /dev/sde1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               5119\n  Allocated PE          0\n  PV UUID               NUBljh-9EnD-e2oT-9MYS-vckQ-DKdz-TQxaRU\n\n/dev/sdc1 \u306e\u30c7\u30fc\u30bf\u3092\u9000\u907f\u3057\u307e\u3059\u3002\n$ sudo modprobe dm-mirror\n$ sudo pvmove /dev/sdc1\n  /dev/sdc1: Moved: 0.1%\n  /dev/sdc1: Moved: 4.7%\n.......\n  /dev/sdc1: Moved: 97.9%\n  /dev/sdc1: no pvmove in progress - already finished or aborted.\n\n/dev/sdc1 \u306e\u30c7\u30fc\u30bf\u79fb\u884c\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001pvdisplay \u30b3\u30de\u30f3\u30c9\u3067\u7d50\u679c\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n$ sudo pvdisplay\n  --- Physical volume ---\n  PV Name               /dev/sdb1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               511\n  Allocated PE          4608\n  PV UUID               Sf0Pph-cQxd-fRJH-1TdU-iiCR-WjmF-w9fdxL\n\n  --- Physical volume ---\n  PV Name               /dev/sdc1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               5119\n  Allocated PE          0\n  PV UUID               u0oCVN-FH5t-nsXn-32zr-x0wL-PLEH-Bm5pQO\n\n  --- Physical volume ---\n  PV Name               /dev/sdd1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               1535\n  Allocated PE          3584\n  PV UUID               Qaj34D-N5Fj-ktA1-OO5M-lwf2-COM5-VzABEK\n\n  --- Physical volume ---\n  PV Name               /dev/sde1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               5119\n  Allocated PE          0\n  PV UUID               NUBljh-9EnD-e2oT-9MYS-vckQ-DKdz-TQxaRU\n\n\u4e0a\u8a18\u306e\u7d50\u679c\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001/dev/sdc1 \u306b\u683c\u7d0d\u3055\u308c\u3066\u3044\u305f3584 \u7269\u7406\u30a8\u30af\u30b9\u30c6\u30f3\u30c8\u304c\u3001/dev/sdd1 \u306b\u79fb\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\u30c7\u30fc\u30bf\u306e\u9000\u907f\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3089\u3001/dev/sdc1 \u3092\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u30b0\u30eb\u30fc\u30d7\u304b\u3089\u306f\u305a\u3057\u3001\u7269\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u3082\u524a\u9664\u3057\u307e\u3059\u3002\n$ sudo vgreduce lvg-share /dev/sdc1\n$ sudo pvremove /dev/sdc1\n$ sudo pvdisplay\n  --- Physical volume ---\n  PV Name               /dev/sdb1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               511\n  Allocated PE          4608\n  PV UUID               Sf0Pph-cQxd-fRJH-1TdU-iiCR-WjmF-w9fdxL\n\n  --- Physical volume ---\n  PV Name               /dev/sdd1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               1535\n  Allocated PE          3584\n  PV UUID               Qaj34D-N5Fj-ktA1-OO5M-lwf2-COM5-VzABEK\n\n  --- Physical volume ---\n  PV Name               /dev/sde1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               5119\n  Allocated PE          0\n  PV UUID               NUBljh-9EnD-e2oT-9MYS-vckQ-DKdz-TQxaRU\n\n\u7d9a\u3051\u3066/dev/sde1 \u7269\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u306b\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u30c7\u30fc\u30bf\u3092\u79fb\u884c\u3057\u307e\u3059\u3002\n$ sudo pvmove /dev/sde1\n  No data to move for lvg-share\n\n\u4eca\u56de\u306f\u3001/dev/sde1 \u306b\u30c7\u30fc\u30bf\u306f\u542b\u307e\u308c\u3066\u3044\u306a\u304b\u3063\u305f\u305f\u3081\u3001\u4f55\u3082\u8d77\u3053\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n/dev/sde1 \u3092\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u30b0\u30eb\u30fc\u30d7\u304b\u3089\u306f\u305a\u3057\u3001\u7269\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u3082\u524a\u9664\u3057\u307e\u3059\u3002\n$ sudo vgreduce lvg-share /dev/sde1\n$ sudo pvremove /dev/sde1\n$ sudo pvdisplay\n  --- Physical volume ---\n  PV Name               /dev/sdb1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               511\n  Allocated PE          4608\n  PV UUID               Sf0Pph-cQxd-fRJH-1TdU-iiCR-WjmF-w9fdxL\n\n  --- Physical volume ---\n  PV Name               /dev/sdd1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               1535\n  Allocated PE          3584\n  PV UUID               Qaj34D-N5Fj-ktA1-OO5M-lwf2-COM5-VzABEK\n\n\nRAID1 \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\n\u7269\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u53d6\u308a\u5916\u3057\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001/dev/sdc1 \u3068/dev/sde1 \u3092Linux RAID autodetect \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ sudo fdisk /dev/sdc\n\nCommand (m for help): t\nSelected partition 1\nHex code (type L to list codes): L\n\n 0  Empty           24  NEC DOS         81  Minix / old Lin bf  Solaris        \n 1  FAT12           27  Hidden NTFS Win 82  Linux swap / So c1  DRDOS/sec (FAT-\n 2  XENIX root      39  Plan 9          83  Linux           c4  DRDOS/sec (FAT-\n 3  XENIX usr       3c  PartitionMagic  84  OS/2 hidden C:  c6  DRDOS/sec (FAT-\n 4  FAT16 <32M      40  Venix 80286     85  Linux extended  c7  Syrinx         \n 5  Extended        41  PPC PReP Boot   86  NTFS volume set da  Non-FS data    \n 6  FAT16           42  SFS             87  NTFS volume set db  CP/M / CTOS / .\n 7  HPFS/NTFS/exFAT 4d  QNX4.x          88  Linux plaintext de  Dell Utility   \n 8  AIX             4e  QNX4.x 2nd part 8e  Linux LVM       df  BootIt         \n 9  AIX bootable    4f  QNX4.x 3rd part 93  Amoeba          e1  DOS access     \n a  OS/2 Boot Manag 50  OnTrack DM      94  Amoeba BBT      e3  DOS R/O        \n b  W95 FAT32       51  OnTrack DM6 Aux 9f  BSD/OS          e4  SpeedStor      \n c  W95 FAT32 (LBA) 52  CP/M            a0  IBM Thinkpad hi eb  BeOS fs        \n e  W95 FAT16 (LBA) 53  OnTrack DM6 Aux a5  FreeBSD         ee  GPT            \n f  W95 Ext'd (LBA) 54  OnTrackDM6      a6  OpenBSD         ef  EFI (FAT-12/16/\n10  OPUS            55  EZ-Drive        a7  NeXTSTEP        f0  Linux/PA-RISC b\n11  Hidden FAT12    56  Golden Bow      a8  Darwin UFS      f1  SpeedStor      \n12  Compaq diagnost 5c  Priam Edisk     a9  NetBSD          f4  SpeedStor      \n14  Hidden FAT16 <3 61  SpeedStor       ab  Darwin boot     f2  DOS secondary  \n16  Hidden FAT16    63  GNU HURD or Sys af  HFS / HFS+      fb  VMware VMFS    \n17  Hidden HPFS/NTF 64  Novell Netware  b7  BSDI fs         fc  VMware VMKCORE \n18  AST SmartSleep  65  Novell Netware  b8  BSDI swap       fd  Linux raid auto\n1b  Hidden W95 FAT3 70  DiskSecure Mult bb  Boot Wizard hid fe  LANstep        \n1c  Hidden W95 FAT3 75  PC/IX           be  Solaris boot    ff  BBT            \n1e  Hidden W95 FAT1 80  Old Minix      \nHex code (type L to list codes): fd\nChanged system type of partition 1 to fd (Linux raid autodetect)\n\nCommand (m for help): w\nThe partition table has been altered!\n\nCalling ioctl() to re-read partition table.\nSyncing disks.\n\n/dev/sdc \u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092/dev/sde \u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n$ sudo sfdisk -d /dev/sdc | sudo sfdisk /dev/sde --force\n\n\u73fe\u5728\u306e\u30c7\u30d0\u30a4\u30b9\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ sudo fdisk -l\n\n......\n\nDisk /dev/sdc: 42.9 GB, 42949672960 bytes\n255 heads, 63 sectors/track, 5221 cylinders, total 83886080 sectors\nUnits # sectors of 1 * 512  512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk identifier: 0x00000000\n\n   Device Boot      Start         End      Blocks   Id  System\n/dev/sdc1            2048    41945087    20971520   fd  Linux raid autodetect\n\n......\n\nDisk /dev/sde: 42.9 GB, 42949672960 bytes\n255 heads, 63 sectors/track, 5221 cylinders, total 83886080 sectors\nUnits # sectors of 1 * 512  512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk identifier: 0x00000000\n\n   Device Boot      Start         End      Blocks   Id  System\n/dev/sde1            2048    41945087    20971520   fd  Linux raid autodetect\n\n\n\u6b21\u306b\u3001RAID1 \u3092\u69cb\u7bc9\u3057\u3066\u3044\u304d\u307e\u3059\u3002\nRAID1 \u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306b/dev/sdc1 \u3092/dev/md0 \u30c7\u30d0\u30a4\u30b9\u306b\u3001/dev/sde1 \u3092/dev/md1 \u30c7\u30d0\u30a4\u30b9\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n/dev/sdb1 \u3068/dev/sdd1 \u306f\u3001\u307e\u3060\u3053\u306e\u6bb5\u968e\u3067\u306f\u8ffd\u52a0\u3057\u307e\u305b\u3093\u3002\n\u305d\u306e\u305f\u3081\u3001/dev/sdc1, /dev/sde1 \u3092\u8ffd\u52a0\u3059\u308b\u306b\u306fmdadm \u30b3\u30de\u30f3\u30c9\u306bmissing \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u3066\u5b9f\u884c\u3057\u307e\u3059\u3002\n$ sudo mdadm --create /dev/md0 --auto=yes -l 1 -n 2 /dev/sdc1 missing\nmdadm: Note: this array has metadata at the start and\n    may not be suitable as a boot device.  If you plan to\n    store '/boot' on this device please ensure that\n    your boot-loader understands md/v1.x metadata, or use\n    --metadata=0.90\nContinue creating array? y\nmdadm: Defaulting to version 1.2 metadata\nmdadm: array /dev/md0 started.\n\n$ sudo mdadm --create /dev/md1 --auto=yes -l 1 -n 2 /dev/sde1 missing\nmdadm: Note: this array has metadata at the start and\n    may not be suitable as a boot device.  If you plan to\n    store '/boot' on this device please ensure that\n    your boot-loader understands md/v1.x metadata, or use\n    --metadata=0.90\nContinue creating array? y\nmdadm: Defaulting to version 1.2 metadata\nmdadm: array /dev/md1 started.\n\n\n\nRAID1 \u306e\u30c7\u30d0\u30a4\u30b9\u540d\u30ba\u30ec\u89e3\u6d88\nOS \u518d\u8d77\u52d5\u6642\u306bRAID1 \u306e\u30c7\u30d0\u30a4\u30b9\u540d(md0, md1)\u304c\u305a\u308c\u308b(md127 \u7b49\u306b)\u3053\u3068\u304c\u3042\u308b\u306e\u3067\u3001\u4e8b\u524d\u306bmdadm.conf \u30d5\u30a1\u30a4\u30eb\u306b\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n/etc/mdadm/mdadm.conf\n$ cp -ip /etc/mdadm/mdadm.conf /etc/mdadm/mdadm.conf.org\n\n$ echo \"DEVICE partitions\" | sudo tee -a /etc/mdadm/mdadm.conf\nDEVICE partitions\n\n$ sudo mdadm --detail --scan | sudo tee -a /etc/mdadm/mdadm.conf\nARRAY /dev/md0 metadata#1.2 name=lvm-test-on-pdv:0 UUID7a359312:522cb81f:a99b6b1b:b9b3efb9\nARRAY /dev/md1 metadata#1.2 name=lvm-test-on-pdv:1 UUIDda70e87b:01242494:f0b45f80:e575ea0e\n\n\n/etc/mdadm/mdadm.conf \u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304d\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u6700\u5f8c\u306e\u65b9\u306b\u6b21\u306e\u3088\u3046\u306a\u5b9a\u7fa9\u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ sudo vim /etc/mdadm/mdadm.conf\n.......\nDEVICE partitions\nARRAY /dev/md0 metadata#1.2 name=lvm-test-on-pdv:0 UUID7a359312:522cb81f:a99b6b1b:b9b3efb9\nARRAY /dev/md1 metadata#1.2 name=lvm-test-on-pdv:1 UUIDda70e87b:01242494:f0b45f80:e575ea0e\n\ninitramfs \u30a4\u30e1\u30fc\u30b8\u3092\u518d\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ sudo update-initramfs -u\n\n\u53ef\u80fd\u3067\u3042\u308c\u3070\u3001OS \u3092\u518d\u8d77\u52d5\u3057\u3066RAID \u30c7\u30d0\u30a4\u30b9\u540d\u304c\u5909\u66f4\u3055\u308c\u3066\u3044\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\nRAID1 \u306e\u69cb\u7bc9\n/dev/md0 \u3068/dev/md1 \u3092\u7269\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u3068\u3057\u3066\u767b\u9332\u3057\u307e\u3059\u3002\n$ sudo pvcreate /dev/md0 /dev/md1\n  Physical volume \"/dev/md0\" successfully created\n  Physical volume \"/dev/md1\" successfully created\n\n/dev/md0 \u3068/dev/md1 \u3092lvg-share \u30dc\u30ea\u30e5\u30fc\u30e0\u30b0\u30eb\u30fc\u30d7\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n$ sudo vgextend lvg-share /dev/md0 /dev/md1\n  Volume group \"lvg-share\" successfully extended\n\npvdisplay \u30b3\u30de\u30f3\u30c9\u3068vgdisplay \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u72b6\u614b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\npvdisplay\n$ sudo pvdisplay\n  --- Physical volume ---\n  PV Name               /dev/sdb1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               511\n  Allocated PE          4608\n  PV UUID               MQWAVQ-IAY5-0KPR-F5Dq-WbI9-jk8T-7UuIyz\n\n  --- Physical volume ---\n  PV Name               /dev/sdd1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               1535\n  Allocated PE          3584\n  PV UUID               NHHOBT-eAkD-Uffv-CAcs-oa2y-2yqN-cho3UO\n\n  --- Physical volume ---\n  PV Name               /dev/md0\n  VG Name               lvg-share\n  PV Size               19.98 GiB / not usable 3.88 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5115\n  Free PE               5115\n  Allocated PE          0\n  PV UUID               nKzZBM-UEi0-jK0T-2riv-ceej-7a0N-hmWupv\n\n  --- Physical volume ---\n  PV Name               /dev/md1\n  VG Name               lvg-share\n  PV Size               19.98 GiB / not usable 3.88 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5115\n  Free PE               5115\n  Allocated PE          0\n  PV UUID               M7oAVU-kU9W-vhxf-80Cx-fGHw-yHMw-VjZXS3\n\n\n\nvgdisplay\n$ sudo vgdisplay\n  --- Volume group ---\n  VG Name               lvg-share\n  System ID             \n  Format                lvm2\n  Metadata Areas        4\n  Metadata Sequence No  11\n  VG Access             read/write\n  VG Status             resizable\n  MAX LV                0\n  Cur LV                3\n  Open LV               3\n  Max PV                0\n  Cur PV                4\n  Act PV                4\n  VG Size               79.95 GiB\n  PE Size               4.00 MiB\n  Total PE              20468\n  Alloc PE / Size       8192 / 32.00 GiB\n  Free  PE / Size       12276 / 47.95 GiB\n  VG UUID               Xkf0yt-YxbZ-dTN3-KFMa-g1wz-ax3v-4dSfAf\n\n\n\u3044\u3088\u3044\u3088/dev/sdb1 \u3092/dev/md0 \u3078\u3001/dev/sdd1 \u3092/dev/md1 RAID \u30a2\u30ec\u30a4\u3078\u8ffd\u52a0\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u307e\u305a\u306f\u3001/dev/sdb1 \u3068/dev/sdd1 \u306e\u30c7\u30fc\u30bf\u3092/dev/md0 \u53ca\u3073/dev/md1 \u3078\u9000\u907f\u3057\u307e\u3059\u3002\n$ sudo pvmove /dev/sdb1 /dev/md0\n  /dev/sdb1: Moved: 0.1%\n.......\n  /dev/sdb1: Moved: 100.0%\n\n$ sudo pvmove /dev/sdd1 /dev/md1\n  /dev/sdd1: Moved: 0.0%\n.......\n  /dev/sdd1: Moved: 100.0%\n\n/dev/sdb1 \u3068/dev/sdd1 \u3092\u30dc\u30ea\u30e5\u30fc\u30e0\u30b0\u30eb\u30fc\u30d7\u304b\u3089\u5916\u3057\u307e\u3059\u3002\n$ sudo vgreduce lvg-share /dev/sdb1 /dev/sdd1\n  Removed \"/dev/sdb1\" from volume group \"lvg-share\"\n  Removed \"/dev/sdd1\" from volume group \"lvg-share\"\n\n$ sudo pvremove /dev/sdb1 /dev/sdd1\n  Labels on physical volume \"/dev/sdb1\" successfully wiped\n  Labels on physical volume \"/dev/sdd1\" successfully wiped\n\npvdisplay \u30b3\u30de\u30f3\u30c9\u3067\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n/dev/md0, /dev/md1 \u306e\u307f\u304c\u6b8b\u3063\u3066\u3044\u308b\u72b6\u614b\u3067\u3059\u3002\n$ sudo pvdisplay\n  --- Physical volume ---\n  PV Name               /dev/md0\n  VG Name               lvg-share\n  PV Size               19.98 GiB / not usable 3.88 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5115\n  Free PE               507\n  Allocated PE          4608\n  PV UUID               nKzZBM-UEi0-jK0T-2riv-ceej-7a0N-hmWupv\n\n  --- Physical volume ---\n  PV Name               /dev/md1\n  VG Name               lvg-share\n  PV Size               19.98 GiB / not usable 3.88 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5115\n  Free PE               1531\n  Allocated PE          3584\n  PV UUID               M7oAVU-kU9W-vhxf-80Cx-fGHw-yHMw-VjZXS3\n\n\u6b21\u306b\u3001\u5148\u307b\u3069\u30dc\u30ea\u30e5\u30fc\u30e0\u30b0\u30eb\u30fc\u30d7\u304b\u3089\u5916\u3057\u305f/dev/sdb1 \u3068/dev/sdd1 \u3092Linux raid autodetect \u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3057\u307e\u3059\u3002\n$ sudo fdisk /dev/sdb\n\nCommand (m for help): t\nSelected partition 1\nHex code (type L to list codes): fd\nChanged system type of partition 1 to fd (Linux raid autodetect)\n\nCommand (m for help): w\nThe partition table has been altered!\n\nCalling ioctl() to re-read partition table.\nSyncing disks.\n\n$ sudo sfdisk -d /dev/sdb | sudo sfdisk /dev/sdd --force\n\n/dev/sdb1 \u3092/dev/md0, /dev/sdd1 \u3092/dev/md1 \u3078\u8ffd\u52a0\u3057\u307e\u3059\u3002\n$ sudo mdadm --manage /dev/md0 --add /dev/sdb1\nmdadm: added /dev/sdb1\n\n$ sudo mdadm --manage /dev/md1 --add /dev/sdd1\nmdadm: added /dev/sdd1\n\n\u3053\u308c\u3067RAID1 \u306e\u540c\u671f\u304c\u958b\u59cb\u3055\u308c\u307e\u3057\u305f\u3002\n\u540c\u671f\u306e\u9032\u6357\u306f\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n$ sudo cat /proc/mdstat\nPersonalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10] \nmd1 : active raid1 sdd1[2] sde1[0]\n      20955008 blocks super 1.2 [2/1] [U_]\n      [>....................]  recovery #  1.7% (368000/20955008) finish=22.3min speed15333K/sec\n\nmd0 : active raid1 sdb1[2] sdc1[0]\n      20955008 blocks super 1.2 [2/1] [U_]\n      [#=>..................]  recovery = 10.7% (2259008/20955008) finish=12.7min speed24390K/sec\n\nunused devices: <none>\n\n\u540c\u671f\u304c\u5b8c\u4e86\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\nunuses devices: <none>\nnalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10] \nmd1 : active raid1 sdd1[2] sde1[0]\n      20955008 blocks super 1.2 [2/2] [UU]\n\nmd0 : active raid1 sdb1[2] sdc1[0]\n      20955008 blocks super 1.2 [2/2] [UU]\n\nunused devices: <none>\n\n\u540c\u671f\u304c\u5b8c\u4e86\u3059\u308c\u3070\u3001RAID1 \u306e\u69cb\u7bc9\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n\u30c7\u30a3\u30b9\u30af\u969c\u5bb3\u3092\u60f3\u5b9a\u3057\u305f\u624b\u9806\n\u3053\u3053\u3067\u306f\u3001/dev/sdc\u3068/dev/sde \u30c7\u30a3\u30b9\u30af\u306b\u969c\u5bb3\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u3092\u60f3\u5b9a\u3057\u305f\u624b\u9806\u3092\u5b9f\u65bd\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u307e\u305a\u306f\u3001mdadm \u30b3\u30de\u30f3\u30c9\u306e--fail\u3067\u4e0d\u826f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\u6b21\u306b--remove \u3092\u4f7f\u7528\u3057\u3066\u4e0d\u826f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092RAID \u304b\u3089\u5207\u308a\u96e2\u3057\u307e\u3059\u3002\n$ sudo mdadm --manage /dev/md0 --fail /dev/sdc1\nmdadm: set /dev/sdc1 faulty in /dev/md0\n$ sudo mdadm --manage /dev/md0 --remove /dev/sdc1\nmdadm: hot removed /dev/sdc1 from /dev/md0\n$ sudo mdadm --manage /dev/md1 --fail /dev/sde1\nmdadm: set /dev/sde1 faulty in /dev/md1\n$ sudo mdadm --manage /dev/md1 --remove /dev/sde1\nmdadm: hot removed /dev/sde1 from /dev/md1\n\nRAID1 \u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ cat /proc/mdstat\nPersonalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10] \nmd1 : active raid1 sdd1[2]\n      20955008 blocks super 1.2 [2/1] [_U]\n\nmd0 : active raid1 sdb1[2]\n      20955008 blocks super 1.2 [2/1] [_U]\n\nunused devices: <none>\n\n\u5207\u308a\u96e2\u3057\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002\n\u3053\u306e\u5f8c\u3001\u5b9f\u969b\u306e\u696d\u52d9\u7b49\u3067\u306f\u7269\u7406\u30c7\u30d0\u30a4\u30b9\u3092\u5165\u308c\u66ff\u3048\u3001/dev/sdc, /dev/sde \u3092\u53d6\u308a\u66ff\u3048\u3092\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u5b66\u7fd2\u76ee\u7684\u306a\u306e\u3067\u3001\u7269\u7406\u30c7\u30d0\u30a4\u30b9\u306e\u5165\u308c\u66ff\u3048\u306f\u884c\u308f\u305a\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u524a\u9664\u3057\u3066\u672a\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u72b6\u614b\u306e\u7269\u7406\u30c7\u30d0\u30a4\u30b9\u3068\u3057\u3066\u518d\u751f\u3057\u307e\u3059\u3002\n\n\u308f\u3056\u3068\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u58ca\u3059\n$ for I in {c,e}; do sudo dd if#/dev/zero of=/dev/sd${I} bs=1024 count$(echo \"1 * 1024 * 100\" | bc); done\n.......\n\n$ sudo fdisk -l /dev/sdc\nDisk /dev/sdc: 42.9 GB, 42949672960 bytes\n255 heads, 63 sectors/track, 5221 cylinders, total 83886080 sectors\nUnits # sectors of 1 * 512  512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk identifier: 0x00000000\n\nDisk /dev/sdc doesn't contain a valid partition table\n\n$ sudo fdisk -l /dev/sde\n.......\n\n\n/dev/sdb \u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092/dev/sdc, /dev/sde \u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n$ for I in {c,e}; do sudo sfdisk -d /dev/sdb | sudo sfdisk /dev/sd${I} --force; done\n\u203b\u4eca\u56de\u306f/dev/sdb \u3068\u540c\u3058\u69cb\u6210\u3067\u554f\u984c\u306a\u3044\u305f\u3081\u3053\u306e\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n/dev/sdc \u3068/dev/sde \u3092\u3001\u305d\u308c\u305e\u308c/dev/md0 \u3068/dev/md1 \u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n$ sudo mdadm --manage /dev/md0 --add /dev/sdc1\nmdadm: added /dev/sdc1\n\n$ sudo mdadm --manage /dev/md1 --add /dev/sde1\nmdadm: added /dev/sde1\n\n\u540c\u671f\u306e\u9032\u6357\u72b6\u614b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ cat /proc/mdstat\nPersonalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10] \nmd1 : active raid1 sde1[3] sdd1[2]\n      20955008 blocks super 1.2 [2/1] [_U]\n      [>....................]  recovery #  1.5% (332544/20955008) finish=22.7min speed15115K/sec\n\nmd0 : active raid1 sdc1[3] sdb1[2]\n      20955008 blocks super 1.2 [2/1] [_U]\n      [#==>.................]  recovery = 18.0% (3784640/20955008) finish=12.1min speed23564K/sec\n\nunused devices: <none>\n\n\u540c\u671f\u304c\u5b8c\u4e86\u3059\u308c\u3070\u6210\u529f\u3067\u3059\u3002\n\n\u7269\u7406\u30c7\u30d0\u30a4\u30b9\u306e\u3042\u307e\u308a\u9818\u57df\u3092\u4f7f\u7528\u3057\u3066\u3082\u3046\u3072\u3068\u3064RAID1 \u3092\u4f5c\u6210\u3059\u308b\n/dev/md2 \u3068/dev/md3 \u3092\u7269\u7406\u30c7\u30d0\u30a4\u30b9\u306e\u6b8b\u308a\u9818\u57df\u3092\u4f7f\u7528\u3057\u3066\u4f5c\u6210\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u3053\u3053\u3067\u306f\u3001/dev/sdb \u3068/dev/sdc \u306b\u4f59\u308a\u306e\u672a\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u9818\u57df\u304c\u3042\u308b\u3053\u3068\u3092\u60f3\u5b9a\u3057\u3001/dev/md2 \u306b/dev/sdb2 \u3068/dev/sdc2\u3001/dev/md3 \u306b/dev/sdd2 \u3068/dev/sde2 \u3092\u4f7f\u7528\u3057\u3066\u3082\u3046\u3072\u3068\u3064RAID1 \u3092\u4f5c\u6210\u3057\u3066\u307f\u307e\u3059\u3002\n\u4eca\u56de\u306e\u624b\u9806\u306f\u3001VM \u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u5b9f\u969b\u306f\u4f8b\u3048\u3070/dev/sdg\u3084/dev/sdh \u7b49\u306e\u7269\u7406\u30c7\u30d0\u30a4\u30b9\u3092\u5897\u8a2d\u3057\u3066 \u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u5bb9\u91cf\u3092\u5897\u3084\u3059\u3068\u3044\u3063\u305f\u30b7\u30c1\u30e5\u30a8\u30fc\u30b7\u30e7\u30f3\u3067\u5f79\u306b\u7acb\u3063\u305f\u308a\u3057\u307e\u3059\u3002\n\u307e\u305a\u3001\u5404\u7269\u7406\u30c7\u30d0\u30a4\u30b9\u306e\u6b8b\u308a\u9818\u57df\u3092\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3057\u307e\u3059\u3002\n$ sudo fdisk /dev/sdb\nCommand (m for help): p\n\nDisk /dev/sdb: 42.9 GB, 42949672960 bytes\n246 heads, 3 sectors/track, 113666 cylinders, total 83886080 sectors\nUnits # sectors of 1 * 512  512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk identifier: 0x253bf895\n\n   Device Boot      Start         End      Blocks   Id  System\n/dev/sdb1            2048    41945087    20971520   fd  Linux raid autodetect\n\nCommand (m for help): n\nPartition type:\n   p   primary (1 primary, 0 extended, 3 free)\n   e   extended\nSelect (default p): p\nPartition number (1-4, default 2): \nUsing default value 2\nFirst sector (41945088-83886079, default 41945088): \nUsing default value 41945088\nLast sector, +sectors or +size{K,M,G} (41945088-83886079, default 83886079): \nUsing default value 83886079\n\nCommand (m for help): t\nPartition number (1-4): 2\nHex code (type L to list codes): fd\nChanged system type of partition 2 to fd (Linux raid autodetect)\n\nCommand (m for help): w\nThe partition table has been altered!\n\nCalling ioctl() to re-read partition table.\n\nWARNING: Re-reading the partition table failed with error 16: Device or resource busy.\nThe kernel still uses the old table. The new table will be used at\nthe next reboot or after you run partprobe(8) or kpartx(8)\nSyncing disks.\n\n\u4ed6\u306e\u7269\u7406\u30c7\u30d0\u30a4\u30b9\u306b\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n$ for I in {c,d,e}; do sudo sfdisk -d /dev/sdb | sudo sfdisk /dev/sd${I} --force; done\n\n\nTODO: OS \u3092\u518d\u8d77\u52d5\u3057\u306a\u3044\u3068/dev/sdb2\u301c/dev/sde2 \u304c\u51fa\u73fe\u3057\u306a\u3044\uff01\uff1f\n\n\u4eca\u56de\u306e\u81ea\u5206\u306e\u74b0\u5883\u3067\u306fOS \u3092\u518d\u8d77\u52d5\u3059\u308b\u3053\u3068\u3067/dev/sdb2\u301c/dev/sde2 \u304c\u51fa\u73fe\u3057\u307e\u3057\u305f\u3002\n/dev/sdb2 \u3068/dev/sdc2 \u3092/dev/md2 \u3078\u53d6\u308a\u8fbc\u307f\u307e\u3059\u3002\n$ sudo mdadm --create /dev/md2 --auto=yes -l 1 -n 2 /dev/sdb2 /dev/sdc2\nmdadm: Note: this array has metadata at the start and\n    may not be suitable as a boot device.  If you plan to\n    store '/boot' on this device please ensure that\n    your boot-loader understands md/v1.x metadata, or use\n    --metadata=0.90\nContinue creating array? y\nmdadm: Defaulting to version 1.2 metadata\nmdadm: array /dev/md2 started.\n\n/dev/sdd2 \u3068/dev/sde2 \u3092/dev/md3 \u3078\u53d6\u308a\u8fbc\u307f\u307e\u3059\u3002\n$ sudo mdadm --create /dev/md3 --auto=yes -l 1 -n 2 /dev/sdd2 /dev/sde2\nmdadm: Note: this array has metadata at the start and\n    may not be suitable as a boot device.  If you plan to\n    store '/boot' on this device please ensure that\n    your boot-loader understands md/v1.x metadata, or use\n    --metadata=0.90\nContinue creating array? y\nmdadm: Defaulting to version 1.2 metadata\nmdadm: array /dev/md3 started.\n\n\u30c7\u30d0\u30a4\u30b9\u540d\u306e\u30ba\u30ec\u3092\u9632\u6b62\u3059\u308b\u305f\u3081\u306b\u3001mdadm.conf \u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n$ sudo mdadm --detail --scan | egrep '^ARRAY /dev/md[23]' | sudo tee -a /etc/mdadm/mdadm.conf\nARRAY /dev/md2 metadata#1.2 name=lvm-test-on-pdv:2 UUID366d696f:c5a69c4f:8b1d198e:d0c88a13\nARRAY /dev/md3 metadata#1.2 name=lvm-test-on-pdv:3 UUID0cf37c81:ec6324c2:01de9bd6:a23d8fb8\n\ninitramfs \u30a4\u30e1\u30fc\u30b8\u3092\u518d\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ sudo update-initramfs -u\n\n/dev/md2 \u3068/dev/md3 RAID1 \u306e\u540c\u671f\u9032\u6357\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ cat /proc/mdstat\nPersonalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10] \nmd3 : active raid1 sde2[1] sdd2[0]\n      20953984 blocks super 1.2 [2/2] [UU]\n\nmd2 : active raid1 sdc2[1] sdb2[0]\n      20953984 blocks super 1.2 [2/2] [UU]\n\nmd1 : active raid1 sde1[3] sdd1[2]\n      20955008 blocks super 1.2 [2/2] [UU]\n\nmd0 : active raid1 sdc1[3] sdb1[2]\n      20955008 blocks super 1.2 [2/2] [UU]\n\nunused devices: <none>\n\n\u7269\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u3068\u3057\u3066/dev/md2, /dev/md3 \u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n$ sudo pvcreate /dev/md2 /dev/md3\n\n/dev/md2, /dev/md3 \u3092\u30dc\u30ea\u30e5\u30fc\u30e0\u30b0\u30eb\u30fc\u30d7\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n$ sudo vgextend lvg-share /dev/md2 /dev/md3\n\npvdisplay \u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n$ sudo pvdisplay\n  --- Physical volume ---\n  PV Name               /dev/md0\n  VG Name               lvg-share\n  PV Size               19.98 GiB / not usable 3.88 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5115\n  Free PE               507\n  Allocated PE          4608\n  PV UUID               lMgkug-CfZE-STFc-L0aJ-mz77-BZnw-FMaeaU\n\n  --- Physical volume ---\n  PV Name               /dev/md1\n  VG Name               lvg-share\n  PV Size               19.98 GiB / not usable 3.88 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5115\n  Free PE               1531\n  Allocated PE          3584\n  PV UUID               kq6z6E-6nYu-u1Ad-TUEe-TZfL-RPHi-Lq18Jd\n\n  --- Physical volume ---\n  PV Name               /dev/md2\n  VG Name               lvg-share\n  PV Size               19.98 GiB / not usable 2.88 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5115\n  Free PE               5115\n  Allocated PE          0\n  PV UUID               qp8YU4-wuH3-VI3q-PnFD-bY4e-szHP-MVk2Mq\n\n  --- Physical volume ---\n  PV Name               /dev/md3\n  VG Name               lvg-share\n  PV Size               19.98 GiB / not usable 2.88 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5115\n  Free PE               5115\n  Allocated PE          0\n  PV UUID               2DXJxE-Kow7-1p8j-jw2I-29WI-VVNx-9NoeKt\n\n\nvgdisplay\n$ sudo vgdisplay\n  --- Volume group ---\n  VG Name               lvg-share\n  System ID             \n  Format                lvm2\n  Metadata Areas        4\n  Metadata Sequence No  21\n  VG Access             read/write\n  VG Status             resizable\n  MAX LV                0\n  Cur LV                3\n  Open LV               0\n  Max PV                0\n  Cur PV                4\n  Act PV                4\n  VG Size               79.92 GiB\n  PE Size               4.00 MiB\n  Total PE              20460\n  Alloc PE / Size       8192 / 32.00 GiB\n  Free  PE / Size       12268 / 47.92 GiB\n  VG UUID               DBgEtU-tjpa-jqcN-tKGV-Ped5-WKT0-BcGuv1\n\n\n\nlvdisplay\n$ sudo lvdisplay\n  --- Logical volume ---\n  LV Path                /dev/lvg-share/public\n  LV Name                public\n  VG Name                lvg-share\n  LV UUID                s6aaIK-Dfaz-dIkL-sybW-W5q2-9ANc-rorUbQ\n  LV Write Access        read/write\n  LV Creation host, time lvm-test-on-pdv, 2015-03-14 18:20:00 +0900\n  LV Status              available\n  # open                 0\n  LV Size                18.00 GiB\n  Current LE             4608\n  Segments               1\n  Allocation             inherit\n  Read ahead sectors     auto\n  - currently set to     256\n  Block device           252:0\n\n  --- Logical volume ---\n  LV Path                /dev/lvg-share/media\n  LV Name                media\n  VG Name                lvg-share\n  LV UUID                FZzDeD-lPFn-WEH3-JKPH-93eS-9y0z-RQeGht\n  LV Write Access        read/write\n  LV Creation host, time lvm-test-on-pdv, 2015-03-14 18:20:04 +0900\n  LV Status              available\n  # open                 0\n  LV Size                8.00 GiB\n  Current LE             2048\n  Segments               1\n  Allocation             inherit\n  Read ahead sectors     auto\n  - currently set to     256\n  Block device           252:1\n\n  --- Logical volume ---\n  LV Path                /dev/lvg-share/document\n  LV Name                document\n  VG Name                lvg-share\n  LV UUID                d00kFR-a0jk-YGwn-j53z-ZMav-nyy9-O9c3ft\n  LV Write Access        read/write\n  LV Creation host, time lvm-test-on-pdv, 2015-03-14 18:20:10 +0900\n  LV Status              available\n  # open                 0\n  LV Size                6.00 GiB\n  Current LE             1536\n  Segments               1\n  Allocation             inherit\n  Read ahead sectors     auto\n  - currently set to     256\n  Block device           252:2\n\n\n\n\u4e0a\u8a18\u30b3\u30de\u30f3\u30c9\u7d50\u679c\u3067\u7279\u306b\u554f\u984c\u304c\u7121\u3044\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u30b0\u30eb\u30fc\u30d7\u306e\u5bb9\u91cf\u304c\u5897\u3048\u305f\u306e\u3067\u3001\u3053\u308c\u3067\u4ed6\u306e\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u5bb9\u91cf\u3092\u5897\u3084\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u4eca\u56de\u306fxfs \u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306e/dev/lvg-share/media \u306e\u5bb9\u91cf\u30928GiB \u304b\u308928GiB \u306b\u62e1\u5f35\u3057\u3066\u307f\u307e\u3059\u3002\n$ sudo lvextend -L 28G /dev/lvg-share/media\n  Extending logical volume media to 28.00 GiB\n  Logical volume media successfully resized\n\nxfs \u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u62e1\u5f35\u3057\u307e\u3059\u3002\n$ sudo xfs_growfs /dev/lvg-share/media \nmeta-data#/dev/mapper/lvg--share-media isize=256    agcount=4, agsize524288 blks\n         #                       sectsz=512   attr2\ndata     #                       bsize=4096   blocks=2097152, imaxpct25\n         #                       sunit=0      swidth0 blks\nnaming   #version 2              bsize=4096   ascii-ci0\nlog      #internal               bsize=4096   blocks=2560, version2\n         #                       sectsz=512   sunit=0 blks, lazy-count1\nrealtime #none                   extsz=4096   blocks=0, rtextents0\ndata blocks changed from 2097152 to 7340032\n\ndf -h \u30b3\u30de\u30f3\u30c9\u3067\u30dc\u30ea\u30e5\u30fc\u30e0\u304c\u62e1\u5f35\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ df -h \nFilesystem                       Size  Used Avail Use% Mounted on\n/dev/sda1                         75G  1.2G   70G   2% /\nnone                             4.0K     0  4.0K   0% /sys/fs/cgroup\nudev                             2.0G  4.0K  2.0G   1% /dev\ntmpfs                            394M  3.2M  391M   1% /run\nnone                             5.0M     0  5.0M   0% /run/lock\nnone                             2.0G     0  2.0G   0% /run/shm\nnone                             100M     0  100M   0% /run/user\n/dev/mapper/lvg--share-media      28G   33M   28G   1% /mnt/media\n/dev/mapper/lvg--share-public     18G   44M   17G   1% /mnt/public\n/dev/mapper/lvg--share-document  6.0G   33M  6.0G   1% /mnt/document\n\n/mnt/media \u306e\u9818\u57df\u304c\u62e1\u5f35\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n\u6b21\u306e\u8a18\u4e8b\nLVM\u3067\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u4f5c\u6210\u3068\u72b6\u614b\u306e\u5fa9\u5143\n# \u524d\u56de\u8a18\u4e8b\n[LVM\u3067\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u4f5c\u6210\u3001\u62e1\u5f35\u3001\u7e2e\u5c0f\u3001\u8907\u88fd](http://qiita.com/TsutomuNakamura/items/93c6333c8dd32aeb197a \"LVM\u3067\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u4f5c\u6210\u3001\u62e1\u5f35\u3001\u7e2e\u5c0f\u3001\u8907\u88fd\")\n\n# LVM \u3067RAID1 \u3092\u69cb\u7bc9\u3059\u308b\n\u6b21\u306fRAID1 \u306e\u4e0a\u306bLVM \u3092\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u4eca\u5ea6\u306fRAID1 \u306e\u4e0a\u306bLVM \u3092\u69cb\u7bc9\u3057\u3001\u9ad8\u53ef\u7528\u6027\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002\n![LVM_CreateLVMRAID1_0000.png](https://qiita-image-store.s3.amazonaws.com/0/70152/a7b9b4ea-2a1c-6947-072c-6740a3355fdd.png)\n\n\u7269\u7406\u30c7\u30d0\u30a4\u30b9\u306e\u69cb\u6210\u3068\u3057\u3066\u306f[LVM\u3067\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u4f5c\u6210\u3001\u62e1\u5f35\u3001\u7e2e\u5c0f\u3001\u8907\u88fd](http://qiita.com/TsutomuNakamura/items/93c6333c8dd32aeb197a \"LVM\u3067\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u4f5c\u6210\u3001\u62e1\u5f35\u3001\u7e2e\u5c0f\u3001\u8907\u88fd\") \u3068\u540c\u3058\u30c7\u30d0\u30a4\u30b9\u69cb\u6210\u3067\u5b9f\u65bd\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n`/dev/md0` \u3092`/dev/sdb1` \u3068`/dev/sdc1` \u3067\u3001`/dev/md1` \u3092`/dev/sdd1` \u3068`/dev/sde1` \u3067\u69cb\u7bc9\u3057\u3001\u3053\u308c\u3089\u304cLVM \u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306e\u7269\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u3068\u306a\u308a\u307e\u3059\u3002\n\n## \u5fc5\u8981\u306a\u5bb9\u91cf\u306e\u898b\u7a4d\u3082\u308a\u306b\u3064\u3044\u3066 \n\u666e\u6bb5\u3001\u7269\u7406\u7684\u306aRAID1 \u3092\u69cb\u7bc9\u3059\u308b\u5834\u5408\u3001\u7269\u7406\u30c7\u30d0\u30a4\u30b9(\u4f8b\u3048\u30701\u53f0 100GB \u5bb9\u91cf\u306eHDD) \u30922 \u53f0\u3067RAID1 \u3092\u69cb\u7bc9\u3057\u3066\u3082\u3001\u5229\u7528\u3067\u304d\u308b\u5bb9\u91cf\u306f\u7269\u7406\u30c7\u30d0\u30a4\u30b91 \u53f0\u5206\u306e100 GB \u306e\u5bb9\u91cf\u3057\u304b\u4f7f\u7528\u3067\u304d\u306a\u3044\u3053\u3068\u306f\u3001RAID1 \u69cb\u7bc9\u7d4c\u9a13\u8005\u3067\u3042\u308c\u3070\u3001\u7406\u89e3\u3067\u304d\u308b\u3067\u3057\u3087\u3046\u3002\nLVM \u4e0a\u3067RAID1 \u3092\u69cb\u7bc9\u3059\u308b\u5834\u5408\u306f\u3001\u5bb9\u91cf\u306e\u898b\u7a4d\u3082\u308a\u611f\u899a\u304c\u82e5\u5e72\u7570\u306a\u308b\u70b9\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u4f8b\u3048\u3070\u3001100 GB \u306eRAID1 \u9818\u57df\u3092\u4f5c\u6210\u3057\u305f\u3044\u5834\u5408\u306f\u3001\u305d\u306e2 \u500d\u306e\u9818\u57df\u304c\u5fc5\u8981\u3067\u3001\u307e\u305a\u7269\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u5408\u8a08\u3067200 GB \u306e\u9818\u57df\u3092\u78ba\u4fdd(\u3067\u304d\u308c\u3070\u3082\u3046\u5c11\u3057\u4f59\u88d5\u3092\u3082\u3063\u3066\u78ba\u4fdd)\u3057\u3001\u305d\u308c\u3092\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u30b0\u30eb\u30fc\u30d7\u306b\u52a0\u3048\u3001RAID1 \u3092\u69cb\u7bc9\u3057\u3001100 GB \u306eRAID1 \u5229\u7528\u53ef\u80fd\u9818\u57df\u304c\u3067\u304d\u308b\u3068\u3044\u3063\u305f\u611f\u899a\u3067\u898b\u7a4d\u3082\u308a\u307e\u3059\u3002\n\u3082\u3057\u304f\u306f\u9055\u3046\u8003\u3048\u65b9\u3068\u3057\u3066\u3001\u6700\u521d\u306b200GB \u306e\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u305f\u5834\u5408\u306f\u3001\u305d\u306e\u4e0a\u3067\u69cb\u7bc9\u3067\u304d\u308bRAID1 \u9818\u57df\u306f100GB \u4ee5\u4e0b\u306b\u306a\u308b\u3068\u3044\u3046\u3053\u3068\u3092\u7406\u89e3\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u4e00\u756a\u6700\u521d\u3001\u81ea\u5206\u306f\u3053\u308c\u3067\u5931\u6557\u3057\u307e\u3057\u305f...(\uff1b\u00b4\u0414`A)\n\n## \u30c7\u30d0\u30a4\u30b9\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u524a\u9664 \n\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u518d\u5ea6\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u3053\u308c\u3088\u308a\u524d\u306e\u624b\u9806\u3067\u65e2\u306b\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u6b21\u306e\u3088\u3046\u306a\u624b\u9806\u3067\u4e00\u65e6\u524a\u9664\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```text\n$ sudo fdisk /dev/sdb\n\nCommand (m for help): d\nSelected partition 1\n\nCommand (m for help): w\nThe partition table has been altered!\n\nCalling ioctl() to re-read partition table.\nSyncing disks.\n\n```\n\n\n`/dev/sdb` \u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u524a\u9664\u3057\u305f\u3089\u3001\u4ed6\u306e\u30c7\u30d0\u30a4\u30b9\u306b\u3082\u69cb\u6210\u3092\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\n```text\n$ for I in {c,d,e,f}; do sudo sfdisk -d /dev/sdb | sudo sfdisk /dev/sd${I} --force; done\n```\n\n\n# \u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u4f5c\u6210 \n\u65b0\u305f\u306bfdisk \u30b3\u30de\u30f3\u30c9\u3067\u5404\u30c7\u30d0\u30a4\u30b9\u306b20GB \u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```text\n$ sudo fdisk /dev/sdb\nDevice contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel\nBuilding a new DOS disklabel with disk identifier 0xccc65e15.\nChanges will remain in memory only, until you decide to write them.\nAfter that, of course, the previous content won't be recoverable.\n\nWarning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)\n\nCommand (m for help): n\nPartition type:\n   p   primary (0 primary, 0 extended, 4 free)\n   e   extended\nSelect (default p): p\nPartition number (1-4, default 1): 1\nFirst sector (2048-83886079, default 2048): \nUsing default value 2048\nLast sector, +sectors or +size{K,M,G} (2048-83886079, default 83886079): +20G\n\nCommand (m for help): t\nSelected partition 1\nHex code (type L to list codes): 8e\nChanged system type of partition 1 to 8e (Linux LVM)\n\nCommand (m for help): w\nThe partition table has been altered!\n\nCalling ioctl() to re-read partition table.\nSyncing disks.\n```\n\n\n\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u4ed6\u30c7\u30d0\u30a4\u30b9\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\n```text\n$ for I in {c,d,e}; do sudo sfdisk -d /dev/sdb | sudo sfdisk /dev/sd${I} --force; done\n```\n\n\n\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002\n\n```text\n$ sudo pvcreate /dev/sdb1 /dev/sdc1 /dev/sdd1 /dev/sde1\n$ sudo vgcreate lvg-share /dev/sdb1 /dev/sdc1 /dev/sdd1 /dev/sde1\n$ sudo lvcreate --name public --size 18G lvg-share\n$ sudo lvcreate --name media --size 8GB lvg-share\n$ sudo lvcreate --name document --size 6GB lvg-share\n```\n\n\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```text\n$ sudo mkfs.ext4 /dev/lvg-share/public\n$ sudo mkfs.xfs /dev/lvg-share/media\n$ sudo mkfs.reiserfs /dev/lvg-share/document\n```\n\n\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001\u4e00\u65e6\u30de\u30a6\u30f3\u30c8\u3057\u3066\u307f\u307e\u3059\u3002\n\n```text\n$ sudo mount /dev/lvg-share/public /mnt/public\n$ sudo mount /dev/lvg-share/media /mnt/media\n$ sudo mount /dev/lvg-share/document /mnt/document\n$ df -h\n.......\n/dev/mapper/lvg--share-public     18G   44M   17G   1% /mnt/public\n/dev/mapper/lvg--share-media     8.0G   33M  8.0G   1% /mnt/media\n/dev/mapper/lvg--share-document  7.0G   33M  7.0G   1% /mnt/document\n```\n\n\n# \u65e2\u5b58\u30c7\u30fc\u30bf\u306e\u9000\u907f \n\u3053\u3053\u3067\u3001`/dev/sdc1 `(/dev/md0 \u306e\u30bb\u30ab\u30f3\u30c0\u30ea)\u3068`/dev/sde1 `(/dev/md1 \u306e\u30bb\u30ab\u30f3\u30c0\u30ea)\u306e\u30c7\u30fc\u30bf\u3092\u6b8b\u308a\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3(/dev/sdb1, /dev/sdd1)\u306b\u9000\u907f\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u3053\u306e2 \u3064\u306e\u7269\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u306f\u3001\u5f8c\u307b\u3069RAID1 \u3092\u69cb\u7bc9\u3059\u308b\u3068\u304d\u306b\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u3057\u3066\u3001RAID1 \u306e\u30bb\u30ab\u30f3\u30c0\u30ea\u30dc\u30ea\u30e5\u30fc\u30e0\u3068\u3057\u3066\u8ffd\u52a0\u3057\u307e\u3059\u304c\u3001\u65e2\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\u30c7\u30fc\u30bf\u3092\u5931\u308f\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u306e\u65b9\u6cd5\u3067\u3059\u3002\n\n\u307e\u305a\u3001\u73fe\u5728\u306e\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n```text\n$ sudo pvdisplay\n  --- Physical volume ---\n  PV Name               /dev/sdb1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               511\n  Allocated PE          4608\n  PV UUID               Sf0Pph-cQxd-fRJH-1TdU-iiCR-WjmF-w9fdxL\n   \n  --- Physical volume ---\n  PV Name               /dev/sdc1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               1535\n  Allocated PE          3584\n  PV UUID               u0oCVN-FH5t-nsXn-32zr-x0wL-PLEH-Bm5pQO\n   \n  --- Physical volume ---\n  PV Name               /dev/sdd1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               5119\n  Allocated PE          0\n  PV UUID               Qaj34D-N5Fj-ktA1-OO5M-lwf2-COM5-VzABEK\n   \n  --- Physical volume ---\n  PV Name               /dev/sde1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               5119\n  Allocated PE          0\n  PV UUID               NUBljh-9EnD-e2oT-9MYS-vckQ-DKdz-TQxaRU\n```\n\n\n`/dev/sdc1` \u306e\u30c7\u30fc\u30bf\u3092\u9000\u907f\u3057\u307e\u3059\u3002\n\n```text\n$ sudo modprobe dm-mirror\n$ sudo pvmove /dev/sdc1\n  /dev/sdc1: Moved: 0.1%\n  /dev/sdc1: Moved: 4.7%\n.......\n  /dev/sdc1: Moved: 97.9%\n  /dev/sdc1: no pvmove in progress - already finished or aborted.\n```\n\n\n`/dev/sdc1` \u306e\u30c7\u30fc\u30bf\u79fb\u884c\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001`pvdisplay` \u30b3\u30de\u30f3\u30c9\u3067\u7d50\u679c\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n```text\n$ sudo pvdisplay\n  --- Physical volume ---\n  PV Name               /dev/sdb1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               511\n  Allocated PE          4608\n  PV UUID               Sf0Pph-cQxd-fRJH-1TdU-iiCR-WjmF-w9fdxL\n   \n  --- Physical volume ---\n  PV Name               /dev/sdc1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               5119\n  Allocated PE          0\n  PV UUID               u0oCVN-FH5t-nsXn-32zr-x0wL-PLEH-Bm5pQO\n   \n  --- Physical volume ---\n  PV Name               /dev/sdd1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               1535\n  Allocated PE          3584\n  PV UUID               Qaj34D-N5Fj-ktA1-OO5M-lwf2-COM5-VzABEK\n   \n  --- Physical volume ---\n  PV Name               /dev/sde1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               5119\n  Allocated PE          0\n  PV UUID               NUBljh-9EnD-e2oT-9MYS-vckQ-DKdz-TQxaRU\n```\n\n\n\u4e0a\u8a18\u306e\u7d50\u679c\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001`/dev/sdc1` \u306b\u683c\u7d0d\u3055\u308c\u3066\u3044\u305f3584 \u7269\u7406\u30a8\u30af\u30b9\u30c6\u30f3\u30c8\u304c\u3001`/dev/sdd1` \u306b\u79fb\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\u30c7\u30fc\u30bf\u306e\u9000\u907f\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3089\u3001`/dev/sdc1` \u3092\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u30b0\u30eb\u30fc\u30d7\u304b\u3089\u306f\u305a\u3057\u3001\u7269\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u3082\u524a\u9664\u3057\u307e\u3059\u3002\n\n```text\n$ sudo vgreduce lvg-share /dev/sdc1\n$ sudo pvremove /dev/sdc1\n$ sudo pvdisplay\n  --- Physical volume ---\n  PV Name               /dev/sdb1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               511\n  Allocated PE          4608\n  PV UUID               Sf0Pph-cQxd-fRJH-1TdU-iiCR-WjmF-w9fdxL\n   \n  --- Physical volume ---\n  PV Name               /dev/sdd1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               1535\n  Allocated PE          3584\n  PV UUID               Qaj34D-N5Fj-ktA1-OO5M-lwf2-COM5-VzABEK\n   \n  --- Physical volume ---\n  PV Name               /dev/sde1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               5119\n  Allocated PE          0\n  PV UUID               NUBljh-9EnD-e2oT-9MYS-vckQ-DKdz-TQxaRU\n```\n\n\n\u7d9a\u3051\u3066`/dev/sde1` \u7269\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u306b\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u30c7\u30fc\u30bf\u3092\u79fb\u884c\u3057\u307e\u3059\u3002\n\n```text\n$ sudo pvmove /dev/sde1\n  No data to move for lvg-share\n```\n\n\n\u4eca\u56de\u306f\u3001`/dev/sde1` \u306b\u30c7\u30fc\u30bf\u306f\u542b\u307e\u308c\u3066\u3044\u306a\u304b\u3063\u305f\u305f\u3081\u3001\u4f55\u3082\u8d77\u3053\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n`/dev/sde1` \u3092\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u30b0\u30eb\u30fc\u30d7\u304b\u3089\u306f\u305a\u3057\u3001\u7269\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u3082\u524a\u9664\u3057\u307e\u3059\u3002\n\n```text\n$ sudo vgreduce lvg-share /dev/sde1\n$ sudo pvremove /dev/sde1\n$ sudo pvdisplay\n  --- Physical volume ---\n  PV Name               /dev/sdb1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               511\n  Allocated PE          4608\n  PV UUID               Sf0Pph-cQxd-fRJH-1TdU-iiCR-WjmF-w9fdxL\n   \n  --- Physical volume ---\n  PV Name               /dev/sdd1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               1535\n  Allocated PE          3584\n  PV UUID               Qaj34D-N5Fj-ktA1-OO5M-lwf2-COM5-VzABEK\n```\n\n\n# RAID1 \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u4f5c\u6210 \n\u7269\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u53d6\u308a\u5916\u3057\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001`/dev/sdc1` \u3068`/dev/sde1` \u3092Linux RAID autodetect \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```text\n$ sudo fdisk /dev/sdc\n\nCommand (m for help): t\nSelected partition 1\nHex code (type L to list codes): L\n\n 0  Empty           24  NEC DOS         81  Minix / old Lin bf  Solaris        \n 1  FAT12           27  Hidden NTFS Win 82  Linux swap / So c1  DRDOS/sec (FAT-\n 2  XENIX root      39  Plan 9          83  Linux           c4  DRDOS/sec (FAT-\n 3  XENIX usr       3c  PartitionMagic  84  OS/2 hidden C:  c6  DRDOS/sec (FAT-\n 4  FAT16 <32M      40  Venix 80286     85  Linux extended  c7  Syrinx         \n 5  Extended        41  PPC PReP Boot   86  NTFS volume set da  Non-FS data    \n 6  FAT16           42  SFS             87  NTFS volume set db  CP/M / CTOS / .\n 7  HPFS/NTFS/exFAT 4d  QNX4.x          88  Linux plaintext de  Dell Utility   \n 8  AIX             4e  QNX4.x 2nd part 8e  Linux LVM       df  BootIt         \n 9  AIX bootable    4f  QNX4.x 3rd part 93  Amoeba          e1  DOS access     \n a  OS/2 Boot Manag 50  OnTrack DM      94  Amoeba BBT      e3  DOS R/O        \n b  W95 FAT32       51  OnTrack DM6 Aux 9f  BSD/OS          e4  SpeedStor      \n c  W95 FAT32 (LBA) 52  CP/M            a0  IBM Thinkpad hi eb  BeOS fs        \n e  W95 FAT16 (LBA) 53  OnTrack DM6 Aux a5  FreeBSD         ee  GPT            \n f  W95 Ext'd (LBA) 54  OnTrackDM6      a6  OpenBSD         ef  EFI (FAT-12/16/\n10  OPUS            55  EZ-Drive        a7  NeXTSTEP        f0  Linux/PA-RISC b\n11  Hidden FAT12    56  Golden Bow      a8  Darwin UFS      f1  SpeedStor      \n12  Compaq diagnost 5c  Priam Edisk     a9  NetBSD          f4  SpeedStor      \n14  Hidden FAT16 <3 61  SpeedStor       ab  Darwin boot     f2  DOS secondary  \n16  Hidden FAT16    63  GNU HURD or Sys af  HFS / HFS+      fb  VMware VMFS    \n17  Hidden HPFS/NTF 64  Novell Netware  b7  BSDI fs         fc  VMware VMKCORE \n18  AST SmartSleep  65  Novell Netware  b8  BSDI swap       fd  Linux raid auto\n1b  Hidden W95 FAT3 70  DiskSecure Mult bb  Boot Wizard hid fe  LANstep        \n1c  Hidden W95 FAT3 75  PC/IX           be  Solaris boot    ff  BBT            \n1e  Hidden W95 FAT1 80  Old Minix      \nHex code (type L to list codes): fd\nChanged system type of partition 1 to fd (Linux raid autodetect)\n\nCommand (m for help): w\nThe partition table has been altered!\n\nCalling ioctl() to re-read partition table.\nSyncing disks.\n```\n\n\n`/dev/sdc` \u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092`/dev/sde` \u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\n```text\n$ sudo sfdisk -d /dev/sdc | sudo sfdisk /dev/sde --force\n```\n\n\n\u73fe\u5728\u306e\u30c7\u30d0\u30a4\u30b9\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```text\n$ sudo fdisk -l\n\n......\n\nDisk /dev/sdc: 42.9 GB, 42949672960 bytes\n255 heads, 63 sectors/track, 5221 cylinders, total 83886080 sectors\nUnits # sectors of 1 * 512  512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk identifier: 0x00000000\n\n   Device Boot      Start         End      Blocks   Id  System\n/dev/sdc1            2048    41945087    20971520   fd  Linux raid autodetect\n\n......\n\nDisk /dev/sde: 42.9 GB, 42949672960 bytes\n255 heads, 63 sectors/track, 5221 cylinders, total 83886080 sectors\nUnits # sectors of 1 * 512  512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk identifier: 0x00000000\n\n   Device Boot      Start         End      Blocks   Id  System\n/dev/sde1            2048    41945087    20971520   fd  Linux raid autodetect\n\n```\n\n\n\u6b21\u306b\u3001RAID1 \u3092\u69cb\u7bc9\u3057\u3066\u3044\u304d\u307e\u3059\u3002\nRAID1 \u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306b`/dev/sdc1` \u3092`/dev/md0` \u30c7\u30d0\u30a4\u30b9\u306b\u3001`/dev/sde1` \u3092`/dev/md1` \u30c7\u30d0\u30a4\u30b9\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n`/dev/sdb1` \u3068`/dev/sdd1` \u306f\u3001\u307e\u3060\u3053\u306e\u6bb5\u968e\u3067\u306f\u8ffd\u52a0\u3057\u307e\u305b\u3093\u3002\n\u305d\u306e\u305f\u3081\u3001`/dev/sdc1`, `/dev/sde1` \u3092\u8ffd\u52a0\u3059\u308b\u306b\u306f`mdadm` \u30b3\u30de\u30f3\u30c9\u306b`missing` \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u3066\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n\n```text\n$ sudo mdadm --create /dev/md0 --auto=yes -l 1 -n 2 /dev/sdc1 missing\nmdadm: Note: this array has metadata at the start and\n    may not be suitable as a boot device.  If you plan to\n    store '/boot' on this device please ensure that\n    your boot-loader understands md/v1.x metadata, or use\n    --metadata=0.90\nContinue creating array? y\nmdadm: Defaulting to version 1.2 metadata\nmdadm: array /dev/md0 started.\n\n$ sudo mdadm --create /dev/md1 --auto=yes -l 1 -n 2 /dev/sde1 missing\nmdadm: Note: this array has metadata at the start and\n    may not be suitable as a boot device.  If you plan to\n    store '/boot' on this device please ensure that\n    your boot-loader understands md/v1.x metadata, or use\n    --metadata=0.90\nContinue creating array? y\nmdadm: Defaulting to version 1.2 metadata\nmdadm: array /dev/md1 started.\n\n```\n\n\n### RAID1 \u306e\u30c7\u30d0\u30a4\u30b9\u540d\u30ba\u30ec\u89e3\u6d88 \nOS \u518d\u8d77\u52d5\u6642\u306bRAID1 \u306e\u30c7\u30d0\u30a4\u30b9\u540d(md0, md1)\u304c\u305a\u308c\u308b(md127 \u7b49\u306b)\u3053\u3068\u304c\u3042\u308b\u306e\u3067\u3001\u4e8b\u524d\u306b`mdadm.conf` \u30d5\u30a1\u30a4\u30eb\u306b\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```text:/etc/mdadm/mdadm.conf\n$ cp -ip /etc/mdadm/mdadm.conf /etc/mdadm/mdadm.conf.org\n\n$ echo \"DEVICE partitions\" | sudo tee -a /etc/mdadm/mdadm.conf\nDEVICE partitions\n\n$ sudo mdadm --detail --scan | sudo tee -a /etc/mdadm/mdadm.conf\nARRAY /dev/md0 metadata#1.2 name=lvm-test-on-pdv:0 UUID7a359312:522cb81f:a99b6b1b:b9b3efb9\nARRAY /dev/md1 metadata#1.2 name=lvm-test-on-pdv:1 UUIDda70e87b:01242494:f0b45f80:e575ea0e\n```\n\n\n/etc/mdadm/mdadm.conf \u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304d\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u6700\u5f8c\u306e\u65b9\u306b\u6b21\u306e\u3088\u3046\u306a\u5b9a\u7fa9\u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```text\n$ sudo vim /etc/mdadm/mdadm.conf\n.......\nDEVICE partitions\nARRAY /dev/md0 metadata#1.2 name=lvm-test-on-pdv:0 UUID7a359312:522cb81f:a99b6b1b:b9b3efb9\nARRAY /dev/md1 metadata#1.2 name=lvm-test-on-pdv:1 UUIDda70e87b:01242494:f0b45f80:e575ea0e\n```\n\n\ninitramfs \u30a4\u30e1\u30fc\u30b8\u3092\u518d\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```text\n$ sudo update-initramfs -u\n```\n\n\n\u53ef\u80fd\u3067\u3042\u308c\u3070\u3001OS \u3092\u518d\u8d77\u52d5\u3057\u3066RAID \u30c7\u30d0\u30a4\u30b9\u540d\u304c\u5909\u66f4\u3055\u308c\u3066\u3044\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\n# RAID1 \u306e\u69cb\u7bc9 \n`/dev/md0` \u3068`/dev/md1` \u3092\u7269\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u3068\u3057\u3066\u767b\u9332\u3057\u307e\u3059\u3002\n\n```text\n$ sudo pvcreate /dev/md0 /dev/md1\n  Physical volume \"/dev/md0\" successfully created\n  Physical volume \"/dev/md1\" successfully created\n```\n\n\n`/dev/md0` \u3068`/dev/md1` \u3092`lvg-share` \u30dc\u30ea\u30e5\u30fc\u30e0\u30b0\u30eb\u30fc\u30d7\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```text\n$ sudo vgextend lvg-share /dev/md0 /dev/md1\n  Volume group \"lvg-share\" successfully extended\n```\n\n\n`pvdisplay` \u30b3\u30de\u30f3\u30c9\u3068`vgdisplay` \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u72b6\u614b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```text:pvdisplay\n$ sudo pvdisplay\n  --- Physical volume ---\n  PV Name               /dev/sdb1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               511\n  Allocated PE          4608\n  PV UUID               MQWAVQ-IAY5-0KPR-F5Dq-WbI9-jk8T-7UuIyz\n   \n  --- Physical volume ---\n  PV Name               /dev/sdd1\n  VG Name               lvg-share\n  PV Size               20.00 GiB / not usable 4.00 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5119\n  Free PE               1535\n  Allocated PE          3584\n  PV UUID               NHHOBT-eAkD-Uffv-CAcs-oa2y-2yqN-cho3UO\n   \n  --- Physical volume ---\n  PV Name               /dev/md0\n  VG Name               lvg-share\n  PV Size               19.98 GiB / not usable 3.88 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5115\n  Free PE               5115\n  Allocated PE          0\n  PV UUID               nKzZBM-UEi0-jK0T-2riv-ceej-7a0N-hmWupv\n   \n  --- Physical volume ---\n  PV Name               /dev/md1\n  VG Name               lvg-share\n  PV Size               19.98 GiB / not usable 3.88 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5115\n  Free PE               5115\n  Allocated PE          0\n  PV UUID               M7oAVU-kU9W-vhxf-80Cx-fGHw-yHMw-VjZXS3\n```\n\n\n\n```text:vgdisplay\n$ sudo vgdisplay\n  --- Volume group ---\n  VG Name               lvg-share\n  System ID             \n  Format                lvm2\n  Metadata Areas        4\n  Metadata Sequence No  11\n  VG Access             read/write\n  VG Status             resizable\n  MAX LV                0\n  Cur LV                3\n  Open LV               3\n  Max PV                0\n  Cur PV                4\n  Act PV                4\n  VG Size               79.95 GiB\n  PE Size               4.00 MiB\n  Total PE              20468\n  Alloc PE / Size       8192 / 32.00 GiB\n  Free  PE / Size       12276 / 47.95 GiB\n  VG UUID               Xkf0yt-YxbZ-dTN3-KFMa-g1wz-ax3v-4dSfAf\n```\n\n\n\u3044\u3088\u3044\u3088`/dev/sdb1` \u3092`/dev/md0` \u3078\u3001`/dev/sdd1` \u3092`/dev/md1` RAID \u30a2\u30ec\u30a4\u3078\u8ffd\u52a0\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u307e\u305a\u306f\u3001`/dev/sdb1` \u3068`/dev/sdd1` \u306e\u30c7\u30fc\u30bf\u3092`/dev/md0` \u53ca\u3073`/dev/md1` \u3078\u9000\u907f\u3057\u307e\u3059\u3002\n\n\n```text\n$ sudo pvmove /dev/sdb1 /dev/md0\n  /dev/sdb1: Moved: 0.1%\n.......\n  /dev/sdb1: Moved: 100.0%\n\n$ sudo pvmove /dev/sdd1 /dev/md1\n  /dev/sdd1: Moved: 0.0%\n.......\n  /dev/sdd1: Moved: 100.0%\n```\n\n\n\n`/dev/sdb1` \u3068`/dev/sdd1` \u3092\u30dc\u30ea\u30e5\u30fc\u30e0\u30b0\u30eb\u30fc\u30d7\u304b\u3089\u5916\u3057\u307e\u3059\u3002\n\n```text\n$ sudo vgreduce lvg-share /dev/sdb1 /dev/sdd1\n  Removed \"/dev/sdb1\" from volume group \"lvg-share\"\n  Removed \"/dev/sdd1\" from volume group \"lvg-share\"\n\n$ sudo pvremove /dev/sdb1 /dev/sdd1\n  Labels on physical volume \"/dev/sdb1\" successfully wiped\n  Labels on physical volume \"/dev/sdd1\" successfully wiped\n```\n\n\n`pvdisplay` \u30b3\u30de\u30f3\u30c9\u3067\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n`/dev/md0`, `/dev/md1` \u306e\u307f\u304c\u6b8b\u3063\u3066\u3044\u308b\u72b6\u614b\u3067\u3059\u3002\n\n```text\n$ sudo pvdisplay\n  --- Physical volume ---\n  PV Name               /dev/md0\n  VG Name               lvg-share\n  PV Size               19.98 GiB / not usable 3.88 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5115\n  Free PE               507\n  Allocated PE          4608\n  PV UUID               nKzZBM-UEi0-jK0T-2riv-ceej-7a0N-hmWupv\n   \n  --- Physical volume ---\n  PV Name               /dev/md1\n  VG Name               lvg-share\n  PV Size               19.98 GiB / not usable 3.88 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5115\n  Free PE               1531\n  Allocated PE          3584\n  PV UUID               M7oAVU-kU9W-vhxf-80Cx-fGHw-yHMw-VjZXS3\n```\n\n\n\u6b21\u306b\u3001\u5148\u307b\u3069\u30dc\u30ea\u30e5\u30fc\u30e0\u30b0\u30eb\u30fc\u30d7\u304b\u3089\u5916\u3057\u305f`/dev/sdb1` \u3068`/dev/sdd1` \u3092Linux raid autodetect \u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3057\u307e\u3059\u3002\n\n```text\n$ sudo fdisk /dev/sdb\n\nCommand (m for help): t\nSelected partition 1\nHex code (type L to list codes): fd\nChanged system type of partition 1 to fd (Linux raid autodetect)\n\nCommand (m for help): w\nThe partition table has been altered!\n\nCalling ioctl() to re-read partition table.\nSyncing disks.\n\n$ sudo sfdisk -d /dev/sdb | sudo sfdisk /dev/sdd --force\n```\n\n\n`/dev/sdb1` \u3092`/dev/md0`, `/dev/sdd1` \u3092`/dev/md1` \u3078\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```text\n$ sudo mdadm --manage /dev/md0 --add /dev/sdb1\nmdadm: added /dev/sdb1\n\n$ sudo mdadm --manage /dev/md1 --add /dev/sdd1\nmdadm: added /dev/sdd1\n```\n\n\n\u3053\u308c\u3067RAID1 \u306e\u540c\u671f\u304c\u958b\u59cb\u3055\u308c\u307e\u3057\u305f\u3002\n\u540c\u671f\u306e\u9032\u6357\u306f\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n```text\n$ sudo cat /proc/mdstat\nPersonalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10] \nmd1 : active raid1 sdd1[2] sde1[0]\n      20955008 blocks super 1.2 [2/1] [U_]\n      [>....................]  recovery #  1.7% (368000/20955008) finish=22.3min speed15333K/sec\n      \nmd0 : active raid1 sdb1[2] sdc1[0]\n      20955008 blocks super 1.2 [2/1] [U_]\n      [#=>..................]  recovery = 10.7% (2259008/20955008) finish=12.7min speed24390K/sec\n      \nunused devices: <none>\n```\n\n\n\u540c\u671f\u304c\u5b8c\u4e86\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```text\nunuses devices: <none>\nnalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10] \nmd1 : active raid1 sdd1[2] sde1[0]\n      20955008 blocks super 1.2 [2/2] [UU]\n      \nmd0 : active raid1 sdb1[2] sdc1[0]\n      20955008 blocks super 1.2 [2/2] [UU]\n      \nunused devices: <none>\n```\n\n\n\u540c\u671f\u304c\u5b8c\u4e86\u3059\u308c\u3070\u3001RAID1 \u306e\u69cb\u7bc9\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n# \u30c7\u30a3\u30b9\u30af\u969c\u5bb3\u3092\u60f3\u5b9a\u3057\u305f\u624b\u9806 \n\u3053\u3053\u3067\u306f\u3001`/dev/sdc`\u3068`/dev/sde` \u30c7\u30a3\u30b9\u30af\u306b\u969c\u5bb3\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u3092\u60f3\u5b9a\u3057\u305f\u624b\u9806\u3092\u5b9f\u65bd\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u307e\u305a\u306f\u3001`mdadm` \u30b3\u30de\u30f3\u30c9\u306e`--fail`\u3067\u4e0d\u826f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\u6b21\u306b`--remove` \u3092\u4f7f\u7528\u3057\u3066\u4e0d\u826f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092RAID \u304b\u3089\u5207\u308a\u96e2\u3057\u307e\u3059\u3002\n\n```text\n$ sudo mdadm --manage /dev/md0 --fail /dev/sdc1\nmdadm: set /dev/sdc1 faulty in /dev/md0\n$ sudo mdadm --manage /dev/md0 --remove /dev/sdc1\nmdadm: hot removed /dev/sdc1 from /dev/md0\n$ sudo mdadm --manage /dev/md1 --fail /dev/sde1\nmdadm: set /dev/sde1 faulty in /dev/md1\n$ sudo mdadm --manage /dev/md1 --remove /dev/sde1\nmdadm: hot removed /dev/sde1 from /dev/md1\n```\n\n\nRAID1 \u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```text\n$ cat /proc/mdstat\nPersonalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10] \nmd1 : active raid1 sdd1[2]\n      20955008 blocks super 1.2 [2/1] [_U]\n      \nmd0 : active raid1 sdb1[2]\n      20955008 blocks super 1.2 [2/1] [_U]\n      \nunused devices: <none>\n```\n\n\u5207\u308a\u96e2\u3057\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002\n\u3053\u306e\u5f8c\u3001\u5b9f\u969b\u306e\u696d\u52d9\u7b49\u3067\u306f\u7269\u7406\u30c7\u30d0\u30a4\u30b9\u3092\u5165\u308c\u66ff\u3048\u3001`/dev/sdc`, `/dev/sde` \u3092\u53d6\u308a\u66ff\u3048\u3092\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u3053\u3053\u3067\u306f\u5b66\u7fd2\u76ee\u7684\u306a\u306e\u3067\u3001\u7269\u7406\u30c7\u30d0\u30a4\u30b9\u306e\u5165\u308c\u66ff\u3048\u306f\u884c\u308f\u305a\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u524a\u9664\u3057\u3066\u672a\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u72b6\u614b\u306e\u7269\u7406\u30c7\u30d0\u30a4\u30b9\u3068\u3057\u3066\u518d\u751f\u3057\u307e\u3059\u3002\n\n```text:\u308f\u3056\u3068\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u58ca\u3059\n$ for I in {c,e}; do sudo dd if#/dev/zero of=/dev/sd${I} bs=1024 count$(echo \"1 * 1024 * 100\" | bc); done\n.......\n\n$ sudo fdisk -l /dev/sdc\nDisk /dev/sdc: 42.9 GB, 42949672960 bytes\n255 heads, 63 sectors/track, 5221 cylinders, total 83886080 sectors\nUnits # sectors of 1 * 512  512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk identifier: 0x00000000\n\nDisk /dev/sdc doesn't contain a valid partition table\n\n$ sudo fdisk -l /dev/sde\n.......\n```\n\n\n`/dev/sdb` \u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092`/dev/sdc`, `/dev/sde` \u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\n```text\n$ for I in {c,e}; do sudo sfdisk -d /dev/sdb | sudo sfdisk /dev/sd${I} --force; done\n\u203b\u4eca\u56de\u306f/dev/sdb \u3068\u540c\u3058\u69cb\u6210\u3067\u554f\u984c\u306a\u3044\u305f\u3081\u3053\u306e\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n```\n\n\n`/dev/sdc` \u3068`/dev/sde` \u3092\u3001\u305d\u308c\u305e\u308c`/dev/md0` \u3068`/dev/md1` \u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\n```text\n$ sudo mdadm --manage /dev/md0 --add /dev/sdc1\nmdadm: added /dev/sdc1\n\n$ sudo mdadm --manage /dev/md1 --add /dev/sde1\nmdadm: added /dev/sde1\n```\n\n\n\u540c\u671f\u306e\u9032\u6357\u72b6\u614b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```text\n$ cat /proc/mdstat\nPersonalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10] \nmd1 : active raid1 sde1[3] sdd1[2]\n      20955008 blocks super 1.2 [2/1] [_U]\n      [>....................]  recovery #  1.5% (332544/20955008) finish=22.7min speed15115K/sec\n      \nmd0 : active raid1 sdc1[3] sdb1[2]\n      20955008 blocks super 1.2 [2/1] [_U]\n      [#==>.................]  recovery = 18.0% (3784640/20955008) finish=12.1min speed23564K/sec\n      \nunused devices: <none>\n```\n\n\n\u540c\u671f\u304c\u5b8c\u4e86\u3059\u308c\u3070\u6210\u529f\u3067\u3059\u3002\n\n# \u7269\u7406\u30c7\u30d0\u30a4\u30b9\u306e\u3042\u307e\u308a\u9818\u57df\u3092\u4f7f\u7528\u3057\u3066\u3082\u3046\u3072\u3068\u3064RAID1 \u3092\u4f5c\u6210\u3059\u308b \n`/dev/md2` \u3068`/dev/md3` \u3092\u7269\u7406\u30c7\u30d0\u30a4\u30b9\u306e\u6b8b\u308a\u9818\u57df\u3092\u4f7f\u7528\u3057\u3066\u4f5c\u6210\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u3053\u3053\u3067\u306f\u3001`/dev/sdb` \u3068`/dev/sdc` \u306b\u4f59\u308a\u306e\u672a\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u9818\u57df\u304c\u3042\u308b\u3053\u3068\u3092\u60f3\u5b9a\u3057\u3001`/dev/md2` \u306b`/dev/sdb2` \u3068`/dev/sdc2`\u3001`/dev/md3` \u306b`/dev/sdd2` \u3068`/dev/sde2` \u3092\u4f7f\u7528\u3057\u3066\u3082\u3046\u3072\u3068\u3064RAID1 \u3092\u4f5c\u6210\u3057\u3066\u307f\u307e\u3059\u3002\n\u4eca\u56de\u306e\u624b\u9806\u306f\u3001VM \u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u5b9f\u969b\u306f\u4f8b\u3048\u3070`/dev/sdg`\u3084`/dev/sdh` \u7b49\u306e\u7269\u7406\u30c7\u30d0\u30a4\u30b9\u3092\u5897\u8a2d\u3057\u3066 \u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u5bb9\u91cf\u3092\u5897\u3084\u3059\u3068\u3044\u3063\u305f\u30b7\u30c1\u30e5\u30a8\u30fc\u30b7\u30e7\u30f3\u3067\u5f79\u306b\u7acb\u3063\u305f\u308a\u3057\u307e\u3059\u3002\n\u307e\u305a\u3001\u5404\u7269\u7406\u30c7\u30d0\u30a4\u30b9\u306e\u6b8b\u308a\u9818\u57df\u3092\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3057\u307e\u3059\u3002\n\n```text\n$ sudo fdisk /dev/sdb\nCommand (m for help): p\n\nDisk /dev/sdb: 42.9 GB, 42949672960 bytes\n246 heads, 3 sectors/track, 113666 cylinders, total 83886080 sectors\nUnits # sectors of 1 * 512  512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk identifier: 0x253bf895\n\n   Device Boot      Start         End      Blocks   Id  System\n/dev/sdb1            2048    41945087    20971520   fd  Linux raid autodetect\n\nCommand (m for help): n\nPartition type:\n   p   primary (1 primary, 0 extended, 3 free)\n   e   extended\nSelect (default p): p\nPartition number (1-4, default 2): \nUsing default value 2\nFirst sector (41945088-83886079, default 41945088): \nUsing default value 41945088\nLast sector, +sectors or +size{K,M,G} (41945088-83886079, default 83886079): \nUsing default value 83886079\n\nCommand (m for help): t\nPartition number (1-4): 2\nHex code (type L to list codes): fd\nChanged system type of partition 2 to fd (Linux raid autodetect)\n\nCommand (m for help): w\nThe partition table has been altered!\n\nCalling ioctl() to re-read partition table.\n\nWARNING: Re-reading the partition table failed with error 16: Device or resource busy.\nThe kernel still uses the old table. The new table will be used at\nthe next reboot or after you run partprobe(8) or kpartx(8)\nSyncing disks.\n```\n\n\n\u4ed6\u306e\u7269\u7406\u30c7\u30d0\u30a4\u30b9\u306b\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\n```text\n$ for I in {c,d,e}; do sudo sfdisk -d /dev/sdb | sudo sfdisk /dev/sd${I} --force; done\n```\n\n\n---------------------------------------------------------------------------------------------------\nTODO: OS \u3092\u518d\u8d77\u52d5\u3057\u306a\u3044\u3068/dev/sdb2\u301c/dev/sde2 \u304c\u51fa\u73fe\u3057\u306a\u3044\uff01\uff1f\n\u4eca\u56de\u306e\u81ea\u5206\u306e\u74b0\u5883\u3067\u306fOS \u3092\u518d\u8d77\u52d5\u3059\u308b\u3053\u3068\u3067/dev/sdb2\u301c/dev/sde2 \u304c\u51fa\u73fe\u3057\u307e\u3057\u305f\u3002\n---------------------------------------------------------------------------------------------------\n\n`/dev/sdb2` \u3068`/dev/sdc2` \u3092`/dev/md2` \u3078\u53d6\u308a\u8fbc\u307f\u307e\u3059\u3002\n\n```text\n$ sudo mdadm --create /dev/md2 --auto=yes -l 1 -n 2 /dev/sdb2 /dev/sdc2\nmdadm: Note: this array has metadata at the start and\n    may not be suitable as a boot device.  If you plan to\n    store '/boot' on this device please ensure that\n    your boot-loader understands md/v1.x metadata, or use\n    --metadata=0.90\nContinue creating array? y\nmdadm: Defaulting to version 1.2 metadata\nmdadm: array /dev/md2 started.\n```\n\n\n`/dev/sdd2` \u3068`/dev/sde2` \u3092`/dev/md3` \u3078\u53d6\u308a\u8fbc\u307f\u307e\u3059\u3002\n\n```text\n$ sudo mdadm --create /dev/md3 --auto=yes -l 1 -n 2 /dev/sdd2 /dev/sde2\nmdadm: Note: this array has metadata at the start and\n    may not be suitable as a boot device.  If you plan to\n    store '/boot' on this device please ensure that\n    your boot-loader understands md/v1.x metadata, or use\n    --metadata=0.90\nContinue creating array? y\nmdadm: Defaulting to version 1.2 metadata\nmdadm: array /dev/md3 started.\n```\n\n\n\u30c7\u30d0\u30a4\u30b9\u540d\u306e\u30ba\u30ec\u3092\u9632\u6b62\u3059\u308b\u305f\u3081\u306b\u3001mdadm.conf \u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n```text\n$ sudo mdadm --detail --scan | egrep '^ARRAY /dev/md[23]' | sudo tee -a /etc/mdadm/mdadm.conf\nARRAY /dev/md2 metadata#1.2 name=lvm-test-on-pdv:2 UUID366d696f:c5a69c4f:8b1d198e:d0c88a13\nARRAY /dev/md3 metadata#1.2 name=lvm-test-on-pdv:3 UUID0cf37c81:ec6324c2:01de9bd6:a23d8fb8\n```\n\n\ninitramfs \u30a4\u30e1\u30fc\u30b8\u3092\u518d\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```text\n$ sudo update-initramfs -u\n```\n\n\n`/dev/md2` \u3068`/dev/md3` RAID1 \u306e\u540c\u671f\u9032\u6357\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```text\n$ cat /proc/mdstat\nPersonalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10] \nmd3 : active raid1 sde2[1] sdd2[0]\n      20953984 blocks super 1.2 [2/2] [UU]\n      \nmd2 : active raid1 sdc2[1] sdb2[0]\n      20953984 blocks super 1.2 [2/2] [UU]\n      \nmd1 : active raid1 sde1[3] sdd1[2]\n      20955008 blocks super 1.2 [2/2] [UU]\n      \nmd0 : active raid1 sdc1[3] sdb1[2]\n      20955008 blocks super 1.2 [2/2] [UU]\n      \nunused devices: <none>\n```\n\n\n\u7269\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u3068\u3057\u3066`/dev/md2`, `/dev/md3` \u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```text\n$ sudo pvcreate /dev/md2 /dev/md3\n```\n\n\n`/dev/md2`, `/dev/md3` \u3092\u30dc\u30ea\u30e5\u30fc\u30e0\u30b0\u30eb\u30fc\u30d7\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```text\n$ sudo vgextend lvg-share /dev/md2 /dev/md3\n```\n\n\n`pvdisplay` \u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```text\n$ sudo pvdisplay\n  --- Physical volume ---\n  PV Name               /dev/md0\n  VG Name               lvg-share\n  PV Size               19.98 GiB / not usable 3.88 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5115\n  Free PE               507\n  Allocated PE          4608\n  PV UUID               lMgkug-CfZE-STFc-L0aJ-mz77-BZnw-FMaeaU\n   \n  --- Physical volume ---\n  PV Name               /dev/md1\n  VG Name               lvg-share\n  PV Size               19.98 GiB / not usable 3.88 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5115\n  Free PE               1531\n  Allocated PE          3584\n  PV UUID               kq6z6E-6nYu-u1Ad-TUEe-TZfL-RPHi-Lq18Jd\n   \n  --- Physical volume ---\n  PV Name               /dev/md2\n  VG Name               lvg-share\n  PV Size               19.98 GiB / not usable 2.88 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5115\n  Free PE               5115\n  Allocated PE          0\n  PV UUID               qp8YU4-wuH3-VI3q-PnFD-bY4e-szHP-MVk2Mq\n   \n  --- Physical volume ---\n  PV Name               /dev/md3\n  VG Name               lvg-share\n  PV Size               19.98 GiB / not usable 2.88 MiB\n  Allocatable           yes \n  PE Size               4.00 MiB\n  Total PE              5115\n  Free PE               5115\n  Allocated PE          0\n  PV UUID               2DXJxE-Kow7-1p8j-jw2I-29WI-VVNx-9NoeKt\n```\n\n\n\n```text:vgdisplay\n$ sudo vgdisplay\n  --- Volume group ---\n  VG Name               lvg-share\n  System ID             \n  Format                lvm2\n  Metadata Areas        4\n  Metadata Sequence No  21\n  VG Access             read/write\n  VG Status             resizable\n  MAX LV                0\n  Cur LV                3\n  Open LV               0\n  Max PV                0\n  Cur PV                4\n  Act PV                4\n  VG Size               79.92 GiB\n  PE Size               4.00 MiB\n  Total PE              20460\n  Alloc PE / Size       8192 / 32.00 GiB\n  Free  PE / Size       12268 / 47.92 GiB\n  VG UUID               DBgEtU-tjpa-jqcN-tKGV-Ped5-WKT0-BcGuv1\n```\n\n\n\n```text:lvdisplay\n$ sudo lvdisplay\n  --- Logical volume ---\n  LV Path                /dev/lvg-share/public\n  LV Name                public\n  VG Name                lvg-share\n  LV UUID                s6aaIK-Dfaz-dIkL-sybW-W5q2-9ANc-rorUbQ\n  LV Write Access        read/write\n  LV Creation host, time lvm-test-on-pdv, 2015-03-14 18:20:00 +0900\n  LV Status              available\n  # open                 0\n  LV Size                18.00 GiB\n  Current LE             4608\n  Segments               1\n  Allocation             inherit\n  Read ahead sectors     auto\n  - currently set to     256\n  Block device           252:0\n   \n  --- Logical volume ---\n  LV Path                /dev/lvg-share/media\n  LV Name                media\n  VG Name                lvg-share\n  LV UUID                FZzDeD-lPFn-WEH3-JKPH-93eS-9y0z-RQeGht\n  LV Write Access        read/write\n  LV Creation host, time lvm-test-on-pdv, 2015-03-14 18:20:04 +0900\n  LV Status              available\n  # open                 0\n  LV Size                8.00 GiB\n  Current LE             2048\n  Segments               1\n  Allocation             inherit\n  Read ahead sectors     auto\n  - currently set to     256\n  Block device           252:1\n   \n  --- Logical volume ---\n  LV Path                /dev/lvg-share/document\n  LV Name                document\n  VG Name                lvg-share\n  LV UUID                d00kFR-a0jk-YGwn-j53z-ZMav-nyy9-O9c3ft\n  LV Write Access        read/write\n  LV Creation host, time lvm-test-on-pdv, 2015-03-14 18:20:10 +0900\n  LV Status              available\n  # open                 0\n  LV Size                6.00 GiB\n  Current LE             1536\n  Segments               1\n  Allocation             inherit\n  Read ahead sectors     auto\n  - currently set to     256\n  Block device           252:2\n\n```\n\n\n\u4e0a\u8a18\u30b3\u30de\u30f3\u30c9\u7d50\u679c\u3067\u7279\u306b\u554f\u984c\u304c\u7121\u3044\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u30b0\u30eb\u30fc\u30d7\u306e\u5bb9\u91cf\u304c\u5897\u3048\u305f\u306e\u3067\u3001\u3053\u308c\u3067\u4ed6\u306e\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u5bb9\u91cf\u3092\u5897\u3084\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u4eca\u56de\u306f`xfs` \u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306e`/dev/lvg-share/media` \u306e\u5bb9\u91cf\u3092`8GiB` \u304b\u3089`28GiB` \u306b\u62e1\u5f35\u3057\u3066\u307f\u307e\u3059\u3002\n\n```text\n$ sudo lvextend -L 28G /dev/lvg-share/media\n  Extending logical volume media to 28.00 GiB\n  Logical volume media successfully resized\n```\n\n\n`xfs` \u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u62e1\u5f35\u3057\u307e\u3059\u3002\n\n```text\n$ sudo xfs_growfs /dev/lvg-share/media \nmeta-data#/dev/mapper/lvg--share-media isize=256    agcount=4, agsize524288 blks\n         #                       sectsz=512   attr2\ndata     #                       bsize=4096   blocks=2097152, imaxpct25\n         #                       sunit=0      swidth0 blks\nnaming   #version 2              bsize=4096   ascii-ci0\nlog      #internal               bsize=4096   blocks=2560, version2\n         #                       sectsz=512   sunit=0 blks, lazy-count1\nrealtime #none                   extsz=4096   blocks=0, rtextents0\ndata blocks changed from 2097152 to 7340032\n```\n\n\n`df -h` \u30b3\u30de\u30f3\u30c9\u3067\u30dc\u30ea\u30e5\u30fc\u30e0\u304c\u62e1\u5f35\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```text\n$ df -h \nFilesystem                       Size  Used Avail Use% Mounted on\n/dev/sda1                         75G  1.2G   70G   2% /\nnone                             4.0K     0  4.0K   0% /sys/fs/cgroup\nudev                             2.0G  4.0K  2.0G   1% /dev\ntmpfs                            394M  3.2M  391M   1% /run\nnone                             5.0M     0  5.0M   0% /run/lock\nnone                             2.0G     0  2.0G   0% /run/shm\nnone                             100M     0  100M   0% /run/user\n/dev/mapper/lvg--share-media      28G   33M   28G   1% /mnt/media\n/dev/mapper/lvg--share-public     18G   44M   17G   1% /mnt/public\n/dev/mapper/lvg--share-document  6.0G   33M  6.0G   1% /mnt/document\n```\n\n\n`/mnt/media` \u306e\u9818\u57df\u304c\u62e1\u5f35\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n# \u6b21\u306e\u8a18\u4e8b\n[LVM\u3067\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u4f5c\u6210\u3068\u72b6\u614b\u306e\u5fa9\u5143](http://qiita.com/TsutomuNakamura/items/a68377952d07397db448 \"LVM\u3067\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u4f5c\u6210\u3068\u72b6\u614b\u306e\u5fa9\u5143\")\n"}