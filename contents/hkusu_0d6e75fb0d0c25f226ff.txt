{"context": " More than 1 year has passed since last update.\u3053\u308c\u306f mod_mruby ngx_mruby Advent Calendar 2014 \u306e\uff11\uff18\u65e5\u76ee(12/18)\u306e\u6295\u7a3f\u3067\u3059\u3002\n\u3053\u306e\u6295\u7a3f\u306e\u4f4d\u7f6e\u3065\u3051\u3068\u3057\u3066\u306f\u3001\u30a2\u30c9\u30d9\u30f3\u30c8\u30ab\u30ec\u30f3\u30c0\u30fc\u306e\uff11\uff16\u65e5\u76ee\u306b\u66f8\u3044\u305f\u8a18\u4e8b\uff08\u9759\u7684\u30ea\u30bd\u30fc\u30b9\u3092\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3067\u914d\u4fe1\u3059\u308b\uff09\u306e\u5fdc\u7528\u7de8\u3067\u3059\u3002\nApache \u3067\u306f\u3001\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3057\u305f\u30b3\u30f3\u30c6\u30f3\u30c4\u306b\u5bfe\u3057\u3066\u3001\u66f4\u306b\u51fa\u529b\u30d5\u30a3\u30eb\u30bf\u3092\u304b\u3051\u3066\u51e6\u7406\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\uff08\u6709\u540d\u306a\u51fa\u529b\u30d5\u30a3\u30eb\u30bf\u3060\u3068 mod_deflate \u306a\u3069\u3002\uff09\n\u30a4\u30e1\u30fc\u30b8\u306f\u6b21\u306e\u3068\u304a\u308a\u3002\n\n\nApache \u306e\u30d5\u30a3\u30eb\u30bf\u306b\u3064\u3044\u3066\u306e\u8aac\u660e\u306f\u3053\u3061\u3089\u3002\u3061\u306a\u307f\u306b\u30b3\u30f3\u30c6\u30f3\u30c4\u30cf\u30f3\u30c9\u30e9(\u4f8b\uff1aPHP\u3001Perl)\u306e\u524d\u306b\u8d77\u52d5\u3055\u308c\u308b\u306e\u304c\u5165\u529b\u30d5\u30a3\u30eb\u30bf\u3067\u3001\u5f8c\u306b\u8d77\u52d5\u3055\u308c\u308b\u306e\u304c\u51fa\u529b\u30d5\u30a3\u30eb\u30bf\u3067\u3059\u3002\n\u21d2 http://httpd.apache.org/docs/current/ja/filter.html\n\n\u3082\u3061\u308d\u3093 mod_mruby \u3067\u3082\u30d5\u30a3\u30eb\u30bf\u3092\u4f5c\u6210\u3067\u304d\u307e\u3059\u306e\u3067\u3001\u540c\u69d8\u306b\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3057\u305f\u30b3\u30f3\u30c6\u30f3\u30c4\u306b\u5bfe\u3057\u3066\u4efb\u610f\u306e\u30d5\u30a3\u30eb\u30bf\u51e6\u7406\u3092\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\nmod_mruby \u3067\u306e\u30d7\u30ed\u30ad\u30b7\u306e\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f\uff11\uff16\u65e5\u76ee\u306b\u66f8\u3044\u305f\u306e\u3067\u3001\u4eca\u56de\u306fWEB\u30b5\u30fc\u30d3\u30b9\u306b\u304a\u3051\u308b\u901a\u4fe1\u306e\u524a\u6e1b\u3092\u76ee\u7684\u3068\u3057\u305f\u30d5\u30a3\u30eb\u30bf\u306e\u8a2d\u5b9a\u3092\uff12\u4f8b\u3001\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n\u524d\u63d0\u3068\u306a\u308b\u74b0\u5883\u306f\u30a2\u30c9\u30d9\u30f3\u30c8\u30ab\u30ec\u30f3\u30c0\u30fc\u306e\uff13\u65e5\u76ee\u3001Apache \u306e\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u8a2d\u5b9a\u3084 mod_mruby \u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f8b\u306f\uff11\uff10\u65e5\u76ee\u306b\u66f8\u3044\u305f\u306e\u3067\u3001\u5b9c\u3057\u3051\u308c\u3070\u305d\u3061\u3089\u3082\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\u21d2 mod_mruby \u3092 Amazon EC2\u3001Apache2.4 \u3078\u5c0e\u5165\u3059\u308b\uff08Apache \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f 2.4.10\u3001mod_mruby \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f 1.9.7 \u3067\u3059\uff09\n\u21d2 mod_mruby \u306e\u53ef\u80fd\u6027\u3068\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u8a2d\u5b9a/\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f8b\n\n\n\u2460 \u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3057\u305f\u30b3\u30f3\u30c6\u30f3\u30c4\u306eHTTP\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u3092\u64cd\u4f5c\n\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u5148\u304b\u3089\u8fd4\u3063\u3066\u304d\u305f\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u306b\u5bfe\u3057\u3001mod_mruby \u3067 Cache-Control \u30d8\u30c3\u30c0\u3092\u64cd\u4f5c\u3057\u3066\u3001\u30d6\u30e9\u30a6\u30b6\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u305b\u308b\u6642\u9593\u3092\u4efb\u610f\u306b\u6307\u5b9a\u3059\u308b\u4f8b\u3067\u3059\u3002\n\n/usr/local/apache2/mruby/respose_header.rb\nr = Apache::Request.new\n\nif /\\.(gif|jpe?g|png)$/ =~ r.filename\n  r.headers_out['Cache-Control'] = 'max-age=20'\nend\n\n\n\u3053\u306e\u4f8b\u3060\u3068 20\u79d2\u3060\u3051\u30d6\u30e9\u30a6\u30b6\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u305b\u307e\u3059\u3002\u4e0a\u8a18\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u51fa\u529b\u30d5\u30a3\u30eb\u30bf\u3068\u3057\u3066\u30d5\u30c3\u30af\u3057\u307e\u3059\u3002\n\n***.conf\nSetOutputFilter mruby\nmrubyOutputFilter /usr/local/apache2/mruby/respose_header.rb\n\n\n\u3059\u308b\u3068\u30d6\u30e9\u30a6\u30b6\u3078\u306eHTTP\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\uff08\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u5148\u306f GitHub Pages \u306e\u4f8b\u3067\u3059\u3002\uff09\n\n\n\u30d5\u30a3\u30eb\u30bf\u306e\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f\u516c\u5f0f\u30da\u30fc\u30b8\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\n\u21d2 http://httpd.apache.org/docs/current/ja/filter.html\n<Files> \u7b49\u306e\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3068\u7d44\u307f\u5408\u308f\u305b\u305f\u308a\u3001.htaccess \u306b\u66f8\u3044\u305f\u308a\u3082\u3067\u304d\u307e\u3059\u3002\n\u307e\u305f\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u30b9\u30af\u30ea\u30d7\u30c8\u5185\u3067\u62e1\u5f35\u5b50\u3092\u5224\u5b9a\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u62e1\u5f35\u5b50\u3092\u30ad\u30fc\u306b\u51fa\u529b\u30d5\u30a3\u30eb\u30bf\u3092\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u3082\u51fa\u6765\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u305f\u3060\u51fa\u529b\u30d5\u30a3\u30eb\u30bf\u306e\u30d5\u30a7\u30fc\u30ba\u3067 Apache \u306e HTTP\u30ea\u30af\u30a8\u30b9\u30c8\u3084\u30d8\u30c3\u30c0\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u306e\u306f\u884c\u5100\u304c\u60aa\u3044\u304b\u3082^^; \u307e\u3042\u3053\u3046\u3044\u3046\u8a2d\u5b9a\u3082\u3067\u304d\u308b\u3088\u3068\u3044\u3046\u3053\u3068\u3067..\n\n\u2461 \u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3057\u305f\u30b3\u30f3\u30c6\u30f3\u30c4\u3092 gzip \u5727\u7e2e\u3057\u3066\u914d\u4fe1\n\u9759\u7684\u30b3\u30f3\u30c6\u30f3\u30c4\u3092 gzip \u5727\u7e2e\u3057\u3066\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5e2f\u57df\u3092\u7bc0\u7d04\u3057\u307e\u3059\u3002gzip \u5727\u7e2e\u306f mod_deflate \u3092\u5229\u7528\u3057\u307e\u3059\u3002\u3061\u306a\u307f\u306b mod_deflate \u304c\u4f55\u3092\u3057\u3066\u304f\u308c\u308b\u304b\u3068\u3044\u3046\u3068\u3001\u30d6\u30e9\u30a6\u30b6\u304c gzip \u5727\u7e2e\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u6b21\u306e\u3088\u3046\u306a\u30d8\u30c3\u30c0\u3092\u9001\u3063\u3066\u304f\u308b\u306e\u3067\u3001\n\nmod_deflate \u306f\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u5727\u7e2e\u3057\u3066\u9001\u51fa\u3057\u3001\u30d8\u30c3\u30c0\u306f\u6b21\u306e\u3088\u3046\u306b\u8fd4\u3057\u307e\u3059\u3002\u30d6\u30e9\u30a6\u30b6\u306f\u3053\u308c\u3067\u5727\u7e2e\u3055\u308c\u305f\u30b3\u30f3\u30c6\u30f3\u30c4\u3060\u3068\u5224\u65ad\u3057\u89e3\u51cd\u3057\u307e\u3059\u3002\n\n\n\u3082\u3057 mod_deflate \u304c\u30b5\u30fc\u30d0\u306b\u5165\u3063\u3066\u306a\u3044\uff08mod_deflate.so \u304c\u5b58\u5728\u3057\u306a\u3044\uff09\u5834\u5408\u306f\u3001\u6b21\u306e\u3088\u3046\u306b configure \u3057\u76f4\u3057\u3066\u304b\u3089 Apache \u3092\u518d\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u3068\u5c0e\u5165\u3067\u304d\u307e\u3059\u3002\n$ ./configure --enable-deflate\n\n\u8a2d\u5b9a\u65b9\u6cd5\u306b\u3064\u3044\u3066\u306f\u3001\u307e\u305a .conf \u30d5\u30a1\u30a4\u30eb\u306b\u3066 mod_deflate \u3092\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\n\n***.conf\nLoadModule deflate_module modules/mod_deflate.so\n\n\n\u4f8b\u3068\u3057\u3066 PNG \u5f62\u5f0f\u306e\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u3092 gzip \u5727\u7e2e\u3059\u308b\u5834\u5408\u306f\u6b21\u306e\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n***.conf\nAddOutputFilterByType DEFLATE image/png\n\n\n\u3059\u308b\u3068\u30d6\u30e9\u30a6\u30b6\u3078\u306eHTTP\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\uff08\u3053\u308c\u3082\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u5148\u306f GitHub Pages \u306e\u4f8b\u3067\u3059\u3002\uff09\n\n\u3061\u306a\u307f\u306b\u30d5\u30a3\u30eb\u30bf\u306f\u8907\u6570\u3092\u4f75\u7528\u3067\u304d\u308b\u306e\u3067\u3001\u4f8b\u3048\u3070\u4e0a\u8a18\u306e\u2460\u2461\u3092\u540c\u6642\u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\n\n\u304a\u308f\u308a\u306b\n\u4eca\u56de\u306f mod_mruby \u3067\u30ea\u30fc\u30d0\u30b9\u30d7\u30ed\u30ad\u30b7\u3057\u305f\u30b3\u30f3\u30c6\u30f3\u30c4\u306b\u5bfe\u3057\u3066\u3001\u66f4\u306b\u901a\u4fe1\u306e\u524a\u6e1b\u3092\u76ee\u7684\u3068\u3057\u305f\u30d5\u30a3\u30eb\u30bf\u3092\u9069\u7528\u3059\u308b\u4f8b\u3092\u7d39\u4ecb\u3057\u307e\u3057\u305f\u3002\n\u3053\u308c\u4ee5\u5916\u306b\u3082\u3001\u30d5\u30a3\u30eb\u30bf\u3067\u8272\u3005\u3067\u304d\u305d\u3046\u3067\u3059\u3002mod_mruby \u3067\u306f\u6700\u3082\u7c21\u5358\u306a\u30d5\u30a3\u30eb\u30bf\u306f\u6b21\u306e\u3088\u3046\u306b\u66f8\u3051\u307e\u3059\u3002\uff08\u4f55\u3082\u3057\u306a\u3044\u30b3\u30fc\u30c9\u3002\uff09\u4e0b\u8a18\u306e\u4f8b\u3060\u3068\u3001\u5909\u6570 content \u306b\u306f HTTP\u30ec\u30b9\u30dd\u30f3\u30b9\u306e\u30b3\u30f3\u30c6\u30f3\u30c4\u5185\u5bb9(HTML\u3001JavaScript\u3001CSS\u3001\u753b\u50cf\u30d0\u30a4\u30ca\u30ea\u3001JSON\u3001etc..)\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u3053\u3067\u52a0\u5de5\u304c\u51fa\u6765\u3061\u3083\u3044\u307e\u3059\u3002\n\n\u305f\u3060\u5927\u304d\u3044\u30b3\u30f3\u30c6\u30f3\u30c4\u306f\u30e1\u30e2\u30ea\u306b\u6ce8\u610f\u3068\u601d\u308f\u308c\u3002\n\n\n\u30d5\u30a3\u30eb\u30bf\u306e\u30b3\u30fc\u30c9\u4f8b\nf = Apache::Filter.new\n\ncontent = f.flatten\nf.cleanup\n\nf.insert_tail content\nf.insert_eos\n\n\n\u307e\u305f\u306e\u6a5f\u4f1a\u306b\u3001\u30b9\u30de\u30db\u7528\u306e\u753b\u50cf\u5909\u63db\u3092\u3057\u3066\u307f\u3088\u3046\u304b\u306a\u3068^^\n\u660e\u65e5(12/19)\u306f inokappa \u3055\u3093\u306b\u3088\u308b\u8a18\u4e8b\u3067\u3059\uff01\u3088\u308d\u3057\u304f\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n\n\u3053\u308c\u306f [mod_mruby ngx_mruby Advent Calendar 2014](http://qiita.com/advent-calendar/2014/mod-ngx-mruby) \u306e\uff11\uff18\u65e5\u76ee(12/18)\u306e\u6295\u7a3f\u3067\u3059\u3002\n\n\u3053\u306e\u6295\u7a3f\u306e\u4f4d\u7f6e\u3065\u3051\u3068\u3057\u3066\u306f\u3001\u30a2\u30c9\u30d9\u30f3\u30c8\u30ab\u30ec\u30f3\u30c0\u30fc\u306e\uff11\uff16\u65e5\u76ee\u306b\u66f8\u3044\u305f\u8a18\u4e8b\uff08[\u9759\u7684\u30ea\u30bd\u30fc\u30b9\u3092\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3067\u914d\u4fe1\u3059\u308b](http://qiita.com/hkusu/items/1b8e1f95faa8e62a98d9)\uff09\u306e\u5fdc\u7528\u7de8\u3067\u3059\u3002\n\nApache \u3067\u306f\u3001\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3057\u305f\u30b3\u30f3\u30c6\u30f3\u30c4\u306b\u5bfe\u3057\u3066\u3001\u66f4\u306b\u51fa\u529b\u30d5\u30a3\u30eb\u30bf\u3092\u304b\u3051\u3066\u51e6\u7406\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\uff08\u6709\u540d\u306a\u51fa\u529b\u30d5\u30a3\u30eb\u30bf\u3060\u3068 mod_deflate \u306a\u3069\u3002\uff09\n\n\u30a4\u30e1\u30fc\u30b8\u306f\u6b21\u306e\u3068\u304a\u308a\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2014-12-16 22.10.17.png](https://qiita-image-store.s3.amazonaws.com/0/35733/5c0795d5-7cd6-1ea8-838a-77f2efcd2980.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2014-12-16 22.10.17.png\")\n\n> Apache \u306e\u30d5\u30a3\u30eb\u30bf\u306b\u3064\u3044\u3066\u306e\u8aac\u660e\u306f\u3053\u3061\u3089\u3002\u3061\u306a\u307f\u306b\u30b3\u30f3\u30c6\u30f3\u30c4\u30cf\u30f3\u30c9\u30e9(\u4f8b\uff1aPHP\u3001Perl)\u306e\u524d\u306b\u8d77\u52d5\u3055\u308c\u308b\u306e\u304c\u5165\u529b\u30d5\u30a3\u30eb\u30bf\u3067\u3001\u5f8c\u306b\u8d77\u52d5\u3055\u308c\u308b\u306e\u304c\u51fa\u529b\u30d5\u30a3\u30eb\u30bf\u3067\u3059\u3002\n> \u21d2 http://httpd.apache.org/docs/current/ja/filter.html\n\n\u3082\u3061\u308d\u3093 mod_mruby \u3067\u3082\u30d5\u30a3\u30eb\u30bf\u3092\u4f5c\u6210\u3067\u304d\u307e\u3059\u306e\u3067\u3001\u540c\u69d8\u306b\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3057\u305f\u30b3\u30f3\u30c6\u30f3\u30c4\u306b\u5bfe\u3057\u3066\u4efb\u610f\u306e\u30d5\u30a3\u30eb\u30bf\u51e6\u7406\u3092\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\n\nmod_mruby \u3067\u306e\u30d7\u30ed\u30ad\u30b7\u306e\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f\uff11\uff16\u65e5\u76ee\u306b\u66f8\u3044\u305f\u306e\u3067\u3001\u4eca\u56de\u306fWEB\u30b5\u30fc\u30d3\u30b9\u306b\u304a\u3051\u308b\u901a\u4fe1\u306e\u524a\u6e1b\u3092\u76ee\u7684\u3068\u3057\u305f\u30d5\u30a3\u30eb\u30bf\u306e\u8a2d\u5b9a\u3092\uff12\u4f8b\u3001\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n> \u524d\u63d0\u3068\u306a\u308b\u74b0\u5883\u306f\u30a2\u30c9\u30d9\u30f3\u30c8\u30ab\u30ec\u30f3\u30c0\u30fc\u306e\uff13\u65e5\u76ee\u3001Apache \u306e\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u8a2d\u5b9a\u3084 mod_mruby \u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f8b\u306f\uff11\uff10\u65e5\u76ee\u306b\u66f8\u3044\u305f\u306e\u3067\u3001\u5b9c\u3057\u3051\u308c\u3070\u305d\u3061\u3089\u3082\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n> \u21d2 [mod_mruby \u3092 Amazon EC2\u3001Apache2.4 \u3078\u5c0e\u5165\u3059\u308b](http://qiita.com/hkusu/items/ca8622c83b0bfc2cac72)\uff08Apache \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f `2.4.10`\u3001mod_mruby \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f `1.9.7` \u3067\u3059\uff09\n> \u21d2 [mod_mruby \u306e\u53ef\u80fd\u6027\u3068\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u8a2d\u5b9a/\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f8b](http://qiita.com/hkusu/items/dce6ab77a418bb26765c)\n\n## \u2460 \u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3057\u305f\u30b3\u30f3\u30c6\u30f3\u30c4\u306eHTTP\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u3092\u64cd\u4f5c\n\n\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u5148\u304b\u3089\u8fd4\u3063\u3066\u304d\u305f\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u306b\u5bfe\u3057\u3001mod_mruby \u3067 `Cache-Control` \u30d8\u30c3\u30c0\u3092\u64cd\u4f5c\u3057\u3066\u3001\u30d6\u30e9\u30a6\u30b6\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u305b\u308b\u6642\u9593\u3092\u4efb\u610f\u306b\u6307\u5b9a\u3059\u308b\u4f8b\u3067\u3059\u3002\n\n```ruby:/usr/local/apache2/mruby/respose_header.rb\nr = Apache::Request.new\n\nif /\\.(gif|jpe?g|png)$/ =~ r.filename\n  r.headers_out['Cache-Control'] = 'max-age=20'\nend\n```\n\n\u3053\u306e\u4f8b\u3060\u3068 20\u79d2\u3060\u3051\u30d6\u30e9\u30a6\u30b6\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u305b\u307e\u3059\u3002\u4e0a\u8a18\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u51fa\u529b\u30d5\u30a3\u30eb\u30bf\u3068\u3057\u3066\u30d5\u30c3\u30af\u3057\u307e\u3059\u3002\n\n```apacheconf:***.conf\nSetOutputFilter mruby\nmrubyOutputFilter /usr/local/apache2/mruby/respose_header.rb\n```\n\n\u3059\u308b\u3068\u30d6\u30e9\u30a6\u30b6\u3078\u306eHTTP\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\uff08\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u5148\u306f GitHub Pages \u306e\u4f8b\u3067\u3059\u3002\uff09\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2014-12-16_15_05_22.png](https://qiita-image-store.s3.amazonaws.com/0/35733/a0927d39-7543-d641-af1f-f25e61e29993.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2014-12-16_15_05_22.png\")\n\n> \u30d5\u30a3\u30eb\u30bf\u306e\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f\u516c\u5f0f\u30da\u30fc\u30b8\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\n> \u21d2 http://httpd.apache.org/docs/current/ja/filter.html\n>\n> `<Files>` \u7b49\u306e\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3068\u7d44\u307f\u5408\u308f\u305b\u305f\u308a\u3001`.htaccess` \u306b\u66f8\u3044\u305f\u308a\u3082\u3067\u304d\u307e\u3059\u3002\n>\n> \u307e\u305f\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u30b9\u30af\u30ea\u30d7\u30c8\u5185\u3067\u62e1\u5f35\u5b50\u3092\u5224\u5b9a\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u62e1\u5f35\u5b50\u3092\u30ad\u30fc\u306b\u51fa\u529b\u30d5\u30a3\u30eb\u30bf\u3092\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u3082\u51fa\u6765\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u305f\u3060\u51fa\u529b\u30d5\u30a3\u30eb\u30bf\u306e\u30d5\u30a7\u30fc\u30ba\u3067 Apache \u306e HTTP\u30ea\u30af\u30a8\u30b9\u30c8\u3084\u30d8\u30c3\u30c0\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u306e\u306f\u884c\u5100\u304c\u60aa\u3044\u304b\u3082^^; \u307e\u3042\u3053\u3046\u3044\u3046\u8a2d\u5b9a\u3082\u3067\u304d\u308b\u3088\u3068\u3044\u3046\u3053\u3068\u3067..\n\n## \u2461 \u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3057\u305f\u30b3\u30f3\u30c6\u30f3\u30c4\u3092 gzip \u5727\u7e2e\u3057\u3066\u914d\u4fe1\n\n\u9759\u7684\u30b3\u30f3\u30c6\u30f3\u30c4\u3092 gzip \u5727\u7e2e\u3057\u3066\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5e2f\u57df\u3092\u7bc0\u7d04\u3057\u307e\u3059\u3002gzip \u5727\u7e2e\u306f [mod_deflate](http://httpd.apache.org/docs/2.4/filter.html) \u3092\u5229\u7528\u3057\u307e\u3059\u3002\u3061\u306a\u307f\u306b mod_deflate \u304c\u4f55\u3092\u3057\u3066\u304f\u308c\u308b\u304b\u3068\u3044\u3046\u3068\u3001\u30d6\u30e9\u30a6\u30b6\u304c gzip \u5727\u7e2e\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u6b21\u306e\u3088\u3046\u306a\u30d8\u30c3\u30c0\u3092\u9001\u3063\u3066\u304f\u308b\u306e\u3067\u3001\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2014-12-16_14_58_25.png](https://qiita-image-store.s3.amazonaws.com/0/35733/1a50b3c8-69da-6b74-9a62-3e0cda9e6bb1.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2014-12-16_14_58_25.png\")\n\nmod_deflate \u306f\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u5727\u7e2e\u3057\u3066\u9001\u51fa\u3057\u3001\u30d8\u30c3\u30c0\u306f\u6b21\u306e\u3088\u3046\u306b\u8fd4\u3057\u307e\u3059\u3002\u30d6\u30e9\u30a6\u30b6\u306f\u3053\u308c\u3067\u5727\u7e2e\u3055\u308c\u305f\u30b3\u30f3\u30c6\u30f3\u30c4\u3060\u3068\u5224\u65ad\u3057\u89e3\u51cd\u3057\u307e\u3059\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2014-12-16_14_58_42.png](https://qiita-image-store.s3.amazonaws.com/0/35733/c4a8e246-6e97-b205-d1fd-bd353f1ddfe2.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2014-12-16_14_58_42.png\")\n\n> \u3082\u3057 mod_deflate \u304c\u30b5\u30fc\u30d0\u306b\u5165\u3063\u3066\u306a\u3044\uff08mod_deflate.so \u304c\u5b58\u5728\u3057\u306a\u3044\uff09\u5834\u5408\u306f\u3001\u6b21\u306e\u3088\u3046\u306b configure \u3057\u76f4\u3057\u3066\u304b\u3089 Apache \u3092\u518d\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u3068\u5c0e\u5165\u3067\u304d\u307e\u3059\u3002\n> `$ ./configure --enable-deflate`\n\n\u8a2d\u5b9a\u65b9\u6cd5\u306b\u3064\u3044\u3066\u306f\u3001\u307e\u305a `.conf` \u30d5\u30a1\u30a4\u30eb\u306b\u3066 mod_deflate \u3092\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\n\n```apacheconf:***.conf\nLoadModule deflate_module modules/mod_deflate.so\n```\n\n\u4f8b\u3068\u3057\u3066 PNG \u5f62\u5f0f\u306e\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u3092 gzip \u5727\u7e2e\u3059\u308b\u5834\u5408\u306f\u6b21\u306e\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```apacheconf:***.conf\nAddOutputFilterByType DEFLATE image/png\n```\n\n\u3059\u308b\u3068\u30d6\u30e9\u30a6\u30b6\u3078\u306eHTTP\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\uff08\u3053\u308c\u3082\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u5148\u306f GitHub Pages \u306e\u4f8b\u3067\u3059\u3002\uff09\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2014-12-16_15_03_19.png](https://qiita-image-store.s3.amazonaws.com/0/35733/47954144-814f-31bb-f652-cbe6fbd066f8.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2014-12-16_15_03_19.png\")\n\n\u3061\u306a\u307f\u306b\u30d5\u30a3\u30eb\u30bf\u306f\u8907\u6570\u3092\u4f75\u7528\u3067\u304d\u308b\u306e\u3067\u3001\u4f8b\u3048\u3070\u4e0a\u8a18\u306e\u2460\u2461\u3092\u540c\u6642\u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2014-12-16_15_06_46.png](https://qiita-image-store.s3.amazonaws.com/0/35733/4925c259-d55a-ccfb-620b-0b79c8c4319c.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2014-12-16_15_06_46.png\")\n\n## \u304a\u308f\u308a\u306b\n\n\u4eca\u56de\u306f mod_mruby \u3067\u30ea\u30fc\u30d0\u30b9\u30d7\u30ed\u30ad\u30b7\u3057\u305f\u30b3\u30f3\u30c6\u30f3\u30c4\u306b\u5bfe\u3057\u3066\u3001\u66f4\u306b\u901a\u4fe1\u306e\u524a\u6e1b\u3092\u76ee\u7684\u3068\u3057\u305f\u30d5\u30a3\u30eb\u30bf\u3092\u9069\u7528\u3059\u308b\u4f8b\u3092\u7d39\u4ecb\u3057\u307e\u3057\u305f\u3002\n\n\u3053\u308c\u4ee5\u5916\u306b\u3082\u3001\u30d5\u30a3\u30eb\u30bf\u3067\u8272\u3005\u3067\u304d\u305d\u3046\u3067\u3059\u3002mod_mruby \u3067\u306f\u6700\u3082\u7c21\u5358\u306a\u30d5\u30a3\u30eb\u30bf\u306f\u6b21\u306e\u3088\u3046\u306b\u66f8\u3051\u307e\u3059\u3002\uff08\u4f55\u3082\u3057\u306a\u3044\u30b3\u30fc\u30c9\u3002\uff09\u4e0b\u8a18\u306e\u4f8b\u3060\u3068\u3001\u5909\u6570 `content` \u306b\u306f HTTP\u30ec\u30b9\u30dd\u30f3\u30b9\u306e\u30b3\u30f3\u30c6\u30f3\u30c4\u5185\u5bb9(HTML\u3001JavaScript\u3001CSS\u3001\u753b\u50cf\u30d0\u30a4\u30ca\u30ea\u3001JSON\u3001etc..)\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u3053\u3067\u52a0\u5de5\u304c\u51fa\u6765\u3061\u3083\u3044\u307e\u3059\u3002\n\n> \u305f\u3060\u5927\u304d\u3044\u30b3\u30f3\u30c6\u30f3\u30c4\u306f\u30e1\u30e2\u30ea\u306b\u6ce8\u610f\u3068\u601d\u308f\u308c\u3002\n\n```ruby:\u30d5\u30a3\u30eb\u30bf\u306e\u30b3\u30fc\u30c9\u4f8b\nf = Apache::Filter.new\n\ncontent = f.flatten\nf.cleanup\n\nf.insert_tail content\nf.insert_eos\n```\n\n\u307e\u305f\u306e\u6a5f\u4f1a\u306b\u3001\u30b9\u30de\u30db\u7528\u306e\u753b\u50cf\u5909\u63db\u3092\u3057\u3066\u307f\u3088\u3046\u304b\u306a\u3068^^\n\n\u660e\u65e5(12/19)\u306f [inokappa](http://qiita.com/inokappa) \u3055\u3093\u306b\u3088\u308b\u8a18\u4e8b\u3067\u3059\uff01\u3088\u308d\u3057\u304f\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n", "tags": ["mod_mruby", "AdventCalendar", "Apache", "mruby", "Ruby"]}