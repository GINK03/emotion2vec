{"context": "\n\n\u73fe\u8c61\nnvm \u3092\u5f8c\u8ff0\u306e\u8a2d\u5b9a\u3067 ansible-playbook \u3057\u3001\u305d\u306e\u5f8c\u3082\u3046\u4e00\u5ea6 ansible-playbook \u3059\u308b\u3068\u4ee5\u4e0b\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u767a\u751f\u3057\u3001GATHERING FACTS \u306e\u6642\u70b9\u3067\u30a8\u30e9\u30fc\u3068\u306a\u308b\nGATHERING FACTS *************************************************************** \n<IP_ADDRESS> ESTABLISH CONNECTION FOR USER: USER_NAME\n<IP_ADDRESS> REMOTE_MODULE setup\n<IP_ADDRESS> EXEC ssh -C -tt -v -o ForwardAgent=yes -o ControlMaster=no -F ssh_config -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o ConnectTimeout=10 IP_ADDRESS /bin/sh -c 'mkdir -p $HOME/.ansible/tmp/ansible-tmp-1476609685.34-231943826271836 && chmod a+rx $HOME/.ansible/tmp/ansible-tmp-1476609685.34-231943826271836 && echo $HOME/.ansible/tmp/ansible-tmp-1476609685.34-231943826271836'\n/root/.ansible/tmp/ansible-tmp-1476609685.34-231943826271836/setup\n<IP_ADDRESS> EXEC ssh -C -tt -v -o ForwardAgent=yes -o ControlMaster=no -F ssh_config -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthenticat/root/.ansible/tmp/ansible-tmp-1476609685.34-231943826271836/ >/dev/null 2>&1'\nfailed: [IP_ADDRESS] => {\"failed\": true, \"parsed\": false}\n/root/.ansible/tmp/ansible-tmp-1476609685.34-231943826271836/setup': [Errno 2] No such file or directory\nOpenSSH_6.9p1, LibreSSL 2.1.8\ndebug1: Reading configuration data ssh_config\ndebug1: ssh_config line 1: Applying options for IP_ADDRESS\ndebug1: Connecting to IP_ADDRESS [IP_ADDRESS] port 22.\ndebug1: fd 3 clearing O_NONBLOCK\ndebug1: Connection established.\ndebug1: identity file /Users/USER_NAME/.ssh/id_rsa type 1\ndebug1: key_load_public: No such file or directory\ndebug1: identity file /Users/USER_NAME/.ssh/id_rsa-cert type -1\ndebug1: Enabling compatibility mode for protocol 2.0\ndebug1: Local version string SSH-2.0-OpenSSH_6.9\ndebug1: Remote protocol version 2.0, remote software version OpenSSH_5.3\ndebug1: match: OpenSSH_5.3 pat OpenSSH_5* compat 0x0c000000\ndebug1: Authenticating to IP_ADDRESS:22 as 'root'\ndebug1: SSH2_MSG_KEXINIT sent\ndebug1: SSH2_MSG_KEXINIT received\ndebug1: kex: server->client aes128-ctr umac-64@openssh.com zlib@openssh.com\ndebug1: kex: client->server aes128-ctr umac-64@openssh.com zlib@openssh.com\ndebug1: SSH2_MSG_KEX_DH_GEX_REQUEST(1024<3072<8192) sent\ndebug1: got SSH2_MSG_KEX_DH_GEX_GROUP\ndebug1: SSH2_MSG_KEX_DH_GEX_INIT sent\ndebug1: got SSH2_MSG_KEX_DH_GEX_REPLY\ndebug1: Server host key: ssh-rsa SHA256:hogehogehoge\nWarning: Permanently added 'IP_ADDRESS' (RSA) to the list of known hosts.\ndebug1: SSH2_MSG_NEWKEYS sent\ndebug1: expecting SSH2_MSG_NEWKEYS\ndebug1: SSH2_MSG_NEWKEYS received\ndebug1: SSH2_MSG_SERVICE_REQUEST sent\ndebug1: SSH2_MSG_SERVICE_ACCEPT received\ndebug1: Authentications that can continue: publickey,gssapi-keyex,gssapi-with-mic,password\ndebug1: Next authentication method: publickey\ndebug1: Offering RSA public key: /Users/USER_NAME/.ssh/id_rsa\ndebug1: Server accepts key: pkalg ssh-rsa blen 279\ndebug1: Enabling compression at level 6.\ndebug1: Authentication succeeded (publickey).\nAuthenticated to IP_ADDRESS ([IP_ADDRESS]:22).\ndebug1: channel 0: new [client-session]\ndebug1: Requesting no-more-sessions@openssh.com\ndebug1: Entering interactive session.\ndebug1: Requesting authentication agent forwarding.\ndebug1: Sending command: /bin/sh -c 'LANG=en_US.UTF-8 LC_CTYPE=en_US.UTF-8 /usr/bin/python \\033[?25h\\033[0G\\033[K\\033[?25h\\033[0G\\033[K/root/.ansible/tmp/ansible-tmp-1476609685.34-231943826271836/setup; rm -rf \\033[?25h\\033[0G\\033[K\\033[?25h\\033[0G\\033[K/root/.ansible/tmp/ansible-tmp-1476609685.34-231943826271836/ >/dev/null 2>&1'\ndebug1: client_input_channel_req: channel 0 rtype exit-status reply 0\ndebug1: client_input_channel_req: channel 0 rtype eow@openssh.com reply 0\ndebug1: channel 0: free: client-session, nchannels 1\ndebug1: fd 1 clearing O_NONBLOCK\ndebug1: fd 2 clearing O_NONBLOCK\nConnection to IP_ADDRESS closed.\nTransferred: sent 4024, received 3040 bytes, in 0.9 seconds\nBytes per second: sent 4470.7, received 3377.5\ndebug1: Exit status 0\ndebug1: compress outgoing: raw data 727, compressed 449, factor 0.62\ndebug1: compress incoming: raw data 449, compressed 727, factor 1.62\n\n\n\u767a\u751f\u74b0\u5883\n\n\u30db\u30b9\u30c8\n\nMac OS X 10.11.6\nansible 1.9.6\n\n\n\u30b2\u30b9\u30c8\n\nCentOS 6.8(digital ocean)\n\n\n\u554f\u984c\u767a\u751f\u3057\u305f\u8a2d\u5b9a\n\nnode.yml\n---\n- name: download and install nvm\n  shell: curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.32.0/install.sh | bash\n  args:\n    creates: \"{{ ansible_env.HOME }}/.nvm/nvm.sh\"\n\n- name: Register the NVM_DIR\n  shell: echo $NVM_DIR\n  register: nvm_dir \n\n- name: install node\n  shell: . {{ nvm_dir.stdout }}/nvm.sh && nvm install {{ node_version }} && nvm run {{ node_version }} --version && nvm alias default {{ node_version }}\n  args:\n    creates: \"{{ nvm_dir.stdout }}/versions/node/v{{ node_version }}\"\n\n\n\n\u5bfe\u51e6\nnodebrew \u3092\u4f7f\u3063\u305f\n\nnode.yml\n---\n- name: download and install nodebrew\n  shell: curl -L git.io/nodebrew | perl - setup\n  args:\n    creates: \"{{ ansible_env.HOME }}/.nodebrew\"\n\n- name: path to current node\n  lineinfile:\n    dest=~/.bashrc\n    state=present\n    line=\"PATH={{ ansible_env.HOME }}/.nodebrew/current/bin:$PATH\"\n\n- name: install node\n  shell: nodebrew install-binary {{ node_version }} && nodebrew alias default {{ node_version }} && nodebrew use {{ node_version }} && npm install -g webpack\n  args:\n    creates: \"{{ ansible_env.HOME }}/.nodebrew/node/{{ node_version }}\"\n\n\n\n\u3000\u5099\u8003\n\nssh \u306e\u74b0\u5883\u306b\u4f9d\u5b58\u3059\u308b\u554f\u984c\u306a\u306e\u304b\u3082\u3057\u308c\u306a\u3044\u304c\u3001\u5bfe\u51e6\u3067\u304d\u306a\u304b\u3063\u305f\u305f\u3081\u30c4\u30fc\u30eb\u3092\u5909\u3048\u3066\u5bfe\u5fdc\u3057\u305f\n\nnvm \u3068 nodebrew \u3067\u30d0\u30fc\u30b8\u30e7\u30f3\u8868\u8a18\u306b v \u3092\u542b\u3080\u304b\u304c\u5fae\u5999\u306b\u7570\u306a\u308b\u306e\u3067\u6ce8\u610f\n\n## \u73fe\u8c61\nnvm \u3092\u5f8c\u8ff0\u306e\u8a2d\u5b9a\u3067 `ansible-playbook` \u3057\u3001\u305d\u306e\u5f8c\u3082\u3046\u4e00\u5ea6 `ansible-playbook` \u3059\u308b\u3068\u4ee5\u4e0b\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u767a\u751f\u3057\u3001`GATHERING FACTS` \u306e\u6642\u70b9\u3067\u30a8\u30e9\u30fc\u3068\u306a\u308b\n\n```\nGATHERING FACTS *************************************************************** \n<IP_ADDRESS> ESTABLISH CONNECTION FOR USER: USER_NAME\n<IP_ADDRESS> REMOTE_MODULE setup\n<IP_ADDRESS> EXEC ssh -C -tt -v -o ForwardAgent=yes -o ControlMaster=no -F ssh_config -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o ConnectTimeout=10 IP_ADDRESS /bin/sh -c 'mkdir -p $HOME/.ansible/tmp/ansible-tmp-1476609685.34-231943826271836 && chmod a+rx $HOME/.ansible/tmp/ansible-tmp-1476609685.34-231943826271836 && echo $HOME/.ansible/tmp/ansible-tmp-1476609685.34-231943826271836'\n/root/.ansible/tmp/ansible-tmp-1476609685.34-231943826271836/setup\n<IP_ADDRESS> EXEC ssh -C -tt -v -o ForwardAgent=yes -o ControlMaster=no -F ssh_config -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthenticat/root/.ansible/tmp/ansible-tmp-1476609685.34-231943826271836/ >/dev/null 2>&1'\nfailed: [IP_ADDRESS] => {\"failed\": true, \"parsed\": false}\n/root/.ansible/tmp/ansible-tmp-1476609685.34-231943826271836/setup': [Errno 2] No such file or directory\nOpenSSH_6.9p1, LibreSSL 2.1.8\ndebug1: Reading configuration data ssh_config\ndebug1: ssh_config line 1: Applying options for IP_ADDRESS\ndebug1: Connecting to IP_ADDRESS [IP_ADDRESS] port 22.\ndebug1: fd 3 clearing O_NONBLOCK\ndebug1: Connection established.\ndebug1: identity file /Users/USER_NAME/.ssh/id_rsa type 1\ndebug1: key_load_public: No such file or directory\ndebug1: identity file /Users/USER_NAME/.ssh/id_rsa-cert type -1\ndebug1: Enabling compatibility mode for protocol 2.0\ndebug1: Local version string SSH-2.0-OpenSSH_6.9\ndebug1: Remote protocol version 2.0, remote software version OpenSSH_5.3\ndebug1: match: OpenSSH_5.3 pat OpenSSH_5* compat 0x0c000000\ndebug1: Authenticating to IP_ADDRESS:22 as 'root'\ndebug1: SSH2_MSG_KEXINIT sent\ndebug1: SSH2_MSG_KEXINIT received\ndebug1: kex: server->client aes128-ctr umac-64@openssh.com zlib@openssh.com\ndebug1: kex: client->server aes128-ctr umac-64@openssh.com zlib@openssh.com\ndebug1: SSH2_MSG_KEX_DH_GEX_REQUEST(1024<3072<8192) sent\ndebug1: got SSH2_MSG_KEX_DH_GEX_GROUP\ndebug1: SSH2_MSG_KEX_DH_GEX_INIT sent\ndebug1: got SSH2_MSG_KEX_DH_GEX_REPLY\ndebug1: Server host key: ssh-rsa SHA256:hogehogehoge\nWarning: Permanently added 'IP_ADDRESS' (RSA) to the list of known hosts.\ndebug1: SSH2_MSG_NEWKEYS sent\ndebug1: expecting SSH2_MSG_NEWKEYS\ndebug1: SSH2_MSG_NEWKEYS received\ndebug1: SSH2_MSG_SERVICE_REQUEST sent\ndebug1: SSH2_MSG_SERVICE_ACCEPT received\ndebug1: Authentications that can continue: publickey,gssapi-keyex,gssapi-with-mic,password\ndebug1: Next authentication method: publickey\ndebug1: Offering RSA public key: /Users/USER_NAME/.ssh/id_rsa\ndebug1: Server accepts key: pkalg ssh-rsa blen 279\ndebug1: Enabling compression at level 6.\ndebug1: Authentication succeeded (publickey).\nAuthenticated to IP_ADDRESS ([IP_ADDRESS]:22).\ndebug1: channel 0: new [client-session]\ndebug1: Requesting no-more-sessions@openssh.com\ndebug1: Entering interactive session.\ndebug1: Requesting authentication agent forwarding.\ndebug1: Sending command: /bin/sh -c 'LANG=en_US.UTF-8 LC_CTYPE=en_US.UTF-8 /usr/bin/python \\033[?25h\\033[0G\\033[K\\033[?25h\\033[0G\\033[K/root/.ansible/tmp/ansible-tmp-1476609685.34-231943826271836/setup; rm -rf \\033[?25h\\033[0G\\033[K\\033[?25h\\033[0G\\033[K/root/.ansible/tmp/ansible-tmp-1476609685.34-231943826271836/ >/dev/null 2>&1'\ndebug1: client_input_channel_req: channel 0 rtype exit-status reply 0\ndebug1: client_input_channel_req: channel 0 rtype eow@openssh.com reply 0\ndebug1: channel 0: free: client-session, nchannels 1\ndebug1: fd 1 clearing O_NONBLOCK\ndebug1: fd 2 clearing O_NONBLOCK\nConnection to IP_ADDRESS closed.\nTransferred: sent 4024, received 3040 bytes, in 0.9 seconds\nBytes per second: sent 4470.7, received 3377.5\ndebug1: Exit status 0\ndebug1: compress outgoing: raw data 727, compressed 449, factor 0.62\ndebug1: compress incoming: raw data 449, compressed 727, factor 1.62\n```\n\n## \u767a\u751f\u74b0\u5883\n### \u30db\u30b9\u30c8\n- Mac OS X 10.11.6\n- ansible 1.9.6\n\n### \u30b2\u30b9\u30c8\n- CentOS 6.8(digital ocean)\n\n## \u554f\u984c\u767a\u751f\u3057\u305f\u8a2d\u5b9a\n\n```node.yml\n---\n- name: download and install nvm\n  shell: curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.32.0/install.sh | bash\n  args:\n    creates: \"{{ ansible_env.HOME }}/.nvm/nvm.sh\"\n\n- name: Register the NVM_DIR\n  shell: echo $NVM_DIR\n  register: nvm_dir \n\n- name: install node\n  shell: . {{ nvm_dir.stdout }}/nvm.sh && nvm install {{ node_version }} && nvm run {{ node_version }} --version && nvm alias default {{ node_version }}\n  args:\n    creates: \"{{ nvm_dir.stdout }}/versions/node/v{{ node_version }}\"\n```\n\n## \u5bfe\u51e6\n\nnodebrew \u3092\u4f7f\u3063\u305f\n\n```node.yml\n---\n- name: download and install nodebrew\n  shell: curl -L git.io/nodebrew | perl - setup\n  args:\n    creates: \"{{ ansible_env.HOME }}/.nodebrew\"\n\n- name: path to current node\n  lineinfile:\n    dest=~/.bashrc\n    state=present\n    line=\"PATH={{ ansible_env.HOME }}/.nodebrew/current/bin:$PATH\"\n\n- name: install node\n  shell: nodebrew install-binary {{ node_version }} && nodebrew alias default {{ node_version }} && nodebrew use {{ node_version }} && npm install -g webpack\n  args:\n    creates: \"{{ ansible_env.HOME }}/.nodebrew/node/{{ node_version }}\"\n```\n\n##\u3000\u5099\u8003\n- ssh \u306e\u74b0\u5883\u306b\u4f9d\u5b58\u3059\u308b\u554f\u984c\u306a\u306e\u304b\u3082\u3057\u308c\u306a\u3044\u304c\u3001\u5bfe\u51e6\u3067\u304d\u306a\u304b\u3063\u305f\u305f\u3081\u30c4\u30fc\u30eb\u3092\u5909\u3048\u3066\u5bfe\u5fdc\u3057\u305f\n- `nvm` \u3068 `nodebrew` \u3067\u30d0\u30fc\u30b8\u30e7\u30f3\u8868\u8a18\u306b `v` \u3092\u542b\u3080\u304b\u304c\u5fae\u5999\u306b\u7570\u306a\u308b\u306e\u3067\u6ce8\u610f\n", "tags": ["Ansible", "nvm", "nodebrew", "Node.js"]}