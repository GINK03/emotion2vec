{"tags": ["FacebookMarketingAPI", "FacebookSDK", "PHP", "Facebook"], "context": "\n\n\u6982\u8981\nFacebook Marketing API\u306e\u30d0\u30fc\u30b8\u30e7\u30f32.4\u304b\u3089\u4eca\u5229\u7528\u3057\u3066\u3044\u308b\u30ec\u30dd\u30fc\u30c8\u96c6\u8a08\u306ereportstats\u304c\u4f7f\u3048\u306a\u304f\u306a\u308b\u305f\u3081\u3001\u6bd4\u8f03\u7684\u6700\u8fd1\u51fa\u6765\u305f\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306einsights\u3092\u8a66\u3057\u306b\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u8abf\u67fb\nreportstats\u3068insights\u3092\u5229\u7528\u3057\u3066\u307f\u308b\u3068\u3001\u5fae\u5999\u306b\u53d6\u308c\u308b\u4ef6\u6570\u304c\u7570\u306a\u3063\u3066\u3044\u308b\u72b6\u614b\u306a\u306e\u3067\u3069\u3046\u3057\u305f\u3082\u3093\u304b\u306a\u3068\u60a9\u3093\u3067\u3044\u307e\u3057\u305f\u3002\n\u3068\u3053\u308d\u304c\u4eca\u9031\u304f\u3089\u3044\u304b\u3089\u3001Facebook\u306eWeb\u30c4\u30fc\u30eb\u3067\u3042\u308b\u5e83\u544a\u30de\u30cd\u30fc\u30b8\u30e3\u5074\u3067insights\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u53e9\u304d\u59cb\u3081\u3066\u3044\u308b\u306e\u3067\u3001\u4f7f\u3044\u65b9\u3092\u773a\u3081\u3066\u307f\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u547c\u3093\u3067\u3044\u308b\u3088\u3046\u3067\u3057\u305f\u3002\n\uff08\u30d1\u30e9\u30e1\u30fc\u30bf\u306eaccess_token\u306f\u7701\u3044\u3066\u3044\u307e\u3059\u3002)\nhttps://graph.facebook.com/v2.3/act_0000000000/insights?action_attribution_windows=[\"28d_click\"]&callback=__globalCallbacks.f667930cc4&date_preset=yesterday&default_summary=false&fields=[\"adgroup_name\",\"campaign_group_name\",\"campaign_group_id\",\"adgroup_id\",\"impressions\",\"social_reach\",\"social_impressions\",\"clicks\",\"social_clicks\",\"ctr\",\"cpc\",\"cost_per_unique_click\",\"spend\",\"total_actions\",\"cost_per_action_type\",\"actions\"]&filtering=[{\"field\":\"adgroup.delivery_info\",\"operator\":\"IN\",\"value\":[\"active\",\"archived\",\"inactive\",\"not_delivering\",\"not_published\",\"pending_review\",\"recently_rejected\",\"rejected\",\"scheduled\"]},{\"field\":\"adgroup.impressions\",\"operator\":\"GREATER_THAN\",\"value\":0},{\"field\":\"adgroup.name\",\"operator\":\"CONTAIN\",\"value\":\"cont\"}]&level=adgroup&limit=5000&locale=ja_JP&method=post&pretty=0&time_increment=1\n\nmethod=post\u3092\u5f15\u6570\u306b\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u975e\u540c\u671f\u3067\u51e6\u7406\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3057\u305f\u3002\n\u7d50\u679c\u306fcallback\u3057\u305f\u3068\u3053\u308d\u306b\u8fd4\u3063\u3066\u304d\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\n\u5b9f\u969b\u306b\u3084\u3063\u3066\u307f\u308b\u3002\n\u8abf\u67fb\u3067\u51fa\u3066\u3044\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u305d\u306e\u307e\u307e\u4f7f\u3046\u3068Graph API Explorer\u306f\u6b7b\u3093\u3067\u3057\u307e\u3044\u307e\u3057\u305f\u3002\nlimit=5000\u306f\u3055\u3059\u304c\u306b\u3069\u304e\u3064\u3044\u306e\u3067\u3001limit=1\u3067\u3084\u3063\u3066\u307f\u3066\u3082\u8fd4\u3063\u3066\u304d\u307e\u305b\u3093\u3002\n\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u771f\u4f3c\u3066\u30d0\u30c3\u30c1\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u65b9\u3067\u8a66\u305d\u3046\u3068\u601d\u3063\u305f\u306e\u3067\u3059\u304c\u3001sdk\u306b\u975e\u540c\u671f\u51e6\u7406\u306f\u7121\u3044\u304b\u306a\u3068\u601d\u3063\u3066\u898b\u3066\u305f\u3089getInsightsAsync\u3068\u3044\u3046\u306e\u304c\u3042\u3063\u305f\u306e\u3067\u3053\u308c\u3092\u8a66\u3059\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\ntest_job.php\nrequire_once __DIR__ . '/vendor/autoload.php';\n\nuse FacebookAds\\Api;\nuse FacebookAds\\Object\\AdAccount;\nuse FacebookAds\\Object\\Values\\InsightsLevels;\nuse FacebookAds\\Object\\Values\\InsightsPresets;\n\n$app_id = '<YOUR_APP_ID>';\n$app_secret = '<YOUR_APP_SECRET>';\n$accessToken = '<YOUR_ACCESS_TOKEN>';\n$account_id = 'act_<YOUR_ACOUNT_ID>';\n\ntry {\n    Api::init(\n        $app_id,\n        $app_secret,\n        $accessToken\n    );\n    $api = Api::instance();\n\n    $ad_account = new AdAccount($account_id);\n    $async_job = $ad_account->getInsightsAsync(\n        [],\n        [\n            'fields' => 'impressions',\n            'level' => InsightsLevels::ADGROUP,\n            'date_preset' => InsightsPresets::YESTERDAY,\n            'limit' => 100,\n        ]);\n\n    while (1) {\n        if ($async_job->read()->isComplete()) {\n            var_dump($async_job->read()->getData());\n            insertReportData($async_job->getResult());\n            $async_job->read()->delete();\n            break;\n        }\n        sleep(10);\n    }\n} catch (Exception $e) {\n    var_dump($e);\n}\n\nfunction insertReportData($insights)\n{\n    $insights->setUseImplicitFetch(true);\n    while ($insights->valid()) {\n        var_dump($insights->current());\n        $insights->next();\n    }\n}\n\n\n\nvar_dump($async_job->read()->getData());\u3067\u51fa\u529b\u3055\u308c\u308b\u5024\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\narray(6) {\n  [\"id\"]=>\n  string(13) \"0000000000000\"\n  [\"account_id\"]=>\n  string(15) \"0000000000\"\n  [\"time_ref\"]=>\n  int(1438232892)\n  [\"async_status\"]=>\n  string(11) \"Job Running\"\n  [\"async_percent_completion\"]=>\n  int(100)\n  [\"is_running\"]=>\n  bool(true)\n}\n\n$job->read()->isComplete()\u3067true\u304c\u8fd4\u3063\u3066\u304d\u3066\u3044\u308b\u306e\u306b\u3082\u304b\u304b\u308f\u3089\u305a\u3001async_status\u304cJob Running\u3063\u3066\u306a\u3063\u3066\u308b\u306e\u3067\u3001\u305d\u306e\u5f8c\u306b\u5024\u3092\u53d6\u308d\u3046\u3068\u3059\u308b\u3068Error accessing adreport job.\u3068\u3044\u3046\u4f8b\u5916\u304c\u6295\u3052\u3089\u308c\u3066\u3057\u307e\u3046\u3068\u3044\u3046(^_^;)\nasync_status\u304cJob Completed\u3068\u306a\u3063\u3066\u3044\u308b\u3068\u5b9f\u969b\u306b\u5b8c\u4e86\u306b\u306a\u3063\u3066\u3044\u308b\u72b6\u614b\u306a\u306e\u3067\u3001sdk\u5074\u306f\u305d\u3053\u3092\u4f55\u3068\u304b\u3057\u3066\u6b32\u3057\u3044\u306a\u3041\u3002\n\u4fee\u6b63\u3057\u3066PR\u6295\u3052\u308b\u3068\u3044\u3044\u3093\u3060\u308d\u3046\u304b\u3002\n# \u6982\u8981\n\nFacebook Marketing API\u306e\u30d0\u30fc\u30b8\u30e7\u30f32.4\u304b\u3089\u4eca\u5229\u7528\u3057\u3066\u3044\u308b\u30ec\u30dd\u30fc\u30c8\u96c6\u8a08\u306e[reportstats](https://developers.facebook.com/docs/marketing-api/adreportstats/v2.4)\u304c\u4f7f\u3048\u306a\u304f\u306a\u308b\u305f\u3081\u3001\u6bd4\u8f03\u7684\u6700\u8fd1\u51fa\u6765\u305f\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e[insights](https://developers.facebook.com/docs/marketing-api/insights/v2.4)\u3092\u8a66\u3057\u306b\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\n# \u8abf\u67fb\n\nreportstats\u3068insights\u3092\u5229\u7528\u3057\u3066\u307f\u308b\u3068\u3001\u5fae\u5999\u306b\u53d6\u308c\u308b\u4ef6\u6570\u304c\u7570\u306a\u3063\u3066\u3044\u308b\u72b6\u614b\u306a\u306e\u3067\u3069\u3046\u3057\u305f\u3082\u3093\u304b\u306a\u3068\u60a9\u3093\u3067\u3044\u307e\u3057\u305f\u3002\n\u3068\u3053\u308d\u304c\u4eca\u9031\u304f\u3089\u3044\u304b\u3089\u3001Facebook\u306eWeb\u30c4\u30fc\u30eb\u3067\u3042\u308b\u5e83\u544a\u30de\u30cd\u30fc\u30b8\u30e3\u5074\u3067insights\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u53e9\u304d\u59cb\u3081\u3066\u3044\u308b\u306e\u3067\u3001\u4f7f\u3044\u65b9\u3092\u773a\u3081\u3066\u307f\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u547c\u3093\u3067\u3044\u308b\u3088\u3046\u3067\u3057\u305f\u3002\n\uff08\u30d1\u30e9\u30e1\u30fc\u30bf\u306eaccess_token\u306f\u7701\u3044\u3066\u3044\u307e\u3059\u3002)\n\n```\nhttps://graph.facebook.com/v2.3/act_0000000000/insights?action_attribution_windows=[\"28d_click\"]&callback=__globalCallbacks.f667930cc4&date_preset=yesterday&default_summary=false&fields=[\"adgroup_name\",\"campaign_group_name\",\"campaign_group_id\",\"adgroup_id\",\"impressions\",\"social_reach\",\"social_impressions\",\"clicks\",\"social_clicks\",\"ctr\",\"cpc\",\"cost_per_unique_click\",\"spend\",\"total_actions\",\"cost_per_action_type\",\"actions\"]&filtering=[{\"field\":\"adgroup.delivery_info\",\"operator\":\"IN\",\"value\":[\"active\",\"archived\",\"inactive\",\"not_delivering\",\"not_published\",\"pending_review\",\"recently_rejected\",\"rejected\",\"scheduled\"]},{\"field\":\"adgroup.impressions\",\"operator\":\"GREATER_THAN\",\"value\":0},{\"field\":\"adgroup.name\",\"operator\":\"CONTAIN\",\"value\":\"cont\"}]&level=adgroup&limit=5000&locale=ja_JP&method=post&pretty=0&time_increment=1\n```\n\n`method=post`\u3092\u5f15\u6570\u306b\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u975e\u540c\u671f\u3067\u51e6\u7406\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3057\u305f\u3002\n\u7d50\u679c\u306fcallback\u3057\u305f\u3068\u3053\u308d\u306b\u8fd4\u3063\u3066\u304d\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\n\n# \u5b9f\u969b\u306b\u3084\u3063\u3066\u307f\u308b\u3002\n\n\u8abf\u67fb\u3067\u51fa\u3066\u3044\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u305d\u306e\u307e\u307e\u4f7f\u3046\u3068[Graph API Explorer](https://developers.facebook.com/tools/explorer)\u306f\u6b7b\u3093\u3067\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n`limit=5000`\u306f\u3055\u3059\u304c\u306b\u3069\u304e\u3064\u3044\u306e\u3067\u3001`limit=1`\u3067\u3084\u3063\u3066\u307f\u3066\u3082\u8fd4\u3063\u3066\u304d\u307e\u305b\u3093\u3002\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u771f\u4f3c\u3066\u30d0\u30c3\u30c1\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u65b9\u3067\u8a66\u305d\u3046\u3068\u601d\u3063\u305f\u306e\u3067\u3059\u304c\u3001sdk\u306b\u975e\u540c\u671f\u51e6\u7406\u306f\u7121\u3044\u304b\u306a\u3068\u601d\u3063\u3066\u898b\u3066\u305f\u3089[getInsightsAsync](https://github.com/facebook/facebook-php-ads-sdk/blob/6f0f21e62a7df4d9961ccce94575a9197b741b54/src/FacebookAds/Object/AdAccount.php#L289)\u3068\u3044\u3046\u306e\u304c\u3042\u3063\u305f\u306e\u3067\u3053\u308c\u3092\u8a66\u3059\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\n```test_job.php\nrequire_once __DIR__ . '/vendor/autoload.php';\n\nuse FacebookAds\\Api;\nuse FacebookAds\\Object\\AdAccount;\nuse FacebookAds\\Object\\Values\\InsightsLevels;\nuse FacebookAds\\Object\\Values\\InsightsPresets;\n\n$app_id = '<YOUR_APP_ID>';\n$app_secret = '<YOUR_APP_SECRET>';\n$accessToken = '<YOUR_ACCESS_TOKEN>';\n$account_id = 'act_<YOUR_ACOUNT_ID>';\n\ntry {\n    Api::init(\n        $app_id,\n        $app_secret,\n        $accessToken\n    );\n    $api = Api::instance();\n\n    $ad_account = new AdAccount($account_id);\n    $async_job = $ad_account->getInsightsAsync(\n        [],\n        [\n            'fields' => 'impressions',\n            'level' => InsightsLevels::ADGROUP,\n            'date_preset' => InsightsPresets::YESTERDAY,\n            'limit' => 100,\n        ]);\n\n    while (1) {\n        if ($async_job->read()->isComplete()) {\n            var_dump($async_job->read()->getData());\n            insertReportData($async_job->getResult());\n            $async_job->read()->delete();\n            break;\n        }\n        sleep(10);\n    }\n} catch (Exception $e) {\n    var_dump($e);\n}\n\nfunction insertReportData($insights)\n{\n    $insights->setUseImplicitFetch(true);\n    while ($insights->valid()) {\n        var_dump($insights->current());\n        $insights->next();\n    }\n}\n\n```\n\n`var_dump($async_job->read()->getData());`\u3067\u51fa\u529b\u3055\u308c\u308b\u5024\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n```\narray(6) {\n  [\"id\"]=>\n  string(13) \"0000000000000\"\n  [\"account_id\"]=>\n  string(15) \"0000000000\"\n  [\"time_ref\"]=>\n  int(1438232892)\n  [\"async_status\"]=>\n  string(11) \"Job Running\"\n  [\"async_percent_completion\"]=>\n  int(100)\n  [\"is_running\"]=>\n  bool(true)\n}\n```\n\n`$job->read()->isComplete()`\u3067true\u304c\u8fd4\u3063\u3066\u304d\u3066\u3044\u308b\u306e\u306b\u3082\u304b\u304b\u308f\u3089\u305a\u3001async_status\u304c`Job Running`\u3063\u3066\u306a\u3063\u3066\u308b\u306e\u3067\u3001\u305d\u306e\u5f8c\u306b\u5024\u3092\u53d6\u308d\u3046\u3068\u3059\u308b\u3068`Error accessing adreport job.`\u3068\u3044\u3046\u4f8b\u5916\u304c\u6295\u3052\u3089\u308c\u3066\u3057\u307e\u3046\u3068\u3044\u3046(^_^;)\n\nasync_status\u304c`Job Completed`\u3068\u306a\u3063\u3066\u3044\u308b\u3068\u5b9f\u969b\u306b\u5b8c\u4e86\u306b\u306a\u3063\u3066\u3044\u308b\u72b6\u614b\u306a\u306e\u3067\u3001sdk\u5074\u306f\u305d\u3053\u3092\u4f55\u3068\u304b\u3057\u3066\u6b32\u3057\u3044\u306a\u3041\u3002\n\n\u4fee\u6b63\u3057\u3066PR\u6295\u3052\u308b\u3068\u3044\u3044\u3093\u3060\u308d\u3046\u304b\u3002\n\n"}