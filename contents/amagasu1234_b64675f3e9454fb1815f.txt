{"tags": ["CakePHP", "unittest"], "context": "\n\nUnitTest\u4e2d\u6210\u529f\u3057\u305f\u306e\u306b\u3082\u95a2\u308f\u3089\u305a\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u304d\u3066\u5931\u6557\n\u4e00\u90e8\u306e\u30b3\u30fc\u30c9\u3067\u3059\u3002\u6700\u5f8c\u307e\u3067\u554f\u984c\u306a\u304f\u6210\u529f\u3057\u305f\u306e\u306b\u3082\u95a2\u308f\u3089\u305a\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u5931\u6557\u3057\u307e\u3057\u305f\u3002\n\u300cPHPUnit_Framework_Error_Notice : ob_end_clean(): failed to delete buffer. No buffer to delete\u300d\n\u4ee5\u4e0b\u306edownload\u3092\u30c6\u30b9\u30c8\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3057\u305f\u3002\n\ncontroller\n public function download() {\n\n        $this->autoRender = false;\n\n        $id = $this->request->params['pass']['0'];\n\n        $info = $this->XXXX->find('first', ['conditions' => ['id' => $id, 'is_deleted' => 0]]);\n\n        $this->response->header(['Content-type: application/pdf', 'file: \u30d5\u30a1\u30a4\u30eb\u540d']);\n        $this->response->file(\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9);\n\n    }\n\n\n\nunittest\n $this->controller->XXXX= $this->getMockForModel('XXXX', ['find']);\n $this->controller->XXXX->expects($this->once())->method('find')->will($this->returnValue($info));\n\n $this->testAction('/XXXX/download/123', ['method' => 'get']);\n\n\u3000$file =$this->headers['file'];\n $contentType =$this->headers['Content-type'];\n $fileLength =$this->headers['Content-Length'];\n\n $this->assertEqual($file, \u30d5\u30a1\u30a4\u30eb\u540d);\n $this->assertEqual($contentType, 'application/pdf');\n $this->assertEqual($fileLength, 60079);\n\n\n\u540c\u3058\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\u5834\u5408\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30b3\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308c\u3070\u89e3\u6c7a\u3067\u304d\u307e\u3059\u3002\n\nunittest\n $this->controller->XXXX= $this->getMockForModel('XXXX', ['download','find']);\n $this->controller->XXXX->expects($this->once())->method('find')->will($this->returnValue($info));\n $this->testAction('/XXXX/download/123', ['method' => 'get']);\n\n $file =$this->headers['file'];\n $contentType =$this->headers['Content-type'];\n $fileLength =$this->headers['Content-Length'];\n\n $this->assertEqual($file, \u30d5\u30a1\u30a4\u30eb\u540d);\n $this->assertEqual($contentType, 'application/pdf');\n $this->assertEqual($fileLength, 60079);\n\n //\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308c\u3070\u30a8\u30e9\u30fc\u306a\u304f\u6210\u529f\u306b\u306a\u308a\u307e\u3059\u3002\n if (ob_get_length() == 0 ) {\n    ob_start();\n }\n\n\nunit\u30b3\u30fc\u30c9\u304c\u554f\u984c\u306a\u306e\u304bPHPUnit\u306e\u30d0\u30b0\u304b\u306f\u8abf\u3079\u308b\u4e88\u5b9a\u3067\u3059\u3002\u4e00\u5fdc\u5bfe\u7b56\u3060\u3051\u3002\u3002\u3002\n\u8a73\u7d30\u306aApi\u8aac\u660e\u306f\u4ee5\u4e0b\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nhttp://php.net/manual/ja/function.ob-end-clean.php\nhttp://php.net/manual/ja/function.ob-get-length.php\nhttp://php.net/manual/ja/function.ob-start.php\n\u4ee5\u4e0b\u306e\u5185\u5bb9\u3092\u53c2\u8003\u3057\u307e\u3057\u305f\u3002\nhttps://github.com/sebastianbergmann/phpunit/issues/390\n#UnitTest\u4e2d\u6210\u529f\u3057\u305f\u306e\u306b\u3082\u95a2\u308f\u3089\u305a\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u304d\u3066\u5931\u6557\n\n\u4e00\u90e8\u306e\u30b3\u30fc\u30c9\u3067\u3059\u3002\u6700\u5f8c\u307e\u3067\u554f\u984c\u306a\u304f\u6210\u529f\u3057\u305f\u306e\u306b\u3082\u95a2\u308f\u3089\u305a\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u5931\u6557\u3057\u307e\u3057\u305f\u3002\n\u300cPHPUnit_Framework_Error_Notice : ob_end_clean(): failed to delete buffer. No buffer to delete\u300d\n\n\n\n\u4ee5\u4e0b\u306edownload\u3092\u30c6\u30b9\u30c8\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3057\u305f\u3002\n\n```lang:controller\n public function download() {\n\n        $this->autoRender = false;\n\n        $id = $this->request->params['pass']['0'];\n\n        $info = $this->XXXX->find('first', ['conditions' => ['id' => $id, 'is_deleted' => 0]]);\n\n        $this->response->header(['Content-type: application/pdf', 'file: \u30d5\u30a1\u30a4\u30eb\u540d']);\n        $this->response->file(\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9);\n\n    }\n```\n\n```lang:unittest\n $this->controller->XXXX= $this->getMockForModel('XXXX', ['find']);\n $this->controller->XXXX->expects($this->once())->method('find')->will($this->returnValue($info));\n\n $this->testAction('/XXXX/download/123', ['method' => 'get']);\n \n\u3000$file =$this->headers['file'];\n $contentType =$this->headers['Content-type'];\n $fileLength =$this->headers['Content-Length'];\n\n $this->assertEqual($file, \u30d5\u30a1\u30a4\u30eb\u540d);\n $this->assertEqual($contentType, 'application/pdf');\n $this->assertEqual($fileLength, 60079);\n```\n\u540c\u3058\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\u5834\u5408\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30b3\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308c\u3070\u89e3\u6c7a\u3067\u304d\u307e\u3059\u3002\n\n```lang:unittest\n $this->controller->XXXX= $this->getMockForModel('XXXX', ['download','find']);\n $this->controller->XXXX->expects($this->once())->method('find')->will($this->returnValue($info));\n $this->testAction('/XXXX/download/123', ['method' => 'get']);\n \n $file =$this->headers['file'];\n $contentType =$this->headers['Content-type'];\n $fileLength =$this->headers['Content-Length'];\n\n $this->assertEqual($file, \u30d5\u30a1\u30a4\u30eb\u540d);\n $this->assertEqual($contentType, 'application/pdf');\n $this->assertEqual($fileLength, 60079);\n\n //\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308c\u3070\u30a8\u30e9\u30fc\u306a\u304f\u6210\u529f\u306b\u306a\u308a\u307e\u3059\u3002\n if (ob_get_length() == 0 ) {\n    ob_start();\n }\n```\n\nunit\u30b3\u30fc\u30c9\u304c\u554f\u984c\u306a\u306e\u304bPHPUnit\u306e\u30d0\u30b0\u304b\u306f\u8abf\u3079\u308b\u4e88\u5b9a\u3067\u3059\u3002\u4e00\u5fdc\u5bfe\u7b56\u3060\u3051\u3002\u3002\u3002\n\n\u8a73\u7d30\u306aApi\u8aac\u660e\u306f\u4ee5\u4e0b\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nhttp://php.net/manual/ja/function.ob-end-clean.php\nhttp://php.net/manual/ja/function.ob-get-length.php\nhttp://php.net/manual/ja/function.ob-start.php\n\n\n\u4ee5\u4e0b\u306e\u5185\u5bb9\u3092\u53c2\u8003\u3057\u307e\u3057\u305f\u3002\nhttps://github.com/sebastianbergmann/phpunit/issues/390\n"}