{"context": " More than 1 year has passed since last update.\u4e00\u6642\u7684\u306b\u30b9\u30de\u30db\u304b\u3089\u30ef\u30c3\u3068\u304f\u308b\u30a2\u30af\u30bb\u30b9\u3092\u3068\u308a\u3042\u3048\u305a\u30ad\u30e5\u30fc\u306b\u5165\u308c\u3066\u3001\n\u5225\u51e6\u7406\u3067DB\u306b\u7a81\u3063\u8fbc\u3080\u3088\u3046\u306a\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u308a\u305f\u3044\u3002\n\u305d\u3053\u3067aws/aws-sdk-go\u3092\u4f7f\u3063\u3066SQS\u3092\u8a66\u3057\u3066\u307f\u308b\u624b\u9806\u3002\n\nTL;DR\naws-sdk-go\u3092\u4f7f\u3048\u3070Go\u304b\u3089AWS\u306e\u64cd\u4f5c\u306f\u5927\u4f53\u3067\u304d\u308b\u3088\n\n\u57fa\u672c\u6226\u7565\nSQS\u306b\u306f\u6307\u5b9a\u56de\u6570\u53d6\u5f97\u3055\u308c\u305f\u306e\u306b\u6b63\u5e38\u7d42\u4e86\uff08\u524a\u9664\u51e6\u7406\uff09\u3055\u308c\u306a\u304b\u3063\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\n\u5225\u306e\u30ad\u30e5\u30fc(\u4ee5\u4e0b\u30c7\u30c3\u30c9\u30ad\u30e5\u30fc)\u306b\u79fb\u3057\u3066\u304f\u308c\u308b\u6a5f\u80fd\u304c\u3042\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u4f7f\u3046\u3002\n\u3053\u308c\u3092\u4f7f\u3046\u3068\u30a8\u30e9\u30fc\u51e6\u7406\u3092\u3042\u307e\u308a\u304c\u3093\u3070\u3089\u306a\u304f\u3066\u6e08\u3080\u3002\n\u307e\u305f\u30ed\u30f3\u30b0\u30dd\u30fc\u30ea\u30f3\u30b0\u3092\u884c\u3044\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u7a7a\u306e\u5834\u5408\u306f\u63a5\u7d9a\u3057\u305f\u307e\u307e\u4e00\u5b9a\u6642\u9593\u5f85\u3064\u3053\u3068\u3067\u3001\n\u30a2\u30af\u30bb\u30b9\u3092\u6e1b\u3089\u3059\u3088\u3046\u306b\u3059\u308b\u3002\n\u6ce8\u610f\u70b9\u3068\u3057\u3066\u540c\u4e00\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u8907\u6570\u56de\u53d6\u5f97\u3055\u308c\u308b\u5834\u5408\u304c\u3042\u308b\u306e\u3067\u3001\n\u5b9f\u969b\u306e\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u305d\u308c\u3067\u3082\u554f\u984c\u306a\u3044\u3088\u3046\u306b\u5b9f\u88c5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n\u4e8b\u524d\u6e96\u5099\n\naws-sdk-go\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ go get -u github.com/aws/aws-sdk-go/...\n\n\ncredentials\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u306e\u60c5\u5831\u3092\u66f8\u3044\u3066\u4fdd\u5b58\u3057\u3066\u304a\u304f\u3002\n$HOME/.aws/credentials\n[default]\naws_access_key_id = xxxxxxxxxx\naws_secret_access_key = xxxxxxxxxxxxxxxxx\n\n\nSQS\u4f5c\u6210\n\u3053\u3093\u306a\u611f\u3058\u306e\u30b3\u30fc\u30c9\u3067\u30ad\u30e5\u30fc\u3068\u30c7\u30c3\u30c9\u30ad\u30e5\u30fc\u3092\u4f5c\u308c\u308b\u3002\n\u30b3\u30fc\u30c9\u3058\u3083\u306a\u304f\u3066\u3082WEB\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u4f5c\u3063\u3066\u3082\u3044\u3044\u3002\npackage main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/service/sqs\"\n)\n\nvar svc *sqs.SQS\n\nconst (\n    AWS_REGION      = \"ap-northeast-1\"\n    MAIN_QUEUE_NAME = \"main-queue\"\n    DEAD_QUEUE_NAME = \"dead-queue\"\n)\n\n// \u30a8\u30e9\u30fc\u306b\u306a\u3063\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u6e9c\u3081\u8fbc\u3080\u305f\u3081\u306e\u30c7\u30c3\u30c9\u30ad\u30e5\u30fc\u3092\u4f5c\u308b\u3002\nfunc CreateDeadQueue(queuename string) (string, error) {\n    params := &sqs.CreateQueueInput{\n        QueueName: aws.String(queuename),\n    }\n\n    queueurl, err := createQueue(params)\n    if err != nil {\n        return \"\", err\n    }\n\n    return queueurl, nil\n}\n\n// \u30ad\u30e5\u30fc\u3092\u4f5c\u6210\u3059\u308b\u3002\nfunc CreateMainQueue(queuename, deadarn string) (string, error) {\n    // \u4e00\u5b9a\u56de\u6570\u306e\u51e6\u7406\u306b\u5931\u6557\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u30c7\u30c3\u30c9\u30ad\u30e5\u30fc\u306b\u5165\u308c\u308b\u305f\u3081\u306e\u30dd\u30ea\u30b7\u30fc\u3002\n    // \u3053\u3053\u3067\u306f3\u56de\u5931\u6557\u3057\u305f\u3089\u30c7\u30c3\u30c9\u30ad\u30e5\u30fc\u306b\u79fb\u3059\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n    // \u8a2d\u5b9a\u5185\u5bb9\u306fjson\u6587\u5b57\u5217\u3092\u7d44\u307f\u7acb\u3066\u308b\u3002\u308f\u308a\u3068\u539f\u59cb\u7684\u3002\n    redrivePolicy := fmt.Sprintf(\n        \"{\\\"deadLetterTargetArn\\\":\\\"%s\\\",\\\"maxReceiveCount\\\":%d}\",\n        deadarn,\n        3,\n    )\n\n    // \u30ad\u30e5\u30fc\u540d\u3092\u6307\u5b9a\u3057\u3066\u30ad\u30e5\u30fc\u4f5c\u6210\u3002\n    // \u8a2d\u5b9a\u5185\u5bb9\u306fAttributes\u306b\u8db3\u3057\u3066\u3044\u304f\u3002\n    params := &sqs.CreateQueueInput{\n        QueueName: aws.String(queuename),\n        Attributes: map[string]*string{\n            // VisibilityTimeout:\u53d6\u5f97\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u6307\u5b9a\u3057\u305f\u79d2\u6570\u306e\u9593\u3001\u4ed6\u304b\u3089\u898b\u3048\u306a\u304f\u3059\u308b\u3002\n            \"VisibilityTimeout\": aws.String(\"30\"),\n\n            // ReceiveMessageWaitTimeSeconds: \u30ed\u30f3\u30b0\u30dd\u30fc\u30ea\u30f3\u30b0\u306e\u79d2\u6570\u3002\n            // \u30ad\u30e5\u30fc\u304c\u7a7a\u3060\u3063\u305f\u5834\u5408\u3001\u3069\u308c\u3060\u3051\u5f85\u3064\u304b\u3002\n            // \u3053\u3053\u3067\u6307\u5b9a\u3057\u306a\u304f\u3066\u3082\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u53d6\u5f97\u6642\u306b\u6307\u5b9a\u306f\u53ef\u80fd\u3002\n            \"ReceiveMessageWaitTimeSeconds\": aws.String(\"20\"),\n\n            // RedrivePolicy: \u30c7\u30c3\u30c9\u30ad\u30e5\u30fc\u7528\u30dd\u30ea\u30b7\u30fc\u3002\u5148\u306b\u4f5c\u3063\u3066\u304a\u3044\u305f\u5024\u3092\u8a2d\u5b9a\u3002\n            \"RedrivePolicy\": aws.String(redrivePolicy),\n        },\n    }\n\n    queueurl, err := createQueue(params)\n    if err != nil {\n        return \"\", err\n    }\n\n    return queueurl, nil\n}\n\n// \u6307\u5b9a\u30ad\u30e5\u30fc\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\u3002\n// \u30c7\u30c3\u30c9\u30ad\u30e5\u30fc\u6307\u5b9a\u6642\u306bARN\u304c\u5fc5\u8981\u3060\u304c\u3001\u30ad\u30e5\u30fc\u751f\u6210\u6642\u306b\u306fQueueURL\u3057\u304b\u8fd4\u3057\u3066\u304f\u308c\u306a\u3044\u306e\u3067\u3001\n// \u5225\u9014\u53d6\u5f97\u3057\u3066\u3044\u308b\u3002\nfunc GetQueueAttributes(queueurl string) (map[string]*string, error) {\n    params := &sqs.GetQueueAttributesInput{\n        QueueUrl: aws.String(queueurl),\n        AttributeNames: []*string{\n            // \u307b\u3057\u3044\u30d1\u30e9\u30e1\u30fc\u30bf\u540d\u3092\u6307\u5b9a\u3002All\u306b\u3059\u308b\u3068\u5168\u90e8\u53d6\u5f97\u3067\u304d\u308b\u3002\n            aws.String(\"All\"),\n        },\n    }\n    resp, err := svc.GetQueueAttributes(params)\n\n    if err != nil {\n        return nil, err\n    }\n\n    return resp.Attributes, nil\n}\n\n// \u30ad\u30e5\u30fc\u751f\u6210\u7528\u306e\u5171\u901a\u95a2\u6570\nfunc createQueue(params *sqs.CreateQueueInput) (string, error) {\n    resp, err := svc.CreateQueue(params)\n\n    if err != nil {\n        return \"\", err\n    }\n\n    return *resp.QueueUrl, nil\n}\n\nfunc main() {\n    // \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u751f\u6210\n    svc = sqs.New(&aws.Config{Region: aws.String(AWS_REGION)})\n\n    // \u30c7\u30c3\u30c9\u30ad\u30e5\u30fc\u3092\u5148\u306b\u4f5c\u6210\n    deadurl, err := CreateDeadQueue(DEAD_QUEUE_NAME)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // \u30c7\u30c3\u30c9\u30ad\u30e5\u30fc\u306eARN\u3092\u53d6\u5f97\n    attrs, err := GetQueueAttributes(deadurl)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    deadarn := *attrs[\"QueueArn\"]\n\n    // \u30e1\u30a4\u30f3\u51e6\u7406\u7528\u306e\u30ad\u30e5\u30fc\u3092\u4f5c\u6210\n    mainurl, err := CreateMainQueue(MAIN_QUEUE_NAME, deadarn)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Printf(\"Main queue URL:%s\\nDead queue URL:%s\\n\", mainurl, deadurl)\n}\n\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u767b\u9332\npackage main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/service/sqs\"\n)\n\nvar svc *sqs.SQS\n\nconst (\n    AWS_REGION = \"ap-northeast-1\"\n    QUEUE_URL  = \"https://sqs.ap-northeast-1.amazonaws.com/xxxxxxx/main-queue\"\n)\n\n// \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\nfunc SendMessage() error {\n    // \u9001\u4fe1\u5185\u5bb9\u3092\u4f5c\u6210\n    params := &sqs.SendMessageInput{\n        MessageBody:  aws.String(\"HogeFugaPiyo\"),\n        QueueUrl:     aws.String(QUEUE_URL),\n        DelaySeconds: aws.Int64(1),\n    }\n\n    sqsRes, err := svc.SendMessage(params)\n    if err != nil {\n        return err\n    }\n\n    fmt.Println(\"SQSMessageID\", *sqsRes.MessageId)\n\n    return nil\n}\n\nfunc main() {\n    svc = sqs.New(&aws.Config{Region: aws.String(AWS_REGION)})\n    if err := SendMessage(); err != nil {\n        log.Fatal(err)\n    }\n}\n\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u56de\u53ce\npackage main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"sync\"\n\n    \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/service/sqs\"\n)\n\nvar svc *sqs.SQS\n\nconst (\n    AWS_REGION = \"ap-northeast-1\"\n    QUEUE_URL  = \"https://sqs.ap-northeast-1.amazonaws.com/xxxxxxx/main-queue\"\n)\n\nfunc RetrieveMessage() error {\n    params := &sqs.ReceiveMessageInput{\n        QueueUrl: aws.String(QUEUE_URL),\n        // \u4e00\u5ea6\u306b\u53d6\u5f97\u3059\u308b\u6700\u5927\u30e1\u30c3\u30bb\u30fc\u30b8\u6570\u3002\u6700\u5927\u3067\u308210\u307e\u3067\u3002\n        MaxNumberOfMessages: aws.Int64(10),\n        // \u3053\u308c\u3067\u30ad\u30e5\u30fc\u304c\u7a7a\u306e\u5834\u5408\u306f\u30ed\u30f3\u30b0\u30dd\u30fc\u30ea\u30f3\u30b0(20\u79d2\u9593\u7e4b\u304e\u3063\u3071\u306a\u3057)\u306b\u306a\u308b\u3002\n        WaitTimeSeconds: aws.Int64(20),\n    }\n    resp, err := svc.ReceiveMessage(params)\n\n    if err != nil {\n        return err\n    }\n\n    fmt.Printf(\"messages count: %d\\n\", len(resp.Messages))\n\n    if len(resp.Messages) == 0 {\n        fmt.Println(\"empty queue.\")\n        return nil\n    }\n\n    // \u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u6570\u3060\u3051goroutine\u3092\u5b9f\u884c\u3057\u3066\u307f\u308b\u3002\n    var wg sync.WaitGroup\n    for _, m := range resp.Messages {\n        wg.Add(1)\n        go func(msg *sqs.Message) {\n            defer wg.Done()\n            fmt.Println(msg.Body)\n            if err := DeleteMessage(msg); err != nil {\n                fmt.Println(err)\n            }\n        }(m)\n    }\n\n    wg.Wait()\n\n    return nil\n}\n\n// \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u524a\u9664\u3059\u308b\u3002\nfunc DeleteMessage(msg *sqs.Message) error {\n    params := &sqs.DeleteMessageInput{\n        QueueUrl:      aws.String(QUEUE_URL),\n        ReceiptHandle: aws.String(*msg.ReceiptHandle),\n    }\n    _, err := svc.DeleteMessage(params)\n\n    if err != nil {\n        return err\n    }\n    return nil\n}\n\nfunc main() {\n    svc = sqs.New(&aws.Config{Region: aws.String(AWS_REGION)})\n\n    // \u6b62\u3081\u308b\u307e\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u56de\u53ce\u3057\u3064\u3065\u3051\u308b\u3002\n    for {\n        if err := RetrieveMessage(); err != nil {\n            log.Fatal(err)\n        }\n    }\n}\n\n\naws-sdk-go\u306e\u611f\u60f3\n\u524d\u306bRuby\u306eSDK\u3092\u4f7f\u3063\u3066AWS\u3092\u64cd\u4f5c\u3057\u305f\u7d4c\u9a13\u304c\u3042\u308a\u3001\u305d\u306e\u3068\u304d\u306f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u898b\u3066\u3082\u3069\u3046\u4f7f\u3048\u3070\u3044\u3044\u306e\u304b\u5206\u304b\u3089\u305a\u82e6\u52b4\u3057\u305f\u899a\u3048\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001Go\u7248\u306fexamples\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u306e\u3068\u3001\u9759\u7684\u8a00\u8a9e\u3060\u3051\u3042\u3063\u3066\u30e9\u30a4\u30d6\u30e9\u30ea\u5074\u306e\u30b3\u30fc\u30c9\u306b\u3059\u3050\u30b8\u30e3\u30f3\u30d7\u3067\u304d\u308b\u3053\u3068\u3082\u3042\u308a\u3001\u4f7f\u7528\u3059\u308b\u306e\u306f\u3068\u3066\u3082\u697d\u3067\u3057\u305f\u3002\n\u4e00\u65b9\u3067\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u8a2d\u5b9a\u306a\u3069\u306f\u5358\u306a\u308b\u6587\u5b57\u5217\u3067\u306e\u6307\u5b9a\u3067\u3042\u3063\u305f\u308a\u3057\u3066\u3001API\u306e\u8584\u3044\u30e9\u30c3\u30d1\u30fc\u611f\u304c\u5f37\u3044\u3067\u3059\u3002\n\u3067\u3082\u3053\u308c\u3050\u3089\u3044\u306e\u65b9\u304cAPI\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304b\u3089\u306e\u985e\u63a8\u3082\u52b9\u304f\u306e\u3067\u3001\u5145\u5206\u306a\u3088\u3046\u306b\u601d\u3044\u307e\u3059\u3002\n\n\u4e00\u6642\u7684\u306b\u30b9\u30de\u30db\u304b\u3089\u30ef\u30c3\u3068\u304f\u308b\u30a2\u30af\u30bb\u30b9\u3092\u3068\u308a\u3042\u3048\u305a\u30ad\u30e5\u30fc\u306b\u5165\u308c\u3066\u3001\n\u5225\u51e6\u7406\u3067DB\u306b\u7a81\u3063\u8fbc\u3080\u3088\u3046\u306a\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u308a\u305f\u3044\u3002\n\n\u305d\u3053\u3067[aws/aws-sdk-go](https://github.com/aws/aws-sdk-go)\u3092\u4f7f\u3063\u3066SQS\u3092\u8a66\u3057\u3066\u307f\u308b\u624b\u9806\u3002\n\nTL;DR\n========================\n\naws-sdk-go\u3092\u4f7f\u3048\u3070Go\u304b\u3089AWS\u306e\u64cd\u4f5c\u306f\u5927\u4f53\u3067\u304d\u308b\u3088\n\n\u57fa\u672c\u6226\u7565\n========================\n\nSQS\u306b\u306f\u6307\u5b9a\u56de\u6570\u53d6\u5f97\u3055\u308c\u305f\u306e\u306b\u6b63\u5e38\u7d42\u4e86\uff08\u524a\u9664\u51e6\u7406\uff09\u3055\u308c\u306a\u304b\u3063\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\n\u5225\u306e\u30ad\u30e5\u30fc(\u4ee5\u4e0b\u30c7\u30c3\u30c9\u30ad\u30e5\u30fc)\u306b\u79fb\u3057\u3066\u304f\u308c\u308b\u6a5f\u80fd\u304c\u3042\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u4f7f\u3046\u3002\n\u3053\u308c\u3092\u4f7f\u3046\u3068\u30a8\u30e9\u30fc\u51e6\u7406\u3092\u3042\u307e\u308a\u304c\u3093\u3070\u3089\u306a\u304f\u3066\u6e08\u3080\u3002\n\n\u307e\u305f\u30ed\u30f3\u30b0\u30dd\u30fc\u30ea\u30f3\u30b0\u3092\u884c\u3044\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u7a7a\u306e\u5834\u5408\u306f\u63a5\u7d9a\u3057\u305f\u307e\u307e\u4e00\u5b9a\u6642\u9593\u5f85\u3064\u3053\u3068\u3067\u3001\n\u30a2\u30af\u30bb\u30b9\u3092\u6e1b\u3089\u3059\u3088\u3046\u306b\u3059\u308b\u3002\n\n\u6ce8\u610f\u70b9\u3068\u3057\u3066\u540c\u4e00\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u8907\u6570\u56de\u53d6\u5f97\u3055\u308c\u308b\u5834\u5408\u304c\u3042\u308b\u306e\u3067\u3001\n\u5b9f\u969b\u306e\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u305d\u308c\u3067\u3082\u554f\u984c\u306a\u3044\u3088\u3046\u306b\u5b9f\u88c5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n\u4e8b\u524d\u6e96\u5099\n========================\n\n## aws-sdk-go\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n$ go get -u github.com/aws/aws-sdk-go/...\n```\n\n## credentials\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\n\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u306e\u60c5\u5831\u3092\u66f8\u3044\u3066\u4fdd\u5b58\u3057\u3066\u304a\u304f\u3002\n\n$HOME/.aws/credentials\n\n```\n[default]\naws_access_key_id = xxxxxxxxxx\naws_secret_access_key = xxxxxxxxxxxxxxxxx\n```\n\nSQS\u4f5c\u6210\n========================\n\n\u3053\u3093\u306a\u611f\u3058\u306e\u30b3\u30fc\u30c9\u3067\u30ad\u30e5\u30fc\u3068\u30c7\u30c3\u30c9\u30ad\u30e5\u30fc\u3092\u4f5c\u308c\u308b\u3002\n\u30b3\u30fc\u30c9\u3058\u3083\u306a\u304f\u3066\u3082WEB\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u4f5c\u3063\u3066\u3082\u3044\u3044\u3002\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"log\"\n\n\t\"github.com/aws/aws-sdk-go/aws\"\n\t\"github.com/aws/aws-sdk-go/service/sqs\"\n)\n\nvar svc *sqs.SQS\n\nconst (\n\tAWS_REGION      = \"ap-northeast-1\"\n\tMAIN_QUEUE_NAME = \"main-queue\"\n\tDEAD_QUEUE_NAME = \"dead-queue\"\n)\n\n// \u30a8\u30e9\u30fc\u306b\u306a\u3063\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u6e9c\u3081\u8fbc\u3080\u305f\u3081\u306e\u30c7\u30c3\u30c9\u30ad\u30e5\u30fc\u3092\u4f5c\u308b\u3002\nfunc CreateDeadQueue(queuename string) (string, error) {\n\tparams := &sqs.CreateQueueInput{\n\t\tQueueName: aws.String(queuename),\n\t}\n\n\tqueueurl, err := createQueue(params)\n\tif err != nil {\n\t\treturn \"\", err\n\t}\n\n\treturn queueurl, nil\n}\n\n// \u30ad\u30e5\u30fc\u3092\u4f5c\u6210\u3059\u308b\u3002\nfunc CreateMainQueue(queuename, deadarn string) (string, error) {\n\t// \u4e00\u5b9a\u56de\u6570\u306e\u51e6\u7406\u306b\u5931\u6557\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u30c7\u30c3\u30c9\u30ad\u30e5\u30fc\u306b\u5165\u308c\u308b\u305f\u3081\u306e\u30dd\u30ea\u30b7\u30fc\u3002\n\t// \u3053\u3053\u3067\u306f3\u56de\u5931\u6557\u3057\u305f\u3089\u30c7\u30c3\u30c9\u30ad\u30e5\u30fc\u306b\u79fb\u3059\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n\t// \u8a2d\u5b9a\u5185\u5bb9\u306fjson\u6587\u5b57\u5217\u3092\u7d44\u307f\u7acb\u3066\u308b\u3002\u308f\u308a\u3068\u539f\u59cb\u7684\u3002\n\tredrivePolicy := fmt.Sprintf(\n\t\t\"{\\\"deadLetterTargetArn\\\":\\\"%s\\\",\\\"maxReceiveCount\\\":%d}\",\n\t\tdeadarn,\n\t\t3,\n\t)\n\n\t// \u30ad\u30e5\u30fc\u540d\u3092\u6307\u5b9a\u3057\u3066\u30ad\u30e5\u30fc\u4f5c\u6210\u3002\n\t// \u8a2d\u5b9a\u5185\u5bb9\u306fAttributes\u306b\u8db3\u3057\u3066\u3044\u304f\u3002\n\tparams := &sqs.CreateQueueInput{\n\t\tQueueName: aws.String(queuename),\n\t\tAttributes: map[string]*string{\n\t\t\t// VisibilityTimeout:\u53d6\u5f97\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u6307\u5b9a\u3057\u305f\u79d2\u6570\u306e\u9593\u3001\u4ed6\u304b\u3089\u898b\u3048\u306a\u304f\u3059\u308b\u3002\n\t\t\t\"VisibilityTimeout\": aws.String(\"30\"),\n\n\t\t\t// ReceiveMessageWaitTimeSeconds: \u30ed\u30f3\u30b0\u30dd\u30fc\u30ea\u30f3\u30b0\u306e\u79d2\u6570\u3002\n\t\t\t// \u30ad\u30e5\u30fc\u304c\u7a7a\u3060\u3063\u305f\u5834\u5408\u3001\u3069\u308c\u3060\u3051\u5f85\u3064\u304b\u3002\n\t\t\t// \u3053\u3053\u3067\u6307\u5b9a\u3057\u306a\u304f\u3066\u3082\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u53d6\u5f97\u6642\u306b\u6307\u5b9a\u306f\u53ef\u80fd\u3002\n\t\t\t\"ReceiveMessageWaitTimeSeconds\": aws.String(\"20\"),\n\n\t\t\t// RedrivePolicy: \u30c7\u30c3\u30c9\u30ad\u30e5\u30fc\u7528\u30dd\u30ea\u30b7\u30fc\u3002\u5148\u306b\u4f5c\u3063\u3066\u304a\u3044\u305f\u5024\u3092\u8a2d\u5b9a\u3002\n\t\t\t\"RedrivePolicy\": aws.String(redrivePolicy),\n\t\t},\n\t}\n\n\tqueueurl, err := createQueue(params)\n\tif err != nil {\n\t\treturn \"\", err\n\t}\n\n\treturn queueurl, nil\n}\n\n// \u6307\u5b9a\u30ad\u30e5\u30fc\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\u3002\n// \u30c7\u30c3\u30c9\u30ad\u30e5\u30fc\u6307\u5b9a\u6642\u306bARN\u304c\u5fc5\u8981\u3060\u304c\u3001\u30ad\u30e5\u30fc\u751f\u6210\u6642\u306b\u306fQueueURL\u3057\u304b\u8fd4\u3057\u3066\u304f\u308c\u306a\u3044\u306e\u3067\u3001\n// \u5225\u9014\u53d6\u5f97\u3057\u3066\u3044\u308b\u3002\nfunc GetQueueAttributes(queueurl string) (map[string]*string, error) {\n\tparams := &sqs.GetQueueAttributesInput{\n\t\tQueueUrl: aws.String(queueurl),\n\t\tAttributeNames: []*string{\n\t\t\t// \u307b\u3057\u3044\u30d1\u30e9\u30e1\u30fc\u30bf\u540d\u3092\u6307\u5b9a\u3002All\u306b\u3059\u308b\u3068\u5168\u90e8\u53d6\u5f97\u3067\u304d\u308b\u3002\n\t\t\taws.String(\"All\"),\n\t\t},\n\t}\n\tresp, err := svc.GetQueueAttributes(params)\n\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\treturn resp.Attributes, nil\n}\n\n// \u30ad\u30e5\u30fc\u751f\u6210\u7528\u306e\u5171\u901a\u95a2\u6570\nfunc createQueue(params *sqs.CreateQueueInput) (string, error) {\n\tresp, err := svc.CreateQueue(params)\n\n\tif err != nil {\n\t\treturn \"\", err\n\t}\n\n\treturn *resp.QueueUrl, nil\n}\n\nfunc main() {\n\t// \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u751f\u6210\n\tsvc = sqs.New(&aws.Config{Region: aws.String(AWS_REGION)})\n\n\t// \u30c7\u30c3\u30c9\u30ad\u30e5\u30fc\u3092\u5148\u306b\u4f5c\u6210\n\tdeadurl, err := CreateDeadQueue(DEAD_QUEUE_NAME)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\n\t// \u30c7\u30c3\u30c9\u30ad\u30e5\u30fc\u306eARN\u3092\u53d6\u5f97\n\tattrs, err := GetQueueAttributes(deadurl)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\n\tdeadarn := *attrs[\"QueueArn\"]\n\n\t// \u30e1\u30a4\u30f3\u51e6\u7406\u7528\u306e\u30ad\u30e5\u30fc\u3092\u4f5c\u6210\n\tmainurl, err := CreateMainQueue(MAIN_QUEUE_NAME, deadarn)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\n\tfmt.Printf(\"Main queue URL:%s\\nDead queue URL:%s\\n\", mainurl, deadurl)\n}\n```\n\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u767b\u9332\n========================\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"log\"\n\n\t\"github.com/aws/aws-sdk-go/aws\"\n\t\"github.com/aws/aws-sdk-go/service/sqs\"\n)\n\nvar svc *sqs.SQS\n\nconst (\n\tAWS_REGION = \"ap-northeast-1\"\n\tQUEUE_URL  = \"https://sqs.ap-northeast-1.amazonaws.com/xxxxxxx/main-queue\"\n)\n\n// \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\nfunc SendMessage() error {\n\t// \u9001\u4fe1\u5185\u5bb9\u3092\u4f5c\u6210\n\tparams := &sqs.SendMessageInput{\n\t\tMessageBody:  aws.String(\"HogeFugaPiyo\"),\n\t\tQueueUrl:     aws.String(QUEUE_URL),\n\t\tDelaySeconds: aws.Int64(1),\n\t}\n\n\tsqsRes, err := svc.SendMessage(params)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tfmt.Println(\"SQSMessageID\", *sqsRes.MessageId)\n\n\treturn nil\n}\n\nfunc main() {\n\tsvc = sqs.New(&aws.Config{Region: aws.String(AWS_REGION)})\n\tif err := SendMessage(); err != nil {\n\t\tlog.Fatal(err)\n\t}\n}\n```\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u56de\u53ce\n========================\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"log\"\n\t\"sync\"\n\n\t\"github.com/aws/aws-sdk-go/aws\"\n\t\"github.com/aws/aws-sdk-go/service/sqs\"\n)\n\nvar svc *sqs.SQS\n\nconst (\n\tAWS_REGION = \"ap-northeast-1\"\n\tQUEUE_URL  = \"https://sqs.ap-northeast-1.amazonaws.com/xxxxxxx/main-queue\"\n)\n\nfunc RetrieveMessage() error {\n\tparams := &sqs.ReceiveMessageInput{\n\t\tQueueUrl: aws.String(QUEUE_URL),\n\t\t// \u4e00\u5ea6\u306b\u53d6\u5f97\u3059\u308b\u6700\u5927\u30e1\u30c3\u30bb\u30fc\u30b8\u6570\u3002\u6700\u5927\u3067\u308210\u307e\u3067\u3002\n\t\tMaxNumberOfMessages: aws.Int64(10),\n\t\t// \u3053\u308c\u3067\u30ad\u30e5\u30fc\u304c\u7a7a\u306e\u5834\u5408\u306f\u30ed\u30f3\u30b0\u30dd\u30fc\u30ea\u30f3\u30b0(20\u79d2\u9593\u7e4b\u304e\u3063\u3071\u306a\u3057)\u306b\u306a\u308b\u3002\n\t\tWaitTimeSeconds: aws.Int64(20),\n\t}\n\tresp, err := svc.ReceiveMessage(params)\n\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tfmt.Printf(\"messages count: %d\\n\", len(resp.Messages))\n\n\tif len(resp.Messages) == 0 {\n\t\tfmt.Println(\"empty queue.\")\n\t\treturn nil\n\t}\n\n\t// \u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u6570\u3060\u3051goroutine\u3092\u5b9f\u884c\u3057\u3066\u307f\u308b\u3002\n\tvar wg sync.WaitGroup\n\tfor _, m := range resp.Messages {\n\t\twg.Add(1)\n\t\tgo func(msg *sqs.Message) {\n\t\t\tdefer wg.Done()\n\t\t\tfmt.Println(msg.Body)\n\t\t\tif err := DeleteMessage(msg); err != nil {\n\t\t\t\tfmt.Println(err)\n\t\t\t}\n\t\t}(m)\n\t}\n\n\twg.Wait()\n\n\treturn nil\n}\n\n// \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u524a\u9664\u3059\u308b\u3002\nfunc DeleteMessage(msg *sqs.Message) error {\n\tparams := &sqs.DeleteMessageInput{\n\t\tQueueUrl:      aws.String(QUEUE_URL),\n\t\tReceiptHandle: aws.String(*msg.ReceiptHandle),\n\t}\n\t_, err := svc.DeleteMessage(params)\n\n\tif err != nil {\n\t\treturn err\n\t}\n\treturn nil\n}\n\nfunc main() {\n\tsvc = sqs.New(&aws.Config{Region: aws.String(AWS_REGION)})\n\n\t// \u6b62\u3081\u308b\u307e\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u56de\u53ce\u3057\u3064\u3065\u3051\u308b\u3002\n\tfor {\n\t\tif err := RetrieveMessage(); err != nil {\n\t\t\tlog.Fatal(err)\n\t\t}\n\t}\n}\n```\n\naws-sdk-go\u306e\u611f\u60f3\n========================\n\u524d\u306bRuby\u306eSDK\u3092\u4f7f\u3063\u3066AWS\u3092\u64cd\u4f5c\u3057\u305f\u7d4c\u9a13\u304c\u3042\u308a\u3001\u305d\u306e\u3068\u304d\u306f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u898b\u3066\u3082\u3069\u3046\u4f7f\u3048\u3070\u3044\u3044\u306e\u304b\u5206\u304b\u3089\u305a\u82e6\u52b4\u3057\u305f\u899a\u3048\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001Go\u7248\u306f[examples](https://github.com/aws/aws-sdk-go/blob/master/service/sqs/examples_test.go)\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u306e\u3068\u3001\u9759\u7684\u8a00\u8a9e\u3060\u3051\u3042\u3063\u3066\u30e9\u30a4\u30d6\u30e9\u30ea\u5074\u306e\u30b3\u30fc\u30c9\u306b\u3059\u3050\u30b8\u30e3\u30f3\u30d7\u3067\u304d\u308b\u3053\u3068\u3082\u3042\u308a\u3001\u4f7f\u7528\u3059\u308b\u306e\u306f\u3068\u3066\u3082\u697d\u3067\u3057\u305f\u3002\n\n\u4e00\u65b9\u3067\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u8a2d\u5b9a\u306a\u3069\u306f\u5358\u306a\u308b\u6587\u5b57\u5217\u3067\u306e\u6307\u5b9a\u3067\u3042\u3063\u305f\u308a\u3057\u3066\u3001API\u306e\u8584\u3044\u30e9\u30c3\u30d1\u30fc\u611f\u304c\u5f37\u3044\u3067\u3059\u3002\n\u3067\u3082\u3053\u308c\u3050\u3089\u3044\u306e\u65b9\u304cAPI\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304b\u3089\u306e\u985e\u63a8\u3082\u52b9\u304f\u306e\u3067\u3001\u5145\u5206\u306a\u3088\u3046\u306b\u601d\u3044\u307e\u3059\u3002\n", "tags": ["Go", "golang", "AWS", "sqs"]}