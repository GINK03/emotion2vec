{"context": "\u2193\u306e\u7d9a\u304d\u3067\u3059\u3002\nhttp://qiita.com/RyoTa63292153/items/ec0eaf0bd0a5820c4be6\n\n\n\u4f9d\u5b58\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8ffd\u52a0\nbuild.gradle\u306edependencies\u306bcompile 'org.mybatis:mybatis:3.4.2'\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\nsrc/main/resources/mybatis-config.xml\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nGlassFish\u306b\u767b\u9332\u3057\u305fJDBC\u30ea\u30bd\u30fc\u30b9\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u3001dataSource\u306etype\u3092JNDI\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\nproperty\u306edata_source\u306e\u5024\u306f\u3001glassfish-resources.xml\u3067\u8a2d\u5b9a\u3057\u3066\u3044\u308bjndi-name\u3067\u3059\u3002\ntransactionManager\u306etype\u3092MANAGED\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\nmybatis-config.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE configuration PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-config.dtd\">\n<configuration>\n    <!--\n    Glassfish\u306b\u767b\u9332\u3057\u305fJNDI\u30ea\u30bd\u30fc\u30b9\u3092\u5229\u7528\u3059\u308b\n    data_source\u306e\u6307\u5b9a\u304c\u5fc5\u9808\n    -->\n    <environments default=\"apple\">\n        <!-- apple -->\n        <environment id=\"apple\">\n            <transactionManager type=\"MANAGED\">\n                <property name=\"closeConnection\" value=\"false\"/>\n            </transactionManager>\n            <dataSource type=\"JNDI\">\n                <property name=\"data_source\" value=\"jdbc/apple_data_source\"/>\n            </dataSource>\n        </environment>\n        <!-- pineapple -->\n        <environment id=\"pineapple\">\n            <transactionManager type=\"MANAGED\">\n                <property name=\"closeConnection\" value=\"false\"/>\n            </transactionManager>\n            <dataSource type=\"JNDI\">\n                <property name=\"data_source\" value=\"jdbc/pineapple_data_source\"/>\n            </dataSource>\n        </environment>\n    </environments>\n    <!-- Mapper\u306e\u767b\u9332\u304c\u5fc5\u9808 -->\n    <mappers>\n        <mapper class=\"sample.payara.mybatis.mapper.AppleMyBatisMapper\"/>\n        <mapper class=\"sample.payara.mybatis.mapper.AppleMyBatisXmlMapper\"/>\n        <mapper class=\"sample.payara.mybatis.mapper.PineappleMyBatisMapper\"/>\n    </mappers>\n</configuration>\n\n\n\n\nSqlSession\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u306eBean\u3092\u4f5c\u6210\nSqlSession\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u3001SQL\u3092\u5b9f\u884c\u3059\u308b\u5ea6\u306bSqlSessionFactory#openSession\u3057\u3066\u53d6\u5f97\u3057\u306a\u3044\u3088\u3046\u306b\u3057\u307e\u3059\u3002\nSqlSession\u3092\u5229\u7528\u3059\u308b\u30af\u30e9\u30b9\u3067\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n@Inject\nprivate SqlSession sqlSession;\n\n\nsample.payara.mybatis.provider.MyBatisSqlSessionProvidor\n@Stateless\npublic class MyBatisSqlSessionProvidor {\n    /*\n     * SqlSessionFactory\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092CDI\u7d4c\u7531\u3067\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u3059\u308b\n     * \u4e0b\u8a18\u3067\u5ba3\u8a00\u3057\u3066\u3044\u308b`appleSessionFactory`\u3068`pineappleSessionFactory`\u304cCDI\u306b\u767b\u9332\u3059\u308b\u30e1\u30bd\u30c3\u30c9\n     */\n    @AppleDataSource\n    @Inject\n    private SqlSessionFactory appleSessionFactory;\n\n    @PineappleDataSource\n    @Inject\n    private SqlSessionFactory pineappleSessionFactory;\n\n    private SqlSessionFactory create(String environment) {\n        try (InputStream stream = Resources.getResourceAsStream(\"mybatis-config.xml\")) {\n            SqlSessionFactoryBuilder builder = new SqlSessionFactoryBuilder();\n            return builder.build(stream, environment);\n        } catch (IOException e) {\n            throw new UncheckedIOException(e);\n        }\n    }\n\n    /*\n     * SqlSessionFactory\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092CDI\u306b\u767b\u9332\n     * DataSource\u3092\u8907\u6570\u5229\u7528\u3057\u3066\u3044\u308b\u305f\u3081\u3001`@AppleDataSource`\u3068`@PineappleDataSource`\u3068\u3044\u3046annotation\u3067\u8b58\u5225\u3057\u3066\u3044\u308b\n     * `SqlSessionFactory`\u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u9593\u306f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u7834\u68c4\u3057\u306a\u3044\u305f\u3081\u306b`@ApplicationScoped`\u3092\u6307\u5b9a\u3059\u308b\n     */\n    @ApplicationScoped\n    @AppleDataSource\n    @Produces\n    public SqlSessionFactory appleSessionFactory() {\n        return this.create(\"apple\");\n    }\n\n    @ApplicationScoped\n    @PineappleDataSource\n    @Produces\n    public SqlSessionFactory pineappleSessionFactory() {\n        return this.create(\"pineapple\");\n    }\n\n    /*\n     * `SqlSession`\u3092\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u3059\u308b\u305f\u3081\u306e\u30e1\u30bd\u30c3\u30c9\n     * Request\u6bce\u306bopen/close\u3059\u308b\u305f\u3081`@RequestScoped`\u3092\u6307\u5b9a\n     * `@Produces`\u3067CDI\u7d4c\u7531\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\n     */\n    @RequestScoped\n    @AppleDataSource\n    @Produces\n    public SqlSession appleSession() {\n        return appleSessionFactory.openSession();\n    }\n\n    @RequestScoped\n    @PineappleDataSource\n    @Produces\n    public SqlSession pineappleSession() {\n        return pineappleSessionFactory.openSession();\n    }\n\n    /*\n     * Request\u304c\u5b8c\u4e86\u3057\u305f\u3068\u304d\u306b`SqlSession`\u3092close\u3059\u308b\n     */\n    public void closeAppleSession(@Disposes @AppleDataSource SqlSession sqlSession) {\n        sqlSession.close();\n    }\n\n    public void closePineappleSession(@Disposes @PineappleDataSource SqlSession sqlSession) {\n        sqlSession.close();\n    }\n}\n\n\n\n\nMapper\u3092\u4f5c\u6210\nJavaAPI\u3092\u5229\u7528\u3057\u305fMapper\n\nsample.payara.mybatis.mapper.AppleMyBatisMapper\npublic interface AppleMyBatisMapper {\n\n    /* SQL\u5b9f\u884c\u7d50\u679c\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3059\u308b\u305f\u3081\u306e\u8a2d\u5b9a */\n    @Results(id = \"findAllMybatisUser\", value = {\n            @Result(property = \"id\", column = \"id\", id = true),\n            @Result(property = \"name\", column = \"name\"),\n            @Result(property = \"created\", column = \"created\"),\n            @Result(property = \"updated\", column = \"updated\"),\n    })\n    /* select\u6587 */\n    @Select({\n        \"select *\",\n        \"from sample_model\",\n    })\n    public List<MyBatisUser> findAll();\n\n    @Results(id = \"findByMybatisUser\", value = {\n            @Result(property = \"id\", column = \"id\", id = true),\n            @Result(property = \"name\", column = \"name\"),\n            @Result(property = \"created\", column = \"created\"),\n            @Result(property = \"updated\", column = \"updated\"),\n    })\n    @Select({\n        \"select *\",\n        \"from sample_model s\",\n        \"where s.id = #{id}\"\n    })\n    public MyBatisUser findById(@Param(\"id\") Long id);\n\n    /* SQL\u6587\u3092\u52d5\u7684\u306b\u7d44\u307f\u7acb\u3066\u308b */\n    @SelectProvider(type = MyBatisMapperSqlBuilder.class, method = \"findByParamSql\")\n    public List<MyBatisUser> findByParam(@Param(\"param\") MyBatisUserSearchParam param);\n}\n\n\n\nsample.payara.mybatis.mapper.MyBatisMapperSqlBuilder\npublic class MyBatisMapperSqlBuilder {\n    /*\n     * SQL\u6587\u306e`#{param.xxx}`\u306e\u90e8\u5206\u306f\u3001\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u306e`@Param(\"param\")`\u3092\u53c2\u7167\u3057\u3066\u3044\u308b\n     * `AppleMyBatisMapper#findByParam`\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b`param`\u3067\u306f\u7121\u3044\n     */\n    public String findByParamSql(@Param(\"param\") final MyBatisUserSearchParam param) {\n        SQL sql = new SQL()\n                .SELECT(\"*\")\n                .FROM(\"sample_model s\");\n\n        if (param.hasId()) {\n            sql.WHERE(\"s.id = #{param.id}\");\n        }\n\n        if (param.hasName()) {\n            sql.WHERE(\"s.name like #{param.name} \");\n        }\n\n        return sql.toString();\n    }\n\n}\n\n\nXML\u3092\u5229\u7528\u3057\u305fMapper\n\nsample.payara.mybatis.mapper.AppleMyBatisXmlMapper\npublic interface AppleMyBatisXmlMapper {\n\n    public MyBatisUser findById(@Param(\"id\") final Long id);\n\n    public List<MyBatisUser> findByParam(@Param(\"param\") final MyBatisUserSearchParam param);\n\n}\n\n\n\nsrc/main/java/sample/payara/mybatis/mapper/AppleMyBatisXmlMapper.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n<mapper namespace=\"sample.payara.mybatis.mapper.AppleMyBatisXmlMapper\">\n    <resultMap type=\"sample.payara.model.MyBatisUser\" id=\"MyBatisUser\">\n        <id column=\"id\" property=\"id\"/>\n        <result column=\"name\" property=\"name\"/>\n        <result column=\"created\" property=\"created\"/>\n        <result column=\"updated\" property=\"updated\"/>\n    </resultMap>\n    <select id=\"findById\" resultMap=\"MyBatisUser\">\n        SELECT *\n          FROM sample_model s\n        <where>\n            AND s.id = #{id}\n        </where>\n    </select>\n    <select id=\"findByParam\" resultMap=\"MyBatisUser\">\n        SELECT *\n          FROM sample_model s\n        <where>\n            <if test=\"param.hasId()\">\n                AND s.id = #{param.id}\n            </if>\n            <if test=\"param.hasName()\">\n                <bind name=\"pattern\" value=\"param.name + '%'\"/>\n                AND s.name LIKE #{pattern}\n            </if>\n        </where>\n    </select>\n</mapper>\n\n\n\n\nMapper\u3092\u547c\u3073\u51fa\u3059\nSqlSession\u304b\u3089Mapper\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53d6\u5f97\u3057\u3066\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002\n\nsample.payara.mybatis.repotiroy.AppleMyBatisRepository\n@Stateless\npublic class AppleMyBatisRepository {\n    @AppleDataSource\n    @Inject\n    private SqlSession sqlSession;\n\n    /*\n     * `sqlSession.getMapper`\u3067Mapper\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53d6\u5f97\u3067\u304d\u308b\n     */\n    private AppleMyBatisMapper mapper() {\n        return sqlSession.getMapper(AppleMyBatisMapper.class);\n    }\n\n    private AppleMyBatisXmlMapper xmlMapper() {\n        return sqlSession.getMapper(AppleMyBatisXmlMapper.class);\n    }\n\n    public List<MyBatisUser> findAll() {\n        return mapper().findAll();\n    }\n\n    public MyBatisUser findBy(final Long id) {\n        return mapper().findById(id);\n    }\n\n    public List<MyBatisUser> findBy(final MyBatisUserSearchParam param) {\n        return mapper().findByParam(param);\n    }\n\n    public List<MyBatisUser> findByXmlMapper(final MyBatisUserSearchParam param) {\n        return xmlMapper().findByParam(param);\n    }\n}\n\n\n\n\n\u53c2\u8003\n\u53c2\u8003\u306b\u3057\u307e\u3057\u305f m(__)m\nhttp://n-agetsuma.hatenablog.com/entry/2013/01/13/151303\nhttp://qiita.com/opengl-8080/items/431de9175dca33a09ba8\nhttp://www.mybatis.org/mybatis-3/ja/index.html\n\u30bd\u30fc\u30b9\u306f\u2193\u306b\u3042\u308a\u307e\u3059\u3001\u53c2\u8003\u306b\u306a\u308c\u3070\u5e78\u3044\u3067\u3059\nhttps://github.com/yamashiro0110/JavaEE/tree/master/Payara\n\u2193\u306e\u7d9a\u304d\u3067\u3059\u3002\nhttp://qiita.com/RyoTa63292153/items/ec0eaf0bd0a5820c4be6\n\n*****\n### \u4f9d\u5b58\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8ffd\u52a0\n\n`build.gradle`\u306e`dependencies`\u306b`compile 'org.mybatis:mybatis:3.4.2'`\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n*****\n### \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\n\n`src/main/resources/mybatis-config.xml`\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nGlassFish\u306b\u767b\u9332\u3057\u305fJDBC\u30ea\u30bd\u30fc\u30b9\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u3001`dataSource`\u306e`type`\u3092`JNDI`\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n`property`\u306e`data_source`\u306e\u5024\u306f\u3001`glassfish-resources.xml`\u3067\u8a2d\u5b9a\u3057\u3066\u3044\u308b`jndi-name`\u3067\u3059\u3002\n\n`transactionManager`\u306e`type`\u3092`MANAGED`\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```xml:mybatis-config.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE configuration PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-config.dtd\">\n<configuration>\n    <!--\n    Glassfish\u306b\u767b\u9332\u3057\u305fJNDI\u30ea\u30bd\u30fc\u30b9\u3092\u5229\u7528\u3059\u308b\n    data_source\u306e\u6307\u5b9a\u304c\u5fc5\u9808\n    -->\n    <environments default=\"apple\">\n        <!-- apple -->\n        <environment id=\"apple\">\n            <transactionManager type=\"MANAGED\">\n                <property name=\"closeConnection\" value=\"false\"/>\n            </transactionManager>\n            <dataSource type=\"JNDI\">\n                <property name=\"data_source\" value=\"jdbc/apple_data_source\"/>\n            </dataSource>\n        </environment>\n        <!-- pineapple -->\n        <environment id=\"pineapple\">\n            <transactionManager type=\"MANAGED\">\n                <property name=\"closeConnection\" value=\"false\"/>\n            </transactionManager>\n            <dataSource type=\"JNDI\">\n                <property name=\"data_source\" value=\"jdbc/pineapple_data_source\"/>\n            </dataSource>\n        </environment>\n    </environments>\n    <!-- Mapper\u306e\u767b\u9332\u304c\u5fc5\u9808 -->\n    <mappers>\n        <mapper class=\"sample.payara.mybatis.mapper.AppleMyBatisMapper\"/>\n        <mapper class=\"sample.payara.mybatis.mapper.AppleMyBatisXmlMapper\"/>\n        <mapper class=\"sample.payara.mybatis.mapper.PineappleMyBatisMapper\"/>\n    </mappers>\n</configuration>\n```\n\n*****\n### `SqlSession`\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u306eBean\u3092\u4f5c\u6210\n\n`SqlSession`\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u3001SQL\u3092\u5b9f\u884c\u3059\u308b\u5ea6\u306b`SqlSessionFactory#openSession`\u3057\u3066\u53d6\u5f97\u3057\u306a\u3044\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n`SqlSession`\u3092\u5229\u7528\u3059\u308b\u30af\u30e9\u30b9\u3067\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```java\n@Inject\nprivate SqlSession sqlSession;\n```\n\n```java:sample.payara.mybatis.provider.MyBatisSqlSessionProvidor\n@Stateless\npublic class MyBatisSqlSessionProvidor {\n    /*\n     * SqlSessionFactory\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092CDI\u7d4c\u7531\u3067\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u3059\u308b\n     * \u4e0b\u8a18\u3067\u5ba3\u8a00\u3057\u3066\u3044\u308b`appleSessionFactory`\u3068`pineappleSessionFactory`\u304cCDI\u306b\u767b\u9332\u3059\u308b\u30e1\u30bd\u30c3\u30c9\n     */\n    @AppleDataSource\n    @Inject\n    private SqlSessionFactory appleSessionFactory;\n\n    @PineappleDataSource\n    @Inject\n    private SqlSessionFactory pineappleSessionFactory;\n\n    private SqlSessionFactory create(String environment) {\n        try (InputStream stream = Resources.getResourceAsStream(\"mybatis-config.xml\")) {\n            SqlSessionFactoryBuilder builder = new SqlSessionFactoryBuilder();\n            return builder.build(stream, environment);\n        } catch (IOException e) {\n            throw new UncheckedIOException(e);\n        }\n    }\n\n    /*\n     * SqlSessionFactory\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092CDI\u306b\u767b\u9332\n     * DataSource\u3092\u8907\u6570\u5229\u7528\u3057\u3066\u3044\u308b\u305f\u3081\u3001`@AppleDataSource`\u3068`@PineappleDataSource`\u3068\u3044\u3046annotation\u3067\u8b58\u5225\u3057\u3066\u3044\u308b\n     * `SqlSessionFactory`\u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u9593\u306f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u7834\u68c4\u3057\u306a\u3044\u305f\u3081\u306b`@ApplicationScoped`\u3092\u6307\u5b9a\u3059\u308b\n     */\n    @ApplicationScoped\n    @AppleDataSource\n    @Produces\n    public SqlSessionFactory appleSessionFactory() {\n        return this.create(\"apple\");\n    }\n\n    @ApplicationScoped\n    @PineappleDataSource\n    @Produces\n    public SqlSessionFactory pineappleSessionFactory() {\n        return this.create(\"pineapple\");\n    }\n\n    /*\n     * `SqlSession`\u3092\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u3059\u308b\u305f\u3081\u306e\u30e1\u30bd\u30c3\u30c9\n     * Request\u6bce\u306bopen/close\u3059\u308b\u305f\u3081`@RequestScoped`\u3092\u6307\u5b9a\n     * `@Produces`\u3067CDI\u7d4c\u7531\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\n     */\n    @RequestScoped\n    @AppleDataSource\n    @Produces\n    public SqlSession appleSession() {\n        return appleSessionFactory.openSession();\n    }\n\n    @RequestScoped\n    @PineappleDataSource\n    @Produces\n    public SqlSession pineappleSession() {\n        return pineappleSessionFactory.openSession();\n    }\n\n    /*\n     * Request\u304c\u5b8c\u4e86\u3057\u305f\u3068\u304d\u306b`SqlSession`\u3092close\u3059\u308b\n     */\n    public void closeAppleSession(@Disposes @AppleDataSource SqlSession sqlSession) {\n        sqlSession.close();\n    }\n\n    public void closePineappleSession(@Disposes @PineappleDataSource SqlSession sqlSession) {\n        sqlSession.close();\n    }\n}\n```\n\n*****\n### Mapper\u3092\u4f5c\u6210\n\nJavaAPI\u3092\u5229\u7528\u3057\u305fMapper\n\n```java:sample.payara.mybatis.mapper.AppleMyBatisMapper\npublic interface AppleMyBatisMapper {\n\n    /* SQL\u5b9f\u884c\u7d50\u679c\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3059\u308b\u305f\u3081\u306e\u8a2d\u5b9a */\n    @Results(id = \"findAllMybatisUser\", value = {\n            @Result(property = \"id\", column = \"id\", id = true),\n            @Result(property = \"name\", column = \"name\"),\n            @Result(property = \"created\", column = \"created\"),\n            @Result(property = \"updated\", column = \"updated\"),\n    })\n    /* select\u6587 */\n    @Select({\n        \"select *\",\n        \"from sample_model\",\n    })\n    public List<MyBatisUser> findAll();\n\n    @Results(id = \"findByMybatisUser\", value = {\n            @Result(property = \"id\", column = \"id\", id = true),\n            @Result(property = \"name\", column = \"name\"),\n            @Result(property = \"created\", column = \"created\"),\n            @Result(property = \"updated\", column = \"updated\"),\n    })\n    @Select({\n        \"select *\",\n        \"from sample_model s\",\n        \"where s.id = #{id}\"\n    })\n    public MyBatisUser findById(@Param(\"id\") Long id);\n\n    /* SQL\u6587\u3092\u52d5\u7684\u306b\u7d44\u307f\u7acb\u3066\u308b */\n    @SelectProvider(type = MyBatisMapperSqlBuilder.class, method = \"findByParamSql\")\n    public List<MyBatisUser> findByParam(@Param(\"param\") MyBatisUserSearchParam param);\n}\n```\n\n```java:sample.payara.mybatis.mapper.MyBatisMapperSqlBuilder\npublic class MyBatisMapperSqlBuilder {\n    /*\n     * SQL\u6587\u306e`#{param.xxx}`\u306e\u90e8\u5206\u306f\u3001\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u306e`@Param(\"param\")`\u3092\u53c2\u7167\u3057\u3066\u3044\u308b\n     * `AppleMyBatisMapper#findByParam`\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b`param`\u3067\u306f\u7121\u3044\n     */\n    public String findByParamSql(@Param(\"param\") final MyBatisUserSearchParam param) {\n        SQL sql = new SQL()\n                .SELECT(\"*\")\n                .FROM(\"sample_model s\");\n\n        if (param.hasId()) {\n            sql.WHERE(\"s.id = #{param.id}\");\n        }\n\n        if (param.hasName()) {\n            sql.WHERE(\"s.name like #{param.name} \");\n        }\n\n        return sql.toString();\n    }\n\n}\n```\n\nXML\u3092\u5229\u7528\u3057\u305fMapper\n\n```java:sample.payara.mybatis.mapper.AppleMyBatisXmlMapper\npublic interface AppleMyBatisXmlMapper {\n\n    public MyBatisUser findById(@Param(\"id\") final Long id);\n\n    public List<MyBatisUser> findByParam(@Param(\"param\") final MyBatisUserSearchParam param);\n\n}\n```\n\n```xml:src/main/java/sample/payara/mybatis/mapper/AppleMyBatisXmlMapper.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n<mapper namespace=\"sample.payara.mybatis.mapper.AppleMyBatisXmlMapper\">\n    <resultMap type=\"sample.payara.model.MyBatisUser\" id=\"MyBatisUser\">\n        <id column=\"id\" property=\"id\"/>\n        <result column=\"name\" property=\"name\"/>\n        <result column=\"created\" property=\"created\"/>\n        <result column=\"updated\" property=\"updated\"/>\n    </resultMap>\n    <select id=\"findById\" resultMap=\"MyBatisUser\">\n        SELECT *\n          FROM sample_model s\n        <where>\n            AND s.id = #{id}\n        </where>\n    </select>\n    <select id=\"findByParam\" resultMap=\"MyBatisUser\">\n        SELECT *\n          FROM sample_model s\n        <where>\n            <if test=\"param.hasId()\">\n                AND s.id = #{param.id}\n            </if>\n            <if test=\"param.hasName()\">\n                <bind name=\"pattern\" value=\"param.name + '%'\"/>\n                AND s.name LIKE #{pattern}\n            </if>\n        </where>\n    </select>\n</mapper>\n```\n\n*****\n### Mapper\u3092\u547c\u3073\u51fa\u3059\n\n`SqlSession`\u304b\u3089Mapper\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53d6\u5f97\u3057\u3066\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002\n\n```java:sample.payara.mybatis.repotiroy.AppleMyBatisRepository\n@Stateless\npublic class AppleMyBatisRepository {\n    @AppleDataSource\n    @Inject\n    private SqlSession sqlSession;\n\n    /*\n     * `sqlSession.getMapper`\u3067Mapper\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53d6\u5f97\u3067\u304d\u308b\n     */\n    private AppleMyBatisMapper mapper() {\n        return sqlSession.getMapper(AppleMyBatisMapper.class);\n    }\n\n    private AppleMyBatisXmlMapper xmlMapper() {\n        return sqlSession.getMapper(AppleMyBatisXmlMapper.class);\n    }\n\n    public List<MyBatisUser> findAll() {\n        return mapper().findAll();\n    }\n\n    public MyBatisUser findBy(final Long id) {\n        return mapper().findById(id);\n    }\n\n    public List<MyBatisUser> findBy(final MyBatisUserSearchParam param) {\n        return mapper().findByParam(param);\n    }\n\n    public List<MyBatisUser> findByXmlMapper(final MyBatisUserSearchParam param) {\n        return xmlMapper().findByParam(param);\n    }\n}\n```\n\n*****\n### \u53c2\u8003\n\n\u53c2\u8003\u306b\u3057\u307e\u3057\u305f m(\\__)m\n\nhttp://n-agetsuma.hatenablog.com/entry/2013/01/13/151303\nhttp://qiita.com/opengl-8080/items/431de9175dca33a09ba8\nhttp://www.mybatis.org/mybatis-3/ja/index.html\n\n\u30bd\u30fc\u30b9\u306f\u2193\u306b\u3042\u308a\u307e\u3059\u3001\u53c2\u8003\u306b\u306a\u308c\u3070\u5e78\u3044\u3067\u3059\nhttps://github.com/yamashiro0110/JavaEE/tree/master/Payara\n", "tags": ["JavaEE7", "MyBatis"]}