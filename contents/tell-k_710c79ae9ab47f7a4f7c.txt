{"tags": ["Python", "Django"], "context": "\n\n\u6982\u8981\n\n\u6614 Django \u306e order_by \u3067\u3069\u30cf\u30de\u308a\u3057\u305f\u6642\u306e\u30e1\u30e2\u304c\u767a\u6398\u3055\u308c\u305f\u306e\u3067\u6b8b\u3057\u3066\u304a\u304f\nDjango \u3067 order_by \u3084 values \u3084 distinct \u3092\u540c\u6642\u306b\u4f7f\u3046\u3068\u610f\u56f3\u3057\u306a\u3044\u7d50\u679c\u304c\u5f97\u3089\u308c\u3066\u3057\u307e\u3046\u306e\u3067\u6ce8\u610f\u3068\u3044\u3046\u8a71\n\n\n\u74b0\u5883\n\nDjango1.9\nMySQL\n\n\n\u524d\u63d0\n\n\u4e0b\u8a18\u306e\u3088\u3046\u306aDjango\u30e2\u30c7\u30eb\u304c\u3042\u308b\u3068\u3059\u308b\n\n# polls/models.py\n\nclass Question(models.Model):\n\n    question_text = models.CharField(max_length=200)\n    pub_date = models.DateTimeField('date published')\n\n\nclass Choice(models.Model):\n\n    question = models.ForeignKey(Question, on_delete=models.CASCADE)\n    choice_text = models.CharField(max_length=200)\n    votes = models.IntegerField(default=0)\n\n\n\u3042\u3089\u304b\u3058\u3081\u3053\u3093\u306a\u30c7\u30fc\u30bf\u304c\u5165\u3063\u3066\u308b\u3053\u3068\u3068\u3059\u308b\n\nq1 = Question.objects.get(question_text='question1')\nq2 = Question.objects.get(question_text='question2')\n\nChoice.objects.create(question=q1, choice_text='choice1', votes=1)\nChoice.objects.create(question=q1, choice_text='choice2', votes=1)\nChoice.objects.create(question=q2, choice_text='choice3', votes=1)\nChoice.objects.create(question=q2, choice_text='choice4', votes=1)\n\n\n1.SELECT\u3059\u308b\u30ab\u30e9\u30e0\u3092\u7d5e\u308b\n\n\nChoice \u306e\u5916\u90e8\u30ad\u30fc\u3067\u3042\u308bquestion(=question_id)\u3060\u3051\u3092SELECT\u3059\u308b\n\n# values\u3067\u7d5e\u308b --\nChoice.objects.values('question')\n\n-- \u5b9f\u884c\u3055\u308c\u308bSQL\nmysql> SELECT `polls_choice`.`question_id` FROM `polls_choice`;\n+-------------+\n| question_id |\n+-------------+\n|           1 |\n|           1 |\n|           2 |\n|           2 |\n+-------------+\n4 rows in set (0.00 sec)\n\n\n2. 1\u306bdistinct\u3092\u52a0\u3048\u308b\n# distinct \u3067 \u91cd\u8907\u3092\u524a\u9664\u3059\u308b  --\nChoice.objects.values('question').distinct()\n\n-- \u5b9f\u884c\u3055\u308c\u308bSQL\nmysql> SELECT DISTINCT `polls_choice`.`question_id` FROM `polls_choice`;\n+-------------+\n| question_id |\n+-------------+\n|           1 |\n|           2 |\n+-------------+\n2 rows in set (0.00 sec)\n\n\n\u3061\u3083\u3093\u3068\u91cd\u8907\u6392\u9664\u3067\u304d\u3066\u3044\u308b\n\n\n3. 2\u306border_by\u3092\u52a0\u3048\u308b\n# values\u3067\u7d5e\u3063\u305f\u30d5\u30a3\u30fc\u30eb\u30c9\u3068\u306f\u5225\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u3067 order_by \u3059\u308b\nChoice.objects.values('question').distinct().order_by('-id')\n\n-- \u5b9f\u884c\u3055\u308c\u308bSQL\n-- \u306a\u305c\u304b\u3001order_by\u3067\u6307\u5b9a\u3057\u305f\u30d5\u30a3\u30fc\u30eb\u30c9\u304cSELECT\u3055\u308c\u3066\u308b...\nmysql> SELECT DISTINCT `polls_choice`.`question_id`, `polls_choice`.`id` FROM `polls_choice` ORDER BY `polls_choice`.`id` DESC;\n+-------------+----+\n| question_id | id |\n+-------------+----+\n|           2 |  4 |\n|           2 |  3 |\n|           1 |  2 |\n|           1 |  1 |\n+-------------+----+\n4 rows in set (0.00 sec)\n\n\n\u3048\uff1f \u306a\u305c\u304bSELECT\u5bfe\u8c61\u306bid\u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308b\u3002\u3002\u3002\n\u304a\u304b\u3052\u3067distinct question_id\u3068\u3057\u305f\u3064\u3082\u308a\u304c\u51fa\u6765\u3066\u3044\u306a\u3044\u3002\u3002\u3002\u3002\n\u4e0a\u8a18\u306f\u30b3\u30fc\u30c9\u4e0a\u306border_by\u304c\u73fe\u308c\u308b\u304b\u3089\u307e\u3060\u539f\u56e0\u7279\u5b9a\u3057\u3084\u3059\u3044\n\u4e0b\u8a18\u306e\u3088\u3046\u306bMeta\u3067ordering\u3055\u308c\u3066\u305f\u308a\u3059\u308b\u3068\u898b\u3064\u3051\u3065\u3089\u304f\u3066\u6700\u60aa\u3067\u3042\u308b\u3002\n\nclass Choice(models.Model):\n\n    question = models.ForeignKey(Question, on_delete=models.CASCADE)\n    choice_text = models.CharField(max_length=200)\n    votes = models.IntegerField(default=0)\n\n    class Meta:\n        ordering = ('-id',)\n\n\n\u3082\u3057\u30c7\u30d5\u30a9\u30eb\u30c8\u306eordering\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u308b\u5834\u5408\u306f\u3001\u610f\u56f3\u7684\u306border_by()\u3092\u7a7a\u3067\u8aad\u3093\u3067\u7121\u52b9\u5316\u3059\u308b\u306a\u3069\u306e\u5bfe\u51e6\u304c\u5fc5\u8981\u306b\u306a\u308b\u3002\n\nChoice.objects.values('question').distinct().order_by()\n\n\nDjango \u3067order_by\u3059\u308b\u3068\u6307\u5b9a\u3057\u305f\u30d5\u30a3\u30fc\u30eb\u30c9\u306f SELECT \u3055\u308c\u308b\n\nSELECT \u306b\u542b\u307e\u308c\u308b\u306e\u306f\u3057\u3087\u3046\u304c\u306a\u3044\u306e\u3067\u3001order_by \u3084 values/only/distinct \u306a\u3069\u3068\u7d44\u307f\u5408\u308f\u305b\u308b\u5834\u5408\u306f\u7d50\u679c\u306e\u4e00\u610f\u6027\u3092\u640d\u306a\u3046\u53ef\u80fd\u6027\u304c\u3042\u308b\u306e\u3067\u6c17\u3092\u3064\u3051\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\n\u3053\u306e\u8fba\u306e\u8a71\u306f\u3001\u4e0b\u8a18\u53c2\u8003URL\u306eDjango\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u6ce8\u610f\u70b9\u3068\u3057\u3066\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u3002\n\n\nPostgres \u306e\u5834\u5408\u306f DISTINCT ON \u304c\u4f7f\u3048\u308b\n\n\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u304cPostgres\u306e\u5834\u5408\u306fDISTINCT ON\u304c\u4f7f\u3048\u308b\u306e\u3067\u3001distinct\u30e1\u30bd\u30c3\u30c9\u306b\u5bfe\u8c61\u3092\u6e21\u3059\u3053\u3068\u304c\u3067\u304d\u308b\n\nChoice.objects.values('question').distinct('question').order_by('question', '-id')\n\n\n\u307e\u3068\u3081\n\n\ndistinct/values/only/defer + order_by \u3092\u4f7f\u3046\u6642\u306f\u3069\u3046\u3044\u3046SQL\u304c\u767a\u884c\u3055\u308c\u308b\u304b\u6ce8\u610f\u3057\u3088\u3046\u306a > \u4ffa\u3002\n\n\n\u53c2\u8003\n\nDjango\u3067postgres\u306edistinct on\u3092\u5b9f\u884c\u3059\u308b\nDjango1.9 > QuerySet API reference > distinct\nDjango1.4(\u65e5\u672c\u8a9e\u8a33) > QuerySet API reference > distinct\n\n## \u6982\u8981\n\n- \u6614 Django \u306e `order_by` \u3067\u3069\u30cf\u30de\u308a\u3057\u305f\u6642\u306e\u30e1\u30e2\u304c\u767a\u6398\u3055\u308c\u305f\u306e\u3067\u6b8b\u3057\u3066\u304a\u304f\n- Django \u3067 `order_by` \u3084 `values` \u3084 `distinct` \u3092\u540c\u6642\u306b\u4f7f\u3046\u3068\u610f\u56f3\u3057\u306a\u3044\u7d50\u679c\u304c\u5f97\u3089\u308c\u3066\u3057\u307e\u3046\u306e\u3067\u6ce8\u610f\u3068\u3044\u3046\u8a71\n\n## \u74b0\u5883\n\n- Django1.9\n- MySQL\n\n## \u524d\u63d0\n\n- \u4e0b\u8a18\u306e\u3088\u3046\u306aDjango\u30e2\u30c7\u30eb\u304c\u3042\u308b\u3068\u3059\u308b\n\n```python\n# polls/models.py\n\nclass Question(models.Model):\n\n    question_text = models.CharField(max_length=200)\n    pub_date = models.DateTimeField('date published')\n\n\nclass Choice(models.Model):\n\n    question = models.ForeignKey(Question, on_delete=models.CASCADE)\n    choice_text = models.CharField(max_length=200)\n    votes = models.IntegerField(default=0)\n```\n\n- \u3042\u3089\u304b\u3058\u3081\u3053\u3093\u306a\u30c7\u30fc\u30bf\u304c\u5165\u3063\u3066\u308b\u3053\u3068\u3068\u3059\u308b\n\n```python\nq1 = Question.objects.get(question_text='question1')\nq2 = Question.objects.get(question_text='question2')\n\nChoice.objects.create(question=q1, choice_text='choice1', votes=1)\nChoice.objects.create(question=q1, choice_text='choice2', votes=1)\nChoice.objects.create(question=q2, choice_text='choice3', votes=1)\nChoice.objects.create(question=q2, choice_text='choice4', votes=1)\n```\n\n## 1.SELECT\u3059\u308b\u30ab\u30e9\u30e0\u3092\u7d5e\u308b\n\n- `Choice` \u306e\u5916\u90e8\u30ad\u30fc\u3067\u3042\u308b`question`(=`question_id`)\u3060\u3051\u3092SELECT\u3059\u308b\n\n```python\n# values\u3067\u7d5e\u308b --\nChoice.objects.values('question')\n```\n\n```sql\n-- \u5b9f\u884c\u3055\u308c\u308bSQL\nmysql> SELECT `polls_choice`.`question_id` FROM `polls_choice`;\n+-------------+\n| question_id |\n+-------------+\n|           1 |\n|           1 |\n|           2 |\n|           2 |\n+-------------+\n4 rows in set (0.00 sec)\n```\n\n## 2. 1\u306b`distinct`\u3092\u52a0\u3048\u308b\n\n```python\n# distinct \u3067 \u91cd\u8907\u3092\u524a\u9664\u3059\u308b  --\nChoice.objects.values('question').distinct()\n```\n\n```sql\n-- \u5b9f\u884c\u3055\u308c\u308bSQL\nmysql> SELECT DISTINCT `polls_choice`.`question_id` FROM `polls_choice`;\n+-------------+\n| question_id |\n+-------------+\n|           1 |\n|           2 |\n+-------------+\n2 rows in set (0.00 sec)\n```\n\n- \u3061\u3083\u3093\u3068\u91cd\u8907\u6392\u9664\u3067\u304d\u3066\u3044\u308b\n\n## 3. 2\u306b`order_by`\u3092\u52a0\u3048\u308b\n\n```python\n# values\u3067\u7d5e\u3063\u305f\u30d5\u30a3\u30fc\u30eb\u30c9\u3068\u306f\u5225\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u3067 order_by \u3059\u308b\nChoice.objects.values('question').distinct().order_by('-id')\n```\n\n```sql\n-- \u5b9f\u884c\u3055\u308c\u308bSQL\n-- \u306a\u305c\u304b\u3001order_by\u3067\u6307\u5b9a\u3057\u305f\u30d5\u30a3\u30fc\u30eb\u30c9\u304cSELECT\u3055\u308c\u3066\u308b...\nmysql> SELECT DISTINCT `polls_choice`.`question_id`, `polls_choice`.`id` FROM `polls_choice` ORDER BY `polls_choice`.`id` DESC;\n+-------------+----+\n| question_id | id |\n+-------------+----+\n|           2 |  4 |\n|           2 |  3 |\n|           1 |  2 |\n|           1 |  1 |\n+-------------+----+\n4 rows in set (0.00 sec)\n```\n\n- **\u3048\uff1f \u306a\u305c\u304bSELECT\u5bfe\u8c61\u306bid\u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308b\u3002\u3002\u3002**\n- \u304a\u304b\u3052\u3067`distinct question_id`\u3068\u3057\u305f\u3064\u3082\u308a\u304c\u51fa\u6765\u3066\u3044\u306a\u3044\u3002\u3002\u3002\u3002\n- \u4e0a\u8a18\u306f\u30b3\u30fc\u30c9\u4e0a\u306b`order_by`\u304c\u73fe\u308c\u308b\u304b\u3089\u307e\u3060\u539f\u56e0\u7279\u5b9a\u3057\u3084\u3059\u3044\n- \u4e0b\u8a18\u306e\u3088\u3046\u306b`Meta`\u3067`ordering`\u3055\u308c\u3066\u305f\u308a\u3059\u308b\u3068\u898b\u3064\u3051\u3065\u3089\u304f\u3066**\u6700\u60aa**\u3067\u3042\u308b\u3002\n\n```python\nclass Choice(models.Model):\n\n    question = models.ForeignKey(Question, on_delete=models.CASCADE)\n    choice_text = models.CharField(max_length=200)\n    votes = models.IntegerField(default=0)\n\n    class Meta:\n        ordering = ('-id',)\n```\n\n- \u3082\u3057\u30c7\u30d5\u30a9\u30eb\u30c8\u306e`ordering`\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u308b\u5834\u5408\u306f\u3001\u610f\u56f3\u7684\u306b`order_by()`\u3092\u7a7a\u3067\u8aad\u3093\u3067\u7121\u52b9\u5316\u3059\u308b\u306a\u3069\u306e\u5bfe\u51e6\u304c\u5fc5\u8981\u306b\u306a\u308b\u3002\n\n```python\nChoice.objects.values('question').distinct().order_by()\n```\n\n## Django \u3067`order_by`\u3059\u308b\u3068\u6307\u5b9a\u3057\u305f\u30d5\u30a3\u30fc\u30eb\u30c9\u306f SELECT \u3055\u308c\u308b\n\n- SELECT \u306b\u542b\u307e\u308c\u308b\u306e\u306f\u3057\u3087\u3046\u304c\u306a\u3044\u306e\u3067\u3001`order_by` \u3084 `values/only/distinct` \u306a\u3069\u3068\u7d44\u307f\u5408\u308f\u305b\u308b\u5834\u5408\u306f\u7d50\u679c\u306e\u4e00\u610f\u6027\u3092\u640d\u306a\u3046\u53ef\u80fd\u6027\u304c\u3042\u308b\u306e\u3067\u6c17\u3092\u3064\u3051\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\n- \u3053\u306e\u8fba\u306e\u8a71\u306f\u3001\u4e0b\u8a18\u53c2\u8003URL\u306eDjango\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u6ce8\u610f\u70b9\u3068\u3057\u3066\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u3002\n\n## Postgres \u306e\u5834\u5408\u306f DISTINCT ON \u304c\u4f7f\u3048\u308b\n\n- \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u304cPostgres\u306e\u5834\u5408\u306f`DISTINCT ON`\u304c\u4f7f\u3048\u308b\u306e\u3067\u3001`distinct`\u30e1\u30bd\u30c3\u30c9\u306b\u5bfe\u8c61\u3092\u6e21\u3059\u3053\u3068\u304c\u3067\u304d\u308b\n\n```python\nChoice.objects.values('question').distinct('question').order_by('question', '-id')\n```\n\n## \u307e\u3068\u3081\n\n- `distinct/values/only/defer` + `order_by` \u3092\u4f7f\u3046\u6642\u306f\u3069\u3046\u3044\u3046SQL\u304c\u767a\u884c\u3055\u308c\u308b\u304b\u6ce8\u610f\u3057\u3088\u3046\u306a > \u4ffa\u3002\n\n## \u53c2\u8003\n\n- [Django\u3067postgres\u306edistinct on\u3092\u5b9f\u884c\u3059\u308b](http://d.hatena.ne.jp/yuheiomori0718/20120914/1347634603)\n- [Django1.9 > QuerySet API reference > distinct](https://docs.djangoproject.com/ja/1.9/ref/models/querysets/#distinct)\n- [Django1.4(\u65e5\u672c\u8a9e\u8a33) > QuerySet API reference > distinct](http://docs.djangoproject.jp/en/latest/ref/models/querysets.html#django.db.models.query.QuerySet.distinct)\n\n\n\n"}