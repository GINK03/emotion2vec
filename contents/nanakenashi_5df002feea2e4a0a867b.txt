{"context": "\u3053\u306e\u8a18\u4e8b\u306f\u682a\u5f0f\u4f1a\u793e\u30cd\u30af\u30b9\u30c8(Lifull) Advent Calendar 2016\u306e9\u65e5\u76ee\u3067\u3059\u3002\n\u696d\u52d9\u3067Docker\u30b3\u30f3\u30c6\u30ca\u3092\u5c0e\u5165\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3063\u305f\u306e\u3067\n\u305d\u308c\u3089\u3092\u76e3\u8996\u3059\u308b\u305f\u3081\u306b\u8abf\u3079\u305f\u8272\u3005\u3092\u66f8\u304d\u51fa\u3057\u307e\u3059\u3002\n\u300c\u30ed\u30b0\u76e3\u8996\u300d\u300c\u30ea\u30bd\u30fc\u30b9\u76e3\u8996\u300d\u306e\u89b3\u70b9\u3067\u307e\u3068\u3081\u3066\u307f\u307e\u3057\u305f\u3002\n\n \u74b0\u5883\n\u5f0a\u793e\u3067\u904b\u55b6\u3057\u3066\u3044\u308b\u591a\u304f\u306eWeb\u30b5\u30fc\u30d3\u30b9\u3067\u306fAWS\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\nAWS\u4e0a\u3067\u30b3\u30f3\u30c6\u30ca\u3092\u5229\u7528\u3059\u308b\u65b9\u6cd5\u306f\u3044\u304f\u3064\u304b\u3042\u308a\u307e\u3059\u304c\n\u57fa\u672c\u306fElasticBeanstalk\uff08\u4ee5\u4e0b\u3001EB\u3068\u7565\uff09\u4e0a\u3067\u306e\u8907\u6570\u30b3\u30f3\u30c6\u30ca\u3092\u60f3\u5b9a\u3057\u307e\u3059\u3002\n\uff08\u3068\u306f\u3044\u3048\u88cf\u5074\u3067\u306fECS\u304c\u52d5\u3044\u3066\u3044\u308b\u306e\u3067\u3059\u304c\uff09\n\n \u30ed\u30b0\u76e3\u8996\n\nDocker: logs\u30b3\u30de\u30f3\u30c9\nDocker\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3001\u30db\u30b9\u30c8\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\n\u30b3\u30f3\u30c6\u30ca\u5185\u306eSTDOUT\u3068STDERR\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u4f8b\uff1a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b3\u30f3\u30c6\u30ca\u306b\u5bfe\u3059\u308blogs\u30b3\u30de\u30f3\u30c9\n$ docker logs a59845048cea\n[2016-12-05 17:10:05 +0000] [7] [INFO] Starting gunicorn 19.6.0\n[2016-12-05 17:10:05 +0000] [7] [INFO] Listening at: http://0.0.0.0:5000 (7)\n[2016-12-05 17:10:05 +0000] [7] [INFO] Using worker: sync\n[2016-12-05 17:10:06 +0000] [10] [INFO] Booting worker with pid: 10\n\n\n\u30c7\u30d0\u30c3\u30b0\u6642\u306b\u306f\u4fbf\u5229\u3067\u3059\u304c\u3001\u6bce\u56de\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u5165\u308b\u308f\u3051\u306b\u3082\u3044\u304d\u307e\u305b\u3093\u3002\nDocker\u306b\u306f\u30ed\u30ae\u30f3\u30b0\u30c9\u30e9\u30a4\u30d0\u3068\u3044\u3046\u6a5f\u80fd\u304c\u3042\u308a\nlogs\u3067\u5f97\u3089\u308c\u308b\u5185\u5bb9\u3092\u3044\u304f\u3064\u304b\u306e\u65b9\u6cd5\u3067\u5916\u90e8\u306b\u51fa\u529b\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\nAWS: CloudWatch Logs\u306e\u6d3b\u7528\nDocker\u306f\u524d\u8ff0\u306e\u30ed\u30ae\u30f3\u30b0\u30c9\u30e9\u30a4\u30d0\u306b\u304a\u3044\u3066\n\u516c\u5f0f\u3067Cloudwatch Logs\u3078\u306e\u51fa\u529b\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\nEB\u3067\u306f--log-driver\u306e\u3088\u3046\u306bdocker run\u306e\u969b\u306b\u6e21\u3059\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\ndockerrun.aws.json\u3068\u3044\u3046\u72ec\u81ea\u5f62\u5f0f\u306ejson\u306b\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u306e\u30b3\u30f3\u30c6\u30ca\u5b9a\u7fa9\u5f62\u5f0f\u306fECS\u3068\u5171\u901a\u306a\u306e\u3067\n\u30ed\u30b0\u306e\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306fECS\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u8a18\u8f09\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\n\u30ed\u30ae\u30f3\u30b0\u306e\u8a2d\u5b9a\n\"logConfiguration\": {\n      \"logDriver\": \"json-file\"|\"syslog\"|\"journald\"|\"gelf\"|\"fluentd\"|\"awslogs\",\n      \"options\": {\"string\": \"string\"\n        ...}\n\n\nlogDriver\u306b\u3064\u3044\u3066\u306fawslogs\u3092\u9078\u629e\u3057\u3066\u554f\u984c\u306a\u3055\u305d\u3046\u3002\noptions\u306b\u306f\u3001awslogs-region\u3068awslogs-group\u3092\u6307\u5b9a\u3059\u308c\u3070\u3088\u3055\u305d\u3046\u3067\u3059\u3002\n\u8a66\u3057\u306b\u4ee5\u4e0b\u306e\u5b9a\u7fa9\u3067nginx\u30b3\u30f3\u30c6\u30ca\u306e\u30ed\u30b0\u3092\u51fa\u529b\u3057\u3066\u307f\u307e\u3059\u3002\n\u516c\u5f0f\u306enginx\u30a4\u30e1\u30fc\u30b8\u3067\u3001\u5185\u5bb9\u306f80\u756a\u30dd\u30fc\u30c8\u3092\u958b\u3051\u3066\u3044\u308b\u3060\u3051\u3067\u3059\u3002\n\nDockerrun.aws.json\n{\n  \"AWSEBDockerrunVersion\": \"2\",\n  \"containerDefinitions\": [\n    {\n      \"name\": \"nginx\",\n      \"image\": \"nginx:1.11.5-alpine\",\n      \"essential\": true,\n      \"memory\": 128,\n      \"portMappings\": [\n        {\n          \"hostPort\": 80,\n          \"containerPort\": 80\n        }\n      ],\n      \"logConfiguration\": {\n        \"logDriver\": \"awslogs\",\n        \"options\": {\n          \"awslogs-region\": \"ap-northeast-1\",\n          \"awslogs-group\": \"nginx-group\"\n        }\n      }\n    }\n  ]\n}\n\n\n\u6307\u5b9a\u3057\u305f\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u304cCloudWatch\u5074\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u306a\u3044\u3068\nEB\u306e\u30c7\u30d7\u30ed\u30a4\u3054\u3068\u30b3\u30b1\u308b\u3088\u3046\u306a\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u30c7\u30d7\u30ed\u30a4\u304c\u6210\u529f\u3059\u308b\u3068\u3001CloudWatch\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3084cli\u3067\u30ed\u30b0\u304c\u898b\u3089\u308c\u307e\u3059\u3002\n\u4f55\u5ea6\u304b\u8e0f\u3093\u3060\u7d50\u679c\u3001\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3068\u30a8\u30e9\u30fc\u30ed\u30b0\u306e\u4e21\u65b9\u304c\u51fa\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\n\u3061\u306a\u307f\u306b\u3001STDOUT\u3068STDERR\u3092\u8868\u793a\u3059\u308b\u306f\u305a\u306edocker logs\u3067\n\u3053\u308c\u3089\u304c\u898b\u3089\u308c\u308b\u306e\u306f\u516c\u5f0f\u306enginx\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u7528\u3057\u305f\u304b\u3089\u3067\u3059\u3002\nDockerfile\u3092\u898b\u308b\u3068\u3001\u30ed\u30b0\u306e\u51fa\u529b\u5148\u304c\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\nDockerfile\n# forward request and error logs to docker log collector\n&& ln -sf /dev/stdout /var/log/nginx/access.log \\\n&& ln -sf /dev/stderr /var/log/nginx/error.log\n\n\ndocker logs\u306e\u96c6\u7d04\u306b\u3064\u3044\u3066\u306f\u3053\u306e\u65b9\u6cd5\u3067\u306a\u3093\u3068\u304b\u306a\u308a\u305d\u3046\u3067\u3059\u3002\nSTDOUT\u3068STDERR\u3092\u5206\u3051\u3089\u308c\u306a\u3044\u306e\u306f\u96e3\u70b9\u3067\u3059\u304c\nDocker\u306eIssue\u3067\u3082\u5c11\u306a\u304b\u3089\u305a\u8b70\u8ad6\u304c\u3042\u308b\u306e\u3067\u3001\u3044\u305a\u308c\u6539\u5584\u3055\u308c\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\u3061\u306a\u307f\u306b\u3001fluentd\u306e\u30ed\u30ae\u30f3\u30b0\u30c9\u30e9\u30a4\u30d0\u3067\u306f\u5206\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u3002\n\u307e\u305f\u3001EB\u3067\u30db\u30b9\u30c8\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\n/var/log/docker-events.log\u306a\u3069\u306e\u30ed\u30b0\u304c\u6b8b\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3082\u308f\u304b\u308a\u307e\u3059\u3002\n\u3053\u3061\u3089\u306f\u4e0a\u8a18\u306e\u30ed\u30ae\u30f3\u30b0\u30c9\u30e9\u30a4\u30d0\u3067\u51fa\u529b\u3055\u308c\u306a\u3044\u60c5\u5831\u306a\u306e\u3067\n.ebextensions\u306a\u3069\u3067\u30db\u30b9\u30c8\u5074\u306b\u30ed\u30b0\u51fa\u529b\u306e\u4ed5\u7d44\u307f\u3092\u4f5c\u308b\u5fc5\u8981\u304c\u3042\u308a\u305d\u3046\u3067\u3059\u3002\n\n \u30ea\u30bd\u30fc\u30b9\u76e3\u8996\n\nDocker: stats\u30b3\u30de\u30f3\u30c9\nDocker\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3001\u30b3\u30f3\u30c6\u30ca\u3054\u3068\u306e\u30ea\u30bd\u30fc\u30b9\u4f7f\u7528\u91cf\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\n\u4f8b\uff1a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068DB\u3092\u8d77\u52d5\u3057\u305f\u72b6\u614b\u3067stats\u30b3\u30de\u30f3\u30c9\n$ docker stats\nCONTAINER           CPU %               MEM USAGE / LIMIT       MEM %               NET I/O             BLOCK I/O             PIDS\na59845048cea        1.02%               39.42 MiB / 1.951 GiB   1.97%               1.038 kB / 648 B    32.77 kB / 0 B        5\nac7470b95cef        0.19%               353.9 MiB / 1.951 GiB   17.72%              1.296 kB / 648 B    4.149 MB / 317.8 MB   27\n\n\nLinux\u306etop\u30b3\u30de\u30f3\u30c9\u306e\u3088\u3046\u306b\u4f7f\u3048\u3066\u308f\u304b\u308a\u3084\u3059\u3044\u306e\u3067\u3059\u304c\n\u96c6\u7d04\u3084\u4fdd\u5b58\u306e\u305f\u3081\u306b\u306f\u3053\u308c\u3067\u306f\u4e0d\u5341\u5206\u3067\u3059\u3002\n\nAWS: CloudWatch\u30e1\u30c8\u30ea\u30af\u30b9\nEB\u3084ECS\u3067\u8907\u6570\u30b3\u30f3\u30c6\u30ca\u3092\u6271\u3046\u5834\u5408\u306f\nECS\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30af\u30e9\u30b9\u30bf\u5358\u4f4d\u3067\u306f\u4ee5\u4e0b\u306e4\u3064\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u898b\u3048\u307e\u3059\u3002\n\nECS\u3067\u8a00\u3046\u30b5\u30fc\u30d3\u30b9\u306e\u5358\u4f4d\u3067\u306f\u3001\u4ee5\u4e0b\u306e2\u3064\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u307f\u3067\u3057\u305f\u3002\n\n\u3061\u306a\u307f\u306bEB\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u306f\n\u30b3\u30f3\u30c6\u30ca\u3067\u306f\u306a\u3044\u901a\u5e38\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u76e3\u8996\u3068\u7279\u306b\u5909\u308f\u308a\u307e\u305b\u3093\u3002\n\n\u898b\u6163\u308c\u305fCloudWatch\u306e\u5f62\u5f0f\u3067\u898b\u3089\u308c\u308b\u306e\u306f\u3042\u308a\u304c\u305f\u3044\u306e\u3067\u3059\u304c\n\u30b3\u30f3\u30c6\u30ca\u3054\u3068\u306e\u4f7f\u7528\u30ea\u30bd\u30fc\u30b9\u306a\u3069\u3001\u3082\u3046\u5c11\u3057\u7d30\u304b\u3044\u90e8\u5206\u304c\u6c17\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u30b5\u30fc\u30c9\u30d1\u30fc\u30c6\u30a3\u306e\u30b5\u30fc\u30d3\u30b9/\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306b\u983c\u308b\ncAdvisor\u3084ELK\u30b9\u30bf\u30c3\u30af\u306a\u3069\u306e\u30bd\u30d5\u30c8\u3092\u6d3b\u7528\u3057\u305f\u30e1\u30c8\u30ea\u30af\u30b9\u53ce\u96c6\u3084\n\u30d5\u30eb\u30b9\u30bf\u30c3\u30af\u306a\u6709\u6599\u30b5\u30fc\u30d3\u30b9\u306e\u6d3b\u7528\u306a\u3069\u3001\u8ffd\u52a0\u306e\u9078\u629e\u80a2\u306f\u591a\u304f\u5b58\u5728\u3057\u307e\u3059\u3002\n\u81ea\u90e8\u7f72\u3067\u306f\u76e3\u8996\u9818\u57df\u3067\u5168\u822c\u7684\u306bMackerel\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u305f\u3081\n\u30b3\u30f3\u30c6\u30ca\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u53ef\u8996\u5316\u3082\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nMackerel\u3067\u306fagent\u3092\u4f7f\u7528\u3057\u3066\u30e1\u30c8\u30ea\u30af\u30b9\u60c5\u5831\u3092\u9001\u4fe1\u3057\u307e\u3059\u304c\n\u30b3\u30f3\u30c6\u30ca\u306e\u304b\u305f\u3061\u3067\u76e3\u8996\u3092\u884c\u3046mackerel-agent\u3082\u516c\u5f0f\u3067\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u3067\u3001\u4e00\u7dd2\u306b\u8d77\u52d5\u3057\u3066\u3044\u308b\u30b3\u30f3\u30c6\u30ca\u3068\u30db\u30b9\u30c8\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u76e3\u8996\u304c\u53ef\u80fd\u3067\u3059\u3002\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u5185\u3067\u306fdocker run\u306e\u5f15\u6570\u3068\u3057\u3066\u66f8\u304b\u308c\u3066\u3044\u308b\u90e8\u5206\u3092\nDockerrun.aws.json\u306b\u843d\u3068\u3057\u8fbc\u3093\u3067\u307f\u307e\u3059\u3002\n\nDockerrun.aws.json\n{                                                                                     \n  \"AWSEBDockerrunVersion\": \"2\",                                                       \n  \"volumes\": [                                                                        \n    {                                                                                 \n      \"name\": \"docker-sock\",                                                          \n      \"host\": {                                                                       \n        \"sourcePath\": \"/var/run/docker.sock\"                                          \n      }                                                                               \n    },                                                                                \n    {                                                                                 \n      \"name\": \"lib-mackerel-agent\",                                                   \n      \"host\": {                                                                       \n        \"sourcePath\": \"/var/lib/mackerel-agent\"                                       \n      }                                                                               \n    }                                                                                 \n  ],                                                                                  \n  \"containerDefinitions\": [                                                           \n    {\n      \"nginx\u30b3\u30f3\u30c6\u30ca\u306e\u8a2d\u5b9a\u306f\": \"\u7701\u7565\"\n    },\n    {\n      \"name\": \"mackerel-agent\",                                                       \n      \"image\": \"mackerel/mackerel-agent\",                                             \n      \"environment\": [                                                                \n        { \"name\": \"apikey\", \"value\": \"Hoge8noPEnZj9HogeMEwnHogep5aMQzKMHogee7ZHoge\" },\n        { \"name\": \"enable_docker_plugin\", \"value\": true },                            \n        { \"name\": \"auto_retirement\", \"value\": true }                                  \n      ],                  \n      \"essential\": true,                            \n      \"memory\": 128,                                                                         \n      \"mountPoints\": [                              \n        {                                           \n          \"sourceVolume\": \"docker-sock\",            \n          \"containerPath\": \"/var/run/docker.sock\"   \n        },                                          \n        {                                           \n          \"sourceVolume\": \"lib-mackerel-agent\",     \n          \"containerPath\": \"/var/lib/mackerel-agent\"\n        }                                           \n      ]                                             \n    }                                               \n  ]                                                 \n}                                                                                                               \n\n\nmackerel-agent\u30b3\u30f3\u30c6\u30ca\u306b\u306f\n\u30b5\u30fc\u30d3\u30b9\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306bapikey\u306a\u3069\u306e\u74b0\u5883\u5909\u6570\u3092\u6e21\u3057\u3066\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001\u30e1\u30c8\u30ea\u30af\u30b9\u30c7\u30fc\u30bf\u306e\u3084\u308a\u3068\u308a\u306e\u305f\u3081\u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u30de\u30a6\u30f3\u30c8\u304c\u5fc5\u9808\u3067\u3059\u3002\n\u4e0a\u8a18\u306eDockerrun.aws.json\u304b\u3089\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u305f\u7d50\u679c\nMackerel\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u3067\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u95b2\u89a7\u3067\u304d\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u30b0\u30e9\u30d5\u306f\u30db\u30b9\u30c8\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f7f\u7528\u30e1\u30e2\u30ea\u3092\u793a\u3057\u307e\u3059\u3002\n\n\u30e1\u30e2\u30ea\u4ee5\u5916\u306b\u3082loadaverate\u3001cpu\u3001diskio\u306a\u3069\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u898b\u3089\u308c\u307e\u3059\u3002\n\u3055\u3089\u306b\u3001{ \"name\": \"enable_docker_plugin\", \"value\": true }\u306e\u8a2d\u5b9a\u306b\u3088\u308a\n\u8d77\u52d5\u3057\u3066\u3044\u308b\u30b3\u30f3\u30c6\u30ca\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3082\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u30b0\u30e9\u30d5\u306f \u5404\u30b3\u30f3\u30c6\u30ca \u306e\u4f7f\u7528\u30e1\u30e2\u30ea\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u52dd\u624b\u306b\u8d77\u52d5\u3059\u308becs-agent\u3092\u542b\u3081\u3066\u30013\u3064\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u3042\u308a\u307e\u3059\u3002\n\u3053\u308c\u306b\u52a0\u3048\u3066BlkIO Bytes\u3001BlkIO IOPS\u3001CPU\u306e4\u7a2e\u985e\u304c\u95b2\u89a7\u53ef\u80fd\u3067\n\u305d\u308c\u305e\u308c\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u8d77\u70b9\u3068\u3057\u305f\u30a2\u30e9\u30fc\u30c8\u3082\u98db\u3070\u305b\u308b\u305f\u3081\n\u304b\u306a\u308a\u67d4\u8edf\u306b\u76e3\u8996\u5bfe\u5fdc\u304c\u3067\u304d\u307e\u3059\u3002\nCloudWatch\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3060\u3051\u3067\u306f\u304b\u3086\u3044\u3068\u3053\u308d\u306b\u624b\u304c\u5c4a\u304b\u306a\u3044\u305f\u3081\nMackerel\u306b\u9650\u3089\u305a\u3001\u76e3\u8996\u5c02\u7528\u306e\u30bd\u30ea\u30e5\u30fc\u30b7\u30e7\u30f3\u306f\u4f7f\u3063\u305f\u65b9\u304c\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n \u307e\u3068\u3081\n\u30b3\u30f3\u30c6\u30ca\u306f\u901a\u5e38\u306e\u30b5\u30fc\u30d0\u904b\u7528\u3068\u6bd4\u3079\u3066\u6c38\u7d9a\u6027\u304c\u306a\u3044\u305f\u3081\n\u30ed\u30b0\u3084\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u96c6\u7d04\u3057\u3001\u6b8b\u3057\u3066\u3044\u304f\u3053\u3068\u306f\u7279\u306b\u91cd\u8981\u3060\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u3002\n\u3082\u3063\u3068\u76e3\u8996\u304c\u7c21\u5358\u306b\u306a\u3063\u3066\u3001\u5c0e\u5165\u306e\u969c\u58c1\u304c\u306a\u304f\u306a\u308c\u3070\u826f\u3044\u3067\u3059\u306d\u3002\n\u3053\u306e\u8a18\u4e8b\u306f[\u682a\u5f0f\u4f1a\u793e\u30cd\u30af\u30b9\u30c8(Lifull) Advent Calendar 2016](http://qiita.com/advent-calendar/2016/lifull)\u306e9\u65e5\u76ee\u3067\u3059\u3002\n\n\u696d\u52d9\u3067Docker\u30b3\u30f3\u30c6\u30ca\u3092\u5c0e\u5165\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3063\u305f\u306e\u3067\n\u305d\u308c\u3089\u3092\u76e3\u8996\u3059\u308b\u305f\u3081\u306b\u8abf\u3079\u305f\u8272\u3005\u3092\u66f8\u304d\u51fa\u3057\u307e\u3059\u3002\n\u300c\u30ed\u30b0\u76e3\u8996\u300d\u300c\u30ea\u30bd\u30fc\u30b9\u76e3\u8996\u300d\u306e\u89b3\u70b9\u3067\u307e\u3068\u3081\u3066\u307f\u307e\u3057\u305f\u3002\n\n## :computer: \u74b0\u5883\n\n\u5f0a\u793e\u3067\u904b\u55b6\u3057\u3066\u3044\u308b\u591a\u304f\u306eWeb\u30b5\u30fc\u30d3\u30b9\u3067\u306fAWS\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\nAWS\u4e0a\u3067\u30b3\u30f3\u30c6\u30ca\u3092\u5229\u7528\u3059\u308b\u65b9\u6cd5\u306f\u3044\u304f\u3064\u304b\u3042\u308a\u307e\u3059\u304c\n\u57fa\u672c\u306fElasticBeanstalk\uff08\u4ee5\u4e0b\u3001EB\u3068\u7565\uff09\u4e0a\u3067\u306e\u8907\u6570\u30b3\u30f3\u30c6\u30ca\u3092\u60f3\u5b9a\u3057\u307e\u3059\u3002\n\uff08\u3068\u306f\u3044\u3048\u88cf\u5074\u3067\u306fECS\u304c\u52d5\u3044\u3066\u3044\u308b\u306e\u3067\u3059\u304c\uff09\n\n## :page_with_curl: \u30ed\u30b0\u76e3\u8996\n\n### Docker: logs\u30b3\u30de\u30f3\u30c9\n\nDocker\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3001\u30db\u30b9\u30c8\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\n\u30b3\u30f3\u30c6\u30ca\u5185\u306eSTDOUT\u3068STDERR\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```shell:\u4f8b\uff1a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b3\u30f3\u30c6\u30ca\u306b\u5bfe\u3059\u308blogs\u30b3\u30de\u30f3\u30c9\n$ docker logs a59845048cea\n[2016-12-05 17:10:05 +0000] [7] [INFO] Starting gunicorn 19.6.0\n[2016-12-05 17:10:05 +0000] [7] [INFO] Listening at: http://0.0.0.0:5000 (7)\n[2016-12-05 17:10:05 +0000] [7] [INFO] Using worker: sync\n[2016-12-05 17:10:06 +0000] [10] [INFO] Booting worker with pid: 10\n```\n\n\u30c7\u30d0\u30c3\u30b0\u6642\u306b\u306f\u4fbf\u5229\u3067\u3059\u304c\u3001\u6bce\u56de\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u5165\u308b\u308f\u3051\u306b\u3082\u3044\u304d\u307e\u305b\u3093\u3002\n\nDocker\u306b\u306f[\u30ed\u30ae\u30f3\u30b0\u30c9\u30e9\u30a4\u30d0](https://docs.docker.com/engine/admin/logging/overview/)\u3068\u3044\u3046\u6a5f\u80fd\u304c\u3042\u308a\n`logs`\u3067\u5f97\u3089\u308c\u308b\u5185\u5bb9\u3092\u3044\u304f\u3064\u304b\u306e\u65b9\u6cd5\u3067\u5916\u90e8\u306b\u51fa\u529b\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n### AWS: CloudWatch Logs\u306e\u6d3b\u7528\n\nDocker\u306f\u524d\u8ff0\u306e\u30ed\u30ae\u30f3\u30b0\u30c9\u30e9\u30a4\u30d0\u306b\u304a\u3044\u3066\n\u516c\u5f0f\u3067[Cloudwatch Logs\u3078\u306e\u51fa\u529b](https://docs.docker.com/engine/admin/logging/awslogs/)\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\n\nEB\u3067\u306f`--log-driver`\u306e\u3088\u3046\u306b`docker run`\u306e\u969b\u306b\u6e21\u3059\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\n[dockerrun.aws.json](http://docs.aws.amazon.com/ja_jp/elasticbeanstalk/latest/dg/create_deploy_docker_v2config.html#create_deploy_docker_v2config_dockerrun)\u3068\u3044\u3046\u72ec\u81ea\u5f62\u5f0f\u306ejson\u306b\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u306e\u30b3\u30f3\u30c6\u30ca\u5b9a\u7fa9\u5f62\u5f0f\u306fECS\u3068\u5171\u901a\u306a\u306e\u3067\n\u30ed\u30b0\u306e\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f[ECS\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](http://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_definition_parameters.html)\u306b\u8a18\u8f09\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\n```javascript:\u30ed\u30ae\u30f3\u30b0\u306e\u8a2d\u5b9a\n\"logConfiguration\": {\n      \"logDriver\": \"json-file\"|\"syslog\"|\"journald\"|\"gelf\"|\"fluentd\"|\"awslogs\",\n      \"options\": {\"string\": \"string\"\n        ...}\n```\n\n`logDriver`\u306b\u3064\u3044\u3066\u306f`awslogs`\u3092\u9078\u629e\u3057\u3066\u554f\u984c\u306a\u3055\u305d\u3046\u3002\n[options](http://docs.aws.amazon.com/AmazonECS/latest/developerguide/using_awslogs.html#d0e13461)\u306b\u306f\u3001`awslogs-region`\u3068`awslogs-group`\u3092\u6307\u5b9a\u3059\u308c\u3070\u3088\u3055\u305d\u3046\u3067\u3059\u3002\n\n\u8a66\u3057\u306b\u4ee5\u4e0b\u306e\u5b9a\u7fa9\u3067nginx\u30b3\u30f3\u30c6\u30ca\u306e\u30ed\u30b0\u3092\u51fa\u529b\u3057\u3066\u307f\u307e\u3059\u3002\n\u516c\u5f0f\u306enginx\u30a4\u30e1\u30fc\u30b8\u3067\u3001\u5185\u5bb9\u306f80\u756a\u30dd\u30fc\u30c8\u3092\u958b\u3051\u3066\u3044\u308b\u3060\u3051\u3067\u3059\u3002\n\n```javascript:Dockerrun.aws.json\n{\n  \"AWSEBDockerrunVersion\": \"2\",\n  \"containerDefinitions\": [\n    {\n      \"name\": \"nginx\",\n      \"image\": \"nginx:1.11.5-alpine\",\n      \"essential\": true,\n      \"memory\": 128,\n      \"portMappings\": [\n        {\n          \"hostPort\": 80,\n          \"containerPort\": 80\n        }\n      ],\n      \"logConfiguration\": {\n        \"logDriver\": \"awslogs\",\n        \"options\": {\n          \"awslogs-region\": \"ap-northeast-1\",\n          \"awslogs-group\": \"nginx-group\"\n        }\n      }\n    }\n  ]\n}\n```\n\n**\u6307\u5b9a\u3057\u305f\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u304cCloudWatch\u5074\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u306a\u3044\u3068\nEB\u306e\u30c7\u30d7\u30ed\u30a4\u3054\u3068\u30b3\u30b1\u308b\u3088\u3046\u306a\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002**\n\n\u30c7\u30d7\u30ed\u30a4\u304c\u6210\u529f\u3059\u308b\u3068\u3001CloudWatch\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3084cli\u3067\u30ed\u30b0\u304c\u898b\u3089\u308c\u307e\u3059\u3002\n\u4f55\u5ea6\u304b\u8e0f\u3093\u3060\u7d50\u679c\u3001\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3068\u30a8\u30e9\u30fc\u30ed\u30b0\u306e\u4e21\u65b9\u304c\u51fa\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\n![awslogs.png](https://qiita-image-store.s3.amazonaws.com/0/43116/5a167128-6ee1-d861-6e32-bb6e6beae0b2.png \"awslogs.png\")\n\n\u3061\u306a\u307f\u306b\u3001STDOUT\u3068STDERR\u3092\u8868\u793a\u3059\u308b\u306f\u305a\u306e`docker logs`\u3067\n\u3053\u308c\u3089\u304c\u898b\u3089\u308c\u308b\u306e\u306f\u516c\u5f0f\u306enginx\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u7528\u3057\u305f\u304b\u3089\u3067\u3059\u3002\nDockerfile\u3092\u898b\u308b\u3068\u3001\u30ed\u30b0\u306e\u51fa\u529b\u5148\u304c\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n```text:Dockerfile\n# forward request and error logs to docker log collector\n&& ln -sf /dev/stdout /var/log/nginx/access.log \\\n&& ln -sf /dev/stderr /var/log/nginx/error.log\n```\n\n`docker logs`\u306e\u96c6\u7d04\u306b\u3064\u3044\u3066\u306f\u3053\u306e\u65b9\u6cd5\u3067\u306a\u3093\u3068\u304b\u306a\u308a\u305d\u3046\u3067\u3059\u3002\nSTDOUT\u3068STDERR\u3092\u5206\u3051\u3089\u308c\u306a\u3044\u306e\u306f\u96e3\u70b9\u3067\u3059\u304c\nDocker\u306eIssue\u3067\u3082\u5c11\u306a\u304b\u3089\u305a[\u8b70\u8ad6](https://github.com/docker/docker/issues/25683)\u304c\u3042\u308b\u306e\u3067\u3001\u3044\u305a\u308c\u6539\u5584\u3055\u308c\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\u3061\u306a\u307f\u306b\u3001[fluentd\u306e\u30ed\u30ae\u30f3\u30b0\u30c9\u30e9\u30a4\u30d0](http://docs.docker.jp/engine/admin/logging/fluentd.html)\u3067\u306f\u5206\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u3002\n\n\u307e\u305f\u3001EB\u3067\u30db\u30b9\u30c8\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\n`/var/log/docker-events.log`\u306a\u3069\u306e\u30ed\u30b0\u304c\u6b8b\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3082\u308f\u304b\u308a\u307e\u3059\u3002\n\u3053\u3061\u3089\u306f\u4e0a\u8a18\u306e\u30ed\u30ae\u30f3\u30b0\u30c9\u30e9\u30a4\u30d0\u3067\u51fa\u529b\u3055\u308c\u306a\u3044\u60c5\u5831\u306a\u306e\u3067\n[.ebextensions](http://docs.aws.amazon.com/ja_jp/elasticbeanstalk/latest/dg/ebextensions.html)\u306a\u3069\u3067\u30db\u30b9\u30c8\u5074\u306b\u30ed\u30b0\u51fa\u529b\u306e\u4ed5\u7d44\u307f\u3092\u4f5c\u308b\u5fc5\u8981\u304c\u3042\u308a\u305d\u3046\u3067\u3059\u3002\n\n## :bar_chart: \u30ea\u30bd\u30fc\u30b9\u76e3\u8996\n\n### Docker: stats\u30b3\u30de\u30f3\u30c9\n\nDocker\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3001\u30b3\u30f3\u30c6\u30ca\u3054\u3068\u306e\u30ea\u30bd\u30fc\u30b9\u4f7f\u7528\u91cf\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\n```shell:\u4f8b\uff1a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068DB\u3092\u8d77\u52d5\u3057\u305f\u72b6\u614b\u3067stats\u30b3\u30de\u30f3\u30c9\n$ docker stats\nCONTAINER           CPU %               MEM USAGE / LIMIT       MEM %               NET I/O             BLOCK I/O             PIDS\na59845048cea        1.02%               39.42 MiB / 1.951 GiB   1.97%               1.038 kB / 648 B    32.77 kB / 0 B        5\nac7470b95cef        0.19%               353.9 MiB / 1.951 GiB   17.72%              1.296 kB / 648 B    4.149 MB / 317.8 MB   27\n```\n\nLinux\u306e`top`\u30b3\u30de\u30f3\u30c9\u306e\u3088\u3046\u306b\u4f7f\u3048\u3066\u308f\u304b\u308a\u3084\u3059\u3044\u306e\u3067\u3059\u304c\n\u96c6\u7d04\u3084\u4fdd\u5b58\u306e\u305f\u3081\u306b\u306f\u3053\u308c\u3067\u306f\u4e0d\u5341\u5206\u3067\u3059\u3002\n\n### AWS: CloudWatch\u30e1\u30c8\u30ea\u30af\u30b9\n\nEB\u3084ECS\u3067\u8907\u6570\u30b3\u30f3\u30c6\u30ca\u3092\u6271\u3046\u5834\u5408\u306f\nECS\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30af\u30e9\u30b9\u30bf\u5358\u4f4d\u3067\u306f\u4ee5\u4e0b\u306e[4\u3064\u306e\u30e1\u30c8\u30ea\u30af\u30b9](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/monitoring/ecs-metricscollected.html)\u304c\u898b\u3048\u307e\u3059\u3002\n\n![metrics.png](https://qiita-image-store.s3.amazonaws.com/0/43116/c51732c0-0188-394f-5bcb-93a67ff2d5f5.png \"metrics.png\")\n\nECS\u3067\u8a00\u3046\u30b5\u30fc\u30d3\u30b9\u306e\u5358\u4f4d\u3067\u306f\u3001\u4ee5\u4e0b\u306e2\u3064\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u307f\u3067\u3057\u305f\u3002\n\n![service.png](https://qiita-image-store.s3.amazonaws.com/0/43116/4e438f27-c135-bca3-90d4-a4d52d67d1a1.png \"service.png\")\n\n\u3061\u306a\u307f\u306bEB\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u306f\n\u30b3\u30f3\u30c6\u30ca\u3067\u306f\u306a\u3044\u901a\u5e38\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u76e3\u8996\u3068\u7279\u306b\u5909\u308f\u308a\u307e\u305b\u3093\u3002\n\n![eb.png](https://qiita-image-store.s3.amazonaws.com/0/43116/7b6fb7dd-aa58-59fa-74ae-17a997d2325f.png \"eb.png\")\n\n\n\u898b\u6163\u308c\u305fCloudWatch\u306e\u5f62\u5f0f\u3067\u898b\u3089\u308c\u308b\u306e\u306f\u3042\u308a\u304c\u305f\u3044\u306e\u3067\u3059\u304c\n\u30b3\u30f3\u30c6\u30ca\u3054\u3068\u306e\u4f7f\u7528\u30ea\u30bd\u30fc\u30b9\u306a\u3069\u3001\u3082\u3046\u5c11\u3057\u7d30\u304b\u3044\u90e8\u5206\u304c\u6c17\u306b\u306a\u308a\u307e\u3059\u3002\n\n### \u30b5\u30fc\u30c9\u30d1\u30fc\u30c6\u30a3\u306e\u30b5\u30fc\u30d3\u30b9/\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306b\u983c\u308b\n\n[cAdvisor](https://github.com/google/cadvisor)\u3084[ELK\u30b9\u30bf\u30c3\u30af](https://www.elastic.co/jp/webinars/introduction-elk-stack)\u306a\u3069\u306e\u30bd\u30d5\u30c8\u3092\u6d3b\u7528\u3057\u305f\u30e1\u30c8\u30ea\u30af\u30b9\u53ce\u96c6\u3084\n\u30d5\u30eb\u30b9\u30bf\u30c3\u30af\u306a\u6709\u6599\u30b5\u30fc\u30d3\u30b9\u306e\u6d3b\u7528\u306a\u3069\u3001\u8ffd\u52a0\u306e\u9078\u629e\u80a2\u306f\u591a\u304f\u5b58\u5728\u3057\u307e\u3059\u3002\n\u81ea\u90e8\u7f72\u3067\u306f\u76e3\u8996\u9818\u57df\u3067\u5168\u822c\u7684\u306b[Mackerel](https://mackerel.io)\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u305f\u3081\n\u30b3\u30f3\u30c6\u30ca\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u53ef\u8996\u5316\u3082\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\nMackerel\u3067\u306fagent\u3092\u4f7f\u7528\u3057\u3066\u30e1\u30c8\u30ea\u30af\u30b9\u60c5\u5831\u3092\u9001\u4fe1\u3057\u307e\u3059\u304c\n\u30b3\u30f3\u30c6\u30ca\u306e\u304b\u305f\u3061\u3067\u76e3\u8996\u3092\u884c\u3046[mackerel-agent](https://hub.docker.com/r/mackerel/mackerel-agent/)\u3082\u516c\u5f0f\u3067\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u3067\u3001\u4e00\u7dd2\u306b\u8d77\u52d5\u3057\u3066\u3044\u308b\u30b3\u30f3\u30c6\u30ca\u3068\u30db\u30b9\u30c8\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u76e3\u8996\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u5185\u3067\u306f`docker run`\u306e\u5f15\u6570\u3068\u3057\u3066\u66f8\u304b\u308c\u3066\u3044\u308b\u90e8\u5206\u3092\nDockerrun.aws.json\u306b\u843d\u3068\u3057\u8fbc\u3093\u3067\u307f\u307e\u3059\u3002\n\n```javascript:Dockerrun.aws.json\n{                                                                                     \n  \"AWSEBDockerrunVersion\": \"2\",                                                       \n  \"volumes\": [                                                                        \n    {                                                                                 \n      \"name\": \"docker-sock\",                                                          \n      \"host\": {                                                                       \n        \"sourcePath\": \"/var/run/docker.sock\"                                          \n      }                                                                               \n    },                                                                                \n    {                                                                                 \n      \"name\": \"lib-mackerel-agent\",                                                   \n      \"host\": {                                                                       \n        \"sourcePath\": \"/var/lib/mackerel-agent\"                                       \n      }                                                                               \n    }                                                                                 \n  ],                                                                                  \n  \"containerDefinitions\": [                                                           \n    {\n      \"nginx\u30b3\u30f3\u30c6\u30ca\u306e\u8a2d\u5b9a\u306f\": \"\u7701\u7565\"\n    },\n    {\n      \"name\": \"mackerel-agent\",                                                       \n      \"image\": \"mackerel/mackerel-agent\",                                             \n      \"environment\": [                                                                \n        { \"name\": \"apikey\", \"value\": \"Hoge8noPEnZj9HogeMEwnHogep5aMQzKMHogee7ZHoge\" },\n        { \"name\": \"enable_docker_plugin\", \"value\": true },                            \n        { \"name\": \"auto_retirement\", \"value\": true }                                  \n      ],                  \n      \"essential\": true,                            \n      \"memory\": 128,                                                                         \n      \"mountPoints\": [                              \n        {                                           \n          \"sourceVolume\": \"docker-sock\",            \n          \"containerPath\": \"/var/run/docker.sock\"   \n        },                                          \n        {                                           \n          \"sourceVolume\": \"lib-mackerel-agent\",     \n          \"containerPath\": \"/var/lib/mackerel-agent\"\n        }                                           \n      ]                                             \n    }                                               \n  ]                                                 \n}                                                                                                               \n```\n\nmackerel-agent\u30b3\u30f3\u30c6\u30ca\u306b\u306f\n\u30b5\u30fc\u30d3\u30b9\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306bapikey\u306a\u3069\u306e\u74b0\u5883\u5909\u6570\u3092\u6e21\u3057\u3066\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001\u30e1\u30c8\u30ea\u30af\u30b9\u30c7\u30fc\u30bf\u306e\u3084\u308a\u3068\u308a\u306e\u305f\u3081\u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u30de\u30a6\u30f3\u30c8\u304c\u5fc5\u9808\u3067\u3059\u3002\n\n\u4e0a\u8a18\u306eDockerrun.aws.json\u304b\u3089\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u305f\u7d50\u679c\nMackerel\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u3067\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u95b2\u89a7\u3067\u304d\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u306e\u30b0\u30e9\u30d5\u306f\u30db\u30b9\u30c8\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f7f\u7528\u30e1\u30e2\u30ea\u3092\u793a\u3057\u307e\u3059\u3002\n\n![memory.png](https://qiita-image-store.s3.amazonaws.com/0/43116/2009ee77-e166-196a-0711-4096af130da9.png \"memory.png\")\n\n\u30e1\u30e2\u30ea\u4ee5\u5916\u306b\u3082loadaverate\u3001cpu\u3001diskio\u306a\u3069\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u898b\u3089\u308c\u307e\u3059\u3002\n\n\u3055\u3089\u306b\u3001`{ \"name\": \"enable_docker_plugin\", \"value\": true }`\u306e\u8a2d\u5b9a\u306b\u3088\u308a\n\u8d77\u52d5\u3057\u3066\u3044\u308b\u30b3\u30f3\u30c6\u30ca\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3082\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u306e\u30b0\u30e9\u30d5\u306f **\u5404\u30b3\u30f3\u30c6\u30ca** \u306e\u4f7f\u7528\u30e1\u30e2\u30ea\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002\n\n![docker_memory.png](https://qiita-image-store.s3.amazonaws.com/0/43116/de1ef2f4-98eb-a4c6-805d-e4de5e9c4ecb.png \"docker_memory.png\")\n\n\u52dd\u624b\u306b\u8d77\u52d5\u3059\u308becs-agent\u3092\u542b\u3081\u3066\u30013\u3064\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u3053\u308c\u306b\u52a0\u3048\u3066BlkIO Bytes\u3001BlkIO IOPS\u3001CPU\u306e4\u7a2e\u985e\u304c\u95b2\u89a7\u53ef\u80fd\u3067\n\u305d\u308c\u305e\u308c\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u8d77\u70b9\u3068\u3057\u305f\u30a2\u30e9\u30fc\u30c8\u3082\u98db\u3070\u305b\u308b\u305f\u3081\n\u304b\u306a\u308a\u67d4\u8edf\u306b\u76e3\u8996\u5bfe\u5fdc\u304c\u3067\u304d\u307e\u3059\u3002\n\nCloudWatch\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3060\u3051\u3067\u306f\u304b\u3086\u3044\u3068\u3053\u308d\u306b\u624b\u304c\u5c4a\u304b\u306a\u3044\u305f\u3081\nMackerel\u306b\u9650\u3089\u305a\u3001\u76e3\u8996\u5c02\u7528\u306e\u30bd\u30ea\u30e5\u30fc\u30b7\u30e7\u30f3\u306f\u4f7f\u3063\u305f\u65b9\u304c\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n## :end: \u307e\u3068\u3081\n\n\u30b3\u30f3\u30c6\u30ca\u306f\u901a\u5e38\u306e\u30b5\u30fc\u30d0\u904b\u7528\u3068\u6bd4\u3079\u3066\u6c38\u7d9a\u6027\u304c\u306a\u3044\u305f\u3081\n\u30ed\u30b0\u3084\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u96c6\u7d04\u3057\u3001\u6b8b\u3057\u3066\u3044\u304f\u3053\u3068\u306f\u7279\u306b\u91cd\u8981\u3060\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u3002\n\u3082\u3063\u3068\u76e3\u8996\u304c\u7c21\u5358\u306b\u306a\u3063\u3066\u3001\u5c0e\u5165\u306e\u969c\u58c1\u304c\u306a\u304f\u306a\u308c\u3070\u826f\u3044\u3067\u3059\u306d\u3002\n", "tags": ["AWS", "docker", "Mackerel", "ElasticBeanstalk"]}