{"context": "\n\n\u6982\u8981\n\u30b5\u30fc\u30d0\u69cb\u7bc9\u306b\u6163\u308c\u3088\u3046\u3068\u601d\u3063\u3066AWS\u306eEC2\u3092\u5229\u7528\u3057\u3066Ubuntu, php7.0, php-fpm, nginx\u306e\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u307e\u3057\u305f\nOS:\n\u3000\u3000\u3000\u3000Linux version 4.4.0-62-generic (buildd@lcy01-30) (gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.4) ) #83-Ubuntu SMP Wed Jan 18 14:10:15 UTC 2017\nphp(php-fpm):\n\u3000\u3000\u3000\u3000PHP 7.0.15-1+deb.sury.org~xenial+1 (cli) (built: Jan 20 2017 08:53:13) ( NTS )\nnginx:\n\u3000\u3000\u3000\u3000nginx version: nginx/1.10.0 (Ubuntu)\n\n\u53c2\u8003\u306b\u3057\u305f\u3082\u306e\u306f\u4ee5\u4e0b\u306e\uff12\u3064\u306eqiita\n\u7c21\u6f54\u306a\u3082\u306e\u3068\u3001\u8a73\u7d30\u306a\u3082\u306e\u3068\u3044\u3046\u611f\u3058\nnginx \u3068 PHP-FPM \u306e\u4ed5\u7d44\u307f\u3092\u3061\u3083\u3093\u3068\u7406\u89e3\u3057\u306a\u304c\u3089 PHP \u306e\u5b9f\u884c\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\nEC2\u306bnginx+php(php-fpm socket)\u74b0\u5883\u3092\u6700\u901f\u3067\u69cb\u7bc9\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\nAWS\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u4eca\u56de\u306fUbuntu\u3067\u306e\u74b0\u5883\u69cb\u7bc9\u3067\u3059\u3002\nAWS\u306e\u30b5\u30a4\u30c8\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u3068\u81ea\u5206\u306ePC\u306b\u306fpem\u30d5\u30a1\u30a4\u30eb(\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30ad\u30fc\u30d5\u30a1\u30a4\u30eb)\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\u3053\u308c\u3092\u4f7f\u3063\u3066SSH\u63a5\u7d9a\u304c\u53ef\u80fd\u3067\u3059\u3002\uff08hoge\u306e\u90e8\u5206\u306f\u81ea\u5206\u3067\u8a2d\u5b9a\u3057\u305f\u3082\u306e\u306b\u306a\u308a\u307e\u3059\uff09\nssh -i \"hoge.pem\" ubuntu@ec2-XX-XXX-XX-XXX.us-west-2.compute.amazonaws.com\n\uff08AWS\u306e\u30b5\u30a4\u30c8\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30c8\u63a5\u7d9a\u306e\u30da\u30fc\u30b8\u3092\u958b\u304f\u3068\u3001\u30b3\u30de\u30f3\u30c9\u306f\u7528\u610f\u3057\u3066\u304f\u308c\u3066\u307e\u3059\uff09\n\u3061\u306a\u306b\u307f\u50d5\u306f\u305d\u306e\u307e\u307e\u3084\u3063\u305f\u3089.pem.txt\u306e\u62e1\u5f35\u5b50\u306b\u306a\u3063\u305f\u306e\u3067\"hoge.pem.txt\"\u3092\u6307\u5b9a\u3057\u3066\u305d\u306e\u307e\u307e\u4f7f\u3063\u3066\u307e\u3059\u3002\n\n\u203b\u30cf\u30de\u308a\u30dd\u30a4\u30f3\u30c8\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306b\u81ea\u5206\u306eIP\u30a2\u30c9\u30ec\u30b9\u304b\u3089\u306eSSH\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3057\u3066\u4e0a\u3052\u306a\u3044\u3068\u3044\u3051\u306a\u3044\n\u30a4\u30f3\u30d0\u30a6\u30f3\u30c9\u306e\u300c\u7de8\u96c6\u300d\u304b\u3089\u3001\u300c\u30eb\u30fc\u30eb\u306e\u8ffd\u52a0\u300d\u3092\u3057\u3066\u3042\u3052\u308b\nSSH(port22)\u3068HTTP(port80)\u3092\u8a2d\u5b9a\u3044\u3057\u3001\u9001\u4fe1\u5143\u3092\u201d\u30de\u30a4IP\u201d\u306b\u3059\u308b\n\u8907\u6570\u306e\u767b\u9332\u3082\u53ef\u80fd\u3067\u3042\u308b\n\n\n\u521d\u671f\u8a2d\u5b9a\n\u30b5\u30fc\u30d0\u3067\u57fa\u672c\u7684\u306a\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\u521d\u671f\u8a2d\u5b9a\u306fEC2\u306b\u9650\u3063\u305f\u3082\u306e\u3067\u306f\u306a\u3044\u3067\u3059\u3002\n\u521d\u56de\u30ed\u30b0\u30a4\u30f3\u3092\u3059\u308b\u3068\u3001ubuntu\u30e6\u30fc\u30b6\u306b\u306a\u3063\u3066\u307e\u3059\u3002\n\nroot\u30ed\u30b0\u30a4\u30f3\u306e\u7981\u6b62\u3001\u30dd\u30fc\u30c8\u5909\u66f4\nubuntu@ip-XXX-XX-XX-XXX:~$ sudo vim /etc/ssh/sshd_config\n\u4e8c\u7b87\u6240\u5909\u66f4\u3059\u308b\n# What ports, IPs and protocols we listen for\n- Port 22\n+ Port 50022\n...\n# Authentication:\nLoginGraceTime 120\n- PermitRootLogin prohibit-password\n+ PermitRootLogin no\nStrictModes yes\n\n\n\u203b\u30cf\u30de\u308a\u30dd\u30a4\u30f3\u30c8\n\u3053\u3053\u3067\u30dd\u30fc\u30c8\u3092\u5909\u66f4\u3057\u305f\u3089AWS\u306e\u30b5\u30a4\u30c8\u3067\u3082\u3046\u4e00\u5ea6\u30bb\u30ad\u30e5\u30ea\u30b0\u30eb\u30fc\u30d7\u306e\u8a2d\u5b9a\u304c\u5fc5\u8981\u3067\u3059\n\u30bf\u30a4\u30d7\u3092\u300c\u30ab\u30b9\u30bf\u30e0TCP\u300d\u306b\u8a2d\u5b9a\u3001\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u4efb\u610f\u306e\u3082\u306e\u306b\u3057\u307e\u3059\n\n\n\u4f5c\u696d\u30e6\u30fc\u30b6\u4f5c\u6210\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u8a2d\u5b9a\nubuntu@ip-XXX-XX-XX-XXX:~$ sudo useradd sasaki\nubuntu@ip-XXX-XX-XX-XXX\n:~$ sudo passwd sasaki\nEnter new UNIX password:\nRetype new UNIX password:\npasswd: password updated successfully\n\nubuntu\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u521d\u671f\u30e6\u30fc\u30b6\u306a\u306e\u3067\u3001\u4f5c\u696d\u7528\u30e6\u30fc\u30b6\u3067\u30ed\u30b0\u30a4\u30f3\u304c\u3067\u304d\u305f\u3089ubuntu\u3055\u3093\u306f\u524a\u9664\u3057\u3061\u3083\u3063\u3066\u3044\u3044\u3068\u601d\u3044\u307e\u3059\n\nphp-fpm\u3068nginx\u306e\u5c0e\u5165\napt-get\u3092\u7528\u3044\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u304d\u307e\u3059\nMySQL\u304c\u5fc5\u8981\u306a\u4eba\u306f\u3053\u3053\u3067$ sudo apt-get install php7.0-mysql\u3082\u53e9\u3044\u3066\u3042\u3052\u307e\u3057\u3087\u3046\n$ sudo apt-get install php7.0-fpm\n$ sudo apt-get install php7.0\n$ sudo apt-get install nginx\n\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n$ sudo php-fpm7.0 -v\nPHP 7.0.15-1+deb.sury.org~xenial+1 (fpm-fcgi) (built: Jan 20 2017 08:53:13)\nCopyright (c) 1997-2017 The PHP Group\nZend Engine v3.0.0, Copyright (c) 1998-2017 Zend Technologies\n    with Zend OPcache v7.0.15-1+deb.sury.org~xenial+1, Copyright (c) 1999-2017, by Zend Technologies\n$ sudo nginx -v\nnginx version: nginx/1.10.0 (Ubuntu)\n\n\nphp-fpm\u3068nginx\u306e\u8a2d\u5b9a\n\u307e\u305a\u306fphp-fpm\u304b\u3089\u3001\u6b21\u306bnginx\u3084\u308a\u307e\u3057\u305f\nphp-fpm\u3068nginx\u9593\u306e\u3084\u308a\u53d6\u308a\u306fTCP\u3092\u7528\u3044\u308b\u65b9\u6cd5\u3068UNIX\u30c9\u30e1\u30a4\u30f3\u30bd\u30b1\u30c3\u30c8\u3092\u7528\u3044\u308b\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\n\u4eca\u56de\u306f\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u306e\u512a\u308c\u3066\u3044\u308bUNIX\u30c9\u30e1\u30a4\u30f3\u30bd\u30b1\u30c3\u30c8\u3067\u306e\u901a\u4fe1\u3092\u7528\u3044\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\n\nphp-fpm\n$ vi /etc/php/7.0/fpm/pool.d/www.conf\nnginx\u3068\u540c\u3058\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u305f\u3081user\u3068group\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304f\u3001\u4eca\u56de\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306fwww-data\n\n/etc/php/7.0/fpm/pool.d/www.conf\nuser = www-data\ngroup = www-data\n\n\nUNIX\u30c9\u30e1\u30a4\u30f3\u30bd\u30b1\u30c3\u30c8\u3092\u7528\u3044\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u3092\u884c\u3046\n127.0.0.1:9000\u306fTCP\u7528\u306e\u8a2d\u5b9a\n\n/etc/php/7.0/fpm/pool.d/www.conf\n- listen = 127.0.0.1:9000\n+ listen =  /var/run/php-fpm/php-fpm.sock\n\n\n\n\u203b\u30cf\u30de\u308a\u30dd\u30a4\u30f3\u30c8\n\u30e6\u30fc\u30b6\u540d\u3001\u30b0\u30eb\u30fc\u30d7\u540d\u3001listen\u306e\u5185\u5bb9\u306fphp-fpm\u3068\u63c3\u3048\u308b\nphp-fpm\u3068nginx\u9593\u306e\u63a5\u7d9a\u304c\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u5834\u5408\u3053\u3053\u304c\u9593\u9055\u3063\u3066\u308b\u53ef\u80fd\u6027\u3092\u7591\u3046\n\n\nnginx\nphp-fpm\u3068\u540c\u3058\u3088\u3046\u306b\u30e6\u30fc\u30b6\u540d\u3092\u78ba\u8a8d\u3059\u308b\n\u4e00\u756a\u4e0a\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\n\n/etc/nginx/nginx.conf\nuser www-data;\n\n\n/etc/nginx/conf.d\u304c\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3001\u3053\u3053\u3067\u306fconf.d/*.conf\u3092\u8aad\u307f\u8fbc\u3080\u7528\u8a2d\u5b9a\u3057\u3066\u3042\u308b\u305f\u3081fpm\u3068\u306e\u8a2d\u5b9a\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u3053\u3053\u306b\u4f5c\u6210\u3059\u308b\n# vi /etc/nginx/conf.d/server.conf\n\nfastcgi_pass\u306b\u8a18\u8f09\u3059\u308b\u5185\u5bb9\u304cphp-fpm\u5074\u306e\u8a2d\u5b9a\u306elisten\u306b\u5bfe\u5fdc\u3059\u308b\n\n/etc/nginx/conf.d/server.conf\n\nserver {\n        listen 80;\n        root /var/www/html;\n        index index.php index.html index.htm;\n        server_name localhost;\n\n        location / {\n                if (-f $request_filename) {\n                        expires 30d;\n                        break;\n                }\n        }\n\n        location ~ [^/]\\.php(/|$) {\n                fastcgi_split_path_info ^(.+\\.php)(/.+)$;\n                if (!-f $document_root$fastcgi_script_name) {\n                        return 404;\n                }\n                fastcgi_pass unix:/var/run/php/php7.0-fpm.sock;\n                fastcgi_index index.php;\n                fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n                fastcgi_param PATH_INFO $fastcgi_path_info;\n                fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;\n                include fastcgi_params;\n        }\n}\n\n\n\u307e\u305f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067include\u3055\u308c\u3066\u3044\u308bsites-enabled\u3092\u547c\u3070\u306a\u3044\u3088\u3046\u306b\u3059\u308b\n\n/etc/nginx/nginx.conf\n#include /etc/nginx/sites-enabled/*;\n\n\n\n\u203b\u30cf\u30de\u308a\u30dd\u30a4\u30f3\u30c8\ninclude /etc/nginx/sites-enabled/*\u304c\u884c\u308f\u308c\u308b\u3068\u4eca\u4f5c\u6210\u3057\u305fphp-fpm\u3068\u306e\u63a5\u7d9a\u306e\u8a2d\u5b9a\u304c\u52b9\u304b\u306a\u304f\u306a\u308b\n\u50d5\u306fphp\u30d5\u30a1\u30a4\u30eb\u304c\u305d\u306e\u307e\u307e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u305f\u3068\u3053\u308d\u3067\u3057\u3070\u3089\u304f\u8a70\u307e\u3063\u305f\u3001\u3053\u308c\u304c\u539f\u56e0\u3060\u3063\u305f\n\n\n\u8d77\u52d5\n$ sudo service php7.0-fpm start\n$ sudo service nginx start\n\n\u8d77\u52d5\u3059\u308b\u3068php-fpm\u306esocket\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u306f\u305a\u3067\u3042\u308b\n$ cat /var/run/php/php7.0-fpm.sock\n\n\u203b\u30cf\u30de\u308a\u30dd\u30a4\u30f3\u30c8\n\u3053\u308c\u3089\u306e\u8a2d\u5b9a\u3092\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3057\u305f\u3089restart\u53ca\u3073reload\u3092\u3057\u306a\u3044\u3068\u5909\u66f4\u306f\u53cd\u6620\u3055\u308c\u306a\u3044\n\u610f\u5916\u3068\u3001\u7d50\u69cb\u5fd8\u308c\u304c\u3061\u306a\u306e\u3067\u6ce8\u610f\u3059\u308b\nsudo service php7.0-fpm reload\nsudo service nginx reload\n\n\nUNIX\u30c9\u30e1\u30a4\u30f3\u30bd\u30b1\u30c3\u30c8\u306b\u3088\u308b\u901a\u4fe1\u304c\u3067\u304d\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\n$ netstat -a --unix\n...\nunix  2      [ ACC ]     STREAM     LISTENING     490025   /var/run/php/php7.0-fpm.sock\n...\n\n\n\u8868\u793a\u3092\u78ba\u8a8d\u3059\u308b\nserver.conf\u306b\u8a2d\u5b9a\u3057\u305f\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u9069\u5f53\u306aphp\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u304f\n\n/var/www/html/hoge.php\n<?php\n  echo 'Hello, php-fpm.'\n\n\n\u30d6\u30e9\u30a6\u30b6\u3067\u78ba\u8a8d\u3059\u308b\u3001\u5272\u308a\u632f\u3089\u308c\u305f\u30d1\u30d6\u30ea\u30c3\u30afIP\u306b\u30a2\u30af\u30bb\u30b9\nhttp://XX.XXX.XX.XXX/hoge.php\n\u3053\u308c\u3067\u300cHello, php-fpm.\u300d\u304c\u78ba\u8a8d\u3067\u304d\u308c\u3070\u8a2d\u5b9a\u306f\u5b8c\u4e86\u3001\u304a\u75b2\u308c\u69d8\u3067\u3057\u305f\u3002\n\n\u56f0\u3063\u305f\u3089\n\n\u30ed\u30b0\u3092\u898b\u308b\n\n/etc/nginx/nginx.conf\naccess_log /var/log/nginx/access.log;\n- error_log /var/log/nginx/error.log;\n+ error_log /var/log/nginx/error.log debug;\n\n\n\u3053\u308c\u3067\u30a8\u30e9\u30fc\u30ed\u30b0\u304c\u30c7\u30d0\u30c3\u30b0\u7528\u306b\u8272\u3005\u66f8\u3044\u3066\u304f\u308c\u308b\u3088\u3046\u306b\u306a\u308b\n\nnetstat\u30b3\u30de\u30f3\u30c9\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3067\u304d\u308b\n$ netstat -a --unix\n...\nunix  2      [ ACC ]     STREAM     LISTENING     490025   /var/run/php/php7.0-fpm.sock\n...\n\n\n\u3042\u3068\u304c\u304d\nAWS\u3082\u521d\u3081\u3066\u5229\u7528\u3059\u308b\u5834\u5408\u306f\u6238\u60d1\u3046\u3068\u3053\u308d\u304c\u3042\u308b\u3001\u5c11\u3057\u5b66\u3076\u6642\u9593\u304c\u5fc5\u8981\u3060\u3068\u601d\u3063\u3068\u3044\u305f\u65b9\u304c\u3044\u3044\u3002\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u4e0b\u308a\u3082\u898b\u3064\u3051\u308b\u306e\u6642\u9593\u304b\u304b\u3063\u305f\u3002\n\u8a2d\u5b9a\u304c\u30b0\u30c1\u30e3\u30b0\u30c1\u30e3\u3057\u3066\u6765\u305f\u3089\u6bba\u3057\u3066\u65b0\u3057\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7acb\u3066\u3066\u3084\u308a\u76f4\u3057\u305f\u65b9\u304c\u65e9\u305d\u3046\u3002\nrestart\u3057\u3066\u304f\u308c\u306a\u3044\u3001\u307f\u305f\u3044\u306a\u3053\u3068\u3082\u8d77\u3053\u3063\u305f\n$ sudo service nginx restart\nJob for nginx.service failed because the control process exited with error code. See \"systemctl status nginx.service\" and \"journalctl -xe\" for details.\n\n\u8a00\u308f\u308c\u305f\u901a\u308a\u306b\"systemctl status nginx.service\" and \"journalctl -xe\"\u3092\u898b\u306b\u884c\u304f\u3068\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306esyntax\u30a8\u30e9\u30fc\u3060\u3063\u305f\u308a\u3057\u305f\u3002\n\u4e00\u756a\u8a70\u307e\u3063\u305f\u306e\u306f\u4f55\u3088\u308ainclude /etc/nginx/sites-enabled/*\n\u4f55\u5ea6\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3057\u3066\u3082php\u30d5\u30a1\u30a4\u30eb\u304c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u308b\u3060\u3051\u3067\u9032\u3081\u306a\u304b\u3063\u305f\u3057\u3001\u30a8\u30e9\u30fc\u30ed\u30b0\u3067\u3082\u308f\u304b\u308a\u3065\u3089\u3044\n## \u6982\u8981\n\n\u30b5\u30fc\u30d0\u69cb\u7bc9\u306b\u6163\u308c\u3088\u3046\u3068\u601d\u3063\u3066AWS\u306eEC2\u3092\u5229\u7528\u3057\u3066Ubuntu, php7.0, php-fpm, nginx\u306e\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u307e\u3057\u305f\n\n```\nOS:\n\u3000\u3000\u3000\u3000Linux version 4.4.0-62-generic (buildd@lcy01-30) (gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.4) ) #83-Ubuntu SMP Wed Jan 18 14:10:15 UTC 2017\nphp(php-fpm):\n\u3000\u3000\u3000\u3000PHP 7.0.15-1+deb.sury.org~xenial+1 (cli) (built: Jan 20 2017 08:53:13) ( NTS )\nnginx:\n\u3000\u3000\u3000\u3000nginx version: nginx/1.10.0 (Ubuntu)\n```\n\n\u53c2\u8003\u306b\u3057\u305f\u3082\u306e\u306f\u4ee5\u4e0b\u306e\uff12\u3064\u306eqiita\n\u7c21\u6f54\u306a\u3082\u306e\u3068\u3001\u8a73\u7d30\u306a\u3082\u306e\u3068\u3044\u3046\u611f\u3058\n\n[nginx \u3068 PHP-FPM \u306e\u4ed5\u7d44\u307f\u3092\u3061\u3083\u3093\u3068\u7406\u89e3\u3057\u306a\u304c\u3089 PHP \u306e\u5b9f\u884c\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b](http://qiita.com/kotarella1110/items/634f6fafeb33ae0f51dc)\n[EC2\u306bnginx+php(php-fpm socket)\u74b0\u5883\u3092\u6700\u901f\u3067\u69cb\u7bc9](http://qiita.com/koni/items/05158e33b4c8aac07b59)\n\n\n## EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\n\nAWS\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u4eca\u56de\u306fUbuntu\u3067\u306e\u74b0\u5883\u69cb\u7bc9\u3067\u3059\u3002\nAWS\u306e\u30b5\u30a4\u30c8\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u3068\u81ea\u5206\u306ePC\u306b\u306fpem\u30d5\u30a1\u30a4\u30eb(\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30ad\u30fc\u30d5\u30a1\u30a4\u30eb)\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\u3053\u308c\u3092\u4f7f\u3063\u3066SSH\u63a5\u7d9a\u304c\u53ef\u80fd\u3067\u3059\u3002\uff08hoge\u306e\u90e8\u5206\u306f\u81ea\u5206\u3067\u8a2d\u5b9a\u3057\u305f\u3082\u306e\u306b\u306a\u308a\u307e\u3059\uff09\n\n`ssh -i \"hoge.pem\" ubuntu@ec2-XX-XXX-XX-XXX.us-west-2.compute.amazonaws.com`\n\uff08AWS\u306e\u30b5\u30a4\u30c8\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30c8\u63a5\u7d9a\u306e\u30da\u30fc\u30b8\u3092\u958b\u304f\u3068\u3001\u30b3\u30de\u30f3\u30c9\u306f\u7528\u610f\u3057\u3066\u304f\u308c\u3066\u307e\u3059\uff09\n\n\u3061\u306a\u306b\u307f\u50d5\u306f\u305d\u306e\u307e\u307e\u3084\u3063\u305f\u3089.pem.txt\u306e\u62e1\u5f35\u5b50\u306b\u306a\u3063\u305f\u306e\u3067\"hoge.pem.txt\"\u3092\u6307\u5b9a\u3057\u3066\u305d\u306e\u307e\u307e\u4f7f\u3063\u3066\u307e\u3059\u3002\n\n > __\u203b\u30cf\u30de\u308a\u30dd\u30a4\u30f3\u30c8__\n > \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306b\u81ea\u5206\u306eIP\u30a2\u30c9\u30ec\u30b9\u304b\u3089\u306eSSH\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3057\u3066\u4e0a\u3052\u306a\u3044\u3068\u3044\u3051\u306a\u3044\n > \u30a4\u30f3\u30d0\u30a6\u30f3\u30c9\u306e\u300c\u7de8\u96c6\u300d\u304b\u3089\u3001\u300c\u30eb\u30fc\u30eb\u306e\u8ffd\u52a0\u300d\u3092\u3057\u3066\u3042\u3052\u308b\n > SSH(port22)\u3068HTTP(port80)\u3092\u8a2d\u5b9a\u3044\u3057\u3001\u9001\u4fe1\u5143\u3092\u201d\u30de\u30a4IP\u201d\u306b\u3059\u308b\n > \u8907\u6570\u306e\u767b\u9332\u3082\u53ef\u80fd\u3067\u3042\u308b\n\n## \u521d\u671f\u8a2d\u5b9a\n\n\u30b5\u30fc\u30d0\u3067\u57fa\u672c\u7684\u306a\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\u521d\u671f\u8a2d\u5b9a\u306fEC2\u306b\u9650\u3063\u305f\u3082\u306e\u3067\u306f\u306a\u3044\u3067\u3059\u3002\n\u521d\u56de\u30ed\u30b0\u30a4\u30f3\u3092\u3059\u308b\u3068\u3001ubuntu\u30e6\u30fc\u30b6\u306b\u306a\u3063\u3066\u307e\u3059\u3002\n\n#### root\u30ed\u30b0\u30a4\u30f3\u306e\u7981\u6b62\u3001\u30dd\u30fc\u30c8\u5909\u66f4\n\n`ubuntu@ip-XXX-XX-XX-XXX:~$ sudo vim /etc/ssh/sshd_config`\n\n\u4e8c\u7b87\u6240\u5909\u66f4\u3059\u308b\n\n```\n# What ports, IPs and protocols we listen for\n- Port 22\n+ Port 50022\n...\n# Authentication:\nLoginGraceTime 120\n- PermitRootLogin prohibit-password\n+ PermitRootLogin no\nStrictModes yes\n```\n\n > __\u203b\u30cf\u30de\u308a\u30dd\u30a4\u30f3\u30c8__\n > \u3053\u3053\u3067\u30dd\u30fc\u30c8\u3092\u5909\u66f4\u3057\u305f\u3089AWS\u306e\u30b5\u30a4\u30c8\u3067\u3082\u3046\u4e00\u5ea6\u30bb\u30ad\u30e5\u30ea\u30b0\u30eb\u30fc\u30d7\u306e\u8a2d\u5b9a\u304c\u5fc5\u8981\u3067\u3059\n > \u30bf\u30a4\u30d7\u3092\u300c\u30ab\u30b9\u30bf\u30e0TCP\u300d\u306b\u8a2d\u5b9a\u3001\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u4efb\u610f\u306e\u3082\u306e\u306b\u3057\u307e\u3059\n\n## \u4f5c\u696d\u30e6\u30fc\u30b6\u4f5c\u6210\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u8a2d\u5b9a\n\n```\nubuntu@ip-XXX-XX-XX-XXX:~$ sudo useradd sasaki\nubuntu@ip-XXX-XX-XX-XXX\n:~$ sudo passwd sasaki\nEnter new UNIX password:\nRetype new UNIX password:\npasswd: password updated successfully\n```\n\nubuntu\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u521d\u671f\u30e6\u30fc\u30b6\u306a\u306e\u3067\u3001\u4f5c\u696d\u7528\u30e6\u30fc\u30b6\u3067\u30ed\u30b0\u30a4\u30f3\u304c\u3067\u304d\u305f\u3089ubuntu\u3055\u3093\u306f\u524a\u9664\u3057\u3061\u3083\u3063\u3066\u3044\u3044\u3068\u601d\u3044\u307e\u3059\n\n## php-fpm\u3068nginx\u306e\u5c0e\u5165\n\napt-get\u3092\u7528\u3044\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u304d\u307e\u3059\nMySQL\u304c\u5fc5\u8981\u306a\u4eba\u306f\u3053\u3053\u3067`$ sudo apt-get install php7.0-mysql`\u3082\u53e9\u3044\u3066\u3042\u3052\u307e\u3057\u3087\u3046\n\n```\n$ sudo apt-get install php7.0-fpm\n$ sudo apt-get install php7.0\n$ sudo apt-get install nginx\n```\n\n#### \u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n\n\n```\n$ sudo php-fpm7.0 -v\nPHP 7.0.15-1+deb.sury.org~xenial+1 (fpm-fcgi) (built: Jan 20 2017 08:53:13)\nCopyright (c) 1997-2017 The PHP Group\nZend Engine v3.0.0, Copyright (c) 1998-2017 Zend Technologies\n    with Zend OPcache v7.0.15-1+deb.sury.org~xenial+1, Copyright (c) 1999-2017, by Zend Technologies\n$ sudo nginx -v\nnginx version: nginx/1.10.0 (Ubuntu)\n```\n\n## php-fpm\u3068nginx\u306e\u8a2d\u5b9a\n\n\u307e\u305a\u306fphp-fpm\u304b\u3089\u3001\u6b21\u306bnginx\u3084\u308a\u307e\u3057\u305f\n\nphp-fpm\u3068nginx\u9593\u306e\u3084\u308a\u53d6\u308a\u306fTCP\u3092\u7528\u3044\u308b\u65b9\u6cd5\u3068UNIX\u30c9\u30e1\u30a4\u30f3\u30bd\u30b1\u30c3\u30c8\u3092\u7528\u3044\u308b\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\n\u4eca\u56de\u306f\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u306e\u512a\u308c\u3066\u3044\u308bUNIX\u30c9\u30e1\u30a4\u30f3\u30bd\u30b1\u30c3\u30c8\u3067\u306e\u901a\u4fe1\u3092\u7528\u3044\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\n\n#### php-fpm\n\n`$ vi /etc/php/7.0/fpm/pool.d/www.conf`\n\nnginx\u3068\u540c\u3058\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u305f\u3081user\u3068group\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304f\u3001\u4eca\u56de\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306fwww-data\n\n```/etc/php/7.0/fpm/pool.d/www.conf\nuser = www-data\ngroup = www-data\n```\n\nUNIX\u30c9\u30e1\u30a4\u30f3\u30bd\u30b1\u30c3\u30c8\u3092\u7528\u3044\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u3092\u884c\u3046\n127.0.0.1:9000\u306fTCP\u7528\u306e\u8a2d\u5b9a\n\n```/etc/php/7.0/fpm/pool.d/www.conf\n- listen = 127.0.0.1:9000\n+ listen =  /var/run/php-fpm/php-fpm.sock\n```\n\n > __\u203b\u30cf\u30de\u308a\u30dd\u30a4\u30f3\u30c8__\n > \u30e6\u30fc\u30b6\u540d\u3001\u30b0\u30eb\u30fc\u30d7\u540d\u3001listen\u306e\u5185\u5bb9\u306fphp-fpm\u3068\u63c3\u3048\u308b\n > php-fpm\u3068nginx\u9593\u306e\u63a5\u7d9a\u304c\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u5834\u5408\u3053\u3053\u304c\u9593\u9055\u3063\u3066\u308b\u53ef\u80fd\u6027\u3092\u7591\u3046\n\n\n#### nginx\n\nphp-fpm\u3068\u540c\u3058\u3088\u3046\u306b\u30e6\u30fc\u30b6\u540d\u3092\u78ba\u8a8d\u3059\u308b\n\u4e00\u756a\u4e0a\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\n\n```/etc/nginx/nginx.conf\nuser www-data;\n```\n\n`/etc/nginx/conf.d`\u304c\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3001\u3053\u3053\u3067\u306fconf.d/*.conf\u3092\u8aad\u307f\u8fbc\u3080\u7528\u8a2d\u5b9a\u3057\u3066\u3042\u308b\u305f\u3081fpm\u3068\u306e\u8a2d\u5b9a\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u3053\u3053\u306b\u4f5c\u6210\u3059\u308b\n\n```\n# vi /etc/nginx/conf.d/server.conf\n```\n\n`fastcgi_pass`\u306b\u8a18\u8f09\u3059\u308b\u5185\u5bb9\u304cphp-fpm\u5074\u306e\u8a2d\u5b9a\u306e`listen`\u306b\u5bfe\u5fdc\u3059\u308b\n\n\n```/etc/nginx/conf.d/server.conf\n\nserver {\n        listen 80;\n        root /var/www/html;\n        index index.php index.html index.htm;\n        server_name localhost;\n\n        location / {\n                if (-f $request_filename) {\n                        expires 30d;\n                        break;\n                }\n        }\n\n        location ~ [^/]\\.php(/|$) {\n                fastcgi_split_path_info ^(.+\\.php)(/.+)$;\n                if (!-f $document_root$fastcgi_script_name) {\n                        return 404;\n                }\n                fastcgi_pass unix:/var/run/php/php7.0-fpm.sock;\n                fastcgi_index index.php;\n                fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n                fastcgi_param PATH_INFO $fastcgi_path_info;\n                fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;\n                include fastcgi_params;\n        }\n}\n```\n\n\n\u307e\u305f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067include\u3055\u308c\u3066\u3044\u308bsites-enabled\u3092\u547c\u3070\u306a\u3044\u3088\u3046\u306b\u3059\u308b\n\n```/etc/nginx/nginx.conf\n#include /etc/nginx/sites-enabled/*;\n```\n\n> __\u203b\u30cf\u30de\u308a\u30dd\u30a4\u30f3\u30c8__\n> include /etc/nginx/sites-enabled/*\u304c\u884c\u308f\u308c\u308b\u3068\u4eca\u4f5c\u6210\u3057\u305fphp-fpm\u3068\u306e\u63a5\u7d9a\u306e\u8a2d\u5b9a\u304c\u52b9\u304b\u306a\u304f\u306a\u308b\n> \u50d5\u306fphp\u30d5\u30a1\u30a4\u30eb\u304c\u305d\u306e\u307e\u307e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u305f\u3068\u3053\u308d\u3067\u3057\u3070\u3089\u304f\u8a70\u307e\u3063\u305f\u3001\u3053\u308c\u304c\u539f\u56e0\u3060\u3063\u305f\n\n#### \u8d77\u52d5\n\n\n```\n$ sudo service php7.0-fpm start\n$ sudo service nginx start\n```\n\n\u8d77\u52d5\u3059\u308b\u3068php-fpm\u306esocket\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u306f\u305a\u3067\u3042\u308b\n\n`$ cat /var/run/php/php7.0-fpm.sock`\n\n > __\u203b\u30cf\u30de\u308a\u30dd\u30a4\u30f3\u30c8__\n > \u3053\u308c\u3089\u306e\u8a2d\u5b9a\u3092\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3057\u305f\u3089restart\u53ca\u3073reload\u3092\u3057\u306a\u3044\u3068\u5909\u66f4\u306f\u53cd\u6620\u3055\u308c\u306a\u3044\n > \u610f\u5916\u3068\u3001\u7d50\u69cb\u5fd8\u308c\u304c\u3061\u306a\u306e\u3067\u6ce8\u610f\u3059\u308b\n >\n > sudo service php7.0-fpm reload\n > sudo service nginx reload\n >\n\n#### UNIX\u30c9\u30e1\u30a4\u30f3\u30bd\u30b1\u30c3\u30c8\u306b\u3088\u308b\u901a\u4fe1\u304c\u3067\u304d\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\n\n```\n$ netstat -a --unix\n...\nunix  2      [ ACC ]     STREAM     LISTENING     490025   /var/run/php/php7.0-fpm.sock\n...\n```\n\n## \u8868\u793a\u3092\u78ba\u8a8d\u3059\u308b\n\nserver.conf\u306b\u8a2d\u5b9a\u3057\u305f\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u9069\u5f53\u306aphp\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u304f\n\n```/var/www/html/hoge.php\n<?php\n  echo 'Hello, php-fpm.'\n```\n\n\u30d6\u30e9\u30a6\u30b6\u3067\u78ba\u8a8d\u3059\u308b\u3001\u5272\u308a\u632f\u3089\u308c\u305f\u30d1\u30d6\u30ea\u30c3\u30afIP\u306b\u30a2\u30af\u30bb\u30b9\n\n`http://XX.XXX.XX.XXX/hoge.php`\n\n\u3053\u308c\u3067\u300cHello, php-fpm.\u300d\u304c\u78ba\u8a8d\u3067\u304d\u308c\u3070\u8a2d\u5b9a\u306f\u5b8c\u4e86\u3001\u304a\u75b2\u308c\u69d8\u3067\u3057\u305f\u3002\n\n## \u56f0\u3063\u305f\u3089\n\n#### \u30ed\u30b0\u3092\u898b\u308b\n\n```/etc/nginx/nginx.conf\naccess_log /var/log/nginx/access.log;\n- error_log /var/log/nginx/error.log;\n+ error_log /var/log/nginx/error.log debug;\n```\n\n\u3053\u308c\u3067\u30a8\u30e9\u30fc\u30ed\u30b0\u304c\u30c7\u30d0\u30c3\u30b0\u7528\u306b\u8272\u3005\u66f8\u3044\u3066\u304f\u308c\u308b\u3088\u3046\u306b\u306a\u308b\n\n#### netstat\u30b3\u30de\u30f3\u30c9\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3067\u304d\u308b\n\n```\n$ netstat -a --unix\n...\nunix  2      [ ACC ]     STREAM     LISTENING     490025   /var/run/php/php7.0-fpm.sock\n...\n```\n\n\n## \u3042\u3068\u304c\u304d\n\nAWS\u3082\u521d\u3081\u3066\u5229\u7528\u3059\u308b\u5834\u5408\u306f\u6238\u60d1\u3046\u3068\u3053\u308d\u304c\u3042\u308b\u3001\u5c11\u3057\u5b66\u3076\u6642\u9593\u304c\u5fc5\u8981\u3060\u3068\u601d\u3063\u3068\u3044\u305f\u65b9\u304c\u3044\u3044\u3002\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u4e0b\u308a\u3082\u898b\u3064\u3051\u308b\u306e\u6642\u9593\u304b\u304b\u3063\u305f\u3002\n\u8a2d\u5b9a\u304c\u30b0\u30c1\u30e3\u30b0\u30c1\u30e3\u3057\u3066\u6765\u305f\u3089\u6bba\u3057\u3066\u65b0\u3057\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7acb\u3066\u3066\u3084\u308a\u76f4\u3057\u305f\u65b9\u304c\u65e9\u305d\u3046\u3002\n\nrestart\u3057\u3066\u304f\u308c\u306a\u3044\u3001\u307f\u305f\u3044\u306a\u3053\u3068\u3082\u8d77\u3053\u3063\u305f\n\n```\n$ sudo service nginx restart\nJob for nginx.service failed because the control process exited with error code. See \"systemctl status nginx.service\" and \"journalctl -xe\" for details.\n```\n\n\u8a00\u308f\u308c\u305f\u901a\u308a\u306b\"systemctl status nginx.service\" and \"journalctl -xe\"\u3092\u898b\u306b\u884c\u304f\u3068\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306esyntax\u30a8\u30e9\u30fc\u3060\u3063\u305f\u308a\u3057\u305f\u3002\n\n\u4e00\u756a\u8a70\u307e\u3063\u305f\u306e\u306f\u4f55\u3088\u308a`include /etc/nginx/sites-enabled/*`\n\u4f55\u5ea6\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3057\u3066\u3082php\u30d5\u30a1\u30a4\u30eb\u304c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u308b\u3060\u3051\u3067\u9032\u3081\u306a\u304b\u3063\u305f\u3057\u3001\u30a8\u30e9\u30fc\u30ed\u30b0\u3067\u3082\u308f\u304b\u308a\u3065\u3089\u3044\n", "tags": ["php-fpm", "nginx", "PHP", "Ubuntu", "EC2"]}