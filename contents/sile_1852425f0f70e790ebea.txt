{"context": " More than 1 year has passed since last update.\u4eca\u65e5\u306fErlang\u306e\u5185\u90e8\u5b9f\u88c5\u5468\u308a\u306e\u8a18\u4e8b\u3092\u66f8\u304d\u305f\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u305d\u308c\u306f\u6e96\u5099\u304c\u9593\u306b\u5408\u3044\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u4ee3\u308f\u308a\u306b\u5206\u6563Erlang\u306b\u95a2\u9023\u3059\u308b\u6a5f\u80fd\u306e\u6027\u80fd\u6e2c\u5b9a\u3092\u3044\u304f\u3064\u304b\u884c\u3063\u305f\u306e\u3067\u3001\u305d\u306e\u7d50\u679c\u30e1\u30e2\u3092\u8f09\u305b\u3055\u305b\u3066\u8cb0\u3044\u307e\u3059\u3002\n\u203b \u6e2c\u5b9a\u65b9\u6cd5\u306f\u7d50\u69cb\u9069\u5f53\u306a\u306e\u3067\u53c2\u8003\u7a0b\u5ea6\u306b\n\u306a\u304a\u3001\u5206\u6563Erlang\u81ea\u4f53\u306b\u95a2\u3057\u3066\u306f(\u4f8b\u3048\u3070)\u300e\u3059\u3054\u3044Erlang\u3086\u304b\u3044\u306b\u5b66\u307c\u3046! \u300f\u306e29\u7ae0(web\u7248)\u304c\u8a73\u3057\u3044\u306e\u3067\u3001\u305d\u3061\u3089\u3092\u53c2\u7167\u306e\u3053\u3068\u3002\n\n\u76ee\u7684\u7b49\n\u5206\u6563Erlang\u306f\u30e1\u30c3\u30b7\u30e5\u578b\u306e\u30af\u30e9\u30b9\u30bf\u3092\u7d44\u3080\u306e\u3067\u3001\u53f0\u6570\u304c\u5897\u3048\u308b\u3068\u6027\u80fd\u304c\u982d\u6253\u3061\u3057\u3084\u3059\u3044\u304b\u3082\u3001\u3068\u3044\u3046\u8a71\u3092\u4ee5\u524d\u306b\u3069\u3053\u304b\u3067\u76ee\u306b\u3057\u305f\u899a\u3048\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u5b9f\u969b\u306b\u3069\u3046\u306a\u306e\u304b\u3092\u8a66\u3057\u3066\u307f\u305f\u304b\u3063\u305f\u3001\u3068\u3044\u3046\u306e\u304c\u3082\u3068\u3082\u3068\u306e\u52d5\u6a5f\u3002\n\u4eca\u56de\u306e\u76ee\u7684\u306f\u3001(\u6700\u5927\u3067)\u6570\u767e\u30ce\u30fc\u30c9\u898f\u6a21\u306eErlang\u30af\u30e9\u30b9\u30bf\u3092\u69cb\u7bc9\u3059\u308b\u969b\u306b\u3001\u3069\u3053\u304c\u6027\u80fd\u4e0a\u306e\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u306b\u306a\u308a\u5f97\u308b\u304b\u3092\u304a\u304a\u307e\u304b\u306b\u628a\u63e1\u3059\u308b\u3053\u3068\u3002\n\u7279\u5b9a\u306e\u30b7\u30b9\u30c6\u30e0\u3084\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u5168\u4f53\u306e\u6027\u80fd\u6e2c\u5b9a\u3067\u306f\u306a\u304f\u3001\u6a19\u6e96\u3067\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308b\u5206\u6563Erlang\u95a2\u9023\u6a5f\u80fd\u5358\u4f53\u306e\u57fa\u790e\u6027\u80fd\u306e\u6e2c\u5b9a\u3092\u884c\u306a\u3046\u3002\n(\u5206\u6563Erlang\u306e\u57fa\u76e4\u7684\u306a\u90e8\u5206\u3067\u3001\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u3092\u963b\u5bb3\u3059\u308b\u8981\u56e0\u304c\u306a\u3044\u304b\u3069\u3046\u304b)\n\u306a\u304a\u3001\u5b89\u5b9a\u6027\u5468\u308a\u306e\u8a71(ex. \u30ce\u30fc\u30c9\u6570\u304c\u591a\u3044+\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u4e0d\u5b89\u5b9a\u306a\u969b\u3001\u306e\u5206\u6563Erlang\u306e\u6027\u80fd\u3084\u6319\u52d5\u7b49)\u306f\u4eca\u56de\u306f\u8003\u616e\u3057\u3066\u3044\u306a\u3044\u3002\n\n\u6e2c\u5b9a\u74b0\u5883\u304a\u3088\u3073\u6e2c\u5b9a\u65b9\u6cd5\n\n\u6e2c\u5b9a\u74b0\u5883\nEC2\u306ec3.8xlarge\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f7f\u7528\u3057\u305f:\n\nCPU: Intel(R) Xeon(R) CPU E5-2680 v2 @ 2.80GHz (\u7269\u740616\u30b3\u30a2\u3001\u8ad6\u740632\u30b3\u30a2)\n\u30e1\u30e2\u30ea: 60GiB\nOS: CentOS-6.4\nOTP: 17.4 (rpm)\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u6570: 10\u53f0\n\n\n\u30af\u30e9\u30b9\u30bf\u306e\u69cb\u7bc9\u65b9\u6cd5\u3068\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u69cb\u6210\n\u8a08\u6e2c\u7528\u306e\u5206\u6563Erlang\u30af\u30e9\u30b9\u30bf\u306e\u69cb\u7bc9\u306b\u306fslave\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u305f\u3002\n\nslave\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u3046\u3053\u3068\u3067\u3001Erlang\u30b7\u30a7\u30eb\u4e0a\u304b\u3089\u5225\u306e\u30ce\u30fc\u30c9\u3092\u30b9\u30ec\u30fc\u30d6\u3068\u3057\u3066\u8d77\u52d5\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\n\n\n\u8d77\u52d5\u3057\u305f\u5074\u306e\u30ce\u30fc\u30c9\u306f\u30de\u30b9\u30bf\u30fc\u30ce\u30fc\u30c9\u3068\u306a\u308b\n\n\n\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u306e\u751f\u5b58\u671f\u9593\u306f\u3001\u30de\u30b9\u30bf\u30fc\u30ce\u30fc\u30c9(or link\u4ed8\u304d\u3067\u547c\u3073\u51fa\u3057\u305f\u5834\u5408\u306f\u547c\u3073\u51fa\u3057\u5143\u30d7\u30ed\u30bb\u30b9)\u306e\u305d\u308c\u3068\u540c\u671f\u3059\u308b\n\u30af\u30ea\u30fc\u30f3\u306a\u74b0\u5883\u306e\u30af\u30e9\u30b9\u30bf\u306e\u69cb\u7bc9\u304a\u3088\u3073\u7834\u68c4\u304c\u624b\u8efd\u306b\u884c\u3048\u308b\u306e\u3067\u3001\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u7684\u306a\u7528\u9014\u306b\u5411\u3044\u305f\u4fbf\u5229\u306a\u30e2\u30b8\u30e5\u30fc\u30eb\n\n%% \u4f7f\u7528\u4f8b:\n%%\n%% \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u3092\u8d77\u52d5\u3057\u305f\u3044\u30db\u30b9\u30c8\u540d\u3068\u30ce\u30fc\u30c9\u306e\u540d\u524d\u3092\u6307\u5b9a\u3057\u3066 slave:start_link/2 \u3092\u547c\u3073\u51fa\u3059\n%% \u203b \u3053\u3053\u3067\u6307\u5b9a\u3059\u308b\u30db\u30b9\u30c8\u306b\u306frsh\u30b3\u30de\u30f3\u30c9\u3067\u30ed\u30b0\u30a4\u30f3\u304c\u3067\u304d\u308b\u5fc5\u8981\u304c\u3042\u308b \n%%    (rsh\u30b3\u30de\u30f3\u30c9\u3067\u306f\u306a\u304f\u3001ssh\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u306ferl\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u6642\u306b'-rsh ssh'\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u5f15\u6570\u3067\u6307\u5b9a\u3059\u308b)\n> slave:start_link(hoge_host, fuga).\n{ok, fuga@hoge_host}  % 'fuga@hoge_host'\u3068\u3044\u3046\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u304c\u8d77\u52d5\u3057\u305f\n\n> nodes().\n[fuga@hoge_host]\n\n> exit(shutdown). % \u547c\u3073\u51fa\u3057\u5143(link)\u30d7\u30ed\u30bb\u30b9\u304c\u30c0\u30a6\u30f3\u3057\u305f\u3089\u3001\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u306f\u81ea\u52d5\u3067\u7d42\u4e86\u3055\u305b\u3089\u308c\u308b\n\n> nodes().\n[]\n\n\u6e2c\u5b9a\u6642\u306b\u7528\u3044\u305fEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u69cb\u6210\u306f\u3001\u4ee5\u4e0b\u306e\u901a\u308a:\n\n\u30de\u30b9\u30bf\u30fc\u30ce\u30fc\u30c9\u7528\u306b\u5c02\u7528\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4e00\u53f0\u5272\u5f53\n\n\n\u8a08\u6e2c\u7528\u306e\u5404\u7a2e\u64cd\u4f5c\u3092\u5b9f\u884c\u3057\u305f\u308a\u3001\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u52d5\u4f5c\u3059\u308b\u306e\u306f\u3053\u306e\u30ce\u30fc\u30c9\n\n\n\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u7528\u306b\u306f\u6b8b\u308a\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e5d\u53f0\u3092\u5272\u5f53\n\n\n\u6e2c\u5b9a\u7528\u306e\u8ca0\u8377\u8abf\u6574\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7fa4\n\u5404\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u306f\u6700\u5927\u306730\u500b\u7a0b\u5ea6\u306eEralng\u30ce\u30fc\u30c9\u3092\u540c\u6642\u306b\u8d77\u52d5\u3055\u308c\u308b\n\n\n\u76f8\u4e57\u308a\u3057\u3066\u3044\u308b\u306e\u306f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u6570\u306e\u7bc0\u7d04\u306e\u305f\u3081\u4ed5\u65b9\u306a\u304f (\u53ef\u80fd\u306a\u3089\u4e00\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e00\u30ce\u30fc\u30c9\u306e\u65b9\u304c\u671b\u307e\u3057\u3044)\n\n\n\u6e2c\u5b9a\u6642\u306b\u306f\u6700\u5927\u3067256\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9(+ 1\u30de\u30b9\u30bf\u30fc\u30ce\u30fc\u30c9)\u3092\u542b\u3080\u30af\u30e9\u30b9\u30bf\u304c\u4f5c\u6210\u3055\u308c\u308b\n\n\n\n\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u7fa4\u306f\u3001\u5404\u6e2c\u5b9a\u95a2\u6570\u5b9f\u884c\u524d\u306b\u8d77\u52d5\u3055\u308c\u3001\u95a2\u6570\u5b9f\u884c\u5f8c\u306b\u7834\u68c4\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u305f\u3002\n\n\u8a08\u6e2c\u65b9\u6cd5 (\u5171\u901a\u90e8\u5206)\n\u672b\u5c3e\u306b\u8a18\u8f09\u306edist_bench.erl\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u95a2\u6570\u7fa4\u3092\u4f7f\u3063\u3066\u6e2c\u5b9a\u3092\u884c\u3063\u305f\u3002\n\u4ee5\u4e0b\u3001\u5168\u3066\u306e\u8a08\u6e2c\u3067\u4f7f\u7528\u3057\u305f\u5171\u901a\u306e\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u95a2\u6570\u7fa4\u306e\u7d39\u4ecb\u304a\u3088\u3073\u4f7f\u7528\u4f8b:\n%% [1] dist_bench:setup_nodes/1\n%% \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u7fa4\u306e\u8d77\u52d5\u95a2\u6570\n> NodeSpecs = [{host1, 3}, {host2, 2}]. % \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u3092\u8d77\u52d5\u3059\u308b\u30db\u30b9\u30c8\u3068\u3001\u305d\u306e\u30db\u30b9\u30c8\u3067\u306e\u8d77\u52d5\u6570\u3092\u6307\u5b9a\u3059\u308b\n> dist_bench:setup_nodes(NodeSpecs).\n{5, 654112}.  % {\u8d77\u52d5\u3057\u305f\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u306e\u6570, \u5404\u30ce\u30fc\u30c9\u306e\u8d77\u52d5\u306b\u8981\u3057\u305f\u6642\u9593\u306e\u5e73\u5747(\u03bcs)}\n\n> nodes().\n[slave_0@host1, slave_1@host1, slave_2@host1, slave_0@host2, slave_1@host2]\n\n> exit(shutdown).\n\n\n%% [2] dist_bench:make_node_specs/2\n%% 'NodeSpecs'\u306e\u751f\u6210\u88dc\u52a9\u95a2\u6570\n%% \u5229\u7528\u53ef\u80fd\u306a\u30db\u30b9\u30c8\u4e00\u89a7\u3068\u3001\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u306e\u5408\u8a08\u8d77\u52d5\u6570\u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u5404\u30db\u30b9\u30c8\u9593\u3067\u8d77\u52d5\u6570\u304c\u5747\u7b49\u306b\u306a\u308b\u3088\u3046\u306b\u8abf\u6574\u3057\u3066\u304f\u308c\u308b\n> dist_bench:make_node_specs([host1, host2], 5).\n[{host1, 3}, {host2, 2}]\n\n\n%% [3] dist_bench:do_bench/3\n%% \u30d9\u30f3\u30c1\u30de\u30fc\u30af(\u8a08\u6e2c)\u5b9f\u884c\u95a2\u6570\n> ExecuteCount = 5.                          % 'BenchFun'\u306e\u5b9f\u884c\u56de\u6570\n> BenchFun = fun () -> timer:sleep(100) end. % \u5177\u4f53\u7684\u306a\u8a08\u6e2c\u51e6\u7406\u3092\u5b9f\u884c\u3059\u308b\u95a2\u6570\n> dist_bench:do_bench(NodeSpecs, ExecuteCount, BenchFun). \n# setup nodes ... done: count=5, start_avg_time=0.3468948 sec % \u6700\u521d\u306b\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u7fa4\u304c\u8d77\u52d5\u3055\u305b\u3089\u308c\u308b\n# [1] do bench ... done: time=0.103409 sec % 'BenchFun'\u306e\u4e00\u56de\u306e\u5b9f\u884c\u306b\u639b\u304b\u3063\u305f\u6642\u9593(\u524d\u51e6\u7406\u3084\u5f8c\u51e6\u7406\u306e\u6642\u9593\u3082\u542b\u3080\u306e\u3067\u53c2\u8003\u7a0b\u5ea6)\n# [2] do bench ... done: time=0.100309 sec\n# [3] do bench ... done: time=0.101726 sec\n# [4] do bench ... done: time=0.1009 sec\n# [5] do bench ... done: time=0.100786 sec\n\n[ok,ok,ok,ok,ok]\n% \u2191 'BenchFun'\u95a2\u6570\u306e\u8fd4\u308a\u5024\u3092\u96c6\u3081\u305f\u3082\u306e.\n% \u3053\u3053\u3067\u306f'ok'\u304c\u8fd4\u3055\u308c\u3066\u3044\u308b\u304c\u3001\u5b9f\u969b\u306e\u5bfe\u8c61\u51e6\u7406\u306e\u8a08\u6642\u7d50\u679c\u304c\u8fd4\u3055\u308c\u308b\u3053\u3068\u3092\u671f\u5f85\u3057\u3066\u3044\u308b.\n% \u4ee5\u964d\u3067\u306f\u3001\u3053\u306e\u30ea\u30b9\u30c8\u4e2d\u306e\u4e2d\u592e\u5024\u304c\u3001\u6700\u7d42\u7684\u306a\u8a08\u6642\u7d50\u679c\u3068\u3057\u3066\u63a1\u7528\u3055\u308c\u3066\u3044\u308b\u3002\n\n\n\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u95a2\u9023\u306e\u6027\u80fd\u6e2c\u5b9a\n\u30af\u30e9\u30b9\u30bf\u5185\u306e\u30ce\u30fc\u30c9\u6570\u304c\u5897\u3048\u305f\u5834\u5408\u306e\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u306e\u6e2c\u5b9a\u3002\n\n\u5bfe\u8c61\n\u6a19\u6e96\u3067\u63d0\u4f9b\u3055\u308c\u3066\u304a\u308a\u3001\u304b\u3064\u3001\u81ea\u5206\u304c\u6bd4\u8f03\u7684\u826f\u304f\u5229\u7528\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u3084\u95a2\u6570\u7fa4\u3092\u4e2d\u5fc3\u306b\u6e2c\u5b9a\u3092\u884c\u3063\u305f\u3002\n\n\u30ce\u30fc\u30c9\u7ba1\u7406\u7cfb\n\n\n\nslave:start_link/2\u95a2\u6570: \u30ce\u30fc\u30c9\u306e\u8ffd\u52a0\n\nnet_kernel\u30e2\u30b8\u30e5\u30fc\u30eb: \u30ce\u30fc\u30c9\u306e\u6b7b\u6d3b\u76e3\u8996(\u30cf\u30fc\u30c8\u30d3\u30fc\u30c8)\u5468\u308a\n\n\n\u30d4\u30a2\u30c4\u30fc\u30d4\u30a2\u901a\u4fe1\u7cfb\n\n\n\nerlang:send/2\u95a2\u6570: \u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\n\nerlang:monitor/2\u95a2\u6570: \u30d7\u30ed\u30bb\u30b9\u306e\u6b7b\u6d3b\u7ba1\u7406\n\nrpc\u30e2\u30b8\u30e5\u30fc\u30eb: Remote Procedure Call\n\n\n\u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u60c5\u5831\u7ba1\u7406\u7cfb\n\n\n\nglobal\u30e2\u30b8\u30e5\u30fc\u30eb: \u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u30d7\u30ed\u30bb\u30b9\u540d\u7ba1\u7406\n\npg2\u30e2\u30b8\u30e5\u30fc\u30eb: \u30d7\u30ed\u30bb\u30b9\u30b0\u30eb\u30fc\u30d7\u7ba1\u7406\n\n\n\n\u5bfe\u8c61\u5916\u3068\u3057\u305f\u5206\u6563Erlang\u95a2\u9023\u30e2\u30b8\u30e5\u30fc\u30eb\u7b49 (\u3059\u3050\u601d\u3044\u3064\u3044\u305f\u7269\u306e\u307f\u8a18\u8f09):\n\n\nmnesia\u30e2\u30b8\u30e5\u30fc\u30eb\n\n\u6a19\u6e96\u3067\u914d\u5e03\u3055\u308c\u3066\u3044\u308b\u5206\u6563DMBS\n\u500b\u4eba\u7684\u306b\u306f\u4e0a\u624b\u3044\u4f7f\u3044\u6240\u304c\u898b\u3064\u304b\u3063\u3066\u3044\u306a\u3044\u306e\u3068\u3001\u3053\u3053\u3067\u6271\u3046\u306e\u306f\u5de8\u5927\u3059\u308b\u6c17\u304c\u3059\u308b\u306e\u3067\u4eca\u56de\u306f\u5bfe\u8c61\u5916\n\n\n\npg\u30e2\u30b8\u30e5\u30fc\u30eb\n\npg2\u306e\u524d\u8eab(?)\u3067\u73fe\u5728\u306f\u975e\u63a8\u5968\u6271\u3044 (OTP18\u3067\u524a\u9664\u4e88\u5b9a\u3001\u3068\u306a\u3063\u3066\u3044\u305f)\n\n\n\nglobal_group\u30e2\u30b8\u30e5\u30fc\u30eb\n\n\u30af\u30e9\u30b9\u30bf\u5185\u306e\u30ce\u30fc\u30c9\u7fa4\u3092\u30b0\u30eb\u30fc\u30d7\u5206\u3051\u3059\u308b\u305f\u3081\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\n\u30af\u30e9\u30b9\u30bf\u5168\u4f53\u306e\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3044\u5834\u5408\u3067\u3082\u3001\u30b0\u30eb\u30fc\u30d7\u5206\u3051\u3092\u9069\u5207\u306b\u884c\u306a\u3046\u3053\u3068\u3067global\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u6027\u80fd\u52a3\u5316\u3092\u9632\u3052\u308b\u3068\u306e\u3053\u3068\n\u30ce\u30fc\u30c9\u7fa4\u306e\u30b0\u30eb\u30fc\u30d7\u5206\u3051\u306e\u6a5f\u80fd\u81ea\u4f53\u306b\u306f\u82e5\u5e72\u60f9\u304b\u308c\u308b\u304c\u3001\u3044\u308d\u3044\u308d\u3068\u5236\u9650\u304c\u304d\u3064\u3044\u306e\u3067\u4eca\u5f8c\u3082\u4f7f\u3046\u3053\u3068\u306f\u306a\u3055\u305d\u3046\n\n\n\n\u5206\u6563OTP\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\n\n\u4eca\u306e\u3068\u3053\u308d\u4f7f\u3046\u4e88\u5b9a\u306a\u3057\n\n\n\n\n\u30ce\u30fc\u30c9\u7ba1\u7406\u7cfb\n\n\u30ce\u30fc\u30c9\u306e\u8ffd\u52a0\n\n\u6e2c\u5b9a\u5185\u5bb9\nslave:start_link/3\u95a2\u6570\u3092\u4f7f\u3063\u3066\u3001\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0(\u8d77\u52d5)\u3059\u308b\u306e\u306b\u8981\u3059\u308b\u6642\u9593\u304c\u3001\u30af\u30e9\u30b9\u30bf\u30b5\u30a4\u30ba\u306b\u5fdc\u3058\u3066\u5909\u5316\u3059\u308b\u304b\u3092\u6e2c\u5b9a\u3057\u305f\u3002\n%% \u6e2c\u5b9a\u65b9\u6cd5:\n%% - dist_bench:setup_nodes/1\u95a2\u6570\u3092\u4f7f\u3063\u3066\u3001\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u306e\u8ffd\u52a0\u306b\u8981\u3057\u305f\u6642\u9593\u306e\u5e73\u5747\u5024\u3092\u6e2c\u5b9a\u3059\u308b\n\n> Hosts = [host1, host2, host3, host4, host5, host6, host7, host8, host9]. % \u30b9\u30ec\u30fc\u30d6\u7528\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30ea\u30b9\u30c8\n> NodeCount = 1. % \u8d77\u52d5\u3059\u308b\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u306e\u6570\u30021\u304b\u3089256\u306e\u7bc4\u56f2\u3067\u5909\u5316\u3055\u305b\u3066\u3001\u305d\u308c\u305e\u308c\u306e\u5024\u3067\u306e\u8ffd\u52a0\u306b\u8981\u3057\u305f\u6642\u9593\u3092\u8a08\u6e2c\u3059\u308b\n\n> dist_bench:setup_nodes(dist_bench:make_node_specs(Hosts, NodeCount)).\n{1, 647250.0}  % \u8fd4\u308a\u5024\u306e\u7b2c\u4e8c\u8981\u7d20\u304c\u3001\u5404\u30ce\u30fc\u30c9\u306e\u8ffd\u52a0(\u8d77\u52d5)\u306b\u8981\u3057\u305f\u6642\u9593\u306e\u5e73\u5747\u5024(\u03bcs)\n\n> exit(shutdown). % 'NodeCount'\u3092\u5909\u66f4\u3057\u3066\u6b21\u306e\u60f3\u5b9a\u3092\u884c\u306a\u3046\u524d\u306b\u3001\u8d77\u52d5\u3057\u305f\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u7fa4\u3092\u505c\u6b62\u3059\u308b\n\n\n\u6e2c\u5b9a\u7d50\u679c\n\n\n\n\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570\n\u30ce\u30fc\u30c9\u306e\u8ffd\u52a0\u306b\u8981\u3057\u305f\u6642\u9593\u306e\u5e73\u5747\n\n\n\n\n1\n0.637 s\n\n\n4\n0.673 s\n\n\n16\n0.691 s\n\n\n64\n0.705 s\n\n\n256\n0.690 s\n\n\n\n\u5c11\u306a\u304f\u3068\u3082slave\u30e2\u30b8\u30e5\u30fc\u30eb\u7d4c\u7531\u3067\u8d77\u52d5\u3057\u305f\u5834\u5408\u306f\u3001\u30af\u30e9\u30b9\u30bf\u5185\u306e\u30ce\u30fc\u30c9\u6570\u304c\u591a\u304f\u306a\u3063\u3066\u3082\u3001\u65b0\u898f\u30ce\u30fc\u30c9\u306e\u8ffd\u52a0\u306b\u639b\u304b\u308b\u30b3\u30b9\u30c8\u304c\u9855\u8457\u306b\u5897\u3048\u308b\u3001\u3068\u3044\u3063\u305f\u3088\u3046\u306a\u3053\u3068\u306f\u306a\u3055\u305d\u3046\u3002\n\n\u30ce\u30fc\u30c9\u306e\u6b7b\u6d3b\u76e3\u8996\n\u203b \u3053\u308c\u306b\u95a2\u3057\u3066\u306f'\u6e2c\u5b9a'\u3068\u3044\u3046\u7a0b\u306e\u3053\u3068\u306f\u884c\u3063\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u8efd\u304f\u6982\u8981\u3060\u3051\u66f8\u3044\u3066\u304a\u304f\n\u5206\u6563Erlang\u3067\u306e\u63a5\u7d9a\u3057\u3066\u3044\u308b\u30ce\u30fc\u30c9\u306e\u6b7b\u6d3b\u76e3\u8996\u306fnet_kernel\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u884c\u3063\u3066\u3044\u308b\u3002\n\u6b7b\u6d3b\u30c1\u30a7\u30c3\u30af\u51e6\u7406\u306e\u304a\u304a\u3088\u305d\u306e\u6d41\u308c\u306f\u4ee5\u4e0b\u306e\u901a\u308a:\n\nnet_kernel\u30d7\u30ed\u30bb\u30b9\u306f\u3001\u63a5\u7d9a\u30ce\u30fc\u30c9\u3068\u306e\u9593\u306b\u6b7b\u6d3b\u76e3\u8996\u7528\u306eTCP\u63a5\u7d9a\u3092\u8cbc\u3063\u3066\u3044\u308b\n\nticktime / 4\u79d2\u6bce\u306b\u3001\u305d\u306e\u5168\u3066\u306eTCP\u63a5\u7d9a\u306b\u5bfe\u3057\u3066\u3001(\u76e3\u8996\u7528\u306e)\u66f8\u304d\u8fbc\u307f\u3092\u884c\u306a\u3046\n\n\nticktime\u306fnet_kernel:set_net_ticktime/1\u3067\u6307\u5b9a\u3055\u308c\u305f\u79d2\u6570\u3067\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306f60\u79d2\n\n\nTCP\u63a5\u7d9a\u304c\u9589\u3058\u3066\u3044\u305f\u308a\u3001ticktime\u79d2\u9593\u306b(\u76f8\u624b\u5074\u304b\u3089\u306e)\u66f8\u304d\u8fbc\u307f\u304c\u306a\u304b\u3063\u305f\u30ce\u30fc\u30c9\u306f\u3001\u30c0\u30a6\u30f3\u3057\u3066\u3044\u308b\u3068\u5224\u65ad\u3059\u308b\n\n\u5f53\u7136\u3001\u63a5\u7d9a\u3057\u3066\u308b\u30ce\u30fc\u30c9\u6570\u306b\u6bd4\u4f8b\u3057\u3066\u3001(ticktime / 4\u79d2\u6bce\u306e)\u51e6\u7406\u91cf\u306f\u5897\u3048\u308b\u3053\u3068\u306b\u306a\u308b\u304c\u3001\u7279\u306b\u91cd\u3044\u51e6\u7406\u3067\u3082\u306a\u3044\u306e\u3067\u3001\u6570\u767e\u30ce\u30fc\u30c9\u7a0b\u5ea6\u3067\u3042\u308c\u3070\u3001\u8ca0\u8377\u7684\u306b\u7279\u306b\u554f\u984c\u3068\u306a\u308b\u3053\u3068\u3082\u306a\u3055\u305d\u3046\u3002\n\u5b9f\u969b\u306b\u3001\u7279\u306b\u4f55\u3082\u51e6\u7406\u3092\u8d70\u3089\u305b\u3066\u3044\u306a\u3044\u72b6\u614b\u3067CPU\u306e\u4f7f\u7528\u7387\u3092\u78ba\u8a8d\u3057\u3066\u307f\u3066\u3082\u3001\u63a5\u7d9a\u30ce\u30fc\u30c9\u304c\u306a\u3044\u5834\u5408\u3068\u63a5\u7d9a\u30ce\u30fc\u30c9\u6570\u304c200\u306e\u5834\u5408\u3068\u306e\u9593\u3067\u3001\u7279\u306b\u512a\u4f4d\u306a\u7a0b\u306e\u5dee\u306f\u898b\u3089\u308c\u306a\u304b\u3063\u305f\u3088\u3046\u306b\u601d\u3046\u3002\n\n\u30d4\u30a2\u30c4\u30fc\u30d4\u30a2\u901a\u4fe1\u7cfb\n\u30ce\u30fc\u30c9\u3092\u8de8\u3044\u3060\u500b\u3005\u306e\u30d7\u30ed\u30bb\u30b9\u540c\u58eb\u304c\u76f4\u63a5\u3084\u308a\u3068\u308a\u3059\u308b\u7a2e\u985e\u306e\u64cd\u4f5c\u306e\u6027\u80fd\u6e2c\u5b9a\u3002\n\u30ce\u30fc\u30c9\u304c\u7570\u306a\u308b\u30d7\u30ed\u30bb\u30b9\u9593\u3067\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1\u3084\u3001\u30d7\u30ed\u30bb\u30b9\u6b7b\u6d3b\u76e3\u8996\u3001\u30ce\u30fc\u30c9\u9593RPC\u7b49\u3002\n\u3053\u308c\u3089\u306e\u64cd\u4f5c\u306f\u5bfe\u8c61\u3068\u306a\u308b\u7279\u5b9a\u306e\u30d7\u30ed\u30bb\u30b9/\u30ce\u30fc\u30c9\u3068\u3055\u3048\u901a\u4fe1\u3067\u304d\u308c\u3070\u5341\u5206\u3067\u3001\u30af\u30e9\u30b9\u30bf\u5168\u4f53\u306e\u72b6\u614b\u3092\u628a\u63e1\u3059\u308b\u5fc5\u8981\u3082\u306a\u3044\u306e\u3067\u3001\u30af\u30e9\u30b9\u30bf\u5185\u306e\u30ce\u30fc\u30c9\u6570\u304c\u5897\u52a0\u3057\u3066\u3082\u6027\u80fd\u304c\u52a3\u5316\u3057\u306a\u3044(= \u7d50\u679c\u3068\u3057\u3066\u30b7\u30b9\u30c6\u30e0\u5168\u4f53\u306f\u826f\u597d\u306b\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u3059\u308b)\u3053\u3068\u304c\u671f\u5f85\u3055\u308c\u308b\u3002\n\u5177\u4f53\u7684\u306a\u6e2c\u5b9a\u5bfe\u8c61\u306f\u4ee5\u4e0b\u306e\u901a\u308a:\n\n\nerlang:send/2\u95a2\u6570:\n\n\n\u30d7\u30ed\u30bb\u30b9\u306b\u5bfe\u3059\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u95a2\u6570\n\u5b9f\u969b\u306e\u6e2c\u5b9a\u30b3\u30fc\u30c9\u3067\u306f!\u6f14\u7b97\u5b50\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\n\u9001\u4fe1\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u5b9b\u5148\u6307\u5b9a\u65b9\u5f0f\u306b\u306f\u3001\u4ee5\u4e0b\u306e\u4e8c\u3064\u3092\u8a66\u3057\u305f:\n\n\nPID(\u30d7\u30ed\u30bb\u30b9ID)\u6307\u5b9a:\n\n\nErlang\u306ePID\u306b\u306f\u3001\u305d\u306e\u30d7\u30ed\u30bb\u30b9\u304c\u5b58\u5728\u3059\u308b\u30ce\u30fc\u30c9\u306e\u60c5\u5831\u3082\u57cb\u3081\u8fbc\u307e\u308c\u3066\u3044\u308b\u306e\u3067\u3001PID\u5358\u4f53\u3067\u5b9b\u5148\u3092\u4e00\u610f\u306b\u6c7a\u5b9a\u53ef\u80fd\nex: <123.456.789>\n\n\n\n\u30d7\u30ed\u30bb\u30b9\u540d\u6307\u5b9a:\n\n\n\nerlang:register/2\u3092\u4f7f\u3063\u3066\u767b\u9332\u3055\u308c\u305f\u30d7\u30ed\u30bb\u30b9\u540d\u3092\u9001\u4fe1\u5148\u306b\u6307\u5b9a\u3059\u308b\n\n{Name::atom(), Node::node()}\u5f62\u5f0f\n\n\n\n\n\n\n\n\nrpc:async_call/4:\n\n\n\nrpc:call/4\u3092\u4f7f\u3046\u3068\u30ea\u30e2\u30fc\u30c8\u30ce\u30fc\u30c9\u4e0a\u3067\u306e\u95a2\u6570\u5b9f\u884c\u304c\u624b\u8efd\u306b\u884c\u3048\u308b\n\u4eca\u56de\u306f\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u3092(\u624b\u8efd\u306b)\u4e0a\u3052\u308b\u305f\u3081\u306b\u975e\u540c\u671f\u7248\u306erpc:async_call/4\u3092\u4f7f\u7528\u3057\u305f\n\n\n\nerlang:monitor/2\u95a2\u6570:\n\n\n\u30d7\u30ed\u30bb\u30b9\u306e\u6b7b\u6d3b\u7ba1\u7406(\u5358\u65b9\u5411\u76e3\u8996)\n\u30e2\u30cb\u30bf\u3057\u3066\u3044\u308b\u30d7\u30ed\u30bb\u30b9\u304c\u30c0\u30a6\u30f3\u3057\u305f\u5834\u5408\u306f{'DOWN', MonitorRef, Type, Pid, Reason}\u3068\u3044\u3046\u5f62\u5f0f\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u547c\u3073\u51fa\u3057\u5143\u30d7\u30ed\u30bb\u30b9\u306b\u9001\u3089\u308c\u308b\n\u53cc\u65b9\u5411\u76e3\u8996(?)\u304c\u884c\u3048\u308berlang:link/2\u95a2\u6570\u3082\u3042\u308b\u304c\u3001(\u6027\u80fd\u50be\u5411\u306f\u5909\u308f\u3089\u306a\u3044\u3067\u3042\u308d\u3046\u3068\u4e88\u60f3\u306e\u3082\u3068)\u3053\u3061\u3089\u306e\u8a08\u6e2c\u306f\u5272\u611b\n\n\n\n\n\u6e2c\u5b9a\u5185\u5bb9\n\n\nerlang:send/2\u95a2\u6570:\n\n\n\u30ea\u30e2\u30fc\u30c8\u30ce\u30fc\u30c9\u4e0a\u306becho\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u3092\u7528\u610f\u3057\u3066 \u4e00\u56de\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1\u306b\u8981\u3057\u305f\u5e73\u5747\u6642\u9593 \u3092\u8a08\u6e2c\n\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u9001\u4fe1\u5143\u306f\u30de\u30b9\u30bf\u30fc\u30ce\u30fc\u30c9\u4e0a\u306e\u5358\u4e00\u30d7\u30ed\u30bb\u30b9\necho\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u306f\u30ea\u30e2\u30fc\u30c8\u306e\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u4e0a\u3067\u8d77\u52d5\u3059\u308b (\u5404\u30ce\u30fc\u30c9\u306b\u4ed8\u304d\u4e00\u30d7\u30ed\u30bb\u30b9\u304c\u5b58\u5728)\n\n\n\u6e2c\u5b9a\u95a2\u6570: dist_bench:pid_msg_echo_bench/2 (\u5b9f\u969b\u306b\u6307\u5b9a\u3057\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u7b49\u306f\u4e0b\u306e\u5b9f\u884c\u4f8b\u3092\u53c2\u7167)\n\n\n\nrpc:async_call/4:\n\n\n\n\u4e00\u56de\u306eRPC(\u30ea\u30af\u30a8\u30b9\u30c8\u9001\u4fe1\u304b\u3089\u30ec\u30b9\u30dd\u30f3\u30b9\u53d7\u4fe1\u307e\u3067)\u306b\u8981\u3057\u305f\u5e73\u5747\u6642\u9593 \u3092\u8a08\u6e2c\n\n\n\u30de\u30b9\u30bf\u30fc\u30ce\u30fc\u30c9\u4e0a\u306e(\u5358\u4e00)\u30d7\u30ed\u30bb\u30b9\u304b\u3089\u3001\u30ea\u30e2\u30fc\u30c8\u306e\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u306b\u5bfe\u3059\u308bRPC\n\n\n\u6e2c\u5b9a\u95a2\u6570: dist_bench:rpc_call_bench/2 (\u5b9f\u969b\u306b\u6307\u5b9a\u3057\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u7b49\u306f\u4e0b\u306e\u5b9f\u884c\u4f8b\u3092\u53c2\u7167)\n\n\n\nerlang:monitor/2\u95a2\u6570:\n\n\n\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u4e0a\u306e\u30d7\u30ed\u30bb\u30b9\u306b\u5bfe\u3059\u308b \u76e3\u8996\u306e\u767b\u9332\u304b\u3089\u30c0\u30a6\u30f3\u901a\u77e5\u306e\u53d7\u4fe1\u307e\u3067\u306b\u8981\u3057\u305f\u5e73\u5747\u6642\u9593 \u3092\u8a08\u6e2c\n\n\n\u30d7\u30ed\u30bb\u30b9\u306e\u76e3\u8996\u5143\u306f\u30de\u30b9\u30bf\u30fc\u30ce\u30fc\u30c9\u4e0a\u306e\u5358\u4e00\u30d7\u30ed\u30bb\u30b9\n\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u4e0a\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u5bfe\u8c61\u3068\u3057\u3066erlang:monitor/2\u3092\u547c\u3073\u51fa\u3057\u305f\u76f4\u5f8c\u306b\u3001\u305d\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u7d42\u4e86(erlang:exit/2)\u3055\u305b\u3066\u3001\u30c0\u30a6\u30f3\u901a\u77e5\u3092\u5f85\u6a5f\u3059\u308b\n\n\n\u6e2c\u5b9a\u95a2\u6570: dist_bench:monitor_bench/2 (\u5b9f\u969b\u306b\u6307\u5b9a\u3057\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u7b49\u306f\u4e0b\u306e\u5b9f\u884c\u4f8b\u3092\u53c2\u7167)\n\n\n\n\u6e2c\u5b9a\u306e\u969b\u306e\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u306e\u6570\u306f1\u304b\u3089256\u306e\u9593\u3067\u5909\u5316\u3055\u305b\u3001\u30af\u30e9\u30b9\u30bf\u30b5\u30a4\u30ba\u306e\u5927\u5c0f\u306b\u3088\u308a\u5404\u64cd\u4f5c\u306e\u30b3\u30b9\u30c8\u304c\u5909\u308f\u308b\u304b\u3069\u3046\u304b\u306e\u78ba\u8a8d\u3092\u884c\u3063\u305f\u3002\n\u307e\u305f\u53c2\u8003\u3068\u3057\u3066\u3001\u30ce\u30fc\u30c9\u9593\u901a\u4fe1\u304c\u4e00\u5207\u4e0d\u8981\u306a\u3001\u30de\u30b9\u30bf\u30fc\u30ce\u30fc\u30c9\u306e\u307f(= \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570\u304c0)\u306e\u69cb\u6210\u3067\u306e\u6e2c\u5b9a\u3082\u884c\u3063\u305f\u3002\n%% \u5b9f\u884c\u4f8b:\n\n%% \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570=4\u3001\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u5b9f\u884ch\n> dist_bench:do_bench(dist_bench:make_node_specs(Hosts, 4), 5,\n                      fun () -> dist_bench:pid_msg_echo_bench(500000, nodes()) end).\n\n%% \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570=4, \u3067RPC\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u5b9f\u884c\n> dist_bench:do_bench(dist_bench:make_node_specs(Hosts, 4), 5,\n                      fun () -> dist_bench:rpc_call_bench(100000, nodes()) end).\n\n%% \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570=4, \u3067\u30d7\u30ed\u30bb\u30b9\u76e3\u8996\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u5b9f\u884c\n> dist_bench:do_bench(dist_bench:make_node_specs(Hosts, 4), 5,\n                      fun () -> dist_bench:monitor_bench(100000, nodes()) end).\n\n\n\u6e2c\u5b9a\u7d50\u679c\n\n\n\n\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570\nerlang:send/2 (PID)\nerlang:send/2 (\u540d\u524d)\nrpc:async_call/4\nerlang:monitor/2\n\n\n\n\n0\n0.758 \u03bcs\n0.905 \u03bcs\n3.269 \u03bcs\n19.450 \u03bcs\n\n\n1\n8.020 \u03bcs\n8.055 \u03bcs\n40.105 \u03bcs\n9.074 \u03bcs\n\n\n4\n2.021 \u03bcs\n2.116 \u03bcs\n11.518 \u03bcs\n8.598 \u03bcs\n\n\n16\n1.429 \u03bcs\n1.672 \u03bcs\n7.160 \u03bcs\n4.985 \u03bcs\n\n\n64\n2.345 \u03bcs\n2.340 \u03bcs\n11.667 \u03bcs\n4.839 \u03bcs\n\n\n256\n2.634 \u03bcs\n2.767 \u03bcs\n11.320 \u03bcs\n5.053 \u03bcs\n\n\n\n\u6e2c\u5b9a\u7d50\u679c\u3092\u898b\u308b\u3068\u3001\u5168\u4f53\u7684\u306b\u3001\u30af\u30e9\u30b9\u30bf\u306e\u30b5\u30a4\u30ba\u304c\u5927\u304d\u304f\u306a\u3063\u3066\u3082\u3001\u500b\u3005\u306e\u51e6\u7406\u306e\u6027\u80fd\u306f\u307b\u3068\u3093\u3069\u52a3\u5316\u3057\u3066\u306a\u3044\u3053\u3068\u304c\u898b\u3066\u53d6\u308c\u308b\u3002\n\u3080\u3057\u308d\u4e26\u5217\u5ea6\u304c\u4e0a\u304c\u308b\u305f\u3081\u304b\u3001\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570\u304c16\u307e\u3067\u306e\u5834\u5408\u306f\u3001\u5358\u4f53\u306e\u51e6\u7406\u306b\u8981\u3059\u308b\u6642\u9593\u3082(\u30ce\u30fc\u30c9\u6570\u304c\u5897\u3048\u308b\u306b\u5f93\u3044)\u77ed\u304f\u306a\u3063\u3066\u3044\u308b\u3002\n\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570\u304c16\u3092\u8d85\u3048\u308b\u3068\u82e5\u5e72\u6027\u80fd\u304c\u52a3\u5316\u3057\u59cb\u3081\u308b\u50be\u5411\u304c\u3042\u308b\u304c\u3001\u3053\u308c\u306f\u4e00\u3064\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e0a\u3067\u8907\u6570\u306e\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u3092\u52d5\u304b\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u5f71\u97ff\u3092\u4e0e\u3048\u3066\u3044\u308b\u306e\u3067\u306f\u306a\u3044\u304b\u3068\u601d\u3063\u3066\u3044\u308b\u3002\n(\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570\u304c9\u3092\u8d85\u3048\u305f\u6bb5\u968e\u3067\u3001\u4e00\u3064\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e0a\u3067\u306e\u30ce\u30fc\u30c9\u306e\u540c\u5c45\u304c\u59cb\u307e\u308b\u306e\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8ca0\u8377\u306f\u9ad8\u304f\u306a\u308b)\n\n\u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u60c5\u5831\u7ba1\u7406\u7cfb\n\u30af\u30e9\u30b9\u30bf\u5168\u4f53\u306b\u5f71\u97ff\u3059\u308b\u3088\u3046\u306a\u64cd\u4f5c\u3092\u884c\u306a\u3046\u30e2\u30b8\u30e5\u30fc\u30eb\u7fa4\u306e\u6027\u80fd\u6e2c\u5b9a\u3002\n\u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u30d7\u30ed\u30bb\u30b9\u540d\u7ba1\u7406\u3084\u30d7\u30ed\u30bb\u30b9\u30b0\u30eb\u30fc\u30d7\u7ba1\u7406\u7b49\u3002\n\u30af\u30e9\u30b9\u30bf\u5185\u306e\u30ce\u30fc\u30c9\u540c\u58eb\u304c\u4f55\u3089\u304b\u306e\u624b\u6bb5\u3067\u60c5\u5831\u3092\u5171\u6709\u3059\u308b\u5fc5\u8981\u304c\u51fa\u3066\u304f\u308b\u306e\u3067\u3001\u5358\u306a\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u306e\u3088\u3046\u306a\u52b9\u7387\u7684\u306a\u5b9f\u88c5\u306f\u96e3\u3057\u3044\u3068\u4e88\u60f3\u3055\u308c\u308b\u3002\n\u5177\u4f53\u7684\u306a\u6e2c\u5b9a\u5bfe\u8c61\u306f\u4ee5\u4e0b\u306e\u901a\u308a:\n\n\nglobal\u30e2\u30b8\u30e5\u30fc\u30eb:\n\n\n\u30b0\u30ed\u30fc\u30d0\u30eb\u30b9\u30b3\u30fc\u30d7\u306a\u30d7\u30ed\u30bb\u30b9\u540d\u7ba1\u7406\u304c\u884c\u3048\u308b (erlang:register/2\u306e\u30b0\u30ed\u30fc\u30d0\u30eb\u7248)\n\u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u76f8\u4e92\u6392\u4ed6\u30ed\u30c3\u30af\u6a5f\u80fd\u3082\u63d0\u4f9b\u3057\u3066\u3044\u308b\nglobal\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u66f4\u65b0\u7cfb\u306e\u64cd\u4f5c\u6642\u306b\u6574\u5408\u6027\u3092\u4fdd\u8a3c\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\n\n\n\u30d7\u30ed\u30bb\u30b9\u540d\u306e\u767b\u9332\u64cd\u4f5c\u306e\u5834\u5408:\n\n\n\u6700\u521d\u306b\u767b\u9332\u3059\u308b\u540d\u524d\u3092\u30ad\u30fc\u306b\u3057\u3066\u3001\u30af\u30e9\u30b9\u30bf\u5168\u4f53\u3092\u30b9\u30b3\u30fc\u30d7\u3068\u3057\u3066\u30ed\u30c3\u30af\u3092\u7372\u5f97\n\u30ed\u30c3\u30af\u7372\u5f97\u306b\u6210\u529f\u3057\u305f\u3089\u3001\u767b\u9332\u3059\u308b\u540d\u524d\u3068PID\u3092\u3001\u5168\u30ce\u30fc\u30c9\u306b\u5468\u77e5\u3057\u3066\u767b\u9332\u3092\u884c\u308f\u305b\u308b\n\u30ed\u30c3\u30af\u7372\u5f97\u306b\u5931\u6557\u3057\u305f\u3089\u3001\u4e00\u5b9a\u6642\u9593\u30b9\u30ea\u30fc\u30d7\u3057\u3066\u518d\u8a66\u884c\n\n\n\u6574\u5408\u6027\u306f\u62c5\u4fdd\u3057\u3084\u3059\u3044\u304c\u3001\u30b9\u30b1\u30fc\u30eb\u306f\u96e3\u3057\u3044\n\n\n\u767b\u9332\u3055\u308c\u305f\u540d\u524d\u306e\u60c5\u5831\u306f\u3001\u5404\u30ce\u30fc\u30c9\u306e\u30ed\u30fc\u30ab\u30eb\u306eETS\u306b\u8907\u88fd\u30fb\u4fdd\u6301\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u53c2\u7167\u7cfb\u306e\u64cd\u4f5c\u306f(\u4ed6\u306e\u30ce\u30fc\u30c9\u3068\u306e\u901a\u4fe1\u3092\u884c\u306a\u3046\u3053\u3068\u306a\u304f)\u9ad8\u901f\u306b\u884c\u3048\u308b\n\n\n\npg2\u30e2\u30b8\u30e5\u30fc\u30eb:\n\n\n\u30b0\u30ed\u30fc\u30d0\u30eb\u30b9\u30b3\u30fc\u30d7\u306a\u30d7\u30ed\u30bb\u30b9\u30b0\u30eb\u30fc\u30d7\u7ba1\u7406\u304c\u884c\u3048\u308b\n\n\n\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210\u3001\u30b0\u30eb\u30fc\u30d7\u3078\u306e\u30e1\u30f3\u30d0\u30fc(PID)\u8ffd\u52a0\u3001\u30e1\u30f3\u30d0\u30fc\u306e\u53d6\u5f97\u3001etc\n\u7279\u5b9a\u306e\u30ce\u30fc\u30c9\u4e0a\u3067\u4f5c\u6210\u3055\u308c\u305f\u30b0\u30eb\u30fc\u30d7\u306f\u3001\u30af\u30e9\u30b9\u30bf\u5185\u306e\u5168\u3066\u306e\u30ce\u30fc\u30c9\u304b\u3089\u53c2\u7167\u53ef\u80fd\n\n\n\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210\u3084\u30e1\u30f3\u30d0\u306e\u8ffd\u52a0/\u524a\u9664\u6642\u306b\u306f\u3001global\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u6a5f\u80fd\u3092\u4f7f\u3063\u3066\u6574\u5408\u6027\u304c\u7dad\u6301\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\n\n\n\u300c\u30b0\u30eb\u30fc\u30d7\u540d\u3092\u30ad\u30fc\u3068\u3057\u3066\u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u30ed\u30c3\u30af\u3092\u7372\u5f97\u300d=>\u300c\u5168\u30ce\u30fc\u30c9\u306b\u60c5\u5831\u3092\u5171\u6709\u300d=>\u300c\u30ed\u30c3\u30af\u89e3\u9664\u300d\n\n\n\u5168\u3066\u30b0\u30eb\u30fc\u30d7\u60c5\u5831\u306f\u3001\u5404\u30ce\u30fc\u30c9\u306e\u30ed\u30fc\u30ab\u30eb\u306eETS\u306b\u8907\u88fd\u30fb\u4fdd\u6301\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u53c2\u7167\u7cfb\u306e\u64cd\u4f5c\u306f(\u4ed6\u306e\u30ce\u30fc\u30c9\u3068\u306e\u901a\u4fe1\u3092\u884c\u306a\u3046\u3053\u3068\u306a\u304f)\u9ad8\u901f\u306b\u884c\u3048\u308b\n\n\n\n\n\u6e2c\u5b9a\u5185\u5bb9\n\n\nglobal\u30e2\u30b8\u30e5\u30fc\u30eb:\n\n\n\u4ee5\u4e0b\u306e\u5404\u64cd\u4f5c\u3092\u305d\u308c\u305e\u308c\u767e\u56de\u5b9f\u884c\u3057\u3001\u4e00\u56de\u8fba\u308a\u306e\u5e73\u5747\u6240\u8981\u6642\u9593\u3092\u6e2c\u5b9a\n\n\nreg: \u30d7\u30ed\u30bb\u30b9\u540d\u306e\u767b\u9332. global:register_name/2\n\nunreg: \u540d\u524d\u306e\u767b\u9332\u89e3\u9664. global:unregister_name/1\n\nwhere: \u540d\u524d\u306b\u5bfe\u5fdc\u3059\u308bPID\u306e\u691c\u7d22. global:whereis_name/1\n\n\n\n\n\n\npg2\u30e2\u30b8\u30e5\u30fc\u30eb:\n\n\n\u4ee5\u4e0b\u306e\u5404\u64cd\u4f5c\u3092\u305d\u308c\u305e\u308c\u767e\u56de\u5b9f\u884c\u3057\u3001\u4e00\u56de\u8fba\u308a\u306e\u5e73\u5747\u6240\u8981\u6642\u9593\u3092\u6e2c\u5b9a\n\n\ncreate: \u30d7\u30ed\u30bb\u30b9\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210. pg2:create/1\n\njoin: \u30d7\u30ed\u30bb\u30b9\u30b0\u30eb\u30fc\u30d7\u3078\u306e\u30e1\u30f3\u30d0\u8ffd\u52a0. pg2:join/2\n\nselect: \u30d7\u30ed\u30bb\u30b9\u30b0\u30eb\u30fc\u30d7\u304b\u3089\u306e\u30d7\u30ed\u30bb\u30b9\u9078\u629e. pg2:get_closest_pid/1\n\n\n\n\n\n\n%% \u5b9f\u884c\u4f8b\n\n%% \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570=16 \u3067\u3001global\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u5b9f\u884c\n> dist_bench:do_bench(dist_bench:make_node_specs(Hosts, 16), 5, fun () -> dist_bench:global_bench(100) end).\n[[{register,2349.97},{unregister,3246.77},{whereis,0.47}], % \u767b\u9332/\u89e3\u9664/\u691c\u7d22\u3001\u51e6\u7406\u306e\u4e00\u56de\u8fba\u308a\u306e\u5e73\u5747\u6240\u8981\u6642\u9593(\u03bcs)\n [{register,2509.63},{unregister,2608.14},{whereis,0.49}],\n [{register,2420.48},{unregister,3952.45},{whereis,0.59}],\n [{register,2449.36},{unregister,2469.99},{whereis,0.41}],\n [{register,2647.81},{unregister,2469.52},{whereis,0.44}]]\n\n%% \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570=16 \u3067\u3001pg2\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u5b9f\u884c\n> dist_bench:do_bench(dist_bench:make_node_specs(Hosts, 16), 5, fun () -> dist_bench:pg2_bench(100, 100) end).\n[[{create,1787.34},{join,1735.18},{select,78.39}], % \u4f5c\u6210/\u30e1\u30f3\u30d0\u8ffd\u52a0/\u9078\u629e\u3001\u51e6\u7406\u306e\u4e00\u56de\u8fba\u308a\u306e\u5e73\u5747\u6240\u8981\u6642\u9593(\u03bcs)\n [{create,1713.19},{join,1704.63},{select,79.92}],\n [{create,1725.01},{join,2014.12},{select,77.63}],\n [{create,1764.74},{join,1721.5},{select,78.14}],\n [{create,1719.31},{join,1704.02},{select,76.69}]]\n\n\n\u6e2c\u5b9a\u7d50\u679c\n\n\n\n\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570\nglobal (reg)\nglobal (unreg)\ngloabl (where)\npg2 (create)\npg2 (join)\npg2 (select)\n\n\n\n\n0\n55.63 \u03bcs\n51.83 \u03bcs\n0.37 \u03bcs\n33.15 \u03bcs\n36.53 \u03bcs\n75.43 \u03bcs\n\n\n1\n54.05 \u03bcs\n51.69 \u03bcs\n0.38 \u03bcs\n749.85 \u03bcs\n750.02 \u03bcs\n77.39 \u03bcs\n\n\n4\n1,704.57 \u03bcs\n1,593.71 \u03bcs\n0.44 \u03bcs\n990.30 \u03bcs\n1,140.77 \u03bcs\n78.66 \u03bcs\n\n\n16\n2,449.36 \u03bcs\n2,608.14 \u03bcs\n0.47 \u03bcs\n1,725.01 \u03bcs\n1,721.50 \u03bcs\n78.39 \u03bcs\n\n\n64\n7,348.40 \u03bcs\n6,665.51 \u03bcs\n0.57 \u03bcs\n5,260.28 \u03bcs\n5,295.05 \u03bcs\n79.42 \u03bcs\n\n\n256\n25,970.31 \u03bcs\n27,585.72 \u03bcs\n0.81 \u03bcs\n21,897.22 \u03bcs\n21,938.38 \u03bcs\n79.31 \u03bcs\n\n\n\nglobal\u30e2\u30b8\u30e5\u30fc\u30eb\u3082pg2\u30e2\u30b8\u30e5\u30fc\u30eb\u3082\u66f4\u65b0\u7cfb\u306e\u64cd\u4f5c\u306f\u3001\u30af\u30e9\u30b9\u30bf\u306e\u30b5\u30a4\u30ba\u306b\u6bd4\u4f8b\u3057\u3066\u51e6\u7406\u6642\u9593\u304c\u9577\u304f\u306a\u3063\u3066\u3044\u308b\u3002\n(\u4e21\u8005\u306e\u5b9f\u88c5\u7684\u306b\u3001\u691c\u7d22\u7cfb\u306f\u3001\u30ed\u30fc\u30ab\u30eb\u306eETS\u30c6\u30fc\u30d6\u30eb\u3092\u53c2\u7167\u3059\u308b\u3060\u3051\u3067\u6e08\u3080\u306e\u3067\u30af\u30e9\u30b9\u30bf\u30b5\u30a4\u30ba\u306b\u5f71\u97ff\u306f\u53d7\u3051\u306a\u3044)\n\u30af\u30e9\u30b9\u30bf\u30b5\u30a4\u30ba\u304c\u6bd4\u8f03\u7684\u5c0f\u3055\u3044\u5834\u5408\u3067\u3082\u3001\u66f4\u65b0\u7cfb\u306e\u64cd\u4f5c\u306e\u6027\u80fd\u306f\u305d\u308c\u307b\u3069\u826f\u3044\u8a33\u3067\u3082\u306a\u3044\u306e\u3067\u3001\u3053\u308c\u3089\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u591a\u7528\u306f\u907f\u3051\u305f\u65b9\u304c\u7121\u96e3\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n(\u30b7\u30b9\u30c6\u30e0\u306e\u8d77\u52d5\u6642\u306b\u4e00\u56de\u3060\u3051\u3001\u7279\u5b9a\u306b\u30d7\u30ed\u30bb\u30b9\u306b\u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u540d\u524d\u3092\u4ed8\u4e0e\u3057\u305f\u3044\u3001\u3068\u3044\u3063\u305f\u7528\u9014\u306a\u3089global\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u5341\u5206\u6709\u7528)\n\u3082\u3057\u3001\u6570\u767e\u4ee3\u53f0\u898f\u6a21\u4ee5\u4e0a\u306e\u30af\u30e9\u30b9\u30bf\u3092\u7d44\u307f\u305f\u304f\u3001\u304b\u3064\u3001\u3053\u308c\u3089\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u63d0\u4f9b\u3057\u3066\u308b\u3088\u3046\u306a\u6a5f\u80fd\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u306f\u3001\u5225\u9014\u540c\u7b49\u306e\u6a5f\u80fd\u3092\u63d0\u4f9b\u3057\u3066\u3044\u308b(\u3088\u308a\u30b9\u30b1\u30fc\u30eb\u3057\u3084\u3059\u3044)\u5916\u90e8\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u63a2\u3059\u304b\u3001\u81ea\u524d\u3067\u5b9f\u88c5\u3057\u305f\u65b9\u304c\u826f\u3055\u305d\u3046\u3002\n\n\u30b9\u30b1\u30fc\u30eb\u30a2\u30c3\u30d7\u95a2\u9023\u306e\u6027\u80fd\u6e2c\u5b9a\n\u4e00\u3064\u306e\u30ce\u30fc\u30c9\u304c\u5229\u7528\u53ef\u80fd\u306aCPU\u30b3\u30a2\u6570\u304c\u5897\u3048\u305f\u5834\u5408\u306e\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u306e\u6e2c\u5b9a\u3002\nrpc\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u624b\u8efd\u306a\u30ce\u30fc\u30c9\u9593\u901a\u4fe1\u306e\u624b\u6bb5\u3068\u3057\u3066\u4fbf\u5229\u3060\u3051\u3069\u3001\u3042\u307e\u308a\u30b9\u30b1\u30fc\u30eb\u30a2\u30c3\u30d7\u306f\u3057\u306a\u3044\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u304b\u3082\u3057\u308c\u306a\u3044\u3001\u3068\u8a00\u3044\u305f\u3044\u3060\u3051\u3002\n\u30b9\u30b1\u30fc\u30eb\u30a2\u30c3\u30d7\u3057\u306a\u3044\u7406\u7531(\u306e\u4e88\u60f3):\n\n\u5168\u3066\u306erpc\u30ea\u30af\u30a8\u30b9\u30c8\u306f\u3001\u4e00\u65e6\u5bfe\u8c61\u30ce\u30fc\u30c9\u4e0a\u306erex\u3068\u3044\u3046\u540d\u524d\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u7d4c\u7531\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\n\u305d\u306e\u305f\u3081\u3001\u591a\u6570\u306e\u30ce\u30fc\u30c9\u304b\u3089\u4e26\u5217\u3057\u3066\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u767a\u884c\u3055\u308c\u305f\u5834\u5408\u3067\u3082\u3001\u305d\u306e\u30d7\u30ed\u30bb\u30b9(\u306e\u30ad\u30e5\u30fc)\u3067\u30ea\u30af\u30a8\u30b9\u30c8\u7fa4\u304c\u76f4\u5217\u5316\u3055\u308c\u3066\u3057\u307e\u3046\n\n\nrex\u30d7\u30ed\u30bb\u30b9\u4e0a\u3067\u884c\u308f\u308c\u308b\u51e6\u7406\u81ea\u4f53\u306f\u304b\u306a\u308a\u8efd\u3044\n\u305f\u3060\u3001\u5229\u7528\u53ef\u80fd\u306aCPU\u30b3\u30a2\u304c\u5897\u3048\u308b\u306b\u5f93\u3044\u3001\u305d\u306e\u50c5\u304b\u306a\u76f4\u5217\u5316\u70b9\u304c\u5168\u4f53\u306e\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u306b\u4e0e\u3048\u308b\u5f71\u97ff\u5ea6\u306f\u5927\u304d\u304f\u306a\u308b\n\n\nref. \u30a2\u30e0\u30c0\u30fc\u30eb\u306e\u6cd5\u5247\n\n\n\n\n\n\n\u672c\u5f53\u306b\u30b9\u30b1\u30fc\u30eb\u30a2\u30c3\u30d7\u3057\u306a\u3044\u306e\u304b\u3069\u3046\u304b\u3092\u78ba\u8a8d\u3059\u308b\u306e\u304c\u3053\u3053\u3067\u306e\u76ee\u7684\n\n\u6e2c\u5b9a\u5185\u5bb9\n\u5229\u7528\u53ef\u80fd\u306aCPU\u306e\u30b3\u30a2\u6570\u306b\u5fdc\u3058\u305fRPC\u306e\u51e6\u7406\u6027\u80fd\u306e\u5909\u5316\u3092\u6e2c\u308b\u305f\u3081\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u6761\u4ef6\u3067\u6e2c\u5b9a\u3092\u884c\u3063\u305f: \n\n\u30de\u30b9\u30bf\u30fc\u30ce\u30fc\u30c9\u3092RPC\u30b5\u30fc\u30d0\u3068\u3057\u3001\u8907\u6570\u306e\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u304b\u3089\u5927\u91cf\u306eRPC\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u767a\u884c\n\u30de\u30b9\u30bf\u30fc\u30ce\u30fc\u30c9(ErlangVM)\u304c\u5229\u7528\u53ef\u80fd\u306aCPU\u30b3\u30a2\u6570\u3092\u5909\u5316\u3055\u305b\u3066\u3001\u305d\u308c\u306b\u4f34\u3046\u51e6\u7406\u6027\u80fd\u306e\u5909\u5316\u3092\u6e2c\u5b9a\n\n\n\u6b63\u78ba\u306b\u306fCPU\u30b3\u30a2\u6570\u3067\u306f\u306a\u304f\u3001ErlangVM\u4e0a\u3067\u7a3c\u50cd\u3059\u308b\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u306e\u6570\u3092\u5909\u5316\u3055\u305b\u305f\n\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u306e\u6570\u306ferlang:system_flag(schedulers_online, \u500b\u6570)\u95a2\u6570\u3067\u52d5\u7684\u306b\u8a2d\u5b9a\u53ef\u80fd(\u306e\u306f\u305a)\n\n\n\n\u4e00\u56de\u306eRPC\u306b\u8981\u3057\u305f\u5e73\u5747\u6642\u9593 \u3092\u8a08\u6e2c\n\u6e2c\u5b9a\u95a2\u6570: dist_bench:rpc_call_scaleup_bench/3 (\u5b9f\u969b\u306b\u6307\u5b9a\u3057\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u7b49\u306f\u4e0b\u306e\u5b9f\u884c\u4f8b\u3092\u53c2\u7167)\n\n\u307e\u305f\u6bd4\u8f03\u306e\u305f\u3081\u306b\u3001RPC\u3067\u306f\u306a\u304f\u3001echo\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u306b\u5bfe\u3059\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u9001\u53d7\u4fe1\u306e\u5834\u5408\u3067\u306e\u6e2c\u5b9a\u3082\u884c\u3063\u305f:\n\n\u30de\u30b9\u30bf\u30fc\u30ce\u30fc\u30c9\u4e0a\u3067echo\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u3092\u8907\u6570\u8d77\u52d5\u3057\u305f\u4e0a\u3067\u3001\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u7fa4\u304b\u3089\u5bfe\u8c61\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u3092\u884c\u306a\u3046\n\n\n\u8d77\u52d5\u3059\u308becho\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u306e\u6570\u306f \u5229\u7528\u53ef\u80fd\u306a\u30b3\u30a2\u6570*4 \u3068\u3057\u305f\n\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u51e6\u7406\u3059\u308b\u30d7\u30ed\u30bb\u30b9\u304c\u5206\u6563\u3059\u308b\u305f\u3081\u3001\u30b3\u30a2\u6570\u306b\u5fdc\u3058\u3066\u826f\u597d\u306b\u30b9\u30b1\u30fc\u30eb\u3059\u308b\u3053\u3068\u3092\u671f\u5f85\n\n\n\n\u4e00\u56de\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1\u306b\u8981\u3057\u305f\u5e73\u5747\u6642\u9593 \u3092\u8a08\u6e2c\n\u6e2c\u5b9a\u95a2\u6570: dist_bench:pid_msg_echo_scaleup_bench/3 (\u5b9f\u969b\u306b\u6307\u5b9a\u3057\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u7b49\u306f\u4e0b\u306e\u5b9f\u884c\u4f8b\u3092\u53c2\u7167)\n\n%% \u5b9f\u884c\u4f8b:\n\n%% \u4f7f\u7528CPU\u30b3\u30a2\u6570=8 \u3067\u3001RPC\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30c3\u30d7\u5ea6\u6e2c\u5b9a\u95a2\u6570\u3092\u5b9f\u884c\u3059\u308b\n> dist_bench:do_bench(dist_bench:make_node_specs(Hosts, 9), 5,\n                      fun () -> dist_bench:rpc_call_scaleup_bench(400000, 8, nodes()) end)\n\n%% \u4f7f\u7528CPU\u30b3\u30a2\u6570=8 \u3067\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1(+ echo\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u8907\u88fd)\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30c3\u30d7\u5ea6\u6e2c\u5b9a\u95a2\u6570\u3092\u5b9f\u884c\u3059\u308b\n> dist_bench:do_bench(dist_bench:make_node_specs(Hosts, 9), 5,\n                      fun () -> dist_bench:pid_msg_echo_scaleup_bench(400000, 8, nodes()) end).\n\n\n\u6e2c\u5b9a\u7d50\u679c\n\n\n\nCPU\u30b3\u30a2\u6570\n\u8907\u6570echo\u30b5\u30fc\u30d0\nRPC\n\n\n\n\n1\n10.147 \u03bcs\n39.781 \u03bcs\n\n\n2\n3.440 \u03bcs\n21.818 \u03bcs\n\n\n4\n1.864 \u03bcs\n21.186 \u03bcs\n\n\n8\n1.663 \u03bcs\n21.388 \u03bcs\n\n\n16\n1.915 \u03bcs\n20.740 \u03bcs\n\n\n32\n1.993 \u03bcs\n22.576 \u03bcs\n\n\n\n\u8907\u6570echo\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u306b\u5bfe\u3059\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1\u3067\u306f\u3001\u30b3\u30a2\u6570\u306e\u5897\u52a0\u306b\u4f34\u3044\u3001\u6700\u5927\u3067\u516d\u500d\u7a0b\u5ea6\u307e\u3067\u6027\u80fd\u304c\u5411\u4e0a\u3057\u3066\u3044\u308b\u304c\u3001RPC\u3092\u4f7f\u3063\u305f\u5834\u5408\u306f\u6027\u80fd\u5411\u4e0a\u306f\u4e8c\u500d\u7a0b\u5ea6\u306b\u7559\u307e\u3063\u3066\u3044\u308b\u3002\n(\u524d\u8005\u306e\u30b9\u30b1\u30fc\u30eb\u5ea6\u5408\u3044\u304c\u516d\u500d\u306b\u7559\u307e\u3063\u3066\u3044\u308b\u306e\u306f\u3001\u304a\u305d\u3089\u304f\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4f5c\u308a\u304c\u60aa\u3044\u305f\u3081\u3002\u3061\u3083\u3093\u3068\u66f8\u3051\u3070\u3001\u7269\u7406\u30b3\u30a2\u306e\u6570(= 16)\u306e\u5206\u307e\u3067\u306f\u30b9\u30b1\u30fc\u30eb\u3057\u3066\u304f\u308c\u308b\u3053\u3068\u3092\u671f\u5f85\u3057\u305f\u3044)\nrpc\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30c3\u30d7\u5ea6\u5408\u3044\u304c\u5c0f\u3055\u3044\u3068\u3044\u3063\u3066\u3082\u3001\u4eca\u56de\u306e\u6e2c\u5b9a\u306b\u5f93\u3048\u3070\u3001\u4e00\u3064\u306e\u30ce\u30fc\u30c9\u3067(\u6700\u5927\u3067)\u79d2\u9593\u306b\u4e94\u4e07\u30ea\u30af\u30a8\u30b9\u30c8\u7a0b\u5ea6\u306f\u634c\u3051\u308b\u8a08\u7b97\u3068\u306a\u308b\u306e\u3067\u3001\u9069\u6750\u9069\u6240\u3067\u4f7f\u3046\u5206\u306b\u306f\u554f\u984c\u3068\u306a\u308b\u3053\u3068\u306f\u5c11\u306a\u3055\u305d\u3046\u3002\n\n\u611f\u60f3\n\u4eca\u56de\u306e(\u304b\u306a\u308a\u7c21\u6613\u7684\u306a)\u6e2c\u5b9a\u306e\u7d50\u679c\u3092\u898b\u308b\u9650\u308a\u3067\u306f\u3001\u30ce\u30fc\u30c9\u7ba1\u7406\u5468\u308a\u3084\u30ce\u30fc\u30c9\u9593\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1\u3001\u30d7\u30ed\u30bb\u30b9\u306e\u6b7b\u6d3b\u76e3\u8996\u3001\u3068\u3044\u3063\u305f\u5206\u6563Erlang\u306e\u672c\u5f53\u306b\u57fa\u790e\u7684\u306a\u90e8\u5206(\u6a5f\u80fd)\u306b\u95a2\u3057\u3066\u3044\u3048\u3070\u3001\u6570\u767e\u30ce\u30fc\u30c9\u898f\u6a21\u3067\u3082\u7279\u306b\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u306b\u306f\u554f\u984c\u306a\u3055\u305d\u3046\u306a\u5370\u8c61\u3060\u3063\u305f\u3002\n(\u671f\u5f85\u901a\u308a\u306e\u6027\u80fd\u304c\u51fa\u3066\u304a\u308a\u3001\u5909\u306a\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u7b49\u306f\u306a\u3055\u305d\u3046\u3060\u3063\u305f)\n\u9006\u306b\u3001\u6a19\u6e96\u3067\u914d\u5e03\u3055\u308c\u3066\u3044\u308b\u5206\u6563\u7cfb\u306e\u30e9\u30a4\u30d6\u30e9\u30ea(ex. global\u30e2\u30b8\u30e5\u30fc\u30eb)\u306f\u3001\u30af\u30e9\u30b9\u30bf\u30b5\u30a4\u30ba\u304c\u305d\u3053\u307e\u3067\u5927\u304d\u304f\u306f\u306a\u3089\u306a\u3044\u3053\u3068\u3092\u60f3\u5b9a\u3057\u305f\u4f5c\u308a\u306b\u306a\u3063\u3066\u3044\u308b\u3082\u306e\u304c\u591a\u305d\u3046\u306b\u898b\u3048\u308b(\u79c1\u898b)\u306e\u3067\u3001\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u6ce8\u610f\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u305d\u3046\u3002\n(\u304a\u305d\u3089\u304f\u306f\u5225\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u9078\u629e\u3057\u305f\u65b9\u304c\u61f8\u547d\u3002\u6628\u65e5\u7d39\u4ecb\u3055\u308c\u3066\u3044\u305friak_core\u306f\u305d\u306e\u5019\u88dc\uff1f)\n\u500b\u4eba\u7684\u306b\u306f\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1\u7b49\u3068\u3044\u3063\u305f\u4e0b\u56de\u308a\u306e\u6a5f\u80fd\u304c\u3061\u3083\u3093\u3068\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308b\u3060\u3051\u3067\u3082\u3060\u3044\u3076\u52a9\u304b\u308b\u306e\u3067\u3001\u5f8c\u306f(\u4eca\u56de\u306f\u8003\u616e\u304b\u3089\u5b8c\u5168\u306b\u5916\u3057\u305f\u304c)\u5b89\u5b9a\u6027\u7b49\u3068\u3044\u3063\u305f\u6027\u80fd\u4ee5\u5916\u306e\u9762\u3067\u554f\u984c\u304c\u306a\u3044\u304b\u3069\u3046\u304b\u3092\u78ba\u8a8d\u3057\u3066\u307f\u3066\u3001\u3082\u3057\u5927\u4e08\u592b\u305d\u3046\u306a\u3089\u5206\u6563Erlang\u306f\u3001\u305d\u3053\u305d\u3053\u5927\u304d\u306a\u898f\u6a21\u306e\u30af\u30e9\u30b9\u30bf\u3092\u6271\u3046\u305f\u3081\u306e\u57fa\u677f\u3068\u3057\u3066\u7d50\u69cb\u91cd\u5b9d\u3057\u305d\u3046\u3060\u3068\u601d\u3046\u3002\n(\u305d\u3082\u305d\u3082\u6027\u80fd\u5468\u308a\u3082\u3001\u3082\u3063\u3068\u3061\u3083\u3093\u3068\u3057\u305f\u6e2c\u5b9a\u3092\u884c\u3046\u5fc5\u8981\u304c\u3042\u308b\u3001\u3068\u3044\u3046\u8a71\u306f\u7f6e\u3044\u3066\u304a\u3044\u3066...)\n\n\u6e2c\u5b9a\u7528\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n\ndist_bench.erl\n-module(dist_bench).\n\n%%% External API\n-export([\n         %% utility\n         make_node_specs/2,\n         setup_nodes/1,\n         do_bench/3,\n\n         %% scale out benchmarks\n         pid_msg_echo_bench/2,\n         name_msg_echo_bench/2,\n         rpc_call_bench/2,\n         monitor_bench/2,\n         global_bench/1,\n         pg2_bench/2,\n\n         %% scale up benchmarks\n         pid_msg_echo_scaleup_bench/3,\n         rpc_call_scaleup_bench/3\n        ]).\n\n\n%%% Internal API\n-export([\n         echo_server_start/1,\n         do_echo/2,\n         do_rpc_call/2,\n         make_echo_msg/1\n        ]).\n\n\n%%% Types\n-export_type([\n              node_spec/0,\n              node_specs/0,\n              microseconds/0\n             ]).\n\n-type node_spec() :: {HostName::atom(), NodeCount::non_neg_integer()}. % `HostName'\u4e0a\u3067\u4f55\u500b\u306e\u30ce\u30fc\u30c9\u3092\u8d77\u52d5\u3059\u308b\u304b\n-type node_specs() :: [node_spec()].\n\n-type microseconds() :: non_neg_integer().\n\n\n%%% External Functions: Utility\n\n%% @doc `TotalNodeCount'\u3067\u6307\u5b9a\u3055\u308c\u305f\u6570\u306e\u30ce\u30fc\u30c9\u7fa4\u3092\u751f\u6210\u3059\u308b\u305f\u3081\u306e`node_specs()'\u3092\u751f\u6210\u3057\u3066\u8fd4\u3059\n%%\n%% `HostNames'\u3067\u6307\u5b9a\u3055\u308c\u305f\u5404\u30de\u30b7\u30f3\u4e0a\u3067\u8d77\u52d5\u3055\u308c\u308b\u30ce\u30fc\u30c9\u6570\u306f\u3001\u6975\u529b\u7b49\u3057\u3044\u6570\u306b\u306a\u308b\u3088\u3046\u306b\u8abf\u6574\u3055\u308c\u308b\n%%\n%% ```\n%% > make_node_specs([a,b,c], 10).\n%% [{a,4},{b,3},{c,3}]\n%% '''\n-spec make_node_specs([HostName::atom()], TotalNodeCount::non_neg_integer()) -> node_specs().\nmake_node_specs(HostNames, TotalNodeCount) ->\n    PerHostNodeCount = TotalNodeCount div length(HostNames),\n    RemainderCount = TotalNodeCount rem length(HostNames),\n    {Specs, _} =\n        lists:mapfoldl(\n          fun (Host, Rem) ->\n                  {{Host, PerHostNodeCount + min(1, Rem)}, max(0, Rem - 1)}\n          end,\n          RemainderCount,\n          HostNames),\n    Specs.\n\n%% @doc \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u7fa4\u3092\u8d77\u52d5\u3059\u308b\n%%\n%% \u547c\u3073\u51fa\u3057\u5143\u30d7\u30ed\u30bb\u30b9\u304c\u7d42\u4e86\u3057\u305f\u5834\u5408\u3001\u8d77\u52d5\u3057\u305f\u30ce\u30fc\u30c9\u7fa4\u3082\u81ea\u52d5\u3067\u7d42\u4e86\u3059\u308b(\u30ea\u30f3\u30af\u304c\u8cbc\u3089\u308c\u3066\u3044\u308b)\n-spec setup_nodes(node_specs()) -> {SlaveNodeCount, StartAverateTime} when\n      SlaveNodeCount   :: non_neg_integer(), % \u8d77\u52d5\u3057\u305f\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u306e\u6570\n      StartAverateTime :: microseconds().    % \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u306e\u8d77\u52d5\u306b\u8981\u3057\u305f\u6642\u9593\u306e\u5e73\u5747\u5024\nsetup_nodes(NodeSpecs) ->\n    [] = nodes(),\n    Tooks =\n        lists:append(\n          [[begin\n                NodeName = list_to_atom(lists:flatten(io_lib:format(\"slave_~p\", [I]))), % \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u306e\u540d\u524d\u306f'slave_\u901a\u3057\u756a\u53f7'\u5f62\u5f0f\n                {Took, {ok, _}} = timer:tc(fun () -> slave:start_link(HostName, NodeName) end),\n                Took\n            end || I <- lists:seq(0, NodeCount - 1)]\n           || {HostName, NodeCount} <- NodeSpecs]),\n\n    {_, Bin, File} = code:get_object_code(?MODULE),\n    rpc:multicall(nodes(), code, load_binary, [?MODULE, File, Bin]),\n\n    TookAverage = lists:sum(Tooks) / max(1, length(Tooks)),\n    {length(Tooks), TookAverage}.\n\n%% @doc \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u7fa4\u3092\u6e96\u5099\u3057\u305f\u5f8c\u306b\u3001`BenchFun'\u3067\u6307\u5b9a\u3055\u308c\u305f\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u5b9f\u884c\u3059\u308b\n-spec do_bench(node_specs(), BenchCount, BenchFun) -> [Result] when\n      BenchCount :: non_neg_integer(),  % `BenchFun'\u3092\u4f55\u56de\u5b9f\u884c\u3059\u308b\u304b\n      BenchFun   :: fun (() -> Result), % \u500b\u3005\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u5b9f\u884c\u3059\u308b\u95a2\u6570\n      Result     :: term().\ndo_bench(NodeSpecs, BenchCount, BenchFun) ->\n    {Pid, Monitor} =\n        spawn_monitor(\n          fun () -> % \u30d9\u30f3\u30c1\u30de\u30fc\u30af\u7d42\u4e86\u6642\u306b\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u7fa4\u3092\u78ba\u5b9f\u306b\u7d42\u4e86\u3055\u305b\u305f\u3044\u306e\u3067\u3001\u5225\u30d7\u30ed\u30bb\u30b9\u3067\u5b9f\u884c\u3059\u308b\n                  io:format(\"# setup nodes ... \"),\n                  {NodeCount, StartAverateTime} = setup_nodes(NodeSpecs),\n                  io:format(\"done: count=~p, start_avg_time=~p sec\\n\", [NodeCount, StartAverateTime / 1000000]),\n\n                  Results =\n                      [begin\n                           io:format(\"# [~p] do bench ... \", [I]),\n                           lists:foreach(fun erlang:garbage_collect/1, erlang:processes()),\n                           {Took, Result} = timer:tc(BenchFun),\n                           io:format(\"done: time=~p sec\\n\", [Took / 1000000]),\n                           Result\n                       end || I <- lists:seq(1, BenchCount)],\n                  io:format(\"\\n\"),\n                  exit({bench_finished, Results})\n          end),\n    receive\n        {'DOWN', Monitor, _, _, Reason} ->\n            case Reason of\n                {bench_finished, Results} -> Results;\n                _ -> error({bench_process_down, Pid, Reason})\n            end\n    end.\n\n\n%%% External Functions: Scale Out Benchmarks\n\n%% @doc PID\u6307\u5b9a\u306b\u3088\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u6027\u80fd\u3092\u6e2c\u5b9a\u3059\u308b\u305f\u3081\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u95a2\u6570\n-spec pid_msg_echo_bench(non_neg_integer(), [node()]) -> AverageEchoTime::microseconds().\npid_msg_echo_bench(EchoCount, Nodes) ->\n    %% 1) \u30ea\u30e2\u30fc\u30c8\u30ce\u30fc\u30c9\u3067echo\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3059\u308b\n    RemoteProcs = [spawn_link(Node, ?MODULE, echo_server_start, [undefined]) || Node <- Nodes],\n\n    %% 2) `EchoCount'\u56de\u3060\u3051\u30ea\u30e2\u30fc\u30c8\u30ce\u30fc\u30c9\u4e0a\u306e\u30d7\u30ed\u30bb\u30b9\u3068\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u3084\u308a\u3068\u308a(echo)\u3057\u3001\u305d\u306e\u6240\u8981\u6642\u9593\u3092\u6e2c\u5b9a\u3059\u308b\n    {MicroSeconds, _} =timer:tc(fun () -> do_echo(EchoCount, RemoteProcs) end),\n\n    %% 3) \u5f8c\u59cb\u672b\n    lists:foreach(fun (Pid) -> unlink(Pid), exit(Pid, kill) end, RemoteProcs),\n    MicroSeconds / EchoCount.  % \u4e00\u56de\u306e\u3084\u308a\u3068\u308a\u306b\u8981\u3057\u305f\u5e73\u5747\u6642\u9593\u3092\u8fd4\u3059\n\n%% @doc \u30d7\u30ed\u30bb\u30b9\u540d\u6307\u5b9a\u306b\u3088\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1(+ PID\u6307\u5b9a\u306b\u3088\u308b\u53d7\u4fe1)\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u6027\u80fd\u3092\u6e2c\u5b9a\u3059\u308b\u305f\u3081\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u95a2\u6570\n-spec name_msg_echo_bench(non_neg_integer(), [node()]) -> AverageEchoTime::microseconds().\nname_msg_echo_bench(EchoCount, Nodes) ->\n    %% 1) \u30ea\u30e2\u30fc\u30c8\u30ce\u30fc\u30c9\u3067echo\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3059\u308b\n    RemoteProcs = [spawn_link(Node, ?MODULE, echo_server_start, [echo_server]) || Node <- Nodes],\n    RemoteNames = [{echo_server, node(Pid)} || Pid <- RemoteProcs],\n    timer:sleep(100), % NOTE: \u30ea\u30e2\u30fc\u30c8\u30ce\u30fc\u30c9\u4e0a\u3067\u306e\u540d\u524d\u767b\u9332\u304c\u5b8c\u4e86\u3059\u308b\u306e\u3092\u9069\u5f53\u306a\u6642\u9593\u3060\u3051\u5f85\u3064 (sleep\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u306f\u624b\u629c\u304d)\n\n    %% 2) `EchoCount'\u56de\u3060\u3051\u30ea\u30e2\u30fc\u30c8\u30ce\u30fc\u30c9\u4e0a\u306e\u30d7\u30ed\u30bb\u30b9\u3068\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u3084\u308a\u3068\u308a(echo)\u3057\u3001\u305d\u306e\u6240\u8981\u6642\u9593\u3092\u6e2c\u5b9a\u3059\u308b\n    {MicroSeconds, _} = timer:tc(fun () -> do_echo(EchoCount, RemoteNames) end),\n\n    %% 3) \u5f8c\u59cb\u672b\n    lists:foreach(fun (Pid) -> unlink(Pid), exit(Pid, kill) end, RemoteProcs),\n    MicroSeconds / EchoCount.  % \u4e00\u56de\u306e\u3084\u308a\u3068\u308a\u306b\u8981\u3057\u305f\u5e73\u5747\u6642\u9593\u3092\u8fd4\u3059\n\n%% @doc rpc\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u7528\u3044\u305f\u95a2\u6570\u547c\u3073\u51fa\u3057\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u6027\u80fd\u3092\u6e2c\u5b9a\u3059\u308b\u305f\u3081\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u95a2\u6570\n-spec rpc_call_bench(non_neg_integer(), [node()]) -> AverageCallTime::microseconds().\nrpc_call_bench(CallCount, Nodes) ->\n    %% 1) `CallCount'\u56de\u3060\u3051\u30ea\u30e2\u30fc\u30c8\u30ce\u30fc\u30c9\u306b\u5bfe\u3057\u3066RPC\u547c\u3073\u51fa\u3057\u3092\u884c\u3044\u3001\u305d\u306e\u6240\u8981\u6642\u9593\u3092\u6e2c\u5b9a\u3059\u308b\n    {MicroSeconds, _} = timer:tc(fun () -> do_rpc_call(CallCount, Nodes) end),\n    MicroSeconds / CallCount.\n\n%% @doc `erlang:monitor/2'\u3092\u7528\u3044\u305f\u30d7\u30ed\u30bb\u30b9\u6b7b\u6d3b\u76e3\u8996\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u6027\u80fd\u3092\u6e2c\u5b9a\u3059\u308b\u305f\u3081\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u95a2\u6570\n-spec monitor_bench(non_neg_integer(), [node()]) -> AverateTime::microseconds().\nmonitor_bench(ProcessCount, Nodes) ->\n    %% 1) \u30ea\u30e2\u30fc\u30c8\u30ce\u30fc\u30c9\u4e0a\u3067`ProcessCount'\u500b\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u751f\u6210\u3059\u308b\n    RemoteProcs = [spawn(Node, timer, sleep, [infinity]) ||\n                      Node <- Nodes,\n                      _    <- lists:seq(1, ProcessCount, length(Nodes))], % NOTE: \u5270\u4f59\u5206\u304c\u6368\u3066\u3089\u308c\u3066\u3057\u307e\u3046\n    RealProcessCount = length(RemoteProcs),\n\n    %% 2) \u30ea\u30e2\u30fc\u30c8\u30d7\u30ed\u30bb\u30b9\u7fa4\u306b\u5bfe\u3059\u308b\u76e3\u8996\u767b\u9332\u304a\u3088\u3073\u30c0\u30a6\u30f3\u901a\u77e5\u306e\u53d7\u4fe1\u306b\u639b\u304b\u3063\u305f\u6642\u9593\u3092\u6e2c\u5b9a\u3059\u308b\n    {MicroSeconds, _} =\n    timer:tc(\n      fun () ->\n                  lists:foreach(fun (Pid) -> monitor(process, Pid) end, RemoteProcs),\n          lists:foreach(fun (Pid) -> exit(Pid, kill) end, RemoteProcs),\n          wait_downs(RealProcessCount) % \u5168\u3066\u306e\u76e3\u8996\u30d7\u30ed\u30bb\u30b9\u306e'DOWN'\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u3051\u53d6\u308b\u307e\u3067\u5f85\u6a5f\u3059\u308b\n      end),\n    MicroSeconds / RealProcessCount.\n\n%% @doc global\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u5404\u7a2e\u95a2\u6570\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u6027\u80fd\u3092\u6e2c\u5b9a\u3059\u308b\u305f\u3081\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u95a2\u6570\n-spec global_bench(NameCount) -> [ResultEntry] when\n      NameCount   :: non_neg_integer(), % \u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u30d7\u30ed\u30bb\u30b9\u540d\u306e\u767b\u9332/\u89e3\u9664/\u691c\u7d22\u3092\u4f55\u56de\u884c\u306a\u3046\u304b\n      ResultEntry :: {register, microseconds()}   % `global:register_name/2'\u547c\u3073\u51fa\u3057\u306e\u5e73\u5747\u6240\u8981\u6642\u9593\n                   | {unregister, microseconds()} % `global:unregister_name/2'\u547c\u3073\u51fa\u3057\u306e\u5e73\u5747\u6240\u8981\u6642\u9593\n                   | {whereis, microseconds()}.   % `global:whereis_name/2'\u547c\u3073\u51fa\u3057\u306e\u5e73\u5747\u6240\u8981\u6642\u9593\nglobal_bench(NameCount) ->\n    %% 1) \u30d9\u30f3\u30c1\u30de\u30fc\u30af\u306b\u7528\u3044\u308b\u540d\u524d\u304a\u3088\u3073\u30d7\u30ed\u30bb\u30b9\u306e\u6e96\u5099\n    Names = [{?MODULE, I} || I <- lists:seq(1, NameCount)],\n    Procs = [spawn_link(timer, sleep, [infinity]) || _ <- lists:seq(1, NameCount)],\n    Pairs = lists:zip(Names, Procs),\n\n    %% 2) \u5404\u7a2e\u95a2\u6570\u306e\u5b9f\u884c\u6642\u9593\u3092\u6e2c\u5b9a\n    {RegisterMicros, _} = % \u767b\u9332\n        timer:tc(\n          fun () -> lists:foreach(fun ({Name, Proc}) -> yes = global:register_name(Name, Proc) end, Pairs) end),\n    {WhereisMicros, _} =  % \u691c\u7d22\n        timer:tc(\n          fun () -> lists:foreach(fun ({Name, Proc}) -> Proc = global:whereis_name(Name) end, Pairs) end),\n    {UnregisterMicros, _} = % \u767b\u9332\u89e3\u9664\n        timer:tc(\n          fun () -> lists:foreach(fun (Name) -> global:unregister_name(Name) end, Names) end),\n\n    %% 3) \u5f8c\u59cb\u672b\n    lists:foreach(fun (Pid) -> unlink(Pid), exit(Pid, kill) end, Procs),\n    [\n     {register, RegisterMicros / NameCount},\n     {unregister, UnregisterMicros / NameCount},\n     {whereis, WhereisMicros / NameCount}\n    ].\n\n%% @doc pg2\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u5404\u7a2e\u95a2\u6570\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u6027\u80fd\u3092\u6e2c\u5b9a\u3059\u308b\u305f\u3081\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u95a2\u6570\n-spec pg2_bench(GroupCount, MemberCount) -> [ResultEntry] when\n      GroupCount :: non_neg_integer(),  % `pg2:create/1'\u3092\u4f7f\u3063\u3066\u4f5c\u6210\u3059\u308b\u30b0\u30eb\u30fc\u30d7\u306e\u6570\n      MemberCount :: non_neg_integer(), % `pg2:join/2'\u3092\u4f7f\u3063\u3066\u30b0\u30eb\u30fc\u30d7\u306b\u53c2\u52a0\u3055\u305b\u308b\u30d7\u30ed\u30bb\u30b9\u306e\u6570\n      ResultEntry :: {create, microseconds()} % `pg2:create/1'\u547c\u3073\u51fa\u3057\u306e\u5e73\u5747\u6240\u8981\u6642\u9593\n                   | {join, microseconds()}   % `pg2:join/2'\u547c\u3073\u51fa\u3057\u306e\u5e73\u5747\u6240\u8981\u6642\u9593\n                   | {select, microseconds()}.   % `pg2:get_closest_pid/1'\u547c\u3073\u51fa\u3057\u306e\u5e73\u5747\u6240\u8981\u6642\u9593\npg2_bench(GroupCount, MemberCount) ->\n    %% 1) \u30d9\u30f3\u30c1\u30de\u30fc\u30af\u306b\u7528\u3044\u308b\u30b0\u30eb\u30fc\u30d7\u540d\u304a\u3088\u3073\u30d7\u30ed\u30bb\u30b9\u306e\u6e96\u5099\n    [] = pg2:which_groups(),\n    Groups = [{group, I} || I <- lists:seq(1, GroupCount)],\n    Members = [spawn_link(timer, sleep, [infinity]) || _ <- lists:seq(1, MemberCount)],\n\n    %% 2) \u5404\u7a2e\u95a2\u6570\u306e\u5b9f\u884c\u6642\u9593\u3092\u6e2c\u5730\n    {CreateMicros, _} =\n        timer:tc(\n          fun () -> lists:foreach(fun pg2:create/1, Groups) end),\n    {JoinMicros, _} =\n        timer:tc(\n          fun () -> lists:foreach(fun (Pid) -> ok = pg2:join(hd(Groups), Pid) end, Members) end),\n    {SelectMicros, _} =\n        timer:tc(\n          fun () -> lists:foreach(fun (_) -> true = is_pid(pg2:get_closest_pid(hd(Groups))) end, Members) end),\n\n    %% 3) \u5f8c\u59cb\u672b\n    lists:foreach(fun pg2:delete/1, Groups),\n    lists:foreach(fun (Pid) -> unlink(Pid), exit(Pid, kill) end, Members),\n    [\n     {create, CreateMicros / GroupCount},\n     {join, JoinMicros / MemberCount},\n     {select, SelectMicros / MemberCount}\n    ].\n\n\n%%% External Functions: Scale Up Benchmarks\n\n%% @doc PID\u6307\u5b9a\u306b\u3088\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30c3\u30d7\u6027\u80fd\u3092\u6e2c\u5b9a\u3059\u308b\u305f\u3081\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u95a2\u6570\n-spec pid_msg_echo_scaleup_bench(non_neg_integer(), non_neg_integer(), [node()]) -> AverageEchoTime::microseconds().\npid_msg_echo_scaleup_bench(EchoCount, SchedulersOnline, Nodes) ->\n    %% 1) \u5229\u7528\u53ef\u80fd\u306a\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u6570(\u2252  CPU\u30b3\u30a2\u6570)\u3092\u5236\u9650\u3059\u308b\n    OldSchedulersOnline = erlang:system_flag(schedulers_online, SchedulersOnline),\n\n    %% 2) \u81ea\u30ce\u30fc\u30c9\u306becho\u30b5\u30fc\u30d0\u7fa4\u3092\u8d77\u52d5\u3059\u308b\n    EchoServerCount = SchedulersOnline * 4, % \u5229\u7528\u53ef\u80fd\u306a\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u6570\u306e\u56db\u500d\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3057\u3066\u304a\u304f\n    EchoServers = [spawn_link(?MODULE, echo_server_start, [undefined]) || _ <- lists:seq(1, EchoServerCount)],\n\n    %% 3) `Nodes'\u4e0a\u3067\u3001echo\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u7fa4\u3092\u5b9f\u884c\u3057\u3001\u5168\u3066\u306e\u51e6\u7406\u304c\u5b8c\u4e86\u3059\u308b\u307e\u3067\u306e\u6240\u8981\u6642\u9593\u3092\u8a08\u6e2c\u3059\u308b\n    PerNodeEchoCount = EchoCount div length(Nodes), % NOTE: \u5270\u4f59\u5206\u304c\u6368\u3066\u3089\u308c\u3066\u3057\u307e\u3046\n    RealEchoCount = PerNodeEchoCount * length(Nodes),\n    {MicroSeconds, _} =\n        timer:tc(\n          fun () ->\n                  EchoClients = [monitor(process, spawn(Node, ?MODULE, do_echo, [PerNodeEchoCount, EchoServers])) || Node <- Nodes],\n                  wait_downs(length(EchoClients)) % \u5168\u3066\u306eecho\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u7d42\u4e86\u3059\u308b\u306e\u5f85\u3064\n          end),\n\n    %% 4) \u5f8c\u59cb\u672b\n    lists:foreach(fun (Pid) -> unlink(Pid), exit(Pid, kill) end, EchoServers),\n    SchedulersOnline = erlang:system_flag(schedulers_online, OldSchedulersOnline),\n    MicroSeconds / RealEchoCount.\n\n%% @doc PID\u6307\u5b9a\u306b\u3088\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30c3\u30d7\u6027\u80fd\u3092\u6e2c\u5b9a\u3059\u308b\u305f\u3081\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u95a2\u6570\n-spec rpc_call_scaleup_bench(non_neg_integer(), non_neg_integer(), [node()]) -> AverageCallTime::microseconds().\nrpc_call_scaleup_bench(CallCount, SchedulersOnline, Nodes) ->\n    %% 1) \u5229\u7528\u53ef\u80fd\u306a\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u6570(\u2252  CPU\u30b3\u30a2\u6570)\u3092\u5236\u9650\u3059\u308b\n    OldSchedulersOnline = erlang:system_flag(schedulers_online, SchedulersOnline),\n\n    %% 3) `Nodes'\u4e0a\u3067\u3001echo\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u7fa4\u3092\u5b9f\u884c\u3057\u3001\u5168\u3066\u306e\u51e6\u7406\u304c\u5b8c\u4e86\u3059\u308b\u307e\u3067\u306e\u6240\u8981\u6642\u9593\u3092\u8a08\u6e2c\u3059\u308b\n    PerNodeCallCount = CallCount div length(Nodes), % NOTE: \u5270\u4f59\u5206\u304c\u6368\u3066\u3089\u308c\u3066\u3057\u307e\u3046\n    RealCallCount = PerNodeCallCount * length(Nodes),\n    {MicroSeconds, _} =\n        timer:tc(\n          fun () ->\n                  CallClients = [monitor(process, spawn(Node, ?MODULE, do_rpc_call, [PerNodeCallCount, [node()]])) || Node <- Nodes],\n                  wait_downs(length(CallClients)) % \u5168\u3066\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u7d42\u4e86\u3059\u308b\u306e\u5f85\u3064\n          end),\n\n    %% 4) \u5f8c\u59cb\u672b\n    SchedulersOnline = erlang:system_flag(schedulers_online, OldSchedulersOnline),\n    MicroSeconds / RealCallCount.\n\n\n%%% Internal Functions\n\n%% @doc `Servers'\u3067\u6307\u5b9a\u3055\u308c\u305f\u30d7\u30ed\u30bb\u30b9\u7fa4\u3068\u306e\u9593\u3067\u3001\u5408\u8a08\u3067`EchoCount'\u500b\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u3084\u308a\u3068\u308a\u3059\u308b\n-spec do_echo(non_neg_integer(), [Server]) -> ok when Server :: pid() | {atom(), node()}.\ndo_echo(EchoCount, Servers) ->\n    send_messages(EchoCount, Servers, Servers), % echo\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\n    wait_messages(EchoCount). % echoback\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5f85\u3064 (NOTE: \u73fe\u72b6\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u4e2d\u8eab\u306b\u306f\u8003\u616e\u3057\u3066\u3044\u306a\u3044)\n\n-spec send_messages(non_neg_integer(), [Server], [Server]) -> ok when Server :: pid() | {atom(), node()}.\nsend_messages(0, _, _)                -> ok;\nsend_messages(N, [], Servers)         -> send_messages(N, Servers, Servers); % \u4e00\u5de1\u3057\u305f\u306e\u3067\u6700\u521d\u306b\u623b\u308b\nsend_messages(N, [S | Rest], Servers) ->\n    S ! {self(), N},\n    send_messages(N - 1, Rest, Servers).\n\n%% @doc `Count'\u500b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u307e\u3067\u5f85\u6a5f\u3059\u308b (\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u5185\u5bb9\u306b\u306f\u95a2\u77e5\u3057\u306a\u3044)\n-spec wait_messages(Count::non_neg_integer()) -> ok.\nwait_messages(0) -> ok;\nwait_messages(N) -> receive _ -> wait_messages(N - 1) end.\n\n-spec wait_downs(Count::non_neg_integer()) -> ok.\nwait_downs(0) -> ok;\nwait_downs(N) ->  receive {'DOWN', _, _, _, _} -> wait_downs(N - 1) end.\n\n%% @doc `Nodes'\u3067\u6307\u5b9a\u3055\u308c\u305f\u30ce\u30fc\u30c9\u7fa4\u306b\u5bfe\u3057\u3066\u3001\u5408\u8a08\u3067`CallCount'\u56de\u306eRPC\u547c\u3073\u51fa\u3057\u3092\u884c\u306a\u3046\n-spec do_rpc_call(non_neg_integer(), [node()]) -> ok.\ndo_rpc_call(CallCount, Nodes) ->\n    rpc_async_calls(CallCount, Nodes, Nodes),\n    wait_messages(CallCount). % RPC\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u5f85\u3064 (NOTE: \u73fe\u72b6\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u4e2d\u8eab\u306b\u306f\u8003\u616e\u3057\u3066\u3044\u306a\u3044)\n\n-spec rpc_async_calls(non_neg_integer(), [node()], [node()]) -> ok.\nrpc_async_calls(0, _, _)                -> ok;\nrpc_async_calls(N, [], Nodes)           -> rpc_async_calls(N, Nodes, Nodes);% \u4e00\u5de1\u3057\u305f\u306e\u3067\u6700\u521d\u306b\u623b\u308b\nrpc_async_calls(N, [Dst | Rest], Nodes) ->\n    rpc:async_call(Dst, ?MODULE, make_echo_msg, [N]),\n    rpc_async_calls(N - 1, Rest, Nodes).\n\n%% @doc \u30a8\u30b3\u30fc\u30b5\u30fc\u30d0\u3092\u8d77\u52d5\u3059\u308b\n-spec echo_server_start(Name) -> no_return() when Name :: atom() | undefined.\necho_server_start(undefined) ->\n    echo_server_loop();\necho_server_start(Name) ->\n    true = register(Name, self()), % `Name =/= undefined'\u306a\u3089\u540d\u524d\u4ed8\u304d\u30d7\u30ed\u30bb\u30b9\u3068\u3057\u3066\u8d77\u52d5\u3059\u308b\n    echo_server_loop().\n\n-spec echo_server_loop() -> no_return().\necho_server_loop() ->\n    receive\n        {From, Msg} ->\n            From ! make_echo_msg(Msg),\n            echo_server_loop()\n    end.\n\n-spec make_echo_msg(term()) -> term().\nmake_echo_msg(Msg) ->\n    {self(), Msg}.\n\n\n\u4eca\u65e5\u306fErlang\u306e\u5185\u90e8\u5b9f\u88c5\u5468\u308a\u306e\u8a18\u4e8b\u3092\u66f8\u304d\u305f\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u305d\u308c\u306f\u6e96\u5099\u304c\u9593\u306b\u5408\u3044\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u4ee3\u308f\u308a\u306b\u5206\u6563Erlang\u306b\u95a2\u9023\u3059\u308b\u6a5f\u80fd\u306e\u6027\u80fd\u6e2c\u5b9a\u3092\u3044\u304f\u3064\u304b\u884c\u3063\u305f\u306e\u3067\u3001\u305d\u306e\u7d50\u679c\u30e1\u30e2\u3092\u8f09\u305b\u3055\u305b\u3066\u8cb0\u3044\u307e\u3059\u3002\n\u203b \u6e2c\u5b9a\u65b9\u6cd5\u306f\u7d50\u69cb\u9069\u5f53\u306a\u306e\u3067\u53c2\u8003\u7a0b\u5ea6\u306b\n\n\u306a\u304a\u3001\u5206\u6563Erlang\u81ea\u4f53\u306b\u95a2\u3057\u3066\u306f(\u4f8b\u3048\u3070)\u300e\u3059\u3054\u3044Erlang\u3086\u304b\u3044\u306b\u5b66\u307c\u3046! \u300f\u306e29\u7ae0([web\u7248](http://www.ymotongpoo.com/works/lyse-ja/ja/29_distribunomicon.html))\u304c\u8a73\u3057\u3044\u306e\u3067\u3001\u305d\u3061\u3089\u3092\u53c2\u7167\u306e\u3053\u3068\u3002\n\n\u76ee\u7684\u7b49\n=====\n\n\u5206\u6563Erlang\u306f\u30e1\u30c3\u30b7\u30e5\u578b\u306e\u30af\u30e9\u30b9\u30bf\u3092\u7d44\u3080\u306e\u3067\u3001\u53f0\u6570\u304c\u5897\u3048\u308b\u3068\u6027\u80fd\u304c\u982d\u6253\u3061\u3057\u3084\u3059\u3044\u304b\u3082\u3001\u3068\u3044\u3046\u8a71\u3092\u4ee5\u524d\u306b\u3069\u3053\u304b\u3067\u76ee\u306b\u3057\u305f\u899a\u3048\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u5b9f\u969b\u306b\u3069\u3046\u306a\u306e\u304b\u3092\u8a66\u3057\u3066\u307f\u305f\u304b\u3063\u305f\u3001\u3068\u3044\u3046\u306e\u304c\u3082\u3068\u3082\u3068\u306e\u52d5\u6a5f\u3002\n\n\u4eca\u56de\u306e\u76ee\u7684\u306f\u3001(\u6700\u5927\u3067)\u6570\u767e\u30ce\u30fc\u30c9\u898f\u6a21\u306eErlang\u30af\u30e9\u30b9\u30bf\u3092\u69cb\u7bc9\u3059\u308b\u969b\u306b\u3001\u3069\u3053\u304c\u6027\u80fd\u4e0a\u306e\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u306b\u306a\u308a\u5f97\u308b\u304b\u3092\u304a\u304a\u307e\u304b\u306b\u628a\u63e1\u3059\u308b\u3053\u3068\u3002\n\n\u7279\u5b9a\u306e\u30b7\u30b9\u30c6\u30e0\u3084\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u5168\u4f53\u306e\u6027\u80fd\u6e2c\u5b9a\u3067\u306f\u306a\u304f\u3001\u6a19\u6e96\u3067\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308b\u5206\u6563Erlang\u95a2\u9023\u6a5f\u80fd\u5358\u4f53\u306e\u57fa\u790e\u6027\u80fd\u306e\u6e2c\u5b9a\u3092\u884c\u306a\u3046\u3002\n(\u5206\u6563Erlang\u306e\u57fa\u76e4\u7684\u306a\u90e8\u5206\u3067\u3001\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u3092\u963b\u5bb3\u3059\u308b\u8981\u56e0\u304c\u306a\u3044\u304b\u3069\u3046\u304b)\n\n\u306a\u304a\u3001\u5b89\u5b9a\u6027\u5468\u308a\u306e\u8a71(ex. \u30ce\u30fc\u30c9\u6570\u304c\u591a\u3044+\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u4e0d\u5b89\u5b9a\u306a\u969b\u3001\u306e\u5206\u6563Erlang\u306e\u6027\u80fd\u3084\u6319\u52d5\u7b49)\u306f\u4eca\u56de\u306f\u8003\u616e\u3057\u3066\u3044\u306a\u3044\u3002\n\n\u6e2c\u5b9a\u74b0\u5883\u304a\u3088\u3073\u6e2c\u5b9a\u65b9\u6cd5\n===================\n\n\u6e2c\u5b9a\u74b0\u5883\n-------\n\nEC2\u306ec3.8xlarge\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f7f\u7528\u3057\u305f:\n\n- CPU: Intel(R) Xeon(R) CPU E5-2680 v2 @ 2.80GHz (\u7269\u740616\u30b3\u30a2\u3001\u8ad6\u740632\u30b3\u30a2)\n- \u30e1\u30e2\u30ea: 60GiB\n- OS: CentOS-6.4\n- OTP: 17.4 ([rpm](http://packages.erlang-solutions.com/site/esl/esl-erlang/FLAVOUR_1_general/esl-erlang_17.4-1~centos~6_amd64.rpm))\n- \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u6570: 10\u53f0\n\n\u30af\u30e9\u30b9\u30bf\u306e\u69cb\u7bc9\u65b9\u6cd5\u3068\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u69cb\u6210\n------------------------------\n\n\u8a08\u6e2c\u7528\u306e\u5206\u6563Erlang\u30af\u30e9\u30b9\u30bf\u306e\u69cb\u7bc9\u306b\u306f[slave\u30e2\u30b8\u30e5\u30fc\u30eb](http://www.erlang.org/doc/man/slave.html)\u3092\u4f7f\u7528\u3057\u305f\u3002\n\n- slave\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u3046\u3053\u3068\u3067\u3001Erlang\u30b7\u30a7\u30eb\u4e0a\u304b\u3089\u5225\u306e\u30ce\u30fc\u30c9\u3092\u30b9\u30ec\u30fc\u30d6\u3068\u3057\u3066\u8d77\u52d5\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\n   - \u8d77\u52d5\u3057\u305f\u5074\u306e\u30ce\u30fc\u30c9\u306f\u30de\u30b9\u30bf\u30fc\u30ce\u30fc\u30c9\u3068\u306a\u308b\n- \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u306e\u751f\u5b58\u671f\u9593\u306f\u3001\u30de\u30b9\u30bf\u30fc\u30ce\u30fc\u30c9(or link\u4ed8\u304d\u3067\u547c\u3073\u51fa\u3057\u305f\u5834\u5408\u306f\u547c\u3073\u51fa\u3057\u5143\u30d7\u30ed\u30bb\u30b9)\u306e\u305d\u308c\u3068\u540c\u671f\u3059\u308b\n- \u30af\u30ea\u30fc\u30f3\u306a\u74b0\u5883\u306e\u30af\u30e9\u30b9\u30bf\u306e\u69cb\u7bc9\u304a\u3088\u3073\u7834\u68c4\u304c\u624b\u8efd\u306b\u884c\u3048\u308b\u306e\u3067\u3001\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u7684\u306a\u7528\u9014\u306b\u5411\u3044\u305f\u4fbf\u5229\u306a\u30e2\u30b8\u30e5\u30fc\u30eb\n\n```erlang\n%% \u4f7f\u7528\u4f8b:\n%%\n%% \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u3092\u8d77\u52d5\u3057\u305f\u3044\u30db\u30b9\u30c8\u540d\u3068\u30ce\u30fc\u30c9\u306e\u540d\u524d\u3092\u6307\u5b9a\u3057\u3066 slave:start_link/2 \u3092\u547c\u3073\u51fa\u3059\n%% \u203b \u3053\u3053\u3067\u6307\u5b9a\u3059\u308b\u30db\u30b9\u30c8\u306b\u306frsh\u30b3\u30de\u30f3\u30c9\u3067\u30ed\u30b0\u30a4\u30f3\u304c\u3067\u304d\u308b\u5fc5\u8981\u304c\u3042\u308b \n%%    (rsh\u30b3\u30de\u30f3\u30c9\u3067\u306f\u306a\u304f\u3001ssh\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u306ferl\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u6642\u306b'-rsh ssh'\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u5f15\u6570\u3067\u6307\u5b9a\u3059\u308b)\n> slave:start_link(hoge_host, fuga).\n{ok, fuga@hoge_host}  % 'fuga@hoge_host'\u3068\u3044\u3046\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u304c\u8d77\u52d5\u3057\u305f\n\n> nodes().\n[fuga@hoge_host]\n\n> exit(shutdown). % \u547c\u3073\u51fa\u3057\u5143(link)\u30d7\u30ed\u30bb\u30b9\u304c\u30c0\u30a6\u30f3\u3057\u305f\u3089\u3001\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u306f\u81ea\u52d5\u3067\u7d42\u4e86\u3055\u305b\u3089\u308c\u308b\n\n> nodes().\n[]\n```\n\n\u6e2c\u5b9a\u6642\u306b\u7528\u3044\u305fEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u69cb\u6210\u306f\u3001\u4ee5\u4e0b\u306e\u901a\u308a:\n\n- \u30de\u30b9\u30bf\u30fc\u30ce\u30fc\u30c9\u7528\u306b\u5c02\u7528\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4e00\u53f0\u5272\u5f53\n  - \u8a08\u6e2c\u7528\u306e\u5404\u7a2e\u64cd\u4f5c\u3092\u5b9f\u884c\u3057\u305f\u308a\u3001\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u52d5\u4f5c\u3059\u308b\u306e\u306f\u3053\u306e\u30ce\u30fc\u30c9\n- \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u7528\u306b\u306f\u6b8b\u308a\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e5d\u53f0\u3092\u5272\u5f53\n  - \u6e2c\u5b9a\u7528\u306e\u8ca0\u8377\u8abf\u6574\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7fa4\n  - \u5404\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u306f\u6700\u5927\u306730\u500b\u7a0b\u5ea6\u306eEralng\u30ce\u30fc\u30c9\u3092\u540c\u6642\u306b\u8d77\u52d5\u3055\u308c\u308b\n      - \u76f8\u4e57\u308a\u3057\u3066\u3044\u308b\u306e\u306f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u6570\u306e\u7bc0\u7d04\u306e\u305f\u3081\u4ed5\u65b9\u306a\u304f (\u53ef\u80fd\u306a\u3089\u4e00\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e00\u30ce\u30fc\u30c9\u306e\u65b9\u304c\u671b\u307e\u3057\u3044)\n  - \u6e2c\u5b9a\u6642\u306b\u306f\u6700\u5927\u3067256\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9(+ 1\u30de\u30b9\u30bf\u30fc\u30ce\u30fc\u30c9)\u3092\u542b\u3080\u30af\u30e9\u30b9\u30bf\u304c\u4f5c\u6210\u3055\u308c\u308b\n\n\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u7fa4\u306f\u3001\u5404\u6e2c\u5b9a\u95a2\u6570\u5b9f\u884c\u524d\u306b\u8d77\u52d5\u3055\u308c\u3001\u95a2\u6570\u5b9f\u884c\u5f8c\u306b\u7834\u68c4\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u305f\u3002\n\n\u8a08\u6e2c\u65b9\u6cd5 (\u5171\u901a\u90e8\u5206)\n------------------\n\u672b\u5c3e\u306b\u8a18\u8f09\u306e[dist_bench.erl](http://qiita.com/sile/items/1852425f0f70e790ebea#%E6%B8%AC%E5%AE%9A%E7%94%A8%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89)\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u95a2\u6570\u7fa4\u3092\u4f7f\u3063\u3066\u6e2c\u5b9a\u3092\u884c\u3063\u305f\u3002\n\n\u4ee5\u4e0b\u3001\u5168\u3066\u306e\u8a08\u6e2c\u3067\u4f7f\u7528\u3057\u305f\u5171\u901a\u306e\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u95a2\u6570\u7fa4\u306e\u7d39\u4ecb\u304a\u3088\u3073\u4f7f\u7528\u4f8b:\n\n```erlang\n%% [1] dist_bench:setup_nodes/1\n%% \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u7fa4\u306e\u8d77\u52d5\u95a2\u6570\n> NodeSpecs = [{host1, 3}, {host2, 2}]. % \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u3092\u8d77\u52d5\u3059\u308b\u30db\u30b9\u30c8\u3068\u3001\u305d\u306e\u30db\u30b9\u30c8\u3067\u306e\u8d77\u52d5\u6570\u3092\u6307\u5b9a\u3059\u308b\n> dist_bench:setup_nodes(NodeSpecs).\n{5, 654112}.  % {\u8d77\u52d5\u3057\u305f\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u306e\u6570, \u5404\u30ce\u30fc\u30c9\u306e\u8d77\u52d5\u306b\u8981\u3057\u305f\u6642\u9593\u306e\u5e73\u5747(\u03bcs)}\n\n> nodes().\n[slave_0@host1, slave_1@host1, slave_2@host1, slave_0@host2, slave_1@host2]\n\n> exit(shutdown).\n\n\n%% [2] dist_bench:make_node_specs/2\n%% 'NodeSpecs'\u306e\u751f\u6210\u88dc\u52a9\u95a2\u6570\n%% \u5229\u7528\u53ef\u80fd\u306a\u30db\u30b9\u30c8\u4e00\u89a7\u3068\u3001\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u306e\u5408\u8a08\u8d77\u52d5\u6570\u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u5404\u30db\u30b9\u30c8\u9593\u3067\u8d77\u52d5\u6570\u304c\u5747\u7b49\u306b\u306a\u308b\u3088\u3046\u306b\u8abf\u6574\u3057\u3066\u304f\u308c\u308b\n> dist_bench:make_node_specs([host1, host2], 5).\n[{host1, 3}, {host2, 2}]\n\n\n%% [3] dist_bench:do_bench/3\n%% \u30d9\u30f3\u30c1\u30de\u30fc\u30af(\u8a08\u6e2c)\u5b9f\u884c\u95a2\u6570\n> ExecuteCount = 5.                          % 'BenchFun'\u306e\u5b9f\u884c\u56de\u6570\n> BenchFun = fun () -> timer:sleep(100) end. % \u5177\u4f53\u7684\u306a\u8a08\u6e2c\u51e6\u7406\u3092\u5b9f\u884c\u3059\u308b\u95a2\u6570\n> dist_bench:do_bench(NodeSpecs, ExecuteCount, BenchFun). \n# setup nodes ... done: count=5, start_avg_time=0.3468948 sec % \u6700\u521d\u306b\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u7fa4\u304c\u8d77\u52d5\u3055\u305b\u3089\u308c\u308b\n# [1] do bench ... done: time=0.103409 sec % 'BenchFun'\u306e\u4e00\u56de\u306e\u5b9f\u884c\u306b\u639b\u304b\u3063\u305f\u6642\u9593(\u524d\u51e6\u7406\u3084\u5f8c\u51e6\u7406\u306e\u6642\u9593\u3082\u542b\u3080\u306e\u3067\u53c2\u8003\u7a0b\u5ea6)\n# [2] do bench ... done: time=0.100309 sec\n# [3] do bench ... done: time=0.101726 sec\n# [4] do bench ... done: time=0.1009 sec\n# [5] do bench ... done: time=0.100786 sec\n\n[ok,ok,ok,ok,ok]\n% \u2191 'BenchFun'\u95a2\u6570\u306e\u8fd4\u308a\u5024\u3092\u96c6\u3081\u305f\u3082\u306e.\n% \u3053\u3053\u3067\u306f'ok'\u304c\u8fd4\u3055\u308c\u3066\u3044\u308b\u304c\u3001\u5b9f\u969b\u306e\u5bfe\u8c61\u51e6\u7406\u306e\u8a08\u6642\u7d50\u679c\u304c\u8fd4\u3055\u308c\u308b\u3053\u3068\u3092\u671f\u5f85\u3057\u3066\u3044\u308b.\n% \u4ee5\u964d\u3067\u306f\u3001\u3053\u306e\u30ea\u30b9\u30c8\u4e2d\u306e\u4e2d\u592e\u5024\u304c\u3001\u6700\u7d42\u7684\u306a\u8a08\u6642\u7d50\u679c\u3068\u3057\u3066\u63a1\u7528\u3055\u308c\u3066\u3044\u308b\u3002\n```\n\n\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u95a2\u9023\u306e\u6027\u80fd\u6e2c\u5b9a\n=======================\n\n\u30af\u30e9\u30b9\u30bf\u5185\u306e\u30ce\u30fc\u30c9\u6570\u304c\u5897\u3048\u305f\u5834\u5408\u306e\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u306e\u6e2c\u5b9a\u3002\n\n\u5bfe\u8c61\n----\n\n\u6a19\u6e96\u3067\u63d0\u4f9b\u3055\u308c\u3066\u304a\u308a\u3001\u304b\u3064\u3001\u81ea\u5206\u304c\u6bd4\u8f03\u7684\u826f\u304f\u5229\u7528\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u3084\u95a2\u6570\u7fa4\u3092\u4e2d\u5fc3\u306b\u6e2c\u5b9a\u3092\u884c\u3063\u305f\u3002\n\n- \u30ce\u30fc\u30c9\u7ba1\u7406\u7cfb\n  - [slave:start_link/2\u95a2\u6570](http://www.erlang.org/doc/man/slave.html#start_link-2): \u30ce\u30fc\u30c9\u306e\u8ffd\u52a0\n  - [net_kernel\u30e2\u30b8\u30e5\u30fc\u30eb](http://erlang.org/doc/man/net_kernel.html): \u30ce\u30fc\u30c9\u306e\u6b7b\u6d3b\u76e3\u8996(\u30cf\u30fc\u30c8\u30d3\u30fc\u30c8)\u5468\u308a\n- \u30d4\u30a2\u30c4\u30fc\u30d4\u30a2\u901a\u4fe1\u7cfb\n  - [erlang:send/2\u95a2\u6570](http://www.erlang.org/doc/man/erlang.html#send-2): \u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\n  - [erlang:monitor/2\u95a2\u6570](http://www.erlang.org/doc/man/erlang.html#monitor-2): \u30d7\u30ed\u30bb\u30b9\u306e\u6b7b\u6d3b\u7ba1\u7406\n  - [rpc\u30e2\u30b8\u30e5\u30fc\u30eb](http://erlang.org/doc/man/rpc.html): Remote Procedure Call\n- \u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u60c5\u5831\u7ba1\u7406\u7cfb\n  - [global\u30e2\u30b8\u30e5\u30fc\u30eb](http://erlang.org/doc/man/global.html): \u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u30d7\u30ed\u30bb\u30b9\u540d\u7ba1\u7406\n  - [pg2\u30e2\u30b8\u30e5\u30fc\u30eb](http://erlang.org/doc/man/pg2.html): \u30d7\u30ed\u30bb\u30b9\u30b0\u30eb\u30fc\u30d7\u7ba1\u7406\n\n\u5bfe\u8c61\u5916\u3068\u3057\u305f\u5206\u6563Erlang\u95a2\u9023\u30e2\u30b8\u30e5\u30fc\u30eb\u7b49 (\u3059\u3050\u601d\u3044\u3064\u3044\u305f\u7269\u306e\u307f\u8a18\u8f09):\n\n- [mnesia\u30e2\u30b8\u30e5\u30fc\u30eb](http://www.erlang.org/doc/man/mnesia.html)\n  - \u6a19\u6e96\u3067\u914d\u5e03\u3055\u308c\u3066\u3044\u308b\u5206\u6563DMBS\n  - \u500b\u4eba\u7684\u306b\u306f\u4e0a\u624b\u3044\u4f7f\u3044\u6240\u304c\u898b\u3064\u304b\u3063\u3066\u3044\u306a\u3044\u306e\u3068\u3001\u3053\u3053\u3067\u6271\u3046\u306e\u306f\u5de8\u5927\u3059\u308b\u6c17\u304c\u3059\u308b\u306e\u3067\u4eca\u56de\u306f\u5bfe\u8c61\u5916\n- [pg\u30e2\u30b8\u30e5\u30fc\u30eb](http://erlang.org/doc/man/pg.html)\n  - pg2\u306e\u524d\u8eab(?)\u3067\u73fe\u5728\u306f\u975e\u63a8\u5968\u6271\u3044 (OTP18\u3067\u524a\u9664\u4e88\u5b9a\u3001\u3068\u306a\u3063\u3066\u3044\u305f)\n- [global_group\u30e2\u30b8\u30e5\u30fc\u30eb](http://erlang.org/doc/man/global_group.html)\n  - \u30af\u30e9\u30b9\u30bf\u5185\u306e\u30ce\u30fc\u30c9\u7fa4\u3092\u30b0\u30eb\u30fc\u30d7\u5206\u3051\u3059\u308b\u305f\u3081\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\n  - \u30af\u30e9\u30b9\u30bf\u5168\u4f53\u306e\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3044\u5834\u5408\u3067\u3082\u3001\u30b0\u30eb\u30fc\u30d7\u5206\u3051\u3092\u9069\u5207\u306b\u884c\u306a\u3046\u3053\u3068\u3067global\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u6027\u80fd\u52a3\u5316\u3092\u9632\u3052\u308b\u3068\u306e\u3053\u3068\n  - \u30ce\u30fc\u30c9\u7fa4\u306e\u30b0\u30eb\u30fc\u30d7\u5206\u3051\u306e\u6a5f\u80fd\u81ea\u4f53\u306b\u306f\u82e5\u5e72\u60f9\u304b\u308c\u308b\u304c\u3001\u3044\u308d\u3044\u308d\u3068\u5236\u9650\u304c\u304d\u3064\u3044\u306e\u3067\u4eca\u5f8c\u3082\u4f7f\u3046\u3053\u3068\u306f\u306a\u3055\u305d\u3046\n- [\u5206\u6563OTP\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3](http://www.erlang.org/doc/design_principles/distributed_applications.html)\n  - \u4eca\u306e\u3068\u3053\u308d\u4f7f\u3046\u4e88\u5b9a\u306a\u3057\n\n\u30ce\u30fc\u30c9\u7ba1\u7406\u7cfb\n----------\n\n### \u30ce\u30fc\u30c9\u306e\u8ffd\u52a0\n\n#### \u6e2c\u5b9a\u5185\u5bb9\n\n`slave:start_link/3`\u95a2\u6570\u3092\u4f7f\u3063\u3066\u3001\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0(\u8d77\u52d5)\u3059\u308b\u306e\u306b\u8981\u3059\u308b\u6642\u9593\u304c\u3001\u30af\u30e9\u30b9\u30bf\u30b5\u30a4\u30ba\u306b\u5fdc\u3058\u3066\u5909\u5316\u3059\u308b\u304b\u3092\u6e2c\u5b9a\u3057\u305f\u3002\n\n```erlang\n%% \u6e2c\u5b9a\u65b9\u6cd5:\n%% - dist_bench:setup_nodes/1\u95a2\u6570\u3092\u4f7f\u3063\u3066\u3001\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u306e\u8ffd\u52a0\u306b\u8981\u3057\u305f\u6642\u9593\u306e\u5e73\u5747\u5024\u3092\u6e2c\u5b9a\u3059\u308b\n\n> Hosts = [host1, host2, host3, host4, host5, host6, host7, host8, host9]. % \u30b9\u30ec\u30fc\u30d6\u7528\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30ea\u30b9\u30c8\n> NodeCount = 1. % \u8d77\u52d5\u3059\u308b\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u306e\u6570\u30021\u304b\u3089256\u306e\u7bc4\u56f2\u3067\u5909\u5316\u3055\u305b\u3066\u3001\u305d\u308c\u305e\u308c\u306e\u5024\u3067\u306e\u8ffd\u52a0\u306b\u8981\u3057\u305f\u6642\u9593\u3092\u8a08\u6e2c\u3059\u308b\n\n> dist_bench:setup_nodes(dist_bench:make_node_specs(Hosts, NodeCount)).\n{1, 647250.0}  % \u8fd4\u308a\u5024\u306e\u7b2c\u4e8c\u8981\u7d20\u304c\u3001\u5404\u30ce\u30fc\u30c9\u306e\u8ffd\u52a0(\u8d77\u52d5)\u306b\u8981\u3057\u305f\u6642\u9593\u306e\u5e73\u5747\u5024(\u03bcs)\n\n> exit(shutdown). % 'NodeCount'\u3092\u5909\u66f4\u3057\u3066\u6b21\u306e\u60f3\u5b9a\u3092\u884c\u306a\u3046\u524d\u306b\u3001\u8d77\u52d5\u3057\u305f\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u7fa4\u3092\u505c\u6b62\u3059\u308b\n```\n\n#### \u6e2c\u5b9a\u7d50\u679c\n\n| \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570  | \u30ce\u30fc\u30c9\u306e\u8ffd\u52a0\u306b\u8981\u3057\u305f\u6642\u9593\u306e\u5e73\u5747 |\n|---------------:|--------------------------:|\n|              1 |                   0.637 s |\n|              4 |                   0.673 s |\n|             16 |                   0.691 s |\n|             64 |                   0.705 s |\n|            256 |                   0.690 s |\n\n\u5c11\u306a\u304f\u3068\u3082slave\u30e2\u30b8\u30e5\u30fc\u30eb\u7d4c\u7531\u3067\u8d77\u52d5\u3057\u305f\u5834\u5408\u306f\u3001\u30af\u30e9\u30b9\u30bf\u5185\u306e\u30ce\u30fc\u30c9\u6570\u304c\u591a\u304f\u306a\u3063\u3066\u3082\u3001\u65b0\u898f\u30ce\u30fc\u30c9\u306e\u8ffd\u52a0\u306b\u639b\u304b\u308b\u30b3\u30b9\u30c8\u304c\u9855\u8457\u306b\u5897\u3048\u308b\u3001\u3068\u3044\u3063\u305f\u3088\u3046\u306a\u3053\u3068\u306f\u306a\u3055\u305d\u3046\u3002\n\n### \u30ce\u30fc\u30c9\u306e\u6b7b\u6d3b\u76e3\u8996\n\n\u203b \u3053\u308c\u306b\u95a2\u3057\u3066\u306f'\u6e2c\u5b9a'\u3068\u3044\u3046\u7a0b\u306e\u3053\u3068\u306f\u884c\u3063\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u8efd\u304f\u6982\u8981\u3060\u3051\u66f8\u3044\u3066\u304a\u304f\n\n\u5206\u6563Erlang\u3067\u306e\u63a5\u7d9a\u3057\u3066\u3044\u308b\u30ce\u30fc\u30c9\u306e\u6b7b\u6d3b\u76e3\u8996\u306fnet_kernel\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u884c\u3063\u3066\u3044\u308b\u3002\n\n\u6b7b\u6d3b\u30c1\u30a7\u30c3\u30af\u51e6\u7406\u306e\u304a\u304a\u3088\u305d\u306e\u6d41\u308c\u306f\u4ee5\u4e0b\u306e\u901a\u308a:\n\n- net_kernel\u30d7\u30ed\u30bb\u30b9\u306f\u3001\u63a5\u7d9a\u30ce\u30fc\u30c9\u3068\u306e\u9593\u306b\u6b7b\u6d3b\u76e3\u8996\u7528\u306eTCP\u63a5\u7d9a\u3092\u8cbc\u3063\u3066\u3044\u308b\n- `ticktime / 4`\u79d2\u6bce\u306b\u3001\u305d\u306e\u5168\u3066\u306eTCP\u63a5\u7d9a\u306b\u5bfe\u3057\u3066\u3001(\u76e3\u8996\u7528\u306e)\u66f8\u304d\u8fbc\u307f\u3092\u884c\u306a\u3046\n  - ticktime\u306f`net_kernel:set_net_ticktime/1`\u3067\u6307\u5b9a\u3055\u308c\u305f\u79d2\u6570\u3067\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306f60\u79d2\n- TCP\u63a5\u7d9a\u304c\u9589\u3058\u3066\u3044\u305f\u308a\u3001`ticktime`\u79d2\u9593\u306b(\u76f8\u624b\u5074\u304b\u3089\u306e)\u66f8\u304d\u8fbc\u307f\u304c\u306a\u304b\u3063\u305f\u30ce\u30fc\u30c9\u306f\u3001\u30c0\u30a6\u30f3\u3057\u3066\u3044\u308b\u3068\u5224\u65ad\u3059\u308b\n\n\u5f53\u7136\u3001\u63a5\u7d9a\u3057\u3066\u308b\u30ce\u30fc\u30c9\u6570\u306b\u6bd4\u4f8b\u3057\u3066\u3001(`ticktime / 4`\u79d2\u6bce\u306e)\u51e6\u7406\u91cf\u306f\u5897\u3048\u308b\u3053\u3068\u306b\u306a\u308b\u304c\u3001\u7279\u306b\u91cd\u3044\u51e6\u7406\u3067\u3082\u306a\u3044\u306e\u3067\u3001\u6570\u767e\u30ce\u30fc\u30c9\u7a0b\u5ea6\u3067\u3042\u308c\u3070\u3001\u8ca0\u8377\u7684\u306b\u7279\u306b\u554f\u984c\u3068\u306a\u308b\u3053\u3068\u3082\u306a\u3055\u305d\u3046\u3002\n\n\u5b9f\u969b\u306b\u3001\u7279\u306b\u4f55\u3082\u51e6\u7406\u3092\u8d70\u3089\u305b\u3066\u3044\u306a\u3044\u72b6\u614b\u3067CPU\u306e\u4f7f\u7528\u7387\u3092\u78ba\u8a8d\u3057\u3066\u307f\u3066\u3082\u3001\u63a5\u7d9a\u30ce\u30fc\u30c9\u304c\u306a\u3044\u5834\u5408\u3068\u63a5\u7d9a\u30ce\u30fc\u30c9\u6570\u304c200\u306e\u5834\u5408\u3068\u306e\u9593\u3067\u3001\u7279\u306b\u512a\u4f4d\u306a\u7a0b\u306e\u5dee\u306f\u898b\u3089\u308c\u306a\u304b\u3063\u305f\u3088\u3046\u306b\u601d\u3046\u3002\n\n\u30d4\u30a2\u30c4\u30fc\u30d4\u30a2\u901a\u4fe1\u7cfb\n---------------\n\n\u30ce\u30fc\u30c9\u3092\u8de8\u3044\u3060\u500b\u3005\u306e\u30d7\u30ed\u30bb\u30b9\u540c\u58eb\u304c\u76f4\u63a5\u3084\u308a\u3068\u308a\u3059\u308b\u7a2e\u985e\u306e\u64cd\u4f5c\u306e\u6027\u80fd\u6e2c\u5b9a\u3002\n\n\u30ce\u30fc\u30c9\u304c\u7570\u306a\u308b\u30d7\u30ed\u30bb\u30b9\u9593\u3067\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1\u3084\u3001\u30d7\u30ed\u30bb\u30b9\u6b7b\u6d3b\u76e3\u8996\u3001\u30ce\u30fc\u30c9\u9593RPC\u7b49\u3002\n\n\u3053\u308c\u3089\u306e\u64cd\u4f5c\u306f\u5bfe\u8c61\u3068\u306a\u308b\u7279\u5b9a\u306e\u30d7\u30ed\u30bb\u30b9/\u30ce\u30fc\u30c9\u3068\u3055\u3048\u901a\u4fe1\u3067\u304d\u308c\u3070\u5341\u5206\u3067\u3001\u30af\u30e9\u30b9\u30bf\u5168\u4f53\u306e\u72b6\u614b\u3092\u628a\u63e1\u3059\u308b\u5fc5\u8981\u3082\u306a\u3044\u306e\u3067\u3001\u30af\u30e9\u30b9\u30bf\u5185\u306e\u30ce\u30fc\u30c9\u6570\u304c\u5897\u52a0\u3057\u3066\u3082\u6027\u80fd\u304c\u52a3\u5316\u3057\u306a\u3044(= \u7d50\u679c\u3068\u3057\u3066\u30b7\u30b9\u30c6\u30e0\u5168\u4f53\u306f\u826f\u597d\u306b\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u3059\u308b)\u3053\u3068\u304c\u671f\u5f85\u3055\u308c\u308b\u3002\n\n\u5177\u4f53\u7684\u306a\u6e2c\u5b9a\u5bfe\u8c61\u306f\u4ee5\u4e0b\u306e\u901a\u308a:\n\n- [erlang:send/2\u95a2\u6570](http://www.erlang.org/doc/man/erlang.html#send-2):\n  - \u30d7\u30ed\u30bb\u30b9\u306b\u5bfe\u3059\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u95a2\u6570\n  - \u5b9f\u969b\u306e\u6e2c\u5b9a\u30b3\u30fc\u30c9\u3067\u306f`!`\u6f14\u7b97\u5b50\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\n  - \u9001\u4fe1\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u5b9b\u5148\u6307\u5b9a\u65b9\u5f0f\u306b\u306f\u3001\u4ee5\u4e0b\u306e\u4e8c\u3064\u3092\u8a66\u3057\u305f:\n     - PID(\u30d7\u30ed\u30bb\u30b9ID)\u6307\u5b9a:\n         - Erlang\u306ePID\u306b\u306f\u3001\u305d\u306e\u30d7\u30ed\u30bb\u30b9\u304c\u5b58\u5728\u3059\u308b\u30ce\u30fc\u30c9\u306e\u60c5\u5831\u3082\u57cb\u3081\u8fbc\u307e\u308c\u3066\u3044\u308b\u306e\u3067\u3001PID\u5358\u4f53\u3067\u5b9b\u5148\u3092\u4e00\u610f\u306b\u6c7a\u5b9a\u53ef\u80fd\n         - ex: `<123.456.789>`\n     - \u30d7\u30ed\u30bb\u30b9\u540d\u6307\u5b9a:\n         - `erlang:register/2`\u3092\u4f7f\u3063\u3066\u767b\u9332\u3055\u308c\u305f\u30d7\u30ed\u30bb\u30b9\u540d\u3092\u9001\u4fe1\u5148\u306b\u6307\u5b9a\u3059\u308b\n         - `{Name::atom(), Node::node()}`\u5f62\u5f0f  \n- [rpc:async_call/4](http://erlang.org/doc/man/rpc.html#async_call-4):\n  - `rpc:call/4`\u3092\u4f7f\u3046\u3068\u30ea\u30e2\u30fc\u30c8\u30ce\u30fc\u30c9\u4e0a\u3067\u306e\u95a2\u6570\u5b9f\u884c\u304c\u624b\u8efd\u306b\u884c\u3048\u308b\n  - \u4eca\u56de\u306f\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u3092(\u624b\u8efd\u306b)\u4e0a\u3052\u308b\u305f\u3081\u306b\u975e\u540c\u671f\u7248\u306e`rpc:async_call/4`\u3092\u4f7f\u7528\u3057\u305f\n- [erlang:monitor/2\u95a2\u6570](http://www.erlang.org/doc/man/erlang.html#monitor-2):\n  - \u30d7\u30ed\u30bb\u30b9\u306e\u6b7b\u6d3b\u7ba1\u7406(\u5358\u65b9\u5411\u76e3\u8996)\n  - \u30e2\u30cb\u30bf\u3057\u3066\u3044\u308b\u30d7\u30ed\u30bb\u30b9\u304c\u30c0\u30a6\u30f3\u3057\u305f\u5834\u5408\u306f`{'DOWN', MonitorRef, Type, Pid, Reason}`\u3068\u3044\u3046\u5f62\u5f0f\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u547c\u3073\u51fa\u3057\u5143\u30d7\u30ed\u30bb\u30b9\u306b\u9001\u3089\u308c\u308b\n  - \u53cc\u65b9\u5411\u76e3\u8996(?)\u304c\u884c\u3048\u308b`erlang:link/2`\u95a2\u6570\u3082\u3042\u308b\u304c\u3001(\u6027\u80fd\u50be\u5411\u306f\u5909\u308f\u3089\u306a\u3044\u3067\u3042\u308d\u3046\u3068\u4e88\u60f3\u306e\u3082\u3068)\u3053\u3061\u3089\u306e\u8a08\u6e2c\u306f\u5272\u611b\n\n### \u6e2c\u5b9a\u5185\u5bb9\n\n- [erlang:send/2\u95a2\u6570](http://www.erlang.org/doc/man/erlang.html#send-2):\n  - \u30ea\u30e2\u30fc\u30c8\u30ce\u30fc\u30c9\u4e0a\u306becho\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u3092\u7528\u610f\u3057\u3066 __\u4e00\u56de\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1\u306b\u8981\u3057\u305f\u5e73\u5747\u6642\u9593__ \u3092\u8a08\u6e2c\n     - \u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u9001\u4fe1\u5143\u306f\u30de\u30b9\u30bf\u30fc\u30ce\u30fc\u30c9\u4e0a\u306e\u5358\u4e00\u30d7\u30ed\u30bb\u30b9\n     - echo\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u306f\u30ea\u30e2\u30fc\u30c8\u306e\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u4e0a\u3067\u8d77\u52d5\u3059\u308b (\u5404\u30ce\u30fc\u30c9\u306b\u4ed8\u304d\u4e00\u30d7\u30ed\u30bb\u30b9\u304c\u5b58\u5728)\n  - \u6e2c\u5b9a\u95a2\u6570: `dist_bench:pid_msg_echo_bench/2` (\u5b9f\u969b\u306b\u6307\u5b9a\u3057\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u7b49\u306f\u4e0b\u306e\u5b9f\u884c\u4f8b\u3092\u53c2\u7167)\n- [rpc:async_call/4](http://erlang.org/doc/man/rpc.html#async_call-4):\n  - __\u4e00\u56de\u306eRPC(\u30ea\u30af\u30a8\u30b9\u30c8\u9001\u4fe1\u304b\u3089\u30ec\u30b9\u30dd\u30f3\u30b9\u53d7\u4fe1\u307e\u3067)\u306b\u8981\u3057\u305f\u5e73\u5747\u6642\u9593__ \u3092\u8a08\u6e2c\n     - \u30de\u30b9\u30bf\u30fc\u30ce\u30fc\u30c9\u4e0a\u306e(\u5358\u4e00)\u30d7\u30ed\u30bb\u30b9\u304b\u3089\u3001\u30ea\u30e2\u30fc\u30c8\u306e\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u306b\u5bfe\u3059\u308bRPC\n  - \u6e2c\u5b9a\u95a2\u6570: `dist_bench:rpc_call_bench/2` (\u5b9f\u969b\u306b\u6307\u5b9a\u3057\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u7b49\u306f\u4e0b\u306e\u5b9f\u884c\u4f8b\u3092\u53c2\u7167)\n- [erlang:monitor/2\u95a2\u6570](http://www.erlang.org/doc/man/erlang.html#monitor-2):\n  - \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u4e0a\u306e\u30d7\u30ed\u30bb\u30b9\u306b\u5bfe\u3059\u308b __\u76e3\u8996\u306e\u767b\u9332\u304b\u3089\u30c0\u30a6\u30f3\u901a\u77e5\u306e\u53d7\u4fe1\u307e\u3067\u306b\u8981\u3057\u305f\u5e73\u5747\u6642\u9593__ \u3092\u8a08\u6e2c\n      - \u30d7\u30ed\u30bb\u30b9\u306e\u76e3\u8996\u5143\u306f\u30de\u30b9\u30bf\u30fc\u30ce\u30fc\u30c9\u4e0a\u306e\u5358\u4e00\u30d7\u30ed\u30bb\u30b9\n      - \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u4e0a\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u5bfe\u8c61\u3068\u3057\u3066`erlang:monitor/2`\u3092\u547c\u3073\u51fa\u3057\u305f\u76f4\u5f8c\u306b\u3001\u305d\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u7d42\u4e86(`erlang:exit/2`)\u3055\u305b\u3066\u3001\u30c0\u30a6\u30f3\u901a\u77e5\u3092\u5f85\u6a5f\u3059\u308b\n  - \u6e2c\u5b9a\u95a2\u6570: `dist_bench:monitor_bench/2` (\u5b9f\u969b\u306b\u6307\u5b9a\u3057\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u7b49\u306f\u4e0b\u306e\u5b9f\u884c\u4f8b\u3092\u53c2\u7167)\n\n\u6e2c\u5b9a\u306e\u969b\u306e\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u306e\u6570\u306f1\u304b\u3089256\u306e\u9593\u3067\u5909\u5316\u3055\u305b\u3001\u30af\u30e9\u30b9\u30bf\u30b5\u30a4\u30ba\u306e\u5927\u5c0f\u306b\u3088\u308a\u5404\u64cd\u4f5c\u306e\u30b3\u30b9\u30c8\u304c\u5909\u308f\u308b\u304b\u3069\u3046\u304b\u306e\u78ba\u8a8d\u3092\u884c\u3063\u305f\u3002\n\u307e\u305f\u53c2\u8003\u3068\u3057\u3066\u3001\u30ce\u30fc\u30c9\u9593\u901a\u4fe1\u304c\u4e00\u5207\u4e0d\u8981\u306a\u3001\u30de\u30b9\u30bf\u30fc\u30ce\u30fc\u30c9\u306e\u307f(= \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570\u304c0)\u306e\u69cb\u6210\u3067\u306e\u6e2c\u5b9a\u3082\u884c\u3063\u305f\u3002\n\n```erlang\n%% \u5b9f\u884c\u4f8b:\n\n%% \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570=4\u3001\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u5b9f\u884ch\n> dist_bench:do_bench(dist_bench:make_node_specs(Hosts, 4), 5,\n                      fun () -> dist_bench:pid_msg_echo_bench(500000, nodes()) end).\n\n%% \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570=4, \u3067RPC\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u5b9f\u884c\n> dist_bench:do_bench(dist_bench:make_node_specs(Hosts, 4), 5,\n                      fun () -> dist_bench:rpc_call_bench(100000, nodes()) end).\n\n%% \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570=4, \u3067\u30d7\u30ed\u30bb\u30b9\u76e3\u8996\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u5b9f\u884c\n> dist_bench:do_bench(dist_bench:make_node_specs(Hosts, 4), 5,\n                      fun () -> dist_bench:monitor_bench(100000, nodes()) end).\n```\n\n### \u6e2c\u5b9a\u7d50\u679c\n\n| \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570 | erlang:send/2 (PID) | erlang:send/2 (\u540d\u524d) | rpc:async_call/4 | erlang:monitor/2 |\n|---------------:|--------------------:|--------------------:|-----------------:|-----------------:|\n|              0 |            0.758 \u03bcs |           0.905 \u03bcs |        3.269 \u03bcs |        19.450 \u03bcs |\n|              1 |            8.020 \u03bcs |           8.055 \u03bcs |       40.105 \u03bcs |         9.074 \u03bcs |\n|              4 |            2.021 \u03bcs |           2.116 \u03bcs |       11.518 \u03bcs |         8.598 \u03bcs |\n|             16 |            1.429 \u03bcs |           1.672 \u03bcs |        7.160 \u03bcs |         4.985 \u03bcs |\n|             64 |            2.345 \u03bcs |           2.340 \u03bcs |       11.667 \u03bcs |         4.839 \u03bcs |\n|            256 |            2.634 \u03bcs |           2.767 \u03bcs |       11.320 \u03bcs |         5.053 \u03bcs |\n\n\u6e2c\u5b9a\u7d50\u679c\u3092\u898b\u308b\u3068\u3001\u5168\u4f53\u7684\u306b\u3001\u30af\u30e9\u30b9\u30bf\u306e\u30b5\u30a4\u30ba\u304c\u5927\u304d\u304f\u306a\u3063\u3066\u3082\u3001\u500b\u3005\u306e\u51e6\u7406\u306e\u6027\u80fd\u306f\u307b\u3068\u3093\u3069\u52a3\u5316\u3057\u3066\u306a\u3044\u3053\u3068\u304c\u898b\u3066\u53d6\u308c\u308b\u3002\n\n\u3080\u3057\u308d\u4e26\u5217\u5ea6\u304c\u4e0a\u304c\u308b\u305f\u3081\u304b\u3001\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570\u304c16\u307e\u3067\u306e\u5834\u5408\u306f\u3001\u5358\u4f53\u306e\u51e6\u7406\u306b\u8981\u3059\u308b\u6642\u9593\u3082(\u30ce\u30fc\u30c9\u6570\u304c\u5897\u3048\u308b\u306b\u5f93\u3044)\u77ed\u304f\u306a\u3063\u3066\u3044\u308b\u3002\n\n\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570\u304c16\u3092\u8d85\u3048\u308b\u3068\u82e5\u5e72\u6027\u80fd\u304c\u52a3\u5316\u3057\u59cb\u3081\u308b\u50be\u5411\u304c\u3042\u308b\u304c\u3001\u3053\u308c\u306f\u4e00\u3064\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e0a\u3067\u8907\u6570\u306e\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u3092\u52d5\u304b\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u5f71\u97ff\u3092\u4e0e\u3048\u3066\u3044\u308b\u306e\u3067\u306f\u306a\u3044\u304b\u3068\u601d\u3063\u3066\u3044\u308b\u3002\n(\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570\u304c9\u3092\u8d85\u3048\u305f\u6bb5\u968e\u3067\u3001\u4e00\u3064\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e0a\u3067\u306e\u30ce\u30fc\u30c9\u306e\u540c\u5c45\u304c\u59cb\u307e\u308b\u306e\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8ca0\u8377\u306f\u9ad8\u304f\u306a\u308b)\n\n\u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u60c5\u5831\u7ba1\u7406\u7cfb\n-------------------\n\n\u30af\u30e9\u30b9\u30bf\u5168\u4f53\u306b\u5f71\u97ff\u3059\u308b\u3088\u3046\u306a\u64cd\u4f5c\u3092\u884c\u306a\u3046\u30e2\u30b8\u30e5\u30fc\u30eb\u7fa4\u306e\u6027\u80fd\u6e2c\u5b9a\u3002\n\n\u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u30d7\u30ed\u30bb\u30b9\u540d\u7ba1\u7406\u3084\u30d7\u30ed\u30bb\u30b9\u30b0\u30eb\u30fc\u30d7\u7ba1\u7406\u7b49\u3002\n\n\u30af\u30e9\u30b9\u30bf\u5185\u306e\u30ce\u30fc\u30c9\u540c\u58eb\u304c\u4f55\u3089\u304b\u306e\u624b\u6bb5\u3067\u60c5\u5831\u3092\u5171\u6709\u3059\u308b\u5fc5\u8981\u304c\u51fa\u3066\u304f\u308b\u306e\u3067\u3001\u5358\u306a\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u306e\u3088\u3046\u306a\u52b9\u7387\u7684\u306a\u5b9f\u88c5\u306f\u96e3\u3057\u3044\u3068\u4e88\u60f3\u3055\u308c\u308b\u3002\n\n\u5177\u4f53\u7684\u306a\u6e2c\u5b9a\u5bfe\u8c61\u306f\u4ee5\u4e0b\u306e\u901a\u308a:\n\n- [global\u30e2\u30b8\u30e5\u30fc\u30eb](http://erlang.org/doc/man/global.html):\n  - \u30b0\u30ed\u30fc\u30d0\u30eb\u30b9\u30b3\u30fc\u30d7\u306a\u30d7\u30ed\u30bb\u30b9\u540d\u7ba1\u7406\u304c\u884c\u3048\u308b (`erlang:register/2`\u306e\u30b0\u30ed\u30fc\u30d0\u30eb\u7248)\n  - \u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u76f8\u4e92\u6392\u4ed6\u30ed\u30c3\u30af\u6a5f\u80fd\u3082\u63d0\u4f9b\u3057\u3066\u3044\u308b\n  - global\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u66f4\u65b0\u7cfb\u306e\u64cd\u4f5c\u6642\u306b\u6574\u5408\u6027\u3092\u4fdd\u8a3c\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\n     - \u30d7\u30ed\u30bb\u30b9\u540d\u306e\u767b\u9332\u64cd\u4f5c\u306e\u5834\u5408:\n         1. \u6700\u521d\u306b\u767b\u9332\u3059\u308b\u540d\u524d\u3092\u30ad\u30fc\u306b\u3057\u3066\u3001\u30af\u30e9\u30b9\u30bf\u5168\u4f53\u3092\u30b9\u30b3\u30fc\u30d7\u3068\u3057\u3066\u30ed\u30c3\u30af\u3092\u7372\u5f97\n         2. \u30ed\u30c3\u30af\u7372\u5f97\u306b\u6210\u529f\u3057\u305f\u3089\u3001\u767b\u9332\u3059\u308b\u540d\u524d\u3068PID\u3092\u3001\u5168\u30ce\u30fc\u30c9\u306b\u5468\u77e5\u3057\u3066\u767b\u9332\u3092\u884c\u308f\u305b\u308b\n         3. \u30ed\u30c3\u30af\u7372\u5f97\u306b\u5931\u6557\u3057\u305f\u3089\u3001\u4e00\u5b9a\u6642\u9593\u30b9\u30ea\u30fc\u30d7\u3057\u3066\u518d\u8a66\u884c\n     - \u6574\u5408\u6027\u306f\u62c5\u4fdd\u3057\u3084\u3059\u3044\u304c\u3001\u30b9\u30b1\u30fc\u30eb\u306f\u96e3\u3057\u3044\n  - \u767b\u9332\u3055\u308c\u305f\u540d\u524d\u306e\u60c5\u5831\u306f\u3001\u5404\u30ce\u30fc\u30c9\u306e\u30ed\u30fc\u30ab\u30eb\u306eETS\u306b\u8907\u88fd\u30fb\u4fdd\u6301\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u53c2\u7167\u7cfb\u306e\u64cd\u4f5c\u306f(\u4ed6\u306e\u30ce\u30fc\u30c9\u3068\u306e\u901a\u4fe1\u3092\u884c\u306a\u3046\u3053\u3068\u306a\u304f)\u9ad8\u901f\u306b\u884c\u3048\u308b\n- [pg2\u30e2\u30b8\u30e5\u30fc\u30eb](http://erlang.org/doc/man/pg2.html):\n  - \u30b0\u30ed\u30fc\u30d0\u30eb\u30b9\u30b3\u30fc\u30d7\u306a\u30d7\u30ed\u30bb\u30b9\u30b0\u30eb\u30fc\u30d7\u7ba1\u7406\u304c\u884c\u3048\u308b\n     - \u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210\u3001\u30b0\u30eb\u30fc\u30d7\u3078\u306e\u30e1\u30f3\u30d0\u30fc(PID)\u8ffd\u52a0\u3001\u30e1\u30f3\u30d0\u30fc\u306e\u53d6\u5f97\u3001etc\n     - \u7279\u5b9a\u306e\u30ce\u30fc\u30c9\u4e0a\u3067\u4f5c\u6210\u3055\u308c\u305f\u30b0\u30eb\u30fc\u30d7\u306f\u3001\u30af\u30e9\u30b9\u30bf\u5185\u306e\u5168\u3066\u306e\u30ce\u30fc\u30c9\u304b\u3089\u53c2\u7167\u53ef\u80fd\n  - \u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210\u3084\u30e1\u30f3\u30d0\u306e\u8ffd\u52a0/\u524a\u9664\u6642\u306b\u306f\u3001global\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u6a5f\u80fd\u3092\u4f7f\u3063\u3066\u6574\u5408\u6027\u304c\u7dad\u6301\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\n     - \u300c\u30b0\u30eb\u30fc\u30d7\u540d\u3092\u30ad\u30fc\u3068\u3057\u3066\u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u30ed\u30c3\u30af\u3092\u7372\u5f97\u300d=>\u300c\u5168\u30ce\u30fc\u30c9\u306b\u60c5\u5831\u3092\u5171\u6709\u300d=>\u300c\u30ed\u30c3\u30af\u89e3\u9664\u300d\n  - \u5168\u3066\u30b0\u30eb\u30fc\u30d7\u60c5\u5831\u306f\u3001\u5404\u30ce\u30fc\u30c9\u306e\u30ed\u30fc\u30ab\u30eb\u306eETS\u306b\u8907\u88fd\u30fb\u4fdd\u6301\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u53c2\u7167\u7cfb\u306e\u64cd\u4f5c\u306f(\u4ed6\u306e\u30ce\u30fc\u30c9\u3068\u306e\u901a\u4fe1\u3092\u884c\u306a\u3046\u3053\u3068\u306a\u304f)\u9ad8\u901f\u306b\u884c\u3048\u308b\n\n### \u6e2c\u5b9a\u5185\u5bb9\n\n- [global\u30e2\u30b8\u30e5\u30fc\u30eb](http://erlang.org/doc/man/global.html):\n  - \u4ee5\u4e0b\u306e\u5404\u64cd\u4f5c\u3092\u305d\u308c\u305e\u308c\u767e\u56de\u5b9f\u884c\u3057\u3001\u4e00\u56de\u8fba\u308a\u306e\u5e73\u5747\u6240\u8981\u6642\u9593\u3092\u6e2c\u5b9a\n     - reg: \u30d7\u30ed\u30bb\u30b9\u540d\u306e\u767b\u9332. `global:register_name/2`\n     - unreg: \u540d\u524d\u306e\u767b\u9332\u89e3\u9664. `global:unregister_name/1`\n     - where: \u540d\u524d\u306b\u5bfe\u5fdc\u3059\u308bPID\u306e\u691c\u7d22. `global:whereis_name/1`\n- [pg2\u30e2\u30b8\u30e5\u30fc\u30eb](http://erlang.org/doc/man/pg2.html):\n  - \u4ee5\u4e0b\u306e\u5404\u64cd\u4f5c\u3092\u305d\u308c\u305e\u308c\u767e\u56de\u5b9f\u884c\u3057\u3001\u4e00\u56de\u8fba\u308a\u306e\u5e73\u5747\u6240\u8981\u6642\u9593\u3092\u6e2c\u5b9a\n     - create: \u30d7\u30ed\u30bb\u30b9\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210. `pg2:create/1`\n     - join: \u30d7\u30ed\u30bb\u30b9\u30b0\u30eb\u30fc\u30d7\u3078\u306e\u30e1\u30f3\u30d0\u8ffd\u52a0. `pg2:join/2`\n     - select: \u30d7\u30ed\u30bb\u30b9\u30b0\u30eb\u30fc\u30d7\u304b\u3089\u306e\u30d7\u30ed\u30bb\u30b9\u9078\u629e. `pg2:get_closest_pid/1`\n\n```erlang\n%% \u5b9f\u884c\u4f8b\n\n%% \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570=16 \u3067\u3001global\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u5b9f\u884c\n> dist_bench:do_bench(dist_bench:make_node_specs(Hosts, 16), 5, fun () -> dist_bench:global_bench(100) end).\n[[{register,2349.97},{unregister,3246.77},{whereis,0.47}], % \u767b\u9332/\u89e3\u9664/\u691c\u7d22\u3001\u51e6\u7406\u306e\u4e00\u56de\u8fba\u308a\u306e\u5e73\u5747\u6240\u8981\u6642\u9593(\u03bcs)\n [{register,2509.63},{unregister,2608.14},{whereis,0.49}],\n [{register,2420.48},{unregister,3952.45},{whereis,0.59}],\n [{register,2449.36},{unregister,2469.99},{whereis,0.41}],\n [{register,2647.81},{unregister,2469.52},{whereis,0.44}]]\n\n%% \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570=16 \u3067\u3001pg2\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u5b9f\u884c\n> dist_bench:do_bench(dist_bench:make_node_specs(Hosts, 16), 5, fun () -> dist_bench:pg2_bench(100, 100) end).\n[[{create,1787.34},{join,1735.18},{select,78.39}], % \u4f5c\u6210/\u30e1\u30f3\u30d0\u8ffd\u52a0/\u9078\u629e\u3001\u51e6\u7406\u306e\u4e00\u56de\u8fba\u308a\u306e\u5e73\u5747\u6240\u8981\u6642\u9593(\u03bcs)\n [{create,1713.19},{join,1704.63},{select,79.92}],\n [{create,1725.01},{join,2014.12},{select,77.63}],\n [{create,1764.74},{join,1721.5},{select,78.14}],\n [{create,1719.31},{join,1704.02},{select,76.69}]]\n```\n\n### \u6e2c\u5b9a\u7d50\u679c\n\n| \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u6570 | global (reg) | global (unreg) | gloabl (where) | pg2 (create) | pg2 (join)  | pg2 (select) |\n|--------------:|-------------:|---------------:|---------------:|-------------:|------------:|-------------:|\n|             0 |     55.63 \u03bcs |       51.83 \u03bcs |        0.37 \u03bcs |     33.15 \u03bcs |    36.53 \u03bcs |     75.43 \u03bcs |\n|             1 |     54.05 \u03bcs |       51.69 \u03bcs |        0.38 \u03bcs |    749.85 \u03bcs |   750.02 \u03bcs |     77.39 \u03bcs |\n|             4 |  1,704.57 \u03bcs |    1,593.71 \u03bcs |        0.44 \u03bcs |    990.30 \u03bcs | 1,140.77 \u03bcs |     78.66 \u03bcs |\n|            16 |  2,449.36 \u03bcs |    2,608.14 \u03bcs |        0.47 \u03bcs |  1,725.01 \u03bcs | 1,721.50 \u03bcs |     78.39 \u03bcs |\n|            64 |  7,348.40 \u03bcs |    6,665.51 \u03bcs |        0.57 \u03bcs |  5,260.28 \u03bcs | 5,295.05 \u03bcs |     79.42 \u03bcs |\n|           256 | 25,970.31 \u03bcs |   27,585.72 \u03bcs |        0.81 \u03bcs | 21,897.22 \u03bcs |21,938.38 \u03bcs |     79.31 \u03bcs |\n\nglobal\u30e2\u30b8\u30e5\u30fc\u30eb\u3082pg2\u30e2\u30b8\u30e5\u30fc\u30eb\u3082\u66f4\u65b0\u7cfb\u306e\u64cd\u4f5c\u306f\u3001\u30af\u30e9\u30b9\u30bf\u306e\u30b5\u30a4\u30ba\u306b\u6bd4\u4f8b\u3057\u3066\u51e6\u7406\u6642\u9593\u304c\u9577\u304f\u306a\u3063\u3066\u3044\u308b\u3002\n(\u4e21\u8005\u306e\u5b9f\u88c5\u7684\u306b\u3001\u691c\u7d22\u7cfb\u306f\u3001\u30ed\u30fc\u30ab\u30eb\u306eETS\u30c6\u30fc\u30d6\u30eb\u3092\u53c2\u7167\u3059\u308b\u3060\u3051\u3067\u6e08\u3080\u306e\u3067\u30af\u30e9\u30b9\u30bf\u30b5\u30a4\u30ba\u306b\u5f71\u97ff\u306f\u53d7\u3051\u306a\u3044)\n\n\u30af\u30e9\u30b9\u30bf\u30b5\u30a4\u30ba\u304c\u6bd4\u8f03\u7684\u5c0f\u3055\u3044\u5834\u5408\u3067\u3082\u3001\u66f4\u65b0\u7cfb\u306e\u64cd\u4f5c\u306e\u6027\u80fd\u306f\u305d\u308c\u307b\u3069\u826f\u3044\u8a33\u3067\u3082\u306a\u3044\u306e\u3067\u3001\u3053\u308c\u3089\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u591a\u7528\u306f\u907f\u3051\u305f\u65b9\u304c\u7121\u96e3\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n(\u30b7\u30b9\u30c6\u30e0\u306e\u8d77\u52d5\u6642\u306b\u4e00\u56de\u3060\u3051\u3001\u7279\u5b9a\u306b\u30d7\u30ed\u30bb\u30b9\u306b\u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u540d\u524d\u3092\u4ed8\u4e0e\u3057\u305f\u3044\u3001\u3068\u3044\u3063\u305f\u7528\u9014\u306a\u3089global\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u5341\u5206\u6709\u7528)\n\n\u3082\u3057\u3001\u6570\u767e\u4ee3\u53f0\u898f\u6a21\u4ee5\u4e0a\u306e\u30af\u30e9\u30b9\u30bf\u3092\u7d44\u307f\u305f\u304f\u3001\u304b\u3064\u3001\u3053\u308c\u3089\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u63d0\u4f9b\u3057\u3066\u308b\u3088\u3046\u306a\u6a5f\u80fd\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u306f\u3001\u5225\u9014\u540c\u7b49\u306e\u6a5f\u80fd\u3092\u63d0\u4f9b\u3057\u3066\u3044\u308b(\u3088\u308a\u30b9\u30b1\u30fc\u30eb\u3057\u3084\u3059\u3044)\u5916\u90e8\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u63a2\u3059\u304b\u3001\u81ea\u524d\u3067\u5b9f\u88c5\u3057\u305f\u65b9\u304c\u826f\u3055\u305d\u3046\u3002\n\n\u30b9\u30b1\u30fc\u30eb\u30a2\u30c3\u30d7\u95a2\u9023\u306e\u6027\u80fd\u6e2c\u5b9a\n=======================\n\n\u4e00\u3064\u306e\u30ce\u30fc\u30c9\u304c\u5229\u7528\u53ef\u80fd\u306aCPU\u30b3\u30a2\u6570\u304c\u5897\u3048\u305f\u5834\u5408\u306e\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u306e\u6e2c\u5b9a\u3002\n\nrpc\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u624b\u8efd\u306a\u30ce\u30fc\u30c9\u9593\u901a\u4fe1\u306e\u624b\u6bb5\u3068\u3057\u3066\u4fbf\u5229\u3060\u3051\u3069\u3001\u3042\u307e\u308a\u30b9\u30b1\u30fc\u30eb\u30a2\u30c3\u30d7\u306f\u3057\u306a\u3044\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u304b\u3082\u3057\u308c\u306a\u3044\u3001\u3068\u8a00\u3044\u305f\u3044\u3060\u3051\u3002\n\n\n\u30b9\u30b1\u30fc\u30eb\u30a2\u30c3\u30d7\u3057\u306a\u3044\u7406\u7531(\u306e\u4e88\u60f3):\n\n- \u5168\u3066\u306erpc\u30ea\u30af\u30a8\u30b9\u30c8\u306f\u3001\u4e00\u65e6\u5bfe\u8c61\u30ce\u30fc\u30c9\u4e0a\u306erex\u3068\u3044\u3046\u540d\u524d\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u7d4c\u7531\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\n- \u305d\u306e\u305f\u3081\u3001\u591a\u6570\u306e\u30ce\u30fc\u30c9\u304b\u3089\u4e26\u5217\u3057\u3066\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u767a\u884c\u3055\u308c\u305f\u5834\u5408\u3067\u3082\u3001\u305d\u306e\u30d7\u30ed\u30bb\u30b9(\u306e\u30ad\u30e5\u30fc)\u3067\u30ea\u30af\u30a8\u30b9\u30c8\u7fa4\u304c\u76f4\u5217\u5316\u3055\u308c\u3066\u3057\u307e\u3046\n  - rex\u30d7\u30ed\u30bb\u30b9\u4e0a\u3067\u884c\u308f\u308c\u308b\u51e6\u7406\u81ea\u4f53\u306f\u304b\u306a\u308a\u8efd\u3044\n  - \u305f\u3060\u3001\u5229\u7528\u53ef\u80fd\u306aCPU\u30b3\u30a2\u304c\u5897\u3048\u308b\u306b\u5f93\u3044\u3001\u305d\u306e\u50c5\u304b\u306a\u76f4\u5217\u5316\u70b9\u304c\u5168\u4f53\u306e\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u306b\u4e0e\u3048\u308b\u5f71\u97ff\u5ea6\u306f\u5927\u304d\u304f\u306a\u308b\n     - ref. [\u30a2\u30e0\u30c0\u30fc\u30eb\u306e\u6cd5\u5247](http://ja.wikipedia.org/wiki/%E3%82%A2%E3%83%A0%E3%83%80%E3%83%BC%E3%83%AB%E3%81%AE%E6%B3%95%E5%89%87)\n\n\u672c\u5f53\u306b\u30b9\u30b1\u30fc\u30eb\u30a2\u30c3\u30d7\u3057\u306a\u3044\u306e\u304b\u3069\u3046\u304b\u3092\u78ba\u8a8d\u3059\u308b\u306e\u304c\u3053\u3053\u3067\u306e\u76ee\u7684\n\n#### \u6e2c\u5b9a\u5185\u5bb9\n\n\u5229\u7528\u53ef\u80fd\u306aCPU\u306e\u30b3\u30a2\u6570\u306b\u5fdc\u3058\u305fRPC\u306e\u51e6\u7406\u6027\u80fd\u306e\u5909\u5316\u3092\u6e2c\u308b\u305f\u3081\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u6761\u4ef6\u3067\u6e2c\u5b9a\u3092\u884c\u3063\u305f: \n\n- \u30de\u30b9\u30bf\u30fc\u30ce\u30fc\u30c9\u3092RPC\u30b5\u30fc\u30d0\u3068\u3057\u3001\u8907\u6570\u306e\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u304b\u3089\u5927\u91cf\u306eRPC\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u767a\u884c\n- \u30de\u30b9\u30bf\u30fc\u30ce\u30fc\u30c9(ErlangVM)\u304c\u5229\u7528\u53ef\u80fd\u306aCPU\u30b3\u30a2\u6570\u3092\u5909\u5316\u3055\u305b\u3066\u3001\u305d\u308c\u306b\u4f34\u3046\u51e6\u7406\u6027\u80fd\u306e\u5909\u5316\u3092\u6e2c\u5b9a\n   - \u6b63\u78ba\u306b\u306fCPU\u30b3\u30a2\u6570\u3067\u306f\u306a\u304f\u3001ErlangVM\u4e0a\u3067\u7a3c\u50cd\u3059\u308b\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u306e\u6570\u3092\u5909\u5316\u3055\u305b\u305f\n   - \u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u306e\u6570\u306f`erlang:system_flag(schedulers_online, \u500b\u6570)`\u95a2\u6570\u3067\u52d5\u7684\u306b\u8a2d\u5b9a\u53ef\u80fd(\u306e\u306f\u305a)\n- __\u4e00\u56de\u306eRPC\u306b\u8981\u3057\u305f\u5e73\u5747\u6642\u9593__ \u3092\u8a08\u6e2c\n- \u6e2c\u5b9a\u95a2\u6570: `dist_bench:rpc_call_scaleup_bench/3` (\u5b9f\u969b\u306b\u6307\u5b9a\u3057\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u7b49\u306f\u4e0b\u306e\u5b9f\u884c\u4f8b\u3092\u53c2\u7167)\n\n\u307e\u305f\u6bd4\u8f03\u306e\u305f\u3081\u306b\u3001RPC\u3067\u306f\u306a\u304f\u3001echo\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u306b\u5bfe\u3059\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u9001\u53d7\u4fe1\u306e\u5834\u5408\u3067\u306e\u6e2c\u5b9a\u3082\u884c\u3063\u305f:\n\n- \u30de\u30b9\u30bf\u30fc\u30ce\u30fc\u30c9\u4e0a\u3067echo\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u3092\u8907\u6570\u8d77\u52d5\u3057\u305f\u4e0a\u3067\u3001\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u7fa4\u304b\u3089\u5bfe\u8c61\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u3092\u884c\u306a\u3046\n  - \u8d77\u52d5\u3059\u308becho\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u306e\u6570\u306f `\u5229\u7528\u53ef\u80fd\u306a\u30b3\u30a2\u6570*4` \u3068\u3057\u305f\n  - \u30ea\u30af\u30a8\u30b9\u30c8\u3092\u51e6\u7406\u3059\u308b\u30d7\u30ed\u30bb\u30b9\u304c\u5206\u6563\u3059\u308b\u305f\u3081\u3001\u30b3\u30a2\u6570\u306b\u5fdc\u3058\u3066\u826f\u597d\u306b\u30b9\u30b1\u30fc\u30eb\u3059\u308b\u3053\u3068\u3092\u671f\u5f85\n- __\u4e00\u56de\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1\u306b\u8981\u3057\u305f\u5e73\u5747\u6642\u9593__ \u3092\u8a08\u6e2c\n- \u6e2c\u5b9a\u95a2\u6570: `dist_bench:pid_msg_echo_scaleup_bench/3` (\u5b9f\u969b\u306b\u6307\u5b9a\u3057\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u7b49\u306f\u4e0b\u306e\u5b9f\u884c\u4f8b\u3092\u53c2\u7167)\n\n```erlang\n%% \u5b9f\u884c\u4f8b:\n\n%% \u4f7f\u7528CPU\u30b3\u30a2\u6570=8 \u3067\u3001RPC\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30c3\u30d7\u5ea6\u6e2c\u5b9a\u95a2\u6570\u3092\u5b9f\u884c\u3059\u308b\n> dist_bench:do_bench(dist_bench:make_node_specs(Hosts, 9), 5,\n                      fun () -> dist_bench:rpc_call_scaleup_bench(400000, 8, nodes()) end)\n\n%% \u4f7f\u7528CPU\u30b3\u30a2\u6570=8 \u3067\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1(+ echo\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u8907\u88fd)\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30c3\u30d7\u5ea6\u6e2c\u5b9a\u95a2\u6570\u3092\u5b9f\u884c\u3059\u308b\n> dist_bench:do_bench(dist_bench:make_node_specs(Hosts, 9), 5,\n                      fun () -> dist_bench:pid_msg_echo_scaleup_bench(400000, 8, nodes()) end).\n```\n\n#### \u6e2c\u5b9a\u7d50\u679c\n\n| CPU\u30b3\u30a2\u6570 | \u8907\u6570echo\u30b5\u30fc\u30d0  | RPC              |\n|---------:|--------------:|-----------------:|\n|        1 |     10.147 \u03bcs |        39.781 \u03bcs |\n|        2 |      3.440 \u03bcs |        21.818 \u03bcs |\n|        4 |      1.864 \u03bcs |        21.186 \u03bcs |\n|        8 |      1.663 \u03bcs |        21.388 \u03bcs |\n|       16 |      1.915 \u03bcs |        20.740 \u03bcs |\n|       32 |      1.993 \u03bcs |        22.576 \u03bcs |\n\n\u8907\u6570echo\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u306b\u5bfe\u3059\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1\u3067\u306f\u3001\u30b3\u30a2\u6570\u306e\u5897\u52a0\u306b\u4f34\u3044\u3001\u6700\u5927\u3067\u516d\u500d\u7a0b\u5ea6\u307e\u3067\u6027\u80fd\u304c\u5411\u4e0a\u3057\u3066\u3044\u308b\u304c\u3001RPC\u3092\u4f7f\u3063\u305f\u5834\u5408\u306f\u6027\u80fd\u5411\u4e0a\u306f\u4e8c\u500d\u7a0b\u5ea6\u306b\u7559\u307e\u3063\u3066\u3044\u308b\u3002\n(\u524d\u8005\u306e\u30b9\u30b1\u30fc\u30eb\u5ea6\u5408\u3044\u304c\u516d\u500d\u306b\u7559\u307e\u3063\u3066\u3044\u308b\u306e\u306f\u3001\u304a\u305d\u3089\u304f\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4f5c\u308a\u304c\u60aa\u3044\u305f\u3081\u3002\u3061\u3083\u3093\u3068\u66f8\u3051\u3070\u3001\u7269\u7406\u30b3\u30a2\u306e\u6570(= 16)\u306e\u5206\u307e\u3067\u306f\u30b9\u30b1\u30fc\u30eb\u3057\u3066\u304f\u308c\u308b\u3053\u3068\u3092\u671f\u5f85\u3057\u305f\u3044)\n\nrpc\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30c3\u30d7\u5ea6\u5408\u3044\u304c\u5c0f\u3055\u3044\u3068\u3044\u3063\u3066\u3082\u3001\u4eca\u56de\u306e\u6e2c\u5b9a\u306b\u5f93\u3048\u3070\u3001\u4e00\u3064\u306e\u30ce\u30fc\u30c9\u3067(\u6700\u5927\u3067)\u79d2\u9593\u306b\u4e94\u4e07\u30ea\u30af\u30a8\u30b9\u30c8\u7a0b\u5ea6\u306f\u634c\u3051\u308b\u8a08\u7b97\u3068\u306a\u308b\u306e\u3067\u3001\u9069\u6750\u9069\u6240\u3067\u4f7f\u3046\u5206\u306b\u306f\u554f\u984c\u3068\u306a\u308b\u3053\u3068\u306f\u5c11\u306a\u3055\u305d\u3046\u3002\n\n\u611f\u60f3\n====\n\n\u4eca\u56de\u306e(\u304b\u306a\u308a\u7c21\u6613\u7684\u306a)\u6e2c\u5b9a\u306e\u7d50\u679c\u3092\u898b\u308b\u9650\u308a\u3067\u306f\u3001\u30ce\u30fc\u30c9\u7ba1\u7406\u5468\u308a\u3084\u30ce\u30fc\u30c9\u9593\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1\u3001\u30d7\u30ed\u30bb\u30b9\u306e\u6b7b\u6d3b\u76e3\u8996\u3001\u3068\u3044\u3063\u305f\u5206\u6563Erlang\u306e\u672c\u5f53\u306b\u57fa\u790e\u7684\u306a\u90e8\u5206(\u6a5f\u80fd)\u306b\u95a2\u3057\u3066\u3044\u3048\u3070\u3001\u6570\u767e\u30ce\u30fc\u30c9\u898f\u6a21\u3067\u3082\u7279\u306b\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u306b\u306f\u554f\u984c\u306a\u3055\u305d\u3046\u306a\u5370\u8c61\u3060\u3063\u305f\u3002\n(\u671f\u5f85\u901a\u308a\u306e\u6027\u80fd\u304c\u51fa\u3066\u304a\u308a\u3001\u5909\u306a\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u7b49\u306f\u306a\u3055\u305d\u3046\u3060\u3063\u305f)\n\n\u9006\u306b\u3001\u6a19\u6e96\u3067\u914d\u5e03\u3055\u308c\u3066\u3044\u308b\u5206\u6563\u7cfb\u306e\u30e9\u30a4\u30d6\u30e9\u30ea(ex. global\u30e2\u30b8\u30e5\u30fc\u30eb)\u306f\u3001\u30af\u30e9\u30b9\u30bf\u30b5\u30a4\u30ba\u304c\u305d\u3053\u307e\u3067\u5927\u304d\u304f\u306f\u306a\u3089\u306a\u3044\u3053\u3068\u3092\u60f3\u5b9a\u3057\u305f\u4f5c\u308a\u306b\u306a\u3063\u3066\u3044\u308b\u3082\u306e\u304c\u591a\u305d\u3046\u306b\u898b\u3048\u308b(\u79c1\u898b)\u306e\u3067\u3001\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u6ce8\u610f\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u305d\u3046\u3002\n(\u304a\u305d\u3089\u304f\u306f\u5225\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u9078\u629e\u3057\u305f\u65b9\u304c\u61f8\u547d\u3002[\u6628\u65e5\u7d39\u4ecb\u3055\u308c\u3066\u3044\u305friak_core](http://kuenishi.hatenadiary.jp/entry/2014/12/23/000000)\u306f\u305d\u306e\u5019\u88dc\uff1f)\n\n\u500b\u4eba\u7684\u306b\u306f\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1\u7b49\u3068\u3044\u3063\u305f\u4e0b\u56de\u308a\u306e\u6a5f\u80fd\u304c\u3061\u3083\u3093\u3068\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308b\u3060\u3051\u3067\u3082\u3060\u3044\u3076\u52a9\u304b\u308b\u306e\u3067\u3001\u5f8c\u306f(\u4eca\u56de\u306f\u8003\u616e\u304b\u3089\u5b8c\u5168\u306b\u5916\u3057\u305f\u304c)\u5b89\u5b9a\u6027\u7b49\u3068\u3044\u3063\u305f\u6027\u80fd\u4ee5\u5916\u306e\u9762\u3067\u554f\u984c\u304c\u306a\u3044\u304b\u3069\u3046\u304b\u3092\u78ba\u8a8d\u3057\u3066\u307f\u3066\u3001\u3082\u3057\u5927\u4e08\u592b\u305d\u3046\u306a\u3089\u5206\u6563Erlang\u306f\u3001\u305d\u3053\u305d\u3053\u5927\u304d\u306a\u898f\u6a21\u306e\u30af\u30e9\u30b9\u30bf\u3092\u6271\u3046\u305f\u3081\u306e\u57fa\u677f\u3068\u3057\u3066\u7d50\u69cb\u91cd\u5b9d\u3057\u305d\u3046\u3060\u3068\u601d\u3046\u3002\n(\u305d\u3082\u305d\u3082\u6027\u80fd\u5468\u308a\u3082\u3001\u3082\u3063\u3068\u3061\u3083\u3093\u3068\u3057\u305f\u6e2c\u5b9a\u3092\u884c\u3046\u5fc5\u8981\u304c\u3042\u308b\u3001\u3068\u3044\u3046\u8a71\u306f\u7f6e\u3044\u3066\u304a\u3044\u3066...)\n\n\u6e2c\u5b9a\u7528\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n================\n\n```erlang:dist_bench.erl\n-module(dist_bench).\n\n%%% External API\n-export([\n         %% utility\n         make_node_specs/2,\n         setup_nodes/1,\n         do_bench/3,\n\n         %% scale out benchmarks\n         pid_msg_echo_bench/2,\n         name_msg_echo_bench/2,\n         rpc_call_bench/2,\n         monitor_bench/2,\n         global_bench/1,\n         pg2_bench/2,\n\n         %% scale up benchmarks\n         pid_msg_echo_scaleup_bench/3,\n         rpc_call_scaleup_bench/3\n        ]).\n\n\n%%% Internal API\n-export([\n         echo_server_start/1,\n         do_echo/2,\n         do_rpc_call/2,\n         make_echo_msg/1\n        ]).\n\n\n%%% Types\n-export_type([\n              node_spec/0,\n              node_specs/0,\n              microseconds/0\n             ]).\n\n-type node_spec() :: {HostName::atom(), NodeCount::non_neg_integer()}. % `HostName'\u4e0a\u3067\u4f55\u500b\u306e\u30ce\u30fc\u30c9\u3092\u8d77\u52d5\u3059\u308b\u304b\n-type node_specs() :: [node_spec()].\n\n-type microseconds() :: non_neg_integer().\n\n\n%%% External Functions: Utility\n\n%% @doc `TotalNodeCount'\u3067\u6307\u5b9a\u3055\u308c\u305f\u6570\u306e\u30ce\u30fc\u30c9\u7fa4\u3092\u751f\u6210\u3059\u308b\u305f\u3081\u306e`node_specs()'\u3092\u751f\u6210\u3057\u3066\u8fd4\u3059\n%%\n%% `HostNames'\u3067\u6307\u5b9a\u3055\u308c\u305f\u5404\u30de\u30b7\u30f3\u4e0a\u3067\u8d77\u52d5\u3055\u308c\u308b\u30ce\u30fc\u30c9\u6570\u306f\u3001\u6975\u529b\u7b49\u3057\u3044\u6570\u306b\u306a\u308b\u3088\u3046\u306b\u8abf\u6574\u3055\u308c\u308b\n%%\n%% ```\n%% > make_node_specs([a,b,c], 10).\n%% [{a,4},{b,3},{c,3}]\n%% '''\n-spec make_node_specs([HostName::atom()], TotalNodeCount::non_neg_integer()) -> node_specs().\nmake_node_specs(HostNames, TotalNodeCount) ->\n    PerHostNodeCount = TotalNodeCount div length(HostNames),\n    RemainderCount = TotalNodeCount rem length(HostNames),\n    {Specs, _} =\n        lists:mapfoldl(\n          fun (Host, Rem) ->\n                  {{Host, PerHostNodeCount + min(1, Rem)}, max(0, Rem - 1)}\n          end,\n          RemainderCount,\n          HostNames),\n    Specs.\n\n%% @doc \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u7fa4\u3092\u8d77\u52d5\u3059\u308b\n%%\n%% \u547c\u3073\u51fa\u3057\u5143\u30d7\u30ed\u30bb\u30b9\u304c\u7d42\u4e86\u3057\u305f\u5834\u5408\u3001\u8d77\u52d5\u3057\u305f\u30ce\u30fc\u30c9\u7fa4\u3082\u81ea\u52d5\u3067\u7d42\u4e86\u3059\u308b(\u30ea\u30f3\u30af\u304c\u8cbc\u3089\u308c\u3066\u3044\u308b)\n-spec setup_nodes(node_specs()) -> {SlaveNodeCount, StartAverateTime} when\n      SlaveNodeCount   :: non_neg_integer(), % \u8d77\u52d5\u3057\u305f\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u306e\u6570\n      StartAverateTime :: microseconds().    % \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u306e\u8d77\u52d5\u306b\u8981\u3057\u305f\u6642\u9593\u306e\u5e73\u5747\u5024\nsetup_nodes(NodeSpecs) ->\n    [] = nodes(),\n    Tooks =\n        lists:append(\n          [[begin\n                NodeName = list_to_atom(lists:flatten(io_lib:format(\"slave_~p\", [I]))), % \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u306e\u540d\u524d\u306f'slave_\u901a\u3057\u756a\u53f7'\u5f62\u5f0f\n                {Took, {ok, _}} = timer:tc(fun () -> slave:start_link(HostName, NodeName) end),\n                Took\n            end || I <- lists:seq(0, NodeCount - 1)]\n           || {HostName, NodeCount} <- NodeSpecs]),\n\n    {_, Bin, File} = code:get_object_code(?MODULE),\n    rpc:multicall(nodes(), code, load_binary, [?MODULE, File, Bin]),\n\n    TookAverage = lists:sum(Tooks) / max(1, length(Tooks)),\n    {length(Tooks), TookAverage}.\n\n%% @doc \u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u7fa4\u3092\u6e96\u5099\u3057\u305f\u5f8c\u306b\u3001`BenchFun'\u3067\u6307\u5b9a\u3055\u308c\u305f\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u5b9f\u884c\u3059\u308b\n-spec do_bench(node_specs(), BenchCount, BenchFun) -> [Result] when\n      BenchCount :: non_neg_integer(),  % `BenchFun'\u3092\u4f55\u56de\u5b9f\u884c\u3059\u308b\u304b\n      BenchFun   :: fun (() -> Result), % \u500b\u3005\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u5b9f\u884c\u3059\u308b\u95a2\u6570\n      Result     :: term().\ndo_bench(NodeSpecs, BenchCount, BenchFun) ->\n    {Pid, Monitor} =\n        spawn_monitor(\n          fun () -> % \u30d9\u30f3\u30c1\u30de\u30fc\u30af\u7d42\u4e86\u6642\u306b\u30b9\u30ec\u30fc\u30d6\u30ce\u30fc\u30c9\u7fa4\u3092\u78ba\u5b9f\u306b\u7d42\u4e86\u3055\u305b\u305f\u3044\u306e\u3067\u3001\u5225\u30d7\u30ed\u30bb\u30b9\u3067\u5b9f\u884c\u3059\u308b\n                  io:format(\"# setup nodes ... \"),\n                  {NodeCount, StartAverateTime} = setup_nodes(NodeSpecs),\n                  io:format(\"done: count=~p, start_avg_time=~p sec\\n\", [NodeCount, StartAverateTime / 1000000]),\n\n                  Results =\n                      [begin\n                           io:format(\"# [~p] do bench ... \", [I]),\n                           lists:foreach(fun erlang:garbage_collect/1, erlang:processes()),\n                           {Took, Result} = timer:tc(BenchFun),\n                           io:format(\"done: time=~p sec\\n\", [Took / 1000000]),\n                           Result\n                       end || I <- lists:seq(1, BenchCount)],\n                  io:format(\"\\n\"),\n                  exit({bench_finished, Results})\n          end),\n    receive\n        {'DOWN', Monitor, _, _, Reason} ->\n            case Reason of\n                {bench_finished, Results} -> Results;\n                _ -> error({bench_process_down, Pid, Reason})\n            end\n    end.\n\n\n%%% External Functions: Scale Out Benchmarks\n\n%% @doc PID\u6307\u5b9a\u306b\u3088\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u6027\u80fd\u3092\u6e2c\u5b9a\u3059\u308b\u305f\u3081\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u95a2\u6570\n-spec pid_msg_echo_bench(non_neg_integer(), [node()]) -> AverageEchoTime::microseconds().\npid_msg_echo_bench(EchoCount, Nodes) ->\n    %% 1) \u30ea\u30e2\u30fc\u30c8\u30ce\u30fc\u30c9\u3067echo\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3059\u308b\n    RemoteProcs = [spawn_link(Node, ?MODULE, echo_server_start, [undefined]) || Node <- Nodes],\n\n    %% 2) `EchoCount'\u56de\u3060\u3051\u30ea\u30e2\u30fc\u30c8\u30ce\u30fc\u30c9\u4e0a\u306e\u30d7\u30ed\u30bb\u30b9\u3068\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u3084\u308a\u3068\u308a(echo)\u3057\u3001\u305d\u306e\u6240\u8981\u6642\u9593\u3092\u6e2c\u5b9a\u3059\u308b\n    {MicroSeconds, _} =timer:tc(fun () -> do_echo(EchoCount, RemoteProcs) end),\n\n    %% 3) \u5f8c\u59cb\u672b\n    lists:foreach(fun (Pid) -> unlink(Pid), exit(Pid, kill) end, RemoteProcs),\n    MicroSeconds / EchoCount.  % \u4e00\u56de\u306e\u3084\u308a\u3068\u308a\u306b\u8981\u3057\u305f\u5e73\u5747\u6642\u9593\u3092\u8fd4\u3059\n\n%% @doc \u30d7\u30ed\u30bb\u30b9\u540d\u6307\u5b9a\u306b\u3088\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1(+ PID\u6307\u5b9a\u306b\u3088\u308b\u53d7\u4fe1)\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u6027\u80fd\u3092\u6e2c\u5b9a\u3059\u308b\u305f\u3081\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u95a2\u6570\n-spec name_msg_echo_bench(non_neg_integer(), [node()]) -> AverageEchoTime::microseconds().\nname_msg_echo_bench(EchoCount, Nodes) ->\n    %% 1) \u30ea\u30e2\u30fc\u30c8\u30ce\u30fc\u30c9\u3067echo\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3059\u308b\n    RemoteProcs = [spawn_link(Node, ?MODULE, echo_server_start, [echo_server]) || Node <- Nodes],\n    RemoteNames = [{echo_server, node(Pid)} || Pid <- RemoteProcs],\n    timer:sleep(100), % NOTE: \u30ea\u30e2\u30fc\u30c8\u30ce\u30fc\u30c9\u4e0a\u3067\u306e\u540d\u524d\u767b\u9332\u304c\u5b8c\u4e86\u3059\u308b\u306e\u3092\u9069\u5f53\u306a\u6642\u9593\u3060\u3051\u5f85\u3064 (sleep\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u306f\u624b\u629c\u304d)\n\n    %% 2) `EchoCount'\u56de\u3060\u3051\u30ea\u30e2\u30fc\u30c8\u30ce\u30fc\u30c9\u4e0a\u306e\u30d7\u30ed\u30bb\u30b9\u3068\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u3084\u308a\u3068\u308a(echo)\u3057\u3001\u305d\u306e\u6240\u8981\u6642\u9593\u3092\u6e2c\u5b9a\u3059\u308b\n    {MicroSeconds, _} = timer:tc(fun () -> do_echo(EchoCount, RemoteNames) end),\n\n    %% 3) \u5f8c\u59cb\u672b\n    lists:foreach(fun (Pid) -> unlink(Pid), exit(Pid, kill) end, RemoteProcs),\n    MicroSeconds / EchoCount.  % \u4e00\u56de\u306e\u3084\u308a\u3068\u308a\u306b\u8981\u3057\u305f\u5e73\u5747\u6642\u9593\u3092\u8fd4\u3059\n\n%% @doc rpc\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u7528\u3044\u305f\u95a2\u6570\u547c\u3073\u51fa\u3057\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u6027\u80fd\u3092\u6e2c\u5b9a\u3059\u308b\u305f\u3081\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u95a2\u6570\n-spec rpc_call_bench(non_neg_integer(), [node()]) -> AverageCallTime::microseconds().\nrpc_call_bench(CallCount, Nodes) ->\n    %% 1) `CallCount'\u56de\u3060\u3051\u30ea\u30e2\u30fc\u30c8\u30ce\u30fc\u30c9\u306b\u5bfe\u3057\u3066RPC\u547c\u3073\u51fa\u3057\u3092\u884c\u3044\u3001\u305d\u306e\u6240\u8981\u6642\u9593\u3092\u6e2c\u5b9a\u3059\u308b\n    {MicroSeconds, _} = timer:tc(fun () -> do_rpc_call(CallCount, Nodes) end),\n    MicroSeconds / CallCount.\n\n%% @doc `erlang:monitor/2'\u3092\u7528\u3044\u305f\u30d7\u30ed\u30bb\u30b9\u6b7b\u6d3b\u76e3\u8996\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u6027\u80fd\u3092\u6e2c\u5b9a\u3059\u308b\u305f\u3081\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u95a2\u6570\n-spec monitor_bench(non_neg_integer(), [node()]) -> AverateTime::microseconds().\nmonitor_bench(ProcessCount, Nodes) ->\n    %% 1) \u30ea\u30e2\u30fc\u30c8\u30ce\u30fc\u30c9\u4e0a\u3067`ProcessCount'\u500b\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u751f\u6210\u3059\u308b\n    RemoteProcs = [spawn(Node, timer, sleep, [infinity]) ||\n                      Node <- Nodes,\n                      _    <- lists:seq(1, ProcessCount, length(Nodes))], % NOTE: \u5270\u4f59\u5206\u304c\u6368\u3066\u3089\u308c\u3066\u3057\u307e\u3046\n    RealProcessCount = length(RemoteProcs),\n\n    %% 2) \u30ea\u30e2\u30fc\u30c8\u30d7\u30ed\u30bb\u30b9\u7fa4\u306b\u5bfe\u3059\u308b\u76e3\u8996\u767b\u9332\u304a\u3088\u3073\u30c0\u30a6\u30f3\u901a\u77e5\u306e\u53d7\u4fe1\u306b\u639b\u304b\u3063\u305f\u6642\u9593\u3092\u6e2c\u5b9a\u3059\u308b\n    {MicroSeconds, _} =\n\ttimer:tc(\n\t  fun () ->\n                  lists:foreach(fun (Pid) -> monitor(process, Pid) end, RemoteProcs),\n\t\t  lists:foreach(fun (Pid) -> exit(Pid, kill) end, RemoteProcs),\n\t\t  wait_downs(RealProcessCount) % \u5168\u3066\u306e\u76e3\u8996\u30d7\u30ed\u30bb\u30b9\u306e'DOWN'\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u3051\u53d6\u308b\u307e\u3067\u5f85\u6a5f\u3059\u308b\n\t  end),\n    MicroSeconds / RealProcessCount.\n\n%% @doc global\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u5404\u7a2e\u95a2\u6570\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u6027\u80fd\u3092\u6e2c\u5b9a\u3059\u308b\u305f\u3081\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u95a2\u6570\n-spec global_bench(NameCount) -> [ResultEntry] when\n      NameCount   :: non_neg_integer(), % \u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u30d7\u30ed\u30bb\u30b9\u540d\u306e\u767b\u9332/\u89e3\u9664/\u691c\u7d22\u3092\u4f55\u56de\u884c\u306a\u3046\u304b\n      ResultEntry :: {register, microseconds()}   % `global:register_name/2'\u547c\u3073\u51fa\u3057\u306e\u5e73\u5747\u6240\u8981\u6642\u9593\n                   | {unregister, microseconds()} % `global:unregister_name/2'\u547c\u3073\u51fa\u3057\u306e\u5e73\u5747\u6240\u8981\u6642\u9593\n                   | {whereis, microseconds()}.   % `global:whereis_name/2'\u547c\u3073\u51fa\u3057\u306e\u5e73\u5747\u6240\u8981\u6642\u9593\nglobal_bench(NameCount) ->\n    %% 1) \u30d9\u30f3\u30c1\u30de\u30fc\u30af\u306b\u7528\u3044\u308b\u540d\u524d\u304a\u3088\u3073\u30d7\u30ed\u30bb\u30b9\u306e\u6e96\u5099\n    Names = [{?MODULE, I} || I <- lists:seq(1, NameCount)],\n    Procs = [spawn_link(timer, sleep, [infinity]) || _ <- lists:seq(1, NameCount)],\n    Pairs = lists:zip(Names, Procs),\n\n    %% 2) \u5404\u7a2e\u95a2\u6570\u306e\u5b9f\u884c\u6642\u9593\u3092\u6e2c\u5b9a\n    {RegisterMicros, _} = % \u767b\u9332\n        timer:tc(\n          fun () -> lists:foreach(fun ({Name, Proc}) -> yes = global:register_name(Name, Proc) end, Pairs) end),\n    {WhereisMicros, _} =  % \u691c\u7d22\n        timer:tc(\n          fun () -> lists:foreach(fun ({Name, Proc}) -> Proc = global:whereis_name(Name) end, Pairs) end),\n    {UnregisterMicros, _} = % \u767b\u9332\u89e3\u9664\n        timer:tc(\n          fun () -> lists:foreach(fun (Name) -> global:unregister_name(Name) end, Names) end),\n\n    %% 3) \u5f8c\u59cb\u672b\n    lists:foreach(fun (Pid) -> unlink(Pid), exit(Pid, kill) end, Procs),\n    [\n     {register, RegisterMicros / NameCount},\n     {unregister, UnregisterMicros / NameCount},\n     {whereis, WhereisMicros / NameCount}\n    ].\n\n%% @doc pg2\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u5404\u7a2e\u95a2\u6570\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u6027\u80fd\u3092\u6e2c\u5b9a\u3059\u308b\u305f\u3081\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u95a2\u6570\n-spec pg2_bench(GroupCount, MemberCount) -> [ResultEntry] when\n      GroupCount :: non_neg_integer(),  % `pg2:create/1'\u3092\u4f7f\u3063\u3066\u4f5c\u6210\u3059\u308b\u30b0\u30eb\u30fc\u30d7\u306e\u6570\n      MemberCount :: non_neg_integer(), % `pg2:join/2'\u3092\u4f7f\u3063\u3066\u30b0\u30eb\u30fc\u30d7\u306b\u53c2\u52a0\u3055\u305b\u308b\u30d7\u30ed\u30bb\u30b9\u306e\u6570\n      ResultEntry :: {create, microseconds()} % `pg2:create/1'\u547c\u3073\u51fa\u3057\u306e\u5e73\u5747\u6240\u8981\u6642\u9593\n                   | {join, microseconds()}   % `pg2:join/2'\u547c\u3073\u51fa\u3057\u306e\u5e73\u5747\u6240\u8981\u6642\u9593\n                   | {select, microseconds()}.   % `pg2:get_closest_pid/1'\u547c\u3073\u51fa\u3057\u306e\u5e73\u5747\u6240\u8981\u6642\u9593\npg2_bench(GroupCount, MemberCount) ->\n    %% 1) \u30d9\u30f3\u30c1\u30de\u30fc\u30af\u306b\u7528\u3044\u308b\u30b0\u30eb\u30fc\u30d7\u540d\u304a\u3088\u3073\u30d7\u30ed\u30bb\u30b9\u306e\u6e96\u5099\n    [] = pg2:which_groups(),\n    Groups = [{group, I} || I <- lists:seq(1, GroupCount)],\n    Members = [spawn_link(timer, sleep, [infinity]) || _ <- lists:seq(1, MemberCount)],\n\n    %% 2) \u5404\u7a2e\u95a2\u6570\u306e\u5b9f\u884c\u6642\u9593\u3092\u6e2c\u5730\n    {CreateMicros, _} =\n        timer:tc(\n          fun () -> lists:foreach(fun pg2:create/1, Groups) end),\n    {JoinMicros, _} =\n        timer:tc(\n          fun () -> lists:foreach(fun (Pid) -> ok = pg2:join(hd(Groups), Pid) end, Members) end),\n    {SelectMicros, _} =\n        timer:tc(\n          fun () -> lists:foreach(fun (_) -> true = is_pid(pg2:get_closest_pid(hd(Groups))) end, Members) end),\n\n    %% 3) \u5f8c\u59cb\u672b\n    lists:foreach(fun pg2:delete/1, Groups),\n    lists:foreach(fun (Pid) -> unlink(Pid), exit(Pid, kill) end, Members),\n    [\n     {create, CreateMicros / GroupCount},\n     {join, JoinMicros / MemberCount},\n     {select, SelectMicros / MemberCount}\n    ].\n\n\n%%% External Functions: Scale Up Benchmarks\n\n%% @doc PID\u6307\u5b9a\u306b\u3088\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30c3\u30d7\u6027\u80fd\u3092\u6e2c\u5b9a\u3059\u308b\u305f\u3081\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u95a2\u6570\n-spec pid_msg_echo_scaleup_bench(non_neg_integer(), non_neg_integer(), [node()]) -> AverageEchoTime::microseconds().\npid_msg_echo_scaleup_bench(EchoCount, SchedulersOnline, Nodes) ->\n    %% 1) \u5229\u7528\u53ef\u80fd\u306a\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u6570(\u2252  CPU\u30b3\u30a2\u6570)\u3092\u5236\u9650\u3059\u308b\n    OldSchedulersOnline = erlang:system_flag(schedulers_online, SchedulersOnline),\n\n    %% 2) \u81ea\u30ce\u30fc\u30c9\u306becho\u30b5\u30fc\u30d0\u7fa4\u3092\u8d77\u52d5\u3059\u308b\n    EchoServerCount = SchedulersOnline * 4, % \u5229\u7528\u53ef\u80fd\u306a\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u6570\u306e\u56db\u500d\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3057\u3066\u304a\u304f\n    EchoServers = [spawn_link(?MODULE, echo_server_start, [undefined]) || _ <- lists:seq(1, EchoServerCount)],\n\n    %% 3) `Nodes'\u4e0a\u3067\u3001echo\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u7fa4\u3092\u5b9f\u884c\u3057\u3001\u5168\u3066\u306e\u51e6\u7406\u304c\u5b8c\u4e86\u3059\u308b\u307e\u3067\u306e\u6240\u8981\u6642\u9593\u3092\u8a08\u6e2c\u3059\u308b\n    PerNodeEchoCount = EchoCount div length(Nodes), % NOTE: \u5270\u4f59\u5206\u304c\u6368\u3066\u3089\u308c\u3066\u3057\u307e\u3046\n    RealEchoCount = PerNodeEchoCount * length(Nodes),\n    {MicroSeconds, _} =\n        timer:tc(\n          fun () ->\n                  EchoClients = [monitor(process, spawn(Node, ?MODULE, do_echo, [PerNodeEchoCount, EchoServers])) || Node <- Nodes],\n                  wait_downs(length(EchoClients)) % \u5168\u3066\u306eecho\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u7d42\u4e86\u3059\u308b\u306e\u5f85\u3064\n          end),\n\n    %% 4) \u5f8c\u59cb\u672b\n    lists:foreach(fun (Pid) -> unlink(Pid), exit(Pid, kill) end, EchoServers),\n    SchedulersOnline = erlang:system_flag(schedulers_online, OldSchedulersOnline),\n    MicroSeconds / RealEchoCount.\n\n%% @doc PID\u6307\u5b9a\u306b\u3088\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30c3\u30d7\u6027\u80fd\u3092\u6e2c\u5b9a\u3059\u308b\u305f\u3081\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u95a2\u6570\n-spec rpc_call_scaleup_bench(non_neg_integer(), non_neg_integer(), [node()]) -> AverageCallTime::microseconds().\nrpc_call_scaleup_bench(CallCount, SchedulersOnline, Nodes) ->\n    %% 1) \u5229\u7528\u53ef\u80fd\u306a\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u6570(\u2252  CPU\u30b3\u30a2\u6570)\u3092\u5236\u9650\u3059\u308b\n    OldSchedulersOnline = erlang:system_flag(schedulers_online, SchedulersOnline),\n\n    %% 3) `Nodes'\u4e0a\u3067\u3001echo\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u7fa4\u3092\u5b9f\u884c\u3057\u3001\u5168\u3066\u306e\u51e6\u7406\u304c\u5b8c\u4e86\u3059\u308b\u307e\u3067\u306e\u6240\u8981\u6642\u9593\u3092\u8a08\u6e2c\u3059\u308b\n    PerNodeCallCount = CallCount div length(Nodes), % NOTE: \u5270\u4f59\u5206\u304c\u6368\u3066\u3089\u308c\u3066\u3057\u307e\u3046\n    RealCallCount = PerNodeCallCount * length(Nodes),\n    {MicroSeconds, _} =\n        timer:tc(\n          fun () ->\n                  CallClients = [monitor(process, spawn(Node, ?MODULE, do_rpc_call, [PerNodeCallCount, [node()]])) || Node <- Nodes],\n                  wait_downs(length(CallClients)) % \u5168\u3066\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u7d42\u4e86\u3059\u308b\u306e\u5f85\u3064\n          end),\n\n    %% 4) \u5f8c\u59cb\u672b\n    SchedulersOnline = erlang:system_flag(schedulers_online, OldSchedulersOnline),\n    MicroSeconds / RealCallCount.\n\n\n%%% Internal Functions\n\n%% @doc `Servers'\u3067\u6307\u5b9a\u3055\u308c\u305f\u30d7\u30ed\u30bb\u30b9\u7fa4\u3068\u306e\u9593\u3067\u3001\u5408\u8a08\u3067`EchoCount'\u500b\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u3084\u308a\u3068\u308a\u3059\u308b\n-spec do_echo(non_neg_integer(), [Server]) -> ok when Server :: pid() | {atom(), node()}.\ndo_echo(EchoCount, Servers) ->\n    send_messages(EchoCount, Servers, Servers), % echo\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\n    wait_messages(EchoCount). % echoback\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5f85\u3064 (NOTE: \u73fe\u72b6\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u4e2d\u8eab\u306b\u306f\u8003\u616e\u3057\u3066\u3044\u306a\u3044)\n\n-spec send_messages(non_neg_integer(), [Server], [Server]) -> ok when Server :: pid() | {atom(), node()}.\nsend_messages(0, _, _)                -> ok;\nsend_messages(N, [], Servers)         -> send_messages(N, Servers, Servers); % \u4e00\u5de1\u3057\u305f\u306e\u3067\u6700\u521d\u306b\u623b\u308b\nsend_messages(N, [S | Rest], Servers) ->\n    S ! {self(), N},\n    send_messages(N - 1, Rest, Servers).\n\n%% @doc `Count'\u500b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u307e\u3067\u5f85\u6a5f\u3059\u308b (\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u5185\u5bb9\u306b\u306f\u95a2\u77e5\u3057\u306a\u3044)\n-spec wait_messages(Count::non_neg_integer()) -> ok.\nwait_messages(0) -> ok;\nwait_messages(N) -> receive _ -> wait_messages(N - 1) end.\n\n-spec wait_downs(Count::non_neg_integer()) -> ok.\nwait_downs(0) -> ok;\nwait_downs(N) ->  receive {'DOWN', _, _, _, _} -> wait_downs(N - 1) end.\n\n%% @doc `Nodes'\u3067\u6307\u5b9a\u3055\u308c\u305f\u30ce\u30fc\u30c9\u7fa4\u306b\u5bfe\u3057\u3066\u3001\u5408\u8a08\u3067`CallCount'\u56de\u306eRPC\u547c\u3073\u51fa\u3057\u3092\u884c\u306a\u3046\n-spec do_rpc_call(non_neg_integer(), [node()]) -> ok.\ndo_rpc_call(CallCount, Nodes) ->\n    rpc_async_calls(CallCount, Nodes, Nodes),\n    wait_messages(CallCount). % RPC\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u5f85\u3064 (NOTE: \u73fe\u72b6\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u4e2d\u8eab\u306b\u306f\u8003\u616e\u3057\u3066\u3044\u306a\u3044)\n\n-spec rpc_async_calls(non_neg_integer(), [node()], [node()]) -> ok.\nrpc_async_calls(0, _, _)                -> ok;\nrpc_async_calls(N, [], Nodes)           -> rpc_async_calls(N, Nodes, Nodes);% \u4e00\u5de1\u3057\u305f\u306e\u3067\u6700\u521d\u306b\u623b\u308b\nrpc_async_calls(N, [Dst | Rest], Nodes) ->\n    rpc:async_call(Dst, ?MODULE, make_echo_msg, [N]),\n    rpc_async_calls(N - 1, Rest, Nodes).\n\n%% @doc \u30a8\u30b3\u30fc\u30b5\u30fc\u30d0\u3092\u8d77\u52d5\u3059\u308b\n-spec echo_server_start(Name) -> no_return() when Name :: atom() | undefined.\necho_server_start(undefined) ->\n    echo_server_loop();\necho_server_start(Name) ->\n    true = register(Name, self()), % `Name =/= undefined'\u306a\u3089\u540d\u524d\u4ed8\u304d\u30d7\u30ed\u30bb\u30b9\u3068\u3057\u3066\u8d77\u52d5\u3059\u308b\n    echo_server_loop().\n\n-spec echo_server_loop() -> no_return().\necho_server_loop() ->\n    receive\n        {From, Msg} ->\n            From ! make_echo_msg(Msg),\n            echo_server_loop()\n    end.\n\n-spec make_echo_msg(term()) -> term().\nmake_echo_msg(Msg) ->\n    {self(), Msg}.\n```\n", "tags": ["ErlangOTP17.4"]}