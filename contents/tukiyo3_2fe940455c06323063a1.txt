{"context": "\n\n\u53c2\u8003\n\nFigure out what's up with 5.0 \u00b7 Issue #98 \u00b7 docker-library/elasticsearch\ndockerhub elasticsearch\ndockerhub kibana\nlogstash\u3067apache\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092elasticsearch\u306b\u9001\u4fe1\u3057\u3001kibana\u3067\u30b0\u30e9\u30d5\u8868\u793a - Qiita\n\n\ndocker-compose.yml\n\ndocker-compose.yml\nes:\n    image: elasticsearch:5\n    ports:\n      - \"9200:9200\"\n      - \"9300:9300\"\n    volumes:\n      - ./es_config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml\n      - ./es_data/:/usr/share/elasticsearch/data/\n    environment:\n      - ES_JAVA_OPTS=-Xms512M -Xmx512M\n\nki:\n    image: kibana:5\n    ports:\n      - \"5601:5601\"\n    links:\n        - es\n    environment:\n      - ELASTICSEARCH_URL=http://es:9200\n\n\n\n\n5.0/config/elasticsearch.yml\u3092./es_config/elasticsearch.yml\u306b\u8a18\u8ff0\n\n\n./es_config/elasticsearch.yml\nnetwork.host: 0.0.0.0\n\n# this value is required because we set \"network.host\"\n# be sure to modify it appropriately for a production cluster deployment\ndiscovery.zen.minimum_master_nodes: 1\n\n\n\n\u8d77\u52d5\n# sysctl -w vm.max_map_count=262144\ndocker-compose up\n\n\n\nlogstash (deb)\n\n\nLogstash\u304b\u3089Logstash 5\u306edeb\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\n\n\nlogstash.conf\ninput { file { path=> \"/var/log/apache2/access.log\" } }\n\nfilter {\n  grok {\n    match => { \"message\" => \"%{COMBINEDAPACHELOG}\" }\n  }\n  date {\n    match => [ \"timestamp\" , \"dd/MMM/yyyy:HH:mm:ss Z\" ]\n    locale => \"en\"\n  }\n  mutate {\n    replace => { \"type\" => \"apache_access\" }\n  }\n}\n\noutput {\n  elasticsearch { hosts => [\"192.168.10.22:9200\"] }\n}\n\n\n\n\u8d77\u52d5\nsudo /usr/share/logstash/bin/logstash --path.settings=/etc/logstash/ -f logstash.conf\n\n\n\nlogstash2\u7cfb\u306e\u5834\u5408\u3001/opt/logstash/bin/logstash -f logstash.conf\n\n\n\n\n\nhttp://localhost:5601 \u306b\u30a2\u30af\u30bb\u30b9\u3057\u30ed\u30b0\u3092\u53d7\u3051\u53d6\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\n\n\nlogstash (docker)\n\nlogstash.conf\ninput { file { path=> \"/var/log/apache2/access.log\" } }\n\nfilter {\n  grok {\n    match => { \"message\" => \"%{COMBINEDAPACHELOG}\" }\n  }\n  date {\n    match => [ \"timestamp\" , \"dd/MMM/yyyy:HH:mm:ss Z\" ]\n    locale => \"en\"\n  }\n  mutate {\n    replace => { \"type\" => \"apache_access\" }\n  }\n}\n\noutput {\n  elasticsearch { hosts => [\"192.168.10.22:9200\"] }\n  stdout { codec => rubydebug }\n}\n\n\n\nroot\u6a29\u9650\u3067logstash\u8d77\u52d5\n\ndocker run  \\\n -it --rm -v \"$PWD\":/config-dir \\\n -v /var/log/apache2/:/var/log/apache2/:ro \\\n logstash:5 \\\n gosu root logstash -f /config-dir/logstash.conf\n\n## \u53c2\u8003\n\n* [Figure out what's up with 5.0 \u00b7 Issue #98 \u00b7 docker-library/elasticsearch](https://github.com/docker-library/elasticsearch/issues/98)\n* [dockerhub elasticsearch](https://hub.docker.com/_/elasticsearch/)\n* [dockerhub kibana](https://hub.docker.com/_/kibana/)\n* [logstash\u3067apache\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092elasticsearch\u306b\u9001\u4fe1\u3057\u3001kibana\u3067\u30b0\u30e9\u30d5\u8868\u793a - Qiita](http://qiita.com/tukiyo3/items/b0b6b4a20d4ad4d44b80)\n\n## docker-compose.yml\n\n```yaml:docker-compose.yml\nes:\n    image: elasticsearch:5\n    ports:\n      - \"9200:9200\"\n      - \"9300:9300\"\n    volumes:\n      - ./es_config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml\n      - ./es_data/:/usr/share/elasticsearch/data/\n    environment:\n      - ES_JAVA_OPTS=-Xms512M -Xmx512M\n\nki:\n    image: kibana:5\n    ports:\n      - \"5601:5601\"\n    links:\n        - es\n    environment:\n      - ELASTICSEARCH_URL=http://es:9200\n```\n\n* [5.0/config/elasticsearch.yml](https://github.com/docker-library/elasticsearch/blob/master/5.0/config/elasticsearch.yml)\u3092`./es_config/elasticsearch.yml`\u306b\u8a18\u8ff0\n\n```yaml:./es_config/elasticsearch.yml\nnetwork.host: 0.0.0.0\n\n# this value is required because we set \"network.host\"\n# be sure to modify it appropriately for a production cluster deployment\ndiscovery.zen.minimum_master_nodes: 1\n```\n\n```bash:\u8d77\u52d5\n# sysctl -w vm.max_map_count=262144\ndocker-compose up\n```\n\n## logstash (deb)\n\n* [Logstash](https://www.elastic.co/downloads/logstash)\u304b\u3089`Logstash 5`\u306edeb\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\n\n```rb:logstash.conf \ninput { file { path=> \"/var/log/apache2/access.log\" } }\n\nfilter {\n  grok {\n    match => { \"message\" => \"%{COMBINEDAPACHELOG}\" }\n  }\n  date {\n    match => [ \"timestamp\" , \"dd/MMM/yyyy:HH:mm:ss Z\" ]\n    locale => \"en\"\n  }\n  mutate {\n    replace => { \"type\" => \"apache_access\" }\n  }\n}\n\noutput {\n  elasticsearch { hosts => [\"192.168.10.22:9200\"] }\n}\n```\n\n```bash:\u8d77\u52d5\nsudo /usr/share/logstash/bin/logstash --path.settings=/etc/logstash/ -f logstash.conf\n```\n\n* logstash2\u7cfb\u306e\u5834\u5408\u3001`/opt/logstash/bin/logstash -f logstash.conf`\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2016-08-05_17-06-39.png](https://qiita-image-store.s3.amazonaws.com/0/25728/2e9dd6b1-01d0-b142-2f36-2d99890519db.png)\n\n* http://localhost:5601 \u306b\u30a2\u30af\u30bb\u30b9\u3057\u30ed\u30b0\u3092\u53d7\u3051\u53d6\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\n\n\n## logstash (docker)\n\n```rb:logstash.conf \ninput { file { path=> \"/var/log/apache2/access.log\" } }\n\nfilter {\n  grok {\n    match => { \"message\" => \"%{COMBINEDAPACHELOG}\" }\n  }\n  date {\n    match => [ \"timestamp\" , \"dd/MMM/yyyy:HH:mm:ss Z\" ]\n    locale => \"en\"\n  }\n  mutate {\n    replace => { \"type\" => \"apache_access\" }\n  }\n}\n\noutput {\n  elasticsearch { hosts => [\"192.168.10.22:9200\"] }\n  stdout { codec => rubydebug }\n}\n```\n\n* [root\u6a29\u9650\u3067logstash\u8d77\u52d5](https://github.com/docker-library/logstash/issues/11)\n\n```bash:\ndocker run  \\\n -it --rm -v \"$PWD\":/config-dir \\\n -v /var/log/apache2/:/var/log/apache2/:ro \\\n logstash:5 \\\n gosu root logstash -f /config-dir/logstash.conf\n```\n", "tags": ["docker-compose", "Elasticsearch5", "kibana5", "Logstash5"]}