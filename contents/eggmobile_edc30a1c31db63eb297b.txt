{"context": " More than 1 year has passed since last update.\u30ab\u30e1\u30e9\u30ed\u30fc\u30eb\u304b\u3089\u53d6\u5f97\u3057\u305f\u753b\u50cf\u306e\u30d1\u30b9\u3092\u53d6\u5f97\u3059\u308b\u65b9\u6cd5\u3002\n\u305d\u306e\u30d1\u30b9\u3092CoreData\u306bNSString\u3067\u4fdd\u5b58\u3057\u305f\u308a\u3057\u307e\u3059\u3002\nUIImagePickerController\u3067\u30ab\u30e1\u30e9\u30ed\u30fc\u30eb\u304b\u3089\u753b\u50cf\u3092\u9078\u629e\u3057\u305f\u3042\u3068\u547c\u3070\u308c\u308b\u30e1\u30bd\u30c3\u30c9\u306b\u3001\u30ac\u30c1\u30e3\u30ac\u30c1\u30e3\u3068\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\nAssetsLibraty\u3092\u4f7f\u7528\u3059\u308b\u306e\u3067\u3001\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u8ffd\u52a0\u3057\u3066\u30d8\u30c3\u30c0\u30fc\u30d5\u30a1\u30a4\u30eb\u306b\n#import <AssetsLibrary/AssetsLibrary.h>\n\n\n\u3068\u66f8\u3044\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\u5b9f\u88c5\u90e8\u5206\u306f\u4ee5\u4e0b\u3067\u3059\u3002\n\u4eca\u56de\u306fheaderImageButton\u3068\u3044\u3046UIButton\u306e\u80cc\u666f\u753b\u50cf\u3092\u5909\u3048\u3066\u3044\u307e\u3059\u3002\n\u305d\u3057\u3066\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u3042\u308bmanagedObject\u306b\u753b\u50cf\u306e\u30d1\u30b9\u3092\u3064\u3063\u3053\u3093\u3067\u3044\u307e\u3059\u3002\n- (void)imagePickerController:(UIImagePickerController *)picker didFinishPickingMediaWithInfo:(NSDictionary *)info{\n    // Path\u3092\u53d6\u5f97\n    NSURL *referenceURL = [info objectForKey:UIImagePickerControllerReferenceURL];\n    // AssetsLibraty\u3092\u4f5c\u6210\n    ALAssetsLibrary *library = [[ALAssetsLibrary alloc] init];\n    [library assetForURL:referenceURL resultBlock:^(ALAsset *asset) {\n        // \u307e\u305aasset\u304b\u3089\u30d0\u30c3\u30d5\u30a1\u3092\u3064\u304f\u308b\n        ALAssetRepresentation *rep = [asset defaultRepresentation];\n        Byte *buffer = (Byte*)malloc(rep.size);\n        NSUInteger buffered = [rep getBytes:buffer fromOffset:0.0 length:rep.size error:nil];\n        NSData *data = [NSData dataWithBytesNoCopy:buffer length:buffered freeWhenDone:YES]; //\u3053\u308c\u304c\u5fc5\u8981\u306a\u30c7\u30fc\u30bf\n        // \u30c7\u30fc\u30bf\u304b\u3089UIImage\u3092\u4f5c\u6210\n        UIImage *imageFromFile = [UIImage imageWithData:data];\n        // \u753b\u50cf\u3092\u30bb\u30c3\u30c8\n        [self.headerImageButton setImage:imageFromFile\n                                forState:UIControlStateNormal];\n\n        // imagePath\u3092managedObject\u306b\u5165\u308c\u308b\n        [self.managedObject.imagePath setValue:referenceURL forKey:@\"imagePath\"];\n        NSLog(@\"imagePath : %@\", referenceURL);\n\n        /*\n        // \u30b5\u30e0\u30cd\u30a4\u30eb\u3092\u4f7f\u3046\u5834\u5408\u306fasset\u3060\u3051\u3067\u826f\u3044\u306e\u3067\u3082\u3063\u3068\u697d\n        // UIImage\u306b\u5909\u63db\n        UIImage* thumbnail = [[UIImage alloc] initWithCGImage:[asset thumbnail]];\n        // \u753b\u50cf\u5909\u66f4\n        [self.headerImageButton setImage:thumbnail\n                                forState:UIControlStateNormal];\n         */\n    } failureBlock:^(NSError *error) {\n        // error handling\n    }];\n\n    // \u30e2\u30fc\u30c0\u30eb\u30d3\u30e5\u30fc\u3092\u9589\u3058\u308b\n    [self dismissViewControllerAnimated:YES completion:nil];\n}\n\n\n\u3061\u306a\u307f\u306b\u3001\u30b5\u30e0\u30cd\u30a4\u30eb\u3092\u4f7f\u3046\u5834\u5408\u306fALAssetRepresentation\u3068\u304b\u66f8\u3044\u305f\u308a\u3057\u306a\u304f\u3066\u3044\u3044\u306e\u3067\u697d\u3067\u3059\u3002\n[asset thumbnail]\u3067\u753b\u50cf\u304c\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\u30ab\u30e1\u30e9\u30ed\u30fc\u30eb\u304b\u3089\u53d6\u5f97\u3057\u305f\u753b\u50cf\u306e\u30d1\u30b9\u3092\u53d6\u5f97\u3059\u308b\u65b9\u6cd5\u3002\n\u305d\u306e\u30d1\u30b9\u3092CoreData\u306bNSString\u3067\u4fdd\u5b58\u3057\u305f\u308a\u3057\u307e\u3059\u3002\nUIImagePickerController\u3067\u30ab\u30e1\u30e9\u30ed\u30fc\u30eb\u304b\u3089\u753b\u50cf\u3092\u9078\u629e\u3057\u305f\u3042\u3068\u547c\u3070\u308c\u308b\u30e1\u30bd\u30c3\u30c9\u306b\u3001\u30ac\u30c1\u30e3\u30ac\u30c1\u30e3\u3068\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\n\nAssetsLibraty\u3092\u4f7f\u7528\u3059\u308b\u306e\u3067\u3001\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u8ffd\u52a0\u3057\u3066\u30d8\u30c3\u30c0\u30fc\u30d5\u30a1\u30a4\u30eb\u306b\n\n```objc\n#import <AssetsLibrary/AssetsLibrary.h>\n\n```\n\u3068\u66f8\u3044\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n\n\n\u5b9f\u88c5\u90e8\u5206\u306f\u4ee5\u4e0b\u3067\u3059\u3002\n\u4eca\u56de\u306fheaderImageButton\u3068\u3044\u3046UIButton\u306e\u80cc\u666f\u753b\u50cf\u3092\u5909\u3048\u3066\u3044\u307e\u3059\u3002\n\u305d\u3057\u3066\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u3042\u308bmanagedObject\u306b\u753b\u50cf\u306e\u30d1\u30b9\u3092\u3064\u3063\u3053\u3093\u3067\u3044\u307e\u3059\u3002\n\n```objc\n- (void)imagePickerController:(UIImagePickerController *)picker didFinishPickingMediaWithInfo:(NSDictionary *)info{\n\t// Path\u3092\u53d6\u5f97\n\tNSURL *referenceURL = [info objectForKey:UIImagePickerControllerReferenceURL];\n\t// AssetsLibraty\u3092\u4f5c\u6210\n\tALAssetsLibrary *library = [[ALAssetsLibrary alloc] init];\n\t[library assetForURL:referenceURL resultBlock:^(ALAsset *asset) {\n\t\t// \u307e\u305aasset\u304b\u3089\u30d0\u30c3\u30d5\u30a1\u3092\u3064\u304f\u308b\n\t\tALAssetRepresentation *rep = [asset defaultRepresentation];\n\t\tByte *buffer = (Byte*)malloc(rep.size);\n\t\tNSUInteger buffered = [rep getBytes:buffer fromOffset:0.0 length:rep.size error:nil];\n\t\tNSData *data = [NSData dataWithBytesNoCopy:buffer length:buffered freeWhenDone:YES]; //\u3053\u308c\u304c\u5fc5\u8981\u306a\u30c7\u30fc\u30bf\n\t\t// \u30c7\u30fc\u30bf\u304b\u3089UIImage\u3092\u4f5c\u6210\n\t\tUIImage *imageFromFile = [UIImage imageWithData:data];\n\t\t// \u753b\u50cf\u3092\u30bb\u30c3\u30c8\n\t\t[self.headerImageButton setImage:imageFromFile\n\t\t\t\t\t\t\t\tforState:UIControlStateNormal];\n\t\t\n\t\t// imagePath\u3092managedObject\u306b\u5165\u308c\u308b\n\t\t[self.managedObject.imagePath setValue:referenceURL forKey:@\"imagePath\"];\n\t\tNSLog(@\"imagePath : %@\", referenceURL);\n\t\t\n\t\t/*\n\t\t// \u30b5\u30e0\u30cd\u30a4\u30eb\u3092\u4f7f\u3046\u5834\u5408\u306fasset\u3060\u3051\u3067\u826f\u3044\u306e\u3067\u3082\u3063\u3068\u697d\n\t\t// UIImage\u306b\u5909\u63db\n        UIImage* thumbnail = [[UIImage alloc] initWithCGImage:[asset thumbnail]];\n        // \u753b\u50cf\u5909\u66f4\n\t\t[self.headerImageButton setImage:thumbnail\n\t\t\t\t\t\t\t\tforState:UIControlStateNormal];\n\t\t */\n\t} failureBlock:^(NSError *error) {\n\t\t// error handling\n\t}];\n\t\n\t// \u30e2\u30fc\u30c0\u30eb\u30d3\u30e5\u30fc\u3092\u9589\u3058\u308b\n\t[self dismissViewControllerAnimated:YES completion:nil];\n}\n\n```\n\n\u3061\u306a\u307f\u306b\u3001\u30b5\u30e0\u30cd\u30a4\u30eb\u3092\u4f7f\u3046\u5834\u5408\u306fALAssetRepresentation\u3068\u304b\u66f8\u3044\u305f\u308a\u3057\u306a\u304f\u3066\u3044\u3044\u306e\u3067\u697d\u3067\u3059\u3002\n[asset thumbnail]\u3067\u753b\u50cf\u304c\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002", "tags": ["Objective-C", "iOS", "CoreData"]}