{"context": "\n\nOpenVZ\u306eVPS\u3067\u52d5\u304b\u3059NFS\u30b5\u30fc\u30d0 | \u304a\u3082\u3080\u304f\u304c\u307e\u307e\u306b\u3092\u53c2\u8003\u3002\n\nRPM resource unfs3(x86-64)\n\nunfs3-0.9.22-2.el6.rf.x86_64.rpm\nunfs3-0.9.22-2.el5.rf.x86_64.rpm\nunfs3-0.9.22-1.el5.rf.i386.rpm\n\n\n\n\n/etc/exports\n/var/log 192.168.11.0/24(ro,async,no_root_squash)\n/tmp 192.168.11.0/24(ro,async,no_root_squash)\n\n\n\nsyntax\u30c1\u30a7\u30c3\u30af\n$ /usr/sbin/unfsd -T\n\n\n\n\u4f55\u3082\u51fa\u529b\u3055\u308c\u306a\u3051\u308c\u3070OK\n\n\nunfsd\u8d77\u52d5\n$ sudo service portmap start\n$ sudo /usr/sbin/unfsd\n\n\n\n/etc/rc.local\u306b\u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u767b\u9332\n/usr/sbin/unfsd -T && runuser -l root -c \"/usr/sbin/unfsd\"\n\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u4f5c\u3063\u305f\n\npuppet\nclass unfs3::centos5() {\n  package { ['unfs3']:\n    ensure => installed,\n  }\n  service { 'portmap':\n    ensure => running,\n    enable => true,\n  }\n  file { '/etc/exports':\n    owner  => 'root',\n    group  => 'root',\n    mode   => 644,\n    notify  => Reload['unfs3'],\n    source => \"puppet:///etc/exports\";\n  }\n  file { '/etc/init.d/unfs3':\n    owner  => 'root',\n    group  => 'root',\n    mode   => 755,\n    source => \"puppet:///etc/init.d/unfs3\";\n  }\n  file { ['/etc/rc0.d/K86unfs3',\n          '/etc/rc1.d/K86unfs3',\n          '/etc/rc2.d/S14unfs3',\n          '/etc/rc3.d/S14unfs3',\n          '/etc/rc4.d/S14unfs3',\n          '/etc/rc5.d/S14unfs3',\n          '/etc/rc6.d/K86unfs3']:\n    ensure => link,\n    target => '/etc/init.d/unfs3',\n  }\n  reload { 'unfs3':\n    command => '/usr/sbin/unfs3 -T && /etc/init.d/unfs3 restart',\n  }\n}\n\n\n\n/etc/init.d/unfs3\n#!/bin/sh\n\nunfsd_configtest() {\n  if [ ! -r /etc/exports ]; then\n    exit\n  elif ! grep -v -e '^#' -e '^$' /etc/exports | grep -q '/' ; then\n    exit # no uncommented shares in /etc/exports\n  fi\n  if [ -x /usr/sbin/unfsd ]; then\n    /usr/sbin/unfsd -T\n  fi\n}\n\nunfsd_start() {\n  unfsd_configtest\n\n  echo -n \"Starting UNFS server daemon(s):\"\n\n  if [ -x /sbin/portmap ]; then\n    if ! ps axc | grep -q portmap ; then\n      echo -n \"  /sbin/portmap\"\n      /sbin/portmap\n    fi\n\n    if [ -x /usr/sbin/unfsd ]; then\n      echo \"  /usr/sbin/nfsd\"\n      /usr/sbin/unfsd\n    fi\n  else\n    echo \"WARNING:  Cannot start RPC portmapper daemon needed for UNFS.\"\n    echo \"          /sbin/portmap (a required daemon) is not executable\"\n    echo \"          or is not present on your system.\"\n    echo\n  fi\n}\n\nunfsd_stop() {\n  echo \"Stopping UNFS server daemon...\"\n  killall unfsd 2> /dev/null\n  sleep 1\n  killall -9 unfsd 2> /dev/null # make sure :)\n}\n\nunfsd_restart() {\n  unfsd_stop\n  sleep 1\n  unfsd_start\n}\n\ncase \"$1\" in\n'start')\n  unfsd_start\n  ;;\n'stop')\n  unfsd_stop\n  ;;\n'restart')\n  unfsd_restart\n  ;;\n'configtest')\n  unfsd_configtest\n  ;;\n*)\n  echo \"usage $0 start|stop|restart|configtest\"\nesac\n\n\n* [OpenVZ\u306eVPS\u3067\u52d5\u304b\u3059NFS\u30b5\u30fc\u30d0 | \u304a\u3082\u3080\u304f\u304c\u307e\u307e\u306b](http://blog.k-sakabe.com/?p=1510)\u3092\u53c2\u8003\u3002\n* [RPM resource unfs3(x86-64)](http://rpmfind.net/linux/rpm2html/search.php?query=unfs3(x86-64))\n    * unfs3-0.9.22-2.el6.rf.x86_64.rpm\n    * unfs3-0.9.22-2.el5.rf.x86_64.rpm\n    * unfs3-0.9.22-1.el5.rf.i386.rpm\n\n```bash:/etc/exports\n/var/log 192.168.11.0/24(ro,async,no_root_squash)\n/tmp 192.168.11.0/24(ro,async,no_root_squash)\n```\n\n```bash:syntax\u30c1\u30a7\u30c3\u30af\n$ /usr/sbin/unfsd -T\n```\n\n* \u4f55\u3082\u51fa\u529b\u3055\u308c\u306a\u3051\u308c\u3070OK\n\n```bash:unfsd\u8d77\u52d5\n$ sudo service portmap start\n$ sudo /usr/sbin/unfsd\n```\n\n```bash:/etc/rc.local\u306b\u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u767b\u9332\n/usr/sbin/unfsd -T && runuser -l root -c \"/usr/sbin/unfsd\"\n```\n\n\n# \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u4f5c\u3063\u305f\n\n```bash:puppet\nclass unfs3::centos5() {\n  package { ['unfs3']:\n    ensure => installed,\n  }\n  service { 'portmap':\n    ensure => running,\n    enable => true,\n  }\n  file { '/etc/exports':\n    owner  => 'root',\n    group  => 'root',\n    mode   => 644,\n    notify  => Reload['unfs3'],\n    source => \"puppet:///etc/exports\";\n  }\n  file { '/etc/init.d/unfs3':\n    owner  => 'root',\n    group  => 'root',\n    mode   => 755,\n    source => \"puppet:///etc/init.d/unfs3\";\n  }\n  file { ['/etc/rc0.d/K86unfs3',\n          '/etc/rc1.d/K86unfs3',\n          '/etc/rc2.d/S14unfs3',\n          '/etc/rc3.d/S14unfs3',\n          '/etc/rc4.d/S14unfs3',\n          '/etc/rc5.d/S14unfs3',\n          '/etc/rc6.d/K86unfs3']:\n    ensure => link,\n    target => '/etc/init.d/unfs3',\n  }\n  reload { 'unfs3':\n    command => '/usr/sbin/unfs3 -T && /etc/init.d/unfs3 restart',\n  }\n}\n```\n\n```bash:/etc/init.d/unfs3\n#!/bin/sh\n\nunfsd_configtest() {\n  if [ ! -r /etc/exports ]; then\n    exit\n  elif ! grep -v -e '^#' -e '^$' /etc/exports | grep -q '/' ; then\n    exit # no uncommented shares in /etc/exports\n  fi\n  if [ -x /usr/sbin/unfsd ]; then\n    /usr/sbin/unfsd -T\n  fi\n}\n\nunfsd_start() {\n  unfsd_configtest\n\n  echo -n \"Starting UNFS server daemon(s):\"\n\n  if [ -x /sbin/portmap ]; then\n    if ! ps axc | grep -q portmap ; then\n      echo -n \"  /sbin/portmap\"\n      /sbin/portmap\n    fi\n  \n    if [ -x /usr/sbin/unfsd ]; then\n      echo \"  /usr/sbin/nfsd\"\n      /usr/sbin/unfsd\n    fi\n  else\n    echo \"WARNING:  Cannot start RPC portmapper daemon needed for UNFS.\"\n    echo \"          /sbin/portmap (a required daemon) is not executable\"\n    echo \"          or is not present on your system.\"\n    echo\n  fi\n}\n\nunfsd_stop() {\n  echo \"Stopping UNFS server daemon...\"\n  killall unfsd 2> /dev/null\n  sleep 1\n  killall -9 unfsd 2> /dev/null # make sure :)\n}\n\nunfsd_restart() {\n  unfsd_stop\n  sleep 1\n  unfsd_start\n}\n\ncase \"$1\" in\n'start')\n  unfsd_start\n  ;;\n'stop')\n  unfsd_stop\n  ;;\n'restart')\n  unfsd_restart\n  ;;\n'configtest')\n  unfsd_configtest\n  ;;\n*)\n  echo \"usage $0 start|stop|restart|configtest\"\nesac\n```\n", "tags": ["OpenVZ", "nfs", "unfs3"]}