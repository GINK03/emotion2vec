{"context": " More than 1 year has passed since last update.\u672c\u8a18\u4e8b\u306fTIS Engineer Advent Calendar 2015\u300116\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\nAkka\u306eAkka Remoting\u3001Akka Persistant\u3001AtLeasetOnceDelively\u3042\u305f\u308a\u306b\u3064\u3044\u3066\u66f8\u304d\u307e\u3059\u3002\n\n\u306f\u3058\u3081\u306b\n\u65e9\u3044\u3082\u306e\u30672015\u5e74\u3082\u3042\u3068\u5c11\u3057\u3067\u904e\u304e\u53bb\u308d\u3046\u3068\u3057\u3066\u3044\u307e\u3059\u304c\u3001Web\u754c\u9688\u3067\u306f\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u3067\u76db\u308a\u4e0a\u304c\u3063\u305f\u5e74\u3067\u3057\u305f\u3002\u305d\u3057\u3066\u3001\u6765\u308b2016\u5e74\u65e9\u3005\u306b\u958b\u50ac\u3055\u308c\u308bScala Matsuri\u3082\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30cd\u30bf\u76ee\u767d\u62bc\u3057\u3067\u3059\u3002\n\u305d\u3053\u3067\u3001\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30b7\u30b9\u30c6\u30e0\u306f\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba\u306e\u3088\u3046\u306a\u30ac\u30c3\u30c1\u30ea\u3057\u305f\u30b7\u30b9\u30c6\u30e0\u3067\u3082\u4f7f\u3048\u308b\u306e\u304b\u3092\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u4fe1\u983c\u6027\u3084\u5230\u9054\u4fdd\u8a3c\u3068\u3044\u3046\u89b3\u70b9\u3067\u8003\u3048\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30b7\u30b9\u30c6\u30e0\u306fReactive Manifesto\u304c\u8ad6\u3058\u3066\u3044\u308b\u300cResponsive\uff08\u5373\u5fdc\u6027\uff09\u300d, \u300cResilient\uff08\u8010\u969c\u5bb3\u6027\uff09\u300d, \u300cElastic\uff08\u5f3e\u529b\u6027\uff09\u300d, \u300cMesssage Driven\uff08\u30e1\u30c3\u30bb\u30fc\u30b8\u99c6\u52d5\uff09\u300d\u306a\u30b7\u30b9\u30c6\u30e0\u3067\u3001\u4ee3\u8868\u7684\u306a\u306e\u304c\u3001Play Framework\u3084Akka\u306a\u3069Typesafe\u793e\u306e\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3067\u3059\u3002\u306a\u305c\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30b7\u30b9\u30c6\u30e0\u304c\u5fc5\u8981\u304b\u3068\u304b\u3001\u306a\u305c\u4e26\u884c\u6027\u304c\u4eca\u6ce8\u76ee\u3055\u308c\u308b\u306e\u304b\u306f\u3053\u3061\u3089\u3092\u898b\u3066\u9802\u304f\u3068\u3057\u3066\u3001\u4eca\u56de\u306fAkka\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u6027\u8cea\u306b\u7740\u76ee\u3057\u307e\u3059\u3002\n\nAkka\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\nAkka\u306fActor\u30d9\u30fc\u30b9\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u99c6\u52d5\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3001\u3044\u308f\u3086\u308bActor\u30e2\u30c7\u30eb\u304c\u30d9\u30fc\u30b9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002Actor\u540c\u58eb\u306e\u3084\u308a\u3068\u308a\u306f\u3059\u3079\u3066\u30e1\u30c3\u30bb\u30fc\u30b8\u3067\u884c\u3044\u3001Actor\u306f\u5225\u306eActor\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u3063\u305f\u3042\u3068\u306f\u3001\u305d\u306e\u5fdc\u7b54\u3092\u5f85\u3064\u3088\u3046\u306a\u540c\u671f\u7684\u306a\u51e6\u7406\u3092\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u975e\u540c\u671f\u306b\u81ea\u5206\u306e\u3084\u308a\u305f\u3044\u51e6\u7406\u3092\u9032\u3081\u3066\u884c\u304d\u307e\u3059\u3002\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u9001\u308a\u5148\u3068\u306a\u3063\u305fActor\u306b\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u305f\u3089\u3001\u3069\u3093\u306a\u632f\u308b\u821e\u3044\u3092\u884c\u3046\u304b\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u3066\u3001\u53d7\u4fe1\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u306b\u5fdc\u3058\u305f\u51e6\u7406\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u3053\u306e\u51e6\u7406\u306f\u9001\u308a\u4e3b\u3068\u306a\u3063\u305fActor\u3068\u306f\u3001\u5225\u30b9\u30ec\u30c3\u30c9\u3001\u6642\u306b\u306f\u30b5\u30fc\u30d0\u3055\u3048\u3082\u5225\u3067\u3001\u4e26\u884c\u306b\u305d\u3057\u3066\u5206\u6563\u3057\u3066\u51e6\u7406\u3055\u308c\u307e\u3059\u3002\u3056\u3063\u304f\u308a\u3067\u3059\u304c\u3001\u3053\u308c\u304c\u3053\u308c\u307e\u3067\u82e6\u52b4\u3057\u3066\u5b9f\u88c5\u3057\u3066\u304d\u305f\u4e26\u884c\u51e6\u7406\u3092\u3001\u540c\u671f\u51e6\u7406\u3092\u5b9f\u88c5\u3059\u308b\u611f\u899a\u3067\u5bb9\u6613\u306b\u5b9f\u88c5\u3059\u308b\u3067\u304d\u308bActor\u30e2\u30c7\u30eb\u3067\u3059\u3002\n\u3055\u3066\u3001\u3053\u3053\u3067\u6c17\u306b\u306a\u308b\u306e\u306f\u3001\u5225\u306eActor\u306b\u9001\u3063\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u884c\u304f\u672b\u3067\u3059\u3002\u9001\u308a\u4e3b\u306f\u305d\u306e\u7d50\u679c\u3092\u6c17\u306b\u305b\u305a\u81ea\u5206\u306e\u51e6\u7406\u3092\u975e\u540c\u671f\u3067\u9032\u3081\u3066\u884c\u304f\u3068\u8a00\u3044\u307e\u3057\u305f\u304c\u3001\u9001\u4fe1\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u304d\u3061\u3093\u3068\u5c4a\u3044\u3066\u3044\u308b\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\u540c\u3058JVM\u4e0a\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u547c\u3073\u51fa\u3057\u3066\u3044\u308b\u306e\u3067\u3042\u308c\u3070\u3001\u305d\u308c\u307b\u3069\u6c17\u306b\u3059\u3079\u304d\u4e8b\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u76f8\u624b\u304c\u30ea\u30e2\u30fc\u30c8Actor\u3001\u3064\u307e\u308a\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4ecb\u3057\u3066\u5225\u30b5\u30fc\u30d0\u4e0a\u306b\u914d\u5099\u3055\u308c\u3066\u3044\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u5834\u5408\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u969c\u5bb3\u7b49\u306e\u554f\u984c\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u5148Actor\u306b\u5230\u9054\u3057\u306a\u3044\u4e8b\u3082\u5341\u5206\u306b\u8003\u3048\u3089\u308c\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u3001\u4ee5\u524d\u7d39\u4ecb\u3057\u305f\u30bd\u30fc\u30e9\u30fc\u30d5\u30a1\u30fc\u30e0\u30e2\u30cb\u30bf\u30fc\u306e\u3088\u3046\u306b\u6bce\u79d2\u30d1\u30cd\u30eb\u304b\u3089\u9001\u3089\u308c\u3066\u3044\u308b\u96fb\u529b\u3092\u76e3\u8996\u30fb\u30d3\u30b8\u30e5\u30a2\u30e9\u30a4\u30ba\u3057\u6545\u969c\u3092\u691c\u77e5\u3059\u308b\u3088\u3046\u306a\u30b7\u30b9\u30c6\u30e0\u3067\u3042\u308c\u3070\u3001\u4e00\u6642\u7684\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u53d7\u4fe1\u3067\u304d\u306a\u304b\u3063\u305f\u3068\u3057\u3066\u3082\u3001\u305d\u306e\u5f8c\u3001\u6700\u65b0\u306e\u96fb\u529b\u3092\u53d7\u4fe1\u3067\u304d\u308c\u3070\u4f55\u306e\u554f\u984c\u3082\u3042\u308a\u307e\u305b\u3093\u3002\u300c\u4eca\u300d\u767a\u96fb\u3057\u3066\u3044\u308b\u96fb\u529b\u3001\u300c\u4eca\u300d\u6545\u969c\u3057\u3066\u3044\u306a\u3044\u304b\u304c\u91cd\u8981\u3060\u304b\u3089\u3067\u3059\u3002\n\u3057\u304b\u3057\u3001\u305d\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u30dc\u30fc\u30ca\u30b9\u3092\u4f1a\u793e\u304b\u3089\u81ea\u5206\u306e\u53e3\u5ea7\u306b\u632f\u308a\u8fbc\u3080\u3068\u3044\u3046\u30e1\u30c3\u30bb\u30fc\u30b8\u3060\u3063\u305f\u5834\u5408\u306f\u3069\u3046\u3067\u3057\u3087\u3046\u304b\uff1f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u554f\u984c\u3067\u632f\u308a\u8fbc\u307e\u308c\u305a\u3001\u6b21\u56de\u306e\u8cde\u4e0e\u307e\u3067\u6211\u6162\u3068\u3044\u3046\u8a71\u306b\u306f\u306a\u3089\u306a\u3044\u3067\u3057\u3087\u3046\u3002\u3053\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u5fc5\u305a\u9001\u4fe1\u5148\u306eActor\u306b\u5230\u9054\u3057\u51e6\u7406\u3055\u308c\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba\u306e\u304c\u3063\u3061\u308a\u30b7\u30b9\u30c6\u30e0\u306b\u3068\u3063\u3066\u306f\u5f53\u7136\u306e\u8a71\u3067\u3059\u3002\n\u524d\u7f6e\u304d\u306f\u3053\u3053\u307e\u3067\u3068\u3057\u3066\u3001Typesafe Reactive Platform\u3092\u652f\u3048\u308bAkka\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u5fc5\u305a\u5c4a\u304f\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u4fe1\u983c\u6027\nMessage Delivery Reliability \uff08\u65e5\u672c\u8a9e\u8a33\uff09\u306b\u3088\u308b\u3068\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u4fe1\u983c\u6027\u306f\uff13\u7a2e\u985e\u306b\u5206\u985e\u3055\u308c\u307e\u3059\u3002\n\n\n\nNo\n\u7a2e\u985e\n\u5185\u5bb9\n\n\n\n\n1\nat-most-once\n\u6700\u5927\uff11\u56de\u3002\uff11\u56de\u3060\u3051\u9001\u4fe1\u3059\u308b\u3051\u3069\u5c4a\u304f\u304b\u3069\u3046\u304b\u306f\u5206\u304b\u3089\u306a\u3044\u3002\n\n\n2\nat-least-once\n\u5c11\u306a\u304f\u3068\u3082\uff11\u56de\u3002\u5fc5\u305a\uff11\u56de\u306f\u5c4a\u304f\u3051\u3069\u3001\uff12\u56de\u3068\u304b\uff13\u56de\u3068\u304b\u91cd\u8907\u3057\u3066\u9001\u3063\u3066\u3057\u307e\u3046\u304b\u3082\u77e5\u308c\u306a\u3044\u3002\n\n\n3\nexactly-once\n\u6b63\u78ba\u306b\uff11\u56de\u3002\u91cd\u8907\u3082\u306a\u304f\u5fc5\u305a\uff11\u56de\u3060\u3051\u5c4a\u304f\u3002\n\n\n\n\uff13\u756a\u76ee\u304c\u6700\u3082\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba\u306a\u304b\u3093\u3058\u306e\u3084\u3064\u3067\u3059\u306d\u3002\u4e0b\u306b\u884c\u304f\u307b\u3069\u5805\u3044\u51e6\u7406\u306b\u306a\u308a\u3001\u305d\u306e\u5206\u30b3\u30b9\u30c8\u304c\u304b\u304b\u308a\u305d\u3046\u3068\u3044\u3046\u3053\u3068\u306f\u60f3\u50cf\u304c\u3064\u304d\u307e\u3059\u304c\u3001\u305d\u308c\u305e\u308cAkka\u3067\u306f\u3069\u306e\u3088\u3046\u306b\u5b9f\u73fe\u3059\u308b\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\u7c21\u5358\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u3084\u308a\u53d6\u308a\u3092\u4f8b\u306b\u8a66\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nat-most-once\n\u5c0f\u5b66\u6821\u306e\u5148\u751f\uff08Teacher Actor\uff09\u304c\u4e5d\u4e5d\u306e\u554f\u984c\u3092\u30ac\u30f3\u30ac\u30f3\u51fa\u3057\u3066\u3001\u751f\u5f92\uff08Student Actor\uff09\u304c\u9806\u306b\u89e3\u3044\u3066\u3044\u304f\u30b5\u30f3\u30d7\u30eb\u3092\u52d5\u304b\u3057\u3066\u307f\u307e\u3059\u3002\uff08\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\uff09\n\n\u307e\u305a\u306f\u3001\u666e\u901a\u306bAkka Remoting\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u3063\u3066\u307f\u307e\u3059\u3002\n\n\u5b9f\u88c5\n\n\u30e9\u30a4\u30d6\u30e9\u30ea\n\n\nbuild.sbt\n\"com.typesafe.akka\" %% \"akka-actor\" % \"2.4-SNAPSHOT\",\n\"com.typesafe.akka\" %% \"akka-remote\" % \"2.4-SNAPSHOT\"\n\n\nakka-actor\u3068akka-remote\u3092\u4f7f\u3044\u307e\u3059\u3002\n\nTeacher Actor\u306e\u5b9f\u88c5\n\n\nTeacherActor\n  var exerciseId = 0\n  val scheduler = context.system.scheduler.schedule(0 milliseconds, 3 seconds, self, CreateExercise)\n\n  def receive: Receive = {\n    case CreateExercise =>\n      exerciseId += 1\n      self ! Exercise(exerciseId, Multiply(Random.nextInt(9) + 1, Random.nextInt(9) + 1))\n\n    case Exercise(exerciseId, multiply) if (exerciseId > 9) =>\n      scheduler.cancel()\n\n    case Exercise(exerciseId, multiply) =>\n      log.info(s\" $exerciseId : ${multiply} = ?\")\n      student !  StudentActor.Msg(exerciseId, multiply)\n  }\n\n\nTeacherActor\u306f\uff13\u79d2\u6bce\u306b\u8a08\u7b97\u554f\u984c\u3092\u4f5c\u6210\u3057\u3001\u751f\u6210\u3057\u305f\u554f\u984c\u3092StudentActor\u306b\u9001\u308a\u307e\u3059\u3002\n\nStudent Actor\u306e\u5b9f\u88c5\n\n\nStudentActor\n  def receive: Receive = {\n    case Msg(deliveryId, Multiply(n1, n2)) =>\n       log.info(s\" $deliveryId :  calculating ... ${Multiply(n1, n2)} = ${n1 * n2}\")\n  }\n\n\nSutudentActor\u306f\u8a08\u7b97\u554f\u984c\u3092\u53d7\u4fe1\u3059\u308b\u3068\u554f\u984c\u3092\u89e3\u304d\u307e\u3059\u3002receive\u30e1\u30bd\u30c3\u30c9\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u306e\u304c\u53d7\u4fe1\u3055\u308c\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u306b\u5bfe\u5fdc\u3059\u308b\u632f\u308b\u821e\u3044\u3067\u3059\u3002\n\n\u5b9f\u884c\u7d50\u679c\n\nlog\nakka-message-delivery-reliability $sbt \"run-main school.atmostonce.MathApp\"\n[TeacherActor] -  1 : 8 * 1 = ?\n[StudentActor] -  1 :  calculating ... 8 * 1 = 8\n[TeacherActor] -  2 : 1 * 3 = ?\n[StudentActor] -  2 :  calculating ... 1 * 3 = 3\n[TeacherActor] -  3 : 7 * 2 = ?\n[StudentActor] -  3 :  calculating ... 7 * 2 = 14\n[TeacherActor] -  4 : 6 * 2 = ?\n[StudentActor] -  4 :  calculating ... 6 * 2 = 12\n[TeacherActor] -  5 : 1 * 8 = ?\n[StudentActor] -  5 :  calculating ... 1 * 8 = 8\n\n\n1\u554f\u76ee\u300c1 : 8 * 1 = ?\u300d\u3068\u3044\u3046\u554f\u984c\u304cTeacherActor\u304b\u3089\u9001\u3089\u308c\u3001StudentActor\u306b\u3088\u3063\u3066\u300c1 :  calculating ... 8 * 1 = 8\u300d\u306e\u3088\u3046\u306b\u554f\u984c\u304c\u8aac\u304b\u308c\u307e\u3057\u305f\u3002\u3053\u306e\u3088\u3046\u306b\u3001TeacherActor\u304b\u3089StudentActor\u30785\u554f\u306e\u8a08\u7b97\u554f\u984c\u304c\u6b63\u3057\u304f\u9001\u3089\u308c\u3066\u3044\u307e\u3059\u30021\u3064\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u30ed\u30b0\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u30b7\u30ea\u30a2\u30eb\u306b\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u306b\u898b\u3048\u307e\u3059\u304c\u3001TeacherActor\u3068StudentActor\u306f\u4e26\u884c\u306b\u51e6\u7406\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u4f55\u4e8b\u3082\u306a\u3051\u308c\u3070\u3001\u3053\u306e\u3088\u3046\u306b\u3059\u3079\u3066\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304cTeacherActor\u304b\u3089StudentActor\u306b\u9001\u4fe1\u3055\u308c\u8a08\u7b97\u304c\u884c\u308f\u308c\u307e\u3059\u304c\u3001TeacherActor\u3068StudentActor\u306f\u5225\u306e\u30b5\u30fc\u30d0\u306b\u3044\u307e\u3059\u3002\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7b49\u306e\u554f\u984c\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u304b\u306a\u304b\u3063\u305f\u5834\u5408\u306f\u3069\u3046\u306a\u308b\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\n\nAkka Persistence\nStudentActor\u3078\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u5230\u9054\u78ba\u8a8d\u306e\u524d\u306b\u3001\u53d7\u4fe1\u7d50\u679c\u3092\u5206\u304b\u308a\u3084\u3059\u304f\u3059\u308b\u305f\u3081\u3001\u51e6\u7406\u3057\u305f\u60c5\u5831\u3092Akka Persistant\u3092\u4f7f\u3063\u3066\u6c38\u7d9a\u5316\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u5b9f\u88c5\n\n\u30e9\u30a4\u30d6\u30e9\u30ea\n\n\nbuild.sbt\n\"com.typesafe.akka\" %% \"akka-persistence\" % \"2.4.0\",\n\"org.iq80.leveldb\"            % \"leveldb\"          % \"0.7\",\n\"org.fusesource.leveldbjni\"   % \"leveldbjni-all\"   % \"1.8\",\n\n\n\uff13\u3064\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nStudentActor\u306e\u8a2d\u5b9a\n\n\nstudent.conf\nakka {\n  persistence {\n    snapshot-store {\n      plugin = \"akka.persistence.snapshot-store.local\"\n      local.dir = \"target/persistence/student\"\n    }\n    journal {\n      plugin = \"akka.persistence.journal.leveldb\"\n      leveldb.native = false\n      leveldb.dir = \"target/persistence/journal/student\"\n    }\n  }\n}\n\n\nStudentActor\u306e\u6c38\u7d9a\u5316\u3059\u308b\u60c5\u5831\u306f\u300ctarget/persistence/student\u300d\u306b\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002TeacherActor\u306f\u540c\u69d8\u306b\u300ctarget/persistence/teacher\u300d\u306b\u6c38\u7d9a\u5316\u3057\u307e\u3059\u3002\n\nStudentActor\u306e\u5b9f\u88c5\n\n\nStudentActor\nclass StudentActor extends ActorLogging with PersistentActor {\n\n  def persistenceId: String = \"student-id-1\"\n  var state = StudentState()\n\n  def receiveCommand: Receive = {\n    case Msg(deliveryId, Multiply(n1, n2)) =>\n      log.info(s\" $deliveryId :  calculating ... ${Multiply(n1, n2)} = ${n1 * n2}\")\n      persist(Msg(deliveryId, Multiply(n1, n2)))(updateState)\n\n    case \"print\" => log.info(s\"  state = $state\")\n  }\n\n  val receiveRecover: Receive = {\n    case msg: Msg => updateState(msg)\n  }\n\n  def updateState(msg: Msg): Unit = {\n    state = state.updated(msg)\n  }\n}\n\nfinal case class StudentState(received: List[Long] = Nil) {\n  def updated(s: Msg): StudentState = copy(received :+ s.deliveryId)\n  def contains(s: Msg) = received.contains(s.deliveryId)\n}\n\n\nActor\u30c8\u30ec\u30a4\u30c8\u306e\u4ee3\u308f\u308a\u306bPersistentActor\u30c8\u30ec\u30a4\u30c8\u3092\u30df\u30c3\u30af\u30b9\u30a4\u30f3\u3057\u3001persistenceId\u3001receiveCommand\u3001receiveRecover\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002StudentActor\u3067\u306f\u53d7\u4fe1\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u300cMsg(deliveryId, Multiply(n1, n2))\u300d\u3092\u305d\u306e\u307e\u307e\u6c38\u7d9a\u5316\u3057\u307e\u3059\u3002\u4eca\u56de\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u4fdd\u5b58\u306f\u884c\u3044\u307e\u305b\u3093\u3002TeacherActor\u304b\u3089\u3059\u3079\u3066\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\u3068\u6700\u5f8c\u306b\u6c38\u7d9a\u5316\u3057\u305f\u60c5\u5831\u3092\u51fa\u529b\u3057\u307e\u3059\u3002\n\n\u5b9f\u884c\u7d50\u679c\uff1a\u6b63\u5e38\u5b9f\u884c\u6642\n\nlog\nakka-message-delivery-reliability $sbt \"run-main school.akkapersistence.MathApp\"\n[TeacherActor] -  1 : 5 * 5 = ?\n[StudentActor] -  1 :  calculating ... 5 * 5 = 25\n[TeacherActor] -  2 : 1 * 9 = ?\n[StudentActor] -  2 :  calculating ... 1 * 9 = 9\n[TeacherActor] -  3 : 5 * 3 = ?\n[StudentActor] -  3 :  calculating ... 5 * 3 = 15\n[TeacherActor] -  4 : 2 * 6 = ?\n[StudentActor] -  4 :  calculating ... 2 * 6 = 12\n[TeacherActor] -  5 : 4 * 3 = ?\n[StudentActor] -  5 :  calculating ... 4 * 3 = 12\n[StudentActor] -   result = List(1, 2, 3, 4, 5)\n\n\n\u6700\u5f8c\u306bStudentActor\u3067\u8a08\u7b97\u554f\u984c\u306b\u56de\u7b54\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8No\u304c\u51fa\u529b\u3055\u308c1,2,3,4,5\u3068\u51685\u554f\u3092\u89e3\u3044\u305f\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\u3067\u306f\u3001StudentActor\u3092\u9014\u4e2d\u3067\u30c0\u30a6\u30f3\u3055\u305b\u3066\u307f\u307e\u3059\u3002StudentActor\u3092Ctrl+C\u3067\u5f37\u5f15\u306b\u843d\u3057\u3066\u307f\u308b\u3068\u3001StudentActor\u304c\u30c0\u30a6\u30f3\u3057\u3066\u3044\u308b\u9593\u306b\u9001\u4fe1\u3055\u308c\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u306fDeadLetter\u3068\u306a\u308a\u3001\u518d\u5ea6\u8d77\u52d5\u3055\u305b\u308b\u3068\u3001\u4f55\u4e8b\u3082\u306a\u304b\u3063\u305f\u304b\u306e\u3088\u3046\u306b\u8d77\u52d5\u5f8c\u306b\u9001\u4fe1\u3055\u308c\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u51e6\u7406\u3057\u306f\u3058\u3081\u307e\u3059\u3002\n\n\u5b9f\u884c\u7d50\u679c\uff1a\u969c\u5bb3\u767a\u751f\u6642\n\nTeacherActor\n\n\nlog\nakka-message-delivery-reliability $sbt \"run-main school.akkapersistence.MathApp teacher\"\n[TeacherActor] -  1 : 5 * 8 = ?\n[ReliableDeliverySupervisor] - Association with remote system [akka.tcp://StudentSystem@127.0.0.1:2552] has failed, address is now gated for [5000] ms. Reason: [Disassociated]\n[TeacherActor] -  2 : 1 * 7 = ?\n[RemoteActorRefProvider$RemoteDeadLetterActorRef] - Message [school.akkapersistence.StudentActor$Msg] from Actor[akka://TeacherSystem/user/teacherActor#108113105] to Actor[akka://TeacherSystem/deadLetters] was not delivered. [1] dead letters encountered. This logging can be turned off or adjusted with configuration settings 'akka.log-dead-letters' and 'akka.log-dead-letters-during-shutdown'.\n[TeacherActor] -  3 : 1 * 6 = ?\n[RemoteActorRefProvider$RemoteDeadLetterActorRef] - Message [school.akkapersistence.StudentActor$Msg] from Actor[akka://TeacherSystem/user/teacherActor#108113105] to Actor[akka://TeacherSystem/deadLetters] was not delivered. [2] dead letters encountered. This logging can be turned off or adjusted with configuration settings 'akka.log-dead-letters' and 'akka.log-dead-letters-during-shutdown'.\n[TeacherActor] -  4 : 2 * 3 = ?\n[TeacherActor] -  5 : 7 * 3 = ?\n\n\n\nStudentActor\n\n\nlog\nakka-message-delivery-reliability $sbt \"run-main school.akkapersistence.MathApp student\"\n[StudentActor] -  1 :  calculating ... 5 * 8 = 40\n^Cakka-message-delivery-reliability $sbt \"run-main school.akkapersistence.MathApp student\"\n[StudentActor] -  4 :  calculating ... 2 * 3 = 6\n[StudentActor] -  5 :  calculating ... 7 * 3 = 21\n[StudentActor] -   result = List(1, 4, 5)\n\n\n1\u4ef6\u76ee\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u305f\u5f8c\u3001StudentActor\u3092\u30b9\u30c8\u30c3\u30d7\u3055\u305b\u3001\u3059\u3050\u306b\u8d77\u52d5\u3057\u307e\u3057\u305f\u3002\u5b9f\u884c\u7d50\u679c\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001StudentActor\u304c\u30c0\u30a6\u30f3\u3057\u3066\u3044\u305f\u9593\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u300c2 : 1 * 7 = ?\u300d\u3068\u300c3 : 1 * 6 = ?\u300d\u306f\u51e6\u7406\u3055\u308c\u3066\u304a\u3089\u305a\uff08\u6c38\u7d9a\u5316\u3055\u308c\u3066\u3044\u306a\u3044\uff09\u30ed\u30b9\u30c8\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\nAkka\u3067\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5b9f\u88c5\u306f\u6700\u3082\u8efd\u91cf\u306aat-most-once\u3067\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3067\u3059\u3002at-most-once\u306f\u6700\u59271\u56de\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3057\u3001\u4eca\u56de\u306e\u3088\u3046\u306b\u3001\u72b6\u6cc1\u306b\u3088\u3063\u3066\u306f\u5c4a\u304b\u306a\u3044\u3068\u3044\u3046\u4e8b\u614b\u304c\u767a\u751f\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n\nat-least-once\nStudentActor\u304c\u30c0\u30a6\u30f3\u3057\u3066\u3044\u308b\u9593\u306b\u9001\u3089\u308c\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u30ed\u30b9\u30c8\u305b\u305a\u3001\u5fc5\u305a\u9001\u308a\u5c4a\u3051\u308b\u3068\u3044\u3046\u306e\u304cat-least-once\u3067\u3059\u3002Akka\u306b\u306fAtLeasetOnceDelively\u3068\u3044\u3046\u30c8\u30ec\u30a4\u30c8\u304c\u3042\u308b\u306e\u3067\u3001TeacherActor\u306fActor\u30c8\u30ec\u30a4\u30c8\u306e\u4ee3\u308f\u308a\u306bAtLeastOnceDelivery\u30c8\u30ec\u30a4\u30c8\u3092\u30df\u30c3\u30af\u30b9\u30a4\u30f3\u3057\u307e\u3059\u3002\n\n\u5b9f\u88c5\n\nTeacherActor\u306e\u5b9f\u88c5\n\n\nTeacherActor\nclass TeacherActor(destination: ActorSelection) extends ActorLogging with AtLeastOnceDelivery {\n\n  def persistenceId: String = \"teacher-id-1\"\n\n  def receiveCommand: Receive = {\n    case CreateExercise =>\n      exerciseId += 1\n      self ! Exercise(exerciseId, Multiply(Random.nextInt(9) + 1, Random.nextInt(9) + 1))\n\n    case Exercise(exerciseId, multiply) if (exerciseId > 5) =>\n      scheduler.cancel()\n      student ! \"print\"\n\n    case Exercise(_, multiply) =>\n      persist(MsgSent(multiply))(updateState)\n\n    case Confirm(deliveryId) =>\n      log.info(s\" $deliveryId :   received\")\n      persist(MsgConfirmed(deliveryId))(updateState)\n\n    case UnconfirmedWarning(metadata) =>\n      log.warning(s\"  unconfirmedWarning[$metadata]\")\n  }\n\n  val receiveRecover: Receive = Actor.emptyBehavior\n\n  def updateState(evt: Evt): Unit = evt match {\n    case sent: MsgSent =>\n      deliver(student) { deliveryId =>\n        log.info(s\" $deliveryId : ${sent.multiply} = ?\")\n        state = state.updated(sent)\n        StudentActor.Msg(deliveryId, sent.multiply)\n      }\n    case confirm: MsgConfirmed => confirmDelivery(confirm.deliveryId)\n  }\n\n}\n\n\nAtLeastOnceDelivery\u30c8\u30ec\u30a4\u30c8\u306fPersistentActor\u30c8\u30ec\u30a4\u30c8\u3092\u30df\u30c3\u30af\u30b9\u30a4\u30f3\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u3001StudentActor\u3068\u540c\u69d8\u306bpersistenceId\u3001receiveCommand\u3001receiveRecover\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002AtLeastOnceDelivery\uff08PersistentActor\uff09\u3092\u4f7f\u7528\u3059\u308b\u3068\u304d\u306f\u3001\u300c!\u300d\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001persist\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u6c38\u7d9a\u5316\u3057\u3001AtLeastOnceDelivery#deliver()\u3067\u9001\u4fe1\u3057\u307e\u3059\u3002\u9001\u4fe1\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u304cStudentActor\u306b\u5c4a\u3044\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u305f\u3081\u3001Confirm\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u3001persist\uff08\u6c38\u7d9a\u5316\uff09\u3057\u307e\u3059\u3002\n\nStudentActor\u306e\u5b9f\u88c5\n\n\nStudentActor\n  def receiveCommand: Receive = {\n    case Msg(deliveryId, Multiply(n1, n2)) =>\n      log.info(s\" $deliveryId :  calculating ... ${Multiply(n1, n2)} = ${n1 * n2}\")\n      persist(Msg(deliveryId, Multiply(n1, n2)))(updateState)\n      sender() ! TeacherActor.Confirm(deliveryId)\n    case \"print\" => log.info(s\"  $state\")\n  }\n\n\nStudentActor\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u305f\u5f8c\u3001sender()\u306b\u5bfe\u3057\u3066\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u308a\u3001TeacherActor\u3067\u53d7\u4fe1\u3057\u307e\u3059\u3002\u4e00\u5b9a\u6642\u9593\u5185\uff08\u30c7\u30d5\u30a9\u30eb\u30c85\u79d2\uff09\u306b\u53d7\u4fe1\u3067\u304d\u306a\u304b\u3063\u305f\u5834\u5408\u306f\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u518d\u9001\u3057\u307e\u3059\u3002\u3053\u306e\u4ed5\u7d44\u307f\u306b\u3088\u308a\u3001StudentActor\u304c\u30c0\u30a6\u30f3\u3057\u3066\u3044\u3066\u3082\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u304f\u307e\u3067(\u5f53\u7136\u4e0a\u9650\u306f\u3042\u308a\u307e\u3059\u304c)\u518d\u9001\u3092\u7e70\u308a\u8fd4\u3059\u3053\u3068\u306b\u3088\u308a\u3001\u5fc5\u305a\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51e6\u7406\u3055\u308c\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002AtLeastOnceDelivery\u3092\u4f7f\u3046\u3068\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5074\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u5230\u9054\u78ba\u8a8d\u3084\u518d\u9001\u3092\u5b9f\u88c5\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u3067\u306f\u3001\u52d5\u304d\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u5b9f\u884c\u7d50\u679c\n\nTeacherActor\n\n\nlog\nakka-message-delivery-reliability $sbt \"run-main school.atleastonce.MathApp teacher\"\n[TeacherActor] -  1 : 6 * 5 = ?\n[TeacherActor] -  1 :   received\n[ReliableDeliverySupervisor] - Association with remote system [akka.tcp://StudentSystem@127.0.0.1:2552] has failed, address is now gated for [5000] ms. Reason: [Disassociated]\n[TeacherActor] -  2 : 8 * 4 = ?\n[ReliableDeliverySupervisor] - Association with remote system [akka.tcp://StudentSystem@127.0.0.1:2552] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://StudentSystem@127.0.0.1:2552]] Caused by: [Connection refused: /127.0.0.1:2552]\n[RemoteActorRefProvider$RemoteDeadLetterActorRef] - Message [school.atleastonce.StudentActor$Msg] from Actor[akka://TeacherSystem/user/teacherActor#-885507212] to Actor[akka://TeacherSystem/deadLetters] was not delivered. [1] dead letters encountered. This logging can be turned off or adjusted with configuration settings 'akka.log-dead-letters' and 'akka.log-dead-letters-during-shutdown'.\n[ReliableDeliverySupervisor] - Association with remote system [akka.tcp://StudentSystem@127.0.0.1:2552] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://StudentSystem@127.0.0.1:2552]] Caused by: [Connection refused: /127.0.0.1:2552]\n[RemoteActorRefProvider$RemoteDeadLetterActorRef] - Message [school.atleastonce.StudentActor$Msg] from Actor[akka://TeacherSystem/user/teacherActor#-885507212] to Actor[akka://TeacherSystem/deadLetters] was not delivered. [2] dead letters encountered. This logging can be turned off or adjusted with configuration settings 'akka.log-dead-letters' and 'akka.log-dead-letters-during-shutdown'.\n[TeacherActor] -  3 : 8 * 6 = ?\n[RemoteActorRefProvider$RemoteDeadLetterActorRef] - Message [school.atleastonce.StudentActor$Msg] from Actor[akka://TeacherSystem/user/teacherActor#-885507212] to Actor[akka://TeacherSystem/deadLetters] was not delivered. [3] dead letters encountered. This logging can be turned off or adjusted with configuration settings 'akka.log-dead-letters' and 'akka.log-dead-letters-during-shutdown'.\n[RemoteActorRefProvider$RemoteDeadLetterActorRef] - Message [school.atleastonce.StudentActor$Msg] from Actor[akka://TeacherSystem/user/teacherActor#-885507212] to Actor[akka://TeacherSystem/deadLetters] was not delivered. [4] dead letters encountered. This logging can be turned off or adjusted with configuration settings 'akka.log-dead-letters' and 'akka.log-dead-letters-during-shutdown'.\n[TeacherActor] -  3 :   received\n[TeacherActor] -  2 :   received\n[TeacherActor] -  4 : 6 * 7 = ?\n[TeacherActor] -  4 :   received\n[TeacherActor] -  5 : 4 * 4 = ?\n[TeacherActor] -  5 :   received\n\n\n\nStudentActor\n\n\nlog\nakka-message-delivery-reliability $sbt \"run-main school.atleastonce.MathApp student\"\n[StudentActor] -  1 :  calculating ... 6 * 5 = 30\n^Cakka-message-delivery-reliability $sbt \"run-main school.atleastonce.MathApp student\"\n[StudentActor] -  3 :  calculating ... 8 * 6 = 48\n[StudentActor] -  2 :  calculating ... 8 * 4 = 32\n[StudentActor] -  4 :  calculating ... 6 * 7 = 42\n[StudentActor] -  5 :  calculating ... 4 * 4 = 16\n[StudentActor] -   result = List(1, 3, 2, 4, 5)\n\n\n2\u3064\u306eActor\u30b7\u30b9\u30c6\u30e0\u3092\u8d77\u52d5\u3057\u3001\u5148\u307b\u3069\u3068\u540c\u3058\u3088\u3046\u306b\u9014\u4e2d\u3067StudentActor\u3092\u30b9\u30c8\u30c3\u30d7\u3055\u305b\u3066\u307f\u307e\u3057\u305f\u3002StudentActor\u304c\u30c0\u30a6\u30f3\u3057\u3066\u3044\u308b\u9593\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306fDeadLetter\u306b\u306a\u308a\u307e\u3059\u3002StudentActor\u3092\u518d\u3073\u8d77\u52d5\u3055\u305b\u308b\u3068\u30c0\u30a6\u30f3\u3057\u3066\u3044\u305f\u9593\u306b\u9001\u3089\u308c\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u300c2 : 8 * 4 = ?\u300d\u3068\u300c3 : 8 * 6 = ?\u300d\u3092\u53d7\u4fe1\u3057\u3064\u3064\u3001\u65b0\u305f\u306b\u9001\u3089\u308c\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u300c4 : 6 * 7 = ?\u300d\u3068\u300c5 : 4 * 4 = ?\u300d\u3082\u51e6\u7406\u3057\u307e\u3057\u305f\u3002TeacherActor\u3092\u898b\u308b\u3068StudentActor\u304c\u30c0\u30a6\u30f3\u3057\u3066\u3044\u9593\u306f\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u53d7\u4fe1\u3067\u304d\u305a\u3001\u518d\u958b\u5f8c\u306b\u307e\u3068\u3081\u3066\u53d7\u4fe1\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u3053\u306e\u5834\u5408\u9806\u5e8f\u306f\u4fdd\u8a3c\u3055\u308c\u306a\u3044\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002\u3053\u308c\u3067at-least-once\u304c\u5b9f\u73fe\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\n\nexactly-once\n\u6b21\u306b\u3001\u3082\u3057StudentActor\u304b\u3089\u9001\u3089\u308c\u308b\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u304b\u306a\u304b\u3063\u305f\u5834\u5408\u306b\u3069\u3046\u306a\u308b\u304b\u3092\u8003\u3048\u3066\u307f\u307e\u3059\u3002\nAtLeastOnceDelivery\u3067\u306f\u3001\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u305f\u3053\u3068\u3067\u9001\u4fe1\u5148\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u3044\u305f\u3053\u3068\u3092\u8a8d\u8b58\u3059\u308b\u306e\u3067\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u969c\u5bb3\u7b49\u3067\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3067\u304d\u306a\u304b\u3063\u305f\u72b6\u614b\u3092\u64ec\u4f3c\u7684\u306b\u8d77\u3053\u3059\u305f\u3081\u3001\u30e9\u30f3\u30c0\u30e0\u306b\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u53d7\u4fe1\u3092\u5931\u6557\u3055\u305b\u3066\u307f\u307e\u3059\u3002\n\n\u5b9f\u88c5\n\nTeacherActor\n\n\nTeacherActor\n    case Confirm(deliveryId) =>\n      // \u30c7\u30ea\u30d0\u30ea\u30fcID\u304c\u5076\u6570\u306e\u5834\u5408\u30011/2\u306e\u78ba\u7387\u3067\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3067\u304d\u306a\u3044\n      if (deliveryId % 2 == 0 && Random.nextInt(2) == 0) {\n        log.info(s\" $deliveryId :   lost confirmation message\")\n      } else {\n        log.info(s\" $deliveryId :   received\")\n        persist(MsgConfirmed(deliveryId))(updateState)\n      }\n\n\n\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u306f2\u5206\u306e1\u306e\u78ba\u7387\u3067\u53d7\u4fe1\u306b\u5931\u6557\u3057\u3001\u300clost confirmation message\u300d\u3068\u3044\u3046\u30ed\u30b0\u3092\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n\u5b9f\u884c\u7d50\u679c\n\nlog\nakka-message-delivery-reliability $sbt \"run-main school.atleastonce.MathApp\"\n[TeacherActor] -  1 : 9 * 8 = ?\n[StudentActor] -  1 :  calculating ... 9 * 8 = 72\n[TeacherActor] -  1 :   received\n[TeacherActor] -  2 : 8 * 7 = ?\n[StudentActor] -  2 :  calculating ... 8 * 7 = 56\n[TeacherActor] -  2 :   lost confirmation message\n[TeacherActor] -  3 : 6 * 2 = ?\n[StudentActor] -  3 :  calculating ... 6 * 2 = 12\n[TeacherActor] -  3 :   received\n[StudentActor] -  2 :  calculating ... 8 * 7 = 56\n[TeacherActor] -  2 :   received\n[TeacherActor] -  4 : 8 * 4 = ?\n[StudentActor] -  4 :  calculating ... 8 * 4 = 32\n[TeacherActor] -  4 :   received\n[TeacherActor] -  5 : 2 * 3 = ?\n[StudentActor] -  5 :  calculating ... 2 * 3 = 6\n[TeacherActor] -  5 :   received\n[StudentActor] -   result = List(1, 2, 3, 2, 4, 5)\n\n\n2\u756a\u76ee\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u300c2 : 8 * 7 = ?\u300d\u306b\u6ce8\u76ee\u3057\u3066\u4e0b\u3055\u3044\u3002TeacherActor\u306f\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u53d7\u4fe1\u306b\u5931\u6557\uff08lost confirmation message\uff09\u3057\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u518d\u9001\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308aStudentActor\u306f\u540c\u3058\u554f\u984c\u3092\uff12\u5ea6\u89e3\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u6700\u7d42\u884c\u306e\u51e6\u7406\u6e08\u30c7\u30fc\u30bf\u304b\u3089\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\u5b9f\u969b\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u5c4a\u3044\u3066\u3044\u305f\u306e\u306b\u3001\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u53d7\u4fe1\u306b\u5931\u6557\u3057\u305f\u3060\u3051\u306a\u306e\u3067\u3001\u518d\u9001\u3059\u308b\u3053\u3068\u306b\u3088\u308a\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u91cd\u8907\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002AtLeastOnceDelivery\u3067\u306f\u3001\u5c11\u306a\u304f\u3068\u30821\u5ea6\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u304f\u3053\u3068\u3092\u4fdd\u8a3c\u3057\u307e\u3059\u304c\u3001\u6b63\u78ba\u306b1\u56de\u306e\u307f\u5c4a\u304f\u3053\u3068\u306f\u4fdd\u8a3c\u3055\u308c\u307e\u305b\u3093\u3002exactly-once\u3067\u306f\u306a\u3044\u306e\u3067\u3059\u3002\n\nexactly-once\u3092\u5b9f\u73fe\u3059\u308b\u305f\u3081\u306b\u3001StudentActor\u3067\u91cd\u8907\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u51e6\u7406\u3057\u306a\u3044\u3088\u3046\u306b\u3057\u307e\u3059\u3002\u4eca\u56de\u53d7\u4fe1\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u30af\u30ea\u30a2\u51e6\u7406\u306f\u8003\u3048\u305a\u3001\u30b7\u30f3\u30d7\u30eb\u306b\u84c4\u7a4d\u3057\u305f\u60c5\u5831\u306e\u4e2d\u306b\u914d\u4fe1\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5b58\u5728\u3057\u305f\u5834\u5408\u306f\u3001\u91cd\u8907\u3068\u5224\u65ad\u3057\u307e\u3059\u3002\n\nStudentActor\u306e\u5b9f\u88c5\n\n\nStudentActor\n    case Msg(deliveryId, Multiply(n1, n2)) =>\n      if (state.contains(Msg(deliveryId, Multiply(n1, n2))))\n        log.info(s\" $deliveryId :  already calculated\")\n      else {\n        log.info(s\" $deliveryId :  calculating ... ${Multiply(n1, n2)} = ${n1 * n2}\")\n        persist(Msg(deliveryId, Multiply(n1, n2)))(updateState)\n      }\n      sender() ! TeacherActor.Confirm(deliveryId)\n\n\n\u6c38\u7d9a\u5316\u306e\u305f\u3081\u306b\u84c4\u7a4d\u3057\u305fstate\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u306f\u3001\u91cd\u8907\u30e1\u30c3\u30bb\u30fc\u30b8\u3068\u5224\u65ad\u3057\u3001\u8a08\u7b97\u51e6\u7406\u3092\u884c\u3044\u307e\u305b\u3093\uff08\u30ed\u30b0\u306b\u300calready calculated\u300d\u3092\u51fa\u529b\uff09\u3002\n\n\u5b9f\u884c\u7d50\u679c\n\nlog\nakka-message-delivery-reliability $sbt \"run-main school.exactlyonce.MathApp\"\n[TeacherActor] -  1 : 7 * 6 = ?\n[StudentActor] -  1 :  calculating ... 7 * 6 = 42\n[TeacherActor] -  1 :   received\n[TeacherActor] -  2 : 1 * 6 = ?\n[StudentActor] -  2 :  calculating ... 1 * 6 = 6\n[TeacherActor] -  2 :   lost confirmation message\n[TeacherActor] -  3 : 5 * 7 = ?\n[StudentActor] -  3 :  calculating ... 5 * 7 = 35\n[TeacherActor] -  3 :   received\n[StudentActor] -  2 :  already calculated\n[TeacherActor] -  2 :   received\n[TeacherActor] -  4 : 1 * 6 = ?\n[StudentActor] -  4 :  calculating ... 1 * 6 = 6\n[TeacherActor] -  4 :   received\n[TeacherActor] -  5 : 8 * 8 = ?\n[StudentActor] -  5 :  calculating ... 8 * 8 = 64\n[TeacherActor] -  5 :   received\n[StudentActor] -   result = List(1, 2, 3, 4, 5)\n\n\n\u3053\u308c\u3067exactly-once\u304c\u5b9f\u88c5\u3067\u304d\u307e\u3057\u305f\u3002\uff12\u756a\u76ee\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u300c2 : 1 * 6 = ?\u300d\u306fTeacherActor\u3067\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u53d7\u4fe1\u306b\u5931\u6557\u3057\u3001\u518d\u9001\u3057\u3066\u3044\u307e\u3059\u304c\u3001StudentActor\u3067\u91cd\u8907\u30e1\u30c3\u30bb\u30fc\u30b8\u3068\u5224\u65ad\u3057\u8a08\u7b97\u3092\u884c\u3063\u3066\u3044\u307e\u305b\u3093\u3002\u5148\u751f\u304b\u3089\u51fa\u3055\u308c\u305f\u554f\u984c\u306f\u305f\u3060\u4e00\u5ea6\u3060\u3051\u751f\u5f92\u304c\u89e3\u304f\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\u6700\u5f8c\u306b\u3001StudentActor\u304c\u30c0\u30a6\u30f3\u3057\u305f\u3068\u304d\u306e\u52d5\u4f5c\u3082\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u5b9f\u884c\u7d50\u679c\n\nTeacherActor\n\n\nlog\nakka-message-delivery-reliability $sbt \"run-main school.exactlyonce.MathApp teacher\"\n[TeacherActor] -  1 : 4 * 9 = ?\n[TeacherActor] -  1 :   received\n[ReliableDeliverySupervisor] - Association with remote system [akka.tcp://StudentSystem@127.0.0.1:2552] has failed, address is now gated for [5000] ms. Reason: [Disassociated]\n[TeacherActor] -  2 : 6 * 1 = ?\n[ReliableDeliverySupervisor] - Association with remote system [akka.tcp://StudentSystem@127.0.0.1:2552] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://StudentSystem@127.0.0.1:2552]] Caused by: [Connection refused: /127.0.0.1:2552]\n[RemoteActorRefProvider$RemoteDeadLetterActorRef] - Message [school.exactlyonce.StudentActor$Msg] from Actor[akka://TeacherSystem/user/teacherActor#79590160] to Actor[akka://TeacherSystem/deadLetters] was not delivered. [1] dead letters encountered. This logging can be turned off or adjusted with configuration settings 'akka.log-dead-letters' and 'akka.log-dead-letters-during-shutdown'.\n[ReliableDeliverySupervisor] - Association with remote system [akka.tcp://StudentSystem@127.0.0.1:2552] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://StudentSystem@127.0.0.1:2552]] Caused by: [Connection refused: /127.0.0.1:2552]\n[RemoteActorRefProvider$RemoteDeadLetterActorRef] - Message [school.exactlyonce.StudentActor$Msg] from Actor[akka://TeacherSystem/user/teacherActor#79590160] to Actor[akka://TeacherSystem/deadLetters] was not delivered. [2] dead letters encountered. This logging can be turned off or adjusted with configuration settings 'akka.log-dead-letters' and 'akka.log-dead-letters-during-shutdown'.\n[TeacherActor] -  3 : 2 * 1 = ?\n[RemoteActorRefProvider$RemoteDeadLetterActorRef] - Message [school.exactlyonce.StudentActor$Msg] from Actor[akka://TeacherSystem/user/teacherActor#79590160] to Actor[akka://TeacherSystem/deadLetters] was not delivered. [3] dead letters encountered. This logging can be turned off or adjusted with configuration settings 'akka.log-dead-letters' and 'akka.log-dead-letters-during-shutdown'.\n[TeacherActor] -  2 :   lost confirmation message\n[TeacherActor] -  3 :   received\n[TeacherActor] -  2 :   received\n[TeacherActor] -  4 : 9 * 4 = ?\n[TeacherActor] -  4 :   lost confirmation message\n[TeacherActor] -  4 :   lost confirmation message\n[TeacherActor] -  5 : 7 * 5 = ?\n[TeacherActor] -  5 :   received\n[TeacherActor] -  4 :   received\n\n\n\n\nStudentActor\n\n\nlog\nakka-message-delivery-reliability $sbt \"run-main school.exactlyonce.MathApp student\"\n[StudentActor] -  1 :  calculating ... 4 * 9 = 36\n^Cakka-message-delivery-reliability $sbt \"run-main school.exactlyonce.MathApp student\"\n[StudentActor] -  2 :  calculating ... 6 * 1 = 6\n[StudentActor] -  3 :  calculating ... 2 * 1 = 2\n[StudentActor] -  2 :  already calculated\n[StudentActor] -  4 :  calculating ... 9 * 4 = 36\n[StudentActor] -  4 :  already calculated\n[StudentActor] -  5 :  calculating ... 7 * 5 = 35\n[StudentActor] -  4 :  already calculated\n[StudentActor] -   result = List(1, 2, 3, 4, 5)\n\n\n\uff11\u756a\u76ee\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u300c1 : 7 * 6 = ?\u300d\u3092\u53d7\u4fe1\u3057\u305f\u5f8c\u3001StudetnActor\u3092\u30c0\u30a6\u30f3\u3055\u305b\u307e\u3057\u305f\u304c\u3001\u6700\u7d42\u7684\u306bTeacherActor\u304b\u3089\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u91cd\u8907\u306a\u304f\u5fc5\u305a\u4e00\u5ea6\u51e6\u7406\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\n\u304a\u308f\u308a\u306b\nat-most-once\u3001at-least-once\u3001exactly-once\u3068\u9806\u306b\u5b9f\u88c5\u3001\u51e6\u7406\u30b3\u30b9\u30c8\uff08\u3084\u308a\u53d6\u308a\u3059\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u6570\uff09\u304c\u5171\u306b\u5897\u3048\u3066\u3044\u304d\u307e\u3057\u305f\u3002Akka\u304c\u4e00\u756a\u5f97\u610f\u3068\u3059\u308b\u306e\u306fat-most-once\u3067\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066AtLeastOnceDelivery\u30c8\u30ec\u30a4\u30c8\u3092\u4f7f\u3063\u3066at-least-once\u3092\u5b9f\u88c5\u3057\u3001exactly-once\u306f\u696d\u52d9\u306b\u7279\u5316\u3057\u305fID\u7b49\u3092\u7528\u3044\u3066\u91cd\u8907\u6392\u9664\u3092\u5b9f\u88c5\u3059\u308b\u306e\u304c\u826f\u3055\u305d\u3046\u3067\u3059\u3002\n\n\n\nNo\n\u7a2e\u985e\n\u5b9f\u88c5\u65b9\u6cd5\n\n\n\n\n1\nat-most-once\nAkka\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5b9f\u88c5\n\n\n2\nat-least-once\nAtLeastOnceDelivery\u3092\u4f7f\u3063\u3066\u5230\u9054\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u3051\u53d6\u308a\n\n\n3\nexactly-once\n2\u306e\u5bfe\u5fdc\u3092\u884c\u3063\u305f\u4e0a\u3067\u696d\u52d9ID\u3092\u7528\u3044\u3066\u91cd\u8907\u6392\u9664\n\n\n\n\u3053\u306e\u3042\u305f\u308a\u306f\u3001Message Delivery Reliability-Discussion: Why No Guaranteed Delivery?\u3068\u304b\u3001\u305d\u3053\u304b\u3089\u30ea\u30f3\u30af\u306e\u8cbc\u3089\u308c\u3066\u3044\u308bNobody Needs Reliable Messaging\u306b\u8a73\u3057\u304f\u66f8\u304b\u308c\u3066\u3044\u307e\u3059\u3002Nobody Needs Reliable Messaging\u306b\u3042\u308b\u3088\u3046\u306b\u3001\u300c\u51e6\u65b9\u7b8bID\u300d\u306e\u3088\u3046\u306a\u696d\u52d9ID\u306f\u5fc5\u305a\u5b58\u5728\u3059\u308b\u3057\u3001\u66f4\u65b0\u51e6\u7406\u7b49\u3092\u4f34\u3046\u5834\u5408\u306f\u5fc5\u305a\u91cd\u8907\u30c1\u30a7\u30c3\u30af\u306f\u5b9f\u88c5\u3059\u308b\u3082\u306e\u306a\u306e\u3067\u3001\u91cd\u8907\u306e\u6392\u9664\u306f\u696d\u52d9\u5074\u3067\u5b9f\u88c5\u3059\u3079\u304d\u3060\u3068\u8003\u3048\u3089\u308c\u307e\u3059\u3002Akka\u5074\u3067\u3084\u308d\u3046\u3068\u3059\u308b\u3068\u4f59\u8a08\u306a\u30b3\u30b9\u30c8\u304c\u304b\u304b\u3063\u3066\u3057\u307e\u3044\u305d\u3046\u3067\u3059\u3057\u3002\n\u3068\u3044\u3046\u308f\u3051\u3067\u3001\u4eca\u56de\u306fAkka\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u4fe1\u983c\u6027\u306b\u3064\u3044\u3066\u8003\u3048\u3066\u3044\u307e\u3057\u305f\u3002\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u4fe1\u983c\u5ea6\u3092\u4e0a\u3052\u3001\u78ba\u5b9f\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u306e\u5b9f\u88c5\u304c\u3067\u304d\u3001\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba\u306e\u304c\u3063\u3061\u308a\u306a\u5834\u9762\u3067\u3082\u5229\u7528\u3067\u304d\u308b\u3053\u3068\u304c\u304a\u5206\u304b\u308a\u9802\u3051\u305f\u3053\u3068\u3067\u3057\u3087\u3046\u3002\n\u8aac\u660e\u3067\u4f7f\u7528\u3057\u305f\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u5168\u4f53\u306fGitHub\u3067\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002\n\u5b9f\u88c5\u306b\u3042\u305f\u308a\u3001Typesafe Activator\u306e\uff12\u3064\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\n\nAKKA REMOTE SAMPLES WITH SCALA\nAKKA PERSISTENCE SAMPLES WITH SCALA\n\n\u672c\u8a18\u4e8b\u306f[TIS Engineer Advent Calendar 2015](http://qiita.com/advent-calendar/2015/tis)\u300116\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n[Akka](http://akka.io/)\u306e[Akka Remoting](http://doc.akka.io/docs/akka/snapshot/scala/remoting.html)\u3001[Akka Persistant](http://doc.akka.io/docs/akka/snapshot/scala/persistence.html)\u3001[AtLeasetOnceDelively](http://doc.akka.io/docs/akka/snapshot/scala/persistence.html#At-Least-Once_Delivery)\u3042\u305f\u308a\u306b\u3064\u3044\u3066\u66f8\u304d\u307e\u3059\u3002\n\n## \u306f\u3058\u3081\u306b\n\n\u65e9\u3044\u3082\u306e\u30672015\u5e74\u3082\u3042\u3068\u5c11\u3057\u3067\u904e\u304e\u53bb\u308d\u3046\u3068\u3057\u3066\u3044\u307e\u3059\u304c\u3001Web\u754c\u9688\u3067\u306f\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u3067\u76db\u308a\u4e0a\u304c\u3063\u305f\u5e74\u3067\u3057\u305f\u3002\u305d\u3057\u3066\u3001\u6765\u308b2016\u5e74\u65e9\u3005\u306b\u958b\u50ac\u3055\u308c\u308b[Scala Matsuri](http://scalamatsuri.org/#schedule)\u3082\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30cd\u30bf\u76ee\u767d\u62bc\u3057\u3067\u3059\u3002\n\n\u305d\u3053\u3067\u3001\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30b7\u30b9\u30c6\u30e0\u306f\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba\u306e\u3088\u3046\u306a\u30ac\u30c3\u30c1\u30ea\u3057\u305f\u30b7\u30b9\u30c6\u30e0\u3067\u3082\u4f7f\u3048\u308b\u306e\u304b\u3092\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u4fe1\u983c\u6027\u3084\u5230\u9054\u4fdd\u8a3c\u3068\u3044\u3046\u89b3\u70b9\u3067\u8003\u3048\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\n\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30b7\u30b9\u30c6\u30e0\u306f[Reactive Manifesto](http://www.reactivemanifesto.org/)\u304c\u8ad6\u3058\u3066\u3044\u308b\u300cResponsive\uff08\u5373\u5fdc\u6027\uff09\u300d, \u300cResilient\uff08\u8010\u969c\u5bb3\u6027\uff09\u300d, \u300cElastic\uff08\u5f3e\u529b\u6027\uff09\u300d, \u300cMesssage Driven\uff08\u30e1\u30c3\u30bb\u30fc\u30b8\u99c6\u52d5\uff09\u300d\u306a\u30b7\u30b9\u30c6\u30e0\u3067\u3001\u4ee3\u8868\u7684\u306a\u306e\u304c\u3001[Play Framework](https://www.playframework.com/)\u3084[Akka](http://akka.io/)\u306a\u3069[Typesafe](https://typesafe.com/)\u793e\u306e\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3067\u3059\u3002\u306a\u305c\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30b7\u30b9\u30c6\u30e0\u304c\u5fc5\u8981\u304b\u3068\u304b\u3001\u306a\u305c\u4e26\u884c\u6027\u304c\u4eca\u6ce8\u76ee\u3055\u308c\u308b\u306e\u304b\u306f[\u3053\u3061\u3089](https://thinkit.co.jp/article/9185)\u3092\u898b\u3066\u9802\u304f\u3068\u3057\u3066\u3001\u4eca\u56de\u306fAkka\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u6027\u8cea\u306b\u7740\u76ee\u3057\u307e\u3059\u3002\n\n## Akka\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\n\nAkka\u306fActor\u30d9\u30fc\u30b9\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u99c6\u52d5\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3001\u3044\u308f\u3086\u308bActor\u30e2\u30c7\u30eb\u304c\u30d9\u30fc\u30b9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002Actor\u540c\u58eb\u306e\u3084\u308a\u3068\u308a\u306f\u3059\u3079\u3066\u30e1\u30c3\u30bb\u30fc\u30b8\u3067\u884c\u3044\u3001Actor\u306f\u5225\u306eActor\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u3063\u305f\u3042\u3068\u306f\u3001\u305d\u306e\u5fdc\u7b54\u3092\u5f85\u3064\u3088\u3046\u306a\u540c\u671f\u7684\u306a\u51e6\u7406\u3092\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u975e\u540c\u671f\u306b\u81ea\u5206\u306e\u3084\u308a\u305f\u3044\u51e6\u7406\u3092\u9032\u3081\u3066\u884c\u304d\u307e\u3059\u3002\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u9001\u308a\u5148\u3068\u306a\u3063\u305fActor\u306b\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u305f\u3089\u3001\u3069\u3093\u306a\u632f\u308b\u821e\u3044\u3092\u884c\u3046\u304b\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u3066\u3001\u53d7\u4fe1\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u306b\u5fdc\u3058\u305f\u51e6\u7406\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u3053\u306e\u51e6\u7406\u306f\u9001\u308a\u4e3b\u3068\u306a\u3063\u305fActor\u3068\u306f\u3001\u5225\u30b9\u30ec\u30c3\u30c9\u3001\u6642\u306b\u306f\u30b5\u30fc\u30d0\u3055\u3048\u3082\u5225\u3067\u3001\u4e26\u884c\u306b\u305d\u3057\u3066\u5206\u6563\u3057\u3066\u51e6\u7406\u3055\u308c\u307e\u3059\u3002\u3056\u3063\u304f\u308a\u3067\u3059\u304c\u3001\u3053\u308c\u304c\u3053\u308c\u307e\u3067\u82e6\u52b4\u3057\u3066\u5b9f\u88c5\u3057\u3066\u304d\u305f\u4e26\u884c\u51e6\u7406\u3092\u3001\u540c\u671f\u51e6\u7406\u3092\u5b9f\u88c5\u3059\u308b\u611f\u899a\u3067\u5bb9\u6613\u306b\u5b9f\u88c5\u3059\u308b\u3067\u304d\u308bActor\u30e2\u30c7\u30eb\u3067\u3059\u3002\n\n\u3055\u3066\u3001\u3053\u3053\u3067\u6c17\u306b\u306a\u308b\u306e\u306f\u3001\u5225\u306eActor\u306b\u9001\u3063\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u884c\u304f\u672b\u3067\u3059\u3002\u9001\u308a\u4e3b\u306f\u305d\u306e\u7d50\u679c\u3092\u6c17\u306b\u305b\u305a\u81ea\u5206\u306e\u51e6\u7406\u3092\u975e\u540c\u671f\u3067\u9032\u3081\u3066\u884c\u304f\u3068\u8a00\u3044\u307e\u3057\u305f\u304c\u3001\u9001\u4fe1\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u304d\u3061\u3093\u3068\u5c4a\u3044\u3066\u3044\u308b\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\u540c\u3058JVM\u4e0a\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u547c\u3073\u51fa\u3057\u3066\u3044\u308b\u306e\u3067\u3042\u308c\u3070\u3001\u305d\u308c\u307b\u3069\u6c17\u306b\u3059\u3079\u304d\u4e8b\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u76f8\u624b\u304c\u30ea\u30e2\u30fc\u30c8Actor\u3001\u3064\u307e\u308a\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4ecb\u3057\u3066\u5225\u30b5\u30fc\u30d0\u4e0a\u306b\u914d\u5099\u3055\u308c\u3066\u3044\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u5834\u5408\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u969c\u5bb3\u7b49\u306e\u554f\u984c\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u5148Actor\u306b\u5230\u9054\u3057\u306a\u3044\u4e8b\u3082\u5341\u5206\u306b\u8003\u3048\u3089\u308c\u307e\u3059\u3002\n\n\u4f8b\u3048\u3070\u3001[\u4ee5\u524d\u7d39\u4ecb](http://www.slideshare.net/yugolf/typesafe-reactive-platformreactive-system)\u3057\u305f[\u30bd\u30fc\u30e9\u30fc\u30d5\u30a1\u30fc\u30e0\u30e2\u30cb\u30bf\u30fc](https://github.com/tech-sketch/reactive-solar-farm-monitor)\u306e\u3088\u3046\u306b\u6bce\u79d2\u30d1\u30cd\u30eb\u304b\u3089\u9001\u3089\u308c\u3066\u3044\u308b\u96fb\u529b\u3092\u76e3\u8996\u30fb\u30d3\u30b8\u30e5\u30a2\u30e9\u30a4\u30ba\u3057\u6545\u969c\u3092\u691c\u77e5\u3059\u308b\u3088\u3046\u306a\u30b7\u30b9\u30c6\u30e0\u3067\u3042\u308c\u3070\u3001\u4e00\u6642\u7684\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u53d7\u4fe1\u3067\u304d\u306a\u304b\u3063\u305f\u3068\u3057\u3066\u3082\u3001\u305d\u306e\u5f8c\u3001\u6700\u65b0\u306e\u96fb\u529b\u3092\u53d7\u4fe1\u3067\u304d\u308c\u3070\u4f55\u306e\u554f\u984c\u3082\u3042\u308a\u307e\u305b\u3093\u3002\u300c\u4eca\u300d\u767a\u96fb\u3057\u3066\u3044\u308b\u96fb\u529b\u3001\u300c\u4eca\u300d\u6545\u969c\u3057\u3066\u3044\u306a\u3044\u304b\u304c\u91cd\u8981\u3060\u304b\u3089\u3067\u3059\u3002\n\u3057\u304b\u3057\u3001\u305d\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u30dc\u30fc\u30ca\u30b9\u3092\u4f1a\u793e\u304b\u3089\u81ea\u5206\u306e\u53e3\u5ea7\u306b\u632f\u308a\u8fbc\u3080\u3068\u3044\u3046\u30e1\u30c3\u30bb\u30fc\u30b8\u3060\u3063\u305f\u5834\u5408\u306f\u3069\u3046\u3067\u3057\u3087\u3046\u304b\uff1f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u554f\u984c\u3067\u632f\u308a\u8fbc\u307e\u308c\u305a\u3001\u6b21\u56de\u306e\u8cde\u4e0e\u307e\u3067\u6211\u6162\u3068\u3044\u3046\u8a71\u306b\u306f\u306a\u3089\u306a\u3044\u3067\u3057\u3087\u3046\u3002\u3053\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u5fc5\u305a\u9001\u4fe1\u5148\u306eActor\u306b\u5230\u9054\u3057\u51e6\u7406\u3055\u308c\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba\u306e\u304c\u3063\u3061\u308a\u30b7\u30b9\u30c6\u30e0\u306b\u3068\u3063\u3066\u306f\u5f53\u7136\u306e\u8a71\u3067\u3059\u3002\n\n\u524d\u7f6e\u304d\u306f\u3053\u3053\u307e\u3067\u3068\u3057\u3066\u3001[Typesafe Reactive Platform](https://www.typesafe.com/products/typesafe-reactive-platform)\u3092\u652f\u3048\u308b**Akka\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u5fc5\u305a\u5c4a\u304f\u306e\u3067\u3057\u3087\u3046\u304b\uff1f**\n\n## \u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u4fe1\u983c\u6027\n\n[Message Delivery Reliability](http://doc.akka.io/docs/akka/2.4.1/general/message-delivery-reliability.html) \uff08[\u65e5\u672c\u8a9e\u8a33](http://qiita.com/sifue/items/3e4ffb845577d0caab02)\uff09\u306b\u3088\u308b\u3068\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u4fe1\u983c\u6027\u306f\uff13\u7a2e\u985e\u306b\u5206\u985e\u3055\u308c\u307e\u3059\u3002\n\n| No | \u7a2e\u985e | \u5185\u5bb9 |\n| ---:| ---- | ----|\n| 1 | **at-most-once** |\u6700\u5927\uff11\u56de\u3002<br>\uff11\u56de\u3060\u3051\u9001\u4fe1\u3059\u308b\u3051\u3069\u5c4a\u304f\u304b\u3069\u3046\u304b\u306f<br>\u5206\u304b\u3089\u306a\u3044\u3002|\n| 2 | **at-least-once** | \u5c11\u306a\u304f\u3068\u3082\uff11\u56de\u3002<br>\u5fc5\u305a\uff11\u56de\u306f\u5c4a\u304f\u3051\u3069\u3001\uff12\u56de\u3068\u304b\uff13\u56de\u3068\u304b<br>\u91cd\u8907\u3057\u3066\u9001\u3063\u3066\u3057\u307e\u3046\u304b\u3082\u77e5\u308c\u306a\u3044\u3002|\n| 3 | **exactly-once** | \u6b63\u78ba\u306b\uff11\u56de\u3002<br>\u91cd\u8907\u3082\u306a\u304f\u5fc5\u305a\uff11\u56de\u3060\u3051\u5c4a\u304f\u3002|\n\n\uff13\u756a\u76ee\u304c\u6700\u3082\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba\u306a\u304b\u3093\u3058\u306e\u3084\u3064\u3067\u3059\u306d\u3002\u4e0b\u306b\u884c\u304f\u307b\u3069\u5805\u3044\u51e6\u7406\u306b\u306a\u308a\u3001\u305d\u306e\u5206\u30b3\u30b9\u30c8\u304c\u304b\u304b\u308a\u305d\u3046\u3068\u3044\u3046\u3053\u3068\u306f\u60f3\u50cf\u304c\u3064\u304d\u307e\u3059\u304c\u3001\u305d\u308c\u305e\u308cAkka\u3067\u306f\u3069\u306e\u3088\u3046\u306b\u5b9f\u73fe\u3059\u308b\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\u7c21\u5358\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u3084\u308a\u53d6\u308a\u3092\u4f8b\u306b\u8a66\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n## at-most-once\n\n\u5c0f\u5b66\u6821\u306e\u5148\u751f\uff08Teacher Actor\uff09\u304c\u4e5d\u4e5d\u306e\u554f\u984c\u3092\u30ac\u30f3\u30ac\u30f3\u51fa\u3057\u3066\u3001\u751f\u5f92\uff08Student Actor\uff09\u304c\u9806\u306b\u89e3\u3044\u3066\u3044\u304f\u30b5\u30f3\u30d7\u30eb\u3092\u52d5\u304b\u3057\u3066\u307f\u307e\u3059\u3002\uff08[\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9](https://github.com/yugolf/akka-message-delivery-reliability)\uff09\n\n![at-most-once1.png](https://qiita-image-store.s3.amazonaws.com/0/19438/c056d74e-6ee9-20e2-05d4-dfcc70a6b982.png)\n\n\n\u307e\u305a\u306f\u3001\u666e\u901a\u306b[Akka Remoting](http://doc.akka.io/docs/akka/snapshot/scala/remoting.html)\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u3063\u3066\u307f\u307e\u3059\u3002\n\n### \u5b9f\u88c5\n\n* \u30e9\u30a4\u30d6\u30e9\u30ea\n\n```scala:build.sbt\n\"com.typesafe.akka\" %% \"akka-actor\" % \"2.4-SNAPSHOT\",\n\"com.typesafe.akka\" %% \"akka-remote\" % \"2.4-SNAPSHOT\"\n```\n\nakka-actor\u3068akka-remote\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n* Teacher Actor\u306e\u5b9f\u88c5\n\n```scala:TeacherActor\n  var exerciseId = 0\n  val scheduler = context.system.scheduler.schedule(0 milliseconds, 3 seconds, self, CreateExercise)\n\n  def receive: Receive = {\n    case CreateExercise =>\n      exerciseId += 1\n      self ! Exercise(exerciseId, Multiply(Random.nextInt(9) + 1, Random.nextInt(9) + 1))\n\n    case Exercise(exerciseId, multiply) if (exerciseId > 9) =>\n      scheduler.cancel()\n\n    case Exercise(exerciseId, multiply) =>\n      log.info(s\" $exerciseId : ${multiply} = ?\")\n      student !  StudentActor.Msg(exerciseId, multiply)\n  }\n```\n\nTeacherActor\u306f\uff13\u79d2\u6bce\u306b\u8a08\u7b97\u554f\u984c\u3092\u4f5c\u6210\u3057\u3001\u751f\u6210\u3057\u305f\u554f\u984c\u3092StudentActor\u306b\u9001\u308a\u307e\u3059\u3002\n\n* Student Actor\u306e\u5b9f\u88c5\n\n```scala:StudentActor\n  def receive: Receive = {\n    case Msg(deliveryId, Multiply(n1, n2)) =>\n       log.info(s\" $deliveryId :  calculating ... ${Multiply(n1, n2)} = ${n1 * n2}\")\n  }\n```\n\nSutudentActor\u306f\u8a08\u7b97\u554f\u984c\u3092\u53d7\u4fe1\u3059\u308b\u3068\u554f\u984c\u3092\u89e3\u304d\u307e\u3059\u3002receive\u30e1\u30bd\u30c3\u30c9\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u306e\u304c\u53d7\u4fe1\u3055\u308c\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u306b\u5bfe\u5fdc\u3059\u308b\u632f\u308b\u821e\u3044\u3067\u3059\u3002\n\n\n### \u5b9f\u884c\u7d50\u679c\n\n```bat:log\nakka-message-delivery-reliability $sbt \"run-main school.atmostonce.MathApp\"\n[TeacherActor] -  1 : 8 * 1 = ?\n[StudentActor] -  1 :  calculating ... 8 * 1 = 8\n[TeacherActor] -  2 : 1 * 3 = ?\n[StudentActor] -  2 :  calculating ... 1 * 3 = 3\n[TeacherActor] -  3 : 7 * 2 = ?\n[StudentActor] -  3 :  calculating ... 7 * 2 = 14\n[TeacherActor] -  4 : 6 * 2 = ?\n[StudentActor] -  4 :  calculating ... 6 * 2 = 12\n[TeacherActor] -  5 : 1 * 8 = ?\n[StudentActor] -  5 :  calculating ... 1 * 8 = 8\n```\n\n1\u554f\u76ee\u300c1 : 8 * 1 = ?\u300d\u3068\u3044\u3046\u554f\u984c\u304cTeacherActor\u304b\u3089\u9001\u3089\u308c\u3001StudentActor\u306b\u3088\u3063\u3066\u300c1 :  calculating ... 8 * 1 = 8\u300d\u306e\u3088\u3046\u306b\u554f\u984c\u304c\u8aac\u304b\u308c\u307e\u3057\u305f\u3002\u3053\u306e\u3088\u3046\u306b\u3001TeacherActor\u304b\u3089StudentActor\u30785\u554f\u306e\u8a08\u7b97\u554f\u984c\u304c\u6b63\u3057\u304f\u9001\u3089\u308c\u3066\u3044\u307e\u3059\u30021\u3064\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u30ed\u30b0\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u30b7\u30ea\u30a2\u30eb\u306b\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u306b\u898b\u3048\u307e\u3059\u304c\u3001TeacherActor\u3068StudentActor\u306f\u4e26\u884c\u306b\u51e6\u7406\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u4f55\u4e8b\u3082\u306a\u3051\u308c\u3070\u3001\u3053\u306e\u3088\u3046\u306b\u3059\u3079\u3066\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304cTeacherActor\u304b\u3089StudentActor\u306b\u9001\u4fe1\u3055\u308c\u8a08\u7b97\u304c\u884c\u308f\u308c\u307e\u3059\u304c\u3001TeacherActor\u3068StudentActor\u306f\u5225\u306e\u30b5\u30fc\u30d0\u306b\u3044\u307e\u3059\u3002\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7b49\u306e\u554f\u984c\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u304b\u306a\u304b\u3063\u305f\u5834\u5408\u306f\u3069\u3046\u306a\u308b\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\n\n## Akka Persistence\n\nStudentActor\u3078\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u5230\u9054\u78ba\u8a8d\u306e\u524d\u306b\u3001\u53d7\u4fe1\u7d50\u679c\u3092\u5206\u304b\u308a\u3084\u3059\u304f\u3059\u308b\u305f\u3081\u3001\u51e6\u7406\u3057\u305f\u60c5\u5831\u3092[Akka Persistant](http://doc.akka.io/docs/akka/snapshot/scala/persistence.html)\u3092\u4f7f\u3063\u3066\u6c38\u7d9a\u5316\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n### \u5b9f\u88c5\n\n* \u30e9\u30a4\u30d6\u30e9\u30ea\n\n```scala:build.sbt\n\"com.typesafe.akka\" %% \"akka-persistence\" % \"2.4.0\",\n\"org.iq80.leveldb\"            % \"leveldb\"          % \"0.7\",\n\"org.fusesource.leveldbjni\"   % \"leveldbjni-all\"   % \"1.8\",\n```\n\n\uff13\u3064\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n* StudentActor\u306e\u8a2d\u5b9a\n\n```scala:student.conf\nakka {\n  persistence {\n    snapshot-store {\n      plugin = \"akka.persistence.snapshot-store.local\"\n      local.dir = \"target/persistence/student\"\n    }\n    journal {\n      plugin = \"akka.persistence.journal.leveldb\"\n      leveldb.native = false\n      leveldb.dir = \"target/persistence/journal/student\"\n    }\n  }\n}\n```\n\nStudentActor\u306e\u6c38\u7d9a\u5316\u3059\u308b\u60c5\u5831\u306f\u300ctarget/persistence/student\u300d\u306b\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002TeacherActor\u306f\u540c\u69d8\u306b\u300ctarget/persistence/teacher\u300d\u306b\u6c38\u7d9a\u5316\u3057\u307e\u3059\u3002\n\n* StudentActor\u306e\u5b9f\u88c5\n\n```scala:StudentActor\nclass StudentActor extends ActorLogging with PersistentActor {\n\n  def persistenceId: String = \"student-id-1\"\n  var state = StudentState()\n\n  def receiveCommand: Receive = {\n    case Msg(deliveryId, Multiply(n1, n2)) =>\n      log.info(s\" $deliveryId :  calculating ... ${Multiply(n1, n2)} = ${n1 * n2}\")\n      persist(Msg(deliveryId, Multiply(n1, n2)))(updateState)\n\n    case \"print\" => log.info(s\"  state = $state\")\n  }\n\n  val receiveRecover: Receive = {\n    case msg: Msg => updateState(msg)\n  }\n\n  def updateState(msg: Msg): Unit = {\n    state = state.updated(msg)\n  }\n}\n\nfinal case class StudentState(received: List[Long] = Nil) {\n  def updated(s: Msg): StudentState = copy(received :+ s.deliveryId)\n  def contains(s: Msg) = received.contains(s.deliveryId)\n}\n```\n\nActor\u30c8\u30ec\u30a4\u30c8\u306e\u4ee3\u308f\u308a\u306bPersistentActor\u30c8\u30ec\u30a4\u30c8\u3092\u30df\u30c3\u30af\u30b9\u30a4\u30f3\u3057\u3001persistenceId\u3001receiveCommand\u3001receiveRecover\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002StudentActor\u3067\u306f\u53d7\u4fe1\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u300cMsg(deliveryId, Multiply(n1, n2))\u300d\u3092\u305d\u306e\u307e\u307e\u6c38\u7d9a\u5316\u3057\u307e\u3059\u3002\u4eca\u56de\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u4fdd\u5b58\u306f\u884c\u3044\u307e\u305b\u3093\u3002TeacherActor\u304b\u3089\u3059\u3079\u3066\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\u3068\u6700\u5f8c\u306b\u6c38\u7d9a\u5316\u3057\u305f\u60c5\u5831\u3092\u51fa\u529b\u3057\u307e\u3059\u3002\n\n### \u5b9f\u884c\u7d50\u679c\uff1a\u6b63\u5e38\u5b9f\u884c\u6642\n\n```bat:log\nakka-message-delivery-reliability $sbt \"run-main school.akkapersistence.MathApp\"\n[TeacherActor] -  1 : 5 * 5 = ?\n[StudentActor] -  1 :  calculating ... 5 * 5 = 25\n[TeacherActor] -  2 : 1 * 9 = ?\n[StudentActor] -  2 :  calculating ... 1 * 9 = 9\n[TeacherActor] -  3 : 5 * 3 = ?\n[StudentActor] -  3 :  calculating ... 5 * 3 = 15\n[TeacherActor] -  4 : 2 * 6 = ?\n[StudentActor] -  4 :  calculating ... 2 * 6 = 12\n[TeacherActor] -  5 : 4 * 3 = ?\n[StudentActor] -  5 :  calculating ... 4 * 3 = 12\n[StudentActor] -   result = List(1, 2, 3, 4, 5)\n```\n\n\u6700\u5f8c\u306bStudentActor\u3067\u8a08\u7b97\u554f\u984c\u306b\u56de\u7b54\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8No\u304c\u51fa\u529b\u3055\u308c1,2,3,4,5\u3068\u51685\u554f\u3092\u89e3\u3044\u305f\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\n\u3067\u306f\u3001StudentActor\u3092\u9014\u4e2d\u3067\u30c0\u30a6\u30f3\u3055\u305b\u3066\u307f\u307e\u3059\u3002StudentActor\u3092Ctrl+C\u3067\u5f37\u5f15\u306b\u843d\u3057\u3066\u307f\u308b\u3068\u3001StudentActor\u304c\u30c0\u30a6\u30f3\u3057\u3066\u3044\u308b\u9593\u306b\u9001\u4fe1\u3055\u308c\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u306fDeadLetter\u3068\u306a\u308a\u3001\u518d\u5ea6\u8d77\u52d5\u3055\u305b\u308b\u3068\u3001\u4f55\u4e8b\u3082\u306a\u304b\u3063\u305f\u304b\u306e\u3088\u3046\u306b\u8d77\u52d5\u5f8c\u306b\u9001\u4fe1\u3055\u308c\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u51e6\u7406\u3057\u306f\u3058\u3081\u307e\u3059\u3002\n\n### \u5b9f\u884c\u7d50\u679c\uff1a\u969c\u5bb3\u767a\u751f\u6642\n\n* TeacherActor\n\n```bat:log\nakka-message-delivery-reliability $sbt \"run-main school.akkapersistence.MathApp teacher\"\n[TeacherActor] -  1 : 5 * 8 = ?\n[ReliableDeliverySupervisor] - Association with remote system [akka.tcp://StudentSystem@127.0.0.1:2552] has failed, address is now gated for [5000] ms. Reason: [Disassociated]\n[TeacherActor] -  2 : 1 * 7 = ?\n[RemoteActorRefProvider$RemoteDeadLetterActorRef] - Message [school.akkapersistence.StudentActor$Msg] from Actor[akka://TeacherSystem/user/teacherActor#108113105] to Actor[akka://TeacherSystem/deadLetters] was not delivered. [1] dead letters encountered. This logging can be turned off or adjusted with configuration settings 'akka.log-dead-letters' and 'akka.log-dead-letters-during-shutdown'.\n[TeacherActor] -  3 : 1 * 6 = ?\n[RemoteActorRefProvider$RemoteDeadLetterActorRef] - Message [school.akkapersistence.StudentActor$Msg] from Actor[akka://TeacherSystem/user/teacherActor#108113105] to Actor[akka://TeacherSystem/deadLetters] was not delivered. [2] dead letters encountered. This logging can be turned off or adjusted with configuration settings 'akka.log-dead-letters' and 'akka.log-dead-letters-during-shutdown'.\n[TeacherActor] -  4 : 2 * 3 = ?\n[TeacherActor] -  5 : 7 * 3 = ?\n```\n\n* StudentActor\n\n```bat:log\nakka-message-delivery-reliability $sbt \"run-main school.akkapersistence.MathApp student\"\n[StudentActor] -  1 :  calculating ... 5 * 8 = 40\n^Cakka-message-delivery-reliability $sbt \"run-main school.akkapersistence.MathApp student\"\n[StudentActor] -  4 :  calculating ... 2 * 3 = 6\n[StudentActor] -  5 :  calculating ... 7 * 3 = 21\n[StudentActor] -   result = List(1, 4, 5)\n```\n\n1\u4ef6\u76ee\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u305f\u5f8c\u3001StudentActor\u3092\u30b9\u30c8\u30c3\u30d7\u3055\u305b\u3001\u3059\u3050\u306b\u8d77\u52d5\u3057\u307e\u3057\u305f\u3002\u5b9f\u884c\u7d50\u679c\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001StudentActor\u304c\u30c0\u30a6\u30f3\u3057\u3066\u3044\u305f\u9593\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u300c2 : 1 * 7 = ?\u300d\u3068\u300c3 : 1 * 6 = ?\u300d\u306f\u51e6\u7406\u3055\u308c\u3066\u304a\u3089\u305a\uff08\u6c38\u7d9a\u5316\u3055\u308c\u3066\u3044\u306a\u3044\uff09\u30ed\u30b9\u30c8\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\nAkka\u3067\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5b9f\u88c5\u306f\u6700\u3082\u8efd\u91cf\u306aat-most-once\u3067\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3067\u3059\u3002at-most-once\u306f\u6700\u59271\u56de\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3057\u3001\u4eca\u56de\u306e\u3088\u3046\u306b\u3001\u72b6\u6cc1\u306b\u3088\u3063\u3066\u306f\u5c4a\u304b\u306a\u3044\u3068\u3044\u3046\u4e8b\u614b\u304c\u767a\u751f\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n![at-most-once2.png](https://qiita-image-store.s3.amazonaws.com/0/19438/0ac2e9c5-926c-59cc-7591-f9e0eafffc67.png)\n\n## at-least-once\n\nStudentActor\u304c\u30c0\u30a6\u30f3\u3057\u3066\u3044\u308b\u9593\u306b\u9001\u3089\u308c\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u30ed\u30b9\u30c8\u305b\u305a\u3001\u5fc5\u305a\u9001\u308a\u5c4a\u3051\u308b\u3068\u3044\u3046\u306e\u304cat-least-once\u3067\u3059\u3002Akka\u306b\u306f[AtLeasetOnceDelively](http://doc.akka.io/docs/akka/snapshot/scala/persistence.html#At-Least-Once_Delivery)\u3068\u3044\u3046\u30c8\u30ec\u30a4\u30c8\u304c\u3042\u308b\u306e\u3067\u3001TeacherActor\u306fActor\u30c8\u30ec\u30a4\u30c8\u306e\u4ee3\u308f\u308a\u306bAtLeastOnceDelivery\u30c8\u30ec\u30a4\u30c8\u3092\u30df\u30c3\u30af\u30b9\u30a4\u30f3\u3057\u307e\u3059\u3002\n\n### \u5b9f\u88c5\n\n* TeacherActor\u306e\u5b9f\u88c5\n\n```scala:TeacherActor\nclass TeacherActor(destination: ActorSelection) extends ActorLogging with AtLeastOnceDelivery {\n\n  def persistenceId: String = \"teacher-id-1\"\n\n  def receiveCommand: Receive = {\n    case CreateExercise =>\n      exerciseId += 1\n      self ! Exercise(exerciseId, Multiply(Random.nextInt(9) + 1, Random.nextInt(9) + 1))\n\n    case Exercise(exerciseId, multiply) if (exerciseId > 5) =>\n      scheduler.cancel()\n      student ! \"print\"\n\n    case Exercise(_, multiply) =>\n      persist(MsgSent(multiply))(updateState)\n\n    case Confirm(deliveryId) =>\n      log.info(s\" $deliveryId :   received\")\n      persist(MsgConfirmed(deliveryId))(updateState)\n\n    case UnconfirmedWarning(metadata) =>\n      log.warning(s\"  unconfirmedWarning[$metadata]\")\n  }\n\n  val receiveRecover: Receive = Actor.emptyBehavior\n\n  def updateState(evt: Evt): Unit = evt match {\n    case sent: MsgSent =>\n      deliver(student) { deliveryId =>\n        log.info(s\" $deliveryId : ${sent.multiply} = ?\")\n        state = state.updated(sent)\n        StudentActor.Msg(deliveryId, sent.multiply)\n      }\n    case confirm: MsgConfirmed => confirmDelivery(confirm.deliveryId)\n  }\n\n}\n```\n\nAtLeastOnceDelivery\u30c8\u30ec\u30a4\u30c8\u306fPersistentActor\u30c8\u30ec\u30a4\u30c8\u3092\u30df\u30c3\u30af\u30b9\u30a4\u30f3\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u3001StudentActor\u3068\u540c\u69d8\u306bpersistenceId\u3001receiveCommand\u3001receiveRecover\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002AtLeastOnceDelivery\uff08PersistentActor\uff09\u3092\u4f7f\u7528\u3059\u308b\u3068\u304d\u306f\u3001\u300c!\u300d\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001persist\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u6c38\u7d9a\u5316\u3057\u3001AtLeastOnceDelivery#deliver()\u3067\u9001\u4fe1\u3057\u307e\u3059\u3002\u9001\u4fe1\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u304cStudentActor\u306b\u5c4a\u3044\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u305f\u3081\u3001Confirm\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u3001persist\uff08\u6c38\u7d9a\u5316\uff09\u3057\u307e\u3059\u3002\n\n* StudentActor\u306e\u5b9f\u88c5\n\n```scala:StudentActor\n  def receiveCommand: Receive = {\n    case Msg(deliveryId, Multiply(n1, n2)) =>\n      log.info(s\" $deliveryId :  calculating ... ${Multiply(n1, n2)} = ${n1 * n2}\")\n      persist(Msg(deliveryId, Multiply(n1, n2)))(updateState)\n      sender() ! TeacherActor.Confirm(deliveryId)\n    case \"print\" => log.info(s\"  $state\")\n  }\n```\n\nStudentActor\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u305f\u5f8c\u3001sender()\u306b\u5bfe\u3057\u3066\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u308a\u3001TeacherActor\u3067\u53d7\u4fe1\u3057\u307e\u3059\u3002\u4e00\u5b9a\u6642\u9593\u5185\uff08[\u30c7\u30d5\u30a9\u30eb\u30c85\u79d2](https://github.com/akka/akka/blob/master/akka-persistence/src/main/resources/reference.conf#L49)\uff09\u306b\u53d7\u4fe1\u3067\u304d\u306a\u304b\u3063\u305f\u5834\u5408\u306f\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u518d\u9001\u3057\u307e\u3059\u3002\u3053\u306e\u4ed5\u7d44\u307f\u306b\u3088\u308a\u3001StudentActor\u304c\u30c0\u30a6\u30f3\u3057\u3066\u3044\u3066\u3082\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u304f\u307e\u3067(\u5f53\u7136\u4e0a\u9650\u306f\u3042\u308a\u307e\u3059\u304c)\u518d\u9001\u3092\u7e70\u308a\u8fd4\u3059\u3053\u3068\u306b\u3088\u308a\u3001\u5fc5\u305a\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51e6\u7406\u3055\u308c\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002AtLeastOnceDelivery\u3092\u4f7f\u3046\u3068\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5074\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u5230\u9054\u78ba\u8a8d\u3084\u518d\u9001\u3092\u5b9f\u88c5\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n\u3067\u306f\u3001\u52d5\u304d\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n### \u5b9f\u884c\u7d50\u679c\n\n* TeacherActor\n\n```bat:log\nakka-message-delivery-reliability $sbt \"run-main school.atleastonce.MathApp teacher\"\n[TeacherActor] -  1 : 6 * 5 = ?\n[TeacherActor] -  1 :   received\n[ReliableDeliverySupervisor] - Association with remote system [akka.tcp://StudentSystem@127.0.0.1:2552] has failed, address is now gated for [5000] ms. Reason: [Disassociated]\n[TeacherActor] -  2 : 8 * 4 = ?\n[ReliableDeliverySupervisor] - Association with remote system [akka.tcp://StudentSystem@127.0.0.1:2552] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://StudentSystem@127.0.0.1:2552]] Caused by: [Connection refused: /127.0.0.1:2552]\n[RemoteActorRefProvider$RemoteDeadLetterActorRef] - Message [school.atleastonce.StudentActor$Msg] from Actor[akka://TeacherSystem/user/teacherActor#-885507212] to Actor[akka://TeacherSystem/deadLetters] was not delivered. [1] dead letters encountered. This logging can be turned off or adjusted with configuration settings 'akka.log-dead-letters' and 'akka.log-dead-letters-during-shutdown'.\n[ReliableDeliverySupervisor] - Association with remote system [akka.tcp://StudentSystem@127.0.0.1:2552] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://StudentSystem@127.0.0.1:2552]] Caused by: [Connection refused: /127.0.0.1:2552]\n[RemoteActorRefProvider$RemoteDeadLetterActorRef] - Message [school.atleastonce.StudentActor$Msg] from Actor[akka://TeacherSystem/user/teacherActor#-885507212] to Actor[akka://TeacherSystem/deadLetters] was not delivered. [2] dead letters encountered. This logging can be turned off or adjusted with configuration settings 'akka.log-dead-letters' and 'akka.log-dead-letters-during-shutdown'.\n[TeacherActor] -  3 : 8 * 6 = ?\n[RemoteActorRefProvider$RemoteDeadLetterActorRef] - Message [school.atleastonce.StudentActor$Msg] from Actor[akka://TeacherSystem/user/teacherActor#-885507212] to Actor[akka://TeacherSystem/deadLetters] was not delivered. [3] dead letters encountered. This logging can be turned off or adjusted with configuration settings 'akka.log-dead-letters' and 'akka.log-dead-letters-during-shutdown'.\n[RemoteActorRefProvider$RemoteDeadLetterActorRef] - Message [school.atleastonce.StudentActor$Msg] from Actor[akka://TeacherSystem/user/teacherActor#-885507212] to Actor[akka://TeacherSystem/deadLetters] was not delivered. [4] dead letters encountered. This logging can be turned off or adjusted with configuration settings 'akka.log-dead-letters' and 'akka.log-dead-letters-during-shutdown'.\n[TeacherActor] -  3 :   received\n[TeacherActor] -  2 :   received\n[TeacherActor] -  4 : 6 * 7 = ?\n[TeacherActor] -  4 :   received\n[TeacherActor] -  5 : 4 * 4 = ?\n[TeacherActor] -  5 :   received\n```\n\n* StudentActor\n\n```bat:log\nakka-message-delivery-reliability $sbt \"run-main school.atleastonce.MathApp student\"\n[StudentActor] -  1 :  calculating ... 6 * 5 = 30\n^Cakka-message-delivery-reliability $sbt \"run-main school.atleastonce.MathApp student\"\n[StudentActor] -  3 :  calculating ... 8 * 6 = 48\n[StudentActor] -  2 :  calculating ... 8 * 4 = 32\n[StudentActor] -  4 :  calculating ... 6 * 7 = 42\n[StudentActor] -  5 :  calculating ... 4 * 4 = 16\n[StudentActor] -   result = List(1, 3, 2, 4, 5)\n```\n\n2\u3064\u306eActor\u30b7\u30b9\u30c6\u30e0\u3092\u8d77\u52d5\u3057\u3001\u5148\u307b\u3069\u3068\u540c\u3058\u3088\u3046\u306b\u9014\u4e2d\u3067StudentActor\u3092\u30b9\u30c8\u30c3\u30d7\u3055\u305b\u3066\u307f\u307e\u3057\u305f\u3002StudentActor\u304c\u30c0\u30a6\u30f3\u3057\u3066\u3044\u308b\u9593\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306fDeadLetter\u306b\u306a\u308a\u307e\u3059\u3002StudentActor\u3092\u518d\u3073\u8d77\u52d5\u3055\u305b\u308b\u3068\u30c0\u30a6\u30f3\u3057\u3066\u3044\u305f\u9593\u306b\u9001\u3089\u308c\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u300c2 : 8 * 4 = ?\u300d\u3068\u300c3 : 8 * 6 = ?\u300d\u3092\u53d7\u4fe1\u3057\u3064\u3064\u3001\u65b0\u305f\u306b\u9001\u3089\u308c\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u300c4 : 6 * 7 = ?\u300d\u3068\u300c5 : 4 * 4 = ?\u300d\u3082\u51e6\u7406\u3057\u307e\u3057\u305f\u3002TeacherActor\u3092\u898b\u308b\u3068StudentActor\u304c\u30c0\u30a6\u30f3\u3057\u3066\u3044\u9593\u306f\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u53d7\u4fe1\u3067\u304d\u305a\u3001\u518d\u958b\u5f8c\u306b\u307e\u3068\u3081\u3066\u53d7\u4fe1\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u3053\u306e\u5834\u5408\u9806\u5e8f\u306f\u4fdd\u8a3c\u3055\u308c\u306a\u3044\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002\u3053\u308c\u3067at-least-once\u304c\u5b9f\u73fe\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\n![at-least-once1.png](https://qiita-image-store.s3.amazonaws.com/0/19438/1c392866-6a83-dcd0-82be-95b5a246ddb4.png)\n\n\n## exactly-once\n\n\u6b21\u306b\u3001\u3082\u3057StudentActor\u304b\u3089\u9001\u3089\u308c\u308b\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u304b\u306a\u304b\u3063\u305f\u5834\u5408\u306b\u3069\u3046\u306a\u308b\u304b\u3092\u8003\u3048\u3066\u307f\u307e\u3059\u3002\nAtLeastOnceDelivery\u3067\u306f\u3001\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u305f\u3053\u3068\u3067\u9001\u4fe1\u5148\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u3044\u305f\u3053\u3068\u3092\u8a8d\u8b58\u3059\u308b\u306e\u3067\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u969c\u5bb3\u7b49\u3067\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3067\u304d\u306a\u304b\u3063\u305f\u72b6\u614b\u3092\u64ec\u4f3c\u7684\u306b\u8d77\u3053\u3059\u305f\u3081\u3001\u30e9\u30f3\u30c0\u30e0\u306b\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u53d7\u4fe1\u3092\u5931\u6557\u3055\u305b\u3066\u307f\u307e\u3059\u3002\n\n### \u5b9f\u88c5\n\n* TeacherActor\n\n```scala:TeacherActor\n    case Confirm(deliveryId) =>\n      // \u30c7\u30ea\u30d0\u30ea\u30fcID\u304c\u5076\u6570\u306e\u5834\u5408\u30011/2\u306e\u78ba\u7387\u3067\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3067\u304d\u306a\u3044\n      if (deliveryId % 2 == 0 && Random.nextInt(2) == 0) {\n        log.info(s\" $deliveryId :   lost confirmation message\")\n      } else {\n        log.info(s\" $deliveryId :   received\")\n        persist(MsgConfirmed(deliveryId))(updateState)\n      }\n```\n\n\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u306f2\u5206\u306e1\u306e\u78ba\u7387\u3067\u53d7\u4fe1\u306b\u5931\u6557\u3057\u3001\u300clost confirmation message\u300d\u3068\u3044\u3046\u30ed\u30b0\u3092\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n### \u5b9f\u884c\u7d50\u679c\n\n```bat:log\nakka-message-delivery-reliability $sbt \"run-main school.atleastonce.MathApp\"\n[TeacherActor] -  1 : 9 * 8 = ?\n[StudentActor] -  1 :  calculating ... 9 * 8 = 72\n[TeacherActor] -  1 :   received\n[TeacherActor] -  2 : 8 * 7 = ?\n[StudentActor] -  2 :  calculating ... 8 * 7 = 56\n[TeacherActor] -  2 :   lost confirmation message\n[TeacherActor] -  3 : 6 * 2 = ?\n[StudentActor] -  3 :  calculating ... 6 * 2 = 12\n[TeacherActor] -  3 :   received\n[StudentActor] -  2 :  calculating ... 8 * 7 = 56\n[TeacherActor] -  2 :   received\n[TeacherActor] -  4 : 8 * 4 = ?\n[StudentActor] -  4 :  calculating ... 8 * 4 = 32\n[TeacherActor] -  4 :   received\n[TeacherActor] -  5 : 2 * 3 = ?\n[StudentActor] -  5 :  calculating ... 2 * 3 = 6\n[TeacherActor] -  5 :   received\n[StudentActor] -   result = List(1, 2, 3, 2, 4, 5)\n```\n\n2\u756a\u76ee\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u300c2 : 8 * 7 = ?\u300d\u306b\u6ce8\u76ee\u3057\u3066\u4e0b\u3055\u3044\u3002TeacherActor\u306f\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u53d7\u4fe1\u306b\u5931\u6557\uff08lost confirmation message\uff09\u3057\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u518d\u9001\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308aStudentActor\u306f\u540c\u3058\u554f\u984c\u3092\uff12\u5ea6\u89e3\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u6700\u7d42\u884c\u306e\u51e6\u7406\u6e08\u30c7\u30fc\u30bf\u304b\u3089\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\u5b9f\u969b\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u5c4a\u3044\u3066\u3044\u305f\u306e\u306b\u3001\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u53d7\u4fe1\u306b\u5931\u6557\u3057\u305f\u3060\u3051\u306a\u306e\u3067\u3001\u518d\u9001\u3059\u308b\u3053\u3068\u306b\u3088\u308a\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u91cd\u8907\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002AtLeastOnceDelivery\u3067\u306f\u3001\u5c11\u306a\u304f\u3068\u30821\u5ea6\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u304f\u3053\u3068\u3092\u4fdd\u8a3c\u3057\u307e\u3059\u304c\u3001\u6b63\u78ba\u306b1\u56de\u306e\u307f\u5c4a\u304f\u3053\u3068\u306f\u4fdd\u8a3c\u3055\u308c\u307e\u305b\u3093\u3002exactly-once\u3067\u306f\u306a\u3044\u306e\u3067\u3059\u3002\n\n![at-least-once2.png](https://qiita-image-store.s3.amazonaws.com/0/19438/e46632ac-fbcc-fe37-7c64-f7aeaa07ee9a.png)\n\n\nexactly-once\u3092\u5b9f\u73fe\u3059\u308b\u305f\u3081\u306b\u3001StudentActor\u3067\u91cd\u8907\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u51e6\u7406\u3057\u306a\u3044\u3088\u3046\u306b\u3057\u307e\u3059\u3002\u4eca\u56de\u53d7\u4fe1\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u30af\u30ea\u30a2\u51e6\u7406\u306f\u8003\u3048\u305a\u3001\u30b7\u30f3\u30d7\u30eb\u306b\u84c4\u7a4d\u3057\u305f\u60c5\u5831\u306e\u4e2d\u306b\u914d\u4fe1\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5b58\u5728\u3057\u305f\u5834\u5408\u306f\u3001\u91cd\u8907\u3068\u5224\u65ad\u3057\u307e\u3059\u3002\n\n* StudentActor\u306e\u5b9f\u88c5\n\n```scala:StudentActor\n    case Msg(deliveryId, Multiply(n1, n2)) =>\n      if (state.contains(Msg(deliveryId, Multiply(n1, n2))))\n        log.info(s\" $deliveryId :  already calculated\")\n      else {\n        log.info(s\" $deliveryId :  calculating ... ${Multiply(n1, n2)} = ${n1 * n2}\")\n        persist(Msg(deliveryId, Multiply(n1, n2)))(updateState)\n      }\n      sender() ! TeacherActor.Confirm(deliveryId)\n```\n\n\u6c38\u7d9a\u5316\u306e\u305f\u3081\u306b\u84c4\u7a4d\u3057\u305fstate\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u306f\u3001\u91cd\u8907\u30e1\u30c3\u30bb\u30fc\u30b8\u3068\u5224\u65ad\u3057\u3001\u8a08\u7b97\u51e6\u7406\u3092\u884c\u3044\u307e\u305b\u3093\uff08\u30ed\u30b0\u306b\u300calready calculated\u300d\u3092\u51fa\u529b\uff09\u3002\n\n### \u5b9f\u884c\u7d50\u679c\n\n```bat:log\nakka-message-delivery-reliability $sbt \"run-main school.exactlyonce.MathApp\"\n[TeacherActor] -  1 : 7 * 6 = ?\n[StudentActor] -  1 :  calculating ... 7 * 6 = 42\n[TeacherActor] -  1 :   received\n[TeacherActor] -  2 : 1 * 6 = ?\n[StudentActor] -  2 :  calculating ... 1 * 6 = 6\n[TeacherActor] -  2 :   lost confirmation message\n[TeacherActor] -  3 : 5 * 7 = ?\n[StudentActor] -  3 :  calculating ... 5 * 7 = 35\n[TeacherActor] -  3 :   received\n[StudentActor] -  2 :  already calculated\n[TeacherActor] -  2 :   received\n[TeacherActor] -  4 : 1 * 6 = ?\n[StudentActor] -  4 :  calculating ... 1 * 6 = 6\n[TeacherActor] -  4 :   received\n[TeacherActor] -  5 : 8 * 8 = ?\n[StudentActor] -  5 :  calculating ... 8 * 8 = 64\n[TeacherActor] -  5 :   received\n[StudentActor] -   result = List(1, 2, 3, 4, 5)\n```\n\n\n\u3053\u308c\u3067exactly-once\u304c\u5b9f\u88c5\u3067\u304d\u307e\u3057\u305f\u3002\uff12\u756a\u76ee\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u300c2 : 1 * 6 = ?\u300d\u306fTeacherActor\u3067\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u53d7\u4fe1\u306b\u5931\u6557\u3057\u3001\u518d\u9001\u3057\u3066\u3044\u307e\u3059\u304c\u3001StudentActor\u3067\u91cd\u8907\u30e1\u30c3\u30bb\u30fc\u30b8\u3068\u5224\u65ad\u3057\u8a08\u7b97\u3092\u884c\u3063\u3066\u3044\u307e\u305b\u3093\u3002\u5148\u751f\u304b\u3089\u51fa\u3055\u308c\u305f\u554f\u984c\u306f\u305f\u3060\u4e00\u5ea6\u3060\u3051\u751f\u5f92\u304c\u89e3\u304f\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n![exactly-once1.png](https://qiita-image-store.s3.amazonaws.com/0/19438/406152d1-999d-d820-7058-3e5d0d9f5025.png)\n\n\u6700\u5f8c\u306b\u3001StudentActor\u304c\u30c0\u30a6\u30f3\u3057\u305f\u3068\u304d\u306e\u52d5\u4f5c\u3082\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n### \u5b9f\u884c\u7d50\u679c\n\n* TeacherActor\n\n```bat:log\nakka-message-delivery-reliability $sbt \"run-main school.exactlyonce.MathApp teacher\"\n[TeacherActor] -  1 : 4 * 9 = ?\n[TeacherActor] -  1 :   received\n[ReliableDeliverySupervisor] - Association with remote system [akka.tcp://StudentSystem@127.0.0.1:2552] has failed, address is now gated for [5000] ms. Reason: [Disassociated]\n[TeacherActor] -  2 : 6 * 1 = ?\n[ReliableDeliverySupervisor] - Association with remote system [akka.tcp://StudentSystem@127.0.0.1:2552] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://StudentSystem@127.0.0.1:2552]] Caused by: [Connection refused: /127.0.0.1:2552]\n[RemoteActorRefProvider$RemoteDeadLetterActorRef] - Message [school.exactlyonce.StudentActor$Msg] from Actor[akka://TeacherSystem/user/teacherActor#79590160] to Actor[akka://TeacherSystem/deadLetters] was not delivered. [1] dead letters encountered. This logging can be turned off or adjusted with configuration settings 'akka.log-dead-letters' and 'akka.log-dead-letters-during-shutdown'.\n[ReliableDeliverySupervisor] - Association with remote system [akka.tcp://StudentSystem@127.0.0.1:2552] has failed, address is now gated for [5000] ms. Reason: [Association failed with [akka.tcp://StudentSystem@127.0.0.1:2552]] Caused by: [Connection refused: /127.0.0.1:2552]\n[RemoteActorRefProvider$RemoteDeadLetterActorRef] - Message [school.exactlyonce.StudentActor$Msg] from Actor[akka://TeacherSystem/user/teacherActor#79590160] to Actor[akka://TeacherSystem/deadLetters] was not delivered. [2] dead letters encountered. This logging can be turned off or adjusted with configuration settings 'akka.log-dead-letters' and 'akka.log-dead-letters-during-shutdown'.\n[TeacherActor] -  3 : 2 * 1 = ?\n[RemoteActorRefProvider$RemoteDeadLetterActorRef] - Message [school.exactlyonce.StudentActor$Msg] from Actor[akka://TeacherSystem/user/teacherActor#79590160] to Actor[akka://TeacherSystem/deadLetters] was not delivered. [3] dead letters encountered. This logging can be turned off or adjusted with configuration settings 'akka.log-dead-letters' and 'akka.log-dead-letters-during-shutdown'.\n[TeacherActor] -  2 :   lost confirmation message\n[TeacherActor] -  3 :   received\n[TeacherActor] -  2 :   received\n[TeacherActor] -  4 : 9 * 4 = ?\n[TeacherActor] -  4 :   lost confirmation message\n[TeacherActor] -  4 :   lost confirmation message\n[TeacherActor] -  5 : 7 * 5 = ?\n[TeacherActor] -  5 :   received\n[TeacherActor] -  4 :   received\n\n```\n\n* StudentActor\n\n```bat:log\nakka-message-delivery-reliability $sbt \"run-main school.exactlyonce.MathApp student\"\n[StudentActor] -  1 :  calculating ... 4 * 9 = 36\n^Cakka-message-delivery-reliability $sbt \"run-main school.exactlyonce.MathApp student\"\n[StudentActor] -  2 :  calculating ... 6 * 1 = 6\n[StudentActor] -  3 :  calculating ... 2 * 1 = 2\n[StudentActor] -  2 :  already calculated\n[StudentActor] -  4 :  calculating ... 9 * 4 = 36\n[StudentActor] -  4 :  already calculated\n[StudentActor] -  5 :  calculating ... 7 * 5 = 35\n[StudentActor] -  4 :  already calculated\n[StudentActor] -   result = List(1, 2, 3, 4, 5)\n```\n\n\uff11\u756a\u76ee\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u300c1 : 7 * 6 = ?\u300d\u3092\u53d7\u4fe1\u3057\u305f\u5f8c\u3001StudetnActor\u3092\u30c0\u30a6\u30f3\u3055\u305b\u307e\u3057\u305f\u304c\u3001\u6700\u7d42\u7684\u306bTeacherActor\u304b\u3089\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u91cd\u8907\u306a\u304f\u5fc5\u305a\u4e00\u5ea6\u51e6\u7406\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\n## \u304a\u308f\u308a\u306b\n\nat-most-once\u3001at-least-once\u3001exactly-once\u3068\u9806\u306b\u5b9f\u88c5\u3001\u51e6\u7406\u30b3\u30b9\u30c8\uff08\u3084\u308a\u53d6\u308a\u3059\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u6570\uff09\u304c\u5171\u306b\u5897\u3048\u3066\u3044\u304d\u307e\u3057\u305f\u3002Akka\u304c\u4e00\u756a\u5f97\u610f\u3068\u3059\u308b\u306e\u306fat-most-once\u3067\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066AtLeastOnceDelivery\u30c8\u30ec\u30a4\u30c8\u3092\u4f7f\u3063\u3066at-least-once\u3092\u5b9f\u88c5\u3057\u3001exactly-once\u306f\u696d\u52d9\u306b\u7279\u5316\u3057\u305fID\u7b49\u3092\u7528\u3044\u3066\u91cd\u8907\u6392\u9664\u3092\u5b9f\u88c5\u3059\u308b\u306e\u304c\u826f\u3055\u305d\u3046\u3067\u3059\u3002\n\n| No | \u7a2e\u985e | \u5b9f\u88c5\u65b9\u6cd5 |\n| ---:| ---- | ----|\n| 1 | **at-most-once** |Akka\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5b9f\u88c5|\n| 2 | **at-least-once** |AtLeastOnceDelivery\u3092\u4f7f\u3063\u3066<br>\u5230\u9054\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u3051\u53d6\u308a|\n| 3 | **exactly-once** |2\u306e\u5bfe\u5fdc\u3092\u884c\u3063\u305f\u4e0a\u3067\u696d\u52d9ID\u3092<br>\u7528\u3044\u3066\u91cd\u8907\u6392\u9664|\n\n\u3053\u306e\u3042\u305f\u308a\u306f\u3001[Message Delivery Reliability-Discussion: Why No Guaranteed Delivery?](http://doc.akka.io/docs/akka/snapshot/general/message-delivery-reliability.html#Discussion__Why_No_Guaranteed_Delivery_)\u3068\u304b\u3001\u305d\u3053\u304b\u3089\u30ea\u30f3\u30af\u306e\u8cbc\u3089\u308c\u3066\u3044\u308b[Nobody Needs Reliable Messaging](http://www.infoq.com/articles/no-reliable-messaging)\u306b\u8a73\u3057\u304f\u66f8\u304b\u308c\u3066\u3044\u307e\u3059\u3002[Nobody Needs Reliable Messaging](http://www.infoq.com/articles/no-reliable-messaging)\u306b\u3042\u308b\u3088\u3046\u306b\u3001\u300c\u51e6\u65b9\u7b8bID\u300d\u306e\u3088\u3046\u306a\u696d\u52d9ID\u306f\u5fc5\u305a\u5b58\u5728\u3059\u308b\u3057\u3001\u66f4\u65b0\u51e6\u7406\u7b49\u3092\u4f34\u3046\u5834\u5408\u306f\u5fc5\u305a\u91cd\u8907\u30c1\u30a7\u30c3\u30af\u306f\u5b9f\u88c5\u3059\u308b\u3082\u306e\u306a\u306e\u3067\u3001\u91cd\u8907\u306e\u6392\u9664\u306f\u696d\u52d9\u5074\u3067\u5b9f\u88c5\u3059\u3079\u304d\u3060\u3068\u8003\u3048\u3089\u308c\u307e\u3059\u3002Akka\u5074\u3067\u3084\u308d\u3046\u3068\u3059\u308b\u3068\u4f59\u8a08\u306a\u30b3\u30b9\u30c8\u304c\u304b\u304b\u3063\u3066\u3057\u307e\u3044\u305d\u3046\u3067\u3059\u3057\u3002\n\n\n\u3068\u3044\u3046\u308f\u3051\u3067\u3001\u4eca\u56de\u306fAkka\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u4fe1\u983c\u6027\u306b\u3064\u3044\u3066\u8003\u3048\u3066\u3044\u307e\u3057\u305f\u3002\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u4fe1\u983c\u5ea6\u3092\u4e0a\u3052\u3001\u78ba\u5b9f\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u306e\u5b9f\u88c5\u304c\u3067\u304d\u3001\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba\u306e\u304c\u3063\u3061\u308a\u306a\u5834\u9762\u3067\u3082\u5229\u7528\u3067\u304d\u308b\u3053\u3068\u304c\u304a\u5206\u304b\u308a\u9802\u3051\u305f\u3053\u3068\u3067\u3057\u3087\u3046\u3002\n\n\u8aac\u660e\u3067\u4f7f\u7528\u3057\u305f\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u5168\u4f53\u306f[GitHub](https://github.com/yugolf/akka-message-delivery-reliability)\u3067\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002\n\u5b9f\u88c5\u306b\u3042\u305f\u308a\u3001[Typesafe Activator](https://www.typesafe.com/activator/templates)\u306e\uff12\u3064\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\n\n* [AKKA REMOTE SAMPLES WITH SCALA](http://www.typesafe.com/activator/template/akka-sample-remote-scala)\n* [AKKA PERSISTENCE SAMPLES WITH SCALA](http://www.typesafe.com/activator/template/akka-sample-persistence-scala)\n", "tags": ["Akka", "Scala", "\u30ea\u30a2\u30af\u30c6\u30a3\u30d6", "actor", "akka-persistence"]}