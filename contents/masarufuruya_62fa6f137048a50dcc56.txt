{"tags": ["PHP", "CakePHP", "PHPUnit"], "context": " More than 1 year has passed since last update.\n\n\u30e2\u30c7\u30eb\u3092\u4f5c\u6210\n\napp/Model/Article.php\u3092\u4f5c\u6210\n\n<?php\nclass Article extends AppModel {\n    public function published($fields = null) {\n        $params = array(\n            'conditions' => array(\n                $this->name . '.published' => 1\n            ),\n            'fields' => $fields\n        );\n\n        return $this->find('all', $params);\n    }\n}\n\n\n\u30d5\u30a3\u30af\u30b9\u30c1\u30e3\u3092\u4f5c\u6210\n\n\u30c6\u30b9\u30c8\u306b\u4f7f\u3046\u305f\u3081\u306e\u4e00\u6642\u7684\u306a\u30c7\u30fc\u30bf\u3092\u30ed\u30fc\u30c9\u3059\u308b\u305f\u3081\u306e\u3082\u306e\n\u5b9f\u30c7\u30fc\u30bf\u3092\u4f7f\u308f\u305a\u306b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304c\u5fc5\u8981\u306a\u6a5f\u80fd\u3092\u30c6\u30b9\u30c8\u3067\u304d\u308b\napp/Test/Fixture\u914d\u4e0b\u306b\u4f5c\u6210\u3059\u308b([Model\u540d]Fixture)\napp/Config/database.php\u306b\u3042\u308b$test\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u60c5\u5831\u3092\u4f7f\u3046\n\u30d5\u30a3\u30af\u30b9\u30c1\u30e3\u3067\u306f\u4ee5\u4e0b\u306e2\u70b9\u3092\u8a18\u8ff0\u3059\u308b\n\n\n\u30d5\u30a3\u30fc\u30eb\u30c9\u60c5\u5831\n\u521d\u671f\u72b6\u614b\u3067\u7528\u610f\u3059\u308b\u30ec\u30b3\u30fc\u30c9\u30c7\u30fc\u30bf\n\n\n\n<?php\nclass ArticleFixture extends CakeTestFixture {\n      public $fields = array(\n          'id' => array('type' => 'integer', 'key' => 'primary'),\n          'title' => array(\n            'type' => 'string',\n            'length' => 255,\n            'null' => false\n          ),\n          'body' => 'text',\n          'published' => array(\n            'type' => 'integer',\n            'default' => '0',\n            'null' => false\n          ),\n          'created' => 'datetime',\n          'updated' => 'datetime'\n      );\n      public $records = array(\n          array(\n            'id' => 1,\n            'title' => 'First Article',\n            'body' => 'First Article Body',\n            'published' => '1',\n            'created' => '2007-03-18 10:39:23',\n            'updated' => '2007-03-18 10:41:31'\n          ),\n          array(\n            'id' => 2,\n            'title' => 'Second Article',\n            'body' => 'Second Article Body',\n            'published' => '1',\n            'created' => '2007-03-18 10:41:23',\n            'updated' => '2007-03-18 10:43:31'\n          ),\n          array(\n            'id' => 3,\n            'title' => 'Third Article',\n            'body' => 'Third Article Body',\n            'published' => '1',\n            'created' => '2007-03-18 10:43:23',\n            'updated' => '2007-03-18 10:45:31'\n          )\n      );\n }\n\n\n\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u4ee5\u5916\u306e\u65e2\u5b58\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9(\u30c7\u30d5\u30a9\u30eb\u30c8\u30c6\u30fc\u30d6\u30eb)\u3092\u5229\u7528\u3057\u305f\u3044\u5834\u5408\n\n      //\u30c7\u30d5\u30a9\u30eb\u30c8\u30c6\u30fc\u30d6\u30eb\u306b\u5b58\u5728\u3059\u308b\u30c6\u30fc\u30d6\u30eb\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u60c5\u5831\u3092\u8aad\u307f\u8fbc\u3080\n      public $import = ['table' => 'articles'];\n      public $records = [];\n\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u3068\u65e2\u5b58\u30c6\u30fc\u30d6\u30eb\u306e\u69cb\u6210\u3092\u4f7f\u3063\u3066\u30c7\u30fc\u30bf\u304c\u751f\u6210\u3055\u308c\u308b\n\n\n\u30c6\u30b9\u30c8\u7528\u30af\u30e9\u30b9\u3092\u4f5c\u6210\n\napp/Test/Case/Model/[Model\u540d]Test.php\n\n<?php\n//\u30c6\u30b9\u30c8\u5bfe\u8c61\u306e\u30e2\u30c7\u30eb\u3092\u30a4\u30f3\u30dd\u30fc\u30c8\nApp::uses('Article', 'Model');\n//\u5916\u90e8\u30e9\u30a4\u30d6\u30e9\u30ea\nApp::uses('Fabricate', 'Fabricate.Lib');\n\nclass ArticleTest extends CakeTestCase {\n    public $fixtures = array('app.article');\n\n    //\u30c6\u30b9\u30c8\u5b9f\u884c\u524d\u306b\u6bce\u56de\u547c\u3070\u308c\u308b\n    public function setUp() {\n        //\u89aa\u306esetUp\u306f\u5fc5\u305a\u547c\u3073\u51fa\u3059\n        parent::setUp();\n    }\n\n    //testXX\u306e\u540d\u524d\u306b\u3059\u308b\n    public function testPublished() {\n        $expected = array(\n            array('Article' => array('id' => 1, 'title' => 'First Article')),\n            array('Article' => array('id' => 2, 'title' => 'Second Article')),\n            array('Article' => array('id' => 3, 'title' => 'Third Article'))\n        );\n        //\u30e2\u30c3\u30af\u3092\u4f7f\u3046\u30d1\u30bf\u30fc\u30f3\n        $model = $this->getMockForModel('Article', array('published'));\n        //\u5148\u306b\u547c\u3073\u51fa\u3059\u56de\u6570\u3068\u671f\u5f85\u3059\u308b\u5024\u3092\u30bb\u30c3\u30c8\n        $model\n            ->expects($this->once())\n            ->method('published')\n            ->will($this->returnValue($expected));\n        //\u5b9f\u884c\u3059\u308b\n        $result = $model->published(array('id', 'title'));\n\n        //\u30c6\u30fc\u30d6\u30eb\u306b\u30e2\u30c3\u30af\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3057\u3066\u7d50\u679c\u3092\u8fd4\u3059\u3002\u5b9f\u969b\u306e\u30c6\u30fc\u30d6\u30eb\u306b\u4fdd\u5b58\u3055\u308c\u308b\u308f\u3051\u3067\u306f\u306a\u3044\n        //\u4ef6\u6570\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f1\u4ef6\n        Fabricate::create('Article', function($data, $world) {\n            //\u53d6\u5f97\u7d50\u679c\u3092\u5909\u66f4\u3057\u305f\u308a\u51fa\u6765\u308b\n            return [\n                'id' => 1\n                'name' => 'test'\n            ];\n        });\n        $articles = $this->Article->find('all');\n    }\n}\n\n\n\u4e8b\u524d\u306b\u7528\u610f\u3057\u305f\u30c7\u30fc\u30bf\u3060\u3051\u3067\u30c6\u30b9\u30c8\u3059\u308b\u306e\u3067\u3042\u308c\u3070\u3001\u30d5\u30a3\u30af\u30b9\u30c1\u30e3\u3067\u30ec\u30b3\u30fc\u30c9\u3092\u7528\u610f\u3057\u3066\u304a\u304f\u3060\u3051\u3067\u3044\u3044\u304c\u3001\u81ea\u5206\u3067\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u8ffd\u52a0\u3057\u305f\u308a\u3057\u305f\u3044\u6642\u3082\u591a\u3044\n\u305d\u3093\u306a\u5834\u5408\u306f\u3053\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3046\u3002\u4f5c\u6210\u3055\u308c\u308b\u30c7\u30fc\u30bf\u306f\u30b9\u30ad\u30fc\u30de\u60c5\u5831\u304b\u3089\u81ea\u52d5\u5224\u5b9a\u3055\u308c\u3066\u9069\u5f53\u306a\u521d\u671f\u5024\u304c\u5165\u308b\n\u5024\u3092\u5909\u3048\u305f\u3044\u5834\u5408\u306f\u3001\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3067\u5909\u66f4\u304c\u53ef\u80fd\n\u4f5c\u6210\u3059\u308b\u4ef6\u6570\u306f\u7b2c\u4e8c\u5f15\u6570\u3067\u6307\u5b9a\u3067\u304d\u308b\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u306f1\u4ef6\nhttps://github.com/sizuhiko/Fabricate\n\n\n\n# \u30e2\u30c7\u30eb\u3092\u4f5c\u6210\n* app/Model/Article.php\u3092\u4f5c\u6210\n\n```php\n<?php\nclass Article extends AppModel {\n    public function published($fields = null) {\n        $params = array(\n            'conditions' => array(\n                $this->name . '.published' => 1\n            ),\n            'fields' => $fields\n        );\n\n        return $this->find('all', $params);\n    }\n}\n```\n\n# \u30d5\u30a3\u30af\u30b9\u30c1\u30e3\u3092\u4f5c\u6210\n* \u30c6\u30b9\u30c8\u306b\u4f7f\u3046\u305f\u3081\u306e\u4e00\u6642\u7684\u306a\u30c7\u30fc\u30bf\u3092\u30ed\u30fc\u30c9\u3059\u308b\u305f\u3081\u306e\u3082\u306e\n* \u5b9f\u30c7\u30fc\u30bf\u3092\u4f7f\u308f\u305a\u306b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304c\u5fc5\u8981\u306a\u6a5f\u80fd\u3092\u30c6\u30b9\u30c8\u3067\u304d\u308b\n* app/Test/Fixture\u914d\u4e0b\u306b\u4f5c\u6210\u3059\u308b([Model\u540d]Fixture)\n* app/Config/database.php\u306b\u3042\u308b$test\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u60c5\u5831\u3092\u4f7f\u3046\n* \u30d5\u30a3\u30af\u30b9\u30c1\u30e3\u3067\u306f\u4ee5\u4e0b\u306e2\u70b9\u3092\u8a18\u8ff0\u3059\u308b\n\t* \u30d5\u30a3\u30fc\u30eb\u30c9\u60c5\u5831\n\t* \u521d\u671f\u72b6\u614b\u3067\u7528\u610f\u3059\u308b\u30ec\u30b3\u30fc\u30c9\u30c7\u30fc\u30bf\n\n```php\n<?php\nclass ArticleFixture extends CakeTestFixture {\n  \t  public $fields = array(\n          'id' => array('type' => 'integer', 'key' => 'primary'),\n          'title' => array(\n            'type' => 'string',\n            'length' => 255,\n            'null' => false\n          ),\n          'body' => 'text',\n          'published' => array(\n            'type' => 'integer',\n            'default' => '0',\n            'null' => false\n          ),\n          'created' => 'datetime',\n          'updated' => 'datetime'\n      );\n      public $records = array(\n          array(\n            'id' => 1,\n            'title' => 'First Article',\n            'body' => 'First Article Body',\n            'published' => '1',\n            'created' => '2007-03-18 10:39:23',\n            'updated' => '2007-03-18 10:41:31'\n          ),\n          array(\n            'id' => 2,\n            'title' => 'Second Article',\n            'body' => 'Second Article Body',\n            'published' => '1',\n            'created' => '2007-03-18 10:41:23',\n            'updated' => '2007-03-18 10:43:31'\n          ),\n          array(\n            'id' => 3,\n            'title' => 'Third Article',\n            'body' => 'Third Article Body',\n            'published' => '1',\n            'created' => '2007-03-18 10:43:23',\n            'updated' => '2007-03-18 10:45:31'\n          )\n      );\n }\n```\n\n* \u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u4ee5\u5916\u306e\u65e2\u5b58\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9(\u30c7\u30d5\u30a9\u30eb\u30c8\u30c6\u30fc\u30d6\u30eb)\u3092\u5229\u7528\u3057\u305f\u3044\u5834\u5408\n\n```php\n      //\u30c7\u30d5\u30a9\u30eb\u30c8\u30c6\u30fc\u30d6\u30eb\u306b\u5b58\u5728\u3059\u308b\u30c6\u30fc\u30d6\u30eb\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u60c5\u5831\u3092\u8aad\u307f\u8fbc\u3080\n      public $import = ['table' => 'articles'];\n      public $records = [];\n```\n\n* \u4e0a\u8a18\u306e\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u3068\u65e2\u5b58\u30c6\u30fc\u30d6\u30eb\u306e\u69cb\u6210\u3092\u4f7f\u3063\u3066\u30c7\u30fc\u30bf\u304c\u751f\u6210\u3055\u308c\u308b\n\n# \u30c6\u30b9\u30c8\u7528\u30af\u30e9\u30b9\u3092\u4f5c\u6210\n* app/Test/Case/Model/[Model\u540d]Test.php\n\n\n```php\n<?php\n//\u30c6\u30b9\u30c8\u5bfe\u8c61\u306e\u30e2\u30c7\u30eb\u3092\u30a4\u30f3\u30dd\u30fc\u30c8\nApp::uses('Article', 'Model');\n//\u5916\u90e8\u30e9\u30a4\u30d6\u30e9\u30ea\nApp::uses('Fabricate', 'Fabricate.Lib');\n\nclass ArticleTest extends CakeTestCase {\n    public $fixtures = array('app.article');\n\n    //\u30c6\u30b9\u30c8\u5b9f\u884c\u524d\u306b\u6bce\u56de\u547c\u3070\u308c\u308b\n    public function setUp() {\n        //\u89aa\u306esetUp\u306f\u5fc5\u305a\u547c\u3073\u51fa\u3059\n        parent::setUp();\n    }\n\n    //testXX\u306e\u540d\u524d\u306b\u3059\u308b\n    public function testPublished() {\n        $expected = array(\n            array('Article' => array('id' => 1, 'title' => 'First Article')),\n            array('Article' => array('id' => 2, 'title' => 'Second Article')),\n            array('Article' => array('id' => 3, 'title' => 'Third Article'))\n        );\n        //\u30e2\u30c3\u30af\u3092\u4f7f\u3046\u30d1\u30bf\u30fc\u30f3\n        $model = $this->getMockForModel('Article', array('published'));\n        //\u5148\u306b\u547c\u3073\u51fa\u3059\u56de\u6570\u3068\u671f\u5f85\u3059\u308b\u5024\u3092\u30bb\u30c3\u30c8\n        $model\n            ->expects($this->once())\n            ->method('published')\n            ->will($this->returnValue($expected));\n        //\u5b9f\u884c\u3059\u308b\n        $result = $model->published(array('id', 'title'));\n\n        //\u30c6\u30fc\u30d6\u30eb\u306b\u30e2\u30c3\u30af\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3057\u3066\u7d50\u679c\u3092\u8fd4\u3059\u3002\u5b9f\u969b\u306e\u30c6\u30fc\u30d6\u30eb\u306b\u4fdd\u5b58\u3055\u308c\u308b\u308f\u3051\u3067\u306f\u306a\u3044\n        //\u4ef6\u6570\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f1\u4ef6\n        Fabricate::create('Article', function($data, $world) {\n            //\u53d6\u5f97\u7d50\u679c\u3092\u5909\u66f4\u3057\u305f\u308a\u51fa\u6765\u308b\n            return [\n                'id' => 1\n                'name' => 'test'\n            ];\n        });\n        $articles = $this->Article->find('all');\n    }\n}\n```\n\n* \u4e8b\u524d\u306b\u7528\u610f\u3057\u305f\u30c7\u30fc\u30bf\u3060\u3051\u3067\u30c6\u30b9\u30c8\u3059\u308b\u306e\u3067\u3042\u308c\u3070\u3001\u30d5\u30a3\u30af\u30b9\u30c1\u30e3\u3067\u30ec\u30b3\u30fc\u30c9\u3092\u7528\u610f\u3057\u3066\u304a\u304f\u3060\u3051\u3067\u3044\u3044\u304c\u3001\u81ea\u5206\u3067\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u8ffd\u52a0\u3057\u305f\u308a\u3057\u305f\u3044\u6642\u3082\u591a\u3044\n* \u305d\u3093\u306a\u5834\u5408\u306f\u3053\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3046\u3002\u4f5c\u6210\u3055\u308c\u308b\u30c7\u30fc\u30bf\u306f\u30b9\u30ad\u30fc\u30de\u60c5\u5831\u304b\u3089\u81ea\u52d5\u5224\u5b9a\u3055\u308c\u3066\u9069\u5f53\u306a\u521d\u671f\u5024\u304c\u5165\u308b\n* \u5024\u3092\u5909\u3048\u305f\u3044\u5834\u5408\u306f\u3001\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3067\u5909\u66f4\u304c\u53ef\u80fd\n* \u4f5c\u6210\u3059\u308b\u4ef6\u6570\u306f\u7b2c\u4e8c\u5f15\u6570\u3067\u6307\u5b9a\u3067\u304d\u308b\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u306f1\u4ef6\nhttps://github.com/sizuhiko/Fabricate\n\n"}