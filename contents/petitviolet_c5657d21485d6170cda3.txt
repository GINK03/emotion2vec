{"context": "\u6a19\u6e96\u3067\u7528\u610f\u3055\u308c\u3066\u3044\u306a\u3044\u72ec\u81ea\u306e\u30d8\u30c3\u30c0\u30fc\u3092\u5b9a\u7fa9\u3057\u3066\u4f7f\u3044\u305f\u3044\u30b1\u30fc\u30b9\u3002\n\u5927\u96d1\u628a\u306b\u3001\u6587\u5b57\u5217\u3068\u3057\u3066\u6271\u3046\u5834\u5408\u3068\u578b\u3067\u6271\u3046\u5834\u5408\u306b\u5206\u3051\u308b\n\n\u6587\u5b57\u5217\u3067\u6271\u3046\nheaderValueByName\u3067\u826f\u3044\u3002\n\u5f15\u6570\u306bSymbol\u304bString\u3092\u6e21\u305b\u3070\u3001\u305d\u308c\u306b\u30de\u30c3\u30c1\u3059\u308b\u30d8\u30c3\u30c0\u30fc\u306e\u5024\u304c\u53d6\u308a\u51fa\u305b\u308b\u3002\nval route =\n  path(\"header\" / \"ping\") {\n    get {\n      headerValueByName('Message) { msg: String =>\n        complete(s\"pong: $msg\")\n      }\n    }\n  }\n\n\u30ea\u30af\u30a8\u30b9\u30c8/\u30ec\u30b9\u30dd\u30f3\u30b9\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n\u975e\u5e38\u306b\u7c21\u5358\u3067\u826f\u3044\u3002\n$ curl 'http://localhost:8080/header/ping' -H 'Message: hello'\npong: hello\n\n\n\u578b\u3067\u6271\u3046\nheaderValueByPF\u3068headerValueByType\u306e\u3069\u3061\u3089\u304b\u3092\u4f7f\u3048\u3070\u51fa\u6765\u308b\u3002\n\u4ee5\u4e0b\u306e\u69d8\u306a\u30ea\u30af\u30a8\u30b9\u30c8/\u30ec\u30b9\u30dd\u30f3\u30b9\u306b\u306a\u308b\u3088\u3046\u306b\u5b9f\u88c5\u3059\u308b\u3002\n$ curl localhost:8080/header/original -H 'My-Header: yes'\noriginal => My-Header: token(yes)\n\n\u307e\u305a\u3001\u30ab\u30b9\u30bf\u30e0\u30d8\u30c3\u30c0\u30fc\u3068\u306a\u308b\u578b\u3092\u7528\u610f\u3059\u308b\u3002\nModeledCustomHeader\u3068ModeledCustomHeaderCompanion\u3092\u5b9f\u88c5\u3059\u308b\u3002\n// class for custom header\nclass OriginalHeader(token: String) extends ModeledCustomHeader[OriginalHeader] {\n  override def companion: ModeledCustomHeaderCompanion[OriginalHeader] = OriginalHeader\n  override def value(): String = s\"token($token)\"\n}\n\n// companion object\nobject OriginalHeader extends ModeledCustomHeaderCompanion[OriginalHeader] {\n  override def name: String = \"My-Header\" // class\u540d\u3068\u9055\u3046\n  override def parse(value: String): Try[OriginalHeader] = Try(new OriginalHeader(value))\n}\n\n\u30af\u30e9\u30b9\u540d\u306fOriginalHeader\u3060\u304c\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30d8\u30c3\u30c0\u30fc\u3068\u3057\u3066\u306fMy-Header\u3067\u53d7\u3051\u308b\u3053\u3068\u3068\u3059\u308b\u3002\n\nheaderValueByPF\u3092\u4f7f\u3046\nPartialFunction[HttpHeader, T]\u3092\u5b9a\u7fa9\u3057\u3066\u3084\u308c\u3070\u3088\u3044\u3002\nval originalHeaderExtract = headerValuePF {\n  case h @ OriginalHeader(token) => h\n}\n\nval route =\n  path(\"header\" / \"original\") {\n    originalHeaderExtract { originalHeader =>\n      get {\n        complete(s\"original => $originalHeader\")\n      }\n    }\n  }\n\n\nheaderValueByType\u3092\u4f7f\u3046\nUser-Agent\u3068\u304b\u3068\u540c\u3058\u3088\u3046\u306b\u3084\u3063\u3066\u3082\u4f55\u6545\u304b\u4e0a\u624b\u304f\u3044\u304b\u306a\u3044\u3002\nheaderValueByType[`OriginalHeader`]() { originalHeader => ??? }\n\n\u305d\u306e\u305f\u3081\u3001headerValueByType\u306e\u5f15\u6570\u306b\u4e0e\u3048\u308b\u305f\u3081\u306eClassMagnet[OriginalHeader]\u3092\u81ea\u524d\u3067\u7528\u610f\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u5b9f\u88c5\u4f8b\u3068\u3057\u3066\u306f\u4ee5\u4e0b\u3067\u3001 ClassMagnet#apply\u3068\u306fextractPF\u306e\u5b9f\u88c5\u3092\u5909\u3048\u3066\u3044\u308b\u3002\n\u3082\u3061\u308d\u3093\u3001object\u306eOriginalHeader\u3067ClassMagnet[OriginalHeader]\u3092mix-in\u3057\u3066\u3082\u826f\u3044\u3002\nval originalHeaderMagnet = new ClassMagnet[OriginalHeader] {\n  override def classTag: ClassTag[OriginalHeader] = implicitly[ClassTag[OriginalHeader]]\n  override def runtimeClass: Class[OriginalHeader] = classOf[OriginalHeader]\n  override def extractPF: PartialFunction[Any, OriginalHeader] = {\n    case h: CustomHeader if h.name == OriginalHeader.name => OriginalHeader(h.value())\n    case h: RawHeader if h.name == OriginalHeader.name => OriginalHeader(h.value)\n  }\n}\n\n\u3053\u306eClassMagnet[OriginalHeader]\u3092headerValueByType\u306e\u5f15\u6570\u306b\u660e\u793a\u7684\u306b\u4e0e\u3048\u3066\u3084\u308c\u3070\u826f\u3044\nval route =\n  path(\"original\") {\n    headerValueByType[OriginalHeader](originalHeaderMagnet) { originalHeader =>\n      get {\n        complete(s\"original => $originalHeader\")\n      }\n    }\n  }\n\n\n\u6ce8\u610f\u70b9\nheaderValueByType[T]\u3092\u4f7f\u3046\u5834\u5408\u3001T\u306f\u5225\u306e\u30af\u30e9\u30b9\u306e\u5185\u90e8\u30af\u30e9\u30b9\u306b\u3057\u3066\u306f\u306a\u3089\u306a\u3044\u3002\nClass#getSimpleName\u3067\u30b3\u30b1\u308b\u3068\u3044\u3046\u610f\u5473\u4e0d\u660e\u306a\u72b6\u6cc1\u306b\u9665\u308b\u3002\n\u4ee5\u4e0b\u306bStackTrace\u3092\u4e00\u90e8\u629c\u7c8b\u3002\njava.lang.InternalError: Malformed class name\n    at java.lang.Class.getSimpleName(Class.java:1322)\n    at akka.http.scaladsl.server.directives.HeaderDirectives$class.headerValueByType(HeaderDirectives.scala:60)\n    at akka.http.scaladsl.server.Directives$.headerValueByType(Directives.scala:34)\n    at net.petitviolet.application.service.RoutingSampleService$Inner$$anonfun$25$$anonfun$apply$39$$anonfun$apply$40.apply(RoutingSampleService.scala:257\n)\n    at net.petitviolet.application.service.RoutingSampleService$Inner$$anonfun$25$$anonfun$apply$39$$anonfun$apply$40.apply(RoutingSampleService.scala:257\n)\n    at akka.http.scaladsl.server.Directive$$anonfun$addByNameNullaryApply$1$$anonfun$apply$13.apply(Directive.scala:136)\n    at akka.http.scaladsl.server.Directive$$anonfun$addByNameNullaryApply$1$$anonfun$apply$13.apply(Directive.scala:136)\n    at akka.http.scaladsl.server.directives.BasicDirectives$$anonfun$mapRouteResult$1$$anonfun$apply$3.apply(BasicDirectives.scala:32)\n    ...\n\n\u4e00\u5fdc\u9632\u3050\u624b\u6bb5\u3082\u3042\u3063\u3066\u3001\u30af\u30e9\u30b9\u540d\u3092OriginalHeader\u3067\u306f\u306a\u304f$OriginalHeader\u306b\u3059\u308c\u3070InternalError\u306f\u8d77\u3053\u3089\u306a\u304f\u306a\u308b\u3002\n\n\u578b\u3067\u7e1b\u308b\u30ab\u30b9\u30bf\u30e0\u30d8\u30c3\u30c0\u30fc\u307e\u3068\u3081\nheaderValueByType\u4f7f\u3046\u5834\u5408\u3067\u3082PartialFunction\u5b9f\u88c5\u3057\u3066\u3044\u3066\u3001\u304b\u3064headerValueByType\u306e\u4e2d\u3067headerValueByPF\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3001headerValueByType\u3092\u4f7f\u3046\u610f\u5473\u304c\u3042\u3093\u307e\u308a\u898b\u3048\u306a\u3044\u305f\u3081\u3001headerValueByPF\u3067\u826f\u3055\u305d\u3046\u304b\u306a\u3068\u3002\n\n\u6a19\u6e96\u3067\u7528\u610f\u3055\u308c\u3066\u3044\u306a\u3044\u72ec\u81ea\u306e\u30d8\u30c3\u30c0\u30fc\u3092\u5b9a\u7fa9\u3057\u3066\u4f7f\u3044\u305f\u3044\u30b1\u30fc\u30b9\u3002\n\u5927\u96d1\u628a\u306b\u3001\u6587\u5b57\u5217\u3068\u3057\u3066\u6271\u3046\u5834\u5408\u3068\u578b\u3067\u6271\u3046\u5834\u5408\u306b\u5206\u3051\u308b\n\n# \u6587\u5b57\u5217\u3067\u6271\u3046\n\n`headerValueByName`\u3067\u826f\u3044\u3002\n\u5f15\u6570\u306b`Symbol`\u304b`String`\u3092\u6e21\u305b\u3070\u3001\u305d\u308c\u306b\u30de\u30c3\u30c1\u3059\u308b\u30d8\u30c3\u30c0\u30fc\u306e\u5024\u304c\u53d6\u308a\u51fa\u305b\u308b\u3002\n\n```scala\nval route =\n  path(\"header\" / \"ping\") {\n    get {\n      headerValueByName('Message) { msg: String =>\n        complete(s\"pong: $msg\")\n      }\n    }\n  }\n```  \n\n\u30ea\u30af\u30a8\u30b9\u30c8/\u30ec\u30b9\u30dd\u30f3\u30b9\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n\u975e\u5e38\u306b\u7c21\u5358\u3067\u826f\u3044\u3002\n\n```\n$ curl 'http://localhost:8080/header/ping' -H 'Message: hello'\npong: hello\n```\n\n# \u578b\u3067\u6271\u3046\n\n`headerValueByPF`\u3068`headerValueByType`\u306e\u3069\u3061\u3089\u304b\u3092\u4f7f\u3048\u3070\u51fa\u6765\u308b\u3002\n\u4ee5\u4e0b\u306e\u69d8\u306a\u30ea\u30af\u30a8\u30b9\u30c8/\u30ec\u30b9\u30dd\u30f3\u30b9\u306b\u306a\u308b\u3088\u3046\u306b\u5b9f\u88c5\u3059\u308b\u3002\n\n```\n$ curl localhost:8080/header/original -H 'My-Header: yes'\noriginal => My-Header: token(yes)\n```\n\n\u307e\u305a\u3001\u30ab\u30b9\u30bf\u30e0\u30d8\u30c3\u30c0\u30fc\u3068\u306a\u308b\u578b\u3092\u7528\u610f\u3059\u308b\u3002\n`ModeledCustomHeader`\u3068`ModeledCustomHeaderCompanion`\u3092\u5b9f\u88c5\u3059\u308b\u3002\n\n```scala\n// class for custom header\nclass OriginalHeader(token: String) extends ModeledCustomHeader[OriginalHeader] {\n  override def companion: ModeledCustomHeaderCompanion[OriginalHeader] = OriginalHeader\n  override def value(): String = s\"token($token)\"\n}\n\n// companion object\nobject OriginalHeader extends ModeledCustomHeaderCompanion[OriginalHeader] {\n  override def name: String = \"My-Header\" // class\u540d\u3068\u9055\u3046\n  override def parse(value: String): Try[OriginalHeader] = Try(new OriginalHeader(value))\n}\n```\n\n\u30af\u30e9\u30b9\u540d\u306f`OriginalHeader`\u3060\u304c\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30d8\u30c3\u30c0\u30fc\u3068\u3057\u3066\u306f`My-Header`\u3067\u53d7\u3051\u308b\u3053\u3068\u3068\u3059\u308b\u3002\n\n## headerValueByPF\u3092\u4f7f\u3046\n\n`PartialFunction[HttpHeader, T]`\u3092\u5b9a\u7fa9\u3057\u3066\u3084\u308c\u3070\u3088\u3044\u3002\n\n```scala\nval originalHeaderExtract = headerValuePF {\n  case h @ OriginalHeader(token) => h\n}\n\nval route =\n  path(\"header\" / \"original\") {\n    originalHeaderExtract { originalHeader =>\n      get {\n        complete(s\"original => $originalHeader\")\n      }\n    }\n  }\n```\n\n## headerValueByType\u3092\u4f7f\u3046\n\n`User-Agent`\u3068\u304b\u3068\u540c\u3058\u3088\u3046\u306b\u3084\u3063\u3066\u3082\u4f55\u6545\u304b\u4e0a\u624b\u304f\u3044\u304b\u306a\u3044\u3002\n\n```scala\nheaderValueByType[`OriginalHeader`]() { originalHeader => ??? }\n```\n\n\u305d\u306e\u305f\u3081\u3001`headerValueByType`\u306e\u5f15\u6570\u306b\u4e0e\u3048\u308b\u305f\u3081\u306e`ClassMagnet[OriginalHeader]`\u3092\u81ea\u524d\u3067\u7528\u610f\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u5b9f\u88c5\u4f8b\u3068\u3057\u3066\u306f\u4ee5\u4e0b\u3067\u3001 [ClassMagnet#apply](https://github.com/akka/akka/blob/master/akka-http/src/main/scala/akka/http/scaladsl/server/util/ClassMagnet.scala#L28)\u3068\u306f`extractPF`\u306e\u5b9f\u88c5\u3092\u5909\u3048\u3066\u3044\u308b\u3002\n\u3082\u3061\u308d\u3093\u3001object\u306e`OriginalHeader`\u3067`ClassMagnet[OriginalHeader]`\u3092mix-in\u3057\u3066\u3082\u826f\u3044\u3002\n\n```scala\nval originalHeaderMagnet = new ClassMagnet[OriginalHeader] {\n  override def classTag: ClassTag[OriginalHeader] = implicitly[ClassTag[OriginalHeader]]\n  override def runtimeClass: Class[OriginalHeader] = classOf[OriginalHeader]\n  override def extractPF: PartialFunction[Any, OriginalHeader] = {\n    case h: CustomHeader if h.name == OriginalHeader.name => OriginalHeader(h.value())\n    case h: RawHeader if h.name == OriginalHeader.name => OriginalHeader(h.value)\n  }\n}\n```\n\n\u3053\u306e`ClassMagnet[OriginalHeader]`\u3092`headerValueByType`\u306e\u5f15\u6570\u306b\u660e\u793a\u7684\u306b\u4e0e\u3048\u3066\u3084\u308c\u3070\u826f\u3044\n\n```scala\nval route =\n  path(\"original\") {\n    headerValueByType[OriginalHeader](originalHeaderMagnet) { originalHeader =>\n      get {\n        complete(s\"original => $originalHeader\")\n      }\n    }\n  }\n```\n\n### \u6ce8\u610f\u70b9\n\n`headerValueByType[T]`\u3092\u4f7f\u3046\u5834\u5408\u3001`T`\u306f\u5225\u306e\u30af\u30e9\u30b9\u306e\u5185\u90e8\u30af\u30e9\u30b9\u306b\u3057\u3066\u306f\u306a\u3089\u306a\u3044\u3002\n`Class#getSimpleName`\u3067\u30b3\u30b1\u308b\u3068\u3044\u3046\u610f\u5473\u4e0d\u660e\u306a\u72b6\u6cc1\u306b\u9665\u308b\u3002\n\u4ee5\u4e0b\u306bStackTrace\u3092\u4e00\u90e8\u629c\u7c8b\u3002\n\n```\njava.lang.InternalError: Malformed class name\n    at java.lang.Class.getSimpleName(Class.java:1322)\n    at akka.http.scaladsl.server.directives.HeaderDirectives$class.headerValueByType(HeaderDirectives.scala:60)\n    at akka.http.scaladsl.server.Directives$.headerValueByType(Directives.scala:34)\n    at net.petitviolet.application.service.RoutingSampleService$Inner$$anonfun$25$$anonfun$apply$39$$anonfun$apply$40.apply(RoutingSampleService.scala:257\n)\n    at net.petitviolet.application.service.RoutingSampleService$Inner$$anonfun$25$$anonfun$apply$39$$anonfun$apply$40.apply(RoutingSampleService.scala:257\n)\n    at akka.http.scaladsl.server.Directive$$anonfun$addByNameNullaryApply$1$$anonfun$apply$13.apply(Directive.scala:136)\n    at akka.http.scaladsl.server.Directive$$anonfun$addByNameNullaryApply$1$$anonfun$apply$13.apply(Directive.scala:136)\n    at akka.http.scaladsl.server.directives.BasicDirectives$$anonfun$mapRouteResult$1$$anonfun$apply$3.apply(BasicDirectives.scala:32)\n    ...\n```\n\n\u4e00\u5fdc\u9632\u3050\u624b\u6bb5\u3082\u3042\u3063\u3066\u3001\u30af\u30e9\u30b9\u540d\u3092`OriginalHeader`\u3067\u306f\u306a\u304f`$OriginalHeader`\u306b\u3059\u308c\u3070`InternalError`\u306f\u8d77\u3053\u3089\u306a\u304f\u306a\u308b\u3002\n\n## \u578b\u3067\u7e1b\u308b\u30ab\u30b9\u30bf\u30e0\u30d8\u30c3\u30c0\u30fc\u307e\u3068\u3081\n\n`headerValueByType`\u4f7f\u3046\u5834\u5408\u3067\u3082`PartialFunction`\u5b9f\u88c5\u3057\u3066\u3044\u3066\u3001\u304b\u3064`headerValueByType`\u306e\u4e2d\u3067[headerValueByPF\u4f7f\u3063\u3066\u3044\u308b](https://github.com/akka/akka/blob/master/akka-http/src/main/scala/akka/http/scaladsl/server/directives/HeaderDirectives.scala#L83)\u306e\u3067\u3001`headerValueByType`\u3092\u4f7f\u3046\u610f\u5473\u304c\u3042\u3093\u307e\u308a\u898b\u3048\u306a\u3044\u305f\u3081\u3001`headerValueByPF`\u3067\u826f\u3055\u305d\u3046\u304b\u306a\u3068\u3002\n", "tags": ["Akka-HTTP", "Akka", "Scala"]}