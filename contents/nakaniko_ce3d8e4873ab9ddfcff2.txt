{"context": "\n\n\u69cb\u7bc9\u624b\u9806\n\n\u30db\u30b9\u30c8VM\u306e\u4f5c\u6210\n\nVagrant \u3067 Ubuntu 16.04 \u306e VM \u3092\u8d77\u52d5\n\n$ mkdir LxdTest\n$ cd LxdTest/\n$ vagrant init ubuntu/xenial64\n$ vagrant up\n$ vagrant ssh\n\nvagrant up\u306e\u524d\u306bVagrantfile\u306eprivate_network\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u5916\u3057\u3066\u304a\u304f\u3068\u3088\u3044\u3002\nconfig.vm.network \"private_network\", ip: \"192.168.33.10\"\n\n\n\u30db\u30b9\u30c8VM\u306bLXD\u5411\u3051\u3001ZFS\u5411\u3051\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n$ sudo apt install -y lxd lxd-client lxd-tools criu\n$ sudo apt install -y zfsutils-linux\n$ sudo modprobe zfs\n\n\nLXD\u3092\u521d\u671f\u5316\n\n$ sudo lxd init\nName of the storage backend to use (dir or zfs): zfs\nCreate a new ZFS pool (yes/no)? yes\nName of the new ZFS pool: tank\nWould you like to use an existing block device (yes/no)? no\nSize in GB of the new loop device (1GB minimum): 20\nWould you like LXD to be available over the network (yes/no)? yes\nAddress to bind LXD to (not including port): 0.0.0.0\nPort to bind LXD to (8443 recommended): 8443\nTrust password for new clients: \nAgain: \nDo you want to configure the LXD bridge (yes/no)? yes\nWarning: Stopping lxd.service, but it can still be activated by:\n  lxd.socket\nLXD has been successfully configured.\n\n\nCentOS \u306e\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\n\n$ lxc launch images:centos/6/amd64 centos-1\nCreating centos-1\nRetrieving image: 100%\nStarting centos-1\n$ lxc list\n+----------+---------+---------------------+-----------------------------------------------+------------+-----------+\n|   NAME   |  STATE  |        IPV4         |                     IPV6                      |    TYPE    | SNAPSHOTS |\n+----------+---------+---------------------+-----------------------------------------------+------------+-----------+\n| centos-1 | RUNNING | 10.184.87.54 (eth0) | fd31:b7f3:efeb:ab84:216:3eff:feb4:3484 (eth0) | PERSISTENT | 0         |\n+----------+---------+---------------------+-----------------------------------------------+------------+-----------+\n\n\n\u4f5c\u6210\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u306b\u63a5\u7d9a\u3057\u3001SSH\u30b5\u30fc\u30d0\u3092\u8d77\u52d5\n\n$ lxc exec centos-1 bash\n[root@centos-1 ~]# yum install openssh-server\n[root@centos-1 ~]# chkconfig sshd on\n[root@centos-1 ~]# service sshd start\nGenerating SSH2 RSA host key:                              [  OK  ]\nGenerating SSH1 RSA host key:                              [  OK  ]\nGenerating SSH2 DSA host key:                              [  OK  ]\nStarting sshd:                                             [  OK  ]\n\n\n\u30db\u30b9\u30c8VM\u306b\u30b3\u30f3\u30c6\u30ca\u3078\u306e\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\n\n$ sudo iptables -t nat -A PREROUTING -m tcp -p tcp --dst 192.168.33.10 --dport 10080 -j DNAT --to-destination 10.184.87.54:80\n$ sudo iptables -t nat -A PREROUTING -m tcp -p tcp --dst 192.168.33.10 --dport 10022 -j DNAT --to-destination 10.184.87.54:22\n\n\nAnsible\u3067\u758e\u901a\u78ba\u8a8d\n\n[web]\ncentos-1 ansible_ssh_host=192.168.33.10 ansible_ssh_port=10022 ansible_ssh_user=root ansible_ssh_pass=****\n\n$ ansible -i hosts all -m ping\ncentos-1 | SUCCESS => {\n    \"changed\": false, \n    \"ping\": \"pong\"\n}\n\n\n# \u69cb\u7bc9\u624b\u9806\n## \u30db\u30b9\u30c8VM\u306e\u4f5c\u6210\n \n* Vagrant \u3067 Ubuntu 16.04 \u306e VM \u3092\u8d77\u52d5\n\n```bash\n$ mkdir LxdTest\n$ cd LxdTest/\n$ vagrant init ubuntu/xenial64\n$ vagrant up\n$ vagrant ssh\n```\n\nvagrant up\u306e\u524d\u306bVagrantfile\u306eprivate_network\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u5916\u3057\u3066\u304a\u304f\u3068\u3088\u3044\u3002\n\n```bash\nconfig.vm.network \"private_network\", ip: \"192.168.33.10\"\n```\n\n* \u30db\u30b9\u30c8VM\u306bLXD\u5411\u3051\u3001ZFS\u5411\u3051\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\n$ sudo apt install -y lxd lxd-client lxd-tools criu\n$ sudo apt install -y zfsutils-linux\n$ sudo modprobe zfs\n```\n\n* LXD\u3092\u521d\u671f\u5316\n\n```bash\n$ sudo lxd init\nName of the storage backend to use (dir or zfs): zfs\nCreate a new ZFS pool (yes/no)? yes\nName of the new ZFS pool: tank\nWould you like to use an existing block device (yes/no)? no\nSize in GB of the new loop device (1GB minimum): 20\nWould you like LXD to be available over the network (yes/no)? yes\nAddress to bind LXD to (not including port): 0.0.0.0\nPort to bind LXD to (8443 recommended): 8443\nTrust password for new clients: \nAgain: \nDo you want to configure the LXD bridge (yes/no)? yes\nWarning: Stopping lxd.service, but it can still be activated by:\n  lxd.socket\nLXD has been successfully configured.\n```\n\n* CentOS \u306e\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\n\n```bash\n$ lxc launch images:centos/6/amd64 centos-1\nCreating centos-1\nRetrieving image: 100%\nStarting centos-1\n$ lxc list\n+----------+---------+---------------------+-----------------------------------------------+------------+-----------+\n|   NAME   |  STATE  |        IPV4         |                     IPV6                      |    TYPE    | SNAPSHOTS |\n+----------+---------+---------------------+-----------------------------------------------+------------+-----------+\n| centos-1 | RUNNING | 10.184.87.54 (eth0) | fd31:b7f3:efeb:ab84:216:3eff:feb4:3484 (eth0) | PERSISTENT | 0         |\n+----------+---------+---------------------+-----------------------------------------------+------------+-----------+\n```\n\n* \u4f5c\u6210\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u306b\u63a5\u7d9a\u3057\u3001SSH\u30b5\u30fc\u30d0\u3092\u8d77\u52d5\n\n```bash\n$ lxc exec centos-1 bash\n[root@centos-1 ~]# yum install openssh-server\n[root@centos-1 ~]# chkconfig sshd on\n[root@centos-1 ~]# service sshd start\nGenerating SSH2 RSA host key:                              [  OK  ]\nGenerating SSH1 RSA host key:                              [  OK  ]\nGenerating SSH2 DSA host key:                              [  OK  ]\nStarting sshd:                                             [  OK  ]\n```\n\n* \u30db\u30b9\u30c8VM\u306b\u30b3\u30f3\u30c6\u30ca\u3078\u306e\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\n\n```bash\n$ sudo iptables -t nat -A PREROUTING -m tcp -p tcp --dst 192.168.33.10 --dport 10080 -j DNAT --to-destination 10.184.87.54:80\n$ sudo iptables -t nat -A PREROUTING -m tcp -p tcp --dst 192.168.33.10 --dport 10022 -j DNAT --to-destination 10.184.87.54:22\n```\n\n* Ansible\u3067\u758e\u901a\u78ba\u8a8d\n\n```Ini\n[web]\ncentos-1 ansible_ssh_host=192.168.33.10 ansible_ssh_port=10022 ansible_ssh_user=root ansible_ssh_pass=****\n```\n```bash\n$ ansible -i hosts all -m ping\ncentos-1 | SUCCESS => {\n    \"changed\": false, \n    \"ping\": \"pong\"\n}\n```\n", "tags": ["lxd", "Ansible"]}