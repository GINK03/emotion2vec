{"context": " More than 1 year has passed since last update.\n\nDocker Swarm \u306b\u3064\u3044\u3066\n\u901a\u5e38\u3001Docker \u3067\u306f\u3001\u8907\u6570\u306e\u30db\u30b9\u30c8\u306b\u307e\u305f\u304c\u3063\u3066\u30b3\u30f3\u30c6\u30ca\u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u3001docker \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u305f\u3073\u306b-H \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u52a0\u3057\u3066\u63a5\u7d9a\u5148\u3092\u5207\u308a\u66ff\u3048\u308b\u5fc5\u8981\u304c\u6709\u308a\u307e\u3057\u305f\u3002\n\u7d50\u679c\u3068\u3057\u3066\u3001\u8907\u6570\u306e\u30db\u30b9\u30c8\u4e0a\u306b\u30b3\u30f3\u30c6\u30ca\u304c\u6563\u8ca1\u3059\u308b\u5834\u5408\u3001docker \u30b3\u30de\u30f3\u30c9\u3067\u900f\u904e\u7684\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u7ba1\u7406\u3059\u308b\u3053\u3068\u304c\u56f0\u96e3\u3067\u3057\u305f\u3002\n\u305d\u3046\u3044\u3063\u305f\u554f\u984c\u306fDocker Swarm \u3092\u4f7f\u3046\u3053\u3068\u3067\u8efd\u6e1b\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nDocker Swarm \u306f1 \u3064\u4ee5\u4e0a\u306eDocker \u30db\u30b9\u30c8\u30921 \u3064\u306eDocker \u30db\u30b9\u30c8(Docker Swarm manager) \u306bpool \u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u3001\u30e6\u30fc\u30b6\u306f\u305d\u306eDocker Swarm manager \u30db\u30b9\u30c8\u306b\u5bfe\u3057\u3066\u30b3\u30de\u30f3\u30c9\u3092\u767a\u884c\u3059\u308b\u3053\u3068\u3067\u3001\u8907\u6570\u306eDocker \u30ce\u30fc\u30c9\u3092cluster \u3068\u3057\u3066\u900f\u904e\u7684\u306b\u7ba1\u7406\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\nDocker Swarm \u306f\u6a19\u6e96\u7684\u306aDocker API \u3092\u63d0\u4f9b\u3057\u3066\u3044\u308b\u306e\u3067\u3001Docker \u30c7\u30fc\u30e2\u30f3\u3068\u65e2\u306b\u901a\u4fe1\u3057\u3066\u3044\u308b\u30c4\u30fc\u30eb\u985e\u306fSwarm \u3092\u8907\u6570\u306e\u30db\u30b9\u30c8\u306b\u900f\u904e\u7684\u306b\u4f7f\u7528\u305f\u3081\u306b\u4f7f\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\nDocker Swarm \u3092\u4f7f\u3046\u305f\u3081\u306e\u8981\u4ef6\nDocker Swarm \u306fDocker \u306e\u30b3\u30f3\u30c6\u30ca\u3068\u3057\u3066\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001pull \u3059\u308b\u3053\u3068\u3067\u3059\u3050\u306b\u4f7f\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\npull \u3057\u305f\u3042\u3068\u306fDocker Swarm manager \u306e\u8a2d\u5b9a\u3092\u3057\u3001Docker Swarm agent \u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u4ed6\u306e\u30ce\u30fc\u30c9\u3092Docker cluster \u306e\u4e00\u54e1\u3068\u3057\u3066\u8ffd\u52a0\u3057\u3001Docker Swarm manager \u304b\u3089\u4e00\u5143\u7684\u306b\u64cd\u4f5c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u4eca\u56de\u306e\u69cb\u6210\n\n\u69cb\u6210\n\n\n OS\n IP \u30a2\u30c9\u30ec\u30b9\n \u30db\u30b9\u30c8\u540d\n \u5099\u8003\n\n\n Ubuntu 15.10\n 192.168.1.121\n swmgr01\n Swarm manager\u3002\u307e\u305f\u3001Docker Swarm manager \u3092\u64cd\u4f5c\u3059\u308b\u305f\u3081\u306e\u7ba1\u7406\u7aef\u672b\u3068\u3057\u3066\u3082\u4f7f\u7528\n\n\n Debian jessie\n 192.168.1.131\n swagt01\n Swarm agent 01\n\n\n Debian jessie\n 192.168.1.132\n swagt02\n Swarm agent 02\n\n\n Debian jessie\n 192.168.1.133\n swagt03\n Swarm agent 03\n\n\n\n\n\n\nDocker Swarm \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u4f5c\u6210\n\u3053\u3053\u3067\u306fUbuntu \u3067Docker Swarm \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u4f5c\u6210\u65b9\u6cd5\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u3066\u304d\u307e\u3059\u3002\nUbuntu \u306eDocker Engine \u3092\u4f7f\u7528\u3057\u3066\u305d\u308c\u3089\u306e\u624b\u9806\u3092\u898b\u3066\u3044\u304f\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001\u3053\u3053\u3067\u306fUbuntu \u306bDocker Engine \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u624b\u9806\u306b\u3064\u3044\u3066\u306f\u5272\u611b\u3057\u307e\u3059\u3002\nDocker Engine \u3092Docker \u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b(Ubuntu 15.04, 14.04 LTS)\n\ndiscovery token \u306e\u767a\u884c\n\u307e\u305a\u306fDocker Swarm \u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u7528\u3057\u3066discovery token \u3092\u767a\u884c\u3057\u307e\u3059\u3002\n\u305d\u306e\u305f\u3081\u306bdocker run swarm create \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u3053\u308c\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067\u3001swarm \u30b3\u30f3\u30c6\u30ca\u4e0a\u3067swarm create \u30b3\u30de\u30f3\u30c9\u304c\u5b9f\u884c\u3055\u308c\u3001discovery token \u304c\u767a\u884c\u3055\u308c\u307e\u3059\u3002\n\nDockerSwarm\u30b3\u30f3\u30c6\u30ca\u306e\u4f5c\u6210\u3068doscoverytoken\u306e\u767a\u884c(swmgr01)\n$ docker run --rm swarm create\nUnable to find image 'swarm:latest' locally\nlatest: Pulling from library/swarm\nd681c900c6e3: Pull complete \n188de6f24f3f: Pull complete \n90b2ffb8d338: Pull complete \n237af4efea94: Pull complete \n3b3fc6f62107: Pull complete \n7e6c9135b308: Pull complete \n986340ab62f0: Pull complete \na9975e2cc0a3: Pull complete \nDigest: sha256:c21fd414b0488637b1f05f13a59b032a3f9da5d818d31da1a4ca98a84c0c781b\nStatus: Downloaded newer image for swarm:latest\n8f620653b5157592418a2da287dc722d\n\n\n\u4e0a\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u306e\u7d50\u679c\u3088\u308a\u30018f620653b5157592418a2da287dc722d \u306ediscovery token \u304c\u767a\u884c\u3055\u308c\u305f\u307e\u3057\u305f\u3002\n\u3053\u306ediscovery token \u306fDocker Swarm \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u8d77\u52d5\u3059\u308b\u3068\u304d\u306b\u4f7f\u7528\u3059\u308b\u3082\u306e\u3068\u306a\u308b\u306e\u3067\u3001\u5b89\u5168\u306a\u5834\u6240\u306b\u4fdd\u7ba1\u3057\u3066\u304a\u304f\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nswarm \u30ce\u30fc\u30c9\u306e\u4f5c\u6210(swagt01-03)\n\u4eca\u56de\u7528\u610f\u3057\u305fDocker \u30ce\u30fc\u30c9(swagt01, swagt02, swagt03)\u3092Docker Swarm agent \u3068\u3057\u3066\u8d77\u52d5\u3057\u307e\u3059\u3002\nDocker Swarm agent \u306f\u3001\u305d\u308c\u305e\u308c\u306e\u30e2\u30cb\u30bf\u60c5\u5831\u3092\u767b\u9332\u3057\u3001discovery token \u306e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3067\u66f4\u65b0\u3092\u304b\u3051\u307e\u3059\u3002\n\u672c\u624b\u9806\u3067\u306fDocker Hub \u30d9\u30fc\u30b9\u306etoken \u30c7\u30a3\u30b9\u30ab\u30d0\u30ea\u30b5\u30fc\u30d3\u30b9\u3092\u4f7f\u3044\u307e\u3059\u3002\nDocker Swarm agent \u30ce\u30fc\u30c9\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3001/lib/systemd/system \u30d5\u30a1\u30a4\u30eb\u306eExecStart \u306e\u5024\u3092\u6b21\u306e\u3088\u3046\u306b\u5909\u66f4\u3057\u3001daemon reload \u3092\u5b9f\u65bd\u3057\u3066docker daemon \u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n/lib/systemd/system/docker.serviceatswagt01-03\nExecStart=/usr/bin/docker daemon -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock\n\n\n\nDockerdaemon\u306e\u8d77\u52d5\n$ systemctl daemon-reload\n$ systemctl restart docker\n\n\n\nDocker Swarm agent \u3092discovery \u30b5\u30fc\u30d3\u30b9\u306b\u52a0\u5165\u3055\u305b\u308b(swagt01-03)\n\u5404Docker Swarm agent \u3092discovery \u30b5\u30fc\u30d3\u30b9\u306b\u52a0\u5165\u3055\u305b\u307e\u3059\u3002\n\u305d\u308c\u305e\u308c\u306eDocker Swarm agent \u306e\u3068Swarm Manager \u304c\u63a5\u7d9a\u53ef\u80fd\u306a\u72b6\u614b\u3067\u3001\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3001discovery \u30b5\u30fc\u30d3\u30b9\u4e0a\u306enode_ip\u3068cluster_id \u3092\u66f4\u65b0\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\u66f8\u5f0f\n$ docker run -d swarm join --addr=<node_ip>:2375 token://<cluster_id>\n\n\n\u5b9f\u969b\u306e\u30b3\u30de\u30f3\u30c9\u4f8b\u3068\u3057\u3066\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3059\u308b\u3068\u540c\u6642\u306b--name \u30aa\u30d7\u30b7\u30e7\u30f3\u3082\u4f7f\u7528\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u540d\u3092\u6307\u5b9a\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\nswagt01\n$ docker run --name swagt01 -d swarm join --addr=192.168.1.131:2375 token://8f620653b5157592418a2da287dc722d\nUnable to find image 'swarm:latest' locally\nlatest: Pulling from library/swarm\nd681c900c6e3: Pull complete \n188de6f24f3f: Pull complete \n90b2ffb8d338: Pull complete \n237af4efea94: Pull complete \n3b3fc6f62107: Pull complete \n7e6c9135b308: Pull complete \n986340ab62f0: Pull complete \na9975e2cc0a3: Pull complete \nDigest: sha256:c21fd414b0488637b1f05f13a59b032a3f9da5d818d31da1a4ca98a84c0c781b\nStatus: Downloaded newer image for swarm:latest\n9b73b74bafda6703c0b5dc328f0501422a056079c923a37dbb7d36d89fbff77f\n\n\n\nswagt02\n$ docker run --name swagt02 -d swarm join --addr=192.168.1.132:2375 token://8f620653b5157592418a2da287dc722d\n......\n996de4e921d8902720c8abf3e62da460698b1cda36c73d4c385ded2acb87375e\n\n\n\nswagt03\n$ docker run --name swagt03 -d swarm join --addr=192.168.1.133:2375 token://8f620653b5157592418a2da287dc722d\n......\nbbf0a5bf6e097e5085118c07a4b5087d7808320b30e8a16f4517bf1b73200848\n\n\n\nDocker Swarm manager \u306e\u8a2d\u5b9a\nDocker Swarm agent \u3092\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u3059\u308b\u305f\u3081\u306eDocker Swarm manager \u306e\u8a2d\u5b9a\u3092\u884c\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\nDocker Swarm manager \u306e\u8d77\u52d5\nDocker Swarm manager \u3068\u306a\u308b\u30de\u30b7\u30f3\u4e0a\u3067Docker Swarm manager \u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\nSwarmManager\u8d77\u52d5\u30b3\u30de\u30f3\u30c9\u66f8\u5f0f\n$ docker run -d -p <manager_port>:2375 swarm manage token://<cluster_id>\n\n\n\nswmgr01\n$ docker run --name swmgr01 -d -p 2375:2375 swarm manage token://8f620653b5157592418a2da287dc722d\n750562b8fc7fd12ba5e103add01bb12e1ee92a4073958b4f396c82e503492057\n\n\n\nDocker Swarm manager \u306e\u8a2d\u5b9a\u78ba\u8a8d\nDocker Swarm manager \u304c\u8d77\u52d5\u3057\u305f\u3089docker info \u30b3\u30de\u30f3\u30c9\u3067\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u304d\u306f-H \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u3066\u63a5\u7d9a\u5148\u30de\u30cd\u30fc\u30b8\u30e3\u306e\u30ce\u30fc\u30c9\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\ndockerinfo\u66f8\u5f0f\n$ docker -H tcp://<manager_ip>:2375 info\n\n\n\nswmgr01\n$ docker -H tcp://192.168.1.121:2375 info\nContainers: 0\nImages: 0\nRole: primary\nStrategy: spread\nFilters: health, port, dependency, affinity, constraint\nNodes: 0\nCPUs: 0\nTotal Memory: 0 B\nName: 750562b8fc7f\n\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306bDocker manager \u306e\u60c5\u5831\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059\u3002\n\nDOCKER_TLS_VERIFY \u30d5\u30e9\u30b0\u306b\u3064\u3044\u3066\n\u3082\u3057TLS \u30a8\u30e9\u30fc\u304c\u51fa\u529b\u3055\u308c\u305f\u5834\u5408\u306fDOCKER_TLS_VERIFY \u74b0\u5883\u5909\u6570\u3092unset \u3057\u307e\u3059\u3002\n\nDOCKER_TLS_VERIFY\u3092unset\u3059\u308b\n$ unset DOCKER_TLS_VERIFY\n\n\n\ndocker \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u30af\u30e9\u30b9\u30bf\u3078\u63a5\u7d9a\u3059\u308b\nDocker Swarm cluster \u3078\u63a5\u7d9a\u3059\u308b\u306b\u306f\u3001\u901a\u5e38\u306eDocker \u3078\u63a5\u7d9a\u3059\u308b\u6642\u3068\u540c\u69d8\u306bdocker \u30b3\u30de\u30f3\u30c9\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3057\u304b\u3057\u3001docker \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u304d\u306e\u63a5\u7d9a\u5148-H \u306fDocker Swarm manager \u306eIP \u3068port \u3092\u6307\u5b9a\u3059\u308b\u7528\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\ndocker\u30b3\u30de\u30f3\u30c9\u3067cluster\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n$ docker -H tcp://<ip:port> info\n$ docker -H tcp://<ip:port> run ...\n$ docker -H tcp://<ip:port> ps\n$ docker -H tcp://<ip:port> logs ...\n\n\n\ncluster \u306b\u53c2\u52a0\u3057\u3066\u3044\u308b\u30ce\u30fc\u30c9\u3092\u30ea\u30b9\u30c8\u8868\u793a\u3059\u308b\nswarm list \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067cluster \u306b\u53c2\u52a0\u3057\u3066\u3044\u308b\u8d77\u52d5\u30ce\u30fc\u30c9\u3092\u4e00\u89a7\u8868\u793a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\ncluster\u4e0a\u3067\u8d77\u52d5\u3057\u3066\u3044\u308b\u30ce\u30fc\u30c9\u3092\u4e00\u89a7\u8868\u793a\u3059\u308b\n$ docker run --rm swarm list token://<cluster_id>\n\n\n\n(anynode)\n$ docker run --rm swarm list token://8f620653b5157592418a2da287dc722d\n192.168.1.133:2375\n192.168.1.132:2375\n192.168.1.131:2375\n\n\n\u4ee5\u4e0a\u3067Docker cluster \u74b0\u5883\u306e\u69cb\u7bc9\u306f\u5b8c\u4e86\u3067\u3059\u3002\u6b21\u306fDocker Swarm cluster \u4e0a\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\nDocker Swarm \u4e0a\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3059\u308b\nSwarm \u30af\u30e9\u30b9\u30bf\u304c\u6b63\u5e38\u306b\u69cb\u7bc9\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306b\u3001\u8a66\u3057\u306bDebian \u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\nSwarm \u30af\u30e9\u30b9\u30bf\u4e0a\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3059\u308b\u5834\u5408\u306f-H \u30aa\u30d7\u30b7\u30e7\u30f3\u3067Docker Swarm manager \u306e\u30ce\u30fc\u30c9\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u4eca\u56de\u3001Docker Swarm manager \u306f192.168.1.121:2375 \u306b\u306a\u308b\u306e\u3067\u3001\u30b3\u30de\u30f3\u30c9\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\nswmgt01\nswmgt01~$ docker -H tcp://192.168.1.121:2375 run --name test_busybox -ti busybox /bin/sh\n\n## ...\u66ab\u304f\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059...\n\n/ # id\nuid#0(root) gid=0(root) groups10(wheel)\n/ # hostname\n19486390f2fe\n/ #\n/ # exit\n\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306b\u30b3\u30f3\u30c6\u30ca\u304c\u4f5c\u6210\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059\u3002\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u6240\u5728\u306e\u78ba\u8a8d\n\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u304c\u3069\u306eDocker Swarm \u30ce\u30fc\u30c9\u306b\u4f5c\u6210\u3055\u308c\u305f\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u3053\u3061\u3089\u3082\u5148\u307b\u3069\u3068\u540c\u69d8\u306b-H \u30aa\u30d7\u30b7\u30e7\u30f3\u3067Docker Swarm manager \u306eIP:port \u3092\u6307\u5b9a\u3057\u3066docker ps -a \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\nswmgr01\nswmgt01~$ docker -H tcp://192.168.1.121:2375 ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                     PORTS               NAMES\n19486390f2fe        busybox             \"/bin/sh\"                4 minutes ago       Exited (0) 3 minutes ago                       swagt03/test_busybox\nc4366b2190eb        swarm               \"/swarm join --addr=1\"   47 minutes ago      Up 47 minutes              2375/tcp            swagt03/swagt03\nf3c3d542c908        swarm               \"/swarm join --addr=1\"   47 minutes ago      Up 47 minutes              2375/tcp            swagt02/swagt02\n65b3c986da3b        swarm               \"/swarm join --addr=1\"   48 minutes ago      Up 48 minutes              2375/tcp            swagt01/swagt01\n\n\n\u4e0a\u8a18\u306e\u51fa\u529b\u7d50\u679c\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001swagt03 \u30ce\u30fc\u30c9\u4e0a\u306bbusybox \u30b3\u30f3\u30c6\u30ca\u304c\u4f5c\u6210\u3055\u308c\u305f\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\u3053\u306e\u30b3\u30f3\u30c6\u30ca\u304c\u672c\u5f53\u306bswagt03 \u306b\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306b\u3001swagt03 \u30ce\u30fc\u30c9\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3001docker ps -a \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\nswagt03\nswagt03~$ docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS               NAMES\n19486390f2fe        busybox             \"/bin/sh\"                11 minutes ago      Exited (0) 10 minutes ago                       test_busybox\nc4366b2190eb        swarm               \"/swarm join --addr=1\"   54 minutes ago      Up 54 minutes               2375/tcp            swagt03\n\n\n\u3059\u308b\u3068\u3001\u4e0a\u8a18\u306e\u3088\u3046\u306bDocker Swarm manager \u3067\u898b\u305f\u6642\u3068\u540c\u3058\u30b3\u30f3\u30c6\u30ca\u304cswagt03 \u4e0a\u306b\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u3067\u306f\u3001\u3055\u3089\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3057\u3066\u3044\u304f\u3068\u3069\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u304f\u304b\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u65b0\u3057\u304fDocker Swarm cluster \u4e0a\u306bdebian \u306e\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3057\u3001docker -H tcp://IP:port ps -a \u30b3\u30de\u30f3\u30c9\u3067\u3069\u3053\u306e\u30ce\u30fc\u30c9\u306b\u30b3\u30f3\u30c6\u30ca\u304c\u4f5c\u6210\u3055\u308c\u308b\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\nswmgr01\nswmgr01~$ docker -H tcp://192.168.1.121:2375 run --name test_debian -ti debian /bin/bash\nroot@0a232282bff7:/# \nroot@0a232282bff7:/# exit\nexit\n\nswmgr01~$ docker -H tcp://192.168.1.121:2375 ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS               NAMES\n0a232282bff7        debian              \"/bin/bash\"              53 seconds ago      Exited (0) 38 seconds ago                       swagt02/test_debian\n19486390f2fe        busybox             \"/bin/sh\"                21 minutes ago      Exited (0) 20 minutes ago                       swagt03/test_busybox\nc4366b2190eb        swarm               \"/swarm join --addr=1\"   About an hour ago   Up About an hour            2375/tcp            swagt03/swagt03\nf3c3d542c908        swarm               \"/swarm join --addr=1\"   About an hour ago   Up About an hour            2375/tcp            swagt02/swagt02\n65b3c986da3b        swarm               \"/swarm join --addr=1\"   About an hour ago   Up About an hour            2375/tcp            swagt01/swagt01\n\n\n\u3059\u308b\u3068\u6b21\u306fswagt02 \u4e0a\u306b\u65b0\u3057\u304f\u30b3\u30f3\u30c6\u30ca\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\u3053\u306e\u3088\u3046\u306bDocker Swarm cluster \u4e0a\u3067\u306fcluster \u306b\u53c2\u52a0\u3057\u3066\u3044\u308b\u30ce\u30fc\u30c9\u306b\u5bfe\u3057\u3066\u3001\u3042\u305f\u304b\u30821 \u3064\u306e\u30ce\u30fc\u30c9\u4e0a\u306eDocker daemon \u3092\u64cd\u4f5c\u3057\u3066\u3044\u308b\u304b\u306e\u3088\u3046\u306a\u611f\u899a\u3067\u3001\u900f\u904e\u7684\u306b\u8907\u6570\u30ce\u30fc\u30c9\u306b\u307e\u305f\u304c\u308b\u30b3\u30f3\u30c6\u30ca\u3092\u7ba1\u7406\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\nDocker Swarm cluster \u4e0a\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u958b\u59cb\u3001\u505c\u6b62\u3001\u524a\u9664\nDocker Swarm cluster \u4e0a\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u958b\u59cb\u3001\u505c\u6b62\u3001\u524a\u9664\u306b\u3064\u3044\u3066\u306f\u3001\u30b3\u30f3\u30c6\u30ca\u4f5c\u6210\u306e\u6642\u3068\u540c\u69d8\u306bDocker Swarm manager \u7d4c\u7531\u3068\u306a\u308b\u3088\u3046\u306b\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u7ba1\u7406\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u958b\u59cb\n$ docker -H tcp://<Swarm manager IP>:<port> start <Container>\n\n\n\n\u505c\u6b62\n$ docker -H tcp://<Swarm manager IP>:<port> stop <Container>\n\n\n\n\u524a\u9664\n$ docker -H tcp://<Swarm manager IP>:<port> rm <Container>\n\n\n\u307e\u305f\u3001\u305d\u306e\u4ed6\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u3064\u3044\u3066\u3082\u901a\u5e38\u306eDocker \u30b3\u30de\u30f3\u30c9\u3068\u540c\u3058\u3082\u306e\u304c\u6271\u3048\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u30b3\u30f3\u30c6\u30ca\u306e\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u3092\u3059\u308bdocker exec\u3001\u30a4\u30e1\u30fc\u30b8\u306e\u524a\u9664\u3092\u884c\u3046docker rmi\u3001Docker \u30b3\u30f3\u30c6\u30ca\u306e\u72b6\u614b\u78ba\u8a8d\u3092\u884c\u3046docker ps \u7b49\u3082\u540c\u69d8\u306b-H \u30aa\u30d7\u30b7\u30e7\u30f3\u3067Docker Swarm manager \u3092\u6307\u5b9a\u3057\u3066\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u53c2\u8003\n\n Docker Swarm overview\n https://docs.docker.com/swarm/\n\n\n Install and Create a Docker Swarm\n https://docs.docker.com/swarm/install-w-machine/\n\n\n Docker Tutorial : Getting Started With Docker Swarm\n http://devopscube.com/docker-tutorial-getting-started-with-docker-swarm/\n\n\n Create a swarm for development\n https://docs.docker.com/swarm/install-manual/\n\n\n DOCKER SWARM WITH TLS AUTHENTICATION\n http://www.blackfinsecurity.com/docker-swarm-with-tls-authentication/\n\n\n Protect the Docker daemon socket\n https://docs.docker.com/engine/articles/https/\n\n\n Docker Swarm\u3067\u8907\u6570Docker\u30db\u30b9\u30c8\u304b\u3089\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u308b\n http://blog.takanabe.tokyo/2015/11/23/1565/\n\n# Docker Swarm \u306b\u3064\u3044\u3066 \n\u901a\u5e38\u3001Docker \u3067\u306f\u3001\u8907\u6570\u306e\u30db\u30b9\u30c8\u306b\u307e\u305f\u304c\u3063\u3066\u30b3\u30f3\u30c6\u30ca\u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u3001docker \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u305f\u3073\u306b`-H` \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u52a0\u3057\u3066\u63a5\u7d9a\u5148\u3092\u5207\u308a\u66ff\u3048\u308b\u5fc5\u8981\u304c\u6709\u308a\u307e\u3057\u305f\u3002\n\u7d50\u679c\u3068\u3057\u3066\u3001\u8907\u6570\u306e\u30db\u30b9\u30c8\u4e0a\u306b\u30b3\u30f3\u30c6\u30ca\u304c\u6563\u8ca1\u3059\u308b\u5834\u5408\u3001docker \u30b3\u30de\u30f3\u30c9\u3067\u900f\u904e\u7684\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u7ba1\u7406\u3059\u308b\u3053\u3068\u304c\u56f0\u96e3\u3067\u3057\u305f\u3002\n\n\u305d\u3046\u3044\u3063\u305f\u554f\u984c\u306fDocker Swarm \u3092\u4f7f\u3046\u3053\u3068\u3067\u8efd\u6e1b\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nDocker Swarm \u306f1 \u3064\u4ee5\u4e0a\u306eDocker \u30db\u30b9\u30c8\u30921 \u3064\u306eDocker \u30db\u30b9\u30c8(Docker Swarm manager) \u306bpool \u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u3001\u30e6\u30fc\u30b6\u306f\u305d\u306eDocker Swarm manager \u30db\u30b9\u30c8\u306b\u5bfe\u3057\u3066\u30b3\u30de\u30f3\u30c9\u3092\u767a\u884c\u3059\u308b\u3053\u3068\u3067\u3001\u8907\u6570\u306eDocker \u30ce\u30fc\u30c9\u3092cluster \u3068\u3057\u3066\u900f\u904e\u7684\u306b\u7ba1\u7406\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\nDocker Swarm \u306f\u6a19\u6e96\u7684\u306aDocker API \u3092\u63d0\u4f9b\u3057\u3066\u3044\u308b\u306e\u3067\u3001Docker \u30c7\u30fc\u30e2\u30f3\u3068\u65e2\u306b\u901a\u4fe1\u3057\u3066\u3044\u308b\u30c4\u30fc\u30eb\u985e\u306fSwarm \u3092\u8907\u6570\u306e\u30db\u30b9\u30c8\u306b\u900f\u904e\u7684\u306b\u4f7f\u7528\u305f\u3081\u306b\u4f7f\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n# Docker Swarm \u3092\u4f7f\u3046\u305f\u3081\u306e\u8981\u4ef6 \nDocker Swarm \u306fDocker \u306e\u30b3\u30f3\u30c6\u30ca\u3068\u3057\u3066\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001pull \u3059\u308b\u3053\u3068\u3067\u3059\u3050\u306b\u4f7f\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\npull \u3057\u305f\u3042\u3068\u306fDocker Swarm manager \u306e\u8a2d\u5b9a\u3092\u3057\u3001Docker Swarm agent \u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u4ed6\u306e\u30ce\u30fc\u30c9\u3092Docker cluster \u306e\u4e00\u54e1\u3068\u3057\u3066\u8ffd\u52a0\u3057\u3001Docker Swarm manager \u304b\u3089\u4e00\u5143\u7684\u306b\u64cd\u4f5c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n# \u4eca\u56de\u306e\u69cb\u6210 \n\n\n* \u69cb\u6210\n<table><tbody>\n  <tr>\n    <th> OS</th>\n    <th> IP \u30a2\u30c9\u30ec\u30b9</th>\n    <th> \u30db\u30b9\u30c8\u540d</th>\n    <th> \u5099\u8003</th>\n  </tr>\n  <tr>\n    <td> Ubuntu 15.10</td>\n    <td> 192.168.1.121</td>\n    <td> swmgr01</td>\n    <td> Swarm manager\u3002\u307e\u305f\u3001Docker Swarm manager \u3092\u64cd\u4f5c\u3059\u308b\u305f\u3081\u306e\u7ba1\u7406\u7aef\u672b\u3068\u3057\u3066\u3082\u4f7f\u7528</td>\n  </tr>\n  <tr>\n    <td> Debian jessie</td>\n    <td> 192.168.1.131</td>\n    <td> swagt01</td>\n    <td> Swarm agent 01</td>\n  </tr>\n  <tr>\n    <td> Debian jessie</td>\n    <td> 192.168.1.132</td>\n    <td> swagt02</td>\n    <td> Swarm agent 02</td>\n  </tr>\n  <tr>\n    <td> Debian jessie</td>\n    <td> 192.168.1.133</td>\n    <td> swagt03</td>\n    <td> Swarm agent 03</td>\n  </tr>\n</tbody></table>\n\n![Docker_SwarmManager0000.png](https://qiita-image-store.s3.amazonaws.com/0/70152/4fcf2240-f13a-2ecc-bc80-eaa526d6325d.png)\n\n\n# Docker Swarm \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u4f5c\u6210 \n\u3053\u3053\u3067\u306fUbuntu \u3067Docker Swarm \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u4f5c\u6210\u65b9\u6cd5\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u3066\u304d\u307e\u3059\u3002\nUbuntu \u306eDocker Engine \u3092\u4f7f\u7528\u3057\u3066\u305d\u308c\u3089\u306e\u624b\u9806\u3092\u898b\u3066\u3044\u304f\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001\u3053\u3053\u3067\u306fUbuntu \u306bDocker Engine \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u624b\u9806\u306b\u3064\u3044\u3066\u306f\u5272\u611b\u3057\u307e\u3059\u3002\n\n[Docker Engine \u3092Docker \u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b(Ubuntu 15.04, 14.04 LTS)](http://qiita.com/TsutomuNakamura/items/4eb3ccf8393dcba25eff)\n\n# discovery token \u306e\u767a\u884c \n\u307e\u305a\u306fDocker Swarm \u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u7528\u3057\u3066discovery token \u3092\u767a\u884c\u3057\u307e\u3059\u3002\n\u305d\u306e\u305f\u3081\u306b`docker run swarm create` \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u3053\u308c\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067\u3001swarm \u30b3\u30f3\u30c6\u30ca\u4e0a\u3067`swarm create` \u30b3\u30de\u30f3\u30c9\u304c\u5b9f\u884c\u3055\u308c\u3001discovery token \u304c\u767a\u884c\u3055\u308c\u307e\u3059\u3002\n\n\n```text:DockerSwarm\u30b3\u30f3\u30c6\u30ca\u306e\u4f5c\u6210\u3068doscoverytoken\u306e\u767a\u884c(swmgr01)\n$ docker run --rm swarm create\nUnable to find image 'swarm:latest' locally\nlatest: Pulling from library/swarm\nd681c900c6e3: Pull complete \n188de6f24f3f: Pull complete \n90b2ffb8d338: Pull complete \n237af4efea94: Pull complete \n3b3fc6f62107: Pull complete \n7e6c9135b308: Pull complete \n986340ab62f0: Pull complete \na9975e2cc0a3: Pull complete \nDigest: sha256:c21fd414b0488637b1f05f13a59b032a3f9da5d818d31da1a4ca98a84c0c781b\nStatus: Downloaded newer image for swarm:latest\n8f620653b5157592418a2da287dc722d\n```\n\n\n\u4e0a\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u306e\u7d50\u679c\u3088\u308a\u3001`8f620653b5157592418a2da287dc722d` \u306ediscovery token \u304c\u767a\u884c\u3055\u308c\u305f\u307e\u3057\u305f\u3002\n\u3053\u306ediscovery token \u306fDocker Swarm \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u8d77\u52d5\u3059\u308b\u3068\u304d\u306b\u4f7f\u7528\u3059\u308b\u3082\u306e\u3068\u306a\u308b\u306e\u3067\u3001\u5b89\u5168\u306a\u5834\u6240\u306b\u4fdd\u7ba1\u3057\u3066\u304a\u304f\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n# swarm \u30ce\u30fc\u30c9\u306e\u4f5c\u6210(swagt01-03) \n\u4eca\u56de\u7528\u610f\u3057\u305fDocker \u30ce\u30fc\u30c9(swagt01, swagt02, swagt03)\u3092Docker Swarm agent \u3068\u3057\u3066\u8d77\u52d5\u3057\u307e\u3059\u3002\nDocker Swarm agent \u306f\u3001\u305d\u308c\u305e\u308c\u306e\u30e2\u30cb\u30bf\u60c5\u5831\u3092\u767b\u9332\u3057\u3001discovery token \u306e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3067\u66f4\u65b0\u3092\u304b\u3051\u307e\u3059\u3002\n\u672c\u624b\u9806\u3067\u306fDocker Hub \u30d9\u30fc\u30b9\u306etoken \u30c7\u30a3\u30b9\u30ab\u30d0\u30ea\u30b5\u30fc\u30d3\u30b9\u3092\u4f7f\u3044\u307e\u3059\u3002\n\nDocker Swarm agent \u30ce\u30fc\u30c9\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3001`/lib/systemd/system` \u30d5\u30a1\u30a4\u30eb\u306e`ExecStart` \u306e\u5024\u3092\u6b21\u306e\u3088\u3046\u306b\u5909\u66f4\u3057\u3001daemon reload \u3092\u5b9f\u65bd\u3057\u3066docker daemon \u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```text:/lib/systemd/system/docker.serviceatswagt01-03\nExecStart=/usr/bin/docker daemon -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock\n```\n\n\n\n```text:Dockerdaemon\u306e\u8d77\u52d5\n$ systemctl daemon-reload\n$ systemctl restart docker\n```\n\n\n## Docker Swarm agent \u3092discovery \u30b5\u30fc\u30d3\u30b9\u306b\u52a0\u5165\u3055\u305b\u308b(swagt01-03) \n\u5404Docker Swarm agent \u3092discovery \u30b5\u30fc\u30d3\u30b9\u306b\u52a0\u5165\u3055\u305b\u307e\u3059\u3002\n\u305d\u308c\u305e\u308c\u306eDocker Swarm agent \u306e\u3068Swarm Manager \u304c\u63a5\u7d9a\u53ef\u80fd\u306a\u72b6\u614b\u3067\u3001\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3001discovery \u30b5\u30fc\u30d3\u30b9\u4e0a\u306e`node_ip`\u3068`cluster_id` \u3092\u66f4\u65b0\u3057\u307e\u3059\u3002\n\n\n```text:\u30b3\u30de\u30f3\u30c9\u66f8\u5f0f\n$ docker run -d swarm join --addr=<node_ip>:2375 token://<cluster_id>\n```\n\n\n\u5b9f\u969b\u306e\u30b3\u30de\u30f3\u30c9\u4f8b\u3068\u3057\u3066\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3059\u308b\u3068\u540c\u6642\u306b`--name` \u30aa\u30d7\u30b7\u30e7\u30f3\u3082\u4f7f\u7528\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u540d\u3092\u6307\u5b9a\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n```text:swagt01\n$ docker run --name swagt01 -d swarm join --addr=192.168.1.131:2375 token://8f620653b5157592418a2da287dc722d\nUnable to find image 'swarm:latest' locally\nlatest: Pulling from library/swarm\nd681c900c6e3: Pull complete \n188de6f24f3f: Pull complete \n90b2ffb8d338: Pull complete \n237af4efea94: Pull complete \n3b3fc6f62107: Pull complete \n7e6c9135b308: Pull complete \n986340ab62f0: Pull complete \na9975e2cc0a3: Pull complete \nDigest: sha256:c21fd414b0488637b1f05f13a59b032a3f9da5d818d31da1a4ca98a84c0c781b\nStatus: Downloaded newer image for swarm:latest\n9b73b74bafda6703c0b5dc328f0501422a056079c923a37dbb7d36d89fbff77f\n```\n\n\n\n```text:swagt02\n$ docker run --name swagt02 -d swarm join --addr=192.168.1.132:2375 token://8f620653b5157592418a2da287dc722d\n......\n996de4e921d8902720c8abf3e62da460698b1cda36c73d4c385ded2acb87375e\n```\n\n\n\n```text:swagt03\n$ docker run --name swagt03 -d swarm join --addr=192.168.1.133:2375 token://8f620653b5157592418a2da287dc722d\n......\nbbf0a5bf6e097e5085118c07a4b5087d7808320b30e8a16f4517bf1b73200848\n```\n\n\n# Docker Swarm manager \u306e\u8a2d\u5b9a \nDocker Swarm agent \u3092\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u3059\u308b\u305f\u3081\u306eDocker Swarm manager \u306e\u8a2d\u5b9a\u3092\u884c\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\n## Docker Swarm manager \u306e\u8d77\u52d5 \nDocker Swarm manager \u3068\u306a\u308b\u30de\u30b7\u30f3\u4e0a\u3067Docker Swarm manager \u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n\n```text:SwarmManager\u8d77\u52d5\u30b3\u30de\u30f3\u30c9\u66f8\u5f0f\n$ docker run -d -p <manager_port>:2375 swarm manage token://<cluster_id>\n```\n\n\n\n```text:swmgr01\n$ docker run --name swmgr01 -d -p 2375:2375 swarm manage token://8f620653b5157592418a2da287dc722d\n750562b8fc7fd12ba5e103add01bb12e1ee92a4073958b4f396c82e503492057\n```\n\n\n## Docker Swarm manager \u306e\u8a2d\u5b9a\u78ba\u8a8d \nDocker Swarm manager \u304c\u8d77\u52d5\u3057\u305f\u3089`docker info` \u30b3\u30de\u30f3\u30c9\u3067\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u304d\u306f`-H` \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u3066\u63a5\u7d9a\u5148\u30de\u30cd\u30fc\u30b8\u30e3\u306e\u30ce\u30fc\u30c9\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n\n```text:dockerinfo\u66f8\u5f0f\n$ docker -H tcp://<manager_ip>:2375 info\n```\n\n\n\n```text:swmgr01\n$ docker -H tcp://192.168.1.121:2375 info\nContainers: 0\nImages: 0\nRole: primary\nStrategy: spread\nFilters: health, port, dependency, affinity, constraint\nNodes: 0\nCPUs: 0\nTotal Memory: 0 B\nName: 750562b8fc7f\n```\n\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306bDocker manager \u306e\u60c5\u5831\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059\u3002\n\n\n### DOCKER_TLS_VERIFY \u30d5\u30e9\u30b0\u306b\u3064\u3044\u3066 \n\u3082\u3057TLS \u30a8\u30e9\u30fc\u304c\u51fa\u529b\u3055\u308c\u305f\u5834\u5408\u306f`DOCKER_TLS_VERIFY` \u74b0\u5883\u5909\u6570\u3092unset \u3057\u307e\u3059\u3002\n\n\n```text:DOCKER_TLS_VERIFY\u3092unset\u3059\u308b\n$ unset DOCKER_TLS_VERIFY\n```\n\n\n# docker \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u30af\u30e9\u30b9\u30bf\u3078\u63a5\u7d9a\u3059\u308b \nDocker Swarm cluster \u3078\u63a5\u7d9a\u3059\u308b\u306b\u306f\u3001\u901a\u5e38\u306eDocker \u3078\u63a5\u7d9a\u3059\u308b\u6642\u3068\u540c\u69d8\u306bdocker \u30b3\u30de\u30f3\u30c9\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3057\u304b\u3057\u3001docker \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u304d\u306e\u63a5\u7d9a\u5148`-H` \u306fDocker Swarm manager \u306eIP \u3068port \u3092\u6307\u5b9a\u3059\u308b\u7528\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\n```text:docker\u30b3\u30de\u30f3\u30c9\u3067cluster\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n$ docker -H tcp://<ip:port> info\n$ docker -H tcp://<ip:port> run ...\n$ docker -H tcp://<ip:port> ps\n$ docker -H tcp://<ip:port> logs ...\n```\n\n\n# cluster \u306b\u53c2\u52a0\u3057\u3066\u3044\u308b\u30ce\u30fc\u30c9\u3092\u30ea\u30b9\u30c8\u8868\u793a\u3059\u308b \n`swarm list` \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067cluster \u306b\u53c2\u52a0\u3057\u3066\u3044\u308b\u8d77\u52d5\u30ce\u30fc\u30c9\u3092\u4e00\u89a7\u8868\u793a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\n```text:cluster\u4e0a\u3067\u8d77\u52d5\u3057\u3066\u3044\u308b\u30ce\u30fc\u30c9\u3092\u4e00\u89a7\u8868\u793a\u3059\u308b\n$ docker run --rm swarm list token://<cluster_id>\n```\n\n\n\n```text:(anynode)\n$ docker run --rm swarm list token://8f620653b5157592418a2da287dc722d\n192.168.1.133:2375\n192.168.1.132:2375\n192.168.1.131:2375\n```\n\n\n\u4ee5\u4e0a\u3067Docker cluster \u74b0\u5883\u306e\u69cb\u7bc9\u306f\u5b8c\u4e86\u3067\u3059\u3002\u6b21\u306fDocker Swarm cluster \u4e0a\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n# Docker Swarm \u4e0a\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3059\u308b \nSwarm \u30af\u30e9\u30b9\u30bf\u304c\u6b63\u5e38\u306b\u69cb\u7bc9\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306b\u3001\u8a66\u3057\u306bDebian \u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\nSwarm \u30af\u30e9\u30b9\u30bf\u4e0a\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3059\u308b\u5834\u5408\u306f`-H` \u30aa\u30d7\u30b7\u30e7\u30f3\u3067Docker Swarm manager \u306e\u30ce\u30fc\u30c9\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u4eca\u56de\u3001Docker Swarm manager \u306f`192.168.1.121:2375` \u306b\u306a\u308b\u306e\u3067\u3001\u30b3\u30de\u30f3\u30c9\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n```text:swmgt01\nswmgt01~$ docker -H tcp://192.168.1.121:2375 run --name test_busybox -ti busybox /bin/sh\n\n## ...\u66ab\u304f\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059...\n\n/ # id\nuid#0(root) gid=0(root) groups10(wheel)\n/ # hostname\n19486390f2fe\n/ #\n/ # exit\n```\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306b\u30b3\u30f3\u30c6\u30ca\u304c\u4f5c\u6210\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059\u3002\n\n## \u30b3\u30f3\u30c6\u30ca\u306e\u6240\u5728\u306e\u78ba\u8a8d \n\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u304c\u3069\u306eDocker Swarm \u30ce\u30fc\u30c9\u306b\u4f5c\u6210\u3055\u308c\u305f\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u3053\u3061\u3089\u3082\u5148\u307b\u3069\u3068\u540c\u69d8\u306b`-H` \u30aa\u30d7\u30b7\u30e7\u30f3\u3067Docker Swarm manager \u306e`IP:port` \u3092\u6307\u5b9a\u3057\u3066`docker ps -a` \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n\n```text:swmgr01\nswmgt01~$ docker -H tcp://192.168.1.121:2375 ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                     PORTS               NAMES\n19486390f2fe        busybox             \"/bin/sh\"                4 minutes ago       Exited (0) 3 minutes ago                       swagt03/test_busybox\nc4366b2190eb        swarm               \"/swarm join --addr=1\"   47 minutes ago      Up 47 minutes              2375/tcp            swagt03/swagt03\nf3c3d542c908        swarm               \"/swarm join --addr=1\"   47 minutes ago      Up 47 minutes              2375/tcp            swagt02/swagt02\n65b3c986da3b        swarm               \"/swarm join --addr=1\"   48 minutes ago      Up 48 minutes              2375/tcp            swagt01/swagt01\n```\n\n\n\u4e0a\u8a18\u306e\u51fa\u529b\u7d50\u679c\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001swagt03 \u30ce\u30fc\u30c9\u4e0a\u306bbusybox \u30b3\u30f3\u30c6\u30ca\u304c\u4f5c\u6210\u3055\u308c\u305f\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\u3053\u306e\u30b3\u30f3\u30c6\u30ca\u304c\u672c\u5f53\u306b`swagt03` \u306b\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306b\u3001`swagt03` \u30ce\u30fc\u30c9\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3001`docker ps -a` \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\n```text:swagt03\nswagt03~$ docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS               NAMES\n19486390f2fe        busybox             \"/bin/sh\"                11 minutes ago      Exited (0) 10 minutes ago                       test_busybox\nc4366b2190eb        swarm               \"/swarm join --addr=1\"   54 minutes ago      Up 54 minutes               2375/tcp            swagt03\n```\n\n\n\u3059\u308b\u3068\u3001\u4e0a\u8a18\u306e\u3088\u3046\u306bDocker Swarm manager \u3067\u898b\u305f\u6642\u3068\u540c\u3058\u30b3\u30f3\u30c6\u30ca\u304c`swagt03` \u4e0a\u306b\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u3067\u306f\u3001\u3055\u3089\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3057\u3066\u3044\u304f\u3068\u3069\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u304f\u304b\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u65b0\u3057\u304fDocker Swarm cluster \u4e0a\u306bdebian \u306e\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3057\u3001`docker -H tcp://IP:port ps -a` \u30b3\u30de\u30f3\u30c9\u3067\u3069\u3053\u306e\u30ce\u30fc\u30c9\u306b\u30b3\u30f3\u30c6\u30ca\u304c\u4f5c\u6210\u3055\u308c\u308b\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\n```text:swmgr01\nswmgr01~$ docker -H tcp://192.168.1.121:2375 run --name test_debian -ti debian /bin/bash\nroot@0a232282bff7:/# \nroot@0a232282bff7:/# exit\nexit\n\nswmgr01~$ docker -H tcp://192.168.1.121:2375 ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS               NAMES\n0a232282bff7        debian              \"/bin/bash\"              53 seconds ago      Exited (0) 38 seconds ago                       swagt02/test_debian\n19486390f2fe        busybox             \"/bin/sh\"                21 minutes ago      Exited (0) 20 minutes ago                       swagt03/test_busybox\nc4366b2190eb        swarm               \"/swarm join --addr=1\"   About an hour ago   Up About an hour            2375/tcp            swagt03/swagt03\nf3c3d542c908        swarm               \"/swarm join --addr=1\"   About an hour ago   Up About an hour            2375/tcp            swagt02/swagt02\n65b3c986da3b        swarm               \"/swarm join --addr=1\"   About an hour ago   Up About an hour            2375/tcp            swagt01/swagt01\n```\n\n\n\u3059\u308b\u3068\u6b21\u306f`swagt02` \u4e0a\u306b\u65b0\u3057\u304f\u30b3\u30f3\u30c6\u30ca\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\u3053\u306e\u3088\u3046\u306bDocker Swarm cluster \u4e0a\u3067\u306fcluster \u306b\u53c2\u52a0\u3057\u3066\u3044\u308b\u30ce\u30fc\u30c9\u306b\u5bfe\u3057\u3066\u3001\u3042\u305f\u304b\u30821 \u3064\u306e\u30ce\u30fc\u30c9\u4e0a\u306eDocker daemon \u3092\u64cd\u4f5c\u3057\u3066\u3044\u308b\u304b\u306e\u3088\u3046\u306a\u611f\u899a\u3067\u3001\u900f\u904e\u7684\u306b\u8907\u6570\u30ce\u30fc\u30c9\u306b\u307e\u305f\u304c\u308b\u30b3\u30f3\u30c6\u30ca\u3092\u7ba1\u7406\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n## Docker Swarm cluster \u4e0a\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u958b\u59cb\u3001\u505c\u6b62\u3001\u524a\u9664 \nDocker Swarm cluster \u4e0a\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u958b\u59cb\u3001\u505c\u6b62\u3001\u524a\u9664\u306b\u3064\u3044\u3066\u306f\u3001\u30b3\u30f3\u30c6\u30ca\u4f5c\u6210\u306e\u6642\u3068\u540c\u69d8\u306bDocker Swarm manager \u7d4c\u7531\u3068\u306a\u308b\u3088\u3046\u306b\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u7ba1\u7406\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\n```text:\u958b\u59cb\n$ docker -H tcp://<Swarm manager IP>:<port> start <Container>\n```\n\n\n\n```text:\u505c\u6b62\n$ docker -H tcp://<Swarm manager IP>:<port> stop <Container>\n```\n\n\n\n```text:\u524a\u9664\n$ docker -H tcp://<Swarm manager IP>:<port> rm <Container>\n```\n\n\n\u307e\u305f\u3001\u305d\u306e\u4ed6\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u3064\u3044\u3066\u3082\u901a\u5e38\u306eDocker \u30b3\u30de\u30f3\u30c9\u3068\u540c\u3058\u3082\u306e\u304c\u6271\u3048\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u30b3\u30f3\u30c6\u30ca\u306e\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u3092\u3059\u308b`docker exec`\u3001\u30a4\u30e1\u30fc\u30b8\u306e\u524a\u9664\u3092\u884c\u3046`docker rmi`\u3001Docker \u30b3\u30f3\u30c6\u30ca\u306e\u72b6\u614b\u78ba\u8a8d\u3092\u884c\u3046`docker ps` \u7b49\u3082\u540c\u69d8\u306b`-H` \u30aa\u30d7\u30b7\u30e7\u30f3\u3067Docker Swarm manager \u3092\u6307\u5b9a\u3057\u3066\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n# \u53c2\u8003 \n<dl>\n  <dt> Docker Swarm overview</dt>\n  <dd> https://docs.docker.com/swarm/</dd>\n</dl>\n\n<dl>\n  <dt> Install and Create a Docker Swarm</dt>\n  <dd> https://docs.docker.com/swarm/install-w-machine/</dd>\n</dl>\n\n<dl>\n  <dt> Docker Tutorial : Getting Started With Docker Swarm</dt>\n  <dd> http://devopscube.com/docker-tutorial-getting-started-with-docker-swarm/</dd>\n</dl>\n\n<dl>\n  <dt> Create a swarm for development</dt>\n  <dd> https://docs.docker.com/swarm/install-manual/</dd>\n</dl>\n\n<dl>\n  <dt> DOCKER SWARM WITH TLS AUTHENTICATION</dt>\n  <dd> http://www.blackfinsecurity.com/docker-swarm-with-tls-authentication/</dd>\n</dl>\n\n<dl>\n  <dt> Protect the Docker daemon socket</dt>\n  <dd> https://docs.docker.com/engine/articles/https/</dd>\n</dl>\n\n<dl>\n  <dt> Docker Swarm\u3067\u8907\u6570Docker\u30db\u30b9\u30c8\u304b\u3089\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u308b</dt>\n  <dd> http://blog.takanabe.tokyo/2015/11/23/1565/</dd>\n</dl>\n", "tags": ["docker", "Linux", "Ubuntu", "DockerSwarm", "Debian"]}