{"context": "\n\n\u306f\u3058\u3081\u306b\n\u5f53\u8a18\u4e8b\u306fdocker\u3001python\u3001uwsgi\u3001django\u306b\u3064\u3044\u3066\u3001\u305d\u308c\u305e\u308c\u5358\u4f53\u306a\u3089\u3070\u3042\u308b\u7a0b\u5ea6\u6271\u3048\u308b\u65b9\u3092\u5bfe\u8c61\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u76ee\u7684\ndocker\u30b3\u30f3\u30c6\u30ca\u3068\u3057\u3066\u4e00\u3064\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3057\u3001\u305d\u3053\u306b\u8907\u6570\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u3044\u3002\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3054\u3068\u306bpython\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u5207\u308a\u66ff\u3048\u305f\u3044\nDockerfile\u3092\u307b\u307c\u30d5\u30eb\u30b9\u30af\u30e9\u30c3\u30c1\u304b\u3064\u306a\u308b\u3079\u304f\u697d\u306b\u3084\u308a\u305f\u3044\n\n\n\u624b\u6cd5\n\u4ee5\u4e0b\u306e\u624b\u6cd5\u306b\u3088\u308a\u5b9f\u73fe\u3057\u307e\u3057\u305f\u3002\n./\n\u251c\u2500\u2500 Dockerfile\n\u251c\u2500\u2500 data\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 hogehogeapp1\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hogehogeapp1\n\u2502   \u2502   \u2502   \u2514\u2500\u2500wsgi.py\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 data\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 db.sqlite3\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 manage.py\n\u2502   \u251c\u2500\u2500 hogehogeapp2\n\u2502   \u2502   \u251c\u2500\u2500 hogehogeapp2\n\u2502   \u2502   \u2502   \u2514\u2500\u2500wsgi.py\n\u2502   \u2502   \u251c\u2500\u2500 data\n\u2502   \u2502   \u251c\u2500\u2500 db.sqlite3\n\u2502   \u2502   \u2514\u2500\u2500 manage.py\n\u2502   \u251c\u2500\u2500 hogehogeapp1.ini\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 hogehogeapp2.ini\n\u2514\u2500\u2500 init.sh\n\n\nDockerfile\nFROM ubuntu:xenial #FROM ubuntu-xenial\nMAINTAINER erscl\n\nRUN apt-get -y update\nRUN apt-get upgrade -yV\nRUN apt-get update && apt-get install -y git gcc make openssl libssl-dev libbz2-dev libreadline-dev libsqlite3-dev\n\nRUN cd /usr/local &&\\\ngit clone git://github.com/yyuu/pyenv.git ./pyenv &&\\\nmkdir -p ./pyenv/versions ./pyenv/shims &&\\\ncd /usr/local/pyenv/plugins/ &&\\\ngit clone git://github.com/yyuu/pyenv-virtualenv.git\n\nRUN echo 'export PYENV_ROOT=\"/usr/local/pyenv\"' | tee -a /etc/profile.d/pyenv.sh\nRUN echo 'export PATH=\"${PYENV_ROOT}/shims:${PYENV_ROOT}/bin:${PATH}\"' | tee -a /etc/profile.d/pyenv.sh\nRUN export PYENV_ROOT=\"/usr/local/pyenv\" &&\\\nexport PATH=\"${PYENV_ROOT}/shims:${PYENV_ROOT}/bin:${PATH}\" &&\\\npyenv install -v 2.7.12 &&\\\npyenv install -v 3.5.2 &&\\\npyenv virtualenv 2.7.12 uwsgi-2.7 &&\\\npyenv global uwsgi-2.7 &&\\\npip install django==1.8.* django-bootstrap django-bootstrap-form django-registration uwsgi &&\\\npyenv virtualenv 3.5.2 uwsgi-3.5 &&\\\npyenv global uwsgi-3.5 &&\\\npip install django django-bootstrap django-bootstrap-form uwsgi\n\nRUN groupadd -g 1000 uwsgi && \\\n    useradd -g uwsgi -m -s /bin/bash uwsgi\n\nRUN mkdir -p /var/log/uwsgi && chown uwsgi /var/log/uwsgi\n\nRUN apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n\nCOPY init.sh /opt/init.sh\n\nEXPOSE 8801 8802\n\nCMD [\"/bin/bash\",\"/opt/init.sh\"]\n\n\n\ninit.sh\nsource /etc/profile.d/pyenv.sh\nsudo -u uwsgi /usr/local/pyenv/versions/uwsgi-2.7/bin/uwsgi --ini /opt/data/hogehogeapp1.ini\nsudo -u uwsgi /usr/local/pyenv/versions/uwsgi-3.5/bin/uwsgi --ini /opt/data/hogehogeapp2.ini\ntail -f /dev/null\n\n\n\ndata/hogehogeapp1.ini\n[uwsgi]\nhttp=x1.x2.x3.x4:8801\nchdir=/opt/data/hogehogeapp1\nwsgi-file=/opt/data/hogehogeapp1/hogehogeapp1/wsgi.py\nmodule=hogehogeapp.wsgi:application\nmaster=True\npidfile=/var/run/hogehogeapp1.pid\nvacuum=True\nmax-requests=5000\ndaemonize=/var/log/uwsgi/hogehogeapp1.log\n\n\n\ndata/hogehogeapp2.ini\n[uwsgi]\nhttp=x1.x2.x3.x4:8802\nchdir=/opt/data/hogehogeapp2\nwsgi-file=/opt/data/hogehogeapp2/hogehogeapp2/wsgi.py\nmodule=hogehogeapp.wsgi:application\nmaster=True\npidfile=/var/run/hogehogeapp2.pid\nvacuum=True\nmax-requests=5000\ndaemonize=/var/log/uwsgi/hogehogeapp2.log\n\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\u6642\u306b --volume /abs_path/data:/opt/data \u3092\u8ffd\u52a0\u3057\u3001\u8d77\u52d5\u3057\u307e\u3059\n# \u306f\u3058\u3081\u306b\n\u5f53\u8a18\u4e8b\u306fdocker\u3001python\u3001uwsgi\u3001django\u306b\u3064\u3044\u3066\u3001\u305d\u308c\u305e\u308c\u5358\u4f53\u306a\u3089\u3070\u3042\u308b\u7a0b\u5ea6\u6271\u3048\u308b\u65b9\u3092\u5bfe\u8c61\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n# \u76ee\u7684\n\ndocker\u30b3\u30f3\u30c6\u30ca\u3068\u3057\u3066\u4e00\u3064\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3057\u3001\u305d\u3053\u306b\u8907\u6570\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u3044\u3002\n\n* \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3054\u3068\u306bpython\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u5207\u308a\u66ff\u3048\u305f\u3044\n* Dockerfile\u3092\u307b\u307c\u30d5\u30eb\u30b9\u30af\u30e9\u30c3\u30c1\u304b\u3064\u306a\u308b\u3079\u304f\u697d\u306b\u3084\u308a\u305f\u3044\n\n# \u624b\u6cd5\n\n\u4ee5\u4e0b\u306e\u624b\u6cd5\u306b\u3088\u308a\u5b9f\u73fe\u3057\u307e\u3057\u305f\u3002\n\n```\u968e\u5c64\u69cb\u9020\n./\n\u251c\u2500\u2500 Dockerfile\n\u251c\u2500\u2500 data\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 hogehogeapp1\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 hogehogeapp1\n\u2502   \u2502   \u2502   \u2514\u2500\u2500wsgi.py\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 data\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 db.sqlite3\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 manage.py\n\u2502   \u251c\u2500\u2500 hogehogeapp2\n\u2502   \u2502   \u251c\u2500\u2500 hogehogeapp2\n\u2502   \u2502   \u2502   \u2514\u2500\u2500wsgi.py\n\u2502   \u2502   \u251c\u2500\u2500 data\n\u2502   \u2502   \u251c\u2500\u2500 db.sqlite3\n\u2502   \u2502   \u2514\u2500\u2500 manage.py\n\u2502   \u251c\u2500\u2500 hogehogeapp1.ini\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 hogehogeapp2.ini\n\u2514\u2500\u2500 init.sh\n```\n\n```Bash:Dockerfile\nFROM ubuntu:xenial #FROM ubuntu-xenial\nMAINTAINER erscl\n\nRUN apt-get -y update\nRUN apt-get upgrade -yV\nRUN apt-get update && apt-get install -y git gcc make openssl libssl-dev libbz2-dev libreadline-dev libsqlite3-dev\n\nRUN cd /usr/local &&\\\ngit clone git://github.com/yyuu/pyenv.git ./pyenv &&\\\nmkdir -p ./pyenv/versions ./pyenv/shims &&\\\ncd /usr/local/pyenv/plugins/ &&\\\ngit clone git://github.com/yyuu/pyenv-virtualenv.git\n\nRUN echo 'export PYENV_ROOT=\"/usr/local/pyenv\"' | tee -a /etc/profile.d/pyenv.sh\nRUN echo 'export PATH=\"${PYENV_ROOT}/shims:${PYENV_ROOT}/bin:${PATH}\"' | tee -a /etc/profile.d/pyenv.sh\nRUN export PYENV_ROOT=\"/usr/local/pyenv\" &&\\\nexport PATH=\"${PYENV_ROOT}/shims:${PYENV_ROOT}/bin:${PATH}\" &&\\\npyenv install -v 2.7.12 &&\\\npyenv install -v 3.5.2 &&\\\npyenv virtualenv 2.7.12 uwsgi-2.7 &&\\\npyenv global uwsgi-2.7 &&\\\npip install django==1.8.* django-bootstrap django-bootstrap-form django-registration uwsgi &&\\\npyenv virtualenv 3.5.2 uwsgi-3.5 &&\\\npyenv global uwsgi-3.5 &&\\\npip install django django-bootstrap django-bootstrap-form uwsgi\n\nRUN groupadd -g 1000 uwsgi && \\\n    useradd -g uwsgi -m -s /bin/bash uwsgi\n\nRUN mkdir -p /var/log/uwsgi && chown uwsgi /var/log/uwsgi\n\nRUN apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n\nCOPY init.sh /opt/init.sh\n\nEXPOSE 8801 8802\n\nCMD [\"/bin/bash\",\"/opt/init.sh\"]\n```\n```Bash:init.sh\nsource /etc/profile.d/pyenv.sh\nsudo -u uwsgi /usr/local/pyenv/versions/uwsgi-2.7/bin/uwsgi --ini /opt/data/hogehogeapp1.ini\nsudo -u uwsgi /usr/local/pyenv/versions/uwsgi-3.5/bin/uwsgi --ini /opt/data/hogehogeapp2.ini\ntail -f /dev/null\n```\n\n```data/hogehogeapp1.ini\n[uwsgi]\nhttp=x1.x2.x3.x4:8801\nchdir=/opt/data/hogehogeapp1\nwsgi-file=/opt/data/hogehogeapp1/hogehogeapp1/wsgi.py\nmodule=hogehogeapp.wsgi:application\nmaster=True\npidfile=/var/run/hogehogeapp1.pid\nvacuum=True\nmax-requests=5000\ndaemonize=/var/log/uwsgi/hogehogeapp1.log\n```\n\n```data/hogehogeapp2.ini\n[uwsgi]\nhttp=x1.x2.x3.x4:8802\nchdir=/opt/data/hogehogeapp2\nwsgi-file=/opt/data/hogehogeapp2/hogehogeapp2/wsgi.py\nmodule=hogehogeapp.wsgi:application\nmaster=True\npidfile=/var/run/hogehogeapp2.pid\nvacuum=True\nmax-requests=5000\ndaemonize=/var/log/uwsgi/hogehogeapp2.log\n```\n\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\u6642\u306b `--volume /abs_path/data:/opt/data` \u3092\u8ffd\u52a0\u3057\u3001\u8d77\u52d5\u3057\u307e\u3059\n", "tags": ["docker", "Python", "uwsgi", "Django"]}