{"context": " More than 1 year has passed since last update.\u3053\u306e\u6295\u7a3f\u306f Sansan Advent Calendar 2015 \u306e 13 \u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\n\u307f\u306a\u3055\u3093\u30c6\u30b9\u30c8\u66f8\u3044\u3066\u307e\u3059\u304b\uff1f\n\u3053\u306e\u6642\u4ee3\u30c6\u30b9\u30c8\u66f8\u3044\u3066\u3044\u306a\u3044\u4eba\u306a\u3093\u3066\u3001\u3044\u306a\u3044\u3067\u3059\u3088\u306d\u3002\n\u3044\u308b\u308f\u3051\u306a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u305f\u3060\u3001\u8cea\u554f\u3092\u5909\u3048\u3066\u3001\n\u5916\u90e8\u30b5\u30fc\u30d3\u30b9\u306b\u4f9d\u5b58\u3059\u308b\u30b3\u30fc\u30c9\u306e\u30c6\u30b9\u30c8\u66f8\u3044\u3066\u307e\u3059\u304b\uff1f\n\u3068\u306a\u308b\u3068\u3001\u7d50\u69cb\u30c6\u30b9\u30c8\u66f8\u3044\u3066\u306a\u3044\u4eba\u591a\u3044\u3093\u3058\u3083\u306a\u3044\u304b\u306a\u3068\u601d\u3044\u307e\u3059\u3002\n\u3042\u308b\u3044\u306f\u66f8\u3044\u3066\u3044\u3066\u3082\u3001\u4e2d\u9014\u534a\u7aef\u306a\u3082\u306e\u306b\u306a\u3063\u3061\u3083\u3046\u3093\u3058\u3083\u306a\u3044\u304b\u306a\u3068\u601d\u3046\u3093\u3067\u3059\u3002\n\u305d\u3053\u306b\u8ab2\u984c\u611f\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u3053\u306e\u8a18\u4e8b\u66f8\u304f\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\n\u80cc\u666f\n\u5f0a\u793e\u3067\u306fAWS\u30b5\u30fc\u30d3\u30b9\u7fa4\u3092\u7d50\u69cb\u4f7f\u3063\u3066\u307e\u3057\u3066\u3001\u6700\u8fd1\u306f\u30b3\u30a2\u306a\u6a5f\u80fd\u306e\u90e8\u5206\u306b\n\nDynamoDB\nSQS\n\n\u306a\u3069\u3092\u30ac\u30c3\u30c4\u30ea\u3068\u63a1\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\u6b63\u76f4\u4eca\u307e\u3067\u3082\u4e0a\u8a18\u30b5\u30fc\u30d3\u30b9\u306f\u4f7f\u3063\u3066\u3044\u305f\u306f\u3044\u305f\u3093\u3067\u3059\u304c\u4e00\u90e8\u3060\u3063\u305f\u3068\u3044\u3046\u3053\u3068\u3082\u3042\u308a\u3001\u30c6\u30b9\u30c8\u306b\u529b\u3092\u5165\u308c\u3066\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u305f\u3068\u3048\u3070\u3001DynamoDB\u5468\u308a\u306e\u30c6\u30b9\u30c8\u3068\u304b\u306f\nexpect_any_instance_of(Aws::DynamoDB::Client).to receive(:query).with(expected_query_parameters)\n\n\u307f\u305f\u3044\u306b\u3053\u306e\u5f15\u6570\u3067\u547c\u3073\u51fa\u3055\u308c\u308b\u3053\u3068\u3050\u3089\u3044\u306e\u611f\u3058\u3067\u3057\u304b\u66f8\u3044\u3066\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u3068\u3044\u3046\u304b\u3001\u305d\u308c\u3050\u3089\u3044\u3057\u304b\u3067\u304d\u306a\u3044\u3093\u3067\u3059\u3088\u306d\u3002\u5916\u90e8\u30b5\u30fc\u30d3\u30b9\u3060\u304b\u3089\u3002(\u30db\u30f3\u30c8\u306fAPI\u3092\u5b9f\u969b\u306b\u53e9\u3044\u305f\u7d50\u679c\u306e\u3042\u308c\u3053\u308c\u3092\u30c6\u30b9\u30c8\u3057\u305f\u3044\u3093\u3067\u3059\u3002)\n\n\u8ab2\u984c\n\u305f\u3060\u3001\u30e1\u30a4\u30f3\u3069\u3053\u308d\u3067\u4f7f\u3046\u3068\u306a\u308b\u3068\u3001\u3053\u306e\u30c6\u30b9\u30c8\u3058\u3083\u4e0d\u5b89\u306a\u3093\u3067\u3059\u3088\u306d\u3002\n\u5b9f\u969b\u306b\n\n\u30ea\u30af\u30a8\u30b9\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u4e0d\u8db3\u3057\u3066\u3044\u305f\uff01\n\u30b7\u30f3\u30dc\u30eb\u3092\u30ad\u30fc\u306b\u3057\u3066\u306f\u30c0\u30e1\u3060\u3063\u305f\uff01\n\u8fd4\u308a\u5024\u304c\u9593\u9055\u3063\u3066\u3044\u305f\uff01\n\u30c6\u30fc\u30d6\u30eb\u306e\u5c5e\u6027\u540d\u304c\u5b9f\u306fDynamoDB\u306e\u4e88\u7d04\u8a9e\u3067\u4f7f\u3048\u306a\u304b\u3063\u305f\uff01\n\n\u3053\u3093\u306a\u3053\u3068\u304c\u3001\u666e\u901a\u306b\u3088\u304f\u3042\u308a\u307e\u3057\u305f\u3002 \n\u5b9f\u6a5f\u3067\u30c6\u30b9\u30c8\u3057\u306a\u304d\u3083\u308f\u304b\u3089\u306a\u3044\u3002\u3067\u3082\u3053\u308c\u304c\u3001\u30c6\u30b9\u30c8\u306e\u6bb5\u968e\u3067\u6c17\u4ed8\u3051\u305f\u3089\u751f\u7523\u6027\u3082\u54c1\u8cea\u3082\u30de\u30b8\u4e0a\u304c\u308a\u307e\u3059\u3002\u7cbe\u795e\u885b\u751f\u306e\u9762\u3067\u3082\u96f2\u6ce5\u306e\u5dee\u304c\u51fa\u3066\u304d\u307e\u3059\u3002\n\u30ec\u30b3\u30fc\u30c9\u633f\u5165\u3057\u3066\u3001\u4fdd\u5b58\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u3001\u53d6\u5f97\u3067\u304d\u308b\u3053\u3068\n\u3068\u3044\u3063\u305f\u3088\u3046\u306bRDB\u306b\u5bfe\u3057\u3066\u666e\u901a\u306b\u66f8\u3044\u3066\u3044\u308b\u30c6\u30b9\u30c8\u3068\u540c\u3058\u3053\u3068\u3092\u5b9f\u73fe\u3057\u305f\u3044\u3002\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u306a\u3093\u3068\u304b\u3067\u304d\u306a\u3044\u304b\u3068\u6a21\u7d22\u3057\u6b21\u306e\u65b9\u6cd5\u3067\u5b9f\u73fe\u3057\u307e\u3057\u305f\u3002\n(\u4eca\u56de\u306fDynamoDB\u306b\u7126\u70b9\u3092\u5f53\u3066\u3055\u305b\u3066\u3082\u3089\u3044\u307e\u3059)\n\nDynamoDB\u306e\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\u3092\u5b9f\u73fe\u3059\u308b\n\u7d50\u8ad6\u3001\u5916\u90e8\u30b5\u30fc\u30d3\u30b9\u304c\u4f7f\u3048\u306a\u3044\u306a\u3089\u3001\u30ed\u30fc\u30ab\u30eb\u306b\u540c\u3058(\u540c\u7b49\u306e)\u3082\u306e\u3092\u7acb\u3066\u3066\u3057\u307e\u3048\u3070\u826f\u3044\u3093\u3067\u3059\u3002\nDynamoDB\u306e\u30a8\u30df\u30e5\u30ec\u30fc\u30bf\u3092\u63a2\u3057\u3066\u307f\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u69d8\u306a\u3082\u306e\u304c\u307f\u3064\u304b\u308a\u307e\u3059\u3002\n\nDynamoDB Local\nFake Dynamo\n\nFakeDynamo\u3067\u30c6\u30b9\u30c8\u66f8\u304f\u3068\u3044\u3063\u305f\u8a66\u307f\u3092\u3055\u308c\u305f\u65b9\u3082\u3044\u305f\u3088\u3046\u3067\u3059\u304c\u3001\u73fe\u5728Fake Dynamo\u306f\u3053\u3053\u6570\u5e74\u66f4\u65b0\u304c\u306a\u304fAPI\u3082v1\u306e\u307f\u306b\u5bfe\u5fdc\u3063\u307d\u3044\u3002(\u3068\u3063\u3066\u3082\u5371\u967a\u306a\u9999\u308a\u304c\u3057\u307e\u3059  )\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u4eca\u56de\u306fDynamoDB Local\u3092\u4f7f\u3063\u3066\u74b0\u5883\u69cb\u7bc9\u3092\u3057\u307e\u3057\u305f\u3002\n\nDynamoDB Local\u3068\u306f\n\n\u7279\u5fb4\n\n\naws\u88fd\u516c\u5f0f\u30a8\u30df\u30e5\u30ec\u30fc\u30bf\nDynamoDB API \u3068\u4e92\u63db\u6027\u304c\u3042\u308b\u3002(\u6700\u8fd1\u52a0\u308f\u3063\u305fDynamoDB Stream\u3082\u6271\u3048\u305f\u308a\u3057\u307e\u3059  )\n\u4e2d\u8eab\u306fSQLite\n\n\n\u8a73\u7d30\u4ed5\u69d8\u306f\u3053\u3061\u3089\u3067\n\n\u3042\u304f\u307e\u3067\u958b\u767a\u7528\u306e\u3082\u306e\u3089\u3057\u3044\u3067\u3059\u304c\u3001\u305d\u3053\u3092\u3042\u3048\u3066\u30c6\u30b9\u30c8\u7528\u306b\u4f7f\u3046\u66b4\u6319\u306b\u51fa\u307e\u3057\u305f\uff57\n\n\u30c6\u30b9\u30c8\u74b0\u5883\u69cb\u7bc9\n\n1. DynamoDB Local\u306e\u5c0e\u5165\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306f\u3053\u3061\u3089\u304b\u3089\n\u3088\u304f\u51fa\u6765\u3066\u3066\u3001\u30b3\u30de\u30f3\u30c9\u4e00\u767a\u3067\u52d5\u304d\u3060\u3057\u3066\u304f\u308c\u307e\u3059\u3002\njava -Djava.library.path=./DynamoDBLocal_lib -jar DynamoDBLocal.jar\n# => \u305d\u306e\u3042\u3068\u306f\u3001http://localhost:8000 \u3068\u304b\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u3059\u308c\u3070\u304a\uff4b\n\n\u5f0a\u793e\u306eCI\u74b0\u5883\u306fCircleCI\u306a\u306e\u3067\u3001Docker\u3092\u4f7f\u3063\u3066DynamoDB Local\u3092\u306e\u305b\u305f\u30b3\u30f3\u30c6\u30ca\u3067\u52d5\u304b\u3059\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\nDockerfile\u306f\u3053\u3093\u306a\u611f\u3058\nFROM java:8\n\n# Create working space\nRUN mkdir /var/dynamodb_local\nWORKDIR /var/dynamodb_local\n\n# Default port for DynamoDB Local\nEXPOSE 8000\n\n# Get the package from Amazon\nRUN wget -qO - http://dynamodb-local.s3-website-us-west-2.amazonaws.com/dynamodb_local_latest | tar xzf -\n\n# Default command for image\nENTRYPOINT [\"/usr/bin/java\", \"-Djava.library.path=.\", \"-jar\", \"DynamoDBLocal.jar\"]\nCMD [\"-dbPath\", \"/var/dynamodb_local\"]\n\n\nJenkins\u3068\u304b\u305d\u306e\u4ed6\u306eCI\u74b0\u5883\u3092\u4f7f\u3063\u3066\u3044\u308b\u65b9\u306f\u305d\u308c\u305e\u308c\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u3044\u308c\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\n2. DynamoDB\u306e\u30c6\u30fc\u30d6\u30eb\u30b9\u30ad\u30fc\u30de\u3092\u5b9a\u7fa9\nDynamoDB Local\u304c\u30ed\u30fc\u30ab\u30eb\u3067\u52d5\u304f\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3089\u3001\n\u6b21\u306f\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u521d\u671f\u5316\u306e\u305f\u3081\u306e\u30c6\u30fc\u30d6\u30eb\u30b9\u30ad\u30fc\u30de\u3092\u5b9a\u7fa9\u3057\u3066\u304a\u304d\u307e\u3059\u3002\ndb/dynamodb_schema.yml\u3068\u3044\u3063\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u3063\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3057\u3066\u304a\u304f\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002\n\nDynamoDB\u306e\u30c6\u30fc\u30d6\u30eb\u5b9a\u7fa9\ntables:\n  your_table_name1:\n    :table_name: your_table_name1\n    :key_schema:\n      - :attribute_name: your_prymary_hash_name\n        :key_type: HASH\n      - :attribute_name: your_prymary_range_name\n        :key_type: RANGE\n    :provisioned_throughput:\n      :read_capacity_units: 1\n      :write_capacity_units: 1\n    :attribute_definitions:\n      - :attribute_name: your_prymary_hash_name\n        :attribute_type: N\n      - :attribute_name: your_prymary_range_name\n        :attribute_type: S\n      - :attribute_name: lsi_hash_name\n        :attribute_type: N\n    :local_secondary_indexes:\n      - :index_name: lsi_hash_name-index\n        :key_schema:\n          - :attribute_name: lsi_hash_name\n            :key_type: HASH\n        :projection:\n          :projection_type: ALL\n  your_table_name2:\n    ...\n\n\n\u306a\u304b\u306a\u304b\u610f\u5473\u308f\u304b\u3089\u306a\u3044\u304b\u3082\u3067\u3059\u304c\u3001\nAws::DynamoDB::Client#describe_table(table_name: \u30c6\u30fc\u30d6\u30eb\u540d)\u3067\n\u2191\u306e\u3088\u3046\u306a\u5b9a\u7fa9\u304c\u53d6\u5f97\u3067\u304d\u308b\u306e\u3067\u53c2\u8003\u306b\u306a\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n3. rspec\u3067\u52d5\u304f\u3088\u3046\u306b\u3059\u308b\n\u3053\u3053\u304b\u3089\u5c11\u3057\u9ed2\u9b54\u8853\u611f\u304c\u51fa\u3066\u304d\u307e\u3059\u304c\u3001\u3064\u3044\u3066\u304d\u3066\u304f\u3060\u3055\u3044w\nspec_helper.rb\u306b\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nspec_helper.rb\n# DynamoDB Local\u306e\u8a2d\u5b9a\nddb_schema = YAML.load(ERB.new(File.new('db/dynamodb_schema.yml').read).result)['tables']\nddb_client = Aws::DynamoDB::Client.new(\n  endpoint:           'http://127.0.0.1:8000',  # DynamoDB Local\u306eendpoint\u3092\u6307\u5b9a\n  region:             'your_region',            # \u9069\u5f53\u3067OK\n  access_key_id:      'your_access_key_id',     # \u9069\u5f53\u3067OK\n  secret_access_key:  'your_secret_access_key', # \u9069\u5f53\u3067OK\n  stub_responses:     false,\n)\n\nconfig.prepend_before(:each, dynamodb: true) do\n  # DynamoDB\u306e\u521d\u671f\u5316(\u90fd\u5ea6\u65b0\u898f\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210)\n  # \u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3054\u3068\u306b\u65b0DB&\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\n  ddb_client.config.sigv4_region = SecureRandom.uuid\n  ddb_schema.values.each do|table_schema|\n    ddb_client.create_table table_schema\n  end\n\n  # Aws::DynamoDB::Client.new\u306f\u5e38\u306b\u8a2d\u5b9a\u6e08\u307f(DynamoDB Local\u306b\u5411\u3044\u3066\u3044\u308b)\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8fd4\u3059\n  allow(::Aws::DynamoDB::Client).to receive(:new).and_return(ddb_client)\nend\n\n\n(\u8a2d\u5b9a\u5024\u306f\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3068\u304b\u304b\u3089\u8aad\u3080\u3088\u3046\u306b\u3057\u305f\u307b\u3046\u304c\u30b9\u30de\u30fc\u30c8\u3067\u3059\u3002\u4e0b\u306e\u30b3\u30fc\u30c9\u306f\u308f\u304b\u308a\u3084\u3059\u3055\u306e\u305f\u3081\u306b\u5272\u611b\u3057\u3066\u307e\u3059\u3002)\n\n\u3084\u3063\u3066\u3044\u308b\u3053\u3068\u306f\u4ee5\u4e0b2\u70b9\n\n\nAws::DynamoDB::Client\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u5e38\u306bDynamoDB Local\u306b\u898b\u306b\u3044\u304b\u305b\u308b\u3002\n\u5404\u30c6\u30b9\u30c8\u3054\u3068\u306b\u30c6\u30fc\u30d6\u30eb\u306e\u30c7\u30fc\u30bf\u3092\u521d\u671f\u5316\u3057\u3066\u3044\u308b\u3002\u3044\u308f\u3086\u308btruncate\u307f\u305f\u3044\u306a\u3053\u3068\u3092\u5b9f\u73fe\u3059\u308b\u3002\n\n\nDynamoDB\u306b\u306f\u30c6\u30fc\u30d6\u30eb\u306e\u30c7\u30fc\u30bf\u3092truncate\u3059\u308bAPI\u306f\u5b58\u5728\u3057\u3066\u3044\u307e\u305b\u3093\u3002\uff3c(^o^)\uff0f\n\u306a\u306e\u3067\u3001\u5404\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3054\u3068\u306b\u65b0DB\u3068\u65b0\u30c6\u30fc\u30d6\u30eb\u3092\u3064\u304f\u308b\u3068\u3044\u3046\u8352\u696d\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\u305f\u3060\u3053\u306e\u4f5c\u6210\u30aa\u30da\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u30b3\u30b9\u30c8\u9ad8\u304f\u3001\u3081\u3061\u3083\u304f\u3061\u3083\u91cd\u3044\u3067\u3059\u3002\u306a\u306e\u3067\u4ee5\u4e0b\u306e\u5de5\u592b\u3092\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n\ndynamodb: true\u3068\u3044\u3063\u305f\u30bf\u30b0\u304c\u4e0e\u3048\u3089\u308c\u305f\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u306e\u307f\u3001\u521d\u671f\u5316\u51e6\u7406\u3092\u3059\u308b\u3002\n\n\u6d88\u3059\u21db\u4f5c\u308b\u306f2\u500d\u306e\u30aa\u30da\u30ec\u30fc\u30b7\u30e7\u30f3\u30b3\u30b9\u30c8\u304c\u304b\u304b\u308b\u306e\u3067\u3001\u6d88\u3059\u3053\u3068\u306f\u3057\u306a\u3044\u3002\u65b0\u305f\u306b\u4f5c\u308b\u306e\u307f\u3002\nDynamoDB Local\u306f\u30a2\u30af\u30bb\u30b9\u30ad\u30fcID\u3068\u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u7d44\u307f\u5408\u308f\u305b\u3067DB\u3092\u6c7a\u5b9a\u3057\u307e\u3059\u3002\u3053\u308c\u3092\u5229\u7528\u3057\u3066\u3001\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3054\u3068\u306b\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u5909\u66f4\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n\n\n\n\u307e\u305f\u3001WebMock\u306a\u3069\u3092\u4f7f\u3063\u3066\u308b\u5834\u5408\u306f\u3001\u30ed\u30fc\u30ab\u30eb\u306eDynamoDB Local\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3057\u3066\u304a\u3044\u3066\u3042\u3052\u307e\u3057\u3087\u3046\u3002\nconfig.before(:suite) do\n  # snip\n\n  WebMock.disable_net_connect!(\n    allow_localhost: true,\n    allow: [\n      'http://127.0.0.1:8000', # DynamoDB Local\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\n    ],\n  )\nend\n\n\n\u3042\u3068\u306f\u30c6\u30b9\u30c8\u3092\u66f8\u3044\u3066\u5b9f\u884c\u3059\u308b\u3060\u3051\uff01\n\n\u8d85\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\ndescribe 'DynamoDB\u306e\u30c6\u30b9\u30c8', dynamodb: true do\n describe '#query' do\n   let!(:client) { Aws::DynamoDB::Client.new }\n\n   before do\n     # item\u3092\u4f5c\u3063\u3066\u304a\u304f\n     client.put_item(\n       table_name: self.class.table_name,\n       item:  {\n         your_prymary_hash_name:  'hash_value',\n         your_prymary_range_name: \"range_value\",\n       }\n     )\n   end\n\n   subject do\n     # \u4f5c\u3089\u308c\u305fitem\u3092\u53d6\u5f97\u3059\u308b\n     client.query(\n       table_name: 'your_table_name1',\n       key_condition_expression: 'your_prymary_hash_name = :hash_value',\n       expression_attribute_values: { ':hash_value' => 'hash_value' },\n     )\n   end\n\n   it '\u671f\u5f85\u3059\u308b\u5024\u304c\u53d6\u5f97\u3067\u304d\u308b\u3053\u3068' do\n     expect(subject.items).to eq xxx # \u304a\u597d\u304d\u306a\u30c6\u30b9\u30c8\u3092\u66f8\u3044\u3066\u304f\u3060\u3055\u3044\n   end\n end\nend\n\n\n\n\u6ce8\u610f\n\u3053\u3053\u307e\u3067\u3067\u3001\u304a\u305d\u3089\u304fDynamoDB\u306e\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\u306f\u52d5\u304f\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002 \n\u304c\u3001\u3001\u3001\u3001\n\n\u6d88\u3059\u21db\u4f5c\u308b\u306f2\u500d\u306e\u30aa\u30da\u30ec\u30fc\u30b7\u30e7\u30f3\u30b3\u30b9\u30c8\u304c\u304b\u304b\u308b\u306e\u3067\u3001\u6d88\u3059\u3053\u3068\u306f\u3057\u306a\u3044\u3002\u65b0\u305f\u306b\u4f5c\u308b\u306e\u307f\u3002\n\n\u3068\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u30c6\u30fc\u30d6\u30eb\u3092\u524a\u9664\u3057\u3066\u3044\u306a\u3044\u305f\u3081\u6b8b\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u308b\u306e\u3067\u8981\u6ce8\u610f\u3067\u3059\u3002\n\nDynamoDB Local\u306b\u306f\u30e1\u30e2\u30ea\u8d77\u52d5\u3068\u3044\u3046\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u3042\u308a\u3001\u505c\u6b62\u6642\u306b\u30c7\u30fc\u30bf\u304c\u5168\u524a\u9664\u3055\u308c\u307e\u3059\u3002\n\n\u5f0a\u793e\u3067\u306f\u3053\u308c\u3092\u5229\u7528\u3057\u3066\u3001CircleCI\u3067\u30c6\u30b9\u30c8\u304c\u7d42\u4e86\u3057\u305f\u3089\u3001Docker\u304c\u843d\u3061\u3066\u30c7\u30fc\u30bf\u3092\u6d88\u3057\u3066\u3044\u307e\u3059\u3002\u904b\u304c\u3088\u3044\uff57\uff57\uff57\n\n\u6700\u5f8c\u306b\n\u975e\u5e38\u306b\u9577\u3044\u6295\u7a3f\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u6050\u7e2e\u3067\u3059\u304c\u3001\u307f\u306a\u3055\u307e\u306e\u304a\u52a9\u3051\u306b\u306a\u308c\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\u3061\u306a\u307f\u306b\u3053\u306e\u6a5f\u69cb\u3092\u5165\u308c\u3066\u304b\u3089\u3001\u5f0a\u793e\u3067\u306fDynamoDB\u3067\u306e\u30a8\u30e9\u30fc\u306f\u307b\u307c\u306a\u304f\u306a\u308a\u307e\u3057\u305f\uff01\uff01  \n\u5916\u90e8\u30b5\u30fc\u30d3\u30b9\u3092\u4f7f\u3063\u3066\u3044\u3066\u3082\u3001\u5e38\u306b\u5b89\u5fc3\u3057\u3066\u30ea\u30ea\u30fc\u30b9\u304c\u3067\u304d\u308b\u3068\u3044\u3046\u3053\u3068\u306f\u975e\u5e38\u306b\u3067\u304b\u3044\u3067\u3059\u3002\n\u4eca\u56de\u306fDynamoDB\u3092\u30e1\u30a4\u30f3\u306b\u3057\u307e\u3057\u305f\u304c\u3001\u4e16\u306e\u4e2d\u4f7f\u3048\u308b\u3082\u306e\u306f\u307e\u3060\u307e\u3060\u3042\u308a\u307e\u3059\u3002\nSQS : ElasticMQ\nS3 : Fake S3\n\u3053\u308c\u3089\u3092\u4f7f\u3063\u3066\u74b0\u5883\u69cb\u7bc9\u3059\u308c\u3070\u3001\u30c6\u30b9\u30c8\u304c\u66f8\u3051\u307e\u3059\u3088\uff01\n(SQS\u3067\u306e\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\u306e\u3084\u308a\u65b9\u306f\u5f0a\u793e\u30a8\u30f3\u30b8\u30cb\u30a2@halhide\u304c\u5225\u9014\u3053\u3061\u3089\u3067\u8a18\u4e8b\u66f8\u3044\u3066\u3044\u307e\u3059\u306e\u3067\u53c2\u8003\u306b\u3002)\n\n\u5916\u90e8\u30b5\u30fc\u30d3\u30b9\u306b\u4f9d\u5b58\u3057\u3066\u3044\u308b\u30b3\u30fc\u30c9\u3053\u305d\u3001\u30c6\u30b9\u30c8\u66f8\u3044\u3066\u3044\u304d\u305f\u3044\u3067\u3059\u306d\uff01\uff01\uff01\n[\u3053\u306e\u6295\u7a3f\u306f Sansan Advent Calendar 2015 \u306e 13 \u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002](http://qiita.com/advent-calendar/2015/sansan)\n\n# \u307f\u306a\u3055\u3093\u30c6\u30b9\u30c8\u66f8\u3044\u3066\u307e\u3059\u304b\uff1f\n\u3053\u306e\u6642\u4ee3\u30c6\u30b9\u30c8\u66f8\u3044\u3066\u3044\u306a\u3044\u4eba\u306a\u3093\u3066\u3001\u3044\u306a\u3044\u3067\u3059\u3088\u306d\u3002\n\u3044\u308b\u308f\u3051\u306a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u305f\u3060\u3001\u8cea\u554f\u3092\u5909\u3048\u3066\u3001\n\n__\u5916\u90e8\u30b5\u30fc\u30d3\u30b9\u306b\u4f9d\u5b58\u3059\u308b\u30b3\u30fc\u30c9\u306e\u30c6\u30b9\u30c8\u66f8\u3044\u3066\u307e\u3059\u304b\uff1f__\n\n\u3068\u306a\u308b\u3068\u3001\u7d50\u69cb\u30c6\u30b9\u30c8\u66f8\u3044\u3066\u306a\u3044\u4eba\u591a\u3044\u3093\u3058\u3083\u306a\u3044\u304b\u306a\u3068\u601d\u3044\u307e\u3059\u3002\n\u3042\u308b\u3044\u306f\u66f8\u3044\u3066\u3044\u3066\u3082\u3001\u4e2d\u9014\u534a\u7aef\u306a\u3082\u306e\u306b\u306a\u3063\u3061\u3083\u3046\u3093\u3058\u3083\u306a\u3044\u304b\u306a\u3068\u601d\u3046\u3093\u3067\u3059\u3002\n\n__\u305d\u3053\u306b\u8ab2\u984c\u611f\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u3053\u306e\u8a18\u4e8b\u66f8\u304f\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002__\n\n# \u80cc\u666f\n\u5f0a\u793e\u3067\u306fAWS\u30b5\u30fc\u30d3\u30b9\u7fa4\u3092\u7d50\u69cb\u4f7f\u3063\u3066\u307e\u3057\u3066\u3001\u6700\u8fd1\u306f\u30b3\u30a2\u306a\u6a5f\u80fd\u306e\u90e8\u5206\u306b\n\n* DynamoDB\n* SQS\n\n\u306a\u3069\u3092\u30ac\u30c3\u30c4\u30ea\u3068\u63a1\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u6b63\u76f4\u4eca\u307e\u3067\u3082\u4e0a\u8a18\u30b5\u30fc\u30d3\u30b9\u306f\u4f7f\u3063\u3066\u3044\u305f\u306f\u3044\u305f\u3093\u3067\u3059\u304c\u4e00\u90e8\u3060\u3063\u305f\u3068\u3044\u3046\u3053\u3068\u3082\u3042\u308a\u3001\u30c6\u30b9\u30c8\u306b\u529b\u3092\u5165\u308c\u3066\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n\u305f\u3068\u3048\u3070\u3001DynamoDB\u5468\u308a\u306e\u30c6\u30b9\u30c8\u3068\u304b\u306f\n\n```rb\nexpect_any_instance_of(Aws::DynamoDB::Client).to receive(:query).with(expected_query_parameters)\n```\n\u307f\u305f\u3044\u306b`\u3053\u306e\u5f15\u6570\u3067\u547c\u3073\u51fa\u3055\u308c\u308b\u3053\u3068`\u3050\u3089\u3044\u306e\u611f\u3058\u3067\u3057\u304b\u66f8\u3044\u3066\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u3068\u3044\u3046\u304b\u3001\u305d\u308c\u3050\u3089\u3044\u3057\u304b\u3067\u304d\u306a\u3044\u3093\u3067\u3059\u3088\u306d\u3002__\u5916\u90e8\u30b5\u30fc\u30d3\u30b9\u3060\u304b\u3089\u3002__(\u30db\u30f3\u30c8\u306fAPI\u3092\u5b9f\u969b\u306b\u53e9\u3044\u305f\u7d50\u679c\u306e\u3042\u308c\u3053\u308c\u3092\u30c6\u30b9\u30c8\u3057\u305f\u3044\u3093\u3067\u3059\u3002)\n\n# \u8ab2\u984c\n\u305f\u3060\u3001\u30e1\u30a4\u30f3\u3069\u3053\u308d\u3067\u4f7f\u3046\u3068\u306a\u308b\u3068\u3001\u3053\u306e\u30c6\u30b9\u30c8\u3058\u3083\u4e0d\u5b89\u306a\u3093\u3067\u3059\u3088\u306d\u3002\n\n\u5b9f\u969b\u306b\n\n* \u30ea\u30af\u30a8\u30b9\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u4e0d\u8db3\u3057\u3066\u3044\u305f\uff01\n* \u30b7\u30f3\u30dc\u30eb\u3092\u30ad\u30fc\u306b\u3057\u3066\u306f\u30c0\u30e1\u3060\u3063\u305f\uff01\n* \u8fd4\u308a\u5024\u304c\u9593\u9055\u3063\u3066\u3044\u305f\uff01\n* \u30c6\u30fc\u30d6\u30eb\u306e\u5c5e\u6027\u540d\u304c\u5b9f\u306fDynamoDB\u306e\u4e88\u7d04\u8a9e\u3067\u4f7f\u3048\u306a\u304b\u3063\u305f\uff01\n\n\u3053\u3093\u306a\u3053\u3068\u304c\u3001\u666e\u901a\u306b\u3088\u304f\u3042\u308a\u307e\u3057\u305f\u3002:sweat_smile: \n\u5b9f\u6a5f\u3067\u30c6\u30b9\u30c8\u3057\u306a\u304d\u3083\u308f\u304b\u3089\u306a\u3044\u3002\u3067\u3082\u3053\u308c\u304c\u3001\u30c6\u30b9\u30c8\u306e\u6bb5\u968e\u3067\u6c17\u4ed8\u3051\u305f\u3089\u751f\u7523\u6027\u3082\u54c1\u8cea\u3082\u30de\u30b8\u4e0a\u304c\u308a\u307e\u3059\u3002\u7cbe\u795e\u885b\u751f\u306e\u9762\u3067\u3082\u96f2\u6ce5\u306e\u5dee\u304c\u51fa\u3066\u304d\u307e\u3059\u3002\n\n__\u30ec\u30b3\u30fc\u30c9\u633f\u5165\u3057\u3066\u3001\u4fdd\u5b58\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u3001\u53d6\u5f97\u3067\u304d\u308b\u3053\u3068__\n\u3068\u3044\u3063\u305f\u3088\u3046\u306b`RDB\u306b\u5bfe\u3057\u3066\u666e\u901a\u306b\u66f8\u3044\u3066\u3044\u308b\u30c6\u30b9\u30c8`\u3068\u540c\u3058\u3053\u3068\u3092\u5b9f\u73fe\u3057\u305f\u3044\u3002\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u306a\u3093\u3068\u304b\u3067\u304d\u306a\u3044\u304b\u3068\u6a21\u7d22\u3057\u6b21\u306e\u65b9\u6cd5\u3067\u5b9f\u73fe\u3057\u307e\u3057\u305f\u3002\n(\u4eca\u56de\u306fDynamoDB\u306b\u7126\u70b9\u3092\u5f53\u3066\u3055\u305b\u3066\u3082\u3089\u3044\u307e\u3059)\n\n# DynamoDB\u306e\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\u3092\u5b9f\u73fe\u3059\u308b\n\u7d50\u8ad6\u3001__\u5916\u90e8\u30b5\u30fc\u30d3\u30b9\u304c\u4f7f\u3048\u306a\u3044\u306a\u3089\u3001\u30ed\u30fc\u30ab\u30eb\u306b\u540c\u3058(\u540c\u7b49\u306e)\u3082\u306e\u3092\u7acb\u3066\u3066\u3057\u307e\u3048\u3070\u826f\u3044__\u3093\u3067\u3059\u3002\nDynamoDB\u306e\u30a8\u30df\u30e5\u30ec\u30fc\u30bf\u3092\u63a2\u3057\u3066\u307f\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u69d8\u306a\u3082\u306e\u304c\u307f\u3064\u304b\u308a\u307e\u3059\u3002\n\n* [DynamoDB Local](https://docs.aws.amazon.com/ja_jp/amazondynamodb/latest/developerguide/Tools.DynamoDBLocal.html)\n* [Fake Dynamo](https://github.com/ananthakumaran/fake_dynamo)\n\n[FakeDynamo\u3067\u30c6\u30b9\u30c8\u66f8\u304f](http://qiita.com/necojackarc/items/078a6576f1f651f633b7)\u3068\u3044\u3063\u305f\u8a66\u307f\u3092\u3055\u308c\u305f\u65b9\u3082\u3044\u305f\u3088\u3046\u3067\u3059\u304c\u3001\u73fe\u5728Fake Dynamo\u306f\u3053\u3053\u6570\u5e74\u66f4\u65b0\u304c\u306a\u304fAPI\u3082v1\u306e\u307f\u306b\u5bfe\u5fdc\u3063\u307d\u3044\u3002(\u3068\u3063\u3066\u3082\u5371\u967a\u306a\u9999\u308a\u304c\u3057\u307e\u3059 :bomb: )\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u4eca\u56de\u306fDynamoDB Local\u3092\u4f7f\u3063\u3066\u74b0\u5883\u69cb\u7bc9\u3092\u3057\u307e\u3057\u305f\u3002\n\n# DynamoDB Local\u3068\u306f\n* \u7279\u5fb4\n    * aws\u88fd\u516c\u5f0f\u30a8\u30df\u30e5\u30ec\u30fc\u30bf\n    * DynamoDB API \u3068\u4e92\u63db\u6027\u304c\u3042\u308b\u3002(\u6700\u8fd1\u52a0\u308f\u3063\u305fDynamoDB Stream\u3082\u6271\u3048\u305f\u308a\u3057\u307e\u3059 :clap: )\n    * \u4e2d\u8eab\u306fSQLite\n* \u8a73\u7d30\u4ed5\u69d8\u306f[\u3053\u3061\u3089](https://docs.aws.amazon.com/ja_jp/amazondynamodb/latest/developerguide/Tools.DynamoDBLocal.html)\u3067\n\n\u3042\u304f\u307e\u3067\u958b\u767a\u7528\u306e\u3082\u306e\u3089\u3057\u3044\u3067\u3059\u304c\u3001\u305d\u3053\u3092__\u3042\u3048\u3066\u30c6\u30b9\u30c8\u7528\u306b\u4f7f\u3046\u66b4\u6319__\u306b\u51fa\u307e\u3057\u305f\uff57\n\n# \u30c6\u30b9\u30c8\u74b0\u5883\u69cb\u7bc9\n## 1. DynamoDB Local\u306e\u5c0e\u5165\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306f[\u3053\u3061\u3089](https://docs.aws.amazon.com/ja_jp/amazondynamodb/latest/developerguide/Tools.DynamoDBLocal.html)\u304b\u3089\n\n\u3088\u304f\u51fa\u6765\u3066\u3066\u3001\u30b3\u30de\u30f3\u30c9\u4e00\u767a\u3067\u52d5\u304d\u3060\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\n```bash\njava -Djava.library.path=./DynamoDBLocal_lib -jar DynamoDBLocal.jar\n# => \u305d\u306e\u3042\u3068\u306f\u3001http://localhost:8000 \u3068\u304b\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u3059\u308c\u3070\u304a\uff4b\n```\n\n\u5f0a\u793e\u306eCI\u74b0\u5883\u306f`CircleCI`\u306a\u306e\u3067\u3001Docker\u3092\u4f7f\u3063\u3066`DynamoDB Local`\u3092\u306e\u305b\u305f\u30b3\u30f3\u30c6\u30ca\u3067\u52d5\u304b\u3059\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n```bash:Dockerfile\u306f\u3053\u3093\u306a\u611f\u3058\nFROM java:8\n\n# Create working space\nRUN mkdir /var/dynamodb_local\nWORKDIR /var/dynamodb_local\n\n# Default port for DynamoDB Local\nEXPOSE 8000\n\n# Get the package from Amazon\nRUN wget -qO - http://dynamodb-local.s3-website-us-west-2.amazonaws.com/dynamodb_local_latest | tar xzf -\n\n# Default command for image\nENTRYPOINT [\"/usr/bin/java\", \"-Djava.library.path=.\", \"-jar\", \"DynamoDBLocal.jar\"]\nCMD [\"-dbPath\", \"/var/dynamodb_local\"]\n```\n\nJenkins\u3068\u304b\u305d\u306e\u4ed6\u306eCI\u74b0\u5883\u3092\u4f7f\u3063\u3066\u3044\u308b\u65b9\u306f\u305d\u308c\u305e\u308c\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u3044\u308c\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\n## 2. DynamoDB\u306e\u30c6\u30fc\u30d6\u30eb\u30b9\u30ad\u30fc\u30de\u3092\u5b9a\u7fa9\nDynamoDB Local\u304c\u30ed\u30fc\u30ab\u30eb\u3067\u52d5\u304f\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3089\u3001\n\u6b21\u306f\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u521d\u671f\u5316\u306e\u305f\u3081\u306e\u30c6\u30fc\u30d6\u30eb\u30b9\u30ad\u30fc\u30de\u3092\u5b9a\u7fa9\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n`db/dynamodb_schema.yml`\u3068\u3044\u3063\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u3063\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3057\u3066\u304a\u304f\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002\n\n```rb:DynamoDB\u306e\u30c6\u30fc\u30d6\u30eb\u5b9a\u7fa9\ntables:\n  your_table_name1:\n    :table_name: your_table_name1\n    :key_schema:\n      - :attribute_name: your_prymary_hash_name\n        :key_type: HASH\n      - :attribute_name: your_prymary_range_name\n        :key_type: RANGE\n    :provisioned_throughput:\n      :read_capacity_units: 1\n      :write_capacity_units: 1\n    :attribute_definitions:\n      - :attribute_name: your_prymary_hash_name\n        :attribute_type: N\n      - :attribute_name: your_prymary_range_name\n        :attribute_type: S\n      - :attribute_name: lsi_hash_name\n        :attribute_type: N\n    :local_secondary_indexes:\n      - :index_name: lsi_hash_name-index\n        :key_schema:\n          - :attribute_name: lsi_hash_name\n            :key_type: HASH\n        :projection:\n          :projection_type: ALL\n  your_table_name2:\n    ...\n```\n\u306a\u304b\u306a\u304b\u610f\u5473\u308f\u304b\u3089\u306a\u3044\u304b\u3082\u3067\u3059\u304c\u3001\n`Aws::DynamoDB::Client#describe_table(table_name: \u30c6\u30fc\u30d6\u30eb\u540d)`\u3067\n\u2191\u306e\u3088\u3046\u306a\u5b9a\u7fa9\u304c\u53d6\u5f97\u3067\u304d\u308b\u306e\u3067\u53c2\u8003\u306b\u306a\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n## 3. rspec\u3067\u52d5\u304f\u3088\u3046\u306b\u3059\u308b\n__\u3053\u3053\u304b\u3089\u5c11\u3057\u9ed2\u9b54\u8853\u611f\u304c\u51fa\u3066\u304d\u307e\u3059__\u304c\u3001\u3064\u3044\u3066\u304d\u3066\u304f\u3060\u3055\u3044w\n\nspec_helper.rb\u306b\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```rb:spec_helper.rb\n# DynamoDB Local\u306e\u8a2d\u5b9a\nddb_schema = YAML.load(ERB.new(File.new('db/dynamodb_schema.yml').read).result)['tables']\nddb_client = Aws::DynamoDB::Client.new(\n  endpoint:           'http://127.0.0.1:8000',  # DynamoDB Local\u306eendpoint\u3092\u6307\u5b9a\n  region:             'your_region',            # \u9069\u5f53\u3067OK\n  access_key_id:      'your_access_key_id',     # \u9069\u5f53\u3067OK\n  secret_access_key:  'your_secret_access_key', # \u9069\u5f53\u3067OK\n  stub_responses:     false,\n)\n\nconfig.prepend_before(:each, dynamodb: true) do\n  # DynamoDB\u306e\u521d\u671f\u5316(\u90fd\u5ea6\u65b0\u898f\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210)\n  # \u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3054\u3068\u306b\u65b0DB&\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\n  ddb_client.config.sigv4_region = SecureRandom.uuid\n  ddb_schema.values.each do|table_schema|\n    ddb_client.create_table table_schema\n  end\n\n  # Aws::DynamoDB::Client.new\u306f\u5e38\u306b\u8a2d\u5b9a\u6e08\u307f(DynamoDB Local\u306b\u5411\u3044\u3066\u3044\u308b)\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8fd4\u3059\n  allow(::Aws::DynamoDB::Client).to receive(:new).and_return(ddb_client)\nend\n```\n(\u8a2d\u5b9a\u5024\u306f\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3068\u304b\u304b\u3089\u8aad\u3080\u3088\u3046\u306b\u3057\u305f\u307b\u3046\u304c\u30b9\u30de\u30fc\u30c8\u3067\u3059\u3002\u4e0b\u306e\u30b3\u30fc\u30c9\u306f\u308f\u304b\u308a\u3084\u3059\u3055\u306e\u305f\u3081\u306b\u5272\u611b\u3057\u3066\u307e\u3059\u3002)\n\n### \u3084\u3063\u3066\u3044\u308b\u3053\u3068\u306f\u4ee5\u4e0b2\u70b9\n\n1. `Aws::DynamoDB::Client`\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u5e38\u306b`DynamoDB Local`\u306b\u898b\u306b\u3044\u304b\u305b\u308b\u3002\n2. \u5404\u30c6\u30b9\u30c8\u3054\u3068\u306b\u30c6\u30fc\u30d6\u30eb\u306e\u30c7\u30fc\u30bf\u3092\u521d\u671f\u5316\u3057\u3066\u3044\u308b\u3002\u3044\u308f\u3086\u308btruncate\u307f\u305f\u3044\u306a\u3053\u3068\u3092\u5b9f\u73fe\u3059\u308b\u3002  \n  * __DynamoDB\u306b\u306f\u30c6\u30fc\u30d6\u30eb\u306e\u30c7\u30fc\u30bf\u3092truncate\u3059\u308bAPI\u306f\u5b58\u5728\u3057\u3066\u3044\u307e\u305b\u3093\u3002\uff3c(^o^)\uff0f__  \n  \u306a\u306e\u3067\u3001__\u5404\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3054\u3068\u306b\u65b0DB\u3068\u65b0\u30c6\u30fc\u30d6\u30eb\u3092\u3064\u304f\u308b\u3068\u3044\u3046\u8352\u696d__\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002  \n  \u305f\u3060\u3053\u306e\u4f5c\u6210\u30aa\u30da\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u30b3\u30b9\u30c8\u9ad8\u304f\u3001\u3081\u3061\u3083\u304f\u3061\u3083\u91cd\u3044\u3067\u3059\u3002\u306a\u306e\u3067\u4ee5\u4e0b\u306e\u5de5\u592b\u3092\u3057\u3066\u3044\u307e\u3059\u3002\n     * `dynamodb: true`\u3068\u3044\u3063\u305f\u30bf\u30b0\u304c\u4e0e\u3048\u3089\u308c\u305f\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u306e\u307f\u3001\u521d\u671f\u5316\u51e6\u7406\u3092\u3059\u308b\u3002\n     * `\u6d88\u3059\u21db\u4f5c\u308b`\u306f2\u500d\u306e\u30aa\u30da\u30ec\u30fc\u30b7\u30e7\u30f3\u30b3\u30b9\u30c8\u304c\u304b\u304b\u308b\u306e\u3067\u3001\u6d88\u3059\u3053\u3068\u306f\u3057\u306a\u3044\u3002\u65b0\u305f\u306b\u4f5c\u308b\u306e\u307f\u3002\n        * DynamoDB Local\u306f`\u30a2\u30af\u30bb\u30b9\u30ad\u30fcID\u3068\u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u7d44\u307f\u5408\u308f\u305b`\u3067DB\u3092\u6c7a\u5b9a\u3057\u307e\u3059\u3002\u3053\u308c\u3092\u5229\u7528\u3057\u3066\u3001\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3054\u3068\u306b\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u5909\u66f4\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n\u307e\u305f\u3001WebMock\u306a\u3069\u3092\u4f7f\u3063\u3066\u308b\u5834\u5408\u306f\u3001\u30ed\u30fc\u30ab\u30eb\u306eDynamoDB Local\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3057\u3066\u304a\u3044\u3066\u3042\u3052\u307e\u3057\u3087\u3046\u3002\n\n```rb\nconfig.before(:suite) do\n  # snip\n\n  WebMock.disable_net_connect!(\n    allow_localhost: true,\n    allow: [\n      'http://127.0.0.1:8000', # DynamoDB Local\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\n    ],\n  )\nend\n```\n\n# \u3042\u3068\u306f\u30c6\u30b9\u30c8\u3092\u66f8\u3044\u3066\u5b9f\u884c\u3059\u308b\u3060\u3051\uff01\n\n```rb:\u8d85\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\ndescribe 'DynamoDB\u306e\u30c6\u30b9\u30c8', dynamodb: true do\n describe '#query' do\n   let!(:client) { Aws::DynamoDB::Client.new }\n\n   before do\n     # item\u3092\u4f5c\u3063\u3066\u304a\u304f\n     client.put_item(\n       table_name: self.class.table_name,\n       item:  {\n         your_prymary_hash_name:  'hash_value',\n         your_prymary_range_name: \"range_value\",\n       }\n     )\n   end\n\n   subject do\n     # \u4f5c\u3089\u308c\u305fitem\u3092\u53d6\u5f97\u3059\u308b\n     client.query(\n       table_name: 'your_table_name1',\n       key_condition_expression: 'your_prymary_hash_name = :hash_value',\n       expression_attribute_values: { ':hash_value' => 'hash_value' },\n     )\n   end\n\n   it '\u671f\u5f85\u3059\u308b\u5024\u304c\u53d6\u5f97\u3067\u304d\u308b\u3053\u3068' do\n     expect(subject.items).to eq xxx # \u304a\u597d\u304d\u306a\u30c6\u30b9\u30c8\u3092\u66f8\u3044\u3066\u304f\u3060\u3055\u3044\n   end\n end\nend\n```\n\n# \u6ce8\u610f\n\u3053\u3053\u307e\u3067\u3067\u3001\u304a\u305d\u3089\u304fDynamoDB\u306e\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\u306f\u52d5\u304f\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002:tada: \n\n\u304c\u3001\u3001\u3001\u3001\n\n> \u6d88\u3059\u21db\u4f5c\u308b\u306f2\u500d\u306e\u30aa\u30da\u30ec\u30fc\u30b7\u30e7\u30f3\u30b3\u30b9\u30c8\u304c\u304b\u304b\u308b\u306e\u3067\u3001\u6d88\u3059\u3053\u3068\u306f\u3057\u306a\u3044\u3002\u65b0\u305f\u306b\u4f5c\u308b\u306e\u307f\u3002\n\n\u3068\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u30c6\u30fc\u30d6\u30eb\u3092\u524a\u9664\u3057\u3066\u3044\u306a\u3044\u305f\u3081\u6b8b\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u308b\u306e\u3067\u8981\u6ce8\u610f\u3067\u3059\u3002\n\n* DynamoDB Local\u306b\u306f\u30e1\u30e2\u30ea\u8d77\u52d5\u3068\u3044\u3046\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u3042\u308a\u3001\u505c\u6b62\u6642\u306b\u30c7\u30fc\u30bf\u304c\u5168\u524a\u9664\u3055\u308c\u307e\u3059\u3002\n\n\u5f0a\u793e\u3067\u306f\u3053\u308c\u3092\u5229\u7528\u3057\u3066\u3001CircleCI\u3067\u30c6\u30b9\u30c8\u304c\u7d42\u4e86\u3057\u305f\u3089\u3001Docker\u304c\u843d\u3061\u3066\u30c7\u30fc\u30bf\u3092\u6d88\u3057\u3066\u3044\u307e\u3059\u3002\u904b\u304c\u3088\u3044\uff57\uff57\uff57\n\n# \u6700\u5f8c\u306b\n\u975e\u5e38\u306b\u9577\u3044\u6295\u7a3f\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u6050\u7e2e\u3067\u3059\u304c\u3001\u307f\u306a\u3055\u307e\u306e\u304a\u52a9\u3051\u306b\u306a\u308c\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\n\u3061\u306a\u307f\u306b\u3053\u306e\u6a5f\u69cb\u3092\u5165\u308c\u3066\u304b\u3089\u3001\u5f0a\u793e\u3067\u306fDynamoDB\u3067\u306e\u30a8\u30e9\u30fc\u306f\u307b\u307c\u306a\u304f\u306a\u308a\u307e\u3057\u305f\uff01\uff01:tada: :tada: :tada:\n\n__\u5916\u90e8\u30b5\u30fc\u30d3\u30b9\u3092\u4f7f\u3063\u3066\u3044\u3066\u3082\u3001\u5e38\u306b\u5b89\u5fc3\u3057\u3066\u30ea\u30ea\u30fc\u30b9\u304c\u3067\u304d\u308b\u3068\u3044\u3046\u3053\u3068\u306f\u975e\u5e38\u306b\u3067\u304b\u3044\u3067\u3059\u3002__\n\n\u4eca\u56de\u306fDynamoDB\u3092\u30e1\u30a4\u30f3\u306b\u3057\u307e\u3057\u305f\u304c\u3001\u4e16\u306e\u4e2d\u4f7f\u3048\u308b\u3082\u306e\u306f\u307e\u3060\u307e\u3060\u3042\u308a\u307e\u3059\u3002\n\nSQS : [ElasticMQ](https://github.com/adamw/elasticmq)\nS3 : [Fake S3](https://github.com/jubos/fake-s3)\n\u3053\u308c\u3089\u3092\u4f7f\u3063\u3066\u74b0\u5883\u69cb\u7bc9\u3059\u308c\u3070\u3001\u30c6\u30b9\u30c8\u304c\u66f8\u3051\u307e\u3059\u3088\uff01\n(SQS\u3067\u306e\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\u306e\u3084\u308a\u65b9\u306f\u5f0a\u793e\u30a8\u30f3\u30b8\u30cb\u30a2@halhide\u304c\u5225\u9014[\u3053\u3061\u3089](http://qiita.com/halhide/items/59665e7c5ee1d2b20603)\u3067\u8a18\u4e8b\u66f8\u3044\u3066\u3044\u307e\u3059\u306e\u3067\u53c2\u8003\u306b\u3002)\n\n### __\u5916\u90e8\u30b5\u30fc\u30d3\u30b9\u306b\u4f9d\u5b58\u3057\u3066\u3044\u308b\u30b3\u30fc\u30c9\u3053\u305d__\u3001\u30c6\u30b9\u30c8\u66f8\u3044\u3066\u3044\u304d\u305f\u3044\u3067\u3059\u306d\uff01\uff01\uff01\n", "tags": ["DynamoDB", "AWS", "Ruby", "Rails", "RSpec"]}