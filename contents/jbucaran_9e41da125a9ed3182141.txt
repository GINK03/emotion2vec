{"tags": ["fish", "ShellScript", "shell\u30b9\u30af\u30ea\u30d7\u30c8", "shell"], "context": "\n\n\u9069\u6750\u9069\u6240\n\u9069\u6750\u9069\u6240\u3002\u305d\u306e\u7279\u6027\u306b\u3075\u3055\u308f\u3057\u3044\u4ed5\u4e8b\u306b\u3064\u3051\u308b\u3053\u3068\u3002\n\u3067\u3082\u3001\u9069\u6750\u9069\u6240\u3068\u304b\u8a00\u3063\u3066\u308b\u4f59\u88d5\u306a\u3093\u3066\u306a\u3044\u5834\u5408\u3082\u3042\u308b\u3002\u305d\u308c\u3069\u3053\u308d\u3058\u3083\u306a\u3044\u3001\u3068\u306b\u304b\u304ffish-shell\u3067\u4e26\u884c\u51e6\u7406\u3063\u3066\u3069\u3046\u3084\u3063\u3066\u3067\u304d\u308b\u306e\u304b\uff01\u3068\u3044\u3046\u6642\u3082\u3042\u308b\u3088\u306d\u3002\u3044\u3084\u3001\u672c\u5f53\u306b\uff01\n2016\u5e74\u306e\u982d\u306b\u81ea\u5206\u304c\u516c\u958b\u3057\u305ffish\u30d1\u30c3\u30b1\u30fc\u30b8\u30de\u30cd\u30fc\u30b8\u30e3\u300cFisherman\u300d\u306e\u5834\u5408\u3001\u5fc5\u305afish\u8a00\u8a9e\u3067\u66f8\u304d\u305f\u304b\u3063\u305f\u3051\u3069\u3001\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30fb\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fb\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u306a\u3069\u3001\u305d\u306e\u3078\u3093\u306f\u3084\u3063\u3071\u308a\u4e26\u884c\u51e6\u7406\u304c\u5fc5\u8981\u3060\u3063\u305f\u3002\n\u3061\u306a\u307f\u306b\u3001fish\u3063\u3066\u5168\u7136\u77e5\u3089\u306a\u3044\u4eba\u306f\u516c\u5f0f\u30b5\u30a4\u30c8\u306b\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3082\u3042\u308b\u304b\u3089\u305d\u308c\u3092\u898b\u3066\u307f\u3066\u306d\u3002\n\u3053\u306e\u8a18\u4e8b\u3067\u306ffish\u3092\u4f7f\u3063\u3066\u3001\u306a\u3093\u3067\u3082\u3044\u3044\u304b\u3089\u4e26\u884c\u51e6\u7406\u306e\u3084\u308a\u65b9\u3092\u8aac\u660e\u3059\u308b\u3002\n\n\u30b3\u30de\u30f3\u30c9\u3092\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c\u3057\u305f\u3044\u6642\n\n\u300c&\u300d\u3092\u4f7f\u3046\uff01\n\u4f8b\u3048\u3070\n\n\u30d5\u30a9\u30a2\u30b0\u30e9\u30a6\u30f3\u30c9\nsleep 1\n\n\n\u3068\n\n\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\nsleep 1 &\n\n\n\u306e\u9055\u3044\u306f\u306a\u3093\u3060\u3063\u3051\uff1f\n\n\u524d\u8005\u3060\u3068\u3001\u30b7\u30a7\u30eb\u304csleep 1\u3068\u3044\u3046\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u304c\u7d42\u308f\u308b\u307e\u3067\u30d6\u30ed\u30c3\u30af\u3057\u3066\u308b\u3002\u8981\u306f\u3001\u4ed6\u306e\u7aef\u672b\u306e\u30a6\u30a4\u30f3\u30c9\u30a6\u304b\u30bf\u30d6\u3092\u958b\u304b\u306a\u3044\u3068\u3001\u4ed6\u306b\u306f\u4f55\u3082\u3067\u304d\u306a\u304f\u3066\uff08\u4ed6\u306e\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3063\u305f\u308a\u3059\u308b\u3068\u304b\uff09\u3001\u5f85\u305f\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3063\u3066\u3053\u3068\u3002\u3057\u3070\u3089\u304f\u30d7\u30ed\u30bb\u30b9\u3092\u30d6\u30ed\u30c3\u30af\u3057\u305f\u3044\u3001\u3068\u3044\u3046\u6642\u306f\u3001sleep <seconds>\u304c\u3088\u304f\u4f7f\u308f\u308c\u308b\u3002\n\u5f8c\u8005\u3060\u3068\u30b7\u30a7\u30eb\u304csleep 1\u30b3\u30de\u30f3\u30c9\u3092\u7d42\u308f\u308b\u306e\u3092\u5f85\u305f\u306a\u3044\u3067\u3001\u3059\u3050\u623b\u308b\u3002\n\u623b\u308b\u3068\u3044\u3046\u306e\u306fsleep\u30b3\u30de\u30f3\u30c9\u304c\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c\u3055\u308c\u308b\u3051\u3069\u3001\u30b7\u30a7\u30eb\u306f\u3044\u3064\u3082\u901a\u308a\u306b\u3001\u4ed6\u306e\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3063\u305f\u308a\u3059\u308b\u3068\u304b\u3067\u304d\u308b\uff01\n\n\u3064\u307e\u308a\u3001&\u304c\u524d\u306b\u3064\u3051\u308b\u30b3\u30de\u30f3\u30c9\u3092async\u306b\u5b9f\u884c\u3057\u3066\u304f\u308c\u308b\u3002\n\n\u300cfish -c\u300d\u3082\u3042\u308b\nfish -c \"sleep 5; echo \u90aa\u9b54\u3057\u306b\u304d\u305f\u305e\" &\n\n\u4e0a\u306e\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3064\u3068\u3001\u4f55\u3082\u5909\u5316\u304c\u306a\u3044\u307e\u307eEnter\u3068\u304b\u3059\u308b\u305f\u3073\u6539\u884c\u304c\u7e70\u308a\u8fd4\u3055\u308c\u308b\u3060\u3051\u3002\u666e\u6bb5\u901a\u308a\u306b\u30b7\u30a7\u30eb\u3092\u4f7f\u3063\u3066\u3044\u3066\u3082\u5e73\u6c17\u3002\u305d\u3057\u30665\u79d2\u305f\u3064\u3068\u3044\u304d\u306a\u308a\u90aa\u9b54\u3057\u306b\u304d\u305f\u305e\u3063\u3066\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u306b\u8868\u793a\u3055\u308c\u308b\u3002\nfish -c \"...\"\u306f\u3001node\u3084ruby\u306e-e\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u3088\u3046\u306b\u3001\u5f15\u6570\u304b\u3089\u30b9\u30af\u30ea\u30d7\u30c8\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u53d6\u3089\u305a\u306b\u3001\"...\"\u306e\u90e8\u5206\u3092\u5b9f\u884c\u3059\u308b\u65b9\u6cd5\u3060\u3088\u3002\n\n\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30bf\u30b9\u30af\u3092\u5f85\u3064\u306b\u306f\uff1f\n\n\u524d\u8ff0\u306e\u65b9\u6cd5\n\u3067\u306f\u3001\u524d\u306e\u8aac\u660e\u3060\u3051\u3067\u4e26\u884c\u51e6\u7406\u3092\u3084\u3063\u3066\u307f\u3088\u3046\u3002\nset -l commands \"sleep 1; echo \"{1,2,3}\nfor cmd in $commands\n  fish -c \"$cmd\" &\nend\n\n\n\u9806\u756a\u304c\u975e\u6c7a\u5b9a\u6027\u7684\u306aOutput\u306b\u306a\u308b\n2\n1\n3\n\n\n\u7279\u306b\u554f\u984c\u306a\u3044\u3051\u3069\u3001\u3082\u3057$commands\u306e\u914d\u5217\u306b\u5165\u3063\u3066\u308b\u30b3\u30de\u30f3\u30c9\u305f\u3061\u3092\u4e26\u884c\u3067\u5b9f\u884c\u3057\u305f\u3044\u306e\u306b\u3001\u5168\u90e8\u51fa\u3066\u304f\u308b\u307e\u3067\u5f85\u305f\u306a\u304d\u3083\u3044\u3051\u306a\u304b\u3063\u305f\u3089...\n\u3061\u3087\u3063\u3068\u5acc\u3060\u3051\u3069\u3001fish\u3067\u306fwait\u306e\u3088\u3046\u306a\u30b7\u30a7\u30eb\u30d3\u30eb\u30c8\u30a4\u30f3\u306f\u4eca\u306e\u6240\u306f\u306a\u3044\u306e\u3067\u3001\u81ea\u5206\u306e\u3092\u4f5c\u3089\u306a\u3044\u3068\u3002\n\njobs\u30b3\u30de\u30f3\u30c9\nfish\u3067\u306f\u3001\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u306b\u5b9f\u884c\u4e2d\u30bf\u30b9\u30af\u306eID\u3084status\u3092\u6559\u3048\u3066\u304f\u308c\u308bjobs\u3068\u3044\u3046\u30b3\u30de\u30f3\u30c9\u304c\u4f7f\u3048\u308b\u3002\nfish -c \"sleep 1; echo OK\" &\njobs\n\nJob Group   State   Command\n1   95243   running fish -c \"sleep 1; echo OK\" &\n\njobs\u306eoutput\u304b\u3089ID\u3092\u898b\u3066\u3001\u3069\u306e\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30bf\u30b9\u30af\u304c\u7d42\u308f\u3063\u305f\u304b\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\u3067\u3082\u3001Command\u306e\u5217\u3092\u3088\u304f\u898b\u308b\u3068\u30bf\u30b9\u30af\u306e\u5168\u3066\u306e\u30b3\u30de\u30f3\u30c9\u306f\u305d\u306e\u307e\u307e\u8868\u793a\u3055\u308c\u3061\u3083\u3046\u304b\u3089\u30011\u884c\u3057\u304b\u306a\u3044\u30b3\u30de\u30f3\u30c9\u3060\u3063\u305f\u3089\u7279\u306b\u554f\u984c\u306a\u3044\u3051\u3069\u3001\u8907\u6570\u884c\u306e\u5834\u5408\u306f\u56f0\u308b\u306d\u3002\n\n\u30b7\u30f3\u30d7\u30eb\u306a\u4f8b\nfish -c \"sleep 1\necho OK &\"\n\n\n\n\u4e0d\u4fbf\u306a\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\nJob Group   State   Command\n1   95310   running fish -c \"sleep 1 \necho OK\" &\n\n\n\u3068\u306b\u304b\u304f\u3001jobs\u306eoutput\u304b\u3089ID\u3092\u53d6\u308a\u51fa\u3059\u306b\u306f\u3001\u7c21\u5358\u306a\u69cb\u6587\u89e3\u6790\u7684\u306a\u51e6\u7406\u3092\u3057\u306a\u3044\u3068\u3001\u4e26\u884c\u51e6\u7406\u306e\u305f\u3081\u306b\u3053\u306e\u30b3\u30de\u30f3\u30c9\u304c\u3046\u307e\u304f\u6d3b\u304b\u305b\u306a\u3044\u3002\n\n\u3069\u3053\u3067\u3082awk\n\u3058\u3083\u3001fish\u3060\u3051\u3067\u3053\u3093\u306a\u51e6\u7406\u3059\u308b\u306e\u306f\u9762\u5012\u3060\u304b\u3089\u3001\u3069\u3053\u3067\u3082awk\u3067\u3084\u3063\u3061\u3083\u3046\u3002\n\njobs\u304b\u3089\u30bf\u30b9\u30af\u306eID\u3092\u53d6\u308a\u51fa\u3059\nfunction get_jobs\n    jobs $argv | command awk -v FS=\\t '\n        /[0-9]+\\t/{\n            jobs[++nJobs] = $1\n        }\n        END {\n            for (i in jobs) {\n                print(jobs[i])\n            }\n            exit nJobs == 0\n        }\n    '\nend\n\n\nget_jobs\u306e\u4f7f\u3044\u65b9\u306fjobs\u3068\u540c\u3058\u3002\u3053\u306e\u5834\u5408\u306b\u6c17\u306b\u306a\u308b\u306e\u304c\u30bf\u30b9\u30af\u306eID\u3002\n\n\nget_jobs \u5168\u3066\u306e\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u5b9f\u884c\u4e2d\u30bf\u30b9\u30af\u306eID\n\nget_jobs -l | --last \u6700\u5f8c\u306b\u5b9f\u884c\u3055\u308c\u305f\u3001\u307e\u3060\u5b9f\u884c\u4e2d\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30bf\u30b9\u30af\u306eID\n\n\u3068\u3044\u3046\u3088\u3046\u306b\u306a\u308b\u3002\n\n\u5b9f\u884c\u3059\u308b\uff06\u5f85\u3064\uff01DIY wait\u30b3\u30de\u30f3\u30c9\n\n\u8907\u6570\u30b3\u30de\u30f3\u30c9\u3092\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c\u3067\u304d\u308b \n\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c\u4e2d\u306e\u30bf\u30b9\u30af\uff08\u30b3\u30de\u30f3\u30c9\u305d\u308c\u305e\u308c\u306e\u3053\u3068\uff09\u306eID\u3092\u53d6\u308a\u51fa\u305b\u308b \n\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c\u4e2d\u306e\u30bf\u30b9\u30afID\u306b\u3088\u3063\u3066\u30d6\u30ed\u30c3\u30af\uff08\u5f85\u3064\uff09\u3059\u308b\u306b\u306f\uff1f\n\n\n\u30bf\u30b9\u30afID\u306b\u3088\u308b\u3001\u305d\u306e\u30bf\u30b9\u30af\u304c\u7d42\u308f\u308b\u307e\u3067\u306b\u30b7\u30a7\u30eb\u3092\u30d6\u30ed\u30c3\u30af\u3055\u305b\u308bwait\u95a2\u6570\u304c\u671b\u307e\u3057\u3044\u3002\nfunction wait\n    while true\n        set -l has_jobs\n        set -l all_jobs (get_jobs)\n        or break\n\n        for j in $argv\n            if contains -- $j $all_jobs\n                set -e has_jobs\n                break\n            end\n        end\n\n        if set -q has_jobs\n            break\n        end\n    end\nend\n\n\u3053\u306ewait\u30b3\u30de\u30f3\u30c9\u306e\u4f7f\u3044\u65b9\u3068\u3057\u3066\u306f2\u3064\u3042\u308b\u3002\n\n wait \u5b9f\u884c\u4e2d\u306e\u5168\u30bf\u30b9\u30af\u304c\u7d42\u308f\u308b\u307e\u3067\u30d6\u30ed\u30c3\u30af\n wait <ID> \u6559\u3048\u305f\u30bf\u30b9\u30af\u304c\u7d42\u308f\u308b\u307e\u3067\u30d6\u30ed\u30c3\u30af\n\n\n\u5b9f\u969b\u306b\u3067\u304d\u308b\u3053\u3068\u306f\uff1f\n\u3053\u3053\u307e\u3067\u8aad\u3093\u3067\u304f\u308c\u305f\u4eba\u3001\u3069\u3046\u3082\u3042\u308a\u304c\u3068\u3046\u3001\u304a\u75b2\u308c\u69d8\uff01\nget_jobs\u3068wait\u304c\u63c3\u3063\u305f\u306e\u3067\u3001\u5b9f\u969b\u306b\u4f7f\u3063\u3066\u4f55\u3067\u304d\u308b\u304b\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u4e26\u884cvs\u9010\u6b21\u306e\u4f8b\u3068\u3057\u3066\u3001\u305f\u3068\u3048\u3070\u3001\u5e7e\u3064\u304b\u306eurl\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u6642\u9593\u3092\u6bd4\u3079\u305f\u3044\u3068\u304d\u3002\n\nconcurrency_test.fish\n# get_jobs\u3068wait\u306e\u5b9f\u88c5\u30b3\u30fc\u30c9\u306f\u7701\u7565\n\nset -l urls \"https://\"{google,twitter,youtube,facebook,github,qiita}\".com\"\n\nfor url in $urls\n    fish -c \"curl -Lw \\\"$url: %{time_total}s\\n\\\" -o /dev/null -s $url\" &\nend\n\nwait (get_jobs)\n\n\n\u3055\u30fc\u3001\u3044\u3088\u3044\u3088\u5b9f\u884c\u3057\u3066\u3001\u7d50\u679c\u3092\u898b\u3066\u307f\u3088\u3046\u3002\n\n\u4e26\u884c\u51e6\u7406\u7d50\u679c\nfish < concurrency_test.fish\nhttps://qiita.com: 1.205s\nhttps://google.com: 1.386s\nhttps://github.com: 2.022s\nhttps://facebook.com: 2.169s\nhttps://twitter.com: 2.256s\nhttps://youtube.com: 2.796s\n~                                                  2s 836ms\n\n\n\u3061\u306a\u307f\u306b\u3001\u4e26\u884c\u51e6\u7406\u306e\u3068\u3053\u308d\u3092\u629c\u3051\u3066\u3001\u9010\u6b21\u51e6\u7406\u3067\u5b9f\u884c\u3057\u305f\u7d50\u679c\u306f\n\n\u9010\u6b21\u51e6\u7406\nfish < serial_test.fish\nhttps://google.com: 1.655s\nhttps://twitter.com: 1.444s\nhttps://youtube.com: 2.250s\nhttps://facebook.com: 1.292s\nhttps://github.com: 1.351s\nhttps://qiita.com: 0.184s\n~                                                  8s 225ms\n\n\n\u3084\u3063\u3071\u308a\u4e26\u884c\u51e6\u7406\u306f\u697d\u3057\u3044\u306d\uff01\n\u4eca\u65e5\u306e\u8a18\u4e8b\u306e\u5168\u3066\u306e\u30b3\u30fc\u30c9\u306f  Gist \u306b\u3057\u305f\u306e\u3067\u3001\u3044\u3064\u3067\u3082\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\uff01\n## \u9069\u6750\u9069\u6240\n\n\u9069\u6750\u9069\u6240\u3002\u305d\u306e\u7279\u6027\u306b\u3075\u3055\u308f\u3057\u3044\u4ed5\u4e8b\u306b\u3064\u3051\u308b\u3053\u3068\u3002\n\n\u3067\u3082\u3001\u9069\u6750\u9069\u6240\u3068\u304b\u8a00\u3063\u3066\u308b\u4f59\u88d5\u306a\u3093\u3066\u306a\u3044\u5834\u5408\u3082\u3042\u308b\u3002\u305d\u308c\u3069\u3053\u308d\u3058\u3083\u306a\u3044\u3001\u3068\u306b\u304b\u304ffish-shell\u3067\u4e26\u884c\u51e6\u7406\u3063\u3066\u3069\u3046\u3084\u3063\u3066\u3067\u304d\u308b\u306e\u304b\uff01\u3068\u3044\u3046\u6642\u3082\u3042\u308b\u3088\u306d\u3002\u3044\u3084\u3001\u672c\u5f53\u306b\uff01\n\n\n2016\u5e74\u306e\u982d\u306b\u81ea\u5206\u304c\u516c\u958b\u3057\u305ffish\u30d1\u30c3\u30b1\u30fc\u30b8\u30de\u30cd\u30fc\u30b8\u30e3[\u300cFisherman\u300d](https://github.com/fisherman/fisherman)\u306e\u5834\u5408\u3001\u5fc5\u305afish\u8a00\u8a9e\u3067\u66f8\u304d\u305f\u304b\u3063\u305f\u3051\u3069\u3001\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30fb\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fb\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u306a\u3069\u3001\u305d\u306e\u3078\u3093\u306f\u3084\u3063\u3071\u308a\u4e26\u884c\u51e6\u7406\u304c\u5fc5\u8981\u3060\u3063\u305f\u3002\n\n\n\u3061\u306a\u307f\u306b\u3001[fish](https://github.com/fish-shell/fish-shell)\u3063\u3066\u5168\u7136\u77e5\u3089\u306a\u3044\u4eba\u306f\u516c\u5f0f\u30b5\u30a4\u30c8\u306b\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3082\u3042\u308b\u304b\u3089[\u305d\u308c](https://fishshell.com/docs/current/tutorial.html)\u3092\u898b\u3066\u307f\u3066\u306d\u3002\n\n\n\u3053\u306e\u8a18\u4e8b\u3067\u306ffish\u3092\u4f7f\u3063\u3066\u3001\u306a\u3093\u3067\u3082\u3044\u3044\u304b\u3089\u4e26\u884c\u51e6\u7406\u306e\u3084\u308a\u65b9\u3092\u8aac\u660e\u3059\u308b\u3002\n\n## \u30b3\u30de\u30f3\u30c9\u3092\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c\u3057\u305f\u3044\u6642\n\n###\u300c&\u300d\u3092\u4f7f\u3046\uff01\n\n\u4f8b\u3048\u3070\n\n```zsh:\u30d5\u30a9\u30a2\u30b0\u30e9\u30a6\u30f3\u30c9\nsleep 1\n```\n\n\u3068\n\n```zsh:\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\nsleep 1 &\n```\n\n\u306e\u9055\u3044\u306f\u306a\u3093\u3060\u3063\u3051\uff1f\n\n\n - \u524d\u8005\u3060\u3068\u3001\u30b7\u30a7\u30eb\u304c`sleep 1`\u3068\u3044\u3046\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u304c\u7d42\u308f\u308b\u307e\u3067\u30d6\u30ed\u30c3\u30af\u3057\u3066\u308b\u3002\u8981\u306f\u3001\u4ed6\u306e\u7aef\u672b\u306e\u30a6\u30a4\u30f3\u30c9\u30a6\u304b\u30bf\u30d6\u3092\u958b\u304b\u306a\u3044\u3068\u3001\u4ed6\u306b\u306f\u4f55\u3082\u3067\u304d\u306a\u304f\u3066\uff08\u4ed6\u306e\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3063\u305f\u308a\u3059\u308b\u3068\u304b\uff09\u3001\u5f85\u305f\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3063\u3066\u3053\u3068\u3002\u3057\u3070\u3089\u304f\u30d7\u30ed\u30bb\u30b9\u3092\u30d6\u30ed\u30c3\u30af\u3057\u305f\u3044\u3001\u3068\u3044\u3046\u6642\u306f\u3001`sleep <seconds>`\u304c\u3088\u304f\u4f7f\u308f\u308c\u308b\u3002\n\n - \u5f8c\u8005\u3060\u3068\u30b7\u30a7\u30eb\u304c`sleep 1`\u30b3\u30de\u30f3\u30c9\u3092\u7d42\u308f\u308b\u306e\u3092\u5f85\u305f\u306a\u3044\u3067\u3001\u3059\u3050\u623b\u308b\u3002\n\u623b\u308b\u3068\u3044\u3046\u306e\u306f`sleep`\u30b3\u30de\u30f3\u30c9\u304c\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c\u3055\u308c\u308b\u3051\u3069\u3001\u30b7\u30a7\u30eb\u306f\u3044\u3064\u3082\u901a\u308a\u306b\u3001\u4ed6\u306e\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3063\u305f\u308a\u3059\u308b\u3068\u304b\u3067\u304d\u308b\uff01\n\n\u3064\u307e\u308a\u3001**`&`**\u304c\u524d\u306b\u3064\u3051\u308b\u30b3\u30de\u30f3\u30c9\u3092async\u306b\u5b9f\u884c\u3057\u3066\u304f\u308c\u308b\u3002\n\n\n###\u300cfish -c\u300d\u3082\u3042\u308b\n```zsh\nfish -c \"sleep 5; echo \u90aa\u9b54\u3057\u306b\u304d\u305f\u305e\" &\n```\n\n\u4e0a\u306e\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3064\u3068\u3001\u4f55\u3082\u5909\u5316\u304c\u306a\u3044\u307e\u307eEnter\u3068\u304b\u3059\u308b\u305f\u3073\u6539\u884c\u304c\u7e70\u308a\u8fd4\u3055\u308c\u308b\u3060\u3051\u3002\u666e\u6bb5\u901a\u308a\u306b\u30b7\u30a7\u30eb\u3092\u4f7f\u3063\u3066\u3044\u3066\u3082\u5e73\u6c17\u3002\u305d\u3057\u30665\u79d2\u305f\u3064\u3068\u3044\u304d\u306a\u308a\u90aa\u9b54\u3057\u306b\u304d\u305f\u305e\u3063\u3066\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u306b\u8868\u793a\u3055\u308c\u308b\u3002\n\n`fish -c \"...\"`\u306f\u3001node\u3084ruby\u306e`-e`\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u3088\u3046\u306b\u3001\u5f15\u6570\u304b\u3089\u30b9\u30af\u30ea\u30d7\u30c8\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u53d6\u3089\u305a\u306b\u3001`\"...\"`\u306e\u90e8\u5206\u3092\u5b9f\u884c\u3059\u308b\u65b9\u6cd5\u3060\u3088\u3002\n\n\n## \u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30bf\u30b9\u30af\u3092\u5f85\u3064\u306b\u306f\uff1f\n\n###\u524d\u8ff0\u306e\u65b9\u6cd5\n\n\u3067\u306f\u3001\u524d\u306e\u8aac\u660e\u3060\u3051\u3067\u4e26\u884c\u51e6\u7406\u3092\u3084\u3063\u3066\u307f\u3088\u3046\u3002\n\n```zsh\nset -l commands \"sleep 1; echo \"{1,2,3}\nfor cmd in $commands\n  fish -c \"$cmd\" &\nend\n```\n```text:\u9806\u756a\u304c\u975e\u6c7a\u5b9a\u6027\u7684\u306aOutput\u306b\u306a\u308b\n2\n1\n3\n```\n\n\u7279\u306b\u554f\u984c\u306a\u3044\u3051\u3069\u3001\u3082\u3057`$commands`\u306e\u914d\u5217\u306b\u5165\u3063\u3066\u308b\u30b3\u30de\u30f3\u30c9\u305f\u3061\u3092\u4e26\u884c\u3067\u5b9f\u884c\u3057\u305f\u3044\u306e\u306b\u3001\u5168\u90e8\u51fa\u3066\u304f\u308b\u307e\u3067\u5f85\u305f\u306a\u304d\u3083\u3044\u3051\u306a\u304b\u3063\u305f\u3089...:thinking:\n\n\u3061\u3087\u3063\u3068\u5acc\u3060\u3051\u3069\u3001fish\u3067\u306f[`wait`](https://ja.wikipedia.org/wiki/Wait)\u306e\u3088\u3046\u306a\u30b7\u30a7\u30eb\u30d3\u30eb\u30c8\u30a4\u30f3\u306f\u4eca\u306e\u6240\u306f[\u306a\u3044](https://github.com/fish-shell/fish-shell/issues/2728)\u306e\u3067\u3001\u81ea\u5206\u306e\u3092\u4f5c\u3089\u306a\u3044\u3068\u3002\n\n### `jobs`\u30b3\u30de\u30f3\u30c9\n\nfish\u3067\u306f\u3001\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u306b\u5b9f\u884c\u4e2d\u30bf\u30b9\u30af\u306eID\u3084status\u3092\u6559\u3048\u3066\u304f\u308c\u308b[`jobs`](https://fishshell.com/docs/current/commands.html#jobs)\u3068\u3044\u3046\u30b3\u30de\u30f3\u30c9\u304c\u4f7f\u3048\u308b\u3002\n\n```zsh\nfish -c \"sleep 1; echo OK\" &\njobs\n```\n```text\nJob\tGroup\tState\tCommand\n1\t95243\trunning\tfish -c \"sleep 1; echo OK\" &\n```\n\n`jobs`\u306eoutput\u304b\u3089ID\u3092\u898b\u3066\u3001\u3069\u306e\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30bf\u30b9\u30af\u304c\u7d42\u308f\u3063\u305f\u304b\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\u3067\u3082\u3001`Command`\u306e\u5217\u3092\u3088\u304f\u898b\u308b\u3068\u30bf\u30b9\u30af\u306e\u5168\u3066\u306e\u30b3\u30de\u30f3\u30c9\u306f\u305d\u306e\u307e\u307e\u8868\u793a\u3055\u308c\u3061\u3083\u3046\u304b\u3089\u30011\u884c\u3057\u304b\u306a\u3044\u30b3\u30de\u30f3\u30c9\u3060\u3063\u305f\u3089\u7279\u306b\u554f\u984c\u306a\u3044\u3051\u3069\u3001\u8907\u6570\u884c\u306e\u5834\u5408\u306f\u56f0\u308b\u306d\u3002\n\n```zsh:\u30b7\u30f3\u30d7\u30eb\u306a\u4f8b\nfish -c \"sleep 1\necho OK &\"\n```\n```text:\u4e0d\u4fbf\u306a\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\nJob\tGroup\tState\tCommand\n1\t95310\trunning\tfish -c \"sleep 1 \necho OK\" &\n```\n\n\u3068\u306b\u304b\u304f\u3001`jobs`\u306eoutput\u304b\u3089ID\u3092\u53d6\u308a\u51fa\u3059\u306b\u306f\u3001\u7c21\u5358\u306a\u69cb\u6587\u89e3\u6790\u7684\u306a\u51e6\u7406\u3092\u3057\u306a\u3044\u3068\u3001\u4e26\u884c\u51e6\u7406\u306e\u305f\u3081\u306b\u3053\u306e\u30b3\u30de\u30f3\u30c9\u304c\u3046\u307e\u304f\u6d3b\u304b\u305b\u306a\u3044\u3002\n\n###\u3069\u3053\u3067\u3082awk\n\n\u3058\u3083\u3001fish\u3060\u3051\u3067\u3053\u3093\u306a\u51e6\u7406\u3059\u308b\u306e\u306f\u9762\u5012\u3060\u304b\u3089\u3001\u3069\u3053\u3067\u3082awk\u3067\u3084\u3063\u3061\u3083\u3046\u3002\n\n```zsh:jobs\u304b\u3089\u30bf\u30b9\u30af\u306eID\u3092\u53d6\u308a\u51fa\u3059\nfunction get_jobs\n\tjobs $argv | command awk -v FS=\\t '\n        /[0-9]+\\t/{\n            jobs[++nJobs] = $1\n        }\n        END {\n            for (i in jobs) {\n                print(jobs[i])\n            }\n            exit nJobs == 0\n        }\n    '\nend\n```\n\n`get_jobs`\u306e\u4f7f\u3044\u65b9\u306f[`jobs`](https://fishshell.com/docs/current/commands.html#jobs)\u3068\u540c\u3058\u3002\u3053\u306e\u5834\u5408\u306b\u6c17\u306b\u306a\u308b\u306e\u304c\u30bf\u30b9\u30af\u306eID\u3002\n\n* `get_jobs` \u5168\u3066\u306e\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u5b9f\u884c\u4e2d\u30bf\u30b9\u30af\u306eID\n* `get_jobs -l | --last` \u6700\u5f8c\u306b\u5b9f\u884c\u3055\u308c\u305f\u3001\u307e\u3060\u5b9f\u884c\u4e2d\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30bf\u30b9\u30af\u306eID\n\n\u3068\u3044\u3046\u3088\u3046\u306b\u306a\u308b\u3002\n\n##\u5b9f\u884c\u3059\u308b\uff06\u5f85\u3064\uff01DIY wait\u30b3\u30de\u30f3\u30c9\n\n* \u8907\u6570\u30b3\u30de\u30f3\u30c9\u3092\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c\u3067\u304d\u308b \n* \u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c\u4e2d\u306e\u30bf\u30b9\u30af\uff08\u30b3\u30de\u30f3\u30c9\u305d\u308c\u305e\u308c\u306e\u3053\u3068\uff09\u306eID\u3092\u53d6\u308a\u51fa\u305b\u308b \n* \u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c\u4e2d\u306e\u30bf\u30b9\u30afID\u306b\u3088\u3063\u3066\u30d6\u30ed\u30c3\u30af\uff08\u5f85\u3064\uff09\u3059\u308b\u306b\u306f\uff1f:thinking:\n\n\u30bf\u30b9\u30afID\u306b\u3088\u308b\u3001\u305d\u306e\u30bf\u30b9\u30af\u304c\u7d42\u308f\u308b\u307e\u3067\u306b\u30b7\u30a7\u30eb\u3092\u30d6\u30ed\u30c3\u30af\u3055\u305b\u308b`wait`\u95a2\u6570\u304c\u671b\u307e\u3057\u3044\u3002\n\n```zsh:\nfunction wait\n    while true\n        set -l has_jobs\n        set -l all_jobs (get_jobs)\n        or break\n\n        for j in $argv\n            if contains -- $j $all_jobs\n                set -e has_jobs\n                break\n            end\n        end\n\n        if set -q has_jobs\n            break\n        end\n    end\nend\n```\n\n\u3053\u306ewait\u30b3\u30de\u30f3\u30c9\u306e\u4f7f\u3044\u65b9\u3068\u3057\u3066\u306f2\u3064\u3042\u308b\u3002\n\n1.  `wait` \u5b9f\u884c\u4e2d\u306e\u5168\u30bf\u30b9\u30af\u304c\u7d42\u308f\u308b\u307e\u3067\u30d6\u30ed\u30c3\u30af\n2.   `wait <ID>` \u6559\u3048\u305f\u30bf\u30b9\u30af\u304c\u7d42\u308f\u308b\u307e\u3067\u30d6\u30ed\u30c3\u30af\n\n## \u5b9f\u969b\u306b\u3067\u304d\u308b\u3053\u3068\u306f\uff1f\n\n\u3053\u3053\u307e\u3067\u8aad\u3093\u3067\u304f\u308c\u305f\u4eba\u3001\u3069\u3046\u3082\u3042\u308a\u304c\u3068\u3046\u3001\u304a\u75b2\u308c\u69d8\uff01:tea:\n`get_jobs`\u3068`wait`\u304c\u63c3\u3063\u305f\u306e\u3067\u3001\u5b9f\u969b\u306b\u4f7f\u3063\u3066\u4f55\u3067\u304d\u308b\u304b\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u4e26\u884cvs\u9010\u6b21\u306e\u4f8b\u3068\u3057\u3066\u3001\u305f\u3068\u3048\u3070\u3001\u5e7e\u3064\u304b\u306eurl\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u6642\u9593\u3092\u6bd4\u3079\u305f\u3044\u3068\u304d\u3002\n\n```zsh:concurrency_test.fish\n# get_jobs\u3068wait\u306e\u5b9f\u88c5\u30b3\u30fc\u30c9\u306f\u7701\u7565\n\nset -l urls \"https://\"{google,twitter,youtube,facebook,github,qiita}\".com\"\n\nfor url in $urls\n    fish -c \"curl -Lw \\\"$url: %{time_total}s\\n\\\" -o /dev/null -s $url\" &\nend\n\nwait (get_jobs)\n```\n\n\u3055\u30fc\u3001\u3044\u3088\u3044\u3088\u5b9f\u884c\u3057\u3066\u3001\u7d50\u679c\u3092\u898b\u3066\u307f\u3088\u3046\u3002\n\n```text:\u4e26\u884c\u51e6\u7406\u7d50\u679c\nfish < concurrency_test.fish\nhttps://qiita.com: 1.205s\nhttps://google.com: 1.386s\nhttps://github.com: 2.022s\nhttps://facebook.com: 2.169s\nhttps://twitter.com: 2.256s\nhttps://youtube.com: 2.796s\n~                                                  2s 836ms\n```\n\n\u3061\u306a\u307f\u306b\u3001\u4e26\u884c\u51e6\u7406\u306e\u3068\u3053\u308d\u3092\u629c\u3051\u3066\u3001\u9010\u6b21\u51e6\u7406\u3067\u5b9f\u884c\u3057\u305f\u7d50\u679c\u306f\n\n```test:\u9010\u6b21\u51e6\u7406\nfish < serial_test.fish\nhttps://google.com: 1.655s\nhttps://twitter.com: 1.444s\nhttps://youtube.com: 2.250s\nhttps://facebook.com: 1.292s\nhttps://github.com: 1.351s\nhttps://qiita.com: 0.184s\n~                                                  8s 225ms\n```\n\n\u3084\u3063\u3071\u308a\u4e26\u884c\u51e6\u7406\u306f\u697d\u3057\u3044\u306d\uff01\n\n\n\u4eca\u65e5\u306e\u8a18\u4e8b\u306e\u5168\u3066\u306e\u30b3\u30fc\u30c9\u306f :paperclip: [Gist](https://gist.github.com/jbucaran/353a6f152681eee94e6e9f6d694b28b5) \u306b\u3057\u305f\u306e\u3067\u3001\u3044\u3064\u3067\u3082\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\uff01\n"}