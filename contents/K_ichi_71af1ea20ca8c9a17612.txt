{"context": " More than 1 year has passed since last update.\n\n\u3084\u308b\u3053\u3068\nMithril.js\u304b\u3089Phoenix(Elixir)\u3067\u4f5c\u3063\u305fAPI\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u6295\u3052\u3066json\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u53d6\u5f97\u3059\u308b\n\nAPI\u30b5\u30a4\u30c9\nAPI\u306e\u4f5c\u6210\u306fmix\u30b3\u30de\u30f3\u30c9\u304b\u3089\n\u6163\u308c\u3066\u308b\u3068\u3044\u3046\u3053\u3068\u3067DB\u306fMySQL\u3092\u5229\u7528\n\u672c\u306e\u30bf\u30a4\u30c8\u30eb\u3068\u753b\u50cf\u3092\u8fd4\u5374\u3059\u308bAPI\u3092\u4f5c\u308b\u306e\u3067\u3001\u305d\u306e\u901a\u308a\u306ejson\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u8fd4\u3059\u3088\u3046\u306b\u30b3\u30de\u30f3\u30c9\u304b\u3089\u4f5c\u308b(3\u884c\u76ee)\n\u6700\u5f8c\u306bmigrate\u3059\u308b\u3068\u5408\u308f\u305b\u305f\u30c6\u30fc\u30d6\u30eb\u304c\u51fa\u6765\u308b\u3002\n$ mix phoenix.new api --database mysql\n$ mix ecto.create\n$ mix phoenix.gen.json Book books title:string img_url:string\n$ mix ecto.migrate\n\n\u3053\u308c\u3067\u4e0b\u8a18\u306eURL\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u304b\u3051\u308b\u3068\u30c7\u30fc\u30bf\u304c\u8fd4\u3063\u3066\u304f\u308bAPI\u304c\u51fa\u6765\u308b\u3002\nhttp://localhost:4000/api/book/1\n\n\u30c7\u30fc\u30bf\u3092\u4eee\u3067\u5165\u308c\u3066\u304b\u3089\ncurl\u3067\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u6295\u3052\u3066\u3001\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u3061\u3083\u3093\u3068\u8fd4\u3063\u3066\u304f\u308b\u306e\u3092\u78ba\u8a8d\u3002\n$ curl -H \"Content-Type: application/json\" http://192.168.33.10:4000/api/books/1\n{\"data\":{\"title\":\"\u672c\u306e\u30bf\u30a4\u30c8\u30eb\",\"img_url\":\"http://img.url.jp/img.jpg\",\"id\":1}}\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\nMithril\u306eModel\u3002 Book.read()\u3092\u547c\u3076\u3068API\u304b\u3089\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3066Book\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\u3057\u3066\u8fd4\u5374\u3059\u308b\u3002\n\nbook.js\nvar Book = function(data) {\n  this.title = m.prop(data.title);\n  this.img   = m.prop(data.img);\n};\n\nBook.read = function() {\n  return m.request({method: \"GET\", url: \"http://localhost:4000/api/books/1\"})\n    .then(function (jsonData) {\n      return new Book({title: jsonData.data.title, img: jsonData.data.img_url});\n    });\n};\n\n\n\u5b9f\u969b\u306b\u5b9f\u884c\u3059\u308b\u3068\u4e0b\u8a18\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3002(\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u306flocalhost:3000\u304b\u3089\u914d\u4fe1)\n\u30af\u30ed\u30b9\u30c9\u30e1\u30a4\u30f3\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306f\u8a31\u53ef\u3055\u308c\u3066\u304a\u3089\u305a\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u5f3e\u304b\u308c\u305f\u3002\n\u8a31\u53ef\u8a2d\u5b9a\u3092\u30b5\u30fc\u30d0\u30b5\u30a4\u30c9\u3067\u3057\u3066\u3042\u3052\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3002\nXMLHttpRequest cannot load http://localhost:4000/api/books/1. The 'Access-Control-Allow-Origin' header has a value 'http://localhost:4000' that is not equal to the supplied origin. Origin 'http://localhost:3000' is therefore not allowed access.\n\n\u4e0b\u8a18\u3092\u53c2\u8003\u306bPhoenix\u5074\u306b\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b\n\u53c2\u8003: http://www.leighhalliday.com/cors-in-phoenix\n\nAPI\u30b5\u30a4\u30c9\n\u307e\u305a\u3001\u4e0a\u8a18\u53c2\u8003\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u5c0e\u5165\u3002\nmix\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3002\u6700\u5f8c\u306bcors_plug\u3092\u5165\u308c\u308b\n\nmix.exs\n  defp deps do\n    [{:phoenix, \"~> 1.0.3\"},\n     {:phoenix_ecto, \"~> 1.1\"},\n     {:mariaex, \">= 0.0.0\"},\n     {:phoenix_html, \"~> 2.1\"},\n     {:phoenix_live_reload, \"~> 1.0\", only: :dev},\n     {:cowboy, \"~> 1.0\"},\n     {:cors_plug, \"~> 0.1.4\"}]\n  end\n\n\n\u4e0a\u8a18\u3092\u8ffd\u52a0\u3057\u305f\u3089\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u8ffd\u52a0\u3055\u308c\u308b\n$ mix deps.get\n\n\u8ffd\u52a0\u3057\u305f\u3089router.ex\u306eAPI\u7528pipeline\u306bCORSPlug\u306eplug\u3092\u8ffd\u52a0\u3002\norigin\u3092\u6307\u5b9a\u3059\u308b\u3068header\u306b Access-Control-Allow-Origin\u304c\u8ffd\u52a0\u3055\u308c\u308b\u3002\u4eca\u56de\u306f\u4f5c\u3063\u305f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u304b\u3089\u898b\u308c\u308c\u3070\u3044\u3044\u306e\u3067\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306b\u6307\u5b9a\u3002\n\nrouter.ex\npipeline :api do\n    plug CORSPlug, [origin: \"http://localhost:3000\"]\n    plug :accepts, [\"json\"]\n  end\n\n\n\u3053\u308c\u3067 mix phoenix.server \u3067\u518d\u8d77\u52d5\u3092\u304b\u3051\u308c\u3070\u3081\u3067\u305f\u304f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u304b\u3089API\u304c\u53e9\u3051\u307e\u3057\u305f\u30fc\uff01\n\n# \u3084\u308b\u3053\u3068\n\nMithril.js\u304b\u3089Phoenix(Elixir)\u3067\u4f5c\u3063\u305fAPI\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u6295\u3052\u3066json\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u53d6\u5f97\u3059\u308b\n\n# API\u30b5\u30a4\u30c9\n\nAPI\u306e\u4f5c\u6210\u306fmix\u30b3\u30de\u30f3\u30c9\u304b\u3089\n\n\u6163\u308c\u3066\u308b\u3068\u3044\u3046\u3053\u3068\u3067DB\u306fMySQL\u3092\u5229\u7528\n\u672c\u306e\u30bf\u30a4\u30c8\u30eb\u3068\u753b\u50cf\u3092\u8fd4\u5374\u3059\u308bAPI\u3092\u4f5c\u308b\u306e\u3067\u3001\u305d\u306e\u901a\u308a\u306ejson\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u8fd4\u3059\u3088\u3046\u306b\u30b3\u30de\u30f3\u30c9\u304b\u3089\u4f5c\u308b(3\u884c\u76ee)\n\u6700\u5f8c\u306bmigrate\u3059\u308b\u3068\u5408\u308f\u305b\u305f\u30c6\u30fc\u30d6\u30eb\u304c\u51fa\u6765\u308b\u3002\n\n```\n$ mix phoenix.new api --database mysql\n$ mix ecto.create\n$ mix phoenix.gen.json Book books title:string img_url:string\n$ mix ecto.migrate\n```\n\n\u3053\u308c\u3067\u4e0b\u8a18\u306eURL\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u304b\u3051\u308b\u3068\u30c7\u30fc\u30bf\u304c\u8fd4\u3063\u3066\u304f\u308bAPI\u304c\u51fa\u6765\u308b\u3002\n\n```\nhttp://localhost:4000/api/book/1\n```\n\n\n\u30c7\u30fc\u30bf\u3092\u4eee\u3067\u5165\u308c\u3066\u304b\u3089\ncurl\u3067\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u6295\u3052\u3066\u3001\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u3061\u3083\u3093\u3068\u8fd4\u3063\u3066\u304f\u308b\u306e\u3092\u78ba\u8a8d\u3002\n\n```\n$ curl -H \"Content-Type: application/json\" http://192.168.33.10:4000/api/books/1\n{\"data\":{\"title\":\"\u672c\u306e\u30bf\u30a4\u30c8\u30eb\",\"img_url\":\"http://img.url.jp/img.jpg\",\"id\":1}}\n```\n\n# \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\n\nMithril\u306eModel\u3002 Book.read()\u3092\u547c\u3076\u3068API\u304b\u3089\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3066Book\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\u3057\u3066\u8fd4\u5374\u3059\u308b\u3002\n\n```javascript:book.js\nvar Book = function(data) {\n  this.title = m.prop(data.title);\n  this.img   = m.prop(data.img);\n};\n\nBook.read = function() {\n  return m.request({method: \"GET\", url: \"http://localhost:4000/api/books/1\"})\n    .then(function (jsonData) {\n      return new Book({title: jsonData.data.title, img: jsonData.data.img_url});\n    });\n};\n```\n\n\u5b9f\u969b\u306b\u5b9f\u884c\u3059\u308b\u3068\u4e0b\u8a18\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3002(\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u306flocalhost:3000\u304b\u3089\u914d\u4fe1)\n\u30af\u30ed\u30b9\u30c9\u30e1\u30a4\u30f3\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306f\u8a31\u53ef\u3055\u308c\u3066\u304a\u3089\u305a\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u5f3e\u304b\u308c\u305f\u3002\n\u8a31\u53ef\u8a2d\u5b9a\u3092\u30b5\u30fc\u30d0\u30b5\u30a4\u30c9\u3067\u3057\u3066\u3042\u3052\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3002\n\n```\nXMLHttpRequest cannot load http://localhost:4000/api/books/1. The 'Access-Control-Allow-Origin' header has a value 'http://localhost:4000' that is not equal to the supplied origin. Origin 'http://localhost:3000' is therefore not allowed access.\n```\n\n\n\u4e0b\u8a18\u3092\u53c2\u8003\u306bPhoenix\u5074\u306b\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b\n\u53c2\u8003: http://www.leighhalliday.com/cors-in-phoenix\n\n# API\u30b5\u30a4\u30c9\n\n\u307e\u305a\u3001\u4e0a\u8a18\u53c2\u8003\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u5c0e\u5165\u3002\n\nmix\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3002\u6700\u5f8c\u306bcors_plug\u3092\u5165\u308c\u308b\n\n```elixir:mix.exs\n  defp deps do\n    [{:phoenix, \"~> 1.0.3\"},\n     {:phoenix_ecto, \"~> 1.1\"},\n     {:mariaex, \">= 0.0.0\"},\n     {:phoenix_html, \"~> 2.1\"},\n     {:phoenix_live_reload, \"~> 1.0\", only: :dev},\n     {:cowboy, \"~> 1.0\"},\n     {:cors_plug, \"~> 0.1.4\"}]\n  end\n```\n\n\u4e0a\u8a18\u3092\u8ffd\u52a0\u3057\u305f\u3089\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u8ffd\u52a0\u3055\u308c\u308b\n\n```\n$ mix deps.get\n```\n\n\u8ffd\u52a0\u3057\u305f\u3089router.ex\u306eAPI\u7528pipeline\u306bCORSPlug\u306eplug\u3092\u8ffd\u52a0\u3002\norigin\u3092\u6307\u5b9a\u3059\u308b\u3068header\u306b Access-Control-Allow-Origin\u304c\u8ffd\u52a0\u3055\u308c\u308b\u3002\u4eca\u56de\u306f\u4f5c\u3063\u305f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u304b\u3089\u898b\u308c\u308c\u3070\u3044\u3044\u306e\u3067\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306b\u6307\u5b9a\u3002\n\n```elixir:router.ex\npipeline :api do\n    plug CORSPlug, [origin: \"http://localhost:3000\"]\n    plug :accepts, [\"json\"]\n  end\n```\n\n\u3053\u308c\u3067 mix phoenix.server \u3067\u518d\u8d77\u52d5\u3092\u304b\u3051\u308c\u3070\u3081\u3067\u305f\u304f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u304b\u3089API\u304c\u53e9\u3051\u307e\u3057\u305f\u30fc\uff01\n", "tags": ["Elixir", "Phoenix", "Mithril.js"]}