{"context": "\u793e\u4f1a\u306e\u8352\u6ce2\u306b\u65c5\u7acb\u3063\u3066\u304b\u3089\u65e9\u534a\u5e74\u304c\u7d4c\u904e\u3057\u305f\u7814\u4fee\u306e\u679c\u306b\u3067\u3059\uff61\nCustom Lint Rules\u306b\u3064\u3044\u3066\u66f8\u304d\u307e\u3059\ud83d\ude47\n\nCustom Lint Rules\u306e\u4f5c\u308a\u65b9\u3084\u8aac\u660e\u306a\u3069\u306fhotchemi\u3055\u3093\u306eCustom Lint Rules\u304c\u975e\u5e38\u306b\u53c2\u8003\u306b\u306a\u308b\u306e\u3067\u5fa1\u89a7\u304f\u3060\u3055\u3044\uff61\n\u4eca\u56de\u306f\u5b9f\u969b\u306b\u4f5c\u3063\u3066\u307f\u3066\u30cf\u30de\u3063\u305f\u70b9\u3068\uff64\u65e2\u5b58\u306eGoogle\u306eCode\u3092\u8aad\u3093\u3067\u53c2\u8003\u306b\u306a\u3063\u305f\u90e8\u5206\u3092\u7d39\u4ecb\u3057\u307e\u3059\uff61\n\n\u4f5c\u3063\u305f\u3082\u306e\n\n\u80cc\u666f\nDatabinding\u3092\u4f7f\u3063\u305fNumberPicker\u3067\u306e\u5b9f\u88c5\u306b\u82e5\u5e72\u30cf\u30de\u3063\u305f\u3053\u3068\u304c\u304d\u3063\u304b\u3051\u3067\u3057\u305f\uff61\nNumberPicker\u3067\u306f\u3042\u308a\u304c\u305f\u3044\u3053\u3068\u306bvalue\u306b\u5bfe\u30572-way binding\u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059\uff61\n\u305d\u306e\u305f\u3081\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5b9f\u88c5\u3092\u3057\u307e\u3057\u305f\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<layout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\">\n\n    <data>\n\n        <variable\n            name=\"hoge\"\n            type=\"Hoge\" />\n    </data>\n\n    <FrameLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\">\n\n        <NumberPicker\n            android:id=\"@+id/hoge_number_picker\"\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:descendantFocusability=\"blocksDescendants\"\n            android:value=\"@={hoge.value}\"\n            app:maxValue=\"@{hoge.maxValue}\" />\n\n    </FrameLayout>\n\n</layout>\n\n\u4e00\u898b\u666e\u901a\u306bNumberPicker\u306b\u5bfe\u3057maxValue, value\u304c\u30bb\u30c3\u30c8\u3055\u308c\u308b\u3088\u3046\u306b\u898b\u3048\u307e\u3059\uff61\n\u305f\u3060\uff64\u5b9f\u969b\u306f\u671b\u3093\u3060\u52d5\u304d\u3092\u3057\u307e\u305b\u3093\u3067\u3057\u305f\uff61\n\u4f5c\u6210\u3055\u308c\u305fBinding\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3057\u305f\uff61\n        // batch finished\n        if ((dirtyFlags & 0x19L) != 0) {\n            // api target 1\n\n            android.databinding.adapters.NumberPickerBindingAdapter.setValue(this.hogeNumberPicker, value);\n        }\n        if ((dirtyFlags & 0x11L) != 0) {\n            // api target 11\n            if(getBuildSdkInt() >= 11) {\n                this.hogeNumberPicker.setMaxValue(maxValue);\n            }\n        }\n\n...!!!\nsetValue -> setMaxValue\u306e\u9806\u756a\u3067\u547c\u3070\u308c\u3066\u3044\u308b!!\n\u3068\u3044\u3063\u305f\u3053\u3068\u304c\u8d77\u304d\u305f\u308f\u3051\u3067\u3059\uff61\nNumberPicker\u81ea\u8eab\u304c\u6700\u5927\u5024\u3092\u77e5\u3089\u306a\u3044\u72b6\u614b\u3067\u3044\u304d\u306a\u308a\uff623\u30b9\u30af\u30ed\u30fc\u30eb\u76ee!\uff63\u3068\u8a00\u308f\u308c\u3066\u3082\u56f0\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3088\u306d\uff61\n\u3068\u3044\u3046\u3053\u3068\u3067\uff64\u8868\u793a\u304c\u304d\u3061\u3093\u3068\u3055\u308c\u306a\u304f\u3066\u56f0\u308a\u307e\u3059\uff61\n\n\u89e3\u6c7a\u7b56\n\nViewModel\u3067\u5bfe\u5fdc\u3059\u308b\nNumberPicker\u3092\u7d99\u627f\u3057\u305fCustomView\u3092\u4f5c\u308b\n\n\u4e0a\u8a18\u306e2\u30d1\u30bf\u30fc\u30f3\u304c\u3059\u3050\u601d\u3044\u3064\u304f\u304b\u3068\u601d\u3044\u307e\u3059\uff61\n\u4eca\u56de\u306f\u306a\u3093\u3068\u306a\u304f NumberPicker\u3092\u7d99\u627f\u3057\u305fCustomView\u3092\u4f5c\u308b \u306e\u65b9\u3067\u5b9f\u88c5\u3092\u9032\u3081\u307e\u3057\u305f\uff61\nclass DatabindingableNumberPicker : NumberPicker {\n    constructor(context: Context) : super(context)\n    constructor(context: Context, attributeSet: AttributeSet) : super(context, attributeSet)\n    constructor(context: Context, attributeSet: AttributeSet, defStyleAttr: Int) : super(context, attributeSet, defStyleAttr)\n\n    private var isCallSetMaxValueBeforeSetValue = false\n    private var tempValue = 0\n\n    override fun setValue(value: Int) {\n        if (!isCallSetMaxValueBeforeSetValue) {\n            tempValue = value\n            isCallSetMaxValueBeforeSetValue = true\n        } else {\n            super.setValue(value)\n        }\n    }\n\n    override fun setMaxValue(maxValue: Int) {\n        super.setMaxValue(maxValue)\n        if (isCallSetMaxValueBeforeSetValue) {\n            value = tempValue\n        } else {\n            isCallSetMaxValueBeforeSetValue = true\n        }\n    }\n}\n\n\u4e0a\u8a18\u306eCustomView\u3092\u4e0b\u8a18\u306e\u3088\u3046\u306b\u5b9f\u88c5\u3059\u308c\u3070\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<layout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\">\n\n    <data>\n\n        <variable\n            name=\"hoge\"\n            type=\"Hoge\" />\n    </data>\n\n    <FrameLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\">\n\n        <DatabindingableNumberPicker\n            android:id=\"@+id/hoge_number_picker\"\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:descendantFocusability=\"blocksDescendants\"\n            android:value=\"@={hoge.value}\"\n            app:maxValue=\"@{hoge.maxValue}\" />\n\n    </FrameLayout>\n\n</layout>\n\nView\u306e\u540d\u524d\u306e\u5909\u66f4\u3060\u3051\u3067XML\u5074\u306e\u57fa\u672c\u7684\u306a\u5b9f\u88c5\u3092\u5909\u3048\u305a\u306b\u4f7f\u3046\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\uff61\n\u3053\u308c\u3067\u30cf\u30c3\u30d4\u30fc\u3067\u3059\uff61\n\n\n\n\n\u305d\u3046\uff64\u3053\u308c\u306f\u5168\u3066\u3092\u89e3\u6c7a\u3057\u3066\u306a\u3044\u3093\u3067\u3059\uff61\n\u7d50\u5c40\u65b0\u3057\u304f\u4f5c\u3063\u305fView\u3092\u4f7f\u3046\u306e\u3092\u5fd8\u308c\u3066\u3057\u307e\u3063\u3066\u306f\u610f\u5473\u304c\u3042\u308a\u307e\u305b\u3093\uff61\n\u305d\u3053\u3067Custom Lint Rules\u304c\u982d\u3092\u3088\u304e\u308a\uff64\u4f5c\u6210\u306b\u81f3\u3063\u305f\u3068\u3044\u3046\u308f\u3051\u3067\u3059\uff61\n\nDetector\u306e\u4f5c\u6210\n\u4eca\u56de\u306eCustomLint Rules\u306e\u65b9\u91dd\u306f NumberPicker\u306b\"android:value\"\u5c5e\u6027\u304c\u3042\u308b\u5834\u5408\u306f\u8b66\u544a\u3092\u51fa\u3059 \u3068\u3044\u3046\u3053\u3068\u3067\u9032\u3081\u307e\u3057\u305f\uff61\npublic class NotUsageDatabindingableNumberPickerDetector extends LayoutDetector {\n\n    public static final Issue ISSUE = Issue.create(\n            \"NotUsageDatabindingableNumberPicker\",\n            \"Using NumberPicker!!!!\",\n            \"When using NumberPicker with `Databinding`, you must use `DatabindingableNumberPicker`.\",\n            Category.MESSAGES,\n            10,\n            Severity.ERROR,\n            new Implementation(\n                    NotUsageDatabindingableNumberPickerDetector.class,\n                    Scope.RESOURCE_FILE_SCOPE));\n\n    public NotUsageDatabindingableNumberPickerDetector() {\n    }\n\n    @Override\n    public Speed getSpeed() {\n        return Speed.FAST;\n    }\n\n    public static final String NUMBER_PICKER = \"NumberPicker\";\n\n    @Override\n    public Collection<String> getApplicableElements() {\n        return Collections.singletonList(NUMBER_PICKER);\n    }\n\n    @Override\n    public void visitElement(@NonNull XmlContext context, @NonNull Element element) {\n        if (!element.hasAttribute(PREFIX_ANDROID + ATTR_VALUE)) {\n            return;\n        }\n        final Attr attributeNode = element.getAttributeNode(PREFIX_ANDROID + ATTR_VALUE);\n        final String attributeValue = attributeNode.getValue();\n        final boolean isUseDatabinding = attributeValue.startsWith(\"@={\") && attributeValue.endsWith(\"}\");\n        if (isUseDatabinding) {\n            context.report(\n                    ISSUE,\n                    attributeNode,\n                    context.getLocation(attributeNode),\n                    \"This NumberPicker should be a DatabindingableNumberPicker\");\n        }\n    }\n}\n\n\u57fa\u672c\u7684\u306b\u8aac\u660e\u3059\u308b\u3053\u3068\u306f\u3042\u308a\u307e\u305b\u3093\u304c\uff64\u82e5\u5e72\u6b62\u307e\u3063\u305f\u90e8\u5206\u306fElement#hasAttribute\u306bATTR_VALUE\u3060\u3051\u3092\u6e21\u3057\u3066\u3044\u305f\u3093\u3067\u3059\u304c\uff64\u30c0\u30e1\u3067\u3057\u305f...\n\nDetectorTest\u306e\u4f5c\u6210\nCustom Lint Rules\u3092\u4f5c\u308b\u306b\u3042\u305f\u3063\u3066\uff64\u304d\u3061\u3093\u3068\u52d5\u304f\u3053\u3068\u3092\u4fdd\u8a3c\u3059\u308b\u5927\u4e8b\u306a\u90e8\u5206\u3067\u3059\uff61\n\u5148\u306bTest\u3092\u66f8\u3044\u3066\u304b\u3089Detector\u306e\u4f5c\u6210\u3092\u3057\u305f\u307b\u3046\u304c\u672c\u5f53\u306b\u52b9\u7387\u304c\u826f\u3044\u3067\u3059\uff61\nDetector\u306eTest\u306fLintDetectorTest\u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u305d\u3061\u3089\u3092\u4f7f\u3046\u3068\u7c21\u5358\u306bTest\u3092\u66f8\u304f\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\uff61\npublic class NotUsageDatabindingableNumberPickerDetectorTest extends LintDetectorTest {\n\n    private static String NO_WARNING = \"No warnings.\";\n\n    @Override\n    protected Detector getDetector() {\n        return new NotUsageDatabindingableNumberPickerDetector();\n    }\n\n    @Override\n    protected List<Issue> getIssues() {\n        return Collections.singletonList(NotUsageDatabindingableNumberPickerDetector.ISSUE);\n    }\n\n    public void testUseNumberPickerWhenNotUseDatabinding() throws Exception {\n        final String result = lintProject(xml(\"res/layout/test.xml\", TestData.USE_NUMBER_PICKER_WHEN_NOT_USE_DATABINDING));\n\n        assertEquals(NO_WARNING, result);\n    }\n\n    public void testUseDatabindingableNumberPickerWhenUseDatabinding() throws Exception {\n        final String result = lintProject(xml(\"res/layout/test.xml\", TestData.USE_DATABINDINGABLE_NUMBER_PICKER_WHEN_USE_DATABINDING));\n\n        assertEquals(NO_WARNING, result);\n    }\n\n    public void testUseNumberPickerWhenUseDatabinding() throws Exception {\n        final String result = lintProject(xml(\"res/layout/test.xml\", TestData.USE_NUMBER_PICKER_WHEN_USE_DATABINDING));\n\n        assertEquals(\"\" +\n                        \"res/layout/test.xml:19: Error: This NumberPicker should be a DatabindingableNumberPicker [NotUsageDatabindingableNumberPicker]\\n\" +\n                        \"            android:value=\\\"@={hgoe}\\\" />\\n\" +\n                        \"            ~~~~~~~~~~~~~~~~~~~~~~~~\\n\" +\n                        \"1 errors, 0 warnings\\n\",\n                result);\n    }\n}\n\nTestData.java\nTest\u3092\u4f5c\u308b\u306b\u5f53\u305f\u3063\u3066\u5e7e\u3064\u304b\u30cf\u30de\u3063\u305f\u70b9\u304c\u3042\u308b\u306e\u3067\u305d\u3061\u3089\u3092\u7d39\u4ecb\u3057\u307e\u3059\uff61\n\u307e\u305a\u306f\u3058\u3081\u306b\uff64\nxml(\"res/layout/test.xml\",TestData.USE_DATABINDINGABLE_NUMBER_PICKER_WHEN_USE_DATABINDING)\n\u306e\u90e8\u5206\uff61\nxml(String to, String source) \u306eto\u306b\u306fLayout Resources\u3067\u3042\u308b\u3053\u3068\u3092\u304d\u3061\u3093\u3068\u66f8\u304b\u306a\u3044\u3068\u8a8d\u8b58\u3057\u3066\u304f\u308c\u307e\u305b\u3093\uff61\n\u5177\u4f53\u7684\u306b\u306f\"res/leyout/hoge.xml\"\u306e\u3088\u3046\u306b\"res/layout\"\u304c\u975e\u5e38\u306b\u5927\u4e8b\u3067\u3059\uff61\n\u81ea\u5206\u306f\u3053\u308c\u306730\u5206\u6d88\u8017\u3057\u307e\u3057\u305f\uff61\n\u7d9a\u3044\u3066\u306fsource\u306e\u90e8\u5206\uff61\n    static String USE_NUMBER_PICKER_WHEN_USE_DATABINDING = \"\" +\n            \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?>\\n\" +\n            \"<layout>\\n\" +\n            \"\\n\" +\n            \"    <data>\\n\" +\n            \"\\n\" +\n            \"        <variable\\n\" +\n            \"            name=\\\"hgoe\\\"\\n\" +\n            \"            type=\\\"int\\\" />\\n\" +\n            \"    </data>\\n\" +\n            \"\\n\" +\n            \"    <LinearLayout xmlns:android=\\\"http://schemas.android.com/apk/res/android\\\"\\n\" +\n            \"        android:layout_width=\\\"match_parent\\\"\\n\" +\n            \"        android:layout_height=\\\"match_parent\\\"\\n\" +\n            \"        android:orientation=\\\"vertical\\\">\\n\" +\n            \"\\n\" +\n            \"        <NumberPicker\\n\" +\n            \"            android:layout_width=\\\"wrap_content\\\"\\n\" +\n            \"            android:layout_height=\\\"wrap_content\\\"\\n\" +\n            \"            android:value=\\\"@={hgoe}\\\" />\\n\" +\n            \"\\n\" +\n            \"    </LinearLayout>\\n\" +\n            \"\\n\" +\n            \"</layout>\";\n\n\u304d\u3061\u3093\u3068\u30d3\u30eb\u30c9\u304c\u901a\u308b\u3088\u3046\u306alayout xml\u3067\u306a\u3044\u3068\u3044\u3051\u307e\u305b\u3093\uff61\n\u9069\u5f53\u306b\u66f8\u3044\u3066\u3082\u884c\u3051\u308b\u3060\u308d\u3046\u3068\u8003\u3048\u3066\uff64\u9069\u5f53\u306b\u66f8\u3044\u305f\u3089\u8f9b\u304f\u306a\u308a\u307e\u3059\uff61\n\u3053\u308c\u306730\u5206\u6d88\u8017\u3057\u307e\u3057\u305f...\n\n\u5f8c\u306f\u7d30\u304b\u3044\u8a2d\u5b9a\nCI\u306eTask\u306b\u8ffd\u52a0\u3057\u305f\u308a\uff64Github\u306ePR Template\u3092\u66f4\u65b0\u3059\u308b\u306a\u3069\u3057\u3066\uff64\u5b9a\u671f\u7684\u306b\n./gradlew check\n\u3092\u8d70\u3089\u305b\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\uff61\n\n\u4eca\u56de\u3067\u304d\u306a\u304b\u3063\u305f\u3053\u3068\n\u666e\u6bb5Circle CI\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3059\u304c\uff64CI\u3067Lint check\u3092\u3057\u305f\u6642\u306b\u9650\u308a\uff64Severity\u304cError\u304b\u3089Warning\u306b\u4e0a\u66f8\u304d\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\uff61\n\u307b\u3093\u3068\u306a\u3093\u3067\u3060\u308d\u3046...\nCI\u3092Lint Error\u3067\u843d\u3068\u3057\u305f\u3044\u3093\u3067\u3059\u304c\uff64Warning\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067CI\u81ea\u4f53\u304c\u901a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\uff61\n\u306a\u306e\u3067Lint\u7d50\u679c\u306eXML\u3092Parse\u3057\uff64Priority\u3092\u307f\u3066CI\u3092\u843d\u3068\u305d\u3046\u304b\u306a\u3068\u8003\u3048\u3066\u3044\u307e\u3059\uff61\n\u3068\u3044\u3046\u3053\u3068\u3067\u4eca\u56de\u4f5c\u3063\u305fCustom Lint Rules\u306e\u7d39\u4ecb\u7d42\u308f\u308a\ud83d\ude47\n\n\u53c2\u8003\u306b\u3057\u305fDetector\u306eCode\n\nAccessibilityDetector\n\nImageView\u306bcontentDescription\u304c\u306a\u3044\u3068layout\u3067\u3088\u304f\u9ec4\u8272\u304f\u306a\u3063\u3066\u3044\u305f\u30a2\u30ec\u3067\u3059\uff61\nhint\u3068contentDescription\u4e21\u65b9\u540c\u6642\u306b\u6307\u5b9a\u3057\u305f\u3089\u3044\u3051\u306a\u304b\u3063\u305f\u3093\u3067\u3059\u306d\uff64\u77e5\u3089\u306a\u304b\u3063\u305f\uff61\ncontentDescription=\"\"\ncontentDescription=\"TODO\"\nTODO\u3082Lint\u306b\u5f15\u3063\u304b\u304b\u308b\u308b\u3093\u3067\u3059\u306d...\n\nDeprecationDetector\n\n\u4e00\u756a\u5b9f\u88c5\u306e\u53c2\u8003\u306b\u306a\u3063\u305f\uff61\n\nHardcodedValuesDetector\n\nAttribute\u53d6\u5f97\u5468\u308a\u53c2\u8003\u306b\u306a\u308b\uff61\n\nWebViewDetector\n\n\n\u7d42\u308f\u308a\u306b\nCustom Lint Rules\u826f\u3044\u3067\u3059\u306d\uff61\n\u3069\u308c\u3060\u3051\u81ea\u5df1\u30ec\u30d3\u30e5\u30fc\u3092\u3084\u3063\u3066\u3082\u898b\u3064\u3051\u51fa\u305b\u306a\u3044\u30d0\u30b0\u3084\uff64\u5f15\u304d\u7d99\u3044\u3060\u969b\u306e\u4ed5\u69d8\u5831\u544a\u6f0f\u308c\u306a\u3069\uff64\u4eba\u70ba\u7684\u306a\u30df\u30b9\u3067\u591a\u304f\u306e\u30d0\u30b0\u304c\u751f\u307e\u308c\u307e\u3059\uff61\n\u3067\u304d\u308b\u3060\u3051\u4eba\u9593\u306e\u624b\u3092\u4ecb\u3055\u306a\u3044\u3088\u3046\u306bCheck\u3057\u3066\u3044\u304f\u3068\u3044\u3046\u306e\u306f\u975e\u5e38\u306b\u826f\u3044\u3068\u601d\u3044\u307e\u3059\uff61\n\uff62\u6a2a\u5c55\u958b\uff63\u304c\u3044\u3063\u3071\u3044\u51fa\u6765\u308b\u3088\u3046\u306b\u3069\u3093\u3069\u3093\u4f5c\u3063\u3066\u3044\u304d\u305f\u3044\u3067\u3059\u306d\uff61\n\u826f\u3044\u30b5\u30fc\u30d3\u30b9\u306f\u826f\u3044\u958b\u767a\u57fa\u76e4\u304b\u3089\uff61\n\u793e\u4f1a\u306e\u8352\u6ce2\u306b\u65c5\u7acb\u3063\u3066\u304b\u3089\u65e9\u534a\u5e74\u304c\u7d4c\u904e\u3057\u305f[\u7814\u4fee\u306e\u679c\u306b](https://twitter.com/amyu_san)\u3067\u3059\uff61\n**Custom Lint Rules**\u306b\u3064\u3044\u3066\u66f8\u304d\u307e\u3059\ud83d\ude47\n\n---\n\nCustom Lint Rules\u306e\u4f5c\u308a\u65b9\u3084\u8aac\u660e\u306a\u3069\u306fhotchemi\u3055\u3093\u306e[Custom Lint Rules](http://qiita.com/hotchemi/items/9364d54a0e024a5e6275)\u304c\u975e\u5e38\u306b\u53c2\u8003\u306b\u306a\u308b\u306e\u3067\u5fa1\u89a7\u304f\u3060\u3055\u3044\uff61\n\u4eca\u56de\u306f\u5b9f\u969b\u306b\u4f5c\u3063\u3066\u307f\u3066\u30cf\u30de\u3063\u305f\u70b9\u3068\uff64\u65e2\u5b58\u306eGoogle\u306eCode\u3092\u8aad\u3093\u3067\u53c2\u8003\u306b\u306a\u3063\u305f\u90e8\u5206\u3092\u7d39\u4ecb\u3057\u307e\u3059\uff61\n\n# \u4f5c\u3063\u305f\u3082\u306e\n\n## \u80cc\u666f\nDatabinding\u3092\u4f7f\u3063\u305fNumberPicker\u3067\u306e\u5b9f\u88c5\u306b\u82e5\u5e72\u30cf\u30de\u3063\u305f\u3053\u3068\u304c\u304d\u3063\u304b\u3051\u3067\u3057\u305f\uff61\nNumberPicker\u3067\u306f\u3042\u308a\u304c\u305f\u3044\u3053\u3068\u306bvalue\u306b\u5bfe\u30572-way binding\u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059\uff61\n\u305d\u306e\u305f\u3081\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5b9f\u88c5\u3092\u3057\u307e\u3057\u305f\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<layout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\">\n\n    <data>\n\n        <variable\n            name=\"hoge\"\n            type=\"Hoge\" />\n    </data>\n\n    <FrameLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\">\n\n        <NumberPicker\n            android:id=\"@+id/hoge_number_picker\"\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:descendantFocusability=\"blocksDescendants\"\n            android:value=\"@={hoge.value}\"\n            app:maxValue=\"@{hoge.maxValue}\" />\n\n    </FrameLayout>\n\n</layout>\n```\n\u4e00\u898b\u666e\u901a\u306bNumberPicker\u306b\u5bfe\u3057maxValue, value\u304c\u30bb\u30c3\u30c8\u3055\u308c\u308b\u3088\u3046\u306b\u898b\u3048\u307e\u3059\uff61\n\u305f\u3060\uff64\u5b9f\u969b\u306f\u671b\u3093\u3060\u52d5\u304d\u3092\u3057\u307e\u305b\u3093\u3067\u3057\u305f\uff61\n\n\u4f5c\u6210\u3055\u308c\u305fBinding\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3057\u305f\uff61\n\n```java\n        // batch finished\n        if ((dirtyFlags & 0x19L) != 0) {\n            // api target 1\n\n            android.databinding.adapters.NumberPickerBindingAdapter.setValue(this.hogeNumberPicker, value);\n        }\n        if ((dirtyFlags & 0x11L) != 0) {\n            // api target 11\n            if(getBuildSdkInt() >= 11) {\n                this.hogeNumberPicker.setMaxValue(maxValue);\n            }\n        }\n```\n...!!!\nsetValue -> setMaxValue\u306e\u9806\u756a\u3067\u547c\u3070\u308c\u3066\u3044\u308b!!\n\u3068\u3044\u3063\u305f\u3053\u3068\u304c\u8d77\u304d\u305f\u308f\u3051\u3067\u3059\uff61\nNumberPicker\u81ea\u8eab\u304c\u6700\u5927\u5024\u3092\u77e5\u3089\u306a\u3044\u72b6\u614b\u3067\u3044\u304d\u306a\u308a\uff623\u30b9\u30af\u30ed\u30fc\u30eb\u76ee!\uff63\u3068\u8a00\u308f\u308c\u3066\u3082\u56f0\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3088\u306d\uff61\n\u3068\u3044\u3046\u3053\u3068\u3067\uff64\u8868\u793a\u304c\u304d\u3061\u3093\u3068\u3055\u308c\u306a\u304f\u3066\u56f0\u308a\u307e\u3059\uff61\n\n## \u89e3\u6c7a\u7b56\n* ViewModel\u3067\u5bfe\u5fdc\u3059\u308b\n* NumberPicker\u3092\u7d99\u627f\u3057\u305fCustomView\u3092\u4f5c\u308b\n\n\u4e0a\u8a18\u306e2\u30d1\u30bf\u30fc\u30f3\u304c\u3059\u3050\u601d\u3044\u3064\u304f\u304b\u3068\u601d\u3044\u307e\u3059\uff61\n\u4eca\u56de\u306f\u306a\u3093\u3068\u306a\u304f *NumberPicker\u3092\u7d99\u627f\u3057\u305fCustomView\u3092\u4f5c\u308b* \u306e\u65b9\u3067\u5b9f\u88c5\u3092\u9032\u3081\u307e\u3057\u305f\uff61\n\n```kotlin\nclass DatabindingableNumberPicker : NumberPicker {\n    constructor(context: Context) : super(context)\n    constructor(context: Context, attributeSet: AttributeSet) : super(context, attributeSet)\n    constructor(context: Context, attributeSet: AttributeSet, defStyleAttr: Int) : super(context, attributeSet, defStyleAttr)\n\n    private var isCallSetMaxValueBeforeSetValue = false\n    private var tempValue = 0\n\n    override fun setValue(value: Int) {\n        if (!isCallSetMaxValueBeforeSetValue) {\n            tempValue = value\n            isCallSetMaxValueBeforeSetValue = true\n        } else {\n            super.setValue(value)\n        }\n    }\n\n    override fun setMaxValue(maxValue: Int) {\n        super.setMaxValue(maxValue)\n        if (isCallSetMaxValueBeforeSetValue) {\n            value = tempValue\n        } else {\n            isCallSetMaxValueBeforeSetValue = true\n        }\n    }\n}\n```\n\u4e0a\u8a18\u306eCustomView\u3092\u4e0b\u8a18\u306e\u3088\u3046\u306b\u5b9f\u88c5\u3059\u308c\u3070\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<layout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\">\n\n    <data>\n\n        <variable\n            name=\"hoge\"\n            type=\"Hoge\" />\n    </data>\n\n    <FrameLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\">\n\n        <DatabindingableNumberPicker\n            android:id=\"@+id/hoge_number_picker\"\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:descendantFocusability=\"blocksDescendants\"\n            android:value=\"@={hoge.value}\"\n            app:maxValue=\"@{hoge.maxValue}\" />\n\n    </FrameLayout>\n\n</layout>\n```\nView\u306e\u540d\u524d\u306e\u5909\u66f4\u3060\u3051\u3067XML\u5074\u306e\u57fa\u672c\u7684\u306a\u5b9f\u88c5\u3092\u5909\u3048\u305a\u306b\u4f7f\u3046\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\uff61\n\u3053\u308c\u3067\u30cf\u30c3\u30d4\u30fc\u3067\u3059\uff61\n\n---\n<img width=\"1012\" alt=\"Screen Shot 2016-12-03 at 1.26.41 AM.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/20948/6f2f3227-7ddc-388e-140c-5943704740f7.png\">\n---\n\n\u305d\u3046\uff64\u3053\u308c\u306f\u5168\u3066\u3092\u89e3\u6c7a\u3057\u3066\u306a\u3044\u3093\u3067\u3059\uff61\n\u7d50\u5c40\u65b0\u3057\u304f\u4f5c\u3063\u305fView\u3092\u4f7f\u3046\u306e\u3092\u5fd8\u308c\u3066\u3057\u307e\u3063\u3066\u306f\u610f\u5473\u304c\u3042\u308a\u307e\u305b\u3093\uff61\n\u305d\u3053\u3067Custom Lint Rules\u304c\u982d\u3092\u3088\u304e\u308a\uff64\u4f5c\u6210\u306b\u81f3\u3063\u305f\u3068\u3044\u3046\u308f\u3051\u3067\u3059\uff61\n\n## Detector\u306e\u4f5c\u6210\n\u4eca\u56de\u306eCustomLint Rules\u306e\u65b9\u91dd\u306f **NumberPicker\u306b\"android:value\"\u5c5e\u6027\u304c\u3042\u308b\u5834\u5408\u306f\u8b66\u544a\u3092\u51fa\u3059** \u3068\u3044\u3046\u3053\u3068\u3067\u9032\u3081\u307e\u3057\u305f\uff61\n\n```java\npublic class NotUsageDatabindingableNumberPickerDetector extends LayoutDetector {\n\n    public static final Issue ISSUE = Issue.create(\n            \"NotUsageDatabindingableNumberPicker\",\n            \"Using NumberPicker!!!!\",\n            \"When using NumberPicker with `Databinding`, you must use `DatabindingableNumberPicker`.\",\n            Category.MESSAGES,\n            10,\n            Severity.ERROR,\n            new Implementation(\n                    NotUsageDatabindingableNumberPickerDetector.class,\n                    Scope.RESOURCE_FILE_SCOPE));\n\n    public NotUsageDatabindingableNumberPickerDetector() {\n    }\n\n    @Override\n    public Speed getSpeed() {\n        return Speed.FAST;\n    }\n\n    public static final String NUMBER_PICKER = \"NumberPicker\";\n\n    @Override\n    public Collection<String> getApplicableElements() {\n        return Collections.singletonList(NUMBER_PICKER);\n    }\n\n    @Override\n    public void visitElement(@NonNull XmlContext context, @NonNull Element element) {\n        if (!element.hasAttribute(PREFIX_ANDROID + ATTR_VALUE)) {\n            return;\n        }\n        final Attr attributeNode = element.getAttributeNode(PREFIX_ANDROID + ATTR_VALUE);\n        final String attributeValue = attributeNode.getValue();\n        final boolean isUseDatabinding = attributeValue.startsWith(\"@={\") && attributeValue.endsWith(\"}\");\n        if (isUseDatabinding) {\n            context.report(\n                    ISSUE,\n                    attributeNode,\n                    context.getLocation(attributeNode),\n                    \"This NumberPicker should be a DatabindingableNumberPicker\");\n        }\n    }\n}\n```\n\u57fa\u672c\u7684\u306b\u8aac\u660e\u3059\u308b\u3053\u3068\u306f\u3042\u308a\u307e\u305b\u3093\u304c\uff64\u82e5\u5e72\u6b62\u307e\u3063\u305f\u90e8\u5206\u306f`Element#hasAttribute`\u306b`ATTR_VALUE`\u3060\u3051\u3092\u6e21\u3057\u3066\u3044\u305f\u3093\u3067\u3059\u304c\uff64\u30c0\u30e1\u3067\u3057\u305f...\n\n## DetectorTest\u306e\u4f5c\u6210\nCustom Lint Rules\u3092\u4f5c\u308b\u306b\u3042\u305f\u3063\u3066\uff64\u304d\u3061\u3093\u3068\u52d5\u304f\u3053\u3068\u3092\u4fdd\u8a3c\u3059\u308b\u5927\u4e8b\u306a\u90e8\u5206\u3067\u3059\uff61\n\u5148\u306bTest\u3092\u66f8\u3044\u3066\u304b\u3089Detector\u306e\u4f5c\u6210\u3092\u3057\u305f\u307b\u3046\u304c\u672c\u5f53\u306b\u52b9\u7387\u304c\u826f\u3044\u3067\u3059\uff61\n\nDetector\u306eTest\u306f`LintDetectorTest`\u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u305d\u3061\u3089\u3092\u4f7f\u3046\u3068\u7c21\u5358\u306bTest\u3092\u66f8\u304f\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\uff61\n\n```java\npublic class NotUsageDatabindingableNumberPickerDetectorTest extends LintDetectorTest {\n\n    private static String NO_WARNING = \"No warnings.\";\n\n    @Override\n    protected Detector getDetector() {\n        return new NotUsageDatabindingableNumberPickerDetector();\n    }\n\n    @Override\n    protected List<Issue> getIssues() {\n        return Collections.singletonList(NotUsageDatabindingableNumberPickerDetector.ISSUE);\n    }\n\n    public void testUseNumberPickerWhenNotUseDatabinding() throws Exception {\n        final String result = lintProject(xml(\"res/layout/test.xml\", TestData.USE_NUMBER_PICKER_WHEN_NOT_USE_DATABINDING));\n\n        assertEquals(NO_WARNING, result);\n    }\n\n    public void testUseDatabindingableNumberPickerWhenUseDatabinding() throws Exception {\n        final String result = lintProject(xml(\"res/layout/test.xml\", TestData.USE_DATABINDINGABLE_NUMBER_PICKER_WHEN_USE_DATABINDING));\n\n        assertEquals(NO_WARNING, result);\n    }\n\n    public void testUseNumberPickerWhenUseDatabinding() throws Exception {\n        final String result = lintProject(xml(\"res/layout/test.xml\", TestData.USE_NUMBER_PICKER_WHEN_USE_DATABINDING));\n\n        assertEquals(\"\" +\n                        \"res/layout/test.xml:19: Error: This NumberPicker should be a DatabindingableNumberPicker [NotUsageDatabindingableNumberPicker]\\n\" +\n                        \"            android:value=\\\"@={hgoe}\\\" />\\n\" +\n                        \"            ~~~~~~~~~~~~~~~~~~~~~~~~\\n\" +\n                        \"1 errors, 0 warnings\\n\",\n                result);\n    }\n}\n```\n[TestData.java](https://gist.github.com/amyu/929709ba50e2119b1e7fc6ca5e8dd737)\nTest\u3092\u4f5c\u308b\u306b\u5f53\u305f\u3063\u3066\u5e7e\u3064\u304b\u30cf\u30de\u3063\u305f\u70b9\u304c\u3042\u308b\u306e\u3067\u305d\u3061\u3089\u3092\u7d39\u4ecb\u3057\u307e\u3059\uff61\n\n\u307e\u305a\u306f\u3058\u3081\u306b\uff64\n`xml(\"res/layout/test.xml\",TestData.USE_DATABINDINGABLE_NUMBER_PICKER_WHEN_USE_DATABINDING)`\n\u306e\u90e8\u5206\uff61\n`xml(String to, String source)` \u306e`to`\u306b\u306fLayout Resources\u3067\u3042\u308b\u3053\u3068\u3092\u304d\u3061\u3093\u3068\u66f8\u304b\u306a\u3044\u3068\u8a8d\u8b58\u3057\u3066\u304f\u308c\u307e\u305b\u3093\uff61\n\u5177\u4f53\u7684\u306b\u306f`\"res/leyout/hoge.xml\"`\u306e\u3088\u3046\u306b`\"res/layout\"`\u304c\u975e\u5e38\u306b\u5927\u4e8b\u3067\u3059\uff61\n\u81ea\u5206\u306f\u3053\u308c\u306730\u5206\u6d88\u8017\u3057\u307e\u3057\u305f\uff61\n\n\u7d9a\u3044\u3066\u306f`source`\u306e\u90e8\u5206\uff61\n\n```java\n    static String USE_NUMBER_PICKER_WHEN_USE_DATABINDING = \"\" +\n            \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?>\\n\" +\n            \"<layout>\\n\" +\n            \"\\n\" +\n            \"    <data>\\n\" +\n            \"\\n\" +\n            \"        <variable\\n\" +\n            \"            name=\\\"hgoe\\\"\\n\" +\n            \"            type=\\\"int\\\" />\\n\" +\n            \"    </data>\\n\" +\n            \"\\n\" +\n            \"    <LinearLayout xmlns:android=\\\"http://schemas.android.com/apk/res/android\\\"\\n\" +\n            \"        android:layout_width=\\\"match_parent\\\"\\n\" +\n            \"        android:layout_height=\\\"match_parent\\\"\\n\" +\n            \"        android:orientation=\\\"vertical\\\">\\n\" +\n            \"\\n\" +\n            \"        <NumberPicker\\n\" +\n            \"            android:layout_width=\\\"wrap_content\\\"\\n\" +\n            \"            android:layout_height=\\\"wrap_content\\\"\\n\" +\n            \"            android:value=\\\"@={hgoe}\\\" />\\n\" +\n            \"\\n\" +\n            \"    </LinearLayout>\\n\" +\n            \"\\n\" +\n            \"</layout>\";\n```\n\u304d\u3061\u3093\u3068\u30d3\u30eb\u30c9\u304c\u901a\u308b\u3088\u3046\u306alayout xml\u3067\u306a\u3044\u3068\u3044\u3051\u307e\u305b\u3093\uff61\n\u9069\u5f53\u306b\u66f8\u3044\u3066\u3082\u884c\u3051\u308b\u3060\u308d\u3046\u3068\u8003\u3048\u3066\uff64\u9069\u5f53\u306b\u66f8\u3044\u305f\u3089\u8f9b\u304f\u306a\u308a\u307e\u3059\uff61\n\u3053\u308c\u306730\u5206\u6d88\u8017\u3057\u307e\u3057\u305f...\n\n## \u5f8c\u306f\u7d30\u304b\u3044\u8a2d\u5b9a\nCI\u306eTask\u306b\u8ffd\u52a0\u3057\u305f\u308a\uff64Github\u306ePR Template\u3092\u66f4\u65b0\u3059\u308b\u306a\u3069\u3057\u3066\uff64\u5b9a\u671f\u7684\u306b\n`./gradlew check`\n\u3092\u8d70\u3089\u305b\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\uff61\n\n## \u4eca\u56de\u3067\u304d\u306a\u304b\u3063\u305f\u3053\u3068\n\u666e\u6bb5Circle CI\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3059\u304c\uff64CI\u3067Lint check\u3092\u3057\u305f\u6642\u306b\u9650\u308a\uff64`Severity`\u304c`Error\u304b\u3089Warning`\u306b\u4e0a\u66f8\u304d\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\uff61\n\u307b\u3093\u3068\u306a\u3093\u3067\u3060\u308d\u3046...\nCI\u3092Lint Error\u3067\u843d\u3068\u3057\u305f\u3044\u3093\u3067\u3059\u304c\uff64Warning\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067CI\u81ea\u4f53\u304c\u901a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\uff61\n\u306a\u306e\u3067Lint\u7d50\u679c\u306eXML\u3092Parse\u3057\uff64Priority\u3092\u307f\u3066CI\u3092\u843d\u3068\u305d\u3046\u304b\u306a\u3068\u8003\u3048\u3066\u3044\u307e\u3059\uff61\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u4eca\u56de\u4f5c\u3063\u305fCustom Lint Rules\u306e\u7d39\u4ecb\u7d42\u308f\u308a\ud83d\ude47\n\n# \u53c2\u8003\u306b\u3057\u305fDetector\u306eCode\n\n* [AccessibilityDetector](https://android.googlesource.com/platform/tools/base/+/master/lint/libs/lint-checks/src/main/java/com/android/tools/lint/checks/AccessibilityDetector.java?autodive=0%2F)\n\nImageView\u306bcontentDescription\u304c\u306a\u3044\u3068layout\u3067\u3088\u304f\u9ec4\u8272\u304f\u306a\u3063\u3066\u3044\u305f\u30a2\u30ec\u3067\u3059\uff61\n`hint`\u3068`contentDescription`\u4e21\u65b9\u540c\u6642\u306b\u6307\u5b9a\u3057\u305f\u3089\u3044\u3051\u306a\u304b\u3063\u305f\u3093\u3067\u3059\u306d\uff64\u77e5\u3089\u306a\u304b\u3063\u305f\uff61\n\ncontentDescription=\"\"\ncontentDescription=\"TODO\"\nTODO\u3082Lint\u306b\u5f15\u3063\u304b\u304b\u308b\u308b\u3093\u3067\u3059\u306d...\n\n* [DeprecationDetector](https://android.googlesource.com/platform/tools/base/+/master/lint/libs/lint-checks/src/main/java/com/android/tools/lint/checks/DeprecationDetector.java?autodive=0%2F)\n\n\u4e00\u756a\u5b9f\u88c5\u306e\u53c2\u8003\u306b\u306a\u3063\u305f\uff61\n\n* [HardcodedValuesDetector](https://android.googlesource.com/platform/tools/base/+/master/lint/libs/lint-checks/src/main/java/com/android/tools/lint/checks/HardcodedValuesDetector.java?autodive=0%2F)\n\nAttribute\u53d6\u5f97\u5468\u308a\u53c2\u8003\u306b\u306a\u308b\uff61\n\n* [WebViewDetector](https://android.googlesource.com/platform/tools/base/+/master/lint/libs/lint-checks/src/main/java/com/android/tools/lint/checks/WebViewDetector.java?autodive=0%2F)\n\n\n# \u7d42\u308f\u308a\u306b\nCustom Lint Rules\u826f\u3044\u3067\u3059\u306d\uff61\n\u3069\u308c\u3060\u3051\u81ea\u5df1\u30ec\u30d3\u30e5\u30fc\u3092\u3084\u3063\u3066\u3082\u898b\u3064\u3051\u51fa\u305b\u306a\u3044\u30d0\u30b0\u3084\uff64\u5f15\u304d\u7d99\u3044\u3060\u969b\u306e\u4ed5\u69d8\u5831\u544a\u6f0f\u308c\u306a\u3069\uff64\u4eba\u70ba\u7684\u306a\u30df\u30b9\u3067\u591a\u304f\u306e\u30d0\u30b0\u304c\u751f\u307e\u308c\u307e\u3059\uff61\n\u3067\u304d\u308b\u3060\u3051\u4eba\u9593\u306e\u624b\u3092\u4ecb\u3055\u306a\u3044\u3088\u3046\u306bCheck\u3057\u3066\u3044\u304f\u3068\u3044\u3046\u306e\u306f\u975e\u5e38\u306b\u826f\u3044\u3068\u601d\u3044\u307e\u3059\uff61\n\n\uff62\u6a2a\u5c55\u958b\uff63\u304c\u3044\u3063\u3071\u3044\u51fa\u6765\u308b\u3088\u3046\u306b\u3069\u3093\u3069\u3093\u4f5c\u3063\u3066\u3044\u304d\u305f\u3044\u3067\u3059\u306d\uff61\n\n\u826f\u3044\u30b5\u30fc\u30d3\u30b9\u306f\u826f\u3044\u958b\u767a\u57fa\u76e4\u304b\u3089\uff61\n", "tags": ["Android", "lint", "DataBinding"]}