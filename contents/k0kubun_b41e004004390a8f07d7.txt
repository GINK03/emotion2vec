{"context": " More than 1 year has passed since last update.itamae\u306f\u8efd\u91cf\u3067Chef\u30e9\u30a4\u30af\u306a\u30b5\u30fc\u30d0\u69cb\u6210\u7ba1\u7406\u30c4\u30fc\u30eb\u3067\u3059\u3002\u8a73\u3057\u304f\u306f\u3053\u3061\u3089\u3002\n\u672c\u7a3f\u3067\u306fitamae\u3067\u72ec\u81ea\u306eresource\u3092\u5b9a\u7fa9\u3059\u308b\u65b9\u6cd5\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\nresource\u3068\u306f\n\u6587\u5b57\u901a\u308a\u30b5\u30fc\u30d0\u304c\u6301\u3064\u5404\u30ea\u30bd\u30fc\u30b9\u306e\u7a2e\u985e\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u3066\u3001itamae\u3067\u306f\u30ec\u30b7\u30d4\u306bresource\u3092\u5217\u6319\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u30b5\u30fc\u30d0\u306e\u72b6\u614b\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\nitamae\u306b\u306fresource plugin\u3092\u5b9a\u7fa9\u3059\u308b\u305f\u3081\u306e\u6a5f\u69cb\u304c\u3042\u308a\u3001\u7c21\u5358\u306b\u72ec\u81ea\u306eresource\u3092\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\nplugin\u6a5f\u69cb\u306e\u4ed5\u7d44\u307f\n\n\u30ec\u30b7\u30d4\u306emethod_missing\u3067Itamae::Plugin::Resource::*\u304c\u63a2\u3055\u308c\u308b\n\u30ec\u30b7\u30d4\u306b\nfoo \"bar\" do\n  # ...\nend\n\n\u3068\u66f8\u304f\u3068\u3001\u30ec\u30b7\u30d4\u306emethod_missing\u3067Itamae::Plugin::Resource::Foo\u304c\u63a2\u3055\u308c\u307e\u3059\u3002\nitamae\u306e\u30ec\u30b7\u30d4\u304c\u8aad\u307f\u8fbc\u307e\u308c\u305f\u6bb5\u968e\u3067\u3053\u306eFoo resource\u304c\u30ec\u30b7\u30d4\u306echildren\u306b\u8ffd\u52a0\u3055\u308c\u307e\u3059\u3002\n\u305d\u306e\u305f\u3081\u3001bundle gem\u306e\u81ea\u52d5\u751f\u6210\u898f\u5247\u306b\u5f93\u3046\u3068\u3001plugin\u306egem\u540d\u306fitamae-plugin-resource-foo\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u30ec\u30b7\u30d4\u306b\u8ffd\u52a0\u3055\u308c\u305fresource\u304crun\u3055\u308c\u308b\n\u30ec\u30b7\u30d4\u306e\u8aad\u307f\u8fbc\u307f\u304c\u7d42\u308f\u308b\u3068\u3001\u30ec\u30b7\u30d4\u306b\u8ffd\u52a0\u3055\u308c\u305f\u5404resource\u304crun\u3055\u308c\u307e\u3059\u3002 \u2605\n\u306a\u306e\u3067\u3001\nresource = Itamae::Plugin::Resource::Foo.new(recipe, \"bar\", &block)\nresource.run(nil, dry_run: options[:dry_run])\n\n\u304c\u5b9f\u884c\u3055\u308c\u305f\u3089\u30b5\u30fc\u30d0\u306e\u72b6\u614b\u306b\u5fdc\u3058\u305f\u9069\u5207\u306a\u30b3\u30de\u30f3\u30c9\u304c\u8d70\u308b\u3088\u3046\u306bItamae::Plugin::Resource::Foo\u3092\u5b9a\u7fa9\u3059\u308c\u3070\u3088\u3044\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\nresource\u306b\u5171\u901a\u3057\u3066\u5fc5\u8981\u306a\u30e1\u30bd\u30c3\u30c9\u304cItamae::Resource::Base\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u65b0\u305f\u306bresource\u3092\u5b9a\u7fa9\u3059\u308b\u3068\u304d\u306f\u3053\u308c\u3092\u7d99\u627f\u3057\u3001\u5fc5\u8981\u306a\u90e8\u5206\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nItamae::Resource::Base\u306e\u4ed5\u7d44\u307f\n\u5b9f\u969b\u306b\u5b9a\u7fa9\u3059\u308b\u3068\u306a\u308b\u3068itamae/resource/base.rb\u3092\u3061\u3083\u3093\u3068\u8aad\u3080\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u3053\u3053\u3067\u306f\u6982\u8981\u3060\u3051\u8aac\u660e\u3057\u307e\u3059\u3002\n\n\n#new\u3067resource\u306baction\u7b49\u306eattribute\u304c\u30bb\u30c3\u30c8\u3055\u308c\u308b \u2605\n\nattribute\u306f\u3001\u30d6\u30ed\u30c3\u30af\u306e\u5185\u5074\u3067\u4f7f\u3048\u308b\u30e1\u30bd\u30c3\u30c9\u3067\u3001\u3053\u308c\u304c\u30ea\u30bd\u30fc\u30b9\u306e\u72b6\u614b\u306b\u306a\u308b\n\ndefine_attribute\u3092\u5217\u6319\u3059\u308b\u3053\u3068\u3067\u4efb\u610f\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8ffd\u52a0\u3067\u304d\u308b\n\n\n\n#run\u3067attribute\u306b\u5fdc\u3058\u305f\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\n\n\n\npre_action, set_current_attributes, show_differences\u304c\u9806\u756a\u306b\u547c\u3070\u308c\u308b \u2605\n\n:action attribute\u306b\u5fdc\u3058\u305faction_#{action}\u304c\u547c\u3070\u308c\u308b \u2605\n\n\n\n\n\u5f93\u3063\u3066\u3001\u4ee5\u4e0b\u306e3\u3064\u306e\u5909\u66f4\u3092\u884c\u3048\u3070\u3088\u3044\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n\ndefine_attribute\u306e\u5217\u6319\n\npre_action, set_current_attributes, show_differences\u306e\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\n\naction_#{action}\u30e1\u30bd\u30c3\u30c9\u306e\u4f5c\u6210\n\n\n\u4f5c\u6210\u4f8b: ghq resource\n\u4f8b\u3068\u3057\u3066\u3001ghq\u3092\u4f7f\u3063\u3066go\u306e\u6d41\u5100\u306b\u5f93\u3063\u305f\u30ea\u30dd\u30b8\u30c8\u30ea\u914d\u7f6e\u3092\u884c\u3046\u305f\u3081\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\u4e3b\u306bgit resource\u3068mercurial resource\u3092\u53c2\u8003\u306b\u4f5c\u308a\u307e\u3057\u305f\u3002\nk0kubun/itamae-plugin-resource-ghq\nrequire \"itamae/resource/base\"\n\nmodule Itamae\n  module Plugin\n    module Resource\n      class Ghq < Itamae::Resource::Base\n        define_attribute :action, default: :create\n        define_attribute :repository, type: String, default_name: true\n\n        def set_current_attributes\n          ensure_ghq_availability\n\n          result = run_command(\"ghq list | grep '#{attributes.repository}$'\", error: false)\n          current.exist = result.exit_status == 0\n        end\n\n        def action_create(options)\n          unless current.exist\n            run_command([\"ghq\", \"get\", attributes.repository])\n          end\n        end\n\n        def action_update(options)\n          result = run_command([\"ghq\", \"get\", \"-u\", attributes.repository])\n          unless result.stdout.match(/is up to date/)\n            updated!\n          end\n        end\n\n        private\n\n        def ensure_ghq_availability\n          if run_command(\"which ghq\", error: false).exit_status != 0\n            raise \"`ghq` command is not available. Please install ghq.\"\n          end\n        end\n      end\n    end\n  end\nend\n\n\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\nrequire \"itamae/plugin/resource/ghq\"\n\n# ghq get ryotarai/itamae\nghq \"ryotarai/itamae\"\n\n# ghq get -u serverspec/specinfra\nghq \"serverspec/specinfra\" do\n  action :update\nend\n\n[itamae](https://github.com/ryotarai/itamae)\u306f\u8efd\u91cf\u3067Chef\u30e9\u30a4\u30af\u306a\u30b5\u30fc\u30d0\u69cb\u6210\u7ba1\u7406\u30c4\u30fc\u30eb\u3067\u3059\u3002\u8a73\u3057\u304f\u306f[\u3053\u3061\u3089](https://speakerdeck.com/ryotarai/itamae-infra-as-code-xian-zhuang-que-ren-hui)\u3002\n\u672c\u7a3f\u3067\u306fitamae\u3067\u72ec\u81ea\u306eresource\u3092\u5b9a\u7fa9\u3059\u308b\u65b9\u6cd5\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n## resource\u3068\u306f\n\u6587\u5b57\u901a\u308a\u30b5\u30fc\u30d0\u304c\u6301\u3064\u5404\u30ea\u30bd\u30fc\u30b9\u306e\u7a2e\u985e\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u3066\u3001itamae\u3067\u306f\u30ec\u30b7\u30d4\u306bresource\u3092\u5217\u6319\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u30b5\u30fc\u30d0\u306e\u72b6\u614b\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\nitamae\u306b\u306fresource plugin\u3092\u5b9a\u7fa9\u3059\u308b\u305f\u3081\u306e\u6a5f\u69cb\u304c\u3042\u308a\u3001\u7c21\u5358\u306b\u72ec\u81ea\u306eresource\u3092\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n## plugin\u6a5f\u69cb\u306e\u4ed5\u7d44\u307f\n### \u30ec\u30b7\u30d4\u306e`method_missing`\u3067`Itamae::Plugin::Resource::*`\u304c\u63a2\u3055\u308c\u308b\n\u30ec\u30b7\u30d4\u306b\n\n```rb\nfoo \"bar\" do\n  # ...\nend\n```\n\n\u3068\u66f8\u304f\u3068\u3001[\u30ec\u30b7\u30d4\u306e`method_missing`](https://github.com/ryotarai/itamae/blob/21499fc916430b6cd15ccd42257f848d73528932/lib/itamae/recipe.rb#L68-L80)\u3067[`Itamae::Plugin::Resource::Foo`\u304c\u63a2\u3055\u308c\u307e\u3059](https://github.com/ryotarai/itamae/blob/21499fc916430b6cd15ccd42257f848d73528932/lib/itamae/resource.rb#L28)\u3002\nitamae\u306e\u30ec\u30b7\u30d4\u304c\u8aad\u307f\u8fbc\u307e\u308c\u305f\u6bb5\u968e\u3067\u3053\u306eFoo resource\u304c\u30ec\u30b7\u30d4\u306e`children`\u306b\u8ffd\u52a0\u3055\u308c\u307e\u3059\u3002\n\n\u305d\u306e\u305f\u3081\u3001`bundle gem`\u306e\u81ea\u52d5\u751f\u6210\u898f\u5247\u306b\u5f93\u3046\u3068\u3001plugin\u306egem\u540d\u306f`itamae-plugin-resource-foo`\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n### \u30ec\u30b7\u30d4\u306b\u8ffd\u52a0\u3055\u308c\u305fresource\u304crun\u3055\u308c\u308b\n\u30ec\u30b7\u30d4\u306e\u8aad\u307f\u8fbc\u307f\u304c\u7d42\u308f\u308b\u3068\u3001\u30ec\u30b7\u30d4\u306b\u8ffd\u52a0\u3055\u308c\u305f\u5404resource\u304crun\u3055\u308c\u307e\u3059\u3002 [\u2605](https://github.com/ryotarai/itamae/blob/21499fc916430b6cd15ccd42257f848d73528932/lib/itamae/recipe_children.rb#L54)\n\u306a\u306e\u3067\u3001\n\n```rb\nresource = Itamae::Plugin::Resource::Foo.new(recipe, \"bar\", &block)\nresource.run(nil, dry_run: options[:dry_run])\n```\n\n\u304c\u5b9f\u884c\u3055\u308c\u305f\u3089\u30b5\u30fc\u30d0\u306e\u72b6\u614b\u306b\u5fdc\u3058\u305f\u9069\u5207\u306a\u30b3\u30de\u30f3\u30c9\u304c\u8d70\u308b\u3088\u3046\u306b`Itamae::Plugin::Resource::Foo`\u3092\u5b9a\u7fa9\u3059\u308c\u3070\u3088\u3044\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\nresource\u306b\u5171\u901a\u3057\u3066\u5fc5\u8981\u306a\u30e1\u30bd\u30c3\u30c9\u304c`Itamae::Resource::Base`\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u65b0\u305f\u306bresource\u3092\u5b9a\u7fa9\u3059\u308b\u3068\u304d\u306f\u3053\u308c\u3092\u7d99\u627f\u3057\u3001\u5fc5\u8981\u306a\u90e8\u5206\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n## `Itamae::Resource::Base`\u306e\u4ed5\u7d44\u307f\n\u5b9f\u969b\u306b\u5b9a\u7fa9\u3059\u308b\u3068\u306a\u308b\u3068[itamae/resource/base.rb](https://github.com/ryotarai/itamae/blob/21499fc916430b6cd15ccd42257f848d73528932/lib/itamae/resource/base.rb)\u3092\u3061\u3083\u3093\u3068\u8aad\u3080\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u3053\u3053\u3067\u306f\u6982\u8981\u3060\u3051\u8aac\u660e\u3057\u307e\u3059\u3002\n\n- `#new`\u3067resource\u306baction\u7b49\u306eattribute\u304c\u30bb\u30c3\u30c8\u3055\u308c\u308b [\u2605](https://github.com/ryotarai/itamae/blob/21499fc916430b6cd15ccd42257f848d73528932/lib/itamae/resource/base.rb#L107)\n  - attribute\u306f\u3001\u30d6\u30ed\u30c3\u30af\u306e\u5185\u5074\u3067\u4f7f\u3048\u308b\u30e1\u30bd\u30c3\u30c9\u3067\u3001\u3053\u308c\u304c\u30ea\u30bd\u30fc\u30b9\u306e\u72b6\u614b\u306b\u306a\u308b\n  - `define_attribute`\u3092\u5217\u6319\u3059\u308b\u3053\u3068\u3067\u4efb\u610f\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8ffd\u52a0\u3067\u304d\u308b\n- `#run`\u3067attribute\u306b\u5fdc\u3058\u305f\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\n  - `pre_action`, `set_current_attributes`, `show_differences`\u304c\u9806\u756a\u306b\u547c\u3070\u308c\u308b [\u2605](https://github.com/ryotarai/itamae/blob/21499fc916430b6cd15ccd42257f848d73528932/lib/itamae/resource/base.rb#L164-L170)\n  - :action attribute\u306b\u5fdc\u3058\u305f`action_#{action}`\u304c\u547c\u3070\u308c\u308b [\u2605](https://github.com/ryotarai/itamae/blob/21499fc916430b6cd15ccd42257f848d73528932/lib/itamae/resource/base.rb#L172-L174)\n\n\u5f93\u3063\u3066\u3001\u4ee5\u4e0b\u306e3\u3064\u306e\u5909\u66f4\u3092\u884c\u3048\u3070\u3088\u3044\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n- `define_attribute`\u306e\u5217\u6319\n- `pre_action`, `set_current_attributes`, `show_differences`\u306e\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\n- `action_#{action}`\u30e1\u30bd\u30c3\u30c9\u306e\u4f5c\u6210\n\n## \u4f5c\u6210\u4f8b: ghq resource\n\u4f8b\u3068\u3057\u3066\u3001[ghq](https://github.com/motemen/ghq)\u3092\u4f7f\u3063\u3066go\u306e\u6d41\u5100\u306b\u5f93\u3063\u305f\u30ea\u30dd\u30b8\u30c8\u30ea\u914d\u7f6e\u3092\u884c\u3046\u305f\u3081\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\u4e3b\u306b[git resource](https://github.com/ryotarai/itamae/blob/21499fc916430b6cd15ccd42257f848d73528932/lib/itamae/resource/git.rb)\u3068[mercurial resource](https://github.com/eagletmt/itamae-plugin-resource-mercurial/blob/master/lib/itamae/plugin/resource/mercurial.rb)\u3092\u53c2\u8003\u306b\u4f5c\u308a\u307e\u3057\u305f\u3002\n\n[k0kubun/itamae-plugin-resource-ghq](https://github.com/k0kubun/itamae-plugin-resource-ghq)\n\n```rb\nrequire \"itamae/resource/base\"\n\nmodule Itamae\n  module Plugin\n    module Resource\n      class Ghq < Itamae::Resource::Base\n        define_attribute :action, default: :create\n        define_attribute :repository, type: String, default_name: true\n\n        def set_current_attributes\n          ensure_ghq_availability\n\n          result = run_command(\"ghq list | grep '#{attributes.repository}$'\", error: false)\n          current.exist = result.exit_status == 0\n        end\n\n        def action_create(options)\n          unless current.exist\n            run_command([\"ghq\", \"get\", attributes.repository])\n          end\n        end\n\n        def action_update(options)\n          result = run_command([\"ghq\", \"get\", \"-u\", attributes.repository])\n          unless result.stdout.match(/is up to date/)\n            updated!\n          end\n        end\n\n        private\n\n        def ensure_ghq_availability\n          if run_command(\"which ghq\", error: false).exit_status != 0\n            raise \"`ghq` command is not available. Please install ghq.\"\n          end\n        end\n      end\n    end\n  end\nend\n```\n\n\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```rb\nrequire \"itamae/plugin/resource/ghq\"\n\n# ghq get ryotarai/itamae\nghq \"ryotarai/itamae\"\n\n# ghq get -u serverspec/specinfra\nghq \"serverspec/specinfra\" do\n  action :update\nend\n```\n", "tags": ["Ruby", "itamae", "Ghq"]}