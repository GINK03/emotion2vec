{"context": " More than 1 year has passed since last update.\n\nWhat's this?\n\nTake a backup of Nova instance\nRestore from the backup (= Create new Nova instance)\n\n\nTake a backup of Nova instance\n\nInitial state\n# nova list\n+--------------------------------------+------------+--------+------------+-------------+---------------------+\n| ID                                   | Name       | Status | Task State | Power State | Networks            |\n+--------------------------------------+------------+--------+------------+-------------+---------------------+\n| 7961383e-7528-4e26-8889-ab452bae0e7f | admin_vm01 | ACTIVE | -          | Running     | net04=192.168.12.78 |\n+--------------------------------------+------------+--------+------------+-------------+---------------------+\n\n\nTake a backup (1st)\n# nova backup admin_vm01 admin_vm01_bkup daily 1\n\n\n# nova help backup\nusage: nova backup <server> <name> <backup-type> <rotation>\n\nBackup a server by creating a 'backup' type snapshot.\n\nPositional arguments:\n  <server>       Name or ID of server.\n  <name>         Name of the backup image.\n  <backup-type>  The backup type, like \"daily\" or \"weekly\".\n  <rotation>     Int parameter representing how many backups to keep around.\n\nNote:\n\n\n<backup-type> is kind of TAG\n\n<rotation> is How many backups you want to keep\nNova backup is not automatically backup function, it is just how many backups with having same TAG you want to keep.\n\n\nCheck the backup\n\nNova command\n\n# nova image-list | egrep \"ID|admin_vm01_bkup\"\n| ID                                   | Name                                     | Status | Server                               |\n| 9b641354-3875-49c5-9cc0-3b722791ccab | admin_vm01_bkup                          | ACTIVE | 7961383e-7528-4e26-8889-ab452bae0e7f |\n\n\nGlance command\n\n# glance image-list | egrep \"ID|admin_vm01_bkup\"\n| ID                                   | Name                                     | Disk Format | Container Format | Size       | Status |\n| 9b641354-3875-49c5-9cc0-3b722791ccab | admin_vm01_bkup                          | raw         | bare             | 1073741824 | active |\n\n# glance image-show admin_vm01_bkup\n+---------------------------------------+--------------------------------------+\n| Property                              | Value                                |\n+---------------------------------------+--------------------------------------+\n| Property 'backup_type'                | daily                                |\n| Property 'base_image_ref'             | a5232547-4ccf-4ebb-9ab8-79e4daf73e9d |\n| Property 'description'                | cirros-changed-password              |\n| Property 'image_location'             | snapshot                             |\n| Property 'image_state'                | available                            |\n| Property 'image_type'                 | backup                               |\n| Property 'instance_type_ephemeral_gb' | 0                                    |\n| Property 'instance_type_flavorid'     | 318a3051-4304-4f3a-bda7-6f3a7637152b |\n| Property 'instance_type_id'           | 2                                    |\n| Property 'instance_type_memory_mb'    | 256                                  |\n| Property 'instance_type_name'         | m1.nano                              |\n| Property 'instance_type_root_gb'      | 1                                    |\n| Property 'instance_type_rxtx_factor'  | 1.0                                  |\n| Property 'instance_type_swap'         | 0                                    |\n| Property 'instance_type_vcpus'        | 1                                    |\n| Property 'instance_uuid'              | 7961383e-7528-4e26-8889-ab452bae0e7f |\n| Property 'network_allocated'          | True                                 |\n| Property 'owner_id'                   | a8085d1871f847bdb906ef4a28d1bd48     |\n| Property 'user_id'                    | a1c2ec19759040e39f219fcf82028bf6     |\n| checksum                              | 070cf4308133712b8711fa797a0d1f5f     |\n| container_format                      | bare                                 |\n| created_at                            | 2015-02-17T03:17:26                  |\n| deleted                               | False                                |\n| disk_format                           | raw                                  |\n| id                                    | 9b641354-3875-49c5-9cc0-3b722791ccab |\n| is_public                             | False                                |\n| min_disk                              | 1                                    |\n| min_ram                               | 0                                    |\n| name                                  | admin_vm01_bkup                      |\n| owner                                 | a8085d1871f847bdb906ef4a28d1bd48     |\n| protected                             | False                                |\n| size                                  | 1073741824                           |\n| status                                | active                               |\n| updated_at                            | 2015-02-17T03:18:19                  |\n+---------------------------------------+--------------------------------------+\n\n\nTake a backup (2nd)\n# nova backup admin_vm01 admin_vm01_bkup daily 1\n\n\n# nova help backup\nusage: nova backup <server> <name> <backup-type> <rotation>\n\nBackup a server by creating a 'backup' type snapshot.\n\nPositional arguments:\n  <server>       Name or ID of server.\n  <name>         Name of the backup image.\n  <backup-type>  The backup type, like \"daily\" or \"weekly\".\n  <rotation>     Int parameter representing how many backups to keep around.\n\nNote:\n\n\n<backup-type> is kind of TAG\n\n<rotation> is How many backups you want to keep\nNova backup is not automatically backup function, it is just how many backups with having same TAG you want to keep.\n\n\nCheck the backup\n\nBeing Backup\n\nOnce the backup has been completed. 1st backup (9b641354-3875-49c5-9cc0-3b722791ccab) will be deleted. Because <rotation> is set \"1\".\n    # glance image-list\n    +--------------------------------------+------------------------------------------+-------------+------------------+------------+--------+\n    | ID                                   | Name                                     | Disk Format | Container Format | Size       | Status |\n    +--------------------------------------+------------------------------------------+-------------+------------------+------------+--------+\n    | 9b641354-3875-49c5-9cc0-3b722791ccab | admin_vm01_bkup                          | raw         | bare             | 1073741824 | active |\n    | 7cd46251-edbd-444b-a34f-8369420b40ce | admin_vm01_bkup                          | raw         | bare             |            | queued |\n    +--------------------------------------+------------------------------------------+-------------+------------------+------------+--------+\n\n\nComplete\n\n1st backup (9b641354-3875-49c5-9cc0-3b722791ccab) has been deleted.\n    # glance image-list\n    +--------------------------------------+------------------------------------------+-------------+------------------+------------+--------+\n    | ID                                   | Name                                     | Disk Format | Container Format | Size       | Status |\n    +--------------------------------------+------------------------------------------+-------------+------------------+------------+--------+\n    | 7cd46251-edbd-444b-a34f-8369420b40ce | admin_vm01_bkup                          | raw         | bare             | 1073741824 | active |\n    +--------------------------------------+------------------------------------------+-------------+------------------+------------+--------+\n\n\nRestore from the backup (= Create new Nova instance)\n\nCheck necessary infomation\n\nNetwork\n\n# neutron net-list | egrep \" id |net04\"\n| id                                   | name           | subnets                                               |\n| b3fa9d4d-4c21-47f5-be07-cf2ff518035e | net04          | 77267538-9be9-47db-a983-9139de4efe50 192.168.12.0/24  |\n\n\nSecurity Group\n\n# nova secgroup-list\n+--------------------------------------+---------+-------------+\n| Id                                   | Name    | Description |\n+--------------------------------------+---------+-------------+\n| 319b5bc2-5df2-44c1-b2d9-8d08689e4a8a | default | default     |\n+--------------------------------------+---------+-------------+\n\n\nFlavor\n\n# nova flavor-list\n+--------------------------------------+---------------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID                                   | Name          | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+--------------------------------------+---------------+-----------+------+-----------+------+-------+-------------+-----------+\n| 1                                    | m1.tiny       | 512       | 1    | 0         |      | 1     | 1.0         | True      |\n| 12d7efd2-2d1d-44ec-ad66-ce7ca8927c0b | m1.medium     | 4096      | 0    | 0         |      | 2     | 1.0         | True      |\n| 2                                    | m1.small      | 2048      | 20   | 0         |      | 1     | 1.0         | True      |\n| 318a3051-4304-4f3a-bda7-6f3a7637152b | m1.nano       | 256       | 1    | 0         |      | 1     | 1.0         | True      |\n| 4                                    | m1.large      | 8192      | 80   | 0         |      | 4     | 1.0         | True      |\n| 5                                    | m1.xlarge     | 16384     | 160  | 0         |      | 8     | 1.0         | True      |\n+--------------------------------------+---------------+-----------+------+-----------+------+-------+-------------+-----------+\n\n\nRestore from the image(backup) (= Create new Nova instance)\n# nova boot --flavor m1.nano \\\n            --image admin_vm01_bkup \\\n            --security-groups default \\\n            --availability-zone nova \\\n            --nic net-id=b3fa9d4d-4c21-47f5-be07-cf2ff518035e \\\n            admin_vm02\n+--------------------------------------+--------------------------------------------------------+\n| Property                             | Value                                                  |\n+--------------------------------------+--------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                 |\n| OS-EXT-AZ:availability_zone          | nova                                                   |\n| OS-EXT-SRV-ATTR:host                 | -                                                      |\n| OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                                      |\n| OS-EXT-SRV-ATTR:instance_name        | instance-00000444                                      |\n| OS-EXT-STS:power_state               | 0                                                      |\n| OS-EXT-STS:task_state                | scheduling                                             |\n| OS-EXT-STS:vm_state                  | building                                               |\n| OS-SRV-USG:launched_at               | -                                                      |\n| OS-SRV-USG:terminated_at             | -                                                      |\n| accessIPv4                           |                                                        |\n| accessIPv6                           |                                                        |\n| adminPass                            | Df9gLcC7nkHq                                           |\n| config_drive                         |                                                        |\n| created                              | 2015-02-17T03:02:25Z                                   |\n| flavor                               | m1.nano (318a3051-4304-4f3a-bda7-6f3a7637152b)         |\n| hostId                               |                                                        |\n| id                                   | 94c75110-54a7-408a-b7e6-13b6961617bf                   |\n| image                                | admin_vm01_bkup (7cd46251-edbd-444b-a34f-8369420b40ce) |\n| key_name                             | -                                                      |\n| metadata                             | {}                                                     |\n| name                                 | admin_vm02                                             |\n| os-extended-volumes:volumes_attached | []                                                     |\n| progress                             | 0                                                      |\n| security_groups                      | default                                                |\n| status                               | BUILD                                                  |\n| tenant_id                            | a8085d1871f847bdb906ef4a28d1bd48                       |\n| updated                              | 2015-02-17T03:02:25Z                                   |\n| user_id                              | a1c2ec19759040e39f219fcf82028bf6                       |\n+--------------------------------------+--------------------------------------------------------+\n\n\nCheck the restored Nova instance\n# nova list\n+--------------------------------------+------------+--------+------------+-------------+---------------------+\n| ID                                   | Name       | Status | Task State | Power State | Networks            |\n+--------------------------------------+------------+--------+------------+-------------+---------------------+\n| 7961383e-7528-4e26-8889-ab452bae0e7f | admin_vm01 | ACTIVE | -          | Running     | net04=192.168.12.78 |\n| 94c75110-54a7-408a-b7e6-13b6961617bf | admin_vm02 | ACTIVE | -          | Running     | net04=192.168.12.79 |\n+--------------------------------------+------------+--------+------------+-------------+---------------------+\n\n\nEnvironment\n\nOpenstack : Juno\nCeph : Firefly\n\n\nReference\nNova Snapshot/Restore\nNova Backup/Restore\n## What's this?\n\n* Take a backup of Nova instance\n* Restore from the backup (= Create new Nova instance)\n\n## Take a backup of Nova instance\n\n### Initial state\n\n    # nova list\n    +--------------------------------------+------------+--------+------------+-------------+---------------------+\n    | ID                                   | Name       | Status | Task State | Power State | Networks            |\n    +--------------------------------------+------------+--------+------------+-------------+---------------------+\n    | 7961383e-7528-4e26-8889-ab452bae0e7f | admin_vm01 | ACTIVE | -          | Running     | net04=192.168.12.78 |\n    +--------------------------------------+------------+--------+------------+-------------+---------------------+\n\n### Take a backup (1st)\n\n    # nova backup admin_vm01 admin_vm01_bkup daily 1\n\n\n    # nova help backup\n    usage: nova backup <server> <name> <backup-type> <rotation>\n\n    Backup a server by creating a 'backup' type snapshot.\n\n    Positional arguments:\n      <server>       Name or ID of server.\n      <name>         Name of the backup image.\n      <backup-type>  The backup type, like \"daily\" or \"weekly\".\n      <rotation>     Int parameter representing how many backups to keep around.\n\n\nNote:\n\n* `<backup-type>` is kind of TAG\n* `<rotation>` is How many backups you want to keep\n* Nova backup is not automatically backup function, it is just how many backups with having same TAG you want to keep.\n\n### Check the backup\n\n* Nova command\n\n````\n# nova image-list | egrep \"ID|admin_vm01_bkup\"\n| ID                                   | Name                                     | Status | Server                               |\n| 9b641354-3875-49c5-9cc0-3b722791ccab | admin_vm01_bkup                          | ACTIVE | 7961383e-7528-4e26-8889-ab452bae0e7f |\n````\n\n* Glance command\n\n````\n# glance image-list | egrep \"ID|admin_vm01_bkup\"\n| ID                                   | Name                                     | Disk Format | Container Format | Size       | Status |\n| 9b641354-3875-49c5-9cc0-3b722791ccab | admin_vm01_bkup                          | raw         | bare             | 1073741824 | active |\n````\n\n````\n# glance image-show admin_vm01_bkup\n+---------------------------------------+--------------------------------------+\n| Property                              | Value                                |\n+---------------------------------------+--------------------------------------+\n| Property 'backup_type'                | daily                                |\n| Property 'base_image_ref'             | a5232547-4ccf-4ebb-9ab8-79e4daf73e9d |\n| Property 'description'                | cirros-changed-password              |\n| Property 'image_location'             | snapshot                             |\n| Property 'image_state'                | available                            |\n| Property 'image_type'                 | backup                               |\n| Property 'instance_type_ephemeral_gb' | 0                                    |\n| Property 'instance_type_flavorid'     | 318a3051-4304-4f3a-bda7-6f3a7637152b |\n| Property 'instance_type_id'           | 2                                    |\n| Property 'instance_type_memory_mb'    | 256                                  |\n| Property 'instance_type_name'         | m1.nano                              |\n| Property 'instance_type_root_gb'      | 1                                    |\n| Property 'instance_type_rxtx_factor'  | 1.0                                  |\n| Property 'instance_type_swap'         | 0                                    |\n| Property 'instance_type_vcpus'        | 1                                    |\n| Property 'instance_uuid'              | 7961383e-7528-4e26-8889-ab452bae0e7f |\n| Property 'network_allocated'          | True                                 |\n| Property 'owner_id'                   | a8085d1871f847bdb906ef4a28d1bd48     |\n| Property 'user_id'                    | a1c2ec19759040e39f219fcf82028bf6     |\n| checksum                              | 070cf4308133712b8711fa797a0d1f5f     |\n| container_format                      | bare                                 |\n| created_at                            | 2015-02-17T03:17:26                  |\n| deleted                               | False                                |\n| disk_format                           | raw                                  |\n| id                                    | 9b641354-3875-49c5-9cc0-3b722791ccab |\n| is_public                             | False                                |\n| min_disk                              | 1                                    |\n| min_ram                               | 0                                    |\n| name                                  | admin_vm01_bkup                      |\n| owner                                 | a8085d1871f847bdb906ef4a28d1bd48     |\n| protected                             | False                                |\n| size                                  | 1073741824                           |\n| status                                | active                               |\n| updated_at                            | 2015-02-17T03:18:19                  |\n+---------------------------------------+--------------------------------------+\n````\n\n\n### Take a backup (2nd)\n\n    # nova backup admin_vm01 admin_vm01_bkup daily 1\n\n\n    # nova help backup\n    usage: nova backup <server> <name> <backup-type> <rotation>\n\n    Backup a server by creating a 'backup' type snapshot.\n\n    Positional arguments:\n      <server>       Name or ID of server.\n      <name>         Name of the backup image.\n      <backup-type>  The backup type, like \"daily\" or \"weekly\".\n      <rotation>     Int parameter representing how many backups to keep around.\n\nNote:\n\n* `<backup-type>` is kind of TAG\n* `<rotation>` is How many backups you want to keep\n* Nova backup is not automatically backup function, it is just how many backups with having same TAG you want to keep.\n\n### Check the backup\n\n* Being Backup\n\nOnce the backup has been completed. 1st backup (9b641354-3875-49c5-9cc0-3b722791ccab) will be deleted. Because `<rotation>` is set \"1\".\n\n````\n    # glance image-list\n    +--------------------------------------+------------------------------------------+-------------+------------------+------------+--------+\n    | ID                                   | Name                                     | Disk Format | Container Format | Size       | Status |\n    +--------------------------------------+------------------------------------------+-------------+------------------+------------+--------+\n    | 9b641354-3875-49c5-9cc0-3b722791ccab | admin_vm01_bkup                          | raw         | bare             | 1073741824 | active |\n    | 7cd46251-edbd-444b-a34f-8369420b40ce | admin_vm01_bkup                          | raw         | bare             |            | queued |\n    +--------------------------------------+------------------------------------------+-------------+------------------+------------+--------+\n````\n\n* Complete\n\n1st backup (9b641354-3875-49c5-9cc0-3b722791ccab) has been deleted.\n\n````\n    # glance image-list\n    +--------------------------------------+------------------------------------------+-------------+------------------+------------+--------+\n    | ID                                   | Name                                     | Disk Format | Container Format | Size       | Status |\n    +--------------------------------------+------------------------------------------+-------------+------------------+------------+--------+\n    | 7cd46251-edbd-444b-a34f-8369420b40ce | admin_vm01_bkup                          | raw         | bare             | 1073741824 | active |\n    +--------------------------------------+------------------------------------------+-------------+------------------+------------+--------+\n````\n\n\n\n## Restore from the backup (= Create new Nova instance)\n\n### Check necessary infomation\n\n* Network\n\n````\n# neutron net-list | egrep \" id |net04\"\n| id                                   | name           | subnets                                               |\n| b3fa9d4d-4c21-47f5-be07-cf2ff518035e | net04          | 77267538-9be9-47db-a983-9139de4efe50 192.168.12.0/24  |\n````\n\n* Security Group\n\n````\n# nova secgroup-list\n+--------------------------------------+---------+-------------+\n| Id                                   | Name    | Description |\n+--------------------------------------+---------+-------------+\n| 319b5bc2-5df2-44c1-b2d9-8d08689e4a8a | default | default     |\n+--------------------------------------+---------+-------------+\n````\n\n* Flavor\n\n````\n# nova flavor-list\n+--------------------------------------+---------------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID                                   | Name          | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+--------------------------------------+---------------+-----------+------+-----------+------+-------+-------------+-----------+\n| 1                                    | m1.tiny       | 512       | 1    | 0         |      | 1     | 1.0         | True      |\n| 12d7efd2-2d1d-44ec-ad66-ce7ca8927c0b | m1.medium     | 4096      | 0    | 0         |      | 2     | 1.0         | True      |\n| 2                                    | m1.small      | 2048      | 20   | 0         |      | 1     | 1.0         | True      |\n| 318a3051-4304-4f3a-bda7-6f3a7637152b | m1.nano       | 256       | 1    | 0         |      | 1     | 1.0         | True      |\n| 4                                    | m1.large      | 8192      | 80   | 0         |      | 4     | 1.0         | True      |\n| 5                                    | m1.xlarge     | 16384     | 160  | 0         |      | 8     | 1.0         | True      |\n+--------------------------------------+---------------+-----------+------+-----------+------+-------+-------------+-----------+\n````\n\n### Restore from the image(backup) (= Create new Nova instance)\n\n    # nova boot --flavor m1.nano \\\n                --image admin_vm01_bkup \\\n                --security-groups default \\\n                --availability-zone nova \\\n                --nic net-id=b3fa9d4d-4c21-47f5-be07-cf2ff518035e \\\n                admin_vm02\n    +--------------------------------------+--------------------------------------------------------+\n    | Property                             | Value                                                  |\n    +--------------------------------------+--------------------------------------------------------+\n    | OS-DCF:diskConfig                    | MANUAL                                                 |\n    | OS-EXT-AZ:availability_zone          | nova                                                   |\n    | OS-EXT-SRV-ATTR:host                 | -                                                      |\n    | OS-EXT-SRV-ATTR:hypervisor_hostname  | -                                                      |\n    | OS-EXT-SRV-ATTR:instance_name        | instance-00000444                                      |\n    | OS-EXT-STS:power_state               | 0                                                      |\n    | OS-EXT-STS:task_state                | scheduling                                             |\n    | OS-EXT-STS:vm_state                  | building                                               |\n    | OS-SRV-USG:launched_at               | -                                                      |\n    | OS-SRV-USG:terminated_at             | -                                                      |\n    | accessIPv4                           |                                                        |\n    | accessIPv6                           |                                                        |\n    | adminPass                            | Df9gLcC7nkHq                                           |\n    | config_drive                         |                                                        |\n    | created                              | 2015-02-17T03:02:25Z                                   |\n    | flavor                               | m1.nano (318a3051-4304-4f3a-bda7-6f3a7637152b)         |\n    | hostId                               |                                                        |\n    | id                                   | 94c75110-54a7-408a-b7e6-13b6961617bf                   |\n    | image                                | admin_vm01_bkup (7cd46251-edbd-444b-a34f-8369420b40ce) |\n    | key_name                             | -                                                      |\n    | metadata                             | {}                                                     |\n    | name                                 | admin_vm02                                             |\n    | os-extended-volumes:volumes_attached | []                                                     |\n    | progress                             | 0                                                      |\n    | security_groups                      | default                                                |\n    | status                               | BUILD                                                  |\n    | tenant_id                            | a8085d1871f847bdb906ef4a28d1bd48                       |\n    | updated                              | 2015-02-17T03:02:25Z                                   |\n    | user_id                              | a1c2ec19759040e39f219fcf82028bf6                       |\n    +--------------------------------------+--------------------------------------------------------+\n\n\n### Check the restored Nova instance\n\n    # nova list\n    +--------------------------------------+------------+--------+------------+-------------+---------------------+\n    | ID                                   | Name       | Status | Task State | Power State | Networks            |\n    +--------------------------------------+------------+--------+------------+-------------+---------------------+\n    | 7961383e-7528-4e26-8889-ab452bae0e7f | admin_vm01 | ACTIVE | -          | Running     | net04=192.168.12.78 |\n    | 94c75110-54a7-408a-b7e6-13b6961617bf | admin_vm02 | ACTIVE | -          | Running     | net04=192.168.12.79 |\n    +--------------------------------------+------------+--------+------------+-------------+---------------------+\n\n\n## Environment\n\n* Openstack : Juno\n* Ceph : Firefly\n\n\n## Reference\n\n\n[Nova Snapshot/Restore][link-01]\n[Nova Backup/Restore][link-02]\n\n[link-01]:http://qiita.com/idzzy/items/30d461d823b71810d183\n[link-02]:http://qiita.com/idzzy/items/8b7833fc42b43a6db219\n", "tags": ["openstack", "nova"]}