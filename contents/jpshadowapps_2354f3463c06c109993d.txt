{"context": " More than 1 year has passed since last update.\uff08Rails + MySQL \u3092\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\uff09\n\u2193\u306e\u3088\u3046\u306a3TBL\u304c\u3042\u308b\u3068\u3059\u308b\nclass CreateAtbl < ActiveRecord::Migration\n  def change\n    create_table :atbls do |t|\n      t.string :name\n    end\n  end\nend\n\nclass CreateBtbl < ActiveRecord::Migration\n  def change\n    create_table :btbls do |t|\n      t.string :name\n      t.integer :b_a_id  # A\u30c6\u30fc\u30d6\u30eb\u306eID\u3092\u4fdd\u6301\n    end\n  end\nend\n\nclass CreateCtbl < ActiveRecord::Migration\n  def change\n    create_table :ctbls do |t|\n      t.string :name\n      t.integer :c_a_id  # A\u30c6\u30fc\u30d6\u30eb\u306eID\u3092\u4fdd\u6301\n    end\n  end\nend\n\nclass Atbl < ActiveRecord::Base\n  has_many :btbls, foreign_key: \"b_a_id\"\n  has_many :ctbls, foreign_key: \"c_a_id\"\nend\n\nclass Btbl < ActiveRecord::Base\n  belongs_to :atbl, foreign_key: \"b_a_id\"\n\n  ### \u3053\u3053\u306b Ctbl \u3068\u306e has_many \u3092\u5b9a\u7fa9\u3057\u305f\u3044 ###\n\nend\n\nclass Ctbl < ActiveRecord::Base\n  belongs_to :atbl, foreign_key: \"c_a_id\"\nend\n\n# atbls\nid  name\n1   A1\n\n# btbls\nid  name    b_a_id\n2   B1          1\n\n# ctbls\nid  name    c_a_id\n3   C1          1\n\nB\u30c6\u30fc\u30d6\u30eb => C\u30c6\u30fc\u30d6\u30eb\u306ehas_many\u95a2\u9023 \u3092\u3069\u3046\u8a2d\u5b9a\u3059\u308b\u304b\uff1f\n\nhas_many :ctbls, through: :atbl\u3092\u4f7f\u3046\n\nB\u30c6\u30fc\u30d6\u30eb\u3068C\u30c6\u30fc\u30d6\u30eb\u306f\u304a\u4e92\u3044\u306bA\u30c6\u30fc\u30d6\u30eb\u306eID\u3092\u4fdd\u6301\u3057\u3066\u3044\u308b\u306e\u3067\u3001:through\u3067A\u30c6\u30fc\u30d6\u30eb\u3092\u7d4c\u7531\u3059\u308c\u3070\u7d10\u4ed8\u304f\n\nclass Btbl < ActiveRecord::Base\n  belongs_to :atbl, foreign_key: \"b_a_id\"\n\n  has_many :ctbls, through: :atbl # \u2605\u2605\u2605\nend\n\n[Ruby2.2.2][Rails4.2.1](beers|test_arel)> bdata = Btbl.find(2)\n  Btbl Load (0.2ms)  SELECT  `btbls`.* FROM `btbls` WHERE `btbls`.`id` = 2 LIMIT 1\n+----+------+--------+\n| id | name | b_a_id |\n+----+------+--------+\n| 2  | B1   | 1      |\n+----+------+--------+\n1 row in set\n\n[Ruby2.2.2][Rails4.2.1](beers|test_arel)> bdata.ctbls\n  Ctbl Load (0.3ms)  SELECT `ctbls`.* FROM `ctbls` INNER JOIN `atbls` ON `ctbls`.`c_a_id` = `atbls`.`id` WHERE `atbls`.`id` = 1\n+----+------+--------+\n| id | name | c_a_id |\n+----+------+--------+\n| 3  | C1   | 1      |\n+----+------+--------+\n1 row in set\n\n\u3057\u304b\u3057\u3001 \u304a\u4e92\u3044\u540c\u3058\u5185\u5bb9\u306e\u30ab\u30e9\u30e0\u3092\u4fdd\u6301\u3057\u3066\u3044\u308b\u306e\u306b\u308f\u3056\u308f\u3056\u7d4c\u7531\u30c6\u30fc\u30d6\u30eb\u3068 INNER JOIN \u3059\u308b\u306e\u306f\u7121\u99c4\nbtbls.b_a_id \u3068 ctbls.c_a_id \u3092\u76f4\u63a5\u7d50\u5408\u3057\u305f\u3044\n\nhas_many :ctbls, primary_key: \"b_a_id\", foreign_key: \"c_a_id\"\u3092\u4f7f\u3046\n\n\nhas_many :\u7d10\u4ed8\u3051\u5148, primary_key: \"\u81eaTBL\u306e\u7d50\u5408\u7528\u30ab\u30e9\u30e0\", foreign_key: \"\u7d10\u4ed8\u3051\u5148TBL\u306e\u7d50\u5408\u7528\u30ab\u30e9\u30e0 \u3068\u66f8\u304f\u3068\u826f\u3044\n\nclass Btbl < ActiveRecord::Base\n  belongs_to :atbl, foreign_key: \"b_a_id\"\n\n  has_many :ctbls, primary_key: \"b_a_id\", foreign_key: \"c_a_id\" ## \u2605\u2605\u2605\nend\n\n[Ruby2.2.2][Rails4.2.1](beers|test_arel)> bdata = Btbl.find(2)\n  Btbl Load (0.2ms)  SELECT  `btbls`.* FROM `btbls` WHERE `btbls`.`id` = 2 LIMIT 1\n+----+------+--------+\n| id | name | b_a_id |\n+----+------+--------+\n| 2  | B1   | 1      |\n+----+------+--------+\n1 row in set\n\n[Ruby2.2.2][Rails4.2.1](beers|test_arel)> bdata.ctbls\n  Ctbl Load (0.4ms)  SELECT `ctbls`.* FROM `ctbls` WHERE `ctbls`.`c_a_id` = 1\n+----+------+--------+\n| id | name | c_a_id |\n+----+------+--------+\n| 3  | C1   | 1      |\n+----+------+--------+\n1 row in set\n\n\n\nINNER JOIN\u3057\u3066\u306a\u3044\u306e\u3067\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u7684\u306b:through\u3059\u308b\u3088\u308a\u3082\u6709\u5229\n\n\u305f\u3060\u3057\u7d4c\u7531\u30c6\u30fc\u30d6\u30eb\u306b\u30c7\u30fc\u30bf\u304c\u5b58\u5728\u3059\u308b\u3053\u3068\u304cMUST\u3001\u3068\u3044\u3046\u5834\u5408\u306b\u306f\u5f53\u7136:through\u3059\u3079\u304d\n\n\n\n:through\u306e\u4f7f\u3044\u65b9\u3067\u7591\u554f\u306b\u601d\u3046\u3053\u3068\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u8abf\u67fb\u30e1\u30e2\u3068\u3057\u3066\u6b8b\u3057\u3068\u304f\n\uff08Rails + MySQL \u3092\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\uff09\n\n\u2193\u306e\u3088\u3046\u306a3TBL\u304c\u3042\u308b\u3068\u3059\u308b\n\n```rb\nclass CreateAtbl < ActiveRecord::Migration\n  def change\n    create_table :atbls do |t|\n      t.string :name\n    end\n  end\nend\n\nclass CreateBtbl < ActiveRecord::Migration\n  def change\n    create_table :btbls do |t|\n      t.string :name\n      t.integer :b_a_id  # A\u30c6\u30fc\u30d6\u30eb\u306eID\u3092\u4fdd\u6301\n    end\n  end\nend\n\nclass CreateCtbl < ActiveRecord::Migration\n  def change\n    create_table :ctbls do |t|\n      t.string :name\n      t.integer :c_a_id  # A\u30c6\u30fc\u30d6\u30eb\u306eID\u3092\u4fdd\u6301\n    end\n  end\nend\n```\n```rb\nclass Atbl < ActiveRecord::Base\n  has_many :btbls, foreign_key: \"b_a_id\"\n  has_many :ctbls, foreign_key: \"c_a_id\"\nend\n\nclass Btbl < ActiveRecord::Base\n  belongs_to :atbl, foreign_key: \"b_a_id\"\n  \n  ### \u3053\u3053\u306b Ctbl \u3068\u306e has_many \u3092\u5b9a\u7fa9\u3057\u305f\u3044 ###\n\nend\n\nclass Ctbl < ActiveRecord::Base\n  belongs_to :atbl, foreign_key: \"c_a_id\"\nend\n```\n```\n# atbls\nid\tname\n1\tA1\n\n# btbls\nid\tname\tb_a_id\n2\tB1      \t1\n\n# ctbls\nid\tname\tc_a_id\n3\tC1      \t1\n```\n\n__B\u30c6\u30fc\u30d6\u30eb => C\u30c6\u30fc\u30d6\u30eb\u306e`has_many`\u95a2\u9023__ \u3092\u3069\u3046\u8a2d\u5b9a\u3059\u308b\u304b\uff1f\n\n## `has_many :ctbls, through: :atbl`\u3092\u4f7f\u3046\n* B\u30c6\u30fc\u30d6\u30eb\u3068C\u30c6\u30fc\u30d6\u30eb\u306f\u304a\u4e92\u3044\u306bA\u30c6\u30fc\u30d6\u30eb\u306eID\u3092\u4fdd\u6301\u3057\u3066\u3044\u308b\u306e\u3067\u3001`:through`\u3067A\u30c6\u30fc\u30d6\u30eb\u3092\u7d4c\u7531\u3059\u308c\u3070\u7d10\u4ed8\u304f\n\n```rb\nclass Btbl < ActiveRecord::Base\n  belongs_to :atbl, foreign_key: \"b_a_id\"\n\n  has_many :ctbls, through: :atbl # \u2605\u2605\u2605\nend\n```\n\n```\n[Ruby2.2.2][Rails4.2.1](beers|test_arel)> bdata = Btbl.find(2)\n  Btbl Load (0.2ms)  SELECT  `btbls`.* FROM `btbls` WHERE `btbls`.`id` = 2 LIMIT 1\n+----+------+--------+\n| id | name | b_a_id |\n+----+------+--------+\n| 2  | B1   | 1      |\n+----+------+--------+\n1 row in set\n\n[Ruby2.2.2][Rails4.2.1](beers|test_arel)> bdata.ctbls\n  Ctbl Load (0.3ms)  SELECT `ctbls`.* FROM `ctbls` INNER JOIN `atbls` ON `ctbls`.`c_a_id` = `atbls`.`id` WHERE `atbls`.`id` = 1\n+----+------+--------+\n| id | name | c_a_id |\n+----+------+--------+\n| 3  | C1   | 1      |\n+----+------+--------+\n1 row in set\n```\n\n\u3057\u304b\u3057\u3001 __\u304a\u4e92\u3044\u540c\u3058\u5185\u5bb9\u306e\u30ab\u30e9\u30e0\u3092\u4fdd\u6301\u3057\u3066\u3044\u308b\u306e\u306b\u308f\u3056\u308f\u3056\u7d4c\u7531\u30c6\u30fc\u30d6\u30eb\u3068 `INNER JOIN` \u3059\u308b\u306e\u306f\u7121\u99c4__\n`btbls.b_a_id` \u3068 `ctbls.c_a_id` \u3092\u76f4\u63a5\u7d50\u5408\u3057\u305f\u3044\n\n\n## `has_many :ctbls, primary_key: \"b_a_id\", foreign_key: \"c_a_id\"`\u3092\u4f7f\u3046\n* `has_many :\u7d10\u4ed8\u3051\u5148, primary_key: \"\u81eaTBL\u306e\u7d50\u5408\u7528\u30ab\u30e9\u30e0\", foreign_key: \"\u7d10\u4ed8\u3051\u5148TBL\u306e\u7d50\u5408\u7528\u30ab\u30e9\u30e0` \u3068\u66f8\u304f\u3068\u826f\u3044\n\n```rb\nclass Btbl < ActiveRecord::Base\n  belongs_to :atbl, foreign_key: \"b_a_id\"\n\n  has_many :ctbls, primary_key: \"b_a_id\", foreign_key: \"c_a_id\" ## \u2605\u2605\u2605\nend\n```\n\n```\n[Ruby2.2.2][Rails4.2.1](beers|test_arel)> bdata = Btbl.find(2)\n  Btbl Load (0.2ms)  SELECT  `btbls`.* FROM `btbls` WHERE `btbls`.`id` = 2 LIMIT 1\n+----+------+--------+\n| id | name | b_a_id |\n+----+------+--------+\n| 2  | B1   | 1      |\n+----+------+--------+\n1 row in set\n\n[Ruby2.2.2][Rails4.2.1](beers|test_arel)> bdata.ctbls\n  Ctbl Load (0.4ms)  SELECT `ctbls`.* FROM `ctbls` WHERE `ctbls`.`c_a_id` = 1\n+----+------+--------+\n| id | name | c_a_id |\n+----+------+--------+\n| 3  | C1   | 1      |\n+----+------+--------+\n1 row in set\n```\n\n* __`INNER JOIN`\u3057\u3066\u306a\u3044\u306e\u3067\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u7684\u306b`:through`\u3059\u308b\u3088\u308a\u3082\u6709\u5229__\n    * \u305f\u3060\u3057\u7d4c\u7531\u30c6\u30fc\u30d6\u30eb\u306b\u30c7\u30fc\u30bf\u304c\u5b58\u5728\u3059\u308b\u3053\u3068\u304cMUST\u3001\u3068\u3044\u3046\u5834\u5408\u306b\u306f\u5f53\u7136`:through`\u3059\u3079\u304d\n\n`:through`\u306e\u4f7f\u3044\u65b9\u3067\u7591\u554f\u306b\u601d\u3046\u3053\u3068\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u8abf\u67fb\u30e1\u30e2\u3068\u3057\u3066\u6b8b\u3057\u3068\u304f\n", "tags": ["Rails", "ActiveRecord"]}