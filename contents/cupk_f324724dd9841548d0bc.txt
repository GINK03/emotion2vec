{"context": " More than 1 year has passed since last update.tmlib.js\u3067\u30ab\u30a6\u30f3\u30bf\u4ed8\u30dc\u30bf\u30f3\u3092Sprite\u3067\u5b9f\u88c5\u3057\u307e\u3057\u305f\u3002\n\u30ab\u30a6\u30f3\u30c8\u30a2\u30c3\u30d7\u30fb\u30c0\u30a6\u30f3\u5bfe\u5fdc\u3002\n\u30ab\u30a6\u30f3\u30c8MAX\u5024\u3092\u8d85\u3048\u308b\u30680\u306b\u623b\u308a\u307e\u3059\u3002\n/**\n * \u30ab\u30a6\u30f3\u30bf\u4ed8\u30dc\u30bf\u30f3\u30af\u30e9\u30b9\n */\nvar CounterButton = tm.createClass({\n    superClass: tm.app.Sprite,\n\n    count: 0,                       // \u30ab\u30a6\u30f3\u30c8\n    countValue: 1,                  // 1\u56de\u3054\u3068\u306e\u30ab\u30a6\u30f3\u30c8\u5024\n    limit: Number.MAX_VALUE - 1,    // \u30ab\u30a6\u30f3\u30c8\u306eMAX\u5024\u3002\u8d85\u3048\u308b\u30680\n    disabled: false,\n    label: null,        // \u30ab\u30a6\u30f3\u30c8\u5024\u8868\u793a\u30e9\u30d9\u30eb\n\n    normalImage: null,\n    pushImage: null,\n    filter: null,\n\n    init: function(x, y, image, width, height, limit) {\n        // \u753b\u50cf\u6307\u5b9a\u7121\u3057\u306a\u3089\u56fa\u5b9a\u306e\u753b\u50cf\u3092\u6307\u5b9a\n        this.normalImage = (image == null) ? \"button\" : image;\n\n        // \u30b5\u30a4\u30ba\u6307\u5b9a\u7121\u3057\u306a\u3089\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u3092\u4f7f\u7528\n        var img = tm.graphics.TextureManager.get(this.normalImage);\n        if (width == null) { width = img.width; }\n        if (height == null) { height = img.height; }\n        this.superInit(width, height, image);\n        this.setPosition(x, y);\n\n        if (limit != null) { this.limit = limit; }\n\n        this.label = tm.app.Label(\"\");\n        this.label.width = width;\n        this.label.text = this.count;\n        this.label.setAlign(\"center\").addChildTo(this);\n\n        // \u30dc\u30bf\u30f3\u62bc\u4e0b\u6642\u306e\u30d5\u30a3\u30eb\u30bf\u30fc\u4f5c\u6210\uff08\u30dc\u30bf\u30f3\u62bc\u4e0b\u6642\u306eImage\u304c\u7121\u3044\u5834\u5408\u3053\u3061\u3089\u3092\u4f7f\u7528\uff09\n        var filter = tm.app.Shape(this.image.width, this.image.height);\n        filter.canvas.clearColor(\"rgba(0, 0, 0, 0.3)\");\n        this.filter = filter;\n\n        // \u30de\u30a6\u30b9\u30a4\u30d9\u30f3\u30c8\u3092\u6709\u52b9\u5316\n        this.interaction.enabled = true;\n        this.interaction.boundingType = \"rect\";\n    },\n\n    update: function() {\n    },\n\n    // \u30ab\u30a6\u30f3\u30bf\u30c6\u30ad\u30b9\u30c8(tm.app.Label)\u3092\u8fd4\u3059\n    getLabel: function() {\n        return this.label;\n    },\n\n    // \u30dc\u30bf\u30f3\u62bc\u4e0b\u6642\n    onpointingstart: function() {\n        if (this.disabled) { return; }\n\n        if (this.pushImage == null) {\n            this.filter.addChildTo(this);\n        } else {\n            this.image = this.pushImage;\n        }\n    },\n\n    // \u30dc\u30bf\u30f3\u62bc\u4e0b\u5f8c\n    onpointingend: function() {\n        if (this.disabled) { return; }\n\n        // \u753b\u50cf\u30ea\u30bb\u30c3\u30c8\n        this.image = this.normalImage;\n        this.filter.remove();\n\n        // \u30ab\u30a6\u30f3\u30c8\u30a2\u30c3\u30d7or\u30c0\u30a6\u30f3\n        this.count += this.countValue;\n        if (this.limit >= 0 && this.count > this.limit) { this.count = 0; }\n        if (this.limit < 0 && this.count < this.limit) { this.count = 0; }\n        this.label.text = this.count;\n    },\n});\n\n\n\u4f7f\u7528\u4f8b\uff08\u30ab\u30a6\u30f3\u30c8\u4ed8\u30dc\u30bf\u30f3\u306e\u30af\u30e9\u30b9\u5b9a\u7fa9\u306f\u7701\u7565\uff09\n/*\n * constant\n */\nvar SCREEN_WIDTH    = 640;\nvar SCREEN_HEIGHT   = 920;\nvar SCREEN_CENTER_X = SCREEN_WIDTH / 2;\nvar SCREEN_CENTER_Y = SCREEN_HEIGHT / 2;\n\n// \u753b\u50cf\u306e\u30d7\u30ea\u30ed\u30fc\u30c9\ntm.preload(function(){\n    tm.graphics.TextureManager.add(\"button\", \"button.png\");\n});\n\n/*\n * \u30e1\u30a4\u30f3\u51e6\u7406(\u30da\u30fc\u30b8\u8aad\u307f\u8fbc\u307f\u5f8c\u306b\u5b9f\u884c\u3055\u308c\u308b)\n */\ntm.main(function() {\n\n    // \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u4f5c\u6210\n    var app = tm.app.CanvasApp(\"#world\");\n    app.resize(SCREEN_WIDTH, SCREEN_HEIGHT); // \u30ea\u30b5\u30a4\u30ba\n    app.fitWindow();    // \u81ea\u52d5\u30d5\u30a3\u30c3\u30c8\n    app.background = \"white\";\n\n    // \u30b7\u30fc\u30f3\u3092\u5207\u308a\u66ff\u3048\u308b\n    app.replaceScene(MainScene());\n\n    // \u5b9f\u884c\n    app.run();\n});\n\n\ntm.define(\"MainScene\", {\n    superClass: \"tm.app.Scene\",\n\n    init: function() {\n        // \u89aa\u306e\u521d\u671f\u5316\n        this.superInit();\n\n        // \u30ab\u30a6\u30f3\u30bf\u4ed8\u304d\u30dc\u30bf\u30f3\n        var counter = CounterButton(300, 100, \"button\");\n        counter.getLabel().setFillStyle(\"black\").setFontSize(32).setPosition(0, 10);\n        counter.limit = 9;\n        counter.addChildTo(this);\n    },\n\n});\n\n\n\u521d\u671f\u8868\u793a\n\n\n\u30af\u30ea\u30c3\u30af or \u30bf\u30c3\u30d7\u3067\u30ab\u30a6\u30f3\u30c8\u304c\u4e0a\u304c\u308a\u307e\u3059\u3002\n\ntmlib.js\u3067\u30ab\u30a6\u30f3\u30bf\u4ed8\u30dc\u30bf\u30f3\u3092Sprite\u3067\u5b9f\u88c5\u3057\u307e\u3057\u305f\u3002\n\u30ab\u30a6\u30f3\u30c8\u30a2\u30c3\u30d7\u30fb\u30c0\u30a6\u30f3\u5bfe\u5fdc\u3002\n\u30ab\u30a6\u30f3\u30c8MAX\u5024\u3092\u8d85\u3048\u308b\u30680\u306b\u623b\u308a\u307e\u3059\u3002\n\n```js:\n/**\n * \u30ab\u30a6\u30f3\u30bf\u4ed8\u30dc\u30bf\u30f3\u30af\u30e9\u30b9\n */\nvar CounterButton = tm.createClass({\n\tsuperClass: tm.app.Sprite,\n\t\n\tcount: 0,                       // \u30ab\u30a6\u30f3\u30c8\n\tcountValue: 1,                  // 1\u56de\u3054\u3068\u306e\u30ab\u30a6\u30f3\u30c8\u5024\n\tlimit: Number.MAX_VALUE - 1,    // \u30ab\u30a6\u30f3\u30c8\u306eMAX\u5024\u3002\u8d85\u3048\u308b\u30680\n\tdisabled: false,\n\tlabel: null,        // \u30ab\u30a6\u30f3\u30c8\u5024\u8868\u793a\u30e9\u30d9\u30eb\n\t\n\tnormalImage: null,\n\tpushImage: null,\n\tfilter: null,\n\t\n\tinit: function(x, y, image, width, height, limit) {\n\t\t// \u753b\u50cf\u6307\u5b9a\u7121\u3057\u306a\u3089\u56fa\u5b9a\u306e\u753b\u50cf\u3092\u6307\u5b9a\n\t\tthis.normalImage = (image == null) ? \"button\" : image;\n\t\t\n\t\t// \u30b5\u30a4\u30ba\u6307\u5b9a\u7121\u3057\u306a\u3089\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u3092\u4f7f\u7528\n\t\tvar img = tm.graphics.TextureManager.get(this.normalImage);\n\t\tif (width == null) { width = img.width; }\n\t\tif (height == null) { height = img.height; }\n\t\tthis.superInit(width, height, image);\n\t\tthis.setPosition(x, y);\n\t\t\n\t\tif (limit != null) { this.limit = limit; }\n\t\t\n\t\tthis.label = tm.app.Label(\"\");\n\t\tthis.label.width = width;\n\t\tthis.label.text = this.count;\n\t\tthis.label.setAlign(\"center\").addChildTo(this);\n\t\t\n\t\t// \u30dc\u30bf\u30f3\u62bc\u4e0b\u6642\u306e\u30d5\u30a3\u30eb\u30bf\u30fc\u4f5c\u6210\uff08\u30dc\u30bf\u30f3\u62bc\u4e0b\u6642\u306eImage\u304c\u7121\u3044\u5834\u5408\u3053\u3061\u3089\u3092\u4f7f\u7528\uff09\n\t\tvar filter = tm.app.Shape(this.image.width, this.image.height);\n\t\tfilter.canvas.clearColor(\"rgba(0, 0, 0, 0.3)\");\n\t\tthis.filter = filter;\n\t\t\n\t\t// \u30de\u30a6\u30b9\u30a4\u30d9\u30f3\u30c8\u3092\u6709\u52b9\u5316\n\t\tthis.interaction.enabled = true;\n\t\tthis.interaction.boundingType = \"rect\";\n\t},\n\t\n\tupdate: function() {\n\t},\n\t\n\t// \u30ab\u30a6\u30f3\u30bf\u30c6\u30ad\u30b9\u30c8(tm.app.Label)\u3092\u8fd4\u3059\n\tgetLabel: function() {\n\t\treturn this.label;\n\t},\n\t\n\t// \u30dc\u30bf\u30f3\u62bc\u4e0b\u6642\n\tonpointingstart: function() {\n\t\tif (this.disabled) { return; }\n\t\t\n\t\tif (this.pushImage == null) {\n\t\t\tthis.filter.addChildTo(this);\n\t\t} else {\n\t\t\tthis.image = this.pushImage;\n\t\t}\n\t},\n\t\n\t// \u30dc\u30bf\u30f3\u62bc\u4e0b\u5f8c\n\tonpointingend: function() {\n\t\tif (this.disabled) { return; }\n\t\t\n\t\t// \u753b\u50cf\u30ea\u30bb\u30c3\u30c8\n\t\tthis.image = this.normalImage;\n\t\tthis.filter.remove();\n\t\t\n\t\t// \u30ab\u30a6\u30f3\u30c8\u30a2\u30c3\u30d7or\u30c0\u30a6\u30f3\n\t\tthis.count += this.countValue;\n\t\tif (this.limit >= 0 && this.count > this.limit) { this.count = 0; }\n\t\tif (this.limit < 0 && this.count < this.limit) { this.count = 0; }\n\t\tthis.label.text = this.count;\n\t},\n});\n```\n\n<br/>\n\u4f7f\u7528\u4f8b\uff08\u30ab\u30a6\u30f3\u30c8\u4ed8\u30dc\u30bf\u30f3\u306e\u30af\u30e9\u30b9\u5b9a\u7fa9\u306f\u7701\u7565\uff09\n\n```js:\n/*\n * constant\n */\nvar SCREEN_WIDTH    = 640;\nvar SCREEN_HEIGHT   = 920;\nvar SCREEN_CENTER_X = SCREEN_WIDTH / 2;\nvar SCREEN_CENTER_Y = SCREEN_HEIGHT / 2;\n\n// \u753b\u50cf\u306e\u30d7\u30ea\u30ed\u30fc\u30c9\ntm.preload(function(){\n\ttm.graphics.TextureManager.add(\"button\", \"button.png\");\n});\n\n/*\n * \u30e1\u30a4\u30f3\u51e6\u7406(\u30da\u30fc\u30b8\u8aad\u307f\u8fbc\u307f\u5f8c\u306b\u5b9f\u884c\u3055\u308c\u308b)\n */\ntm.main(function() {\n\t\n\t// \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u4f5c\u6210\n\tvar app = tm.app.CanvasApp(\"#world\");\n\tapp.resize(SCREEN_WIDTH, SCREEN_HEIGHT); // \u30ea\u30b5\u30a4\u30ba\n\tapp.fitWindow();    // \u81ea\u52d5\u30d5\u30a3\u30c3\u30c8\n\tapp.background = \"white\";\n\t\n\t// \u30b7\u30fc\u30f3\u3092\u5207\u308a\u66ff\u3048\u308b\n\tapp.replaceScene(MainScene());\n\t\n\t// \u5b9f\u884c\n\tapp.run();\n});\n\n\ntm.define(\"MainScene\", {\n\tsuperClass: \"tm.app.Scene\",\n\t\n\tinit: function() {\n\t\t// \u89aa\u306e\u521d\u671f\u5316\n\t\tthis.superInit();\n\t\t\n\t\t// \u30ab\u30a6\u30f3\u30bf\u4ed8\u304d\u30dc\u30bf\u30f3\n\t\tvar counter = CounterButton(300, 100, \"button\");\n\t\tcounter.getLabel().setFillStyle(\"black\").setFontSize(32).setPosition(0, 10);\n\t\tcounter.limit = 9;\n\t\tcounter.addChildTo(this);\n\t},\n\n});\n```\n\n<br/>\n\u521d\u671f\u8868\u793a\n![countbutton1.png](https://qiita-image-store.s3.amazonaws.com/0/25969/7e891e58-fca8-295f-0eb4-3cc641976e69.png)\n\n<br/>\n\u30af\u30ea\u30c3\u30af or \u30bf\u30c3\u30d7\u3067\u30ab\u30a6\u30f3\u30c8\u304c\u4e0a\u304c\u308a\u307e\u3059\u3002\n![countbutton2.png](https://qiita-image-store.s3.amazonaws.com/0/25969/06c5a591-5894-aa95-38ff-1ca0cf8e456c.png)\n", "tags": ["JavaScript", "tmlib.js"]}