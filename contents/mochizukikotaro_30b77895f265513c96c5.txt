{"tags": ["td-agent", "fluentd", "Athena"], "context": "\n\n\u4eca\u3044\u307e\u3001\u3042\u308b\u3068\u3053\u308d\u306b\nRails \u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u304c\u3042\u308a\u307e\u3057\u305f\u3002  \n\u305d\u3053\u3067\u306f\u3001lograge \u3068\u3044\u3046 gem \u3092\u3044\u308c\u3066\u3001/log/development.log \u306b\u6b32\u3057\u3044\u30ed\u30b0\u60c5\u5831\u3092 JSON \u5f62\u5f0f\u3067\u9001\u308a\u3064\u3051\u3066\u3044\u307e\u3057\u305f\u3002\n\n/config/initializers/lograge.rb\nRails.application.configure do\n  config.lograge.enabled = true\n  config.lograge.formatter = Lograge::Formatters::Json.new\n  config.lograge.custom_options = lambda do |event|\n    {\n      user_id: event.payload[:user_id],\n      user_email: event.payload[:user_email],\n    }\n  end\nend\n\n\n\n/log/development.log\n# ...\u30a4\u30e1\u30fc\u30b8\n{\"method\":\"GET\",\"path\":\"/dashboard/events\",\"format\":\"json\",\"controller\":\"DashboardController\",\"action\":\"events\",\"status\":200,\"duration\":68.21,\"view\":0.44,\"db\":0.0,\"user_id\":\"9999\",\"user_email\":\"mochizuki@hoge.com\"}\n\n\n\u3053\u3053\u306b td-agent \u3092\u5165\u308c\u3066\u3001\u30ed\u30b0\u3092 S3 \u306b\u9001\u308a\u3001Amazon Athena \u304b\u3089 SQL \u30e9\u30a4\u30af\u306b\u30ed\u30b0\u3092\u62bd\u51fa\u3059\u308b\u3068\u3044\u3046\u3053\u3068\u3092\u3084\u308a\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u6700\u7d42\u7684\u306a\u30a4\u30e1\u30fc\u30b8\n\n\n\n\u307e\u305a td-agent (Fluentd) \u3092\u5165\u308c\u308b\u3068\u3053\u308d\u304b\u3089\nInstalling Fluentd using .dmg Installer (MacOS X) \u3053\u3053\u306b\u66f8\u3044\u3066\u3042\u308b\u3068\u304a\u308a\u306b\u3001Download \u3057\u3066\u3001td-agent \u3092\u5165\u308c\u307e\u3059\u3002\u3053\u308c\u306f\u3059\u3050\u306b\u30b9\u30eb\u3063\u3068\u5165\u308b\u3068\u601d\u3044\u307e\u3059\u3002 \n\u3064\u304e\u306b\u3001fluent-plugin-s3 \u3068\u3044\u3046\u3082\u306e\u3092\u5165\u308c\u305f\u3044\u306e\u3067\u3059\u304c\u3001\u3053\u308c\u304c\u96e3\u3057\u304b\u3063\u305f\u3067\u3059\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n/opt/td-agent/usr/sbin/td-agent-gem install fluent-plugin-s3\n\n\n\u7d50\u8ad6\u3001\u4e0a\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3044\u3051\u308b\u306e\u3067\u3059\u304c\u3001...\u3068\u306b\u304b\u304f\u884c\u3051\u307e\u3059\u3002\nref. http://docs.fluentd.org/v0.12/articles/faq#i-installed-td-agent-and-want-to-add-custom-plugins-how-do-i-do-it\n\uff08\u81ea\u5206\u7528\u306e\u30e1\u30e2\u3002\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u304b\u3089 /opt/td-agent/usr/sbin/td-agent \u306e\u5834\u6240\u3092\u78ba\u8a8d\u3002\uff09\n\n/Library/LaunchDaemons/td-agent.plist\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n<plist version=\"1.0\">\n<dict>\n  <key>KeepAlive</key>\n  <true/>\n  <key>Label</key>\n  <string>td-agent</string>\n  <key>ProgramArguments</key>\n  <array>\n    <string>/opt/td-agent/usr/sbin/td-agent</string>\n    <string>--log</string>\n    <string>/var/log/td-agent/td-agent.log</string>\n    <string>--use-v1-config</string>\n  </array>\n  <key>RunAtLoad</key>\n  <true/>\n  <key>WorkingDirectory</key>\n  <string>/opt/td-agent</string>\n</dict>\n</plist>\n\n\n\n\u3064\u3065\u3044\u3066\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304d\u307e\u3059\u3002\n\u3044\u308d\u3044\u308d\u5b66\u3073\u306a\u304c\u3089\uff08\u30cf\u30de\u308a\u306a\u304c\u3089\uff09\u3001\u5b8c\u6210\u3057\u305f\u306e\u304c\u4e0b\u3067\u3059\u3002\uff08\u4e00\u5fdc\u3053\u308c\u3067\u3001\u3084\u308a\u305f\u3044\u3053\u3068\u306f\u3067\u304d\u307e\u3057\u305f\u3002\uff09\n\n/etc/td-agent/td-agent.conf\n<source>\n  type forward\n</source>\n\n<source>\n  type     tail\n  tag      lograge\n  format   json\n  path     {project-path}/log/development.log\n  pos_file {project-path}/log/development.log.pos\n  time_key time\n</source>\n\n<match lograge>\n  @type copy\n  <store>\n    @type stdout\n  </store>\n  <store>\n    @type s3\n    format json\n    aws_key_id {aws_access_key_id}\n    aws_sec_key {aws_secret_access_key}\n    s3_bucket {my_bucket_name}\n    s3_region ap-northeast-1\n    path lograge_logs/ # \u4efb\u610f\u306b\u6307\u5b9a\u3067\u304d\u307e\u3059\n    buffer_path /var/log/fluent/lograge_s3 # \u4efb\u610f\u306b\u6307\u5b9a\u3067\u304d\u307e\u3059\n    buffer_chunk_limit 100k\n    time_slice_format year=%Y/month=%m/day=%d/%Y%m%d-%H\n    utc\n  </store>\n</match>\n\n\n\n\u30dd\u30a4\u30f3\u30c8\u8aac\u660e\n\n\n@type stdout \u3067\u3001/var/log/td-agent/td-agent.log \u306b\u30ed\u30b0\u304c\u6d41\u308c\u3066\u304f\u308b\u306e\u3067\u3001\u3053\u308c\u3092 tail -f \u3057\u306a\u304c\u3089\u4f5c\u696d\u3092\u9032\u3081\u307e\u3057\u305f\u3002\n\nformat json \u3067 JSON\u5f62\u5f0f\u3067\uff08\u4f59\u8a08\u306a\u65e5\u6642\u30c7\u30fc\u30bf\u306a\u3069\u3092\u542b\u307e\u306a\u3044\u5f62\u3067\uff09\u5410\u304d\u51fa\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\n@type copy \u3067\u8907\u6570\u306e\u30a2\u30a6\u30c8\u30d7\u30c3\u30c8\u3092\u3057\u3066\u304f\u308c\u307e\u3059\u3002\uff08 stdout \u3068 s3 \u3078\u306e\u5410\u304d\u51fa\u3057\uff09\n\n@type copy \u306e\u5b58\u5728\u306b\u51fa\u4f1a\u3046\u307e\u3067\u3001\u307c\u304f\u306f\u4e00\u5411\u306b\u73fe\u308c\u306a\u3044\u30ed\u30b0\u3092\u6c38\u9060\u3068 \u5f85\u3061\u7d9a\u3051\u3066\u3044\u307e\u3057\u305f\u3002 \n\n(\u3053\u3093\u306a\u98a8\u306b\u66f8\u3044\u3066\u3044\u305f\u308f\u3051\u3067\u3059\u3002\uff09\n<match lograge>\n  @type stdout\n</match lograge>\n<match lograge>\n  @type s3\n  \u7701\u7565\n</match>\n\n\n\ntd-agent \u3092\u52d5\u304b\u3057\u3066\u304a\u304f\n\n\u52d5\u304b\u3059\nsudo launchctl load /Library/LaunchDaemons/td-agent.plist\n\n\n\n\u6b62\u3081\u308b\nsudo launchctl unload /Library/LaunchDaemons/td-agent.plist\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb td-agent.conf \u3092\u3044\u3058\u3063\u305f\u3089\u3001\u4e0a\u306e\u30b3\u30de\u30f3\u30c9\u3067 \"\u6b62\u3081\u3066\" \u30fb \"\u52d5\u304b\u3057\u3066\" \u53cd\u6620\u3055\u305b\u307e\u3059\u3002reload \u307f\u305f\u3044\u306a\u30b3\u30de\u30f3\u30c9\u306a\u3044\u306e\u304b\u306a\u3041\u3068\u304a\u3082\u3044\u3064\u3064\u3001&& \u3067\u3064\u306a\u3052\u3066\u304a\u624b\u88fd\u30ea\u30ed\u30fc\u30c9\u30b3\u30de\u30f3\u30c9\u3092\u4f55\u5ea6\u3082\u53e9\u304d\u307e\u3057\u305f\u3002\n\u4ee5\u4e0a\u3067\u3001/log/development.log \u306e JSON \u5f62\u5f0f\u306e\u30ed\u30b0\u304c\u3001S3://lograge \u306b\u30a2\u30c3\u30d7\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002  \n\nawscli\u3067\u306e\u78ba\u8a8d\n$ aws s3 ls --recursive  s3://my-bucket-name\n2017-02-02 17:10:27        270 lograge_logs/year=2017/month=02/day=02/20170202-07_0.gz\n2017-02-02 18:10:58       2580 lograge_logs/year=2017/month=02/day=02/20170202-08_0.gz\n2017-02-02 19:10:31        757 lograge_logs/year=2017/month=02/day=02/20170202-09_0.gz\n\n\n\nAmazon Athena \u306e\u8a2d\u5b9a\u3092\u3059\u308b\n\n\u30af\u30a8\u30ea\u304c\u304b\u3051\u308b\u306e\u3067\u3001create database hoge \u306a\u3069\u3067\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u3064\u304f\u308a\u307e\u3059\u3002\n\u305d\u3057\u3066\u3001\u30c6\u30fc\u30d6\u30eb\u3082\u30af\u30a8\u30ea\u3067\u3064\u304f\u308c\u308b\u306e\u3067\u3059\u304c\u3001\u305d\u308c\u306f\u5927\u5909\u305d\u3046\u306a\u306e\u3067\u3001Catalog Manager \u30e1\u30cb\u30e5\u30fc\u304b\u3089\u3064\u304f\u308a\u307e\u3059\u3002\n\u9053\u306a\u308a\u306b\u3059\u3059\u3081\u3070\u3001\u30b4\u30fc\u30eb\u306b\u3064\u304d\u307e\u3059\u3002\u30dd\u30a4\u30f3\u30c8\u306f\u30d5\u30a9\u30fc\u30de\u3092 JSON \u306b\u3057\u3066\u304a\u304f\u3053\u3068\u3067\u3059\u3002\u3053\u308c\u3067\u3001\u6b63\u898f\u8868\u73fe\u3092\u30b4\u30ea\u30b4\u30ea\u66f8\u304b\u306a\u304f\u3066\u3059\u307f\u307e\u3059\u3002\u96a3\u306e\u5e2d\u306e CTO \u304c\u3001\u6b63\u898f\u8868\u73fe\u306b\u3059\u3054\u304f\u6642\u9593\u304c\u304b\u304b\u3063\u305f\u3068\u304a\u3063\u3057\u3083\u3063\u3066\u3044\u307e\u3057\u305f\u306e\u3067\u3001\u3053\u308c\u3092\u907f\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u3066\u3088\u304b\u3063\u305f\u3067\u3059\u3002  \uff08\u3069\u3046\u3082\u5358\u7d14\u306a\u6b63\u898f\u8868\u73fe\u3067\u306f\u306a\u304f\u3001\u7656\u304c\u3042\u308a\u3001\\\\d \u306a\u3069\u3068\u66f8\u304b\u306a\u304f\u3066\u306f\u3044\u3051\u306a\u3044\u3088\u3046\u3067\u3059\u3002\uff09\n\n\u5e74\u30fb\u6708\u30fb\u65e5\u3067\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u5207\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u53cd\u6620\u3055\u305b\u307e\u3059\u3002\uff08\u3061\u3087\u3063\u3068\u3053\u3053\u52c9\u5f37\u4e0d\u8db3\u3067\u8a73\u7d30\u308f\u304b\u3063\u3066\u3044\u307e\u305b\u3093\u3002\uff09\nMSCK REPAIR TABLE database_name.table_name;\n\n# \u78ba\u8a8d\nshow partitions database_name.table_name;\n\n\n\u3042\u3068\u306f\u30af\u30a8\u30ea\u3092\u53e9\u304f\u3060\u3051\u3067\u3059\n\u4e00\u756a\u6700\u521d\u306e\u30ad\u30e3\u30d7\u30c1\u30e3\u306e\u901a\u308a\u3067\u3059\u3002select * from table_name; \u3053\u308c\u3067\u3001\u307f\u305f\u3044\u30c7\u30fc\u30bf\u304c\u3068\u308c\u307e\u3059\u3002\n\n\u4ee5\u4e0a\u3067\u3059\u3002\n\u9014\u4e2d\u3067\u3001\u3044\u308d\u3044\u308d\u30cf\u30de\u308a\u307e\u3057\u305f\u304c\u3001\u7121\u4e8b\u306b\u3084\u308a\u305f\u3044\u3068\u3053\u308d\u307e\u3067\u3067\u304d\u3066\u3088\u304b\u3063\u305f\u3067\u3059\u3002\u4eca\u65e5\u306f\u3082\u3046\u30b5\u30a6\u30ca\u306b\u5165\u3063\u3066\u4f53\u3092\u6574\u3048\u3066  \u3067\u3082\u98f2\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u660e\u65e5\u4ee5\u964d\u306f\u3001\u3053\u308c\u3089\u3092 itamae \u3068\u304b\u3067\u3001\u30ea\u30e2\u30fc\u30c8\u69cb\u7bc9\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002  \n\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f\u3002 \n# \u4eca\u3044\u307e\u3001\u3042\u308b\u3068\u3053\u308d\u306b\n\nRails \u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u304c\u3042\u308a\u307e\u3057\u305f\u3002 :older_man_tone2: :older_woman_tone1:\n\n\u305d\u3053\u3067\u306f\u3001[lograge](https://github.com/roidrage/lograge) \u3068\u3044\u3046 gem \u3092\u3044\u308c\u3066\u3001`/log/development.log` \u306b\u6b32\u3057\u3044\u30ed\u30b0\u60c5\u5831\u3092 JSON \u5f62\u5f0f\u3067\u9001\u308a\u3064\u3051\u3066\u3044\u307e\u3057\u305f\u3002\n\n```rb:/config/initializers/lograge.rb\nRails.application.configure do\n  config.lograge.enabled = true\n  config.lograge.formatter = Lograge::Formatters::Json.new\n  config.lograge.custom_options = lambda do |event|\n    {\n      user_id: event.payload[:user_id],\n      user_email: event.payload[:user_email],\n    }\n  end\nend\n```\n\n```zsh:/log/development.log\n# ...\u30a4\u30e1\u30fc\u30b8\n{\"method\":\"GET\",\"path\":\"/dashboard/events\",\"format\":\"json\",\"controller\":\"DashboardController\",\"action\":\"events\",\"status\":200,\"duration\":68.21,\"view\":0.44,\"db\":0.0,\"user_id\":\"9999\",\"user_email\":\"mochizuki@hoge.com\"}\n```\n\n**\u3053\u3053\u306b td-agent \u3092\u5165\u308c\u3066\u3001\u30ed\u30b0\u3092 S3 \u306b\u9001\u308a\u3001Amazon Athena \u304b\u3089 SQL \u30e9\u30a4\u30af\u306b\u30ed\u30b0\u3092\u62bd\u51fa\u3059\u308b\u3068\u3044\u3046\u3053\u3068\u3092\u3084\u308a\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002**\n\n# \u6700\u7d42\u7684\u306a\u30a4\u30e1\u30fc\u30b8\n\n:military_medal:\n\n![td.png](https://qiita-image-store.s3.amazonaws.com/0/45822/769055a2-4692-1ca1-1b0a-9e702f86ab54.png)\n\n\n# \u307e\u305a td-agent (Fluentd) \u3092\u5165\u308c\u308b\u3068\u3053\u308d\u304b\u3089\n\n\n[Installing Fluentd using .dmg Installer (MacOS X)](http://docs.fluentd.org/v0.12/articles/install-by-dmg) \u3053\u3053\u306b\u66f8\u3044\u3066\u3042\u308b\u3068\u304a\u308a\u306b\u3001Download \u3057\u3066\u3001td-agent \u3092\u5165\u308c\u307e\u3059\u3002\u3053\u308c\u306f\u3059\u3050\u306b\u30b9\u30eb\u3063\u3068\u5165\u308b\u3068\u601d\u3044\u307e\u3059\u3002 :no_mouth:\n\n\u3064\u304e\u306b\u3001`fluent-plugin-s3` \u3068\u3044\u3046\u3082\u306e\u3092\u5165\u308c\u305f\u3044\u306e\u3067\u3059\u304c\u3001\u3053\u308c\u304c\u96e3\u3057\u304b\u3063\u305f\u3067\u3059\u3002\n\n```zsh:\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n/opt/td-agent/usr/sbin/td-agent-gem install fluent-plugin-s3\n```\n\n\u7d50\u8ad6\u3001\u4e0a\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3044\u3051\u308b\u306e\u3067\u3059\u304c\u3001...\u3068\u306b\u304b\u304f\u884c\u3051\u307e\u3059\u3002\n\nref. http://docs.fluentd.org/v0.12/articles/faq#i-installed-td-agent-and-want-to-add-custom-plugins-how-do-i-do-it\n\n\uff08\u81ea\u5206\u7528\u306e\u30e1\u30e2\u3002\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u304b\u3089 `/opt/td-agent/usr/sbin/td-agent` \u306e\u5834\u6240\u3092\u78ba\u8a8d\u3002\uff09\n\n```zsh:/Library/LaunchDaemons/td-agent.plist\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n<plist version=\"1.0\">\n<dict>\n  <key>KeepAlive</key>\n  <true/>\n  <key>Label</key>\n  <string>td-agent</string>\n  <key>ProgramArguments</key>\n  <array>\n    <string>/opt/td-agent/usr/sbin/td-agent</string>\n    <string>--log</string>\n    <string>/var/log/td-agent/td-agent.log</string>\n    <string>--use-v1-config</string>\n  </array>\n  <key>RunAtLoad</key>\n  <true/>\n  <key>WorkingDirectory</key>\n  <string>/opt/td-agent</string>\n</dict>\n</plist>\n```\n\n# \u3064\u3065\u3044\u3066\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304d\u307e\u3059\u3002\n\n\u3044\u308d\u3044\u308d\u5b66\u3073\u306a\u304c\u3089\uff08\u30cf\u30de\u308a\u306a\u304c\u3089\uff09\u3001\u5b8c\u6210\u3057\u305f\u306e\u304c\u4e0b\u3067\u3059\u3002\uff08\u4e00\u5fdc\u3053\u308c\u3067\u3001\u3084\u308a\u305f\u3044\u3053\u3068\u306f\u3067\u304d\u307e\u3057\u305f\u3002\uff09\n\n```zsh:/etc/td-agent/td-agent.conf\n<source>\n  type forward\n</source>\n\n<source>\n  type     tail\n  tag      lograge\n  format   json\n  path     {project-path}/log/development.log\n  pos_file {project-path}/log/development.log.pos\n  time_key time\n</source>\n\n<match lograge>\n  @type copy\n  <store>\n    @type stdout\n  </store>\n  <store>\n    @type s3\n    format json\n    aws_key_id {aws_access_key_id}\n    aws_sec_key {aws_secret_access_key}\n    s3_bucket {my_bucket_name}\n    s3_region ap-northeast-1\n    path lograge_logs/ # \u4efb\u610f\u306b\u6307\u5b9a\u3067\u304d\u307e\u3059\n    buffer_path /var/log/fluent/lograge_s3 # \u4efb\u610f\u306b\u6307\u5b9a\u3067\u304d\u307e\u3059\n    buffer_chunk_limit 100k\n    time_slice_format year=%Y/month=%m/day=%d/%Y%m%d-%H\n    utc\n  </store>\n</match>\n```\n\n### \u30dd\u30a4\u30f3\u30c8\u8aac\u660e\n\n- `@type stdout` \u3067\u3001`/var/log/td-agent/td-agent.log` \u306b\u30ed\u30b0\u304c\u6d41\u308c\u3066\u304f\u308b\u306e\u3067\u3001\u3053\u308c\u3092 `tail -f` \u3057\u306a\u304c\u3089\u4f5c\u696d\u3092\u9032\u3081\u307e\u3057\u305f\u3002\n- `format json` \u3067 JSON\u5f62\u5f0f\u3067\uff08\u4f59\u8a08\u306a\u65e5\u6642\u30c7\u30fc\u30bf\u306a\u3069\u3092\u542b\u307e\u306a\u3044\u5f62\u3067\uff09\u5410\u304d\u51fa\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n- `@type copy` \u3067\u8907\u6570\u306e\u30a2\u30a6\u30c8\u30d7\u30c3\u30c8\u3092\u3057\u3066\u304f\u308c\u307e\u3059\u3002\uff08 stdout \u3068 s3 \u3078\u306e\u5410\u304d\u51fa\u3057\uff09\n\n`@type copy` \u306e\u5b58\u5728\u306b\u51fa\u4f1a\u3046\u307e\u3067\u3001\u307c\u304f\u306f**\u4e00\u5411\u306b\u73fe\u308c\u306a\u3044\u30ed\u30b0\u3092\u6c38\u9060\u3068** \u5f85\u3061\u7d9a\u3051\u3066\u3044\u307e\u3057\u305f\u3002 :angel_tone3:\n\n\n```zsh:(\u3053\u3093\u306a\u98a8\u306b\u66f8\u3044\u3066\u3044\u305f\u308f\u3051\u3067\u3059\u3002\uff09\n<match lograge>\n  @type stdout\n</match lograge>\n<match lograge>\n  @type s3\n  \u7701\u7565\n</match>\n```\n\n# td-agent \u3092\u52d5\u304b\u3057\u3066\u304a\u304f\n\n```zsh:\u52d5\u304b\u3059\nsudo launchctl load /Library/LaunchDaemons/td-agent.plist\n```\n\n```zsh:\u6b62\u3081\u308b\nsudo launchctl unload /Library/LaunchDaemons/td-agent.plist\n```\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb `td-agent.conf` \u3092\u3044\u3058\u3063\u305f\u3089\u3001\u4e0a\u306e\u30b3\u30de\u30f3\u30c9\u3067 \"\u6b62\u3081\u3066\" \u30fb \"\u52d5\u304b\u3057\u3066\" \u53cd\u6620\u3055\u305b\u307e\u3059\u3002reload \u307f\u305f\u3044\u306a\u30b3\u30de\u30f3\u30c9\u306a\u3044\u306e\u304b\u306a\u3041\u3068\u304a\u3082\u3044\u3064\u3064\u3001`&&` \u3067\u3064\u306a\u3052\u3066\u304a\u624b\u88fd\u30ea\u30ed\u30fc\u30c9\u30b3\u30de\u30f3\u30c9\u3092\u4f55\u5ea6\u3082\u53e9\u304d\u307e\u3057\u305f\u3002\n\n\u4ee5\u4e0a\u3067\u3001`/log/development.log` \u306e JSON \u5f62\u5f0f\u306e\u30ed\u30b0\u304c\u3001`S3://lograge` \u306b\u30a2\u30c3\u30d7\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002 :smiley: \n\n```zsh:awscli\u3067\u306e\u78ba\u8a8d\n$ aws s3 ls --recursive  s3://my-bucket-name\n2017-02-02 17:10:27        270 lograge_logs/year=2017/month=02/day=02/20170202-07_0.gz\n2017-02-02 18:10:58       2580 lograge_logs/year=2017/month=02/day=02/20170202-08_0.gz\n2017-02-02 19:10:31        757 lograge_logs/year=2017/month=02/day=02/20170202-09_0.gz\n```\n\n# Amazon Athena \u306e\u8a2d\u5b9a\u3092\u3059\u308b\n\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-02-02 19.36.11.png](https://qiita-image-store.s3.amazonaws.com/0/45822/7a719c47-8410-ca7e-621b-04a2ce6dc112.png)\n\n\u30af\u30a8\u30ea\u304c\u304b\u3051\u308b\u306e\u3067\u3001`create database hoge` \u306a\u3069\u3067\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u3064\u304f\u308a\u307e\u3059\u3002\n\n\u305d\u3057\u3066\u3001\u30c6\u30fc\u30d6\u30eb\u3082\u30af\u30a8\u30ea\u3067\u3064\u304f\u308c\u308b\u306e\u3067\u3059\u304c\u3001\u305d\u308c\u306f\u5927\u5909\u305d\u3046\u306a\u306e\u3067\u3001`Catalog Manager` \u30e1\u30cb\u30e5\u30fc\u304b\u3089\u3064\u304f\u308a\u307e\u3059\u3002\n\n\u9053\u306a\u308a\u306b\u3059\u3059\u3081\u3070\u3001\u30b4\u30fc\u30eb\u306b\u3064\u304d\u307e\u3059\u3002\u30dd\u30a4\u30f3\u30c8\u306f\u30d5\u30a9\u30fc\u30de\u3092 JSON \u306b\u3057\u3066\u304a\u304f\u3053\u3068\u3067\u3059\u3002\u3053\u308c\u3067\u3001\u6b63\u898f\u8868\u73fe\u3092\u30b4\u30ea\u30b4\u30ea\u66f8\u304b\u306a\u304f\u3066\u3059\u307f\u307e\u3059\u3002\u96a3\u306e\u5e2d\u306e CTO \u304c\u3001\u6b63\u898f\u8868\u73fe\u306b\u3059\u3054\u304f\u6642\u9593\u304c\u304b\u304b\u3063\u305f\u3068\u304a\u3063\u3057\u3083\u3063\u3066\u3044\u307e\u3057\u305f\u306e\u3067\u3001\u3053\u308c\u3092\u907f\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u3066\u3088\u304b\u3063\u305f\u3067\u3059\u3002 :rolling_eyes: \uff08\u3069\u3046\u3082\u5358\u7d14\u306a\u6b63\u898f\u8868\u73fe\u3067\u306f\u306a\u304f\u3001\u7656\u304c\u3042\u308a\u3001`\\\\d` \u306a\u3069\u3068\u66f8\u304b\u306a\u304f\u3066\u306f\u3044\u3051\u306a\u3044\u3088\u3046\u3067\u3059\u3002\uff09\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-02-02 19.38.08.png](https://qiita-image-store.s3.amazonaws.com/0/45822/74c0e74c-6ae6-d42e-d6d7-79ec40266d20.png)\n\n\n\u5e74\u30fb\u6708\u30fb\u65e5\u3067\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u5207\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u53cd\u6620\u3055\u305b\u307e\u3059\u3002\uff08\u3061\u3087\u3063\u3068\u3053\u3053\u52c9\u5f37\u4e0d\u8db3\u3067\u8a73\u7d30\u308f\u304b\u3063\u3066\u3044\u307e\u305b\u3093\u3002\uff09\n\n```mysql\nMSCK REPAIR TABLE database_name.table_name;\n\n# \u78ba\u8a8d\nshow partitions database_name.table_name;\n```\n\n# \u3042\u3068\u306f\u30af\u30a8\u30ea\u3092\u53e9\u304f\u3060\u3051\u3067\u3059\n\n\u4e00\u756a\u6700\u521d\u306e\u30ad\u30e3\u30d7\u30c1\u30e3\u306e\u901a\u308a\u3067\u3059\u3002`select * from table_name;` \u3053\u308c\u3067\u3001\u307f\u305f\u3044\u30c7\u30fc\u30bf\u304c\u3068\u308c\u307e\u3059\u3002\n\n\n:dango:\n\n\n\u4ee5\u4e0a\u3067\u3059\u3002\n\n\u9014\u4e2d\u3067\u3001\u3044\u308d\u3044\u308d\u30cf\u30de\u308a\u307e\u3057\u305f\u304c\u3001\u7121\u4e8b\u306b\u3084\u308a\u305f\u3044\u3068\u3053\u308d\u307e\u3067\u3067\u304d\u3066\u3088\u304b\u3063\u305f\u3067\u3059\u3002\u4eca\u65e5\u306f\u3082\u3046\u30b5\u30a6\u30ca\u306b\u5165\u3063\u3066\u4f53\u3092\u6574\u3048\u3066 :beer: \u3067\u3082\u98f2\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u660e\u65e5\u4ee5\u964d\u306f\u3001\u3053\u308c\u3089\u3092 itamae \u3068\u304b\u3067\u3001\u30ea\u30e2\u30fc\u30c8\u69cb\u7bc9\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002 :walking_tone1: \n\n\n\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f\u3002 :pray:\n"}