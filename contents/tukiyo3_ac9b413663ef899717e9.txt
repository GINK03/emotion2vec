{"context": "(\u30d7\u30ed\u30b0\u30e9\u30e0\u5074\u3067\u5165\u529b\u5024\u30c1\u30a7\u30c3\u30af\u3084\u30a8\u30b9\u30b1\u30fc\u30d7\u3057\u3066\u3044\u308b\u3082\u306e\u3068\u3059\u308b)\nQUERY_STRING\u306b\u4e0d\u6b63\u306a\u6587\u5b57\u304c\u6765\u305f\u3089\u30b5\u30fc\u30d0\u30fc\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u4f7f\u308f\u305b\u308b\u306e\u306f\u3082\u3063\u305f\u3044\u306a\u3044\u305f\u3081\n\u5373\u5ea7\u306b\u7d42\u4e86\u3055\u305b\u308b\u3002(\u6bce\u5206\u5ef6\u3005\u3068\u30a2\u30af\u30bb\u30b9\u6765\u305f\u308a\u3059\u308b\u305f\u3081)\n\u6d77\u5916\u306e\u30b5\u30fc\u30d0\u30fc50\u53f0\u304b\u3089\u30a2\u30af\u30bb\u30b9\u6765\u3066\u305f\u3002\n\n\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u30d6\u30ed\u30c3\u30af\u3057\u305f\u3044\u6587\u5b57\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\n// (, by ,' \u304c\u6765\u305f\u3089die()\nif(preg_match('/(\\(|%28|%20[Bb][Yy]%20|\\'|%27)/',$_SERVER['QUERY_STRING'])){\n    header(\"HTTP/1.0 404 Access denied.\");\n    die(\"your access has been blocked.\");\n}\n\n\n\n%20 : \u534a\u89d2\u30b9\u30da\u30fc\u30b9\n%28 : (\n\n%27 : '\n\n\n\n\u4e0d\u6b63\u30a2\u30af\u30bb\u30b9\u4f8b\n\n\u4e0d\u6b63\u30a2\u30af\u30bb\u30b9\u4f8b\n?hoge=fuga'\n?hoge=fuga' AND BENCHMARK(2999999,MD5(NOW())) GrOup BY 20&\n?hoge=fuga' And sLEEp(3)) #&\n?hoge=fuga%27%20UNION%20SELECT%20CHAR(45,120,49,45,81,45),CHAR(45,120,50,45,81,45),CHAR(45,120,51,45,81,45),CHAR(45,120,52,45,81,45),CHAR(45,120,53,45,81,45),CHAR(45,120,54,45,81,45),CHAR(45,120,55,45,81,45),CHAR(45,120,56,45,81,45),CHAR(45,120,57,45,81,45),CHAR(45,120,49,48,45,81,45),CHAR(45,120,49,49,45,81,45),CHAR(45,120,49,50,45,81,45),CHAR(45,120,49,51,45,81,45),CHAR(45,120,49,52,45,81,45),CHAR(45,120,49,53,45,81,45),CHAR(45,120,49,54,45,81,45),CHAR(45,120,49,55,45,81,45),CHAR(45,120,49,56,45,81,45),CHAR(45,120,49,57,45,81,45),CHAR(45,120,50,48,45,81,45),CHAR(45,120,50,49,45,81,45),CHAR(45,120,50,50,45,81,45),CHAR(45,120,50,51,45,81,45),CHAR(45,120,50,52,45,81,45),CHAR(45,120,50,53,45,81,45)%20--%20/*%20order%20by%20%27as%20/*\n?hoge=fuga%22%20or%20(1,2)=(select*from(select%20name_const(CHAR(111,108,111,108,111,115,104,101,114),1),name_const(CHAR(111,108,111,108,111,115,104,101,114),1))a)%20--%20%22x%22=%22x\n\n\n\n\u3053\u308c\u3089\u306e\u5171\u901a\u70b9\u306f\u30ab\u30c3\u30b3\u304c\u3042\u308b\u3053\u3068\u3060\u3068\u308f\u304b\u3063\u305f\u3002(\u3068%28\u3092\u30d6\u30ed\u30c3\u30af\u3002\n\u307e\u305fIPA\u306epdf\u306b\u3088\u308b\u3068\u30b7\u30f3\u30b0\u30eb\u30af\u30a9\u30fc\u30c8\u306e\u4f8b\u3084\u3001\u30cd\u30c3\u30c8\u306e\u60c5\u5831\u3067\u306forder by\u306a\u3069\u306e\u4f8b\u3092\u767a\u898b\u3002\n\n\u6700\u65b0\u7248\u306ePDF71page\n\n\u5b89\u5168\u306a\u30a6\u30a7\u30d6\u30b5\u30a4\u30c8\u306e\u4f5c\u308a\u65b9\uff1aIPA \u72ec\u7acb\u884c\u653f\u6cd5\u4eba \u60c5\u5831\u51e6\u7406\u63a8\u9032\u6a5f\u69cb\n\n\n\nWe Analyze Web Hosting. IP\u30a2\u30c9\u30ec\u30b9\u304b\u3089\u5730\u57df\u3092\u7279\u5b9a\n\n\n\u30a2\u30af\u30bb\u30b9\u6570\u591a\u3044\u9806\u306bIP\u8868\u793a\n\nWEB\u30b5\u30fc\u30d0\u306e\u30ed\u30b0\u304b\u3089\u30a2\u30af\u30bb\u30b9\u6570\u9806\u306bIP\u30a2\u30c9\u30ec\u30b9\u3092\u629c\u304d\u51fa\u3059\u30ef\u30f3\u30e9\u30a4\u30ca\u30fc - Qiita\n\ncat /var/log/httpd/access_log | awk -F \" \" '{print $1}' | sort | uniq -c | sort -n -r | head\n\n\n\u30d6\u30e9\u30c3\u30af\u30ea\u30b9\u30c8\u5316\n\nblacklist.php\n<?php\n$ip_blacklist = array(\n    // 2016-09-22 (Thu) SQL injection access.\n    '89.146.221.7',\n    '134.213.119.7',\n    '23.91.70.7',\n    //\n);\n\nif(in_array($_SERVER['REMOTE_ADDR'], $ip_blacklist)) {\n    die(\"blacklisted.\");\n}\nunset($ip_blacklist);\n?>\n\n\n(\u30d7\u30ed\u30b0\u30e9\u30e0\u5074\u3067\u5165\u529b\u5024\u30c1\u30a7\u30c3\u30af\u3084\u30a8\u30b9\u30b1\u30fc\u30d7\u3057\u3066\u3044\u308b\u3082\u306e\u3068\u3059\u308b)\n\n`QUERY_STRING`\u306b\u4e0d\u6b63\u306a\u6587\u5b57\u304c\u6765\u305f\u3089\u30b5\u30fc\u30d0\u30fc\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u4f7f\u308f\u305b\u308b\u306e\u306f\u3082\u3063\u305f\u3044\u306a\u3044\u305f\u3081\n\u5373\u5ea7\u306b\u7d42\u4e86\u3055\u305b\u308b\u3002(\u6bce\u5206\u5ef6\u3005\u3068\u30a2\u30af\u30bb\u30b9\u6765\u305f\u308a\u3059\u308b\u305f\u3081)\n\u6d77\u5916\u306e\u30b5\u30fc\u30d0\u30fc50\u53f0\u304b\u3089\u30a2\u30af\u30bb\u30b9\u6765\u3066\u305f\u3002\n\n```php:\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u30d6\u30ed\u30c3\u30af\u3057\u305f\u3044\u6587\u5b57\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\n// (, by ,' \u304c\u6765\u305f\u3089die()\nif(preg_match('/(\\(|%28|%20[Bb][Yy]%20|\\'|%27)/',$_SERVER['QUERY_STRING'])){\n    header(\"HTTP/1.0 404 Access denied.\");\n    die(\"your access has been blocked.\");\n}\n```\n\n* %20 : \u534a\u89d2\u30b9\u30da\u30fc\u30b9\n* %28 : `(`\n* %27 : `'`\n\n## \u4e0d\u6b63\u30a2\u30af\u30bb\u30b9\u4f8b\n\n```html:\u4e0d\u6b63\u30a2\u30af\u30bb\u30b9\u4f8b\n?hoge=fuga'\n?hoge=fuga' AND BENCHMARK(2999999,MD5(NOW())) GrOup BY 20&\n?hoge=fuga' And sLEEp(3)) #&\n?hoge=fuga%27%20UNION%20SELECT%20CHAR(45,120,49,45,81,45),CHAR(45,120,50,45,81,45),CHAR(45,120,51,45,81,45),CHAR(45,120,52,45,81,45),CHAR(45,120,53,45,81,45),CHAR(45,120,54,45,81,45),CHAR(45,120,55,45,81,45),CHAR(45,120,56,45,81,45),CHAR(45,120,57,45,81,45),CHAR(45,120,49,48,45,81,45),CHAR(45,120,49,49,45,81,45),CHAR(45,120,49,50,45,81,45),CHAR(45,120,49,51,45,81,45),CHAR(45,120,49,52,45,81,45),CHAR(45,120,49,53,45,81,45),CHAR(45,120,49,54,45,81,45),CHAR(45,120,49,55,45,81,45),CHAR(45,120,49,56,45,81,45),CHAR(45,120,49,57,45,81,45),CHAR(45,120,50,48,45,81,45),CHAR(45,120,50,49,45,81,45),CHAR(45,120,50,50,45,81,45),CHAR(45,120,50,51,45,81,45),CHAR(45,120,50,52,45,81,45),CHAR(45,120,50,53,45,81,45)%20--%20/*%20order%20by%20%27as%20/*\n?hoge=fuga%22%20or%20(1,2)=(select*from(select%20name_const(CHAR(111,108,111,108,111,115,104,101,114),1),name_const(CHAR(111,108,111,108,111,115,104,101,114),1))a)%20--%20%22x%22=%22x\n```\n\n* \u3053\u308c\u3089\u306e\u5171\u901a\u70b9\u306f`\u30ab\u30c3\u30b3`\u304c\u3042\u308b\u3053\u3068\u3060\u3068\u308f\u304b\u3063\u305f\u3002`(`\u3068`%28`\u3092\u30d6\u30ed\u30c3\u30af\u3002\n* \u307e\u305f[IPA\u306epdf](https://www.ipa.go.jp/files/000024396.pdf)\u306b\u3088\u308b\u3068`\u30b7\u30f3\u30b0\u30eb\u30af\u30a9\u30fc\u30c8`\u306e\u4f8b\u3084\u3001\u30cd\u30c3\u30c8\u306e\u60c5\u5831\u3067\u306f`order by`\u306a\u3069\u306e\u4f8b\u3092\u767a\u898b\u3002\n* [\u6700\u65b0\u7248\u306ePDF71page](https://www.ipa.go.jp/files/000017316.pdf)\n    * [\u5b89\u5168\u306a\u30a6\u30a7\u30d6\u30b5\u30a4\u30c8\u306e\u4f5c\u308a\u65b9\uff1aIPA \u72ec\u7acb\u884c\u653f\u6cd5\u4eba \u60c5\u5831\u51e6\u7406\u63a8\u9032\u6a5f\u69cb](https://www.ipa.go.jp/security/vuln/websecurity.html)\n* [We Analyze Web Hosting.](http://hostingcompass.com/) IP\u30a2\u30c9\u30ec\u30b9\u304b\u3089\u5730\u57df\u3092\u7279\u5b9a\n\n\n## \u30a2\u30af\u30bb\u30b9\u6570\u591a\u3044\u9806\u306bIP\u8868\u793a\n\n* [WEB\u30b5\u30fc\u30d0\u306e\u30ed\u30b0\u304b\u3089\u30a2\u30af\u30bb\u30b9\u6570\u9806\u306bIP\u30a2\u30c9\u30ec\u30b9\u3092\u629c\u304d\u51fa\u3059\u30ef\u30f3\u30e9\u30a4\u30ca\u30fc - Qiita](http://qiita.com/hash/items/53e11f625919c8430583)\n\n```\ncat /var/log/httpd/access_log | awk -F \" \" '{print $1}' | sort | uniq -c | sort -n -r | head\n```\n\n## \u30d6\u30e9\u30c3\u30af\u30ea\u30b9\u30c8\u5316\n\n```php:blacklist.php \n<?php\n$ip_blacklist = array(\n\t// 2016-09-22 (Thu) SQL injection access.\n\t'89.146.221.7',\n\t'134.213.119.7',\n\t'23.91.70.7',\n\t//\n);\n\nif(in_array($_SERVER['REMOTE_ADDR'], $ip_blacklist)) {\n\tdie(\"blacklisted.\");\n}\nunset($ip_blacklist);\n?>\n```\n", "tags": ["Security", "PHP"]}