{"tags": ["IoT", "HBase", "OpenTSDB"], "context": "\u4eca\u56de\u3001\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u201dOpenTSDB\u201d\u306e\u57fa\u672c\u52d5\u4f5c\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nOpenTSDB\u306b\u3064\u3044\u3066\u306f\u3001\u3053\u3061\u3089\u306eSlideShare\u300cHBaseCon 2015: OpenTSDB and AsyncHBase Update\u300d\u304c\u53c2\u8003\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u306a\u304a\u3001OpenTSDB\u3067\u6271\u3046\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u306f\u3001Apache HBase/hadoop\u30af\u30e9\u30b9\u30bf\u69cb\u6210\u4e0a\u306b\u3001\u4fdd\u7ba1\u3055\u308c\u307e\u3059\u3002\n\u4eca\u56de\u306f\u3001OpenTSDB\u57fa\u672c\u52d5\u4f5c\u3092\u8a66\u3059\u76ee\u7684\u306a\u306e\u3067\u3001\u30af\u30e9\u30b9\u30bf\u69cb\u6210\u306f\u884c\u3063\u3066\u304a\u308a\u307e\u305b\u3093\u3002\n\n\u2b1b\ufe0e OpenTSDB\u74b0\u5883\u69cb\u7bc9\n\u5b9f\u969b\u306e\u69cb\u7bc9\u306b\u3042\u305f\u3063\u3066\u3001\u3053\u3061\u3089\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\nhttp://opentsdb.net/docs/build/html/installation.html#id1\n\n(1) Linux\u74b0\u5883\u6e96\u5099\n\nUbunts\u74b0\u5883\u6574\u5099\u3059\u308b\n\n$ cat /etc/lsb-release \nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=14.04\nDISTRIB_CODENAME=trusty\nDISTRIB_DESCRIPTION=\"Ubuntu 14.04.3 LTS\"\n\n$ sudo apt-get update\n$ sudo apt-get install git\n$ sudo apt-get install autoconf\n$ sudo apt-get install make\n\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u78ba\u8a8d\u3059\u308b\n\n$ ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default \n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 00:0c:29:47:78:62 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.195.164/24 brd 192.168.195.255 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::20c:29ff:fe47:7862/64 scope link \n       valid_lft forever preferred_lft forever\n\n\nJDK\u74b0\u5883\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001JAVA_HOME\u74b0\u5883\u5909\u6570\u306b\u30bb\u30c3\u30c8\u3059\u308b\n\n$ sudo apt-get install default-jdk\n$ sudo update-alternatives --list java\n/usr/lib/jvm/java-7-openjdk-amd64/jre/bin/java\n\n$ cd $HOME\n$ vi .profile\nexport JAVA_HOME=/usr/lib/jvm/java-7-openjdk-amd64\n\n\nOpenTSDB\u7528log\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u304a\u304f\n\n$ cd /var/log/\n$ sudo mkdir opentsdb\n$ sudo chmod 777 opentsdb\n\n\n(2) Apache ZooKeeper\u74b0\u5883\u69cb\u7bc9\n\nZooKeeper\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\n\n$ cd $HOME\n$ wget http://www-eu.apache.org/dist/zookeeper/zookeeper-3.4.6/zookeeper-3.4.6.tar.gz\n$ sudo tar -C /opt -xzf zookeeper-3.4.6.tar.gz\n$ cd /opt/zookeeper-3.4.6/conf\n$ cp zoo_sample.cfg zoo.cfg\n\n\nZooKeeper\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3059\u308b\n\n$ vi zoo.cfg\n... (snip)\n\n## the zookeeper server quorum\nserver.0=192.168.195.164:2888:3888\n\n\nZooKeep\u30b3\u30de\u30f3\u30c9\u306e\u30d1\u30b9\u3092\u3001\u30ed\u30b0\u30a4\u30f3\u74b0\u5883\u8a2d\u5b9a\u306b\u8ffd\u52a0\u3059\u308b\n\n$ cd $HOME\n$ vi .profile\nexport PATH=/opt/zookeeper-3.4.6/bin:$PATH\n\n$ source .profile\n\n\nZooKeeper\u3092\u8d77\u52d5\u3059\u308b\n\n$ zkServer.sh start\nJMX enabled by default\nUsing config: /opt/zookeeper-3.4.6/bin/../conf/zoo.cfg\nStarting zookeeper ... STARTED\n\n\n(3) Apache HBase\u74b0\u5883\u69cb\u7bc9\n\nHBase\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\n\n$ wget http://www.apache.org/dist/hbase/hbase-0.94.27/hbase-0.94.27.tar.gz\n$ tar xfz hbase-0.94.27.tar.gz\n$ cd hbase-0.94.27/\n\n\nHBase\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3059\u308b\n\n$ vi conf/hbase-site.xml\n<?xml version=\"1.0\"?>\n<?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?>\n<configuration>\n  <property>\n    <name>hbase.rootdir</name>\n    <value>file:///tmp/hbase-${user.name}/hbase</value>\n  </property>\n  <property>\n    <name>hbase.zookeeper.property.dataDir</name>\n    <value>/tmp/zookeeper</value>\n  </property>\n  <property>\n    <name>hbase.zookeeper.quorum</name>\n    <value>192.168.195.164</value>\n  </property>\n  <property>\n    <name>hbase.zookeeper.property.clientPort</name>\n    <value>2182</value>\n  </property>\n</configuration>\n\n\n$ vi conf/hbase-env.sh\nexport JAVA_HOME=/usr/lib/jvm/java-7-openjdk-amd64\n\n\nHBase\u3092\u8d77\u52d5\u3059\u308b\n\n$ ./bin/start-hbase.sh\nstarting master, logging to /home/tsubo/hbase-0.94.27/bin/../logs/hbase-tsubo-master-OpenTSDB.out\n\n\nHBase\u306e\u30de\u30b9\u30bf\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\nWeb\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u3001http://192.168.195.164:60010 \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3001HBase\u306e\u30de\u30b9\u30bf\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\n\nHBase Shell\u3092\u8d77\u52d5\u3057\u3066\u3001HBase\u4e0a\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304f\n\n$ ./bin/hbase shell\nHBase Shell; enter 'help<RETURN>' for list of supported commands.\nType \"exit<RETURN>\" to leave the HBase Shell\nVersion 0.94.27, rfb434617716493eac82b55180b0bbd653beb90bf, Thu Mar 19 06:17:55 UTC 2015\n\nhbase(main):001:0> list\nTABLE                                                                              \n0 row(s) in 0.6220 seconds\n\n\n(4) OpenTSDB\u74b0\u5883\u69cb\u7bc9\n\nOpenTSDB\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\n\n$ cd $HOME\n$ git clone git://github.com/OpenTSDB/opentsdb.git\n\n\n\u30d3\u30eb\u30c9\u3059\u308b\n\n$ cd opentsdb/\n$ ./build.sh\n\n\nOpenTSDB\u7528\u30c6\u30fc\u30d6\u30eb\u3092\u69cb\u7bc9\u3059\u308b\n\n$ env COMPRESSION=NONE HBASE_HOME=$HOME/hbase-0.94.27 ./src/create_table.sh\nHBase Shell; enter 'help<RETURN>' for list of supported commands.\nType \"exit<RETURN>\" to leave the HBase Shell\nVersion 0.94.27, rfb434617716493eac82b55180b0bbd653beb90bf, Thu Mar 19 06:17:55 UTC 2015\n\ncreate 'tsdb-uid',\n  {NAME => 'id', COMPRESSION => 'NONE', BLOOMFILTER => 'ROW'},\n  {NAME => 'name', COMPRESSION => 'NONE', BLOOMFILTER => 'ROW'}\n0 row(s) in 1.9140 seconds\n\n\ncreate 'tsdb',\n  {NAME => 't', VERSIONS => 1, COMPRESSION => 'NONE', BLOOMFILTER => 'ROW'}\n0 row(s) in 1.0620 seconds\n\n\ncreate 'tsdb-tree',\n  {NAME => 't', VERSIONS => 1, COMPRESSION => 'NONE', BLOOMFILTER => 'ROW'}\n0 row(s) in 1.0630 seconds\n\n\ncreate 'tsdb-meta',\n  {NAME => 'name', COMPRESSION => 'NONE', BLOOMFILTER => 'ROW'}\n0 row(s) in 1.0480 seconds\n\n\nOpenTSDB\u3092\u8d77\u52d5\u3059\u308b\n\n$ tsdtmp=${TMPDIR-'/tmp'}/tsd\n$ ./build/tsdb tsd --port=4242 --staticroot=build/staticroot --cachedir=\"$tsdtmp\" --zkquorum=localhost:2182\n2016-03-06 17:06:45,219 INFO  [main] TSDMain: Starting.\n2016-03-06 17:06:45,222 INFO  [main] TSDMain: net.opentsdb.tools 2.2.0 built at revision e2efe9a (MINT)\n2016-03-06 17:06:45,223 INFO  [main] TSDMain: Built on 2016/03/05 04:52:57 +0000 by tsubo@OpenTSDB:/home/tsubo/opentsdb/build\n2016-03-06 17:06:45,226 INFO  [main] Config: Successfully loaded configuration file: opentsdb.conf\n2016-03-06 17:06:45,263 INFO  [main] Config: Successfully loaded configuration file: opentsdb.conf\n2016-03-06 17:06:45,334 WARN  [main] PluginLoader: Unable to locate any plugins of the type: net.opentsdb.query.filter.TagVFilter\n2016-03-06 17:06:45,354 INFO  [main] ZooKeeper: Client environment:zookeeper.version=3.4.5-1392090, built on 09/30/2012 17:52 GMT\n2016-03-06 17:06:45,354 INFO  [main] ZooKeeper: Client environment:host.name=OpenTSDB\n2016-03-06 17:06:45,354 INFO  [main] ZooKeeper: Client environment:java.version=1.7.0_95\n2016-03-06 17:06:45,355 INFO  [main] ZooKeeper: Client environment:java.vendor=Oracle Corporation\n2016-03-06 17:06:45,355 INFO  [main] ZooKeeper: Client environment:java.home=/usr/lib/jvm/java-7-openjdk-amd64/jre\n2016-03-06 17:06:45,355 INFO  [main] ZooKeeper: Client environment:java.class.path=/home/tsubo/opentsdb/build/third_party/hbase/asynchbase-1.7.1.jar:/home/tsubo/opentsdb/build/third_party/guava/guava-18.0.jar:/home/tsubo/opentsdb/build/third_party/slf4j/log4j-over-slf4j-1.7.7.jar:/home/tsubo/opentsdb/build/third_party/logback/logback-classic-1.0.13.jar:/home/tsubo/opentsdb/build/third_party/logback/logback-core-1.0.13.jar:/home/tsubo/opentsdb/build/third_party/jackson/jackson-annotations-2.4.3.jar:/home/tsubo/opentsdb/build/third_party/jackson/jackson-core-2.4.3.jar:/home/tsubo/opentsdb/build/third_party/jackson/jackson-databind-2.4.3.jar:/home/tsubo/opentsdb/build/third_party/netty/netty-3.9.4.Final.jar:/home/tsubo/opentsdb/build/third_party/protobuf/protobuf-java-2.5.0.jar:/home/tsubo/opentsdb/build/third_party/slf4j/slf4j-api-1.7.7.jar:/home/tsubo/opentsdb/build/third_party/suasync/async-1.4.0.jar:/home/tsubo/opentsdb/build/third_party/zookeeper/zookeeper-3.4.5.jar:/home/tsubo/opentsdb/build/third_party/apache/commons-math3-3.4.1.jar:/home/tsubo/opentsdb/build/tsdb-2.2.0.jar:/home/tsubo/opentsdb/build/../src\n2016-03-06 17:06:45,355 INFO  [main] ZooKeeper: Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib/x86_64-linux-gnu/jni:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/usr/lib/jni:/lib:/usr/lib\n2016-03-06 17:06:45,360 INFO  [main] ZooKeeper: Client environment:java.io.tmpdir=/tmp\n2016-03-06 17:06:45,360 INFO  [main] ZooKeeper: Client environment:java.compiler=<NA>\n2016-03-06 17:06:45,361 INFO  [main] ZooKeeper: Client environment:os.name=Linux\n2016-03-06 17:06:45,361 INFO  [main] ZooKeeper: Client environment:os.arch=amd64\n2016-03-06 17:06:45,361 INFO  [main] ZooKeeper: Client environment:os.version=3.19.0-25-generic\n2016-03-06 17:06:45,361 INFO  [main] ZooKeeper: Client environment:user.name=tsubo\n2016-03-06 17:06:45,362 INFO  [main] ZooKeeper: Client environment:user.home=/home/tsubo\n2016-03-06 17:06:45,362 INFO  [main] ZooKeeper: Client environment:user.dir=/home/tsubo/opentsdb\n2016-03-06 17:06:45,363 INFO  [main] ZooKeeper: Initiating client connection, connectString=localhost:2182 sessionTimeout=5000 watcher=org.hbase.async.HBaseClient$ZKClient@5773a483\n2016-03-06 17:06:45,381 INFO  [main] HBaseClient: Need to find the -ROOT- region\n2016-03-06 17:06:45,383 INFO  [main-SendThread(localhost:2182)] ClientCnxn: Opening socket connection to server localhost/0:0:0:0:0:0:0:1:2182. Will not attempt to authenticate using SASL (unknown error)\n2016-03-06 17:06:45,387 INFO  [main-SendThread(localhost:2182)] ClientCnxn: Socket connection established to localhost/0:0:0:0:0:0:0:1:2182, initiating session\n2016-03-06 17:06:45,395 INFO  [main-SendThread(localhost:2182)] ClientCnxn: Session establishment complete on server localhost/0:0:0:0:0:0:0:1:2182, sessionid = 0x1534a850315001c, negotiated timeout = 5000\n2016-03-06 17:06:45,413 INFO  [main-EventThread] HBaseClient: Connecting to -ROOT- region @ 127.0.1.1:47707\n2016-03-06 17:06:45,454 INFO  [main-EventThread] ZooKeeper: Session: 0x1534a850315001c closed\n2016-03-06 17:06:45,454 INFO  [main-EventThread] ClientCnxn: EventThread shut down\n2016-03-06 17:06:45,471 INFO  [AsyncHBase I/O Worker #1] HBaseClient: Added client for region RegionInfo(table=\".META.\", region_name=\".META.,,1\", stop_key=\"\"), which was added to the regions cache.  Now we know that RegionClient@1357170721(chan=[id: 0xaa9ff3b0, /127.0.0.1:59915 => /127.0.1.1:47707], #pending_rpcs=0, #batched=0, #rpcs_inflight=1) is hosting 1 region.\n2016-03-06 17:06:45,473 INFO  [AsyncHBase I/O Worker #1] HBaseClient: Added client for region RegionInfo(table=\"tsdb\", region_name=\"tsdb,,1457244762546.76cd3d0dd1b8bc496a49bb8e03ea9ecf.\", stop_key=\"\"), which was added to the regions cache.  Now we know that RegionClient@1357170721(chan=[id: 0xaa9ff3b0, /127.0.0.1:59915 => /127.0.1.1:47707], #pending_rpcs=0, #batched=0, #rpcs_inflight=1) is hosting 2 regions.\n2016-03-06 17:06:45,474 INFO  [AsyncHBase I/O Worker #1] HBaseClient: Added client for region RegionInfo(table=\"tsdb-uid\", region_name=\"tsdb-uid,,1457244762301.042959f02556c889749d5d9ab0f651e8.\", stop_key=\"\"), which was added to the regions cache.  Now we know that RegionClient@1357170721(chan=[id: 0xaa9ff3b0, /127.0.0.1:59915 => /127.0.1.1:47707], #pending_rpcs=0, #batched=0, #rpcs_inflight=1) is hosting 3 regions.\n2016-03-06 17:06:45,514 INFO  [main] RpcHandler: TSD is in rw mode\n2016-03-06 17:06:45,514 INFO  [main] RpcHandler: CORS domain list was empty, CORS will not be enabled\n2016-03-06 17:06:45,515 INFO  [main] RpcHandler: Loaded CORS headers (Authorization, Content-Type, Accept, Origin, User-Agent, DNT, Cache-Control, X-Mx-ReqToken, Keep-Alive, X-Requested-With, If-Modified-Since)\n2016-03-06 17:06:45,518 WARN  [main] PluginLoader: Unable to locate any plugins of the type: net.opentsdb.tsd.HttpSerializer\n2016-03-06 17:06:45,530 INFO  [main] TSDMain: Ready to serve on /0.0.0.0:4242\n\n\n(5) OpenTSDB\u306e\u52d5\u4f5c\u78ba\u8a8d\n\n\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u304b\u3089\u3001OpenTSDB\u30d7\u30ed\u30bb\u30b9\u52d5\u4f5c\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\n$ jps\n10164 QuorumPeerMain\n15435 Jps\n10672 HMaster\n15301 TSDMain\n\n\nHBase Shell\u3092\u8d77\u52d5\u3057\u3066\u3001OpenTSDB\u7528\u30c6\u30fc\u30d6\u30eb\u69cb\u6210\u3092\u78ba\u8a8d\u3059\u308b\n\n$ cd $HOME\n$ cd hbase-0.94.27/\n$ ./bin/hbase shell\nHBase Shell; enter 'help<RETURN>' for list of supported commands.\nType \"exit<RETURN>\" to leave the HBase Shell\nVersion 0.94.27, rfb434617716493eac82b55180b0bbd653beb90bf, Thu Mar 19 06:17:55 UTC 2015\n\nhbase(main):001:0> list\nTABLE                                                                           \ntsdb                                                                            \ntsdb-meta                                                                       \ntsdb-tree                                                                       \ntsdb-uid                                                                        \n4 row(s) in 0.7050 seconds\n\n\"tsdb\", \"tsdb-meta\", \"tsdb-tree\", \"tsdb-uid\"\u306e\uff14\u30c6\u30fc\u30d6\u30eb\u304c\u8ffd\u52a0\u3055\u308c\u3066\u304a\u308a\u307e\u3057\u305f\u3002\nhbase(main):015:0* describe 'tsdb'\nDESCRIPTION                                                          ENABLED                              \n 'tsdb', {NAME => 't', DATA_BLOCK_ENCODING => 'NONE', BLOOMFILTER => true                                 \n  'ROW', REPLICATION_SCOPE => '0', VERSIONS => '1', COMPRESSION => '                                      \n NONE', MIN_VERSIONS => '0', TTL => '2147483647', KEEP_DELETED_CELLS                                      \n  => 'false', BLOCKSIZE => '65536', IN_MEMORY => 'false', ENCODE_ON_                                      \n DISK => 'true', BLOCKCACHE => 'true'}                                                                    \n1 row(s) in 0.0430 seconds\n\nhbase(main):016:0> describe 'tsdb-meta'\nDESCRIPTION                                                          ENABLED                              \n 'tsdb-meta', {NAME => 'name', DATA_BLOCK_ENCODING => 'NONE', BLOOMF true                                 \n ILTER => 'ROW', REPLICATION_SCOPE => '0', VERSIONS => '3', COMPRESS                                      \n ION => 'NONE', MIN_VERSIONS => '0', TTL => '2147483647', KEEP_DELET                                      \n ED_CELLS => 'false', BLOCKSIZE => '65536', IN_MEMORY => 'false', EN                                      \n CODE_ON_DISK => 'true', BLOCKCACHE => 'true'}                                                            \n1 row(s) in 0.0370 seconds\n\nhbase(main):017:0> describe 'tsdb-tree'\nDESCRIPTION                                                          ENABLED                              \n 'tsdb-tree', {NAME => 't', DATA_BLOCK_ENCODING => 'NONE', BLOOMFILT true                                 \n ER => 'ROW', REPLICATION_SCOPE => '0', VERSIONS => '1', COMPRESSION                                      \n  => 'NONE', MIN_VERSIONS => '0', TTL => '2147483647', KEEP_DELETED_                                      \n CELLS => 'false', BLOCKSIZE => '65536', IN_MEMORY => 'false', ENCOD                                      \n E_ON_DISK => 'true', BLOCKCACHE => 'true'}                                                               \n1 row(s) in 0.0350 seconds\n\nhbase(main):018:0> describe 'tsdb-uid'\nDESCRIPTION                                                          ENABLED                              \n 'tsdb-uid', {NAME => 'id', DATA_BLOCK_ENCODING => 'NONE', BLOOMFILT true                                 \n ER => 'ROW', REPLICATION_SCOPE => '0', VERSIONS => '3', COMPRESSION                                      \n  => 'NONE', MIN_VERSIONS => '0', TTL => '2147483647', KEEP_DELETED_                                      \n CELLS => 'false', BLOCKSIZE => '65536', IN_MEMORY => 'false', ENCOD                                      \n E_ON_DISK => 'true', BLOCKCACHE => 'true'}, {NAME => 'name', DATA_B                                      \n LOCK_ENCODING => 'NONE', BLOOMFILTER => 'ROW', REPLICATION_SCOPE =>                                      \n  '0', VERSIONS => '3', COMPRESSION => 'NONE', MIN_VERSIONS => '0',                                       \n TTL => '2147483647', KEEP_DELETED_CELLS => 'false', BLOCKSIZE => '6                                      \n 5536', IN_MEMORY => 'false', ENCODE_ON_DISK => 'true', BLOCKCACHE =                                      \n > 'true'}                                                                                                \n1 row(s) in 0.0390 seconds\n\n\n\u2b1b\ufe0e OpenTSDB\u306e\u57fa\u672c\u52d5\u4f5c\u3092\u8a66\u3057\u3066\u307f\u308b\n\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u300cOpenTSDB\u300d\u3078\u306e\u30c7\u30fc\u30bf\u53c2\u7167/\u66f4\u65b0\u3092\u884c\u3046\u305f\u3081\u306b\u306f\u3001REST-API\u304c\u6d3b\u7528\u3067\u304d\u307e\u3059\u3002\n\u5b9f\u969b\u306eREST-API\u306e\u4f7f\u3044\u65b9\u306f\u3001\"OpenTSDB 2.2 documentation\"\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\u3002\n\n(1) \u4e8b\u524d\u6e96\u5099\u3068\u3057\u3066\u3001metric\u3092\u767b\u9332\u3057\u307e\u3059\n\u307e\u305a\u306f\u3001\u3053\u3061\u3089\u306e\"OpenTSDB 2.2 documentation >> User Guide >> CLI Tools\"\n\u306b\u5f93\u3063\u3066\u3001metric\u3092\u767b\u9332\u3057\u307e\u3059\n\n\"sample-metric\"\u3068\u3044\u3046\u540d\u524d\u306emetric\u3092\u767b\u9332\u3057\u307e\u3059\n\n$ cd $HOME\n$ cd opentsdb\n$ ./build/tsdb mkmetric sample-metric --zkquorum=localhos2182\nmetrics sample-metric: [0, 0, 1]\n\n\n(2) OpenTSDB\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u74b0\u5883\u3092\u6574\u5099\u3057\u307e\u3059\nOpenTSDB\u306eREST-API\u3092\u81ea\u7531\u306b\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u6574\u5099\u3057\u307e\u3059\u3002\n\nhttps://golang.org/doc/install \u3092\u53c2\u8003\u306b\u3001golang\u74b0\u5883\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nopentsdb-goclient\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n$ go get github.com/bluebreezecf/opentsdb-goclient\n\n\n(3) /api/put\u306e\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u307e\u3059\n\u305d\u308c\u3067\u306f\u3001\u65e9\u901f\u3001\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u3092\u767b\u9332\u3057\u3066\u307f\u307e\u3059\u3002\n\u3053\u3061\u3089\u306e\"OpenTSDB 2.2 documentation >> HTTP API >> /api/put\"\n\u306b\u5f93\u3063\u3066\u3001REST\u7d4c\u7531\u3067\u3001\u767b\u9332\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u767b\u9332\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u914d\u7f6e\u3057\u307e\u3059\u3002\n\n\nsample_api_put.go\npackage main\n\nimport (\n    \"fmt\"\n    \"github.com/bluebreezecf/opentsdb-goclient/client\"\n    \"github.com/bluebreezecf/opentsdb-goclient/config\"\n        \"time\"\n)\n\nvar metric string = \"sample-metric\"\nvar port string = \"fe-1/1/1\"\nvar PutDataPointNum int = 9\n\nfunc main() {\n    opentsdbCfg := config.OpenTSDBConfig{\n        OpentsdbHost: \"192.168.195.164:4242\",\n    }\n    tsdbClient, err := client.NewClient(opentsdbCfg)\n    if err != nil {\n        fmt.Printf(\"%v\\n\", err)\n        return\n    }\n\n        //POST /api/put\n        fmt.Println(\"Begin to test POST /api/put.\")\n        sampleDatas := make([]client.DataPoint, 0)\n        time.Sleep(2 * time.Second)\n        tags := make(map[string]string)\n        tags[\"port\"] = port\n        i := 0\n        for {\n                time.Sleep(1000 * time.Millisecond)\n                data := client.DataPoint{\n                        Metric:    metric,\n                        Timestamp: time.Now().Unix(),\n                        Value:     i,\n                }\n                data.Tags = tags\n                sampleDatas = append(sampleDatas, data)\n                fmt.Printf(\"  %d.Prepare datapoint %s\\n\", i, data.String())\n                if i < PutDataPointNum {\n                        i++\n                } else {\n                        break\n                }\n        }\n\n        if resp, err := tsdbClient.Put(sampleDatas, \"details\"); err != nil {\n                fmt.Printf(\"  Error occurs when putting datapoints: %v\", err)\n        } else {\n                fmt.Printf(\"  %s\", resp.String())\n        }\n        fmt.Println(\"Finish testing POST /api/put.\")\n\n}\n\n\n\n\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u767b\u9332\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n$ go run sample_api_put.go \nBegin to test POST /api/put.\n  0.Prepare datapoint {\"metric\":\"sample-metric\",\"timestamp\":1457249790,\"value\":0,\"tags\":{\"port\":\"fe-1/1/1\"}}\n  1.Prepare datapoint {\"metric\":\"sample-metric\",\"timestamp\":1457249791,\"value\":1,\"tags\":{\"port\":\"fe-1/1/1\"}}\n  2.Prepare datapoint {\"metric\":\"sample-metric\",\"timestamp\":1457249792,\"value\":2,\"tags\":{\"port\":\"fe-1/1/1\"}}\n  3.Prepare datapoint {\"metric\":\"sample-metric\",\"timestamp\":1457249793,\"value\":3,\"tags\":{\"port\":\"fe-1/1/1\"}}\n  4.Prepare datapoint {\"metric\":\"sample-metric\",\"timestamp\":1457249794,\"value\":4,\"tags\":{\"port\":\"fe-1/1/1\"}}\n  5.Prepare datapoint {\"metric\":\"sample-metric\",\"timestamp\":1457249795,\"value\":5,\"tags\":{\"port\":\"fe-1/1/1\"}}\n  6.Prepare datapoint {\"metric\":\"sample-metric\",\"timestamp\":1457249796,\"value\":6,\"tags\":{\"port\":\"fe-1/1/1\"}}\n  7.Prepare datapoint {\"metric\":\"sample-metric\",\"timestamp\":1457249797,\"value\":7,\"tags\":{\"port\":\"fe-1/1/1\"}}\n  8.Prepare datapoint {\"metric\":\"sample-metric\",\"timestamp\":1457249798,\"value\":8,\"tags\":{\"port\":\"fe-1/1/1\"}}\n  9.Prepare datapoint {\"metric\":\"sample-metric\",\"timestamp\":1457249799,\"value\":9,\"tags\":{\"port\":\"fe-1/1/1\"}}\n  {\"StatusCode\":200,\"failed\":0,\"success\":10}\nFinish testing POST /api/put.\n\n\u4ee5\u4e0a\u3088\u308a\u3001\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u3092\uff11\uff10\u4ef6\u3001\u4fdd\u5b58\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\n(4) /api/query\u306e\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u307e\u3059\n\u5148\u307b\u3069\u3001\u4fdd\u5b58\u3057\u305f\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u3092\u53c2\u7167\u3057\u3066\u307f\u307e\u3059\u3002\n\u3053\u3061\u3089\u306e\"OpenTSDB 2.2 documentation >> HTTP API >> /api/query\"\n\u306b\u5f93\u3063\u3066\u3001REST\u7d4c\u7531\u3067\u3001\u53c2\u7167\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u53c2\u7167\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u914d\u7f6e\u3057\u307e\u3059\u3002\n\n\nsample_api_query.go\npackage main\n\nimport (\n    \"fmt\"\n    \"time\"\n    \"github.com/bluebreezecf/opentsdb-goclient/client\"\n    \"github.com/bluebreezecf/opentsdb-goclient/config\"\n)\n\nvar host string = \"192.168.195.164:4242\"\nvar metric string = \"sample-metric\"\nvar aggregator string = \"sum\"\nvar port string = \"fe-1/1/1\"\nvar rate bool = false\n\nfunc main() {\n    st2 := time.Now().Unix()\n    st1 := st2 - 300\n\n    // create New Client\n    opentsdbCfg := config.OpenTSDBConfig{\n        OpentsdbHost: host,\n    }\n    tsdbClient, err := client.NewClient(opentsdbCfg)\n    if err != nil {\n        fmt.Printf(\"%v\\n\", err)\n        return\n    }\n\n    // POST /api/query to query\n    tags := make(map[string]string)\n    tags[\"port\"] = port\n    queryParam := client.QueryParam{\n        Start: st1,\n        End:   st2,\n    }\n    subqueries := make([]client.SubQuery, 0)\n    subQuery := client.SubQuery{\n        Aggregator: aggregator,\n        Rate: rate,\n        Metric: metric,\n        Tags:   tags,\n    }\n    subqueries = append(subqueries, subQuery)\n    queryParam.Queries = subqueries\n\n    fmt.Println(\"===================== seach metrics =====================\")\n    fmt.Println(\"Start time :\", time.Unix(st1, 0).UTC(), \" ->\", st1)\n    fmt.Println(\"End time   :\", time.Unix(st2, 0).UTC(), \" ->\", st2)\n    fmt.Println(\"Aggregator :\", aggregator)\n    fmt.Println(\"Rate       :\", rate)\n    fmt.Println(\"Metric     :\", metric)\n    fmt.Println(\"Tags       :\", tags)\n    fmt.Println(\"===================== search result =====================\")\n\n    if queryResp, err := tsdbClient.Query(queryParam); err != nil {\n        fmt.Printf(\"Error occurs when querying: %v\", err)\n    } else {\n        fmt.Printf(\"%s\\n\", queryResp.String())\n    }\n}\n\n\n\n\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u53c2\u7167\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n$ go run sample_api_query.go \n===================== seach metrics =====================\nStart time : 2016-03-06 07:31:50 +0000 UTC  -> 1457249510\nEnd time   : 2016-03-06 07:36:50 +0000 UTC  -> 1457249810\nAggregator : sum\nRate       : false\nMetric     : sample-metric\nTags       : map[port:fe-1/1/1]\n===================== search result =====================\n{\"StatusCode\":200,\"queryRespCnts\":[{\"metric\":\"sample-metric\",\"tags\":{\"port\":\"fe-1/1/1\"},\"aggregateTags\":[],\"dps\":{\"1457249790\":0,\"1457249791\":1,\"1457249792\":2,\"1457249793\":3,\"1457249794\":4,\"1457249795\":5,\"1457249796\":6,\"1457249797\":7,\"1457249798\":8,\"1457249799\":9}}],\"error\":null}\n\n\u5b9f\u884c\u7d50\u679c\u3068\u3057\u3066\u3001\u6b21\u306e\u3088\u3046\u306a\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u3092\u53c2\u7167\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\"1457249790\":0,\n\"1457249791\":1,\n\"1457249792\":2,\n\"1457249793\":3,\n\"1457249794\":4,\n\"1457249795\":5,\n\"1457249796\":6,\n\"1457249797\":7,\n\"1457249798\":8,\n\"1457249799\":9\n\u306a\u304a\u3001\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u53c2\u7167\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u90fd\u5408\u4e0a\u3001\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3057\u3066\u304b\u3089\u3001\uff15\u5206\u4ee5\u5185\u306b\u3001\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u3092\u53c2\u7167\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u4f7f\u7528\u4e0a\u3001\u3054\u6ce8\u610f\u304f\u3060\u3055\u3044\u3002\n\n\u2b1b\ufe0e \u6700\u5f8c\u306b\n\u4eca\u56de\u306f\u3001OpenTSDB\u74b0\u5883\u3092\u30b7\u30f3\u30d7\u30eb\u306b\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\u3092\u8a66\u3057\u3066\u307f\u305f\u306b\u904e\u304e\u307e\u305b\u3093\u3002\n\u5b9f\u904b\u7528\u3067\u306f\u3001BigData\u9818\u57df\u3078\u306e\u6d3b\u7528\u3092\u898b\u636e\u3048\u3066\u3001Apache HBase/hadoop\u306b\u3088\u308b\u30af\u30e9\u30b9\u30bf\u57fa\u76e4\u3092\u524d\u63d0\u306b\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u305f\u3060\u3057\u3001OpenTSDB\u30af\u30e9\u30b9\u30bf\u69cb\u7bc9\u306b\u5fc5\u8981\u3068\u306a\u308b\u30b9\u30ad\u30eb\u7fd2\u5f97\u306f\u3001\u306a\u304b\u306a\u304b\u3001\u96e3\u6613\u5ea6\u304c\u9ad8\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u5df7\u306b\u306f\u3001OpenTSDB\u3092\u52c9\u5f37\u3059\u308b\u306b\u3075\u3055\u308f\u3057\u3044\u6280\u8853\u66f8\u7c4d\u306a\u3069\u3001\u7686\u7121\u306b\u7b49\u3057\u3044\u306e\u3067\u3001\u3082\u3046\u5c11\u3057\u3001\u6ce8\u76ee\u3092\u96c6\u3081\u3066\u3082\u826f\u3044\u3068\u611f\u3058\u307e\u3057\u305f\u3002\n\u4eca\u56de\u3001\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9[\u201dOpenTSDB\u201d](http://opentsdb.net/overview.html)\u306e\u57fa\u672c\u52d5\u4f5c\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nOpenTSDB\u306b\u3064\u3044\u3066\u306f\u3001\u3053\u3061\u3089\u306eSlideShare\u300c[HBaseCon 2015: OpenTSDB and AsyncHBase Update](http://www.slideshare.net/HBaseCon/operations-session-3-49043534?qid=5547eada-f70d-4730-bacb-6aeb6f37c068&v=&b=&from_search=5)\u300d\u304c\u53c2\u8003\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u306a\u304a\u3001OpenTSDB\u3067\u6271\u3046\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u306f\u3001Apache HBase/hadoop\u30af\u30e9\u30b9\u30bf\u69cb\u6210\u4e0a\u306b\u3001\u4fdd\u7ba1\u3055\u308c\u307e\u3059\u3002\n\u4eca\u56de\u306f\u3001OpenTSDB\u57fa\u672c\u52d5\u4f5c\u3092\u8a66\u3059\u76ee\u7684\u306a\u306e\u3067\u3001\u30af\u30e9\u30b9\u30bf\u69cb\u6210\u306f\u884c\u3063\u3066\u304a\u308a\u307e\u305b\u3093\u3002\n\n#\u2b1b\ufe0e OpenTSDB\u74b0\u5883\u69cb\u7bc9\n\u5b9f\u969b\u306e\u69cb\u7bc9\u306b\u3042\u305f\u3063\u3066\u3001\u3053\u3061\u3089\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\nhttp://opentsdb.net/docs/build/html/installation.html#id1\n## (1) Linux\u74b0\u5883\u6e96\u5099\n- Ubunts\u74b0\u5883\u6574\u5099\u3059\u308b\n\n```\n$ cat /etc/lsb-release \nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=14.04\nDISTRIB_CODENAME=trusty\nDISTRIB_DESCRIPTION=\"Ubuntu 14.04.3 LTS\"\n\n$ sudo apt-get update\n$ sudo apt-get install git\n$ sudo apt-get install autoconf\n$ sudo apt-get install make\n```\n- \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u78ba\u8a8d\u3059\u308b\n\n```\n$ ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default \n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 00:0c:29:47:78:62 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.195.164/24 brd 192.168.195.255 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::20c:29ff:fe47:7862/64 scope link \n       valid_lft forever preferred_lft forever\n```\n- JDK\u74b0\u5883\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001JAVA_HOME\u74b0\u5883\u5909\u6570\u306b\u30bb\u30c3\u30c8\u3059\u308b\n\n```\n$ sudo apt-get install default-jdk\n$ sudo update-alternatives --list java\n/usr/lib/jvm/java-7-openjdk-amd64/jre/bin/java\n\n$ cd $HOME\n$ vi .profile\nexport JAVA_HOME=/usr/lib/jvm/java-7-openjdk-amd64\n```\n\n- OpenTSDB\u7528log\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u304a\u304f\n\n```\n$ cd /var/log/\n$ sudo mkdir opentsdb\n$ sudo chmod 777 opentsdb\n```\n\n## (2) Apache ZooKeeper\u74b0\u5883\u69cb\u7bc9\n- ZooKeeper\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\n\n```\n$ cd $HOME\n$ wget http://www-eu.apache.org/dist/zookeeper/zookeeper-3.4.6/zookeeper-3.4.6.tar.gz\n$ sudo tar -C /opt -xzf zookeeper-3.4.6.tar.gz\n$ cd /opt/zookeeper-3.4.6/conf\n$ cp zoo_sample.cfg zoo.cfg\n```\n- ZooKeeper\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3059\u308b\n\n```\n$ vi zoo.cfg\n... (snip)\n\n## the zookeeper server quorum\nserver.0=192.168.195.164:2888:3888\n```\n- ZooKeep\u30b3\u30de\u30f3\u30c9\u306e\u30d1\u30b9\u3092\u3001\u30ed\u30b0\u30a4\u30f3\u74b0\u5883\u8a2d\u5b9a\u306b\u8ffd\u52a0\u3059\u308b\n\n```\n$ cd $HOME\n$ vi .profile\nexport PATH=/opt/zookeeper-3.4.6/bin:$PATH\n\n$ source .profile\n```\n- ZooKeeper\u3092\u8d77\u52d5\u3059\u308b\n\n```\n$ zkServer.sh start\nJMX enabled by default\nUsing config: /opt/zookeeper-3.4.6/bin/../conf/zoo.cfg\nStarting zookeeper ... STARTED\n```\n## (3) Apache HBase\u74b0\u5883\u69cb\u7bc9\n- HBase\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\n\n```\n$ wget http://www.apache.org/dist/hbase/hbase-0.94.27/hbase-0.94.27.tar.gz\n$ tar xfz hbase-0.94.27.tar.gz\n$ cd hbase-0.94.27/\n```\n\n- HBase\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3059\u308b\n\n```\n$ vi conf/hbase-site.xml\n<?xml version=\"1.0\"?>\n<?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?>\n<configuration>\n  <property>\n    <name>hbase.rootdir</name>\n    <value>file:///tmp/hbase-${user.name}/hbase</value>\n  </property>\n  <property>\n    <name>hbase.zookeeper.property.dataDir</name>\n    <value>/tmp/zookeeper</value>\n  </property>\n  <property>\n    <name>hbase.zookeeper.quorum</name>\n    <value>192.168.195.164</value>\n  </property>\n  <property>\n    <name>hbase.zookeeper.property.clientPort</name>\n    <value>2182</value>\n  </property>\n</configuration>\n\n\n$ vi conf/hbase-env.sh\nexport JAVA_HOME=/usr/lib/jvm/java-7-openjdk-amd64\n```\n- HBase\u3092\u8d77\u52d5\u3059\u308b\n\n```\n$ ./bin/start-hbase.sh\nstarting master, logging to /home/tsubo/hbase-0.94.27/bin/../logs/hbase-tsubo-master-OpenTSDB.out\n```\n\n- HBase\u306e\u30de\u30b9\u30bf\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\nWeb\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u3001http://192.168.195.164:60010 \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3001HBase\u306e\u30de\u30b9\u30bf\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n![HBASE.png](https://qiita-image-store.s3.amazonaws.com/0/103595/cbe50f81-a025-4269-44a0-8d31891008a3.png)\n\n- HBase Shell\u3092\u8d77\u52d5\u3057\u3066\u3001HBase\u4e0a\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304f\n\n```\n$ ./bin/hbase shell\nHBase Shell; enter 'help<RETURN>' for list of supported commands.\nType \"exit<RETURN>\" to leave the HBase Shell\nVersion 0.94.27, rfb434617716493eac82b55180b0bbd653beb90bf, Thu Mar 19 06:17:55 UTC 2015\n\nhbase(main):001:0> list\nTABLE                                                                              \n0 row(s) in 0.6220 seconds\n```\n\n## (4) OpenTSDB\u74b0\u5883\u69cb\u7bc9\n- OpenTSDB\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\n\n```\n$ cd $HOME\n$ git clone git://github.com/OpenTSDB/opentsdb.git\n```\n- \u30d3\u30eb\u30c9\u3059\u308b\n\n```\n$ cd opentsdb/\n$ ./build.sh\n```\n\n- OpenTSDB\u7528\u30c6\u30fc\u30d6\u30eb\u3092\u69cb\u7bc9\u3059\u308b\n\n```\n$ env COMPRESSION=NONE HBASE_HOME=$HOME/hbase-0.94.27 ./src/create_table.sh\nHBase Shell; enter 'help<RETURN>' for list of supported commands.\nType \"exit<RETURN>\" to leave the HBase Shell\nVersion 0.94.27, rfb434617716493eac82b55180b0bbd653beb90bf, Thu Mar 19 06:17:55 UTC 2015\n\ncreate 'tsdb-uid',\n  {NAME => 'id', COMPRESSION => 'NONE', BLOOMFILTER => 'ROW'},\n  {NAME => 'name', COMPRESSION => 'NONE', BLOOMFILTER => 'ROW'}\n0 row(s) in 1.9140 seconds\n\n\ncreate 'tsdb',\n  {NAME => 't', VERSIONS => 1, COMPRESSION => 'NONE', BLOOMFILTER => 'ROW'}\n0 row(s) in 1.0620 seconds\n\n  \ncreate 'tsdb-tree',\n  {NAME => 't', VERSIONS => 1, COMPRESSION => 'NONE', BLOOMFILTER => 'ROW'}\n0 row(s) in 1.0630 seconds\n\n  \ncreate 'tsdb-meta',\n  {NAME => 'name', COMPRESSION => 'NONE', BLOOMFILTER => 'ROW'}\n0 row(s) in 1.0480 seconds\n```\n\n- OpenTSDB\u3092\u8d77\u52d5\u3059\u308b\n\n```\n$ tsdtmp=${TMPDIR-'/tmp'}/tsd\n$ ./build/tsdb tsd --port=4242 --staticroot=build/staticroot --cachedir=\"$tsdtmp\" --zkquorum=localhost:2182\n2016-03-06 17:06:45,219 INFO  [main] TSDMain: Starting.\n2016-03-06 17:06:45,222 INFO  [main] TSDMain: net.opentsdb.tools 2.2.0 built at revision e2efe9a (MINT)\n2016-03-06 17:06:45,223 INFO  [main] TSDMain: Built on 2016/03/05 04:52:57 +0000 by tsubo@OpenTSDB:/home/tsubo/opentsdb/build\n2016-03-06 17:06:45,226 INFO  [main] Config: Successfully loaded configuration file: opentsdb.conf\n2016-03-06 17:06:45,263 INFO  [main] Config: Successfully loaded configuration file: opentsdb.conf\n2016-03-06 17:06:45,334 WARN  [main] PluginLoader: Unable to locate any plugins of the type: net.opentsdb.query.filter.TagVFilter\n2016-03-06 17:06:45,354 INFO  [main] ZooKeeper: Client environment:zookeeper.version=3.4.5-1392090, built on 09/30/2012 17:52 GMT\n2016-03-06 17:06:45,354 INFO  [main] ZooKeeper: Client environment:host.name=OpenTSDB\n2016-03-06 17:06:45,354 INFO  [main] ZooKeeper: Client environment:java.version=1.7.0_95\n2016-03-06 17:06:45,355 INFO  [main] ZooKeeper: Client environment:java.vendor=Oracle Corporation\n2016-03-06 17:06:45,355 INFO  [main] ZooKeeper: Client environment:java.home=/usr/lib/jvm/java-7-openjdk-amd64/jre\n2016-03-06 17:06:45,355 INFO  [main] ZooKeeper: Client environment:java.class.path=/home/tsubo/opentsdb/build/third_party/hbase/asynchbase-1.7.1.jar:/home/tsubo/opentsdb/build/third_party/guava/guava-18.0.jar:/home/tsubo/opentsdb/build/third_party/slf4j/log4j-over-slf4j-1.7.7.jar:/home/tsubo/opentsdb/build/third_party/logback/logback-classic-1.0.13.jar:/home/tsubo/opentsdb/build/third_party/logback/logback-core-1.0.13.jar:/home/tsubo/opentsdb/build/third_party/jackson/jackson-annotations-2.4.3.jar:/home/tsubo/opentsdb/build/third_party/jackson/jackson-core-2.4.3.jar:/home/tsubo/opentsdb/build/third_party/jackson/jackson-databind-2.4.3.jar:/home/tsubo/opentsdb/build/third_party/netty/netty-3.9.4.Final.jar:/home/tsubo/opentsdb/build/third_party/protobuf/protobuf-java-2.5.0.jar:/home/tsubo/opentsdb/build/third_party/slf4j/slf4j-api-1.7.7.jar:/home/tsubo/opentsdb/build/third_party/suasync/async-1.4.0.jar:/home/tsubo/opentsdb/build/third_party/zookeeper/zookeeper-3.4.5.jar:/home/tsubo/opentsdb/build/third_party/apache/commons-math3-3.4.1.jar:/home/tsubo/opentsdb/build/tsdb-2.2.0.jar:/home/tsubo/opentsdb/build/../src\n2016-03-06 17:06:45,355 INFO  [main] ZooKeeper: Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib/x86_64-linux-gnu/jni:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/usr/lib/jni:/lib:/usr/lib\n2016-03-06 17:06:45,360 INFO  [main] ZooKeeper: Client environment:java.io.tmpdir=/tmp\n2016-03-06 17:06:45,360 INFO  [main] ZooKeeper: Client environment:java.compiler=<NA>\n2016-03-06 17:06:45,361 INFO  [main] ZooKeeper: Client environment:os.name=Linux\n2016-03-06 17:06:45,361 INFO  [main] ZooKeeper: Client environment:os.arch=amd64\n2016-03-06 17:06:45,361 INFO  [main] ZooKeeper: Client environment:os.version=3.19.0-25-generic\n2016-03-06 17:06:45,361 INFO  [main] ZooKeeper: Client environment:user.name=tsubo\n2016-03-06 17:06:45,362 INFO  [main] ZooKeeper: Client environment:user.home=/home/tsubo\n2016-03-06 17:06:45,362 INFO  [main] ZooKeeper: Client environment:user.dir=/home/tsubo/opentsdb\n2016-03-06 17:06:45,363 INFO  [main] ZooKeeper: Initiating client connection, connectString=localhost:2182 sessionTimeout=5000 watcher=org.hbase.async.HBaseClient$ZKClient@5773a483\n2016-03-06 17:06:45,381 INFO  [main] HBaseClient: Need to find the -ROOT- region\n2016-03-06 17:06:45,383 INFO  [main-SendThread(localhost:2182)] ClientCnxn: Opening socket connection to server localhost/0:0:0:0:0:0:0:1:2182. Will not attempt to authenticate using SASL (unknown error)\n2016-03-06 17:06:45,387 INFO  [main-SendThread(localhost:2182)] ClientCnxn: Socket connection established to localhost/0:0:0:0:0:0:0:1:2182, initiating session\n2016-03-06 17:06:45,395 INFO  [main-SendThread(localhost:2182)] ClientCnxn: Session establishment complete on server localhost/0:0:0:0:0:0:0:1:2182, sessionid = 0x1534a850315001c, negotiated timeout = 5000\n2016-03-06 17:06:45,413 INFO  [main-EventThread] HBaseClient: Connecting to -ROOT- region @ 127.0.1.1:47707\n2016-03-06 17:06:45,454 INFO  [main-EventThread] ZooKeeper: Session: 0x1534a850315001c closed\n2016-03-06 17:06:45,454 INFO  [main-EventThread] ClientCnxn: EventThread shut down\n2016-03-06 17:06:45,471 INFO  [AsyncHBase I/O Worker #1] HBaseClient: Added client for region RegionInfo(table=\".META.\", region_name=\".META.,,1\", stop_key=\"\"), which was added to the regions cache.  Now we know that RegionClient@1357170721(chan=[id: 0xaa9ff3b0, /127.0.0.1:59915 => /127.0.1.1:47707], #pending_rpcs=0, #batched=0, #rpcs_inflight=1) is hosting 1 region.\n2016-03-06 17:06:45,473 INFO  [AsyncHBase I/O Worker #1] HBaseClient: Added client for region RegionInfo(table=\"tsdb\", region_name=\"tsdb,,1457244762546.76cd3d0dd1b8bc496a49bb8e03ea9ecf.\", stop_key=\"\"), which was added to the regions cache.  Now we know that RegionClient@1357170721(chan=[id: 0xaa9ff3b0, /127.0.0.1:59915 => /127.0.1.1:47707], #pending_rpcs=0, #batched=0, #rpcs_inflight=1) is hosting 2 regions.\n2016-03-06 17:06:45,474 INFO  [AsyncHBase I/O Worker #1] HBaseClient: Added client for region RegionInfo(table=\"tsdb-uid\", region_name=\"tsdb-uid,,1457244762301.042959f02556c889749d5d9ab0f651e8.\", stop_key=\"\"), which was added to the regions cache.  Now we know that RegionClient@1357170721(chan=[id: 0xaa9ff3b0, /127.0.0.1:59915 => /127.0.1.1:47707], #pending_rpcs=0, #batched=0, #rpcs_inflight=1) is hosting 3 regions.\n2016-03-06 17:06:45,514 INFO  [main] RpcHandler: TSD is in rw mode\n2016-03-06 17:06:45,514 INFO  [main] RpcHandler: CORS domain list was empty, CORS will not be enabled\n2016-03-06 17:06:45,515 INFO  [main] RpcHandler: Loaded CORS headers (Authorization, Content-Type, Accept, Origin, User-Agent, DNT, Cache-Control, X-Mx-ReqToken, Keep-Alive, X-Requested-With, If-Modified-Since)\n2016-03-06 17:06:45,518 WARN  [main] PluginLoader: Unable to locate any plugins of the type: net.opentsdb.tsd.HttpSerializer\n2016-03-06 17:06:45,530 INFO  [main] TSDMain: Ready to serve on /0.0.0.0:4242\n```\n\n## (5) OpenTSDB\u306e\u52d5\u4f5c\u78ba\u8a8d\n- \u5225\u30bf\u30fc\u30df\u30ca\u30eb\u304b\u3089\u3001OpenTSDB\u30d7\u30ed\u30bb\u30b9\u52d5\u4f5c\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\n```\n$ jps\n10164 QuorumPeerMain\n15435 Jps\n10672 HMaster\n15301 TSDMain\n```\n- HBase Shell\u3092\u8d77\u52d5\u3057\u3066\u3001OpenTSDB\u7528\u30c6\u30fc\u30d6\u30eb\u69cb\u6210\u3092\u78ba\u8a8d\u3059\u308b\n\n```\n$ cd $HOME\n$ cd hbase-0.94.27/\n$ ./bin/hbase shell\nHBase Shell; enter 'help<RETURN>' for list of supported commands.\nType \"exit<RETURN>\" to leave the HBase Shell\nVersion 0.94.27, rfb434617716493eac82b55180b0bbd653beb90bf, Thu Mar 19 06:17:55 UTC 2015\n\nhbase(main):001:0> list\nTABLE                                                                           \ntsdb                                                                            \ntsdb-meta                                                                       \ntsdb-tree                                                                       \ntsdb-uid                                                                        \n4 row(s) in 0.7050 seconds\n```\n\"tsdb\", \"tsdb-meta\", \"tsdb-tree\", \"tsdb-uid\"\u306e\uff14\u30c6\u30fc\u30d6\u30eb\u304c\u8ffd\u52a0\u3055\u308c\u3066\u304a\u308a\u307e\u3057\u305f\u3002\n\n```\nhbase(main):015:0* describe 'tsdb'\nDESCRIPTION                                                          ENABLED                              \n 'tsdb', {NAME => 't', DATA_BLOCK_ENCODING => 'NONE', BLOOMFILTER => true                                 \n  'ROW', REPLICATION_SCOPE => '0', VERSIONS => '1', COMPRESSION => '                                      \n NONE', MIN_VERSIONS => '0', TTL => '2147483647', KEEP_DELETED_CELLS                                      \n  => 'false', BLOCKSIZE => '65536', IN_MEMORY => 'false', ENCODE_ON_                                      \n DISK => 'true', BLOCKCACHE => 'true'}                                                                    \n1 row(s) in 0.0430 seconds\n\nhbase(main):016:0> describe 'tsdb-meta'\nDESCRIPTION                                                          ENABLED                              \n 'tsdb-meta', {NAME => 'name', DATA_BLOCK_ENCODING => 'NONE', BLOOMF true                                 \n ILTER => 'ROW', REPLICATION_SCOPE => '0', VERSIONS => '3', COMPRESS                                      \n ION => 'NONE', MIN_VERSIONS => '0', TTL => '2147483647', KEEP_DELET                                      \n ED_CELLS => 'false', BLOCKSIZE => '65536', IN_MEMORY => 'false', EN                                      \n CODE_ON_DISK => 'true', BLOCKCACHE => 'true'}                                                            \n1 row(s) in 0.0370 seconds\n\nhbase(main):017:0> describe 'tsdb-tree'\nDESCRIPTION                                                          ENABLED                              \n 'tsdb-tree', {NAME => 't', DATA_BLOCK_ENCODING => 'NONE', BLOOMFILT true                                 \n ER => 'ROW', REPLICATION_SCOPE => '0', VERSIONS => '1', COMPRESSION                                      \n  => 'NONE', MIN_VERSIONS => '0', TTL => '2147483647', KEEP_DELETED_                                      \n CELLS => 'false', BLOCKSIZE => '65536', IN_MEMORY => 'false', ENCOD                                      \n E_ON_DISK => 'true', BLOCKCACHE => 'true'}                                                               \n1 row(s) in 0.0350 seconds\n\nhbase(main):018:0> describe 'tsdb-uid'\nDESCRIPTION                                                          ENABLED                              \n 'tsdb-uid', {NAME => 'id', DATA_BLOCK_ENCODING => 'NONE', BLOOMFILT true                                 \n ER => 'ROW', REPLICATION_SCOPE => '0', VERSIONS => '3', COMPRESSION                                      \n  => 'NONE', MIN_VERSIONS => '0', TTL => '2147483647', KEEP_DELETED_                                      \n CELLS => 'false', BLOCKSIZE => '65536', IN_MEMORY => 'false', ENCOD                                      \n E_ON_DISK => 'true', BLOCKCACHE => 'true'}, {NAME => 'name', DATA_B                                      \n LOCK_ENCODING => 'NONE', BLOOMFILTER => 'ROW', REPLICATION_SCOPE =>                                      \n  '0', VERSIONS => '3', COMPRESSION => 'NONE', MIN_VERSIONS => '0',                                       \n TTL => '2147483647', KEEP_DELETED_CELLS => 'false', BLOCKSIZE => '6                                      \n 5536', IN_MEMORY => 'false', ENCODE_ON_DISK => 'true', BLOCKCACHE =                                      \n > 'true'}                                                                                                \n1 row(s) in 0.0390 seconds\n```\n\n#\u2b1b\ufe0e OpenTSDB\u306e\u57fa\u672c\u52d5\u4f5c\u3092\u8a66\u3057\u3066\u307f\u308b\n\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u300cOpenTSDB\u300d\u3078\u306e\u30c7\u30fc\u30bf\u53c2\u7167/\u66f4\u65b0\u3092\u884c\u3046\u305f\u3081\u306b\u306f\u3001REST-API\u304c\u6d3b\u7528\u3067\u304d\u307e\u3059\u3002\n\u5b9f\u969b\u306eREST-API\u306e\u4f7f\u3044\u65b9\u306f\u3001[\"OpenTSDB 2.2 documentation\"](http://opentsdb.net/docs/build/html/index.html)\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\u3002\n\n## (1) \u4e8b\u524d\u6e96\u5099\u3068\u3057\u3066\u3001metric\u3092\u767b\u9332\u3057\u307e\u3059\n\u307e\u305a\u306f\u3001\u3053\u3061\u3089\u306e[\"OpenTSDB 2.2 documentation >> User Guide >> CLI Tools\"](http://opentsdb.net/docs/build/html/user_guide/cli/mkmetric.html)\n\u306b\u5f93\u3063\u3066\u3001metric\u3092\u767b\u9332\u3057\u307e\u3059\n\n- \"sample-metric\"\u3068\u3044\u3046\u540d\u524d\u306emetric\u3092\u767b\u9332\u3057\u307e\u3059\n\n```\n$ cd $HOME\n$ cd opentsdb\n$ ./build/tsdb mkmetric sample-metric --zkquorum=localhos2182\nmetrics sample-metric: [0, 0, 1]\n```\n\n## (2) OpenTSDB\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u74b0\u5883\u3092\u6574\u5099\u3057\u307e\u3059\nOpenTSDB\u306eREST-API\u3092\u81ea\u7531\u306b\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u6574\u5099\u3057\u307e\u3059\u3002\n\n- https://golang.org/doc/install \u3092\u53c2\u8003\u306b\u3001golang\u74b0\u5883\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n- opentsdb-goclient\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n$ go get github.com/bluebreezecf/opentsdb-goclient\n```\n\n## (3) /api/put\u306e\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u307e\u3059\n\u305d\u308c\u3067\u306f\u3001\u65e9\u901f\u3001\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u3092\u767b\u9332\u3057\u3066\u307f\u307e\u3059\u3002\n\u3053\u3061\u3089\u306e[\"OpenTSDB 2.2 documentation >> HTTP API >> /api/put\"](http://opentsdb.net/docs/build/html/api_http/put.html)\n\u306b\u5f93\u3063\u3066\u3001REST\u7d4c\u7531\u3067\u3001\u767b\u9332\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n- \u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u767b\u9332\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u914d\u7f6e\u3057\u307e\u3059\u3002\n\n```go:sample_api_put.go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"github.com/bluebreezecf/opentsdb-goclient/client\"\n\t\"github.com/bluebreezecf/opentsdb-goclient/config\"\n        \"time\"\n)\n\nvar metric string = \"sample-metric\"\nvar port string = \"fe-1/1/1\"\nvar PutDataPointNum int = 9\n\nfunc main() {\n\topentsdbCfg := config.OpenTSDBConfig{\n\t\tOpentsdbHost: \"192.168.195.164:4242\",\n\t}\n\ttsdbClient, err := client.NewClient(opentsdbCfg)\n\tif err != nil {\n\t\tfmt.Printf(\"%v\\n\", err)\n\t\treturn\n\t}\n\n        //POST /api/put\n        fmt.Println(\"Begin to test POST /api/put.\")\n        sampleDatas := make([]client.DataPoint, 0)\n        time.Sleep(2 * time.Second)\n        tags := make(map[string]string)\n        tags[\"port\"] = port\n        i := 0\n        for {\n                time.Sleep(1000 * time.Millisecond)\n                data := client.DataPoint{\n                        Metric:    metric,\n                        Timestamp: time.Now().Unix(),\n                        Value:     i,\n                }\n                data.Tags = tags\n                sampleDatas = append(sampleDatas, data)\n                fmt.Printf(\"  %d.Prepare datapoint %s\\n\", i, data.String())\n                if i < PutDataPointNum {\n                        i++\n                } else {\n                        break\n                }\n        }\n\n        if resp, err := tsdbClient.Put(sampleDatas, \"details\"); err != nil {\n                fmt.Printf(\"  Error occurs when putting datapoints: %v\", err)\n        } else {\n                fmt.Printf(\"  %s\", resp.String())\n        }\n        fmt.Println(\"Finish testing POST /api/put.\")\n\n}\n```\n\n- \u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u767b\u9332\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\n$ go run sample_api_put.go \nBegin to test POST /api/put.\n  0.Prepare datapoint {\"metric\":\"sample-metric\",\"timestamp\":1457249790,\"value\":0,\"tags\":{\"port\":\"fe-1/1/1\"}}\n  1.Prepare datapoint {\"metric\":\"sample-metric\",\"timestamp\":1457249791,\"value\":1,\"tags\":{\"port\":\"fe-1/1/1\"}}\n  2.Prepare datapoint {\"metric\":\"sample-metric\",\"timestamp\":1457249792,\"value\":2,\"tags\":{\"port\":\"fe-1/1/1\"}}\n  3.Prepare datapoint {\"metric\":\"sample-metric\",\"timestamp\":1457249793,\"value\":3,\"tags\":{\"port\":\"fe-1/1/1\"}}\n  4.Prepare datapoint {\"metric\":\"sample-metric\",\"timestamp\":1457249794,\"value\":4,\"tags\":{\"port\":\"fe-1/1/1\"}}\n  5.Prepare datapoint {\"metric\":\"sample-metric\",\"timestamp\":1457249795,\"value\":5,\"tags\":{\"port\":\"fe-1/1/1\"}}\n  6.Prepare datapoint {\"metric\":\"sample-metric\",\"timestamp\":1457249796,\"value\":6,\"tags\":{\"port\":\"fe-1/1/1\"}}\n  7.Prepare datapoint {\"metric\":\"sample-metric\",\"timestamp\":1457249797,\"value\":7,\"tags\":{\"port\":\"fe-1/1/1\"}}\n  8.Prepare datapoint {\"metric\":\"sample-metric\",\"timestamp\":1457249798,\"value\":8,\"tags\":{\"port\":\"fe-1/1/1\"}}\n  9.Prepare datapoint {\"metric\":\"sample-metric\",\"timestamp\":1457249799,\"value\":9,\"tags\":{\"port\":\"fe-1/1/1\"}}\n  {\"StatusCode\":200,\"failed\":0,\"success\":10}\nFinish testing POST /api/put.\n```\n\u4ee5\u4e0a\u3088\u308a\u3001\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u3092\uff11\uff10\u4ef6\u3001\u4fdd\u5b58\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\n## (4) /api/query\u306e\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u307e\u3059\n\u5148\u307b\u3069\u3001\u4fdd\u5b58\u3057\u305f\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u3092\u53c2\u7167\u3057\u3066\u307f\u307e\u3059\u3002\n\u3053\u3061\u3089\u306e[\"OpenTSDB 2.2 documentation >> HTTP API >> /api/query\"](http://opentsdb.net/docs/build/html/api_http/query/index.html)\n\u306b\u5f93\u3063\u3066\u3001REST\u7d4c\u7531\u3067\u3001\u53c2\u7167\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n- \u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u53c2\u7167\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u914d\u7f6e\u3057\u307e\u3059\u3002\n\n```go:sample_api_query.go\npackage main\n\nimport (\n    \"fmt\"\n    \"time\"\n    \"github.com/bluebreezecf/opentsdb-goclient/client\"\n    \"github.com/bluebreezecf/opentsdb-goclient/config\"\n)\n\nvar host string = \"192.168.195.164:4242\"\nvar metric string = \"sample-metric\"\nvar aggregator string = \"sum\"\nvar port string = \"fe-1/1/1\"\nvar rate bool = false\n\nfunc main() {\n    st2 := time.Now().Unix()\n    st1 := st2 - 300\n\n    // create New Client\n    opentsdbCfg := config.OpenTSDBConfig{\n        OpentsdbHost: host,\n    }\n    tsdbClient, err := client.NewClient(opentsdbCfg)\n    if err != nil {\n        fmt.Printf(\"%v\\n\", err)\n        return\n    }\n\n    // POST /api/query to query\n    tags := make(map[string]string)\n    tags[\"port\"] = port\n    queryParam := client.QueryParam{\n        Start: st1,\n        End:   st2,\n    }\n    subqueries := make([]client.SubQuery, 0)\n    subQuery := client.SubQuery{\n        Aggregator: aggregator,\n        Rate: rate,\n        Metric: metric,\n        Tags:   tags,\n    }\n    subqueries = append(subqueries, subQuery)\n    queryParam.Queries = subqueries\n\n    fmt.Println(\"===================== seach metrics =====================\")\n    fmt.Println(\"Start time :\", time.Unix(st1, 0).UTC(), \" ->\", st1)\n    fmt.Println(\"End time   :\", time.Unix(st2, 0).UTC(), \" ->\", st2)\n    fmt.Println(\"Aggregator :\", aggregator)\n    fmt.Println(\"Rate       :\", rate)\n    fmt.Println(\"Metric     :\", metric)\n    fmt.Println(\"Tags       :\", tags)\n    fmt.Println(\"===================== search result =====================\")\n\n    if queryResp, err := tsdbClient.Query(queryParam); err != nil {\n        fmt.Printf(\"Error occurs when querying: %v\", err)\n    } else {\n        fmt.Printf(\"%s\\n\", queryResp.String())\n    }\n}\n```\n\n- \u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u53c2\u7167\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\n$ go run sample_api_query.go \n===================== seach metrics =====================\nStart time : 2016-03-06 07:31:50 +0000 UTC  -> 1457249510\nEnd time   : 2016-03-06 07:36:50 +0000 UTC  -> 1457249810\nAggregator : sum\nRate       : false\nMetric     : sample-metric\nTags       : map[port:fe-1/1/1]\n===================== search result =====================\n{\"StatusCode\":200,\"queryRespCnts\":[{\"metric\":\"sample-metric\",\"tags\":{\"port\":\"fe-1/1/1\"},\"aggregateTags\":[],\"dps\":{\"1457249790\":0,\"1457249791\":1,\"1457249792\":2,\"1457249793\":3,\"1457249794\":4,\"1457249795\":5,\"1457249796\":6,\"1457249797\":7,\"1457249798\":8,\"1457249799\":9}}],\"error\":null}\n```\n\u5b9f\u884c\u7d50\u679c\u3068\u3057\u3066\u3001\u6b21\u306e\u3088\u3046\u306a\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u3092\u53c2\u7167\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\"1457249790\":0,\n\"1457249791\":1,\n\"1457249792\":2,\n\"1457249793\":3,\n\"1457249794\":4,\n\"1457249795\":5,\n\"1457249796\":6,\n\"1457249797\":7,\n\"1457249798\":8,\n\"1457249799\":9\n\n<b>\u306a\u304a\u3001\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u53c2\u7167\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u90fd\u5408\u4e0a\u3001\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3057\u3066\u304b\u3089\u3001\uff15\u5206\u4ee5\u5185\u306b\u3001\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u3092\u53c2\u7167\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</b>\n\u4f7f\u7528\u4e0a\u3001\u3054\u6ce8\u610f\u304f\u3060\u3055\u3044\u3002\n\n#\u2b1b\ufe0e \u6700\u5f8c\u306b\n\u4eca\u56de\u306f\u3001OpenTSDB\u74b0\u5883\u3092\u30b7\u30f3\u30d7\u30eb\u306b\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\u3092\u8a66\u3057\u3066\u307f\u305f\u306b\u904e\u304e\u307e\u305b\u3093\u3002\n\u5b9f\u904b\u7528\u3067\u306f\u3001BigData\u9818\u57df\u3078\u306e\u6d3b\u7528\u3092\u898b\u636e\u3048\u3066\u3001Apache HBase/hadoop\u306b\u3088\u308b\u30af\u30e9\u30b9\u30bf\u57fa\u76e4\u3092\u524d\u63d0\u306b\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u305f\u3060\u3057\u3001OpenTSDB\u30af\u30e9\u30b9\u30bf\u69cb\u7bc9\u306b\u5fc5\u8981\u3068\u306a\u308b\u30b9\u30ad\u30eb\u7fd2\u5f97\u306f\u3001\u306a\u304b\u306a\u304b\u3001\u96e3\u6613\u5ea6\u304c\u9ad8\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u5df7\u306b\u306f\u3001OpenTSDB\u3092\u52c9\u5f37\u3059\u308b\u306b\u3075\u3055\u308f\u3057\u3044\u6280\u8853\u66f8\u7c4d\u306a\u3069\u3001\u7686\u7121\u306b\u7b49\u3057\u3044\u306e\u3067\u3001\u3082\u3046\u5c11\u3057\u3001\u6ce8\u76ee\u3092\u96c6\u3081\u3066\u3082\u826f\u3044\u3068\u611f\u3058\u307e\u3057\u305f\u3002\n"}