{"tags": ["zabbix", "log"], "context": "\n\n\u6982\u8981\nzabbix\u306e\u6982\u8981\u7406\u89e3\u306b\u3064\u3044\u3066\u306f\u3055\u304f\u3089\u306e\u30ca\u30ec\u30c3\u30b8\u306e\u6b21\u306e\u8a18\u4e8b\u304c\u5f79\u7acb\u3063\u305f\u3002\n\u7d71\u5408\u76e3\u8996\u30c4\u30fc\u30eb\u300cZabbix\u300d\u306b\u3088\u308b\u30b5\u30fc\u30d0\u30fc\u76e3\u8996\n\u3081\u3061\u3083\u304f\u3061\u3083\u7c21\u5358\u306b\u307e\u3068\u3081\u308b\u3068\u6b21\u306e\u901a\u308a\n\n\u76ee\u7684\n\n\nServer\u306e\u76e3\u8996\u3001\u901a\u77e5\uff08\u8d77\u52d5\u306e\u6709\u7121\u3001\u8a2d\u5b9a\u3057\u305f\u95be\u5024\u3092\u8d85\u3048\u305f\u5834\u5408\u306email\u901a\u77e5\u7b49\n\n\n\u985e\u4f3cTool\n\n\nNagios(https://www.nagios.org/)\nMRTG(http://www.mrtg.jp/doc/)\n\n\n\u4ee5\u4e0b\u306e\uff13\u3064\u306emodule\u3067\u52d5\u4f5c\n\n\nzabbix-web\uff1azabbix\u306e\u8a2d\u5b9a\u3001server\u3067\u53ce\u96c6\u3057\u305f\u60c5\u5831\u306e\u8868\u793a\nzabbix-server\uff1aagent\u304b\u3089\u60c5\u5831\u3092\u53ce\u96c6\nzabbix-agent\uff1a\u76e3\u8996\u5bfe\u8c61\u306binstall\u3002server\u306b\u60c5\u5831\u3092\u9001\u4fe1\n\n\n\n\n\u74b0\u5883\n\n\n\n\n\n\n\n\n\nOS\nCentOS 6.7\n\n\nZabbix\nZabbix 3.0\n\n\n\n\nInstall\nZabbix\u306eweb,server,agent\u3092\u3059\u3079\u3066\u4e00\u3064\u306eserver\u306binstall\u3059\u308b\u3002\n\u76e3\u8996\u5bfe\u8c61\u3092\u5897\u3084\u3057\u305f\u3044\u5834\u5408\u306b\u306f\u5bfe\u8c61server\u306bzabbix-agent\u306e\u307finstall\u3059\u308c\u3070\u826f\u3044\u3002\n\u4eca\u56deAnsible Galaxy\u306e\u6b21\u306eRole\u3092\u4f7f\u308f\u305b\u3066\u3044\u305f\u3060\u3044\u305f\u3002\n\ngeerlingguy.apache\ngeerlingguy.mysql\ndj-wasabi.zabbix-server\ndj-wasabi.zabbix-agent\n\nzabbix\u3092install\u3057\u305f\u969b\u306bapache\u3068\u306eversion\u304c\u5408\u308f\u305a\u3001zabbix-server\u306e\u8a2d\u5b9afile\u304c\u4e0a\u624b\u304f\u8a2d\u5b9a\u3055\u308c\u306a\u304b\u3063\u305f\u305f\u3081template\u3067\u7f6e\u304d\u63db\u3048\u305f\u3002\nzabbix-web\u306eIP\u306fGlobal IP\u3092\u4f7f\u3044\u3001zabbix-server\u306eIP\u306fPrivate IP\u3092\u4f7f\u3046\u3088\u3046\u306b\u3057\u305f\u3002\n\nzabbixserver.yml\n- name: Install php\n  hosts: zabbixserver\n  tasks:\n  - name: Add repository 'epel-repo'\n    yum: name=http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm state=present\n  - name: Add repository 'remi-repo'\n    yum: name=http://rpms.famillecollet.com/enterprise/remi-release-6.rpm state=present\n  - name: Install php 5.5\n    yum: name={{ item }} state=present enablerepo=remi,remi-php55\n    with_items:\n      - php\n      - php-mysql\n      - php-mbstring\n      - php-gd\n      - php-bcmath\n      - php-xml\n\n- name: configure zabbix-server\n  hosts: zabbixserver\n  roles:\n    - { role: geerlingguy.apache }\n    - { role: geerlingguy.mysql }\n    - role: dj-wasabi.zabbix-server\n      zabbix_url: \"{{ zabbixserver.global_ip }}\"\n      zabbix_version: 3.0\n      zabbix_timezone: Asia/Tokyo\n      database_type: mysql\n      database_type_long: mysql\n  tasks:\n    - name: set up config file\n      template: src=roles/zabbix/templates/zabbix.conf.j2 dest=/etc/httpd/conf.d/zabbix.conf\n      vars:\n        zabbix_host: \"{{ zabbixserver.global_ip }}\"\n    - name: replace hostname to IpAddress in config file\n      lineinfile: >\n        dest=/etc/zabbix/web/zabbix.conf.php\n        regexp='^\\$ZBX_SERVER      ='\n        line=\"$ZBX_SERVER      = '{{ zabbixserver.private_ip }}';\"\n      notify: restart httpd\n  handlers:\n    - name: restart httpd\n      service: name=httpd state=restarted\n\n- name: configure zabbix-agent\n  hosts: zabbixserver\n  roles:\n    - role: dj-wasabi.zabbix-agent\n      agent_server: \"{{ zabbixserver.private_ip }},127.0.0.1\"\n      agent_serveractive: \"{{ zabbixserver.private_ip }},127.0.0.1\"\n\n\n\nroles/zabbix/templates/zabbix.conf.j2\n<VirtualHost *:80>\n  ServerName {{ zabbix_host }}\n\n  ## Vhost docroot                                                                                          \n  DocumentRoot \"/usr/share/zabbix\"\n\n\n  <Directory \"/usr/share/zabbix\">\n      AllowOverride None\n    Order Allow,Deny\n    Allow from all\n    </Directory>\n\n  <Directory \"/usr/share/zabbix/conf\">\n      AllowOverride None\n    Order Deny,Allow\n    Deny from all\n    </Directory>\n\n  <Directory \"/usr/share/zabbix/api\">\n      AllowOverride None\n    Order Deny,Allow\n    Deny from all\n    </Directory>\n\n  <Directory \"/usr/share/zabbix/include\">\n      AllowOverride None\n    Order Deny,Allow\n    Deny from all\n    </Drectory>\n\n  <Directory \"/usr/share/zabbix/include/classes\">\n      AllowOverride None\n    Order Deny,Allow\n    Deny from all\n    </Directory>\n\n  ## Logging                                                                                                \n  ErrorLog \"/var/log/httpd/{{ zabbix_host }}_error.log\"\n  ServerSignature Off\n  CustomLog \"/var/log/httpd/{{ zabbix_host }}_access.log\" combined\n\n  ## Rewrite rules                                                                                          \n  RewriteEngine On\n  RewriteRule ^$ /index.php [L]\n\n  ## Custom fragment                                                                                        \n  php_value max_execution_time 300\n  php_value memory_limit 128M\n  php_value post_max_size 16M\n  php_value upload_max_filesize 2M\n  php_value max_input_time 300\n  # Set correct timezone.                                                                                   \n  php_value date.timezone Asia/Tokyo\n</VirtualHost>\n\n\n\n\u7d50\u679c\ndefault\u306e\u8a2d\u5b9a\u3060\u3068Admin/zabbix\u3067login\u3067\u304d\u308b\u3002\nmysql\u306f\u52dd\u624b\u306bzabbix\u3068\u3044\u3046DB\u3092\u4f5c\u6210\u3057\u3066\u304f\u308c\u308b\u306e\u3067\u7279\u306b\u6c17\u306b\u3057\u306a\u304f\u3066\u3082\u5927\u4e08\u592b\u3060\u3063\u305f\u3002\n\u5f8c\u3001default\u3067\u306fserver\u3068agent\u3067port\u306e10050\u306810051\u3092\u4f7f\u3046\u306e\u3067\u958b\u653e\u3092\u5fd8\u308c\u305a\u306b\u3002\n\u3069\u3046\u3044\u3046\u5024\u3092\u76e3\u8996\u3059\u308b\u306e\u304b\u3068\u3044\u3063\u305f\u8a2d\u5b9a\u306f\u3053\u306eweb front\u304b\u3089\u884c\u3046\u3002\u307e\u305f\u8272\u3005\u3044\u3058\u3063\u3066\u307f\u305f\u3044\u3002\n\n# \u6982\u8981\n\nzabbix\u306e\u6982\u8981\u7406\u89e3\u306b\u3064\u3044\u3066\u306f\u3055\u304f\u3089\u306e\u30ca\u30ec\u30c3\u30b8\u306e\u6b21\u306e\u8a18\u4e8b\u304c\u5f79\u7acb\u3063\u305f\u3002\n\n[\u7d71\u5408\u76e3\u8996\u30c4\u30fc\u30eb\u300cZabbix\u300d\u306b\u3088\u308b\u30b5\u30fc\u30d0\u30fc\u76e3\u8996](http://knowledge.sakura.ad.jp/tech/585/)\n\n\u3081\u3061\u3083\u304f\u3061\u3083\u7c21\u5358\u306b\u307e\u3068\u3081\u308b\u3068\u6b21\u306e\u901a\u308a\n\n* \u76ee\u7684\n    * Server\u306e\u76e3\u8996\u3001\u901a\u77e5\uff08\u8d77\u52d5\u306e\u6709\u7121\u3001\u8a2d\u5b9a\u3057\u305f\u95be\u5024\u3092\u8d85\u3048\u305f\u5834\u5408\u306email\u901a\u77e5\u7b49\n* \u985e\u4f3cTool\n    * Nagios(https://www.nagios.org/)\n    * MRTG(http://www.mrtg.jp/doc/)\n* \u4ee5\u4e0b\u306e\uff13\u3064\u306emodule\u3067\u52d5\u4f5c\n    * zabbix-web\uff1azabbix\u306e\u8a2d\u5b9a\u3001server\u3067\u53ce\u96c6\u3057\u305f\u60c5\u5831\u306e\u8868\u793a\n    * zabbix-server\uff1aagent\u304b\u3089\u60c5\u5831\u3092\u53ce\u96c6\n    * zabbix-agent\uff1a\u76e3\u8996\u5bfe\u8c61\u306binstall\u3002server\u306b\u60c5\u5831\u3092\u9001\u4fe1\n\n# \u74b0\u5883\n\n| | |\n|-----|-------|\n| OS | CentOS 6.7 |\n| Zabbix | Zabbix 3.0 |\n\n# Install\n\nZabbix\u306eweb,server,agent\u3092\u3059\u3079\u3066\u4e00\u3064\u306eserver\u306binstall\u3059\u308b\u3002\n\u76e3\u8996\u5bfe\u8c61\u3092\u5897\u3084\u3057\u305f\u3044\u5834\u5408\u306b\u306f\u5bfe\u8c61server\u306bzabbix-agent\u306e\u307finstall\u3059\u308c\u3070\u826f\u3044\u3002\n\u4eca\u56deAnsible Galaxy\u306e\u6b21\u306eRole\u3092\u4f7f\u308f\u305b\u3066\u3044\u305f\u3060\u3044\u305f\u3002\n\n* geerlingguy.apache\n* geerlingguy.mysql\n* dj-wasabi.zabbix-server\n* dj-wasabi.zabbix-agent\n\nzabbix\u3092install\u3057\u305f\u969b\u306bapache\u3068\u306eversion\u304c\u5408\u308f\u305a\u3001zabbix-server\u306e\u8a2d\u5b9afile\u304c\u4e0a\u624b\u304f\u8a2d\u5b9a\u3055\u308c\u306a\u304b\u3063\u305f\u305f\u3081template\u3067\u7f6e\u304d\u63db\u3048\u305f\u3002\nzabbix-web\u306eIP\u306fGlobal IP\u3092\u4f7f\u3044\u3001zabbix-server\u306eIP\u306fPrivate IP\u3092\u4f7f\u3046\u3088\u3046\u306b\u3057\u305f\u3002\n\n```{zabbixserver.yml}\n- name: Install php\n  hosts: zabbixserver\n  tasks:\n  - name: Add repository 'epel-repo'\n    yum: name=http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm state=present\n  - name: Add repository 'remi-repo'\n    yum: name=http://rpms.famillecollet.com/enterprise/remi-release-6.rpm state=present\n  - name: Install php 5.5\n    yum: name={{ item }} state=present enablerepo=remi,remi-php55\n    with_items:\n      - php\n      - php-mysql\n      - php-mbstring\n      - php-gd\n      - php-bcmath\n      - php-xml\n\n- name: configure zabbix-server\n  hosts: zabbixserver\n  roles:\n    - { role: geerlingguy.apache }\n    - { role: geerlingguy.mysql }\n    - role: dj-wasabi.zabbix-server\n      zabbix_url: \"{{ zabbixserver.global_ip }}\"\n      zabbix_version: 3.0\n      zabbix_timezone: Asia/Tokyo\n      database_type: mysql\n      database_type_long: mysql\n  tasks:\n    - name: set up config file\n      template: src=roles/zabbix/templates/zabbix.conf.j2 dest=/etc/httpd/conf.d/zabbix.conf\n      vars:\n        zabbix_host: \"{{ zabbixserver.global_ip }}\"\n    - name: replace hostname to IpAddress in config file\n      lineinfile: >\n        dest=/etc/zabbix/web/zabbix.conf.php\n        regexp='^\\$ZBX_SERVER      ='\n        line=\"$ZBX_SERVER      = '{{ zabbixserver.private_ip }}';\"\n      notify: restart httpd\n  handlers:\n    - name: restart httpd\n      service: name=httpd state=restarted\n\n- name: configure zabbix-agent\n  hosts: zabbixserver\n  roles:\n    - role: dj-wasabi.zabbix-agent\n      agent_server: \"{{ zabbixserver.private_ip }},127.0.0.1\"\n      agent_serveractive: \"{{ zabbixserver.private_ip }},127.0.0.1\"\n```\n\n```{roles/zabbix/templates/zabbix.conf.j2}\n<VirtualHost *:80>\n  ServerName {{ zabbix_host }}\n\n  ## Vhost docroot                                                                                          \n  DocumentRoot \"/usr/share/zabbix\"\n\n\n  <Directory \"/usr/share/zabbix\">\n      AllowOverride None\n    Order Allow,Deny\n    Allow from all\n    </Directory>\n\n  <Directory \"/usr/share/zabbix/conf\">\n      AllowOverride None\n    Order Deny,Allow\n    Deny from all\n    </Directory>\n\n  <Directory \"/usr/share/zabbix/api\">\n      AllowOverride None\n    Order Deny,Allow\n    Deny from all\n    </Directory>\n\n  <Directory \"/usr/share/zabbix/include\">\n      AllowOverride None\n    Order Deny,Allow\n    Deny from all\n    </Drectory>\n\n  <Directory \"/usr/share/zabbix/include/classes\">\n      AllowOverride None\n    Order Deny,Allow\n    Deny from all\n    </Directory>\n\n  ## Logging                                                                                                \n  ErrorLog \"/var/log/httpd/{{ zabbix_host }}_error.log\"\n  ServerSignature Off\n  CustomLog \"/var/log/httpd/{{ zabbix_host }}_access.log\" combined\n\n  ## Rewrite rules                                                                                          \n  RewriteEngine On\n  RewriteRule ^$ /index.php [L]\n\n  ## Custom fragment                                                                                        \n  php_value max_execution_time 300\n  php_value memory_limit 128M\n  php_value post_max_size 16M\n  php_value upload_max_filesize 2M\n  php_value max_input_time 300\n  # Set correct timezone.                                                                                   \n  php_value date.timezone Asia/Tokyo\n</VirtualHost>\n```\n\n# \u7d50\u679c\n\ndefault\u306e\u8a2d\u5b9a\u3060\u3068Admin/zabbix\u3067login\u3067\u304d\u308b\u3002\nmysql\u306f\u52dd\u624b\u306bzabbix\u3068\u3044\u3046DB\u3092\u4f5c\u6210\u3057\u3066\u304f\u308c\u308b\u306e\u3067\u7279\u306b\u6c17\u306b\u3057\u306a\u304f\u3066\u3082\u5927\u4e08\u592b\u3060\u3063\u305f\u3002\n\u5f8c\u3001default\u3067\u306fserver\u3068agent\u3067port\u306e10050\u306810051\u3092\u4f7f\u3046\u306e\u3067\u958b\u653e\u3092\u5fd8\u308c\u305a\u306b\u3002\n\n\u3069\u3046\u3044\u3046\u5024\u3092\u76e3\u8996\u3059\u308b\u306e\u304b\u3068\u3044\u3063\u305f\u8a2d\u5b9a\u306f\u3053\u306eweb front\u304b\u3089\u884c\u3046\u3002\u307e\u305f\u8272\u3005\u3044\u3058\u3063\u3066\u307f\u305f\u3044\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-07-18 23.49.17.png](https://qiita-image-store.s3.amazonaws.com/0/107806/24bcbfcf-f96c-cde0-cd75-5e5e9a33e7d4.png)\n"}