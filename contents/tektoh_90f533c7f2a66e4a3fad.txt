{"tags": ["CakePHP", "cakephp3"], "context": " More than 1 year has passed since last update.\n\ncomposer.json \u306b heroku-buildpack-php \u3092\u8ffd\u52a0\u3059\u308b\u3002\n    \"require-dev\": {\n        \"psy/psysh\": \"@stable\",\n        \"cakephp/debug_kit\": \"~3.0\",\n        \"cakephp/bake\": \"~1.0\",\n        \"heroku/heroku-buildpack-php\": \"*\"\n    },\n\n\nProcfile\u3092\u4f5c\u6210\u3059\u308b\u3002\nweb: vendor/bin/heroku-php-apache2 webroot/\n\n\nHeroku\u306e\u74b0\u5883\u5909\u6570\nHeroku\u306e\u74b0\u5883\u5909\u6570\u306b CAKE_ENV=heroku \u3092\u8ffd\u52a0\u3059\u308b\u3002\n$ heroku config:add CAKE_ENV=\"heroku\"\n\n\nHeroku\u74b0\u5883\u7528\u306e app.php \u3092\u8aad\u307f\u8fbc\u3080\u8a2d\u5b9a\n\u5148\u306b\u8ffd\u52a0\u3057\u305f\u74b0\u5883\u5909\u6570 CAKE_ENV=heroku \u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u3060\u3051\u3001app.php \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3059\u308b app_heroku.php \u3092\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u3059\u308b\u3002\n\nbootstrap.php\ntry {\n    Configure::config('default', new PhpConfig());\n    Configure::load('app', 'default', false);\n} catch (\\Exception $e) {\n    die($e->getMessage() . \"\\n\");\n}\n// Load an environment local configuration file.\n// You can use a file like app_local.php to provide local overrides to your\n// shared configuration.\n//Configure::load('app_local', 'default');\nif (isset($_ENV['CAKE_ENV'])) {\n    Configure::load('app_' . $_ENV['CAKE_ENV'], 'default');\n}\n\n\n\n\u30c7\u30d0\u30c3\u30b0\u30e2\u30fc\u30c9\u306e\u8a2d\u5b9a\nfalse \u306b\u3057\u3066\u304a\u304f\u3002\n\napp_heroku.php\n    'debug' => false,\n\n\n\nSALT\u306e\u8a2d\u5b9a\nHeroku\u306e\u74b0\u5883\u5909\u6570\u306b SALT \u3092\u8ffd\u52a0\u3057\u3001app_heroku.php\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n$ heroku config:add SALT=\"1234567890987654321\"\n\n\napp_heroku.php\n    'Security' => [\n        'salt' => env('SALT'),\n    ],\n\n\n\n\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u8a2d\u5b9a\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068\u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u3046\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001Memcached\u3092\u4f7f\u3046\u3088\u3046\u306b\u3059\u308b\u3002\n$ heroku addons:add memcachier\n\n\napp_heroku.php\n    'Cache' => [\n        'default' => [\n            'className' => 'Memcached',\n            'prefix' => 'myapp_cake_',\n            'servers' => [env('MEMCACHIER_SERVERS')],\n            'username' => env('MEMCACHIER_USERNAME'),\n            'password' => env('MEMCACHIER_PASSWORD'),\n            'duration' => '+1440 minutes',\n        ],\n\n        'session' => [\n            'className' => 'Memcached',\n            'prefix' => 'myapp_cake_session_',\n            'servers' => [env('MEMCACHIER_SERVERS')],\n            'username' => env('MEMCACHIER_USERNAME'),\n            'password' => env('MEMCACHIER_PASSWORD'),\n            'duration' => '+1440 minutes',\n        ],\n\n        '_cake_core_' => [\n            'className' => 'Memcached',\n            'prefix' => 'myapp_cake_core_',\n            'servers' => [env('MEMCACHIER_SERVERS')],\n            'username' => env('MEMCACHIER_USERNAME'),\n            'password' => env('MEMCACHIER_PASSWORD'),\n            'duration' => '+1 years',\n        ],\n\n        '_cake_model_' => [\n            'className' => 'Memcached',\n            'prefix' => 'myapp_cake_model_',\n            'servers' => [env('MEMCACHIER_SERVERS')],\n            'username' => env('MEMCACHIER_USERNAME'),\n            'password' => env('MEMCACHIER_PASSWORD'),\n            'duration' => '+1 years',\n        ],\n    ],\n\n\n\n\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068\u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u5148\u306b\u8a2d\u5b9a\u3057\u305fMemcached\u3092\u4f7f\u3046\u3088\u3046\u306b\u3059\u308b\u3002\n\napp_heroku.php\n    'Session' => [\n        'defaults' => 'cache',\n        'handler' => [\n            'config' => 'session'\n        ]\n    ],\n\n\n\n\u30ed\u30b0\u306e\u8a2d\u5b9a\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068\u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\u306b\u30ed\u30b0\u3092\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u6a19\u6e96\u51fa\u529b\u306b\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3059\u308b\u3002\u30ed\u30b0\u30a8\u30f3\u30b8\u30f3\u306bConsoleLog\u3092\u4f7f\u3046\u3002\n\napp_heroku.php\n    'Log' => [\n        'debug' => [\n            'className' => 'Cake\\Log\\Engine\\ConsoleLog',\n            'stream' => 'php://stdout',\n            'levels' => ['notice', 'info', 'debug'],\n        ],\n        'error' => [\n            'className' => 'Cake\\Log\\Engine\\ConsoleLog',\n            'stream' => 'php://stderr',\n            'levels' => ['warning', 'error', 'critical', 'alert', 'emergency'],\n        ],\n    ],\n\n\n\nMySQL\u306e\u8a2d\u5b9a\nClearDB\u30a2\u30c9\u30aa\u30f3\u306e\u74b0\u5883\u5909\u6570\u3067mysql://[username]:[password]@[host]/[database]?reconnect=true\u3068\u3044\u3046\u5f62\u5f0f\u3067MySQL\u306e\u63a5\u7d9a\u5148URL\u304c\u5f97\u3089\u308c\u308b\u306e\u3067\u3001parse_url()\u3067\u5206\u89e3\u3057\u3066Datasources\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n$ heroku addons:add cleardb\n\n\napp_heroku.php\n$db = parse_url(env('CLEARDB_DATABASE_URL'));\nreturn [\n      :\n    'Datasources' => [\n        'default' => [\n            'className' => 'Cake\\Database\\Connection',\n            'driver' => 'Cake\\Database\\Driver\\Mysql',\n            'persistent' => false,\n            'host' => $db['host'],\n            'username' => $db['user'],\n            'password' => $db['pass'],\n            'database' => substr($db['path'], 1),\n            'encoding' => 'utf8',\n            'timezone' => 'UTC',\n            'cacheMetadata' => true,\n            'quoteIdentifiers' => false,\n        ],\n    ],\n\n\n\n## composer.json \u306b heroku-buildpack-php \u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n```json\n    \"require-dev\": {\n        \"psy/psysh\": \"@stable\",\n        \"cakephp/debug_kit\": \"~3.0\",\n        \"cakephp/bake\": \"~1.0\",\n        \"heroku/heroku-buildpack-php\": \"*\"\n    },\n```\n\n## Procfile\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n```Procfile\nweb: vendor/bin/heroku-php-apache2 webroot/\n```\n\n## Heroku\u306e\u74b0\u5883\u5909\u6570\n\nHeroku\u306e\u74b0\u5883\u5909\u6570\u306b `CAKE_ENV=heroku` \u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n```bash\n$ heroku config:add CAKE_ENV=\"heroku\"\n```\n\n## Heroku\u74b0\u5883\u7528\u306e app.php \u3092\u8aad\u307f\u8fbc\u3080\u8a2d\u5b9a\n\n\u5148\u306b\u8ffd\u52a0\u3057\u305f\u74b0\u5883\u5909\u6570 `CAKE_ENV=heroku` \u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u3060\u3051\u3001`app.php` \u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3059\u308b `app_heroku.php` \u3092\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u3059\u308b\u3002\n\n```bootstrap.php\ntry {\n    Configure::config('default', new PhpConfig());\n    Configure::load('app', 'default', false);\n} catch (\\Exception $e) {\n    die($e->getMessage() . \"\\n\");\n}\n// Load an environment local configuration file.\n// You can use a file like app_local.php to provide local overrides to your\n// shared configuration.\n//Configure::load('app_local', 'default');\nif (isset($_ENV['CAKE_ENV'])) {\n    Configure::load('app_' . $_ENV['CAKE_ENV'], 'default');\n}\n```\n\n## \u30c7\u30d0\u30c3\u30b0\u30e2\u30fc\u30c9\u306e\u8a2d\u5b9a\n\nfalse \u306b\u3057\u3066\u304a\u304f\u3002\n\n```app_heroku.php\n    'debug' => false,\n```\n\n## SALT\u306e\u8a2d\u5b9a\n\nHeroku\u306e\u74b0\u5883\u5909\u6570\u306b `SALT` \u3092\u8ffd\u52a0\u3057\u3001`app_heroku.php`\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n\n```bash\n$ heroku config:add SALT=\"1234567890987654321\"\n```\n\n```app_heroku.php\n    'Security' => [\n        'salt' => env('SALT'),\n    ],\n```\n\n## \u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u8a2d\u5b9a\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068\u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u3046\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001Memcached\u3092\u4f7f\u3046\u3088\u3046\u306b\u3059\u308b\u3002\n\n```bash\n$ heroku addons:add memcachier\n```\n\n```app_heroku.php\n    'Cache' => [\n        'default' => [\n            'className' => 'Memcached',\n            'prefix' => 'myapp_cake_',\n            'servers' => [env('MEMCACHIER_SERVERS')],\n            'username' => env('MEMCACHIER_USERNAME'),\n            'password' => env('MEMCACHIER_PASSWORD'),\n            'duration' => '+1440 minutes',\n        ],\n\n        'session' => [\n            'className' => 'Memcached',\n            'prefix' => 'myapp_cake_session_',\n            'servers' => [env('MEMCACHIER_SERVERS')],\n            'username' => env('MEMCACHIER_USERNAME'),\n            'password' => env('MEMCACHIER_PASSWORD'),\n            'duration' => '+1440 minutes',\n        ],\n\n        '_cake_core_' => [\n            'className' => 'Memcached',\n            'prefix' => 'myapp_cake_core_',\n            'servers' => [env('MEMCACHIER_SERVERS')],\n            'username' => env('MEMCACHIER_USERNAME'),\n            'password' => env('MEMCACHIER_PASSWORD'),\n            'duration' => '+1 years',\n        ],\n\n        '_cake_model_' => [\n            'className' => 'Memcached',\n            'prefix' => 'myapp_cake_model_',\n            'servers' => [env('MEMCACHIER_SERVERS')],\n            'username' => env('MEMCACHIER_USERNAME'),\n            'password' => env('MEMCACHIER_PASSWORD'),\n            'duration' => '+1 years',\n        ],\n    ],\n```\n\n## \u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068\u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u5148\u306b\u8a2d\u5b9a\u3057\u305fMemcached\u3092\u4f7f\u3046\u3088\u3046\u306b\u3059\u308b\u3002\n\n```app_heroku.php\n    'Session' => [\n        'defaults' => 'cache',\n        'handler' => [\n            'config' => 'session'\n        ]\n    ],\n```\n\n## \u30ed\u30b0\u306e\u8a2d\u5b9a\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068\u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\u306b\u30ed\u30b0\u3092\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u6a19\u6e96\u51fa\u529b\u306b\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3059\u308b\u3002\u30ed\u30b0\u30a8\u30f3\u30b8\u30f3\u306b`ConsoleLog`\u3092\u4f7f\u3046\u3002\n\n```app_heroku.php\n    'Log' => [\n        'debug' => [\n            'className' => 'Cake\\Log\\Engine\\ConsoleLog',\n            'stream' => 'php://stdout',\n            'levels' => ['notice', 'info', 'debug'],\n        ],\n        'error' => [\n            'className' => 'Cake\\Log\\Engine\\ConsoleLog',\n            'stream' => 'php://stderr',\n            'levels' => ['warning', 'error', 'critical', 'alert', 'emergency'],\n        ],\n    ],\n```\n\n## MySQL\u306e\u8a2d\u5b9a\n\nClearDB\u30a2\u30c9\u30aa\u30f3\u306e\u74b0\u5883\u5909\u6570\u3067`mysql://[username]:[password]@[host]/[database]?reconnect=true`\u3068\u3044\u3046\u5f62\u5f0f\u3067MySQL\u306e\u63a5\u7d9a\u5148URL\u304c\u5f97\u3089\u308c\u308b\u306e\u3067\u3001`parse_url()`\u3067\u5206\u89e3\u3057\u3066Datasources\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n\n```bash\n$ heroku addons:add cleardb\n```\n\n```app_heroku.php\n$db = parse_url(env('CLEARDB_DATABASE_URL'));\nreturn [\n      :\n    'Datasources' => [\n        'default' => [\n            'className' => 'Cake\\Database\\Connection',\n            'driver' => 'Cake\\Database\\Driver\\Mysql',\n            'persistent' => false,\n            'host' => $db['host'],\n            'username' => $db['user'],\n            'password' => $db['pass'],\n            'database' => substr($db['path'], 1),\n            'encoding' => 'utf8',\n            'timezone' => 'UTC',\n            'cacheMetadata' => true,\n            'quoteIdentifiers' => false,\n        ],\n    ],\n```\n"}