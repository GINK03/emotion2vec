{"context": " More than 1 year has passed since last update.SSH\u8d8a\u3057\u306ersync\u3067\u3001sudo\u3092\u4f7f\u3063\u3066root\u6a29\u9650\u306b\u3088\u308b\u30d5\u30a1\u30a4\u30eb\u8ee2\u9001\u3092\u884c\u3046\u4f8b\u3002\nfoo@src.example.com \u304b\u3089 foo@dest.example.net \u306b\u8ee2\u9001\u3092\u884c\u3046\u3002\u4e21\u30db\u30b9\u30c8\u3068\u3082\u306b\u516c\u958b\u9375\u8a8d\u8a3c\u3067\u306e\u307f\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u3067\u3001SSH agent forwarding\u3092\u5229\u7528\u3057\u3066\u4e00\u65b9\u304b\u3089\u4ed6\u65b9\u3078\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3044\u3046\u524d\u63d0\u3002\n\n\u8ee2\u9001\u5143\uff08\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\uff09\u30db\u30b9\u30c8\u3067\u306e\u8a2d\u5b9a\nvisudo\u3067sudo\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3002\nsudo\u3067\u4e00\u822c\u30e6\u30fc\u30b6\u306eforward agent\u3092\u4f7f\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n# visudo\n# env_keep\u304c\u4e26\u3093\u3067\u3044\u308b\u884c\u306e\u4e0b\u306b\u8ffd\u8a18\u3059\u308b\n\nDefaults    env_keep += \"SSH_AUTH_SOCK\"\n\n\n\u8ee2\u9001\u5148\u30db\u30b9\u30c8\u3067\u306e\u8a2d\u5b9a\nvisudo\u3067sudo\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3002\nrsync\u3092\u30d1\u30b9\u30ef\u30fc\u30c9\u306a\u3057\u3067\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u307e\u305fTTY\u306a\u3057\u3067\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\"foo\"\u306e\u90e8\u5206\u306b\u306f\u30e6\u30fc\u30b6\u540d\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3002\n# visudo\n# \u30d5\u30a1\u30a4\u30eb\u6700\u4e0b\u90e8\u306b\u8ffd\u8a18\n\nDefaults!/usr/bin/rsync    !requiretty\nfoo    ALL=(ALL)       NOPASSWD: /usr/bin/rsync\n\n\n\u8ee2\u9001\u5b9f\u884c\nrsync-path \u30aa\u30d7\u30b7\u30e7\u30f3\u3067sudo\u3092\u6307\u5b9a\u3057\u3066\u5b9f\u884c\u3002\u8ee2\u9001\u5148\u30db\u30b9\u30c8\u306e\u30e6\u30fc\u30b6\u540d\u6307\u5b9a\u3092\u5fd8\u308c\u306a\u3044\u3053\u3068\uff08\u7701\u7565\u3059\u308b\u3068root\u3067\u63a5\u7d9a\u3057\u3088\u3046\u3068\u3057\u3066\u3057\u307e\u3046\uff09\u3002\u2028\nsudo rsync -auvz -e ssh --rsync-path='sudo rsync' path/to/dir foo@dest.example.net:/path/to/\n\nSSH\u8d8a\u3057\u306ersync\u3067\u3001sudo\u3092\u4f7f\u3063\u3066root\u6a29\u9650\u306b\u3088\u308b\u30d5\u30a1\u30a4\u30eb\u8ee2\u9001\u3092\u884c\u3046\u4f8b\u3002\n\nfoo@src.example.com \u304b\u3089 foo@dest.example.net \u306b\u8ee2\u9001\u3092\u884c\u3046\u3002\u4e21\u30db\u30b9\u30c8\u3068\u3082\u306b\u516c\u958b\u9375\u8a8d\u8a3c\u3067\u306e\u307f\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u3067\u3001SSH agent forwarding\u3092\u5229\u7528\u3057\u3066\u4e00\u65b9\u304b\u3089\u4ed6\u65b9\u3078\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3044\u3046\u524d\u63d0\u3002\n\n## \u8ee2\u9001\u5143\uff08\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\uff09\u30db\u30b9\u30c8\u3067\u306e\u8a2d\u5b9a\n\nvisudo\u3067sudo\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3002\n\nsudo\u3067\u4e00\u822c\u30e6\u30fc\u30b6\u306eforward agent\u3092\u4f7f\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n```\n# visudo\n# env_keep\u304c\u4e26\u3093\u3067\u3044\u308b\u884c\u306e\u4e0b\u306b\u8ffd\u8a18\u3059\u308b\n\nDefaults    env_keep += \"SSH_AUTH_SOCK\"\n```\n\n## \u8ee2\u9001\u5148\u30db\u30b9\u30c8\u3067\u306e\u8a2d\u5b9a\n\nvisudo\u3067sudo\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3002\n\nrsync\u3092\u30d1\u30b9\u30ef\u30fc\u30c9\u306a\u3057\u3067\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u307e\u305fTTY\u306a\u3057\u3067\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\"foo\"\u306e\u90e8\u5206\u306b\u306f\u30e6\u30fc\u30b6\u540d\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3002\n\n```\n# visudo\n# \u30d5\u30a1\u30a4\u30eb\u6700\u4e0b\u90e8\u306b\u8ffd\u8a18\n\nDefaults!/usr/bin/rsync    !requiretty\nfoo    ALL=(ALL)       NOPASSWD: /usr/bin/rsync\n```\n\n## \u8ee2\u9001\u5b9f\u884c\n\n`rsync-path` \u30aa\u30d7\u30b7\u30e7\u30f3\u3067sudo\u3092\u6307\u5b9a\u3057\u3066\u5b9f\u884c\u3002\u8ee2\u9001\u5148\u30db\u30b9\u30c8\u306e\u30e6\u30fc\u30b6\u540d\u6307\u5b9a\u3092\u5fd8\u308c\u306a\u3044\u3053\u3068\uff08\u7701\u7565\u3059\u308b\u3068root\u3067\u63a5\u7d9a\u3057\u3088\u3046\u3068\u3057\u3066\u3057\u307e\u3046\uff09\u3002\u2028\n\n\n```bash\nsudo rsync -auvz -e ssh --rsync-path='sudo rsync' path/to/dir foo@dest.example.net:/path/to/\n```\n", "tags": ["rsync", "Linux"]}