{"context": "\u4eca\u56de\u3001Ubuntu\u30b5\u30fc\u30d0\u306b\u3001Mitaka\u7248 OpenStack Heat\u69cb\u7bc9\u306b\u30c1\u30e3\u30ec\u30f3\u30b8\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u53c2\u8003\u306b\u3057\u305f\u624b\u9806\u306f\u3001\u6b21\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306a\u308a\u307e\u3059\u3002\n\nUbuntu wiki (Ubuntu Cloud Archive)\nOpenStack Documentation Install and configure (Keystone)\nOpenStack Documentation Install and configure (Heat)\n\n\n\u25a0 Heat\u74b0\u5883\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u624b\u9806\n\n(1) Ubuntu\u30b5\u30fc\u30d0\u74b0\u5883\u3092\u6574\u5099\u3057\u307e\u3059\n$ cat /etc/lsb-release \nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=16.04\nDISTRIB_CODENAME=xenial\nDISTRIB_DESCRIPTION=\"Ubuntu 16.04.1 LTS\"\n\n$ sudo apt-get update\n\n$ curl https://bootstrap.pypa.io/get-pip.py > get-pip.py\n$ sudo python3 get-pip.py\n\n\nMySQL\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\uff08root\u30e6\u30fc\u30b6\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u3001\"secrete\"\u3068\u3057\u307e\u3057\u305f\uff09\n\n$ sudo apt-get install mysql-server\n$ mysql --version\nmysql  Ver 14.14 Distrib 5.7.16, for Linux (x86_64) using  EditLine wrapper\n\n\nMySQL\u74b0\u5883\u3092\u3001Keystone\u7528\u306b\u6574\u5099\u3057\u307e\u3059\n\n$ mysql -uroot -psecrete\nmysql> CREATE DATABASE keystone;\nmysql> GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'localhost' IDENTIFIED BY 'secrete';\nmysql> GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'%' IDENTIFIED BY 'secrete';\n\nmysql> exit\n\n\nMySQL\u74b0\u5883\u3092\u3001Heat\u7528\u306b\u6574\u5099\u3057\u307e\u3059\n\n$ mysql -uroot -psecrete\nmysql> CREATE DATABASE heat;\nmysql> GRANT ALL PRIVILEGES ON heat.* TO 'heat'@'localhost' IDENTIFIED BY 'secrete';\nmysql> GRANT ALL PRIVILEGES ON heat.* TO 'heat'@'%' IDENTIFIED BY 'secrete';\n\nmysql> exit\n\n\nrabbit-mq\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\n\n$ sudo apt-get install rabbitmq-server\n\n\n\u521d\u671f\u8a2d\u5b9a\u4e2d\u306b\u7ba1\u7406\u30c8\u30fc\u30af\u30f3\u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u30e9\u30f3\u30c0\u30e0\u5024\u3092\u751f\u6210\u3057\u307e\u3059\n\n$ openssl rand -hex 10\ndbaf0a2ed98a5c16de46\n\n\nkeystone \u30b5\u30fc\u30d3\u30b9\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u306b\u81ea\u52d5\u5b9f\u884c\u3055\u308c\u306a\u3044\u3088\u3046\u306b\u7121\u52b9\u5316\u3057\u307e\u3059\n\n$ sudo -i\n# echo \"manual\" > /etc/init/keystone.override\n# exit\n\n\nkeystone\u95a2\u9023\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\n\n$ sudo apt-get install apt-file\n$ sudo apt-get install software-properties-common\n$ sudo apt-get install python-software-properties\n$ sudo add-apt-repository cloud-archive:mitaka\n$ sudo apt-get update\n\n$ sudo apt-get install keystone apache2 libapache2-mod-wsgi\n\n\nHeat\u95a2\u9023\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\n\n$ sudo apt-get install heat-api heat-engine python-openstackclient\n\n\n(2) Keystone\u52d5\u4f5c\u74b0\u5883\u3092\u6574\u5099\u3057\u307e\u3059\nadmin_token\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u306f\u3001\"openssl rand -hex 10\"\u3067\u4f5c\u6210\u3057\u305f\u30c8\u30fc\u30af\u30f3\u5024\u3092\u8a18\u8ff0\u3057\u307e\u3059\n$ sudo vi /etc/keystone/keystone.conf\n\n\n/etc/keystone/keystone.conf\n[DEFAULT]\nadmin_token = dbaf0a2ed98a5c16de46\nverbose = True\n\n[database]\nconnection = mysql://root:secrete@localhost/keystone\n\n[token]\nprovider = fernet\n\n\n\nKeystone\u52d5\u4f5c\u7528\u306b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\n\n$ sudo /bin/sh -c \"keystone-manage db_sync\"\n\n\nFernet\u30ad\u30fc\u3092\u521d\u671f\u5316\u3057\u307e\u3059\n\n$ sudo keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone\n\n\nApache HTTP Server \u3092\u8a2d\u5b9a\u3057\u307e\u3059\n\n$ sudo vi /etc/apache2/apache2.conf\n\n\n/etc/apache2/apache2.conf\n...\n\nServerName localhost\n\n\n$ sudo vi /etc/apache2/sites-available/wsgi-keystone.conf\n\n\n/etc/apache2/sites-available/wsgi-keystone.conf\nListen 5000\nListen 35357\n\n<VirtualHost *:5000>\n    WSGIDaemonProcess keystone-public processes=5 threads=1 user=keystone group=keystone display-name=%{GROUP}\n    WSGIProcessGroup keystone-public\n    WSGIScriptAlias / /usr/bin/keystone-wsgi-public\n    WSGIApplicationGroup %{GLOBAL}\n    WSGIPassAuthorization On\n    ErrorLogFormat \"%{cu}t %M\"\n    ErrorLog /var/log/apache2/keystone.log\n    CustomLog /var/log/apache2/keystone_access.log combined\n\n    <Directory /usr/bin>\n        Require all granted\n    </Directory>\n</VirtualHost>\n\n<VirtualHost *:35357>\n    WSGIDaemonProcess keystone-admin processes=5 threads=1 user=keystone group=keystone display-name=%{GROUP}\n    WSGIProcessGroup keystone-admin\n    WSGIScriptAlias / /usr/bin/keystone-wsgi-admin\n    WSGIApplicationGroup %{GLOBAL}\n    WSGIPassAuthorization On\n    ErrorLogFormat \"%{cu}t %M\"\n    ErrorLog /var/log/apache2/keystone.log\n    CustomLog /var/log/apache2/keystone_access.log combined\n\n    <Directory /usr/bin>\n        Require all granted\n    </Directory>\n</VirtualHost>\n\n\n$ sudo ln -s /etc/apache2/sites-available/wsgi-keystone.conf /etc/apache2/sites-enabled\n\n\nApache HTTP server\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\n\n$ sudo service apache2 restart\n\n\n\u4e0d\u8981\u306b\u306a\u3063\u305fSQLite database\u3092\u524a\u9664\u3057\u307e\u3059\n\n$ sudo rm /var/lib/keystone/keystone.db\n$ sudo reboot\n\n\ndefault\u306edomain\u3092\u4f5c\u6210\u3057\u307e\u3059.\nOS_TOKEN\u74b0\u5883\u5909\u6570\u306b\u306f\u3001\"openssl rand -hex 10\"\u3067\u4f5c\u6210\u3057\u305f\u30c8\u30fc\u30af\u30f3\u5024\u3092\u8a18\u8ff0\u3057\u307e\u3059.\n\n$ export OS_TOKEN=dbaf0a2ed98a5c16de46\n$ export OS_URL=http://localhost:35357/v3\n$ export OS_IDENTITY_API_VERSION=3 \n\n$ openstack domain create --description \"Default Domain\" default \n+-------------+----------------------------------+\n| Field       | Value                            |\n+-------------+----------------------------------+\n| description | Default Domain                   |\n| enabled     | True                             |\n| id          | 4e41ddd4578a4370a9495885c723a887 |\n| name        | default                          |\n+-------------+----------------------------------+\n\n\nadmin\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n$ openstack project create --domain default --description \"Admin Project\" admin\n+-------------+----------------------------------+\n| Field       | Value                            |\n+-------------+----------------------------------+\n| description | Admin Project                    |\n| domain_id   | 4e41ddd4578a4370a9495885c723a887 |\n| enabled     | True                             |\n| id          | 6f1763f7643e4ee9bb2d2d9dd9bb0bc6 |\n| is_domain   | False                            |\n| name        | admin                            |\n| parent_id   | 4e41ddd4578a4370a9495885c723a887 |\n+-------------+----------------------------------+\n\n\nservice\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n$ openstack project create --domain default --description \"Service Project\" service\n+-------------+----------------------------------+\n| Field       | Value                            |\n+-------------+----------------------------------+\n| description | Service Project                  |\n| domain_id   | 4e41ddd4578a4370a9495885c723a887 |\n| enabled     | True                             |\n| id          | 2020e5f832b545f38169ed1996e2fbd5 |\n| is_domain   | False                            |\n| name        | service                          |\n| parent_id   | 4e41ddd4578a4370a9495885c723a887 |\n+-------------+----------------------------------+\n\n$ openstack project list \n+----------------------------------+---------+\n| ID                               | Name    |\n+----------------------------------+---------+\n| 2020e5f832b545f38169ed1996e2fbd5 | service |\n| 6f1763f7643e4ee9bb2d2d9dd9bb0bc6 | admin   |\n+----------------------------------+---------+\n\n\nadmin\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n$ openstack role create admin\n+-----------+----------------------------------+\n| Field     | Value                            |\n+-----------+----------------------------------+\n| domain_id | None                             |\n| id        | a1f870faaa184908b32806f84a4d3b07 |\n| name      | admin                            |\n+-----------+----------------------------------+\n\n\nMember \u30ed\u30fc\u30eb\u4f5c\u6210\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n$ openstack role create Member\n+-----------+----------------------------------+\n| Field     | Value                            |\n+-----------+----------------------------------+\n| domain_id | None                             |\n| id        | 381f499504944a429d1da9cde9eb1c4f |\n| name      | Member                           |\n+-----------+----------------------------------+\n\n$ openstack role list \n+----------------------------------+--------+\n| ID                               | Name   |\n+----------------------------------+--------+\n| 381f499504944a429d1da9cde9eb1c4f | Member |\n| a1f870faaa184908b32806f84a4d3b07 | admin  |\n+----------------------------------+--------+\n\n\nadmin\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3057\u307e\u3059\uff08admin\u30e6\u30fc\u30b6\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u3001\"secrete\"\u3068\u3057\u307e\u3057\u305f\uff09\n\n$ openstack user create --domain default --password-prompt admin\nUser Password:\nRepeat User Password:\n+-----------+----------------------------------+\n| Field     | Value                            |\n+-----------+----------------------------------+\n| domain_id | 4e41ddd4578a4370a9495885c723a887 |\n| enabled   | True                             |\n| id        | 5379653db96340c082a59ddc6d0765c5 |\n| name      | admin                            |\n+-----------+----------------------------------+\n\n\nadmin \u30e6\u30fc\u30b6\u30fc\u3092 admin \u30ed\u30fc\u30eb \u306b\u52a0\u3048\u307e\u3059\n\n$ openstack role add --project admin --user admin admin\n\n$ openstack user list \n+----------------------------------+-------+\n| ID                               | Name  |\n+----------------------------------+-------+\n| 5379653db96340c082a59ddc6d0765c5 | admin |\n+----------------------------------+-------+\n\n\nKeystone\u306e\u30b5\u30fc\u30d3\u30b9\u30a8\u30f3\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n$ openstack service create --name keystone --description \"OpenStack Identity\" identity\n+-------------+----------------------------------+\n| Field       | Value                            |\n+-------------+----------------------------------+\n| description | OpenStack Identity               |\n| enabled     | True                             |\n| id          | 21d1372d3be54ebc93152c6570661805 |\n| name        | keystone                         |\n| type        | identity                         |\n+-------------+----------------------------------+\n\n\nKeystone \u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n$ openstack endpoint create --region RegionOne identity public http://localhost:5000/v3 \n$ openstack endpoint create --region RegionOne identity internal http://localhost:5000/v3\n$ openstack endpoint create --region RegionOne identity admin http://localhost:35357/v3 \n\n$ openstack endpoint list\n+----------------------------------+-----------+--------------+--------------+---------+-----------+---------------------------+\n| ID                               | Region    | Service Name | Service Type | Enabled | Interface | URL                       |\n+----------------------------------+-----------+--------------+--------------+---------+-----------+---------------------------+\n| 5899428b9a79485f9acafbba363c989e | RegionOne | keystone     | identity     | True    | internal  | http://localhost:5000/v3  |\n| 66e0ca3a69464f43bd5d122ac932b0ca | RegionOne | keystone     | identity     | True    | admin     | http://localhost:35357/v3 |\n| b4929a1819aa4e79a05d7ed31fb76fa3 | RegionOne | keystone     | identity     | True    | public    | http://localhost:5000/v3  |\n+----------------------------------+-----------+--------------+--------------+---------+-----------+---------------------------+\n\n\nheat \u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\uff08heat\u30e6\u30fc\u30b6\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u3001\"secrete\"\u3068\u3057\u307e\u3057\u305f\uff09\n\n$ openstack user create --domain default --password-prompt heat\nUser Password:\nRepeat User Password:\n+-----------+----------------------------------+\n| Field     | Value                            |\n+-----------+----------------------------------+\n| domain_id | 4e41ddd4578a4370a9495885c723a887 |\n| enabled   | True                             |\n| id        | 80e2489f9e2a4608a6aa02fe48f6069f |\n| name      | heat                             |\n+-----------+----------------------------------+\n\n\nadmin \u30ed\u30fc\u30eb\u3092 heat \u30e6\u30fc\u30b6\u30fc\u306b\u8ffd\u52a0\u3057\u307e\u3059\n\n$ openstack role add --project service --user heat admin\n\n\nHeat \u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n$ openstack service create --name heat --description \"Orchestration\" orchestration\n+-------------+----------------------------------+\n| Field       | Value                            |\n+-------------+----------------------------------+\n| description | Orchestration                    |\n| enabled     | True                             |\n| id          | 938a5bb5133546eb8cf02fa9051b38c7 |\n| name        | heat                             |\n| type        | orchestration                    |\n+-------------+----------------------------------+\n\n\nOrchestration \u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n$ openstack endpoint create --region RegionOne orchestration public http://localhost:8004/v1/%\\(tenant_id\\)s\n$ openstack endpoint create --region RegionOne orchestration internal http://localhost:8004/v1/%\\(tenant_id\\)s\n$ openstack endpoint create --region RegionOne orchestration admin http://localhost:8004/v1/%\\(tenant_id\\)s\n\n$ openstack endpoint list\n+----------------------------------+-----------+--------------+---------------+---------+-----------+----------------------------------------+\n| ID                               | Region    | Service Name | Service Type  | Enabled | Interface | URL                                    |\n+----------------------------------+-----------+--------------+---------------+---------+-----------+----------------------------------------+\n| 1adf2772e85f4a0aae1ec5b540861774 | RegionOne | heat         | orchestration | True    | admin     | http://localhost:8004/v1/%(tenant_id)s |\n| 5899428b9a79485f9acafbba363c989e | RegionOne | keystone     | identity      | True    | internal  | http://localhost:5000/v3               |\n| 5a82d0a402e54500b90324a2f7d0d753 | RegionOne | heat         | orchestration | True    | public    | http://localhost:8004/v1/%(tenant_id)s |\n| 66e0ca3a69464f43bd5d122ac932b0ca | RegionOne | keystone     | identity      | True    | admin     | http://localhost:35357/v3              |\n| 7b15cd6b925540c09e0275298857703c | RegionOne | heat         | orchestration | True    | internal  | http://localhost:8004/v1/%(tenant_id)s |\n| b4929a1819aa4e79a05d7ed31fb76fa3 | RegionOne | keystone     | identity      | True    | public    | http://localhost:5000/v3               |\n+----------------------------------+-----------+--------------+---------------+---------+-----------+----------------------------------------+\n\n\nheat \u30c9\u30e1\u30a4\u30f3\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n$ openstack domain create --description \"Stack projects and users\" heat\n+-------------+----------------------------------+\n| Field       | Value                            |\n+-------------+----------------------------------+\n| description | Stack projects and users         |\n| enabled     | True                             |\n| id          | 46bde267d7594cb496c79a25a00732e5 |\n| name        | heat                             |\n+-------------+----------------------------------+\n\n$ openstack domain list\n+----------------------------------+---------+---------+--------------------------+\n| ID                               | Name    | Enabled | Description              |\n+----------------------------------+---------+---------+--------------------------+\n| 46bde267d7594cb496c79a25a00732e5 | heat    | True    | Stack projects and users |\n| 4e41ddd4578a4370a9495885c723a887 | default | True    | Default Domain           |\n+----------------------------------+---------+---------+--------------------------+\n\n\nheat_domain_admin \u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n$ openstack user create --domain heat --password-prompt heat_domain_admin\nUser Password:\nRepeat User Password:\n+-----------+----------------------------------+\n| Field     | Value                            |\n+-----------+----------------------------------+\n| domain_id | 46bde267d7594cb496c79a25a00732e5 |\n| enabled   | True                             |\n| id        | bcd781a873304501950e43348a6f35c5 |\n| name      | heat_domain_admin                |\n+-----------+----------------------------------+\n\n$ openstack user list\n+----------------------------------+-------------------+\n| ID                               | Name              |\n+----------------------------------+-------------------+\n| 5379653db96340c082a59ddc6d0765c5 | admin             |\n| 80e2489f9e2a4608a6aa02fe48f6069f | heat              |\n| bcd781a873304501950e43348a6f35c5 | heat_domain_admin |\n+----------------------------------+-------------------+\n\n\nadmin \u30ed\u30fc\u30eb\u3092 heat \u30c9\u30e1\u30a4\u30f3\u306e heat_domain_admin \u30e6\u30fc\u30b6\u30fc\u306b\u8ffd\u52a0\u3057\u3001 heat_domain_admin \u30e6\u30fc\u30b6\u30fc\u304c\u30b9\u30bf\u30c3\u30af\u7ba1\u7406\u306e\u7ba1\u7406\u8005\u7279\u6a29\u3092\u6301\u3064\u3088\u3046\u306b\u3057\u307e\u3059\n\n$ openstack role add --domain heat --user-domain heat --user heat_domain_admin admin\n\n\nheat_stack_owner \u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n$ openstack role create heat_stack_owner\n+-----------+----------------------------------+\n| Field     | Value                            |\n+-----------+----------------------------------+\n| domain_id | None                             |\n| id        | 2ead0fa3aae246c8a5ccc5bba887e17d |\n| name      | heat_stack_owner                 |\n+-----------+----------------------------------+\n\n$ openstack role list\n+----------------------------------+------------------+\n| ID                               | Name             |\n+----------------------------------+------------------+\n| 2ead0fa3aae246c8a5ccc5bba887e17d | heat_stack_owner |\n| 381f499504944a429d1da9cde9eb1c4f | Member           |\n| a1f870faaa184908b32806f84a4d3b07 | admin            |\n+----------------------------------+------------------+\n\n\ndemo \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n$ openstack project create --domain default --description \"Demo Project\" demo\n+-------------+----------------------------------+\n| Field       | Value                            |\n+-------------+----------------------------------+\n| description | Demo Project                     |\n| domain_id   | 4e41ddd4578a4370a9495885c723a887 |\n| enabled     | True                             |\n| id          | ff3fa8d2f9334e60a845d1671b925b00 |\n| is_domain   | False                            |\n| name        | demo                             |\n| parent_id   | 4e41ddd4578a4370a9495885c723a887 |\n+-------------+----------------------------------+\n\n\ndemo \u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n$ openstack user create --domain default --password-prompt demo\nUser Password:\nRepeat User Password:\n+-----------+----------------------------------+\n| Field     | Value                            |\n+-----------+----------------------------------+\n| domain_id | 4e41ddd4578a4370a9495885c723a887 |\n| enabled   | True                             |\n| id        | 91c784e4100c4e4aaa64462173da01e8 |\n| name      | demo                             |\n+-----------+----------------------------------+\n\n\nuser \u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n$ openstack role create user\n+-----------+----------------------------------+\n| Field     | Value                            |\n+-----------+----------------------------------+\n| domain_id | None                             |\n| id        | d2375b8a11204866929406053a708900 |\n| name      | user                             |\n+-----------+----------------------------------+\n\n\nuser \u30ed\u30fc\u30eb\u3092 demo \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3068 demo \u30e6\u30fc\u30b6\u30fc\u306b\u8ffd\u52a0\u3057\u307e\u3059\n\n$ openstack role add --project demo --user demo user\n\n\nheat_stack_owner \u30ed\u30fc\u30eb\u3092 demo \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3068 demo \u30e6\u30fc\u30b6\u30fc\u306b\u8ffd\u52a0\u3057\u3001 demo \u30e6\u30fc\u30b6\u30fc\u304c\u30b9\u30bf\u30c3\u30af\u306e\u7ba1\u7406\u3092\u884c\u3048\u308b\u3088\u3046\u306b\u3057\u307e\u3059\n\n$ openstack role add --project demo --user demo heat_stack_owner\n\n\nheat_stack_user \u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n$ openstack role create heat_stack_user\n+-----------+----------------------------------+\n| Field     | Value                            |\n+-----------+----------------------------------+\n| domain_id | None                             |\n| id        | a3edcf6aab0b4fea996d2cbfa463bcb5 |\n| name      | heat_stack_user                  |\n+-----------+----------------------------------+\n\n\n(3) Heat\u52d5\u4f5c\u74b0\u5883\u3092\u6574\u5099\u3057\u307e\u3059\n$ sudo vi /etc/heat/heat.conf\n\n\n/etc/heat/heat.conf\n[DEFAULT]\nrpc_backend = rabbit\nheat_metadata_server_url = http://localhost:8000\nheat_waitcondition_server_url = http://localhost:8000/v1/waitcondition\nstack_domain_admin = heat_domain_admin\nstack_domain_admin_password = secrete\nstack_user_domain_name = heat\ndebug = True\n\n[database]\nconnection = mysql://root:secrete@localhost/heat\n\n[keystone_authtoken]\nauth_uri = http://localhost:5000\nauth_url = http://localhost:35357\nmemcached_servers = localhost:11211\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nproject_name = service\nusername = heat\npassword = secrete\n\n[trustee]\nauth_plugin = password\nauth_url = http://localhost:35357\nusername = heat\npassword = secrete\nuser_domain_name = default\n\n[clients_keystone]\nauth_uri = http://localhost:35357\n\n\n\nKeystone\u304c\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3057\u307e\u3059\n\n$ vi $HOME/openstackrc_admin\n\n\n$HOME/openstackrc_admin\nexport OS_PROJECT_DOMAIN_NAME=default\nexport OS_USER_DOMAIN_NAME=default\nexport OS_PROJECT_NAME=admin\nexport OS_USERNAME=admin\nexport OS_PASSWORD=secrete\nexport OS_AUTH_URL=http://localhost:35357/v3\nexport OS_IDENTITY_API_VERSION=3\nexport OS_IMAGE_API_VERSION=2\n\n\n$ source openstackrc_admin\n\n\nHeat-engine\u52d5\u4f5c\u7528\u306b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\n\n$ sudo /bin/sh -c \"heat-manage db_sync\"\n\n\nHeat\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\n\n$ sudo service heat-api restart\n$ sudo service heat-engine restart\n\n\nHeat\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3059\n\n$ heat-engine --version\n6.1.0\n\n$ heat-api --version\n6.1.0\n\n\n\u25a0 Heat\u74b0\u5883\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u5f8c\u306e\u57fa\u672c\u52d5\u4f5c\u78ba\u8a8d\n\u300cMitaka\u7248 Heat\u74b0\u5883\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u304c\u6b63\u3057\u304f\u5b8c\u4e86\u3067\u304d\u305f\u304b\uff1f\u300d\u3092\u3001\u624b\u8efd\u306b\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u672c\u6765\u3067\u3042\u308c\u3070\u3001Heat\u57fa\u672c\u52d5\u4f5c\u3092\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306b\u3001neutron\u7b49\u306e\u4ed6\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304f\u3079\u304d\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u306f\u3001\u305d\u306e\u624b\u9593\u3092\u7701\u304f\u624b\u9806\u3067\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n(1) \u30c0\u30df\u30fc\u306aNetwork\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u3066\u307f\u308b\n\u4ee5\u524d\u3001Heat\u57fa\u672c\u52d5\u4f5c\u3092\u8abf\u67fb\u3057\u305f\u969b\u306b\u3001\u6d3b\u7528\u3057\u305f\u624b\u9806\u3092\u3001\u3053\u3053\u3067\u3082\u8a66\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\"Qiita\u8a18\u4e8b:OpenStack Heat\u57fa\u672c\u52d5\u4f5c\u3092\u8a66\u3057\u3066\u307f\u308b\"\n\nheat-engine\u5185\u90e8\u3092\u6539\u9020\u3059\u308b\uff08\u30c0\u30df\u30fcneutron\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5316\uff09\n\n\nheat/engine/resources/openstack/neutron/net.py\n    def handle_create(self):\n        props = self.prepare_properties(\n            self.properties,\n            self.physical_resource_name())\n\n        dhcp_agent_ids = props.pop(self.DHCP_AGENT_IDS, None)\n#        qos_policy = props.pop(self.QOS_POLICY, None)\n#        if qos_policy:\n#            props['qos_policy_id'] = self.client_plugin().get_qos_policy_id(\n#                qos_policy)\n\n#        net = self.client().create_network({'network': props})['network']\n#        self.resource_id_set(net['id'])\n        self.resource_id_set('aaaaaaaa-aaaa-aaaaaaaae-aaaaaaaaaaaa')\n\n        if dhcp_agent_ids:\n            self._replace_dhcp_agents(dhcp_agent_ids)\n\n    def _show_resource(self):\n#        return self.client().show_network(\n#            self.resource_id)['network']\n        result = {\"status\": \"ACTIVE\", \"name\": \"Sample\", \"id\": \"aaaaaaa-aaaa-aaaaaaaae-aaaaaaaaaaaa\"}\n        return result\n\n    def check_create_complete(self, *args):\n        attributes = self._show_resource()\n        return self.is_built(attributes)\n\n    def handle_delete(self):\n        try:\n#            self.client().delete_network(self.resource_id)\n            pass\n        except Exception as ex:\n            self.client_plugin().ignore_not_found(ex)\n        else:\n            return True\n\n\n\nHeat\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\n\n$ sudo service heat-engine restart\n\n\nneutron\u306e\u30b5\u30fc\u30d3\u30b9/\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n$ openstack service create --name neutron --description \"OpenStack Networking\" network\n\n$ openstack endpoint create --region RegionOne network public http:localhost:9696\n$ openstack endpoint create --region RegionOne network internal http:localhost:9696\n$ openstack endpoint create --region RegionOne network admin http:localhost:9696\n\n... neutron\u7528\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u4f5c\u6210\u305b\u305a\u306b\u3001network\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u6210\u3059\u308b\u3068\u3001\u6b21\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u3066\u3057\u307e\u3046\u307f\u305f\u3044\u3067\u3059(Juno\u7248\u3067\u306f\u3001network\u30ea\u30bd\u30fc\u30b9\u304c\u4f5c\u6210\u3067\u304d\u305f\u3093\u3067\u3059\u3051\u3069...)\n$ openstack stack create --parameter sample_net_name=Sample --template sample.yaml Sample-Net-Stack\nERROR: HEAT-E99001 Service neutron is not available for resource type OS::Neutron::Net, reason: Service endpoint not in service catalog.\n\n\n\u4e8b\u524d\u306b\u3001heat-template\u3092\u914d\u7f6e\u3057\u3066\u304a\u304d\u307e\u3059\n\n\nsample.yaml\nheat_template_version: 2013-05-23\n\ndescription: sample heat for neutron\n\nparameters:\n  sample_net_name:\n    type: string\n    description: Name of Sample network to be created\n    default: sample_network\n\nresources:\n  sample_net:\n    type: OS::Neutron::Net\n    properties:\n      name: { get_param: sample_net_name }\n\noutputs:\n  status:\n    description: status of sample_net\n    value: { get_attr: [ sample_net, status ] }\n\n\n\nopenstack client\u304b\u3089\u3001Heat\u30b9\u30bf\u30c3\u30af\u3092\u4f5c\u6210\u3057\u3066\u307f\u307e\u3059\n\n$ openstack stack create --parameter sample_net_name=Sample --template sample.yaml Sample-Net-Stack\n+---------------------+--------------------------------------+\n| Field               | Value                                |\n+---------------------+--------------------------------------+\n| id                  | b35fee5b-d622-4317-8f0b-d483a5bdf076 |\n| stack_name          | Sample-Net-Stack                     |\n| description         | sample heat for neutron              |\n| creation_time       | 2016-11-19T21:46:20                  |\n| updated_time        | None                                 |\n| stack_status        | CREATE_COMPLETE                      |\n| stack_status_reason | Stack CREATE completed successfully  |\n+---------------------+--------------------------------------+\n\n\nHeat\u30b9\u30bf\u30c3\u30af\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\n\n$ openstack stack show Sample-Net-Stack\n+-----------------------+--------------------------------------------------------------------------------------------------------------------------------+\n| Field                 | Value                                                                                                                          |\n+-----------------------+--------------------------------------------------------------------------------------------------------------------------------+\n| id                    | b35fee5b-d622-4317-8f0b-d483a5bdf076                                                                                           |\n| stack_name            | Sample-Net-Stack                                                                                                               |\n| description           | sample heat for neutron                                                                                                        |\n| creation_time         | 2016-11-19T21:46:20                                                                                                            |\n| updated_time          | None                                                                                                                           |\n| stack_status          | CREATE_COMPLETE                                                                                                                |\n| stack_status_reason   | Stack CREATE completed successfully                                                                                            |\n| parameters            | OS::project_id: 6f1763f7643e4ee9bb2d2d9dd9bb0bc6                                                                               |\n|                       | OS::stack_id: b35fee5b-d622-4317-8f0b-d483a5bdf076                                                                             |\n|                       | OS::stack_name: Sample-Net-Stack                                                                                               |\n|                       | sample_net_name: Sample                                                                                                        |\n|                       |                                                                                                                                |\n| outputs               | - description: status of sample_net                                                                                            |\n|                       |   output_key: status                                                                                                           |\n|                       |   output_value: ACTIVE                                                                                                         |\n|                       |                                                                                                                                |\n| links                 | - href: http://localhost:8004/v1/6f1763f7643e4ee9bb2d2d9dd9bb0bc6/stacks/Sample-Net-Stack/b35fee5b-d622-4317-8f0b-d483a5bdf076 |\n|                       |   rel: self                                                                                                                    |\n|                       |                                                                                                                                |\n| disable_rollback      | True                                                                                                                           |\n| parent                | None                                                                                                                           |\n| tags                  | null                                                                                                                           |\n|                       | ...                                                                                                                            |\n|                       |                                                                                                                                |\n| stack_user_project_id | 7e4693e23d4945b4aae096c012b586d1                                                                                               |\n| capabilities          | []                                                                                                                             |\n| notification_topics   | []                                                                                                                             |\n| timeout_mins          | None                                                                                                                           |\n| stack_owner           | None                                                                                                                           |\n+-----------------------+--------------------------------------------------------------------------------------------------------------------------------+\n\n\nnetwork\u30ea\u30bd\u30fc\u30b9\u306e\u72b6\u614b\u3082\u3001\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3059\n\n$ openstack stack resource list Sample-Net-Stack\n+---------------+--------------------------------------+------------------+-----------------+---------------------+\n| resource_name | physical_resource_id                 | resource_type    | resource_status | updated_time        |\n+---------------+--------------------------------------+------------------+-----------------+---------------------+\n| sample_net    | aaaaaaaa-aaaa-aaaaaaaae-aaaaaaaaaaaa | OS::Neutron::Net | CREATE_COMPLETE | 2016-11-19T21:46:20 |\n+---------------+--------------------------------------+------------------+-----------------+---------------------+\n\n\nHeat\u30b9\u30bf\u30c3\u30af\u3092\u524a\u9664\u3057\u3066\u304a\u304d\u307e\u3059\n\n$ openstack stack delete Sample-Net-Stack\nAre you sure you want to delete this stack(s) [y/N]? y\n\n... Oops!\nHeat\u30b9\u30bf\u30c3\u30af\u524a\u9664\u304c\u5b8c\u4e86\u3057\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3063\u305f orz\n$ openstack stack list\n+--------------------------------------+------------------+--------------------+---------------------+--------------+\n| ID                                   | Stack Name       | Stack Status       | Creation Time       | Updated Time |\n+--------------------------------------+------------------+--------------------+---------------------+--------------+\n| b35fee5b-d622-4317-8f0b-d483a5bdf076 | Sample-Net-Stack | DELETE_IN_PROGRESS | 2016-11-19T21:46:20 | None         |\n+--------------------------------------+------------------+--------------------+---------------------+--------------+\n\n\n\u4ed5\u65b9\u304c\u306a\u3044\u306e\u3067\u3001heat\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u518d\u69cb\u7bc9\u3057\u307e\u3059\n\n$ sudo service heat-engine stop\n$ sudo service heat-api stop\n\n$ mysql -uroot -psecrete\n\nmysql> drop database heat;\nmysql> create database heat;\nmysql> exit\n\n$ sudo /bin/sh -c \"heat-manage db_sync\"\n\n$ sudo service heat-api start\n$ sudo service heat-engine start\n\n\u3068\u308a\u3042\u3048\u305a\u3001Heat\u74b0\u5883\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u306f\u3001\u5b8c\u4e86\u3067\u304d\u307e\u3057\u305f\u3002\n\n\u25a0 \u7d42\u308f\u308a\u306b ...\nHeat\u30b9\u30bf\u30c3\u30af\u304c\u3001\"DELETE_IN_PROGRESS\"\u3067\u6ede\u7559\u3057\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u3001Heat\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u518d\u69cb\u7bc9\u3059\u308b\u3053\u3068\u306a\u304f\u3001Heat\u30b9\u30bf\u30c3\u30af\u3092\u524a\u9664\u3059\u308b\u5bfe\u51e6\u65b9\u6cd5\u304c\u3001\u898b\u3064\u3051\u3089\u308c\u306a\u304b\u3063\u305f\u306e\u304c\u3001\u5fc3\u6b8b\u308a\u3067\u3059\u304c...\n\u4eca\u56de\u3001Ubuntu\u30b5\u30fc\u30d0\u306b\u3001Mitaka\u7248 OpenStack Heat\u69cb\u7bc9\u306b\u30c1\u30e3\u30ec\u30f3\u30b8\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u53c2\u8003\u306b\u3057\u305f\u624b\u9806\u306f\u3001\u6b21\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306a\u308a\u307e\u3059\u3002\n\n- [Ubuntu wiki (Ubuntu Cloud Archive)](https://wiki.ubuntu.com/OpenStack/CloudArchive)\n- [OpenStack Documentation Install and configure (Keystone)](http://docs.openstack.org/mitaka/install-guide-ubuntu/keystone-install.html)\n- [OpenStack Documentation Install and configure (Heat)](http://docs.openstack.org/mitaka/install-guide-ubuntu/heat-install.html)\n\n# \u25a0 Heat\u74b0\u5883\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u624b\u9806\n### (1) Ubuntu\u30b5\u30fc\u30d0\u74b0\u5883\u3092\u6574\u5099\u3057\u307e\u3059\n\n```\n$ cat /etc/lsb-release \nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=16.04\nDISTRIB_CODENAME=xenial\nDISTRIB_DESCRIPTION=\"Ubuntu 16.04.1 LTS\"\n```\n\n```\n$ sudo apt-get update\n```\n\n```\n$ curl https://bootstrap.pypa.io/get-pip.py > get-pip.py\n$ sudo python3 get-pip.py\n```\n\n- MySQL\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\uff08root\u30e6\u30fc\u30b6\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u3001\"secrete\"\u3068\u3057\u307e\u3057\u305f\uff09\n\n```\n$ sudo apt-get install mysql-server\n$ mysql --version\nmysql  Ver 14.14 Distrib 5.7.16, for Linux (x86_64) using  EditLine wrapper\n```\n\n- MySQL\u74b0\u5883\u3092\u3001Keystone\u7528\u306b\u6574\u5099\u3057\u307e\u3059\n\n```\n$ mysql -uroot -psecrete\nmysql> CREATE DATABASE keystone;\nmysql> GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'localhost' IDENTIFIED BY 'secrete';\nmysql> GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'%' IDENTIFIED BY 'secrete';\n\nmysql> exit\n```\n- MySQL\u74b0\u5883\u3092\u3001Heat\u7528\u306b\u6574\u5099\u3057\u307e\u3059\n\n```\n$ mysql -uroot -psecrete\nmysql> CREATE DATABASE heat;\nmysql> GRANT ALL PRIVILEGES ON heat.* TO 'heat'@'localhost' IDENTIFIED BY 'secrete';\nmysql> GRANT ALL PRIVILEGES ON heat.* TO 'heat'@'%' IDENTIFIED BY 'secrete';\n\nmysql> exit\n```\n\n- rabbit-mq\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\n\n```\n$ sudo apt-get install rabbitmq-server\n```\n- \u521d\u671f\u8a2d\u5b9a\u4e2d\u306b\u7ba1\u7406\u30c8\u30fc\u30af\u30f3\u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u30e9\u30f3\u30c0\u30e0\u5024\u3092\u751f\u6210\u3057\u307e\u3059\n\n```\n$ openssl rand -hex 10\ndbaf0a2ed98a5c16de46\n```\n- keystone \u30b5\u30fc\u30d3\u30b9\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u306b\u81ea\u52d5\u5b9f\u884c\u3055\u308c\u306a\u3044\u3088\u3046\u306b\u7121\u52b9\u5316\u3057\u307e\u3059\n\n```\n$ sudo -i\n# echo \"manual\" > /etc/init/keystone.override\n# exit\n```\n\n- keystone\u95a2\u9023\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\n\n```\n$ sudo apt-get install apt-file\n$ sudo apt-get install software-properties-common\n$ sudo apt-get install python-software-properties\n$ sudo add-apt-repository cloud-archive:mitaka\n$ sudo apt-get update\n\n$ sudo apt-get install keystone apache2 libapache2-mod-wsgi\n```\n- Heat\u95a2\u9023\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\n\n```\n$ sudo apt-get install heat-api heat-engine python-openstackclient\n```\n### (2) Keystone\u52d5\u4f5c\u74b0\u5883\u3092\u6574\u5099\u3057\u307e\u3059\nadmin_token\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u306f\u3001\"openssl rand -hex 10\"\u3067\u4f5c\u6210\u3057\u305f\u30c8\u30fc\u30af\u30f3\u5024\u3092\u8a18\u8ff0\u3057\u307e\u3059\n\n```\n$ sudo vi /etc/keystone/keystone.conf\n```\n```text:/etc/keystone/keystone.conf\n[DEFAULT]\nadmin_token = dbaf0a2ed98a5c16de46\nverbose = True\n\n[database]\nconnection = mysql://root:secrete@localhost/keystone\n\n[token]\nprovider = fernet\n```\n\n- Keystone\u52d5\u4f5c\u7528\u306b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\n\n```\n$ sudo /bin/sh -c \"keystone-manage db_sync\"\n```\n- Fernet\u30ad\u30fc\u3092\u521d\u671f\u5316\u3057\u307e\u3059\n\n```\n$ sudo keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone\n```\n\n- Apache HTTP Server \u3092\u8a2d\u5b9a\u3057\u307e\u3059\n\n```\n$ sudo vi /etc/apache2/apache2.conf\n```\n```text:/etc/apache2/apache2.conf\n...\n\nServerName localhost\n```\n```\n$ sudo vi /etc/apache2/sites-available/wsgi-keystone.conf\n```\n```text:/etc/apache2/sites-available/wsgi-keystone.conf\nListen 5000\nListen 35357\n\n<VirtualHost *:5000>\n    WSGIDaemonProcess keystone-public processes=5 threads=1 user=keystone group=keystone display-name=%{GROUP}\n    WSGIProcessGroup keystone-public\n    WSGIScriptAlias / /usr/bin/keystone-wsgi-public\n    WSGIApplicationGroup %{GLOBAL}\n    WSGIPassAuthorization On\n    ErrorLogFormat \"%{cu}t %M\"\n    ErrorLog /var/log/apache2/keystone.log\n    CustomLog /var/log/apache2/keystone_access.log combined\n\n    <Directory /usr/bin>\n        Require all granted\n    </Directory>\n</VirtualHost>\n\n<VirtualHost *:35357>\n    WSGIDaemonProcess keystone-admin processes=5 threads=1 user=keystone group=keystone display-name=%{GROUP}\n    WSGIProcessGroup keystone-admin\n    WSGIScriptAlias / /usr/bin/keystone-wsgi-admin\n    WSGIApplicationGroup %{GLOBAL}\n    WSGIPassAuthorization On\n    ErrorLogFormat \"%{cu}t %M\"\n    ErrorLog /var/log/apache2/keystone.log\n    CustomLog /var/log/apache2/keystone_access.log combined\n\n    <Directory /usr/bin>\n        Require all granted\n    </Directory>\n</VirtualHost>\n```\n```\n$ sudo ln -s /etc/apache2/sites-available/wsgi-keystone.conf /etc/apache2/sites-enabled\n```\n- Apache HTTP server\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\n\n```\n$ sudo service apache2 restart\n```\n- \u4e0d\u8981\u306b\u306a\u3063\u305fSQLite database\u3092\u524a\u9664\u3057\u307e\u3059\n\n```\n$ sudo rm /var/lib/keystone/keystone.db\n$ sudo reboot\n```\n\n- default\u306edomain\u3092\u4f5c\u6210\u3057\u307e\u3059.\nOS_TOKEN\u74b0\u5883\u5909\u6570\u306b\u306f\u3001\"openssl rand -hex 10\"\u3067\u4f5c\u6210\u3057\u305f\u30c8\u30fc\u30af\u30f3\u5024\u3092\u8a18\u8ff0\u3057\u307e\u3059.\n\n```\n$ export OS_TOKEN=dbaf0a2ed98a5c16de46\n$ export OS_URL=http://localhost:35357/v3\n$ export OS_IDENTITY_API_VERSION=3 \n\n$ openstack domain create --description \"Default Domain\" default \n+-------------+----------------------------------+\n| Field       | Value                            |\n+-------------+----------------------------------+\n| description | Default Domain                   |\n| enabled     | True                             |\n| id          | 4e41ddd4578a4370a9495885c723a887 |\n| name        | default                          |\n+-------------+----------------------------------+\n```\n- admin\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n```\n$ openstack project create --domain default --description \"Admin Project\" admin\n+-------------+----------------------------------+\n| Field       | Value                            |\n+-------------+----------------------------------+\n| description | Admin Project                    |\n| domain_id   | 4e41ddd4578a4370a9495885c723a887 |\n| enabled     | True                             |\n| id          | 6f1763f7643e4ee9bb2d2d9dd9bb0bc6 |\n| is_domain   | False                            |\n| name        | admin                            |\n| parent_id   | 4e41ddd4578a4370a9495885c723a887 |\n+-------------+----------------------------------+\n```\n- service\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n```\n$ openstack project create --domain default --description \"Service Project\" service\n+-------------+----------------------------------+\n| Field       | Value                            |\n+-------------+----------------------------------+\n| description | Service Project                  |\n| domain_id   | 4e41ddd4578a4370a9495885c723a887 |\n| enabled     | True                             |\n| id          | 2020e5f832b545f38169ed1996e2fbd5 |\n| is_domain   | False                            |\n| name        | service                          |\n| parent_id   | 4e41ddd4578a4370a9495885c723a887 |\n+-------------+----------------------------------+\n\n$ openstack project list \n+----------------------------------+---------+\n| ID                               | Name    |\n+----------------------------------+---------+\n| 2020e5f832b545f38169ed1996e2fbd5 | service |\n| 6f1763f7643e4ee9bb2d2d9dd9bb0bc6 | admin   |\n+----------------------------------+---------+\n```\n- admin\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n```\n$ openstack role create admin\n+-----------+----------------------------------+\n| Field     | Value                            |\n+-----------+----------------------------------+\n| domain_id | None                             |\n| id        | a1f870faaa184908b32806f84a4d3b07 |\n| name      | admin                            |\n+-----------+----------------------------------+\n```\n- Member \u30ed\u30fc\u30eb\u4f5c\u6210\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n```\n$ openstack role create Member\n+-----------+----------------------------------+\n| Field     | Value                            |\n+-----------+----------------------------------+\n| domain_id | None                             |\n| id        | 381f499504944a429d1da9cde9eb1c4f |\n| name      | Member                           |\n+-----------+----------------------------------+\n\n$ openstack role list \n+----------------------------------+--------+\n| ID                               | Name   |\n+----------------------------------+--------+\n| 381f499504944a429d1da9cde9eb1c4f | Member |\n| a1f870faaa184908b32806f84a4d3b07 | admin  |\n+----------------------------------+--------+\n```\n- admin\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3057\u307e\u3059\uff08admin\u30e6\u30fc\u30b6\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u3001\"secrete\"\u3068\u3057\u307e\u3057\u305f\uff09\n\n```\n$ openstack user create --domain default --password-prompt admin\nUser Password:\nRepeat User Password:\n+-----------+----------------------------------+\n| Field     | Value                            |\n+-----------+----------------------------------+\n| domain_id | 4e41ddd4578a4370a9495885c723a887 |\n| enabled   | True                             |\n| id        | 5379653db96340c082a59ddc6d0765c5 |\n| name      | admin                            |\n+-----------+----------------------------------+\n```\n- admin \u30e6\u30fc\u30b6\u30fc\u3092 admin \u30ed\u30fc\u30eb \u306b\u52a0\u3048\u307e\u3059\n\n```\n$ openstack role add --project admin --user admin admin\n\n$ openstack user list \n+----------------------------------+-------+\n| ID                               | Name  |\n+----------------------------------+-------+\n| 5379653db96340c082a59ddc6d0765c5 | admin |\n+----------------------------------+-------+\n```\n\n- Keystone\u306e\u30b5\u30fc\u30d3\u30b9\u30a8\u30f3\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n```\n$ openstack service create --name keystone --description \"OpenStack Identity\" identity\n+-------------+----------------------------------+\n| Field       | Value                            |\n+-------------+----------------------------------+\n| description | OpenStack Identity               |\n| enabled     | True                             |\n| id          | 21d1372d3be54ebc93152c6570661805 |\n| name        | keystone                         |\n| type        | identity                         |\n+-------------+----------------------------------+\n```\n- Keystone \u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n```\n$ openstack endpoint create --region RegionOne identity public http://localhost:5000/v3 \n$ openstack endpoint create --region RegionOne identity internal http://localhost:5000/v3\n$ openstack endpoint create --region RegionOne identity admin http://localhost:35357/v3 \n\n$ openstack endpoint list\n+----------------------------------+-----------+--------------+--------------+---------+-----------+---------------------------+\n| ID                               | Region    | Service Name | Service Type | Enabled | Interface | URL                       |\n+----------------------------------+-----------+--------------+--------------+---------+-----------+---------------------------+\n| 5899428b9a79485f9acafbba363c989e | RegionOne | keystone     | identity     | True    | internal  | http://localhost:5000/v3  |\n| 66e0ca3a69464f43bd5d122ac932b0ca | RegionOne | keystone     | identity     | True    | admin     | http://localhost:35357/v3 |\n| b4929a1819aa4e79a05d7ed31fb76fa3 | RegionOne | keystone     | identity     | True    | public    | http://localhost:5000/v3  |\n+----------------------------------+-----------+--------------+--------------+---------+-----------+---------------------------+\n```\n- heat \u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\uff08heat\u30e6\u30fc\u30b6\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u3001\"secrete\"\u3068\u3057\u307e\u3057\u305f\uff09\n\n```\n$ openstack user create --domain default --password-prompt heat\nUser Password:\nRepeat User Password:\n+-----------+----------------------------------+\n| Field     | Value                            |\n+-----------+----------------------------------+\n| domain_id | 4e41ddd4578a4370a9495885c723a887 |\n| enabled   | True                             |\n| id        | 80e2489f9e2a4608a6aa02fe48f6069f |\n| name      | heat                             |\n+-----------+----------------------------------+\n```\n- admin \u30ed\u30fc\u30eb\u3092 heat \u30e6\u30fc\u30b6\u30fc\u306b\u8ffd\u52a0\u3057\u307e\u3059\n\n```\n$ openstack role add --project service --user heat admin\n```\n\n- Heat \u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n```\n$ openstack service create --name heat --description \"Orchestration\" orchestration\n+-------------+----------------------------------+\n| Field       | Value                            |\n+-------------+----------------------------------+\n| description | Orchestration                    |\n| enabled     | True                             |\n| id          | 938a5bb5133546eb8cf02fa9051b38c7 |\n| name        | heat                             |\n| type        | orchestration                    |\n+-------------+----------------------------------+\n```\n- Orchestration \u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n```\n$ openstack endpoint create --region RegionOne orchestration public http://localhost:8004/v1/%\\(tenant_id\\)s\n$ openstack endpoint create --region RegionOne orchestration internal http://localhost:8004/v1/%\\(tenant_id\\)s\n$ openstack endpoint create --region RegionOne orchestration admin http://localhost:8004/v1/%\\(tenant_id\\)s\n\n$ openstack endpoint list\n+----------------------------------+-----------+--------------+---------------+---------+-----------+----------------------------------------+\n| ID                               | Region    | Service Name | Service Type  | Enabled | Interface | URL                                    |\n+----------------------------------+-----------+--------------+---------------+---------+-----------+----------------------------------------+\n| 1adf2772e85f4a0aae1ec5b540861774 | RegionOne | heat         | orchestration | True    | admin     | http://localhost:8004/v1/%(tenant_id)s |\n| 5899428b9a79485f9acafbba363c989e | RegionOne | keystone     | identity      | True    | internal  | http://localhost:5000/v3               |\n| 5a82d0a402e54500b90324a2f7d0d753 | RegionOne | heat         | orchestration | True    | public    | http://localhost:8004/v1/%(tenant_id)s |\n| 66e0ca3a69464f43bd5d122ac932b0ca | RegionOne | keystone     | identity      | True    | admin     | http://localhost:35357/v3              |\n| 7b15cd6b925540c09e0275298857703c | RegionOne | heat         | orchestration | True    | internal  | http://localhost:8004/v1/%(tenant_id)s |\n| b4929a1819aa4e79a05d7ed31fb76fa3 | RegionOne | keystone     | identity      | True    | public    | http://localhost:5000/v3               |\n+----------------------------------+-----------+--------------+---------------+---------+-----------+----------------------------------------+\n```\n- heat \u30c9\u30e1\u30a4\u30f3\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n```\n$ openstack domain create --description \"Stack projects and users\" heat\n+-------------+----------------------------------+\n| Field       | Value                            |\n+-------------+----------------------------------+\n| description | Stack projects and users         |\n| enabled     | True                             |\n| id          | 46bde267d7594cb496c79a25a00732e5 |\n| name        | heat                             |\n+-------------+----------------------------------+\n\n$ openstack domain list\n+----------------------------------+---------+---------+--------------------------+\n| ID                               | Name    | Enabled | Description              |\n+----------------------------------+---------+---------+--------------------------+\n| 46bde267d7594cb496c79a25a00732e5 | heat    | True    | Stack projects and users |\n| 4e41ddd4578a4370a9495885c723a887 | default | True    | Default Domain           |\n+----------------------------------+---------+---------+--------------------------+\n```\n- heat_domain_admin \u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n```\n$ openstack user create --domain heat --password-prompt heat_domain_admin\nUser Password:\nRepeat User Password:\n+-----------+----------------------------------+\n| Field     | Value                            |\n+-----------+----------------------------------+\n| domain_id | 46bde267d7594cb496c79a25a00732e5 |\n| enabled   | True                             |\n| id        | bcd781a873304501950e43348a6f35c5 |\n| name      | heat_domain_admin                |\n+-----------+----------------------------------+\n\n$ openstack user list\n+----------------------------------+-------------------+\n| ID                               | Name              |\n+----------------------------------+-------------------+\n| 5379653db96340c082a59ddc6d0765c5 | admin             |\n| 80e2489f9e2a4608a6aa02fe48f6069f | heat              |\n| bcd781a873304501950e43348a6f35c5 | heat_domain_admin |\n+----------------------------------+-------------------+\n```\n\n- admin \u30ed\u30fc\u30eb\u3092 heat \u30c9\u30e1\u30a4\u30f3\u306e heat_domain_admin \u30e6\u30fc\u30b6\u30fc\u306b\u8ffd\u52a0\u3057\u3001 heat_domain_admin \u30e6\u30fc\u30b6\u30fc\u304c\u30b9\u30bf\u30c3\u30af\u7ba1\u7406\u306e\u7ba1\u7406\u8005\u7279\u6a29\u3092\u6301\u3064\u3088\u3046\u306b\u3057\u307e\u3059\n\n```\n$ openstack role add --domain heat --user-domain heat --user heat_domain_admin admin\n```\n- heat_stack_owner \u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n```\n$ openstack role create heat_stack_owner\n+-----------+----------------------------------+\n| Field     | Value                            |\n+-----------+----------------------------------+\n| domain_id | None                             |\n| id        | 2ead0fa3aae246c8a5ccc5bba887e17d |\n| name      | heat_stack_owner                 |\n+-----------+----------------------------------+\n\n$ openstack role list\n+----------------------------------+------------------+\n| ID                               | Name             |\n+----------------------------------+------------------+\n| 2ead0fa3aae246c8a5ccc5bba887e17d | heat_stack_owner |\n| 381f499504944a429d1da9cde9eb1c4f | Member           |\n| a1f870faaa184908b32806f84a4d3b07 | admin            |\n+----------------------------------+------------------+\n```\n- demo \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n```\n$ openstack project create --domain default --description \"Demo Project\" demo\n+-------------+----------------------------------+\n| Field       | Value                            |\n+-------------+----------------------------------+\n| description | Demo Project                     |\n| domain_id   | 4e41ddd4578a4370a9495885c723a887 |\n| enabled     | True                             |\n| id          | ff3fa8d2f9334e60a845d1671b925b00 |\n| is_domain   | False                            |\n| name        | demo                             |\n| parent_id   | 4e41ddd4578a4370a9495885c723a887 |\n+-------------+----------------------------------+\n```\n- demo \u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n```\n$ openstack user create --domain default --password-prompt demo\nUser Password:\nRepeat User Password:\n+-----------+----------------------------------+\n| Field     | Value                            |\n+-----------+----------------------------------+\n| domain_id | 4e41ddd4578a4370a9495885c723a887 |\n| enabled   | True                             |\n| id        | 91c784e4100c4e4aaa64462173da01e8 |\n| name      | demo                             |\n+-----------+----------------------------------+\n```\n- user \u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n```\n$ openstack role create user\n+-----------+----------------------------------+\n| Field     | Value                            |\n+-----------+----------------------------------+\n| domain_id | None                             |\n| id        | d2375b8a11204866929406053a708900 |\n| name      | user                             |\n+-----------+----------------------------------+\n```\n- user \u30ed\u30fc\u30eb\u3092 demo \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3068 demo \u30e6\u30fc\u30b6\u30fc\u306b\u8ffd\u52a0\u3057\u307e\u3059\n\n```\n$ openstack role add --project demo --user demo user\n```\n\n- heat_stack_owner \u30ed\u30fc\u30eb\u3092 demo \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3068 demo \u30e6\u30fc\u30b6\u30fc\u306b\u8ffd\u52a0\u3057\u3001 demo \u30e6\u30fc\u30b6\u30fc\u304c\u30b9\u30bf\u30c3\u30af\u306e\u7ba1\u7406\u3092\u884c\u3048\u308b\u3088\u3046\u306b\u3057\u307e\u3059\n\n```\n$ openstack role add --project demo --user demo heat_stack_owner\n```\n- heat_stack_user \u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n```\n$ openstack role create heat_stack_user\n+-----------+----------------------------------+\n| Field     | Value                            |\n+-----------+----------------------------------+\n| domain_id | None                             |\n| id        | a3edcf6aab0b4fea996d2cbfa463bcb5 |\n| name      | heat_stack_user                  |\n+-----------+----------------------------------+\n```\n\n### (3) Heat\u52d5\u4f5c\u74b0\u5883\u3092\u6574\u5099\u3057\u307e\u3059\n\n```\n$ sudo vi /etc/heat/heat.conf\n```\n```text:/etc/heat/heat.conf\n[DEFAULT]\nrpc_backend = rabbit\nheat_metadata_server_url = http://localhost:8000\nheat_waitcondition_server_url = http://localhost:8000/v1/waitcondition\nstack_domain_admin = heat_domain_admin\nstack_domain_admin_password = secrete\nstack_user_domain_name = heat\ndebug = True\n\n[database]\nconnection = mysql://root:secrete@localhost/heat\n\n[keystone_authtoken]\nauth_uri = http://localhost:5000\nauth_url = http://localhost:35357\nmemcached_servers = localhost:11211\nauth_type = password\nproject_domain_name = default\nuser_domain_name = default\nproject_name = service\nusername = heat\npassword = secrete\n\n[trustee]\nauth_plugin = password\nauth_url = http://localhost:35357\nusername = heat\npassword = secrete\nuser_domain_name = default\n\n[clients_keystone]\nauth_uri = http://localhost:35357\n```\n- Keystone\u304c\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3057\u307e\u3059\n\n```\n$ vi $HOME/openstackrc_admin\n```\n```text:$HOME/openstackrc_admin\nexport OS_PROJECT_DOMAIN_NAME=default\nexport OS_USER_DOMAIN_NAME=default\nexport OS_PROJECT_NAME=admin\nexport OS_USERNAME=admin\nexport OS_PASSWORD=secrete\nexport OS_AUTH_URL=http://localhost:35357/v3\nexport OS_IDENTITY_API_VERSION=3\nexport OS_IMAGE_API_VERSION=2\n```\n```\n$ source openstackrc_admin\n```\n- Heat-engine\u52d5\u4f5c\u7528\u306b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\n\n```\n$ sudo /bin/sh -c \"heat-manage db_sync\"\n```\n- Heat\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\n\n```\n$ sudo service heat-api restart\n$ sudo service heat-engine restart\n```\n\n- Heat\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3059\n\n```\n$ heat-engine --version\n6.1.0\n\n$ heat-api --version\n6.1.0\n```\n\n# \u25a0 Heat\u74b0\u5883\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u5f8c\u306e\u57fa\u672c\u52d5\u4f5c\u78ba\u8a8d\n\u300cMitaka\u7248 Heat\u74b0\u5883\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u304c\u6b63\u3057\u304f\u5b8c\u4e86\u3067\u304d\u305f\u304b\uff1f\u300d\u3092\u3001\u624b\u8efd\u306b\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u672c\u6765\u3067\u3042\u308c\u3070\u3001Heat\u57fa\u672c\u52d5\u4f5c\u3092\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306b\u3001neutron\u7b49\u306e\u4ed6\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304f\u3079\u304d\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u306f\u3001\u305d\u306e\u624b\u9593\u3092\u7701\u304f\u624b\u9806\u3067\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n### (1) \u30c0\u30df\u30fc\u306aNetwork\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u3066\u307f\u308b\n\u4ee5\u524d\u3001Heat\u57fa\u672c\u52d5\u4f5c\u3092\u8abf\u67fb\u3057\u305f\u969b\u306b\u3001\u6d3b\u7528\u3057\u305f\u624b\u9806\u3092\u3001\u3053\u3053\u3067\u3082\u8a66\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n[\"Qiita\u8a18\u4e8b:OpenStack Heat\u57fa\u672c\u52d5\u4f5c\u3092\u8a66\u3057\u3066\u307f\u308b\"](http://qiita.com/ttsubo/items/92b41155fa8f6a639f2c)\n\n- heat-engine\u5185\u90e8\u3092\u6539\u9020\u3059\u308b\uff08\u30c0\u30df\u30fcneutron\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5316\uff09\n\n``` text:heat/engine/resources/openstack/neutron/net.py\n    def handle_create(self):\n        props = self.prepare_properties(\n            self.properties,\n            self.physical_resource_name())\n\n        dhcp_agent_ids = props.pop(self.DHCP_AGENT_IDS, None)\n#        qos_policy = props.pop(self.QOS_POLICY, None)\n#        if qos_policy:\n#            props['qos_policy_id'] = self.client_plugin().get_qos_policy_id(\n#                qos_policy)\n\n#        net = self.client().create_network({'network': props})['network']\n#        self.resource_id_set(net['id'])\n        self.resource_id_set('aaaaaaaa-aaaa-aaaaaaaae-aaaaaaaaaaaa')\n\n        if dhcp_agent_ids:\n            self._replace_dhcp_agents(dhcp_agent_ids)\n\n    def _show_resource(self):\n#        return self.client().show_network(\n#            self.resource_id)['network']\n        result = {\"status\": \"ACTIVE\", \"name\": \"Sample\", \"id\": \"aaaaaaa-aaaa-aaaaaaaae-aaaaaaaaaaaa\"}\n        return result\n\n    def check_create_complete(self, *args):\n        attributes = self._show_resource()\n        return self.is_built(attributes)\n\n    def handle_delete(self):\n        try:\n#            self.client().delete_network(self.resource_id)\n            pass\n        except Exception as ex:\n            self.client_plugin().ignore_not_found(ex)\n        else:\n            return True\n```\n\n- Heat\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\n\n```\n$ sudo service heat-engine restart\n```\n\n- neutron\u306e\u30b5\u30fc\u30d3\u30b9/\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n```\n$ openstack service create --name neutron --description \"OpenStack Networking\" network\n\n$ openstack endpoint create --region RegionOne network public http:localhost:9696\n$ openstack endpoint create --region RegionOne network internal http:localhost:9696\n$ openstack endpoint create --region RegionOne network admin http:localhost:9696\n```\n... neutron\u7528\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u4f5c\u6210\u305b\u305a\u306b\u3001network\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u6210\u3059\u308b\u3068\u3001\u6b21\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u3066\u3057\u307e\u3046\u307f\u305f\u3044\u3067\u3059(Juno\u7248\u3067\u306f\u3001network\u30ea\u30bd\u30fc\u30b9\u304c\u4f5c\u6210\u3067\u304d\u305f\u3093\u3067\u3059\u3051\u3069...)\n\n```\n$ openstack stack create --parameter sample_net_name=Sample --template sample.yaml Sample-Net-Stack\nERROR: HEAT-E99001 Service neutron is not available for resource type OS::Neutron::Net, reason: Service endpoint not in service catalog.\n```\n- \u4e8b\u524d\u306b\u3001heat-template\u3092\u914d\u7f6e\u3057\u3066\u304a\u304d\u307e\u3059\n\n```text:sample.yaml\nheat_template_version: 2013-05-23\n\ndescription: sample heat for neutron\n\nparameters:\n  sample_net_name:\n    type: string\n    description: Name of Sample network to be created\n    default: sample_network\n\nresources:\n  sample_net:\n    type: OS::Neutron::Net\n    properties:\n      name: { get_param: sample_net_name }\n\noutputs:\n  status:\n    description: status of sample_net\n    value: { get_attr: [ sample_net, status ] }\n```\n- openstack client\u304b\u3089\u3001Heat\u30b9\u30bf\u30c3\u30af\u3092\u4f5c\u6210\u3057\u3066\u307f\u307e\u3059\n\n```\n$ openstack stack create --parameter sample_net_name=Sample --template sample.yaml Sample-Net-Stack\n+---------------------+--------------------------------------+\n| Field               | Value                                |\n+---------------------+--------------------------------------+\n| id                  | b35fee5b-d622-4317-8f0b-d483a5bdf076 |\n| stack_name          | Sample-Net-Stack                     |\n| description         | sample heat for neutron              |\n| creation_time       | 2016-11-19T21:46:20                  |\n| updated_time        | None                                 |\n| stack_status        | CREATE_COMPLETE                      |\n| stack_status_reason | Stack CREATE completed successfully  |\n+---------------------+--------------------------------------+\n```\n- Heat\u30b9\u30bf\u30c3\u30af\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\n\n```\n$ openstack stack show Sample-Net-Stack\n+-----------------------+--------------------------------------------------------------------------------------------------------------------------------+\n| Field                 | Value                                                                                                                          |\n+-----------------------+--------------------------------------------------------------------------------------------------------------------------------+\n| id                    | b35fee5b-d622-4317-8f0b-d483a5bdf076                                                                                           |\n| stack_name            | Sample-Net-Stack                                                                                                               |\n| description           | sample heat for neutron                                                                                                        |\n| creation_time         | 2016-11-19T21:46:20                                                                                                            |\n| updated_time          | None                                                                                                                           |\n| stack_status          | CREATE_COMPLETE                                                                                                                |\n| stack_status_reason   | Stack CREATE completed successfully                                                                                            |\n| parameters            | OS::project_id: 6f1763f7643e4ee9bb2d2d9dd9bb0bc6                                                                               |\n|                       | OS::stack_id: b35fee5b-d622-4317-8f0b-d483a5bdf076                                                                             |\n|                       | OS::stack_name: Sample-Net-Stack                                                                                               |\n|                       | sample_net_name: Sample                                                                                                        |\n|                       |                                                                                                                                |\n| outputs               | - description: status of sample_net                                                                                            |\n|                       |   output_key: status                                                                                                           |\n|                       |   output_value: ACTIVE                                                                                                         |\n|                       |                                                                                                                                |\n| links                 | - href: http://localhost:8004/v1/6f1763f7643e4ee9bb2d2d9dd9bb0bc6/stacks/Sample-Net-Stack/b35fee5b-d622-4317-8f0b-d483a5bdf076 |\n|                       |   rel: self                                                                                                                    |\n|                       |                                                                                                                                |\n| disable_rollback      | True                                                                                                                           |\n| parent                | None                                                                                                                           |\n| tags                  | null                                                                                                                           |\n|                       | ...                                                                                                                            |\n|                       |                                                                                                                                |\n| stack_user_project_id | 7e4693e23d4945b4aae096c012b586d1                                                                                               |\n| capabilities          | []                                                                                                                             |\n| notification_topics   | []                                                                                                                             |\n| timeout_mins          | None                                                                                                                           |\n| stack_owner           | None                                                                                                                           |\n+-----------------------+--------------------------------------------------------------------------------------------------------------------------------+\n```\n\n- network\u30ea\u30bd\u30fc\u30b9\u306e\u72b6\u614b\u3082\u3001\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3059\n\n```\n$ openstack stack resource list Sample-Net-Stack\n+---------------+--------------------------------------+------------------+-----------------+---------------------+\n| resource_name | physical_resource_id                 | resource_type    | resource_status | updated_time        |\n+---------------+--------------------------------------+------------------+-----------------+---------------------+\n| sample_net    | aaaaaaaa-aaaa-aaaaaaaae-aaaaaaaaaaaa | OS::Neutron::Net | CREATE_COMPLETE | 2016-11-19T21:46:20 |\n+---------------+--------------------------------------+------------------+-----------------+---------------------+\n```\n- Heat\u30b9\u30bf\u30c3\u30af\u3092\u524a\u9664\u3057\u3066\u304a\u304d\u307e\u3059\n\n```\n$ openstack stack delete Sample-Net-Stack\nAre you sure you want to delete this stack(s) [y/N]? y\n```\n... Oops!\nHeat\u30b9\u30bf\u30c3\u30af\u524a\u9664\u304c\u5b8c\u4e86\u3057\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3063\u305f orz\n\n```\n$ openstack stack list\n+--------------------------------------+------------------+--------------------+---------------------+--------------+\n| ID                                   | Stack Name       | Stack Status       | Creation Time       | Updated Time |\n+--------------------------------------+------------------+--------------------+---------------------+--------------+\n| b35fee5b-d622-4317-8f0b-d483a5bdf076 | Sample-Net-Stack | DELETE_IN_PROGRESS | 2016-11-19T21:46:20 | None         |\n+--------------------------------------+------------------+--------------------+---------------------+--------------+\n```\n\n- \u4ed5\u65b9\u304c\u306a\u3044\u306e\u3067\u3001heat\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u518d\u69cb\u7bc9\u3057\u307e\u3059\n\n```\n$ sudo service heat-engine stop\n$ sudo service heat-api stop\n\n$ mysql -uroot -psecrete\n\nmysql> drop database heat;\nmysql> create database heat;\nmysql> exit\n\n$ sudo /bin/sh -c \"heat-manage db_sync\"\n\n$ sudo service heat-api start\n$ sudo service heat-engine start\n```\n\n\u3068\u308a\u3042\u3048\u305a\u3001Heat\u74b0\u5883\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u306f\u3001\u5b8c\u4e86\u3067\u304d\u307e\u3057\u305f\u3002\n\n# \u25a0 \u7d42\u308f\u308a\u306b ...\nHeat\u30b9\u30bf\u30c3\u30af\u304c\u3001\"DELETE_IN_PROGRESS\"\u3067\u6ede\u7559\u3057\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u3001Heat\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u518d\u69cb\u7bc9\u3059\u308b\u3053\u3068\u306a\u304f\u3001Heat\u30b9\u30bf\u30c3\u30af\u3092\u524a\u9664\u3059\u308b\u5bfe\u51e6\u65b9\u6cd5\u304c\u3001\u898b\u3064\u3051\u3089\u308c\u306a\u304b\u3063\u305f\u306e\u304c\u3001\u5fc3\u6b8b\u308a\u3067\u3059\u304c...\n", "tags": ["openstack", "Heat"]}