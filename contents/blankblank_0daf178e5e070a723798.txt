{"context": " More than 1 year has passed since last update.\n\n\u6982\u8981\nPlugin-X\u306fCocos2d-x\u3067C++\u3068Objective-C/Java\u306e\u9023\u643a\u3092\u7c21\u5358\u306b\u3059\u308b\u305f\u3081\u306e\u4ed5\u7d44\u307f\u3067\u3059\u3002\u4e00\u5ea6\u7d44\u307f\u8fbc\u3093\u3067\u3057\u307e\u3048\u3070\u4f3c\u305f\u3088\u3046\u306a\u30b0\u30eb\u30fc\u30b3\u30fc\u30c9\u3092\u66f8\u304b\u305a\u3001ObjC/Java\u3092\u66f8\u304f\u3060\u3051\u3067\u6a5f\u80fd\u3092\u8ffd\u52a0\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u306e\u304c\u7279\u5fb4\u3067\u3059\u3002\n\n\u30e1\u30ea\u30c3\u30c8\n\n\u4e00\u5ea6\u7d44\u307f\u8fbc\u3093\u3060\u3089\u4f3c\u305f\u3088\u3046\u306a\u632f\u308b\u821e\u3044\u306eSDK\u3092\u7d44\u307f\u8fbc\u3080\u306e\u304c\u697d\n\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u30d7\u30ed\u30c8\u30b3\u30eb\u3067\u8868\u73fe\u3067\u304d\u305d\u3046\u306a\u3089\u3001\u72ec\u81ea\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u3063\u3066\u8ffd\u52a0\u3059\u308b\u306e\u3082\u697d\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u518d\u5229\u7528\u6027\u304c\u9ad8\u3044\n\u516c\u5f0f\u304c\u4f5c\u3063\u3066\u308b\u4ed5\u7d44\u307f\n\n\n\u30c7\u30e1\u30ea\u30c3\u30c8\n\n\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u30d7\u30ed\u30c8\u30b3\u30eb\u3067\u8868\u73fe\u3067\u304d\u306a\u3044\u3053\u3068\u306f\u3084\u308a\u306b\u304f\u3044\n\u30a2\u30d7\u30ea\u306e\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u306e\u30e1\u30bd\u30c3\u30c9\u306b\u51e6\u7406\u3092\u5165\u308c\u305f\u3044\u5834\u5408\uff08onResume\u3067\u306a\u304fonStart\u306b\u5165\u308c\u305f\u3044\u5834\u5408\uff09\u306a\u3069\u3001\u304b\u3086\u3044\u3068\u3053\u308d\u306b\u624b\u304c\u5c4a\u304b\u306a\u3044\n\u516c\u5f0f\u304c\u3042\u307e\u308a\u6d3b\u767a\u3067\u306a\u3044\n\u4f7f\u3063\u3066\u308b\u4eba\u3092\u3042\u307e\u308a\u898b\u304b\u3051\u306a\u3044\n\n\n\u4ed5\u7d44\u307f\nPlugin-X\u306f\u30d7\u30ed\u30c8\u30b3\u30eb\u3068\u30d7\u30e9\u30b0\u30a4\u30f3\u304b\u3089\u6210\u3063\u3066\u3044\u307e\u3059\u3002\u30d7\u30ed\u30c8\u30b3\u30eb\u306b\u306f\u671f\u5f85\u3059\u308b\u632f\u308b\u821e\u3044\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u304a\u308a\u3001\u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u305d\u306e\u4e2d\u8eab\u3092\u6301\u3061\u307e\u3059\u3002\u4f8b\u3048\u3070\u5e83\u544a\u7528\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u5b9f\u88c5\u3057\u305fAdmob\u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\nplugin/protocols/include/ProtocolAds.h\n// \u5e83\u544a\u3092\u8868\u793a\u3059\u308b\u30e1\u30bd\u30c3\u30c9\nvoid showAds(TAdsInfo info, AdsPos pos = kPosCenter);\n\n// \u5e83\u544a\u3092\u975e\u8868\u793a\u306b\u3059\u308b\u30e1\u30bd\u30c3\u30c9\nvoid hideAds(TAdsInfo info);\n\n\n\nplugin/plugins/admob/proj.ios/AdsAdmob.h\n@interface AdsAdmob : NSObject <InterfaceAds> // ObjC\u5074\u3067\u306fInterfaceAds\u3068\u547c\u3070\u308c\u308b\n\n- (void) showAds: (NSMutableDictionary*) info position:(int) pos;\n- (void) hideAds: (NSMutableDictionary*) info;\n\n\n\nplugin/plugins/admob/proj.android/src/org/cocos2dx/plugin/AdsAdmob.java\npublic class AdsAdmob implements InterfaceAds { // Java\u5074\u3082\n\n    @Override\n    public void showAds(Hashtable<String, String> info, int pos) { ... }\n\n    @Override\n    public void hideAds(Hashtable<String, String> info) { ... }\n\n}\n\n\n\u516c\u5f0f\u306b\u6982\u8981\u56f3\u304c\u8f09\u3063\u3066\u3044\u307e\u3059\u3002\u73fe\u72b6\u3001Plugin-X\u3067\u306f\u6b21\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\n\n\u30d7\u30ed\u30c8\u30b3\u30eb\n\u7528\u9014\n\u4f8b\n\n\n\n\nAds\n\u5e83\u544a\nAdmob\n\n\nAnalytics\n\u5206\u6790\nFlurry\n\n\nIAP\n\u30a2\u30d7\u30ea\u5185\u8ab2\u91d1\n\n\n\nShare\n\u30b7\u30a7\u30a2\nTwitter\n\n\nSocial\n\u30b9\u30b3\u30a2\u30e9\u30f3\u30ad\u30f3\u30b0\u3001\u30a2\u30c1\u30fc\u30d6\u30e1\u30f3\u30c8\n\n\n\nUser\n\u30ed\u30b0\u30a4\u30f3\n\n\n\n\n\n\u5c0e\u5165\n\u30ea\u30dd\u30b8\u30c8\u30ea\u306fcocos2d-x/plugin-x\u3067\u3059\u3002Cocos2d-x\u672c\u4f53\u304b\u3089submodule\u3068\u3057\u3066\u53c2\u7167\u3055\u308c\u3066\u3044\u308b\u306e\u3067submodule update\u3067\u52dd\u624b\u306b\u5165\u3063\u3066\u304d\u307e\u3059\u3002cocos2d-x/plugin\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u5c55\u958b\u3055\u308c\u3066\u3044\u308c\u3070ok\u3067\u3059\u3002\n\niOS\u306b\u5b9f\u88c5\u3059\u308b\n\u307e\u305a\u306f\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u30ea\u30f3\u30af\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u3001Cocos Code IDE\u3067\u65b0\u898f\u4f5c\u6210\u3057\u305flua\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u524d\u63d0\u306b\u8a18\u8ff0\u3059\u308b\u306e\u3067\u3001\u30d1\u30b9\u7b49\u306f\u9069\u5b9c\u8aad\u307f\u66ff\u3048\u3066\u4e0b\u3055\u3044\u3002\n\nframeworks/cocos2d-x/plugin/protocols/proj.ios/PluginProtocol.xcodeproj\u3092\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\u30bf\u30fc\u30b2\u30c3\u30c8\u306e\u8a2d\u5b9a => Build Phases\u304b\u3089\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30ea\u30f3\u30af\u3057\u307e\u3059\u3002\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u8a2d\u5b9a => Build Settings\u304b\u3089\u30d8\u30c3\u30c0\u306e\u30d1\u30b9\u306bframeworks/cocos2d-x/plugin/protocols/include\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\u30ea\u30f3\u30ab\u30d5\u30e9\u30b0\u306b-ObjC\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\u3053\u306e\u5f71\u97ff\u3067cocos\u672c\u4f53\u304c\u30d3\u30eb\u30c9\u3067\u304d\u306a\u304f\u306a\u308b\u306e\u3067\u3001GameController.framework\u3082\u30ea\u30f3\u30af\u3057\u307e\u3059\uff08\u8a73\u7d30\uff09\u3002\n\n\n\n\u3053\u308c\u3067\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u30ea\u30f3\u30af\u306f\u5b8c\u4e86\u3067\u3059\u3002applicationDidFinishLaunching\u7b49\u3067\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u304c\u671f\u5f85\u901a\u308a\u306b\u52d5\u4f5c\u3059\u308c\u3070ok\u3067\u3059\u3002\n\nAppDelegate.cpp\n#include \"PluginManager.h\"\nusing namespace plugin;\n\n// ...\n\n    auto hoge = PluginManager::getInstance()->loadPlugin(\"hoge\");\n    if (!hoge) {\n        log(\"hoge\u3068\u3044\u3046\u540d\u524d\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u5b58\u5728\u3057\u306a\u3044\u306f\u305a\u306a\u306e\u3067NULL\u304c\u8fd4\u3063\u3066\u304d\u305f\u3089OK\");\n    }\n\n\n\u4e00\u5ea6\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u30ea\u30f3\u30af\u3057\u3066\u3057\u307e\u3048\u3070\u5404\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30ea\u30f3\u30af\u306f\u7c21\u5358\u3067\u3059\u3002\u3053\u3053\u3067\u306f\u4f8b\u3068\u3057\u3066Admob\u3092\u8ffd\u52a0\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u3068\u304d\u3068\u540c\u3058\u304f\u3001frameworks/cocos2d-x/plugin/plugins/admob/proj.ios/PluginAdmob.xcodeproj\u3092\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b\u8ffd\u52a0\u3057\u3066\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30ea\u30f3\u30af\u3057\u307e\u3059\u3002\n\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u3054\u3068\u306b\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u9069\u5b9c\u8ffd\u52a0\u3057\u307e\u3059\u3002Admob\u3060\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n\u3053\u308c\u3067Admob\u306e\u30ea\u30f3\u30af\u3082\u5b8c\u4e86\u3067\u3059\u3002\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u3067\u30d0\u30ca\u30fc\u5e83\u544a\u304c\u8868\u793a\u3055\u308c\u305f\u3089ok\u3067\u3059\u3002\n\nAppDelegate.cpp\n#include \"ProtocolAds.h\"\n\n// ...\n\n    auto admob = dynamic_cast<ProtocolAds*>(PluginManager::getInstance()->loadPlugin(\"AdsAdmob\"));\n    admob->setDebugMode(true);\n    TAdsDeveloperInfo devInfo;\n    devInfo[\"AdmobID\"] = \"your_admob_id\";\n    admob->configDeveloperInfo(devInfo);\n    TAdsInfo info;\n    info[\"AdmobType\"] = \"1\"; // banner\n    info[\"AdmobSizeEnum\"] = \"1\"; // banner\n    admob->showAds(info, ProtocolAds::AdsPos::kPosBottom);\n\n\n\nAndroid\u306b\u7d44\u307f\u8fbc\u3080\nAndroid\u306b\u7d44\u307f\u8fbc\u3080\u624b\u9806\u306f\u3084\u3084\u8907\u96d1\u3067\u3001\u3044\u304f\u3064\u304b\u306e\u88dc\u52a9\u30c4\u30fc\u30eb\u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3084\u3084\u53e4\u3044\u3067\u3059\u304c\u516c\u5f0f\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3082\u3042\u308a\u307e\u3059\u3002\n\n\nframeworks/cocos2d-x/plugin/tools\u4ee5\u4e0b\u306bpublish.sh\u304c\u3042\u308b\u306e\u3067\u4f7f\u3044\u305f\u3044\u30d7\u30e9\u30b0\u30a4\u30f3\u540d\u3092\u5f15\u6570\u306b\u3057\u3066\u5b9f\u884c\u3057\u307e\u3059\uff08\u5f15\u6570\u3092\u7701\u7565\u3059\u308b\u3068\u540c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306econfig.sh\u3067\u6307\u5b9a\u3055\u308c\u305f\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5168\u3066\u30d3\u30eb\u30c9\u3057\u307e\u3059\uff09\u3002\u521d\u56de\u5b9f\u884c\u6642\u306fandroid-ndk/sdk\u3068ant\u306e\u30d1\u30b9\u3092\u805e\u304b\u308c\u308b\u306e\u3067\u3001\u7b54\u3048\u308b\u3068\u30c4\u30fc\u30eb\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306benvironment.sh\u3068\u3057\u3066\u4fdd\u5b58\u3057\u3001\u6b21\u56de\u4ee5\u964d\u305d\u308c\u3092\u53c2\u7167\u3057\u307e\u3059\u3002\u6210\u529f\u3059\u308b\u3068frameworks/cocos2d-x/plugin/publish\u4ee5\u4e0b\u306b\u30d3\u30eb\u30c9\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n\n$ tools/publish.sh admob\n\n...\n\nPlease input the android-ndk path:\n/usr/local/opt/android-ndk\nGet ANDROID_NDK_ROOT=/usr/local/opt/android-ndk\n\nPlease input the andoid-sdk path:\n/usr/local/opt/android-sdk\nGet ANDROID_SDK_ROOT=/usr/local/opt/android-sdk\n\nPlease input the ant tool path(such as '/Users/MyAccount/tools/ant/bin'):\n/usr/local/opt/ant/bin\nGet ANT_PATH=/usr/local/opt/ant/bin\n\n\nJNI\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30ea\u30f3\u30af\u3057\u307e\u3059\u3002build-cfg.json\u3067ndk_module_path\u3092\u8ffd\u52a0\u3057\u3066Android.mk\u3067\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002\u307e\u305f\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u307e\u307e\u3060\u3068\u30d3\u30eb\u30c9\u304c\u901a\u3089\u306a\u3044\u7b87\u6240\u304c\u3042\u308b\u306e\u3067\u3001\u3064\u3044\u3067\u306bApplication.mk\u3082\u66f8\u304d\u63db\u3048\u3066\u304a\u304d\u307e\u3059\u3002\n\n\nframeworks/runtime-src/proj.android/build-cfg.json\n@@ -3,7 +3,8 @@\n         \"../../cocos2d-x\",\n         \"../../cocos2d-x/cocos/\",\n         \"../../cocos2d-x/external\",\n-        \"../../cocos2d-x/cocos/scripting\"\n+        \"../../cocos2d-x/cocos/scripting\",\n+        \"../../cocos2d-x/plugin/publish\"\n     ],\n     \"copy_resources\": [\n         {\n\n\n\nframeworks/runtime-src/proj.android/jni/Android.mk\n@@ -40,9 +40,10 @@ $(LOCAL_PATH)/../../Classes\n\n LOCAL_STATIC_LIBRARIES := curl_static_prebuilt\n\n-LOCAL_WHOLE_STATIC_LIBRARIES := cocos_lua_static\n+LOCAL_WHOLE_STATIC_LIBRARIES := cocos_lua_static PluginProtocolStatic\n\n include $(BUILD_SHARED_LIBRARY)\n\n $(call import-module,scripting/lua-bindings)\n+$(call import-module,protocols/android)\n\n\n\nframeworks/runtime-src/proj.android/jni/Application.mk\n@@ -1,4 +1,4 @@\n-APP_STL := c++_static\n+APP_STL := gnustl_static\n NDK_TOOLCHAIN_VERSION=clang\n\n APP_CPPFLAGS := -frtti -DCC_ENABLE_CHIPMUNK_INTEGRATION=1 -std=c++11 -fsigned-char\n\n\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u521d\u671f\u5316\u51e6\u7406\u3092\u66f8\u304d\u307e\u3059\u3002C++\u3068Java\u3067\u305d\u308c\u305e\u308c1\u7b87\u6240\u305a\u3064\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\n\n\nframeworks/runtime-src/proj.android/jni/lua/main.cpp\n@@ -4,6 +4,7 @@\n #include <jni.h>\n #include <android/log.h>\n #include \"ConfigParser.h\"\n+#include \"PluginJniHelper.h\"\n\n #define  LOG_TAG    \"main\"\n #define  LOGD(...)  __android_log_print(ANDROID_LOG_DEBUG,LOG_TAG,__VA_ARGS__)\n@@ -13,6 +14,7 @@ using namespace cocos2d;\n void cocos_android_app_init (JNIEnv* env, jobject thiz) {\n     LOGD(\"cocos_android_app_init\");\n     AppDelegate *pAppDelegate = new AppDelegate();\n+    PluginJniHelper::setJavaVM(JniHelper::getJavaVM());\n }\n\n extern \"C\"\n\n\n\nframeworks/runtime-src/proj.android/src/org/cocos2dx/lua/AppActivity.java\n@@ -33,6 +33,8 @@ import java.util.Enumeration;\n import java.util.ArrayList;\n\n import org.cocos2dx.lib.Cocos2dxActivity;\n+import org.cocos2dx.lib.Cocos2dxGLSurfaceView;\n+import org.cocos2dx.plugin.PluginWrapper;\n\n import android.app.AlertDialog;\n import android.content.Context;\n@@ -95,6 +97,18 @@ public class AppActivity extends Cocos2dxActivity{\n                }\n                hostIPAdress = getHostIpAddress();\n        }\n+\n+  @Override\n+  public Cocos2dxGLSurfaceView onCreateView() {\n+      Cocos2dxGLSurfaceView glSurfaceView = new Cocos2dxGLSurfaceView(this);\n+      PluginWrapper.init(this);\n+      PluginWrapper.setGLSurfaceView(glSurfaceView);\n+      return glSurfaceView;\n+  }\n+\n        private boolean isNetworkConnected() {\n                ConnectivityManager cm = (ConnectivityManager) getSystemService(Context.CONNECTIVITY_SERVICE);\n                if (cm != null) {\n\n\n\n\u6700\u5f8c\u306bjar\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002jar\u306fpublish\u6642\u306b\u540c\u6642\u306b\u4f5c\u3089\u308c\u3066\u3044\u308b\u306e\u3067\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b\u30b3\u30d4\u30fc\u3059\u308b\u3060\u3051\u3067ok\u3067\u3059\u3002\n\ncp frameworks/cocos2d-x/plugin/publish/protocols/android/libPluginProtocol.jar frameworks/runtime-src/proj.android/libs\n\niOS\u306e\u3068\u304d\u3068\u540c\u3058\u304f\u3001\u3053\u306e\u6642\u70b9\u3067\u4ee5\u4e0b\u306e\u69d8\u306a\u78ba\u8a8d\u30b3\u30fc\u30c9\u304c\u671f\u5f85\u901a\u308a\u52d5\u4f5c\u3059\u308c\u3070ok\u3067\u3059\u3002\n\nAppDelegate.cpp\n#include \"PluginManager.h\"\nusing namespace plugin;\n\n// ...\n\n    auto hoge = PluginManager::getInstance()->loadPlugin(\"hoge\");\n    if (!hoge) {\n        log(\"hoge\u3068\u3044\u3046\u540d\u524d\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u5b58\u5728\u3057\u306a\u3044\u306f\u305a\u306a\u306e\u3067NULL\u304c\u8fd4\u3063\u3066\u304d\u305f\u3089OK\");\n    }\n\n\n\u5f8c\u306fAdmob\u3092\u30ea\u30f3\u30af\u3055\u305b\u308b\u3060\u3051\u3067\u3059\u3002plugin-x\u304b\u3089Admob\u3092\u547c\u3073\u51fa\u3059\u5f62\u306b\u306a\u308b\u305f\u3081\u3001\u666e\u901a\u306bAndroid\u3067Admob\u3092\u4f7f\u3046\u305f\u3081\u306e\u8a2d\u5b9a\u304c\u5fc5\u8981\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u306f\u5272\u611b\u3057\u307e\u3059\u3002\u5177\u4f53\u7684\u306a\u624b\u9806\u306f\u516c\u5f0f\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u3042\u308a\u307e\u3059\u3002\n\nprotocol\u3068\u540c\u3058\u3088\u3046\u306bjar\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\ncp frameworks/cocos2d-x/plugin/publish/plugins/admob/android/*.jar frameworks/runtime-src/proj.android/libs\n\n\u3053\u308c\u3067iOS\u306e\u3068\u304d\u3068\u540c\u3058\u78ba\u8a8d\u30b3\u30fc\u30c9\u304c\u52d5\u4f5c\u3059\u308b\u306f\u305a\u3067\u3059\u3002\n\nAppDelegate.cpp\n#include \"ProtocolAds.h\"\n\n// ...\n\n    auto admob = dynamic_cast<ProtocolAds*>(PluginManager::getInstance()->loadPlugin(\"AdsAdmob\"));\n    admob->setDebugMode(true);\n    TAdsDeveloperInfo devInfo;\n    devInfo[\"AdmobID\"] = \"your_admob_id\";\n    admob->configDeveloperInfo(devInfo);\n    TAdsInfo info;\n    info[\"AdmobType\"] = \"1\"; // banner\n    info[\"AdmobSizeEnum\"] = \"1\"; // banner\n    admob->showAds(info, ProtocolAds::AdsPos::kPosBottom);\n\n\n\n\u30ab\u30b9\u30bf\u30e0\u30e1\u30bd\u30c3\u30c9\u306e\u547c\u3073\u51fa\u3057\nPlugin-X\u3067\u306f\u30d7\u30ed\u30c8\u30b3\u30eb\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u306a\u3044\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u51fa\u3059\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070Flurry\u3067\u306f\u5e74\u9f62\u3092\u8a2d\u5b9a\u3059\u308b\u305f\u3081\u306e\u5c02\u7528\u30e1\u30bd\u30c3\u30c9\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nframeworks/cocos2d-x/plugin/plugins/flurry/proj.ios/AnalyticsFlurry.m\n- (void) setAge: (NSNumber*) age\n{\n    int nAge = [age integerValue];\n    OUTPUT_LOG(@\"Flurry setAge invoked (%d)\", nAge);\n    [Flurry setAge:nAge];\n}\n\n\n\nframeworks/cocos2d-x/plugin/plugins/flurry/proj.android/src/org/cocos2dx/plugin/AnalyticsFlurry.java\n    protected void setAge(int age) {\n        LogD(\"setAge invoked!\");\n        final int curAge = age;\n        PluginWrapper.runOnMainThread(new Runnable() {\n            @Override\n            public void run() {\n                try {\n                    FlurryAgent.setAge(curAge);\n                } catch(Exception e){\n                    LogE(\"Exception in setAge\", e);\n                }\n            }\n        });\n    }\n\n\n\u3053\u308c\u3089\u306fcpp\u304b\u3089\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u547c\u3073\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nflurry = PluginManager::getInstance()->loadPlugin(\"AnalyticsFlurry\");\nPluginParam age(17);\nflurry->callFuncWithParam(\"setAge\", &age, NULL);\n\n\u623b\u308a\u5024\u3092\u53d7\u3051\u53d6\u308b\u5834\u5408callIntFuncWithParam\u3084callStringFuncWithParam\u306a\u3069\u304c\u4f7f\u3048\u307e\u3059\u3002\n\n\u521d\u671f\u5316\u3084\u30e1\u30bd\u30c3\u30c9\u547c\u3073\u51fa\u3057\u3092\u3057\u3066\u308b\u7b87\u6240\niOS\u3067\u306f\u305d\u308c\u305e\u308cNSClassFromString\u3068performSelector\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\nframeworks/cocos2d-x/plugin/protocols/platform/ios/PluginFactory.mm\nPluginProtocol* PluginFactory::createPlugin(const char* name)\n{\n\n...\n\n    NSString* className = [NSString stringWithUTF8String:name];\n    Class theClass = NSClassFromString(className);\n    if (theClass == nil)\n    {\n        PluginUtilsIOS::outputLog(\"Unable to load class '%s'. Did you add the -ObjC linker flag?\", name);\n        break;\n    }\n\n    id obj = [[NSClassFromString(className) alloc] init];\n\n...\n\n}\n\n\n\nframeworks/cocos2d-x/plugin/protocols/platform/ios/PluginUtilsIOS.mm\nvoid PluginUtilsIOS::callOCFunctionWithName(PluginProtocol* pPlugin, const char* funcName)\n{\n\n...\n\n    NSString* strFuncName = [NSString stringWithUTF8String:funcName];\n    SEL selector = NSSelectorFromString(strFuncName);\n    if ([pOCObj respondsToSelector:selector]) {\n        [pOCObj performSelector:selector];\n    } else {\n        outputLog(\"Can't find function '%s' in class '%s'\", [strFuncName UTF8String], pData->className.c_str());\n    }\n\n...\n\n}\n\n\nAndroid\u306fPluginFactory.cpp\u3067\u30d1\u30c3\u30b1\u30fc\u30b8\u540d\u3092\u6307\u5b9a\u3057\u3001Class.forName\u3067\u30af\u30e9\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u3057\u3066\u8ffd\u52a0\u3059\u308b\u30af\u30e9\u30b9\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u306forg/cocos2dx/plugin\u306b\u3057\u307e\u3059\u3002\u30e1\u30bd\u30c3\u30c9\u547c\u3073\u51fa\u3057\u306f\u3001\u305d\u3082\u305d\u3082JNI\u304c\u6587\u5b57\u5217\u304b\u3089java\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u51fa\u3059\u306e\u3067\u305d\u306e\u4ed5\u7d44\u307f\u3092\u305d\u306e\u307e\u307e\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\nframeworks/cocos2d-x/plugin/protocols/platform/android/PluginFactory.cpp\n#define ANDROID_PLUGIN_PACKAGE_PREFIX \"org/cocos2dx/plugin/\"\n\nPluginProtocol* PluginFactory::createPlugin(const char* name)\n{\n\n...\n\n    std::string jClassName = ANDROID_PLUGIN_PACKAGE_PREFIX;\n    jClassName.append(name);\n\n...\n\n}\n\n\n\nframeworks/cocos2d-x/plugin/protocols/proj.android/src/org/cocos2dx/plugin/PluginWrapper.java\nprotected static Object initPlugin(String classFullName)\n{\n\n...\n\n    // \u8aad\u307f\u3084\u3059\u304f\u3059\u308b\u305f\u3081\u4e00\u90e8\u6539\u5909\u3057\u3066\u3044\u307e\u3059\n    Class<?> c = null;\n    String fullName = classFullName.replace('/', '.');\n    c = Class.forName(fullName);\n    Context ctx = getContext();\n    Object o = c.getDeclaredConstructor(Context.class).newInstance(ctx);\n    return o;\n\n...\n\n}\n\n\n\nframeworks/cocos2d-x/plugin/protocols/platform/android/PluginUtils.h\nstatic void callJavaFunctionWithName(PluginProtocol* thiz, const char* funcName)\n{\n\n...\n\n    PluginJniMethodInfo t;\n    if (PluginJniHelper::getMethodInfo(t\n        , pData->jclassName.c_str()\n        , funcName\n        , \"()V\"))\n    {\n        t.env->CallVoidMethod(pData->jobj, t.methodID);\n        t.env->DeleteLocalRef(t.classID);\n    }\n}\n\n\n\n\u30ea\u30f3\u30af\n\nPlugin-X | Cocos2d-x\ncocos2d-x/plugin-x\nCocos2dx v3.0 \u3067 plugin-x / AdMob \u3092\u5229\u7528\u3059\u308b\n\n## \u6982\u8981\nPlugin-X\u306fCocos2d-x\u3067C++\u3068Objective-C/Java\u306e\u9023\u643a\u3092\u7c21\u5358\u306b\u3059\u308b\u305f\u3081\u306e\u4ed5\u7d44\u307f\u3067\u3059\u3002\u4e00\u5ea6\u7d44\u307f\u8fbc\u3093\u3067\u3057\u307e\u3048\u3070\u4f3c\u305f\u3088\u3046\u306a\u30b0\u30eb\u30fc\u30b3\u30fc\u30c9\u3092\u66f8\u304b\u305a\u3001ObjC/Java\u3092\u66f8\u304f\u3060\u3051\u3067\u6a5f\u80fd\u3092\u8ffd\u52a0\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u306e\u304c\u7279\u5fb4\u3067\u3059\u3002\n\n### \u30e1\u30ea\u30c3\u30c8\n* \u4e00\u5ea6\u7d44\u307f\u8fbc\u3093\u3060\u3089\u4f3c\u305f\u3088\u3046\u306a\u632f\u308b\u821e\u3044\u306eSDK\u3092\u7d44\u307f\u8fbc\u3080\u306e\u304c\u697d\n* \u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u30d7\u30ed\u30c8\u30b3\u30eb\u3067\u8868\u73fe\u3067\u304d\u305d\u3046\u306a\u3089\u3001\u72ec\u81ea\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u3063\u3066\u8ffd\u52a0\u3059\u308b\u306e\u3082\u697d\n* \u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u518d\u5229\u7528\u6027\u304c\u9ad8\u3044\n* \u516c\u5f0f\u304c\u4f5c\u3063\u3066\u308b\u4ed5\u7d44\u307f\n\n### \u30c7\u30e1\u30ea\u30c3\u30c8\n* \u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u30d7\u30ed\u30c8\u30b3\u30eb\u3067\u8868\u73fe\u3067\u304d\u306a\u3044\u3053\u3068\u306f\u3084\u308a\u306b\u304f\u3044\n* \u30a2\u30d7\u30ea\u306e\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u306e\u30e1\u30bd\u30c3\u30c9\u306b\u51e6\u7406\u3092\u5165\u308c\u305f\u3044\u5834\u5408\uff08onResume\u3067\u306a\u304fonStart\u306b\u5165\u308c\u305f\u3044\u5834\u5408\uff09\u306a\u3069\u3001\u304b\u3086\u3044\u3068\u3053\u308d\u306b\u624b\u304c\u5c4a\u304b\u306a\u3044\n* \u516c\u5f0f\u304c\u3042\u307e\u308a\u6d3b\u767a\u3067\u306a\u3044\n* \u4f7f\u3063\u3066\u308b\u4eba\u3092\u3042\u307e\u308a\u898b\u304b\u3051\u306a\u3044\n\n## \u4ed5\u7d44\u307f\nPlugin-X\u306f\u30d7\u30ed\u30c8\u30b3\u30eb\u3068\u30d7\u30e9\u30b0\u30a4\u30f3\u304b\u3089\u6210\u3063\u3066\u3044\u307e\u3059\u3002\u30d7\u30ed\u30c8\u30b3\u30eb\u306b\u306f\u671f\u5f85\u3059\u308b\u632f\u308b\u821e\u3044\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u304a\u308a\u3001\u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u305d\u306e\u4e2d\u8eab\u3092\u6301\u3061\u307e\u3059\u3002\u4f8b\u3048\u3070\u5e83\u544a\u7528\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u5b9f\u88c5\u3057\u305fAdmob\u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```cpp:plugin/protocols/include/ProtocolAds.h\n// \u5e83\u544a\u3092\u8868\u793a\u3059\u308b\u30e1\u30bd\u30c3\u30c9\nvoid showAds(TAdsInfo info, AdsPos pos = kPosCenter);\n\n// \u5e83\u544a\u3092\u975e\u8868\u793a\u306b\u3059\u308b\u30e1\u30bd\u30c3\u30c9\nvoid hideAds(TAdsInfo info);\n```\n```objc:plugin/plugins/admob/proj.ios/AdsAdmob.h\n@interface AdsAdmob : NSObject <InterfaceAds> // ObjC\u5074\u3067\u306fInterfaceAds\u3068\u547c\u3070\u308c\u308b\n\n- (void) showAds: (NSMutableDictionary*) info position:(int) pos;\n- (void) hideAds: (NSMutableDictionary*) info;\n```\n```java:plugin/plugins/admob/proj.android/src/org/cocos2dx/plugin/AdsAdmob.java\npublic class AdsAdmob implements InterfaceAds { // Java\u5074\u3082\n\n    @Override\n    public void showAds(Hashtable<String, String> info, int pos) { ... }\n\n    @Override\n    public void hideAds(Hashtable<String, String> info) { ... }\n\n}\n```\n\u516c\u5f0f\u306b[\u6982\u8981\u56f3](http://www.cocos2d-x.org/wiki/Plugin-X_Architecture)\u304c\u8f09\u3063\u3066\u3044\u307e\u3059\u3002\u73fe\u72b6\u3001Plugin-X\u3067\u306f\u6b21\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n| \u30d7\u30ed\u30c8\u30b3\u30eb | \u7528\u9014 | \u4f8b |\n|:-:|:-:|:-:|\n| Ads | \u5e83\u544a | Admob |\n| Analytics | \u5206\u6790 | Flurry |\n| IAP | \u30a2\u30d7\u30ea\u5185\u8ab2\u91d1 |\n| Share | \u30b7\u30a7\u30a2 | Twitter |\n| Social | \u30b9\u30b3\u30a2\u30e9\u30f3\u30ad\u30f3\u30b0\u3001\u30a2\u30c1\u30fc\u30d6\u30e1\u30f3\u30c8 |\n| User | \u30ed\u30b0\u30a4\u30f3 |\n\n## \u5c0e\u5165\n\u30ea\u30dd\u30b8\u30c8\u30ea\u306f[cocos2d-x/plugin-x](https://github.com/cocos2d-x/plugin-x)\u3067\u3059\u3002Cocos2d-x\u672c\u4f53\u304b\u3089submodule\u3068\u3057\u3066\u53c2\u7167\u3055\u308c\u3066\u3044\u308b\u306e\u3067`submodule update`\u3067\u52dd\u624b\u306b\u5165\u3063\u3066\u304d\u307e\u3059\u3002cocos2d-x/plugin\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u5c55\u958b\u3055\u308c\u3066\u3044\u308c\u3070ok\u3067\u3059\u3002\n\n## iOS\u306b\u5b9f\u88c5\u3059\u308b\n\u307e\u305a\u306f\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u30ea\u30f3\u30af\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u3001Cocos Code IDE\u3067\u65b0\u898f\u4f5c\u6210\u3057\u305flua\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u524d\u63d0\u306b\u8a18\u8ff0\u3059\u308b\u306e\u3067\u3001\u30d1\u30b9\u7b49\u306f\u9069\u5b9c\u8aad\u307f\u66ff\u3048\u3066\u4e0b\u3055\u3044\u3002\n\n1. `frameworks/cocos2d-x/plugin/protocols/proj.ios/PluginProtocol.xcodeproj`\u3092\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n![ss01.png](https://qiita-image-store.s3.amazonaws.com/0/2490/db549b3e-4208-7d0a-9303-5caab683993e.png)\n\n2. \u30bf\u30fc\u30b2\u30c3\u30c8\u306e\u8a2d\u5b9a => Build Phases\u304b\u3089\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30ea\u30f3\u30af\u3057\u307e\u3059\u3002\n![ss02.png](https://qiita-image-store.s3.amazonaws.com/0/2490/50aea0ad-891d-00dc-b01d-859b7f23fe3b.png)\n\n3. \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u8a2d\u5b9a => Build Settings\u304b\u3089\u30d8\u30c3\u30c0\u306e\u30d1\u30b9\u306b`frameworks/cocos2d-x/plugin/protocols/include`\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n![ss03.png](https://qiita-image-store.s3.amazonaws.com/0/2490/9417627d-bf6c-7164-c870-0b189ddc9455.png)\n\n4. \u30ea\u30f3\u30ab\u30d5\u30e9\u30b0\u306b-ObjC\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\u3053\u306e\u5f71\u97ff\u3067cocos\u672c\u4f53\u304c\u30d3\u30eb\u30c9\u3067\u304d\u306a\u304f\u306a\u308b\u306e\u3067\u3001GameController.framework\u3082\u30ea\u30f3\u30af\u3057\u307e\u3059\uff08[\u8a73\u7d30](http://stackoverflow.com/questions/24844766/linking-errors-when-adding-admob-to-ios-cocos2d-x-3-2)\uff09\u3002\n![ss04.png](https://qiita-image-store.s3.amazonaws.com/0/2490/aca28b96-861a-cd9c-afa1-f75347c431d6.png)\n![ss05.png](https://qiita-image-store.s3.amazonaws.com/0/2490/3091f473-9f10-15de-9f9a-6dc6aa6cad37.png)\n\n\u3053\u308c\u3067\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u30ea\u30f3\u30af\u306f\u5b8c\u4e86\u3067\u3059\u3002applicationDidFinishLaunching\u7b49\u3067\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u304c\u671f\u5f85\u901a\u308a\u306b\u52d5\u4f5c\u3059\u308c\u3070ok\u3067\u3059\u3002\n\n```cpp:AppDelegate.cpp\n#include \"PluginManager.h\"\nusing namespace plugin;\n\n// ...\n\n    auto hoge = PluginManager::getInstance()->loadPlugin(\"hoge\");\n    if (!hoge) {\n        log(\"hoge\u3068\u3044\u3046\u540d\u524d\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u5b58\u5728\u3057\u306a\u3044\u306f\u305a\u306a\u306e\u3067NULL\u304c\u8fd4\u3063\u3066\u304d\u305f\u3089OK\");\n    }\n```\n\u4e00\u5ea6\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u30ea\u30f3\u30af\u3057\u3066\u3057\u307e\u3048\u3070\u5404\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30ea\u30f3\u30af\u306f\u7c21\u5358\u3067\u3059\u3002\u3053\u3053\u3067\u306f\u4f8b\u3068\u3057\u3066Admob\u3092\u8ffd\u52a0\u3057\u3066\u307f\u307e\u3059\u3002\n\n1. \u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u3068\u304d\u3068\u540c\u3058\u304f\u3001`frameworks/cocos2d-x/plugin/plugins/admob/proj.ios/PluginAdmob.xcodeproj`\u3092\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b\u8ffd\u52a0\u3057\u3066\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30ea\u30f3\u30af\u3057\u307e\u3059\u3002\n![ss06.png](https://qiita-image-store.s3.amazonaws.com/0/2490/b279b39e-e3fc-8898-849e-cbb70817cf6f.png)\n![ss07.png](https://qiita-image-store.s3.amazonaws.com/0/2490/8df60f88-c61f-bad9-ee3e-f10e3fac304b.png)\n\n2. \u30d7\u30e9\u30b0\u30a4\u30f3\u3054\u3068\u306b\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u9069\u5b9c\u8ffd\u52a0\u3057\u307e\u3059\u3002Admob\u3060\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n![ss08.png](https://qiita-image-store.s3.amazonaws.com/0/2490/ec196dae-91e4-b6cd-0d24-78b7fec53170.png)\n\n\u3053\u308c\u3067Admob\u306e\u30ea\u30f3\u30af\u3082\u5b8c\u4e86\u3067\u3059\u3002\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u3067\u30d0\u30ca\u30fc\u5e83\u544a\u304c\u8868\u793a\u3055\u308c\u305f\u3089ok\u3067\u3059\u3002\n\n```cpp:AppDelegate.cpp\n#include \"ProtocolAds.h\"\n\n// ...\n\n    auto admob = dynamic_cast<ProtocolAds*>(PluginManager::getInstance()->loadPlugin(\"AdsAdmob\"));\n    admob->setDebugMode(true);\n    TAdsDeveloperInfo devInfo;\n    devInfo[\"AdmobID\"] = \"your_admob_id\";\n    admob->configDeveloperInfo(devInfo);\n    TAdsInfo info;\n    info[\"AdmobType\"] = \"1\"; // banner\n    info[\"AdmobSizeEnum\"] = \"1\"; // banner\n    admob->showAds(info, ProtocolAds::AdsPos::kPosBottom);\n```\n\n## Android\u306b\u7d44\u307f\u8fbc\u3080\nAndroid\u306b\u7d44\u307f\u8fbc\u3080\u624b\u9806\u306f\u3084\u3084\u8907\u96d1\u3067\u3001\u3044\u304f\u3064\u304b\u306e\u88dc\u52a9\u30c4\u30fc\u30eb\u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3084\u3084\u53e4\u3044\u3067\u3059\u304c\u516c\u5f0f\u306e[\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](http://www.cocos2d-x.org/wiki/Plugin-X_Integration_Guide_for_Android)\u3082\u3042\u308a\u307e\u3059\u3002\n\n* `frameworks/cocos2d-x/plugin/tools`\u4ee5\u4e0b\u306b`publish.sh`\u304c\u3042\u308b\u306e\u3067\u4f7f\u3044\u305f\u3044\u30d7\u30e9\u30b0\u30a4\u30f3\u540d\u3092\u5f15\u6570\u306b\u3057\u3066\u5b9f\u884c\u3057\u307e\u3059\uff08\u5f15\u6570\u3092\u7701\u7565\u3059\u308b\u3068\u540c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e`config.sh`\u3067\u6307\u5b9a\u3055\u308c\u305f\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5168\u3066\u30d3\u30eb\u30c9\u3057\u307e\u3059\uff09\u3002\u521d\u56de\u5b9f\u884c\u6642\u306fandroid-ndk/sdk\u3068ant\u306e\u30d1\u30b9\u3092\u805e\u304b\u308c\u308b\u306e\u3067\u3001\u7b54\u3048\u308b\u3068\u30c4\u30fc\u30eb\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b`environment.sh`\u3068\u3057\u3066\u4fdd\u5b58\u3057\u3001\u6b21\u56de\u4ee5\u964d\u305d\u308c\u3092\u53c2\u7167\u3057\u307e\u3059\u3002\u6210\u529f\u3059\u308b\u3068`frameworks/cocos2d-x/plugin/publish`\u4ee5\u4e0b\u306b\u30d3\u30eb\u30c9\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n\n```shell-session\n$ tools/publish.sh admob\n\n...\n\nPlease input the android-ndk path:\n/usr/local/opt/android-ndk\nGet ANDROID_NDK_ROOT=/usr/local/opt/android-ndk\n\nPlease input the andoid-sdk path:\n/usr/local/opt/android-sdk\nGet ANDROID_SDK_ROOT=/usr/local/opt/android-sdk\n\nPlease input the ant tool path(such as '/Users/MyAccount/tools/ant/bin'):\n/usr/local/opt/ant/bin\nGet ANT_PATH=/usr/local/opt/ant/bin\n```\n\n* JNI\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30ea\u30f3\u30af\u3057\u307e\u3059\u3002`build-cfg.json`\u3067ndk_module_path\u3092\u8ffd\u52a0\u3057\u3066`Android.mk`\u3067\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002\u307e\u305f\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u307e\u307e\u3060\u3068\u30d3\u30eb\u30c9\u304c\u901a\u3089\u306a\u3044\u7b87\u6240\u304c\u3042\u308b\u306e\u3067\u3001\u3064\u3044\u3067\u306b`Application.mk`\u3082\u66f8\u304d\u63db\u3048\u3066\u304a\u304d\u307e\u3059\u3002\n\n```diff:frameworks/runtime-src/proj.android/build-cfg.json\n@@ -3,7 +3,8 @@\n         \"../../cocos2d-x\",\n         \"../../cocos2d-x/cocos/\",\n         \"../../cocos2d-x/external\",\n-        \"../../cocos2d-x/cocos/scripting\"\n+        \"../../cocos2d-x/cocos/scripting\",\n+        \"../../cocos2d-x/plugin/publish\"\n     ],\n     \"copy_resources\": [\n         {\n```\n```diff:frameworks/runtime-src/proj.android/jni/Android.mk\n@@ -40,9 +40,10 @@ $(LOCAL_PATH)/../../Classes\n\n LOCAL_STATIC_LIBRARIES := curl_static_prebuilt\n\n-LOCAL_WHOLE_STATIC_LIBRARIES := cocos_lua_static\n+LOCAL_WHOLE_STATIC_LIBRARIES := cocos_lua_static PluginProtocolStatic\n\n include $(BUILD_SHARED_LIBRARY)\n\n $(call import-module,scripting/lua-bindings)\n+$(call import-module,protocols/android)\n```\n```diff:frameworks/runtime-src/proj.android/jni/Application.mk\n@@ -1,4 +1,4 @@\n-APP_STL := c++_static\n+APP_STL := gnustl_static\n NDK_TOOLCHAIN_VERSION=clang\n\n APP_CPPFLAGS := -frtti -DCC_ENABLE_CHIPMUNK_INTEGRATION=1 -std=c++11 -fsigned-char\n```\n\n* \u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u521d\u671f\u5316\u51e6\u7406\u3092\u66f8\u304d\u307e\u3059\u3002C++\u3068Java\u3067\u305d\u308c\u305e\u308c1\u7b87\u6240\u305a\u3064\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\n\n```diff:frameworks/runtime-src/proj.android/jni/lua/main.cpp\n@@ -4,6 +4,7 @@\n #include <jni.h>\n #include <android/log.h>\n #include \"ConfigParser.h\"\n+#include \"PluginJniHelper.h\"\n\n #define  LOG_TAG    \"main\"\n #define  LOGD(...)  __android_log_print(ANDROID_LOG_DEBUG,LOG_TAG,__VA_ARGS__)\n@@ -13,6 +14,7 @@ using namespace cocos2d;\n void cocos_android_app_init (JNIEnv* env, jobject thiz) {\n     LOGD(\"cocos_android_app_init\");\n     AppDelegate *pAppDelegate = new AppDelegate();\n+    PluginJniHelper::setJavaVM(JniHelper::getJavaVM());\n }\n\n extern \"C\"\n```\n```diff:frameworks/runtime-src/proj.android/src/org/cocos2dx/lua/AppActivity.java\n@@ -33,6 +33,8 @@ import java.util.Enumeration;\n import java.util.ArrayList;\n\n import org.cocos2dx.lib.Cocos2dxActivity;\n+import org.cocos2dx.lib.Cocos2dxGLSurfaceView;\n+import org.cocos2dx.plugin.PluginWrapper;\n\n import android.app.AlertDialog;\n import android.content.Context;\n@@ -95,6 +97,18 @@ public class AppActivity extends Cocos2dxActivity{\n                }\n                hostIPAdress = getHostIpAddress();\n        }\n+\n+  @Override\n+  public Cocos2dxGLSurfaceView onCreateView() {\n+      Cocos2dxGLSurfaceView glSurfaceView = new Cocos2dxGLSurfaceView(this);\n+      PluginWrapper.init(this);\n+      PluginWrapper.setGLSurfaceView(glSurfaceView);\n+      return glSurfaceView;\n+  }\n+\n        private boolean isNetworkConnected() {\n                ConnectivityManager cm = (ConnectivityManager) getSystemService(Context.CONNECTIVITY_SERVICE);\n                if (cm != null) {\n```\n\n* \u6700\u5f8c\u306bjar\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002jar\u306fpublish\u6642\u306b\u540c\u6642\u306b\u4f5c\u3089\u308c\u3066\u3044\u308b\u306e\u3067\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b\u30b3\u30d4\u30fc\u3059\u308b\u3060\u3051\u3067ok\u3067\u3059\u3002\n\n```shell-session\ncp frameworks/cocos2d-x/plugin/publish/protocols/android/libPluginProtocol.jar frameworks/runtime-src/proj.android/libs\n```\niOS\u306e\u3068\u304d\u3068\u540c\u3058\u304f\u3001\u3053\u306e\u6642\u70b9\u3067\u4ee5\u4e0b\u306e\u69d8\u306a\u78ba\u8a8d\u30b3\u30fc\u30c9\u304c\u671f\u5f85\u901a\u308a\u52d5\u4f5c\u3059\u308c\u3070ok\u3067\u3059\u3002\n\n```cpp:AppDelegate.cpp\n#include \"PluginManager.h\"\nusing namespace plugin;\n\n// ...\n\n    auto hoge = PluginManager::getInstance()->loadPlugin(\"hoge\");\n    if (!hoge) {\n        log(\"hoge\u3068\u3044\u3046\u540d\u524d\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u5b58\u5728\u3057\u306a\u3044\u306f\u305a\u306a\u306e\u3067NULL\u304c\u8fd4\u3063\u3066\u304d\u305f\u3089OK\");\n    }\n```\n\u5f8c\u306fAdmob\u3092\u30ea\u30f3\u30af\u3055\u305b\u308b\u3060\u3051\u3067\u3059\u3002plugin-x\u304b\u3089Admob\u3092\u547c\u3073\u51fa\u3059\u5f62\u306b\u306a\u308b\u305f\u3081\u3001\u666e\u901a\u306bAndroid\u3067Admob\u3092\u4f7f\u3046\u305f\u3081\u306e\u8a2d\u5b9a\u304c\u5fc5\u8981\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u306f\u5272\u611b\u3057\u307e\u3059\u3002\u5177\u4f53\u7684\u306a\u624b\u9806\u306f[\u516c\u5f0f\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](https://developers.google.com/mobile-ads-sdk/docs/)\u306b\u3042\u308a\u307e\u3059\u3002\n\n* protocol\u3068\u540c\u3058\u3088\u3046\u306bjar\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\n```shell-session\ncp frameworks/cocos2d-x/plugin/publish/plugins/admob/android/*.jar frameworks/runtime-src/proj.android/libs\n```\n\n\u3053\u308c\u3067iOS\u306e\u3068\u304d\u3068\u540c\u3058\u78ba\u8a8d\u30b3\u30fc\u30c9\u304c\u52d5\u4f5c\u3059\u308b\u306f\u305a\u3067\u3059\u3002\n\n```cpp:AppDelegate.cpp\n#include \"ProtocolAds.h\"\n\n// ...\n\n    auto admob = dynamic_cast<ProtocolAds*>(PluginManager::getInstance()->loadPlugin(\"AdsAdmob\"));\n    admob->setDebugMode(true);\n    TAdsDeveloperInfo devInfo;\n    devInfo[\"AdmobID\"] = \"your_admob_id\";\n    admob->configDeveloperInfo(devInfo);\n    TAdsInfo info;\n    info[\"AdmobType\"] = \"1\"; // banner\n    info[\"AdmobSizeEnum\"] = \"1\"; // banner\n    admob->showAds(info, ProtocolAds::AdsPos::kPosBottom);\n```\n\n## \u30ab\u30b9\u30bf\u30e0\u30e1\u30bd\u30c3\u30c9\u306e\u547c\u3073\u51fa\u3057\nPlugin-X\u3067\u306f\u30d7\u30ed\u30c8\u30b3\u30eb\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u306a\u3044\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u51fa\u3059\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070Flurry\u3067\u306f\u5e74\u9f62\u3092\u8a2d\u5b9a\u3059\u308b\u305f\u3081\u306e\u5c02\u7528\u30e1\u30bd\u30c3\u30c9\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```objc:frameworks/cocos2d-x/plugin/plugins/flurry/proj.ios/AnalyticsFlurry.m\n- (void) setAge: (NSNumber*) age\n{\n    int nAge = [age integerValue];\n    OUTPUT_LOG(@\"Flurry setAge invoked (%d)\", nAge);\n    [Flurry setAge:nAge];\n}\n```\n```java:frameworks/cocos2d-x/plugin/plugins/flurry/proj.android/src/org/cocos2dx/plugin/AnalyticsFlurry.java\n    protected void setAge(int age) {\n        LogD(\"setAge invoked!\");\n        final int curAge = age;\n        PluginWrapper.runOnMainThread(new Runnable() {\n            @Override\n            public void run() {\n                try {\n                    FlurryAgent.setAge(curAge);\n                } catch(Exception e){\n                    LogE(\"Exception in setAge\", e);\n                }\n            }\n        });\n    }\n```\n\u3053\u308c\u3089\u306fcpp\u304b\u3089\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u547c\u3073\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```cpp\nflurry = PluginManager::getInstance()->loadPlugin(\"AnalyticsFlurry\");\nPluginParam age(17);\nflurry->callFuncWithParam(\"setAge\", &age, NULL);\n```\n\u623b\u308a\u5024\u3092\u53d7\u3051\u53d6\u308b\u5834\u5408`callIntFuncWithParam`\u3084`callStringFuncWithParam`\u306a\u3069\u304c\u4f7f\u3048\u307e\u3059\u3002\n\n## \u521d\u671f\u5316\u3084\u30e1\u30bd\u30c3\u30c9\u547c\u3073\u51fa\u3057\u3092\u3057\u3066\u308b\u7b87\u6240\niOS\u3067\u306f\u305d\u308c\u305e\u308c`NSClassFromString`\u3068`performSelector`\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\n```objc++:frameworks/cocos2d-x/plugin/protocols/platform/ios/PluginFactory.mm\nPluginProtocol* PluginFactory::createPlugin(const char* name)\n{\n\n...\n\n    NSString* className = [NSString stringWithUTF8String:name];\n    Class theClass = NSClassFromString(className);\n    if (theClass == nil)\n    {\n        PluginUtilsIOS::outputLog(\"Unable to load class '%s'. Did you add the -ObjC linker flag?\", name);\n        break;\n    }\n\n    id obj = [[NSClassFromString(className) alloc] init];\n\n...\n\n}\n```\n```objc++:frameworks/cocos2d-x/plugin/protocols/platform/ios/PluginUtilsIOS.mm\nvoid PluginUtilsIOS::callOCFunctionWithName(PluginProtocol* pPlugin, const char* funcName)\n{\n\n...\n\n    NSString* strFuncName = [NSString stringWithUTF8String:funcName];\n    SEL selector = NSSelectorFromString(strFuncName);\n    if ([pOCObj respondsToSelector:selector]) {\n        [pOCObj performSelector:selector];\n    } else {\n        outputLog(\"Can't find function '%s' in class '%s'\", [strFuncName UTF8String], pData->className.c_str());\n    }\n\n...\n\n}\n```\nAndroid\u306f`PluginFactory.cpp`\u3067\u30d1\u30c3\u30b1\u30fc\u30b8\u540d\u3092\u6307\u5b9a\u3057\u3001`Class.forName`\u3067\u30af\u30e9\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u3057\u3066\u8ffd\u52a0\u3059\u308b\u30af\u30e9\u30b9\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u306f`org/cocos2dx/plugin`\u306b\u3057\u307e\u3059\u3002\u30e1\u30bd\u30c3\u30c9\u547c\u3073\u51fa\u3057\u306f\u3001\u305d\u3082\u305d\u3082JNI\u304c\u6587\u5b57\u5217\u304b\u3089java\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u51fa\u3059\u306e\u3067\u305d\u306e\u4ed5\u7d44\u307f\u3092\u305d\u306e\u307e\u307e\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\n```cpp:frameworks/cocos2d-x/plugin/protocols/platform/android/PluginFactory.cpp\n#define ANDROID_PLUGIN_PACKAGE_PREFIX \"org/cocos2dx/plugin/\"\n\nPluginProtocol* PluginFactory::createPlugin(const char* name)\n{\n\n...\n\n    std::string jClassName = ANDROID_PLUGIN_PACKAGE_PREFIX;\n    jClassName.append(name);\n\n...\n\n}\n```\n```java:frameworks/cocos2d-x/plugin/protocols/proj.android/src/org/cocos2dx/plugin/PluginWrapper.java\nprotected static Object initPlugin(String classFullName)\n{\n\n...\n\n    // \u8aad\u307f\u3084\u3059\u304f\u3059\u308b\u305f\u3081\u4e00\u90e8\u6539\u5909\u3057\u3066\u3044\u307e\u3059\n    Class<?> c = null;\n    String fullName = classFullName.replace('/', '.');\n    c = Class.forName(fullName);\n    Context ctx = getContext();\n    Object o = c.getDeclaredConstructor(Context.class).newInstance(ctx);\n    return o;\n\n...\n\n}\n```\n```cpp:frameworks/cocos2d-x/plugin/protocols/platform/android/PluginUtils.h\nstatic void callJavaFunctionWithName(PluginProtocol* thiz, const char* funcName)\n{\n\n...\n\n    PluginJniMethodInfo t;\n    if (PluginJniHelper::getMethodInfo(t\n        , pData->jclassName.c_str()\n        , funcName\n        , \"()V\"))\n    {\n        t.env->CallVoidMethod(pData->jobj, t.methodID);\n        t.env->DeleteLocalRef(t.classID);\n    }\n}\n```\n\n## \u30ea\u30f3\u30af\n* [Plugin-X | Cocos2d-x](http://www.cocos2d-x.org/wiki/Plugin-X)\n* [cocos2d-x/plugin-x](https://github.com/cocos2d-x/plugin-x)\n* [Cocos2dx v3.0 \u3067 plugin-x / AdMob \u3092\u5229\u7528\u3059\u308b](http://laboyukai.blogspot.jp/2014/06/cocos2dx-v30-plugin-x-admob.html)\n", "tags": ["cocos2d-x3.2"]}