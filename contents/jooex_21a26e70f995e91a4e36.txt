{"tags": ["Elasticsearch", "Ubuntu15.10"], "context": "elasticsearch\u5c11\u3057\u3055\u308f\u3063\u3066\u307f\u305f\u3068\u3044\u3046\u8a18\u4e8b\u3002\n\u74b0\u5883:ubuntu 15.10 / elasticsearch 2.2.0\nelasticsearch\u306f\u3001\u5168\u6587\u691c\u7d22\u30a8\u30f3\u30b8\u30f3\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3002\ncurl\u3067\u8981\u6c42\u3092\u51fa\u3059\u3068json\u3067\u8fd4\u3063\u3066\u304f\u308b\u3001\u3068\u3044\u3046\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30a4\u30b9\u306b\u3001\u30d7\u30e9\u30b0\u30a4\u30f3\u3082\u3042\u308a\u3001\u81ea\u52d5\u3067\u30af\u30e9\u30b9\u30bf\u69cb\u6210\u3082\u3067\u304d\u308b\u3068\u3001\u3044\u308d\u3044\u308d\u4fbf\u5229\u3067\u3059\u3054\u3044\u3002\n\ninstall\n\u307e\u305ajava\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\u6b21\u306belasticsearch\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\u516c\u5f0f\u30b5\u30a4\u30c8\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u30da\u30fc\u30b8\u304b\u3089\u30b3\u30d4\u30dahttps://www.elastic.co/guide/en/elasticsearch/reference/current/setup-repositories.html\nwget -qO - https://packages.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add\n\necho \"deb http://packages.elastic.co/elasticsearch/2.x/debian stable main\" | sudo tee -a /etc/apt/sources.list.d/elasticsearch-2.x.list\n\nsudo apt-get update && sudo apt-get install elasticsearch\n\n\n\u8d77\u52d5\n\u30b3\u30de\u30f3\u30c9\u3067\u8d77\u52d5\u3002\nsudo /etc/init.d/elasticsearch start\nsudo /etc/init.d/elasticsearch restart\n\n\n\nplugin\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nelasticsearch\u306b\u306f\u3001plugin\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30b3\u30de\u30f3\u30c9\u3082\u6700\u521d\u304b\u3089\u4ed8\u3044\u3066\u308b\u3002\nplugin\u306f\u3044\u308d\u3044\u308d\u516c\u958b\u3055\u308c\u3066\u3044\u3066\u3001\u65e5\u672c\u8a9e\u5168\u6587\u691c\u7d22\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u308a\u3059\u308b\u3002\nanalysis-kuromoji\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306b\u306f\nsudo /usr/share/elasticsearch/bin/plugin install analysis-kuromoji\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u8a2d\u5b9a\u306f\u5f8c\u8ff0\u3002\n\n\u3068\u308a\u3042\u3048\u305a\u4eca\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\u30af\u30e9\u30b9\u30bf\u3001\u30ce\u30fc\u30c9\u3001\u3068\u3044\u3063\u305f\u5358\u8a9e\u304c\u51fa\u3066\u304f\u308b\u3002\n\u30af\u30e9\u30b9\u30bf\u3068\u3044\u3046\u306e\u304c\u3042\u3063\u3066\u3001\u30af\u30e9\u30b9\u30bf\u306fnode\u3068\u3044\u3046\u3082\u306e\u306e\u96c6\u307e\u308a\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\u540c\u3058\u30af\u30e9\u30b9\u30bf\u540d\u304c\u4ed8\u3044\u305felasticsearch\u304c\u52d5\u304f\u74b0\u5883\uff08node\uff09\u3092\u7e4b\u3052\u308b\u3068\u3001\u81ea\u52d5\u3067\u30af\u30e9\u30b9\u30bf\u69cb\u6210\u3067\u52d5\u304f\u3002\nelasticsearch\u306e\u72b6\u614b\u3092\u78ba\u8a8d\ncurl -XGET http://localhost:9200/  \n\nindex\u306e\u78ba\u8a8d\ncurl 'localhost:9200/_cat/indices?v'\n\nnode\u306e\u72b6\u6cc1\u3092\u78ba\u8a8d\ncurl 'localhost:9200/_cat/nodes?v'\n\n\u30af\u30e9\u30b9\u30bf\u306e\u72b6\u614b\u3092\u78ba\u8a8d\uff08_cat api\u3068\u3044\u3046api\uff09\ncurl 'localhost:9200/_cat/health?v'\n\n\n\u30d6\u30e9\u30a6\u30b6\u3067\u72b6\u614b\u306e\u78ba\u8a8d\u3092\u3059\u308b\n\u30d6\u30e9\u30a6\u30b6\u3067\u78ba\u8a8d\u3067\u304d\u308b\u307b\u3046\u304c\u4fbf\u5229\u3060\u3002\nmobz/elasticsearch-head\u3068\u3044\u3046\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5165\u308c\u308b\u3068\u30d6\u30e9\u30a6\u30b6\u3067\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo /usr/share/elasticsearch/bin/plugin install mobz/elasticsearch-head\n\n\n\u305d\u3057\u3066http://localhost:9200/_plugin/head\u306b\u30d6\u30e9\u30a6\u30b6\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n\n\u8a2d\u5b9a\u3092\u884c\u3046\n\u8a2d\u5b9a\u306e\u5909\u3048\u65b9\u306f\u3044\u304f\u3064\u304b\u3042\u3063\u3066\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304d\u63db\u3048\u308b\u65b9\u6cd5\u3001mapping\u6642\u306b\u8a2d\u5b9a\u3059\u308b\u65b9\u6cd5\u3001\u8d77\u52d5\u6642\u306b\u6307\u5b9a\u3059\u308b\u65b9\u6cd5\u304c\u3042\u308b\u3002\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u8a2d\u5b9a\u3059\u308b\u3002\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f/etc/elasticsearch/elasticsearch.yml\u3068\u3044\u3063\u305f\u3068\u3053\u308d\u306b\u3042\u308b\u3002\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u3066\u307f\u308b\u3002\ncluster.name: my-application\nnode.name: node-1\nindex.number_of_shards: 1\nindex.number_of_replicas: 0\nindex.analysis.analyzer.default.type: custom\nindex.analysis.analyzer.default.tokenizer: kuromoji_tokenizer\n\n\u30af\u30e9\u30b9\u30bf\u306e\u540d\u524d\u3001\u30ce\u30fc\u30c9\u306e\u540d\u524d\u3001shard\u306e\u6570\u3001replica\u306e\u6570\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u30a2\u30ca\u30e9\u30a4\u30b6\u30fc\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u3044\u308b\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u30a2\u30ca\u30e9\u30a4\u30b6\u30fc\u3092kuromoji\u306b\u6307\u5b9a\u3057\u3066\u304a\u304f\u3068\u3001\u3068\u308a\u3042\u3048\u305a\u52dd\u624b\u306b\u65e5\u672c\u8a9e\u5168\u6587\u691c\u7d22\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\u5b9f\u969b\u306e\u30d7\u30ed\u30c0\u30af\u30c8\u306b\u306a\u308b\u3068\u3001\u30d5\u30a3\u30fc\u30eb\u30c9\u6bce\u306b\u7d30\u304b\u3044\u8a2d\u5b9a\u304c\u5fc5\u8981\u306b\u306a\u308b\u306e\u3067\u3001mapping\u3067\u8a2d\u5b9a\u3059\u308b\u3002\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304d\u63db\u3048\u305f\u3089elasticsearch\u3092\u518d\u8d77\u52d5\u3057\u53cd\u6620\u3055\u305b\u308b\u3002\n\nmapping\n\u30b9\u30ad\u30fc\u30de\u5b9a\u7fa9\u306e\u3088\u3046\u306a\u3082\u306e\u3067\u3001tokenizer\u306e\u8a2d\u5b9a\u3092\u884c\u3063\u305f\u308a\u3001\u30d5\u30a3\u30fc\u30eb\u30c9\u6bce\u306b\u578b\u3084\u691c\u7d22\u306e\u8a2d\u5b9a\u3092\u3067\u304d\u308b\u3002\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u9001\u308b\u3002\u5358\u7d14\u306bstring\u578b\u3060\u3068\u8a2d\u5b9a\u3057\u305f\u4f8b\u3002\ncurl -XPOST localhost:9200/tutorial -d '{\n    \"mappings\" : {\n        \"helloworld\" : {\n            \"properties\" : {\n                \"message\" : {\n                  \"type\" : \"string\"\n                  },\n                \"name\" : {\n                  \"type\" : \"string\"\n                }\n            }\n        }\n    }\n}'\n\n\u30a2\u30ca\u30e9\u30a4\u30b6\u30fc\u3084\u3001\u691c\u7d22\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u3044\u304f\u3068\u3001\u5404\u30ec\u30b3\u30fc\u30c9\u3054\u3068\u306b\n\u5bff\u53f8\u304c\u304a\u3044\u3057\u3044\u306d->\u5bff\u53f8\u3000\u304a\u3044\u3057\u3044\n\u98f2\u307f->\u98f2\u3080\n\u5bff\u53f8->\u30b9\u30b7\n\u30b5\u30fc\u30d0\u30fc->\u30b5\u30fc\u30d0\n\u3068\u3044\u3063\u305f\u30d2\u30c3\u30c8\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\nmapping\u306e\u78ba\u8a8d\u3002index\u304ctutorial\u3067type\u304chelloworld\u306e\u5834\u5408\ncurl -XGET 'localhost:9200/tutorial/_mapping/helloworld/?pretty'\n\n\nindex\u3067\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3059\u308b\nindex\u3068\u3044\u3046\u306e\u3067\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3067\u304d\u308b\u3002\nindex,type,document\u3000\u3068\u3044\u3063\u305f\u5358\u8a9e\u304c\u51fa\u3066\u304d\u3066\u3001\nindex/type/document\u3068\u3044\u3046\u69cb\u9020\u306b\u306a\u3063\u3066\u3044\u308b\u3002\nindex\u540d\u3092tutorial,type\u3092helloworld,document\u3092\uff5bmessage\u3001name\uff5d\u3068\u3044\u3046\u30c7\u30fc\u30bf\u69cb\u9020\u3067\u4fdd\u5b58\u3059\u308b\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3059\u308b\u3002\n\uff08elastic\u306f\u3001mapping\u3092\u884c\u308f\u306a\u304f\u3066\u3082\u3001\u30c7\u30fc\u30bf\u3092\u9001\u308b\u3068\u81ea\u52d5\u3067\u578b\u3092\u3064\u3051\u308b\u3002\u8a2d\u5b9a\u3067\u3057\u306a\u3044\u3088\u3046\u306b\u3067\u304d\u308b\uff09\ncurl -X POST 'http://localhost:9200/tutorial/helloworld/' -d '{ \"message\": \"Hello World! \u3053\u3093\u306b\u3061\u306f\uff01\" ,\"name\" : \"hoge\"}'\n\n\n\u30d6\u30e9\u30a6\u30b6\u3067\u3082\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\u307e\u305findex\u5168\u4f53\u3092\u524a\u9664\u3059\u308b\u306b\u306f\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\ncurl -XDELETE 'localhost:9200/tutorial?pretty'\nDB\u306e\u4e2d\u8eab\u5168\u90e8\u5168\u6d88\u3057\u3059\u308b\u306b\u306f\ncurl -XDELETE 'http://localhost:9200/*' {\"acknowledged\":true}%\n\nquery\n\u30af\u30a8\u30ea\u3002\n\u6587\u5b57\u5217\u304c\u5b8c\u5168\u4e00\u81f4\u3059\u308b\u3082\u306e\u3092\u63a2\u3059\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3059\u308b\u3002\npython\u306eelasticsearch\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u4f7f\u3063\u3066\u3044\u308b\u3002\n# -*- coding:utf-8 -*-\nfrom elasticsearch import Elasticsearch\nimport json\nes = Elasticsearch(\"localhost:9200\")\n\nmatchstring = es.search(index=\"tutorial\",\n                        doc_type=\"helloworld\",\n                        body={\n                            \"query\" : {\n                                \"match\" : {\n                                    \"name\" : \"hoge\"\n                                }\n                            }\n                        })\n\nsimple_query_string\u3068\u3044\u3046\u6587\u5b57\u5217\u691c\u7d22\u7528\u306e\u4fbf\u5229\u95a2\u6570\u3092\u4f7f\u3063\u305f\u5834\u5408\u3002\nsimpleString = es.search(index=\"tutorial\",\n                         doc_type=\"helloworld\",\n                         body={\n                            \"query\" : {\n                                \"simple_query_string\" :{\n                                    \"query\" : \"\u3053\u3093\u306b\u3061\u306f\",\n                                    \"fields\" : [\"message\"]\n                                }\n                            }\n                         })\n\nand,or,\u3092\u884c\u3046\u306b\u306f\u3001must,should,\u3068\u3044\u3046\u30af\u30a8\u30ea\u3092\u4f7f\u3046\u3089\u3057\u3044\u3002\nname in \"hoge\" && message in \"Hello\" \u306f\u3053\u3046\u3063\u307d\u3044\u3002\nqueryBool = es.search(index=\"tutorial\",\n                      doc_type=\"helloworld\",\n                      body={\n                        \"query\":{\n                            \"bool\":{\n                                \"must\":{\n                                    \"must\":{\n                                        \"term\" : {\n                                            \"name\" : \"hoge\"\n                                        }\n                                    },\n                                    \"term\" : {\n                                        \"message\" : \"Hello\"\n                                    }\n                                }\n                            }\n                        }\n                      })\n\n\n\u4ed6\u306b\u3082filter\u3084\u96c6\u8a08\u7cfb\u306e\u30af\u30a8\u30ea\u304c\u3042\u308b\u3002\n\u30af\u30a8\u30ea\u3092\u3064\u304b\u3046\u3068\u30b9\u30b3\u30a2\u3092\u4f7f\u3063\u305f\u691c\u7d22\u3082\u3067\u304d\u308b\u3088\u3046\u3060\u3002\n\n\u53c2\u8003\u30fb\u767a\u5c55\nElasticsearch\u306e\u6982\u5ff5\u3092\u77e5\u308b\nhttp://blog.shibayu36.org/entry/2015/07/08/095838\nElasticsearch\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\nhttp://code46.hatenablog.com/entry/2014/01/21/115620\nelastic\u5b9f\u8df5\u7684\u8a2d\u5b9a\u3068\u30af\u30a8\u30ea\nhttp://engineer.wantedly.com/2014/02/25/elasticsearch-at-wantedly-1.html\nkuromoji_tokenizer\u306e\u8a2d\u5b9a\nhttps://github.com/elastic/elasticsearch-analysis-kuromoji\nElasticSearch\u306e\u30a2\u30ca\u30e9\u30a4\u30b6\u306e\u8a2d\u5b9a\nhttp://christina04.hatenablog.com/entry/2015/02/02/225734\npython\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067\u59cb\u3081\u308b\u300c\u306f\u3058\u3081\u3066\u306eElasticsearch\u300d\nhttp://qiita.com/ikawaha/items/c654f746cfe76b888a27\nElasticsearch\u3068kuromoji\u3067\u3061\u3083\u3093\u3068\u3057\u305f\u65e5\u672c\u8a9e\u5168\u6587\u691c\u7d22\u3092\u3084\u308b\u30e1\u30e2\nhttp://tech.gmo-media.jp/post/70245090007/elasticsearch-kuromoji-japanese-fulltext-search\n\nelasticsearch\u5c11\u3057\u3055\u308f\u3063\u3066\u307f\u305f\u3068\u3044\u3046\u8a18\u4e8b\u3002\n\n\u74b0\u5883:ubuntu 15.10 / elasticsearch 2.2.0\n\nelasticsearch\u306f\u3001\u5168\u6587\u691c\u7d22\u30a8\u30f3\u30b8\u30f3\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3002\ncurl\u3067\u8981\u6c42\u3092\u51fa\u3059\u3068json\u3067\u8fd4\u3063\u3066\u304f\u308b\u3001\u3068\u3044\u3046\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30a4\u30b9\u306b\u3001\u30d7\u30e9\u30b0\u30a4\u30f3\u3082\u3042\u308a\u3001\u81ea\u52d5\u3067\u30af\u30e9\u30b9\u30bf\u69cb\u6210\u3082\u3067\u304d\u308b\u3068\u3001\u3044\u308d\u3044\u308d\u4fbf\u5229\u3067\u3059\u3054\u3044\u3002\n\n#install\n\n\u307e\u305ajava\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\n\u6b21\u306belasticsearch\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\n\u516c\u5f0f\u30b5\u30a4\u30c8\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u30da\u30fc\u30b8\u304b\u3089\u30b3\u30d4\u30dahttps://www.elastic.co/guide/en/elasticsearch/reference/current/setup-repositories.html\n\n```\nwget -qO - https://packages.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add\n\necho \"deb http://packages.elastic.co/elasticsearch/2.x/debian stable main\" | sudo tee -a /etc/apt/sources.list.d/elasticsearch-2.x.list\n\nsudo apt-get update && sudo apt-get install elasticsearch\n```\n\n#\u8d77\u52d5\n\n\u30b3\u30de\u30f3\u30c9\u3067\u8d77\u52d5\u3002\n\n```\nsudo /etc/init.d/elasticsearch start\nsudo /etc/init.d/elasticsearch restart\n\n```\n#plugin\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nelasticsearch\u306b\u306f\u3001plugin\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30b3\u30de\u30f3\u30c9\u3082\u6700\u521d\u304b\u3089\u4ed8\u3044\u3066\u308b\u3002\nplugin\u306f\u3044\u308d\u3044\u308d\u516c\u958b\u3055\u308c\u3066\u3044\u3066\u3001\u65e5\u672c\u8a9e\u5168\u6587\u691c\u7d22\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u308a\u3059\u308b\u3002\n\nanalysis-kuromoji\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306b\u306f\n\n```\nsudo /usr/share/elasticsearch/bin/plugin install analysis-kuromoji\n```\n\u30d7\u30e9\u30b0\u30a4\u30f3\u8a2d\u5b9a\u306f\u5f8c\u8ff0\u3002\n\n#\u3068\u308a\u3042\u3048\u305a\u4eca\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\n\u30af\u30e9\u30b9\u30bf\u3001\u30ce\u30fc\u30c9\u3001\u3068\u3044\u3063\u305f\u5358\u8a9e\u304c\u51fa\u3066\u304f\u308b\u3002\n\u30af\u30e9\u30b9\u30bf\u3068\u3044\u3046\u306e\u304c\u3042\u3063\u3066\u3001\u30af\u30e9\u30b9\u30bf\u306fnode\u3068\u3044\u3046\u3082\u306e\u306e\u96c6\u307e\u308a\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\u540c\u3058\u30af\u30e9\u30b9\u30bf\u540d\u304c\u4ed8\u3044\u305felasticsearch\u304c\u52d5\u304f\u74b0\u5883\uff08node\uff09\u3092\u7e4b\u3052\u308b\u3068\u3001\u81ea\u52d5\u3067\u30af\u30e9\u30b9\u30bf\u69cb\u6210\u3067\u52d5\u304f\u3002\n\nelasticsearch\u306e\u72b6\u614b\u3092\u78ba\u8a8d\n\n```\ncurl -XGET http://localhost:9200/  \n```\n\nindex\u306e\u78ba\u8a8d\n\n```\ncurl 'localhost:9200/_cat/indices?v'\n```\n\nnode\u306e\u72b6\u6cc1\u3092\u78ba\u8a8d\n\n```\ncurl 'localhost:9200/_cat/nodes?v'\n```\n\n\u30af\u30e9\u30b9\u30bf\u306e\u72b6\u614b\u3092\u78ba\u8a8d\uff08\\_cat api\u3068\u3044\u3046api\uff09\n\n```\ncurl 'localhost:9200/_cat/health?v'\n```\n\n\n##\u30d6\u30e9\u30a6\u30b6\u3067\u72b6\u614b\u306e\u78ba\u8a8d\u3092\u3059\u308b\n\u30d6\u30e9\u30a6\u30b6\u3067\u78ba\u8a8d\u3067\u304d\u308b\u307b\u3046\u304c\u4fbf\u5229\u3060\u3002\nmobz/elasticsearch-head\u3068\u3044\u3046\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5165\u308c\u308b\u3068\u30d6\u30e9\u30a6\u30b6\u3067\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\nsudo /usr/share/elasticsearch/bin/plugin install mobz/elasticsearch-head\n\n```\n\u305d\u3057\u3066``http://localhost:9200/_plugin/head``\u306b\u30d6\u30e9\u30a6\u30b6\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n\n#\u8a2d\u5b9a\u3092\u884c\u3046\n\n\u8a2d\u5b9a\u306e\u5909\u3048\u65b9\u306f\u3044\u304f\u3064\u304b\u3042\u3063\u3066\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304d\u63db\u3048\u308b\u65b9\u6cd5\u3001mapping\u6642\u306b\u8a2d\u5b9a\u3059\u308b\u65b9\u6cd5\u3001\u8d77\u52d5\u6642\u306b\u6307\u5b9a\u3059\u308b\u65b9\u6cd5\u304c\u3042\u308b\u3002\n\n##\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u8a2d\u5b9a\u3059\u308b\u3002\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f``/etc/elasticsearch/elasticsearch.yml``\u3068\u3044\u3063\u305f\u3068\u3053\u308d\u306b\u3042\u308b\u3002\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u3066\u307f\u308b\u3002\n\n```\ncluster.name: my-application\nnode.name: node-1\nindex.number_of_shards: 1\nindex.number_of_replicas: 0\nindex.analysis.analyzer.default.type: custom\nindex.analysis.analyzer.default.tokenizer: kuromoji_tokenizer\n```\n\u30af\u30e9\u30b9\u30bf\u306e\u540d\u524d\u3001\u30ce\u30fc\u30c9\u306e\u540d\u524d\u3001shard\u306e\u6570\u3001replica\u306e\u6570\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u30a2\u30ca\u30e9\u30a4\u30b6\u30fc\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u3044\u308b\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u30a2\u30ca\u30e9\u30a4\u30b6\u30fc\u3092kuromoji\u306b\u6307\u5b9a\u3057\u3066\u304a\u304f\u3068\u3001\u3068\u308a\u3042\u3048\u305a\u52dd\u624b\u306b\u65e5\u672c\u8a9e\u5168\u6587\u691c\u7d22\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\u5b9f\u969b\u306e\u30d7\u30ed\u30c0\u30af\u30c8\u306b\u306a\u308b\u3068\u3001\u30d5\u30a3\u30fc\u30eb\u30c9\u6bce\u306b\u7d30\u304b\u3044\u8a2d\u5b9a\u304c\u5fc5\u8981\u306b\u306a\u308b\u306e\u3067\u3001mapping\u3067\u8a2d\u5b9a\u3059\u308b\u3002\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304d\u63db\u3048\u305f\u3089elasticsearch\u3092\u518d\u8d77\u52d5\u3057\u53cd\u6620\u3055\u305b\u308b\u3002\n\n##mapping\n\u30b9\u30ad\u30fc\u30de\u5b9a\u7fa9\u306e\u3088\u3046\u306a\u3082\u306e\u3067\u3001tokenizer\u306e\u8a2d\u5b9a\u3092\u884c\u3063\u305f\u308a\u3001\u30d5\u30a3\u30fc\u30eb\u30c9\u6bce\u306b\u578b\u3084\u691c\u7d22\u306e\u8a2d\u5b9a\u3092\u3067\u304d\u308b\u3002\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u9001\u308b\u3002\u5358\u7d14\u306bstring\u578b\u3060\u3068\u8a2d\u5b9a\u3057\u305f\u4f8b\u3002\n\n```\ncurl -XPOST localhost:9200/tutorial -d '{\n    \"mappings\" : {\n        \"helloworld\" : {\n            \"properties\" : {\n                \"message\" : {\n                  \"type\" : \"string\"\n                  },\n                \"name\" : {\n                  \"type\" : \"string\"\n                }\n            }\n        }\n    }\n}'\n```\n\n\u30a2\u30ca\u30e9\u30a4\u30b6\u30fc\u3084\u3001\u691c\u7d22\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u3044\u304f\u3068\u3001\u5404\u30ec\u30b3\u30fc\u30c9\u3054\u3068\u306b\n\u5bff\u53f8\u304c\u304a\u3044\u3057\u3044\u306d->\u5bff\u53f8\u3000\u304a\u3044\u3057\u3044\n\u98f2\u307f->\u98f2\u3080\n\u5bff\u53f8->\u30b9\u30b7\n\u30b5\u30fc\u30d0\u30fc->\u30b5\u30fc\u30d0\n\u3068\u3044\u3063\u305f\u30d2\u30c3\u30c8\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\nmapping\u306e\u78ba\u8a8d\u3002index\u304ctutorial\u3067type\u304chelloworld\u306e\u5834\u5408\n\n```\ncurl -XGET 'localhost:9200/tutorial/_mapping/helloworld/?pretty'\n```\n\n#index\u3067\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3059\u308b\nindex\u3068\u3044\u3046\u306e\u3067\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3067\u304d\u308b\u3002\nindex,type,document\u3000\u3068\u3044\u3063\u305f\u5358\u8a9e\u304c\u51fa\u3066\u304d\u3066\u3001\nindex/type/document\u3068\u3044\u3046\u69cb\u9020\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\nindex\u540d\u3092tutorial,type\u3092helloworld,document\u3092\uff5bmessage\u3001name\uff5d\u3068\u3044\u3046\u30c7\u30fc\u30bf\u69cb\u9020\u3067\u4fdd\u5b58\u3059\u308b\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3059\u308b\u3002\n\uff08elastic\u306f\u3001mapping\u3092\u884c\u308f\u306a\u304f\u3066\u3082\u3001\u30c7\u30fc\u30bf\u3092\u9001\u308b\u3068\u81ea\u52d5\u3067\u578b\u3092\u3064\u3051\u308b\u3002\u8a2d\u5b9a\u3067\u3057\u306a\u3044\u3088\u3046\u306b\u3067\u304d\u308b\uff09\n\n```\ncurl -X POST 'http://localhost:9200/tutorial/helloworld/' -d '{ \"message\": \"Hello World! \u3053\u3093\u306b\u3061\u306f\uff01\" ,\"name\" : \"hoge\"}'\n\n```\n\n\u30d6\u30e9\u30a6\u30b6\u3067\u3082\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n\u307e\u305findex\u5168\u4f53\u3092\u524a\u9664\u3059\u308b\u306b\u306f\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\n\n`curl -XDELETE 'localhost:9200/tutorial?pretty'`\n\nDB\u306e\u4e2d\u8eab\u5168\u90e8\u5168\u6d88\u3057\u3059\u308b\u306b\u306f\n`curl -XDELETE 'http://localhost:9200/*' {\"acknowledged\":true}%`\n\n\n#query\n\u30af\u30a8\u30ea\u3002\n\u6587\u5b57\u5217\u304c\u5b8c\u5168\u4e00\u81f4\u3059\u308b\u3082\u306e\u3092\u63a2\u3059\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3059\u308b\u3002\npython\u306eelasticsearch\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u4f7f\u3063\u3066\u3044\u308b\u3002\n\n```py\n# -*- coding:utf-8 -*-\nfrom elasticsearch import Elasticsearch\nimport json\nes = Elasticsearch(\"localhost:9200\")\n\nmatchstring = es.search(index=\"tutorial\",\n                        doc_type=\"helloworld\",\n                        body={\n                            \"query\" : {\n                                \"match\" : {\n                                    \"name\" : \"hoge\"\n                                }\n                            }\n                        })\n```\n\nsimple_query_string\u3068\u3044\u3046\u6587\u5b57\u5217\u691c\u7d22\u7528\u306e\u4fbf\u5229\u95a2\u6570\u3092\u4f7f\u3063\u305f\u5834\u5408\u3002\n\n```py\nsimpleString = es.search(index=\"tutorial\",\n                         doc_type=\"helloworld\",\n                         body={\n                            \"query\" : {\n                                \"simple_query_string\" :{\n                                    \"query\" : \"\u3053\u3093\u306b\u3061\u306f\",\n                                    \"fields\" : [\"message\"]\n                                }\n                            }\n                         })\n```\n\nand,or,\u3092\u884c\u3046\u306b\u306f\u3001must,should,\u3068\u3044\u3046\u30af\u30a8\u30ea\u3092\u4f7f\u3046\u3089\u3057\u3044\u3002\nname in \"hoge\" && message in \"Hello\" \u306f\u3053\u3046\u3063\u307d\u3044\u3002\n\n```py\nqueryBool = es.search(index=\"tutorial\",\n                      doc_type=\"helloworld\",\n                      body={\n                        \"query\":{\n                            \"bool\":{\n                                \"must\":{\n                                    \"must\":{\n                                        \"term\" : {\n                                            \"name\" : \"hoge\"\n                                        }\n                                    },\n                                    \"term\" : {\n                                        \"message\" : \"Hello\"\n                                    }\n                                }\n                            }\n                        }\n                      })\n\n```\n\n\u4ed6\u306b\u3082filter\u3084\u96c6\u8a08\u7cfb\u306e\u30af\u30a8\u30ea\u304c\u3042\u308b\u3002\n\u30af\u30a8\u30ea\u3092\u3064\u304b\u3046\u3068\u30b9\u30b3\u30a2\u3092\u4f7f\u3063\u305f\u691c\u7d22\u3082\u3067\u304d\u308b\u3088\u3046\u3060\u3002\n\n#\u53c2\u8003\u30fb\u767a\u5c55\nElasticsearch\u306e\u6982\u5ff5\u3092\u77e5\u308b\nhttp://blog.shibayu36.org/entry/2015/07/08/095838\n\nElasticsearch\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\nhttp://code46.hatenablog.com/entry/2014/01/21/115620\n\nelastic\u5b9f\u8df5\u7684\u8a2d\u5b9a\u3068\u30af\u30a8\u30ea\nhttp://engineer.wantedly.com/2014/02/25/elasticsearch-at-wantedly-1.html\n\nkuromoji_tokenizer\u306e\u8a2d\u5b9a\nhttps://github.com/elastic/elasticsearch-analysis-kuromoji\n\nElasticSearch\u306e\u30a2\u30ca\u30e9\u30a4\u30b6\u306e\u8a2d\u5b9a\nhttp://christina04.hatenablog.com/entry/2015/02/02/225734\n\npython\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067\u59cb\u3081\u308b\u300c\u306f\u3058\u3081\u3066\u306eElasticsearch\u300d\nhttp://qiita.com/ikawaha/items/c654f746cfe76b888a27\n\nElasticsearch\u3068kuromoji\u3067\u3061\u3083\u3093\u3068\u3057\u305f\u65e5\u672c\u8a9e\u5168\u6587\u691c\u7d22\u3092\u3084\u308b\u30e1\u30e2\nhttp://tech.gmo-media.jp/post/70245090007/elasticsearch-kuromoji-japanese-fulltext-search\n\n"}