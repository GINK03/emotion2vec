{"context": " More than 1 year has passed since last update.Qiita API \u4f7f\u3063\u3066\u307f\u305f\u304b\u3063\u305f\u306e\u3067\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u30c7\u30e2\nhttp://labs.snaka.info/2016/0125_qiita_calendar.html\n\u3053\u3093\u306a\u611f\u3058\u3067\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n\u4e45\u3057\u3076\u308a\u306bjs\u66f8\u3044\u305f\u3002\u3042\u307e\u308a\u7dba\u9e97\u306b\u66f8\u3051\u306a\u304f\u3066\u30e2\u30e4\u30e2\u30e4\u3059\u308b\u3002\n\u203b\u8981 jQuery, D3.js\n\u203b\u624b\u629c\u304d\u3067\u76f4\u8fd1\u306e100\u4ef6\u3057\u304b\u53d6\u5f97\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u6295\u7a3f\u304c\u5e74\u9593100\u4ef6\u8d85\u3048\u308b\u5834\u5408\u306f\u5168\u3066\u8868\u793a\u3057\u304d\u308c\u307e\u305b\u3093\u3002\n\nshiiba.js\n/*\n   \u30d5\u30a9\u30fc\u30e0\u306e\u5165\u529b\u5185\u5bb9\u3092\u5143\u306bAPI\u306b\u554f\u3044\u5408\u308f\u305b\n */\n$(\"#form\").on(\"submit\", function(e) {\n  $(\"#btn-submit\").prop(\"disabled\", true);\n  var user_id = $(\"#user_id\").val()\n  $.ajax({\n    type: \"GET\",\n    url: \"http://qiita.com/api/v2/users/\" + user_id + \"/items?page=1&per_page=100\",\n    success: onSucceed\n  });\n  e.preventDefault();\n});\n\n// \u65e5\u4ed8\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\nvar format = d3.time.format(\"%Y-%m-%d\");\n\n/*\n   API\u304b\u3089\u53d7\u3051\u53d6\u3063\u305f\u60c5\u5831\u3092\u5143\u306b\u30ab\u30ec\u30f3\u30c0\u30fc\u63cf\u753b\n */\nfunction onSucceed(data) {\n  var item_dates = {};\n  $.each(data, function(idx, val) {\n    var created_at = format(d3.time.day.floor(new Date(val['created_at'])));\n    if (created_at in item_dates)\n      item_dates[created_at]++;\n    else\n      item_dates[created_at] = 1;\n  });\n  drawCalendar(item_dates);\n  $(\"#btn-submit\").prop(\"disabled\", false);\n}\n\n/*\n   \u30ab\u30ec\u30f3\u30c0\u30fc\u306e\u63cf\u753b\n */\nvar drawCalendar = (function() {\n  // \u30bb\u30eb\u306e1\u8fba\u306e\u30b5\u30a4\u30ba\n  var CELL_SIZE = 15;\n\n  // \u30e9\u30d9\u30eb\u306e\u9ad8\u3055\n  var LABEL_HEIGHT = 11;\n\n  // \u30ab\u30ec\u30f3\u30c0\u8868\u793a\u306e\u30de\u30fc\u30b8\u30f3\n  var MARGIN_LEFT = 25;\n  var MARGIN_TOP = 15;\n\n  // \u8868\u793a\u3059\u308b\u65e5\u4ed8\u306e\u7bc4\u56f2(\u904e\u53bb\uff11\u5e74\u9593)\n  var rangeBegin = d3.time.day.offset(new Date, -365);\n  var rangeEnd = new Date;\n  var dateRange = d3.time.days(rangeBegin, rangeEnd);\n  var monthRange = d3.time.months(rangeBegin, rangeEnd);\n\n  // \u77e9\u5f62\u306eX\u5ea7\u6a19\u306e\u30aa\u30d5\u30bb\u30c3\u30c8\u5024\u3092\u7b97\u51fa\u3059\u308b\u95a2\u6570\n  var offsetX = (function() {\n    var firstYearOffset = d3.time.weekOfYear(rangeBegin) * -1;\n    var bounderyDate = d3.time.years(rangeBegin, rangeEnd)[0];\n    var lastDayOfFirstYear = d3.time.day.offset(bounderyDate, -1);\n    var lastWeekOfFirstYear = d3.time.weekOfYear(lastDayOfFirstYear);\n    var lastYearOffset = d3.time.weekOfYear(lastDayOfFirstYear) + firstYearOffset;\n\n    return function(sourceDate) {\n      if (sourceDate.getFullYear() == rangeBegin.getFullYear())\n        return firstYearOffset;\n      return lastYearOffset;\n    }\n  })();\n\n  // \u30e1\u30a4\u30f3\u51e6\u7406:\u30ab\u30ec\u30f3\u30c0\u30fc\u63cf\u753b\n  return function(originalDataset) {\n\n    // Object\u3092key\u3067\u30d5\u30a3\u30eb\u30bf\u3059\u308b\u95a2\u6570\n    function objectFilter(obj, predicate) {\n      var result = {}, key;\n      for (key in obj) {\n        if (obj.hasOwnProperty(key) && predicate(key, obj[key])) {\n          result[key] = obj[key];\n        }\n      }\n      return result;\n    }\n\n    var dataset = objectFilter(originalDataset, function(k, v) {\n      var aDay = new Date(k);\n      return rangeBegin <= aDay && aDay <= d3.time.day.offset(rangeEnd, 1);\n    });\n\n    // \u4ef6\u6570\u30923\u6bb5\u968e\u306b\u5206\u985e\u3059\u308b\u30b9\u30b1\u30fc\u30eb\u95a2\u6570\n    var countScale = d3.scale.linear()\n                     .domain([1, d3.max(d3.values(dataset))])\n                     .rangeRound([1, 3])    // 3\u6bb5\u968e\u3067\u8272\u5206\u3051\n                     .clamp(true);\n    // \u6bb5\u968e\u3054\u3068\u306b\u8272\u5206\u3051\n    // Thanks to colorbrew (http://colorbrewer2.org/)\n    var colorScale = d3.scale.ordinal()\n                     .domain([1, 2, 3])\n                     .range([\"#f7fcb9\",\"#addd8e\",\"#31a354\"]);\n    var color = function(f) { return colorScale(countScale(f)); }\n\n    // svg\u8981\u7d20\u3092\u9078\u629e\n    var svg = d3.select(\".weed\");\n    svg.selectAll(\"*\").remove();\n    svg.append(\"g\");\n\n    // \u65e5\u6bce\u306e\u77e9\u5f62\u3092\u751f\u6210\n    var rect = svg.selectAll(\".day\")\n              .data(dateRange)\n              .enter()\n              .append(\"rect\")\n                .attr(\"class\", \"day\")\n                .attr(\"width\", CELL_SIZE - 1)\n                .attr(\"height\", CELL_SIZE - 1)\n                .attr(\"x\", function(d){ return (d3.time.weekOfYear(d) + offsetX(d)) * CELL_SIZE + MARGIN_LEFT; })\n                .attr(\"y\", function(d){ return d.getDay() * CELL_SIZE + MARGIN_TOP; })\n                .attr(\"fill\", \"#e6e6e6\")\n              .datum(format);\n\n    // \u6295\u7a3f\u306e\u3042\u3063\u305f\u65e5\u306e\u30c4\u30fc\u30eb\u30c1\u30c3\u30d7\u3068\u80cc\u666f\u8272\u3092\u8a2d\u5b9a\n    rect.filter(function(d){ return d in dataset; })\n        .attr(\"fill\", function(d){ return colorScale(countScale(dataset[d])); })\n        .append(\"title\")\n          .text(function(d){ return d + \" (\u6295\u7a3f:\" + dataset[d] + \"\u4ef6)\"; });\n\n    // \u66dc\u65e5\u306e\u30e9\u30d9\u30eb\n    dayLabels = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"]\n    svg.selectAll(\".dayLabel\")\n       .data(d3.range(7))\n       .enter()\n       .append(\"text\")\n         .attr(\"class\", \"dayLabel\")\n         .attr(\"x\", 0)\n         .attr(\"y\", function(d){ return d * CELL_SIZE + LABEL_HEIGHT + MARGIN_TOP; })\n         .attr(\"font-size\", LABEL_HEIGHT)\n         .attr(\"fill\", \"gray\")\n         .text(function(d){ return dayLabels[d]; });\n\n    // \u6708\u306e\u30e9\u30d9\u30eb\n    monthLabels = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"]\n    svg.selectAll(\".monthLabel\")\n      .data(monthRange)\n      .enter()\n      .append(\"text\")\n        .attr(\"class\", \"monthLabel\")\n        .attr(\"x\", function(d){ return (d3.time.weekOfYear(d) + offsetX(d)) * CELL_SIZE + MARGIN_LEFT; })\n        .attr(\"y\", LABEL_HEIGHT)\n        .attr(\"font-size\", LABEL_HEIGHT)\n        .attr(\"fill\", \"gray\")\n        .text(function(d){ return monthLabels[d.getMonth()]; });\n  }\n})(); // drawCalendar\n\n\n\n\u5f97\u3089\u308c\u305f\u3082\u306e\n\nGitHub\u306e\u3042\u306e\u8349\u306fD3.js\u3067\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\nD3.js\u306b\u3088\u308b\u30d3\u30b8\u30e5\u30a2\u30e9\u30a4\u30ba\u306f(\u4e3b\u306b)SVG\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\nD3.js\u9762\u767d\u3044\n\n\n\u53c2\u8003\n\n\u3010D3.js + node.js\u3011 \u30d6\u30ed\u30b0\u306e\u30c7\u30fc\u30bf\u3092Github\u98a8\u306e\u30ab\u30ec\u30f3\u30c0\u30fc\u306b\u8868\u793a\u3059\u308b | #GUNMAGISGEEK\nCalendar View\nHome \u00b7 mbostock/d3 Wiki\n\n\nQiita API \u4f7f\u3063\u3066\u307f\u305f\u304b\u3063\u305f\u306e\u3067\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n## \u30c7\u30e2\n\nhttp://labs.snaka.info/2016/0125_qiita_calendar.html\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-01-27 8.34.22.png](https://qiita-image-store.s3.amazonaws.com/0/8219/cb1e2023-e0b9-a47a-eb46-7d3b9756d7cc.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-01-27 8.34.22.png\")\n\n\n## \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n\n\u4e45\u3057\u3076\u308a\u306bjs\u66f8\u3044\u305f\u3002\u3042\u307e\u308a\u7dba\u9e97\u306b\u66f8\u3051\u306a\u304f\u3066\u30e2\u30e4\u30e2\u30e4\u3059\u308b\u3002\n\u203b\u8981 jQuery, D3.js\n\u203b\u624b\u629c\u304d\u3067\u76f4\u8fd1\u306e100\u4ef6\u3057\u304b\u53d6\u5f97\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u6295\u7a3f\u304c\u5e74\u9593100\u4ef6\u8d85\u3048\u308b\u5834\u5408\u306f\u5168\u3066\u8868\u793a\u3057\u304d\u308c\u307e\u305b\u3093\u3002\n\n```shiiba.js\n/*\n   \u30d5\u30a9\u30fc\u30e0\u306e\u5165\u529b\u5185\u5bb9\u3092\u5143\u306bAPI\u306b\u554f\u3044\u5408\u308f\u305b\n */\n$(\"#form\").on(\"submit\", function(e) {\n  $(\"#btn-submit\").prop(\"disabled\", true);\n  var user_id = $(\"#user_id\").val()\n  $.ajax({\n    type: \"GET\",\n    url: \"http://qiita.com/api/v2/users/\" + user_id + \"/items?page=1&per_page=100\",\n    success: onSucceed\n  });\n  e.preventDefault();\n});\n\n// \u65e5\u4ed8\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\nvar format = d3.time.format(\"%Y-%m-%d\");\n\n/*\n   API\u304b\u3089\u53d7\u3051\u53d6\u3063\u305f\u60c5\u5831\u3092\u5143\u306b\u30ab\u30ec\u30f3\u30c0\u30fc\u63cf\u753b\n */\nfunction onSucceed(data) {\n  var item_dates = {};\n  $.each(data, function(idx, val) {\n    var created_at = format(d3.time.day.floor(new Date(val['created_at'])));\n    if (created_at in item_dates)\n      item_dates[created_at]++;\n    else\n      item_dates[created_at] = 1;\n  });\n  drawCalendar(item_dates);\n  $(\"#btn-submit\").prop(\"disabled\", false);\n}\n\n/*\n   \u30ab\u30ec\u30f3\u30c0\u30fc\u306e\u63cf\u753b\n */\nvar drawCalendar = (function() {\n  // \u30bb\u30eb\u306e1\u8fba\u306e\u30b5\u30a4\u30ba\n  var CELL_SIZE = 15;\n\n  // \u30e9\u30d9\u30eb\u306e\u9ad8\u3055\n  var LABEL_HEIGHT = 11;\n\n  // \u30ab\u30ec\u30f3\u30c0\u8868\u793a\u306e\u30de\u30fc\u30b8\u30f3\n  var MARGIN_LEFT = 25;\n  var MARGIN_TOP = 15;\n\n  // \u8868\u793a\u3059\u308b\u65e5\u4ed8\u306e\u7bc4\u56f2(\u904e\u53bb\uff11\u5e74\u9593)\n  var rangeBegin = d3.time.day.offset(new Date, -365);\n  var rangeEnd = new Date;\n  var dateRange = d3.time.days(rangeBegin, rangeEnd);\n  var monthRange = d3.time.months(rangeBegin, rangeEnd);\n\n  // \u77e9\u5f62\u306eX\u5ea7\u6a19\u306e\u30aa\u30d5\u30bb\u30c3\u30c8\u5024\u3092\u7b97\u51fa\u3059\u308b\u95a2\u6570\n  var offsetX = (function() {\n    var firstYearOffset = d3.time.weekOfYear(rangeBegin) * -1;\n    var bounderyDate = d3.time.years(rangeBegin, rangeEnd)[0];\n    var lastDayOfFirstYear = d3.time.day.offset(bounderyDate, -1);\n    var lastWeekOfFirstYear = d3.time.weekOfYear(lastDayOfFirstYear);\n    var lastYearOffset = d3.time.weekOfYear(lastDayOfFirstYear) + firstYearOffset;\n\n    return function(sourceDate) {\n      if (sourceDate.getFullYear() == rangeBegin.getFullYear())\n        return firstYearOffset;\n      return lastYearOffset;\n    }\n  })();\n\n  // \u30e1\u30a4\u30f3\u51e6\u7406:\u30ab\u30ec\u30f3\u30c0\u30fc\u63cf\u753b\n  return function(originalDataset) {\n\n    // Object\u3092key\u3067\u30d5\u30a3\u30eb\u30bf\u3059\u308b\u95a2\u6570\n    function objectFilter(obj, predicate) {\n      var result = {}, key;\n      for (key in obj) {\n        if (obj.hasOwnProperty(key) && predicate(key, obj[key])) {\n          result[key] = obj[key];\n        }\n      }\n      return result;\n    }\n\n    var dataset = objectFilter(originalDataset, function(k, v) {\n      var aDay = new Date(k);\n      return rangeBegin <= aDay && aDay <= d3.time.day.offset(rangeEnd, 1);\n    });\n\n    // \u4ef6\u6570\u30923\u6bb5\u968e\u306b\u5206\u985e\u3059\u308b\u30b9\u30b1\u30fc\u30eb\u95a2\u6570\n    var countScale = d3.scale.linear()\n                     .domain([1, d3.max(d3.values(dataset))])\n                     .rangeRound([1, 3])    // 3\u6bb5\u968e\u3067\u8272\u5206\u3051\n                     .clamp(true);\n    // \u6bb5\u968e\u3054\u3068\u306b\u8272\u5206\u3051\n    // Thanks to colorbrew (http://colorbrewer2.org/)\n    var colorScale = d3.scale.ordinal()\n                     .domain([1, 2, 3])\n                     .range([\"#f7fcb9\",\"#addd8e\",\"#31a354\"]);\n    var color = function(f) { return colorScale(countScale(f)); }\n\n    // svg\u8981\u7d20\u3092\u9078\u629e\n    var svg = d3.select(\".weed\");\n    svg.selectAll(\"*\").remove();\n    svg.append(\"g\");\n\n    // \u65e5\u6bce\u306e\u77e9\u5f62\u3092\u751f\u6210\n    var rect = svg.selectAll(\".day\")\n              .data(dateRange)\n              .enter()\n              .append(\"rect\")\n                .attr(\"class\", \"day\")\n                .attr(\"width\", CELL_SIZE - 1)\n                .attr(\"height\", CELL_SIZE - 1)\n                .attr(\"x\", function(d){ return (d3.time.weekOfYear(d) + offsetX(d)) * CELL_SIZE + MARGIN_LEFT; })\n                .attr(\"y\", function(d){ return d.getDay() * CELL_SIZE + MARGIN_TOP; })\n                .attr(\"fill\", \"#e6e6e6\")\n              .datum(format);\n\n    // \u6295\u7a3f\u306e\u3042\u3063\u305f\u65e5\u306e\u30c4\u30fc\u30eb\u30c1\u30c3\u30d7\u3068\u80cc\u666f\u8272\u3092\u8a2d\u5b9a\n    rect.filter(function(d){ return d in dataset; })\n        .attr(\"fill\", function(d){ return colorScale(countScale(dataset[d])); })\n        .append(\"title\")\n          .text(function(d){ return d + \" (\u6295\u7a3f:\" + dataset[d] + \"\u4ef6)\"; });\n\n    // \u66dc\u65e5\u306e\u30e9\u30d9\u30eb\n    dayLabels = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"]\n    svg.selectAll(\".dayLabel\")\n       .data(d3.range(7))\n       .enter()\n       .append(\"text\")\n         .attr(\"class\", \"dayLabel\")\n         .attr(\"x\", 0)\n         .attr(\"y\", function(d){ return d * CELL_SIZE + LABEL_HEIGHT + MARGIN_TOP; })\n         .attr(\"font-size\", LABEL_HEIGHT)\n         .attr(\"fill\", \"gray\")\n         .text(function(d){ return dayLabels[d]; });\n\n    // \u6708\u306e\u30e9\u30d9\u30eb\n    monthLabels = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"]\n    svg.selectAll(\".monthLabel\")\n      .data(monthRange)\n      .enter()\n      .append(\"text\")\n        .attr(\"class\", \"monthLabel\")\n        .attr(\"x\", function(d){ return (d3.time.weekOfYear(d) + offsetX(d)) * CELL_SIZE + MARGIN_LEFT; })\n        .attr(\"y\", LABEL_HEIGHT)\n        .attr(\"font-size\", LABEL_HEIGHT)\n        .attr(\"fill\", \"gray\")\n        .text(function(d){ return monthLabels[d.getMonth()]; });\n  }\n})(); // drawCalendar\n```\n\n## \u5f97\u3089\u308c\u305f\u3082\u306e\n\n* GitHub\u306e\u3042\u306e\u8349\u306fD3.js\u3067\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\n* D3.js\u306b\u3088\u308b\u30d3\u30b8\u30e5\u30a2\u30e9\u30a4\u30ba\u306f(\u4e3b\u306b)SVG\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\n* D3.js\u9762\u767d\u3044\n\n\n## \u53c2\u8003\n\n* [\u3010D3.js + node.js\u3011 \u30d6\u30ed\u30b0\u306e\u30c7\u30fc\u30bf\u3092Github\u98a8\u306e\u30ab\u30ec\u30f3\u30c0\u30fc\u306b\u8868\u793a\u3059\u308b | #GUNMAGISGEEK](http://shimz.me/blog/node-js/2975)\n* [Calendar View](http://bl.ocks.org/mbostock/4063318)\n* [Home \u00b7 mbostock/d3 Wiki](https://github.com/mbostock/d3/wiki)\n\n\n", "tags": ["Qiita", "d3.js"]}