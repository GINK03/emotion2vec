{"context": "\n\n\u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u306b\u3064\u3044\u3066\n\n\u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u306f\u3001Redshift\u306e\u30af\u30e9\u30b9\u30bf\u30fc\u3068\u305d\u306e\u30af\u30e9\u30b9\u30bf\u306b\u5bfe\u3057\u3066\u30af\u30a8\u30ea\u3092\u767a\u884c\u3059\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\u3092\u5b9f\u65bd\u3057\u307e\u3059\u3002\n\u30af\u30a8\u30ea\u306e\u767a\u884c\u306b\u306f\u3001\u300cpsql\u300d\u3092\u5229\u7528\u3057\u307e\u3059\u3002\u672c\u624b\u9806\u3067\u306f\u3001Amazon Linux\u4e0a\u3078\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u5229\u7528\u65b9\u6cd5\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\n\n\n\u524d\u63d0\u6761\u4ef6\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n\u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u306f\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u3092\u884c\u3044\u307e\u3057\u305f\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws --version\n\n\n\n\u7d50\u679c\naws-cli/1.10.23 Python/2.7.10 Linux/4.4.5-15.26.amzn1.x86_64 botocore/1.4.14\n\n\n\n\u5fc5\u8981\u306a\u6a29\u9650\n\u4f5c\u696d\u306b\u3042\u305f\u3063\u3066\u306f\u3001\u4ee5\u4e0b\u306e\u6a29\u9650\u3092\u6709\u3057\u305fIAM\u30e6\u30fc\u30b6\u3082\u3057\u304f\u306fIAM\u30ed\u30fc\u30eb\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nEC2\u306b\u5bfe\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\nRedShift\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\nIAM\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\nS3\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\nSTS\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n\n\n0. \u6e96\u5099\n\n\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\nexport AWS_DEFAULT_REGION='ap-northeast-1'\n\n\n\n\u8cc7\u683c\u60c5\u5831\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws configure list\n\n\n\n\u7d50\u679c\nName                    Value             Type    Location\n----                    -----             ----    --------\nprofile                <not set>             None    None\naccess_key     ****************RDPA         iam-role\nsecret_key     ****************9GA8         iam-role\nregion           ap-northeast-1              env    AWS_DEFAULT_REGION\n\n\n\n1\uff0eSubnet Group\u306e\u4f5c\u6210\nRedshift\u306e\u4f5c\u6210\u5148\u3068\u306a\u308bSubnet\u3092\u4e88\u3081Subnet Group\u3068\u3057\u3066\u6307\u5b9a\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u30b5\u30d6\u30cd\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7\u540d\u306e\u6307\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\nCLUSTER_SUBNET_GROUP_NAME=\"redshift-subnet\"\nCLUSTER_SUBNET_GROUP_DESCRIPTION=\"Subnet Group for Redshift\"\n\n\n\n\u540c\u540d\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7\u304c\u5b58\u5728\u3057\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws redshift describe-cluster-subnet-groups --cluster-subnet-group-name ${CLUSTER_SUBNET_GROUP_NAME}\n\n\n\n\u7d50\u679c\nA client error (ClusterSubnetGroupNotFoundFault) occurred when calling the DescribeClusterSubnetGroups operation: Cluster Subnet group 'redshift-subnet' not found.\n\n\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n    CLUSTER_SUBNET_GROUP_NAME:${CLUSTER_SUBNET_GROUP_NAME}\n    CLUSTER_SUBNET_GROUP_DESCRIPTION:${CLUSTER_SUBNET_GROUP_DESCRIPTION}\n    SUBNET_A_ID:${SUBNET_A_ID}\n\nETX\n\n\n\n\u7d50\u679c\n\n    CLUSTER_SUBNET_GROUP_NAME:redshift-subnet\n    CLUSTER_SUBNET_GROUP_DESCRIPTION:Subnet Group for Redshift\n    SUBNET_A_ID:subnet-********\n\n\n\n\n\u30b5\u30d6\u30cd\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\naws redshift create-cluster-subnet-group \\\n  --cluster-subnet-group-name ${CLUSTER_SUBNET_GROUP_NAME}  \\\n  --description \"${CLUSTER_SUBNET_GROUP_DESCRIPTION}\" \\\n  --subnet-ids ${SUBNET_A_ID}\n\n\n\n\u7d50\u679c\n{\n    \"ClusterSubnetGroup\": {\n        \"Subnets\": [\n            {\n                \"SubnetStatus\": \"Active\",\n                \"SubnetIdentifier\": \"subnet-********\",\n                \"SubnetAvailabilityZone\": {\n                    \"Name\": \"ap-northeast-1a\"\n                }\n            }\n        ],\n        \"VpcId\": \"vpc-********\",\n        \"Description\": \"Subnet Group for Redshift\",\n        \"Tags\": [],\n        \"SubnetGroupStatus\": \"Complete\",\n        \"ClusterSubnetGroupName\": \"redshift-subnet\"\n    }\n}\n\n\n\n2. Security Group\u306e\u4f5c\u6210\nRedshift\u30af\u30e9\u30b9\u30bf\u30fc\u3078\u306e\u30a2\u30af\u30bb\u30b9\u5236\u9650\u306fVPC\u306eSecurity Group\u3067\u884c\u3044\u307e\u3059\u3002\n\uff08VPC-Classic\u306a\u74b0\u5883\u3067\u306f\u5c02\u7528\u306eSecurity Group\u3092\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\uff09\n\nSecurity Group\u540d\u306e\u6307\u5b9a\uff08Redshift\u30af\u30e9\u30b9\u30bf\u7528\uff09\n\n\u30b3\u30de\u30f3\u30c9\nSG_GROUP_NAME_REDSHIFT='Redshift'\nSG_DESCRIPTION_REDSHIFT='JAWS-UG CLI at Co-Edo'\n\n\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n   SG_GROUP_NAME: ${SG_GROUP_NAME_REDSHIFT}\n   SG_DESCRIPTION: ${SG_DESCRIPTION_REDSHIFT}\n\nETX\n\n\n\n\u7d50\u679c\n\n   SG_GROUP_NAME: Redshift\n   SG_DESCRIPTION: JAWS-UG CLI at Co-Edo\n\n\n\n\nRedshift\u306e\u30af\u30e9\u30b9\u30bf\u30fc\u306b\u8a2d\u5b9a\u3059\u308bSecurity Group\u3092\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\nSG_ID_REDSHIFT=`aws ec2 create-security-group --group-name ${SG_GROUP_NAME_REDSHIFT} \\\n  --description \"${SG_DESCRIPTION_REDSHIFT}\" --vpc-id ${VPC_ID} \\\n  --query GroupId \\\n  --output text` \\\n  && echo ${SG_ID_REDSHIFT}\n\n\n\n\u7d50\u679c\nsg-********\n\n\n\n\u4f5c\u6210\u3057\u305fSecurity Group\u3092\u78ba\u8a8d\n\uff08\u30a2\u30a6\u30c8\u30d0\u30a6\u30f3\u30c9\u306e\u901a\u4fe1\u306e\u307f\u5168\u3066\u8a31\u53ef\u3059\u308b\u8a2d\u5b9a\u306e\u307f\u3001\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\uff09\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 describe-security-groups --group-ids ${SG_ID_REDSHIFT}\n\n\n\n\u7d50\u679c\n{\n    \"SecurityGroups\": [\n        {\n            \"IpPermissionsEgress\": [\n                {\n                    \"IpProtocol\": \"-1\",\n                    \"IpRanges\": [\n                        {\n                            \"CidrIp\": \"0.0.0.0/0\"\n                        }\n                    ],\n                    \"UserIdGroupPairs\": [],\n                    \"PrefixListIds\": []\n                }\n            ],\n            \"Description\": \"JAWS-UG CLI at Co-Edo\",\n            \"IpPermissions\": [],\n            \"GroupName\": \"Redshift\",\n            \"VpcId\": \"vpc-********\",\n            \"OwnerId\": \"************\",\n            \"GroupId\": \"sg-********\"\n        }\n    ]\n}\n\n\n\n\u30a4\u30f3\u30d0\u30a6\u30f3\u30c9\u306e\u30eb\u30fc\u30eb\u3092\u8ffd\u52a0\nRedshift\u3078\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 authorize-security-group-ingress --group-id ${SG_ID_REDSHIFT} \\\n  --protocol 'tcp' --port 5439 --cidr ${PUBLIC_IP_ADDRESS}/32\n\n\n\n\u7d50\u679c\n\uff08\u8fd4\u5024\u7121\u3057\uff09\n\n\n\n\u8ffd\u52a0\u3055\u308c\u305f\u30eb\u30fc\u30eb\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 describe-security-groups --group-ids ${SG_ID_REDSHIFT}\n\n\n\n\u7d50\u679c\n{\n    \"SecurityGroups\": [\n        {\n            \"IpPermissionsEgress\": [\n                {\n                    \"IpProtocol\": \"-1\",\n                    \"IpRanges\": [\n                        {\n                            \"CidrIp\": \"0.0.0.0/0\"\n                        }\n                    ],\n                    \"UserIdGroupPairs\": [],\n                    \"PrefixListIds\": []\n                }\n            ],\n            \"Description\": \"JAWS-UG CLI at Co-Edo\",\n            \"IpPermissions\": [\n                {\n                    \"PrefixListIds\": [],\n                    \"FromPort\": 5439,\n                    \"IpRanges\": [\n                        {\n                            \"CidrIp\": \"**.**.**.**/32\"\n                        }\n                    ],\n                    \"ToPort\": 5439,\n                    \"IpProtocol\": \"tcp\",\n                    \"UserIdGroupPairs\": []\n                }\n            ],\n            \"GroupName\": \"Redshift\",\n            \"VpcId\": \"vpc-********\",\n            \"OwnerId\": \"************\",\n            \"GroupId\": \"sg-********\"\n        }\n    ]\n}\n\n\n\n3\uff0e\u30af\u30e9\u30b9\u30bf\u306e\u4f5c\u6210\nRedshift\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u6307\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\nCLUSTER_NAME=\"mycluster\"\nDB_NAME=\"mydb\"\nPORT=\"5439\"\nMASTER_USER_NAME=\"awsuser\"\nMASTER_USER_PASSWORD=\"Pa55w0rd\"\nNODE_TYPE=\"dc1.large\"\nCLUSTER_TYPE=\"single-node\"\n\n\n\n\u305d\u306e\u4ed6\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3064\u3044\u3066\n\u305d\u306e\u4ed6\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u306f\u3001\u516c\u5f0f\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nhttp://docs.aws.amazon.com/cli/latest/reference/redshift/create-cluster.html\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n    CLUSTER_NAME:${CLUSTER_NAME}\n    DB_NAME:${DB_NAME}\n    PORT:${PORT}\n    MASTER_USER_NAME:${MASTER_USER_NAME}\n    MASTER_USER_PASSWORD:${MASTER_USER_PASSWORD}\n    NODE_TYPE:${NODE_TYPE}\n    CLUSTER_TYPE:${CLUSTER_TYPE}\n\nETX\n\n\n\n\u7d50\u679c\n\n\n\n\n\u30af\u30e9\u30b9\u30bf\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\naws redshift create-cluster \\\n  --db-name ${DB_NAME} \\\n  --cluster-identifier ${CLUSTER_NAME} \\\n  --cluster-type ${CLUSTER_TYPE} \\\n  --node-type ${NODE_TYPE} \\\n  --master-username ${MASTER_USER_NAME} \\\n  --master-user-password ${MASTER_USER_PASSWORD} \\\n  --port ${PORT} \\\n  --cluster-subnet-group-name ${CLUSTER_SUBNET_GROUP_NAME} \\\n  --vpc-security-group-ids ${SG_ID_REDSHIFT}\n\n\n\n\u7d50\u679c\n{\n    \"Cluster\": {\n        \"IamRoles\": [],\n        \"ClusterVersion\": \"1.0\",\n        \"NumberOfNodes\": 1,\n        \"VpcId\": \"vpc-********\",\n        \"NodeType\": \"dc1.large\",\n        \"PubliclyAccessible\": true,\n        \"Tags\": [],\n        \"MasterUsername\": \"awsuser\",\n        \"ClusterParameterGroups\": [\n            {\n                \"ParameterGroupName\": \"default.redshift-1.0\",\n                \"ParameterApplyStatus\": \"in-sync\"\n            }\n        ],\n        \"Encrypted\": false,\n        \"ClusterSecurityGroups\": [],\n        \"AllowVersionUpgrade\": true,\n        \"VpcSecurityGroups\": [\n            {\n                \"Status\": \"active\",\n                \"VpcSecurityGroupId\": \"sg-********\"\n            }\n        ],\n        \"ClusterSubnetGroupName\": \"redshift-sg\",\n        \"AutomatedSnapshotRetentionPeriod\": 1,\n        \"ClusterStatus\": \"creating\",\n        \"ClusterIdentifier\": \"mycluster\",\n        \"DBName\": \"mydb\",\n        \"PreferredMaintenanceWindow\": \"sun:14:30-sun:15:00\",\n        \"PendingModifiedValues\": {\n            \"MasterUserPassword\": \"****\"\n        }\n    }\n}\n\n\n\n\u4f5c\u6210\u3057\u305f\u30af\u30e9\u30b9\u30bf\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws redshift describe-clusters --cluster-identifier ${CLUSTER_NAME}\n\n\n\n\u7d50\u679c\n{\n    \"Clusters\": [\n        {\n            \"PubliclyAccessible\": true,\n            \"MasterUsername\": \"awsuser\",\n            \"VpcSecurityGroups\": [\n                {\n                    \"Status\": \"active\",\n                    \"VpcSecurityGroupId\": \"sg-********\"\n                }\n            ],\n            \"NumberOfNodes\": 1,\n            \"PendingModifiedValues\": {\n                \"MasterUserPassword\": \"****\"\n            },\n            \"VpcId\": \"vpc-********\",\n            \"ClusterVersion\": \"1.0\",\n            \"Tags\": [],\n            \"AutomatedSnapshotRetentionPeriod\": 1,\n            \"ClusterParameterGroups\": [\n                {\n                    \"ParameterGroupName\": \"default.redshift-1.0\",\n                    \"ParameterApplyStatus\": \"in-sync\"\n                }\n            ],\n            \"DBName\": \"mydb\",\n            \"PreferredMaintenanceWindow\": \"sun:14:30-sun:15:00\",\n            \"IamRoles\": [],\n            \"AllowVersionUpgrade\": true,\n            \"ClusterSubnetGroupName\": \"redshift-sg\",\n            \"ClusterSecurityGroups\": [],\n            \"ClusterIdentifier\": \"mycluster\",\n            \"ClusterNodes\": [\n                {\n                    \"NodeRole\": \"SHARED\",\n                    \"PublicIPAddress\": \"**.**.**.**\"\n                }\n            ],\n            \"AvailabilityZone\": \"ap-northeast-1a\",\n            \"NodeType\": \"dc1.large\",\n            \"Encrypted\": false,\n            \"ClusterRevisionNumber\": \"1043\",\n            \"ClusterStatus\": \"creating\"\n        }\n    ]\n}\n\n\n\u4ee5\u4e0a\n# \u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u306b\u3064\u3044\u3066\n- \u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u306f\u3001Redshift\u306e\u30af\u30e9\u30b9\u30bf\u30fc\u3068\u305d\u306e\u30af\u30e9\u30b9\u30bf\u306b\u5bfe\u3057\u3066\u30af\u30a8\u30ea\u3092\u767a\u884c\u3059\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\u3092\u5b9f\u65bd\u3057\u307e\u3059\u3002\n- \u30af\u30a8\u30ea\u306e\u767a\u884c\u306b\u306f\u3001\u300cpsql\u300d\u3092\u5229\u7528\u3057\u307e\u3059\u3002\u672c\u624b\u9806\u3067\u306f\u3001Amazon Linux\u4e0a\u3078\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u5229\u7528\u65b9\u6cd5\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\n\n\n# \u524d\u63d0\u6761\u4ef6\n\n## \u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n\n\u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u306f\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u3092\u884c\u3044\u307e\u3057\u305f\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws --version\n```\n\n```text:\u7d50\u679c\naws-cli/1.10.23 Python/2.7.10 Linux/4.4.5-15.26.amzn1.x86_64 botocore/1.4.14\n```\n\n## \u5fc5\u8981\u306a\u6a29\u9650\n\n\u4f5c\u696d\u306b\u3042\u305f\u3063\u3066\u306f\u3001\u4ee5\u4e0b\u306e\u6a29\u9650\u3092\u6709\u3057\u305fIAM\u30e6\u30fc\u30b6\u3082\u3057\u304f\u306fIAM\u30ed\u30fc\u30eb\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n- EC2\u306b\u5bfe\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n- RedShift\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n- IAM\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n- S3\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n- STS\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n\n\n# 0. \u6e96\u5099\n\n## \u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\n\n```bash:\u30b3\u30de\u30f3\u30c9\nexport AWS_DEFAULT_REGION='ap-northeast-1'\n```\n\n## \u8cc7\u683c\u60c5\u5831\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws configure list\n```\n\n```text:\u7d50\u679c\nName                    Value             Type    Location\n----                    -----             ----    --------\nprofile                <not set>             None    None\naccess_key     ****************RDPA         iam-role\nsecret_key     ****************9GA8         iam-role\nregion           ap-northeast-1              env    AWS_DEFAULT_REGION\n```\n\n\n# 1\uff0eSubnet Group\u306e\u4f5c\u6210\n\nRedshift\u306e\u4f5c\u6210\u5148\u3068\u306a\u308bSubnet\u3092\u4e88\u3081Subnet Group\u3068\u3057\u3066\u6307\u5b9a\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n## \u30b5\u30d6\u30cd\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7\u540d\u306e\u6307\u5b9a\n\n```bash:\u30b3\u30de\u30f3\u30c9\nCLUSTER_SUBNET_GROUP_NAME=\"redshift-subnet\"\nCLUSTER_SUBNET_GROUP_DESCRIPTION=\"Subnet Group for Redshift\"\n```\n\n## \u540c\u540d\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7\u304c\u5b58\u5728\u3057\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws redshift describe-cluster-subnet-groups --cluster-subnet-group-name ${CLUSTER_SUBNET_GROUP_NAME}\n```\n\n```text:\u7d50\u679c\nA client error (ClusterSubnetGroupNotFoundFault) occurred when calling the DescribeClusterSubnetGroups operation: Cluster Subnet group 'redshift-subnet' not found.\n```\n\n## \u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n    CLUSTER_SUBNET_GROUP_NAME:${CLUSTER_SUBNET_GROUP_NAME}\n    CLUSTER_SUBNET_GROUP_DESCRIPTION:${CLUSTER_SUBNET_GROUP_DESCRIPTION}\n    SUBNET_A_ID:${SUBNET_A_ID}\n    \nETX\n```\n\n```text:\u7d50\u679c\n\n    CLUSTER_SUBNET_GROUP_NAME:redshift-subnet\n    CLUSTER_SUBNET_GROUP_DESCRIPTION:Subnet Group for Redshift\n    SUBNET_A_ID:subnet-********\n    \n```\n\n## \u30b5\u30d6\u30cd\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws redshift create-cluster-subnet-group \\\n  --cluster-subnet-group-name ${CLUSTER_SUBNET_GROUP_NAME}  \\\n  --description \"${CLUSTER_SUBNET_GROUP_DESCRIPTION}\" \\\n  --subnet-ids ${SUBNET_A_ID}\n```\n\n```json:\u7d50\u679c\n{\n    \"ClusterSubnetGroup\": {\n        \"Subnets\": [\n            {\n                \"SubnetStatus\": \"Active\",\n                \"SubnetIdentifier\": \"subnet-********\",\n                \"SubnetAvailabilityZone\": {\n                    \"Name\": \"ap-northeast-1a\"\n                }\n            }\n        ],\n        \"VpcId\": \"vpc-********\",\n        \"Description\": \"Subnet Group for Redshift\",\n        \"Tags\": [],\n        \"SubnetGroupStatus\": \"Complete\",\n        \"ClusterSubnetGroupName\": \"redshift-subnet\"\n    }\n}\n```\n\n# 2. Security Group\u306e\u4f5c\u6210\n\nRedshift\u30af\u30e9\u30b9\u30bf\u30fc\u3078\u306e\u30a2\u30af\u30bb\u30b9\u5236\u9650\u306fVPC\u306eSecurity Group\u3067\u884c\u3044\u307e\u3059\u3002\n\uff08VPC-Classic\u306a\u74b0\u5883\u3067\u306f\u5c02\u7528\u306eSecurity Group\u3092\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\uff09\n\n## Security Group\u540d\u306e\u6307\u5b9a\uff08Redshift\u30af\u30e9\u30b9\u30bf\u7528\uff09\n\n```bash:\u30b3\u30de\u30f3\u30c9\nSG_GROUP_NAME_REDSHIFT='Redshift'\nSG_DESCRIPTION_REDSHIFT='JAWS-UG CLI at Co-Edo'\n```\n\n## \u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n   SG_GROUP_NAME: ${SG_GROUP_NAME_REDSHIFT}\n   SG_DESCRIPTION: ${SG_DESCRIPTION_REDSHIFT}\n\nETX\n```\n\n```text:\u7d50\u679c\n\n   SG_GROUP_NAME: Redshift\n   SG_DESCRIPTION: JAWS-UG CLI at Co-Edo\n\n```\n\n## Redshift\u306e\u30af\u30e9\u30b9\u30bf\u30fc\u306b\u8a2d\u5b9a\u3059\u308bSecurity Group\u3092\u4f5c\u6210\n\n```bash:\u30b3\u30de\u30f3\u30c9\nSG_ID_REDSHIFT=`aws ec2 create-security-group --group-name ${SG_GROUP_NAME_REDSHIFT} \\\n  --description \"${SG_DESCRIPTION_REDSHIFT}\" --vpc-id ${VPC_ID} \\\n  --query GroupId \\\n  --output text` \\\n  && echo ${SG_ID_REDSHIFT}\n```\n\n```text:\u7d50\u679c\nsg-********\n```\n\n## \u4f5c\u6210\u3057\u305fSecurity Group\u3092\u78ba\u8a8d\n\n\uff08\u30a2\u30a6\u30c8\u30d0\u30a6\u30f3\u30c9\u306e\u901a\u4fe1\u306e\u307f\u5168\u3066\u8a31\u53ef\u3059\u308b\u8a2d\u5b9a\u306e\u307f\u3001\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\uff09\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 describe-security-groups --group-ids ${SG_ID_REDSHIFT}\n```\n\n```json:\u7d50\u679c\n{\n    \"SecurityGroups\": [\n        {\n            \"IpPermissionsEgress\": [\n                {\n                    \"IpProtocol\": \"-1\",\n                    \"IpRanges\": [\n                        {\n                            \"CidrIp\": \"0.0.0.0/0\"\n                        }\n                    ],\n                    \"UserIdGroupPairs\": [],\n                    \"PrefixListIds\": []\n                }\n            ],\n            \"Description\": \"JAWS-UG CLI at Co-Edo\",\n            \"IpPermissions\": [],\n            \"GroupName\": \"Redshift\",\n            \"VpcId\": \"vpc-********\",\n            \"OwnerId\": \"************\",\n            \"GroupId\": \"sg-********\"\n        }\n    ]\n}\n```\n\n## \u30a4\u30f3\u30d0\u30a6\u30f3\u30c9\u306e\u30eb\u30fc\u30eb\u3092\u8ffd\u52a0\n\nRedshift\u3078\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 authorize-security-group-ingress --group-id ${SG_ID_REDSHIFT} \\\n  --protocol 'tcp' --port 5439 --cidr ${PUBLIC_IP_ADDRESS}/32\n```\n\n```text:\u7d50\u679c\n\uff08\u8fd4\u5024\u7121\u3057\uff09\n```\n\n## \u8ffd\u52a0\u3055\u308c\u305f\u30eb\u30fc\u30eb\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 describe-security-groups --group-ids ${SG_ID_REDSHIFT}\n```\n\n```json:\u7d50\u679c\n{\n    \"SecurityGroups\": [\n        {\n            \"IpPermissionsEgress\": [\n                {\n                    \"IpProtocol\": \"-1\",\n                    \"IpRanges\": [\n                        {\n                            \"CidrIp\": \"0.0.0.0/0\"\n                        }\n                    ],\n                    \"UserIdGroupPairs\": [],\n                    \"PrefixListIds\": []\n                }\n            ],\n            \"Description\": \"JAWS-UG CLI at Co-Edo\",\n            \"IpPermissions\": [\n                {\n                    \"PrefixListIds\": [],\n                    \"FromPort\": 5439,\n                    \"IpRanges\": [\n                        {\n                            \"CidrIp\": \"**.**.**.**/32\"\n                        }\n                    ],\n                    \"ToPort\": 5439,\n                    \"IpProtocol\": \"tcp\",\n                    \"UserIdGroupPairs\": []\n                }\n            ],\n            \"GroupName\": \"Redshift\",\n            \"VpcId\": \"vpc-********\",\n            \"OwnerId\": \"************\",\n            \"GroupId\": \"sg-********\"\n        }\n    ]\n}\n```\n\n\n# 3\uff0e\u30af\u30e9\u30b9\u30bf\u306e\u4f5c\u6210\n\nRedshift\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n## \u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u6307\u5b9a\n\n```bash:\u30b3\u30de\u30f3\u30c9\nCLUSTER_NAME=\"mycluster\"\nDB_NAME=\"mydb\"\nPORT=\"5439\"\nMASTER_USER_NAME=\"awsuser\"\nMASTER_USER_PASSWORD=\"Pa55w0rd\"\nNODE_TYPE=\"dc1.large\"\nCLUSTER_TYPE=\"single-node\"\n```\n\n## \u305d\u306e\u4ed6\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3064\u3044\u3066\n\n\u305d\u306e\u4ed6\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u306f\u3001\u516c\u5f0f\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nhttp://docs.aws.amazon.com/cli/latest/reference/redshift/create-cluster.html\n\n## \u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n    CLUSTER_NAME:${CLUSTER_NAME}\n    DB_NAME:${DB_NAME}\n    PORT:${PORT}\n    MASTER_USER_NAME:${MASTER_USER_NAME}\n    MASTER_USER_PASSWORD:${MASTER_USER_PASSWORD}\n    NODE_TYPE:${NODE_TYPE}\n    CLUSTER_TYPE:${CLUSTER_TYPE}\n\nETX\n```\n\n```text:\u7d50\u679c\n\n```\n\n\n## \u30af\u30e9\u30b9\u30bf\u306e\u4f5c\u6210\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws redshift create-cluster \\\n  --db-name ${DB_NAME} \\\n  --cluster-identifier ${CLUSTER_NAME} \\\n  --cluster-type ${CLUSTER_TYPE} \\\n  --node-type ${NODE_TYPE} \\\n  --master-username ${MASTER_USER_NAME} \\\n  --master-user-password ${MASTER_USER_PASSWORD} \\\n  --port ${PORT} \\\n  --cluster-subnet-group-name ${CLUSTER_SUBNET_GROUP_NAME} \\\n  --vpc-security-group-ids ${SG_ID_REDSHIFT}\n```\n\n```json:\u7d50\u679c\n{\n    \"Cluster\": {\n        \"IamRoles\": [],\n        \"ClusterVersion\": \"1.0\",\n        \"NumberOfNodes\": 1,\n        \"VpcId\": \"vpc-********\",\n        \"NodeType\": \"dc1.large\",\n        \"PubliclyAccessible\": true,\n        \"Tags\": [],\n        \"MasterUsername\": \"awsuser\",\n        \"ClusterParameterGroups\": [\n            {\n                \"ParameterGroupName\": \"default.redshift-1.0\",\n                \"ParameterApplyStatus\": \"in-sync\"\n            }\n        ],\n        \"Encrypted\": false,\n        \"ClusterSecurityGroups\": [],\n        \"AllowVersionUpgrade\": true,\n        \"VpcSecurityGroups\": [\n            {\n                \"Status\": \"active\",\n                \"VpcSecurityGroupId\": \"sg-********\"\n            }\n        ],\n        \"ClusterSubnetGroupName\": \"redshift-sg\",\n        \"AutomatedSnapshotRetentionPeriod\": 1,\n        \"ClusterStatus\": \"creating\",\n        \"ClusterIdentifier\": \"mycluster\",\n        \"DBName\": \"mydb\",\n        \"PreferredMaintenanceWindow\": \"sun:14:30-sun:15:00\",\n        \"PendingModifiedValues\": {\n            \"MasterUserPassword\": \"****\"\n        }\n    }\n}\n```\n\n## \u4f5c\u6210\u3057\u305f\u30af\u30e9\u30b9\u30bf\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws redshift describe-clusters --cluster-identifier ${CLUSTER_NAME}\n```\n\n```json:\u7d50\u679c\n{\n    \"Clusters\": [\n        {\n            \"PubliclyAccessible\": true,\n            \"MasterUsername\": \"awsuser\",\n            \"VpcSecurityGroups\": [\n                {\n                    \"Status\": \"active\",\n                    \"VpcSecurityGroupId\": \"sg-********\"\n                }\n            ],\n            \"NumberOfNodes\": 1,\n            \"PendingModifiedValues\": {\n                \"MasterUserPassword\": \"****\"\n            },\n            \"VpcId\": \"vpc-********\",\n            \"ClusterVersion\": \"1.0\",\n            \"Tags\": [],\n            \"AutomatedSnapshotRetentionPeriod\": 1,\n            \"ClusterParameterGroups\": [\n                {\n                    \"ParameterGroupName\": \"default.redshift-1.0\",\n                    \"ParameterApplyStatus\": \"in-sync\"\n                }\n            ],\n            \"DBName\": \"mydb\",\n            \"PreferredMaintenanceWindow\": \"sun:14:30-sun:15:00\",\n            \"IamRoles\": [],\n            \"AllowVersionUpgrade\": true,\n            \"ClusterSubnetGroupName\": \"redshift-sg\",\n            \"ClusterSecurityGroups\": [],\n            \"ClusterIdentifier\": \"mycluster\",\n            \"ClusterNodes\": [\n                {\n                    \"NodeRole\": \"SHARED\",\n                    \"PublicIPAddress\": \"**.**.**.**\"\n                }\n            ],\n            \"AvailabilityZone\": \"ap-northeast-1a\",\n            \"NodeType\": \"dc1.large\",\n            \"Encrypted\": false,\n            \"ClusterRevisionNumber\": \"1043\",\n            \"ClusterStatus\": \"creating\"\n        }\n    ]\n}\n```\n\n\u4ee5\u4e0a\n", "tags": ["AWS", "aws-cli", "redshift"]}