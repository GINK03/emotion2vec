{"tags": ["MacOSX", "timemachine", "Netatalk"], "context": "\n\nHow to delete old Time Machine backup with tmutil command.\n\nObjective:\n\njust my memorandum :)\n\n\nSystem:\n\nMy Time Machine:\n\n\nUbuntu 14.04 trusty\n\nnetatalk 2.2.2\n\n\nnetatalk configuration\n\n# cat /etc/netatalk/AppleVolumes.default | grep \"TimeMachine-for-mba1\"\n/mnt/export/TimeMachine4  \"TimeMachine-for-mba1\"      options:usedots,upriv,tm ea:ad allow:hirofumi volsizelimit:250000\n\n\nClient:\n\nMac OS X 10.11.3 (El Capitan)\n\n# tmutil destinationinfo\n====================================================\nName          : TimeMachine-for-mba1\nKind          : Network\nURL           : afp://hirofumi@fs1._afpovertcp._tcp.local./TimeMachine-for-mba1\nMount Point   : /Volumes/TimeMachine-for-mba1\nID            : 41302FE3-081D-4034-8B81-F7C0FD3A0C3C\n\n\nlist backups:\ntmutil listbackups\n\n\nsample\n# tmutil listbackups\n/Volumes/Time Machine Backups/Backups.backupdb/Hirofumi\u2019s MacBook Air/2016-03-31-001335\n/Volumes/Time Machine Backups/Backups.backupdb/Hirofumi\u2019s MacBook Air/2016-04-01-005550\n/Volumes/Time Machine Backups/Backups.backupdb/Hirofumi\u2019s MacBook Air/2016-04-02-003630\n(snip)\n\n\n\ndelete backup(s):\ntmutil delete <backup_target>\n\n\nsample_for_delete_oldest\n# tmutil delete \"`tmutil listbackups | head -1`\"\nDeleting: /Volumes/Time Machine Backups/Backups.backupdb/Hirofumi\u2019s MacBook Air/2016-03-31-001335\nDeleted (5.3G): /Volumes/Time Machine Backups/Backups.backupdb/Hirofumi\u2019s MacBook Air/2016-03-31-001335\nTotal deleted: 5.3G\n\n\n\nsample_for_delete_old_3\n# for ((x=1; x<=3; x++)) ; do tmutil delete \"`tmutil listbackups | head -1`\" ; done\nDeleting: /Volumes/Time Machine Backups/Backups.backupdb/Hirofumi\u2019s MacBook Air/2016-04-01-005550\nDeleted (1.9G): /Volumes/Time Machine Backups/Backups.backupdb/Hirofumi\u2019s MacBook Air/2016-04-01-005550\nTotal deleted: 1.9G\nDeleting: /Volumes/Time Machine Backups/Backups.backupdb/Hirofumi\u2019s MacBook Air/2016-04-02-003630\nDeleted (2.0G): /Volumes/Time Machine Backups/Backups.backupdb/Hirofumi\u2019s MacBook Air/2016-04-02-003630\nTotal deleted: 2.0G\nDeleting: /Volumes/Time Machine Backups/Backups.backupdb/Hirofumi\u2019s MacBook Air/2016-04-03-010626\nDeleted (7.6G): /Volumes/Time Machine Backups/Backups.backupdb/Hirofumi\u2019s MacBook Air/2016-04-03-010626\nTotal deleted: 7.6G\n\n\n\nstart backup:\ntmutil startbackup\n\n\nshow backup state:\nref. http://apple.stackexchange.com/questions/162464/time-machine-progress-from-the-command-line\ntmutil status\n\n\nsample1\n# tmutil status\nBackup session status:\n{\n    BackupPhase = Copying;\n    ClientID = \"com.apple.backupd\";\n    DateOfStateChange = \"2016-04-11 12:07:18 +0000\";\n    DestinationID = \"41302FE3-081D-4034-8B81-F7C0FD3A0C3C\";\n    DestinationMountPoint = \"/Volumes/Time Machine Backups\";\n    Percent = \"0.04944647446240578\";\n    Progress =     {\n        TimeRemaining = 3823;\n        \"_raw_totalBytes\" = 4347141887;\n        bytes = 238834267;\n        files = 9550;\n        totalBytes = 4781856075;\n        totalFiles = 9550;\n    };\n    Running = 1;\n    Stopping = 0;\n    \"_raw_Percent\" = \"0.05494052718045087\";\n}\n\n\n\nsample2\n# tmutil status | awk '/_raw_Percent/ {print $3}' | grep -o '[0-9].[0-9]\\+' | awk '{print $1*100,\"% backed up\"}'\n17.8677 % backed up\n\n\n# How to delete old Time Machine backup with tmutil command.\n\n## Objective:\n\n* just my memorandum :)\n\n## System:\n\n### My Time Machine:\n\n* Ubuntu 14.04 trusty\n    * netatalk 2.2.2\n\n* netatalk configuration\n\n```shell-session\n# cat /etc/netatalk/AppleVolumes.default | grep \"TimeMachine-for-mba1\"\n/mnt/export/TimeMachine4  \"TimeMachine-for-mba1\"      options:usedots,upriv,tm ea:ad allow:hirofumi volsizelimit:250000\n```\n\n### Client:\n\n* Mac OS X 10.11.3 (El Capitan)\n\n```shell-session\n# tmutil destinationinfo\n====================================================\nName          : TimeMachine-for-mba1\nKind          : Network\nURL           : afp://hirofumi@fs1._afpovertcp._tcp.local./TimeMachine-for-mba1\nMount Point   : /Volumes/TimeMachine-for-mba1\nID            : 41302FE3-081D-4034-8B81-F7C0FD3A0C3C\n```\n\n## list backups:\n\n```shell-session\ntmutil listbackups\n```\n```shell-session:sample\n# tmutil listbackups\n/Volumes/Time Machine Backups/Backups.backupdb/Hirofumi\u2019s MacBook Air/2016-03-31-001335\n/Volumes/Time Machine Backups/Backups.backupdb/Hirofumi\u2019s MacBook Air/2016-04-01-005550\n/Volumes/Time Machine Backups/Backups.backupdb/Hirofumi\u2019s MacBook Air/2016-04-02-003630\n(snip)\n```\n\n## delete backup(s):\n\n```shell-session\ntmutil delete <backup_target>\n```\n```shell-session:sample_for_delete_oldest\n# tmutil delete \"`tmutil listbackups | head -1`\"\nDeleting: /Volumes/Time Machine Backups/Backups.backupdb/Hirofumi\u2019s MacBook Air/2016-03-31-001335\nDeleted (5.3G): /Volumes/Time Machine Backups/Backups.backupdb/Hirofumi\u2019s MacBook Air/2016-03-31-001335\nTotal deleted: 5.3G\n```\n```shell-session:sample_for_delete_old_3\n# for ((x=1; x<=3; x++)) ; do tmutil delete \"`tmutil listbackups | head -1`\" ; done\nDeleting: /Volumes/Time Machine Backups/Backups.backupdb/Hirofumi\u2019s MacBook Air/2016-04-01-005550\nDeleted (1.9G): /Volumes/Time Machine Backups/Backups.backupdb/Hirofumi\u2019s MacBook Air/2016-04-01-005550\nTotal deleted: 1.9G\nDeleting: /Volumes/Time Machine Backups/Backups.backupdb/Hirofumi\u2019s MacBook Air/2016-04-02-003630\nDeleted (2.0G): /Volumes/Time Machine Backups/Backups.backupdb/Hirofumi\u2019s MacBook Air/2016-04-02-003630\nTotal deleted: 2.0G\nDeleting: /Volumes/Time Machine Backups/Backups.backupdb/Hirofumi\u2019s MacBook Air/2016-04-03-010626\nDeleted (7.6G): /Volumes/Time Machine Backups/Backups.backupdb/Hirofumi\u2019s MacBook Air/2016-04-03-010626\nTotal deleted: 7.6G\n```\n\n## start backup:\n\n```shell-session\ntmutil startbackup\n```\n\n## show backup state:\n\nref. http://apple.stackexchange.com/questions/162464/time-machine-progress-from-the-command-line\n\n```shell-session\ntmutil status\n```\n```shell-session:sample1\n# tmutil status\nBackup session status:\n{\n    BackupPhase = Copying;\n    ClientID = \"com.apple.backupd\";\n    DateOfStateChange = \"2016-04-11 12:07:18 +0000\";\n    DestinationID = \"41302FE3-081D-4034-8B81-F7C0FD3A0C3C\";\n    DestinationMountPoint = \"/Volumes/Time Machine Backups\";\n    Percent = \"0.04944647446240578\";\n    Progress =     {\n        TimeRemaining = 3823;\n        \"_raw_totalBytes\" = 4347141887;\n        bytes = 238834267;\n        files = 9550;\n        totalBytes = 4781856075;\n        totalFiles = 9550;\n    };\n    Running = 1;\n    Stopping = 0;\n    \"_raw_Percent\" = \"0.05494052718045087\";\n}\n```\n```shell-session:sample2\n# tmutil status | awk '/_raw_Percent/ {print $3}' | grep -o '[0-9].[0-9]\\+' | awk '{print $1*100,\"% backed up\"}'\n17.8677 % backed up\n```\n"}