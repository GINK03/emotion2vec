{"context": " More than 1 year has passed since last update.This is a record of my trial to use Google Drive API on Ruby (and on Rails).\n\nFor installed applications\nDifferences from web applications\n-> Include  some parameters in authorization code request at a first authorization (access_type=offline& approval_prompt=force)\n-> Require refresh_token ( and access_token ,too).\n\nMy sample code is following.\n\nqiita.rb\nrequire 'google/api_client'\n  ##\n  # Retrieve a list of File resources.\n  #\n  CLIENT_ID = ' your client ID '\n  CLIENT_SECRET = ' your client secret '\n  REDIRECT_URI = ' your redirect url '\n  OAUTH_SCOPE = 'https://www.googleapis.com/auth/drive'\n\n # Initialize the client & Google+ API\n  client = Google::APIClient.new\n  # Initialize OAuth 2.0 client\n  # client.authorizaton returns Signet::OAuth2::Client objext\n\n  client.authorization.client_id = CLIENT_ID\n  client.authorization.client_secret = CLIENT_SECRET\n  client.authorization.redirect_uri = REDIRECT_URI\n  client.authorization.scope = OAUTH_SCOPE\n\n  # Request authorization\n  redirect_uri = client.authorization.authorization_uri\n  # You will get a redirect URL, and input it to an address var of a browser.\n  puts redirect_uri\n  # When prompted ,copy an authorization code and paste it to your terminal.\n  client.authorization.code = gets.strip\n\n  # Get tokens\n  # ex. {\"access_token\"=>\"ya296ZSGyxLfflpv1ADxHjCKvZLoKyVylgjiLhW1sX_fKw\",\n  #      \"token_type\"=>\"Bearer\", \"expires_in\"=>3600,\n  #      \"refresh_token\"=>\"1/4jaoSQ_edOCVegeaORYEdlwMiwyLJB3E1uNz3hfKQto\"}\n  tokens = client.authorization.fetch_access_token\n\n  #Update tokens and retrieve a list of File Resources.\n begin\n    client.authorization.update_token!(\n        :refresh_token => tokens[\"refresh_token\"],\n        :access_token => tokens[\"access_token\"],\n        :expires_in => tokens[\"expires_in\"]\n    )\n    drive = client.discovered_api('drive', 'v2')  \nrescue\n    puts \"Here is in resucue\"\n ensure\n    result = Array.new\n    page_token = nil\n    begin\n      parameters = {}\n      if page_token.to_s != ''\n        parameters['pageToken'] = page_token\n      end\n      api_result = client.execute(\n          :api_method => drive.files.list,\n          :parameters => parameters)\n      if api_result.status == 200\n        files = api_result.data\n        result.concat(files.items)\n      else\n        puts \"An error occurred: #{result.data['error']['message']}\"\n        page_token = nil\n      end\n   end while page_token.to_s != ''\n   # Printing file names\n   result.each { |item|\n      puts item.title\n   }\nend\n\n\n\u53c2\u8003\u306b\u3057\u305fURL\nhttp://www.eisbahn.jp/yoichiro/2012/10/google-drive-api-ruby-on-rails.html\nhttp://www.eisbahn.jp/yoichiro/2012/05/google_oauth2_web_server_profile_refreshtoken.html\nhttp://code.google.com/p/oauth-signet/wiki/SignetOAuth2Client\nhttp://rubydoc.info/github/google/google-api-ruby-client/\nhttps://developers.google.com/drive/v2/reference/files#resource\n\u3044\u3058\u3087\nThis is a record of my trial to use Google Drive API on Ruby (and on Rails).\n\n1. For installed applications\nDifferences from web applications\n-> Include  some parameters in authorization code request at a first authorization (access_type=offline& approval_prompt=force)\n-> Require refresh_token ( and access_token ,too).\n\nMy sample code is following.\n\n```ruby:qiita.rb\nrequire 'google/api_client'\n  ##\n  # Retrieve a list of File resources.\n  #\n  CLIENT_ID = ' your client ID '\n  CLIENT_SECRET = ' your client secret '\n  REDIRECT_URI = ' your redirect url '\n  OAUTH_SCOPE = 'https://www.googleapis.com/auth/drive'\n  \n # Initialize the client & Google+ API\n  client = Google::APIClient.new\n  # Initialize OAuth 2.0 client\n  # client.authorizaton returns Signet::OAuth2::Client objext\n\n  client.authorization.client_id = CLIENT_ID\n  client.authorization.client_secret = CLIENT_SECRET\n  client.authorization.redirect_uri = REDIRECT_URI\n  client.authorization.scope = OAUTH_SCOPE\n\n  # Request authorization\n  redirect_uri = client.authorization.authorization_uri\n  # You will get a redirect URL, and input it to an address var of a browser.\n  puts redirect_uri\n  # When prompted ,copy an authorization code and paste it to your terminal.\n  client.authorization.code = gets.strip\n\n  # Get tokens\n  # ex. {\"access_token\"=>\"ya296ZSGyxLfflpv1ADxHjCKvZLoKyVylgjiLhW1sX_fKw\",\n  #      \"token_type\"=>\"Bearer\", \"expires_in\"=>3600,\n  #      \"refresh_token\"=>\"1/4jaoSQ_edOCVegeaORYEdlwMiwyLJB3E1uNz3hfKQto\"}\n  tokens = client.authorization.fetch_access_token\n \n  #Update tokens and retrieve a list of File Resources.\n begin\n    client.authorization.update_token!(\n        :refresh_token => tokens[\"refresh_token\"],\n        :access_token => tokens[\"access_token\"],\n        :expires_in => tokens[\"expires_in\"]\n    )\n    drive = client.discovered_api('drive', 'v2')  \nrescue\n    puts \"Here is in resucue\"\n ensure\n    result = Array.new\n    page_token = nil\n    begin\n      parameters = {}\n      if page_token.to_s != ''\n        parameters['pageToken'] = page_token\n      end\n      api_result = client.execute(\n          :api_method => drive.files.list,\n          :parameters => parameters)\n      if api_result.status == 200\n        files = api_result.data\n        result.concat(files.items)\n      else\n        puts \"An error occurred: #{result.data['error']['message']}\"\n        page_token = nil\n      end\n   end while page_token.to_s != ''\n   # Printing file names\n   result.each { |item|\n      puts item.title\n   }\nend\n```\n\n\n\u53c2\u8003\u306b\u3057\u305fURL\nhttp://www.eisbahn.jp/yoichiro/2012/10/google-drive-api-ruby-on-rails.html\nhttp://www.eisbahn.jp/yoichiro/2012/05/google_oauth2_web_server_profile_refreshtoken.html\nhttp://code.google.com/p/oauth-signet/wiki/SignetOAuth2Client\nhttp://rubydoc.info/github/google/google-api-ruby-client/\nhttps://developers.google.com/drive/v2/reference/files#resource\n\u3044\u3058\u3087", "tags": ["Ruby", "RubyMine"]}