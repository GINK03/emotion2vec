{"context": "\u30af\u30e9\u30b9\u30bf\u30fc\u5206\u6790\u306f\n\n\u8ddd\u96e2\u884c\u5217\u306e\u751f\u6210\uff08\u985e\u4f3c\u5ea6\u884c\u5217\u3067\u306f\u306a\u3044\uff01\uff09\n\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u306e\u5b9f\u884c\n\n\u3068\u3044\u3046\u6d41\u308c\u306b\u306a\u308b\u3002\n\u305d\u308c\u305e\u308c\u306e\u30b9\u30c6\u30c3\u30d7\u3067\u3001\u63a1\u7528\u3059\u308b\n\n\u8ddd\u96e2\u306e\u7a2e\u985e\n\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u306e\u65b9\u6cd5\n\n\u304c\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u5909\u6570\u3068\u306a\u308b\u3002\n\n\u8ddd\u96e2\u884c\u5217\u3092\u751f\u6210\u3059\u308b\n\u985e\u4f3c\u5ea6\u884c\u5217\u3067\u306f\u306a\u304f\u8ddd\u96e2\u884c\u5217\u3092\u4f5c\u308b\u3002\n\u76f4\u611f\u7684\u306b\u306f\u30c7\u30fc\u30bf\u304b\u3089\u8ddd\u96e2\u306e\u6307\u6a19\uff08\u3069\u308c\u3060\u3051\u96e2\u308c\u3066\u3044\u308b\u304b\uff09\u3067\u306f\u306a\u304f\u985e\u4f3c\u5ea6\uff08\u3069\u308c\u3060\u3051\u8fd1\u3044\u304b\uff09\u306e\u6307\u6a19\u3092\u62bd\u51fa\u3057\u3001\u305d\u3053\u304b\u3089\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u3057\u305f\u3044\u30b1\u30fc\u30b9\u304c\u591a\u3044\u306e\u3060\u304c\u3001\u3042\u304f\u307e\u3067\u985e\u4f3c\u5ea6\u6307\u6a19\u306b\u57fa\u3065\u3044\u305f\u8ddd\u96e2\u884c\u5217\u3092\u751f\u6210\u3059\u308b\u306e\u3067\u3042\u308b\u3002\n\u901a\u5e38\u306edist\u95a2\u6570\u3067\u306f\u5bfe\u5fdc\u3059\u308b\u8ddd\u96e2\u306e\u7a2e\u985e\u304c\u5c11\u306a\u3044\u306e\u3067proxy\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f7f\u3046\u3002\n\u8ddd\u96e2\u884c\u5217\u3092\u751f\u6210\u3059\u308b\u30e1\u30bd\u30c3\u30c9\u306fdist(data, method=\"\u30e1\u30bd\u30c3\u30c9\u540d\")\u3002\nrequire(proxy)\n# \u30c7\u30fc\u30bf\u306e1\u5217\u76ee\u304cID\u306a\u306e\u3067\u9664\u5916\ndcos <- proxy::dist(df[,2:ncol(df)], method=\"cosine\")\n\n\u623b\u308a\u5024\u306fdist\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002\u884c\u5217\u3084\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u3068\u306f\u7570\u306a\u308b\u306e\u3067\u6271\u3044\u306b\u6ce8\u610f\u3002\ndist\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u540c\u3058\u6b21\u5143\u306a\u3089\u52a0\u6e1b\u4e57\u9664\u304c\u53ef\u80fd\u3002\u305f\u3068\u3048\u3070dist1, dist2\u3068\u3082\u306bdist\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5834\u5408\u3001\ndist1 + dist2\ndist1 - dist2\ndist1 * dist2\ndist1 / dist2\n\n\u3044\u305a\u308c\u3082\u5bfe\u5fdc\u3059\u308b\u8981\u7d20\u3092\u52a0\u6e1b\u4e57\u9664\u3057\u305fdist\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u8fd4\u3063\u3066\u304f\u308b\u3002\n\n\u985e\u4f3c\u5ea6\uff08\u3069\u308c\u3060\u3051\u8fd1\u3044\u304b\uff09\u306e\u7a2e\u985e\n\n\u6570\u5024\u30d9\u30af\u30c8\u30eb\u306b\u5bfe\u3059\u308b\u3082\u306e\n\n\n\u30b3\u30b5\u30a4\u30f3\u985e\u4f3c\u5ea6\uff08cosine\uff09\n\u62e1\u5f35Jaccard\uff08eJaccard\uff09\nfuzzy Jaccard\uff08fJaccard\uff09\nPearson\u306e\u7a4d\u7387\u76f8\u95a2\u4fc2\u6570\uff08correlation\uff09\n\n\n0/1\u5024\u306b\u5bfe\u3059\u308b\u3082\u306e\uff08\u96c6\u5408\u306b\u5165\u308b or not\uff09\n\n\nJaccard\u4fc2\u6570\nTanimoto\u4fc2\u6570\nSimpson\u4fc2\u6570\nDice\u4fc2\u6570\nSimpson-Jaccard\u4fc2\u6570\u306f\u76f4\u63a5\u7b97\u51fa\u3067\u304d\u306a\u3044\u304c\u3001(dSimpson + dJaccard) / 2\u3068\u3059\u308b\u3060\u3051\u3067Simpson-Jaccard\u306e\u8ddd\u96e2\u884c\u5217\u3092\u53d6\u5f97\u3067\u304d\u308b\n\n\n2x2\u306e\u5206\u5272\u8868\u306b\u5bfe\u3059\u308b\u3082\u306e\n\n\n\u30d5\u30a1\u30a4\u4fc2\u6570\uff08Phi\uff09\n\u30e6\u30fc\u30eb\u306eQ\uff08Yule\uff09\n\n\n\n\n\u8ddd\u96e2\uff08\u3069\u308c\u3060\u3051\u96e2\u308c\u3066\u3044\u308b\u304b\uff09\u306e\u7a2e\u985e\u2192\u6570\u5024\u30d9\u30af\u30c8\u30eb\u306b\u5bfe\u3059\u308b\u3082\u306e\n\n\u30e6\u30fc\u30af\u30ea\u30c3\u30c9\u8ddd\u96e2\uff08Euclidean\uff09\n\u30de\u30cf\u30e9\u30ce\u30d3\u30b9\u8ddd\u96e2\uff08Mahalanobis\uff09\n\u30de\u30f3\u30cf\u30c3\u30bf\u30f3\u8ddd\u96e2\uff08Manhattan\uff09\n\u30c1\u30a7\u30d3\u30b7\u30a7\u30d5\u8ddd\u96e2\uff08Chebyshev\uff09\n\u30df\u30f3\u30b3\u30d5\u30b9\u30ad\u30fc\u8ddd\u96e2\uff08Minkowski\uff09\n\u30ad\u30e3\u30f3\u30d9\u30e9\u8ddd\u96e2\uff08Canberra\uff09\n\n\u30c7\u30fc\u30bf\u306e1\u5217\u76ee\u304cID\u2192\u9664\u5916\u3059\u308b\u5834\u5408\ndcos <- proxy::dist(df[, 2:ncol(df)], method=\"cosine\")\ndjcd <- proxy::dist(df[, 2:ncol(df)], method=\"eJaccard\")\ndcor <- proxy::dist(df[, 2:ncol(df)], method=\"correlation\")\n\n\nMatrix\u5f62\u5f0f\u306e\u884c\u5217\u306b\u5bfe\u3059\u308b\u985e\u4f3c\u5ea6\u306e\u7b97\u51fa\u30e9\u30a4\u30d6\u30e9\u30ea\nR\u306e\u901a\u5e38\u306e\u884c\u5217\u3084\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u3067\u306f\u30c7\u30a3\u30e1\u30f3\u30b7\u30e7\u30f3\u306e\u5927\u304d\u3044sparse matrix\uff08\u758e\u884c\u5217\uff09\u3092\u6271\u3046\u306e\u304c\u56f0\u96e3\u3067\u3042\u308b\u3002\nMatrix\u3068\u3044\u3046\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u884c\u5217\u3092\u72ec\u81ea\u306e\u5f62\u5f0f\u3067\u6271\u3046\u30d1\u30c3\u30b1\u30fc\u30b8\u3067\u3001\u4e3b\u306bsparse matrix\u306a\u3069\u3092\u6271\u3046\u306e\u306b\u5f37\u3044\u3002\n\u3053\u306eMatrix\u5f62\u5f0f\u306e\u884c\u5217\u306b\u5bfe\u3057\u3066\u985e\u4f3c\u5ea6\u3092\u8a08\u7b97\u3059\u308b\u95a2\u6570\u3092\u4f5c\u3063\u305f\u3002\n\n\njcdSparse(): \u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u306b\u5bfe\u3059\u308bJaccard\u4fc2\u6570\n\nsmpSparse(): \u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u306b\u5bfe\u3059\u308bSimpson\u4fc2\u6570\n\nejcdSparse(): \u9023\u7d9a\u91cf\u306b\u62e1\u5f35\u3057\u305fJaccard\u4fc2\u6570\n\nesmpSparse(): \u9023\u7d9a\u91cf\u306b\u62e1\u5f35\u3057\u305fSimpson\u4fc2\u6570\n\ncosSparse(): \u30b3\u30b5\u30a4\u30f3\u985e\u4f3c\u5ea6\n\njcdSparse <- function(X){\n    X <- as(X, \"dgCMatrix\")\n    X@x <- rep(1, length(X@x)) # \u975e\u30bc\u30ed\u8981\u7d20\u306f\u3059\u3079\u30661\u306b\u7f6e\u63db\n    vec_sum_col <- colSums(X)\n    AB <- crossprod(X)\n    sim <- AB / (vec_sum_col - t(AB - vec_sum_col)) # \u307e\u3068\u3081\u3066\n    return(sim)\n}\n\nsmpSparse <- function(X){\n    X <- as(X, \"dgCMatrix\")\n    X@x <- rep(1, length(X@x)) # \u975e\u30bc\u30ed\u8981\u7d20\u306f\u3059\u3079\u30661\u306b\u7f6e\u63db\n    vec_sum_col <- colSums(X)\n    AB <- crossprod(X)\n    n <- length(vec_sum_col)\n    A <- matrix(rep(vec_sum_col, n), n)\n    B <- t(A)\n    mat_A_lt_B <- A < B\n    sim <- AB / (A * mat_A_lt_B + B * (1 - mat_A_lt_B))\n    return(sim)\n}\n\nejcdSparse <- function(X){\n    X <- as(X, \"dgCMatrix\")\n    vec_xx <- colSums(X^2)\n    mat_xy <- crossprod(X)\n    sim <- mat_xy / (vec_xx - t(mat_xy - vec_xx)) # \u307e\u3068\u3081\u3066\n    return(sim)\n}\n\nesmpSparse <- function(X){\n    X <- as(X, \"dgCMatrix\")\n    vec_xx <- colSums(X^2)\n    mat_xy <- crossprod(X)\n    n <- length(vec_xx)\n    mat_xx <- matrix(rep(vec_xx, n), n)\n    mat_yy <- t(mat_xx)\n    mat_x_lt_y <- mat_xx < mat_yy\n    sim <- mat_xy / (mat_xx * mat_x_lt_y + mat_yy * (1 - mat_x_lt_y))\n    return(sim)\n}\n\ncosSparse <- function (X) {\n    if(class(X)[[1]] != \"dgCMatrix\") {\n        X <- as(X, \"dgCMatrix\")\n    }\n    X_normalized_col <- X %*% Diagonal(x = 1 / sqrt(colSums(X^2))) # \u307e\u3068\u3081\u3066\n    sim <- crossprod(X_normalized_col)\n    return(sim)\n}\n\n\n\u8ddd\u96e2\u884c\u5217\u3068\u985e\u4f3c\u5ea6\u884c\u5217\u306e\u95a2\u4fc2\n\n\u985e\u4f3c\u5ea6\u306f\u4e00\u81f4\u3059\u308b\u3068\u304d\u306b1\u3092\u3068\u308b\u3002\u72ec\u7acb\u306a\u30890\u3001\u6b63\u53cd\u5bfe\u306a\u3089-1\n\u8ddd\u96e2\u306f\u5927\u304d\u3044\u307b\u3046\u304c\u96e2\u308c\u3066\u3044\u308b\n\ndistance = 1 - similarity\n\nPearson\u306e\u7a4d\u7387\u76f8\u95a2\u4fc2\u6570\u304b\u3089\u8ddd\u96e2\u884c\u5217\u3092\u751f\u6210\u3059\u308b\u306e\u3082\u3053\u306e\u539f\u7406\u3002\n\uff08\u53c2\u8003\uff09\n\n\u985e\u4f3c\u5ea6\u3068\u8ddd\u96e2\u306e\u6982\u5ff5\nhttp://wikiwiki.jp/cattail/?%CE%E0%BB%F7%C5%D9%A4%C8%B5%F7%CE%A5\n\n\u305d\u306e\u4ed6\u306e\u8ddd\u96e2\nhttp://www.nysol.sakura.ne.jp/mcmd/jp/sect-msim.html\n\n\u76f4\u63a5\u5b9f\u88c5\u3059\u308b\u306a\u3089\nhttp://sucrose.hatenablog.com/entry/2012/11/30/132803\n\n\u8ddd\u96e2\u306b\u95a2\u3059\u308bR\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u95a2\u6570\nhttp://www.slideshare.net/yuifu/ss-11776646\n\n{proxy}\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\u8ddd\u96e2\u3068\u985e\u4f3c\u5ea6\u306e\u4e00\u89a7\nhttps://cran.r-project.org/web/packages/proxy/vignettes/overview.pdf\n\n\n\n\u4e3b\u6210\u5206\u5206\u6790\u3068\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\n# \u4e3b\u6210\u5206\u5f97\u70b9\u884c\u5217\u306e\u62bd\u51fa\nscores <- prcomp.users$x[,1:50]\n# \u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\nkm.scores <- kmeans(scores, 10)\n# \u30af\u30e9\u30b9\u30bf\u6570\u78ba\u8a8d\ntable(km.scores$cluster)\n\n# \u30d7\u30ed\u30c3\u30c8\nscore.pc1 <-prcomp.users$x[,1]\nscore.pc2 <-prcomp.users$x[,2]\n#plot(score.pc1, score.pc2, xlab=\"PC1\", ylab=\"PC2\", col=km.scores$cluster)\ndf<-data.frame(\n    UID=names(score.pc1), \n    PC1=score.pc1, \n    PC2=score.pc2, \n    Cluster=factor(km.scores$cluster)\n)\nggplot(df, aes(x=PC1, y=PC2, label=UID, color=Cluster)) + \n       geom_point() + geom_text(size = 4, colour = \"black\", vjust = -1)\n\nhttp://www.statmethods.net/advstats/cluster.html\n\n\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u306e\u5b9f\u884c\n\n\u968e\u5c64\u7684\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\n\u30e6\u30fc\u30b6\u5206\u985e\u306a\u3069\u30d3\u30c3\u30b0\u30c7\u30fc\u30bf\u306b\u306f\u4e0d\u5411\u304d\u3002\n\nhclust()\u306e\u5f15\u6570method\u306e\u7a2e\u985e\n\n\u6700\u8fd1\u96a3\u6cd5: single\n\n\u6700\u9060\u96a3\u6cd5: complete\n\n\u7fa4\u5e73\u5747\u6cd5\uff1dUPGMA: average\n\n\u91cd\u5fc3\u6cd5\uff1dUPGMC: centroid\n\n\u30e1\u30c7\u30a3\u30a2\u30f3\u6cd5\uff1dWPGMC: median\n\nWard\u6cd5\uff1d\u6700\u5c0f\u5206\u6563\u6cd5\uff08\u90e1\u5185\u5206\u6563\u3068\u7fa4\u9593\u5206\u6563\u306e\u6bd4\u3092\u6700\u5927\u5316\uff09: ward.D2\n\nMcQuitty\u6cd5\uff1dWPGMA: mcquitty\n\n\n\n\u30c7\u30f3\u30c9\u30ed\u30b0\u30e9\u30e0\u306e\u751f\u6210\n\u8ddd\u96e2\u306e\u7a2e\u985e\u00d7\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u306e\u624b\u6cd5\u3067\u6bd4\u8f03\u3059\u308b\u3088\u306d\u3002\n\n\u30b3\u30b5\u30a4\u30f3\u985e\u4f3c\u5ea6\u306e\u8ddd\u96e2\u884c\u5217dcos\n\nJaccard\u4fc2\u6570\u306e\u8ddd\u96e2\u884c\u5217djcd\n\nSimpson\u4fc2\u6570\u306e\u8ddd\u96e2\u884c\u5217dsmp\n\nTanimoto\u4fc2\u6570\u306e\u8ddd\u96e2\u884c\u5217dtnm\n\nDice\u4fc2\u6570\u306e\u8ddd\u96e2\u884c\u5217ddce\n\n\n\u306b\u5bfe\u3057\u3066\n\nWard\u6cd5\n\u7fa4\u5e73\u5747\u6cd5\uff08UPGMA\uff09\nMcQuitty\u6cd5\n\n\u3067\u968e\u5c64\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u3057\u305f\u7d50\u679c\u3092\u30c7\u30f3\u30c9\u30ed\u30b0\u30e9\u30e0\u3067\u6bd4\u8f03\u3059\u308b\u3002\npdf(\"hclust.pdf\")\nop <- par(mfrow=c(2,3))\n{ # Ward\u6cd5\n    wd.dcos <- hclust(dcos, method=\"ward.D2\")\n    wd.djcd <- hclust(djcd, method=\"ward.D2\")\n    wd.dsmp <- hclust(dsmp, method=\"ward.D2\")\n    wd.dtnm <- hclust(dtnm, method=\"ward.D2\")\n    wd.ddce <- hclust(ddce, method=\"ward.D2\")\n\n    plot(wd.dcos, main=\"cosine similarity/Ward\")\n    plot(wd.djcd, main=\"Jaccard index/Ward\")\n    plot(wd.dsmp, main=\"Simpson index/Ward\")\n    plot(wd.dtnm, main=\"Tanimoto index/Ward\")\n    plot(wd.ddce, main=\"Dice index/Ward\")\n}\npar(op)\nop <- par(mfrow=c(2,3))\n{ # \u7fa4\u5e73\u5747\u6cd5\uff08UPGMA\uff09\n    ga.dcos <- hclust(dcos, method=\"average\")\n    ga.djcd <- hclust(djcd, method=\"average\")\n    ga.dsmp <- hclust(dsmp, method=\"average\")\n    ga.dtnm <- hclust(dtnm, method=\"average\")\n    ga.ddce <- hclust(ddce, method=\"average\")\n\n    plot(ga.dcos, main=\"cosine similarity/UPGMA\")\n    plot(ga.djcd, main=\"Jaccard index/UPGMA\")\n    plot(ga.dsmp, main=\"Simpson index/UPGMA\")\n    plot(ga.dtnm, main=\"Tanimoto index/UPGMA\")\n    plot(ga.ddce, main=\"Dice index/UPGMA\")\n}\npar(op)\nop <- par(mfrow=c(2,3))\n{ # McQuitty\u6cd5\n    mq.dcos <- hclust(dcos, method=\"mcquitty\")\n    mq.djcd <- hclust(djcd, method=\"mcquitty\")\n    mq.dsmp <- hclust(dsmp, method=\"mcquitty\")\n    mq.dtnm <- hclust(dtnm, method=\"mcquitty\")\n    mq.ddce <- hclust(ddce, method=\"mcquitty\")\n\n    plot(mq.dcos, main=\"cosine similarity/McQuitty\")\n    plot(mq.djcd, main=\"Jaccard index/McQuitty\")\n    plot(mq.dsmp, main=\"Simpson index/McQuitty\")\n    plot(wd.dtnm, main=\"Tanimoto index/McQuitty\")\n    plot(wd.ddce, main=\"Dice index/McQuitty\")\n}\npar(op)\ndev.off()\n\n\n\u5206\u985e\n# \u5b9f\u969b\u306b\u30af\u30e9\u30b9\u30bf\u6570\u3092\u6307\u5b9a\u3057\u3066\u3001\u3069\u306eID\u304c\u3069\u306e\u30af\u30e9\u30b9\u30bf\u306e\u5206\u985e\u3055\u308c\u308b\u304b\u30d9\u30af\u30c8\u30eb\u3067\ncutree(wd.dcos, k=15)\n\n# N\u884c1\u5217\u306e\u884c\u5217\u306b\u5909\u63db\u3057\u3066\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u306b\u30de\u30fc\u30b8\ncbind(df, cluster = matrix(cutree(wd.dcos, k=15), nc=1))\n\n\u53c2\u8003\nhttp://rstudio-pubs-static.s3.amazonaws.com/10521_be5bce1e68f44c359bc88e6b0a07ef5c.html\nhttp://www.antecanis.com/texts/group_05/\n\n\u975e\u968e\u5c64\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\n\nk-means\n\n\u30cf\u30fc\u30c9\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\n$k$\u500b\u306e\u30af\u30e9\u30b9\u30bf\u306e\u3044\u305a\u308c\u304b1\u500b\u306b\u6240\u5c5e\nR\u3067\u306f{stats}\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\uff09\u306ekmeans(\u8ddd\u96e2, \u30af\u30e9\u30b9\u30bf\u6570, iter.max = \u53cd\u5fa9\u56de\u6570)\u3067\u5b9f\u884c\n\n\\sum_{l=1}^k \\sum_{x_i \\in X_l} \\parallel x_i - \\mu_l \\parallel^2 \\rightarrow min! \\\\\n\\begin{align}\n\u305f\u3060\u3057 \\\\\nk &: \u5206\u5272\u6570 \\\\\nx_i &: \u89b3\u6e2c \\\\\nX_l &: \u30af\u30e9\u30b9\u30bfl \\\\\n\\mu_l &: \u30af\u30e9\u30b9\u30bfl\u306e\u91cd\u5fc3\n\\end{align}\n$${\\sum_{l=1}^k \\sum_{x_i \\in X_l} \\parallel x_i - \\mu_l \\parallel^2 \\rightarrow min! \\\\\n\\begin{align}\n\u305f\u3060\u3057 \\\\\nk &: \u5206\u5272\u6570 \\\\\nx_i &: \u89b3\u6e2c \\\\\nX_l &: \u30af\u30e9\u30b9\u30bfl \\\\\n\\mu_l &: \u30af\u30e9\u30b9\u30bfl\u306e\u91cd\u5fc3\n\\end{align}\n}$$\n# \u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u53cd\u5fa9\u56de\u6570\u304c10\u3068\u5c11\u306a\u3044\u306e\u3067\u6307\u5b9a\u3057\u3066\u5b9f\u884c\u3059\u308b\nkm.dcos <- kmeans(dcos, 10, iter.max = 100)\n\n# \u3069\u306eID\u304c\u3069\u306e\u30af\u30e9\u30b9\u30bf\u306e\u5206\u985e\u3055\u308c\u308b\u304b\u30d9\u30af\u30c8\u30eb\u3067\nkm.dcos$cluster\n\n# N\u884c1\u5217\u306e\u884c\u5217\u306b\u5909\u63db\u3057\u3066\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u306b\u30de\u30fc\u30b8\ndf <- cbind(df, cluster = km.dcos$cluster, nc=1))\n\nplot.kmeans {useful}\nkmeans\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u305d\u306e\u307e\u307e\u30d7\u30ed\u30c3\u30c8\u3067\u304d\u308b\u3002\u4fbf\u5229\uff01\n\nfuzzy c-means\n\n\u30bd\u30d5\u30c8\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\n\u5168\u90e8\u3067$c$\u500b\u306e\u30af\u30e9\u30b9\u30bf\u306e\u305d\u308c\u305e\u308c\u306b\u4e00\u5b9a\u306e\u91cd\u307f$u_{li}$\u305f\u3060\u3057$i = 1, 2, .., N$\u3001$l = 1, 2, .., c$\u3092\u3082\u3063\u3066\u6240\u5c5e\u3002\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u30d1\u30e9\u30e1\u30fc\u30bf$m$\u304c\u5927\u304d\u3044\u3068\u3070\u3089\u3064\u304d\u304c\u5927\u304d\u304f\u306a\u308b\nR\u3067\u306f\n\n\n\ncmeans {e1071}\uff08SVM\u306a\u3069\u3055\u307e\u3056\u307e\u306a\u6a5f\u4f1a\u5b66\u7fd2\u7cfb\u30e2\u30c7\u30eb\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3001\u30c7\u30fc\u30bf\u306f\u89b3\u6e2c\u5024\u306e\u307f\u3067\u4e0e\u3048\u308b\u3002\u8ddd\u96e2\u884c\u5217\u306f\u4e0e\u3048\u3089\u308c\u306a\u3044\uff09\n\nfanny {cluster}\uff08\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u306e\u62e1\u5f35\u30d1\u30c3\u30b1\u30fc\u30b8\u3001\u30c7\u30fc\u30bf\u306f\u89b3\u6e2c\u3067\u3082\u8ddd\u96e2\u884c\u5217\u3067\u3082\u6307\u5b9a\u3067\u304d\u308b\uff09\n {fclust}\uff08\u30d5\u30a1\u30b8\u30a3\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u7528\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3001\u30c7\u30fc\u30bf\u306f\u89b3\u6e2c\u5024\u306e\u307f\u3067\u4e0e\u3048\u308b\u3002\u8ddd\u96e2\u884c\u5217\u306f\u4e0e\u3048\u3089\u308c\u306a\u3044\uff09\n\n\n\n\\sum_{l=1}^c \\sum_{i=1}^N (u_{li})^m \\parallel x_i -\\mu_l \\parallel^2 \\rightarrow min! \\\\\n\\begin{align}\n\u305f\u3060\u3057 \\\\\nc &: \u5206\u5272\u6570 \\\\\nN &: \u89b3\u6e2c\u306e\u6570 \\\\\nu_{li} &: \u91cd\u307f\uff08\u6240\u5c5e\u78ba\u7387\uff09 \\\\\nm &: \u30d5\u30a1\u30b8\u30a3\u3055\u3092\u6c7a\u3081\u308b\u30d1\u30e9\u30e1\u30fc\u30bf \\\\\nx_i &: \u89b3\u6e2c \\\\\n\\mu_l &: \u30af\u30e9\u30b9\u30bfl\u306e\u91cd\u5fc3\n\\end{align}\n$${\\sum_{l=1}^c \\sum_{i=1}^N (u_{li})^m \\parallel x_i -\\mu_l \\parallel^2 \\rightarrow min! \\\\\n\\begin{align}\n\u305f\u3060\u3057 \\\\\nc &: \u5206\u5272\u6570 \\\\\nN &: \u89b3\u6e2c\u306e\u6570 \\\\\nu_{li} &: \u91cd\u307f\uff08\u6240\u5c5e\u78ba\u7387\uff09 \\\\\nm &: \u30d5\u30a1\u30b8\u30a3\u3055\u3092\u6c7a\u3081\u308b\u30d1\u30e9\u30e1\u30fc\u30bf \\\\\nx_i &: \u89b3\u6e2c \\\\\n\\mu_l &: \u30af\u30e9\u30b9\u30bfl\u306e\u91cd\u5fc3\n\\end{align}\n}$$\n\nk-harmonic means\n\n\u30cf\u30fc\u30c9\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\n\u8abf\u548c\u5e73\u5747\u3092\u4f7f\u3046\nk-means\u3084\u6df7\u5408\u5206\u5e03\u30e2\u30c7\u30eb\u307b\u3069\u521d\u671f\u5024\u306b\u5f71\u97ff\u3055\u308c\u306a\u3044\nR\u3067\u306f\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u306a\u3044\u6a21\u69d8\n\n\\sum_{i=1}^N \\frac{k}{\\sum_{l=1}^k \\frac{1}{\\parallel x_i -\\mu_l \\parallel^2}} \\rightarrow min! \\\\\n\\begin{align}\n\u305f\u3060\u3057 \\\\\nk &: \u5206\u5272\u6570 \\\\\nN &: \u89b3\u6e2c\u306e\u6570 \\\\\nx_i &: \u89b3\u6e2c \\\\\n\\mu_l &: \u30af\u30e9\u30b9\u30bfl\u306e\u91cd\u5fc3\n\\end{align}\n$${\\sum_{i=1}^N \\frac{k}{\\sum_{l=1}^k \\frac{1}{\\parallel x_i -\\mu_l \\parallel^2}} \\rightarrow min! \\\\\n\\begin{align}\n\u305f\u3060\u3057 \\\\\nk &: \u5206\u5272\u6570 \\\\\nN &: \u89b3\u6e2c\u306e\u6570 \\\\\nx_i &: \u89b3\u6e2c \\\\\n\\mu_l &: \u30af\u30e9\u30b9\u30bfl\u306e\u91cd\u5fc3\n\\end{align}\n}$$\n\n\u6df7\u5408\u5206\u5e03\u30e2\u30c7\u30eb\uff0f\u6f5c\u5728\u30af\u30e9\u30b9\u30e2\u30c7\u30eb\n\n\u6df7\u5408\u5206\u5e03\u30e2\u30c7\u30eb\uff1a\u7279\u5fb4\u91cf\u304c\u9023\u7d9a\u91cf\n\u6f5c\u5728\u30af\u30e9\u30b9\u30e2\u30c7\u30eb\uff1a\u7279\u5fb4\u91cf\u304c\u540d\u7fa9\u5c3a\u5ea6\n\n\u4ed8\u3051\u305f\u3044\u5206\u985e\u304c\u3042\u3089\u304b\u3058\u3081\u6c7a\u307e\u3063\u3066\u3044\u308b\u5834\u5408\u5bc4\u308a\u306e\u624b\u6cd5\u306b\u306a\u308b\uff08\u5f93\u5c5e\u5909\u6570\u3042\u308a\u3001\u6559\u5e2b\u3042\u308a\u5b66\u7fd2\uff09\nEM\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3067\u63a8\u5b9a\u3059\u308b\u306e\u3067\u3001EM\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3068\u3044\u3046\u624b\u6cd5\u540d\u306b\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3082\u3042\u308b\u3002\nR\u306e{mclust}\u306f\u6b63\u898f\u5206\u5e03\u306e\u6df7\u5408\u5206\u5e03\u3092\u524d\u63d0\u3001{flexmix}\u306f\u6b63\u898f\u5206\u5e03\u4ee5\u5916\u3082\u53ef\u80fd\nhttp://d.hatena.ne.jp/EulerDijkstra/20130618/1371552902\nhttp://nhkuma.blogspot.jp/2013/08/blog-post_13.html\nmclust\u306e\u307b\u3046\u304c\u9650\u5b9a\u3055\u308c\u3066\u3044\u308b\u304c\u7cbe\u5ea6\u306f\u9ad8\u3044\uff1f\n\u30af\u30e9\u30b9\u30bf\u30fc\u5206\u6790\u306f\n\n1. \u8ddd\u96e2\u884c\u5217\u306e\u751f\u6210\uff08\u985e\u4f3c\u5ea6\u884c\u5217\u3067\u306f\u306a\u3044\uff01\uff09\n2. \u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u306e\u5b9f\u884c\n\n\u3068\u3044\u3046\u6d41\u308c\u306b\u306a\u308b\u3002\n\n\u305d\u308c\u305e\u308c\u306e\u30b9\u30c6\u30c3\u30d7\u3067\u3001\u63a1\u7528\u3059\u308b\n\n- \u8ddd\u96e2\u306e\u7a2e\u985e\n- \u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u306e\u65b9\u6cd5\n\n\u304c\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u5909\u6570\u3068\u306a\u308b\u3002\n\n\n\n# \u8ddd\u96e2\u884c\u5217\u3092\u751f\u6210\u3059\u308b\n\n**\u985e\u4f3c\u5ea6\u884c\u5217\u3067\u306f\u306a\u304f**\u8ddd\u96e2\u884c\u5217\u3092\u4f5c\u308b\u3002\n\u76f4\u611f\u7684\u306b\u306f\u30c7\u30fc\u30bf\u304b\u3089\u8ddd\u96e2\u306e\u6307\u6a19\uff08\u3069\u308c\u3060\u3051\u96e2\u308c\u3066\u3044\u308b\u304b\uff09\u3067\u306f\u306a\u304f\u985e\u4f3c\u5ea6\uff08\u3069\u308c\u3060\u3051\u8fd1\u3044\u304b\uff09\u306e\u6307\u6a19\u3092\u62bd\u51fa\u3057\u3001\u305d\u3053\u304b\u3089\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u3057\u305f\u3044\u30b1\u30fc\u30b9\u304c\u591a\u3044\u306e\u3060\u304c\u3001\u3042\u304f\u307e\u3067\u985e\u4f3c\u5ea6\u6307\u6a19\u306b\u57fa\u3065\u3044\u305f\u8ddd\u96e2\u884c\u5217\u3092\u751f\u6210\u3059\u308b\u306e\u3067\u3042\u308b\u3002\n\n\u901a\u5e38\u306e`dist`\u95a2\u6570\u3067\u306f\u5bfe\u5fdc\u3059\u308b\u8ddd\u96e2\u306e\u7a2e\u985e\u304c\u5c11\u306a\u3044\u306e\u3067`proxy`\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f7f\u3046\u3002\n\u8ddd\u96e2\u884c\u5217\u3092\u751f\u6210\u3059\u308b\u30e1\u30bd\u30c3\u30c9\u306f`dist(data, method=\"\u30e1\u30bd\u30c3\u30c9\u540d\")`\u3002\n\n```r\nrequire(proxy)\n# \u30c7\u30fc\u30bf\u306e1\u5217\u76ee\u304cID\u306a\u306e\u3067\u9664\u5916\ndcos <- proxy::dist(df[,2:ncol(df)], method=\"cosine\")\n```\n\n\u623b\u308a\u5024\u306f**dist\u30aa\u30d6\u30b8\u30a7\u30af\u30c8**\u3002\u884c\u5217\u3084\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u3068\u306f\u7570\u306a\u308b\u306e\u3067\u6271\u3044\u306b\u6ce8\u610f\u3002\ndist\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u540c\u3058\u6b21\u5143\u306a\u3089\u52a0\u6e1b\u4e57\u9664\u304c\u53ef\u80fd\u3002\u305f\u3068\u3048\u3070`dist1`, `dist2`\u3068\u3082\u306bdist\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5834\u5408\u3001\n\n```r\ndist1 + dist2\ndist1 - dist2\ndist1 * dist2\ndist1 / dist2\n```\n\n\u3044\u305a\u308c\u3082**\u5bfe\u5fdc\u3059\u308b\u8981\u7d20\u3092\u52a0\u6e1b\u4e57\u9664\u3057\u305f**dist\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u8fd4\u3063\u3066\u304f\u308b\u3002\n\n## \u985e\u4f3c\u5ea6\uff08\u3069\u308c\u3060\u3051\u8fd1\u3044\u304b\uff09\u306e\u7a2e\u985e\n\n- \u6570\u5024\u30d9\u30af\u30c8\u30eb\u306b\u5bfe\u3059\u308b\u3082\u306e\n    - \u30b3\u30b5\u30a4\u30f3\u985e\u4f3c\u5ea6\uff08cosine\uff09\n    - \u62e1\u5f35Jaccard\uff08eJaccard\uff09\n    - fuzzy Jaccard\uff08fJaccard\uff09\n    - Pearson\u306e\u7a4d\u7387\u76f8\u95a2\u4fc2\u6570\uff08correlation\uff09\n- 0/1\u5024\u306b\u5bfe\u3059\u308b\u3082\u306e\uff08\u96c6\u5408\u306b\u5165\u308b or not\uff09\n    - Jaccard\u4fc2\u6570\n    - Tanimoto\u4fc2\u6570\n    - Simpson\u4fc2\u6570\n    - Dice\u4fc2\u6570\n    - Simpson-Jaccard\u4fc2\u6570\u306f\u76f4\u63a5\u7b97\u51fa\u3067\u304d\u306a\u3044\u304c\u3001`(dSimpson + dJaccard) / 2`\u3068\u3059\u308b\u3060\u3051\u3067Simpson-Jaccard\u306e\u8ddd\u96e2\u884c\u5217\u3092\u53d6\u5f97\u3067\u304d\u308b\n- 2x2\u306e\u5206\u5272\u8868\u306b\u5bfe\u3059\u308b\u3082\u306e\n    - \u30d5\u30a1\u30a4\u4fc2\u6570\uff08Phi\uff09\n    - \u30e6\u30fc\u30eb\u306eQ\uff08Yule\uff09\n\n## \u8ddd\u96e2\uff08\u3069\u308c\u3060\u3051\u96e2\u308c\u3066\u3044\u308b\u304b\uff09\u306e\u7a2e\u985e\u2192\u6570\u5024\u30d9\u30af\u30c8\u30eb\u306b\u5bfe\u3059\u308b\u3082\u306e\n\n- \u30e6\u30fc\u30af\u30ea\u30c3\u30c9\u8ddd\u96e2\uff08Euclidean\uff09\n- \u30de\u30cf\u30e9\u30ce\u30d3\u30b9\u8ddd\u96e2\uff08Mahalanobis\uff09\n- \u30de\u30f3\u30cf\u30c3\u30bf\u30f3\u8ddd\u96e2\uff08Manhattan\uff09\n- \u30c1\u30a7\u30d3\u30b7\u30a7\u30d5\u8ddd\u96e2\uff08Chebyshev\uff09\n- \u30df\u30f3\u30b3\u30d5\u30b9\u30ad\u30fc\u8ddd\u96e2\uff08Minkowski\uff09\n- \u30ad\u30e3\u30f3\u30d9\u30e9\u8ddd\u96e2\uff08Canberra\uff09\n\n\u30c7\u30fc\u30bf\u306e1\u5217\u76ee\u304cID\u2192\u9664\u5916\u3059\u308b\u5834\u5408\n\n```r\ndcos <- proxy::dist(df[, 2:ncol(df)], method=\"cosine\")\ndjcd <- proxy::dist(df[, 2:ncol(df)], method=\"eJaccard\")\ndcor <- proxy::dist(df[, 2:ncol(df)], method=\"correlation\")\n```\n\n## Matrix\u5f62\u5f0f\u306e\u884c\u5217\u306b\u5bfe\u3059\u308b\u985e\u4f3c\u5ea6\u306e\u7b97\u51fa\u30e9\u30a4\u30d6\u30e9\u30ea\n\nR\u306e\u901a\u5e38\u306e\u884c\u5217\u3084\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u3067\u306f\u30c7\u30a3\u30e1\u30f3\u30b7\u30e7\u30f3\u306e\u5927\u304d\u3044sparse matrix\uff08\u758e\u884c\u5217\uff09\u3092\u6271\u3046\u306e\u304c\u56f0\u96e3\u3067\u3042\u308b\u3002\nMatrix\u3068\u3044\u3046\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u884c\u5217\u3092\u72ec\u81ea\u306e\u5f62\u5f0f\u3067\u6271\u3046\u30d1\u30c3\u30b1\u30fc\u30b8\u3067\u3001\u4e3b\u306bsparse matrix\u306a\u3069\u3092\u6271\u3046\u306e\u306b\u5f37\u3044\u3002\n\u3053\u306eMatrix\u5f62\u5f0f\u306e\u884c\u5217\u306b\u5bfe\u3057\u3066\u985e\u4f3c\u5ea6\u3092\u8a08\u7b97\u3059\u308b\u95a2\u6570\u3092\u4f5c\u3063\u305f\u3002\n\n- `jcdSparse()`: \u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u306b\u5bfe\u3059\u308bJaccard\u4fc2\u6570\n- `smpSparse()`: \u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u306b\u5bfe\u3059\u308bSimpson\u4fc2\u6570\n- `ejcdSparse()`: \u9023\u7d9a\u91cf\u306b\u62e1\u5f35\u3057\u305fJaccard\u4fc2\u6570\n- `esmpSparse()`: \u9023\u7d9a\u91cf\u306b\u62e1\u5f35\u3057\u305fSimpson\u4fc2\u6570\n- `cosSparse()`: \u30b3\u30b5\u30a4\u30f3\u985e\u4f3c\u5ea6\n\n```r\njcdSparse <- function(X){\n\tX <- as(X, \"dgCMatrix\")\n\tX@x <- rep(1, length(X@x)) # \u975e\u30bc\u30ed\u8981\u7d20\u306f\u3059\u3079\u30661\u306b\u7f6e\u63db\n\tvec_sum_col <- colSums(X)\n\tAB <- crossprod(X)\n\tsim <- AB / (vec_sum_col - t(AB - vec_sum_col)) # \u307e\u3068\u3081\u3066\n\treturn(sim)\n}\n\nsmpSparse <- function(X){\n\tX <- as(X, \"dgCMatrix\")\n\tX@x <- rep(1, length(X@x)) # \u975e\u30bc\u30ed\u8981\u7d20\u306f\u3059\u3079\u30661\u306b\u7f6e\u63db\n\tvec_sum_col <- colSums(X)\n\tAB <- crossprod(X)\n\tn <- length(vec_sum_col)\n\tA <- matrix(rep(vec_sum_col, n), n)\n\tB <- t(A)\n\tmat_A_lt_B <- A < B\n\tsim <- AB / (A * mat_A_lt_B + B * (1 - mat_A_lt_B))\n\treturn(sim)\n}\n\nejcdSparse <- function(X){\n\tX <- as(X, \"dgCMatrix\")\n\tvec_xx <- colSums(X^2)\n\tmat_xy <- crossprod(X)\n\tsim <- mat_xy / (vec_xx - t(mat_xy - vec_xx)) # \u307e\u3068\u3081\u3066\n\treturn(sim)\n}\n\nesmpSparse <- function(X){\n\tX <- as(X, \"dgCMatrix\")\n\tvec_xx <- colSums(X^2)\n\tmat_xy <- crossprod(X)\n\tn <- length(vec_xx)\n\tmat_xx <- matrix(rep(vec_xx, n), n)\n\tmat_yy <- t(mat_xx)\n\tmat_x_lt_y <- mat_xx < mat_yy\n\tsim <- mat_xy / (mat_xx * mat_x_lt_y + mat_yy * (1 - mat_x_lt_y))\n\treturn(sim)\n}\n\ncosSparse <- function (X) {\n\tif(class(X)[[1]] != \"dgCMatrix\") {\n\t\tX <- as(X, \"dgCMatrix\")\n\t}\n\tX_normalized_col <- X %*% Diagonal(x = 1 / sqrt(colSums(X^2))) # \u307e\u3068\u3081\u3066\n\tsim <- crossprod(X_normalized_col)\n\treturn(sim)\n}\n```\n\n## \u8ddd\u96e2\u884c\u5217\u3068\u985e\u4f3c\u5ea6\u884c\u5217\u306e\u95a2\u4fc2\n\n- \u985e\u4f3c\u5ea6\u306f\u4e00\u81f4\u3059\u308b\u3068\u304d\u306b1\u3092\u3068\u308b\u3002\u72ec\u7acb\u306a\u30890\u3001\u6b63\u53cd\u5bfe\u306a\u3089-1\n- \u8ddd\u96e2\u306f\u5927\u304d\u3044\u307b\u3046\u304c\u96e2\u308c\u3066\u3044\u308b\n\n```\ndistance = 1 - similarity\n```\n\nPearson\u306e\u7a4d\u7387\u76f8\u95a2\u4fc2\u6570\u304b\u3089\u8ddd\u96e2\u884c\u5217\u3092\u751f\u6210\u3059\u308b\u306e\u3082\u3053\u306e\u539f\u7406\u3002\n\n\uff08\u53c2\u8003\uff09\n\n- \u985e\u4f3c\u5ea6\u3068\u8ddd\u96e2\u306e\u6982\u5ff5\nhttp://wikiwiki.jp/cattail/?%CE%E0%BB%F7%C5%D9%A4%C8%B5%F7%CE%A5\n- \u305d\u306e\u4ed6\u306e\u8ddd\u96e2\nhttp://www.nysol.sakura.ne.jp/mcmd/jp/sect-msim.html\n- \u76f4\u63a5\u5b9f\u88c5\u3059\u308b\u306a\u3089\nhttp://sucrose.hatenablog.com/entry/2012/11/30/132803\n- \u8ddd\u96e2\u306b\u95a2\u3059\u308bR\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u95a2\u6570\nhttp://www.slideshare.net/yuifu/ss-11776646\n- {proxy}\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\u8ddd\u96e2\u3068\u985e\u4f3c\u5ea6\u306e\u4e00\u89a7\nhttps://cran.r-project.org/web/packages/proxy/vignettes/overview.pdf\n\n\n\n# \u4e3b\u6210\u5206\u5206\u6790\u3068\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\n\n```r\n# \u4e3b\u6210\u5206\u5f97\u70b9\u884c\u5217\u306e\u62bd\u51fa\nscores <- prcomp.users$x[,1:50]\n# \u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\nkm.scores <- kmeans(scores, 10)\n# \u30af\u30e9\u30b9\u30bf\u6570\u78ba\u8a8d\ntable(km.scores$cluster)\n\n# \u30d7\u30ed\u30c3\u30c8\nscore.pc1 <-prcomp.users$x[,1]\nscore.pc2 <-prcomp.users$x[,2]\n#plot(score.pc1, score.pc2, xlab=\"PC1\", ylab=\"PC2\", col=km.scores$cluster)\ndf<-data.frame(\n\tUID=names(score.pc1), \n\tPC1=score.pc1, \n\tPC2=score.pc2, \n\tCluster=factor(km.scores$cluster)\n)\nggplot(df, aes(x=PC1, y=PC2, label=UID, color=Cluster)) + \n       geom_point() + geom_text(size = 4, colour = \"black\", vjust = -1)\n```\n\nhttp://www.statmethods.net/advstats/cluster.html\n\n\n\n# \u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u306e\u5b9f\u884c\n\n## \u968e\u5c64\u7684\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\n\n\u30e6\u30fc\u30b6\u5206\u985e\u306a\u3069\u30d3\u30c3\u30b0\u30c7\u30fc\u30bf\u306b\u306f\u4e0d\u5411\u304d\u3002\n\n### `hclust()`\u306e\u5f15\u6570`method`\u306e\u7a2e\u985e\n\n- \u6700\u8fd1\u96a3\u6cd5: `single`\n- \u6700\u9060\u96a3\u6cd5: `complete`\n- \u7fa4\u5e73\u5747\u6cd5\uff1dUPGMA: `average`\n- \u91cd\u5fc3\u6cd5\uff1dUPGMC: `centroid`\n- \u30e1\u30c7\u30a3\u30a2\u30f3\u6cd5\uff1dWPGMC: `median`\n- Ward\u6cd5\uff1d\u6700\u5c0f\u5206\u6563\u6cd5\uff08\u90e1\u5185\u5206\u6563\u3068\u7fa4\u9593\u5206\u6563\u306e\u6bd4\u3092\u6700\u5927\u5316\uff09: `ward.D2`\n- McQuitty\u6cd5\uff1dWPGMA: `mcquitty`\n\n\n### \u30c7\u30f3\u30c9\u30ed\u30b0\u30e9\u30e0\u306e\u751f\u6210\n\n\u8ddd\u96e2\u306e\u7a2e\u985e\u00d7\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u306e\u624b\u6cd5\u3067\u6bd4\u8f03\u3059\u308b\u3088\u306d\u3002\n\n- \u30b3\u30b5\u30a4\u30f3\u985e\u4f3c\u5ea6\u306e\u8ddd\u96e2\u884c\u5217`dcos`\n- Jaccard\u4fc2\u6570\u306e\u8ddd\u96e2\u884c\u5217`djcd`\n- Simpson\u4fc2\u6570\u306e\u8ddd\u96e2\u884c\u5217`dsmp`\n- Tanimoto\u4fc2\u6570\u306e\u8ddd\u96e2\u884c\u5217`dtnm`\n- Dice\u4fc2\u6570\u306e\u8ddd\u96e2\u884c\u5217`ddce`\n\n\u306b\u5bfe\u3057\u3066\n\n- Ward\u6cd5\n- \u7fa4\u5e73\u5747\u6cd5\uff08UPGMA\uff09\n- McQuitty\u6cd5\n\n\u3067\u968e\u5c64\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u3057\u305f\u7d50\u679c\u3092\u30c7\u30f3\u30c9\u30ed\u30b0\u30e9\u30e0\u3067\u6bd4\u8f03\u3059\u308b\u3002\n\n```r\npdf(\"hclust.pdf\")\nop <- par(mfrow=c(2,3))\n{ # Ward\u6cd5\n\twd.dcos <- hclust(dcos, method=\"ward.D2\")\n\twd.djcd <- hclust(djcd, method=\"ward.D2\")\n\twd.dsmp <- hclust(dsmp, method=\"ward.D2\")\n\twd.dtnm <- hclust(dtnm, method=\"ward.D2\")\n\twd.ddce <- hclust(ddce, method=\"ward.D2\")\n\n\tplot(wd.dcos, main=\"cosine similarity/Ward\")\n\tplot(wd.djcd, main=\"Jaccard index/Ward\")\n\tplot(wd.dsmp, main=\"Simpson index/Ward\")\n\tplot(wd.dtnm, main=\"Tanimoto index/Ward\")\n\tplot(wd.ddce, main=\"Dice index/Ward\")\n}\npar(op)\nop <- par(mfrow=c(2,3))\n{ # \u7fa4\u5e73\u5747\u6cd5\uff08UPGMA\uff09\n\tga.dcos <- hclust(dcos, method=\"average\")\n\tga.djcd <- hclust(djcd, method=\"average\")\n\tga.dsmp <- hclust(dsmp, method=\"average\")\n\tga.dtnm <- hclust(dtnm, method=\"average\")\n\tga.ddce <- hclust(ddce, method=\"average\")\n\n\tplot(ga.dcos, main=\"cosine similarity/UPGMA\")\n\tplot(ga.djcd, main=\"Jaccard index/UPGMA\")\n\tplot(ga.dsmp, main=\"Simpson index/UPGMA\")\n\tplot(ga.dtnm, main=\"Tanimoto index/UPGMA\")\n\tplot(ga.ddce, main=\"Dice index/UPGMA\")\n}\npar(op)\nop <- par(mfrow=c(2,3))\n{ # McQuitty\u6cd5\n\tmq.dcos <- hclust(dcos, method=\"mcquitty\")\n\tmq.djcd <- hclust(djcd, method=\"mcquitty\")\n\tmq.dsmp <- hclust(dsmp, method=\"mcquitty\")\n\tmq.dtnm <- hclust(dtnm, method=\"mcquitty\")\n\tmq.ddce <- hclust(ddce, method=\"mcquitty\")\n\n\tplot(mq.dcos, main=\"cosine similarity/McQuitty\")\n\tplot(mq.djcd, main=\"Jaccard index/McQuitty\")\n\tplot(mq.dsmp, main=\"Simpson index/McQuitty\")\n\tplot(wd.dtnm, main=\"Tanimoto index/McQuitty\")\n\tplot(wd.ddce, main=\"Dice index/McQuitty\")\n}\npar(op)\ndev.off()\n```\n\n### \u5206\u985e\n\n```r\n# \u5b9f\u969b\u306b\u30af\u30e9\u30b9\u30bf\u6570\u3092\u6307\u5b9a\u3057\u3066\u3001\u3069\u306eID\u304c\u3069\u306e\u30af\u30e9\u30b9\u30bf\u306e\u5206\u985e\u3055\u308c\u308b\u304b\u30d9\u30af\u30c8\u30eb\u3067\ncutree(wd.dcos, k=15)\n\n# N\u884c1\u5217\u306e\u884c\u5217\u306b\u5909\u63db\u3057\u3066\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u306b\u30de\u30fc\u30b8\ncbind(df, cluster = matrix(cutree(wd.dcos, k=15), nc=1))\n```\n\n\u53c2\u8003\nhttp://rstudio-pubs-static.s3.amazonaws.com/10521_be5bce1e68f44c359bc88e6b0a07ef5c.html\nhttp://www.antecanis.com/texts/group_05/\n\n## \u975e\u968e\u5c64\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\n\n### k-means\n\n- \u30cf\u30fc\u30c9\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\n- $k$\u500b\u306e\u30af\u30e9\u30b9\u30bf\u306e\u3044\u305a\u308c\u304b1\u500b\u306b\u6240\u5c5e\n- R\u3067\u306f{stats}\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\uff09\u306e`kmeans(\u8ddd\u96e2, \u30af\u30e9\u30b9\u30bf\u6570, iter.max = \u53cd\u5fa9\u56de\u6570)`\u3067\u5b9f\u884c\n\n```math\n\\sum_{l=1}^k \\sum_{x_i \\in X_l} \\parallel x_i - \\mu_l \\parallel^2 \\rightarrow min! \\\\\n\\begin{align}\n\u305f\u3060\u3057 \\\\\nk &: \u5206\u5272\u6570 \\\\\nx_i &: \u89b3\u6e2c \\\\\nX_l &: \u30af\u30e9\u30b9\u30bfl \\\\\n\\mu_l &: \u30af\u30e9\u30b9\u30bfl\u306e\u91cd\u5fc3\n\\end{align}\n```\n\n```r\n# \u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u53cd\u5fa9\u56de\u6570\u304c10\u3068\u5c11\u306a\u3044\u306e\u3067\u6307\u5b9a\u3057\u3066\u5b9f\u884c\u3059\u308b\nkm.dcos <- kmeans(dcos, 10, iter.max = 100)\n\n# \u3069\u306eID\u304c\u3069\u306e\u30af\u30e9\u30b9\u30bf\u306e\u5206\u985e\u3055\u308c\u308b\u304b\u30d9\u30af\u30c8\u30eb\u3067\nkm.dcos$cluster\n\n# N\u884c1\u5217\u306e\u884c\u5217\u306b\u5909\u63db\u3057\u3066\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u306b\u30de\u30fc\u30b8\ndf <- cbind(df, cluster = km.dcos$cluster, nc=1))\n```\n\n`plot.kmeans` {useful}\nkmeans\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u305d\u306e\u307e\u307e\u30d7\u30ed\u30c3\u30c8\u3067\u304d\u308b\u3002\u4fbf\u5229\uff01\n\n\n### fuzzy c-means\n\n- \u30bd\u30d5\u30c8\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\n- \u5168\u90e8\u3067$c$\u500b\u306e\u30af\u30e9\u30b9\u30bf\u306e\u305d\u308c\u305e\u308c\u306b\u4e00\u5b9a\u306e\u91cd\u307f$u_{li}$\u305f\u3060\u3057$i = 1, 2, .., N$\u3001$l = 1, 2, .., c$\u3092\u3082\u3063\u3066\u6240\u5c5e\u3002\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u30d1\u30e9\u30e1\u30fc\u30bf$m$\u304c\u5927\u304d\u3044\u3068\u3070\u3089\u3064\u304d\u304c\u5927\u304d\u304f\u306a\u308b\n- R\u3067\u306f\n    - `cmeans` {e1071}\uff08SVM\u306a\u3069\u3055\u307e\u3056\u307e\u306a\u6a5f\u4f1a\u5b66\u7fd2\u7cfb\u30e2\u30c7\u30eb\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3001\u30c7\u30fc\u30bf\u306f\u89b3\u6e2c\u5024\u306e\u307f\u3067\u4e0e\u3048\u308b\u3002\u8ddd\u96e2\u884c\u5217\u306f\u4e0e\u3048\u3089\u308c\u306a\u3044\uff09\n    - `fanny` {cluster}\uff08\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u306e\u62e1\u5f35\u30d1\u30c3\u30b1\u30fc\u30b8\u3001\u30c7\u30fc\u30bf\u306f\u89b3\u6e2c\u3067\u3082\u8ddd\u96e2\u884c\u5217\u3067\u3082\u6307\u5b9a\u3067\u304d\u308b\uff09\n    -  {fclust}\uff08\u30d5\u30a1\u30b8\u30a3\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u7528\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3001\u30c7\u30fc\u30bf\u306f\u89b3\u6e2c\u5024\u306e\u307f\u3067\u4e0e\u3048\u308b\u3002\u8ddd\u96e2\u884c\u5217\u306f\u4e0e\u3048\u3089\u308c\u306a\u3044\uff09\n\n```math\n\\sum_{l=1}^c \\sum_{i=1}^N (u_{li})^m \\parallel x_i -\\mu_l \\parallel^2 \\rightarrow min! \\\\\n\\begin{align}\n\u305f\u3060\u3057 \\\\\nc &: \u5206\u5272\u6570 \\\\\nN &: \u89b3\u6e2c\u306e\u6570 \\\\\nu_{li} &: \u91cd\u307f\uff08\u6240\u5c5e\u78ba\u7387\uff09 \\\\\nm &: \u30d5\u30a1\u30b8\u30a3\u3055\u3092\u6c7a\u3081\u308b\u30d1\u30e9\u30e1\u30fc\u30bf \\\\\nx_i &: \u89b3\u6e2c \\\\\n\\mu_l &: \u30af\u30e9\u30b9\u30bfl\u306e\u91cd\u5fc3\n\\end{align}\n```\n\n### k-harmonic means\n\n- \u30cf\u30fc\u30c9\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\n- \u8abf\u548c\u5e73\u5747\u3092\u4f7f\u3046\n- k-means\u3084\u6df7\u5408\u5206\u5e03\u30e2\u30c7\u30eb\u307b\u3069\u521d\u671f\u5024\u306b\u5f71\u97ff\u3055\u308c\u306a\u3044\n- R\u3067\u306f\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u306a\u3044\u6a21\u69d8\n\n```math\n\\sum_{i=1}^N \\frac{k}{\\sum_{l=1}^k \\frac{1}{\\parallel x_i -\\mu_l \\parallel^2}} \\rightarrow min! \\\\\n\\begin{align}\n\u305f\u3060\u3057 \\\\\nk &: \u5206\u5272\u6570 \\\\\nN &: \u89b3\u6e2c\u306e\u6570 \\\\\nx_i &: \u89b3\u6e2c \\\\\n\\mu_l &: \u30af\u30e9\u30b9\u30bfl\u306e\u91cd\u5fc3\n\\end{align}\n```\n\n### \u6df7\u5408\u5206\u5e03\u30e2\u30c7\u30eb\uff0f\u6f5c\u5728\u30af\u30e9\u30b9\u30e2\u30c7\u30eb\n\n- \u6df7\u5408\u5206\u5e03\u30e2\u30c7\u30eb\uff1a\u7279\u5fb4\u91cf\u304c\u9023\u7d9a\u91cf\n- \u6f5c\u5728\u30af\u30e9\u30b9\u30e2\u30c7\u30eb\uff1a\u7279\u5fb4\u91cf\u304c\u540d\u7fa9\u5c3a\u5ea6\n\n\u4ed8\u3051\u305f\u3044\u5206\u985e\u304c\u3042\u3089\u304b\u3058\u3081\u6c7a\u307e\u3063\u3066\u3044\u308b\u5834\u5408\u5bc4\u308a\u306e\u624b\u6cd5\u306b\u306a\u308b\uff08\u5f93\u5c5e\u5909\u6570\u3042\u308a\u3001\u6559\u5e2b\u3042\u308a\u5b66\u7fd2\uff09\n\nEM\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3067\u63a8\u5b9a\u3059\u308b\u306e\u3067\u3001EM\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3068\u3044\u3046\u624b\u6cd5\u540d\u306b\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3082\u3042\u308b\u3002\nR\u306e{mclust}\u306f\u6b63\u898f\u5206\u5e03\u306e\u6df7\u5408\u5206\u5e03\u3092\u524d\u63d0\u3001{flexmix}\u306f\u6b63\u898f\u5206\u5e03\u4ee5\u5916\u3082\u53ef\u80fd\n\nhttp://d.hatena.ne.jp/EulerDijkstra/20130618/1371552902\nhttp://nhkuma.blogspot.jp/2013/08/blog-post_13.html\n\nmclust\u306e\u307b\u3046\u304c\u9650\u5b9a\u3055\u308c\u3066\u3044\u308b\u304c\u7cbe\u5ea6\u306f\u9ad8\u3044\uff1f\n", "tags": ["R", "DataMining", "clustering", "statistics", "\u6a5f\u68b0\u5b66\u7fd2"]}