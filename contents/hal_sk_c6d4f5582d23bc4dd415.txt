{"context": " More than 1 year has passed since last update.\u30e6\u30fc\u30b6\u30fc\u767b\u9332/\u30ed\u30b0\u30a4\u30f3\u3057\u306a\u3044\u3068\u898b\u308c\u306a\u3044\u30da\u30fc\u30b8\u3092 LocomotiveCMS \u306b\u7d44\u307f\u8fbc\u307f\u305f\u304f\u306a\u308a\u307e\u3057\u305f\u306e\u3067\u3001\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002Rails \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f3.2.16\u3001LocomotiveCMS \u306f2.4.1\u304c\u5bfe\u8c61\u3067\u3059\u3002\n\n\u30e6\u30fc\u30b6\u30fc\u30af\u30e9\u30b9\u306e\u4f5c\u6210\n\u307e\u305a\u3001LocomotiveCMS \u306b\u306f\u6700\u521d\u304b\u3089 devise \u3068\u3044\u3046Rails\u7528\u306e\u8a8d\u8a3c\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u7d44\u307f\u8fbc\u307e\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u65b0\u3057\u3044\u8a8d\u8a3c\u6a5f\u80fd\u3092\u4ed8\u3051\u52a0\u3048\u308b\u306e\u306f\u7c21\u5358\u305d\u3046\u3067\u3059\u3002LocomotiveCMS \u4e0a\u3067\u306fAccount\u30e2\u30c7\u30eb\u3068\u3044\u3046\u306e\u304c\u3001CMS\u81ea\u4f53\u306e\u7ba1\u7406\u8005\u30e6\u30fc\u30b6\u30fc\u306e\u7ba1\u7406\u306b\u4f7f\u308f\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u305d\u308c\u3068\u306f\u5225\u306b\u3057\u305f\u3044\u306e\u3067User\u30e2\u30c7\u30eb\u3092\u65b0\u305f\u306b\u4f5c\u3063\u3066\u307f\u307e\u3059\u3002\nbundle exec rails g devise User\n\nLocomotiveCMS\u3067\u306f mongoid \u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3001db:migrate \u306f\u5fc5\u8981\u3042\u308a\u307e\u305b\u3093\u3002unicorn_rails \u306e\u518d\u8d77\u52d5\u3092\u3057\u3066\u3001http://localhost:8080/users/sign_up \u3092\u958b\u3044\u3066\u307f\u308b\u3068\u3001\u767b\u9332\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u306f\u305a\u3067\u3059\u3002\n\n\u3053\u3053\u3067ID/Pass\u3092\u767b\u9332\u3059\u308b\u3068\u3001\u30e6\u30fc\u30b6\u767b\u9332\u304c\u3055\u308c\u305f\u72b6\u614b\u3067\u30c8\u30c3\u30d7\u753b\u9762\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u307e\u3059\u3002mongodb \u5074\u3092\u898b\u3066\u307f\u308b\u3068\u3001\u78ba\u304b\u306b\u30e6\u30fc\u30b6\u30fc\u304c\u4f5c\u3089\u308c\u3066\u3044\u307e\u3059\u3002\n% mongo localhost:27017\nMongoDB shell version: 2.4.9\nconnecting to: localhost:27017/test\nServer has startup warnings:\nThu Mar 27 17:45:06.188 [initandlisten]\nThu Mar 27 17:45:06.188 [initandlisten] ** WARNING: soft rlimits too low. Number of files is 256, should be at least 1000\n> use mysite_dev\nswitched to db mysite_dev\n> db.users.find()\n{ \"_id\" : ObjectId(\"533675464857099c8d000001\"), \"current_sign_in_at\" : ISODate(\"2014-03-29T07:24:54.852Z\"), \"current_sign_in_ip\" : \"127.0.0.1\", \"email\" : \"hal@georepublic.co.jp\", \"encrypted_password\" : \"$2a$1*******\", \"last_sign_in_at\" : ISODate(\"2014-03-29T07:24:54.852Z\"), \"last_sign_in_ip\" : \"127.0.0.1\", \"sign_in_count\" : 1 }\n>\n\n\u30c7\u30b6\u30a4\u30f3\u3084\u8ffd\u52a0\u306e\u767b\u9332\u9805\u76ee\u3092\u4f5c\u308b\u306e\u306f\u3068\u308a\u3042\u3048\u305a\u5f8c\u56de\u3057\u3067\u5148\u306b\u9032\u307f\u307e\u3059\u3002\n\nPageController \u306e\u62e1\u5f35\nLocomotiveCMS \u306fEngine\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u516c\u5f0f\u30ac\u30a4\u30c9\u3067\u66f8\u304b\u308c\u3066\u3044\u308b\u3088\u3046\u306b\u3001LocomotiveCMS engine \u5074\u306e\u30d1\u30b9\u3068\u540c\u3058\u5834\u6240\u306b\u30e2\u30c7\u30eb\u3084\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u306e\u30af\u30e9\u30b9\u3092\u7f6e\u304f\u3053\u3068\u3067\u6a5f\u80fd\u3092\u62e1\u5f35\u3067\u304d\u307e\u3059\u3002\ndevelopment.log \u3092\u898b\u3066\u307f\u308b\u3068\u3001\u516c\u958b\u30da\u30fc\u30b8\u3078\u306eGET\u30ea\u30af\u30a8\u30b9\u30c8\u306f\u4ee5\u4e0b\u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u306b\u305f\u3069\u308a\u7740\u304f\u3088\u3046\u3067\u3059\u3002\n\ndevelopment.log\nStarted GET \"/outline\" for 127.0.0.1 at 2014-03-30 11:45:19 +0900\nCreating scope :root. Overwriting existing method Locomotive::Page.root.\nProcessing by Locomotive::Public::PagesController#show as HTML\n  Parameters: {\"path\"=>\"outline\"}\n\n\n\u3067\u3059\u306e\u3067\u3001\u4eca\u56de\u306f\u3053\u306ePagesController\u3092\u62e1\u5f35\u3057\u3066\u307f\u307e\u3059\u3002\u307e\u305a\u3001LocomotiveCMS Engine\u5074\u3068\u540c\u3058\u3088\u3046\u306b\u3001app/controllers/locomotive/public/pages_controller.rb \u306b\u62e1\u5f35\u7528\u306e\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nbash\ncd {RAILS_ROOT}\nmkdir -p app/controllers/locomotive/public/\nvi app/controllers/locomotive/public/pages_controller.rb\n\n\n\u4e2d\u8eab\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\u3053\u308c\u3067\u3001\u65e2\u5b58\u306ePagesController\u30af\u30e9\u30b9\u3092\u518d\u30aa\u30fc\u30d7\u30f3\u3057\u3066\u3001\u65b0\u305f\u306a\u5b9a\u7fa9\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002Auth::AuthPage \u30af\u30e9\u30b9\u306f\u3053\u308c\u304b\u3089\u4f5c\u308b\u8a8d\u8a3c\u7528\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3059\u3002\n\npages_controller.rb\nmodule Locomotive\n  module Public\n    class PagesController < ApplicationController\n      include Auth::AuthPage #AuthPage\u3068\u3044\u3046\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u8aad\u307f\u8fbc\u3080\n    end\n  end\nend\n\n\n\u5b9f\u969b\u306b\u8a8d\u8a3c\u6a5f\u80fd\u3092\u8ffd\u52a0\u3059\u308b\u3001Auth::AuthPage \u30af\u30e9\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\u5143\u3005 /app/concerns \u4ee5\u4e0b\u306f autoload \u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u3053\u306b\u4ee5\u4e0b\u306e\u30af\u30e9\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\n\napp/concerns/auth/auth_page.rb\nmodule Auth\n  module AuthPage\n    extend ActiveSupport::Concern\n\n    included do\n      before_filter :authcheck\n    end\n    def authcheck\n        logger.info \"Auth Check\"\n    end\n  end\nend\n\n\n\u3053\u306e\u72b6\u614b\u3067\u30b5\u30a4\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306b Auth Check \u3068\u3044\u3046\u30ed\u30b0\u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002\n\nlogs/development.log\nStarted GET \"/entry\" for 127.0.0.1 at 2014-03-30 22:07:38 +0900\nProcessing by Locomotive::Public::PagesController#show as HTML\n  Parameters: {\"path\"=>\"entry\"}\n[LocomotiveCMS] [fetch site] host = localhost / localhost:8080\n  MOPED: 127.0.0.1:27017 QUERY        database=mysite_dev collection=locomotive_sites selector={\"$query\"=>{}, \"$orderby\"=>{:_id=>1}} flags=[:slave_ok] limit=-1 skip=0 batch_size=nil fields=nil (0.5510ms)\nAuth Check  \u2190\u3053\u308c\n  MOPED: 127.0.0.1:27017 QUERY \n\n\n\n\u307e\u3060\u30ed\u30b0\u3092\u51fa\u529b\u3059\u308b\u3060\u3051\u3067\u5b9f\u969b\u306e\u8a8d\u8a3c\u51e6\u7406\u306f\u884c\u306a\u3063\u3066\u3044\u307e\u305b\u3093\u3002\u3068\u308a\u3042\u3048\u305a\u306f\u3053\u306e\u307e\u307e\u306b\u3057\u3066\u304a\u3044\u3066\u3001\u5148\u306b\u8a8d\u8a3c\u306e\u30aa\u30f3\u30aa\u30d5\u3092\u30da\u30fc\u30b8\u6bce\u306b\u8a2d\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u30da\u30fc\u30b8\u5c5e\u6027\u306b\u3001\u30ed\u30b0\u30a4\u30f3\u5fc5\u9808\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8ffd\u52a0\u3059\u308b\n\u30da\u30fc\u30b8\u306b\u5bfe\u3057\u3066\u3001\u30ed\u30b0\u30a4\u30f3\u304c\u5fc5\u9808\u306b\u306a\u308b\u3088\u3046\u306a\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002app/concerns/auth/auth_field.rb \u3092\u8ffd\u52a0\u3057\u3001\u4ee5\u4e0b\u306e\u5185\u5bb9\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\napp/concerns/auth/auth_field.rb\nmodule Auth\n  module AuthField\n    extend ActiveSupport::Concern\n    included do\n      field :require_login,         type: Boolean, localize: true\n    end\n  end\nend\n\n\n\u4e0a\u8a18\u30e2\u30b8\u30e5\u30fc\u30eb\u3092Page\u30e2\u30c7\u30eb\u304b\u3089include\u3059\u308b\u3053\u3068\u3067\u3001require_login \u3068\u3044\u3046\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u4f5c\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\napp/models/locomotive/page.rb \u30d5\u30a1\u30a4\u30eb\u3092\u65b0\u305f\u306b\u4f5c\u308a\u3001include \u6587\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\napp/models/locomotive/page.rb\nmodule Locomotive\n  class Page\n    include Auth::AuthField\n  end\nend\n\n\nPage \u30af\u30e9\u30b9\u304c\u6b63\u3057\u304f\u62e1\u5f35\u3055\u308c\u3066\u3044\u308b\u304b\u3001\u78ba\u304b\u3081\u3066\u307f\u307e\u3057\u3087\u3046\u3002rails console \u304b\u3089Locomotie.Page\u30af\u30e9\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n% bundle exec rails console\nLoading development environment (Rails 3.2.16)\n[1] pry(main)> \n[2] pry(main)> Locomotive::Page.first()\n=> #<Locomotive::Page _id: 53303a0c485709d69800000e, created_at: 2014-03-24 13:58:36 UTC, updated_at: 2014-03-27 03:27:16 UTC, parent_id: \"5330384f485709d698000004\", parent_ids: [\"5330384f485709d698000004\"], position: 0, depth: 1, serialized_template: {\"ja\"=>#<Moped::BSON::Binary type=:generic length=7286>}, template_dependencies: {\"ja\"=>[\"5330384f485709d698000004\"]}, snippet_dependencies: {\"ja\"=>[\"footer\"]}, templatized: false, templatized_from_parent: false, target_klass_name: nil, redirect: false, redirect_url: nil, redirect_type: 301, listed: true, seo_title: {\"ja\"=>\"\u304a\u77e5\u3089\u305b\"}, meta_keywords: {\"ja\"=>\"html5, \"}, meta_description: {\"ja\"=>\"html5, \"}, title: {\"ja\"=>\"\u304a\u77e5\u3089\u305b\"}, slug: {\"ja\"=>\"news\"}, fullpath: {\"ja\"=>\"news\"}, handle: \"news\", raw_template: {\"ja\"=>\"{% extends 'parent' %}\\n{% block main %}\\n<div class='row'>\\n  <div class='large-8 columns'>\\n    <p>News</p>\\n    {% editable_text \\\"news_body\\\", rows: 20 %}\\n    hoge\\n    {% endeditable_text %}\\n  </div>\\n</div>\\n{% endblock %}\\n\", \"en\"=>\"{% extends 'parent' %}\"}, locales: [:ja], published: true, cache_strategy: \"simple\", response_type: \"text/html\", site_id: \"5330384f485709d698000002\", require_login: nil, cache_strategy_text: \"Simple\", lang: \"ja\">\n\n\nrequire_login\u3068\u3044\u3046\u30d7\u30ed\u30d1\u30c6\u30a3\u304c\u3042\u308b\u306e\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\n\u7ba1\u7406\u753b\u9762\u304b\u3089\u5207\u308a\u66ff\u3048\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n\u3055\u3066\u3001\u3042\u3068\u4e00\u606f\u3067\u3059\u3002\u4eca\u5ea6\u306f\u7ba1\u7406\u753b\u9762\u306eView\u306brequire login\u5c5e\u6027\u3092\u8ffd\u52a0\u3057\u307e\u3057\u3087\u3046\u3002\n\u7ba1\u7406\u753b\u9762\u306e\u30da\u30fc\u30b8\u306f\u3001/locomotive/pages/{ID}/edit \u3068\u3044\u3046URL\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001Engine \u5074\u306e /app/views/locomotive/pages/edit.html.haml\u3092\u898b\u3066\u307f\u307e\u3059\u3068\u3001\u30da\u30fc\u30b8\u306e\u4e0b\u306e\u65b9\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8a18\u8ff0\u304c\u3042\u308a\u307e\u3059\u3002\n\n/app/views/locomotive/pages/edit.html.haml\n= semantic_form_for @page, url: page_path(@page), html: { multipart: true } do |form|\n\n   = render 'form', f: form \u2190\u3053\u308c\n\n   = render 'locomotive/shared/form_actions', back_url: pages_path, button_label: :update\n\n\n\u3068\u3044\u3046\u308f\u3051\u3067\u3001\u4eca\u5ea6\u306f /app/views/locomotive/pages/_form.html.haml \u3092\u958b\u304d\u307e\u3059\u3068\u3001\u305d\u308c\u3063\u307d\u3044\u30d5\u30a1\u30a4\u30eb\u304c\u51fa\u3066\u304d\u307e\u3057\u305f\u3002\n\n/app/views/locomotive/pages/_form.html.haml\n- content_for :head do                                                                                     \n  = render '/locomotive/content_assets/picker'\n  = render '/locomotive/theme_assets/picker'\n  = render 'editable_elements'\n\n- content_for :backbone_view_data do\n  :plain\n    page: #{escape_json to_json(@page)}\n\n= f.inputs name: :information do\n\n  = f.input :title, wrapper_html: { class: 'highlighted' }\n(\u7701\u7565)\n\n\n\u307e\u3055\u306b\u6c42\u3081\u3066\u3044\u305f\u30d5\u30a1\u30a4\u30eb\u305d\u306e\u3082\u306e\u3067\u3059\u3002\u3053\u306e\u30d5\u30a9\u30fc\u30e0\u306b\u4e00\u884c\u8ffd\u52a0\u3092\u3057\u305f\u3044\u306e\u3067\u3001\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u81ea\u5206\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u4e0b\u306e\u540c\u3058\u30d1\u30b9\u306b\u30b3\u30d4\u30fc\u3057\u3066\u958b\u304d\u307e\u3059\u3002\ncp {\u30aa\u30ea\u30b8\u30ca\u30eb\u306eEngine\u3092clone\u3057\u3066\u304a\u3044\u305f\u5834\u6240}/app/views/locomotive/pages/_form.html.haml {RAILS_ROOT}/app/views/locomotive/pages/_form.html.haml\nvi {RAILS_ROOT}/app/views/locomotive/pages/_form.html.haml\n\n\u305d\u306e\u5f8c\u305d\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304d\u3001published \u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u884c\u306e\u4e0b\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u884c\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n/app/views/locomotive/pages/_form.html.haml\n  = f.input :published, as: :'Locomotive::Toggle', input_html: { class: 'simple-toggle' }\n\n  = f.input :require_login, as: :'Locomotive::Toggle', input_html: { class: 'simple-toggle' } #\u3053\u306e\u884c\u3092\u8ffd\u52a0\n\n  = f.input :listed, as: :'Locomotive::Toggle', input_html: { class: 'simple-toggle' }\n\n\n\n(\u3053\u306e\u4e00\u884c\u8ffd\u52a0\u3059\u308b\u305f\u3081\u3060\u3051\u306b\u5143\u306eview\u30d5\u30a1\u30a4\u30eb\u5168\u4f53\u3092\u30b3\u30d4\u30fc\u3057\u3066\u304f\u308b\u306e\u306f\u3001\u4eca\u5f8c\u306e\u672c\u5bb6\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3078\u306e\u8ffd\u968f\u306a\u3069\u3092\u8003\u3048\u308b\u3068\u5c11\u3005\u9762\u5012\u3002\u5168\u90e8\u30b3\u30d4\u30fc\u305b\u305a\u306b\u5b9f\u73fe\u3059\u308b\u65b9\u6cd5\u304c\u3042\u308c\u3070\u6559\u3048\u3066\u6b32\u3057\u3044\u3067\u3059\uff01)\n\u305d\u3057\u3066\u7ba1\u7406\u753b\u9762\u304b\u3089\u30da\u30fc\u30b8\u7de8\u96c6\u753b\u9762\u3092\u898b\u3066\u307f\u307e\u3059\u3002\n\n\u7121\u4e8b\u65b0\u3057\u3044\u30d5\u30a3\u30fc\u30eb\u30c9\u304c\u7de8\u96c6\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\uff01ON\u306b\u3059\u308b\u3068\u3061\u3083\u3093\u3068\u65b0\u3057\u3044\u5c5e\u6027\u304c\u66f4\u65b0\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002\n\n\u8a8d\u8a3c\u304c\u5fc5\u8981\u306a\u30da\u30fc\u30b8\u3067\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3092\u51fa\u529b\u3059\u308b\n\u3044\u3088\u3044\u3088\u6700\u5f8c\u306e\u30b9\u30c6\u30c3\u30d7\u3067\u3059\u3002PageController \u306e\u62e1\u5f35\u306e\u6642\u306b\u4f5c\u3063\u305f AuthPage \u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\n\napp/concerns/auth/auth_page.rb\nmodule Auth\n  module AuthPage\n    extend ActiveSupport::Concern\n\n    included do\n      before_filter :authcheck\n    end\n    def authcheck\n      @page ||= self.locomotive_page\n      authenticate_user! if @page && @page.require_login                                                            \n    end\n  end\nend\n\n\nlocomotive_page \u3068\u3044\u3046\u30e1\u30bd\u30c3\u30c9\u306f\u5143\u3005\u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u304c\u6301\u3063\u3066\u3044\u305f\u30e1\u30bd\u30c3\u30c9\u3067\u3001\u8868\u793a\u5bfe\u8c61\u306e\u30da\u30fc\u30b8\u3092\u53d6\u5f97\u3059\u308b\u3082\u306e\u3067\u3059\u3002authenticate_user! \u30e1\u30bd\u30c3\u30c9\u306f\u3001devise \u304c\u63d0\u4f9b\u3059\u308b\u3082\u306e\u3067\u3001\u30ed\u30b0\u30a4\u30f3\u30c1\u30a7\u30c3\u30af\u3092\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3078\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3001\u30ed\u30b0\u30a4\u30f3\u5f8c\u623b\u3063\u3066\u304f\u308b\u3068\u3044\u3046\u3059\u3050\u308c\u3082\u306e\u3067\u3059\u3002\n\u30da\u30fc\u30b8\u306erequire_login\u5c5e\u6027\u304ctrue\u306e\u5834\u5408\u306e\u307f\u3001\u3053\u306eauthenticate_user! \u30e1\u30bd\u30c3\u30c9\u3092\u53e9\u304f\u3068\u3044\u3046\u51e6\u7406\u3092\u3057\u3066\u3044\u308b\u308f\u3051\u3067\u3059\u3002\n\u3053\u306e\u72b6\u614b\u3067\u3001\u5148\u307b\u3069 requre_login \u3092 ON \u306b\u3057\u305f\u30da\u30fc\u30b8\u306b\u30ed\u30b0\u30a4\u30f3\u3092\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u304c\u51fa\u3066\u304f\u308b\u306f\u305a\u3067\u3059\u3002\n\n\u30ed\u30b0\u30a4\u30f3\u3092\u884c\u3046\u3068\u3001\u5143\u3005\u8868\u793a\u3057\u305f\u304b\u3063\u305f\u30da\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u4e00\u65b9\u3001require_login\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u306a\u3044\u30da\u30fc\u30b8\u306f\u3001\u4eca\u307e\u3067\u901a\u308a\u30ed\u30b0\u30a4\u30f3\u3057\u306a\u304f\u3066\u3082\u8868\u793a\u3067\u304d\u307e\u3059\u3002\n\u4ee5\u4e0a\u3067\u3059\uff01\n\uff08\u8ffd\u8a18\uff09\u3053\u3053\u307e\u3067\u66f8\u3044\u305f\u3082\u306e\u306f\u30ed\u30fc\u30ab\u30eb\u306e\u958b\u767a\u74b0\u5883\u3067\u306f\u52d5\u3044\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u306a\u305c\u304b\u4e0a\u8a18\u624b\u9806\u3067\u4f5c\u3063\u305f\u3082\u306e\u3092 Heroku \u306b\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u3068\u3001AuthField\u30af\u30e9\u30b9\u304cundefined method 'field'\u3068\u3044\u3046\u30a8\u30e9\u30fc\u3092\u5410\u3044\u3066\u843d\u3061\u3066\u3057\u307e\u3046\u3068\u3044\u3046\u4e8b\u8c61\u304c\u767a\u751f\u4e2d\u3002\u3069\u3046\u3082app/models/locomotive/page.rb \u3084app/controllers/locomotive/public/pages_controller.rb \u3092\u7f6e\u3044\u305f\u6642\u70b9\u3067\u3001Engine\u5074\u306e\u30af\u30e9\u30b9\u304c\u8aad\u307f\u8fbc\u307e\u308c\u305a\u65b0\u3057\u3044\u30af\u30e9\u30b9\u3067\u4e0a\u66f8\u304d\u72b6\u614b\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u308b\u6a21\u69d8\u3002\u89e3\u6c7a\u7b56\u304c\u5206\u304b\u308b\u4eba\u304c\u3044\u305f\u3089\u6559\u3048\u3066\u4e0b\u3055\u3044\uff01\n2014/04/07\u8ffd\u8a18\uff1a\u3068\u308a\u3042\u3048\u305a\u73fe\u72b6\u3067\u306f\u3001engine \u5074\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u3063\u3066\u6765\u3066\u3001\u305d\u308c\u306b\u30e1\u30bd\u30c3\u30c9\u3092\u8ffd\u52a0\u3057\u305f\u3082\u306e\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u3066\u52d5\u3044\u3066\u3044\u307e\u3059\u3002\u30c0\u30b5\u3044\u30fb\u30fb\u30fb\n\nLocomotive \u95a2\u9023\u306e\u8a18\u4e8b\u4e00\u89a7\uff1a\n* Locomotive Engine \u3092 Heroku \u3067\u52d5\u304b\u3059\u307e\u3067\n* LocomotiveCMS \u3067\u30cb\u30e5\u30fc\u30b9\u8a18\u4e8b\u4e00\u89a7\u6a5f\u80fd\u3092\u4f5c\u308b\n* LocomotiveCMS \u306e\u30da\u30fc\u30b8\u306b\u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c\u6a5f\u80fd\u3092\u7d44\u307f\u8fbc\u3080\uff08Engine\u306e\u62e1\u5f35\uff09\n* LocomotiveCMS + Devise \u3092\u4f7f\u3063\u3066\u4f5c\u3063\u305f\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306e\u30c7\u30b6\u30a4\u30f3\u3092CMS\u5074\u3067\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b(1)\n* LocomotiveCMS + Devise \u3092\u4f7f\u3063\u3066\u4f5c\u3063\u305f\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306e\u30c7\u30b6\u30a4\u30f3\u3092CMS\u5074\u3067\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b(2)\n* LocomotiveCMS + Devise \u3092\u4f7f\u3063\u3066\u4f5c\u3063\u305f\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306e\u30c7\u30b6\u30a4\u30f3\u3092CMS\u5074\u3067\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b(3)\n* LocomotiveCMS \u3067\u3001\u8907\u6570\u306e Heroku \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f7f\u3046\n\n\u30e6\u30fc\u30b6\u30fc\u767b\u9332/\u30ed\u30b0\u30a4\u30f3\u3057\u306a\u3044\u3068\u898b\u308c\u306a\u3044\u30da\u30fc\u30b8\u3092 LocomotiveCMS \u306b\u7d44\u307f\u8fbc\u307f\u305f\u304f\u306a\u308a\u307e\u3057\u305f\u306e\u3067\u3001\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002Rails \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f3.2.16\u3001LocomotiveCMS \u306f2.4.1\u304c\u5bfe\u8c61\u3067\u3059\u3002\n\n\u30e6\u30fc\u30b6\u30fc\u30af\u30e9\u30b9\u306e\u4f5c\u6210\n====\n\n\u307e\u305a\u3001LocomotiveCMS \u306b\u306f\u6700\u521d\u304b\u3089 [devise](https://github.com/plataformatec/devise) \u3068\u3044\u3046Rails\u7528\u306e\u8a8d\u8a3c\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u7d44\u307f\u8fbc\u307e\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u65b0\u3057\u3044\u8a8d\u8a3c\u6a5f\u80fd\u3092\u4ed8\u3051\u52a0\u3048\u308b\u306e\u306f\u7c21\u5358\u305d\u3046\u3067\u3059\u3002LocomotiveCMS \u4e0a\u3067\u306fAccount\u30e2\u30c7\u30eb\u3068\u3044\u3046\u306e\u304c\u3001CMS\u81ea\u4f53\u306e\u7ba1\u7406\u8005\u30e6\u30fc\u30b6\u30fc\u306e\u7ba1\u7406\u306b\u4f7f\u308f\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u305d\u308c\u3068\u306f\u5225\u306b\u3057\u305f\u3044\u306e\u3067User\u30e2\u30c7\u30eb\u3092\u65b0\u305f\u306b\u4f5c\u3063\u3066\u307f\u307e\u3059\u3002\n\n```bash\nbundle exec rails g devise User\n```\n\nLocomotiveCMS\u3067\u306f mongoid \u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3001db:migrate \u306f\u5fc5\u8981\u3042\u308a\u307e\u305b\u3093\u3002unicorn_rails \u306e\u518d\u8d77\u52d5\u3092\u3057\u3066\u3001http://localhost:8080/users/sign_up \u3092\u958b\u3044\u3066\u307f\u308b\u3068\u3001\u767b\u9332\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u306f\u305a\u3067\u3059\u3002\n\n![sign_up.png](https://qiita-image-store.s3.amazonaws.com/0/1399/7b31a530-1e51-e2ec-be11-b0c2ae844b3f.png \"sign_up.png\")\n\n\n\u3053\u3053\u3067ID/Pass\u3092\u767b\u9332\u3059\u308b\u3068\u3001\u30e6\u30fc\u30b6\u767b\u9332\u304c\u3055\u308c\u305f\u72b6\u614b\u3067\u30c8\u30c3\u30d7\u753b\u9762\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u307e\u3059\u3002mongodb \u5074\u3092\u898b\u3066\u307f\u308b\u3068\u3001\u78ba\u304b\u306b\u30e6\u30fc\u30b6\u30fc\u304c\u4f5c\u3089\u308c\u3066\u3044\u307e\u3059\u3002\n\n```bash:\n% mongo localhost:27017\nMongoDB shell version: 2.4.9\nconnecting to: localhost:27017/test\nServer has startup warnings:\nThu Mar 27 17:45:06.188 [initandlisten]\nThu Mar 27 17:45:06.188 [initandlisten] ** WARNING: soft rlimits too low. Number of files is 256, should be at least 1000\n> use mysite_dev\nswitched to db mysite_dev\n> db.users.find()\n{ \"_id\" : ObjectId(\"533675464857099c8d000001\"), \"current_sign_in_at\" : ISODate(\"2014-03-29T07:24:54.852Z\"), \"current_sign_in_ip\" : \"127.0.0.1\", \"email\" : \"hal@georepublic.co.jp\", \"encrypted_password\" : \"$2a$1*******\", \"last_sign_in_at\" : ISODate(\"2014-03-29T07:24:54.852Z\"), \"last_sign_in_ip\" : \"127.0.0.1\", \"sign_in_count\" : 1 }\n>\n```\n\n\u30c7\u30b6\u30a4\u30f3\u3084\u8ffd\u52a0\u306e\u767b\u9332\u9805\u76ee\u3092\u4f5c\u308b\u306e\u306f\u3068\u308a\u3042\u3048\u305a\u5f8c\u56de\u3057\u3067\u5148\u306b\u9032\u307f\u307e\u3059\u3002\n\nPageController \u306e\u62e1\u5f35\n====\n\nLocomotiveCMS \u306f[Engine\u3092\u4f7f\u3063\u3066\u3044\u308b](https://github.com/locomotivecms/engine)\u306e\u3067\u3001[\u516c\u5f0f\u30ac\u30a4\u30c9](http://doc.locomotivecms.com/guides/tweak-models)\u3067\u66f8\u304b\u308c\u3066\u3044\u308b\u3088\u3046\u306b\u3001LocomotiveCMS engine \u5074\u306e\u30d1\u30b9\u3068\u540c\u3058\u5834\u6240\u306b\u30e2\u30c7\u30eb\u3084\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u306e\u30af\u30e9\u30b9\u3092\u7f6e\u304f\u3053\u3068\u3067\u6a5f\u80fd\u3092\u62e1\u5f35\u3067\u304d\u307e\u3059\u3002\ndevelopment.log \u3092\u898b\u3066\u307f\u308b\u3068\u3001\u516c\u958b\u30da\u30fc\u30b8\u3078\u306eGET\u30ea\u30af\u30a8\u30b9\u30c8\u306f\u4ee5\u4e0b\u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u306b\u305f\u3069\u308a\u7740\u304f\u3088\u3046\u3067\u3059\u3002\n\n```development.log\nStarted GET \"/outline\" for 127.0.0.1 at 2014-03-30 11:45:19 +0900\nCreating scope :root. Overwriting existing method Locomotive::Page.root.\nProcessing by Locomotive::Public::PagesController#show as HTML\n  Parameters: {\"path\"=>\"outline\"}\n```\n\n\u3067\u3059\u306e\u3067\u3001\u4eca\u56de\u306f\u3053\u306ePagesController\u3092\u62e1\u5f35\u3057\u3066\u307f\u307e\u3059\u3002\u307e\u305a\u3001LocomotiveCMS Engine\u5074\u3068\u540c\u3058\u3088\u3046\u306b\u3001app/controllers/locomotive/public/pages_controller.rb \u306b\u62e1\u5f35\u7528\u306e\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash:bash\ncd {RAILS_ROOT}\nmkdir -p app/controllers/locomotive/public/\nvi app/controllers/locomotive/public/pages_controller.rb\n```\n\n\u4e2d\u8eab\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\u3053\u308c\u3067\u3001\u65e2\u5b58\u306ePagesController\u30af\u30e9\u30b9\u3092\u518d\u30aa\u30fc\u30d7\u30f3\u3057\u3066\u3001\u65b0\u305f\u306a\u5b9a\u7fa9\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002Auth::AuthPage \u30af\u30e9\u30b9\u306f\u3053\u308c\u304b\u3089\u4f5c\u308b\u8a8d\u8a3c\u7528\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3059\u3002\n\n```ruby:pages_controller.rb\nmodule Locomotive\n  module Public\n    class PagesController < ApplicationController\n      include Auth::AuthPage #AuthPage\u3068\u3044\u3046\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u8aad\u307f\u8fbc\u3080\n    end\n  end\nend\n```\n\n\u5b9f\u969b\u306b\u8a8d\u8a3c\u6a5f\u80fd\u3092\u8ffd\u52a0\u3059\u308b\u3001Auth::AuthPage \u30af\u30e9\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\u5143\u3005 /app/concerns \u4ee5\u4e0b\u306f autoload \u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u3053\u306b\u4ee5\u4e0b\u306e\u30af\u30e9\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n```ruby:app/concerns/auth/auth_page.rb\nmodule Auth\n  module AuthPage\n    extend ActiveSupport::Concern\n\n    included do\n      before_filter :authcheck\n    end\n    def authcheck\n        logger.info \"Auth Check\"\n    end\n  end\nend\n```\n\n\u3053\u306e\u72b6\u614b\u3067\u30b5\u30a4\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306b Auth Check \u3068\u3044\u3046\u30ed\u30b0\u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002\n\n```logs/development.log\nStarted GET \"/entry\" for 127.0.0.1 at 2014-03-30 22:07:38 +0900\nProcessing by Locomotive::Public::PagesController#show as HTML\n  Parameters: {\"path\"=>\"entry\"}\n[LocomotiveCMS] [fetch site] host = localhost / localhost:8080\n  MOPED: 127.0.0.1:27017 QUERY        database=mysite_dev collection=locomotive_sites selector={\"$query\"=>{}, \"$orderby\"=>{:_id=>1}} flags=[:slave_ok] limit=-1 skip=0 batch_size=nil fields=nil (0.5510ms)\nAuth Check  \u2190\u3053\u308c\n  MOPED: 127.0.0.1:27017 QUERY \n\n```\n\n\u307e\u3060\u30ed\u30b0\u3092\u51fa\u529b\u3059\u308b\u3060\u3051\u3067\u5b9f\u969b\u306e\u8a8d\u8a3c\u51e6\u7406\u306f\u884c\u306a\u3063\u3066\u3044\u307e\u305b\u3093\u3002\u3068\u308a\u3042\u3048\u305a\u306f\u3053\u306e\u307e\u307e\u306b\u3057\u3066\u304a\u3044\u3066\u3001\u5148\u306b\u8a8d\u8a3c\u306e\u30aa\u30f3\u30aa\u30d5\u3092\u30da\u30fc\u30b8\u6bce\u306b\u8a2d\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\n\n\u30da\u30fc\u30b8\u5c5e\u6027\u306b\u3001\u30ed\u30b0\u30a4\u30f3\u5fc5\u9808\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8ffd\u52a0\u3059\u308b\n===\n\n\u30da\u30fc\u30b8\u306b\u5bfe\u3057\u3066\u3001\u30ed\u30b0\u30a4\u30f3\u304c\u5fc5\u9808\u306b\u306a\u308b\u3088\u3046\u306a\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002app/concerns/auth/auth_field.rb \u3092\u8ffd\u52a0\u3057\u3001\u4ee5\u4e0b\u306e\u5185\u5bb9\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n```ruby:app/concerns/auth/auth_field.rb \nmodule Auth\n  module AuthField\n    extend ActiveSupport::Concern\n    included do\n      field :require_login,         type: Boolean, localize: true\n    end\n  end\nend\n```\n\n\u4e0a\u8a18\u30e2\u30b8\u30e5\u30fc\u30eb\u3092Page\u30e2\u30c7\u30eb\u304b\u3089include\u3059\u308b\u3053\u3068\u3067\u3001require_login \u3068\u3044\u3046\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u4f5c\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\napp/models/locomotive/page.rb \u30d5\u30a1\u30a4\u30eb\u3092\u65b0\u305f\u306b\u4f5c\u308a\u3001include \u6587\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n```ruby:app/models/locomotive/page.rb \nmodule Locomotive\n  class Page\n    include Auth::AuthField\n  end\nend\n```\n\nPage \u30af\u30e9\u30b9\u304c\u6b63\u3057\u304f\u62e1\u5f35\u3055\u308c\u3066\u3044\u308b\u304b\u3001\u78ba\u304b\u3081\u3066\u307f\u307e\u3057\u3087\u3046\u3002rails console \u304b\u3089`Locomotie.Page`\u30af\u30e9\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n```bash\n% bundle exec rails console\nLoading development environment (Rails 3.2.16)\n[1] pry(main)> \n[2] pry(main)> Locomotive::Page.first()\n=> #<Locomotive::Page _id: 53303a0c485709d69800000e, created_at: 2014-03-24 13:58:36 UTC, updated_at: 2014-03-27 03:27:16 UTC, parent_id: \"5330384f485709d698000004\", parent_ids: [\"5330384f485709d698000004\"], position: 0, depth: 1, serialized_template: {\"ja\"=>#<Moped::BSON::Binary type=:generic length=7286>}, template_dependencies: {\"ja\"=>[\"5330384f485709d698000004\"]}, snippet_dependencies: {\"ja\"=>[\"footer\"]}, templatized: false, templatized_from_parent: false, target_klass_name: nil, redirect: false, redirect_url: nil, redirect_type: 301, listed: true, seo_title: {\"ja\"=>\"\u304a\u77e5\u3089\u305b\"}, meta_keywords: {\"ja\"=>\"html5, \"}, meta_description: {\"ja\"=>\"html5, \"}, title: {\"ja\"=>\"\u304a\u77e5\u3089\u305b\"}, slug: {\"ja\"=>\"news\"}, fullpath: {\"ja\"=>\"news\"}, handle: \"news\", raw_template: {\"ja\"=>\"{% extends 'parent' %}\\n{% block main %}\\n<div class='row'>\\n  <div class='large-8 columns'>\\n    <p>News</p>\\n    {% editable_text \\\"news_body\\\", rows: 20 %}\\n    hoge\\n    {% endeditable_text %}\\n  </div>\\n</div>\\n{% endblock %}\\n\", \"en\"=>\"{% extends 'parent' %}\"}, locales: [:ja], published: true, cache_strategy: \"simple\", response_type: \"text/html\", site_id: \"5330384f485709d698000002\", require_login: nil, cache_strategy_text: \"Simple\", lang: \"ja\">\n\n```\n\n`require_login`\u3068\u3044\u3046\u30d7\u30ed\u30d1\u30c6\u30a3\u304c\u3042\u308b\u306e\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\n\u7ba1\u7406\u753b\u9762\u304b\u3089\u5207\u308a\u66ff\u3048\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n==\n\u3055\u3066\u3001\u3042\u3068\u4e00\u606f\u3067\u3059\u3002\u4eca\u5ea6\u306f\u7ba1\u7406\u753b\u9762\u306eView\u306brequire login\u5c5e\u6027\u3092\u8ffd\u52a0\u3057\u307e\u3057\u3087\u3046\u3002\n\u7ba1\u7406\u753b\u9762\u306e\u30da\u30fc\u30b8\u306f\u3001/locomotive/pages/{ID}/edit \u3068\u3044\u3046URL\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001Engine \u5074\u306e /app/views/locomotive/pages/edit.html.haml\u3092\u898b\u3066\u307f\u307e\u3059\u3068\u3001\u30da\u30fc\u30b8\u306e\u4e0b\u306e\u65b9\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8a18\u8ff0\u304c\u3042\u308a\u307e\u3059\u3002\n\n```haml:/app/views/locomotive/pages/edit.html.haml\n= semantic_form_for @page, url: page_path(@page), html: { multipart: true } do |form|\n\n   = render 'form', f: form \u2190\u3053\u308c\n\n   = render 'locomotive/shared/form_actions', back_url: pages_path, button_label: :update\n```\n\n\u3068\u3044\u3046\u308f\u3051\u3067\u3001\u4eca\u5ea6\u306f /app/views/locomotive/pages/_form.html.haml \u3092\u958b\u304d\u307e\u3059\u3068\u3001\u305d\u308c\u3063\u307d\u3044\u30d5\u30a1\u30a4\u30eb\u304c\u51fa\u3066\u304d\u307e\u3057\u305f\u3002\n\n```/app/views/locomotive/pages/_form.html.haml\n- content_for :head do                                                                                     \n  = render '/locomotive/content_assets/picker'\n  = render '/locomotive/theme_assets/picker'\n  = render 'editable_elements'\n\n- content_for :backbone_view_data do\n  :plain\n    page: #{escape_json to_json(@page)}\n\n= f.inputs name: :information do\n\n  = f.input :title, wrapper_html: { class: 'highlighted' }\n(\u7701\u7565)\n```\n\n\u307e\u3055\u306b\u6c42\u3081\u3066\u3044\u305f\u30d5\u30a1\u30a4\u30eb\u305d\u306e\u3082\u306e\u3067\u3059\u3002\u3053\u306e\u30d5\u30a9\u30fc\u30e0\u306b\u4e00\u884c\u8ffd\u52a0\u3092\u3057\u305f\u3044\u306e\u3067\u3001\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u81ea\u5206\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u4e0b\u306e\u540c\u3058\u30d1\u30b9\u306b\u30b3\u30d4\u30fc\u3057\u3066\u958b\u304d\u307e\u3059\u3002\n\n```bash\ncp {\u30aa\u30ea\u30b8\u30ca\u30eb\u306eEngine\u3092clone\u3057\u3066\u304a\u3044\u305f\u5834\u6240}/app/views/locomotive/pages/_form.html.haml {RAILS_ROOT}/app/views/locomotive/pages/_form.html.haml\nvi {RAILS_ROOT}/app/views/locomotive/pages/_form.html.haml\n```\n\n\u305d\u306e\u5f8c\u305d\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304d\u3001published \u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u884c\u306e\u4e0b\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u884c\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```haml:/app/views/locomotive/pages/_form.html.haml\n  = f.input :published, as: :'Locomotive::Toggle', input_html: { class: 'simple-toggle' }\n\n  = f.input :require_login, as: :'Locomotive::Toggle', input_html: { class: 'simple-toggle' } #\u3053\u306e\u884c\u3092\u8ffd\u52a0\n\n  = f.input :listed, as: :'Locomotive::Toggle', input_html: { class: 'simple-toggle' }\n\n```\n\n(\u3053\u306e\u4e00\u884c\u8ffd\u52a0\u3059\u308b\u305f\u3081\u3060\u3051\u306b\u5143\u306eview\u30d5\u30a1\u30a4\u30eb\u5168\u4f53\u3092\u30b3\u30d4\u30fc\u3057\u3066\u304f\u308b\u306e\u306f\u3001\u4eca\u5f8c\u306e\u672c\u5bb6\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3078\u306e\u8ffd\u968f\u306a\u3069\u3092\u8003\u3048\u308b\u3068\u5c11\u3005\u9762\u5012\u3002\u5168\u90e8\u30b3\u30d4\u30fc\u305b\u305a\u306b\u5b9f\u73fe\u3059\u308b\u65b9\u6cd5\u304c\u3042\u308c\u3070\u6559\u3048\u3066\u6b32\u3057\u3044\u3067\u3059\uff01)\n\n\u305d\u3057\u3066\u7ba1\u7406\u753b\u9762\u304b\u3089\u30da\u30fc\u30b8\u7de8\u96c6\u753b\u9762\u3092\u898b\u3066\u307f\u307e\u3059\u3002\n\n![customized_form.png](https://qiita-image-store.s3.amazonaws.com/0/1399/f1192a62-b367-aa41-7a44-6abf7b3c09a9.png \"customized_form.png\")\n\n\u7121\u4e8b\u65b0\u3057\u3044\u30d5\u30a3\u30fc\u30eb\u30c9\u304c\u7de8\u96c6\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\uff01ON\u306b\u3059\u308b\u3068\u3061\u3083\u3093\u3068\u65b0\u3057\u3044\u5c5e\u6027\u304c\u66f4\u65b0\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002\n\n\u8a8d\u8a3c\u304c\u5fc5\u8981\u306a\u30da\u30fc\u30b8\u3067\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3092\u51fa\u529b\u3059\u308b\n==\n\n\u3044\u3088\u3044\u3088\u6700\u5f8c\u306e\u30b9\u30c6\u30c3\u30d7\u3067\u3059\u3002PageController \u306e\u62e1\u5f35\u306e\u6642\u306b\u4f5c\u3063\u305f AuthPage \u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\n\n```ruby:app/concerns/auth/auth_page.rb\nmodule Auth\n  module AuthPage\n    extend ActiveSupport::Concern\n\n    included do\n      before_filter :authcheck\n    end\n    def authcheck\n      @page ||= self.locomotive_page\n      authenticate_user! if @page && @page.require_login                                                            \n    end\n  end\nend\n```\n\nlocomotive_page \u3068\u3044\u3046\u30e1\u30bd\u30c3\u30c9\u306f\u5143\u3005\u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u304c\u6301\u3063\u3066\u3044\u305f\u30e1\u30bd\u30c3\u30c9\u3067\u3001\u8868\u793a\u5bfe\u8c61\u306e\u30da\u30fc\u30b8\u3092\u53d6\u5f97\u3059\u308b\u3082\u306e\u3067\u3059\u3002authenticate_user! \u30e1\u30bd\u30c3\u30c9\u306f\u3001devise \u304c\u63d0\u4f9b\u3059\u308b\u3082\u306e\u3067\u3001\u30ed\u30b0\u30a4\u30f3\u30c1\u30a7\u30c3\u30af\u3092\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3078\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3001\u30ed\u30b0\u30a4\u30f3\u5f8c\u623b\u3063\u3066\u304f\u308b\u3068\u3044\u3046\u3059\u3050\u308c\u3082\u306e\u3067\u3059\u3002\n\u30da\u30fc\u30b8\u306erequire_login\u5c5e\u6027\u304ctrue\u306e\u5834\u5408\u306e\u307f\u3001\u3053\u306eauthenticate_user! \u30e1\u30bd\u30c3\u30c9\u3092\u53e9\u304f\u3068\u3044\u3046\u51e6\u7406\u3092\u3057\u3066\u3044\u308b\u308f\u3051\u3067\u3059\u3002\n\n\u3053\u306e\u72b6\u614b\u3067\u3001\u5148\u307b\u3069 requre_login \u3092 ON \u306b\u3057\u305f\u30da\u30fc\u30b8\u306b\u30ed\u30b0\u30a4\u30f3\u3092\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u304c\u51fa\u3066\u304f\u308b\u306f\u305a\u3067\u3059\u3002\n\n![sign_up.png](https://qiita-image-store.s3.amazonaws.com/0/1399/7b31a530-1e51-e2ec-be11-b0c2ae844b3f.png \"sign_up.png\")\n\n\u30ed\u30b0\u30a4\u30f3\u3092\u884c\u3046\u3068\u3001\u5143\u3005\u8868\u793a\u3057\u305f\u304b\u3063\u305f\u30da\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u4e00\u65b9\u3001require_login\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u306a\u3044\u30da\u30fc\u30b8\u306f\u3001\u4eca\u307e\u3067\u901a\u308a\u30ed\u30b0\u30a4\u30f3\u3057\u306a\u304f\u3066\u3082\u8868\u793a\u3067\u304d\u307e\u3059\u3002\n\n\u4ee5\u4e0a\u3067\u3059\uff01\n\n\uff08\u8ffd\u8a18\uff09\u3053\u3053\u307e\u3067\u66f8\u3044\u305f\u3082\u306e\u306f\u30ed\u30fc\u30ab\u30eb\u306e\u958b\u767a\u74b0\u5883\u3067\u306f\u52d5\u3044\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u306a\u305c\u304b\u4e0a\u8a18\u624b\u9806\u3067\u4f5c\u3063\u305f\u3082\u306e\u3092 Heroku \u306b\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u3068\u3001AuthField\u30af\u30e9\u30b9\u304c`undefined method 'field'`\u3068\u3044\u3046\u30a8\u30e9\u30fc\u3092\u5410\u3044\u3066\u843d\u3061\u3066\u3057\u307e\u3046\u3068\u3044\u3046\u4e8b\u8c61\u304c\u767a\u751f\u4e2d\u3002\u3069\u3046\u3082app/models/locomotive/page.rb \u3084app/controllers/locomotive/public/pages_controller.rb \u3092\u7f6e\u3044\u305f\u6642\u70b9\u3067\u3001Engine\u5074\u306e\u30af\u30e9\u30b9\u304c\u8aad\u307f\u8fbc\u307e\u308c\u305a\u65b0\u3057\u3044\u30af\u30e9\u30b9\u3067\u4e0a\u66f8\u304d\u72b6\u614b\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u308b\u6a21\u69d8\u3002\u89e3\u6c7a\u7b56\u304c\u5206\u304b\u308b\u4eba\u304c\u3044\u305f\u3089\u6559\u3048\u3066\u4e0b\u3055\u3044\uff01\n2014/04/07\u8ffd\u8a18\uff1a\u3068\u308a\u3042\u3048\u305a\u73fe\u72b6\u3067\u306f\u3001engine \u5074\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u3063\u3066\u6765\u3066\u3001\u305d\u308c\u306b\u30e1\u30bd\u30c3\u30c9\u3092\u8ffd\u52a0\u3057\u305f\u3082\u306e\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u3066\u52d5\u3044\u3066\u3044\u307e\u3059\u3002\u30c0\u30b5\u3044\u30fb\u30fb\u30fb\n\n---\nLocomotive \u95a2\u9023\u306e\u8a18\u4e8b\u4e00\u89a7\uff1a\n* [Locomotive Engine \u3092 Heroku \u3067\u52d5\u304b\u3059\u307e\u3067](http://qiita.com/hal_sk/items/0512a4a9cb215fb016f5)\n* [LocomotiveCMS \u3067\u30cb\u30e5\u30fc\u30b9\u8a18\u4e8b\u4e00\u89a7\u6a5f\u80fd\u3092\u4f5c\u308b](http://qiita.com/hal_sk/items/b72db4a288566e92096c)\n* [LocomotiveCMS \u306e\u30da\u30fc\u30b8\u306b\u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c\u6a5f\u80fd\u3092\u7d44\u307f\u8fbc\u3080\uff08Engine\u306e\u62e1\u5f35\uff09](http://qiita.com/hal_sk/items/c6d4f5582d23bc4dd415)\n* [LocomotiveCMS + Devise \u3092\u4f7f\u3063\u3066\u4f5c\u3063\u305f\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306e\u30c7\u30b6\u30a4\u30f3\u3092CMS\u5074\u3067\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b(1)](http://qiita.com/hal_sk/items/50c45f764cb95615dd59)\n* [LocomotiveCMS + Devise \u3092\u4f7f\u3063\u3066\u4f5c\u3063\u305f\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306e\u30c7\u30b6\u30a4\u30f3\u3092CMS\u5074\u3067\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b(2)](http://qiita.com/hal_sk/items/c0f56736398f1154ddca)\n* [LocomotiveCMS + Devise \u3092\u4f7f\u3063\u3066\u4f5c\u3063\u305f\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306e\u30c7\u30b6\u30a4\u30f3\u3092CMS\u5074\u3067\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b(3)](http://qiita.com/hal_sk/items/92d653f47ddadb6d879c)\n* [LocomotiveCMS \u3067\u3001\u8907\u6570\u306e Heroku \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f7f\u3046](http://qiita.com/hal_sk/items/aba8d324638d205b2ce1)", "tags": ["locomotivecms", "Ruby", "devise", "Rails"]}