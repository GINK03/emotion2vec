{"context": " More than 1 year has passed since last update.\n\n\u554f\u984c\nAzure \u306e SQL \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u5b9a\u671f\u7684\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b Windows \u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u3063\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u4f55\u65e5\u304b\u9023\u7d9a\u3067\u52d5\u304b\u3057\u3066\u3044\u308b\u3068\u305f\u307e\u306b\u3053\u3093\u306a\u30a8\u30e9\u30fc\u304c\u3067\u307e\u3059\u3002\nSystem.Data.Entity.Core.EntityCommandExecutionException: An error occurred while executing the command definition. See the inner exception for details. ---> System.Data.SqlClient.SqlException: \u30b5\u30fc\u30d0\u30fc\u304b\u3089\u7d50\u679c\u3092\u53d7\u4fe1\u3057\u3066\u3044\u308b\u3068\u304d\u306b\u3001\u30c8\u30e9\u30f3\u30b9\u30dd\u30fc\u30c8 \u30ec\u30d9\u30eb\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002 (provider: TCP Provider, error: 0 - \u30bb\u30de\u30d5\u30a9\u304c\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3057\u307e\u3057\u305f\u3002) ---> System.ComponentModel.Win32Exception: \u30bb\u30de\u30d5\u30a9\u304c\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3057\u307e\u3057\u305f\u3002\n\n\n\u539f\u56e0\n\u3067\u3001\u3044\u308d\u3044\u308d\u8abf\u3079\u3066\u539f\u56e0\u306f\u308f\u304b\u3063\u305f\u3002\nhttp://tech.exceedone.co.jp/asp-net-mvc/cloud-sql-azure-connection-retry/\n\n\u30af\u30e9\u30a6\u30c9\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9(SQL Azure)\u306f\u53ef\u6eb6\u6027\u3092\u4fdd\u3064\u305f\u3081\u306b\u3001\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u30fc\u304c\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u9593\u306b\u306f\u3044\u3063\u3066\u304a\u308a\u3001\u9069\u6642\u5207\u308a\u66ff\u3048\u3089\u308c\u307e\u3059\u3002\n\u3068\u3044\u3046\u3053\u3068\u306f\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u304b\u3089\u63a5\u7d9a\u3057\u305f\u30bb\u30c3\u30b7\u30e7\u30f3\uff08\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb\uff09\u304c\u7121\u52b9\u306b\u306a\u3063\u3066\u304a\u308a\u3001\u518d\u5ea6\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u5f35\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\n\u5bfe\u51e6\n\n\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u3002\u3002\nEntity Framework 6 \u3060\u3068\nhttp://qiita.com/mocha/items/f56b477630f9e4481aa2\n\u3068\u304b\u3067\u7c21\u5358\u306b\u518d\u63a5\u7d9a\u51e6\u7406\u3092\u7d44\u307f\u8fbc\u3081\u308b\u307f\u305f\u3044\u306a\u306e\u3067\u3059\u304c\u3001\u3069\u3046\u306b\u3082\u518d\u63a5\u7d9a\u304c\u52b9\u3044\u3066\u3044\u306a\u3044\u6c17\u304c\u3059\u308b\u3002\n\u30c7\u30d0\u30c3\u30b0\u5b9f\u884c\u3057\u305f\u3089\u3084\u3063\u3071\u308a\u30ea\u30c8\u30e9\u30a4\u3059\u308b\u3053\u3068\u306a\u304f catch \u30d6\u30ed\u30c3\u30af\u306b\u98db\u3093\u3067\u3044\u304f\u3002\n\ntest.cs\ntry\n{\n  using (var context = new ApplicationDbContext())\n  {\n    // \u30ab\u30a6\u30f3\u30c8\u3092\u53d6\u5f97\u3059\u308b\u3060\u3051\uff08\u3053\u306e\u51e6\u7406\u3092\u884c\u3046\u307e\u3048\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u5207\u65ad\u3059\u308b\uff09\n    var count = context.Hoges.Count(); // \u2606\u3053\u3053\u3067\u5931\u6557\u3059\u308b\u3068\u30ea\u30c8\u30e9\u30a4\u3057\u3066\u304f\u308c\u308b\u3093\u3058\u3083\u306a\u3044\u306e\uff1f\uff1f\n  }\n}\ncatch (Exception e)\n{\n  Console.WriteLine(e);\n}\n\n\n\n\u3046\u307e\u304f\u3044\u3063\u305f\n\u6d77\u5916\u306e\u30b5\u30a4\u30c8\u3082\u6f01\u3063\u3066\u3001\u3084\u3063\u3068\u3053\u3053\u306b\u305f\u3069\u308a\u7740\u304f\u3002\nhttp://msdn.microsoft.com/en-us/data/dn469464.aspx\nSqlAzureExecutionStrategy\u3092\u6d3e\u751f\u3057\u305fApplicationStrategy\u3067\u3001ShoudRetryOn \u30e1\u30bd\u30c3\u30c9\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u30ea\u30c8\u30e9\u30a4\u6642\u306e\u6319\u52d5\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3089\u3057\u3044\u3002\n\u3053\u3046\u3057\u3066\u307f\u305f\u3002\n\nApplicationStrategy.cs\n    public class ApplicationStrategy : SqlAzureExecutionStrategy\n    {\n        /// <summary>\n        /// \u30ab\u30a6\u30f3\u30c8\u7528\n        /// </summary>\n        private int _count = 0;\n\n        public ApplicationStrategy() : base()\n        {\n            Debug.WriteLine(\"\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf <\" + GetHashCode() + \">\");\n        }\n\n        public ApplicationStrategy(int maxRetryCount, TimeSpan maxDelay)\n            : base(maxRetryCount, maxDelay)\n        {\n            Debug.WriteLine(\"\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <\" + GetHashCode() + \">\");\n        }\n\n        protected override bool ShouldRetryOn(Exception exception)\n        {\n            SqlException sqlException = exception as SqlException;\n            if (sqlException != null)\n            {\n                Debug.WriteLine(\"{0} [{1}]\u5931\u6557{2}\u56de\u76ee\u3067\u3059\u3002\u3002\",\n                    DateTime.Now.ToString(\"yyyy/MM/dd HH:mm:ss(fff)\"),\n                    GetHashCode(),\n                    ++_count);\n                return true;\n            }\n            return base.ShouldRetryOn(exception);\n        }\n    }\n\n\n\u610f\u56f3\u7684\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u5207\u65ad\u3057\u3066\u307f\u305f\u3068\u304d\u306e\u30ed\u30b0\u306f\u3053\u3093\u306a\u611f\u3058\uff08\u30ea\u30c8\u30e9\u30a4\u56de\u6570\u306f5\u3001\u30ea\u30c8\u30e9\u30a4\u9593\u9694\u306f30\u79d2\uff09\u3002\n\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <42387602>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <34449534>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <61826280>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <21803985>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <21548186>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <11060407>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <4757004>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <43989438>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <58736510>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <45655991>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <59956320>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <42290028>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <21251484>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <50052055>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <38868335>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <65654745>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <7490004>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <38654717>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <41339550>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <12551388>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <44844895>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <51558565> <-- \u2606\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <33526412>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <32405628>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <48573094>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <51650977>\n2014/10/23 13:29:24(182) [51558565]\u5931\u65571\u56de\u76ee\u3067\u3059\u3002\u3002 <-- \u2606\n2014/10/23 13:29:25(119) [60884226]\u5931\u65571\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:29:25(151) [60884226]\u5931\u65572\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:29:26(260) [60884226]\u5931\u65573\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:29:29(505) [60884226]\u5931\u65574\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:29:37(935) [60884226]\u5931\u65575\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:29:53(955) [60884226]\u5931\u65576\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:29:53(970) [51558565]\u5931\u65572\u56de\u76ee\u3067\u3059\u3002\u3002 <-- \u2606\n2014/10/23 13:29:55(065) [5367331]\u5931\u65571\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:29:55(097) [5367331]\u5931\u65572\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:29:56(239) [5367331]\u5931\u65573\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:29:59(369) [5367331]\u5931\u65574\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:30:06(549) [5367331]\u5931\u65575\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:30:23(547) [5367331]\u5931\u65576\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:30:23(563) [51558565]\u5931\u65573\u56de\u76ee\u3067\u3059\u3002\u3002 <-- \u2606\n2014/10/23 13:30:26(878) [29895661]\u5931\u65571\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:30:26(911) [29895661]\u5931\u65572\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:30:28(059) [29895661]\u5931\u65573\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:30:31(287) [29895661]\u5931\u65574\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:30:38(801) [29895661]\u5931\u65575\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:30:54(767) [29895661]\u5931\u65576\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:30:54(788) [51558565]\u5931\u65574\u56de\u76ee\u3067\u3059\u3002\u3002 <-- \u2606\n2014/10/23 13:31:02(374) [57177419]\u5931\u65571\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:31:02(421) [57177419]\u5931\u65572\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:31:03(516) [57177419]\u5931\u65573\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:31:07(677) [57177419]\u5931\u65574\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:31:15(323) [57177419]\u5931\u65575\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:31:30(532) [57177419]\u5931\u65576\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:31:30(541) [51558565]\u5931\u65575\u56de\u76ee\u3067\u3059\u3002\u3002 <-- \u2606\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <62572816>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <15348643>\n2014/10/23 13:31:46(750) [15348643]\u5931\u65571\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:31:46(774) [15348643]\u5931\u65572\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:31:47(847) [15348643]\u5931\u65573\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:31:51(138) [15348643]\u5931\u65574\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:31:58(345) [15348643]\u5931\u65575\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:32:14(629) [15348643]\u5931\u65576\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:32:14(629) [51558565]\u5931\u65576\u56de\u76ee\u3067\u3059\u3002\u3002 <-- \u2606\n\u578b 'System.Data.Entity.Infrastructure.RetryLimitExceededException' \u306e\u521d\u56de\u4f8b\u5916\u304c EntityFramework.dll \u3067\u767a\u751f\u3057\u307e\u3057\u305f\nSystem.Data.Entity.Infrastructure.RetryLimitExceededException: Maximum number of retries (5) exceeded while executing database operations with 'ApplicationStrategy'. See inner exception for the most recent failure. ---> System.Data.Entity.Core.EntityException: The underlying provider failed on Open. ---> System.Data.Entity.Infrastructure.RetryLimitExceededException: Maximum number of retries (5) exceeded while executing database operations with 'ApplicationStrategy'. See inner exception for the most recent failure. ---> System.Data.SqlClient.SqlException: SQL Server \u3078\u306e\u63a5\u7d9a\u3092\u78ba\u7acb\u3057\u3066\u3044\u308b\u3068\u304d\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u95a2\u9023\u307e\u305f\u306f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u56fa\u6709\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30b5\u30fc\u30d0\u30fc\u304c\u898b\u3064\u304b\u3089\u306a\u3044\u304b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u305b\u3093\u3002\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u540d\u304c\u6b63\u3057\u3044\u3053\u3068\u3001\u304a\u3088\u3073 SQL Server \u304c\u30ea\u30e2\u30fc\u30c8\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u3088\u3046\u306b\u69cb\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002 (provider: TCP Provider, error: 0 - \u305d\u306e\u3088\u3046\u306a\u30db\u30b9\u30c8\u306f\u4e0d\u660e\u3067\u3059\u3002) ---> System.ComponentModel.Win32Exception: \u305d\u306e\u3088\u3046\u306a\u30db\u30b9\u30c8\u306f\u4e0d\u660e\u3067\u3059\u3002\n\n\u2606\u3060\u3051\u306b\u6ce8\u76ee\u3059\u308b\u3068\u305d\u308c\u3063\u307d\u304f\u30ea\u30c8\u30e9\u30a4\u3067\u304d\u3066\u3044\u307e\u3059\u306d\u3002\u9593\u306b\u631f\u307e\u3063\u3066\u3044\u308b\u306e\u306f\u306a\u3093\u306a\u3093\u3060\u308d\u3046\u3002\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3092\u30d7\u30fc\u30ea\u30f3\u30b0\u3057\u3066\u3044\u308b\u304b\u3089\u304b\u3068\u601d\u3063\u3066\u63a5\u7d9a\u6587\u5b57\u5217\u306bpooling=false;\u3092\u5165\u308c\u3066\u307f\u305f\u3051\u3069\u7d50\u679c\u5909\u308f\u3089\u305a\u3002\n\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u4f7f\u3063\u305f\u51e6\u7406\u3082\u3061\u3083\u3093\u3068\u52d5\u304d\u307e\u3057\u305f\uff08\u30ea\u30c8\u30e9\u30a4\u56de\u6570\u306f5\u3001\u30ea\u30c8\u30e9\u30a4\u9593\u9694\u306f30\u79d2\uff09\u3002\n\n\u578b 'System.Data.Entity.Core.EntityCommandExecutionException' \u306e\u521d\u56de\u4f8b\u5916\u304c EntityFramework.dll \u3067\u767a\u751f\u3057\u307e\u3057\u305f\n2014/10/23 13:41:52(003) [29135544]\u5931\u65571\u56de\u76ee\u3067\u3059\u3002\u3002\n\u578b 'System.Data.Entity.Core.EntityException' \u306e\u521d\u56de\u4f8b\u5916\u304c EntityFramework.dll \u3067\u767a\u751f\u3057\u307e\u3057\u305f\n2014/10/23 13:41:55(428) [29135544]\u5931\u65572\u56de\u76ee\u3067\u3059\u3002\u3002\n\u578b 'System.Data.Entity.Core.EntityException' \u306e\u521d\u56de\u4f8b\u5916\u304c EntityFramework.dll \u3067\u767a\u751f\u3057\u307e\u3057\u305f\n2014/10/23 13:41:57(182) [29135544]\u5931\u65573\u56de\u76ee\u3067\u3059\u3002\u3002\n\u578b 'System.Data.Entity.Core.EntityException' \u306e\u521d\u56de\u4f8b\u5916\u304c EntityFramework.dll \u3067\u767a\u751f\u3057\u307e\u3057\u305f\n2014/10/23 13:42:02(454) [29135544]\u5931\u65574\u56de\u76ee\u3067\u3059\u3002\u3002\n\u30b9\u30ec\u30c3\u30c9 0x1690 \u306f\u30b3\u30fc\u30c9 259 (0x103) \u3067\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002\n\u578b 'System.Data.Entity.Core.EntityException' \u306e\u521d\u56de\u4f8b\u5916\u304c EntityFramework.dll \u3067\u767a\u751f\u3057\u307e\u3057\u305f\n2014/10/23 13:42:11(136) [29135544]\u5931\u65575\u56de\u76ee\u3067\u3059\u3002\u3002\n\u578b 'System.Data.Entity.Core.EntityException' \u306e\u521d\u56de\u4f8b\u5916\u304c EntityFramework.dll \u3067\u767a\u751f\u3057\u307e\u3057\u305f\n2014/10/23 13:42:29(838) [29135544]\u5931\u65576\u56de\u76ee\u3067\u3059\u3002\u3002\n\u578b 'System.Data.Entity.Infrastructure.RetryLimitExceededException' \u306e\u521d\u56de\u4f8b\u5916\u304c EntityFramework.dll \u3067\u767a\u751f\u3057\u307e\u3057\u305f\nSystem.Data.Entity.Infrastructure.RetryLimitExceededException: Maximum number of retries (5) exceeded while executing database operations with 'ApplicationStrategy'. See inner exception for the most recent failure. ---> System.Data.Entity.Core.EntityException: The underlying provider failed on Open. ---> System.Data.SqlClient.SqlException: SQL Server \u3078\u306e\u63a5\u7d9a\u3092\u78ba\u7acb\u3057\u3066\u3044\u308b\u3068\u304d\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u95a2\u9023\u307e\u305f\u306f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u56fa\u6709\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30b5\u30fc\u30d0\u30fc\u304c\u898b\u3064\u304b\u3089\u306a\u3044\u304b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u305b\u3093\u3002\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u540d\u304c\u6b63\u3057\u3044\u3053\u3068\u3001\u304a\u3088\u3073 SQL Server \u304c\u30ea\u30e2\u30fc\u30c8\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u3088\u3046\u306b\u69cb\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002 (provider: TCP Provider, error: 0 - \u305d\u306e\u3088\u3046\u306a\u30db\u30b9\u30c8\u306f\u4e0d\u660e\u3067\u3059\u3002) ---> System.ComponentModel.Win32Exception: \u305d\u306e\u3088\u3046\u306a\u30db\u30b9\u30c8\u306f\u4e0d\u660e\u3067\u3059\u3002\n\n\u3067\u3082\u3001\u30ea\u30c8\u30e9\u30a4\u9593\u9694\uff0830\u79d2\uff09\u306f\u7121\u8996\u3055\u308c\u3066\u307e\u3059\u306d\u3002\u306a\u3093\u306a\u3093\u3060\u308d\u3046\u3002\u3002\n\n\u7d0d\u5f97\u3044\u304b\u306a\u3044\u3053\u3068\uff08\u30e1\u30e2\uff09\n\n\u305d\u3082\u305d\u3082\u3001DBConfiguration \u306e\u62e1\u5f35\u3060\u3051\u3067\u306a\u305c\u30ea\u30c8\u30e9\u30a4\u304c\u52b9\u304b\u306a\u3044\u306e\u304b\u3002\nApplicationStrategy\u3067select\u306e\u30ea\u30c8\u30e9\u30a4\u51e6\u7406\u3092\u884c\u3063\u305f\u3068\u304d\u306e\u5185\u90e8\u51e6\u7406\u304c\u610f\u5473\u4e0d\u660e\u3002\u306a\u3093\u3067ApplicationStrategy\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u3044\u3063\u3071\u3044\u4f7f\u308f\u308c\u3066\u308b\u306e\uff1f\nApplicationStrategy\u3067update\uff08\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\uff09\u306e\u30ea\u30c8\u30e9\u30a4\u51e6\u7406\u3092\u884c\u3063\u305f\u3068\u304d\u3001\u30ea\u30c8\u30e9\u30a4\u9593\u9694\u306e\u8a2d\u5b9a\u304c\u7121\u8996\u3055\u308c\u3066\u3044\u305f\u3002\u306a\u3093\u3067\uff1f\n\n\n\u30ed\u30fc\u30ab\u30ebDB\uff08MDF\u30d5\u30a1\u30a4\u30eb\uff09\u3078\u306e\u30a2\u30bf\u30c3\u30c1\u306b\u5931\u6557\u3059\u308b\u554f\u984c\u3078\u306e\u5bfe\u51e6\nMSTest\u3067\u306f\u30ed\u30fc\u30ab\u30ebDB\u306b\u30a2\u30bf\u30c3\u30c1\u3057\u3066Configuration.Seed()\u3092\u6d41\u3057\u8fbc\u3080\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u30d5\u30a1\u30a4\u30eb\u306b\u30a2\u30bf\u30c3\u30c1\u3067\u304d\u306a\u3044\u3068\u304b\u8a00\u308f\u308c\u307e\u3059\u3002\n\u3057\u3087\u3046\u304c\u306a\u3044\u306e\u3067\u3001\u7121\u7406\u3084\u308aSqlAzure\u7528\u306e\u30b9\u30c8\u30e9\u30c6\u30b8\u3092\u7121\u52b9\u5316\u3057\u3066\u56de\u907f\u3057\u307e\u3057\u305f\u3002\u6ce5\u81ed\u3044\u3002\n```COnfiguration.cs\npublic sealed class Configuration : DbMigrationsConfiguration<ApplicationDbContext>\n{\n    public Configuration()\n    {\n        // \u2606\u30ed\u30fc\u30ab\u30ebDB\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u304d\u306bSqlAzureExecutionStrategy\u3092\u4f7f\u3046\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308b\u305f\u3081\u306e\u82e6\u8089\u306e\u7b56\u3002\n        ApplicationConfiguration.SuspendExecutionStrategy = true;\n\n        // \u3044\u308d\u3044\u308d\n    }\n\n    protected override void Seed(ApplicationDbContext context)\n    {\n        // \u3044\u308d\u3044\u308d\n\n        // \u2606\u623b\u3057\u3066\u304a\u304f\n        ApplicationConfiguration.SuspendExecutionStrategy = false;\n    }\n}\n\n\n## \u554f\u984c\nAzure \u306e SQL \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u5b9a\u671f\u7684\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b Windows \u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u3063\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u4f55\u65e5\u304b\u9023\u7d9a\u3067\u52d5\u304b\u3057\u3066\u3044\u308b\u3068\u305f\u307e\u306b\u3053\u3093\u306a\u30a8\u30e9\u30fc\u304c\u3067\u307e\u3059\u3002\n\n```\nSystem.Data.Entity.Core.EntityCommandExecutionException: An error occurred while executing the command definition. See the inner exception for details. ---> System.Data.SqlClient.SqlException: \u30b5\u30fc\u30d0\u30fc\u304b\u3089\u7d50\u679c\u3092\u53d7\u4fe1\u3057\u3066\u3044\u308b\u3068\u304d\u306b\u3001\u30c8\u30e9\u30f3\u30b9\u30dd\u30fc\u30c8 \u30ec\u30d9\u30eb\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002 (provider: TCP Provider, error: 0 - \u30bb\u30de\u30d5\u30a9\u304c\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3057\u307e\u3057\u305f\u3002) ---> System.ComponentModel.Win32Exception: \u30bb\u30de\u30d5\u30a9\u304c\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3057\u307e\u3057\u305f\u3002\n```\n\n## \u539f\u56e0\n\u3067\u3001\u3044\u308d\u3044\u308d\u8abf\u3079\u3066\u539f\u56e0\u306f\u308f\u304b\u3063\u305f\u3002\nhttp://tech.exceedone.co.jp/asp-net-mvc/cloud-sql-azure-connection-retry/\n\n> \u30af\u30e9\u30a6\u30c9\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9(SQL Azure)\u306f\u53ef\u6eb6\u6027\u3092\u4fdd\u3064\u305f\u3081\u306b\u3001\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u30fc\u304c\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u9593\u306b\u306f\u3044\u3063\u3066\u304a\u308a\u3001\u9069\u6642\u5207\u308a\u66ff\u3048\u3089\u308c\u307e\u3059\u3002\n> \n> \u3068\u3044\u3046\u3053\u3068\u306f\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u304b\u3089\u63a5\u7d9a\u3057\u305f\u30bb\u30c3\u30b7\u30e7\u30f3\uff08\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb\uff09\u304c\u7121\u52b9\u306b\u306a\u3063\u3066\u304a\u308a\u3001\u518d\u5ea6\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u5f35\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n## \u5bfe\u51e6\n### \u3046\u307e\u304f\u3044\u304b\u306a\u3044\u3002\u3002\nEntity Framework 6 \u3060\u3068\nhttp://qiita.com/mocha/items/f56b477630f9e4481aa2\n\u3068\u304b\u3067\u7c21\u5358\u306b\u518d\u63a5\u7d9a\u51e6\u7406\u3092\u7d44\u307f\u8fbc\u3081\u308b\u307f\u305f\u3044\u306a\u306e\u3067\u3059\u304c\u3001\u3069\u3046\u306b\u3082\u518d\u63a5\u7d9a\u304c\u52b9\u3044\u3066\u3044\u306a\u3044\u6c17\u304c\u3059\u308b\u3002\n\u30c7\u30d0\u30c3\u30b0\u5b9f\u884c\u3057\u305f\u3089\u3084\u3063\u3071\u308a\u30ea\u30c8\u30e9\u30a4\u3059\u308b\u3053\u3068\u306a\u304f catch \u30d6\u30ed\u30c3\u30af\u306b\u98db\u3093\u3067\u3044\u304f\u3002\n\n``` test.cs\ntry\n{\n  using (var context = new ApplicationDbContext())\n  {\n    // \u30ab\u30a6\u30f3\u30c8\u3092\u53d6\u5f97\u3059\u308b\u3060\u3051\uff08\u3053\u306e\u51e6\u7406\u3092\u884c\u3046\u307e\u3048\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u5207\u65ad\u3059\u308b\uff09\n    var count = context.Hoges.Count(); // \u2606\u3053\u3053\u3067\u5931\u6557\u3059\u308b\u3068\u30ea\u30c8\u30e9\u30a4\u3057\u3066\u304f\u308c\u308b\u3093\u3058\u3083\u306a\u3044\u306e\uff1f\uff1f\n  }\n}\ncatch (Exception e)\n{\n  Console.WriteLine(e);\n}\n```\n\n### \u3046\u307e\u304f\u3044\u3063\u305f\n\u6d77\u5916\u306e\u30b5\u30a4\u30c8\u3082\u6f01\u3063\u3066\u3001\u3084\u3063\u3068\u3053\u3053\u306b\u305f\u3069\u308a\u7740\u304f\u3002\nhttp://msdn.microsoft.com/en-us/data/dn469464.aspx\n\nSqlAzureExecutionStrategy\u3092\u6d3e\u751f\u3057\u305fApplicationStrategy\u3067\u3001ShoudRetryOn \u30e1\u30bd\u30c3\u30c9\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u30ea\u30c8\u30e9\u30a4\u6642\u306e\u6319\u52d5\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3089\u3057\u3044\u3002\n\u3053\u3046\u3057\u3066\u307f\u305f\u3002\n\n```ApplicationStrategy.cs\n    public class ApplicationStrategy : SqlAzureExecutionStrategy\n    {\n        /// <summary>\n        /// \u30ab\u30a6\u30f3\u30c8\u7528\n        /// </summary>\n        private int _count = 0;\n\n        public ApplicationStrategy() : base()\n        {\n            Debug.WriteLine(\"\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf <\" + GetHashCode() + \">\");\n        }\n\n        public ApplicationStrategy(int maxRetryCount, TimeSpan maxDelay)\n            : base(maxRetryCount, maxDelay)\n        {\n            Debug.WriteLine(\"\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <\" + GetHashCode() + \">\");\n        }\n\n        protected override bool ShouldRetryOn(Exception exception)\n        {\n            SqlException sqlException = exception as SqlException;\n            if (sqlException != null)\n            {\n                Debug.WriteLine(\"{0} [{1}]\u5931\u6557{2}\u56de\u76ee\u3067\u3059\u3002\u3002\",\n                    DateTime.Now.ToString(\"yyyy/MM/dd HH:mm:ss(fff)\"),\n                    GetHashCode(),\n                    ++_count);\n                return true;\n            }\n            return base.ShouldRetryOn(exception);\n        }\n    }\n```\n\n\u610f\u56f3\u7684\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u5207\u65ad\u3057\u3066\u307f\u305f\u3068\u304d\u306e\u30ed\u30b0\u306f\u3053\u3093\u306a\u611f\u3058\uff08\u30ea\u30c8\u30e9\u30a4\u56de\u6570\u306f5\u3001\u30ea\u30c8\u30e9\u30a4\u9593\u9694\u306f30\u79d2\uff09\u3002\n```\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <42387602>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <34449534>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <61826280>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <21803985>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <21548186>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <11060407>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <4757004>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <43989438>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <58736510>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <45655991>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <59956320>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <42290028>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <21251484>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <50052055>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <38868335>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <65654745>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <7490004>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <38654717>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <41339550>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <12551388>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <44844895>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <51558565> <-- \u2606\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <33526412>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <32405628>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <48573094>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <51650977>\n2014/10/23 13:29:24(182) [51558565]\u5931\u65571\u56de\u76ee\u3067\u3059\u3002\u3002 <-- \u2606\n2014/10/23 13:29:25(119) [60884226]\u5931\u65571\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:29:25(151) [60884226]\u5931\u65572\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:29:26(260) [60884226]\u5931\u65573\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:29:29(505) [60884226]\u5931\u65574\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:29:37(935) [60884226]\u5931\u65575\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:29:53(955) [60884226]\u5931\u65576\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:29:53(970) [51558565]\u5931\u65572\u56de\u76ee\u3067\u3059\u3002\u3002 <-- \u2606\n2014/10/23 13:29:55(065) [5367331]\u5931\u65571\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:29:55(097) [5367331]\u5931\u65572\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:29:56(239) [5367331]\u5931\u65573\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:29:59(369) [5367331]\u5931\u65574\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:30:06(549) [5367331]\u5931\u65575\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:30:23(547) [5367331]\u5931\u65576\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:30:23(563) [51558565]\u5931\u65573\u56de\u76ee\u3067\u3059\u3002\u3002 <-- \u2606\n2014/10/23 13:30:26(878) [29895661]\u5931\u65571\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:30:26(911) [29895661]\u5931\u65572\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:30:28(059) [29895661]\u5931\u65573\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:30:31(287) [29895661]\u5931\u65574\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:30:38(801) [29895661]\u5931\u65575\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:30:54(767) [29895661]\u5931\u65576\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:30:54(788) [51558565]\u5931\u65574\u56de\u76ee\u3067\u3059\u3002\u3002 <-- \u2606\n2014/10/23 13:31:02(374) [57177419]\u5931\u65571\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:31:02(421) [57177419]\u5931\u65572\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:31:03(516) [57177419]\u5931\u65573\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:31:07(677) [57177419]\u5931\u65574\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:31:15(323) [57177419]\u5931\u65575\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:31:30(532) [57177419]\u5931\u65576\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:31:30(541) [51558565]\u5931\u65575\u56de\u76ee\u3067\u3059\u3002\u3002 <-- \u2606\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <62572816>\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf2 <15348643>\n2014/10/23 13:31:46(750) [15348643]\u5931\u65571\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:31:46(774) [15348643]\u5931\u65572\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:31:47(847) [15348643]\u5931\u65573\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:31:51(138) [15348643]\u5931\u65574\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:31:58(345) [15348643]\u5931\u65575\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:32:14(629) [15348643]\u5931\u65576\u56de\u76ee\u3067\u3059\u3002\u3002\n2014/10/23 13:32:14(629) [51558565]\u5931\u65576\u56de\u76ee\u3067\u3059\u3002\u3002 <-- \u2606\n\u578b 'System.Data.Entity.Infrastructure.RetryLimitExceededException' \u306e\u521d\u56de\u4f8b\u5916\u304c EntityFramework.dll \u3067\u767a\u751f\u3057\u307e\u3057\u305f\nSystem.Data.Entity.Infrastructure.RetryLimitExceededException: Maximum number of retries (5) exceeded while executing database operations with 'ApplicationStrategy'. See inner exception for the most recent failure. ---> System.Data.Entity.Core.EntityException: The underlying provider failed on Open. ---> System.Data.Entity.Infrastructure.RetryLimitExceededException: Maximum number of retries (5) exceeded while executing database operations with 'ApplicationStrategy'. See inner exception for the most recent failure. ---> System.Data.SqlClient.SqlException: SQL Server \u3078\u306e\u63a5\u7d9a\u3092\u78ba\u7acb\u3057\u3066\u3044\u308b\u3068\u304d\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u95a2\u9023\u307e\u305f\u306f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u56fa\u6709\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30b5\u30fc\u30d0\u30fc\u304c\u898b\u3064\u304b\u3089\u306a\u3044\u304b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u305b\u3093\u3002\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u540d\u304c\u6b63\u3057\u3044\u3053\u3068\u3001\u304a\u3088\u3073 SQL Server \u304c\u30ea\u30e2\u30fc\u30c8\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u3088\u3046\u306b\u69cb\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002 (provider: TCP Provider, error: 0 - \u305d\u306e\u3088\u3046\u306a\u30db\u30b9\u30c8\u306f\u4e0d\u660e\u3067\u3059\u3002) ---> System.ComponentModel.Win32Exception: \u305d\u306e\u3088\u3046\u306a\u30db\u30b9\u30c8\u306f\u4e0d\u660e\u3067\u3059\u3002\n```\n\n\u2606\u3060\u3051\u306b\u6ce8\u76ee\u3059\u308b\u3068\u305d\u308c\u3063\u307d\u304f\u30ea\u30c8\u30e9\u30a4\u3067\u304d\u3066\u3044\u307e\u3059\u306d\u3002\u9593\u306b\u631f\u307e\u3063\u3066\u3044\u308b\u306e\u306f\u306a\u3093\u306a\u3093\u3060\u308d\u3046\u3002\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3092\u30d7\u30fc\u30ea\u30f3\u30b0\u3057\u3066\u3044\u308b\u304b\u3089\u304b\u3068\u601d\u3063\u3066\u63a5\u7d9a\u6587\u5b57\u5217\u306b`pooling=false;`\u3092\u5165\u308c\u3066\u307f\u305f\u3051\u3069\u7d50\u679c\u5909\u308f\u3089\u305a\u3002\n\n\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u4f7f\u3063\u305f\u51e6\u7406\u3082\u3061\u3083\u3093\u3068\u52d5\u304d\u307e\u3057\u305f\uff08\u30ea\u30c8\u30e9\u30a4\u56de\u6570\u306f5\u3001\u30ea\u30c8\u30e9\u30a4\u9593\u9694\u306f30\u79d2\uff09\u3002\n```\n\u578b 'System.Data.Entity.Core.EntityCommandExecutionException' \u306e\u521d\u56de\u4f8b\u5916\u304c EntityFramework.dll \u3067\u767a\u751f\u3057\u307e\u3057\u305f\n2014/10/23 13:41:52(003) [29135544]\u5931\u65571\u56de\u76ee\u3067\u3059\u3002\u3002\n\u578b 'System.Data.Entity.Core.EntityException' \u306e\u521d\u56de\u4f8b\u5916\u304c EntityFramework.dll \u3067\u767a\u751f\u3057\u307e\u3057\u305f\n2014/10/23 13:41:55(428) [29135544]\u5931\u65572\u56de\u76ee\u3067\u3059\u3002\u3002\n\u578b 'System.Data.Entity.Core.EntityException' \u306e\u521d\u56de\u4f8b\u5916\u304c EntityFramework.dll \u3067\u767a\u751f\u3057\u307e\u3057\u305f\n2014/10/23 13:41:57(182) [29135544]\u5931\u65573\u56de\u76ee\u3067\u3059\u3002\u3002\n\u578b 'System.Data.Entity.Core.EntityException' \u306e\u521d\u56de\u4f8b\u5916\u304c EntityFramework.dll \u3067\u767a\u751f\u3057\u307e\u3057\u305f\n2014/10/23 13:42:02(454) [29135544]\u5931\u65574\u56de\u76ee\u3067\u3059\u3002\u3002\n\u30b9\u30ec\u30c3\u30c9 0x1690 \u306f\u30b3\u30fc\u30c9 259 (0x103) \u3067\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002\n\u578b 'System.Data.Entity.Core.EntityException' \u306e\u521d\u56de\u4f8b\u5916\u304c EntityFramework.dll \u3067\u767a\u751f\u3057\u307e\u3057\u305f\n2014/10/23 13:42:11(136) [29135544]\u5931\u65575\u56de\u76ee\u3067\u3059\u3002\u3002\n\u578b 'System.Data.Entity.Core.EntityException' \u306e\u521d\u56de\u4f8b\u5916\u304c EntityFramework.dll \u3067\u767a\u751f\u3057\u307e\u3057\u305f\n2014/10/23 13:42:29(838) [29135544]\u5931\u65576\u56de\u76ee\u3067\u3059\u3002\u3002\n\u578b 'System.Data.Entity.Infrastructure.RetryLimitExceededException' \u306e\u521d\u56de\u4f8b\u5916\u304c EntityFramework.dll \u3067\u767a\u751f\u3057\u307e\u3057\u305f\nSystem.Data.Entity.Infrastructure.RetryLimitExceededException: Maximum number of retries (5) exceeded while executing database operations with 'ApplicationStrategy'. See inner exception for the most recent failure. ---> System.Data.Entity.Core.EntityException: The underlying provider failed on Open. ---> System.Data.SqlClient.SqlException: SQL Server \u3078\u306e\u63a5\u7d9a\u3092\u78ba\u7acb\u3057\u3066\u3044\u308b\u3068\u304d\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u95a2\u9023\u307e\u305f\u306f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u56fa\u6709\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30b5\u30fc\u30d0\u30fc\u304c\u898b\u3064\u304b\u3089\u306a\u3044\u304b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u305b\u3093\u3002\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u540d\u304c\u6b63\u3057\u3044\u3053\u3068\u3001\u304a\u3088\u3073 SQL Server \u304c\u30ea\u30e2\u30fc\u30c8\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u3088\u3046\u306b\u69cb\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002 (provider: TCP Provider, error: 0 - \u305d\u306e\u3088\u3046\u306a\u30db\u30b9\u30c8\u306f\u4e0d\u660e\u3067\u3059\u3002) ---> System.ComponentModel.Win32Exception: \u305d\u306e\u3088\u3046\u306a\u30db\u30b9\u30c8\u306f\u4e0d\u660e\u3067\u3059\u3002\n```\n\u3067\u3082\u3001\u30ea\u30c8\u30e9\u30a4\u9593\u9694\uff0830\u79d2\uff09\u306f\u7121\u8996\u3055\u308c\u3066\u307e\u3059\u306d\u3002\u306a\u3093\u306a\u3093\u3060\u308d\u3046\u3002\u3002\n\n### \u7d0d\u5f97\u3044\u304b\u306a\u3044\u3053\u3068\uff08\u30e1\u30e2\uff09\n* \u305d\u3082\u305d\u3082\u3001DBConfiguration \u306e\u62e1\u5f35\u3060\u3051\u3067\u306a\u305c\u30ea\u30c8\u30e9\u30a4\u304c\u52b9\u304b\u306a\u3044\u306e\u304b\u3002\n* ApplicationStrategy\u3067select\u306e\u30ea\u30c8\u30e9\u30a4\u51e6\u7406\u3092\u884c\u3063\u305f\u3068\u304d\u306e\u5185\u90e8\u51e6\u7406\u304c\u610f\u5473\u4e0d\u660e\u3002\u306a\u3093\u3067ApplicationStrategy\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u3044\u3063\u3071\u3044\u4f7f\u308f\u308c\u3066\u308b\u306e\uff1f\n* ApplicationStrategy\u3067update\uff08\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\uff09\u306e\u30ea\u30c8\u30e9\u30a4\u51e6\u7406\u3092\u884c\u3063\u305f\u3068\u304d\u3001\u30ea\u30c8\u30e9\u30a4\u9593\u9694\u306e\u8a2d\u5b9a\u304c\u7121\u8996\u3055\u308c\u3066\u3044\u305f\u3002\u306a\u3093\u3067\uff1f\n\n### \u30ed\u30fc\u30ab\u30ebDB\uff08MDF\u30d5\u30a1\u30a4\u30eb\uff09\u3078\u306e\u30a2\u30bf\u30c3\u30c1\u306b\u5931\u6557\u3059\u308b\u554f\u984c\u3078\u306e\u5bfe\u51e6\nMSTest\u3067\u306f\u30ed\u30fc\u30ab\u30ebDB\u306b\u30a2\u30bf\u30c3\u30c1\u3057\u3066Configuration.Seed()\u3092\u6d41\u3057\u8fbc\u3080\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u30d5\u30a1\u30a4\u30eb\u306b\u30a2\u30bf\u30c3\u30c1\u3067\u304d\u306a\u3044\u3068\u304b\u8a00\u308f\u308c\u307e\u3059\u3002\n\u3057\u3087\u3046\u304c\u306a\u3044\u306e\u3067\u3001\u7121\u7406\u3084\u308aSqlAzure\u7528\u306e\u30b9\u30c8\u30e9\u30c6\u30b8\u3092\u7121\u52b9\u5316\u3057\u3066\u56de\u907f\u3057\u307e\u3057\u305f\u3002\u6ce5\u81ed\u3044\u3002\n```COnfiguration.cs\n\n    public sealed class Configuration : DbMigrationsConfiguration<ApplicationDbContext>\n    {\n        public Configuration()\n        {\n            // \u2606\u30ed\u30fc\u30ab\u30ebDB\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u304d\u306bSqlAzureExecutionStrategy\u3092\u4f7f\u3046\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308b\u305f\u3081\u306e\u82e6\u8089\u306e\u7b56\u3002\n            ApplicationConfiguration.SuspendExecutionStrategy = true;\n\n            // \u3044\u308d\u3044\u308d\n        }\n\n        protected override void Seed(ApplicationDbContext context)\n        {\n            // \u3044\u308d\u3044\u308d\n\n            // \u2606\u623b\u3057\u3066\u304a\u304f\n            ApplicationConfiguration.SuspendExecutionStrategy = false;\n        }\n    }\n\n```\n", "tags": ["EntityFramework6.0"]}