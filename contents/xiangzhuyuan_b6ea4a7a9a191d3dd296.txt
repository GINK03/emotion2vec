{"context": "\nlook\n\u770bindex.html\u6587\u4ef6\u53ea\u6709\u7528\u5230js/bundle.js \u6587\u4ef6, \u7136\u540ebundle.js\u54ea\u91cc\u6765, \u770b\u770bpackage.json,\n  \"scripts\": {\n    \"start\": \"watchify -o js/bundle.js -v -d js/app.js\",\n    \"build\": \"browserify . -t [envify --NODE_ENV production] | uglifyjs -cm > js/bundle.min.js\",\n    \"test\": \"jest\"\n  }\n\napp.js \u4f5c\u4e3a\u5165\u53e3, \u7136\u540e\u76d1\u89c6, \u4e00\u65e6\u53d1\u751f\u6539\u53d8\u5c31\u56de\u7f16\u8bd1\u5230 bundle.js.\n\u7136\u540e\u63a5\u7740\u770b, app.js \u5185\u5bb9:\nvar React = require('react');\n\nvar TodoApp = require('./components/TodoApp.react'); // here\n\nReact.render(\n  <TodoApp />,\n  document.getElementById('todoapp')\n);\n\n\n\u4e00\u4e2aTodoApp \u641e\u5b9a\u4e00\u5207. \u81f3\u4e8e\u5b83\u4f55\u6765\u5934\u8fd9\u5c31\u8981\u5f00\u7bc7\u8bb2\u4e86.\n\n\u521b\u5efa\u4e00\u4e2a dispatcher\n\u521b\u5efa\u4e00\u4e2a dispatcher, \u4e0b\u9762\u662f\u4e00\u4e2a\u7b80\u5355\u4f8b\u5b50,\u4f7f\u7528\u4e86 javascript \u7684 promises\n\nvar Promise = require('es6-promise').Promise;\nvar assign = require('object-assign');\n\nvar _callbacks = [];\nvar _promises = [];\n\nvar Dispatcher = function() {};\nDispatcher.prototype = assign({}, Dispatcher.prototype, {\n\n  /**\n   * Register a Store's callback so that it may be invoked by an action.\n   * @param {function} callback The callback to be registered.\n   * @return {number} The index of the callback within the _callbacks array.\n   */\n  register: function(callback) {\n    _callbacks.push(callback);\n    return _callbacks.length - 1; // index\n  },\n\n  /**\n   * dispatch\n   * @param  {object} payload The data from the action.\n   */\n  dispatch: function(payload) {\n    // First create array of promises for callbacks to reference.\n    var resolves = [];\n    var rejects = [];\n    _promises = _callbacks.map(function(_, i) {\n      return new Promise(function(resolve, reject) {\n        resolves[i] = resolve;\n        rejects[i] = reject;\n      });\n    });\n    // Dispatch to callbacks and resolve/reject promises.\n    _callbacks.forEach(function(callback, i) {\n      // Callback can return an obj, to resolve, or a promise, to chain.\n      // See waitFor() for why this might be useful.\n      Promise.resolve(callback(payload)).then(function() {\n        resolves[i](payload);\n      }, function() {\n        rejects[i](new Error('Dispatcher callback unsuccessful'));\n      });\n    });\n    _promises = [];\n  }\n});\n\nmodule.exports = Dispatcher;\n\n\u8fd9\u4e2adispatch \u53ea\u516c\u5f00\u4e862\u4e2a\u65b9\u6cd5register() \u548cdispatch(),\u6211\u4eec\u5c06\u4f1a\u4f7f\u7528register() \u6765\u7ed9store \u6ce8\u518c\u56de\u8c03\u51fd\u6570, \u901a\u8fc7dispatch() \u6765\u89e6\u53d1\u8fd9\u4e9b action \u5b8c\u6210\u56de\u8c03.\n\u90a3\u597d\u6211\u4eec\u6765\u770b\u770b\u4e0b\u9762\u4ee3\u7801:\nvar Dispatcher = require('./Dispatcher');\nvar assign = require('object-assign');\n\nvar AppDispatcher = assign({}, Dispatcher.prototype, {\n\n  /**\n   * A bridge function between the views and the dispatcher, marking the action\n   * as a view action.  Another variant here could be handleServerAction.\n   * @param  {object} action The data coming from the view.\n   */\n  handleViewAction: function(action) {\n    this.dispatch({\n      source: 'VIEW_ACTION',\n      action: action\n    });\n  }\n\n});\n\nmodule.exports = AppDispatcher;\n\n\n\n\u521b\u5efa stores\n\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7node\u7684EventEmitter \u6765\u521b\u5efastore, \u6211\u4eec\u9700\u8981\u901a\u8fc7EventEmitter \u6765\u5e7f\u64adchange \u4e8b\u4ef6\u7ed9\u76f8\u5173\u7684controller-view \u6765\u770b\u770b\u5230\u5e95\u957f\u5565\u6837,\nvar AppDispatcher = require('../dispatcher/AppDispatcher');\nvar EventEmitter = require('events').EventEmitter;\nvar TodoConstants = require('../constants/TodoConstants');\nvar assign = require('object-assign');\n\nvar CHANGE_EVENT = 'change';\n\nvar _todos = {}; // collection of todo items\n\n/**\n * Create a TODO item.\n * @param {string} text The content of the TODO\n */\nfunction create(text) {\n  // Using the current timestamp in place of a real id.\n  var id = Date.now();\n  _todos[id] = {\n    id: id,\n    complete: false,\n    text: text\n  };\n}\n\n/**\n * Delete a TODO item.\n * @param {string} id\n */\nfunction destroy(id) {\n  delete _todos[id];\n}\n\n// \u7ee7\u627f\u4e86 EventEmitter\nvar TodoStore = assign({}, EventEmitter.prototype, {\n\n  /**\n   * Get the entire collection of TODOs.\n   * @return {object}\n   */\n  getAll: function() {\n    return _todos;\n  },\n\n  emitChange: function() {\n    this.emit(CHANGE_EVENT);\n  },\n\n  /**\n   * @param {function} callback\n   */\n  addChangeListener: function(callback) {\n    this.on(CHANGE_EVENT, callback);\n  },\n\n  /**\n   * @param {function} callback\n   */\n  removeChangeListener: function(callback) {\n    this.removeListener(CHANGE_EVENT, callback);\n  },\n\n  // \u6ce8\u518c action\n  dispatcherIndex: AppDispatcher.register(function(payload) {\n    var action = payload.action;\n    var text;\n\n    switch(action.actionType) {\n      case TodoConstants.TODO_CREATE:\n        text = action.text.trim();\n        if (text !== '') {\n          create(text);\n          TodoStore.emitChange();\n        }\n        break;\n\n      case TodoConstants.TODO_DESTROY:\n        destroy(action.id);\n        TodoStore.emitChange();\n        break;\n\n      // add more cases for other actionTypes, like TODO_UPDATE, etc.\n    }\n\n    return true; // No errors. Needed by promise in Dispatcher.\n  })\n\n});\n\nmodule.exports = TodoStore;\n\n\u4e0a\u9762\u4ee3\u7801\u91cc\u6709\u4e9b\u5730\u65b9\u9700\u8981\u8bf4\u660e\u4e0b, \u4ece\u6700\u5f00\u59cb\u7684\u65f6\u5019\u6211\u4eec\u521b\u5efa\u4e86\u4e00\u4e2a_ tods \u7684\u79c1\u6709\u5bf9\u8c61,\u8fd9\u4e2a\u5bf9\u8c61\u5305\u542b\u4e86\u6240\u6709\u7684\u5355\u72ectodilist \u7684 item, \u56e0\u4e3a\u5b83\u5728 class \u5916\u9762\u5b58\u5728. \u4f46\u662f\u5374\u5b83\u5374\u5374\u5728\u4e8e module \u7684\u8fd9\u4e2a\u95ed\u5305\u91cc, \u8fd9\u6837\u5b83\u5c31\u4e0d\u53ef\u4ee5\u5728 module \u610f\u5916\u7684\u5730\u65b9\u5457\u4fee\u6539, \u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u4e00\u4e2a\u76f4\u63a5\u8fdb\u51fa\u7684\u63a5\u53e3\u7ed9\u6211\u4eec\u7684\u6570\u636e\u6d41,\u4fdd\u8bc1\u53ea\u6709\u5728\u901a\u8fc7 action \u7684\u60c5\u51b5\u4e0b\u624d\u53ef\u4ee5\u4fee\u6539\u6570\u636e.\n\u53e6\u5916\u4e00\u4e2a\u5730\u65b9\u5c31\u662f\u6ce8\u518c action \u7684\u56de\u8c03\u51fd\u6570\u5230dispatcher \u4e0a,\u6211\u4eec\u628a\u6c14\u7403\u7684\u6570\u636e\u4ea4\u7ed9\u4e2a\u56de\u8c03\u51fd\u6570\u6765\u5904\u7406,\u5e76\u4e14\u628a\u5b83\u6ce8\u518c\u5728 dispatcher \u91cc.\u5f53\u524d\u6211\u4eec\u53ea\u8d1f\u8d23\u4e24\u4e2a\u4e0d\u540c\u7684actiontype. \u4e4b\u540e\u6211\u4eec\u53ef\u4ee5\u6dfb\u52a0\u66f4\u591a.\n\n\u901a\u8fc7controller-view \u6765\u76d1\u542c\u4fee\u6539\u4e8b\u4ef6\n\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u4f4d\u4e8e\u7ec4\u5efa\u4f53\u7cfb\u7684\u6700\u4e0a\u5c42\u7684React \u7ec4\u4ef6\u6765\u76d1\u542c\u6240\u6709\u7684change \u4e8b\u4ef6.\u5728\u5927\u578b\u5e94\u7528\u4e2d\u6211\u4eec\u53ef\u80fd\u9700\u8981\u66f4\u591a\u7684\u7ec4\u4ef6\u6765\u76d1\u542c.\u53ef\u80fd\u4e00\u4e2a\u9875\u9762\u91cc\u6bcf\u4e00\u4e2a section \u90fd\u9700\u8981\u4e00\u4e2a\u76d1\u542c\u7ec4\u4ef6. \u4e0b\u9762\u6765\u770b\u770b\u7b80\u5355\u7684\u4ee3\u7801\u793a\u4f8b, \u5b8c\u6574\u7684\u53ef\u4ee5\u67e5\u770bgithub repo todomvc.\nvar Footer = require('./Footer.react');\nvar Header = require('./Header.react');\nvar MainSection = require('./MainSection.react');\nvar React = require('react');\nvar TodoStore = require('../stores/TodoStore');\n\nfunction getTodoState() {\n  return {\n    allTodos: TodoStore.getAll()\n  };\n}\n\nvar TodoApp = React.createClass({\n\n  getInitialState: function() {\n    return getTodoState();\n  },\n\n  componentDidMount: function() {\n    TodoStore.addChangeListener(this._onChange);\n  },\n\n  componentWillUnmount: function() {\n    TodoStore.removeChangeListener(this._onChange);\n  },\n\n  /**\n   * @return {object}\n   */\n  render: function() {\n    return (\n      <div>\n        <Header />\n        <MainSection\n          allTodos={this.state.allTodos}\n          areAllComplete={this.state.areAllComplete}\n        />\n        <Footer allTodos={this.state.allTodos} />\n      </div>\n    );\n  },\n\n  _onChange: function() {\n    this.setState(getTodoState());\n  }\n\n});\n\nmodule.exports = TodoApp;\n\n\u5230\u8fd9\u91cc,\u6211\u4eec\u5df2\u7ecf\u8fdb\u5165 React\u7684\u4e16\u754c,\u901a\u8fc7\u4f7f\u7528 react \u7684\u751f\u547d\u5468\u671f\u65b9\u6cd5,\u901a\u8fc7getInitialState()\u521d\u59cb\u5316\u8fd9\u4e2acontroller-vew, \u7136\u540e\u901a\u8fc7componentDidMount()\u6765\u5b8c\u6210\u4e8b\u4ef6\u76d1\u542c, \u7136\u540e\u901a\u8fc7componentWillUnmount()\u6765\u5b8c\u6210\u6e05\u7406. \u6211\u4eec\u6e32\u67d3\u4e86\u4e00\u4e2adiv \u7136\u540e\u628a\u4ece store \u54ea\u91cc\u62ff\u5230\u7684\u6570\u636e\u586b\u5145\u8fdb\u53bb.\n\n\u5173\u4e8e\u89c6\u56fe\n\u7ad9\u5728\u66f4\u9ad8\u4e00\u4e9b\u7684\u89d2\u5ea6,\u6211\u4eec\u53ef\u4ee5\u628a\u5f53\u524d\u7684 React \u7ec4\u4ef6\u7cfb\u7edf\u7406\u89e3\u6210\u5982\u4e0b\u7684\u7ed3\u6784:\n<TodoApp>\n  <Header>\n    <TodoTextInput />\n  </Header>\n\n  <MainSection>\n    <ul>\n      <TodoItem />\n    </ul>\n  </MainSection>\n\n</TodoApp>\n\n\u5982\u679c\u5f53\u524d\u8fdb\u5165\u4e00\u4e2a\u7f16\u8f91\u6a21\u5f0f,\u5b83\u8fd8\u4f1a\u6e32\u67d3\u4e00\u4e2aTodoTextInput\u7684\u5b50\u7c7b, \u8ba9\u6211\u4eec\u6765\u770b\u770b\u8fd9\u4e9b\u7ec4\u4ef6\u662f\u5982\u4f55\u4eceprops \u54ea\u91cc\u62ff\u5230\u7ec4\u4ef6\u7136\u540e\u5c55\u793a\u4ed6\u4eec\u7684, \u7136\u540e\u8fd8\u6709\u4ed6\u4eec\u5982\u4f55\u5728 action \u548c dispatcher \u4e4b\u95f4\u4ea4\u4e92\u901a\u4fe1. \u8fd9\u4e2aMainSection \u9700\u8981\u904d\u5386todo item \u4ece Todoapp \u90a3\u62ff\u6765\u7684 list. \u5728\u7ec4\u4ef6\u7684render() \u65b9\u6cd5\u91cc\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u505a:\nvar allTodos = this.props.allTodos;\n\nfor (var key in allTodos) {\n  todos.push(<TodoItem key={key} todo={allTodos[key]} />);\n}\n\nreturn (\n  <section id=\"main\">\n    <ul id=\"todo-list\">{todos}</ul>\n  </section>\n);\n\n\n\u5230\u8fd9\u91cc, \u6211\u4eec\u53ef\u4ee5\u5c55\u793a\u6bcf\u4e00\u4e2a item, \u901a\u8fc7 id \u53ef\u4ee5\u7f16\u8f91, \u540c\u6837\u53ef\u4ee5\u5220\u9664\u4e00\u4e2a item\nvar React = require('react');\nvar TodoActions = require('../actions/TodoActions');\nvar TodoTextInput = require('./TodoTextInput.react');\n\nvar TodoItem = React.createClass({\n\n  propTypes: {\n    todo: React.PropTypes.object.isRequired\n  },\n\n  render: function() {\n    var todo = this.props.todo;\n\n    return (\n      <li\n        key={todo.id}>\n        <label>\n          {todo.text}\n        </label>\n        <button className=\"destroy\" onClick={this._onDestroyClick} />\n      </li>\n    );\n  },\n\n  _onDestroyClick: function() {\n    TodoActions.destroy(this.props.todo.id);\n  }\n\n});\n\nmodule.exports = TodoItem;\n\n\n\u521b\u5efa\u4e00\u4e9b\u8bed\u4e49\u5316\u7684\u52a8\u4f5c\u65b9\u6cd5\n\n![Kobito.Y2j11m.png](https://qiita-image-store.s3.amazonaws.com/0/56713/6aaf131b-127f-a7e9-e0cb-568833d93ec2.png \"Kobito.Y2j11m.png\")\n\n\nlook\n\n\u770b` index.html`\u6587\u4ef6\u53ea\u6709\u7528\u5230` js/bundle.js` \u6587\u4ef6, \u7136\u540e` bundle.js`\u54ea\u91cc\u6765, \u770b\u770b` package.json`,\n\n```\n  \"scripts\": {\n    \"start\": \"watchify -o js/bundle.js -v -d js/app.js\",\n    \"build\": \"browserify . -t [envify --NODE_ENV production] | uglifyjs -cm > js/bundle.min.js\",\n    \"test\": \"jest\"\n  }\n```\n`app.js` \u4f5c\u4e3a\u5165\u53e3, \u7136\u540e\u76d1\u89c6, \u4e00\u65e6\u53d1\u751f\u6539\u53d8\u5c31\u56de\u7f16\u8bd1\u5230 `bundle.js`.\n\n\u7136\u540e\u63a5\u7740\u770b, `app.js` \u5185\u5bb9:\n\n```\nvar React = require('react');\n\nvar TodoApp = require('./components/TodoApp.react'); // here\n\nReact.render(\n  <TodoApp />,\n  document.getElementById('todoapp')\n);\n\n```\n\n\u4e00\u4e2a` TodoApp` \u641e\u5b9a\u4e00\u5207. \u81f3\u4e8e\u5b83\u4f55\u6765\u5934\u8fd9\u5c31\u8981\u5f00\u7bc7\u8bb2\u4e86.\n\n###\u521b\u5efa\u4e00\u4e2a dispatcher\n\n\u521b\u5efa\u4e00\u4e2a dispatcher, \u4e0b\u9762\u662f\u4e00\u4e2a\u7b80\u5355\u4f8b\u5b50,\u4f7f\u7528\u4e86 javascript \u7684 promises\n\n```\n\nvar Promise = require('es6-promise').Promise;\nvar assign = require('object-assign');\n\nvar _callbacks = [];\nvar _promises = [];\n\nvar Dispatcher = function() {};\nDispatcher.prototype = assign({}, Dispatcher.prototype, {\n\n  /**\n   * Register a Store's callback so that it may be invoked by an action.\n   * @param {function} callback The callback to be registered.\n   * @return {number} The index of the callback within the _callbacks array.\n   */\n  register: function(callback) {\n    _callbacks.push(callback);\n    return _callbacks.length - 1; // index\n  },\n\n  /**\n   * dispatch\n   * @param  {object} payload The data from the action.\n   */\n  dispatch: function(payload) {\n    // First create array of promises for callbacks to reference.\n    var resolves = [];\n    var rejects = [];\n    _promises = _callbacks.map(function(_, i) {\n      return new Promise(function(resolve, reject) {\n        resolves[i] = resolve;\n        rejects[i] = reject;\n      });\n    });\n    // Dispatch to callbacks and resolve/reject promises.\n    _callbacks.forEach(function(callback, i) {\n      // Callback can return an obj, to resolve, or a promise, to chain.\n      // See waitFor() for why this might be useful.\n      Promise.resolve(callback(payload)).then(function() {\n        resolves[i](payload);\n      }, function() {\n        rejects[i](new Error('Dispatcher callback unsuccessful'));\n      });\n    });\n    _promises = [];\n  }\n});\n\nmodule.exports = Dispatcher;\n```\n\n\u8fd9\u4e2a` dispatch` \u53ea\u516c\u5f00\u4e862\u4e2a\u65b9\u6cd5` register()` \u548c` dispatch()`,\u6211\u4eec\u5c06\u4f1a\u4f7f\u7528` register()` \u6765\u7ed9` store` \u6ce8\u518c\u56de\u8c03\u51fd\u6570, \u901a\u8fc7` dispatch()` \u6765\u89e6\u53d1\u8fd9\u4e9b action \u5b8c\u6210\u56de\u8c03.\n\n\n\u90a3\u597d\u6211\u4eec\u6765\u770b\u770b\u4e0b\u9762\u4ee3\u7801:\n\n```\nvar Dispatcher = require('./Dispatcher');\nvar assign = require('object-assign');\n\nvar AppDispatcher = assign({}, Dispatcher.prototype, {\n\n  /**\n   * A bridge function between the views and the dispatcher, marking the action\n   * as a view action.  Another variant here could be handleServerAction.\n   * @param  {object} action The data coming from the view.\n   */\n  handleViewAction: function(action) {\n    this.dispatch({\n      source: 'VIEW_ACTION',\n      action: action\n    });\n  }\n\n});\n\nmodule.exports = AppDispatcher;\n\n```\n\n###\u521b\u5efa stores\n\n\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7` node`\u7684` EventEmitter` \u6765\u521b\u5efa` store`, \u6211\u4eec\u9700\u8981\u901a\u8fc7` EventEmitter` \u6765\u5e7f\u64ad` change` \u4e8b\u4ef6\u7ed9\u76f8\u5173\u7684` controller-view` \u6765\u770b\u770b\u5230\u5e95\u957f\u5565\u6837,\n\n```\nvar AppDispatcher = require('../dispatcher/AppDispatcher');\nvar EventEmitter = require('events').EventEmitter;\nvar TodoConstants = require('../constants/TodoConstants');\nvar assign = require('object-assign');\n\nvar CHANGE_EVENT = 'change';\n\nvar _todos = {}; // collection of todo items\n\n/**\n * Create a TODO item.\n * @param {string} text The content of the TODO\n */\nfunction create(text) {\n  // Using the current timestamp in place of a real id.\n  var id = Date.now();\n  _todos[id] = {\n    id: id,\n    complete: false,\n    text: text\n  };\n}\n\n/**\n * Delete a TODO item.\n * @param {string} id\n */\nfunction destroy(id) {\n  delete _todos[id];\n}\n\n// \u7ee7\u627f\u4e86 EventEmitter\nvar TodoStore = assign({}, EventEmitter.prototype, {\n\n  /**\n   * Get the entire collection of TODOs.\n   * @return {object}\n   */\n  getAll: function() {\n    return _todos;\n  },\n\n  emitChange: function() {\n    this.emit(CHANGE_EVENT);\n  },\n\n  /**\n   * @param {function} callback\n   */\n  addChangeListener: function(callback) {\n    this.on(CHANGE_EVENT, callback);\n  },\n\n  /**\n   * @param {function} callback\n   */\n  removeChangeListener: function(callback) {\n    this.removeListener(CHANGE_EVENT, callback);\n  },\n\n  // \u6ce8\u518c action\n  dispatcherIndex: AppDispatcher.register(function(payload) {\n    var action = payload.action;\n    var text;\n\n    switch(action.actionType) {\n      case TodoConstants.TODO_CREATE:\n        text = action.text.trim();\n        if (text !== '') {\n          create(text);\n          TodoStore.emitChange();\n        }\n        break;\n\n      case TodoConstants.TODO_DESTROY:\n        destroy(action.id);\n        TodoStore.emitChange();\n        break;\n\n      // add more cases for other actionTypes, like TODO_UPDATE, etc.\n    }\n\n    return true; // No errors. Needed by promise in Dispatcher.\n  })\n\n});\n\nmodule.exports = TodoStore;\n```\n\u4e0a\u9762\u4ee3\u7801\u91cc\u6709\u4e9b\u5730\u65b9\u9700\u8981\u8bf4\u660e\u4e0b, \u4ece\u6700\u5f00\u59cb\u7684\u65f6\u5019\u6211\u4eec\u521b\u5efa\u4e86\u4e00\u4e2a`_ tods` \u7684\u79c1\u6709\u5bf9\u8c61,\u8fd9\u4e2a\u5bf9\u8c61\u5305\u542b\u4e86\u6240\u6709\u7684\u5355\u72ec` todi`list \u7684 item, \u56e0\u4e3a\u5b83\u5728 class \u5916\u9762\u5b58\u5728. \u4f46\u662f\u5374\u5b83\u5374\u5374\u5728\u4e8e module \u7684\u8fd9\u4e2a`\u95ed\u5305`\u91cc, \u8fd9\u6837\u5b83\u5c31\u4e0d\u53ef\u4ee5\u5728 module \u610f\u5916\u7684\u5730\u65b9\u5457\u4fee\u6539, \u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u4e00\u4e2a\u76f4\u63a5\u8fdb\u51fa\u7684\u63a5\u53e3\u7ed9\u6211\u4eec\u7684\u6570\u636e\u6d41,\u4fdd\u8bc1\u53ea\u6709\u5728\u901a\u8fc7 action \u7684\u60c5\u51b5\u4e0b\u624d\u53ef\u4ee5\u4fee\u6539\u6570\u636e.\n\n\u53e6\u5916\u4e00\u4e2a\u5730\u65b9\u5c31\u662f\u6ce8\u518c action \u7684\u56de\u8c03\u51fd\u6570\u5230` dispatcher` \u4e0a,\u6211\u4eec\u628a\u6c14\u7403\u7684\u6570\u636e\u4ea4\u7ed9\u4e2a\u56de\u8c03\u51fd\u6570\u6765\u5904\u7406,\u5e76\u4e14\u628a\u5b83\u6ce8\u518c\u5728 dispatcher \u91cc.\u5f53\u524d\u6211\u4eec\u53ea\u8d1f\u8d23\u4e24\u4e2a\u4e0d\u540c\u7684`actiontype`. \u4e4b\u540e\u6211\u4eec\u53ef\u4ee5\u6dfb\u52a0\u66f4\u591a.\n\n\n###\u901a\u8fc7` controller-view` \u6765\u76d1\u542c\u4fee\u6539\u4e8b\u4ef6\n\n**\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u4f4d\u4e8e\u7ec4\u5efa\u4f53\u7cfb\u7684\u6700\u4e0a\u5c42\u7684`React \u7ec4\u4ef6`\u6765\u76d1\u542c\u6240\u6709\u7684` change` \u4e8b\u4ef6.**\u5728\u5927\u578b\u5e94\u7528\u4e2d\u6211\u4eec\u53ef\u80fd\u9700\u8981\u66f4\u591a\u7684\u7ec4\u4ef6\u6765\u76d1\u542c.\u53ef\u80fd\u4e00\u4e2a\u9875\u9762\u91cc\u6bcf\u4e00\u4e2a section \u90fd\u9700\u8981\u4e00\u4e2a\u76d1\u542c\u7ec4\u4ef6. \u4e0b\u9762\u6765\u770b\u770b\u7b80\u5355\u7684\u4ee3\u7801\u793a\u4f8b, \u5b8c\u6574\u7684\u53ef\u4ee5\u67e5\u770b` github repo todomvc`.\n\n```\nvar Footer = require('./Footer.react');\nvar Header = require('./Header.react');\nvar MainSection = require('./MainSection.react');\nvar React = require('react');\nvar TodoStore = require('../stores/TodoStore');\n\nfunction getTodoState() {\n  return {\n    allTodos: TodoStore.getAll()\n  };\n}\n\nvar TodoApp = React.createClass({\n\n  getInitialState: function() {\n    return getTodoState();\n  },\n\n  componentDidMount: function() {\n    TodoStore.addChangeListener(this._onChange);\n  },\n\n  componentWillUnmount: function() {\n    TodoStore.removeChangeListener(this._onChange);\n  },\n\n  /**\n   * @return {object}\n   */\n  render: function() {\n    return (\n      <div>\n        <Header />\n        <MainSection\n          allTodos={this.state.allTodos}\n          areAllComplete={this.state.areAllComplete}\n        />\n        <Footer allTodos={this.state.allTodos} />\n      </div>\n    );\n  },\n\n  _onChange: function() {\n    this.setState(getTodoState());\n  }\n\n});\n\nmodule.exports = TodoApp;\n```\n\u5230\u8fd9\u91cc,\u6211\u4eec\u5df2\u7ecf\u8fdb\u5165 React\u7684\u4e16\u754c,\u901a\u8fc7\u4f7f\u7528 react \u7684\u751f\u547d\u5468\u671f\u65b9\u6cd5,\u901a\u8fc7` getInitialState()`\u521d\u59cb\u5316\u8fd9\u4e2a` controller-vew`, \u7136\u540e\u901a\u8fc7` componentDidMount()`\u6765\u5b8c\u6210\u4e8b\u4ef6\u76d1\u542c, \u7136\u540e\u901a\u8fc7` componentWillUnmount()`\u6765\u5b8c\u6210\u6e05\u7406. \u6211\u4eec\u6e32\u67d3\u4e86\u4e00\u4e2a` div` \u7136\u540e\u628a\u4ece store \u54ea\u91cc\u62ff\u5230\u7684\u6570\u636e\u586b\u5145\u8fdb\u53bb.\n\n###\u5173\u4e8e\u89c6\u56fe\n\n\u7ad9\u5728\u66f4\u9ad8\u4e00\u4e9b\u7684\u89d2\u5ea6,\u6211\u4eec\u53ef\u4ee5\u628a\u5f53\u524d\u7684 React \u7ec4\u4ef6\u7cfb\u7edf\u7406\u89e3\u6210\u5982\u4e0b\u7684\u7ed3\u6784:\n\n```\n<TodoApp>\n  <Header>\n    <TodoTextInput />\n  </Header>\n\n  <MainSection>\n    <ul>\n      <TodoItem />\n    </ul>\n  </MainSection>\n\n</TodoApp>\n```\n\n\u5982\u679c\u5f53\u524d\u8fdb\u5165\u4e00\u4e2a\u7f16\u8f91\u6a21\u5f0f,\u5b83\u8fd8\u4f1a\u6e32\u67d3\u4e00\u4e2a` TodoTextInput`\u7684\u5b50\u7c7b, \u8ba9\u6211\u4eec\u6765\u770b\u770b\u8fd9\u4e9b\u7ec4\u4ef6\u662f\u5982\u4f55\u4ece` props` \u54ea\u91cc\u62ff\u5230\u7ec4\u4ef6\u7136\u540e\u5c55\u793a\u4ed6\u4eec\u7684, \u7136\u540e\u8fd8\u6709\u4ed6\u4eec\u5982\u4f55\u5728 action \u548c dispatcher \u4e4b\u95f4\u4ea4\u4e92\u901a\u4fe1. \u8fd9\u4e2a` MainSection` \u9700\u8981\u904d\u5386` todo item` \u4ece Todoapp \u90a3\u62ff\u6765\u7684 list. \u5728\u7ec4\u4ef6\u7684` render()` \u65b9\u6cd5\u91cc\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u505a:\n\n\n```\nvar allTodos = this.props.allTodos;\n\nfor (var key in allTodos) {\n  todos.push(<TodoItem key={key} todo={allTodos[key]} />);\n}\n\nreturn (\n  <section id=\"main\">\n    <ul id=\"todo-list\">{todos}</ul>\n  </section>\n);\n\n```\n\n\n\u5230\u8fd9\u91cc, \u6211\u4eec\u53ef\u4ee5\u5c55\u793a\u6bcf\u4e00\u4e2a item, \u901a\u8fc7 id \u53ef\u4ee5\u7f16\u8f91, \u540c\u6837\u53ef\u4ee5\u5220\u9664\u4e00\u4e2a item\n\n```\nvar React = require('react');\nvar TodoActions = require('../actions/TodoActions');\nvar TodoTextInput = require('./TodoTextInput.react');\n\nvar TodoItem = React.createClass({\n\n  propTypes: {\n    todo: React.PropTypes.object.isRequired\n  },\n\n  render: function() {\n    var todo = this.props.todo;\n\n    return (\n      <li\n        key={todo.id}>\n        <label>\n          {todo.text}\n        </label>\n        <button className=\"destroy\" onClick={this._onDestroyClick} />\n      </li>\n    );\n  },\n\n  _onDestroyClick: function() {\n    TodoActions.destroy(this.props.todo.id);\n  }\n\n});\n\nmodule.exports = TodoItem;\n```\n\n\n\n### \u521b\u5efa\u4e00\u4e9b\u8bed\u4e49\u5316\u7684\u52a8\u4f5c\u65b9\u6cd5\n\n\n", "tags": ["flux"]}