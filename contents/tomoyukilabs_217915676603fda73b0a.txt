{"context": "\u203b 2016/11/1: IETF\u3088\u308a\u65b0\u3057\u3044\u4ed5\u69d8\u30c9\u30e9\u30d5\u30c8draft-ietf-webpush-encryption-06\u304c\u516c\u958b\u3055\u308c\u307e\u3057\u305f\u3002 WebPush\u306e\u6697\u53f7\u5316\u624b\u9806\u306b\u5909\u66f4\u304c\u52a0\u3048\u3089\u308c\u305f\u6a21\u69d8\u3067\u3059\u306e\u3067\u3001\u30d6\u30e9\u30a6\u30b6\u53ca\u3073\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u306e\u5bfe\u5fdc\u72b6\u6cc1\u304c\u78ba\u8a8d\u51fa\u6765\u6b21\u7b2c\u3001\u8ffd\u3063\u3066\u672c\u8a18\u4e8b\u3082\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u307e\u3059\u3002\n\u203b 2016/5/27: Web Push\u6697\u53f7\u5316\u306b\u30b5\u30fc\u30d0\u8a8d\u8a3c\u3092\u7d44\u307f\u5408\u308f\u305b\u308bVAPID\u306e\u4f7f\u3044\u65b9\u3092\u5225\u8a18\u4e8b\u306b\u307e\u3068\u3081\u307e\u3057\u305f\u3002Chrome 52\u4ee5\u964d\u3067\u306f\u3001FCM/GCM\u5c02\u7528\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u304f\u3053\u3068\u306a\u304fWeb Push\u304c\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u203b 2016/2/26: Web Push\u306e\u30b5\u30f3\u30d7\u30eb\u30da\u30fc\u30b8\u3092\u7528\u610f\u3057\u307e\u3057\u305f\u3002\u53c2\u8003\u307e\u3067\u306b\u30b3\u30fc\u30c9\u3092GitHub\u306b\u7f6e\u304d\u307e\u3057\u305f\u3002\n\u5148\u306b\u300cChrome\u3067W3C Push API\u3092\u4f7f\u3063\u3066\u307f\u305f\u300d\u3084\u300cFirefox (Developer Edition)\u3067W3C Push API\u3092\u4f7f\u3063\u3066\u307f\u308b\u300d\u3067\u66f8\u304d\u307e\u3057\u305f\u3088\u3046\u306b\u3001\u30d6\u30e9\u30a6\u30b6\u3067\u306e\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u306e\u5bfe\u5fdc\u304c\u5f90\u3005\u306b\u5f62\u306b\u306a\u3063\u3066\u304d\u3066\u3044\u307e\u3059\u3002\nChrome\u3084Firefox\u3067\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u3092\u901a\u77e5\u3060\u3051\u3067\u306f\u306a\u304f\u30c7\u30fc\u30bf(\u30da\u30a4\u30ed\u30fc\u30c9)\u4ed8\u304d\u3067\u9001\u308c\u308b\u3088\u3046\u306b\u3059\u308b\u306b\u306f\u3001\u30da\u30a4\u30ed\u30fc\u30c9\u306e\u6697\u53f7\u5316(Web Push Encryption)\u304c\u5fc5\u8981\u3068\u306a\u308a\u307e\u3059\u304c\u3001Chrome 50\u4ee5\u964d\u3001Firefox for Desktop 46\u4ee5\u964d\u3001Firefox for Android 48\u4ee5\u964d\u3067\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u672c\u8a18\u4e8b\u3067\u306f\u305d\u306e\u65b9\u6cd5\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002(\u3061\u306a\u307f\u306b\u3001Microsoft Edge\u3067\u3082Push API\u306e\u5b9f\u88c5\u304c\u9032\u3093\u3067\u3044\u308b\u3088\u3046\u3067\u3059\u3002)\n\u4eca\u56de\u306f\u6697\u53f7\u5316\u304c\u7d61\u307f\u307e\u3059\u306e\u3067\u3001\u3061\u3087\u3063\u3068\u96e3\u3057\u3044\u5185\u5bb9\u306b\u306a\u308a\u307e\u3059\u304c\u3001\u3054\u4e86\u627f\u4e0b\u3055\u3044\u3002\n\nWeb Push\nChrome\u3067\u306f\u5f53\u521d\u30d0\u30fc\u30b8\u30e7\u30f342\u3067Google Cloud Messaging (GCM)\u3092\u5229\u7528\u3057\u305f\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u307e\u3057\u305f\u304c\u3001\u73fe\u5728\u306fIETF\u3067\u30d6\u30e9\u30a6\u30b6\u9593\u3067\u5171\u901a\u306e\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u30d7\u30ed\u30c8\u30b3\u30eb\u3068\u3057\u3066WebPush\u30d7\u30ed\u30c8\u30b3\u30eb(RFC 8030)\u304c\u6a19\u6e96\u5316\u3055\u308c\u3066\u304a\u308a\u3001Chrome\u3068Firefox\u306e\u4e21\u65b9\u304cWebPush\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002WebPush\u306fHTTP/2\u306e\u65b0\u6a5f\u80fd\u3067\u3042\u308b\u30b5\u30fc\u30d0\u30d7\u30c3\u30b7\u30e5\u7b49\u3092\u6d3b\u7528\u3057\u305f\u3053\u3068\u304c\u7279\u5fb4\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u308c\u306f\u4e3b\u306b\u30d6\u30e9\u30a6\u30b6\u3068\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u30b5\u30fc\u30d3\u30b9\u5074\u306e\u4ed5\u7d44\u307f\u3067\u3042\u308a\u3001\u958b\u767a\u8005\u306f\u7279\u306b\u305d\u308c\u3092\u610f\u8b58\u305b\u305a\u3001\u5f93\u6765\u306eHTTP\u306e\u30ce\u30a6\u30cf\u30a6\u304c\u3042\u308c\u3070\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u5168\u4f53\u306e\u69cb\u6210\u8981\u7d20\u3068\u3057\u3066\u306f\u3001\n\n\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\n\u30d6\u30e9\u30a6\u30b6(UA: User Agent)\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\n\n\u304c\u3042\u308a\u307e\u3059\u3002\u30d6\u30e9\u30a6\u30b6\u306f\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u306e\u8cfc\u8aad\u3092\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u306b\u8981\u6c42\u3059\u308b\u3068\u3001\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u304b\u3089UA\u306b\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u304b\u3089UA\u306b\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u3092\u9001\u308b\u969b\u306e\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u5074\u306eURL\u304c\u9001\u3089\u308c\u307e\u3059\u3002W3C Push API\u3067\u306f\u3053\u306eURL\u3092endpoint\u3068\u547c\u3093\u3067\u3044\u307e\u3059\u3002\n\u3061\u306a\u307f\u306b\u3001\u73fe\u6642\u70b9(2016/3/1)\u3067\u306fFirefox\u306f\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u306e\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u30b5\u30fc\u30d0autopush\u3092\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u3068\u3057\u3066\u5229\u7528\u3057\u3066\u304a\u308a\u3001HTTP/2\u3067\u306f\u306a\u304fWebSocket\u3067autopush\u30b5\u30fc\u30d0\u3068\u63a5\u7d9a\u3057\u3066\u3044\u307e\u3059\u3002(Firefox for Android\u3067\u3082\u540c\u69d8\u306e\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u81ea\u4f53\u306f\u73fe\u6642\u70b9\u3067\u306fGCM\u3092\u9593\u63a5\u7684\u306b\u5229\u7528\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002)\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u6697\u53f7\u5316\nWeb Push\u3067\u306f\u3001\u3055\u3089\u306b\u3001\u4e2d\u9593\u8005\u653b\u6483\u306a\u3069\u306e\u30ea\u30b9\u30af\u3092\u8efd\u6e1b\u3057\u3066\u30d7\u30e9\u30a4\u30d0\u30b7\u30fc\u3092\u9ad8\u3081\u308b\u305f\u3081\u306b\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u3068UA\u306e2\u8005\u3060\u3051\u304c\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u89e3\u8aad\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u306b\u3001\u9375\u5171\u6709\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u7528\u3044\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u6697\u53f7\u5316\u3092\u7528\u3044\u307e\u3059[draft-ietf-webpush-encryption-02]\u3002\u3053\u3053\u3067\u3001\u9375\u5171\u6709\u306b\u306fECDH (Elliptic Curve Diffie-Hellman)\u3001\u6697\u53f7\u5316\u306f128\u30d3\u30c3\u30c8AES-GCM (Galois/Counter Mode)\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u307e\u305a\u3001\u9375\u5171\u6709\u306e\u4ed5\u7d44\u307f\u306b\u3064\u3044\u3066\u7c21\u5358\u306b\u8aac\u660e\u3057\u307e\u3059\u3068\u3001\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u308b\u5074\u3082\u53d7\u3051\u308b\u5074\u3082\u3001\u307e\u305a\u516c\u958b\u9375\u3068\u79d8\u5bc6\u9375\u306e\u9375\u30da\u30a2\u3092\u4f5c\u6210\u3059\u308b\u3002\n\u300c\u9001\u308b\u5074\u306e\u516c\u958b\u9375\u3068\u53d7\u3051\u308b\u5074\u306e\u79d8\u5bc6\u9375\u300d\u300c\u53d7\u3051\u308b\u5074\u306e\u516c\u958b\u9375\u3068\u9001\u308b\u5074\u306e\u79d8\u5bc6\u9375\u300d\u306e\u3069\u3061\u3089\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u3082\u540c\u3058\u5171\u6709\u9375\u3092\u751f\u6210\u3067\u304d\u308b\u3002\n\n\u3068\u3044\u3046\u3082\u306e\u306b\u306a\u308a\u307e\u3059\u3002\u3059\u306a\u308f\u3061\u3001\u9001\u308b\u5074\u3068\u53d7\u3051\u308b\u5074\u306e\u4e21\u65b9\u304c\u79d8\u5bc6\u9375\u3092\u5916\u90e8\u306b\u6f0f\u3089\u3055\u306a\u3044\u9650\u308a\u306f\u6697\u53f7\u306e\u89e3\u8aad\u304c\u56f0\u96e3\u306b\u306a\u308a\u3001\u305d\u308c\u3067\u3044\u3066\u5171\u6709\u9375\u3092\u76f4\u63a5\u9001\u3089\u305a\u306b\u540c\u3058\u9375\u3092\u5171\u6709\u3067\u304d\u308b\u3001\u3068\u3044\u3046\u308f\u3051\u3067\u3059\u3002\u305d\u3053\u3067\u3001Web Push\u3067\u306f\u3001\n\nUA\u304c\u9375\u30da\u30a2\u3092\u751f\u6210\u3057\u305f\u3089\u3001\u305d\u306e\u516c\u958b\u9375\u3060\u3051\u3092\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u306b\u6e21\u3059\u3002\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u3082\u9375\u30da\u30a2\u3092\u751f\u6210\u3057\u3001\u305d\u306e\u79d8\u5bc6\u9375\u3068\u3001UA\u304b\u3089\u53d7\u3051\u53d6\u3063\u305f\u516c\u958b\u9375\u3067\u3001\u5171\u6709\u9375\u3092\u751f\u6210\u3057\u3001\u5f8c\u8ff0\u3059\u308bsalt\u3068\u4f75\u305b\u3066\u6697\u53f7\u5316\u306b\u4f7f\u3046\u3002\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u306f\u81ea\u8eab\u306e\u516c\u958b\u9375\u3068salt\u3001\u6697\u53f7\u6587\u3092\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u7d4c\u7531\u3067UA\u306b\u6e21\u3059\u3002\nUA\u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u306e\u516c\u958b\u9375\u3068\u81ea\u8eab\u306e\u79d8\u5bc6\u9375\u3067\u5171\u6709\u9375\u3092\u751f\u6210\u3057\u3001salt\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u3068\u540c\u3058\u624b\u9806\u3067\u6697\u53f7\u6587\u3092\u89e3\u8aad\u3057\u3066\u5e73\u6587\u306b\u623b\u3059\u3002\n\n\u3068\u3044\u3046\u624b\u9806\u3092\u53d6\u308a\u307e\u3059\u3002\u307e\u305f\u3001AES-GCM\u3067\u5b9f\u969b\u306b\u7528\u3044\u308b\u9375\u3068IV(Initialization Vector; \u6697\u53f7\u5316\u306b\u4f7f\u3046\u521d\u671f\u5316\u30d9\u30af\u30bf)\u306f\u3001\u9375\u5171\u6709\u304b\u3089\u751f\u6210\u3067\u304d\u308b\u5171\u6709\u9375\u3084\u3001salt\u3068\u547c\u3070\u308c\u308b\u4e71\u6570\u3001\u7b49\u304b\u3089\u3001HMAC\u7b49\u306e\u51e6\u7406\u3092\u65bd\u3057\u3066\u751f\u6210\u3059\u308b\u305f\u3081\u3001\u3088\u308a\u4e00\u5c64\u89e3\u8aad\u3092\u56f0\u96e3\u306b\u3067\u304d\u308b\u3088\u3046\u5de5\u592b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u306e\u5177\u4f53\u7684\u306a\u624b\u9806\n\u3067\u306f\u3001\u5b9f\u969b\u306eWeb\u30a2\u30d7\u30ea\u3068Web\u30b5\u30fc\u30d0\u306e\u4e21\u65b9\u306b\u304a\u3051\u308b\u5b9f\u88c5\u306e\u4ed5\u65b9\u3092\u5927\u307e\u304b\u306b\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\nWeb\u30a2\u30d7\u30ea\u5074\u3067endpoint\u3068\u516c\u958b\u9375\u3092\u53d6\u5f97\nWeb\u30a2\u30d7\u30ea\u5074\u306e\u5b9f\u88c5\u306b\u3064\u3044\u3066\u306f\u3001\u307e\u305a\u306fChrome\u3067W3C Push API\u3092\u4f7f\u3063\u3066\u307f\u305f\u3067\u793a\u3057\u3066\u3044\u308b\u3088\u3046\u306a\u624b\u9806\u3067\u3001pushManager.subscribe(options)\u3084pushManager.getSubscription()\u306b\u3088\u3063\u3066\u3001subscription\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u3001Web Push\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u30d6\u30e9\u30a6\u30b6\u306e\u5834\u5408\u306f\u3001subscription.endpoint\u3067\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u306eendpoint\u306b\u52a0\u3048\u3066\u3001subscription.getKey()\u306b\u3088\u3063\u3066\u5fc5\u8981\u306a\u9375\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u306bendpoint\u3068\u516c\u958b\u9375\u3092\u767b\u9332\u3059\u308b\u4f8b\nnavigator.serviceWorker.ready.then(function(registration) {\n  registration.pushManager.getSubscription().then(function(subscription){\n    fetch(appServerURL, {\n      credentials: 'include',\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json; charset=UTF-8' },\n      body: JSON.stringify({\n        endpoint: subscription.endpoint,\n        key: btoa(String.fromCharCode.apply(null, new Uint8Array(subscription.getKey('p256dh'))))\n               .replace(/\\+/g, '-').replace(/\\//g, '_'),\n        auth: btoa(String.fromCharCode.apply(null, new Uint8Array(subscription.getKey('auth'))))\n               .replace(/\\+/g, '-').replace(/\\//g, '_')\n    });\n  });\n});\n\n\nsubscription.getKey()\u306e\u5f15\u6570\u306b\u306f\u9375\u306e\u7a2e\u985e\u3092\u6307\u5b9a\u3057\u307e\u3059:\n\n\n'p256dh': \u9375\u5171\u6709\u30d7\u30ed\u30c8\u30b3\u30ebECDH\u3067\u5229\u7528\u3059\u308b\u30d6\u30e9\u30a6\u30b6\u306e\u516c\u958b\u9375\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u3001p256dh\u3068\u3044\u3046\u540d\u79f0\u306f\u3001\u6955\u5186\u66f2\u7dda\u306e\u7a2e\u985e\u3067\u3042\u308b\u3001P-256\u3042\u308b\u3044\u306fprime256v1\u3092\u6307\u3057\u307e\u3059\u3002\n\n'auth': \u4ed5\u69d8\u4fee\u6b63\u5f8c\u306b\u5c0e\u5165\u3055\u308c\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u3001\u9375\u751f\u6210\u3092\u3055\u3089\u306b\u8907\u96d1\u306b\u3059\u308b\u305f\u3081\u306e\u79d8\u5bc6\u306e\u4e71\u6570(\u4ed5\u69d8\u66f8\u3067\u306fAuthentication Secret)\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002ECDH\u306e\u9375\u5171\u6709\u3060\u3051\u3067\u306f\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u4e0a\u306e\u61f8\u5ff5\u304c\u6b8b\u308b\u305f\u3081\u4ed5\u69d8\u306b\u8ffd\u52a0\u3055\u308c\u305f\u3082\u306e\u306e\u3088\u3046\u3067\u3059\u3002\u4ee5\u4e0b\u3001auth\u3068\u547c\u3073\u307e\u3059\u3002\n\ngetKey()\u306e\u623b\u308a\u5024\u306fArrayBuffer\u578b\u3067\u3059\u306e\u3067\u3001\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001Uint8Array\u578b\u306b\u5909\u63db\u3057\u3066Base64 URL\u30a8\u30f3\u30b3\u30fc\u30c9\u306b\u3088\u3063\u3066\u6587\u5b57\u5217\u306b\u5909\u63db\u3057\u3066\u304b\u3089\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u306b\u9001\u4fe1\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u5074\u3067\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u3092\u9001\u4fe1\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u5074\u3067\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u306eendpoint\u3068\u30d6\u30e9\u30a6\u30b6\u306e\u516c\u958b\u9375\u3092\u53d6\u5f97\u3067\u304d\u308c\u3070\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u304b\u3089\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u306eendpoint\u306bHTTP POST\u3067\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u306e\u5185\u5bb9\u3092\u9001\u4fe1\u3059\u308b\u3053\u3068\u3067\u3001\u30d6\u30e9\u30a6\u30b6\u5074\u306b\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u304c\u6e21\u3055\u308c\u3001\u30d6\u30e9\u30a6\u30b6\u5074\u3067\u6697\u53f7\u5316\u3055\u308c\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u89e3\u8aad\u3057\u3066Service Worker\u5074\u3067\u51e6\u7406\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u7d50\u69cb\u3084\u3084\u3053\u3057\u3044\u51e6\u7406\u306b\u306a\u308a\u307e\u3059\u306e\u3067\u3001\u8aac\u660e\u3059\u308b\u3088\u308a\u306f\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3092\u793a\u3057\u305f\u307b\u3046\u304c\u826f\u3044\u306e\u3067\u306f\u3068\u601d\u3044\u307e\u3059\u3002\n\nNode.js\u306e\u5834\u5408\nWeb Push Encryption\u306b\u5bfe\u5fdc\u3057\u305fNode.js\u7528\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u304cGitHub\u3067\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u3053\u3061\u3089\u3092\u8a66\u3057\u306b\u4f7f\u3063\u305f\u308a\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u306e\u5b9f\u88c5\u306e\u53c2\u8003\u306b\u3057\u305f\u308a\u3059\u308b\u3068\u3088\u3044\u3067\u3057\u3087\u3046\u3002\u95a2\u9023\u3059\u308b\u30ea\u30f3\u30af\u3092\u6b21\u306b\u793a\u3057\u307e\u3059\u3002\n\nhttps://github.com/googlechrome/push-encryption-node\nhttps://github.com/marco-c/web-push\nhttps://github.com/martinthomson/encrypted-content-encoding\n\n\u4e0b\u306e2\u3064\u306b\u3064\u3044\u3066\u306f\u3001npm\u3067\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u53ef\u80fd\u3067\u3059\u3002\nnpm install web-push\nnpm install encrypted-content-encoding\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u5074\u306e\u5b9f\u88c5\u3067\u53c2\u8003\u306b\u306a\u308b\u7b87\u6240\u306f\u3001\n\nhttps://github.com/GoogleChrome/push-encryption-node/blob/master/src/encrypt.js\nhttps://github.com/marco-c/web-push/blob/master/index.js\nhttps://github.com/martinthomson/encrypted-content-encoding/blob/master/nodejs/ece.js\n\n\u8fba\u308a\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u30b3\u30fc\u30c9\u3067\u9375\u30da\u30a2\u306e\u751f\u6210\u3084\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u6697\u53f7\u5316\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\nJava\u306e\u5834\u5408(Tomcat, Jetty\u7b49)\n\u4e0a\u8a18\u306eNode.js\u306e\u30b3\u30fc\u30c9\u3092\u53c2\u8003\u306b\u3057\u3066\u3001\u3053\u3061\u3089\u3067Java\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002\u30b5\u30f3\u30d7\u30eb\u30da\u30fc\u30b8\u3082\u7528\u610f\u3057\u3066\u304a\u308a\u307e\u3059\u306e\u3067\u3001Chrome\u3042\u308b\u3044\u306fFirefox\u3067\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002\n\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9: https://github.com/tomoyukilabs/WebPushTest\n\n\u30b5\u30f3\u30d7\u30eb\u30da\u30fc\u30b8: https://labs.othersight.jp/webpushtest\n\n\nJava\u3067\u306e\u5b9f\u88c5\u3092\u8a66\u3057\u3066\u307f\u3066\u6ce8\u610f\u304c\u5fc5\u8981\u3060\u3063\u305f\u70b9\u306f\u6b21\u306e\u901a\u308a\u3067\u3059\u3002\n\nOracle Java 8\u3060\u3051\u3067\u306f\u6955\u5186\u66f2\u7dda\u306e\u6307\u5b9a\u304c\u3067\u304d\u306a\u3044\u3088\u3046\u306a\u306e\u3067\u3001Bouncy Castle\u306e\u6697\u53f7\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u5229\u7528\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u6642\u3001Security.addProvider(new BouncyCastleProvider());\u3067\u30d7\u30ed\u30d0\u30a4\u30c0\u3092\u8ffd\u52a0\u3057\u3001\u305d\u306e\u5f8c\u306e\u5404\u30e1\u30bd\u30c3\u30c9\u3067BC\u3092\u6697\u53f7\u30d7\u30ed\u30d0\u30a4\u30c0\u3068\u3057\u3066\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u4e0a\u8a18\u306eNode.js\u3067\u3082\u540c\u3058\u3067\u3059\u304c\u3001\u6955\u5186\u66f2\u7dda\u306e\u540d\u524d\u3068\u3057\u3066\u306fprime256v1\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u306e\u516c\u958b\u9375localPublicKey\u3092\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u306b\u4ed8\u4e0e\u3059\u308b\u969b\u306b\u306f\u3001localPublicKey.getEncoded()\u3067\u306f\u306a\u304f\u3001localPublicKey.getQ().getEncoded(false)\u3092\u9001\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\u30d6\u30e9\u30a6\u30b6\u306e\u516c\u958b\u9375\u304c65\u30d0\u30a4\u30c8\u306a\u306e\u3067\u3001\u540c\u305865\u30d0\u30a4\u30c8\u306e\u30c7\u30fc\u30bf\u306b\u306a\u3063\u3066\u3044\u308c\u3070\u6b63\u3057\u3044\u516c\u958b\u9375\u3068\u8003\u3048\u3089\u308c\u307e\u3059\u3002\n\n\n\u5177\u4f53\u7684\u306b\u306f\u4f55\u306e\u8a08\u7b97\u3092\u3057\u3066\u3044\u308b\u306e\u304b\n\u3056\u3063\u3068\u3067\u3059\u304c\u3001\u5b9f\u969b\u306e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u66f8\u304d\u4e0b\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u3001||\u306f\u3001\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u306e\u9023\u7d50\u3092\u8868\u3057\u307e\u3059\u3002\n\u4e0a\u8a18\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u6d3b\u7528\u3059\u308b\u5834\u5408\u306f\u4e0b\u8a18\u306e\u8a73\u7d30\u306a\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306f\u53c2\u7167\u4e0d\u8981\u3067\u3059\u304c\u3001\u3054\u81ea\u8eab\u3067\u6697\u53f7\u5316\u7b49\u3092\u5b9f\u88c5\u3059\u308b\u5834\u5408\u7b49\u306b\u53c2\u8003\u306b\u306a\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\nHMAC-based Key Derivation Function (HKDF) [RFC 5869]\nWeb Push Encryption\u3067\u306fHKDF\u306b\u3088\u3063\u3066\u9375\u3084Nonce\u3068\u547c\u3070\u308c\u308b\u6697\u53f7\u5316\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u751f\u6210\u3057\u307e\u3059\u306e\u3067\u3001HKDF\u306e\u624b\u9806\u3092\u7c21\u5358\u306b\u8aac\u660e\u3057\u307e\u3059\u3002\u5177\u4f53\u7684\u306b\u306fextract\u3068expand\u306e2\u3064\u306e\u95a2\u6570\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\u3002\n\n\nHKDF_extract(salt, IKM): \u4e71\u6570salt\u3092\u9375(salt)\u3068\u3057\u3066\u3001HMAC SHA-256\u306b\u3088\u3063\u3066\u30e1\u30c3\u30bb\u30fc\u30b8IKM(Input Keying Material)\u3092\u30cf\u30c3\u30b7\u30e5\u3059\u308b\u3002\u305d\u306e\u7d50\u679c\u306fPRK (Pseudo-Random Key)\u3068\u547c\u3073\u300132\u30d0\u30a4\u30c8\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3068\u306a\u308b\u3002\n\nHKDF_expand(PRK, info, L): info\u306f\u4f55\u3089\u304b\u306e\u6587\u5b57\u5217\u3068\u3057\u3001PRK\u3092\u9375(salt)\u3068\u3057\u3066\u3001info || 0x01\u3092HMAC SHA-256\u306b\u3088\u3063\u3066\u30cf\u30c3\u30b7\u30e5\u3057\u3001\u305d\u306e\u3046\u3061\u5148\u982d\u306eL\u30d0\u30a4\u30c8\u3092\u53d6\u308a\u51fa\u3059(L\u304c32\u30d0\u30a4\u30c8\u4ee5\u5185\u306e\u5834\u5408)\u3002\n\n\nWeb Push Encryption\nWeb Push Encryption\u306e\u624b\u9806\u306f\u6b21\u306e\u901a\u308a\u3067\u3059\u3002\u306a\u304a\u3001auth\u304c\u306a\u3044\u5834\u5408\u306b\u304a\u3044\u3066\u4e0b\u8a18\u624b\u98069.\u306econtext\u3092\u7a7a\u30c7\u30fc\u30bf\u3068\u3059\u308b\u3068\u3001Firefox 44/45\u304c\u5bfe\u5fdc\u3059\u308b\u4ed5\u69d8\u3068\u540c\u3058\u306b\u306a\u308a\u307e\u3059\u3002\n(\u6ce8: auth\u4ed8\u304d\u6697\u53f7\u5316\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u30d6\u30e9\u30a6\u30b6\u306e\u3046\u3061\u3001Chrome 49\u306b\u9650\u308adraft-ietf-httpbis-encryption-encoding-00\u306b\u6e96\u62e0\u3057\u3066\u3044\u308b\u305f\u3081\u8981\u6ce8\u610f\u3067\u3059\u304c\u3001\u305d\u3082\u305d\u3082Chrome 49\u3067Web Push\u6697\u53f7\u5316\u306b\u5bfe\u5fdc\u3059\u308b\u306b\u306f\u30d5\u30e9\u30b0\u3092\u6709\u52b9\u5316\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u5b9f\u7528\u4e0a\u306f\u3042\u307e\u308a\u610f\u8b58\u3057\u306a\u304f\u3066\u3082\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002)\n\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u516c\u958b\u9375\u3068auth\u3092\u53d6\u5f97\u3059\u308b\u3002\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u7528\u306e\u9375\u30da\u30a2\u3092\u751f\u6210\u3059\u308b\u3002\n\u30d6\u30e9\u30a6\u30b6\u306e\u516c\u958b\u9375\u3068\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u306e\u79d8\u5bc6\u9375\u304b\u3089\u5171\u6709\u9375\u3092\u751f\u6210\u3057\u3001\u305d\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092IKM\u3068\u3059\u308b\u3002\n16\u30d0\u30a4\u30c8(128\u30d3\u30c3\u30c8)\u306e\u4e71\u6570\u3092\u751f\u6210\u3057\u3001\u3053\u308c\u3092salt\u3068\u3059\u308b\u3002\nauth\u304c\u7121\u3044\u5834\u5408\u306f\u3001PRK = HKDF_extract(salt, IKM)\u3092\u8a08\u7b97\u3057\u30019.\u306b\u9032\u3080\u3002\n\n_PRK = HKDF_extract(auth, IKM)\u3092\u8a08\u7b97\u3059\u308b\u3002\n\n_IKM = HKDF_expand(_PRK, \"Content-Encoding: auth\" || 0x00, 32)\u3092\u8a08\u7b97\u3059\u308b\u3002\n\nPRK = HKDF_extract(salt, _IKM)\u3092\u8a08\u7b97\u3059\u308b\u3002\n\ncontext = 0x00 || \"P-256\" || 0x00 || (\u30d6\u30e9\u30a6\u30b6\u516c\u958b\u9375\u306e\u30d0\u30a4\u30c8\u9577\u306e16\u30d3\u30c3\u30c8\u8868\u73fe(=0x0041)) || (\u30d6\u30e9\u30a6\u30b6\u516c\u958b\u9375\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf) || (\u30b5\u30fc\u30d0\u516c\u958b\u9375\u306e\u30d0\u30a4\u30c8\u9577\u306e16\u30d3\u30c3\u30c8\u8868\u73fe(=0x0041)) || (\u30b5\u30fc\u30d0\u516c\u958b\u9375\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf)\u3092\u53d6\u5f97\u3059\u308b\u3002 \n\nHKDF_expand(PRK, \"Content-Encoding: aesgcm\" || context, 16)\u3092\u8a08\u7b97\u3057\u3001\u5f97\u3089\u308c\u308b128\u30d3\u30c3\u30c8\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092AES-GCM\u3067\u306e\u6697\u53f7\u9375\u3068\u3059\u308b\u3002\n\n\nChrome 49\u306b\u5bfe\u3057\u3066\u306f\u3001HKDF_expand(PRK, \"Content-Encoding: aesgcm128\" || context, 16)\u3068\u3059\u308b\u3002\n\n\n\nHKDF_expand(PRK, \"Content-Encoding: nonce\" || context, 12)\u3092\u8a08\u7b97\u3057\u3001\u5f97\u3089\u308c\u308b96\u30d3\u30c3\u30c8\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092AES-GCM\u3067\u306enonce\u3068\u3059\u308b\u3002\n10.\u306e\u6697\u53f7\u9375\u306811.\u306enonce\u3092\u4f7f\u3063\u3066128\u30d3\u30c3\u30c8AES-GCM\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u6697\u53f7\u5316\u3059\u308b\u3002\n\n\n4078\u30d0\u30a4\u30c8\u5358\u4f4d(Chrome 50+)\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u533a\u5207\u3063\u3066\u6697\u53f7\u5316\u3059\u308b\u3002(Chrome 49\u306e\u5834\u5408\u306f4079\u30d0\u30a4\u30c8\u5358\u4f4d\u3002)\n\u533a\u5207\u3089\u308c\u305f\u30d6\u30ed\u30c3\u30af\u306e\u5148\u982d\u306b\u306f0x0000\u306e2\u30d0\u30a4\u30c8(Chrome 49\u306e\u5834\u5408\u306f0x00\u306e1\u30d0\u30a4\u30c8)\u3092\u4ed8\u3051\u3066\u3001\u5b9f\u969b\u306b\u306f4080\u30d0\u30a4\u30c8\u5358\u4f4d\u3067\u6697\u53f7\u5316\u3059\u308b\u3002\u6697\u53f7\u5316\u3055\u308c\u305f\u30da\u30a4\u30ed\u30fc\u30c9\u306f16\u30d0\u30a4\u30c8\u306e\u30d8\u30c3\u30c0\u8fbc\u307f\u30674096\u30d0\u30a4\u30c8\u5358\u4f4d\u3068\u306a\u308b\u3002\n\u6697\u53f7\u9375\u306f11.\u3067\u751f\u6210\u3057\u305f\u3082\u306e\u3092\u5229\u7528\u3059\u308b\u3002\n\u5148\u982d\u30d6\u30ed\u30c3\u30af\u30920\u3068\u3057\u3066\u30ab\u30a6\u30f3\u30bf\u306e\u5024\u3092\u30d6\u30ed\u30c3\u30af\u5358\u4f4d\u30671\u305a\u3064\u5897\u52a0\u3055\u305b\u308b\u3002\nAES\u6697\u53f7\u5316\u3067\u4f7f\u3046IV\u306e\u5024\u306f\u300112.\u306enonce\u306e\u4e0b\u4f4d6\u30d0\u30a4\u30c8\u306b\u3064\u3044\u3066\u30ab\u30a6\u30f3\u30bf\u306e\u5024\u3068\u306eXOR\u3092\u53d6\u3063\u3066\u7f6e\u304d\u63db\u3048\u305f\u3082\u306e\u3068\u3059\u308b(\u4e0a\u4f4d6\u30d0\u30a4\u30c8\u306f\u305d\u306e\u307e\u307e)\u3002\n\n\nendpoint\u3067\u793a\u3055\u308c\u308b\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u306eURL\u306bHTTP POST\u3067\u6697\u53f7\u5316\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\u3002\u3053\u306e\u3068\u304d\u3001HTTP\u30ea\u30af\u30a8\u30b9\u30c8\u30d8\u30c3\u30c0\u306b\u6b21\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n\n\nCrypto-Key:(Firefox 44/45\u306e\u5834\u5408\u306fEncryption-Key:)\u306bkeyid=p256dh;dh=(Base64 URL\u30a8\u30f3\u30b3\u30fc\u30c9\u3057\u305f10.\u306e\u5171\u6709\u9375)\u3092\u6307\u5b9a\n\nEncryption:\u306bkeyid=p256dh;salt=(Base64 URL\u30a8\u30f3\u30b3\u30fc\u30c9\u3057\u305f4.\u306esalt)\u3092\u6307\u5b9a\n\nContent-Encoding: \u306baesgcm(Chrome 49\u53ca\u3073Firefox 44/45\u306e\u5834\u5408\u306faesgcm128)\u3092\u6307\u5b9a\n\nAuthorization:\u306bkey=(GCM\u306eserver key)\u3092\u6307\u5b9a(Chrome\u306e\u307f; \u8a73\u7d30\u306fChrome\u3067W3C Push API\u3092\u4f7f\u3063\u3066\u307f\u305f\u3092\u53c2\u7167)\n\nTTL:\u306b\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u306e\u53d7\u4fe1\u6709\u52b9\u671f\u9650\u3092\u79d2\u5358\u4f4d\u3067\u6307\u5b9a\n\n\n\n\u306a\u304a\u3001Chrome 51\u4ee5\u524d\u306e\u30d6\u30e9\u30a6\u30b6\u306b\u5bfe\u3057\u3066Web Push\u3067\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u3092\u9001\u4fe1\u3059\u308b\u5834\u5408\u306f\u3001endpoint\u3068\u3057\u3066Push API\u304b\u3089\u53d6\u5f97\u3067\u304d\u308bGCM\u30b5\u30fc\u30d0\u306eURL\u3092\u6b21\u306e\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002(\u53c2\u8003)\nhttps://android.googleapis.com/gcm/send/[registration_id]\n\u3000\u3000\u3000\u3000\u2193\nhttps://gcm-http.googleapis.com/gcm/[registration_id]\n\n\u306a\u304a\u3001Chrome 52\u4ee5\u964d\u3067\u3001GCM\u306eserver key\u3092manifest\u306b\u8a18\u8ff0\u3059\u308b\u65b9\u6cd5\u3067\u306f\u306a\u304f\u3001VAPID\u3067\u30b5\u30fc\u30d0\u8a8d\u8a3c\u3092\u884c\u3063\u3066\u3044\u308b\u5834\u5408\u306f\u3001endpoint\u306eURL\u306fFirebase Cloud Messaging (FCM)\u306e\u3082\u306e\u3068\u306a\u308a\u307e\u3059(\u4e0a\u8a18\u306e\u3088\u3046\u306a\u66f8\u304d\u63db\u3048\u304c\u4e0d\u8981\u306b\u306a\u308a\u307e\u3059)\u3002\n\nService Worker\u3067\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u3092\u53d7\u4fe1\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u5074\u3067\u6b63\u3057\u304f\u30d6\u30e9\u30a6\u30b6\u3068\u306e\u9375\u5171\u6709\u3068\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u6697\u53f7\u5316\u304c\u3067\u304d\u3066\u3044\u308c\u3070\u3001\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u7d4c\u7531\u3067\u30d6\u30e9\u30a6\u30b6\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u3057\u3001\u30d6\u30e9\u30a6\u30b6\u5074\u3067\u6697\u53f7\u3092\u89e3\u8aad\u3057\u3066\u901a\u77e5\u3092\u8868\u793a\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u304b\u3089\u9001\u4fe1\u3057\u305f\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u4f8b(\u5e73\u6587)\n{\n  \"title\": \"Push Message\",\n  \"body\": \"\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u4ed8\u3051\u3066\u9001\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3057\u305f\u3088\",\n  \"tag\": \"pushMessage201512080001\"\n}\n\n\n\nServiceWorker\u3067\u306e\u53d7\u4fe1\u4f8b\nself.addEventListener('push', function(evt) {\n  if(evt.data) {\n    var data = evt.data.json();\n    evt.waitUntil(\n      self.registration.showNotification(\n        data.title,\n        {\n          icon: '(\u30a2\u30a4\u30b3\u30f3\u306eURL(\u30d1\u30b9\u306e\u307f\u3067OK))',\n          body: data.body,\n          tag: data.tag\n        }\n      )\n    );\n  }\n}, false);\n\n\npush\u30a4\u30d9\u30f3\u30c8\u306e\u30ea\u30b9\u30ca\u95a2\u6570\u3067\u306f\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u53d7\u4fe1\u6642\u306bPushEvent\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u53d7\u3051\u53d6\u308a\u307e\u3059\u304c\u3001Web Push\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u5834\u5408\u306fevt.data\u306b\u30e1\u30c3\u30bb\u30fc\u30b8(\u30da\u30a4\u30ed\u30fc\u30c9)\u306e\u5185\u5bb9\u304c\u683c\u7d0d\u3055\u308c\u307e\u3059\u3002\u30da\u30a4\u30ed\u30fc\u30c9\u304c\u7a7a\u3067\u3042\u308c\u3070\u3001evt.data\u304cnull\u3068\u306a\u308a\u307e\u3059\u3002\n\u4e0a\u8a18\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3067\u306f\u3001Fetch API\u306b\u4f3c\u305f\u611f\u3058\u3067\u3001evt.data.text()\u3067\u6587\u5b57\u5217\u3001evt.data.json()\u3067JSON\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3001evt.data.arrayBuffer()\u3067ArrayBuffer\u3001evt.data.blob()\u3067Blob\u3068\u3057\u3066\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u3051\u53d6\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002(Fetch API\u3068\u9055\u3044\u3001Promise\u3067\u306f\u306a\u304f\u30e1\u30bd\u30c3\u30c9\u306e\u623b\u308a\u5024\u3068\u3057\u3066\u76f4\u63a5\u53d7\u3051\u53d6\u308a\u307e\u3059\u3002)\n\n\u305d\u306e\u4ed6\n\nFirefox\u306b\u3064\u3044\u3066\u3001\u3053\u3061\u3089\u306e\u74b0\u5883(OS X El Capitan)\u3067\u8a66\u3057\u3066\u307f\u305f\u9650\u308a\u3067\u306f\u3001\u30a6\u30a3\u30f3\u30c9\u30a6\u304c\u5168\u3066\u9589\u3058\u3089\u308c\u3066\u3044\u308b\u3068\u3001\u901a\u77e5\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3082\u30a6\u30a3\u30f3\u30c9\u30a6\u304c\u958b\u304b\u305a\u3001\u4e2d\u8eab\u304c\u306a\u304f\u3066\u3082\u826f\u3044\u306e\u3067\u4f55\u304b\u30a6\u30a3\u30f3\u30c9\u30a6\u3092\u958b\u3044\u3066\u3044\u308c\u3070\u3001\u901a\u77e5\u30af\u30ea\u30c3\u30af\u3067\u305d\u306eWeb\u30a2\u30d7\u30ea\u3092\u958b\u304f\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3001\u3068\u3044\u3063\u305f\u6319\u52d5\u3067\u3057\u305f\u3002\u4eca\u5f8c\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3067\u6539\u5584\u3055\u308c\u308b\u3053\u3068\u3092\u9858\u3044\u307e\u3059\u3002\n\n\u203b 2016/11/1: *IETF\u3088\u308a\u65b0\u3057\u3044\u4ed5\u69d8\u30c9\u30e9\u30d5\u30c8[draft-ietf-webpush-encryption-06](https://tools.ietf.org/html/draft-ietf-webpush-encryption-06)\u304c\u516c\u958b\u3055\u308c\u307e\u3057\u305f\u3002* **WebPush\u306e\u6697\u53f7\u5316\u624b\u9806\u306b\u5909\u66f4\u304c\u52a0\u3048\u3089\u308c\u305f\u6a21\u69d8\u3067\u3059\u306e\u3067\u3001\u30d6\u30e9\u30a6\u30b6\u53ca\u3073\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u306e\u5bfe\u5fdc\u72b6\u6cc1\u304c\u78ba\u8a8d\u51fa\u6765\u6b21\u7b2c\u3001\u8ffd\u3063\u3066\u672c\u8a18\u4e8b\u3082\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u307e\u3059\u3002**\n\n\u203b 2016/5/27: *[Web Push\u6697\u53f7\u5316\u306b\u30b5\u30fc\u30d0\u8a8d\u8a3c\u3092\u7d44\u307f\u5408\u308f\u305b\u308bVAPID\u306e\u4f7f\u3044\u65b9\u3092\u5225\u8a18\u4e8b\u306b\u307e\u3068\u3081\u307e\u3057\u305f](http://qiita.com/tomoyukilabs/items/9346eb44b5a48b294762)\u3002Chrome 52\u4ee5\u964d\u3067\u306f\u3001FCM/GCM\u5c02\u7528\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u304f\u3053\u3068\u306a\u304fWeb Push\u304c\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002*\n\u203b 2016/2/26: *[Web Push\u306e\u30b5\u30f3\u30d7\u30eb\u30da\u30fc\u30b8](https://labs.othersight.jp/webpushtest/)\u3092\u7528\u610f\u3057\u307e\u3057\u305f\u3002\u53c2\u8003\u307e\u3067\u306b\u30b3\u30fc\u30c9\u3092[GitHub](https://github.com/tomoyukilabs/WebPushTest)\u306b\u7f6e\u304d\u307e\u3057\u305f\u3002*\n\n\u5148\u306b\u300c[Chrome\u3067W3C Push API\u3092\u4f7f\u3063\u3066\u307f\u305f](http://qiita.com/tomoyukilabs/items/8fffb4280c1914b6aa3d)\u300d\u3084\u300c[Firefox (Developer Edition)\u3067W3C Push API\u3092\u4f7f\u3063\u3066\u307f\u308b](http://qiita.com/tomoyukilabs/items/c7268aa29447a1d0a3fb)\u300d\u3067\u66f8\u304d\u307e\u3057\u305f\u3088\u3046\u306b\u3001\u30d6\u30e9\u30a6\u30b6\u3067\u306e\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u306e\u5bfe\u5fdc\u304c\u5f90\u3005\u306b\u5f62\u306b\u306a\u3063\u3066\u304d\u3066\u3044\u307e\u3059\u3002\n\nChrome\u3084Firefox\u3067\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u3092\u901a\u77e5\u3060\u3051\u3067\u306f\u306a\u304f\u30c7\u30fc\u30bf(\u30da\u30a4\u30ed\u30fc\u30c9)\u4ed8\u304d\u3067\u9001\u308c\u308b\u3088\u3046\u306b\u3059\u308b\u306b\u306f\u3001\u30da\u30a4\u30ed\u30fc\u30c9\u306e\u6697\u53f7\u5316(Web Push Encryption)\u304c\u5fc5\u8981\u3068\u306a\u308a\u307e\u3059\u304c\u3001**Chrome 50\u4ee5\u964d\u3001Firefox for Desktop 46\u4ee5\u964d\u3001Firefox for Android 48\u4ee5\u964d**\u3067\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u672c\u8a18\u4e8b\u3067\u306f\u305d\u306e\u65b9\u6cd5\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002(\u3061\u306a\u307f\u306b\u3001[Microsoft Edge\u3067\u3082Push API\u306e\u5b9f\u88c5\u304c\u9032\u3093\u3067\u3044\u308b\u3088\u3046\u3067\u3059](https://developer.microsoft.com/en-us/microsoft-edge/platform/status/pushapi/)\u3002)\n\n\u4eca\u56de\u306f\u6697\u53f7\u5316\u304c\u7d61\u307f\u307e\u3059\u306e\u3067\u3001\u3061\u3087\u3063\u3068\u96e3\u3057\u3044\u5185\u5bb9\u306b\u306a\u308a\u307e\u3059\u304c\u3001\u3054\u4e86\u627f\u4e0b\u3055\u3044\u3002\n\n# Web Push\n\nChrome\u3067\u306f\u5f53\u521d\u30d0\u30fc\u30b8\u30e7\u30f342\u3067Google Cloud Messaging (GCM)\u3092\u5229\u7528\u3057\u305f\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u307e\u3057\u305f\u304c\u3001\u73fe\u5728\u306fIETF\u3067\u30d6\u30e9\u30a6\u30b6\u9593\u3067\u5171\u901a\u306e\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u30d7\u30ed\u30c8\u30b3\u30eb\u3068\u3057\u3066[WebPush\u30d7\u30ed\u30c8\u30b3\u30eb(RFC 8030)](https://tools.ietf.org/html/rfc8030)\u304c\u6a19\u6e96\u5316\u3055\u308c\u3066\u304a\u308a\u3001Chrome\u3068Firefox\u306e\u4e21\u65b9\u304cWebPush\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002WebPush\u306fHTTP/2\u306e\u65b0\u6a5f\u80fd\u3067\u3042\u308b\u30b5\u30fc\u30d0\u30d7\u30c3\u30b7\u30e5\u7b49\u3092\u6d3b\u7528\u3057\u305f\u3053\u3068\u304c\u7279\u5fb4\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u308c\u306f\u4e3b\u306b\u30d6\u30e9\u30a6\u30b6\u3068\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u30b5\u30fc\u30d3\u30b9\u5074\u306e\u4ed5\u7d44\u307f\u3067\u3042\u308a\u3001\u958b\u767a\u8005\u306f\u7279\u306b\u305d\u308c\u3092\u610f\u8b58\u305b\u305a\u3001\u5f93\u6765\u306eHTTP\u306e\u30ce\u30a6\u30cf\u30a6\u304c\u3042\u308c\u3070\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u5168\u4f53\u306e\u69cb\u6210\u8981\u7d20\u3068\u3057\u3066\u306f\u3001\n\n* \u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\n* \u30d6\u30e9\u30a6\u30b6(UA: User Agent)\n* \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\n\n\u304c\u3042\u308a\u307e\u3059\u3002\u30d6\u30e9\u30a6\u30b6\u306f\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u306e\u8cfc\u8aad\u3092\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u306b\u8981\u6c42\u3059\u308b\u3068\u3001\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u304b\u3089UA\u306b\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u304b\u3089UA\u306b\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u3092\u9001\u308b\u969b\u306e\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u5074\u306eURL\u304c\u9001\u3089\u308c\u307e\u3059\u3002W3C Push API\u3067\u306f\u3053\u306eURL\u3092**endpoint**\u3068\u547c\u3093\u3067\u3044\u307e\u3059\u3002\n\n\u3061\u306a\u307f\u306b\u3001\u73fe\u6642\u70b9(2016/3/1)\u3067\u306fFirefox\u306f\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u306e\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u30b5\u30fc\u30d0[autopush](http://autopush.readthedocs.org/)\u3092\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u3068\u3057\u3066\u5229\u7528\u3057\u3066\u304a\u308a\u3001HTTP/2\u3067\u306f\u306a\u304fWebSocket\u3067autopush\u30b5\u30fc\u30d0\u3068\u63a5\u7d9a\u3057\u3066\u3044\u307e\u3059\u3002(Firefox for Android\u3067\u3082\u540c\u69d8\u306e\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u81ea\u4f53\u306f\u73fe\u6642\u70b9\u3067\u306fGCM\u3092\u9593\u63a5\u7684\u306b\u5229\u7528\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002)\n\n## \u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u6697\u53f7\u5316\n\nWeb Push\u3067\u306f\u3001\u3055\u3089\u306b\u3001\u4e2d\u9593\u8005\u653b\u6483\u306a\u3069\u306e\u30ea\u30b9\u30af\u3092\u8efd\u6e1b\u3057\u3066\u30d7\u30e9\u30a4\u30d0\u30b7\u30fc\u3092\u9ad8\u3081\u308b\u305f\u3081\u306b\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u3068UA\u306e2\u8005\u3060\u3051\u304c\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u89e3\u8aad\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u306b\u3001\u9375\u5171\u6709\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u7528\u3044\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u6697\u53f7\u5316\u3092\u7528\u3044\u307e\u3059[[draft-ietf-webpush-encryption-02](https://tools.ietf.org/html/draft-ietf-webpush-encryption-02)]\u3002\u3053\u3053\u3067\u3001\u9375\u5171\u6709\u306b\u306f**ECDH (Elliptic Curve Diffie-Hellman)**\u3001\u6697\u53f7\u5316\u306f**128\u30d3\u30c3\u30c8AES-GCM (Galois/Counter Mode)**\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u307e\u305a\u3001\u9375\u5171\u6709\u306e\u4ed5\u7d44\u307f\u306b\u3064\u3044\u3066\u7c21\u5358\u306b\u8aac\u660e\u3057\u307e\u3059\u3068\u3001\n\n* \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u308b\u5074\u3082\u53d7\u3051\u308b\u5074\u3082\u3001\u307e\u305a\u516c\u958b\u9375\u3068\u79d8\u5bc6\u9375\u306e\u9375\u30da\u30a2\u3092\u4f5c\u6210\u3059\u308b\u3002\n* \u300c\u9001\u308b\u5074\u306e\u516c\u958b\u9375\u3068\u53d7\u3051\u308b\u5074\u306e\u79d8\u5bc6\u9375\u300d\u300c\u53d7\u3051\u308b\u5074\u306e\u516c\u958b\u9375\u3068\u9001\u308b\u5074\u306e\u79d8\u5bc6\u9375\u300d\u306e\u3069\u3061\u3089\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u3082\u540c\u3058\u5171\u6709\u9375\u3092\u751f\u6210\u3067\u304d\u308b\u3002\n\n\u3068\u3044\u3046\u3082\u306e\u306b\u306a\u308a\u307e\u3059\u3002\u3059\u306a\u308f\u3061\u3001\u9001\u308b\u5074\u3068\u53d7\u3051\u308b\u5074\u306e\u4e21\u65b9\u304c\u79d8\u5bc6\u9375\u3092\u5916\u90e8\u306b\u6f0f\u3089\u3055\u306a\u3044\u9650\u308a\u306f\u6697\u53f7\u306e\u89e3\u8aad\u304c\u56f0\u96e3\u306b\u306a\u308a\u3001\u305d\u308c\u3067\u3044\u3066\u5171\u6709\u9375\u3092\u76f4\u63a5\u9001\u3089\u305a\u306b\u540c\u3058\u9375\u3092\u5171\u6709\u3067\u304d\u308b\u3001\u3068\u3044\u3046\u308f\u3051\u3067\u3059\u3002\u305d\u3053\u3067\u3001Web Push\u3067\u306f\u3001\n\n* UA\u304c\u9375\u30da\u30a2\u3092\u751f\u6210\u3057\u305f\u3089\u3001\u305d\u306e\u516c\u958b\u9375\u3060\u3051\u3092\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u306b\u6e21\u3059\u3002\n* \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u3082\u9375\u30da\u30a2\u3092\u751f\u6210\u3057\u3001\u305d\u306e\u79d8\u5bc6\u9375\u3068\u3001UA\u304b\u3089\u53d7\u3051\u53d6\u3063\u305f\u516c\u958b\u9375\u3067\u3001\u5171\u6709\u9375\u3092\u751f\u6210\u3057\u3001\u5f8c\u8ff0\u3059\u308bsalt\u3068\u4f75\u305b\u3066\u6697\u53f7\u5316\u306b\u4f7f\u3046\u3002\n* \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u306f\u81ea\u8eab\u306e\u516c\u958b\u9375\u3068salt\u3001\u6697\u53f7\u6587\u3092\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u7d4c\u7531\u3067UA\u306b\u6e21\u3059\u3002\n* UA\u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u306e\u516c\u958b\u9375\u3068\u81ea\u8eab\u306e\u79d8\u5bc6\u9375\u3067\u5171\u6709\u9375\u3092\u751f\u6210\u3057\u3001salt\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u3068\u540c\u3058\u624b\u9806\u3067\u6697\u53f7\u6587\u3092\u89e3\u8aad\u3057\u3066\u5e73\u6587\u306b\u623b\u3059\u3002\n\n\u3068\u3044\u3046\u624b\u9806\u3092\u53d6\u308a\u307e\u3059\u3002\u307e\u305f\u3001AES-GCM\u3067\u5b9f\u969b\u306b\u7528\u3044\u308b\u9375\u3068IV(Initialization Vector; \u6697\u53f7\u5316\u306b\u4f7f\u3046\u521d\u671f\u5316\u30d9\u30af\u30bf)\u306f\u3001\u9375\u5171\u6709\u304b\u3089\u751f\u6210\u3067\u304d\u308b\u5171\u6709\u9375\u3084\u3001salt\u3068\u547c\u3070\u308c\u308b\u4e71\u6570\u3001\u7b49\u304b\u3089\u3001HMAC\u7b49\u306e\u51e6\u7406\u3092\u65bd\u3057\u3066\u751f\u6210\u3059\u308b\u305f\u3081\u3001\u3088\u308a\u4e00\u5c64\u89e3\u8aad\u3092\u56f0\u96e3\u306b\u3067\u304d\u308b\u3088\u3046\u5de5\u592b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n# \u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u306e\u5177\u4f53\u7684\u306a\u624b\u9806\n\n\u3067\u306f\u3001\u5b9f\u969b\u306eWeb\u30a2\u30d7\u30ea\u3068Web\u30b5\u30fc\u30d0\u306e\u4e21\u65b9\u306b\u304a\u3051\u308b\u5b9f\u88c5\u306e\u4ed5\u65b9\u3092\u5927\u307e\u304b\u306b\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n## Web\u30a2\u30d7\u30ea\u5074\u3067endpoint\u3068\u516c\u958b\u9375\u3092\u53d6\u5f97\n\nWeb\u30a2\u30d7\u30ea\u5074\u306e\u5b9f\u88c5\u306b\u3064\u3044\u3066\u306f\u3001\u307e\u305a\u306f[Chrome\u3067W3C Push API\u3092\u4f7f\u3063\u3066\u307f\u305f](http://qiita.com/tomoyukilabs/items/8fffb4280c1914b6aa3d)\u3067\u793a\u3057\u3066\u3044\u308b\u3088\u3046\u306a\u624b\u9806\u3067\u3001`pushManager.subscribe(options)`\u3084`pushManager.getSubscription()`\u306b\u3088\u3063\u3066\u3001subscription\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n\u3053\u3053\u3067\u3001Web Push\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u30d6\u30e9\u30a6\u30b6\u306e\u5834\u5408\u306f\u3001`subscription.endpoint`\u3067\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u306eendpoint\u306b\u52a0\u3048\u3066\u3001`subscription.getKey()`\u306b\u3088\u3063\u3066\u5fc5\u8981\u306a\u9375\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n```js:\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u306bendpoint\u3068\u516c\u958b\u9375\u3092\u767b\u9332\u3059\u308b\u4f8b\nnavigator.serviceWorker.ready.then(function(registration) {\n  registration.pushManager.getSubscription().then(function(subscription){\n    fetch(appServerURL, {\n      credentials: 'include',\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json; charset=UTF-8' },\n      body: JSON.stringify({\n        endpoint: subscription.endpoint,\n        key: btoa(String.fromCharCode.apply(null, new Uint8Array(subscription.getKey('p256dh'))))\n               .replace(/\\+/g, '-').replace(/\\//g, '_'),\n        auth: btoa(String.fromCharCode.apply(null, new Uint8Array(subscription.getKey('auth'))))\n               .replace(/\\+/g, '-').replace(/\\//g, '_')\n    });\n  });\n});\n```\n\n`subscription.getKey()`\u306e\u5f15\u6570\u306b\u306f\u9375\u306e\u7a2e\u985e\u3092\u6307\u5b9a\u3057\u307e\u3059:\n\n* `'p256dh'`: \u9375\u5171\u6709\u30d7\u30ed\u30c8\u30b3\u30ebECDH\u3067\u5229\u7528\u3059\u308b**\u30d6\u30e9\u30a6\u30b6\u306e\u516c\u958b\u9375**\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u3001`p256dh`\u3068\u3044\u3046\u540d\u79f0\u306f\u3001\u6955\u5186\u66f2\u7dda\u306e\u7a2e\u985e\u3067\u3042\u308b\u3001P-256\u3042\u308b\u3044\u306fprime256v1\u3092\u6307\u3057\u307e\u3059\u3002\n* `'auth'`: **\u4ed5\u69d8\u4fee\u6b63\u5f8c\u306b\u5c0e\u5165\u3055\u308c\u305f\u30d1\u30e9\u30e1\u30fc\u30bf**\u3067\u3001\u9375\u751f\u6210\u3092\u3055\u3089\u306b\u8907\u96d1\u306b\u3059\u308b\u305f\u3081\u306e**\u79d8\u5bc6\u306e\u4e71\u6570**([\u4ed5\u69d8\u66f8](https://tools.ietf.org/html/draft-ietf-webpush-encryption-02)\u3067\u306fAuthentication Secret)\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002[ECDH\u306e\u9375\u5171\u6709\u3060\u3051\u3067\u306f\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u4e0a\u306e\u61f8\u5ff5\u304c\u6b8b\u308b\u305f\u3081\u4ed5\u69d8\u306b\u8ffd\u52a0\u3055\u308c\u305f\u3082\u306e\u306e\u3088\u3046\u3067\u3059](https://github.com/webpush-wg/webpush-encryption/pull/4)\u3002\u4ee5\u4e0b\u3001auth\u3068\u547c\u3073\u307e\u3059\u3002\n\n`getKey()`\u306e\u623b\u308a\u5024\u306f`ArrayBuffer`\u578b\u3067\u3059\u306e\u3067\u3001\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001`Uint8Array`\u578b\u306b\u5909\u63db\u3057\u3066Base64 URL\u30a8\u30f3\u30b3\u30fc\u30c9\u306b\u3088\u3063\u3066\u6587\u5b57\u5217\u306b\u5909\u63db\u3057\u3066\u304b\u3089\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u306b\u9001\u4fe1\u3057\u3066\u3044\u307e\u3059\u3002\n\n## \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u5074\u3067\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u3092\u9001\u4fe1\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u5074\u3067\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u306eendpoint\u3068\u30d6\u30e9\u30a6\u30b6\u306e\u516c\u958b\u9375\u3092\u53d6\u5f97\u3067\u304d\u308c\u3070\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u304b\u3089\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u306eendpoint\u306bHTTP POST\u3067\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u306e\u5185\u5bb9\u3092\u9001\u4fe1\u3059\u308b\u3053\u3068\u3067\u3001\u30d6\u30e9\u30a6\u30b6\u5074\u306b\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u304c\u6e21\u3055\u308c\u3001\u30d6\u30e9\u30a6\u30b6\u5074\u3067\u6697\u53f7\u5316\u3055\u308c\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u89e3\u8aad\u3057\u3066Service Worker\u5074\u3067\u51e6\u7406\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u7d50\u69cb\u3084\u3084\u3053\u3057\u3044\u51e6\u7406\u306b\u306a\u308a\u307e\u3059\u306e\u3067\u3001\u8aac\u660e\u3059\u308b\u3088\u308a\u306f\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3092\u793a\u3057\u305f\u307b\u3046\u304c\u826f\u3044\u306e\u3067\u306f\u3068\u601d\u3044\u307e\u3059\u3002\n\n### Node.js\u306e\u5834\u5408\n\nWeb Push Encryption\u306b\u5bfe\u5fdc\u3057\u305fNode.js\u7528\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u304cGitHub\u3067\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u3053\u3061\u3089\u3092\u8a66\u3057\u306b\u4f7f\u3063\u305f\u308a\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u306e\u5b9f\u88c5\u306e\u53c2\u8003\u306b\u3057\u305f\u308a\u3059\u308b\u3068\u3088\u3044\u3067\u3057\u3087\u3046\u3002\u95a2\u9023\u3059\u308b\u30ea\u30f3\u30af\u3092\u6b21\u306b\u793a\u3057\u307e\u3059\u3002\n\n* https://github.com/googlechrome/push-encryption-node\n* https://github.com/marco-c/web-push\n* https://github.com/martinthomson/encrypted-content-encoding\n\n\u4e0b\u306e2\u3064\u306b\u3064\u3044\u3066\u306f\u3001npm\u3067\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u53ef\u80fd\u3067\u3059\u3002\n\n```bash\nnpm install web-push\nnpm install encrypted-content-encoding\n```\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u5074\u306e\u5b9f\u88c5\u3067\u53c2\u8003\u306b\u306a\u308b\u7b87\u6240\u306f\u3001\n\n* https://github.com/GoogleChrome/push-encryption-node/blob/master/src/encrypt.js\n* https://github.com/marco-c/web-push/blob/master/index.js\n* https://github.com/martinthomson/encrypted-content-encoding/blob/master/nodejs/ece.js\n\n\u8fba\u308a\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u30b3\u30fc\u30c9\u3067\u9375\u30da\u30a2\u306e\u751f\u6210\u3084\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u6697\u53f7\u5316\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\n### Java\u306e\u5834\u5408(Tomcat, Jetty\u7b49)\n\n\u4e0a\u8a18\u306eNode.js\u306e\u30b3\u30fc\u30c9\u3092\u53c2\u8003\u306b\u3057\u3066\u3001\u3053\u3061\u3089\u3067Java\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002\u30b5\u30f3\u30d7\u30eb\u30da\u30fc\u30b8\u3082\u7528\u610f\u3057\u3066\u304a\u308a\u307e\u3059\u306e\u3067\u3001Chrome\u3042\u308b\u3044\u306fFirefox\u3067\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002\n\n* \u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9: https://github.com/tomoyukilabs/WebPushTest\n* \u30b5\u30f3\u30d7\u30eb\u30da\u30fc\u30b8: https://labs.othersight.jp/webpushtest\n\nJava\u3067\u306e\u5b9f\u88c5\u3092\u8a66\u3057\u3066\u307f\u3066\u6ce8\u610f\u304c\u5fc5\u8981\u3060\u3063\u305f\u70b9\u306f\u6b21\u306e\u901a\u308a\u3067\u3059\u3002\n\n* Oracle Java 8\u3060\u3051\u3067\u306f\u6955\u5186\u66f2\u7dda\u306e\u6307\u5b9a\u304c\u3067\u304d\u306a\u3044\u3088\u3046\u306a\u306e\u3067\u3001[Bouncy Castle\u306e\u6697\u53f7\u30e9\u30a4\u30d6\u30e9\u30ea](http://www.bouncycastle.org/wiki/display/JA1/Elliptic+Curve+Key+Pair+Generation+and+Key+Factories)\u3092\u5229\u7528\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u6642\u3001`Security.addProvider(new BouncyCastleProvider());`\u3067\u30d7\u30ed\u30d0\u30a4\u30c0\u3092\u8ffd\u52a0\u3057\u3001\u305d\u306e\u5f8c\u306e\u5404\u30e1\u30bd\u30c3\u30c9\u3067`BC`\u3092\u6697\u53f7\u30d7\u30ed\u30d0\u30a4\u30c0\u3068\u3057\u3066\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n* \u4e0a\u8a18\u306eNode.js\u3067\u3082\u540c\u3058\u3067\u3059\u304c\u3001\u6955\u5186\u66f2\u7dda\u306e\u540d\u524d\u3068\u3057\u3066\u306f`prime256v1`\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n* \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u306e\u516c\u958b\u9375`localPublicKey`\u3092\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u306b\u4ed8\u4e0e\u3059\u308b\u969b\u306b\u306f\u3001`localPublicKey.getEncoded()`\u3067\u306f\u306a\u304f\u3001`localPublicKey.getQ().getEncoded(false)`\u3092\u9001\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\u30d6\u30e9\u30a6\u30b6\u306e\u516c\u958b\u9375\u304c65\u30d0\u30a4\u30c8\u306a\u306e\u3067\u3001\u540c\u305865\u30d0\u30a4\u30c8\u306e\u30c7\u30fc\u30bf\u306b\u306a\u3063\u3066\u3044\u308c\u3070\u6b63\u3057\u3044\u516c\u958b\u9375\u3068\u8003\u3048\u3089\u308c\u307e\u3059\u3002\n\n### \u5177\u4f53\u7684\u306b\u306f\u4f55\u306e\u8a08\u7b97\u3092\u3057\u3066\u3044\u308b\u306e\u304b\n\n\u3056\u3063\u3068\u3067\u3059\u304c\u3001\u5b9f\u969b\u306e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u66f8\u304d\u4e0b\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u3001`||`\u306f\u3001\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u306e\u9023\u7d50\u3092\u8868\u3057\u307e\u3059\u3002\n\n\u4e0a\u8a18\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u6d3b\u7528\u3059\u308b\u5834\u5408\u306f\u4e0b\u8a18\u306e\u8a73\u7d30\u306a\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306f\u53c2\u7167\u4e0d\u8981\u3067\u3059\u304c\u3001\u3054\u81ea\u8eab\u3067\u6697\u53f7\u5316\u7b49\u3092\u5b9f\u88c5\u3059\u308b\u5834\u5408\u7b49\u306b\u53c2\u8003\u306b\u306a\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\n#### HMAC-based Key Derivation Function (HKDF) [[RFC 5869](https://tools.ietf.org/html/rfc5869)]\n\nWeb Push Encryption\u3067\u306fHKDF\u306b\u3088\u3063\u3066\u9375\u3084Nonce\u3068\u547c\u3070\u308c\u308b\u6697\u53f7\u5316\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u751f\u6210\u3057\u307e\u3059\u306e\u3067\u3001HKDF\u306e\u624b\u9806\u3092\u7c21\u5358\u306b\u8aac\u660e\u3057\u307e\u3059\u3002\u5177\u4f53\u7684\u306b\u306fextract\u3068expand\u306e2\u3064\u306e\u95a2\u6570\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\u3002\n\n* `HKDF_extract(salt, IKM)`: \u4e71\u6570`salt`\u3092\u9375(salt)\u3068\u3057\u3066\u3001HMAC SHA-256\u306b\u3088\u3063\u3066\u30e1\u30c3\u30bb\u30fc\u30b8`IKM`(Input Keying Material)\u3092\u30cf\u30c3\u30b7\u30e5\u3059\u308b\u3002\u305d\u306e\u7d50\u679c\u306f`PRK` (Pseudo-Random Key)\u3068\u547c\u3073\u300132\u30d0\u30a4\u30c8\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3068\u306a\u308b\u3002\n* `HKDF_expand(PRK, info, L)`: `info`\u306f\u4f55\u3089\u304b\u306e\u6587\u5b57\u5217\u3068\u3057\u3001`PRK`\u3092\u9375(salt)\u3068\u3057\u3066\u3001`info || 0x01`\u3092HMAC SHA-256\u306b\u3088\u3063\u3066\u30cf\u30c3\u30b7\u30e5\u3057\u3001\u305d\u306e\u3046\u3061\u5148\u982d\u306e`L`\u30d0\u30a4\u30c8\u3092\u53d6\u308a\u51fa\u3059(`L`\u304c32\u30d0\u30a4\u30c8\u4ee5\u5185\u306e\u5834\u5408)\u3002\n\n#### Web Push Encryption\n\nWeb Push Encryption\u306e\u624b\u9806\u306f\u6b21\u306e\u901a\u308a\u3067\u3059\u3002\u306a\u304a\u3001`auth`\u304c\u306a\u3044\u5834\u5408\u306b\u304a\u3044\u3066\u4e0b\u8a18\u624b\u98069.\u306e`context`\u3092\u7a7a\u30c7\u30fc\u30bf\u3068\u3059\u308b\u3068\u3001Firefox 44/45\u304c\u5bfe\u5fdc\u3059\u308b\u4ed5\u69d8\u3068\u540c\u3058\u306b\u306a\u308a\u307e\u3059\u3002\n\n(\u6ce8: `auth`\u4ed8\u304d\u6697\u53f7\u5316\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u30d6\u30e9\u30a6\u30b6\u306e\u3046\u3061\u3001Chrome 49\u306b\u9650\u308a[draft-ietf-httpbis-encryption-encoding-00](https://tools.ietf.org/html/draft-ietf-httpbis-encryption-encoding-00)\u306b\u6e96\u62e0\u3057\u3066\u3044\u308b\u305f\u3081\u8981\u6ce8\u610f\u3067\u3059\u304c\u3001\u305d\u3082\u305d\u3082Chrome 49\u3067Web Push\u6697\u53f7\u5316\u306b\u5bfe\u5fdc\u3059\u308b\u306b\u306f\u30d5\u30e9\u30b0\u3092\u6709\u52b9\u5316\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u5b9f\u7528\u4e0a\u306f\u3042\u307e\u308a\u610f\u8b58\u3057\u306a\u304f\u3066\u3082\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002)\n\n1. \u30d6\u30e9\u30a6\u30b6\u304b\u3089\u516c\u958b\u9375\u3068auth\u3092\u53d6\u5f97\u3059\u308b\u3002\n2. \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u7528\u306e\u9375\u30da\u30a2\u3092\u751f\u6210\u3059\u308b\u3002\n3. \u30d6\u30e9\u30a6\u30b6\u306e\u516c\u958b\u9375\u3068\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u306e\u79d8\u5bc6\u9375\u304b\u3089\u5171\u6709\u9375\u3092\u751f\u6210\u3057\u3001\u305d\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092`IKM`\u3068\u3059\u308b\u3002\n4. 16\u30d0\u30a4\u30c8(128\u30d3\u30c3\u30c8)\u306e\u4e71\u6570\u3092\u751f\u6210\u3057\u3001\u3053\u308c\u3092salt\u3068\u3059\u308b\u3002\n5. auth\u304c\u7121\u3044\u5834\u5408\u306f\u3001`PRK = HKDF_extract(salt, IKM)`\u3092\u8a08\u7b97\u3057\u30019.\u306b\u9032\u3080\u3002\n6. `_PRK = HKDF_extract(auth, IKM)`\u3092\u8a08\u7b97\u3059\u308b\u3002\n7. `_IKM = HKDF_expand(_PRK, \"Content-Encoding: auth\" || 0x00, 32)`\u3092\u8a08\u7b97\u3059\u308b\u3002\n8. `PRK = HKDF_extract(salt, _IKM)`\u3092\u8a08\u7b97\u3059\u308b\u3002\n9. `context = 0x00 || \"P-256\" || 0x00 || (\u30d6\u30e9\u30a6\u30b6\u516c\u958b\u9375\u306e\u30d0\u30a4\u30c8\u9577\u306e16\u30d3\u30c3\u30c8\u8868\u73fe(=0x0041)) || (\u30d6\u30e9\u30a6\u30b6\u516c\u958b\u9375\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf) || (\u30b5\u30fc\u30d0\u516c\u958b\u9375\u306e\u30d0\u30a4\u30c8\u9577\u306e16\u30d3\u30c3\u30c8\u8868\u73fe(=0x0041)) || (\u30b5\u30fc\u30d0\u516c\u958b\u9375\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf)`\u3092\u53d6\u5f97\u3059\u308b\u3002 \n10. `HKDF_expand(PRK, \"Content-Encoding: aesgcm\" || context, 16)`\u3092\u8a08\u7b97\u3057\u3001\u5f97\u3089\u308c\u308b128\u30d3\u30c3\u30c8\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092AES-GCM\u3067\u306e\u6697\u53f7\u9375\u3068\u3059\u308b\u3002\n    * Chrome 49\u306b\u5bfe\u3057\u3066\u306f\u3001`HKDF_expand(PRK, \"Content-Encoding: aesgcm128\" || context, 16)`\u3068\u3059\u308b\u3002\n11. `HKDF_expand(PRK, \"Content-Encoding: nonce\" || context, 12)`\u3092\u8a08\u7b97\u3057\u3001\u5f97\u3089\u308c\u308b96\u30d3\u30c3\u30c8\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092AES-GCM\u3067\u306enonce\u3068\u3059\u308b\u3002\n12. 10.\u306e\u6697\u53f7\u9375\u306811.\u306enonce\u3092\u4f7f\u3063\u3066128\u30d3\u30c3\u30c8AES-GCM\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u6697\u53f7\u5316\u3059\u308b\u3002\n    * 4078\u30d0\u30a4\u30c8\u5358\u4f4d(Chrome 50+)\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u533a\u5207\u3063\u3066\u6697\u53f7\u5316\u3059\u308b\u3002(Chrome 49\u306e\u5834\u5408\u306f4079\u30d0\u30a4\u30c8\u5358\u4f4d\u3002)\n    * \u533a\u5207\u3089\u308c\u305f\u30d6\u30ed\u30c3\u30af\u306e\u5148\u982d\u306b\u306f`0x0000`\u306e2\u30d0\u30a4\u30c8(Chrome 49\u306e\u5834\u5408\u306f`0x00`\u306e1\u30d0\u30a4\u30c8)\u3092\u4ed8\u3051\u3066\u3001\u5b9f\u969b\u306b\u306f4080\u30d0\u30a4\u30c8\u5358\u4f4d\u3067\u6697\u53f7\u5316\u3059\u308b\u3002\u6697\u53f7\u5316\u3055\u308c\u305f\u30da\u30a4\u30ed\u30fc\u30c9\u306f16\u30d0\u30a4\u30c8\u306e\u30d8\u30c3\u30c0\u8fbc\u307f\u30674096\u30d0\u30a4\u30c8\u5358\u4f4d\u3068\u306a\u308b\u3002\n    * \u6697\u53f7\u9375\u306f11.\u3067\u751f\u6210\u3057\u305f\u3082\u306e\u3092\u5229\u7528\u3059\u308b\u3002\n    * \u5148\u982d\u30d6\u30ed\u30c3\u30af\u3092`0`\u3068\u3057\u3066\u30ab\u30a6\u30f3\u30bf\u306e\u5024\u3092\u30d6\u30ed\u30c3\u30af\u5358\u4f4d\u30671\u305a\u3064\u5897\u52a0\u3055\u305b\u308b\u3002\n    * AES\u6697\u53f7\u5316\u3067\u4f7f\u3046IV\u306e\u5024\u306f\u300112.\u306enonce\u306e\u4e0b\u4f4d6\u30d0\u30a4\u30c8\u306b\u3064\u3044\u3066\u30ab\u30a6\u30f3\u30bf\u306e\u5024\u3068\u306eXOR\u3092\u53d6\u3063\u3066\u7f6e\u304d\u63db\u3048\u305f\u3082\u306e\u3068\u3059\u308b(\u4e0a\u4f4d6\u30d0\u30a4\u30c8\u306f\u305d\u306e\u307e\u307e)\u3002\n13. endpoint\u3067\u793a\u3055\u308c\u308b\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u306eURL\u306bHTTP POST\u3067\u6697\u53f7\u5316\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\u3002\u3053\u306e\u3068\u304d\u3001HTTP\u30ea\u30af\u30a8\u30b9\u30c8\u30d8\u30c3\u30c0\u306b\u6b21\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u6307\u5b9a\u3059\u308b\u3002\n    * `Crypto-Key: `(Firefox 44/45\u306e\u5834\u5408\u306f`Encryption-Key: `)\u306b`keyid=p256dh;dh=(Base64 URL\u30a8\u30f3\u30b3\u30fc\u30c9\u3057\u305f10.\u306e\u5171\u6709\u9375)`\u3092\u6307\u5b9a\n    * `Encryption: `\u306b`keyid=p256dh;salt=(Base64 URL\u30a8\u30f3\u30b3\u30fc\u30c9\u3057\u305f4.\u306esalt)`\u3092\u6307\u5b9a\n    * `Content-Encoding: ` \u306b`aesgcm`(Chrome 49\u53ca\u3073Firefox 44/45\u306e\u5834\u5408\u306f`aesgcm128`)\u3092\u6307\u5b9a\n    * `Authorization: `\u306b`key=(GCM\u306eserver key)`\u3092\u6307\u5b9a(Chrome\u306e\u307f; \u8a73\u7d30\u306f[Chrome\u3067W3C Push API\u3092\u4f7f\u3063\u3066\u307f\u305f](http://qiita.com/tomoyukilabs/items/8fffb4280c1914b6aa3d)\u3092\u53c2\u7167)\n    * `TTL: `\u306b\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u306e\u53d7\u4fe1\u6709\u52b9\u671f\u9650\u3092\u79d2\u5358\u4f4d\u3067\u6307\u5b9a\n\n\u306a\u304a\u3001Chrome 51\u4ee5\u524d\u306e\u30d6\u30e9\u30a6\u30b6\u306b\u5bfe\u3057\u3066Web Push\u3067\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u3092\u9001\u4fe1\u3059\u308b\u5834\u5408\u306f\u3001endpoint\u3068\u3057\u3066Push API\u304b\u3089\u53d6\u5f97\u3067\u304d\u308bGCM\u30b5\u30fc\u30d0\u306eURL\u3092\u6b21\u306e\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002([\u53c2\u8003](https://developers.google.com/cloud-messaging/))\n\n```text\nhttps://android.googleapis.com/gcm/send/[registration_id]\n\u3000\u3000\u3000\u3000\u2193\nhttps://gcm-http.googleapis.com/gcm/[registration_id]\n```\n\n\u306a\u304a\u3001Chrome 52\u4ee5\u964d\u3067\u3001GCM\u306eserver key\u3092manifest\u306b\u8a18\u8ff0\u3059\u308b\u65b9\u6cd5\u3067\u306f\u306a\u304f\u3001[VAPID](http://qiita.com/tomoyukilabs/items/9346eb44b5a48b294762)\u3067\u30b5\u30fc\u30d0\u8a8d\u8a3c\u3092\u884c\u3063\u3066\u3044\u308b\u5834\u5408\u306f\u3001endpoint\u306eURL\u306fFirebase Cloud Messaging (FCM)\u306e\u3082\u306e\u3068\u306a\u308a\u307e\u3059(\u4e0a\u8a18\u306e\u3088\u3046\u306a\u66f8\u304d\u63db\u3048\u304c\u4e0d\u8981\u306b\u306a\u308a\u307e\u3059)\u3002\n\n## Service Worker\u3067\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u3092\u53d7\u4fe1\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u5074\u3067\u6b63\u3057\u304f\u30d6\u30e9\u30a6\u30b6\u3068\u306e\u9375\u5171\u6709\u3068\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u6697\u53f7\u5316\u304c\u3067\u304d\u3066\u3044\u308c\u3070\u3001\u30d7\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u7d4c\u7531\u3067\u30d6\u30e9\u30a6\u30b6\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u3057\u3001\u30d6\u30e9\u30a6\u30b6\u5074\u3067\u6697\u53f7\u3092\u89e3\u8aad\u3057\u3066\u901a\u77e5\u3092\u8868\u793a\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n```json:\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u304b\u3089\u9001\u4fe1\u3057\u305f\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u4f8b(\u5e73\u6587)\n{\n  \"title\": \"Push Message\",\n  \"body\": \"\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u4ed8\u3051\u3066\u9001\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3057\u305f\u3088\",\n  \"tag\": \"pushMessage201512080001\"\n}\n```\n\n```js:ServiceWorker\u3067\u306e\u53d7\u4fe1\u4f8b\nself.addEventListener('push', function(evt) {\n  if(evt.data) {\n    var data = evt.data.json();\n    evt.waitUntil(\n      self.registration.showNotification(\n        data.title,\n        {\n          icon: '(\u30a2\u30a4\u30b3\u30f3\u306eURL(\u30d1\u30b9\u306e\u307f\u3067OK))',\n          body: data.body,\n          tag: data.tag\n        }\n      )\n    );\n  }\n}, false);\n```\n\n`push`\u30a4\u30d9\u30f3\u30c8\u306e\u30ea\u30b9\u30ca\u95a2\u6570\u3067\u306f\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u53d7\u4fe1\u6642\u306b`PushEvent`\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u53d7\u3051\u53d6\u308a\u307e\u3059\u304c\u3001Web Push\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u5834\u5408\u306f`evt.data`\u306b\u30e1\u30c3\u30bb\u30fc\u30b8(\u30da\u30a4\u30ed\u30fc\u30c9)\u306e\u5185\u5bb9\u304c\u683c\u7d0d\u3055\u308c\u307e\u3059\u3002\u30da\u30a4\u30ed\u30fc\u30c9\u304c\u7a7a\u3067\u3042\u308c\u3070\u3001`evt.data`\u304c`null`\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u4e0a\u8a18\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3067\u306f\u3001[Fetch API](http://qiita.com/tomoyukilabs/items/9b464c53450acc0b9574)\u306b\u4f3c\u305f\u611f\u3058\u3067\u3001`evt.data.text()`\u3067\u6587\u5b57\u5217\u3001`evt.data.json()`\u3067JSON\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3001`evt.data.arrayBuffer()`\u3067ArrayBuffer\u3001`evt.data.blob()`\u3067Blob\u3068\u3057\u3066\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u3051\u53d6\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002(Fetch API\u3068\u9055\u3044\u3001Promise\u3067\u306f\u306a\u304f\u30e1\u30bd\u30c3\u30c9\u306e\u623b\u308a\u5024\u3068\u3057\u3066\u76f4\u63a5\u53d7\u3051\u53d6\u308a\u307e\u3059\u3002)\n\n# \u305d\u306e\u4ed6\n\n* Firefox\u306b\u3064\u3044\u3066\u3001\u3053\u3061\u3089\u306e\u74b0\u5883(OS X El Capitan)\u3067\u8a66\u3057\u3066\u307f\u305f\u9650\u308a\u3067\u306f\u3001\u30a6\u30a3\u30f3\u30c9\u30a6\u304c\u5168\u3066\u9589\u3058\u3089\u308c\u3066\u3044\u308b\u3068\u3001\u901a\u77e5\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3082\u30a6\u30a3\u30f3\u30c9\u30a6\u304c\u958b\u304b\u305a\u3001\u4e2d\u8eab\u304c\u306a\u304f\u3066\u3082\u826f\u3044\u306e\u3067\u4f55\u304b\u30a6\u30a3\u30f3\u30c9\u30a6\u3092\u958b\u3044\u3066\u3044\u308c\u3070\u3001\u901a\u77e5\u30af\u30ea\u30c3\u30af\u3067\u305d\u306eWeb\u30a2\u30d7\u30ea\u3092\u958b\u304f\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3001\u3068\u3044\u3063\u305f\u6319\u52d5\u3067\u3057\u305f\u3002\u4eca\u5f8c\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3067\u6539\u5584\u3055\u308c\u308b\u3053\u3068\u3092\u9858\u3044\u307e\u3059\u3002\n", "tags": ["HTML5", "Push\u901a\u77e5", "JavaScript", "firefox", "Chrome"]}