{"context": "\n\n\u30e1\u30cb\u30e5\u30fc\n\n\u672c\u30cf\u30f3\u30ba\u30aa\u30f3\u306e\u30b4\u30fc\u30eb\n\nServerspec \u3067\u63d0\u4f9b\u3055\u308c\u308b\u5404\u7a2e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092\u8a66\u3057\u3066\u307f\u307e\u3059\nDocker \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066 Dockerfile \u306e\u30c6\u30b9\u30c8\u3092\u4f5c\u6210\u3057\u3001\u30c6\u30b9\u30c8\u3092\u884c\u3044\u307e\u3059\nInfrataster \u3092\u5229\u7528\u3057\u3066 Web \u30b5\u30a4\u30c8\u306e\u632f\u308b\u821e\u3044\u306e\u30c6\u30b9\u30c8\u3092\u884c\u3044\u307e\u3059\n\u304a\u307e\u3051\u3067 Jenkins \u3092\u5229\u7528\u3057\u3066\u30c6\u30b9\u30c8\u3001Docker Hub \u3078\u306e\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u306e\u81ea\u52d5\u5316\u3082\u884c\u3044\u307e\u3059\n\n\n\u6ce8\u610f\n\n\u8cc7\u6599\u306e\u898b\u65b9\n\u4e8b\u524d\u6e96\u5099\u306b\u3064\u3044\u3066\n\u8cc7\u6599\u5185\u3067\u7d39\u4ecb\u3059\u308b\u5404\u7a2e\u30c4\u30fc\u30eb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u3064\u3044\u3066\n\u5f8c\u7247\u4ed8\u3051\u306f\u3057\u3063\u304b\u308a\u3068\n\n\n\u53c2\u8003\u8cc7\u6599\n\n\u53c2\u8003 URL\n\u53c2\u8003\u66f8\u7c4d\n\u30cf\u30f3\u30ba\u30aa\u30f3\u8cc7\u6599\n\u30cf\u30f3\u30ba\u30aa\u30f3\u6559\u6750\n\n\n2. \u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u306e\u66f8\u304d\u65b9\n2.1. Rspec \u3068\u306f\n2.2. spec_helper.rb\n2.3. Resouce Type\n2.4. \u30c6\u30b9\u30c8\u3092\u66f8\u3044\u3066\u307f\u3088\u3046\n\n3. Docker \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066 Dockerfile \u3092\u30c6\u30b9\u30c8\u3059\u308b\n3.1. \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3068\u306f\n3.2. \u8981\u4ef6\n3.3. \u30c6\u30b9\u30c8\u3092\u66f8\u304f\n3.4. \u521d\u3081\u3066\u306e\u30c6\u30b9\u30c8\n3.5. Dockerfile \u306e\u4f5c\u6210\n3.6. \u30c6\u30b9\u30c8\n\n4. Infrataster \u30b5\u30a4\u30c8\u306e\u632f\u308b\u821e\u3044\u3092\u30c6\u30b9\u30c8\u3059\u308b\n4.1. Infrataster \u3068\u306f\n4.2. Infrataster \u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n4.3. \u8981\u4ef6\n4.4. \u30c6\u30b9\u30c8\u3092\u66f8\u304f\n4.5. \u521d\u3081\u3066\u306e\u30c6\u30b9\u30c8\n4.6. \u30c6\u30b9\u30c8\n\n5. \u307e\u3068\u3081\n\n\u4eca\u65e5\u3084\u3063\u305f\u3053\u3068\n\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u5229\u7528\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u306e\u524a\u9664\n\n\n\n\u672c\u30cf\u30f3\u30ba\u30aa\u30f3\u306e\u30b4\u30fc\u30eb\n\nServerspec \u3067\u63d0\u4f9b\u3055\u308c\u308b\u5404\u7a2e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092\u8a66\u3057\u3066\u307f\u307e\u3059\nDocker \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066 Dockerfile \u306e\u30c6\u30b9\u30c8\u3092\u4f5c\u6210\u3057\u3001\u30c6\u30b9\u30c8\u3092\u884c\u3044\u307e\u3059\nInfrataster \u3092\u5229\u7528\u3057\u3066 Web \u30b5\u30a4\u30c8\u306e\u632f\u308b\u821e\u3044\u306e\u30c6\u30b9\u30c8\u3092\u884c\u3044\u307e\u3059\n\n\n\n\u6ce8\u610f\n\n\u8cc7\u6599\u306e\u898b\u65b9\n\u4ee5\u4e0b\u3001\u5b9f\u884c\u3059\u308b\u30b3\u30de\u30f3\u30c9\u306e\u8868\u793a\u3067\u3059\u3002\n\ncommand\n# \u30b3\u30e1\u30f3\u30c8\u3067\u3059\n\n# \u30cf\u30f3\u30ba\u30aa\u30f3\u5185\u3067\u5b9f\u884c\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3067\u3059\uff08\u30b3\u30d4\u30fc\uff06\u30da\u30fc\u30b9\u30c8\u3067\u8cbc\u308a\u4ed8\u3051\u3066\u5229\u7528\u3057\u3066\u4e0b\u3055\u3044\uff09\ncommand \"foo\" \"bar\"\n\n\n\u4ee5\u4e0b\u3001\u51fa\u529b\u4f8b\u306e\u8868\u793a\u3067\u3059\u3002\n\noutput\n# \u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u5f8c\u306e\u51fa\u529b\u4f8b\u3067\u3059\nfoo\nbar\n\n\n\u4e0a\u8a18\u306b\u5b9f\u884c\u4f8b\u3068\u7570\u306a\u308b\u51fa\u529b\u3092\u78ba\u8a8d\u3057\u305f\u5834\u5408\u306b\u306f\u304a\u58f0\u304c\u3051\u4e0b\u3055\u3044\u3002\n\n\u4e8b\u524d\u6e96\u5099\u306b\u3064\u3044\u3066\n\n\u30cf\u30f3\u30ba\u30aa\u30f3\u3092\u5186\u6ed1\u306b\u9032\u3081\u308b\u306b\u3042\u305f\u3063\u3066\u4e8b\u524d\u6e96\u5099\u306f\u51fa\u6765\u308b\u3060\u3051\u884c\u3046\u3088\u3046\u306b\u3057\u3066\u4e0b\u3055\u3044\n\n\n\u8cc7\u6599\u5185\u3067\u7d39\u4ecb\u3059\u308b\u5404\u7a2e\u30c4\u30fc\u30eb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u3064\u3044\u3066\n\u8cc7\u6599\u5185\u3067\u7d39\u4ecb\u3059\u308b\u5404\u7a2e\u30c4\u30fc\u30eb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\nOS\n\n\noutput\n$ lsb_release -a\nNo LSB modules are available.\nDistributor ID: Ubuntu\nDescription:    Ubuntu 14.04.4 LTS\nRelease:        14.04\nCodename:       trusty\n\n\n\nRuby\n\n\noutput\n$ ruby -v\nruby 2.3.1p112 (2016-04-26 revision 54768) [x86_64-linux]\n\n\n\nServerspec\n\n\noutput\n$ bundle exec gem list | grep serverspec\nserverspec (2.36.0)\n\n\n\nInfrataster\n\n\noutput\n$ bundle exec gem list | grep infrataster\ninfrataster (0.3.2)\n\n\n\nDocker Engine\n\n\noutput\n$ docker version\nClient:\n Version:      1.11.2\n API version:  1.23\n Go version:   go1.5.4\n Git commit:   b9f10c9\n Built:        Wed Jun  1 21:47:50 2016\n OS/Arch:      linux/amd64\n\nServer:\n Version:      1.11.2\n API version:  1.23\n Go version:   go1.5.4\n Git commit:   b9f10c9\n Built:        Wed Jun  1 21:47:50 2016\n OS/Arch:      linux/amd64\n\n\n\n\u5f8c\u7247\u4ed8\u3051\u306f\u3057\u3063\u304b\u308a\u3068\n\u672c\u65e5\u4f5c\u6210\u3057\u305f\u4eee\u60f3\u30de\u30b7\u30f3\u306f\u30cf\u30f3\u30ba\u30aa\u30f3\u7d42\u4e86\u5f8c\u3001\u4e0d\u8981\u3067\u3042\u308c\u3070\u524a\u9664\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n\n\u53c2\u8003\u8cc7\u6599\n\n\u53c2\u8003 URL\n\nhttp://serverspec.org/\nhttp://web-k.github.io/blog/2012/09/27/rspec_basic/\nhttp://qiita.com/jnchito/items/42193d066bd61c740612\n\n\n\u53c2\u8003\u66f8\u7c4d\n\nhttp://www.oreilly.co.jp/books/9784873117096/\n\n\n\u30cf\u30f3\u30ba\u30aa\u30f3\u8cc7\u6599\n\nServerspec \u30cf\u30f3\u30ba\u30aa\u30f3\u8cc7\u6599\uff08\u4e8b\u524d\u6e96\u5099\u7de8\uff09\n\nServerspec \u30cf\u30f3\u30ba\u30aa\u30f3\u8cc7\u6599\uff08\u5b9f\u8df5\u7de8\uff09\n\u203b\u672c\u8cc7\u6599\u3067\u3059\nServerspec \u30cf\u30f3\u30ba\u30aa\u30f3\u8cc7\u6599\uff08Jenkins \u304a\u3058\u3055\u3093\u304a\u5c4a\u3051\u7de8\uff09\n\n\n\u30cf\u30f3\u30ba\u30aa\u30f3\u6559\u6750\n\nhttps://github.com/inokappa/handson-serverspec\n\n\n\n2. \u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u306e\u66f8\u304d\u65b9\n\n2.1. Rspec\uff08Serverspec \u3092\u59cb\u3081\u308b\u3042\u305f\u3063\u3066\u77e5\u3063\u3066\u304a\u304d\u305f\u3044 Rspec \u306e\u5165\u308a\u53e3\u306e\u5165\u308a\u53e3\uff09\n\n2.1.1. Rspec \u3068\u306f\n\nRuby \u3067\u5b9f\u88c5\u3055\u308c\u305f\u30dd\u30d4\u30e5\u30e9\u30fc\u306a\u30c6\u30b9\u30c8\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\uff08\u4ed6\u306b\u306f Test::Unit \u3068\u3044\u3046\u6a19\u6e96\u3067\u7d44\u307f\u8fbc\u307e\u308c\u3066\u3044\u308b\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3082\u3042\u308b\uff09\n\u82f1\u8a9e\u3063\u307d\u304f\u30c6\u30b9\u30c8\u3092\u66f8\u304f\u3053\u3068\u304c\u51fa\u6765\u308b\n\n\n2.1.2. Rspec \u306e\u57fa\u672c\n\n\u30c6\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092 spec \u30d5\u30a1\u30a4\u30eb\u3068\u547c\u3076\nit \u3067\u59cb\u3081\u308b\u90e8\u5206\u304c example\uff08\u30c6\u30b9\u30c8\uff09\u3068\u306a\u308b\ndescribe do ~ end \u3067\u56f2\u307e\u308c\u305f\u90e8\u5206\u3092 example \u30b0\u30eb\u30fc\u30d7\u3068\u547c\u3076\n\u671f\u5f85\u5024\u3068\u5b9f\u969b\u306e\u5024\u3092\u6bd4\u8f03\u3057\u305f\u7d50\u679c\u3092\u304b\u3048\u3059\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u30de\u30c3\u30c1\u30e3\uff08\u62b9\u8336\u3067\u306f\u306a\u3044\uff09\u3068\u547c\u3076\n\n\n2.1.3. spec \u30d5\u30a1\u30a4\u30eb\u4f8b\nServerspec \u3067\u5229\u7528\u3059\u308b spec \u30d5\u30a1\u30a4\u30eb\u306e\u4f8b\u3002\n\nexample_spec.rb\n# example \u30b0\u30eb\u30fc\u30d7\ndescribe package('httpd') do\n  # example\n  # - should = \u3079\u304d\u3067\u3042\u308b\n  # - be_installed = \u30de\u30c3\u30c1\u30e3\n  it { should be_installed }\nend\n\n# \u65e5\u672c\u8a9e\u306b\u8a33\u3059\u3068\n# \u30d1\u30c3\u30b1\u30fc\u30b8 \"httpd\" \u306b\u3064\u3044\u3066\n#   \u305d\u308c\u306f(it)\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b(be_installed)\u3079\u304d(should)\n# \u3067\u3042\u308b\n\n# example \u30b0\u30eb\u30fc\u30d7\ndescribe command('ls -al /') do\n  # example\n  # - match = \u30de\u30c3\u30c1\u30e3\n  its(:stdout) { should match /bin/ }\nend\n\n# \u65e5\u672c\u8a9e\u306b\u8a33\u3059\u3068\n# \u30b3\u30de\u30f3\u30c9 \"ls -al /\" \u306b\u3064\u3044\u3066\n#   \u305d\u306e\u51fa\u529b(its(:stdout))\u306f \"bin\" \u306b\u30de\u30c3\u30c1(match)\u3067\u3059\u308b\u3079\u304d(should)\n# \u3067\u3042\u308b\n\n\n\u203b should \u306e\u90e8\u5206\u3092 expect\uff08\u3044\u304f\u3059\u307a\u304f\u3068\uff09\u30e1\u30bd\u30c3\u30c9\u306b\u7f6e\u304d\u63db\u3048\u308b\u3053\u3068\u304c\u51fa\u6765\u308b\u304c\u3001\u672c\u8cc7\u6599\u3067\u306f should \u30e1\u30bd\u30c3\u30c9\u3092\u5229\u7528\u3059\u308b\n\n2.2. spec_helper.rb\nRspec \u306e\u6319\u52d5\u3092\u5236\u5fa1\u3059\u308b\u70ba\u306b\u5229\u7528\u3055\u308c\u308b\u30d5\u30a1\u30a4\u30eb\u3067 Serverspec \u3067\u3082\u5229\u7528\u3055\u308c\u308b\u3002Serverspec \u3067\u306f serverspec-init \u3092\u5b9f\u884c\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5185\u5bb9\u3068\u306a\u3063\u3066\u3044\u308b\u3002\uff08\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092 Exec \u3092\u9078\u629e\u3057\u305f\u5834\u5408\uff09\n\nspec_helper.rb\nrequire 'serverspec'\n\nset :backend, :exec\n\n\n\n2.3. \u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7\n\n\u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7 = \u30c6\u30b9\u30c8\u5bfe\u8c61\u306e\u7a2e\u985e\n\u30ea\u30bd\u30fc\u30b9 = \u30c6\u30b9\u30c8\u5bfe\u8c61\n\n\nexample_spec.rb\n# interface \u304c\u30c6\u30b9\u30c8\u5bfe\u8c61\u3068\u306a\u308b\u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7\n# interface('eth0') \u304c\u30c6\u30b9\u30c8\u5bfe\u8c61\u3068\u306a\u308b\u30ea\u30bd\u30fc\u30b9\ndescribe interface('eth0') do\n  its(:speed) { should eq 1000 }\nend\n\n\nServerspec \u3067\u6271\u3048\u308b\u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7\u306b\u3064\u3044\u3066\u306f\u3001\u4ee5\u4e0b\u306e URL \u306b\u63b2\u8f09\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u78ba\u8a8d\u3059\u308b\u3002\n\nhttp://serverspec.org/resource_types.html\n\n\n2.4. \u30c6\u30b9\u30c8\u3092\u66f8\u3044\u3066\u307f\u3088\u3046\n\n2.4.1. \u30c6\u30b9\u30c8\u8981\u4ef6\n\n\nOS \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f Ubuntu 14.04 \u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\ndocker-engine \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\ndocker-engine \u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b \ndocker \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\u3059\u308b\nRuby \u3084 servespec \u3084 infrataster \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n\n\n2.4.2. serverspec-init\nserverspec-init \u3092\u5b9f\u884c\u3059\u308b\u3068\u30c6\u30b9\u30c8\u306b\u5fc5\u8981\u306a\u5404\u7a2e\u30d5\u30a1\u30a4\u30eb\u3084 spec \u30d5\u30a1\u30a4\u30eb\u306e\u96db\u5f62\u3092\u751f\u6210\u3055\u308c\u308b\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b serverspec-init \u3092\u5b9f\u884c\u3059\u308b\u3002\n\ncommand\ncd ~/handson-serverspec/\nmkdir first_test\ncd first_test\nbundle exec serverspec-init\n\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b spec \u30d5\u30a1\u30a4\u30eb\u306e\u96db\u5f62\u3084 spec_helper.rb \u3084 Rakefile \u3092\u751f\u6210\u3055\u308c\u308b\u3002\uff08OS type \u3068 backend type \u3092\u9078\u629e\u3059\u308b\uff09\n\noutput\nSelect OS type:\n\n  1) UN*X\n  2) Windows\n\nSelect number: 1 #=> 1 \u3092\u9078\u629e\n\nSelect a backend type:\n\n  1) SSH\n  2) Exec (local)\n\nSelect number: 2 #=> 2 \u3092\u9078\u629e\n\n + spec/\n + spec/localhost/\n + spec/localhost/sample_spec.rb\n + spec/spec_helper.rb\n + Rakefile\n + .rspec\n\n\n\n2.4.3. \u30c6\u30b9\u30c8\u3092\u66f8\u304f\n\u30c6\u30b9\u30c8\u8981\u4ef6\u306b\u57fa\u3044\u3066\u3001sample_spec.rb \u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u308b\u3002\n\nspec/localhost/sample_spec.rb\nrequire 'spec_helper'\n\ndescribe \"OS \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f Ubuntu 14.04 \u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\" do\n  describe command(\"lsb_release -a\") do\n    its(:stdout) { should match /Ubuntu 14.04/ }\n  end\nend\n\ndescribe \"docker-engine \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\" do\n  describe package('docker-engine'), :if => os[:family] == 'ubuntu' do\n    it { should be_installed }\n  end\nend\n\ndescribe \"docker-engine \u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068 / docker \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\u3059\u308b\" do\n  describe service('docker'), :if => os[:family] == 'ubuntu' do\n    it { should be_running }\n  end\n  describe command(\"docker version\") do\n    its(:stdout) { should match /1.11.2/ }\n  end\nend\n\ndescribe \"Ruby \u3084 servespec / infrataster \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\" do\n  it \"\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b Ruby \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f 2.3.1 \u3067\u3042\u308b\" do\n    expect(check_ruby_version).to include(\"2.3.1\")\n  end\n\n  it \"Serverspec \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\" do\n    expect(check_packages(\"serverspec\")).to include(\"serverspec\")\n  end\n\n  it \"Infrataster \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\" do\n    expect(check_packages(\"infrataster\")).to include(\"infrataster\")\n  end\n\n  def check_ruby_version\n    command(\"ruby -v\").stdout\n  end\n\n  def check_packages(package)\n    command(\"bundle exec gem list | grep #{package}\").stdout\n  end\n\nend\n\n\n\n2.4.4. \u30c6\u30b9\u30c8\u5b9f\u884c\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3002\n\ncommand\nbundle exec rake\n\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\noutput\n(snip)\n\nOS \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f Ubuntu 14.04 \u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n  Command \"lsb_release -a\"\n    stdout\n      should match /Ubuntu 14.04/\n\ndocker-engine \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n  Package \"docker-engine\"\n    should be installed\n\ndocker-engine \u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068 / docker \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\u3059\u308b\n  Service \"docker\"\n    should be running  Command \"docker version\"    stdout\n      should match /1.11.2/\n\nRuby \u3084 servespec / infrataster \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n  \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b Ruby \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f 2.3.1 \u3067\u3042\u308b\n  Serverspec \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\n  Infrataster \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\n\nFinished in 0.68314 seconds (files took 0.31922 seconds to load)\n7 examples, 0 failures\n\n\n\u5b9f\u969b\u306e\u51fa\u529b\u753b\u9762\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u308b\u3002\n\n\n\n3. Docker \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066 Dockerfile \u3092\u30c6\u30b9\u30c8\u3059\u308b\n\n3.1. \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3068\u306f\n\n3.1.1. \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3068\u306f\n\nServerspec\uff08\u5b9f\u969b\u306b\u306f Specinfra\uff09\u3067\u306f\u6838\u3068\u306a\u308b\u90e8\u5206\n\u3056\u3063\u304f\u308a\u8a00\u3046\u3068...\u5b9f\u884c\u5f62\u5f0f\u306e\u9055\u3044\u3092\u610f\u8b58\u3059\u308b\u3053\u3068\u306a\u304f\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u308b\u30ec\u30a4\u30e4\u30fc\n\u30c6\u30b9\u30c8\u5bfe\u8c61\u30db\u30b9\u30c8 OS \u306b\u5fdc\u3058\u305f\u30b3\u30de\u30f3\u30c9\u3092\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306b\u5fdc\u3058\u305f\u5b9f\u884c\u5f62\u5f0f\u3067\u5b9f\u884c\u3059\u308b\n\n\n3.1.2. \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306e\u7a2e\u985e\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u304c\u5229\u7528\u51fa\u6765\u308b\u3002\n\nexec\nssh\npowershell\ncmd\ndocker\nlxc\nwinrm\nshell_script\ndockerfile\ntelnet\n\n\n3.2. \u8981\u4ef6\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8981\u4ef6\u306e Docker \u30b3\u30f3\u30c6\u30ca\u4f5c\u3063\u3066\u30c6\u30b9\u30c8\u3057\u305f\u3044\u3002\n\nWeb \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b3\u30f3\u30c6\u30ca\nWeb \u30b5\u30fc\u30d0\u30fc\u306f Apache\n\u30b3\u30f3\u30c6\u30f3\u30c4\u306f\u9759\u7684\u306a index.html \u4e00\u679a\n\n\n3.3. Dockerfile \u306e\u4f5c\u6210\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u4f5c\u6210\u6e08\u307f\u306e Dockerfile \u3092\u78ba\u8a8d\u3059\u308b\u3002\n\ncommand\ncd ~/handson-serverspec\ncat docker/Dockerfile\n\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\noutput\nFROM ubuntu:14.04\nRUN apt-get update && \\\n    apt-get install -y apache2 && \\\n    mkdir /var/run/apache2 && \\\n    mkdir /var/lock/apache2\nADD index.html /var/www/html/\nEXPOSE 80\nenv APACHE_RUN_USER    www-data\nenv APACHE_RUN_GROUP   www-data\nenv APACHE_PID_FILE    /var/run/apache2.pid\nenv APACHE_RUN_DIR     /var/run/apache2\nenv APACHE_LOCK_DIR    /var/lock/apache2\nenv APACHE_LOG_DIR     /var/log/apache2\nenv LANG               C\nCMD [\"/usr/sbin/apache2\", \"-D\", \"FOREGROUND\"]\n\n\n\n3.4. \u30c6\u30b9\u30c8\u306e\u4f5c\u6210\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u4f5c\u6210\u6e08\u307f\u306e spec \u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\ncommand\ncd ~/handson-serverspec\ncat spec/docker_dockerfile_spec.rb\n\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\noutput\nrequire \"serverspec\"\nrequire \"docker\"\n\ndescribe \"Dockerfile Check\" do\n  #\n  # \u6700\u521d\u306b\u4e00\u5ea6\u3060\u3051\u5b9f\u884c\u3055\u308c\u308b\n  #\n  before(:all) do\n    image = Docker::Image.build_from_dir('./docker/')\n    set :os, family: :debian\n    set :backend, :docker       # Serverspec \u306e Docker \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066\u30c6\u30b9\u30c8\n    set :docker_image, image.id\n  end\n\n  describe command(\"lsb_release -a\") do\n    its(:stdout) { should match /Ubuntu 14/ }\n  end\n\n  describe package(\"apache2\") do\n    it { should be_installed }\n  end\n\n  describe process(\"apache2\") do\n    it { should be_running }\n  end\n\n  describe port(80) do\n    it { should be_listening }\n  end\n\n  describe file(\"/var/www/html/index.html\") do\n    it { should exist }\n    its(:content) { should match /I love mentai.co/ }\n  end\n\nend\n\n\n\n3.5. \u30c6\u30b9\u30c8\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3002\uff08\u521d\u3081\u3066\u5b9f\u884c\u3059\u308b\u5834\u5408\u306b\u306f\u30b3\u30f3\u30c6\u30ca\u306e\u30d3\u30eb\u30c9\u304c\u8d70\u308b\u306e\u3067\u6642\u9593\u304c\u639b\u304b\u308b\u306e\u3067\u6c17\u9577\u306b\u5f85\u3064\uff09\n\ncommand\ncd ~/handson-serverspec\nbundle exec rspec spec/docker_dockerfile_spec.rb\n\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\noutput\nDockerfile Check\n  Command \"lsb_release -a\"\n    stdout\n      should match /Ubuntu 14/\n  Package \"apache2\"\n    should be installed\n  Process \"apache2\"\n    should be running\n  Port \"80\"\n    should be listening\n  File \"/var/www/html/index.html\"\n    should exist\n    content\n      should match /I love mentai.co/\n\nFinished in 0.4776 seconds (files took 0.35406 seconds to load)\n6 examples, 0 failures\n\n\n\n\n4. Infrataster \u30b5\u30a4\u30c8\u306e\u632f\u308b\u821e\u3044\u3092\u30c6\u30b9\u30c8\u3059\u308b\n\n4.1. Infrataster \u3068\u306f\n\nhttps://github.com/ryotarai/infrataster\n\u30a4\u30f3\u30d5\u30e9\u306e\u5916\u90e8\u304b\u3089\u5404\u7a2e\u30ea\u30bd\u30fc\u30b9\u306e\u632f\u308b\u821e\u3044\u3092\u30c6\u30b9\u30c8\u3059\u308b\u30c4\u30fc\u30eb\nWeb \u30b5\u30a4\u30c8\u3084 DNS \u30af\u30a8\u30ea\u3001Redis \u3084 memcacned \u306e\u632f\u308b\u821e\u3044\u3092\u30c6\u30b9\u30c8\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u308b\n\n\n4.2. \u8981\u4ef6\n\n\u524d\u306e\u30b9\u30c6\u30c3\u30d7\uff083. Docker \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066 Dockerfile \u3092\u30c6\u30b9\u30c8\u3059\u308b\uff09\u3055\u4f5c\u6210\u3057\u305f Docker \u30b3\u30f3\u30c6\u30ca\u30b5\u30a4\u30c8\u306b\u5bfe\u3057\u3066\u4ee5\u4e0b\u3088\u3046\u306a\u30c6\u30b9\u30c8\u3092\u884c\u3044\u305f\u3044\u3002\n\nHTTP \u30ec\u30b9\u30dd\u30f3\u30b9\u30b3\u30fc\u30c9 200 \u304c\u8fd4\u3063\u3066\u304f\u308b\u3053\u3068\nHTTP \u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0 Content-Type \u306f text/html \u304c\u542b\u307e\u308c\u3066\u3044\u308b\u3053\u3068\nHTTP \u30ec\u30b9\u30dd\u30f3\u30b9\u30dc\u30c7\u30a3 \u306b I love menti.co \u304c\u542b\u307e\u308c\u3066\u3044\u308b\u3053\u3068\n\n\n4.3. \u30c6\u30b9\u30c8\u3092\u66f8\u304f\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u4f5c\u6210\u6e08\u307f\u306e spec \u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\ncommand\ncd ~/handson-serverspec\ncat spec/docker_site_spec.rb\n\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\nruby\nrequire \"infrataster/rspec\"\n\n#\n# Infrataster \u306e\u30c6\u30b9\u30c8\u3067\u5229\u7528\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u3092\u7528\u610f\u3059\u308b\u5b9a\u7fa9\n#  - \u30b3\u30f3\u30c6\u30ca\u3092\u30d3\u30eb\u30c9\u3059\u308b\n#  - \u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\uff08\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3057\u3066 start \u3059\u308b\uff09\n#  - \u30b3\u30f3\u30c6\u30ca\u306e IP \u30a2\u30c9\u30ec\u30b9\u3092\u53d6\u5f97\u3059\u308b\n#\nimage = Docker::Image.build_from_dir(\"./docker/\")\ncontainer = Docker::Container.create(\"Image\" => image.id)\ncontainer.start\nip = container.json[\"NetworkSettings\"][\"IPAddress\"]\n\n#\n# \u30c6\u30b9\u30c8\u306e\u6700\u5f8c\u306b\u5b9f\u884c\u3055\u308c\u308b\u51e6\u7406\u3092\u5b9a\u7fa9\n#  - \u30b3\u30f3\u30c6\u30ca\u3092\u524a\u9664\u3059\u308b\n#\nRSpec.configure do |config|\n  config.after(:suite) do\n    container.delete(:force => true)\n  end\nend\n\n#\n# Infrataster \u306e\u30b5\u30fc\u30d0\u30fc\u5b9a\u7fa9\n#\nInfrataster::Server.define(:docker) do |s|\n  s.address = ip\nend\n\n#\n# Infrataster \u306b\u3088\u308b\u30b5\u30a4\u30c8\u306e\u632f\u308b\u821e\u3044\u30c6\u30b9\u30c8\n#\ndescribe \"Site Check\" do\n\n  describe server(:docker) do\n    describe http(\"http://docker\") do\n      it \"responds as 'text/html'\" do\n        expect(response.headers['content-type']).to match(%r{^text/html})\n      end\n      it \"responds as '200'\" do\n        expect(response.status).to be 200\n      end\n      it \"responds as 'I love mentai.co'\" do\n        expect(response.body).to include(\"I love mentai.co\")\n      end\n    end\n  end\n\nend\n\n\n\n4.4. \u30c6\u30b9\u30c8\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3002\n\ncommand\ncd ~/handson-serverspec\nbundle exec rspec spec/docker_site_spec.rb\n\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\noutput\nSite Check\n  server 'docker'\n    http 'http://docker' with {:params=>{}, :method=>:get, :headers=>{}}\n      responds as 'text/html'\n      responds as '200'\n      responds as 'I love mentai.co'\n\nFinished in 0.0607 seconds (files took 0.6372 seconds to load)\n3 examples, 0 failures\n\n\n\n5.5. Dockerfile \u306e\u30c6\u30b9\u30c8\u3068\u4e00\u6c17\u901a\u8cab\u3067\u30c6\u30b9\u30c8\u3059\u308b\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3002\n\ncommand\ncd ~/handson-serverspec\nbundle exec rspec spec/docker_*_spec.rb\n\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\noutput\nSite Check\n  server 'docker'\n    http 'http://docker' with {:params=>{}, :method=>:get, :headers=>{}}\n      responds as 'text/html'\n      responds as '200'\n      responds as 'I love mentai.co'\n\nFinished in 0.0607 seconds (files took 0.6372 seconds to load)\n3 examples, 0 failures\n\nroot@(none):~/handson-serverspec# bundle exec rspec spec/docker_*_spec.rb\n\nDockerfile Check\n  Command \"lsb_release -a\"\n    stdout\n      should match /Ubuntu 14/\n  Package \"apache2\"\n    should be installed\n  Process \"apache2\"\n    should be running\n  Port \"80\"\n    should be listening\n  File \"/var/www/html/index.html\"\n    should exist\n    content\n      should match /I love mentai.co/\n\nSite Check\n  server 'docker'\n    http 'http://docker' with {:params=>{}, :method=>:get, :headers=>{}}\n      responds as 'text/html'\n      responds as '200'\n      responds as 'I love mentai.co'\n\nFinished in 0.53204 seconds (files took 0.78807 seconds to load)\n9 examples, 0 failures\n\n\n\n\n5. \u307e\u3068\u3081\n\n\u4eca\u65e5\u3084\u3063\u305f\u3053\u3068\n\n\u7c21\u5358\u306a spec \u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066\u30c6\u30b9\u30c8\nDocker \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066 Dockerfile \u306e\u30c6\u30b9\u30c8\nInfrataster \u3092\u5229\u7528\u3057\u3066 Web \u30b5\u30a4\u30c8\u306e\u632f\u308b\u821e\u3044\u3092\u30c6\u30b9\u30c8\n\n\n\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u5229\u7528\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u306e\u524a\u9664\n\n\u672c\u65e5\u4f5c\u6210\u3057\u305f\u4eee\u60f3\u30de\u30b7\u30f3\u306f\u30cf\u30f3\u30ba\u30aa\u30f3\u7d42\u4e86\u5f8c\u3001\u4e0d\u8981\u3067\u3042\u308c\u3070\u524a\u9664\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\n\n\n\u300cServerspec \u30cf\u30f3\u30ba\u30aa\u30f3\u8cc7\u6599\uff08Jenkins \u304a\u3058\u3055\u3093\u304a\u5c4a\u3051\u7de8\uff09\u300d\u306b\u7d9a\u304f...\n\n## \u30e1\u30cb\u30e5\u30fc\n\n### \u672c\u30cf\u30f3\u30ba\u30aa\u30f3\u306e\u30b4\u30fc\u30eb\n\n- Serverspec \u3067\u63d0\u4f9b\u3055\u308c\u308b\u5404\u7a2e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092\u8a66\u3057\u3066\u307f\u307e\u3059\n- Docker \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066 Dockerfile \u306e\u30c6\u30b9\u30c8\u3092\u4f5c\u6210\u3057\u3001\u30c6\u30b9\u30c8\u3092\u884c\u3044\u307e\u3059\n- Infrataster \u3092\u5229\u7528\u3057\u3066 Web \u30b5\u30a4\u30c8\u306e\u632f\u308b\u821e\u3044\u306e\u30c6\u30b9\u30c8\u3092\u884c\u3044\u307e\u3059\n- \u304a\u307e\u3051\u3067 Jenkins \u3092\u5229\u7528\u3057\u3066\u30c6\u30b9\u30c8\u3001Docker Hub \u3078\u306e\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u306e\u81ea\u52d5\u5316\u3082\u884c\u3044\u307e\u3059\n\n### \u6ce8\u610f\n\n- \u8cc7\u6599\u306e\u898b\u65b9\n- \u4e8b\u524d\u6e96\u5099\u306b\u3064\u3044\u3066\n- \u8cc7\u6599\u5185\u3067\u7d39\u4ecb\u3059\u308b\u5404\u7a2e\u30c4\u30fc\u30eb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u3064\u3044\u3066\n- \u5f8c\u7247\u4ed8\u3051\u306f\u3057\u3063\u304b\u308a\u3068\n\n### \u53c2\u8003\u8cc7\u6599\n\n- \u53c2\u8003 URL\n- \u53c2\u8003\u66f8\u7c4d\n- \u30cf\u30f3\u30ba\u30aa\u30f3\u8cc7\u6599\n- \u30cf\u30f3\u30ba\u30aa\u30f3\u6559\u6750\n\n### 2. \u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u306e\u66f8\u304d\u65b9\n\n2.1. Rspec \u3068\u306f\n2.2. spec_helper.rb\n2.3. Resouce Type\n2.4. \u30c6\u30b9\u30c8\u3092\u66f8\u3044\u3066\u307f\u3088\u3046\n\n### 3. Docker \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066 Dockerfile \u3092\u30c6\u30b9\u30c8\u3059\u308b\n\n3.1. \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3068\u306f\n3.2. \u8981\u4ef6\n3.3. \u30c6\u30b9\u30c8\u3092\u66f8\u304f\n3.4. \u521d\u3081\u3066\u306e\u30c6\u30b9\u30c8\n3.5. Dockerfile \u306e\u4f5c\u6210\n3.6. \u30c6\u30b9\u30c8\n\n### 4. Infrataster \u30b5\u30a4\u30c8\u306e\u632f\u308b\u821e\u3044\u3092\u30c6\u30b9\u30c8\u3059\u308b\n\n4.1. Infrataster \u3068\u306f\n4.2. Infrataster \u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n4.3. \u8981\u4ef6\n4.4. \u30c6\u30b9\u30c8\u3092\u66f8\u304f\n4.5. \u521d\u3081\u3066\u306e\u30c6\u30b9\u30c8\n4.6. \u30c6\u30b9\u30c8\n\n### 5. \u307e\u3068\u3081\n\n- \u4eca\u65e5\u3084\u3063\u305f\u3053\u3068\n- \u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u5229\u7528\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u306e\u524a\u9664\n\n***\n\n## \u672c\u30cf\u30f3\u30ba\u30aa\u30f3\u306e\u30b4\u30fc\u30eb\n\n- Serverspec \u3067\u63d0\u4f9b\u3055\u308c\u308b\u5404\u7a2e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092\u8a66\u3057\u3066\u307f\u307e\u3059\n- Docker \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066 Dockerfile \u306e\u30c6\u30b9\u30c8\u3092\u4f5c\u6210\u3057\u3001\u30c6\u30b9\u30c8\u3092\u884c\u3044\u307e\u3059\n- Infrataster \u3092\u5229\u7528\u3057\u3066 Web \u30b5\u30a4\u30c8\u306e\u632f\u308b\u821e\u3044\u306e\u30c6\u30b9\u30c8\u3092\u884c\u3044\u307e\u3059\n\n***\n\n## \u6ce8\u610f\n\n### \u8cc7\u6599\u306e\u898b\u65b9\n\n\u4ee5\u4e0b\u3001\u5b9f\u884c\u3059\u308b\u30b3\u30de\u30f3\u30c9\u306e\u8868\u793a\u3067\u3059\u3002\n\n~~~sh:command\n# \u30b3\u30e1\u30f3\u30c8\u3067\u3059\n\n# \u30cf\u30f3\u30ba\u30aa\u30f3\u5185\u3067\u5b9f\u884c\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3067\u3059\uff08\u30b3\u30d4\u30fc\uff06\u30da\u30fc\u30b9\u30c8\u3067\u8cbc\u308a\u4ed8\u3051\u3066\u5229\u7528\u3057\u3066\u4e0b\u3055\u3044\uff09\ncommand \"foo\" \"bar\"\n~~~\n\n\u4ee5\u4e0b\u3001\u51fa\u529b\u4f8b\u306e\u8868\u793a\u3067\u3059\u3002\n\n~~~sh:output\n# \u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u5f8c\u306e\u51fa\u529b\u4f8b\u3067\u3059\nfoo\nbar\n~~~\n\n\u4e0a\u8a18\u306b\u5b9f\u884c\u4f8b\u3068\u7570\u306a\u308b\u51fa\u529b\u3092\u78ba\u8a8d\u3057\u305f\u5834\u5408\u306b\u306f\u304a\u58f0\u304c\u3051\u4e0b\u3055\u3044\u3002\n\n### \u4e8b\u524d\u6e96\u5099\u306b\u3064\u3044\u3066\n\n- \u30cf\u30f3\u30ba\u30aa\u30f3\u3092\u5186\u6ed1\u306b\u9032\u3081\u308b\u306b\u3042\u305f\u3063\u3066\u4e8b\u524d\u6e96\u5099\u306f\u51fa\u6765\u308b\u3060\u3051\u884c\u3046\u3088\u3046\u306b\u3057\u3066\u4e0b\u3055\u3044\n\n### \u8cc7\u6599\u5185\u3067\u7d39\u4ecb\u3059\u308b\u5404\u7a2e\u30c4\u30fc\u30eb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u3064\u3044\u3066\n\n\u8cc7\u6599\u5185\u3067\u7d39\u4ecb\u3059\u308b\u5404\u7a2e\u30c4\u30fc\u30eb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\n- OS\n\n~~~sh:output\n$ lsb_release -a\nNo LSB modules are available.\nDistributor ID: Ubuntu\nDescription:    Ubuntu 14.04.4 LTS\nRelease:        14.04\nCodename:       trusty\n~~~\n\n- Ruby\n\n~~~sh:output\n$ ruby -v\nruby 2.3.1p112 (2016-04-26 revision 54768) [x86_64-linux]\n~~~\n\n- Serverspec\n\n~~~sh:output\n$ bundle exec gem list | grep serverspec\nserverspec (2.36.0)\n~~~\n\n- Infrataster\n\n~~~sh:output\n$ bundle exec gem list | grep infrataster\ninfrataster (0.3.2)\n~~~\n\n- Docker Engine\n\n~~~sh:output\n$ docker version\nClient:\n Version:      1.11.2\n API version:  1.23\n Go version:   go1.5.4\n Git commit:   b9f10c9\n Built:        Wed Jun  1 21:47:50 2016\n OS/Arch:      linux/amd64\n\nServer:\n Version:      1.11.2\n API version:  1.23\n Go version:   go1.5.4\n Git commit:   b9f10c9\n Built:        Wed Jun  1 21:47:50 2016\n OS/Arch:      linux/amd64\n~~~\n\n### \u5f8c\u7247\u4ed8\u3051\u306f\u3057\u3063\u304b\u308a\u3068\n\n\u672c\u65e5\u4f5c\u6210\u3057\u305f\u4eee\u60f3\u30de\u30b7\u30f3\u306f\u30cf\u30f3\u30ba\u30aa\u30f3\u7d42\u4e86\u5f8c\u3001\u4e0d\u8981\u3067\u3042\u308c\u3070\u524a\u9664\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n***\n\n## \u53c2\u8003\u8cc7\u6599\n\n### \u53c2\u8003 URL\n\n- http://serverspec.org/\n- http://web-k.github.io/blog/2012/09/27/rspec_basic/\n- http://qiita.com/jnchito/items/42193d066bd61c740612\n\n### \u53c2\u8003\u66f8\u7c4d\n\n- http://www.oreilly.co.jp/books/9784873117096/\n\n### \u30cf\u30f3\u30ba\u30aa\u30f3\u8cc7\u6599\n\n- [Serverspec \u30cf\u30f3\u30ba\u30aa\u30f3\u8cc7\u6599\uff08\u4e8b\u524d\u6e96\u5099\u7de8\uff09](http://qiita.com/inokappa/private/43bb47745b3565b9b69f)\n- [Serverspec \u30cf\u30f3\u30ba\u30aa\u30f3\u8cc7\u6599\uff08\u5b9f\u8df5\u7de8\uff09\n](http://qiita.com/inokappa/private/f96c0939331b24236bc0)\u203b\u672c\u8cc7\u6599\u3067\u3059\n- [Serverspec \u30cf\u30f3\u30ba\u30aa\u30f3\u8cc7\u6599\uff08Jenkins \u304a\u3058\u3055\u3093\u304a\u5c4a\u3051\u7de8\uff09](http://qiita.com/inokappa/private/f9f624ec5ea01937b840)\n\n### \u30cf\u30f3\u30ba\u30aa\u30f3\u6559\u6750\n\n- https://github.com/inokappa/handson-serverspec\n\n***\n\n## 2. \u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u306e\u66f8\u304d\u65b9\n\n### 2.1. Rspec\uff08Serverspec \u3092\u59cb\u3081\u308b\u3042\u305f\u3063\u3066\u77e5\u3063\u3066\u304a\u304d\u305f\u3044 Rspec \u306e\u5165\u308a\u53e3\u306e\u5165\u308a\u53e3\uff09\n\n#### 2.1.1. Rspec \u3068\u306f\n\n- Ruby \u3067\u5b9f\u88c5\u3055\u308c\u305f\u30dd\u30d4\u30e5\u30e9\u30fc\u306a\u30c6\u30b9\u30c8\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\uff08\u4ed6\u306b\u306f Test::Unit \u3068\u3044\u3046\u6a19\u6e96\u3067\u7d44\u307f\u8fbc\u307e\u308c\u3066\u3044\u308b\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3082\u3042\u308b\uff09\n- \u82f1\u8a9e\u3063\u307d\u304f\u30c6\u30b9\u30c8\u3092\u66f8\u304f\u3053\u3068\u304c\u51fa\u6765\u308b\n\n#### 2.1.2. Rspec \u306e\u57fa\u672c\n\n- \u30c6\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092 spec \u30d5\u30a1\u30a4\u30eb\u3068\u547c\u3076\n- it \u3067\u59cb\u3081\u308b\u90e8\u5206\u304c example\uff08\u30c6\u30b9\u30c8\uff09\u3068\u306a\u308b\n- describe do ~ end \u3067\u56f2\u307e\u308c\u305f\u90e8\u5206\u3092 example \u30b0\u30eb\u30fc\u30d7\u3068\u547c\u3076\n- \u671f\u5f85\u5024\u3068\u5b9f\u969b\u306e\u5024\u3092\u6bd4\u8f03\u3057\u305f\u7d50\u679c\u3092\u304b\u3048\u3059\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u30de\u30c3\u30c1\u30e3\uff08\u62b9\u8336\u3067\u306f\u306a\u3044\uff09\u3068\u547c\u3076\n\n#### 2.1.3. spec \u30d5\u30a1\u30a4\u30eb\u4f8b\n\nServerspec \u3067\u5229\u7528\u3059\u308b spec \u30d5\u30a1\u30a4\u30eb\u306e\u4f8b\u3002\n\n~~~ruby:example_spec.rb\n# example \u30b0\u30eb\u30fc\u30d7\ndescribe package('httpd') do\n  # example\n  # - should = \u3079\u304d\u3067\u3042\u308b\n  # - be_installed = \u30de\u30c3\u30c1\u30e3\n  it { should be_installed }\nend\n\n# \u65e5\u672c\u8a9e\u306b\u8a33\u3059\u3068\n# \u30d1\u30c3\u30b1\u30fc\u30b8 \"httpd\" \u306b\u3064\u3044\u3066\n#   \u305d\u308c\u306f(it)\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b(be_installed)\u3079\u304d(should)\n# \u3067\u3042\u308b\n\n# example \u30b0\u30eb\u30fc\u30d7\ndescribe command('ls -al /') do\n  # example\n  # - match = \u30de\u30c3\u30c1\u30e3\n  its(:stdout) { should match /bin/ }\nend\n\n# \u65e5\u672c\u8a9e\u306b\u8a33\u3059\u3068\n# \u30b3\u30de\u30f3\u30c9 \"ls -al /\" \u306b\u3064\u3044\u3066\n#   \u305d\u306e\u51fa\u529b(its(:stdout))\u306f \"bin\" \u306b\u30de\u30c3\u30c1(match)\u3067\u3059\u308b\u3079\u304d(should)\n# \u3067\u3042\u308b\n~~~\n\n\u203b `should` \u306e\u90e8\u5206\u3092 `expect`\uff08\u3044\u304f\u3059\u307a\u304f\u3068\uff09\u30e1\u30bd\u30c3\u30c9\u306b\u7f6e\u304d\u63db\u3048\u308b\u3053\u3068\u304c\u51fa\u6765\u308b\u304c\u3001\u672c\u8cc7\u6599\u3067\u306f `should` \u30e1\u30bd\u30c3\u30c9\u3092\u5229\u7528\u3059\u308b\n\n### 2.2. spec_helper.rb\n\nRspec \u306e\u6319\u52d5\u3092\u5236\u5fa1\u3059\u308b\u70ba\u306b\u5229\u7528\u3055\u308c\u308b\u30d5\u30a1\u30a4\u30eb\u3067 Serverspec \u3067\u3082\u5229\u7528\u3055\u308c\u308b\u3002Serverspec \u3067\u306f `serverspec-init` \u3092\u5b9f\u884c\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5185\u5bb9\u3068\u306a\u3063\u3066\u3044\u308b\u3002\uff08\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092 `Exec` \u3092\u9078\u629e\u3057\u305f\u5834\u5408\uff09\n\n~~~ruby:spec_helper.rb\nrequire 'serverspec'\n\nset :backend, :exec\n~~~\n\n### 2.3. \u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7\n\n- \u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7 = \u30c6\u30b9\u30c8\u5bfe\u8c61\u306e\u7a2e\u985e\n- \u30ea\u30bd\u30fc\u30b9 = \u30c6\u30b9\u30c8\u5bfe\u8c61\n\n~~~ruby:example_spec.rb\n# interface \u304c\u30c6\u30b9\u30c8\u5bfe\u8c61\u3068\u306a\u308b\u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7\n# interface('eth0') \u304c\u30c6\u30b9\u30c8\u5bfe\u8c61\u3068\u306a\u308b\u30ea\u30bd\u30fc\u30b9\ndescribe interface('eth0') do\n  its(:speed) { should eq 1000 }\nend\n~~~\n\nServerspec \u3067\u6271\u3048\u308b\u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7\u306b\u3064\u3044\u3066\u306f\u3001\u4ee5\u4e0b\u306e URL \u306b\u63b2\u8f09\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u78ba\u8a8d\u3059\u308b\u3002\n\n- http://serverspec.org/resource_types.html\n\n### 2.4. \u30c6\u30b9\u30c8\u3092\u66f8\u3044\u3066\u307f\u3088\u3046\n\n#### 2.4.1. \u30c6\u30b9\u30c8\u8981\u4ef6\n\n![2016062502.png](https://qiita-image-store.s3.amazonaws.com/0/87189/7b516679-65ef-1376-ec2d-5daaa2c68df2.png \"2016062502.png\")\n\n- OS \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f Ubuntu 14.04 \u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n- docker-engine \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n- docker-engine \u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b \n- docker \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\u3059\u308b\n- Ruby \u3084 servespec \u3084 infrataster \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n\n#### 2.4.2. serverspec-init\n\n`serverspec-init` \u3092\u5b9f\u884c\u3059\u308b\u3068\u30c6\u30b9\u30c8\u306b\u5fc5\u8981\u306a\u5404\u7a2e\u30d5\u30a1\u30a4\u30eb\u3084 spec \u30d5\u30a1\u30a4\u30eb\u306e\u96db\u5f62\u3092\u751f\u6210\u3055\u308c\u308b\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b `serverspec-init` \u3092\u5b9f\u884c\u3059\u308b\u3002\n\n~~~sh:command\ncd ~/handson-serverspec/\nmkdir first_test\ncd first_test\nbundle exec serverspec-init\n~~~\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b spec \u30d5\u30a1\u30a4\u30eb\u306e\u96db\u5f62\u3084 spec_helper.rb \u3084 Rakefile \u3092\u751f\u6210\u3055\u308c\u308b\u3002\uff08`OS type` \u3068 `backend type` \u3092\u9078\u629e\u3059\u308b\uff09\n\n~~~sh:output\nSelect OS type:\n\n  1) UN*X\n  2) Windows\n\nSelect number: 1 #=> 1 \u3092\u9078\u629e\n\nSelect a backend type:\n\n  1) SSH\n  2) Exec (local)\n\nSelect number: 2 #=> 2 \u3092\u9078\u629e\n\n + spec/\n + spec/localhost/\n + spec/localhost/sample_spec.rb\n + spec/spec_helper.rb\n + Rakefile\n + .rspec\n~~~\n\n#### 2.4.3. \u30c6\u30b9\u30c8\u3092\u66f8\u304f\n\n\u30c6\u30b9\u30c8\u8981\u4ef6\u306b\u57fa\u3044\u3066\u3001sample_spec.rb \u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u308b\u3002\n\n~~~ruby:spec/localhost/sample_spec.rb\nrequire 'spec_helper'\n\ndescribe \"OS \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f Ubuntu 14.04 \u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\" do\n  describe command(\"lsb_release -a\") do\n    its(:stdout) { should match /Ubuntu 14.04/ }\n  end\nend\n\ndescribe \"docker-engine \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\" do\n  describe package('docker-engine'), :if => os[:family] == 'ubuntu' do\n    it { should be_installed }\n  end\nend\n\ndescribe \"docker-engine \u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068 / docker \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\u3059\u308b\" do\n  describe service('docker'), :if => os[:family] == 'ubuntu' do\n    it { should be_running }\n  end\n  describe command(\"docker version\") do\n    its(:stdout) { should match /1.11.2/ }\n  end\nend\n\ndescribe \"Ruby \u3084 servespec / infrataster \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\" do\n  it \"\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b Ruby \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f 2.3.1 \u3067\u3042\u308b\" do\n    expect(check_ruby_version).to include(\"2.3.1\")\n  end\n\n  it \"Serverspec \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\" do\n    expect(check_packages(\"serverspec\")).to include(\"serverspec\")\n  end\n\n  it \"Infrataster \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\" do\n    expect(check_packages(\"infrataster\")).to include(\"infrataster\")\n  end\n\n  def check_ruby_version\n    command(\"ruby -v\").stdout\n  end\n\n  def check_packages(package)\n    command(\"bundle exec gem list | grep #{package}\").stdout\n  end\n\nend\n~~~\n\n#### 2.4.4. \u30c6\u30b9\u30c8\u5b9f\u884c\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n~~~sh:command\nbundle exec rake\n~~~\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n~~~sh:output\n(snip)\n\nOS \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f Ubuntu 14.04 \u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n  Command \"lsb_release -a\"\n    stdout\n      should match /Ubuntu 14.04/\n\ndocker-engine \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n  Package \"docker-engine\"\n    should be installed\n\ndocker-engine \u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068 / docker \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\u3059\u308b\n  Service \"docker\"\n    should be running  Command \"docker version\"    stdout\n      should match /1.11.2/\n\nRuby \u3084 servespec / infrataster \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n  \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b Ruby \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f 2.3.1 \u3067\u3042\u308b\n  Serverspec \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\n  Infrataster \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\n\nFinished in 0.68314 seconds (files took 0.31922 seconds to load)\n7 examples, 0 failures\n~~~\n\n\u5b9f\u969b\u306e\u51fa\u529b\u753b\u9762\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u308b\u3002\n\n![2016062501.png](https://qiita-image-store.s3.amazonaws.com/0/87189/2a40ad28-46d9-d878-1128-8b1435a3b7df.png \"2016062501.png\")\n\n***\n\n## 3. Docker \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066 Dockerfile \u3092\u30c6\u30b9\u30c8\u3059\u308b\n\n### 3.1. \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3068\u306f\n\n#### 3.1.1. \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3068\u306f\n\n- Serverspec\uff08\u5b9f\u969b\u306b\u306f Specinfra\uff09\u3067\u306f\u6838\u3068\u306a\u308b\u90e8\u5206\n- \u3056\u3063\u304f\u308a\u8a00\u3046\u3068...\u5b9f\u884c\u5f62\u5f0f\u306e\u9055\u3044\u3092\u610f\u8b58\u3059\u308b\u3053\u3068\u306a\u304f\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u308b\u30ec\u30a4\u30e4\u30fc\n- \u30c6\u30b9\u30c8\u5bfe\u8c61\u30db\u30b9\u30c8 OS \u306b\u5fdc\u3058\u305f\u30b3\u30de\u30f3\u30c9\u3092\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306b\u5fdc\u3058\u305f\u5b9f\u884c\u5f62\u5f0f\u3067\u5b9f\u884c\u3059\u308b\n\n#### 3.1.2. \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306e\u7a2e\u985e\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u304c\u5229\u7528\u51fa\u6765\u308b\u3002\n\n- exec\n- ssh\n- powershell\n- cmd\n- docker\n- lxc\n- winrm\n- shell_script\n- dockerfile\n- telnet\n\n### 3.2. \u8981\u4ef6\n\n![2016061905.png](https://qiita-image-store.s3.amazonaws.com/0/87189/87a5ac2f-990c-d42e-11eb-97b9107e0e42.png \"2016061905.png\")\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8981\u4ef6\u306e Docker \u30b3\u30f3\u30c6\u30ca\u4f5c\u3063\u3066\u30c6\u30b9\u30c8\u3057\u305f\u3044\u3002\n\n- Web \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b3\u30f3\u30c6\u30ca\n- Web \u30b5\u30fc\u30d0\u30fc\u306f Apache\n- \u30b3\u30f3\u30c6\u30f3\u30c4\u306f\u9759\u7684\u306a index.html \u4e00\u679a\n\n### 3.3. Dockerfile \u306e\u4f5c\u6210\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u4f5c\u6210\u6e08\u307f\u306e Dockerfile \u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n~~~sh:command\ncd ~/handson-serverspec\ncat docker/Dockerfile\n~~~\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n~~~sh:output\nFROM ubuntu:14.04\nRUN apt-get update && \\\n    apt-get install -y apache2 && \\\n    mkdir /var/run/apache2 && \\\n    mkdir /var/lock/apache2\nADD index.html /var/www/html/\nEXPOSE 80\nenv APACHE_RUN_USER    www-data\nenv APACHE_RUN_GROUP   www-data\nenv APACHE_PID_FILE    /var/run/apache2.pid\nenv APACHE_RUN_DIR     /var/run/apache2\nenv APACHE_LOCK_DIR    /var/lock/apache2\nenv APACHE_LOG_DIR     /var/log/apache2\nenv LANG               C\nCMD [\"/usr/sbin/apache2\", \"-D\", \"FOREGROUND\"]\n~~~\n\n### 3.4. \u30c6\u30b9\u30c8\u306e\u4f5c\u6210\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u4f5c\u6210\u6e08\u307f\u306e spec \u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n~~~sh:command\ncd ~/handson-serverspec\ncat spec/docker_dockerfile_spec.rb\n~~~\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n~~~ruby:output\nrequire \"serverspec\"\nrequire \"docker\"\n\ndescribe \"Dockerfile Check\" do\n  #\n  # \u6700\u521d\u306b\u4e00\u5ea6\u3060\u3051\u5b9f\u884c\u3055\u308c\u308b\n  #\n  before(:all) do\n    image = Docker::Image.build_from_dir('./docker/')\n    set :os, family: :debian\n    set :backend, :docker       # Serverspec \u306e Docker \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066\u30c6\u30b9\u30c8\n    set :docker_image, image.id\n  end\n\n  describe command(\"lsb_release -a\") do\n    its(:stdout) { should match /Ubuntu 14/ }\n  end\n\n  describe package(\"apache2\") do\n    it { should be_installed }\n  end\n\n  describe process(\"apache2\") do\n    it { should be_running }\n  end\n\n  describe port(80) do\n    it { should be_listening }\n  end\n\n  describe file(\"/var/www/html/index.html\") do\n    it { should exist }\n    its(:content) { should match /I love mentai.co/ }\n  end\n\nend\n~~~\n\n### 3.5. \u30c6\u30b9\u30c8\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3002\uff08\u521d\u3081\u3066\u5b9f\u884c\u3059\u308b\u5834\u5408\u306b\u306f\u30b3\u30f3\u30c6\u30ca\u306e\u30d3\u30eb\u30c9\u304c\u8d70\u308b\u306e\u3067\u6642\u9593\u304c\u639b\u304b\u308b\u306e\u3067\u6c17\u9577\u306b\u5f85\u3064\uff09\n\n~~~sh:command\ncd ~/handson-serverspec\nbundle exec rspec spec/docker_dockerfile_spec.rb\n~~~\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n~~~sh:output\nDockerfile Check\n  Command \"lsb_release -a\"\n    stdout\n      should match /Ubuntu 14/\n  Package \"apache2\"\n    should be installed\n  Process \"apache2\"\n    should be running\n  Port \"80\"\n    should be listening\n  File \"/var/www/html/index.html\"\n    should exist\n    content\n      should match /I love mentai.co/\n\nFinished in 0.4776 seconds (files took 0.35406 seconds to load)\n6 examples, 0 failures\n~~~\n\n***\n\n## 4. Infrataster \u30b5\u30a4\u30c8\u306e\u632f\u308b\u821e\u3044\u3092\u30c6\u30b9\u30c8\u3059\u308b\n\n### 4.1. Infrataster \u3068\u306f\n\n- https://github.com/ryotarai/infrataster\n- \u30a4\u30f3\u30d5\u30e9\u306e\u5916\u90e8\u304b\u3089\u5404\u7a2e\u30ea\u30bd\u30fc\u30b9\u306e\u632f\u308b\u821e\u3044\u3092\u30c6\u30b9\u30c8\u3059\u308b\u30c4\u30fc\u30eb\n- Web \u30b5\u30a4\u30c8\u3084 DNS \u30af\u30a8\u30ea\u3001Redis \u3084 memcacned \u306e\u632f\u308b\u821e\u3044\u3092\u30c6\u30b9\u30c8\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u308b\n\n### 4.2. \u8981\u4ef6\n\n![2016061906.png](https://qiita-image-store.s3.amazonaws.com/0/87189/9863aba5-45fe-b5a6-5119-559b819008ad.png \"2016061906.png\")\n\n\u524d\u306e\u30b9\u30c6\u30c3\u30d7\uff083. Docker \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066 Dockerfile \u3092\u30c6\u30b9\u30c8\u3059\u308b\uff09\u3055\u4f5c\u6210\u3057\u305f Docker \u30b3\u30f3\u30c6\u30ca\u30b5\u30a4\u30c8\u306b\u5bfe\u3057\u3066\u4ee5\u4e0b\u3088\u3046\u306a\u30c6\u30b9\u30c8\u3092\u884c\u3044\u305f\u3044\u3002\n\n- HTTP \u30ec\u30b9\u30dd\u30f3\u30b9\u30b3\u30fc\u30c9 200 \u304c\u8fd4\u3063\u3066\u304f\u308b\u3053\u3068\n- HTTP \u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0 `Content-Type` \u306f `text/html` \u304c\u542b\u307e\u308c\u3066\u3044\u308b\u3053\u3068\n- HTTP \u30ec\u30b9\u30dd\u30f3\u30b9\u30dc\u30c7\u30a3 \u306b `I love menti.co` \u304c\u542b\u307e\u308c\u3066\u3044\u308b\u3053\u3068\n\n### 4.3. \u30c6\u30b9\u30c8\u3092\u66f8\u304f\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u4f5c\u6210\u6e08\u307f\u306e spec \u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n~~~sh:command\ncd ~/handson-serverspec\ncat spec/docker_site_spec.rb\n~~~\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n~~~sh:ruby\nrequire \"infrataster/rspec\"\n\n#\n# Infrataster \u306e\u30c6\u30b9\u30c8\u3067\u5229\u7528\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u3092\u7528\u610f\u3059\u308b\u5b9a\u7fa9\n#  - \u30b3\u30f3\u30c6\u30ca\u3092\u30d3\u30eb\u30c9\u3059\u308b\n#  - \u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\uff08\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3057\u3066 start \u3059\u308b\uff09\n#  - \u30b3\u30f3\u30c6\u30ca\u306e IP \u30a2\u30c9\u30ec\u30b9\u3092\u53d6\u5f97\u3059\u308b\n#\nimage = Docker::Image.build_from_dir(\"./docker/\")\ncontainer = Docker::Container.create(\"Image\" => image.id)\ncontainer.start\nip = container.json[\"NetworkSettings\"][\"IPAddress\"]\n\n#\n# \u30c6\u30b9\u30c8\u306e\u6700\u5f8c\u306b\u5b9f\u884c\u3055\u308c\u308b\u51e6\u7406\u3092\u5b9a\u7fa9\n#  - \u30b3\u30f3\u30c6\u30ca\u3092\u524a\u9664\u3059\u308b\n#\nRSpec.configure do |config|\n  config.after(:suite) do\n    container.delete(:force => true)\n  end\nend\n\n#\n# Infrataster \u306e\u30b5\u30fc\u30d0\u30fc\u5b9a\u7fa9\n#\nInfrataster::Server.define(:docker) do |s|\n  s.address = ip\nend\n\n#\n# Infrataster \u306b\u3088\u308b\u30b5\u30a4\u30c8\u306e\u632f\u308b\u821e\u3044\u30c6\u30b9\u30c8\n#\ndescribe \"Site Check\" do\n\n  describe server(:docker) do\n    describe http(\"http://docker\") do\n      it \"responds as 'text/html'\" do\n        expect(response.headers['content-type']).to match(%r{^text/html})\n      end\n      it \"responds as '200'\" do\n        expect(response.status).to be 200\n      end\n      it \"responds as 'I love mentai.co'\" do\n        expect(response.body).to include(\"I love mentai.co\")\n      end\n    end\n  end\n\nend\n~~~\n\n### 4.4. \u30c6\u30b9\u30c8\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n~~~sh:command\ncd ~/handson-serverspec\nbundle exec rspec spec/docker_site_spec.rb\n~~~\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n~~~sh:output\nSite Check\n  server 'docker'\n    http 'http://docker' with {:params=>{}, :method=>:get, :headers=>{}}\n      responds as 'text/html'\n      responds as '200'\n      responds as 'I love mentai.co'\n\nFinished in 0.0607 seconds (files took 0.6372 seconds to load)\n3 examples, 0 failures\n~~~\n\n### 5.5. Dockerfile \u306e\u30c6\u30b9\u30c8\u3068\u4e00\u6c17\u901a\u8cab\u3067\u30c6\u30b9\u30c8\u3059\u308b\n\n![2016061907.png](https://qiita-image-store.s3.amazonaws.com/0/87189/ffd9d160-d0e7-ad07-fe82-4f6f0b5881b9.png \"2016061907.png\")\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n~~~sh:command\ncd ~/handson-serverspec\nbundle exec rspec spec/docker_*_spec.rb\n~~~\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n~~~sh:output\nSite Check\n  server 'docker'\n    http 'http://docker' with {:params=>{}, :method=>:get, :headers=>{}}\n      responds as 'text/html'\n      responds as '200'\n      responds as 'I love mentai.co'\n\nFinished in 0.0607 seconds (files took 0.6372 seconds to load)\n3 examples, 0 failures\n\nroot@(none):~/handson-serverspec# bundle exec rspec spec/docker_*_spec.rb\n\nDockerfile Check\n  Command \"lsb_release -a\"\n    stdout\n      should match /Ubuntu 14/\n  Package \"apache2\"\n    should be installed\n  Process \"apache2\"\n    should be running\n  Port \"80\"\n    should be listening\n  File \"/var/www/html/index.html\"\n    should exist\n    content\n      should match /I love mentai.co/\n\nSite Check\n  server 'docker'\n    http 'http://docker' with {:params=>{}, :method=>:get, :headers=>{}}\n      responds as 'text/html'\n      responds as '200'\n      responds as 'I love mentai.co'\n\nFinished in 0.53204 seconds (files took 0.78807 seconds to load)\n9 examples, 0 failures\n~~~\n\n***\n\n## 5. \u307e\u3068\u3081\n\n### \u4eca\u65e5\u3084\u3063\u305f\u3053\u3068\n\n- \u7c21\u5358\u306a spec \u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066\u30c6\u30b9\u30c8\n- Docker \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066 Dockerfile \u306e\u30c6\u30b9\u30c8\n- Infrataster \u3092\u5229\u7528\u3057\u3066 Web \u30b5\u30a4\u30c8\u306e\u632f\u308b\u821e\u3044\u3092\u30c6\u30b9\u30c8\n\n### \u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u5229\u7528\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u306e\u524a\u9664\n\n- \u672c\u65e5\u4f5c\u6210\u3057\u305f\u4eee\u60f3\u30de\u30b7\u30f3\u306f\u30cf\u30f3\u30ba\u30aa\u30f3\u7d42\u4e86\u5f8c\u3001\u4e0d\u8981\u3067\u3042\u308c\u3070\u524a\u9664\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\n\n***\n\n\u300c[Serverspec \u30cf\u30f3\u30ba\u30aa\u30f3\u8cc7\u6599\uff08Jenkins \u304a\u3058\u3055\u3093\u304a\u5c4a\u3051\u7de8\uff09](http://qiita.com/inokappa/items/f9f624ec5ea01937b840)\u300d\u306b\u7d9a\u304f...\n", "tags": ["\u30cf\u30f3\u30ba\u30aa\u30f3", "specinfra", "Infrataster", "serverspec"]}