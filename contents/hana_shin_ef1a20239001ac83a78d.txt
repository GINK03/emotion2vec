{"context": "\n\n1 \u30b3\u30de\u30f3\u30c9\u4e00\u89a7(kubernetes 1.2)\n\n\u4ee5\u4e0b\u306f\u3001man kubectl\u304b\u3089\u629c\u7c8b\u3057\u305f\u3082\u306e\u3002\n\n\nkubectl get\n\nkubectl describe\n\nkubectl create\n\nkubectl create namespace\n\nkubectl create secret\n\nkubectl create secret docker-registry\n\nkubectl create secret generic\n\nkubectl create configmap\n\nkubectl create serviceaccount\n\nkubectl replace\n\nkubectl patch\n\nkubectl delete\n\nkubectl edit\n\nkubectl apply\n\nkubectl namespace\n\nkubectl logs\n\nkubectl rolling-update\n\nkubectl scale\n\nkubectl cordon\n\nkubectl drain\n\nkubectl uncordon\n\nkubectl attach\n\nkubectl exec\n\nkubectl port-forward\n\nkubectl proxy\n\nkubectl run\n\nkubectl stop\n\nkubectl expose\n\nkubectl autoscale\n\nkubectl rollout\n\nkubectl rollout history\n\nkubectl rollout undo\n\nkubectl rollout pause\n\nkubectl rollout resume\n\nkubectl label\n\nkubectl annotate\n\nkubectl config\n\nkubectl config view\n\nkubectl config set-cluster\n\nkubectl config set-credentials\n\nkubectl config set-context\n\nkubectl config set\n\nkubectl config unset\n\nkubectl config current-context\n\nkubectl config use-context\n\nkubectl cluster-info\n\nkubectl api-versions\n\nkubectl version\n\nkubectl explain\n\nkubectl convert\n\n\n2 \u691c\u8a3c\u74b0\u5883\n\nmaster,node1\u306e2\u53f0\u69cb\u6210\u3002master,node1\u306f\u30db\u30b9\u30c8\u540d.\nVMware Player\u4e0a\u3067\u52d5\u4f5c\u3059\u308b\u4eee\u60f3\u30de\u30b7\u30f3\u3002OS\u306fCentOS7.2\u3002\n\n+--- master ---+    +---- node1 ---+\n|              |    |              |\n|   CentOS7.2  |    |   CentOS7.2  |\n|              |    |              |\n+--------------+    +--------------+\n+----------------------------------+\n|            VMware Player         |\n+----------------------------------+\n\n\n3 \u30b3\u30de\u30f3\u30c9\u306e\u4f7f\u3044\u65b9\n\n3.1 \u4e8b\u524d\u6e96\u5099\nbash-completion\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5c0e\u5165\u3059\u308b\u3053\u3068\u3067\u3001kubectl\u30b3\u30de\u30f3\u30c9\u3067TAB\u88dc\u5b8c\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\uff08\u4fbf\u5229\u306b\u306a\u308b\uff09\u3002\n[root@master ~]# yum -y epel-release\n[root@master ~]# yum -y bash-completion\n\nkubectl\u3068\u30bf\u30a4\u30d7\u3057\u305f\u3042\u3068\u3001\"TAB\"\u3092\u62bc\u4e0b\u3059\u308b\u3068\u3001\u4e0b\u8a18\u306e\u30b5\u30d6\u30b3\u30de\u30f3\u30c9\u4e00\u89a7\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n[root@master ~]# kubectl\nannotate        autoscale       cordon          drain           expose          namespace       replace         scale\napi-versions    cluster-info    create          edit            get             patch           rolling-update  uncordon\napply           config          delete          exec            label           port-forward    rollout         version\nattach          convert         describe        explain         logs            proxy           run\n[root@master ~]# kubectl\n\n\n3.2 kubectl run/kubectl get/kubectl delete\n-----------------------------------------\n1. Pod\u30921\u3064\u8d77\u52d5\u3059\u308b\u65b9\u6cd5\n-----------------------------------------\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002run\u306b\u6307\u5b9a\u3059\u308b\u6587\u5b57\u5217\uff08\u4e0b\u8a18\u4f8b\u306fnginx)\u306f\u4efb\u610f\u3067\u3059\u3002\n[root@master ~]# kubectl run nginx --image=nginx\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-2040093540-lw9zo   1/1       Running   0          22s\n\nPod\u304c\u3069\u306e\u30db\u30b9\u30c8(\u30de\u30b9\u30bf\u3001\u307e\u305f\u306f\u30ce\u30fc\u30c9\uff09\u3067\u52d5\u3044\u3066\u308b\u306e\u304b\u3092\u78ba\u8a8d\u3059\u308b\u3002-o wide\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b\u3002Pod\u304cmaster\u3067\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod -o wide\nNAME                     READY     STATUS    RESTARTS   AGE       NODE\nnginx-2040093540-lw9zo   1/1       Running   0          28s       master\n\nDeployment\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get deployment\nNAME      DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\nnginx     1         1         1            1           8m\n\nPod\u3092\u7d42\u4e86\u3059\u308b\u3002Pod\u306e\u540d\u524d\u3067\u306f\u306a\u304f\u3001Deployment\u306e\u540d\u524d\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3002\n[root@master ~]# kubectl delete deployment nginx\ndeployment \"nginx\" deleted\n[root@master ~]# kubectl get pod\n[root@master ~]#\n\n-----------------------------------------\n2. Pod\u3092\u8907\u6570\u8d77\u52d5\u3059\u308b\u65b9\u6cd5(--replicas)\n-----------------------------------------\nPod\u30922\u3064\u8d77\u52d5\u3059\u308b\u3002\"--replicas=2\"\u3092\u6307\u5b9a\u3059\u308b\u3002\n[root@master ~]# kubectl run nginx --image=nginx --replicas=2\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002Pod\u304c2\u3064\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod -o wide\nNAME                     READY     STATUS    RESTARTS   AGE       NODE\nnginx-2040093540-5932k   1/1       Running   0          27s       master\nnginx-2040093540-mpnrw   1/1       Running   0          27s       master\n\nPod\u3092\u7d42\u4e86\u3059\u308b\u3002\n[root@master ~]# kubectl delete deployment nginx\ndeployment \"nginx\" deleted\n[root@master ~]# kubectl get pod\n[root@master ~]#\n\n-----------------------------------------\n3\uff0ePod\u306b\u74b0\u5883\u5909\u6570\u3092\u6e21\u3059\u65b9\u6cd5(--env)\n-----------------------------------------\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl run nginx --image=nginx --env=\"TEST=test1\"\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-3180491960-163ut   1/1       Running   0          31s\n\nPod\u3067bash\u3092\u5b9f\u884c\u3059\u308b\u3002\n[root@master ~]# kubectl exec nginx-3180491960-163ut -it bash\n\n\u74b0\u5883\u5909\u6570\u3092\u8868\u793a\u3059\u308b\u3002\nroot@nginx-3180491960-163ut:/# echo $TEST\ntest1\n\nroot@nginx-3180491960-163ut:/# exit\nexit\n\n-----------------------------------------\n4\uff0ePod\u306b\u30e9\u30d9\u30eb\u3092\u4ed8\u3051\u308b\u65b9\u6cd5(--labels)\n-----------------------------------------\nPod\u306b\"os=linux\"\u3068\u3044\u3046\u30e9\u30d9\u30eb\u3092\u3064\u3051\u3066\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl run nginx --image=nginx --labels=\"os=linux\"\ndeployment \"nginx\" created\n\n\u30e9\u30d9\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u3002\"os=linux\"\u3068\u3044\u3046\u30e9\u30d9\u30eb\u304c\u4ed8\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod --show-labels\nNAME                     READY     STATUS    RESTARTS   AGE       LABELS\nnginx-3952892669-fmqbt   1/1       Running   0          15s       os=linux,pod-template-hash=3952892669\n\n\u9055\u3046\u30e9\u30d9\u30eb\u3092\u6301\u3063\u305fPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl run nginx1 --image=nginx --labels=\"os=windows\"\ndeployment \"nginx1\" created\n\n\u30e9\u30d9\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30e9\u30d9\u30eb\u304c\u4ed8\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod --show-labels\nNAME                      READY     STATUS    RESTARTS   AGE       LABELS\nnginx-3952892669-fmqbt    1/1       Running   0          4m        os=linux,pod-template-hash=3952892669\nnginx1-3838991369-1yuur   1/1       Running   0          14s       os=windows,pod-template-hash=3838991369\n\n\u30ad\u30fc\u304c\"os\"\u306e\u3082\u306e\u3060\u3051\u3092\u8868\u793a\u3059\u308b\u3002\n[root@master ~]# kubectl get pod -L os\nNAME                      READY     STATUS    RESTARTS   AGE       OS\nnginx-3952892669-fmqbt    1/1       Running   0          5m        linux\nnginx1-3838991369-1yuur   1/1       Running   0          1m        windows\n\n\n\n3.3 kubectl describe (get\u306e\u8a73\u7d30\u30d0\u30fc\u30b8\u30e7\u30f3)\n\u30ea\u30bd\u30fc\u30b9\u306e\u4e00\u89a7\u3092\u8868\u793a\u3059\u308b\u3002\"get\"\u3068\u30bf\u30a4\u30d7\u3057\u305f\u3042\u3068\u306b\"Tab\"\u30ad\u30fc\u3092\u62bc\u4e0b\u3059\u308b\u3002\n[root@master ~]# kubectl get\ncomponentstatus             ingress                     pod                         securitycontextconstraints\nconfigmap                   job                         podsecuritypolicy           service\ndaemonset                   limitrange                  podtemplate                 serviceaccount\ndeployment                  namespace                   replicaset                  thirdpartyresource\nendpoints                   node                        replicationcontroller\nevent                       persistentvolume            resourcequota\nhorizontalpodautoscaler     persistentvolumeclaim       secret\n\nPod\u306e\u72b6\u614b\u3092\u53d6\u5f97\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-2040093540-4g0um   1/1       Running   0          21s\n\nPod\u306e\u72b6\u614b\u3092\u53d6\u5f97\u3059\u308b\u3002get\u306b\u6bd4\u3079\u3088\u308a\u8a73\u7d30\u306a\u60c5\u5831\u304c\u5f97\u3089\u308c\u308b\u3002\n[root@master ~]# kubectl describe pod nginx-2040093540-4g0um\nName:           nginx-2040093540-4g0um\nNamespace:      default\nNode:           master/192.168.0.100\nStart Time:     Thu, 03 Nov 2016 22:28:17 +0900\nLabels:         pod-template-hash=2040093540,run=nginx\nStatus:         Running\nIP:             10.1.57.2\nControllers:    ReplicaSet/nginx-2040093540\nContainers:\n  nginx:\n    Container ID:       docker://fe90e85dcb1b58659e748b045c7487723ad07bc475d45b3322718820e07b0b72\n    Image:              nginx\n    Image ID:           docker://sha256:e43d811ce2f4986aa69bc8ba6c92f0789537f604d1601e0b6ec024e1c38062b4\n    Port:\n    QoS Tier:\n      memory:           BestEffort\n      cpu:              BestEffort\n    State:              Running\n      Started:          Thu, 03 Nov 2016 22:28:32 +0900\n    Ready:              True\n    Restart Count:      0\n    Environment Variables:\nConditions:\n  Type          Status\n  Ready         True\nNo volumes.\nEvents:\n  FirstSeen     LastSeen        Count   From                    SubobjectPath           Type            Reason          Message\n  ---------     --------        -----   ----                    -------------           --------        ------          -------\n  38s           38s             1       {default-scheduler }                            Normal          Scheduled       Successfully assigned nginx-2040093540-4g0um to 127.0.0.1\n  36s           36s             1       {kubelet master}     spec.containers{nginx}  Normal          Pulling         pulling image \"nginx\"\n  25s           25s             1       {kubelet master}     spec.containers{nginx}  Normal          Pulled          Successfully pulled image \"nginx\"\n  24s           24s             1       {kubelet master}     spec.containers{nginx}  Normal          Created         Created container with docker id fe90e85dcb1b\n  23s           23s             1       {kubelet master}     spec.containers{nginx}  Normal          Started         Started container with docker id fe90e85dcb1b\n\n[root@master ~]#\n\n\n3.4 kubectl create(\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u6210\u3059\u308b\uff09\nDeployment\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u5bb9\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\n[root@master ~]# cat nginx-deployment.yaml\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.7.9\n        ports:\n        - containerPort: 80\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u5f15\u6570\u306b\u3057\u3066Deployment \u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master ~]# kubectl create -f nginx-deployment.yaml\ndeployment \"nginx-deployment\" created\n\n\u4f5c\u6210\u3057\u305fDeployment\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002Deployment\u306e\u540d\u524d\u306f\"nginx-deployment\"\u3067\u3042\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get deployment\nNAME               DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\nnginx-deployment   1         1         1            1           2m\n\n\nDeployment\u3067\u7ba1\u7406\u3059\u308bPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                                READY     STATUS    RESTARTS   AGE\nnginx-deployment-2035384211-xggt8   1/1       Running   0          2m\n\nDeployment\u3092\u524a\u9664\u3059\u308b\u3002\n[root@master ~]# kubectl delete deployment nginx-deployment\ndeployment \"nginx-deployment\" deleted\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002Deployment\u3092\u524a\u9664\u3059\u308b\u3068\u3001Pod\u3082\u505c\u6b62\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod\n[root@master ~]#\n\n\n3.5 kubectl create namespace(\u30cd\u30fc\u30e0\u30b9\u30da\u30fc\u30b9\u3092\u4f5c\u6210\u3059\u308b\uff09\nname1\u3068\u3044\u3046namespace\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master ~]# kubectl create namespace name1\nnamespace \"name1\" created\n\nname2\u3068\u3044\u3046namespace\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master ~]# kubectl create namespace name2\nnamespace \"name2\" created\n\n\u4f5c\u6210\u3057\u305fnamespace\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get namespace\nNAME          STATUS    AGE\ndefault       Active    61d\nname1         Active    2m\nname2         Active    2m\n\nname1\u3068name2\u3067\u305d\u308c\u305e\u308cPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl run nginx --image=nginx --namespace=name1\ndeployment \"nginx\" created\n[root@master ~]# kubectl run nginx --image=nginx --namespace=name2\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002name1,name2\u3067\u305d\u308c\u305e\u308cPod\u304c\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod --all-namespaces\nNAMESPACE   NAME                     READY     STATUS    RESTARTS   AGE\nname1       nginx-2040093540-npjtb   1/1       Running   0          44s\nname2       nginx-2040093540-7njdh   1/1       Running   0          39s\n\nPod\u3092\u7d42\u4e86\u3059\u308b\u3002\n[root@master ~]# kubectl delete deployment nginx --namespace=name1\ndeployment \"nginx\" deleted\n[root@master ~]# kubectl delete deployment nginx --namespace=name2\ndeployment \"nginx\" deleted\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod --all-namespaces\n[root@master ~]#\n\n\n3.6 kubectl create secret (secret\u3092\u4f5c\u6210\u3059\u308b)\nsecret\u3068\u3057\u3066Pod\u306b\u30de\u30a6\u30f3\u30c8\u3059\u308b\u60c5\u5831\u306f\u4ee5\u4e0b\u306e2\u3064\u306e\u60c5\u5831\u3002\n[root@master secrets]# cat username.txt\nfoo\n[root@master secrets]# cat pass.txt\n12345\n\n\"mysecret\"\u3068\u3044\u3046\u540d\u524d\u306esecret\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master secrets]# kubectl create secret generic mysecret --from-file=./username.txt --from-file=./pass.txt\nsecret \"mysecret\" created\n\nsecret\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master secrets]# kubectl get secret\nNAME                  TYPE                                  DATA      AGE\nmysecret              Opaque                                2         5s\n\nsecret\u306e\u8a73\u7d30\u60c5\u5831\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master secrets]# kubectl describe secret mysecret\nName:           mysecret\nNamespace:      default\nLabels:         <none>\nAnnotations:    <none>\n\nType:   Opaque\n\nData\n====\nusername.txt:   4 bytes  <= \u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u8eab\u305d\u306e\u3082\u306e\u306f\u3067\u306a\u304f\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u30d0\u30a4\u30c8\u6570\u304c\u8868\u793a\u3055\u308c\u308b\u3002\npass.txt:       6 bytes  <= \u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u8eab\u305d\u306e\u3082\u306e\u306f\u3067\u306a\u304f\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u30d0\u30a4\u30c8\u6570\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\n\nPod\u3092\u8d77\u52d5\u3059\u308b\u305f\u3081\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u78ba\u8a8d\u3059\u308b\u3002/tmp/mysec\u306bmysecret\u3068\u3044\u3046\u540d\u524d\u306esecret\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u3002\n[root@master secrets]# cat secret-pod.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  labels:\n    name: secretstest1  <= Pod\u306b\u4ed8\u3051\u308b\u30e9\u30d9\u30eb\u540d\u3092\u6307\u5b9a\u3059\u308b\uff08\u4efb\u610f\u306e\u540d\u524d)\n  name: secretstest     <= Pod\u306e\u540d\u524d\u3092\u6307\u5b9a\u3059\u308b\uff08\u4efb\u610f\u306e\u540d\u524d\uff09\nspec:\n  volumes:\n    - name: \"secretstest\"\n      secret:\n        secretName: mysecret   <= \u30de\u30a6\u30f3\u30c8\u3059\u308bsecret\u306e\u540d\u524d\u3092\u6307\u5b9a\u3059\u308b\u3002\n  containers:\n    - image: nginx:1.7.1\n      name: awebserver\n      volumeMounts:\n        - mountPath: \"/tmp/mysec\"   <= secret\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308bPod\u5185\u306e\u30d1\u30b9\u3002\n          name: \"secretstest\"\n\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master secrets]# kubectl create -f secret-pod.yaml\npod \"secretstest\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master secrets]# kubectl get pod\nNAME                   READY     STATUS    RESTARTS   AGE\nsecretstest            1/1       Running   0          31s\n\nPod\u306e\u30e9\u30d9\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master secrets]# kubectl get pod --show-labels\nNAME          READY     STATUS    RESTARTS   AGE       LABELS\nsecretstest   1/1       Running   0          35s       name=secretstest1\n\nsecret\u306e\u4e2d\u8eab\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master secrets]# kubectl exec -it secretstest bash\nroot@secretstest:/usr/local/nginx/html# cat /tmp/mysec/pass.txt\n12345\nroot@secretstest:/usr/local/nginx/html# cat /tmp/mysec/username.txt\nfoo\nroot@secretstest:/usr/local/nginx/html# exit\nexit\n[root@master secrets]#\n\n\n3.7 kubectl create configmap  (configmap\u3092\u4f5c\u6210\u3059\u308b)\nconfigmap\u306f\u3001\u30db\u30b9\u30c8\u304b\u3089Pod\u306b\u8a2d\u5b9a\u60c5\u5831(key,value\u306e\u7d44)\u3092\u6e21\u3059\u3068\u304d\u306b\u4f7f\u3046\u30ea\u30bd\u30fc\u30b9\u3067\u3059\u3002\n-----------------------------------\n1. ConfigMap\u3092\u4f5c\u6210\u3059\u308b\u3002\n-----------------------------------\nConfigMap\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master ~]# vi config.yaml\n[root@master ~]# cat config.yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: test-config\ndata:\n  # key, value\u5f62\u5f0f\u3067\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3059\u308b\n  test1: '11111'\n  test2: '22222'\n\nConfigMap\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master ~]# kubectl create -f config.yaml\nconfigmap \"test-config\" created\n\n\u4f5c\u6210\u3057\u305fConfigMap\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get configmap\nNAME          DATA      AGE\ntest-config   2         11s\n\n\u4f5c\u6210\u3057\u305fConfigMap\u306e\u8a73\u7d30\u60c5\u5831\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl describe configmap test-config\nName:           test-config\nNamespace:      default\nLabels:         <none>\nAnnotations:    <none>\n\nData\n====\ntest1:  5 bytes   <===== '11111'\u306e\u30b5\u30a4\u30ba\u304c\u8868\u793a\u3055\u308c\u308b\u3002\ntest2:  5 bytes   <===== '22222'\u306e\u30b5\u30a4\u30ba\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\n-----------------------------------\n2. \u4f5c\u6210\u3057\u305fConfigMap\u3092Pod\u306b\u6e21\u3059\n-----------------------------------\nPod\u306e\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master ~]# vi pod.yaml\n[root@master ~]# cat pod.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: test-pod\nspec:\n  containers:\n    - name: example-container\n      image: busybox\n      # \u3042\u3068\u304b\u3089exec\u3067\u64cd\u4f5c\u3059\u308b\u305f\u3081sleep\u3055\u305b\u3066\u304a\u304f\n      command: [\"sleep\", \"3600\"]\n      # ConfigMap\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\n      volumeMounts:\n        - name: config-volume\n          mountPath: /etc/config\n  volumes:\n    - name: config-volume\n      configMap:\n        # ConfigMap\u30ea\u30bd\u30fc\u30b9\u306e\u540d\u524d\u3092\u6307\u5b9a\u3059\u308b(kubectl get configmap\u3067\u5f97\u3089\u308c\u308b\u540d\u524d)\n        name: test-config\n\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl create -f pod.yaml\npod \"test-pod\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME       READY     STATUS    RESTARTS   AGE\ntest-pod   1/1       Running   0          26s\n\nPod\u306esh\u3092\u8d77\u52d5\u3057\u3066\u3001ConfigMap\u306eKey,Value\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl exec -it test-pod sh\n/ # cat /etc/config/test1\n11111/ #\n/ # cat /etc/config/test2\n22222/ #\n\n-----------------------------------------------------------\n3. \u52d5\u7684\u306bConfigMap\u3092\u5909\u66f4\u3059\u308b\u3002\u5909\u66f4\u3057\u305fConfigMap\u3092Pod\u3067\u53c2\u7167\u3059\u308b\u3002\n------------------------------------------------------------\nConfigMap\u3092\u52d5\u7684\u306b\u5909\u66f4\u3059\u308b\u3002\n[root@master ~]# kubectl edit configmap test-config\n# Please edit the object below. Lines beginning with a '#' will be ignored,\n# and an empty file will abort the edit. If an error occurs while saving this file will be\n# reopened with the relevant failures.\n#\napiVersion: v1\ndata:\n  test1: \"88888\"  <=== '11111'\u304b\u3089'88888'\u306b\u5909\u66f4\u3059\u308b\u3002\n  test2: \"99999\"  <=== '22222'\u304b\u3089'99999'\u306b\u5909\u66f4\u3059\u308b\u3002\nkind: ConfigMap\n\"/tmp/kubectl-edit-np3nb.yaml\" 16L, 503C\n\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME       READY     STATUS    RESTARTS   AGE\ntest-pod   1/1       Running   0          4m\n\nConfigMap\u306eValue\u3092\u78ba\u8a8d\u3059\u308b\u3002Value\u304c\u5909\u66f4\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n[root@master ~]# kubectl exec -it test-pod sh\n/ # cat /etc/config/test1\n88888/ #\n/ # cat /etc/config/test2\n99999/ #\n/ # exit\n\n\n\n3.8 kubectl exec (Pod\u3067\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\uff09\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master2 ~]# kubectl run nginx --image=nginx\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master2 ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-2040093540-69r4e   1/1       Running   0          13s\n\nPod\u3067\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3002\n[root@master2 ~]# kubectl exec nginx-2040093540-69r4e -it bash\n\nps\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3002nginx\u304c\u52d5\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\nroot@nginx-2040093540-69r4e:/# ps aux\nUSER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot          1  0.7  0.2  31760  2856 ?        Ss   01:17   0:00 nginx: master\nnginx         8  0.0  0.1  32152  1408 ?        S    01:17   0:00 nginx: worker\nroot          9  4.8  0.1  20216  1912 ?        Ss   01:17   0:00 bash\nroot         17  0.0  0.1  17492  1148 ?        R+   01:17   0:00 ps aux\n\nuname\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3002Linux\u306e\u7248\u6570\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\nroot@nginx-2040093540-69r4e:/# uname -r\n3.10.0-327.el7.x86_64\n\n\u30b3\u30f3\u30c6\u30ca\u304b\u3089\u629c\u3051\u308b\nroot@nginx-2040093540-69r4e:/# exit\nexit\n[root@master2 ~]#\n\n\n----------------------------------------------------\n1\u3064\u306ePod\u30672\u3064\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u305f\u5834\u5408\u306eexec\u5b9f\u65bd\u4f8b\n----------------------------------------------------\nPod\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master2 ~]# vi multi_os.yaml\n[root@master2 ~]# cat multi_os.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: multiple-container\nspec:\n  containers:\n    - name: busybox\n      image: busybox\n      command: [\"sleep\", \"3600\"]\n    - name: centos7\n      image: centos\n      command: [\"sleep\", \"3600\"]\n\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master2 ~]# kubectl create -f multi_os.yaml\npod \"multiple-container\" created\n\nbusybox\u306e\u30b3\u30f3\u30c6\u30ca\u3067\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3002\n[root@master2 ~]# kubectl exec multiple-container -c busybox -it sh\n/ # uname -r\n3.10.0-327.el7.x86_64\n/ # exit\n[root@master2 ~]#\n\n\ncentos\u306e\u30b3\u30f3\u30c6\u30ca\u3067\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3002\n[root@master2 ~]# kubectl exec multiple-container -c centos7 -it bash\n[root@multiple-container /]# uname -r\n3.10.0-327.el7.x86_64\n[root@multiple-container /]# cat /etc/redhat-release\nCentOS Linux release 7.3.1611 (Core)\n[root@multiple-container /]# exit\nexit\n[root@master2 ~]#\n\n\n----------------------------------------------------\nPod\u306e\u8a73\u7d30\u60c5\u5831\u306e\u78ba\u8a8d\n----------------------------------------------------\n[root@master2 ~]# kubectl describe pod multiple-container\nName:           multiple-container\nNamespace:      default\nNode:           master2/192.168.0.20\nStart Time:     Sat, 07 Jan 2017 11:05:13 +0900\nLabels:         <none>\nStatus:         Running\nIP:             172.17.0.2\nControllers:    <none>\nContainers:\n  busybox:\n    Container ID:       docker://075b790da0ff3404d9567e92a9ac5d2efb55231734633723f5fc0143ea866822\n    Image:              busybox\n    Image ID:           docker://sha256:8a4698b1752b8142df16b73eca10c8b03fbd2ccbbd03cfd47882f04ace12de66\n    Port:\n    Command:\n      sleep\n      3600\n    QoS Tier:\n      memory:           BestEffort\n      cpu:              BestEffort\n    State:              Running\n      Started:          Sat, 07 Jan 2017 11:05:29 +0900\n    Ready:              True\n    Restart Count:      0\n    Environment Variables:\n  centos7:\n    Container ID:       docker://780ded7a424d58315ab2ea8b580eef7c2d11929286abfe37be899f6a8b6ac931\n    Image:              centos\n    Image ID:           docker://sha256:67591570dd29de0e124ee89d50458b098dbd83b12d73e5fdaf8b4dcbd4ea50f8\n    Port:\n    Command:\n      sleep\n      3600\n    QoS Tier:\n      memory:           BestEffort\n      cpu:              BestEffort\n    State:              Running\n      Started:          Sat, 07 Jan 2017 11:05:20 +0900\n    Ready:              True\n    Restart Count:      0\n    Environment Variables:\nConditions:\n  Type          Status\n  Ready         True\n\n-\u4ee5\u4e0b\u3001\u7565-\n\n\n\n3.9 kubectl scale(Pod\u306e\u6570\u3092\u5897\u6e1b\u3059\u308b\uff09\n\nPod\u30921\u3064\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl run nginx --image=nginx\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002Pod\u304c1\u3064\u52d5\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-2040093540-xfxj6   1/1       Running   0          18s\n\nPod\u30922\u500b\u306b\u5897\u3084\u3059\u3002\n[root@master ~]# kubectl scale deployment nginx --replicas=2\ndeployment \"nginx\" scaled\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002Pod\u304c2\u500b\u306b\u306a\u3063\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-2040093540-d2c6a   1/1       Running   0          21s\nnginx-2040093540-xfxj6   1/1       Running   0          1m\n\nPod\u3092\u7d42\u4e86\u3059\u308b\u3002\n[root@master ~]# kubectl delete deployment nginx\ndeployment \"nginx\" deleted\n[root@master ~]# kubectl get pod\n[root@master ~]#\n\n\n3.10 kubectl cordon(Pod\u914d\u5099\u7981\u6b62)/kubectl uncordon(Pod\u914d\u5099\u7981\u6b62\u306e\u89e3\u9664)\nkubectl cordon\u3082kubectl drain\u3082\u3001\u6307\u5b9a\u3057\u305f\u30db\u30b9\u30c8\u3078\u306ePod\u306e\u65b0\u898f\u914d\u5099\u3092\u7981\u6b62\u3059\u308b\u3002\u9055\u3044\u306f\u3001\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3002\n- kubectl cordon : kubectl cordon\u3067\u6307\u5b9a\u3057\u305f\u30db\u30b9\u30c8\u3067Pod\u304c\u52d5\u4f5c\u4e2d\u306e\u5834\u5408\u3001\u305d\u306ePod\u306f\u305d\u306e\u30db\u30b9\u30c8\u3067\u52d5\u4f5c\u3057\u305f\u307e\u307e\u3002 \n- kubectl drain  : kubectl drain\u3067\u6307\u5b9a\u3057\u305f\u30db\u30b9\u30c8\u3067Pod\u304c\u52d5\u4f5c\u4e2d\u306e\u5834\u5408\u3001Pod\u3092\u4ed6\u306e\u30db\u30b9\u30c8\u306b\u79fb\u52d5\u3059\u308b\u3002\n\u30db\u30b9\u30c8(\u30de\u30b9\u30bf\u3068\u30ce\u30fc\u30c9\uff09\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get node\nNAME        STATUS     AGE\nmaster      Ready      59d\nnode1       Ready      61d\n\nPod\u30924\u3064\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl run nginx --image=nginx --replicas=4\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30de\u30b9\u30bf(master)\u3068\u30ce\u30fc\u30c9(node1)\u30672\u500b\u305a\u3064\u52d5\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod -o wide\nNAME                     READY     STATUS    RESTARTS   AGE       NODE\nnginx-2040093540-147wy   1/1       Running   0          42s       master\nnginx-2040093540-s5lu3   1/1       Running   0          42s       node1\nnginx-2040093540-st25o   1/1       Running   0          42s       node1\nnginx-2040093540-w8rxu   1/1       Running   0          42s       master\n\nPod\u3092\u7d42\u4e86\u3059\u308b\u3002\n[root@master ~]# kubectl delete deployment nginx\ndeployment \"nginx\" deleted\n\n\u30de\u30b9\u30bf(master)\u3078\u306ePod\u914d\u5099\u3092\u7981\u6b62\u3059\u308b\u3002\n[root@master ~]# kubectl cordon master\nnode \"master\" cordoned\n\n\u30db\u30b9\u30c8\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30de\u30b9\u30bf\u3078\u306ePod\u914d\u5099\u304c\u7981\u6b62\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get node\nNAME        STATUS                     AGE\nmaster      Ready,SchedulingDisabled   59d\nnode1       Ready                      61d\n\nPod\u30924\u500b\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl run nginx --image=nginx --replicas=4\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u30024\u500b\u3059\u3079\u3066\u304c\u30ce\u30fc\u30c9(node1)\u3067\u52d5\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod -o wide\nNAME                     READY     STATUS    RESTARTS   AGE       NODE\nnginx-2040093540-2e7pe   1/1       Running   0          47s       node1\nnginx-2040093540-aebg5   1/1       Running   0          47s       node1\nnginx-2040093540-jgw2y   1/1       Running   0          47s       node1\nnginx-2040093540-wmvem   1/1       Running   0          47s       node1\n\n\u30de\u30b9\u30bf\u3078\u306ePod\u914d\u5099\u7981\u6b62\u3092\u89e3\u9664\u3059\u308b\u3002\n[root@master ~]# kubectl uncordon master\nnode \"master\" uncordoned\n\n\u30db\u30b9\u30c8\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30de\u30b9\u30bf\u306ePod\u914d\u5099\u7981\u6b62\u304c\u89e3\u9664\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get node\nNAME        STATUS     AGE\nmaster      Ready      59d\nnode1       Ready      61d\n\n\n3.11 kubectl drain(Pod\u914d\u5099\u7981\u6b62)/kubectl uncordon(Pod\u914d\u5099\u7981\u6b62\u306e\u89e3\u9664)\nPod\u30922\u3064\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl run nginx --image=nginx --replicas=2\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30de\u30b9\u30bf(master)\u3068\u30ce\u30fc\u30c9(node1)\u3067Pod\u304c1\u500b\u305a\u3064\u52d5\u3044\u3066\u3044\u308b\u3002\n[root@master ~]# kubectl get pod -o wide\nNAME                     READY     STATUS    RESTARTS   AGE       NODE\nnginx-2040093540-2oix4   1/1       Running   0          20s       node1\nnginx-2040093540-pkmvj   1/1       Running   0          20s       master\n\n\u30de\u30b9\u30bf(master)\u3092Pod\u914d\u5099\u7981\u6b62\u306b\u3059\u308b\u3002\n[root@master ~]# kubectl drain master\nnode \"master\" cordoned\nerror: pods not managed by ReplicationController, Job, or DaemonSet: nginx-2040093540-pkmvj (use --force to override)\n\nPod\u914d\u5099\u7981\u6b62\u3092\u5b9f\u884c\u3059\u308b\u3002\n\u914d\u5099\u7981\u6b62\u306b\u6307\u5b9a\u3059\u308b\u30db\u30b9\u30c8\u3067Deployment\u3067\u7ba1\u7406\u3059\u308bPod\u304c\u7a3c\u50cd\u4e2d\u306e\u5834\u5408\u306f\u3001--force\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n[root@master ~]# kubectl drain --force master\nnode \"master\" already cordoned\nWARNING: About to delete these pods not managed by ReplicationController, Job, or DaemonSet: nginx-2040093540-pkmvj\npod \"nginx-2040093540-pkmvj\" deleted\nnode \"master\" drained\n\n\u30db\u30b9\u30c8\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30de\u30b9\u30bf\u304cPod\u914d\u5099\u7981\u6b62\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get node\nNAME        STATUS                     AGE\nmaster      Ready,SchedulingDisabled   59d\nnode1       Ready                      61d\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\u30de\u30b9\u30bf(master)\u3067\u52d5\u3044\u3066\u3044\u305fPod\u304c\u30ce\u30fc\u30c9(node1)\u306b\u79fb\u52d5\u3057\u30662\u3064\u3068\u3082\u30ce\u30fc\u30c9(node1)\u3067\u52d5\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod -o wide\nNAME                     READY     STATUS    RESTARTS   AGE       NODE\nnginx-2040093540-2oix4   1/1       Running   0          1m        node1\nnginx-2040093540-ab2l4   1/1       Running   0          31s       node1\n\nPod\u914d\u5099\u7981\u6b62\u3092\u89e3\u9664\u3059\u308b\u3002\n[root@master ~]# kubectl uncordon master\nnode \"master\" uncordoned\n\n\u30db\u30b9\u30c8\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002Pod\u914d\u5099\u7981\u6b62\u304c\u89e3\u9664\u3055\u308c\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get node\nNAME        STATUS     AGE\nmaster      Ready      59d\nnode1       Ready      61d\n\n\n3.12 kubectl attach(\u52d5\u4f5c\u4e2d\u306ePod\u306b\u63a5\u7d9a\u3059\u308b\uff09\n\u672c\u30b3\u30de\u30f3\u30c9\u306e\u7528\u9014\u304c\u308f\u304b\u3089\u306a\u3044\u3002\u3002\u3002\nhttps://github.com/kubernetes/kubernetes/issues/23335\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl run httpd --image=httpd\ndeployment \"httpd\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nhttpd-2047761252-mp52s   1/1       Running   0          14s\n\nPod\u306battach\u3059\u308b\u3002\n[root@master ~]# kubectl attach httpd-2047761252-mp52s -i\nAH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 172.17.0.2. Set the 'ServerName' directive globally to suppress this message\nAH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 172.17.0.2. Set the 'ServerName' directive globally to suppress this message\n[Sat Jan 07 02:49:25.819545 2017] [mpm_event:notice] [pid 1:tid 139689717176192] AH00489: Apache/2.4.25 (Unix) configured -- resuming normal operations\n[Sat Jan 07 02:49:25.820892 2017] [core:notice] [pid 1:tid 139689717176192] AH00094: Command line: 'httpd -D FOREGROUND'\n\n\n\n\n3.13 kubectl rollout\n\n3.13.1 kubectl rollout history\uff08\u66f4\u65b0\u5c65\u6b74\u3092\u8868\u793a\u3059\u308b\uff09\n\n3.13.2 kubectl rollout undo\uff08\u64cd\u4f5c\u3092\u53d6\u308a\u6d88\u3059\u3002\u904e\u53bb\u306e\u72b6\u614b\u306b\u623b\u308b\uff09\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\u5c65\u6b74\u3092\u6b8b\u3059\u305f\u3081\u306b\u3001--record\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u308b\u3002\n[root@master ~]# kubectl run nginx --image=nginx:1.7.1 --record\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-4193804003-j9lsd   1/1       Running   0          7s\n\nDeployment\u306e\u66f4\u65b0\u5c65\u6b74\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl rollout history deployment/nginx\ndeployments \"nginx\":\nREVISION        CHANGE-CAUSE\n1               kubectl run nginx --image=nginx:1.7.1 --record\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u3092\u5909\u66f4(1.7.1 -> 1.9.1)\u3059\u308b\u3002\u30a8\u30c7\u30a3\u30bf(vi\u7b49)\u304c\u8d77\u52d5\u3059\u308b\u306e\u3067\u3001\u7248\u6570\u3092\u5909\u66f4\u3059\u308b\u3002\n[root@master ~]# kubectl edit deployment nginx\n\n      - image: nginx:1.7.1\n           \u2193\u5909\u66f4\n      - image: nginx:1.9.1\n\ndeployment \"nginx\" edited\n\n\u5c65\u6b74\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl rollout history deployment nginx\ndeployments \"nginx\":\nREVISION        CHANGE-CAUSE\n1               kubectl run nginx --image=nginx:1.7.1 --record\n2               kubectl edit deployment nginx\n\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                   READY     STATUS    RESTARTS   AGE\nnginx-45047525-1xrp3   1/1       Running   0          57s\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u304c1.7.1\u304b\u30891.9.1\u306b\u306a\u3063\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl describe pod nginx-45047525-1xrp3|grep \"Image:\"\n    Image:              nginx:1.9.1\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u30021.9.1\u7248\u3092\u3082\u3068\u306b\u8d77\u52d5\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u3068\u3044\u3046\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# docker ps\nCONTAINER ID        IMAGE                                                        COMMAND                  CREATED              STATUS              PORTS               NAMES\n1c3bcac0febb        nginx:1.9.1                                                  \"nginx -g 'daemon off\"   About a minute ago   Up About a minute                       k8s_nginx.e0d0df54_nginx-45047525-1xrp3_default_f1902308-a413-11e6-b2c9-000c291946c5_1d70a802\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u3092\u5909\u66f4(1.9.1 -> 1.9.2)\u3059\u308b\u3002\n[root@master ~]# kubectl edit deployment nginx\n\n      - image: nginx:1.9.1\n      - image: nginx:1.9.2\ndeployment \"nginx\" edited\n\n\u5c65\u6b74\u3092\u78ba\u8a8d\u3059\u308b\u30023\u56de\u5206\u306e\u66f4\u65b0\u5c65\u6b74\u3092\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n[root@master ~]# kubectl rollout history deployment nginx\ndeployments \"nginx\":\nREVISION        CHANGE-CAUSE\n1               kubectl run nginx --image=nginx:1.7.1 --record\n2               kubectl edit deployment nginx\n3               kubectl edit deployment nginx\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                    READY     STATUS    RESTARTS   AGE\nnginx-117530342-onbvj   1/1       Running   0          38s\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u304c1.9.1\u304b\u30891.9.2\u306b\u306a\u3063\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl describe pod nginx-117530342-onbvj|grep \"Image:\"\n    Image:              nginx:1.9.2\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u30021.9.2\u7248\u3092\u3082\u3068\u306b\u8d77\u52d5\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u3068\u3044\u3046\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# docker ps\nCONTAINER ID   IMAGE         COMMAND                  CREATED              STATUS              PORTS    NAMES\n20d6aaed4863   nginx:1.9.2   \"nginx -g 'daemon off\"   About a minute ago   Up About a minute            k8s_nginx.e2fedf55_nginx-117530342-onbvj_default_49ebf179-a414-11e6-b2c9-000c291946c5_13a2ecc9\n\nREVISION 1\u306e\u72b6\u614b\u306b\u623b\u3059\u3002\n[root@master ~]# kubectl rollout undo deployment nginx --to-revision=1\ndeployment \"nginx\" rolled back\n\n[root@master ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-4193804003-1fx52   1/1       Running   0          34s\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u304c1.9.2\u304b\u30891.7.1\u306b\u306a\u3063\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl describe pod nginx-4193804003-1fx52|grep \"Image:\"\n    Image:              nginx:1.7.1\n\n[root@master ~]# docker ps\nCONTAINER ID   IMAGE         COMMAND     CREATED           STATUS           PORTS    NAMES\nf30ae136f042   nginx:1.7.1   \"nginx\"     51 seconds ago    Up 50 seconds             k8s_nginx.dc70df52_nginx-4193804003-1fx52_default_50748203-a415-11e6-b2c9-000c291946c5_15fe34ac\n\n\nREVISION 2\u306e\u72b6\u614b\u306b\u623b\u3059\u3002\n[root@master ~]# kubectl rollout undo deployment nginx --to-revision=2\ndeployment \"nginx\" rolled back\n\n[root@master ~]# kubectl get pod\nNAME                   READY     STATUS    RESTARTS   AGE\nnginx-45047525-iw6w6   1/1       Running   0          6s\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u304c1.7.1\u304b\u30891.9.1\u306b\u306a\u3063\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl describe pod nginx-45047525-iw6w6|grep \"Image:\"\n    Image:              nginx:1.9.1\n\n[root@master ~]# docker ps\nCONTAINER ID   IMAGE         COMMAND                 CREATED           STATUS           PORTS    NAMES\n1268824ad1c5   nginx:1.9.1   \"nginx -g 'daemon off\"  17 seconds ago    Up 16 seconds             k8s_nginx.e0d0df54_nginx-45047525-iw6w6_default_94a637f0-a415-11e6-b2c9-000c291946c5_c1d96f5c\n\n\n3.13.3 kubectl rollout pause\n\n3.13.4 kubectl rollout resume\n\n3.14 kubectl label(Pod\u3078\u306e\u30e9\u30d9\u30eb\u8cbc\u4ed8\u3001\u524a\u9664\u3001\u4e0a\u66f8\u304d\uff09\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl run nginx --image=nginx\ndeployment \"nginx\" created\n\nPod\u306e\u30e9\u30d9\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod --show-labels\nNAME                     READY     STATUS    RESTARTS   AGE       LABELS\nnginx-2040093540-ujjzd   1/1       Running   0          18s       pod-template-hash=2040093540,run=nginx\n\n\u30e9\u30d9\u30eb(os=linux)\u3092\u8ffd\u52a0\u3059\u308b\u3002\n[root@master ~]# kubectl label pod nginx-2040093540-ujjzd os=linix\npod \"nginx-2040093540-ujjzd\" labeled\n\n\u30e9\u30d9\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u3002os=linux\u3068\u3044\u3046\u30e9\u30d9\u30eb\u304c\u8ffd\u52a0\u3055\u308c\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod --show-labels\nNAME                     READY     STATUS    RESTARTS   AGE       LABELS\nnginx-2040093540-ujjzd   1/1       Running   0          1m        os=linix,pod-template-hash=2040093540,run=nginx\n\n\u30e9\u30d9\u30eb(os=linux)\u3092\u524a\u9664\u3059\u308b\u3002\n\u30ad\u30fc\u306e\u5f8c\u306b\u30cf\u30a4\u30d5\u30f3\u3092\u6307\u5b9a\u3059\u308b\u3002\u4ee5\u4e0b\u306e\u4f8b\u3060\u3068OS\u306e\u5f8c\u306b\u300c-\u300d\u3092\u6307\u5b9a\u3059\u308b\u3002\n[root@master ~]# kubectl label pod nginx-2040093540-ujjzd os-\npod \"nginx-2040093540-ujjzd\" labeled\n\n\u30e9\u30d9\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30e9\u30d9\u30eb(os=linux)\u304c\u524a\u9664\u3055\u308c\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod --show-labels\nNAME                     READY     STATUS    RESTARTS   AGE       LABELS\nnginx-2040093540-ujjzd   1/1       Running   0          3m        pod-template-hash=2040093540,run=nginx\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod --show-labels\nNAME                     READY     STATUS    RESTARTS   AGE       LABELS\nnginx-2040093540-ujjzd   1/1       Running   0          6m        pod-template-hash=2040093540,run=nginx\n\n\u30e9\u30d9\u30eb\u3092\u66f8\u304d\u63db\u3048\u308b\u3002run=nginx\u3068\u3044\u3046\u30e9\u30d9\u30eb\u3092run=hoge\u306b\u66f8\u304d\u63db\u3048\u308b\u3002\n[root@master ~]# kubectl label --overwrite pod nginx-2040093540-ujjzd run=hoge\npod \"nginx-2040093540-ujjzd\" labeled\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\nrun=nginx\u3068\u3044\u3046\u30e9\u30d9\u30eb\u3092\u6301\u3063\u305fPod\u304c\u3044\u306a\u304f\u306a\u3063\u305f\u305f\u3081\u3001\u3082\u30461\u3064Pod\u3092\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod --show-labels\nNAME                     READY     STATUS    RESTARTS   AGE       LABELS\nnginx-2040093540-32i08   1/1       Running   0          1m        pod-template-hash=2040093540,run=nginx\nnginx-2040093540-ujjzd   1/1       Running   0          9m        pod-template-hash=2040093540,run=hoge\n\n\u65b0\u305f\u306b\u8d77\u52d5\u3057\u305fPod\u306e\u30e9\u30d9\u30eb\u3092run=hoge\u304b\u3089run=nginx\u306b\u623b\u3059\u3002\n[root@master ~]# kubectl label --overwrite pod nginx-2040093540-ujjzd run=nginx\npod \"nginx-2040093540-ujjzd\" labeled\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\nrun=nginx\u3068\u3044\u3046\u30e9\u30d9\u30eb\u3092\u6301\u3063\u305fPod\u304c2\u500b\u306b\u306a\u3063\u305f\u305f\u3081\u3001Pod\u306e\u6570\u30922\u500b\u304b\u30891\u500b\u306b\u6e1b\u3089\u3057\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod --show-labels\nNAME                     READY     STATUS    RESTARTS   AGE       LABELS\nnginx-2040093540-ujjzd   1/1       Running   0          14m       pod-template-hash=2040093540,run=nginx\n\n\n\n3.15 kubectl annotate(\u30ea\u30bd\u30fc\u30b9\u306b\u6ce8\u91c8\u306e\u8ffd\u52a0\u3001\u524a\u9664\u3092\u884c\u3046\uff09\n-----------------------------------------\n1. \u6ce8\u91c8(annotate)\u306e\u8ffd\u52a0\u3001\u524a\u9664\u3092\u884c\u3046\u3002\n-----------------------------------------\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master1 ~]# kubectl run nginx --image=nginx\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master1 ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-2040093540-vb1qg   1/1       Running   0          1m\n\nPod\u306b\u6ce8\u91c8(os='centos6')\u3092\u4ed8\u3051\u308b\u3002\n[root@master1 ~]# kubectl annotate pod nginx-2040093540-vb1qg os='centos6'\npod \"nginx-2040093540-vb1qg\" annotated\n\n\u6ce8\u91c8\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master1 ~]# kubectl get pod nginx-2040093540-vb1qg -o yaml|grep -w os\n    os: centos6\n\n\u6ce8\u91c8\u3092\u524a\u9664\u3059\u308b\u3002description\u306e\u3042\u3068\u306b\u300c-\u300d\u3092\u4ed8\u3051\u308b\u3002\n[root@master1 ~]# kubectl annotate pod nginx-2040093540-vb1qg os-\npod \"nginx-2040093540-vb1qg\" annotated\n\n\u6ce8\u91c8\u3092\u78ba\u8a8d\u3059\u308b\u3002\u6ce8\u91c8\u304c\u524a\u9664\u3067\u304d\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master1 ~]# kubectl get pod nginx-2040093540-vb1qg -o yaml|grep -w os\n[root@master1 ~]#\n\n-----------------------------------------------\n2. \u6ce8\u91c8\u3092\u4e0a\u66f8\u304d\u3059\u308b(--overwrite\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u3046)\n-----------------------------------------------\nPod\u306b\u6ce8\u91c8(os='centos6')\u3092\u4ed8\u3051\u308b\u3002\n[root@master1 ~]# kubectl annotate pod nginx-2040093540-vb1qg os='centos6'\npod \"nginx-2040093540-vb1qg\" annotated\n\n\u6ce8\u91c8\u3092\u78ba\u8a8d\u3059\u308b\u3002\u3002\n[root@master1 ~]# kubectl get pod nginx-2040093540-vb1qg -o yaml|grep -w os\n    os: centos6\n\n\u6ce8\u91c8\u3092\u4e0a\u66f8\u304d\u3059\u308b\u3002os='centos6' => os='centos7'\n[root@master1 ~]# kubectl annotate --overwrite pod nginx-2040093540-vb1qg os='centos7'\npod \"nginx-2040093540-vb1qg\" annotated\n\n\u6ce8\u91c8\u3092\u78ba\u8a8d\u3059\u308b\u3002\u6ce8\u91c8\u304c\u4e0a\u66f8\u304d\u3055\u308c\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master1 ~]# kubectl get pod nginx-2040093540-vb1qg -o yaml|grep -w os\n    os: centos7\n\n\n\n3.16 kubectl edit(\u5b9a\u7fa9\u60c5\u5831\u5909\u66f4)/kubectl apply(\u5b9a\u7fa9\u60c5\u5831\u5909\u66f4\uff09\nedit\u3082apply\u3082\u30ea\u30bd\u30fc\u30b9\u306e\u5b9a\u7fa9\u60c5\u5831\u3092\u5909\u66f4\u3059\u308b\u305f\u3081\u306b\u4f7f\u3046\u3002\u9055\u3044\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3002\n - edit\u306f\u30a8\u30c7\u30a3\u30bf(vi\u7b49)\u3092\u4f7f\u3063\u3066\u3001\u30ea\u30bd\u30fc\u30b9\u306e\u5b9a\u7fa9\u60c5\u5831\u3092\u5909\u66f4\u3059\u308b\u3068\u304d\u306b\u4f7f\u3046\u3002\n - apply\u306f\u30d5\u30a1\u30a4\u30eb\u3084\u6a19\u6e96\u5165\u529b\u304b\u3089\u3001\u30ea\u30bd\u30fc\u30b9\u306e\u5b9a\u7fa9\u60c5\u5831\u3092\u5909\u66f4\u3059\u308b\u3068\u304d\u306b\u4f7f\u3046\u3002\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\u30a4\u30e1\u30fc\u30b8\u306f1.7.1\u7248\u3092\u4f7f\u3046\n[root@master ~]# kubectl run nginx --image=nginx:1.7.1\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-4193804003-rqoun   1/1       Running   0          7s\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u3092\u78ba\u8a8d\u3059\u308b\u30021.7.1\u3067\u3042\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl describe pod nginx-4193804003-rqoun|grep \"Image:\"\n    Image:              nginx:1.7.1\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u30921.7.1\u304b\u30891.9.1\u306b\u5909\u66f4\u3059\u308b\u3002\n[root@master ~]# kubectl edit deployment nginx\n\n      - image: nginx:1.7.1\n             \u2193\n      - image: nginx:1.9.1\n\ndeployment \"nginx\" edited\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u30021.9.1\u7248\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u3082\u3068\u306bPod\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                   READY     STATUS    RESTARTS   AGE\nnginx-45047525-8tklr   1/1       Running   0          2m\n\n[root@master ~]# kubectl describe pod nginx-45047525-8tklr |grep \"Image:\"\n    Image:              nginx:1.9.1\n\ndocker\u30b3\u30de\u30f3\u30c9\u3067\u3082\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3002\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u304c1.9.1\u306b\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3055\u308c\u3066\u3044\u308b\u3002\n[root@master ~]# docker ps\nCONTAINER ID     IMAGE          COMMAND                  CREATED              STATUS              PORTS        NAMES\n007830b209b4     nginx:1.9.1    \"nginx -g 'daemon off\"   About a minute ago   Up About a minute                k8s_nginx.e0d0df54_nginx-45047525-8tklr_default_fc4049e3-a3b0-11e6-815e-000c291946c5_42df405c\n\n\n3.17 kubectl replace(\u30ea\u30bd\u30fc\u30b9\u3092\u7f6e\u304d\u63db\u3048\u308b\u3002\u3044\u3063\u305f\u3093\u30ea\u30bd\u30fc\u30b9\u3092\u524a\u9664\u3057\u3066\u4f5c\u308a\u76f4\u3059\uff09\n\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u3092\u78ba\u8a8d\u3059\u308b\u3002\u7248\u6570\u306f1.7.1\n[root@master ~]# cat nginx-deployment.yaml\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.7.1\n        ports:\n        - containerPort: 80\n\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl create -f nginx-deployment.yaml\ndeployment \"nginx-deployment\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                                READY     STATUS        RESTARTS   AGE\nnginx-deployment-1406762891-5typw   1/1       Running       0          23s\n\n\u8d77\u52d5\u3057\u305fPod\u306e\u30a4\u30e1\u30fc\u30b8\u7248\u6570\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod nginx-deployment-1406762891-5typw -o yaml|grep \"image:\"\n  - image: nginx:1.7.1\n    image: nginx:1.7.1\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u3092\u5909\u66f4(1.7.1->1.9.1)\u3059\u308b\u3002\n[root@master ~]# vi nginx-deployment.yaml\n[root@master ~]# cat nginx-deployment.yaml\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.9.1\n        ports:\n        - containerPort: 80\n\n\n[root@master ~]# kubectl replace -f nginx-deployment.yaml\ndeployment \"nginx-deployment\" replaced\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002Pod\u306e\u540d\u524d\u304c\u5909\u308f\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                                READY     STATUS    RESTARTS   AGE\nnginx-deployment-1564180365-qplk2   1/1       Running   0          13s\n\n\u8d77\u52d5\u3057\u305fPod\u306e\u30a4\u30e1\u30fc\u30b8\u7248\u6570\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod nginx-deployment-1564180365-qplk2 -o yaml|grep \"image:\"\n  - image: nginx:1.9.1\n    image: nginx:1.9.1\n\nDocker\u30b3\u30de\u30f3\u30c9\u3067\u3082\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3002\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u304c1.9.1\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# docker ps\nCONTAINER ID   IMAGE        COMMAND                  CREATED           STATUS           PORTS      NAMES\nd6116aeec2e4   nginx:1.9.1  \"nginx -g 'daemon off\"   57 seconds ago    Up 55 seconds               k8s_nginx.f50b001f_nginx-deployment-1564180365-qplk2_default_7b606b07-a5a9-11e6-991f-000c291946c5_a8b717af3bde29fcacea\n\n\n\n3.18 kubectl rolling-update(\u30ea\u30bd\u30fc\u30b9\u3092\u52d5\u7684\u306b\u5909\u66f4\u3059\u308b\uff09\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u5185\u5bb9\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u306f1.7.1\n[root@master ~]# cat nginx-rc.yaml\napiVersion: v1\nkind: ReplicationController\nmetadata:\n  name: nginx\nspec:\n  replicas: 1\n  selector:\n    app: nginx\n  template:\n    metadata:\n      name: nginx\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.7.1\n        ports:\n        - containerPort: 80\n\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl create -f nginx-rc.yaml\nreplicationcontroller \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME          READY     STATUS              RESTARTS   AGE\nnginx-du0qx   0/1       ContainerCreating   0          4s\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod nginx-du0qx -o yaml|grep \"image:\"\n  - image: nginx:1.7.1\n    image: nginx:1.7.1\n\n[root@master ~]# docker ps\nCONTAINER ID    IMAGE          COMMAND      CREATED              STATUS              PORTS    NAMES\n6381c2a09d64    nginx:1.7.1    \"nginx\"      About a minute ago   Up About a minute            k8s_nginx.eff1001d_nginx-du0qx_default_b39e9ff4-a5ab-11e6-991f-000c291946c5_b39a845b\n\n\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3002\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u30921.7.1\u304b\u30891.9.1\u306b\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3059\u308b\u3002\n[root@master ~]# kubectl rolling-update nginx --image=nginx:1.9.1\nCreated nginx-b1c0dfc3c6acc641415953ffec068cfd\nScaling up nginx-b1c0dfc3c6acc641415953ffec068cfd from 0 to 1, scaling down nginx from 1 to 0 (keep 1 pods available, don't exceed 2 pods)\nScaling nginx-b1c0dfc3c6acc641415953ffec068cfd up to 1\n\n- \u3057\u3070\u3089\u304f\u5f85\u3064\n\nScaling nginx down to 0\nUpdate succeeded. Deleting old controller: nginx\nRenaming nginx-b1c0dfc3c6acc641415953ffec068cfd to nginx\nreplicationcontroller \"nginx\" rolling updated\n\n\n\u4e0a\u8a18\u300c\u3057\u3070\u3089\u304f\u5f85\u3064\u300d\u306e\u3068\u304d\u3001\u5225\u306e\u7aef\u672b\u3067Pod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\u66f4\u65b0\u524d\u306ePod\u3068\u65b0\u3057\u3044Pod\u306e2\u3064\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                                           READY     STATUS    RESTARTS   AGE\nnginx-b1c0dfc3c6acc641415953ffec068cfd-w7ka2   1/1       Running   0          9s\nnginx-du0qx                                    1/1       Running   0          11m\n\nrolling-update\u304c\u7d42\u4e86\u3057\u305f\u5f8c\u3001Pod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\u65b0\u3057\u304f\u8d77\u52d5\u3057\u305fPod\u3060\u3051\u304c\u52d5\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                                           READY     STATUS    RESTARTS   AGE\nnginx-b1c0dfc3c6acc641415953ffec068cfd-w7ka2   1/1       Running   0          2m\n\n\n\n3.19 kubectl logs(Pod\u304c\u6a19\u6e96\u51fa\u529b\u306b\u51fa\u529b\u3059\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8868\u793a\u3059\u308b\uff09\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl run httpd --image=httpd\ndeployment \"httpd\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nhttpd-2047761252-vrz7s   1/1       Running   0          2m\n\nDeployment\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get deployment\nNAME      DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\nhttpd     1         1         1            1           2m\n\nService\u3092\u4f5c\u6210\u3059\u308b\u3002\u30db\u30b9\u30c8\u306e\u30dd\u30fc\u30c8\u756a\u53f78888\u3092\u30b3\u30f3\u30c6\u30ca\u306e\u30dd\u30fc\u30c8\u756a\u53f780\u306b\u30de\u30c3\u30d7\u3059\u308b\u3002\n[root@master ~]# kubectl expose deployment httpd --port=8888 --target-port=80\nservice \"httpd\" exposed\n\nService\u3092\u4f5c\u6210\u3059\u308b\u3002--port\u306f\u30db\u30b9\u30c8\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u3001--target-port\u306fPod\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u3002\n[root@master ~]# kubectl expose deployment httpd --port=8888 --target-port=80\nservice \"httpd\" exposed\n\nService\u3068\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u60c5\u5831\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30db\u30b9\u30c8\u5074(10.254.92.77:8888) <-> Pod(10.1.72.2:80)\u306e\u95a2\u4fc2\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get svc\nNAME         CLUSTER-IP      EXTERNAL-IP   PORT(S)         AGE\nhttpd        10.254.92.77    <none>        8888/TCP        15m\n[root@master ~]# kubectl get endpoints\nNAME         ENDPOINTS            AGE\nhttpd        10.1.72.2:80         15m\n\n\nPod(httpd)\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n[root@master ~]# curl http://10.254.92.77:8888\n<html><body><h1>It works!</h1></body></html>\n\nHTTP\u30a2\u30af\u30bb\u30b9\u3057\u305f\u30ed\u30b0\u304c\u51fa\u529b\u3055\u308c\u308b\u3002\n[root@master ~]# kubectl logs httpd-2047761252-vrz7s\nAH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 10.1.72.2. Set the 'ServerName' directive globally to suppress this message\nAH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 10.1.72.2. Set the 'ServerName' directive globally to suppress this message\n[Sun Nov 06 12:06:42.420907 2016] [mpm_event:notice] [pid 1:tid 140692115355520] AH00489: Apache/2.4.23 (Unix) configured -- resuming normal operations\n[Sun Nov 06 12:06:42.446383 2016] [core:notice] [pid 1:tid 140692115355520] AH00094: Command line: 'httpd -D FOREGROUND'\n192.168.0.100 - - [06/Nov/2016:12:07:33 +0000] \"GET / HTTP/1.1\" 200 45\n\n\u3082\u3046\u4e00\u5ea6HTTP\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n[root@master ~]# curl http://10.254.92.77:8888\n<html><body><h1>It works!</h1></body></html>\n\n2\u56de\u76ee\u306eHTTP\u30a2\u30af\u30bb\u30b9\u306e\u30ed\u30b0\u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl logs httpd-2047761252-vrz7s\nAH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 10.1.72.2. Set the 'ServerName' directive globally to suppress this message\nAH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 10.1.72.2. Set the 'ServerName' directive globally to suppress this message\n[Sun Nov 06 12:06:42.420907 2016] [mpm_event:notice] [pid 1:tid 140692115355520] AH00489: Apache/2.4.23 (Unix) configured -- resuming normal operations\n[Sun Nov 06 12:06:42.446383 2016] [core:notice] [pid 1:tid 140692115355520] AH00094: Command line: 'httpd -D FOREGROUND'\n192.168.0.100 - - [06/Nov/2016:12:07:33 +0000] \"GET / HTTP/1.1\" 200 45\n192.168.0.100 - - [06/Nov/2016:12:07:52 +0000] \"GET / HTTP/1.1\" 20\n\n\u6700\u5f8c\u306e2\u884c\u3060\u3051\u30ed\u30b0\u3092\u51fa\u529b\u3059\u308b\u3002--tail=2 \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u308b\u3002\n[root@master ~]# kubectl logs --tail=2 httpd-2047761252-vrz7s\n192.168.0.100 - - [06/Nov/2016:12:07:33 +0000] \"GET / HTTP/1.1\" 200 45\n192.168.0.100 - - [06/Nov/2016:12:07:52 +0000] \"GET / HTTP/1.1\" 200 45\n\n\n\n\n\u30aa\u30d7\u30b7\u30e7\u30f3\u4f7f\u7528\u4f8b\n\u610f\u5473\n\n\n\n\n--tail=2\n\u6700\u5f8c\u306e2\u884c\u3060\u3051\u30ed\u30b0\u3092\u51fa\u529b\u3059\u308b\n\n\n--since=10s\n\u6700\u5f8c\u306e10\u79d2\u9593\u306e\u30ed\u30b0\u3092\u51fa\u529b\u3059\u308b\n\n\n--since=1m\n\u6700\u5f8c\u306e1\u5206\u9593\u306e\u30ed\u30b0\u3092\u51fa\u529b\u3059\u308b\n\n\n--since=2H\n\u6700\u5f8c\u306e2\u6642\u9593\u306e\u30ed\u30b0\u3092\u51fa\u529b\u3059\u308b\n\n\n\n\n3.20 kubectl config(\u30af\u30e9\u30b9\u30bf\u7ba1\u7406\u3092\u884c\u3046\uff09\n\n3.20.1 kubectl config \u3092\u4f7f\u3063\u305f\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u5207\u308a\u66ff\u3048\u306e\u5b9f\u65bd\u4f8b\n--------------------------------------\n1. \u691c\u8a3c\u74b0\u5883\n--------------------------------------\n- master1,master2\u306e2\u53f0\u69cb\u6210\u3002OS\u306fCentOS7.2\u3002\n- master1\u3067\u69cb\u6210\u3059\u308b\u74b0\u5883\u3092\u30ed\u30fc\u30ab\u30eb\u30af\u30e9\u30b9\u30bf\u3001master2\u3067\u69cb\u6210\u3059\u308b\u74b0\u5883\u3092\u30ea\u30e2\u30fc\u30c8\u30af\u30e9\u30b9\u30bf\u3068\u547c\u3076\u3002\n- master1,master2\u306f\u30de\u30b9\u30bf\u6a5f\u80fd\u3092\u6301\u3063\u3066\u3044\u308b\u3002\u3064\u307e\u308a\u3001kube-apiserver\u304c\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3002\n\n  (\u6ce8)\u691c\u8a3c\u74b0\u5883\u304c\u8ca7\u5f31\u306a\u306e\u3067\u3001\u30af\u30e9\u30b9\u30bf\u5185\u306e\u30db\u30b9\u30c8\u306f\u30de\u30b9\u30bf\u306e\u307f\u3001\u30ce\u30fc\u30c9\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n--------------------------------------\n2. \u76ee\u6a19\n--------------------------------------\n\u672c\u5b9f\u65bd\u4f8b\u3067\u306f\u3001master1\u3067\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u5207\u308a\u66ff\u3048\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067\u3001\n\u30ed\u30fc\u30ab\u30eb\u30af\u30e9\u30b9\u30bf\u3001\u30ea\u30e2\u30fc\u30c8\u30af\u30e9\u30b9\u30bf\u306ePod\u306e\u72b6\u614b\u304c\u53c2\u7167\u3067\u304d\u308b\u3053\u3068\u3092\u793a\u3059\u3002\n\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u306f\u3001\u30e6\u30fc\u30b6\u3068\u30af\u30e9\u30b9\u30bf\u306e\u7d44\u3092\u610f\u5473\u3059\u308b\u3002\n\n\u306a\u304a\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306b\u3064\u3044\u3066\u306f\u8003\u616e\u3057\u3066\u3044\u306a\u3044\u3002\n\n--------------------------------------\n3. \u6e96\u5099(\u30ed\u30fc\u30ab\u30eb\u30af\u30e9\u30b9\u30bf\u3067Pod\u3092\u8d77\u52d5\u3059\u308b)\n--------------------------------------\n[root@master1 ~]# kubectl run local-nginx --image=nginx\ndeployment \"local-nginx\" created\n\n[root@master1 ~]# kubectl get pod\nNAME                           READY     STATUS    RESTARTS   AGE\nlocal-nginx-1294491604-jnqwn   1/1       Running   0          19s\n\n--------------------------------------\n4. \u6e96\u5099(\u30ea\u30e2\u30fc\u30c8\u30af\u30e9\u30b9\u30bf\u3067Pod\u3092\u8d77\u52d5\u3059\u308b)\n--------------------------------------\n[root@master2 ~]# kubectl run remote-nginx --image=nginx\ndeployment \"remote-nginx\" created\n\n[root@master2 ~]# kubectl get pod\nNAME                            READY     STATUS    RESTARTS   AGE\nremote-nginx-1644388566-i26w1   1/1       Running   0          13m\n\n--------------------------------------\n5. \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u4f5c\u6210\u3059\u308b\n--------------------------------------\n\u3053\u308c\u4ee5\u964d\u306e\u4f5c\u696d\u306f\u5168\u3066\u30ed\u30fc\u30ab\u30eb\u30af\u30e9\u30b9\u30bf(master1)\u3067\u884c\u3046\u3002\n\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u4f5c\u6210\u306f\u3001set-credentials -> set-cluster -> set-context \u306e\u9806\u3067\u30b5\u30d6\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3059\u308b\u3002\u30ed\u30fc\u30ab\u30eb\u30af\u30e9\u30b9\u30bf\u3001\u30ea\u30e2\u30fc\u30c8\u30af\u30e9\u30b9\u30bf\u7528\u306b2\u3064\u4f5c\u6210\u3059\u308b\u3002\"local-user\",\"remote-user\"\u306f\u4efb\u610f\u306e\u540d\u524d\u3067\u826f\u3044\u3002\n[root@master1 ~]# kubectl config set-credentials local-user --username=hana --password=hana\nuser \"local-user\" set.\n[root@master1 ~]# kubectl config set-credentials remote-user --username=shin --password=shin\nuser \"remote-user\" set.\n\n\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u6210\u3059\u308b\u3002\u30ed\u30fc\u30ab\u30eb\u30af\u30e9\u30b9\u30bf\u3001\u30ea\u30e2\u30fc\u30c8\u30af\u30e9\u30b9\u30bf\u7528\u306b2\u3064\u4f5c\u6210\u3059\u308b\u3002\"localhost\",\"remotehost\"\u306f\u4efb\u610f\u306e\u540d\u524d\u3067\u826f\u3044\u3002\n[root@master1 ~]# kubectl config set-cluster localhost --insecure-skip-tls-verify=true --server=http://master1:8080\ncluster \"localhost\" set.\n[root@master1 ~]# kubectl config set-cluster remotehost --insecure-skip-tls-verify=true --server=http://master2:8080\ncluster \"remotehost\" set.\n\n\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u4f5c\u6210\u3059\u308b\u3002\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u4f5c\u6210\u3059\u308b\u3053\u3068\u3067\u3001\u30e6\u30fc\u30b6\u3068\u30af\u30e9\u30b9\u30bf\u304c\u7d10\u4ed8\u3051\u3055\u308c\u308b\u3002\n[root@master1 ~]# kubectl config set-context local-contex --user=local-user --cluster=localhost\ncontext \"local-contex\" set.\n[root@master1 ~]# kubectl config set-context remote-contex --user=remote-user --cluster=remotehost\ncontext \"remote-contex\" set.\n\n---------------------------------------------\n5. \u30ed\u30fc\u30ab\u30eb\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306ePod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n---------------------------------------------\n\u4f7f\u7528\u3059\u308b\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\"local-contex\"\u306b\u5207\u308a\u66ff\u3048\u308b\n[root@master1 ~]# kubectl config use-context local-contex\nswitched to context \"local-contex\".\n\n\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u78ba\u8a8d\u3059\u308b\u3002\"local-contex\"\u306b\u5207\u308a\u66ff\u308f\u3063\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master1 ~]# kubectl config current-context\nlocal-contex\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30ed\u30fc\u30ab\u30eb\u30af\u30e9\u30b9\u30bf\u306ePod\u304c\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n[root@master1 ~]# kubectl get pod\nNAME                           READY     STATUS    RESTARTS   AGE\nlocal-nginx-1294491604-jnqwn   1/1       Running   0          2m\n\n---------------------------------------------\n6. \u30ea\u30e2\u30fc\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306ePod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n---------------------------------------------\n\u4f7f\u7528\u3059\u308b\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\"remote-contex\"\u306b\u5207\u308a\u66ff\u3048\u308b\n[root@master1 ~]# kubectl config use-context remote-contex\nswitched to context \"remote-contex\".\n\n\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u78ba\u8a8d\u3059\u308b\u3002\"remote-contex\"\u306b\u5207\u308a\u66ff\u308f\u3063\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master1 ~]# kubectl config current-context\nremote-contex\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30ea\u30e2\u30fc\u30c8\u30af\u30e9\u30b9\u30bf\u306ePod\u304c\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n[root@master1 ~]# kubectl get pod\nNAME                            READY     STATUS    RESTARTS   AGE\nremote-nginx-1644388566-i26w1   1/1       Running   0          3m\n\n---------------------------------------------\n7. \u30ea\u30e2\u30fc\u30c8\u30af\u30e9\u30b9\u30bf\u3067Pod\u3092\u4f5c\u6210\u3059\u308b\u3002\n---------------------------------------------\n\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u78ba\u8a8d\u3059\u308b\u3002\"remote-contex\"\u3067\u3042\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master1 ~]# kubectl config current-context\nremote-contex\n\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master1 ~]# kubectl run httpd --image=httpd\ndeployment \"httpd\" created\n\nPod\u3092\u78ba\u8a8d\u3059\u308b\u3002nginx\u306b\u52a0\u3048\u3001httpd\u306ePod\u3082\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master1 ~]# kubectl get pod\nNAME                            READY     STATUS    RESTARTS   AGE\nhttpd-2047761252-6ywrg          1/1       Running   0          55s\nremote-nginx-1644388566-i26w1   1/1       Running   0          1h\n\nmaster2\u3067\u3082Pod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3002httpd\u306ePod\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master2 ~]# kubectl get pod\nNAME                            READY     STATUS    RESTARTS   AGE\nhttpd-2047761252-6ywrg          1/1       Running   0          1m\nremote-nginx-1644388566-i26w1   1/1       Running   0          1h\n[root@master2 ~]#\n\n\u30ea\u30e2\u30fc\u30c8\u30af\u30e9\u30b9\u30bf\u306ePod\u3092\u5168\u3066\u7d42\u4e86\u3059\u308b\u3002\n[root@master1 ~]# kubectl delete deployment remote-nginx\ndeployment \"remote-nginx\" deleted\n[root@master1 ~]# kubectl delete deployment httpd\ndeployment \"httpd\" deleted\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\u5168\u3066\u306ePod\u304c\u7d42\u4e86\u3057\u305f\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n[root@master1 ~]# kubectl get pod\n[root@master1 ~]#\n\n---------------------------------------------\n8. \u8a2d\u5b9a\u5185\u5bb9\u306e\u78ba\u8a8d\u65b9\u6cd5(view)\n---------------------------------------------\n[root@master1 ~]# kubectl config view\napiVersion: v1\nclusters:\n- cluster:\n    insecure-skip-tls-verify: true\n    server: http://master1:8080\n  name: localhost\n- cluster:\n    insecure-skip-tls-verify: true\n    server: http://master2:8080\n  name: remotehost\ncontexts:\n- context:\n    cluster: localhost\n    user: local-user\n  name: local-contex\n- context:\n    cluster: remotehost\n    user: remote-user\n  name: remote-contex\ncurrent-context: remote-contex\nkind: Config\npreferences: {}\nusers:\n- name: local-user\n  user:\n    password: hana\n    username: hana\n- name: remote-user\n  user:\n    password: shin\n    username: shin\n[root@master1 ~]#\n\n\u306a\u304a\u3001\u4e0a\u8a18\u30b3\u30de\u30f3\u30c9\u306f\u3001~/.kube/config\u306b\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u8a2d\u5b9a\u3092\u8868\u793a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n\n3.21 stop (\u5ec3\u6b62\u4e88\u5b9a\u306a\u306e\u3067\u4f7f\u308f\u306a\u3044\u3053\u3068\uff09\n\u4ee5\u4e0b\u3001man kubectl-stop \u3088\u308a\u5f15\u7528\n\nThe  stop  command  is  deprecated,  all  its  functionalities  are covered by delete command.\nSee 'kubectl delete --help' for more details.\n\n\n3.22 kubectl version (kubernetes\u306e\u7248\u6570\u3092\u8868\u793a\u3059\u308b\uff09\nkubernetes 1.2\u3092\u4f7f\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl version\nClient Version: version.Info{Major:\"1\", Minor:\"2\", GitVersion:\"v1.2.0\", GitCommit:\"ec7364b6e3b155e78086018aa644057edbe196e5\", GitTreeState:\"clean\"}\nServer Version: version.Info{Major:\"1\", Minor:\"2\", GitVersion:\"v1.2.0\", GitCommit:\"ec7364b6e3b155e78086018aa644057edbe196e5\", GitTreeState:\"clean\"}\n\n\n3.23 kubectl cluster-info(\u30af\u30e9\u30b9\u30bf\u306e\u60c5\u5831\u3092\u8868\u793a\u3059\u308b\uff09\n[root@master ~]# kubectl cluster-info\nKubernetes master is running at http://localhost:8080\n\n\n3.24 kubectl api-versions(\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308bAPI\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u8868\u793a\u3059\u308b\uff09\n[root@master ~]# kubectl api-versions\nautoscaling/v1\nbatch/v1\nextensions/v1beta1\nv1\n\n\n3.25 kubectl convert(\u30d5\u30a1\u30a4\u30eb\u5f62\u5f0f\u3092\u5909\u63db(yaml<=>json)\u3059\u308b\u3002)\n[root@master ~]# cat nginx-deployment.yaml\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.7.9\n        ports:\n        - containerPort: 80\n\n\n[root@master ~]# kubectl convert -f nginx-deployment.yaml --local -o json\nrunning in local mode...\n{\n    \"kind\": \"Deployment\",\n    \"apiVersion\": \"extensions/v1beta1\",\n    \"metadata\": {\n        \"name\": \"nginx-deployment\",\n        \"creationTimestamp\": null,\n        \"labels\": {\n            \"app\": \"nginx\"\n        }\n    },\n    \"spec\": {\n        \"replicas\": 1,\n        \"selector\": {\n            \"matchLabels\": {\n                \"app\": \"nginx\"\n            }\n        },\n        \"template\": {\n            \"metadata\": {\n                \"creationTimestamp\": null,\n                \"labels\": {\n                    \"app\": \"nginx\"\n                }\n            },\n            \"spec\": {\n                \"containers\": [\n                    {\n                        \"name\": \"nginx\",\n                        \"image\": \"nginx:1.7.9\",\n                        \"ports\": [\n                            {\n                                \"containerPort\": 80,\n                                \"protocol\": \"TCP\"\n                            }\n                        ],\n                        \"resources\": {},\n                        \"terminationMessagePath\": \"/dev/termination-log\",\n                        \"imagePullPolicy\": \"IfNotPresent\"\n                    }\n                ],\n                \"restartPolicy\": \"Always\",\n                \"terminationGracePeriodSeconds\": 30,\n                \"dnsPolicy\": \"ClusterFirst\",\n                \"securityContext\": {}\n            }\n        },\n        \"strategy\": {\n            \"type\": \"RollingUpdate\",\n            \"rollingUpdate\": {\n                \"maxUnavailable\": 1,\n                \"maxSurge\": 1\n            }\n        }\n    },\n    \"status\": {}\n}\n[root@master ~]#\n\n\n3.26 kubectl explain(\u30ea\u30bd\u30fc\u30b9\u306e\u8aac\u660e)\n[root@master ~]# kubectl explain node\nDESCRIPTION:\nNode is a worker node in Kubernetes, formerly known as minion. Each node will have a unique identifier in the cache (i.e. in etcd).\n\nFIELDS:\n   apiVersion   <string>\n     APIVersion defines the versioned schema of this representation of an\n     object. Servers should convert recognized schemas to the latest internal\n     value, and may reject unrecognized values. More info:\n     http://releases.k8s.io/release-1.2/docs/devel/api-conventions.md#resources\n-\u4ee5\u4e0b\u3001\u7565-\n\n\u4ed6\u306b\u3082\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30ea\u30bd\u30fc\u30b9\u306e\u8aac\u660e\u304c\u3042\u308b\u3002\u30ea\u30bd\u30fc\u30b9\u4e00\u89a7\u3092\u5f97\u305f\u3044\u306a\u3089\u3001kubectl get\u3092\u5165\u529b\u3057\u305f\u3042\u3068\u306b \"TAB\"\u30ad\u30fc\u3092\u62bc\u4e0b\u3059\u308b\u3002\n[root@master ~]# kubectl explain pod\n[root@master ~]# kubectl explain deployment\n[root@master ~]# kubectl explain rc\n\n\n4 \u305d\u306e\u4ed6\n\n4.1 \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u72b6\u614b\u3092\u8abf\u3079\u308b\n[root@master ~]# kubectl get componentstatus\nNAME                 STATUS    MESSAGE              ERROR\ncontroller-manager   Healthy   ok\nscheduler            Healthy   ok\netcd-0               Healthy   {\"health\": \"true\"}\n\netcd\u3092\u505c\u6b62\u3059\u308b\u3002\n[root@master ~]# systemctl stop etcd\n[root@master ~]# systemctl is-active etcd\ninactive\n\n\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002etcd\u3092\u505c\u6b62\u3059\u308b\u3068\u3001etcd\u306e\u884c\u81ea\u4f53\u8868\u793a\u3055\u308c\u306a\u3044\u3088\u3046\u3060\u3002\n[root@master ~]# kubectl get componentstatus\nNAME                 STATUS    MESSAGE   ERROR\nscheduler            Healthy   ok\ncontroller-manager   Healthy   ok\n\n\u6b21\u306b\u3001scheduler\u3092\u505c\u6b62\u3059\u308b\u3002\n[root@master ~]# systemctl stop kube-scheduler.service\n[root@master ~]# systemctl is-active kube-scheduler.service\ninactive\n\n\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002scheduler\u306e\u72b6\u614b\u304c\u300cUnhealthy\u300d\u3068\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002\n[root@master ~]# kubectl get componentstatus\nNAME                 STATUS      MESSAGE                                                                                        ERROR\nscheduler            Unhealthy   Get http://127.0.0.1:10251/healthz: dial tcp 127.0.0.1:10251: getsockopt: connection refused\ncontroller-manager   Healthy     ok\n\n\u6b21\u306b\u3001controller-manager\u3092\u505c\u6b62\u3059\u308b\u3002\n[root@master ~]# systemctl stop kube-controller-manager.service\n[root@master ~]# systemctl is-active kube-controller-manager.service\ninactive\n\n\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002controller-manager\u306e\u72b6\u614b\u304c\u300cUnhealthy\u300d\u3068\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002\n[root@master ~]# kubectl get componentstatus\nNAME                 STATUS      MESSAGE                                                                                        ERROR\ncontroller-manager   Unhealthy   Get http://127.0.0.1:10252/healthz: dial tcp 127.0.0.1:10252: getsockopt: connection refused\nscheduler            Unhealthy   Get http://127.0.0.1:10251/healthz: dial tcp 127.0.0.1:10251: getsockopt: connection refused\n[root@master ~]#\n\netcd,scheduler,controller-manager\u3092\u518d\u5ea6\u8d77\u52d5\u3057\u3066\u3001\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# systemctl start etcd\n[root@master ~]# systemctl start kube-controller-manager.service\n[root@master ~]# systemctl start kube-scheduler.service\n[root@master ~]# kubectl get componentstatus\nNAME                 STATUS    MESSAGE              ERROR\nscheduler            Healthy   ok\ncontroller-manager   Healthy   ok\netcd-0               Healthy   {\"health\": \"true\"}\n\n\n\n4.2 kubectl\u30b3\u30de\u30f3\u30c9\u304c\u5229\u7528\u3057\u3066\u3044\u308bAPI\u3092\u8abf\u3079\u308b\n\u30aa\u30d7\u30b7\u30e7\u30f3\u306b--v=6,7,8\u3092\u6307\u5b9a\u3059\u308b\u3068\u3001kubectl\u5b9f\u884c\u6642\u306b\u5229\u7528\u3057\u3066\u3044\u308bAPI\u3092\u8abf\u3079\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u30026->7->8\u3068\u306a\u308b\u306b\u3064\u308c\u3066\u3001\u3088\u308a\u8a73\u7d30\u306a\u60c5\u5831\u304c\u5f97\u3089\u308c\u308b\u3002\n[root@master ~]# kubectl get pod --v=6\nI1106 18:44:05.765128   10587 round_trippers.go:286] GET http://localhost:8080/api 200 OK in 3 milliseconds\nI1106 18:44:05.769004   10587 round_trippers.go:286] GET http://localhost:8080/apis 200 OK in 1 milliseconds\nI1106 18:44:05.775203   10587 round_trippers.go:286] GET http://localhost:8080/api/v1/namespaces/default/pods 200 OK in 3 milliseconds\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-2040093540-jdy9o   1/1       Running   0          3m\n\n\n--v=7\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\n[root@master ~]# kubectl get pod --v=7\nI1106 18:44:07.691145   10596 round_trippers.go:264] GET http://localhost:8080/api\nI1106 18:44:07.691350   10596 round_trippers.go:271] Request Headers:\nI1106 18:44:07.691380   10596 round_trippers.go:274]     Accept: application/json, */*\nI1106 18:44:07.691407   10596 round_trippers.go:274]     User-Agent: kubectl/v1.2.0 (linux/amd64) kubernetes/ec7364b\nI1106 18:44:07.696376   10596 round_trippers.go:289] Response Status: 200 OK in 4 milliseconds\nI1106 18:44:07.697985   10596 round_trippers.go:264] GET http://localhost:8080/apis\nI1106 18:44:07.698169   10596 round_trippers.go:271] Request Headers:\nI1106 18:44:07.698224   10596 round_trippers.go:274]     User-Agent: kubectl/v1.2.0 (linux/amd64) kubernetes/ec7364b\nI1106 18:44:07.698280   10596 round_trippers.go:274]     Accept: application/json, */*\nI1106 18:44:07.700849   10596 round_trippers.go:289] Response Status: 200 OK in 2 milliseconds\nI1106 18:44:07.703040   10596 round_trippers.go:264] GET http://localhost:8080/api/v1/namespaces/default/pods\nI1106 18:44:07.703818   10596 round_trippers.go:271] Request Headers:\nI1106 18:44:07.704378   10596 round_trippers.go:274]     Accept: application/json, */*\nI1106 18:44:07.705106   10596 round_trippers.go:274]     User-Agent: kubectl/v1.2.0 (linux/amd64) kubernetes/ec7364b\nI1106 18:44:07.709303   10596 round_trippers.go:289] Response Status: 200 OK in 3 milliseconds\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-2040093540-jdy9o   1/1       Running   0          3m\n[root@master ~]#\n\n\n4.3 \u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u3068\u304d\u3001target-port\u306b\u3069\u3093\u306a\u5024\u3092\u6307\u5b9a\u3059\u308b\u306e\u304b\uff1f\n\u30a4\u30e1\u30fc\u30b8\u304cExposedPorts\u3068\u3057\u3066Expose\u3057\u3066\u3044\u308b\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u6307\u5b9a\u3059\u308b\u3002\u305f\u3081\u3057\u306b\u3001httpd \u306e\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u3068\u304d\u3001target-port\u306b100\u756a\u3092\u6307\u5b9a\u3057\u3066\u307f\u305f\u3068\u3053\u308d\u3001Pod\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u306a\u304b\u3063\u305f\u3002ExposedPorts\u306e\u8aac\u660e\u306f https://docs.docker.com/docker-cloud/apps/ports/ \u3092\u53c2\u7167\u3057\u307e\u3057\u305f\u3002\n[root@master ~]# kubectl run httpd --image=httpd\ndeployment \"httpd\" created\n\n[root@master ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nhttpd-2047761252-fmrmn   1/1       Running   0          12s\n\n[root@master ~]# kubectl expose deployment httpd --port=8888 --target-port=100\nservice \"httpd\" exposed\n\n\u30b5\u30fc\u30d3\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get svc\nNAME         CLUSTER-IP      EXTERNAL-IP   PORT(S)         AGE\nhttpd        10.254.40.137   <none>        8888/TCP        5s\n\n\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u60c5\u5831\u3092\u78ba\u8a8d\u3059\u308b\u3002Pod\u5074\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u304c100\u756a\u306b\u306a\u3063\u305f\n[root@master ~]# kubectl get endpoints\nNAME         ENDPOINTS            AGE\nhttpd        10.1.72.2:100        8s\n\n[root@master ~]# curl http://10.254.40.137:8888\ncurl: (7) Failed connect to 10.254.40.137:8888; \u63a5\u7d9a\u3092\u62d2\u5426\u3055\u308c\u307e\u3057\u305f\n\n\n[root@master ~]# docker images |grep httpd\ndocker.io/httpd                                       latest              9a0bc463edaa        2 weeks ago         193.3 MB\n[root@master ~]# docker inspect httpd|grep -A2 ExposedPorts\n            \"ExposedPorts\": {\n                \"80/tcp\": {}\n            },\n--\n            \"ExposedPorts\": {\n                \"80/tcp\": {}\n            },\n\n\n\n4.4 \u6307\u5b9a\u3057\u305f\u30db\u30b9\u30c8\u3067Pod\u3092\u8d77\u52d5\u3059\u308b(nodeSelector\u3092\u4f7f\u3046)\n\u30db\u30b9\u30c8\u306e\u30e9\u30d9\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master1 ~]# kubectl get node --show-labels\nNAME      STATUS    AGE       LABELS\nmaster1   Ready     3h        kubernetes.io/hostname=master1\nmaster2   Ready     3h        kubernetes.io/hostname=master2\n\nPod\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\nPod\u3092master2\u3067\u8d77\u52d5\u3059\u308b\u306e\u3067\u3001nodeSelector\u306b\"kubernetes.io/hostname: master2\"\u3092\u6307\u5b9a\u3059\u308b\u3002\n[root@master1 ~]# vi centos.yaml\n[root@master1 ~]# cat centos.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: centos\n  labels:\n    app: web\nspec:\n  containers:\n    - name: centos6\n      image: centos:centos6\n      command: [\"sleep\", \"3600\"]\n    - name: centos7\n      image: centos:centos7\n      command: [\"sleep\", \"3600\"]\n  nodeSelector:\n    kubernetes.io/hostname: master2\n\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master1 ~]# kubectl create -f centos.yaml\npod \"centos\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002master2\u3067\u52d5\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master1 ~]# kubectl get pod -o wide --show-labels\nNAME                          READY     STATUS    RESTARTS   AGE       NODE      LABELS\ncentos                        2/2       Running   0          10s       master2   app=web\n\n\u305f\u3081\u3057\u306b\u3001centos7\u3067bash\u3092\u5b9f\u884c\u3057\u3066\u307f\u308b\u3002centos7.3\u3067\u3042\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master1 ~]# kubectl exec centos -c centos7 -it bash\n[root@centos /]# cat /etc/redhat-release\nCentOS Linux release 7.3.1611 (Core)\n[root@centos /]# exit\nexit\n\n\u305f\u3081\u3057\u306b\u3001centos6\u3067bash\u3092\u5b9f\u884c\u3057\u3066\u307f\u308b\u3002centos6.8\u3067\u3042\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master1 ~]# kubectl exec centos -c centos6 -it bash\n[root@centos /]# cat /etc/redhat-release\nCentOS release 6.8 (Final)\n[root@centos /]# exit\nexit\n\nPod\u3092\u7d42\u4e86\u3059\u308b\u3002\n[root@master1 ~]# kubectl delete pod centos\npod \"centos\" deleted\n\n\n\n4.5 kubelet\u306ePod\u8d77\u52d5\u65b9\u6cd5\nPod\u3092\u8d77\u52d5\u3059\u308b\u306b\u306f\u3001kubectl run\u3092\u5b9f\u884c\u3059\u308b\u65b9\u6cd5\u4ee5\u5916\u306b\u3001\u4ed6\u306b3\u3064\u306e\u65b9\u6cd5\u304c\u3042\u308b(man kubelet\u3088\u308a\uff09\n\u672c\u7ae0\u3067\u306f\u3001Pod\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u306e\u683c\u7d0d\u5834\u6240\u3092kubelet\u306e\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u306b\u5b9a\u7fa9\u3059\u308b\u65b9\u6cd5\u306b\u3064\u3044\u3066\u8aac\u660e\u3059\u308b\u3002\n-----------------------------------------------\n1. \u53c2\u8003\u60c5\u5831\n------------------------------------------------\nkubelet\u306ePod\u8d77\u52d5\u65b9\u6cd5\u3002man kubelet\u3088\u308a\u629c\u7c8b\u3002\n\n  (1) kube-apiserver\u304b\u3089\u306e\u6307\u793a(kubectl run\u3067\u8d77\u52d5\u3059\u308b\u65b9\u6cd5)\n  (2) kubelet\u304cpod\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3093\u3067Pod\u3092\u8d77\u52d5\u3059\u308b\u65b9\u6cd5(\u3053\u3053\u306e\u8aac\u660e)\n  (3) HTTP  endpoint\u306b\u3088\u308b\u65b9\u6cd5\n  (4) HTTP server\u306b\u3088\u308b\u65b9\u6cd5\n\n\u4ed6\u306e\u53c2\u8003\u60c5\u5831\nhttp://kubernetes.io/docs/admin/static-pods/\n\n-----------------------------------------------\n2. \u5b9f\u65bd\u624b\u9806\n------------------------------------------------\nPod\u306e\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb(yaml)\u3092\u683c\u7d0d\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@node1 ~]# mkdir -p /etc/kubernetes/manifests\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u683c\u7d0d\u5834\u6240\u3092kubelet\u306e\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u306b\u6307\u5b9a\u3059\u308b\u3002\n[root@node1 ~]# vi /etc/kubernetes/kubelet\nKUBELET_ARGS=\"--config=/etc/kubernetes/manifests\"\n\n\u30c6\u30b9\u30c8\u7528\u306ePod(httpd)\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@node1 ~]# vi /etc/kubernetes/manifests/httpd.yaml\n[root@node1 ~]# cat /etc/kubernetes/manifests/httpd.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: httpd\nspec:\n  containers:\n  - name: httpd\n    image: httpd\n    ports:\n    - containerPort: 8080\n\n\n\u30c6\u30b9\u30c8\u7528\u306ePod(Nginx)\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@node1 ~]# vi /etc/kubernetes/manifests/nginx.yaml\n[root@node1 ~]# cat /etc/kubernetes/manifests/nginx.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\nspec:\n  containers:\n  - name: nginx\n    image: nginx\n    ports:\n    - containerPort: 80\n\n\u4f5c\u6210\u3057\u305fPod\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@node1 ~]# ls /etc/kubernetes/manifests/\nhttpd.yaml  nginx.yaml\n\nkubelet\u3092\u518d\u8d77\u52d5\u3059\u308b\u3002\n[root@node1 ~]# systemctl restart kubelet.service\n\nkubelet\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@node1 ~]# systemctl is-active kubelet.service\nactive\n\nkubelet\u306e\u8d77\u52d5\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u78ba\u8a8d\u3059\u308b\u30021\u884c\u304c\u9577\u3044\u306e\u3067\u6298\u308a\u8fd4\u3057\u3066\u3044\u307e\u3059\u3002\nPod\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u306e\u683c\u7d0d\u5834\u6240(\u2605\u5370)\u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@node1 ~]# ps aux |grep kubelet\nroot       6795 11.0  4.1 425032 41628 ?        Ssl  09:42   0:54 /usr/bin/kubelet \n    --logtostderr=true \n    --v=0 \n    --api-servers=http://master1:8080 \n    --address=0.0.0.0 \n    --allow-privileged=false \n    --pod-infra-container-image=registry.access.redhat.com/rhel7/pod-infrastructure:latest \n  \u2605--config=/etc/kubernetes/manifests\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30b3\u30f3\u30c6\u30ca\u304c2\u3064(Httpd,Nginx)\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@node1 ~]# docker ps\nCONTAINER ID        IMAGE                                                        COMMAND                  CREATED              STATUS              PORTS               NAMES\n50577e1e4446        nginx                                                        \"nginx -g 'daemon off\"   About a minute ago   Up About a minute                       k8s_nginx.7270fc8f_nginx-node1_default_ca6112932ce36c625ac20a3916ea5bac_32042029\n795272acc6ef        httpd                                                        \"httpd-foreground\"       About a minute ago   Up About a minute                       k8s_httpd.ccebfcf7_httpd-node1_default_df10c6d7dec5867a7c313e234344ce45_ec8dd867\nba1b7228adb5        registry.access.redhat.com/rhel7/pod-infrastructure:latest   \"/pod\"                   2 minutes ago        Up About a minute                       k8s_POD.c36b0a77_nginx-node1_default_ca6112932ce36c625ac20a3916ea5bac_fe690ed7\nbc90da1e0bb3        registry.access.redhat.com/rhel7/pod-infrastructure:latest   \"/pod\"                   2 minutes ago        Up About a minute                       k8s_POD.3e750adf_httpd-node1_default_df10c6d7dec5867a7c313e234344ce45_554c2cd3\n[root@node1 ~]#\n\nPod\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@node1 manifests]# pwd\n/etc/kubernetes/manifests\n[root@node1 manifests]# ls\nhttpd.yaml  nginx.yaml\n\nkubelet\u304cPod\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u3081\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u3002\n[root@node1 manifests]# mv httpd.yaml ../\n[root@node1 manifests]# mv nginx.yaml ../\n[root@node1 manifests]# ls\n[root@node1 manifests]#\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002Pod\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u304c\u8aad\u3081\u306a\u304f\u306a\u308a\u3001kubelet\u304c\u30b3\u30f3\u30c6\u30ca\u3092\u7d42\u4e86\u3055\u305b\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@node1 ~]# docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n[root@node1 ~]#\n\n\nhttpd\u306ePod\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3060\u3051\u3001kubelet\u304c\u8aad\u3081\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n[root@node1 manifests]# cp ../httpd.yaml .\n[root@node1 manifests]# ls\nhttpd.yaml\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002Httpd\u306e\u30b3\u30f3\u30c6\u30ca\u3060\u3051\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@node1 manifests]# docker ps\nCONTAINER ID        IMAGE                                                        COMMAND              CREATED             STATUS                  PORTS               NAMES\nb0aac7802de2        httpd                                                        \"httpd-foreground\"   3 seconds ago       Up Less than a second                       k8s_httpd.ccebfcf7_httpd-node1_default_df10c6d7dec5867a7c313e234344ce45_75d498d0\ne0bae879cd72        registry.access.redhat.com/rhel7/pod-infrastructure:latest   \"/pod\"               16 seconds ago      Up 12 seconds                               k8s_POD.3e750adf_httpd-node1_default_df10c6d7dec5867a7c313e234344ce45_b22b86a6\n[root@node1 manifests]#\n\n\n\n4.6 Pod,RC(ReplicationController),Deployment\u306eyaml\u30d5\u30a1\u30a4\u30eb\nbusybox\u306ePod\u3092\u8d77\u52d5\u3059\u308b\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092Pod,RC,Deployment\u3068\u3057\u3066\u4f5c\u6210\u3057\u305f\u3002\nThe spec schema\n---------------------------------------\n1. Pod\n---------------------------------------\nPod\u306e\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\n[root@master1 test]# cat test.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n   name: busybox-test\nspec:\n  containers:\n    - name: busybox\n      image: busybox\n      command: [\"sleep\", \"3600\"]\n\n[root@master1 test]# kubectl create -f test.yaml\npod \"busybox-test\" created\n\n[root@master1 test]# kubectl get pod\nNAME           READY     STATUS    RESTARTS   AGE\nbusybox-test   1/1       Running   0          46s\n\n\n---------------------------------------\n2. ReplicationController\n---------------------------------------\n[root@master1 test]# cat test2.yaml\napiVersion: v1\nkind: ReplicationController\nmetadata:\n  name: busybox-test\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: busybox\n    spec:\n      containers:\n      - name: nginx\n        image: nginx\n        command: [\"sleep\", \"3600\"]\n\n[root@master1 test]# kubectl create -f test2.yaml\nreplicationcontroller \"busybox-test\" created\n\n[root@master1 test]# kubectl get pod\nNAME                 READY     STATUS    RESTARTS   AGE\nbusybox-test-vcpjd   1/1       Running   0          17s\n\n[root@master1 test]# kubectl get rc\nNAME           DESIRED   CURRENT   AGE\nbusybox-test   1         1         20s\n[root@master1 test]#\n\n---------------------------------------\n3. Deployment\n---------------------------------------\n[root@master1 test]# cat test3.yaml\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: busybox-test\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: busybox\n    spec:\n      containers:\n      - name: busybox\n        image: busybox\n        command: [\"sleep\", \"3600\"]\n[root@master1 test]#\n\n[root@master1 test]# kubectl create -f test3.yaml\ndeployment \"busybox-test\" created\n\n[root@master1 test]# kubectl get pod\nNAME                           READY     STATUS    RESTARTS   AGE\nbusybox-test-308240389-dgcor   1/1       Running   0          27s\n\n[root@master1 test]# kubectl get deployment\nNAME           DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\nbusybox-test   1         1         1            1           34s\n\n\n\n\n4.7 \u30ea\u30bd\u30fc\u30b9\u5236\u5fa1(ResourceQuota,limitrange)\n\nResourceQuota\n\u8d77\u52d5\u3059\u308bpod\u6570\u3092namespace\u6bce\u306b\u6700\u5927100\u500b\u307e\u3067\u3001\u3068\u3044\u3063\u305f\u5236\u9650\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u304d\u306b\u4f7f\u3046\u3002\ncpu,memory\u3082\u8a2d\u5b9a\u53ef\u80fd\u3002\u307e\u305f\u3001\u4f7f\u7528\u4e2d\u306e\u30ea\u30bd\u30fc\u30b9\u91cf\u3092\u8868\u793a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\nlimitrange\nContainer\u304c\u4f7f\u7528\u3059\u30ea\u30bd\u30fc\u30b9(cpu,memory)\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3001\u304a\u3088\u3073\u4e0a\u9650\u5024\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3067\u306f\u306a\u304f\u3001\u4efb\u610f\u306e\u5024\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u306f\u3001Container\u8d77\u52d5\u6642\u3001\u30b3\u30de\u30f3\u30c9\u306e\n\u30aa\u30d7\u30b7\u30e7\u30f3(--requests=memory,--requests=cpu)\u306b\u4f7f\u7528\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u91cf\u3092\u660e\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n\u305f\u3060\u3057\u4e0a\u9650\u5024\u3092\u8d85\u3048\u3066\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u306a\u3044\u3002\n\n----------------\n1. \u4e8b\u524d\u6e96\u5099\n----------------\napiserver\u306e\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u7de8\u96c6\u3059\u308b\u3002LimitRanger\u3092\u6709\u52b9\u306b\u3059\u308b\u3002\n[root@master ~]# vi /etc/kubernetes/apiserver\nKUBE_ADMISSION_CONTROL=\"--admission-control=LimitRanger\"\n\n[root@master resource]# cat quota.yaml\napiVersion: v1\nkind: ResourceQuota\nmetadata:\n  name: quota\nspec:\n  hard:\n    cpu: \"10\"\n    memory: 1Gi\n    pods: \"2\"\n    replicationcontrollers: \"5\"\n    resourcequotas: \"1\"\n    services: \"5\"\n\n\n[root@master resource]# cat limits.yaml\napiVersion: v1\nkind: LimitRange\nmetadata:\n  name: limits\nspec:\n  limits:\n  - max:\n      cpu: \"2\"\n      memory: 1Gi\n    min:\n      cpu: 200m\n      memory: 6Mi\n    type: Pod\n  - default:\n      cpu: 400m\n      memory: 200Mi\n    defaultRequest:\n      cpu: 300m\n      memory: 100Mi\n    max:\n      cpu: \"2\"\n      memory: 500Mi\n    min:\n      cpu: 100m\n      memory: 3Mi\n    type: Container\n\n\n\u30ea\u30bd\u30fc\u30b9\u30af\u30a9\u30fc\u30bf(resourcequota)\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master resource]# kubectl create -f quota.yaml\nresourcequota \"quota\" created\n\n\u30ea\u30bd\u30fc\u30b9\u30af\u30a9\u30fc\u30bf\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master resource]# kubectl describe resourcequota quota\nName:                   quota\nNamespace:              default\nResource                Used    Hard\n--------                ----    ----\ncpu                     0       10\nmemory                  0       1Gi\npods                    0       2\nreplicationcontrollers  0       5\nresourcequotas          1       1\nservices                1       5\n\n\n\nlimitrange\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master resource]# kubectl create -f limits.yaml\nlimitrange \"limits\" created\n\nlimitrange\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master resource]# kubectl describe limitrange limits\nName:           limits\nNamespace:      default\nType            Resource        Min     Max     Default Request Default Limit   Max Limit/Request Ratio\n----            --------        ---     ---     --------------- -------------   -----------------------\nPod             memory          6Mi     1Gi     -               -               -\nPod             cpu             200m    2       -               -               -\nContainer       cpu             100m    2       300m            400m            -\nContainer       memory          3Mi     500Mi   100Mi           200Mi           -\n\n\n-------------\n2. \u30c6\u30b9\u30c8\n-------------\n[root@master resource]# cat test.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n   name: centos\nspec:\n  containers:\n    - name: centos\n      image: centos\n      command: [\"sleep\", \"36000\"]\n\n\n\n\n5 \u53c2\u8003\u60c5\u5831\n\n5.1 kubernetes\u516c\u5f0f\nDeployments\nSecrets\nUsing ConfigMap\nhigh-availability\nk8s-setup\n\n5.2 \u305d\u306e\u4ed6\nGetting Started with Kubernetes\nSharing secret data in Kubernetes\nKubernetes: \u69cb\u6210\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u4e00\u89a7\nKubernetes\u306eConfigMap\u3092\u8a66\u3057\u3066\u307f\u308b\nKubernetes\u30af\u30e9\u30b9\u30bf\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u3066Dashboard\u3067\u898b\u3048\u308b\u5316\u3092\u8a66\u3057\u3066\u307f\u305f\nKubernetes \u3053\u3068\u59cb\u3081 (2) - Service\u958b\u767a\n#1 \u30b3\u30de\u30f3\u30c9\u4e00\u89a7(kubernetes 1.2)\n### \u4ee5\u4e0b\u306f\u3001man kubectl\u304b\u3089\u629c\u7c8b\u3057\u305f\u3082\u306e\u3002\n- [x] kubectl get\n- [x] kubectl describe\n- [x] kubectl create\n- [x] kubectl create namespace\n- [x] kubectl create secret\n- [ ] kubectl create secret docker-registry\n- [x] kubectl create secret generic\n- [x] kubectl create configmap\n- [ ] kubectl create serviceaccount\n- [x] kubectl replace\n- [ ] kubectl patch\n- [x] kubectl delete\n- [x] kubectl edit\n- [x] kubectl apply\n- [ ] kubectl namespace\n- [x] kubectl logs\n- [x] kubectl rolling-update\n- [x] kubectl scale\n- [x] kubectl cordon\n- [x] kubectl drain\n- [x] kubectl uncordon\n- [x] kubectl attach\n- [x] kubectl exec\n- [ ] kubectl port-forward\n- [x] kubectl proxy\n- [x] kubectl run\n- [x] kubectl stop\n- [x] kubectl expose\n- [ ] kubectl autoscale\n- [x] kubectl rollout\n- [x] kubectl rollout history\n- [x] kubectl rollout undo\n- [ ] kubectl rollout pause\n- [ ] kubectl rollout resume\n- [x] kubectl label\n- [x] kubectl annotate\n- [x] kubectl config\n- [x] kubectl config view\n- [x] kubectl config set-cluster\n- [x] kubectl config set-credentials\n- [x] kubectl config set-context\n- [ ] kubectl config set\n- [ ] kubectl config unset\n- [x] kubectl config current-context\n- [x] kubectl config use-context\n- [x] kubectl cluster-info\n- [x] kubectl api-versions\n- [x] kubectl version\n- [x] kubectl explain\n- [x] kubectl convert\n\n\n#2 \u691c\u8a3c\u74b0\u5883\n- master,node1\u306e2\u53f0\u69cb\u6210\u3002master,node1\u306f\u30db\u30b9\u30c8\u540d.\n- VMware Player\u4e0a\u3067\u52d5\u4f5c\u3059\u308b\u4eee\u60f3\u30de\u30b7\u30f3\u3002OS\u306fCentOS7.2\u3002\n\n\n```\n+--- master ---+    +---- node1 ---+\n|              |    |              |\n|   CentOS7.2  |    |   CentOS7.2  |\n|              |    |              |\n+--------------+    +--------------+\n+----------------------------------+\n|            VMware Player         |\n+----------------------------------+\n```\n\n\n#3 \u30b3\u30de\u30f3\u30c9\u306e\u4f7f\u3044\u65b9\n#3.1 \u4e8b\u524d\u6e96\u5099\n\nbash-completion\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5c0e\u5165\u3059\u308b\u3053\u3068\u3067\u3001kubectl\u30b3\u30de\u30f3\u30c9\u3067TAB\u88dc\u5b8c\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\uff08\u4fbf\u5229\u306b\u306a\u308b\uff09\u3002\n\n```\n[root@master ~]# yum -y epel-release\n[root@master ~]# yum -y bash-completion\n\nkubectl\u3068\u30bf\u30a4\u30d7\u3057\u305f\u3042\u3068\u3001\"TAB\"\u3092\u62bc\u4e0b\u3059\u308b\u3068\u3001\u4e0b\u8a18\u306e\u30b5\u30d6\u30b3\u30de\u30f3\u30c9\u4e00\u89a7\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n[root@master ~]# kubectl\nannotate        autoscale       cordon          drain           expose          namespace       replace         scale\napi-versions    cluster-info    create          edit            get             patch           rolling-update  uncordon\napply           config          delete          exec            label           port-forward    rollout         version\nattach          convert         describe        explain         logs            proxy           run\n[root@master ~]# kubectl\n```\n\n\n##3.2 kubectl run/kubectl get/kubectl delete\n\n```\n-----------------------------------------\n1. Pod\u30921\u3064\u8d77\u52d5\u3059\u308b\u65b9\u6cd5\n-----------------------------------------\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002run\u306b\u6307\u5b9a\u3059\u308b\u6587\u5b57\u5217\uff08\u4e0b\u8a18\u4f8b\u306fnginx)\u306f\u4efb\u610f\u3067\u3059\u3002\n[root@master ~]# kubectl run nginx --image=nginx\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-2040093540-lw9zo   1/1       Running   0          22s\n\nPod\u304c\u3069\u306e\u30db\u30b9\u30c8(\u30de\u30b9\u30bf\u3001\u307e\u305f\u306f\u30ce\u30fc\u30c9\uff09\u3067\u52d5\u3044\u3066\u308b\u306e\u304b\u3092\u78ba\u8a8d\u3059\u308b\u3002-o wide\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b\u3002Pod\u304cmaster\u3067\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod -o wide\nNAME                     READY     STATUS    RESTARTS   AGE       NODE\nnginx-2040093540-lw9zo   1/1       Running   0          28s       master\n\nDeployment\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get deployment\nNAME      DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\nnginx     1         1         1            1           8m\n\nPod\u3092\u7d42\u4e86\u3059\u308b\u3002Pod\u306e\u540d\u524d\u3067\u306f\u306a\u304f\u3001Deployment\u306e\u540d\u524d\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3002\n[root@master ~]# kubectl delete deployment nginx\ndeployment \"nginx\" deleted\n[root@master ~]# kubectl get pod\n[root@master ~]#\n\n-----------------------------------------\n2. Pod\u3092\u8907\u6570\u8d77\u52d5\u3059\u308b\u65b9\u6cd5(--replicas)\n-----------------------------------------\nPod\u30922\u3064\u8d77\u52d5\u3059\u308b\u3002\"--replicas=2\"\u3092\u6307\u5b9a\u3059\u308b\u3002\n[root@master ~]# kubectl run nginx --image=nginx --replicas=2\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002Pod\u304c2\u3064\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod -o wide\nNAME                     READY     STATUS    RESTARTS   AGE       NODE\nnginx-2040093540-5932k   1/1       Running   0          27s       master\nnginx-2040093540-mpnrw   1/1       Running   0          27s       master\n\nPod\u3092\u7d42\u4e86\u3059\u308b\u3002\n[root@master ~]# kubectl delete deployment nginx\ndeployment \"nginx\" deleted\n[root@master ~]# kubectl get pod\n[root@master ~]#\n\n-----------------------------------------\n3\uff0ePod\u306b\u74b0\u5883\u5909\u6570\u3092\u6e21\u3059\u65b9\u6cd5(--env)\n-----------------------------------------\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl run nginx --image=nginx --env=\"TEST=test1\"\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-3180491960-163ut   1/1       Running   0          31s\n\nPod\u3067bash\u3092\u5b9f\u884c\u3059\u308b\u3002\n[root@master ~]# kubectl exec nginx-3180491960-163ut -it bash\n\n\u74b0\u5883\u5909\u6570\u3092\u8868\u793a\u3059\u308b\u3002\nroot@nginx-3180491960-163ut:/# echo $TEST\ntest1\n\nroot@nginx-3180491960-163ut:/# exit\nexit\n\n-----------------------------------------\n4\uff0ePod\u306b\u30e9\u30d9\u30eb\u3092\u4ed8\u3051\u308b\u65b9\u6cd5(--labels)\n-----------------------------------------\nPod\u306b\"os=linux\"\u3068\u3044\u3046\u30e9\u30d9\u30eb\u3092\u3064\u3051\u3066\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl run nginx --image=nginx --labels=\"os=linux\"\ndeployment \"nginx\" created\n\n\u30e9\u30d9\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u3002\"os=linux\"\u3068\u3044\u3046\u30e9\u30d9\u30eb\u304c\u4ed8\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod --show-labels\nNAME                     READY     STATUS    RESTARTS   AGE       LABELS\nnginx-3952892669-fmqbt   1/1       Running   0          15s       os=linux,pod-template-hash=3952892669\n\n\u9055\u3046\u30e9\u30d9\u30eb\u3092\u6301\u3063\u305fPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl run nginx1 --image=nginx --labels=\"os=windows\"\ndeployment \"nginx1\" created\n\n\u30e9\u30d9\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30e9\u30d9\u30eb\u304c\u4ed8\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod --show-labels\nNAME                      READY     STATUS    RESTARTS   AGE       LABELS\nnginx-3952892669-fmqbt    1/1       Running   0          4m        os=linux,pod-template-hash=3952892669\nnginx1-3838991369-1yuur   1/1       Running   0          14s       os=windows,pod-template-hash=3838991369\n\n\u30ad\u30fc\u304c\"os\"\u306e\u3082\u306e\u3060\u3051\u3092\u8868\u793a\u3059\u308b\u3002\n[root@master ~]# kubectl get pod -L os\nNAME                      READY     STATUS    RESTARTS   AGE       OS\nnginx-3952892669-fmqbt    1/1       Running   0          5m        linux\nnginx1-3838991369-1yuur   1/1       Running   0          1m        windows\n\n```\n\n\n##3.3 kubectl describe (get\u306e\u8a73\u7d30\u30d0\u30fc\u30b8\u30e7\u30f3)\n\n```\n\u30ea\u30bd\u30fc\u30b9\u306e\u4e00\u89a7\u3092\u8868\u793a\u3059\u308b\u3002\"get\"\u3068\u30bf\u30a4\u30d7\u3057\u305f\u3042\u3068\u306b\"Tab\"\u30ad\u30fc\u3092\u62bc\u4e0b\u3059\u308b\u3002\n[root@master ~]# kubectl get\ncomponentstatus             ingress                     pod                         securitycontextconstraints\nconfigmap                   job                         podsecuritypolicy           service\ndaemonset                   limitrange                  podtemplate                 serviceaccount\ndeployment                  namespace                   replicaset                  thirdpartyresource\nendpoints                   node                        replicationcontroller\nevent                       persistentvolume            resourcequota\nhorizontalpodautoscaler     persistentvolumeclaim       secret\n\nPod\u306e\u72b6\u614b\u3092\u53d6\u5f97\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-2040093540-4g0um   1/1       Running   0          21s\n\nPod\u306e\u72b6\u614b\u3092\u53d6\u5f97\u3059\u308b\u3002get\u306b\u6bd4\u3079\u3088\u308a\u8a73\u7d30\u306a\u60c5\u5831\u304c\u5f97\u3089\u308c\u308b\u3002\n[root@master ~]# kubectl describe pod nginx-2040093540-4g0um\nName:           nginx-2040093540-4g0um\nNamespace:      default\nNode:           master/192.168.0.100\nStart Time:     Thu, 03 Nov 2016 22:28:17 +0900\nLabels:         pod-template-hash=2040093540,run=nginx\nStatus:         Running\nIP:             10.1.57.2\nControllers:    ReplicaSet/nginx-2040093540\nContainers:\n  nginx:\n    Container ID:       docker://fe90e85dcb1b58659e748b045c7487723ad07bc475d45b3322718820e07b0b72\n    Image:              nginx\n    Image ID:           docker://sha256:e43d811ce2f4986aa69bc8ba6c92f0789537f604d1601e0b6ec024e1c38062b4\n    Port:\n    QoS Tier:\n      memory:           BestEffort\n      cpu:              BestEffort\n    State:              Running\n      Started:          Thu, 03 Nov 2016 22:28:32 +0900\n    Ready:              True\n    Restart Count:      0\n    Environment Variables:\nConditions:\n  Type          Status\n  Ready         True\nNo volumes.\nEvents:\n  FirstSeen     LastSeen        Count   From                    SubobjectPath           Type            Reason          Message\n  ---------     --------        -----   ----                    -------------           --------        ------          -------\n  38s           38s             1       {default-scheduler }                            Normal          Scheduled       Successfully assigned nginx-2040093540-4g0um to 127.0.0.1\n  36s           36s             1       {kubelet master}     spec.containers{nginx}  Normal          Pulling         pulling image \"nginx\"\n  25s           25s             1       {kubelet master}     spec.containers{nginx}  Normal          Pulled          Successfully pulled image \"nginx\"\n  24s           24s             1       {kubelet master}     spec.containers{nginx}  Normal          Created         Created container with docker id fe90e85dcb1b\n  23s           23s             1       {kubelet master}     spec.containers{nginx}  Normal          Started         Started container with docker id fe90e85dcb1b\n\n[root@master ~]#\n```\n\n\n##3.4 kubectl create(\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u6210\u3059\u308b\uff09\n\n```\nDeployment\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u5bb9\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\n[root@master ~]# cat nginx-deployment.yaml\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.7.9\n        ports:\n        - containerPort: 80\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u5f15\u6570\u306b\u3057\u3066Deployment \u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master ~]# kubectl create -f nginx-deployment.yaml\ndeployment \"nginx-deployment\" created\n\n\u4f5c\u6210\u3057\u305fDeployment\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002Deployment\u306e\u540d\u524d\u306f\"nginx-deployment\"\u3067\u3042\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get deployment\nNAME               DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\nnginx-deployment   1         1         1            1           2m\n\n\nDeployment\u3067\u7ba1\u7406\u3059\u308bPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                                READY     STATUS    RESTARTS   AGE\nnginx-deployment-2035384211-xggt8   1/1       Running   0          2m\n\nDeployment\u3092\u524a\u9664\u3059\u308b\u3002\n[root@master ~]# kubectl delete deployment nginx-deployment\ndeployment \"nginx-deployment\" deleted\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002Deployment\u3092\u524a\u9664\u3059\u308b\u3068\u3001Pod\u3082\u505c\u6b62\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod\n[root@master ~]#\n```\n\n\n##3.5 kubectl create namespace(\u30cd\u30fc\u30e0\u30b9\u30da\u30fc\u30b9\u3092\u4f5c\u6210\u3059\u308b\uff09\n\n```\nname1\u3068\u3044\u3046namespace\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master ~]# kubectl create namespace name1\nnamespace \"name1\" created\n\nname2\u3068\u3044\u3046namespace\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master ~]# kubectl create namespace name2\nnamespace \"name2\" created\n\n\u4f5c\u6210\u3057\u305fnamespace\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get namespace\nNAME          STATUS    AGE\ndefault       Active    61d\nname1         Active    2m\nname2         Active    2m\n\nname1\u3068name2\u3067\u305d\u308c\u305e\u308cPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl run nginx --image=nginx --namespace=name1\ndeployment \"nginx\" created\n[root@master ~]# kubectl run nginx --image=nginx --namespace=name2\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002name1,name2\u3067\u305d\u308c\u305e\u308cPod\u304c\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod --all-namespaces\nNAMESPACE   NAME                     READY     STATUS    RESTARTS   AGE\nname1       nginx-2040093540-npjtb   1/1       Running   0          44s\nname2       nginx-2040093540-7njdh   1/1       Running   0          39s\n\nPod\u3092\u7d42\u4e86\u3059\u308b\u3002\n[root@master ~]# kubectl delete deployment nginx --namespace=name1\ndeployment \"nginx\" deleted\n[root@master ~]# kubectl delete deployment nginx --namespace=name2\ndeployment \"nginx\" deleted\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod --all-namespaces\n[root@master ~]#\n```\n\n\n##3.6 kubectl create secret (secret\u3092\u4f5c\u6210\u3059\u308b)\n\n```\nsecret\u3068\u3057\u3066Pod\u306b\u30de\u30a6\u30f3\u30c8\u3059\u308b\u60c5\u5831\u306f\u4ee5\u4e0b\u306e2\u3064\u306e\u60c5\u5831\u3002\n[root@master secrets]# cat username.txt\nfoo\n[root@master secrets]# cat pass.txt\n12345\n\n\"mysecret\"\u3068\u3044\u3046\u540d\u524d\u306esecret\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master secrets]# kubectl create secret generic mysecret --from-file=./username.txt --from-file=./pass.txt\nsecret \"mysecret\" created\n\nsecret\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master secrets]# kubectl get secret\nNAME                  TYPE                                  DATA      AGE\nmysecret              Opaque                                2         5s\n\nsecret\u306e\u8a73\u7d30\u60c5\u5831\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master secrets]# kubectl describe secret mysecret\nName:           mysecret\nNamespace:      default\nLabels:         <none>\nAnnotations:    <none>\n\nType:   Opaque\n\nData\n====\nusername.txt:   4 bytes  <= \u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u8eab\u305d\u306e\u3082\u306e\u306f\u3067\u306a\u304f\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u30d0\u30a4\u30c8\u6570\u304c\u8868\u793a\u3055\u308c\u308b\u3002\npass.txt:       6 bytes  <= \u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u8eab\u305d\u306e\u3082\u306e\u306f\u3067\u306a\u304f\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u30d0\u30a4\u30c8\u6570\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\n\nPod\u3092\u8d77\u52d5\u3059\u308b\u305f\u3081\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u78ba\u8a8d\u3059\u308b\u3002/tmp/mysec\u306bmysecret\u3068\u3044\u3046\u540d\u524d\u306esecret\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u3002\n[root@master secrets]# cat secret-pod.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  labels:\n    name: secretstest1  <= Pod\u306b\u4ed8\u3051\u308b\u30e9\u30d9\u30eb\u540d\u3092\u6307\u5b9a\u3059\u308b\uff08\u4efb\u610f\u306e\u540d\u524d)\n  name: secretstest     <= Pod\u306e\u540d\u524d\u3092\u6307\u5b9a\u3059\u308b\uff08\u4efb\u610f\u306e\u540d\u524d\uff09\nspec:\n  volumes:\n    - name: \"secretstest\"\n      secret:\n        secretName: mysecret   <= \u30de\u30a6\u30f3\u30c8\u3059\u308bsecret\u306e\u540d\u524d\u3092\u6307\u5b9a\u3059\u308b\u3002\n  containers:\n    - image: nginx:1.7.1\n      name: awebserver\n      volumeMounts:\n        - mountPath: \"/tmp/mysec\"   <= secret\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308bPod\u5185\u306e\u30d1\u30b9\u3002\n          name: \"secretstest\"\n\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master secrets]# kubectl create -f secret-pod.yaml\npod \"secretstest\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master secrets]# kubectl get pod\nNAME                   READY     STATUS    RESTARTS   AGE\nsecretstest            1/1       Running   0          31s\n\nPod\u306e\u30e9\u30d9\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master secrets]# kubectl get pod --show-labels\nNAME          READY     STATUS    RESTARTS   AGE       LABELS\nsecretstest   1/1       Running   0          35s       name=secretstest1\n\nsecret\u306e\u4e2d\u8eab\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master secrets]# kubectl exec -it secretstest bash\nroot@secretstest:/usr/local/nginx/html# cat /tmp/mysec/pass.txt\n12345\nroot@secretstest:/usr/local/nginx/html# cat /tmp/mysec/username.txt\nfoo\nroot@secretstest:/usr/local/nginx/html# exit\nexit\n[root@master secrets]#\n```\n\n\n##3.7 kubectl create configmap  (configmap\u3092\u4f5c\u6210\u3059\u308b)\n\nconfigmap\u306f\u3001\u30db\u30b9\u30c8\u304b\u3089Pod\u306b\u8a2d\u5b9a\u60c5\u5831(key,value\u306e\u7d44)\u3092\u6e21\u3059\u3068\u304d\u306b\u4f7f\u3046\u30ea\u30bd\u30fc\u30b9\u3067\u3059\u3002\n\n```\n-----------------------------------\n1. ConfigMap\u3092\u4f5c\u6210\u3059\u308b\u3002\n-----------------------------------\nConfigMap\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master ~]# vi config.yaml\n[root@master ~]# cat config.yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: test-config\ndata:\n  # key, value\u5f62\u5f0f\u3067\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3059\u308b\n  test1: '11111'\n  test2: '22222'\n\nConfigMap\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master ~]# kubectl create -f config.yaml\nconfigmap \"test-config\" created\n\n\u4f5c\u6210\u3057\u305fConfigMap\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get configmap\nNAME          DATA      AGE\ntest-config   2         11s\n\n\u4f5c\u6210\u3057\u305fConfigMap\u306e\u8a73\u7d30\u60c5\u5831\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl describe configmap test-config\nName:           test-config\nNamespace:      default\nLabels:         <none>\nAnnotations:    <none>\n\nData\n====\ntest1:  5 bytes   <===== '11111'\u306e\u30b5\u30a4\u30ba\u304c\u8868\u793a\u3055\u308c\u308b\u3002\ntest2:  5 bytes   <===== '22222'\u306e\u30b5\u30a4\u30ba\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\n-----------------------------------\n2. \u4f5c\u6210\u3057\u305fConfigMap\u3092Pod\u306b\u6e21\u3059\n-----------------------------------\nPod\u306e\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master ~]# vi pod.yaml\n[root@master ~]# cat pod.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: test-pod\nspec:\n  containers:\n    - name: example-container\n      image: busybox\n      # \u3042\u3068\u304b\u3089exec\u3067\u64cd\u4f5c\u3059\u308b\u305f\u3081sleep\u3055\u305b\u3066\u304a\u304f\n      command: [\"sleep\", \"3600\"]\n      # ConfigMap\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\n      volumeMounts:\n        - name: config-volume\n          mountPath: /etc/config\n  volumes:\n    - name: config-volume\n      configMap:\n        # ConfigMap\u30ea\u30bd\u30fc\u30b9\u306e\u540d\u524d\u3092\u6307\u5b9a\u3059\u308b(kubectl get configmap\u3067\u5f97\u3089\u308c\u308b\u540d\u524d)\n        name: test-config\n\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl create -f pod.yaml\npod \"test-pod\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME       READY     STATUS    RESTARTS   AGE\ntest-pod   1/1       Running   0          26s\n\nPod\u306esh\u3092\u8d77\u52d5\u3057\u3066\u3001ConfigMap\u306eKey,Value\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl exec -it test-pod sh\n/ # cat /etc/config/test1\n11111/ #\n/ # cat /etc/config/test2\n22222/ #\n\n-----------------------------------------------------------\n3. \u52d5\u7684\u306bConfigMap\u3092\u5909\u66f4\u3059\u308b\u3002\u5909\u66f4\u3057\u305fConfigMap\u3092Pod\u3067\u53c2\u7167\u3059\u308b\u3002\n------------------------------------------------------------\nConfigMap\u3092\u52d5\u7684\u306b\u5909\u66f4\u3059\u308b\u3002\n[root@master ~]# kubectl edit configmap test-config\n# Please edit the object below. Lines beginning with a '#' will be ignored,\n# and an empty file will abort the edit. If an error occurs while saving this file will be\n# reopened with the relevant failures.\n#\napiVersion: v1\ndata:\n  test1: \"88888\"  <=== '11111'\u304b\u3089'88888'\u306b\u5909\u66f4\u3059\u308b\u3002\n  test2: \"99999\"  <=== '22222'\u304b\u3089'99999'\u306b\u5909\u66f4\u3059\u308b\u3002\nkind: ConfigMap\n\"/tmp/kubectl-edit-np3nb.yaml\" 16L, 503C\n\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME       READY     STATUS    RESTARTS   AGE\ntest-pod   1/1       Running   0          4m\n\nConfigMap\u306eValue\u3092\u78ba\u8a8d\u3059\u308b\u3002Value\u304c\u5909\u66f4\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n[root@master ~]# kubectl exec -it test-pod sh\n/ # cat /etc/config/test1\n88888/ #\n/ # cat /etc/config/test2\n99999/ #\n/ # exit\n\n```\n\n\n##3.8 kubectl exec (Pod\u3067\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\uff09\n\n\n```\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master2 ~]# kubectl run nginx --image=nginx\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master2 ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-2040093540-69r4e   1/1       Running   0          13s\n\nPod\u3067\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3002\n[root@master2 ~]# kubectl exec nginx-2040093540-69r4e -it bash\n\nps\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3002nginx\u304c\u52d5\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\nroot@nginx-2040093540-69r4e:/# ps aux\nUSER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot          1  0.7  0.2  31760  2856 ?        Ss   01:17   0:00 nginx: master\nnginx         8  0.0  0.1  32152  1408 ?        S    01:17   0:00 nginx: worker\nroot          9  4.8  0.1  20216  1912 ?        Ss   01:17   0:00 bash\nroot         17  0.0  0.1  17492  1148 ?        R+   01:17   0:00 ps aux\n\nuname\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3002Linux\u306e\u7248\u6570\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\nroot@nginx-2040093540-69r4e:/# uname -r\n3.10.0-327.el7.x86_64\n\n\u30b3\u30f3\u30c6\u30ca\u304b\u3089\u629c\u3051\u308b\nroot@nginx-2040093540-69r4e:/# exit\nexit\n[root@master2 ~]#\n\n\n----------------------------------------------------\n1\u3064\u306ePod\u30672\u3064\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u305f\u5834\u5408\u306eexec\u5b9f\u65bd\u4f8b\n----------------------------------------------------\nPod\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master2 ~]# vi multi_os.yaml\n[root@master2 ~]# cat multi_os.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: multiple-container\nspec:\n  containers:\n    - name: busybox\n      image: busybox\n      command: [\"sleep\", \"3600\"]\n    - name: centos7\n      image: centos\n      command: [\"sleep\", \"3600\"]\n\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master2 ~]# kubectl create -f multi_os.yaml\npod \"multiple-container\" created\n\nbusybox\u306e\u30b3\u30f3\u30c6\u30ca\u3067\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3002\n[root@master2 ~]# kubectl exec multiple-container -c busybox -it sh\n/ # uname -r\n3.10.0-327.el7.x86_64\n/ # exit\n[root@master2 ~]#\n\n\ncentos\u306e\u30b3\u30f3\u30c6\u30ca\u3067\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3002\n[root@master2 ~]# kubectl exec multiple-container -c centos7 -it bash\n[root@multiple-container /]# uname -r\n3.10.0-327.el7.x86_64\n[root@multiple-container /]# cat /etc/redhat-release\nCentOS Linux release 7.3.1611 (Core)\n[root@multiple-container /]# exit\nexit\n[root@master2 ~]#\n\n\n----------------------------------------------------\nPod\u306e\u8a73\u7d30\u60c5\u5831\u306e\u78ba\u8a8d\n----------------------------------------------------\n[root@master2 ~]# kubectl describe pod multiple-container\nName:           multiple-container\nNamespace:      default\nNode:           master2/192.168.0.20\nStart Time:     Sat, 07 Jan 2017 11:05:13 +0900\nLabels:         <none>\nStatus:         Running\nIP:             172.17.0.2\nControllers:    <none>\nContainers:\n  busybox:\n    Container ID:       docker://075b790da0ff3404d9567e92a9ac5d2efb55231734633723f5fc0143ea866822\n    Image:              busybox\n    Image ID:           docker://sha256:8a4698b1752b8142df16b73eca10c8b03fbd2ccbbd03cfd47882f04ace12de66\n    Port:\n    Command:\n      sleep\n      3600\n    QoS Tier:\n      memory:           BestEffort\n      cpu:              BestEffort\n    State:              Running\n      Started:          Sat, 07 Jan 2017 11:05:29 +0900\n    Ready:              True\n    Restart Count:      0\n    Environment Variables:\n  centos7:\n    Container ID:       docker://780ded7a424d58315ab2ea8b580eef7c2d11929286abfe37be899f6a8b6ac931\n    Image:              centos\n    Image ID:           docker://sha256:67591570dd29de0e124ee89d50458b098dbd83b12d73e5fdaf8b4dcbd4ea50f8\n    Port:\n    Command:\n      sleep\n      3600\n    QoS Tier:\n      memory:           BestEffort\n      cpu:              BestEffort\n    State:              Running\n      Started:          Sat, 07 Jan 2017 11:05:20 +0900\n    Ready:              True\n    Restart Count:      0\n    Environment Variables:\nConditions:\n  Type          Status\n  Ready         True\n\n-\u4ee5\u4e0b\u3001\u7565-\n\n```\n\n\n\n##3.9 kubectl scale(Pod\u306e\u6570\u3092\u5897\u6e1b\u3059\u308b\uff09\n------------------------------------------------------------\n```\nPod\u30921\u3064\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl run nginx --image=nginx\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002Pod\u304c1\u3064\u52d5\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-2040093540-xfxj6   1/1       Running   0          18s\n\nPod\u30922\u500b\u306b\u5897\u3084\u3059\u3002\n[root@master ~]# kubectl scale deployment nginx --replicas=2\ndeployment \"nginx\" scaled\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002Pod\u304c2\u500b\u306b\u306a\u3063\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-2040093540-d2c6a   1/1       Running   0          21s\nnginx-2040093540-xfxj6   1/1       Running   0          1m\n\nPod\u3092\u7d42\u4e86\u3059\u308b\u3002\n[root@master ~]# kubectl delete deployment nginx\ndeployment \"nginx\" deleted\n[root@master ~]# kubectl get pod\n[root@master ~]#\n```\n\n##3.10 kubectl cordon(Pod\u914d\u5099\u7981\u6b62)/kubectl uncordon(Pod\u914d\u5099\u7981\u6b62\u306e\u89e3\u9664)\n\nkubectl cordon\u3082kubectl drain\u3082\u3001\u6307\u5b9a\u3057\u305f\u30db\u30b9\u30c8\u3078\u306ePod\u306e\u65b0\u898f\u914d\u5099\u3092\u7981\u6b62\u3059\u308b\u3002\u9055\u3044\u306f\u3001\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3002\n- kubectl cordon : kubectl cordon\u3067\u6307\u5b9a\u3057\u305f\u30db\u30b9\u30c8\u3067Pod\u304c\u52d5\u4f5c\u4e2d\u306e\u5834\u5408\u3001\u305d\u306ePod\u306f\u305d\u306e\u30db\u30b9\u30c8\u3067\u52d5\u4f5c\u3057\u305f\u307e\u307e\u3002 \n- kubectl drain  : kubectl drain\u3067\u6307\u5b9a\u3057\u305f\u30db\u30b9\u30c8\u3067Pod\u304c\u52d5\u4f5c\u4e2d\u306e\u5834\u5408\u3001Pod\u3092\u4ed6\u306e\u30db\u30b9\u30c8\u306b\u79fb\u52d5\u3059\u308b\u3002\n\n\n```\n\u30db\u30b9\u30c8(\u30de\u30b9\u30bf\u3068\u30ce\u30fc\u30c9\uff09\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get node\nNAME        STATUS     AGE\nmaster      Ready      59d\nnode1       Ready      61d\n\nPod\u30924\u3064\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl run nginx --image=nginx --replicas=4\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30de\u30b9\u30bf(master)\u3068\u30ce\u30fc\u30c9(node1)\u30672\u500b\u305a\u3064\u52d5\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod -o wide\nNAME                     READY     STATUS    RESTARTS   AGE       NODE\nnginx-2040093540-147wy   1/1       Running   0          42s       master\nnginx-2040093540-s5lu3   1/1       Running   0          42s       node1\nnginx-2040093540-st25o   1/1       Running   0          42s       node1\nnginx-2040093540-w8rxu   1/1       Running   0          42s       master\n\nPod\u3092\u7d42\u4e86\u3059\u308b\u3002\n[root@master ~]# kubectl delete deployment nginx\ndeployment \"nginx\" deleted\n\n\u30de\u30b9\u30bf(master)\u3078\u306ePod\u914d\u5099\u3092\u7981\u6b62\u3059\u308b\u3002\n[root@master ~]# kubectl cordon master\nnode \"master\" cordoned\n\n\u30db\u30b9\u30c8\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30de\u30b9\u30bf\u3078\u306ePod\u914d\u5099\u304c\u7981\u6b62\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get node\nNAME        STATUS                     AGE\nmaster      Ready,SchedulingDisabled   59d\nnode1       Ready                      61d\n\nPod\u30924\u500b\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl run nginx --image=nginx --replicas=4\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u30024\u500b\u3059\u3079\u3066\u304c\u30ce\u30fc\u30c9(node1)\u3067\u52d5\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod -o wide\nNAME                     READY     STATUS    RESTARTS   AGE       NODE\nnginx-2040093540-2e7pe   1/1       Running   0          47s       node1\nnginx-2040093540-aebg5   1/1       Running   0          47s       node1\nnginx-2040093540-jgw2y   1/1       Running   0          47s       node1\nnginx-2040093540-wmvem   1/1       Running   0          47s       node1\n\n\u30de\u30b9\u30bf\u3078\u306ePod\u914d\u5099\u7981\u6b62\u3092\u89e3\u9664\u3059\u308b\u3002\n[root@master ~]# kubectl uncordon master\nnode \"master\" uncordoned\n\n\u30db\u30b9\u30c8\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30de\u30b9\u30bf\u306ePod\u914d\u5099\u7981\u6b62\u304c\u89e3\u9664\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get node\nNAME        STATUS     AGE\nmaster      Ready      59d\nnode1       Ready      61d\n```\n\n\n##3.11 kubectl drain(Pod\u914d\u5099\u7981\u6b62)/kubectl uncordon(Pod\u914d\u5099\u7981\u6b62\u306e\u89e3\u9664)\n\n\n```\nPod\u30922\u3064\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl run nginx --image=nginx --replicas=2\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30de\u30b9\u30bf(master)\u3068\u30ce\u30fc\u30c9(node1)\u3067Pod\u304c1\u500b\u305a\u3064\u52d5\u3044\u3066\u3044\u308b\u3002\n[root@master ~]# kubectl get pod -o wide\nNAME                     READY     STATUS    RESTARTS   AGE       NODE\nnginx-2040093540-2oix4   1/1       Running   0          20s       node1\nnginx-2040093540-pkmvj   1/1       Running   0          20s       master\n\n\u30de\u30b9\u30bf(master)\u3092Pod\u914d\u5099\u7981\u6b62\u306b\u3059\u308b\u3002\n[root@master ~]# kubectl drain master\nnode \"master\" cordoned\nerror: pods not managed by ReplicationController, Job, or DaemonSet: nginx-2040093540-pkmvj (use --force to override)\n\nPod\u914d\u5099\u7981\u6b62\u3092\u5b9f\u884c\u3059\u308b\u3002\n\u914d\u5099\u7981\u6b62\u306b\u6307\u5b9a\u3059\u308b\u30db\u30b9\u30c8\u3067Deployment\u3067\u7ba1\u7406\u3059\u308bPod\u304c\u7a3c\u50cd\u4e2d\u306e\u5834\u5408\u306f\u3001--force\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n[root@master ~]# kubectl drain --force master\nnode \"master\" already cordoned\nWARNING: About to delete these pods not managed by ReplicationController, Job, or DaemonSet: nginx-2040093540-pkmvj\npod \"nginx-2040093540-pkmvj\" deleted\nnode \"master\" drained\n\n\u30db\u30b9\u30c8\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30de\u30b9\u30bf\u304cPod\u914d\u5099\u7981\u6b62\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get node\nNAME        STATUS                     AGE\nmaster      Ready,SchedulingDisabled   59d\nnode1       Ready                      61d\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\u30de\u30b9\u30bf(master)\u3067\u52d5\u3044\u3066\u3044\u305fPod\u304c\u30ce\u30fc\u30c9(node1)\u306b\u79fb\u52d5\u3057\u30662\u3064\u3068\u3082\u30ce\u30fc\u30c9(node1)\u3067\u52d5\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod -o wide\nNAME                     READY     STATUS    RESTARTS   AGE       NODE\nnginx-2040093540-2oix4   1/1       Running   0          1m        node1\nnginx-2040093540-ab2l4   1/1       Running   0          31s       node1\n\nPod\u914d\u5099\u7981\u6b62\u3092\u89e3\u9664\u3059\u308b\u3002\n[root@master ~]# kubectl uncordon master\nnode \"master\" uncordoned\n\n\u30db\u30b9\u30c8\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002Pod\u914d\u5099\u7981\u6b62\u304c\u89e3\u9664\u3055\u308c\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get node\nNAME        STATUS     AGE\nmaster      Ready      59d\nnode1       Ready      61d\n```\n\n\n##3.12 kubectl attach(\u52d5\u4f5c\u4e2d\u306ePod\u306b\u63a5\u7d9a\u3059\u308b\uff09\n\n\u672c\u30b3\u30de\u30f3\u30c9\u306e\u7528\u9014\u304c\u308f\u304b\u3089\u306a\u3044\u3002\u3002\u3002\nhttps://github.com/kubernetes/kubernetes/issues/23335\n\n```\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl run httpd --image=httpd\ndeployment \"httpd\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nhttpd-2047761252-mp52s   1/1       Running   0          14s\n\nPod\u306battach\u3059\u308b\u3002\n[root@master ~]# kubectl attach httpd-2047761252-mp52s -i\nAH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 172.17.0.2. Set the 'ServerName' directive globally to suppress this message\nAH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 172.17.0.2. Set the 'ServerName' directive globally to suppress this message\n[Sat Jan 07 02:49:25.819545 2017] [mpm_event:notice] [pid 1:tid 139689717176192] AH00489: Apache/2.4.25 (Unix) configured -- resuming normal operations\n[Sat Jan 07 02:49:25.820892 2017] [core:notice] [pid 1:tid 139689717176192] AH00094: Command line: 'httpd -D FOREGROUND'\n\n\n```\n\n##3.13 kubectl rollout\n###3.13.1 kubectl rollout history\uff08\u66f4\u65b0\u5c65\u6b74\u3092\u8868\u793a\u3059\u308b\uff09\n###3.13.2 kubectl rollout undo\uff08\u64cd\u4f5c\u3092\u53d6\u308a\u6d88\u3059\u3002\u904e\u53bb\u306e\u72b6\u614b\u306b\u623b\u308b\uff09\n\n```\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\u5c65\u6b74\u3092\u6b8b\u3059\u305f\u3081\u306b\u3001--record\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u308b\u3002\n[root@master ~]# kubectl run nginx --image=nginx:1.7.1 --record\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-4193804003-j9lsd   1/1       Running   0          7s\n\nDeployment\u306e\u66f4\u65b0\u5c65\u6b74\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl rollout history deployment/nginx\ndeployments \"nginx\":\nREVISION        CHANGE-CAUSE\n1               kubectl run nginx --image=nginx:1.7.1 --record\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u3092\u5909\u66f4(1.7.1 -> 1.9.1)\u3059\u308b\u3002\u30a8\u30c7\u30a3\u30bf(vi\u7b49)\u304c\u8d77\u52d5\u3059\u308b\u306e\u3067\u3001\u7248\u6570\u3092\u5909\u66f4\u3059\u308b\u3002\n[root@master ~]# kubectl edit deployment nginx\n\n      - image: nginx:1.7.1\n           \u2193\u5909\u66f4\n      - image: nginx:1.9.1\n\ndeployment \"nginx\" edited\n\n\u5c65\u6b74\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl rollout history deployment nginx\ndeployments \"nginx\":\nREVISION        CHANGE-CAUSE\n1               kubectl run nginx --image=nginx:1.7.1 --record\n2               kubectl edit deployment nginx\n\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                   READY     STATUS    RESTARTS   AGE\nnginx-45047525-1xrp3   1/1       Running   0          57s\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u304c1.7.1\u304b\u30891.9.1\u306b\u306a\u3063\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl describe pod nginx-45047525-1xrp3|grep \"Image:\"\n    Image:              nginx:1.9.1\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u30021.9.1\u7248\u3092\u3082\u3068\u306b\u8d77\u52d5\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u3068\u3044\u3046\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# docker ps\nCONTAINER ID        IMAGE                                                        COMMAND                  CREATED              STATUS              PORTS               NAMES\n1c3bcac0febb        nginx:1.9.1                                                  \"nginx -g 'daemon off\"   About a minute ago   Up About a minute                       k8s_nginx.e0d0df54_nginx-45047525-1xrp3_default_f1902308-a413-11e6-b2c9-000c291946c5_1d70a802\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u3092\u5909\u66f4(1.9.1 -> 1.9.2)\u3059\u308b\u3002\n[root@master ~]# kubectl edit deployment nginx\n\n      - image: nginx:1.9.1\n      - image: nginx:1.9.2\ndeployment \"nginx\" edited\n\n\u5c65\u6b74\u3092\u78ba\u8a8d\u3059\u308b\u30023\u56de\u5206\u306e\u66f4\u65b0\u5c65\u6b74\u3092\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n[root@master ~]# kubectl rollout history deployment nginx\ndeployments \"nginx\":\nREVISION        CHANGE-CAUSE\n1               kubectl run nginx --image=nginx:1.7.1 --record\n2               kubectl edit deployment nginx\n3               kubectl edit deployment nginx\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                    READY     STATUS    RESTARTS   AGE\nnginx-117530342-onbvj   1/1       Running   0          38s\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u304c1.9.1\u304b\u30891.9.2\u306b\u306a\u3063\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl describe pod nginx-117530342-onbvj|grep \"Image:\"\n    Image:              nginx:1.9.2\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u30021.9.2\u7248\u3092\u3082\u3068\u306b\u8d77\u52d5\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u3068\u3044\u3046\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# docker ps\nCONTAINER ID   IMAGE         COMMAND                  CREATED              STATUS              PORTS    NAMES\n20d6aaed4863   nginx:1.9.2   \"nginx -g 'daemon off\"   About a minute ago   Up About a minute            k8s_nginx.e2fedf55_nginx-117530342-onbvj_default_49ebf179-a414-11e6-b2c9-000c291946c5_13a2ecc9\n\nREVISION 1\u306e\u72b6\u614b\u306b\u623b\u3059\u3002\n[root@master ~]# kubectl rollout undo deployment nginx --to-revision=1\ndeployment \"nginx\" rolled back\n\n[root@master ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-4193804003-1fx52   1/1       Running   0          34s\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u304c1.9.2\u304b\u30891.7.1\u306b\u306a\u3063\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl describe pod nginx-4193804003-1fx52|grep \"Image:\"\n    Image:              nginx:1.7.1\n\n[root@master ~]# docker ps\nCONTAINER ID   IMAGE         COMMAND     CREATED           STATUS           PORTS    NAMES\nf30ae136f042   nginx:1.7.1   \"nginx\"     51 seconds ago    Up 50 seconds             k8s_nginx.dc70df52_nginx-4193804003-1fx52_default_50748203-a415-11e6-b2c9-000c291946c5_15fe34ac\n\n\nREVISION 2\u306e\u72b6\u614b\u306b\u623b\u3059\u3002\n[root@master ~]# kubectl rollout undo deployment nginx --to-revision=2\ndeployment \"nginx\" rolled back\n\n[root@master ~]# kubectl get pod\nNAME                   READY     STATUS    RESTARTS   AGE\nnginx-45047525-iw6w6   1/1       Running   0          6s\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u304c1.7.1\u304b\u30891.9.1\u306b\u306a\u3063\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl describe pod nginx-45047525-iw6w6|grep \"Image:\"\n    Image:              nginx:1.9.1\n\n[root@master ~]# docker ps\nCONTAINER ID   IMAGE         COMMAND                 CREATED           STATUS           PORTS    NAMES\n1268824ad1c5   nginx:1.9.1   \"nginx -g 'daemon off\"  17 seconds ago    Up 16 seconds             k8s_nginx.e0d0df54_nginx-45047525-iw6w6_default_94a637f0-a415-11e6-b2c9-000c291946c5_c1d96f5c\n```\n\n###3.13.3 kubectl rollout pause\n###3.13.4 kubectl rollout resume\n\n\n\n##3.14 kubectl label(Pod\u3078\u306e\u30e9\u30d9\u30eb\u8cbc\u4ed8\u3001\u524a\u9664\u3001\u4e0a\u66f8\u304d\uff09\n\n```\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl run nginx --image=nginx\ndeployment \"nginx\" created\n\nPod\u306e\u30e9\u30d9\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod --show-labels\nNAME                     READY     STATUS    RESTARTS   AGE       LABELS\nnginx-2040093540-ujjzd   1/1       Running   0          18s       pod-template-hash=2040093540,run=nginx\n\n\u30e9\u30d9\u30eb(os=linux)\u3092\u8ffd\u52a0\u3059\u308b\u3002\n[root@master ~]# kubectl label pod nginx-2040093540-ujjzd os=linix\npod \"nginx-2040093540-ujjzd\" labeled\n\n\u30e9\u30d9\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u3002os=linux\u3068\u3044\u3046\u30e9\u30d9\u30eb\u304c\u8ffd\u52a0\u3055\u308c\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod --show-labels\nNAME                     READY     STATUS    RESTARTS   AGE       LABELS\nnginx-2040093540-ujjzd   1/1       Running   0          1m        os=linix,pod-template-hash=2040093540,run=nginx\n\n\u30e9\u30d9\u30eb(os=linux)\u3092\u524a\u9664\u3059\u308b\u3002\n\u30ad\u30fc\u306e\u5f8c\u306b\u30cf\u30a4\u30d5\u30f3\u3092\u6307\u5b9a\u3059\u308b\u3002\u4ee5\u4e0b\u306e\u4f8b\u3060\u3068OS\u306e\u5f8c\u306b\u300c-\u300d\u3092\u6307\u5b9a\u3059\u308b\u3002\n[root@master ~]# kubectl label pod nginx-2040093540-ujjzd os-\npod \"nginx-2040093540-ujjzd\" labeled\n\n\u30e9\u30d9\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30e9\u30d9\u30eb(os=linux)\u304c\u524a\u9664\u3055\u308c\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod --show-labels\nNAME                     READY     STATUS    RESTARTS   AGE       LABELS\nnginx-2040093540-ujjzd   1/1       Running   0          3m        pod-template-hash=2040093540,run=nginx\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod --show-labels\nNAME                     READY     STATUS    RESTARTS   AGE       LABELS\nnginx-2040093540-ujjzd   1/1       Running   0          6m        pod-template-hash=2040093540,run=nginx\n\n\u30e9\u30d9\u30eb\u3092\u66f8\u304d\u63db\u3048\u308b\u3002run=nginx\u3068\u3044\u3046\u30e9\u30d9\u30eb\u3092run=hoge\u306b\u66f8\u304d\u63db\u3048\u308b\u3002\n[root@master ~]# kubectl label --overwrite pod nginx-2040093540-ujjzd run=hoge\npod \"nginx-2040093540-ujjzd\" labeled\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\nrun=nginx\u3068\u3044\u3046\u30e9\u30d9\u30eb\u3092\u6301\u3063\u305fPod\u304c\u3044\u306a\u304f\u306a\u3063\u305f\u305f\u3081\u3001\u3082\u30461\u3064Pod\u3092\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod --show-labels\nNAME                     READY     STATUS    RESTARTS   AGE       LABELS\nnginx-2040093540-32i08   1/1       Running   0          1m        pod-template-hash=2040093540,run=nginx\nnginx-2040093540-ujjzd   1/1       Running   0          9m        pod-template-hash=2040093540,run=hoge\n\n\u65b0\u305f\u306b\u8d77\u52d5\u3057\u305fPod\u306e\u30e9\u30d9\u30eb\u3092run=hoge\u304b\u3089run=nginx\u306b\u623b\u3059\u3002\n[root@master ~]# kubectl label --overwrite pod nginx-2040093540-ujjzd run=nginx\npod \"nginx-2040093540-ujjzd\" labeled\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\nrun=nginx\u3068\u3044\u3046\u30e9\u30d9\u30eb\u3092\u6301\u3063\u305fPod\u304c2\u500b\u306b\u306a\u3063\u305f\u305f\u3081\u3001Pod\u306e\u6570\u30922\u500b\u304b\u30891\u500b\u306b\u6e1b\u3089\u3057\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod --show-labels\nNAME                     READY     STATUS    RESTARTS   AGE       LABELS\nnginx-2040093540-ujjzd   1/1       Running   0          14m       pod-template-hash=2040093540,run=nginx\n\n```\n\n\n\n##3.15 kubectl annotate(\u30ea\u30bd\u30fc\u30b9\u306b\u6ce8\u91c8\u306e\u8ffd\u52a0\u3001\u524a\u9664\u3092\u884c\u3046\uff09\n\n```\n-----------------------------------------\n1. \u6ce8\u91c8(annotate)\u306e\u8ffd\u52a0\u3001\u524a\u9664\u3092\u884c\u3046\u3002\n-----------------------------------------\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master1 ~]# kubectl run nginx --image=nginx\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master1 ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-2040093540-vb1qg   1/1       Running   0          1m\n\nPod\u306b\u6ce8\u91c8(os='centos6')\u3092\u4ed8\u3051\u308b\u3002\n[root@master1 ~]# kubectl annotate pod nginx-2040093540-vb1qg os='centos6'\npod \"nginx-2040093540-vb1qg\" annotated\n\n\u6ce8\u91c8\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master1 ~]# kubectl get pod nginx-2040093540-vb1qg -o yaml|grep -w os\n    os: centos6\n\n\u6ce8\u91c8\u3092\u524a\u9664\u3059\u308b\u3002description\u306e\u3042\u3068\u306b\u300c-\u300d\u3092\u4ed8\u3051\u308b\u3002\n[root@master1 ~]# kubectl annotate pod nginx-2040093540-vb1qg os-\npod \"nginx-2040093540-vb1qg\" annotated\n\n\u6ce8\u91c8\u3092\u78ba\u8a8d\u3059\u308b\u3002\u6ce8\u91c8\u304c\u524a\u9664\u3067\u304d\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master1 ~]# kubectl get pod nginx-2040093540-vb1qg -o yaml|grep -w os\n[root@master1 ~]#\n\n-----------------------------------------------\n2. \u6ce8\u91c8\u3092\u4e0a\u66f8\u304d\u3059\u308b(--overwrite\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u3046)\n-----------------------------------------------\nPod\u306b\u6ce8\u91c8(os='centos6')\u3092\u4ed8\u3051\u308b\u3002\n[root@master1 ~]# kubectl annotate pod nginx-2040093540-vb1qg os='centos6'\npod \"nginx-2040093540-vb1qg\" annotated\n\n\u6ce8\u91c8\u3092\u78ba\u8a8d\u3059\u308b\u3002\u3002\n[root@master1 ~]# kubectl get pod nginx-2040093540-vb1qg -o yaml|grep -w os\n    os: centos6\n\n\u6ce8\u91c8\u3092\u4e0a\u66f8\u304d\u3059\u308b\u3002os='centos6' => os='centos7'\n[root@master1 ~]# kubectl annotate --overwrite pod nginx-2040093540-vb1qg os='centos7'\npod \"nginx-2040093540-vb1qg\" annotated\n\n\u6ce8\u91c8\u3092\u78ba\u8a8d\u3059\u308b\u3002\u6ce8\u91c8\u304c\u4e0a\u66f8\u304d\u3055\u308c\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master1 ~]# kubectl get pod nginx-2040093540-vb1qg -o yaml|grep -w os\n    os: centos7\n\n```\n\n\n##3.16 kubectl edit(\u5b9a\u7fa9\u60c5\u5831\u5909\u66f4)/kubectl apply(\u5b9a\u7fa9\u60c5\u5831\u5909\u66f4\uff09\nedit\u3082apply\u3082\u30ea\u30bd\u30fc\u30b9\u306e\u5b9a\u7fa9\u60c5\u5831\u3092\u5909\u66f4\u3059\u308b\u305f\u3081\u306b\u4f7f\u3046\u3002\u9055\u3044\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3002\n - edit\u306f\u30a8\u30c7\u30a3\u30bf(vi\u7b49)\u3092\u4f7f\u3063\u3066\u3001\u30ea\u30bd\u30fc\u30b9\u306e\u5b9a\u7fa9\u60c5\u5831\u3092\u5909\u66f4\u3059\u308b\u3068\u304d\u306b\u4f7f\u3046\u3002\n - apply\u306f\u30d5\u30a1\u30a4\u30eb\u3084\u6a19\u6e96\u5165\u529b\u304b\u3089\u3001\u30ea\u30bd\u30fc\u30b9\u306e\u5b9a\u7fa9\u60c5\u5831\u3092\u5909\u66f4\u3059\u308b\u3068\u304d\u306b\u4f7f\u3046\u3002\n\n```\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\u30a4\u30e1\u30fc\u30b8\u306f1.7.1\u7248\u3092\u4f7f\u3046\n[root@master ~]# kubectl run nginx --image=nginx:1.7.1\ndeployment \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-4193804003-rqoun   1/1       Running   0          7s\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u3092\u78ba\u8a8d\u3059\u308b\u30021.7.1\u3067\u3042\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl describe pod nginx-4193804003-rqoun|grep \"Image:\"\n    Image:              nginx:1.7.1\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u30921.7.1\u304b\u30891.9.1\u306b\u5909\u66f4\u3059\u308b\u3002\n[root@master ~]# kubectl edit deployment nginx\n\n      - image: nginx:1.7.1\n             \u2193\n      - image: nginx:1.9.1\n\ndeployment \"nginx\" edited\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u30021.9.1\u7248\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u3082\u3068\u306bPod\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                   READY     STATUS    RESTARTS   AGE\nnginx-45047525-8tklr   1/1       Running   0          2m\n\n[root@master ~]# kubectl describe pod nginx-45047525-8tklr |grep \"Image:\"\n    Image:              nginx:1.9.1\n\ndocker\u30b3\u30de\u30f3\u30c9\u3067\u3082\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3002\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u304c1.9.1\u306b\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3055\u308c\u3066\u3044\u308b\u3002\n[root@master ~]# docker ps\nCONTAINER ID     IMAGE          COMMAND                  CREATED              STATUS              PORTS        NAMES\n007830b209b4     nginx:1.9.1    \"nginx -g 'daemon off\"   About a minute ago   Up About a minute                k8s_nginx.e0d0df54_nginx-45047525-8tklr_default_fc4049e3-a3b0-11e6-815e-000c291946c5_42df405c\n```\n\n\n##3.17 kubectl replace(\u30ea\u30bd\u30fc\u30b9\u3092\u7f6e\u304d\u63db\u3048\u308b\u3002\u3044\u3063\u305f\u3093\u30ea\u30bd\u30fc\u30b9\u3092\u524a\u9664\u3057\u3066\u4f5c\u308a\u76f4\u3059\uff09\n\n\n```\n\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u3092\u78ba\u8a8d\u3059\u308b\u3002\u7248\u6570\u306f1.7.1\n[root@master ~]# cat nginx-deployment.yaml\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.7.1\n        ports:\n        - containerPort: 80\n\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl create -f nginx-deployment.yaml\ndeployment \"nginx-deployment\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                                READY     STATUS        RESTARTS   AGE\nnginx-deployment-1406762891-5typw   1/1       Running       0          23s\n\n\u8d77\u52d5\u3057\u305fPod\u306e\u30a4\u30e1\u30fc\u30b8\u7248\u6570\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod nginx-deployment-1406762891-5typw -o yaml|grep \"image:\"\n  - image: nginx:1.7.1\n    image: nginx:1.7.1\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u3092\u5909\u66f4(1.7.1->1.9.1)\u3059\u308b\u3002\n[root@master ~]# vi nginx-deployment.yaml\n[root@master ~]# cat nginx-deployment.yaml\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.9.1\n        ports:\n        - containerPort: 80\n\n\n[root@master ~]# kubectl replace -f nginx-deployment.yaml\ndeployment \"nginx-deployment\" replaced\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002Pod\u306e\u540d\u524d\u304c\u5909\u308f\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                                READY     STATUS    RESTARTS   AGE\nnginx-deployment-1564180365-qplk2   1/1       Running   0          13s\n\n\u8d77\u52d5\u3057\u305fPod\u306e\u30a4\u30e1\u30fc\u30b8\u7248\u6570\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod nginx-deployment-1564180365-qplk2 -o yaml|grep \"image:\"\n  - image: nginx:1.9.1\n    image: nginx:1.9.1\n\nDocker\u30b3\u30de\u30f3\u30c9\u3067\u3082\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3002\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u304c1.9.1\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# docker ps\nCONTAINER ID   IMAGE        COMMAND                  CREATED           STATUS           PORTS      NAMES\nd6116aeec2e4   nginx:1.9.1  \"nginx -g 'daemon off\"   57 seconds ago    Up 55 seconds               k8s_nginx.f50b001f_nginx-deployment-1564180365-qplk2_default_7b606b07-a5a9-11e6-991f-000c291946c5_a8b717af3bde29fcacea\n\n```\n\n\n\n##3.18 kubectl rolling-update(\u30ea\u30bd\u30fc\u30b9\u3092\u52d5\u7684\u306b\u5909\u66f4\u3059\u308b\uff09\n\n```\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u5185\u5bb9\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u306f1.7.1\n[root@master ~]# cat nginx-rc.yaml\napiVersion: v1\nkind: ReplicationController\nmetadata:\n  name: nginx\nspec:\n  replicas: 1\n  selector:\n    app: nginx\n  template:\n    metadata:\n      name: nginx\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.7.1\n        ports:\n        - containerPort: 80\n\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl create -f nginx-rc.yaml\nreplicationcontroller \"nginx\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME          READY     STATUS              RESTARTS   AGE\nnginx-du0qx   0/1       ContainerCreating   0          4s\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod nginx-du0qx -o yaml|grep \"image:\"\n  - image: nginx:1.7.1\n    image: nginx:1.7.1\n\n[root@master ~]# docker ps\nCONTAINER ID    IMAGE          COMMAND      CREATED              STATUS              PORTS    NAMES\n6381c2a09d64    nginx:1.7.1    \"nginx\"      About a minute ago   Up About a minute            k8s_nginx.eff1001d_nginx-du0qx_default_b39e9ff4-a5ab-11e6-991f-000c291946c5_b39a845b\n\n\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3002\u30a4\u30e1\u30fc\u30b8\u306e\u7248\u6570\u30921.7.1\u304b\u30891.9.1\u306b\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3059\u308b\u3002\n[root@master ~]# kubectl rolling-update nginx --image=nginx:1.9.1\nCreated nginx-b1c0dfc3c6acc641415953ffec068cfd\nScaling up nginx-b1c0dfc3c6acc641415953ffec068cfd from 0 to 1, scaling down nginx from 1 to 0 (keep 1 pods available, don't exceed 2 pods)\nScaling nginx-b1c0dfc3c6acc641415953ffec068cfd up to 1\n\n- \u3057\u3070\u3089\u304f\u5f85\u3064\n\nScaling nginx down to 0\nUpdate succeeded. Deleting old controller: nginx\nRenaming nginx-b1c0dfc3c6acc641415953ffec068cfd to nginx\nreplicationcontroller \"nginx\" rolling updated\n\n\n\u4e0a\u8a18\u300c\u3057\u3070\u3089\u304f\u5f85\u3064\u300d\u306e\u3068\u304d\u3001\u5225\u306e\u7aef\u672b\u3067Pod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\u66f4\u65b0\u524d\u306ePod\u3068\u65b0\u3057\u3044Pod\u306e2\u3064\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                                           READY     STATUS    RESTARTS   AGE\nnginx-b1c0dfc3c6acc641415953ffec068cfd-w7ka2   1/1       Running   0          9s\nnginx-du0qx                                    1/1       Running   0          11m\n\nrolling-update\u304c\u7d42\u4e86\u3057\u305f\u5f8c\u3001Pod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\u65b0\u3057\u304f\u8d77\u52d5\u3057\u305fPod\u3060\u3051\u304c\u52d5\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                                           READY     STATUS    RESTARTS   AGE\nnginx-b1c0dfc3c6acc641415953ffec068cfd-w7ka2   1/1       Running   0          2m\n\n```\n\n\n##3.19 kubectl logs(Pod\u304c\u6a19\u6e96\u51fa\u529b\u306b\u51fa\u529b\u3059\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8868\u793a\u3059\u308b\uff09\n\n```\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master ~]# kubectl run httpd --image=httpd\ndeployment \"httpd\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nhttpd-2047761252-vrz7s   1/1       Running   0          2m\n\nDeployment\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get deployment\nNAME      DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\nhttpd     1         1         1            1           2m\n\nService\u3092\u4f5c\u6210\u3059\u308b\u3002\u30db\u30b9\u30c8\u306e\u30dd\u30fc\u30c8\u756a\u53f78888\u3092\u30b3\u30f3\u30c6\u30ca\u306e\u30dd\u30fc\u30c8\u756a\u53f780\u306b\u30de\u30c3\u30d7\u3059\u308b\u3002\n[root@master ~]# kubectl expose deployment httpd --port=8888 --target-port=80\nservice \"httpd\" exposed\n\nService\u3092\u4f5c\u6210\u3059\u308b\u3002--port\u306f\u30db\u30b9\u30c8\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u3001--target-port\u306fPod\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u3002\n[root@master ~]# kubectl expose deployment httpd --port=8888 --target-port=80\nservice \"httpd\" exposed\n\nService\u3068\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u60c5\u5831\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30db\u30b9\u30c8\u5074(10.254.92.77:8888) <-> Pod(10.1.72.2:80)\u306e\u95a2\u4fc2\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl get svc\nNAME         CLUSTER-IP      EXTERNAL-IP   PORT(S)         AGE\nhttpd        10.254.92.77    <none>        8888/TCP        15m\n[root@master ~]# kubectl get endpoints\nNAME         ENDPOINTS            AGE\nhttpd        10.1.72.2:80         15m\n\n\nPod(httpd)\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n[root@master ~]# curl http://10.254.92.77:8888\n<html><body><h1>It works!</h1></body></html>\n\nHTTP\u30a2\u30af\u30bb\u30b9\u3057\u305f\u30ed\u30b0\u304c\u51fa\u529b\u3055\u308c\u308b\u3002\n[root@master ~]# kubectl logs httpd-2047761252-vrz7s\nAH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 10.1.72.2. Set the 'ServerName' directive globally to suppress this message\nAH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 10.1.72.2. Set the 'ServerName' directive globally to suppress this message\n[Sun Nov 06 12:06:42.420907 2016] [mpm_event:notice] [pid 1:tid 140692115355520] AH00489: Apache/2.4.23 (Unix) configured -- resuming normal operations\n[Sun Nov 06 12:06:42.446383 2016] [core:notice] [pid 1:tid 140692115355520] AH00094: Command line: 'httpd -D FOREGROUND'\n192.168.0.100 - - [06/Nov/2016:12:07:33 +0000] \"GET / HTTP/1.1\" 200 45\n\n\u3082\u3046\u4e00\u5ea6HTTP\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n[root@master ~]# curl http://10.254.92.77:8888\n<html><body><h1>It works!</h1></body></html>\n\n2\u56de\u76ee\u306eHTTP\u30a2\u30af\u30bb\u30b9\u306e\u30ed\u30b0\u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl logs httpd-2047761252-vrz7s\nAH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 10.1.72.2. Set the 'ServerName' directive globally to suppress this message\nAH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 10.1.72.2. Set the 'ServerName' directive globally to suppress this message\n[Sun Nov 06 12:06:42.420907 2016] [mpm_event:notice] [pid 1:tid 140692115355520] AH00489: Apache/2.4.23 (Unix) configured -- resuming normal operations\n[Sun Nov 06 12:06:42.446383 2016] [core:notice] [pid 1:tid 140692115355520] AH00094: Command line: 'httpd -D FOREGROUND'\n192.168.0.100 - - [06/Nov/2016:12:07:33 +0000] \"GET / HTTP/1.1\" 200 45\n192.168.0.100 - - [06/Nov/2016:12:07:52 +0000] \"GET / HTTP/1.1\" 20\n\n\u6700\u5f8c\u306e2\u884c\u3060\u3051\u30ed\u30b0\u3092\u51fa\u529b\u3059\u308b\u3002--tail=2 \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u308b\u3002\n[root@master ~]# kubectl logs --tail=2 httpd-2047761252-vrz7s\n192.168.0.100 - - [06/Nov/2016:12:07:33 +0000] \"GET / HTTP/1.1\" 200 45\n192.168.0.100 - - [06/Nov/2016:12:07:52 +0000] \"GET / HTTP/1.1\" 200 45\n```\n\n| \u30aa\u30d7\u30b7\u30e7\u30f3\u4f7f\u7528\u4f8b | \u610f\u5473 |\n|:-:|:-:|\n|  --tail=2    |  \u6700\u5f8c\u306e2\u884c\u3060\u3051\u30ed\u30b0\u3092\u51fa\u529b\u3059\u308b  |\n|  --since=10s |  \u6700\u5f8c\u306e10\u79d2\u9593\u306e\u30ed\u30b0\u3092\u51fa\u529b\u3059\u308b |\n|  --since=1m  |  \u6700\u5f8c\u306e1\u5206\u9593\u306e\u30ed\u30b0\u3092\u51fa\u529b\u3059\u308b |\n|  --since=2H  |  \u6700\u5f8c\u306e2\u6642\u9593\u306e\u30ed\u30b0\u3092\u51fa\u529b\u3059\u308b |\n\n\n##3.20 kubectl config(\u30af\u30e9\u30b9\u30bf\u7ba1\u7406\u3092\u884c\u3046\uff09\n\n###3.20.1 kubectl config \u3092\u4f7f\u3063\u305f\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u5207\u308a\u66ff\u3048\u306e\u5b9f\u65bd\u4f8b\n\n```\n--------------------------------------\n1. \u691c\u8a3c\u74b0\u5883\n--------------------------------------\n- master1,master2\u306e2\u53f0\u69cb\u6210\u3002OS\u306fCentOS7.2\u3002\n- master1\u3067\u69cb\u6210\u3059\u308b\u74b0\u5883\u3092\u30ed\u30fc\u30ab\u30eb\u30af\u30e9\u30b9\u30bf\u3001master2\u3067\u69cb\u6210\u3059\u308b\u74b0\u5883\u3092\u30ea\u30e2\u30fc\u30c8\u30af\u30e9\u30b9\u30bf\u3068\u547c\u3076\u3002\n- master1,master2\u306f\u30de\u30b9\u30bf\u6a5f\u80fd\u3092\u6301\u3063\u3066\u3044\u308b\u3002\u3064\u307e\u308a\u3001kube-apiserver\u304c\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3002\n\n  (\u6ce8)\u691c\u8a3c\u74b0\u5883\u304c\u8ca7\u5f31\u306a\u306e\u3067\u3001\u30af\u30e9\u30b9\u30bf\u5185\u306e\u30db\u30b9\u30c8\u306f\u30de\u30b9\u30bf\u306e\u307f\u3001\u30ce\u30fc\u30c9\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n--------------------------------------\n2. \u76ee\u6a19\n--------------------------------------\n\u672c\u5b9f\u65bd\u4f8b\u3067\u306f\u3001master1\u3067\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u5207\u308a\u66ff\u3048\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067\u3001\n\u30ed\u30fc\u30ab\u30eb\u30af\u30e9\u30b9\u30bf\u3001\u30ea\u30e2\u30fc\u30c8\u30af\u30e9\u30b9\u30bf\u306ePod\u306e\u72b6\u614b\u304c\u53c2\u7167\u3067\u304d\u308b\u3053\u3068\u3092\u793a\u3059\u3002\n\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u306f\u3001\u30e6\u30fc\u30b6\u3068\u30af\u30e9\u30b9\u30bf\u306e\u7d44\u3092\u610f\u5473\u3059\u308b\u3002\n\n\u306a\u304a\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306b\u3064\u3044\u3066\u306f\u8003\u616e\u3057\u3066\u3044\u306a\u3044\u3002\n\n--------------------------------------\n3. \u6e96\u5099(\u30ed\u30fc\u30ab\u30eb\u30af\u30e9\u30b9\u30bf\u3067Pod\u3092\u8d77\u52d5\u3059\u308b)\n--------------------------------------\n[root@master1 ~]# kubectl run local-nginx --image=nginx\ndeployment \"local-nginx\" created\n\n[root@master1 ~]# kubectl get pod\nNAME                           READY     STATUS    RESTARTS   AGE\nlocal-nginx-1294491604-jnqwn   1/1       Running   0          19s\n\n--------------------------------------\n4. \u6e96\u5099(\u30ea\u30e2\u30fc\u30c8\u30af\u30e9\u30b9\u30bf\u3067Pod\u3092\u8d77\u52d5\u3059\u308b)\n--------------------------------------\n[root@master2 ~]# kubectl run remote-nginx --image=nginx\ndeployment \"remote-nginx\" created\n\n[root@master2 ~]# kubectl get pod\nNAME                            READY     STATUS    RESTARTS   AGE\nremote-nginx-1644388566-i26w1   1/1       Running   0          13m\n\n--------------------------------------\n5. \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u4f5c\u6210\u3059\u308b\n--------------------------------------\n\u3053\u308c\u4ee5\u964d\u306e\u4f5c\u696d\u306f\u5168\u3066\u30ed\u30fc\u30ab\u30eb\u30af\u30e9\u30b9\u30bf(master1)\u3067\u884c\u3046\u3002\n\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u4f5c\u6210\u306f\u3001set-credentials -> set-cluster -> set-context \u306e\u9806\u3067\u30b5\u30d6\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3059\u308b\u3002\u30ed\u30fc\u30ab\u30eb\u30af\u30e9\u30b9\u30bf\u3001\u30ea\u30e2\u30fc\u30c8\u30af\u30e9\u30b9\u30bf\u7528\u306b2\u3064\u4f5c\u6210\u3059\u308b\u3002\"local-user\",\"remote-user\"\u306f\u4efb\u610f\u306e\u540d\u524d\u3067\u826f\u3044\u3002\n[root@master1 ~]# kubectl config set-credentials local-user --username=hana --password=hana\nuser \"local-user\" set.\n[root@master1 ~]# kubectl config set-credentials remote-user --username=shin --password=shin\nuser \"remote-user\" set.\n\n\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u6210\u3059\u308b\u3002\u30ed\u30fc\u30ab\u30eb\u30af\u30e9\u30b9\u30bf\u3001\u30ea\u30e2\u30fc\u30c8\u30af\u30e9\u30b9\u30bf\u7528\u306b2\u3064\u4f5c\u6210\u3059\u308b\u3002\"localhost\",\"remotehost\"\u306f\u4efb\u610f\u306e\u540d\u524d\u3067\u826f\u3044\u3002\n[root@master1 ~]# kubectl config set-cluster localhost --insecure-skip-tls-verify=true --server=http://master1:8080\ncluster \"localhost\" set.\n[root@master1 ~]# kubectl config set-cluster remotehost --insecure-skip-tls-verify=true --server=http://master2:8080\ncluster \"remotehost\" set.\n\n\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u4f5c\u6210\u3059\u308b\u3002\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u4f5c\u6210\u3059\u308b\u3053\u3068\u3067\u3001\u30e6\u30fc\u30b6\u3068\u30af\u30e9\u30b9\u30bf\u304c\u7d10\u4ed8\u3051\u3055\u308c\u308b\u3002\n[root@master1 ~]# kubectl config set-context local-contex --user=local-user --cluster=localhost\ncontext \"local-contex\" set.\n[root@master1 ~]# kubectl config set-context remote-contex --user=remote-user --cluster=remotehost\ncontext \"remote-contex\" set.\n\n---------------------------------------------\n5. \u30ed\u30fc\u30ab\u30eb\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306ePod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n---------------------------------------------\n\u4f7f\u7528\u3059\u308b\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\"local-contex\"\u306b\u5207\u308a\u66ff\u3048\u308b\n[root@master1 ~]# kubectl config use-context local-contex\nswitched to context \"local-contex\".\n\n\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u78ba\u8a8d\u3059\u308b\u3002\"local-contex\"\u306b\u5207\u308a\u66ff\u308f\u3063\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master1 ~]# kubectl config current-context\nlocal-contex\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30ed\u30fc\u30ab\u30eb\u30af\u30e9\u30b9\u30bf\u306ePod\u304c\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n[root@master1 ~]# kubectl get pod\nNAME                           READY     STATUS    RESTARTS   AGE\nlocal-nginx-1294491604-jnqwn   1/1       Running   0          2m\n\n---------------------------------------------\n6. \u30ea\u30e2\u30fc\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306ePod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n---------------------------------------------\n\u4f7f\u7528\u3059\u308b\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\"remote-contex\"\u306b\u5207\u308a\u66ff\u3048\u308b\n[root@master1 ~]# kubectl config use-context remote-contex\nswitched to context \"remote-contex\".\n\n\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u78ba\u8a8d\u3059\u308b\u3002\"remote-contex\"\u306b\u5207\u308a\u66ff\u308f\u3063\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master1 ~]# kubectl config current-context\nremote-contex\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30ea\u30e2\u30fc\u30c8\u30af\u30e9\u30b9\u30bf\u306ePod\u304c\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n[root@master1 ~]# kubectl get pod\nNAME                            READY     STATUS    RESTARTS   AGE\nremote-nginx-1644388566-i26w1   1/1       Running   0          3m\n\n---------------------------------------------\n7. \u30ea\u30e2\u30fc\u30c8\u30af\u30e9\u30b9\u30bf\u3067Pod\u3092\u4f5c\u6210\u3059\u308b\u3002\n---------------------------------------------\n\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u78ba\u8a8d\u3059\u308b\u3002\"remote-contex\"\u3067\u3042\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master1 ~]# kubectl config current-context\nremote-contex\n\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master1 ~]# kubectl run httpd --image=httpd\ndeployment \"httpd\" created\n\nPod\u3092\u78ba\u8a8d\u3059\u308b\u3002nginx\u306b\u52a0\u3048\u3001httpd\u306ePod\u3082\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master1 ~]# kubectl get pod\nNAME                            READY     STATUS    RESTARTS   AGE\nhttpd-2047761252-6ywrg          1/1       Running   0          55s\nremote-nginx-1644388566-i26w1   1/1       Running   0          1h\n\nmaster2\u3067\u3082Pod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3002httpd\u306ePod\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master2 ~]# kubectl get pod\nNAME                            READY     STATUS    RESTARTS   AGE\nhttpd-2047761252-6ywrg          1/1       Running   0          1m\nremote-nginx-1644388566-i26w1   1/1       Running   0          1h\n[root@master2 ~]#\n\n\u30ea\u30e2\u30fc\u30c8\u30af\u30e9\u30b9\u30bf\u306ePod\u3092\u5168\u3066\u7d42\u4e86\u3059\u308b\u3002\n[root@master1 ~]# kubectl delete deployment remote-nginx\ndeployment \"remote-nginx\" deleted\n[root@master1 ~]# kubectl delete deployment httpd\ndeployment \"httpd\" deleted\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\u5168\u3066\u306ePod\u304c\u7d42\u4e86\u3057\u305f\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n[root@master1 ~]# kubectl get pod\n[root@master1 ~]#\n\n---------------------------------------------\n8. \u8a2d\u5b9a\u5185\u5bb9\u306e\u78ba\u8a8d\u65b9\u6cd5(view)\n---------------------------------------------\n[root@master1 ~]# kubectl config view\napiVersion: v1\nclusters:\n- cluster:\n    insecure-skip-tls-verify: true\n    server: http://master1:8080\n  name: localhost\n- cluster:\n    insecure-skip-tls-verify: true\n    server: http://master2:8080\n  name: remotehost\ncontexts:\n- context:\n    cluster: localhost\n    user: local-user\n  name: local-contex\n- context:\n    cluster: remotehost\n    user: remote-user\n  name: remote-contex\ncurrent-context: remote-contex\nkind: Config\npreferences: {}\nusers:\n- name: local-user\n  user:\n    password: hana\n    username: hana\n- name: remote-user\n  user:\n    password: shin\n    username: shin\n[root@master1 ~]#\n\n\u306a\u304a\u3001\u4e0a\u8a18\u30b3\u30de\u30f3\u30c9\u306f\u3001~/.kube/config\u306b\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u8a2d\u5b9a\u3092\u8868\u793a\u3057\u3066\u3044\u307e\u3059\u3002\n\n```\n\n\n##3.21 stop (\u5ec3\u6b62\u4e88\u5b9a\u306a\u306e\u3067\u4f7f\u308f\u306a\u3044\u3053\u3068\uff09\n\u4ee5\u4e0b\u3001man kubectl-stop \u3088\u308a\u5f15\u7528\n>\nThe  stop  command  is  deprecated,  all  its  functionalities  are covered by delete command.  \nSee 'kubectl delete --help' for more details.\n\n\n\n##3.22 kubectl version (kubernetes\u306e\u7248\u6570\u3092\u8868\u793a\u3059\u308b\uff09\n\n```\nkubernetes 1.2\u3092\u4f7f\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master ~]# kubectl version\nClient Version: version.Info{Major:\"1\", Minor:\"2\", GitVersion:\"v1.2.0\", GitCommit:\"ec7364b6e3b155e78086018aa644057edbe196e5\", GitTreeState:\"clean\"}\nServer Version: version.Info{Major:\"1\", Minor:\"2\", GitVersion:\"v1.2.0\", GitCommit:\"ec7364b6e3b155e78086018aa644057edbe196e5\", GitTreeState:\"clean\"}\n```\n\n\n##3.23 kubectl cluster-info(\u30af\u30e9\u30b9\u30bf\u306e\u60c5\u5831\u3092\u8868\u793a\u3059\u308b\uff09\n\n```\n[root@master ~]# kubectl cluster-info\nKubernetes master is running at http://localhost:8080\n```\n\n##3.24 kubectl api-versions(\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308bAPI\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u8868\u793a\u3059\u308b\uff09\n\n```\n[root@master ~]# kubectl api-versions\nautoscaling/v1\nbatch/v1\nextensions/v1beta1\nv1\n```\n\n\n\n##3.25 kubectl convert(\u30d5\u30a1\u30a4\u30eb\u5f62\u5f0f\u3092\u5909\u63db(yaml<=>json)\u3059\u308b\u3002)\n\n```\n[root@master ~]# cat nginx-deployment.yaml\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.7.9\n        ports:\n        - containerPort: 80\n\n\n[root@master ~]# kubectl convert -f nginx-deployment.yaml --local -o json\nrunning in local mode...\n{\n    \"kind\": \"Deployment\",\n    \"apiVersion\": \"extensions/v1beta1\",\n    \"metadata\": {\n        \"name\": \"nginx-deployment\",\n        \"creationTimestamp\": null,\n        \"labels\": {\n            \"app\": \"nginx\"\n        }\n    },\n    \"spec\": {\n        \"replicas\": 1,\n        \"selector\": {\n            \"matchLabels\": {\n                \"app\": \"nginx\"\n            }\n        },\n        \"template\": {\n            \"metadata\": {\n                \"creationTimestamp\": null,\n                \"labels\": {\n                    \"app\": \"nginx\"\n                }\n            },\n            \"spec\": {\n                \"containers\": [\n                    {\n                        \"name\": \"nginx\",\n                        \"image\": \"nginx:1.7.9\",\n                        \"ports\": [\n                            {\n                                \"containerPort\": 80,\n                                \"protocol\": \"TCP\"\n                            }\n                        ],\n                        \"resources\": {},\n                        \"terminationMessagePath\": \"/dev/termination-log\",\n                        \"imagePullPolicy\": \"IfNotPresent\"\n                    }\n                ],\n                \"restartPolicy\": \"Always\",\n                \"terminationGracePeriodSeconds\": 30,\n                \"dnsPolicy\": \"ClusterFirst\",\n                \"securityContext\": {}\n            }\n        },\n        \"strategy\": {\n            \"type\": \"RollingUpdate\",\n            \"rollingUpdate\": {\n                \"maxUnavailable\": 1,\n                \"maxSurge\": 1\n            }\n        }\n    },\n    \"status\": {}\n}\n[root@master ~]#\n```\n\n\n\n##3.26 kubectl explain(\u30ea\u30bd\u30fc\u30b9\u306e\u8aac\u660e)\n\n```\n[root@master ~]# kubectl explain node\nDESCRIPTION:\nNode is a worker node in Kubernetes, formerly known as minion. Each node will have a unique identifier in the cache (i.e. in etcd).\n\nFIELDS:\n   apiVersion   <string>\n     APIVersion defines the versioned schema of this representation of an\n     object. Servers should convert recognized schemas to the latest internal\n     value, and may reject unrecognized values. More info:\n     http://releases.k8s.io/release-1.2/docs/devel/api-conventions.md#resources\n-\u4ee5\u4e0b\u3001\u7565-\n\n\u4ed6\u306b\u3082\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30ea\u30bd\u30fc\u30b9\u306e\u8aac\u660e\u304c\u3042\u308b\u3002\u30ea\u30bd\u30fc\u30b9\u4e00\u89a7\u3092\u5f97\u305f\u3044\u306a\u3089\u3001kubectl get\u3092\u5165\u529b\u3057\u305f\u3042\u3068\u306b \"TAB\"\u30ad\u30fc\u3092\u62bc\u4e0b\u3059\u308b\u3002\n[root@master ~]# kubectl explain pod\n[root@master ~]# kubectl explain deployment\n[root@master ~]# kubectl explain rc\n```\n\n\n#4 \u305d\u306e\u4ed6\n#4.1 \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u72b6\u614b\u3092\u8abf\u3079\u308b\n```\n[root@master ~]# kubectl get componentstatus\nNAME                 STATUS    MESSAGE              ERROR\ncontroller-manager   Healthy   ok\nscheduler            Healthy   ok\netcd-0               Healthy   {\"health\": \"true\"}\n\netcd\u3092\u505c\u6b62\u3059\u308b\u3002\n[root@master ~]# systemctl stop etcd\n[root@master ~]# systemctl is-active etcd\ninactive\n\n\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002etcd\u3092\u505c\u6b62\u3059\u308b\u3068\u3001etcd\u306e\u884c\u81ea\u4f53\u8868\u793a\u3055\u308c\u306a\u3044\u3088\u3046\u3060\u3002\n[root@master ~]# kubectl get componentstatus\nNAME                 STATUS    MESSAGE   ERROR\nscheduler            Healthy   ok\ncontroller-manager   Healthy   ok\n\n\u6b21\u306b\u3001scheduler\u3092\u505c\u6b62\u3059\u308b\u3002\n[root@master ~]# systemctl stop kube-scheduler.service\n[root@master ~]# systemctl is-active kube-scheduler.service\ninactive\n\n\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002scheduler\u306e\u72b6\u614b\u304c\u300cUnhealthy\u300d\u3068\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002\n[root@master ~]# kubectl get componentstatus\nNAME                 STATUS      MESSAGE                                                                                        ERROR\nscheduler            Unhealthy   Get http://127.0.0.1:10251/healthz: dial tcp 127.0.0.1:10251: getsockopt: connection refused\ncontroller-manager   Healthy     ok\n\n\u6b21\u306b\u3001controller-manager\u3092\u505c\u6b62\u3059\u308b\u3002\n[root@master ~]# systemctl stop kube-controller-manager.service\n[root@master ~]# systemctl is-active kube-controller-manager.service\ninactive\n\n\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002controller-manager\u306e\u72b6\u614b\u304c\u300cUnhealthy\u300d\u3068\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002\n[root@master ~]# kubectl get componentstatus\nNAME                 STATUS      MESSAGE                                                                                        ERROR\ncontroller-manager   Unhealthy   Get http://127.0.0.1:10252/healthz: dial tcp 127.0.0.1:10252: getsockopt: connection refused\nscheduler            Unhealthy   Get http://127.0.0.1:10251/healthz: dial tcp 127.0.0.1:10251: getsockopt: connection refused\n[root@master ~]#\n\netcd,scheduler,controller-manager\u3092\u518d\u5ea6\u8d77\u52d5\u3057\u3066\u3001\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# systemctl start etcd\n[root@master ~]# systemctl start kube-controller-manager.service\n[root@master ~]# systemctl start kube-scheduler.service\n[root@master ~]# kubectl get componentstatus\nNAME                 STATUS    MESSAGE              ERROR\nscheduler            Healthy   ok\ncontroller-manager   Healthy   ok\netcd-0               Healthy   {\"health\": \"true\"}\n\n```\n\n#4.2 kubectl\u30b3\u30de\u30f3\u30c9\u304c\u5229\u7528\u3057\u3066\u3044\u308bAPI\u3092\u8abf\u3079\u308b\n\u30aa\u30d7\u30b7\u30e7\u30f3\u306b--v=6,7,8\u3092\u6307\u5b9a\u3059\u308b\u3068\u3001kubectl\u5b9f\u884c\u6642\u306b\u5229\u7528\u3057\u3066\u3044\u308bAPI\u3092\u8abf\u3079\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u30026->7->8\u3068\u306a\u308b\u306b\u3064\u308c\u3066\u3001\u3088\u308a\u8a73\u7d30\u306a\u60c5\u5831\u304c\u5f97\u3089\u308c\u308b\u3002\n\n```\n[root@master ~]# kubectl get pod --v=6\nI1106 18:44:05.765128   10587 round_trippers.go:286] GET http://localhost:8080/api 200 OK in 3 milliseconds\nI1106 18:44:05.769004   10587 round_trippers.go:286] GET http://localhost:8080/apis 200 OK in 1 milliseconds\nI1106 18:44:05.775203   10587 round_trippers.go:286] GET http://localhost:8080/api/v1/namespaces/default/pods 200 OK in 3 milliseconds\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-2040093540-jdy9o   1/1       Running   0          3m\n\n\n--v=7\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\n[root@master ~]# kubectl get pod --v=7\nI1106 18:44:07.691145   10596 round_trippers.go:264] GET http://localhost:8080/api\nI1106 18:44:07.691350   10596 round_trippers.go:271] Request Headers:\nI1106 18:44:07.691380   10596 round_trippers.go:274]     Accept: application/json, */*\nI1106 18:44:07.691407   10596 round_trippers.go:274]     User-Agent: kubectl/v1.2.0 (linux/amd64) kubernetes/ec7364b\nI1106 18:44:07.696376   10596 round_trippers.go:289] Response Status: 200 OK in 4 milliseconds\nI1106 18:44:07.697985   10596 round_trippers.go:264] GET http://localhost:8080/apis\nI1106 18:44:07.698169   10596 round_trippers.go:271] Request Headers:\nI1106 18:44:07.698224   10596 round_trippers.go:274]     User-Agent: kubectl/v1.2.0 (linux/amd64) kubernetes/ec7364b\nI1106 18:44:07.698280   10596 round_trippers.go:274]     Accept: application/json, */*\nI1106 18:44:07.700849   10596 round_trippers.go:289] Response Status: 200 OK in 2 milliseconds\nI1106 18:44:07.703040   10596 round_trippers.go:264] GET http://localhost:8080/api/v1/namespaces/default/pods\nI1106 18:44:07.703818   10596 round_trippers.go:271] Request Headers:\nI1106 18:44:07.704378   10596 round_trippers.go:274]     Accept: application/json, */*\nI1106 18:44:07.705106   10596 round_trippers.go:274]     User-Agent: kubectl/v1.2.0 (linux/amd64) kubernetes/ec7364b\nI1106 18:44:07.709303   10596 round_trippers.go:289] Response Status: 200 OK in 3 milliseconds\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-2040093540-jdy9o   1/1       Running   0          3m\n[root@master ~]#\n```\n\n#4.3 \u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u3068\u304d\u3001target-port\u306b\u3069\u3093\u306a\u5024\u3092\u6307\u5b9a\u3059\u308b\u306e\u304b\uff1f\n\u30a4\u30e1\u30fc\u30b8\u304cExposedPorts\u3068\u3057\u3066Expose\u3057\u3066\u3044\u308b\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u6307\u5b9a\u3059\u308b\u3002\u305f\u3081\u3057\u306b\u3001httpd \u306e\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u3068\u304d\u3001target-port\u306b100\u756a\u3092\u6307\u5b9a\u3057\u3066\u307f\u305f\u3068\u3053\u308d\u3001Pod\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u306a\u304b\u3063\u305f\u3002ExposedPorts\u306e\u8aac\u660e\u306f https://docs.docker.com/docker-cloud/apps/ports/ \u3092\u53c2\u7167\u3057\u307e\u3057\u305f\u3002\n\n```\n[root@master ~]# kubectl run httpd --image=httpd\ndeployment \"httpd\" created\n\n[root@master ~]# kubectl get pod\nNAME                     READY     STATUS    RESTARTS   AGE\nhttpd-2047761252-fmrmn   1/1       Running   0          12s\n\n[root@master ~]# kubectl expose deployment httpd --port=8888 --target-port=100\nservice \"httpd\" exposed\n\n\u30b5\u30fc\u30d3\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master ~]# kubectl get svc\nNAME         CLUSTER-IP      EXTERNAL-IP   PORT(S)         AGE\nhttpd        10.254.40.137   <none>        8888/TCP        5s\n\n\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u60c5\u5831\u3092\u78ba\u8a8d\u3059\u308b\u3002Pod\u5074\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u304c100\u756a\u306b\u306a\u3063\u305f\n[root@master ~]# kubectl get endpoints\nNAME         ENDPOINTS            AGE\nhttpd        10.1.72.2:100        8s\n\n[root@master ~]# curl http://10.254.40.137:8888\ncurl: (7) Failed connect to 10.254.40.137:8888; \u63a5\u7d9a\u3092\u62d2\u5426\u3055\u308c\u307e\u3057\u305f\n\n\n[root@master ~]# docker images |grep httpd\ndocker.io/httpd                                       latest              9a0bc463edaa        2 weeks ago         193.3 MB\n[root@master ~]# docker inspect httpd|grep -A2 ExposedPorts\n            \"ExposedPorts\": {\n                \"80/tcp\": {}\n            },\n--\n            \"ExposedPorts\": {\n                \"80/tcp\": {}\n            },\n\n```\n\n\n\n#4.4 \u6307\u5b9a\u3057\u305f\u30db\u30b9\u30c8\u3067Pod\u3092\u8d77\u52d5\u3059\u308b(nodeSelector\u3092\u4f7f\u3046)\n\n```\n\u30db\u30b9\u30c8\u306e\u30e9\u30d9\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master1 ~]# kubectl get node --show-labels\nNAME      STATUS    AGE       LABELS\nmaster1   Ready     3h        kubernetes.io/hostname=master1\nmaster2   Ready     3h        kubernetes.io/hostname=master2\n\nPod\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\nPod\u3092master2\u3067\u8d77\u52d5\u3059\u308b\u306e\u3067\u3001nodeSelector\u306b\"kubernetes.io/hostname: master2\"\u3092\u6307\u5b9a\u3059\u308b\u3002\n[root@master1 ~]# vi centos.yaml\n[root@master1 ~]# cat centos.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: centos\n  labels:\n    app: web\nspec:\n  containers:\n    - name: centos6\n      image: centos:centos6\n      command: [\"sleep\", \"3600\"]\n    - name: centos7\n      image: centos:centos7\n      command: [\"sleep\", \"3600\"]\n  nodeSelector:\n    kubernetes.io/hostname: master2\n\nPod\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@master1 ~]# kubectl create -f centos.yaml\npod \"centos\" created\n\nPod\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002master2\u3067\u52d5\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master1 ~]# kubectl get pod -o wide --show-labels\nNAME                          READY     STATUS    RESTARTS   AGE       NODE      LABELS\ncentos                        2/2       Running   0          10s       master2   app=web\n\n\u305f\u3081\u3057\u306b\u3001centos7\u3067bash\u3092\u5b9f\u884c\u3057\u3066\u307f\u308b\u3002centos7.3\u3067\u3042\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master1 ~]# kubectl exec centos -c centos7 -it bash\n[root@centos /]# cat /etc/redhat-release\nCentOS Linux release 7.3.1611 (Core)\n[root@centos /]# exit\nexit\n\n\u305f\u3081\u3057\u306b\u3001centos6\u3067bash\u3092\u5b9f\u884c\u3057\u3066\u307f\u308b\u3002centos6.8\u3067\u3042\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master1 ~]# kubectl exec centos -c centos6 -it bash\n[root@centos /]# cat /etc/redhat-release\nCentOS release 6.8 (Final)\n[root@centos /]# exit\nexit\n\nPod\u3092\u7d42\u4e86\u3059\u308b\u3002\n[root@master1 ~]# kubectl delete pod centos\npod \"centos\" deleted\n\n```\n\n\n\n#4.5 kubelet\u306ePod\u8d77\u52d5\u65b9\u6cd5\n\nPod\u3092\u8d77\u52d5\u3059\u308b\u306b\u306f\u3001kubectl run\u3092\u5b9f\u884c\u3059\u308b\u65b9\u6cd5\u4ee5\u5916\u306b\u3001\u4ed6\u306b3\u3064\u306e\u65b9\u6cd5\u304c\u3042\u308b(man kubelet\u3088\u308a\uff09\n\u672c\u7ae0\u3067\u306f\u3001Pod\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u306e\u683c\u7d0d\u5834\u6240\u3092kubelet\u306e\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u306b\u5b9a\u7fa9\u3059\u308b\u65b9\u6cd5\u306b\u3064\u3044\u3066\u8aac\u660e\u3059\u308b\u3002\n\n```\n-----------------------------------------------\n1. \u53c2\u8003\u60c5\u5831\n------------------------------------------------\nkubelet\u306ePod\u8d77\u52d5\u65b9\u6cd5\u3002man kubelet\u3088\u308a\u629c\u7c8b\u3002\n\n  (1) kube-apiserver\u304b\u3089\u306e\u6307\u793a(kubectl run\u3067\u8d77\u52d5\u3059\u308b\u65b9\u6cd5)\n  (2) kubelet\u304cpod\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3093\u3067Pod\u3092\u8d77\u52d5\u3059\u308b\u65b9\u6cd5(\u3053\u3053\u306e\u8aac\u660e)\n  (3) HTTP  endpoint\u306b\u3088\u308b\u65b9\u6cd5\n  (4) HTTP server\u306b\u3088\u308b\u65b9\u6cd5\n\n\u4ed6\u306e\u53c2\u8003\u60c5\u5831\nhttp://kubernetes.io/docs/admin/static-pods/\n\n-----------------------------------------------\n2. \u5b9f\u65bd\u624b\u9806\n------------------------------------------------\nPod\u306e\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb(yaml)\u3092\u683c\u7d0d\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@node1 ~]# mkdir -p /etc/kubernetes/manifests\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u683c\u7d0d\u5834\u6240\u3092kubelet\u306e\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u306b\u6307\u5b9a\u3059\u308b\u3002\n[root@node1 ~]# vi /etc/kubernetes/kubelet\nKUBELET_ARGS=\"--config=/etc/kubernetes/manifests\"\n\n\u30c6\u30b9\u30c8\u7528\u306ePod(httpd)\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@node1 ~]# vi /etc/kubernetes/manifests/httpd.yaml\n[root@node1 ~]# cat /etc/kubernetes/manifests/httpd.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: httpd\nspec:\n  containers:\n  - name: httpd\n    image: httpd\n    ports:\n    - containerPort: 8080\n\n\n\u30c6\u30b9\u30c8\u7528\u306ePod(Nginx)\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@node1 ~]# vi /etc/kubernetes/manifests/nginx.yaml\n[root@node1 ~]# cat /etc/kubernetes/manifests/nginx.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\nspec:\n  containers:\n  - name: nginx\n    image: nginx\n    ports:\n    - containerPort: 80\n\n\u4f5c\u6210\u3057\u305fPod\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@node1 ~]# ls /etc/kubernetes/manifests/\nhttpd.yaml  nginx.yaml\n\nkubelet\u3092\u518d\u8d77\u52d5\u3059\u308b\u3002\n[root@node1 ~]# systemctl restart kubelet.service\n\nkubelet\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@node1 ~]# systemctl is-active kubelet.service\nactive\n\nkubelet\u306e\u8d77\u52d5\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u78ba\u8a8d\u3059\u308b\u30021\u884c\u304c\u9577\u3044\u306e\u3067\u6298\u308a\u8fd4\u3057\u3066\u3044\u307e\u3059\u3002\nPod\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u306e\u683c\u7d0d\u5834\u6240(\u2605\u5370)\u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@node1 ~]# ps aux |grep kubelet\nroot       6795 11.0  4.1 425032 41628 ?        Ssl  09:42   0:54 /usr/bin/kubelet \n    --logtostderr=true \n    --v=0 \n    --api-servers=http://master1:8080 \n    --address=0.0.0.0 \n    --allow-privileged=false \n    --pod-infra-container-image=registry.access.redhat.com/rhel7/pod-infrastructure:latest \n  \u2605--config=/etc/kubernetes/manifests\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\u30b3\u30f3\u30c6\u30ca\u304c2\u3064(Httpd,Nginx)\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@node1 ~]# docker ps\nCONTAINER ID        IMAGE                                                        COMMAND                  CREATED              STATUS              PORTS               NAMES\n50577e1e4446        nginx                                                        \"nginx -g 'daemon off\"   About a minute ago   Up About a minute                       k8s_nginx.7270fc8f_nginx-node1_default_ca6112932ce36c625ac20a3916ea5bac_32042029\n795272acc6ef        httpd                                                        \"httpd-foreground\"       About a minute ago   Up About a minute                       k8s_httpd.ccebfcf7_httpd-node1_default_df10c6d7dec5867a7c313e234344ce45_ec8dd867\nba1b7228adb5        registry.access.redhat.com/rhel7/pod-infrastructure:latest   \"/pod\"                   2 minutes ago        Up About a minute                       k8s_POD.c36b0a77_nginx-node1_default_ca6112932ce36c625ac20a3916ea5bac_fe690ed7\nbc90da1e0bb3        registry.access.redhat.com/rhel7/pod-infrastructure:latest   \"/pod\"                   2 minutes ago        Up About a minute                       k8s_POD.3e750adf_httpd-node1_default_df10c6d7dec5867a7c313e234344ce45_554c2cd3\n[root@node1 ~]#\n\nPod\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@node1 manifests]# pwd\n/etc/kubernetes/manifests\n[root@node1 manifests]# ls\nhttpd.yaml  nginx.yaml\n\nkubelet\u304cPod\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u3081\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u3002\n[root@node1 manifests]# mv httpd.yaml ../\n[root@node1 manifests]# mv nginx.yaml ../\n[root@node1 manifests]# ls\n[root@node1 manifests]#\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002Pod\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u304c\u8aad\u3081\u306a\u304f\u306a\u308a\u3001kubelet\u304c\u30b3\u30f3\u30c6\u30ca\u3092\u7d42\u4e86\u3055\u305b\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@node1 ~]# docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n[root@node1 ~]#\n\n\nhttpd\u306ePod\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3060\u3051\u3001kubelet\u304c\u8aad\u3081\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n[root@node1 manifests]# cp ../httpd.yaml .\n[root@node1 manifests]# ls\nhttpd.yaml\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002Httpd\u306e\u30b3\u30f3\u30c6\u30ca\u3060\u3051\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@node1 manifests]# docker ps\nCONTAINER ID        IMAGE                                                        COMMAND              CREATED             STATUS                  PORTS               NAMES\nb0aac7802de2        httpd                                                        \"httpd-foreground\"   3 seconds ago       Up Less than a second                       k8s_httpd.ccebfcf7_httpd-node1_default_df10c6d7dec5867a7c313e234344ce45_75d498d0\ne0bae879cd72        registry.access.redhat.com/rhel7/pod-infrastructure:latest   \"/pod\"               16 seconds ago      Up 12 seconds                               k8s_POD.3e750adf_httpd-node1_default_df10c6d7dec5867a7c313e234344ce45_b22b86a6\n[root@node1 manifests]#\n\n```\n\n\n##4.6 Pod,RC(ReplicationController),Deployment\u306eyaml\u30d5\u30a1\u30a4\u30eb\n\nbusybox\u306ePod\u3092\u8d77\u52d5\u3059\u308b\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092Pod,RC,Deployment\u3068\u3057\u3066\u4f5c\u6210\u3057\u305f\u3002\n\n[The spec schema](https://kubernetes.io/docs/user-guide/pods/multi-container/)\n\n```\n---------------------------------------\n1. Pod\n---------------------------------------\nPod\u306e\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\n[root@master1 test]# cat test.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n   name: busybox-test\nspec:\n  containers:\n    - name: busybox\n      image: busybox\n      command: [\"sleep\", \"3600\"]\n\n[root@master1 test]# kubectl create -f test.yaml\npod \"busybox-test\" created\n\n[root@master1 test]# kubectl get pod\nNAME           READY     STATUS    RESTARTS   AGE\nbusybox-test   1/1       Running   0          46s\n\n\n---------------------------------------\n2. ReplicationController\n---------------------------------------\n[root@master1 test]# cat test2.yaml\napiVersion: v1\nkind: ReplicationController\nmetadata:\n  name: busybox-test\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: busybox\n    spec:\n      containers:\n      - name: nginx\n        image: nginx\n        command: [\"sleep\", \"3600\"]\n\n[root@master1 test]# kubectl create -f test2.yaml\nreplicationcontroller \"busybox-test\" created\n\n[root@master1 test]# kubectl get pod\nNAME                 READY     STATUS    RESTARTS   AGE\nbusybox-test-vcpjd   1/1       Running   0          17s\n\n[root@master1 test]# kubectl get rc\nNAME           DESIRED   CURRENT   AGE\nbusybox-test   1         1         20s\n[root@master1 test]#\n\n---------------------------------------\n3. Deployment\n---------------------------------------\n[root@master1 test]# cat test3.yaml\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: busybox-test\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: busybox\n    spec:\n      containers:\n      - name: busybox\n        image: busybox\n        command: [\"sleep\", \"3600\"]\n[root@master1 test]#\n\n[root@master1 test]# kubectl create -f test3.yaml\ndeployment \"busybox-test\" created\n\n[root@master1 test]# kubectl get pod\nNAME                           READY     STATUS    RESTARTS   AGE\nbusybox-test-308240389-dgcor   1/1       Running   0          27s\n\n[root@master1 test]# kubectl get deployment\nNAME           DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\nbusybox-test   1         1         1            1           34s\n\n\n```\n\n\n\n##4.7 \u30ea\u30bd\u30fc\u30b9\u5236\u5fa1(ResourceQuota,limitrange)\n\n- ResourceQuota\n  \u8d77\u52d5\u3059\u308bpod\u6570\u3092namespace\u6bce\u306b\u6700\u5927100\u500b\u307e\u3067\u3001\u3068\u3044\u3063\u305f\u5236\u9650\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u304d\u306b\u4f7f\u3046\u3002\n  cpu,memory\u3082\u8a2d\u5b9a\u53ef\u80fd\u3002\u307e\u305f\u3001\u4f7f\u7528\u4e2d\u306e\u30ea\u30bd\u30fc\u30b9\u91cf\u3092\u8868\u793a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n- limitrange\n  Container\u304c\u4f7f\u7528\u3059\u30ea\u30bd\u30fc\u30b9(cpu,memory)\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3001\u304a\u3088\u3073\u4e0a\u9650\u5024\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n  \u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3067\u306f\u306a\u304f\u3001\u4efb\u610f\u306e\u5024\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u306f\u3001Container\u8d77\u52d5\u6642\u3001\u30b3\u30de\u30f3\u30c9\u306e\n  \u30aa\u30d7\u30b7\u30e7\u30f3(--requests=memory,--requests=cpu)\u306b\u4f7f\u7528\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u91cf\u3092\u660e\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n  \u305f\u3060\u3057\u4e0a\u9650\u5024\u3092\u8d85\u3048\u3066\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u306a\u3044\u3002\n\n\n```\n----------------\n1. \u4e8b\u524d\u6e96\u5099\n----------------\napiserver\u306e\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u7de8\u96c6\u3059\u308b\u3002LimitRanger\u3092\u6709\u52b9\u306b\u3059\u308b\u3002\n[root@master ~]# vi /etc/kubernetes/apiserver\nKUBE_ADMISSION_CONTROL=\"--admission-control=LimitRanger\"\n\n[root@master resource]# cat quota.yaml\napiVersion: v1\nkind: ResourceQuota\nmetadata:\n  name: quota\nspec:\n  hard:\n    cpu: \"10\"\n    memory: 1Gi\n    pods: \"2\"\n    replicationcontrollers: \"5\"\n    resourcequotas: \"1\"\n    services: \"5\"\n\n\n[root@master resource]# cat limits.yaml\napiVersion: v1\nkind: LimitRange\nmetadata:\n  name: limits\nspec:\n  limits:\n  - max:\n      cpu: \"2\"\n      memory: 1Gi\n    min:\n      cpu: 200m\n      memory: 6Mi\n    type: Pod\n  - default:\n      cpu: 400m\n      memory: 200Mi\n    defaultRequest:\n      cpu: 300m\n      memory: 100Mi\n    max:\n      cpu: \"2\"\n      memory: 500Mi\n    min:\n      cpu: 100m\n      memory: 3Mi\n    type: Container\n\n\n\u30ea\u30bd\u30fc\u30b9\u30af\u30a9\u30fc\u30bf(resourcequota)\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master resource]# kubectl create -f quota.yaml\nresourcequota \"quota\" created\n\n\u30ea\u30bd\u30fc\u30b9\u30af\u30a9\u30fc\u30bf\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master resource]# kubectl describe resourcequota quota\nName:                   quota\nNamespace:              default\nResource                Used    Hard\n--------                ----    ----\ncpu                     0       10\nmemory                  0       1Gi\npods                    0       2\nreplicationcontrollers  0       5\nresourcequotas          1       1\nservices                1       5\n\n\n\nlimitrange\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master resource]# kubectl create -f limits.yaml\nlimitrange \"limits\" created\n\nlimitrange\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master resource]# kubectl describe limitrange limits\nName:           limits\nNamespace:      default\nType            Resource        Min     Max     Default Request Default Limit   Max Limit/Request Ratio\n----            --------        ---     ---     --------------- -------------   -----------------------\nPod             memory          6Mi     1Gi     -               -               -\nPod             cpu             200m    2       -               -               -\nContainer       cpu             100m    2       300m            400m            -\nContainer       memory          3Mi     500Mi   100Mi           200Mi           -\n\n\n-------------\n2. \u30c6\u30b9\u30c8\n-------------\n[root@master resource]# cat test.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n   name: centos\nspec:\n  containers:\n    - name: centos\n      image: centos\n      command: [\"sleep\", \"36000\"]\n\n\n````\n\n\n#5 \u53c2\u8003\u60c5\u5831\n##5.1 kubernetes\u516c\u5f0f\n[Deployments](http://kubernetes.io/docs/user-guide/deployments/#what-is-a-deployment)\n[Secrets](http://kubernetes.io/docs/user-guide/secrets/)\n[Using ConfigMap](http://kubernetes.io/docs/user-guide/configmap/)\n[high-availability](https://github.com/kubernetes/kubernetes.github.io/tree/master/docs/admin/high-availability)\n[k8s-setup](https://github.com/philips/real-world-kubernetes/tree/master/k8s-setup)\n\n##5.2 \u305d\u306e\u4ed6\n[Getting Started with Kubernetes](https://blog.codeship.com/getting-started-with-kubernetes/)\n[Sharing secret data in Kubernetes](https://mesosphere.com/blog/2015/11/12/sharing-secret-data-in-kubernetes/)\n[Kubernetes: \u69cb\u6210\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u4e00\u89a7](http://qiita.com/tkusumi/items/c2a92cd52bfdb9edd613#skydns-link)\n[Kubernetes\u306eConfigMap\u3092\u8a66\u3057\u3066\u307f\u308b](http://qiita.com/tkusumi/items/8e31fddda77f93ccfdd8)\n[Kubernetes\u30af\u30e9\u30b9\u30bf\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u3066Dashboard\u3067\u898b\u3048\u308b\u5316\u3092\u8a66\u3057\u3066\u307f\u305f](http://acro-engineer.hatenablog.com/entry/2016/10/04/120000)\n[Kubernetes \u3053\u3068\u59cb\u3081 (2) - Service\u958b\u767a](http://taizo.hatenablog.jp/entry/2016/09/15/003641)\n\n\n\n\n\n\n\n\n", "tags": ["kubernetes", "k8s", "kubectl", "POD", "Config"]}