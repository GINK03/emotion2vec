{"context": "pyodbc\u3068\u3044\u3046python\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3001Azure SQL Server\u5185\u306e\u30c7\u30fc\u30bf\u30c6\u30fc\u30d6\u30eb\u3092\u5f15\u3063\u3053\u629c\u304f\u307e\u3067\u304c\u51fa\u6765\u305f\u3068\u3053\u308d\u304b\u3089\u3001\u305d\u306e\u30c6\u30fc\u30d6\u30eb\u3092numpy\u306earray\u5f62\u5f0f\u3001\u3082\u3057\u304f\u306fpandas\u306eDataFrame\u5f62\u5f0f\u306b\u5909\u63db\u3059\u308b\u3068\u3053\u308d\u306e\u30e1\u30e2\u3067\u3059\u3002\n\u2192\u30e9\u30a4\u30d6\u30e9\u30ea\u3001\u74b0\u5883\u3001\u95a2\u6570\u306e\u5b9a\u7fa9\u306f\u3053\u3063\u3061\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u3002\n\u3001\u3001\u306e\u3067\u3001\u305d\u3061\u3089\u3092\u307e\u305a\u306f\u3054\u53c2\u7167\u4e0b\u3055\u3044\u3002\n\narray/DataFrame\u5f62\u5f0f\u306b\u3059\u308b\u305f\u3081\u306e\u6e96\u5099\n## libraries\nimport pyodbc\nimport numpy as np\nimport pandas as pd\n\n## initial setting\n## \u9069\u5b9c\u8a2d\u5b9a\u5024\u306f\u5909\u3048\u3066\u4e0b\u3055\u3044\nserver = 'abc_server.database.windows.net'  \ndatabase = 'abc_database'  \nusername = 'abc_user'  \npassword = 'abc_password'  \n\n## \u95a2\u6570\u5b9a\u7fa9\n### DB connection\u3092\u5b9a\u7fa9\ndef db_connection(sv=server, db=database, un=username, pw=password):    \n    cnxn = pyodbc.connect('DRIVER={ODBC Driver 13 for SQL Server};SERVER='+sv+';DATABASE='+db+';UID='+un+';PWD='+ pw)\n    return cnxn.cursor()\n\n### SQL\u3092\u767a\u884c\ndef query_output(sql):\n    cursor.execute(sql)\n    row = cursor.fetchone()\n    while row:  \n        print row[0]  \n        row = cursor.fetchone()\n\n\u2192\u8a2d\u5b9a\u306e\u610f\u5473\u306a\u3069\u306f\u3001\u8a66\u884c\u524d\u63d0\u306a\u3069\u3092\u3054\u53c2\u7167\u4e0b\u3055\u3044\u3002\n\nCase 2: \u30c6\u30fc\u30d6\u30eb\u306e\u4e2d\u8eab\u3092pandas dataframe\u306b\u7a81\u3063\u8fbc\u3080\n### DB connection\u3057\u3068\u304d\u307e\u3059\ncursor = db_connection()\n\n### SQL\u306e\u8a2d\u5b9a\nsql = 'select * from SalesLT.Customer;'\n\ncursor.execute(sql)\nrows = cursor.fetchall()\n\n\u3053\u306e\u8fba\u3067rows\u306e\u4e2d\u8eab\u3092\u78ba\u8a8d\u3057\u307e\u3059\uff1a\n>>> rows\n\n[(1, False, u'Mr.', u'Orlando', u'N.', u'Gee', None, u'A Bike Store', u'adventure-works\\\\pamela0', u'orlando0@adventure-works.com', u'245-555-0173', u'L/Rlwxzp4w7RWmEgXX+/A7cXaePEPcp+KwQhl2fJL7w=', u'1KjXYs4=', u'3F5AE95E-B87D-4AED-95B4-C3797AFCB74F', datetime.datetime(2005, 8, 1, 0, 0)),\n (2, False, u'Mr.', u'Keith', None, u'Harris', None, u'Progressive Sports', u'adventure-works\\\\david8', u'keith0@adventure-works.com', u'170-555-0127', u'YPdtRdvqeAhj6wyxEsFdshBDNXxkCXn+CRgbvJItknw=', u'fs1ZGhY=', u'E552F657-A9AF-4A7D-A645-C429D6E02491', datetime.datetime(2006, 8, 1, 0, 0)),\n (3, False, u'Ms.', u'Donna', u'F.', u'Carreras', None, u'Advanced Bike Components', u'adventure-works\\\\jillian0', u'donna0@adventure-works.com', u'279-555-0130', u'LNoK27abGQo48gGue3EBV/UrlYSToV0/s87dCRV7uJk=', u'YTNH5Rw=', u'130774B1-DB21-4EF3-98C8-C104BCD6ED6D', datetime.datetime(2005, 9, 1, 0, 0)),\n :\n\n\u3068\u3044\u3046\u611f\u3058\u3067\u3001\u914d\u5217\u306e\u4e2d\u306b\u914d\u5217\uff08\u3089\u3057\u304d\u3082\u306e\u3002\u6b63\u78ba\u306b\u306fpyodbc.Row\u3068\u3044\u3046\u5f62\u5f0f\uff09\u306a\u306e\u3067\u3001\n\u8a66\u3057\u306bnumpy\u306earray\u306b\u7a81\u3063\u8fbc\u3093\u3067\u307f\u307e\u3059\narray_format = np.array(rows)\ndataframe_format = pd.DataFrame(array_format)\n\n\u3059\u308b\u3068numpy\u306earray\u5f62\u5f0f\u306f\u3001\u3001\n\n>>>array_format\narray([[1, False, u'Mr.', ..., u'1KjXYs4=',\n        u'3F5AE95E-B87D-4AED-95B4-C3797AFCB74F',\n        datetime.datetime(2005, 8, 1, 0, 0)],\n       [2, False, u'Mr.', ..., u'fs1ZGhY=',\n        u'E552F657-A9AF-4A7D-A645-C429D6E02491',\n        datetime.datetime(2006, 8, 1, 0, 0)],\n       [3, False, u'Ms.', ..., u'YTNH5Rw=',\n        u'130774B1-DB21-4EF3-98C8-C104BCD6ED6D',\n        datetime.datetime(2005, 9, 1, 0, 0)],\n       ..., \n       [30116, False, u'Ms.', ..., u'HDCU1Bk=',\n        u'EC409609-D25D-41B8-9D15-A1AA6E89FC77',\n        datetime.datetime(2007, 7, 1, 0, 0)],\n       [30117, False, u'Mr.', ..., u'iES3IZA=',\n        u'6F08E2FB-1CD3-4F6E-A2E6-385669598B19',\n        datetime.datetime(2005, 8, 1, 0, 0)],\n       [30118, False, u'Ms.', ..., u'QhHP+y8=',\n        u'2495B4EB-FE8B-459E-A1B6-DBA25C04E626',\n        datetime.datetime(2006, 9, 1, 0, 0)]], dtype=object)\n>>> array_format.shape\n(847L, 15L)\n\n\u307e\u305f\u3001pandas\u306eDataFrame\u306e\u65b9\u306f\n\n>>>dataframe_format.head()\n  0      1    2        3     4           5     6                           7   \\\n0  1  False  Mr.  Orlando    N.         Gee  None                A Bike Store   \n1  2  False  Mr.    Keith  None      Harris  None          Progressive Sports   \n2  3  False  Ms.    Donna    F.    Carreras  None    Advanced Bike Components   \n3  4  False  Ms.    Janet    M.       Gates  None       Modular Cycle Systems   \n4  5  False  Mr.     Lucy  None  Harrington  None  Metropolitan Sports Supply   \n\n                         8                             9             10  \\\n0   adventure-works\\pamela0  orlando0@adventure-works.com  245-555-0173   \n1    adventure-works\\david8    keith0@adventure-works.com  170-555-0127   \n2  adventure-works\\jillian0    donna0@adventure-works.com  279-555-0130   \n3  adventure-works\\jillian0    janet1@adventure-works.com  710-555-0173   \n4      adventure-works\\shu0     lucy0@adventure-works.com  828-555-0186   \n\n                                             11        12  \\\n0  L/Rlwxzp4w7RWmEgXX+/A7cXaePEPcp+KwQhl2fJL7w=  1KjXYs4=   \n1  YPdtRdvqeAhj6wyxEsFdshBDNXxkCXn+CRgbvJItknw=  fs1ZGhY=   \n2  LNoK27abGQo48gGue3EBV/UrlYSToV0/s87dCRV7uJk=  YTNH5Rw=   \n3  ElzTpSNbUW1Ut+L5cWlfR7MF6nBZia8WpmGaQPjLOJA=  nm7D5e4=   \n4  KJqV15wsX3PG8TS5GSddp6LFFVdd3CoRftZM/tP0+R4=  cNFKU4w=   \n\n                                     13                   14  \n0  3F5AE95E-B87D-4AED-95B4-C3797AFCB74F  2005-08-01 00:00:00  \n1  E552F657-A9AF-4A7D-A645-C429D6E02491  2006-08-01 00:00:00  \n2  130774B1-DB21-4EF3-98C8-C104BCD6ED6D  2005-09-01 00:00:00  \n3  FF862851-1DAA-4044-BE7C-3E85583C054D  2006-07-01 00:00:00  \n4  83905BDC-6F5E-4F71-B162-C98DA069F38A  2006-09-01 00:00:00  \n\n>>> dataframe_format.shape\n(847, 15)\n\n\u3001\u3001\u3068\u306a\u3063\u3066\u5927\u4e08\u592b\u305d\u3046\u3067\u3059\u306d\u3002\n\nReference\n\nAzure SQL Server\u306e\u30c7\u30fc\u30bf\u30c6\u30fc\u30d6\u30eb\u3092pyodbc\u3067\u62bd\u51fa\u3057\u3066\u307f\u308b\n\n`pyodbc`\u3068\u3044\u3046python\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3001Azure SQL Server\u5185\u306e\u30c7\u30fc\u30bf\u30c6\u30fc\u30d6\u30eb\u3092\u5f15\u3063\u3053\u629c\u304f\u307e\u3067\u304c\u51fa\u6765\u305f\u3068\u3053\u308d\u304b\u3089\u3001\u305d\u306e\u30c6\u30fc\u30d6\u30eb\u3092`numpy`\u306e`array`\u5f62\u5f0f\u3001\u3082\u3057\u304f\u306f`pandas`\u306e`DataFrame`\u5f62\u5f0f\u306b\u5909\u63db\u3059\u308b\u3068\u3053\u308d\u306e\u30e1\u30e2\u3067\u3059\u3002\n\n\u2192[\u30e9\u30a4\u30d6\u30e9\u30ea\u3001\u74b0\u5883\u3001\u95a2\u6570\u306e\u5b9a\u7fa9\u306f\u3053\u3063\u3061\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3059](http://qiita.com/kyoro1/items/87b9f9bf29c6a057c1de)\u3002\n\u3001\u3001\u306e\u3067\u3001\u305d\u3061\u3089\u3092\u307e\u305a\u306f\u3054\u53c2\u7167\u4e0b\u3055\u3044\u3002\n\n## array/DataFrame\u5f62\u5f0f\u306b\u3059\u308b\u305f\u3081\u306e\u6e96\u5099\n```py\n## libraries\nimport pyodbc\nimport numpy as np\nimport pandas as pd\n\n## initial setting\n## \u9069\u5b9c\u8a2d\u5b9a\u5024\u306f\u5909\u3048\u3066\u4e0b\u3055\u3044\nserver = 'abc_server.database.windows.net'  \ndatabase = 'abc_database'  \nusername = 'abc_user'  \npassword = 'abc_password'  \n\n## \u95a2\u6570\u5b9a\u7fa9\n### DB connection\u3092\u5b9a\u7fa9\ndef db_connection(sv=server, db=database, un=username, pw=password):    \n    cnxn = pyodbc.connect('DRIVER={ODBC Driver 13 for SQL Server};SERVER='+sv+';DATABASE='+db+';UID='+un+';PWD='+ pw)\n    return cnxn.cursor()\n\n### SQL\u3092\u767a\u884c\ndef query_output(sql):\n    cursor.execute(sql)\n    row = cursor.fetchone()\n    while row:  \n        print row[0]  \n        row = cursor.fetchone()\n```\n\n\u2192\u8a2d\u5b9a\u306e\u610f\u5473\u306a\u3069\u306f\u3001[\u8a66\u884c\u524d\u63d0](http://qiita.com/kyoro1/items/87b9f9bf29c6a057c1de#%E8%A9%A6%E8%A1%8C%E5%89%8D%E6%8F%90)\u306a\u3069\u3092\u3054\u53c2\u7167\u4e0b\u3055\u3044\u3002\n\n## Case 2: \u30c6\u30fc\u30d6\u30eb\u306e\u4e2d\u8eab\u3092pandas dataframe\u306b\u7a81\u3063\u8fbc\u3080\n\n```py\n### DB connection\u3057\u3068\u304d\u307e\u3059\ncursor = db_connection()\n\n### SQL\u306e\u8a2d\u5b9a\nsql = 'select * from SalesLT.Customer;'\n\ncursor.execute(sql)\nrows = cursor.fetchall()\n```\n\n\u3053\u306e\u8fba\u3067`rows`\u306e\u4e2d\u8eab\u3092\u78ba\u8a8d\u3057\u307e\u3059\uff1a\n\n```py\n>>> rows\n\n[(1, False, u'Mr.', u'Orlando', u'N.', u'Gee', None, u'A Bike Store', u'adventure-works\\\\pamela0', u'orlando0@adventure-works.com', u'245-555-0173', u'L/Rlwxzp4w7RWmEgXX+/A7cXaePEPcp+KwQhl2fJL7w=', u'1KjXYs4=', u'3F5AE95E-B87D-4AED-95B4-C3797AFCB74F', datetime.datetime(2005, 8, 1, 0, 0)),\n (2, False, u'Mr.', u'Keith', None, u'Harris', None, u'Progressive Sports', u'adventure-works\\\\david8', u'keith0@adventure-works.com', u'170-555-0127', u'YPdtRdvqeAhj6wyxEsFdshBDNXxkCXn+CRgbvJItknw=', u'fs1ZGhY=', u'E552F657-A9AF-4A7D-A645-C429D6E02491', datetime.datetime(2006, 8, 1, 0, 0)),\n (3, False, u'Ms.', u'Donna', u'F.', u'Carreras', None, u'Advanced Bike Components', u'adventure-works\\\\jillian0', u'donna0@adventure-works.com', u'279-555-0130', u'LNoK27abGQo48gGue3EBV/UrlYSToV0/s87dCRV7uJk=', u'YTNH5Rw=', u'130774B1-DB21-4EF3-98C8-C104BCD6ED6D', datetime.datetime(2005, 9, 1, 0, 0)),\n :\n```\n\n\u3068\u3044\u3046\u611f\u3058\u3067\u3001\u914d\u5217\u306e\u4e2d\u306b\u914d\u5217\uff08\u3089\u3057\u304d\u3082\u306e\u3002\u6b63\u78ba\u306b\u306f`pyodbc.Row`\u3068\u3044\u3046\u5f62\u5f0f\uff09\u306a\u306e\u3067\u3001\n\u8a66\u3057\u306bnumpy\u306earray\u306b\u7a81\u3063\u8fbc\u3093\u3067\u307f\u307e\u3059\n\n```py\narray_format = np.array(rows)\ndataframe_format = pd.DataFrame(array_format)\n```\n\n\u3059\u308b\u3068`numpy`\u306e`array`\u5f62\u5f0f\u306f\u3001\u3001\n\n```py\n\n>>>array_format\narray([[1, False, u'Mr.', ..., u'1KjXYs4=',\n        u'3F5AE95E-B87D-4AED-95B4-C3797AFCB74F',\n        datetime.datetime(2005, 8, 1, 0, 0)],\n       [2, False, u'Mr.', ..., u'fs1ZGhY=',\n        u'E552F657-A9AF-4A7D-A645-C429D6E02491',\n        datetime.datetime(2006, 8, 1, 0, 0)],\n       [3, False, u'Ms.', ..., u'YTNH5Rw=',\n        u'130774B1-DB21-4EF3-98C8-C104BCD6ED6D',\n        datetime.datetime(2005, 9, 1, 0, 0)],\n       ..., \n       [30116, False, u'Ms.', ..., u'HDCU1Bk=',\n        u'EC409609-D25D-41B8-9D15-A1AA6E89FC77',\n        datetime.datetime(2007, 7, 1, 0, 0)],\n       [30117, False, u'Mr.', ..., u'iES3IZA=',\n        u'6F08E2FB-1CD3-4F6E-A2E6-385669598B19',\n        datetime.datetime(2005, 8, 1, 0, 0)],\n       [30118, False, u'Ms.', ..., u'QhHP+y8=',\n        u'2495B4EB-FE8B-459E-A1B6-DBA25C04E626',\n        datetime.datetime(2006, 9, 1, 0, 0)]], dtype=object)\n>>> array_format.shape\n(847L, 15L)\n```\n\n\u307e\u305f\u3001`pandas`\u306e`DataFrame`\u306e\u65b9\u306f\n\n```py\n\n>>>dataframe_format.head()\n  0      1    2        3     4           5     6                           7   \\\n0  1  False  Mr.  Orlando    N.         Gee  None                A Bike Store   \n1  2  False  Mr.    Keith  None      Harris  None          Progressive Sports   \n2  3  False  Ms.    Donna    F.    Carreras  None    Advanced Bike Components   \n3  4  False  Ms.    Janet    M.       Gates  None       Modular Cycle Systems   \n4  5  False  Mr.     Lucy  None  Harrington  None  Metropolitan Sports Supply   \n\n                         8                             9             10  \\\n0   adventure-works\\pamela0  orlando0@adventure-works.com  245-555-0173   \n1    adventure-works\\david8    keith0@adventure-works.com  170-555-0127   \n2  adventure-works\\jillian0    donna0@adventure-works.com  279-555-0130   \n3  adventure-works\\jillian0    janet1@adventure-works.com  710-555-0173   \n4      adventure-works\\shu0     lucy0@adventure-works.com  828-555-0186   \n\n                                             11        12  \\\n0  L/Rlwxzp4w7RWmEgXX+/A7cXaePEPcp+KwQhl2fJL7w=  1KjXYs4=   \n1  YPdtRdvqeAhj6wyxEsFdshBDNXxkCXn+CRgbvJItknw=  fs1ZGhY=   \n2  LNoK27abGQo48gGue3EBV/UrlYSToV0/s87dCRV7uJk=  YTNH5Rw=   \n3  ElzTpSNbUW1Ut+L5cWlfR7MF6nBZia8WpmGaQPjLOJA=  nm7D5e4=   \n4  KJqV15wsX3PG8TS5GSddp6LFFVdd3CoRftZM/tP0+R4=  cNFKU4w=   \n\n                                     13                   14  \n0  3F5AE95E-B87D-4AED-95B4-C3797AFCB74F  2005-08-01 00:00:00  \n1  E552F657-A9AF-4A7D-A645-C429D6E02491  2006-08-01 00:00:00  \n2  130774B1-DB21-4EF3-98C8-C104BCD6ED6D  2005-09-01 00:00:00  \n3  FF862851-1DAA-4044-BE7C-3E85583C054D  2006-07-01 00:00:00  \n4  83905BDC-6F5E-4F71-B162-C98DA069F38A  2006-09-01 00:00:00  \n\n>>> dataframe_format.shape\n(847, 15)\n```\n\n\u3001\u3001\u3068\u306a\u3063\u3066\u5927\u4e08\u592b\u305d\u3046\u3067\u3059\u306d\u3002\n\n# Reference\n- [Azure SQL Server\u306e\u30c7\u30fc\u30bf\u30c6\u30fc\u30d6\u30eb\u3092pyodbc\u3067\u62bd\u51fa\u3057\u3066\u307f\u308b](http://qiita.com/kyoro1/items/87b9f9bf29c6a057c1de)\n", "tags": ["Python", "pyodbc", "AzureSQL\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9", "pandas", "numpy"]}