{"context": " More than 1 year has passed since last update.\n\n\u80cc\u666f\n\u72ec\u81ea\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u30ed\u30b0\u3092\u30ed\u30fc\u30ab\u30eb\u306b\u6b8b\u3057\u3064\u3064\u3001TreasureData\u306b\u5165\u308c\u3066\u307f\u305f\u3044\u306a\u3068\u601d\u3044\u8abf\u3079\u3066\u307f\u305f\u3002\n\u30b5\u30fc\u30d3\u30b9\u306e\u5229\u7528\u65b9\u6cd5\u3084fluentd(td-agent)\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5\u306f\u4ee5\u4e0b\u306b\u8a18\u8f09\u6e08\u307f\u3002\n\nTreasureData\u4f7f\u3063\u3066\u307f\u305f\nnginx + fluentd + TreasureData\n\n\u4ee5\u4e0b\u74b0\u5883\u60c5\u5831\u3002\n\nubuntu: 12.04\ntd-agent: 0.10.50\n\n\n\u30ed\u30b0\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\n\u4ee5\u4e0bTreasureData\u306b\u5165\u308c\u305f\u3044\u30ed\u30b0\u3002\n\nlog\n2014-09-01 15:06:53 test-watch INFO -- bash Check TEST API: Start\n2014-09-01 15:06:54 test-watch INFO -- bash Check TEST GET STATUS PAGE: #num:0 Start\n2014-09-01 15:06:54 test-watch INFO -- bash Check TEST GET STATUS PAGE: Normal End\n2014-09-01 15:06:54 test-watch INFO -- bash Check TEST Web Console login: #num:0 Start\n2014-09-01 15:06:54 test-watch INFO -- ruby Start\n2014-09-01 15:06:54 test-watch INFO -- ruby HTTP Get Request Start test-server:80\n2014-09-01 15:06:54 test-watch INFO -- ruby HTTP Get Request End test-server:80\n2014-09-01 15:06:54 test-watch INFO -- ruby HTTP Get Response 200 OK\n2014-09-01 15:06:54 test-watch INFO -- ruby HTTP POST Request Start test-server:80\n2014-09-01 15:06:54 test-watch INFO -- ruby HTTP POST Request End test-server:80\n2014-09-01 15:06:54 test-watch INFO -- ruby HTTP POST Response 302 Found\n2014-09-01 15:06:54 test-watch INFO -- ruby Normal End\n2014-09-01 15:06:54 test-watch INFO -- bash Check TEST Web Console login: Normal End\n2014-09-01 15:06:54 test-watch INFO -- bash Check API Login: #num:0 Start\n2014-09-01 15:06:54 test-watch INFO -- bash Check API Login: Normal End\n2014-09-01 15:06:54 test-watch INFO -- bash Check DB Create: #num:0 Start\n2014-09-01 15:06:55 test-watch INFO -- bash Check DB Create: Normal End\n2014-09-01 15:06:55 test-watch INFO -- bash Check Table Create: #num:0 Start\n2014-09-01 15:06:57 test-watch INFO -- bash Check Table Create: Normal End\n2014-09-01 15:06:57 test-watch INFO -- bash Check Data Import: #num:0 Start\n2014-09-01 15:08:28 test-watch INFO -- bash Check Data Import: Normal End\n2014-09-01 15:08:28 test-watch INFO -- bash Check Exec Query: #num:0 Start\n2014-09-01 15:08:35 test-watch INFO -- bash Check Exec Query: Normal End\n2014-09-01 15:08:35 test-watch INFO -- bash Check Table Delete: #num:0 Start\n2014-09-01 15:08:36 test-watch INFO -- bash Check Table Delete: Normal End\n2014-09-01 15:08:36 test-watch INFO -- bash Check Database Delete: #num:0 Start\n2014-09-01 15:08:36 test-watch INFO -- bash Check Database Delete: Normal End\n2014-09-01 15:08:36 test-watch INFO -- bash Check TEST API: Normal End\n\n\n\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306f\u4ee5\u4e0b\u3002\n\nformat\n\u65e5\u4ed8 \u30ed\u30b0\u540d \u30ed\u30b0\u30ec\u30d9\u30eb \u6a5f\u80fd \u30e1\u30c3\u30bb\u30fc\u30b8 \n\n\n\u6a5f\u80fd\u306b\u3064\u3044\u3066\u306f\u4eca\u306f\u4f7f\u3063\u3066\u3044\u306a\u3044\u306e\u3067subete\u300c--\u300d\u306b\u3057\u3066\u3044\u308b\u3002\n\nFluentd\u306e\u8a2d\u5b9a\nTreasureData\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u898b\u308b\u3068\u3001JSON\u5f62\u5f0f\u306b\u4e00\u5ea6\u5909\u63db\u3057\u3066\u304b\u3089fluentd\u306b\u6e21\u3057\u3066\u3044\u308b\u3088\u3046\u3002\nfluentd\u95a2\u9023\u306e\u4ed6\u306e\u30b5\u30a4\u30c8\u3092\u898b\u308b\u3068fluentd\u306e\u8a2d\u5b9a\u3060\u3051\u3067\u30a4\u30f3\u30dd\u30fc\u30c8\u3067\u304d\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u3001td-agent.conf\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3002\n\n/etc/td-agent/td-agent.conf\n<match td.*.*>\n  type tdlog\n  apikey ${MY_API_KEY}\n  endpoint ${END_POINT}\n  auto_create_table\n  buffer_type file\n  buffer_path /var/log/td-agent/buffer/td\n  flush_interval 10s\n  use_ssl true\n</match>\n\n<source>\n  type tail\n  path /opt/td-log-test/app/log/test-watch.log\n  pos_file /var/log/td-agent/test-watch.pos\n  tag td.test.test-watch\n  format /^(?<time>\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}) (?<system>[^ ]*) (?<log_level>[^ ]*) (?<function>[^ ]*) (?<check_kind>[^ ]*) (?<message>.*)$/\n  time_format %Y-%m-%d %H:%M:%S\n</source>\n\n\ntag\u306b\u30ed\u30b0\u3092\u4fdd\u5b58\u3059\u308bTreasureData\u306eDB.Table\u3092\u6307\u5b9a\u3059\u308b\u3002path\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30ed\u30b0\u3092\u6307\u5b9a\u3057\u3066\u3001format\u306b\u30ed\u30b0\u306e\u6b63\u898f\u8868\u73fe\u3092\u66f8\u304f\u3002\ntime_format\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001TreasureData\u3067\u306e\u6642\u9593\u306e\u8868\u793a\u306e\u65b9\u6cd5\u3092\u6307\u5b9a\u3059\u308b\u3002\n\nTreasureData\u306e\u8a2d\u5b9a\n\u30ed\u30b0\u3092\u4fdd\u5b58\u3059\u308bDB\u3092\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u4f5c\u6210\u3057\u3066\u304a\u304f\u3002\n\ntd_db_create\n$ td db:create test\n\n\n\n\u52d5\u304b\u3057\u3066\u307f\u308b\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067fluentd\u3092\u518d\u8d77\u52d5\u3059\u308b\u3002\n\nrestart_fluentd\n$ sudo service td-agent restart\n\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5b9f\u884c\u3002\n\u4eca\u306e\u5834\u5408\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u884c\u3002\n\nstart_app\n$ /opt/td-log-test/app/script/check_test.sh\n$\n\n\n\n\u78ba\u8a8d\n\u30b9\u30af\u30ea\u30d7\u30c8\u7d42\u4e86\u5f8c\u3001\u30c7\u30fc\u30bf\u304c\u5165\u3063\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3002\n$ td db:show test\n+------------+------+-------+-------------------------------------------------------------------------------------+\n| Table      | Type | Count | Schema                                                                              |\n+------------+------+-------+-------------------------------------------------------------------------------------+\n| test_watch | log  | 28    | message:string, check_kind:string, system:string, log_level:string, function:string |\n+------------+------+-------+-------------------------------------------------------------------------------------+\n1 row in set\n$ \n$ td query -w -t hive -d test \"SELECT * FROM test_watch\"\n....\n+--------------------------------------------+------------+------------+-----------+----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------+------------+\n| message                                    | check_kind | system     | log_level | function | v                                                                                                                                                         | time       |\n+--------------------------------------------+------------+------------+-----------+----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------+------------+\n| Check TEST API: Start                      | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"bash\",\"message\":\"Check TEST API: Start\"}                      | 1409553566 |\n| Check TEST GET STATUS PAGE: #num:0 Start   | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"bash\",\"message\":\"Check TEST GET STATUS PAGE: #num:0 Start\"}   | 1409553566 |\n| Check TEST GET STATUS PAGE: Normal End     | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"bash\",\"message\":\"Check TEST GET STATUS PAGE: Normal End\"}     | 1409553566 |\n| Check TEST Web Console login: #num:0 Start | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"bash\",\"message\":\"Check TEST Web Console login: #num:0 Start\"} | 1409553566 |\n| Start                                      | ruby       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"ruby\",\"message\":\"Start\"}                                      | 1409553566 |\n| HTTP Get Request Start test-server:80      | ruby       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"ruby\",\"message\":\"HTTP Get Request Start test-server:80\"}      | 1409553566 |\n| HTTP Get Request End test-server:80        | ruby       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"ruby\",\"message\":\"HTTP Get Request End test-server:80\"}        | 1409553566 |\n| HTTP Get Response 200 OK                   | ruby       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"ruby\",\"message\":\"HTTP Get Response 200 OK\"}                   | 1409553566 |\n| HTTP POST Request Start test-server:80     | ruby       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"ruby\",\"message\":\"HTTP POST Request Start test-server:80\"}     | 1409553566 |\n| HTTP POST Request End test-server:80       | ruby       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"ruby\",\"message\":\"HTTP POST Request End test-server:80\"}       | 1409553566 |\n| HTTP POST Response 302 Found               | ruby       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"ruby\",\"message\":\"HTTP POST Response 302 Found\"}               | 1409553566 |\n| Normal End                                 | ruby       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"ruby\",\"message\":\"Normal End\"}                                 | 1409553566 |\n| Check TEST Web Console login: Normal End   | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"bash\",\"message\":\"Check TEST Web Console login: Normal End\"}   | 1409553566 |\n| Check API Login: #num:0 Start              | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"bash\",\"message\":\"Check API Login: #num:0 Start\"}              | 1409553566 |\n| Check API Login: Normal End                | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553567\",\"check_kind\":\"bash\",\"message\":\"Check API Login: Normal End\"}                | 1409553567 |\n| Check DB Create: #num:0 Start              | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553567\",\"check_kind\":\"bash\",\"message\":\"Check DB Create: #num:0 Start\"}              | 1409553567 |\n| Check DB Create: Normal End                | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553568\",\"check_kind\":\"bash\",\"message\":\"Check DB Create: Normal End\"}                | 1409553568 |\n| Check Table Create: #num:0 Start           | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553568\",\"check_kind\":\"bash\",\"message\":\"Check Table Create: #num:0 Start\"}           | 1409553568 |\n| Check Table Create: Normal End             | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553569\",\"check_kind\":\"bash\",\"message\":\"Check Table Create: Normal End\"}             | 1409553569 |\n| Check Data Import: #num:0 Start            | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553569\",\"check_kind\":\"bash\",\"message\":\"Check Data Import: #num:0 Start\"}            | 1409553569 |\n| Check Exec Query: Normal End               | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"check_kind\":\"bash\",\"time\":\"1409553665\",\"system\":\"test-watch\",\"message\":\"Check Exec Query: Normal End\"}               | 1409553665 |\n| Check Table Delete: #num:0 Start           | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"check_kind\":\"bash\",\"time\":\"1409553665\",\"system\":\"test-watch\",\"message\":\"Check Table Delete: #num:0 Start\"}           | 1409553665 |\n| Check Table Delete: Normal End             | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"check_kind\":\"bash\",\"time\":\"1409553666\",\"system\":\"test-watch\",\"message\":\"Check Table Delete: Normal End\"}             | 1409553666 |\n| Check Database Delete: #num:0 Start        | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"check_kind\":\"bash\",\"time\":\"1409553666\",\"system\":\"test-watch\",\"message\":\"Check Database Delete: #num:0 Start\"}        | 1409553666 |\n| Check Database Delete: Normal End          | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"check_kind\":\"bash\",\"time\":\"1409553667\",\"system\":\"test-watch\",\"message\":\"Check Database Delete: Normal End\"}          | 1409553667 |\n| Check TEST API: Normal End                 | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"check_kind\":\"bash\",\"time\":\"1409553667\",\"system\":\"test-watch\",\"message\":\"Check TEST API: Normal End\"}                 | 1409553667 |\n| Check Data Import: Normal End              | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"check_kind\":\"bash\",\"time\":\"1409553659\",\"system\":\"test-watch\",\"message\":\"Check Data Import: Normal End\"}              | 1409553659 |\n| Check Exec Query: #num:0 Start             | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"check_kind\":\"bash\",\"time\":\"1409553659\",\"system\":\"test-watch\",\"message\":\"Check Exec Query: #num:0 Start\"}             | 1409553659 |\n+--------------------------------------------+------------+------------+-----------+----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------+------------+\n$\n\ntest_watch table\u304c\u4f5c\u6210\u3055\u308c\u3001\u3061\u3083\u3093\u3068\u30c7\u30fc\u30bf\u304c\u5165\u3063\u3066\u308b\u3063\u307d\u3044\u3002\n\u304a\u3057\u307e\u3044\u3002\n\n## \u80cc\u666f\n\u72ec\u81ea\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u30ed\u30b0\u3092\u30ed\u30fc\u30ab\u30eb\u306b\u6b8b\u3057\u3064\u3064\u3001`TreasureData`\u306b\u5165\u308c\u3066\u307f\u305f\u3044\u306a\u3068\u601d\u3044\u8abf\u3079\u3066\u307f\u305f\u3002\n\n\u30b5\u30fc\u30d3\u30b9\u306e\u5229\u7528\u65b9\u6cd5\u3084`fluentd(td-agent)`\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5\u306f\u4ee5\u4e0b\u306b\u8a18\u8f09\u6e08\u307f\u3002\n\n* [TreasureData\u4f7f\u3063\u3066\u307f\u305f](http://qiita.com/akito1986/items/4c83ff492ed4b390ad50 \"TreasureData\u4f7f\u3063\u3066\u307f\u305f\")\n* [nginx + fluentd + TreasureData](http://qiita.com/akito1986/items/a3d77f731f8fb4067c8c \"nginx + fluentd + TreasureData\")\n\n\n\u4ee5\u4e0b\u74b0\u5883\u60c5\u5831\u3002\n\n* ubuntu: 12.04\n* td-agent: 0.10.50\n\n## \u30ed\u30b0\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\n\n\u4ee5\u4e0b`TreasureData`\u306b\u5165\u308c\u305f\u3044\u30ed\u30b0\u3002\n\n```log:log\n2014-09-01 15:06:53 test-watch INFO -- bash Check TEST API: Start\n2014-09-01 15:06:54 test-watch INFO -- bash Check TEST GET STATUS PAGE: #num:0 Start\n2014-09-01 15:06:54 test-watch INFO -- bash Check TEST GET STATUS PAGE: Normal End\n2014-09-01 15:06:54 test-watch INFO -- bash Check TEST Web Console login: #num:0 Start\n2014-09-01 15:06:54 test-watch INFO -- ruby Start\n2014-09-01 15:06:54 test-watch INFO -- ruby HTTP Get Request Start test-server:80\n2014-09-01 15:06:54 test-watch INFO -- ruby HTTP Get Request End test-server:80\n2014-09-01 15:06:54 test-watch INFO -- ruby HTTP Get Response 200 OK\n2014-09-01 15:06:54 test-watch INFO -- ruby HTTP POST Request Start test-server:80\n2014-09-01 15:06:54 test-watch INFO -- ruby HTTP POST Request End test-server:80\n2014-09-01 15:06:54 test-watch INFO -- ruby HTTP POST Response 302 Found\n2014-09-01 15:06:54 test-watch INFO -- ruby Normal End\n2014-09-01 15:06:54 test-watch INFO -- bash Check TEST Web Console login: Normal End\n2014-09-01 15:06:54 test-watch INFO -- bash Check API Login: #num:0 Start\n2014-09-01 15:06:54 test-watch INFO -- bash Check API Login: Normal End\n2014-09-01 15:06:54 test-watch INFO -- bash Check DB Create: #num:0 Start\n2014-09-01 15:06:55 test-watch INFO -- bash Check DB Create: Normal End\n2014-09-01 15:06:55 test-watch INFO -- bash Check Table Create: #num:0 Start\n2014-09-01 15:06:57 test-watch INFO -- bash Check Table Create: Normal End\n2014-09-01 15:06:57 test-watch INFO -- bash Check Data Import: #num:0 Start\n2014-09-01 15:08:28 test-watch INFO -- bash Check Data Import: Normal End\n2014-09-01 15:08:28 test-watch INFO -- bash Check Exec Query: #num:0 Start\n2014-09-01 15:08:35 test-watch INFO -- bash Check Exec Query: Normal End\n2014-09-01 15:08:35 test-watch INFO -- bash Check Table Delete: #num:0 Start\n2014-09-01 15:08:36 test-watch INFO -- bash Check Table Delete: Normal End\n2014-09-01 15:08:36 test-watch INFO -- bash Check Database Delete: #num:0 Start\n2014-09-01 15:08:36 test-watch INFO -- bash Check Database Delete: Normal End\n2014-09-01 15:08:36 test-watch INFO -- bash Check TEST API: Normal End\n```\n\n\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306f\u4ee5\u4e0b\u3002\n\n```log:format\n\u65e5\u4ed8 \u30ed\u30b0\u540d \u30ed\u30b0\u30ec\u30d9\u30eb \u6a5f\u80fd \u30e1\u30c3\u30bb\u30fc\u30b8 \n```\n\n`\u6a5f\u80fd`\u306b\u3064\u3044\u3066\u306f\u4eca\u306f\u4f7f\u3063\u3066\u3044\u306a\u3044\u306e\u3067subete\u300c--\u300d\u306b\u3057\u3066\u3044\u308b\u3002\n\n## Fluentd\u306e\u8a2d\u5b9a\n[TreasureData\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](http://docs.treasuredata.com/articles/td-agent-tail-custom \"Tailing Custom-Formatted Log\")\u3092\u898b\u308b\u3068\u3001JSON\u5f62\u5f0f\u306b\u4e00\u5ea6\u5909\u63db\u3057\u3066\u304b\u3089`fluentd`\u306b\u6e21\u3057\u3066\u3044\u308b\u3088\u3046\u3002\n\n`fluentd`\u95a2\u9023\u306e\u4ed6\u306e\u30b5\u30a4\u30c8\u3092\u898b\u308b\u3068`fluentd`\u306e\u8a2d\u5b9a\u3060\u3051\u3067\u30a4\u30f3\u30dd\u30fc\u30c8\u3067\u304d\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u3001`td-agent.conf`\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3002\n\n```file:/etc/td-agent/td-agent.conf\n<match td.*.*>\n  type tdlog\n  apikey ${MY_API_KEY}\n  endpoint ${END_POINT}\n  auto_create_table\n  buffer_type file\n  buffer_path /var/log/td-agent/buffer/td\n  flush_interval 10s\n  use_ssl true\n</match>\n\n<source>\n  type tail\n  path /opt/td-log-test/app/log/test-watch.log\n  pos_file /var/log/td-agent/test-watch.pos\n  tag td.test.test-watch\n  format /^(?<time>\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}) (?<system>[^ ]*) (?<log_level>[^ ]*) (?<function>[^ ]*) (?<check_kind>[^ ]*) (?<message>.*)$/\n  time_format %Y-%m-%d %H:%M:%S\n</source>\n```\n\n`tag`\u306b\u30ed\u30b0\u3092\u4fdd\u5b58\u3059\u308b`TreasureData`\u306e`DB.Table`\u3092\u6307\u5b9a\u3059\u308b\u3002`path`\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30ed\u30b0\u3092\u6307\u5b9a\u3057\u3066\u3001`format`\u306b\u30ed\u30b0\u306e\u6b63\u898f\u8868\u73fe\u3092\u66f8\u304f\u3002\n`time_format`\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001`TreasureData`\u3067\u306e\u6642\u9593\u306e\u8868\u793a\u306e\u65b9\u6cd5\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n## TreasureData\u306e\u8a2d\u5b9a\n\u30ed\u30b0\u3092\u4fdd\u5b58\u3059\u308bDB\u3092\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u4f5c\u6210\u3057\u3066\u304a\u304f\u3002\n\n```cmd:td_db_create\n$ td db:create test\n```\n\n## \u52d5\u304b\u3057\u3066\u307f\u308b\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067`fluentd`\u3092\u518d\u8d77\u52d5\u3059\u308b\u3002\n\n```cmd:restart_fluentd\n$ sudo service td-agent restart\n```\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5b9f\u884c\u3002\n\u4eca\u306e\u5834\u5408\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u884c\u3002\n\n```cmd:start_app\n$ /opt/td-log-test/app/script/check_test.sh\n$\n```\n\n## \u78ba\u8a8d\n\u30b9\u30af\u30ea\u30d7\u30c8\u7d42\u4e86\u5f8c\u3001\u30c7\u30fc\u30bf\u304c\u5165\u3063\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3002\n\n```\n$ td db:show test\n+------------+------+-------+-------------------------------------------------------------------------------------+\n| Table      | Type | Count | Schema                                                                              |\n+------------+------+-------+-------------------------------------------------------------------------------------+\n| test_watch | log  | 28    | message:string, check_kind:string, system:string, log_level:string, function:string |\n+------------+------+-------+-------------------------------------------------------------------------------------+\n1 row in set\n$ \n$ td query -w -t hive -d test \"SELECT * FROM test_watch\"\n....\n+--------------------------------------------+------------+------------+-----------+----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------+------------+\n| message                                    | check_kind | system     | log_level | function | v                                                                                                                                                         | time       |\n+--------------------------------------------+------------+------------+-----------+----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------+------------+\n| Check TEST API: Start                      | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"bash\",\"message\":\"Check TEST API: Start\"}                      | 1409553566 |\n| Check TEST GET STATUS PAGE: #num:0 Start   | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"bash\",\"message\":\"Check TEST GET STATUS PAGE: #num:0 Start\"}   | 1409553566 |\n| Check TEST GET STATUS PAGE: Normal End     | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"bash\",\"message\":\"Check TEST GET STATUS PAGE: Normal End\"}     | 1409553566 |\n| Check TEST Web Console login: #num:0 Start | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"bash\",\"message\":\"Check TEST Web Console login: #num:0 Start\"} | 1409553566 |\n| Start                                      | ruby       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"ruby\",\"message\":\"Start\"}                                      | 1409553566 |\n| HTTP Get Request Start test-server:80      | ruby       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"ruby\",\"message\":\"HTTP Get Request Start test-server:80\"}      | 1409553566 |\n| HTTP Get Request End test-server:80        | ruby       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"ruby\",\"message\":\"HTTP Get Request End test-server:80\"}        | 1409553566 |\n| HTTP Get Response 200 OK                   | ruby       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"ruby\",\"message\":\"HTTP Get Response 200 OK\"}                   | 1409553566 |\n| HTTP POST Request Start test-server:80     | ruby       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"ruby\",\"message\":\"HTTP POST Request Start test-server:80\"}     | 1409553566 |\n| HTTP POST Request End test-server:80       | ruby       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"ruby\",\"message\":\"HTTP POST Request End test-server:80\"}       | 1409553566 |\n| HTTP POST Response 302 Found               | ruby       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"ruby\",\"message\":\"HTTP POST Response 302 Found\"}               | 1409553566 |\n| Normal End                                 | ruby       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"ruby\",\"message\":\"Normal End\"}                                 | 1409553566 |\n| Check TEST Web Console login: Normal End   | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"bash\",\"message\":\"Check TEST Web Console login: Normal End\"}   | 1409553566 |\n| Check API Login: #num:0 Start              | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553566\",\"check_kind\":\"bash\",\"message\":\"Check API Login: #num:0 Start\"}              | 1409553566 |\n| Check API Login: Normal End                | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553567\",\"check_kind\":\"bash\",\"message\":\"Check API Login: Normal End\"}                | 1409553567 |\n| Check DB Create: #num:0 Start              | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553567\",\"check_kind\":\"bash\",\"message\":\"Check DB Create: #num:0 Start\"}              | 1409553567 |\n| Check DB Create: Normal End                | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553568\",\"check_kind\":\"bash\",\"message\":\"Check DB Create: Normal End\"}                | 1409553568 |\n| Check Table Create: #num:0 Start           | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553568\",\"check_kind\":\"bash\",\"message\":\"Check Table Create: #num:0 Start\"}           | 1409553568 |\n| Check Table Create: Normal End             | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553569\",\"check_kind\":\"bash\",\"message\":\"Check Table Create: Normal End\"}             | 1409553569 |\n| Check Data Import: #num:0 Start            | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"system\":\"test-watch\",\"time\":\"1409553569\",\"check_kind\":\"bash\",\"message\":\"Check Data Import: #num:0 Start\"}            | 1409553569 |\n| Check Exec Query: Normal End               | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"check_kind\":\"bash\",\"time\":\"1409553665\",\"system\":\"test-watch\",\"message\":\"Check Exec Query: Normal End\"}               | 1409553665 |\n| Check Table Delete: #num:0 Start           | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"check_kind\":\"bash\",\"time\":\"1409553665\",\"system\":\"test-watch\",\"message\":\"Check Table Delete: #num:0 Start\"}           | 1409553665 |\n| Check Table Delete: Normal End             | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"check_kind\":\"bash\",\"time\":\"1409553666\",\"system\":\"test-watch\",\"message\":\"Check Table Delete: Normal End\"}             | 1409553666 |\n| Check Database Delete: #num:0 Start        | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"check_kind\":\"bash\",\"time\":\"1409553666\",\"system\":\"test-watch\",\"message\":\"Check Database Delete: #num:0 Start\"}        | 1409553666 |\n| Check Database Delete: Normal End          | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"check_kind\":\"bash\",\"time\":\"1409553667\",\"system\":\"test-watch\",\"message\":\"Check Database Delete: Normal End\"}          | 1409553667 |\n| Check TEST API: Normal End                 | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"check_kind\":\"bash\",\"time\":\"1409553667\",\"system\":\"test-watch\",\"message\":\"Check TEST API: Normal End\"}                 | 1409553667 |\n| Check Data Import: Normal End              | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"check_kind\":\"bash\",\"time\":\"1409553659\",\"system\":\"test-watch\",\"message\":\"Check Data Import: Normal End\"}              | 1409553659 |\n| Check Exec Query: #num:0 Start             | bash       | test-watch | INFO      | --       | {\"function\":\"--\",\"log_level\":\"INFO\",\"check_kind\":\"bash\",\"time\":\"1409553659\",\"system\":\"test-watch\",\"message\":\"Check Exec Query: #num:0 Start\"}             | 1409553659 |\n+--------------------------------------------+------------+------------+-----------+----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------+------------+\n$\n```\n`test_watch table`\u304c\u4f5c\u6210\u3055\u308c\u3001\u3061\u3083\u3093\u3068\u30c7\u30fc\u30bf\u304c\u5165\u3063\u3066\u308b\u3063\u307d\u3044\u3002\n\n\u304a\u3057\u307e\u3044\u3002\n", "tags": ["fluentd", "log", "TreasureData"]}