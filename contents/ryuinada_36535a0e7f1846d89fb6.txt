{"context": "ZFS\u306e\u30d7\u30fc\u30eb\u3092\u4f7f\u3063\u3066\u3044\u308b\u3068\u3001\u4f5c\u3063\u305f\u3042\u3068\u306bHDD\u304c\u58ca\u308c\u305f\u308a\u3001\u5bb9\u91cf\u3092\u5897\u52a0\u3057\u305f\u304f\u306a\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u306e\u6642\u306b\u3001\u614c\u3066\u306a\u3044\u3088\u3046\u306b\u4e8b\u524d\u306b\u8abf\u67fb\u3068\u6f14\u7fd2\u3092\u3057\u305f\u306e\u3067\u305d\u306e\u5099\u5fd8\u9332\u7684\u306a\u3082\u306e\u3092\u307e\u3068\u3081\u3066\u307f\u307e\u3057\u305f\u3002\n\u5bb9\u91cf\u306e\u62e1\u5f35\u306f\u3001ZFS\u3067\u30df\u30e9\u30fc(RAID0)\u306b\u3084\u3063\u305f\u3053\u3068\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001RAIDZ\u306f\u521d\u3081\u3066\u3067\u3059\u3002\n\u666e\u901a\u306eRAID\u3067\u3060\u3068\u5225\u306eRAID\u30bb\u30c3\u30c8\u3092\u4f5c\u308a\u30b3\u30d4\u30fc\u3059\u308b\u3068\u304b\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\nZFS\u3060\u3068\u3001\u7121\u505c\u6b62\u3067\u62e1\u5f35\u3067\u304d\u308b\u306e\u3067\u306f\u306a\u3044\u304b\u3068\u601d\u3044\u30d6\u30fc\u30c8\u30dc\u30ea\u30e5\u30fc\u30e0\u3067\u3067\u304d\u306a\u3044\u304b\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\u5b9f\u884c\u74b0\u5883\u306fXenServer\u4e0a\u3067FreeBSD 10.3\u3067\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u6e96\u5099\n\nFreeBSD 10.3\u3092\u7528\u610f\u3059\u308b\u3002\nBoot Volume\u7528\u3068\u3057\u30668G\u30d0\u30a4\u30c8\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u30923\u500b\u7528\u610f\u3059\u308b\nFreeBSD 10.3\u306e\u30a4\u30f3\u30b9\u30c8\u30e9\u30fc\u3067\u81ea\u52d5\u3067RAIDZ\u3067ZFS\u3092\u4f5c\u308b\n\n\u30d6\u30fc\u30c8\u30dc\u30ea\u30e5\u30fc\u30e0zroot\u304c/dev/ada[012]\u3067\u51fa\u6765\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002\n/dev/ada[012]\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u60c5\u5831\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u5168\u90e8\u540c\u3058\u3067\u3059\u3002\n# gpart show ada0\n=>      34  16777149  ada0  GPT  (8.0G)\n        34         6        - free -  (3.0K)\n        40      1024     1  freebsd-boot  (512K)\n      1064       984        - free -  (492K)\n      2048   4194304     2  freebsd-swap  (2.0G)\n   4196352  12578816     3  freebsd-zfs  (6.0G)\n  16775168      2015        - free -  (1.0M)\n\nzroot\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n# zpool list\nNAME    SIZE  ALLOC   FREE  EXPANDSZ   FRAG    CAP  DEDUP  HEALTH  ALTROOT\nzroot  17.9G  2.47G  15.4G         -     6%    13%  1.00x  ONLINE  -\n\n# zpool status zroot\n  pool: zroot\n state: ONLINE\n  scan: none requested\nconfig:\n\n    NAME        STATE     READ WRITE CKSUM\n    zroot       ONLINE       0     0     0\n      raidz1-0  ONLINE       0     0     0\n        ada0p3  ONLINE       0     0     0\n        ada1p3  ONLINE       0     0     0\n        ada2p3  ONLINE       0     0     0\n\nerrors: No known data errors\n\n# zfs list zroot\nNAME    USED  AVAIL  REFER  MOUNTPOINT\nzroot  1.64G  9.89G   128K  /zroot\nryu@ryu-03[11:55am][~:22] zfs list\nNAME                     USED  AVAIL  REFER  MOUNTPOINT\nzroot                   1.64G  9.89G   128K  /zroot\nzroot/ROOT               852M  9.89G   128K  none\nzroot/ROOT/default       851M  9.89G   749M  /\nzroot/tmp                128K  9.89G   128K  /tmp\nzroot/usr                828M  9.89G   128K  /usr\nzroot/usr/home           192K  9.89G   192K  /usr/home\nzroot/usr/ports          827M  9.89G   827M  /usr/ports\nzroot/usr/src            128K  9.89G   128K  /usr/src\nzroot/var                858K  9.89G   128K  /var\nzroot/var/audit          128K  9.89G   128K  /var/audit\nzroot/var/crash          128K  9.89G   128K  /var/crash\nzroot/var/log            218K  9.89G   218K  /var/log\nzroot/var/mail           128K  9.89G   128K  /var/mail\nzroot/var/tmp            128K  9.89G   128K  /var/tmp\n\n\n\u307e\u305f\u3001\u3053\u306e\u969b\u306bzoot\u306e\u30d7\u30ed\u30d1\u30c6\u30a3(autoexpand)\u3092on\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n# zpool set autoexpand=on zroot\n\n# zpool get autoexpand zroot\nNAME   PROPERTY    VALUE   SOURCE\nzroot  autoexpand  on      local\n\n\n\u969c\u5bb3\u3092\u8d77\u3053\u3057\u3066\u307f\u308b\nFreeBSD\u3092\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u3057\u3001XenServer\u5074\u3067\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u30921\u3064\u306f\u305a\u3057\u307e\u3059\u3002\u3053\u308c\u30673\u672c\u3067\u4f5c\u3063\u305fRAIDZ\u304c\u30011\u672c\u58ca\u308c\u305f\u72b6\u614b\u306b\u306a\u308a\u307e\u3059\u3002\n\u305d\u306e\u5f8c\u3001\u30d6\u30fc\u30c8\u3057\u307e\u3059\u3002\n\n\u969c\u5bb3\u306e\u78ba\u8a8d\nzpool\u3067\u72b6\u6cc1\u3092\u78ba\u8a8d\u3059\u308b\u3068DEGRADED\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u307e\u305f\u3001\u5916\u3057\u305f\u30b9\u30c8\u30ec\u30fc\u30b8\u306f\u5143\u306fada1\u306e/dev/apa1p3\u3067\u3042\u3063\u305f\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n# zpool status\n  pool: zroot\n state: DEGRADED\nstatus: One or more devices could not be opened.  Sufficient replicas exist for\n    the pool to continue functioning in a degraded state.\naction: Attach the missing device and online it using 'zpool online'.\n   see: http://illumos.org/msg/ZFS-8000-2Q\n  scan: scrub repaired 0 in 0h0m with 0 errors on Fri Sep 30 12:13:25 2016\nconfig:\n\n    NAME                      STATE     READ WRITE CKSUM\n    zroot                     DEGRADED     0     0     0\n      raidz1-0                DEGRADED     0     0     0\n        ada0p3                ONLINE       0     0     0\n        12024642747408500701  UNAVAIL      0     0     0  was /dev/ada1p3\n        ada2p3                ONLINE       0     0     0\n\nerrors: No known data errors\n\n\n\u4fee\u5fa9\n\u65b0\u3057\u304f12G\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u7528\u610f\u3057\u3001\u30a2\u30bf\u30c3\u30c1\u3057\u76f4\u3057\u307e\u3059\u3002Xen Tools\u304c\u5165\u3063\u3066\u3044\u308c\u3070\u30ea\u30d6\u30fc\u30c8\u306a\u3057\u3067\u8a8d\u8b58\u3057\u307e\u3059\u3002\nxbd2: 12288MB  at device/vbd/832 on xenbusb_front0\nxbd2: attaching as ada1\nxbd2: features: write_barrier\nxbd2: synchronize cache commands enabled.\n\nada1\u3068\u3057\u3066\u8a8d\u8b58\u3057\u305f\u3088\u3046\u3067\u3059\u3002\n\nGPID\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\nGPID\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3068\u3057\u3066/dev/ada1p3\u3092\u4f5c\u6210\u3059\u308b\u306e\u3067\u3059\u304c\u3001\u30d6\u30fc\u30c8\u30dc\u30ea\u30e5\u30fc\u30e0\u306a\u306e\u3067\u30d6\u30fc\u30c8\u30bb\u30af\u30bf\u30fc/\u30d6\u30fc\u30c8\u30ed\u30fc\u30c0\u30fc\u306e\u8fbb\u8904\u3092\u5408\u308f\u305b\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nGPID\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\u306f\u3001gpart\u3067\u884c\u3044\u307e\u3059\u3002\n# gpart create -s gpt ada1\nada1 created\n\n# gpart add -b 40 -s 512k -t freebsd-boot -l gptboot1 ada1\nada1p1 added\n\n# gpart add -b 2048 -s 2g -t freebsd-swap ada1\nada1p2 added\n\n# gpart add -t freebsd-zfs ada1              \nada1p3 added\n\n# gpart show ada1\n=>      34  25165757  ada1  GPT  (12G)\n        34         6        - free -  (3.0K)\n        40      1024     1  freebsd-boot  (512K)\n      1064       984        - free -  (492K)\n      2048   4194304     2  freebsd-swap  (2.0G)\n   4196352  20969439     3  freebsd-zfs  (10G)\n\n\n\u7269\u7406\u7684\u306aHDD\u3092\u8003\u3048\u3066\u308b\u3088\u3046\u3067\u30014K\u30a2\u30e9\u30a4\u30e1\u30f3\u30c8\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u8ad6\u7406\u7684\u306a\u30b9\u30c8\u30ec\u30fc\u30b8\u306a\u306e\u3067\u65b0\u3057\u304f\u8ffd\u52a0\u3059\u308b\u30b9\u30c8\u30ec\u30fc\u30b8\u306f\u3001\u30a2\u30e9\u30a4\u30e1\u30f3\u30c8\u3092\u7121\u8996\u3057\u307e\u3057\u305f\u3002\n# gpart create -s gpt ada1\nada1 created\n\n# gpart add -b 34 -s 512k -t freebsd-boot -l gptboot1 ada1\nada1p1 added\n\n# gpart add -s 2g -t freebsd-swap ada1        \nada1p2 added\n\n# gpart add -t freebsd-zfs ada1                       \nada1p3 added\n\n# gpart show ada1\n=>      34  25165757  ada1  GPT  (12G)\n        34      1024     1  freebsd-boot  (512K)\n      1058   4194304     2  freebsd-swap  (2.0G)\n   4195362  20970429     3  freebsd-zfs  (10G)\n\n\n# gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 ada1\nbootcode written to ada1\n\n\nZFS\u306e\u4fee\u5fa9\nzpool replace \u3067\u58ca\u308c\u305f\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u65b0\u3057\u3044\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u4ea4\u63db\u3057\u307e\u3059\u3002\n# zpool replace zroot /dev/ada1p3 /dev/ada1p3\nMake sure to wait until resilver is done before rebooting.\n\nIf you boot from pool 'zroot', you may need to update\nboot code on newly attached disk '/dev/ada1p3'.\n\nAssuming you use GPT partitioning and 'da0' is your new boot disk\nyou may use the following command:\n\n    gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 da0\n    \n\n\u3046\u307e\u304f\u3044\u3063\u305f\u307f\u305f\u3044\u3067\u3059\u306d\u3002\n# zpool status\n  pool: zroot\n state: DEGRADED\nstatus: One or more devices is currently being resilvered.  The pool will\n    continue to function, possibly in a degraded state.\naction: Wait for the resilver to complete.\n  scan: resilver in progress since Fri Sep 30 17:01:55 2016\n        1.78G scanned out of 2.47G at 39.7M/s, 0h0m to go\n        596M resilvered, 72.29% done\nconfig:\n\n    NAME                        STATE     READ WRITE CKSUM\n    zroot                       DEGRADED     0     0     0\n      raidz1-0                  DEGRADED     0     0     0\n        ada0p3                  ONLINE       0     0     0\n        replacing-1             UNAVAIL      0     0     0\n          12024642747408500701  UNAVAIL      0     0     0  was /dev/ada1p3/old\n          ada1p3                ONLINE       0     0     0  (resilvering)\n        ada2p3                  ONLINE       0     0     0\n\nerrors: No known data errors\n\n\nRAID\u306e\u518d\u69cb\u7bc9\u304c\u59cb\u307e\u3063\u3066\u3044\u307e\u3059\u3002\n\u6ce8\u610f \u3053\u306e\u72b6\u614b\u304c\u7d42\u308f\u308b\u307e\u3067\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u629c\u3044\u305f\u308a\u3057\u3066\u306f\u3044\u3051\u307e\u305b\u3093\u3002\u30c7\u30fc\u30bf\u304c\u58ca\u308c\u307e\u3059\n\u3057\u3070\u3089\u304f\u3059\u308b\u3068\u76f4\u308a\u307e\u3057\u305f\u3002\n# zpool status\n  pool: zroot\n state: ONLINE\n  scan: resilvered 828M in 0h1m with 0 errors on Fri Sep 30 17:03:08 2016\nconfig:\n\n    NAME        STATE     READ WRITE CKSUM\n    zroot       ONLINE       0     0     0\n      raidz1-0  ONLINE       0     0     0\n        ada0p3  ONLINE       0     0     0\n        ada1p3  ONLINE       0     0     0\n        ada2p3  ONLINE       0     0     0\n\nerrors: No known data errors\n\n\n\u3053\u306e\u72b6\u614b\u306b\u306a\u308c\u3070\u30012\u672c\u3082\u9806\u6b21\u300112G\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u5dee\u3057\u66ff\u3048\u3066\u884c\u304d\u307e\u3059\u3002\n\u4eca\u5ea6\u306f\u3001\u4e8c\u672c\u540c\u6642\u306b\u63a5\u7d9a\u3057\u307e\u3057\u305f\u3002\nxbd4: 12288MB  at device/vbd/51776 on xenbusb_front0\nxbd4: features: write_barrier\nxbd4: synchronize cache commands enabled.\nxbd5: 12288MB  at device/vbd/51792 on xenbusb_front0\nxbd5: features: write_barrier\nxbd5: synchronize cache commands enabled.\n\n\u5404\u3005\u3001xbd4/xbd5\u3068\u3057\u3066\u8a8d\u8b58\u3057\u305f\u3088\u3046\u3067\u3059\u3002\n2\u672c\u76ee\u3092\u4ea4\u63db\u3059\u308b\u3068\n# zpool list -v zroot\nNAME                        SIZE  ALLOC   FREE  EXPANDSZ   FRAG    CAP  DEDUP  HEALTH  ALTROOT\nzroot                      17.9G  2.47G  15.4G     12.0G     6%    13%  1.00x  DEGRADED  -\n  raidz1                   17.9G  2.47G  15.4G     12.0G     6%    13%\n    ada2p3                     -      -      -         -      -      -\n    replacing                  -      -      -         -      -      -\n      1209515388400427438      -      -      -         -      -      -\n      ada1p3                   -      -      -         -      -      -\n    ada0p3                     -      -      -         -      -      -\n\n\u3068EXPANDSZ\u306b\u5897\u52a0\u5206\u306e\u5bb9\u91cf\u304c\u51fa\u3066\u304d\u307e\u3057\u305f\u3002\n\u6700\u7d42\u7684\u306b\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306bRAIDZ\u306e\u5bb9\u91cf\u304c\u5897\u3048\u3066\u3044\u307e\u3059\u3002\n# zpool list -v zroot\nNAME         SIZE  ALLOC   FREE  EXPANDSZ   FRAG    CAP  DEDUP  HEALTH  ALTROOT\nzroot       29.9G  2.47G  27.4G         -     3%     8%  1.00x  ONLINE  -\n  raidz1    29.9G  2.47G  27.4G         -     3%     8%\n    ada2p3      -      -      -         -      -      -\n    ada1p3      -      -      -         -      -      -\n    ada0p3      -      -      -         -      -      -\n\n\n\u307e\u3068\u3081\nZFS\u3092\u4f7f\u3046\u3068\u7c21\u5358\u306b\u5bb9\u91cf\u3092\u5897\u3084\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u3067\u3001\u5c0f\u3055\u3081\u306b\u3068\u3063\u3066\u304a\u3044\u3066\u9806\u6b21\u62e1\u5f35\u3082\u4eca\u307e\u3067\u306b\u6bd4\u3079\u3066\u5bb9\u6613\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\nZFS\u306e\u30d7\u30fc\u30eb\u3092\u4f7f\u3063\u3066\u3044\u308b\u3068\u3001\u4f5c\u3063\u305f\u3042\u3068\u306bHDD\u304c\u58ca\u308c\u305f\u308a\u3001\u5bb9\u91cf\u3092\u5897\u52a0\u3057\u305f\u304f\u306a\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u306e\u6642\u306b\u3001\u614c\u3066\u306a\u3044\u3088\u3046\u306b\u4e8b\u524d\u306b\u8abf\u67fb\u3068\u6f14\u7fd2\u3092\u3057\u305f\u306e\u3067\u305d\u306e\u5099\u5fd8\u9332\u7684\u306a\u3082\u306e\u3092\u307e\u3068\u3081\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u5bb9\u91cf\u306e\u62e1\u5f35\u306f\u3001ZFS\u3067\u30df\u30e9\u30fc(RAID0)\u306b\u3084\u3063\u305f\u3053\u3068\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001RAIDZ\u306f\u521d\u3081\u3066\u3067\u3059\u3002\n\u666e\u901a\u306eRAID\u3067\u3060\u3068\u5225\u306eRAID\u30bb\u30c3\u30c8\u3092\u4f5c\u308a\u30b3\u30d4\u30fc\u3059\u308b\u3068\u304b\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\nZFS\u3060\u3068\u3001\u7121\u505c\u6b62\u3067\u62e1\u5f35\u3067\u304d\u308b\u306e\u3067\u306f\u306a\u3044\u304b\u3068\u601d\u3044\u30d6\u30fc\u30c8\u30dc\u30ea\u30e5\u30fc\u30e0\u3067\u3067\u304d\u306a\u3044\u304b\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u5b9f\u884c\u74b0\u5883\u306fXenServer\u4e0a\u3067FreeBSD 10.3\u3067\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n#\u6e96\u5099\n\n1. FreeBSD 10.3\u3092\u7528\u610f\u3059\u308b\u3002\n2. Boot Volume\u7528\u3068\u3057\u30668G\u30d0\u30a4\u30c8\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u30923\u500b\u7528\u610f\u3059\u308b\n3. FreeBSD 10.3\u306e\u30a4\u30f3\u30b9\u30c8\u30e9\u30fc\u3067\u81ea\u52d5\u3067RAIDZ\u3067ZFS\u3092\u4f5c\u308b\n\n\u30d6\u30fc\u30c8\u30dc\u30ea\u30e5\u30fc\u30e0zroot\u304c/dev/ada[012]\u3067\u51fa\u6765\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002\n\n/dev/ada[012]\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u60c5\u5831\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u5168\u90e8\u540c\u3058\u3067\u3059\u3002\n\n<pre>\n# <B>gpart show ada0</B>\n=>      34  16777149  ada0  GPT  (8.0G)\n        34         6        - free -  (3.0K)\n        40      1024     1  freebsd-boot  (512K)\n      1064       984        - free -  (492K)\n      2048   4194304     2  freebsd-swap  (2.0G)\n   4196352  12578816     3  freebsd-zfs  (6.0G)\n  16775168      2015        - free -  (1.0M)\n</pre>\n\nzroot\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n<pre>\n# zpool list\nNAME    SIZE  ALLOC   FREE  EXPANDSZ   FRAG    CAP  DEDUP  HEALTH  ALTROOT\nzroot  17.9G  2.47G  15.4G         -     6%    13%  1.00x  ONLINE  -\n\n# <B>zpool status zroot</B>\n  pool: zroot\n state: ONLINE\n  scan: none requested\nconfig:\n\n\tNAME        STATE     READ WRITE CKSUM\n\tzroot       ONLINE       0     0     0\n\t  raidz1-0  ONLINE       0     0     0\n\t    ada0p3  ONLINE       0     0     0\n\t    ada1p3  ONLINE       0     0     0\n\t    ada2p3  ONLINE       0     0     0\n\nerrors: No known data errors\n</pre>\n\n\n<pre>\n# <B>zfs list zroot</B>\nNAME    USED  AVAIL  REFER  MOUNTPOINT\nzroot  1.64G  9.89G   128K  /zroot\nryu@ryu-03[11:55am][~:22] zfs list\nNAME                     USED  AVAIL  REFER  MOUNTPOINT\nzroot                   1.64G  9.89G   128K  /zroot\nzroot/ROOT               852M  9.89G   128K  none\nzroot/ROOT/default       851M  9.89G   749M  /\nzroot/tmp                128K  9.89G   128K  /tmp\nzroot/usr                828M  9.89G   128K  /usr\nzroot/usr/home           192K  9.89G   192K  /usr/home\nzroot/usr/ports          827M  9.89G   827M  /usr/ports\nzroot/usr/src            128K  9.89G   128K  /usr/src\nzroot/var                858K  9.89G   128K  /var\nzroot/var/audit          128K  9.89G   128K  /var/audit\nzroot/var/crash          128K  9.89G   128K  /var/crash\nzroot/var/log            218K  9.89G   218K  /var/log\nzroot/var/mail           128K  9.89G   128K  /var/mail\nzroot/var/tmp            128K  9.89G   128K  /var/tmp\n\n</pre>\n\n\u307e\u305f\u3001\u3053\u306e\u969b\u306bzoot\u306e\u30d7\u30ed\u30d1\u30c6\u30a3(**autoexpand**)\u3092<b>on</B>\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n<pre>\n# zpool <b>set autoexpand=on</b> zroot\n\n# zpool get autoexpand zroot\nNAME   PROPERTY    VALUE   SOURCE\nzroot  autoexpand  <b>on</B>      local\n</pre>\n\n#\u969c\u5bb3\u3092\u8d77\u3053\u3057\u3066\u307f\u308b\n\nFreeBSD\u3092\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u3057\u3001XenServer\u5074\u3067\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u30921\u3064\u306f\u305a\u3057\u307e\u3059\u3002\u3053\u308c\u30673\u672c\u3067\u4f5c\u3063\u305fRAIDZ\u304c\u30011\u672c\u58ca\u308c\u305f\u72b6\u614b\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u305d\u306e\u5f8c\u3001\u30d6\u30fc\u30c8\u3057\u307e\u3059\u3002\n\n#\u969c\u5bb3\u306e\u78ba\u8a8d\n\nzpool\u3067\u72b6\u6cc1\u3092\u78ba\u8a8d\u3059\u308b\u3068<B>DEGRADED</B>\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u307e\u305f\u3001\u5916\u3057\u305f\u30b9\u30c8\u30ec\u30fc\u30b8\u306f\u5143\u306fada1\u306e/dev/apa1p3\u3067\u3042\u3063\u305f\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n\n<pre>\n# <B>zpool status</B>\n  pool: zroot\n state: <B>DEGRADED</B>\nstatus: One or more devices could not be opened.  Sufficient replicas exist for\n\tthe pool to continue functioning in a degraded state.\naction: Attach the missing device and online it using 'zpool online'.\n   see: http://illumos.org/msg/ZFS-8000-2Q\n  scan: scrub repaired 0 in 0h0m with 0 errors on Fri Sep 30 12:13:25 2016\nconfig:\n\n\tNAME                      STATE     READ WRITE CKSUM\n\tzroot                     DEGRADED     0     0     0\n\t  raidz1-0                DEGRADED     0     0     0\n\t    ada0p3                ONLINE       0     0     0\n\t    <B>12024642747408500701  UNAVAIL      0     0     0  was /dev/ada1p3</B>\n\t    ada2p3                ONLINE       0     0     0\n\nerrors: No known data errors\n</pre>\n\n\n#\u4fee\u5fa9\n\n\u65b0\u3057\u304f12G\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u7528\u610f\u3057\u3001\u30a2\u30bf\u30c3\u30c1\u3057\u76f4\u3057\u307e\u3059\u3002Xen Tools\u304c\u5165\u3063\u3066\u3044\u308c\u3070\u30ea\u30d6\u30fc\u30c8\u306a\u3057\u3067\u8a8d\u8b58\u3057\u307e\u3059\u3002\n\n<pre>\nxbd2: 12288MB <Virtual Block Device> at device/vbd/832 on xenbusb_front0\nxbd2: attaching as <B>ada1</B>\nxbd2: features: write_barrier\nxbd2: synchronize cache commands enabled.\n</pre>\n\nada1\u3068\u3057\u3066\u8a8d\u8b58\u3057\u305f\u3088\u3046\u3067\u3059\u3002\n\n##GPID\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\n\nGPID\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3068\u3057\u3066/dev/ada1p3\u3092\u4f5c\u6210\u3059\u308b\u306e\u3067\u3059\u304c\u3001\u30d6\u30fc\u30c8\u30dc\u30ea\u30e5\u30fc\u30e0\u306a\u306e\u3067\u30d6\u30fc\u30c8\u30bb\u30af\u30bf\u30fc/\u30d6\u30fc\u30c8\u30ed\u30fc\u30c0\u30fc\u306e\u8fbb\u8904\u3092\u5408\u308f\u305b\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nGPID\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\u306f\u3001<B>gpart</B>\u3067\u884c\u3044\u307e\u3059\u3002\n\n<pre>\n# gpart create -s gpt ada1\nada1 created\n\n# gpart add -b 40 -s 512k -t freebsd-boot -l gptboot1 ada1\nada1p1 added\n\n# gpart add -b 2048 -s 2g -t freebsd-swap ada1\nada1p2 added\n\n# gpart add -t freebsd-zfs ada1              \nada1p3 added\n\n# gpart show ada1\n=>      34  25165757  ada1  GPT  (12G)\n        34         6        - free -  (3.0K)\n        40      1024     1  freebsd-boot  (512K)\n      1064       984        - free -  (492K)\n      2048   4194304     2  freebsd-swap  (2.0G)\n   4196352  20969439     3  freebsd-zfs  (10G)\n\n</pre>\n\n\u7269\u7406\u7684\u306aHDD\u3092\u8003\u3048\u3066\u308b\u3088\u3046\u3067\u30014K\u30a2\u30e9\u30a4\u30e1\u30f3\u30c8\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u8ad6\u7406\u7684\u306a\u30b9\u30c8\u30ec\u30fc\u30b8\u306a\u306e\u3067\u65b0\u3057\u304f\u8ffd\u52a0\u3059\u308b\u30b9\u30c8\u30ec\u30fc\u30b8\u306f\u3001\u30a2\u30e9\u30a4\u30e1\u30f3\u30c8\u3092\u7121\u8996\u3057\u307e\u3057\u305f\u3002\n\n<pre>\n# gpart create -s gpt ada1\nada1 created\n\n# gpart add -b 34 -s 512k -t freebsd-boot -l gptboot1 ada1\nada1p1 added\n\n# gpart add -s 2g -t freebsd-swap ada1        \nada1p2 added\n\n# gpart add -t freebsd-zfs ada1                       \nada1p3 added\n\n# gpart show ada1\n=>      34  25165757  ada1  GPT  (12G)\n        34      1024     1  freebsd-boot  (512K)\n      1058   4194304     2  freebsd-swap  (2.0G)\n   4195362  20970429     3  freebsd-zfs  (10G)\n\n</pre>\n\n<pre>\n# gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 ada1\nbootcode written to ada1\n</pre>\n\n#ZFS\u306e\u4fee\u5fa9\n\nzpool replace \u3067\u58ca\u308c\u305f\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u65b0\u3057\u3044\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u4ea4\u63db\u3057\u307e\u3059\u3002\n\n<pre>\n# zpool replace zroot /dev/ada1p3 /dev/ada1p3\nMake sure to wait until resilver is done before rebooting.\n\nIf you boot from pool 'zroot', you may need to update\nboot code on newly attached disk '/dev/ada1p3'.\n\nAssuming you use GPT partitioning and 'da0' is your new boot disk\nyou may use the following command:\n\n\tgpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 da0\n\t\n</pre>\n\n\u3046\u307e\u304f\u3044\u3063\u305f\u307f\u305f\u3044\u3067\u3059\u306d\u3002\n\n<pre>\n# zpool status\n  pool: zroot\n state: <B>DEGRADED</B>\nstatus: One or more devices is currently being resilvered.  The pool will\n\tcontinue to function, possibly in a degraded state.\naction: Wait for the resilver to complete.\n  scan: <B>resilver in progress since Fri Sep 30 17:01:55 2016\n        1.78G scanned out of 2.47G at 39.7M/s, 0h0m to go\n        596M resilvered, 72.29% done</B>\nconfig:\n\n\tNAME                        STATE     READ WRITE CKSUM\n\tzroot                       DEGRADED     0     0     0\n\t  raidz1-0                  DEGRADED     0     0     0\n\t    ada0p3                  ONLINE       0     0     0\n\t    <B>replacing-1             UNAVAIL      0     0     0\n\t      12024642747408500701  UNAVAIL      0     0     0  was /dev/ada1p3/old\n\t      ada1p3                ONLINE       0     0     0  (resilvering)</B>\n\t    ada2p3                  ONLINE       0     0     0\n\nerrors: No known data errors\n\n</pre>\n\nRAID\u306e\u518d\u69cb\u7bc9\u304c\u59cb\u307e\u3063\u3066\u3044\u307e\u3059\u3002\n\n**\u6ce8\u610f \u3053\u306e\u72b6\u614b\u304c\u7d42\u308f\u308b\u307e\u3067\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u629c\u3044\u305f\u308a\u3057\u3066\u306f\u3044\u3051\u307e\u305b\u3093\u3002\u30c7\u30fc\u30bf\u304c\u58ca\u308c\u307e\u3059**\n\n\u3057\u3070\u3089\u304f\u3059\u308b\u3068\u76f4\u308a\u307e\u3057\u305f\u3002\n\n<pre>\n# zpool status\n  pool: zroot\n state: ONLINE\n  scan: <B>resilvered 828M in 0h1m with 0 errors on Fri Sep 30 17:03:08 2016</B>\nconfig:\n\n\tNAME        STATE     READ WRITE CKSUM\n\tzroot       ONLINE       0     0     0\n\t  raidz1-0  ONLINE       0     0     0\n\t    ada0p3  ONLINE       0     0     0\n\t    ada1p3  ONLINE       0     0     0\n\t    ada2p3  ONLINE       0     0     0\n\nerrors: No known data errors\n\n</pre>\n\n\u3053\u306e\u72b6\u614b\u306b\u306a\u308c\u3070\u30012\u672c\u3082\u9806\u6b21\u300112G\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u5dee\u3057\u66ff\u3048\u3066\u884c\u304d\u307e\u3059\u3002\n\n\u4eca\u5ea6\u306f\u3001\u4e8c\u672c\u540c\u6642\u306b\u63a5\u7d9a\u3057\u307e\u3057\u305f\u3002\n\n<pre>\nxbd4: 12288MB <Virtual Block Device> at device/vbd/51776 on xenbusb_front0\nxbd4: features: write_barrier\nxbd4: synchronize cache commands enabled.\nxbd5: 12288MB <Virtual Block Device> at device/vbd/51792 on xenbusb_front0\nxbd5: features: write_barrier\nxbd5: synchronize cache commands enabled.\n</pre>\n\n\u5404\u3005\u3001xbd4/xbd5\u3068\u3057\u3066\u8a8d\u8b58\u3057\u305f\u3088\u3046\u3067\u3059\u3002\n\n2\u672c\u76ee\u3092\u4ea4\u63db\u3059\u308b\u3068\n\n<pre>\n# zpool list -v zroot\nNAME                        SIZE  ALLOC   FREE  <B>EXPANDSZ</B>   FRAG    CAP  DEDUP  HEALTH  ALTROOT\nzroot                      17.9G  2.47G  15.4G     <b>12.0G</b>     6%    13%  1.00x  DEGRADED  -\n  raidz1                   17.9G  2.47G  15.4G     <b>12.0G</b>     6%    13%\n    ada2p3                     -      -      -         -      -      -\n    replacing                  -      -      -         -      -      -\n      1209515388400427438      -      -      -         -      -      -\n      ada1p3                   -      -      -         -      -      -\n    ada0p3                     -      -      -         -      -      -\n</pre>\n\n\u3068EXPANDSZ\u306b\u5897\u52a0\u5206\u306e\u5bb9\u91cf\u304c\u51fa\u3066\u304d\u307e\u3057\u305f\u3002\n\n\u6700\u7d42\u7684\u306b\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306bRAIDZ\u306e\u5bb9\u91cf\u304c\u5897\u3048\u3066\u3044\u307e\u3059\u3002\n\n<PRE>\n# zpool list -v zroot\nNAME         SIZE  ALLOC   FREE  EXPANDSZ   FRAG    CAP  DEDUP  HEALTH  ALTROOT\nzroot       <B>29.9G</B>  2.47G  27.4G         -     3%     8%  1.00x  ONLINE  -\n  raidz1    <B>29.9G</B>  2.47G  27.4G         -     3%     8%\n    ada2p3      -      -      -         -      -      -\n    ada1p3      -      -      -         -      -      -\n    ada0p3      -      -      -         -      -      -\n</PRE>\n\n\n#\u307e\u3068\u3081\n\nZFS\u3092\u4f7f\u3046\u3068\u7c21\u5358\u306b\u5bb9\u91cf\u3092\u5897\u3084\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u3067\u3001\u5c0f\u3055\u3081\u306b\u3068\u3063\u3066\u304a\u3044\u3066\u9806\u6b21\u62e1\u5f35\u3082\u4eca\u307e\u3067\u306b\u6bd4\u3079\u3066\u5bb9\u6613\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n", "tags": ["ZFS", "FreeBSD"]}