{"tags": ["shell", "script", "\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8", "Bash"], "context": "\n\n\u76ee\u7684\n\u30af\u30e9\u30c3\u30ab\u30fc\uff08\u60aa\u610f\u306e\u3042\u308b\u30cf\u30c3\u30ab\u30fc\uff09\u306b\u3088\u308a\u30b5\u30fc\u30d0\u30fc\u306b\u5165\u3089\u308c\u3066rootkit\u3092\u7f6e\u304b\u308c\u305f\u4e8b\u3092\u691c\u77e5\u3059\u308b\u305f\u3081\u306e\nchkrootkit\u3092\u5c0e\u5165\u3057\u3066\u3001\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u308a\u3001cron\u3067\u5b9a\u671f\u7684\u306b\u5b9f\u884c\u3057\u3066\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u3092\u5c11\u3057\u3067\u3082\u9ad8\u3081\u305f\u3044\u3002\n\u304c\u30fb\u30fb\u30fb\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u30fb\u30fb\u30fb\u3060\u3081\u3063\u30fb\u30fb\u30fb\uff01\uff01\n\u30e1\u30fc\u30eb\u306e\u4ef6\u540d\u304c\u6587\u5b57\u5316\u3051\u3059\u308b\u3063\u30fb\u30fb\u30fb\uff01\uff01\n\u95a2\u6570\u3078\u6e21\u3057\u305f\u5f15\u6570\u304c\u3076\u3063\u58ca\u308c\u308b\u3063\u30fb\u30fb\u30fb\uff01\uff01\n\n\u74b0\u5883\n\nCentOS6.5\npostfix\u3001nkf\u5c0e\u5165\u6e08\u307f\nbash\n\n\n\u5fd9\u3057\u3044\u4eba\u5411\u3051\n\u7d50\u679c\u7684\u306b\u3001\u3053\u308c\u3067\u3046\u307e\u304f\u3044\u304d\u307e\u3057\u305f\u3002\nchkrootkit\u4ee5\u5916\u306b\u3082\u8af8\u3005\u30c1\u30a7\u30c3\u30af\u3057\u305f\u3044\u306e\u3067\u3001\n\u305d\u306e\u5834\u5408\u306b\u306f\u90fd\u5ea6\u95a2\u6570\u3092\u8ffd\u52a0\u3057\u3066\u30e1\u30fc\u30eb\u9001\u4fe1\u90e8\u5206\u3060\u3051\u4e0b\u8a18\u306e\u95a2\u6570\u3092\u4f7f\u3044\u307e\u308f\u3059\u30a4\u30e1\u30fc\u30b8\u3002\n\nserver_check.sh\n#!/bin/bash\n\n#--------------------------------\n#\n# \u74b0\u5883\u5909\u6570\n#\n#--------------------------------\n\n# \u5b9f\u884c\u65e5\u6642\nDATE=`date +'%Y/%m/%d %H:%M:%S'`\n\n# \u5b9b\u5148\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\nMAIL_TO=\"ore@mail.com\"\n\n# \u9001\u4fe1\u5143\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\nMAIL_FROM=\"noreply@mail.com\"\n\n\n#--------------------------------\n#\n# \u95a2\u6570\u5b9a\u7fa9\n#\n#--------------------------------\n\n#********************************\n# \u30e1\u30fc\u30eb\u9001\u4fe1\u51e6\u7406\n# @param1($1) : \u30e1\u30fc\u30eb\u306e\u4ef6\u540d\n# @param2($2) : \u5b9f\u884c\u30d7\u30ed\u30b0\u30e9\u30e0\u540d\n# @param3($3) : \u5b9f\u884c\u7d50\u679c\n#********************************\n\nmail_send () {\n\ncat << EOD | nkf -j -m0 | sendmail -t\nFrom: ${MAIL_FROM}\nTo: ${MAIL_TO}\nSubject: ${1}\nMIME-Version: 1.0\nContent-Type: text/plain; charset=\"ISO-2022-JP\"\nContent-Transfer-Encoding: 7bit\n\n\u5b9f\u884c\u65e5\u6642\uff1a${DATE}\n\n\u30fb${2}\n${3}\n\nEOD\n}\n\n\n#********************************\n# chkrootkit\u306e\u5b9f\u884c\n#********************************\nexec_chkrootkit() {\n\n  # chkrootkit\u5b9f\u884c\u30ed\u30b0\n  TMPLOG=`mktemp`\n  chkrootkit > $TMPLOG\n\n  # SMTPS\u306ebindshell\u8aa4\u691c\u77e5\u5bfe\u5fdc\n  if [ ! -z \"$(grep 465 $TMPLOG)\" ] && \\\n     [ -z $(/usr/sbin/lsof -i:465|grep bindshell) ]; then\n       sed -i '/465/d' $TMPLOG\n  fi\n\n  # upstart\u30d1\u30c3\u30b1\u30fc\u30b8\u66f4\u65b0\u6642\u306eSuckit\u8aa4\u691c\u77e5\u5bfe\u5fdc\n  if [ ! -z \"$(grep Suckit $TMPLOG)\" ] && \\\n     [ -z \"$(rpm -V `rpm -qf /sbin/init`)\" ]; then\n       sed -i '/Suckit/d' $TMPLOG\n  fi\n\n  # \u554f\u984c\u304c\u3042\u308b\u5834\u5408\u306b\u306f\u30e1\u30fc\u30eb\u901a\u77e5\n  CHKROOTKIT=`grep INFECTED $TMPLOG`\n  if [ ! -z \"$CHKROOTKIT\" ]; then\n    MAIL_TITLE=`echo -n \"\u3010server_check\u3011chkrootkit\u306b\u554f\u984c\u767a\u751f\" | base64 | tr -d '\\n' | xargs printf '=?UTF-8?B?%s?=\\n'`\n    mail_send \"$MAIL_TITLE\" 'chkrootkit' \"$CHKROOTKIT\"\n  fi\n}\n\n\n#--------------------------------\n#\n# \u51e6\u7406\n#\n#--------------------------------\n\nexec_chkrootkit\n\nexit 0\n\n\n\u203b\u4e0b\u8a18\u306f\u30c6\u30b9\u30c8\u5b9f\u884c\u306e\u305f\u3081\u3001\u300cCHKROOTKIT=`grep INFECTED $TMPLOG`\u300d\u3092\u300cCHKROOTKIT=`grep infected $TMPLOG`\u300d\u306b\u5909\u66f4\u3057\u3066\u5b9f\u884c\u3057\u305f\u7d50\u679c\u3067\u3059\u3002\n\n\u30e1\u30fc\u30eb\u306e\u5185\u5bb9.txt\n\n\u4ef6\u540d\uff1a\u3010server_check\u3011chkrootkit\u306b\u554f\u984c\u767a\u751f\n\u672c\u6587\uff1a\n\u5b9f\u884c\u65e5\u6642\uff1a2017/02/02 23:03:45\n\n\u30fbchkrootkit\nChecking `basename'... not infected\nChecking `chfn'... not infected\nChecking `chsh'... not infected\nChecking `cron'... not infected\nChecking `crontab'... not infected\nChecking `date'... not infected\nChecking `du'... not infected\nChecking `dirname'... not infected\nChecking `echo'... not infected\nChecking `egrep'... not infected\nChecking `env'... not infected\nChecking `find'... not infected\nChecking `grep'... not infected\nChecking `hdparm'... not infected\nChecking `su'... not infected\nChecking `ifconfig'... not infected\nChecking `init'... not infected\nChecking `killall'... not infected\nChecking `ldsopreload'... not infected\nChecking `login'... not infected\nChecking `ls'... not infected\nChecking `lsof'... not infected\nChecking `mail'... not infected\nChecking `mingetty'... not infected\nChecking `netstat'... not infected\nChecking `passwd'... not infected\nChecking `pidof'... not infected\nChecking `ps'... not infected\nChecking `pstree'... not infected\nChecking `slogin'... not infected\nChecking `sendmail'... not infected\nChecking `sshd'... not infected\nChecking `tar'... not infected\nChecking `tcpd'... not infected\nChecking `tcpdump'... not infected\nChecking `top'... not infected\nChecking `traceroute'... not infected\nChecking `vdir'... not infected\nChecking `w'... not infected\nChecking `write'... not infected\nChecking `asp'... not infected\nChecking `bindshell'... not infected\nChecking `w55808'... not infected\nChecking `scalper'... not infected\nChecking `slapper'... not infected\nChecking `OSX_RSPLUG'... not infected\n\n\n\n\n\u554f\u984c1\n\n\u30e1\u30fc\u30eb\u306e\u9001\u4fe1\u4ef6\u540d\u3001\u672c\u6587\u3092\u65e5\u672c\u8a9e\u3067\u9001\u308a\u305f\u3044\u306e\u306b\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u3063\u30fb\u30fb\u30fb\uff01\uff01\n\n\u9001\u4fe1\u4ef6\u540d\u306f\u65e5\u672c\u8a9e\u3060\u3051\u3069\u672c\u6587\u304c\u6587\u5b57\u5316\u3051\u3057\u305f\u308a\u3001\n\u672c\u6587\u306f\u6587\u5b57\u5316\u3051\u3057\u306a\u3044\u3051\u3069\u4ef6\u540d\u306f\u6587\u5b57\u5316\u3051\u3057\u305f\u308a\u3059\u308b\u3063\u30fb\u30fb\u30fb\uff01\uff01\uff08Thunderbird\u3055\u3093\u4f7f\u7528\uff09\n\n\u4f8b\n\u4e0b\u8a18\u3067\u9001\u4fe1\u4ef6\u540d\u304c\u6587\u5b57\u5316\u3051\u3057\u3066\u3057\u307e\u3046\u3063\u30fb\u30fb\u30fb\uff01\uff01\n\n\u53c2\u8003\u30b5\u30a4\u30c8\u3088\u308a\u5f15\u7528.sh\n#!/bin/bash\n\nexport PATH=$PATH:/usr/sbin\n\nMAIL_TO=\"ore@gmail.com\"\nMAIL_FROM=\"noreply@hogehoge.com\"\nSUBJECT=\"\u30e1\u30fc\u30eb\u30c6\u30b9\u30c8\"\nDATA=\"\u30c7\u30fc\u30bf\"\n\nmail_send () {\n\ncat << EOD | nkf -j -m0 | sendmail -t\nFrom: ${MAIL_FROM}\nTo: ${MAIL_TO}\nSubject: ${SUBJECT}\nMIME-Version: 1.0\nContent-Type: text/plain; charset=\"ISO-2022-JP\"\nContent-Transfer-Encoding: 7bit\n\n\n\u30e1\u30fc\u30eb\u304c\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n\u3053\u3053\u306b${DATA}\u304c\u5165\u308b\u3088\u3002\n\nEOD\n}\n\nmail_send\n\nexit 0\n\n\n\n\u89e3\u6c7a\u7b56\n\u30e1\u30fc\u30eb\u306e\u4ef6\u540d\u3092\u8272\u3005\u30d1\u30a4\u30d7\u3067\u3064\u306a\u3052\u308b\nMAIL_TITLE=`echo -n \"\u3010server_check\u3011chkrootkit\u306b\u554f\u984c\u767a\u751f\" | base64 | tr -d '\\n' | xargs printf '=?UTF-8?B?%s?=\\n'`\n\n\u300ctr -d '\\n'\u300d\u2190\u3053\u308c\u304c\u7121\u3044\u3068base64\u5f8c\u306e\u6587\u5b57\u5217\u306b\nXQ==\u3068\u304b\u3044\u3046\u30b4\u30df\u6587\u5b57\u5217\u3068\u305d\u306e\u76f4\u524d\u306e\u6539\u884c\u30b3\u30fc\u30c9\u304c\u8272\u3005\u60aa\u3055\u3092\u3057\u3066\u3057\u307e\u3046\u306e\u3067\u6ce8\u610f\u3002\n\n\u554f\u984c2\n\n\u95a2\u6570\u3078\u306e\u5f15\u6570\u304c\u306a\u3093\u304b\u304a\u304b\u3057\u3044\u3063\u30fb\u30fb\u30fb\uff01\uff01\n\n3\u3064\u306e\u5024\u3092\u6e21\u3057\u305f\u306e\u306b\u5206\u5272\u3055\u308c\u3066\u6e21\u3055\u308c\u3061\u3083\u3063\u3066\u308b\u3063\u307d\u3044\u305e\u3063\u30fb\u30fb\u30fb\uff01\uff01\n\n\u4f8b\n\nserver_check.sh\nmail_send () {\n  echo $1\n  echo $2\n  echo $3\n}\n\nexec_chkrootkit() {\n  CHKROOTKIT=`grep INFECTED $TMPLOG`\n  MAIL_TITLE=`echo -n \"\u3010server_check\u3011chkrootkit\u306b\u554f\u984c\u767a\u751f [192.168.11.11]\" | base64 | xargs printf '=?UTF-8?B?%s?=\\n'`\n  mail_send $MAIL_TITLE 'chkrootkit' $CHKROOTKIT\n}\n\nexec_chkrootkit\n\n\n\u3053\u308c\u3092\u5b9f\u884c\u3059\u308b\u3068mail_send()\u306e\u4e2d\u3067\u5b9f\u884c\u3057\u305f\u5f15\u65703\u3064\u304c\u3001\u610f\u56f3\u3057\u305f\u3082\u306e\u3068\u9055\u3046\u3082\u306e\u304c\u51fa\u3066\u304d\u3066\u3057\u307e\u3063\u305f\u3002\n\n\u89e3\u6c7a\u7b56\n\n\u300cchkrootkit\u306b\u554f\u984c\u767a\u751f [192.168.11.11]\u300d\u30ab\u30c3\u30b3\u306e\u524d\u306b\u534a\u89d2\u30b9\u30da\u30fc\u30b9\u304c\u3042\u3063\u305f\u305b\u3044\u3067\u5f15\u6570\u304c2\u3064\u6271\u3044\u306b\u3055\u308c\u305f\u304b\u3089\u30b9\u30da\u30fc\u30b9\u524a\u9664\n\u305d\u3082\u305d\u3082\u5f15\u6570\u306b\u6587\u5b57\u5217\u6e21\u3059\u306a\u3089\u30c0\u30d6\u30eb\u30af\u30aa\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3067\u56f2\u307e\u3093\u3068\u3042\u304b\u3093\u3067\u3057\u3087\n\nmail_send $MAIL_TITLE 'chkrootkit' $CHKROOTKIT\n\u3000\u2193\nmail_send \"$MAIL_TITLE\" 'chkrootkit' \"$CHKROOTKIT\"\n\u3053\u3046\u3044\u3046\u5358\u7d14\u306a\u30df\u30b9\u304c\u30d0\u30b0\u3092\u751f\u3080\u308f\u3051\u3067\u3059\u306a\u30fb\u30fb\u30fb\u6c17\u3092\u3064\u3051\u3088\u3046\u3002\n\n\u53c2\u8003\u30b5\u30a4\u30c8\n\n\u3010\u81ea\u5b85\u30b5\u30fc\u30d0\u69cb\u7bc9\u8a18\u9332\u3011\u30b5\u30fc\u30d0\u3092\u5916\u90e8\u306b\u3055\u3089\u3059\u307e\u3048\u306b\u2026\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\uff01\nhttp://blue-goheimochi.hatenablog.com/entry/2013/07/17/%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92%E5%A4%96%E9%83%A8%E3%81%AB%E3%81%95%E3%82%89%E3%81%99%E3%81%BE%E3%81%88%E3%81%AB%E2%80%A6%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%EF%BC%81\nrootkit\u691c\u77e5\u30c4\u30fc\u30eb\u5c0e\u5165(chkrootkit)\nhttps://centossrv.com/chkrootkit.shtml\n\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\nhttp://qiita.com/tiida26/items/3a2486a75132e159e4ea\n\n\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\uff01\n# \u76ee\u7684\n\u30af\u30e9\u30c3\u30ab\u30fc\uff08\u60aa\u610f\u306e\u3042\u308b\u30cf\u30c3\u30ab\u30fc\uff09\u306b\u3088\u308a\u30b5\u30fc\u30d0\u30fc\u306b\u5165\u3089\u308c\u3066rootkit\u3092\u7f6e\u304b\u308c\u305f\u4e8b\u3092\u691c\u77e5\u3059\u308b\u305f\u3081\u306e\nchkrootkit\u3092\u5c0e\u5165\u3057\u3066\u3001\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u308a\u3001cron\u3067\u5b9a\u671f\u7684\u306b\u5b9f\u884c\u3057\u3066\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u3092\u5c11\u3057\u3067\u3082\u9ad8\u3081\u305f\u3044\u3002\n\n\u304c\u30fb\u30fb\u30fb\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u30fb\u30fb\u30fb\u3060\u3081\u3063\u30fb\u30fb\u30fb\uff01\uff01\n\n\u30e1\u30fc\u30eb\u306e\u4ef6\u540d\u304c\u6587\u5b57\u5316\u3051\u3059\u308b\u3063\u30fb\u30fb\u30fb\uff01\uff01\n\u95a2\u6570\u3078\u6e21\u3057\u305f\u5f15\u6570\u304c\u3076\u3063\u58ca\u308c\u308b\u3063\u30fb\u30fb\u30fb\uff01\uff01\n\n# \u74b0\u5883\n- CentOS6.5\n- postfix\u3001nkf\u5c0e\u5165\u6e08\u307f\n- bash\n\n# \u5fd9\u3057\u3044\u4eba\u5411\u3051\n\u7d50\u679c\u7684\u306b\u3001\u3053\u308c\u3067\u3046\u307e\u304f\u3044\u304d\u307e\u3057\u305f\u3002\nchkrootkit\u4ee5\u5916\u306b\u3082\u8af8\u3005\u30c1\u30a7\u30c3\u30af\u3057\u305f\u3044\u306e\u3067\u3001\n\u305d\u306e\u5834\u5408\u306b\u306f\u90fd\u5ea6\u95a2\u6570\u3092\u8ffd\u52a0\u3057\u3066\u30e1\u30fc\u30eb\u9001\u4fe1\u90e8\u5206\u3060\u3051\u4e0b\u8a18\u306e\u95a2\u6570\u3092\u4f7f\u3044\u307e\u308f\u3059\u30a4\u30e1\u30fc\u30b8\u3002\n\n```server_check.sh\n#!/bin/bash\n\n#--------------------------------\n#\n# \u74b0\u5883\u5909\u6570\n#\n#--------------------------------\n\n# \u5b9f\u884c\u65e5\u6642\nDATE=`date +'%Y/%m/%d %H:%M:%S'`\n\n# \u5b9b\u5148\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\nMAIL_TO=\"ore@mail.com\"\n\n# \u9001\u4fe1\u5143\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\nMAIL_FROM=\"noreply@mail.com\"\n\n\n#--------------------------------\n#\n# \u95a2\u6570\u5b9a\u7fa9\n#\n#--------------------------------\n\n#********************************\n# \u30e1\u30fc\u30eb\u9001\u4fe1\u51e6\u7406\n# @param1($1) : \u30e1\u30fc\u30eb\u306e\u4ef6\u540d\n# @param2($2) : \u5b9f\u884c\u30d7\u30ed\u30b0\u30e9\u30e0\u540d\n# @param3($3) : \u5b9f\u884c\u7d50\u679c\n#********************************\n\nmail_send () {\n\ncat << EOD | nkf -j -m0 | sendmail -t\nFrom: ${MAIL_FROM}\nTo: ${MAIL_TO}\nSubject: ${1}\nMIME-Version: 1.0\nContent-Type: text/plain; charset=\"ISO-2022-JP\"\nContent-Transfer-Encoding: 7bit\n\n\u5b9f\u884c\u65e5\u6642\uff1a${DATE}\n\n\u30fb${2}\n${3}\n\nEOD\n}\n\n\n#********************************\n# chkrootkit\u306e\u5b9f\u884c\n#********************************\nexec_chkrootkit() {\n\n  # chkrootkit\u5b9f\u884c\u30ed\u30b0\n  TMPLOG=`mktemp`\n  chkrootkit > $TMPLOG\n\n  # SMTPS\u306ebindshell\u8aa4\u691c\u77e5\u5bfe\u5fdc\n  if [ ! -z \"$(grep 465 $TMPLOG)\" ] && \\\n     [ -z $(/usr/sbin/lsof -i:465|grep bindshell) ]; then\n       sed -i '/465/d' $TMPLOG\n  fi\n\n  # upstart\u30d1\u30c3\u30b1\u30fc\u30b8\u66f4\u65b0\u6642\u306eSuckit\u8aa4\u691c\u77e5\u5bfe\u5fdc\n  if [ ! -z \"$(grep Suckit $TMPLOG)\" ] && \\\n     [ -z \"$(rpm -V `rpm -qf /sbin/init`)\" ]; then\n       sed -i '/Suckit/d' $TMPLOG\n  fi\n\n  # \u554f\u984c\u304c\u3042\u308b\u5834\u5408\u306b\u306f\u30e1\u30fc\u30eb\u901a\u77e5\n  CHKROOTKIT=`grep INFECTED $TMPLOG`\n  if [ ! -z \"$CHKROOTKIT\" ]; then\n    MAIL_TITLE=`echo -n \"\u3010server_check\u3011chkrootkit\u306b\u554f\u984c\u767a\u751f\" | base64 | tr -d '\\n' | xargs printf '=?UTF-8?B?%s?=\\n'`\n    mail_send \"$MAIL_TITLE\" 'chkrootkit' \"$CHKROOTKIT\"\n  fi\n}\n\n\n#--------------------------------\n#\n# \u51e6\u7406\n#\n#--------------------------------\n\nexec_chkrootkit\n\nexit 0\n```\n\n<font color=\"red\">\u203b\u4e0b\u8a18\u306f\u30c6\u30b9\u30c8\u5b9f\u884c\u306e\u305f\u3081\u3001\u300cCHKROOTKIT=\\`grep INFECTED \\$TMPLOG\\`\u300d\u3092\u300cCHKROOTKIT=\\`grep infected \\$TMPLOG\\`\u300d\u306b\u5909\u66f4\u3057\u3066\u5b9f\u884c\u3057\u305f\u7d50\u679c\u3067\u3059\u3002</font>\n\n```\u30e1\u30fc\u30eb\u306e\u5185\u5bb9.txt\n\n\u4ef6\u540d\uff1a\u3010server_check\u3011chkrootkit\u306b\u554f\u984c\u767a\u751f\n\u672c\u6587\uff1a\n\u5b9f\u884c\u65e5\u6642\uff1a2017/02/02 23:03:45\n\n\u30fbchkrootkit\nChecking `basename'... not infected\nChecking `chfn'... not infected\nChecking `chsh'... not infected\nChecking `cron'... not infected\nChecking `crontab'... not infected\nChecking `date'... not infected\nChecking `du'... not infected\nChecking `dirname'... not infected\nChecking `echo'... not infected\nChecking `egrep'... not infected\nChecking `env'... not infected\nChecking `find'... not infected\nChecking `grep'... not infected\nChecking `hdparm'... not infected\nChecking `su'... not infected\nChecking `ifconfig'... not infected\nChecking `init'... not infected\nChecking `killall'... not infected\nChecking `ldsopreload'... not infected\nChecking `login'... not infected\nChecking `ls'... not infected\nChecking `lsof'... not infected\nChecking `mail'... not infected\nChecking `mingetty'... not infected\nChecking `netstat'... not infected\nChecking `passwd'... not infected\nChecking `pidof'... not infected\nChecking `ps'... not infected\nChecking `pstree'... not infected\nChecking `slogin'... not infected\nChecking `sendmail'... not infected\nChecking `sshd'... not infected\nChecking `tar'... not infected\nChecking `tcpd'... not infected\nChecking `tcpdump'... not infected\nChecking `top'... not infected\nChecking `traceroute'... not infected\nChecking `vdir'... not infected\nChecking `w'... not infected\nChecking `write'... not infected\nChecking `asp'... not infected\nChecking `bindshell'... not infected\nChecking `w55808'... not infected\nChecking `scalper'... not infected\nChecking `slapper'... not infected\nChecking `OSX_RSPLUG'... not infected\n\n```\n\n\n# \u554f\u984c1\n- \u30e1\u30fc\u30eb\u306e\u9001\u4fe1\u4ef6\u540d\u3001\u672c\u6587\u3092\u65e5\u672c\u8a9e\u3067\u9001\u308a\u305f\u3044\u306e\u306b\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u3063\u30fb\u30fb\u30fb\uff01\uff01\n\n\u9001\u4fe1\u4ef6\u540d\u306f\u65e5\u672c\u8a9e\u3060\u3051\u3069\u672c\u6587\u304c\u6587\u5b57\u5316\u3051\u3057\u305f\u308a\u3001\n\u672c\u6587\u306f\u6587\u5b57\u5316\u3051\u3057\u306a\u3044\u3051\u3069\u4ef6\u540d\u306f\u6587\u5b57\u5316\u3051\u3057\u305f\u308a\u3059\u308b\u3063\u30fb\u30fb\u30fb\uff01\uff01\uff08Thunderbird\u3055\u3093\u4f7f\u7528\uff09\n\n## \u4f8b\n\u4e0b\u8a18\u3067\u9001\u4fe1\u4ef6\u540d\u304c\u6587\u5b57\u5316\u3051\u3057\u3066\u3057\u307e\u3046\u3063\u30fb\u30fb\u30fb\uff01\uff01\n\n```\u53c2\u8003\u30b5\u30a4\u30c8\u3088\u308a\u5f15\u7528.sh\n#!/bin/bash\n\nexport PATH=$PATH:/usr/sbin\n\nMAIL_TO=\"ore@gmail.com\"\nMAIL_FROM=\"noreply@hogehoge.com\"\nSUBJECT=\"\u30e1\u30fc\u30eb\u30c6\u30b9\u30c8\"\nDATA=\"\u30c7\u30fc\u30bf\"\n\nmail_send () {\n\ncat << EOD | nkf -j -m0 | sendmail -t\nFrom: ${MAIL_FROM}\nTo: ${MAIL_TO}\nSubject: ${SUBJECT}\nMIME-Version: 1.0\nContent-Type: text/plain; charset=\"ISO-2022-JP\"\nContent-Transfer-Encoding: 7bit\n\n\n\u30e1\u30fc\u30eb\u304c\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n\u3053\u3053\u306b${DATA}\u304c\u5165\u308b\u3088\u3002\n\nEOD\n}\n\nmail_send\n\nexit 0\n```\n\n## \u89e3\u6c7a\u7b56\n\u30e1\u30fc\u30eb\u306e\u4ef6\u540d\u3092\u8272\u3005\u30d1\u30a4\u30d7\u3067\u3064\u306a\u3052\u308b\n\n\n```\nMAIL_TITLE=`echo -n \"\u3010server_check\u3011chkrootkit\u306b\u554f\u984c\u767a\u751f\" | base64 | tr -d '\\n' | xargs printf '=?UTF-8?B?%s?=\\n'`\n```\n\n\u300ctr -d '\\n'\u300d\u2190\u3053\u308c\u304c\u7121\u3044\u3068base64\u5f8c\u306e\u6587\u5b57\u5217\u306b\n`XQ==`\u3068\u304b\u3044\u3046\u30b4\u30df\u6587\u5b57\u5217\u3068\u305d\u306e\u76f4\u524d\u306e\u6539\u884c\u30b3\u30fc\u30c9\u304c\u8272\u3005\u60aa\u3055\u3092\u3057\u3066\u3057\u307e\u3046\u306e\u3067\u6ce8\u610f\u3002\n\n\n# \u554f\u984c2\n- \u95a2\u6570\u3078\u306e\u5f15\u6570\u304c\u306a\u3093\u304b\u304a\u304b\u3057\u3044\u3063\u30fb\u30fb\u30fb\uff01\uff01\n\n3\u3064\u306e\u5024\u3092\u6e21\u3057\u305f\u306e\u306b\u5206\u5272\u3055\u308c\u3066\u6e21\u3055\u308c\u3061\u3083\u3063\u3066\u308b\u3063\u307d\u3044\u305e\u3063\u30fb\u30fb\u30fb\uff01\uff01\n\n## \u4f8b\n```server_check.sh\nmail_send () {\n  echo $1\n  echo $2\n  echo $3\n}\n\nexec_chkrootkit() {\n  CHKROOTKIT=`grep INFECTED $TMPLOG`\n  MAIL_TITLE=`echo -n \"\u3010server_check\u3011chkrootkit\u306b\u554f\u984c\u767a\u751f [192.168.11.11]\" | base64 | xargs printf '=?UTF-8?B?%s?=\\n'`\n  mail_send $MAIL_TITLE 'chkrootkit' $CHKROOTKIT\n}\n\nexec_chkrootkit\n```\n\n\u3053\u308c\u3092\u5b9f\u884c\u3059\u308b\u3068mail_send()\u306e\u4e2d\u3067\u5b9f\u884c\u3057\u305f\u5f15\u65703\u3064\u304c\u3001\u610f\u56f3\u3057\u305f\u3082\u306e\u3068\u9055\u3046\u3082\u306e\u304c\u51fa\u3066\u304d\u3066\u3057\u307e\u3063\u305f\u3002\n\n\n### \u89e3\u6c7a\u7b56\n- \u300cchkrootkit\u306b\u554f\u984c\u767a\u751f [192.168.11.11]\u300d\u30ab\u30c3\u30b3\u306e\u524d\u306b\u534a\u89d2\u30b9\u30da\u30fc\u30b9\u304c\u3042\u3063\u305f\u305b\u3044\u3067\u5f15\u6570\u304c2\u3064\u6271\u3044\u306b\u3055\u308c\u305f\u304b\u3089\u30b9\u30da\u30fc\u30b9\u524a\u9664\n- \u305d\u3082\u305d\u3082\u5f15\u6570\u306b\u6587\u5b57\u5217\u6e21\u3059\u306a\u3089\u30c0\u30d6\u30eb\u30af\u30aa\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3067\u56f2\u307e\u3093\u3068\u3042\u304b\u3093\u3067\u3057\u3087\n\n`mail_send $MAIL_TITLE 'chkrootkit' $CHKROOTKIT`\n\u3000\u2193\n`mail_send \"$MAIL_TITLE\" 'chkrootkit' \"$CHKROOTKIT\"`\n\n\u3053\u3046\u3044\u3046\u5358\u7d14\u306a\u30df\u30b9\u304c\u30d0\u30b0\u3092\u751f\u3080\u308f\u3051\u3067\u3059\u306a\u30fb\u30fb\u30fb\u6c17\u3092\u3064\u3051\u3088\u3046\u3002\n\n# \u53c2\u8003\u30b5\u30a4\u30c8\n- \u3010\u81ea\u5b85\u30b5\u30fc\u30d0\u69cb\u7bc9\u8a18\u9332\u3011\u30b5\u30fc\u30d0\u3092\u5916\u90e8\u306b\u3055\u3089\u3059\u307e\u3048\u306b\u2026\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\uff01\nhttp://blue-goheimochi.hatenablog.com/entry/2013/07/17/%E3%82%B5%E3%83%BC%E3%83%90%E3%82%92%E5%A4%96%E9%83%A8%E3%81%AB%E3%81%95%E3%82%89%E3%81%99%E3%81%BE%E3%81%88%E3%81%AB%E2%80%A6%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%EF%BC%81\n\n- rootkit\u691c\u77e5\u30c4\u30fc\u30eb\u5c0e\u5165(chkrootkit)\nhttps://centossrv.com/chkrootkit.shtml\n\n- \u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\nhttp://qiita.com/tiida26/items/3a2486a75132e159e4ea\n\n\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\uff01\n"}