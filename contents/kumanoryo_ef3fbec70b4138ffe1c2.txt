{"context": "\n\n\u3042\u3089\u307e\u3057\nGoogle Cloud SQL Second Generation \u304c\u65e5\u672c\u6642\u95932016/08/17\u672a\u660e\u306b beta \u304b\u3089 GA \u3068\u306a\u3063\u305f\u3002\n\u3042\u308f\u305b\u3066\u3053\u308c\u307e\u3067 beta \u6271\u3044\u3067\u3042\u3063\u305f Cloud SQL Proxy \u3082 GA \u3068\u306a\u3063\u305f\u3002\nCloud SQL Proxy \u306f Cloud SQL \u306e\u758e\u901a\u5236\u9650\u3092GCE\u306eVM\u6bce\u306b\u958b\u653e\u3059\u308b\u5fc5\u8981\u304c\u306a\u304f\u306a\u308a\n\u5927\u5909\u4fbf\u5229\u306a\u6a5f\u80fd\u3067\u306f\u3042\u308b\u306e\u3060\u304c\u3001TCP Socket\u3067\u5229\u7528\u3059\u308b\u5834\u5408\u3001cloud_sql_proxy\u30d7\u30ed\u30bb\u30b9\u306e\u7ba1\u7406\u30fb\u76e3\u8996\u3092\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\nsystemd\u5316\u3059\u308b\u3053\u3068\u3067\u30d7\u30ed\u30bb\u30b9\u306e\u6c38\u7d9a\u5316\u3001\u7ba1\u7406\u3001\u81ea\u52d5\u8d77\u52d5\u306a\u3069\u304c\u5b9f\u73fe\u3067\u304d\u308b\u70ba\u3001\u4ee5\u524d\u306b\u691c\u8a3c\u3057\u305f\u5185\u5bb9\u3092\u5171\u6709\u3059\u308b\u3002\n\n\u691c\u8a3c\u74b0\u5883\n\u4eca\u56de\u691c\u8a3c\u3067\u4f7f\u7528\u3057\u305f\u74b0\u5883\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3067\u3042\u308b\u3002\n\nGCP\nproject id: myproject-id\n\nCloud SQL\n\u4ee5\u964d\u51fa\u3066\u304f\u308b\u8a2d\u5b9a\u30fb\u30b3\u30de\u30f3\u30c9\u306einstance\u540d\u306f\u5404\u3005\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u304f\u3060\u3055\u3044\u3002\ninstance\u540d: mycloudsql\nregion: asia-east1\nSecond Generation (\u7b2c2\u4e16\u4ee3)\u3067\u69cb\u7bc9\u3002\n\nVM (GCE)\ninstance\u540d: host\nVM\u4f5c\u6210\u6642\u306b https://www.googleapis.com/auth/sqlservice.admin \u3092\u6709\u52b9\u306b\u3057\u3066\u304a\u304f\u3002\n\u307e\u305f\u3001mysql client \u304a\u3088\u3073 cloud_sql_proxy \u3092 install \u3057\u3066\u304a\u304f\u3002\n\nmysql client\u306einstall\nsudo apt-get update\nsudo apt-get install mysql-client\n\n\ncloud_sql_proxy\u306einstall\nwget https://dl.google.com/cloudsql/cloud_sql_proxy.linux.amd64\nmv cloud_sql_proxy.linux.amd64 cloud_sql_proxy\nchmod +x cloud_sql_proxy\nchown root:root cloud_sql_proxy\nsudo mv cloud_sql_proxy /usr/bin\n\n\n\u691c\u8a3c\u5185\u5bb9\n\ncloud_sql_proxy\u3092systemd\u5316\u3059\u308b\u8a2d\u5b9a\n\u8907\u6570\u306eCloud SQL \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\n\u6c4e\u7528systemd\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb \u3068 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7279\u5316\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff08\u74b0\u5883\u5909\u6570\uff09\u306b\u5206\u3051\u305f\u3002\n\n\u6c4e\u7528systemd\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\u30d5\u30a1\u30a4\u30eb\u540d\u306f /etc/systemd/system/cloud_sql_proxy@.service\n1VM\u306b1\u30d5\u30a1\u30a4\u30eb\u914d\u7f6e\u3057\u307e\u3059\u3002\nuser@host:~$ sudo cat /etc/systemd/system/cloud_sql_proxy\\@.service\n[Unit]\nDescription = CloudSQL Proxy %i\nAfter = network.target\n\n[Service]\nEnvironmentFile = /srv/cloud_sql_proxy/%i.conf\nExecStart = /usr/bin/cloud_sql_proxy -instances=${PROJECT_ID}:${REGION}:${INSTANCE_NAME}=tcp:${PORT}\nExecStop = /bin/kill ${MAINPID}\nExecReload = /bin/kill -HUP ${MAINPID}\nRestart = always\nType = simple\n\n[Install]\nWantedBy = multi-user.target\n\n\nMax open files\u8a2d\u5b9a\ncloud_sql_proxy process\u306eMax open files\u309265535\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306fulimit -f\u306a\u3069\u3067\u8a2d\u5b9a\u3055\u308c\u305f\u5024\u304c\u4f7f\u7528\u3055\u308c\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f\u7dcf\u3058\u3066\u4f4e\u3081(1024\u306a\u3069)\u306a\u70ba\u3002\nusre@host:$ sudo mkdir /etc/systemd/system/cloud_sql_proxy\\@.service.d\nusre@host:$ sudo cat /etc/systemd/system/cloud_sql_proxy\\@.service.d/limits.conf\n[Service]\nLimitNOFILE=65536\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7279\u5316\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\u30d5\u30a1\u30a4\u30eb\u540d\u306f /srv/cloud_sql_proxy/*instance_name*.conf\nVM\u304b\u3089\u63a5\u7d9a\u3057\u305f\u3044Cloud SQL\u6bce\u306b\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nuser@host:~$ sudo cat /srv/cloud_sql_proxy/mycloudsql.conf\nPROJECT_ID=\"myproject-id\"\nREGION=\"asia-east1\"\nINSTANCE_NAME=\"mycloudsql\"\nPORT=\"3306\"\n\n\ncloud_sql_proxy\u306e\u8d77\u52d5\nsudo systemctl start cloud_sql_proxy@instance_name.service \u306e\u5f62\u3067\u8d77\u52d5\u3059\u308b\u3002\n(\u3053\u3053\u3067\u8a00\u3046instance_name\u306fCloudSQL\u306einstance_name\u3067\u3042\u308a\u3001systemd\u7528\u8a9e\u306einstance\u3068\u306f\u7570\u306a\u308b\u3002)\n# \u8d77\u52d5\u30b3\u30de\u30f3\u30c9\nuser@host:~$ sudo systemctl start cloud_sql_proxy@mycloudsql.service\n\n# status\u78ba\u8a8d\nuser@host:~$ sudo systemctl status cloud_sql_proxy@mycloudsql.service\n\u25cf cloud_sql_proxy@mycloudsql.service - CloudSQL Proxy mycloudsql\n   Loaded: loaded (/etc/systemd/system/cloud_sql_proxy@.service; disabled)\n   Active: active (running) since Thu 2016-06-30 09:35:30 UTC; 6s ago\n Main PID: 634 (cloud_sql_proxy)\n   CGroup: /system.slice/system-cloud_sql_proxy.slice/cloud_sql_proxy@mycloudsql.service\n           \u2514\u2500634 /usr/bin/cloud_sql_proxy -instances=myproject-id:asia-east1:mycloudsql=tcp:3306\n\nJun 30 09:35:30 mycloudsql systemd[1]: Starting CloudSQL Proxy mycloudsql...\nJun 30 09:35:30 mycloudsql systemd[1]: Started CloudSQL Proxy mycloudsql.\nJun 30 09:35:30 mycloudsql cloud_sql_proxy[634]: 2016/06/30 09:35:30 Listening on 127.0.0.1:3306 for myprojet-id...-0627\nJun 30 09:35:30 mycloudsql cloud_sql_proxy[634]: 2016/06/30 09:35:30 Ready for new connections\nHint: Some lines were ellipsized, use -l to show in full.\n\n# process\u78ba\u8a8d\nuser@host:~$ ps -ef | grep cloud_sql | grep -v grep\nroot       634     1  0 09:35 ?        00:00:00 /usr/bin/cloud_sql_proxy -instances=myproject-id:asia-east1:mycloudsql=tcp:3306\n\n# CloudSQL\u758e\u901a\u78ba\u8a8d\nuser@host:~$ mysql -uroot -h127.0.0.1\nWelcome to the MySQL monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 2843\nServer version: 5.6.29-google (Google)\n\nCopyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql> exit\nBye\n\n\ncloud_sql_proxy\u306e\u505c\u6b62\nsudo systemctl stop cloud_sql_proxy@instance_name.service \u306e\u5f62\u3067\u505c\u6b62\u3059\u308b\u3002\n# \u505c\u6b62\u30b3\u30de\u30f3\u30c9\nuser@host:~$ sudo systemctl stop cloud_sql_proxy@mycloudsql.service\n\n# status\u78ba\u8a8d\nuser@host:~$ sudo systemctl status cloud_sql_proxy@mycloudsql.service\n\u25cf cloud_sql_proxy@mycloudsql.service - CloudSQL Proxy mycloudsql\n   Loaded: loaded (/etc/systemd/system/cloud_sql_proxy@.service; disabled)\n   Active: inactive (dead) since Thu 2016-06-30 09:41:09 UTC; 8s ago\n  Process: 661 ExecStop=/bin/kill ${MAINPID} (code=exited, status=0/SUCCESS)\n Main PID: 634 (code=killed, signal=TERM)\n\nJun 30 09:35:30 mycloudsql systemd[1]: Starting CloudSQL Proxy mycloudsql...\nJun 30 09:35:30 mycloudsql systemd[1]: Started CloudSQL Proxy mycloudsql.\nJun 30 09:35:30 mycloudsql cloud_sql_proxy[634]: 2016/06/30 09:35:30 Listening on 127.0.0.1:3306 for myprojet-id...-0627\nJun 30 09:35:30 mycloudsql cloud_sql_proxy[634]: 2016/06/30 09:35:30 Ready for new connections\nJun 30 09:41:09 mycloudsql systemd[1]: Stopping CloudSQL Proxy mycloudsql...\nJun 30 09:41:09 mycloudsql systemd[1]: Stopped CloudSQL Proxy mycloudsql.\nHint: Some lines were ellipsized, use -l to show in full.\n\n# process\u78ba\u8a8d\nuser@host:~$ ps -ef | grep cloud_sql | grep -v grep\n\n\n\u81ea\u52d5\u8d77\u52d5\u304c\u6709\u52b9\u306a\u306e\u3092\u78ba\u8a8d\nVM\u969c\u5bb3\u6642\u306eOS\u81ea\u52d5\u518d\u8d77\u52d5\u306b\u5bfe\u5fdc\u3059\u3079\u304f\u3001OS\u518d\u8d77\u52d5\u6642\u306bcloud_sql_proxy\u304c\u81ea\u52d5\u3067\u8d77\u52d5\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u305f\u3002\n# \u81ea\u52d5\u8d77\u52d5\u6709\u52b9\u30b3\u30de\u30f3\u30c9\nuser@host:~$ sudo systemctl enable cloud_sql_proxy@mycloudsql.service\nCreated symlink from /etc/systemd/system/multi-user.target.wants/cloud_sql_proxy@mycloudsql.service to /etc/systemd/system/cloud_sql_proxy@.service.\n\n# status\u78ba\u8a8d\nuser@host:~$ sudo systemctl status cloud_sql_proxy@mycloudsql.service\n\u25cf cloud_sql_proxy@mycloudsql.service - CloudSQL Proxy mycloudsql\n   Loaded: loaded (/etc/systemd/system/cloud_sql_proxy@.service; enabled) <== \u81ea\u52d5\u8d77\u52d5\u6709\u52b9\n   Active: inactive (dead) since Thu 2016-06-30 09:41:09 UTC; 2min 29s ago\n  Process: 661 ExecStop=/bin/kill ${MAINPID} (code=exited, status=0/SUCCESS)\n Main PID: 634 (code=killed, signal=TERM)\n\nJun 30 09:35:30 mycloudsql systemd[1]: Starting CloudSQL Proxy mycloudsql...\nJun 30 09:35:30 mycloudsql systemd[1]: Started CloudSQL Proxy mycloudsql.\nJun 30 09:35:30 mycloudsql cloud_sql_proxy[634]: 2016/06/30 09:35:30 Listening on 127.0.0.1:3306 for myprojet-id...-0627\nJun 30 09:35:30 mycloudsql cloud_sql_proxy[634]: 2016/06/30 09:35:30 Ready for new connections\nJun 30 09:41:09 mycloudsql systemd[1]: Stopping CloudSQL Proxy mycloudsql...\nJun 30 09:41:09 mycloudsql systemd[1]: Stopped CloudSQL Proxy mycloudsql.\nHint: Some lines were ellipsized, use -l to show in full.\n\n# OS\u518d\u8d77\u52d5\nuser@host:~$ sudo reboot\n\n# OS\u518d\u8d77\u52d5\u5f8c\u306b\u81ea\u52d5\u8d77\u52d5\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\nuser@host:~$ sudo systemctl status cloud_sql_proxy@mycloudsql.service\n\u25cf cloud_sql_proxy@mycloudsql.service - CloudSQL Proxy mycloudsql\n   Loaded: loaded (/etc/systemd/system/cloud_sql_proxy@.service; enabled)\n   Active: active (running) since Thu 2016-06-30 09:44:11 UTC; 1min 35s ago\n Main PID: 357 (cloud_sql_proxy)\n   CGroup: /system.slice/system-cloud_sql_proxy.slice/cloud_sql_proxy@mycloudsql.service\n           \u2514\u2500357 /usr/bin/cloud_sql_proxy -instances=myproject-id:asia-east1:mycloudsql=tcp:3306\n\nJun 30 09:44:11 mycloudsql systemd[1]: Started CloudSQL Proxy mycloudsql.\nJun 30 09:44:11 mycloudsql cloud_sql_proxy[357]: 2016/06/30 09:44:11 Listening on 127.0.0.1:3306 for myprojet-id...-0627\nJun 30 09:44:11 mycloudsql cloud_sql_proxy[357]: 2016/06/30 09:44:11 Ready for new connections\nJun 30 09:44:14 mycloudsql cloud_sql_proxy[357]: 2016/06/30 09:44:14 New connection for \"myproject-id:asia-east1...0627\"\nHint: Some lines were ellipsized, use -l to show in full.\n\n\n\u307e\u3068\u3081\n\u4eca\u307e\u3067beta\u7248\u3060\u3063\u305f\u70ba\u306b\u3001\u30a4\u30de\u30a4\u30c1\u4f7f\u3044\u3069\u3053\u308d\u304c\u96e3\u3057\u304b\u3063\u305f Cloud SQL \u304a\u3088\u3073 Cloud SQL Proxy \u3082 GA \u30ea\u30ea\u30fc\u30b9\u3068\u306a\u308a\u3001\u3088\u3046\u3084\u304f\u5229\u7528\u30b7\u30fc\u30f3\u3082\u5897\u3048\u305d\u3046\u3060\u306a\u3001\u3068\u611f\u3058\u3066\u3044\u307e\u3059\u3002\nCloud SQL Proxy \u7d4c\u7531\u3067\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3063\u3066\u52a3\u5316\u3057\u306a\u3044\u306e\uff1f\u3068\u3044\u3046\u7591\u554f\u70b9\u306f\u3042\u308b\u306e\u3067\u3059\u304c\u3001\u305d\u308c\u306f\u307e\u305f\u5225\u306e\u6a5f\u4f1a\u306b\u3002\n# \u3042\u3089\u307e\u3057\nGoogle Cloud SQL Second Generation \u304c\u65e5\u672c\u6642\u95932016/08/17\u672a\u660e\u306b beta \u304b\u3089 GA \u3068\u306a\u3063\u305f\u3002\n\u3042\u308f\u305b\u3066\u3053\u308c\u307e\u3067 beta \u6271\u3044\u3067\u3042\u3063\u305f Cloud SQL Proxy \u3082 GA \u3068\u306a\u3063\u305f\u3002\nCloud SQL Proxy \u306f Cloud SQL \u306e\u758e\u901a\u5236\u9650\u3092GCE\u306eVM\u6bce\u306b\u958b\u653e\u3059\u308b\u5fc5\u8981\u304c\u306a\u304f\u306a\u308a\n\u5927\u5909\u4fbf\u5229\u306a\u6a5f\u80fd\u3067\u306f\u3042\u308b\u306e\u3060\u304c\u3001TCP Socket\u3067\u5229\u7528\u3059\u308b\u5834\u5408\u3001cloud_sql_proxy\u30d7\u30ed\u30bb\u30b9\u306e\u7ba1\u7406\u30fb\u76e3\u8996\u3092\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\nsystemd\u5316\u3059\u308b\u3053\u3068\u3067\u30d7\u30ed\u30bb\u30b9\u306e\u6c38\u7d9a\u5316\u3001\u7ba1\u7406\u3001\u81ea\u52d5\u8d77\u52d5\u306a\u3069\u304c\u5b9f\u73fe\u3067\u304d\u308b\u70ba\u3001\u4ee5\u524d\u306b\u691c\u8a3c\u3057\u305f\u5185\u5bb9\u3092\u5171\u6709\u3059\u308b\u3002\n\n# \u691c\u8a3c\u74b0\u5883\n\u4eca\u56de\u691c\u8a3c\u3067\u4f7f\u7528\u3057\u305f\u74b0\u5883\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3067\u3042\u308b\u3002\n## GCP\nproject id: **myproject-id**\n\n## Cloud SQL\n\u4ee5\u964d\u51fa\u3066\u304f\u308b\u8a2d\u5b9a\u30fb\u30b3\u30de\u30f3\u30c9\u306einstance\u540d\u306f\u5404\u3005\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u304f\u3060\u3055\u3044\u3002\ninstance\u540d: **mycloudsql**\nregion: **asia-east1**\nSecond Generation (\u7b2c2\u4e16\u4ee3)\u3067\u69cb\u7bc9\u3002\n\n## VM (GCE)\ninstance\u540d: host\nVM\u4f5c\u6210\u6642\u306b `https://www.googleapis.com/auth/sqlservice.admin` \u3092\u6709\u52b9\u306b\u3057\u3066\u304a\u304f\u3002\n\u307e\u305f\u3001mysql client \u304a\u3088\u3073 cloud_sql_proxy \u3092 install \u3057\u3066\u304a\u304f\u3002\n\n### mysql client\u306einstall\n```\nsudo apt-get update\nsudo apt-get install mysql-client\n```\n\n### cloud_sql_proxy\u306einstall\n\n```\nwget https://dl.google.com/cloudsql/cloud_sql_proxy.linux.amd64\nmv cloud_sql_proxy.linux.amd64 cloud_sql_proxy\nchmod +x cloud_sql_proxy\nchown root:root cloud_sql_proxy\nsudo mv cloud_sql_proxy /usr/bin\n```\n\n# \u691c\u8a3c\u5185\u5bb9\n## cloud_sql_proxy\u3092systemd\u5316\u3059\u308b\u8a2d\u5b9a\n\u8907\u6570\u306eCloud SQL \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\n**\u6c4e\u7528systemd\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb** \u3068 **\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7279\u5316\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff08\u74b0\u5883\u5909\u6570\uff09**\u306b\u5206\u3051\u305f\u3002\n\n###\u6c4e\u7528systemd\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\u30d5\u30a1\u30a4\u30eb\u540d\u306f `/etc/systemd/system/cloud_sql_proxy@.service`\n1VM\u306b1\u30d5\u30a1\u30a4\u30eb\u914d\u7f6e\u3057\u307e\u3059\u3002\n\n```\nuser@host:~$ sudo cat /etc/systemd/system/cloud_sql_proxy\\@.service\n[Unit]\nDescription = CloudSQL Proxy %i\nAfter = network.target\n\n[Service]\nEnvironmentFile = /srv/cloud_sql_proxy/%i.conf\nExecStart = /usr/bin/cloud_sql_proxy -instances=${PROJECT_ID}:${REGION}:${INSTANCE_NAME}=tcp:${PORT}\nExecStop = /bin/kill ${MAINPID}\nExecReload = /bin/kill -HUP ${MAINPID}\nRestart = always\nType = simple\n\n[Install]\nWantedBy = multi-user.target\n```\n\n### Max open files\u8a2d\u5b9a\ncloud_sql_proxy process\u306eMax open files\u309265535\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306fulimit -f\u306a\u3069\u3067\u8a2d\u5b9a\u3055\u308c\u305f\u5024\u304c\u4f7f\u7528\u3055\u308c\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f\u7dcf\u3058\u3066\u4f4e\u3081(1024\u306a\u3069)\u306a\u70ba\u3002\n\n```\nusre@host:$ sudo mkdir /etc/systemd/system/cloud_sql_proxy\\@.service.d\nusre@host:$ sudo cat /etc/systemd/system/cloud_sql_proxy\\@.service.d/limits.conf\n[Service]\nLimitNOFILE=65536\n```\n\n### \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7279\u5316\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\n\u30d5\u30a1\u30a4\u30eb\u540d\u306f `/srv/cloud_sql_proxy/*instance_name*.conf`\nVM\u304b\u3089\u63a5\u7d9a\u3057\u305f\u3044Cloud SQL\u6bce\u306b\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```\nuser@host:~$ sudo cat /srv/cloud_sql_proxy/mycloudsql.conf\nPROJECT_ID=\"myproject-id\"\nREGION=\"asia-east1\"\nINSTANCE_NAME=\"mycloudsql\"\nPORT=\"3306\"\n```\n\n## cloud_sql_proxy\u306e\u8d77\u52d5\nsudo systemctl start cloud_sql_proxy@*instance_name*.service \u306e\u5f62\u3067\u8d77\u52d5\u3059\u308b\u3002\n(\u3053\u3053\u3067\u8a00\u3046instance_name\u306fCloudSQL\u306einstance_name\u3067\u3042\u308a\u3001systemd\u7528\u8a9e\u306einstance\u3068\u306f\u7570\u306a\u308b\u3002)\n\n```\n# \u8d77\u52d5\u30b3\u30de\u30f3\u30c9\nuser@host:~$ sudo systemctl start cloud_sql_proxy@mycloudsql.service\n\n# status\u78ba\u8a8d\nuser@host:~$ sudo systemctl status cloud_sql_proxy@mycloudsql.service\n\u25cf cloud_sql_proxy@mycloudsql.service - CloudSQL Proxy mycloudsql\n   Loaded: loaded (/etc/systemd/system/cloud_sql_proxy@.service; disabled)\n   Active: active (running) since Thu 2016-06-30 09:35:30 UTC; 6s ago\n Main PID: 634 (cloud_sql_proxy)\n   CGroup: /system.slice/system-cloud_sql_proxy.slice/cloud_sql_proxy@mycloudsql.service\n           \u2514\u2500634 /usr/bin/cloud_sql_proxy -instances=myproject-id:asia-east1:mycloudsql=tcp:3306\n\nJun 30 09:35:30 mycloudsql systemd[1]: Starting CloudSQL Proxy mycloudsql...\nJun 30 09:35:30 mycloudsql systemd[1]: Started CloudSQL Proxy mycloudsql.\nJun 30 09:35:30 mycloudsql cloud_sql_proxy[634]: 2016/06/30 09:35:30 Listening on 127.0.0.1:3306 for myprojet-id...-0627\nJun 30 09:35:30 mycloudsql cloud_sql_proxy[634]: 2016/06/30 09:35:30 Ready for new connections\nHint: Some lines were ellipsized, use -l to show in full.\n\n# process\u78ba\u8a8d\nuser@host:~$ ps -ef | grep cloud_sql | grep -v grep\nroot       634     1  0 09:35 ?        00:00:00 /usr/bin/cloud_sql_proxy -instances=myproject-id:asia-east1:mycloudsql=tcp:3306\n\n# CloudSQL\u758e\u901a\u78ba\u8a8d\nuser@host:~$ mysql -uroot -h127.0.0.1\nWelcome to the MySQL monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 2843\nServer version: 5.6.29-google (Google)\n\nCopyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql> exit\nBye\n```\n\n## cloud_sql_proxy\u306e\u505c\u6b62\nsudo systemctl stop cloud_sql_proxy@*instance_name*.service \u306e\u5f62\u3067\u505c\u6b62\u3059\u308b\u3002\n\n```\n# \u505c\u6b62\u30b3\u30de\u30f3\u30c9\nuser@host:~$ sudo systemctl stop cloud_sql_proxy@mycloudsql.service\n\n# status\u78ba\u8a8d\nuser@host:~$ sudo systemctl status cloud_sql_proxy@mycloudsql.service\n\u25cf cloud_sql_proxy@mycloudsql.service - CloudSQL Proxy mycloudsql\n   Loaded: loaded (/etc/systemd/system/cloud_sql_proxy@.service; disabled)\n   Active: inactive (dead) since Thu 2016-06-30 09:41:09 UTC; 8s ago\n  Process: 661 ExecStop=/bin/kill ${MAINPID} (code=exited, status=0/SUCCESS)\n Main PID: 634 (code=killed, signal=TERM)\n\nJun 30 09:35:30 mycloudsql systemd[1]: Starting CloudSQL Proxy mycloudsql...\nJun 30 09:35:30 mycloudsql systemd[1]: Started CloudSQL Proxy mycloudsql.\nJun 30 09:35:30 mycloudsql cloud_sql_proxy[634]: 2016/06/30 09:35:30 Listening on 127.0.0.1:3306 for myprojet-id...-0627\nJun 30 09:35:30 mycloudsql cloud_sql_proxy[634]: 2016/06/30 09:35:30 Ready for new connections\nJun 30 09:41:09 mycloudsql systemd[1]: Stopping CloudSQL Proxy mycloudsql...\nJun 30 09:41:09 mycloudsql systemd[1]: Stopped CloudSQL Proxy mycloudsql.\nHint: Some lines were ellipsized, use -l to show in full.\n\n# process\u78ba\u8a8d\nuser@host:~$ ps -ef | grep cloud_sql | grep -v grep\n```\n\n## \u81ea\u52d5\u8d77\u52d5\u304c\u6709\u52b9\u306a\u306e\u3092\u78ba\u8a8d\nVM\u969c\u5bb3\u6642\u306eOS\u81ea\u52d5\u518d\u8d77\u52d5\u306b\u5bfe\u5fdc\u3059\u3079\u304f\u3001OS\u518d\u8d77\u52d5\u6642\u306bcloud_sql_proxy\u304c\u81ea\u52d5\u3067\u8d77\u52d5\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u305f\u3002\n\n```\n# \u81ea\u52d5\u8d77\u52d5\u6709\u52b9\u30b3\u30de\u30f3\u30c9\nuser@host:~$ sudo systemctl enable cloud_sql_proxy@mycloudsql.service\nCreated symlink from /etc/systemd/system/multi-user.target.wants/cloud_sql_proxy@mycloudsql.service to /etc/systemd/system/cloud_sql_proxy@.service.\n\n# status\u78ba\u8a8d\nuser@host:~$ sudo systemctl status cloud_sql_proxy@mycloudsql.service\n\u25cf cloud_sql_proxy@mycloudsql.service - CloudSQL Proxy mycloudsql\n   Loaded: loaded (/etc/systemd/system/cloud_sql_proxy@.service; enabled) <== \u81ea\u52d5\u8d77\u52d5\u6709\u52b9\n   Active: inactive (dead) since Thu 2016-06-30 09:41:09 UTC; 2min 29s ago\n  Process: 661 ExecStop=/bin/kill ${MAINPID} (code=exited, status=0/SUCCESS)\n Main PID: 634 (code=killed, signal=TERM)\n\nJun 30 09:35:30 mycloudsql systemd[1]: Starting CloudSQL Proxy mycloudsql...\nJun 30 09:35:30 mycloudsql systemd[1]: Started CloudSQL Proxy mycloudsql.\nJun 30 09:35:30 mycloudsql cloud_sql_proxy[634]: 2016/06/30 09:35:30 Listening on 127.0.0.1:3306 for myprojet-id...-0627\nJun 30 09:35:30 mycloudsql cloud_sql_proxy[634]: 2016/06/30 09:35:30 Ready for new connections\nJun 30 09:41:09 mycloudsql systemd[1]: Stopping CloudSQL Proxy mycloudsql...\nJun 30 09:41:09 mycloudsql systemd[1]: Stopped CloudSQL Proxy mycloudsql.\nHint: Some lines were ellipsized, use -l to show in full.\n\n# OS\u518d\u8d77\u52d5\nuser@host:~$ sudo reboot\n\n# OS\u518d\u8d77\u52d5\u5f8c\u306b\u81ea\u52d5\u8d77\u52d5\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\nuser@host:~$ sudo systemctl status cloud_sql_proxy@mycloudsql.service\n\u25cf cloud_sql_proxy@mycloudsql.service - CloudSQL Proxy mycloudsql\n   Loaded: loaded (/etc/systemd/system/cloud_sql_proxy@.service; enabled)\n   Active: active (running) since Thu 2016-06-30 09:44:11 UTC; 1min 35s ago\n Main PID: 357 (cloud_sql_proxy)\n   CGroup: /system.slice/system-cloud_sql_proxy.slice/cloud_sql_proxy@mycloudsql.service\n           \u2514\u2500357 /usr/bin/cloud_sql_proxy -instances=myproject-id:asia-east1:mycloudsql=tcp:3306\n\nJun 30 09:44:11 mycloudsql systemd[1]: Started CloudSQL Proxy mycloudsql.\nJun 30 09:44:11 mycloudsql cloud_sql_proxy[357]: 2016/06/30 09:44:11 Listening on 127.0.0.1:3306 for myprojet-id...-0627\nJun 30 09:44:11 mycloudsql cloud_sql_proxy[357]: 2016/06/30 09:44:11 Ready for new connections\nJun 30 09:44:14 mycloudsql cloud_sql_proxy[357]: 2016/06/30 09:44:14 New connection for \"myproject-id:asia-east1...0627\"\nHint: Some lines were ellipsized, use -l to show in full.\n```\n\n# \u307e\u3068\u3081\n\u4eca\u307e\u3067beta\u7248\u3060\u3063\u305f\u70ba\u306b\u3001\u30a4\u30de\u30a4\u30c1\u4f7f\u3044\u3069\u3053\u308d\u304c\u96e3\u3057\u304b\u3063\u305f Cloud SQL \u304a\u3088\u3073 Cloud SQL Proxy \u3082 GA \u30ea\u30ea\u30fc\u30b9\u3068\u306a\u308a\u3001\u3088\u3046\u3084\u304f\u5229\u7528\u30b7\u30fc\u30f3\u3082\u5897\u3048\u305d\u3046\u3060\u306a\u3001\u3068\u611f\u3058\u3066\u3044\u307e\u3059\u3002\n\nCloud SQL Proxy \u7d4c\u7531\u3067\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3063\u3066\u52a3\u5316\u3057\u306a\u3044\u306e\uff1f\u3068\u3044\u3046\u7591\u554f\u70b9\u306f\u3042\u308b\u306e\u3067\u3059\u304c\u3001\u305d\u308c\u306f\u307e\u305f\u5225\u306e\u6a5f\u4f1a\u306b\u3002\n", "tags": ["GoogleCloudSQL", "Linux", "googlecomputeengine", "GoogleCloudPlatform"]}