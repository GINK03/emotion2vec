{"context": " More than 1 year has passed since last update.\u30a4\u30f3\u30c6\u30ebEdison + BLE\u3067\u3001konashi/SBBLE\u3092\u52d5\u304b\u3057\u3066\u307f\u305f\u3002\n\u3053\u3061\u3089\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u3044\u3066I2C\u3092\u52d5\u304b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nkoshian\u3067\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u304c\u3001UUID\u3092\u5909\u3048\u308c\u3070konashi\u3067\u3082\u52d5\u304f\u3068\u601d\u3044\u307e\u3059\n(\u6301\u3063\u3066\u308b\u3093\u3060\u304b\u3089\u78ba\u8a8d\u3057\u308d\u3088\u3063\u3066\u8a71\u3067\u3059\u304c\u2026)\u3002\nI2C\u306e\u901a\u4fe1\u76f8\u624b(\u30b9\u30ec\u30fc\u30d6)\u306fUzuki\u30bb\u30f3\u30b5\u30fc\u30b7\u30fc\u30eb\u30c9\u4e0a\u306eSi7013(\u6e29\u6e7f\u5ea6\u30bb\u30f3\u30b5)\u3068\u3057\u3001\u6e29\u5ea6\u3092\u53d6\u5f97\u3057\u3066\u3044\u307e\u3059\u3002\n\u4ee5\u4e0b\u30b5\u30f3\u30d7\u30eb\u3067\u3059(\u307b\u307c\u521d\u3081\u3066\u306ejs)\u3002\n15\u884c\u76ee\u304f\u3089\u3044\u307e\u3067\u306f\u3001\u4e0a\u8a18\u306e\u30b3\u30fc\u30c9\u305d\u306e\u307e\u307e\u3067\u3059\u3002\n\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n\nkoshian_i2c.js\nvar noble = require('./index');\n\nconst ADDR_Si7013 = 0x40\nconst CMD_TEMP    = 0xE3\n\nconst KOSHIAN_I2C_MODE_ENABLE_100K  = 0x01\n\nconst KOSHIAN_I2C_CONDITION_STOP    = 0x00\nconst KOSHIAN_I2C_CONDITION_START   = 0x01\nconst KOSHIAN_I2C_CONDITION_RESTART = 0x02\n\nfunction calculateTemperature(data){\n  return (data[0]*256 + data[1])*175.72/65536 - 46.85\n}\n\nnoble.on('stateChange', function(state){\n  if (state === 'poweredOn') noble.startScanning();\n  else noble.stopScanning();\n});\n\nnoble.on('discover', function(peripheral){\n  noble.stopScanning();\n  console.log('peripheral with UUID ' + peripheral.uuid + ' found');\n  var advertisement = peripheral.advertisement;\n  var localName = advertisement.localName;\n  if (localName){\n    console.log('Local Name = ' + localName);\n  }\n\n  peripheral.connect(function(error){\n    if (error) console.log('connect error: ' + error);\n    console.log('connected to ' + peripheral.uuid);\n\n    peripheral.discoverServices(['229bff0003fb40da98a7b0def65c2d4b'], // KONASHI_SERVICE_UUID\n      function (error, services){\n        if (error) console.log('discoverServices error: ' + error);\n        console.log('services.length: ' + services.length);\n\n        var konashiService = services[0];\n        konashiService.discoverCharacteristics(\n          ['229b300b03fb40da98a7b0def65c2d4b',  // KONASHI_I2C_CONFIG_UUID\n           '229b300c03fb40da98a7b0def65c2d4b',  // KONASHI_I2C_START_STOP_UUID\n           '229b300d03fb40da98a7b0def65c2d4b',  // KONASHI_I2C_WRITE_UUID \n           '229b300e03fb40da98a7b0def65c2d4b',  // KONASHI_I2C_READ_PARAM_UUID \n           '229b300f03fb40da98a7b0def65c2d4b'], // KONASHI_I2C_READ_UUID\n          function(error, characteristics){\n            if (error) console.log('discoverCharacteristics error: ' + error);\n            console.log('characteristics.length: ' + characteristics.length);\n\n            // enable I2C\n            characteristics[0].write(new Buffer([KOSHIAN_I2C_MODE_ENABLE_100K]), false);\n            var i = 0;\n            setInterval(function(){\n              // send StartCondition\n              characteristics[1].write(new Buffer([KOSHIAN_I2C_CONDITION_START]), false, function(error){\n                // send register-address/command\n                characteristics[2].write(new Buffer([2, (ADDR_Si7013 << 1) & 0xFE, CMD_TEMP]), false, function(error){\n                  // send RestartCondition\n                  characteristics[1].write(new Buffer([KOSHIAN_I2C_CONDITION_RESTART]), false, function(error){\n                    // request data read \n                    characteristics[3].write(new Buffer([2, (ADDR_Si7013 << 1) | 0x01]), false, function(error){\n                      // send StopCondition\n                      characteristics[1].write(new Buffer([KOSHIAN_I2C_CONDITION_STOP]), false);\n                      // read received data\n                      characteristics[4].read(function(error, data){\n                        if (data){\n                          console.log( i++ + ' - temperature : ' + calculateTemperature(data) + ' degC');\n                        }\n                      });\n                    });\n                  });\n                });\n              });\n            }, 1000);\n          }\n        );\n      }\n    );\n  });\n});\n\n\n\nCallback Hell ?\n\u6d41\u308c\u3068\u3057\u3066\u306f\u3001\n\u30b9\u30bf\u30fc\u30c8\u30b3\u30f3\u30c7\u30a3\u30b7\u30e7\u30f3\u2192\n\u30b9\u30ec\u30fc\u30d6\u30a2\u30c9\u30ec\u30b9+W+\u30b3\u30de\u30f3\u30c9\u2192\n\u30ea\u30b9\u30bf\u30fc\u30c8\u30b3\u30f3\u30c7\u30a3\u30b7\u30e7\u30f3\u2192\n\u30b9\u30ec\u30fc\u30d6\u30a2\u30c9\u30ec\u30b9+R\u2192\n(\u30c7\u30fc\u30bf\u53d7\u4fe1)\u2192\n\u30b9\u30c8\u30c3\u30d7\u30b3\u30f3\u30c7\u30a3\u30b7\u30e7\u30f3\n\u3068\u3044\u3046\u6d41\u308c\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u3001\n\u3053\u308c\u3092\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3067\u547c\u3073\u51fa\u3055\u305a\u306b\u30c4\u30e9\u30c4\u30e9\u3068\u4e26\u3079\u305f\u3060\u3051\u3067\u306f\u3001\n\u4f55\u56de\u304b\u30eb\u30fc\u30d7\u304c\u56de\u3063\u305f\u3068\u3053\u308d\u3067\u6b62\u307e\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\u767a\u884c\u3057\u305f\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u524d\u5f8c\u3057\u3066\u3057\u307e\u3046\u306e\u3067\u3057\u3087\u3046\u304b\u306d?\n\u4eca\u65e5\u306f\u6e29\u304b\u30441\u65e5\u3067\u3057\u305f\u306d\u3001\u5ba4\u6e29\u304c21\u5ea6\u3042\u308a\u307e\u3057\u305f\u3002\n[\u30a4\u30f3\u30c6\u30ebEdison + BLE\u3067\u3001konashi/SBBLE\u3092\u52d5\u304b\u3057\u3066\u307f\u305f\u3002](http://blog.goo.ne.jp/roboz80/e/c4d6aefbd2ba690565eceaf956141f81)\n\u3053\u3061\u3089\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u3044\u3066I2C\u3092\u52d5\u304b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n**koshian**\u3067\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u304c\u3001UUID\u3092\u5909\u3048\u308c\u3070**konashi**\u3067\u3082\u52d5\u304f\u3068\u601d\u3044\u307e\u3059\n(\u6301\u3063\u3066\u308b\u3093\u3060\u304b\u3089\u78ba\u8a8d\u3057\u308d\u3088\u3063\u3066\u8a71\u3067\u3059\u304c\u2026)\u3002\n\nI2C\u306e\u901a\u4fe1\u76f8\u624b(\u30b9\u30ec\u30fc\u30d6)\u306f[Uzuki\u30bb\u30f3\u30b5\u30fc\u30b7\u30fc\u30eb\u30c9](http://www.m-pression.com/ja/solutions/boards/uzuki-shield;jsessionid=53E231695E9B617450F7EF6AAE569721)\u4e0a\u306e**Si7013**(\u6e29\u6e7f\u5ea6\u30bb\u30f3\u30b5)\u3068\u3057\u3001\u6e29\u5ea6\u3092\u53d6\u5f97\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u30b5\u30f3\u30d7\u30eb\u3067\u3059(\u307b\u307c\u521d\u3081\u3066\u306ejs)\u3002\n15\u884c\u76ee\u304f\u3089\u3044\u307e\u3067\u306f\u3001\u4e0a\u8a18\u306e\u30b3\u30fc\u30c9\u305d\u306e\u307e\u307e\u3067\u3059\u3002\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n============\n```js:koshian_i2c.js\nvar noble = require('./index');\n\nconst ADDR_Si7013 = 0x40\nconst CMD_TEMP    = 0xE3\n\nconst KOSHIAN_I2C_MODE_ENABLE_100K  = 0x01\n\nconst KOSHIAN_I2C_CONDITION_STOP    = 0x00\nconst KOSHIAN_I2C_CONDITION_START   = 0x01\nconst KOSHIAN_I2C_CONDITION_RESTART = 0x02\n\nfunction calculateTemperature(data){\n  return (data[0]*256 + data[1])*175.72/65536 - 46.85\n}\n\nnoble.on('stateChange', function(state){\n  if (state === 'poweredOn') noble.startScanning();\n  else noble.stopScanning();\n});\n\nnoble.on('discover', function(peripheral){\n  noble.stopScanning();\n  console.log('peripheral with UUID ' + peripheral.uuid + ' found');\n  var advertisement = peripheral.advertisement;\n  var localName = advertisement.localName;\n  if (localName){\n    console.log('Local Name = ' + localName);\n  }\n\n  peripheral.connect(function(error){\n    if (error) console.log('connect error: ' + error);\n    console.log('connected to ' + peripheral.uuid);\n\n    peripheral.discoverServices(['229bff0003fb40da98a7b0def65c2d4b'], // KONASHI_SERVICE_UUID\n      function (error, services){\n        if (error) console.log('discoverServices error: ' + error);\n        console.log('services.length: ' + services.length);\n\n        var konashiService = services[0];\n        konashiService.discoverCharacteristics(\n          ['229b300b03fb40da98a7b0def65c2d4b',  // KONASHI_I2C_CONFIG_UUID\n           '229b300c03fb40da98a7b0def65c2d4b',  // KONASHI_I2C_START_STOP_UUID\n           '229b300d03fb40da98a7b0def65c2d4b',  // KONASHI_I2C_WRITE_UUID \n           '229b300e03fb40da98a7b0def65c2d4b',  // KONASHI_I2C_READ_PARAM_UUID \n           '229b300f03fb40da98a7b0def65c2d4b'], // KONASHI_I2C_READ_UUID\n          function(error, characteristics){\n            if (error) console.log('discoverCharacteristics error: ' + error);\n            console.log('characteristics.length: ' + characteristics.length);\n\n            // enable I2C\n            characteristics[0].write(new Buffer([KOSHIAN_I2C_MODE_ENABLE_100K]), false);\n            var i = 0;\n            setInterval(function(){\n              // send StartCondition\n              characteristics[1].write(new Buffer([KOSHIAN_I2C_CONDITION_START]), false, function(error){\n                // send register-address/command\n                characteristics[2].write(new Buffer([2, (ADDR_Si7013 << 1) & 0xFE, CMD_TEMP]), false, function(error){\n                  // send RestartCondition\n                  characteristics[1].write(new Buffer([KOSHIAN_I2C_CONDITION_RESTART]), false, function(error){\n                    // request data read \n                    characteristics[3].write(new Buffer([2, (ADDR_Si7013 << 1) | 0x01]), false, function(error){\n                      // send StopCondition\n                      characteristics[1].write(new Buffer([KOSHIAN_I2C_CONDITION_STOP]), false);\n                      // read received data\n                      characteristics[4].read(function(error, data){\n                        if (data){\n                          console.log( i++ + ' - temperature : ' + calculateTemperature(data) + ' degC');\n                        }\n                      });\n                    });\n                  });\n                });\n              });\n            }, 1000);\n          }\n        );\n      }\n    );\n  });\n});\n```\nCallback Hell ?\n=====================\n\u6d41\u308c\u3068\u3057\u3066\u306f\u3001\n\u30b9\u30bf\u30fc\u30c8\u30b3\u30f3\u30c7\u30a3\u30b7\u30e7\u30f3\u2192\n\u30b9\u30ec\u30fc\u30d6\u30a2\u30c9\u30ec\u30b9+W+\u30b3\u30de\u30f3\u30c9\u2192\n\u30ea\u30b9\u30bf\u30fc\u30c8\u30b3\u30f3\u30c7\u30a3\u30b7\u30e7\u30f3\u2192\n\u30b9\u30ec\u30fc\u30d6\u30a2\u30c9\u30ec\u30b9+R\u2192\n(\u30c7\u30fc\u30bf\u53d7\u4fe1)\u2192\n\u30b9\u30c8\u30c3\u30d7\u30b3\u30f3\u30c7\u30a3\u30b7\u30e7\u30f3\n\u3068\u3044\u3046\u6d41\u308c\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u3001\n\u3053\u308c\u3092\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3067\u547c\u3073\u51fa\u3055\u305a\u306b\u30c4\u30e9\u30c4\u30e9\u3068\u4e26\u3079\u305f\u3060\u3051\u3067\u306f\u3001\n\u4f55\u56de\u304b\u30eb\u30fc\u30d7\u304c\u56de\u3063\u305f\u3068\u3053\u308d\u3067\u6b62\u307e\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\u767a\u884c\u3057\u305f\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u524d\u5f8c\u3057\u3066\u3057\u307e\u3046\u306e\u3067\u3057\u3087\u3046\u304b\u306d?\n\n\u4eca\u65e5\u306f\u6e29\u304b\u30441\u65e5\u3067\u3057\u305f\u306d\u3001\u5ba4\u6e29\u304c21\u5ea6\u3042\u308a\u307e\u3057\u305f\u3002\n", "tags": ["Edison", "konashi", "IoT", "BLE"]}