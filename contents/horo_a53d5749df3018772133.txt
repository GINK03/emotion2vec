{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\nTheta\u306e360\u00b0\u753b\u50cf\u306b\u307c\u304b\u3057\u3092\u5165\u308c\u308bWeb\u30a2\u30d7\u30eaSphereBlur.com\u3092\u4f5c\u3063\u305f\u969b\u306b\u3001\u5143\u306eJPEG\u753b\u50cf\u304b\u3089\u53d6\u308a\u51fa\u3057\u305f\u59ff\u52e2\u60c5\u5831\u3092\u3001\u7de8\u96c6\u5f8c\u306b\u4fdd\u5b58\u3059\u308b\u969b\u306b\u4e00\u7dd2\u306b\u66f8\u304d\u8fbc\u3080\u5fc5\u8981\u304c\u3042\u3063\u305f\u3002(JPEG\u304b\u3089\u59ff\u52e2\u60c5\u5831\u3092\u53d6\u308a\u51fa\u3059\u65b9\u6cd5\u306b\u3064\u3044\u3066\u306f\u3053\u3061\u3089\u53c2\u7167)\n\n\u753b\u50cf\u304b\u3089JPEG\u30c7\u30fc\u30bf\u3078\u306e\u5909\u63db\u65b9\u6cd5\n\u30d6\u30e9\u30a6\u30b6\u306b\u7d44\u307f\u8fbc\u307e\u308c\u305fAPI\u3068\u3057\u3066\u3001Canvas\u30a8\u30ec\u30e1\u30f3\u30c8\u306e\nvar data = canvas.toDataURL('image/jpeg');\n\n\u3092\u547c\u3073\u51fa\u3059\u65b9\u6cd5\u304c\u3042\u308b\u3002\u3057\u304b\u3057\u3001\u3053\u306e\u65b9\u6cd5\u3060\u3068\u5f53\u7136\u30e1\u30bf\u30c7\u30fc\u30bf\u306f\u4fdd\u5b58\u3067\u304d\u306a\u3044\u3002\u3082\u3061\u308d\u3093\u3001\u3053\u306e\u30c7\u30fc\u30bf\u306e\u4e2d\u8eab\u306b\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u8ffd\u52a0\u3059\u308b\u3068\u3044\u3046\u3053\u3068\u306f\u53ef\u80fd\u3060\u304c\u3001\u3044\u308d\u3044\u308d\u8abf\u3079\u3066\u307f\u308b\u3068\u3001toDataURL()\u306b\u983c\u3089\u305a\u306b\u3001JavaScript\u3060\u3051\u3067JPEG\u30c7\u30fc\u30bf\u306b\u5909\u63db\u3059\u308bJPEGEncoder\u3068\u3044\u3046\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u898b\u3064\u3051\u305f\u306e\u3067\u3001\u305d\u3061\u3089\u3092\u4f7f\u3063\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u305f\u3002\n\nJPEGEncoder\u306e\u6539\u9020\nJPEGEncoder\u81ea\u4f53\u306b\u306f\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u4ed8\u4e0e\u3059\u308b\u6a5f\u80fd\u306f\u306a\u3044\u306e\u3067\u3001\u5c11\u3057\u6539\u9020\u3059\u308b\u3002JPEGEncoder.encode()\u30e1\u30bd\u30c3\u30c9\u3092\u8aad\u3093\u3067\u3044\u304f\u3068\u3001\n\njpeg_encoder_basic.js\n        this.encode = function(image,quality,toRaw) // image data object\n        {\n            var time_start = new Date().getTime();\n\n            if(quality) setQuality(quality);\n\n            // Initialize bit writer\n            byteout = new Array();\n            bytenew=0;\n            bytepos=7;\n\n            // Add JPEG headers\n            writeWord(0xFFD8); // SOI\n            writeAPP0();\n            writeDQT();\n            writeSOF0(image.width,image.height);\n            writeDHT();\n            writeSOS();\n\n            // \u5f8c\u7565\n        }\n\n\n\u3068\u3001\u3044\u304b\u306b\u3082JPEG\u306e\u30d8\u30c3\u30c0\u30fc\u3092\u66f8\u304d\u8fbc\u3093\u3067\u308b\u90e8\u5206\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306b\u3001image.xmp\u304c\u3042\u308b\u5834\u5408\u306fXMP\u306eAPP1\u30d8\u30c3\u30c0\u30fc\u3092\u66f8\u304d\u8fbc\u3080\u3088\u3046\u306b\u5909\u66f4\u3059\u308b\u3002EXIF\u306b\u95a2\u3057\u3066\u3082\u540c\u69d8\u306e\u6539\u9020\u3092\u3059\u308c\u3070\u5bfe\u5fdc\u3067\u304d\u308b\u304c\u3001\u4eca\u56de\u306fEXIF\u306b\u306f\u5bfe\u5fdc\u3057\u3066\u306a\u3044\u3002\n\njpeg_encoder_basic.js\n        this.encode = function(image,quality,toRaw) // image data object\n        {\n            var time_start = new Date().getTime();\n\n            if(quality) setQuality(quality);\n\n            // Initialize bit writer\n            byteout = new Array();\n            bytenew=0;\n            bytepos=7;\n\n            // Add JPEG headers\n            writeWord(0xFFD8); // SOI\n            writeAPP0();\n            if (image.xmp) {\n              var xap = \"http://ns.adobe.com/xap/1.0/\\0\";\n              writeWord(0xFFE1); // marker of APP1\n              writeWord(image.xmp.length + xap.length + 3);\n              for (var i=0; i<xap.length; i++) {\n                  writeByte(xap.charCodeAt(i));\n              }\n              for (var i=0; i<image.xmp.length; i++) {\n                  writeByte(image.xmp.charCodeAt(i));\n              }\n              writeByte(0);\n            }\n            writeDQT();\n            writeSOF0(image.width,image.height);\n            writeDHT();\n            writeSOS();\n            // \u5f8c\u7565\n        }\n\n\n\nWebGL\u306e\u30d5\u30ec\u30fc\u30e0\u30d0\u30c3\u30d5\u30a1\u30fc\u304b\u3089\u30d4\u30af\u30bb\u30eb\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\nWebGL\u306e\u30d5\u30ec\u30fc\u30e0\u30d0\u30c3\u30d5\u30a1\u30fc\u304b\u3089\u30d4\u30af\u30bb\u30eb\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u3059\u308b\u306b\u306f\u3001gl.readPixels()\u3092\u4f7f\u3046\u3002\n  _getBufferPixelsForSave: function() {\n    var pixels = new Uint8Array(this._frameBufferForEdit0.width * this._frameBufferForEdit0.height * 4);\n    this._gl.bindFramebuffer(this._gl.FRAMEBUFFER, this._frameBufferForEdit0.f);\n    this._gl.readPixels(0, 0, this._frameBufferForEdit0.width, this._frameBufferForEdit0.height, this._gl.RGBA, this._gl.UNSIGNED_BYTE, pixels);\n    this._gl.bindFramebuffer(this._gl.FRAMEBUFFER, null);\n    return pixels;\n  },\n\n\nXMP\u30e1\u30bf\u30c7\u30fc\u30bf\u306e\u4f5c\u6210\nXMP\u306e\u4ed5\u69d8\u304a\u3088\u3073\u3001Photo Sphere XMP Metadata\u306e\u4ed5\u69d8\u306b\u5f93\u3063\u3066\u4e0b\u8a18\u306e\u3088\u3046\u306aXML\u306e\u6587\u5b57\u5217\u3092\u4f5c\u6210\u3059\u308b\u3002\n  _createXMP: function() {\n    var w = this._frameBufferForEdit0.width;\n    var h = this._frameBufferForEdit0.height;\n    var heading = 0;\n    var pitch = 0;\n    var roll = 0;\n    if (this._poseInfo) {\n      heading = this._poseInfo.heading;\n      pitch = this._poseInfo.pitch;\n      roll = this._poseInfo.roll;\n    }\n    var xmp =\n      '<?xpacket begin=\"\u00ef\u00bb\u00bf\" id=\"W5M0MpCehiHzreSzNTczkc9d\"?>' +\n      '<x:xmpmeta xmlns:x=\"adobe:ns:meta/\" xmptk=\"Sphere Blur\">' +\n        '<rdf:RDF xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\">' +\n          '<rdf:Description rdf:about=\"\" xmlns:GPano=\"http://ns.google.com/photos/1.0/panorama/\">' +\n          '<GPano:ProjectionType>equirectangular</GPano:ProjectionType>' +\n          '<GPano:UsePanoramaViewer>True</GPano:UsePanoramaViewer>' +\n          '<GPano:CroppedAreaImageWidthPixels>' + w + '</GPano:CroppedAreaImageWidthPixels>' +\n          '<GPano:CroppedAreaImageHeightPixels>' + h + '</GPano:CroppedAreaImageHeightPixels>' +\n          '<GPano:FullPanoWidthPixels>' + w + '</GPano:FullPanoWidthPixels>' +\n          '<GPano:FullPanoHeightPixels>' + h + '</GPano:FullPanoHeightPixels>' +\n          '<GPano:CroppedAreaLeftPixels>0</GPano:CroppedAreaLeftPixels>' +\n          '<GPano:CroppedAreaTopPixels>0</GPano:CroppedAreaTopPixels>' +\n          '<GPano:PoseHeadingDegrees>' + heading + '</GPano:PoseHeadingDegrees>' +\n          '<GPano:PosePitchDegrees>' + pitch + '</GPano:PosePitchDegrees>' +\n          '<GPano:PoseRollDegrees>' + roll + '</GPano:PoseRollDegrees>' +\n          '</rdf:Description>' +\n        '</rdf:RDF>' +\n      '</x:xmpmeta>' +\n      '<?xpacket end=\"r\"?>';\n    return xmp;\n  },\n\n\nJPEG\u30d5\u30a1\u30a4\u30eb\u306e\u4fdd\u5b58\n\u3042\u3068\u306f\u3001JPEGEncoder\u3092\u4f7f\u3063\u3066\u5b9f\u969b\u306b\u30d4\u30af\u30bb\u30eb\u30c7\u30fc\u30bf\u304b\u3089XMP\u4ed8\u304d\u306eJPEG\u30c7\u30fc\u30bf\u306e\u30c7\u30fc\u30bfURL\u3092\u4f5c\u3063\u3066\u3001A\u30bf\u30b0\u30a8\u30ec\u30e1\u30f3\u30c8\u3092\u4f5c\u3063\u3066a.download\u3092\u6307\u5b9a\u3057\u3066a.click()\u3092\u547c\u3079\u3070\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n  save: function() {\n    var pixels = this._getBufferPixelsForSave();\n    var jpegEnc = new JPEGEncoder();\n    var jpegUri = jpegEnc.encode({\n      width: this._frameBufferForEdit0.width,\n      height: this._frameBufferForEdit0.height,\n      data: pixels,\n      xmp: this._createXMP()\n    }, 70);\n    var a = document.createElement('a');\n    a.href = jpegUri;\n    document.body.appendChild(a);\n    a.download = \"image.jpg\";\n    a.click();\n    document.body.removeChild(a);\n  },\n\n#\u306f\u3058\u3081\u306b\nTheta\u306e360\u00b0\u753b\u50cf\u306b\u307c\u304b\u3057\u3092\u5165\u308c\u308bWeb\u30a2\u30d7\u30ea[SphereBlur.com](https://sphereblur.com)\u3092[\u4f5c\u3063\u305f](http://qiita.com/horo/items/abb8bf40c23b21ce6e5b)\u969b\u306b\u3001\u5143\u306eJPEG\u753b\u50cf\u304b\u3089\u53d6\u308a\u51fa\u3057\u305f\u59ff\u52e2\u60c5\u5831\u3092\u3001\u7de8\u96c6\u5f8c\u306b\u4fdd\u5b58\u3059\u308b\u969b\u306b\u4e00\u7dd2\u306b\u66f8\u304d\u8fbc\u3080\u5fc5\u8981\u304c\u3042\u3063\u305f\u3002(JPEG\u304b\u3089\u59ff\u52e2\u60c5\u5831\u3092\u53d6\u308a\u51fa\u3059\u65b9\u6cd5\u306b\u3064\u3044\u3066\u306f[\u3053\u3061\u3089](http://qiita.com/horo/items/895a838bac2d9e762c88)\u53c2\u7167)\n\n#\u753b\u50cf\u304b\u3089JPEG\u30c7\u30fc\u30bf\u3078\u306e\u5909\u63db\u65b9\u6cd5\n\u30d6\u30e9\u30a6\u30b6\u306b\u7d44\u307f\u8fbc\u307e\u308c\u305fAPI\u3068\u3057\u3066\u3001Canvas\u30a8\u30ec\u30e1\u30f3\u30c8\u306e\n\n```js\nvar data = canvas.toDataURL('image/jpeg');\n```\n\n\u3092\u547c\u3073\u51fa\u3059\u65b9\u6cd5\u304c\u3042\u308b\u3002\u3057\u304b\u3057\u3001\u3053\u306e\u65b9\u6cd5\u3060\u3068\u5f53\u7136\u30e1\u30bf\u30c7\u30fc\u30bf\u306f\u4fdd\u5b58\u3067\u304d\u306a\u3044\u3002\u3082\u3061\u308d\u3093\u3001\u3053\u306e\u30c7\u30fc\u30bf\u306e\u4e2d\u8eab\u306b\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u8ffd\u52a0\u3059\u308b\u3068\u3044\u3046\u3053\u3068\u306f\u53ef\u80fd\u3060\u304c\u3001\u3044\u308d\u3044\u308d\u8abf\u3079\u3066\u307f\u308b\u3068\u3001toDataURL()\u306b\u983c\u3089\u305a\u306b\u3001JavaScript\u3060\u3051\u3067JPEG\u30c7\u30fc\u30bf\u306b\u5909\u63db\u3059\u308b[JPEGEncoder](https://github.com/owencm/javascript-jpeg-encoder)\u3068\u3044\u3046\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u898b\u3064\u3051\u305f\u306e\u3067\u3001\u305d\u3061\u3089\u3092\u4f7f\u3063\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u305f\u3002\n\n#JPEGEncoder\u306e\u6539\u9020\nJPEGEncoder\u81ea\u4f53\u306b\u306f\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u4ed8\u4e0e\u3059\u308b\u6a5f\u80fd\u306f\u306a\u3044\u306e\u3067\u3001\u5c11\u3057\u6539\u9020\u3059\u308b\u3002JPEGEncoder.encode()\u30e1\u30bd\u30c3\u30c9\u3092\u8aad\u3093\u3067\u3044\u304f\u3068\u3001\n\n```js:jpeg_encoder_basic.js\n        this.encode = function(image,quality,toRaw) // image data object\n        {\n            var time_start = new Date().getTime();\n\n            if(quality) setQuality(quality);\n\n            // Initialize bit writer\n            byteout = new Array();\n            bytenew=0;\n            bytepos=7;\n\n            // Add JPEG headers\n            writeWord(0xFFD8); // SOI\n            writeAPP0();\n            writeDQT();\n            writeSOF0(image.width,image.height);\n            writeDHT();\n            writeSOS();\n\n            // \u5f8c\u7565\n        }\n```\n\n\u3068\u3001\u3044\u304b\u306b\u3082JPEG\u306e\u30d8\u30c3\u30c0\u30fc\u3092\u66f8\u304d\u8fbc\u3093\u3067\u308b\u90e8\u5206\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306b\u3001image.xmp\u304c\u3042\u308b\u5834\u5408\u306fXMP\u306eAPP1\u30d8\u30c3\u30c0\u30fc\u3092\u66f8\u304d\u8fbc\u3080\u3088\u3046\u306b\u5909\u66f4\u3059\u308b\u3002EXIF\u306b\u95a2\u3057\u3066\u3082\u540c\u69d8\u306e\u6539\u9020\u3092\u3059\u308c\u3070\u5bfe\u5fdc\u3067\u304d\u308b\u304c\u3001\u4eca\u56de\u306fEXIF\u306b\u306f\u5bfe\u5fdc\u3057\u3066\u306a\u3044\u3002\n\n```js:jpeg_encoder_basic.js\n        this.encode = function(image,quality,toRaw) // image data object\n        {\n            var time_start = new Date().getTime();\n\n            if(quality) setQuality(quality);\n\n            // Initialize bit writer\n            byteout = new Array();\n            bytenew=0;\n            bytepos=7;\n\n            // Add JPEG headers\n            writeWord(0xFFD8); // SOI\n            writeAPP0();\n            if (image.xmp) {\n              var xap = \"http://ns.adobe.com/xap/1.0/\\0\";\n              writeWord(0xFFE1); // marker of APP1\n              writeWord(image.xmp.length + xap.length + 3);\n              for (var i=0; i<xap.length; i++) {\n                  writeByte(xap.charCodeAt(i));\n              }\n              for (var i=0; i<image.xmp.length; i++) {\n                  writeByte(image.xmp.charCodeAt(i));\n              }\n              writeByte(0);\n            }\n            writeDQT();\n            writeSOF0(image.width,image.height);\n            writeDHT();\n            writeSOS();\n            // \u5f8c\u7565\n        }\n```\n\n#WebGL\u306e\u30d5\u30ec\u30fc\u30e0\u30d0\u30c3\u30d5\u30a1\u30fc\u304b\u3089\u30d4\u30af\u30bb\u30eb\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\nWebGL\u306e\u30d5\u30ec\u30fc\u30e0\u30d0\u30c3\u30d5\u30a1\u30fc\u304b\u3089\u30d4\u30af\u30bb\u30eb\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u3059\u308b\u306b\u306f\u3001gl.readPixels()\u3092\u4f7f\u3046\u3002\n\n```js\n  _getBufferPixelsForSave: function() {\n    var pixels = new Uint8Array(this._frameBufferForEdit0.width * this._frameBufferForEdit0.height * 4);\n    this._gl.bindFramebuffer(this._gl.FRAMEBUFFER, this._frameBufferForEdit0.f);\n    this._gl.readPixels(0, 0, this._frameBufferForEdit0.width, this._frameBufferForEdit0.height, this._gl.RGBA, this._gl.UNSIGNED_BYTE, pixels);\n    this._gl.bindFramebuffer(this._gl.FRAMEBUFFER, null);\n    return pixels;\n  },\n```\n\n#XMP\u30e1\u30bf\u30c7\u30fc\u30bf\u306e\u4f5c\u6210\n[XMP\u306e\u4ed5\u69d8](http://www.adobe.com/devnet/xmp.html)\u304a\u3088\u3073\u3001[Photo Sphere XMP Metadata\u306e\u4ed5\u69d8](https://developers.google.com/streetview/spherical-metadata)\u306b\u5f93\u3063\u3066\u4e0b\u8a18\u306e\u3088\u3046\u306aXML\u306e\u6587\u5b57\u5217\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n\n```js\n  _createXMP: function() {\n    var w = this._frameBufferForEdit0.width;\n    var h = this._frameBufferForEdit0.height;\n    var heading = 0;\n    var pitch = 0;\n    var roll = 0;\n    if (this._poseInfo) {\n      heading = this._poseInfo.heading;\n      pitch = this._poseInfo.pitch;\n      roll = this._poseInfo.roll;\n    }\n    var xmp =\n      '<?xpacket begin=\"\u00ef\u00bb\u00bf\" id=\"W5M0MpCehiHzreSzNTczkc9d\"?>' +\n      '<x:xmpmeta xmlns:x=\"adobe:ns:meta/\" xmptk=\"Sphere Blur\">' +\n        '<rdf:RDF xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\">' +\n          '<rdf:Description rdf:about=\"\" xmlns:GPano=\"http://ns.google.com/photos/1.0/panorama/\">' +\n          '<GPano:ProjectionType>equirectangular</GPano:ProjectionType>' +\n          '<GPano:UsePanoramaViewer>True</GPano:UsePanoramaViewer>' +\n          '<GPano:CroppedAreaImageWidthPixels>' + w + '</GPano:CroppedAreaImageWidthPixels>' +\n          '<GPano:CroppedAreaImageHeightPixels>' + h + '</GPano:CroppedAreaImageHeightPixels>' +\n          '<GPano:FullPanoWidthPixels>' + w + '</GPano:FullPanoWidthPixels>' +\n          '<GPano:FullPanoHeightPixels>' + h + '</GPano:FullPanoHeightPixels>' +\n          '<GPano:CroppedAreaLeftPixels>0</GPano:CroppedAreaLeftPixels>' +\n          '<GPano:CroppedAreaTopPixels>0</GPano:CroppedAreaTopPixels>' +\n          '<GPano:PoseHeadingDegrees>' + heading + '</GPano:PoseHeadingDegrees>' +\n          '<GPano:PosePitchDegrees>' + pitch + '</GPano:PosePitchDegrees>' +\n          '<GPano:PoseRollDegrees>' + roll + '</GPano:PoseRollDegrees>' +\n          '</rdf:Description>' +\n        '</rdf:RDF>' +\n      '</x:xmpmeta>' +\n      '<?xpacket end=\"r\"?>';\n    return xmp;\n  },\n```\n\n#JPEG\u30d5\u30a1\u30a4\u30eb\u306e\u4fdd\u5b58\n\u3042\u3068\u306f\u3001JPEGEncoder\u3092\u4f7f\u3063\u3066\u5b9f\u969b\u306b\u30d4\u30af\u30bb\u30eb\u30c7\u30fc\u30bf\u304b\u3089XMP\u4ed8\u304d\u306eJPEG\u30c7\u30fc\u30bf\u306e\u30c7\u30fc\u30bfURL\u3092\u4f5c\u3063\u3066\u3001A\u30bf\u30b0\u30a8\u30ec\u30e1\u30f3\u30c8\u3092\u4f5c\u3063\u3066a.download\u3092\u6307\u5b9a\u3057\u3066a.click()\u3092\u547c\u3079\u3070\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n```js\n  save: function() {\n    var pixels = this._getBufferPixelsForSave();\n    var jpegEnc = new JPEGEncoder();\n    var jpegUri = jpegEnc.encode({\n      width: this._frameBufferForEdit0.width,\n      height: this._frameBufferForEdit0.height,\n      data: pixels,\n      xmp: this._createXMP()\n    }, 70);\n    var a = document.createElement('a');\n    a.href = jpegUri;\n    document.body.appendChild(a);\n    a.download = \"image.jpg\";\n    a.click();\n    document.body.removeChild(a);\n  },\n```\n", "tags": ["Theta", "JavaScript", "HTML5", "WebGL", "VR"]}