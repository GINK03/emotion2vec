{"tags": ["centos7", "nginx", "mariadb", "PHP7", "nextcloud"], "context": "\n\n\u306f\u3058\u3081\u306b\n\u3068\u308a\u3042\u3048\u305a\u7121\u6599\u306e\u30af\u30e9\u30a6\u30c9\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u30c7\u30fc\u30bf\u306e\u4e00\u5143\u5316\u3068\u5bb6\u65cf\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u7ba1\u7406\u3092\u3057\u305f\u3044\n\u5bb6\u65cf\u5206\u3082\u7d50\u5c40\u652f\u6255\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u30d0\u30e9\u30d0\u30e9\u306b\u8acb\u6c42\u304c\u304f\u308b\u3088\u308a\u3082\u7ba1\u7406\u3057\u3084\u3059\u3044\u3063\u3066\u3053\u3068\u3067\nNextcloud\u3092\u4f59\u3063\u3066\u308b\u53e4\u3044\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u69cb\u7bc9\u3057\u3066\u3042\u3068\u306f\u30e1\u30f3\u30c6\u3067\u5bff\u547d\u304c\u304d\u305f\u3089\u968f\u6642\u4ea4\u63db\u3067\u304d\u308b\u3088\u3046\u306b\u6e96\u5099\u3060\u3051\u306f\u3084\u3063\u3066\u304a\u3053\u3046\u304b\u306a\u3068\u3002\n\u69cb\u7bc9\u306e\u6d41\u308c\u3068\u3057\u3066\u306f\u8a70\u307e\u3063\u305f\u308a\u8e93\u3044\u305f\u308a\u3068\u8a66\u884c\u932f\u8aa4\u3057\u306a\u304c\u3089\u4f53\u5f53\u305f\u308a\u3067\u3084\u3063\u3066\u3044\u308b\u306e\u3067\n\u30c0\u30e9\u30c0\u30e9\u3068\u304f\u3060\u3089\u3093\u6587\u7ae0\u306b\u4ed5\u4e0a\u304c\u3063\u3066\u3044\u308b\u3051\u308c\u3069\u3001\u90e8\u5206\u7684\u306b\u30e1\u30e2\u3063\u3066\u3082\u5fd8\u308c\u305d\u3046\u306b\u306a\u308b\u304b\u3089\n\u57fa\u672c\u8aad\u307f\u98db\u3070\u3057\u3066\u3001\u5fd8\u308c\u305f\u3068\u304d\u306b\u8aad\u307f\u8fd4\u305b\u308b\u3088\u3046\u306a\u7c21\u6613\u30e1\u30e2\u7684\u306a\u4f55\u304b\n\n\u69cb\u7bc9\u74b0\u5883\nCentOS7\nPHP 7.1\nnginx 1.11\nMariaDB 10.1\nnextcloud 11\n\nPHP\n\nconsole\nEPEL\u30ea\u30dd\u30b8\u30c8\u30ea\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo yum install epel-release\nPHP\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo rpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-7.rpm\n$ sudo yum install --enablerepo remi-php71 php-fpm php-gd php-json php-mysql php-curl php-mbstring php-intl php-mcrypt php-imagick php-xml php-zip php-apcu\n\n\u30b5\u30fc\u30d3\u30b9\u6709\u52b9\u5316\n$ sudo systemctl enable php-fpm\n$ sudo systemctl start php-fpm\n\n\u30d1\u30b9\u306e\u78ba\u8a8d(PHP-fpm\u306eenv[PATH]\u306b\u4f7f\u7528)\n$ printenv PATH\n/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/testuser/.local/bin:/home/testuser/bin\n\n\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\n$ sudo chown -R nginx:nginx /var/lib/php/session\n\nPHP-fpm\u306e\u8a2d\u5b9a\n$ sudo vi /etc/php-fpm.d/www.conf\n\n\n\nwww.conf\nuser = nginx\ngroup = nginx\nlisten = /var/run/php-fpm/php-fpm.sock\nlisten.owner = nginx\nlisten.group = nginx\nlisten.mode = 0666\n\nenv[HOSTNAME] = $HOSTNAME\nenv[PATH] = /usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/testuser/.local/bin:/home/testuser/bin\nenv[TMP] = /tmp\nenv[TMPDIR] = /tmp\nenv[TEMP] = /tmp\n\n\n\nconsole\n\u30b5\u30fc\u30d3\u30b9\u6709\u52b9\u5316\n$ sudo systemctl restart php-fpm\n\n\n\nMariaDB\n\nconsole\n$ sudo vi /etc/yum.repos.d/MariaDB.repo\n\n\n\nMariaDB.repo\n[mariadb]\nname = MariaDB\nbaseurl = http://yum.mariadb.org/10.1/centos7-amd64\ngpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB\ngpgcheck=1\n\n\n\nconsole\n$ sudo yum install mariadb-server\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n$ rpm -qa | grep -i mariadb\nMariaDB-server-10.1.21-1.el7.centos.x86_64\nMariaDB-common-10.1.21-1.el7.centos.x86_64\nMariaDB-client-10.1.21-1.el7.centos.x86_64\nMariaDB-shared-10.1.21-1.el7.centos.x86_64\n\nMySQL\u306e4\u30d0\u30a4\u30c8\u30b5\u30dd\u30fc\u30c8\u3092\u6709\u52b9\n$ sudo vi /etc/my.cnf.d/server.cnf\n\n\n\nserver.cnf\n[mysqld]\ninnodb_large_prefix=on\ninnodb_file_format=barracuda\ninnodb_file_per_table=true\n\n\n\nconsole\nmariadb\u8d77\u52d5\n$ sudo systemctl enable mariadb\n$ sudo systemctl start mariadb\n\nmariaDB\u521d\u671f\u8a2d\u5b9a\n$ sudo mysql_secure_installation\n# Enter\u3092\u62bc\u3059\nEnter current password for root (enter for none):\n# root\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u8a2d\u5b9a\u3059\u308b\u304b\uff1f [y]\u3092\u9078\u629e\nSet root password? [Y/n] y\n# root\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u529b\nNew password:\n# root\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u518d\u5165\u529b\nRe-enter new password:\n# \u533f\u540d\u30e6\u30fc\u30b6\u30fc\u3092\u524a\u9664\u3059\u308b\u304b\uff1f [y]\u3092\u9078\u629e\nRemove anonymous users? [Y/n] y\n# root\u30e6\u30fc\u30b6\u30fc\u306e\u30ea\u30e2\u30fc\u30c8\u30ed\u30b0\u30a4\u30f3\u3092\u30d6\u30ed\u30c3\u30af\u3059\u308b\u304b\uff1f [y]\u3092\u9078\u629e\nDisallow root login remotely? [Y/n] y\n# \u30c6\u30b9\u30c8DB\u3092\u524a\u9664\u3059\u308b\u304b\uff1f [y]\u3092\u9078\u629e\nRemove test database and access to it? [Y/n] y\n# \u30e6\u30fc\u30b6\u6a29\u9650\u30c6\u30fc\u30d6\u30eb\u3092\u30ea\u30ed\u30fc\u30c9\u3059\u308b\u304b\uff1f [y]\u3092\u9078\u629e\nReload privilege tables now? [Y/n] y\n\nmariaDB\u306b\u30ed\u30b0\u30a4\u30f3\n$ mysql -u root -p\n\n\n\nconsole\nMariaDB [(none)]> CREATE USER 'username'@'localhost' IDENTIFIED BY 'password';\nQuery OK, 0 rows affected (0.00 sec)\n\nMariaDB [(none)]> CREATE DATABASE IF NOT EXISTS nextcloud;\nQuery OK, 1 row affected (0.00 sec)\n\nMariaDB [(none)]> GRANT ALL PRIVILEGES ON nextcloud.* TO 'username'@'localhost' IDENTIFIED BY 'password';\nQuery OK, 0 rows affected (0.00 sec)\n\nMariaDB [(none)]> quit\nBye\n-------------------------------------------\nCREATE DATABASE nextcloud CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;\nGRANT ALL ON nextcloud.* TO username@\u2018%\u2019 IDENTIFIED BY \u2018password\u2019;\n\nCREATE USER 'username'@'localhost' IDENTIFIED BY 'password';\nCREATE DATABASE IF NOT EXISTS nextcloud;\nGRANT ALL PRIVILEGES ON nextcloud.* TO 'username'@'localhost' IDENTIFIED BY 'password';\n\n\n\n\nSSL\n\u3044\u308d\u3044\u308d\u53c2\u8003\n\u3068\u308a\u3042\u3048\u305a\u30c9\u30e1\u30a4\u30f3\u53d6\u5f97\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u81ea\u5df1\u7f72\u540d\u3067\u52d5\u4f5c\u78ba\u8a8d\n\nconsole\n\u81ea\u5df1\u7f72\u540d\u8a3c\u660e\u66f8\u4f5c\u6210(nginx\u306e\u8a2d\u5b9a\u3000ssl_certificate / ssl_certificate_key)\n\u30c9\u30e1\u30a4\u30f3\u53d6\u5f97\u3057\u3066\u3044\u306a\u3044\u70ba\n$ sudo openssl req -x509 -nodes -days 3650 -newkey rsa:2048 -subj /CN=localhost -keyout /etc/ssl/server.key -out /etc/ssl/server.crt\n\nDH\u9375\u306e\u5909\u66f4openSSL\u3067\u4f5c\u6210(nginx\u306e\u8a2d\u5b9a\u3000ssl_dhparam)\n$ sudo openssl dhparam -out /etc/ssl/dhparam.pem 2048\n\nDNS\u30b5\u30fc\u30d0\u306e\u78ba\u8a8d(nginx\u306e\u8a2d\u5b9a\u3000resolver)\n$ cat /etc/resolv.conf\nsearch myvps.jp\nnameserver 163.44.76.148\nnameserver 157.7.180.133\n\n\n\nnginx\n\nconsole\n$ sudo vi /etc/yum.repos.d/nginx.repo\n\n\n\nnginx.repo\n[nginx]\nname=nginx repo\nbaseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/\ngpgcheck=0\nenabled=1\n\n\n\nconsole\n$ sudo yum install nginx\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n$ nginx -v\nnginx version: nginx/1.11.10\n\nnginx\u8a2d\u5b9a\n$ sudo /etc/nginx/conf.d/default.conf\n\n\n\u3053\u3053\u306f\u305d\u308c\u305e\u308c\u306a\u306e\u3067\u7c21\u5358\u306b\u6d41\u3057\u3066\n\ndefault.conf\nupstream php-handler {\n    /var/run/php-fpm/php-fpm.sock;\n}\n\nserver {\n    listen 80 ;\n    listen [::]:80;\n    server_name localhost;\n    return 301 https://$server_name$request_uri;\n}\n\nserver {\n    listen 443 ssl http2 default_server;\n    listen [::]:443 ssl http2 default_server;\n    server_name localhost;\n\n    ssl_certificate /etc/ssl/server.crt;  #\u8a3c\u660e\u66f8\u3068\u4e2d\u9593\u8a3c\u660e\u66f8\u3092\u7d50\u5408\u3057\u305f\u30d5\u30a1\u30a4\u30eb\n    ssl_certificate_key /etc/ssl/server.key;  #\u79d8\u5bc6\u9375\n    #ssl_trusted_certificate ;  #\u30eb\u30fc\u30c8CA\u8a3c\u660e\u66f8\u3068\u4e2d\u9593\u8a3c\u660e\u66f8\u3092\u7d50\u5408\u3057\u305f\u30d5\u30a1\u30a4\u30eb\n    resolver 163.44.76.148 157.7.180.133; #OCSP Responder\u306e\u540d\u524d\u89e3\u6c7a\u306b\u4f7f\u3046DNS\u3002\u30b5\u30fc\u30d0\u30fc\u4e0a\u4f4d\u306eDNS\u30b5\u30fc\u30d0\u30fc\u3092\u53c2\u7167\n    ssl_dhparam /etc/ssl/dhparam.pem;   #DH\u9375\u306e\u5909\u66f4openSSL\u3067\u4f5c\u6210\n\n    ssl_session_timeout 1d;\n    ssl_session_cache shared:SSL:50m;\n    ssl_session_tickets off;\n    ssl_protocols TLSv1.2;\n    ssl_ciphers 'ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS';\n    ssl_prefer_server_ciphers on;\n    ssl_stapling on;\n    ssl_stapling_verify on;\n    # verify chain of trust of OCSP response using Root CA and Intermediate certs\n\n    add_header Strict-Transport-Security \"max-age=15768000;includeSubDomains; preload;\";\n    add_header X-Content-Type-Options nosniff;\n    add_header X-Frame-Options \"SAMEORIGIN\";\n    add_header X-XSS-Protection \"1; mode=block\";\n    add_header X-Robots-Tag none;\n    add_header X-Download-Options noopen;\n    add_header X-Permitted-Cross-Domain-Policies none;\n\n    root /usr/share/nginx/html/nextcloud;\n\n    location = /robots.txt {\n        allow all;\n        log_not_found off;\n        access_log off;\n    }\n\n    location = /.well-known/carddav {\n      return 301 $scheme://$host/remote.php/dav;\n    }\n    location = /.well-known/caldav {\n      return 301 $scheme://$host/remote.php/dav;\n    }\n\n    client_max_body_size 2000M;\n    fastcgi_buffers 64 4K;\n\n    gzip off;\n\n    error_page 403 /core/templates/403.php;\n    error_page 404 /core/templates/404.php;\n\n    location / {\n        rewrite ^ /index.php$uri;\n    }\n\n    location ~ ^/(?:build|tests|config|lib|3rdparty|templates|data)/ {\n        deny all;\n    }\n    location ~ ^/(?:\\.|autotest|occ|issue|indie|db_|console) {\n        deny all;\n    }\n\n    location ~ ^/(?:index|remote|public|cron|core/ajax/update|status|ocs/v[12]|updater/.+|ocs-provider/.+|core/templates/40[34])\\.php(?:$|/) {\n        include fastcgi_params;\n        fastcgi_split_path_info ^(.+\\.php)(/.*)$;\n        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n        fastcgi_param PATH_INFO $fastcgi_path_info;\n        fastcgi_param HTTPS on;\n        fastcgi_param modHeadersAvailable true;\n        fastcgi_param front_controller_active true;\n        fastcgi_pass php-handler;\n        fastcgi_intercept_errors on;\n        fastcgi_request_buffering off;\n    }\n\n    location ~ ^/(?:updater|ocs-provider)(?:$|/) {\n        try_files $uri/ =404;\n        index index.php;\n    }\n\n    location ~* \\.(?:css|js|woff|svg|gif)$ {\n        try_files $uri /index.php$uri$is_args$args;\n        add_header Cache-Control \"public, max-age=7200\";\n        add_header X-Content-Type-Options nosniff;\n        add_header X-Frame-Options \"SAMEORIGIN\";\n        add_header X-XSS-Protection \"1; mode=block\";\n        add_header X-Robots-Tag none;\n        add_header X-Download-Options noopen;\n        add_header X-Permitted-Cross-Domain-Policies none;\n        access_log off;\n    }\n\n    location ~* \\.(?:png|html|ttf|ico|jpg|jpeg)$ {\n        try_files $uri /index.php$uri$is_args$args;\n        access_log off;\n    }\n}\n\n\n\nconsole\nnginx\u8d77\u52d5\n$ sudo systemctl enable nginx\n$ sudo systemctl start nginx\n\n\n\nnextcloud\n\nconsole\n$ sudo yum install wget\n$ sudo wget https://download.nextcloud.com/server/releases/nextcloud-11.0.1.tar.bz2\n$ sudo wget https://download.nextcloud.com/server/releases/nextcloud-11.0.1.tar.bz2.sha256\n$ sudo wget https://download.nextcloud.com/server/releases/nextcloud-11.0.1.tar.bz2.asc\nNextcloud\u306eGPG\u516c\u958b\u9375\n$ sudo wget https://nextcloud.com/nextcloud.asc\n\nSHA256\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\n$ sudo sha256sum -c nextcloud-11.0.1.tar.bz2.sha256 < nextcloud-11.0.1.tar.bz2\n\nGPG Signature\n$ sudo gpg --import nextcloud.asc\n$ sudo gpg --verify nextcloud-11.0.1.tar.bz2.asc nextcloud-11.0.1.tar.bz2\ngpg: 2017\u5e7401\u670816\u65e5 01\u664207\u520642\u79d2 JST\u306bRSA\u9375ID A724937A\u3067\u65bd\u3055\u308c\u305f\u7f72\u540d\ngpg: \"Nextcloud Security <security@nextcloud.com>\"\u304b\u3089\u306e\u6b63\u3057\u3044\u7f72\u540d\ngpg: *\u8b66\u544a*: \u3053\u306e\u9375\u306f\u4fe1\u7528\u3067\u304d\u308b\u7f72\u540d\u3067\u8a3c\u660e\u3055\u308c\u3066\u3044\u307e\u305b\u3093!\ngpg:       \u3053\u306e\u7f72\u540d\u304c\u6240\u6709\u8005\u306e\u3082\u306e\u304b\u3069\u3046\u304b\u306e\u691c\u8a3c\u624b\u6bb5\u304c\u3042\u308a\u307e\u305b\u3093\u3002\n\u4e3b\u9375\u306e\u30d5\u30a3\u30f3\u30ac\u30fc\u30fb\u30d7\u30ea\u30f3\u30c8: 2880 6A87 8AE4 23A2 8372  792E D758 99B9 A724 937A\n\n\u300cNextcloud Security <security@nextcloud.com>\"\u304b\u3089\u306e\u6b63\u3057\u3044\u7f72\u540d\u300d\u3068\u306a\u3063\u3066\u308b\u306e\u3067OK\u306e\u3088\u3046\u306a\u6c17\u304c\u3059\u308b\n\nnextcloud\u5c55\u958b\n$ sudo yum install bzip2\n$ sudo tar -xjf nextcloud-11.0.1.tar.bz2\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u306b\u30b3\u30d4\u30fc\n$ sudo cp -r nextcloud /usr/share/nginx/html/\n\n\u6240\u6709\u6a29\u306e\u5909\u66f4\n$ sudo chown -R nginx:nginx /usr/share/nginx/html/nextcloud\n\u30b7\u30a7\u30eb\u4f5c\u6210\n$ vi nextcloud.sh\n\n\n\nnextcloud.sh\n#!/bin/bash\nocpath='/usr/share/nginx/html/nextcloud'\nhtuser='nginx'\nhtgroup='nginx'\nrootuser='root'\n\nprintf \"Creating possible missing Directories\\n\"\nmkdir -p $ocpath/data\nmkdir -p $ocpath/updater\n\nprintf \"chmod Files and Directories\\n\"\nfind ${ocpath}/ -type f -print0 | xargs -0 chmod 0640\nfind ${ocpath}/ -type d -print0 | xargs -0 chmod 0750\n\nprintf \"chown Directories\\n\"\nchown -R ${rootuser}:${htgroup} ${ocpath}/\nchown -R ${htuser}:${htgroup} ${ocpath}/apps/\nchown -R ${htuser}:${htgroup} ${ocpath}/config/\nchown -R ${htuser}:${htgroup} ${ocpath}/data/\nchown -R ${htuser}:${htgroup} ${ocpath}/themes/\nchown -R ${htuser}:${htgroup} ${ocpath}/updater/\n\nchmod +x ${ocpath}/occ\n\n\n\nconsole\n\u5f37\u529b\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\nsudo sh nextcloud.sh\n\n\n\nfirewall\u306e\u8a2d\u5b9a\n\nconsole\n\u4f7f\u7528\u4e2d\u306efirewall\u78ba\u8a8d\n$ sudo firewall-cmd --list-all\npublic (active)\n  target: default\n  icmp-block-inversion: no\n  interfaces: eth0\n  sources:\n  services: dhcpv6-client ssh\n  ports:\n  protocols:\n  masquerade: no\n  forward-ports:\n  sourceports:\n  icmp-blocks:\n  rich rules:\n\nhttp\u306e\u7a74\u3042\u3051\n$ sudo firewall-cmd --permanent --zone=public --add-service=http\nsuccess\n\nhttps\u306e\u7a74\u3042\u3051\n$ sudo firewall-cmd --permanent --zone=public --add-service=https\nsuccess\n\n$ sudo firewall-cmd --reload\nsuccess\n\n\u5909\u66f4\u306e\u78ba\u8a8d\n$ sudo firewall-cmd --list-all\npublic (active)\n  target: default\n  icmp-block-inversion: no\n  interfaces: eth0\n  sources:\n  services: dhcpv6-client http https ssh\n  ports:\n  protocols:\n  masquerade: no\n  forward-ports:\n  sourceports:\n  icmp-blocks:\n  rich rules:\n\n\u518d\u8d77\u52d5\n$ sudo systemctl restart firewalld\n\n\n\nSELinux\u306e\u8a2d\u5b9a\n\u3044\u307e\u307e\u3067\u89e6\u3063\u305f\u3053\u3068\u306a\u3044\u306e\u3067\u3088\u304f\u77e5\u3089\u306a\u3044\u3051\u3069\u516c\u5f0f\u901a\u308a\u306b\u624b\u63a2\u308a\u3067\n\nconsole\nsemanage\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081\n$ sudo yum install policycoreutils-python\n\n$ sudo semanage fcontext -a -t httpd_sys_rw_content_t '/usr/share/nginx/html/nextcloud/data'\n$ sudo restorecon '/usr/share/nginx/html/nextcloud/data'\n$ sudo semanage fcontext -a -t httpd_sys_rw_content_t '/usr/share/nginx/html/nextcloud/config'\n$ sudo restorecon '/usr/share/nginx/html/nextcloud/config'\n$ sudo semanage fcontext -a -t httpd_sys_rw_content_t '/usr/share/nginx/html/nextcloud/apps'\n$ sudo restorecon '/usr/share/nginx/html/nextcloud/apps'\n\n\n\nWEB\u3078\u30a2\u30af\u30bb\u30b9\n\u3053\u3053\u3089\u3067WEB\u30da\u30fc\u30b8\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u3067\u3001WEB\u4e0a\u3067\u30e6\u30fc\u30b6\u30fc\u3068\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u8a2d\u5b9a\u3092\u304a\u3053\u306a\u3044\u521d\u671f\u8a2d\u5b9a\u3092\u5b8c\u4e86\u3059\u308b\n\u554f\u984c\u304c\u306a\u3051\u308c\u3070\u3042\u3068\u306f\u62e1\u5f35\u95a2\u4fc2\u306e\u8abf\u6574\n\nClamAV(\u30a2\u30f3\u30c1\u30a6\u30a4\u30eb\u30b9)\n\u3068\u308a\u3042\u3048\u305a\u516c\u5f0f\u901a\u308a\u306b\n\nconsole\n$ sudo yum install clamav clamav-scanner clamav-scanner-systemd clamav-serve clamav-server-systemd clamav-update\n\n$ sudo vi /etc/freshclam.conf\n\n$ sudo freshclam\n$ sudo vi /etc/clamd.d/scan.conf\n\n\n\nfreshclam.conf\n#Example            #Example\u306e\u30b3\u30e1\u30f3\u30c8\u5316\nUpdateLogFile /var/log/freshclam.log #\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u8a2d\u5b9a\nLogFileMaxSize 2M   #\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u8a2d\u5b9a\nLogTime yes         #\u30ed\u30b0\u306b\u6642\u9593\u3092\u8868\u793a\nLogRotate yes       #\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a\nDatabaseMirror db.jp.clamav.net     #\u30df\u30e9\u30fc\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u8a2d\u5b9a\nNotifyClamd /etc/clamd.d/scan.conf  #clamd@scan\u3078\u306e\u66f4\u65b0\u901a\u77e5\n\n\n\nconsole\n\u30a6\u30a4\u30eb\u30b9\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u6700\u65b0\u5316\n$ sudo freshclam\n$ sudo vi /etc/clamd.d/scan.conf\n\n\n\nfreshclam.conf\n#Example            #Example\u306e\u30b3\u30e1\u30f3\u30c8\u5316\nLogFile /var/log/clamd.scan  #\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u8a2d\u5b9a\nLogFileMaxSize 2M   #\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u8a2d\u5b9a\nLogTime yes         #\u30ed\u30b0\u306b\u6642\u9593\u3092\u8868\u793a\nLogRotate yes       #\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a\nLocalSocket /var/run/clamd.scan/clamd.sock #\u30ed\u30fc\u30ab\u30eb\u30bd\u30b1\u30c3\u30c8\u4f7f\u7528\u8a2d\u5b9a\nFixStaleSocket yes  #\u7570\u5e38\u7d42\u4e86\u6642\u306b\u30bd\u30b1\u30c3\u30c8\u3092\u524a\u9664\nExcludePath ^/proc/ #\u30b9\u30ad\u30e3\u30f3\u9664\u5916\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u8a2d\u5b9a\nExcludePath ^/sys/\nUser root           #\u5b9f\u884c\u30e6\u30fc\u30b6\u8a2d\u5b9a\n\n\n\nconsole\n\u8d77\u52d5\n$ sudo systemctl enable clamd@scan.service\n$ sudo systemctl start clamd@scan\n\nfiles_antivirus\u30a2\u30d7\u30ea\u53d6\u5f97\n$ sudo yum install unzip\n$ wget https://github.com/nextcloud/files_antivirus/archive/master.zip\n$ unzip master.zip\napp\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\n$ sudo cp -r files_antivirus-master /usr/share/nginx/htm\nl/nextcloud/apps\n\u5f37\u529b\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\nsudo sh nextcloud.sh\n\n\n\u3042\u3068\u306f\u516c\u5f0f\u306e\u30da\u30fc\u30b8\u306b\u3042\u308b\u3088\u3046\u306b\u30ed\u30b0\u30a4\u30f3\u5f8c\u3001Apps\u30da\u30fc\u30b8\u306b\u3066Antivirus\u3092\u6709\u52b9\u306b\u3059\u308b\u3068\u3067\u304d\u308b\u3089\u3057\u3044\n\u307e\u3041\u3067\u304d\u306a\u304b\u3063\u305f\u3093\u3060\u3051\u3069\u3001ClamAV\u5358\u4f53\u3067\u5b9a\u671f\u7684\u306b\u30b9\u30ad\u30e3\u30f3\u3055\u305b\u3066\u304a\u3051\u3070\u3044\u3063\u304b\u3002\n\n\u6697\u53f7\u5316\n\u7ba1\u7406\u30da\u30fc\u30b8\u5185\u306e\u6697\u53f7\u5316\u30da\u30fc\u30b8\u3067\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u3066\u304b\u3089\nApps\u30da\u30fc\u30b8\u306b\u3066Default encryption module\u3092\u6709\u52b9\u306b\u3059\u308b\n\u203b\u4e00\u56de\u5b9f\u884c\u3057\u305f\u3089\u5f8c\u623b\u308a\u306f\u3067\u304d\u306a\u3044\u306e\u3067\u6ce8\u610f\n\n\u30e1\u30e2\u30ea\u30ad\u30e3\u30c3\u30b7\u30e5\n\nconsole\n$ sudo vi /usr/share/nginx/html/nextcloud/config/config.php\n\n\n\nconfig.php\narray\u306e\u6700\u5f8c\u306b\u8ffd\u52a0\n'memcache.local' => '\\OC\\Memcache\\APCu',\n\n\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u30b5\u30a4\u30ba\u5909\u66f4\n\nconsole\n$ sudo vi /etc/php.ini\n\n\n\nphp.ini\nmemory_limit = 512M\nupload_max_filesize = 2000M\npost_max_size = 2000M\n\n\n\u5f37\u529b\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u3092\u3057\u3066\u3044\u308b\u3068WEB\u4e0a\u304b\u3089\u5909\u66f4\u3067\u304d\u306a\u3044\u306e\u3067.user.ini\u3092\u5909\u66f4\n\nconsole\n$ sudo vi /usr/share/nginx/html/nextcloud/.user.ini\n\n\n\n.user.ini\nupload_max_filesize=2000M\npost_max_size2000M\nmemory_limit = 512M\n\n\n\nandroid\u30a2\u30d7\u30ea\u3068\u306e\u9023\u643a\nversion1.4.1\n\u4f7f\u3044\u3053\u306a\u305b\u3066\u306a\u3044\u3060\u3051\u3060\u3068\u601d\u3046\u304c\u3001\u4e00\u5fdc\u4f7f\u3044\u52dd\u624b\u306b\u3064\u3044\u3066\u4e91\u3005\n\u305d\u306e\u3046\u3061\u4fbf\u5229\u306a\u4f7f\u3044\u65b9\u3092\u767a\u898b\u3059\u308b\u3053\u3068\u3092\u671f\u5f85\u3057\u3064\u3064\n\n\u65b0\u898f\u306e\u5199\u771f\u30fb\u52d5\u753b\u306e\u81ea\u52d5\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u53ef(\u4f46\u3057\u904e\u53bb\u306b\u64ae\u5f71\u3057\u305f\u3082\u306e\u306b\u3064\u3044\u3066\u306f\u624b\u52d5)\n\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u306e\u81ea\u52d5\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u4e0d\u53ef(\u624b\u52d5\u306f\u53ef)\n\u624b\u52d5\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306f\u81ea\u52d5\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306e\u3088\u3046\u306b\u5e74\u30fb\u6708\u30fb\u65e5\u306e\u30d5\u30a9\u30eb\u30c0\u3092\u4f5c\u6210\u3057\u306a\u3044\n\u91cd\u8907\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u3068\u30d5\u30a1\u30a4\u30eb\u540d\u3092(2)\u3092\u8ffd\u52a0\u3057\u3066\u8ee2\u9001\u3057\u3088\u3046\u3068\u3059\u308b\u304c\u30a8\u30e9\u30fc\u3068\u306a\u308b\n\u30bf\u30b0\u306e\u8a2d\u5b9a\u4e0d\u53ef(PC\u304b\u3089\u306f\u53ef)\n\u30bf\u30b0\u3067\u306e\u691c\u7d22\u4e0d\u53ef(PC\u304b\u3089\u306f\u53ef)\n\u30ae\u30e3\u30e9\u30ea\u30fc\u8868\u793a\u304c\u3067\u304d\u306a\u3044(PC\u306f\u53ef)\n\n\n\u30af\u30e9\u30a6\u30c9\u6bd4\u8f03\n\u4f59\u3063\u3066\u308b\u6a5f\u6750\u304c\u3042\u3063\u305f\u304b\u3089\u6d3b\u7528\u3057\u3088\u3046\u3068\u3057\u305f\u3051\u308c\u3069\u3001\u5b9f\u969b\u306b\u904b\u7528\u3059\u308b\u969b\u306e\u8cbb\u7528\u3092\u8003\u3048\u308b\u3068\u3069\u3046\u306a\u306e\u304b\u8003\u3048\u3069\u3053\u308d\u3067\u3059\u3002\n\u30b7\u30b9\u30a2\u30c9\u3067\u3042\u308b\u3088\u3046\u306a\u6545\u969c\u7387\u3068\u304b\u7a3c\u50cd\u7387\u3068\u304b\u7121\u8996\u3057\u3066\n\u6545\u969c\u3057\u305f\u6642\u3088\u3046\u306b\u3056\u3063\u304f\u308a\u6700\u5927\u8cbb\u7528\u3092\u8a08\u7b97\n3TB(\u305d\u3093\u306a\u306b\u4f7f\u308f\u306a\u3044\u3051\u3069\u3001\u4f59\u3063\u3066\u305f\u306e\u3067)\u306eHDD\u304c\u4eca4\u5e74\u4fdd\u8a3c\u30671.3\u4e07\u524d\u5f8c\u3060\u3063\u305f\u306e\u3067\nRAID6\u30674\u672c(\u4fdd\u8a3c\u671f\u9593\u5185\u306e\u6545\u969c\u306fHDD\u3092\u9001\u308b\u306e\u3067RAID\u306e\u65b9\u304c\u5fa9\u5143\u30ea\u30b9\u30af\u5b89\u5fc3\uff1f)\n13,000\u5186/48\u30ab\u6708*4\u672c\u2252 1,083\u5186\n\u3042\u3068\u306f\u7b50\u4f53\u53f0(\u30de\u30b6\u30fc\u30fb\u96fb\u6e90\u30fbCPU.etc)\u306b\u96fb\u6c17\u4ee3\u4e91\u3005\u3067\u67081.5\u5343\uff5e2\u5343\u5186\u3050\u3089\u3044\u304b\u306a\uff1f\n\u305d\u306e\u3050\u3089\u3044\u3067\u4ed6\u306e\u30af\u30e9\u30a6\u30c9\u30b5\u30fc\u30d3\u30b9\u3092\u691c\u8a0e\u3059\u308b\u3068\n\u3055\u304f\u3089VPS    200G        \u8907\u6570\u30e6\u30fc\u30b6\u30fc/\uffe51,706/\u6708\n\u3055\u304f\u3089VPS    100G        \u8907\u6570\u30e6\u30fc\u30b6\u30fc/\uffe5972/\u6708\nbox     \u5bb9\u91cf\u7121\u5236\u9650 1\u30e6\u30fc\u30b6\u30fc/\uffe51,800/\u6708\nDropbox 1 TB\u3000     1\u30e6\u30fc\u30b6\u30fc/\uffe51,000/\u6708\ngoogle  1 TB\u3000     1\u30e6\u30fc\u30b6\u30fc/\uffe51,300/\u6708\ngoogle  100 GB\u3000       1\u30e6\u30fc\u30b6\u30fc/\uffe5250/\u6708\n\u53e4\u3044\u5199\u771f\u3068\u304b\u8c4a\u5bcc\u3067\u500b\u4eba\u7684\u306a\u753b\u50cf\u3060\u3051\u3067\u3082200G\u8d85\u3048\n\u5bb6\u65cf\u5206\u306f\u5bb9\u91cf\u3069\u306e\u304f\u3089\u3044\u3067\u3044\u3064\u307e\u3067\u4f7f\u3046\u304b\u308f\u304b\u3089\u306a\u3044\u3051\u3069\u3001\n\u30af\u30e9\u30a6\u30c9\u30b5\u30fc\u30d3\u30b9\u306b\u983c\u308b\u3068\u3059\u308c\u3070\u4e0b\u8a18\u306e\u611f\u3058\u3067\uffe51,500/\u6708\u3068\u306a\u308b\n\u81ea\u8eab        Dropbox   1 TB\u3000\n\u5bb6\u65cf1\u5bb6\u65cf2 google   100 GB\n\u4ed6\u306fNAS\u306e\u7b50\u4f53\u304c\u300cDiskStation DS216j\u300d\u4fdd\u8a3c\u671f\u95932\u5e74\u306719,600\u5186\u306a\u306e\u3067\n19,600\u5186/24\u30ab\u6708\u2252816\u5186\n\u4e0a\u3068\u540c\u3058HDD2\u53f0\u3067\n13,000\u5186/48\u30ab\u6708*2\u672c\u2252 541\u5186\n\u8a081,357\u5186/\u6708\n\u4fdd\u8a3c\u671f\u9593\u304c\u5207\u308c\u305f\u3089\u58ca\u308c\u308b\u3068\u306e\u524d\u63d0\u3067\u3061\u3083\u3093\u3068\u3057\u305f\u8a08\u7b97\u3058\u3083\u306a\u3044\u304b\u3089\u306a\u3093\u3068\u3082\u8a00\u3048\u306a\u3044\u3051\u3069\n\u5bb6\u65cf\u304c3\u4eba\u4ee5\u4e0a\u4f7f\u7528\u3059\u308b\u3068\u306a\u308c\u3070\u6a5f\u6750\u304c\u9577\u6301\u3061\u3057\u3066\u304f\u308c\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u81ea\u4f5c\u3057\u305f\u65b9\u304c\u3044\u3044\u306e\u304b\u3082\u3057\u308c\u306a\u3044\n\u5bb9\u91cf\u306e\u554f\u984c\u304c\u89e3\u6c7a\u3067\u304d\u308b\u3068\u306a\u3063\u305f\u3089\u6b21\u306f\u304a\u91d1\u306e\u554f\u984c\u304c\u6c17\u306b\u306a\u308b\u3068\u304b\u3001\u306a\u3093\u3066\u73fe\u91d1\u306a\u3053\u3068\u3067\u3057\u3087\u3046\u306d\u3002\n\n\u307e\u3068\u3081\n\u3060\u3089\u3060\u3089\u3068\u9577\u304f\u66f8\u3044\u305f\u3051\u3069\u3001\u3068\u308a\u3042\u3048\u305a\u52d5\u3044\u3066\u3044\u308b\u306e\u3067\u307e\u3041\u826f\u3057\u3068\u3057\u307e\u3057\u3087\u3046\u3002\nNextcloud\u3067\u69cb\u7bc9\u3059\u308b\u3068\u8ffd\u52a0\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u591a\u304f\u3042\u3063\u3066\u3001\u643a\u5e2f\u7aef\u672b\u306e\u9023\u643a\u306f\u5fae\u5999\u3060\u3051\u3069\n\u4ed6\u306b\u3082\u81ea\u7531\u5ea6\u304c\u9ad8\u3044\u306e\u3067\u3001\u5236\u7d04\u306b\u56da\u308f\u308c\u305a\u30e1\u30f3\u30c6\u306b\u81ea\u4fe1\u304c\u3042\u308c\u3070\u3044\u3044\u3093\u3058\u3083\u306a\u3044\u304b\u306a\n#\u306f\u3058\u3081\u306b\n\n\u3068\u308a\u3042\u3048\u305a\u7121\u6599\u306e\u30af\u30e9\u30a6\u30c9\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u30c7\u30fc\u30bf\u306e\u4e00\u5143\u5316\u3068\u5bb6\u65cf\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u7ba1\u7406\u3092\u3057\u305f\u3044\n\u5bb6\u65cf\u5206\u3082\u7d50\u5c40\u652f\u6255\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u30d0\u30e9\u30d0\u30e9\u306b\u8acb\u6c42\u304c\u304f\u308b\u3088\u308a\u3082\u7ba1\u7406\u3057\u3084\u3059\u3044\u3063\u3066\u3053\u3068\u3067\nNextcloud\u3092\u4f59\u3063\u3066\u308b\u53e4\u3044\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u69cb\u7bc9\u3057\u3066\u3042\u3068\u306f\u30e1\u30f3\u30c6\u3067\u5bff\u547d\u304c\u304d\u305f\u3089\u968f\u6642\u4ea4\u63db\u3067\u304d\u308b\u3088\u3046\u306b\u6e96\u5099\u3060\u3051\u306f\u3084\u3063\u3066\u304a\u3053\u3046\u304b\u306a\u3068\u3002\n\n\u69cb\u7bc9\u306e\u6d41\u308c\u3068\u3057\u3066\u306f\u8a70\u307e\u3063\u305f\u308a\u8e93\u3044\u305f\u308a\u3068\u8a66\u884c\u932f\u8aa4\u3057\u306a\u304c\u3089\u4f53\u5f53\u305f\u308a\u3067\u3084\u3063\u3066\u3044\u308b\u306e\u3067\n\u30c0\u30e9\u30c0\u30e9\u3068\u304f\u3060\u3089\u3093\u6587\u7ae0\u306b\u4ed5\u4e0a\u304c\u3063\u3066\u3044\u308b\u3051\u308c\u3069\u3001\u90e8\u5206\u7684\u306b\u30e1\u30e2\u3063\u3066\u3082\u5fd8\u308c\u305d\u3046\u306b\u306a\u308b\u304b\u3089\n\u57fa\u672c\u8aad\u307f\u98db\u3070\u3057\u3066\u3001\u5fd8\u308c\u305f\u3068\u304d\u306b\u8aad\u307f\u8fd4\u305b\u308b\u3088\u3046\u306a\u7c21\u6613\u30e1\u30e2\u7684\u306a\u4f55\u304b\n\n#\u69cb\u7bc9\u74b0\u5883\n\nCentOS7\nPHP 7.1\nnginx 1.11\nMariaDB 10.1\nnextcloud 11\n\n##PHP\n\n```bash:console\nEPEL\u30ea\u30dd\u30b8\u30c8\u30ea\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo yum install epel-release\nPHP\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo rpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-7.rpm\n$ sudo yum install --enablerepo remi-php71 php-fpm php-gd php-json php-mysql php-curl php-mbstring php-intl php-mcrypt php-imagick php-xml php-zip php-apcu\n\n\u30b5\u30fc\u30d3\u30b9\u6709\u52b9\u5316\n$ sudo systemctl enable php-fpm\n$ sudo systemctl start php-fpm\n\n\u30d1\u30b9\u306e\u78ba\u8a8d(PHP-fpm\u306eenv[PATH]\u306b\u4f7f\u7528)\n$ printenv PATH\n/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/testuser/.local/bin:/home/testuser/bin\n\n\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\n$ sudo chown -R nginx:nginx /var/lib/php/session\n\nPHP-fpm\u306e\u8a2d\u5b9a\n$ sudo vi /etc/php-fpm.d/www.conf\n```\n\n```vi:www.conf\nuser = nginx\ngroup = nginx\nlisten = /var/run/php-fpm/php-fpm.sock\nlisten.owner = nginx\nlisten.group = nginx\nlisten.mode = 0666\n\nenv[HOSTNAME] = $HOSTNAME\nenv[PATH] = /usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/testuser/.local/bin:/home/testuser/bin\nenv[TMP] = /tmp\nenv[TMPDIR] = /tmp\nenv[TEMP] = /tmp\n```\n\n```bash:console\n\u30b5\u30fc\u30d3\u30b9\u6709\u52b9\u5316\n$ sudo systemctl restart php-fpm\n```\n##MariaDB\n\n```bash:console\n$ sudo vi /etc/yum.repos.d/MariaDB.repo\n```\n\n```vi:MariaDB.repo\n[mariadb]\nname = MariaDB\nbaseurl = http://yum.mariadb.org/10.1/centos7-amd64\ngpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB\ngpgcheck=1\n```\n\n```bash:console\n$ sudo yum install mariadb-server\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n$ rpm -qa | grep -i mariadb\nMariaDB-server-10.1.21-1.el7.centos.x86_64\nMariaDB-common-10.1.21-1.el7.centos.x86_64\nMariaDB-client-10.1.21-1.el7.centos.x86_64\nMariaDB-shared-10.1.21-1.el7.centos.x86_64\n\nMySQL\u306e4\u30d0\u30a4\u30c8\u30b5\u30dd\u30fc\u30c8\u3092\u6709\u52b9\n$ sudo vi /etc/my.cnf.d/server.cnf\n```\n\n```vi:server.cnf\n[mysqld]\ninnodb_large_prefix=on\ninnodb_file_format=barracuda\ninnodb_file_per_table=true\n```\n\n```bash:console\nmariadb\u8d77\u52d5\n$ sudo systemctl enable mariadb\n$ sudo systemctl start mariadb\n\nmariaDB\u521d\u671f\u8a2d\u5b9a\n$ sudo mysql_secure_installation\n# Enter\u3092\u62bc\u3059\nEnter current password for root (enter for none):\n# root\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u8a2d\u5b9a\u3059\u308b\u304b\uff1f [y]\u3092\u9078\u629e\nSet root password? [Y/n] y\n# root\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u529b\nNew password:\n# root\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u518d\u5165\u529b\nRe-enter new password:\n# \u533f\u540d\u30e6\u30fc\u30b6\u30fc\u3092\u524a\u9664\u3059\u308b\u304b\uff1f [y]\u3092\u9078\u629e\nRemove anonymous users? [Y/n] y\n# root\u30e6\u30fc\u30b6\u30fc\u306e\u30ea\u30e2\u30fc\u30c8\u30ed\u30b0\u30a4\u30f3\u3092\u30d6\u30ed\u30c3\u30af\u3059\u308b\u304b\uff1f [y]\u3092\u9078\u629e\nDisallow root login remotely? [Y/n] y\n# \u30c6\u30b9\u30c8DB\u3092\u524a\u9664\u3059\u308b\u304b\uff1f [y]\u3092\u9078\u629e\nRemove test database and access to it? [Y/n] y\n# \u30e6\u30fc\u30b6\u6a29\u9650\u30c6\u30fc\u30d6\u30eb\u3092\u30ea\u30ed\u30fc\u30c9\u3059\u308b\u304b\uff1f [y]\u3092\u9078\u629e\nReload privilege tables now? [Y/n] y\n\nmariaDB\u306b\u30ed\u30b0\u30a4\u30f3\n$ mysql -u root -p\n```\n\n```mariadb:console\nMariaDB [(none)]> CREATE USER 'username'@'localhost' IDENTIFIED BY 'password';\nQuery OK, 0 rows affected (0.00 sec)\n\nMariaDB [(none)]> CREATE DATABASE IF NOT EXISTS nextcloud;\nQuery OK, 1 row affected (0.00 sec)\n\nMariaDB [(none)]> GRANT ALL PRIVILEGES ON nextcloud.* TO 'username'@'localhost' IDENTIFIED BY 'password';\nQuery OK, 0 rows affected (0.00 sec)\n\nMariaDB [(none)]> quit\nBye\n-------------------------------------------\nCREATE DATABASE nextcloud CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;\nGRANT ALL ON nextcloud.* TO username@\u2018%\u2019 IDENTIFIED BY \u2018password\u2019;\n\nCREATE USER 'username'@'localhost' IDENTIFIED BY 'password';\nCREATE DATABASE IF NOT EXISTS nextcloud;\nGRANT ALL PRIVILEGES ON nextcloud.* TO 'username'@'localhost' IDENTIFIED BY 'password';\n\n```\n\n##SSL\n\u3044\u308d\u3044\u308d[\u53c2\u8003](https://www.ipa.go.jp/files/000045645.pdf)\n\u3068\u308a\u3042\u3048\u305a\u30c9\u30e1\u30a4\u30f3\u53d6\u5f97\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u81ea\u5df1\u7f72\u540d\u3067\u52d5\u4f5c\u78ba\u8a8d\n\n```bash:console\n\u81ea\u5df1\u7f72\u540d\u8a3c\u660e\u66f8\u4f5c\u6210(nginx\u306e\u8a2d\u5b9a\u3000ssl_certificate / ssl_certificate_key)\n\u30c9\u30e1\u30a4\u30f3\u53d6\u5f97\u3057\u3066\u3044\u306a\u3044\u70ba\n$ sudo openssl req -x509 -nodes -days 3650 -newkey rsa:2048 -subj /CN=localhost -keyout /etc/ssl/server.key -out /etc/ssl/server.crt\n\nDH\u9375\u306e\u5909\u66f4openSSL\u3067\u4f5c\u6210(nginx\u306e\u8a2d\u5b9a\u3000ssl_dhparam)\n$ sudo openssl dhparam -out /etc/ssl/dhparam.pem 2048\n\nDNS\u30b5\u30fc\u30d0\u306e\u78ba\u8a8d(nginx\u306e\u8a2d\u5b9a\u3000resolver)\n$ cat /etc/resolv.conf\nsearch myvps.jp\nnameserver 163.44.76.148\nnameserver 157.7.180.133\n```\n\n##nginx\n\n```bash:console\n$ sudo vi /etc/yum.repos.d/nginx.repo\n```\n\n```vi:nginx.repo\n[nginx]\nname=nginx repo\nbaseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/\ngpgcheck=0\nenabled=1\n```\n\n```bash:console\n$ sudo yum install nginx\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n$ nginx -v\nnginx version: nginx/1.11.10\n\nnginx\u8a2d\u5b9a\n$ sudo /etc/nginx/conf.d/default.conf\n```\n\u3053\u3053\u306f\u305d\u308c\u305e\u308c\u306a\u306e\u3067\u7c21\u5358\u306b\u6d41\u3057\u3066\n\n```vi:default.conf\nupstream php-handler {\n    /var/run/php-fpm/php-fpm.sock;\n}\n\nserver {\n    listen 80 ;\n    listen [::]:80;\n    server_name localhost;\n    return 301 https://$server_name$request_uri;\n}\n\nserver {\n    listen 443 ssl http2 default_server;\n    listen [::]:443 ssl http2 default_server;\n    server_name localhost;\n\n    ssl_certificate /etc/ssl/server.crt;  #\u8a3c\u660e\u66f8\u3068\u4e2d\u9593\u8a3c\u660e\u66f8\u3092\u7d50\u5408\u3057\u305f\u30d5\u30a1\u30a4\u30eb\n    ssl_certificate_key /etc/ssl/server.key;  #\u79d8\u5bc6\u9375\n    #ssl_trusted_certificate ;  #\u30eb\u30fc\u30c8CA\u8a3c\u660e\u66f8\u3068\u4e2d\u9593\u8a3c\u660e\u66f8\u3092\u7d50\u5408\u3057\u305f\u30d5\u30a1\u30a4\u30eb\n    resolver 163.44.76.148 157.7.180.133; #OCSP Responder\u306e\u540d\u524d\u89e3\u6c7a\u306b\u4f7f\u3046DNS\u3002\u30b5\u30fc\u30d0\u30fc\u4e0a\u4f4d\u306eDNS\u30b5\u30fc\u30d0\u30fc\u3092\u53c2\u7167\n    ssl_dhparam /etc/ssl/dhparam.pem;   #DH\u9375\u306e\u5909\u66f4openSSL\u3067\u4f5c\u6210\n\n    ssl_session_timeout 1d;\n    ssl_session_cache shared:SSL:50m;\n    ssl_session_tickets off;\n    ssl_protocols TLSv1.2;\n    ssl_ciphers 'ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS';\n    ssl_prefer_server_ciphers on;\n    ssl_stapling on;\n    ssl_stapling_verify on;\n    # verify chain of trust of OCSP response using Root CA and Intermediate certs\n\n    add_header Strict-Transport-Security \"max-age=15768000;includeSubDomains; preload;\";\n    add_header X-Content-Type-Options nosniff;\n    add_header X-Frame-Options \"SAMEORIGIN\";\n    add_header X-XSS-Protection \"1; mode=block\";\n    add_header X-Robots-Tag none;\n    add_header X-Download-Options noopen;\n    add_header X-Permitted-Cross-Domain-Policies none;\n\n    root /usr/share/nginx/html/nextcloud;\n\n    location = /robots.txt {\n        allow all;\n        log_not_found off;\n        access_log off;\n    }\n\n    location = /.well-known/carddav {\n      return 301 $scheme://$host/remote.php/dav;\n    }\n    location = /.well-known/caldav {\n      return 301 $scheme://$host/remote.php/dav;\n    }\n\n    client_max_body_size 2000M;\n    fastcgi_buffers 64 4K;\n\n    gzip off;\n\n    error_page 403 /core/templates/403.php;\n    error_page 404 /core/templates/404.php;\n\n    location / {\n        rewrite ^ /index.php$uri;\n    }\n\n    location ~ ^/(?:build|tests|config|lib|3rdparty|templates|data)/ {\n        deny all;\n    }\n    location ~ ^/(?:\\.|autotest|occ|issue|indie|db_|console) {\n        deny all;\n    }\n\n    location ~ ^/(?:index|remote|public|cron|core/ajax/update|status|ocs/v[12]|updater/.+|ocs-provider/.+|core/templates/40[34])\\.php(?:$|/) {\n        include fastcgi_params;\n        fastcgi_split_path_info ^(.+\\.php)(/.*)$;\n        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n        fastcgi_param PATH_INFO $fastcgi_path_info;\n        fastcgi_param HTTPS on;\n        fastcgi_param modHeadersAvailable true;\n        fastcgi_param front_controller_active true;\n        fastcgi_pass php-handler;\n        fastcgi_intercept_errors on;\n        fastcgi_request_buffering off;\n    }\n\n    location ~ ^/(?:updater|ocs-provider)(?:$|/) {\n        try_files $uri/ =404;\n        index index.php;\n    }\n\n    location ~* \\.(?:css|js|woff|svg|gif)$ {\n        try_files $uri /index.php$uri$is_args$args;\n        add_header Cache-Control \"public, max-age=7200\";\n        add_header X-Content-Type-Options nosniff;\n        add_header X-Frame-Options \"SAMEORIGIN\";\n        add_header X-XSS-Protection \"1; mode=block\";\n        add_header X-Robots-Tag none;\n        add_header X-Download-Options noopen;\n        add_header X-Permitted-Cross-Domain-Policies none;\n        access_log off;\n    }\n\n    location ~* \\.(?:png|html|ttf|ico|jpg|jpeg)$ {\n        try_files $uri /index.php$uri$is_args$args;\n        access_log off;\n    }\n}\n```\n\n```bash:console\nnginx\u8d77\u52d5\n$ sudo systemctl enable nginx\n$ sudo systemctl start nginx\n```\n\n##nextcloud\n\n```bash:console\n$ sudo yum install wget\n$ sudo wget https://download.nextcloud.com/server/releases/nextcloud-11.0.1.tar.bz2\n$ sudo wget https://download.nextcloud.com/server/releases/nextcloud-11.0.1.tar.bz2.sha256\n$ sudo wget https://download.nextcloud.com/server/releases/nextcloud-11.0.1.tar.bz2.asc\nNextcloud\u306eGPG\u516c\u958b\u9375\n$ sudo wget https://nextcloud.com/nextcloud.asc\n\nSHA256\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\n$ sudo sha256sum -c nextcloud-11.0.1.tar.bz2.sha256 < nextcloud-11.0.1.tar.bz2\n\nGPG Signature\n$ sudo gpg --import nextcloud.asc\n$ sudo gpg --verify nextcloud-11.0.1.tar.bz2.asc nextcloud-11.0.1.tar.bz2\ngpg: 2017\u5e7401\u670816\u65e5 01\u664207\u520642\u79d2 JST\u306bRSA\u9375ID A724937A\u3067\u65bd\u3055\u308c\u305f\u7f72\u540d\ngpg: \"Nextcloud Security <security@nextcloud.com>\"\u304b\u3089\u306e\u6b63\u3057\u3044\u7f72\u540d\ngpg: *\u8b66\u544a*: \u3053\u306e\u9375\u306f\u4fe1\u7528\u3067\u304d\u308b\u7f72\u540d\u3067\u8a3c\u660e\u3055\u308c\u3066\u3044\u307e\u305b\u3093!\ngpg:       \u3053\u306e\u7f72\u540d\u304c\u6240\u6709\u8005\u306e\u3082\u306e\u304b\u3069\u3046\u304b\u306e\u691c\u8a3c\u624b\u6bb5\u304c\u3042\u308a\u307e\u305b\u3093\u3002\n\u4e3b\u9375\u306e\u30d5\u30a3\u30f3\u30ac\u30fc\u30fb\u30d7\u30ea\u30f3\u30c8: 2880 6A87 8AE4 23A2 8372  792E D758 99B9 A724 937A\n\n\u300cNextcloud Security <security@nextcloud.com>\"\u304b\u3089\u306e\u6b63\u3057\u3044\u7f72\u540d\u300d\u3068\u306a\u3063\u3066\u308b\u306e\u3067OK\u306e\u3088\u3046\u306a\u6c17\u304c\u3059\u308b\n\nnextcloud\u5c55\u958b\n$ sudo yum install bzip2\n$ sudo tar -xjf nextcloud-11.0.1.tar.bz2\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u306b\u30b3\u30d4\u30fc\n$ sudo cp -r nextcloud /usr/share/nginx/html/\n\n\u6240\u6709\u6a29\u306e\u5909\u66f4\n$ sudo chown -R nginx:nginx /usr/share/nginx/html/nextcloud\n\u30b7\u30a7\u30eb\u4f5c\u6210\n$ vi nextcloud.sh\n```\n\n```vi:nextcloud.sh\n#!/bin/bash\nocpath='/usr/share/nginx/html/nextcloud'\nhtuser='nginx'\nhtgroup='nginx'\nrootuser='root'\n\nprintf \"Creating possible missing Directories\\n\"\nmkdir -p $ocpath/data\nmkdir -p $ocpath/updater\n\nprintf \"chmod Files and Directories\\n\"\nfind ${ocpath}/ -type f -print0 | xargs -0 chmod 0640\nfind ${ocpath}/ -type d -print0 | xargs -0 chmod 0750\n\nprintf \"chown Directories\\n\"\nchown -R ${rootuser}:${htgroup} ${ocpath}/\nchown -R ${htuser}:${htgroup} ${ocpath}/apps/\nchown -R ${htuser}:${htgroup} ${ocpath}/config/\nchown -R ${htuser}:${htgroup} ${ocpath}/data/\nchown -R ${htuser}:${htgroup} ${ocpath}/themes/\nchown -R ${htuser}:${htgroup} ${ocpath}/updater/\n\nchmod +x ${ocpath}/occ\n```\n\n```bash:console\n\u5f37\u529b\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\nsudo sh nextcloud.sh\n```\n\n##firewall\u306e\u8a2d\u5b9a\n\n```bash:console\n\u4f7f\u7528\u4e2d\u306efirewall\u78ba\u8a8d\n$ sudo firewall-cmd --list-all\npublic (active)\n  target: default\n  icmp-block-inversion: no\n  interfaces: eth0\n  sources:\n  services: dhcpv6-client ssh\n  ports:\n  protocols:\n  masquerade: no\n  forward-ports:\n  sourceports:\n  icmp-blocks:\n  rich rules:\n\nhttp\u306e\u7a74\u3042\u3051\n$ sudo firewall-cmd --permanent --zone=public --add-service=http\nsuccess\n\nhttps\u306e\u7a74\u3042\u3051\n$ sudo firewall-cmd --permanent --zone=public --add-service=https\nsuccess\n\n$ sudo firewall-cmd --reload\nsuccess\n\n\u5909\u66f4\u306e\u78ba\u8a8d\n$ sudo firewall-cmd --list-all\npublic (active)\n  target: default\n  icmp-block-inversion: no\n  interfaces: eth0\n  sources:\n  services: dhcpv6-client http https ssh\n  ports:\n  protocols:\n  masquerade: no\n  forward-ports:\n  sourceports:\n  icmp-blocks:\n  rich rules:\n\n\u518d\u8d77\u52d5\n$ sudo systemctl restart firewalld\n```\n\n##SELinux\u306e\u8a2d\u5b9a\n\u3044\u307e\u307e\u3067\u89e6\u3063\u305f\u3053\u3068\u306a\u3044\u306e\u3067\u3088\u304f\u77e5\u3089\u306a\u3044\u3051\u3069\u516c\u5f0f\u901a\u308a\u306b\u624b\u63a2\u308a\u3067\n\n```bash:console\nsemanage\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081\n$ sudo yum install policycoreutils-python\n\n$ sudo semanage fcontext -a -t httpd_sys_rw_content_t '/usr/share/nginx/html/nextcloud/data'\n$ sudo restorecon '/usr/share/nginx/html/nextcloud/data'\n$ sudo semanage fcontext -a -t httpd_sys_rw_content_t '/usr/share/nginx/html/nextcloud/config'\n$ sudo restorecon '/usr/share/nginx/html/nextcloud/config'\n$ sudo semanage fcontext -a -t httpd_sys_rw_content_t '/usr/share/nginx/html/nextcloud/apps'\n$ sudo restorecon '/usr/share/nginx/html/nextcloud/apps'\n```\n\n#WEB\u3078\u30a2\u30af\u30bb\u30b9\n\u3053\u3053\u3089\u3067WEB\u30da\u30fc\u30b8\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u3067\u3001WEB\u4e0a\u3067\u30e6\u30fc\u30b6\u30fc\u3068\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u8a2d\u5b9a\u3092\u304a\u3053\u306a\u3044\u521d\u671f\u8a2d\u5b9a\u3092\u5b8c\u4e86\u3059\u308b\n\u554f\u984c\u304c\u306a\u3051\u308c\u3070\u3042\u3068\u306f\u62e1\u5f35\u95a2\u4fc2\u306e\u8abf\u6574\n\n##ClamAV(\u30a2\u30f3\u30c1\u30a6\u30a4\u30eb\u30b9)\n\u3068\u308a\u3042\u3048\u305a[\u516c\u5f0f](https://translate.google.co.jp/translate?hl=ja&sl=en&u=https://docs.nextcloud.com/server/11/admin_manual/configuration_server/antivirus_configuration.html&prev=search)\u901a\u308a\u306b\n\n```bash:console\n$ sudo yum install clamav clamav-scanner clamav-scanner-systemd clamav-serve clamav-server-systemd clamav-update\n\n$ sudo vi /etc/freshclam.conf\n\n$ sudo freshclam\n$ sudo vi /etc/clamd.d/scan.conf\n```\n\n```vi:freshclam.conf\n#Example            #Example\u306e\u30b3\u30e1\u30f3\u30c8\u5316\nUpdateLogFile /var/log/freshclam.log #\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u8a2d\u5b9a\nLogFileMaxSize 2M   #\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u8a2d\u5b9a\nLogTime yes         #\u30ed\u30b0\u306b\u6642\u9593\u3092\u8868\u793a\nLogRotate yes       #\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a\nDatabaseMirror db.jp.clamav.net     #\u30df\u30e9\u30fc\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u8a2d\u5b9a\nNotifyClamd /etc/clamd.d/scan.conf  #clamd@scan\u3078\u306e\u66f4\u65b0\u901a\u77e5\n```\n\n```bash:console\n\u30a6\u30a4\u30eb\u30b9\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u6700\u65b0\u5316\n$ sudo freshclam\n$ sudo vi /etc/clamd.d/scan.conf\n```\n\n```vi:freshclam.conf\n#Example            #Example\u306e\u30b3\u30e1\u30f3\u30c8\u5316\nLogFile /var/log/clamd.scan  #\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u8a2d\u5b9a\nLogFileMaxSize 2M   #\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u8a2d\u5b9a\nLogTime yes         #\u30ed\u30b0\u306b\u6642\u9593\u3092\u8868\u793a\nLogRotate yes       #\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a\nLocalSocket /var/run/clamd.scan/clamd.sock #\u30ed\u30fc\u30ab\u30eb\u30bd\u30b1\u30c3\u30c8\u4f7f\u7528\u8a2d\u5b9a\nFixStaleSocket yes  #\u7570\u5e38\u7d42\u4e86\u6642\u306b\u30bd\u30b1\u30c3\u30c8\u3092\u524a\u9664\nExcludePath ^/proc/ #\u30b9\u30ad\u30e3\u30f3\u9664\u5916\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u8a2d\u5b9a\nExcludePath ^/sys/\nUser root           #\u5b9f\u884c\u30e6\u30fc\u30b6\u8a2d\u5b9a\n```\n\n```bash:console\n\u8d77\u52d5\n$ sudo systemctl enable clamd@scan.service\n$ sudo systemctl start clamd@scan\n\nfiles_antivirus\u30a2\u30d7\u30ea\u53d6\u5f97\n$ sudo yum install unzip\n$ wget https://github.com/nextcloud/files_antivirus/archive/master.zip\n$ unzip master.zip\napp\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\n$ sudo cp -r files_antivirus-master /usr/share/nginx/htm\nl/nextcloud/apps\n\u5f37\u529b\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\nsudo sh nextcloud.sh\n```\n\u3042\u3068\u306f\u516c\u5f0f\u306e\u30da\u30fc\u30b8\u306b\u3042\u308b\u3088\u3046\u306b\u30ed\u30b0\u30a4\u30f3\u5f8c\u3001Apps\u30da\u30fc\u30b8\u306b\u3066Antivirus\u3092\u6709\u52b9\u306b\u3059\u308b\u3068[\u3067\u304d\u308b\u3089\u3057\u3044](https://translate.googleusercontent.com/translate_c?depth=1&hl=ja&prev=search&rurl=translate.google.co.jp&sl=en&sp=nmt1&u=https://github.com/nextcloud/server/issues/1445&usg=ALkJrhg8RySw_ucb-Up86fmKc8apHlHwcA)\n\u307e\u3041\u3067\u304d\u306a\u304b\u3063\u305f\u3093\u3060\u3051\u3069\u3001ClamAV\u5358\u4f53\u3067\u5b9a\u671f\u7684\u306b\u30b9\u30ad\u30e3\u30f3\u3055\u305b\u3066\u304a\u3051\u3070\u3044\u3063\u304b\u3002\n\n##\u6697\u53f7\u5316\n\u7ba1\u7406\u30da\u30fc\u30b8\u5185\u306e\u6697\u53f7\u5316\u30da\u30fc\u30b8\u3067\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u3066\u304b\u3089\nApps\u30da\u30fc\u30b8\u306b\u3066Default encryption module\u3092\u6709\u52b9\u306b\u3059\u308b\n\u203b\u4e00\u56de\u5b9f\u884c\u3057\u305f\u3089\u5f8c\u623b\u308a\u306f\u3067\u304d\u306a\u3044\u306e\u3067\u6ce8\u610f\n\n##\u30e1\u30e2\u30ea\u30ad\u30e3\u30c3\u30b7\u30e5\n\n```bash:console\n$ sudo vi /usr/share/nginx/html/nextcloud/config/config.php\n```\n\n```vi:config.php\narray\u306e\u6700\u5f8c\u306b\u8ffd\u52a0\n'memcache.local' => '\\OC\\Memcache\\APCu',\n```\n\n##\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u30b5\u30a4\u30ba\u5909\u66f4\n\n```bash:console\n$ sudo vi /etc/php.ini\n```\n\n```vi:php.ini\nmemory_limit = 512M\nupload_max_filesize = 2000M\npost_max_size = 2000M\n```\n\n\u5f37\u529b\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u3092\u3057\u3066\u3044\u308b\u3068WEB\u4e0a\u304b\u3089\u5909\u66f4\u3067\u304d\u306a\u3044\u306e\u3067.user.ini\u3092\u5909\u66f4\n\n```bash:console\n$ sudo vi /usr/share/nginx/html/nextcloud/.user.ini\n```\n\n```vi:.user.ini\nupload_max_filesize=2000M\npost_max_size2000M\nmemory_limit = 512M\n```\n\n#android\u30a2\u30d7\u30ea\u3068\u306e\u9023\u643a\nversion1.4.1\n\u4f7f\u3044\u3053\u306a\u305b\u3066\u306a\u3044\u3060\u3051\u3060\u3068\u601d\u3046\u304c\u3001\u4e00\u5fdc\u4f7f\u3044\u52dd\u624b\u306b\u3064\u3044\u3066\u4e91\u3005\n\u305d\u306e\u3046\u3061\u4fbf\u5229\u306a\u4f7f\u3044\u65b9\u3092\u767a\u898b\u3059\u308b\u3053\u3068\u3092\u671f\u5f85\u3057\u3064\u3064\n\n- \u65b0\u898f\u306e\u5199\u771f\u30fb\u52d5\u753b\u306e\u81ea\u52d5\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u53ef(\u4f46\u3057\u904e\u53bb\u306b\u64ae\u5f71\u3057\u305f\u3082\u306e\u306b\u3064\u3044\u3066\u306f\u624b\u52d5)\n- \u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u306e\u81ea\u52d5\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u4e0d\u53ef(\u624b\u52d5\u306f\u53ef)\n- \u624b\u52d5\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306f\u81ea\u52d5\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306e\u3088\u3046\u306b\u5e74\u30fb\u6708\u30fb\u65e5\u306e\u30d5\u30a9\u30eb\u30c0\u3092\u4f5c\u6210\u3057\u306a\u3044\n- \u91cd\u8907\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u3068\u30d5\u30a1\u30a4\u30eb\u540d\u3092(2)\u3092\u8ffd\u52a0\u3057\u3066\u8ee2\u9001\u3057\u3088\u3046\u3068\u3059\u308b\u304c\u30a8\u30e9\u30fc\u3068\u306a\u308b\n- \u30bf\u30b0\u306e\u8a2d\u5b9a\u4e0d\u53ef(PC\u304b\u3089\u306f\u53ef)\n- \u30bf\u30b0\u3067\u306e\u691c\u7d22\u4e0d\u53ef(PC\u304b\u3089\u306f\u53ef)\n- \u30ae\u30e3\u30e9\u30ea\u30fc\u8868\u793a\u304c\u3067\u304d\u306a\u3044(PC\u306f\u53ef)\n\n#\u30af\u30e9\u30a6\u30c9\u6bd4\u8f03\n\n\u4f59\u3063\u3066\u308b\u6a5f\u6750\u304c\u3042\u3063\u305f\u304b\u3089\u6d3b\u7528\u3057\u3088\u3046\u3068\u3057\u305f\u3051\u308c\u3069\u3001\u5b9f\u969b\u306b\u904b\u7528\u3059\u308b\u969b\u306e\u8cbb\u7528\u3092\u8003\u3048\u308b\u3068\u3069\u3046\u306a\u306e\u304b\u8003\u3048\u3069\u3053\u308d\u3067\u3059\u3002\n\u30b7\u30b9\u30a2\u30c9\u3067\u3042\u308b\u3088\u3046\u306a\u6545\u969c\u7387\u3068\u304b\u7a3c\u50cd\u7387\u3068\u304b\u7121\u8996\u3057\u3066\n\u6545\u969c\u3057\u305f\u6642\u3088\u3046\u306b\u3056\u3063\u304f\u308a\u6700\u5927\u8cbb\u7528\u3092\u8a08\u7b97\n\n3TB(\u305d\u3093\u306a\u306b\u4f7f\u308f\u306a\u3044\u3051\u3069\u3001\u4f59\u3063\u3066\u305f\u306e\u3067)\u306eHDD\u304c\u4eca4\u5e74\u4fdd\u8a3c\u30671.3\u4e07\u524d\u5f8c\u3060\u3063\u305f\u306e\u3067\nRAID6\u30674\u672c(\u4fdd\u8a3c\u671f\u9593\u5185\u306e\u6545\u969c\u306fHDD\u3092\u9001\u308b\u306e\u3067RAID\u306e\u65b9\u304c\u5fa9\u5143\u30ea\u30b9\u30af\u5b89\u5fc3\uff1f)\n13,000\u5186/48\u30ab\u6708*4\u672c\u2252 1,083\u5186\n\u3042\u3068\u306f\u7b50\u4f53\u53f0(\u30de\u30b6\u30fc\u30fb\u96fb\u6e90\u30fbCPU.etc)\u306b\u96fb\u6c17\u4ee3\u4e91\u3005\u3067\u67081.5\u5343\uff5e2\u5343\u5186\u3050\u3089\u3044\u304b\u306a\uff1f\n\n\u305d\u306e\u3050\u3089\u3044\u3067\u4ed6\u306e\u30af\u30e9\u30a6\u30c9\u30b5\u30fc\u30d3\u30b9\u3092\u691c\u8a0e\u3059\u308b\u3068\n\u3055\u304f\u3089VPS\t200G\t\t\u8907\u6570\u30e6\u30fc\u30b6\u30fc/\uffe51,706/\u6708\n\u3055\u304f\u3089VPS\t100G\t\t\u8907\u6570\u30e6\u30fc\u30b6\u30fc/\uffe5972/\u6708\nbox\t\t\u5bb9\u91cf\u7121\u5236\u9650\t1\u30e6\u30fc\u30b6\u30fc/\uffe51,800/\u6708\nDropbox\t1 TB\u3000\t\t1\u30e6\u30fc\u30b6\u30fc/\uffe51,000/\u6708\ngoogle \t1 TB\u3000\t\t1\u30e6\u30fc\u30b6\u30fc/\uffe51,300/\u6708\ngoogle \t100 GB\u3000\t\t1\u30e6\u30fc\u30b6\u30fc/\uffe5250/\u6708\n\n\u53e4\u3044\u5199\u771f\u3068\u304b\u8c4a\u5bcc\u3067\u500b\u4eba\u7684\u306a\u753b\u50cf\u3060\u3051\u3067\u3082200G\u8d85\u3048\n\u5bb6\u65cf\u5206\u306f\u5bb9\u91cf\u3069\u306e\u304f\u3089\u3044\u3067\u3044\u3064\u307e\u3067\u4f7f\u3046\u304b\u308f\u304b\u3089\u306a\u3044\u3051\u3069\u3001\n\u30af\u30e9\u30a6\u30c9\u30b5\u30fc\u30d3\u30b9\u306b\u983c\u308b\u3068\u3059\u308c\u3070\u4e0b\u8a18\u306e\u611f\u3058\u3067\uffe51,500/\u6708\u3068\u306a\u308b\n\u81ea\u8eab\t\t  Dropbox\t1 TB\u3000\n\u5bb6\u65cf1\u5bb6\u65cf2 google \t100 GB\n\n\u4ed6\u306fNAS\u306e\u7b50\u4f53\u304c\u300cDiskStation DS216j\u300d\u4fdd\u8a3c\u671f\u95932\u5e74\u306719,600\u5186\u306a\u306e\u3067\n19,600\u5186/24\u30ab\u6708\u2252816\u5186\n\u4e0a\u3068\u540c\u3058HDD2\u53f0\u3067\n13,000\u5186/48\u30ab\u6708*2\u672c\u2252 541\u5186\n\u8a081,357\u5186/\u6708\n\n\u4fdd\u8a3c\u671f\u9593\u304c\u5207\u308c\u305f\u3089\u58ca\u308c\u308b\u3068\u306e\u524d\u63d0\u3067\u3061\u3083\u3093\u3068\u3057\u305f\u8a08\u7b97\u3058\u3083\u306a\u3044\u304b\u3089\u306a\u3093\u3068\u3082\u8a00\u3048\u306a\u3044\u3051\u3069\n\u5bb6\u65cf\u304c3\u4eba\u4ee5\u4e0a\u4f7f\u7528\u3059\u308b\u3068\u306a\u308c\u3070\u6a5f\u6750\u304c\u9577\u6301\u3061\u3057\u3066\u304f\u308c\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u81ea\u4f5c\u3057\u305f\u65b9\u304c\u3044\u3044\u306e\u304b\u3082\u3057\u308c\u306a\u3044\n\u5bb9\u91cf\u306e\u554f\u984c\u304c\u89e3\u6c7a\u3067\u304d\u308b\u3068\u306a\u3063\u305f\u3089\u6b21\u306f\u304a\u91d1\u306e\u554f\u984c\u304c\u6c17\u306b\u306a\u308b\u3068\u304b\u3001\u306a\u3093\u3066\u73fe\u91d1\u306a\u3053\u3068\u3067\u3057\u3087\u3046\u306d\u3002\n\n#\u307e\u3068\u3081\n\u3060\u3089\u3060\u3089\u3068\u9577\u304f\u66f8\u3044\u305f\u3051\u3069\u3001\u3068\u308a\u3042\u3048\u305a\u52d5\u3044\u3066\u3044\u308b\u306e\u3067\u307e\u3041\u826f\u3057\u3068\u3057\u307e\u3057\u3087\u3046\u3002\nNextcloud\u3067\u69cb\u7bc9\u3059\u308b\u3068\u8ffd\u52a0\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u591a\u304f\u3042\u3063\u3066\u3001\u643a\u5e2f\u7aef\u672b\u306e\u9023\u643a\u306f\u5fae\u5999\u3060\u3051\u3069\n\u4ed6\u306b\u3082\u81ea\u7531\u5ea6\u304c\u9ad8\u3044\u306e\u3067\u3001\u5236\u7d04\u306b\u56da\u308f\u308c\u305a\u30e1\u30f3\u30c6\u306b\u81ea\u4fe1\u304c\u3042\u308c\u3070\u3044\u3044\u3093\u3058\u3083\u306a\u3044\u304b\u306a\n"}