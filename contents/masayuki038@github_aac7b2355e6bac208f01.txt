{"tags": ["Scala", "Akka"], "context": "\n\nTL;DR\nakka\u306bErlang\u306eLink\u306e\u3088\u3046\u306a\u6a5f\u69cb\u304c\u7121\u3044\u304b\u63a2\u3057\u3066\u3044\u308b\u3002\nakka\u306e\u5b50actor\u304c\u6b7b\u3093\u3060\u6642\u306b\u89aaactor\u3082\u5dfb\u304d\u8fbc\u307e\u308c\u3066\u6b7b\u306c\u304b\u78ba\u8a8d\u3057\u305f\u3002\n\n\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\n\n\u5b50actor\u3078\u306ewatch\u7121\u3057\n\n\npoison\nstop\nexception\n\n\n\u5b50actor\u3078\u306ewattch\u6709\u308a\n\n\npoison\nstop\nexception\n\n\n\n\ncode\n\npackage.scala\npackage net.wrap_trap.akka_samples.monitor\n\nimport akka.actor._\n\nobject Monitor {\n  def main(args: Array[String]): Unit = {\n    val superVisor = ActorSystem(\"test\").actorOf(Props[Supervisor])\n    superVisor ! args\n  }\n}\n\n\n\nSupervisor.scala\npackage net.wrap_trap.akka_samples.monitor\n\nimport akka.actor.{ActorRef, Actor, Terminated, Props}\n\nclass Supervisor extends Actor {\n\n  var parent: Option[ActorRef] = None\n\n  override def preStart(): Unit = {\n    parent = Option(context.actorOf(Props[Parent]))\n  }\n\n  def receive = {\n    case Terminated(p) => {\n      println(\"terminated: \" + p)\n    }\n    case args: Array[String] => {\n      val p = parent.get\n      context.watch(p)\n      p ! args\n    }\n  }\n}\n\n\n\nParent.scala\npackage net.wrap_trap.akka_samples.monitor\n\nimport akka.actor.{ActorRef, Actor, Terminated, Props}\n\nclass Parent extends Actor {\n\n  var child: Option[ActorRef] = None\n\n  override def preStart(): Unit = {\n    child = Option(context.actorOf(Props[Child]))\n  }\n\n  def receive = {\n    case Terminated(c) => {\n      println(\"terminated: \" + c)\n    }\n    case args: Array[String] => {\n      val c = child.get \n      if(args.length > 1 && args(1) == \"1\") {\n        context.watch(c)\n        println(\"start to watch: \" + child)\n      }\n      c ! args(0)\n    }\n  }\n}\n\n\n\nChild.scala\npackage net.wrap_trap.akka_samples.monitor\n\nimport akka.actor.{ActorRef, Actor, PoisonPill}\n\nclass Child extends Actor {\n  def receive = {\n    case \"poison\"  => {\n      println(\"message received: poison\")\n      self ! PoisonPill\n    }\n    case \"stop\" => {\n      println(\"message received: stop\")\n      context.stop(self)\n    }\n    case \"exception\" => throw new RuntimeException(\"error\")\n  }\n}\n\n\n\n\u5b9f\u884c\n\n\u5b50actor\u3078\u306ewatch\u7121\u3057\n\npoison\n\nmasayuki@masayuki-ubuntu:~/git/akka-samples$ sbt \"run-main net.wrap_trap.akka_samples.monitor.Monitor poison 0\"\n[info] Loading global plugins from /home/masayuki/.sbt/0.13/plugins\n[info] Loading project definition from /home/masayuki/git/akka-samples/project\n[info] Set current project to akka-samples (in build file:/home/masayuki/git/akka-samples/)\n[info] Running net.wrap_trap.akka_samples.monitor.Monitor poison 0\nmessage received: poison\n\n\nstop\n\n^Cmasayuki@masayuki-ubuntu:~/git/akka-samples$ sbt \"run-main net.wrap_trap.akka_samples.monitor.Monitor stop 0\"\n[info] Loading global plugins from /home/masayuki/.sbt/0.13/plugins\n[info] Loading project definition from /home/masayuki/git/akka-samples/project\n[info] Set current project to akka-samples (in build file:/home/masayuki/git/akka-samples/)\n[info] Running net.wrap_trap.akka_samples.monitor.Monitor stop 0\nmessage received: stop\n\n\nexception\n\n^Cmasayuki@masayuki-ubuntu:~/git/akka-samples$ sbt \"run-main net.wrap_trap.akka_samples.monitor.Monitor exception 0\"\n[info] Loading global plugins from /home/masayuki/.sbt/0.13/plugins\n[info] Loading project definition from /home/masayuki/git/akka-samples/project\n[info] Set current project to akka-samples (in build file:/home/masayuki/git/akka-samples/)\n[info] Running net.wrap_trap.akka_samples.monitor.Monitor exception 0\n[ERROR] [02/06/2017 02:55:37.660] [test-akka.actor.default-dispatcher-5] [akka://test/user/$a/$a/$a] error\njava.lang.RuntimeException: error\n    at net.wrap_trap.akka_samples.monitor.Child$$anonfun$receive$1.applyOrElse(Child.scala:15)\n    at akka.actor.Actor$class.aroundReceive(Actor.scala:480)\n    at net.wrap_trap.akka_samples.monitor.Child.aroundReceive(Child.scala:5)\n    at akka.actor.ActorCell.receiveMessage(ActorCell.scala:526)\n    at akka.actor.ActorCell.invoke(ActorCell.scala:495)\n    at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:257)\n    at akka.dispatch.Mailbox.run(Mailbox.scala:224)\n    at akka.dispatch.Mailbox.exec(Mailbox.scala:234)\n    at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)\n    at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)\n    at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)\n    at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)\n\n\n\u5b50actor\u3078\u306ewatch\u6709\u308a\n\npoison\n\n^Cmasayuki@masayuki-ubuntu:~/git/akka-samples$ sbt \"run-main net.wrap_trap.akka_samples.monitor.Monitor poison 1\"\n[info] Loading global plugins from /home/masayuki/.sbt/0.13/plugins\n[info] Loading project definition from /home/masayuki/git/akka-samples/project\n[info] Set current project to akka-samples (in build file:/home/masayuki/git/akka-samples/)\n[info] Running net.wrap_trap.akka_samples.monitor.Monitor poison 1\nstart to watch: Some(Actor[akka://test/user/$a/$a/$a#1037068608])\nmessage received: poison\nterminated: Actor[akka://test/user/$a/$a/$a#1037068608]\n\n\nstop\n\n^Cmasayuki@masayuki-ubuntu:~/git/akka-samples$ sbt \"run-main net.wrap_trap.akka_samples.monitor.Monitor stop 1\"\n[info] Loading global plugins from /home/masayuki/.sbt/0.13/plugins\n[info] Loading project definition from /home/masayuki/git/akka-samples/project\n[info] Set current project to akka-samples (in build file:/home/masayuki/git/akka-samples/)\n[info] Running net.wrap_trap.akka_samples.monitor.Monitor stop 1\nstart to watch: Some(Actor[akka://test/user/$a/$a/$a#1039911163])\nmessage received: stop\nterminated: Actor[akka://test/user/$a/$a/$a#1039911163]\n\n\nexception\n\n^Cmasayuki@masayuki-ubuntu:~/git/akka-samples$ sbt \"run-main net.wrap_trap.akka_samples.monitor.Monitor exception 1\"\n[info] Loading global plugins from /home/masayuki/.sbt/0.13/plugins\n[info] Loading project definition from /home/masayuki/git/akka-samples/project\n[info] Set current project to akka-samples (in build file:/home/masayuki/git/akka-samples/)\n[info] Running net.wrap_trap.akka_samples.monitor.Monitor exception 1\nstart to watch: Some(Actor[akka://test/user/$a/$a/$a#-1810233518])\n[ERROR] [02/06/2017 02:56:10.867] [test-akka.actor.default-dispatcher-7] [akka://test/user/$a/$a/$a] error\njava.lang.RuntimeException: error\n    at net.wrap_trap.akka_samples.monitor.Child$$anonfun$receive$1.applyOrElse(Child.scala:15)\n    at akka.actor.Actor$class.aroundReceive(Actor.scala:480)\n    at net.wrap_trap.akka_samples.monitor.Child.aroundReceive(Child.scala:5)\n    at akka.actor.ActorCell.receiveMessage(ActorCell.scala:526)\n    at akka.actor.ActorCell.invoke(ActorCell.scala:495)\n    at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:257)\n    at akka.dispatch.Mailbox.run(Mailbox.scala:224)\n    at akka.dispatch.Mailbox.exec(Mailbox.scala:234)\n    at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)\n    at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)\n    at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)\n    at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)\n\n\n\u307e\u3068\u3081\n\u5b50actor\u3092\u4f5c\u3063\u305f\u3060\u3051\u3067\u306f\u3001\u5b50actor\u306f\u6b7b\u3093\u3067\u3082\u89aaactor\u306f\u6b7b\u306a\u306a\u3044\u3002\nErlang\u306eLink\u306e\u3088\u3046\u306b\u7247\u5074\u304c\u6b7b\u3093\u3060\u3089Link\u5148\u3082\u6b7b\u306c\u3001\u3068\u3044\u3046\u6a5f\u69cb\u306fakka\u306b\u306f\u7121\u3044\u306e\u304b\u306a\u3002\nTL;DR\n=====\nakka\u306bErlang\u306eLink\u306e\u3088\u3046\u306a\u6a5f\u69cb\u304c\u7121\u3044\u304b\u63a2\u3057\u3066\u3044\u308b\u3002\nakka\u306e\u5b50actor\u304c\u6b7b\u3093\u3060\u6642\u306b\u89aaactor\u3082\u5dfb\u304d\u8fbc\u307e\u308c\u3066\u6b7b\u306c\u304b\u78ba\u8a8d\u3057\u305f\u3002\n\n\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\n===========\n\n- \u5b50actor\u3078\u306ewatch\u7121\u3057\n    - poison\n    - stop\n    - exception\n- \u5b50actor\u3078\u306ewattch\u6709\u308a\n    - poison\n    - stop\n    - exception\n\ncode\n====\n\n```package.scala\npackage net.wrap_trap.akka_samples.monitor\n\nimport akka.actor._\n\nobject Monitor {\n  def main(args: Array[String]): Unit = {\n    val superVisor = ActorSystem(\"test\").actorOf(Props[Supervisor])\n    superVisor ! args\n  }\n}\n```\n\n```Supervisor.scala\npackage net.wrap_trap.akka_samples.monitor\n\nimport akka.actor.{ActorRef, Actor, Terminated, Props}\n\nclass Supervisor extends Actor {\n\n  var parent: Option[ActorRef] = None\n\n  override def preStart(): Unit = {\n    parent = Option(context.actorOf(Props[Parent]))\n  }\n\n  def receive = {\n    case Terminated(p) => {\n      println(\"terminated: \" + p)\n    }\n    case args: Array[String] => {\n      val p = parent.get\n      context.watch(p)\n      p ! args\n    }\n  }\n}\n```\n\n```Parent.scala\npackage net.wrap_trap.akka_samples.monitor\n\nimport akka.actor.{ActorRef, Actor, Terminated, Props}\n\nclass Parent extends Actor {\n\n  var child: Option[ActorRef] = None\n\n  override def preStart(): Unit = {\n    child = Option(context.actorOf(Props[Child]))\n  }\n\n  def receive = {\n    case Terminated(c) => {\n      println(\"terminated: \" + c)\n    }\n    case args: Array[String] => {\n      val c = child.get \n      if(args.length > 1 && args(1) == \"1\") {\n        context.watch(c)\n        println(\"start to watch: \" + child)\n      }\n      c ! args(0)\n    }\n  }\n}\n```\n\n```Child.scala\npackage net.wrap_trap.akka_samples.monitor\n\nimport akka.actor.{ActorRef, Actor, PoisonPill}\n\nclass Child extends Actor {\n  def receive = {\n    case \"poison\"  => {\n      println(\"message received: poison\")\n      self ! PoisonPill\n    }\n    case \"stop\" => {\n      println(\"message received: stop\")\n      context.stop(self)\n    }\n    case \"exception\" => throw new RuntimeException(\"error\")\n  }\n}\n```\n\n\u5b9f\u884c\n===\n\u5b50actor\u3078\u306ewatch\u7121\u3057\n-------------------\n- poison\n\n```\nmasayuki@masayuki-ubuntu:~/git/akka-samples$ sbt \"run-main net.wrap_trap.akka_samples.monitor.Monitor poison 0\"\n[info] Loading global plugins from /home/masayuki/.sbt/0.13/plugins\n[info] Loading project definition from /home/masayuki/git/akka-samples/project\n[info] Set current project to akka-samples (in build file:/home/masayuki/git/akka-samples/)\n[info] Running net.wrap_trap.akka_samples.monitor.Monitor poison 0\nmessage received: poison\n```\n\n- stop\n\n```\n^Cmasayuki@masayuki-ubuntu:~/git/akka-samples$ sbt \"run-main net.wrap_trap.akka_samples.monitor.Monitor stop 0\"\n[info] Loading global plugins from /home/masayuki/.sbt/0.13/plugins\n[info] Loading project definition from /home/masayuki/git/akka-samples/project\n[info] Set current project to akka-samples (in build file:/home/masayuki/git/akka-samples/)\n[info] Running net.wrap_trap.akka_samples.monitor.Monitor stop 0\nmessage received: stop\n```\n\n- exception\n\n```\n^Cmasayuki@masayuki-ubuntu:~/git/akka-samples$ sbt \"run-main net.wrap_trap.akka_samples.monitor.Monitor exception 0\"\n[info] Loading global plugins from /home/masayuki/.sbt/0.13/plugins\n[info] Loading project definition from /home/masayuki/git/akka-samples/project\n[info] Set current project to akka-samples (in build file:/home/masayuki/git/akka-samples/)\n[info] Running net.wrap_trap.akka_samples.monitor.Monitor exception 0\n[ERROR] [02/06/2017 02:55:37.660] [test-akka.actor.default-dispatcher-5] [akka://test/user/$a/$a/$a] error\njava.lang.RuntimeException: error\n    at net.wrap_trap.akka_samples.monitor.Child$$anonfun$receive$1.applyOrElse(Child.scala:15)\n    at akka.actor.Actor$class.aroundReceive(Actor.scala:480)\n    at net.wrap_trap.akka_samples.monitor.Child.aroundReceive(Child.scala:5)\n    at akka.actor.ActorCell.receiveMessage(ActorCell.scala:526)\n    at akka.actor.ActorCell.invoke(ActorCell.scala:495)\n    at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:257)\n    at akka.dispatch.Mailbox.run(Mailbox.scala:224)\n    at akka.dispatch.Mailbox.exec(Mailbox.scala:234)\n    at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)\n    at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)\n    at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)\n    at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)\n```\n\n\u5b50actor\u3078\u306ewatch\u6709\u308a\n-------------------\n- poison\n\n```\n^Cmasayuki@masayuki-ubuntu:~/git/akka-samples$ sbt \"run-main net.wrap_trap.akka_samples.monitor.Monitor poison 1\"\n[info] Loading global plugins from /home/masayuki/.sbt/0.13/plugins\n[info] Loading project definition from /home/masayuki/git/akka-samples/project\n[info] Set current project to akka-samples (in build file:/home/masayuki/git/akka-samples/)\n[info] Running net.wrap_trap.akka_samples.monitor.Monitor poison 1\nstart to watch: Some(Actor[akka://test/user/$a/$a/$a#1037068608])\nmessage received: poison\nterminated: Actor[akka://test/user/$a/$a/$a#1037068608]\n```\n\n- stop\n\n```\n^Cmasayuki@masayuki-ubuntu:~/git/akka-samples$ sbt \"run-main net.wrap_trap.akka_samples.monitor.Monitor stop 1\"\n[info] Loading global plugins from /home/masayuki/.sbt/0.13/plugins\n[info] Loading project definition from /home/masayuki/git/akka-samples/project\n[info] Set current project to akka-samples (in build file:/home/masayuki/git/akka-samples/)\n[info] Running net.wrap_trap.akka_samples.monitor.Monitor stop 1\nstart to watch: Some(Actor[akka://test/user/$a/$a/$a#1039911163])\nmessage received: stop\nterminated: Actor[akka://test/user/$a/$a/$a#1039911163]\n```\n\n- exception\n\n```\n^Cmasayuki@masayuki-ubuntu:~/git/akka-samples$ sbt \"run-main net.wrap_trap.akka_samples.monitor.Monitor exception 1\"\n[info] Loading global plugins from /home/masayuki/.sbt/0.13/plugins\n[info] Loading project definition from /home/masayuki/git/akka-samples/project\n[info] Set current project to akka-samples (in build file:/home/masayuki/git/akka-samples/)\n[info] Running net.wrap_trap.akka_samples.monitor.Monitor exception 1\nstart to watch: Some(Actor[akka://test/user/$a/$a/$a#-1810233518])\n[ERROR] [02/06/2017 02:56:10.867] [test-akka.actor.default-dispatcher-7] [akka://test/user/$a/$a/$a] error\njava.lang.RuntimeException: error\n    at net.wrap_trap.akka_samples.monitor.Child$$anonfun$receive$1.applyOrElse(Child.scala:15)\n    at akka.actor.Actor$class.aroundReceive(Actor.scala:480)\n    at net.wrap_trap.akka_samples.monitor.Child.aroundReceive(Child.scala:5)\n    at akka.actor.ActorCell.receiveMessage(ActorCell.scala:526)\n    at akka.actor.ActorCell.invoke(ActorCell.scala:495)\n    at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:257)\n    at akka.dispatch.Mailbox.run(Mailbox.scala:224)\n    at akka.dispatch.Mailbox.exec(Mailbox.scala:234)\n    at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)\n    at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)\n    at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)\n    at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)\n```\n\n\u307e\u3068\u3081\n======\n\u5b50actor\u3092\u4f5c\u3063\u305f\u3060\u3051\u3067\u306f\u3001\u5b50actor\u306f\u6b7b\u3093\u3067\u3082\u89aaactor\u306f\u6b7b\u306a\u306a\u3044\u3002\nErlang\u306eLink\u306e\u3088\u3046\u306b\u7247\u5074\u304c\u6b7b\u3093\u3060\u3089Link\u5148\u3082\u6b7b\u306c\u3001\u3068\u3044\u3046\u6a5f\u69cb\u306fakka\u306b\u306f\u7121\u3044\u306e\u304b\u306a\u3002\n"}