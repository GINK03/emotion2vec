{"tags": ["fluentd", "Twitter", "AWS"], "context": "Twitter Public streams\u306b\u5bfe\u3057\u3066\u5206\u6790\u3092\u884c\u3044\u305f\u3044\u3068\u601d\u3063\u3066\u3082\u3001\u30a6\u30a7\u30d6\u4e0a\u306bDump\u3092\u516c\u958b\u3059\u308b\u306e\u306fNG\u3068\u3055\u308c\u3066\u304a\u308a\u5fc5\u8981\u306a\u3089\u81ea\u5206\u3067\u53ce\u96c6\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u4ee5\u524d\u306f\u81ea\u4f5c\u306ePython\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5e38\u6642\u5b9f\u884c\u3057\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u96d1\u904e\u304e\u3066\u30d7\u30ed\u30bb\u30b9\u304c\u6b7b\u306c\u3053\u3068\u304c\u591a\u767a\u3059\u308b\u3053\u3068\u3068\u30ed\u30fc\u30ab\u30eb\u306e\u30c7\u30a3\u30b9\u30af\u306b\u6e9c\u3081\u8fbc\u307f\u7d9a\u3051\u3066\u3044\u305f\u305f\u3081\u30c7\u30a3\u30b9\u30af\u304c\u903c\u8feb\u3057\u3066\u3057\u307e\u3046\u554f\u984c\u304c\u767a\u751f\u3002\n\u3053\u306e\u8fba\u3061\u3083\u3093\u3068\u4f5c\u308a\u8fbc\u3081\u3070\u3044\u3044\u3093\u3067\u3057\u3087\u3046\u304c\u3001Fluentd\u306b\u306fPublic streams\u306b\u3082Amazon S3\u306b\u3082\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u305f\u306e\u3067\u305d\u308c\u3092\u4f7f\u3063\u3066\u5168\u81ea\u52d5\u3067\u53ce\u96c6\u3057\u7d9a\u3051\u3089\u308c\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u203b\u624b\u9806\u306f\u304b\u306a\u308a\u6614\u306b\u8a2d\u5b9a\u3057\u305f\u5185\u5bb9\u3092\u601d\u3044\u51fa\u3057\u306a\u304c\u3089\u66f8\u3044\u3066\u3044\u308b\u306e\u3067\u629c\u3051\u6f0f\u308c\u3042\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u3002\u305d\u306e\u6642\u306f\u3054\u6307\u6458\u304a\u9858\u3044\u3057\u307e\u3059\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4eca\u56de\u306fCentOS 7\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u52d5\u304b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n#curl -L https://toolbelt.treasuredata.com/sh/install-redhat-td-agent2.sh | sh\n#sudo /etc/init.d/td-agent start\n#sudo /etc/init.d/td-agent status\n\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nTwitter\u3068Amazon S3\u3078\u306e\u30a2\u30af\u30bb\u30b9\u306e\u305f\u3081\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n#sudo td-agent-gem install fluent-plugin-twitter\n#sudo /usr/sbin/td-agent-gem install fluent-plugin-s3\n\n\ntd-agent.conf\u306e\u8a2d\u5b9a\n\u8a2d\u5b9a\u3092td-agent.conf\u306e\u884c\u672b\u306b\u8ffd\u52a0\n\n/etc/td-agent/td-agent.conf\n<source>\n  type twitter\n  consumer_key xxxxxxxxxxxxxxxxxxxxxxxxxxx\n  consumer_secret xxxxxxxxxxxxxxxxxxxxxxxxxxx\n  oauth_token xxxxxxxxxxxxxxxxxxxxxxxxxxx\n  oauth_token_secret xxxxxxxxxxxxxxxxxxxxxxxxxxx\n\n  tag input.twitter.sampling\n  timeline sampling\n  lang ja\n  output_format nest\n</source>\n\n<match input.twitter.sampling>\n  type copy\n\n  <store>\n    type s3\n    aws_key_id xxxxxxxxxxxxxxxxxxxxxxxxxxx\n    aws_sec_key xxxxxxxxxxxxxxxxxxxxxxxxxxx\n    s3_bucket hogehoge\n    s3_region ap-northeast-1\n    s3_enpoint s3-ap-northeast-1.amazonaws.com\n    path streaming_api_logs/\n    buffer_path /var/log/td-agent/s3\n\n    time_slice_format %Y%m%d%H\n    s3_object_key_format %{path}%{time_slice}_%{index}_%{hostname}.%{file_extension}\n    time_slice_wait 5m\n    buffer_chunk_limit 256M\n\n    utc\n  </store>\n</match>\n\n\n\u4e8b\u524d\u306bTwitter\u3068AWS\u306eAPI\u306f\u53d6\u5f97\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u65e5\u672c\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u30d0\u30b1\u30c3\u30c8\u3092\u4f5c\u6210\u3057\u3001\u30d0\u30b1\u30c3\u30c8\u306bAPI\u304b\u3089\u30a2\u30af\u30bb\u30b9\u306e\u8a31\u53ef\u3092\u3057\u3066\u304a\u304f\u3053\u3068\u304c\u4e8b\u524d\u306b\u5fc5\u8981\u3067\u3059\u3002\n\n\u52d5\u4f5c\u7d50\u679c\n\u3046\u307e\u304f\u52d5\u4f5c\u3059\u308b\u30681\u6642\u9593\u304a\u304d\u306bAmazon S3\u306bgz\u5727\u7e2e\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u304c\u8ee2\u9001\u3055\u308c\u307e\u3059\u3002\n\u6642\u3005\u30d5\u30a1\u30a4\u30eb\u540d\u304c_1\u306e\u3082\u306e\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u304c\u3001\u5727\u7e2e\u524d\u306e\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30b9\u304c256MB\u3092\u8d85\u3048\u305f\u5834\u5408\u81ea\u52d5\u3067\u9023\u756a\u306b\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u3067\u3059\u3002\n\n\u30c7\u30fc\u30bf\u306f\u6e9c\u3081\u8fbc\u3081\u305f\u3093\u3067\u3059\u304c\u3001\u3053\u308c\u304b\u3089\u3069\u3046\u3084\u3063\u3066\u6d3b\u7528\u3057\u3066\u3044\u304f\u304b\u306f\u3053\u308c\u304b\u3089\u8003\u3048\u307e\u3059\n\n\u53c2\u8003\n\u3053\u3061\u3089\u3092\u53c2\u8003\u306b\u3044\u305f\u3057\u307e\u3057\u305f\u3002\n\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\nfluentd \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nTwitter Public streams\u306b\u5bfe\u3057\u3066\u5206\u6790\u3092\u884c\u3044\u305f\u3044\u3068\u601d\u3063\u3066\u3082\u3001\u30a6\u30a7\u30d6\u4e0a\u306bDump\u3092\u516c\u958b\u3059\u308b\u306e\u306fNG\u3068\u3055\u308c\u3066\u304a\u308a\u5fc5\u8981\u306a\u3089\u81ea\u5206\u3067\u53ce\u96c6\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u4ee5\u524d\u306f\u81ea\u4f5c\u306ePython\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5e38\u6642\u5b9f\u884c\u3057\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u96d1\u904e\u304e\u3066\u30d7\u30ed\u30bb\u30b9\u304c\u6b7b\u306c\u3053\u3068\u304c\u591a\u767a\u3059\u308b\u3053\u3068\u3068\u30ed\u30fc\u30ab\u30eb\u306e\u30c7\u30a3\u30b9\u30af\u306b\u6e9c\u3081\u8fbc\u307f\u7d9a\u3051\u3066\u3044\u305f\u305f\u3081\u30c7\u30a3\u30b9\u30af\u304c\u903c\u8feb\u3057\u3066\u3057\u307e\u3046\u554f\u984c\u304c\u767a\u751f\u3002\n\u3053\u306e\u8fba\u3061\u3083\u3093\u3068\u4f5c\u308a\u8fbc\u3081\u3070\u3044\u3044\u3093\u3067\u3057\u3087\u3046\u304c\u3001Fluentd\u306b\u306fPublic streams\u306b\u3082Amazon S3\u306b\u3082\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u305f\u306e\u3067\u305d\u308c\u3092\u4f7f\u3063\u3066\u5168\u81ea\u52d5\u3067\u53ce\u96c6\u3057\u7d9a\u3051\u3089\u308c\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u203b\u624b\u9806\u306f\u304b\u306a\u308a\u6614\u306b\u8a2d\u5b9a\u3057\u305f\u5185\u5bb9\u3092\u601d\u3044\u51fa\u3057\u306a\u304c\u3089\u66f8\u3044\u3066\u3044\u308b\u306e\u3067\u629c\u3051\u6f0f\u308c\u3042\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u3002\u305d\u306e\u6642\u306f\u3054\u6307\u6458\u304a\u9858\u3044\u3057\u307e\u3059:bow_tone1:\n\n#\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u4eca\u56de\u306fCentOS 7\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u52d5\u304b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n```\n#curl -L https://toolbelt.treasuredata.com/sh/install-redhat-td-agent2.sh | sh\n#sudo /etc/init.d/td-agent start\n#sudo /etc/init.d/td-agent status\n```\n\n#\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nTwitter\u3068Amazon S3\u3078\u306e\u30a2\u30af\u30bb\u30b9\u306e\u305f\u3081\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n#sudo td-agent-gem install fluent-plugin-twitter\n#sudo /usr/sbin/td-agent-gem install fluent-plugin-s3\n```\n\n#td-agent.conf\u306e\u8a2d\u5b9a\n\u8a2d\u5b9a\u3092td-agent.conf\u306e\u884c\u672b\u306b\u8ffd\u52a0\n\n```/etc/td-agent/td-agent.conf\n<source>\n  type twitter\n  consumer_key xxxxxxxxxxxxxxxxxxxxxxxxxxx\n  consumer_secret xxxxxxxxxxxxxxxxxxxxxxxxxxx\n  oauth_token xxxxxxxxxxxxxxxxxxxxxxxxxxx\n  oauth_token_secret xxxxxxxxxxxxxxxxxxxxxxxxxxx\n\n  tag input.twitter.sampling\n  timeline sampling\n  lang ja\n  output_format nest\n</source>\n\n<match input.twitter.sampling>\n  type copy\n\n  <store>\n    type s3\n    aws_key_id xxxxxxxxxxxxxxxxxxxxxxxxxxx\n    aws_sec_key xxxxxxxxxxxxxxxxxxxxxxxxxxx\n    s3_bucket hogehoge\n    s3_region ap-northeast-1\n    s3_enpoint s3-ap-northeast-1.amazonaws.com\n    path streaming_api_logs/\n    buffer_path /var/log/td-agent/s3\n\n    time_slice_format %Y%m%d%H\n    s3_object_key_format %{path}%{time_slice}_%{index}_%{hostname}.%{file_extension}\n    time_slice_wait 5m\n    buffer_chunk_limit 256M\n\n    utc\n  </store>\n</match>\n```\n\u4e8b\u524d\u306bTwitter\u3068AWS\u306eAPI\u306f\u53d6\u5f97\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u65e5\u672c\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u30d0\u30b1\u30c3\u30c8\u3092\u4f5c\u6210\u3057\u3001\u30d0\u30b1\u30c3\u30c8\u306bAPI\u304b\u3089\u30a2\u30af\u30bb\u30b9\u306e\u8a31\u53ef\u3092\u3057\u3066\u304a\u304f\u3053\u3068\u304c\u4e8b\u524d\u306b\u5fc5\u8981\u3067\u3059\u3002\n\n# \u52d5\u4f5c\u7d50\u679c\n\u3046\u307e\u304f\u52d5\u4f5c\u3059\u308b\u30681\u6642\u9593\u304a\u304d\u306bAmazon S3\u306bgz\u5727\u7e2e\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u304c\u8ee2\u9001\u3055\u308c\u307e\u3059\u3002\n\u6642\u3005\u30d5\u30a1\u30a4\u30eb\u540d\u304c_1\u306e\u3082\u306e\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u304c\u3001\u5727\u7e2e\u524d\u306e\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30b9\u304c256MB\u3092\u8d85\u3048\u305f\u5834\u5408\u81ea\u52d5\u3067\u9023\u756a\u306b\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u3067\u3059\u3002\n\n![img.PNG](https://qiita-image-store.s3.amazonaws.com/0/100935/d15106d0-ca6d-d033-789a-a3f7f0e7c98d.png)\n\n\u30c7\u30fc\u30bf\u306f\u6e9c\u3081\u8fbc\u3081\u305f\u3093\u3067\u3059\u304c\u3001\u3053\u308c\u304b\u3089\u3069\u3046\u3084\u3063\u3066\u6d3b\u7528\u3057\u3066\u3044\u304f\u304b\u306f\u3053\u308c\u304b\u3089\u8003\u3048\u307e\u3059:stuck_out_tongue:\n\n## \u53c2\u8003\n\u3053\u3061\u3089\u3092\u53c2\u8003\u306b\u3044\u305f\u3057\u307e\u3057\u305f\u3002\n\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\n\n[fluentd \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb](http://qiita.com/ohayougenki/items/5341b313a2226093480b)\n"}