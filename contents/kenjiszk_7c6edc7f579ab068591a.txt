{"context": " More than 1 year has passed since last update.\n\ncapistrano3-unicorn\ncapistrano + rails + unicorn\u3068\u3044\u3046\u69cb\u6210\u306e\u6642\u306b\u3001unicorn\u3092\u8272\u3005\u3068\u64cd\u4f5c\u3059\u308b\u3084\u3064\u3002\nunicorn\u3092\u518d\u8d77\u52d5\u3057\u305f\u308a\u8272\u3005\u3068\u3057\u3066\u304f\u308c\u308b\u3002\nhttps://github.com/tablexi/capistrano3-unicorn/blob/a4adb59031b001a9cd8f9dce5f4beb3200c80f8d/lib/capistrano3/tasks/unicorn.rake\n\nkill\u3068\u306f\n\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb\u306ekill\u306f\u3001\u4efb\u610f\u306e\u30d7\u30ed\u30bb\u30b9\u30fb\u30b0\u30eb\u30fc\u30d7\u3082\u3057\u304f\u306f\u30d7\u30ed\u30bb\u30b9\u306b\u30b7\u30b0\u30ca\u30eb\u3092\u9001\u308b\u306e\u306b\u4f7f\u308f\u308c\u308b\u3002\n\u59cb\u3081\u3066kill\u3068\u3044\u3046\u30b3\u30de\u30f3\u30c9\u3092\u77e5\u3063\u305f\u6642\u306b\u306f\u307f\u3093\u306a\u8aa4\u89e3\u3057\u305f\u306f\u305a\u3002kill\u306f\u30d7\u30ed\u30bb\u30b9\u306b\u547d\u4ee4\u3092\u9001\u308b\u30b3\u30de\u30f3\u30c9(\u6bba\u3059\u3084\u3064\u3058\u3083\u306a\u3044)\n\n\u30b7\u30b0\u30ca\u30eb\u3092\u5168\u90e8\u8ffd\u3046\u3068\u5927\u5909\u306a\u306e\u3067capistrano3-unicorn\u304c\u767a\u884c\u3057\u3066\u3044\u308b\u7269\u3060\u3051\u629c\u7c8b\n\nkill -0\n0\u306f\u30d7\u30ed\u30bb\u30b9\u304c\u3044\u308b\u304b\u3069\u3046\u304b\u78ba\u8a8d\u3059\u308b\u3060\u3051\u3002\n\u30d7\u30ed\u30bb\u30b9\u304c\u3044\u308b\u5834\u5408\u306b\u306f\u3001\u30a8\u30e9\u30fc\u304c\u8fd4\u3063\u3066\u3044\u308b\u3002\n$ ps aux | grep [u]nicorn\nubuntu    1886  0.0  2.7 390020 111700 ?       Sl   12:21   0:05 unicorn master -c /xxx/unicorn/development.rb -E development -D\nubuntu    1899  0.0  2.8 402224 117272 ?       Sl   12:22   0:00 unicorn worker[0] -c /xxx/unicorn/development.rb -E development -D\n\n$ kill -0 1886\n$ echo $?\n0\n\n$ kill -0 1888\n-su: kill: (1888) - No such process\n$ echo $?\n1\n\n[code\u629c\u7c8b] unicorn\u306estart\u6642\u306b\u305d\u3082\u305d\u3082unicorn\u304c\u52d5\u3044\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u78ba\u8a8d\u3059\u308b\u70ba\u306b\u4f7f\u308f\u308c\u3066\u3044\u308b\u3002\ndesc \"Start Unicorn\"\n  task :start do\n    on roles(fetch(:unicorn_roles)) do\n      within current_path do\n        if test(\"[ -e #{fetch(:unicorn_pid)} ] && kill -0 #{pid}\")\n          info \"unicorn is running...\"\n        else\n          with rails_env: fetch(:rails_env) do\n            execute :bundle, \"exec unicorn\", \"-c\", fetch(:unicorn_config_path), \"-E\", fetch(:unicorn_rack_env), \"-D\", fetch(:unicorn_options)\n          end\n        end\n      end\n    end\n  end\n\n\nkill -s QUIT\n\u30ad\u30fc\u30dc\u30fc\u30c9\u306b\u3088\u308b\u4e2d\u6b62\u3002QUIT\u3092\u9001\u308c\u306f\u30d7\u30ed\u30bb\u30b9\u306f\u6b62\u307e\u308b\u3002\n$ ps aux | grep [u]nicorn\nubuntu    1886  0.0  2.7 390020 111700 ?       Sl   12:21   0:05 unicorn master -c /xxx/unicorn/development.rb -E development -D\nubuntu    1899  0.0  2.8 402224 117272 ?       Sl   12:22   0:00 unicorn worker[0] -c /xxx/unicorn/development.rb -E development -D\n\n$ kill -s QUIT 1886\n$ ps aux | grep [u]nicorn | wc -l\n0\n\n[code\u629c\u7c8b] unicorn\u3092stop\u3059\u308b\u6642\u306b\u4f7f\u308f\u308c\u3066\u3044\u308b\u3002\ndesc \"Stop Unicorn (QUIT)\"\n  task :stop do\n    on roles(fetch(:unicorn_roles)) do\n      within current_path do\n        if test(\"[ -e #{fetch(:unicorn_pid)} ]\")\n          if test(\"kill -0 #{pid}\")\n            info \"stopping unicorn...\"\n            execute :kill, \"-s QUIT\", pid\n          else\n            info \"cleaning up dead unicorn pid...\"\n            execute :rm, fetch(:unicorn_pid)\n          end\n        else\n          info \"unicorn is not running...\"\n        end\n      end\n    end\n  end\n\n\nkill -s HUP\n\u5236\u5fa1\u7aef\u672b(controlling terminal)\u306e\u30cf\u30f3\u30b0\u30a2\u30c3\u30d7\u691c\u51fa\u3001\n\u307e\u305f\u306f\u5236\u5fa1\u3057\u3066\u3044\u308b\u30d7\u30ed\u30bb\u30b9\u306e\u6b7b\nkill\u3067\u30b7\u30b0\u30ca\u30eb\u3092\u53d7\u3051\u53d6\u3063\u305f\u5834\u5408\u306e\u6319\u52d5\u306f\u3001\u66f8\u304b\u308c\u3066\u3044\u308b\u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u3088\u308a\u7570\u306a\u308b\u304c\u3001HUP\u3092\u53d7\u3051\u53d6\u308b\u3068config\u3092\u8aad\u307f\u76f4\u3057\u3066\u30ea\u30ed\u30fc\u30c9\u3059\u308b\u8a2d\u8a08\u304c\u591a\u304f\u898b\u3089\u308c\u308b\u3002\nunicorn\u3082\u305d\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\u89aa\u30d7\u30ed\u30bb\u30b9\u306bHUP\u3092\u9001\u308b\u3068config\u3092\u8aad\u307f\u76f4\u3057\u3066\u5b50\u30d7\u30ed\u30bb\u30b9\u304c\u65b0\u3057\u304f\u8d77\u52d5\u3057\u3066\u3044\u308b(pid\u304c\u5909\u308f\u3063\u3066\u3044\u308b)\n$ ps aux | grep [u]nicorn\nubuntu    2056 42.1  2.7 323096 111164 ?       Sl   14:25   0:04 unicorn master -c /xxx/unicorn/development.rb -D -E development\nubuntu    2061  0.0  2.6 323096 105848 ?       Sl   14:25   0:00 unicorn worker[0] -c /xxx/unicorn/development.rb -D -E development\n\n$ kill -s HUP 2056\n\n$ ps aux | grep [u]nicorn\nubuntu    2056  6.0  2.7 388632 111244 ?       Sl   14:25   0:04 unicorn master -c /xxx/unicorn/development.rb -D -E development\nubuntu    2066  0.0  2.6 388632 105856 ?       Sl   14:26   0:00 unicorn worker[0] -c /xxx/unicorn/development.rb -D -E development\n\n[code\u629c\u7c8b] unicorn\u306ereload\u3067\u4f7f\u308f\u308c\u3066\u3044\u308b\ndesc \"Reload Unicorn (HUP); use this when preload_app: false\"\n  task :reload do\n    invoke \"unicorn:start\"\n    on roles(fetch(:unicorn_roles)) do\n      within current_path do\n        info \"reloading...\"\n        execute :kill, \"-s HUP\", pid\n      end\n    end\n  end\n\n\nkill -s USR2\n\u30e6\u30fc\u30b6\u30fc\u5b9a\u7fa9\u30b7\u30b0\u30ca\u30eb\u3002\n\u3053\u308c\u3082\u5b9f\u88c5\u5074\u3067\u6319\u52d5\u3092\u6c7a\u3081\u308b\u3002unicorn\u306e\u306f\u5408\u3044USR2\u3092\u53d7\u3051\u53d6\u308b\u3068\u89aa\u30d7\u30ed\u30bb\u30b9\u3054\u3068\u65b0\u3057\u304f\u751f\u307e\u308c\u5909\u308f\u308b\u3002\n\u5b9f\u969b\u306b\u6253\u3063\u3066\u307f\u308b\u3068\u78ba\u304b\u306b\u3001\u89aa\u30d7\u30ed\u30bb\u30b9\u306epid\u304c\u5909\u308f\u3063\u3066\u3044\u308b\u3002\n$ ps aux | grep [u]nicorn\nubuntu    2056  2.1  2.7 388632 111244 ?       Sl   14:25   0:04 unicorn master -c /xxx/unicorn/development.rb -D -E development\nubuntu    2066  0.0  2.6 388632 105856 ?       Sl   14:26   0:00 unicorn worker[0] -c /xxx/unicorn/development.rb -D -E development\n\n$ kill -s USR2 2056\n\n$ ps aux | grep [u]nicorn\nubuntu    2073 32.3  2.7 389848 111600 ?       Sl   14:29   0:05 unicorn master -c /xxx/unicorn/development.rb -D -E development\nubuntu    2084  0.0  2.5 390000 105020 ?       Sl   14:29   0:00 unicorn worker[0] -c /xxx/unicorn/development.rb -D -E development\n\n[code\u629c\u7c8b] unicorn\u306erestart\u3067\u4f7f\u308f\u308c\u3066\u3044\u308b\ndesc \"Restart Unicorn (USR2); use this when preload_app: true\"\n  task :restart do\n    invoke \"unicorn:start\"\n    on roles(fetch(:unicorn_roles)) do\n      within current_path do\n        info \"unicorn restarting...\"\n        execute :kill, \"-s USR2\", pid\n      end\n    end\n  end\n\n\nkill -s TTIN / TTOU\n\u30d0\u30c3\u30af\u30b0\u30e9\u30f3\u30c9\u30d7\u30ed\u30bb\u30b9\u306e\u7aef\u672b\u5165\u529b / \u51fa\u529b\nunicorn\u306b\u9001\u3063\u3066\u307f\u308b\u3068\u306a\u304b\u306a\u304b\u9762\u767d\u304f\u3001\u5b50\u30d7\u30ed\u30bb\u30b9\u304c\u5897\u3048\u305f\u308a\u6e1b\u3063\u305f\u308a\u3059\u308b\u3002\n\u3053\u308c\u306f\u76f8\u5f53\u4fbf\u5229\u3067\u306f\u306a\u3044\u304b\uff01\n\u3067\u3082\u3001TTIN\u3067\u751f\u307e\u308c\u305f\u5b50\u30d7\u30ed\u30bb\u30b9\u3060\u3051\u8a2d\u5b9a\u304c\u65b0\u3057\u3044\u3068\u304b\u3001\u8d77\u304d\u305d\u3046\u3002\n$ kill -s TTIN 2073\n$ ps aux | grep [u]nicorn\nubuntu    2073  0.5  2.7 389848 111632 ?       Sl   14:32   0:05 unicorn master -c /xxx/unicorn/development.rb -D -E development\nubuntu    2084  0.0  2.5 390000 105020 ?       Sl   14:32   0:00 unicorn worker[0] -c /xxx/unicorn/development.rb -D -E development\nubuntu    2103  0.0  2.5 389980 104968 ?       Sl   14:48   0:00 unicorn worker[1] -c /xxx/unicorn/development.rb -D -E development\n\n$ kill -s TTOU 2073\n$ ps aux | grep [u]nicorn\nubuntu    2073  0.5  2.7 389848 111640 ?       Sl   14:32   0:05 unicorn master -c config/unicorn/development.rb -D -E development                                                         \nubuntu    2084  0.0  2.5 390000 105020 ?       Sl   14:32   0:00 unicorn worker[0] -c config/unicorn/development.rb -D -E development\n\n[code\u629c\u7c8b] \u5f53\u7136unicorn\u3067\u30d7\u30ed\u30bb\u30b9\u5897\u3084\u3057\u305f\u308a\u6e1b\u3089\u3057\u305f\u308a\u3059\u308b\u6642\u306b\u4f7f\u3046\u3002\ndesc \"Add a worker (TTIN)\"\n  task :add_worker do\n    on roles(fetch(:unicorn_roles)) do\n      within current_path do\n        info \"adding worker\"\n        execute :kill, \"-s TTIN\", pid\n      end\n    end\n  end\n\n  desc \"Remove a worker (TTOU)\"\n  task :remove_worker do\n    on roles(fetch(:unicorn_roles)) do\n      within current_path do\n        info \"removing worker\"\n        execute :kill, \"-s TTOU\", pid\n      end\n    end\n  end\nend\n\n\n\u307e\u3068\u3081\nunicorn\u304c\u53d7\u3051\u53d6\u308b\u30b7\u30b0\u30ca\u30eb\u3068\u305d\u306e\u6319\u52d5\u3092\u77e5\u3063\u3066\u3044\u308c\u3070\u3001\u7dca\u6025\u6642\u306b\u3061\u3087\u3063\u3068\u30d7\u30ed\u30bb\u30b9\u5897\u3084\u3059\u3068\u304b\u6e1b\u3089\u3059\u3068\u304b\u3001\u8a2d\u5b9a\u3092\u8aad\u307f\u76f4\u3059\u3068\u304b\u304c\u3055\u304f\u3063\u3068\u51fa\u6765\u308b\u306e\u3067\u77e5\u3063\u3066\u3044\u3066\u640d\u306f\u306a\u3055\u305d\u3046\u3067\u3059\u306d\u3002\n\n# capistrano3-unicorn\ncapistrano + rails + unicorn\u3068\u3044\u3046\u69cb\u6210\u306e\u6642\u306b\u3001unicorn\u3092\u8272\u3005\u3068\u64cd\u4f5c\u3059\u308b\u3084\u3064\u3002\nunicorn\u3092\u518d\u8d77\u52d5\u3057\u305f\u308a\u8272\u3005\u3068\u3057\u3066\u304f\u308c\u308b\u3002\nhttps://github.com/tablexi/capistrano3-unicorn/blob/a4adb59031b001a9cd8f9dce5f4beb3200c80f8d/lib/capistrano3/tasks/unicorn.rake\n\n# kill\u3068\u306f\n\n\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb\u306ekill\u306f\u3001\u4efb\u610f\u306e\u30d7\u30ed\u30bb\u30b9\u30fb\u30b0\u30eb\u30fc\u30d7\u3082\u3057\u304f\u306f\u30d7\u30ed\u30bb\u30b9\u306b\u30b7\u30b0\u30ca\u30eb\u3092\u9001\u308b\u306e\u306b\u4f7f\u308f\u308c\u308b\u3002\n<font color=red>\u59cb\u3081\u3066kill\u3068\u3044\u3046\u30b3\u30de\u30f3\u30c9\u3092\u77e5\u3063\u305f\u6642\u306b\u306f\u307f\u3093\u306a\u8aa4\u89e3\u3057\u305f\u306f\u305a\u3002kill\u306f\u30d7\u30ed\u30bb\u30b9\u306b\u547d\u4ee4\u3092\u9001\u308b\u30b3\u30de\u30f3\u30c9(\u6bba\u3059\u3084\u3064\u3058\u3083\u306a\u3044)</red>\n\n# \u30b7\u30b0\u30ca\u30eb\u3092\u5168\u90e8\u8ffd\u3046\u3068\u5927\u5909\u306a\u306e\u3067capistrano3-unicorn\u304c\u767a\u884c\u3057\u3066\u3044\u308b\u7269\u3060\u3051\u629c\u7c8b\n\n## kill -0\n\n0\u306f\u30d7\u30ed\u30bb\u30b9\u304c\u3044\u308b\u304b\u3069\u3046\u304b\u78ba\u8a8d\u3059\u308b\u3060\u3051\u3002\n\u30d7\u30ed\u30bb\u30b9\u304c\u3044\u308b\u5834\u5408\u306b\u306f\u3001\u30a8\u30e9\u30fc\u304c\u8fd4\u3063\u3066\u3044\u308b\u3002\n\n```\n$ ps aux | grep [u]nicorn\nubuntu    1886  0.0  2.7 390020 111700 ?       Sl   12:21   0:05 unicorn master -c /xxx/unicorn/development.rb -E development -D\nubuntu    1899  0.0  2.8 402224 117272 ?       Sl   12:22   0:00 unicorn worker[0] -c /xxx/unicorn/development.rb -E development -D\n\n$ kill -0 1886\n$ echo $?\n0\n\n$ kill -0 1888\n-su: kill: (1888) - No such process\n$ echo $?\n1\n```\n\n[code\u629c\u7c8b] unicorn\u306estart\u6642\u306b\u305d\u3082\u305d\u3082unicorn\u304c\u52d5\u3044\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u78ba\u8a8d\u3059\u308b\u70ba\u306b\u4f7f\u308f\u308c\u3066\u3044\u308b\u3002\n\n```\ndesc \"Start Unicorn\"\n  task :start do\n    on roles(fetch(:unicorn_roles)) do\n      within current_path do\n        if test(\"[ -e #{fetch(:unicorn_pid)} ] && kill -0 #{pid}\")\n          info \"unicorn is running...\"\n        else\n          with rails_env: fetch(:rails_env) do\n            execute :bundle, \"exec unicorn\", \"-c\", fetch(:unicorn_config_path), \"-E\", fetch(:unicorn_rack_env), \"-D\", fetch(:unicorn_options)\n          end\n        end\n      end\n    end\n  end\n```\n\n\n## kill -s QUIT\n\n\u30ad\u30fc\u30dc\u30fc\u30c9\u306b\u3088\u308b\u4e2d\u6b62\u3002QUIT\u3092\u9001\u308c\u306f\u30d7\u30ed\u30bb\u30b9\u306f\u6b62\u307e\u308b\u3002\n\n```\n$ ps aux | grep [u]nicorn\nubuntu    1886  0.0  2.7 390020 111700 ?       Sl   12:21   0:05 unicorn master -c /xxx/unicorn/development.rb -E development -D\nubuntu    1899  0.0  2.8 402224 117272 ?       Sl   12:22   0:00 unicorn worker[0] -c /xxx/unicorn/development.rb -E development -D\n\n$ kill -s QUIT 1886\n$ ps aux | grep [u]nicorn | wc -l\n0\n```\n\n[code\u629c\u7c8b] unicorn\u3092stop\u3059\u308b\u6642\u306b\u4f7f\u308f\u308c\u3066\u3044\u308b\u3002\n\n```\ndesc \"Stop Unicorn (QUIT)\"\n  task :stop do\n    on roles(fetch(:unicorn_roles)) do\n      within current_path do\n        if test(\"[ -e #{fetch(:unicorn_pid)} ]\")\n          if test(\"kill -0 #{pid}\")\n            info \"stopping unicorn...\"\n            execute :kill, \"-s QUIT\", pid\n          else\n            info \"cleaning up dead unicorn pid...\"\n            execute :rm, fetch(:unicorn_pid)\n          end\n        else\n          info \"unicorn is not running...\"\n        end\n      end\n    end\n  end\n```\n\n## kill -s HUP\n\n\u5236\u5fa1\u7aef\u672b(controlling terminal)\u306e\u30cf\u30f3\u30b0\u30a2\u30c3\u30d7\u691c\u51fa\u3001\n\u307e\u305f\u306f\u5236\u5fa1\u3057\u3066\u3044\u308b\u30d7\u30ed\u30bb\u30b9\u306e\u6b7b\nkill\u3067\u30b7\u30b0\u30ca\u30eb\u3092\u53d7\u3051\u53d6\u3063\u305f\u5834\u5408\u306e\u6319\u52d5\u306f\u3001\u66f8\u304b\u308c\u3066\u3044\u308b\u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u3088\u308a\u7570\u306a\u308b\u304c\u3001HUP\u3092\u53d7\u3051\u53d6\u308b\u3068config\u3092\u8aad\u307f\u76f4\u3057\u3066\u30ea\u30ed\u30fc\u30c9\u3059\u308b\u8a2d\u8a08\u304c\u591a\u304f\u898b\u3089\u308c\u308b\u3002\nunicorn\u3082\u305d\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n\u89aa\u30d7\u30ed\u30bb\u30b9\u306bHUP\u3092\u9001\u308b\u3068config\u3092\u8aad\u307f\u76f4\u3057\u3066\u5b50\u30d7\u30ed\u30bb\u30b9\u304c\u65b0\u3057\u304f\u8d77\u52d5\u3057\u3066\u3044\u308b(pid\u304c\u5909\u308f\u3063\u3066\u3044\u308b)\n\n```\n$ ps aux | grep [u]nicorn\nubuntu    2056 42.1  2.7 323096 111164 ?       Sl   14:25   0:04 unicorn master -c /xxx/unicorn/development.rb -D -E development\nubuntu    2061  0.0  2.6 323096 105848 ?       Sl   14:25   0:00 unicorn worker[0] -c /xxx/unicorn/development.rb -D -E development\n\n$ kill -s HUP 2056\n\n$ ps aux | grep [u]nicorn\nubuntu    2056  6.0  2.7 388632 111244 ?       Sl   14:25   0:04 unicorn master -c /xxx/unicorn/development.rb -D -E development\nubuntu    2066  0.0  2.6 388632 105856 ?       Sl   14:26   0:00 unicorn worker[0] -c /xxx/unicorn/development.rb -D -E development\n```\n\n[code\u629c\u7c8b] unicorn\u306ereload\u3067\u4f7f\u308f\u308c\u3066\u3044\u308b\n\n```\ndesc \"Reload Unicorn (HUP); use this when preload_app: false\"\n  task :reload do\n    invoke \"unicorn:start\"\n    on roles(fetch(:unicorn_roles)) do\n      within current_path do\n        info \"reloading...\"\n        execute :kill, \"-s HUP\", pid\n      end\n    end\n  end\n```\n\n## kill -s USR2\n\n\u30e6\u30fc\u30b6\u30fc\u5b9a\u7fa9\u30b7\u30b0\u30ca\u30eb\u3002\n\u3053\u308c\u3082\u5b9f\u88c5\u5074\u3067\u6319\u52d5\u3092\u6c7a\u3081\u308b\u3002unicorn\u306e\u306f\u5408\u3044USR2\u3092\u53d7\u3051\u53d6\u308b\u3068\u89aa\u30d7\u30ed\u30bb\u30b9\u3054\u3068\u65b0\u3057\u304f\u751f\u307e\u308c\u5909\u308f\u308b\u3002\n\n\u5b9f\u969b\u306b\u6253\u3063\u3066\u307f\u308b\u3068\u78ba\u304b\u306b\u3001\u89aa\u30d7\u30ed\u30bb\u30b9\u306epid\u304c\u5909\u308f\u3063\u3066\u3044\u308b\u3002\n\n```\n$ ps aux | grep [u]nicorn\nubuntu    2056  2.1  2.7 388632 111244 ?       Sl   14:25   0:04 unicorn master -c /xxx/unicorn/development.rb -D -E development\nubuntu    2066  0.0  2.6 388632 105856 ?       Sl   14:26   0:00 unicorn worker[0] -c /xxx/unicorn/development.rb -D -E development\n\n$ kill -s USR2 2056\n\n$ ps aux | grep [u]nicorn\nubuntu    2073 32.3  2.7 389848 111600 ?       Sl   14:29   0:05 unicorn master -c /xxx/unicorn/development.rb -D -E development\nubuntu    2084  0.0  2.5 390000 105020 ?       Sl   14:29   0:00 unicorn worker[0] -c /xxx/unicorn/development.rb -D -E development\n```\n\n[code\u629c\u7c8b] unicorn\u306erestart\u3067\u4f7f\u308f\u308c\u3066\u3044\u308b\n\n```\ndesc \"Restart Unicorn (USR2); use this when preload_app: true\"\n  task :restart do\n    invoke \"unicorn:start\"\n    on roles(fetch(:unicorn_roles)) do\n      within current_path do\n        info \"unicorn restarting...\"\n        execute :kill, \"-s USR2\", pid\n      end\n    end\n  end\n```\n\n## kill -s TTIN / TTOU\n\n\u30d0\u30c3\u30af\u30b0\u30e9\u30f3\u30c9\u30d7\u30ed\u30bb\u30b9\u306e\u7aef\u672b\u5165\u529b / \u51fa\u529b\nunicorn\u306b\u9001\u3063\u3066\u307f\u308b\u3068\u306a\u304b\u306a\u304b\u9762\u767d\u304f\u3001\u5b50\u30d7\u30ed\u30bb\u30b9\u304c\u5897\u3048\u305f\u308a\u6e1b\u3063\u305f\u308a\u3059\u308b\u3002\n<font color=red>\u3053\u308c\u306f\u76f8\u5f53\u4fbf\u5229\u3067\u306f\u306a\u3044\u304b\uff01</font>\n\u3067\u3082\u3001TTIN\u3067\u751f\u307e\u308c\u305f\u5b50\u30d7\u30ed\u30bb\u30b9\u3060\u3051\u8a2d\u5b9a\u304c\u65b0\u3057\u3044\u3068\u304b\u3001\u8d77\u304d\u305d\u3046\u3002\n\n```\n$ kill -s TTIN 2073\n$ ps aux | grep [u]nicorn\nubuntu    2073  0.5  2.7 389848 111632 ?       Sl   14:32   0:05 unicorn master -c /xxx/unicorn/development.rb -D -E development\nubuntu    2084  0.0  2.5 390000 105020 ?       Sl   14:32   0:00 unicorn worker[0] -c /xxx/unicorn/development.rb -D -E development\nubuntu    2103  0.0  2.5 389980 104968 ?       Sl   14:48   0:00 unicorn worker[1] -c /xxx/unicorn/development.rb -D -E development\n\n$ kill -s TTOU 2073\n$ ps aux | grep [u]nicorn\nubuntu    2073  0.5  2.7 389848 111640 ?       Sl   14:32   0:05 unicorn master -c config/unicorn/development.rb -D -E development                                                         \nubuntu    2084  0.0  2.5 390000 105020 ?       Sl   14:32   0:00 unicorn worker[0] -c config/unicorn/development.rb -D -E development\n```\n\n[code\u629c\u7c8b] \u5f53\u7136unicorn\u3067\u30d7\u30ed\u30bb\u30b9\u5897\u3084\u3057\u305f\u308a\u6e1b\u3089\u3057\u305f\u308a\u3059\u308b\u6642\u306b\u4f7f\u3046\u3002\n\n```\ndesc \"Add a worker (TTIN)\"\n  task :add_worker do\n    on roles(fetch(:unicorn_roles)) do\n      within current_path do\n        info \"adding worker\"\n        execute :kill, \"-s TTIN\", pid\n      end\n    end\n  end\n\n  desc \"Remove a worker (TTOU)\"\n  task :remove_worker do\n    on roles(fetch(:unicorn_roles)) do\n      within current_path do\n        info \"removing worker\"\n        execute :kill, \"-s TTOU\", pid\n      end\n    end\n  end\nend\n```\n\n# \u307e\u3068\u3081\nunicorn\u304c\u53d7\u3051\u53d6\u308b\u30b7\u30b0\u30ca\u30eb\u3068\u305d\u306e\u6319\u52d5\u3092\u77e5\u3063\u3066\u3044\u308c\u3070\u3001\u7dca\u6025\u6642\u306b\u3061\u3087\u3063\u3068\u30d7\u30ed\u30bb\u30b9\u5897\u3084\u3059\u3068\u304b\u6e1b\u3089\u3059\u3068\u304b\u3001\u8a2d\u5b9a\u3092\u8aad\u307f\u76f4\u3059\u3068\u304b\u304c\u3055\u304f\u3063\u3068\u51fa\u6765\u308b\u306e\u3067\u77e5\u3063\u3066\u3044\u3066\u640d\u306f\u306a\u3055\u305d\u3046\u3067\u3059\u306d\u3002\n", "tags": ["unicorn", "capistrano", "Rails", "kill"]}