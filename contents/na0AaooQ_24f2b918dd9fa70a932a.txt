{"context": "\n\n\u306f\u3058\u3081\u306b\n\u8907\u6570\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u904b\u7528\u3057\u3066\u3044\u3066\u3001\u5225\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u3042\u308bS3\u30d0\u30b1\u30c3\u30c8\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u3044\u4e8b\u304c\u3042\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\u672c\u30da\u30fc\u30b8\u3067\u306f\u30012\u3064\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u9593\u3067\u3001\u5225\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u3042\u308bS3\u30d0\u30b1\u30c3\u30c8\u3078\u306e\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3092\u8a31\u53ef\u3059\u308b\u8a2d\u5b9a\u3001\u5b9f\u969b\u306bS3\u30d0\u30b1\u30c3\u30c8\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u624b\u9806\u306b\u3064\u3044\u3066\u8a18\u8f09\u81f4\u3057\u307e\u3059\u3002\n\u672c\u30da\u30fc\u30b8\u3067\u306f\u3001\u4e3b\u306b\u4ee5\u4e0b\u306e\u624b\u9806\u3084\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u8a18\u8f09\u81f4\u3057\u307e\u3059\u3002\n\u3000[1] AssumeRole\u3084IAM\u30ed\u30fc\u30eb\u7b49\u306e\u8a2d\u5b9a\u306b\u3088\u308a\u3001AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u9593\u3067S3\u30d0\u30b1\u30c3\u30c8\u3078\u306e\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3092\u8a31\u53ef\u3059\u308b\u8a2d\u5b9a\u3002\n\u3000[2] AWS CLI(aws s3 cp\u30b3\u30de\u30f3\u30c9)\u3067S3\u30d0\u30b1\u30c3\u30c8\u3078\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u6642\u306b\u5fc5\u8981\u3068\u306a\u308b\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u306e\u81ea\u52d5\u53d6\u5f97\u8a2d\u5b9a\u3002aws sts assume-role\u30b3\u30de\u30f3\u30c9\u3092\u90fd\u5ea6\u5b9f\u884c\u305b\u305a\u306bAssumeRole\u30ad\u30fc\u3092\u81ea\u52d5\u7684\u306b\u53d6\u5f97\u3059\u308b\u3088\u3046\u8a2d\u5b9a(\u81ea\u52d5\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u53d6\u5f97\u8a2d\u5b9a)\u3002\n\u3000[3] S3\u30d0\u30b1\u30c3\u30c8\u306b\u7279\u5b9aIP\u30a2\u30c9\u30ec\u30b9\u304b\u3089\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u8a2d\u5b9a\u3002\n\u3000[4] \u5b9f\u969b\u306bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u5225\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u3042\u308bS3\u30d0\u30b1\u30c3\u30c8\u3078aws s3 cp\u30b3\u30de\u30f3\u30c9\u3067\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u624b\u9806\u3002\n\u3000[5] S3\u30d0\u30b1\u30c3\u30c8\u304c\u3042\u308bAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u5074\u3067\u306f\u3001\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3084\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u306e\u767a\u884c\u3092\u305b\u305a\u3001S3\u306e\u30af\u30ed\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u30d0\u30b1\u30c3\u30c8\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u3092\u5b9f\u73fe\u3059\u308b\u8a2d\u5b9a\u3002\n\n\u672c\u624b\u9806\u304c\u5fc5\u8981\u306b\u306a\u308b\u30b1\u30fc\u30b9\u306e\u4e00\u4f8b\n\u901a\u5e38\u30012\u3064\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u9593\u3067\u3001\u4ed6\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u3042\u308bS3\u30d0\u30b1\u30c3\u30c8\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u3060\u3051\u306a\u3089\u3001IAM\u30ed\u30fc\u30eb\u306b\u3088\u308bS3\u30d0\u30b1\u30c3\u30c8\u306e\u30af\u30ed\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u8a2d\u5b9a\u3092\u884c\u306a\u3046\u4e8b\u3067\u3001S3\u30d0\u30b1\u30c3\u30c8\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002\nhttp://docs.aws.amazon.com/ja_jp/AmazonS3/latest/dev/example-walkthroughs-managing-access-example3.html\n\u3057\u304b\u3057\u3001\u5404AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306eS3\u30d0\u30b1\u30c3\u30c8\u904b\u7528\u72b6\u6cc1\u3084\u30dd\u30ea\u30b7\u30fc\u306b\u3088\u3063\u3066\u306f\u3001S3\u30d0\u30b1\u30c3\u30c8\u306b\u7279\u5b9a\u306e\u30dd\u30ea\u30b7\u30fc\u3001\u4f8b\u3048\u3070\u300cAWS\u4ee5\u5916\u306e\u7279\u5b9aIP\u30a2\u30c9\u30ec\u30b9\u306e\u30b5\u30fc\u30d0\u306b\u5bfe\u3057\u3066\u3001S3\u30d0\u30b1\u30c3\u30c8\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3092\u8a31\u53ef\u3059\u308b\u300d\u3088\u3046\u306aS3\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u4e8b\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\nAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u304b\u3089\u5225\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306eS3\u30d0\u30b1\u30c3\u30c8\u3078\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306b\u3064\u3044\u3066\u306f\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6240\u6709\u8005\u304c\u300c\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305fAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u300d\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6240\u6709\u8005\u3068S3\u30d0\u30b1\u30c3\u30c8\u6240\u6709\u8005\u3068AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u7570\u306a\u308b\u70ba\u3001S3\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u304c\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306b\u9069\u7528\u3055\u308c\u306a\u3044\u30b1\u30fc\u30b9\u304c\u3042\u308a\u307e\u3059\u3002\nhttps://blog.cloudpack.jp/2014/08/04/allow-other-account-to-write-to-amazon-s3/\nhttp://muramasa64.fprog.org/diary/?date=20140731\n\u3053\u306e\u3088\u3046\u306a\u30b1\u30fc\u30b9\u306e\u5834\u5408\u3001AssumeRole\u3092\u7528\u3044\u308b\u4e8b\u3067\u3001\u5225\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306eS3\u30d0\u30b1\u30c3\u30c8\u3078\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306b\u3064\u3044\u3066\u3082\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6240\u6709\u8005\u3092\u300c\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305fAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u306f\u306a\u304f\u3001S3\u30d0\u30b1\u30c3\u30c8\u304c\u3042\u308bAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u300d\u306b\u3059\u308b\u4e8b\u304c\u51fa\u6765\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6240\u6709\u8005\u304c\u30d0\u30b1\u30c3\u30c8\u6240\u6709\u8005\u3068\u540c\u3058AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u306a\u308b\u306e\u3067\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306bS3\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u304c\u9069\u7528\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u4ed6\u306b\u3082\u3001\u5404AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u7ba1\u7406\u8005\u304c\u5b58\u5728\u3057\u3001\u305d\u308c\u305e\u308c\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u904b\u7528\u30eb\u30fc\u30eb\u3092\u5b9a\u3081\u3066\u3044\u308b\u5834\u5408\u3001\u4f8b\u3048\u3070S3\u30d0\u30b1\u30c3\u30c8\u3092\u6240\u6709\u3059\u308bAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u306f\u300c\u4ed6\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u5411\u3051\u306b\u3001S3\u30d0\u30b1\u30c3\u30c8\u3078\u306e\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3092\u8a31\u53ef\u3059\u308b\u30a2\u30af\u30bb\u30b9\u30ad\u30fcID\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u306f\u767a\u884c\u3057\u306a\u3044\u300d\u3068\u3044\u3046\u904b\u7528\u3092\u884c\u3063\u3066\u3044\u308b\u30b1\u30fc\u30b9\u3082\u3042\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u306e\u3088\u3046\u306a\u30b1\u30fc\u30b9\u306e\u5834\u5408\u3067\u3082\u3001\u672c\u624b\u9806\u306b\u3088\u308a\u3001S3\u30d0\u30b1\u30c3\u30c8\u3092\u6240\u6709\u3059\u308bAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u5074\u3067\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3084\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u3092\u767a\u884c\u305b\u305a\u306b\u3001\u5225\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u304b\u3089S3\u30d0\u30b1\u30c3\u30c8\u3078\u306e\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u672c\u624b\u9806\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u8868\u8a18\u306b\u3064\u3044\u3066\n\u672c\u624b\u9806\u3067\u306f\u3001AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u300cexample-s3-owner-account\u300d\u306b\u3042\u308bS3\u30d0\u30b1\u30c3\u30c8\u300cexample-s3-bucket\u300d\u306b\u5bfe\u3057\u3066\u3001AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u300cexample-s3-upload-account\u300d\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u300cexample-server\u300d\u304b\u3089S3\u30d0\u30b1\u30c3\u30c8\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u307e\u3067\u306e\u624b\u9806\u3092\u8a18\u8f09\u81f4\u3057\u307e\u3059\u3002\n\u3000example-s3-owner-account\u30a2\u30ab\u30a6\u30f3\u30c8\u306es3://example-s3-bucket\u30d0\u30b1\u30c3\u30c8\n\u3000\u3000\u3000\u3000\u3000\u2191\n\u3000\u3000s3://example-s3-bucket/\u30d0\u30b1\u30c3\u30c8\u3078\u306e\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\u3000\u3000\u3000\u3000\u3000\u2191\n\u3000example-s3-upload-account\u30a2\u30ab\u30a6\u30f3\u30c8\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u300cexample-server\u300d\nAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u540d\u3084AWS\u30a2\u30ab\u30a6\u30f3\u30c8ID\u7b49\u306b\u3064\u3044\u3066\u306f\u3001\u4f8b\u793a\u7528\u3068\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a18\u8f09\u3055\u305b\u3066\u9802\u304d\u307e\u3059\u3002\n\n\n\nAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u6982\u8981\nAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u540d\nAWS\u30a2\u30ab\u30a6\u30f3\u30c8ID\n\n\n\n\nS3\u306b\u30a2\u30af\u30bb\u30b9\u3055\u308c\u308b\u5074\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8 (S3\u30d0\u30b1\u30c3\u30c8\u304c\u3042\u308bAWS\u30a2\u30ab\u30a6\u30f3\u30c8)\nexample-s3-owner-account\n111111111111\n\n\nS3\u3078\u30a2\u30af\u30bb\u30b9\u3059\u308b\u5074\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8 (S3\u30d0\u30b1\u30c3\u30c8\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308bAWS\u30a2\u30ab\u30a6\u30f3\u30c8)\nexample-s3-upload-account\n999999999999\n\n\n\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u6642\u306b\u4f7f\u7528\u3057\u305fAMI\n\u30fbAmazon Linux AMI 2015.09.2 (HVM), SSD Volume Type - ami-59bdb937\n\nS3\u3078\u306e\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u4f7f\u7528\u3059\u308bAWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n[root@example-server ~]# aws --version\naws-cli/1.10.8 Python/2.7.10 Linux/4.1.19-24.31.amzn1.x86_64 botocore/1.3.30\n\n\n\u53c2\u8003\u30b5\u30a4\u30c8\n\u672c\u624b\u9806\u306e\u4f5c\u6210\u306b\u3042\u305f\u308a\u3001\u4ee5\u4e0b\u306e\u624b\u9806\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\n\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f\u3002\nAWS\u516c\u5f0f\nhttp://docs.aws.amazon.com/ja_jp/AmazonS3/latest/dev/example-walkthroughs-managing-access-example2.html\nhttp://docs.aws.amazon.com/ja_jp/AmazonS3/latest/dev/example-walkthroughs-managing-access-example3.html\nhttp://dev.classmethod.jp/cloud/aws/aws-cli-supports-assume-role-credentials-provider-and-mfa/\nAWS CLI\u304cAssumeRole\u306b\u3088\u308b\u81ea\u52d5\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u53d6\u5f97\u3068MFA\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\uff01\nhttp://qiita.com/web_se/items/879a235a47991cae7b69\nCross-Account Role \u81ea\u52d5\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u53d6\u5f97\u6a5f\u80fd\nhttp://yustam.hatenablog.com/entry/2015/02/07/135105\n\u4ed6\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3078S3\u30d0\u30b1\u30c3\u30c8\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3059\u308b\nhttps://blog.cloudpack.jp/2014/08/04/allow-other-account-to-write-to-amazon-s3/\nhttp://muramasa64.fprog.org/diary/?date=20140731\nAmazon S3\u306b\u5225\u30a2\u30ab\u30a6\u30f3\u30c8\u304b\u3089\u66f8\u304d\u8fbc\u307f\u3092\u8a31\u53ef\u3059\u308b\u5834\u5408\u306e\u8a2d\u5b9a\n\nS3\u306b\u30a2\u30af\u30bb\u30b9\u3055\u308c\u308b\u5074\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8(example-s3-owner-account)\u3067\u306e\u8a2d\u5b9a\nS3\u306b\u30a2\u30af\u30bb\u30b9\u3055\u308c\u308b\u5074\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8(example-s3-owner-account)\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3001S3\u30d0\u30b1\u30c3\u30c8\u4f5c\u6210\u3084\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u8a2d\u5b9a\u3001IAM\u30dd\u30ea\u30b7\u30fc\u3084IAM\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n(1)\u300cexample-s3-owner-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306bS3\u30d0\u30b1\u30c3\u30c8\u300cexample-s3-bucket\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u30fbAWS Management Console\u3067\u300cexample-s3-owner-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\u30fb\u300cS3\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u300c\u30d0\u30b1\u30c3\u30c8\u3092\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fbS3\u30d0\u30b1\u30c3\u30c8\u300cexample-s3-bucket\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u5f8c\u3067\u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5148\u3068\u3057\u3066\u4f7f\u7528\u3059\u308bupload\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u304a\u304d\u307e\u3059\u3002\ns3://example-s3-bucket/upload/\n\u30fbS3\u30d0\u30b1\u30c3\u30c8\u300cexample-s3-bucket\u300d\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\nS3\u30d0\u30b1\u30c3\u30c8\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u5f8c\u3067\u3001curl\u30b3\u30de\u30f3\u30c9\u3067\u30d5\u30a1\u30a4\u30eb\u3078\u30a2\u30af\u30bb\u30b9\u51fa\u6765\u308b\u304b\u30c6\u30b9\u30c8\u3059\u308b\u70ba\u3001\u300caws:SourceIp\u300d\u3067\u7279\u5b9aIP\u30a2\u30c9\u30ec\u30b9(192.0.2.100/32\u3001192.0.2.101/32)\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u306e\u307f\u8a31\u53ef\u3057\u307e\u3059\u3002\n\nexample-s3-owner-account-example-s3-bucket-policy\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\n{\n    \"Version\": \"2008-10-17\",\n    \"Id\": \"example-s3-owner-account-example-s3-bucket-policy\",\n    \"Statement\": [\n        {\n            \"Sid\": \"example-s3-bucket-20160316-001\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": \"*\"\n            },\n            \"Action\": \"s3:GetObject\",\n            \"Resource\": \"arn:aws:s3:::example-s3-bucket/*\",\n            \"Condition\": {\n                \"IpAddress\": {\n                    \"aws:SourceIp\": [\n                        \"192.0.2.100/32\",\n                        \"192.0.2.101/32\"\n                    ]\n                }\n            }\n        }\n    ]\n}\n\n\n\n(2)\u300cexample-s3-owner-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306bS3\u30d0\u30b1\u30c3\u30c8\u3078\u306e\u30a2\u30af\u30bb\u30b9\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u7528\u306eIAM\u30dd\u30ea\u30b7\u30fc\u300cexample-s3-owner-account-example-s3-bucket-iam-policy\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u30fbAWS Management Console\u3067\u300cexample-s3-owner-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\u30fb\u300cIdentity & access management\u300d(IAM)\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb IAM\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\u300d\u753b\u9762\u3067\u300c\u72ec\u81ea\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u4f5c\u6210\u300d\u306e\u300c\u9078\u629e\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u78ba\u8a8d\u300d\u753b\u9762\u3067\u300c\u30dd\u30ea\u30b7\u30fc\u540d\u300d\u306b\u300cexample-s3-owner-account-example-s3-bucket-iam-policy\u300d\u3068\u5165\u529b\u3057\u307e\u3059\u3002\n\u30fb\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u78ba\u8a8d\u300d\u753b\u9762\u3067\u300c\u30dd\u30ea\u30b7\u30fc\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u300d\u306b\u4ee5\u4e0b\u3092\u5165\u529b\u3057\u307e\u3059\u3002\nS3\u30d0\u30b1\u30c3\u30c8\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308bAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u300cexample-s3-upload-account\u300d\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u5bfe\u3057\u3066\u306e\u307f\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3092\u8a31\u53ef\u3059\u308b\u70ba\u3001\u300caws:SourceIp\u300d\u3067AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u300cexample-s3-upload-account\u300d\u306enat\u30b5\u30fc\u30d0\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u306e\u307f\u8a31\u53ef\u3057\u307e\u3059\u3002nat\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9\u306f\u4f8b\u3068\u3057\u3066\u300c192.0.2.200/32\u300d\u3068\u3057\u3066\u8a18\u8f09\u3057\u3066\u3044\u307e\u3059\u3002\n\nexample-s3-owner-account-example-s3-bucket-iam-policy\u30dd\u30ea\u30b7\u30fc\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": \"s3:ListBucket\",\n            \"Condition\": {\n                \"IpAddress\": {\n                    \"aws:SourceIp\": [\n                        \"192.0.2.202/32\"\n                    ]\n                }\n            },\n            \"Resource\": \"arn:aws:s3:::example-s3-bucket\"\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"s3:GetObject\",\n                \"s3:PutObject\",\n                \"s3:DeleteObject\"\n            ],\n            \"Condition\": {\n                \"IpAddress\": {\n                    \"aws:SourceIp\": [\n                        \"192.0.2.202/32\"\n                    ]\n                }\n            },\n            \"Resource\": \"arn:aws:s3:::example-s3-bucket/*\"\n        }\n    ]\n}\n\n\n\u30fb\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u78ba\u8a8d\u300d\u753b\u9762\u3067\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u691c\u8a3c\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u300c\u3053\u306e\u30dd\u30ea\u30b7\u30fc\u306f\u6709\u52b9\u3067\u3059\u300d\u3068\u8868\u793a\u3055\u308c\u305f\u3089\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fbIAM\u30dd\u30ea\u30b7\u30fc\u300cexample-s3-owner-account-example-s3-bucket-iam-policy \u304c\u4f5c\u6210\u3055\u308c\u307e\u3057\u305f\u3002\u300d\u3068\u8868\u793a\u3055\u308c\u308b\u4e8b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n(3)\u300cexample-s3-owner-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306bAssumeRole\u7528IAM\u30ed\u30fc\u30eb\uff62example_s3_user_assumerole_example-s3-upload-account-iam-role\uff63\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306bS3\u3078\u306e\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u6a29\u9650\u3092\u6e21\u3059\u70ba\u3001\u300cexample-s3-owner-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306bAssumeRole\u7528IAM\u30ed\u30fc\u30eb\uff62example_s3_user_assumerole_example-s3-upload-account-iam-role\uff63\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u30fbAWS Management Console\u3067\u300cexample-s3-owner-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\u30fb\u300cIdentity & access management\u300d(IAM)\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3002\n\u30fbIAM\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u300c\u30ed\u30fc\u30eb\u300d\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3002\n\u30fb\u300c\u65b0\u3057\u3044\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3002\n\u30fb\u300c\u30ed\u30fc\u30eb\u540d\u306e\u8a2d\u5b9a\u300d\u753b\u9762\u3067\u30ed\u30fc\u30eb\u540d\u306b\u300cexample_s3_user_assumerole_example-s3-upload-account-iam-role\u300d\u3068\u5165\u529b\u3057\u307e\u3059\u3002\u300c\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u300c\u30ed\u30fc\u30eb\u30bf\u30a4\u30d7\u306e\u9078\u629e\u300d\u753b\u9762\u3067\u300c\u30af\u30ed\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u30a2\u30af\u30bb\u30b9\u306e\u30ed\u30fc\u30eb\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u300c\u30ed\u30fc\u30eb\u30bf\u30a4\u30d7\u306e\u9078\u629e\u300d\u753b\u9762\u3067\u300c\u6240\u6709\u3057\u3066\u3044\u308b AWS \u30a2\u30ab\u30a6\u30f3\u30c8\u9593\u306e\u30a2\u30af\u30bb\u30b9\u3092\u63d0\u4f9b\u3057\u307e\u3059\u300d\u306e\u300c\u9078\u629e\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u3053\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b IAM \u30e6\u30fc\u30b6\u30fc\u306e AWS \u30a2\u30ab\u30a6\u30f3\u30c8\u306e ID \u3092\u5165\u529b\u3057\u307e\u3059\u3002\u300d\u3068\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\u300c\u30a2\u30ab\u30a6\u30f3\u30c8ID\u300d\u306b\u300c999999999999\u300d(example-s3-upload-account\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8ID)\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\u300cMFA\u304c\u5fc5\u8981\u300d\u306e\u30c1\u30a7\u30c3\u30af\u306f\u4ed8\u3051\u305a\u306b\u300c\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u30a2\u30bf\u30c3\u30c1\u300d\u753b\u9762\u3067\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u300cexample-s3-owner-account-example-s3-bucket-iam-policy\u300d\u30dd\u30ea\u30b7\u30fc\u306b\u30c1\u30a7\u30c3\u30af\u3092\u4ed8\u3051\u3066\u30a2\u30bf\u30c3\u30c1\u3057\u307e\u3059\u3002\n\u30fb\u300c\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u300c\u78ba\u8a8d\u300d\u753b\u9762\u3067\u4eca\u56de\u4f5c\u6210\u3055\u308c\u308bIAM\u30ed\u30fc\u30eb\u306e\u300c\u30ed\u30fc\u30ebARN\u300d\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u63a7\u3048\u3066\u304a\u304d\u307e\u3059\u3002\narn:aws:iam::111111111111:role/example_s3_user_assumerole_example-s3-upload-account-iam-role\n\u30fb\u300c\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fbIAM\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u300c\u30ed\u30fc\u30eb\u300d->\u300cexample_s3_user_assumerole_example-s3-upload-account-iam-role\u300d\u30ed\u30fc\u30eb\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u300cexample_s3_user_assumerole_example-s3-upload-account-iam-role\u300d\u30ed\u30fc\u30eb\u306e\u300c\u4fe1\u983c\u95a2\u4fc2\u300d\u30bf\u30d6\u3067\u300c\u30dd\u30ea\u30b7\u30fc\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u8868\u793a\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u300cexample-s3-upload-account\u300d(AWS\u30a2\u30ab\u30a6\u30f3\u30c8ID:999999999999)\u3092\u4fe1\u983c\u3059\u308b\u8a2d\u5b9a\u306b\u306a\u3063\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\nexample_s3_user_assumerole_example-s3-upload-account-iam-role\u306e\u4fe1\u983c\u95a2\u4fc2\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"AWS\": \"arn:aws:iam::999999999999:root\"\n      },\n      \"Action\": \"sts:AssumeRole\"\n    }\n  ]\n}\n\n\n\nS3\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u5074\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8(example-s3-upload-account)\u3067\u306e\u8a2d\u5b9a\nS3\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u5074\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8(example-s3-upload-account)\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3001IAM\u30e6\u30fc\u30b6\u3001IAM\u30dd\u30ea\u30b7\u30fc\u3001IAM\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n(4)\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u300cexample-s3-owner-account\u300d\u306eAssumeRole\u6a29\u9650\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3059\u308bIAM\u30dd\u30ea\u30b7\u30fc\u300cexample_s3_user_assumerole_example-s3-owner-account-iam-policy\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u30fbAWS Management Console\u3067\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\u30fb\u300cIdentity & access management\u300d(IAM)\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fbIAM\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\u300d\u753b\u9762\u3067\u300c\u72ec\u81ea\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u4f5c\u6210\u300d\u306e\u300c\u9078\u629e\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u78ba\u8a8d\u300d\u753b\u9762\u3067\u300c\u30dd\u30ea\u30b7\u30fc\u540d\u300d\u306b\u300cexample_s3_user_assumerole_example-s3-owner-account-iam-policy\u300d\u3068\u5165\u529b\u3057\u307e\u3059\u3002\n\u30fb\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u78ba\u8a8d\u300d\u753b\u9762\u3067\u300c\u30dd\u30ea\u30b7\u30fc\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u300d\u306b\u4ee5\u4e0b\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u306fS3\u30d0\u30b1\u30c3\u30c8\u304c\u3042\u308bAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u300cexample-s3-owner-account\u300d(AWS\u30a2\u30ab\u30a6\u30f3\u30c8ID:111111111111)\u3068\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fIAM\u30ed\u30fc\u30eb\u306eARN\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\nexample_s3_user_assumerole_example-s3-owner-account-iam-policy\u30dd\u30ea\u30b7\u30fc\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": {\n        \"Effect\": \"Allow\",\n        \"Action\": \"sts:AssumeRole\",\n        \"Resource\": [\n           \"arn:aws:iam::111111111111:role/example_s3_user_assumerole_example-s3-upload-account-iam-role\"\n        ]\n    }\n}\n\n\n\u30fb\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u78ba\u8a8d\u300d\u753b\u9762\u3067\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u691c\u8a3c\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u300c\u3053\u306e\u30dd\u30ea\u30b7\u30fc\u306f\u6709\u52b9\u3067\u3059\u300d\u3068\u8868\u793a\u3055\u308c\u305f\u3089\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fbIAM\u30dd\u30ea\u30b7\u30fc\u300cexample_s3_user_assumerole_example-s3-owner-account-iam-policy \u304c\u4f5c\u6210\u3055\u308c\u307e\u3057\u305f\u3002\u300d\u3068\u8868\u793a\u3055\u308c\u308b\u4e8b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n(5)\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u300cexample-s3-owner-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306eAssumeRole\u6a29\u9650\u3092\u5f15\u304d\u53d7\u3051\u308bIAM\u30e6\u30fc\u30b6\u300cexample_s3_user_assumerole_example-s3-owner-account-iam-user\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nS3\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308bAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306bIAM\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u30fbAWS Management Console\u3067\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\u30fb\u300cIdentity & access management\u300d(IAM)\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb IAM\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u300c\u30e6\u30fc\u30b6\u30fc\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u300c\u65b0\u898f\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u300c\u30e6\u30fc\u30b6\u30fc\u540d\u306e\u5165\u529b\u300d\u306b\u300cexample_s3_user_assumerole_example-s3-owner-account-iam-user\u300d\u3068\u5165\u529b\u3057\u307e\u3059\u3002\n\u30fb\u300c\u30e6\u30fc\u30b6\u30fc\u3054\u3068\u306b\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3092\u751f\u6210\u300d\u306b\u30c1\u30a7\u30c3\u30af\u3092\u4ed8\u3051\u3066\u300c\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u300c\u30e6\u30fc\u30b6\u30fc\u304c\u6b63\u5e38\u306b\u4f5c\u6210\u3055\u308c\u307e\u3057\u305f\u300d\u3068\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u300c\u30e6\u30fc\u30b6\u30fc\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a8d\u8a3c\u60c5\u5831\u3092\u8868\u793a\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3001\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u3092\u63a7\u3048\u3066\u304a\u304d\u307e\u3059\u3002\n\nexample_s3_user_assumerole_example-s3-owner-account-iam-user\u306e\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\n\u30a2\u30af\u30bb\u30b9\u30ad\u30fc ID:\nAK******************\n\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30a2\u30af\u30bb\u30b9\u30ad\u30fc:\nWP**************************************\n\n\n\u30fb\u300c\u8a8d\u8a3c\u60c5\u5831\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3001\u4e0a\u8a18\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u3092\u81ea\u5206\u306ePC\u306b\u4fdd\u5b58\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n(6)\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306eIAM\u30e6\u30fc\u30b6\u300cexample_s3_user_assumerole_example-s3-owner-account-iam-user\u300d\u306b\u5bfe\u3057\u3066\u3001\u300cexample-s3-owner-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306eAssumeRole\u6a29\u9650\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002\n\u30fbAWS Management Console\u3067\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\u30fb\u300cIdentity & access management\u300d(IAM)\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fbIAM\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u300c\u30e6\u30fc\u30b6\u30fc\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u300c\u30e6\u30fc\u30b6\u30fc\u540d\u300d->\u300cexample_s3_user_assumerole_example-s3-owner-account-iam-user\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u300c\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u300d\u30bf\u30d6\u306e\u300c\u7ba1\u7406\u30dd\u30ea\u30b7\u30fc\u300d\u2192\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u30a2\u30bf\u30c3\u30c1\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u30a2\u30bf\u30c3\u30c1\u300d\u753b\u9762\u3067\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u300cexample_s3_user_assumerole_example-s3-owner-account-iam-policy\u300d\u30dd\u30ea\u30b7\u30fc\u306b\u30c1\u30a7\u30c3\u30af\u3092\u4ed8\u3051\u3066\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u30a2\u30bf\u30c3\u30c1\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n(7)\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7528\u306eIAM\u30ed\u30fc\u30eb\u300cexample-server-role\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u300cexample-s3-owner-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306eS3\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7528\u306eIAM\u30ed\u30fc\u30eb\u300cexample-server-role\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u30fbAWS Management Console\u3067\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\u30fb\u300cIdentity & access management\u300d(IAM)\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb IAM\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u300c\u30ed\u30fc\u30eb\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u300c\u65b0\u3057\u3044\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u300c\u30ed\u30fc\u30eb\u540d\u306e\u8a2d\u5b9a\u300d\u753b\u9762\u3067\u30ed\u30fc\u30eb\u540d\u306b\u300cexample-server-role\u300d\u3068\u5165\u529b\u3057\u307e\u3059\u3002\n\u30fb\u300c\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u300c\u30ed\u30fc\u30eb\u30bf\u30a4\u30d7\u306e\u9078\u629e\u300d\u753b\u9762\u3067\u300cAWS\u30b5\u30fc\u30d3\u30b9\u30ed\u30fc\u30eb\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u300c\u30ed\u30fc\u30eb\u30bf\u30a4\u30d7\u306e\u9078\u629e\u300d\u753b\u9762\u3067\u300cAmazon EC2\u300d\u306e\u300c\u9078\u629e\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u30a2\u30bf\u30c3\u30c1\u300d\u753b\u9762\u3067\u300cexample_s3_user_assumerole_example-s3-owner-account-iam-policy\u300d\u30dd\u30ea\u30b7\u30fc\u306b\u30c1\u30a7\u30c3\u30af\u3092\u4ed8\u3051\u3066\u300c\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u300c\u78ba\u8a8d\u300d\u753b\u9762\u3067\u4eca\u56de\u4f5c\u6210\u3055\u308c\u308bIAM\u30ed\u30fc\u30eb\u306e\u300c\u30ed\u30fc\u30ebARN\u300d\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u63a7\u3048\u3066\u304a\u304d\u307e\u3059\u3002\narn:aws:iam::999999999999:role/example-server-role\n\u30fb\u300c\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fbIAM\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u300c\u30ed\u30fc\u30eb\u300d->\u300cexample-server-role\u300d\u30ed\u30fc\u30eb\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3002\n\u30fb\u300cexample-server-role\u300d\u30ed\u30fc\u30eb\u306e\u300c\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u300d\u30bf\u30d6\u3067\u300c\u7ba1\u7406\u30dd\u30ea\u30b7\u30fc\u300d->\u300cexample_s3_user_assumerole_example-s3-owner-account-iam-policy\u300d\u30dd\u30ea\u30b7\u30fc\u306e\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u8868\u793a\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fb\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u300cexample-s3-owner-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8(AWS\u30a2\u30ab\u30a6\u30f3\u30c8ID:111111111111)\u306eAssumeRole\u3092\u5229\u7528\u51fa\u6765\u308b\u8a2d\u5b9a\u306b\u306a\u3063\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\nexample_s3_user_assumerole_example-s3-owner-account-iam-policy\u30dd\u30ea\u30b7\u30fc\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": {\n        \"Effect\": \"Allow\",\n        \"Action\": \"sts:AssumeRole\",\n        \"Resource\": [\n           \"arn:aws:iam::111111111111:role/example_s3_user_assumerole_example-s3-upload-account-iam-role\"\n        ]\n    }\n}\n\n\n\n(8) \u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306bS3\u3078\u306e\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3092\u5b9f\u884c\u3059\u308bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u300cexample-server\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u30fbAWS Management Console\u3067\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\u30fb\u300cEC2\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u30fbAmazonLinux\u306eAMI\u3067EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u300cexample-server\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u6642\u306b\u306f\u3001IAM\u30ed\u30fc\u30eb\u3068\u3057\u3066\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u300cexample-server-role\u300d\u30ed\u30fc\u30eb\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\nS3\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8a2d\u5b9a(\u81ea\u52d5\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u53d6\u5f97\u8a2d\u5b9a\u3067AssumeRole\u306e\u30ad\u30fc\u3092\u81ea\u52d5\u8a2d\u5b9a\u3059\u308b)\n\n(9)\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u4f5c\u6210\u3057\u305fEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u81ea\u52d5\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u53d6\u5f97\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059(example-s3-owner-account\u30a2\u30ab\u30a6\u30f3\u30c8\u306eAssumeRole\u6a29\u9650\u3092\u5229\u7528\u3059\u308b\u70ba\u306e\u8a2d\u5b9a\u3067\u3059)\u3002\n\u30fb/home/user/.aws\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n/home/user/.aws\n[user@example-server ~]$ hostname\nexample-server\n[user@example-server ~]$ mkdir /home/user/.aws\n[user@example-server ~]$ chmod 700 /home/user/.aws\n[user@example-server ~]$ \n\n\n\u30fb/home/user/.aws/config\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n/home/user/.aws/config\n[user@example-server ~]$ vi /home/user/.aws/config\n[profile example_s3_user]\noutput = json\nregion = ap-northeast-1\n\n[profile example_s3_user_assumerole_example-s3-owner-account-iam-user]\noutput = json\nregion = ap-northeast-1\n\n\n\u30fb/home/user/.aws/credentials\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u306b\u3064\u3044\u3066\u306f\u3001\u524d\u8ff0\u306e(5)\u3001S3\u30d8\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u5074\u306e\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u4f5c\u6210\u3057\u305f\u300cexample_s3_user_assumerole_example-s3-owner-account-iam-user\u300d\u30e6\u30fc\u30b6\u306e\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n[user@example-server ~]$ vi /home/user/.aws/credentials \n# example-s3-owner-account IAM Role arn:aws:iam::111111111111:role/example_s3_user_assumerole_example-s3-upload-account-iam-role\n[example_s3_user]\nrole_arn = arn:aws:iam::111111111111:role/example_s3_user_assumerole_example-s3-upload-account-iam-role\nsource_profile = example_s3_user_assumerole_example-s3-owner-account-iam-user\n\n# example-s3-upload-account IAM User example_s3_user_assumerole_example-s3-owner-account-iam-user\n[example_s3_user_assumerole_example-s3-owner-account-iam-user]\naws_access_key_id = AK******************\naws_secret_access_key = WP**************************************\n\n\u30fb\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n[user@example-server ~]$ chmod 600 /home/user/.aws/config\n[user@example-server ~]$ chmod 600 /home/user/.aws/credentials\n\n\u30fb\u4f5c\u6210\u3057\u305f\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n/home/user/.aws/\n[user@example-server ~]$ hostname\nexample-server\n[user@example-server ~]$ ls -lrta /home/user/ | grep .aws\ndrwx------ 2 user  group 4096 Mar 17 01:24 .aws\n[user@example-server ~]$ \n[user@example-server ~]$ ls -lrta /home/user/.aws/\ntotal 16\n-rw------- 1 user  group  165 Mar 17 01:20 config\n-rw------- 1 user  group  495 Mar 17 01:24 credentials\ndrwx------ 5 user  group 4096 Mar 17 01:24 ..\ndrwx------ 2 user  group 4096 Mar 17 01:24 .\n[user@example-server ~]$ \n\n\n\n/home/user/.aws/config\n[user@example-server ~]$ cat /home/user/.aws/config\n[profile example_s3_user]\noutput = json\nregion = ap-northeast-1\n\n[profile example_s3_user_assumerole_example-s3-owner-account-iam-user]\noutput = json\nregion = ap-northeast-1\n[user@example-server ~]$\n\n\n\n/home/user/.aws/credentials\n[user@example-server ~]$ cat /home/user/.aws/credentials\n# example-s3-owner-account IAM Role arn:aws:iam::111111111111:role/example_s3_user_assumerole_example-s3-upload-account-iam-role\n[example_s3_user]\nrole_arn = arn:aws:iam::111111111111:role/example_s3_user_assumerole_example-s3-upload-account-iam-role\nsource_profile = example_s3_user_assumerole_example-s3-owner-account-iam-user\n\n# example-s3-upload-account IAM User example_s3_user_assumerole_example-s3-owner-account-iam-user\n[example_s3_user_assumerole_example-s3-owner-account-iam-user]\naws_access_key_id = AK******************\naws_secret_access_key = WP**************************************\n[user@example-server ~]$ \n\n\n\n(10)\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u300cexample-s3-owner-account\u300d\u306b\u3042\u308bS3\u30d0\u30b1\u30c3\u30c8\u300cexample-s3-bucket\u300d\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u51fa\u6765\u308b\u304b\u30c6\u30b9\u30c8\u3057\u307e\u3059\u3002\n[user@example-server ~]$ hostname\nexample-server\n[user@example-server ~]$ curl http://httpbin.org/ip\n{\n  \"origin\": \"192.0.2.202\"\n}\n[user@example-server ~]$ \n\n[user@example-server ~]$ aws --profile=example_s3_user s3 ls s3://example-s3-bucket/\n                           PRE upload/\n[user@example-server ~]$ \n[user@example-server ~]$ aws --profile=example_s3_user s3 ls s3://example-s3-bucket/upload/\n2016-03-17 XX:XX:XX          0 \n[user@example-server ~]$ \n\n[user@example-server ~]$ hostname > /tmp/test.txt\n[user@example-server ~]$ \n\n[user@example-server ~]$ aws --profile=example_s3_user s3 cp /tmp/test.txt s3://example-s3-bucket/upload/\nupload: ../../tmp/test.txt to s3://example-s3-bucket/upload/test.txt\n[user@example-server ~]$ \n\n[user@example-server ~]$ aws --profile=example_s3_user s3 ls s3://example-s3-bucket/upload/\n2016-03-17 XX:XX:XX          0 \n2016-03-17 XX:XX:XX         48 test.txt\n[user@example-server ~]$ \n\n[user@example-server ~]$ aws --profile=example_s3_user s3 ls s3://example-s3-bucket/upload/test.txt\n2016-03-17 XX:XX:XX         48 test.txt\n[user@example-server ~]$ \n\n[user@example-server ~]$ aws --profile=example_s3_user s3 rm s3://example-s3-bucket/upload/test.txt\ndelete: s3://example-s3-bucket/upload/test.txt\n[user@example-server ~]$ \n\n[user@example-server ~]$ aws --profile=example_s3_user s3 ls s3://example-s3-bucket/upload/test.txt\n[user@example-server ~]$ \n\n[user@example-server ~]$ aws --profile=example_s3_user s3 ls s3://example-s3-bucket/upload/\n2016-03-17 XX:XX:XX          0 \n[user@example-server ~]$ \n\n[user@example-server ~]$ aws --profile=example_s3_user s3 cp /tmp/test.txt s3://example-s3-bucket/upload/\nupload: ../../tmp/test.txt to s3://example-s3-bucket/upload/test.txt\n[user@example-server ~]$ \n\n[user@example-server ~]$ aws --profile=example_s3_user s3 ls s3://example-s3-bucket/upload/test.txt\n2016-03-17 XX:XX:XX         48 test.txt\n[user@example-server ~]$ \n\n[user@example-server ~]$ rm /tmp/test.txt\n[user@example-server ~]$ ls -lrta /tmp/test.txt\nls: cannot access /tmp/test.txt: No such file or directory\n[user@example-server ~]$ \n\n[user@example-server ~]$ aws --profile=example_s3_user s3 cp s3://example-s3-bucket/upload/test.txt /tmp/\ndownload: s3://example-s3-bucket/upload/test.txt to ../../tmp/test.txt\n[user@example-server ~]$ \n\n[user@example-server ~]$ ls -lrta /tmp/test.txt\n-rw-rw-r-- 1 user group 48 Mar 17 XX:XX /tmp/test.txt\n[user@example-server ~]$ \n\n[user@example-server ~]$ cat /tmp/test.txt\nexample-server\n[user@example-server ~]$ \n\n\n(11)\u300cexample-s3-owner-account\u300d\u306e\u300cexample-s3-bucket\u300d\u306eS3\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u3067\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u3057\u305fIP\u30a2\u30c9\u30ec\u30b9(192.0.2.100/32)\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u51fa\u6765\u308b\u304b\u30c6\u30b9\u30c8\u3057\u307e\u3059\u3002\n\nS3\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u3067\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u3057\u305fIP\u30a2\u30c9\u30ec\u30b9(192.0.2.100/32)\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u51fa\u6765\u308b\u304b\u30c6\u30b9\u30c8\n[user2@example-server-allow-ip ~]$ hostname\nexample-server-allow-ip\n[user2@example-server-allow-ip ~]$ curl httpbin.org/ip\n{\n  \"origin\": \"192.0.2.100\"\n}\n[user2@example-server-allow-ip ~]$\n\n[user2@example-server-allow-ip ~]$ curl https://s3-ap-northeast-1.amazonaws.com/example-s3-bucket/upload/test.txt\nexample-server\n[user2@example-server-allow-ip ~]$\n\n[user2@example-server-allow-ip ~]$ rm test.txt\n[user2@example-server-allow-ip ~] $ls -lrta test.txt\nls: test.txt: No such file or directory\n[user2@example-server-allow-ip ~]$\n\n[user2@example-server-allow-ip ~]$ wget -nv https://s3-ap-northeast-1.amazonaws.com/example-s3-bucket/upload/test.txt\n2016-03-16 19:00:14 URL:https://s3-ap-northeast-1.amazonaws.com/example-s3-bucket/upload/test.txt [48/48] -> \"test.txt\" [1]\n[user2@example-server-allow-ip ~]$\n\n[user2@example-server-allow-ip ~]$ ls -lrta test.txt\n-rw-rw-r-- 1 user group 48 Mar 17 XX:XX /tmp/test.txt\n[user2@example-server-allow-ip ~]$\n\n[user2@example-server-allow-ip ~]$ cat test.txt\nexample-server\n[user2@example-server-allow-ip ~]$\n\n\n\n(12)\u300cexample-s3-owner-account\u300d\u306e\u300cexample-s3-bucket\u300d\u306eS3\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u3067\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u3057\u3066\u3044\u306a\u3044IP\u30a2\u30c9\u30ec\u30b9(192.0.2.199/32)\u304b\u3089\u306f\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u51fa\u6765\u306a\u3044\u4e8b\u3092\u30c6\u30b9\u30c8\u3057\u307e\u3059\u3002\nS3\u30d8\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306bS3\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u304c\u9069\u7528\u3055\u308c\u3066\u3044\u308b\u304b\u30c6\u30b9\u30c8\u3059\u308b\u70ba\u3001S3\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u3067\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u3057\u3066\u3044\u306a\u3044IP\u30a2\u30c9\u30ec\u30b9(192.0.2.199/32)\u304b\u3089\u306f\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u51fa\u6765\u306a\u3044\u4e8b\u3092\u30c6\u30b9\u30c8\u3057\u307e\u3059\u3002\n\nS3\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u3067\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u3057\u3066\u3044\u306a\u3044IP\u30a2\u30c9\u30ec\u30b9(192.0.2.199/32)\u304b\u3089\u306f\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u51fa\u6765\u306a\u3044\u4e8b\u3092\u30c6\u30b9\u30c8\n[user3@example-server-deny-ip ~]$ hostname\nexample-server-deny-ip\n\n[user3@example-server-deny-ip ~]$ curl httpbin.org/ip\n{\n  \"origin\": \"192.0.2.199\"\n}\n[user3@example-server-deny-ip ~]$\n\n[user3@example-server-deny-ip ~]$ curl https://s3-ap-northeast-1.amazonaws.com/example-s3-bucket/upload/test.txt\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<Error><Code>AccessDenied</Code><Message>Access Denied</Message><RequestId>*******************</RequestId><HostId>******************************************************</HostId></Error>[user3@example-server-deny-ip ~]$\n[user3@example-server-deny-ip ~]$\n\n[user3@example-server-deny-ip ~]$ wget -nv https://s3-ap-northeast-1.amazonaws.com/example-s3-bucket/upload/test.txt\nhttps://s3-ap-northeast-1.amazonaws.com/example-s3-bucket/upload/test.txt:\n2016-03-16 19:01:14 ERROR 403: Forbidden.\n[user3@example-server-deny-ip ~]$\n\n[user3@example-server-deny-ip ~]$ ls -lrta test.txt\nls: cannot access test.txt: No such file or directory\n[user3@example-server-deny-ip ~]$\n\n\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067aws s3 cp\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3001\u4ed6\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u3042\u308bS3\u30d0\u30b1\u30c3\u30c8\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u51fa\u6765\u305f\u3089\u8a2d\u5b9a\u5b8c\u4e86\u3067\u3059\u3002\n\u9577\u304f\u306a\u308a\u307e\u3057\u305f\u304c\u3001\u4ee5\u4e0a\u306b\u306a\u308a\u307e\u3059\u3002\n\u3054\u53c2\u8003\u306b\u306a\u308a\u307e\u3057\u305f\u3089\u5e78\u3044\u3067\u3059\u3002\n\u306f\u3058\u3081\u306b\n---\n\n\u8907\u6570\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u904b\u7528\u3057\u3066\u3044\u3066\u3001\u5225\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u3042\u308bS3\u30d0\u30b1\u30c3\u30c8\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u3044\u4e8b\u304c\u3042\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u672c\u30da\u30fc\u30b8\u3067\u306f\u30012\u3064\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u9593\u3067\u3001\u5225\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u3042\u308bS3\u30d0\u30b1\u30c3\u30c8\u3078\u306e\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3092\u8a31\u53ef\u3059\u308b\u8a2d\u5b9a\u3001\u5b9f\u969b\u306bS3\u30d0\u30b1\u30c3\u30c8\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u624b\u9806\u306b\u3064\u3044\u3066\u8a18\u8f09\u81f4\u3057\u307e\u3059\u3002\n\u672c\u30da\u30fc\u30b8\u3067\u306f\u3001\u4e3b\u306b\u4ee5\u4e0b\u306e\u624b\u9806\u3084\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u8a18\u8f09\u81f4\u3057\u307e\u3059\u3002\n\n\u3000**[1] AssumeRole\u3084IAM\u30ed\u30fc\u30eb\u7b49\u306e\u8a2d\u5b9a\u306b\u3088\u308a\u3001AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u9593\u3067S3\u30d0\u30b1\u30c3\u30c8\u3078\u306e\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3092\u8a31\u53ef\u3059\u308b\u8a2d\u5b9a\u3002**\n\n\u3000**[2] AWS CLI(aws s3 cp\u30b3\u30de\u30f3\u30c9)\u3067S3\u30d0\u30b1\u30c3\u30c8\u3078\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u6642\u306b\u5fc5\u8981\u3068\u306a\u308b\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u306e\u81ea\u52d5\u53d6\u5f97\u8a2d\u5b9a\u3002aws sts assume-role\u30b3\u30de\u30f3\u30c9\u3092\u90fd\u5ea6\u5b9f\u884c\u305b\u305a\u306bAssumeRole\u30ad\u30fc\u3092\u81ea\u52d5\u7684\u306b\u53d6\u5f97\u3059\u308b\u3088\u3046\u8a2d\u5b9a(\u81ea\u52d5\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u53d6\u5f97\u8a2d\u5b9a)\u3002**\n\n\u3000**[3] S3\u30d0\u30b1\u30c3\u30c8\u306b\u7279\u5b9aIP\u30a2\u30c9\u30ec\u30b9\u304b\u3089\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u8a2d\u5b9a\u3002**\n\n\u3000**[4] \u5b9f\u969b\u306bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u5225\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u3042\u308bS3\u30d0\u30b1\u30c3\u30c8\u3078aws s3 cp\u30b3\u30de\u30f3\u30c9\u3067\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u624b\u9806\u3002**\n\n\u3000**[5] S3\u30d0\u30b1\u30c3\u30c8\u304c\u3042\u308bAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u5074\u3067\u306f\u3001\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3084\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u306e\u767a\u884c\u3092\u305b\u305a\u3001S3\u306e\u30af\u30ed\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u30d0\u30b1\u30c3\u30c8\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u3092\u5b9f\u73fe\u3059\u308b\u8a2d\u5b9a\u3002**\n\n\u672c\u624b\u9806\u304c\u5fc5\u8981\u306b\u306a\u308b\u30b1\u30fc\u30b9\u306e\u4e00\u4f8b\n---\n\n\u901a\u5e38\u30012\u3064\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u9593\u3067\u3001\u4ed6\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u3042\u308bS3\u30d0\u30b1\u30c3\u30c8\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u3060\u3051\u306a\u3089\u3001IAM\u30ed\u30fc\u30eb\u306b\u3088\u308bS3\u30d0\u30b1\u30c3\u30c8\u306e\u30af\u30ed\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u8a2d\u5b9a\u3092\u884c\u306a\u3046\u4e8b\u3067\u3001S3\u30d0\u30b1\u30c3\u30c8\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002\nhttp://docs.aws.amazon.com/ja_jp/AmazonS3/latest/dev/example-walkthroughs-managing-access-example3.html\n\n\u3057\u304b\u3057\u3001\u5404AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306eS3\u30d0\u30b1\u30c3\u30c8\u904b\u7528\u72b6\u6cc1\u3084\u30dd\u30ea\u30b7\u30fc\u306b\u3088\u3063\u3066\u306f\u3001S3\u30d0\u30b1\u30c3\u30c8\u306b\u7279\u5b9a\u306e\u30dd\u30ea\u30b7\u30fc\u3001\u4f8b\u3048\u3070\u300cAWS\u4ee5\u5916\u306e\u7279\u5b9aIP\u30a2\u30c9\u30ec\u30b9\u306e\u30b5\u30fc\u30d0\u306b\u5bfe\u3057\u3066\u3001S3\u30d0\u30b1\u30c3\u30c8\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3092\u8a31\u53ef\u3059\u308b\u300d\u3088\u3046\u306aS3\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u4e8b\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\nAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u304b\u3089\u5225\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306eS3\u30d0\u30b1\u30c3\u30c8\u3078\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306b\u3064\u3044\u3066\u306f\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6240\u6709\u8005\u304c\u300c\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305fAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u300d\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6240\u6709\u8005\u3068S3\u30d0\u30b1\u30c3\u30c8\u6240\u6709\u8005\u3068AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u7570\u306a\u308b\u70ba\u3001S3\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u304c\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306b\u9069\u7528\u3055\u308c\u306a\u3044\u30b1\u30fc\u30b9\u304c\u3042\u308a\u307e\u3059\u3002\nhttps://blog.cloudpack.jp/2014/08/04/allow-other-account-to-write-to-amazon-s3/\nhttp://muramasa64.fprog.org/diary/?date=20140731\n\n\u3053\u306e\u3088\u3046\u306a\u30b1\u30fc\u30b9\u306e\u5834\u5408\u3001AssumeRole\u3092\u7528\u3044\u308b\u4e8b\u3067\u3001\u5225\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306eS3\u30d0\u30b1\u30c3\u30c8\u3078\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306b\u3064\u3044\u3066\u3082\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6240\u6709\u8005\u3092\u300c\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305fAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u306f\u306a\u304f\u3001S3\u30d0\u30b1\u30c3\u30c8\u304c\u3042\u308bAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u300d\u306b\u3059\u308b\u4e8b\u304c\u51fa\u6765\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6240\u6709\u8005\u304c\u30d0\u30b1\u30c3\u30c8\u6240\u6709\u8005\u3068\u540c\u3058AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u306a\u308b\u306e\u3067\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306bS3\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u304c\u9069\u7528\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n---\n\n\u4ed6\u306b\u3082\u3001\u5404AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u7ba1\u7406\u8005\u304c\u5b58\u5728\u3057\u3001\u305d\u308c\u305e\u308c\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u904b\u7528\u30eb\u30fc\u30eb\u3092\u5b9a\u3081\u3066\u3044\u308b\u5834\u5408\u3001\u4f8b\u3048\u3070S3\u30d0\u30b1\u30c3\u30c8\u3092\u6240\u6709\u3059\u308bAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u306f\u300c\u4ed6\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u5411\u3051\u306b\u3001S3\u30d0\u30b1\u30c3\u30c8\u3078\u306e\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3092\u8a31\u53ef\u3059\u308b\u30a2\u30af\u30bb\u30b9\u30ad\u30fcID\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u306f\u767a\u884c\u3057\u306a\u3044\u300d\u3068\u3044\u3046\u904b\u7528\u3092\u884c\u3063\u3066\u3044\u308b\u30b1\u30fc\u30b9\u3082\u3042\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u305d\u306e\u3088\u3046\u306a\u30b1\u30fc\u30b9\u306e\u5834\u5408\u3067\u3082\u3001\u672c\u624b\u9806\u306b\u3088\u308a\u3001S3\u30d0\u30b1\u30c3\u30c8\u3092\u6240\u6709\u3059\u308bAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u5074\u3067\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3084\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u3092\u767a\u884c\u305b\u305a\u306b\u3001\u5225\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u304b\u3089S3\u30d0\u30b1\u30c3\u30c8\u3078\u306e\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n\n\u672c\u624b\u9806\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u8868\u8a18\u306b\u3064\u3044\u3066\n---\n\n\u672c\u624b\u9806\u3067\u306f\u3001AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u300cexample-s3-owner-account\u300d\u306b\u3042\u308bS3\u30d0\u30b1\u30c3\u30c8\u300cexample-s3-bucket\u300d\u306b\u5bfe\u3057\u3066\u3001AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u300cexample-s3-upload-account\u300d\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u300cexample-server\u300d\u304b\u3089S3\u30d0\u30b1\u30c3\u30c8\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u307e\u3067\u306e\u624b\u9806\u3092\u8a18\u8f09\u81f4\u3057\u307e\u3059\u3002\n\n\u3000example-s3-owner-account\u30a2\u30ab\u30a6\u30f3\u30c8\u306es3://example-s3-bucket\u30d0\u30b1\u30c3\u30c8\n\u3000\u3000\u3000\u3000\u3000\u2191\n\u3000\u3000s3://example-s3-bucket/\u30d0\u30b1\u30c3\u30c8\u3078\u306e\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\u3000\u3000\u3000\u3000\u3000\u2191\n\u3000example-s3-upload-account\u30a2\u30ab\u30a6\u30f3\u30c8\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u300cexample-server\u300d\n\nAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u540d\u3084AWS\u30a2\u30ab\u30a6\u30f3\u30c8ID\u7b49\u306b\u3064\u3044\u3066\u306f\u3001\u4f8b\u793a\u7528\u3068\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a18\u8f09\u3055\u305b\u3066\u9802\u304d\u307e\u3059\u3002\n\n\n| AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u6982\u8981 | AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u540d | AWS\u30a2\u30ab\u30a6\u30f3\u30c8ID    |\n|:------------------:|:------------:|:-----------------:|\n| S3\u306b\u30a2\u30af\u30bb\u30b9\u3055\u308c\u308b\u5074\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8 (S3\u30d0\u30b1\u30c3\u30c8\u304c\u3042\u308bAWS\u30a2\u30ab\u30a6\u30f3\u30c8) | example-s3-owner-account | 111111111111 |\n| S3\u3078\u30a2\u30af\u30bb\u30b9\u3059\u308b\u5074\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8 (S3\u30d0\u30b1\u30c3\u30c8\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308bAWS\u30a2\u30ab\u30a6\u30f3\u30c8) | example-s3-upload-account | 999999999999 |\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u6642\u306b\u4f7f\u7528\u3057\u305fAMI\n---\n\n\u30fbAmazon Linux AMI 2015.09.2 (HVM), SSD Volume Type - ami-59bdb937\n\nS3\u3078\u306e\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u4f7f\u7528\u3059\u308bAWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n---\n\n```\n[root@example-server ~]# aws --version\naws-cli/1.10.8 Python/2.7.10 Linux/4.1.19-24.31.amzn1.x86_64 botocore/1.3.30\n```\n\n\n\u53c2\u8003\u30b5\u30a4\u30c8\n---\n\n\u672c\u624b\u9806\u306e\u4f5c\u6210\u306b\u3042\u305f\u308a\u3001\u4ee5\u4e0b\u306e\u624b\u9806\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\n\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f\u3002\n\nAWS\u516c\u5f0f\nhttp://docs.aws.amazon.com/ja_jp/AmazonS3/latest/dev/example-walkthroughs-managing-access-example2.html\nhttp://docs.aws.amazon.com/ja_jp/AmazonS3/latest/dev/example-walkthroughs-managing-access-example3.html\n\nhttp://dev.classmethod.jp/cloud/aws/aws-cli-supports-assume-role-credentials-provider-and-mfa/\nAWS CLI\u304cAssumeRole\u306b\u3088\u308b\u81ea\u52d5\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u53d6\u5f97\u3068MFA\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\uff01\n\nhttp://qiita.com/web_se/items/879a235a47991cae7b69\nCross-Account Role \u81ea\u52d5\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u53d6\u5f97\u6a5f\u80fd\n\nhttp://yustam.hatenablog.com/entry/2015/02/07/135105\n\u4ed6\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3078S3\u30d0\u30b1\u30c3\u30c8\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3059\u308b\n\nhttps://blog.cloudpack.jp/2014/08/04/allow-other-account-to-write-to-amazon-s3/\nhttp://muramasa64.fprog.org/diary/?date=20140731\nAmazon S3\u306b\u5225\u30a2\u30ab\u30a6\u30f3\u30c8\u304b\u3089\u66f8\u304d\u8fbc\u307f\u3092\u8a31\u53ef\u3059\u308b\u5834\u5408\u306e\u8a2d\u5b9a\n\n\n\nS3\u306b\u30a2\u30af\u30bb\u30b9\u3055\u308c\u308b\u5074\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8(example-s3-owner-account)\u3067\u306e\u8a2d\u5b9a\n---\n\nS3\u306b\u30a2\u30af\u30bb\u30b9\u3055\u308c\u308b\u5074\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8(example-s3-owner-account)\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3001S3\u30d0\u30b1\u30c3\u30c8\u4f5c\u6210\u3084\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u8a2d\u5b9a\u3001IAM\u30dd\u30ea\u30b7\u30fc\u3084IAM\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n# (1)\u300cexample-s3-owner-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306bS3\u30d0\u30b1\u30c3\u30c8\u300cexample-s3-bucket\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u30fbAWS Management Console\u3067\u300cexample-s3-owner-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\n\u30fb\u300cS3\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u30d0\u30b1\u30c3\u30c8\u3092\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fbS3\u30d0\u30b1\u30c3\u30c8\u300cexample-s3-bucket\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u5f8c\u3067\u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5148\u3068\u3057\u3066\u4f7f\u7528\u3059\u308bupload\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\ns3://example-s3-bucket/upload/\n\n\u30fbS3\u30d0\u30b1\u30c3\u30c8\u300cexample-s3-bucket\u300d\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\nS3\u30d0\u30b1\u30c3\u30c8\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u5f8c\u3067\u3001curl\u30b3\u30de\u30f3\u30c9\u3067\u30d5\u30a1\u30a4\u30eb\u3078\u30a2\u30af\u30bb\u30b9\u51fa\u6765\u308b\u304b\u30c6\u30b9\u30c8\u3059\u308b\u70ba\u3001\u300caws:SourceIp\u300d\u3067\u7279\u5b9aIP\u30a2\u30c9\u30ec\u30b9(192.0.2.100/32\u3001192.0.2.101/32)\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u306e\u307f\u8a31\u53ef\u3057\u307e\u3059\u3002\n\n```json:example-s3-owner-account-example-s3-bucket-policy\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\n{\n\t\"Version\": \"2008-10-17\",\n\t\"Id\": \"example-s3-owner-account-example-s3-bucket-policy\",\n\t\"Statement\": [\n\t\t{\n\t\t\t\"Sid\": \"example-s3-bucket-20160316-001\",\n\t\t\t\"Effect\": \"Allow\",\n\t\t\t\"Principal\": {\n\t\t\t\t\"AWS\": \"*\"\n\t\t\t},\n\t\t\t\"Action\": \"s3:GetObject\",\n\t\t\t\"Resource\": \"arn:aws:s3:::example-s3-bucket/*\",\n\t\t\t\"Condition\": {\n\t\t\t\t\"IpAddress\": {\n\t\t\t\t\t\"aws:SourceIp\": [\n\t\t\t\t\t\t\"192.0.2.100/32\",\n\t\t\t\t\t\t\"192.0.2.101/32\"\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t]\n}\n```\n\n# (2)\u300cexample-s3-owner-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306bS3\u30d0\u30b1\u30c3\u30c8\u3078\u306e\u30a2\u30af\u30bb\u30b9\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u7528\u306eIAM\u30dd\u30ea\u30b7\u30fc\u300cexample-s3-owner-account-example-s3-bucket-iam-policy\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u30fbAWS Management Console\u3067\u300cexample-s3-owner-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\n\u30fb\u300cIdentity & access management\u300d(IAM)\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb IAM\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\u300d\u753b\u9762\u3067\u300c\u72ec\u81ea\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u4f5c\u6210\u300d\u306e\u300c\u9078\u629e\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u78ba\u8a8d\u300d\u753b\u9762\u3067\u300c\u30dd\u30ea\u30b7\u30fc\u540d\u300d\u306b\u300cexample-s3-owner-account-example-s3-bucket-iam-policy\u300d\u3068\u5165\u529b\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u78ba\u8a8d\u300d\u753b\u9762\u3067\u300c\u30dd\u30ea\u30b7\u30fc\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u300d\u306b\u4ee5\u4e0b\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\nS3\u30d0\u30b1\u30c3\u30c8\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308bAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u300cexample-s3-upload-account\u300d\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u5bfe\u3057\u3066\u306e\u307f\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3092\u8a31\u53ef\u3059\u308b\u70ba\u3001\u300caws:SourceIp\u300d\u3067AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u300cexample-s3-upload-account\u300d\u306enat\u30b5\u30fc\u30d0\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u306e\u307f\u8a31\u53ef\u3057\u307e\u3059\u3002nat\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9\u306f\u4f8b\u3068\u3057\u3066\u300c192.0.2.200/32\u300d\u3068\u3057\u3066\u8a18\u8f09\u3057\u3066\u3044\u307e\u3059\u3002\n\n```json:example-s3-owner-account-example-s3-bucket-iam-policy\u30dd\u30ea\u30b7\u30fc\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": \"s3:ListBucket\",\n            \"Condition\": {\n                \"IpAddress\": {\n                    \"aws:SourceIp\": [\n                        \"192.0.2.202/32\"\n                    ]\n                }\n            },\n            \"Resource\": \"arn:aws:s3:::example-s3-bucket\"\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"s3:GetObject\",\n                \"s3:PutObject\",\n                \"s3:DeleteObject\"\n            ],\n            \"Condition\": {\n                \"IpAddress\": {\n                    \"aws:SourceIp\": [\n                        \"192.0.2.202/32\"\n                    ]\n                }\n            },\n            \"Resource\": \"arn:aws:s3:::example-s3-bucket/*\"\n        }\n    ]\n}\n```\n\n\n\u30fb\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u78ba\u8a8d\u300d\u753b\u9762\u3067\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u691c\u8a3c\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u3053\u306e\u30dd\u30ea\u30b7\u30fc\u306f\u6709\u52b9\u3067\u3059\u300d\u3068\u8868\u793a\u3055\u308c\u305f\u3089\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fbIAM\u30dd\u30ea\u30b7\u30fc\u300cexample-s3-owner-account-example-s3-bucket-iam-policy \u304c\u4f5c\u6210\u3055\u308c\u307e\u3057\u305f\u3002\u300d\u3068\u8868\u793a\u3055\u308c\u308b\u4e8b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n\n\n# (3)\u300cexample-s3-owner-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306bAssumeRole\u7528IAM\u30ed\u30fc\u30eb\uff62example_s3_user_assumerole_example-s3-upload-account-iam-role\uff63\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306bS3\u3078\u306e\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u6a29\u9650\u3092\u6e21\u3059\u70ba\u3001\u300cexample-s3-owner-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306bAssumeRole\u7528IAM\u30ed\u30fc\u30eb\uff62example_s3_user_assumerole_example-s3-upload-account-iam-role\uff63\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u30fbAWS Management Console\u3067\u300cexample-s3-owner-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\n\u30fb\u300cIdentity & access management\u300d(IAM)\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3002\n\n\u30fbIAM\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u300c\u30ed\u30fc\u30eb\u300d\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3002\n\n\u30fb\u300c\u65b0\u3057\u3044\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3002\n\n\u30fb\u300c\u30ed\u30fc\u30eb\u540d\u306e\u8a2d\u5b9a\u300d\u753b\u9762\u3067\u30ed\u30fc\u30eb\u540d\u306b\u300cexample_s3_user_assumerole_example-s3-upload-account-iam-role\u300d\u3068\u5165\u529b\u3057\u307e\u3059\u3002\u300c\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u30ed\u30fc\u30eb\u30bf\u30a4\u30d7\u306e\u9078\u629e\u300d\u753b\u9762\u3067\u300c\u30af\u30ed\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u30a2\u30af\u30bb\u30b9\u306e\u30ed\u30fc\u30eb\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u30ed\u30fc\u30eb\u30bf\u30a4\u30d7\u306e\u9078\u629e\u300d\u753b\u9762\u3067\u300c\u6240\u6709\u3057\u3066\u3044\u308b AWS \u30a2\u30ab\u30a6\u30f3\u30c8\u9593\u306e\u30a2\u30af\u30bb\u30b9\u3092\u63d0\u4f9b\u3057\u307e\u3059\u300d\u306e\u300c\u9078\u629e\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n---\n**\u30fb\u300c\u3053\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b IAM \u30e6\u30fc\u30b6\u30fc\u306e AWS \u30a2\u30ab\u30a6\u30f3\u30c8\u306e ID \u3092\u5165\u529b\u3057\u307e\u3059\u3002\u300d\u3068\u8868\u793a\u3055\u308c\u307e\u3059\u3002**\n\n**\u300c\u30a2\u30ab\u30a6\u30f3\u30c8ID\u300d\u306b\u300c999999999999\u300d(example-s3-upload-account\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8ID)\u3092\u5165\u529b\u3057\u307e\u3059\u3002**\n\n\u300cMFA\u304c\u5fc5\u8981\u300d\u306e\u30c1\u30a7\u30c3\u30af\u306f\u4ed8\u3051\u305a\u306b\u300c\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n---\n**\u30fb\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u30a2\u30bf\u30c3\u30c1\u300d\u753b\u9762\u3067\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u300cexample-s3-owner-account-example-s3-bucket-iam-policy\u300d\u30dd\u30ea\u30b7\u30fc\u306b\u30c1\u30a7\u30c3\u30af\u3092\u4ed8\u3051\u3066\u30a2\u30bf\u30c3\u30c1\u3057\u307e\u3059\u3002**\n\n\u30fb\u300c\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u78ba\u8a8d\u300d\u753b\u9762\u3067\u4eca\u56de\u4f5c\u6210\u3055\u308c\u308bIAM\u30ed\u30fc\u30eb\u306e\u300c\u30ed\u30fc\u30ebARN\u300d\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u63a7\u3048\u3066\u304a\u304d\u307e\u3059\u3002\n\narn:aws:iam::111111111111:role/example_s3_user_assumerole_example-s3-upload-account-iam-role\n\n\u30fb\u300c\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fbIAM\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u300c\u30ed\u30fc\u30eb\u300d->\u300cexample_s3_user_assumerole_example-s3-upload-account-iam-role\u300d\u30ed\u30fc\u30eb\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300cexample_s3_user_assumerole_example-s3-upload-account-iam-role\u300d\u30ed\u30fc\u30eb\u306e\u300c\u4fe1\u983c\u95a2\u4fc2\u300d\u30bf\u30d6\u3067\u300c\u30dd\u30ea\u30b7\u30fc\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u8868\u793a\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u300cexample-s3-upload-account\u300d(AWS\u30a2\u30ab\u30a6\u30f3\u30c8ID:999999999999)\u3092\u4fe1\u983c\u3059\u308b\u8a2d\u5b9a\u306b\u306a\u3063\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```json:example_s3_user_assumerole_example-s3-upload-account-iam-role\u306e\u4fe1\u983c\u95a2\u4fc2\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"AWS\": \"arn:aws:iam::999999999999:root\"\n      },\n      \"Action\": \"sts:AssumeRole\"\n    }\n  ]\n}\n```\n\nS3\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u5074\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8(example-s3-upload-account)\u3067\u306e\u8a2d\u5b9a\n---\n\nS3\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u5074\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8(example-s3-upload-account)\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3001IAM\u30e6\u30fc\u30b6\u3001IAM\u30dd\u30ea\u30b7\u30fc\u3001IAM\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\n# (4)\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u300cexample-s3-owner-account\u300d\u306eAssumeRole\u6a29\u9650\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3059\u308bIAM\u30dd\u30ea\u30b7\u30fc\u300cexample_s3_user_assumerole_example-s3-owner-account-iam-policy\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u30fbAWS Management Console\u3067\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\n\u30fb\u300cIdentity & access management\u300d(IAM)\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fbIAM\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\u300d\u753b\u9762\u3067\u300c\u72ec\u81ea\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u4f5c\u6210\u300d\u306e\u300c\u9078\u629e\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u78ba\u8a8d\u300d\u753b\u9762\u3067\u300c\u30dd\u30ea\u30b7\u30fc\u540d\u300d\u306b\u300cexample_s3_user_assumerole_example-s3-owner-account-iam-policy\u300d\u3068\u5165\u529b\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u78ba\u8a8d\u300d\u753b\u9762\u3067\u300c\u30dd\u30ea\u30b7\u30fc\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u300d\u306b\u4ee5\u4e0b\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\n\u3053\u3053\u3067\u306fS3\u30d0\u30b1\u30c3\u30c8\u304c\u3042\u308bAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u300cexample-s3-owner-account\u300d(AWS\u30a2\u30ab\u30a6\u30f3\u30c8ID:111111111111)\u3068\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fIAM\u30ed\u30fc\u30eb\u306eARN\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```json:example_s3_user_assumerole_example-s3-owner-account-iam-policy\u30dd\u30ea\u30b7\u30fc\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": {\n        \"Effect\": \"Allow\",\n        \"Action\": \"sts:AssumeRole\",\n        \"Resource\": [\n           \"arn:aws:iam::111111111111:role/example_s3_user_assumerole_example-s3-upload-account-iam-role\"\n        ]\n    }\n}\n```\n\n\u30fb\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u78ba\u8a8d\u300d\u753b\u9762\u3067\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u691c\u8a3c\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u3053\u306e\u30dd\u30ea\u30b7\u30fc\u306f\u6709\u52b9\u3067\u3059\u300d\u3068\u8868\u793a\u3055\u308c\u305f\u3089\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fbIAM\u30dd\u30ea\u30b7\u30fc\u300cexample_s3_user_assumerole_example-s3-owner-account-iam-policy \u304c\u4f5c\u6210\u3055\u308c\u307e\u3057\u305f\u3002\u300d\u3068\u8868\u793a\u3055\u308c\u308b\u4e8b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n\n\n# (5)\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u300cexample-s3-owner-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306eAssumeRole\u6a29\u9650\u3092\u5f15\u304d\u53d7\u3051\u308bIAM\u30e6\u30fc\u30b6\u300cexample_s3_user_assumerole_example-s3-owner-account-iam-user\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nS3\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308bAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306bIAM\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u30fbAWS Management Console\u3067\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\n\u30fb\u300cIdentity & access management\u300d(IAM)\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb IAM\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u300c\u30e6\u30fc\u30b6\u30fc\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u65b0\u898f\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u30e6\u30fc\u30b6\u30fc\u540d\u306e\u5165\u529b\u300d\u306b\u300cexample_s3_user_assumerole_example-s3-owner-account-iam-user\u300d\u3068\u5165\u529b\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u30e6\u30fc\u30b6\u30fc\u3054\u3068\u306b\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3092\u751f\u6210\u300d\u306b\u30c1\u30a7\u30c3\u30af\u3092\u4ed8\u3051\u3066\u300c\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u30e6\u30fc\u30b6\u30fc\u304c\u6b63\u5e38\u306b\u4f5c\u6210\u3055\u308c\u307e\u3057\u305f\u300d\u3068\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u300c\u30e6\u30fc\u30b6\u30fc\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a8d\u8a3c\u60c5\u5831\u3092\u8868\u793a\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3001\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u3092\u63a7\u3048\u3066\u304a\u304d\u307e\u3059\u3002\n\n```bash:example_s3_user_assumerole_example-s3-owner-account-iam-user\u306e\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\n\u30a2\u30af\u30bb\u30b9\u30ad\u30fc ID:\nAK******************\n\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30a2\u30af\u30bb\u30b9\u30ad\u30fc:\nWP**************************************\n```\n\n\u30fb\u300c\u8a8d\u8a3c\u60c5\u5831\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3001\u4e0a\u8a18\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u3092\u81ea\u5206\u306ePC\u306b\u4fdd\u5b58\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\n\n# (6)\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306eIAM\u30e6\u30fc\u30b6\u300cexample_s3_user_assumerole_example-s3-owner-account-iam-user\u300d\u306b\u5bfe\u3057\u3066\u3001\u300cexample-s3-owner-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306eAssumeRole\u6a29\u9650\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002\n\n\u30fbAWS Management Console\u3067\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n \n\u30fb\u300cIdentity & access management\u300d(IAM)\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n \n\u30fbIAM\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u300c\u30e6\u30fc\u30b6\u30fc\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n \n\u30fb\u300c\u30e6\u30fc\u30b6\u30fc\u540d\u300d->\u300cexample_s3_user_assumerole_example-s3-owner-account-iam-user\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u300d\u30bf\u30d6\u306e\u300c\u7ba1\u7406\u30dd\u30ea\u30b7\u30fc\u300d\u2192\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u30a2\u30bf\u30c3\u30c1\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n---\n**\u30fb\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u30a2\u30bf\u30c3\u30c1\u300d\u753b\u9762\u3067\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u300cexample_s3_user_assumerole_example-s3-owner-account-iam-policy\u300d\u30dd\u30ea\u30b7\u30fc\u306b\u30c1\u30a7\u30c3\u30af\u3092\u4ed8\u3051\u3066\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u30a2\u30bf\u30c3\u30c1\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002**\n\n\n# (7)\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7528\u306eIAM\u30ed\u30fc\u30eb\u300cexample-server-role\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u300cexample-s3-owner-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306eS3\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7528\u306eIAM\u30ed\u30fc\u30eb\u300cexample-server-role\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u30fbAWS Management Console\u3067\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\n\u30fb\u300cIdentity & access management\u300d(IAM)\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb IAM\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u300c\u30ed\u30fc\u30eb\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u65b0\u3057\u3044\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u30ed\u30fc\u30eb\u540d\u306e\u8a2d\u5b9a\u300d\u753b\u9762\u3067\u30ed\u30fc\u30eb\u540d\u306b\u300cexample-server-role\u300d\u3068\u5165\u529b\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u30ed\u30fc\u30eb\u30bf\u30a4\u30d7\u306e\u9078\u629e\u300d\u753b\u9762\u3067\u300cAWS\u30b5\u30fc\u30d3\u30b9\u30ed\u30fc\u30eb\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u30ed\u30fc\u30eb\u30bf\u30a4\u30d7\u306e\u9078\u629e\u300d\u753b\u9762\u3067\u300cAmazon EC2\u300d\u306e\u300c\u9078\u629e\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u30a2\u30bf\u30c3\u30c1\u300d\u753b\u9762\u3067\u300cexample_s3_user_assumerole_example-s3-owner-account-iam-policy\u300d\u30dd\u30ea\u30b7\u30fc\u306b\u30c1\u30a7\u30c3\u30af\u3092\u4ed8\u3051\u3066\u300c\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u300c\u78ba\u8a8d\u300d\u753b\u9762\u3067\u4eca\u56de\u4f5c\u6210\u3055\u308c\u308bIAM\u30ed\u30fc\u30eb\u306e\u300c\u30ed\u30fc\u30ebARN\u300d\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u63a7\u3048\u3066\u304a\u304d\u307e\u3059\u3002\narn:aws:iam::999999999999:role/example-server-role\n\n\u30fb\u300c\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fbIAM\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u300c\u30ed\u30fc\u30eb\u300d->\u300cexample-server-role\u300d\u30ed\u30fc\u30eb\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3002\n\n\u30fb\u300cexample-server-role\u300d\u30ed\u30fc\u30eb\u306e\u300c\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u300d\u30bf\u30d6\u3067\u300c\u7ba1\u7406\u30dd\u30ea\u30b7\u30fc\u300d->\u300cexample_s3_user_assumerole_example-s3-owner-account-iam-policy\u300d\u30dd\u30ea\u30b7\u30fc\u306e\u300c\u30dd\u30ea\u30b7\u30fc\u306e\u8868\u793a\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fb\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u300cexample-s3-owner-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8(AWS\u30a2\u30ab\u30a6\u30f3\u30c8ID:111111111111)\u306eAssumeRole\u3092\u5229\u7528\u51fa\u6765\u308b\u8a2d\u5b9a\u306b\u306a\u3063\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n```json:example_s3_user_assumerole_example-s3-owner-account-iam-policy\u30dd\u30ea\u30b7\u30fc\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": {\n        \"Effect\": \"Allow\",\n        \"Action\": \"sts:AssumeRole\",\n        \"Resource\": [\n           \"arn:aws:iam::111111111111:role/example_s3_user_assumerole_example-s3-upload-account-iam-role\"\n        ]\n    }\n}\n```\n\n\n# (8) \u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306bS3\u3078\u306e\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3092\u5b9f\u884c\u3059\u308bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u300cexample-server\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u30fbAWS Management Console\u3067\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\n\u30fb\u300cEC2\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30fbAmazonLinux\u306eAMI\u3067EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u300cexample-server\u300d\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u6642\u306b\u306f\u3001IAM\u30ed\u30fc\u30eb\u3068\u3057\u3066\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u300cexample-server-role\u300d\u30ed\u30fc\u30eb\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\nS3\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8a2d\u5b9a(\u81ea\u52d5\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u53d6\u5f97\u8a2d\u5b9a\u3067AssumeRole\u306e\u30ad\u30fc\u3092\u81ea\u52d5\u8a2d\u5b9a\u3059\u308b)\n---\n\n# (9)\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u4f5c\u6210\u3057\u305fEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u81ea\u52d5\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u53d6\u5f97\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059(example-s3-owner-account\u30a2\u30ab\u30a6\u30f3\u30c8\u306eAssumeRole\u6a29\u9650\u3092\u5229\u7528\u3059\u308b\u70ba\u306e\u8a2d\u5b9a\u3067\u3059)\u3002\n\n\u30fb/home/user/.aws\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash:/home/user/.aws\n[user@example-server ~]$ hostname\nexample-server\n[user@example-server ~]$ mkdir /home/user/.aws\n[user@example-server ~]$ chmod 700 /home/user/.aws\n[user@example-server ~]$ \n```\n\n\u30fb/home/user/.aws/config\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash:/home/user/.aws/config\n[user@example-server ~]$ vi /home/user/.aws/config\n[profile example_s3_user]\noutput = json\nregion = ap-northeast-1\n\n[profile example_s3_user_assumerole_example-s3-owner-account-iam-user]\noutput = json\nregion = ap-northeast-1\n```\n\n\u30fb/home/user/.aws/credentials\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u306b\u3064\u3044\u3066\u306f\u3001\u524d\u8ff0\u306e(5)\u3001S3\u30d8\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u5074\u306e\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u4f5c\u6210\u3057\u305f\u300cexample_s3_user_assumerole_example-s3-owner-account-iam-user\u300d\u30e6\u30fc\u30b6\u306e\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\n```\n[user@example-server ~]$ vi /home/user/.aws/credentials \n# example-s3-owner-account IAM Role arn:aws:iam::111111111111:role/example_s3_user_assumerole_example-s3-upload-account-iam-role\n[example_s3_user]\nrole_arn = arn:aws:iam::111111111111:role/example_s3_user_assumerole_example-s3-upload-account-iam-role\nsource_profile = example_s3_user_assumerole_example-s3-owner-account-iam-user\n\n# example-s3-upload-account IAM User example_s3_user_assumerole_example-s3-owner-account-iam-user\n[example_s3_user_assumerole_example-s3-owner-account-iam-user]\naws_access_key_id = AK******************\naws_secret_access_key = WP**************************************\n```\n\n\u30fb\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```\n[user@example-server ~]$ chmod 600 /home/user/.aws/config\n[user@example-server ~]$ chmod 600 /home/user/.aws/credentials\n```\n\n\u30fb\u4f5c\u6210\u3057\u305f\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:/home/user/.aws/\n[user@example-server ~]$ hostname\nexample-server\n[user@example-server ~]$ ls -lrta /home/user/ | grep .aws\ndrwx------ 2 user  group 4096 Mar 17 01:24 .aws\n[user@example-server ~]$ \n[user@example-server ~]$ ls -lrta /home/user/.aws/\ntotal 16\n-rw------- 1 user  group  165 Mar 17 01:20 config\n-rw------- 1 user  group  495 Mar 17 01:24 credentials\ndrwx------ 5 user  group 4096 Mar 17 01:24 ..\ndrwx------ 2 user  group 4096 Mar 17 01:24 .\n[user@example-server ~]$ \n```\n\n```bash:/home/user/.aws/config\n[user@example-server ~]$ cat /home/user/.aws/config\n[profile example_s3_user]\noutput = json\nregion = ap-northeast-1\n\n[profile example_s3_user_assumerole_example-s3-owner-account-iam-user]\noutput = json\nregion = ap-northeast-1\n[user@example-server ~]$\n```\n\n```bash:/home/user/.aws/credentials\n[user@example-server ~]$ cat /home/user/.aws/credentials\n# example-s3-owner-account IAM Role arn:aws:iam::111111111111:role/example_s3_user_assumerole_example-s3-upload-account-iam-role\n[example_s3_user]\nrole_arn = arn:aws:iam::111111111111:role/example_s3_user_assumerole_example-s3-upload-account-iam-role\nsource_profile = example_s3_user_assumerole_example-s3-owner-account-iam-user\n\n# example-s3-upload-account IAM User example_s3_user_assumerole_example-s3-owner-account-iam-user\n[example_s3_user_assumerole_example-s3-owner-account-iam-user]\naws_access_key_id = AK******************\naws_secret_access_key = WP**************************************\n[user@example-server ~]$ \n```\n\n\n# (10)\u300cexample-s3-upload-account\u300d\u30a2\u30ab\u30a6\u30f3\u30c8\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u300cexample-s3-owner-account\u300d\u306b\u3042\u308bS3\u30d0\u30b1\u30c3\u30c8\u300cexample-s3-bucket\u300d\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u51fa\u6765\u308b\u304b\u30c6\u30b9\u30c8\u3057\u307e\u3059\u3002\n\n```\n[user@example-server ~]$ hostname\nexample-server\n[user@example-server ~]$ curl http://httpbin.org/ip\n{\n  \"origin\": \"192.0.2.202\"\n}\n[user@example-server ~]$ \n\n[user@example-server ~]$ aws --profile=example_s3_user s3 ls s3://example-s3-bucket/\n                           PRE upload/\n[user@example-server ~]$ \n[user@example-server ~]$ aws --profile=example_s3_user s3 ls s3://example-s3-bucket/upload/\n2016-03-17 XX:XX:XX          0 \n[user@example-server ~]$ \n\n[user@example-server ~]$ hostname > /tmp/test.txt\n[user@example-server ~]$ \n\n[user@example-server ~]$ aws --profile=example_s3_user s3 cp /tmp/test.txt s3://example-s3-bucket/upload/\nupload: ../../tmp/test.txt to s3://example-s3-bucket/upload/test.txt\n[user@example-server ~]$ \n\n[user@example-server ~]$ aws --profile=example_s3_user s3 ls s3://example-s3-bucket/upload/\n2016-03-17 XX:XX:XX          0 \n2016-03-17 XX:XX:XX         48 test.txt\n[user@example-server ~]$ \n\n[user@example-server ~]$ aws --profile=example_s3_user s3 ls s3://example-s3-bucket/upload/test.txt\n2016-03-17 XX:XX:XX         48 test.txt\n[user@example-server ~]$ \n\n[user@example-server ~]$ aws --profile=example_s3_user s3 rm s3://example-s3-bucket/upload/test.txt\ndelete: s3://example-s3-bucket/upload/test.txt\n[user@example-server ~]$ \n\n[user@example-server ~]$ aws --profile=example_s3_user s3 ls s3://example-s3-bucket/upload/test.txt\n[user@example-server ~]$ \n\n[user@example-server ~]$ aws --profile=example_s3_user s3 ls s3://example-s3-bucket/upload/\n2016-03-17 XX:XX:XX          0 \n[user@example-server ~]$ \n\n[user@example-server ~]$ aws --profile=example_s3_user s3 cp /tmp/test.txt s3://example-s3-bucket/upload/\nupload: ../../tmp/test.txt to s3://example-s3-bucket/upload/test.txt\n[user@example-server ~]$ \n\n[user@example-server ~]$ aws --profile=example_s3_user s3 ls s3://example-s3-bucket/upload/test.txt\n2016-03-17 XX:XX:XX         48 test.txt\n[user@example-server ~]$ \n\n[user@example-server ~]$ rm /tmp/test.txt\n[user@example-server ~]$ ls -lrta /tmp/test.txt\nls: cannot access /tmp/test.txt: No such file or directory\n[user@example-server ~]$ \n\n[user@example-server ~]$ aws --profile=example_s3_user s3 cp s3://example-s3-bucket/upload/test.txt /tmp/\ndownload: s3://example-s3-bucket/upload/test.txt to ../../tmp/test.txt\n[user@example-server ~]$ \n\n[user@example-server ~]$ ls -lrta /tmp/test.txt\n-rw-rw-r-- 1 user group 48 Mar 17 XX:XX /tmp/test.txt\n[user@example-server ~]$ \n\n[user@example-server ~]$ cat /tmp/test.txt\nexample-server\n[user@example-server ~]$ \n```\n\n# (11)\u300cexample-s3-owner-account\u300d\u306e\u300cexample-s3-bucket\u300d\u306eS3\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u3067\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u3057\u305fIP\u30a2\u30c9\u30ec\u30b9(192.0.2.100/32)\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u51fa\u6765\u308b\u304b\u30c6\u30b9\u30c8\u3057\u307e\u3059\u3002\n\n```bash:S3\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u3067\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u3057\u305fIP\u30a2\u30c9\u30ec\u30b9(192.0.2.100/32)\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u51fa\u6765\u308b\u304b\u30c6\u30b9\u30c8\n[user2@example-server-allow-ip ~]$ hostname\nexample-server-allow-ip\n[user2@example-server-allow-ip ~]$ curl httpbin.org/ip\n{\n  \"origin\": \"192.0.2.100\"\n}\n[user2@example-server-allow-ip ~]$\n\n[user2@example-server-allow-ip ~]$ curl https://s3-ap-northeast-1.amazonaws.com/example-s3-bucket/upload/test.txt\nexample-server\n[user2@example-server-allow-ip ~]$\n\n[user2@example-server-allow-ip ~]$ rm test.txt\n[user2@example-server-allow-ip ~] $ls -lrta test.txt\nls: test.txt: No such file or directory\n[user2@example-server-allow-ip ~]$\n\n[user2@example-server-allow-ip ~]$ wget -nv https://s3-ap-northeast-1.amazonaws.com/example-s3-bucket/upload/test.txt\n2016-03-16 19:00:14 URL:https://s3-ap-northeast-1.amazonaws.com/example-s3-bucket/upload/test.txt [48/48] -> \"test.txt\" [1]\n[user2@example-server-allow-ip ~]$\n\n[user2@example-server-allow-ip ~]$ ls -lrta test.txt\n-rw-rw-r-- 1 user group 48 Mar 17 XX:XX /tmp/test.txt\n[user2@example-server-allow-ip ~]$\n\n[user2@example-server-allow-ip ~]$ cat test.txt\nexample-server\n[user2@example-server-allow-ip ~]$\n```\n\n\n# (12)\u300cexample-s3-owner-account\u300d\u306e\u300cexample-s3-bucket\u300d\u306eS3\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u3067\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u3057\u3066\u3044\u306a\u3044IP\u30a2\u30c9\u30ec\u30b9(192.0.2.199/32)\u304b\u3089\u306f\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u51fa\u6765\u306a\u3044\u4e8b\u3092\u30c6\u30b9\u30c8\u3057\u307e\u3059\u3002\n\nS3\u30d8\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306bS3\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u304c\u9069\u7528\u3055\u308c\u3066\u3044\u308b\u304b\u30c6\u30b9\u30c8\u3059\u308b\u70ba\u3001S3\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u3067\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u3057\u3066\u3044\u306a\u3044IP\u30a2\u30c9\u30ec\u30b9(192.0.2.199/32)\u304b\u3089\u306f\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u51fa\u6765\u306a\u3044\u4e8b\u3092\u30c6\u30b9\u30c8\u3057\u307e\u3059\u3002\n \n```bash:S3\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u3067\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u3057\u3066\u3044\u306a\u3044IP\u30a2\u30c9\u30ec\u30b9(192.0.2.199/32)\u304b\u3089\u306f\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u51fa\u6765\u306a\u3044\u4e8b\u3092\u30c6\u30b9\u30c8\n[user3@example-server-deny-ip ~]$ hostname\nexample-server-deny-ip\n\n[user3@example-server-deny-ip ~]$ curl httpbin.org/ip\n{\n  \"origin\": \"192.0.2.199\"\n}\n[user3@example-server-deny-ip ~]$\n\n[user3@example-server-deny-ip ~]$ curl https://s3-ap-northeast-1.amazonaws.com/example-s3-bucket/upload/test.txt\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<Error><Code>AccessDenied</Code><Message>Access Denied</Message><RequestId>*******************</RequestId><HostId>******************************************************</HostId></Error>[user3@example-server-deny-ip ~]$\n[user3@example-server-deny-ip ~]$\n\n[user3@example-server-deny-ip ~]$ wget -nv https://s3-ap-northeast-1.amazonaws.com/example-s3-bucket/upload/test.txt\nhttps://s3-ap-northeast-1.amazonaws.com/example-s3-bucket/upload/test.txt:\n2016-03-16 19:01:14 ERROR 403: Forbidden.\n[user3@example-server-deny-ip ~]$\n\n[user3@example-server-deny-ip ~]$ ls -lrta test.txt\nls: cannot access test.txt: No such file or directory\n[user3@example-server-deny-ip ~]$\n```\n\n***\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067aws s3 cp\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3001\u4ed6\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u3042\u308bS3\u30d0\u30b1\u30c3\u30c8\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u51fa\u6765\u305f\u3089\u8a2d\u5b9a\u5b8c\u4e86\u3067\u3059\u3002\n\n\u9577\u304f\u306a\u308a\u307e\u3057\u305f\u304c\u3001\u4ee5\u4e0a\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u3054\u53c2\u8003\u306b\u306a\u308a\u307e\u3057\u305f\u3089\u5e78\u3044\u3067\u3059\u3002\n", "tags": ["AWS", "aws-cli", "S3"]}