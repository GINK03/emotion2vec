{"context": " More than 1 year has passed since last update.Proxmox software raid - MontelLUG\u3092\u53c2\u8003\u306b\u3084\u3063\u3066\u307f\u305f\u3002 \nproxmox3.2\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u76f4\u5f8c\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u4ee5\u4e0bboot\u30aa\u30d7\u30b7\u30e7\u30f3\u4f7f\u7528\n> linux ext4 maxroot=10 swapsize=4\n\u4eca\u306e\u69cb\u6210\n\n/dev/sda --- OS\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3002\n/dev/sdb --- RAID1\u7528\u3002\u4eca\u306f\u7a7a\n\n\u30dc\u30ea\u30e5\u30fc\u30e0\u4e88\u5b9a\n\n/dev/md1 : /boot\n/dev/md2 : /\n\n\n\u6e96\u5099\n\nmdadm\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# apt-get install -y mdadm sudo vim screen\nall\u3092\u9078\u629e\n# modprobe raid1\n\n\n\nGPT\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u69cb\u6210\u306e\u30b3\u30d4\u30fc(sda->sdb)\n# sgdisk -R /dev/sdb /dev/sda\n\n\n\nRAID1\u306e\u6e96\u5099\n# sgdisk -G /dev/sdb\n# sgdisk --randomize-guids --move-second-header /dev/sdb\n# parted -s /dev/sdb set 2 \"raid\" on\n# parted -s /dev/sdb set 3 \"raid\" on\n# mdadm --zero-superblock /dev/sdb2\n# mdadm --zero-superblock /dev/sdb3\n# mdadm --create /dev/md1 --level=1 --raid-disks=2 missing /dev/sdb2\ny\n# mdadm --create /dev/md2 --level=1 --raid-disks=2 missing /dev/sdb3\ny\n# cp /etc/mdadm/mdadm.conf{,.org}\n# mdadm --examine --scan >> /etc/mdadm/mdadm.conf\n\n\n\n/boot \u306eRAID1\u5316\n\n/boot\u306eRAID1\u5316\n# mkfs.ext4 /dev/md1\n# mkdir /mnt/md1\n# mount /dev/md1 /mnt/md1\n# cp -ax /boot/* /mnt/md1\n\n\n\n/etc/fstab\n-UUID=c1e90048-e3fd-48e8-a337-XXXXXXXXXXXX /boot ext4 defaults 0 1\n+/dev/md1 /boot ext4 defaults 0 1\n\n\n\nOS\u518d\u8d77\u52d5\n# reboot\n\n\n\nGRUB\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# cat >> /etc/default/grub <<EOL\nGRUB_DISABLE_LINUX_UUID=true\nGRUB_PRELOAD_MODULES=\"raid dmraid\"\nGRUB_TERMINAL=console\nEOL\n# echo raid1 >> /etc/modules\n# echo raid1 >> /etc/initramfs-tools/modules\n# grub-install /dev/sda --recheck\n# grub-install /dev/sdb --recheck\n# update-grub\n\n\n\n/ \u306eRAID1\u5316\n# parted -s /dev/sda set 2 \"raid\" on\n# mdadm --add /dev/md1 /dev/sda2\n# pvcreate /dev/md2\n# vgextend pve /dev/md2\n\n\n500gb\u30673\u6642\u9593\u304f\u3089\u3044\u304b\u304b\u308b\n# pvmove /dev/sda3 /dev/md2\n  /dev/sda3: Moved: 0.0%\n  /dev/sda3: Moved: 0.1%\n  ...\n  /dev/sda3: Moved: 100.0%\n\n\n# vgreduce pve /dev/sda3\n# parted -s /dev/sda set 3 \"raid\" on\n# mdadm --add /dev/md2 /dev/sda3\n\n[Proxmox software raid - MontelLUG](http://www.montellug.it/wiki/index.php?title=Proxmox_software_raid)\u3092\u53c2\u8003\u306b\u3084\u3063\u3066\u307f\u305f\u3002 \n\nproxmox3.2\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u76f4\u5f8c\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u4ee5\u4e0bboot\u30aa\u30d7\u30b7\u30e7\u30f3\u4f7f\u7528\n\n`> linux ext4 maxroot=10 swapsize=4`\n\n\n\u4eca\u306e\u69cb\u6210\n\n* /dev/sda --- OS\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3002\n* /dev/sdb --- RAID1\u7528\u3002\u4eca\u306f\u7a7a\n\n\u30dc\u30ea\u30e5\u30fc\u30e0\u4e88\u5b9a\n\n* /dev/md1 : /boot\n* /dev/md2 : /\n\n\u6e96\u5099\n=======\n\n```bash:mdadm\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# apt-get install -y mdadm sudo vim screen\nall\u3092\u9078\u629e\n# modprobe raid1\n```\n\n```bash:GPT\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u69cb\u6210\u306e\u30b3\u30d4\u30fc(sda->sdb)\n# sgdisk -R /dev/sdb /dev/sda\n```\n\n```bash:RAID1\u306e\u6e96\u5099\n# sgdisk -G /dev/sdb\n# sgdisk --randomize-guids --move-second-header /dev/sdb\n# parted -s /dev/sdb set 2 \"raid\" on\n# parted -s /dev/sdb set 3 \"raid\" on\n# mdadm --zero-superblock /dev/sdb2\n# mdadm --zero-superblock /dev/sdb3\n# mdadm --create /dev/md1 --level=1 --raid-disks=2 missing /dev/sdb2\ny\n# mdadm --create /dev/md2 --level=1 --raid-disks=2 missing /dev/sdb3\ny\n# cp /etc/mdadm/mdadm.conf{,.org}\n# mdadm --examine --scan >> /etc/mdadm/mdadm.conf\n```\n\n/boot \u306eRAID1\u5316\n===============\n\n```bash:/boot\u306eRAID1\u5316\n# mkfs.ext4 /dev/md1\n# mkdir /mnt/md1\n# mount /dev/md1 /mnt/md1\n# cp -ax /boot/* /mnt/md1\n```\n\n```diff:/etc/fstab\n-UUID=c1e90048-e3fd-48e8-a337-XXXXXXXXXXXX /boot ext4 defaults 0 1\n+/dev/md1 /boot ext4 defaults 0 1\n```\n\n```bash:OS\u518d\u8d77\u52d5\n# reboot\n```\n\n\n```bash:GRUB\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# cat >> /etc/default/grub <<EOL\nGRUB_DISABLE_LINUX_UUID=true\nGRUB_PRELOAD_MODULES=\"raid dmraid\"\nGRUB_TERMINAL=console\nEOL\n# echo raid1 >> /etc/modules\n# echo raid1 >> /etc/initramfs-tools/modules\n# grub-install /dev/sda --recheck\n# grub-install /dev/sdb --recheck\n# update-grub\n```\n\n/ \u306eRAID1\u5316\n===========\n\n```bash:\n# parted -s /dev/sda set 2 \"raid\" on\n# mdadm --add /dev/md1 /dev/sda2\n# pvcreate /dev/md2\n# vgextend pve /dev/md2\n```\n\n```bash:500gb\u30673\u6642\u9593\u304f\u3089\u3044\u304b\u304b\u308b\n# pvmove /dev/sda3 /dev/md2\n  /dev/sda3: Moved: 0.0%\n  /dev/sda3: Moved: 0.1%\n  ...\n  /dev/sda3: Moved: 100.0%\n```\n\n```bash:\n# vgreduce pve /dev/sda3\n# parted -s /dev/sda set 3 \"raid\" on\n# mdadm --add /dev/md2 /dev/sda3\n```\n", "tags": ["proxmox"]}