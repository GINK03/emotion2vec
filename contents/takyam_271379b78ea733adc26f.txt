{"context": " More than 1 year has passed since last update.\u203b\u6ce8\u610f\uff1a\u4ee5\u4e0b\u306e\u8a18\u4e8b\u306f2014/12/28\u6642\u70b9\u306eDart\u3084\u5404\u30d1\u30c3\u30b1\u30fc\u30b8\u5185\u5bb9\u3092\u5143\u306b\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\n\nTL;DR\n\n\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u4f7f\u3048\nDart\u30ec\u30d9\u30eb\u304c\uff11\u3042\u304c\u3063\u305f\u3002\u3071\u3089\u3071\u3089\u3063\u3071\u3063\u3071\u30fc\n\n\n\u307e\u3048\u304c\u304d\nDart\u306f\u4e3b\u306b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u306e\u5229\u7528\u304c\u671f\u5f85\u3055\u308c\u3066\u308b\u8a00\u8a9e\u3060\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u500b\u4eba\u7684\u306b\u306fBetter NodeJS\u3068\u3057\u3066\u304b\u306a\u308a\u671f\u5f85\u3057\u3066\u3044\u307e\u3059\u3002\nNodeJS\u306fJS...\u3068\u3044\u3046\u304bV8\u304c\u30d9\u30fc\u30b9\u306a\u306e\u3067\u3001V8\u304c\u5bfe\u5fdc\u3057\u3066\u306a\u3044ES6\u306e\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u306f\uff08\u305d\u306e\u307e\u307e\u3060\u3068\uff09\u4f7f\u3048\u306a\u3044\u3067\u3059\u3057\u3001ES6\u3082JS\u304c\u62b1\u3048\u3066\u3044\u308b\u30d5\u30e9\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u89e3\u6c7a\u3057\u304d\u3063\u3066\u308b\u308f\u3051\u3067\u306f\u7121\u3044\u3067\u3059\u3057\u3001JS\u304c\u30d6\u30e9\u30a6\u30b6\u3067\u4f7f\u308f\u308c\u308b\u4e8b\u3092\u524d\u63d0\u3068\u3057\u305f\u8a00\u8a9e\u3067\u3042\u308b\u304c\u6545\u306b\u3001\u8a00\u8a9e\u4ed5\u69d8\u306e\u7b56\u5b9a\u304c\u5927\u5909\uff08\u8abf\u6574\u304c\u5927\u5909\uff09\u3060\u3063\u305f\u308a\u3057\u3066\u3001\u9032\u5316\u304c\u65e9\u3044\u304b\u3068\u8a00\u308f\u308c\u308b\u3068\u6c7a\u3057\u3066\u305d\u3046\u3067\u306f\u306a\u3044\u308f\u3051\u3067\u3059\u3002\nPromise\u3084yield\u306a\u3069\u3059\u3050\u306b\u3067\u3082\u4f7f\u3044\u305f\u3044\u306a\u3041\u3068\u601d\u3046\u6a5f\u80fd\u3082\u3001\u5b9f\u969b\u306b\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308b\u307e\u3067\u306f\u7d50\u69cb\u6642\u9593\u304c\u304b\u304b\u308b\u308f\u3051\u3067\u3059\u3002\n\u305d\u306e\u70b9Dart\u306f\u3001Google\u3055\u3093\u304c\u597d\u304d\u306b\u4f5c\u3063\u3066\u308b\uff08ECMA\u6a19\u6e96\u306b\u3082\u767b\u9332\u3055\u308c\u3066\u307e\u3059\u304c\uff09\u306e\u3067\u3001\u4ed5\u69d8\u6c7a\u3081\u3066\u3001\u5b9f\u88c5\u3057\u3066\u3001\u3059\u3050\u306b\u958b\u767a\u8005\u304c\u65b0\u3057\u3044\u6a5f\u80fd\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\nNodeJS\u3068\u540c\u3058\u30b7\u30f3\u30b0\u30eb\u30b9\u30ec\u30c3\u30c9\u3092\u30d9\u30fc\u30b9\u306b\u3057\u305f\u30a4\u30d9\u30f3\u30c8\u30eb\u30fc\u30d7\u30e2\u30c7\u30eb\u3067\u3042\u308a\u3001Node\u3067\u51fa\u6765\u308b\u4e8b\u306f\u65e2\u306b\u5927\u4f53\u3067\u304d\u308b\uff08\u306f\u305a\uff09\u306e\u3067\u3001pub\u304cnpm\u3070\u308a\u306e\u30a8\u30b3\u30b7\u30b9\u30c6\u30e0\u3068\u3057\u3066\u6210\u9577\u3057\u305f\u3089\u304b\u306a\u308a\u6765\u308b\u306a\u3041\u3068\u601d\u3063\u3066\u308b\u308f\u3051\u3067\u3059\u3002\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u306b\u3070\u304b\u308a\u6ce8\u76ee\u3055\u308c\u304c\u3061\u306aDart\u3055\u3093\u3067\u3059\u304c\u3001\u500b\u4eba\u7684\u306b\u306f\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u306b\u30d5\u30e5\u30fc\u30c1\u30e3\u30fc\u3057\u3066\u3044\u304d\u305f\u3044\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u3002\n\u3067\u3001\u4eca\u56de\u3001\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u4f7f\u308f\u305a\u306bDart\u306e\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u306eWeb\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\ndart-bbs-vanilla-study\nhttps://github.com/takyam-git/dart-bbs-vanilla-study\nDart\u306e\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u6709\u540d\u306a\u306e\u306fRedstone.dart\u3001start\u3001Rikulo Stream\u3001shelf \u3042\u305f\u308a\u3067\u3057\u3087\u3046\u304b\u3002\n\u3044\u305a\u308c\u3082\u8efd\u91cf\u306a\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\uff08shelf\u306b\u3044\u305f\u3063\u3066\u306fWeb Server Middleware for Dart\u3060\u3057\uff09\u306a\u306e\u3067\u3001\u5927\u3057\u305f\u6a5f\u80fd\u306f\u7121\u3044\u306e\u3067\u3059\u304c\u3001\u305d\u308c\u306b\u3057\u308d\u3042\u308b\u7a0b\u5ea6\u306e\u6709\u308a\u96e3\u307f\u3092\u611f\u3058\u308b\u305f\u3081\u306b\u3082\u3001\u5185\u90e8\u52d5\u4f5c\u3092\u63a8\u6e2c\u3059\u308b\u305f\u3081\u306b\u3082\u3001\u3068\u308a\u3042\u3048\u305a\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u4f7f\u308f\u305a\u306b\u81ea\u5206\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u66f8\u3044\u3066\u307f\u305f\u307b\u3046\u304c\u826f\u3044\u306a\u3068\u601d\u3044\u3001\u4eca\u56de\u306f\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u4f7f\u308f\u305a\u306b\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002\n\u51fa\u6765\u4e0a\u304c\u3063\u305f\u3082\u306e\u306f\u7d1b\u3046\u3053\u3068\u306a\u304d\u7cde\u3067\u3059\u304c\u3001\u3044\u304f\u3064\u304b\u77e5\u898b\u304c\u5f97\u3089\u308c\u305f\u306e\u3067\u5099\u5fd8\u9332\u304c\u3066\u3089\u30e1\u30e2\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u7279\u306b\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u306b\u304b\u304e\u3089\u305a\u3001\u304c\u3063\u3064\u308aDart\u66f8\u3044\u305f\u306e\u304c\u521d\u3081\u3066\u306a\u306e\u3067\u3001Dart\u306e\u57fa\u790e\u7684\u306a\u90e8\u5206\u306b\u3064\u3044\u3066\u3082\u66f8\u3044\u3066\u307e\u3059\u3002\n\u5148\u306b\u7d50\u8ad6\u3060\u3051\u66f8\u3044\u3066\u304a\u304f\u3068\u3001\u52c9\u5f37\u306b\u306f\u306a\u3063\u305f\u3051\u3069\u666e\u901a\u306b\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u4f7f\u3063\u305f\u307b\u3046\u304c\u3044\u3044\u3067\u3059\u306d\u3002\n\n\u304a\u3057\u306a\u304c\u304d\n\nroute\u30d1\u30c3\u30b1\u30fc\u30b8\u306eRouter\u306e\u4f7f\u3044\u65b9\n\n\n\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u3068\u305d\u3046\u3058\u3083\u306a\u3044\u3084\u3064\u306e\u51e6\u7406\u5206\u3051\u306e\u65b9\u6cd5\u3002\n\n\nhttp_server\u30d1\u30c3\u30b1\u30fc\u30b8\n\n\njailRoot\u306b\u3088\u3063\u3066root\u968e\u5c64\u3088\u308a\u4e0a\u306f\u53c2\u7167\u3067\u304d\u306a\u3044\u3001\u3068\u304b\u3002\n\n\nHttpResponse\u306eContentType\u306e\u8a2d\u5b9a\u65b9\u6cd5\n\n\n\nrequest.response.headers.add(\"Content-Type\", \"text/html\")\u306f\u9593\u9055\u3044\u3002\n\n\nCompleter\u8d85\u4fbf\u5229\n\n\n\nFuture.wait() \u3068\u5408\u308f\u305b\u3066\u3088\u304f\u4f7f\u3046\u3002\n\n\nMapMixin\u8d85\u4fbf\u5229\n\n\n\nJSON.encode() \u3068\u304b\u306b\u3082\u5bfe\u5fdc\u3067\u304d\u3061\u3083\u3046\u3002\u7d20\u6575\u3002\n\n\nStreamController\u8d85\u4fbf\u5229\n\n\n\u5916\u90e8\u306bStream\u3092\u516c\u958b\u3057\u305f\u3044\u6642\u306b\u8d85\u697d\u3061\u3093\u3002\n\n\nWebSocket\u306ebroadcast\u3092\u3059\u308b\u65b9\u6cd5\n\n\nWebSocket\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u306e\u7ba1\u7406\u3092\u5b9f\u88c5\u3059\u308b\u3002\n\n\nconst\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092static final\u5b9a\u6570\u3067\u6301\u3064\n\n\nContentType\u30af\u30e9\u30b9\u3068\u304b\u306f\u3053\u308c\u3084\u3063\u3066\u308b\u3002\n\n\n\n\nroute\u30d1\u30c3\u30b1\u30fc\u30b8\u306eRouter\u306e\u4f7f\u3044\u65b9\nHTTP\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u634c\u304f\u306e\u306b\u3001dart:io\u30d1\u30c3\u30b1\u30fc\u30b8\u306eHTTPServer\u30af\u30e9\u30b9\u3092\u4f7f\u3046\u308f\u3051\u3067\u3059\u304c\u3001\u305d\u306e\u307e\u307e\u3060\u3068\u539f\u59cb\u7684\u306a\u4e8b\u3057\u304b\u3067\u304d\u306a\u3044\u306e\u3067\u3001route\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f7f\u3063\u3066\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u884c\u3044\u307e\u3059\u3002\nRoute\u30af\u30e9\u30b9\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u30fb\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u306e\u3069\u3061\u3089\u3082\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\n\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u306e\u4f7f\u3044\u65b9\u306f\u975e\u5e38\u306b\u30b7\u30f3\u30d7\u30eb\u3067\u3001Route\u5358\u4f53\u3067\u4f55\u304b\u8907\u96d1\u306a\u4e8b\u304c\u3067\u304d\u308b\u8a33\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u6a5f\u80fd\u306f \u300c\u8a2d\u5b9a\u3057\u305fURL\u306e\u30d1\u30bf\u30fc\u30f3\u306b\u4e00\u81f4\u3059\u308b\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u5bfe\u5fdc\u3059\u308bStream\u3092\u751f\u6210\u3059\u308b\u300d \u3060\u3051\u3067\u3059\u3002\n\u767b\u5834\u3059\u308b\u30af\u30e9\u30b9\u3084\u95a2\u6570\u3082\u5c11\u306a\u304f\u3001\u4ee5\u4e0b\u3092\u6291\u3048\u3066\u304a\u3051\u3070\u307b\u307c\u554f\u984c\u306a\u304f\u5229\u7528\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\u3067\u3057\u3087\u3046\u3002\n\n\nRouter \u30af\u30e9\u30b9\n\nfilter \u30e1\u30bd\u30c3\u30c9\n\n\nvoid filter(Pattern url, Filter filter)\nFilter \u306f Future<bool> Filter(HttpRequest request)\n\n\n\nserve \u30e1\u30bd\u30c3\u30c9\n\n\nStream<HttpRequest> serve(Pattern url, {String method})\n\n\ndefaultStream \u30d7\u30ed\u30d1\u30c6\u30a3\n\n\nStream<HttpRequest> get defaultStream\n\n\n\n\nUrlPattern \u30af\u30e9\u30b9\nmatchAny\u95a2\u6570\n\n\nRouter \u306e\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9\nvar router = new Router(server); //server \u306f HttpServer \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\nrouter\n  ..filter(new UrlPattern(r\"/mypage\"), authFilter)\n  ..serve(new UrlPattern(r\"/\"), method: \"GET\").listen(topPageHandler)\n  ..serve(new UrlPattern(r\"/mypage\").listen(myPageHandler)\n  ..defaultStream.listen(notFoundHandler);\n  //topPageHandler/myPageHandler/notFoundHandler \u306f\u5225\u9014\u81ea\u5206\u3067\u5b9a\u7fa9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\n\n\nserve\u30e1\u30bd\u30c3\u30c9\u3068defaultStream\u30d7\u30ed\u30d1\u30c6\u30a3\n\u6700\u3082\u5927\u4e8b\u306a\u30e1\u30bd\u30c3\u30c9\u3067\u3042\u308bserve \u306f Stream<HttpRequest> \u3092\u8fd4\u3057\u307e\u3059\u306e\u3067\u3001\u305d\u308c\u3092 .listen() \u3059\u308b\u4e8b\u3067\u3001serve()\u306b\u4e00\u81f4\u3057\u305f\u30d1\u30bf\u30fc\u30f3\u306e\u51e6\u7406\u3092.listen()\u306b\u767b\u9332\u3057\u305f\u30cf\u30f3\u30c9\u30e9\u304c\u884c\u3046\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u4e0a\u8a18\u306e\u4f8b\u3067\u3044\u3048\u3070\u3001r\"/\"\uff08\u30c8\u30c3\u30d7\u30da\u30fc\u30b8\uff09\u306e\u51e6\u7406\u306ftopPageHandler\u304c\u884c\u3044\u3001r\"/mypage\"\uff08\u30de\u30a4\u30da\u30fc\u30b8\uff09\u306e\u51e6\u7406\u3092myPageHandler\u304c\u884c\u3046\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\nTips:\u3000Stream<HttpRequest> \u306e\u3001 <HttpRequest> \u306f\u3001\u305d\u306e\u30b9\u30c8\u30ea\u30fc\u30e0\u3092listen\u3057\u3066\u308b\u30cf\u30f3\u30c9\u30e9\u306b\u6e21\u3055\u308c\u308b\u5f15\u6570\u304c HttpRequest \u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u3042\u308b\u4e8b\u3092\u8868\u3057\u3066\u3044\u307e\u3059\u3002\u306a\u306e\u3067\u3001\u30cf\u30f3\u30c9\u30e9\u306f (HttpRequest request)=> do something... \u306e\u3088\u3046\u306a\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3092\u8a2d\u5b9a\u3059\u308b\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u3055\u3089\u306b\u3001\u3069\u306eUrlPattern\u306b\u3082\u30de\u30c3\u30c1\u3059\u308bserve\u304c\u7121\u304b\u3063\u305f\u5834\u5408\u306eStream<HttpRequest>\u3068\u3057\u3066defaultStream\u30d7\u30ed\u30d1\u30c6\u30a3\u304c\u5b9a\u7fa9\u3057\u3066\u3042\u308a\u3001\u4f8b\u3048\u3070\u4e0a\u8a18\u306e\u4f8b\u306e\u5834\u5408\u306f\u305d\u3053\u306b404 Not Found\u30da\u30fc\u30b8\u3092\u8868\u793a\u3059\u308b\u305f\u3081\u306enotFoundHandler\u3092\u5b9a\u7fa9\u3059\u308b\u3088\u3046\u306a\u4f7f\u3044\u65b9\u3092\u3057\u3066\u3044\u307e\u3059\u3002\n\nfilter\u30e1\u30bd\u30c3\u30c9\n\u4e0a\u8a18\u306e\u4f8b\u306e3\u884c\u76ee\u306b\u3042\u308bfilter()\u30e1\u30bd\u30c3\u30c9\u306f\u3001\u7b2c1\u5f15\u6570\u306bserve\u3068\u540c\u3058\u3088\u3046\u306bUrlPattern\u3092\u8a2d\u5b9a\u3057\u3001\u7b2c2\u5f15\u6570\u306b\u306fFuture<bool>\u3092\u8fd4\u3059\u30cf\u30f3\u30c9\u30e9\u8a2d\u5b9a\u3057\u307e\u3059\u3002Filter\u306e\u5b9f\u88c5\u4f8b\u3068\u3057\u3066\u30d1\u30c3\u30b1\u30fc\u30b8\u306eREADME\u306b\u66f8\u3044\u3066\u3042\u308b\u4f8b\u3092\u898b\u3066\u307f\u307e\u3059\u3002\nFuture<bool> authFilter(req) {\n  return getUser(getUserIdCookie(req)).then((user) {\n    if (user != null) return true;\n    redirectToLoginPage(req);\n    return false;\n  });\n}\n\n\u975e\u540c\u671f\u3067\u30e6\u30fc\u30b6\u30fc\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u78ba\u8a8d\u3057\u3066\u3001\u6709\u52b9\u306a\u30e6\u30fc\u30b6\u30fc\u3067\u3042\u308c\u3070true\u3092\u3001\u305d\u3046\u3067\u306a\u3051\u308c\u3070false\u3092\u8fd4\u3057\u3066\u3044\u307e\u3059\u3002\ntrue\u304c\u8fd4\u3063\u305f\u6642\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u51e6\u7406\u306b\u3064\u3044\u3066\u306f\u3001\u901a\u5e38\u3069\u304a\u308a\u3001\u4e00\u81f4\u3057\u305fserve\u306elisten\u306e\u30cf\u30f3\u30c9\u30e9\u304c\u5b9f\u884c\u3055\u308c\u308b\u306e\u3067\u3059\u304c\u3001\u3053\u3053\u3067false\u3092\u8fd4\u3057\u305f\u5834\u5408\u306f\u3001\u305f\u3068\u3048\u4e00\u81f4\u3057\u305fserve\u304c\u3042\u3063\u305f\u3068\u3057\u3066\u3082\u51e6\u7406\u3055\u308c\u307e\u305b\u3093\u3002\n\u3058\u3083\u3041false\u306e\u6642\u306fdefaultStream\u306b\u884c\u304f\u306e\u304b\u3068\u3044\u3046\u3068\u3001\u305d\u3046\u3067\u3082\u306a\u304f\u3066\u3001\u672c\u5f53\u306b\u4f55\u3082\u51e6\u7406\u3055\u308c\u306a\u304f\u306a\u308b\u306e\u3067\u3001\u4e0a\u8a18\u4f8b\u306e\u5834\u5408redirectToLoginPage(req)\u306e\u90e8\u5206\u3067\u6050\u3089\u304f\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u51e6\u7406\u3092\u3057\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u3053\u306e\u3088\u3046\u306b\u4f55\u304b\u3057\u3089request.response.close()\u3092\u884c\u3046\u3088\u3046\u306b\u3057\u306a\u3044\u3068\u3001 \u3044\u3064\u307e\u3067\u3060\u3063\u3066\u3082\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u8fd4\u308a\u307e\u305b\u3093 \u3002\n\nUrlPattern\u30af\u30e9\u30b9\u3068 matchAny \u95a2\u6570\n\u65e2\u306b\u4f55\u56de\u304b\u767b\u5834\u3057\u3066\u3044\u308bUrlPattern\u30af\u30e9\u30b9\u3067\u3059\u304c\u3001\u3053\u308c\u306fserve\u3084filter\u306e\u7b2c1\u5f15\u6570\u306b\u6e21\u3059Pattern\u306e\u5b9f\u88c5\u3067\u3059\u3002\u57fa\u672c\u7684\u306b\u306f\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u5f15\u6570\u306b\u6e21\u3055\u308c\u305f \u6b63\u898f\u8868\u73fe\u98a8 \u306eURL\u306b\u30de\u30c3\u30c1\u3059\u308b\u304b\u3069\u3046\u304b\u3001\u3092\u5224\u5b9a\u3059\u308b\u30af\u30e9\u30b9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u304c\u3001\u901a\u5e38\u306eRegExp\u3068\u306f\u9055\u3046\u70b9\u304c\u3044\u304f\u3064\u304b\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u4ee5\u4e0b\u3053\u3061\u3089\u304b\u3089\u306e\u5f15\u7528\u3067\u3059\u3002\n\n\n\u901a\u5e38\u306eRegExp\u3068\u306e\u9055\u3044\n\n\u5168\u3066\u306e\u6b63\u898f\u8868\u73fe\u306e\u7279\u6b8a\u6587\u5b57\u306f\u30b0\u30eb\u30fc\u30d4\u30f3\u30b0(\u8a33\u6ce8:\u6b63\u898f\u8868\u73fe\u306e()\u3067\u56f2\u3046\u30a2\u30ec)\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30b0\u30eb\u30fc\u30d4\u30f3\u30b0\u3055\u308c\u3066\u306a\u3044\u3082\u306e\u306b\u3064\u3044\u3066\u306f\u3001\u30a8\u30b9\u30b1\u30fc\u30d7\u6e08\u307f\u306e\u6b63\u898f\u8868\u73fe\u7279\u6b8a\u6587\u5b57\u304b\u901a\u5e38\u306e\u6587\u5b57\u5217\u3068\u3057\u3066\u51e6\u7406\u3055\u308c\u307e\u3059\u3002\n\u6587\u5b57\u5217\u5168\u4f53\u3068\u306e\u4e00\u81f4\u3055\u305b\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30d1\u30bf\u30fc\u30f3\u306e\u5148\u982d\u3068\u672b\u5c3e\u306b\u305d\u308c\u305e\u308c^\u3068$\u304c\u81ea\u52d5\u3067\u4ed8\u4e0e\u3055\u308c\u307e\u3059\u3002\n\u30d1\u30bf\u30fc\u30f3\u306f\u66d6\u6627\u3067\u306f\u3044\u3051\u305a\u3001\u305f\u3068\u3048\u3070\u3001(.*)(.*)\u306f\u30c8\u30c3\u30d7\u30ec\u30d9\u30eb\u3067\u306f\u8a31\u53ef\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n\u30cf\u30c3\u30b7\u30e5\u6587\u5b57\u5217\u3067\u3042\u308b#\u306f'#'\u3068'/'\u306e\u4e21\u65b9\u306b\u30de\u30c3\u30c1\u3057\u3001\u3072\u3068\u3064\u306e\u30d1\u30bf\u30fc\u30f3\u3067\u4e00\u5ea6\u3057\u304b\u4f7f\u3046\u4e8b\u306f\u3067\u304d\u307e\u305b\u3093\u3002\u307e\u305f\u3001\u30cf\u30c3\u30b7\u30e5\u306f\u30b0\u30eb\u30fc\u30d4\u30f3\u30b0\u3059\u308b\u4e8b\u3092\u8a31\u53ef\u3057\u3066\u3044\u307e\u305b\u3093\u3002\n\n\n\u7279\u306b\u3001r\"/path/to/hoge/.*\" \u306f\u6050\u3089\u304f\u671f\u5f85\u901a\u308a\u306b\u52d5\u4f5c\u305b\u305a r\"/path/to/hoge/(.*)\" \u3068\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u70b9\u306f\u3001\u6700\u521d\u306b\u8ab0\u3082\u304c\u30cf\u30de\u308b\u30dd\u30a4\u30f3\u30c8\u304b\u306a\u3068\u601d\u3044\u307e\u3059\u3002\n\u3067\u3001\u57fa\u672c\u7684\u306bUrlPattern\u30af\u30e9\u30b9\u306f\u3072\u3068\u3064\u306e\u30d1\u30bf\u30fc\u30f3\u3057\u304b\u5b9a\u7fa9\u3067\u304d\u306a\u3044\u308f\u3051\u3067\u3059\u304c\u3001\u8907\u6570\u306e\u30d1\u30bf\u30fc\u30f3\u306b\u304a\u3044\u3066\u4e00\u3064\u306e\u30cf\u30f3\u30c9\u30e9\u3092\u767b\u9332\u3057\u305f\u3044\u5834\u5408\u304c\u3042\u308a\u3001\u305d\u3046\u3044\u3063\u305f\u5834\u5408\u306b\u306fmatchAny()\u95a2\u6570\u3092\u4f7f\u3046\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002\nmatchAny\u95a2\u6570\nPattern matchAny(Iterable<Pattern> include, {Iterable<Pattern> exclude})\n\u5927\u3057\u305f\u8a71\u3058\u3083\u306a\u304f\u3066\u3001serve(matchAny([pattern1, pattern2]))\u306e\u3088\u3046\u306b\u3001\u8907\u6570\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u5408\u308f\u305b\u3066\u4e00\u3064\u306ePattern\u306b\u3057\u3066\u304f\u308c\u308b\u611f\u3058\u3067\u3001\u7b2c1\u5f15\u6570\u306eList\u5185\u306eUrlPattern\u306e\u3044\u305a\u308c\u304b\u306b\u4e00\u81f4\u3059\u308b\u304b\u3069\u3046\u304b\u3001\u3068\u3044\u3063\u305f\u5224\u5b9a\u306b\u5909\u308f\u308a\u307e\u3059\u3002\n\nroutes\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u307e\u3068\u3081\nRouter\u30af\u30e9\u30b9\u304c\u3067\u304d\u308b\u4e8b\u306f\u57fa\u672c\u7684\u306b\u30b3\u30ec\u3060\u3051\u3067\u3001\u4f8b\u3048\u3070\u300c\u25ef\u25ef\u30da\u30fc\u30b8\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306f\u25ef\u25efController\u306e\u25ef\u25ef\u30e1\u30bd\u30c3\u30c9\u3067\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3059\u308b\u300d\u3068\u3044\u3063\u305f\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u30e9\u30a4\u30af\u306a\u51e6\u7406\u3092\u30d5\u30e9\u30f3\u30af\u306b\u66f8\u304f\u4e8b\u306f\u3067\u304d\u307e\u305b\u3093\u3002\u3044\u308f\u3086\u308broutes\u306e\u5b9a\u7fa9\u3092\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u30d9\u30fc\u30b9\u3067\u884c\u3046\u3068\u3044\u3063\u305f\u4e8b\u306f\u3001\u3053\u308c\u3060\u3051\u3060\u3068\u3067\u304d\u306a\u3044\u308f\u3051\u3067\u3059\u3002\n\u3057\u304b\u3057\u306a\u304c\u3089\u3001\u5fc5\u8981\u6700\u4f4e\u9650\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u51e6\u7406\u306f\u63d0\u4f9b\u3055\u308c\u307e\u3059\u3057\u3001\u3053\u308c\u3092\u30d9\u30fc\u30b9\u306b\u3001\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u30e9\u30a4\u30af\u306a\u51e6\u7406\u3092\u66f8\u304f\u4e8b\u3082\u96e3\u3057\u304f\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u975e\u5e38\u306b\u30b7\u30f3\u30d7\u30eb\u3067\u5f37\u529b\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3068\u3044\u3048\u308b\u3067\u3057\u3087\u3046\u3002\n\u306a\u304a\u3001\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u51e6\u7406\u306e\u8a73\u7d30\u306f\u3053\u3061\u3089\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u898b\u308b\u3068\u308f\u304b\u308a\u307e\u3059\u3002Router\u30af\u30e9\u30b9\u81ea\u4f53\u975e\u5e38\u306b\u30b7\u30f3\u30d7\u30eb\u3067\u3001\u30b3\u30fc\u30c9\u91cf\u3082\u5c11\u306a\u3044\u306e\u3067\u3001\u5168\u90e8\u3092\u8aad\u3080\u306e\u3082\u7279\u306b\u82e6\u306b\u306f\u306a\u3089\u306a\u3044\u3067\u3057\u3087\u3046\u3002\n\nhttp_server\u30d1\u30c3\u30b1\u30fc\u30b8\nhttp_server\u30d1\u30c3\u30b1\u30fc\u30b8\u3082\u3001\u5148\u306eroutes\u30d1\u30c3\u30b1\u30fc\u30b8\u3068\u4f75\u305b\u3066HTTP\u30b5\u30fc\u30d0\u30fc\u3092\u4f5c\u6210\u3059\u308b\u969b\u306b\u3088\u304f\u5229\u7528\u3055\u308c\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u3072\u3068\u3064\u3060\u3068\u601d\u3044\u307e\u3059\u3002\u3053\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u4e3b\u306b\u4ee5\u4e0b\u306e\u6a5f\u80fd\u3092\u5099\u3048\u3066\u3044\u307e\u3059\u3002\n\nPOST\u30ea\u30af\u30a8\u30b9\u30c8\u7b49\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u30dc\u30c7\u30a3\u306e\u53d6\u5f97\nVirtualDirectory\u30af\u30e9\u30b9\u306b\u3088\u308b\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u306e\u914d\u4fe1\nVirtualHost\u30af\u30e9\u30b9\u306b\u3088\u308b\u30ea\u30af\u30a8\u30b9\u30c8\u30c9\u30e1\u30a4\u30f3\u6bce\u306e\u51e6\u7406\u308f\u3051\n\nVirtualHost\u306f\u4f7f\u3063\u305f\u4e8b\u304c\u306a\u3044\u306e\u3067\u3001\u4eca\u56de\u306f\u4e0a\u306e2\u3064\u306b\u3064\u3044\u3066\u8a18\u8f09\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001http_server\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30bd\u30fc\u30b9\u306f\u4ee5\u4e0b\u306b\u3042\u308a\u307e\u3059\u3002\nhttps://code.google.com/p/dart/source/browse/branches/bleeding_edge/dart/pkg/http_server/lib/http_server.dart\n\u73fe\u5728DartTeam\u88fd\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u5f90\u3005\u306bGitHub\u306b\u79fb\u52d5\u3057\u3066\u3044\u3063\u3066\u307e\u3059\u306e\u3067\u3001\u3053\u308c\u3082\u8fd1\u3044\u3046\u3061\u306bGitHub\u306b\u79fb\u52d5\u3059\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\u30ea\u30af\u30a8\u30b9\u30c8\u30dc\u30c7\u30a3\u306e\u53d6\u5f97\nPOST\u3055\u308c\u305f\u5024\u3092\u53d6\u308b\u306b\u3042\u305f\u308a\u3001PHP\u3060\u3068$_POST\u3067\u7c21\u5358\u306b\u53d6\u5f97\u3067\u304d\u305f\u308a\u3057\u307e\u3059\u304c\u3001Dart\u306e\u5834\u5408\u306f\u81ea\u5206\u3067\u3044\u308d\u3044\u308d\u51e6\u7406\u3057\u306a\u3051\u308c\u3070\u53d6\u5f97\u3059\u308b\u4e8b\u306f\u3067\u304d\u307e\u305b\u3093\u3002\u304c\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u30dc\u30c7\u30a3\u306e\u30d1\u30fc\u30b9\u51e6\u7406\u306f\u610f\u5916\u3068\u9762\u5012\u306a\u306e\u3067\u3001\u3053\u3053\u306fHttpBodyHandler\u30af\u30e9\u30b9\u3092\u5229\u7528\u3057\u3066\u3001\u7c21\u5358\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u30dc\u30c7\u30a3\u3092\u53d6\u5f97\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\u5148\u307b\u3069\u306eRouter\u30af\u30e9\u30b9\u306e\u5229\u7528\u4f8b\u3092\u5c11\u3057\u6539\u4fee\u3057\u3066\u307f\u307e\u3059\u3002\nvar router = new Router(server); //server \u306f HttpServer \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\nrouter\n  ..serve(new UrlPattern(r\"/\"), method: \"GET\").listen(topPageHandler)\n  ..serve(new UrlPattern(r\"/\"), method: \"POST\").transform(new HttpBodyHandler()).listen(topPagePostHandler)\n  ..defaultStream.listen(notFoundHandler);\n\n.transform(new HttpBodyHandler())\u304c\u5897\u3048\u3066\u3044\u307e\u3059\u3002\n.transform()\u306fStream\u306e\u6a19\u6e96\u30e1\u30bd\u30c3\u30c9\u3067\u3001\u8a73\u7d30\u306f\u3053\u3061\u3089\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u3002\u7c21\u5358\u306b\u3044\u3046\u3068\u3001Stream\u306e\u5024\u3092\u5909\u63db\u3059\u308b\u3084\u3064\u3067\u3059\u3002\n\u4eca\u56de\u306e\u4f8b\u3067\u3044\u3046\u3068\u3001\u5143\u3005\u306fStream<HttpRequest>\u3060\u3063\u305f\u308f\u3051\u3067\u3059\u304c\u3001\u3053\u306eHttpBodyHandler(StreamTransformer\u306e\u5b9f\u88c5)\u3092\u9593\u306b\u631f\u3080\u4e8b\u3067\u3001Stream<HttpRequestBody>\u3068\u3057\u3066\u6271\u3048\u308b\u3088\u3046\u306b\u306a\u308b\u308f\u3051\u3067\u3059\u3002\n\u3064\u307e\u308a\u3001GET\u30ea\u30af\u30a8\u30b9\u30c8\u306etopPageHandler\u306f(HttpRequest request) => do something...\u3067\u3001\nPOST\u30ea\u30af\u30a8\u30b9\u30c8\u306etopPagePostHandler\u306f(HttpRequestBody request) => do something...\u306b\u306a\u308b\u308f\u3051\u3067\u3059\u3002\nHttpRequestBody\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f.body\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u6301\u3063\u3066\u3044\u3066\u3001\u3053\u306e\u4e2d\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u30dc\u30c7\u30a3\u304c\u542b\u307e\u308c\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5f62\u5f0f\u306f3\u7a2e\u985e\u3067Map\u304bBytes\u304bString\u3067\u3059\u3002\u3053\u308c\u306f\u30ea\u30af\u30a8\u30b9\u30c8\u5f62\u5f0f\u306b\u3088\u3063\u3066\u7570\u306a\u308b\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u8a73\u3057\u304f\u306f\u3053\u306e\u3078\u3093\u306e\u5b9f\u88c5\u3092\u898b\u3066\u304f\u3060\u3055\u3044\u3002\n\u3061\u306a\u307f\u306b\u3069\u3046\u3057\u3066\u3082\u30e9\u30a4\u30d6\u30e9\u30ea\u4f7f\u3044\u305f\u304f\u306a\u3044\u3093\u3060\u3088\u3063\u3066\u3044\u3046\u4eba\u306f\u3001\u3053\u3061\u3089\u306eStackOverflow\u306e\u8cea\u554f\u3092\u53c2\u8003\u306b\u3001UTF8.decodeStream()\u3092\u4f7f\u3046\u4e8b\u3067\u9811\u5f35\u308c\u306a\u304f\u3082\u306a\u3044\u3067\u3059\u304c\u3001Form\u306e\u30d1\u30fc\u30b9\u3068\u304b\u8f9b\u3044\u306e\u3067\u4f7f\u3048\u308b\u3082\u306e\u306f\u4f7f\u3063\u305f\u307b\u3046\u304c\u3044\u3044\u3068\u601d\u3046\u306e\u3067\u3059\u3002\n\nVirtualDirectory\u30af\u30e9\u30b9\u306b\u3088\u308b\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u306e\u914d\u4fe1\n\u9759\u7684\u30d5\u30a1\u30a4\u30eb(JS/CSS/IMG)\u306e\u914d\u5e03\u306fNginx\u7b49\u306eWEB\u30b5\u30fc\u30d0\u30fc\u30ec\u30a4\u30e4\u3067\u884c\u3046\u5834\u5408\u306f\u5fc5\u8981\u306a\u3044\u306e\u3067\u3059\u304c\u3001\u3044\u3061\u3044\u3061\u305d\u3093\u306a\u306e\u8a2d\u5b9a\u3059\u3093\u306e\u9762\u5012\u304f\u3055\u304f\u3066\u3001Dart\u5074\u3067\u914d\u4fe1\u3059\u308b\u5834\u5408\u306b\u306fVirtualDirectory\u30af\u30e9\u30b9\u3092\u4f7f\u3046\u3068\u7c21\u5358\u306b\u914d\u4fe1\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\nvar staticFiles = new VirtualDirectory(r\"web/assets\", pathPrefix: r\"/assets\")\n  ..followLinks = true\n  ..allowDirectoryListing = false\n  ..jailRoot = true;\nHttpServer.bind('0.0.0.0', 3000).then((HttpServer server) {\n  var router = new Router(server)\n    ..serve(new UrlPattern(r\"/assets/(.*)\"), method: \"GET\").listen(staticFiles.serveRequest)\n    ..serve(new UrlPattern(r\"/\"), method: \"GET\").listen(topPageHandler)\n    ..defaultStream.listen(notFoundHandler);\n});\n\n\u3053\u306e\u4f8b\u3067\u306f\u3001web/assets \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4ee5\u4e0b\u306b\u5bfe\u3057\u3066 /assets \u304b\u3089\u59cb\u307e\u308bURL\u3067\u30a2\u30af\u30bb\u30b9\u304c\u3042\u3063\u305f\u5834\u5408\u306b\u3001web/assets\u4ee5\u4e0b\u306b\u304a\u3044\u3066\u3042\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u5e03\u3057\u307e\u3059\u3088\u3001\u3068\u3044\u3063\u305f\u8a2d\u5b9a\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u4f8b\u3048\u3070web/assets/css/hoge.css\u304c\u3042\u308b\u306e\u3067\u3042\u308c\u3070\u3001/assets/css/hoge.css\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001\u305d\u306eCSS\u30d5\u30a1\u30a4\u30eb\u304c\u30ec\u30b9\u30dd\u30f3\u30b9\u3055\u308c\u308b\u308f\u3051\u3067\u3059\u3002\n\u3053\u306eVirtualDirectory\u306b\u8a2d\u5b9a\u3059\u3079\u304d\u30d7\u30ed\u30d1\u30c6\u30a3\u304c3\u3064\u3042\u308a\u307e\u3059\u3002\n\nfollowLinks (\u30c7\u30d5\u30a9\u30eb\u30c8:true)\n\n\nsymlink\u306b\u5bfe\u5fdc\u3059\u308b\u304b\u3069\u3046\u304b\n\n\nallowDirectoryListing (\u30c7\u30d5\u30a9\u30eb\u30c8:false)\n\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306eURL\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u5834\u5408\u306b\u306e\u4e2d\u8eab\u3092\u516c\u958b\u3059\u308b\u304b\u3069\u3046\u304b\n\n\njailRoot (\u30c7\u30d5\u30a9\u30eb\u30c8:true)\n\n\nroot\uff08\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u7b2c1\u5f15\u6570\u3067\u6307\u5b9a\u3057\u305f\u30d1\u30b9\uff09\u4ee5\u4e0b\u3067\u306f\u306a\u3044\u968e\u5c64\u306b\u3064\u3044\u3066\u306e\u30a2\u30af\u30bb\u30b9\u3092\u7981\u6b62\u3059\u308b\u304b\u3069\u3046\u304b\u3002true\u306e\u5834\u5408\u306f\u7981\u6b62\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u4f8b\u3048\u3070web/assets/packages\u304cweb\u3068\u540c\u968e\u5c64\u306epackages\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u306e\u30ea\u30f3\u30af\u306b\u306a\u3063\u3066\u3044\u308b\u5834\u5408\u3001\u5b9f\u4f53\u304croot\u4ee5\u4e0b\u3067\u306f\u306a\u3044\u306e\u3067\u3001/assets/packages/*\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3082Not Found\u3092\u8fd4\u3059\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u57fa\u672c\u7684\u306b\u306froot\u3088\u308a\u4e0a\u306e\u968e\u5c64\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3068\u3044\u3046\u306e\u306f\u5f80\u3005\u306b\u3057\u3066\u8106\u5f31\u6027\u3092\u751f\u307f\u3084\u3059\u3044\u306e\u3067\u3001\u57fa\u672c\u7684\u306b\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306etrue\u306e\u307e\u307e\u306b\u3057\u3001root\u4ee5\u4e0b\u306b\u914d\u4fe1\u5bfe\u8c61\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8a2d\u7f6e\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002\u306a\u304a\u3001followLinks\u304cfalse\u306e\u5834\u5408\u3060\u3068\u3001\u305d\u3082\u305d\u3082\u4e0a\u306e\u968e\u5c64\u306b\u5bfe\u3059\u308b\u30ea\u30f3\u30af\u304c\u4f7f\u3048\u306a\u3044\u306e\u3067\u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306f\u610f\u5473\u306a\u3044\u3067\u3059\u3002\n\n\n\n\u3053\u308c\u30893\u3064\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u7528\u9014\u306b\u5408\u308f\u305b\u3066\u6b63\u3057\u304f\u8a2d\u5b9a\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\nhttp_server\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u307e\u3068\u3081\n\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u4f7f\u308f\u306a\u3044\u5834\u5408\u306f\u3001http_server\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u7121\u3044\u3068\u3044\u308d\u3044\u308d\u3064\u3089\u3044\u3068\u601d\u3046\u306e\u3067\u3001\u3053\u3053\u306b\u66f8\u3044\u305f2\u3064\u304f\u3089\u3044\u306f\u4f7f\u3044\u65b9\u3092\u899a\u3048\u3066\u304a\u304f\u3068\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nHttpResponse\u306eContentType\u306e\u8a2d\u5b9a\u65b9\u6cd5\n\u30ec\u30b9\u30dd\u30f3\u30b9\u306eContentType\u306e\u8a2d\u5b9a\u306b\u306f\u4ee5\u4e0b\u306e2\u3064\u306e\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u3002\n\nresponse.headers.contentType = ContentType.HTML\nresponse.headers.add(HttpHeaders.CONTENT_TYPE, \"text/html\")\n\n\u3069\u3061\u3089\u3082ContentType\u306btext/html\u3092\u8a2d\u5b9a\u3067\u304d\u308b\u306e\u3067\u3059\u304c\u3001\u57fa\u672c\u7684\u306b\u306f\u524d\u8005\u306e\u65b9\u6cd5\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u306a\u305c\u306a\u3089\u3001\u5f8c\u8005\u306e\u65b9\u6cd5\u306e\u5834\u5408\u6587\u5b57\u30b3\u30fc\u30c9\u304cLatin 1\u306b\u56fa\u5b9a\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\nContentType\u30af\u30e9\u30b9\u3092\u4f7f\u3046\u4e8b\u3067\u6587\u5b57\u30b3\u30fc\u30c9\u3092\u6307\u5b9a\u3059\u308b\u4e8b\u304c\u3067\u304d\u3001ContentType.HTML\u306a\u3069\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u5b9a\u6570\u3092\u5229\u7528\u3059\u308b\u4e8b\u3067UTF-8\u3092\u6307\u5b9a\u3067\u304d\u307e\u3059\u3002\n\u534a\u89d2\u82f1\u6570\u3057\u304b\u6271\u308f\u306a\u3044\u306e\u3067\u3042\u308c\u3070\u5f8c\u8005\u306e\u65b9\u6cd5\u3067\u3082\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u305d\u3093\u306a\u4e8b\u306f\u7121\u3044\u3068\u601d\u3046\u306e\u3067\u3001ContentType\u3092\u5229\u7528\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nCompleter\u8d85\u4fbf\u5229\n\u975e\u540c\u671f\u306e\u51e6\u7406\u3092\u6271\u3046\u306b\u3042\u305f\u308a\u3001Completer\u3092\u826f\u304f\u4f7f\u3044\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u3042\u308b\u30e1\u30bd\u30c3\u30c9\u304c\u8907\u6570\u306e\u975e\u540c\u671f\u51e6\u7406\u3092\u542b\u307f\u3001\u305d\u308c\u3089\u5168\u3066\u304c\u5b8c\u4e86\u3057\u305f\u5834\u5408\u306b\u7d50\u679c\u3092\u8fd4\u3059\u3088\u3046\u306a\u4e8b\u3092\u884c\u3044\u305f\u3044\u6642\u306b\u4fbf\u5229\u3067\u3059\u3002\nimport \"dart:async\";\nimport \"dart:io\";\n\nclass FileReader {\n  static Future<String> read(String filePath) {\n    //\u51e6\u7406\u5b8c\u4e86\u3092\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3059\u308bCompleter\n    var completer = new Completer();\n\n    var file = new File(filePath);\n    file\n      //\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3059\u308b\u304b\u3069\u3046\u304b\u306e\u78ba\u8a8d\u3092\u958b\u59cb\n      .exists()\n      //\u30d5\u30a1\u30a4\u30eb\u306e\u5b58\u5728\u78ba\u8a8d\u306e\u7d50\u679c\u3092\u53d7\u3051\u53d6\u308a\u3001\u5b58\u5728\u3059\u308b\u306a\u3089\u30b9\u30c6\u30fc\u30bf\u30b9\u53d6\u5f97\u3092\u958b\u59cb\n      .then((bool exists) => exists ? file.stat() : new Future.error(\"File not exists\"))\n      //\u30d5\u30a1\u30a4\u30eb\u304c\u30d5\u30a1\u30a4\u30eb\u306a\u306e\u304b\u3069\u3046\u304b\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\n      .then((FileStat stat) => stat.type == FileSystemEntityType.FILE ? file : new Future.error(\"File is not file\"))\n      //\u30d5\u30a1\u30a4\u30eb\u304c\u30d5\u30a1\u30a4\u30eb\u3060\u3063\u305f\u306a\u3089\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\u3092\u958b\u59cb\n      .then((File file) => file.readAsString())\n      //\u3053\u3053\u307e\u3067\u304d\u305f\u3063\u3066\u4e8b\u306f\u30d5\u30a1\u30a4\u30eb\u304c\u8aad\u307f\u8fbc\u3081\u305f\u306e\u3067complete\u3059\u308b\n      .then((String text) => completer.complete(text))\n      //\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u306fcompleteError\u3067\u30a8\u30e9\u30fc\u3092\u8fd4\u3059\n      .catchError((e) => completer.completeError(\"ReadFailed: ${e}\"));\n\n    //\u8aad\u307f\u8fbc\u307f\u304c\u7d42\u308f\u308b\u304b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\u307e\u3067\u5f85\u3064future\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u8fd4\u3059\n    return completer.future;\n  }\n}\n\nvoid main() {\n  FileReader.read(\"/path/to/target.txt\").then((String text) => print(text));\n  //\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308c\u3070\u305d\u306e\u4e2d\u8eab\u306e\u6587\u5b57\u5217\u304c\u8868\u793a\u3055\u308c\u308b\n}\n\n\u3053\u308c\u306f\u8d85\u9069\u5f53\u5b9f\u88c5\u306a\u30d5\u30a1\u30a4\u30eb\u30ea\u30fc\u30c0\u30fc\u306e\u5b9f\u88c5\u4f8b\u3067\u3059\u3002\nread()\u30e1\u30bd\u30c3\u30c9\u306b\u6e21\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u307f\u3001\u305d\u308c\u3092\u8868\u793a\u3057\u3066\u3044\u307e\u3059\u3002read()\u30e1\u30bd\u30c3\u30c9\u306f\u8fd4\u308a\u5024\u3068\u3057\u3066Future<String>\u3001\u3064\u307e\u308a\u975e\u540c\u671f\u306b\u6587\u5b57\u5217\u3092\u8fd4\u3059Future\u3092\u8fd4\u3057\u3066\u304a\u308a\u3001 \u305d\u306e\u5b9f\u88c5\u306fcompleter.future\u306b\u306a\u3063\u3066\u3044\u307e\u3059 \u3002\n\u3053\u306eread()\u3067\u306f\u3001\u300c\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3059\u308b\u304b\u3069\u3046\u304b\u300d\u300c\u30d5\u30a1\u30a4\u30eb\u304c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3068\u304b\u3058\u3083\u306a\u304f\u3066\u30d5\u30a1\u30a4\u30eb\u304b\u3069\u3046\u304b\u300d\u300c\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\u300d\u3068\u3044\u30463\u3064\u306e\u975e\u540c\u671f\u51e6\u7406\u304c\u884c\u308f\u308c\u3066\u3044\u3066\u3001\u305d\u308c\u3089\u304c\u5b8c\u4e86\u3057\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u3088\u3046\u3084\u304f\u7d50\u679c\u306e\u5024\u3092\u8fd4\u305b\u308b\u72b6\u614b\u306b\u306a\u308a\u307e\u3059\u3002\n\u3053\u306e\u3088\u3046\u306b\u3001\u8907\u6570\u306e\u975e\u540c\u671f\u51e6\u7406\u306e\u7d50\u679c\u3068\u3057\u3066\u3001\u975e\u540c\u671f\u51e6\u7406\u3092\u8fd4\u3057\u305f\u3044\u5834\u5408\u306bCompleter\u304c\u975e\u5e38\u306b\u6709\u7528\u3067\u3059\u3002\nCompleter\u3067\u4f7f\u3046\u6a5f\u80fd\u306f\n\nfuture \u30d7\u30ed\u30d1\u30c6\u30a3\ncomplete() \u30e1\u30bd\u30c3\u30c9\ncompleteError() meso\u571f\n\n\u3053\u306e3\u3064\u3060\u3051\u3067\u3059\u3002\u5168\u7136\u96e3\u3057\u304f\u306a\u3044\u3002\nfuture\u30d7\u30ed\u30d1\u30c6\u30a3\u306f\u3001\u4eca\u56de\u306e\u4f8b\u306e\u3088\u3046\u306b\u30e1\u30bd\u30c3\u30c9\u3084\u95a2\u6570\u306e\u8fd4\u308a\u5024\u3068\u3057\u3066\u8fd4\u3057\u3066\u3042\u3052\u308b\u3088\u3046\u306a\u4f7f\u3044\u9053\u304c\u591a\u3044\u3067\u3059\u3002\u30e1\u30bd\u30c3\u30c9\u3084\u95a2\u6570\u3092\u5229\u7528\u3059\u308b\u5074\u304b\u3089\u3059\u308b\u3068\u5358\u306bFuture\u304c\u8fd4\u3063\u3066\u304f\u308b\u308f\u3051\u306a\u306e\u3067\u3001.then()\u3057\u3066\u3042\u3052\u308c\u3070\u3044\u3044\u308f\u3051\u3067\u3059\u3002\nCompleter\u3092\u4f7f\u3063\u305f\u95a2\u6570/\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u88c5\u3059\u308b\u5074\u306f\u3001\u3044\u304f\u3064\u304b\u306e\u975e\u540c\u671f\u51e6\u7406\u304c\u7d42\u308f\u3063\u3066\u3001\u7d50\u679c\u3092\u8fd4\u305b\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u6bb5\u968e\u3067complete()\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3076\u304b\u3001\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u306fcompleteError()\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3079\u3070\u3088\u304f\u3001\u7d50\u679c\u306e\u5024\u306fcomplete()\u306e\u7b2c1\u5f15\u6570\u306b\u6e21\u3057\u3066\u3042\u3052\u308c\u3070\u3001\u3061\u3083\u3093\u3068\u5229\u7528\u8005\u5074\u306e.then()\u306b\u305d\u306e\u7d50\u679c\u306e\u5024\u304c\u6e21\u308a\u307e\u3059\u3002\n\n\u4f75\u305b\u3066\u4f7f\u3044\u305f\u3044Future.wait\nclass FileReader {\n  static Future<String> read(String filePath) {\n    //\u3055\u3063\u304d\u3068\u4e00\u7dd2\u306a\u306e\u3067\u7701\u7565\n  }\n  static Future<String> readFiles(List<String> filePaths){\n    //completer\u3092\u7528\u610f\n    var completer = new Completer();\n\n    //\u8907\u6570\u306eFuture\u3092\u683c\u7d0d\u3059\u308b\u305f\u3081\u306eList\u3092\u7528\u610f\n    List<Future<String>> waitList = [];\n\n    //List\u306bFileReader.read\u306e\u8fd4\u308a\u5024\u306eFuture\u3092\u7a81\u3063\u8fbc\u3093\u3067\u304f\n    filePaths.forEach((String filePath){\n      waitList.add(FileReader.read(filePath));\n    });\n\n    //Future.wait\u3067\u5168\u90e8\u8aad\u307f\u8fbc\u307f\u7d42\u308f\u308b\u307e\u3067\u5f85\u3063\u3066\u3001\u7d50\u679c\u304cList<String>\u3067\u6e21\u3063\u3066\u304f\u308b\u306e\u3067\u3001\n    //\u6e21\u3063\u3066\u304d\u305fList<String>\u3092\u7d50\u5408\u3057\u3066completer\u3067\u5b8c\u4e86\u3055\u305b\u308b\n    Future.wait(waitList).then((List<String> texts) => completer.complete(texts.join(\"\\n\")));\n\n    //completer.future\u3092\u8fd4\u3057\u3066\u304a\u304f\n    return completer.future;\n  }\n}\n\nvoid main() {\n  //file1.txt\u3068file2.txt\u306e\u4e2d\u8eab\u304c\u7d50\u5408\u3055\u308c\u305f\u6587\u5b57\u5217\u304c\u8fd4\u3063\u3066\u304f\u308b\u306e\u3067print\u3059\u308b\n  FileReader.readFiles([\"/path/to/file1.txt\", \"/path/to/file2.txt\"]).then((String text) => print(text));\n}\n\n\u3053\u306e\u3088\u3046\u306b\u3001\u8907\u6570\u306eFuture\u3092List\u306b\u7a81\u3063\u8fbc\u3093\u3067\u3001Future.wait()\u306b\u6e21\u3059\u4e8b\u3067\u3001List\u5185\u306e\u5168\u3066\u306eFuture\u304c\u5b8c\u4e86\u3057\u305f\u5834\u5408\u306b\u3001Future.wait()\u306e.then()\u304c\u5b9f\u884c\u3055\u308c\u308b\u3053\u308c\u307e\u305f\u4fbf\u5229\u306astatic\u30e1\u30bd\u30c3\u30c9\u3002\u3055\u3089\u306b\u3001\u7d50\u679c\u306e\u5024\u306f\u81ea\u52d5\u7684\u306bList\u306b\u683c\u7d0d(\u5909\u63db)\u3055\u308c\u3066\u6e21\u3063\u3066\u304f\u308b\u306e\u3067\u3001\u4e00\u6642\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u7a81\u3063\u8fbc\u3080\u51e6\u7406\u3092\u3057\u305f\u308a\u3059\u308b\u5fc5\u8981\u3082\u306a\u3044\u7d20\u6674\u3089\u3057\u3044\u3084\u3064\u3067\u3059\u3002\n\nCompleter\u307e\u3068\u3081\nCompleter\u3068Future.wait()\u3092\u4f7f\u3046\u3060\u3051\u3067\u3001\u975e\u5e38\u306b\u7c21\u6f54\u306b\u3001\u7c21\u5358\u306b\u3001\u975e\u540c\u671f\u51e6\u7406\u306e\u300c\u5b8c\u4e86\u3057\u305f\u3089\u3053\u308c\u3092\u5b9f\u884c\u3059\u308b\u300d\u3092\u5b9f\u88c5\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\n\nMapMixin\u8d85\u4fbf\u5229\ndart:collection\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u306f\u3001\u4fbf\u5229\u306aMixin\u304c\u3044\u304f\u3064\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u4eca\u56de\u306fMapMixin\u3092\u3054\u7d39\u4ecb\u3002\nMapMixin\u306f\u3001\u81ea\u4f5c\u306e\u30af\u30e9\u30b9\u3092Map\u3068\u3057\u3066\u6271\u3048\u308b\u3088\u3046\u306b\u3059\u308bMixin\u3067\u3059\u3002\nimport \"dart:collection\";\n\nclass UserModel extends Object with MapMixin {\n  Map<String, Object> _properties = new Map<String, Object>();\n\n  UserModel([Map<String, Object> properties]) {\n    if (properties != null) {\n      this._properties.addAll(properties);\n    }\n  }\n  //\u4ee5\u4e0b\u306e2\u3064\u306eoperator, 1\u3064\u306egetter, 2\u3064\u306e\u30e1\u30bd\u30c3\u30c9\u304cMapMixin\u306b\u304a\u3044\u3066\u5fc5\u8981\u306a\u5b9f\u88c5\n  operator [](String key) => this._properties[key];\n  operator []=(String key, Object value) => this._properties[key] = value;\n  Iterable<String> get keys => this._properties.keys;\n  Object remove(String key) => this._properties.remove(key);\n  void clear() => this._properties.clear();\n}\n\nvoid main() {\n  var user = new UserModel({\"name\": \"takyam\", \"mail\": \"takyam@example.com\"});\n  user[\"age\"] = 30;\n  user.forEach((String key, Object value)=> print(\"${key}: ${value}\"));\n  // name: takyam\n  // mail: takyam@example.com\n  // age: 30\n}\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306b\u3001\u30c7\u30fc\u30bf\u306e\u5b9f\u4f53\u306f\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u306a\u30e1\u30f3\u30d0\u5909\u6570(_properties)\u306b\u6301\u3061\u3064\u3064\u3001\u500b\u5225\u306bgetter/setter\u3092\u5b9a\u7fa9\u3057\u306a\u304f\u3066\u3082user[\"name\"]\u3084user[\"age\"]\u3068\u3044\u3063\u305f\u304b\u305f\u3061\u3067\u3001\u307e\u308b\u3067Map\u306e\u3088\u3046\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3057\u3001user.forEach()\u306e\u3088\u3046\u306aMap\u304c\u5099\u3048\u3066\u3044\u308b\u30e1\u30bd\u30c3\u30c9\u3082\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308b\u3002\u7d20\u6674\u3089\u3057\u3044\u3002\n\u3053\u306eMap\u306e\u3088\u3046\u306b\u6271\u3048\u308b\u3001\u3068\u3044\u3046\u306e\u306f\u30c7\u30fc\u30bf\u3092\u4fdd\u6301\u3057\u3066\u308bElement\u306b\u3068\u3063\u3066\u975e\u5e38\u306b\u91cd\u8981\u3067\u3001\u4f55\u304c\u91cd\u8981\u304b\u3068\u3044\u3046\u3068JSON\u306b\u5909\u63db\u3067\u304d\u308b\u3068\u3044\u3046\u30e1\u30ea\u30c3\u30c8\u304c\u3042\u308a\u307e\u3059\u3002\nimport \"dart:convert\";\n//(\u7565)\nvar user1 = new UserModel({\"name\": \"user1\", \"age\":15});\nvar user2 = new UserModel({\"name\": \"user2\", \"age\":20});\nvar user3 = new UserModel({\"name\": \"user3\", \"age\":25});\nprint(JSON.encode([user1, user2, user3]));\n// [{\"name\":\"user1\",\"age\":15},{\"name\":\"user2\",\"age\":20},{\"name\":\"user3\",\"age\":25}]\n\nJSON.encode()\u306f\u57fa\u672c\u7684\u306b\u306fnumber\u3001boolean\u3001string\u3001null\u3001list\u3001String\u304c\u30ad\u30fc\u306eMap\u306b\u3057\u304b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u305f\u3068\u3048\u3070MaMixin\u3092Mixin\u3057\u3066\u306a\u3044\u81ea\u4f5c\u30af\u30e9\u30b9\u3092JSON.encode()\u306b\u304b\u3051\u3088\u3046\u3068\u3059\u308b\u3068\u7b2c2\u5f15\u6570\u306etoEncodable\u306b\u5909\u63db\u7528\u306e\u30cf\u30f3\u30c9\u30e9\u3092\u5b9a\u7fa9\u3057\u305f\u308a\u3068\u3001\u4e2d\u3005\u306b\u9762\u5012\u304f\u3055\u3044\u308f\u3051\u3067\u3059\u3002\u305d\u308c\u304cMapMixin\u3067\uff08\u30ad\u30fc\u304cString\u3067\u3042\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u3059\u304c\uff09Map\u30e9\u30a4\u30af\u306b\u6271\u3048\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u4e8b\u3067\u3001JSON\u30a8\u30f3\u30b3\u30fc\u30c9\u6642\u3082\u7279\u306b\u7d30\u304b\u3044\u4e8b\u3092\u6c17\u306b\u305b\u305a\u306b\u6e08\u3080\u308f\u3051\u3067\u3059\u3002\u3053\u308c\u306f\u4fbf\u5229\u3067\u3059\u3002\n\n\u767a\u5c55\u5f62\uff1a.\u30d7\u30ed\u30d1\u30c6\u30a3\u540d\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u3044\n\u524d\u8ff0\u306eUserModel\u30af\u30e9\u30b9\u3092\u3061\u3087\u3063\u3068\u62e1\u5f35\u3057\u3066.\u30d7\u30ed\u30d1\u30c6\u30a3\u540d\u3067\u306e\u30a2\u30af\u30bb\u30b9\u3092\u53ef\u80fd\u306b\u3059\u308b\u4e8b\u3082\u3067\u304d\u307e\u3059\u3002\nimport \"dart:mirrors\";\n//(\u7565)\nclass UserModel extends Object with MapMixin {\n  //\u524d\u8ff0\u306e\u5b9f\u88c5\u3068\u5168\u304f\u4e00\u7dd2\u306a\u306e\u3067\u7701\u7565\n  Object noSuchMethod(Invocation invocation) {\n    if (invocation.isAccessor) { // getter or setter \u306e\u5834\u5408\n      // \u30d7\u30ed\u30d1\u30c6\u30a3\u540d\u3092String\u3067\u53d6\u5f97\n      String accessKey = MirrorSystem.getName(invocation.memberName);\n      if (invocation.isGetter && this.containsKey(accessKey)) {\n        // Getter\u306e\u5834\u5408\u306f\u30ad\u30fc\u304c\u5b58\u5728\u3059\u308c\u3070\u305d\u308c\u3092\u8fd4\u3059\n        return this[accessKey];\n      } else if (invocation.isSetter && invocation.positionalArguments.length == 1) {\n        // Setter\u306e\u5834\u5408\u306f\u5024\u3092\u30bb\u30c3\u30c8\uff08Setter\u306e\u5834\u5408\u306f\u30ad\u30fc\u306e\u672b\u5c3e\u306b\u300c=\u300d\u304c\u3064\u3044\u3066\u308b\u306e\u3067\u6ce8\u610f\uff09\n        return this[accessKey.replaceAll(\"=\", \"\")] = invocation.positionalArguments[0];\n      }\n    }\n    //super\u306b\u6295\u3052\u308c\u3070\u5927\u4f53 NoSuchMethodError \u304c\u51fa\u308b\u306f\u305a\n    return super.noSuchMethod(invocation);\n  }\n}\n\nnoSuchMethod\u3092\u5b9a\u7fa9\u3059\u308b\u4e8b\u3067\u3001\u4f8b\u3048\u3070\u3053\u306eUserModel\u306e\u5834\u5408print(user.name);\u3084user.age = 30;\u3068\u3044\u3063\u305f\u5f62\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u306f\u30b3\u30ec\u3067\u304b\u3063\u3053\u3044\u3044\u3067\u3059\u3057\u4fbf\u5229\u306a\u306e\u3067\u3059\u304c\u3001Symbol\u3092String\u306b\u5909\u63db\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u4e8b\u304b\u3089\u3001\u3069\u3046\u3057\u3066\u3082Mirros\u304c\u5fc5\u8981\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u500b\u4eba\u7684\u306b\u306f\u3042\u307e\u308a\u3053\u3053\u307e\u3067\u3059\u308b\u5fc5\u8981\u306f\u7121\u3044\u3068\u601d\u3063\u3066\u307e\u3059\u3002\u6d41\u77f3\u306b\u30e1\u30bf\u30e1\u30bf\u3057\u3043\u3067\u3059\u3057\u3002\n\nMapMixin\u307e\u3068\u3081\n\u8d85\u4fbf\u5229\u306a\u306e\u3067\u3001MapMixin\u306b\u5fc5\u8981\u306a\u5b9f\u88c5[],[]=,remove,clear,keys\u306e5\u3064\u306f\u30bd\u30e9\u3067\u8a00\u3048\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\u305d\u3057\u3066.\u30d7\u30ed\u30d1\u30c6\u30a3\u30a2\u30af\u30bb\u30b9\u306f\u3084\u308a\u3059\u304e\u3060\u3068\u601d\u3046\u3002\u304b\u3063\u3053\u3044\u3044\u3051\u3069\u3002\n\nStreamController\u8d85\u4fbf\u5229\nStream\u3092\u6271\u3046\u30af\u30e9\u30b9\u3092\u4f5c\u308b\u5834\u5408\u3001Stream\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5916\u90e8\u306b\u516c\u958b\u3057\u305f\u3044\u4e8b\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u6ce8\u610f: \u4ee5\u4e0bMessage\u30af\u30e9\u30b9\u304c\u767b\u5834\u3057\u307e\u3059\u304c\u3001\u3053\u308c\u306f\u30aa\u30ec\u30aa\u30ec\u30e1\u30c3\u30bb\u30fc\u30b8\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3067\u3001\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u3068\u306e\u3084\u308a\u3068\u308a\u306b\u304a\u3044\u3066\u5171\u901a\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3067JSON\u3092encode/decode\u3059\u308b\u305f\u3081\u306e\u30af\u30e9\u30b9\u3067\u3059\u3002\u7279\u306b\u8a71\u306e\u672c\u6d41\u3068\u306f\u95a2\u4fc2\u306a\u3044\u306e\u3067\u305d\u3046\u3044\u3046\u3082\u3093\u3060\u3068\u601d\u3063\u3066\u304a\u3044\u3066\u3082\u3089\u3048\u308c\u3070\u3002\n\nclass WebSocketStream {\n  final String _url = \"ws://${Uri.base.host}:${Uri.base.port}/ws\";\n  WebSocket _ws;\n  bool _encounteredError = false;\n  int _retryWaitSeconds = 1;\n\n  //onMessage\u7528\u306eStreamController\n  StreamController<Message> _onMessageStream = new StreamController<Message>.broadcast();\n\n  WebSocketStream() {\n    this._initialize();\n  }\n\n  //WebSocket\u63a5\u7d9a\u306e\u521d\u671f\u5316\n  void _initialize() {\n    //\u518d\u63a5\u7d9a\u7528\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u30ea\u30bb\u30c3\u30c8\n    this._encounteredError = false;\n    this._retryWaitSeconds *= 2;\n    //WebSocket\u63a5\u7d9a\u3057\u3066\u5404Stream\u306b\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u3092\u767b\u9332\n    this._ws = new WebSocket(this._url)\n      ..onOpen.listen(this._onOpen)\n      ..onClose.listen(this._onClose)\n      ..onError.listen(this._onError)\n      ..onMessage.listen(this._onMessage);\n  }\n\n  //\u5404Stream\u306eGetter\n  Stream<Event> get onOpen => this._ws.onOpen;\n  Stream<CloseEvent> get onClose => this._ws.onClose;\n  Stream<Event> get onError => this._ws.onError;\n  Stream<Message> get onMessage => this._onMessageStream.stream;\n\n  //\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u30b5\u30fc\u30d0\u30fc\u306bPush\u3059\u308b\u30e1\u30bd\u30c3\u30c9\n  void send(Message message) => this._ws.send(message.toJson());\n\n  //\u5404\u30a4\u30d9\u30f3\u30c8\u767a\u751f\u6642\u306e\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\n  void _onOpen(Event event) => print(\"connected!\");\n  void _onClose(CloseEvent event) => this._reconnect();\n  void _onError(Event event) => this._reconnect();\n\n  //\u518d\u63a5\u7d9a\u51e6\u7406\n  void _reconnect() {\n    if (!this._encounteredError) {\n      new Timer(new Duration(seconds: this._retryWaitSeconds), () => this._initialize());\n    }\n    this._encounteredError = true;\n  }\n\n  //\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1\u6642\u306e\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\n  void _onMessage(MessageEvent event) {\n    try {\n      //\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u53d7\u3051\u53d6\u3063\u305fJSON\u3092Message\u306b\u5909\u63db\u3057\u3066\u5916\u90e8\u516c\u958b\u7528Stream\u306b\u6d41\u3059\n      var message = new Message.fromJson(event.data);\n      this._onMessageStream.add(message);\n    } catch (e) {\n      //do nothing\n    }\n  }\n}\n\n\u3053\u308c\u306f\u5b9f\u969b\u306b\u4eca\u56de\u4f5c\u6210\u3057\u305f\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u306eWebSocket\u306e\u63a5\u7d9a\u7ba1\u7406\u7528\u306e\u30e9\u30c3\u30d1\u30fc\u30af\u30e9\u30b9\u3067\u3059\u3002\n\u5b9f\u88c5\u306f\u3053\u3061\u3089\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\u6a5f\u80fd\u306f\u4ee5\u4e0b\u306e2\u3064\u3067\u3059\u3002\n\n\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u5207\u65ad\u6642\u306e\u518d\u63a5\u7d9a\u51e6\u7406\n\u30b5\u30fc\u30d0\u30fc\u304b\u3089Push\u3055\u308c\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092Message\u30af\u30e9\u30b9\uff08\u4eca\u56de\u81ea\u4f5c\u3057\u305f\u30af\u30e9\u30b9\uff09\u306b\u5909\u63db\u3059\u308b\n\n\u4eca\u56de\u91cd\u8981\u306a\u306e\u306f\u3001\nStreamController<Message> _onMessageStream = new StreamController<Message>.broadcast();\nStream<Message> get onMessage => this._onMessageStream.stream;\nthis._onMessageStream.add(message);\n\n\u3053\u306e3\u884c\u3067\u3001StreamController\u3092\u4f5c\u6210\u3057\u3066\u304a\u304d\u3001getter\u3067\u5916\u90e8\u306bStream\u3092\u516c\u958b\u3057\u3001\u5185\u90e8\u3067.add()\u3059\u308b\u4e8b\u3067\u5916\u90e8\u306b\u4f1d\u642c\u3055\u305b\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\n\u3053\u306e\u30af\u30e9\u30b9\u3092\u6271\u3046\u5074\u306f\u3001\nnew WebSocketSteram()\n  ..onMessage.listen((Message message)=> print(message));\n\n\u306e\u3088\u3046\u306b\u3001\u672c\u6765.listen((Event event) => do something...)\u306e\u3068\u3053\u308d\u3092\u5909\u63db\u3057\u305fMessage\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u53d7\u3051\u53d6\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u3088\u3046\u306b\u3001Stream\u3092\u5916\u90e8\u306b\u516c\u958b\u3057\u305f\u3044\u5834\u5408\u306b\u975e\u5e38\u306b\u4fbf\u5229\u3067\u3059\u3002\n\u3042\u3068\u3001\u4eca\u66f8\u3044\u3066\u3066\u601d\u3044\u307e\u3057\u305f\u304c\u3001\u4eca\u56de\u306e\u30b1\u30fc\u30b9\u3067\u306fStreamController\u3092\u4f5c\u3089\u305a\u306b\u3001StreamTransformer\u3067\u5b9f\u88c5\u3057\u305f\u307b\u3046\u304c\u826f\u3055\u305d\u3046\u3060\u3068\u306f\u601d\u3044\u307e\u3059\u3002\nStream<Message> get onMessage => this._ws.onMessage.transform(new StreamTransformer<MessageEvent, Message>.fromHandlers(\n  handleData: (MessageEvent event, EventSink<Message> sink) {\n    try {\n      var message = new Message.fromJson(event.data);\n      sink.add(message);\n    } catch (e) {\n      //do nothing\n    }\n  }\n));\n\n\u8a66\u3057\u3066\u306a\u3044\u3051\u3069\u305f\u3076\u3093\u3053\u3093\u306a\u611f\u3058\u3067\u52d5\u304f\u306f\u305a\u3002\n\nStreamController\u307e\u3068\u3081\n\u5916\u90e8\u306bStream\u3092\u516c\u958b\u3057\u305f\u3044\u5834\u5408\u306b\u3001\u975e\u5e38\u306b\u7c21\u5358\u306b\u5b9f\u88c5\u3067\u304d\u308b\u306e\u3067\u4fbf\u5229\u3002\n\u30dd\u30a4\u30f3\u30c8\u306f\u4f5c\u6210\u3057\u305fStreamController\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e.stream\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u516c\u958b\u3059\u308b\u4e8b\u3002\n\u305d\u308c\u3060\u3051\u3067\u5916\u90e8\u3067\u306f\u7d30\u304b\u3044\u4e8b\u304d\u306b\u305b\u305a\u306b.listen()\u3059\u308a\u3083\u3044\u3044\u3060\u3051\u306a\u306e\u3067\u975e\u5e38\u306b\u4fbf\u5229\u3067\u3059\u3002\n\u305d\u3057\u3066\u4eca\u56de\u306e\u5b9f\u88c5\u3067\u306f\u7279\u306b\u4f7f\u3046\u5fc5\u8981\u304c\u7121\u3044\u3053\u3068\u306b\u6c17\u3065\u3044\u305f\u3002\u60b2\u3057\u3044\u3002\n\nWebSocket\u306ebroadcast\u3092\u3059\u308b\u65b9\u6cd5\nWebsocket\u3067\u3001\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u304b\u3089\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u306bPush\u901a\u77e5\u3092\u9001\u308b\u5834\u5408\u3001\u500b\u4eba\u500b\u4eba\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u6bce\u306bPush\u3059\u308b\u5834\u5408\u306fws.send()\u3059\u308c\u3070\u826f\u3044\u3060\u3051\u306a\u306e\u3067\u7c21\u5358\u3067\u3059\u304c\u3001\u63a5\u7d9a\u4e2d\u306e\u5168\u30e6\u30fc\u30b6\u30fc\u306b\u5bfe\u3057\u3066broadcast\u3057\u305f\u3044\u5834\u5408\u3001\u6a19\u6e96\u3067\u305d\u3046\u3044\u3063\u305f\u6a5f\u80fd\u306f\u63d0\u4f9b\u3055\u308c\u3066\u3044\u306a\u3044\u3088\u3046\u306a\u306e\u3067\u3001\u63a5\u7d9a\u7ba1\u7406\u3068\u30d6\u30ed\u30fc\u30c9\u30ad\u30e3\u30b9\u30c8\u90e8\u5206\u3092\u81ea\u5206\u3067\u5b9f\u88c5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nimport \"dart:io\";\nimport \"message.dart\"; //\u30aa\u30ec\u30aa\u30ec\u30e1\u30c3\u30bb\u30fc\u30b8\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306eMessage\u30af\u30e9\u30b9\n\nclass WebSocketConnectionsHandler {\n  static Set<WebSocket> _connections = new Set<WebSocket>();\n  static add(WebSocket socket) {\n    _connections.add(socket);\n    //\u5207\u65ad\u6642\u306b\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30ea\u30b9\u30c8\u304b\u3089\u524a\u9664\u3059\u308b\n    socket.done.then((_) => remove(socket));\n  }\n  static remove(WebSocket socket) {\n    _connections.remove(socket);\n  }\n  static broadcast(Message message) {\n    _connections\n    .where((WebSocket socket) => socket.readyState == WebSocket.OPEN)\n    .forEach((WebSocket socket) => socket.add(message.toJson()));\n  }\n}\n\n\u9069\u5f53\u306b\u3053\u3093\u306a\u611f\u3058\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3092\u7ba1\u7406\u3059\u308b\u30af\u30e9\u30b9\u3092\u7528\u610f\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u3093\u3067\u3082\u3063\u3066\u3001\n..serve(new UrlPattern(r\"/ws\")).transform(new WebSocketTransformer()).listen((WebSocket socket) {\n  WebSocketConnectionsHandler.add(socket);\n  //do something\n});\n\n\u307f\u305f\u3044\u306b\u63a5\u7d9a\u6642\u70b9\u3067\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30ea\u30b9\u30c8\u306b\u8ffd\u52a0\u3057\u3066\u304a\u3044\u3066\u3042\u3052\u307e\u3059\u3002\n\u30dd\u30a4\u30f3\u30c8\u306f\u3001socket.done.then((_) => remove(socket)); \u306e\u90e8\u5206\u3067\u3001\u30bd\u30b1\u30c3\u30c8\u304c\u5207\u65ad\u3055\u308c\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3092doneFuture\u304b\u3089\u53d6\u5f97\u3057\u3001\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30ea\u30b9\u30c8\u304b\u3089\u9664\u5916\u3057\u3066\u304a\u304f\u4e8b\u3067\u3059\u3002\n\u3053\u306e\u4e0a\u3067\u3001\u30d6\u30ed\u30fc\u30c9\u30ad\u30e3\u30b9\u30c8\u3059\u308b\u6642\u306f\u3001\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30ea\u30b9\u30c8\u306e\u4e2d\u304b\u3089readyState\u304cOPEN\u306e\u3082\u306e\u306b\u3064\u3044\u3066forEach\u3067socket.add\u3059\u308b\u4e8b\u3067\u3001\u30d6\u30ed\u30fc\u30c9\u30ad\u30e3\u30b9\u30c8\u3092\u884c\u3046\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\n\nbroadcast\u307e\u3068\u3081\n\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u308f\u306a\u3044\u5834\u5408\u3001\u81ea\u5206\u3067\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3092\u7ba1\u7406\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u305f\u3076\u3093\u3002\n\u5b9f\u969b\u306b\u306fWebsocket\u975e\u5bfe\u5fdc\u30d6\u30e9\u30a6\u30b6\u7528\u306b\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u306a\u3044\u3057\u30c0\u30a6\u30f3\u30b0\u30ec\u30fc\u30c9\u7684\u306a\u5bfe\u5fdc\u304c\u5fc5\u8981\u306b\u306a\u308b\u3068\u601d\u3046\u306e\u3067\u3001NodeJS\u3067\u8a00\u3046\u3068\u3053\u308d\u306eSocket.IO\u7684\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u63a2\u3057\u3066\u4f7f\u3063\u305f\u307b\u3046\u304c\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nconst\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092static final\u5b9a\u6570\u3067\u6301\u3064\n\u524d\u8ff0\u306eContentType\u30af\u30e9\u30b9\u3067\u3084\u3063\u3066\u308b\u30c6\u30af\u30cb\u30c3\u30af\u306a\u3093\u3067\u3059\u304c\u3001\u8907\u6570\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u304b\u3089\u306a\u308b\u5b9a\u6570\u306fstatic final\u5909\u6570\u3067\u5b9a\u7fa9\u3057\u3066\u304a\u304f\u3068\u3044\u3046\u30c6\u30af\u30cb\u30c3\u30af\u3067\u3059\u3002\nContentType\u306fContent-type: text/html; charset=UTF-8\u306e\u3088\u3046\u306b$primaryType/$subType; charset=$charset\u3068\u3044\u3046\uff13\u3064\u306e\u8981\u7d20\u304b\u3089\u6210\u308a\u7acb\u3063\u3066\u3044\u307e\u3059\u3002\u3068\u306f\u3044\u3048\u826f\u304f\u4f7f\u3046\u5b9a\u7fa9\u306b\u3064\u3044\u3066\u306f\u5b9a\u6570\u3068\u3057\u3066\u4fdd\u6301\u3057\u3066\u304a\u304d\u305f\u3044\u306e\u3067\u3001\u305d\u306e\u305f\u3081\u306bstatic final\u5909\u6570\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\nContetType\u30af\u30e9\u30b9\u306e\u5b9f\u88c5\u306e\u629c\u7c8b\nabstract class ContentType implements HeaderValue {\n  static final TEXT = new ContentType(\"text\", \"plain\", charset: \"utf-8\");\n  static final HTML = new ContentType(\"text\", \"html\", charset: \"utf-8\");\n  static final JSON = new ContentType(\"application\", \"json\", charset: \"utf-8\");\n  static final BINARY = new ContentType(\"application\", \"octet-stream\");\n  factory ContentType(String primaryType, String subType, {String charset, Map<String, String> parameters}) {\n    return new _ContentType(primaryType, subType, charset, parameters);\n  }\n}\n\n\n\u5b9f\u969b\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u3053\u3061\u3089\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\u3053\u3046\u3044\u3046\u98a8\u306b\u5b9f\u88c5\u3057\u3066\u3042\u308b\u306e\u3067\u3001\u5229\u7528\u3059\u308b\u5834\u5408\u306fContentType.HTML\u3068\u3059\u308b\u3060\u3051\u3067\u826f\u3044\u308f\u3051\u3067\u3059\u3002\n\u3053\u306e\u3088\u3046\u306b\u25ef\u25efType\u30af\u30e9\u30b9\u3092\u5b9f\u88c5\u3057\u3066\u3001static final\u5909\u6570\u306b\u5b9a\u6570(\u306e\u3088\u3046\u306a\u30e2\u30ce)\u3092\u5b9a\u7fa9\u3057\u3066\u304a\u304f\u30c6\u30af\u30cb\u30c3\u30af\u306f\u5e83\u304f\u4f7f\u3044\u9053\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u3042\u3068\u304c\u304d\nFuture\u3084Stream\u5468\u308a\u306e\u51e6\u7406\u3092\u30ad\u30e1\u308b\u3068\u304b\u306a\u308a\u6c17\u6301\u3061\u3088\u3044\u3067\u3059\u306d\u3002\u4f55\u304b\u300c\u4ffa\u306fDart\u3057\u3066\u308b\u3093\u3060\u305e\u304a\u3049\u3049\u300d\u3068\u3044\u3046\u611f\u3058\u304c\u3057\u3066\u3002\n\u305d\u308c\u306f\u305d\u308c\u3068\u3057\u3066\u3001Dart\u306e\u30b3\u30a2\u7cfb\u306e\u30d1\u30c3\u30b1\u30fc\u30b8(dart:io\u3068\u304bdart:async\u3068\u304b\uff09\u306fDart\u3067\u5b9f\u88c5\u3055\u308c\u3066\u308b\u90e8\u5206\u3082\u304b\u306a\u308a\u591a\u304f\u3001\u4f7f\u3044\u65b9\u304c\u5206\u304b\u3089\u306a\u3044\u90e8\u5206\u3082\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u898b\u308c\u3070\u3042\u308b\u7a0b\u5ea6\u7406\u89e3\u3067\u304d\u308b\u306e\u3067\u697d\u3061\u3093\u3067\u3059\u3002\u5229\u7528\u65b9\u6cd5\u3092\u30b0\u30b0\u308b\u3088\u308a\u3082\u30bd\u30fc\u30b9\u898b\u305f\u307b\u3046\u304c\u65e9\u3044\u4e8b\u3082\u3061\u3089\u307b\u3089\u3002\u5b9f\u969b\u306eDartTeam\u306b\u3088\u308b\u5b9f\u88c5\u3092\u898b\u308b\u3068\u3044\u3046\u610f\u5473\u306b\u304a\u3044\u3066\u3082\u975e\u5e38\u306b\u52c9\u5f37\u306b\u306a\u308a\u307e\u3059\u3002\n\u3068\u3044\u3046\u308f\u3051\u3067\u3001\u4eca\u56de\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u4f7f\u308f\u305a\u306b\u30a2\u30d7\u30ea\u3092\u5b9f\u88c5\u3057\u3066\u307f\u305f\u308f\u3051\u3067\u3059\u304c\u3001\u958b\u767a\u52b9\u7387\u3068\u304b\u51fa\u6765\u4e0a\u304c\u308a\u306e\u7f8e\u3057\u3055\u3068\u304bGood\u306a\u8a2d\u8a08\u601d\u60f3\u3068\u304b\u305d\u3046\u3044\u3046\u306e\u3068\u306f\u7121\u7e01\u306a\u7cde\u304c\u51fa\u6765\u305f\u3082\u306e\u306e\u3001\u5f97\u3089\u308c\u305f\u77e5\u898b\u306f\u3044\u308d\u3044\u308d\u3068\u5927\u304d\u3044\u3082\u306e\u3067\u3057\u305f\u3002\u3084\u306f\u308a\u3001\u81ea\u5206\u3067\u30ac\u30ea\u30ac\u30ea\u3068\u66f8\u3044\u3066\u3044\u304b\u306a\u3044\u3068\u7d30\u304b\u3044\u3068\u3053\u308d\u3067\u7406\u89e3\u3067\u304d\u3066\u306a\u304b\u3063\u305f\u3068\u3053\u308d\u3082\u305f\u304f\u3055\u3093\u3042\u308a\u3001\u30cf\u30de\u308a\u3064\u3064\u30b3\u30b1\u3064\u3064\u3068\u308a\u3042\u3048\u305a\u5b9f\u88c5\u3067\u304d\u307e\u3057\u305f\u3002\u3088\u304b\u3063\u305f\u3002\nRails\u306e\u3088\u3046\u306a\u30d5\u30eb\u30b9\u30bf\u30c3\u30af\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u304c\u5b58\u5728\u305b\u305a\u3001\u3069\u3046\u3044\u3063\u305f\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3060\u3068Dart\u306b\u5411\u3044\u3066\u308b\u306e\u304b\u3001\u307f\u305f\u3044\u306a\u3068\u3053\u308d\u306e\u7406\u60f3\u578b\u306e\u30a4\u30e1\u30fc\u30b8\u3082\u3042\u307e\u308a\u6301\u3066\u3066\u306a\u3044\u306e\u3067\u3059\u304c\u3001\u305d\u3046\u3044\u3046\u306e\u304c\u767b\u5834\u3059\u308b\u307e\u3067\u306f\u3001\u30de\u30a4\u30af\u30ed\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u30b4\u30ea\u30b4\u30ea\u3068\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u3066\u3044\u304f\u3057\u304b\u306a\u3044\u3068\u601d\u3046\u306e\u3067\u3001\u3053\u3046\u3044\u3063\u305f\u57fa\u790e\u7684\u306a\u77e5\u898b\u3068\u3044\u3046\u306e\u306f\u4f55\u3089\u304b\u306e\u5f79\u306b\u7acb\u3064\u306e\u3067\u306f\u306a\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\u3055\u3066\u3001\u3082\u30462014\u5e74\u3082\u7d42\u308f\u308a\u3067\u3059\u30022015\u5e74\u306f\u7acb\u6d3e\u306aDartisans\uff08Dart\u30e6\u30fc\u30b6\u30fc\u306e\u4e8b\uff09\u306b\u306a\u308c\u308b\u3088\u3046\u7cbe\u9032\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u308c\u3067\u306f\u3001\u826f\u3044\u304a\u5e74\u3092\u3002\n\n\u203b\u6ce8\u610f\uff1a\u4ee5\u4e0b\u306e\u8a18\u4e8b\u306f2014/12/28\u6642\u70b9\u306eDart\u3084\u5404\u30d1\u30c3\u30b1\u30fc\u30b8\u5185\u5bb9\u3092\u5143\u306b\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\n\n## TL;DR\n* \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u4f7f\u3048\n* Dart\u30ec\u30d9\u30eb\u304c\uff11\u3042\u304c\u3063\u305f\u3002\u3071\u3089\u3071\u3089\u3063\u3071\u3063\u3071\u30fc\n\n## \u307e\u3048\u304c\u304d\nDart\u306f\u4e3b\u306b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u306e\u5229\u7528\u304c\u671f\u5f85\u3055\u308c\u3066\u308b\u8a00\u8a9e\u3060\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u500b\u4eba\u7684\u306b\u306fBetter NodeJS\u3068\u3057\u3066\u304b\u306a\u308a\u671f\u5f85\u3057\u3066\u3044\u307e\u3059\u3002\nNodeJS\u306fJS...\u3068\u3044\u3046\u304bV8\u304c\u30d9\u30fc\u30b9\u306a\u306e\u3067\u3001V8\u304c\u5bfe\u5fdc\u3057\u3066\u306a\u3044ES6\u306e\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u306f\uff08\u305d\u306e\u307e\u307e\u3060\u3068\uff09\u4f7f\u3048\u306a\u3044\u3067\u3059\u3057\u3001ES6\u3082JS\u304c\u62b1\u3048\u3066\u3044\u308b\u30d5\u30e9\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u89e3\u6c7a\u3057\u304d\u3063\u3066\u308b\u308f\u3051\u3067\u306f\u7121\u3044\u3067\u3059\u3057\u3001JS\u304c\u30d6\u30e9\u30a6\u30b6\u3067\u4f7f\u308f\u308c\u308b\u4e8b\u3092\u524d\u63d0\u3068\u3057\u305f\u8a00\u8a9e\u3067\u3042\u308b\u304c\u6545\u306b\u3001\u8a00\u8a9e\u4ed5\u69d8\u306e\u7b56\u5b9a\u304c\u5927\u5909\uff08\u8abf\u6574\u304c\u5927\u5909\uff09\u3060\u3063\u305f\u308a\u3057\u3066\u3001\u9032\u5316\u304c\u65e9\u3044\u304b\u3068\u8a00\u308f\u308c\u308b\u3068\u6c7a\u3057\u3066\u305d\u3046\u3067\u306f\u306a\u3044\u308f\u3051\u3067\u3059\u3002\nPromise\u3084yield\u306a\u3069\u3059\u3050\u306b\u3067\u3082\u4f7f\u3044\u305f\u3044\u306a\u3041\u3068\u601d\u3046\u6a5f\u80fd\u3082\u3001\u5b9f\u969b\u306b\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308b\u307e\u3067\u306f\u7d50\u69cb\u6642\u9593\u304c\u304b\u304b\u308b\u308f\u3051\u3067\u3059\u3002\n\u305d\u306e\u70b9Dart\u306f\u3001Google\u3055\u3093\u304c\u597d\u304d\u306b\u4f5c\u3063\u3066\u308b\uff08ECMA\u6a19\u6e96\u306b\u3082\u767b\u9332\u3055\u308c\u3066\u307e\u3059\u304c\uff09\u306e\u3067\u3001\u4ed5\u69d8\u6c7a\u3081\u3066\u3001\u5b9f\u88c5\u3057\u3066\u3001\u3059\u3050\u306b\u958b\u767a\u8005\u304c\u65b0\u3057\u3044\u6a5f\u80fd\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\nNodeJS\u3068\u540c\u3058\u30b7\u30f3\u30b0\u30eb\u30b9\u30ec\u30c3\u30c9\u3092\u30d9\u30fc\u30b9\u306b\u3057\u305f\u30a4\u30d9\u30f3\u30c8\u30eb\u30fc\u30d7\u30e2\u30c7\u30eb\u3067\u3042\u308a\u3001Node\u3067\u51fa\u6765\u308b\u4e8b\u306f\u65e2\u306b\u5927\u4f53\u3067\u304d\u308b\uff08\u306f\u305a\uff09\u306e\u3067\u3001pub\u304cnpm\u3070\u308a\u306e\u30a8\u30b3\u30b7\u30b9\u30c6\u30e0\u3068\u3057\u3066\u6210\u9577\u3057\u305f\u3089\u304b\u306a\u308a\u6765\u308b\u306a\u3041\u3068\u601d\u3063\u3066\u308b\u308f\u3051\u3067\u3059\u3002\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u306b\u3070\u304b\u308a\u6ce8\u76ee\u3055\u308c\u304c\u3061\u306aDart\u3055\u3093\u3067\u3059\u304c\u3001\u500b\u4eba\u7684\u306b\u306f\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u306b\u30d5\u30e5\u30fc\u30c1\u30e3\u30fc\u3057\u3066\u3044\u304d\u305f\u3044\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u3067\u3001\u4eca\u56de\u3001\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u4f7f\u308f\u305a\u306bDart\u306e\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u306eWeb\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n**dart-bbs-vanilla-study**\nhttps://github.com/takyam-git/dart-bbs-vanilla-study\n\nDart\u306e\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u6709\u540d\u306a\u306e\u306f[Redstone.dart](http://redstonedart.org/)\u3001[start](https://github.com/lvivski/start)\u3001[Rikulo Stream](http://rikulo.org/projects/stream)\u3001[shelf](https://pub.dartlang.org/packages/shelf) \u3042\u305f\u308a\u3067\u3057\u3087\u3046\u304b\u3002\n\u3044\u305a\u308c\u3082\u8efd\u91cf\u306a\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\uff08shelf\u306b\u3044\u305f\u3063\u3066\u306f`Web Server Middleware for Dart`\u3060\u3057\uff09\u306a\u306e\u3067\u3001\u5927\u3057\u305f\u6a5f\u80fd\u306f\u7121\u3044\u306e\u3067\u3059\u304c\u3001\u305d\u308c\u306b\u3057\u308d\u3042\u308b\u7a0b\u5ea6\u306e\u6709\u308a\u96e3\u307f\u3092\u611f\u3058\u308b\u305f\u3081\u306b\u3082\u3001\u5185\u90e8\u52d5\u4f5c\u3092\u63a8\u6e2c\u3059\u308b\u305f\u3081\u306b\u3082\u3001\u3068\u308a\u3042\u3048\u305a\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u4f7f\u308f\u305a\u306b\u81ea\u5206\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u66f8\u3044\u3066\u307f\u305f\u307b\u3046\u304c\u826f\u3044\u306a\u3068\u601d\u3044\u3001\u4eca\u56de\u306f\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u4f7f\u308f\u305a\u306b\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u51fa\u6765\u4e0a\u304c\u3063\u305f\u3082\u306e\u306f\u7d1b\u3046\u3053\u3068\u306a\u304d\u7cde\u3067\u3059\u304c\u3001\u3044\u304f\u3064\u304b\u77e5\u898b\u304c\u5f97\u3089\u308c\u305f\u306e\u3067\u5099\u5fd8\u9332\u304c\u3066\u3089\u30e1\u30e2\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u7279\u306b\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u306b\u304b\u304e\u3089\u305a\u3001\u304c\u3063\u3064\u308aDart\u66f8\u3044\u305f\u306e\u304c\u521d\u3081\u3066\u306a\u306e\u3067\u3001Dart\u306e\u57fa\u790e\u7684\u306a\u90e8\u5206\u306b\u3064\u3044\u3066\u3082\u66f8\u3044\u3066\u307e\u3059\u3002\n\n\u5148\u306b\u7d50\u8ad6\u3060\u3051\u66f8\u3044\u3066\u304a\u304f\u3068\u3001\u52c9\u5f37\u306b\u306f\u306a\u3063\u305f\u3051\u3069\u666e\u901a\u306b\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u4f7f\u3063\u305f\u307b\u3046\u304c\u3044\u3044\u3067\u3059\u306d\u3002\n\n## \u304a\u3057\u306a\u304c\u304d\n\n* route\u30d1\u30c3\u30b1\u30fc\u30b8\u306eRouter\u306e\u4f7f\u3044\u65b9\n\t* \u9759\u7684\u30d5\u30a1\u30a4\u30eb\u3068\u305d\u3046\u3058\u3083\u306a\u3044\u3084\u3064\u306e\u51e6\u7406\u5206\u3051\u306e\u65b9\u6cd5\u3002\n* http_server\u30d1\u30c3\u30b1\u30fc\u30b8\n\t* jailRoot\u306b\u3088\u3063\u3066root\u968e\u5c64\u3088\u308a\u4e0a\u306f\u53c2\u7167\u3067\u304d\u306a\u3044\u3001\u3068\u304b\u3002\n* HttpResponse\u306eContentType\u306e\u8a2d\u5b9a\u65b9\u6cd5\n\t* `request.response.headers.add(\"Content-Type\", \"text/html\")`\u306f\u9593\u9055\u3044\u3002\n* Completer\u8d85\u4fbf\u5229\n\t* `Future.wait()` \u3068\u5408\u308f\u305b\u3066\u3088\u304f\u4f7f\u3046\u3002\n* MapMixin\u8d85\u4fbf\u5229\n\t* `JSON.encode()` \u3068\u304b\u306b\u3082\u5bfe\u5fdc\u3067\u304d\u3061\u3083\u3046\u3002\u7d20\u6575\u3002\n* StreamController\u8d85\u4fbf\u5229\n\t* \u5916\u90e8\u306bStream\u3092\u516c\u958b\u3057\u305f\u3044\u6642\u306b\u8d85\u697d\u3061\u3093\u3002\n* WebSocket\u306ebroadcast\u3092\u3059\u308b\u65b9\u6cd5\n\t* WebSocket\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u306e\u7ba1\u7406\u3092\u5b9f\u88c5\u3059\u308b\u3002\n* const\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092static final\u5b9a\u6570\u3067\u6301\u3064\n\t* ContentType\u30af\u30e9\u30b9\u3068\u304b\u306f\u3053\u308c\u3084\u3063\u3066\u308b\u3002\n\n## route\u30d1\u30c3\u30b1\u30fc\u30b8\u306eRouter\u306e\u4f7f\u3044\u65b9\n\nHTTP\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u634c\u304f\u306e\u306b\u3001`dart:io`\u30d1\u30c3\u30b1\u30fc\u30b8\u306e[`HTTPServer`](https://api.dartlang.org/apidocs/channels/stable/dartdoc-viewer/dart:io.HttpServer)\u30af\u30e9\u30b9\u3092\u4f7f\u3046\u308f\u3051\u3067\u3059\u304c\u3001\u305d\u306e\u307e\u307e\u3060\u3068\u539f\u59cb\u7684\u306a\u4e8b\u3057\u304b\u3067\u304d\u306a\u3044\u306e\u3067\u3001[route\u30d1\u30c3\u30b1\u30fc\u30b8](https://pub.dartlang.org/packages/route)\u3092\u4f7f\u3063\u3066\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u884c\u3044\u307e\u3059\u3002\nRoute\u30af\u30e9\u30b9\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u30fb\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u306e\u3069\u3061\u3089\u3082\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\n\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u306e\u4f7f\u3044\u65b9\u306f\u975e\u5e38\u306b\u30b7\u30f3\u30d7\u30eb\u3067\u3001Route\u5358\u4f53\u3067\u4f55\u304b\u8907\u96d1\u306a\u4e8b\u304c\u3067\u304d\u308b\u8a33\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n\u6a5f\u80fd\u306f **\u300c\u8a2d\u5b9a\u3057\u305fURL\u306e\u30d1\u30bf\u30fc\u30f3\u306b\u4e00\u81f4\u3059\u308b\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u5bfe\u5fdc\u3059\u308bStream\u3092\u751f\u6210\u3059\u308b\u300d** \u3060\u3051\u3067\u3059\u3002\n\n\u767b\u5834\u3059\u308b\u30af\u30e9\u30b9\u3084\u95a2\u6570\u3082\u5c11\u306a\u304f\u3001\u4ee5\u4e0b\u3092\u6291\u3048\u3066\u304a\u3051\u3070\u307b\u307c\u554f\u984c\u306a\u304f\u5229\u7528\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\u3067\u3057\u3087\u3046\u3002\n\n* [Router \u30af\u30e9\u30b9](http://www.dartdocs.org/documentation/route/0.4.6/index.html#route/route-server.Router)\n\t* filter \u30e1\u30bd\u30c3\u30c9\n\t\t* `void filter(Pattern url, Filter filter)`\n\t\t* Filter \u306f `Future<bool> Filter(HttpRequest request)`\n\t* serve \u30e1\u30bd\u30c3\u30c9\n\t\t* `Stream<HttpRequest> serve(Pattern url, {String method})`\n\t* defaultStream \u30d7\u30ed\u30d1\u30c6\u30a3\n\t\t* `Stream<HttpRequest> get defaultStream`\n* UrlPattern \u30af\u30e9\u30b9\n* matchAny\u95a2\u6570\n\n### Router \u306e\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9\n\n```dart\nvar router = new Router(server); //server \u306f HttpServer \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\nrouter\n  ..filter(new UrlPattern(r\"/mypage\"), authFilter)\n  ..serve(new UrlPattern(r\"/\"), method: \"GET\").listen(topPageHandler)\n  ..serve(new UrlPattern(r\"/mypage\").listen(myPageHandler)\n  ..defaultStream.listen(notFoundHandler);\n  //topPageHandler/myPageHandler/notFoundHandler \u306f\u5225\u9014\u81ea\u5206\u3067\u5b9a\u7fa9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\n```\n\n#### serve\u30e1\u30bd\u30c3\u30c9\u3068defaultStream\u30d7\u30ed\u30d1\u30c6\u30a3\n\n\u6700\u3082\u5927\u4e8b\u306a\u30e1\u30bd\u30c3\u30c9\u3067\u3042\u308b`serve` \u306f `Stream<HttpRequest>` \u3092\u8fd4\u3057\u307e\u3059\u306e\u3067\u3001\u305d\u308c\u3092 `.listen()` \u3059\u308b\u4e8b\u3067\u3001`serve()`\u306b\u4e00\u81f4\u3057\u305f\u30d1\u30bf\u30fc\u30f3\u306e\u51e6\u7406\u3092`.listen()`\u306b\u767b\u9332\u3057\u305f\u30cf\u30f3\u30c9\u30e9\u304c\u884c\u3046\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u4e0a\u8a18\u306e\u4f8b\u3067\u3044\u3048\u3070\u3001`r\"/\"`\uff08\u30c8\u30c3\u30d7\u30da\u30fc\u30b8\uff09\u306e\u51e6\u7406\u306f`topPageHandler`\u304c\u884c\u3044\u3001`r\"/mypage\"`\uff08\u30de\u30a4\u30da\u30fc\u30b8\uff09\u306e\u51e6\u7406\u3092`myPageHandler`\u304c\u884c\u3046\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n> Tips:\u3000`Stream<HttpRequest>` \u306e\u3001 `<HttpRequest>` \u306f\u3001\u305d\u306e\u30b9\u30c8\u30ea\u30fc\u30e0\u3092listen\u3057\u3066\u308b\u30cf\u30f3\u30c9\u30e9\u306b\u6e21\u3055\u308c\u308b\u5f15\u6570\u304c `HttpRequest` \u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u3042\u308b\u4e8b\u3092\u8868\u3057\u3066\u3044\u307e\u3059\u3002\u306a\u306e\u3067\u3001\u30cf\u30f3\u30c9\u30e9\u306f `(HttpRequest request)=> do something...` \u306e\u3088\u3046\u306a\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3092\u8a2d\u5b9a\u3059\u308b\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u3055\u3089\u306b\u3001\u3069\u306eUrlPattern\u306b\u3082\u30de\u30c3\u30c1\u3059\u308bserve\u304c\u7121\u304b\u3063\u305f\u5834\u5408\u306e`Stream<HttpRequest>`\u3068\u3057\u3066`defaultStream`\u30d7\u30ed\u30d1\u30c6\u30a3\u304c\u5b9a\u7fa9\u3057\u3066\u3042\u308a\u3001\u4f8b\u3048\u3070\u4e0a\u8a18\u306e\u4f8b\u306e\u5834\u5408\u306f\u305d\u3053\u306b404 Not Found\u30da\u30fc\u30b8\u3092\u8868\u793a\u3059\u308b\u305f\u3081\u306e`notFoundHandler`\u3092\u5b9a\u7fa9\u3059\u308b\u3088\u3046\u306a\u4f7f\u3044\u65b9\u3092\u3057\u3066\u3044\u307e\u3059\u3002\n\n#### filter\u30e1\u30bd\u30c3\u30c9\n\n\u4e0a\u8a18\u306e\u4f8b\u306e3\u884c\u76ee\u306b\u3042\u308b`filter()`\u30e1\u30bd\u30c3\u30c9\u306f\u3001\u7b2c1\u5f15\u6570\u306bserve\u3068\u540c\u3058\u3088\u3046\u306bUrlPattern\u3092\u8a2d\u5b9a\u3057\u3001\u7b2c2\u5f15\u6570\u306b\u306f`Future<bool>`\u3092\u8fd4\u3059\u30cf\u30f3\u30c9\u30e9\u8a2d\u5b9a\u3057\u307e\u3059\u3002Filter\u306e\u5b9f\u88c5\u4f8b\u3068\u3057\u3066[\u30d1\u30c3\u30b1\u30fc\u30b8\u306eREADME\u306b\u66f8\u3044\u3066\u3042\u308b\u4f8b](https://github.com/justinfagnani/route/blob/master/README.md#server-routing)\u3092\u898b\u3066\u307f\u307e\u3059\u3002\n\n```dart\nFuture<bool> authFilter(req) {\n  return getUser(getUserIdCookie(req)).then((user) {\n    if (user != null) return true;\n    redirectToLoginPage(req);\n    return false;\n  });\n}\n```\n\n\u975e\u540c\u671f\u3067\u30e6\u30fc\u30b6\u30fc\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u78ba\u8a8d\u3057\u3066\u3001\u6709\u52b9\u306a\u30e6\u30fc\u30b6\u30fc\u3067\u3042\u308c\u3070true\u3092\u3001\u305d\u3046\u3067\u306a\u3051\u308c\u3070false\u3092\u8fd4\u3057\u3066\u3044\u307e\u3059\u3002\ntrue\u304c\u8fd4\u3063\u305f\u6642\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u51e6\u7406\u306b\u3064\u3044\u3066\u306f\u3001\u901a\u5e38\u3069\u304a\u308a\u3001\u4e00\u81f4\u3057\u305fserve\u306elisten\u306e\u30cf\u30f3\u30c9\u30e9\u304c\u5b9f\u884c\u3055\u308c\u308b\u306e\u3067\u3059\u304c\u3001\u3053\u3053\u3067false\u3092\u8fd4\u3057\u305f\u5834\u5408\u306f\u3001\u305f\u3068\u3048\u4e00\u81f4\u3057\u305fserve\u304c\u3042\u3063\u305f\u3068\u3057\u3066\u3082\u51e6\u7406\u3055\u308c\u307e\u305b\u3093\u3002\n\u3058\u3083\u3041false\u306e\u6642\u306f`defaultStream`\u306b\u884c\u304f\u306e\u304b\u3068\u3044\u3046\u3068\u3001\u305d\u3046\u3067\u3082\u306a\u304f\u3066\u3001\u672c\u5f53\u306b\u4f55\u3082\u51e6\u7406\u3055\u308c\u306a\u304f\u306a\u308b\u306e\u3067\u3001\u4e0a\u8a18\u4f8b\u306e\u5834\u5408`redirectToLoginPage(req)`\u306e\u90e8\u5206\u3067\u6050\u3089\u304f\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u51e6\u7406\u3092\u3057\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u3053\u306e\u3088\u3046\u306b\u4f55\u304b\u3057\u3089`request.response.close()`\u3092\u884c\u3046\u3088\u3046\u306b\u3057\u306a\u3044\u3068\u3001 **\u3044\u3064\u307e\u3067\u3060\u3063\u3066\u3082\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u8fd4\u308a\u307e\u305b\u3093** \u3002\n\n#### UrlPattern\u30af\u30e9\u30b9\u3068 matchAny \u95a2\u6570\n\n\u65e2\u306b\u4f55\u56de\u304b\u767b\u5834\u3057\u3066\u3044\u308b`UrlPattern`\u30af\u30e9\u30b9\u3067\u3059\u304c\u3001\u3053\u308c\u306f`serve`\u3084`filter`\u306e\u7b2c1\u5f15\u6570\u306b\u6e21\u3059[`Pattern`](https://api.dartlang.org/apidocs/channels/stable/dartdoc-viewer/dart:core.Pattern)\u306e\u5b9f\u88c5\u3067\u3059\u3002\u57fa\u672c\u7684\u306b\u306f\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u5f15\u6570\u306b\u6e21\u3055\u308c\u305f **\u6b63\u898f\u8868\u73fe\u98a8** \u306eURL\u306b\u30de\u30c3\u30c1\u3059\u308b\u304b\u3069\u3046\u304b\u3001\u3092\u5224\u5b9a\u3059\u308b\u30af\u30e9\u30b9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u304c\u3001\u901a\u5e38\u306eRegExp\u3068\u306f\u9055\u3046\u70b9\u304c\u3044\u304f\u3064\u304b\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u4ee5\u4e0b[\u3053\u3061\u3089](https://github.com/justinfagnani/route/blob/b5d62bc4c3b5deff6602ff6f5dcdee720e652e5c/lib/url_pattern.dart#L23-L32)\u304b\u3089\u306e\u5f15\u7528\u3067\u3059\u3002\n\n> #### \u901a\u5e38\u306eRegExp\u3068\u306e\u9055\u3044\n> * \u5168\u3066\u306e\u6b63\u898f\u8868\u73fe\u306e\u7279\u6b8a\u6587\u5b57\u306f\u30b0\u30eb\u30fc\u30d4\u30f3\u30b0(\u8a33\u6ce8:\u6b63\u898f\u8868\u73fe\u306e`()`\u3067\u56f2\u3046\u30a2\u30ec)\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30b0\u30eb\u30fc\u30d4\u30f3\u30b0\u3055\u308c\u3066\u306a\u3044\u3082\u306e\u306b\u3064\u3044\u3066\u306f\u3001\u30a8\u30b9\u30b1\u30fc\u30d7\u6e08\u307f\u306e\u6b63\u898f\u8868\u73fe\u7279\u6b8a\u6587\u5b57\u304b\u901a\u5e38\u306e\u6587\u5b57\u5217\u3068\u3057\u3066\u51e6\u7406\u3055\u308c\u307e\u3059\u3002\n> * \u6587\u5b57\u5217\u5168\u4f53\u3068\u306e\u4e00\u81f4\u3055\u305b\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30d1\u30bf\u30fc\u30f3\u306e\u5148\u982d\u3068\u672b\u5c3e\u306b\u305d\u308c\u305e\u308c`^`\u3068`$`\u304c\u81ea\u52d5\u3067\u4ed8\u4e0e\u3055\u308c\u307e\u3059\u3002\n> * \u30d1\u30bf\u30fc\u30f3\u306f\u66d6\u6627\u3067\u306f\u3044\u3051\u305a\u3001\u305f\u3068\u3048\u3070\u3001`(.*)(.*)`\u306f\u30c8\u30c3\u30d7\u30ec\u30d9\u30eb\u3067\u306f\u8a31\u53ef\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n> * \u30cf\u30c3\u30b7\u30e5\u6587\u5b57\u5217\u3067\u3042\u308b`#`\u306f`'#'`\u3068`'/'`\u306e\u4e21\u65b9\u306b\u30de\u30c3\u30c1\u3057\u3001\u3072\u3068\u3064\u306e\u30d1\u30bf\u30fc\u30f3\u3067\u4e00\u5ea6\u3057\u304b\u4f7f\u3046\u4e8b\u306f\u3067\u304d\u307e\u305b\u3093\u3002\u307e\u305f\u3001\u30cf\u30c3\u30b7\u30e5\u306f\u30b0\u30eb\u30fc\u30d4\u30f3\u30b0\u3059\u308b\u4e8b\u3092\u8a31\u53ef\u3057\u3066\u3044\u307e\u305b\u3093\u3002\n\n\u7279\u306b\u3001`r\"/path/to/hoge/.*\"` \u306f\u6050\u3089\u304f\u671f\u5f85\u901a\u308a\u306b\u52d5\u4f5c\u305b\u305a `r\"/path/to/hoge/(.*)\"` \u3068\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u70b9\u306f\u3001\u6700\u521d\u306b\u8ab0\u3082\u304c\u30cf\u30de\u308b\u30dd\u30a4\u30f3\u30c8\u304b\u306a\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u3067\u3001\u57fa\u672c\u7684\u306bUrlPattern\u30af\u30e9\u30b9\u306f\u3072\u3068\u3064\u306e\u30d1\u30bf\u30fc\u30f3\u3057\u304b\u5b9a\u7fa9\u3067\u304d\u306a\u3044\u308f\u3051\u3067\u3059\u304c\u3001\u8907\u6570\u306e\u30d1\u30bf\u30fc\u30f3\u306b\u304a\u3044\u3066\u4e00\u3064\u306e\u30cf\u30f3\u30c9\u30e9\u3092\u767b\u9332\u3057\u305f\u3044\u5834\u5408\u304c\u3042\u308a\u3001\u305d\u3046\u3044\u3063\u305f\u5834\u5408\u306b\u306f`matchAny()`\u95a2\u6570\u3092\u4f7f\u3046\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002\n\n**matchAny\u95a2\u6570**\n`Pattern matchAny(Iterable<Pattern> include, {Iterable<Pattern> exclude})`\n\n\u5927\u3057\u305f\u8a71\u3058\u3083\u306a\u304f\u3066\u3001`serve(matchAny([pattern1, pattern2]))`\u306e\u3088\u3046\u306b\u3001\u8907\u6570\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u5408\u308f\u305b\u3066\u4e00\u3064\u306ePattern\u306b\u3057\u3066\u304f\u308c\u308b\u611f\u3058\u3067\u3001\u7b2c1\u5f15\u6570\u306eList\u5185\u306eUrlPattern\u306e\u3044\u305a\u308c\u304b\u306b\u4e00\u81f4\u3059\u308b\u304b\u3069\u3046\u304b\u3001\u3068\u3044\u3063\u305f\u5224\u5b9a\u306b\u5909\u308f\u308a\u307e\u3059\u3002\n\n### routes\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u307e\u3068\u3081\n\nRouter\u30af\u30e9\u30b9\u304c\u3067\u304d\u308b\u4e8b\u306f\u57fa\u672c\u7684\u306b\u30b3\u30ec\u3060\u3051\u3067\u3001\u4f8b\u3048\u3070\u300c\u25ef\u25ef\u30da\u30fc\u30b8\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306f\u25ef\u25efController\u306e\u25ef\u25ef\u30e1\u30bd\u30c3\u30c9\u3067\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3059\u308b\u300d\u3068\u3044\u3063\u305f\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u30e9\u30a4\u30af\u306a\u51e6\u7406\u3092\u30d5\u30e9\u30f3\u30af\u306b\u66f8\u304f\u4e8b\u306f\u3067\u304d\u307e\u305b\u3093\u3002\u3044\u308f\u3086\u308b`routes`\u306e\u5b9a\u7fa9\u3092\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u30d9\u30fc\u30b9\u3067\u884c\u3046\u3068\u3044\u3063\u305f\u4e8b\u306f\u3001\u3053\u308c\u3060\u3051\u3060\u3068\u3067\u304d\u306a\u3044\u308f\u3051\u3067\u3059\u3002\n\n\u3057\u304b\u3057\u306a\u304c\u3089\u3001\u5fc5\u8981\u6700\u4f4e\u9650\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u51e6\u7406\u306f\u63d0\u4f9b\u3055\u308c\u307e\u3059\u3057\u3001\u3053\u308c\u3092\u30d9\u30fc\u30b9\u306b\u3001\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u30e9\u30a4\u30af\u306a\u51e6\u7406\u3092\u66f8\u304f\u4e8b\u3082\u96e3\u3057\u304f\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u975e\u5e38\u306b\u30b7\u30f3\u30d7\u30eb\u3067\u5f37\u529b\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3068\u3044\u3048\u308b\u3067\u3057\u3087\u3046\u3002\n\n\u306a\u304a\u3001\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u51e6\u7406\u306e\u8a73\u7d30\u306f[\u3053\u3061\u3089\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9](https://github.com/justinfagnani/route/blob/eb78fc7e29d40ed14114980878c4e1cf3761c38c/lib/server.dart#L93-L119)\u3092\u898b\u308b\u3068\u308f\u304b\u308a\u307e\u3059\u3002Router\u30af\u30e9\u30b9\u81ea\u4f53\u975e\u5e38\u306b\u30b7\u30f3\u30d7\u30eb\u3067\u3001\u30b3\u30fc\u30c9\u91cf\u3082\u5c11\u306a\u3044\u306e\u3067\u3001\u5168\u90e8\u3092\u8aad\u3080\u306e\u3082\u7279\u306b\u82e6\u306b\u306f\u306a\u3089\u306a\u3044\u3067\u3057\u3087\u3046\u3002\n\n\n## http_server\u30d1\u30c3\u30b1\u30fc\u30b8\n\n[http_server\u30d1\u30c3\u30b1\u30fc\u30b8](https://pub.dartlang.org/packages/http_server)\u3082\u3001\u5148\u306eroutes\u30d1\u30c3\u30b1\u30fc\u30b8\u3068\u4f75\u305b\u3066HTTP\u30b5\u30fc\u30d0\u30fc\u3092\u4f5c\u6210\u3059\u308b\u969b\u306b\u3088\u304f\u5229\u7528\u3055\u308c\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u3072\u3068\u3064\u3060\u3068\u601d\u3044\u307e\u3059\u3002\u3053\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u4e3b\u306b\u4ee5\u4e0b\u306e\u6a5f\u80fd\u3092\u5099\u3048\u3066\u3044\u307e\u3059\u3002\n\n* POST\u30ea\u30af\u30a8\u30b9\u30c8\u7b49\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u30dc\u30c7\u30a3\u306e\u53d6\u5f97\n* VirtualDirectory\u30af\u30e9\u30b9\u306b\u3088\u308b\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u306e\u914d\u4fe1\n* VirtualHost\u30af\u30e9\u30b9\u306b\u3088\u308b\u30ea\u30af\u30a8\u30b9\u30c8\u30c9\u30e1\u30a4\u30f3\u6bce\u306e\u51e6\u7406\u308f\u3051\n\nVirtualHost\u306f\u4f7f\u3063\u305f\u4e8b\u304c\u306a\u3044\u306e\u3067\u3001\u4eca\u56de\u306f\u4e0a\u306e2\u3064\u306b\u3064\u3044\u3066\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n\u306a\u304a\u3001http_server\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30bd\u30fc\u30b9\u306f\u4ee5\u4e0b\u306b\u3042\u308a\u307e\u3059\u3002\n\nhttps://code.google.com/p/dart/source/browse/branches/bleeding_edge/dart/pkg/http_server/lib/http_server.dart\n\n\u73fe\u5728DartTeam\u88fd\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u5f90\u3005\u306bGitHub\u306b\u79fb\u52d5\u3057\u3066\u3044\u3063\u3066\u307e\u3059\u306e\u3067\u3001\u3053\u308c\u3082\u8fd1\u3044\u3046\u3061\u306bGitHub\u306b\u79fb\u52d5\u3059\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n### \u30ea\u30af\u30a8\u30b9\u30c8\u30dc\u30c7\u30a3\u306e\u53d6\u5f97\n\nPOST\u3055\u308c\u305f\u5024\u3092\u53d6\u308b\u306b\u3042\u305f\u308a\u3001PHP\u3060\u3068`$_POST`\u3067\u7c21\u5358\u306b\u53d6\u5f97\u3067\u304d\u305f\u308a\u3057\u307e\u3059\u304c\u3001Dart\u306e\u5834\u5408\u306f\u81ea\u5206\u3067\u3044\u308d\u3044\u308d\u51e6\u7406\u3057\u306a\u3051\u308c\u3070\u53d6\u5f97\u3059\u308b\u4e8b\u306f\u3067\u304d\u307e\u305b\u3093\u3002\u304c\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u30dc\u30c7\u30a3\u306e\u30d1\u30fc\u30b9\u51e6\u7406\u306f\u610f\u5916\u3068\u9762\u5012\u306a\u306e\u3067\u3001\u3053\u3053\u306f`HttpBodyHandler`\u30af\u30e9\u30b9\u3092\u5229\u7528\u3057\u3066\u3001\u7c21\u5358\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u30dc\u30c7\u30a3\u3092\u53d6\u5f97\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u5148\u307b\u3069\u306eRouter\u30af\u30e9\u30b9\u306e\u5229\u7528\u4f8b\u3092\u5c11\u3057\u6539\u4fee\u3057\u3066\u307f\u307e\u3059\u3002\n\n```dart\nvar router = new Router(server); //server \u306f HttpServer \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\nrouter\n  ..serve(new UrlPattern(r\"/\"), method: \"GET\").listen(topPageHandler)\n  ..serve(new UrlPattern(r\"/\"), method: \"POST\").transform(new HttpBodyHandler()).listen(topPagePostHandler)\n  ..defaultStream.listen(notFoundHandler);\n```\n\n`.transform(new HttpBodyHandler())`\u304c\u5897\u3048\u3066\u3044\u307e\u3059\u3002\n`.transform()`\u306fStream\u306e\u6a19\u6e96\u30e1\u30bd\u30c3\u30c9\u3067\u3001[\u8a73\u7d30\u306f\u3053\u3061\u3089\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](https://www.dartlang.org/docs/tutorials/streams/#transforming-stream-data)\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u3002\u7c21\u5358\u306b\u3044\u3046\u3068\u3001Stream\u306e\u5024\u3092\u5909\u63db\u3059\u308b\u3084\u3064\u3067\u3059\u3002\n\u4eca\u56de\u306e\u4f8b\u3067\u3044\u3046\u3068\u3001\u5143\u3005\u306f`Stream<HttpRequest>`\u3060\u3063\u305f\u308f\u3051\u3067\u3059\u304c\u3001\u3053\u306e`HttpBodyHandler`(StreamTransformer\u306e\u5b9f\u88c5)\u3092\u9593\u306b\u631f\u3080\u4e8b\u3067\u3001`Stream<HttpRequestBody>`\u3068\u3057\u3066\u6271\u3048\u308b\u3088\u3046\u306b\u306a\u308b\u308f\u3051\u3067\u3059\u3002\n\n\u3064\u307e\u308a\u3001GET\u30ea\u30af\u30a8\u30b9\u30c8\u306e`topPageHandler`\u306f`(HttpRequest request) => do something...`\u3067\u3001\nPOST\u30ea\u30af\u30a8\u30b9\u30c8\u306e`topPagePostHandler`\u306f`(HttpRequestBody request) => do something...`\u306b\u306a\u308b\u308f\u3051\u3067\u3059\u3002\n\nHttpRequestBody\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f`.body`\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u6301\u3063\u3066\u3044\u3066\u3001\u3053\u306e\u4e2d\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u30dc\u30c7\u30a3\u304c\u542b\u307e\u308c\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5f62\u5f0f\u306f3\u7a2e\u985e\u3067`Map`\u304b`Bytes`\u304b`String`\u3067\u3059\u3002\u3053\u308c\u306f\u30ea\u30af\u30a8\u30b9\u30c8\u5f62\u5f0f\u306b\u3088\u3063\u3066\u7570\u306a\u308b\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u8a73\u3057\u304f\u306f[\u3053\u306e\u3078\u3093\u306e\u5b9f\u88c5](https://code.google.com/p/dart/source/browse/branches/bleeding_edge/dart/pkg/http_server/lib/src/http_body_impl.dart?r=41936#56)\u3092\u898b\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u3061\u306a\u307f\u306b\u3069\u3046\u3057\u3066\u3082\u30e9\u30a4\u30d6\u30e9\u30ea\u4f7f\u3044\u305f\u304f\u306a\u3044\u3093\u3060\u3088\u3063\u3066\u3044\u3046\u4eba\u306f\u3001[\u3053\u3061\u3089\u306eStackOverflow\u306e\u8cea\u554f](http://stackoverflow.com/questions/20680073/dart-how-do-you-read-the-content-body-of-a-http-request)\u3092\u53c2\u8003\u306b\u3001`UTF8.decodeStream()`\u3092\u4f7f\u3046\u4e8b\u3067\u9811\u5f35\u308c\u306a\u304f\u3082\u306a\u3044\u3067\u3059\u304c\u3001Form\u306e\u30d1\u30fc\u30b9\u3068\u304b\u8f9b\u3044\u306e\u3067\u4f7f\u3048\u308b\u3082\u306e\u306f\u4f7f\u3063\u305f\u307b\u3046\u304c\u3044\u3044\u3068\u601d\u3046\u306e\u3067\u3059\u3002\n\n### VirtualDirectory\u30af\u30e9\u30b9\u306b\u3088\u308b\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u306e\u914d\u4fe1\n\n\u9759\u7684\u30d5\u30a1\u30a4\u30eb(JS/CSS/IMG)\u306e\u914d\u5e03\u306fNginx\u7b49\u306eWEB\u30b5\u30fc\u30d0\u30fc\u30ec\u30a4\u30e4\u3067\u884c\u3046\u5834\u5408\u306f\u5fc5\u8981\u306a\u3044\u306e\u3067\u3059\u304c\u3001\u3044\u3061\u3044\u3061\u305d\u3093\u306a\u306e\u8a2d\u5b9a\u3059\u3093\u306e\u9762\u5012\u304f\u3055\u304f\u3066\u3001Dart\u5074\u3067\u914d\u4fe1\u3059\u308b\u5834\u5408\u306b\u306fVirtualDirectory\u30af\u30e9\u30b9\u3092\u4f7f\u3046\u3068\u7c21\u5358\u306b\u914d\u4fe1\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```dart\nvar staticFiles = new VirtualDirectory(r\"web/assets\", pathPrefix: r\"/assets\")\n  ..followLinks = true\n  ..allowDirectoryListing = false\n  ..jailRoot = true;\nHttpServer.bind('0.0.0.0', 3000).then((HttpServer server) {\n  var router = new Router(server)\n    ..serve(new UrlPattern(r\"/assets/(.*)\"), method: \"GET\").listen(staticFiles.serveRequest)\n    ..serve(new UrlPattern(r\"/\"), method: \"GET\").listen(topPageHandler)\n    ..defaultStream.listen(notFoundHandler);\n});\n```\n\n\u3053\u306e\u4f8b\u3067\u306f\u3001`web/assets` \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4ee5\u4e0b\u306b\u5bfe\u3057\u3066 `/assets` \u304b\u3089\u59cb\u307e\u308bURL\u3067\u30a2\u30af\u30bb\u30b9\u304c\u3042\u3063\u305f\u5834\u5408\u306b\u3001`web/assets`\u4ee5\u4e0b\u306b\u304a\u3044\u3066\u3042\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u5e03\u3057\u307e\u3059\u3088\u3001\u3068\u3044\u3063\u305f\u8a2d\u5b9a\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u4f8b\u3048\u3070`web/assets/css/hoge.css`\u304c\u3042\u308b\u306e\u3067\u3042\u308c\u3070\u3001`/assets/css/hoge.css`\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001\u305d\u306eCSS\u30d5\u30a1\u30a4\u30eb\u304c\u30ec\u30b9\u30dd\u30f3\u30b9\u3055\u308c\u308b\u308f\u3051\u3067\u3059\u3002\n\n\u3053\u306eVirtualDirectory\u306b\u8a2d\u5b9a\u3059\u3079\u304d\u30d7\u30ed\u30d1\u30c6\u30a3\u304c3\u3064\u3042\u308a\u307e\u3059\u3002\n\n* followLinks (\u30c7\u30d5\u30a9\u30eb\u30c8:true)\n\t* symlink\u306b\u5bfe\u5fdc\u3059\u308b\u304b\u3069\u3046\u304b\n* allowDirectoryListing (\u30c7\u30d5\u30a9\u30eb\u30c8:false)\n\t* \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306eURL\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u5834\u5408\u306b\u306e\u4e2d\u8eab\u3092\u516c\u958b\u3059\u308b\u304b\u3069\u3046\u304b\n* jailRoot (\u30c7\u30d5\u30a9\u30eb\u30c8:true)\n\t* root\uff08\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u7b2c1\u5f15\u6570\u3067\u6307\u5b9a\u3057\u305f\u30d1\u30b9\uff09\u4ee5\u4e0b\u3067\u306f\u306a\u3044\u968e\u5c64\u306b\u3064\u3044\u3066\u306e\u30a2\u30af\u30bb\u30b9\u3092\u7981\u6b62\u3059\u308b\u304b\u3069\u3046\u304b\u3002true\u306e\u5834\u5408\u306f\u7981\u6b62\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u4f8b\u3048\u3070`web/assets/packages`\u304cweb\u3068\u540c\u968e\u5c64\u306e`packages`\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u306e\u30ea\u30f3\u30af\u306b\u306a\u3063\u3066\u3044\u308b\u5834\u5408\u3001\u5b9f\u4f53\u304croot\u4ee5\u4e0b\u3067\u306f\u306a\u3044\u306e\u3067\u3001`/assets/packages/*`\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3082Not Found\u3092\u8fd4\u3059\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u57fa\u672c\u7684\u306b\u306froot\u3088\u308a\u4e0a\u306e\u968e\u5c64\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3068\u3044\u3046\u306e\u306f\u5f80\u3005\u306b\u3057\u3066\u8106\u5f31\u6027\u3092\u751f\u307f\u3084\u3059\u3044\u306e\u3067\u3001\u57fa\u672c\u7684\u306b\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306e`true`\u306e\u307e\u307e\u306b\u3057\u3001root\u4ee5\u4e0b\u306b\u914d\u4fe1\u5bfe\u8c61\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8a2d\u7f6e\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002\u306a\u304a\u3001`followLinks`\u304c`false`\u306e\u5834\u5408\u3060\u3068\u3001\u305d\u3082\u305d\u3082\u4e0a\u306e\u968e\u5c64\u306b\u5bfe\u3059\u308b\u30ea\u30f3\u30af\u304c\u4f7f\u3048\u306a\u3044\u306e\u3067\u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306f\u610f\u5473\u306a\u3044\u3067\u3059\u3002\n\n\u3053\u308c\u30893\u3064\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u7528\u9014\u306b\u5408\u308f\u305b\u3066\u6b63\u3057\u304f\u8a2d\u5b9a\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\n### http_server\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u307e\u3068\u3081\n\n\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u4f7f\u308f\u306a\u3044\u5834\u5408\u306f\u3001http_server\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u7121\u3044\u3068\u3044\u308d\u3044\u308d\u3064\u3089\u3044\u3068\u601d\u3046\u306e\u3067\u3001\u3053\u3053\u306b\u66f8\u3044\u305f2\u3064\u304f\u3089\u3044\u306f\u4f7f\u3044\u65b9\u3092\u899a\u3048\u3066\u304a\u304f\u3068\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n## HttpResponse\u306eContentType\u306e\u8a2d\u5b9a\u65b9\u6cd5\n\n\u30ec\u30b9\u30dd\u30f3\u30b9\u306eContentType\u306e\u8a2d\u5b9a\u306b\u306f\u4ee5\u4e0b\u306e2\u3064\u306e\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u3002\n\n* `response.headers.contentType = ContentType.HTML`\n* `response.headers.add(HttpHeaders.CONTENT_TYPE, \"text/html\")`\n\n\u3069\u3061\u3089\u3082ContentType\u306b`text/html`\u3092\u8a2d\u5b9a\u3067\u304d\u308b\u306e\u3067\u3059\u304c\u3001\u57fa\u672c\u7684\u306b\u306f\u524d\u8005\u306e\u65b9\u6cd5\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u306a\u305c\u306a\u3089\u3001\u5f8c\u8005\u306e\u65b9\u6cd5\u306e\u5834\u5408\u6587\u5b57\u30b3\u30fc\u30c9\u304c`Latin 1`\u306b\u56fa\u5b9a\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n[`ContentType`\u30af\u30e9\u30b9](https://api.dartlang.org/apidocs/channels/stable/dartdoc-viewer/dart:io.ContentType)\u3092\u4f7f\u3046\u4e8b\u3067\u6587\u5b57\u30b3\u30fc\u30c9\u3092\u6307\u5b9a\u3059\u308b\u4e8b\u304c\u3067\u304d\u3001`ContentType.HTML`\u306a\u3069\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u5b9a\u6570\u3092\u5229\u7528\u3059\u308b\u4e8b\u3067UTF-8\u3092\u6307\u5b9a\u3067\u304d\u307e\u3059\u3002\n\n\u534a\u89d2\u82f1\u6570\u3057\u304b\u6271\u308f\u306a\u3044\u306e\u3067\u3042\u308c\u3070\u5f8c\u8005\u306e\u65b9\u6cd5\u3067\u3082\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u305d\u3093\u306a\u4e8b\u306f\u7121\u3044\u3068\u601d\u3046\u306e\u3067\u3001ContentType\u3092\u5229\u7528\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n## Completer\u8d85\u4fbf\u5229\n\n\u975e\u540c\u671f\u306e\u51e6\u7406\u3092\u6271\u3046\u306b\u3042\u305f\u308a\u3001Completer\u3092\u826f\u304f\u4f7f\u3044\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u3042\u308b\u30e1\u30bd\u30c3\u30c9\u304c\u8907\u6570\u306e\u975e\u540c\u671f\u51e6\u7406\u3092\u542b\u307f\u3001\u305d\u308c\u3089\u5168\u3066\u304c\u5b8c\u4e86\u3057\u305f\u5834\u5408\u306b\u7d50\u679c\u3092\u8fd4\u3059\u3088\u3046\u306a\u4e8b\u3092\u884c\u3044\u305f\u3044\u6642\u306b\u4fbf\u5229\u3067\u3059\u3002\n\n```dart\nimport \"dart:async\";\nimport \"dart:io\";\n\nclass FileReader {\n  static Future<String> read(String filePath) {\n    //\u51e6\u7406\u5b8c\u4e86\u3092\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3059\u308bCompleter\n    var completer = new Completer();\n    \n    var file = new File(filePath);\n    file\n      //\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3059\u308b\u304b\u3069\u3046\u304b\u306e\u78ba\u8a8d\u3092\u958b\u59cb\n      .exists()\n      //\u30d5\u30a1\u30a4\u30eb\u306e\u5b58\u5728\u78ba\u8a8d\u306e\u7d50\u679c\u3092\u53d7\u3051\u53d6\u308a\u3001\u5b58\u5728\u3059\u308b\u306a\u3089\u30b9\u30c6\u30fc\u30bf\u30b9\u53d6\u5f97\u3092\u958b\u59cb\n      .then((bool exists) => exists ? file.stat() : new Future.error(\"File not exists\"))\n      //\u30d5\u30a1\u30a4\u30eb\u304c\u30d5\u30a1\u30a4\u30eb\u306a\u306e\u304b\u3069\u3046\u304b\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\n      .then((FileStat stat) => stat.type == FileSystemEntityType.FILE ? file : new Future.error(\"File is not file\"))\n      //\u30d5\u30a1\u30a4\u30eb\u304c\u30d5\u30a1\u30a4\u30eb\u3060\u3063\u305f\u306a\u3089\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\u3092\u958b\u59cb\n      .then((File file) => file.readAsString())\n      //\u3053\u3053\u307e\u3067\u304d\u305f\u3063\u3066\u4e8b\u306f\u30d5\u30a1\u30a4\u30eb\u304c\u8aad\u307f\u8fbc\u3081\u305f\u306e\u3067complete\u3059\u308b\n      .then((String text) => completer.complete(text))\n      //\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u306fcompleteError\u3067\u30a8\u30e9\u30fc\u3092\u8fd4\u3059\n      .catchError((e) => completer.completeError(\"ReadFailed: ${e}\"));\n      \n    //\u8aad\u307f\u8fbc\u307f\u304c\u7d42\u308f\u308b\u304b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\u307e\u3067\u5f85\u3064future\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u8fd4\u3059\n    return completer.future;\n  }\n}\n\nvoid main() {\n  FileReader.read(\"/path/to/target.txt\").then((String text) => print(text));\n  //\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308c\u3070\u305d\u306e\u4e2d\u8eab\u306e\u6587\u5b57\u5217\u304c\u8868\u793a\u3055\u308c\u308b\n}\n```\n\n\u3053\u308c\u306f\u8d85\u9069\u5f53\u5b9f\u88c5\u306a\u30d5\u30a1\u30a4\u30eb\u30ea\u30fc\u30c0\u30fc\u306e\u5b9f\u88c5\u4f8b\u3067\u3059\u3002\n\n`read()`\u30e1\u30bd\u30c3\u30c9\u306b\u6e21\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u307f\u3001\u305d\u308c\u3092\u8868\u793a\u3057\u3066\u3044\u307e\u3059\u3002`read()`\u30e1\u30bd\u30c3\u30c9\u306f\u8fd4\u308a\u5024\u3068\u3057\u3066`Future<String>`\u3001\u3064\u307e\u308a\u975e\u540c\u671f\u306b\u6587\u5b57\u5217\u3092\u8fd4\u3059Future\u3092\u8fd4\u3057\u3066\u304a\u308a\u3001 **\u305d\u306e\u5b9f\u88c5\u306f`completer.future`\u306b\u306a\u3063\u3066\u3044\u307e\u3059** \u3002\n\n\u3053\u306e`read()`\u3067\u306f\u3001\u300c\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3059\u308b\u304b\u3069\u3046\u304b\u300d\u300c\u30d5\u30a1\u30a4\u30eb\u304c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3068\u304b\u3058\u3083\u306a\u304f\u3066\u30d5\u30a1\u30a4\u30eb\u304b\u3069\u3046\u304b\u300d\u300c\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\u300d\u3068\u3044\u30463\u3064\u306e\u975e\u540c\u671f\u51e6\u7406\u304c\u884c\u308f\u308c\u3066\u3044\u3066\u3001\u305d\u308c\u3089\u304c\u5b8c\u4e86\u3057\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u3088\u3046\u3084\u304f\u7d50\u679c\u306e\u5024\u3092\u8fd4\u305b\u308b\u72b6\u614b\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u3053\u306e\u3088\u3046\u306b\u3001\u8907\u6570\u306e\u975e\u540c\u671f\u51e6\u7406\u306e\u7d50\u679c\u3068\u3057\u3066\u3001\u975e\u540c\u671f\u51e6\u7406\u3092\u8fd4\u3057\u305f\u3044\u5834\u5408\u306bCompleter\u304c\u975e\u5e38\u306b\u6709\u7528\u3067\u3059\u3002\n\nCompleter\u3067\u4f7f\u3046\u6a5f\u80fd\u306f\n\n* future \u30d7\u30ed\u30d1\u30c6\u30a3\n* complete() \u30e1\u30bd\u30c3\u30c9\n* completeError() meso\u571f\n\n\u3053\u306e3\u3064\u3060\u3051\u3067\u3059\u3002\u5168\u7136\u96e3\u3057\u304f\u306a\u3044\u3002\nfuture\u30d7\u30ed\u30d1\u30c6\u30a3\u306f\u3001\u4eca\u56de\u306e\u4f8b\u306e\u3088\u3046\u306b\u30e1\u30bd\u30c3\u30c9\u3084\u95a2\u6570\u306e\u8fd4\u308a\u5024\u3068\u3057\u3066\u8fd4\u3057\u3066\u3042\u3052\u308b\u3088\u3046\u306a\u4f7f\u3044\u9053\u304c\u591a\u3044\u3067\u3059\u3002\u30e1\u30bd\u30c3\u30c9\u3084\u95a2\u6570\u3092\u5229\u7528\u3059\u308b\u5074\u304b\u3089\u3059\u308b\u3068\u5358\u306bFuture\u304c\u8fd4\u3063\u3066\u304f\u308b\u308f\u3051\u306a\u306e\u3067\u3001`.then()`\u3057\u3066\u3042\u3052\u308c\u3070\u3044\u3044\u308f\u3051\u3067\u3059\u3002\n\nCompleter\u3092\u4f7f\u3063\u305f\u95a2\u6570/\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u88c5\u3059\u308b\u5074\u306f\u3001\u3044\u304f\u3064\u304b\u306e\u975e\u540c\u671f\u51e6\u7406\u304c\u7d42\u308f\u3063\u3066\u3001\u7d50\u679c\u3092\u8fd4\u305b\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u6bb5\u968e\u3067`complete()`\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3076\u304b\u3001\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u306f`completeError()`\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3079\u3070\u3088\u304f\u3001\u7d50\u679c\u306e\u5024\u306f`complete()`\u306e\u7b2c1\u5f15\u6570\u306b\u6e21\u3057\u3066\u3042\u3052\u308c\u3070\u3001\u3061\u3083\u3093\u3068\u5229\u7528\u8005\u5074\u306e`.then()`\u306b\u305d\u306e\u7d50\u679c\u306e\u5024\u304c\u6e21\u308a\u307e\u3059\u3002\n\n### \u4f75\u305b\u3066\u4f7f\u3044\u305f\u3044Future.wait\n\n```dart\nclass FileReader {\n  static Future<String> read(String filePath) {\n    //\u3055\u3063\u304d\u3068\u4e00\u7dd2\u306a\u306e\u3067\u7701\u7565\n  }\n  static Future<String> readFiles(List<String> filePaths){\n    //completer\u3092\u7528\u610f\n    var completer = new Completer();\n    \n    //\u8907\u6570\u306eFuture\u3092\u683c\u7d0d\u3059\u308b\u305f\u3081\u306eList\u3092\u7528\u610f\n    List<Future<String>> waitList = [];\n    \n    //List\u306bFileReader.read\u306e\u8fd4\u308a\u5024\u306eFuture\u3092\u7a81\u3063\u8fbc\u3093\u3067\u304f\n    filePaths.forEach((String filePath){\n      waitList.add(FileReader.read(filePath));\n    });\n    \n    //Future.wait\u3067\u5168\u90e8\u8aad\u307f\u8fbc\u307f\u7d42\u308f\u308b\u307e\u3067\u5f85\u3063\u3066\u3001\u7d50\u679c\u304cList<String>\u3067\u6e21\u3063\u3066\u304f\u308b\u306e\u3067\u3001\n    //\u6e21\u3063\u3066\u304d\u305fList<String>\u3092\u7d50\u5408\u3057\u3066completer\u3067\u5b8c\u4e86\u3055\u305b\u308b\n    Future.wait(waitList).then((List<String> texts) => completer.complete(texts.join(\"\\n\")));\n    \n    //completer.future\u3092\u8fd4\u3057\u3066\u304a\u304f\n    return completer.future;\n  }\n}\n\nvoid main() {\n  //file1.txt\u3068file2.txt\u306e\u4e2d\u8eab\u304c\u7d50\u5408\u3055\u308c\u305f\u6587\u5b57\u5217\u304c\u8fd4\u3063\u3066\u304f\u308b\u306e\u3067print\u3059\u308b\n  FileReader.readFiles([\"/path/to/file1.txt\", \"/path/to/file2.txt\"]).then((String text) => print(text));\n}\n```\n\n\u3053\u306e\u3088\u3046\u306b\u3001\u8907\u6570\u306eFuture\u3092List\u306b\u7a81\u3063\u8fbc\u3093\u3067\u3001`Future.wait()`\u306b\u6e21\u3059\u4e8b\u3067\u3001List\u5185\u306e\u5168\u3066\u306eFuture\u304c\u5b8c\u4e86\u3057\u305f\u5834\u5408\u306b\u3001`Future.wait()`\u306e`.then()`\u304c\u5b9f\u884c\u3055\u308c\u308b\u3053\u308c\u307e\u305f\u4fbf\u5229\u306astatic\u30e1\u30bd\u30c3\u30c9\u3002\u3055\u3089\u306b\u3001\u7d50\u679c\u306e\u5024\u306f\u81ea\u52d5\u7684\u306bList\u306b\u683c\u7d0d(\u5909\u63db)\u3055\u308c\u3066\u6e21\u3063\u3066\u304f\u308b\u306e\u3067\u3001\u4e00\u6642\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u7a81\u3063\u8fbc\u3080\u51e6\u7406\u3092\u3057\u305f\u308a\u3059\u308b\u5fc5\u8981\u3082\u306a\u3044\u7d20\u6674\u3089\u3057\u3044\u3084\u3064\u3067\u3059\u3002\n\n### Completer\u307e\u3068\u3081\n\n`Completer`\u3068`Future.wait()`\u3092\u4f7f\u3046\u3060\u3051\u3067\u3001\u975e\u5e38\u306b\u7c21\u6f54\u306b\u3001\u7c21\u5358\u306b\u3001\u975e\u540c\u671f\u51e6\u7406\u306e\u300c\u5b8c\u4e86\u3057\u305f\u3089\u3053\u308c\u3092\u5b9f\u884c\u3059\u308b\u300d\u3092\u5b9f\u88c5\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\n\n\n## MapMixin\u8d85\u4fbf\u5229\n\n`dart:collection`\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u306f\u3001\u4fbf\u5229\u306aMixin\u304c\u3044\u304f\u3064\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u4eca\u56de\u306fMapMixin\u3092\u3054\u7d39\u4ecb\u3002\nMapMixin\u306f\u3001\u81ea\u4f5c\u306e\u30af\u30e9\u30b9\u3092Map\u3068\u3057\u3066\u6271\u3048\u308b\u3088\u3046\u306b\u3059\u308bMixin\u3067\u3059\u3002\n\n```dart\nimport \"dart:collection\";\n\nclass UserModel extends Object with MapMixin {\n  Map<String, Object> _properties = new Map<String, Object>();\n\n  UserModel([Map<String, Object> properties]) {\n    if (properties != null) {\n      this._properties.addAll(properties);\n    }\n  }\n  //\u4ee5\u4e0b\u306e2\u3064\u306eoperator, 1\u3064\u306egetter, 2\u3064\u306e\u30e1\u30bd\u30c3\u30c9\u304cMapMixin\u306b\u304a\u3044\u3066\u5fc5\u8981\u306a\u5b9f\u88c5\n  operator [](String key) => this._properties[key];\n  operator []=(String key, Object value) => this._properties[key] = value;\n  Iterable<String> get keys => this._properties.keys;\n  Object remove(String key) => this._properties.remove(key);\n  void clear() => this._properties.clear();\n}\n\nvoid main() {\n  var user = new UserModel({\"name\": \"takyam\", \"mail\": \"takyam@example.com\"});\n  user[\"age\"] = 30;\n  user.forEach((String key, Object value)=> print(\"${key}: ${value}\"));\n  // name: takyam\n  // mail: takyam@example.com\n  // age: 30\n}\n```\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306b\u3001\u30c7\u30fc\u30bf\u306e\u5b9f\u4f53\u306f\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u306a\u30e1\u30f3\u30d0\u5909\u6570(`_properties`)\u306b\u6301\u3061\u3064\u3064\u3001\u500b\u5225\u306bgetter/setter\u3092\u5b9a\u7fa9\u3057\u306a\u304f\u3066\u3082`user[\"name\"]`\u3084`user[\"age\"]`\u3068\u3044\u3063\u305f\u304b\u305f\u3061\u3067\u3001\u307e\u308b\u3067Map\u306e\u3088\u3046\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3057\u3001`user.forEach()`\u306e\u3088\u3046\u306aMap\u304c\u5099\u3048\u3066\u3044\u308b\u30e1\u30bd\u30c3\u30c9\u3082\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308b\u3002\u7d20\u6674\u3089\u3057\u3044\u3002\n\n\u3053\u306eMap\u306e\u3088\u3046\u306b\u6271\u3048\u308b\u3001\u3068\u3044\u3046\u306e\u306f\u30c7\u30fc\u30bf\u3092\u4fdd\u6301\u3057\u3066\u308bElement\u306b\u3068\u3063\u3066\u975e\u5e38\u306b\u91cd\u8981\u3067\u3001\u4f55\u304c\u91cd\u8981\u304b\u3068\u3044\u3046\u3068JSON\u306b\u5909\u63db\u3067\u304d\u308b\u3068\u3044\u3046\u30e1\u30ea\u30c3\u30c8\u304c\u3042\u308a\u307e\u3059\u3002\n\n```\nimport \"dart:convert\";\n//(\u7565)\nvar user1 = new UserModel({\"name\": \"user1\", \"age\":15});\nvar user2 = new UserModel({\"name\": \"user2\", \"age\":20});\nvar user3 = new UserModel({\"name\": \"user3\", \"age\":25});\nprint(JSON.encode([user1, user2, user3]));\n// [{\"name\":\"user1\",\"age\":15},{\"name\":\"user2\",\"age\":20},{\"name\":\"user3\",\"age\":25}]\n```\n\n`JSON.encode()`\u306f\u57fa\u672c\u7684\u306b\u306f`number`\u3001`boolean`\u3001`string`\u3001`null`\u3001`list`\u3001`String\u304c\u30ad\u30fc\u306eMap`\u306b\u3057\u304b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u305f\u3068\u3048\u3070MaMixin\u3092Mixin\u3057\u3066\u306a\u3044\u81ea\u4f5c\u30af\u30e9\u30b9\u3092`JSON.encode()`\u306b\u304b\u3051\u3088\u3046\u3068\u3059\u308b\u3068\u7b2c2\u5f15\u6570\u306e`toEncodable`\u306b\u5909\u63db\u7528\u306e\u30cf\u30f3\u30c9\u30e9\u3092\u5b9a\u7fa9\u3057\u305f\u308a\u3068\u3001\u4e2d\u3005\u306b\u9762\u5012\u304f\u3055\u3044\u308f\u3051\u3067\u3059\u3002\u305d\u308c\u304cMapMixin\u3067\uff08\u30ad\u30fc\u304cString\u3067\u3042\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u3059\u304c\uff09Map\u30e9\u30a4\u30af\u306b\u6271\u3048\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u4e8b\u3067\u3001JSON\u30a8\u30f3\u30b3\u30fc\u30c9\u6642\u3082\u7279\u306b\u7d30\u304b\u3044\u4e8b\u3092\u6c17\u306b\u305b\u305a\u306b\u6e08\u3080\u308f\u3051\u3067\u3059\u3002\u3053\u308c\u306f\u4fbf\u5229\u3067\u3059\u3002\n\n### \u767a\u5c55\u5f62\uff1a`.\u30d7\u30ed\u30d1\u30c6\u30a3\u540d`\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u3044\n\n\u524d\u8ff0\u306eUserModel\u30af\u30e9\u30b9\u3092\u3061\u3087\u3063\u3068\u62e1\u5f35\u3057\u3066`.\u30d7\u30ed\u30d1\u30c6\u30a3\u540d`\u3067\u306e\u30a2\u30af\u30bb\u30b9\u3092\u53ef\u80fd\u306b\u3059\u308b\u4e8b\u3082\u3067\u304d\u307e\u3059\u3002\n\n```dart\nimport \"dart:mirrors\";\n//(\u7565)\nclass UserModel extends Object with MapMixin {\n  //\u524d\u8ff0\u306e\u5b9f\u88c5\u3068\u5168\u304f\u4e00\u7dd2\u306a\u306e\u3067\u7701\u7565\n  Object noSuchMethod(Invocation invocation) {\n    if (invocation.isAccessor) { // getter or setter \u306e\u5834\u5408\n      // \u30d7\u30ed\u30d1\u30c6\u30a3\u540d\u3092String\u3067\u53d6\u5f97\n      String accessKey = MirrorSystem.getName(invocation.memberName);\n      if (invocation.isGetter && this.containsKey(accessKey)) {\n        // Getter\u306e\u5834\u5408\u306f\u30ad\u30fc\u304c\u5b58\u5728\u3059\u308c\u3070\u305d\u308c\u3092\u8fd4\u3059\n        return this[accessKey];\n      } else if (invocation.isSetter && invocation.positionalArguments.length == 1) {\n        // Setter\u306e\u5834\u5408\u306f\u5024\u3092\u30bb\u30c3\u30c8\uff08Setter\u306e\u5834\u5408\u306f\u30ad\u30fc\u306e\u672b\u5c3e\u306b\u300c=\u300d\u304c\u3064\u3044\u3066\u308b\u306e\u3067\u6ce8\u610f\uff09\n        return this[accessKey.replaceAll(\"=\", \"\")] = invocation.positionalArguments[0];\n      }\n    }\n    //super\u306b\u6295\u3052\u308c\u3070\u5927\u4f53 NoSuchMethodError \u304c\u51fa\u308b\u306f\u305a\n    return super.noSuchMethod(invocation);\n  }\n}\n```\n\n`noSuchMethod`\u3092\u5b9a\u7fa9\u3059\u308b\u4e8b\u3067\u3001\u4f8b\u3048\u3070\u3053\u306eUserModel\u306e\u5834\u5408`print(user.name);`\u3084`user.age = 30;`\u3068\u3044\u3063\u305f\u5f62\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u306f\u30b3\u30ec\u3067\u304b\u3063\u3053\u3044\u3044\u3067\u3059\u3057\u4fbf\u5229\u306a\u306e\u3067\u3059\u304c\u3001Symbol\u3092String\u306b\u5909\u63db\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u4e8b\u304b\u3089\u3001\u3069\u3046\u3057\u3066\u3082Mirros\u304c\u5fc5\u8981\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u500b\u4eba\u7684\u306b\u306f\u3042\u307e\u308a\u3053\u3053\u307e\u3067\u3059\u308b\u5fc5\u8981\u306f\u7121\u3044\u3068\u601d\u3063\u3066\u307e\u3059\u3002\u6d41\u77f3\u306b\u30e1\u30bf\u30e1\u30bf\u3057\u3043\u3067\u3059\u3057\u3002\n\n### MapMixin\u307e\u3068\u3081\n\n\u8d85\u4fbf\u5229\u306a\u306e\u3067\u3001MapMixin\u306b\u5fc5\u8981\u306a\u5b9f\u88c5`[]`,`[]=`,`remove`,`clear`,`keys`\u306e5\u3064\u306f\u30bd\u30e9\u3067\u8a00\u3048\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\u305d\u3057\u3066`.`\u30d7\u30ed\u30d1\u30c6\u30a3\u30a2\u30af\u30bb\u30b9\u306f\u3084\u308a\u3059\u304e\u3060\u3068\u601d\u3046\u3002\u304b\u3063\u3053\u3044\u3044\u3051\u3069\u3002\n\n## StreamController\u8d85\u4fbf\u5229\n\nStream\u3092\u6271\u3046\u30af\u30e9\u30b9\u3092\u4f5c\u308b\u5834\u5408\u3001Stream\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5916\u90e8\u306b\u516c\u958b\u3057\u305f\u3044\u4e8b\u304c\u3042\u308a\u307e\u3059\u3002\n\n> **\u6ce8\u610f**: \u4ee5\u4e0b`Message`\u30af\u30e9\u30b9\u304c\u767b\u5834\u3057\u307e\u3059\u304c\u3001\u3053\u308c\u306f\u30aa\u30ec\u30aa\u30ec\u30e1\u30c3\u30bb\u30fc\u30b8\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3067\u3001\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u3068\u306e\u3084\u308a\u3068\u308a\u306b\u304a\u3044\u3066\u5171\u901a\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3067JSON\u3092encode/decode\u3059\u308b\u305f\u3081\u306e\u30af\u30e9\u30b9\u3067\u3059\u3002\u7279\u306b\u8a71\u306e\u672c\u6d41\u3068\u306f\u95a2\u4fc2\u306a\u3044\u306e\u3067\u305d\u3046\u3044\u3046\u3082\u3093\u3060\u3068\u601d\u3063\u3066\u304a\u3044\u3066\u3082\u3089\u3048\u308c\u3070\u3002\n\n```dart\nclass WebSocketStream {\n  final String _url = \"ws://${Uri.base.host}:${Uri.base.port}/ws\";\n  WebSocket _ws;\n  bool _encounteredError = false;\n  int _retryWaitSeconds = 1;\n  \n  //onMessage\u7528\u306eStreamController\n  StreamController<Message> _onMessageStream = new StreamController<Message>.broadcast();\n\n  WebSocketStream() {\n    this._initialize();\n  }\n\n  //WebSocket\u63a5\u7d9a\u306e\u521d\u671f\u5316\n  void _initialize() {\n    //\u518d\u63a5\u7d9a\u7528\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u30ea\u30bb\u30c3\u30c8\n    this._encounteredError = false;\n    this._retryWaitSeconds *= 2;\n    //WebSocket\u63a5\u7d9a\u3057\u3066\u5404Stream\u306b\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u3092\u767b\u9332\n    this._ws = new WebSocket(this._url)\n      ..onOpen.listen(this._onOpen)\n      ..onClose.listen(this._onClose)\n      ..onError.listen(this._onError)\n      ..onMessage.listen(this._onMessage);\n  }\n\n  //\u5404Stream\u306eGetter\n  Stream<Event> get onOpen => this._ws.onOpen;\n  Stream<CloseEvent> get onClose => this._ws.onClose;\n  Stream<Event> get onError => this._ws.onError;\n  Stream<Message> get onMessage => this._onMessageStream.stream;\n\n  //\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u30b5\u30fc\u30d0\u30fc\u306bPush\u3059\u308b\u30e1\u30bd\u30c3\u30c9\n  void send(Message message) => this._ws.send(message.toJson());\n  \n  //\u5404\u30a4\u30d9\u30f3\u30c8\u767a\u751f\u6642\u306e\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\n  void _onOpen(Event event) => print(\"connected!\");\n  void _onClose(CloseEvent event) => this._reconnect();\n  void _onError(Event event) => this._reconnect();\n\n  //\u518d\u63a5\u7d9a\u51e6\u7406\n  void _reconnect() {\n    if (!this._encounteredError) {\n      new Timer(new Duration(seconds: this._retryWaitSeconds), () => this._initialize());\n    }\n    this._encounteredError = true;\n  }\n\n  //\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1\u6642\u306e\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\n  void _onMessage(MessageEvent event) {\n    try {\n      //\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u53d7\u3051\u53d6\u3063\u305fJSON\u3092Message\u306b\u5909\u63db\u3057\u3066\u5916\u90e8\u516c\u958b\u7528Stream\u306b\u6d41\u3059\n      var message = new Message.fromJson(event.data);\n      this._onMessageStream.add(message);\n    } catch (e) {\n      //do nothing\n    }\n  }\n}\n```\n\u3053\u308c\u306f\u5b9f\u969b\u306b\u4eca\u56de\u4f5c\u6210\u3057\u305f\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u306eWebSocket\u306e\u63a5\u7d9a\u7ba1\u7406\u7528\u306e\u30e9\u30c3\u30d1\u30fc\u30af\u30e9\u30b9\u3067\u3059\u3002\n\u5b9f\u88c5\u306f[\u3053\u3061\u3089\u306e\u8a18\u4e8b](http://blog.sethladd.com/2012/07/simple-dart-websocket-demo.html)\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u6a5f\u80fd\u306f\u4ee5\u4e0b\u306e2\u3064\u3067\u3059\u3002\n\n* \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u5207\u65ad\u6642\u306e\u518d\u63a5\u7d9a\u51e6\u7406\n* \u30b5\u30fc\u30d0\u30fc\u304b\u3089Push\u3055\u308c\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092Message\u30af\u30e9\u30b9\uff08\u4eca\u56de\u81ea\u4f5c\u3057\u305f\u30af\u30e9\u30b9\uff09\u306b\u5909\u63db\u3059\u308b\n\n\u4eca\u56de\u91cd\u8981\u306a\u306e\u306f\u3001\n\n```dart\nStreamController<Message> _onMessageStream = new StreamController<Message>.broadcast();\nStream<Message> get onMessage => this._onMessageStream.stream;\nthis._onMessageStream.add(message);\n```\n\n\u3053\u306e3\u884c\u3067\u3001StreamController\u3092\u4f5c\u6210\u3057\u3066\u304a\u304d\u3001getter\u3067\u5916\u90e8\u306bStream\u3092\u516c\u958b\u3057\u3001\u5185\u90e8\u3067`.add()`\u3059\u308b\u4e8b\u3067\u5916\u90e8\u306b\u4f1d\u642c\u3055\u305b\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\n\u3053\u306e\u30af\u30e9\u30b9\u3092\u6271\u3046\u5074\u306f\u3001\n\n```dart\nnew WebSocketSteram()\n  ..onMessage.listen((Message message)=> print(message));\n```\n\n\u306e\u3088\u3046\u306b\u3001\u672c\u6765`.listen((Event event) => do something...)`\u306e\u3068\u3053\u308d\u3092\u5909\u63db\u3057\u305fMessage\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u53d7\u3051\u53d6\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u3088\u3046\u306b\u3001Stream\u3092\u5916\u90e8\u306b\u516c\u958b\u3057\u305f\u3044\u5834\u5408\u306b\u975e\u5e38\u306b\u4fbf\u5229\u3067\u3059\u3002\n\n\u3042\u3068\u3001\u4eca\u66f8\u3044\u3066\u3066\u601d\u3044\u307e\u3057\u305f\u304c\u3001\u4eca\u56de\u306e\u30b1\u30fc\u30b9\u3067\u306fStreamController\u3092\u4f5c\u3089\u305a\u306b\u3001StreamTransformer\u3067\u5b9f\u88c5\u3057\u305f\u307b\u3046\u304c\u826f\u3055\u305d\u3046\u3060\u3068\u306f\u601d\u3044\u307e\u3059\u3002\n\n```dart\nStream<Message> get onMessage => this._ws.onMessage.transform(new StreamTransformer<MessageEvent, Message>.fromHandlers(\n  handleData: (MessageEvent event, EventSink<Message> sink) {\n    try {\n      var message = new Message.fromJson(event.data);\n      sink.add(message);\n    } catch (e) {\n      //do nothing\n    }\n  }\n));\n```\n\n\u8a66\u3057\u3066\u306a\u3044\u3051\u3069\u305f\u3076\u3093\u3053\u3093\u306a\u611f\u3058\u3067\u52d5\u304f\u306f\u305a\u3002\n\n### StreamController\u307e\u3068\u3081\n\n\u5916\u90e8\u306bStream\u3092\u516c\u958b\u3057\u305f\u3044\u5834\u5408\u306b\u3001\u975e\u5e38\u306b\u7c21\u5358\u306b\u5b9f\u88c5\u3067\u304d\u308b\u306e\u3067\u4fbf\u5229\u3002\n\u30dd\u30a4\u30f3\u30c8\u306f\u4f5c\u6210\u3057\u305fStreamController\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e`.stream`\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u516c\u958b\u3059\u308b\u4e8b\u3002\n\u305d\u308c\u3060\u3051\u3067\u5916\u90e8\u3067\u306f\u7d30\u304b\u3044\u4e8b\u304d\u306b\u305b\u305a\u306b`.listen()`\u3059\u308a\u3083\u3044\u3044\u3060\u3051\u306a\u306e\u3067\u975e\u5e38\u306b\u4fbf\u5229\u3067\u3059\u3002\n\n\u305d\u3057\u3066\u4eca\u56de\u306e\u5b9f\u88c5\u3067\u306f\u7279\u306b\u4f7f\u3046\u5fc5\u8981\u304c\u7121\u3044\u3053\u3068\u306b\u6c17\u3065\u3044\u305f\u3002\u60b2\u3057\u3044\u3002\n\n## WebSocket\u306ebroadcast\u3092\u3059\u308b\u65b9\u6cd5\n\nWebsocket\u3067\u3001\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u304b\u3089\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u306bPush\u901a\u77e5\u3092\u9001\u308b\u5834\u5408\u3001\u500b\u4eba\u500b\u4eba\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u6bce\u306bPush\u3059\u308b\u5834\u5408\u306f`ws.send()`\u3059\u308c\u3070\u826f\u3044\u3060\u3051\u306a\u306e\u3067\u7c21\u5358\u3067\u3059\u304c\u3001\u63a5\u7d9a\u4e2d\u306e\u5168\u30e6\u30fc\u30b6\u30fc\u306b\u5bfe\u3057\u3066broadcast\u3057\u305f\u3044\u5834\u5408\u3001\u6a19\u6e96\u3067\u305d\u3046\u3044\u3063\u305f\u6a5f\u80fd\u306f\u63d0\u4f9b\u3055\u308c\u3066\u3044\u306a\u3044\u3088\u3046\u306a\u306e\u3067\u3001\u63a5\u7d9a\u7ba1\u7406\u3068\u30d6\u30ed\u30fc\u30c9\u30ad\u30e3\u30b9\u30c8\u90e8\u5206\u3092\u81ea\u5206\u3067\u5b9f\u88c5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```dart\nimport \"dart:io\";\nimport \"message.dart\"; //\u30aa\u30ec\u30aa\u30ec\u30e1\u30c3\u30bb\u30fc\u30b8\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306eMessage\u30af\u30e9\u30b9\n\nclass WebSocketConnectionsHandler {\n  static Set<WebSocket> _connections = new Set<WebSocket>();\n  static add(WebSocket socket) {\n    _connections.add(socket);\n    //\u5207\u65ad\u6642\u306b\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30ea\u30b9\u30c8\u304b\u3089\u524a\u9664\u3059\u308b\n    socket.done.then((_) => remove(socket));\n  }\n  static remove(WebSocket socket) {\n    _connections.remove(socket);\n  }\n  static broadcast(Message message) {\n    _connections\n    .where((WebSocket socket) => socket.readyState == WebSocket.OPEN)\n    .forEach((WebSocket socket) => socket.add(message.toJson()));\n  }\n}\n```\n\n\u9069\u5f53\u306b\u3053\u3093\u306a\u611f\u3058\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3092\u7ba1\u7406\u3059\u308b\u30af\u30e9\u30b9\u3092\u7528\u610f\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u3093\u3067\u3082\u3063\u3066\u3001\n\n```dart\n..serve(new UrlPattern(r\"/ws\")).transform(new WebSocketTransformer()).listen((WebSocket socket) {\n  WebSocketConnectionsHandler.add(socket);\n  //do something\n});\n```\n\n\u307f\u305f\u3044\u306b\u63a5\u7d9a\u6642\u70b9\u3067\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30ea\u30b9\u30c8\u306b\u8ffd\u52a0\u3057\u3066\u304a\u3044\u3066\u3042\u3052\u307e\u3059\u3002\n\u30dd\u30a4\u30f3\u30c8\u306f\u3001`socket.done.then((_) => remove(socket));` \u306e\u90e8\u5206\u3067\u3001\u30bd\u30b1\u30c3\u30c8\u304c\u5207\u65ad\u3055\u308c\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3092`done`Future\u304b\u3089\u53d6\u5f97\u3057\u3001\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30ea\u30b9\u30c8\u304b\u3089\u9664\u5916\u3057\u3066\u304a\u304f\u4e8b\u3067\u3059\u3002\n\u3053\u306e\u4e0a\u3067\u3001\u30d6\u30ed\u30fc\u30c9\u30ad\u30e3\u30b9\u30c8\u3059\u308b\u6642\u306f\u3001\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30ea\u30b9\u30c8\u306e\u4e2d\u304b\u3089`readyState`\u304c`OPEN`\u306e\u3082\u306e\u306b\u3064\u3044\u3066`forEach`\u3067`socket.add`\u3059\u308b\u4e8b\u3067\u3001\u30d6\u30ed\u30fc\u30c9\u30ad\u30e3\u30b9\u30c8\u3092\u884c\u3046\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\n\n### broadcast\u307e\u3068\u3081\n\n\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u308f\u306a\u3044\u5834\u5408\u3001\u81ea\u5206\u3067\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3092\u7ba1\u7406\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u305f\u3076\u3093\u3002\n\u5b9f\u969b\u306b\u306fWebsocket\u975e\u5bfe\u5fdc\u30d6\u30e9\u30a6\u30b6\u7528\u306b\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u306a\u3044\u3057\u30c0\u30a6\u30f3\u30b0\u30ec\u30fc\u30c9\u7684\u306a\u5bfe\u5fdc\u304c\u5fc5\u8981\u306b\u306a\u308b\u3068\u601d\u3046\u306e\u3067\u3001NodeJS\u3067\u8a00\u3046\u3068\u3053\u308d\u306eSocket.IO\u7684\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u63a2\u3057\u3066\u4f7f\u3063\u305f\u307b\u3046\u304c\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\n## const\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092static final\u5b9a\u6570\u3067\u6301\u3064\n\n\u524d\u8ff0\u306eContentType\u30af\u30e9\u30b9\u3067\u3084\u3063\u3066\u308b\u30c6\u30af\u30cb\u30c3\u30af\u306a\u3093\u3067\u3059\u304c\u3001\u8907\u6570\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u304b\u3089\u306a\u308b\u5b9a\u6570\u306fstatic final\u5909\u6570\u3067\u5b9a\u7fa9\u3057\u3066\u304a\u304f\u3068\u3044\u3046\u30c6\u30af\u30cb\u30c3\u30af\u3067\u3059\u3002\nContentType\u306f`Content-type: text/html; charset=UTF-8`\u306e\u3088\u3046\u306b`$primaryType/$subType; charset=$charset`\u3068\u3044\u3046\uff13\u3064\u306e\u8981\u7d20\u304b\u3089\u6210\u308a\u7acb\u3063\u3066\u3044\u307e\u3059\u3002\u3068\u306f\u3044\u3048\u826f\u304f\u4f7f\u3046\u5b9a\u7fa9\u306b\u3064\u3044\u3066\u306f\u5b9a\u6570\u3068\u3057\u3066\u4fdd\u6301\u3057\u3066\u304a\u304d\u305f\u3044\u306e\u3067\u3001\u305d\u306e\u305f\u3081\u306bstatic final\u5909\u6570\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\n```dart:ContetType\u30af\u30e9\u30b9\u306e\u5b9f\u88c5\u306e\u629c\u7c8b\nabstract class ContentType implements HeaderValue {\n  static final TEXT = new ContentType(\"text\", \"plain\", charset: \"utf-8\");\n  static final HTML = new ContentType(\"text\", \"html\", charset: \"utf-8\");\n  static final JSON = new ContentType(\"application\", \"json\", charset: \"utf-8\");\n  static final BINARY = new ContentType(\"application\", \"octet-stream\");\n  factory ContentType(String primaryType, String subType, {String charset, Map<String, String> parameters}) {\n    return new _ContentType(primaryType, subType, charset, parameters);\n  }\n}\n```\n\n[\u5b9f\u969b\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u3053\u3061\u3089](https://code.google.com/p/dart/source/browse/branches/bleeding_edge/dart/sdk/lib/io/http.dart?r=41936#715)\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\n\u3053\u3046\u3044\u3046\u98a8\u306b\u5b9f\u88c5\u3057\u3066\u3042\u308b\u306e\u3067\u3001\u5229\u7528\u3059\u308b\u5834\u5408\u306f`ContentType.HTML`\u3068\u3059\u308b\u3060\u3051\u3067\u826f\u3044\u308f\u3051\u3067\u3059\u3002\n\u3053\u306e\u3088\u3046\u306b`\u25ef\u25efType`\u30af\u30e9\u30b9\u3092\u5b9f\u88c5\u3057\u3066\u3001static final\u5909\u6570\u306b\u5b9a\u6570(\u306e\u3088\u3046\u306a\u30e2\u30ce)\u3092\u5b9a\u7fa9\u3057\u3066\u304a\u304f\u30c6\u30af\u30cb\u30c3\u30af\u306f\u5e83\u304f\u4f7f\u3044\u9053\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n## \u3042\u3068\u304c\u304d\n\n`Future`\u3084`Stream`\u5468\u308a\u306e\u51e6\u7406\u3092\u30ad\u30e1\u308b\u3068\u304b\u306a\u308a\u6c17\u6301\u3061\u3088\u3044\u3067\u3059\u306d\u3002\u4f55\u304b\u300c\u4ffa\u306fDart\u3057\u3066\u308b\u3093\u3060\u305e\u304a\u3049\u3049\u300d\u3068\u3044\u3046\u611f\u3058\u304c\u3057\u3066\u3002\n\n\u305d\u308c\u306f\u305d\u308c\u3068\u3057\u3066\u3001Dart\u306e\u30b3\u30a2\u7cfb\u306e\u30d1\u30c3\u30b1\u30fc\u30b8(`dart:io`\u3068\u304b`dart:async`\u3068\u304b\uff09\u306fDart\u3067\u5b9f\u88c5\u3055\u308c\u3066\u308b\u90e8\u5206\u3082\u304b\u306a\u308a\u591a\u304f\u3001\u4f7f\u3044\u65b9\u304c\u5206\u304b\u3089\u306a\u3044\u90e8\u5206\u3082\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u898b\u308c\u3070\u3042\u308b\u7a0b\u5ea6\u7406\u89e3\u3067\u304d\u308b\u306e\u3067\u697d\u3061\u3093\u3067\u3059\u3002\u5229\u7528\u65b9\u6cd5\u3092\u30b0\u30b0\u308b\u3088\u308a\u3082\u30bd\u30fc\u30b9\u898b\u305f\u307b\u3046\u304c\u65e9\u3044\u4e8b\u3082\u3061\u3089\u307b\u3089\u3002\u5b9f\u969b\u306eDartTeam\u306b\u3088\u308b\u5b9f\u88c5\u3092\u898b\u308b\u3068\u3044\u3046\u610f\u5473\u306b\u304a\u3044\u3066\u3082\u975e\u5e38\u306b\u52c9\u5f37\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n\u3068\u3044\u3046\u308f\u3051\u3067\u3001\u4eca\u56de\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u4f7f\u308f\u305a\u306b\u30a2\u30d7\u30ea\u3092\u5b9f\u88c5\u3057\u3066\u307f\u305f\u308f\u3051\u3067\u3059\u304c\u3001\u958b\u767a\u52b9\u7387\u3068\u304b\u51fa\u6765\u4e0a\u304c\u308a\u306e\u7f8e\u3057\u3055\u3068\u304bGood\u306a\u8a2d\u8a08\u601d\u60f3\u3068\u304b\u305d\u3046\u3044\u3046\u306e\u3068\u306f\u7121\u7e01\u306a\u7cde\u304c\u51fa\u6765\u305f\u3082\u306e\u306e\u3001\u5f97\u3089\u308c\u305f\u77e5\u898b\u306f\u3044\u308d\u3044\u308d\u3068\u5927\u304d\u3044\u3082\u306e\u3067\u3057\u305f\u3002\u3084\u306f\u308a\u3001\u81ea\u5206\u3067\u30ac\u30ea\u30ac\u30ea\u3068\u66f8\u3044\u3066\u3044\u304b\u306a\u3044\u3068\u7d30\u304b\u3044\u3068\u3053\u308d\u3067\u7406\u89e3\u3067\u304d\u3066\u306a\u304b\u3063\u305f\u3068\u3053\u308d\u3082\u305f\u304f\u3055\u3093\u3042\u308a\u3001\u30cf\u30de\u308a\u3064\u3064\u30b3\u30b1\u3064\u3064\u3068\u308a\u3042\u3048\u305a\u5b9f\u88c5\u3067\u304d\u307e\u3057\u305f\u3002\u3088\u304b\u3063\u305f\u3002\n\nRails\u306e\u3088\u3046\u306a\u30d5\u30eb\u30b9\u30bf\u30c3\u30af\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u304c\u5b58\u5728\u305b\u305a\u3001\u3069\u3046\u3044\u3063\u305f\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3060\u3068Dart\u306b\u5411\u3044\u3066\u308b\u306e\u304b\u3001\u307f\u305f\u3044\u306a\u3068\u3053\u308d\u306e\u7406\u60f3\u578b\u306e\u30a4\u30e1\u30fc\u30b8\u3082\u3042\u307e\u308a\u6301\u3066\u3066\u306a\u3044\u306e\u3067\u3059\u304c\u3001\u305d\u3046\u3044\u3046\u306e\u304c\u767b\u5834\u3059\u308b\u307e\u3067\u306f\u3001\u30de\u30a4\u30af\u30ed\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u30b4\u30ea\u30b4\u30ea\u3068\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u3066\u3044\u304f\u3057\u304b\u306a\u3044\u3068\u601d\u3046\u306e\u3067\u3001\u3053\u3046\u3044\u3063\u305f\u57fa\u790e\u7684\u306a\u77e5\u898b\u3068\u3044\u3046\u306e\u306f\u4f55\u3089\u304b\u306e\u5f79\u306b\u7acb\u3064\u306e\u3067\u306f\u306a\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u3055\u3066\u3001\u3082\u30462014\u5e74\u3082\u7d42\u308f\u308a\u3067\u3059\u30022015\u5e74\u306f\u7acb\u6d3e\u306aDartisans\uff08Dart\u30e6\u30fc\u30b6\u30fc\u306e\u4e8b\uff09\u306b\u306a\u308c\u308b\u3088\u3046\u7cbe\u9032\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u305d\u308c\u3067\u306f\u3001\u826f\u3044\u304a\u5e74\u3092\u3002\n", "tags": ["Dart"]}