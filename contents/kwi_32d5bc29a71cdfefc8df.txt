{"context": " More than 1 year has passed since last update.Ubuntu(debian) \u306e /etc/network/interfaces \u3067 openvswitch \u306e bridge \u3084 port \u3082\u8a2d\u5b9a\u3067\u304d\u308b\u3089\u3057\u3044\u3053\u3068\u304c /usr/share/doc/openvswitch-switch/README.Debian \u306b\u66f8\u3044\u3066\u3042\u308b\u3002\n\n/etc/network/interfaces\nallow-ovs br1\niface br1 inet manual\n  ovs_type OVSBridge\n  ovs_ports p5p1\n\n\n\u3057\u304b\u3057\u52d5\u304b\u306a\u3044\uff01\u4f55\u304c\u8d77\u3053\u3063\u3066\u3044\u308b\u306e\u304b\uff1f\n\u307e\u305a allow-ovs \u3068\u3044\u3046\u306e\u306f\u3001openvswitch \u306e daemon \u985e\u304c\u8d77\u52d5\u3057\u305f\u5f8c\u306b ifup --allow ovs br1 \u3068\u547c\u3073\u51fa\u3057\u3066\u3082\u3089\u3046\u305f\u3081\u306b\u66f8\u3044\u3066\u3042\u308b\u3002openvswitch \u306e daemon \u985e\u304c\u8d77\u52d5\u3059\u308b\u305f\u3081\u306b\u306f\u3001ovsdb \u304c\u5229\u7528\u53ef\u80fd\u306b\u306a\u3089\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3002\u3064\u307e\u308a\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u304c\u7528\u610f\u3067\u304d\u305f\u5f8c\u3067\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3002\u3068\u3044\u3046\u308f\u3051\u3067 auto \u3067\u306a\u304f allow-ovs \u3068\u306a\u3063\u3066\u3044\u308b\u306e\u306f\u3001\u8d77\u52d5\u9806\u3092\u305d\u3053\u307e\u3067\u9045\u5ef6\u3055\u305b\u308b\u305f\u3081\u306e\u3088\u3046\u3060\u3002\nifup --allow ovs br1 \u3092\u547c\u3076\u306e\u306f\u3001openvswitch \u306e\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3042\u308b\u306f\u305a\u3060\u3063\u305f\u3002\n\u3068\u3053\u308d\u304c Upstart \u3078\u306e\u79fb\u884c\u306e\u6df7\u4e71\u306b\u7d1b\u308c\u3066\u3001\u73fe\u5728 openvswitch \u306e\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u4e8c\u7a2e\u985e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u3002\u3072\u3068\u3064\u306f /etc/init/openvswitch-switch.conf \u3067\u3001\u3082\u3046\u4e00\u3064\u306f /etc/init.d/openvswitch-switch \u306b\u306a\u3063\u3066\u3044\u308b\u3002\u5f8c\u8005\u306f\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u306a\u3044\uff08/etc/rc.N \u304b\u3089 symlink \u304c\u5f35\u3089\u308c\u3066\u3044\u306a\u3044\uff09\u3002\u6709\u52b9\u306a\u307b\u3046\u306e /etc/init/openvswitch-switch.conf \u3092\u4f7f\u3063\u3066 openvswitch daemon \u306f\u8d77\u52d5\u3059\u308b\u3002\u3084\u3084\u3053\u3057\u3044\u3053\u3068\u306b\u3001/etc/init.d/openvswitch-switch \u306f ifup --allow ovs {bridges} \u3092\u547c\u3073\u51fa\u3059\u304c\u3001/etc/init/openvswitch-switch.conf \u3067\u306f\u305d\u306e\u90e8\u5206\u304c\u629c\u3051\u843d\u3061\u3066\u3044\u308b\u3002\n\u3064\u307e\u308a ifup --allow ovs br1 \u306f\u7d50\u5c40\u547c\u3073\u51fa\u3055\u308c\u306a\u3044\u3002\u3088\u3063\u3066\u52d5\u304b\u306a\u3044\uff01\u3068\u3044\u3046\u308f\u3051\u3060\u3063\u305f\u3002\u3084\u308b\u3084\u308b\u8a50\u6b3a\u72b6\u614b\u3002\n\nWorkaround 1\n/etc/init.d/openvswitch-switch \u3092\u4f7f\u3044\u3001/etc/init/openvswitch-switch.conf \u3092\u7121\u52b9\u5316\u3059\u308b\u3002\u305b\u3063\u304b\u304f Upstart \u306b\u79fb\u884c\u3057\u305f\u306e\u306b\u2026\u3068\u3044\u3046\u611f\u3092\u62ed\u3048\u306a\u3044\u3002\n\nWorkaround 2\n/etc/init/openvswitch-switch.conf \u3092\u4fee\u6b63\u3059\u308b\u3002\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3068\u30de\u30fc\u30af\u3055\u308c\u3066\u3044\u306a\u3044\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304d\u63db\u3048\u308b\u306e\u304c\u96e3\u70b9\u3002\n--- /etc/init/openvswitch-switch.conf   2014-01-20 21:30:49.000000000 +0900\n+++ /tmp/openvswitch-switch.conf        2014-05-01 10:21:39.249793837 +0900\n@@ -32,11 +32,13 @@\n   fi\n   set \"$@\" $OVS_CTL_OPTS\n   \"$@\"\n+  ifup --allow ovs `ifquery --allow ovs --list`\n end script\n\n post-stop script\n   . /usr/share/openvswitch/scripts/ovs-lib\n   test -e /etc/default/openvswitch-switch && . /etc/default/openvswitch-switch\n\n+  ifdown --allow ovs `ifquery --allow ovs --list`\n   ovs_ctl stop\n end script\n\n\nWorkaround 3\n/etc/network/interfaces \u306b\u66f8\u304f\u306e\u3092\u8ae6\u3081\u308b\u3002/etc/rc.local \u306b\u3084\u308a\u305f\u3044\u3053\u3068\u3092\u66f8\u304f\u3002workaround \u3068\u3057\u3066\u306f\u6700\u3082\u7b4b\u304c\u826f\u3044\u304c\u3001\u3053\u3061\u3089\u3082\u975e Upstart \u7684\u306a\u6d41\u5100\u306a\u306e\u304c\u30a4\u30de\u30a4\u30c1\u3002\n\nWorkaround 4\n/etc/network/interfaces \u306b\u66f8\u304f\u306e\u3092\u8ae6\u3081\u308b\u3002openvswitch \u8d77\u52d5\u6642\u306b Upstart \u306e\u30a4\u30d9\u30f3\u30c8\u3092\u6295\u3052\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n--- /etc/init/openvswitch-switch.conf   2014-05-01 10:42:27.055806142 +0900\n+++ /tmp/openvswitch-switch.conf        2014-05-01 10:41:31.499597240 +0900\n@@ -2,6 +2,9 @@\n description \"Open vSwitch switch\"\n author \"James Page <james.page@ubuntu.com\"\n\n+emits ovs-up\n+emits ovs-pre-down\n+\n start on (local-filesystems and net-device-up IFACE=lo)\n stop on runlevel [!2345]\n\n@@ -32,11 +35,13 @@\n   fi\n   set \"$@\" $OVS_CTL_OPTS\n   \"$@\"\n+  initctl emit ovs-up\n end script\n\n post-stop script\n   . /usr/share/openvswitch/scripts/ovs-lib\n   test -e /etc/default/openvswitch-switch && . /etc/default/openvswitch-switch\n\n+  initctl emit ovs-pre-down\n   ovs_ctl stop\n end script\n\n\u3084\u308a\u305f\u3044\u3053\u3068\u3092 Upstart \u6d41\u306b\u66f8\u304f\u3002\u6700\u3082\u8d77\u52d5\u9806\u5e8f\u3092\u67d4\u8edf\u306b\u5236\u5fa1\u3067\u304d\u308b\u3002\n\n/etc/init/local.conf\ndescription \"custom network settings\"\n\nstart on (ovs-up and net-device-up IFACE=p5p1)\n\npre-start script\n  ovs-vsctl add-br br1\n  ovs-vsctl add-port br1 p5p1\nend script\n\n\nUbuntu(debian) \u306e `/etc/network/interfaces` \u3067 openvswitch \u306e bridge \u3084 port \u3082\u8a2d\u5b9a\u3067\u304d\u308b\u3089\u3057\u3044\u3053\u3068\u304c `/usr/share/doc/openvswitch-switch/README.Debian` \u306b\u66f8\u3044\u3066\u3042\u308b\u3002\n\n```bash:/etc/network/interfaces\nallow-ovs br1\niface br1 inet manual\n  ovs_type OVSBridge\n  ovs_ports p5p1\n```\n\n\u3057\u304b\u3057\u52d5\u304b\u306a\u3044\uff01\u4f55\u304c\u8d77\u3053\u3063\u3066\u3044\u308b\u306e\u304b\uff1f\n\n\u307e\u305a allow-ovs \u3068\u3044\u3046\u306e\u306f\u3001openvswitch \u306e daemon \u985e\u304c\u8d77\u52d5\u3057\u305f\u5f8c\u306b `ifup --allow ovs br1` \u3068\u547c\u3073\u51fa\u3057\u3066\u3082\u3089\u3046\u305f\u3081\u306b\u66f8\u3044\u3066\u3042\u308b\u3002openvswitch \u306e daemon \u985e\u304c\u8d77\u52d5\u3059\u308b\u305f\u3081\u306b\u306f\u3001ovsdb \u304c\u5229\u7528\u53ef\u80fd\u306b\u306a\u3089\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3002\u3064\u307e\u308a\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u304c\u7528\u610f\u3067\u304d\u305f\u5f8c\u3067\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3002\u3068\u3044\u3046\u308f\u3051\u3067 auto \u3067\u306a\u304f allow-ovs \u3068\u306a\u3063\u3066\u3044\u308b\u306e\u306f\u3001\u8d77\u52d5\u9806\u3092\u305d\u3053\u307e\u3067\u9045\u5ef6\u3055\u305b\u308b\u305f\u3081\u306e\u3088\u3046\u3060\u3002\n\n`ifup --allow ovs br1` \u3092\u547c\u3076\u306e\u306f\u3001openvswitch \u306e\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3042\u308b\u306f\u305a\u3060\u3063\u305f\u3002\n\n\u3068\u3053\u308d\u304c Upstart \u3078\u306e\u79fb\u884c\u306e\u6df7\u4e71\u306b\u7d1b\u308c\u3066\u3001\u73fe\u5728 openvswitch \u306e\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u4e8c\u7a2e\u985e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u3002\u3072\u3068\u3064\u306f `/etc/init/openvswitch-switch.conf` \u3067\u3001\u3082\u3046\u4e00\u3064\u306f `/etc/init.d/openvswitch-switch` \u306b\u306a\u3063\u3066\u3044\u308b\u3002\u5f8c\u8005\u306f\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u306a\u3044\uff08/etc/rc.N \u304b\u3089 symlink \u304c\u5f35\u3089\u308c\u3066\u3044\u306a\u3044\uff09\u3002\u6709\u52b9\u306a\u307b\u3046\u306e `/etc/init/openvswitch-switch.conf` \u3092\u4f7f\u3063\u3066 openvswitch daemon \u306f\u8d77\u52d5\u3059\u308b\u3002\u3084\u3084\u3053\u3057\u3044\u3053\u3068\u306b\u3001`/etc/init.d/openvswitch-switch` \u306f ifup --allow ovs {bridges} \u3092\u547c\u3073\u51fa\u3059\u304c\u3001`/etc/init/openvswitch-switch.conf` \u3067\u306f\u305d\u306e\u90e8\u5206\u304c\u629c\u3051\u843d\u3061\u3066\u3044\u308b\u3002\n\n\u3064\u307e\u308a ifup --allow ovs br1 \u306f\u7d50\u5c40\u547c\u3073\u51fa\u3055\u308c\u306a\u3044\u3002\u3088\u3063\u3066\u52d5\u304b\u306a\u3044\uff01\u3068\u3044\u3046\u308f\u3051\u3060\u3063\u305f\u3002\u3084\u308b\u3084\u308b\u8a50\u6b3a\u72b6\u614b\u3002\n\nWorkaround 1\n------------\n`/etc/init.d/openvswitch-switch` \u3092\u4f7f\u3044\u3001`/etc/init/openvswitch-switch.conf` \u3092\u7121\u52b9\u5316\u3059\u308b\u3002\u305b\u3063\u304b\u304f Upstart \u306b\u79fb\u884c\u3057\u305f\u306e\u306b\u2026\u3068\u3044\u3046\u611f\u3092\u62ed\u3048\u306a\u3044\u3002\n\nWorkaround 2\n------------\n`/etc/init/openvswitch-switch.conf` \u3092\u4fee\u6b63\u3059\u308b\u3002\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3068\u30de\u30fc\u30af\u3055\u308c\u3066\u3044\u306a\u3044\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304d\u63db\u3048\u308b\u306e\u304c\u96e3\u70b9\u3002\n\n```diff\n--- /etc/init/openvswitch-switch.conf   2014-01-20 21:30:49.000000000 +0900\n+++ /tmp/openvswitch-switch.conf        2014-05-01 10:21:39.249793837 +0900\n@@ -32,11 +32,13 @@\n   fi\n   set \"$@\" $OVS_CTL_OPTS\n   \"$@\"\n+  ifup --allow ovs `ifquery --allow ovs --list`\n end script\n\n post-stop script\n   . /usr/share/openvswitch/scripts/ovs-lib\n   test -e /etc/default/openvswitch-switch && . /etc/default/openvswitch-switch\n\n+  ifdown --allow ovs `ifquery --allow ovs --list`\n   ovs_ctl stop\n end script\n```\n\nWorkaround 3\n------------\n`/etc/network/interfaces` \u306b\u66f8\u304f\u306e\u3092\u8ae6\u3081\u308b\u3002`/etc/rc.local` \u306b\u3084\u308a\u305f\u3044\u3053\u3068\u3092\u66f8\u304f\u3002workaround \u3068\u3057\u3066\u306f\u6700\u3082\u7b4b\u304c\u826f\u3044\u304c\u3001\u3053\u3061\u3089\u3082\u975e Upstart \u7684\u306a\u6d41\u5100\u306a\u306e\u304c\u30a4\u30de\u30a4\u30c1\u3002\n\nWorkaround 4\n------------\n`/etc/network/interfaces` \u306b\u66f8\u304f\u306e\u3092\u8ae6\u3081\u308b\u3002openvswitch \u8d77\u52d5\u6642\u306b Upstart \u306e\u30a4\u30d9\u30f3\u30c8\u3092\u6295\u3052\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n```diff\n--- /etc/init/openvswitch-switch.conf   2014-05-01 10:42:27.055806142 +0900\n+++ /tmp/openvswitch-switch.conf        2014-05-01 10:41:31.499597240 +0900\n@@ -2,6 +2,9 @@\n description \"Open vSwitch switch\"\n author \"James Page <james.page@ubuntu.com\"\n\n+emits ovs-up\n+emits ovs-pre-down\n+\n start on (local-filesystems and net-device-up IFACE=lo)\n stop on runlevel [!2345]\n\n@@ -32,11 +35,13 @@\n   fi\n   set \"$@\" $OVS_CTL_OPTS\n   \"$@\"\n+  initctl emit ovs-up\n end script\n\n post-stop script\n   . /usr/share/openvswitch/scripts/ovs-lib\n   test -e /etc/default/openvswitch-switch && . /etc/default/openvswitch-switch\n\n+  initctl emit ovs-pre-down\n   ovs_ctl stop\n end script\n```\n\n\u3084\u308a\u305f\u3044\u3053\u3068\u3092 Upstart \u6d41\u306b\u66f8\u304f\u3002\u6700\u3082\u8d77\u52d5\u9806\u5e8f\u3092\u67d4\u8edf\u306b\u5236\u5fa1\u3067\u304d\u308b\u3002\n\n```bash:/etc/init/local.conf\ndescription \"custom network settings\"\n\nstart on (ovs-up and net-device-up IFACE=p5p1)\n\npre-start script\n  ovs-vsctl add-br br1\n  ovs-vsctl add-port br1 p5p1\nend script\n```\n", "tags": ["Network", "Linux", "Ubuntu", "Debian", "upstart"]}