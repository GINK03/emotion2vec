{"tags": ["CircleCI"], "context": " More than 1 year has passed since last update.\u672c\u5f53\u306f\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u3053\u3068\u3092\u66f8\u3053\u3046\u3068\u601d\u3063\u3066\u305f\u3093\u3067\u3059\u304c\n\u30cd\u30bf\u304c\u88ab\u3063\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u3069\u3046\u3057\u3088\u3046\u304b\u3068\u60a9\u3093\u3060\u7d50\u679c\nCircleCI\u7528\u306b\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u5b9a\u7fa9\u3057\u305f\u95a2\u6570\u3092\u6652\u305d\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\u304b\u306a\u308a\u9069\u5f53\u306b\u66f8\u3044\u305f\u3082\u306e\u306a\u306e\u3067\u3001\u305d\u306e\u7b4b\u306e\u4eba\u304c\u898b\u305f\u3089\u30de\u30b5\u30ab\u30ea\u6295\u3052\u3089\u308c\u305d\u3046((((\u309c\u309c))))\n\n\u74b0\u5883\nOSX\u306eEl Capitan\u3067\nzsh\u3067\u52d5\u304b\u3057\u3066\u307e\u3059\njq\u3068peco\u3092\u4f7f\u3063\u3066\u307e\u3059\u3002\nCircleCI\u306eSetting\u306b\u884c\u304dAPI Token\u3092\u4f5c\u6210\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\n\nproject\u4e00\u89a7\u3092\u53d6\u5f97\u3057\u3066\u30d6\u30e9\u30a6\u30b6\u3067\u958b\u304f\n#!/bin/sh\n\nCIRCLE_TOKEN=\"...\"\nCIRCLE_HOST=\"https://circleci.com/api/v1\"\n\n_circle_token=\"&circle-token=$CIRCLE_TOKEN\"\nopen=$(which open)\n\nfunction circle_projects() {\n    url=\"$CIRCLE_HOST/projects?${_circle_token}\"\n    curl -s -H \"Accept: application/json\" $url | jq '.[] | \"\\(.username)/\\(.reponame)\"' | perl -nle '/^\"(.+)\"$/ and print $1'\n}\n\nfunction circle_open_project() {\n    path=$(circle_projects | peco | awk '{print $1}')\n    url=\"https://circleci.com/gh/$path\"\n    echo \"open: $url\"\n    $open $url\n}\n\nCIRCLE_TOKEN\u306b\u4f5c\u6210\u3057\u305fToken\u3092\u5165\u308c\u3066\u304f\u3060\u3055\u3044\u3002\ncircle_open_project\u3092\u53e9\u3051\u3070\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4e00\u89a7\u304c\u53d6\u5f97\u3055\u308c\u305d\u308c\u3092peco\u3092\u4f7f\u3063\u3066\u691c\u7d22\u3067\u304d\u307e\u3059\u3002\n\u5730\u5473\u306b\u4fbf\u5229\u3067\u91cd\u5b9d\u3057\u3066\u307e\u3059\u3002\n\n\u74b0\u5883\u5909\u6570\u306e\u64cd\u4f5c\nfunction circle_env() {\n    project=$1\n    name=$2\n    value=$3\n    if [ ! -n \"$project\" ]; then\n        echo \"not project\" > /dev/stderr\n        return 1\n    fi\n\n    url=\"$CIRCLE_HOST/project/$project/envvar?${_circle_token}\"\n\n    if [ -n \"$value\" ]; then\n        body=\"{\\\"name\\\":\\\"$name\\\",\\\"value\\\":\\\"$value\\\"}\"\n        curl -s -H \"Accept: application/json\" -H \"Content-Type: application/json\" -d $body $url > /dev/null\n        echo ok\n        return 0\n    fi\n\n    if [ -n \"$name\" ]; then\n        method=\"GET\"\n        if [ \"${name:0:1}\" = \":\" ]; then\n            method=\"DELETE\"\n            name=${name:1:${#name}}\n        fi\n\n        url=\"$CIRCLE_HOST/project/$project/envvar/$name?${_circle_token}\"\n        res=$(curl -X $method -s -H \"Accept: application/json\" $url)\n        if [ $method = \"DELETE\" ]; then\n            echo ok\n        else\n            echo $res | jq .value | perl -nle '/^\"(.+)\"$/ and print $1'\n        fi\n        return 0\n    fi\n\n    curl -s -H \"Accept: application/json\" $url | jq '.[] | \"\\(.name) \\(.value)\"' | perl -nle '/^\"(.+)\"$/ and print $1'\n}\n\n\n\u4f7f\u3044\u65b9\u306f\u7b2c\u4e00\u5f15\u6570\u306buser/repo\u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u6307\u5b9a\u3057\n\u4e00\u89a7\u3092\u898b\u308b\u3068\u304d\u306f circle_env user/repo\n\u5024\u3092\u30bb\u30c3\u30c8\u3059\u308b\u3068\u304d\u306f circle_env user/repo FOO bar\n\u5024\u3092\u524a\u9664\u3059\u308b\u3068\u304d\u306fKey\u306e\u5148\u982d\u306b\u30b3\u30ed\u30f3\u3092\u3064\u3051\u3066 circle_env user/repo :FOO\n\u3068\u3044\u3046\u611f\u3058\u3067\u3059\u3002\n\u96a0\u3057\u305f\u3044\u30d5\u30a1\u30a4\u30eb\u306f\ncircle_env k2wanko/gtoken SECRET_FILE $(base64 ./secret_file)\n\u3067\u5024\u3092\u30bb\u30c3\u30c8\u3067\u304d\ncircle.yml\u306b\necho $SECRET_FILE | base64 -D > ./secret_file\n\u3092\u8ffd\u52a0\u3059\u308c\u3070\u30c7\u30b3\u30fc\u30c9\u3067\u304d\u307e\u3059\u3002\n\n\u307e\u3068\u3081\n\u30d5\u30a1\u30a4\u30eb\u5168\u4f53\u306fgist\u306b\u4e0a\u3052\u307e\u3057\u305f\nhttps://gist.github.com/k2wanko/a4ad5c3b903f68f194b1\n\u307e\u3060\u7121\u6599\u7248\u3057\u304b\u8a66\u305b\u3066\u306a\u3044\u306e\u3067\u3053\u3093\u306a\u3050\u3089\u3044\u3067\u3059\u304c\nCircleCI\u306f\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30ea\u30dd\u30b8\u30c8\u30ea\u3068\u304b\u95a2\u4fc2\u306a\u304f\u5229\u7528\u3067\u304d\u308b\u3057\n\u30cf\u30a4\u30b9\u30da\u30c3\u30af\u306a\u30de\u30b7\u30f3\u3067\u5b9f\u884c\u3055\u308c\u308b\u3057SSH\u3082\u7e4b\u304c\u308b\u306e\u3067\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3059\u308c\u3070\nhttp\u30b5\u30fc\u30d0\u30fc\u306b\u3082\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u306e\u3067\u6700\u9ad8\u306eCI\u30b5\u30fc\u30d3\u30b9\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\u672c\u5f53\u306f\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u3053\u3068\u3092\u66f8\u3053\u3046\u3068\u601d\u3063\u3066\u305f\u3093\u3067\u3059\u304c\n\u30cd\u30bf\u304c\u88ab\u3063\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u3069\u3046\u3057\u3088\u3046\u304b\u3068\u60a9\u3093\u3060\u7d50\u679c\nCircleCI\u7528\u306b\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u5b9a\u7fa9\u3057\u305f\u95a2\u6570\u3092\u6652\u305d\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u304b\u306a\u308a\u9069\u5f53\u306b\u66f8\u3044\u305f\u3082\u306e\u306a\u306e\u3067\u3001\u305d\u306e\u7b4b\u306e\u4eba\u304c\u898b\u305f\u3089\u30de\u30b5\u30ab\u30ea\u6295\u3052\u3089\u308c\u305d\u3046((((\u309c\u309c))))\n\n# \u74b0\u5883\n\nOSX\u306eEl Capitan\u3067\nzsh\u3067\u52d5\u304b\u3057\u3066\u307e\u3059\njq\u3068peco\u3092\u4f7f\u3063\u3066\u307e\u3059\u3002\n\nCircleCI\u306eSetting\u306b\u884c\u304dAPI Token\u3092\u4f5c\u6210\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\n\n# project\u4e00\u89a7\u3092\u53d6\u5f97\u3057\u3066\u30d6\u30e9\u30a6\u30b6\u3067\u958b\u304f\n\n```zsh\n#!/bin/sh\n\nCIRCLE_TOKEN=\"...\"\nCIRCLE_HOST=\"https://circleci.com/api/v1\"\n\n_circle_token=\"&circle-token=$CIRCLE_TOKEN\"\nopen=$(which open)\n\nfunction circle_projects() {\n    url=\"$CIRCLE_HOST/projects?${_circle_token}\"\n    curl -s -H \"Accept: application/json\" $url | jq '.[] | \"\\(.username)/\\(.reponame)\"' | perl -nle '/^\"(.+)\"$/ and print $1'\n}\n\nfunction circle_open_project() {\n    path=$(circle_projects | peco | awk '{print $1}')\n    url=\"https://circleci.com/gh/$path\"\n    echo \"open: $url\"\n    $open $url\n}\n```\n\nCIRCLE_TOKEN\u306b\u4f5c\u6210\u3057\u305fToken\u3092\u5165\u308c\u3066\u304f\u3060\u3055\u3044\u3002\n\n`circle_open_project`\u3092\u53e9\u3051\u3070\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4e00\u89a7\u304c\u53d6\u5f97\u3055\u308c\u305d\u308c\u3092peco\u3092\u4f7f\u3063\u3066\u691c\u7d22\u3067\u304d\u307e\u3059\u3002\n\n\u5730\u5473\u306b\u4fbf\u5229\u3067\u91cd\u5b9d\u3057\u3066\u307e\u3059\u3002\n\n# \u74b0\u5883\u5909\u6570\u306e\u64cd\u4f5c\n\n```zsh\nfunction circle_env() {\n    project=$1\n    name=$2\n    value=$3\n    if [ ! -n \"$project\" ]; then\n        echo \"not project\" > /dev/stderr\n        return 1\n    fi\n    \n    url=\"$CIRCLE_HOST/project/$project/envvar?${_circle_token}\"\n\n    if [ -n \"$value\" ]; then\n        body=\"{\\\"name\\\":\\\"$name\\\",\\\"value\\\":\\\"$value\\\"}\"\n        curl -s -H \"Accept: application/json\" -H \"Content-Type: application/json\" -d $body $url > /dev/null\n        echo ok\n        return 0\n    fi\n\n    if [ -n \"$name\" ]; then\n        method=\"GET\"\n        if [ \"${name:0:1}\" = \":\" ]; then\n            method=\"DELETE\"\n            name=${name:1:${#name}}\n        fi\n\n        url=\"$CIRCLE_HOST/project/$project/envvar/$name?${_circle_token}\"\n        res=$(curl -X $method -s -H \"Accept: application/json\" $url)\n        if [ $method = \"DELETE\" ]; then\n            echo ok\n        else\n            echo $res | jq .value | perl -nle '/^\"(.+)\"$/ and print $1'\n        fi\n        return 0\n    fi\n    \n    curl -s -H \"Accept: application/json\" $url | jq '.[] | \"\\(.name) \\(.value)\"' | perl -nle '/^\"(.+)\"$/ and print $1'\n}\n\n```\n\n\u4f7f\u3044\u65b9\u306f\u7b2c\u4e00\u5f15\u6570\u306b`user/repo`\u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u6307\u5b9a\u3057\n\n\u4e00\u89a7\u3092\u898b\u308b\u3068\u304d\u306f `circle_env user/repo`\n\u5024\u3092\u30bb\u30c3\u30c8\u3059\u308b\u3068\u304d\u306f `circle_env user/repo FOO bar`\n\u5024\u3092\u524a\u9664\u3059\u308b\u3068\u304d\u306fKey\u306e\u5148\u982d\u306b\u30b3\u30ed\u30f3\u3092\u3064\u3051\u3066 `circle_env user/repo :FOO`\n\n\u3068\u3044\u3046\u611f\u3058\u3067\u3059\u3002\n\n\u96a0\u3057\u305f\u3044\u30d5\u30a1\u30a4\u30eb\u306f\n`circle_env k2wanko/gtoken SECRET_FILE $(base64 ./secret_file)`\n\u3067\u5024\u3092\u30bb\u30c3\u30c8\u3067\u304d\ncircle.yml\u306b\n`echo $SECRET_FILE | base64 -D > ./secret_file`\n\u3092\u8ffd\u52a0\u3059\u308c\u3070\u30c7\u30b3\u30fc\u30c9\u3067\u304d\u307e\u3059\u3002\n\n# \u307e\u3068\u3081\n\n\u30d5\u30a1\u30a4\u30eb\u5168\u4f53\u306fgist\u306b\u4e0a\u3052\u307e\u3057\u305f\nhttps://gist.github.com/k2wanko/a4ad5c3b903f68f194b1\n\n\u307e\u3060\u7121\u6599\u7248\u3057\u304b\u8a66\u305b\u3066\u306a\u3044\u306e\u3067\u3053\u3093\u306a\u3050\u3089\u3044\u3067\u3059\u304c\nCircleCI\u306f\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30ea\u30dd\u30b8\u30c8\u30ea\u3068\u304b\u95a2\u4fc2\u306a\u304f\u5229\u7528\u3067\u304d\u308b\u3057\n\u30cf\u30a4\u30b9\u30da\u30c3\u30af\u306a\u30de\u30b7\u30f3\u3067\u5b9f\u884c\u3055\u308c\u308b\u3057SSH\u3082\u7e4b\u304c\u308b\u306e\u3067\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3059\u308c\u3070\nhttp\u30b5\u30fc\u30d0\u30fc\u306b\u3082\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u306e\u3067\u6700\u9ad8\u306eCI\u30b5\u30fc\u30d3\u30b9\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n"}