{"context": " More than 1 year has passed since last update.\n\nWhat's this?\nNova instance \u304c\u7a3c\u50cd\u3057\u3066\u3044\u308b compute node \u304c\u969c\u5bb3\u505c\u6b62\u3057\u305f\u969b\u306b\u3001Nova instance \u3092\u5225\u306e compute node \u4e0a\u306b\u5fa9\u65e7(=\u9000\u907f)\n\nNova instance \u3092\u505c\u6b62\u305b\u305a\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b\u5225\u306e compute node \u306b\u79fb\u52d5\u3059\u308b\u6a5f\u80fd\u3067\u306f\u306a\u3044\n\u3042\u304f\u307e\u3067 shared storage \u4e0a\u306e\u30c7\u30fc\u30bf\u3092\u4f7f\u7528\u3057\u3066\u3001\u5225\u306e compute node \u3067\u8d77\u52d5\u3057\u76f4\u3059\u6a5f\u80fd\n\n[Case]\n\nNova instance data is stored in Nova volume of shared storage\nNova instance data is stored in Cinder volume (= boot from Cinder volume), Cinder data is stored in Cinder volume of shared storage\n\n[\u6761\u4ef6]\n\nShared storage \u3042\u308a\nNova instance \u306e\u5168\u30c7\u30fc\u30bf\u306f Shared storage \u306b\u3042\u308b\n\u8ffd\u52a0 Volume \u3068\u3057\u3066\u306e Cinder \u672a\u4f7f\u7528\nHypervisor \u306f KVM\n\n\n[Case1] Nova Evacuate (Nova instance data is stored in Nova volume of shared storage)\n\ninitial state\n\nCompute node\n# nova service-list | egrep \"Host|nova-compute\"\n| Binary           | Host    | Zone     | Status  | State | Updated_at                 | Disabled Reason |\n| nova-compute     | node-27 | nova     | enabled | up    | 2015-03-17T08:36:27.000000 | -               |\n| nova-compute     | node-28 | nova     | enabled | up    | 2015-03-17T08:36:24.000000 | -               |\n| nova-compute     | node-31 | nova2    | enabled | up    | 2015-03-17T08:36:24.000000 | None            |\n\n\nAZ\n# nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n| nova                     | available                              |\n| |- node-27               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-17T08:36:37.000000 |\n| |- node-28               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-17T08:36:34.000000 |\n| nova2                    | available                              |\n| |- node-31               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-17T08:36:34.000000 |\n+--------------------------+----------------------------------------+\n\n\nNova instance is running on node-28\n# nova list --field name,status,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n| ID                                   | Name       | Status | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n| 322d9761-c264-4b33-aaed-5175cba464d2 | admin_vm01 | ACTIVE | active               | nova                         | node-28                              |\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n\n\nStop nova-compute service of node-28\n\nStop nova-compute service\n# service openstack-nova-compute stop\n\n# nova service-list | egrep \"Host|nova-compute\"\n| Binary           | Host    | Zone     | Status  | State | Updated_at                 | Disabled Reason |\n| nova-compute     | node-27 | nova     | enabled | up    | 2015-03-17T08:38:17.000000 | -               |\n| nova-compute     | node-28 | nova     | enabled | down  | 2015-03-17T08:37:14.000000 | -               |\n| nova-compute     | node-31 | nova2    | enabled | up    | 2015-03-17T08:38:14.000000 | None            |\n\n\nAZ\n# nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n| nova                     | available                              |\n| |- node-27               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-17T08:38:17.000000 |\n| |- node-28               |                                        |\n| | |- nova-compute        | enabled XXX 2015-03-17T08:37:14.000000 |\n| nova2                    | available                              |\n| |- node-31               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-17T08:38:14.000000 |\n+--------------------------+----------------------------------------+\n\n\nEvacuate\n\nExecute evacuate\nEvacuate Nova instance from node-28(inactive) to node-27(active)\nnova evacuate --on-shared-storage 322d9761-c264-4b33-aaed-5175cba464d2 node-27\n\n\nNova log\nnode-27 nova-compute 28104 AUDIT nova.compute.manager [req-501c487c-4648-4c4e-a757-489783eb60ba None] [instance: 322d9761-c264-4b33-aaed-5175cba464d2] Rebuilding instance\nnode-27 nova-compute 28104 INFO nova.compute.manager [req-501c487c-4648-4c4e-a757-489783eb60ba None] disk on shared storage, recreating using existing disk\nnode-27 nova-compute 28104 INFO nova.virt.libvirt.driver [req-501c487c-4648-4c4e-a757-489783eb60ba None] [instance: 322d9761-c264-4b33-aaed-5175cba464d2] Creating image\nnode-27 nova-compute 28104 INFO nova.compute.manager [-] Lifecycle event 0 on VM 322d9761-c264-4b33-aaed-5175cba464d2\nnode-27 nova-compute 28104 INFO nova.virt.libvirt.driver [-] [instance: 322d9761-c264-4b33-aaed-5175cba464d2] Instance spawned successfully.\nnode-27 nova-compute 28104 INFO nova.compute.manager [req-82a47a47-acf8-48a4-9ea4-5b2333ee557d None] [instance: 322d9761-c264-4b33-aaed-5175cba464d2] During sync_power_state the instance has a pending task. Skip.\nnode-27 nova-compute 28104 INFO nova.compute.manager [req-501c487c-4648-4c4e-a757-489783eb60ba None] bringing vm to original state: 'active'\n\n\nCheck the evacuate result\nNova instance is running on node-27(active) by using the previous data stored in shared storage\n# nova list --field name,status,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n| ID                                   | Name       | Status | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n| 322d9761-c264-4b33-aaed-5175cba464d2 | admin_vm01 | ACTIVE | active               | nova                         | node-27                              |\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n\n\n[Case2] Nova instance data is stored in Cinder volume (= boot from Cinder volume), Cinder data is stored in Cinder volume of shared storage\n\ninitial state\n\nCompute node\n# nova service-list | egrep \"Host|nova-compute\"\n| Binary           | Host    | Zone     | Status  | State | Updated_at                 | Disabled Reason |\n| nova-compute     | node-27 | nova     | enabled | up    | 2015-03-23T05:29:26.000000 | -               |\n| nova-compute     | node-28 | nova     | enabled | up    | 2015-03-23T05:29:21.000000 | -               |\n| nova-compute     | node-31 | nova2    | enabled | up    | 2015-03-23T05:29:25.000000 | None            |\n\n\nAZ\n# nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n| nova                     | available                              |\n| |- node-27               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-23T05:29:26.000000 |\n| |- node-28               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-23T05:29:31.000000 |\n| nova2                    | available                              |\n| |- node-31               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-23T05:29:25.000000 |\n+--------------------------+----------------------------------------+\n\n\nNova instance is running on node-28\n# nova list --field name,status,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n+--------------------------------------+-------------+--------+----------------------+------------------------------+--------------------------------------+\n| ID                                   | Name        | Status | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n+--------------------------------------+-------------+--------+----------------------+------------------------------+--------------------------------------+\n| 69546468-97d3-487b-a91c-7b93cd502929 | admin_vm11  | ACTIVE | active               | nova                         | node-28                              |\n+--------------------------------------+-------------+--------+----------------------+------------------------------+--------------------------------------+\n\n\nAll Nova data is stored in Cinder volume (= boot from Cinder volume)\n# nova show 69546468-97d3-487b-a91c-7b93cd502929 | egrep \"Property|image|volumes_attached\"\n| Property                             | Value                                                    |\n| image                                | Attempt to boot from volume - no image supplied          |\n| os-extended-volumes:volumes_attached | [{\"id\": \"9d3ac7f8-db69-41e4-87be-1d94f2358144\"}]         |\n\n\nStop nova-compute service of node-28\n\nStop nova-compute service\n# /etc/init.d/openstack-nova-compute stop\n\n# nova service-list | egrep \"Host|nova-compute\"\n| Binary           | Host    | Zone     | Status  | State | Updated_at                 | Disabled Reason |\n| nova-compute     | node-27 | nova     | enabled | up    | 2015-03-23T05:32:46.000000 | -               |\n| nova-compute     | node-28 | nova     | enabled | down  | 2015-03-23T05:31:31.000000 | -               |\n| nova-compute     | node-31 | nova2    | enabled | up    | 2015-03-23T05:32:55.000000 | None            |\n\n\nAZ\n# nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n| nova                     | available                              |\n| |- node-27               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-23T05:32:56.000000 |\n| |- node-28               |                                        |\n| | |- nova-compute        | enabled XXX 2015-03-23T05:31:31.000000 |\n| nova2                    | available                              |\n| |- node-31               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-23T05:32:55.000000 |\n+--------------------------+----------------------------------------+\n\n\nEvacuate\n\nExecute evacuate\nEvacuate Nova instance from node-28(inactive) to node-27(active)\nnova evacuate --on-shared-storage 69546468-97d3-487b-a91c-7b93cd502929 node-27\n\n\nNova log\nnode-27 nova-compute 26063 INFO nova.compute.resource_tracker [-] Compute_service record updated for node-27\nnode-27 nova-compute 26063 AUDIT nova.compute.manager [req-a41f2a0e-d557-488a-807f-40c23d6a5988 None] [instance: 69546468-97d3-487b-a91c-7b93cd502929] Rebuilding instance\nnode-27 nova-compute 26063 INFO nova.compute.manager [req-a41f2a0e-d557-488a-807f-40c23d6a5988 None] disk on shared storage, recreating using existing disk\nnode-27 nova-compute 26063 INFO urllib3.connectionpool [req-a41f2a0e-d557-488a-807f-40c23d6a5988 ] Starting new HTTP connection (1): 10.30.0.2\nnode-27 nova-compute 26063 AUDIT nova.virt.block_device [req-a41f2a0e-d557-488a-807f-40c23d6a5988 None] [instance: 69546468-97d3-487b-a91c-7b93cd502929] Booting with volume 9d3ac7f8-db69-41e4-87be-1d94f2358144 at vda\nnode-27 nova-compute 26063 INFO urllib3.connectionpool [req-a41f2a0e-d557-488a-807f-40c23d6a5988 ] Starting new HTTP connection (1): 10.30.0.2\nnode-27 nova-compute 26063 WARNING nova.virt.libvirt.utils [req-a41f2a0e-d557-488a-807f-40c23d6a5988 None] systool is not installed\nnode-27 nova-compute 26063 WARNING nova.virt.libvirt.utils [req-a41f2a0e-d557-488a-807f-40c23d6a5988 None] systool is not installed\nnode-27 nova-compute 26063 INFO urllib3.connectionpool [req-a41f2a0e-d557-488a-807f-40c23d6a5988 ] Starting new HTTP connection (1): 10.30.0.2\nnode-27 nova-compute 26063 INFO urllib3.connectionpool [req-a41f2a0e-d557-488a-807f-40c23d6a5988 ] Starting new HTTP connection (1): 10.30.0.2\nnode-27 nova-compute 26063 INFO nova.virt.libvirt.driver [req-a41f2a0e-d557-488a-807f-40c23d6a5988 None] [instance: 69546468-97d3-487b-a91c-7b93cd502929] Creating image\nnode-27 nova-compute 26063 INFO nova.compute.manager [-] Lifecycle event 0 on VM 69546468-97d3-487b-a91c-7b93cd502929\nnode-27 nova-compute 26063 INFO nova.virt.libvirt.driver [-] [instance: 69546468-97d3-487b-a91c-7b93cd502929] Instance spawned successfully.\nnode-27 nova-compute 26063 INFO nova.compute.manager [req-a41f2a0e-d557-488a-807f-40c23d6a5988 None] bringing vm to original state: 'active'\n\n\nCheck the evacuate result\nNova instance is running on node-27(active) by using the previous data stored in Cinder volume of shared storage\n# nova list --field name,status,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n| ID                                   | Name       | Status | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n| 69546468-97d3-487b-a91c-7b93cd502929 | admin_vm11 | ACTIVE | active               | nova                         | node-27                              |\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n\n\nEnvironment\n\nOpenstack : Juno\nCeph : Firefly\n\n\nReference\nOpenstack - Nova Evacuate with Shared Storage\nOpenstack - Nova Evacuate with Shared Storage with Cinder\nOpenstack - Nova Evacuate with Shared Storage with Cinder between AZ\nOpenstack - Nova Evacuate without Shared Storage\nOpenstack - Nova Host-Evacuate with Shared Storage\nOpenstack - Nova Host-Evacuate with Shared Storage between AZ\n## What's this?\n\nNova instance \u304c\u7a3c\u50cd\u3057\u3066\u3044\u308b compute node \u304c\u969c\u5bb3\u505c\u6b62\u3057\u305f\u969b\u306b\u3001Nova instance \u3092\u5225\u306e compute node \u4e0a\u306b\u5fa9\u65e7(=\u9000\u907f)\n\n* Nova instance \u3092\u505c\u6b62\u305b\u305a\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b\u5225\u306e compute node \u306b\u79fb\u52d5\u3059\u308b\u6a5f\u80fd\u3067\u306f\u306a\u3044\n* \u3042\u304f\u307e\u3067 shared storage \u4e0a\u306e\u30c7\u30fc\u30bf\u3092\u4f7f\u7528\u3057\u3066\u3001\u5225\u306e compute node \u3067\u8d77\u52d5\u3057\u76f4\u3059\u6a5f\u80fd\n\n\n[Case]\n\n1. Nova instance data is stored in Nova volume of shared storage\n2. Nova instance data is stored in Cinder volume (= boot from Cinder volume), Cinder data is stored in Cinder volume of shared storage\n\n[\u6761\u4ef6]\n\n* Shared storage \u3042\u308a\n* Nova instance \u306e\u5168\u30c7\u30fc\u30bf\u306f Shared storage \u306b\u3042\u308b\n* \u8ffd\u52a0 Volume \u3068\u3057\u3066\u306e Cinder \u672a\u4f7f\u7528\n* Hypervisor \u306f KVM\n\n\n\n## [Case1] Nova Evacuate (Nova instance data is stored in Nova volume of shared storage)\n\n### initial state\n\n#### Compute node\n\n    # nova service-list | egrep \"Host|nova-compute\"\n    | Binary           | Host    | Zone     | Status  | State | Updated_at                 | Disabled Reason |\n    | nova-compute     | node-27 | nova     | enabled | up    | 2015-03-17T08:36:27.000000 | -               |\n    | nova-compute     | node-28 | nova     | enabled | up    | 2015-03-17T08:36:24.000000 | -               |\n    | nova-compute     | node-31 | nova2    | enabled | up    | 2015-03-17T08:36:24.000000 | None            |\n\n#### AZ\n\n    # nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n    | nova                     | available                              |\n    | |- node-27               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-17T08:36:37.000000 |\n    | |- node-28               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-17T08:36:34.000000 |\n    | nova2                    | available                              |\n    | |- node-31               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-17T08:36:34.000000 |\n    +--------------------------+----------------------------------------+\n\n#### Nova instance is running on node-28\n\n    # nova list --field name,status,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n    | ID                                   | Name       | Status | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n    | 322d9761-c264-4b33-aaed-5175cba464d2 | admin_vm01 | ACTIVE | active               | nova                         | node-28                              |\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n\n\n### Stop nova-compute service of node-28\n\n#### Stop nova-compute service\n\n    # service openstack-nova-compute stop\n\n    # nova service-list | egrep \"Host|nova-compute\"\n    | Binary           | Host    | Zone     | Status  | State | Updated_at                 | Disabled Reason |\n    | nova-compute     | node-27 | nova     | enabled | up    | 2015-03-17T08:38:17.000000 | -               |\n    | nova-compute     | node-28 | nova     | enabled | down  | 2015-03-17T08:37:14.000000 | -               |\n    | nova-compute     | node-31 | nova2    | enabled | up    | 2015-03-17T08:38:14.000000 | None            |\n\n#### AZ\n\n    # nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n    | nova                     | available                              |\n    | |- node-27               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-17T08:38:17.000000 |\n    | |- node-28               |                                        |\n    | | |- nova-compute        | enabled XXX 2015-03-17T08:37:14.000000 |\n    | nova2                    | available                              |\n    | |- node-31               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-17T08:38:14.000000 |\n    +--------------------------+----------------------------------------+\n\n\n### Evacuate\n\n#### Execute evacuate\n\nEvacuate Nova instance from node-28(inactive) to node-27(active)\n\n    nova evacuate --on-shared-storage 322d9761-c264-4b33-aaed-5175cba464d2 node-27\n\n\n#### Nova log\n\n~~~\nnode-27 nova-compute 28104 AUDIT nova.compute.manager [req-501c487c-4648-4c4e-a757-489783eb60ba None] [instance: 322d9761-c264-4b33-aaed-5175cba464d2] Rebuilding instance\nnode-27 nova-compute 28104 INFO nova.compute.manager [req-501c487c-4648-4c4e-a757-489783eb60ba None] disk on shared storage, recreating using existing disk\nnode-27 nova-compute 28104 INFO nova.virt.libvirt.driver [req-501c487c-4648-4c4e-a757-489783eb60ba None] [instance: 322d9761-c264-4b33-aaed-5175cba464d2] Creating image\nnode-27 nova-compute 28104 INFO nova.compute.manager [-] Lifecycle event 0 on VM 322d9761-c264-4b33-aaed-5175cba464d2\nnode-27 nova-compute 28104 INFO nova.virt.libvirt.driver [-] [instance: 322d9761-c264-4b33-aaed-5175cba464d2] Instance spawned successfully.\nnode-27 nova-compute 28104 INFO nova.compute.manager [req-82a47a47-acf8-48a4-9ea4-5b2333ee557d None] [instance: 322d9761-c264-4b33-aaed-5175cba464d2] During sync_power_state the instance has a pending task. Skip.\nnode-27 nova-compute 28104 INFO nova.compute.manager [req-501c487c-4648-4c4e-a757-489783eb60ba None] bringing vm to original state: 'active'\n~~~\n\n\n#### Check the evacuate result\n\nNova instance is running on node-27(active) by using the previous data stored in shared storage\n\n    # nova list --field name,status,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n    | ID                                   | Name       | Status | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n    | 322d9761-c264-4b33-aaed-5175cba464d2 | admin_vm01 | ACTIVE | active               | nova                         | node-27                              |\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n\n\n\n\n\n\n## [Case2] Nova instance data is stored in Cinder volume (= boot from Cinder volume), Cinder data is stored in Cinder volume of shared storage\n\n### initial state\n\n#### Compute node\n\n    # nova service-list | egrep \"Host|nova-compute\"\n    | Binary           | Host    | Zone     | Status  | State | Updated_at                 | Disabled Reason |\n    | nova-compute     | node-27 | nova     | enabled | up    | 2015-03-23T05:29:26.000000 | -               |\n    | nova-compute     | node-28 | nova     | enabled | up    | 2015-03-23T05:29:21.000000 | -               |\n    | nova-compute     | node-31 | nova2    | enabled | up    | 2015-03-23T05:29:25.000000 | None            |\n\n#### AZ\n\n    # nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n    | nova                     | available                              |\n    | |- node-27               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-23T05:29:26.000000 |\n    | |- node-28               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-23T05:29:31.000000 |\n    | nova2                    | available                              |\n    | |- node-31               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-23T05:29:25.000000 |\n    +--------------------------+----------------------------------------+\n\n#### Nova instance is running on node-28\n\n    # nova list --field name,status,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n    +--------------------------------------+-------------+--------+----------------------+------------------------------+--------------------------------------+\n    | ID                                   | Name        | Status | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n    +--------------------------------------+-------------+--------+----------------------+------------------------------+--------------------------------------+\n    | 69546468-97d3-487b-a91c-7b93cd502929 | admin_vm11  | ACTIVE | active               | nova                         | node-28                              |\n    +--------------------------------------+-------------+--------+----------------------+------------------------------+--------------------------------------+\n\n#### All Nova data is stored in Cinder volume (= boot from Cinder volume)\n\n    # nova show 69546468-97d3-487b-a91c-7b93cd502929 | egrep \"Property|image|volumes_attached\"\n    | Property                             | Value                                                    |\n    | image                                | Attempt to boot from volume - no image supplied          |\n    | os-extended-volumes:volumes_attached | [{\"id\": \"9d3ac7f8-db69-41e4-87be-1d94f2358144\"}]         |\n\n\n### Stop nova-compute service of node-28\n\n#### Stop nova-compute service\n\n    # /etc/init.d/openstack-nova-compute stop\n\n    # nova service-list | egrep \"Host|nova-compute\"\n    | Binary           | Host    | Zone     | Status  | State | Updated_at                 | Disabled Reason |\n    | nova-compute     | node-27 | nova     | enabled | up    | 2015-03-23T05:32:46.000000 | -               |\n    | nova-compute     | node-28 | nova     | enabled | down  | 2015-03-23T05:31:31.000000 | -               |\n    | nova-compute     | node-31 | nova2    | enabled | up    | 2015-03-23T05:32:55.000000 | None            |\n\n#### AZ\n\n    # nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n    | nova                     | available                              |\n    | |- node-27               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-23T05:32:56.000000 |\n    | |- node-28               |                                        |\n    | | |- nova-compute        | enabled XXX 2015-03-23T05:31:31.000000 |\n    | nova2                    | available                              |\n    | |- node-31               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-23T05:32:55.000000 |\n    +--------------------------+----------------------------------------+\n\n\n### Evacuate\n\n#### Execute evacuate\n\nEvacuate Nova instance from node-28(inactive) to node-27(active)\n\n    nova evacuate --on-shared-storage 69546468-97d3-487b-a91c-7b93cd502929 node-27\n\n#### Nova log\n\n~~~\nnode-27 nova-compute 26063 INFO nova.compute.resource_tracker [-] Compute_service record updated for node-27\nnode-27 nova-compute 26063 AUDIT nova.compute.manager [req-a41f2a0e-d557-488a-807f-40c23d6a5988 None] [instance: 69546468-97d3-487b-a91c-7b93cd502929] Rebuilding instance\nnode-27 nova-compute 26063 INFO nova.compute.manager [req-a41f2a0e-d557-488a-807f-40c23d6a5988 None] disk on shared storage, recreating using existing disk\nnode-27 nova-compute 26063 INFO urllib3.connectionpool [req-a41f2a0e-d557-488a-807f-40c23d6a5988 ] Starting new HTTP connection (1): 10.30.0.2\nnode-27 nova-compute 26063 AUDIT nova.virt.block_device [req-a41f2a0e-d557-488a-807f-40c23d6a5988 None] [instance: 69546468-97d3-487b-a91c-7b93cd502929] Booting with volume 9d3ac7f8-db69-41e4-87be-1d94f2358144 at vda\nnode-27 nova-compute 26063 INFO urllib3.connectionpool [req-a41f2a0e-d557-488a-807f-40c23d6a5988 ] Starting new HTTP connection (1): 10.30.0.2\nnode-27 nova-compute 26063 WARNING nova.virt.libvirt.utils [req-a41f2a0e-d557-488a-807f-40c23d6a5988 None] systool is not installed\nnode-27 nova-compute 26063 WARNING nova.virt.libvirt.utils [req-a41f2a0e-d557-488a-807f-40c23d6a5988 None] systool is not installed\nnode-27 nova-compute 26063 INFO urllib3.connectionpool [req-a41f2a0e-d557-488a-807f-40c23d6a5988 ] Starting new HTTP connection (1): 10.30.0.2\nnode-27 nova-compute 26063 INFO urllib3.connectionpool [req-a41f2a0e-d557-488a-807f-40c23d6a5988 ] Starting new HTTP connection (1): 10.30.0.2\nnode-27 nova-compute 26063 INFO nova.virt.libvirt.driver [req-a41f2a0e-d557-488a-807f-40c23d6a5988 None] [instance: 69546468-97d3-487b-a91c-7b93cd502929] Creating image\nnode-27 nova-compute 26063 INFO nova.compute.manager [-] Lifecycle event 0 on VM 69546468-97d3-487b-a91c-7b93cd502929\nnode-27 nova-compute 26063 INFO nova.virt.libvirt.driver [-] [instance: 69546468-97d3-487b-a91c-7b93cd502929] Instance spawned successfully.\nnode-27 nova-compute 26063 INFO nova.compute.manager [req-a41f2a0e-d557-488a-807f-40c23d6a5988 None] bringing vm to original state: 'active'\n~~~\n\n#### Check the evacuate result\n\nNova instance is running on node-27(active) by using the previous data stored in Cinder volume of shared storage\n\n    # nova list --field name,status,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n    | ID                                   | Name       | Status | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n    | 69546468-97d3-487b-a91c-7b93cd502929 | admin_vm11 | ACTIVE | active               | nova                         | node-27                              |\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n\n\n## Environment\n\n* Openstack : Juno\n* Ceph : Firefly\n\n## Reference\n\n[Openstack - Nova Evacuate with Shared Storage][link-01]\n[Openstack - Nova Evacuate with Shared Storage with Cinder][link-02]\n[Openstack - Nova Evacuate with Shared Storage with Cinder between AZ][link-03]\n[Openstack - Nova Evacuate without Shared Storage][link-04]\n[Openstack - Nova Host-Evacuate with Shared Storage][link-05]\n[Openstack - Nova Host-Evacuate with Shared Storage between AZ][link-06]\n\n[link-01]:http://qiita.com/idzzy/items/3f398ff8eaa3b786fc89\n[link-02]:http://qiita.com/idzzy/items/2f1add9d1a03e1a4fdea\n[link-03]:http://qiita.com/idzzy/items/8dd2b417f8c5f8efa7c9\n[link-04]:http://qiita.com/idzzy/items/860cb6c60ab7433eb817\n[link-05]:http://qiita.com/idzzy/items/9f057becb592c4c89137\n[link-06]:http://qiita.com/idzzy/items/71287b09de1370c68118\n", "tags": ["openstack", "nova"]}