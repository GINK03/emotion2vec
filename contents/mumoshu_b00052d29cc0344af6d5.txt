{"context": " More than 1 year has passed since last update.TL;DR; \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u540d\u524d\u306e\u914d\u5217\u3001\u305d\u308c\u4ee5\u4e0a\u306e\u9577\u3055\u306e\u4eee\u5f15\u6570\u30ea\u30b9\u30c8\u3092\u6301\u3064\u95a2\u6570\u3001\u305d\u3057\u3066\u305d\u308c\u3089\u3092\u5f15\u6570\u306b\u3068\u308b\u3088\u3046\u306a\u30d8\u30eb\u30d1\u95a2\u6570\u3092\u4f7f\u3063\u3066DI\u3092\u5b9f\u73fe\u3059\u308b\u3002\u5fdc\u7528\u3059\u308b\u3068\u3001\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u5f15\u6570\u3078DI\u3057\u305f\u308a\u3001\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u751f\u6210\u3082DI\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u9762\u5012\u307f\u305f\u308a\u3001\u5faa\u74b0\u4f9d\u5b58\u306e\u691c\u77e5\u3057\u305f\u308a\u306a\u3069\u8272\u3005\u3067\u304d\u308b\u3002\n\n\u524d\u7f6e\u304d\nDependency injection in JavaScript \u306e\u4e00\u90e8\u3092\u81ea\u5206\u306a\u308a\u306b\u5480\u56bc\u3057\u3066\u52a0\u7b46\u4fee\u6b63\u3057\u305f\u3082\u306e\u306a\u306e\u3067\u3001\u5143\u8a18\u4e8b\u304c\u8aad\u3081\u308b\u306a\u3089\u5143\u8a18\u4e8b\u3082\u8aad\u3080\u3053\u3068\u3092\u304a\u3059\u3059\u3081\u3057\u307e\u3059\u3002\u5185\u5bb9\u81ea\u4f53\u306f\u5143\u8a18\u4e8b\u305d\u306e\u307e\u307e\u3067\u306f\u306a\u304f\u3001\u30b3\u30fc\u30c9\u4e2d\u306e\u540d\u524d\u306a\u3069\u306e\u81ea\u5206\u306a\u308a\u306b\u610f\u5473\u304c\u901a\u308b\u3088\u3046\u306b\u5909\u66f4\u3057\u3066\u3044\u307e\u3059\u3002\u7ffb\u8a33\u8a18\u4e8b\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u8a18\u4e8b\u4e2d\u306e\u30b3\u30fc\u30c9\u306f Node.js v0.12.4 \u3067\u8efd\u304f\u52d5\u4f5c\u78ba\u8a8d\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u80cc\u666f\nHipache \u3068\u3044\u3046OSS\u3092fork\u3057\u3066\u81ea\u524d\u306e\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7Lopache\u3092\u5b9f\u88c5\u3059\u308b\u904e\u7a0b\u3067\u3001\u3069\u3046\u3084\u3063\u3066\u8584\u3044DI\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u5b9f\u88c5\u3059\u308b\u304b\u3092\u60a9\u3093\u3060\u306e\u3067\u3001\u53c2\u8003\u306e\u305f\u3081RequireJS\u306b\u304a\u3051\u308b\u95a2\u6570\u306eDI\u306b\u3064\u3044\u3066\u307e\u3068\u3081\u305f\u3002\n\u3042\u306e\u8457\u540d\u306aRequireJS\u306b\u3064\u3044\u3066\u4eca\u66f4\u30fb\u30fb\u30fb\u3068\u3044\u3046\u611f\u3058\u3082\u3059\u308b\u304c\u3001RequireJS\u306b\u304a\u3051\u308bDI\u306b\u7279\u5316\u3057\u3066\u307e\u3068\u3081\u3089\u308c\u305f\u65e5\u672c\u8a9e\u306e\u6587\u7ae0\u304c\u898b\u3064\u304b\u3089\u306a\u304b\u3063\u305f\u66f8\u3044\u3066\u307f\u308b\u3002\n\nRequireJS\u3063\u307d\u3044\u95a2\u6570\u306eDI\nRequireJS\u306b\u304a\u3051\u308b\u95a2\u6570\u306eDI\u3067\u306f\u3001\u95a2\u6570\u306e\u5f15\u6570\u3092DI\u3059\u308b\u3002\u305d\u306e\u305f\u3081\u306b\u3001DI\u3057\u305f\u3044\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u540d\u524d\u306e\u914d\u5217\u3068\u3001DI\u5148\u306e\u95a2\u6570\uff08\u5c11\u306a\u304f\u3068\u3082\u524d\u8ff0\u306e\u914d\u5217\u4ee5\u4e0a\u306e\u9577\u3055\u306e\u4eee\u5f15\u6570\u30ea\u30b9\u30c8\u3092\u6301\u3064\uff09\u306e\u4e8c\u3064\u3092\u3001\u4f9d\u5b58\u6027\u306e\u89e3\u6c7a\u3092\u3057\u3066\u304f\u308c\u308b\u30d8\u30eb\u30d1\u95a2\u6570\u306b\u6e21\u3059\u3002\n\u4ee5\u4e0b\u306fRequireJS\u306e\u3088\u3046\u306a define \u30d8\u30eb\u30d1\u95a2\u6570\u3092\u4f7f\u3046\u30b3\u30fc\u30c9\u4f8b\uff08\u540c\u3058\u3067\u306f\u306a\u3044\uff09\u3002service \u3068 router \u304cDI\u3057\u305f\u3044\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u540d\u524d\u3067\u3001\u305d\u308c\u304c\u95a2\u6570\u306e\u5f15\u6570\u3092\u901a\u3057\u3066\u6ce8\u5165\u3055\u308c\u308b\u3002\ndefine(['service', 'router'], function(service, router) {       \n    // ...\n});\n\n\u30d8\u30eb\u30d1\u95a2\u6570\u306e\u540d\u524d\u306f define \u3067\u3042\u308b\u5fc5\u8981\u306f\u306a\u3044\u3002\u4f8b\u3048\u3070 RequireJS\u3063\u307d\u3044\u306eDI\u3092\u5b9f\u73fe\u3059\u308b\u305f\u3081\u306b\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b injector \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e inject \u95a2\u6570\u3092\u4f7f\u3046\u3088\u3046\u306a\u5b9f\u88c5\u3082\u8003\u3048\u3089\u308c\u308b\u3002\nvar doSomething = injector.inject(['service', 'router'], function(service, router) {\n    expect(service().name).to.be('Service');\n    expect(router().name).to.be('Router');\n});\ndoSomething();\n\n\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u4f8b\u3067\u306f\u3001 inject \u95a2\u6570\u304c\u4f9d\u5b58\u6027\u3092\u89e3\u6c7a\u3057\u3066\u304f\u308c\u308b service \u3068 router \u4ee5\u5916\u306b\u3001other \u3092\u8981\u6c42\u3059\u308b\u3088\u3046\u306a\u95a2\u6570\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u308b\u3002inject \u306f other \u3092\u89e3\u6c7a\u3057\u306a\u3044\u3002\u3067\u306f\u3069\u3046\u3059\u308b\u304b\u3068\u3044\u3046\u3068\u3001 inject \u95a2\u6570\u306f service \u3068 router \u3060\u3051\u3092bind\u3057\u305f\u65b0\u3057\u3044\u95a2\u6570\u3092\u8fd4\u3059\u3002\u30b3\u30fc\u30c9\u4f8b\u3067\u306f doSomething \u304c\u305d\u308c\u3002\u5143\u306e\u95a2\u6570\u306e\u7b2c1\u5f15\u6570\u3068\u7b2c2\u5f15\u6570\u306fbind\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u7b2c3\u5f15\u6570\u3060\u3051\u304c\u6b8b\u308b\u3002\u3060\u304b\u3089\u3001 doSomething \u306f\u5143\u306e\u95a2\u6570\u306e\u7b2c3\u5f15\u6570\u3060\u3051\u3092\u3068\u308b1\u5f15\u6570\u306e\u95a2\u6570\u306b\u306a\u308b\u3002\nvar doSomething = injector.inject(['service', 'router'], function(service, router, other) {\n    expect(service().name).to.be('Service');\n    expect(router().name).to.be('Router');\n    expect(other).to.be('Other');\n});\ndoSomething(\"Other\");\n\n\n\u5b9f\u88c5\n\u524d\u8ff0\u306e\u300cDI\u3057\u305f\u3044\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u540d\u524d\u306e\u914d\u5217\u300d\u3092 deps\u3001\u305d\u308c\u4ee5\u4e0a\u306e\u9577\u3055\u306e\u4eee\u5f15\u6570\u30ea\u30b9\u30c8\u3092\u6301\u3064DI\u5148\u306e\u95a2\u6570\u3092 func \u3068\u3059\u308b\u3068\u3001 inject \u95a2\u6570\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9f\u88c5\u3067\u304d\u308b\u3002\nfunction(deps, func) {\n    var args = [];\n    for (var i=0; i<deps.length, d=deps[i]; i++) {\n        args.push(this.dependencies[d]);\n    }\n    return function() {\n        func.apply(null, args.concat(Array.prototype.slice.call(arguments, 0)));\n    }\n}\n\n\u3053\u306e\u307e\u307e\u3060\u3068\u3001\u300cDI\u5148\u306e\u95a2\u6570\u304c\u8981\u6c42\u3059\u308b\u6570\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304c\u4e0e\u3048\u3089\u308c\u3066\u306a\u3044\u300d\u3068\u3044\u3046\u3088\u3046\u306a\u3042\u308a\u304c\u3061\u306a\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u30a8\u30e9\u30fc\u307e\u305f\u306f\u8a2d\u5b9a\u30df\u30b9\u3092\u8d77\u3053\u3057\u305f\u6642\u3001DI\u5148\u306e\u95a2\u6570\u306e\u5b9f\u5f15\u6570\u304c undefined \u306b\u306a\u3063\u3066\u3057\u307e\u3044\u3001\u304a\u306a\u3058\u307f\u306e TypeError: Cannot read property 'foo' of undefined \u3092\u8d77\u3053\u3057\u3066\u3057\u307e\u3046\u3002\u30a8\u30e9\u30fc\u3092\u308f\u304b\u308a\u3084\u3059\u304f\u3057\u305f\u3044\u3001\u307e\u305f\u306ffail-fast\u3055\u305b\u305f\u3044\u5834\u5408\u306f\u3001\u30a8\u30e9\u30fc\u51e6\u7406\u3092\u3059\u308b\u3002\nfunction(deps, func) {\n    var args = [];\n    for (var i=0; i<deps.length, d=deps[i]; i++) {\n        if (this.dependencies[d]) {\n            args.push(this.dependencies[d]);\n        } else {\n            throw new Error('Can\\'t resolve ' + d);\n        }\n    }\n    return function() {\n        func.apply(null, args.concat(Array.prototype.slice.call(arguments, 0)));\n    }        \n}\n\n\n\u5fdc\u7528: \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306b\u5bfe\u3059\u308bDI\n\u3055\u3089\u306b\u3001\u3053\u306e\u307e\u307e\u3060\u3068\u3053\u306e\u95a2\u6570\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3068\u3057\u3066\u4f7f\u3046\u5834\u5408\u306b\u3001bind\u3055\u308c\u305f this \u304c\u6368\u3066\u3089\u308c\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u6368\u3066\u3089\u308c\u306a\u3044\u3088\u3046\u306b\u3057\u305f\u3044\u5834\u5408\u306f func.apply(this, ...) \u3057\u3066\u304a\u3051\u3070\u3088\u3044\u3002\nfunction(deps, func) {\n    var args = [];\n    for (var i=0; i<deps.length, d=deps[i]; i++) {\n        if (this.dependencies[d]) {\n            args.push(this.dependencies[d]);\n        } else {\n            throw new Error('Can\\'t resolve ' + d);\n        }\n    }\n    return function() {\n        func.apply(this, args.concat(Array.prototype.slice.call(arguments, 0)));\n    }\n}\n\n\u3053\u308c\u3089\u3092\u8e0f\u307e\u3048\u308b\u3068\u3001\u6700\u4f4e\u9650\u306e injector \u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3067\u304d\u308b\u3002\nvar injector = {\n    dependencies: {\n        service: {name:'service'},\n        router: {name:'router'}\n    },\n    inject: function(deps, func) {\n        var args = [];\n       for (var i=0; i<deps.length, d=deps[i]; i++) {\n            if (this.dependencies[d]) {\n                args.push(this.dependencies[d]);\n            } else {\n               throw new Error('Can\\'t resolve ' + d);\n            }\n       }\n        return function() {\n           func.apply(this, args.concat(Array.prototype.slice.call(arguments, 0)));\n        }\n   }\n};\n\n\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3092\u5b9a\u7fa9\u3059\u308b\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u4f7f\u3046\u3002\nvar Foo = injector.inject(['service', 'router'], function(service, router) {\n    this.service = service;\n    this.router = router;\n});\n\nnew Foo;\n//=> { service: { name: 'service' }, router: { name: 'router' } }\n\n\u3055\u3089\u306b\u3001\u5b9f\u7528\u7684\u306b\u306f injector.dependencies \u306b\u5165\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u5b9a\u7fa9\u3059\u308b\u30d8\u30eb\u30d1\u306a\u3069\u3092\u3064\u304f\u308b\u3053\u3068\u3082\u3042\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u3002\nRequireJS \u3067\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b define \u95a2\u6570\u306e\u7b2c\u4e00\u5f15\u6570\u3067\u30e2\u30b8\u30e5\u30fc\u30eb\u540d\u3092\u660e\u793a\u3057\u305f\u308a\u3001\n//Explicitly defines the \"foo/title\" module:\ndefine(\"foo/title\",\n    [\"my/cart\", \"my/inventory\"],\n    function(cart, inventory) {\n        //Define foo/title object in here.\n    }\n);\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3068\u30d5\u30a1\u30a4\u30eb\u306e\u540d\u524d\u304b\u3089\u6697\u9ed9\u7684\u306b\u30e2\u30b8\u30e5\u30fc\u30eb\u540d\u3092\u6c7a\u3081\u3066\u304f\u308c\u305f\u308a\u3059\u308b\u3002\n\n\u5fdc\u7528: \u4f9d\u5b58\u5148\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u4f5c\u6210\u3082DI\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\n\u3053\u3053\u307e\u3067\u304f\u308b\u3068\u3082\u306f\u3084\u5143\u8a18\u4e8b\u306e\u7bc4\u56f2\u5916\u3060\u304c\u3001service\u3084router\u81ea\u4f53\u306e\u4f9d\u5b58\u6027\u3082DI\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u5b8c\u7d50\u3055\u305b\u305f\u3044\u5834\u5408\u3082\u3042\u308b\u3060\u308d\u3046\u3002\n\u305d\u306e\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u5b9a\u7fa9\u3092 definitions\u3001\u5b9a\u7fa9\u304b\u3089\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u751f\u6210\u3059\u308b\u95a2\u6570\u3092 create \u3068\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5b9f\u88c5\u304c\u8003\u3048\u3089\u308c\u308b\u3002\nvar Service = function() {\n    this.name = 'service';\n};\n\nvar Router = function() {\n    this.name = 'router';\n};\n\nvar injector = {\n    dependencies: {},\n    definitions: {\n       service: [ [], Service ],\n       router: [ [], Router ]\n    },\n    create: function(name) {\n        var definition = this.definitions[name];\n        if (definition) {\n            var ctor = this.inject.apply(this, definition);\n            return new ctor();\n        } else {\n            throw new Error('Can\\'t instantiate ' + name);\n        }\n    },\n    resolve: function(name) {\n        var dep;\n        if (this.dependencies[name]) {\n            dep = this.dependencies[name];\n        } else {\n            try {\n                dep = this.create(name);\n            } catch(e) {\n                throw new Error('Can\\'t resolve ' + name);\n            }\n        }\n        return dep;\n    },\n    inject: function(deps, func) {\n        var args = [];\n       for (var i=0; i<deps.length, d=deps[i]; i++) {\n            args.push(this.resolve(d));\n       }\n        return function() {\n           func.apply(this, args.concat(Array.prototype.slice.call(arguments, 0)));\n        }\n   }\n};\n\nvar Foo = injector.inject(['service', 'router'], function(service, router) {\n    this.service = service;\n    this.router = router;\n});\n\nnew Foo;\n//=> { service: { name: 'service' }, router: { name: 'router' } }\n\n\n\u5fdc\u7528: \u4f9d\u5b58\u6027\u306e\u5faa\u74b0\u3092\u691c\u77e5\u3057\u3066\u30a8\u30e9\u30fc\u306b\u3059\u308b\n\u3055\u3089\u306b\u3001\u3053\u306e\u307e\u307e\u3060\u4f9d\u5b58\u95a2\u4fc2\u306b\u5faa\u74b0\u304c\u3042\u3063\u3066\u89e3\u6c7a\u3057\u3088\u3046\u304c\u306a\u3044\u5834\u5408\u306b\u7121\u9650\u30eb\u30fc\u30d7\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u5faa\u74b0\u304c\u3042\u308b\u3068\u304d\u306b\u306f\u30a8\u30e9\u30fc\u306b\u3057\u305f\u304f\u306a\u308b\u3002\n\u4eca\u56de\u306f\u3001\u4f9d\u5b58\u95a2\u4fc2\u306e\u30b0\u30e9\u30d5\u306b\u304a\u3044\u3066\u3001\u65e2\u306b\u767b\u5834\u3057\u305f\u672a\u89e3\u6c7a\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304c\u6b21\u306b\u767b\u5834\u3057\u305f\u3068\u304d\u306b\u30a8\u30e9\u30fc\u306b\u3059\u308b\u2026\u3068\u3044\u3046\u8003\u3048\u65b9\u3067\u3053\u308c\u3092\u5b9f\u73fe\u3057\u3066\u307f\u308b\u3002\n\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u4f8b\u3067\u306f\u3001\u610f\u56f3\u7684\u306bservice\u3068app\u306e\u9593\u306b\u4f9d\u5b58\u95a2\u4fc2\u306e\u5faa\u74b0\u3092\u3064\u304f\u3063\u3066\u3001\u305d\u308c\u3092\u691c\u77e5\u3057\u3066\u30a8\u30e9\u30fc\u306b\u3059\u308b\u3002\nvar Service = function() {\n    this.name = 'service';\n};\n\nvar Router = function() {\n    this.name = 'router';\n};\n\nvar App = function(service) {\n    this.name = 'app';\n    this.service = service;\n};\n\nvar injector = {\n    dependencies: {},\n    definitions: {\n       service: [ ['app'], Service ],\n       router: [ [], Router ],\n       app: [ ['service'], App ]\n    },\n    create: function(name, context) {\n        var context = this.contextWithDefaults(context);\n        var definition = this.definitions[name];\n        if (definition) {\n            var ctor = this.inject.apply(this, definition.concat([context]));\n            return new ctor();\n        } else {\n            throw new Error('Can\\'t instantiate ' + name);\n        }\n    },\n    resolve: function(name, context) {\n        var context = this.contextWithDefaults(context);\n        var dep;\n\n        if (context.unresolved[name]) {\n            throw new Error('Cyclic dependency from and to ' + name + ' detected');\n        } else {\n            context.unresolved[name] = true;\n        }\n\n        if (this.dependencies[name]) {\n            dep = this.dependencies[name];\n        } else {\n            try {\n                dep = this.create(name, context);\n            } catch(e) {\n                throw new Error('Can\\'t resolve ' + name + ': ' + e.message);\n            }\n        }\n        return dep;\n    },\n    inject: function(deps, func, context) {\n        var context = this.contextWithDefaults(context);\n        var args = [];\n       for (var i=0; i<deps.length, d=deps[i]; i++) {\n            args.push(this.resolve(d, context));\n       }\n        return function() {\n           func.apply(this, args.concat(Array.prototype.slice.call(arguments, 0)));\n        }\n   },\n   contextWithDefaults: function(context) {\n       return context || { unresolved: {} };\n   }\n};\n\nvar Foo = injector.inject(['service', 'router'], function(service, router) {\n    this.service = service;\n    this.router = router;\n});\n\nnew Foo;\n//=> Error: Can't resolve service: Can't resolve app: Cyclic dependency from and to service detected\n\n\u6700\u5f8c\u306e Error: Can't resolve service: Can't resolve app: Cyclic dependency from and to service detected \u3068\u3044\u3046\u30a8\u30e9\u30fc\u3092\u5de6\u304b\u3089\u8aad\u3080\u3068\u3001\u300cservice\u3092\u89e3\u6c7a\u3067\u304d\u306a\u304b\u3063\u305f\u539f\u56e0\u306fapp\u3092\u89e3\u6c7a\u3067\u304d\u306a\u304b\u3063\u305f\u3053\u3068\u3067\u3001\u305d\u306e\u539f\u56e0\u306fservice\u304b\u3089service\u3078\u306e\u4f9d\u5b58\u95a2\u4fc2\u306e\u5faa\u74b0\u304c\u691c\u77e5\u3055\u308c\u305f\u3053\u3068\u300d\u3068\u306a\u308b\u3002\u30b3\u30fc\u30c9\u4f8b\u3067\u306fservice\u3082app\u3082\u5faa\u74b0\u3057\u3066\u3044\u308b\u3068\u3044\u3048\u308b\u304c\u3001\u4eca\u56de\u306fservice\u306e\u5faa\u74b0\u304c\u691c\u77e5\u3055\u308c\u305f\u3002\u3053\u308c\u306f\u3001\u4eca\u56de\u306f Foo \u306e\u5b9a\u7fa9\u306b\u3088\u3063\u3066app\u3088\u308a\u5148\u306bservice\u3092\u89e3\u6c7a\u3057\u3088\u3046\u3068\u3059\u308b\u306e\u3067\u3001\u4f9d\u5b58\u95a2\u4fc2\u30b0\u30e9\u30d5\u306b\u304a\u3044\u3066\u307e\u305aservice\u304c\u767b\u5834\u3059\u308b\u304b\u3089\u3002\n\n\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u5b9a\u7fa9\u3082\u30d8\u30eb\u30d1\u95a2\u6570\u3067\n\u518d\u5229\u7528\u6027\u3084\u4fdd\u5b88\u6027\u3092\u8003\u3048\u308b\u3068\u3001 injector.definitions \u3092 injector \u306b\u30cf\u30fc\u30c9\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3059\u308b\u306e\u306f\u907f\u3051\u305f\u304f\u306a\u308b\u3002\nvar injector = {\n    definitions: {\n       service: [ ['app'], Service ],\n       router: [ [], Router ],\n       app: [ ['service'], App ]\n    },\n\n\u30cf\u30fc\u30c9\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u907f\u3051\u308b\u305f\u3081\u306b\u306f\u3001\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u5b9a\u7fa9\u3059\u308b\u30d8\u30eb\u30d1\u95a2\u6570\u3092\u3064\u304f\u308b\u3068\u3044\u3046\u65b9\u6cd5\u304c\u8003\u3048\u3089\u308c\u308b\u3002\n\u4f8b\u3048\u3070\u3001\u305d\u306e\u95a2\u6570\u3092 define \u3068\u3044\u3046\u540d\u524d\u306b\u3057\u305f\u3068\u3059\u308b\u3068\u3001\ninjector.define('service', [], Service);\ninjector.define('router', [], Router);\n\n\u3053\u306e\u3088\u3046\u306b\u66f8\u3051\u306a\u3044\u3060\u308d\u3046\u304b\u3002\n\u3068\u3044\u3046\u308f\u3051\u3067\u3001\u4ee5\u4e0b\u306b\u305d\u306e\u5b9f\u88c5\u4f8b\u3092\u793a\u3059\u3002\nvar Service = function() {\n    this.name = 'service';\n};\n\nvar Router = function() {\n    this.name = 'router';\n};\n\nvar injector = {\n    dependencies: {},\n    definitions: {},\n    define: function(name, deps, func) {\n        this.definitions[name] = [deps, func];\n    },\n    create: function(name, context) {\n        var context = this.contextWithDefaults(context);\n        var definition = this.definitions[name];\n        if (definition) {\n            var ctor = this.inject.apply(this, definition.concat([context]));\n            return new ctor();\n        } else {\n            throw new Error('Can\\'t instantiate ' + name);\n        }\n    },\n    resolve: function(name, context) {\n        var context = this.contextWithDefaults(context);\n        var dep;\n\n        if (context.unresolved[name]) {\n            throw new Error('Cyclic dependency from and to ' + name + ' detected');\n        } else {\n            context.unresolved[name] = true;\n        }\n\n        if (this.dependencies[name]) {\n            dep = this.dependencies[name];\n        } else {\n            try {\n                dep = this.create(name, context);\n            } catch(e) {\n                throw new Error('Can\\'t resolve ' + name + ': ' + e.message);\n            }\n        }\n        return dep;\n    },\n    inject: function(deps, func, context) {\n        var context = this.contextWithDefaults(context);\n        var args = [];\n       for (var i=0; i<deps.length, d=deps[i]; i++) {\n            args.push(this.resolve(d, context));\n       }\n        return function() {\n           func.apply(this, args.concat(Array.prototype.slice.call(arguments, 0)));\n        }\n   },\n   contextWithDefaults: function(context) {\n       return context || { unresolved: {} };\n   }\n};\n\ninjector.define('service', [], Service);\ninjector.define('router', [], Router);\n\nvar Foo = injector.inject(['service', 'router'], function(service, router) {\n    this.service = service;\n    this.router = router;\n});\n\nnew Foo;\n//=> { service: { name: 'service' }, router: { name: 'router' } }\n\n\n\u307e\u3068\u3081\n\u307e\u3068\u3081\u308b\u3068\u3001\n(1) \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u540d\u524d\u306e\u30ea\u30b9\u30c8\n(2) (1)\u4ee5\u4e0a\u306e\u9577\u3055\u306e\u4eee\u5f15\u6570\u30ea\u30b9\u30c8\u3092\u6301\u3064\u95a2\u6570\n\u304c\u3042\u3063\u3066\u3001(1)\u3068(2)\u3092\u3068\u308b\u3088\u3046\u306a\u30d8\u30eb\u30d1\u95a2\u6570\u3092\u4f7f\u3063\u3066\u3001RequireJS\u3063\u307d\u3044\u95a2\u6570\u306eDI\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u5b9f\u88c5\u3067\u304d\u308b\u3002\n\u5fdc\u7528\u3059\u308b\u3068\u3001\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u5f15\u6570\u3078DI\u3057\u305f\u308a\u3001\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u751f\u6210\u3082DI\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u9762\u5012\u307f\u305f\u308a\u3001\u5faa\u74b0\u4f9d\u5b58\u306e\u691c\u77e5\u3057\u305f\u308a\u306a\u3069\u8272\u3005\u3067\u304d\u308b\u3002\n\n\u3082\u3063\u3068\u8a73\u3057\u304f\u77e5\u308a\u305f\u3044\u65b9\u3078\n\u3055\u307e\u3056\u307e\u306aDI\u306e\u5b9f\u88c5\u65b9\u6cd5\u307e\u3067\u8e0f\u307f\u8fbc\u3093\u3060\u89e3\u8aac\u306f Dependency injection in JavaScript \u306b\u8a73\u3057\u304f\u66f8\u304b\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u8aad\u3082\u3046\u3002\n\nTL;DR; \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u540d\u524d\u306e\u914d\u5217\u3001\u305d\u308c\u4ee5\u4e0a\u306e\u9577\u3055\u306e\u4eee\u5f15\u6570\u30ea\u30b9\u30c8\u3092\u6301\u3064\u95a2\u6570\u3001\u305d\u3057\u3066\u305d\u308c\u3089\u3092\u5f15\u6570\u306b\u3068\u308b\u3088\u3046\u306a\u30d8\u30eb\u30d1\u95a2\u6570\u3092\u4f7f\u3063\u3066DI\u3092\u5b9f\u73fe\u3059\u308b\u3002\u5fdc\u7528\u3059\u308b\u3068\u3001\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u5f15\u6570\u3078DI\u3057\u305f\u308a\u3001\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u751f\u6210\u3082DI\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u9762\u5012\u307f\u305f\u308a\u3001\u5faa\u74b0\u4f9d\u5b58\u306e\u691c\u77e5\u3057\u305f\u308a\u306a\u3069\u8272\u3005\u3067\u304d\u308b\u3002\n\n## \u524d\u7f6e\u304d\n\n[Dependency injection in JavaScript](http://krasimirtsonev.com/blog/article/Dependency-injection-in-JavaScript) \u306e\u4e00\u90e8\u3092\u81ea\u5206\u306a\u308a\u306b\u5480\u56bc\u3057\u3066\u52a0\u7b46\u4fee\u6b63\u3057\u305f\u3082\u306e\u306a\u306e\u3067\u3001\u5143\u8a18\u4e8b\u304c\u8aad\u3081\u308b\u306a\u3089\u5143\u8a18\u4e8b\u3082\u8aad\u3080\u3053\u3068\u3092\u304a\u3059\u3059\u3081\u3057\u307e\u3059\u3002\u5185\u5bb9\u81ea\u4f53\u306f\u5143\u8a18\u4e8b\u305d\u306e\u307e\u307e\u3067\u306f\u306a\u304f\u3001\u30b3\u30fc\u30c9\u4e2d\u306e\u540d\u524d\u306a\u3069\u306e\u81ea\u5206\u306a\u308a\u306b\u610f\u5473\u304c\u901a\u308b\u3088\u3046\u306b\u5909\u66f4\u3057\u3066\u3044\u307e\u3059\u3002\u7ffb\u8a33\u8a18\u4e8b\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n\u8a18\u4e8b\u4e2d\u306e\u30b3\u30fc\u30c9\u306f Node.js v0.12.4 \u3067\u8efd\u304f\u52d5\u4f5c\u78ba\u8a8d\u3057\u3066\u3044\u307e\u3059\u3002\n\n## \u80cc\u666f\n\n[Hipache](https://github.com/hipache/hipache) \u3068\u3044\u3046OSS\u3092fork\u3057\u3066\u81ea\u524d\u306e\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7[Lopache](https://github.com/crowdworks/lopache)\u3092\u5b9f\u88c5\u3059\u308b\u904e\u7a0b\u3067\u3001\u3069\u3046\u3084\u3063\u3066\u8584\u3044DI\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u5b9f\u88c5\u3059\u308b\u304b\u3092\u60a9\u3093\u3060\u306e\u3067\u3001\u53c2\u8003\u306e\u305f\u3081RequireJS\u306b\u304a\u3051\u308b\u95a2\u6570\u306eDI\u306b\u3064\u3044\u3066\u307e\u3068\u3081\u305f\u3002\n\n\u3042\u306e\u8457\u540d\u306aRequireJS\u306b\u3064\u3044\u3066\u4eca\u66f4\u30fb\u30fb\u30fb\u3068\u3044\u3046\u611f\u3058\u3082\u3059\u308b\u304c\u3001RequireJS\u306b\u304a\u3051\u308bDI\u306b\u7279\u5316\u3057\u3066\u307e\u3068\u3081\u3089\u308c\u305f\u65e5\u672c\u8a9e\u306e\u6587\u7ae0\u304c\u898b\u3064\u304b\u3089\u306a\u304b\u3063\u305f\u66f8\u3044\u3066\u307f\u308b\u3002\n\n## RequireJS\u3063\u307d\u3044\u95a2\u6570\u306eDI\n\nRequireJS\u306b\u304a\u3051\u308b\u95a2\u6570\u306eDI\u3067\u306f\u3001\u95a2\u6570\u306e\u5f15\u6570\u3092DI\u3059\u308b\u3002\u305d\u306e\u305f\u3081\u306b\u3001DI\u3057\u305f\u3044\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u540d\u524d\u306e\u914d\u5217\u3068\u3001DI\u5148\u306e\u95a2\u6570\uff08\u5c11\u306a\u304f\u3068\u3082\u524d\u8ff0\u306e\u914d\u5217\u4ee5\u4e0a\u306e\u9577\u3055\u306e\u4eee\u5f15\u6570\u30ea\u30b9\u30c8\u3092\u6301\u3064\uff09\u306e\u4e8c\u3064\u3092\u3001\u4f9d\u5b58\u6027\u306e\u89e3\u6c7a\u3092\u3057\u3066\u304f\u308c\u308b\u30d8\u30eb\u30d1\u95a2\u6570\u306b\u6e21\u3059\u3002\n\n\u4ee5\u4e0b\u306f[RequireJS](http://requirejs.org/docs/api.html#define)\u306e\u3088\u3046\u306a `define` \u30d8\u30eb\u30d1\u95a2\u6570\u3092\u4f7f\u3046\u30b3\u30fc\u30c9\u4f8b\uff08\u540c\u3058\u3067\u306f\u306a\u3044\uff09\u3002`service` \u3068 `router` \u304cDI\u3057\u305f\u3044\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u540d\u524d\u3067\u3001\u305d\u308c\u304c\u95a2\u6570\u306e\u5f15\u6570\u3092\u901a\u3057\u3066\u6ce8\u5165\u3055\u308c\u308b\u3002\n\n```javascript\ndefine(['service', 'router'], function(service, router) {       \n    // ...\n});\n```\n\n\u30d8\u30eb\u30d1\u95a2\u6570\u306e\u540d\u524d\u306f `define` \u3067\u3042\u308b\u5fc5\u8981\u306f\u306a\u3044\u3002\u4f8b\u3048\u3070 RequireJS\u3063\u307d\u3044\u306eDI\u3092\u5b9f\u73fe\u3059\u308b\u305f\u3081\u306b\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b `injector` \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e `inject` \u95a2\u6570\u3092\u4f7f\u3046\u3088\u3046\u306a\u5b9f\u88c5\u3082\u8003\u3048\u3089\u308c\u308b\u3002\n\n```javascript\nvar doSomething = injector.inject(['service', 'router'], function(service, router) {\n    expect(service().name).to.be('Service');\n    expect(router().name).to.be('Router');\n});\ndoSomething();\n```\n\n\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u4f8b\u3067\u306f\u3001 `inject` \u95a2\u6570\u304c\u4f9d\u5b58\u6027\u3092\u89e3\u6c7a\u3057\u3066\u304f\u308c\u308b `service` \u3068 `router` \u4ee5\u5916\u306b\u3001`other` \u3092\u8981\u6c42\u3059\u308b\u3088\u3046\u306a\u95a2\u6570\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u308b\u3002`inject` \u306f `other` \u3092\u89e3\u6c7a\u3057\u306a\u3044\u3002\u3067\u306f\u3069\u3046\u3059\u308b\u304b\u3068\u3044\u3046\u3068\u3001 `inject` \u95a2\u6570\u306f `service` \u3068 `router` \u3060\u3051\u3092bind\u3057\u305f\u65b0\u3057\u3044\u95a2\u6570\u3092\u8fd4\u3059\u3002\u30b3\u30fc\u30c9\u4f8b\u3067\u306f `doSomething` \u304c\u305d\u308c\u3002\u5143\u306e\u95a2\u6570\u306e\u7b2c1\u5f15\u6570\u3068\u7b2c2\u5f15\u6570\u306fbind\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u7b2c3\u5f15\u6570\u3060\u3051\u304c\u6b8b\u308b\u3002\u3060\u304b\u3089\u3001 `doSomething` \u306f\u5143\u306e\u95a2\u6570\u306e\u7b2c3\u5f15\u6570\u3060\u3051\u3092\u3068\u308b1\u5f15\u6570\u306e\u95a2\u6570\u306b\u306a\u308b\u3002\n\n```javascript\nvar doSomething = injector.inject(['service', 'router'], function(service, router, other) {\n    expect(service().name).to.be('Service');\n    expect(router().name).to.be('Router');\n    expect(other).to.be('Other');\n});\ndoSomething(\"Other\");\n```\n\n## \u5b9f\u88c5\n\n\u524d\u8ff0\u306e\u300cDI\u3057\u305f\u3044\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u540d\u524d\u306e\u914d\u5217\u300d\u3092 `deps`\u3001\u305d\u308c\u4ee5\u4e0a\u306e\u9577\u3055\u306e\u4eee\u5f15\u6570\u30ea\u30b9\u30c8\u3092\u6301\u3064DI\u5148\u306e\u95a2\u6570\u3092 `func` \u3068\u3059\u308b\u3068\u3001 `inject` \u95a2\u6570\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9f\u88c5\u3067\u304d\u308b\u3002\n\n```javascript\nfunction(deps, func) {\n    var args = [];\n    for (var i=0; i<deps.length, d=deps[i]; i++) {\n        args.push(this.dependencies[d]);\n    }\n    return function() {\n        func.apply(null, args.concat(Array.prototype.slice.call(arguments, 0)));\n    }\n}\n```\n\n\u3053\u306e\u307e\u307e\u3060\u3068\u3001\u300cDI\u5148\u306e\u95a2\u6570\u304c\u8981\u6c42\u3059\u308b\u6570\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304c\u4e0e\u3048\u3089\u308c\u3066\u306a\u3044\u300d\u3068\u3044\u3046\u3088\u3046\u306a\u3042\u308a\u304c\u3061\u306a\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u30a8\u30e9\u30fc\u307e\u305f\u306f\u8a2d\u5b9a\u30df\u30b9\u3092\u8d77\u3053\u3057\u305f\u6642\u3001DI\u5148\u306e\u95a2\u6570\u306e\u5b9f\u5f15\u6570\u304c `undefined` \u306b\u306a\u3063\u3066\u3057\u307e\u3044\u3001\u304a\u306a\u3058\u307f\u306e `TypeError: Cannot read property 'foo' of undefined` \u3092\u8d77\u3053\u3057\u3066\u3057\u307e\u3046\u3002\u30a8\u30e9\u30fc\u3092\u308f\u304b\u308a\u3084\u3059\u304f\u3057\u305f\u3044\u3001\u307e\u305f\u306ffail-fast\u3055\u305b\u305f\u3044\u5834\u5408\u306f\u3001\u30a8\u30e9\u30fc\u51e6\u7406\u3092\u3059\u308b\u3002\n\n```javascript\nfunction(deps, func) {\n    var args = [];\n    for (var i=0; i<deps.length, d=deps[i]; i++) {\n        if (this.dependencies[d]) {\n            args.push(this.dependencies[d]);\n        } else {\n            throw new Error('Can\\'t resolve ' + d);\n        }\n    }\n    return function() {\n        func.apply(null, args.concat(Array.prototype.slice.call(arguments, 0)));\n    }        \n}\n```\n\n## \u5fdc\u7528: \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306b\u5bfe\u3059\u308bDI\n\n\u3055\u3089\u306b\u3001\u3053\u306e\u307e\u307e\u3060\u3068\u3053\u306e\u95a2\u6570\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3068\u3057\u3066\u4f7f\u3046\u5834\u5408\u306b\u3001bind\u3055\u308c\u305f `this` \u304c\u6368\u3066\u3089\u308c\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u6368\u3066\u3089\u308c\u306a\u3044\u3088\u3046\u306b\u3057\u305f\u3044\u5834\u5408\u306f `func.apply(this, ...)` \u3057\u3066\u304a\u3051\u3070\u3088\u3044\u3002\n\n```javascript\nfunction(deps, func) {\n    var args = [];\n    for (var i=0; i<deps.length, d=deps[i]; i++) {\n        if (this.dependencies[d]) {\n            args.push(this.dependencies[d]);\n        } else {\n            throw new Error('Can\\'t resolve ' + d);\n        }\n    }\n    return function() {\n        func.apply(this, args.concat(Array.prototype.slice.call(arguments, 0)));\n    }\n}\n```\n\n\u3053\u308c\u3089\u3092\u8e0f\u307e\u3048\u308b\u3068\u3001\u6700\u4f4e\u9650\u306e `injector` \u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3067\u304d\u308b\u3002\n\n```javascript\nvar injector = {\n    dependencies: {\n        service: {name:'service'},\n        router: {name:'router'}\n    },\n    inject: function(deps, func) {\n\t    var args = [];\n       for (var i=0; i<deps.length, d=deps[i]; i++) {\n            if (this.dependencies[d]) {\n                args.push(this.dependencies[d]);\n\t        } else {\n               throw new Error('Can\\'t resolve ' + d);\n\t        }\n       }\n\t    return function() {\n           func.apply(this, args.concat(Array.prototype.slice.call(arguments, 0)));\n\t    }\n   }\n};\n```\n\n\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3092\u5b9a\u7fa9\u3059\u308b\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u4f7f\u3046\u3002\n\n```javascript\nvar Foo = injector.inject(['service', 'router'], function(service, router) {\n    this.service = service;\n    this.router = router;\n});\n\nnew Foo;\n//=> { service: { name: 'service' }, router: { name: 'router' } }\n```\n\n\u3055\u3089\u306b\u3001\u5b9f\u7528\u7684\u306b\u306f `injector.dependencies` \u306b\u5165\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u5b9a\u7fa9\u3059\u308b\u30d8\u30eb\u30d1\u306a\u3069\u3092\u3064\u304f\u308b\u3053\u3068\u3082\u3042\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u3002\nRequireJS \u3067\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b [`define` \u95a2\u6570\u306e\u7b2c\u4e00\u5f15\u6570\u3067\u30e2\u30b8\u30e5\u30fc\u30eb\u540d\u3092\u660e\u793a\u3057\u305f\u308a](http://requirejs.org/docs/api.html#modulename\n)\u3001\n\n```javascript\n//Explicitly defines the \"foo/title\" module:\ndefine(\"foo/title\",\n    [\"my/cart\", \"my/inventory\"],\n    function(cart, inventory) {\n        //Define foo/title object in here.\n    }\n);\n```\n\n[\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3068\u30d5\u30a1\u30a4\u30eb\u306e\u540d\u524d\u304b\u3089\u6697\u9ed9\u7684\u306b\u30e2\u30b8\u30e5\u30fc\u30eb\u540d\u3092\u6c7a\u3081\u3066\u304f\u308c\u305f\u308a\u3059\u308b](http://requirejs.org/docs/api.html#defdep)\u3002\n\n## \u5fdc\u7528: \u4f9d\u5b58\u5148\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u4f5c\u6210\u3082DI\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\n\n\u3053\u3053\u307e\u3067\u304f\u308b\u3068\u3082\u306f\u3084\u5143\u8a18\u4e8b\u306e\u7bc4\u56f2\u5916\u3060\u304c\u3001service\u3084router\u81ea\u4f53\u306e\u4f9d\u5b58\u6027\u3082DI\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u5b8c\u7d50\u3055\u305b\u305f\u3044\u5834\u5408\u3082\u3042\u308b\u3060\u308d\u3046\u3002\n\u305d\u306e\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u5b9a\u7fa9\u3092 `definitions`\u3001\u5b9a\u7fa9\u304b\u3089\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u751f\u6210\u3059\u308b\u95a2\u6570\u3092 `create` \u3068\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5b9f\u88c5\u304c\u8003\u3048\u3089\u308c\u308b\u3002\n\n```javascript\nvar Service = function() {\n    this.name = 'service';\n};\n\nvar Router = function() {\n    this.name = 'router';\n};\n\nvar injector = {\n    dependencies: {},\n    definitions: {\n       service: [ [], Service ],\n       router: [ [], Router ]\n    },\n    create: function(name) {\n        var definition = this.definitions[name];\n        if (definition) {\n            var ctor = this.inject.apply(this, definition);\n\t        return new ctor();\n\t    } else {\n            throw new Error('Can\\'t instantiate ' + name);\n        }\n    },\n    resolve: function(name) {\n        var dep;\n        if (this.dependencies[name]) {\n            dep = this.dependencies[name];\n\t    } else {\n\t        try {\n\t            dep = this.create(name);\n\t        } catch(e) {\n\t            throw new Error('Can\\'t resolve ' + name);\n\t        }\n\t    }\n\t    return dep;\n    },\n    inject: function(deps, func) {\n\t    var args = [];\n       for (var i=0; i<deps.length, d=deps[i]; i++) {\n            args.push(this.resolve(d));\n       }\n\t    return function() {\n           func.apply(this, args.concat(Array.prototype.slice.call(arguments, 0)));\n\t    }\n   }\n};\n\nvar Foo = injector.inject(['service', 'router'], function(service, router) {\n    this.service = service;\n    this.router = router;\n});\n\nnew Foo;\n//=> { service: { name: 'service' }, router: { name: 'router' } }\n```\n\n## \u5fdc\u7528: \u4f9d\u5b58\u6027\u306e\u5faa\u74b0\u3092\u691c\u77e5\u3057\u3066\u30a8\u30e9\u30fc\u306b\u3059\u308b\n\n\u3055\u3089\u306b\u3001\u3053\u306e\u307e\u307e\u3060\u4f9d\u5b58\u95a2\u4fc2\u306b\u5faa\u74b0\u304c\u3042\u3063\u3066\u89e3\u6c7a\u3057\u3088\u3046\u304c\u306a\u3044\u5834\u5408\u306b\u7121\u9650\u30eb\u30fc\u30d7\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u5faa\u74b0\u304c\u3042\u308b\u3068\u304d\u306b\u306f\u30a8\u30e9\u30fc\u306b\u3057\u305f\u304f\u306a\u308b\u3002\n\u4eca\u56de\u306f\u3001\u4f9d\u5b58\u95a2\u4fc2\u306e\u30b0\u30e9\u30d5\u306b\u304a\u3044\u3066\u3001\u65e2\u306b\u767b\u5834\u3057\u305f\u672a\u89e3\u6c7a\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304c\u6b21\u306b\u767b\u5834\u3057\u305f\u3068\u304d\u306b\u30a8\u30e9\u30fc\u306b\u3059\u308b\u2026\u3068\u3044\u3046\u8003\u3048\u65b9\u3067\u3053\u308c\u3092\u5b9f\u73fe\u3057\u3066\u307f\u308b\u3002\n\n\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u4f8b\u3067\u306f\u3001\u610f\u56f3\u7684\u306bservice\u3068app\u306e\u9593\u306b\u4f9d\u5b58\u95a2\u4fc2\u306e\u5faa\u74b0\u3092\u3064\u304f\u3063\u3066\u3001\u305d\u308c\u3092\u691c\u77e5\u3057\u3066\u30a8\u30e9\u30fc\u306b\u3059\u308b\u3002\n\n```javascript\nvar Service = function() {\n    this.name = 'service';\n};\n\nvar Router = function() {\n    this.name = 'router';\n};\n\nvar App = function(service) {\n    this.name = 'app';\n    this.service = service;\n};\n\nvar injector = {\n    dependencies: {},\n    definitions: {\n       service: [ ['app'], Service ],\n       router: [ [], Router ],\n       app: [ ['service'], App ]\n    },\n    create: function(name, context) {\n        var context = this.contextWithDefaults(context);\n        var definition = this.definitions[name];\n        if (definition) {\n            var ctor = this.inject.apply(this, definition.concat([context]));\n\t        return new ctor();\n\t    } else {\n            throw new Error('Can\\'t instantiate ' + name);\n        }\n    },\n    resolve: function(name, context) {\n        var context = this.contextWithDefaults(context);\n        var dep;\n\n        if (context.unresolved[name]) {\n            throw new Error('Cyclic dependency from and to ' + name + ' detected');\n        } else {\n            context.unresolved[name] = true;\n        }\n\n        if (this.dependencies[name]) {\n            dep = this.dependencies[name];\n\t    } else {\n\t        try {\n\t            dep = this.create(name, context);\n\t        } catch(e) {\n\t            throw new Error('Can\\'t resolve ' + name + ': ' + e.message);\n\t        }\n\t    }\n\t    return dep;\n    },\n    inject: function(deps, func, context) {\n        var context = this.contextWithDefaults(context);\n\t    var args = [];\n       for (var i=0; i<deps.length, d=deps[i]; i++) {\n            args.push(this.resolve(d, context));\n       }\n\t    return function() {\n           func.apply(this, args.concat(Array.prototype.slice.call(arguments, 0)));\n\t    }\n   },\n   contextWithDefaults: function(context) {\n       return context || { unresolved: {} };\n   }\n};\n\nvar Foo = injector.inject(['service', 'router'], function(service, router) {\n    this.service = service;\n    this.router = router;\n});\n\nnew Foo;\n//=> Error: Can't resolve service: Can't resolve app: Cyclic dependency from and to service detected\n```\n\n\u6700\u5f8c\u306e `Error: Can't resolve service: Can't resolve app: Cyclic dependency from and to service detected` \u3068\u3044\u3046\u30a8\u30e9\u30fc\u3092\u5de6\u304b\u3089\u8aad\u3080\u3068\u3001\u300cservice\u3092\u89e3\u6c7a\u3067\u304d\u306a\u304b\u3063\u305f\u539f\u56e0\u306fapp\u3092\u89e3\u6c7a\u3067\u304d\u306a\u304b\u3063\u305f\u3053\u3068\u3067\u3001\u305d\u306e\u539f\u56e0\u306fservice\u304b\u3089service\u3078\u306e\u4f9d\u5b58\u95a2\u4fc2\u306e\u5faa\u74b0\u304c\u691c\u77e5\u3055\u308c\u305f\u3053\u3068\u300d\u3068\u306a\u308b\u3002\u30b3\u30fc\u30c9\u4f8b\u3067\u306fservice\u3082app\u3082\u5faa\u74b0\u3057\u3066\u3044\u308b\u3068\u3044\u3048\u308b\u304c\u3001\u4eca\u56de\u306fservice\u306e\u5faa\u74b0\u304c\u691c\u77e5\u3055\u308c\u305f\u3002\u3053\u308c\u306f\u3001\u4eca\u56de\u306f `Foo` \u306e\u5b9a\u7fa9\u306b\u3088\u3063\u3066app\u3088\u308a\u5148\u306bservice\u3092\u89e3\u6c7a\u3057\u3088\u3046\u3068\u3059\u308b\u306e\u3067\u3001\u4f9d\u5b58\u95a2\u4fc2\u30b0\u30e9\u30d5\u306b\u304a\u3044\u3066\u307e\u305aservice\u304c\u767b\u5834\u3059\u308b\u304b\u3089\u3002\n\n## \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u5b9a\u7fa9\u3082\u30d8\u30eb\u30d1\u95a2\u6570\u3067\n\n\u518d\u5229\u7528\u6027\u3084\u4fdd\u5b88\u6027\u3092\u8003\u3048\u308b\u3068\u3001 `injector.definitions` \u3092 `injector` \u306b\u30cf\u30fc\u30c9\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3059\u308b\u306e\u306f\u907f\u3051\u305f\u304f\u306a\u308b\u3002\n\n```\nvar injector = {\n    definitions: {\n       service: [ ['app'], Service ],\n       router: [ [], Router ],\n       app: [ ['service'], App ]\n    },\n```\n\n\u30cf\u30fc\u30c9\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u907f\u3051\u308b\u305f\u3081\u306b\u306f\u3001\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u5b9a\u7fa9\u3059\u308b\u30d8\u30eb\u30d1\u95a2\u6570\u3092\u3064\u304f\u308b\u3068\u3044\u3046\u65b9\u6cd5\u304c\u8003\u3048\u3089\u308c\u308b\u3002\n\u4f8b\u3048\u3070\u3001\u305d\u306e\u95a2\u6570\u3092 `define` \u3068\u3044\u3046\u540d\u524d\u306b\u3057\u305f\u3068\u3059\u308b\u3068\u3001\n\n```\ninjector.define('service', [], Service);\ninjector.define('router', [], Router);\n```\n\n\u3053\u306e\u3088\u3046\u306b\u66f8\u3051\u306a\u3044\u3060\u308d\u3046\u304b\u3002\n\n\u3068\u3044\u3046\u308f\u3051\u3067\u3001\u4ee5\u4e0b\u306b\u305d\u306e\u5b9f\u88c5\u4f8b\u3092\u793a\u3059\u3002\n\n```\nvar Service = function() {\n    this.name = 'service';\n};\n\nvar Router = function() {\n    this.name = 'router';\n};\n\nvar injector = {\n    dependencies: {},\n    definitions: {},\n    define: function(name, deps, func) {\n        this.definitions[name] = [deps, func];\n    },\n    create: function(name, context) {\n        var context = this.contextWithDefaults(context);\n        var definition = this.definitions[name];\n        if (definition) {\n            var ctor = this.inject.apply(this, definition.concat([context]));\n\t        return new ctor();\n\t    } else {\n            throw new Error('Can\\'t instantiate ' + name);\n        }\n    },\n    resolve: function(name, context) {\n        var context = this.contextWithDefaults(context);\n        var dep;\n\n        if (context.unresolved[name]) {\n            throw new Error('Cyclic dependency from and to ' + name + ' detected');\n        } else {\n            context.unresolved[name] = true;\n        }\n\n        if (this.dependencies[name]) {\n            dep = this.dependencies[name];\n\t    } else {\n\t        try {\n\t            dep = this.create(name, context);\n\t        } catch(e) {\n\t            throw new Error('Can\\'t resolve ' + name + ': ' + e.message);\n\t        }\n\t    }\n\t    return dep;\n    },\n    inject: function(deps, func, context) {\n        var context = this.contextWithDefaults(context);\n\t    var args = [];\n       for (var i=0; i<deps.length, d=deps[i]; i++) {\n            args.push(this.resolve(d, context));\n       }\n\t    return function() {\n           func.apply(this, args.concat(Array.prototype.slice.call(arguments, 0)));\n\t    }\n   },\n   contextWithDefaults: function(context) {\n       return context || { unresolved: {} };\n   }\n};\n\ninjector.define('service', [], Service);\ninjector.define('router', [], Router);\n\nvar Foo = injector.inject(['service', 'router'], function(service, router) {\n    this.service = service;\n    this.router = router;\n});\n\nnew Foo;\n//=> { service: { name: 'service' }, router: { name: 'router' } }\n```\n\n## \u307e\u3068\u3081\n\n\u307e\u3068\u3081\u308b\u3068\u3001\n\n(1) \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u540d\u524d\u306e\u30ea\u30b9\u30c8\n(2) (1)\u4ee5\u4e0a\u306e\u9577\u3055\u306e\u4eee\u5f15\u6570\u30ea\u30b9\u30c8\u3092\u6301\u3064\u95a2\u6570\n\n\u304c\u3042\u3063\u3066\u3001(1)\u3068(2)\u3092\u3068\u308b\u3088\u3046\u306a\u30d8\u30eb\u30d1\u95a2\u6570\u3092\u4f7f\u3063\u3066\u3001RequireJS\u3063\u307d\u3044\u95a2\u6570\u306eDI\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u5b9f\u88c5\u3067\u304d\u308b\u3002\n\n\u5fdc\u7528\u3059\u308b\u3068\u3001\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u5f15\u6570\u3078DI\u3057\u305f\u308a\u3001\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u751f\u6210\u3082DI\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u9762\u5012\u307f\u305f\u308a\u3001\u5faa\u74b0\u4f9d\u5b58\u306e\u691c\u77e5\u3057\u305f\u308a\u306a\u3069\u8272\u3005\u3067\u304d\u308b\u3002\n\n## \u3082\u3063\u3068\u8a73\u3057\u304f\u77e5\u308a\u305f\u3044\u65b9\u3078\n\n\u3055\u307e\u3056\u307e\u306aDI\u306e\u5b9f\u88c5\u65b9\u6cd5\u307e\u3067\u8e0f\u307f\u8fbc\u3093\u3060\u89e3\u8aac\u306f [Dependency injection in JavaScript](http://krasimirtsonev.com/blog/article/Dependency-injection-in-JavaScript) \u306b\u8a73\u3057\u304f\u66f8\u304b\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u8aad\u3082\u3046\u3002\n", "tags": ["DI", "JavaScript"]}