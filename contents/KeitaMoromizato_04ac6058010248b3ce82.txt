{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u3042\u308b\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u4ed5\u69d8\u66f8\u3092\u305d\u308c\u306a\u308a\u306e\u30af\u30aa\u30ea\u30c6\u30a3\u3067\u66f8\u304f\u5fc5\u8981\u304c\u51fa\u3066\u304d\u307e\u3057\u305f\u3002Markdown\u3067\u66f8\u304d\u305f\u3044\u306a\u30fc\u3068\u304b\u5c65\u6b74\u7ba1\u7406\u3057\u305f\u3044\u306a\u30fc\u3068\u601d\u3063\u3066\u3044\u305f\u306e\u3067\u3001GitHub\u3067\u7ba1\u7406\u3057\u3066GitBook\u3068\u3057\u3066\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u5316\u3059\u308b\u3053\u3068\u306b\u6c7a\u3081\u307e\u3057\u305f\u3002\n\n\u5185\u5bb9\n\nGitBook\u3068\u306f\uff1f\n\u300cMarkdown\u3067\u7c21\u5358\u306b\u96fb\u5b50\u66f8\u7c4d\u304c\u4f5c\u308c\u308b\u3088\u300d\u3068\u3044\u3046\u3082\u306e\u3067\u3059\u3002GitHub\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u3092\u6307\u5b9a\u3059\u308b\u3068\u52dd\u624b\u306b\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u3057\u3066\u304f\u308c\u308b gitbook.com \u3068\u3044\u3046\u30b5\u30fc\u30d3\u30b9\u306e\u4ed6\u306b\u3001OSS\u3067\u3082\u516c\u958b\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u81ea\u524d\u306e\u69cb\u7bc9\u3082\u53ef\u80fd\u3067\u3059\u3002\ngitbook.com \u3092\u4f7f\u3048\u3070\u304b\u306a\u308a\u697d\u304c\u51fa\u6765\u307e\u3059\u304c\u3001\u4ee5\u4e0b\u306e2\u70b9\u304c\u554f\u984c\u70b9\u3068\u3057\u3066\u3042\u308a\u307e\u3057\u305f\u3002\n\n\u78ba\u8a8d\u3057\u305f\u6642\u70b9\u3067\u65e5\u672c\u8a9e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3060\u3068\u6b63\u5e38\u306b\u52d5\u304b\u306a\u304b\u3063\u305f\n\u307b\u304b\u306e\u4eba(\u4e3b\u306b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8)\u306b\u898b\u305b\u308b\u305f\u3081\u306bprivate\u3067\u69cb\u7bc9\u3057\u3066\u30b3\u30e9\u30dc\u30ec\u30fc\u30bf\u30fc\u306b\u8ffd\u52a0\u3059\u308b\u306e\u304c\u9762\u5012\n\n\u305d\u3053\u3067\u4eca\u56de\u306fOSS\u7248\u306eGitBook\u3092\u6d3b\u7528\u3057\u3001\u81ea\u524d\u3067\u69cb\u7bc9\u3057\u307e\u3057\u305f\u3002\n\n\u3084\u3063\u305f\u3053\u3068\n\nGitBook\u3067\u51fa\u529b\u3055\u308c\u305fHTML\u3092S3\u306b\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\n\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3092\u8a2d\u7f6e\u3057\u3066Basic\u8a8d\u8a3c\u3092\u304b\u3051\u308b\nCI\u3067\u81ea\u52d5\u66f4\u65b0\u3059\u308b\n\n\u306e3\u3064\u3067\u3059\u3002\u3053\u308c\u3067\n\n\u8ab0\u3067\u3082\u7c21\u5358\u306b\u66f4\u65b0\u304c\u3067\u304d\n\u66f4\u65b0\u5c65\u6b74\u304c\u5b8c\u74a7\u306b\u6b8b\u308a\n\u30d6\u30e9\u30a6\u30b6\u3055\u3048\u3042\u308c\u3070\u3044\u3064\u3067\u3082\u3069\u3053\u3067\u3082\u6700\u65b0\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u78ba\u8a8d\u3067\u304d\u308b\n\n\u74b0\u5883\u304c\u6574\u3044\u307e\u3057\u305f\u3002\n\n\u524d\u63d0\nGitBook\u3068\u3057\u3066\u52d5\u304b\u305b\u308b\u30ec\u30dd\u30b8\u30c8\u30ea\u3092\u69cb\u7bc9\u3057\u3066\u3044\u308b\u4e8b\u3002\u8a66\u3057\u306b\u52d5\u304b\u3057\u3066\u307f\u305f\u3044\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3057\u3066\u307f\u308b\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002\nhttp://qiita.com/nekogeruge_987/items/46dfb552b33aac4ef9b0\n\n\u624b\u9806\n\nS3\u306b\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u3059\u308b\n\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u5148\u3068\u3057\u3066Amazon S3\u3092\u9078\u629e\u3057\u307e\u3057\u305f\u3002\u914d\u7f6e\u3059\u308bHTML\u3092\u5410\u304d\u51fa\u3059\u306b\u306f\u3001gitbook\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n$ gitbook build\n\n\u6b63\u5e38\u306b\u5909\u63db\u304c\u5b8c\u4e86\u3059\u308b\u3068\u3001_book\u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30d5\u30a1\u30a4\u30eb\u4e00\u5f0f\u304cExport\u3055\u308c\u307e\u3059\u3002\u3053\u308c\u3092\u4efb\u610f\u306eS3\u30d0\u30b1\u30c3\u30c8\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u3044\u305f\u3060\u3051\u3067\u306fWeb\u30b5\u30a4\u30c8\u3068\u3057\u3066\u30a2\u30af\u30bb\u30b9\u3067\u304d\u306a\u3044\u306e\u3067\u3001\u30d0\u30b1\u30c3\u30c8\u306e\u8a2d\u5b9a\u304b\u3089\u300c\u9759\u7684\u30a6\u30a7\u30d6\u30b5\u30a4\u30c8\u306e\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u300d -> \u300c\u30a6\u30a7\u30d6\u30b5\u30a4\u30c8\u306e\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u3092\u6709\u52b9\u306b\u3059\u308b\u300d\u3092\u9078\u629e\u3057\u3066\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u3057\u307e\u3059(\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u6b04\u306f index.html \u3068\u3057\u3066\u3044\u307e\u3059)\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068(\u305f\u3076\u3093)AWS\u306e\u30e6\u30fc\u30b6\u306b\u3057\u304b\u30a2\u30af\u30bb\u30b9\u6a29\u9650\u304c\u4e0e\u3048\u3089\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30dd\u30ea\u30b7\u30fc\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\u30dd\u30ea\u30b7\u30fc\n{\n  \"Version\":\"2012-10-17\",\n  \"Statement\":[{\n      \"Sid\":\"AddPerm\",\n      \"Effect\":\"Allow\",\n        \"Principal\": \"*\",\n      \"Action\":[\"s3:GetObject\"],\n      \"Resource\":[\"arn:aws:s3:::<Bucket Name>/*\"]\n    }\n  ]\n}\n\n\n\u3053\u308c\u3067\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8<bucket-name>.s3-website-ap-northeast-1.amazonaws.com\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068GitBook\u306e\u30da\u30fc\u30b8\u304c\u78ba\u8a8d\u3067\u304d\u308b\u306f\u305a\u3067\u3059\u3002\n\n\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3092\u8a2d\u7f6e\u3057\u3066Basic\u8a8d\u8a3c\u3092\u884c\u3046\n\u3053\u306e\u307e\u307e\u3067\u306f\u4ed5\u69d8\u66f8\u304c\u5168\u4e16\u754c\u306b\u516c\u958b\u3055\u308c\u3066\u3057\u307e\u3046\u305f\u3081\u3001EC2\u3067\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3092\u8a2d\u7f6e\u3057\u3066Basic\u8a8d\u8a3c\u3092\u304b\u3051\u307e\u3059\u3002\n\u305b\u3063\u304b\u304f\u306a\u306e\u3067\u6700\u8fd1\u8ffd\u52a0\u3055\u308c\u305fAmazon Linxu\u306e t2.nano\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f7f\u3044\u307e\u3059\u3002AWS\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089EC2\u306e\u8d77\u52d5\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001ssh\u3067\u63a5\u7d9a\u3057\u3066\u5fc5\u8981\u306a\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306fnginx\u4f7f\u7528\u3059\u308b\u306e\u3067\u3001yum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u307e\u305f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306fSecurityGroup\u304cssh\u3057\u304b\u958b\u3044\u3066\u3044\u306a\u3044\u306f\u305a\u306a\u306e\u3067\u3001HTTP:80\u3092\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n$ sudo yum install nginx\n$ sudo nginx\n$ sudo chkconfig nginx on\n\n\u3053\u3053\u307e\u3067\u306e\u624b\u9806\u3067\u3001EC2\u306e\u30b0\u30ed\u30fc\u30d0\u30ebIP\u306b\u30d6\u30e9\u30a6\u30b6\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068nginx\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u306f\u305a\u3067\u3059\u3002\u8868\u793a\u3055\u308c\u306a\u3044\u5834\u5408\u306f\u300cnginx\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u304b\uff1f\u300d\u300cEC2\u306eSecurityGroup\u306f\u958b\u3044\u3066\u3044\u308b\u304b\u300d\u306a\u3069\u3092\u78ba\u8a8d\u3059\u308b\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002\n\u6b21\u306b\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u306e\u8a2d\u5b9a\u3067\u3059\u3002EC2\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092S3\u306b\u6d41\u3057\u307e\u3059\u3002nginx\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304d\u3001\n$ sudo vim /etc/nginx/nginx.conf\n\nlocation /\u306e\u90e8\u5206\u306bS3\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\nlocation / {\n  proxy_pass http://<bucket-name>.s3-website-ap-northeast-1.amazonaws.com;\n}\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067nginx\u3092\u518d\u8d77\u52d5\u3057\u3001\u518d\u5ea6\u30d6\u30e9\u30a6\u30b6\u3067EC2\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002S3\u306b\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u3055\u308c\u305fGitBook\u306e\u30da\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u305f\u3089\u6210\u529f\u3067\u3059\u3002\n$ sudo nginx -s reload\n\n\u6b21\u306bBasic\u8a8d\u8a3c\u306e\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002\u307e\u305a\u306fhtpasswd\u30d5\u30a1\u30a4\u30eb\u3092\u751f\u6210\u3057\u3001\n$ sudo yum install httpd-tools\n$ cd /etc/nginx\n$ sudo htpasswd -c .htpasswd <User>\n\nnginx\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067Basic\u8a8d\u8a3c\u3092\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\nlocation / {\n  auth_basic \"Restricted\";\n  auth_basic_user_file /etc/nginx/.htpasswd;\n  proxy_pass http://<bucket-name>.s3-website-ap-northeast-1.amazonaws.com;\n}\n\n\u3053\u3053\u307e\u3067\u5b8c\u4e86\u3057\u305f\u3089\u3082\u3046\u4e00\u5ea6nginx\u3092\u518d\u8d77\u52d5\u3057\u3001\u30d6\u30e9\u30a6\u30b6\u3067\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002Basic\u8a8d\u8a3c\u3092\u8981\u6c42\u3055\u308c\u308b\u306f\u305a\u3067\u3059\u3002\n\nS3\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u5236\u9650\u3059\u308b\n\u3053\u306e\u307e\u307e\u3067\u306fS3\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u304b\u3089\u3082\u666e\u901a\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u3066\u3057\u307e\u3046\u305f\u3081\u3001S3\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304d\u304b\u3048\u307e\u3059\u3002 aws:SourceIp \u306bEC2\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u7d4c\u7531\u3067\u306e\u30a2\u30af\u30bb\u30b9\u306e\u307f\u8a31\u53ef\u3057\u3066\u3044\u307e\u3059\u3002\n{\n\"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"AddPerm\",\n      \"Effect\": \"Allow\",\n      \"Principal\": \"*\",\n      \"Action\": \"s3:GetObject\",\n      \"Resource\": \"arn:aws:s3:::miraimarche-gitbook-hosting/*\",\n      \"Condition\": {\n        \"IpAddress\": {\n          \"aws:SourceIp\": [\n            \"##.##.##.##\"\n          ]\n        }\n      }\n    }\n  ]\n}\n\n\nCI\u306e\u8a2d\u5b9a\u3092\u3059\u308b\n\u6bce\u5ea6S3\u306b\u624b\u52d5\u3067\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u306e\u306f\u9762\u5012\u306a\u306e\u3067\u3001CircleCI\u3067S3\u3078\u306e\u30c7\u30d7\u30ed\u30a4\u3092\u81ea\u52d5\u5316\u3057\u307e\u3057\u305f\u3002\n\u30c7\u30d7\u30ed\u30a4\u30b9\u30af\u30ea\u30d7\u30c8\u306fnode.js\u3067\u8a18\u8ff0\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3092\u3057\u307e\u3059\u3002\u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306fs3\u3068\u3044\u3046npm\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\n$ npm init\n$ npm install s3 gitbook-cli --save\n\npackage.json\u306bgitbook\u306e\u30d3\u30eb\u30c9\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u304d\u307e\u3059\u3002\n\npackage.json\n  \"scripts\": {\n    \"export\": \"./node_modules/gitbook-cli/bin/gitbook.js build\"\n  }\n\n\nCircleCI\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002\u4eca\u56de\u306fmaster\u3078\u30b3\u30df\u30c3\u30c8\u304c\u767a\u751f\u3057\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u66f4\u65b0\u3092\u304b\u3051\u3066\u3044\u307e\u3059\u3002post script\u3068\u3057\u3066\u5148\u307b\u3069package.json\u306b\u5b9a\u7fa9\u3057\u305f\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066HTML\u3092\u751f\u6210\u3057\u3001\u30c7\u30d7\u30ed\u30a4\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\ncircle.yml\nmachine:\n  node:\n    version: 4.2\n\ndependencies:\n  override:\n    - npm install\n  post:\n    - npm run export\n\ntest:\n  override:\n    - echo \"No Test\"\n\ndeployment:\n  master:\n    branch: master\n    commands:\n      - node deploy.js\n\n\n\u4ee5\u4e0b\u304c\u30c7\u30d7\u30ed\u30a4\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3059\u3002\u7c21\u5358\u3067\u3059\u306d\u3002\n\ndeploy.js\nconsole.log(\"============= start =============\");\n\nvar s3 = require('s3');\n\nvar client = s3.createClient({\n  s3Options: {\n    accessKeyId: process.env.AWS_ACCESS_KEY,\n    secretAccessKey: process.env.AWS_SECRET_KEY,\n    region: process.env_AWS_REGION || 'ap-northeast-1'\n  }\n});\n\nvar params = {\n  localDir: '_book',\n  s3Params: {\n    Bucket: process.env.AWS_S3_BUCKET\n  }\n};\n\nvar uploader = client.uploadDir(params);\nuploader.on('error', function(error) {\n  console.error('unable to sync: ', error);\n});\nuploader.on('end', function() {\n  console.log(\"done uploading\");\n});\n\n\n\u6700\u5f8c\u306bCircleCI\u3067\u4ee5\u4e0b\u306e\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3057\u3066\u7d42\u308f\u308a\u3067\u3059\u3002\nAWS_ACCESS_KEY=xxxxxxxxxxxxx\nAWS_SECRET_KEY=xxxxxxxxxxxxxxx\nAWS_S3_BUCKET=xxxxxxxxxxxxxx\n\n\n\u6700\u5f8c\u306b\n\u3053\u308c\u672c\u5f53\u306b\u4fbf\u5229\u3067\u3059\u3002\n# \u306f\u3058\u3081\u306b\n\u3042\u308b\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u4ed5\u69d8\u66f8\u3092\u305d\u308c\u306a\u308a\u306e\u30af\u30aa\u30ea\u30c6\u30a3\u3067\u66f8\u304f\u5fc5\u8981\u304c\u51fa\u3066\u304d\u307e\u3057\u305f\u3002Markdown\u3067\u66f8\u304d\u305f\u3044\u306a\u30fc\u3068\u304b\u5c65\u6b74\u7ba1\u7406\u3057\u305f\u3044\u306a\u30fc\u3068\u601d\u3063\u3066\u3044\u305f\u306e\u3067\u3001GitHub\u3067\u7ba1\u7406\u3057\u3066GitBook\u3068\u3057\u3066\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u5316\u3059\u308b\u3053\u3068\u306b\u6c7a\u3081\u307e\u3057\u305f\u3002\n\n# \u5185\u5bb9\n## GitBook\u3068\u306f\uff1f\n\u300cMarkdown\u3067\u7c21\u5358\u306b\u96fb\u5b50\u66f8\u7c4d\u304c\u4f5c\u308c\u308b\u3088\u300d\u3068\u3044\u3046\u3082\u306e\u3067\u3059\u3002GitHub\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u3092\u6307\u5b9a\u3059\u308b\u3068\u52dd\u624b\u306b\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u3057\u3066\u304f\u308c\u308b [gitbook.com](https://www.gitbook.com) \u3068\u3044\u3046\u30b5\u30fc\u30d3\u30b9\u306e\u4ed6\u306b\u3001[OSS\u3067\u3082\u516c\u958b\u3055\u308c\u3066\u3044\u308b](https://github.com/GitbookIO/gitbook-cli)\u306e\u3067\u81ea\u524d\u306e\u69cb\u7bc9\u3082\u53ef\u80fd\u3067\u3059\u3002\n\n`gitbook.com` \u3092\u4f7f\u3048\u3070\u304b\u306a\u308a\u697d\u304c\u51fa\u6765\u307e\u3059\u304c\u3001\u4ee5\u4e0b\u306e2\u70b9\u304c\u554f\u984c\u70b9\u3068\u3057\u3066\u3042\u308a\u307e\u3057\u305f\u3002\n\n* \u78ba\u8a8d\u3057\u305f\u6642\u70b9\u3067\u65e5\u672c\u8a9e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3060\u3068\u6b63\u5e38\u306b\u52d5\u304b\u306a\u304b\u3063\u305f\n* \u307b\u304b\u306e\u4eba(\u4e3b\u306b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8)\u306b\u898b\u305b\u308b\u305f\u3081\u306bprivate\u3067\u69cb\u7bc9\u3057\u3066\u30b3\u30e9\u30dc\u30ec\u30fc\u30bf\u30fc\u306b\u8ffd\u52a0\u3059\u308b\u306e\u304c\u9762\u5012\n\n\u305d\u3053\u3067\u4eca\u56de\u306fOSS\u7248\u306eGitBook\u3092\u6d3b\u7528\u3057\u3001\u81ea\u524d\u3067\u69cb\u7bc9\u3057\u307e\u3057\u305f\u3002\n\n## \u3084\u3063\u305f\u3053\u3068\n* GitBook\u3067\u51fa\u529b\u3055\u308c\u305fHTML\u3092S3\u306b\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\n* \u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3092\u8a2d\u7f6e\u3057\u3066Basic\u8a8d\u8a3c\u3092\u304b\u3051\u308b\n* CI\u3067\u81ea\u52d5\u66f4\u65b0\u3059\u308b\n\n\u306e3\u3064\u3067\u3059\u3002\u3053\u308c\u3067\n\n* \u8ab0\u3067\u3082\u7c21\u5358\u306b\u66f4\u65b0\u304c\u3067\u304d\n* \u66f4\u65b0\u5c65\u6b74\u304c\u5b8c\u74a7\u306b\u6b8b\u308a\n* \u30d6\u30e9\u30a6\u30b6\u3055\u3048\u3042\u308c\u3070\u3044\u3064\u3067\u3082\u3069\u3053\u3067\u3082\u6700\u65b0\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u78ba\u8a8d\u3067\u304d\u308b\n\n\u74b0\u5883\u304c\u6574\u3044\u307e\u3057\u305f\u3002\n\n## \u524d\u63d0\nGitBook\u3068\u3057\u3066\u52d5\u304b\u305b\u308b\u30ec\u30dd\u30b8\u30c8\u30ea\u3092\u69cb\u7bc9\u3057\u3066\u3044\u308b\u4e8b\u3002\u8a66\u3057\u306b\u52d5\u304b\u3057\u3066\u307f\u305f\u3044\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3057\u3066\u307f\u308b\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002\nhttp://qiita.com/nekogeruge_987/items/46dfb552b33aac4ef9b0\n\n## \u624b\u9806\n### S3\u306b\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u3059\u308b\n\n\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u5148\u3068\u3057\u3066Amazon S3\u3092\u9078\u629e\u3057\u307e\u3057\u305f\u3002\u914d\u7f6e\u3059\u308bHTML\u3092\u5410\u304d\u51fa\u3059\u306b\u306f\u3001gitbook\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\n$ gitbook build\n```\n\n\u6b63\u5e38\u306b\u5909\u63db\u304c\u5b8c\u4e86\u3059\u308b\u3068\u3001`_book`\u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30d5\u30a1\u30a4\u30eb\u4e00\u5f0f\u304cExport\u3055\u308c\u307e\u3059\u3002\u3053\u308c\u3092\u4efb\u610f\u306eS3\u30d0\u30b1\u30c3\u30c8\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u3044\u305f\u3060\u3051\u3067\u306fWeb\u30b5\u30a4\u30c8\u3068\u3057\u3066\u30a2\u30af\u30bb\u30b9\u3067\u304d\u306a\u3044\u306e\u3067\u3001\u30d0\u30b1\u30c3\u30c8\u306e\u8a2d\u5b9a\u304b\u3089\u300c\u9759\u7684\u30a6\u30a7\u30d6\u30b5\u30a4\u30c8\u306e\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u300d -> \u300c\u30a6\u30a7\u30d6\u30b5\u30a4\u30c8\u306e\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u3092\u6709\u52b9\u306b\u3059\u308b\u300d\u3092\u9078\u629e\u3057\u3066\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u3057\u307e\u3059(\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u6b04\u306f `index.html` \u3068\u3057\u3066\u3044\u307e\u3059)\u3002\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068(\u305f\u3076\u3093)AWS\u306e\u30e6\u30fc\u30b6\u306b\u3057\u304b\u30a2\u30af\u30bb\u30b9\u6a29\u9650\u304c\u4e0e\u3048\u3089\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30dd\u30ea\u30b7\u30fc\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```json:\u30dd\u30ea\u30b7\u30fc\n{\n  \"Version\":\"2012-10-17\",\n  \"Statement\":[{\n      \"Sid\":\"AddPerm\",\n      \"Effect\":\"Allow\",\n        \"Principal\": \"*\",\n      \"Action\":[\"s3:GetObject\"],\n      \"Resource\":[\"arn:aws:s3:::<Bucket Name>/*\"]\n    }\n  ]\n}\n```\n\n\u3053\u308c\u3067\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8`<bucket-name>.s3-website-ap-northeast-1.amazonaws.com`\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068GitBook\u306e\u30da\u30fc\u30b8\u304c\u78ba\u8a8d\u3067\u304d\u308b\u306f\u305a\u3067\u3059\u3002\n\n### \u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3092\u8a2d\u7f6e\u3057\u3066Basic\u8a8d\u8a3c\u3092\u884c\u3046\n\n\u3053\u306e\u307e\u307e\u3067\u306f\u4ed5\u69d8\u66f8\u304c\u5168\u4e16\u754c\u306b\u516c\u958b\u3055\u308c\u3066\u3057\u307e\u3046\u305f\u3081\u3001EC2\u3067\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3092\u8a2d\u7f6e\u3057\u3066Basic\u8a8d\u8a3c\u3092\u304b\u3051\u307e\u3059\u3002\n\n\u305b\u3063\u304b\u304f\u306a\u306e\u3067\u6700\u8fd1\u8ffd\u52a0\u3055\u308c\u305fAmazon Linxu\u306e t2.nano\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f7f\u3044\u307e\u3059\u3002AWS\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089EC2\u306e\u8d77\u52d5\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001ssh\u3067\u63a5\u7d9a\u3057\u3066\u5fc5\u8981\u306a\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002\n\n\u4eca\u56de\u306fnginx\u4f7f\u7528\u3059\u308b\u306e\u3067\u3001yum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u307e\u305f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306fSecurityGroup\u304cssh\u3057\u304b\u958b\u3044\u3066\u3044\u306a\u3044\u306f\u305a\u306a\u306e\u3067\u3001HTTP:80\u3092\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\n$ sudo yum install nginx\n$ sudo nginx\n$ sudo chkconfig nginx on\n```\n\n\u3053\u3053\u307e\u3067\u306e\u624b\u9806\u3067\u3001EC2\u306e\u30b0\u30ed\u30fc\u30d0\u30ebIP\u306b\u30d6\u30e9\u30a6\u30b6\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068nginx\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u306f\u305a\u3067\u3059\u3002\u8868\u793a\u3055\u308c\u306a\u3044\u5834\u5408\u306f\u300cnginx\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u304b\uff1f\u300d\u300cEC2\u306eSecurityGroup\u306f\u958b\u3044\u3066\u3044\u308b\u304b\u300d\u306a\u3069\u3092\u78ba\u8a8d\u3059\u308b\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002\n\n\u6b21\u306b\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u306e\u8a2d\u5b9a\u3067\u3059\u3002EC2\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092S3\u306b\u6d41\u3057\u307e\u3059\u3002nginx\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304d\u3001\n\n```\n$ sudo vim /etc/nginx/nginx.conf\n```\n\n`location /`\u306e\u90e8\u5206\u306bS3\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```\nlocation / {\n  proxy_pass http://<bucket-name>.s3-website-ap-northeast-1.amazonaws.com;\n}\n```\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067nginx\u3092\u518d\u8d77\u52d5\u3057\u3001\u518d\u5ea6\u30d6\u30e9\u30a6\u30b6\u3067EC2\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002S3\u306b\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u3055\u308c\u305fGitBook\u306e\u30da\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u305f\u3089\u6210\u529f\u3067\u3059\u3002\n\n```\n$ sudo nginx -s reload\n```\n\n\u6b21\u306bBasic\u8a8d\u8a3c\u306e\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002\u307e\u305a\u306fhtpasswd\u30d5\u30a1\u30a4\u30eb\u3092\u751f\u6210\u3057\u3001\n\n```\n$ sudo yum install httpd-tools\n$ cd /etc/nginx\n$ sudo htpasswd -c .htpasswd <User>\n```\n\nnginx\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067Basic\u8a8d\u8a3c\u3092\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\n\n```\nlocation / {\n  auth_basic \"Restricted\";\n  auth_basic_user_file /etc/nginx/.htpasswd;\n  proxy_pass http://<bucket-name>.s3-website-ap-northeast-1.amazonaws.com;\n}\n```\n\n\u3053\u3053\u307e\u3067\u5b8c\u4e86\u3057\u305f\u3089\u3082\u3046\u4e00\u5ea6nginx\u3092\u518d\u8d77\u52d5\u3057\u3001\u30d6\u30e9\u30a6\u30b6\u3067\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002Basic\u8a8d\u8a3c\u3092\u8981\u6c42\u3055\u308c\u308b\u306f\u305a\u3067\u3059\u3002\n\n### S3\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u5236\u9650\u3059\u308b\n\u3053\u306e\u307e\u307e\u3067\u306fS3\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u304b\u3089\u3082\u666e\u901a\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u3066\u3057\u307e\u3046\u305f\u3081\u3001S3\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304d\u304b\u3048\u307e\u3059\u3002 `aws:SourceIp` \u306bEC2\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u7d4c\u7531\u3067\u306e\u30a2\u30af\u30bb\u30b9\u306e\u307f\u8a31\u53ef\u3057\u3066\u3044\u307e\u3059\u3002\n\n```\n{\n\"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"AddPerm\",\n      \"Effect\": \"Allow\",\n      \"Principal\": \"*\",\n      \"Action\": \"s3:GetObject\",\n      \"Resource\": \"arn:aws:s3:::miraimarche-gitbook-hosting/*\",\n      \"Condition\": {\n        \"IpAddress\": {\n          \"aws:SourceIp\": [\n            \"##.##.##.##\"\n          ]\n        }\n      }\n    }\n  ]\n}\n```\n\n### CI\u306e\u8a2d\u5b9a\u3092\u3059\u308b\n\u6bce\u5ea6S3\u306b\u624b\u52d5\u3067\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u306e\u306f\u9762\u5012\u306a\u306e\u3067\u3001CircleCI\u3067S3\u3078\u306e\u30c7\u30d7\u30ed\u30a4\u3092\u81ea\u52d5\u5316\u3057\u307e\u3057\u305f\u3002\n\n\u30c7\u30d7\u30ed\u30a4\u30b9\u30af\u30ea\u30d7\u30c8\u306fnode.js\u3067\u8a18\u8ff0\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3092\u3057\u307e\u3059\u3002\u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306f[s3](https://www.npmjs.com/package/s3)\u3068\u3044\u3046npm\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\n\n```\n$ npm init\n$ npm install s3 gitbook-cli --save\n```\n\npackage.json\u306bgitbook\u306e\u30d3\u30eb\u30c9\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u304d\u307e\u3059\u3002\n\n```json:package.json\n  \"scripts\": {\n    \"export\": \"./node_modules/gitbook-cli/bin/gitbook.js build\"\n  }\n```\n\nCircleCI\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002\u4eca\u56de\u306fmaster\u3078\u30b3\u30df\u30c3\u30c8\u304c\u767a\u751f\u3057\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u66f4\u65b0\u3092\u304b\u3051\u3066\u3044\u307e\u3059\u3002post script\u3068\u3057\u3066\u5148\u307b\u3069package.json\u306b\u5b9a\u7fa9\u3057\u305f\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066HTML\u3092\u751f\u6210\u3057\u3001\u30c7\u30d7\u30ed\u30a4\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```yaml:circle.yml\nmachine:\n  node:\n    version: 4.2\n\ndependencies:\n  override:\n    - npm install\n  post:\n    - npm run export\n\ntest:\n  override:\n    - echo \"No Test\"\n    \ndeployment:\n  master:\n    branch: master\n    commands:\n      - node deploy.js\n```\n\n\u4ee5\u4e0b\u304c\u30c7\u30d7\u30ed\u30a4\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3059\u3002\u7c21\u5358\u3067\u3059\u306d\u3002\n\n```js:deploy.js\nconsole.log(\"============= start =============\");\n\nvar s3 = require('s3');\n\nvar client = s3.createClient({\n  s3Options: {\n    accessKeyId: process.env.AWS_ACCESS_KEY,\n    secretAccessKey: process.env.AWS_SECRET_KEY,\n    region: process.env_AWS_REGION || 'ap-northeast-1'\n  }\n});\n\nvar params = {\n  localDir: '_book',\n  s3Params: {\n    Bucket: process.env.AWS_S3_BUCKET\n  }\n};\n\nvar uploader = client.uploadDir(params);\nuploader.on('error', function(error) {\n  console.error('unable to sync: ', error);\n});\nuploader.on('end', function() {\n  console.log(\"done uploading\");\n});\n```\n\n\u6700\u5f8c\u306bCircleCI\u3067\u4ee5\u4e0b\u306e\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3057\u3066\u7d42\u308f\u308a\u3067\u3059\u3002\n\n```\nAWS_ACCESS_KEY=xxxxxxxxxxxxx\nAWS_SECRET_KEY=xxxxxxxxxxxxxxx\nAWS_S3_BUCKET=xxxxxxxxxxxxxx\n```\n\n# \u6700\u5f8c\u306b\n\u3053\u308c\u672c\u5f53\u306b\u4fbf\u5229\u3067\u3059\u3002\n", "tags": ["gitbook", "CircleCI", "GitHub"]}