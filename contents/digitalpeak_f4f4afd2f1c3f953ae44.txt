{"context": "\n\n\u767a\u7aef\n\ncode\u5909\u66f4\u3057\u305f\u8a18\u61b6\u304c\u306a\u3044\u3051\u3069\u3001forces new resource\u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u305f\n\n$ terraform plan\n-/+ aws_instance.*******\n(snip)\nsecurity_groups.#:           \"0\" => \"1\" (forces new resource)\nsecurity_groups.3175896941:  \"\" => \"sg-*****\" (forces new resource)\n(snip)\n\n\n\u8abf\u67fb\n\ntfstate\u3092\u898b\u305f\u3089key\u304c\uff12\u3064\u3042\u308b\u30fb\u30fb\u30fb\n\n(snip)\n\"security_groups.#\": \"0\",\n\"vpc_security_group_ids.#\": \"1\",\n\"vpc_security_group_ids.4130972961\": \"sg-*****\"\n(snip)\n\n\n\nforces new resource?\n\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u5909\u66f4\u3055\u308c\u305f\u969b\u306f\u30ea\u30bd\u30fc\u30b9\u3092\u518d\u4f5c\u6210\u3059\u308b\u51e6\u7406\u306e\u3088\u3046\u3067\u3059\u3002\n\n\n\n\n//github.com/hashicorp/terraform/blob/v0.6.11/builtin/providers/aws/resource_aws_instance.go#L106-L123\n\"security_groups\": &schema.Schema{\n  Type:     schema.TypeSet,\n  Optional: true,\n  Computed: true,\n  ForceNew: true,\n  Elem:     &schema.Schema{Type: schema.TypeString},\n  Set:      schema.HashString,\n},\n\n\"vpc_security_group_ids\": &schema.Schema{\n  Type:     schema.TypeSet,\n  Optional: true,\n  Computed: true,\n  Elem:     &schema.Schema{Type: schema.TypeString},\n  Set: func(v interface{}) int {\n    return hashcode.String(v.(string))\n  },\n},\n\n\n\n\u5bfe\u7b56\n\ntf\u30d5\u30a1\u30a4\u30eb\u3067\u306fvpc_security_group_ids\u3092\u4f7f\u7528\u3057\u3066\u3044\u305f\u306e\u3067\u3001\u30ea\u30bd\u30fc\u30b9\u3092\u518d\u4f5c\u6210\u3057\u306a\u3044vpc_security_group_ids\u3078\u5909\u66f4\u3059\u308b\u3053\u3068\u3067\u30ea\u30bd\u30fc\u30b9\u518d\u4f5c\u6210\u3092\u56de\u907f\u3067\u304d\u308b\u3002\nbefore\n\nsecurity_groups = [\"${aws_security_group.******.id}\"]\n\n\nafter\n\nvpc_security_group_ids = [\"${aws_security_group.******.id}\"]\n\n\n\u78ba\u8a8d\n\n\nforces new resource\u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u306a\u3044\n\n$ terraform plan\n-/+ aws_instance.*******\nsecurity_groups.#:                 \"0\" => \"<computed>\"\n(snip)\nvpc_security_group_ids.#:          \"1\" => \"1\"\nvpc_security_group_ids.3175896941: \"sg-*****\" => \"sg-*****\"\n(snip)\n\n\n\u3000\u88dc\u8db3\n\n\ninstance_type\u306a\u3069\u3001\u30ea\u30bd\u30fc\u30b9\u518d\u4f5c\u6210\u3092\u56de\u907f\u3067\u304d\u306a\u3044\u3082\u306e\u3082\u6570\u591a\u304f\u3042\u308b\u3002\u3057\u304b\u3082\u3001stopp\u3067\u306f\u304fterminated\u3055\u308c\u308b\u306e\u3067\u8981\u6ce8\u610f\n\n# \u767a\u7aef\n* code\u5909\u66f4\u3057\u305f\u8a18\u61b6\u304c\u306a\u3044\u3051\u3069\u3001`forces new resource`\u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u305f\n\n\n```bash\n$ terraform plan\n-/+ aws_instance.*******\n(snip)\nsecurity_groups.#:           \"0\" => \"1\" (forces new resource)\nsecurity_groups.3175896941:  \"\" => \"sg-*****\" (forces new resource)\n(snip)\n```\n\n# \u8abf\u67fb\n* tfstate\u3092\u898b\u305f\u3089key\u304c\uff12\u3064\u3042\u308b\u30fb\u30fb\u30fb\n\n```\n(snip)\n\"security_groups.#\": \"0\",\n\"vpc_security_group_ids.#\": \"1\",\n\"vpc_security_group_ids.4130972961\": \"sg-*****\"\n(snip)\n```\n* `forces new resource`?\n    * \u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u5909\u66f4\u3055\u308c\u305f\u969b\u306f\u30ea\u30bd\u30fc\u30b9\u3092\u518d\u4f5c\u6210\u3059\u308b\u51e6\u7406\u306e\u3088\u3046\u3067\u3059\u3002\n\n```https://github.com/hashicorp/terraform/blob/v0.6.11/builtin/providers/aws/resource_aws_instance.go#L106-L123\n\"security_groups\": &schema.Schema{\n  Type:     schema.TypeSet,\n  Optional: true,\n  Computed: true,\n  ForceNew: true,\n  Elem:     &schema.Schema{Type: schema.TypeString},\n  Set:      schema.HashString,\n},\n\n\"vpc_security_group_ids\": &schema.Schema{\n  Type:     schema.TypeSet,\n  Optional: true,\n  Computed: true,\n  Elem:     &schema.Schema{Type: schema.TypeString},\n  Set: func(v interface{}) int {\n    return hashcode.String(v.(string))\n  },\n},\n```\n\n# \u5bfe\u7b56\n* tf\u30d5\u30a1\u30a4\u30eb\u3067\u306f`vpc_security_group_ids`\u3092\u4f7f\u7528\u3057\u3066\u3044\u305f\u306e\u3067\u3001\u30ea\u30bd\u30fc\u30b9\u3092\u518d\u4f5c\u6210\u3057\u306a\u3044`vpc_security_group_ids`\u3078\u5909\u66f4\u3059\u308b\u3053\u3068\u3067\u30ea\u30bd\u30fc\u30b9\u518d\u4f5c\u6210\u3092\u56de\u907f\u3067\u304d\u308b\u3002\n\n* before\n\n```bash\nsecurity_groups = [\"${aws_security_group.******.id}\"]\n```\n* after\n\n```bash\nvpc_security_group_ids = [\"${aws_security_group.******.id}\"]\n```\n\n# \u78ba\u8a8d\n* `forces new resource`\u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u306a\u3044\n\n```bash\n$ terraform plan\n-/+ aws_instance.*******\nsecurity_groups.#:                 \"0\" => \"<computed>\"\n(snip)\nvpc_security_group_ids.#:          \"1\" => \"1\"\nvpc_security_group_ids.3175896941: \"sg-*****\" => \"sg-*****\"\n(snip)\n```\n#\u3000\u88dc\u8db3\n* `instance_type`\u306a\u3069\u3001\u30ea\u30bd\u30fc\u30b9\u518d\u4f5c\u6210\u3092\u56de\u907f\u3067\u304d\u306a\u3044\u3082\u306e\u3082\u6570\u591a\u304f\u3042\u308b\u3002\u3057\u304b\u3082\u3001`stopp`\u3067\u306f\u304f`terminated`\u3055\u308c\u308b\u306e\u3067\u8981\u6ce8\u610f\n", "tags": ["AWS", "Terraform"]}