{"tags": ["WMI", "AutoHotkey", "Windows"], "context": " More than 1 year has passed since last update.To see if the machine is connected to the internet, the following functions would be useful.\nI have experienced that the InternetGetConnectedState API function sometimes returned true right after the router started rebooting. So it would help to double-check the connection with WMI Ping. \n\nCheckInternetConnection.ahk\n; Press F1 to check the internet connection.\nF1::\n    if IsOnline() && Ping(\"www.google.com\") \n        TrayTip, Internet Connection, Online, 5, 1\n    else\n        TrayTip, Internet Connection, Offline, 5, 1\nReturn \n\nPing(nAddress, strComputer=\".\") {\n    objWMIService := ComObjGet(\"winmgmts:{impersonationLevel=impersonate}!\\\\\" . strComputer . \"\\root\\cimv2\")\n    colPings := objWMIService.ExecQuery(\"Select StatusCode From Win32_PingStatus where Address = '\" nAddress \"'\")\n    For objStatus in colPings\n        If (objStatus.StatusCode = \"\") || (objStatus.StatusCode != 0)\n            Return False\n        Else\n            Return True\n}\n\nIsOnline() {\n    if DllCall(\"Wininet.dll\\InternetGetConnectedState\", \"Str\", \"0x40\", \"Int\", 0) \n        Return True\n    else\n        Return False\n}\n\n\n\nTo see if the machine is connected to the internet, the following functions would be useful.\n\nI have experienced that the [InternetGetConnectedState](http://msdn.microsoft.com/en-us/library/windows/desktop/aa384702%28v=vs.85%29.aspx) API function sometimes returned true right after the router started rebooting. So it would help to double-check the connection with [WMI Ping](http://msdn.microsoft.com/en-us/library/windows/desktop/aa394350%28v=vs.85%29.aspx). \n\n```ahk:CheckInternetConnection.ahk\n; Press F1 to check the internet connection.\nF1::\n\tif IsOnline() && Ping(\"www.google.com\") \n\t\tTrayTip, Internet Connection, Online, 5, 1\n\telse\n\t\tTrayTip, Internet Connection, Offline, 5, 1\nReturn \n\nPing(nAddress, strComputer=\".\") {\n\tobjWMIService := ComObjGet(\"winmgmts:{impersonationLevel=impersonate}!\\\\\" . strComputer . \"\\root\\cimv2\")\n\tcolPings := objWMIService.ExecQuery(\"Select StatusCode From Win32_PingStatus where Address = '\" nAddress \"'\")\n\tFor objStatus in colPings\n\t\tIf (objStatus.StatusCode = \"\") || (objStatus.StatusCode != 0)\n\t\t\tReturn False\n\t\tElse\n\t\t\tReturn True\n}\n\nIsOnline() {\n\tif DllCall(\"Wininet.dll\\InternetGetConnectedState\", \"Str\", \"0x40\", \"Int\", 0) \n\t\tReturn True\n\telse\n\t\tReturn False\n}\n```\n\n![Alt Result](http://lh3.googleusercontent.com/-VDyhzX6yjpU/TzicDvWICVI/AAAAAAAAAWI/buMocs3lzX0/s800/CheckInternetConnection.jpg)"}