{"tags": ["spring", "springframework"], "context": " More than 1 year has passed since last update.\u3010\u80cc\u666f\u3011\n Spring\u516c\u5f0f\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u975e\u63a8\u5968\u306eAPI\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u305f\u3081\n terasoluna\u306b\u30e1\u30fc\u30eb\u306b\u95a2\u3059\u308b\u8a18\u8f09\u304c\u306a\u3044\u305f\u3081\n\u3010\u30b4\u30fc\u30eb\u3011\nspring framework\u3092\u7528\u3044\u3066\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u65b9\u6cd5\u3092\u8a18\u8f09\u3057\u307e\u3059\n\u6ce8\u610f\u4e8b\u9805: spring boot\u3068\u306f\u9055\u3044\u307e\u3059\u3088\n\n1. \u4f9d\u5b58\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u8ffd\u52a0\norg.springframework.mail\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u3001\nspring-context-support\u306b\u542b\u307e\u308c\u3066\u3044\u308b\u305f\u3081\u3001pom.xml\u3078\u8ffd\u52a0\u3057\u307e\u3059\n\npom.xml\n<dependency>\n    <groupId>org.springframework</groupId>\n    <artifactId>spring-context-support</artifactId>\n    <version>${org.springframework-version}</version>\n</dependency>\n\n\nJavaMail\u306e\u8ffd\u52a0\n\npom.xml\n<dependency>\n    <groupId>javax.mail</groupId>\n    <artifactId>mail</artifactId>\n    <version>1.4.7</version>\n</dependency>\n\n\nVelocity\u306e\u8ffd\u52a0\n:pom.xml\n<dependency>\n    <groupId>org.apache.velocity</groupId>\n    <artifactId>velocity</artifactId>\n    <version>1.7</version>\n</dependency>\n\n\n2. Bean\u3092Spring-Context\u306b\u8ffd\u52a0\nSpring-Cntext\u306bBean\u3092\u767b\u9332\u3057\u307e\u3059\n\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\n/\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d/src/main/webapp/WEB-INF/spring/appServlet/servlet-context.xml\n\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u306e\u8a2d\u5b9a\u3092\u767b\u9332\u3057\u307e\u3059\n\nservlet-context.xml\n    <beans:bean id=\"javaMailSender\" class=\"org.springframework.mail.javamail.JavaMailSenderImpl\">\n        <beans:property name=\"host\" value=\"\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0IP or FQDN\" />\n        <beans:property name=\"port\" value=\"SMTP\u30dd\u30fc\u30c8\u540d \u6a19\u6e96:25 or 587\" />\n        <beans:property name=\"username\" value=\"\u30e6\u30fc\u30b6\u30fc\u540d\" />\n        <beans:property name=\"password\" value=\"\u30d1\u30b9\u30ef\u30fc\u30c9\" />\n\n        <beans:property name=\"javaMailProperties\">\n            <beans:props>\n                <beans:prop key=\"mail.transport.protocol\">smtp</beans:prop>\n                <beans:prop key=\"mail.smtp.auth\">true</beans:prop>\n                <beans:prop key=\"mail.smtp.starttls.enable\">true</beans:prop>\n            </beans:props>\n        </beans:property>\n    </beans:bean>\n\n\n\u6b21\u306bVelocity\u306e\u8a2d\u5b9a\u3092\u3057\u307e\u3059\nVelocity\u30d5\u30a1\u30a4\u30eb\u3092/\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d/src/main/resources/template\u306b\u8a2d\u7f6e\u3057\u307e\u3059\n\nservlet-context.xml\n    <beans:bean id=\"velocityEngine\" class=\"org.springframework.ui.velocity.VelocityEngineFactoryBean\">\n        <beans:property name=\"resourceLoaderPath\" value=\"classpath:template\" />\n        <beans:property name=\"velocityPropertiesMap\">\n            <beans:map>\n                <beans:entry key=\"input.encoding\" value=\"UTF-8\" />\n                <beans:entry key=\"output.encoding\" value=\"UTF-8\" />\n            </beans:map>\n        </beans:property>\n    </beans:bean>\n\n\n\n3. \u30e1\u30fc\u30eb\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8(Velocity)\u306e\u4f5c\u6210\nHelloWorld.vm\u3092\u4f5c\u6210\u3057\u307e\u3059\nVelocity\u3092\u4f5c\u6210\u3059\u308b\u5834\u6240\u306f/\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d/src/main/resources/template\u306b\u306a\u308a\u307e\u3059\n\nHelloWorld.vm\n\u3088\u3046\u3053\u305d \"user\"\n\n\u30b5\u30fc\u30d3\u30b9\u3092\u767b\u9332\u3057\u3066\u3042\u308a\u304c\u3068\u3046\n\n\u3042\u306a\u305f\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\"password\"\u3067\u3059\n\n\n\n4. \u30bd\u30fc\u30b9\u30fc\u30b3\u30fc\u30c9\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306b\u306a\u308a\u307e\u3059\n\u4e0a\u8a18\u3067\u8aac\u660e\u3057\u3066\u3044\u306a\u3044\u306e\u306f\u3001\u975e\u540c\u671f\u3068\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u304c\u7701\u7565\u3055\u305b\u3066\u304f\u3060\u3055\u3044\n\nMailService\n@Service\npublic class MailService {\n\n    @Autowired\n    private JavaMailSender mailSender;\n    @Autowired\n    private VelocityEngine velocityEngine;\n\n    @Async // \u975e\u540c\u671f\n    public void doSendPasswordRemaindEmail() throws MessagingException {\n\n        MimeMessage message = mailSender.createMimeMessage();\n        // \u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u3092\u7528\u3044\u308b\u5834\u5408\u306f\u3001ture\u3092\u8a2d\u5b9a\u3057\u307e\u3059\n        MimeMessageHelper helper = new MimeMessageHelper(message, true);\n\n        // \u30e1\u30fc\u30eb\u672c\u6587\u306e\u751f\u6210\n        Map<String,Object> model = new HashMap<String,Object>();\n        StringWriter writer = new StringWriter();\n        model.put(\"user\", \"hoge\");\n        model.put(\"passowrd\", \"abcdef\");\n        VelocityContext ctx = new VelocityContext(model);\n        velocityEngine.mergeTemplate(\"HelloWorld.vm\", \"UTF-8\", ctx, writer);\n\n        // \u30e1\u30fc\u30eb\u672c\u6587\u306e\u30bb\u30c3\u30c8\n        helper.setText(writer.toString());\n\n        // \u30d5\u30a1\u30a4\u30eb\u3092\u30e1\u30fc\u30eb\u306b\u6dfb\u4ed8\n        FileSystemResource file = new FileSystemResource(new File(\"c:/hoge.jpg\"));\n        helper.addAttachment(\"hoge.jpg\", file);\n\n        // \u9001\u4fe1\u5148\u3092\u8a2d\u5b9a\n        helper.setTo(\"hoge@hoge.com\");\n\n        // \u9001\u4fe1\n        mailSender.send(message);\n    }\n}\n\n\n\n5. \u30a8\u30e9\u30fc\u3068\u5b9f\u884c\u74b0\u5883\n\u30c9\u30e1\u30a4\u30f3\u306b\u53c2\u52a0\u3057\u3066\u3044\u306a\u3044\u958b\u767a\u74b0\u5883\u304b\u3089\u5b9f\u884c\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3059\u3002\nPostfix\u7cfb\u306e\u30b5\u30fc\u30d0\u3060\u3068\u3001FQDN\u3067\u306a\u3044\u3068Deny\u3055\u308c\u307e\u3059\u3002\n\n\u30a8\u30e9\u30fc\u30ed\u30b0\nCaused by: com.sun.mail.smtp.SMTPAddressFailedException:\n 504 5.5.2 <z@surfacePro3>: Sender address rejected: need fully-qualified address\n\n\nJavaMail\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3057\u3057\u305f\u3089\u9001\u4fe1\u3057\u305f\u3044\u3068\u66f8\u304d\u305f\u3044\u306e\u3067\u3059\u304c\u3001\u3001\u3001\n\nservlet-context.xml\n<beans:prop key=\"mail.smtp.localhost\">hoge@fuga.com</beans:prop>\n\n\n\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3059(^^;;\n\u3069\u306a\u305f\u304b\u52a9\u3051\u3066\u304f\u3060\u3055\u3044\u3002\u3002\u3002\u3000help me \u3002\u3002\u3002\n\n\u30a8\u30e9\u30fc\u30ed\u30b0\nCaused by: com.sun.mail.smtp.SMTPAddressFailedException: 501 5.5.2 <hoge?fuga.com>: Helo command rejected: Invalid name\n\n\n\u672c\u756a\u3067\u306f\u9001\u4fe1\u3067\u304d\u308b\u306e\u3067\u3059\u304c\u3001\u3001\u3001\n\u25a0 \u53c2\u8003\u6587\u732e\nSpring 32.Email\n\u3010\u80cc\u666f\u3011\n Spring\u516c\u5f0f\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u975e\u63a8\u5968\u306eAPI\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u305f\u3081\n terasoluna\u306b\u30e1\u30fc\u30eb\u306b\u95a2\u3059\u308b\u8a18\u8f09\u304c\u306a\u3044\u305f\u3081\n\n\u3010\u30b4\u30fc\u30eb\u3011\nspring framework\u3092\u7528\u3044\u3066\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u65b9\u6cd5\u3092\u8a18\u8f09\u3057\u307e\u3059\n\u6ce8\u610f\u4e8b\u9805: spring boot\u3068\u306f\u9055\u3044\u307e\u3059\u3088\n\n#1. \u4f9d\u5b58\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u8ffd\u52a0\norg.springframework.mail\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u3001\nspring-context-support\u306b\u542b\u307e\u308c\u3066\u3044\u308b\u305f\u3081\u3001pom.xml\u3078\u8ffd\u52a0\u3057\u307e\u3059\n\n```xml:pom.xml\n<dependency>\n\t<groupId>org.springframework</groupId>\n\t<artifactId>spring-context-support</artifactId>\n\t<version>${org.springframework-version}</version>\n</dependency>\n```\n\nJavaMail\u306e\u8ffd\u52a0\n\n```xml:pom.xml\n<dependency>\n\t<groupId>javax.mail</groupId>\n\t<artifactId>mail</artifactId>\n\t<version>1.4.7</version>\n</dependency>\n```\n\nVelocity\u306e\u8ffd\u52a0\n\n```xml\n:pom.xml\n<dependency>\n\t<groupId>org.apache.velocity</groupId>\n\t<artifactId>velocity</artifactId>\n\t<version>1.7</version>\n</dependency>\n```\n\n#2. Bean\u3092Spring-Context\u306b\u8ffd\u52a0\n\nSpring-Cntext\u306bBean\u3092\u767b\u9332\u3057\u307e\u3059\n\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\n/\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d/src/main/webapp/WEB-INF/spring/appServlet/servlet-context.xml\n\n\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u306e\u8a2d\u5b9a\u3092\u767b\u9332\u3057\u307e\u3059\n\n```xml:servlet-context.xml\n\t<beans:bean id=\"javaMailSender\" class=\"org.springframework.mail.javamail.JavaMailSenderImpl\">\n\t\t<beans:property name=\"host\" value=\"\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0IP or FQDN\" />\n\t\t<beans:property name=\"port\" value=\"SMTP\u30dd\u30fc\u30c8\u540d \u6a19\u6e96:25 or 587\" />\n\t\t<beans:property name=\"username\" value=\"\u30e6\u30fc\u30b6\u30fc\u540d\" />\n\t\t<beans:property name=\"password\" value=\"\u30d1\u30b9\u30ef\u30fc\u30c9\" />\n\n\t\t<beans:property name=\"javaMailProperties\">\n\t\t\t<beans:props>\n\t\t\t\t<beans:prop key=\"mail.transport.protocol\">smtp</beans:prop>\n\t\t\t\t<beans:prop key=\"mail.smtp.auth\">true</beans:prop>\n\t\t\t\t<beans:prop key=\"mail.smtp.starttls.enable\">true</beans:prop>\n\t\t\t</beans:props>\n\t\t</beans:property>\n\t</beans:bean>\n```\n\n\u6b21\u306bVelocity\u306e\u8a2d\u5b9a\u3092\u3057\u307e\u3059\nVelocity\u30d5\u30a1\u30a4\u30eb\u3092/\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d/src/main/resources/template\u306b\u8a2d\u7f6e\u3057\u307e\u3059\n\n```xml:servlet-context.xml\n    <beans:bean id=\"velocityEngine\" class=\"org.springframework.ui.velocity.VelocityEngineFactoryBean\">\n    \t<beans:property name=\"resourceLoaderPath\" value=\"classpath:template\" />\n    \t<beans:property name=\"velocityPropertiesMap\">\n    \t\t<beans:map>\n    \t\t\t<beans:entry key=\"input.encoding\" value=\"UTF-8\" />\n    \t\t\t<beans:entry key=\"output.encoding\" value=\"UTF-8\" />\n    \t\t</beans:map>\n    \t</beans:property>\n    </beans:bean>\n```\n\n#3. \u30e1\u30fc\u30eb\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8(Velocity)\u306e\u4f5c\u6210\n\nHelloWorld.vm\u3092\u4f5c\u6210\u3057\u307e\u3059\nVelocity\u3092\u4f5c\u6210\u3059\u308b\u5834\u6240\u306f/\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d/src/main/resources/template\u306b\u306a\u308a\u307e\u3059\n\n```vm:HelloWorld.vm\n\u3088\u3046\u3053\u305d \"user\"\n\n\u30b5\u30fc\u30d3\u30b9\u3092\u767b\u9332\u3057\u3066\u3042\u308a\u304c\u3068\u3046\n\n\u3042\u306a\u305f\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\"password\"\u3067\u3059\n```\n\n#4. \u30bd\u30fc\u30b9\u30fc\u30b3\u30fc\u30c9\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306b\u306a\u308a\u307e\u3059\n\u4e0a\u8a18\u3067\u8aac\u660e\u3057\u3066\u3044\u306a\u3044\u306e\u306f\u3001\u975e\u540c\u671f\u3068\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u304c\u7701\u7565\u3055\u305b\u3066\u304f\u3060\u3055\u3044\n\n```java:MailService\n@Service\npublic class MailService {\n\n    @Autowired\n    private JavaMailSender mailSender;\n    @Autowired\n    private VelocityEngine velocityEngine;\n\n    @Async // \u975e\u540c\u671f\n    public void doSendPasswordRemaindEmail() throws MessagingException {\n\n    \tMimeMessage message = mailSender.createMimeMessage();\n    \t// \u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u3092\u7528\u3044\u308b\u5834\u5408\u306f\u3001ture\u3092\u8a2d\u5b9a\u3057\u307e\u3059\n    \tMimeMessageHelper helper = new MimeMessageHelper(message, true);\n\n    \t// \u30e1\u30fc\u30eb\u672c\u6587\u306e\u751f\u6210\n    \tMap<String,Object> model = new HashMap<String,Object>();\n        StringWriter writer = new StringWriter();\n        model.put(\"user\", \"hoge\");\n        model.put(\"passowrd\", \"abcdef\");\n        VelocityContext ctx = new VelocityContext(model);\n        velocityEngine.mergeTemplate(\"HelloWorld.vm\", \"UTF-8\", ctx, writer);\n\n        // \u30e1\u30fc\u30eb\u672c\u6587\u306e\u30bb\u30c3\u30c8\n    \thelper.setText(writer.toString());\n\n    \t// \u30d5\u30a1\u30a4\u30eb\u3092\u30e1\u30fc\u30eb\u306b\u6dfb\u4ed8\n    \tFileSystemResource file = new FileSystemResource(new File(\"c:/hoge.jpg\"));\n    \thelper.addAttachment(\"hoge.jpg\", file);\n\n    \t// \u9001\u4fe1\u5148\u3092\u8a2d\u5b9a\n    \thelper.setTo(\"hoge@hoge.com\");\n\n    \t// \u9001\u4fe1\n    \tmailSender.send(message);\n    }\n}\n```\n#5. \u30a8\u30e9\u30fc\u3068\u5b9f\u884c\u74b0\u5883\n\n\u30c9\u30e1\u30a4\u30f3\u306b\u53c2\u52a0\u3057\u3066\u3044\u306a\u3044\u958b\u767a\u74b0\u5883\u304b\u3089\u5b9f\u884c\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3059\u3002\nPostfix\u7cfb\u306e\u30b5\u30fc\u30d0\u3060\u3068\u3001FQDN\u3067\u306a\u3044\u3068Deny\u3055\u308c\u307e\u3059\u3002\n\n```log:\u30a8\u30e9\u30fc\u30ed\u30b0\nCaused by: com.sun.mail.smtp.SMTPAddressFailedException:\n 504 5.5.2 <z@surfacePro3>: Sender address rejected: need fully-qualified address\n```\nJavaMail\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3057\u3057\u305f\u3089\u9001\u4fe1\u3057\u305f\u3044\u3068\u66f8\u304d\u305f\u3044\u306e\u3067\u3059\u304c\u3001\u3001\u3001\n\n```xml:servlet-context.xml\n<beans:prop key=\"mail.smtp.localhost\">hoge@fuga.com</beans:prop>\n```\n\n\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3059(^^;;\n\u3069\u306a\u305f\u304b\u52a9\u3051\u3066\u304f\u3060\u3055\u3044\u3002\u3002\u3002\u3000help me \u3002\u3002\u3002\n\n```log:\u30a8\u30e9\u30fc\u30ed\u30b0\nCaused by: com.sun.mail.smtp.SMTPAddressFailedException: 501 5.5.2 <hoge?fuga.com>: Helo command rejected: Invalid name\n```\n\n\u672c\u756a\u3067\u306f\u9001\u4fe1\u3067\u304d\u308b\u306e\u3067\u3059\u304c\u3001\u3001\u3001\n\n\n\u25a0 \u53c2\u8003\u6587\u732e\n[Spring 32.Email](http://docs.spring.io/spring/docs/current/spring-framework-reference/html/mail.html)\n"}