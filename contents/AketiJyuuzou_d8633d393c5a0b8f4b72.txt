{"context": "http://qiita.com/jnchito/items/7d5d7e829690ea3c4d6f\n\u3010SQL\u8155\u8a66\u3057\u554f\u984c\u3011\u7de0\u3081\u5207\u308a\u65e5\u304c\u8fd1\u3044\u30a4\u30d9\u30f3\u30c8\u306e\u4e00\u89a7\u306e\u53d6\u5f97\u3059\u308bSQL\n\u3092Oracle11gR2\u3067\u89e3\u304d\u307e\u3057\u305f\u3002\nwith events(id,name) as(\nselect 1,'Completed event'   from dual union\nselect 2,'No schedule event' from dual union\nselect 3,'Continuing event'  from dual union\nselect 4,'Future event 1'    from dual union\nselect 5,'Future event 2'    from dual),\nschedules(id,event_id,due_date) as(\nselect 1,1,date '2014-01-23' from dual union\nselect 2,3,date '2014-01-01' from dual union\nselect 3,3,date '2014-02-01' from dual union\nselect 4,3,date '2014-03-01' from dual union\nselect 5,4,date '2014-01-24' from dual union\nselect 6,4,date '2014-01-25' from dual union\nselect 7,5,date '2014-01-24' from dual),\nsysdate_dummy(sys_date) as(\nselect date '2014-01-24' from dual),\ntmp as(\nselect a.id,a.name,b.ID as schedule_id,b.due_date,\ncount(b.event_id) over(partition by a.id) as JoinCnt,\nmin(case when b.due_date >= (select max(sys_date) from sysdate_dummy)\n         then b.due_date end)\nover(partition by b.event_id) as SaisyouJyoukai\n  from events a\n  Left Join schedules b\n    on a.id = b.event_id)\nselect id,name,schedule_id,due_date\n  from tmp\n where JoinCnt = 0\n    or due_date = SaisyouJyoukai\norder by due_date,schedule_id;\n\nID  NAME               SCHEDULE_ID  DUE_DATE\n--  -----------------  -----------  ----------\n 4  Future event 1               5  2014-01-24\n 5  Future event 2               7  2014-01-24\n 3  Continuing event             3  2014-02-01\n 2  No schedule event         null  null\n\nhttp://qiita.com/jnchito/items/7d5d7e829690ea3c4d6f\n\u3010SQL\u8155\u8a66\u3057\u554f\u984c\u3011\u7de0\u3081\u5207\u308a\u65e5\u304c\u8fd1\u3044\u30a4\u30d9\u30f3\u30c8\u306e\u4e00\u89a7\u306e\u53d6\u5f97\u3059\u308bSQL\n\u3092Oracle11gR2\u3067\u89e3\u304d\u307e\u3057\u305f\u3002\n\n```sql\nwith events(id,name) as(\nselect 1,'Completed event'   from dual union\nselect 2,'No schedule event' from dual union\nselect 3,'Continuing event'  from dual union\nselect 4,'Future event 1'    from dual union\nselect 5,'Future event 2'    from dual),\nschedules(id,event_id,due_date) as(\nselect 1,1,date '2014-01-23' from dual union\nselect 2,3,date '2014-01-01' from dual union\nselect 3,3,date '2014-02-01' from dual union\nselect 4,3,date '2014-03-01' from dual union\nselect 5,4,date '2014-01-24' from dual union\nselect 6,4,date '2014-01-25' from dual union\nselect 7,5,date '2014-01-24' from dual),\nsysdate_dummy(sys_date) as(\nselect date '2014-01-24' from dual),\ntmp as(\nselect a.id,a.name,b.ID as schedule_id,b.due_date,\ncount(b.event_id) over(partition by a.id) as JoinCnt,\nmin(case when b.due_date >= (select max(sys_date) from sysdate_dummy)\n         then b.due_date end)\nover(partition by b.event_id) as SaisyouJyoukai\n  from events a\n  Left Join schedules b\n    on a.id = b.event_id)\nselect id,name,schedule_id,due_date\n  from tmp\n where JoinCnt = 0\n    or due_date = SaisyouJyoukai\norder by due_date,schedule_id;\n\nID  NAME               SCHEDULE_ID  DUE_DATE\n--  -----------------  -----------  ----------\n 4  Future event 1               5  2014-01-24\n 5  Future event 2               7  2014-01-24\n 3  Continuing event             3  2014-02-01\n 2  No schedule event         null  null\n```\n", "tags": ["oracle", "SQL"]}