{"context": " More than 1 year has passed since last update.AWS Lambda\u3067Phalcon\u3084\u305d\u306e\u4ed6\u306ephp\u306aextensions\u3092\u4f7f\u7528\u3059\u308b\u65b9\u6cd5\u306e\u3054\u7d39\u4ecb\n\u9700\u8981\u304c\u3042\u308b\u306e\u304b\u3069\u3046\u304b\u306f\u4e0d\u660e\nAWS Lambda\u3067PHP\u3092\u4f7f\u3046\u65b9\u6cd5\u306b\u3064\u3044\u3066\u306f\u3053\u3061\u3089\u3092\u53c2\u7167\n\nphalcon\u306e\u30b3\u30f3\u30d1\u30a4\u30eb\nAWS Lambda\u306fAmazon Linux\u3067\u52d5\u3044\u3066\u3044\u308b\u306e\u3067\u3001Linux\u306a\u74b0\u5883\u3067\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u3002\n\u57fa\u672c\u7684\u306b\u516c\u5f0f\u306e\u30de\u30cb\u30e5\u30a2\u30eb\u901a\u308a\u3067\u826f\u3044\u304c\u3001install\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u307e\u3067\u3059\u308b\u3088\u3046\u306b\u66f8\u304b\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u30d3\u30eb\u30c9\u7528\u306e\u74b0\u5883\u306bphalcon\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u304f\u306a\u3044\u5834\u5408\u306b\u306f\u66f8\u304d\u63db\u3048\u304c\u5fc5\u8981\u3002\n\nbuild-only.patch\ndiff --git build/install build/install\nindex 60f5e29..29f4d85 100755\n--- build/install\n+++ build/install\n@@ -61,4 +61,4 @@ if [ -f Makefile ]; then\n fi\n\n #Perform the compilation\n-phpize && ./configure --enable-phalcon && make && make install && echo -e \"\\nThanks for compiling Phalcon!\\nBuild succeed: Please restart your web server to complete the installation\"\n+phpize && ./configure --enable-phalcon && make && echo -e \"\\nThanks for compiling Phalcon!\\nBuild succeed\"\n\n\n\u5171\u6709\u30e9\u30a4\u30d6\u30e9\u30ea\u30d5\u30a1\u30a4\u30eb\u306fbuild/64bits/modules/phalcon.so\u3068\u3057\u3066\u751f\u6210\u3055\u308c\u308b\u3002\n\n\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\u4f8b\n\nfile-tree\n\u251c\u2500\u2500 index.js\n\u251c\u2500\u2500 script.sh\n\u251c\u2500\u2500 app\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 index.php\n\u2514\u2500\u2500 php\n\u00a0\u00a0\u00a0 \u251c\u2500\u2500 ext\n\u00a0\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 phalcon.so #phalcon extension\n\u00a0\u00a0\u00a0 \u251c\u2500\u2500 php            #php cli\n\u00a0\u00a0\u00a0 \u2514\u2500\u2500 php.ini\n\n\n\n\u5404\u30d5\u30a1\u30a4\u30eb\u306b\u3064\u3044\u3066\u7c21\u5358\u306a\u8aac\u660e\n\nindex.js\nexports.handler = function(event, context) {\n  var exec = require('child_process').exec;\n  var uri_path = \"undefined\" == typeof event.uri_path\n                 ? '' : event.uri_path;\n  exec('sh script.sh ' + uri_path, function (error, stdout, stderr) {\n    if(stdout){\n      console.log('stdout: ' + stdout);\n    }\n    if(stderr){\n      console.log('stderr: ' + stderr);\n    }\n    if (error !== null) {\n      console.log('Exec error: ' + error);\n    }\n    context.succeed(stdout);\n  });\n};\n\n\n\u2191index.js \u306fAWS Lambda\u304c\u8d77\u52d5\u3057\u305f\u6642\u306b\u6700\u521d\u306b\u8aad\u307f\u8fbc\u307e\u308c\u308b\u30d5\u30a1\u30a4\u30eb\u3002\u3053\u3053\u304b\u3089script.sh\u3092\u8d77\u52d5\u3059\u308b\u3002\n\nscript.sh\n#!/bin/sh\n./php/php -S localhost:8080 -t ./app &\nuntil curl http://localhost:8080/$1\ndo\n    :\ndone\nkill $!\n\n\n\u2191php\u306ebuilt-in server\u3092\u7acb\u3061\u4e0a\u3052\u3001curl\u30b3\u30de\u30f3\u30c9\u3067\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u6295\u3052\u308b\u3002\nbuilt-in server\u304c\u7acb\u3061\u4e0a\u304c\u308b\u3088\u308a\u5148\u306bcurl\u30b3\u30de\u30f3\u30c9\u304c\u52d5\u3044\u3066\u3057\u307e\u3046\u5834\u5408\u304c\u3042\u308b\u305f\u3081\u3001\u6b63\u5e38\u306b\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u53d7\u3051\u53d6\u308b\u307e\u3067\u30ea\u30c8\u30e9\u30a4\u3059\u308b\u3088\u3046\u3001until\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u3002\n\napp/index.php\n<?php\nphpinfo();\n\n\n\u2191script.sh\u3067\u7acb\u3061\u4e0a\u3052\u305fbuilt-in server\u304c\u53c2\u7167\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3002phalcon\u304c\u8aad\u307f\u8fbc\u307e\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\u305f\u3081\u3001phpinfo()\u3092\u51fa\u529b\u3002\n\nphp.ini\ndate.timezone=\"Asia/Tokyo\"\nextension_dir=\"/var/task/php/ext\"\nextension=phalcon.so\n\n\n\u2191extention\u3067\u3042\u308bphalcon\u3092\u8aad\u307f\u8fbc\u3080\u305f\u3081\u306e\u8a2d\u5b9a\u3002\n\nphp-configure-options\n./configure \\\\\n--prefix=/var/task/php \\\\\n--disable-all \\\\\n&& make\n\n\n\u2191php\u306econfigure\u30aa\u30d7\u30b7\u30e7\u30f3\u3002\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308bphp.ini\u3092\u53c2\u7167\u3059\u308b\u3088\u3046\u3001prefix\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\nAWS Lambda\u3078\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\nzip -r phalcon.zip app index.js php script.sh\n\u3067\u30d5\u30a1\u30a4\u30eb\u3092zip\u306b\u307e\u3068\u3081\u3066\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u3002\n\u4eca\u56de\u3001zip\u30d5\u30a1\u30a4\u30eb\u306f3MB\u7a0b\u5ea6\u306b\u306a\u3063\u305f\u306e\u3067\u3001AWS Lambda\u306eWeb\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u305f\u3002\n\u4ed6\u306e\u62e1\u5f35\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u3084PHP\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u5927\u304d\u3044\u5834\u5408\u306a\u3069\u300110MB\u3092\u8d85\u3048\u308b\u30b1\u30fc\u30b9\u3067\u306f\u3001\u4e00\u65e6S3\u3078\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n\u7d50\u679c\nAPI Gateway\u7d4c\u7531\u3067\u30a2\u30af\u30bb\u30b9\u3057\u3001phpinfo\u306e\u51fa\u529b\u3092\u78ba\u8a8d\u3002\nphalcon\u304cextension\u3068\u3057\u3066\u8aad\u307f\u8fbc\u307e\u308c\u3066\u3044\u308b\u3002\n\nAPI Gateway\u7d4c\u7531\u3067AWS Lambda\u306bHTML\u3092\u51fa\u529b\u3055\u305b\u308b\u65b9\u6cd5\u306b\u3064\u3044\u3066\u306f\u3053\u3061\u3089\u3092\u53c2\u7167\u3002\n\n\u307e\u3068\u3081\nphp.ini\u3092\u53c2\u7167\u3059\u308b\u3088\u3046php\u306econfigure\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u91cd\u8981\u3002\n\u540c\u3058\u3088\u3046\u306b\u914d\u7f6e\u3092\u3059\u308c\u3070\u3001\u4ed6\u306eextension\u3082\u4f7f\u7528\u3067\u304d\u308b\u3002\n\nAWS Lambda\u3067Phalcon\u3084\u305d\u306e\u4ed6\u306ephp\u306aextensions\u3092\u4f7f\u7528\u3059\u308b\u65b9\u6cd5\u306e\u3054\u7d39\u4ecb\n\u9700\u8981\u304c\u3042\u308b\u306e\u304b\u3069\u3046\u304b\u306f\u4e0d\u660e\nAWS Lambda\u3067PHP\u3092\u4f7f\u3046\u65b9\u6cd5\u306b\u3064\u3044\u3066\u306f[\u3053\u3061\u3089](http://qiita.com/oh-sky/items/646d326ee23ae640153f)\u3092\u53c2\u7167\n\n## phalcon\u306e\u30b3\u30f3\u30d1\u30a4\u30eb\nAWS Lambda\u306fAmazon Linux\u3067\u52d5\u3044\u3066\u3044\u308b\u306e\u3067\u3001Linux\u306a\u74b0\u5883\u3067\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u3002\n\u57fa\u672c\u7684\u306b[\u516c\u5f0f\u306e\u30de\u30cb\u30e5\u30a2\u30eb](https://docs.phalconphp.com/en/latest/reference/install.html#compilation)\u901a\u308a\u3067\u826f\u3044\u304c\u3001install\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u307e\u3067\u3059\u308b\u3088\u3046\u306b\u66f8\u304b\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u30d3\u30eb\u30c9\u7528\u306e\u74b0\u5883\u306bphalcon\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u304f\u306a\u3044\u5834\u5408\u306b\u306f\u66f8\u304d\u63db\u3048\u304c\u5fc5\u8981\u3002\n\n```diff:build-only.patch\ndiff --git build/install build/install\nindex 60f5e29..29f4d85 100755\n--- build/install\n+++ build/install\n@@ -61,4 +61,4 @@ if [ -f Makefile ]; then\n fi\n \n #Perform the compilation\n-phpize && ./configure --enable-phalcon && make && make install && echo -e \"\\nThanks for compiling Phalcon!\\nBuild succeed: Please restart your web server to complete the installation\"\n+phpize && ./configure --enable-phalcon && make && echo -e \"\\nThanks for compiling Phalcon!\\nBuild succeed\"\n```\n\n\u5171\u6709\u30e9\u30a4\u30d6\u30e9\u30ea\u30d5\u30a1\u30a4\u30eb\u306f`build/64bits/modules/phalcon.so`\u3068\u3057\u3066\u751f\u6210\u3055\u308c\u308b\u3002\n\n## \u30d5\u30a1\u30a4\u30eb\u69cb\u6210\u4f8b\n\n```bash:file-tree\n\u251c\u2500\u2500 index.js\n\u251c\u2500\u2500 script.sh\n\u251c\u2500\u2500 app\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 index.php\n\u2514\u2500\u2500 php\n\u00a0\u00a0\u00a0 \u251c\u2500\u2500 ext\n\u00a0\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 phalcon.so #phalcon extension\n\u00a0\u00a0\u00a0 \u251c\u2500\u2500 php            #php cli\n\u00a0\u00a0\u00a0 \u2514\u2500\u2500 php.ini\n```\n\n### \u5404\u30d5\u30a1\u30a4\u30eb\u306b\u3064\u3044\u3066\u7c21\u5358\u306a\u8aac\u660e\n\n```javascript:index.js\nexports.handler = function(event, context) {\n  var exec = require('child_process').exec;\n  var uri_path = \"undefined\" == typeof event.uri_path\n                 ? '' : event.uri_path;\n  exec('sh script.sh ' + uri_path, function (error, stdout, stderr) {\n    if(stdout){\n      console.log('stdout: ' + stdout);\n    }\n    if(stderr){\n      console.log('stderr: ' + stderr);\n    }\n    if (error !== null) {\n      console.log('Exec error: ' + error);\n    }\n    context.succeed(stdout);\n  });\n};\n```\n\u2191index.js \u306fAWS Lambda\u304c\u8d77\u52d5\u3057\u305f\u6642\u306b\u6700\u521d\u306b\u8aad\u307f\u8fbc\u307e\u308c\u308b\u30d5\u30a1\u30a4\u30eb\u3002\u3053\u3053\u304b\u3089script.sh\u3092\u8d77\u52d5\u3059\u308b\u3002\n\n```sh:script.sh\n#!/bin/sh\n./php/php -S localhost:8080 -t ./app &\nuntil curl http://localhost:8080/$1\ndo\n    :\ndone\nkill $!\n```\n\u2191php\u306ebuilt-in server\u3092\u7acb\u3061\u4e0a\u3052\u3001curl\u30b3\u30de\u30f3\u30c9\u3067\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u6295\u3052\u308b\u3002\nbuilt-in server\u304c\u7acb\u3061\u4e0a\u304c\u308b\u3088\u308a\u5148\u306bcurl\u30b3\u30de\u30f3\u30c9\u304c\u52d5\u3044\u3066\u3057\u307e\u3046\u5834\u5408\u304c\u3042\u308b\u305f\u3081\u3001\u6b63\u5e38\u306b\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u53d7\u3051\u53d6\u308b\u307e\u3067\u30ea\u30c8\u30e9\u30a4\u3059\u308b\u3088\u3046\u3001until\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u3002\n\n```php:app/index.php\n<?php\nphpinfo();\n```\n\u2191script.sh\u3067\u7acb\u3061\u4e0a\u3052\u305fbuilt-in server\u304c\u53c2\u7167\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3002phalcon\u304c\u8aad\u307f\u8fbc\u307e\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\u305f\u3081\u3001phpinfo()\u3092\u51fa\u529b\u3002\n\n```bash:php.ini\ndate.timezone=\"Asia/Tokyo\"\nextension_dir=\"/var/task/php/ext\"\nextension=phalcon.so\n```\n\u2191extention\u3067\u3042\u308bphalcon\u3092\u8aad\u307f\u8fbc\u3080\u305f\u3081\u306e\u8a2d\u5b9a\u3002\n\n```bash:php-configure-options\n./configure \\\\\n--prefix=/var/task/php \\\\\n--disable-all \\\\\n&& make\n```\n\u2191php\u306econfigure\u30aa\u30d7\u30b7\u30e7\u30f3\u3002\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308bphp.ini\u3092\u53c2\u7167\u3059\u308b\u3088\u3046\u3001prefix\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n## AWS Lambda\u3078\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n`zip -r phalcon.zip app index.js php script.sh`\n\u3067\u30d5\u30a1\u30a4\u30eb\u3092zip\u306b\u307e\u3068\u3081\u3066\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u3002\n\u4eca\u56de\u3001zip\u30d5\u30a1\u30a4\u30eb\u306f3MB\u7a0b\u5ea6\u306b\u306a\u3063\u305f\u306e\u3067\u3001AWS Lambda\u306eWeb\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u305f\u3002\n\n\u4ed6\u306e\u62e1\u5f35\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u3084PHP\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u5927\u304d\u3044\u5834\u5408\u306a\u3069\u300110MB\u3092\u8d85\u3048\u308b\b\u30b1\u30fc\u30b9\u3067\u306f\u3001\u4e00\u65e6S3\u3078\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n\n## \u7d50\u679c\nAPI Gateway\u7d4c\u7531\u3067\u30a2\u30af\u30bb\u30b9\u3057\u3001phpinfo\u306e\u51fa\u529b\u3092\u78ba\u8a8d\u3002\nphalcon\u304cextension\u3068\u3057\u3066\u8aad\u307f\u8fbc\u307e\u308c\u3066\u3044\u308b\u3002\n\n![Screen Shot 2015-12-01 at 3.27.58 PM.png](https://qiita-image-store.s3.amazonaws.com/0/13038/6dd61850-19db-9eec-a97b-6aabaa0cecf0.png \"Screen Shot 2015-12-01 at 3.27.58 PM.png\")\n\nAPI Gateway\u7d4c\u7531\u3067AWS Lambda\u306bHTML\u3092\u51fa\u529b\u3055\u305b\u308b\u65b9\u6cd5\u306b\u3064\u3044\u3066\u306f[\u3053\u3061\u3089](http://www.slideshare.net/oh-sky/php-aws-lambdawebapp)\u3092\u53c2\u7167\u3002\n\n## \u307e\u3068\u3081\n\nphp.ini\u3092\u53c2\u7167\u3059\u308b\u3088\u3046php\u306econfigure\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u91cd\u8981\u3002\n\u540c\u3058\u3088\u3046\u306b\u914d\u7f6e\u3092\u3059\u308c\u3070\u3001\u4ed6\u306eextension\u3082\u4f7f\u7528\u3067\u304d\u308b\u3002\n\n", "tags": ["Phalcon", "lambda", "PHP"]}