{"context": " More than 1 year has passed since last update.\u30bb\u30f3\u30b5\u30fc\u30c7\u30fc\u30bf\u306b\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3092\u4ed8\u3051\u3066Cloudant\u306b\u4fdd\u7ba1\u3059\u308b\u6d41\u308c\u3092\u3001Node-RED\u3092\u4f7f\u3063\u3066\u30bb\u30f3\u30b5\u30fc\u30c7\u30fc\u30bf\u3092Cloudant\u306b\u683c\u7d0d\u3059\u308b\u306b\u66f8\u304d\u307e\u3057\u305f\u3002\n\u4eca\u56de\u306f\u3001Cloudant\u306b\u4fdd\u7ba1\u3057\u305f\u30c7\u30fc\u30bf\u3092\u5229\u7528\u3059\u308b\u65b9\u6cd5\u306b\u3064\u3044\u3066\u66f8\u304d\u307e\u3059\u3002\nNode-RED\u3092\u4f7f\u3063\u3066HTTP GET\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u4ed8\u3051\u308b\u30d5\u30ed\u30fc\u3092\u4f5c\u6210\u3057\u3001\u3053\u306e\u4e2d\u3067Cloudant\u304b\u3089\u30bb\u30f3\u30b5\u30fc\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n\u524d\u63d0\nNode-RED\u3092\u4f7f\u3063\u3066\u30bb\u30f3\u30b5\u30fc\u30c7\u30fc\u30bf\u3092Cloudant\u306b\u683c\u7d0d\u3059\u308b\u306e\u30d5\u30ed\u30fc\u3092Bluemix\u4e0a\u306eNode-RED\u306b\u30c7\u30d7\u30ed\u30a4\u6e08\u307f\u3067\u3042\u308b\u3053\u3068\u3068\u3057\u307e\u3059\u3002\n\n\u4f5c\u696d\u306e\u6d41\u308c\n\nCloudant\u306bSearchIndex\u3092\u4f5c\u6210\u3059\u308b\nNode-RED\u3092\u4f7f\u3063\u3066\u3001HTTP GET\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u4ed8\u3051\u308b\u30d5\u30ed\u30fc\u3092\u4f5c\u6210\u3059\u308b\n\u52d5\u4f5c\u78ba\u8a8d\n\n\n1. Cloudant\u306bSearchIndex\u3092\u4f5c\u6210\u3059\u308b\nCloudant\u306b\u306f\u3001\u4ee5\u4e0b\u306e\u5f62\u5f0f\u3067\u30c7\u30fc\u30bf\u304c\u4fdd\u7ba1\u3055\u308c\u3066\u3044\u307e\u3059\u3002Cloudant\u4fdd\u7ba1\u6642\u306b\u4efb\u610f\u306b\u4ed8\u3051\u3089\u308c\u308b_id\u304c\u30ad\u30fc\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u4eca\u56de\u306f\u3001\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3067\u691c\u7d22\u304c\u3067\u304d\u308b\u3088\u3046\u306btimestamp\u3092\u30ad\u30fc\u3068\u3059\u308bCloudant\u306eSearch Index\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002Search Index\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u3067\u3001Lucene\u306e\u66f8\u5f0f\u3067\u691c\u7d22\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n{\n  \"_id\": \"07f647f960d8f2cba14221f96646df60\",\n  \"_rev\": \"1-26ae484039d6ad18c39f1ce0117c6634\",\n  \"timestamp\": \"2015-04-23 07:52:21\",\n  \"temp\": 15,\n  \"humidity\": 76,\n  \"objectTemp\": 24\n}\n\nCloudant\u306e\u7ba1\u7406\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9sensordata\u3092\u9078\u629e\u3057\u305f\u72b6\u614b\u3067\u3001All Design Docs\u306e\u53f3\u306b\u3042\u308b\uff0b\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\u7d9a\u3044\u3066New Search Index\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\nSave to Design Document\u306e_design/\u306e\u5f8c\u308d\u306bIndex\u3001Index name\u306bIndexByTimestamp\u3092\u5165\u529b\u3057\u307e\u3059\u3002Search index function\u306b\u306f\u3001\u4ee5\u4e0b\u3092\u5165\u529b\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001Cloudant\u306b\u683c\u7d0d\u3057\u305f\u30c7\u30fc\u30bf\u306e\u4e2d\u306etimestamp\u8981\u7d20\u3092\u30ad\u30fc\u3068\u3057\u305f\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\nfunction(doc){\n index(\"timestamp\", doc.timestamp, { \"store\": true });\n}\n\nType\u3068\u3057\u3066Keyword\u3092\u9078\u629e\u3057\u3001\u6700\u5f8c\u306bSave & Build Index\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\u3053\u308c\u3067Search Index\u304c\u5b8c\u6210\u3057\u307e\u3057\u305f\u3002\n\u5165\u529b\u4f8b\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3067\u3059\u3002\n\n\n2. Node-RED\u3092\u4f7f\u3063\u3066\u3001HTTP GET\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u4ed8\u3051\u308b\u30d5\u30ed\u30fc\u3092\u4f5c\u6210\u3059\u308b\nNode-RED\u3067\u306f\u3001HTTP\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u4ed8\u3051\u308b\u30ce\u30fc\u30c9\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u3092\u5229\u7528\u3057\u3066\u3001\u30d6\u30e9\u30a6\u30b6\u3084\u30d7\u30ed\u30b0\u30e9\u30e0\u304b\u3089HTTP GET\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u4ed8\u3051\u308b\u30d5\u30ed\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nGET\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30af\u30a8\u30ea\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3068\u3057\u307e\u3059\u3002\n\n\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u540d\n\u7528\u9014\n\u66f8\u5f0f\n\n\n\n\nstart\n\u30bb\u30f3\u30b5\u30fc\u30c7\u30fc\u30bf\u306e\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u306e\u691c\u7d22\u958b\u59cb\u65e5\u6642\nyyyy-mm-ddThhssZ\n\n\nend\n\u30bb\u30f3\u30b5\u30fc\u30c7\u30fc\u30bf\u306e\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u306e\u691c\u7d22\u7d42\u4e86\u65e5\u6642\nyyyy-mm-ddThhssZ\n\n\n\n\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u4f8b\u3067\u3059\u3002\n\nhttp://sample.mybluemix.net/sensordata?start=2015-04-22T19:40:00Z&end=2015-04-22T19:40:00Z\n\n\u305d\u308c\u3067\u306f\u30d5\u30ed\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002Node-RED\u306e\u30d5\u30ed\u30fc\u30a8\u30c7\u30a3\u30bf\u30fc\u3092\u4f7f\u3063\u3066\u3001\u4ee5\u4e0b\u306e\u30d5\u30ed\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u306e5\u3064\u306e\u30ce\u30fc\u30c9\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n\n\u30ce\u30fc\u30c9\n\n\u7528\u9014\n\n\n\n\nhttp\u30ce\u30fc\u30c9\n\nHTTP\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u53d7\u4ed8\n\n\nfunction\u30ce\u30fc\u30c9\n\n\u30ea\u30af\u30a8\u30b9\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf\u304b\u3089Cloudant\u691c\u7d22\u7528\u6587\u5b57\u5217\u306e\u751f\u6210\n\n\nCloudant\u30ce\u30fc\u30c9\n\nCloudant\u304b\u3089\u306e\u30c7\u30fc\u30bf\u53d6\u5f97\n\n\nhttp response\u30ce\u30fc\u30c9\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3078\u30ec\u30b9\u30dd\u30f3\u30b9\u9001\u4fe1\n\n\nDebug\u30ce\u30fc\u30c9\n\n\u51fa\u529b\u7d50\u679c\u78ba\u8a8d\n\n\n\n\nhttp\u30ce\u30fc\u30c9\u306e\u69cb\u6210\nhttp\u30ce\u30fc\u30c9\u306f\u3001\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u69cb\u6210\u3057\u3066\u3044\u307e\u3059\u3002HTTP\u306eGET\u30e1\u30bd\u30c3\u30c9\u3092\u5229\u7528\u3057\u3001URL\u306e\u30d1\u30b9\u3092/sensordata\u3068\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u3053\u3067\u8a2d\u5b9a\u3057\u305f\u30d1\u30b9\u3092\u542b\u3080URL\u306f\u3001Node-RED\u30d5\u30ed\u30fc\u30a8\u30c7\u30a3\u30bf\u30fc\u306eFQDN\u306b\u30d1\u30b9\u3092\u52a0\u3048\u305f\u3082\u306e\u3068\u306a\u308a\u307e\u3059\u3002\n\u305f\u3068\u3048\u3070\u3001\u30d5\u30ed\u30fc\u30a8\u30c7\u30a3\u30bf\u30fc\u306eURL\u304chttp://sample.mybluemix.net/red/\u306e\u5834\u5408\u3001\u3053\u3053\u3067\u8a2d\u5b9a\u3059\u308bGET\u30ea\u30af\u30a8\u30b9\u30c8\u306eURL\u306f\u3001http://sample.mybluemix.net/sensordata\u3068\u306a\u308a\u307e\u3059\u3002\n\n\nfunction\u30ce\u30fc\u30c9\u306e\u69cb\u6210\nCloundant\u306e\u691c\u7d22\u306b\u4f7f\u7528\u3059\u308b\u6587\u5b57\u5217\u3092\u751f\u6210\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306eJSON\u5f62\u5f0f\u306e\u30c7\u30fc\u30bf\u3092Cloudant\u306e\u691c\u7d22\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\n{\n  \"query\": \"[ start_date TO end_date ]\",\n  \"limit\": 200\n}\n\nquery\u306e\u90e8\u5206\u306bLucene\u306e\u8a18\u6cd5\u306e\u691c\u7d22\u6587\u5b57\u5217\u3092\u5165\u529b\u3057\u307e\u3059\u3002\u4eca\u56de\u306f\u3001start_date\u3068end_date\u306e\u90e8\u5206\u304c\u3001HTTP GET\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30af\u30a8\u30ea\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3067\u53d7\u3051\u53d6\u308b\u5024\u3092\u4f7f\u7528\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\nSearch Index\u306e\u30af\u30a8\u30ea\u30fc\u7d50\u679c\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306725\u4ef6\u307e\u3067\u3057\u304b\u8fd4\u3055\u306a\u3044\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u5236\u9650\u3092\u5909\u66f4\u3059\u308b\u305f\u3081\u306b\u3001limit\u3092200\u3068\u3057\u3066\u3044\u307e\u3059\u3002\u6b8b\u5ff5\u306a\u304c\u3089\u3001\u5236\u7d04\u3068\u3057\u3066\u3001200\u3092\u8d85\u3048\u308b\u7d50\u679c\u3092\u8fd4\u3059\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\nfunction\u30ce\u30fc\u30c9\u306b\u767b\u9332\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u3001\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3067\u3059\u3002\nmsg.payload = {\n    \"query\": \"timestamp:[\" + msg.payload.start + \" TO \" + msg.payload.end + \"]\",\n    \"limit\": 200\n}\n\nreturn msg;\n\n\nCloudant\u30ce\u30fc\u30c9\u306e\u69cb\u6210\nCloudant\u30ce\u30fc\u30c9\u306e\u8a2d\u5b9a\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3067\u3059\u3002\n\n\n\n\u8a2d\u5b9a\u9805\u76ee\n\u5185\u5bb9\n\n\n\n\nService\nBluemix\u4e0a\u306b\u4f5c\u6210\u3055\u308c\u305fCloudant\u306e\u30b5\u30fc\u30d3\u30b9\u540d\u3092\u9078\u629e\u3057\u307e\u3059\n\n\nDatabase\nCloudant\u306b\u4f5c\u6210\u3057\u305f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d\u3067\u3042\u308bsensordata\u3092\u5165\u529b\u3057\u307e\u3059\n\n\nSearch by\n\nsearch index\u3092\u9078\u629e\u3057\u307e\u3059\u3002\u5bfe\u8c61\u306eIndex\u3068\u3057\u3066\u3001Search Index\u306e\u4f5c\u6210\u3067\u4f5c\u6210\u3057\u3066Index\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n\nName\n\u30ce\u30fc\u30c9\u306b\u4ed8\u3051\u308b\u540d\u524d\u3067\u3059\u3002\u4efb\u610f\u306e\u5024\u3067\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002\n\n\n\n\u5165\u529b\u4f8b\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3067\u3059\u3002\n\n\nhttp response\u30ce\u30fc\u30c9\u306e\u69cb\u6210\nhttp response\u30ce\u30fc\u30c9\u306f\u3001\u30ce\u30fc\u30c9\u306e\u540d\u524d\u4ee5\u5916\u306b\u8a2d\u5b9a\u9805\u76ee\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u4efb\u610f\u306e\u540d\u524d\u3092\u3064\u3051\u3066\u304f\u3060\u3055\u3044\u3002\n\n\uff08\u53c2\u8003\uff09\u30b5\u30f3\u30d7\u30eb\u30d5\u30ed\u30fc\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\n\u4ee5\u4e0b\u306eJSON\u3092\u3001Node-RED\u5c0f\u30ef\u30b6\u96c6\u306e\u5c0f\u30ef\u30b61. \u30d5\u30ed\u30fc\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\u306e\u65b9\u6cd5\u3092\u4f7f\u3063\u3066\u30a4\u30f3\u30dd\u30fc\u30c8\u3059\u308b\u3053\u3068\u3067\u3001\u30b5\u30f3\u30d7\u30eb\u30d5\u30ed\u30fc\u3092\u5fa9\u5143\u3067\u304d\u307e\u3059\u3002\n[{\"id\":\"8adf6400.6d175\",\"type\":\"http in\",\"name\":\"Get Sensor Data\",\"url\":\"/sensordata\",\"method\":\"get\",\"x\":125,\"y\":359,\"z\":\"56be2dc6.6f2e4c\",\"wires\":[[\"bce3b962.ddd648\"]]},{\"id\":\"5a004193.4e4b7\",\"type\":\"cloudant in\",\"service\":\"IoTFSample-cloudantNoSQLDB\",\"cloudant\":\"\",\"name\":\"Get Sensor Data from Cloudant\",\"database\":\"sensordata\",\"search\":\"_idx_\",\"design\":\"Index\",\"index\":\"IndexByTimestamp\",\"x\":367,\"y\":439,\"z\":\"56be2dc6.6f2e4c\",\"wires\":[[\"43775b51.c3a424\",\"7b27b5c9.f5f754\"]]},{\"id\":\"43775b51.c3a424\",\"type\":\"http response\",\"name\":\"Response to Client\",\"x\":636,\"y\":439,\"z\":\"56be2dc6.6f2e4c\",\"wires\":[]},{\"id\":\"7b27b5c9.f5f754\",\"type\":\"debug\",\"name\":\"Check Output\",\"active\":false,\"console\":\"false\",\"complete\":\"payload\",\"x\":560,\"y\":361,\"z\":\"56be2dc6.6f2e4c\",\"wires\":[]},{\"id\":\"bce3b962.ddd648\",\"type\":\"function\",\"name\":\"Create Query\",\"func\":\"msg.payload = {\\n    \\\"query\\\": \\\"timestamp:[\\\" + msg.payload.start + \\\" TO \\\" + msg.payload.end + \\\"]\\\",\\n    \\\"limit\\\": 200\\n}\\n\\nreturn msg;\",\"outputs\":1,\"valid\":true,\"x\":318,\"y\":359,\"z\":\"56be2dc6.6f2e4c\",\"wires\":[[\"5a004193.4e4b7\"]]}]\n\n\n\u30d5\u30ed\u30fc\u306e\u30c7\u30d7\u30ed\u30a4\n\u4ee5\u4e0a\u3067\u30d5\u30ed\u30fc\u306e\u4f5c\u6210\u306f\u5b8c\u4e86\u3067\u3059\u3002\u30d5\u30ed\u30fc\u30a8\u30c7\u30a3\u30bf\u30fc\u53f3\u4e0a\u306e  \u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3001\u30d5\u30ed\u30fc\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u307e\u3059\u3002\n\n3. \u52d5\u4f5c\u78ba\u8a8d\n\u30d6\u30e9\u30a6\u30b6\u3092\u5229\u7528\u3057\u3066\u3001\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u30af\u30a8\u30ea\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3068\u3057\u3066\u691c\u7d22\u958b\u59cb\u65e5\u6642\u306estart\u3068\u691c\u7d22\u7d42\u4e86\u65e5\u6642\u306eend\u3092\u6307\u5b9a\u3057\u3066\u3001http\u30ce\u30fc\u30c9\u3092\u69cb\u6210\u3057\u305f\u969b\u306b\u5165\u529b\u3057\u305fURL\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n\u30a2\u30af\u30bb\u30b9\u3059\u308bURL\u306e\u4f8b\u3067\u3059\u3002\nhttp://sample.mybluemix.net/sensordata?start=2015-04-22T19:30:00Z&end=2015-04-22T19:36:00Z\n\n\u4ee5\u4e0b\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n[\n  {\n    \"_id\": \"40384c3ef6fb489997adc0530819e2d3\",\n    \"_rev\": \"1-6033dce739fee18f34063d7345fe61ed\",\n    \"timestamp\": \"2015-04-22T19:30:15Z\",\n    \"temp\": 44,\n    \"humidity\": 51,\n    \"objectTemp\": 32\n  },\n  {\n    \"_id\": \"38ab698d4e8f3c6e5e4f011db2cb5082\",\n    \"_rev\": \"1-c3118a250f8f40f56c23b27472403f1f\",\n    \"timestamp\": \"2015-04-22T19:30:41Z\",\n    \"temp\": 44,\n    \"humidity\": 51,\n    \"objectTemp\": 32\n  },\n  {\n    \"_id\": \"9f84503729658d77f5d28fd3c4a782a2\",\n    \"_rev\": \"1-c6a3a5e68e8aebff97e5f289925e2460\",\n    \"timestamp\": \"2015-04-22T19:30:47Z\",\n    \"temp\": 44,\n    \"humidity\": 51,\n    \"objectTemp\": 32\n  },\n  {\n    \"_id\": \"0f3c227bbc36bbec8e31b2eb877bdcd1\",\n    \"_rev\": \"1-4826ef6ded531287516107891033eee7\",\n    \"timestamp\": \"2015-04-22T19:31:13Z\",\n    \"temp\": 44,\n    \"humidity\": 51,\n    \"objectTemp\": 32\n  }\n]\n\n\u30bb\u30f3\u30b5\u30fc\u30c7\u30fc\u30bf\u306b\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3092\u4ed8\u3051\u3066Cloudant\u306b\u4fdd\u7ba1\u3059\u308b\u6d41\u308c\u3092\u3001[Node-RED\u3092\u4f7f\u3063\u3066\u30bb\u30f3\u30b5\u30fc\u30c7\u30fc\u30bf\u3092Cloudant\u306b\u683c\u7d0d\u3059\u308b](http://qiita.com/asmanabu/items/809e1276f95e76b989a3)\u306b\u66f8\u304d\u307e\u3057\u305f\u3002\n\u4eca\u56de\u306f\u3001Cloudant\u306b\u4fdd\u7ba1\u3057\u305f\u30c7\u30fc\u30bf\u3092\u5229\u7528\u3059\u308b\u65b9\u6cd5\u306b\u3064\u3044\u3066\u66f8\u304d\u307e\u3059\u3002\n\nNode-RED\u3092\u4f7f\u3063\u3066HTTP GET\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u4ed8\u3051\u308b\u30d5\u30ed\u30fc\u3092\u4f5c\u6210\u3057\u3001\u3053\u306e\u4e2d\u3067Cloudant\u304b\u3089\u30bb\u30f3\u30b5\u30fc\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n## \u524d\u63d0\n[Node-RED\u3092\u4f7f\u3063\u3066\u30bb\u30f3\u30b5\u30fc\u30c7\u30fc\u30bf\u3092Cloudant\u306b\u683c\u7d0d\u3059\u308b](http://qiita.com/asmanabu/items/809e1276f95e76b989a3)\u306e\u30d5\u30ed\u30fc\u3092Bluemix\u4e0a\u306eNode-RED\u306b\u30c7\u30d7\u30ed\u30a4\u6e08\u307f\u3067\u3042\u308b\u3053\u3068\u3068\u3057\u307e\u3059\u3002\n\n## \u4f5c\u696d\u306e\u6d41\u308c\n1. Cloudant\u306bSearchIndex\u3092\u4f5c\u6210\u3059\u308b\n2. Node-RED\u3092\u4f7f\u3063\u3066\u3001HTTP GET\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u4ed8\u3051\u308b\u30d5\u30ed\u30fc\u3092\u4f5c\u6210\u3059\u308b\n3. \u52d5\u4f5c\u78ba\u8a8d\n\n## 1. Cloudant\u306bSearchIndex\u3092\u4f5c\u6210\u3059\u308b\nCloudant\u306b\u306f\u3001\u4ee5\u4e0b\u306e\u5f62\u5f0f\u3067\u30c7\u30fc\u30bf\u304c\u4fdd\u7ba1\u3055\u308c\u3066\u3044\u307e\u3059\u3002Cloudant\u4fdd\u7ba1\u6642\u306b\u4efb\u610f\u306b\u4ed8\u3051\u3089\u308c\u308b*_id*\u304c\u30ad\u30fc\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u4eca\u56de\u306f\u3001\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3067\u691c\u7d22\u304c\u3067\u304d\u308b\u3088\u3046\u306b*timestamp*\u3092\u30ad\u30fc\u3068\u3059\u308bCloudant\u306e[Search Index](https://cloudant.com/for-developers/search/)\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002Search Index\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u3067\u3001Lucene\u306e\u66f8\u5f0f\u3067\u691c\u7d22\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```\n{\n  \"_id\": \"07f647f960d8f2cba14221f96646df60\",\n  \"_rev\": \"1-26ae484039d6ad18c39f1ce0117c6634\",\n  \"timestamp\": \"2015-04-23 07:52:21\",\n  \"temp\": 15,\n  \"humidity\": 76,\n  \"objectTemp\": 24\n}\n```\n\nCloudant\u306e\u7ba1\u7406\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9*sensordata*\u3092\u9078\u629e\u3057\u305f\u72b6\u614b\u3067\u3001**All Design Docs**\u306e\u53f3\u306b\u3042\u308b\uff0b\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\u7d9a\u3044\u3066**New Search Index**\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n![nodered-cloudant12.jpg](https://qiita-image-store.s3.amazonaws.com/0/73397/f55eee09-20fd-df76-4bba-bb54807cbe3b.jpeg)\n\n\n**Save to Design Document**\u306e**_design/**\u306e\u5f8c\u308d\u306b*Index*\u3001**Index name**\u306b*IndexByTimestamp*\u3092\u5165\u529b\u3057\u307e\u3059\u3002**Search index function**\u306b\u306f\u3001\u4ee5\u4e0b\u3092\u5165\u529b\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001Cloudant\u306b\u683c\u7d0d\u3057\u305f\u30c7\u30fc\u30bf\u306e\u4e2d\u306e*timestamp*\u8981\u7d20\u3092\u30ad\u30fc\u3068\u3057\u305f\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n\n```\nfunction(doc){\n index(\"timestamp\", doc.timestamp, { \"store\": true });\n}\n```\n\n**Type**\u3068\u3057\u3066*Keyword*\u3092\u9078\u629e\u3057\u3001\u6700\u5f8c\u306b**Save & Build Index**\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\u3053\u308c\u3067Search Index\u304c\u5b8c\u6210\u3057\u307e\u3057\u305f\u3002\n\n\u5165\u529b\u4f8b\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3067\u3059\u3002\n![nodered-cloudant13.jpg](https://qiita-image-store.s3.amazonaws.com/0/73397/bc72960d-3f24-3911-b0a9-259db8763d98.jpeg)\n\n## 2. Node-RED\u3092\u4f7f\u3063\u3066\u3001HTTP GET\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u4ed8\u3051\u308b\u30d5\u30ed\u30fc\u3092\u4f5c\u6210\u3059\u308b\n\nNode-RED\u3067\u306f\u3001HTTP\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u4ed8\u3051\u308b\u30ce\u30fc\u30c9\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u3092\u5229\u7528\u3057\u3066\u3001\u30d6\u30e9\u30a6\u30b6\u3084\u30d7\u30ed\u30b0\u30e9\u30e0\u304b\u3089HTTP GET\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u4ed8\u3051\u308b\u30d5\u30ed\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nGET\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30af\u30a8\u30ea\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3068\u3057\u307e\u3059\u3002\n\n| \u30d1\u30e9\u30e1\u30fc\u30bf\u540d | \u7528\u9014 | \u66f8\u5f0f |\n| :--: | :-- | :-- |\n| start | \u30bb\u30f3\u30b5\u30fc\u30c7\u30fc\u30bf\u306e\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u306e\u691c\u7d22\u958b\u59cb\u65e5\u6642 | yyyy-mm-ddThh:mm:ssZ |\n| end| \u30bb\u30f3\u30b5\u30fc\u30c7\u30fc\u30bf\u306e\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u306e\u691c\u7d22\u7d42\u4e86\u65e5\u6642 | yyyy-mm-ddThh:mm:ssZ |\n\n\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u4f8b\u3067\u3059\u3002\n```\nhttp://sample.mybluemix.net/sensordata?start=2015-04-22T19:40:00Z&end=2015-04-22T19:40:00Z\n```\n\n\u305d\u308c\u3067\u306f\u30d5\u30ed\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002Node-RED\u306e\u30d5\u30ed\u30fc\u30a8\u30c7\u30a3\u30bf\u30fc\u3092\u4f7f\u3063\u3066\u3001\u4ee5\u4e0b\u306e\u30d5\u30ed\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n![nodered-cloudant14.jpg](https://qiita-image-store.s3.amazonaws.com/0/73397/d567684c-2728-2fda-4c0d-50f2f52a16a7.jpeg)\n\n\u4ee5\u4e0b\u306e5\u3064\u306e\u30ce\u30fc\u30c9\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\n| \u30ce\u30fc\u30c9 |  | \u7528\u9014 |\n|:--|:-:|:--|\n| http\u30ce\u30fc\u30c9 | ![nodered-http.jpg](https://qiita-image-store.s3.amazonaws.com/0/73397/25e565b7-5014-abcc-71f5-b91f8f59596b.jpeg) | HTTP\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u53d7\u4ed8 |\n| function\u30ce\u30fc\u30c9 | ![nodered-function.jpg](https://qiita-image-store.s3.amazonaws.com/0/73397/b1d5e723-95bc-af84-b0de-e18ed6f2c25b.jpeg) | \u30ea\u30af\u30a8\u30b9\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf\u304b\u3089Cloudant\u691c\u7d22\u7528\u6587\u5b57\u5217\u306e\u751f\u6210 |\n| Cloudant\u30ce\u30fc\u30c9 | ![nodered-cloudantnode.jpg](https://qiita-image-store.s3.amazonaws.com/0/73397/6fee00d4-53e5-94dc-bbd7-1160a85f91c3.jpeg) | Cloudant\u304b\u3089\u306e\u30c7\u30fc\u30bf\u53d6\u5f97 |\n| http response\u30ce\u30fc\u30c9 | ![nodered-httpresponse.jpg](https://qiita-image-store.s3.amazonaws.com/0/73397/d6ea8368-3265-73b3-6c46-154778b19759.jpeg) | \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3078\u30ec\u30b9\u30dd\u30f3\u30b9\u9001\u4fe1 |\n| Debug\u30ce\u30fc\u30c9 | ![nodered-debug.jpg](https://qiita-image-store.s3.amazonaws.com/0/73397/449ea1c7-f145-1318-2901-afb4a7afc6d1.jpeg) | \u51fa\u529b\u7d50\u679c\u78ba\u8a8d |\n\n### http\u30ce\u30fc\u30c9\u306e\u69cb\u6210\n\nhttp\u30ce\u30fc\u30c9\u306f\u3001\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u69cb\u6210\u3057\u3066\u3044\u307e\u3059\u3002HTTP\u306eGET\u30e1\u30bd\u30c3\u30c9\u3092\u5229\u7528\u3057\u3001URL\u306e\u30d1\u30b9\u3092*/sensordata*\u3068\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u3053\u3067\u8a2d\u5b9a\u3057\u305f\u30d1\u30b9\u3092\u542b\u3080URL\u306f\u3001Node-RED\u30d5\u30ed\u30fc\u30a8\u30c7\u30a3\u30bf\u30fc\u306eFQDN\u306b\u30d1\u30b9\u3092\u52a0\u3048\u305f\u3082\u306e\u3068\u306a\u308a\u307e\u3059\u3002\n\u305f\u3068\u3048\u3070\u3001\u30d5\u30ed\u30fc\u30a8\u30c7\u30a3\u30bf\u30fc\u306eURL\u304c*http://sample.mybluemix.net/red/*\u306e\u5834\u5408\u3001\u3053\u3053\u3067\u8a2d\u5b9a\u3059\u308bGET\u30ea\u30af\u30a8\u30b9\u30c8\u306eURL\u306f\u3001*http://sample.mybluemix.net/sensordata*\u3068\u306a\u308a\u307e\u3059\u3002\n\n![nodered-cloudant15.jpg](https://qiita-image-store.s3.amazonaws.com/0/73397/b89e345d-0a83-261e-0a6a-b2169c2e1c26.jpeg)\n\n### function\u30ce\u30fc\u30c9\u306e\u69cb\u6210\nCloundant\u306e\u691c\u7d22\u306b\u4f7f\u7528\u3059\u308b\u6587\u5b57\u5217\u3092\u751f\u6210\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306eJSON\u5f62\u5f0f\u306e\u30c7\u30fc\u30bf\u3092Cloudant\u306e\u691c\u7d22\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n```\n{\n  \"query\": \"[ start_date TO end_date ]\",\n  \"limit\": 200\n}\n```\n\nquery\u306e\u90e8\u5206\u306bLucene\u306e\u8a18\u6cd5\u306e\u691c\u7d22\u6587\u5b57\u5217\u3092\u5165\u529b\u3057\u307e\u3059\u3002\u4eca\u56de\u306f\u3001*start_date*\u3068*end_date*\u306e\u90e8\u5206\u304c\u3001HTTP GET\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30af\u30a8\u30ea\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3067\u53d7\u3051\u53d6\u308b\u5024\u3092\u4f7f\u7528\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\nSearch Index\u306e\u30af\u30a8\u30ea\u30fc\u7d50\u679c\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306725\u4ef6\u307e\u3067\u3057\u304b\u8fd4\u3055\u306a\u3044\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u5236\u9650\u3092\u5909\u66f4\u3059\u308b\u305f\u3081\u306b\u3001*limit*\u3092*200*\u3068\u3057\u3066\u3044\u307e\u3059\u3002\u6b8b\u5ff5\u306a\u304c\u3089\u3001\u5236\u7d04\u3068\u3057\u3066\u3001200\u3092\u8d85\u3048\u308b\u7d50\u679c\u3092\u8fd4\u3059\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\n\nfunction\u30ce\u30fc\u30c9\u306b\u767b\u9332\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u3001\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3067\u3059\u3002\n\n```\nmsg.payload = {\n    \"query\": \"timestamp:[\" + msg.payload.start + \" TO \" + msg.payload.end + \"]\",\n    \"limit\": 200\n}\n\nreturn msg;\n```\n\n### Cloudant\u30ce\u30fc\u30c9\u306e\u69cb\u6210\nCloudant\u30ce\u30fc\u30c9\u306e\u8a2d\u5b9a\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3067\u3059\u3002\n\n| \u8a2d\u5b9a\u9805\u76ee | \u5185\u5bb9 |\n| :-- | :-- |\n| Service | Bluemix\u4e0a\u306b\u4f5c\u6210\u3055\u308c\u305fCloudant\u306e\u30b5\u30fc\u30d3\u30b9\u540d\u3092\u9078\u629e\u3057\u307e\u3059 |\n| Database | Cloudant\u306b\u4f5c\u6210\u3057\u305f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d\u3067\u3042\u308b*sensordata*\u3092\u5165\u529b\u3057\u307e\u3059 |\n| Search by | *search index*\u3092\u9078\u629e\u3057\u307e\u3059\u3002\u5bfe\u8c61\u306eIndex\u3068\u3057\u3066\u3001Search Index\u306e\u4f5c\u6210\u3067\u4f5c\u6210\u3057\u3066Index\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002 |\n| Name | \u30ce\u30fc\u30c9\u306b\u4ed8\u3051\u308b\u540d\u524d\u3067\u3059\u3002\u4efb\u610f\u306e\u5024\u3067\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002 |\n\n\u5165\u529b\u4f8b\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3067\u3059\u3002\n![nodered-cloudant16.jpg](https://qiita-image-store.s3.amazonaws.com/0/73397/9e2f7e51-aab4-f139-ba91-ea926dd968cd.jpeg)\n\n\n### http response\u30ce\u30fc\u30c9\u306e\u69cb\u6210\nhttp response\u30ce\u30fc\u30c9\u306f\u3001\u30ce\u30fc\u30c9\u306e\u540d\u524d\u4ee5\u5916\u306b\u8a2d\u5b9a\u9805\u76ee\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u4efb\u610f\u306e\u540d\u524d\u3092\u3064\u3051\u3066\u304f\u3060\u3055\u3044\u3002\n\n### \uff08\u53c2\u8003\uff09\u30b5\u30f3\u30d7\u30eb\u30d5\u30ed\u30fc\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\n\u4ee5\u4e0b\u306eJSON\u3092\u3001[Node-RED\u5c0f\u30ef\u30b6\u96c6](http://qiita.com/asmanabu/items/d9ba9ff0fca745c8c216)\u306e[\u5c0f\u30ef\u30b61. \u30d5\u30ed\u30fc\u306e\u30a4\u30f3\u30dd\u30fc\u30c8](http://qiita.com/asmanabu/items/d9ba9ff0fca745c8c216#%E5%B0%8F%E3%83%AF%E3%82%B61-%E3%83%95%E3%83%AD%E3%83%BC%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%88)\u306e\u65b9\u6cd5\u3092\u4f7f\u3063\u3066\u30a4\u30f3\u30dd\u30fc\u30c8\u3059\u308b\u3053\u3068\u3067\u3001\u30b5\u30f3\u30d7\u30eb\u30d5\u30ed\u30fc\u3092\u5fa9\u5143\u3067\u304d\u307e\u3059\u3002\n\n```\n[{\"id\":\"8adf6400.6d175\",\"type\":\"http in\",\"name\":\"Get Sensor Data\",\"url\":\"/sensordata\",\"method\":\"get\",\"x\":125,\"y\":359,\"z\":\"56be2dc6.6f2e4c\",\"wires\":[[\"bce3b962.ddd648\"]]},{\"id\":\"5a004193.4e4b7\",\"type\":\"cloudant in\",\"service\":\"IoTFSample-cloudantNoSQLDB\",\"cloudant\":\"\",\"name\":\"Get Sensor Data from Cloudant\",\"database\":\"sensordata\",\"search\":\"_idx_\",\"design\":\"Index\",\"index\":\"IndexByTimestamp\",\"x\":367,\"y\":439,\"z\":\"56be2dc6.6f2e4c\",\"wires\":[[\"43775b51.c3a424\",\"7b27b5c9.f5f754\"]]},{\"id\":\"43775b51.c3a424\",\"type\":\"http response\",\"name\":\"Response to Client\",\"x\":636,\"y\":439,\"z\":\"56be2dc6.6f2e4c\",\"wires\":[]},{\"id\":\"7b27b5c9.f5f754\",\"type\":\"debug\",\"name\":\"Check Output\",\"active\":false,\"console\":\"false\",\"complete\":\"payload\",\"x\":560,\"y\":361,\"z\":\"56be2dc6.6f2e4c\",\"wires\":[]},{\"id\":\"bce3b962.ddd648\",\"type\":\"function\",\"name\":\"Create Query\",\"func\":\"msg.payload = {\\n    \\\"query\\\": \\\"timestamp:[\\\" + msg.payload.start + \\\" TO \\\" + msg.payload.end + \\\"]\\\",\\n    \\\"limit\\\": 200\\n}\\n\\nreturn msg;\",\"outputs\":1,\"valid\":true,\"x\":318,\"y\":359,\"z\":\"56be2dc6.6f2e4c\",\"wires\":[[\"5a004193.4e4b7\"]]}]\n```\n\n### \u30d5\u30ed\u30fc\u306e\u30c7\u30d7\u30ed\u30a4\n\u4ee5\u4e0a\u3067\u30d5\u30ed\u30fc\u306e\u4f5c\u6210\u306f\u5b8c\u4e86\u3067\u3059\u3002\u30d5\u30ed\u30fc\u30a8\u30c7\u30a3\u30bf\u30fc\u53f3\u4e0a\u306e ![nodered-cloudant08.jpg](https://qiita-image-store.s3.amazonaws.com/0/73397/68fa9359-0d5f-0b48-e39c-9f49a1c7da50.jpeg) \u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3001\u30d5\u30ed\u30fc\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u307e\u3059\u3002\n\n## 3. \u52d5\u4f5c\u78ba\u8a8d\n\u30d6\u30e9\u30a6\u30b6\u3092\u5229\u7528\u3057\u3066\u3001\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u30af\u30a8\u30ea\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3068\u3057\u3066\u691c\u7d22\u958b\u59cb\u65e5\u6642\u306e*start*\u3068\u691c\u7d22\u7d42\u4e86\u65e5\u6642\u306e*end*\u3092\u6307\u5b9a\u3057\u3066\u3001http\u30ce\u30fc\u30c9\u3092\u69cb\u6210\u3057\u305f\u969b\u306b\u5165\u529b\u3057\u305fURL\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n\u30a2\u30af\u30bb\u30b9\u3059\u308bURL\u306e\u4f8b\u3067\u3059\u3002\n\n```\nhttp://sample.mybluemix.net/sensordata?start=2015-04-22T19:30:00Z&end=2015-04-22T19:36:00Z\n```\n\n\u4ee5\u4e0b\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\n```\n[\n  {\n    \"_id\": \"40384c3ef6fb489997adc0530819e2d3\",\n    \"_rev\": \"1-6033dce739fee18f34063d7345fe61ed\",\n    \"timestamp\": \"2015-04-22T19:30:15Z\",\n    \"temp\": 44,\n    \"humidity\": 51,\n    \"objectTemp\": 32\n  },\n  {\n    \"_id\": \"38ab698d4e8f3c6e5e4f011db2cb5082\",\n    \"_rev\": \"1-c3118a250f8f40f56c23b27472403f1f\",\n    \"timestamp\": \"2015-04-22T19:30:41Z\",\n    \"temp\": 44,\n    \"humidity\": 51,\n    \"objectTemp\": 32\n  },\n  {\n    \"_id\": \"9f84503729658d77f5d28fd3c4a782a2\",\n    \"_rev\": \"1-c6a3a5e68e8aebff97e5f289925e2460\",\n    \"timestamp\": \"2015-04-22T19:30:47Z\",\n    \"temp\": 44,\n    \"humidity\": 51,\n    \"objectTemp\": 32\n  },\n  {\n    \"_id\": \"0f3c227bbc36bbec8e31b2eb877bdcd1\",\n    \"_rev\": \"1-4826ef6ded531287516107891033eee7\",\n    \"timestamp\": \"2015-04-22T19:31:13Z\",\n    \"temp\": 44,\n    \"humidity\": 51,\n    \"objectTemp\": 32\n  }\n]\n```\n", "tags": ["Bluemix", "Cloudant", "node-red", "IoT"]}