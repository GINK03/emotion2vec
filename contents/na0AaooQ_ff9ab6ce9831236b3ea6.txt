{"context": "\n\n\u306f\u3058\u3081\u306b\nNode.js 4.3\u3067AWS Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\u3001MySQL(Amazon RDS for MySQL)\u3078\u63a5\u7d9a\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u3067\u3059\u3002\nLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u5185\u306eMySQL\u63a5\u7d9a\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u5e73\u6587\u3067\u306f\u306a\u304f\u3001AWS Key Management Service(KMS)\u306b\u3088\u308a\u6697\u53f7\u5316\u3057\u305fMysQL\u63a5\u7d9a\u30d1\u30b9\u30ef\u30fc\u30c9\u6587\u5b57\u5217\u3092\u8a18\u8f09\u3057\u3001Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u5b9f\u884c\u6642\u306bkms.decrypt\u3067\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5fa9\u53f7\u5316\u3057\u3066MySQL\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u63a5\u7d9a\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306e\u5b9f\u884c\u3092AWS SNS\u3067\u30e1\u30fc\u30eb\u901a\u77e5\u3057\u307e\u3059\u3002\n\n\u53c2\u8003\u8cc7\u6599\n\u4ee5\u4e0b\u306e\u30da\u30fc\u30b8\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f\u3002\nhttp://qiita.com/Keisuke69/items/cba4b501e91da95188f8\nhttp://qiita.com/na0AaooQ/items/cfd9f2babd2ce604049b\n\n\u4f5c\u696d\u7528\u30de\u30b7\u30f3\nLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306e\u30c7\u30d7\u30ed\u30a4\u30d1\u30c3\u30b1\u30fc\u30b8\u4f5c\u6210\u306fAmazon Linux\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u884c\u3044\u307e\u3057\u305f\u3002\nLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306e\u30c7\u30d7\u30ed\u30a4\u30d1\u30c3\u30b1\u30fc\u30b8\u4f5c\u696d\u7528\u30de\u30b7\u30f3\u306f\u4ee5\u4e0b\u306eAMI\u3067\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\u30fbAmazon Linux AMI 2016.03.0 (HVM), SSD Volume Type - ami-f80e0596\n\n\u30c6\u30b9\u30c8\u7528\u306eAmazon RDS for MySQL\n\u307e\u305a\u3001Amazon RDS for MySQL\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3057\u3001\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n[ec2-user@example-server ~]$ hostname\nexample-server\n[ec2-user@example-server ~]$ mysql -u root -p -h example-rds-mysql-server.carvmoii2uds.ap-northeast-1.rds.amazonaws.com\nWelcome to the MySQL monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 12\nServer version: 5.6.27-log MySQL Community Server (GPL)\n\nCopyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql> GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP ON exampledb.* TO example_user@'192.168.0.0/255.255.0.0' IDENTIFIED BY 'exam\nple_password';\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> DELETE FROM exampledb.example_table;\nQuery OK, 6 rows affected (0.00 sec)\n\nmysql> SELECT * FROM exampledb.example_table;\nEmpty set (0.00 sec)\n\nmysql> INSERT INTO exampledb.example_table( id, insert_date) VALUES( 1, '2016-03-10 12:30:00' );\nQuery OK, 1 row affected (0.01 sec)\n\nmysql> INSERT INTO exampledb.example_table( id, insert_date) VALUES( 2, '2016-03-20 12:30:00' );\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> INSERT INTO exampledb.example_table( id, insert_date) VALUES( 3, '2016-03-30 13:40:00' );\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> INSERT INTO exampledb.example_table( id, insert_date) VALUES( 4, '2016-04-05 14:10:00' );\nQuery OK, 1 row affected (0.01 sec)\n\nmysql> INSERT INTO exampledb.example_table( id, insert_date) VALUES( 5, '2016-04-10 22:00:00' );\nQuery OK, 1 row affected (0.01 sec)\n\nmysql> SELECT * FROM exampledb.example_table;\n+------+---------------------+\n| id   | insert_date         |\n+------+---------------------+\n|    1 | 2016-03-10 12:30:00 |\n|    2 | 2016-03-20 12:30:00 |\n|    3 | 2016-03-30 13:40:00 |\n|    4 | 2016-04-05 14:10:00 |\n|    5 | 2016-04-10 22:00:00 |\n+------+---------------------+\n5 rows in set (0.00 sec)\n\nmysql> SELECT * FROM exampledb.example_table WHERE insert_date <= date_sub(curdate(), interval 2 week);\n+------+---------------------+\n| id   | insert_date         |\n+------+---------------------+\n|    1 | 2016-03-10 12:30:00 |\n|    2 | 2016-03-20 12:30:00 |\n+------+---------------------+\n2 rows in set (0.00 sec)\n\nmysql>\n\n\nLambda\u7528\u306eIAM\u30ed\u30fc\u30eb\u8a2d\u5b9a\nIAM\u30ed\u30fc\u30eb[lambda_basic_vpc_execution]\u306b\u4ee5\u4e0b\u306eIAM\u30dd\u30ea\u30b7\u30fc\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\u30fbKMS\u306b\u3088\u308b\u6697\u53f7\u5316\u3057\u305f\u30d1\u30b9\u30ef\u30fc\u30c9\u5fa9\u53f7\u5316\u7528\u306eIAM\u30dd\u30ea\u30b7\u30fc\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"Stmt1448696327000\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"kms:*\"\n            ],\n            \"Resource\": [\n                \"arn:aws:kms:ap-northeast-1:**************:key/KMS\u306e\u6697\u53f7\u5316\u30ad\u30fc\u306eARN\u3092\u6307\u5b9a\u3059\u308b\"\n            ]\n        }\n    ]\n}\n\n\u30fbSNS\u901a\u77e5\u7528\u306eIAM\u30dd\u30ea\u30b7\u30fc\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"Stmt1460306102000\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"sns:Publish\"\n            ],\n            \"Resource\": [\n                \"arn:aws:sns:ap-northeast-1:***********:example-lambda-mysql-sns\"\n            ]\n        }\n    ]\n}\n\n\u30fbLambda VPC\u7528\u306e\u30dd\u30ea\u30b7\u30fc\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"logs:CreateLogGroup\",\n        \"logs:CreateLogStream\",\n        \"logs:PutLogEvents\"\n      ],\n      \"Resource\": \"arn:aws:logs:*:*:*\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ec2:CreateNetworkInterface\",\n        \"ec2:DescribeNetworkInterfaces\",\n        \"ec2:DetachNetworkInterface\",\n        \"ec2:DeleteNetworkInterface\"\n      ],\n      \"Resource\": \"*\"\n    }\n  ]\n}\n\n\n\u4f5c\u696d\u7528\u30de\u30b7\u30f3\u306bNode.js\u3068npm\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4f5c\u696d\u7528\u30de\u30b7\u30f3(Amazon Linux)\u306bNode.js\u3068npm\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n[ec2-user@example-server ~]$ hostname\nexample-server\n[ec2-user@example-server ~]$ sudo yum -y update\n\n\n[ec2-user@example-server ~]$ uname -a\nLinux example-server 4.4.5-15.26.amzn1.x86_64 #1 SMP Wed Mar 16 17:15:34 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\n[ec2-user@example-server ~]$\n\n[ec2-user@example-server ~]$ sudo yum install nodejs npm --enablerepo=epel\n\n[ec2-user@example-server ~]$ node -v\nv0.10.42\n[ec2-user@example-server ~]$ npm -v\n1.3.6\n[ec2-user@example-server ~]$\n\n\nAWS Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306e\u30c7\u30d7\u30ed\u30a4\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f5c\u6210\u3059\u308b\n[ec2-user@example-server ~]$ mkdir /home/ec2-user/example-lambda-mysql-select\n[ec2-user@example-server ~]$\n[ec2-user@example-server ~]$ cd /home/ec2-user/example-lambda-mysql-select\n[ec2-user@example-server example-lambda-mysql-select]$ pwd\n/home/ec2-user/example-lambda-mysql-select\n[ec2-user@example-server example-lambda-mysql-select]$ npm install mysql\n\nLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306e\u30b3\u30fc\u30c9\u3092[example.js]\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u4fdd\u5b58\u3057\u307e\u3059\u3002\n[example.js]\u30d5\u30a1\u30a4\u30eb\u306b\u306f\u5f8c\u8ff0\u306e[Node.js\u306eAWS Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9(example.js)]\u306e\u5185\u5bb9\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n[ec2-user@example-server example-lambda-mysql-select]$ vi /home/ec2-user/example-lambda-mysql-select/example.js\n\nLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306e\u30c7\u30d7\u30ed\u30a4\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002zip\u3067example-lambda-mysql-select\u914d\u4e0b\u3092\u56fa\u3081\u307e\u3059\u3002\n[ec2-user@example-server example-lambda-mysql-select]$ pwd\n/home/ec2-user/example-lambda-mysql-select\n[ec2-user@example-server example-lambda-mysql-select]$ zip -r example-lambda-mysql-select.zip .\n\n[ec2-user@example-server example-lambda-mysql-select]$ ls -lrta /home/ec2-user/example-lambda-mysql-select/\ntotal 272\ndrwxrwxr-x  3 ec2-user ec2-user   4096 Apr 11 00:55 node_modules\n-rw-rw-r--  1 ec2-user ec2-user   2649 Apr 11 00:55 example.js\ndrwx------ 21 ec2-user ec2-user   4096 Apr 11 00:55 ..\n-rw-rw-r--  1 ec2-user ec2-user 258434 Apr 11 00:56 example-lambda-mysql-select.zip\ndrwxrwxr-x  3 ec2-user ec2-user   4096 Apr 11 00:56 .\n[ec2-user@example-server example-lambda-mysql-select]$\n\nzip\u30d5\u30a1\u30a4\u30eb\u5316\u3057\u305f\u30c7\u30d7\u30ed\u30a4\u30d1\u30c3\u30b1\u30fc\u30b8\u3092S3\u3078\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\u3053\u306ezip\u30d5\u30a1\u30a4\u30eb\u306f\u5f8c\u3067Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u4f5c\u6210\u6642\u306b\u5229\u7528\u3057\u307e\u3059\u3002\n[ec2-user@example-server example-lambda-mysql-select]$ aws s3 cp /home/ec2-user/example-lambda-mysql-select/example-lambda-mysql-select.zip s3://\u9069\u5f53\u306aS3\u30d0\u30b1\u30c3\u30c8/\nupload: ./example-lambda-mysql-select.zip to s3://\u9069\u5f53\u306aS3\u30d0\u30b1\u30c3\u30c8/example-lambda-mysql-select.zip\n[ec2-user@example-server example-lambda-mysql-select]$\n\n\nNode.js\u306eAWS Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9(example.js)\n\u4ee5\u4e0b\u304cLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306e\u30b3\u30fc\u30c9\u3067\u3059\u3002\n\nexample.js\nvar AWS = require('aws-sdk');\nvar mysql = require('mysql');\n\n// KMS\u306b\u3088\u308a\u6697\u53f7\u5316\u3057\u305fMySQL\u63a5\u7d9a\u7528\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u6587\u5b57\u5217\nvar kmsEncyptedToken = \"CiC*********(KMS\u3067\u6697\u53f7\u5316\u3057\u305fMySQL\u63a5\u7d9a\u7528\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u6587\u5b57\u5217)***********UI=\";\n\n// \u63a5\u7d9a\u5148\u306eMySQL\u30b5\u30fc\u30d0\u60c5\u5831\nvar mysql_host = \"example-rds-mysql-server.carvmoii2uds.ap-northeast-1.rds.amazonaws.com\";\nvar mysql_user = \"example_user\";\nvar mysql_dbname = \"exampledb\";\nvar mysql_password = \"\";\n\nvar sns_topic_arn = \"arn:aws:sns:ap-northeast-1:*******************:example-lambda-mysql-sns\";\n\nexports.handler = function(event, context){\n\n    // \u5b9f\u884c\u3059\u308bSQL\u6587\n    var sql = \"SELECT * FROM exampledb.example_table WHERE insert_date <= date_sub(curdate(), interval 2 week)\";\n\n    if (kmsEncyptedToken && kmsEncyptedToken !== \"<kmsEncryptedToken>\") {\n\n        var encryptedBuf = new Buffer(kmsEncyptedToken, 'base64');\n        var cipherText = {CiphertextBlob: encryptedBuf};\n\n        var kms = new AWS.KMS({ region: 'ap-northeast-1' });\n        var sns = new AWS.SNS({ region: 'ap-northeast-1' });\n\n        // KMS\u306b\u3088\u308a\u6697\u53f7\u5316\u3057\u305f\u30d1\u30b9\u30ef\u30fc\u30c9\u6587\u5b57\u5217\u306e\u5fa9\u53f7\u5316\n        kms.decrypt(cipherText, function (err, data) {\n            if (err) {\n\n                console.log(\"CipherText Decrypt error: \" + err);\n                context.fail(err);\n\n            } else {\n\n                mysql_password = data.Plaintext.toString('ascii');\n\n                var connection = mysql.createConnection({\n                    host     : mysql_host,\n                    user     : mysql_user,\n                    password : mysql_password,\n                    database : mysql_dbname\n                });\n\n                console.log(\"MySQL Server Name: \" + mysql_host);\n                console.log(\"MySQL User Name: \" + mysql_user);\n                console.log(\"MySQL Database Name: \" + mysql_dbname);\n                console.log(\"MySQL Exec SQL: \" + sql);\n\n                // MySQL\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u306e\u63a5\u7d9a\n                connection.connect();\n\n                // MySQL\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3067SQL\u5b9f\u884c\n                connection.query(sql, function(err, rows, fields) {\n                    if (err) {\n\n                        console.log(\"MySQL Select Error\");\n                        context.fail(err);\n                        sns.publish({\n                            Message: 'Lambda Function Error',\n                            Subject: 'Lambda Function Error',\n                            TopicArn: sns_topic_arn\n                        }, function(err, data){\n                            if(err) throw err;\n                            else context.fail('SNS Publish Error');\n                        });\n\n                        throw err;\n\n                    } else {\n\n                    console.log(\"MySQL Select Success\");\n                    console.log(rows);\n                    console.log(fields);\n                    }\n                });\n\n                connection.end(function(err) {\n\n                    sns.publish({\n                        Message: 'Lambda Function Success',\n                        Subject: 'Lambda Function Success',\n                        TopicArn: sns_topic_arn\n                    }, function(err, data){\n                        if(err) throw err;\n                        else context.fail('SNS Publish Error');\n                    });\n\n                    context.done();\n                });\n            }\n        });\n\n    } else {\n\n        context.fail(\"kmsEncyptedToken has not been set.\");\n\n    }\n\n    console.log('end');\n\n};\n\n\n\nLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u4f5c\u6210\n\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fLambda\u306e\u30c7\u30d7\u30ed\u30a4\u30d1\u30c3\u30b1\u30fc\u30b8[example-lambda-mysql-select.zip]\u3092Lambda\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u3001Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u524d\u8ff0\u306e\u624b\u9806\u3067S3\u306b\u30d1\u30c3\u30b1\u30fc\u30b8\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u306e\u3067\u3001\u305d\u308c\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\u3000s3://\u9069\u5f53\u306aS3\u30d0\u30b1\u30c3\u30c8/example-lambda-mysql-select.zip\nLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306eIAM\u30dd\u30ea\u30b7\u30fc\u306f[lambda_basic_vpc_execution]\u3092\u9078\u629e\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306f\u3001Amazon RDS for MySQL\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078MySQL\u63a5\u7d9a\u53ef\u80fd\u306a\u8a2d\u5b9a\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u9078\u629e\u3057\u3066\u3001Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u5b9f\u884c\nLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\u3057\u3001\u6b63\u5e38\u306bMySQL\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u63a5\u7d9a\u51fa\u6765\u308c\u3070\u3001Lambda\u306e[Log outPut]\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306bMySQL\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306eSELECT\u7d50\u679c\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\u307e\u305f\u3001ANS SNS\u3067\u6307\u5b9a\u3057\u305f\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u5b9b\u306b[Lambda Fanction Success]\u30e1\u30fc\u30eb\u304c\u5c4a\u304d\u307e\u3059\u3002\nSTART RequestId: 442b53cf-ff43-11e5-9dc8-2123a6cf68bb Version: $LATEST\n2016-04-10T17:40:08.926Z    442b53cf-ff43-11e5-9dc8-2123a6cf68bb    end\n2016-04-10T17:40:10.127Z    442b53cf-ff43-11e5-9dc8-2123a6cf68bb    MySQL Server Name: example-rds-mysql-server.carvmoii2uds.ap-northeast-1.rds.amazonaws.com\n2016-04-10T17:40:10.183Z    442b53cf-ff43-11e5-9dc8-2123a6cf68bb    MySQL User Name: example_user\n2016-04-10T17:40:10.183Z    442b53cf-ff43-11e5-9dc8-2123a6cf68bb    MySQL Database Name: exampledb\n2016-04-10T17:40:10.183Z    442b53cf-ff43-11e5-9dc8-2123a6cf68bb    MySQL Exec SQL: SELECT * FROM exampledb.example_table WHERE insert_date <= date_sub(curdate(), interval 2 week)\n2016-04-10T17:40:10.346Z    442b53cf-ff43-11e5-9dc8-2123a6cf68bb    MySQL Select Success\n2016-04-10T17:40:10.346Z    442b53cf-ff43-11e5-9dc8-2123a6cf68bb    [ RowDataPacket { id: 1, insert_date: Thu Mar 10 2016 12:30:00 GMT+0000 (UTC) },\n  RowDataPacket { id: 2, insert_date: Sun Mar 20 2016 12:30:00 GMT+0000 (UTC) } ]\n2016-04-10T17:40:10.567Z    442b53cf-ff43-11e5-9dc8-2123a6cf68bb    [ FieldPacket {\n    catalog: 'def',\n    db: 'exampledb',\n    table: 'example_table',\n    orgTable: 'example_table',\n    name: 'id',\n    orgName: 'id',\n    charsetNr: 63,\n    length: 12,\n    type: 3,\n    flags: 0,\n    decimals: 0,\n    default: undefined,\n    zeroFill: false,\n    protocol41: true },\n  FieldPacket {\n    catalog: 'def',\n    db: 'exampledb',\n    table: 'example_table',\n    orgTable: 'example_table',\n    name: 'insert_date',\n    orgName: 'insert_date',\n    charsetNr: 63,\n    length: 19,\n    type: 12,\n    flags: 128,\n    decimals: 0,\n    default: undefined,\n    zeroFill: false,\n    protocol41: true } ]\nEND RequestId: 442b53cf-ff43-11e5-9dc8-2123a6cf68bb\nREPORT RequestId: 442b53cf-ff43-11e5-9dc8-2123a6cf68bb  Duration: 2670.49 ms    Billed Duration: 2700 ms    Memory Size: 128 MB Max Memory Used: 30 MB  \n\n\n\u4ee5\u4e0a\u306b\u306a\u308a\u307e\u3059\u3002\n\u306f\u3058\u3081\u306b\n---\n\nNode.js 4.3\u3067AWS Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\u3001MySQL(Amazon RDS for MySQL)\u3078\u63a5\u7d9a\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u3067\u3059\u3002\n\nLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u5185\u306eMySQL\u63a5\u7d9a\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u5e73\u6587\u3067\u306f\u306a\u304f\u3001AWS Key Management Service(KMS)\u306b\u3088\u308a\u6697\u53f7\u5316\u3057\u305fMysQL\u63a5\u7d9a\u30d1\u30b9\u30ef\u30fc\u30c9\u6587\u5b57\u5217\u3092\u8a18\u8f09\u3057\u3001Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u5b9f\u884c\u6642\u306bkms.decrypt\u3067\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5fa9\u53f7\u5316\u3057\u3066MySQL\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u63a5\u7d9a\u3057\u307e\u3059\u3002\n\n\u307e\u305f\u3001Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306e\u5b9f\u884c\u3092AWS SNS\u3067\u30e1\u30fc\u30eb\u901a\u77e5\u3057\u307e\u3059\u3002\n\n\n\u53c2\u8003\u8cc7\u6599\n---\n\n\u4ee5\u4e0b\u306e\u30da\u30fc\u30b8\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f\u3002\nhttp://qiita.com/Keisuke69/items/cba4b501e91da95188f8\n\nhttp://qiita.com/na0AaooQ/items/cfd9f2babd2ce604049b\n\n\u4f5c\u696d\u7528\u30de\u30b7\u30f3\n---\n\nLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306e\u30c7\u30d7\u30ed\u30a4\u30d1\u30c3\u30b1\u30fc\u30b8\u4f5c\u6210\u306fAmazon Linux\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u884c\u3044\u307e\u3057\u305f\u3002\nLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306e\u30c7\u30d7\u30ed\u30a4\u30d1\u30c3\u30b1\u30fc\u30b8\u4f5c\u696d\u7528\u30de\u30b7\u30f3\u306f\u4ee5\u4e0b\u306eAMI\u3067\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\n\u30fbAmazon Linux AMI 2016.03.0 (HVM), SSD Volume Type - ami-f80e0596\n\n\u30c6\u30b9\u30c8\u7528\u306eAmazon RDS for MySQL\n---\n\n\u307e\u305a\u3001Amazon RDS for MySQL\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3057\u3001\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```\n[ec2-user@example-server ~]$ hostname\nexample-server\n[ec2-user@example-server ~]$ mysql -u root -p -h example-rds-mysql-server.carvmoii2uds.ap-northeast-1.rds.amazonaws.com\nWelcome to the MySQL monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 12\nServer version: 5.6.27-log MySQL Community Server (GPL)\n\nCopyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql> GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP ON exampledb.* TO example_user@'192.168.0.0/255.255.0.0' IDENTIFIED BY 'exam\nple_password';\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> DELETE FROM exampledb.example_table;\nQuery OK, 6 rows affected (0.00 sec)\n\nmysql> SELECT * FROM exampledb.example_table;\nEmpty set (0.00 sec)\n\nmysql> INSERT INTO exampledb.example_table( id, insert_date) VALUES( 1, '2016-03-10 12:30:00' );\nQuery OK, 1 row affected (0.01 sec)\n\nmysql> INSERT INTO exampledb.example_table( id, insert_date) VALUES( 2, '2016-03-20 12:30:00' );\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> INSERT INTO exampledb.example_table( id, insert_date) VALUES( 3, '2016-03-30 13:40:00' );\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> INSERT INTO exampledb.example_table( id, insert_date) VALUES( 4, '2016-04-05 14:10:00' );\nQuery OK, 1 row affected (0.01 sec)\n\nmysql> INSERT INTO exampledb.example_table( id, insert_date) VALUES( 5, '2016-04-10 22:00:00' );\nQuery OK, 1 row affected (0.01 sec)\n\nmysql> SELECT * FROM exampledb.example_table;\n+------+---------------------+\n| id   | insert_date         |\n+------+---------------------+\n|    1 | 2016-03-10 12:30:00 |\n|    2 | 2016-03-20 12:30:00 |\n|    3 | 2016-03-30 13:40:00 |\n|    4 | 2016-04-05 14:10:00 |\n|    5 | 2016-04-10 22:00:00 |\n+------+---------------------+\n5 rows in set (0.00 sec)\n\nmysql> SELECT * FROM exampledb.example_table WHERE insert_date <= date_sub(curdate(), interval 2 week);\n+------+---------------------+\n| id   | insert_date         |\n+------+---------------------+\n|    1 | 2016-03-10 12:30:00 |\n|    2 | 2016-03-20 12:30:00 |\n+------+---------------------+\n2 rows in set (0.00 sec)\n\nmysql>\n```\n\nLambda\u7528\u306eIAM\u30ed\u30fc\u30eb\u8a2d\u5b9a\n---\n\nIAM\u30ed\u30fc\u30eb[lambda_basic_vpc_execution]\u306b\u4ee5\u4e0b\u306eIAM\u30dd\u30ea\u30b7\u30fc\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n\u30fbKMS\u306b\u3088\u308b\u6697\u53f7\u5316\u3057\u305f\u30d1\u30b9\u30ef\u30fc\u30c9\u5fa9\u53f7\u5316\u7528\u306eIAM\u30dd\u30ea\u30b7\u30fc\n\n```\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"Stmt1448696327000\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"kms:*\"\n            ],\n            \"Resource\": [\n                \"arn:aws:kms:ap-northeast-1:**************:key/KMS\u306e\u6697\u53f7\u5316\u30ad\u30fc\u306eARN\u3092\u6307\u5b9a\u3059\u308b\"\n            ]\n        }\n    ]\n}\n```\n\n\n\u30fbSNS\u901a\u77e5\u7528\u306eIAM\u30dd\u30ea\u30b7\u30fc\n\n```\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"Stmt1460306102000\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"sns:Publish\"\n            ],\n            \"Resource\": [\n                \"arn:aws:sns:ap-northeast-1:***********:example-lambda-mysql-sns\"\n            ]\n        }\n    ]\n}\n```\n\n\u30fbLambda VPC\u7528\u306e\u30dd\u30ea\u30b7\u30fc\n\n```\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"logs:CreateLogGroup\",\n        \"logs:CreateLogStream\",\n        \"logs:PutLogEvents\"\n      ],\n      \"Resource\": \"arn:aws:logs:*:*:*\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ec2:CreateNetworkInterface\",\n        \"ec2:DescribeNetworkInterfaces\",\n        \"ec2:DetachNetworkInterface\",\n        \"ec2:DeleteNetworkInterface\"\n      ],\n      \"Resource\": \"*\"\n    }\n  ]\n}\n```\n\n\u4f5c\u696d\u7528\u30de\u30b7\u30f3\u306bNode.js\u3068npm\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n---\n\n\u4f5c\u696d\u7528\u30de\u30b7\u30f3(Amazon Linux)\u306bNode.js\u3068npm\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n[ec2-user@example-server ~]$ hostname\nexample-server\n[ec2-user@example-server ~]$ sudo yum -y update\n\n\n[ec2-user@example-server ~]$ uname -a\nLinux example-server 4.4.5-15.26.amzn1.x86_64 #1 SMP Wed Mar 16 17:15:34 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\n[ec2-user@example-server ~]$\n\n[ec2-user@example-server ~]$ sudo yum install nodejs npm --enablerepo=epel\n\n[ec2-user@example-server ~]$ node -v\nv0.10.42\n[ec2-user@example-server ~]$ npm -v\n1.3.6\n[ec2-user@example-server ~]$\n```\n\nAWS Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306e\u30c7\u30d7\u30ed\u30a4\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f5c\u6210\u3059\u308b\n---\n\n```\n[ec2-user@example-server ~]$ mkdir /home/ec2-user/example-lambda-mysql-select\n[ec2-user@example-server ~]$\n[ec2-user@example-server ~]$ cd /home/ec2-user/example-lambda-mysql-select\n[ec2-user@example-server example-lambda-mysql-select]$ pwd\n/home/ec2-user/example-lambda-mysql-select\n[ec2-user@example-server example-lambda-mysql-select]$ npm install mysql\n```\n\nLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306e\u30b3\u30fc\u30c9\u3092[example.js]\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u4fdd\u5b58\u3057\u307e\u3059\u3002\n\n[example.js]\u30d5\u30a1\u30a4\u30eb\u306b\u306f\u5f8c\u8ff0\u306e[Node.js\u306eAWS Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9(example.js)]\u306e\u5185\u5bb9\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n```\n[ec2-user@example-server example-lambda-mysql-select]$ vi /home/ec2-user/example-lambda-mysql-select/example.js\n```\n\nLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306e\u30c7\u30d7\u30ed\u30a4\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002zip\u3067example-lambda-mysql-select\u914d\u4e0b\u3092\u56fa\u3081\u307e\u3059\u3002\n\n```\n[ec2-user@example-server example-lambda-mysql-select]$ pwd\n/home/ec2-user/example-lambda-mysql-select\n[ec2-user@example-server example-lambda-mysql-select]$ zip -r example-lambda-mysql-select.zip .\n\n[ec2-user@example-server example-lambda-mysql-select]$ ls -lrta /home/ec2-user/example-lambda-mysql-select/\ntotal 272\ndrwxrwxr-x  3 ec2-user ec2-user   4096 Apr 11 00:55 node_modules\n-rw-rw-r--  1 ec2-user ec2-user   2649 Apr 11 00:55 example.js\ndrwx------ 21 ec2-user ec2-user   4096 Apr 11 00:55 ..\n-rw-rw-r--  1 ec2-user ec2-user 258434 Apr 11 00:56 example-lambda-mysql-select.zip\ndrwxrwxr-x  3 ec2-user ec2-user   4096 Apr 11 00:56 .\n[ec2-user@example-server example-lambda-mysql-select]$\n```\n\nzip\u30d5\u30a1\u30a4\u30eb\u5316\u3057\u305f\u30c7\u30d7\u30ed\u30a4\u30d1\u30c3\u30b1\u30fc\u30b8\u3092S3\u3078\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\u3053\u306ezip\u30d5\u30a1\u30a4\u30eb\u306f\u5f8c\u3067Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u4f5c\u6210\u6642\u306b\u5229\u7528\u3057\u307e\u3059\u3002\n\n```\n[ec2-user@example-server example-lambda-mysql-select]$ aws s3 cp /home/ec2-user/example-lambda-mysql-select/example-lambda-mysql-select.zip s3://\u9069\u5f53\u306aS3\u30d0\u30b1\u30c3\u30c8/\nupload: ./example-lambda-mysql-select.zip to s3://\u9069\u5f53\u306aS3\u30d0\u30b1\u30c3\u30c8/example-lambda-mysql-select.zip\n[ec2-user@example-server example-lambda-mysql-select]$\n```\n\nNode.js\u306eAWS Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9(example.js)\n---\n\n\u4ee5\u4e0b\u304cLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306e\u30b3\u30fc\u30c9\u3067\u3059\u3002\n\n```js:example.js\nvar AWS = require('aws-sdk');\nvar mysql = require('mysql');\n\n// KMS\u306b\u3088\u308a\u6697\u53f7\u5316\u3057\u305fMySQL\u63a5\u7d9a\u7528\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u6587\u5b57\u5217\nvar kmsEncyptedToken = \"CiC*********(KMS\u3067\u6697\u53f7\u5316\u3057\u305fMySQL\u63a5\u7d9a\u7528\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u6587\u5b57\u5217)***********UI=\";\n\n// \u63a5\u7d9a\u5148\u306eMySQL\u30b5\u30fc\u30d0\u60c5\u5831\nvar mysql_host = \"example-rds-mysql-server.carvmoii2uds.ap-northeast-1.rds.amazonaws.com\";\nvar mysql_user = \"example_user\";\nvar mysql_dbname = \"exampledb\";\nvar mysql_password = \"\";\n\nvar sns_topic_arn = \"arn:aws:sns:ap-northeast-1:*******************:example-lambda-mysql-sns\";\n\nexports.handler = function(event, context){\n\n    // \u5b9f\u884c\u3059\u308bSQL\u6587\n    var sql = \"SELECT * FROM exampledb.example_table WHERE insert_date <= date_sub(curdate(), interval 2 week)\";\n\n    if (kmsEncyptedToken && kmsEncyptedToken !== \"<kmsEncryptedToken>\") {\n\n        var encryptedBuf = new Buffer(kmsEncyptedToken, 'base64');\n        var cipherText = {CiphertextBlob: encryptedBuf};\n\n        var kms = new AWS.KMS({ region: 'ap-northeast-1' });\n        var sns = new AWS.SNS({ region: 'ap-northeast-1' });\n\n        // KMS\u306b\u3088\u308a\u6697\u53f7\u5316\u3057\u305f\u30d1\u30b9\u30ef\u30fc\u30c9\u6587\u5b57\u5217\u306e\u5fa9\u53f7\u5316\n        kms.decrypt(cipherText, function (err, data) {\n            if (err) {\n\n                console.log(\"CipherText Decrypt error: \" + err);\n                context.fail(err);\n\n            } else {\n\n                mysql_password = data.Plaintext.toString('ascii');\n\n                var connection = mysql.createConnection({\n                    host     : mysql_host,\n                    user     : mysql_user,\n                    password : mysql_password,\n                    database : mysql_dbname\n                });\n\n                console.log(\"MySQL Server Name: \" + mysql_host);\n                console.log(\"MySQL User Name: \" + mysql_user);\n                console.log(\"MySQL Database Name: \" + mysql_dbname);\n                console.log(\"MySQL Exec SQL: \" + sql);\n\n                // MySQL\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u306e\u63a5\u7d9a\n                connection.connect();\n\n                // MySQL\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3067SQL\u5b9f\u884c\n                connection.query(sql, function(err, rows, fields) {\n                    if (err) {\n\n                        console.log(\"MySQL Select Error\");\n                        context.fail(err);\n                        sns.publish({\n                            Message: 'Lambda Function Error',\n                            Subject: 'Lambda Function Error',\n                            TopicArn: sns_topic_arn\n                        }, function(err, data){\n                            if(err) throw err;\n                            else context.fail('SNS Publish Error');\n                        });\n\n                        throw err;\n\n                    } else {\n\n                    console.log(\"MySQL Select Success\");\n                    console.log(rows);\n                    console.log(fields);\n                    }\n                });\n\n                connection.end(function(err) {\n\n                    sns.publish({\n                        Message: 'Lambda Function Success',\n                        Subject: 'Lambda Function Success',\n                        TopicArn: sns_topic_arn\n                    }, function(err, data){\n                        if(err) throw err;\n                        else context.fail('SNS Publish Error');\n                    });\n\n                    context.done();\n                });\n            }\n        });\n\n    } else {\n\n        context.fail(\"kmsEncyptedToken has not been set.\");\n\n    }\n\n    console.log('end');\n\n};\n```\n\nLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u4f5c\u6210\n---\n\n\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fLambda\u306e\u30c7\u30d7\u30ed\u30a4\u30d1\u30c3\u30b1\u30fc\u30b8[example-lambda-mysql-select.zip]\u3092Lambda\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u3001Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u524d\u8ff0\u306e\u624b\u9806\u3067S3\u306b\u30d1\u30c3\u30b1\u30fc\u30b8\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u306e\u3067\u3001\u305d\u308c\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\u3000s3://\u9069\u5f53\u306aS3\u30d0\u30b1\u30c3\u30c8/example-lambda-mysql-select.zip\n\nLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306eIAM\u30dd\u30ea\u30b7\u30fc\u306f[lambda_basic_vpc_execution]\u3092\u9078\u629e\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306f\u3001Amazon RDS for MySQL\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078MySQL\u63a5\u7d9a\u53ef\u80fd\u306a\u8a2d\u5b9a\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u9078\u629e\u3057\u3066\u3001Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u5b9f\u884c\n---\n\nLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\u3057\u3001\u6b63\u5e38\u306bMySQL\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u63a5\u7d9a\u51fa\u6765\u308c\u3070\u3001Lambda\u306e[Log outPut]\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306bMySQL\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306eSELECT\u7d50\u679c\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\u307e\u305f\u3001ANS SNS\u3067\u6307\u5b9a\u3057\u305f\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u5b9b\u306b[Lambda Fanction Success]\u30e1\u30fc\u30eb\u304c\u5c4a\u304d\u307e\u3059\u3002\n\n```\nSTART RequestId: 442b53cf-ff43-11e5-9dc8-2123a6cf68bb Version: $LATEST\n2016-04-10T17:40:08.926Z\t442b53cf-ff43-11e5-9dc8-2123a6cf68bb\tend\n2016-04-10T17:40:10.127Z\t442b53cf-ff43-11e5-9dc8-2123a6cf68bb\tMySQL Server Name: example-rds-mysql-server.carvmoii2uds.ap-northeast-1.rds.amazonaws.com\n2016-04-10T17:40:10.183Z\t442b53cf-ff43-11e5-9dc8-2123a6cf68bb\tMySQL User Name: example_user\n2016-04-10T17:40:10.183Z\t442b53cf-ff43-11e5-9dc8-2123a6cf68bb\tMySQL Database Name: exampledb\n2016-04-10T17:40:10.183Z\t442b53cf-ff43-11e5-9dc8-2123a6cf68bb\tMySQL Exec SQL: SELECT * FROM exampledb.example_table WHERE insert_date <= date_sub(curdate(), interval 2 week)\n2016-04-10T17:40:10.346Z\t442b53cf-ff43-11e5-9dc8-2123a6cf68bb\tMySQL Select Success\n2016-04-10T17:40:10.346Z\t442b53cf-ff43-11e5-9dc8-2123a6cf68bb\t[ RowDataPacket { id: 1, insert_date: Thu Mar 10 2016 12:30:00 GMT+0000 (UTC) },\n  RowDataPacket { id: 2, insert_date: Sun Mar 20 2016 12:30:00 GMT+0000 (UTC) } ]\n2016-04-10T17:40:10.567Z\t442b53cf-ff43-11e5-9dc8-2123a6cf68bb\t[ FieldPacket {\n    catalog: 'def',\n    db: 'exampledb',\n    table: 'example_table',\n    orgTable: 'example_table',\n    name: 'id',\n    orgName: 'id',\n    charsetNr: 63,\n    length: 12,\n    type: 3,\n    flags: 0,\n    decimals: 0,\n    default: undefined,\n    zeroFill: false,\n    protocol41: true },\n  FieldPacket {\n    catalog: 'def',\n    db: 'exampledb',\n    table: 'example_table',\n    orgTable: 'example_table',\n    name: 'insert_date',\n    orgName: 'insert_date',\n    charsetNr: 63,\n    length: 19,\n    type: 12,\n    flags: 128,\n    decimals: 0,\n    default: undefined,\n    zeroFill: false,\n    protocol41: true } ]\nEND RequestId: 442b53cf-ff43-11e5-9dc8-2123a6cf68bb\nREPORT RequestId: 442b53cf-ff43-11e5-9dc8-2123a6cf68bb\tDuration: 2670.49 ms\tBilled Duration: 2700 ms \tMemory Size: 128 MB\tMax Memory Used: 30 MB\t\n```\n\n***\n\n\u4ee5\u4e0a\u306b\u306a\u308a\u307e\u3059\u3002\n", "tags": ["AWS", "lambda", "kms", "Node.js", "MySQL"]}