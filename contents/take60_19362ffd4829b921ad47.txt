{"context": "\n\n\u306f\u3058\u3081\u306b\nAWS\u3067\u65b0\u3057\u3044GPU\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u3042\u308bP2\u7cfb\u304c\u51fa\u307e\u3057\u305f\u3002\nhttp://dev.classmethod.jp/cloud/p2-instance-type/\nDeep learning\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u30d7\u30ea\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308bAMI(https://aws.amazon.com/marketplace/pp/B01M0AXXQB)\n\u3082\u3042\u308b\u306e\u3067\u3059\u304c\u3001CUDA\u3084CuDNN\u304c\u5165\u3063\u3066\u3044\u306a\u3044\u3089\u3057\u3044\u306e\u3067\u305b\u3063\u304b\u304f\u3068\u3044\u3046\u3053\u3068\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nOS:ubuntu 14.04\nCUDA: 7.5\nCuDNN: 5.1\n\n\u6e96\u5099\n\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u7cfb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo apt-get update -y\nsudo apt-get upgrade -y\nsudo apt-get install -y build-essential git python-pip python-dev libxml2-dev libxslt1-dev zlib1g-dev libcurl4-openssl-dev libatlas-base-dev linux-image-extra-virtual libopencv-dev python-numpy\nsudo apt-get autoremove -y \n\n\u30db\u30b9\u30c8\u5074\u306e\u30c9\u30e9\u30a4\u30d0\u3092\u7121\u52b9\u306b\u3059\u308b\nsudo vi /etc/modprobe.d/blacklist-nouveau.conf\u3000\u3092\u5b9f\u884c\n\n/etc/modprobe.d/blacklist-nouveau.conf\nblacklist nouveau\nblacklist lbm-nouveau\noptions nouveau modeset=0\nalias nouveau off\nalias lbm-nouveau off\n\n\n\u518d\u8d77\u52d5\u3092\u3059\u308b\necho options nouveau modeset=0 | sudo tee -a /etc/modprobe.d/nouveau-kms.conf\nsudo update-initramfs -u\nsudo reboot\n\n\nnvidia-driver\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4e8b\u524d\u306bGPU\u306b\u9069\u5408\u3059\u308b\u30c9\u30e9\u30a4\u30d0\u3092\u8abf\u3079\u3066\u304a\u304f\nP2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eGPU\u306fK80\nsudo apt-get install -y linux-source \nsudo apt-get install -y linux-headers-`uname -r`\nwget http://us.download.nvidia.com/XFree86/Linux-x86_64/352.99/NVIDIA-Linux-x86_64-352.99.run\nsudo chmod +x NVIDIA-Linux-x86_64-352.99.run\nsudo ./NVIDIA-Linux-x86_64-352.99.run\n\n\u518d\u8d77\u52d5\u3057\u3066\u304a\u304f\n\nCUDA+CuDNN\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nwget http://developer.download.nvidia.com/compute/cuda/7.5/Prod/local_installers/cuda-repo-ubuntu1404-7-5-local_7.5-18_amd64.deb\nsudo dpkg -i cuda-repo-ubuntu1404-7-5-local_7.5-18_amd64.deb\nsudo apt-get update -y \nsudo apt-get install cuda -y\n\nCuDNN\u306f\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u304b\u3089\u767b\u9332\u3057\u3001\u30a2\u30f3\u30b1\u30fc\u30c8\u306b\u7b54\u3048\u305f\u5f8cDL\nhttps://developer.nvidia.com/cudnn\ntar xzf cudnn-7.5-linux-x64-v5.1.tgz\nsudo cp -a cuda/lib64/* /usr/local/lib/\nsudo cp -a cuda/include/* /usr/local/include/\nsudo ldconfig\n\n.bashrc\u3092\u7de8\u96c6\nexport PATH=$PATH:/usr/local/cuda-7.5/bin \nexport LD_LIBRARY_PATH=:/usr/local/cuda-7.5/lib64 \n\nsource .bashrc\n\nCaffe\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ngit\u304b\u3089clone\nsudo apt-get update && sudo apt-get upgrade;\n# \u4e0a\u3068\u91cd\u8907\u3082\u3042\u308b\u304c\u6c17\u306b\u3057\u306a\u3044\u3002\u3002\u3002\nsudo apt-get install -y libprotobuf-dev libleveldb-dev libsnappy-dev libopencv-dev libboost-all-dev libhdf5-serial-dev protobuf-compiler gfortran libjpeg62 libfreeimage-dev libatlas-base-dev git python-dev python-pip libgoogle-glog-dev libbz2-dev libxml2-dev libxslt-dev libffi-dev libssl-dev libgflags-dev liblmdb-dev python-yaml python-numpy;\n#sudo easy_install pillow;\ngit clone https://github.com/BVLC/caffe.git\ncd caffe;\ncat python/requirements.txt | xargs -L 1 sudo pip install;\n\nmake\u3059\u308b\ncp Makefile.config.example Makefile.config\necho USE_CUDNN := 1 >> Makefile.config\nmake all -j4;\nmake test -j4;\nmake runtest -j4;\n\n\u30b5\u30f3\u30d7\u30eb\u5b9f\u884c\n./data/mnist/get_mnist.sh;\n./examples/mnist/create_mnist.sh;\n./examples/mnist/train_lenet.sh;\n\n\u7d50\u679c\u629c\u7c8b\nI1017 07:48:29.925045 20325 solver.cpp:454] Snapshotting to binary proto file examples/mnist/lenet_iter_10000.caffemodel\nI1017 07:48:29.932385 20325 sgd_solver.cpp:273] Snapshotting solver state to binary proto file examples/mnist/lenet_iter_10000.solverstate\nI1017 07:48:29.936767 20325 solver.cpp:317] Iteration 10000, loss = 0.00284106\nI1017 07:48:29.936818 20325 solver.cpp:337] Iteration 10000, Testing net (#0)\nI1017 07:48:30.079130 20325 solver.cpp:404]     Test net output #0: accuracy = 0.9914\nI1017 07:48:30.079165 20325 solver.cpp:404]     Test net output #1: loss = 0.0269921 (* 1 = 0.0269921 loss)\nI1017 07:48:30.079176 20325 solver.cpp:322] Optimization Done.\nI1017 07:48:30.079183 20325 caffe.cpp:254] Optimization Done.\n\n\u3046\u307e\u304f\u3044\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u306d\u3002\nPython\u3067\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\nsudo apt-get install -y python-dev python-pip python-numpy python-skimage gfortran\nmake pycaffe -j4;\necho 'export PYTHONPATH=~/caffe/python/:$PYTHONPATH' >> ~/.bashrc\nsource .bashrc\n\n\u3042\u3068\u306fPython\u3067import caffe\u3092\u3059\u308c\u3070\u3088\u3044\u3002\n\u3082\u3057GDK_IS_DISPLAY (display)' failed\n\u3068\u6012\u3089\u308c\u305f\u5834\u5408\u306f\u4ee5\u4e0b\u3092\u53c2\u8003\u306b\u3001~/.config/matplotlib/matplotlibrc\n\u3092\u7de8\u96c6\u3002\nhttps://github.com/BVLC/caffe/issues/861\n\n~/.config/matplotlib/matplotlibrc\nbackend: Agg\n\n\nPython\u30e9\u30a4\u30d6\u30e9\u30ea\u7cfb\u3067\u6012\u3089\u308c\u305f\u5834\u5408\u306fpip install --upgrade pip\u306e\u5f8c\u518d\u5ea6\u4e0b\u8a18\u3092\u5b9f\u884c\u3002\n\ncat python/requirements.txt | xargs -L 1 sudo pip install;\n\n## \u306f\u3058\u3081\u306b\nAWS\u3067\u65b0\u3057\u3044GPU\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u3042\u308bP2\u7cfb\u304c\u51fa\u307e\u3057\u305f\u3002\nhttp://dev.classmethod.jp/cloud/p2-instance-type/\n\nDeep learning\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u30d7\u30ea\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308bAMI(https://aws.amazon.com/marketplace/pp/B01M0AXXQB)\n\u3082\u3042\u308b\u306e\u3067\u3059\u304c\u3001CUDA\u3084CuDNN\u304c\u5165\u3063\u3066\u3044\u306a\u3044\u3089\u3057\u3044\u306e\u3067\u305b\u3063\u304b\u304f\u3068\u3044\u3046\u3053\u3068\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\nOS:ubuntu 14.04\nCUDA: 7.5\nCuDNN: 5.1\n\n## \u6e96\u5099\n\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u7cfb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\nsudo apt-get update -y\nsudo apt-get upgrade -y\nsudo apt-get install -y build-essential git python-pip python-dev libxml2-dev libxslt1-dev zlib1g-dev libcurl4-openssl-dev libatlas-base-dev linux-image-extra-virtual libopencv-dev python-numpy\nsudo apt-get autoremove -y \n```\n\n\u30db\u30b9\u30c8\u5074\u306e\u30c9\u30e9\u30a4\u30d0\u3092\u7121\u52b9\u306b\u3059\u308b\n\n`sudo vi /etc/modprobe.d/blacklist-nouveau.conf`\u3000\u3092\u5b9f\u884c\n\n```/etc/modprobe.d/blacklist-nouveau.conf\nblacklist nouveau\nblacklist lbm-nouveau\noptions nouveau modeset=0\nalias nouveau off\nalias lbm-nouveau off\n```\n\n\u518d\u8d77\u52d5\u3092\u3059\u308b\n\n```\necho options nouveau modeset=0 | sudo tee -a /etc/modprobe.d/nouveau-kms.conf\nsudo update-initramfs -u\nsudo reboot\n```\n\n## nvidia-driver\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u4e8b\u524d\u306bGPU\u306b\u9069\u5408\u3059\u308b\u30c9\u30e9\u30a4\u30d0\u3092\u8abf\u3079\u3066\u304a\u304f\nP2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eGPU\u306fK80\n\n```\nsudo apt-get install -y linux-source \nsudo apt-get install -y linux-headers-`uname -r`\nwget http://us.download.nvidia.com/XFree86/Linux-x86_64/352.99/NVIDIA-Linux-x86_64-352.99.run\nsudo chmod +x NVIDIA-Linux-x86_64-352.99.run\nsudo ./NVIDIA-Linux-x86_64-352.99.run\n```\n\n\u518d\u8d77\u52d5\u3057\u3066\u304a\u304f\n\n## CUDA+CuDNN\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\nwget http://developer.download.nvidia.com/compute/cuda/7.5/Prod/local_installers/cuda-repo-ubuntu1404-7-5-local_7.5-18_amd64.deb\nsudo dpkg -i cuda-repo-ubuntu1404-7-5-local_7.5-18_amd64.deb\nsudo apt-get update -y \nsudo apt-get install cuda -y\n```\n\nCuDNN\u306f\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u304b\u3089\u767b\u9332\u3057\u3001\u30a2\u30f3\u30b1\u30fc\u30c8\u306b\u7b54\u3048\u305f\u5f8cDL\nhttps://developer.nvidia.com/cudnn\n\n```\ntar xzf cudnn-7.5-linux-x64-v5.1.tgz\nsudo cp -a cuda/lib64/* /usr/local/lib/\nsudo cp -a cuda/include/* /usr/local/include/\nsudo ldconfig\n```\n\n`.bashrc`\u3092\u7de8\u96c6\n\n```.bashrc\nexport PATH=$PATH:/usr/local/cuda-7.5/bin \nexport LD_LIBRARY_PATH=:/usr/local/cuda-7.5/lib64 \n```\n\n```source .bashrc```\n\n## Caffe\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\ngit\u304b\u3089clone\n\n```\nsudo apt-get update && sudo apt-get upgrade;\n# \u4e0a\u3068\u91cd\u8907\u3082\u3042\u308b\u304c\u6c17\u306b\u3057\u306a\u3044\u3002\u3002\u3002\nsudo apt-get install -y libprotobuf-dev libleveldb-dev libsnappy-dev libopencv-dev libboost-all-dev libhdf5-serial-dev protobuf-compiler gfortran libjpeg62 libfreeimage-dev libatlas-base-dev git python-dev python-pip libgoogle-glog-dev libbz2-dev libxml2-dev libxslt-dev libffi-dev libssl-dev libgflags-dev liblmdb-dev python-yaml python-numpy;\n#sudo easy_install pillow;\ngit clone https://github.com/BVLC/caffe.git\ncd caffe;\ncat python/requirements.txt | xargs -L 1 sudo pip install;\n```\n\nmake\u3059\u308b\n\n```\ncp Makefile.config.example Makefile.config\necho USE_CUDNN := 1 >> Makefile.config\nmake all -j4;\nmake test -j4;\nmake runtest -j4;\n```\n\n\u30b5\u30f3\u30d7\u30eb\u5b9f\u884c\n\n```\n./data/mnist/get_mnist.sh;\n./examples/mnist/create_mnist.sh;\n./examples/mnist/train_lenet.sh;\n```\n\n\u7d50\u679c\u629c\u7c8b\n\n```\nI1017 07:48:29.925045 20325 solver.cpp:454] Snapshotting to binary proto file examples/mnist/lenet_iter_10000.caffemodel\nI1017 07:48:29.932385 20325 sgd_solver.cpp:273] Snapshotting solver state to binary proto file examples/mnist/lenet_iter_10000.solverstate\nI1017 07:48:29.936767 20325 solver.cpp:317] Iteration 10000, loss = 0.00284106\nI1017 07:48:29.936818 20325 solver.cpp:337] Iteration 10000, Testing net (#0)\nI1017 07:48:30.079130 20325 solver.cpp:404]     Test net output #0: accuracy = 0.9914\nI1017 07:48:30.079165 20325 solver.cpp:404]     Test net output #1: loss = 0.0269921 (* 1 = 0.0269921 loss)\nI1017 07:48:30.079176 20325 solver.cpp:322] Optimization Done.\nI1017 07:48:30.079183 20325 caffe.cpp:254] Optimization Done.\n```\n\u3046\u307e\u304f\u3044\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u306d\u3002\n\nPython\u3067\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\n\n```\nsudo apt-get install -y python-dev python-pip python-numpy python-skimage gfortran\nmake pycaffe -j4;\necho 'export PYTHONPATH=~/caffe/python/:$PYTHONPATH' >> ~/.bashrc\nsource .bashrc\n```\n\n\u3042\u3068\u306fPython\u3067`import caffe`\u3092\u3059\u308c\u3070\u3088\u3044\u3002\n\n\n\u3082\u3057`GDK_IS_DISPLAY (display)' failed`\n\u3068\u6012\u3089\u308c\u305f\u5834\u5408\u306f\u4ee5\u4e0b\u3092\u53c2\u8003\u306b\u3001`~/.config/matplotlib/matplotlibrc`\n\u3092\u7de8\u96c6\u3002\nhttps://github.com/BVLC/caffe/issues/861\n\n```~/.config/matplotlib/matplotlibrc\nbackend: Agg\n```\n\nPython\u30e9\u30a4\u30d6\u30e9\u30ea\u7cfb\u3067\u6012\u3089\u308c\u305f\u5834\u5408\u306f`pip install --upgrade pip`\u306e\u5f8c\u518d\u5ea6\u4e0b\u8a18\u3092\u5b9f\u884c\u3002\n```\ncat python/requirements.txt | xargs -L 1 sudo pip install;\n```\n", "tags": ["AWS", "DeepLearning", "Caffe", "CUDA", "cuDNN"]}