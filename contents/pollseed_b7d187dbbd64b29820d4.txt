{"context": " More than 1 year has passed since last update.\n\n\u521d\u3081\u306b\nrails\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092aws\u30b5\u30fc\u30d0\u306b\u30c7\u30d7\u30ed\u30a4\u30e1\u30f3\u30c8\u3059\u308b\n\u305f\u3060\u3057\u3001capistrano,unicorn,nginx\u3092\u7528\u3044\u3066\u884c\u3046\u3053\u3068\u3068\u3059\u308b\n\u5f53\u7136\u30a8\u30e9\u30fc\u304c\u51fa\u307e\u304f\u308b\u306e\u3067\u3001\u305d\u308c\u306e\u5bfe\u5fdc\u30e1\u30e2\u3002\u5f8c\u3067\u5f79\u306b\u7acb\u3064\u306e\u3067\u4f5c\u696d\u3092\u3082\u3081\u3057\u3066\u304a\u304f\u3002\u305f\u3060\u306e\u500b\u4eba\u7528\u30e1\u30e2\u3067\u3059\u3002\n\u521d\u3081\u306b\u3001\u30a8\u30e9\u30fc\u306e\u7d50\u8ad6\u3068\u69cb\u6210\u306b\u3064\u3044\u3066\n\n\u30a8\u30e9\u30fc\nmysql\u306e\u8a2d\u5b9a\u30a8\u30e9\u30fc\u2192\u7d50\u8ad6\u3001/etc/my.cnf\u306e\u8a2d\u5b9a\u30df\u30b9\ncapistrano\u306e\u30c7\u30d7\u30ed\u30a4\u30a8\u30e9\u30fc\u2192\u7d50\u8ad6\u3001\u5bfe\u8c61\u30ea\u30dd\u30b8\u30c8\u30ea\u3067bundle install\nnginx\u306e\u30a8\u30e9\u30fc\u2192\u7d50\u8ad6\u3001\u6a29\u9650\u4ed8\u3051\u308b\u3060\u3051\nunicorn\u304c\u8d77\u52d5\u3057\u306a\u3044\u2192secret key\u306e\u8a2d\u5b9a\u6f0f\u308c\n\n\u69cb\u6210\n\nrails 4.2.1\nruby 2.2.1\nmysql 5.6\naws\ncapistrano\nnginx\nunicorn\n\n\n\u30a8\u30e9\u30fc\u89e3\u6c7a\u624b\u9806\n\nmysql2\u306e\u30a8\u30e9\u30fc\nMysql2::Error: Can't connect to local MySQL server through socket '/tmp/mysql.sock' (13)\n\n\nmysql2\u2192gem\u540d\n\n/tmp/mysql.sock\u2192\u30bd\u30b1\u30c3\u30c8\u30d1\u30b9\nMySQL\u30b5\u30fc\u30d0\u306b\u63a5\u7d9a\u3067\u304d\u306a\u3044\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\ndatabase.yml\ndefault: &default\n  adapter: mysql\n  encoding: utf8\n  pool: 5\n  username: root\n  password: password\n  socket: /var/lib/mysql/mysql.sock\n\nproduction:\n  <<: *default\n  database: db\u540d\n  host: \u30db\u30b9\u30c8\u540d:3306\n\n\n\n\u539f\u56e0\n\nmysql\u304c\u30b5\u30fc\u30d0\u5074\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u306a\u3044\nmysql\u30b5\u30fc\u30d0\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u304a\u304b\u3057\u3044\n\n\n\u5bfe\u5fdc\uff11\uff1a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u307e\u3067\n# \u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u53e4\u3044\u8005\u305f\u3061\u3092\u6d88\u3057\u3066\u3042\u3052\u308b\nrpm -qa | grep -i mysql\n# \u50d5\u306e\u5834\u5408\u306f5.5\u304c\u3044\u305f\u306e\u3067\u3053\u3044\u3064\u3092\u6d88\u3057\u305f\nsudo rpm -e mysql55-common-5.5.42-1.4.amzn1.x86_64\n\n# rpm\u3067\u6700\u65b0\u7248\u306e6.5\u306b\u5408\u308f\u305b\u308b\nsudo rpm -ivh http://dev.mysql.com/get/mysql-community-release-el6-5.noarch.rpm\n\n# \u30d1\u30c3\u30b1\u30fc\u30b8\u60c5\u5831\u3092\u8abf\u3079\u308b\nsudo yum info mysql-community-server\n\n# mysql-community-server\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo yum -y install mysql-community-server\n\n# \u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\u21925.6\u306b\u306a\u3063\u3066\u305f\u3089\u6210\u529f\n$ mysql --version\nmysql  Ver 14.14 Distrib 5.6.24, for Linux (x86_64) using  EditLine wrapper\n$ mysqld --version\nmysqld  Ver 5.6.24 for Linux on x86_64 (MySQL Community Server (GPL))\n\n\n\u5bfe\u5fdc\uff12\uff1a\u8a2d\u5b9a\u5468\u308a(A)\n# \u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\nsudo chkconfig mysqld on\n\n$ chkconfig | grep mysql\nmysqld          0:off   1:off   2:on    3:on    4:on    5:on    6:off\n\n# \u30ea\u30b9\u30bf\u30fc\u30c8\u6642\u306ewarn\u30ec\u30d9\u30eb\u4ee5\u4e0a\n$ sudo service mysqld restart\nStopping mysqld:                                           [  OK  ]\nMySQL Daemon failed to start.\nStarting mysqld:                                           [FAILED]\n\n# 2-1\n[Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).\n\n# 2-2\n[ERROR] Can't open the mysql.plugin table. Please run mysql_upgrade to create it.\n\n# 2-3\n[ERROR] Fatal error: Can't open and lock privilege tables: Table 'mysql.user' doesn't exist\n\n\n\u5bfe\u5fdc2-1\uff1a\u975e\u63a8\u5968\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u304c\u3042\u308b\n/etc/my.cnf\u3092\u8a2d\u5b9a\u5909\u66f4\u5f8c\u3001\u518d\u5ea6\u30ea\u30b9\u30bf\u30fc\u30c8\u639b\u3051\u308b\u2192\u6a29\u9650\u5468\u308a\u30b9\u30ad\u30c3\u30d7\u3057\u3066\u308b\u306e\u3067\u30a8\u30e9\u30fc\u306f\u5410\u304b\u308c\u308b\u304c\u554f\u984c\u306a\u304f\u8d77\u52d5\u3059\u308b\u306f\u305a\n\n/etc/my.cnf\n// Please use --explicit_defaults_for_timestamp server option\n\nexplicit_defaults_for_timestamp=1\nskip-grant-tables\n\n\n\n\u5bfe\u5fdc2-2,2-3\uff1a\u6a29\u9650\u5468\u308a\n\n\u6a29\u9650\u30c6\u30fc\u30d6\u30eb\u304c\u958b\u3051\u306a\u3044\nmysql.plugin\u30c6\u30fc\u30d6\u30eb\u304c\u958b\u3051\u306a\u3044\n\n# \u521d\u671f\u30c7\u30fc\u30bf\u3092\u4f5c\u308b\netc/rc.d/init.d/mysqld restart\n\n# root\u6a29\u9650\u3067\u30ed\u30b0\u30a4\u30f3\u3059\u308b\nmysql -u root\n\n# \u30c6\u30fc\u30d6\u30eb\u304c\u4f5c\u3089\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\n> use mysql;\n> show tables;\n\n+---------------------------+\n| Tables_in_mysql           |\n+---------------------------+\n| columns_priv              |\n| db                        |\n| event                     |\n| func                      |\n| general_log               |\n| help_category             |\n| help_keyword              |\n| help_relation             |\n| help_topic                |\n| innodb_index_stats        |\n| innodb_table_stats        |\n| ndb_binlog_index          |\n| plugin                    |\n| proc                      |\n| procs_priv                |\n| proxies_priv              |\n| servers                   |\n| slave_master_info         |\n| slave_relay_log_info      |\n| slave_worker_info         |\n| slow_log                  |\n| tables_priv               |\n| time_zone                 |\n| time_zone_leap_second     |\n| time_zone_name            |\n| time_zone_transition      |\n| time_zone_transition_type |\n| user                      |\n+---------------------------+\n\n# \u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3059\u308b\nset password for root@localhost=password('\u30d1\u30b9\u30ef\u30fc\u30c9');\n\n# mysql\u30c6\u30fc\u30d6\u30eb\u306e\u30c1\u30a7\u30c3\u30af\nmysql_upgrade -u root -p\n\n# mysql -u root\u3067\u306f\u5165\u308c\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u5f8c\u3001\u30ed\u30b0\u30a4\u30f3\nmysql -u root -p\n\n\n\u5bfe\u5fdc\uff13\uff1a\u8a2d\u5b9a\u5468\u308a(B)\n# 3-1\nLoadError: /usr/lib64/mysql/libmysqlclient.so.18: version `libmysqlclient_16' not found (required by /var/www/pj/shared/bundle/ruby/2.2.0/extensions/x86_64-linux/2.2.0-static/mysql2-0.3.18/mysql2/mysql2.so) - /var/www/pj/shared/bundle/ruby/2.2.0/extensions/x86_64-linux/2.2.0-static/mysql2-0.3.18/mysql2/mysql2.so\n/var/www/pj/shared/bundle/ruby/2.2.0/gems/mysql2-0.3.18/lib/mysql2.rb:31:in `require'\n/var/www/pj/shared/bundle/ruby/2.2.0/gems/mysql2-0.3.18/lib/mysql2.rb:31:in `<top (required)>'\n/var/www/pj/releases/20150407233148/config/application.rb:7:in `<top (required)>'\n/var/www/pj/releases/20150407233148/Rakefile:4:in `require'\n/var/www/pj/releases/20150407233148/Rakefile:4:in `<top (required)>'\n(See full trace by running task with --trace)\n\n\n\u5bfe\u5fdc3-1\uff1alibmysqlclient\u5468\u308a\n\nlibmysqlclient\u306e\u30ed\u30fc\u30c9\u30a8\u30e9\u30fc\n16\u3092\u8981\u6c42\u3057\u3066\u3044\u308b\u304c18\u3057\u304b\u306a\u3044\uff1f\nmysql2\u306f\n\n# \u4e00\u5ea6mysql2\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u307f\u308b\nsudo yum install mysql-devel\ngem install mysql2\n\n# \u691c\u7d22\u3057\u3066\u307f\u308b\nsudo find / -name libmysqlclient_16\n$ ldcondig -p | grep mysql\nlibmysqlclient.so.18 (libc6,x86-64) => /usr/lib64/mysql/libmysqlclient.so.18\nfind ~/.rbenv/versions/2.2.1/ -name 'mysql2.so'\n\n# libmysqlclient.so.18\u4f9d\u5b58\n$ ldd /usr/lib64/mysql/libmysqlclient.so.18\n    linux-vdso.so.1 =>  (0x00007ffe9eb2e000)\n    libpthread.so.0 => /lib64/libpthread.so.0 (0x00007f14d07f2000)\n    libdl.so.2 => /lib64/libdl.so.2 (0x00007f14d05ee000)\n    librt.so.1 => /lib64/librt.so.1 (0x00007f14d03e5000)\n    libstdc++.so.6 => /usr/lib64/libstdc++.so.6 (0x00007f14d00e1000)\n    libm.so.6 => /lib64/libm.so.6 (0x00007f14cfddf000)\n    libgcc_s.so.1 => /lib64/libgcc_s.so.1 (0x00007f14cfbc8000)\n    libc.so.6 => /lib64/libc.so.6 (0x00007f14cf807000)\n    /lib64/ld-linux-x86-64.so.2 (0x00007f14d0fe3000)\n\n# mysql2.so\u4f9d\u5b581\nldd .rbenv/versions/2.2.1/lib/ruby/gems/2.2.0/extensions/x86_64-linux/2.2.0-static/mysql2-0.3.18/mysql2/mysql2.so\nldd .rbenv/versions/2.2.1/lib/ruby/gems/2.2.0/gems/mysql2-0.3.18/ext/mysql2/mysql2.so\nldd .rbenv/versions/2.2.1/lib/ruby/gems/2.2.0/gems/mysql2-0.3.18/lib/mysql2/mysql2.so\n    linux-vdso.so.1 =>  (0x00007ffde7bd3000)\n    libmysqlclient.so.18 => /usr/lib64/mysql/libmysqlclient.so.18 (0x00007fabb6760000)\n    libpthread.so.0 => /lib64/libpthread.so.0 (0x00007fabb653d000)\n    libm.so.6 => /lib64/libm.so.6 (0x00007fabb623b000)\n    librt.so.1 => /lib64/librt.so.1 (0x00007fabb6033000)\n    libdl.so.2 => /lib64/libdl.so.2 (0x00007fabb5e2e000)\n    libcrypt.so.1 => /lib64/libcrypt.so.1 (0x00007fabb5bf7000)\n    libc.so.6 => /lib64/libc.so.6 (0x00007fabb5836000)\n    libstdc++.so.6 => /usr/lib64/libstdc++.so.6 (0x00007fabb5531000)\n    libgcc_s.so.1 => /lib64/libgcc_s.so.1 (0x00007fabb531b000)\n    /lib64/ld-linux-x86-64.so.2 (0x00007fabb6f3c000)\n    libfreebl3.so => /lib64/libfreebl3.so (0x00007fabb50a0000)\n\n# mysql2.so\u4f9d\u5b582\nldd /var/www/pj/shared/bundle/ruby/2.2.0/extensions/x86_64-linux/2.2.0-static/mysql2-0.3.18/mysql2/mysql2.so\n/var/www/pj/shared/bundle/ruby/2.2.0/extensions/x86_64-linux/2.2.0-static/mysql2-0.3.18/mysql2/mysql2.so: /usr/lib64/mysql/libmysqlclient.so.18: version `libmysqlclient_16' not found (required by /var/www/pj/shared/bundle/ruby/2.2.0/extensions/x86_64-linux/2.2.0-static/mysql2-0.3.18/mysql2/mysql2.so)\n    linux-vdso.so.1 =>  (0x00007ffe122d4000)\n    libmysqlclient.so.18 => /usr/lib64/mysql/libmysqlclient.so.18 (0x00007fc8f2f0c000)\n    libpthread.so.0 => /lib64/libpthread.so.0 (0x00007fc8f2ce9000)\n    libz.so.1 => /lib64/libz.so.1 (0x00007fc8f2ad3000)\n    libm.so.6 => /lib64/libm.so.6 (0x00007fc8f27d1000)\n    libssl.so.10 => /usr/lib64/libssl.so.10 (0x00007fc8f2563000)\n    libcrypto.so.10 => /lib64/libcrypto.so.10 (0x00007fc8f217e000)\n    libdl.so.2 => /lib64/libdl.so.2 (0x00007fc8f1f7a000)\n    libcrypt.so.1 => /lib64/libcrypt.so.1 (0x00007fc8f1d42000)\n    libc.so.6 => /lib64/libc.so.6 (0x00007fc8f1981000)\n    librt.so.1 => /lib64/librt.so.1 (0x00007fc8f1779000)\n    libstdc++.so.6 => /usr/lib64/libstdc++.so.6 (0x00007fc8f1474000)\n    libgcc_s.so.1 => /lib64/libgcc_s.so.1 (0x00007fc8f125e000)\n    /lib64/ld-linux-x86-64.so.2 (0x00007fc8f36e8000)\n    libgssapi_krb5.so.2 => /lib64/libgssapi_krb5.so.2 (0x00007fc8f101b000)\n    libkrb5.so.3 => /lib64/libkrb5.so.3 (0x00007fc8f0d35000)\n    libcom_err.so.2 => /usr/lib64/libcom_err.so.2 (0x00007fc8f0b32000)\n    libk5crypto.so.3 => /lib64/libk5crypto.so.3 (0x00007fc8f0907000)\n    libfreebl3.so => /lib64/libfreebl3.so (0x00007fc8f068b000)\n    libkrb5support.so.0 => /lib64/libkrb5support.so.0 (0x00007fc8f0480000)\n    libkeyutils.so.1 => /lib64/libkeyutils.so.1 (0x00007fc8f027d000)\n    libresolv.so.2 => /lib64/libresolv.so.2 (0x00007fc8f0062000)\n    libselinux.so.1 => /usr/lib64/libselinux.so.1 (0x00007fc8efe41000)\n\n\u30a8\u30e9\u30fc\u306e\u518d\u73fe\u3067\u304d\u305f\u3002\u3069\u3046\u3084\u3089\u9001\u4fe1\u3055\u308c\u305f\u30a2\u30d7\u30ea\u306emysql2.so\u306e\u4f9d\u5b58\u95a2\u4fc2\u304c\u304a\u304b\u3057\u3044\u3088\u3046\u3002\ncd /var/www/pj/releases/20150408173738/\nbundle exec irb\n> require 'mysql2'\nLoadError: /usr/lib64/mysql/libmysqlclient.so.18: version `libmysqlclient_16' not found (required by /var/www/pj/shared/bundle/ruby/2.2.0/extensions/x86_64-linux/2.2.0-static/mysql2-0.3.18/mysql2/mysql2.so) - /var/www/pj/shared/bundle/ruby/2.2.0/extensions/x86_64-linux/2.2.0-static/mysql2-0.3.18/mysql2/mysql2.so\n    from /var/www/pj/shared/bundle/ruby/2.2.0/gems/mysql2-0.3.18/lib/mysql2.rb:31:in `require'\n    from /var/www/pj/shared/bundle/ruby/2.2.0/gems/mysql2-0.3.18/lib/mysql2.rb:31:in `<top (required)>'\n    from (irb):1:in `require'\n    from (irb):1\n    from /home/ec2-user/.anyenv/envs/rbenv/versions/2.2.1/bin/irb:11:in `<main>'\n\n\u8a72\u5f53\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u884c\u3063\u3066bundle install\u3057\u305f\u3089\u4e00\u65e6\u30c7\u30d7\u30ed\u30a4\u306e\u30bd\u30fc\u30b9\u81ea\u4f53\u306f\u901a\u904e\n\nnginx\u306e\u30a8\u30e9\u30fc\n$ service nginx restart\nnginx: [alert] could not open error log file: open() \"/var/log/nginx/error.log\" failed (13: Permission denied)\n2015/04/09 03:28:19 [warn] 9363#0: the \"user\" directive makes sense only if the master process runs with super-user privileges, ignored in /etc/nginx/nginx.conf:5\n\n\u6a29\u9650\u3092\u4ed8\u4e0e\u3059\u308b\u304b\u3001\u51fa\u529b\u30ed\u30b0\u4f4d\u7f6e\u3092\u5909\u66f4\u3059\u308b\n\nunicorn\u304c\u8d77\u52d5\u3057\u306a\u3044\n\u30d7\u30ed\u30bb\u30b9\u304c\u306a\u3044\nps aux | grep unicorn\n\u3053\u3053\u306b\u306a\u3044\u306e\u3067unicorn\u306e\u30b3\u30fc\u30c9\u304c\u304a\u304b\u3057\u3044\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308b\u3002\ngem 'capistrano3-unicorn'\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u969b\u306ftasks\u306b\u308f\u3056\u308f\u3056\u66f8\u304b\u306a\u304f\u3066\u3082\u30ea\u30b9\u30bf\u30fc\u30c8\u3055\u308c\u308b\u3002\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u305f\u3089success\u3057\u305f\n\u305f\u3060\u3001\u52d5\u304b\u306a\u304b\u3063\u305f\u306e\u3067\u3001production\u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u3092\u76f4\u66f8\u304d\u3057\u305f\u3089\u52d5\u3044\u305f\u3002\u5f8c\u306f\u3001\u3053\u308c\u3092\u74b0\u5883\u5909\u6570\u5316\u3057\u3066\u547c\u3073\u51fa\u3059\u306a\u3069\u306e\u5bfe\u5fdc\u3092\u3059\u308c\u3070\u3088\u3057\nmysql\u306e\u8a2d\u5b9a\u306f\u5225\u306e\u8a18\u4e8b\u306b\u66f8\u304f\n\n# \u521d\u3081\u306b\nrails\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092aws\u30b5\u30fc\u30d0\u306b\u30c7\u30d7\u30ed\u30a4\u30e1\u30f3\u30c8\u3059\u308b\n\u305f\u3060\u3057\u3001**capistrano,unicorn,nginx**\u3092\u7528\u3044\u3066\u884c\u3046\u3053\u3068\u3068\u3059\u308b\n\u5f53\u7136\u30a8\u30e9\u30fc\u304c\u51fa\u307e\u304f\u308b\u306e\u3067\u3001\u305d\u308c\u306e\u5bfe\u5fdc\u30e1\u30e2\u3002\u5f8c\u3067\u5f79\u306b\u7acb\u3064\u306e\u3067\u4f5c\u696d\u3092\u3082\u3081\u3057\u3066\u304a\u304f\u3002\u305f\u3060\u306e\u500b\u4eba\u7528\u30e1\u30e2\u3067\u3059\u3002\n\n\u521d\u3081\u306b\u3001\u30a8\u30e9\u30fc\u306e\u7d50\u8ad6\u3068\u69cb\u6210\u306b\u3064\u3044\u3066\n\n## \u30a8\u30e9\u30fc\nmysql\u306e\u8a2d\u5b9a\u30a8\u30e9\u30fc\u2192\u7d50\u8ad6\u3001`/etc/my.cnf`\u306e\u8a2d\u5b9a\u30df\u30b9\ncapistrano\u306e\u30c7\u30d7\u30ed\u30a4\u30a8\u30e9\u30fc\u2192\u7d50\u8ad6\u3001\u5bfe\u8c61\u30ea\u30dd\u30b8\u30c8\u30ea\u3067`bundle install`\nnginx\u306e\u30a8\u30e9\u30fc\u2192\u7d50\u8ad6\u3001\u6a29\u9650\u4ed8\u3051\u308b\u3060\u3051\nunicorn\u304c\u8d77\u52d5\u3057\u306a\u3044\u2192secret key\u306e\u8a2d\u5b9a\u6f0f\u308c\n\n## \u69cb\u6210\n\n* rails 4.2.1\n* ruby 2.2.1\n* mysql 5.6\n* aws\n* capistrano\n* nginx\n* unicorn\n\n# \u30a8\u30e9\u30fc\u89e3\u6c7a\u624b\u9806\n\n##mysql2\u306e\u30a8\u30e9\u30fc\n\n```\nMysql2::Error: Can't connect to local MySQL server through socket '/tmp/mysql.sock' (13)\n```\n\n* mysql2\u2192gem\u540d\n* `/tmp/mysql.sock`\u2192\u30bd\u30b1\u30c3\u30c8\u30d1\u30b9\n* MySQL\u30b5\u30fc\u30d0\u306b\u63a5\u7d9a\u3067\u304d\u306a\u3044\n\n###\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\n```database.yml\ndefault: &default\n  adapter: mysql\n  encoding: utf8\n  pool: 5\n  username: root\n  password: password\n  socket: /var/lib/mysql/mysql.sock\n\nproduction:\n  <<: *default\n  database: db\u540d\n  host: \u30db\u30b9\u30c8\u540d:3306\n```\n\n###\u539f\u56e0\n* mysql\u304c\u30b5\u30fc\u30d0\u5074\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u306a\u3044\n* mysql\u30b5\u30fc\u30d0\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u304a\u304b\u3057\u3044\n\n##\u5bfe\u5fdc\uff11\uff1a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u307e\u3067\n\n```.rb\n# \u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u53e4\u3044\u8005\u305f\u3061\u3092\u6d88\u3057\u3066\u3042\u3052\u308b\nrpm -qa | grep -i mysql\n# \u50d5\u306e\u5834\u5408\u306f5.5\u304c\u3044\u305f\u306e\u3067\u3053\u3044\u3064\u3092\u6d88\u3057\u305f\nsudo rpm -e mysql55-common-5.5.42-1.4.amzn1.x86_64\n\n# rpm\u3067\u6700\u65b0\u7248\u306e6.5\u306b\u5408\u308f\u305b\u308b\nsudo rpm -ivh http://dev.mysql.com/get/mysql-community-release-el6-5.noarch.rpm\n\n# \u30d1\u30c3\u30b1\u30fc\u30b8\u60c5\u5831\u3092\u8abf\u3079\u308b\nsudo yum info mysql-community-server\n\n# mysql-community-server\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo yum -y install mysql-community-server\n\n# \u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\u21925.6\u306b\u306a\u3063\u3066\u305f\u3089\u6210\u529f\n$ mysql --version\nmysql  Ver 14.14 Distrib 5.6.24, for Linux (x86_64) using  EditLine wrapper\n$ mysqld --version\nmysqld  Ver 5.6.24 for Linux on x86_64 (MySQL Community Server (GPL))\n```\n\n##\u5bfe\u5fdc\uff12\uff1a\u8a2d\u5b9a\u5468\u308a(A)\n\n```.rb\n# \u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\nsudo chkconfig mysqld on\n\n$ chkconfig | grep mysql\nmysqld         \t0:off\t1:off\t2:on\t3:on\t4:on\t5:on\t6:off\n\n# \u30ea\u30b9\u30bf\u30fc\u30c8\u6642\u306ewarn\u30ec\u30d9\u30eb\u4ee5\u4e0a\n$ sudo service mysqld restart\nStopping mysqld:                                           [  OK  ]\nMySQL Daemon failed to start.\nStarting mysqld:                                           [FAILED]\n\n# 2-1\n[Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).\n\n# 2-2\n[ERROR] Can't open the mysql.plugin table. Please run mysql_upgrade to create it.\n\n# 2-3\n[ERROR] Fatal error: Can't open and lock privilege tables: Table 'mysql.user' doesn't exist\n```\n\n###\u5bfe\u5fdc2-1\uff1a\u975e\u63a8\u5968\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u304c\u3042\u308b\n`/etc/my.cnf`\u3092\u8a2d\u5b9a\u5909\u66f4\u5f8c\u3001\u518d\u5ea6\u30ea\u30b9\u30bf\u30fc\u30c8\u639b\u3051\u308b\u2192\u6a29\u9650\u5468\u308a\u30b9\u30ad\u30c3\u30d7\u3057\u3066\u308b\u306e\u3067\u30a8\u30e9\u30fc\u306f\u5410\u304b\u308c\u308b\u304c\u554f\u984c\u306a\u304f\u8d77\u52d5\u3059\u308b\u306f\u305a\n\n```/etc/my.cnf\n// Please use --explicit_defaults_for_timestamp server option\n\nexplicit_defaults_for_timestamp=1\nskip-grant-tables\n```\n\n###\u5bfe\u5fdc2-2,2-3\uff1a\u6a29\u9650\u5468\u308a\n* \u6a29\u9650\u30c6\u30fc\u30d6\u30eb\u304c\u958b\u3051\u306a\u3044\n* mysql.plugin\u30c6\u30fc\u30d6\u30eb\u304c\u958b\u3051\u306a\u3044\n\n```.sh\n# \u521d\u671f\u30c7\u30fc\u30bf\u3092\u4f5c\u308b\netc/rc.d/init.d/mysqld restart\n\n# root\u6a29\u9650\u3067\u30ed\u30b0\u30a4\u30f3\u3059\u308b\nmysql -u root\n\n# \u30c6\u30fc\u30d6\u30eb\u304c\u4f5c\u3089\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\n> use mysql;\n> show tables;\n\n+---------------------------+\n| Tables_in_mysql           |\n+---------------------------+\n| columns_priv              |\n| db                        |\n| event                     |\n| func                      |\n| general_log               |\n| help_category             |\n| help_keyword              |\n| help_relation             |\n| help_topic                |\n| innodb_index_stats        |\n| innodb_table_stats        |\n| ndb_binlog_index          |\n| plugin                    |\n| proc                      |\n| procs_priv                |\n| proxies_priv              |\n| servers                   |\n| slave_master_info         |\n| slave_relay_log_info      |\n| slave_worker_info         |\n| slow_log                  |\n| tables_priv               |\n| time_zone                 |\n| time_zone_leap_second     |\n| time_zone_name            |\n| time_zone_transition      |\n| time_zone_transition_type |\n| user                      |\n+---------------------------+\n\n# \u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3059\u308b\nset password for root@localhost=password('\u30d1\u30b9\u30ef\u30fc\u30c9');\n\n# mysql\u30c6\u30fc\u30d6\u30eb\u306e\u30c1\u30a7\u30c3\u30af\nmysql_upgrade -u root -p\n\n# mysql -u root\u3067\u306f\u5165\u308c\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u5f8c\u3001\u30ed\u30b0\u30a4\u30f3\nmysql -u root -p\n```\n\n##\u5bfe\u5fdc\uff13\uff1a\u8a2d\u5b9a\u5468\u308a(B)\n\n```.rb\n# 3-1\nLoadError: /usr/lib64/mysql/libmysqlclient.so.18: version `libmysqlclient_16' not found (required by /var/www/pj/shared/bundle/ruby/2.2.0/extensions/x86_64-linux/2.2.0-static/mysql2-0.3.18/mysql2/mysql2.so) - /var/www/pj/shared/bundle/ruby/2.2.0/extensions/x86_64-linux/2.2.0-static/mysql2-0.3.18/mysql2/mysql2.so\n/var/www/pj/shared/bundle/ruby/2.2.0/gems/mysql2-0.3.18/lib/mysql2.rb:31:in `require'\n/var/www/pj/shared/bundle/ruby/2.2.0/gems/mysql2-0.3.18/lib/mysql2.rb:31:in `<top (required)>'\n/var/www/pj/releases/20150407233148/config/application.rb:7:in `<top (required)>'\n/var/www/pj/releases/20150407233148/Rakefile:4:in `require'\n/var/www/pj/releases/20150407233148/Rakefile:4:in `<top (required)>'\n(See full trace by running task with --trace)\n```\n\n###\u5bfe\u5fdc3-1\uff1alibmysqlclient\u5468\u308a\n* libmysqlclient\u306e\u30ed\u30fc\u30c9\u30a8\u30e9\u30fc\n* 16\u3092\u8981\u6c42\u3057\u3066\u3044\u308b\u304c18\u3057\u304b\u306a\u3044\uff1f\n* mysql2\u306f\n\n```.rb\n# \u4e00\u5ea6mysql2\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u307f\u308b\nsudo yum install mysql-devel\ngem install mysql2\n\n# \u691c\u7d22\u3057\u3066\u307f\u308b\nsudo find / -name libmysqlclient_16\n$ ldcondig -p | grep mysql\nlibmysqlclient.so.18 (libc6,x86-64) => /usr/lib64/mysql/libmysqlclient.so.18\nfind ~/.rbenv/versions/2.2.1/ -name 'mysql2.so'\n\n# libmysqlclient.so.18\u4f9d\u5b58\n$ ldd /usr/lib64/mysql/libmysqlclient.so.18\n\tlinux-vdso.so.1 =>  (0x00007ffe9eb2e000)\n\tlibpthread.so.0 => /lib64/libpthread.so.0 (0x00007f14d07f2000)\n\tlibdl.so.2 => /lib64/libdl.so.2 (0x00007f14d05ee000)\n\tlibrt.so.1 => /lib64/librt.so.1 (0x00007f14d03e5000)\n\tlibstdc++.so.6 => /usr/lib64/libstdc++.so.6 (0x00007f14d00e1000)\n\tlibm.so.6 => /lib64/libm.so.6 (0x00007f14cfddf000)\n\tlibgcc_s.so.1 => /lib64/libgcc_s.so.1 (0x00007f14cfbc8000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007f14cf807000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007f14d0fe3000)\n\n# mysql2.so\u4f9d\u5b581\nldd .rbenv/versions/2.2.1/lib/ruby/gems/2.2.0/extensions/x86_64-linux/2.2.0-static/mysql2-0.3.18/mysql2/mysql2.so\nldd .rbenv/versions/2.2.1/lib/ruby/gems/2.2.0/gems/mysql2-0.3.18/ext/mysql2/mysql2.so\nldd .rbenv/versions/2.2.1/lib/ruby/gems/2.2.0/gems/mysql2-0.3.18/lib/mysql2/mysql2.so\n\tlinux-vdso.so.1 =>  (0x00007ffde7bd3000)\n\tlibmysqlclient.so.18 => /usr/lib64/mysql/libmysqlclient.so.18 (0x00007fabb6760000)\n\tlibpthread.so.0 => /lib64/libpthread.so.0 (0x00007fabb653d000)\n\tlibm.so.6 => /lib64/libm.so.6 (0x00007fabb623b000)\n\tlibrt.so.1 => /lib64/librt.so.1 (0x00007fabb6033000)\n\tlibdl.so.2 => /lib64/libdl.so.2 (0x00007fabb5e2e000)\n\tlibcrypt.so.1 => /lib64/libcrypt.so.1 (0x00007fabb5bf7000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007fabb5836000)\n\tlibstdc++.so.6 => /usr/lib64/libstdc++.so.6 (0x00007fabb5531000)\n\tlibgcc_s.so.1 => /lib64/libgcc_s.so.1 (0x00007fabb531b000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007fabb6f3c000)\n\tlibfreebl3.so => /lib64/libfreebl3.so (0x00007fabb50a0000)\n\n# mysql2.so\u4f9d\u5b582\nldd /var/www/pj/shared/bundle/ruby/2.2.0/extensions/x86_64-linux/2.2.0-static/mysql2-0.3.18/mysql2/mysql2.so\n/var/www/pj/shared/bundle/ruby/2.2.0/extensions/x86_64-linux/2.2.0-static/mysql2-0.3.18/mysql2/mysql2.so: /usr/lib64/mysql/libmysqlclient.so.18: version `libmysqlclient_16' not found (required by /var/www/pj/shared/bundle/ruby/2.2.0/extensions/x86_64-linux/2.2.0-static/mysql2-0.3.18/mysql2/mysql2.so)\n\tlinux-vdso.so.1 =>  (0x00007ffe122d4000)\n\tlibmysqlclient.so.18 => /usr/lib64/mysql/libmysqlclient.so.18 (0x00007fc8f2f0c000)\n\tlibpthread.so.0 => /lib64/libpthread.so.0 (0x00007fc8f2ce9000)\n\tlibz.so.1 => /lib64/libz.so.1 (0x00007fc8f2ad3000)\n\tlibm.so.6 => /lib64/libm.so.6 (0x00007fc8f27d1000)\n\tlibssl.so.10 => /usr/lib64/libssl.so.10 (0x00007fc8f2563000)\n\tlibcrypto.so.10 => /lib64/libcrypto.so.10 (0x00007fc8f217e000)\n\tlibdl.so.2 => /lib64/libdl.so.2 (0x00007fc8f1f7a000)\n\tlibcrypt.so.1 => /lib64/libcrypt.so.1 (0x00007fc8f1d42000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007fc8f1981000)\n\tlibrt.so.1 => /lib64/librt.so.1 (0x00007fc8f1779000)\n\tlibstdc++.so.6 => /usr/lib64/libstdc++.so.6 (0x00007fc8f1474000)\n\tlibgcc_s.so.1 => /lib64/libgcc_s.so.1 (0x00007fc8f125e000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007fc8f36e8000)\n\tlibgssapi_krb5.so.2 => /lib64/libgssapi_krb5.so.2 (0x00007fc8f101b000)\n\tlibkrb5.so.3 => /lib64/libkrb5.so.3 (0x00007fc8f0d35000)\n\tlibcom_err.so.2 => /usr/lib64/libcom_err.so.2 (0x00007fc8f0b32000)\n\tlibk5crypto.so.3 => /lib64/libk5crypto.so.3 (0x00007fc8f0907000)\n\tlibfreebl3.so => /lib64/libfreebl3.so (0x00007fc8f068b000)\n\tlibkrb5support.so.0 => /lib64/libkrb5support.so.0 (0x00007fc8f0480000)\n\tlibkeyutils.so.1 => /lib64/libkeyutils.so.1 (0x00007fc8f027d000)\n\tlibresolv.so.2 => /lib64/libresolv.so.2 (0x00007fc8f0062000)\n\tlibselinux.so.1 => /usr/lib64/libselinux.so.1 (0x00007fc8efe41000)\n```\n\n\u30a8\u30e9\u30fc\u306e\u518d\u73fe\u3067\u304d\u305f\u3002\u3069\u3046\u3084\u3089\u9001\u4fe1\u3055\u308c\u305f\u30a2\u30d7\u30ea\u306emysql2.so\u306e\u4f9d\u5b58\u95a2\u4fc2\u304c\u304a\u304b\u3057\u3044\u3088\u3046\u3002\n\n```.rb\ncd /var/www/pj/releases/20150408173738/\nbundle exec irb\n> require 'mysql2'\nLoadError: /usr/lib64/mysql/libmysqlclient.so.18: version `libmysqlclient_16' not found (required by /var/www/pj/shared/bundle/ruby/2.2.0/extensions/x86_64-linux/2.2.0-static/mysql2-0.3.18/mysql2/mysql2.so) - /var/www/pj/shared/bundle/ruby/2.2.0/extensions/x86_64-linux/2.2.0-static/mysql2-0.3.18/mysql2/mysql2.so\n\tfrom /var/www/pj/shared/bundle/ruby/2.2.0/gems/mysql2-0.3.18/lib/mysql2.rb:31:in `require'\n\tfrom /var/www/pj/shared/bundle/ruby/2.2.0/gems/mysql2-0.3.18/lib/mysql2.rb:31:in `<top (required)>'\n\tfrom (irb):1:in `require'\n\tfrom (irb):1\n\tfrom /home/ec2-user/.anyenv/envs/rbenv/versions/2.2.1/bin/irb:11:in `<main>'\n```\n\n\u8a72\u5f53\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u884c\u3063\u3066`bundle install`\u3057\u305f\u3089\u4e00\u65e6\u30c7\u30d7\u30ed\u30a4\u306e\u30bd\u30fc\u30b9\u81ea\u4f53\u306f\u901a\u904e\n\n##nginx\u306e\u30a8\u30e9\u30fc\n\n```.sh\n$ service nginx restart\nnginx: [alert] could not open error log file: open() \"/var/log/nginx/error.log\" failed (13: Permission denied)\n2015/04/09 03:28:19 [warn] 9363#0: the \"user\" directive makes sense only if the master process runs with super-user privileges, ignored in /etc/nginx/nginx.conf:5\n```\n\n\u6a29\u9650\u3092\u4ed8\u4e0e\u3059\u308b\u304b\u3001\u51fa\u529b\u30ed\u30b0\u4f4d\u7f6e\u3092\u5909\u66f4\u3059\u308b\n\n##unicorn\u304c\u8d77\u52d5\u3057\u306a\u3044\n\u30d7\u30ed\u30bb\u30b9\u304c\u306a\u3044\n`ps aux | grep unicorn`\n\u3053\u3053\u306b\u306a\u3044\u306e\u3067unicorn\u306e\u30b3\u30fc\u30c9\u304c\u304a\u304b\u3057\u3044\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308b\u3002\n\n`gem 'capistrano3-unicorn'`\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u969b\u306ftasks\u306b\u308f\u3056\u308f\u3056\u66f8\u304b\u306a\u304f\u3066\u3082\u30ea\u30b9\u30bf\u30fc\u30c8\u3055\u308c\u308b\u3002\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u305f\u3089success\u3057\u305f\n\n\u305f\u3060\u3001\u52d5\u304b\u306a\u304b\u3063\u305f\u306e\u3067\u3001production\u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u3092\u76f4\u66f8\u304d\u3057\u305f\u3089\u52d5\u3044\u305f\u3002\u5f8c\u306f\u3001\u3053\u308c\u3092\u74b0\u5883\u5909\u6570\u5316\u3057\u3066\u547c\u3073\u51fa\u3059\u306a\u3069\u306e\u5bfe\u5fdc\u3092\u3059\u308c\u3070\u3088\u3057\n\n**mysql\u306e\u8a2d\u5b9a\u306f\u5225\u306e\u8a18\u4e8b\u306b\u66f8\u304f**\n", "tags": ["capistrano", "AWS", "nginx", "MySQL5.6", "Rails4.2.1"]}