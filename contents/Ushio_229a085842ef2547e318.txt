{"context": " More than 1 year has passed since last update.\u4eca\u56de\u3082\u7dda\u5f62\u53cd\u5fa9\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u3059\u3002\nNSURLConnection\u3092\u4f55\u5ea6\u304b\u30ea\u30c8\u30e9\u30a4\u8fbc\u307f\u3067\u8a18\u8ff0\u3057\u3066\u307f\u307e\u3059\u3002\n@interface DownloadUtility : NSObject\n+ (void)downloadAndRetryWithURL:(NSURL *)url retryCount:(int)retryCount completion:(void(^)(NSURLResponse *response, NSData *data))completion failue:(void(^)())failure;\n@end\n@implementation DownloadUtility\n+ (void)downloadAndRetryWithURL:(NSURL *)url retryCount:(int)retryCount completion:(void(^)(NSURLResponse *response, NSData *data))completion failue:(void(^)())failure\n{\n    completion = [completion copy];\n    failure = [failure copy];\n\n    NSURLRequest *request = [NSURLRequest requestWithURL:url cachePolicy:NSURLRequestReloadIgnoringCacheData timeoutInterval:5];\n    [NSURLConnection sendAsynchronousRequest:request\n                                       queue:[NSOperationQueue mainQueue]\n                           completionHandler:^(NSURLResponse *response, NSData *data, NSError *error)\n     {\n         if(error)\n         {\n             if(retryCount > 0)\n             {\n                 NSLog(@\"retry\");\n                 [DownloadUtility downloadAndRetryWithURL:url\n                                               retryCount:retryCount - 1\n                                               completion:completion\n                                                   failue:failure];\n             }\n             else\n             {\n                 if(failure)\n                     failure();\n             }\n         }\n         else\n         {\n             if(completion)\n                 completion(response, data);\n         }\n     }];\n}\n@end\n\n\n    //\u547c\u3073\u51fa\u3057\u5074\n    [DownloadUtility downloadAndRetryWithURL:[NSURL URLWithString:@\"http://www.google.co.jp\"]\n                                  retryCount:5\n                                  completion:^(NSURLResponse *response, NSData *data)\n    {\n        NSLog(@\"complete!\");\n    } failue:^{\n        NSLog(@\"failure...\");\n    }];\n\n\u547c\u3073\u51fa\u3057\u5074\u304c\u975e\u5e38\u306b\u30b7\u30f3\u30d7\u30eb\u306b\u306a\u308a\u307e\u3059\u3002\n\u7c21\u5358\u306a\u30d5\u30ed\u30fc\u30c1\u30e3\u30fc\u30c8\u3067\u3059\u3002\n\u305f\u3060\u3053\u306e\u30b3\u30fc\u30c9\u306f\u30d5\u30ed\u30fc\u30c1\u30e3\u30fc\u30c8\u3068\u306e\u4e56\u96e2\u304c\u6fc0\u3057\u3044\u3067\u3059\nhttps://cacoo.com/diagrams/wveKhJQz9S00oIMG\n\u4eca\u56de\u3082\u7dda\u5f62\u53cd\u5fa9\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u3059\u3002\n\nNSURLConnection\u3092\u4f55\u5ea6\u304b\u30ea\u30c8\u30e9\u30a4\u8fbc\u307f\u3067\u8a18\u8ff0\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\n@interface DownloadUtility : NSObject\n+ (void)downloadAndRetryWithURL:(NSURL *)url retryCount:(int)retryCount completion:(void(^)(NSURLResponse *response, NSData *data))completion failue:(void(^)())failure;\n@end\n@implementation DownloadUtility\n+ (void)downloadAndRetryWithURL:(NSURL *)url retryCount:(int)retryCount completion:(void(^)(NSURLResponse *response, NSData *data))completion failue:(void(^)())failure\n{\n    completion = [completion copy];\n    failure = [failure copy];\n    \n    NSURLRequest *request = [NSURLRequest requestWithURL:url cachePolicy:NSURLRequestReloadIgnoringCacheData timeoutInterval:5];\n    [NSURLConnection sendAsynchronousRequest:request\n                                       queue:[NSOperationQueue mainQueue]\n                           completionHandler:^(NSURLResponse *response, NSData *data, NSError *error)\n     {\n         if(error)\n         {\n             if(retryCount > 0)\n             {\n                 NSLog(@\"retry\");\n                 [DownloadUtility downloadAndRetryWithURL:url\n                                               retryCount:retryCount - 1\n                                               completion:completion\n                                                   failue:failure];\n             }\n             else\n             {\n                 if(failure)\n                     failure();\n             }\n         }\n         else\n         {\n             if(completion)\n                 completion(response, data);\n         }\n     }];\n}\n@end\n\n\n    //\u547c\u3073\u51fa\u3057\u5074\n    [DownloadUtility downloadAndRetryWithURL:[NSURL URLWithString:@\"http://www.google.co.jp\"]\n                                  retryCount:5\n                                  completion:^(NSURLResponse *response, NSData *data)\n    {\n        NSLog(@\"complete!\");\n    } failue:^{\n        NSLog(@\"failure...\");\n    }];\n```\n\n\u547c\u3073\u51fa\u3057\u5074\u304c\u975e\u5e38\u306b\u30b7\u30f3\u30d7\u30eb\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u7c21\u5358\u306a\u30d5\u30ed\u30fc\u30c1\u30e3\u30fc\u30c8\u3067\u3059\u3002\n\u305f\u3060\u3053\u306e\u30b3\u30fc\u30c9\u306f\u30d5\u30ed\u30fc\u30c1\u30e3\u30fc\u30c8\u3068\u306e\u4e56\u96e2\u304c\u6fc0\u3057\u3044\u3067\u3059\nhttps://cacoo.com/diagrams/wveKhJQz9S00oIMG", "tags": ["iPhone", "Objective-C", "Cocoa"]}