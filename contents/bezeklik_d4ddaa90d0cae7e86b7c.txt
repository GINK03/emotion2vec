{"context": "Mautic Advent Calendar 2016 \u306e3\u65e5\u76ee\u306e\u8a18\u4e8b\u3068\u3057\u3066\u3001 Mautic \u306e\u30b5\u30fc\u30d0\u30fc\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u691c\u8a0e\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u3061\u3087\u3063\u3068\u76db\u308a\u8fbc\u307f\u3059\u304e\u3066\u5185\u5bb9\u304c\u6563\u6f2b\u304b\u3064\u4e2d\u9014\u534a\u7aef\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u304c\u3001\u30bf\u30a4\u30e0\u30ea\u30df\u30c3\u30c8\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u53c2\u8003\u307e\u3067\u306b\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u74b0\u5883\n\u4ee5\u4e0b\u306e\u74b0\u5883\u3067\u691c\u8a0e\u3057\u307e\u3057\u305f\u3002\n\nVirtualBox 5.0.28\n\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u30e1\u30a4\u30f3\u30e1\u30e2\u30ea\u30fc 2GB\nCentOS 7.2.1511 (minimal)\nApache 2.4.6 (updates)\nMySQL 5.7 (mysql57-community)\nPHP 7.0.13 (remi-php70)\nMautic 2.2.1\n\nMautic \u81ea\u4f53\u306e\u5177\u4f53\u7684\u306a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\u306f\u300c\u30de\u30fc\u30b1\u30c6\u30a3\u30f3\u30b0\u30aa\u30fc\u30c8\u30e1\u30fc\u30b7\u30e7\u30f3\u306e Mautic \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u5bfe\u7b56\nVirtualBox \u4e0a\u306e\u7c21\u5358\u306a\u691c\u8a3c\u3067\u306f\u3001 OPCache + APCu \u3068 mod_deflate \u4ee5\u5916\u306f\u76ee\u7acb\u3063\u305f\u6539\u5584\u304c\u898b\u3089\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u7279\u306b PHP-FPM \u3067\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u6539\u5584\u3057\u306a\u304b\u3063\u305f\u306e\u3067\u5f8c\u3067\u3082\u3046\u5c11\u3057\u691c\u8a3c\u3057\u3066\u307f\u305f\u3044\u3068\u3053\u308d\u3067\u3059\u3002\n\u307e\u305f\u3001\u4ed6\u306b nginx \u3084 Varnish \u3067\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3092\u7528\u610f\u3057\u3066\u3084\u308b\u3068\u3088\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\u8ca0\u8377\u30c6\u30b9\u30c8\n\nSiege\n\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306e\u8ca0\u8377\u30c6\u30b9\u30c8\u30c4\u30fc\u30eb\u3068\u3057\u3066\u3001\u30da\u30fc\u30b8\u5185\u3067\u53c2\u7167\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u3082\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u6295\u3052\u3066\u304f\u308c\u308b Siege \u3092\u5229\u7528\u3057\u307e\u3057\u305f\u3002\u8a73\u7d30\u306f\u300c\u8ca0\u8377\u30c6\u30b9\u30c8\u30c4\u30fc\u30eb Siege\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u3053\u3053\u3067\u306f\u30c6\u30b9\u30c8\u5bfe\u8c61\u3068\u3057\u3066 Mautic \u306e\u30e9\u30f3\u30c7\u30a3\u30f3\u30b0\u30da\u30fc\u30b8 /test \u3092\u4f5c\u6210\u3057\u3001\u5225\u30b5\u30fc\u30d0\u30fc\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f Siege \u304b\u3089\u30c6\u30b9\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\nsiege -c 10 --time=1M http://192.168.56.101/test\n\nTransactions:                    530 hits\nAvailability:                 100.00 %\nElapsed time:                  59.93 secs\nData transferred:              11.18 MB\nResponse time:                  1.08 secs\nTransaction rate:               8.84 trans/sec\nThroughput:                     0.19 MB/sec\nConcurrency:                    9.55\nSuccessful transactions:         470\nFailed transactions:               0\nLongest transaction:            3.92\nShortest transaction:           0.00\n\nsiege -c 50 --time=3M http://192.168.56.101/test\n\nTransactions:                    758 hits\nAvailability:                 100.00 %\nElapsed time:                 179.28 secs\nData transferred:              12.30 MB\nResponse time:                  9.95 secs\nTransaction rate:               4.23 trans/sec\nThroughput:                     0.07 MB/sec\nConcurrency:                   42.06\nSuccessful transactions:         688\nFailed transactions:               0\nLongest transaction:           71.06\nShortest transaction:           0.00\n\n\nCentOS\n\n\u4e0d\u8981\u30b5\u30fc\u30d3\u30b9\u306e\u505c\u6b62\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30b5\u30fc\u30d3\u30b9\u306e\u4e00\u89a7\u304c\u78ba\u8a8d\u51fa\u6765\u307e\u3059\u3002\nsystemctl list-units --type=service\n\n\n\u51fa\u529b\u4f8b\nUNIT                               LOAD   ACTIVE SUB     DESCRIPTION\nauditd.service                     loaded active running Security Auditing Service\ncrond.service                      loaded active running Command Scheduler\ndbus.service                       loaded active running D-Bus System Message Bus\nfirewalld.service                  loaded active running firewalld - dynamic firewall daemon\ngetty@tty1.service                 loaded active running Getty on tty1\nhttpd.service                      loaded active running The Apache HTTP Server\nkdump.service                      loaded active exited  Crash recovery kernel arming\nkmod-static-nodes.service          loaded active exited  Create list of required static device nodes for the current kernel\nlvm2-lvmetad.service               loaded active running LVM2 metadata daemon\nlvm2-monitor.service               loaded active exited  Monitoring of LVM2 mirrors, snapshots etc. using dmeventd or progress polling\nlvm2-pvscan@8:2.service            loaded active exited  LVM2 PV scan on device 8:2\nmysqld.service                     loaded active running MySQL Server\nnetwork.service                    loaded active exited  LSB: Bring up/down networking\nNetworkManager.service             loaded active running Network Manager\npolkit.service                     loaded active running Authorization Manager\npostfix.service                    loaded active running Postfix Mail Transport Agent\npsacct.service                     loaded active exited  Kernel process accounting\nrhel-dmesg.service                 loaded active exited  Dump dmesg to /var/log/dmesg\nrhel-import-state.service          loaded active exited  Import network configuration from initramfs\nrhel-readonly.service              loaded active exited  Configure read-only root support\nrsyslog.service                    loaded active running System Logging Service\nsshd.service                       loaded active running OpenSSH server daemon\nsystemd-journal-flush.service      loaded active exited  Flush Journal to Persistent Storage\nsystemd-journald.service           loaded active running Journal Service\nsystemd-logind.service             loaded active running Login Service\nsystemd-random-seed.service        loaded active exited  Load/Save Random Seed\nsystemd-remount-fs.service         loaded active exited  Remount Root and Kernel File Systems\nsystemd-sysctl.service             loaded active exited  Apply Kernel Variables\nsystemd-tmpfiles-setup-dev.service loaded active exited  Create Static Device Nodes in /dev\nsystemd-tmpfiles-setup.service     loaded active exited  Create Volatile Files and Directories\nsystemd-udev-trigger.service       loaded active exited  udev Coldplug all Devices\nsystemd-udevd.service              loaded active running udev Kernel Device Manager\nsystemd-update-utmp.service        loaded active exited  Update UTMP about System Boot/Shutdown\nsystemd-user-sessions.service      loaded active exited  Permit User Sessions\nsystemd-vconsole-setup.service     loaded active exited  Setup Virtual Console\ntuned.service                      loaded active running Dynamic System Tuning Daemon\nwpa_supplicant.service             loaded active running WPA Supplicant daemon\n\nLOAD   = Reflects whether the unit definition was properly loaded.\nACTIVE = The high-level unit activation state, i.e. generalization of SUB.\nSUB    = The low-level unit activation state, values depend on unit type.\n\n37 loaded units listed. Pass --all to see loaded but inactive units, too.\nTo show all installed unit files use 'systemctl list-unit-files'.\n\n\n\nTuned\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e virtual-guest \u304b\u3089 throughput-performance \u306b\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3057\u3066\u307f\u307e\u3057\u305f\u304c\u3001VirtualBox \u4e0a\u3067\u306f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u5411\u4e0a\u3057\u307e\u305b\u3093\u3067\u3057\u305f\u3002\ntuned-adm list\n\n\n\u51fa\u529b\u4f8b\nAvailable profiles:\n- balanced\n- desktop\n- latency-performance\n- network-latency\n- network-throughput\n- powersave\n- throughput-performance\n- virtual-guest\n- virtual-host\nCurrent active profile: virtual-guest\n\n\ntuned-adm profile throughput-performance\n\n\nApache\n\nMaxRequestWorkers (MaxClients) \u306e\u8abf\u6574\napachetuner.php \u3068\u3044\u3046 MaxRequestWorkers \u9069\u6b63\u5024\u81ea\u52d5\u8a08\u7b97\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\u8fd1\u3044\u3046\u3061\u306b GitHub \u306a\u3069\u3067\u516c\u958b\u3067\u304d\u308c\u3070\u3068\u601d\u3044\u307e\u3059\u3002\nphp apachetuner.php\n\nSiege \u3067\u8ca0\u8377\u3092\u639b\u3051\u3066\u5b9f\u884c\u3057\u305f\u7d50\u679c\u304c\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\u4f59\u88d5\u3092\u898b\u3066 96 \u3042\u305f\u308a\u304c\u7121\u96e3\u3067\u3057\u3087\u3046\u304b\u3002\n\u30ab\u30fc\u30cd\u30eb\u540d:       Linux\n\u30ab\u30fc\u30cd\u30eb\u30d0\u30fc\u30b8\u30e7\u30f3: 3.10.0-327.36.3.el7.x86_64\nApache\u30d0\u30fc\u30b8\u30e7\u30f3:  2.4.6\nApache MPM:      prefork\n\u7269\u7406\u30e1\u30e2\u30ea:        1840.01 MB\n\u5229\u7528\u53ef\u80fd\u30e1\u30e2\u30ea:     964.04 MB\nApache\n \u5168\u30d7\u30ed\u30bb\u30b9\u4f7f\u7528\u30e1\u30e2\u30ea:       429.37 MB\n \u5b50\u30d7\u30ed\u30bb\u30b9\u8d77\u52d5\u6570:         10\n \u89aa\u30d7\u30ed\u30bb\u30b9\u4f7f\u7528\u30e1\u30e2\u30ea:       45.79 MB\n \u5b50\u30d7\u30ed\u30bb\u30b9\u5408\u8a08\u5171\u6709\u30e1\u30e2\u30ea:   383.585 MB\n \u5b50\u30d7\u30ed\u30bb\u30b9\u6700\u5c0f\u5171\u6709\u30e1\u30e2\u30ea:   37.45 MB\n \u5b50\u30d7\u30ed\u30bb\u30b9\u6700\u5927\u975e\u5171\u6709\u30e1\u30e2\u30ea: 8.34 MB (\u89aa\u30d7\u30ed\u30bb\u30b9\u30e1\u30e2\u30ea - \u5b50\u30d7\u30ed\u30bb\u30b9\u6700\u5c0f\u5171\u6709\u30e1\u30e2\u30ea)\n MaxRequestWorkers\u6700\u5927\u5024: 110 (\u4f7f\u7528\u53ef\u80fd\u30e1\u30e2\u30ea / \u5b50\u30d7\u30ed\u30bb\u30b9\u6700\u5927\u975e\u5171\u6709\u30e1\u30e2\u30ea)\n\uff15\uff16\nPID             6388*   8358    8359    8360    22228   22229   22230   22234   22267   22296   22343\nSize            658048  665964  668012  665964  665964  665844  667892  665852  665868  663916  665916\nRss             46888   52324   54552   54752   48988   48884   51036   48928   48904   46928   48872\nPss             20251   15131   17219   17321   13930   13835   15986   13878   13855   11878   13824\nShared          31188   41232   41472   41660   38356   38344   38344   38344   38344   38344   38344\nShared_Ratio    66  78  76  76  78  78  75  78  78  81  78\nShared_Clean    10016   6844    6844    6844    6600    6596    6596    6596    6596    6596    6596\nShared_Dirty    21172   34388   34628   34816   31756   31748   31748   31748   31748   31748   31748\nPrivate         15700   11092   13080   13092   10632   10540   12692   10584   10560   8584    10528\nPrivate_Ratio   33  21  23  23  21  21  24  21  21  18  21\nPrivate_Clean   1428    0   0   0   0   0   0   0   0   0   0\nPrivate_Dirty   14272   11092   13080   13092   10632   10540   12692   10584   10560   8584    10528\nReferenced      42184   45192   47416   47608   41792   41664   43844   41712   41700   39764   41736\nAnonymous       17500   25144   27252   25116   25208   25116   27268   25160   25136   23160   25100\nKernelPageSize  3484    3496    3496    3496    3496    3496    3496    3496    3492    3492    3492\nMMUPageSize     3484    3496    3496    3496    3496    3496    3496    3496    3492    3492    3492\n\n\u8a73\u3057\u304f\u306f\u300cApache \u306e MaxClients \u306e\u9069\u6b63\u5024\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nmod_deflate\nmod_deflate \u3067\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u5727\u7e2e\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f /mtc.js \u304c 129000 bytes \u304b\u3089 43068 bytes \u3068 33% \u7a0b\u5ea6\u3001 /themes/skyline/css/skyline.css \u304c 1605 bytes \u304b\u3089 686 bytes \u3068 43% \u7a0b\u5ea6\u306b\u5727\u7e2e\u3055\u308c\u305f\u3088\u3046\u3067\u3059\u3002\ncat << \"_EOF_\" > /etc/httpd/conf.d/mod_deflate.conf\n<IfModule deflate_module>\n    # \u5727\u7e2e\u7387\u306e\u8a2d\u5b9a\n    DeflateCompressionLevel 1\n    <Location />\n        BrowserMatch ^Mozilla/4 gzip-only-text/html\n        BrowserMatch ^Mozilla/4\\.0[678] no-gzip\n        BrowserMatch \\bMSIE\\s(7|8) !no-gzip !gzip-only-text/html\n\n        # \u753b\u50cf\u7b49\u306f\u518d\u5727\u7e2e\u3055\u305b\u306a\u3044\n        SetEnvIfNoCase Request_URI \\.(?:gif|jpe?g|png|ico)$ no-gzip dont-vary\n\n        # \u30d7\u30ed\u30ad\u30b7\u30b5\u30fc\u30d0\u306b\u5727\u7e2e\u6e08\u307f\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u9001\u4fe1\u3059\u308b\u5bfe\u8c61\u3092\u5236\u9650\n        Header append Vary Accept-Encoding env=!dont-vary\n\n        # \u5727\u7e2e\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u306eMimeType\u3092mod_filter\u3092\u4f7f\u3063\u3066\u6307\u5b9a\n        FilterDeclare Compression CONTENT_SET\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'text/html'\"\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'text/plain'\"\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'text/css'\"\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'text/javascript'\"\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'text/xml'\"\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'application/xhtml'\"\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'application/xml'\"\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'application/xhtml+xml'\"\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'application/rss+xml'\"\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'application/atom+xml'\"\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'application/javascript'\"\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'image/svg-xml'\"\n        FilterChain Compression\n    </Location>\n</IfModule>\n_EOF_\n\n\nMySQL\n\nMySQLTuner\ncurl -sL mysqltuner.pl -o mysqltuner.pl\nperl mysqltuner.pl\n\n\nPHP\n\nZend OPCache + APCu\nPHP \u30a2\u30af\u30bb\u30e9\u30ec\u30fc\u30bf\u30fc\u306e Zend OPCache \u3068 APCu \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nyum install php-opcache php-pecl-apcu\n\n\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306f2\u500d\u3061\u3087\u3063\u3068\u5411\u4e0a\u3059\u308b\u3088\u3046\u3067\u3059\u3002\nTransactions:                   1141 hits\nAvailability:                 100.00 %\nElapsed time:                  59.10 secs\nData transferred:              20.15 MB\nResponse time:                  0.48 secs\nTransaction rate:              19.31 trans/sec\nThroughput:                     0.34 MB/sec\nConcurrency:                    9.32\nSuccessful transactions:         850\nFailed transactions:               0\nLongest transaction:            3.37\nShortest transaction:           0.00\n\n\nphp-fpm\nFPM (FastCGI Process Manager) \u306f PHP \u306e FastCGI \u5b9f\u88c5\u306e\u3072\u3068\u3064\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u307f\u307e\u3059\u3002\nyum install php-fpm\ncat << \"_EOF_\" > /etc/httpd/conf.d/php_fpm.conf\n<FilesMatch \\.php$>\n    SetHandler \"proxy:fcgi://127.0.0.1:9000\"\n</FilesMatch>\n_EOF_\nsystemctl start php-fpm && systemctl enable php-fpm\n\n\u4eca\u56de\u306e\u30b1\u30fc\u30b9\u3067\u306f php-fpm \u3092\u5165\u308c\u308b\u3068\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u4f4e\u4e0b\u3059\u308b\u3088\u3046\u3067\u3059\u3002\nTransactions:                    944 hits\nAvailability:                 100.00 %\nElapsed time:                  59.82 secs\nData transferred:              19.89 MB\nResponse time:                  0.60 secs\nTransaction rate:              15.78 trans/sec\nThroughput:                     0.33 MB/sec\nConcurrency:                    9.41\nSuccessful transactions:         842\nFailed transactions:               0\nLongest transaction:            3.64\nShortest transaction:           0.00\n\n\nMemcached\nyum install memcached php-pecl-memcached\nsed -i '/session.save/s/^;//' /etc/php.d/50-memcached.ini\nsystemctl start memcached && systemctl enable memcached\n\nMautic (Symfony) \u5074\u3067\u8a2d\u5b9a\u304c\u4e0a\u66f8\u304d\u3055\u308c\u3066 Memcached \u3092\u4f7f\u3063\u3066\u304f\u308c\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3001\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u4f4e\u4e0b\u3057\u307e\u3059\u3002config.yml \u3082\u898b\u5f53\u305f\u3089\u306a\u3044\u306e\u3067\u4eca\u56de\u306f\u65ad\u5ff5\u3057\u307e\u3059\u3002\nTransactions:                    943 hits\nAvailability:                 100.00 %\nElapsed time:                  59.14 secs\nData transferred:              19.78 MB\nResponse time:                  0.59 secs\nTransaction rate:              15.95 trans/sec\nThroughput:                     0.33 MB/sec\nConcurrency:                    9.44\nSuccessful transactions:         843\nFailed transactions:               0\nLongest transaction:            3.39\nShortest transaction:           0.00\n\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5bfe\u7b56\u3092\u884c\u3046\u3068\u3069\u3046\u3057\u3066\u3082\u30b5\u30fc\u30d0\u30fc\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306f\u843d\u3061\u308b\u306e\u3067\u3001\u7121\u7406\u306b\u5168\u3066\u3092\u30b5\u30fc\u30d0\u30fc\u306a\u3044\u3067\u884c\u308f\u306a\u304f\u3066\u3082\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\nCentOS\n\n\u5404\u7a2e\u8a2d\u5b9a\nLynis \u3067\u30b5\u30b8\u30a7\u30b9\u30c8\u3055\u308c\u308b\u5185\u5bb9\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5bfe\u5fdc\u3057\u307e\u3059\u3002\n\u8a73\u7d30\u306f\u300cLinux\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u76e3\u67fb\u30c4\u30fc\u30eb Lynis\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nsed -i.org \"s/#smtpd_banner = \\$myhostname ESMTP \\$mail_name$/smtpd_banner = \\$myhostname ESMTP/\" /etc/postfix/main.cf\nsed -i.org 's/PASS_MIN_DAYS\\t0/PASS_MIN_DAYS\\t1/' /etc/login.defs\nsed -i 's/PASS_MAX_DAYS\\t99999/PASS_MAX_DAYS\\t3650/' /etc/login.defs\nsed -i.org \"s/umask 002/umask 027/\" /etc/profile\nsed -i \"s/umask 022/umask 027/\" /etc/profile\necho \"blacklist usb-storage\" > /etc/modprobe.d/blacklist-usbstorage.conf\necho \"blacklist firewire_core\" > /etc/modprobe.d/blacklist-firewire.conf\necho \"blacklist firewire_ohci\" >> /etc/modprobe.d/blacklist-firewire.conf\nsed -i '/::1/s/^/#/' /etc/hosts\nyum install yum-utils arpwatch psacct sysstat\nsystemctl enable arpwatch psacct && systemctl start arpwatch psacct\nsed -i.org 's/#AllowTcpForwarding yes/AllowTcpForwarding no/' /etc/ssh/sshd_config\nsed -i 's/#ClientAliveCountMax 3/ClientAliveCountMax 2/' /etc/ssh/sshd_config\nsed -i 's/#Compression delayed/Compression no/' /etc/ssh/sshd_config\nsed -i 's/#LogLevel INFO/LogLevel VERBOSE/' /etc/ssh/sshd_config\nsed -i 's/#MaxAuthTries 6/MaxAuthTries 1/' /etc/ssh/sshd_config\nsed -i 's/#MaxSessions 10/MaxSessions 2/' /etc/ssh/sshd_config\nsed -i 's/#PermitRootLogin yes/PermitRootLogin no/' /etc/ssh/sshd_config\nsed -i 's/#Port 22/Port 10022/' /etc/ssh/sshd_config\nsed -i 's/#TCPKeepAlive yes/TCPKeepAlive no/' /etc/ssh/sshd_config\nsed -i 's/#UseDNS yes/UseDNS no/' /etc/ssh/sshd_config\nsed -i 's/X11Forwarding yes/X11Forwarding no/' /etc/ssh/sshd_config\nsed -i 's/#AllowAgentForwarding yes/AllowAgentForwarding no/' /etc/ssh/sshd_config\n(echo; echo \"Unauthorized access to this machine is prohibited.\"; echo \"Disconnect now if you are not an authorized user.\"; echo) > /etc/issue\n(echo; echo \"Unauthorized access to this machine is prohibited.\"; echo \"Disconnect now if you are not an authorized user.\"; echo) > /etc/issue.net\nlynis --quick --verbose --tests KRNL-6000\ngrep \"different value\" /var/log/lynis.log | awk '{ gsub(\"Expected\",\"\"); gsub(\",\",\"\"); print $6 $16 }'\ngrep \"different value\" /var/log/lynis.log | awk '{ gsub(\"Expected\",\"\"); gsub(\",\",\"\"); print $6 $16 }' >> /etc/sysctl.conf\nsysctl -p\nlynis --quick --verbose --tests HRDN-7222\ngrep \"world executable\" /var/log/lynis.log | awk '{ print $5 }' | xargs ls -l\ngrep \"world executable\" /var/log/lynis.log | awk '{ print $5 }' | xargs chmod 700\nyum install epel-release && yum update\nyum install rkhunter unhide\nrkhunter -c --rwo --sk\n\n\nFail2ban\n\u30d6\u30eb\u30fc\u30c8\u30d5\u30a9\u30fc\u30b9\u653b\u6483\u5bfe\u7b56\u306b Fail2ban \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u8a73\u7d30\u306f\u300c\u30d6\u30eb\u30fc\u30c8\u30d5\u30a9\u30fc\u30b9\u653b\u6483\u5bfe\u7b56 Fail2ban\u300d\u3084\u300cDoS\u653b\u6483/\u30d6\u30eb\u30fc\u30c8\u30d5\u30a9\u30fc\u30b9\u653b\u6483\u5bfe\u7b56\u30a2\u30d7\u30ea\u306e\u8fd1\u6cc1\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nNIDS\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u578b\u4fb5\u5165\u691c\u77e5\u30b7\u30b9\u30c6\u30e0 (NIDS) \u3068\u3057\u3066 Suricata \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nHIDS\n\u30db\u30b9\u30c8\u578b\u4fb5\u5165\u691c\u77e5\u30b7\u30b9\u30c6\u30e0 (HIDS) \u3068\u3057\u3066 OSSEC \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u8a73\u7d30\u306f\u300c\u30d5\u30a1\u30a4\u30eb\u6539\u3056\u3093\u691c\u77e5\u30c4\u30fc\u30eb OSSEC\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nApache\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb (conf)\n\u8a73\u3057\u304f\u306f\u300cApache\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\ncat /dev/null > /etc/httpd/conf.d/autoindex.conf\ncat /dev/null > /etc/httpd/conf.d/welcome.conf\n\ncat << _EOF_ > /etc/httpd/conf.d/security.conf\n# \u30d0\u30fc\u30b8\u30e7\u30f3\u60c5\u5831\u306e\u96a0\u853d\nServerTokens Prod \nHeader unset X-Powered-By\n# httpoxy \u5bfe\u7b56\nRequestHeader unset Proxy\n# \u30af\u30ea\u30c3\u30af\u30b8\u30e3\u30c3\u30ad\u30f3\u30b0\u5bfe\u7b56\nHeader append X-Frame-Options SAMEORIGIN\n# XSS\u5bfe\u7b56\nHeader set X-XSS-Protection \"1; mode=block\"\nHeader set X-Content-Type-Options nosniff\n# XST\u5bfe\u7b56\nTraceEnable Off\n\n<Directory /var/www/html>\n    # .htaccess \u306e\u6709\u52b9\u5316\n    AllowOverride All\n    # \u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u51fa\u529b\u306e\u7981\u6b62\n    Options -Indexes\n    # Apache 2.2\u4ee5\u524d\u306e\u5bfe\u7b56\n    <IfVersion < 2.3>\n        # \u30d0\u30fc\u30b8\u30e7\u30f3\u60c5\u5831\u306e\u96a0\u853d\n        ServerSignature Off\n        # ETag\u306einode\u60c5\u5831\u306e\u96a0\u853d\n        FileETag MTime Size\n    </IfVersion>\n</Directory>\n_EOF_\n\ncat << _EOF_ > /etc/httpd/conf.d/security_strict.conf\n# DoS \u653b\u6483\u5bfe\u7b56\nLimitRequestBody 10485760\nLimitRequestFields 20\n# slowloris \u5bfe\u7b56\nRequestReadTimeout header=20-40,MinRate=500 body=20,MinRate=500\n\n<Directory /var/www/html>\n    # HTTP\u30e1\u30bd\u30c3\u30c9\u306e\u5236\u9650\n    <IfVersion > 2.4>\n        Require method GET POST\n    </IfVersion>\n    <IfVersion < 2.3>\n        <Limit GET POST>\n            Order allow,deny\n            Allow from all\n        </Limit>\n        <LimitExcept GET POST>\n            Order deny,allow\n            Deny from all\n        </LimitExcept>\n    </IfVersion>\n</Directory>\n_EOF_\n\n\nmod_evasive\n\u8a73\u3057\u304f\u306f\u300cDoS\u653b\u6483\u5bfe\u7b56\u30e2\u30b8\u30e5\u30fc\u30eb mod_evasive\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nmod_qos\n\u8a73\u3057\u304f\u306f\u300c\u5e2f\u57df\u5236\u9650\u30e2\u30b8\u30e5\u30fc\u30eb mod_qos\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nModSecurity (mod_security)\nWAF \u3068\u3057\u3066 ModSecurity \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u8a73\u3057\u304f\u306f\u300c\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9WAF ModSecurity\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\ncat << \"_EOF_\" >> /etc/httpd/conf.d/mod_security_rule_mautic.conf\nSecRuleRemoveById 950911\nSecRuleRemoveById 981173\nSecRuleRemoveById 981242\nSecRuleRemoveById 981243\nSecRuleRemoveById 981245\nSecRuleRemoveById 981257\n_EOF_\n\n\nMySQL\n\nmysql_secure_installation\nmysql_secure_installation \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5bfe\u7b56\u3068\u3057\u3066\u4ee5\u4e0b\u306e\u5185\u5bb9\u3092\u5b9f\u65bd\u3067\u304d\u307e\u3059\u3002\n\nroot \u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\n\u533f\u540d\u30e6\u30fc\u30b6\u30fc\u306e\u524a\u9664\n\u30ea\u30e2\u30fc\u30c8\u304b\u3089\u306e root \u30e6\u30fc\u30b6\u30fc\u3067\u306e\u30ed\u30b0\u30a4\u30f3\u7981\u6b62\ntest \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u524a\u9664\n\u7279\u6a29\u30c6\u30fc\u30d6\u30eb\u306e\u30ea\u30ed\u30fc\u30c9\n\nSecuring the MySQL server deployment.\n\nEnter password for user root:\n\nThe existing password for the user account root has expired. Please set a new password.\n\nNew password:\n\nRe-enter new password:\nThe 'validate_password' plugin is installed on the server.\nThe subsequent steps will run with the existing configuration\nof the plugin.\nUsing existing password for root.\n\nEstimated strength of the password: 100\nChange the password for root ? ((Press y|Y for Yes, any other key for No) : # 100\u306a\u3089\u7a7a\u30a8\u30f3\u30bf\u30fc\n\n ... skipping.\nBy default, a MySQL installation has an anonymous user,\nallowing anyone to log into MySQL without having to have\na user account created for them. This is intended only for\ntesting, and to make the installation go a bit smoother.\nYou should remove them before moving into a production\nenvironment.\n\nRemove anonymous users? (Press y|Y for Yes, any other key for No) : y # \u533f\u540d\u30e6\u30fc\u30b6\u30fc\u306e\u524a\u9664\nSuccess.\n\n\nNormally, root should only be allowed to connect from\n'localhost'. This ensures that someone cannot guess at\nthe root password from the network.\n\nDisallow root login remotely? (Press y|Y for Yes, any other key for No) : y # \u30ea\u30e2\u30fc\u30c8root\u30ed\u30b0\u30a4\u30f3\u7981\u6b62\nSuccess.\n\nBy default, MySQL comes with a database named 'test' that\nanyone can access. This is also intended only for testing,\nand should be removed before moving into a production\nenvironment.\n\n\nRemove test database and access to it? (Press y|Y for Yes, any other key for No) : y # test\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u524a\u9664\n - Dropping test database...\nSuccess.\n\n - Removing privileges on test database...\nSuccess.\n\nReloading the privilege tables will ensure that all changes\nmade so far will take effect immediately.\n\nReload privilege tables now? (Press y|Y for Yes, any other key for No) : y # \u7279\u6a29\u30c6\u30fc\u30d6\u30eb\u306e\u30ea\u30ed\u30fc\u30c9\nSuccess.\n\nAll done!\n\n\nPHP\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\u8a73\u7d30\u306f\u8ffd\u3063\u3066\u5225\u306e\u8a18\u4e8b\u306b\u307e\u3068\u3081\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3067\u591a\u5c11\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u843d\u3061\u307e\u3059\u3002\ncat << _EOF_ > /etc/php.d/99-security.ini\ndate.timezone = Asia/Tokyo           ; \u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u306e\u8a2d\u5b9a (\u30c7\u30d5\u30a9\u30eb\u30c8: GMT) PHP 5.1.0 ~\ndisplay_errors = Off                 ; \u30a8\u30e9\u30fc\u51fa\u529b (\u30c7\u30d5\u30a9\u30eb\u30c8: 1)\nenable_dl = Off                      ; dl()\u306e\u7981\u6b62 (\u30c7\u30d5\u30a9\u30eb\u30c8: 1)\nexpose_php = Off                     ; HTTP\u30d8\u30c3\u30c0\u306ePHP\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u975e\u8868\u793a (\u30c7\u30d5\u30a9\u30eb\u30c8: 1)\nlog_errors_max_len = 4096            ; \u30a8\u30e9\u30fc\u30ed\u30b0\u306e\u51fa\u529b\u5236\u9650\u306e\u62e1\u5927 (\u30c7\u30d5\u30a9\u30eb\u30c8: 1024)\nsession.cookie_httponly = On         ; JavaScript\u306eCookie\u8aad\u307f\u8fbc\u307f\u7981\u6b62 (\u30c7\u30d5\u30a9\u30eb\u30c8: \"\")\nsession.hash_function = sha512       ; \u30bb\u30c3\u30b7\u30e7\u30f3ID\u751f\u6210\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u5f37\u5316 (\u30c7\u30d5\u30a9\u30eb\u30c8: 0)\nsession.hash_bits_per_character = 6  ; \u30bb\u30c3\u30b7\u30e7\u30f3ID\u306e\u4f7f\u7528\u53ef\u80fd\u6587\u5b57\u3092\u5897\u3084\u3059 (\u30c7\u30d5\u30a9\u30eb\u30c8: 4)\n_EOF_\n\ncat << _EOF_ > /etc/php.d/99-security-encoding.ini\ndefault_charset = UTF-8\noutput_buffering = Off\nmbstring.encoding_translation = On\nmbstring.http_input = UTF-8\nmbstring.http_output = pass\nmbstring.internal_encoding = UTF-8\nmbstring.language = Japanese\nmbstring.substitute_character = \"?\"\n_EOF_\n\ncat << \"_EOF_\" > /etc/php.d/99-security-strict.ini\n; \u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n;file_uploads = Off                   ; HTTP \u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9 (\u30c7\u30d5\u30a9\u30eb\u30c8: 1)\nmax_file_uploads = 1                 ; \u540c\u6642\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u30d5\u30a1\u30a4\u30eb\u6700\u5927\u6570 (\u30c7\u30d5\u30a9\u30eb\u30c8: 20)\n\n; \u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\ndefault_socket_timeout = 20          ;  (\u30c7\u30d5\u30a9\u30eb\u30c8: 60)\nmax_execution_time = 20              ; 1\u30ea\u30af\u30a8\u30b9\u30c8\u3042\u305f\u308a\u306e\u6700\u5927\u5b9f\u884c\u6642\u9593\uff08\u79d2\uff09 (\u30c7\u30d5\u30a9\u30eb\u30c8: 30)\nmax_input_time = 20                  ;  (\u30c7\u30d5\u30a9\u30eb\u30c8: -1)\n\n; \u4e0a\u9650\u8a2d\u5b9a\nmax_input_nesting_level = 10         ; (\u30c7\u30d5\u30a9\u30eb\u30c8: 64)\nmax_input_vars = 100                 ; (\u30c7\u30d5\u30a9\u30eb\u30c8: 1000)\nmemory_limit = 64M                   ; 1\u30ea\u30af\u30a8\u30b9\u30c8\u3042\u305f\u308a\u306e\u6700\u5927\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf (\u30c7\u30d5\u30a9\u30eb\u30c8: 128M)\npost_max_size = 4M                   ; POST\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u8a31\u5bb9\u30b5\u30a4\u30ba (\u30c7\u30d5\u30a9\u30eb\u30c8: 8M)\nupload_max_filesize = 1M             ; \u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306e\u8a31\u5bb9\u30b5\u30a4\u30ba (\u30c7\u30d5\u30a9\u30eb\u30c8: 2M)\n\nmbstring.strict_detection = On       ; \u53b3\u683c\u306a\u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u691c\u51fa (\u30c7\u30d5\u30a9\u30eb\u30c8: 0)\n;session.cookie_secure = 1            ; (\u30c7\u30d5\u30a9\u30eb\u30c8: \"\")\nopen_basedir = /usr/share/:/var/www/ ; (\u30c7\u30d5\u30a9\u30eb\u30c8: NULL)\nallow_url_fopen = Off                ;  (\u30c7\u30d5\u30a9\u30eb\u30c8: 1)\nallow_url_include = Off              ;  (\u30c7\u30d5\u30a9\u30eb\u30c8: 0) PHP 5.2.0 ~\ndisable_functions = phpinfo,eval     ; \u6307\u5b9a\u30b7\u30b9\u30c6\u30e0\u95a2\u6570\u306e\u7981\u6b62 (\u30c7\u30d5\u30a9\u30eb\u30c8: \"\")\nsession.name = SECUREID              ;  (\u30c7\u30d5\u30a9\u30eb\u30c8: PHPSESSID)\n_EOF_\n\n\nSuhosin\nRemi \u30ea\u30dd\u30b8\u30c8\u30ea\u30fc\u3067\u306f PHP \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5f37\u5316\u30e2\u30b8\u30e5\u30fc\u30eb\u306e Suhosin \u304c\u30d1\u30c3\u30b1\u30fc\u30b8\u5316\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3053\u308c\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u305f\u3060\u3057 PHP 7.x \u7528\u306e suhosin7 \u306e README \u306b\u306f\u3001\u30d7\u30ec\u30a2\u30eb\u30d5\u30a1\u7248\u306a\u306e\u3067\u672c\u756a\u74b0\u5883\u3067\u306f\u4f7f\u7528\u3057\u306a\u3044\u3088\u3046\u306b\u3068\u306e\u6ce8\u610f\u66f8\u304d\u304c\u3042\u308a\u307e\u3059\u3002\n\u4ee5\u4e0b\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u5024\u3067\u3059\u3002\nsuhosin.cookie.checkraddr => 0 => 0\nsuhosin.cookie.cryptdocroot => On => On\nsuhosin.cookie.cryptkey => [ protected ] => [ protected ]\nsuhosin.cookie.cryptlist => no value => no value\nsuhosin.cookie.cryptraddr => 0 => 0\nsuhosin.cookie.cryptua => On => On\nsuhosin.cookie.disallow_nul => 1 => 1\nsuhosin.cookie.disallow_ws => 1 => 1\nsuhosin.cookie.encrypt => Off => Off\nsuhosin.cookie.max_array_depth => 50 => 50\nsuhosin.cookie.max_array_index_length => 64 => 64\nsuhosin.cookie.max_name_length => 64 => 64\nsuhosin.cookie.max_totalname_length => 256 => 256\nsuhosin.cookie.max_value_length => 10000 => 10000\nsuhosin.cookie.max_vars => 100 => 100\nsuhosin.cookie.plainlist => no value => no value\nsuhosin.coredump => Off => Off\nsuhosin.disable.display_errors => Off => Off\nsuhosin.executor.allow_symlink => Off => Off\nsuhosin.executor.disable_emodifier => Off => Off\nsuhosin.executor.eval.blacklist => no value => no value\nsuhosin.executor.eval.whitelist => no value => no value\nsuhosin.executor.func.blacklist => no value => no value\nsuhosin.executor.func.whitelist => no value => no value\nsuhosin.executor.include.allow_writable_files => On => On\nsuhosin.executor.include.blacklist => no value => no value\nsuhosin.executor.include.max_traversal => 0 => 0\nsuhosin.executor.include.whitelist => no value => no value\nsuhosin.executor.max_depth => 750 => 750\nsuhosin.get.disallow_nul => 1 => 1\nsuhosin.get.disallow_ws => 0 => 0\nsuhosin.get.max_array_depth => 50 => 50\nsuhosin.get.max_array_index_length => 64 => 64\nsuhosin.get.max_name_length => 64 => 64\nsuhosin.get.max_totalname_length => 256 => 256\nsuhosin.get.max_value_length => 512 => 512\nsuhosin.get.max_vars => 100 => 100\nsuhosin.log.file => 0 => 0\nsuhosin.log.file.name => no value => no value\nsuhosin.log.file.time => On => On\nsuhosin.log.sapi => 0 => 0\nsuhosin.log.stdout => 0 => 0\nsuhosin.log.use-x-forwarded-for => Off => Off\nsuhosin.memory_limit => 0 => 0\nsuhosin.mt_srand.ignore => On => On\nsuhosin.multiheader => Off => Off\nsuhosin.perdir => 0 => 0\nsuhosin.post.disallow_nul => 1 => 1\nsuhosin.post.disallow_ws => 0 => 0\nsuhosin.post.max_array_depth => 50 => 50\nsuhosin.post.max_array_index_length => 64 => 64\nsuhosin.post.max_name_length => 64 => 64\nsuhosin.post.max_totalname_length => 256 => 256\nsuhosin.post.max_value_length => 1000000 => 1000000\nsuhosin.post.max_vars => 1000 => 1000\nsuhosin.protectkey => On => On\nsuhosin.rand.reseed_every_request => Off => Off\nsuhosin.rand.seedingkey => [ protected ] => [ protected ]\nsuhosin.request.array_index_char_blacklist => '\"+<>;() => '\"+<>;()\nsuhosin.request.array_index_char_whitelist => no value => no value\nsuhosin.request.disallow_nul => 1 => 1\nsuhosin.request.disallow_ws => 0 => 0\nsuhosin.request.max_array_depth => 50 => 50\nsuhosin.request.max_array_index_length => 64 => 64\nsuhosin.request.max_totalname_length => 256 => 256\nsuhosin.request.max_value_length => 1000000 => 1000000\nsuhosin.request.max_varname_length => 64 => 64\nsuhosin.request.max_vars => 1000 => 1000\nsuhosin.server.encode => On => On\nsuhosin.server.strip => On => On\nsuhosin.session.checkraddr => 0 => 0\nsuhosin.session.cryptdocroot => On => On\nsuhosin.session.cryptkey => [ protected ] => [ protected ]\nsuhosin.session.cryptraddr => 0 => 0\nsuhosin.session.cryptua => Off => Off\nsuhosin.session.encrypt => On => On\nsuhosin.session.max_id_length => 128 => 128\nsuhosin.simulation => Off => Off\nsuhosin.srand.ignore => On => On\n\n\u4e0a\u624b\u304f\u3044\u304b\u306a\u3044\u5834\u5408\u306f\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u306b\u5909\u66f4\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\ncat << \"_EOF_\" >> /etc/php.d/40-suhosin7.ini\nsuhosin.simulation = On\n_EOF_\n\n\u8a73\u3057\u304f\u306f\u300cPHP\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5f37\u5316\u30e2\u30b8\u30e5\u30fc\u30eb Suhosin\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n[Mautic Advent Calendar 2016](http://www.adventar.org/calendars/1402) \u306e3\u65e5\u76ee\u306e\u8a18\u4e8b\u3068\u3057\u3066\u3001 **Mautic** \u306e\u30b5\u30fc\u30d0\u30fc\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u691c\u8a0e\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u3061\u3087\u3063\u3068\u76db\u308a\u8fbc\u307f\u3059\u304e\u3066\u5185\u5bb9\u304c\u6563\u6f2b\u304b\u3064\u4e2d\u9014\u534a\u7aef\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u304c\u3001\u30bf\u30a4\u30e0\u30ea\u30df\u30c3\u30c8\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u53c2\u8003\u307e\u3067\u306b\u3002\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u74b0\u5883\n\u4ee5\u4e0b\u306e\u74b0\u5883\u3067\u691c\u8a0e\u3057\u307e\u3057\u305f\u3002\n\n* VirtualBox 5.0.28\n* \u4eee\u60f3\u30de\u30b7\u30f3\u306e\u30e1\u30a4\u30f3\u30e1\u30e2\u30ea\u30fc 2GB\n* CentOS 7.2.1511 (minimal)\n* Apache 2.4.6 (updates)\n* MySQL 5.7 (mysql57-community)\n\n* PHP 7.0.13 (remi-php70)\n* Mautic 2.2.1\n\nMautic \u81ea\u4f53\u306e\u5177\u4f53\u7684\u306a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\u306f\u300c[\u30de\u30fc\u30b1\u30c6\u30a3\u30f3\u30b0\u30aa\u30fc\u30c8\u30e1\u30fc\u30b7\u30e7\u30f3\u306e Mautic \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b](http://qiita.com/bezeklik/items/3cd61156367909e31421)\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n# \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u5bfe\u7b56\nVirtualBox \u4e0a\u306e\u7c21\u5358\u306a\u691c\u8a3c\u3067\u306f\u3001 OPCache + APCu \u3068 mod_deflate \u4ee5\u5916\u306f\u76ee\u7acb\u3063\u305f\u6539\u5584\u304c\u898b\u3089\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u7279\u306b PHP-FPM \u3067\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u6539\u5584\u3057\u306a\u304b\u3063\u305f\u306e\u3067\u5f8c\u3067\u3082\u3046\u5c11\u3057\u691c\u8a3c\u3057\u3066\u307f\u305f\u3044\u3068\u3053\u308d\u3067\u3059\u3002\n\u307e\u305f\u3001\u4ed6\u306b nginx \u3084 Varnish \u3067\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3092\u7528\u610f\u3057\u3066\u3084\u308b\u3068\u3088\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n## \u8ca0\u8377\u30c6\u30b9\u30c8\n### Siege\n\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306e\u8ca0\u8377\u30c6\u30b9\u30c8\u30c4\u30fc\u30eb\u3068\u3057\u3066\u3001\u30da\u30fc\u30b8\u5185\u3067\u53c2\u7167\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u3082\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u6295\u3052\u3066\u304f\u308c\u308b Siege \u3092\u5229\u7528\u3057\u307e\u3057\u305f\u3002\u8a73\u7d30\u306f\u300c[\u8ca0\u8377\u30c6\u30b9\u30c8\u30c4\u30fc\u30eb Siege](http://qiita.com/bezeklik/items/79f806174fb99302a64a)\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u3053\u3053\u3067\u306f\u30c6\u30b9\u30c8\u5bfe\u8c61\u3068\u3057\u3066 Mautic \u306e\u30e9\u30f3\u30c7\u30a3\u30f3\u30b0\u30da\u30fc\u30b8 /test \u3092\u4f5c\u6210\u3057\u3001\u5225\u30b5\u30fc\u30d0\u30fc\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f Siege \u304b\u3089\u30c6\u30b9\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\n\n```bash\nsiege -c 10 --time=1M http://192.168.56.101/test\n```\n```\nTransactions:                    530 hits\nAvailability:                 100.00 %\nElapsed time:                  59.93 secs\nData transferred:              11.18 MB\nResponse time:                  1.08 secs\nTransaction rate:               8.84 trans/sec\nThroughput:                     0.19 MB/sec\nConcurrency:                    9.55\nSuccessful transactions:         470\nFailed transactions:               0\nLongest transaction:            3.92\nShortest transaction:           0.00\n```\n\n```bash\nsiege -c 50 --time=3M http://192.168.56.101/test\n```\n```\nTransactions:                    758 hits\nAvailability:                 100.00 %\nElapsed time:                 179.28 secs\nData transferred:              12.30 MB\nResponse time:                  9.95 secs\nTransaction rate:               4.23 trans/sec\nThroughput:                     0.07 MB/sec\nConcurrency:                   42.06\nSuccessful transactions:         688\nFailed transactions:               0\nLongest transaction:           71.06\nShortest transaction:           0.00\n```\n\n## CentOS\n### \u4e0d\u8981\u30b5\u30fc\u30d3\u30b9\u306e\u505c\u6b62\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30b5\u30fc\u30d3\u30b9\u306e\u4e00\u89a7\u304c\u78ba\u8a8d\u51fa\u6765\u307e\u3059\u3002\n\n```bash\nsystemctl list-units --type=service\n```\n```text:\u51fa\u529b\u4f8b\nUNIT                               LOAD   ACTIVE SUB     DESCRIPTION\nauditd.service                     loaded active running Security Auditing Service\ncrond.service                      loaded active running Command Scheduler\ndbus.service                       loaded active running D-Bus System Message Bus\nfirewalld.service                  loaded active running firewalld - dynamic firewall daemon\ngetty@tty1.service                 loaded active running Getty on tty1\nhttpd.service                      loaded active running The Apache HTTP Server\nkdump.service                      loaded active exited  Crash recovery kernel arming\nkmod-static-nodes.service          loaded active exited  Create list of required static device nodes for the current kernel\nlvm2-lvmetad.service               loaded active running LVM2 metadata daemon\nlvm2-monitor.service               loaded active exited  Monitoring of LVM2 mirrors, snapshots etc. using dmeventd or progress polling\nlvm2-pvscan@8:2.service            loaded active exited  LVM2 PV scan on device 8:2\nmysqld.service                     loaded active running MySQL Server\nnetwork.service                    loaded active exited  LSB: Bring up/down networking\nNetworkManager.service             loaded active running Network Manager\npolkit.service                     loaded active running Authorization Manager\npostfix.service                    loaded active running Postfix Mail Transport Agent\npsacct.service                     loaded active exited  Kernel process accounting\nrhel-dmesg.service                 loaded active exited  Dump dmesg to /var/log/dmesg\nrhel-import-state.service          loaded active exited  Import network configuration from initramfs\nrhel-readonly.service              loaded active exited  Configure read-only root support\nrsyslog.service                    loaded active running System Logging Service\nsshd.service                       loaded active running OpenSSH server daemon\nsystemd-journal-flush.service      loaded active exited  Flush Journal to Persistent Storage\nsystemd-journald.service           loaded active running Journal Service\nsystemd-logind.service             loaded active running Login Service\nsystemd-random-seed.service        loaded active exited  Load/Save Random Seed\nsystemd-remount-fs.service         loaded active exited  Remount Root and Kernel File Systems\nsystemd-sysctl.service             loaded active exited  Apply Kernel Variables\nsystemd-tmpfiles-setup-dev.service loaded active exited  Create Static Device Nodes in /dev\nsystemd-tmpfiles-setup.service     loaded active exited  Create Volatile Files and Directories\nsystemd-udev-trigger.service       loaded active exited  udev Coldplug all Devices\nsystemd-udevd.service              loaded active running udev Kernel Device Manager\nsystemd-update-utmp.service        loaded active exited  Update UTMP about System Boot/Shutdown\nsystemd-user-sessions.service      loaded active exited  Permit User Sessions\nsystemd-vconsole-setup.service     loaded active exited  Setup Virtual Console\ntuned.service                      loaded active running Dynamic System Tuning Daemon\nwpa_supplicant.service             loaded active running WPA Supplicant daemon\n\nLOAD   = Reflects whether the unit definition was properly loaded.\nACTIVE = The high-level unit activation state, i.e. generalization of SUB.\nSUB    = The low-level unit activation state, values depend on unit type.\n\n37 loaded units listed. Pass --all to see loaded but inactive units, too.\nTo show all installed unit files use 'systemctl list-unit-files'.\n```\n\n### Tuned\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e virtual-guest \u304b\u3089 throughput-performance \u306b\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3057\u3066\u307f\u307e\u3057\u305f\u304c\u3001VirtualBox \u4e0a\u3067\u306f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u5411\u4e0a\u3057\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n```bash\ntuned-adm list\n```\n```text:\u51fa\u529b\u4f8b\nAvailable profiles:\n- balanced\n- desktop\n- latency-performance\n- network-latency\n- network-throughput\n- powersave\n- throughput-performance\n- virtual-guest\n- virtual-host\nCurrent active profile: virtual-guest\n```\n```bash\ntuned-adm profile throughput-performance\n```\n\n\n## Apache\n### MaxRequestWorkers (MaxClients) \u306e\u8abf\u6574\napachetuner.php \u3068\u3044\u3046 MaxRequestWorkers \u9069\u6b63\u5024\u81ea\u52d5\u8a08\u7b97\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\u8fd1\u3044\u3046\u3061\u306b GitHub \u306a\u3069\u3067\u516c\u958b\u3067\u304d\u308c\u3070\u3068\u601d\u3044\u307e\u3059\u3002\n\n```bash\nphp apachetuner.php\n```\nSiege \u3067\u8ca0\u8377\u3092\u639b\u3051\u3066\u5b9f\u884c\u3057\u305f\u7d50\u679c\u304c\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\u4f59\u88d5\u3092\u898b\u3066 96 \u3042\u305f\u308a\u304c\u7121\u96e3\u3067\u3057\u3087\u3046\u304b\u3002\n\n```\n\u30ab\u30fc\u30cd\u30eb\u540d:       Linux\n\u30ab\u30fc\u30cd\u30eb\u30d0\u30fc\u30b8\u30e7\u30f3: 3.10.0-327.36.3.el7.x86_64\nApache\u30d0\u30fc\u30b8\u30e7\u30f3:  2.4.6\nApache MPM:      prefork\n\u7269\u7406\u30e1\u30e2\u30ea:        1840.01 MB\n\u5229\u7528\u53ef\u80fd\u30e1\u30e2\u30ea:     964.04 MB\nApache\n \u5168\u30d7\u30ed\u30bb\u30b9\u4f7f\u7528\u30e1\u30e2\u30ea:       429.37 MB\n \u5b50\u30d7\u30ed\u30bb\u30b9\u8d77\u52d5\u6570:         10\n \u89aa\u30d7\u30ed\u30bb\u30b9\u4f7f\u7528\u30e1\u30e2\u30ea:       45.79 MB\n \u5b50\u30d7\u30ed\u30bb\u30b9\u5408\u8a08\u5171\u6709\u30e1\u30e2\u30ea:   383.585 MB\n \u5b50\u30d7\u30ed\u30bb\u30b9\u6700\u5c0f\u5171\u6709\u30e1\u30e2\u30ea:   37.45 MB\n \u5b50\u30d7\u30ed\u30bb\u30b9\u6700\u5927\u975e\u5171\u6709\u30e1\u30e2\u30ea: 8.34 MB (\u89aa\u30d7\u30ed\u30bb\u30b9\u30e1\u30e2\u30ea - \u5b50\u30d7\u30ed\u30bb\u30b9\u6700\u5c0f\u5171\u6709\u30e1\u30e2\u30ea)\n MaxRequestWorkers\u6700\u5927\u5024: 110 (\u4f7f\u7528\u53ef\u80fd\u30e1\u30e2\u30ea / \u5b50\u30d7\u30ed\u30bb\u30b9\u6700\u5927\u975e\u5171\u6709\u30e1\u30e2\u30ea)\n\uff15\uff16\nPID           \t6388*\t8358\t8359\t8360\t22228\t22229\t22230\t22234\t22267\t22296\t22343\nSize          \t658048\t665964\t668012\t665964\t665964\t665844\t667892\t665852\t665868\t663916\t665916\nRss           \t46888\t52324\t54552\t54752\t48988\t48884\t51036\t48928\t48904\t46928\t48872\nPss           \t20251\t15131\t17219\t17321\t13930\t13835\t15986\t13878\t13855\t11878\t13824\nShared        \t31188\t41232\t41472\t41660\t38356\t38344\t38344\t38344\t38344\t38344\t38344\nShared_Ratio  \t66\t78\t76\t76\t78\t78\t75\t78\t78\t81\t78\nShared_Clean  \t10016\t6844\t6844\t6844\t6600\t6596\t6596\t6596\t6596\t6596\t6596\nShared_Dirty  \t21172\t34388\t34628\t34816\t31756\t31748\t31748\t31748\t31748\t31748\t31748\nPrivate       \t15700\t11092\t13080\t13092\t10632\t10540\t12692\t10584\t10560\t8584\t10528\nPrivate_Ratio \t33\t21\t23\t23\t21\t21\t24\t21\t21\t18\t21\nPrivate_Clean \t1428\t0\t0\t0\t0\t0\t0\t0\t0\t0\t0\nPrivate_Dirty \t14272\t11092\t13080\t13092\t10632\t10540\t12692\t10584\t10560\t8584\t10528\nReferenced    \t42184\t45192\t47416\t47608\t41792\t41664\t43844\t41712\t41700\t39764\t41736\nAnonymous     \t17500\t25144\t27252\t25116\t25208\t25116\t27268\t25160\t25136\t23160\t25100\nKernelPageSize\t3484\t3496\t3496\t3496\t3496\t3496\t3496\t3496\t3492\t3492\t3492\nMMUPageSize   \t3484\t3496\t3496\t3496\t3496\t3496\t3496\t3496\t3492\t3492\t3492\n```\n\n\u8a73\u3057\u304f\u306f\u300c[Apache \u306e MaxClients \u306e\u9069\u6b63\u5024](http://qiita.com/bezeklik/items/14e27417f9cc93ca7222)\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n### mod_deflate\nmod_deflate \u3067\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u5727\u7e2e\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f /mtc.js \u304c 129000 bytes \u304b\u3089 43068 bytes \u3068 33% \u7a0b\u5ea6\u3001 /themes/skyline/css/skyline.css \u304c 1605 bytes \u304b\u3089 686 bytes \u3068 43% \u7a0b\u5ea6\u306b\u5727\u7e2e\u3055\u308c\u305f\u3088\u3046\u3067\u3059\u3002\n\n```bash\ncat << \"_EOF_\" > /etc/httpd/conf.d/mod_deflate.conf\n<IfModule deflate_module>\n    # \u5727\u7e2e\u7387\u306e\u8a2d\u5b9a\n    DeflateCompressionLevel 1\n    <Location />\n        BrowserMatch ^Mozilla/4 gzip-only-text/html\n        BrowserMatch ^Mozilla/4\\.0[678] no-gzip\n        BrowserMatch \\bMSIE\\s(7|8) !no-gzip !gzip-only-text/html\n\n        # \u753b\u50cf\u7b49\u306f\u518d\u5727\u7e2e\u3055\u305b\u306a\u3044\n        SetEnvIfNoCase Request_URI \\.(?:gif|jpe?g|png|ico)$ no-gzip dont-vary\n\n        # \u30d7\u30ed\u30ad\u30b7\u30b5\u30fc\u30d0\u306b\u5727\u7e2e\u6e08\u307f\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u9001\u4fe1\u3059\u308b\u5bfe\u8c61\u3092\u5236\u9650\n        Header append Vary Accept-Encoding env=!dont-vary\n\n        # \u5727\u7e2e\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u306eMimeType\u3092mod_filter\u3092\u4f7f\u3063\u3066\u6307\u5b9a\n        FilterDeclare Compression CONTENT_SET\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'text/html'\"\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'text/plain'\"\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'text/css'\"\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'text/javascript'\"\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'text/xml'\"\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'application/xhtml'\"\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'application/xml'\"\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'application/xhtml+xml'\"\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'application/rss+xml'\"\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'application/atom+xml'\"\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'application/javascript'\"\n        FilterProvider Compression DEFLATE \"%{CONTENT_TYPE} = 'image/svg-xml'\"\n        FilterChain Compression\n    </Location>\n</IfModule>\n_EOF_\n```\n\n## MySQL\n### MySQLTuner\n```\ncurl -sL mysqltuner.pl -o mysqltuner.pl\nperl mysqltuner.pl\n```\n\n## PHP\n### Zend OPCache + APCu\nPHP \u30a2\u30af\u30bb\u30e9\u30ec\u30fc\u30bf\u30fc\u306e Zend OPCache \u3068 APCu \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\nyum install php-opcache php-pecl-apcu\n```\n\n\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306f2\u500d\u3061\u3087\u3063\u3068\u5411\u4e0a\u3059\u308b\u3088\u3046\u3067\u3059\u3002\n\n```\nTransactions:                   1141 hits\nAvailability:                 100.00 %\nElapsed time:                  59.10 secs\nData transferred:              20.15 MB\nResponse time:                  0.48 secs\nTransaction rate:              19.31 trans/sec\nThroughput:                     0.34 MB/sec\nConcurrency:                    9.32\nSuccessful transactions:         850\nFailed transactions:               0\nLongest transaction:            3.37\nShortest transaction:           0.00\n```\n\n### php-fpm\n\nFPM (FastCGI Process Manager) \u306f PHP \u306e FastCGI \u5b9f\u88c5\u306e\u3072\u3068\u3064\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\nyum install php-fpm\ncat << \"_EOF_\" > /etc/httpd/conf.d/php_fpm.conf\n<FilesMatch \\.php$>\n    SetHandler \"proxy:fcgi://127.0.0.1:9000\"\n</FilesMatch>\n_EOF_\nsystemctl start php-fpm && systemctl enable php-fpm\n```\n\n\u4eca\u56de\u306e\u30b1\u30fc\u30b9\u3067\u306f php-fpm \u3092\u5165\u308c\u308b\u3068\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u4f4e\u4e0b\u3059\u308b\u3088\u3046\u3067\u3059\u3002\n\n```\nTransactions:                    944 hits\nAvailability:                 100.00 %\nElapsed time:                  59.82 secs\nData transferred:              19.89 MB\nResponse time:                  0.60 secs\nTransaction rate:              15.78 trans/sec\nThroughput:                     0.33 MB/sec\nConcurrency:                    9.41\nSuccessful transactions:         842\nFailed transactions:               0\nLongest transaction:            3.64\nShortest transaction:           0.00\n```\n\n### Memcached\n```\nyum install memcached php-pecl-memcached\nsed -i '/session.save/s/^;//' /etc/php.d/50-memcached.ini\nsystemctl start memcached && systemctl enable memcached\n```\n\nMautic (Symfony) \u5074\u3067\u8a2d\u5b9a\u304c\u4e0a\u66f8\u304d\u3055\u308c\u3066 Memcached \u3092\u4f7f\u3063\u3066\u304f\u308c\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3001\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u4f4e\u4e0b\u3057\u307e\u3059\u3002config.yml \u3082\u898b\u5f53\u305f\u3089\u306a\u3044\u306e\u3067\u4eca\u56de\u306f\u65ad\u5ff5\u3057\u307e\u3059\u3002\n\n```\nTransactions:                    943 hits\nAvailability:                 100.00 %\nElapsed time:                  59.14 secs\nData transferred:              19.78 MB\nResponse time:                  0.59 secs\nTransaction rate:              15.95 trans/sec\nThroughput:                     0.33 MB/sec\nConcurrency:                    9.44\nSuccessful transactions:         843\nFailed transactions:               0\nLongest transaction:            3.39\nShortest transaction:           0.00\n```\n\n# \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5bfe\u7b56\u3092\u884c\u3046\u3068\u3069\u3046\u3057\u3066\u3082\u30b5\u30fc\u30d0\u30fc\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306f\u843d\u3061\u308b\u306e\u3067\u3001\u7121\u7406\u306b\u5168\u3066\u3092\u30b5\u30fc\u30d0\u30fc\u306a\u3044\u3067\u884c\u308f\u306a\u304f\u3066\u3082\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n## CentOS\n\n### \u5404\u7a2e\u8a2d\u5b9a\nLynis \u3067\u30b5\u30b8\u30a7\u30b9\u30c8\u3055\u308c\u308b\u5185\u5bb9\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5bfe\u5fdc\u3057\u307e\u3059\u3002\n\u8a73\u7d30\u306f\u300c[Linux\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u76e3\u67fb\u30c4\u30fc\u30eb Lynis](http://qiita.com/bezeklik/items/cf9be2deb546c69123e7)\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```bash\nsed -i.org \"s/#smtpd_banner = \\$myhostname ESMTP \\$mail_name$/smtpd_banner = \\$myhostname ESMTP/\" /etc/postfix/main.cf\nsed -i.org 's/PASS_MIN_DAYS\\t0/PASS_MIN_DAYS\\t1/' /etc/login.defs\nsed -i 's/PASS_MAX_DAYS\\t99999/PASS_MAX_DAYS\\t3650/' /etc/login.defs\nsed -i.org \"s/umask 002/umask 027/\" /etc/profile\nsed -i \"s/umask 022/umask 027/\" /etc/profile\necho \"blacklist usb-storage\" > /etc/modprobe.d/blacklist-usbstorage.conf\necho \"blacklist firewire_core\" > /etc/modprobe.d/blacklist-firewire.conf\necho \"blacklist firewire_ohci\" >> /etc/modprobe.d/blacklist-firewire.conf\nsed -i '/::1/s/^/#/' /etc/hosts\nyum install yum-utils arpwatch psacct sysstat\nsystemctl enable arpwatch psacct && systemctl start arpwatch psacct\nsed -i.org 's/#AllowTcpForwarding yes/AllowTcpForwarding no/' /etc/ssh/sshd_config\nsed -i 's/#ClientAliveCountMax 3/ClientAliveCountMax 2/' /etc/ssh/sshd_config\nsed -i 's/#Compression delayed/Compression no/' /etc/ssh/sshd_config\nsed -i 's/#LogLevel INFO/LogLevel VERBOSE/' /etc/ssh/sshd_config\nsed -i 's/#MaxAuthTries 6/MaxAuthTries 1/' /etc/ssh/sshd_config\nsed -i 's/#MaxSessions 10/MaxSessions 2/' /etc/ssh/sshd_config\nsed -i 's/#PermitRootLogin yes/PermitRootLogin no/' /etc/ssh/sshd_config\nsed -i 's/#Port 22/Port 10022/' /etc/ssh/sshd_config\nsed -i 's/#TCPKeepAlive yes/TCPKeepAlive no/' /etc/ssh/sshd_config\nsed -i 's/#UseDNS yes/UseDNS no/' /etc/ssh/sshd_config\nsed -i 's/X11Forwarding yes/X11Forwarding no/' /etc/ssh/sshd_config\nsed -i 's/#AllowAgentForwarding yes/AllowAgentForwarding no/' /etc/ssh/sshd_config\n(echo; echo \"Unauthorized access to this machine is prohibited.\"; echo \"Disconnect now if you are not an authorized user.\"; echo) > /etc/issue\n(echo; echo \"Unauthorized access to this machine is prohibited.\"; echo \"Disconnect now if you are not an authorized user.\"; echo) > /etc/issue.net\nlynis --quick --verbose --tests KRNL-6000\ngrep \"different value\" /var/log/lynis.log | awk '{ gsub(\"Expected\",\"\"); gsub(\",\",\"\"); print $6 $16 }'\ngrep \"different value\" /var/log/lynis.log | awk '{ gsub(\"Expected\",\"\"); gsub(\",\",\"\"); print $6 $16 }' >> /etc/sysctl.conf\nsysctl -p\nlynis --quick --verbose --tests HRDN-7222\ngrep \"world executable\" /var/log/lynis.log | awk '{ print $5 }' | xargs ls -l\ngrep \"world executable\" /var/log/lynis.log | awk '{ print $5 }' | xargs chmod 700\nyum install epel-release && yum update\nyum install rkhunter unhide\nrkhunter -c --rwo --sk\n```\n\n### Fail2ban\n\u30d6\u30eb\u30fc\u30c8\u30d5\u30a9\u30fc\u30b9\u653b\u6483\u5bfe\u7b56\u306b Fail2ban \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u8a73\u7d30\u306f\u300c[\u30d6\u30eb\u30fc\u30c8\u30d5\u30a9\u30fc\u30b9\u653b\u6483\u5bfe\u7b56 Fail2ban](http://qiita.com/bezeklik/items/75d93d6bb1770bfa7c2e)\u300d\u3084\u300c[DoS\u653b\u6483/\u30d6\u30eb\u30fc\u30c8\u30d5\u30a9\u30fc\u30b9\u653b\u6483\u5bfe\u7b56\u30a2\u30d7\u30ea\u306e\u8fd1\u6cc1](http://qiita.com/bezeklik/items/6d86a162e278f576e4ca)\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n### NIDS\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u578b\u4fb5\u5165\u691c\u77e5\u30b7\u30b9\u30c6\u30e0 (NIDS) \u3068\u3057\u3066 **Suricata** \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n### HIDS\n\u30db\u30b9\u30c8\u578b\u4fb5\u5165\u691c\u77e5\u30b7\u30b9\u30c6\u30e0 (HIDS) \u3068\u3057\u3066 **OSSEC** \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u8a73\u7d30\u306f\u300c[\u30d5\u30a1\u30a4\u30eb\u6539\u3056\u3093\u691c\u77e5\u30c4\u30fc\u30eb OSSEC](http://qiita.com/bezeklik/items/2143c02f1432d90f5c38)\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n## Apache\n### \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb (conf)\n\u8a73\u3057\u304f\u306f\u300c[Apache\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a](http://qiita.com/bezeklik/items/1c4145652661cf5b2271)\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```bash\ncat /dev/null > /etc/httpd/conf.d/autoindex.conf\ncat /dev/null > /etc/httpd/conf.d/welcome.conf\n```\n```apache\ncat << _EOF_ > /etc/httpd/conf.d/security.conf\n# \u30d0\u30fc\u30b8\u30e7\u30f3\u60c5\u5831\u306e\u96a0\u853d\nServerTokens Prod \nHeader unset X-Powered-By\n# httpoxy \u5bfe\u7b56\nRequestHeader unset Proxy\n# \u30af\u30ea\u30c3\u30af\u30b8\u30e3\u30c3\u30ad\u30f3\u30b0\u5bfe\u7b56\nHeader append X-Frame-Options SAMEORIGIN\n# XSS\u5bfe\u7b56\nHeader set X-XSS-Protection \"1; mode=block\"\nHeader set X-Content-Type-Options nosniff\n# XST\u5bfe\u7b56\nTraceEnable Off\n\n<Directory /var/www/html>\n    # .htaccess \u306e\u6709\u52b9\u5316\n    AllowOverride All\n    # \u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u51fa\u529b\u306e\u7981\u6b62\n    Options -Indexes\n    # Apache 2.2\u4ee5\u524d\u306e\u5bfe\u7b56\n    <IfVersion < 2.3>\n        # \u30d0\u30fc\u30b8\u30e7\u30f3\u60c5\u5831\u306e\u96a0\u853d\n        ServerSignature Off\n        # ETag\u306einode\u60c5\u5831\u306e\u96a0\u853d\n        FileETag MTime Size\n    </IfVersion>\n</Directory>\n_EOF_\n```\n```apache\ncat << _EOF_ > /etc/httpd/conf.d/security_strict.conf\n# DoS \u653b\u6483\u5bfe\u7b56\nLimitRequestBody 10485760\nLimitRequestFields 20\n# slowloris \u5bfe\u7b56\nRequestReadTimeout header=20-40,MinRate=500 body=20,MinRate=500\n\n<Directory /var/www/html>\n    # HTTP\u30e1\u30bd\u30c3\u30c9\u306e\u5236\u9650\n    <IfVersion > 2.4>\n        Require method GET POST\n    </IfVersion>\n    <IfVersion < 2.3>\n        <Limit GET POST>\n            Order allow,deny\n            Allow from all\n        </Limit>\n        <LimitExcept GET POST>\n            Order deny,allow\n            Deny from all\n        </LimitExcept>\n    </IfVersion>\n</Directory>\n_EOF_\n```\n\n### mod_evasive\n\u8a73\u3057\u304f\u306f\u300c[DoS\u653b\u6483\u5bfe\u7b56\u30e2\u30b8\u30e5\u30fc\u30eb mod_evasive](http://qiita.com/bezeklik/items/b3db4c0d5487f7120e73)\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n### mod_qos\n\u8a73\u3057\u304f\u306f\u300c[\u5e2f\u57df\u5236\u9650\u30e2\u30b8\u30e5\u30fc\u30eb mod_qos](http://qiita.com/bezeklik/items/a6d95cc03df49ea15381)\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n### ModSecurity (mod_security)\nWAF \u3068\u3057\u3066 ModSecurity \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u8a73\u3057\u304f\u306f\u300c[\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9WAF ModSecurity](http://qiita.com/bezeklik/items/76bf942f4a9e0a2919d8)\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\ncat << \"_EOF_\" >> /etc/httpd/conf.d/mod_security_rule_mautic.conf\nSecRuleRemoveById 950911\nSecRuleRemoveById 981173\nSecRuleRemoveById 981242\nSecRuleRemoveById 981243\nSecRuleRemoveById 981245\nSecRuleRemoveById 981257\n_EOF_\n```\n\n## MySQL\n### mysql_secure_installation\n`mysql_secure_installation` \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5bfe\u7b56\u3068\u3057\u3066\u4ee5\u4e0b\u306e\u5185\u5bb9\u3092\u5b9f\u65bd\u3067\u304d\u307e\u3059\u3002\n\n* root \u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\n* \u533f\u540d\u30e6\u30fc\u30b6\u30fc\u306e\u524a\u9664\n* \u30ea\u30e2\u30fc\u30c8\u304b\u3089\u306e root \u30e6\u30fc\u30b6\u30fc\u3067\u306e\u30ed\u30b0\u30a4\u30f3\u7981\u6b62\n* test \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u524a\u9664\n* \u7279\u6a29\u30c6\u30fc\u30d6\u30eb\u306e\u30ea\u30ed\u30fc\u30c9\n\n```bash\nSecuring the MySQL server deployment.\n\nEnter password for user root:\n\nThe existing password for the user account root has expired. Please set a new password.\n\nNew password:\n\nRe-enter new password:\nThe 'validate_password' plugin is installed on the server.\nThe subsequent steps will run with the existing configuration\nof the plugin.\nUsing existing password for root.\n\nEstimated strength of the password: 100\nChange the password for root ? ((Press y|Y for Yes, any other key for No) : # 100\u306a\u3089\u7a7a\u30a8\u30f3\u30bf\u30fc\n\n ... skipping.\nBy default, a MySQL installation has an anonymous user,\nallowing anyone to log into MySQL without having to have\na user account created for them. This is intended only for\ntesting, and to make the installation go a bit smoother.\nYou should remove them before moving into a production\nenvironment.\n\nRemove anonymous users? (Press y|Y for Yes, any other key for No) : y # \u533f\u540d\u30e6\u30fc\u30b6\u30fc\u306e\u524a\u9664\nSuccess.\n\n\nNormally, root should only be allowed to connect from\n'localhost'. This ensures that someone cannot guess at\nthe root password from the network.\n\nDisallow root login remotely? (Press y|Y for Yes, any other key for No) : y # \u30ea\u30e2\u30fc\u30c8root\u30ed\u30b0\u30a4\u30f3\u7981\u6b62\nSuccess.\n\nBy default, MySQL comes with a database named 'test' that\nanyone can access. This is also intended only for testing,\nand should be removed before moving into a production\nenvironment.\n\n\nRemove test database and access to it? (Press y|Y for Yes, any other key for No) : y # test\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u524a\u9664\n - Dropping test database...\nSuccess.\n\n - Removing privileges on test database...\nSuccess.\n\nReloading the privilege tables will ensure that all changes\nmade so far will take effect immediately.\n\nReload privilege tables now? (Press y|Y for Yes, any other key for No) : y # \u7279\u6a29\u30c6\u30fc\u30d6\u30eb\u306e\u30ea\u30ed\u30fc\u30c9\nSuccess.\n\nAll done!\n```\n\n## PHP\n### \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\u8a73\u7d30\u306f\u8ffd\u3063\u3066\u5225\u306e\u8a18\u4e8b\u306b\u307e\u3068\u3081\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3067\u591a\u5c11\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u843d\u3061\u307e\u3059\u3002\n\n```ini\ncat << _EOF_ > /etc/php.d/99-security.ini\ndate.timezone = Asia/Tokyo           ; \u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u306e\u8a2d\u5b9a (\u30c7\u30d5\u30a9\u30eb\u30c8: GMT) PHP 5.1.0 ~\ndisplay_errors = Off                 ; \u30a8\u30e9\u30fc\u51fa\u529b (\u30c7\u30d5\u30a9\u30eb\u30c8: 1)\nenable_dl = Off                      ; dl()\u306e\u7981\u6b62 (\u30c7\u30d5\u30a9\u30eb\u30c8: 1)\nexpose_php = Off                     ; HTTP\u30d8\u30c3\u30c0\u306ePHP\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u975e\u8868\u793a (\u30c7\u30d5\u30a9\u30eb\u30c8: 1)\nlog_errors_max_len = 4096            ; \u30a8\u30e9\u30fc\u30ed\u30b0\u306e\u51fa\u529b\u5236\u9650\u306e\u62e1\u5927 (\u30c7\u30d5\u30a9\u30eb\u30c8: 1024)\nsession.cookie_httponly = On         ; JavaScript\u306eCookie\u8aad\u307f\u8fbc\u307f\u7981\u6b62 (\u30c7\u30d5\u30a9\u30eb\u30c8: \"\")\nsession.hash_function = sha512       ; \u30bb\u30c3\u30b7\u30e7\u30f3ID\u751f\u6210\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u5f37\u5316 (\u30c7\u30d5\u30a9\u30eb\u30c8: 0)\nsession.hash_bits_per_character = 6  ; \u30bb\u30c3\u30b7\u30e7\u30f3ID\u306e\u4f7f\u7528\u53ef\u80fd\u6587\u5b57\u3092\u5897\u3084\u3059 (\u30c7\u30d5\u30a9\u30eb\u30c8: 4)\n_EOF_\n```\n```ini\ncat << _EOF_ > /etc/php.d/99-security-encoding.ini\ndefault_charset = UTF-8\noutput_buffering = Off\nmbstring.encoding_translation = On\nmbstring.http_input = UTF-8\nmbstring.http_output = pass\nmbstring.internal_encoding = UTF-8\nmbstring.language = Japanese\nmbstring.substitute_character = \"?\"\n_EOF_\n```\n```ini\ncat << \"_EOF_\" > /etc/php.d/99-security-strict.ini\n; \u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n;file_uploads = Off                   ; HTTP \u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9 (\u30c7\u30d5\u30a9\u30eb\u30c8: 1)\nmax_file_uploads = 1                 ; \u540c\u6642\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u30d5\u30a1\u30a4\u30eb\u6700\u5927\u6570 (\u30c7\u30d5\u30a9\u30eb\u30c8: 20)\n\n; \u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\ndefault_socket_timeout = 20          ;  (\u30c7\u30d5\u30a9\u30eb\u30c8: 60)\nmax_execution_time = 20              ; 1\u30ea\u30af\u30a8\u30b9\u30c8\u3042\u305f\u308a\u306e\u6700\u5927\u5b9f\u884c\u6642\u9593\uff08\u79d2\uff09 (\u30c7\u30d5\u30a9\u30eb\u30c8: 30)\nmax_input_time = 20                  ;  (\u30c7\u30d5\u30a9\u30eb\u30c8: -1)\n\n; \u4e0a\u9650\u8a2d\u5b9a\nmax_input_nesting_level = 10         ; (\u30c7\u30d5\u30a9\u30eb\u30c8: 64)\nmax_input_vars = 100                 ; (\u30c7\u30d5\u30a9\u30eb\u30c8: 1000)\nmemory_limit = 64M                   ; 1\u30ea\u30af\u30a8\u30b9\u30c8\u3042\u305f\u308a\u306e\u6700\u5927\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf (\u30c7\u30d5\u30a9\u30eb\u30c8: 128M)\npost_max_size = 4M                   ; POST\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u8a31\u5bb9\u30b5\u30a4\u30ba (\u30c7\u30d5\u30a9\u30eb\u30c8: 8M)\nupload_max_filesize = 1M             ; \u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306e\u8a31\u5bb9\u30b5\u30a4\u30ba (\u30c7\u30d5\u30a9\u30eb\u30c8: 2M)\n\nmbstring.strict_detection = On       ; \u53b3\u683c\u306a\u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u691c\u51fa (\u30c7\u30d5\u30a9\u30eb\u30c8: 0)\n;session.cookie_secure = 1            ; (\u30c7\u30d5\u30a9\u30eb\u30c8: \"\")\nopen_basedir = /usr/share/:/var/www/ ; (\u30c7\u30d5\u30a9\u30eb\u30c8: NULL)\nallow_url_fopen = Off                ;  (\u30c7\u30d5\u30a9\u30eb\u30c8: 1)\nallow_url_include = Off              ;  (\u30c7\u30d5\u30a9\u30eb\u30c8: 0) PHP 5.2.0 ~\ndisable_functions = phpinfo,eval     ; \u6307\u5b9a\u30b7\u30b9\u30c6\u30e0\u95a2\u6570\u306e\u7981\u6b62 (\u30c7\u30d5\u30a9\u30eb\u30c8: \"\")\nsession.name = SECUREID              ; \t(\u30c7\u30d5\u30a9\u30eb\u30c8: PHPSESSID)\n_EOF_\n```\n\n### Suhosin\nRemi \u30ea\u30dd\u30b8\u30c8\u30ea\u30fc\u3067\u306f PHP \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5f37\u5316\u30e2\u30b8\u30e5\u30fc\u30eb\u306e Suhosin \u304c\u30d1\u30c3\u30b1\u30fc\u30b8\u5316\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3053\u308c\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u305f\u3060\u3057 PHP 7.x \u7528\u306e suhosin7 \u306e README \u306b\u306f\u3001\u30d7\u30ec\u30a2\u30eb\u30d5\u30a1\u7248\u306a\u306e\u3067\u672c\u756a\u74b0\u5883\u3067\u306f\u4f7f\u7528\u3057\u306a\u3044\u3088\u3046\u306b\u3068\u306e\u6ce8\u610f\u66f8\u304d\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u5024\u3067\u3059\u3002\n\n```\nsuhosin.cookie.checkraddr => 0 => 0\nsuhosin.cookie.cryptdocroot => On => On\nsuhosin.cookie.cryptkey => [ protected ] => [ protected ]\nsuhosin.cookie.cryptlist => no value => no value\nsuhosin.cookie.cryptraddr => 0 => 0\nsuhosin.cookie.cryptua => On => On\nsuhosin.cookie.disallow_nul => 1 => 1\nsuhosin.cookie.disallow_ws => 1 => 1\nsuhosin.cookie.encrypt => Off => Off\nsuhosin.cookie.max_array_depth => 50 => 50\nsuhosin.cookie.max_array_index_length => 64 => 64\nsuhosin.cookie.max_name_length => 64 => 64\nsuhosin.cookie.max_totalname_length => 256 => 256\nsuhosin.cookie.max_value_length => 10000 => 10000\nsuhosin.cookie.max_vars => 100 => 100\nsuhosin.cookie.plainlist => no value => no value\nsuhosin.coredump => Off => Off\nsuhosin.disable.display_errors => Off => Off\nsuhosin.executor.allow_symlink => Off => Off\nsuhosin.executor.disable_emodifier => Off => Off\nsuhosin.executor.eval.blacklist => no value => no value\nsuhosin.executor.eval.whitelist => no value => no value\nsuhosin.executor.func.blacklist => no value => no value\nsuhosin.executor.func.whitelist => no value => no value\nsuhosin.executor.include.allow_writable_files => On => On\nsuhosin.executor.include.blacklist => no value => no value\nsuhosin.executor.include.max_traversal => 0 => 0\nsuhosin.executor.include.whitelist => no value => no value\nsuhosin.executor.max_depth => 750 => 750\nsuhosin.get.disallow_nul => 1 => 1\nsuhosin.get.disallow_ws => 0 => 0\nsuhosin.get.max_array_depth => 50 => 50\nsuhosin.get.max_array_index_length => 64 => 64\nsuhosin.get.max_name_length => 64 => 64\nsuhosin.get.max_totalname_length => 256 => 256\nsuhosin.get.max_value_length => 512 => 512\nsuhosin.get.max_vars => 100 => 100\nsuhosin.log.file => 0 => 0\nsuhosin.log.file.name => no value => no value\nsuhosin.log.file.time => On => On\nsuhosin.log.sapi => 0 => 0\nsuhosin.log.stdout => 0 => 0\nsuhosin.log.use-x-forwarded-for => Off => Off\nsuhosin.memory_limit => 0 => 0\nsuhosin.mt_srand.ignore => On => On\nsuhosin.multiheader => Off => Off\nsuhosin.perdir => 0 => 0\nsuhosin.post.disallow_nul => 1 => 1\nsuhosin.post.disallow_ws => 0 => 0\nsuhosin.post.max_array_depth => 50 => 50\nsuhosin.post.max_array_index_length => 64 => 64\nsuhosin.post.max_name_length => 64 => 64\nsuhosin.post.max_totalname_length => 256 => 256\nsuhosin.post.max_value_length => 1000000 => 1000000\nsuhosin.post.max_vars => 1000 => 1000\nsuhosin.protectkey => On => On\nsuhosin.rand.reseed_every_request => Off => Off\nsuhosin.rand.seedingkey => [ protected ] => [ protected ]\nsuhosin.request.array_index_char_blacklist => '\"+<>;() => '\"+<>;()\nsuhosin.request.array_index_char_whitelist => no value => no value\nsuhosin.request.disallow_nul => 1 => 1\nsuhosin.request.disallow_ws => 0 => 0\nsuhosin.request.max_array_depth => 50 => 50\nsuhosin.request.max_array_index_length => 64 => 64\nsuhosin.request.max_totalname_length => 256 => 256\nsuhosin.request.max_value_length => 1000000 => 1000000\nsuhosin.request.max_varname_length => 64 => 64\nsuhosin.request.max_vars => 1000 => 1000\nsuhosin.server.encode => On => On\nsuhosin.server.strip => On => On\nsuhosin.session.checkraddr => 0 => 0\nsuhosin.session.cryptdocroot => On => On\nsuhosin.session.cryptkey => [ protected ] => [ protected ]\nsuhosin.session.cryptraddr => 0 => 0\nsuhosin.session.cryptua => Off => Off\nsuhosin.session.encrypt => On => On\nsuhosin.session.max_id_length => 128 => 128\nsuhosin.simulation => Off => Off\nsuhosin.srand.ignore => On => On\n```\n\n\u4e0a\u624b\u304f\u3044\u304b\u306a\u3044\u5834\u5408\u306f\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u306b\u5909\u66f4\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```bash\ncat << \"_EOF_\" >> /etc/php.d/40-suhosin7.ini\nsuhosin.simulation = On\n_EOF_\n```\n\n\u8a73\u3057\u304f\u306f\u300c[PHP\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5f37\u5316\u30e2\u30b8\u30e5\u30fc\u30eb Suhosin](http://qiita.com/bezeklik/items/5e8b1f76465e39dc6cd0)\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n", "tags": ["Mautic2.2.1", "CentOS7.2.1511", "\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9", "\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3"]}