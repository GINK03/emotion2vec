{"context": " More than 1 year has passed since last update.\u8ffd\u8a18: \u3053\u306e\u8a18\u4e8b\u306fConoHa Advent Calendar 2015\u306e\u8a18\u4e8b\u3068\u306a\u308a\u307e\u3059\u3002\n\u4fee\u6b631(2015/12/14 18:00): openstack server create ... \u306e\u30b3\u30de\u30f3\u30c9\u3067\u3001instance_name_tag=\u3092\u6307\u5b9a\u3059\u308b\u3068\u3053\u308d\u3092'\"(\u30c0\u30d6\u30eb\u30af\u30aa\u30fc\u30c8)'\u3067\u304f\u304f\u308b\u3088\u3046\u306b\u8868\u8a18\u3092\u5909\u3048\u307e\u3057\u305f\u3002\u30b7\u30f3\u30b0\u30eb\u30af\u30aa\u30fc\u30c8\u3060\u3068\u3001\\u2018 \\u2019\u306eunicode\u306e\u30af\u30aa\u30fc\u30c8\u306b\u8868\u793a\u304c\u306a\u3063\u3066\u3044\u305f\u307f\u305f\u3044\u3067\u3001\u7d1b\u3089\u308f\u3057\u3044\u306e\u3067\u4fee\u6b63\u3002\n\u4fee\u6b632(2015/12/21 16:00): swiftks storage url\u306e\u6307\u5b9a\u65b9\u6cd5\u306b\u3064\u3044\u3066\u3001\u5225\u8a18\u4e8b\u3067\u6307\u6458\u304c\u3042\u308a\u307e\u3057\u305f\u3002\u72ec\u81ea\u30c9\u30e9\u30a4\u30d0\u3092\u4f5c\u3089\u306a\u304f\u3066\u3082\u826f\u3044\u307f\u305f\u3044\u3067\u3059\u306e\u3067\u3001\u3053\u3061\u3089\u3092\u898b\u3066storage url\u3092\u8a2d\u5b9a\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002(http://qiita.com/hikaru_uchiyama/items/504b7e5e75f747c12366)\n\u300cConoHa\u306eVM\u3067Ubuntu 14.04\u3092\u4f7f\u3063\u3066s3ql\u3067Swift Object Storage\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u300d\u3068\u3044\u3046\u30bf\u30a4\u30c8\u30eb\u306a\u3093\u3067\u3059\u3051\u3069\u3001\u306a\u3093\u3067s3ql\u3068\u304b\u3044\u3046\u3068\u3001\u3053\u306efuse\u30de\u30a6\u30f3\u30c8\u306e\u7279\u5fb4\u306f\u3001\u4e0b\u8a18\u306e\u611f\u3058\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u6700\u65b0\u7248\u306fpython3\u30d9\u30fc\u30b9\u3067\u52d5\u304f\nLarge file\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\n\u66f8\u304d\u8fbc\u307f\u3001\u8aad\u307f\u8fbc\u307f\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u3059\u308b\u306e\u3067\u57fa\u672c\u7684\u306b\u30de\u30a6\u30f3\u30c8\u3059\u308b\u74b0\u5883(cache)\u306edisk\u306e\u901f\u5ea6\u306b\u4f9d\u5b58\u3059\u308b\n\u5f8c\u3067\u4e2d\u8eab\u3092\u5b9f\u969b\u306b\u898b\u307e\u3059\u304c\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306fs3ql\u306edata\u5f62\u5f0f\u3067\u8ee2\u9001\u3055\u308c\u308b\u306e\u3067\u3001\u4e2d\u8eab\u306f\u30de\u30a6\u30f3\u30c8\u3057\u306a\u3044\u3068\u308f\u304b\u3089\u306a\u3044\n\u30de\u30a6\u30f3\u30c8\u3057\u3066\u3044\u308b\u74b0\u5883\u306ecache\u3084encrypt\u306e\u4ed5\u7d44\u307f\u306b\u4f9d\u5b58\u3059\u308b\u306e\u3067\u3001\u8907\u6570\u306e\u30b5\u30fc\u30d0\u3067\u306e\u30de\u30a6\u30f3\u30c8\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u306a\u3044(\u81ea\u5206\u306f\u672a\u691c\u8a3c\u3001\u4ed5\u7d44\u307f\u7684\u306b\u540c\u6642\u306b\u66f8\u304d\u8fbc\u3093\u3060\u308a\u306f\u3067\u304d\u306a\u3044\u3053\u3068\u306f\u308f\u304b\u308b)\n\u30de\u30a6\u30f3\u30c8\u3057\u305f\u9818\u57df\u3092CIFS\u3068\u304bFTP\u3067\u5171\u6709\u3059\u3053\u3068\u3067gateway\u3068\u3057\u3066\u5229\u7528\u3067\u304d\u308b\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u521d\u65e5\u306b hironobu_s \u3055\u3093\u304cSwiftFs\u3068\u306f\u5225\u306e\u30e1\u30ea\u30c3\u30c8\u3001\u30c7\u30e1\u30ea\u30c3\u30c8\u304c\u6709\u308a\u307e\u3059\u3002\nCIFS\u9818\u57df\u3068\u3057\u3066samba\u3067\u5171\u6709\u3057\u3066\u3001\u30d5\u30a1\u30a4\u30eb\u30b5\u30fc\u30d0\u306egateway\u3068\u3057\u3066\u4f7f\u3046\u306b\u306f\u826f\u3044\u304b\u3093\u3058\u3067\u3059\u3002\n(keystone\u3068samba\u304c\u30e6\u30fc\u30b6\u60c5\u5831\u5171\u6709\u3057\u3066\u3044\u308b\u74b0\u5883\u306a\u3069\u3001\u5de5\u592b\u3057\u3066\u3001samba\u306e\u30e6\u30fc\u30b6\u306ehome dir\u3067preexec\u3068\u304b\u3059\u308b\u3068\u3001\u30e6\u30fc\u30b6\u3054\u3068\u306b\u30a2\u30ab\u30a6\u30f3\u30c8\u306eswift\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u3068\u304b\u3067\u304d\u305d\u3046\u306a\u6c17\u3082\u3057\u307e\u3059)\n\u4ed6\u306b\u3082gateway\u3068\u3057\u3066swift\u306b\u5bfe\u3057\u3066\u52d5\u4f5c\u3059\u308b\u3082\u306e\u306f\u3042\u308a\u307e\u3059\u304c\u3001cache\u3059\u308bopensource\u5b9f\u88c5\u306f\u307b\u3068\u3093\u3069\u7121\u3044\u3067\u3059\u306d\u3002s3ql + samba\u307f\u305f\u3044\u306b\u4f7f\u3046\u306e\u306f\u52d5\u4f5c\u306e\u8efd\u3055\u3082\u542b\u3081\u3066\u3059\u3054\u304f\u5408\u7406\u7684\u3067\u3059\u3002\n\u624b\u524d\u5473\u564c\u3067\u3059\u304c\u3001vm\u3064\u304f\u308b\u3068\u3053\u308d\u306e\u8a73\u3057\u304f\u306f\u3001gihyo.jp\u306e\u79c1\u306e\u8a18\u4e8b\u3068\u304b\u3092\u307f\u3066\u3082\u3089\u3063\u3066\u3082\u3044\u3044\u304b\u3082\u3002\nhttp://gihyo.jp/dev/serial/01/conoha/0005\n\u7b2c5\u56de\u3000OpenStack API\u3092\u4f7f\u3063\u305fCLI\u64cd\u4f5c\u3092ConoHa\u3067\u3084\u3063\u3066\u307f\u308b\n\u4ee5\u4e0b\u3001\u624b\u9806\u3068\u3044\u3063\u305f\u611f\u3058\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\ns3ql\u74b0\u5883\u69cb\u7bc9\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u3079\u3064\u306bCentOS 6.7\u3068\u304b\u3067\u3082\u826f\u3044\u3093\u3067\u3059\u3051\u3069\u3001python3\u306e\u74b0\u5883\u3092\u4f5c\u308a\u3084\u3059\u304f\u3001\u30d1\u30c3\u30b1\u30fc\u30b8\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3084\u3059\u3044Ubuntu 14.04\u3092\u3064\u304b\u3044\u307e\u3059\u3002\n\nopenstack\u30b3\u30de\u30f3\u30c9\u3067image list\u3067ubuntu 14.04\u3092\u3055\u304c\u3059\nOS\u306e\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\u306e\u78ba\u8a8d\u3092\u3057\u307e\u3059\u3002\n\nshell\n$ openstack image list -f csv 2>/dev/null | grep ubuntu\n\"ee695cb6-10dc-447d-8c97-f0bc54750e44\",\"vmi-docker-1.8-ubuntu-14.04\"\n\"ae6c182a-27e8-43d4-b36d-fabe2eb016f1\",\"vmi-ubuntu-12.04-i386\"\n\"e31d6093-afe9-41d0-a958-c21da36141fb\",\"vmi-ubuntu-12.04-amd64\"\n\"0477b6db-ef5b-4fa9-8ce7-ce85773425cd\",\"vmi-ubuntu-14.04-i386\"\n\"a87dfe9f-a8a4-4634-9a40-dbeba7ee7013\",\"vmi-ubuntu-14.04-amd64\"\n\"b3b42464-01c0-49bb-b360-ad4f46024775\",\"vmi-drone-0.3-ubuntu-14.04\"\n\n\nubuntu 14.04\u306e amd64 \u3068\u304b\u9078\u629e\u3057\u307e\u3059\n\nvm\u3064\u304f\u308b\u306e\u3067\u3001flavor list (1gb\u3067\u3044\u3044\u3088\u306d)\n\u4f5c\u6210\u3059\u308b\u30d7\u30e9\u30f3\u306e\u78ba\u8a8d\u3092\u3057\u307e\u3059\n\nshell\n$ openstack flavor list -f csv 2>/dev/null\n\n\"ID\",\"Name\",\"RAM\",\"Disk\",\"Ephemeral\",\"VCPUs\",\"Is Public\"\n\"294639c7-72ba-43a5-8ff2-513c8995b869\",\"g-2gb\",2048,50,0,3,True\n\"3aa001cd-95b6-46c9-a91e-e62d6f7f06a3\",\"g-16gb\",16384,50,0,8,True\n\"62e8fb4b-6a26-46cd-be13-e5bbf5614d15\",\"g-4gb\",4096,50,0,4,True\n\"7eea7469-0d85-4f82-8050-6ae742394681\",\"g-1gb\",1024,50,0,2,True\n\"965affd4-d9e8-4ffb-b9a9-624d63e2d83f\",\"g-8gb\",8192,50,0,6,True\n\"a20905c6-3733-46c4-81cc-458c7dca1bae\",\"g-32gb\",32768,50,0,12,True\n\"c2a97b05-1b4b-4038-bbcb-343201659279\",\"g-64gb\",65536,50,0,24,True\n\n\n\n\u3055\u304d\u306b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u3063\u3066\u304a\u304f\n\u5916\u304b\u3089\u306f\u3001ssh\u3060\u3051\u3067\u826f\u3044\u306e\u3067ssh\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\u3092\u4f5c\u308a\u307e\u3059\u3002\n\u30b3\u30de\u30f3\u30c9\u3060\u3051\u8cbc\u308a\u307e\u3059\u3002\ningress tcp port 22\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002\n\nshell\n$ neutron security-group-create ssh-works --description \"allow ssh connect\"\n\n$ neutron security-group-rule-create --direction ingress --ethertype IPv4 \\\n  --protocol tcp --port-range-min 22 --port-range-max 22 ssh-works -f value\n\n\n\u78ba\u8a8d(\u7121\u7406\u306byaml\u3067\u51fa\u529bw)\n\nshell\n$ neutron security-group-show ssh-works -f yaml\n- {Field: description, Value: allow ssh connect}\n- {Field: id, Value: 8ac76c8f-f4b6-4cdf-972c-1c01feadef9e}\n- {Field: name, Value: ssh-works}\n- {Field: security_group_rules, Value: \"{\\n     \\\"remote_group_id\\\": null, \\n    \\\n    \\ \\\"direction\\\": \\\"ingress\\\", \\n     \\\"remote_ip_prefix\\\": null, \\n     \\\"protocol\\\"\\\n    : \\\"tcp\\\", \\n     \\\"tenant_id\\\": \\\"aefde53ff77d4c8bba639b26ccff55fc\\\", \\n    \\\n    \\ \\\"port_range_max\\\": 22, \\n     \\\"security_group_id\\\": \\\"8ac76c8f-f4b6-4cdf-972c-1c01feadef9e\\\"\\\n    , \\n     \\\"port_range_min\\\": 22, \\n     \\\"ethertype\\\": \\\"IPv4\\\", \\n     \\\"id\\\"\\\n    : \\\"0c60065e-7ca1-47a3-9d50-4f907cbba0a3\\\"\\n}\\n{\\n     \\\"remote_group_id\\\": null,\\\n    \\ \\n     \\\"direction\\\": \\\"egress\\\", \\n     \\\"remote_ip_prefix\\\": null, \\n    \\\n    \\ \\\"protocol\\\": null, \\n     \\\"tenant_id\\\": \\\"aefde53ff77d4c8bba639b26ccff55fc\\\"\\\n    , \\n     \\\"port_range_max\\\": null, \\n     \\\"security_group_id\\\": \\\"8ac76c8f-f4b6-4cdf-972c-1c01feadef9e\\\"\\\n    , \\n     \\\"port_range_min\\\": null, \\n     \\\"ethertype\\\": \\\"IPv4\\\", \\n     \\\"id\\\"\\\n    : \\\"2eb23b65-e3f7-48bf-bfc4-2ef04d93d014\\\"\\n}\\n{\\n     \\\"remote_group_id\\\": null,\\\n    \\ \\n     \\\"direction\\\": \\\"egress\\\", \\n     \\\"remote_ip_prefix\\\": null, \\n    \\\n    \\ \\\"protocol\\\": null, \\n     \\\"tenant_id\\\": \\\"aefde53ff77d4c8bba639b26ccff55fc\\\"\\\n    , \\n     \\\"port_range_max\\\": null, \\n     \\\"security_group_id\\\": \\\"8ac76c8f-f4b6-4cdf-972c-1c01feadef9e\\\"\\\n    , \\n     \\\"port_range_min\\\": null, \\n     \\\"ethertype\\\": \\\"IPv6\\\", \\n     \\\"id\\\"\\\n    : \\\"887e34da-760a-4739-bdd6-b2bd191dc950\\\"\\n}\"}\n- {Field: tenant_id, Value: aefde53ff77d4c8bba639b26ccff55fc}\n\n\n\npublic key\u306f\u4e8b\u524d\u306b\u767b\u9332\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\n\u308f\u305f\u3057\u306f\u3001ssh public key\u306f\u969b\u306bConoHa\u306eweb\u30b3\u30f3\u30d1\u30cd\u3067\u3055\u304d\u306b\u767b\u9332\u3057\u3066\u3044\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u3001\u201dmy-local-key\u201d \u3092\u4f7f\u3044\u307e\u3059\u306e\u3067\u78ba\u8a8d\n\nshell\n$ openstack keypair list -f csv 2>/dev/null\n\"Name\",\"Fingerprint\"\n\"apps-key-2015-06-17-21-00\",\"74:a3:4f:79:92:da:5d:58:a5:0b:50:3f:5f:ed:d5:b8\"\n\"my-local-key\",\"6c:49:66:fa:67:7c:20:e6:b5:e9:75:5a:40:51:b2:5b\"\n\n\n\n\u30b5\u30fc\u30d0\u4f5c\u6210\nopenstack\u30b3\u30de\u30f3\u30c9\u3060\u3068\u3001\u30b5\u30fc\u30d0\u4f5c\u6210\u306f\u3053\u3046\u306a\u308a\u307e\u3059\u3002\n\nshell\n$ openstack server create --image vmi-ubuntu-14.04-amd64 --flavor g-1gb \\\n  --key-name my-local-key --security-group ssh-works \\\n  --property \"instance_name_tag=s3ql_repos\" new-server -f value\n\n\n\u5b9f\u884c\u306f\u3053\u3093\u306a\u611f\u3058\n\nshell\n$ openstack server create --image vmi-ubuntu-14.04-amd64 --flavor g-1gb \\\n  --key-name my-local-key --security-group ssh-works \\\n  --property \"instance_name_tag=s3ql_repos\" new-server -f value\n\nMANUAL\nnova\n\ncn-a13008.g2.sjc1.v4\nsjc1-00004ec4\n0\nNone\nbuilding\nNone\nNone\n\n\n\nFg@qYejp5\nTrue\n2015-12-12T14:12:44Z\ng-1gb (7eea7469-0d85-4f82-8050-6ae742394681)\n\n510d823c-8098-4bba-bdf0-caf4d099d2cc\nvmi-ubuntu-14.04-amd64 (a87dfe9f-a8a4-4634-9a40-dbeba7ee7013)\nmy-local-key\n163-44-113-90\n[]\n0\naefde53ff77d4c8bba639b26ccff55fc\n\n\n\u3082\u3061\u308d\u3093\u3001ConoHa\u306e\u30b3\u30f3\u30d1\u30cd\u304b\u3089\u4f5c\u6210\u3057\u3066\u3082OK\u3067\u3059\u3002\n\nssh login\u3057\u3066s3ql\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\nUbuntu\u516c\u5f0f\u304b\u3089\u306f python 2.7\u3067\u52d5\u304f\u53e4\u3044s3ql v1.16\u3057\u304b\u5165\u3063\u3066\u3044\u307e\u305b\u3093\u3002\nhttp://www.ubuntuupdates.org/package/core/trusty/universe/proposed/s3ql\ns3ql\u306e\u6700\u65b0\u7248\u306fpython3\u306e\u30b9\u30ec\u30c3\u30c9\u30e2\u30c7\u30eb\u306b\u6700\u9069\u5316\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001PPA\u3067\u5225\u7269\u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u3002\n\u305d\u306e\u524d\u306b\u3001ssh login\u3057\u3066\u3001apt\u60c5\u5831\u66f4\u65b0\n\nshell\n$ ssh root@v163-44-112-214.a009.g.sjc1.static.cnode.io\n\nroot@163-44-112-214:~# aptitude update\n\n\n\u3082\u3057\u3001s3ql 1.16\u3068\u304b\u5165\u3063\u3066\u3044\u305f\u3089\u3001\u4f7f\u3063\u3066\u306a\u3044\u306a\u3089\u524a\u9664\u3057\u3061\u3083\u3044\u307e\u3059\n\nshell\nn-gohko@helium-conoha:~$ dpkg -l s3ql\nDesired=Unknown/Install/Remove/Purge/Hold\n| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend\n|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)\n||/ Name                                           Version                      Architecture                 Description\n+++-==============================================-============================-============================-=================================================================================================\nii  s3ql                                           1.16-1                       amd64                        Full-featured file system for online data storage\n\nn-gohko@helium-conoha:~$ sudo aptitude remove s3ql\nThe following packages will be REMOVED:\n  libcrypto++9{u} libjs-jquery{u} libjs-sphinxdoc{u} libjs-underscore{u} python-apsw{u} python-llfuse{u} python-lzma{u} python-pycryptopp{u} python-support{u} s3ql\n\n\n\nPPA\u767b\u9332(ppa:nikratio/s3ql)\n\u500b\u5225\u30e1\u30f3\u30c6\u30ca\u30fc\u3067\u4f5c\u3063\u3066\u3044\u308b\u4eba\u304c\u3044\u308b\u306e\u3067\u3001PPA\u3067\u5229\u7528\u3057\u307e\u3059\nhttps://launchpad.net/~nikratio/+archive/ubuntu/s3ql\n\u3044\u304b\u306e\u30b3\u30de\u30f3\u30c9\u3067PPA\u3092\u8ffd\u52a0\u3057\u307e\u3059\nsudo add-apt-repository ppa:nikratio/s3ql \n\u5b9f\u969b\u306f\u3053\u3093\u306a\u611f\u3058\n\nshell\nn-gohko@helium-conoha:~$ sudo add-apt-repository ppa:nikratio/s3ql\n Ubuntu packages of S3QL (http://code.google.com/p/s3ql/). The PPA also contains backported versions of all dependencies for which the version in the Ubuntu archive is too old for use with S3QL.\n More info: https://launchpad.net/~nikratio/+archive/ubuntu/s3ql\nPress [ENTER] to continue or ctrl-c to cancel adding it\n\ngpg: keyring `/tmp/tmpbjizpp9z/secring.gpg' created\ngpg: keyring `/tmp/tmpbjizpp9z/pubring.gpg' created\ngpg: requesting key 9958C967 from hkp server keyserver.ubuntu.com\ngpg: /tmp/tmpbjizpp9z/trustdb.gpg: trustdb created\ngpg: key 9958C967: public key \"Launchpad S3QL\" imported\ngpg: Total number processed: 1\ngpg:               imported: 1  (RSA: 1)\nOK\nroot@163-44-112-214:~#\n\n\n\nconoha swift object storage s3ql\ns3ql\u3092OpenStack Swift\u3067\u4f7f\u3046\u8a71\u306f\u691c\u7d22\u3059\u308b\u3068\u610f\u5916\u306b\u51fa\u3066\u3053\u306a\u3044\nhttps://dev.cloudwatt.com/en/blog/s3ql-on-cloudwatt-openstack-plateform.html\n\n\n\u53c2\u7167URL (1)\n\n\nhttp://www.rath.org/s3ql-docs/manual.pdf\n\n\n\u53c2\u7167URL (2)\n\u306a\u306e\u3067\u3001\u3068\u308a\u3042\u3048\u305a\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304b\u3089\u30bd\u30fc\u30b9\u3092\u898b\u306a\u304c\u3089\u8a66\u884c\u932f\u8aa4\u3059\u308b\u3053\u3068\u306b\u306a\u308b\n(swift s3ql Softlayer, swift s3ql Rackspace\u306a\u3069\u306e\u30ad\u30fc\u30ef\u30fc\u30c9\u3067\u691c\u7d22\u3059\u308b\u3068\u3001\u3072\u3087\u3063\u3068\u3057\u305f\u3089\u51fa\u3066\u304f\u308b\u304b\u3082\u3057\u308c\u306a\u3044)\n\n\nhttps://launchpad.net/~nikratio/+archive/ubuntu/s3ql\n(Adding this PPA to your system \u3092\u898b\u3066\u300114.04LTS\u306e\u5834\u5408\u3001Trusty (14.04)\u3092\u30d7\u30eb\u30c0\u30a6\u30f3\u304b\u3089\u9078\u629e)\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\n\nshell\nsudo add-apt-repository ppa:nikratio/s3ql\n\n\nPPA\u3092\u8ffd\u52a0\u5f8c\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nshell\nsudo aptitude update && aptitude install s3ql\n\n\n\npython3\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\n\nshell\nn-gohko@helium-conoha:~$ sudo aptitude install s3ql\nThe following NEW packages will be installed:\n  libgmp10{a} libjs-jquery{a} libjs-sphinxdoc{a} libjs-underscore{a} python3-apsw{a} python3-chardet{a} python3-crypto{a} python3-defusedxml{a} python3-dugong{a} python3-llfuse{a} python3-pkg-resources{a}\n  python3-requests{a} python3-six{a} python3-urllib3{a} s3ql\n0 packages upgraded, 15 newly installed, 0 to remove and 27 not upgraded.\nNeed to get 1445 kB/1611 kB of archives. After unpacking 6698 kB will be used.\nDo you want to continue? [Y/n/?] y\n\n\n\u78ba\u8a8d\u30012.15\u304c\u5165\u3063\u3066\u3044\u308c\u3070\u5927\u4e08\u592b\n\nshell\nn-gohko@helium-conoha:~$ dpkg -l | grep s3ql\nii  s3ql                                                  2.15+dfsg-1~36~ubuntu14.04.1                        amd64        Full-featured file system for online data storage\nn-gohko@helium-conoha:~$ mkfs.s3ql --version\nS3QL 2.15\n\n\n\nopenstack client \u5165\u308c\u308b\n\nshell\nsudo apt-get install ubuntu-cloud-keyring\n\n\n\njuno\u6307\u5b9a\u306epkg\u306e\u5834\u5408\u3001\u3044\u308c\u308b\u3001\u5165\u308c\u306a\u3044\u5834\u5408\u306b\u306f\u3001ubuntu\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u5185\u90e8\u304b\u3089openstack client\u3092\u5165\u308c\u308b\u3053\u3068\u306b\u306a\u308b\n\u3068\u308a\u3042\u3048\u305a\u3001juno\u306ecloud archive\u3092\u4f7f\u3044\u307e\u3059\u3002\n\nshell\necho \"deb http://ubuntu-cloud.archive.canonical.com/ubuntu trusty-updates/juno main\" > /etc/apt/sources.list.d/cloudarchive-juno.list\n\n\n\nswift\u306eclient\u306f\u500b\u5225\u306b\u5165\u308c\u308b\n\u3042\u3068\u3067\u3001swift\u30b3\u30f3\u30c6\u30ca\u306e\u4f5c\u6210\u3068\u5185\u5bb9\u306e\u78ba\u8a8d\u306b\u4f7f\u3044\u307e\u3059\n\nshell\nn-gohko@helium-conoha:~$ sudo aptitude search swiftclient\ni   python-swiftclient                                                                                            - Client library for Openstack Swift API.\n\n\n\nOSC(OpenStack client)\u3092\u3044\u308c\u308b\n\u3055\u304d\u307b\u3069juno\u306eapt\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8a2d\u5b9a\u3057\u305f\u306e\u3067\u3001juno\u3067\u5165\u308a\u307e\u3059\u3002\nclient\u306a\u306e\u3067\u3001\u6700\u65b0\u3092\u5165\u308c\u3066\u3082\u3044\u3044\u3093\u3067\u3059\u3051\u3069\u306d\u3002\n\nshell\nn-gohko@helium-conoha:~$ sudo aptitude install python-openstackclient\n\u4ee5\u4e0b\u306e\u65b0\u898f\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3059:\n  python-cinderclient{a} python-cliff{a} python-cliff-doc{a} python-cmd2{a} python-glanceclient{a} python-json-patch{a} python-json-pointer{a} python-jsonpatch{a} python-jsonschema{a} python-keyring{a} python-mock{a}\n  python-novaclient{a} python-openstackclient python-pyparsing{a} python-secretstorage{a} python-warlock{a}\n0 \u500b\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u66f4\u65b0\u3001 16 \u500b\u3092\u65b0\u305f\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3001 0 \u500b\u3092\u524a\u9664\u4e88\u5b9a\u30011 \u500b\u304c\u66f4\u65b0\u3055\u308c\u3066\u3044\u306a\u3044\u3002\n578 k \u30d0\u30a4\u30c8\u306e\u30a2\u30fc\u30ab\u30a4\u30d6\u3092\u53d6\u5f97\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u5c55\u958b\u5f8c\u306b 4,707 k \u30d0\u30a4\u30c8\u306e\u30c7\u30a3\u30b9\u30af\u9818\u57df\u304c\u65b0\u305f\u306b\u6d88\u8cbb\u3055\u308c\u307e\u3059\u3002\n\u5148\u306b\u9032\u307f\u307e\u3059\u304b? [Y/n/?] y\n\u53d6\u5f97: 1 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-pyparsing all 2.0.1+dfsg1-1build1 [34.3 kB]\n\u53d6\u5f97: 2 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-cmd2 all 0.6.7-2fakesync1build1 [22.2 kB]\n\u53d6\u5f97: 3 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-json-pointer all 1.0-2build1 [5,158 B]\n\u53d6\u5f97: 4 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-jsonpatch all 1.3-4 [9,088 B]\n\u53d6\u5f97: 5 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-json-patch all 1.3-4 [2,312 B]\n\u53d6\u5f97: 6 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-mock all 1.0.1-3 [23.8 kB]\n\u53d6\u5f97: 7 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-jsonschema all 2.3.0-1build1 [27.2 kB]\n\u53d6\u5f97: 8 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-warlock all 1.1.0-0ubuntu2 [5,278 B]\n\u53d6\u5f97: 9 http://jp.archive.ubuntu.com/ubuntu/ trusty-updates/main python-cinderclient all 1:1.0.8-0ubuntu2 [72.4 kB]\n\u53d6\u5f97: 10 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-cliff all 1.4.5-1ubuntu2 [16.7 kB]\n\u53d6\u5f97: 11 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-keyring all 3.5-1 [51.8 kB]\n\u53d6\u5f97: 12 http://jp.archive.ubuntu.com/ubuntu/ trusty-updates/main python-novaclient all 1:2.17.0-0ubuntu1.2 [140 kB]\n\u53d6\u5f97: 13 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-glanceclient all 1:0.12.0-0ubuntu1 [34.1 kB]\n\u53d6\u5f97: 14 http://jp.archive.ubuntu.com/ubuntu/ trusty/universe python-openstackclient all 0.3.0-1ubuntu1 [81.1 kB]\n\u53d6\u5f97: 15 http://jp.archive.ubuntu.com/ubuntu/ trusty-updates/main python-secretstorage all 2.0.0-1ubuntu1.1 [11.7 kB]\n\u53d6\u5f97: 16 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-cliff-doc all 1.4.5-1ubuntu2 [40.8 kB]\n578 kB \u3092 0\u79d2 \u79d2\u3067\u53d6\u5f97\u3057\u307e\u3057\u305f (831 kB/s)\n\u4ee5\u524d\u306b\u672a\u9078\u629e\u306e\u30d1\u30c3\u30b1\u30fc\u30b8 python-pyparsing \u3092\u9078\u629e\u3057\u3066\u3044\u307e\u3059\u3002\n(\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u307e\u3059 ... \u73fe\u5728 321845 \u500b\u306e\u30d5\u30a1\u30a4\u30eb\u3068\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u307e\u3059\u3002)\n.../python-pyparsing_2.0.1+dfsg1-1build1_all.deb \u3092\u5c55\u958b\u3059\u308b\u6e96\u5099\u3092\u3057\u3066\u3044\u307e\u3059 ...\npython-pyparsing (2.0.1+dfsg1-1build1) \u3092\u5c55\u958b\u3057\u3066\u3044\u307e\u3059...\n\u4ee5\u524d\u306b\u672a\u9078\u629e\u306e\u30d1\u30c3\u30b1\u30fc\u30b8 python-cmd2 \u3092\u9078\u629e\u3057\u3066\u3044\u307e\u3059\u3002\n.../python-cmd2_0.6.7-2fakesync1build1_all.deb \u3092\u5c55\u958b\u3059\u308b\u6e96\u5099\u3092\u3057\u3066\u3044\u307e\u3059 ...\n<<<<<<<<<<<< snip >>>>>>>>>>>>\nman-db (2.6.7.1-1ubuntu1) \u306e\u30c8\u30ea\u30ac\u3092\u51e6\u7406\u3057\u3066\u3044\u307e\u3059 ...\ndoc-base (0.10.5) \u306e\u30c8\u30ea\u30ac\u3092\u51e6\u7406\u3057\u3066\u3044\u307e\u3059 ...\ndoc-base \u30d5\u30a1\u30a4\u30eb\u3092 1 \u500b\u8ffd\u52a0 \u3092\u51e6\u7406\u4e2d...\npython-pyparsing (2.0.1+dfsg1-1build1) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-cmd2 (0.6.7-2fakesync1build1) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-json-pointer (1.0-2build1) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-jsonpatch (1.3-4) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\nupdate-alternatives: /usr/bin/jsondiff (jsondiff) \u3092\u63d0\u4f9b\u3059\u308b\u305f\u3081\u306b \u81ea\u52d5\u30e2\u30fc\u30c9 \u3067 /usr/bin/python2-jsondiff \u3092\u4f7f\u3044\u307e\u3059\nupdate-alternatives: /usr/bin/jsonpatch (jsonpatch) \u3092\u63d0\u4f9b\u3059\u308b\u305f\u3081\u306b \u81ea\u52d5\u30e2\u30fc\u30c9 \u3067 /usr/bin/python2-jsonpatch \u3092\u4f7f\u3044\u307e\u3059\npython-json-patch (1.3-4) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-mock (1.0.1-3) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-jsonschema (2.3.0-1build1) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-warlock (1.1.0-0ubuntu2) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-cinderclient (1:1.0.8-0ubuntu2) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-cliff (1.4.5-1ubuntu2) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-keyring (3.5-1) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-novaclient (1:2.17.0-0ubuntu1.2) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-glanceclient (1:0.12.0-0ubuntu1) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-openstackclient (0.3.0-1ubuntu1) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-secretstorage (2.0.0-1ubuntu1.1) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-cliff-doc (1.4.5-1ubuntu2) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\n\nn-gohko@helium-conoha:~$\n\n\n\u3053\u308c\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u3053\u3053\u307e\u3067\n\ns3ql \u8a2d\u5b9a\u3068Hack (plugin\u4f5c\u6210)\n\u3053\u3053\u304b\u3089\u8a2d\u5b9a\u3068\u3001\u8a2d\u5b9a\u306e\u305f\u3081\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba(\u5fc5\u8981\u60aa)\n\nswift\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u5165\u308c\u7269\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u308b\ntokyo\u30ea\u30fc\u30b8\u30e7\u30f3\u3067swift\u30b3\u30de\u30f3\u30c9\u3067\u5165\u308c\u7269\u3092\u4f5c\u308a\u307e\u3059\u3002\n\u5f8c\u3067\u3001\u5185\u5bb9\u7269\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u3053\u306e\u8fba\u308a\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\nhttps://www.conoha.jp/conoben/archives/2648\n\nshell\nn-gohko@helium-conoha:~$ swift list \nexpandrive\nwin-hp-backup\n\nn-gohko@helium-conoha:~$ swift post s3ql_pool\n\nn-gohko@helium-conoha:~$ swift list\nexpandrive\ns3ql_pool\nwin-hp-backup\n\n\n\"s3ql_pool\" \u3068\u3044\u3046\u5165\u308c\u7269(\u30b3\u30f3\u30c6\u30ca)\u3092\u4f5c\u308a\u307e\u3057\u305f\n\n\u30ed\u30fc\u30ab\u30eb\u30b3\u30f3\u30d5\u30a3\u30b0dir\u4f5c\u6210\nfuse\u30de\u30a6\u30f3\u30c8\u3067\u3059\u306e\u3067\u3001user\u74b0\u5883\u3067\u30de\u30a6\u30f3\u30c8\u3055\u308c\u307e\u3059\u3002\nroot\u3067\u30de\u30a6\u30f3\u30c8\u3059\u308b\u5834\u5408\u306b\u306f\u3001root\u306e\u30e6\u30fc\u30b6\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u79c1\u306f\u3001\"n-gohko\"\u3067\u30de\u30a6\u30f3\u30c8\u3057\u307e\u3057\u305f\u3002rsync\u3067\u306ehome directory(Dropbox\u3092\u542b\u3080)\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u306b\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u306e\u3088\u3046\u306a\u4f7f\u3044\u65b9\u306b\u306f\u901a\u5e38\u4f7f\u3063\u3066\u3044\u308b\u30e6\u30fc\u30b6\u306e\u307b\u3046\u304c\u3088\u3044\u3067\u3059\u306d\u3002\nconfig\u3068cache\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u30e6\u30fc\u30b6Home\u306b \"~/.s3ql\" \u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nshell\nn-gohko@helium-conoha:~$ mkdir ~/.s3ql && install -b -m 600 /dev/null ~/.s3ql/authinfo2\n\n\ns3ql\u3067\u30de\u30a6\u30f3\u30c8\u3059\u308b\u5834\u6240\u3092\u4f5c\u3063\u3066\u304a\u304d\u307e\u3059\u3002\n\nshell\n$ mkdir -p ~/mnt/s3ql\n\n\n\n(\u3046\u307e\u304f\u3044\u304b\u306a\u304b\u3063\u305f)s3ql swiftks\u30b3\u30f3\u30d5\u30a3\u30b0\u4f5c\u6210\n\u672c\u6765\u306a\u3089\u3070\u3001swift\u306e\u30b3\u30f3\u30d5\u30a3\u30b0\u306fswiftks\u3068\u3044\u3046\u30bf\u30a4\u30d7\u306estorage-url\u3067\u8a2d\u5b9a\u3059\u308b\u306e\u3067\u3059\u304c\u3001\u306a\u3093\u304b\u3046\u307e\u304f\u884c\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u53c2\u7167URL (1) \u306b\u3042\u308b\u8a2d\u5b9a\u3067\u306f\n\nshell\nn-gohko@helium-conoha:~$ cat ~/.s3ql/authinfo2\n[swift]\nbackend-login: <tenant_name>:<username>\nbackend-password: <password>\nstorage-url: swiftks://identity.fr1.cloudwatt.com/fr1:<container_s3ql>\n\n\n\u3068\u3044\u3046\u611f\u3058\u3067\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nConoHa swift object storage\u3060\u3068\u3001\u6b21\u306e\u3088\u3046\u306b\u306a\u308b\u306f\u305a\u306a\u3093\u3067\u3059\u3051\u3069\u3001\u3046\u307e\u304f\u52d5\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\nshell\nn-gohko@helium-conoha:~$ cat .s3ql/authinfo2\n[swift]\nbackend-login: gnct59999999:gncu59999999\nbackend-password: hogenaisho\nstorage-url: swiftks://identity.tyo1.conoha.io/tyo1/:s3ql_pool\n\n\n\u3046\u307e\u304f\u3044\u304b\u306a\u304b\u3063\u305f\u5185\u5bb9\u306b\u3064\u3044\u3066\u8abf\u3079\u3066\u307f\u308b\u3068\u3001swiftks(keystone auth v2.0)\u306e\u8a2d\u5b9a\u3092\u52d5\u304b\u3057\u3066\u3044\u308b\u306e\u306f\u3001s3ql\u306ebackend\u30c9\u30e9\u30a4\u30d0\u3067\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nswiftks\u3067\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u691c\u7d22\u3059\u308b\u3068\u3001\u4e0b\u8a18\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u898b\u3064\u304b\u308a\u307e\u3059\u3002\n\nshell\nn-gohko@helium-conoha:~$ dpkg -L s3ql | grep swiftks\n/usr/lib/s3ql/s3ql/backends/swiftks.py\n\n\n\u958b\u304f\u3068\u3001\u6b21\u306b\u793a\u3059 \"_pase_storage_url()\" \u306e\u3068\u3053\u308d\u306b\u6b63\u898f\u8868\u73fe\u3067storage-url\u3092\u5206\u89e3\u3057\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u611f\u3058\u3002\n\nshell\nn-gohko@helium-conoha:~$ cat -n /usr/lib/s3ql/s3ql/backends/swiftks.py | head -n 57 | tail -n 31\n    27\n    28      @copy_ancestor_docstring\n    29      def _parse_storage_url(self, storage_url, ssl_context):\n    30\n    31          hit = re.match(r'^[a-zA-Z0-9]+://' # Backend\n    32                         r'([^/:]+)' # Hostname\n    33                         r'(?::([0-9]+))?' # Port\n    34                         r'/([a-zA-Z0-9._-]+):' # Region\n    35                         r'([^/]+)' # Bucketname\n    36                         r'(?:/(.*))?$', # Prefix\n    37                         storage_url)\n    38          if not hit:\n    39              raise QuietError('Invalid storage URL', exitcode=2)\n    40\n    41          hostname = hit.group(1)\n    42          if hit.group(2):\n    43              port = int(hit.group(2))\n    44          elif ssl_context:\n    45              port = 443\n    46          else:\n    47              port = 80\n    48          region = hit.group(3)\n    49          containername = hit.group(4)\n    50          prefix = hit.group(5) or ''\n    51\n    52          self.hostname = hostname\n    53          self.port = port\n    54          self.container_name = containername\n    55          self.prefix = prefix\n    56          self.region = region\n    57\n\n\n\nshell\nn-gohko@helium-conoha:~$ mkfs.s3ql --plain --authfile ~/.s3ql/authinfo2 \\\n  --debug swiftks://identity.tyo1.conoha.io/tyo1/:s3ql_pool\n2015-12-13 04:00:12.492 15887 MainThread s3ql.backends.common.get_ssl_context: Reading default CA certificates.\n2015-12-13 04:00:12.493 15887 MainThread root.excepthook: Invalid storage URL\n\n\n\u3068\u3044\u3046\u611f\u3058\u3067\u3001\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u3001\u3046\u3046\u3002\nrackspace\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u306f\u3046\u307e\u304f\u3044\u3063\u305f\u306e\u3067\u3001\u30a8\u30e9\u30fc\u306estorage url\u306e\u3068\u3053\u308d\u3067\u8a70\u307e\u3063\u3066\u3044\u308b\u3060\u308d\u3046\u3068\u304a\u3082\u3063\u305f\u306e\u3067\u3059\u3002\n\u3044\u308d\u3044\u308d\u3084\u3063\u305f\u306e\u3067\u3059\u304c\u3001Hack\u3067\u5207\u308a\u629c\u3051\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\n(Hack) conohaswift\u3068\u3044\u3046storage URL\u3092rackspace\u306e\u8907\u88fd\u3057\u3066\u4f5c\u308b\n\u3053\u3053\u3067\u3001\u9762\u5012\u306b\u306a\u3063\u305f\u306e\u3067\u3001conohaswift\u3068\u3044\u3046storage plugin\u3092\u4f5c\u3063\u3066\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\nbackend\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u30d7\u30e9\u30b0\u30a4\u30f3\u306fgrep\u3059\u308b\u3068backends\u3068\u3044\u3046\u5834\u6240\u306b\u5165\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\nshell\nn-gohko@163-44-112-214:~$ dpkg -L s3ql | grep backends\n/usr/share/doc/s3ql/html/_sources/backends.txt\n/usr/share/doc/s3ql/html/backends.html\n/usr/lib/s3ql/s3ql/backends\n/usr/lib/s3ql/s3ql/backends/gs.py\n/usr/lib/s3ql/s3ql/backends/rackspace.py\n/usr/lib/s3ql/s3ql/backends/s3.py\n/usr/lib/s3ql/s3ql/backends/s3c.py\n/usr/lib/s3ql/s3ql/backends/swift.py\n/usr/lib/s3ql/s3ql/backends/common.py\n/usr/lib/s3ql/s3ql/backends/local.py\n/usr/lib/s3ql/s3ql/backends/pool.py\n/usr/lib/s3ql/s3ql/backends/__init__.py\n/usr/lib/s3ql/s3ql/backends/swiftks.py\n/usr/lib/s3ql/s3ql/backends/comprenc.py\n\n\nrackspace class\u306f\u3001swiftks  class\u3092\u305d\u306e\u307e\u307e\u547c\u3093\u3067\u3044\u3066\u3001\"_pase_storage_url()\" \u306e\u3068\u3053\u308d\u3067swiftks\u306e\u8a8d\u8a3c\u3092\u4e0a\u66f8\u304d\u3057\u3066\u3044\u307e\u3059\u3002\n\u306a\u306e\u3067\u3001\u3053\u308c\u306b\u7fd2\u3063\u3066\u3001conohaswift.py \u3068\u3044\u3046\u30c9\u30e9\u30a4\u30d0\u30d5\u30a1\u30a4\u30eb\u3092 rackspace.py \u306e\u8907\u88fd\u3068\u3057\u3066\u4f5c\u3063\u3066\u3001storage URL\u306e\u30d1\u30fc\u30b9\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059\u3002\n\nshell\nn-gohko@163-44-112-214:~$ pushd /usr/lib/s3ql/s3ql/backends/\n/usr/lib/s3ql/s3ql/backends ~\n\nn-gohko@163-44-112-214:/usr/lib/s3ql/s3ql/backends$ sudo cp -avf rackspace.py conohaswift.py\nsudo: unable to resolve host 163-44-112-214\n[sudo] password for n-gohko:\n'rackspace.py' -> 'conohaswift.py'\n\n\n\u30d0\u30c4\u30af\u30a8\u30f3\u30c9\u306e\u4e2d\u8eab\n\nshell\nn-gohko@163-44-112-214:/usr/lib/s3ql/s3ql/backends$ ls -l\ntotal 180\n-rw-r--r-- 1 root root   634 Sep 18 08:42 __init__.py\ndrwxr-xr-x 2 root root  4096 Dec 12 06:44 __pycache__\n-rw-r--r-- 1 root root 22827 Sep 18 08:42 common.py\n-rw-r--r-- 1 root root 33419 Sep 28 20:09 comprenc.py\n-rw-r--r-- 1 root root  1232 Sep 18 08:42 conohaswift.py\n-rw-r--r-- 1 root root  9859 Sep 18 08:42 gs.py\n-rw-r--r-- 1 root root 10241 Sep 28 20:09 local.py\n-rw-r--r-- 1 root root  1872 Sep 18 08:42 pool.py\n-rw-r--r-- 1 root root  1232 Sep 18 08:42 rackspace.py\n-rw-r--r-- 1 root root  6270 Sep 18 08:42 s3.py\n-rw-r--r-- 1 root root 37709 Sep 28 20:09 s3c.py\n-rw-r--r-- 1 root root 19233 Sep 18 08:42 swift.py\n-rw-r--r-- 1 root root  4736 Sep 18 08:42 swiftks.py\n\n\n\nconohaswift.py\u306e\u4e2d\u8eab\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n/usr/lib/s3ql/s3ql/backends/conohaswift.py\n'''\nconohaswift.py - this file is part of S3QL.\n\nCopyright \u00a9 215 n-gohko\n\nThis work can be distributed under the terms of the GNU GPLv3.\n'''\n\nfrom ..logging import logging, QuietError # Ensure use of custom logger class\nfrom . import swiftks\nfrom ..inherit_docstrings import copy_ancestor_docstring\nimport re\n\nlog = logging.getLogger(__name__)\n\nclass Backend(swiftks.Backend):\n    \"\"\"A backend to store data in ConoHa swift Object Storage\"\"\"\n\n    @copy_ancestor_docstring\n    def _parse_storage_url(self, storage_url, ssl_context):\n\n        hit = re.match(r'^conohaswift://' # Backend\n                       r'([^/:]+)' # Region\n                       r'/([^/]+)' # Bucketname\n                       r'(?:/(.*))?$', # Prefix\n                       storage_url)\n        if not hit:\n            raise QuietError('Invalid storage URL', exitcode=2)\n\n        region = hit.group(1)\n        containername = hit.group(2)\n        prefix = hit.group(3) or ''\n\n        if ssl_context:\n            port = 443\n        else:\n            port = 80\n        port = 443\n\n        self.hostname = 'identity.tyo1.conoha.io'\n        self.port = port\n        self.container_name = containername\n        self.prefix = prefix\n        self.region = region\n\n\n\nbackends \u306e\u30ed\u30fc\u30c9\u306e\u8a2d\u5b9a\u306b\u8ffd\u52a0\u3059\u308b\u305f\u3081\u306b\u3001\u201d__init__.py\u201d \u30d5\u30a1\u30a4\u30eb\u3092\u4fee\u6b63\u3057\u307e\u3059\u3002\n\n/usr/lib/s3ql/s3ql/backends/__init__.py\n'''\nbackends/__init__.py - this file is part of S3QL.\n\nCopyright \u00a9 2008 Nikolaus Rath <Nikolaus@rath.org>\n\nThis work can be distributed under the terms of the GNU GPLv3.\n'''\n\nfrom . import local, s3, gs, s3c, swift, rackspace, swiftks, conohaswift\n\n#: Mapping from storage URL prefixes to backend classes\nprefix_map = { 's3': s3.Backend,\n               'local': local.Backend,\n               'gs': gs.Backend,\n               's3c': s3c.Backend,\n               'swift': swift.Backend,\n               'conohaswift': conohaswift.Backend,\n               'swiftks': swiftks.Backend,\n               'rackspace': rackspace.Backend }\n\n__all__ = [ 'common', 'pool', 'comprenc' ] + list(prefix_map.keys())\n\n\n\n\n(Hack:2) conohaswift\u3068\u3044\u3046storage URL\u3067\u63a5\u7d9a\u3059\u308b\n\u66f8\u304d\u63db\u3048\u305f\u306e\u3067\u3001\u30de\u30a6\u30f3\u30c8\u3059\u308b\u30e6\u30fc\u30b6\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u623b\u3063\u3066\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\n\nshell\nn-gohko@163-44-112-214:~$ cat .s3ql/authinfo2\n[swift]\nbackend-login: gnct59999999:gncu59999999\nbackend-password: hogenaisho\nstorage-url: conohaswift://tyo1/s3ql_pool\n\n\nmkfs.s3ql\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u201d--debug\u201d\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u52d5\u4f5c\u78ba\u8a8d\u306e\u305f\u3081\u306a\u306e\u3067\u3001\nmkfs.s3ql --plain --authfile ~/.s3ql/authinfo2 conohaswift://tyo1/s3ql_poo\n\u307f\u305f\u3044\u306a\u611f\u3058\u3067\u826f\u3044\u3067\u3059\u3002\n\nshell\nn-gohko@163-44-112-214:~$ mkfs.s3ql --plain --authfile ~/.s3ql/authinfo2 --debug conohaswift://tyo1/s3ql_pool\n2015-12-13 04:43:17.027 15989 MainThread s3ql.backends.common.get_ssl_context: Reading default CA certificates.\n2015-12-13 04:43:17.027 15989 MainThread s3ql.backends.swift._do_request: started with 'GET', '/', None, {'limit': 1}, None, None\n2015-12-13 04:43:17.027 15989 MainThread s3ql.backends.swift._do_request: no active connection, calling _get_conn()\n2015-12-13 04:43:17.027 15989 MainThread s3ql.backends.swiftks._get_conn: started\n<< snip >>\n2015-12-13 04:43:21.904 15989 MainThread s3ql.backends.swift.open_write: started with s3ql_seq_no_1\n2015-12-13 04:43:21.904 15989 MainThread s3ql.backends.s3c.close: started with s3ql_seq_no_1\n2015-12-13 04:43:21.904 15989 MainThread s3ql.backends.swift._do_request: started with 'PUT', '/s3ql_seq_no_1', None, None, CaseInsensitiveDict({'Content-Type': 'application/octet-stream', 'X-Object-meta-002': \"'encryption': 'None',\", 'X-Object-meta-format': 'raw2', 'X-Object-meta-001': \"'compression': 'LZMA',\", 'X-Object-meta-003': \"'format_version': 2,\", 'X-Object-meta-000': \"'data': b'eyAgfQ==',\", 'X-Object-meta-md5': '1UH6aTHbuVf1fhc0/H8WUA=='}), <_io.FileIO name=6 mode='rb+'>\n2015-12-13 04:43:21.905 15989 MainThread s3ql.backends.swift._do_request_inner: started with PUT /v1/nc_aefde53ff77d4c8bba639b26ccff55fc/s3ql_pool/s3ql_seq_no_1\n2015-12-13 04:43:21.905 15989 MainThread s3ql.backends.swift._do_request_inner: waiting for 100-continue\n2015-12-13 04:43:22.030 15989 MainThread s3ql.backends.swift._do_request_inner: writing body data\nn-gohko@163-44-112-214:~$\n\n\nHack\u3067\u4f5c\u3063\u305f\u3042\u3089\u305f\u306astorage url\u3067\u30de\u30a6\u30f3\u30c8\u3057\u307e\u3059\u3002\nmount.s3ql  conohaswift://tyo1/s3ql_pool ~/mnt/s3ql\n\nshell\nn-gohko@163-44-112-214:~$ mount.s3ql  conohaswift://tyo1/s3ql_pool ~/mnt/s3ql\nUsing 4 upload threads.\nAutodetected 4052 file descriptors available for cache entries\nUsing cached metadata.\nSetting cache size to 33058 MB\nMounting filesystem...\n\n\n\u30de\u30a6\u30f3\u30c8\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\n```bash:shell\nn-gohko@163-44-112-214:~$ df\nFilesystem                    1K-blocks    Used  Available Use% Mounted on\n/dev/vda1                      50442940 5542204   42315344  12% /\nnone                                  4       0          4   0% /sys/fs/cgroup\nudev                             497964      12     497952   1% /dev\ntmpfs                            101748     388     101360   1% /run\nnone                               5120       0       5120   0% /run/lock\nnone                             508736       0     508736   0% /run/shm\nnone                             102400       0     102400   0% /run/user\nconohaswift://tyo1/s3ql_pool 1073741824       0 1073741824   0% /home/n-gohko/mnt/s3ql\n```\n\n\u306a\u306b\u3082\u30b3\u30d4\u30fc\u3057\u3066\u3044\u306a\u3044\u72b6\u614b\nmkfs.s3ql\u3067Format\u3057\u3066\u3001\u30de\u30a6\u30f3\u30c8\u3057\u305f\u72b6\u614b\u3067\u3001swift\u30b3\u30f3\u30c6\u30ca\u201ds3ql_pool\u201d\u306e\u4e2d\u8eab\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\nshell\n[n-gohko@163-44-112-214]$ swift list --lh s3ql_pool 2>/dev/null\n 120 2015-12-13 12:43:21 s3ql_metadata\n 120 2015-12-13 12:43:19 s3ql_metadata_new\n  64 2015-12-13 12:43:21 s3ql_seq_no_1\n  64 2015-12-13 12:46:15 s3ql_seq_no_2\n 368\n\n\n\u521d\u671f\u72b6\u614b\u3067\u306f\u3001\u30e1\u30bf\u30c7\u30fc\u30bf\u30d5\u30a1\u30a4\u30eb\u3060\u3051\u3042\u308a\u307e\u3059\u3002\nmkfs.s3ql\u3092\u201d--plain\u201d\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u305f\u3053\u3068\u3067\u3001\u6697\u53f7\u5316\u306f\u7121\u3057\u3067\u3059\u3002\n\n\u81ea\u5206devel\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092rsync\u3059\u308b\n\u3067\u306f\u3001rsync\u3067\u66f8\u304d\u8fbc\u3093\u3067\u307f\u307e\u3057\u3087\u3046\u3002\n\u624b\u5143\u306e \u201c~/devel\u201d \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c 3.7GB\u3050\u3044\u3089\u3042\u308b\u306e\u3067\u3001\u66f8\u304d\u8fbc\u3093\u3067\u307f\u307e\u3059\u3002\nbash:shell\nn-gohko@163-44-112-214:~$ du -hs devel\n3.7G    devel\n\nrsync\u4e2d\u306b\u30de\u30a6\u30f3\u30c8\u3055\u308c\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u6b21\u306e\u3088\u3046\u306b\u898b\u3048\u307e\u3059\u3002\n\nshell\n[n-gohko@163-44-112-214]$ ls -l ~/mnt/s3ql/\ntotal 0\ndrwxrwxr-x 1 n-gohko n-gohko 0 Sep 28 20:31 devel\ndrwx------ 1 n-gohko n-gohko 0 Dec 13 04:43 lost+found\n\n\n\u30a2\u30ab\u30a6\u30f3\u30c8\u8a2d\u5b9a\u3092\u5148\u307b\u3069\u304a\u3044\u305f \u201c~/.s3ql\u201d \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4e2d\u8eab\u3092\u898b\u308b\u3068\u3001\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\nshell\n[n-gohko@163-44-112-214]$ du -hs ~/.s3ql/*\n4.0K    /home/n-gohko/.s3ql/authinfo2\n68M     /home/n-gohko/.s3ql/conohaswift:=2F=2Ftyo1=2Fs3ql_pool-cache\n1.8M    /home/n-gohko/.s3ql/conohaswift:=2F=2Ftyo1=2Fs3ql_pool.db\n4.0K    /home/n-gohko/.s3ql/conohaswift:=2F=2Ftyo1=2Fs3ql_pool.params\n4.0K    /home/n-gohko/.s3ql/mount.log\n0       /home/n-gohko/.s3ql/mount.s3ql_crit.log\n\n\ncache\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u8ee2\u9001\u306ecache\u3001.db\u30d5\u30a1\u30a4\u30eb\u306fsqlite\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002\n\u5b9f\u306f\u3001\u3053\u306e\u4ed5\u7d44\u3067\u3001\u30d5\u30a1\u30a4\u30eb\u3092\u7ba1\u7406\u3057\u3066\u3044\u308b\u306e\u304c\u3001\u3053\u306edb\u306a\u306e\u3067\u3001\u3053\u306edb\u3092\u30de\u30eb\u30c1\u30ce\u30fc\u30c9\u3067\u5171\u6709\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308c\u3070\u3001\u8907\u6570\u306e\u30ce\u30fc\u30c9\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3088\u3046\u306b\u3067\u304d\u308b\u306e\u304b\u306a\u3068\u601d\u3044\u307e\u3057\u305f\u3002\n\nshell\n[n-gohko@163-44-112-214]$ file ~/.s3ql/conohaswift:=2F=2Ftyo1=2Fs3ql_pool.db\n/home/n-gohko/.s3ql/conohaswift:=2F=2Ftyo1=2Fs3ql_pool.db: SQLite 3.x database\n\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u30d5\u30a1\u30a4\u30eb .params \u306f\u30c6\u30ad\u30b9\u30c8\u306bjson\u3067\u66f8\u3044\u3066\u3042\u308b\u307f\u305f\u3044\u3067\u3059\u306d\nbash:shell\n[n-gohko@163-44-112-214]$ file ~/.s3ql/conohaswift:=2F=2Ftyo1=2Fs3ql_pool.params\n/home/n-gohko/.s3ql/conohaswift:=2F=2Ftyo1=2Fs3ql_pool.params: ASCII text, with no line terminators\n\nrsync\u306e\u9014\u4e2d\u3067 du \u3068\u304b\u3082\u53d6\u308c\u307e\u3059\u3002\nbash:shell\nn-gohko@163-44-112-214:~$ du -hs ~/mnt/s3ql/devel\n1.7G    /home/n-gohko/mnt/s3ql/devel\n\n\u30e1\u30bf\u30c7\u30fc\u30bf\u3068\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30c7\u30fc\u30bf\u306b\u5225\u308c\u3066\u30c7\u30fc\u30bf\u304c\u8ee2\u9001\u3055\u308c\u308b\u3002\n\u30c7\u30fc\u30bf\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u5358\u4f53\u3067\u306f\u3001\u305d\u306e\u307e\u307e\u3067\u306f\u3001\u3069\u308c\u304c\u3069\u308c\u304b\u306f\u308f\u304b\u3089\u306a\u3044\u3067\u3059\u306d\u3002\n\u30e1\u30bf\u30c7\u30fc\u30bf\u30d5\u30a1\u30a4\u30eb\u3082\u3042\u308a\u307e\u3059\u3002\n\nshell\n[n-gohko@163-44-112-214]$ swift list --lh s3ql_pool  2>/dev/null | grep -v '_data_'\n 120 2015-12-13 12:43:21 s3ql_metadata\n 120 2015-12-13 12:43:19 s3ql_metadata_new\n  64 2015-12-13 12:43:21 s3ql_seq_no_1\n  64 2015-12-13 12:46:15 s3ql_seq_no_2\n1.1G\n\n\ndata\u30d5\u30a1\u30a4\u30eb\u306f\u305f\u304f\u3055\u3093\u306a\u306e\u3067\u3001\u3061\u3087\u3063\u3068\u3060\u3051\n\nshell\n[n-gohko@163-44-112-214] $ swift list --lh s3ql_pool  2>/dev/null | grep  '_data_' | head -n 3\n 116 2015-12-13 12:55:30 s3ql_data_1\n746K 2015-12-13 12:55:35 s3ql_data_10\n 79K 2015-12-13 12:56:36 s3ql_data_100\n\n\ns3ql\u306eumount\u306f\u3001\u6b21\u306e\u3088\u3046\u306bumount.s3ql \u3092\u4f7f\u3044\u307e\u3059\u3002\nbash:shell\n[n-gohko@163-44-112-214]$ umount.s3ql ~/mnt/s3ql\n[n-gohko@163-44-112-214]$ ls -l ~/mnt/s3ql/\ntotal 0\n\n\u6b21\u306b\u30de\u30a6\u30f3\u30c8\u3055\u308c\u305f\u6642\u306b\u3001cache\u30b5\u30a4\u30ba\u306f\u66f4\u65b0\u3055\u308c\u307e\u3059\u3002\nbash:shell\nn-gohko@163-44-112-214:~$ mount.s3ql  conohaswift://tyo1/s3ql_pool ~/mnt/s3ql\nUsing 4 upload threads.\nAutodetected 4052 file descriptors available for cache entries\nUsing cached metadata.\nSetting cache size to 33052 MB\nMounting filesystem...\nn-gohko@163-44-112-214:~$\n\n\u3044\u308d\u3044\u308ddevel\u306b\u5165\u308c\u3066\u3044\u305f\u306e\u3067\u3001\u65e5\u672c\u8a9e\u30d5\u30a1\u30a4\u30eb\u542b\u3081\u3066\u8ee2\u9001\u3002\n\u3068\u304f\u306b\u65e5\u672c\u8a9e\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u3082\u305d\u306e\u307e\u307e\u3002\n\u7d50\u5c40\u3001~/.s3ql/  \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u308b\u306e\u3067\u3001\u30ed\u30fc\u30ab\u30eb\u30c7\u30a3\u30b9\u30af\u306e\u901f\u5ea6\u304c\u66f8\u304d\u8fbc\u307f\u901f\u5ea6\u3068\u306a\u308b\u3002\n\n\u6700\u5f8c\u306b\n\u3068\u308a\u3042\u3048\u305a\u3001mount\u3057\u3066\u3001rsync\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u3067\u3059\u304c\u3001\u7d44\u307f\u5408\u308f\u305b\u306e\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3084\u6539\u4fee\u306e\u5185\u5bb9\u306f\u3061\u3087\u3063\u3068\u81a8\u3089\u307f\u307e\u3059\u3002s3ql\u306e\u958b\u767a\u306e\u672c\u5bb6\u304c\u3069\u3046\u3044\u3046\u65b9\u5411\u6027\u3067\u3084\u3063\u3066\u3044\u308b\u306e\u304b\u3082\u6c17\u306b\u306a\u308a\u307e\u3059\u3002\n\u8ffd\u8a18: \u3053\u306e\u8a18\u4e8b\u306f[ConoHa Advent Calendar 2015](http://qiita.com/advent-calendar/2015/conoha)\u306e\u8a18\u4e8b\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u4fee\u6b631(2015/12/14 18:00): openstack server create ... \u306e\u30b3\u30de\u30f3\u30c9\u3067\u3001instance_name_tag=\u3092\u6307\u5b9a\u3059\u308b\u3068\u3053\u308d\u3092'\"(\u30c0\u30d6\u30eb\u30af\u30aa\u30fc\u30c8)'\u3067\u304f\u304f\u308b\u3088\u3046\u306b\u8868\u8a18\u3092\u5909\u3048\u307e\u3057\u305f\u3002\u30b7\u30f3\u30b0\u30eb\u30af\u30aa\u30fc\u30c8\u3060\u3068\u3001\\u2018 \\u2019\u306eunicode\u306e\u30af\u30aa\u30fc\u30c8\u306b\u8868\u793a\u304c\u306a\u3063\u3066\u3044\u305f\u307f\u305f\u3044\u3067\u3001\u7d1b\u3089\u308f\u3057\u3044\u306e\u3067\u4fee\u6b63\u3002\n\n\u4fee\u6b632(2015/12/21 16:00): swiftks storage url\u306e\u6307\u5b9a\u65b9\u6cd5\u306b\u3064\u3044\u3066\u3001\u5225\u8a18\u4e8b\u3067\u6307\u6458\u304c\u3042\u308a\u307e\u3057\u305f\u3002\u72ec\u81ea\u30c9\u30e9\u30a4\u30d0\u3092\u4f5c\u3089\u306a\u304f\u3066\u3082\u826f\u3044\u307f\u305f\u3044\u3067\u3059\u306e\u3067\u3001\u3053\u3061\u3089\u3092\u898b\u3066storage url\u3092\u8a2d\u5b9a\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002(http://qiita.com/hikaru_uchiyama/items/504b7e5e75f747c12366)\n\n\u300cConoHa\u306eVM\u3067Ubuntu 14.04\u3092\u4f7f\u3063\u3066s3ql\u3067Swift Object Storage\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u300d\u3068\u3044\u3046\u30bf\u30a4\u30c8\u30eb\u306a\u3093\u3067\u3059\u3051\u3069\u3001\u306a\u3093\u3067s3ql\u3068\u304b\u3044\u3046\u3068\u3001\u3053\u306efuse\u30de\u30a6\u30f3\u30c8\u306e\u7279\u5fb4\u306f\u3001\u4e0b\u8a18\u306e\u611f\u3058\u306b\u306a\u308a\u307e\u3059\u3002\n\n  - \u6700\u65b0\u7248\u306fpython3\u30d9\u30fc\u30b9\u3067\u52d5\u304f\n  - Large file\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\n  - \u66f8\u304d\u8fbc\u307f\u3001\u8aad\u307f\u8fbc\u307f\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u3059\u308b\u306e\u3067\u57fa\u672c\u7684\u306b\u30de\u30a6\u30f3\u30c8\u3059\u308b\u74b0\u5883(cache)\u306edisk\u306e\u901f\u5ea6\u306b\u4f9d\u5b58\u3059\u308b\n  - \u5f8c\u3067\u4e2d\u8eab\u3092\u5b9f\u969b\u306b\u898b\u307e\u3059\u304c\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306fs3ql\u306edata\u5f62\u5f0f\u3067\u8ee2\u9001\u3055\u308c\u308b\u306e\u3067\u3001\u4e2d\u8eab\u306f\u30de\u30a6\u30f3\u30c8\u3057\u306a\u3044\u3068\u308f\u304b\u3089\u306a\u3044\n  - \u30de\u30a6\u30f3\u30c8\u3057\u3066\u3044\u308b\u74b0\u5883\u306ecache\u3084encrypt\u306e\u4ed5\u7d44\u307f\u306b\u4f9d\u5b58\u3059\u308b\u306e\u3067\u3001\u8907\u6570\u306e\u30b5\u30fc\u30d0\u3067\u306e\u30de\u30a6\u30f3\u30c8\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u306a\u3044(\u81ea\u5206\u306f\u672a\u691c\u8a3c\u3001\u4ed5\u7d44\u307f\u7684\u306b\u540c\u6642\u306b\u66f8\u304d\u8fbc\u3093\u3060\u308a\u306f\u3067\u304d\u306a\u3044\u3053\u3068\u306f\u308f\u304b\u308b)\n  - \u30de\u30a6\u30f3\u30c8\u3057\u305f\u9818\u57df\u3092CIFS\u3068\u304bFTP\u3067\u5171\u6709\u3059\u3053\u3068\u3067gateway\u3068\u3057\u3066\u5229\u7528\u3067\u304d\u308b\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u521d\u65e5\u306b hironobu_s \u3055\u3093\u304cSwiftFs\u3068\u306f\u5225\u306e\u30e1\u30ea\u30c3\u30c8\u3001\u30c7\u30e1\u30ea\u30c3\u30c8\u304c\u6709\u308a\u307e\u3059\u3002\n\nCIFS\u9818\u57df\u3068\u3057\u3066samba\u3067\u5171\u6709\u3057\u3066\u3001\u30d5\u30a1\u30a4\u30eb\u30b5\u30fc\u30d0\u306egateway\u3068\u3057\u3066\u4f7f\u3046\u306b\u306f\u826f\u3044\u304b\u3093\u3058\u3067\u3059\u3002\n(keystone\u3068samba\u304c\u30e6\u30fc\u30b6\u60c5\u5831\u5171\u6709\u3057\u3066\u3044\u308b\u74b0\u5883\u306a\u3069\u3001\u5de5\u592b\u3057\u3066\u3001samba\u306e\u30e6\u30fc\u30b6\u306ehome dir\u3067preexec\u3068\u304b\u3059\u308b\u3068\u3001\u30e6\u30fc\u30b6\u3054\u3068\u306b\u30a2\u30ab\u30a6\u30f3\u30c8\u306eswift\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u3068\u304b\u3067\u304d\u305d\u3046\u306a\u6c17\u3082\u3057\u307e\u3059)\n\n\u4ed6\u306b\u3082gateway\u3068\u3057\u3066swift\u306b\u5bfe\u3057\u3066\u52d5\u4f5c\u3059\u308b\u3082\u306e\u306f\u3042\u308a\u307e\u3059\u304c\u3001cache\u3059\u308bopensource\u5b9f\u88c5\u306f\u307b\u3068\u3093\u3069\u7121\u3044\u3067\u3059\u306d\u3002s3ql + samba\u307f\u305f\u3044\u306b\u4f7f\u3046\u306e\u306f\u52d5\u4f5c\u306e\u8efd\u3055\u3082\u542b\u3081\u3066\u3059\u3054\u304f\u5408\u7406\u7684\u3067\u3059\u3002\n\n\u624b\u524d\u5473\u564c\u3067\u3059\u304c\u3001vm\u3064\u304f\u308b\u3068\u3053\u308d\u306e\u8a73\u3057\u304f\u306f\u3001gihyo.jp\u306e\u79c1\u306e\u8a18\u4e8b\u3068\u304b\u3092\u307f\u3066\u3082\u3089\u3063\u3066\u3082\u3044\u3044\u304b\u3082\u3002\nhttp://gihyo.jp/dev/serial/01/conoha/0005\n\u7b2c5\u56de\u3000OpenStack API\u3092\u4f7f\u3063\u305fCLI\u64cd\u4f5c\u3092ConoHa\u3067\u3084\u3063\u3066\u307f\u308b\n\n\u4ee5\u4e0b\u3001\u624b\u9806\u3068\u3044\u3063\u305f\u611f\u3058\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n# s3ql\u74b0\u5883\u69cb\u7bc9\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u3079\u3064\u306bCentOS 6.7\u3068\u304b\u3067\u3082\u826f\u3044\u3093\u3067\u3059\u3051\u3069\u3001python3\u306e\u74b0\u5883\u3092\u4f5c\u308a\u3084\u3059\u304f\u3001\u30d1\u30c3\u30b1\u30fc\u30b8\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3084\u3059\u3044Ubuntu 14.04\u3092\u3064\u304b\u3044\u307e\u3059\u3002\n\n## openstack\u30b3\u30de\u30f3\u30c9\u3067image list\u3067ubuntu 14.04\u3092\u3055\u304c\u3059\nOS\u306e\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\u306e\u78ba\u8a8d\u3092\u3057\u307e\u3059\u3002\n\n```bash:shell\n$ openstack image list -f csv 2>/dev/null | grep ubuntu\n\"ee695cb6-10dc-447d-8c97-f0bc54750e44\",\"vmi-docker-1.8-ubuntu-14.04\"\n\"ae6c182a-27e8-43d4-b36d-fabe2eb016f1\",\"vmi-ubuntu-12.04-i386\"\n\"e31d6093-afe9-41d0-a958-c21da36141fb\",\"vmi-ubuntu-12.04-amd64\"\n\"0477b6db-ef5b-4fa9-8ce7-ce85773425cd\",\"vmi-ubuntu-14.04-i386\"\n\"a87dfe9f-a8a4-4634-9a40-dbeba7ee7013\",\"vmi-ubuntu-14.04-amd64\"\n\"b3b42464-01c0-49bb-b360-ad4f46024775\",\"vmi-drone-0.3-ubuntu-14.04\"\n```\n\nubuntu 14.04\u306e amd64 \u3068\u304b\u9078\u629e\u3057\u307e\u3059\n\n## vm\u3064\u304f\u308b\u306e\u3067\u3001flavor list (1gb\u3067\u3044\u3044\u3088\u306d)\n\u4f5c\u6210\u3059\u308b\u30d7\u30e9\u30f3\u306e\u78ba\u8a8d\u3092\u3057\u307e\u3059\n\n```bash:shell\n$ openstack flavor list -f csv 2>/dev/null\n\n\"ID\",\"Name\",\"RAM\",\"Disk\",\"Ephemeral\",\"VCPUs\",\"Is Public\"\n\"294639c7-72ba-43a5-8ff2-513c8995b869\",\"g-2gb\",2048,50,0,3,True\n\"3aa001cd-95b6-46c9-a91e-e62d6f7f06a3\",\"g-16gb\",16384,50,0,8,True\n\"62e8fb4b-6a26-46cd-be13-e5bbf5614d15\",\"g-4gb\",4096,50,0,4,True\n\"7eea7469-0d85-4f82-8050-6ae742394681\",\"g-1gb\",1024,50,0,2,True\n\"965affd4-d9e8-4ffb-b9a9-624d63e2d83f\",\"g-8gb\",8192,50,0,6,True\n\"a20905c6-3733-46c4-81cc-458c7dca1bae\",\"g-32gb\",32768,50,0,12,True\n\"c2a97b05-1b4b-4038-bbcb-343201659279\",\"g-64gb\",65536,50,0,24,True\n```\n\n## \u3055\u304d\u306b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u3063\u3066\u304a\u304f\n\u5916\u304b\u3089\u306f\u3001ssh\u3060\u3051\u3067\u826f\u3044\u306e\u3067ssh\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\u3092\u4f5c\u308a\u307e\u3059\u3002\n\u30b3\u30de\u30f3\u30c9\u3060\u3051\u8cbc\u308a\u307e\u3059\u3002\n\ningress tcp port 22\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002\n\n```bash:shell\n$ neutron security-group-create ssh-works --description \"allow ssh connect\"\n\n$ neutron security-group-rule-create --direction ingress --ethertype IPv4 \\\n  --protocol tcp --port-range-min 22 --port-range-max 22 ssh-works -f value\n```\n\n\u78ba\u8a8d(\u7121\u7406\u306byaml\u3067\u51fa\u529bw)\n\n```bash:shell\n$ neutron security-group-show ssh-works -f yaml\n- {Field: description, Value: allow ssh connect}\n- {Field: id, Value: 8ac76c8f-f4b6-4cdf-972c-1c01feadef9e}\n- {Field: name, Value: ssh-works}\n- {Field: security_group_rules, Value: \"{\\n     \\\"remote_group_id\\\": null, \\n    \\\n    \\ \\\"direction\\\": \\\"ingress\\\", \\n     \\\"remote_ip_prefix\\\": null, \\n     \\\"protocol\\\"\\\n    : \\\"tcp\\\", \\n     \\\"tenant_id\\\": \\\"aefde53ff77d4c8bba639b26ccff55fc\\\", \\n    \\\n    \\ \\\"port_range_max\\\": 22, \\n     \\\"security_group_id\\\": \\\"8ac76c8f-f4b6-4cdf-972c-1c01feadef9e\\\"\\\n    , \\n     \\\"port_range_min\\\": 22, \\n     \\\"ethertype\\\": \\\"IPv4\\\", \\n     \\\"id\\\"\\\n    : \\\"0c60065e-7ca1-47a3-9d50-4f907cbba0a3\\\"\\n}\\n{\\n     \\\"remote_group_id\\\": null,\\\n    \\ \\n     \\\"direction\\\": \\\"egress\\\", \\n     \\\"remote_ip_prefix\\\": null, \\n    \\\n    \\ \\\"protocol\\\": null, \\n     \\\"tenant_id\\\": \\\"aefde53ff77d4c8bba639b26ccff55fc\\\"\\\n    , \\n     \\\"port_range_max\\\": null, \\n     \\\"security_group_id\\\": \\\"8ac76c8f-f4b6-4cdf-972c-1c01feadef9e\\\"\\\n    , \\n     \\\"port_range_min\\\": null, \\n     \\\"ethertype\\\": \\\"IPv4\\\", \\n     \\\"id\\\"\\\n    : \\\"2eb23b65-e3f7-48bf-bfc4-2ef04d93d014\\\"\\n}\\n{\\n     \\\"remote_group_id\\\": null,\\\n    \\ \\n     \\\"direction\\\": \\\"egress\\\", \\n     \\\"remote_ip_prefix\\\": null, \\n    \\\n    \\ \\\"protocol\\\": null, \\n     \\\"tenant_id\\\": \\\"aefde53ff77d4c8bba639b26ccff55fc\\\"\\\n    , \\n     \\\"port_range_max\\\": null, \\n     \\\"security_group_id\\\": \\\"8ac76c8f-f4b6-4cdf-972c-1c01feadef9e\\\"\\\n    , \\n     \\\"port_range_min\\\": null, \\n     \\\"ethertype\\\": \\\"IPv6\\\", \\n     \\\"id\\\"\\\n    : \\\"887e34da-760a-4739-bdd6-b2bd191dc950\\\"\\n}\"}\n- {Field: tenant_id, Value: aefde53ff77d4c8bba639b26ccff55fc}\n```\n\n## public key\u306f\u4e8b\u524d\u306b\u767b\u9332\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\n\u308f\u305f\u3057\u306f\u3001ssh public key\u306f\u969b\u306bConoHa\u306eweb\u30b3\u30f3\u30d1\u30cd\u3067\u3055\u304d\u306b\u767b\u9332\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u3053\u3053\u3067\u306f\u3001\u201dmy-local-key\u201d \u3092\u4f7f\u3044\u307e\u3059\u306e\u3067\u78ba\u8a8d\n\n```bash:shell\n$ openstack keypair list -f csv 2>/dev/null\n\"Name\",\"Fingerprint\"\n\"apps-key-2015-06-17-21-00\",\"74:a3:4f:79:92:da:5d:58:a5:0b:50:3f:5f:ed:d5:b8\"\n\"my-local-key\",\"6c:49:66:fa:67:7c:20:e6:b5:e9:75:5a:40:51:b2:5b\"\n```\n\n## \u30b5\u30fc\u30d0\u4f5c\u6210\nopenstack\u30b3\u30de\u30f3\u30c9\u3060\u3068\u3001\u30b5\u30fc\u30d0\u4f5c\u6210\u306f\u3053\u3046\u306a\u308a\u307e\u3059\u3002\n\n```bash:shell\n$ openstack server create --image vmi-ubuntu-14.04-amd64 --flavor g-1gb \\\n  --key-name my-local-key --security-group ssh-works \\\n  --property \"instance_name_tag=s3ql_repos\" new-server -f value\n```\n\n\u5b9f\u884c\u306f\u3053\u3093\u306a\u611f\u3058\n\n```bash:shell\n$ openstack server create --image vmi-ubuntu-14.04-amd64 --flavor g-1gb \\\n  --key-name my-local-key --security-group ssh-works \\\n  --property \"instance_name_tag=s3ql_repos\" new-server -f value\n\nMANUAL\nnova\n\ncn-a13008.g2.sjc1.v4\nsjc1-00004ec4\n0\nNone\nbuilding\nNone\nNone\n\n\n\nFg@qYejp5\nTrue\n2015-12-12T14:12:44Z\ng-1gb (7eea7469-0d85-4f82-8050-6ae742394681)\n\n510d823c-8098-4bba-bdf0-caf4d099d2cc\nvmi-ubuntu-14.04-amd64 (a87dfe9f-a8a4-4634-9a40-dbeba7ee7013)\nmy-local-key\n163-44-113-90\n[]\n0\naefde53ff77d4c8bba639b26ccff55fc\n```\n\n\u3082\u3061\u308d\u3093\u3001ConoHa\u306e\u30b3\u30f3\u30d1\u30cd\u304b\u3089\u4f5c\u6210\u3057\u3066\u3082OK\u3067\u3059\u3002\n\n\n## ssh login\u3057\u3066s3ql\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\nUbuntu\u516c\u5f0f\u304b\u3089\u306f python 2.7\u3067\u52d5\u304f\u53e4\u3044s3ql v1.16\u3057\u304b\u5165\u3063\u3066\u3044\u307e\u305b\u3093\u3002\nhttp://www.ubuntuupdates.org/package/core/trusty/universe/proposed/s3ql\n\ns3ql\u306e\u6700\u65b0\u7248\u306fpython3\u306e\u30b9\u30ec\u30c3\u30c9\u30e2\u30c7\u30eb\u306b\u6700\u9069\u5316\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001PPA\u3067\u5225\u7269\u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u3002\n\u305d\u306e\u524d\u306b\u3001ssh login\u3057\u3066\u3001apt\u60c5\u5831\u66f4\u65b0\n\n```bash:shell\n$ ssh root@v163-44-112-214.a009.g.sjc1.static.cnode.io\n\nroot@163-44-112-214:~# aptitude update\n```\n\n\u3082\u3057\u3001s3ql 1.16\u3068\u304b\u5165\u3063\u3066\u3044\u305f\u3089\u3001\u4f7f\u3063\u3066\u306a\u3044\u306a\u3089\u524a\u9664\u3057\u3061\u3083\u3044\u307e\u3059\n\n```bash:shell\nn-gohko@helium-conoha:~$ dpkg -l s3ql\nDesired=Unknown/Install/Remove/Purge/Hold\n| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend\n|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)\n||/ Name                                           Version                      Architecture                 Description\n+++-==============================================-============================-============================-=================================================================================================\nii  s3ql                                           1.16-1                       amd64                        Full-featured file system for online data storage\n\nn-gohko@helium-conoha:~$ sudo aptitude remove s3ql\nThe following packages will be REMOVED:\n  libcrypto++9{u} libjs-jquery{u} libjs-sphinxdoc{u} libjs-underscore{u} python-apsw{u} python-llfuse{u} python-lzma{u} python-pycryptopp{u} python-support{u} s3ql\n```\n\n## PPA\u767b\u9332(ppa:nikratio/s3ql)\n\u500b\u5225\u30e1\u30f3\u30c6\u30ca\u30fc\u3067\u4f5c\u3063\u3066\u3044\u308b\u4eba\u304c\u3044\u308b\u306e\u3067\u3001PPA\u3067\u5229\u7528\u3057\u307e\u3059\nhttps://launchpad.net/~nikratio/+archive/ubuntu/s3ql\n\n\u3044\u304b\u306e\u30b3\u30de\u30f3\u30c9\u3067PPA\u3092\u8ffd\u52a0\u3057\u307e\u3059\nsudo add-apt-repository ppa:nikratio/s3ql \n\n\n\u5b9f\u969b\u306f\u3053\u3093\u306a\u611f\u3058\n\n```bash:shell\nn-gohko@helium-conoha:~$ sudo add-apt-repository ppa:nikratio/s3ql\n Ubuntu packages of S3QL (http://code.google.com/p/s3ql/). The PPA also contains backported versions of all dependencies for which the version in the Ubuntu archive is too old for use with S3QL.\n More info: https://launchpad.net/~nikratio/+archive/ubuntu/s3ql\nPress [ENTER] to continue or ctrl-c to cancel adding it\n\ngpg: keyring `/tmp/tmpbjizpp9z/secring.gpg' created\ngpg: keyring `/tmp/tmpbjizpp9z/pubring.gpg' created\ngpg: requesting key 9958C967 from hkp server keyserver.ubuntu.com\ngpg: /tmp/tmpbjizpp9z/trustdb.gpg: trustdb created\ngpg: key 9958C967: public key \"Launchpad S3QL\" imported\ngpg: Total number processed: 1\ngpg:               imported: 1  (RSA: 1)\nOK\nroot@163-44-112-214:~#\n```\n\n## conoha swift object storage s3ql\ns3ql\u3092OpenStack Swift\u3067\u4f7f\u3046\u8a71\u306f\u691c\u7d22\u3059\u308b\u3068\u610f\u5916\u306b\u51fa\u3066\u3053\u306a\u3044\nhttps://dev.cloudwatt.com/en/blog/s3ql-on-cloudwatt-openstack-plateform.html\n>> \u53c2\u7167URL (1)\n\nhttp://www.rath.org/s3ql-docs/manual.pdf\n>> \u53c2\u7167URL (2)\n\u306a\u306e\u3067\u3001\u3068\u308a\u3042\u3048\u305a\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304b\u3089\u30bd\u30fc\u30b9\u3092\u898b\u306a\u304c\u3089\u8a66\u884c\u932f\u8aa4\u3059\u308b\u3053\u3068\u306b\u306a\u308b\n(swift s3ql Softlayer, swift s3ql Rackspace\u306a\u3069\u306e\u30ad\u30fc\u30ef\u30fc\u30c9\u3067\u691c\u7d22\u3059\u308b\u3068\u3001\u3072\u3087\u3063\u3068\u3057\u305f\u3089\u51fa\u3066\u304f\u308b\u304b\u3082\u3057\u308c\u306a\u3044)\n\nhttps://launchpad.net/~nikratio/+archive/ubuntu/s3ql\n(Adding this PPA to your system \u3092\u898b\u3066\u300114.04LTS\u306e\u5834\u5408\u3001Trusty (14.04)\u3092\u30d7\u30eb\u30c0\u30a6\u30f3\u304b\u3089\u9078\u629e)\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\n\n```bash:shell\nsudo add-apt-repository ppa:nikratio/s3ql\n```\n\nPPA\u3092\u8ffd\u52a0\u5f8c\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash:shell\nsudo aptitude update && aptitude install s3ql\n```\n\n\n### python3\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\n\n```bash:shell\nn-gohko@helium-conoha:~$ sudo aptitude install s3ql\nThe following NEW packages will be installed:\n  libgmp10{a} libjs-jquery{a} libjs-sphinxdoc{a} libjs-underscore{a} python3-apsw{a} python3-chardet{a} python3-crypto{a} python3-defusedxml{a} python3-dugong{a} python3-llfuse{a} python3-pkg-resources{a}\n  python3-requests{a} python3-six{a} python3-urllib3{a} s3ql\n0 packages upgraded, 15 newly installed, 0 to remove and 27 not upgraded.\nNeed to get 1445 kB/1611 kB of archives. After unpacking 6698 kB will be used.\nDo you want to continue? [Y/n/?] y\n```\n\n\n\u78ba\u8a8d\u30012.15\u304c\u5165\u3063\u3066\u3044\u308c\u3070\u5927\u4e08\u592b\n\n```bash:shell\nn-gohko@helium-conoha:~$ dpkg -l | grep s3ql\nii  s3ql                                                  2.15+dfsg-1~36~ubuntu14.04.1                        amd64        Full-featured file system for online data storage\nn-gohko@helium-conoha:~$ mkfs.s3ql --version\nS3QL 2.15\n```\n\n## openstack client \u5165\u308c\u308b\n```bash:shell\nsudo apt-get install ubuntu-cloud-keyring\n```\n\n## juno\u6307\u5b9a\u306epkg\u306e\u5834\u5408\u3001\u3044\u308c\u308b\u3001\u5165\u308c\u306a\u3044\u5834\u5408\u306b\u306f\u3001ubuntu\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u5185\u90e8\u304b\u3089openstack client\u3092\u5165\u308c\u308b\u3053\u3068\u306b\u306a\u308b\n\n\u3068\u308a\u3042\u3048\u305a\u3001juno\u306ecloud archive\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n```bash:shell\necho \"deb http://ubuntu-cloud.archive.canonical.com/ubuntu trusty-updates/juno main\" > /etc/apt/sources.list.d/cloudarchive-juno.list\n```\n\n## swift\u306eclient\u306f\u500b\u5225\u306b\u5165\u308c\u308b\n\u3042\u3068\u3067\u3001swift\u30b3\u30f3\u30c6\u30ca\u306e\u4f5c\u6210\u3068\u5185\u5bb9\u306e\u78ba\u8a8d\u306b\u4f7f\u3044\u307e\u3059\n\n```bash:shell\nn-gohko@helium-conoha:~$ sudo aptitude search swiftclient\ni   python-swiftclient                                                                                            - Client library for Openstack Swift API.\n```\n\n## OSC(OpenStack client)\u3092\u3044\u308c\u308b\n\u3055\u304d\u307b\u3069juno\u306eapt\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8a2d\u5b9a\u3057\u305f\u306e\u3067\u3001juno\u3067\u5165\u308a\u307e\u3059\u3002\nclient\u306a\u306e\u3067\u3001\u6700\u65b0\u3092\u5165\u308c\u3066\u3082\u3044\u3044\u3093\u3067\u3059\u3051\u3069\u306d\u3002\n\n```bash:shell\nn-gohko@helium-conoha:~$ sudo aptitude install python-openstackclient\n\u4ee5\u4e0b\u306e\u65b0\u898f\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3059:\n  python-cinderclient{a} python-cliff{a} python-cliff-doc{a} python-cmd2{a} python-glanceclient{a} python-json-patch{a} python-json-pointer{a} python-jsonpatch{a} python-jsonschema{a} python-keyring{a} python-mock{a}\n  python-novaclient{a} python-openstackclient python-pyparsing{a} python-secretstorage{a} python-warlock{a}\n0 \u500b\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u66f4\u65b0\u3001 16 \u500b\u3092\u65b0\u305f\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3001 0 \u500b\u3092\u524a\u9664\u4e88\u5b9a\u30011 \u500b\u304c\u66f4\u65b0\u3055\u308c\u3066\u3044\u306a\u3044\u3002\n578 k \u30d0\u30a4\u30c8\u306e\u30a2\u30fc\u30ab\u30a4\u30d6\u3092\u53d6\u5f97\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u5c55\u958b\u5f8c\u306b 4,707 k \u30d0\u30a4\u30c8\u306e\u30c7\u30a3\u30b9\u30af\u9818\u57df\u304c\u65b0\u305f\u306b\u6d88\u8cbb\u3055\u308c\u307e\u3059\u3002\n\u5148\u306b\u9032\u307f\u307e\u3059\u304b? [Y/n/?] y\n\u53d6\u5f97: 1 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-pyparsing all 2.0.1+dfsg1-1build1 [34.3 kB]\n\u53d6\u5f97: 2 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-cmd2 all 0.6.7-2fakesync1build1 [22.2 kB]\n\u53d6\u5f97: 3 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-json-pointer all 1.0-2build1 [5,158 B]\n\u53d6\u5f97: 4 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-jsonpatch all 1.3-4 [9,088 B]\n\u53d6\u5f97: 5 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-json-patch all 1.3-4 [2,312 B]\n\u53d6\u5f97: 6 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-mock all 1.0.1-3 [23.8 kB]\n\u53d6\u5f97: 7 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-jsonschema all 2.3.0-1build1 [27.2 kB]\n\u53d6\u5f97: 8 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-warlock all 1.1.0-0ubuntu2 [5,278 B]\n\u53d6\u5f97: 9 http://jp.archive.ubuntu.com/ubuntu/ trusty-updates/main python-cinderclient all 1:1.0.8-0ubuntu2 [72.4 kB]\n\u53d6\u5f97: 10 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-cliff all 1.4.5-1ubuntu2 [16.7 kB]\n\u53d6\u5f97: 11 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-keyring all 3.5-1 [51.8 kB]\n\u53d6\u5f97: 12 http://jp.archive.ubuntu.com/ubuntu/ trusty-updates/main python-novaclient all 1:2.17.0-0ubuntu1.2 [140 kB]\n\u53d6\u5f97: 13 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-glanceclient all 1:0.12.0-0ubuntu1 [34.1 kB]\n\u53d6\u5f97: 14 http://jp.archive.ubuntu.com/ubuntu/ trusty/universe python-openstackclient all 0.3.0-1ubuntu1 [81.1 kB]\n\u53d6\u5f97: 15 http://jp.archive.ubuntu.com/ubuntu/ trusty-updates/main python-secretstorage all 2.0.0-1ubuntu1.1 [11.7 kB]\n\u53d6\u5f97: 16 http://jp.archive.ubuntu.com/ubuntu/ trusty/main python-cliff-doc all 1.4.5-1ubuntu2 [40.8 kB]\n578 kB \u3092 0\u79d2 \u79d2\u3067\u53d6\u5f97\u3057\u307e\u3057\u305f (831 kB/s)\n\u4ee5\u524d\u306b\u672a\u9078\u629e\u306e\u30d1\u30c3\u30b1\u30fc\u30b8 python-pyparsing \u3092\u9078\u629e\u3057\u3066\u3044\u307e\u3059\u3002\n(\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u307e\u3059 ... \u73fe\u5728 321845 \u500b\u306e\u30d5\u30a1\u30a4\u30eb\u3068\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u307e\u3059\u3002)\n.../python-pyparsing_2.0.1+dfsg1-1build1_all.deb \u3092\u5c55\u958b\u3059\u308b\u6e96\u5099\u3092\u3057\u3066\u3044\u307e\u3059 ...\npython-pyparsing (2.0.1+dfsg1-1build1) \u3092\u5c55\u958b\u3057\u3066\u3044\u307e\u3059...\n\u4ee5\u524d\u306b\u672a\u9078\u629e\u306e\u30d1\u30c3\u30b1\u30fc\u30b8 python-cmd2 \u3092\u9078\u629e\u3057\u3066\u3044\u307e\u3059\u3002\n.../python-cmd2_0.6.7-2fakesync1build1_all.deb \u3092\u5c55\u958b\u3059\u308b\u6e96\u5099\u3092\u3057\u3066\u3044\u307e\u3059 ...\n<<<<<<<<<<<< snip >>>>>>>>>>>>\nman-db (2.6.7.1-1ubuntu1) \u306e\u30c8\u30ea\u30ac\u3092\u51e6\u7406\u3057\u3066\u3044\u307e\u3059 ...\ndoc-base (0.10.5) \u306e\u30c8\u30ea\u30ac\u3092\u51e6\u7406\u3057\u3066\u3044\u307e\u3059 ...\ndoc-base \u30d5\u30a1\u30a4\u30eb\u3092 1 \u500b\u8ffd\u52a0 \u3092\u51e6\u7406\u4e2d...\npython-pyparsing (2.0.1+dfsg1-1build1) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-cmd2 (0.6.7-2fakesync1build1) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-json-pointer (1.0-2build1) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-jsonpatch (1.3-4) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\nupdate-alternatives: /usr/bin/jsondiff (jsondiff) \u3092\u63d0\u4f9b\u3059\u308b\u305f\u3081\u306b \u81ea\u52d5\u30e2\u30fc\u30c9 \u3067 /usr/bin/python2-jsondiff \u3092\u4f7f\u3044\u307e\u3059\nupdate-alternatives: /usr/bin/jsonpatch (jsonpatch) \u3092\u63d0\u4f9b\u3059\u308b\u305f\u3081\u306b \u81ea\u52d5\u30e2\u30fc\u30c9 \u3067 /usr/bin/python2-jsonpatch \u3092\u4f7f\u3044\u307e\u3059\npython-json-patch (1.3-4) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-mock (1.0.1-3) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-jsonschema (2.3.0-1build1) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-warlock (1.1.0-0ubuntu2) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-cinderclient (1:1.0.8-0ubuntu2) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-cliff (1.4.5-1ubuntu2) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-keyring (3.5-1) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-novaclient (1:2.17.0-0ubuntu1.2) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-glanceclient (1:0.12.0-0ubuntu1) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-openstackclient (0.3.0-1ubuntu1) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-secretstorage (2.0.0-1ubuntu1.1) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\npython-cliff-doc (1.4.5-1ubuntu2) \u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059 ...\n\nn-gohko@helium-conoha:~$\n```\n\n\u3053\u308c\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u3053\u3053\u307e\u3067\n\n\n# s3ql \u8a2d\u5b9a\u3068Hack (plugin\u4f5c\u6210)\n\n\u3053\u3053\u304b\u3089\u8a2d\u5b9a\u3068\u3001\u8a2d\u5b9a\u306e\u305f\u3081\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba(\u5fc5\u8981\u60aa)\n\n## swift\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u5165\u308c\u7269\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u308b\ntokyo\u30ea\u30fc\u30b8\u30e7\u30f3\u3067swift\u30b3\u30de\u30f3\u30c9\u3067\u5165\u308c\u7269\u3092\u4f5c\u308a\u307e\u3059\u3002\n\u5f8c\u3067\u3001\u5185\u5bb9\u7269\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u3053\u306e\u8fba\u308a\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\nhttps://www.conoha.jp/conoben/archives/2648\n\n```bash:shell\nn-gohko@helium-conoha:~$ swift list \nexpandrive\nwin-hp-backup\n\nn-gohko@helium-conoha:~$ swift post s3ql_pool\n\nn-gohko@helium-conoha:~$ swift list\nexpandrive\ns3ql_pool\nwin-hp-backup\n```\n\n\"s3ql_pool\" \u3068\u3044\u3046\u5165\u308c\u7269(\u30b3\u30f3\u30c6\u30ca)\u3092\u4f5c\u308a\u307e\u3057\u305f\n\n\n\n## \u30ed\u30fc\u30ab\u30eb\u30b3\u30f3\u30d5\u30a3\u30b0dir\u4f5c\u6210\n\nfuse\u30de\u30a6\u30f3\u30c8\u3067\u3059\u306e\u3067\u3001user\u74b0\u5883\u3067\u30de\u30a6\u30f3\u30c8\u3055\u308c\u307e\u3059\u3002\nroot\u3067\u30de\u30a6\u30f3\u30c8\u3059\u308b\u5834\u5408\u306b\u306f\u3001root\u306e\u30e6\u30fc\u30b6\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\u79c1\u306f\u3001\"n-gohko\"\u3067\u30de\u30a6\u30f3\u30c8\u3057\u307e\u3057\u305f\u3002rsync\u3067\u306ehome directory(Dropbox\u3092\u542b\u3080)\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u306b\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u306e\u3088\u3046\u306a\u4f7f\u3044\u65b9\u306b\u306f\u901a\u5e38\u4f7f\u3063\u3066\u3044\u308b\u30e6\u30fc\u30b6\u306e\u307b\u3046\u304c\u3088\u3044\u3067\u3059\u306d\u3002\n\nconfig\u3068cache\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u30e6\u30fc\u30b6Home\u306b \"~/.s3ql\" \u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash:shell\nn-gohko@helium-conoha:~$ mkdir ~/.s3ql && install -b -m 600 /dev/null ~/.s3ql/authinfo2\n```\n\ns3ql\u3067\u30de\u30a6\u30f3\u30c8\u3059\u308b\u5834\u6240\u3092\u4f5c\u3063\u3066\u304a\u304d\u307e\u3059\u3002\n\n```bash:shell\n$ mkdir -p ~/mnt/s3ql\n```\n\n\n## (\u3046\u307e\u304f\u3044\u304b\u306a\u304b\u3063\u305f)s3ql swiftks\u30b3\u30f3\u30d5\u30a3\u30b0\u4f5c\u6210\n\n\u672c\u6765\u306a\u3089\u3070\u3001swift\u306e\u30b3\u30f3\u30d5\u30a3\u30b0\u306fswiftks\u3068\u3044\u3046\u30bf\u30a4\u30d7\u306estorage-url\u3067\u8a2d\u5b9a\u3059\u308b\u306e\u3067\u3059\u304c\u3001\u306a\u3093\u304b\u3046\u307e\u304f\u884c\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n\u53c2\u7167URL (1) \u306b\u3042\u308b\u8a2d\u5b9a\u3067\u306f\n\n```bash:shell\nn-gohko@helium-conoha:~$ cat ~/.s3ql/authinfo2\n[swift]\nbackend-login: <tenant_name>:<username>\nbackend-password: <password>\nstorage-url: swiftks://identity.fr1.cloudwatt.com/fr1:<container_s3ql>\n```\n\n\u3068\u3044\u3046\u611f\u3058\u3067\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nConoHa swift object storage\u3060\u3068\u3001\u6b21\u306e\u3088\u3046\u306b\u306a\u308b\u306f\u305a\u306a\u3093\u3067\u3059\u3051\u3069\u3001\u3046\u307e\u304f\u52d5\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n```bash:shell\nn-gohko@helium-conoha:~$ cat .s3ql/authinfo2\n[swift]\nbackend-login: gnct59999999:gncu59999999\nbackend-password: hogenaisho\nstorage-url: swiftks://identity.tyo1.conoha.io/tyo1/:s3ql_pool\n```\n\n\u3046\u307e\u304f\u3044\u304b\u306a\u304b\u3063\u305f\u5185\u5bb9\u306b\u3064\u3044\u3066\u8abf\u3079\u3066\u307f\u308b\u3068\u3001swiftks(keystone auth v2.0)\u306e\u8a2d\u5b9a\u3092\u52d5\u304b\u3057\u3066\u3044\u308b\u306e\u306f\u3001s3ql\u306ebackend\u30c9\u30e9\u30a4\u30d0\u3067\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nswiftks\u3067\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u691c\u7d22\u3059\u308b\u3068\u3001\u4e0b\u8a18\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u898b\u3064\u304b\u308a\u307e\u3059\u3002\n\n```bash:shell\nn-gohko@helium-conoha:~$ dpkg -L s3ql | grep swiftks\n/usr/lib/s3ql/s3ql/backends/swiftks.py\n```\n\n\u958b\u304f\u3068\u3001\u6b21\u306b\u793a\u3059 \"_pase_storage_url()\" \u306e\u3068\u3053\u308d\u306b\u6b63\u898f\u8868\u73fe\u3067storage-url\u3092\u5206\u89e3\u3057\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u611f\u3058\u3002\n\n```bash:shell\nn-gohko@helium-conoha:~$ cat -n /usr/lib/s3ql/s3ql/backends/swiftks.py | head -n 57 | tail -n 31\n    27\n    28\t    @copy_ancestor_docstring\n    29\t    def _parse_storage_url(self, storage_url, ssl_context):\n    30\n    31\t        hit = re.match(r'^[a-zA-Z0-9]+://' # Backend\n    32\t                       r'([^/:]+)' # Hostname\n    33\t                       r'(?::([0-9]+))?' # Port\n    34\t                       r'/([a-zA-Z0-9._-]+):' # Region\n    35\t                       r'([^/]+)' # Bucketname\n    36\t                       r'(?:/(.*))?$', # Prefix\n    37\t                       storage_url)\n    38\t        if not hit:\n    39\t            raise QuietError('Invalid storage URL', exitcode=2)\n    40\n    41\t        hostname = hit.group(1)\n    42\t        if hit.group(2):\n    43\t            port = int(hit.group(2))\n    44\t        elif ssl_context:\n    45\t            port = 443\n    46\t        else:\n    47\t            port = 80\n    48\t        region = hit.group(3)\n    49\t        containername = hit.group(4)\n    50\t        prefix = hit.group(5) or ''\n    51\n    52\t        self.hostname = hostname\n    53\t        self.port = port\n    54\t        self.container_name = containername\n    55\t        self.prefix = prefix\n    56\t        self.region = region\n    57\n```\n\n```bash:shell\nn-gohko@helium-conoha:~$ mkfs.s3ql --plain --authfile ~/.s3ql/authinfo2 \\\n  --debug swiftks://identity.tyo1.conoha.io/tyo1/:s3ql_pool\n2015-12-13 04:00:12.492 15887 MainThread s3ql.backends.common.get_ssl_context: Reading default CA certificates.\n2015-12-13 04:00:12.493 15887 MainThread root.excepthook: Invalid storage URL\n```\n\n\u3068\u3044\u3046\u611f\u3058\u3067\u3001\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u3001\u3046\u3046\u3002\nrackspace\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u306f\u3046\u307e\u304f\u3044\u3063\u305f\u306e\u3067\u3001\u30a8\u30e9\u30fc\u306estorage url\u306e\u3068\u3053\u308d\u3067\u8a70\u307e\u3063\u3066\u3044\u308b\u3060\u308d\u3046\u3068\u304a\u3082\u3063\u305f\u306e\u3067\u3059\u3002\n\n\u3044\u308d\u3044\u308d\u3084\u3063\u305f\u306e\u3067\u3059\u304c\u3001Hack\u3067\u5207\u308a\u629c\u3051\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\n## (Hack) conohaswift\u3068\u3044\u3046storage URL\u3092rackspace\u306e\u8907\u88fd\u3057\u3066\u4f5c\u308b\n\n\u3053\u3053\u3067\u3001\u9762\u5012\u306b\u306a\u3063\u305f\u306e\u3067\u3001conohaswift\u3068\u3044\u3046storage plugin\u3092\u4f5c\u3063\u3066\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\nbackend\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u30d7\u30e9\u30b0\u30a4\u30f3\u306fgrep\u3059\u308b\u3068backends\u3068\u3044\u3046\u5834\u6240\u306b\u5165\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n```bash:shell\nn-gohko@163-44-112-214:~$ dpkg -L s3ql | grep backends\n/usr/share/doc/s3ql/html/_sources/backends.txt\n/usr/share/doc/s3ql/html/backends.html\n/usr/lib/s3ql/s3ql/backends\n/usr/lib/s3ql/s3ql/backends/gs.py\n/usr/lib/s3ql/s3ql/backends/rackspace.py\n/usr/lib/s3ql/s3ql/backends/s3.py\n/usr/lib/s3ql/s3ql/backends/s3c.py\n/usr/lib/s3ql/s3ql/backends/swift.py\n/usr/lib/s3ql/s3ql/backends/common.py\n/usr/lib/s3ql/s3ql/backends/local.py\n/usr/lib/s3ql/s3ql/backends/pool.py\n/usr/lib/s3ql/s3ql/backends/__init__.py\n/usr/lib/s3ql/s3ql/backends/swiftks.py\n/usr/lib/s3ql/s3ql/backends/comprenc.py\n```\n\nrackspace class\u306f\u3001swiftks  class\u3092\u305d\u306e\u307e\u307e\u547c\u3093\u3067\u3044\u3066\u3001\"_pase_storage_url()\" \u306e\u3068\u3053\u308d\u3067swiftks\u306e\u8a8d\u8a3c\u3092\u4e0a\u66f8\u304d\u3057\u3066\u3044\u307e\u3059\u3002\n\u306a\u306e\u3067\u3001\u3053\u308c\u306b\u7fd2\u3063\u3066\u3001conohaswift.py \u3068\u3044\u3046\u30c9\u30e9\u30a4\u30d0\u30d5\u30a1\u30a4\u30eb\u3092 rackspace.py \u306e\u8907\u88fd\u3068\u3057\u3066\u4f5c\u3063\u3066\u3001storage URL\u306e\u30d1\u30fc\u30b9\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059\u3002\n\n```bash:shell\nn-gohko@163-44-112-214:~$ pushd /usr/lib/s3ql/s3ql/backends/\n/usr/lib/s3ql/s3ql/backends ~\n\nn-gohko@163-44-112-214:/usr/lib/s3ql/s3ql/backends$ sudo cp -avf rackspace.py conohaswift.py\nsudo: unable to resolve host 163-44-112-214\n[sudo] password for n-gohko:\n'rackspace.py' -> 'conohaswift.py'\n```\n\n\u30d0\u30c4\u30af\u30a8\u30f3\u30c9\u306e\u4e2d\u8eab\n\n```bash:shell\nn-gohko@163-44-112-214:/usr/lib/s3ql/s3ql/backends$ ls -l\ntotal 180\n-rw-r--r-- 1 root root   634 Sep 18 08:42 __init__.py\ndrwxr-xr-x 2 root root  4096 Dec 12 06:44 __pycache__\n-rw-r--r-- 1 root root 22827 Sep 18 08:42 common.py\n-rw-r--r-- 1 root root 33419 Sep 28 20:09 comprenc.py\n-rw-r--r-- 1 root root  1232 Sep 18 08:42 conohaswift.py\n-rw-r--r-- 1 root root  9859 Sep 18 08:42 gs.py\n-rw-r--r-- 1 root root 10241 Sep 28 20:09 local.py\n-rw-r--r-- 1 root root  1872 Sep 18 08:42 pool.py\n-rw-r--r-- 1 root root  1232 Sep 18 08:42 rackspace.py\n-rw-r--r-- 1 root root  6270 Sep 18 08:42 s3.py\n-rw-r--r-- 1 root root 37709 Sep 28 20:09 s3c.py\n-rw-r--r-- 1 root root 19233 Sep 18 08:42 swift.py\n-rw-r--r-- 1 root root  4736 Sep 18 08:42 swiftks.py\n\n```\n\nconohaswift.py\u306e\u4e2d\u8eab\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```python:/usr/lib/s3ql/s3ql/backends/conohaswift.py\n'''\nconohaswift.py - this file is part of S3QL.\n\nCopyright \u00a9 215 n-gohko\n\nThis work can be distributed under the terms of the GNU GPLv3.\n'''\n\nfrom ..logging import logging, QuietError # Ensure use of custom logger class\nfrom . import swiftks\nfrom ..inherit_docstrings import copy_ancestor_docstring\nimport re\n\nlog = logging.getLogger(__name__)\n\nclass Backend(swiftks.Backend):\n    \"\"\"A backend to store data in ConoHa swift Object Storage\"\"\"\n\n    @copy_ancestor_docstring\n    def _parse_storage_url(self, storage_url, ssl_context):\n\n        hit = re.match(r'^conohaswift://' # Backend\n                       r'([^/:]+)' # Region\n                       r'/([^/]+)' # Bucketname\n                       r'(?:/(.*))?$', # Prefix\n                       storage_url)\n        if not hit:\n            raise QuietError('Invalid storage URL', exitcode=2)\n\n        region = hit.group(1)\n        containername = hit.group(2)\n        prefix = hit.group(3) or ''\n\n        if ssl_context:\n            port = 443\n        else:\n            port = 80\n        port = 443\n\n        self.hostname = 'identity.tyo1.conoha.io'\n        self.port = port\n        self.container_name = containername\n        self.prefix = prefix\n        self.region = region\n\n```\nbackends \u306e\u30ed\u30fc\u30c9\u306e\u8a2d\u5b9a\u306b\u8ffd\u52a0\u3059\u308b\u305f\u3081\u306b\u3001\u201d\\_\\_init\\_\\_.py\u201d \u30d5\u30a1\u30a4\u30eb\u3092\u4fee\u6b63\u3057\u307e\u3059\u3002\n\n```python:/usr/lib/s3ql/s3ql/backends/__init__.py\n'''\nbackends/__init__.py - this file is part of S3QL.\n\nCopyright \u00a9 2008 Nikolaus Rath <Nikolaus@rath.org>\n\nThis work can be distributed under the terms of the GNU GPLv3.\n'''\n\nfrom . import local, s3, gs, s3c, swift, rackspace, swiftks, conohaswift\n\n#: Mapping from storage URL prefixes to backend classes\nprefix_map = { 's3': s3.Backend,\n               'local': local.Backend,\n               'gs': gs.Backend,\n               's3c': s3c.Backend,\n               'swift': swift.Backend,\n               'conohaswift': conohaswift.Backend,\n               'swiftks': swiftks.Backend,\n               'rackspace': rackspace.Backend }\n\n__all__ = [ 'common', 'pool', 'comprenc' ] + list(prefix_map.keys())\n\n```\n\n## (Hack:2) conohaswift\u3068\u3044\u3046storage URL\u3067\u63a5\u7d9a\u3059\u308b\n\n\u66f8\u304d\u63db\u3048\u305f\u306e\u3067\u3001\u30de\u30a6\u30f3\u30c8\u3059\u308b\u30e6\u30fc\u30b6\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u623b\u3063\u3066\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\n\n```bash:shell\nn-gohko@163-44-112-214:~$ cat .s3ql/authinfo2\n[swift]\nbackend-login: gnct59999999:gncu59999999\nbackend-password: hogenaisho\nstorage-url: conohaswift://tyo1/s3ql_pool\n```\n\n\nmkfs.s3ql\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u201d--debug\u201d\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u52d5\u4f5c\u78ba\u8a8d\u306e\u305f\u3081\u306a\u306e\u3067\u3001\nmkfs.s3ql --plain --authfile ~/.s3ql/authinfo2 conohaswift://tyo1/s3ql_poo\n\u307f\u305f\u3044\u306a\u611f\u3058\u3067\u826f\u3044\u3067\u3059\u3002\n\n\n```bash:shell\nn-gohko@163-44-112-214:~$ mkfs.s3ql --plain --authfile ~/.s3ql/authinfo2 --debug conohaswift://tyo1/s3ql_pool\n2015-12-13 04:43:17.027 15989 MainThread s3ql.backends.common.get_ssl_context: Reading default CA certificates.\n2015-12-13 04:43:17.027 15989 MainThread s3ql.backends.swift._do_request: started with 'GET', '/', None, {'limit': 1}, None, None\n2015-12-13 04:43:17.027 15989 MainThread s3ql.backends.swift._do_request: no active connection, calling _get_conn()\n2015-12-13 04:43:17.027 15989 MainThread s3ql.backends.swiftks._get_conn: started\n<< snip >>\n2015-12-13 04:43:21.904 15989 MainThread s3ql.backends.swift.open_write: started with s3ql_seq_no_1\n2015-12-13 04:43:21.904 15989 MainThread s3ql.backends.s3c.close: started with s3ql_seq_no_1\n2015-12-13 04:43:21.904 15989 MainThread s3ql.backends.swift._do_request: started with 'PUT', '/s3ql_seq_no_1', None, None, CaseInsensitiveDict({'Content-Type': 'application/octet-stream', 'X-Object-meta-002': \"'encryption': 'None',\", 'X-Object-meta-format': 'raw2', 'X-Object-meta-001': \"'compression': 'LZMA',\", 'X-Object-meta-003': \"'format_version': 2,\", 'X-Object-meta-000': \"'data': b'eyAgfQ==',\", 'X-Object-meta-md5': '1UH6aTHbuVf1fhc0/H8WUA=='}), <_io.FileIO name=6 mode='rb+'>\n2015-12-13 04:43:21.905 15989 MainThread s3ql.backends.swift._do_request_inner: started with PUT /v1/nc_aefde53ff77d4c8bba639b26ccff55fc/s3ql_pool/s3ql_seq_no_1\n2015-12-13 04:43:21.905 15989 MainThread s3ql.backends.swift._do_request_inner: waiting for 100-continue\n2015-12-13 04:43:22.030 15989 MainThread s3ql.backends.swift._do_request_inner: writing body data\nn-gohko@163-44-112-214:~$\n```\n\nHack\u3067\u4f5c\u3063\u305f\u3042\u3089\u305f\u306astorage url\u3067\u30de\u30a6\u30f3\u30c8\u3057\u307e\u3059\u3002\nmount.s3ql  conohaswift://tyo1/s3ql_pool ~/mnt/s3ql\n\n```bash:shell\nn-gohko@163-44-112-214:~$ mount.s3ql  conohaswift://tyo1/s3ql_pool ~/mnt/s3ql\nUsing 4 upload threads.\nAutodetected 4052 file descriptors available for cache entries\nUsing cached metadata.\nSetting cache size to 33058 MB\nMounting filesystem...\n```\n\n\u30de\u30a6\u30f3\u30c8\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\n```bash:shell\n\nn-gohko@163-44-112-214:~$ df\nFilesystem                    1K-blocks    Used  Available Use% Mounted on\n/dev/vda1                      50442940 5542204   42315344  12% /\nnone                                  4       0          4   0% /sys/fs/cgroup\nudev                             497964      12     497952   1% /dev\ntmpfs                            101748     388     101360   1% /run\nnone                               5120       0       5120   0% /run/lock\nnone                             508736       0     508736   0% /run/shm\nnone                             102400       0     102400   0% /run/user\nconohaswift://tyo1/s3ql_pool 1073741824       0 1073741824   0% /home/n-gohko/mnt/s3ql\n```\n\n## \u306a\u306b\u3082\u30b3\u30d4\u30fc\u3057\u3066\u3044\u306a\u3044\u72b6\u614b\nmkfs.s3ql\u3067Format\u3057\u3066\u3001\u30de\u30a6\u30f3\u30c8\u3057\u305f\u72b6\u614b\u3067\u3001swift\u30b3\u30f3\u30c6\u30ca\u201ds3ql_pool\u201d\u306e\u4e2d\u8eab\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:shell\n[n-gohko@163-44-112-214]$ swift list --lh s3ql_pool 2>/dev/null\n 120 2015-12-13 12:43:21 s3ql_metadata\n 120 2015-12-13 12:43:19 s3ql_metadata_new\n  64 2015-12-13 12:43:21 s3ql_seq_no_1\n  64 2015-12-13 12:46:15 s3ql_seq_no_2\n 368\n```\n\n\u521d\u671f\u72b6\u614b\u3067\u306f\u3001\u30e1\u30bf\u30c7\u30fc\u30bf\u30d5\u30a1\u30a4\u30eb\u3060\u3051\u3042\u308a\u307e\u3059\u3002\nmkfs.s3ql\u3092\u201d--plain\u201d\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u305f\u3053\u3068\u3067\u3001\u6697\u53f7\u5316\u306f\u7121\u3057\u3067\u3059\u3002\n\n\n## \u81ea\u5206devel\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092rsync\u3059\u308b\n\u3067\u306f\u3001rsync\u3067\u66f8\u304d\u8fbc\u3093\u3067\u307f\u307e\u3057\u3087\u3046\u3002\n\u624b\u5143\u306e \u201c~/devel\u201d \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c 3.7GB\u3050\u3044\u3089\u3042\u308b\u306e\u3067\u3001\u66f8\u304d\u8fbc\u3093\u3067\u307f\u307e\u3059\u3002\n```bash:shell\nn-gohko@163-44-112-214:~$ du -hs devel\n3.7G    devel\n```\n\nrsync\u4e2d\u306b\u30de\u30a6\u30f3\u30c8\u3055\u308c\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u6b21\u306e\u3088\u3046\u306b\u898b\u3048\u307e\u3059\u3002\n\n```bash:shell\n[n-gohko@163-44-112-214]$ ls -l ~/mnt/s3ql/\ntotal 0\ndrwxrwxr-x 1 n-gohko n-gohko 0 Sep 28 20:31 devel\ndrwx------ 1 n-gohko n-gohko 0 Dec 13 04:43 lost+found\n```\n\n\u30a2\u30ab\u30a6\u30f3\u30c8\u8a2d\u5b9a\u3092\u5148\u307b\u3069\u304a\u3044\u305f \u201c~/.s3ql\u201d \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4e2d\u8eab\u3092\u898b\u308b\u3068\u3001\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```bash:shell\n[n-gohko@163-44-112-214]$ du -hs ~/.s3ql/*\n4.0K    /home/n-gohko/.s3ql/authinfo2\n68M     /home/n-gohko/.s3ql/conohaswift:=2F=2Ftyo1=2Fs3ql_pool-cache\n1.8M    /home/n-gohko/.s3ql/conohaswift:=2F=2Ftyo1=2Fs3ql_pool.db\n4.0K    /home/n-gohko/.s3ql/conohaswift:=2F=2Ftyo1=2Fs3ql_pool.params\n4.0K    /home/n-gohko/.s3ql/mount.log\n0       /home/n-gohko/.s3ql/mount.s3ql_crit.log\n```\ncache\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u8ee2\u9001\u306ecache\u3001.db\u30d5\u30a1\u30a4\u30eb\u306fsqlite\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002\n\u5b9f\u306f\u3001\u3053\u306e\u4ed5\u7d44\u3067\u3001\u30d5\u30a1\u30a4\u30eb\u3092\u7ba1\u7406\u3057\u3066\u3044\u308b\u306e\u304c\u3001\u3053\u306edb\u306a\u306e\u3067\u3001\u3053\u306edb\u3092\u30de\u30eb\u30c1\u30ce\u30fc\u30c9\u3067\u5171\u6709\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308c\u3070\u3001\u8907\u6570\u306e\u30ce\u30fc\u30c9\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3088\u3046\u306b\u3067\u304d\u308b\u306e\u304b\u306a\u3068\u601d\u3044\u307e\u3057\u305f\u3002\n\n```bash:shell\n[n-gohko@163-44-112-214]$ file ~/.s3ql/conohaswift:=2F=2Ftyo1=2Fs3ql_pool.db\n/home/n-gohko/.s3ql/conohaswift:=2F=2Ftyo1=2Fs3ql_pool.db: SQLite 3.x database\n```\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u30d5\u30a1\u30a4\u30eb .params \u306f\u30c6\u30ad\u30b9\u30c8\u306bjson\u3067\u66f8\u3044\u3066\u3042\u308b\u307f\u305f\u3044\u3067\u3059\u306d\n```bash:shell\n[n-gohko@163-44-112-214]$ file ~/.s3ql/conohaswift:=2F=2Ftyo1=2Fs3ql_pool.params\n/home/n-gohko/.s3ql/conohaswift:=2F=2Ftyo1=2Fs3ql_pool.params: ASCII text, with no line terminators\n```\n\nrsync\u306e\u9014\u4e2d\u3067 du \u3068\u304b\u3082\u53d6\u308c\u307e\u3059\u3002\n```bash:shell\nn-gohko@163-44-112-214:~$ du -hs ~/mnt/s3ql/devel\n1.7G    /home/n-gohko/mnt/s3ql/devel\n```\n\n\n\n\u30e1\u30bf\u30c7\u30fc\u30bf\u3068\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30c7\u30fc\u30bf\u306b\u5225\u308c\u3066\u30c7\u30fc\u30bf\u304c\u8ee2\u9001\u3055\u308c\u308b\u3002\n\u30c7\u30fc\u30bf\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u5358\u4f53\u3067\u306f\u3001\u305d\u306e\u307e\u307e\u3067\u306f\u3001\u3069\u308c\u304c\u3069\u308c\u304b\u306f\u308f\u304b\u3089\u306a\u3044\u3067\u3059\u306d\u3002\n\u30e1\u30bf\u30c7\u30fc\u30bf\u30d5\u30a1\u30a4\u30eb\u3082\u3042\u308a\u307e\u3059\u3002\n\n```bash:shell\n[n-gohko@163-44-112-214]$ swift list --lh s3ql_pool  2>/dev/null | grep -v '_data_'\n 120 2015-12-13 12:43:21 s3ql_metadata\n 120 2015-12-13 12:43:19 s3ql_metadata_new\n  64 2015-12-13 12:43:21 s3ql_seq_no_1\n  64 2015-12-13 12:46:15 s3ql_seq_no_2\n1.1G\n```\n_data_\u30d5\u30a1\u30a4\u30eb\u306f\u305f\u304f\u3055\u3093\u306a\u306e\u3067\u3001\u3061\u3087\u3063\u3068\u3060\u3051\n\n```bash:shell\n[n-gohko@163-44-112-214] $ swift list --lh s3ql_pool  2>/dev/null | grep  '_data_' | head -n 3\n 116 2015-12-13 12:55:30 s3ql_data_1\n746K 2015-12-13 12:55:35 s3ql_data_10\n 79K 2015-12-13 12:56:36 s3ql_data_100\n```\n\ns3ql\u306eumount\u306f\u3001\u6b21\u306e\u3088\u3046\u306bumount.s3ql \u3092\u4f7f\u3044\u307e\u3059\u3002\n```bash:shell\n[n-gohko@163-44-112-214]$ umount.s3ql ~/mnt/s3ql\n[n-gohko@163-44-112-214]$ ls -l ~/mnt/s3ql/\ntotal 0\n```\n\n\u6b21\u306b\u30de\u30a6\u30f3\u30c8\u3055\u308c\u305f\u6642\u306b\u3001cache\u30b5\u30a4\u30ba\u306f\u66f4\u65b0\u3055\u308c\u307e\u3059\u3002\n```bash:shell\nn-gohko@163-44-112-214:~$ mount.s3ql  conohaswift://tyo1/s3ql_pool ~/mnt/s3ql\nUsing 4 upload threads.\nAutodetected 4052 file descriptors available for cache entries\nUsing cached metadata.\nSetting cache size to 33052 MB\nMounting filesystem...\nn-gohko@163-44-112-214:~$\n```\n\n\n\u3044\u308d\u3044\u308ddevel\u306b\u5165\u308c\u3066\u3044\u305f\u306e\u3067\u3001\u65e5\u672c\u8a9e\u30d5\u30a1\u30a4\u30eb\u542b\u3081\u3066\u8ee2\u9001\u3002\n\u3068\u304f\u306b\u65e5\u672c\u8a9e\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u3082\u305d\u306e\u307e\u307e\u3002\n\n\u7d50\u5c40\u3001~/.s3ql/  \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u308b\u306e\u3067\u3001\u30ed\u30fc\u30ab\u30eb\u30c7\u30a3\u30b9\u30af\u306e\u901f\u5ea6\u304c\u66f8\u304d\u8fbc\u307f\u901f\u5ea6\u3068\u306a\u308b\u3002\n\n\n# \u6700\u5f8c\u306b\n\u3068\u308a\u3042\u3048\u305a\u3001mount\u3057\u3066\u3001rsync\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u3067\u3059\u304c\u3001\u7d44\u307f\u5408\u308f\u305b\u306e\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3084\u6539\u4fee\u306e\u5185\u5bb9\u306f\u3061\u3087\u3063\u3068\u81a8\u3089\u307f\u307e\u3059\u3002s3ql\u306e\u958b\u767a\u306e\u672c\u5bb6\u304c\u3069\u3046\u3044\u3046\u65b9\u5411\u6027\u3067\u3084\u3063\u3066\u3044\u308b\u306e\u304b\u3082\u6c17\u306b\u306a\u308a\u307e\u3059\u3002\n\n", "tags": ["openstack", "Conoha", "s3ql", "Swift", "AdventCalendar"]}