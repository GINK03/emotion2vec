{"context": "\n\n\u306f\u3058\u3081\u306b\nOracle 11g\u306e\u8868\u9818\u57df(\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9)\u4e00\u89a7\u306e\u4f7f\u7528\u30b5\u30a4\u30ba\u3084\u7a7a\u304d\u5bb9\u91cf + TEMP\u8868\u9818\u57df\u306e\u30c7\u30a3\u30b9\u30af\u30bd\u30fc\u30c8\u767a\u751f\u56de\u6570\u3092\u8868\u793a\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u3064\u3044\u3066\u8a18\u8f09\u81f4\u3057\u307e\u3059\u3002\n\n\u6982\u8981\nLinux\u30b5\u30fc\u30d0\u4e0a\u306b\u69cb\u7bc9\u3057\u305fOracle 11g\u30b5\u30fc\u30d0(11.1.0.7.2)\u306e\u904b\u7528\u7ba1\u7406\u3092\u3057\u3066\u304a\u308a\u307e\u3059\u300224\u6642\u9593365\u65e5\u7a3c\u52d5\u3057\u7d9a\u3051\u308b\u30b5\u30fc\u30d3\u30b9\u306e\u672c\u756a\u74b0\u5883Oracle\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30b5\u30fc\u30d0\u3092\u904b\u7528\u3057\u3066\u3044\u308b\u70ba\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u8ca0\u8377\u3001\u30bb\u30c3\u30b7\u30e7\u30f3\u60c5\u5831\u3001\u30ed\u30c3\u30af\u3084\u30e9\u30c3\u30c1\u306e\u767a\u751f\u72b6\u6cc1\u3001SQL\u30b3\u30b9\u30c8\u306e\u5909\u5316\u306a\u3069\u69d8\u3005\u306a\u60c5\u5831\u3092\u78ba\u8a8d\u3057\u3066\u304a\u308a\u307e\u3059\u3002\nOracle\u30b5\u30fc\u30d0\u306e\u30ea\u30bd\u30fc\u30b9\u4f7f\u7528\u72b6\u6cc1\u78ba\u8a8d\u306e\u4e00\u90e8\u3068\u3057\u3066\u3001Oracle\u30b5\u30fc\u30d0\u4e0a\u306b\u683c\u7d0d\u3057\u3066\u3044\u308b\u5404\u8868\u9818\u57df\u306e\u4f7f\u7528\u30b5\u30a4\u30ba\u3084\u7a7a\u304d\u5bb9\u91cf\u3001TEMP\u8868\u9818\u57df\u306e\u30c7\u30a3\u30b9\u30af\u30bd\u30fc\u30c8\u767a\u751f\u56de\u6570\u3092\u78ba\u8a8d\u3057\u305f\u3044\u3068\u3044\u3046\u4e8b\u304c\u3042\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\u5f8c\u8ff0\u306eOracle\u8868\u9818\u57df\u4e00\u89a7\u3068\u4f7f\u7528\u30b5\u30a4\u30ba + TEMP\u8868\u9818\u57df\u306e\u30c7\u30a3\u30b9\u30af\u30bd\u30fc\u30c8\u767a\u751f\u56de\u6570\u3092\u8868\u793a\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u3001\u5b9a\u671f\u7684\u306b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u3066\u5404\u8868\u9818\u57df\u306e\u4f7f\u7528\u30b5\u30a4\u30ba\u3092\u30b0\u30e9\u30d5\u5316\u3057\u305f\u308a\u3001\u624b\u52d5\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u3066Oracle 11g\u30b5\u30fc\u30d0\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3057\u3066\u304a\u308a\u307e\u3059\u3002\nOracle Enterprise Manager\u3067\u3082\u5404\u8868\u9818\u57df\u306e\u4f7f\u7528\u30b5\u30a4\u30ba\u3084\u7a7a\u304d\u5bb9\u91cf\u306f\u78ba\u8a8d\u51fa\u6765\u307e\u3059\u304c\u3001\u78ba\u8a8d\u65b9\u6cd5\u306e\u4e00\u3064\u3068\u3057\u3066\u3001\u3054\u53c2\u8003\u306b\u306a\u308a\u307e\u3057\u305f\u3089\u5e78\u3044\u3067\u3059\u3002\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u74b0\u5883\n\u30fbOracle 11g (11.1.0.7.2)\n\nOracle\u8868\u9818\u57df\u4e00\u89a7\u3068\u4f7f\u7528\u30b5\u30a4\u30ba + TEMP\u8868\u9818\u57df\u306e\u30c7\u30a3\u30b9\u30af\u30bd\u30fc\u30c8\u767a\u751f\u56de\u6570\u3092\u8868\u793a\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\nOracle 11g\u30b5\u30fc\u30d0\u306e\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u5909\u6570\u306e\u5024\u306f\u30b5\u30f3\u30d7\u30eb\u7528\u306b\u4fee\u6b63\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n[oracle@example-oracle-11g-active ~]$ vi show_oracle_tablespace.sh\n\n\nshow_oracle_tablespace.sh\n#!/bin/sh\n\nexport NLS_DATE_FORMAT=\"YYYY/MM/DD HH24:MI:SS\"\n\nSQL_TEXT=\"/\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea/show_oracle_tablespace.sql\"\n\nif [ -r \"${SQL_TEXT}\" ] && [ -f \"sqlplus\" ] ; then\n\n        sqlplus / as sysdba @${SQL_TEXT}\n\nfi\n\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u5b9f\u884c\u6a29\u9650\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n[oracle@example-oracle-11g-active ~]$ chmod 755 show_oracle_tablespace.sh\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u5185\u3067\u5b9f\u884c\u3059\u308bSQL\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nSQL\u30d5\u30a1\u30a4\u30eb\u306b\u306fchmod 754\u306e\u3088\u3046\u306a\u5b9f\u884c\u6a29\u9650\u4ed8\u4e0e\u306f\u4e0d\u8981\u3067\u3059\u3002\n[oracle@example-oracle-11g-active ~]$ vi /\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea/show_oracle_tablespace.sql\n\n\nshow_oracle_tablespace.sql\nset echo on\nset colsep |\nset pages 1000\nset lines 1000\n\ncolumn TEMP_SIZE(MB)    format a15\ncolumn TEMP_HWM(MB)     format a15\ncolumn TEMP_HWM(%)      format a15\ncolumn TEMP_USED(MB)    format a15\ncolumn TEMP_USING(%)    format a15\n\n----- TEMP TABLESPACE USED\nSELECT\n       d.tablespace_name,\n       round(\u73fe\u30b5\u30a4\u30ba) \"SIZE(MB)\",\n       round(\u6700\u5927\u4f7f\u7528\u91cf) \"USED(MB)\",\n       round(((\u6700\u5927\u4f7f\u7528\u91cf/\u73fe\u30b5\u30a4\u30ba))*100) \"USE(%)\",\n       round(\u73fe\u30b5\u30a4\u30ba-\u6700\u5927\u4f7f\u7528\u91cf) \"AVAIL(MB)\"\nFROM\n       (SELECT tablespace_name, SUM(bytes)/(1024*1024) \"\u73fe\u30b5\u30a4\u30ba\" FROM dba_temp_files GROUP BY tablespace_name) d,\n       (SELECT tablespace_name, SUM(bytes_used)/(1024*1024) \"\u6700\u5927\u4f7f\u7528\u91cf\" FROM v$temp_extent_pool GROUP BY tablespace_name) f,\n       dba_tablespaces t\nWHERE\n       (d.tablespace_name = f.tablespace_name) AND (d.tablespace_name = t.tablespace_name )\nORDER BY\n       d.tablespace_name\n;\n\n----- TEMP TABLESPACE HWM\nSELECT\n       d.tablespace_name,\n       TO_CHAR(NVL(a.bytes / 1024 / 1024, 0),'99,999,990.900') \"TEMP_SIZE(MB)\",\n       TO_CHAR(NVL(t.hwm, 0)/1024/1024,'99999999.999')  \"TEMP_HWM(MB)\",\n       TO_CHAR(NVL(t.hwm / a.bytes * 100, 0), '990.00') \"TEMP_HWM(%)\" ,\n       TO_CHAR(NVL(t.bytes/1024/1024, 0),'99999999.999') \"TEMP_USED(MB)\",\n       TO_CHAR(NVL(t.bytes / a.bytes * 100, 0), '990.00') \"TEMP_USING(%)\"\nFROM\n       sys.dba_tablespaces d,\n       (select tablespace_name, sum(bytes) bytes from dba_temp_files group by tablespace_name) a,\n       (select tablespace_name, sum(bytes_cached) hwm, sum(bytes_used) bytes from v$temp_extent_pool group by tablespace_name) t\nWHERE d.tablespace_name = a.tablespace_name(+)\n       AND d.tablespace_name = t.tablespace_name(+)\n       AND d.extent_management like 'LOCAL'\n       AND d.contents like 'TEMPORARY'\n;\n\n----- DISK SORT INCIDENCE\ncol \"SORT_INCIDENCE(%)\" format 990.99\nSELECT\n        tablespace_name, ( used_blocks / total_blocks ) * 100 \"SORT_INCIDENCE(%)\"\nFROM\n        v$sort_segment\nWHERE\n        tablespace_name = 'TEMP' OR tablespace_name = 'TEMP_EXAMPLE1' OR tablespace_name = 'TEMP_EXAMPLE2'\nORDER BY\n        tablespace_name\n;\n\n----- DISK SORT COUNT\nSELECT\n        name, value \"SORT_FREQUENCY\"\nFROM\n        v$sysstat\nWHERE\n        name like '%sort%'\nORDER BY\n        name\n;\n\n----- TABLESPACE USED\nSELECT\n        d.tablespace_name,\n        \u73fe\u30b5\u30a4\u30ba \"SIZE(MB)\",\n        round(\u73fe\u30b5\u30a4\u30ba-\u7a7a\u304d\u5bb9\u91cf) \"USED(MB)\",\n        round((1 - (\u7a7a\u304d\u5bb9\u91cf/\u73fe\u30b5\u30a4\u30ba))*100) \"USE(%)\",\n        \u7a7a\u304d\u5bb9\u91cf \"AVAIL(MB)\"\nFROM\n        (SELECT tablespace_name, round(SUM(bytes)/(1024*1024)) \"\u73fe\u30b5\u30a4\u30ba\" FROM dba_data_files GROUP BY tablespace_name) d,\n        (SELECT tablespace_name, round(SUM(bytes)/(1024*1024)) \"\u7a7a\u304d\u5bb9\u91cf\" FROM dba_free_space GROUP BY tablespace_name) f\nWHERE\n        d.tablespace_name = f.tablespace_name\nORDER BY\n        d.tablespace_name\n;\n\nexit;\n\n\nSQL\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u306b\u306f\u5b9f\u884c\u6a29\u9650\u306f\u4e0d\u8981\u306a\u306e\u3067\u3001\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3092644\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n[oracle@example-oracle-11g-active ~]$ chmod 644 /\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea/show_oracle_tablespace.sql\n\n\nOracle 11g\u30b5\u30fc\u30d0\u3067\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u5b9f\u884c\u4f8b\nOralce 11g\u30b5\u30fc\u30d0\u306boracle\u30e6\u30fc\u30b6\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3001\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u3088\u3046\u306bOracle\u30b5\u30fc\u30d0\u306b\u683c\u7d0d\u3057\u3066\u3044\u308b\u8868\u9818\u57df\u4e00\u89a7\u3084\u4f7f\u7528\u30b5\u30a4\u30ba\u3001TEMP\u8868\u9818\u57df\u306e\u30c7\u30a3\u30b9\u30af\u30bd\u30fc\u30c8\u767a\u751f\u56de\u6570\u3092\u8868\u793a\u51fa\u6765\u307e\u3059\u3002\n\u306a\u304a\u3001\u4ee5\u4e0b\u306b\u8a18\u8f09\u3057\u3066\u3044\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u5b9f\u884c\u7d50\u679c\u306e\u8868\u9818\u57df\u540d\u3084\u30b5\u30a4\u30ba\u7b49\u306f\u30b5\u30f3\u30d7\u30eb\u7528\u306b\u4fee\u6b63\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n[oracle@example-oracle-11g-active ~]$ ./show_oracle_tablespace.sh\nSQL> set colsep |\nSQL> set pages 1000\nSQL> set lines 1000\nSQL>\nSQL> column TEMP_SIZE(MB)       format a15\nSQL> column TEMP_HWM(MB)        format a15\nSQL> column TEMP_HWM(%) format a15\nSQL> column TEMP_USED(MB)       format a15\nSQL> column TEMP_USING(%)       format a15\nSQL>\nSQL> ----- TEMP TABLESPACE USED\nSQL> SELECT\n  2         d.tablespace_name,\n  3         round(\u73fe\u30b5\u30a4\u30ba) \"SIZE(MB)\",\n  4         round(\u6700\u5927\u4f7f\u7528\u91cf) \"USED(MB)\",\n  5         round(((\u6700\u5927\u4f7f\u7528\u91cf/\u73fe\u30b5\u30a4\u30ba))*100) \"USE(%)\",\n  6         round(\u73fe\u30b5\u30a4\u30ba-\u6700\u5927\u4f7f\u7528\u91cf) \"AVAIL(MB)\"\n  7  FROM\n  8         (SELECT tablespace_name, SUM(bytes)/(1024*1024) \"\u73fe\u30b5\u30a4\u30ba\" FROM dba_temp_files GROUP BY tablespace_name) d,\n  9         (SELECT tablespace_name, SUM(bytes_used)/(1024*1024) \"\u6700\u5927\u4f7f\u7528\u91cf\" FROM v$temp_extent_pool GROUP BY tablespace_name) f,\n 10         dba_tablespaces t\n 11  WHERE\n 12         (d.tablespace_name = f.tablespace_name) AND (d.tablespace_name = t.tablespace_name )\n 13  ORDER BY\n 14         d.tablespace_name\n 15  ;\n\nTABLESPACE_NAME               |  SIZE(MB)|  USED(MB)|    USE(%)| AVAIL(MB)\n------------------------------|----------|----------|----------|----------\nTEMP                          |      5040|         0|         0|      5040\nTEMP_EXAMPLE1                 |     12000|         0|         0|     12000\nTEMP_EXAMPLE2                 |       200|         0|         0|       200\n\nSQL>\nSQL> ----- TEMP TABLESPACE HWM\nSQL> SELECT\n  2         d.tablespace_name,\n  3         TO_CHAR(NVL(a.bytes / 1024 / 1024, 0),'99,999,990.900') \"TEMP_SIZE(MB)\",\n  4         TO_CHAR(NVL(t.hwm, 0)/1024/1024,'99999999.999')  \"TEMP_HWM(MB)\",\n  5         TO_CHAR(NVL(t.hwm / a.bytes * 100, 0), '990.00') \"TEMP_HWM(%)\" ,\n  6         TO_CHAR(NVL(t.bytes/1024/1024, 0),'99999999.999') \"TEMP_USED(MB)\",\n  7         TO_CHAR(NVL(t.bytes / a.bytes * 100, 0), '990.00') \"TEMP_USING(%)\"\n  8  FROM\n  9         sys.dba_tablespaces d,\n 10         (select tablespace_name, sum(bytes) bytes from dba_temp_files group by tablespace_name) a,\n 11         (select tablespace_name, sum(bytes_cached) hwm, sum(bytes_used) bytes from v$temp_extent_pool group by tablespace_name) t\n 12  WHERE d.tablespace_name = a.tablespace_name(+)\n 13         AND d.tablespace_name = t.tablespace_name(+)\n 14         AND d.extent_management like 'LOCAL'\n 15         AND d.contents like 'TEMPORARY'\n 16  ;\n\nTABLESPACE_NAME               |TEMP_SIZE(MB)  |TEMP_HWM(MB)   |TEMP_HWM(%)    |TEMP_USED(MB)  |TEMP_USING(%)\n------------------------------|---------------|---------------|---------------|---------------|---------------\nTEMP                          |      5,040.000|     2519.000  |  49.98        |         .000  |   0.00\nTEMP_EXAMPLE1                 |     12,000.000|    11931.000  |  99.43        |         .000  |   0.00\nTEMP_EXAMPLE2                 |        200.000|       72.000  |  36.00        |         .000  |   0.00\n\nSQL>\nSQL> ----- DISK SORT INCIDENCE\nSQL> col \"SORT_INCIDENCE(%)\" format 990.99\nSQL> SELECT\n  2          tablespace_name, ( used_blocks / total_blocks ) * 100 \"SORT_INCIDENCE(%)\"\n  3  FROM\n  4          v$sort_segment\n  5  WHERE\n  6          tablespace_name = 'TEMP' OR tablespace_name = 'TEMP_EXAMPLE1' OR tablespace_name = 'TEMP_EXAMPLE2'\n  7  ORDER BY\n  8          tablespace_name\n  9  ;\n\nTABLESPACE_NAME                |SORT_INCIDENCE(%)\n-------------------------------|-----------------\nTEMP                           |             0.00\nTEMP_EXAMPLE1                  |             0.00\nTEMP_EXAMPLE2                  |             0.00\n\nSQL>\nSQL> ----- DISK SORT COUNT\nSQL> SELECT\n  2          name, value \"SORT_FREQUENCY\"\n  3  FROM\n  4          v$sysstat\n  5  WHERE\n  6          name like '%sort%'\n  7  ORDER BY\n  8          name\n  9  ;\n\nNAME                                                            |SORT_FREQUENCY\n----------------------------------------------------------------|--------------\nsorts (disk)                                                    |           190\nsorts (memory)                                                  |    1881695505\nsorts (rows)                                                    |    1.5694E+11\n\nSQL>\nSQL> ----- TABLESPACE USED\nSQL> SELECT\n  2          d.tablespace_name,\n  3          \u73fe\u30b5\u30a4\u30ba \"SIZE(MB)\",\n  4          round(\u73fe\u30b5\u30a4\u30ba-\u7a7a\u304d\u5bb9\u91cf) \"USED(MB)\",\n  5          round((1 - (\u7a7a\u304d\u5bb9\u91cf/\u73fe\u30b5\u30a4\u30ba))*100) \"USE(%)\",\n  6          \u7a7a\u304d\u5bb9\u91cf \"AVAIL(MB)\"\n  7  FROM\n  8          (SELECT tablespace_name, round(SUM(bytes)/(1024*1024)) \"\u73fe\u30b5\u30a4\u30ba\" FROM dba_data_files GROUP BY tablespace_name) d,\n  9          (SELECT tablespace_name, round(SUM(bytes)/(1024*1024)) \"\u7a7a\u304d\u5bb9\u91cf\" FROM dba_free_space GROUP BY tablespace_name) f\n 10  WHERE\n 11          d.tablespace_name = f.tablespace_name\n 12  ORDER BY\n 13          d.tablespace_name\n 14  ;\n\nTABLESPACE_NAME               |  SIZE(MB)|  USED(MB)|    USE(%)| AVAIL(MB)\n------------------------------|----------|----------|----------|----------\nINDX_EXAMPLE1                 |     15900|      9800|        62|      6100\nINDX_EXAMPLE2                 |      3600|      2700|        75|       900\n\u3000\u3000(\u7701\u7565)\nSYSAUX                        |      2048|      1677|        82|       371\nSYSTEM                        |       500|       459|        92|        41\nTOOLS                         |       500|       154|        31|       346\nTS_EXAMPLE1                   |     12000|      8200|        68|      3800\nTS_EXAMPLE1                   |      3600|      2700|        75|       900\n\u3000\u3000(\u7701\u7565)\nUNDOTBS2                      |     46820|     11305|        24|     35515\nUSERS                         |        10|         1|        10|         9\n\nXXX rows selected.\n\nSQL>\nSQL> exit;\n[oracle@example-oracle-11g-active ~]$\n\nOracle\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u904b\u7528\u7ba1\u7406\u3092\u3057\u3066\u3044\u304f\u4e0a\u3067\u3001\u69d8\u3005\u306a\u60c5\u5831\u3092\u78ba\u8a8d\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u5404\u8868\u9818\u57df\u306e\u30c7\u30fc\u30bf\u4f7f\u7528\u91cf\u3001\u30c7\u30a3\u30b9\u30af\u30bd\u30fc\u30c8\u306e\u3088\u3046\u306a\u30e1\u30e2\u30ea\u306b\u53ce\u307e\u308a\u304d\u3089\u305a\u30c7\u30a3\u30b9\u30afI/O\u3092\u4f34\u3046\u51e6\u7406\u304c\u767a\u751f\u3057\u3066\u3044\u306a\u3044\u304b\u3069\u3046\u304b\u3082\u78ba\u8a8d\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u3068\u826f\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\u3054\u53c2\u8003\u306b\u306a\u308a\u307e\u3057\u305f\u3089\u5e78\u3044\u3067\u3059\u3002\n\u4ee5\u4e0a\u306b\u306a\u308a\u307e\u3059\u3002\n\u306f\u3058\u3081\u306b\n===\n\nOracle 11g\u306e\u8868\u9818\u57df(\u30c6\u30fc\u30d6\u30eb\u30b9\u30da\u30fc\u30b9)\u4e00\u89a7\u306e\u4f7f\u7528\u30b5\u30a4\u30ba\u3084\u7a7a\u304d\u5bb9\u91cf + TEMP\u8868\u9818\u57df\u306e\u30c7\u30a3\u30b9\u30af\u30bd\u30fc\u30c8\u767a\u751f\u56de\u6570\u3092\u8868\u793a\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u3064\u3044\u3066\u8a18\u8f09\u81f4\u3057\u307e\u3059\u3002\n\n\u6982\u8981\n===\n\nLinux\u30b5\u30fc\u30d0\u4e0a\u306b\u69cb\u7bc9\u3057\u305fOracle 11g\u30b5\u30fc\u30d0(11.1.0.7.2)\u306e\u904b\u7528\u7ba1\u7406\u3092\u3057\u3066\u304a\u308a\u307e\u3059\u300224\u6642\u9593365\u65e5\u7a3c\u52d5\u3057\u7d9a\u3051\u308b\u30b5\u30fc\u30d3\u30b9\u306e\u672c\u756a\u74b0\u5883Oracle\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30b5\u30fc\u30d0\u3092\u904b\u7528\u3057\u3066\u3044\u308b\u70ba\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u8ca0\u8377\u3001\u30bb\u30c3\u30b7\u30e7\u30f3\u60c5\u5831\u3001\u30ed\u30c3\u30af\u3084\u30e9\u30c3\u30c1\u306e\u767a\u751f\u72b6\u6cc1\u3001SQL\u30b3\u30b9\u30c8\u306e\u5909\u5316\u306a\u3069\u69d8\u3005\u306a\u60c5\u5831\u3092\u78ba\u8a8d\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n\nOracle\u30b5\u30fc\u30d0\u306e\u30ea\u30bd\u30fc\u30b9\u4f7f\u7528\u72b6\u6cc1\u78ba\u8a8d\u306e\u4e00\u90e8\u3068\u3057\u3066\u3001Oracle\u30b5\u30fc\u30d0\u4e0a\u306b\u683c\u7d0d\u3057\u3066\u3044\u308b\u5404\u8868\u9818\u57df\u306e\u4f7f\u7528\u30b5\u30a4\u30ba\u3084\u7a7a\u304d\u5bb9\u91cf\u3001TEMP\u8868\u9818\u57df\u306e\u30c7\u30a3\u30b9\u30af\u30bd\u30fc\u30c8\u767a\u751f\u56de\u6570\u3092\u78ba\u8a8d\u3057\u305f\u3044\u3068\u3044\u3046\u4e8b\u304c\u3042\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u5f8c\u8ff0\u306eOracle\u8868\u9818\u57df\u4e00\u89a7\u3068\u4f7f\u7528\u30b5\u30a4\u30ba + TEMP\u8868\u9818\u57df\u306e\u30c7\u30a3\u30b9\u30af\u30bd\u30fc\u30c8\u767a\u751f\u56de\u6570\u3092\u8868\u793a\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u3001\u5b9a\u671f\u7684\u306b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u3066\u5404\u8868\u9818\u57df\u306e\u4f7f\u7528\u30b5\u30a4\u30ba\u3092\u30b0\u30e9\u30d5\u5316\u3057\u305f\u308a\u3001\u624b\u52d5\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u3066Oracle 11g\u30b5\u30fc\u30d0\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n\nOracle Enterprise Manager\u3067\u3082\u5404\u8868\u9818\u57df\u306e\u4f7f\u7528\u30b5\u30a4\u30ba\u3084\u7a7a\u304d\u5bb9\u91cf\u306f\u78ba\u8a8d\u51fa\u6765\u307e\u3059\u304c\u3001\u78ba\u8a8d\u65b9\u6cd5\u306e\u4e00\u3064\u3068\u3057\u3066\u3001\u3054\u53c2\u8003\u306b\u306a\u308a\u307e\u3057\u305f\u3089\u5e78\u3044\u3067\u3059\u3002\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u74b0\u5883\n===\n\n\u30fbOracle 11g (11.1.0.7.2)\n\nOracle\u8868\u9818\u57df\u4e00\u89a7\u3068\u4f7f\u7528\u30b5\u30a4\u30ba + TEMP\u8868\u9818\u57df\u306e\u30c7\u30a3\u30b9\u30af\u30bd\u30fc\u30c8\u767a\u751f\u56de\u6570\u3092\u8868\u793a\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\n===\n\nOracle 11g\u30b5\u30fc\u30d0\u306e\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u5909\u6570\u306e\u5024\u306f\u30b5\u30f3\u30d7\u30eb\u7528\u306b\u4fee\u6b63\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n\n```\n[oracle@example-oracle-11g-active ~]$ vi show_oracle_tablespace.sh\n```\n\n```sh:show_oracle_tablespace.sh\n#!/bin/sh\n\nexport NLS_DATE_FORMAT=\"YYYY/MM/DD HH24:MI:SS\"\n\nSQL_TEXT=\"/\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea/show_oracle_tablespace.sql\"\n\nif [ -r \"${SQL_TEXT}\" ] && [ -f \"sqlplus\" ] ; then\n\n        sqlplus / as sysdba @${SQL_TEXT}\n\nfi\n```\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u5b9f\u884c\u6a29\u9650\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```\n[oracle@example-oracle-11g-active ~]$ chmod 755 show_oracle_tablespace.sh\n```\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u5185\u3067\u5b9f\u884c\u3059\u308bSQL\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nSQL\u30d5\u30a1\u30a4\u30eb\u306b\u306fchmod 754\u306e\u3088\u3046\u306a\u5b9f\u884c\u6a29\u9650\u4ed8\u4e0e\u306f\u4e0d\u8981\u3067\u3059\u3002\n\n```\n[oracle@example-oracle-11g-active ~]$ vi /\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea/show_oracle_tablespace.sql\n```\n\n```sql:show_oracle_tablespace.sql\nset echo on\nset colsep |\nset pages 1000\nset lines 1000\n\ncolumn TEMP_SIZE(MB)    format a15\ncolumn TEMP_HWM(MB)     format a15\ncolumn TEMP_HWM(%)      format a15\ncolumn TEMP_USED(MB)    format a15\ncolumn TEMP_USING(%)    format a15\n\n----- TEMP TABLESPACE USED\nSELECT\n       d.tablespace_name,\n       round(\u73fe\u30b5\u30a4\u30ba) \"SIZE(MB)\",\n       round(\u6700\u5927\u4f7f\u7528\u91cf) \"USED(MB)\",\n       round(((\u6700\u5927\u4f7f\u7528\u91cf/\u73fe\u30b5\u30a4\u30ba))*100) \"USE(%)\",\n       round(\u73fe\u30b5\u30a4\u30ba-\u6700\u5927\u4f7f\u7528\u91cf) \"AVAIL(MB)\"\nFROM\n       (SELECT tablespace_name, SUM(bytes)/(1024*1024) \"\u73fe\u30b5\u30a4\u30ba\" FROM dba_temp_files GROUP BY tablespace_name) d,\n       (SELECT tablespace_name, SUM(bytes_used)/(1024*1024) \"\u6700\u5927\u4f7f\u7528\u91cf\" FROM v$temp_extent_pool GROUP BY tablespace_name) f,\n       dba_tablespaces t\nWHERE\n       (d.tablespace_name = f.tablespace_name) AND (d.tablespace_name = t.tablespace_name )\nORDER BY\n       d.tablespace_name\n;\n\n----- TEMP TABLESPACE HWM\nSELECT\n       d.tablespace_name,\n       TO_CHAR(NVL(a.bytes / 1024 / 1024, 0),'99,999,990.900') \"TEMP_SIZE(MB)\",\n       TO_CHAR(NVL(t.hwm, 0)/1024/1024,'99999999.999')  \"TEMP_HWM(MB)\",\n       TO_CHAR(NVL(t.hwm / a.bytes * 100, 0), '990.00') \"TEMP_HWM(%)\" ,\n       TO_CHAR(NVL(t.bytes/1024/1024, 0),'99999999.999') \"TEMP_USED(MB)\",\n       TO_CHAR(NVL(t.bytes / a.bytes * 100, 0), '990.00') \"TEMP_USING(%)\"\nFROM\n       sys.dba_tablespaces d,\n       (select tablespace_name, sum(bytes) bytes from dba_temp_files group by tablespace_name) a,\n       (select tablespace_name, sum(bytes_cached) hwm, sum(bytes_used) bytes from v$temp_extent_pool group by tablespace_name) t\nWHERE d.tablespace_name = a.tablespace_name(+)\n       AND d.tablespace_name = t.tablespace_name(+)\n       AND d.extent_management like 'LOCAL'\n       AND d.contents like 'TEMPORARY'\n;\n\n----- DISK SORT INCIDENCE\ncol \"SORT_INCIDENCE(%)\" format 990.99\nSELECT\n        tablespace_name, ( used_blocks / total_blocks ) * 100 \"SORT_INCIDENCE(%)\"\nFROM\n        v$sort_segment\nWHERE\n        tablespace_name = 'TEMP' OR tablespace_name = 'TEMP_EXAMPLE1' OR tablespace_name = 'TEMP_EXAMPLE2'\nORDER BY\n        tablespace_name\n;\n\n----- DISK SORT COUNT\nSELECT\n        name, value \"SORT_FREQUENCY\"\nFROM\n        v$sysstat\nWHERE\n        name like '%sort%'\nORDER BY\n        name\n;\n\n----- TABLESPACE USED\nSELECT\n        d.tablespace_name,\n        \u73fe\u30b5\u30a4\u30ba \"SIZE(MB)\",\n        round(\u73fe\u30b5\u30a4\u30ba-\u7a7a\u304d\u5bb9\u91cf) \"USED(MB)\",\n        round((1 - (\u7a7a\u304d\u5bb9\u91cf/\u73fe\u30b5\u30a4\u30ba))*100) \"USE(%)\",\n        \u7a7a\u304d\u5bb9\u91cf \"AVAIL(MB)\"\nFROM\n        (SELECT tablespace_name, round(SUM(bytes)/(1024*1024)) \"\u73fe\u30b5\u30a4\u30ba\" FROM dba_data_files GROUP BY tablespace_name) d,\n        (SELECT tablespace_name, round(SUM(bytes)/(1024*1024)) \"\u7a7a\u304d\u5bb9\u91cf\" FROM dba_free_space GROUP BY tablespace_name) f\nWHERE\n        d.tablespace_name = f.tablespace_name\nORDER BY\n        d.tablespace_name\n;\n\nexit;\n```\n\nSQL\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u306b\u306f\u5b9f\u884c\u6a29\u9650\u306f\u4e0d\u8981\u306a\u306e\u3067\u3001\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3092644\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n[oracle@example-oracle-11g-active ~]$ chmod 644 /\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea/show_oracle_tablespace.sql\n```\n\nOracle 11g\u30b5\u30fc\u30d0\u3067\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u5b9f\u884c\u4f8b\n===\n\nOralce 11g\u30b5\u30fc\u30d0\u306boracle\u30e6\u30fc\u30b6\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3001\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u3088\u3046\u306bOracle\u30b5\u30fc\u30d0\u306b\u683c\u7d0d\u3057\u3066\u3044\u308b\u8868\u9818\u57df\u4e00\u89a7\u3084\u4f7f\u7528\u30b5\u30a4\u30ba\u3001TEMP\u8868\u9818\u57df\u306e\u30c7\u30a3\u30b9\u30af\u30bd\u30fc\u30c8\u767a\u751f\u56de\u6570\u3092\u8868\u793a\u51fa\u6765\u307e\u3059\u3002\n\n\u306a\u304a\u3001\u4ee5\u4e0b\u306b\u8a18\u8f09\u3057\u3066\u3044\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u5b9f\u884c\u7d50\u679c\u306e\u8868\u9818\u57df\u540d\u3084\u30b5\u30a4\u30ba\u7b49\u306f\u30b5\u30f3\u30d7\u30eb\u7528\u306b\u4fee\u6b63\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n\n```\n[oracle@example-oracle-11g-active ~]$ ./show_oracle_tablespace.sh\nSQL> set colsep |\nSQL> set pages 1000\nSQL> set lines 1000\nSQL>\nSQL> column TEMP_SIZE(MB)       format a15\nSQL> column TEMP_HWM(MB)        format a15\nSQL> column TEMP_HWM(%) format a15\nSQL> column TEMP_USED(MB)       format a15\nSQL> column TEMP_USING(%)       format a15\nSQL>\nSQL> ----- TEMP TABLESPACE USED\nSQL> SELECT\n  2         d.tablespace_name,\n  3         round(\u73fe\u30b5\u30a4\u30ba) \"SIZE(MB)\",\n  4         round(\u6700\u5927\u4f7f\u7528\u91cf) \"USED(MB)\",\n  5         round(((\u6700\u5927\u4f7f\u7528\u91cf/\u73fe\u30b5\u30a4\u30ba))*100) \"USE(%)\",\n  6         round(\u73fe\u30b5\u30a4\u30ba-\u6700\u5927\u4f7f\u7528\u91cf) \"AVAIL(MB)\"\n  7  FROM\n  8         (SELECT tablespace_name, SUM(bytes)/(1024*1024) \"\u73fe\u30b5\u30a4\u30ba\" FROM dba_temp_files GROUP BY tablespace_name) d,\n  9         (SELECT tablespace_name, SUM(bytes_used)/(1024*1024) \"\u6700\u5927\u4f7f\u7528\u91cf\" FROM v$temp_extent_pool GROUP BY tablespace_name) f,\n 10         dba_tablespaces t\n 11  WHERE\n 12         (d.tablespace_name = f.tablespace_name) AND (d.tablespace_name = t.tablespace_name )\n 13  ORDER BY\n 14         d.tablespace_name\n 15  ;\n\nTABLESPACE_NAME               |  SIZE(MB)|  USED(MB)|    USE(%)| AVAIL(MB)\n------------------------------|----------|----------|----------|----------\nTEMP                          |      5040|         0|         0|      5040\nTEMP_EXAMPLE1                 |     12000|         0|         0|     12000\nTEMP_EXAMPLE2                 |       200|         0|         0|       200\n\nSQL>\nSQL> ----- TEMP TABLESPACE HWM\nSQL> SELECT\n  2         d.tablespace_name,\n  3         TO_CHAR(NVL(a.bytes / 1024 / 1024, 0),'99,999,990.900') \"TEMP_SIZE(MB)\",\n  4         TO_CHAR(NVL(t.hwm, 0)/1024/1024,'99999999.999')  \"TEMP_HWM(MB)\",\n  5         TO_CHAR(NVL(t.hwm / a.bytes * 100, 0), '990.00') \"TEMP_HWM(%)\" ,\n  6         TO_CHAR(NVL(t.bytes/1024/1024, 0),'99999999.999') \"TEMP_USED(MB)\",\n  7         TO_CHAR(NVL(t.bytes / a.bytes * 100, 0), '990.00') \"TEMP_USING(%)\"\n  8  FROM\n  9         sys.dba_tablespaces d,\n 10         (select tablespace_name, sum(bytes) bytes from dba_temp_files group by tablespace_name) a,\n 11         (select tablespace_name, sum(bytes_cached) hwm, sum(bytes_used) bytes from v$temp_extent_pool group by tablespace_name) t\n 12  WHERE d.tablespace_name = a.tablespace_name(+)\n 13         AND d.tablespace_name = t.tablespace_name(+)\n 14         AND d.extent_management like 'LOCAL'\n 15         AND d.contents like 'TEMPORARY'\n 16  ;\n\nTABLESPACE_NAME               |TEMP_SIZE(MB)  |TEMP_HWM(MB)   |TEMP_HWM(%)    |TEMP_USED(MB)  |TEMP_USING(%)\n------------------------------|---------------|---------------|---------------|---------------|---------------\nTEMP                          |      5,040.000|     2519.000  |  49.98        |         .000  |   0.00\nTEMP_EXAMPLE1                 |     12,000.000|    11931.000  |  99.43        |         .000  |   0.00\nTEMP_EXAMPLE2                 |        200.000|       72.000  |  36.00        |         .000  |   0.00\n\nSQL>\nSQL> ----- DISK SORT INCIDENCE\nSQL> col \"SORT_INCIDENCE(%)\" format 990.99\nSQL> SELECT\n  2          tablespace_name, ( used_blocks / total_blocks ) * 100 \"SORT_INCIDENCE(%)\"\n  3  FROM\n  4          v$sort_segment\n  5  WHERE\n  6          tablespace_name = 'TEMP' OR tablespace_name = 'TEMP_EXAMPLE1' OR tablespace_name = 'TEMP_EXAMPLE2'\n  7  ORDER BY\n  8          tablespace_name\n  9  ;\n\nTABLESPACE_NAME                |SORT_INCIDENCE(%)\n-------------------------------|-----------------\nTEMP                           |             0.00\nTEMP_EXAMPLE1                  |             0.00\nTEMP_EXAMPLE2                  |             0.00\n\nSQL>\nSQL> ----- DISK SORT COUNT\nSQL> SELECT\n  2          name, value \"SORT_FREQUENCY\"\n  3  FROM\n  4          v$sysstat\n  5  WHERE\n  6          name like '%sort%'\n  7  ORDER BY\n  8          name\n  9  ;\n\nNAME                                                            |SORT_FREQUENCY\n----------------------------------------------------------------|--------------\nsorts (disk)                                                    |           190\nsorts (memory)                                                  |    1881695505\nsorts (rows)                                                    |    1.5694E+11\n\nSQL>\nSQL> ----- TABLESPACE USED\nSQL> SELECT\n  2          d.tablespace_name,\n  3          \u73fe\u30b5\u30a4\u30ba \"SIZE(MB)\",\n  4          round(\u73fe\u30b5\u30a4\u30ba-\u7a7a\u304d\u5bb9\u91cf) \"USED(MB)\",\n  5          round((1 - (\u7a7a\u304d\u5bb9\u91cf/\u73fe\u30b5\u30a4\u30ba))*100) \"USE(%)\",\n  6          \u7a7a\u304d\u5bb9\u91cf \"AVAIL(MB)\"\n  7  FROM\n  8          (SELECT tablespace_name, round(SUM(bytes)/(1024*1024)) \"\u73fe\u30b5\u30a4\u30ba\" FROM dba_data_files GROUP BY tablespace_name) d,\n  9          (SELECT tablespace_name, round(SUM(bytes)/(1024*1024)) \"\u7a7a\u304d\u5bb9\u91cf\" FROM dba_free_space GROUP BY tablespace_name) f\n 10  WHERE\n 11          d.tablespace_name = f.tablespace_name\n 12  ORDER BY\n 13          d.tablespace_name\n 14  ;\n\nTABLESPACE_NAME               |  SIZE(MB)|  USED(MB)|    USE(%)| AVAIL(MB)\n------------------------------|----------|----------|----------|----------\nINDX_EXAMPLE1                 |     15900|      9800|        62|      6100\nINDX_EXAMPLE2                 |      3600|      2700|        75|       900\n\u3000\u3000(\u7701\u7565)\nSYSAUX                        |      2048|      1677|        82|       371\nSYSTEM                        |       500|       459|        92|        41\nTOOLS                         |       500|       154|        31|       346\nTS_EXAMPLE1                   |     12000|      8200|        68|      3800\nTS_EXAMPLE1                   |      3600|      2700|        75|       900\n\u3000\u3000(\u7701\u7565)\nUNDOTBS2                      |     46820|     11305|        24|     35515\nUSERS                         |        10|         1|        10|         9\n\nXXX rows selected.\n\nSQL>\nSQL> exit;\n[oracle@example-oracle-11g-active ~]$\n```\n\nOracle\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u904b\u7528\u7ba1\u7406\u3092\u3057\u3066\u3044\u304f\u4e0a\u3067\u3001\u69d8\u3005\u306a\u60c5\u5831\u3092\u78ba\u8a8d\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u5404\u8868\u9818\u57df\u306e\u30c7\u30fc\u30bf\u4f7f\u7528\u91cf\u3001\u30c7\u30a3\u30b9\u30af\u30bd\u30fc\u30c8\u306e\u3088\u3046\u306a\u30e1\u30e2\u30ea\u306b\u53ce\u307e\u308a\u304d\u3089\u305a\u30c7\u30a3\u30b9\u30afI/O\u3092\u4f34\u3046\u51e6\u7406\u304c\u767a\u751f\u3057\u3066\u3044\u306a\u3044\u304b\u3069\u3046\u304b\u3082\u78ba\u8a8d\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u3068\u826f\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\u3054\u53c2\u8003\u306b\u306a\u308a\u307e\u3057\u305f\u3089\u5e78\u3044\u3067\u3059\u3002\n\n\u4ee5\u4e0a\u306b\u306a\u308a\u307e\u3059\u3002\n", "tags": ["oracle", "ShellScript", "SQL"]}