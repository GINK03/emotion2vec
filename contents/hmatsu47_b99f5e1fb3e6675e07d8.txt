{"context": "MySQL(InnoDB)\u3067\u30ab\u30fc\u30c7\u30a3\u30ca\u30ea\u30c6\u30a3\u306e\u4f4e\u3044\u30ab\u30e9\u30e0\u306bINDEX\u3092\u5f35\u308b\u306e\u300c\u304a\u307e\u3051\u300d\u306e\u7d9a\u304d\u3067\u3059\u3002\n\u540c\u3058WHERE\u53e5\u3092\u6307\u5b9a\u3057\u305f\u306e\u306b\u3001UPDATE\u6587\u3068SELECT\u6587\u306e\u9593\u3067\u7d50\u679c\u304c\u5206\u304b\u308c\u307e\u3057\u305f\u3002\n\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u30c8\u30ec\u30fc\u30b9\u3092\u4f7f\u3063\u3066\u3001\u3082\u3046\u5c11\u3057\u8a73\u3057\u304f\u8abf\u3079\u3066\u307f\u307e\u3059\u3002\n\n\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u30c8\u30ec\u30fc\u30b9\u3068\u306f\nMySQL 5.6\u304b\u3089\u5b9f\u88c5\u3055\u308c\u305f\u3001\u300c\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u304c\u5b9f\u884c\u8a08\u753b\u3092\u9078\u629e\u3059\u308b\u904e\u7a0b\u3092\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u6a5f\u80fd\u300d\u3067\u3059\u3002\nEXPLAIN\u3067\u306f\u3001\u6700\u7d42\u7684\u306b\u9078\u629e\u3055\u308c\u308b\u5b9f\u884c\u8a08\u753b\u306e\u307f\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u304c\u3001\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u30c8\u30ec\u30fc\u30b9\u3067\u306f\u3001\u6bd4\u8f03\u691c\u8a0e\u3055\u308c\u305f\u5b9f\u884c\u8a08\u753b\u306e\u60c5\u5831\u306a\u3069\u3082\u542b\u3081\u3066\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u30c8\u30ec\u30fc\u30b9\u3092\u4f7f\u3046\u306b\u306f\n\u4ee5\u4e0b\u306e\u5909\u6570\u3092\u8a2d\u5b9a\u3059\u308b\u3060\u3051\u3067\u3001\u63a5\u7d9a\u4e2d\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u3067\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u30c8\u30ec\u30fc\u30b9\u304c\u6709\u52b9\u306b\u306a\u308a\u307e\u3059\u3002\nmysql> SET optimizer_trace='enabled=on';\nQuery OK, 0 rows affected (0.00 sec)\n\n\u6709\u52b9\u306a\u72b6\u614b\u3067SQL\u3092\u5b9f\u884c\u3057\u3001\u305d\u308c\u306b\u7d9a\u3044\u3066\nmysql> SELECT * FROM information_schema.optimizer_trace\\G\n\n\u3068\u3059\u308b\u3053\u3068\u3067\u3001\u5b9f\u884c\u8a08\u753b\u306e\u60c5\u5831\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\u7d42\u308f\u3063\u305f\u3089\u3001\nmysql> SET optimizer_trace='enabled=off';\n\n\u3067\u7121\u52b9\u306b\u3057\u307e\u3059\u3002\n\n\u4f7f\u3063\u3066\u307f\u307e\u3057\u3087\u3046\nMySQL(InnoDB)\u3067\u30ab\u30fc\u30c7\u30a3\u30ca\u30ea\u30c6\u30a3\u306e\u4f4e\u3044\u30ab\u30e9\u30e0\u306bINDEX\u3092\u5f35\u308b\u306e\u3068\u304d\u306e\u30c6\u30fc\u30d6\u30eb\u3067\u3001\u300cWHERE flag = 0\u300d\u3092\u4ed8\u3051\u305fSELECT\u6587\u3068\u3001UPDATE\u6587\u3092\u6bd4\u8f03\u3057\u3066\u307f\u307e\u3059\uff0810,000\u4ef6\u306e\u4e2d\u304b\u308910\u4ef6\u3092\u62bd\u51fa\uff09\u3002\n\u307e\u305a\u306fEXPLAIN\u306e\u304a\u3055\u3089\u3044\u3067\u3059\u3002\nmysql> USE cardi_test;\nDatabase changed\nmysql> EXPLAIN SELECT * FROM test_data WHERE flag = 0;\n+----+-------------+-----------+------------+------+---------------+----------+---------+-------+------+----------+-------+\n| id | select_type | table     | partitions | type | possible_keys | key      | key_len | ref   | rows | filtered | Extra |\n+----+-------------+-----------+------------+------+---------------+----------+---------+-------+------+----------+-------+\n|  1 | SIMPLE      | test_data | NULL       | ref  | idx_flag      | idx_flag | 4       | const |   10 |   100.00 | NULL  |\n+----+-------------+-----------+------------+------+---------------+----------+---------+-------+------+----------+-------+\n1 row in set, 1 warning (0.00 sec)\n\nmysql> EXPLAIN UPDATE test_data SET flag = 1 WHERE flag = 0;\n+----+-------------+-----------+------------+-------+---------------+----------+---------+-------+------+----------+------------------------------+\n| id | select_type | table     | partitions | type  | possible_keys | key      | key_len | ref   | rows | filtered | Extra                        |\n+----+-------------+-----------+------------+-------+---------------+----------+---------+-------+------+----------+------------------------------+\n|  1 | UPDATE      | test_data | NULL       | range | idx_flag      | idx_flag | 4       | const |   10 |   100.00 | Using where; Using temporary |\n+----+-------------+-----------+------------+-------+---------------+----------+---------+-------+------+----------+------------------------------+\n1 row in set (0.00 sec)\n\n\u2026\u3042\u3089\u305f\u3081\u3066\u898b\u6bd4\u3079\u3066\u307f\u308b\u3068\u3001\u300ctype\u300d\u304cSELECT\u6587\u306e\u3068\u304d\u300cref\u300d\uff08\u4e3b\u306b\u975e\u30e6\u30cb\u30fc\u30afINDEX\u3067\u7b49\u4fa1\u691c\u7d22\uff09\u3001UPDATE\u6587\u306e\u3068\u304d\u300crange\u300d\uff08\u4e3b\u306b\u7bc4\u56f2\u691c\u7d22\uff09\u3001\u3068\u306a\u3063\u3066\u304a\u308a\u3001\u300crows\u300d\u304c\u540c\u3058\u300c10\u300d\u3067\u3082\u9055\u3046\u5224\u65ad\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\nSELECT\u6587\u306e\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u30c8\u30ec\u30fc\u30b9\u306e\u60c5\u5831\u3092\u898b\u3066\u307f\u307e\u3059\u3002\nmysql> SELECT * FROM test_data WHERE flag = 0;\n+-------+--------------+------+\n| id    | name         | flag |\n+-------+--------------+------+\n|  9991 | shouhin09991 |    0 |\n|  9992 | shouhin09992 |    0 |\n|  9993 | shouhin09993 |    0 |\n|  9994 | shouhin09994 |    0 |\n|  9995 | shouhin09995 |    0 |\n|  9996 | shouhin09996 |    0 |\n|  9997 | shouhin09997 |    0 |\n|  9998 | shouhin09998 |    0 |\n|  9999 | shouhin09999 |    0 |\n| 10000 | shouhin10000 |    0 |\n+-------+--------------+------+\n10 rows in set (0.00 sec)\n\nmysql> SELECT * FROM information_schema.optimizer_trace\\G\n*************************** 1. row ***************************\n                            QUERY: SELECT * FROM test_data WHERE flag = 0\n                            TRACE: {\n  \"steps\": [\n    {\n      \"join_preparation\": {\n        \"select#\": 1,\n        \"steps\": [\n          {\n            \"expanded_query\": \"/* select#1 */ select `test_data`.`id` AS `id`,`test_data`.`name` AS `name`,`test_data`.`flag` AS `flag` from `test_data` where (`test_data`.`flag` = 0)\"\n          }\n        ]\n      }\n    },\n    {\n      \"join_optimization\": {\n        \"select#\": 1,\n        \"steps\": [\n          {\n            \"condition_processing\": {\n              \"condition\": \"WHERE\",\n              \"original_condition\": \"(`test_data`.`flag` = 0)\",\n              \"steps\": [\n                {\n                  \"transformation\": \"equality_propagation\",\n                  \"resulting_condition\": \"multiple equal(0, `test_data`.`flag`)\"\n                },\n                {\n                  \"transformation\": \"constant_propagation\",\n                  \"resulting_condition\": \"multiple equal(0, `test_data`.`flag`)\"\n                },\n                {\n                  \"transformation\": \"trivial_condition_removal\",\n                  \"resulting_condition\": \"multiple equal(0, `test_data`.`flag`)\"\n                }\n              ]\n            }\n          },\n          {\n            \"substitute_generated_columns\": {\n            }\n          },\n          {\n            \"table_dependencies\": [\n              {\n                \"table\": \"`test_data`\",\n                \"row_may_be_null\": false,\n                \"map_bit\": 0,\n                \"depends_on_map_bits\": [\n                ]\n              }\n            ]\n          },\n          {\n            \"ref_optimizer_key_uses\": [\n              {\n                \"table\": \"`test_data`\",\n                \"field\": \"flag\",\n                \"equals\": \"0\",\n                \"null_rejecting\": false\n              }\n            ]\n          },\n          {\n            \"rows_estimation\": [\n              {\n                \"table\": \"`test_data`\",\n                \"range_analysis\": {\n                  \"table_scan\": {\n                    \"rows\": 10207,\n                    \"cost\": 2074.5\n                  },\n                  \"potential_range_indexes\": [\n                    {\n                      \"index\": \"PRIMARY\",\n                      \"usable\": false,\n                      \"cause\": \"not_applicable\"\n                    },\n                    {\n                      \"index\": \"idx_flag\",\n                      \"usable\": true,\n                      \"key_parts\": [\n                        \"flag\",\n                        \"id\"\n                      ]\n                    }\n                  ],\n                  \"setup_range_conditions\": [\n                  ],\n                  \"group_index_range\": {\n                    \"chosen\": false,\n                    \"cause\": \"not_group_by_or_distinct\"\n                  },\n                  \"analyzing_range_alternatives\": {\n                    \"range_scan_alternatives\": [\n                      {\n                        \"index\": \"idx_flag\",\n                        \"ranges\": [\n                          \"0 <= flag <= 0\"\n                        ],\n                        \"index_dives_for_eq_ranges\": true,\n                        \"rowid_ordered\": true,\n                        \"using_mrr\": false,\n                        \"index_only\": false,\n                        \"rows\": 10,\n                        \"cost\": 13.01,\n                        \"chosen\": true\n                      }\n                    ],\n                    \"analyzing_roworder_intersect\": {\n                      \"usable\": false,\n                      \"cause\": \"too_few_roworder_scans\"\n                    }\n                  },\n                  \"chosen_range_access_summary\": {\n                    \"range_access_plan\": {\n                      \"type\": \"range_scan\",\n                      \"index\": \"idx_flag\",\n                      \"rows\": 10,\n                      \"ranges\": [\n                        \"0 <= flag <= 0\"\n                      ]\n                    },\n                    \"rows_for_plan\": 10,\n                    \"cost_for_plan\": 13.01,\n                    \"chosen\": true\n                  }\n                }\n              }\n            ]\n          },\n          {\n            \"considered_execution_plans\": [\n              {\n                \"plan_prefix\": [\n                ],\n                \"table\": \"`test_data`\",\n                \"best_access_path\": {\n                  \"considered_access_paths\": [\n                    {\n                      \"access_type\": \"ref\",\n                      \"index\": \"idx_flag\",\n                      \"rows\": 10,\n                      \"cost\": 12,\n                      \"chosen\": true\n                    },\n                    {\n                      \"access_type\": \"range\",\n                      \"range_details\": {\n                        \"used_index\": \"idx_flag\"\n                      },\n                      \"chosen\": false,\n                      \"cause\": \"heuristic_index_cheaper\"\n                    }\n                  ]\n                },\n                \"condition_filtering_pct\": 100,\n                \"rows_for_plan\": 10,\n                \"cost_for_plan\": 12,\n                \"chosen\": true\n              }\n            ]\n          },\n          {\n            \"attaching_conditions_to_tables\": {\n              \"original_condition\": \"(`test_data`.`flag` = 0)\",\n              \"attached_conditions_computation\": [\n              ],\n              \"attached_conditions_summary\": [\n                {\n                  \"table\": \"`test_data`\",\n                  \"attached\": null\n                }\n              ]\n            }\n          },\n          {\n            \"refine_plan\": [\n              {\n                \"table\": \"`test_data`\"\n              }\n            ]\n          }\n        ]\n      }\n    },\n    {\n      \"join_execution\": {\n        \"select#\": 1,\n        \"steps\": [\n        ]\n      }\n    }\n  ]\n}\nMISSING_BYTES_BEYOND_MAX_MEM_SIZE: 0\n          INSUFFICIENT_PRIVILEGES: 0\n1 row in set (0.00 sec)\n\n\u2026\u9577\u3044\u3067\u3059\uff08\u7b11\uff09\u3002\n            \"rows_estimation\": [\n              {\n                \"table\": \"`test_data`\",\n                \"range_analysis\": {\n                  \"table_scan\": {\n                    \"rows\": 10207,\n                    \"cost\": 2074.5\n                  },\n                  \"potential_range_indexes\": [\n                    {\n                      \"index\": \"PRIMARY\",\n                      \"usable\": false,\n                      \"cause\": \"not_applicable\"\n                    },\n                    {\n                      \"index\": \"idx_flag\",\n                      \"usable\": true,\n                      \"key_parts\": [\n                        \"flag\",\n                        \"id\"\n                      ]\n                    }\n                  ],\n\n\u306e\u3068\u3053\u308d\u3067\u3001\n\u30fb\u30c6\u30fc\u30d6\u30eb\u30b9\u30ad\u30e3\u30f3\u306e\u5834\u5408\u306e\u884c\u6570\u304c\u300c10207\u300d\u3001\u30b3\u30b9\u30c8\u304c\u300c2074.5\u300d\u3068\u63a8\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\n\u30fb\u300crange\u300d\u691c\u7d22\u306b\u304a\u3044\u3066\u3001\u4e3b\u30ad\u30fc\u306eINDEX\u306e\u4f7f\u7528\u304c\u300cnot_applicable\u300d\uff08\u3053\u308c\u3092\u4f7f\u3046\u306e\u306f\u4e0d\u9069\u5f53\uff1f\uff09\u3068\u5224\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\n\u30fb\u4e00\u65b9\u3001\u30bb\u30ab\u30f3\u30c0\u30eaINDEX\u300cidx_flag\u300d\u306b\u3064\u3044\u3066\u306f\u300c\u4f7f\u3048\u308b\u306e\u3067\u306f\uff1f\u300d\u3068\u63a8\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\n\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n                  \"analyzing_range_alternatives\": {\n                    \"range_scan_alternatives\": [\n                      {\n                        \"index\": \"idx_flag\",\n                        \"ranges\": [\n                          \"0 <= flag <= 0\"\n                        ],\n                        \"index_dives_for_eq_ranges\": true,\n                        \"rowid_ordered\": true,\n                        \"using_mrr\": false,\n                        \"index_only\": false,\n                        \"rows\": 10,\n                        \"cost\": 13.01,\n                        \"chosen\": true\n                      }\n                    ],\n                    \"analyzing_roworder_intersect\": {\n                      \"usable\": false,\n                      \"cause\": \"too_few_roworder_scans\"\n                    }\n                  },\n                  \"chosen_range_access_summary\": {\n                    \"range_access_plan\": {\n                      \"type\": \"range_scan\",\n                      \"index\": \"idx_flag\",\n                      \"rows\": 10,\n                      \"ranges\": [\n                        \"0 <= flag <= 0\"\n                      ]\n                    },\n                    \"rows_for_plan\": 10,\n                    \"cost_for_plan\": 13.01,\n                    \"chosen\": true\n                  }\n\n\u306e\u3068\u3053\u308d\u3067\u306f\u3001\u300cWHERE 0 <= flag AND flag <= 0\u300d\u3068\u8aad\u307f\u66ff\u3048\u305f\u5f62\u306erange\u691c\u7d22\u306e\u884c\u6570\u304c\u300c10\u300d\u3001\u30b3\u30b9\u30c8\u304c\u300c13.01\u300d\u3068\u63a8\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n            \"considered_execution_plans\": [\n              {\n                \"plan_prefix\": [\n                ],\n                \"table\": \"`test_data`\",\n                \"best_access_path\": {\n                  \"considered_access_paths\": [\n                    {\n                      \"access_type\": \"ref\",\n                      \"index\": \"idx_flag\",\n                      \"rows\": 10,\n                      \"cost\": 12,\n                      \"chosen\": true\n                    },\n                    {\n                      \"access_type\": \"range\",\n                      \"range_details\": {\n                        \"used_index\": \"idx_flag\"\n                      },\n                      \"chosen\": false,\n                      \"cause\": \"heuristic_index_cheaper\"\n                    }\n                  ]\n                },\n\n\u306e\u3068\u3053\u308d\u3067\u3001\u6700\u9069\u306a\u30a2\u30af\u30bb\u30b9\u7d4c\u8def\u304c\u300cidx_flag\u300d\u3092\u300cref\u300d\uff08\u7b49\u4fa1\uff09\u691c\u7d22\u3057\u305f\u5834\u5408\u306e\u3001\u884c\u6570\u300c10\u300d\u3001\u30b3\u30b9\u30c8\u300c12\u300d\u3067\u3042\u308a\u3001\u300c\"chosen\": true\u300d\u304b\u3089\u3001\u3053\u308c\u304c\u9078\u629e\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\uff08range\u306e\u3068\u3053\u308d\u306b\u3082\u300c\"chosen\": true\u300d\u304c\u3042\u308b\u306e\u3067\u3061\u3087\u3063\u3068\u898b\u5206\u3051\u304c\u3064\u304d\u306b\u304f\u3044\u306e\u3067\u3059\u304c\uff09\u3002\n\u3067\u306f\u3001\u7d9a\u3044\u3066UPDATE\u6587\u3067\u3059\u3002\nmysql> UPDATE test_data SET flag = 1 WHERE flag = 0;\nQuery OK, 10 rows affected (0.00 sec)\nRows matched: 10  Changed: 10  Warnings: 0\n\nmysql> SELECT * FROM information_schema.optimizer_trace\\G\n*************************** 1. row ***************************\n                            QUERY: UPDATE test_data SET flag = 1 WHERE flag = 0\n                            TRACE: {\n  \"steps\": [\n    {\n      \"substitute_generated_columns\": {\n      }\n    },\n    {\n      \"condition_processing\": {\n        \"condition\": \"WHERE\",\n        \"original_condition\": \"(`test_data`.`flag` = 0)\",\n        \"steps\": [\n          {\n            \"transformation\": \"equality_propagation\",\n            \"resulting_condition\": \"multiple equal(0, `test_data`.`flag`)\"\n          },\n          {\n            \"transformation\": \"constant_propagation\",\n            \"resulting_condition\": \"multiple equal(0, `test_data`.`flag`)\"\n          },\n          {\n            \"transformation\": \"trivial_condition_removal\",\n            \"resulting_condition\": \"multiple equal(0, `test_data`.`flag`)\"\n          }\n        ]\n      }\n    },\n    {\n      \"table\": \"`test_data`\",\n      \"range_analysis\": {\n        \"table_scan\": {\n          \"rows\": 10207,\n          \"cost\": 2074.5\n        },\n        \"potential_range_indexes\": [\n          {\n            \"index\": \"PRIMARY\",\n            \"usable\": true,\n            \"key_parts\": [\n              \"id\"\n            ]\n          },\n          {\n            \"index\": \"idx_flag\",\n            \"usable\": true,\n            \"key_parts\": [\n              \"flag\",\n              \"id\"\n            ]\n          }\n        ],\n        \"setup_range_conditions\": [\n        ],\n        \"group_index_range\": {\n          \"chosen\": false,\n          \"cause\": \"no_join\"\n        },\n        \"analyzing_range_alternatives\": {\n          \"range_scan_alternatives\": [\n            {\n              \"index\": \"idx_flag\",\n              \"ranges\": [\n                \"0 <= flag <= 0\"\n              ],\n              \"index_dives_for_eq_ranges\": true,\n              \"rowid_ordered\": true,\n              \"using_mrr\": false,\n              \"index_only\": false,\n              \"rows\": 10,\n              \"cost\": 13.01,\n              \"chosen\": true\n            }\n          ],\n          \"analyzing_roworder_intersect\": {\n            \"usable\": false,\n            \"cause\": \"too_few_roworder_scans\"\n          }\n        },\n        \"chosen_range_access_summary\": {\n          \"range_access_plan\": {\n            \"type\": \"range_scan\",\n            \"index\": \"idx_flag\",\n            \"rows\": 10,\n            \"ranges\": [\n              \"0 <= flag <= 0\"\n            ]\n          },\n          \"rows_for_plan\": 10,\n          \"cost_for_plan\": 13.01,\n          \"chosen\": true\n        }\n      }\n    }\n  ]\n}\nMISSING_BYTES_BEYOND_MAX_MEM_SIZE: 0\n          INSUFFICIENT_PRIVILEGES: 0\n1 row in set (0.00 sec)\n\n\u76f8\u5909\u308f\u3089\u305a\u9577\u3044\u306e\u3067\u3059\u304c\u3001SELECT\u6587\u306e\u3068\u304d\u3088\u308a\u3001\u3061\u3087\u3063\u3068\u77ed\u3044\u3067\u3059\u306d\u3002\n\u30fb\u300crange\u300d\u691c\u7d22\u306b\u4e3b\u30ad\u30fc\u306eINDEX\u3082\uff08\u300cidx_flag\u300d\u3068\u540c\u69d8\u306b\uff09\u300c\u4f7f\u3048\u308b\uff1f\u300d\u3068\u63a8\u5b9a\u3055\u308c\u3066\u3044\u308b\n\u30fb\u300cref\u300d\u306b\u3064\u3044\u3066\u306e\u60c5\u5831\u304c\u51fa\u3066\u304d\u3066\u3044\u306a\u3044\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u6700\u7d42\u7684\u306b\u300crange\u300d\uff08\u7bc4\u56f2\uff09\u691c\u7d22\u6271\u3044\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\u3055\u3066\u3001\u305d\u308d\u305d\u308d\u8f9b\u304f\u306a\u3063\u3066\u304d\u305f\u3068\u601d\u3044\u307e\u3059\u304c\uff08\u7b11\uff09\u3001\u300c10,000\u4ef6\u304b\u30899,990\u4ef6\u3092\u62bd\u51fa\u3059\u308b\u300d\u307b\u3046\uff08\u300cWHERE flag = 1\u300d\uff09\u3067\u3059\u3002\nmysql> EXPLAIN SELECT * FROM test_data WHERE flag = 1;\n+----+-------------+-----------+------------+------+---------------+----------+---------+-------+------+----------+-------+\n| id | select_type | table     | partitions | type | possible_keys | key      | key_len | ref   | rows | filtered | Extra |\n+----+-------------+-----------+------------+------+---------------+----------+---------+-------+------+----------+-------+\n|  1 | SIMPLE      | test_data | NULL       | ref  | idx_flag      | idx_flag | 4       | const | 5103 |   100.00 | NULL  |\n+----+-------------+-----------+------------+------+---------------+----------+---------+-------+------+----------+-------+\n1 row in set, 1 warning (0.00 sec)\n\nmysql> EXPLAIN UPDATE test_data SET flag = 0 WHERE flag = 1;\n+----+-------------+-----------+------------+-------+---------------+---------+---------+------+-------+----------+------------------------------+\n| id | select_type | table     | partitions | type  | possible_keys | key     | key_len | ref  | rows  | filtered | Extra                        |\n+----+-------------+-----------+------------+-------+---------------+---------+---------+------+-------+----------+------------------------------+\n|  1 | UPDATE      | test_data | NULL       | index | idx_flag      | PRIMARY | 8       | NULL | 10207 |   100.00 | Using where; Using temporary |\n+----+-------------+-----------+------------+-------+---------------+---------+---------+------+-------+----------+------------------------------+\n1 row in set (0.00 sec)\n\n\u300cref\u300d\uff0810\u4ef6\u62bd\u51fa\u306e\u3068\u304d\u3068\u540c\u3058\uff09\u3068\u300cindex\u300d\u306b\u7d50\u679c\u304c\u5206\u304b\u308c\u3066\u3044\u307e\u3059\u3002\nSELECT\u6587\u3067\u306f\u3001\nmysql> SELECT * FROM test_data WHERE flag = 1;\n+------+--------------+------+\n| id   | name         | flag |\n+------+--------------+------+\n|    1 | shouhin00001 |    1 |\n|    2 | shouhin00002 |    1 |\n|    3 | shouhin00003 |    1 |\n|    4 | shouhin00004 |    1 |\n|    5 | shouhin00005 |    1 |\n\uff08\u4e2d\u7565\uff09\n| 9986 | shouhin09986 |    1 |\n| 9987 | shouhin09987 |    1 |\n| 9988 | shouhin09988 |    1 |\n| 9989 | shouhin09989 |    1 |\n| 9990 | shouhin09990 |    1 |\n+------+--------------+------+\n9990 rows in set (0.01 sec)\n\nmysql> SELECT * FROM information_schema.optimizer_trace\\G\n*************************** 1. row ***************************\n                            QUERY: SELECT * FROM test_data WHERE flag = 1\n                            TRACE: {\n  \"steps\": [\n    {\n      \"join_preparation\": {\n        \"select#\": 1,\n        \"steps\": [\n          {\n            \"expanded_query\": \"/* select#1 */ select `test_data`.`id` AS `id`,`test_data`.`name` AS `name`,`test_data`.`flag` AS `flag` from `test_data` where (`test_data`.`flag` = 1)\"\n          }\n        ]\n      }\n    },\n    {\n      \"join_optimization\": {\n        \"select#\": 1,\n        \"steps\": [\n          {\n            \"condition_processing\": {\n              \"condition\": \"WHERE\",\n              \"original_condition\": \"(`test_data`.`flag` = 1)\",\n              \"steps\": [\n                {\n                  \"transformation\": \"equality_propagation\",\n                  \"resulting_condition\": \"multiple equal(1, `test_data`.`flag`)\"\n                },\n                {\n                  \"transformation\": \"constant_propagation\",\n                  \"resulting_condition\": \"multiple equal(1, `test_data`.`flag`)\"\n                },\n                {\n                  \"transformation\": \"trivial_condition_removal\",\n                  \"resulting_condition\": \"multiple equal(1, `test_data`.`flag`)\"\n                }\n              ]\n            }\n          },\n          {\n            \"substitute_generated_columns\": {\n            }\n          },\n          {\n            \"table_dependencies\": [\n              {\n                \"table\": \"`test_data`\",\n                \"row_may_be_null\": false,\n                \"map_bit\": 0,\n                \"depends_on_map_bits\": [\n                ]\n              }\n            ]\n          },\n          {\n            \"ref_optimizer_key_uses\": [\n              {\n                \"table\": \"`test_data`\",\n                \"field\": \"flag\",\n                \"equals\": \"1\",\n                \"null_rejecting\": false\n              }\n            ]\n          },\n          {\n            \"rows_estimation\": [\n              {\n                \"table\": \"`test_data`\",\n                \"range_analysis\": {\n                  \"table_scan\": {\n                    \"rows\": 10207,\n                    \"cost\": 2074.5\n                  },\n                  \"potential_range_indexes\": [\n                    {\n                      \"index\": \"PRIMARY\",\n                      \"usable\": false,\n                      \"cause\": \"not_applicable\"\n                    },\n                    {\n                      \"index\": \"idx_flag\",\n                      \"usable\": true,\n                      \"key_parts\": [\n                        \"flag\",\n                        \"id\"\n                      ]\n                    }\n                  ],\n                  \"setup_range_conditions\": [\n                  ],\n                  \"group_index_range\": {\n                    \"chosen\": false,\n                    \"cause\": \"not_group_by_or_distinct\"\n                  },\n                  \"analyzing_range_alternatives\": {\n                    \"range_scan_alternatives\": [\n                      {\n                        \"index\": \"idx_flag\",\n                        \"ranges\": [\n                          \"1 <= flag <= 1\"\n                        ],\n                        \"index_dives_for_eq_ranges\": true,\n                        \"rowid_ordered\": true,\n                        \"using_mrr\": false,\n                        \"index_only\": false,\n                        \"rows\": 5103,\n                        \"cost\": 6124.6,\n                        \"chosen\": false,\n                        \"cause\": \"cost\"\n                      }\n                    ],\n                    \"analyzing_roworder_intersect\": {\n                      \"usable\": false,\n                      \"cause\": \"too_few_roworder_scans\"\n                    }\n                  }\n                }\n              }\n            ]\n          },\n          {\n            \"considered_execution_plans\": [\n              {\n                \"plan_prefix\": [\n                ],\n                \"table\": \"`test_data`\",\n                \"best_access_path\": {\n                  \"considered_access_paths\": [\n                    {\n                      \"access_type\": \"ref\",\n                      \"index\": \"idx_flag\",\n                      \"rows\": 5103,\n                      \"cost\": 1113.6,\n                      \"chosen\": true\n                    },\n                    {\n                      \"rows_to_scan\": 10207,\n                      \"access_type\": \"scan\",\n                      \"resulting_rows\": 10207,\n                      \"cost\": 2072.4,\n                      \"chosen\": false\n                    }\n                  ]\n                },\n                \"condition_filtering_pct\": 100,\n                \"rows_for_plan\": 5103,\n                \"cost_for_plan\": 1113.6,\n                \"chosen\": true\n              }\n            ]\n          },\n          {\n            \"attaching_conditions_to_tables\": {\n              \"original_condition\": \"(`test_data`.`flag` = 1)\",\n              \"attached_conditions_computation\": [\n              ],\n              \"attached_conditions_summary\": [\n                {\n                  \"table\": \"`test_data`\",\n                  \"attached\": null\n                }\n              ]\n            }\n          },\n          {\n            \"refine_plan\": [\n              {\n                \"table\": \"`test_data`\"\n              }\n            ]\n          }\n        ]\n      }\n    },\n    {\n      \"join_execution\": {\n        \"select#\": 1,\n        \"steps\": [\n        ]\n      }\n    }\n  ]\n}\nMISSING_BYTES_BEYOND_MAX_MEM_SIZE: 0\n          INSUFFICIENT_PRIVILEGES: 0\n1 row in set (0.00 sec)\n\n\u300cref\u300d\u3068\u300crange\u300d\u3067\u63a8\u5b9a\u3055\u308c\u3066\u3044\u308b\u884c\u6570\u306f\u540c\u3058\u300c5103\u300d\uff08\u304a\u305d\u3089\u304fINDEX\u306e\u8d70\u67fb\u3092\u3042\u304d\u3089\u3081\u3066\u3001\u7d71\u8a08\u60c5\u5831\u304b\u3089\u62fe\u3063\u3066\u304d\u305f\u6570\u5b57\u3067\u3057\u3087\u3046\uff09\u3067\u3059\u304c\u3001\u63a8\u5b9a\u30b3\u30b9\u30c8\u304c\u300c1113.6\u300d\u3068\u300c6124.6\u300d\u3067\u3001\u304b\u306a\u308a\u5dee\u304c\u3042\u308a\u307e\u3059\u3002\n\u300cref\u300d\u306e\u300c1113.6\u300d\u3068\u3044\u3046\u6570\u5b57\u306f\u3001\u30c6\u30fc\u30d6\u30eb\u30b9\u30ad\u30e3\u30f3\u6642\u306e\u300c2072.4\u300d\u3088\u308a\u5c0f\u3055\u3044\u305f\u3081\u3001\u6700\u7d42\u7684\u306b\u300cref\u300d\u304c\u9078\u3070\u308c\u305f\u3088\u3046\u3067\u3059\uff08\u63a8\u5b9a\u3055\u308c\u305f\u300c5103\u300d\u3068\u3044\u3046\u884c\u6570\u304c\u304b\u306a\u308a\u5b9f\u614b\u3068\u304b\u3051\u96e2\u308c\u3066\u3044\u308b\u305f\u3081\u306b\u3001\u7d50\u679c\u3068\u3057\u3066\u9078\u629e\u30df\u30b9\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u307e\u3059\u304c\uff09\u3002\n\u6b21\u306fUPDATE\u6587\u3001\u3088\u3046\u3084\u304f\u6700\u5f8c\u3067\u3059\u3002\nmysql> UPDATE test_data SET flag = 0 WHERE flag = 1;\nQuery OK, 9990 rows affected (0.23 sec)\nRows matched: 9990  Changed: 9990  Warnings: 0\n\nmysql> UPDATE test_data SET flag = 0 WHERE flag = 1;\nQuery OK, 9990 rows affected (0.23 sec)\nRows matched: 9990  Changed: 9990  Warnings: 0\n\nmysql> SELECT * FROM information_schema.optimizer_trace\\G\n*************************** 1. row ***************************\n                            QUERY: UPDATE test_data SET flag = 0 WHERE flag = 1\n                            TRACE: {\n  \"steps\": [\n    {\n      \"substitute_generated_columns\": {\n      }\n    },\n    {\n      \"condition_processing\": {\n        \"condition\": \"WHERE\",\n        \"original_condition\": \"(`test_data`.`flag` = 1)\",\n        \"steps\": [\n          {\n            \"transformation\": \"equality_propagation\",\n            \"resulting_condition\": \"multiple equal(1, `test_data`.`flag`)\"\n          },\n          {\n            \"transformation\": \"constant_propagation\",\n            \"resulting_condition\": \"multiple equal(1, `test_data`.`flag`)\"\n          },\n          {\n            \"transformation\": \"trivial_condition_removal\",\n            \"resulting_condition\": \"multiple equal(1, `test_data`.`flag`)\"\n          }\n        ]\n      }\n    },\n    {\n      \"table\": \"`test_data`\",\n      \"range_analysis\": {\n        \"table_scan\": {\n          \"rows\": 10207,\n          \"cost\": 2074.5\n        },\n        \"potential_range_indexes\": [\n          {\n            \"index\": \"PRIMARY\",\n            \"usable\": true,\n            \"key_parts\": [\n              \"id\"\n            ]\n          },\n          {\n            \"index\": \"idx_flag\",\n            \"usable\": true,\n            \"key_parts\": [\n              \"flag\",\n              \"id\"\n            ]\n          }\n        ],\n        \"setup_range_conditions\": [\n        ],\n        \"group_index_range\": {\n          \"chosen\": false,\n          \"cause\": \"no_join\"\n        },\n        \"analyzing_range_alternatives\": {\n          \"range_scan_alternatives\": [\n            {\n              \"index\": \"idx_flag\",\n              \"ranges\": [\n                \"1 <= flag <= 1\"\n              ],\n              \"index_dives_for_eq_ranges\": true,\n              \"rowid_ordered\": true,\n              \"using_mrr\": false,\n              \"index_only\": false,\n              \"rows\": 5103,\n              \"cost\": 6124.6,\n              \"chosen\": false,\n              \"cause\": \"cost\"\n            }\n          ],\n          \"analyzing_roworder_intersect\": {\n            \"usable\": false,\n            \"cause\": \"too_few_roworder_scans\"\n          }\n        }\n      }\n    }\n  ]\n}\nMISSING_BYTES_BEYOND_MAX_MEM_SIZE: 0\n          INSUFFICIENT_PRIVILEGES: 0\n1 row in set (0.00 sec)\n\nUPDATE\u6587\u306710\u4ef6\u62bd\u51fa\u306e\u3068\u304d\u3068\u540c\u69d8\u3001\u300cref\u300d\u306b\u3064\u3044\u3066\u691c\u8a0e\u3057\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\u7d50\u679c\u3001\u300crange\u300d\u3088\u308a\u3082\u300cindex\u300d\uff08INDEX\u30d5\u30eb\u30b9\u30ad\u30e3\u30f3\uff09\u306e\u307b\u3046\u304c\u30b3\u30b9\u30c8\u304c\u4f4e\u3044\u3068\u63a8\u5b9a\u3055\u308c\u3001\u9078\u629e\u3055\u308c\u305f\u306e\u3067\u306f\u306a\u3044\u3067\u3057\u3087\u3046\u304b\uff1f\nUPDATE\u6587\u306e\u5834\u5408\u306fSELECT\u3068\u6bd4\u3079\u3066\u7d30\u304b\u3044\u60c5\u5831\u304c\u51fa\u3066\u3044\u306a\u3044\u3088\u3046\u306a\u306e\u3067\u3001\u3082\u3057\u304b\u3057\u305f\u3089\u9593\u9055\u3063\u3066\u3044\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3002\n\n\u6700\u5f8c\u306b\n\u6f22\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u9053\u3067\u304a\u306a\u3058\u307f\u3001\u5965\u91ce\u5e79\u4e5f\u3055\u3093\u306e\u8457\u66f8\u300e\u8a73\u89e3MySQL5.7 \u6b62\u307e\u3089\u306c\u9032\u5316\u306b\u4e57\u308a\u9045\u308c\u306a\u3044\u305f\u3081\u306e\u30c6\u30af\u30cb\u30ab\u30eb\u30ac\u30a4\u30c9\u300f\u304c\u767a\u58f2\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u30c8\u30ec\u30fc\u30b9\u306b\u3064\u3044\u3066\u3082\u3001JOIN\u306e\u5834\u5408\u3092\u4f8b\u306b\u3001\u3082\u3063\u3068\u8a73\u3057\u3044\u89e3\u8aac\u304c\u8f09\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u8208\u5473\u304c\u3042\u308b\u65b9\u306f\u662f\u975e\u8aad\u3093\u3067\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\u3068\u3044\u3063\u3066\u3082\u3001\u79c1\u306f\u7fd4\u6cf3\u793e\u30fbOracle\u30fb\u5965\u91ce\u3055\u3093\u3068\u306f\u4f55\u306e\u95a2\u4fc2\u3082\u3042\u308a\u307e\u305b\u3093\u304c\u3002\n\u3042\u3001\u305d\u3046\u3044\u3048\u3070\u3001\u5965\u91ce\u3055\u3093\u306b\u306f\u3001\u4ee5\u524d\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u30ab\u30f3\u30d5\u30a1\u30ec\u30f3\u30b9\u306e\u30d6\u30fc\u30b9\u3067\u304a\u4f1a\u3044\u3057\u305f\u3068\u304d\u306b\u3001\u30b5\u30fc\u30d3\u30b9\u7cbe\u795e\u65fa\u76db\u306a\u611f\u3058\u3067\u3001\u8272\u3005\u304a\u8a71\u3092\u3057\u3066\u3044\u305f\u3060\u3044\u305f\u3053\u3068\u306f\u3042\u308a\u307e\u3057\u305f\u3002\n[MySQL(InnoDB)\u3067\u30ab\u30fc\u30c7\u30a3\u30ca\u30ea\u30c6\u30a3\u306e\u4f4e\u3044\u30ab\u30e9\u30e0\u306bINDEX\u3092\u5f35\u308b](http://qiita.com/hmatsu47/items/2d44c173a9114fd06853)\u306e\u300c\u304a\u307e\u3051\u300d\u306e\u7d9a\u304d\u3067\u3059\u3002\n\u540c\u3058WHERE\u53e5\u3092\u6307\u5b9a\u3057\u305f\u306e\u306b\u3001UPDATE\u6587\u3068SELECT\u6587\u306e\u9593\u3067\u7d50\u679c\u304c\u5206\u304b\u308c\u307e\u3057\u305f\u3002\n\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u30c8\u30ec\u30fc\u30b9\u3092\u4f7f\u3063\u3066\u3001\u3082\u3046\u5c11\u3057\u8a73\u3057\u304f\u8abf\u3079\u3066\u307f\u307e\u3059\u3002\n\n# \u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u30c8\u30ec\u30fc\u30b9\u3068\u306f\nMySQL 5.6\u304b\u3089\u5b9f\u88c5\u3055\u308c\u305f\u3001\u300c\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u304c\u5b9f\u884c\u8a08\u753b\u3092\u9078\u629e\u3059\u308b\u904e\u7a0b\u3092\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u6a5f\u80fd\u300d\u3067\u3059\u3002\nEXPLAIN\u3067\u306f\u3001\u6700\u7d42\u7684\u306b\u9078\u629e\u3055\u308c\u308b\u5b9f\u884c\u8a08\u753b\u306e\u307f\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u304c\u3001\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u30c8\u30ec\u30fc\u30b9\u3067\u306f\u3001\u6bd4\u8f03\u691c\u8a0e\u3055\u308c\u305f\u5b9f\u884c\u8a08\u753b\u306e\u60c5\u5831\u306a\u3069\u3082\u542b\u3081\u3066\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n# \u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u30c8\u30ec\u30fc\u30b9\u3092\u4f7f\u3046\u306b\u306f\n\u4ee5\u4e0b\u306e\u5909\u6570\u3092\u8a2d\u5b9a\u3059\u308b\u3060\u3051\u3067\u3001\u63a5\u7d9a\u4e2d\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u3067\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u30c8\u30ec\u30fc\u30b9\u304c\u6709\u52b9\u306b\u306a\u308a\u307e\u3059\u3002\n\n```mysql:\nmysql> SET optimizer_trace='enabled=on';\nQuery OK, 0 rows affected (0.00 sec)\n```\n\n\u6709\u52b9\u306a\u72b6\u614b\u3067SQL\u3092\u5b9f\u884c\u3057\u3001\u305d\u308c\u306b\u7d9a\u3044\u3066\n\n```mysql:\nmysql> SELECT * FROM information_schema.optimizer_trace\\G\n```\n\n\u3068\u3059\u308b\u3053\u3068\u3067\u3001\u5b9f\u884c\u8a08\u753b\u306e\u60c5\u5831\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n\u7d42\u308f\u3063\u305f\u3089\u3001\n\n```mysql:\nmysql> SET optimizer_trace='enabled=off';\n```\n\n\u3067\u7121\u52b9\u306b\u3057\u307e\u3059\u3002\n\n# \u4f7f\u3063\u3066\u307f\u307e\u3057\u3087\u3046\n[MySQL(InnoDB)\u3067\u30ab\u30fc\u30c7\u30a3\u30ca\u30ea\u30c6\u30a3\u306e\u4f4e\u3044\u30ab\u30e9\u30e0\u306bINDEX\u3092\u5f35\u308b](http://qiita.com/hmatsu47/items/2d44c173a9114fd06853)\u306e\u3068\u304d\u306e\u30c6\u30fc\u30d6\u30eb\u3067\u3001\u300cWHERE flag = 0\u300d\u3092\u4ed8\u3051\u305fSELECT\u6587\u3068\u3001UPDATE\u6587\u3092\u6bd4\u8f03\u3057\u3066\u307f\u307e\u3059\uff0810,000\u4ef6\u306e\u4e2d\u304b\u308910\u4ef6\u3092\u62bd\u51fa\uff09\u3002\n\n\u307e\u305a\u306fEXPLAIN\u306e\u304a\u3055\u3089\u3044\u3067\u3059\u3002\n\n```mysql:\nmysql> USE cardi_test;\nDatabase changed\nmysql> EXPLAIN SELECT * FROM test_data WHERE flag = 0;\n+----+-------------+-----------+------------+------+---------------+----------+---------+-------+------+----------+-------+\n| id | select_type | table     | partitions | type | possible_keys | key      | key_len | ref   | rows | filtered | Extra |\n+----+-------------+-----------+------------+------+---------------+----------+---------+-------+------+----------+-------+\n|  1 | SIMPLE      | test_data | NULL       | ref  | idx_flag      | idx_flag | 4       | const |   10 |   100.00 | NULL  |\n+----+-------------+-----------+------------+------+---------------+----------+---------+-------+------+----------+-------+\n1 row in set, 1 warning (0.00 sec)\n\nmysql> EXPLAIN UPDATE test_data SET flag = 1 WHERE flag = 0;\n+----+-------------+-----------+------------+-------+---------------+----------+---------+-------+------+----------+------------------------------+\n| id | select_type | table     | partitions | type  | possible_keys | key      | key_len | ref   | rows | filtered | Extra                        |\n+----+-------------+-----------+------------+-------+---------------+----------+---------+-------+------+----------+------------------------------+\n|  1 | UPDATE      | test_data | NULL       | range | idx_flag      | idx_flag | 4       | const |   10 |   100.00 | Using where; Using temporary |\n+----+-------------+-----------+------------+-------+---------------+----------+---------+-------+------+----------+------------------------------+\n1 row in set (0.00 sec)\n```\n\n\u2026\u3042\u3089\u305f\u3081\u3066\u898b\u6bd4\u3079\u3066\u307f\u308b\u3068\u3001\u300ctype\u300d\u304cSELECT\u6587\u306e\u3068\u304d\u300cref\u300d\uff08\u4e3b\u306b\u975e\u30e6\u30cb\u30fc\u30afINDEX\u3067\u7b49\u4fa1\u691c\u7d22\uff09\u3001UPDATE\u6587\u306e\u3068\u304d\u300crange\u300d\uff08\u4e3b\u306b\u7bc4\u56f2\u691c\u7d22\uff09\u3001\u3068\u306a\u3063\u3066\u304a\u308a\u3001\u300crows\u300d\u304c\u540c\u3058\u300c10\u300d\u3067\u3082\u9055\u3046\u5224\u65ad\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\nSELECT\u6587\u306e\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u30c8\u30ec\u30fc\u30b9\u306e\u60c5\u5831\u3092\u898b\u3066\u307f\u307e\u3059\u3002\n\n```mysql:\nmysql> SELECT * FROM test_data WHERE flag = 0;\n+-------+--------------+------+\n| id    | name         | flag |\n+-------+--------------+------+\n|  9991 | shouhin09991 |    0 |\n|  9992 | shouhin09992 |    0 |\n|  9993 | shouhin09993 |    0 |\n|  9994 | shouhin09994 |    0 |\n|  9995 | shouhin09995 |    0 |\n|  9996 | shouhin09996 |    0 |\n|  9997 | shouhin09997 |    0 |\n|  9998 | shouhin09998 |    0 |\n|  9999 | shouhin09999 |    0 |\n| 10000 | shouhin10000 |    0 |\n+-------+--------------+------+\n10 rows in set (0.00 sec)\n\nmysql> SELECT * FROM information_schema.optimizer_trace\\G\n*************************** 1. row ***************************\n                            QUERY: SELECT * FROM test_data WHERE flag = 0\n                            TRACE: {\n  \"steps\": [\n    {\n      \"join_preparation\": {\n        \"select#\": 1,\n        \"steps\": [\n          {\n            \"expanded_query\": \"/* select#1 */ select `test_data`.`id` AS `id`,`test_data`.`name` AS `name`,`test_data`.`flag` AS `flag` from `test_data` where (`test_data`.`flag` = 0)\"\n          }\n        ]\n      }\n    },\n    {\n      \"join_optimization\": {\n        \"select#\": 1,\n        \"steps\": [\n          {\n            \"condition_processing\": {\n              \"condition\": \"WHERE\",\n              \"original_condition\": \"(`test_data`.`flag` = 0)\",\n              \"steps\": [\n                {\n                  \"transformation\": \"equality_propagation\",\n                  \"resulting_condition\": \"multiple equal(0, `test_data`.`flag`)\"\n                },\n                {\n                  \"transformation\": \"constant_propagation\",\n                  \"resulting_condition\": \"multiple equal(0, `test_data`.`flag`)\"\n                },\n                {\n                  \"transformation\": \"trivial_condition_removal\",\n                  \"resulting_condition\": \"multiple equal(0, `test_data`.`flag`)\"\n                }\n              ]\n            }\n          },\n          {\n            \"substitute_generated_columns\": {\n            }\n          },\n          {\n            \"table_dependencies\": [\n              {\n                \"table\": \"`test_data`\",\n                \"row_may_be_null\": false,\n                \"map_bit\": 0,\n                \"depends_on_map_bits\": [\n                ]\n              }\n            ]\n          },\n          {\n            \"ref_optimizer_key_uses\": [\n              {\n                \"table\": \"`test_data`\",\n                \"field\": \"flag\",\n                \"equals\": \"0\",\n                \"null_rejecting\": false\n              }\n            ]\n          },\n          {\n            \"rows_estimation\": [\n              {\n                \"table\": \"`test_data`\",\n                \"range_analysis\": {\n                  \"table_scan\": {\n                    \"rows\": 10207,\n                    \"cost\": 2074.5\n                  },\n                  \"potential_range_indexes\": [\n                    {\n                      \"index\": \"PRIMARY\",\n                      \"usable\": false,\n                      \"cause\": \"not_applicable\"\n                    },\n                    {\n                      \"index\": \"idx_flag\",\n                      \"usable\": true,\n                      \"key_parts\": [\n                        \"flag\",\n                        \"id\"\n                      ]\n                    }\n                  ],\n                  \"setup_range_conditions\": [\n                  ],\n                  \"group_index_range\": {\n                    \"chosen\": false,\n                    \"cause\": \"not_group_by_or_distinct\"\n                  },\n                  \"analyzing_range_alternatives\": {\n                    \"range_scan_alternatives\": [\n                      {\n                        \"index\": \"idx_flag\",\n                        \"ranges\": [\n                          \"0 <= flag <= 0\"\n                        ],\n                        \"index_dives_for_eq_ranges\": true,\n                        \"rowid_ordered\": true,\n                        \"using_mrr\": false,\n                        \"index_only\": false,\n                        \"rows\": 10,\n                        \"cost\": 13.01,\n                        \"chosen\": true\n                      }\n                    ],\n                    \"analyzing_roworder_intersect\": {\n                      \"usable\": false,\n                      \"cause\": \"too_few_roworder_scans\"\n                    }\n                  },\n                  \"chosen_range_access_summary\": {\n                    \"range_access_plan\": {\n                      \"type\": \"range_scan\",\n                      \"index\": \"idx_flag\",\n                      \"rows\": 10,\n                      \"ranges\": [\n                        \"0 <= flag <= 0\"\n                      ]\n                    },\n                    \"rows_for_plan\": 10,\n                    \"cost_for_plan\": 13.01,\n                    \"chosen\": true\n                  }\n                }\n              }\n            ]\n          },\n          {\n            \"considered_execution_plans\": [\n              {\n                \"plan_prefix\": [\n                ],\n                \"table\": \"`test_data`\",\n                \"best_access_path\": {\n                  \"considered_access_paths\": [\n                    {\n                      \"access_type\": \"ref\",\n                      \"index\": \"idx_flag\",\n                      \"rows\": 10,\n                      \"cost\": 12,\n                      \"chosen\": true\n                    },\n                    {\n                      \"access_type\": \"range\",\n                      \"range_details\": {\n                        \"used_index\": \"idx_flag\"\n                      },\n                      \"chosen\": false,\n                      \"cause\": \"heuristic_index_cheaper\"\n                    }\n                  ]\n                },\n                \"condition_filtering_pct\": 100,\n                \"rows_for_plan\": 10,\n                \"cost_for_plan\": 12,\n                \"chosen\": true\n              }\n            ]\n          },\n          {\n            \"attaching_conditions_to_tables\": {\n              \"original_condition\": \"(`test_data`.`flag` = 0)\",\n              \"attached_conditions_computation\": [\n              ],\n              \"attached_conditions_summary\": [\n                {\n                  \"table\": \"`test_data`\",\n                  \"attached\": null\n                }\n              ]\n            }\n          },\n          {\n            \"refine_plan\": [\n              {\n                \"table\": \"`test_data`\"\n              }\n            ]\n          }\n        ]\n      }\n    },\n    {\n      \"join_execution\": {\n        \"select#\": 1,\n        \"steps\": [\n        ]\n      }\n    }\n  ]\n}\nMISSING_BYTES_BEYOND_MAX_MEM_SIZE: 0\n          INSUFFICIENT_PRIVILEGES: 0\n1 row in set (0.00 sec)\n```\n\n\u2026\u9577\u3044\u3067\u3059\uff08\u7b11\uff09\u3002\n\n```mysql:\n            \"rows_estimation\": [\n              {\n                \"table\": \"`test_data`\",\n                \"range_analysis\": {\n                  \"table_scan\": {\n                    \"rows\": 10207,\n                    \"cost\": 2074.5\n                  },\n                  \"potential_range_indexes\": [\n                    {\n                      \"index\": \"PRIMARY\",\n                      \"usable\": false,\n                      \"cause\": \"not_applicable\"\n                    },\n                    {\n                      \"index\": \"idx_flag\",\n                      \"usable\": true,\n                      \"key_parts\": [\n                        \"flag\",\n                        \"id\"\n                      ]\n                    }\n                  ],\n```\n\n\u306e\u3068\u3053\u308d\u3067\u3001\n\u30fb\u30c6\u30fc\u30d6\u30eb\u30b9\u30ad\u30e3\u30f3\u306e\u5834\u5408\u306e\u884c\u6570\u304c\u300c10207\u300d\u3001\u30b3\u30b9\u30c8\u304c\u300c2074.5\u300d\u3068\u63a8\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\n\u30fb\u300crange\u300d\u691c\u7d22\u306b\u304a\u3044\u3066\u3001\u4e3b\u30ad\u30fc\u306eINDEX\u306e\u4f7f\u7528\u304c\u300cnot_applicable\u300d\uff08\u3053\u308c\u3092\u4f7f\u3046\u306e\u306f\u4e0d\u9069\u5f53\uff1f\uff09\u3068\u5224\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\n\u30fb\u4e00\u65b9\u3001\u30bb\u30ab\u30f3\u30c0\u30eaINDEX\u300cidx_flag\u300d\u306b\u3064\u3044\u3066\u306f\u300c\u4f7f\u3048\u308b\u306e\u3067\u306f\uff1f\u300d\u3068\u63a8\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\n\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n```mysql:\n                  \"analyzing_range_alternatives\": {\n                    \"range_scan_alternatives\": [\n                      {\n                        \"index\": \"idx_flag\",\n                        \"ranges\": [\n                          \"0 <= flag <= 0\"\n                        ],\n                        \"index_dives_for_eq_ranges\": true,\n                        \"rowid_ordered\": true,\n                        \"using_mrr\": false,\n                        \"index_only\": false,\n                        \"rows\": 10,\n                        \"cost\": 13.01,\n                        \"chosen\": true\n                      }\n                    ],\n                    \"analyzing_roworder_intersect\": {\n                      \"usable\": false,\n                      \"cause\": \"too_few_roworder_scans\"\n                    }\n                  },\n                  \"chosen_range_access_summary\": {\n                    \"range_access_plan\": {\n                      \"type\": \"range_scan\",\n                      \"index\": \"idx_flag\",\n                      \"rows\": 10,\n                      \"ranges\": [\n                        \"0 <= flag <= 0\"\n                      ]\n                    },\n                    \"rows_for_plan\": 10,\n                    \"cost_for_plan\": 13.01,\n                    \"chosen\": true\n                  }\n```\n\n\u306e\u3068\u3053\u308d\u3067\u306f\u3001\u300cWHERE 0 <= flag AND flag <= 0\u300d\u3068\u8aad\u307f\u66ff\u3048\u305f\u5f62\u306erange\u691c\u7d22\u306e\u884c\u6570\u304c\u300c10\u300d\u3001\u30b3\u30b9\u30c8\u304c\u300c13.01\u300d\u3068\u63a8\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n```mysql:\n            \"considered_execution_plans\": [\n              {\n                \"plan_prefix\": [\n                ],\n                \"table\": \"`test_data`\",\n                \"best_access_path\": {\n                  \"considered_access_paths\": [\n                    {\n                      \"access_type\": \"ref\",\n                      \"index\": \"idx_flag\",\n                      \"rows\": 10,\n                      \"cost\": 12,\n                      \"chosen\": true\n                    },\n                    {\n                      \"access_type\": \"range\",\n                      \"range_details\": {\n                        \"used_index\": \"idx_flag\"\n                      },\n                      \"chosen\": false,\n                      \"cause\": \"heuristic_index_cheaper\"\n                    }\n                  ]\n                },\n```\n\n\u306e\u3068\u3053\u308d\u3067\u3001\u6700\u9069\u306a\u30a2\u30af\u30bb\u30b9\u7d4c\u8def\u304c\u300cidx_flag\u300d\u3092\u300cref\u300d\uff08\u7b49\u4fa1\uff09\u691c\u7d22\u3057\u305f\u5834\u5408\u306e\u3001\u884c\u6570\u300c10\u300d\u3001\u30b3\u30b9\u30c8\u300c12\u300d\u3067\u3042\u308a\u3001\u300c\"chosen\": true\u300d\u304b\u3089\u3001\u3053\u308c\u304c\u9078\u629e\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\uff08range\u306e\u3068\u3053\u308d\u306b\u3082\u300c\"chosen\": true\u300d\u304c\u3042\u308b\u306e\u3067\u3061\u3087\u3063\u3068\u898b\u5206\u3051\u304c\u3064\u304d\u306b\u304f\u3044\u306e\u3067\u3059\u304c\uff09\u3002\n\n\u3067\u306f\u3001\u7d9a\u3044\u3066UPDATE\u6587\u3067\u3059\u3002\n\n```mysql:\nmysql> UPDATE test_data SET flag = 1 WHERE flag = 0;\nQuery OK, 10 rows affected (0.00 sec)\nRows matched: 10  Changed: 10  Warnings: 0\n\nmysql> SELECT * FROM information_schema.optimizer_trace\\G\n*************************** 1. row ***************************\n                            QUERY: UPDATE test_data SET flag = 1 WHERE flag = 0\n                            TRACE: {\n  \"steps\": [\n    {\n      \"substitute_generated_columns\": {\n      }\n    },\n    {\n      \"condition_processing\": {\n        \"condition\": \"WHERE\",\n        \"original_condition\": \"(`test_data`.`flag` = 0)\",\n        \"steps\": [\n          {\n            \"transformation\": \"equality_propagation\",\n            \"resulting_condition\": \"multiple equal(0, `test_data`.`flag`)\"\n          },\n          {\n            \"transformation\": \"constant_propagation\",\n            \"resulting_condition\": \"multiple equal(0, `test_data`.`flag`)\"\n          },\n          {\n            \"transformation\": \"trivial_condition_removal\",\n            \"resulting_condition\": \"multiple equal(0, `test_data`.`flag`)\"\n          }\n        ]\n      }\n    },\n    {\n      \"table\": \"`test_data`\",\n      \"range_analysis\": {\n        \"table_scan\": {\n          \"rows\": 10207,\n          \"cost\": 2074.5\n        },\n        \"potential_range_indexes\": [\n          {\n            \"index\": \"PRIMARY\",\n            \"usable\": true,\n            \"key_parts\": [\n              \"id\"\n            ]\n          },\n          {\n            \"index\": \"idx_flag\",\n            \"usable\": true,\n            \"key_parts\": [\n              \"flag\",\n              \"id\"\n            ]\n          }\n        ],\n        \"setup_range_conditions\": [\n        ],\n        \"group_index_range\": {\n          \"chosen\": false,\n          \"cause\": \"no_join\"\n        },\n        \"analyzing_range_alternatives\": {\n          \"range_scan_alternatives\": [\n            {\n              \"index\": \"idx_flag\",\n              \"ranges\": [\n                \"0 <= flag <= 0\"\n              ],\n              \"index_dives_for_eq_ranges\": true,\n              \"rowid_ordered\": true,\n              \"using_mrr\": false,\n              \"index_only\": false,\n              \"rows\": 10,\n              \"cost\": 13.01,\n              \"chosen\": true\n            }\n          ],\n          \"analyzing_roworder_intersect\": {\n            \"usable\": false,\n            \"cause\": \"too_few_roworder_scans\"\n          }\n        },\n        \"chosen_range_access_summary\": {\n          \"range_access_plan\": {\n            \"type\": \"range_scan\",\n            \"index\": \"idx_flag\",\n            \"rows\": 10,\n            \"ranges\": [\n              \"0 <= flag <= 0\"\n            ]\n          },\n          \"rows_for_plan\": 10,\n          \"cost_for_plan\": 13.01,\n          \"chosen\": true\n        }\n      }\n    }\n  ]\n}\nMISSING_BYTES_BEYOND_MAX_MEM_SIZE: 0\n          INSUFFICIENT_PRIVILEGES: 0\n1 row in set (0.00 sec)\n```\n\n\u76f8\u5909\u308f\u3089\u305a\u9577\u3044\u306e\u3067\u3059\u304c\u3001SELECT\u6587\u306e\u3068\u304d\u3088\u308a\u3001\u3061\u3087\u3063\u3068\u77ed\u3044\u3067\u3059\u306d\u3002\n\u30fb\u300crange\u300d\u691c\u7d22\u306b\u4e3b\u30ad\u30fc\u306eINDEX\u3082\uff08\u300cidx_flag\u300d\u3068\u540c\u69d8\u306b\uff09\u300c\u4f7f\u3048\u308b\uff1f\u300d\u3068\u63a8\u5b9a\u3055\u308c\u3066\u3044\u308b\n\u30fb\u300cref\u300d\u306b\u3064\u3044\u3066\u306e\u60c5\u5831\u304c\u51fa\u3066\u304d\u3066\u3044\u306a\u3044\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u6700\u7d42\u7684\u306b\u300crange\u300d\uff08\u7bc4\u56f2\uff09\u691c\u7d22\u6271\u3044\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n\u3055\u3066\u3001\u305d\u308d\u305d\u308d\u8f9b\u304f\u306a\u3063\u3066\u304d\u305f\u3068\u601d\u3044\u307e\u3059\u304c\uff08\u7b11\uff09\u3001\u300c10,000\u4ef6\u304b\u30899,990\u4ef6\u3092\u62bd\u51fa\u3059\u308b\u300d\u307b\u3046\uff08\u300cWHERE flag = 1\u300d\uff09\u3067\u3059\u3002\n\n```mysql:\nmysql> EXPLAIN SELECT * FROM test_data WHERE flag = 1;\n+----+-------------+-----------+------------+------+---------------+----------+---------+-------+------+----------+-------+\n| id | select_type | table     | partitions | type | possible_keys | key      | key_len | ref   | rows | filtered | Extra |\n+----+-------------+-----------+------------+------+---------------+----------+---------+-------+------+----------+-------+\n|  1 | SIMPLE      | test_data | NULL       | ref  | idx_flag      | idx_flag | 4       | const | 5103 |   100.00 | NULL  |\n+----+-------------+-----------+------------+------+---------------+----------+---------+-------+------+----------+-------+\n1 row in set, 1 warning (0.00 sec)\n\nmysql> EXPLAIN UPDATE test_data SET flag = 0 WHERE flag = 1;\n+----+-------------+-----------+------------+-------+---------------+---------+---------+------+-------+----------+------------------------------+\n| id | select_type | table     | partitions | type  | possible_keys | key     | key_len | ref  | rows  | filtered | Extra                        |\n+----+-------------+-----------+------------+-------+---------------+---------+---------+------+-------+----------+------------------------------+\n|  1 | UPDATE      | test_data | NULL       | index | idx_flag      | PRIMARY | 8       | NULL | 10207 |   100.00 | Using where; Using temporary |\n+----+-------------+-----------+------------+-------+---------------+---------+---------+------+-------+----------+------------------------------+\n1 row in set (0.00 sec)\n```\n\u300cref\u300d\uff0810\u4ef6\u62bd\u51fa\u306e\u3068\u304d\u3068\u540c\u3058\uff09\u3068\u300cindex\u300d\u306b\u7d50\u679c\u304c\u5206\u304b\u308c\u3066\u3044\u307e\u3059\u3002\n\nSELECT\u6587\u3067\u306f\u3001\n\n```mysql:\nmysql> SELECT * FROM test_data WHERE flag = 1;\n+------+--------------+------+\n| id   | name         | flag |\n+------+--------------+------+\n|    1 | shouhin00001 |    1 |\n|    2 | shouhin00002 |    1 |\n|    3 | shouhin00003 |    1 |\n|    4 | shouhin00004 |    1 |\n|    5 | shouhin00005 |    1 |\n\uff08\u4e2d\u7565\uff09\n| 9986 | shouhin09986 |    1 |\n| 9987 | shouhin09987 |    1 |\n| 9988 | shouhin09988 |    1 |\n| 9989 | shouhin09989 |    1 |\n| 9990 | shouhin09990 |    1 |\n+------+--------------+------+\n9990 rows in set (0.01 sec)\n\nmysql> SELECT * FROM information_schema.optimizer_trace\\G\n*************************** 1. row ***************************\n                            QUERY: SELECT * FROM test_data WHERE flag = 1\n                            TRACE: {\n  \"steps\": [\n    {\n      \"join_preparation\": {\n        \"select#\": 1,\n        \"steps\": [\n          {\n            \"expanded_query\": \"/* select#1 */ select `test_data`.`id` AS `id`,`test_data`.`name` AS `name`,`test_data`.`flag` AS `flag` from `test_data` where (`test_data`.`flag` = 1)\"\n          }\n        ]\n      }\n    },\n    {\n      \"join_optimization\": {\n        \"select#\": 1,\n        \"steps\": [\n          {\n            \"condition_processing\": {\n              \"condition\": \"WHERE\",\n              \"original_condition\": \"(`test_data`.`flag` = 1)\",\n              \"steps\": [\n                {\n                  \"transformation\": \"equality_propagation\",\n                  \"resulting_condition\": \"multiple equal(1, `test_data`.`flag`)\"\n                },\n                {\n                  \"transformation\": \"constant_propagation\",\n                  \"resulting_condition\": \"multiple equal(1, `test_data`.`flag`)\"\n                },\n                {\n                  \"transformation\": \"trivial_condition_removal\",\n                  \"resulting_condition\": \"multiple equal(1, `test_data`.`flag`)\"\n                }\n              ]\n            }\n          },\n          {\n            \"substitute_generated_columns\": {\n            }\n          },\n          {\n            \"table_dependencies\": [\n              {\n                \"table\": \"`test_data`\",\n                \"row_may_be_null\": false,\n                \"map_bit\": 0,\n                \"depends_on_map_bits\": [\n                ]\n              }\n            ]\n          },\n          {\n            \"ref_optimizer_key_uses\": [\n              {\n                \"table\": \"`test_data`\",\n                \"field\": \"flag\",\n                \"equals\": \"1\",\n                \"null_rejecting\": false\n              }\n            ]\n          },\n          {\n            \"rows_estimation\": [\n              {\n                \"table\": \"`test_data`\",\n                \"range_analysis\": {\n                  \"table_scan\": {\n                    \"rows\": 10207,\n                    \"cost\": 2074.5\n                  },\n                  \"potential_range_indexes\": [\n                    {\n                      \"index\": \"PRIMARY\",\n                      \"usable\": false,\n                      \"cause\": \"not_applicable\"\n                    },\n                    {\n                      \"index\": \"idx_flag\",\n                      \"usable\": true,\n                      \"key_parts\": [\n                        \"flag\",\n                        \"id\"\n                      ]\n                    }\n                  ],\n                  \"setup_range_conditions\": [\n                  ],\n                  \"group_index_range\": {\n                    \"chosen\": false,\n                    \"cause\": \"not_group_by_or_distinct\"\n                  },\n                  \"analyzing_range_alternatives\": {\n                    \"range_scan_alternatives\": [\n                      {\n                        \"index\": \"idx_flag\",\n                        \"ranges\": [\n                          \"1 <= flag <= 1\"\n                        ],\n                        \"index_dives_for_eq_ranges\": true,\n                        \"rowid_ordered\": true,\n                        \"using_mrr\": false,\n                        \"index_only\": false,\n                        \"rows\": 5103,\n                        \"cost\": 6124.6,\n                        \"chosen\": false,\n                        \"cause\": \"cost\"\n                      }\n                    ],\n                    \"analyzing_roworder_intersect\": {\n                      \"usable\": false,\n                      \"cause\": \"too_few_roworder_scans\"\n                    }\n                  }\n                }\n              }\n            ]\n          },\n          {\n            \"considered_execution_plans\": [\n              {\n                \"plan_prefix\": [\n                ],\n                \"table\": \"`test_data`\",\n                \"best_access_path\": {\n                  \"considered_access_paths\": [\n                    {\n                      \"access_type\": \"ref\",\n                      \"index\": \"idx_flag\",\n                      \"rows\": 5103,\n                      \"cost\": 1113.6,\n                      \"chosen\": true\n                    },\n                    {\n                      \"rows_to_scan\": 10207,\n                      \"access_type\": \"scan\",\n                      \"resulting_rows\": 10207,\n                      \"cost\": 2072.4,\n                      \"chosen\": false\n                    }\n                  ]\n                },\n                \"condition_filtering_pct\": 100,\n                \"rows_for_plan\": 5103,\n                \"cost_for_plan\": 1113.6,\n                \"chosen\": true\n              }\n            ]\n          },\n          {\n            \"attaching_conditions_to_tables\": {\n              \"original_condition\": \"(`test_data`.`flag` = 1)\",\n              \"attached_conditions_computation\": [\n              ],\n              \"attached_conditions_summary\": [\n                {\n                  \"table\": \"`test_data`\",\n                  \"attached\": null\n                }\n              ]\n            }\n          },\n          {\n            \"refine_plan\": [\n              {\n                \"table\": \"`test_data`\"\n              }\n            ]\n          }\n        ]\n      }\n    },\n    {\n      \"join_execution\": {\n        \"select#\": 1,\n        \"steps\": [\n        ]\n      }\n    }\n  ]\n}\nMISSING_BYTES_BEYOND_MAX_MEM_SIZE: 0\n          INSUFFICIENT_PRIVILEGES: 0\n1 row in set (0.00 sec)\n```\n\n\u300cref\u300d\u3068\u300crange\u300d\u3067\u63a8\u5b9a\u3055\u308c\u3066\u3044\u308b\u884c\u6570\u306f\u540c\u3058\u300c5103\u300d\uff08\u304a\u305d\u3089\u304fINDEX\u306e\u8d70\u67fb\u3092\u3042\u304d\u3089\u3081\u3066\u3001\u7d71\u8a08\u60c5\u5831\u304b\u3089\u62fe\u3063\u3066\u304d\u305f\u6570\u5b57\u3067\u3057\u3087\u3046\uff09\u3067\u3059\u304c\u3001\u63a8\u5b9a\u30b3\u30b9\u30c8\u304c\u300c1113.6\u300d\u3068\u300c6124.6\u300d\u3067\u3001\u304b\u306a\u308a\u5dee\u304c\u3042\u308a\u307e\u3059\u3002\n\u300cref\u300d\u306e\u300c1113.6\u300d\u3068\u3044\u3046\u6570\u5b57\u306f\u3001\u30c6\u30fc\u30d6\u30eb\u30b9\u30ad\u30e3\u30f3\u6642\u306e\u300c2072.4\u300d\u3088\u308a\u5c0f\u3055\u3044\u305f\u3081\u3001\u6700\u7d42\u7684\u306b\u300cref\u300d\u304c\u9078\u3070\u308c\u305f\u3088\u3046\u3067\u3059\uff08\u63a8\u5b9a\u3055\u308c\u305f\u300c5103\u300d\u3068\u3044\u3046\u884c\u6570\u304c\u304b\u306a\u308a\u5b9f\u614b\u3068\u304b\u3051\u96e2\u308c\u3066\u3044\u308b\u305f\u3081\u306b\u3001\u7d50\u679c\u3068\u3057\u3066\u9078\u629e\u30df\u30b9\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u307e\u3059\u304c\uff09\u3002\n\n\u6b21\u306fUPDATE\u6587\u3001\u3088\u3046\u3084\u304f\u6700\u5f8c\u3067\u3059\u3002\n\n```mysql:\nmysql> UPDATE test_data SET flag = 0 WHERE flag = 1;\nQuery OK, 9990 rows affected (0.23 sec)\nRows matched: 9990  Changed: 9990  Warnings: 0\n\nmysql> UPDATE test_data SET flag = 0 WHERE flag = 1;\nQuery OK, 9990 rows affected (0.23 sec)\nRows matched: 9990  Changed: 9990  Warnings: 0\n\nmysql> SELECT * FROM information_schema.optimizer_trace\\G\n*************************** 1. row ***************************\n                            QUERY: UPDATE test_data SET flag = 0 WHERE flag = 1\n                            TRACE: {\n  \"steps\": [\n    {\n      \"substitute_generated_columns\": {\n      }\n    },\n    {\n      \"condition_processing\": {\n        \"condition\": \"WHERE\",\n        \"original_condition\": \"(`test_data`.`flag` = 1)\",\n        \"steps\": [\n          {\n            \"transformation\": \"equality_propagation\",\n            \"resulting_condition\": \"multiple equal(1, `test_data`.`flag`)\"\n          },\n          {\n            \"transformation\": \"constant_propagation\",\n            \"resulting_condition\": \"multiple equal(1, `test_data`.`flag`)\"\n          },\n          {\n            \"transformation\": \"trivial_condition_removal\",\n            \"resulting_condition\": \"multiple equal(1, `test_data`.`flag`)\"\n          }\n        ]\n      }\n    },\n    {\n      \"table\": \"`test_data`\",\n      \"range_analysis\": {\n        \"table_scan\": {\n          \"rows\": 10207,\n          \"cost\": 2074.5\n        },\n        \"potential_range_indexes\": [\n          {\n            \"index\": \"PRIMARY\",\n            \"usable\": true,\n            \"key_parts\": [\n              \"id\"\n            ]\n          },\n          {\n            \"index\": \"idx_flag\",\n            \"usable\": true,\n            \"key_parts\": [\n              \"flag\",\n              \"id\"\n            ]\n          }\n        ],\n        \"setup_range_conditions\": [\n        ],\n        \"group_index_range\": {\n          \"chosen\": false,\n          \"cause\": \"no_join\"\n        },\n        \"analyzing_range_alternatives\": {\n          \"range_scan_alternatives\": [\n            {\n              \"index\": \"idx_flag\",\n              \"ranges\": [\n                \"1 <= flag <= 1\"\n              ],\n              \"index_dives_for_eq_ranges\": true,\n              \"rowid_ordered\": true,\n              \"using_mrr\": false,\n              \"index_only\": false,\n              \"rows\": 5103,\n              \"cost\": 6124.6,\n              \"chosen\": false,\n              \"cause\": \"cost\"\n            }\n          ],\n          \"analyzing_roworder_intersect\": {\n            \"usable\": false,\n            \"cause\": \"too_few_roworder_scans\"\n          }\n        }\n      }\n    }\n  ]\n}\nMISSING_BYTES_BEYOND_MAX_MEM_SIZE: 0\n          INSUFFICIENT_PRIVILEGES: 0\n1 row in set (0.00 sec)\n```\n\nUPDATE\u6587\u306710\u4ef6\u62bd\u51fa\u306e\u3068\u304d\u3068\u540c\u69d8\u3001\u300cref\u300d\u306b\u3064\u3044\u3066\u691c\u8a0e\u3057\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\u7d50\u679c\u3001\u300crange\u300d\u3088\u308a\u3082\u300cindex\u300d\uff08INDEX\u30d5\u30eb\u30b9\u30ad\u30e3\u30f3\uff09\u306e\u307b\u3046\u304c\u30b3\u30b9\u30c8\u304c\u4f4e\u3044\u3068\u63a8\u5b9a\u3055\u308c\u3001\u9078\u629e\u3055\u308c\u305f\u306e\u3067\u306f\u306a\u3044\u3067\u3057\u3087\u3046\u304b\uff1f\nUPDATE\u6587\u306e\u5834\u5408\u306fSELECT\u3068\u6bd4\u3079\u3066\u7d30\u304b\u3044\u60c5\u5831\u304c\u51fa\u3066\u3044\u306a\u3044\u3088\u3046\u306a\u306e\u3067\u3001\u3082\u3057\u304b\u3057\u305f\u3089\u9593\u9055\u3063\u3066\u3044\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3002\n\n# \u6700\u5f8c\u306b\n[\u6f22\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u9053](http://nippondanji.blogspot.jp/)\u3067\u304a\u306a\u3058\u307f\u3001\u5965\u91ce\u5e79\u4e5f\u3055\u3093\u306e\u8457\u66f8[\u300e\u8a73\u89e3MySQL5.7 \u6b62\u307e\u3089\u306c\u9032\u5316\u306b\u4e57\u308a\u9045\u308c\u306a\u3044\u305f\u3081\u306e\u30c6\u30af\u30cb\u30ab\u30eb\u30ac\u30a4\u30c9\u300f](http://www.shoeisha.co.jp/book/detail/9784798147406)\u304c\u767a\u58f2\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u30c8\u30ec\u30fc\u30b9\u306b\u3064\u3044\u3066\u3082\u3001JOIN\u306e\u5834\u5408\u3092\u4f8b\u306b\u3001\u3082\u3063\u3068\u8a73\u3057\u3044\u89e3\u8aac\u304c\u8f09\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u8208\u5473\u304c\u3042\u308b\u65b9\u306f\u662f\u975e\u8aad\u3093\u3067\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\u3068\u3044\u3063\u3066\u3082\u3001\u79c1\u306f\u7fd4\u6cf3\u793e\u30fbOracle\u30fb\u5965\u91ce\u3055\u3093\u3068\u306f\u4f55\u306e\u95a2\u4fc2\u3082\u3042\u308a\u307e\u305b\u3093\u304c\u3002\n\n\u3042\u3001\u305d\u3046\u3044\u3048\u3070\u3001\u5965\u91ce\u3055\u3093\u306b\u306f\u3001\u4ee5\u524d\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u30ab\u30f3\u30d5\u30a1\u30ec\u30f3\u30b9\u306e\u30d6\u30fc\u30b9\u3067\u304a\u4f1a\u3044\u3057\u305f\u3068\u304d\u306b\u3001\u30b5\u30fc\u30d3\u30b9\u7cbe\u795e\u65fa\u76db\u306a\u611f\u3058\u3067\u3001\u8272\u3005\u304a\u8a71\u3092\u3057\u3066\u3044\u305f\u3060\u3044\u305f\u3053\u3068\u306f\u3042\u308a\u307e\u3057\u305f\u3002\n", "tags": ["MySQL", "mysql5.6", "mysql5.7"]}