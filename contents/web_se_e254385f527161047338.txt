{"context": "\n\nGoogle Cloud Provider\nhttps://www.terraform.io/docs/providers/google/\n\u5168\u3066\u306eGCP\u306e\u30b5\u30fc\u30d3\u30b9\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u308f\u3051\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u4ee5\u4e0b\u306f\u672a\u30b5\u30dd\u30fc\u30c8\n- Cloud BigTable\n- Cloud Spanner\n\u4ed6\u306b\u3082\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u30b5\u30fc\u30d3\u30b9\u3042\u308a\n\n\u4f5c\u6210\u624b\u9806\n\nVirtual Network\nSub Network\nBackend Service\nInstance Template\nInstance Group\nHeath Check\nForwarding Rule\n\u306e\u9806\u306b\u4f5c\u6210\n\n// Configure the Google Cloud provider\nprovider \"google\" {\n  credentials = \"${file(\"account.json\")}\"\n  project = \"XXXXXXXX\"\n  region = \"asia-northeast1\"\n}\n\nresource \"google_compute_network\" \"test\"{\n   name  = \"test\"\n   auto_create_subnetworks = \"false\"\n}\n\nresource \"google_compute_subnetwork\" \"test-asia-northeast1\" {\n  name =  \"test-asia-northeast1\"\n  ip_cidr_range = \"10.40.0.0/16\"\n  network = \"${google_compute_network.test.self_link}\"\n  region = \"asia-northeast1\"\n}\n\nresource \"google_compute_firewall\" \"test\" {\n  name = \"test\"\n  network = \"${google_compute_network.test.name}\"\n\n  allow {\n    protocol = \"icmp\"\n  }\n\n  allow {\n    protocol = \"tcp\"\n    ports    = [\"80\"]\n  }\n\n  source_tags = [\"web\"]\n}\n\nresource \"google_compute_region_backend_service\" \"foobar\" {\n  name                  = \"blablah\"\n  description           = \"Hello World 1234\"\n  protocol              = \"TCP\"\n  timeout_sec           = 10\n\n  backend {\n    group = \"${google_compute_instance_group_manager.foo.instance_group}\"\n  }\n\n  health_checks = [\"${google_compute_health_check.default.self_link}\"]\n}\n\nresource \"google_compute_instance_group_manager\" \"foo\" {\n  name               = \"terraform-test\"\n  instance_template  = \"${google_compute_instance_template.foobar.self_link}\"\n  base_instance_name = \"foobar\"\n  zone               = \"asia-northeast1-a\"\n  target_size        = 1\n}\n\nresource \"google_compute_instance_template\" \"foobar\" {\n  name         = \"terraform-test\"\n  machine_type = \"f1-micro\"\n\n  network_interface {\n    subnetwork = \"test-asia-northeast1\"\n  }\n\n  disk {\n    source_image = \"debian-cloud/debian-8\"\n    auto_delete  = true\n    boot         = true\n  }\n}\n\nresource \"google_compute_health_check\" \"default\" {\n  name               = \"test\"\n  check_interval_sec = 1\n  timeout_sec        = 1\n  tcp_health_check {\n    port = \"80\"\n  }\n}\n\nresource \"google_compute_forwarding_rule\" \"default\" {\n  name       = \"test\"\n  backend_service = \"${google_compute_region_backend_service.foobar.self_link}\"\n  network = \"${google_compute_network.test.self_link}\"\n  region = \"asia-northeast1\"\n  load_balancing_scheme = \"INTERNAL\"\n  subnetwork = \"${google_compute_subnetwork.test-asia-northeast1.self_link}\"\n  ports = [\"80\"]\n}\n\n\n\u30ea\u30bd\u30fc\u30b9\u306e\u4f9d\u5b58\u95a2\u4fc2\u304c\u3042\u308a\u3001\u30a8\u30e9\u30fc\nterraform destory\u3092\u3059\u308b\u969b\u306b\u3001\u4e0b\u8a18\u30a8\u30e9\u30fc\u304c\u3002\n\u518d\u5ea6\u30ea\u30c8\u30e9\u30a4\u3059\u308c\u3070Complete\n* google_compute_subnetwork.test-asia-northeast1: Error deleting subnetwork: googleapi: Error 400: The subnetwork resource 'test-asia-northeast1' is already being used by 'foobar-j409', resourceInUseByAnotherResource\n\n\u524d\u8ff0\u306e\u51e6\u7406\u3092\u5f85\u305f\u305a\u306b\u3001\u5b9f\u884c\u3059\u308b\u3088\u3046\u3067\u3001depends_on\u3092\u5165\u308c\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nTerraform\u3092\u4f7f\u3046\uff01\u300cTerraform\u304b\u3089heroku\u30a2\u30d7\u30ea\u3092\u64cd\u4f5c\u3059\u308b\u969b\u306e\u30cf\u30de\u308a\u3069\u3053\u308d\u300d\n\n\u89e3\u6c7a\n\u4f9d\u5b58\u95a2\u4fc2\u306e\u3042\u308b\u30ea\u30bd\u30fc\u30b9\u306bdepends_on\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u5165\u308c\u308b\u3053\u3068\u3067\u89e3\u6c7a\u3057\u307e\u3057\u305f\u3002\ndepends_on = [\"google_compute_subnetwork.test-asia-northeast1\"]\n\n\u4fee\u6b63\u5f8c\u306eTF\u30d5\u30a1\u30a4\u30eb\n// Configure the Google Cloud provider\nprovider \"google\" {\n  credentials = \"${file(\"account.json\")}\"\n  project = \"XXXXXXXX\"\n  region = \"asia-northeast1\"\n}\n\nresource \"google_compute_network\" \"test\"{\n   name  = \"test\"\n   auto_create_subnetworks = \"false\"\n}\n\nresource \"google_compute_subnetwork\" \"test-asia-northeast1\" {\n  depends_on = [\"google_compute_network.test\"]\n  name =  \"test-asia-northeast1\"\n  ip_cidr_range = \"10.40.0.0/16\"\n  network = \"${google_compute_network.test.self_link}\"\n  region = \"asia-northeast1\"\n}\n\nresource \"google_compute_firewall\" \"test\" {\n  name = \"test\"\n  network = \"${google_compute_network.test.name}\"\n\n  allow {\n    protocol = \"icmp\"\n  }\n\n  allow {\n    protocol = \"tcp\"\n    ports    = [\"80\"]\n  }\n\n  source_tags = [\"web\"]\n}\n\nresource \"google_compute_region_backend_service\" \"foobar\" {\n  name                  = \"blablah\"\n  description           = \"Hello World 1234\"\n  protocol              = \"TCP\"\n  timeout_sec           = 10\n\n  backend {\n    group = \"${google_compute_instance_group_manager.foo.instance_group}\"\n  }\n\n  health_checks = [\"${google_compute_health_check.default.self_link}\"]\n}\n\n\nresource \"google_compute_instance_template\" \"foobar\" {\n  depends_on   = [\"google_compute_subnetwork.test-asia-northeast1\"]\n  name         = \"terraform-test\"\n  machine_type = \"f1-micro\"\n\n  network_interface {\n    subnetwork = \"test-asia-northeast1\"\n  }\n\n  disk {\n    source_image = \"debian-cloud/debian-8\"\n    auto_delete  = true\n    boot         = true\n  }\n}\n\nresource \"google_compute_instance_group_manager\" \"foo\" {\n  depends_on         = [\"google_compute_instance_template.foobar\"]\n  name               = \"terraform-test\"\n  instance_template  = \"${google_compute_instance_template.foobar.self_link}\"\n  base_instance_name = \"foobar\"\n  zone               = \"asia-northeast1-a\"\n  target_size        = 1\n}\n\n\nresource \"google_compute_health_check\" \"default\" {\n  name               = \"test\"\n  check_interval_sec = 1\n  timeout_sec        = 1\n  tcp_health_check {\n    port = \"80\"\n  }\n}\n\nresource \"google_compute_forwarding_rule\" \"default\" {\n  depends_on = [\"google_compute_region_backend_service.foobar\"]\n  name       = \"test\"\n  backend_service = \"${google_compute_region_backend_service.foobar.self_link}\"\n  network = \"${google_compute_network.test.self_link}\"\n  region = \"asia-northeast1\"\n  load_balancing_scheme = \"INTERNAL\"\n  subnetwork = \"${google_compute_subnetwork.test-asia-northeast1.self_link}\"\n  ports = [\"80\"]\n}\n\n# Google Cloud Provider\n[https://www.terraform.io/docs/providers/google/](https://www.terraform.io/docs/providers/google/)\n\n\u5168\u3066\u306eGCP\u306e\u30b5\u30fc\u30d3\u30b9\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u308f\u3051\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u4ee5\u4e0b\u306f\u672a\u30b5\u30dd\u30fc\u30c8\n- Cloud BigTable\n- Cloud Spanner\n\u4ed6\u306b\u3082\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u30b5\u30fc\u30d3\u30b9\u3042\u308a\n\n\n# \u4f5c\u6210\u624b\u9806\n\n1. Virtual Network\n2. Sub Network\n3. Backend Service\n4. Instance Template\n5. Instance Group\n6. Heath Check\n7. Forwarding Rule\n\u306e\u9806\u306b\u4f5c\u6210\n\n\n```\n// Configure the Google Cloud provider\nprovider \"google\" {\n  credentials = \"${file(\"account.json\")}\"\n  project = \"XXXXXXXX\"\n  region = \"asia-northeast1\"\n}\n\nresource \"google_compute_network\" \"test\"{\n   name  = \"test\"\n   auto_create_subnetworks = \"false\"\n}\n\nresource \"google_compute_subnetwork\" \"test-asia-northeast1\" {\n  name =  \"test-asia-northeast1\"\n  ip_cidr_range = \"10.40.0.0/16\"\n  network = \"${google_compute_network.test.self_link}\"\n  region = \"asia-northeast1\"\n}\n\nresource \"google_compute_firewall\" \"test\" {\n  name = \"test\"\n  network = \"${google_compute_network.test.name}\"\n\n  allow {\n    protocol = \"icmp\"\n  }\n\n  allow {\n    protocol = \"tcp\"\n    ports    = [\"80\"]\n  }\n\n  source_tags = [\"web\"]\n}\n\nresource \"google_compute_region_backend_service\" \"foobar\" {\n  name                  = \"blablah\"\n  description           = \"Hello World 1234\"\n  protocol              = \"TCP\"\n  timeout_sec           = 10\n\n  backend {\n    group = \"${google_compute_instance_group_manager.foo.instance_group}\"\n  }\n\n  health_checks = [\"${google_compute_health_check.default.self_link}\"]\n}\n\nresource \"google_compute_instance_group_manager\" \"foo\" {\n  name               = \"terraform-test\"\n  instance_template  = \"${google_compute_instance_template.foobar.self_link}\"\n  base_instance_name = \"foobar\"\n  zone               = \"asia-northeast1-a\"\n  target_size        = 1\n}\n\nresource \"google_compute_instance_template\" \"foobar\" {\n  name         = \"terraform-test\"\n  machine_type = \"f1-micro\"\n\n  network_interface {\n    subnetwork = \"test-asia-northeast1\"\n  }\n\n  disk {\n    source_image = \"debian-cloud/debian-8\"\n    auto_delete  = true\n    boot         = true\n  }\n}\n\nresource \"google_compute_health_check\" \"default\" {\n  name               = \"test\"\n  check_interval_sec = 1\n  timeout_sec        = 1\n  tcp_health_check {\n    port = \"80\"\n  }\n}\n\nresource \"google_compute_forwarding_rule\" \"default\" {\n  name       = \"test\"\n  backend_service = \"${google_compute_region_backend_service.foobar.self_link}\"\n  network = \"${google_compute_network.test.self_link}\"\n  region = \"asia-northeast1\"\n  load_balancing_scheme = \"INTERNAL\"\n  subnetwork = \"${google_compute_subnetwork.test-asia-northeast1.self_link}\"\n  ports = [\"80\"]\n}\n```\n\n# \u30ea\u30bd\u30fc\u30b9\u306e\u4f9d\u5b58\u95a2\u4fc2\u304c\u3042\u308a\u3001\u30a8\u30e9\u30fc\n\nterraform destory\u3092\u3059\u308b\u969b\u306b\u3001\u4e0b\u8a18\u30a8\u30e9\u30fc\u304c\u3002\n\u518d\u5ea6\u30ea\u30c8\u30e9\u30a4\u3059\u308c\u3070Complete\n\n```\n* google_compute_subnetwork.test-asia-northeast1: Error deleting subnetwork: googleapi: Error 400: The subnetwork resource 'test-asia-northeast1' is already being used by 'foobar-j409', resourceInUseByAnotherResource\n```\n\n\u524d\u8ff0\u306e\u51e6\u7406\u3092\u5f85\u305f\u305a\u306b\u3001\u5b9f\u884c\u3059\u308b\u3088\u3046\u3067\u3001depends_on\u3092\u5165\u308c\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n[Terraform\u3092\u4f7f\u3046\uff01\u300cTerraform\u304b\u3089heroku\u30a2\u30d7\u30ea\u3092\u64cd\u4f5c\u3059\u308b\u969b\u306e\u30cf\u30de\u308a\u3069\u3053\u308d\u300d](http://tech-sketch.jp/2014/09/terraformterraformheroku.html)\n\n\n# \u89e3\u6c7a\n\n\u4f9d\u5b58\u95a2\u4fc2\u306e\u3042\u308b\u30ea\u30bd\u30fc\u30b9\u306bdepends_on\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u5165\u308c\u308b\u3053\u3068\u3067\u89e3\u6c7a\u3057\u307e\u3057\u305f\u3002\n\n```\ndepends_on = [\"google_compute_subnetwork.test-asia-northeast1\"]\n```\n\n\u4fee\u6b63\u5f8c\u306eTF\u30d5\u30a1\u30a4\u30eb\n\n```\n// Configure the Google Cloud provider\nprovider \"google\" {\n  credentials = \"${file(\"account.json\")}\"\n  project = \"XXXXXXXX\"\n  region = \"asia-northeast1\"\n}\n\nresource \"google_compute_network\" \"test\"{\n   name  = \"test\"\n   auto_create_subnetworks = \"false\"\n}\n\nresource \"google_compute_subnetwork\" \"test-asia-northeast1\" {\n  depends_on = [\"google_compute_network.test\"]\n  name =  \"test-asia-northeast1\"\n  ip_cidr_range = \"10.40.0.0/16\"\n  network = \"${google_compute_network.test.self_link}\"\n  region = \"asia-northeast1\"\n}\n\nresource \"google_compute_firewall\" \"test\" {\n  name = \"test\"\n  network = \"${google_compute_network.test.name}\"\n\n  allow {\n    protocol = \"icmp\"\n  }\n\n  allow {\n    protocol = \"tcp\"\n    ports    = [\"80\"]\n  }\n\n  source_tags = [\"web\"]\n}\n\nresource \"google_compute_region_backend_service\" \"foobar\" {\n  name                  = \"blablah\"\n  description           = \"Hello World 1234\"\n  protocol              = \"TCP\"\n  timeout_sec           = 10\n\n  backend {\n    group = \"${google_compute_instance_group_manager.foo.instance_group}\"\n  }\n\n  health_checks = [\"${google_compute_health_check.default.self_link}\"]\n}\n\n\nresource \"google_compute_instance_template\" \"foobar\" {\n  depends_on   = [\"google_compute_subnetwork.test-asia-northeast1\"]\n  name         = \"terraform-test\"\n  machine_type = \"f1-micro\"\n\n  network_interface {\n    subnetwork = \"test-asia-northeast1\"\n  }\n\n  disk {\n    source_image = \"debian-cloud/debian-8\"\n    auto_delete  = true\n    boot         = true\n  }\n}\n\nresource \"google_compute_instance_group_manager\" \"foo\" {\n  depends_on         = [\"google_compute_instance_template.foobar\"]\n  name               = \"terraform-test\"\n  instance_template  = \"${google_compute_instance_template.foobar.self_link}\"\n  base_instance_name = \"foobar\"\n  zone               = \"asia-northeast1-a\"\n  target_size        = 1\n}\n\n\nresource \"google_compute_health_check\" \"default\" {\n  name               = \"test\"\n  check_interval_sec = 1\n  timeout_sec        = 1\n  tcp_health_check {\n    port = \"80\"\n  }\n}\n\nresource \"google_compute_forwarding_rule\" \"default\" {\n  depends_on = [\"google_compute_region_backend_service.foobar\"]\n  name       = \"test\"\n  backend_service = \"${google_compute_region_backend_service.foobar.self_link}\"\n  network = \"${google_compute_network.test.self_link}\"\n  region = \"asia-northeast1\"\n  load_balancing_scheme = \"INTERNAL\"\n  subnetwork = \"${google_compute_subnetwork.test-asia-northeast1.self_link}\"\n  ports = [\"80\"]\n}\n```\n", "tags": ["Terraform", "GoogleCloudPlatform", "googlecomputeengine"]}