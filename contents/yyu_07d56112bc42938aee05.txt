{"context": "\n\n\u7d9a\u7de8\u3092\u66f8\u304d\u307e\u3057\u305f\nThe Missing Method of Extensible Exception: implicit \u201ctransitive\u201d\n\n\u306f\u3058\u3081\u306b\n\n\u6ce8\u610f\uff1a\n\u8a18\u4e8b\u306e\u4e2d\u306b\u3042\u308b\u30b3\u30fc\u30c9\u306f\u8aad\u307f\u3084\u3059\u3055\u306e\u305f\u3081\u306bimport\u306a\u3069\u3092\u7701\u7565\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u306e\u307e\u307e\u3067\u306f\u52d5\u304b\u306a\u3044\u3002\u52d5\u304b\u3057\u305f\u3044\u65b9\u306fGithub\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4f7f\u3046\u3068\u3088\u3044\u3002\n\nScala\u3067\u4f8b\u5916\u3092\u53d6\u308a\u6271\u3046\u969b\u306b\u306f\u3001\u4e00\u822c\u7684\u306b\u30c7\u30fc\u30bf\u578b\u3092\u4f7f\u3063\u3066\u6b21\u306e\u3088\u3046\u306b\u4f8b\u5916\u306e\u968e\u5c64\u69cb\u9020\u3092\u8a2d\u8a08\u3059\u308b\u3002\ntrait RootException extends Throwable\n\ncase class DatabaseException(m: String) extends RootException\n\ncase class HttpException(m: String) extends RootException\n\ntrait FileException extends RootException\n\ncase class ReadException(m: String) extends FileException\n\ncase class WriteException(m: String) extends FileException\n\n\u3053\u308c\u306f\u6b21\u306e\u3088\u3046\u306a\u968e\u5c64\u69cb\u9020\u306b\u306a\u3063\u3066\u3044\u308b\u3002\nRootException\n|\n+---- DatabaseException\n|\n+---- HttpException\n|\n+---- FileException\n      |\n      +---- ReadException\n      |\n      +---- WriteException\n\n\u3053\u306e\u3088\u3046\u306a\u72b6\u614b\u3067\u3001DatabaseException\u3068HttpException\u304c\u4e21\u65b9\u767a\u751f\u3059\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u51e6\u7406\u3092Either\u3092\u4f7f\u3063\u3066\u6b21\u306e\u3088\u3046\u306b\u5b9f\u884c\u3057\u305f\u3044\u3068\u3059\u308b\u3002\nval result = for {\n  x <- databaseService(???) // Either[DatabaseException, A]\n  y <- httpService(???)     // Either[HttpException, A]\n} yield ()\n\ndatabaseService\u306fEither[DatabaseException, A]\u3092\u8fd4\u3059\u95a2\u6570\u3067\u3042\u308a\u3001\u4e00\u65b9httpService\u306fEither[HttpException, A]\u3068\u3044\u3046\u578b\u3092\u6301\u3064\u5024\u3092\u8fd4\u3059\u95a2\u6570\u3067\u3042\u308b\u3002\u3057\u304b\u3057\u3001\u3053\u308c\u3089\u306e\u578b\u3092for\u5f0f\u3067\u5408\u6210\u3057\u305f\u7d50\u679c\u306eresult\u306f\u3069\u3046\u3044\u3046\u578b\u306b\u306a\u308b\u3060\u308d\u3046\u304b\u3002\nEither\u306f\u5171\u5909\u306a\u306e\u3067\u3001\u968e\u5c64\u306e\u3088\u308a\u4e0a\u4f4d\u306b\u3042\u308b\u578b\u3078\u3068\u30ad\u30e3\u30b9\u30c8\u3057\u3066\u3044\u304f\u304b\u3089\u3001\u3053\u306e\u5834\u5408result\u306e\u578b\u306fEither[RootException, Unit]\u3068\u306a\u308b\u3002\u3057\u304b\u3057\u3001RootExcepiton\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u3066\u306f\u3001\u3082\u306f\u3084FileExcepion\u3068\u533a\u5225\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3002\n\u305d\u3053\u3067\u3001\u65b0\u305f\u306b\u6b21\u306e\u3088\u3046\u306a\u4f8b\u5916\u3092\u8868\u308f\u3059\u30b1\u30fc\u30b9\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3059\u308b\u3002\ncase class DatabaseAndHttpException(m: String) extends RootException\n\n\u3055\u3066\u3001\u3067\u306f\u3053\u306eDatabaseAndHttpException\u3092\u4f8b\u5916\u306e\u968e\u5c64\u306b\u8ffd\u52a0\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\u305d\u3046\u306a\u308b\u3068\u65e2\u5b58\u306b\u3042\u3063\u305fDatabaseException\u3068HttpException\u3092\u5909\u66f4\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u305a\u3001Expression Problem\u304c\u767a\u751f\u3057\u3066\u3057\u307e\u3046\u3002Expression Problem\u3092\u56de\u907f\u3057\u3066\u3001\u3064\u307e\u308a\u306f\u65e2\u5b58\u306e\u30c7\u30fc\u30bf\u578b\u306b\u5909\u66f4\u3092\u52a0\u3048\u308b\u3053\u3068\u306a\u304f\u3001DatabaseAndHttpException\u3092\u633f\u5165\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u306a\u3044\u3060\u308d\u3046\u304b\u3002\n\n\u30b5\u30d6\u30bf\u30a4\u30d4\u30f3\u30b0\u3068\u578b\u306e\u591a\u69d8\u6027\n\u6b21\u306e\u3088\u3046\u306b\u3001\u4f8b\u5916\u306e\u968e\u5c64\u69cb\u9020\u3092extends\u3092\u7528\u3044\u3066\u4f5c\u6210\u3059\u308b\u304c\u3001\u3053\u308c\u306f\u578b\u306e\u30b5\u30d6\u30bf\u30a4\u30d4\u30f3\u30b0\u3092\u884c\u3063\u3066\u3044\u308b1\u3002\ntrait RootException extends Throwable\n\ncase class DatabaseException(m: String) extends RootException\n\nRootException\n|\n+---- DatabaseException\n\n\u3053\u306e\u3088\u3046\u5834\u5408\u3001DatabaseException\u306fRootException\u306e\u30b5\u30d6\u30bf\u30a4\u30d7\u3067\u3042\u308b\u3068\u8a00\u3044\u3001RootException\u306fDatabaseException\u306eSupertype\u3067\u3042\u308b\u3068\u8a00\u3046\u3002\n\u305d\u3082\u305d\u3082\u3001\u3053\u306e\u3088\u3046\u306a\u4f8b\u5916\uff08\u578b\uff09\u306e\u968e\u5c64\u69cb\u9020\uff08\u30b5\u30d6\u30bf\u30a4\u30d7\u95a2\u4fc2\uff09\u3092\u3069\u3046\u3057\u3066\u4f5c\u308b\u306e\u304b\u3068\u3044\u3046\u3068\u3001\u305d\u308c\u306f\u30b5\u30d6\u30bf\u30a4\u30d4\u30f3\u30b0\u306b\u57fa\u3065\u304f\u591a\u69d8\u6027\u3092\u8868\u73fe\u3057\u305f\u3044\u304b\u3089\u3067\u3042\u308b\u3002\u30b5\u30d6\u30bf\u30a4\u30d4\u30f3\u30b0\u306e\u591a\u69d8\u6027\u306f\u30d7\u30ed\u30b0\u30e9\u30e0\u8a00\u8a9e\u8ad6\u306e\u8cc7\u6599\u306b\u3066\u6b21\u306e\u3088\u3046\u306b\u8aac\u660e\u3055\u308c\u3066\u3044\u308b\u3002\n\n\u578bA\u304c\u578bB\u306esubtype\uff08\u90e8\u5206\u578b\uff09\u306e\u3068\u304d\u3001\u578bB\u306e\u5f0f\u3092\u66f8\u304f\u3079\u304d\u3068\u3053\u308d\u306b\u3001\u578bA\u306e\u5f0f\u3092\u66f8\u3044\u3066\u3082\u826f\u3044\u3002\n\n\u3053\u308c\u3092\u4eca\u56de\u306e\u4f8b\u306b\u3042\u3066\u306f\u3081\u308b\u3068\u3001DatabaseException\u306fRootException\u306e\u30b5\u30d6\u30bf\u30a4\u30d7\u3067\u3042\u308b\u306e\u3067\u3001RootException\u306e\u5f0f\u3092\u66f8\u304f\u3079\u304d\u3068\u3053\u308d\u306b\u3001DatabaseException\u3092\u66f8\u3044\u3066\u3082\u3088\u3044\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308b\u3002\u307e\u305f\u3001HttpException\u3082RootException\u306e\u30b5\u30d6\u30bf\u30a4\u30d7\u3067\u3042\u308b\u306e\u3067\u3001RootException\u306e\u5f0f\u3092\u66f8\u304f\u3079\u304d\u3068\u3053\u308d\u306b\u3001HttpException\u306e\u5f0f\u3092\u66f8\u3044\u3066\u3082\u3088\u3044\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308b\u3002\nEither[DatabaseException, A]\u3068Either[HttpException, A]\u306f\u5de6\u5074\u306e\u578b\u304c\u7570\u306a\u308a\u3001\u901a\u5e38\u5408\u6210\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u304c\u3001\u30b5\u30d6\u30bf\u30a4\u30d7\u95a2\u4fc2\u3092\u4f7f\u3044DatabaseException\u3068HttpException\u3092\u5171\u306bRootException\u306e\u5f0f\u3068\u307f\u306a\u3059\u3053\u3068\u3067\u3001Either[RootException, A]\u3068\u3057\u3066\u5408\u6210\u304c\u53ef\u80fd\u306b\u306a\u308b\u3002\n\u3053\u306e\u3088\u3046\u306b\u3001\u4f8b\u5916\u306e\u968e\u5c64\u69cb\u9020\u306f\u30b5\u30d6\u30bf\u30a4\u30d4\u30f3\u30b0\u3068\u3044\u3046\u578b\u30b7\u30b9\u30c6\u30e0\u306e\u529b\u3092\u4f7f\u3063\u3066\u884c\u308f\u308c\u3066\u3044\u308b\u3002\u3057\u304b\u3057\u3001\u3053\u306e\u307e\u307e\u3067\u306f\u6700\u521d\u554f\u984c\u306b\u3057\u305f\u3088\u3046\u306b\u3001\u968e\u5c64\u69cb\u9020\u306e\u81ea\u7531\u306a\u5834\u6240\u306b\u65b0\u305f\u306a\u4f8b\u5916\u3092\u52a0\u3048\u3088\u3046\u3068\u3059\u308b\u3068\u3001\u578b\u306e\u968e\u5c64\u3092\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067Expression Problem\u304c\u767a\u751f\u3057\u3066\u3057\u307e\u3046\u3002\n\n\u578b\u30af\u30e9\u30b9\u306b\u3088\u308b\u5b89\u5168\u306a\u30ad\u30e3\u30b9\u30c8\n\u901a\u5e38\u3001\u578b\u3092\u5f37\u5f15\u306b\u5909\u66f4\u3059\u308basInstanceOf\u306a\u3069\u3092\u7528\u3044\u305f\uff08\u30c0\u30a6\u30f3\uff09\u30ad\u30e3\u30b9\u30c8\u306f\u5371\u967a\u3067\u3042\u308a\u3001\u884c\u3046\u3079\u304d\u3067\u306f\u306a\u3044\u3002\u3057\u304b\u3057\u3001\u5b89\u5168\u306b\u3042\u308b\u578b\u304b\u3089\u5225\u306e\u578b\u3078\u5909\u63db\u3059\u308b\u65b9\u6cd5\u304c\u306a\u3044\u304b\u3068\u3044\u3046\u3068\u3001\u305d\u3046\u3067\u3082\u306a\u3044\u3002\u4f8b\u3048\u3070Int\u304b\u3089String\u3078\u30ad\u30e3\u30b9\u30c8\u3059\u308b\u95a2\u6570\u306f\u6b21\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3067\u304d\u308b\u3002\ndef string_of_int(i: Int): String = i.toString\n\n\u3053\u306e\u3088\u3046\u306b\u3001\u30e6\u30fc\u30b6\u30fc\u304c\u5b9a\u7fa9\u3057\u305f\u30ad\u30e3\u30b9\u30c8\u95a2\u6570\u306a\u3089\u3070\u3001\u30b5\u30d6\u30bf\u30a4\u30d7\u95a2\u4fc2\u304c\u306a\u3044\u5834\u5408\u3067\u3082\u5b89\u5168\u306b\u30ad\u30e3\u30b9\u30c8\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3002\u3053\u306e\u3088\u3046\u306a\u3042\u308b\u578bA\u304b\u3089\u578bB\u3078\u306e\u30ad\u30e3\u30b9\u30c8\u3092\u30e6\u30fc\u30b6\u30fc\u304c\u63d0\u4f9b\u3057\u3066\u3044\u308b\u3068\u3044\u3046\u60c5\u5831\u3092\u578b\u30af\u30e9\u30b9\u3068\u3057\u3066\u6b21\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3059\u308b\u3002\n\nTransform.scala\ntrait :->[A, B] {\n  def cast(a: A): B\n}\n\n\n\u4f8b\u3048\u3070Int :-> Float\u3068\u3044\u3046\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\uff08impliit\u30d1\u30e9\u30e1\u30fc\u30bf\uff09\u304c\u3042\u308c\u3070\u3001Int\u304b\u3089Float\u3078\u5b89\u5168\u306b\u30ad\u30e3\u30b9\u30c8\u3059\u308b\u305f\u3081\u306e\u95a2\u6570cast\u304c\u5b58\u5728\u3059\u308b\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308b\u3002\nimplicit val float_of_int = new :->[Int, Float] {\n  def cast(a: Int): Float = a.toFloat\n}\n\n\u3053\u308c\u3092\u7528\u3044\u3066\u4f8b\u5916\u306e\u968e\u5c64\u69cb\u9020\u3092\u62e1\u5f35\u53ef\u80fd\u306a\u5f62\u3067\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\nimplicit\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u63a2\u7d22\u9806\u5e8f\n\u672c\u984c\u306b\u5165\u308b\u524d\u306b\u3001Scala\u306eimplicit\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u3069\u306e\u3088\u3046\u306b\u63a2\u7d22\u3055\u308c\u308b\u306e\u304b\u77e5\u3063\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\nScala\u306f\u6b21\u306e\u9806\u5e8f\u3067\u578b\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\uff08implicit\u30d1\u30e9\u30e1\u30fc\u30bf\uff09\u3092\u63a2\u7d22\u3059\u308b\u3002\n\n\u73fe\u5728\u306e\u30b9\u30b3\u30fc\u30d7\n\u578b\u30af\u30e9\u30b9\u306b\u6295\u5165\u3055\u308c\u305f\u578b\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u30b3\u30f3\u30d1\u30cb\u30aa\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n\u578b\u30af\u30e9\u30b9\u306b\u6295\u5165\u3055\u308c\u305f\u578b\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u30b9\u30fc\u30d1\u30fc\u30af\u30e9\u30b9\u306e\u30b3\u30f3\u30d1\u30cb\u30aa\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n\u578b\u30af\u30e9\u30b9\u306e\u30b3\u30f3\u30d1\u30cb\u30aa\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n\n\nScala\u306f\u307e\u305a\uff081\uff09\u304b\u3089\u9806\u756a\u306bimplicit\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u63a2\u7d22\u3057\u3001\u898b\u3064\u304b\u3063\u305f\u6642\u70b9\u3067\u63a2\u7d22\u3092\u6253\u3061\u5207\u308b\u3002\n\n\u4f8b\u5916\u306e\u62e1\u5f35\n\u3055\u3066\u3001\u5b89\u5168\u306a\u30ad\u30e3\u30b9\u30c8A :-> B\u3092\u7528\u3044\u3066\u4f8b\u5916\u306e\u968e\u5c64\u3092\u5b9a\u7fa9\u3059\u308b\u3068\u306f\u3069\u3046\u3044\u3046\u3053\u3068\u3060\u308d\u3046\u304b\u3002\u5148\u7a0b\u306e\u4f8b\u3092\u518d\u3073\u632f\u308a\u66ff\u3048\u308b\u3068\u3001\u4eca\u3001DatabaseException\u3068HttpException\u306e\u4e8c\u3064\u3092\u62bd\u8c61\u5316\u3057\u305f\u3088\u3046\u306aDatabaseAndHttpException\u3068\u3044\u3046\u4f8b\u5916\u3092\u4f5c\u308b\u3053\u3068\u3067\u6b21\u306efor\u5f0f\u306e\u7d50\u679c\u3092Either[DatabaseAndHttpException, Unit]\u306e\u3088\u3046\u306b\u3057\u305f\u3044\u3002\nfor {\n  x <- databaseService(???) // Either[DatabaseException, A]\n  y <- httpService(???)     // Either[HttpException, A]\n} yield ()\n\n\u305d\u3053\u3067\u307e\u305a\u3001\u65e2\u5b58\u306e\u578b\u3092\u5909\u66f4\u305b\u305aDatabaseAndHttpException\u3092\u5b9a\u7fa9\u3059\u308b\u3002\ncase class DatabaseAndHttpException(m: String) extends RootException\n\n\u578b\u306e\u30b5\u30d6\u30bf\u30a4\u30d7\u95a2\u4fc2\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u3002\nRootException\n|\n+---- DatabaseException\n|\n+---- HttpException\n|\n+---- FileException\n|     |\n|     +---- ReadException\n|     |\n|     +---- WriteException\n|\n+---- DatabaseAndHttpException\n\n\u305d\u3057\u3066\u3001DatabaseException\u304b\u3089DatabaseAndHttpException\u3078\u306e\u30ad\u30e3\u30b9\u30c8\u3068\u3001HttpException\u304b\u3089DatabaseAndHttpException\u3078\u306e\u30ad\u30e3\u30b9\u30c8\u3092\u305d\u308c\u305e\u308c\u6b21\u306e\u3088\u3046\u306bDatabaseAndHttpException\u306e\u30b3\u30f3\u30d1\u30cb\u30aa\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u5b9a\u7fa9\u3059\u308b\u3002\n\nDatabaseAndHttpException.scala\nobject DatabaseAndHttpException {\n  implicit val databaseException = new :->[DatabaseException, DatabaseAndHttpException] {\n    def cast(a: DatabaseException): DatabaseAndHttpException =\n      DatabaseAndHttpException(s\"database: ${a.m}\")\n  }\n\n  implicit val httpException = new :->[HttpException, DatabaseAndHttpException] {\n    def cast(a: HttpException): DatabaseAndHttpException =\n      DatabaseAndHttpException(s\"http: ${a.m}\")\n  }\n}\n\n\n\u3055\u3066\u3001\u6b21\u306fEither\u306emap\u3068flatMap\u3092\u6539\u9020\u3059\u308b\u3002\u3053\u308c\u306b\u306fScala\u306ePimp my Library Pattern\u3092\u7528\u3044\u308b2\u3002\n\nImplicit.scala\nobject Implicit {\n  implicit class ExceptionEither[L <: RootException, R](val ee: Either[L, R]) {\n    def map[L2 <: RootException, R2](f: R => R2)(implicit L2: L :-> L2): Either[L2, R2] = ee match {\n      case Left(e)  => Left(L2.cast(e))\n      case Right(v) => Right(f(v))\n    }\n\n    def flatMap[L2 <: RootException, R2](f: R => Either[L2, R2])(implicit L2: L :-> L2): Either[L2, R2] = ee match {\n      case Left(e)  => Left(L2.cast(e))\n      case Right(v) => f(v)\n    }\n\n    def as[L2 <: RootException](implicit L2: L :-> L2): Either[L2, R] = ee match {\n      case Left(e)  => Left(L2.cast(e))\n      case Right(v) => Right(v)\n    }\n  }\n}\n\n\n\u3053\u306e\u3088\u3046\u306b\u3001map\u3068flatMap\u306e\u5b9a\u7fa9\u3092\u5909\u66f4\u3057\u3066\u3001Either[L, R]\u3092\u53d7\u3051\u53d6\u308a\u3001L :-> L2\u3068\u3044\u3046implicit\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u63a2\u7d22\u3057\u3066\u3001\u5b58\u5728\u3057\u305f\u5834\u5408\u306fimplicit\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u7528\u3044\u3066Either[L2, R2]\u3092\u8fd4\u3059\u3068\u3044\u3046\u95a2\u6570\u306b\u5909\u66f4\u3057\u3066\u3044\u308b\u3002\n\u3055\u3063\u305d\u304f\u3053\u308c\u3092\u8a66\u3057\u3066\u307f\u3088\u3046\u3002\ndef left[A](e: A) = Left[A, Unit](e)\n\nval e1 = left(DatabaseException(\"db error\"))\nval e2 = left(HttpException(\"http error\"))\n\nval e3 = for {\n  a <- e1\n  b <- e2\n} yield ()\n\n\u3057\u304b\u3057\u3001\u3053\u308c\u306f\u6b21\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u3067\u30b3\u30f3\u30d1\u30a4\u30eb\u306b\u5931\u6557\u3057\u3066\u3057\u307e\u3046\u3002\nError:(18, 9) could not find implicit value for parameter L2: utils.:->[utils.DatabaseException,utils.HttpException]\n      a <- e1\n        ^\n\nDatabaseAndHttpException\u306f\u578b\u3068\u3057\u3066DatabaseException\u3084HttpException\u3068\u968e\u5c64\u95a2\u4fc2\u306b\u306a\u3044\u306e\u3067\u3001Scala\u306e\u51e6\u7406\u7cfb\u306fDatabaseAndHttpException\u3078implicit\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u63a2\u7d22\u3092\u8a66\u307f\u306a\u3044\u3002\u305d\u3053\u3067\u3001\u5148\u7a0bmap\u3084flatMap\u3068\u5171\u306b\u5b9a\u7fa9\u3057\u305fas\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3063\u3066\u660e\u793a\u7684\u306b\u5b89\u5168\u306a\u30ad\u30e3\u30b9\u30c8\u3092\u884c\u3063\u3066\u3084\u308b\u3068\u4e0a\u624b\u304f\u3044\u304f\u3002\nval e3 = for {\n  a <- e1\n  b <- e2.as[DatabaseAndHttpException]\n} yield ()\n\n\u3053\u306e\u3088\u3046\u306b\u3059\u308b\u3068\u3001e2\u306fEither[HttpException, Unit]\u306a\u306e\u3067as\u306fHtttException :-> DatabaseAndHttpException\u306eimplicit\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u63a2\u7d22\u3059\u308b\u3002\u578b\u30af\u30e9\u30b9:->\u306e\u578b\u30d1\u30e9\u30e1\u30fc\u30bf\u306bDatabaseAndHttpException\u304c\u3042\u308b\u306e\u3067\u3001DatabaseAndHttpException\u306e\u30b3\u30f3\u30d1\u30cb\u30aa\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u63a2\u7d22\u5bfe\u8c61\u306b\u5165\u308a\u3001\u7121\u4e8b\u306bimplicit\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u898b\u3064\u304b\u308b\u3002\n\u3053\u306e\u3088\u3046\u306b\u3001implicit\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3088\u3063\u3066\u5909\u63db\u53ef\u80fd\u306a\u4f8b\u5916\u540c\u58eb\u306e\u6709\u5411\u30b0\u30e9\u30d5\u3092\u4f5c\u308b\u3053\u3068\u3067\u3001\u30b5\u30d6\u30bf\u30a4\u30d7\u95a2\u4fc2\u3092\u4f7f\u308f\u305a\u5b89\u5168\u306b\u5225\u306e\u578b\u3078\u5909\u63db\u3057\u3066\u53d6\u308a\u6271\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n\u65e2\u5b58\u306e\u4f8b\u5916\u968e\u5c64\u3068\u306e\u4e92\u63db\u6027\n\u4eca\u306e\u6642\u70b9\u3067\u3001\u30b5\u30d6\u30bf\u30a4\u30d7\u95a2\u4fc2\u306b\u3088\u308b\u4f8b\u5916\u306e\u968e\u5c64\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u3002\nRootException\n|\n+---- DatabaseException\n|\n+---- HttpException\n|\n+---- FileException\n|     |\n|     +---- ReadException\n|     |\n|     +---- WriteException\n|\n+---- DatabaseAndHttpException\n\n\u3053\u306e\u968e\u5c64\u3092\u4eca\u304b\u3089:->\u306b\u3088\u3063\u3066\u5168\u90e8\u5b9a\u7fa9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3068\u3057\u305f\u3089\u3001\u305d\u308c\u306f\u5927\u5909\u3067\u3042\u308b\u3002\u3053\u3053\u304b\u3089\u306f\u30b5\u30d6\u30bf\u30a4\u30d7\u95a2\u4fc2\u3092\u7528\u3044\u3066\u69cb\u7bc9\u3057\u305f\u4f8b\u5916\u306e\u968e\u5c64\u69cb\u9020\u3068\u3001\u4eca\u56de\u5c0e\u5165\u3057\u305f\u968e\u5c64\u69cb\u9020\u306e\u4e92\u63db\u6027\u3092\u898b\u3066\u3044\u304f\u3002\n\n\u81ea\u5206\u81ea\u8eab\u3068\u306e\u4e92\u63db\u6027\n\u3068\u3053\u308d\u3067\u3001\u73fe\u72b6\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u30b5\u30d6\u30bf\u30a4\u30d7\u95a2\u4fc2\u3092\u5168\u304f\u7121\u8996\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u4f8b\u3048\u3070\u6b21\u306e\u3088\u3046\u306afor\u5f0f\u304c\u30a8\u30e9\u30fc\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u3002\nval e4 = for {\n  a <- e1\n} yield ()\n\nError:(20, 9) could not find implicit value for parameter L2: utils.:->[utils.DatabaseException,L2]\n      a <- e1\n        ^\n\n\u306a\u305c\u3053\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\u304b\u3068\u3044\u3046\u3068\u3001map\u884c\u3046\u305f\u3081\u306b\u306f\u4f8b\u3048\u4f55\u304b\u9069\u5f53\u306a\u578bL\u306b\u3088\u308bEither[L, ?]\u304b\u3089Either[L, ?]\u3078\u306emap\u3067\u3042\u3063\u3066\u3082L :-> L\u3068\u306a\u308bimplicit\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u5fc5\u8981\u3067\u3042\u308a\u3001\u305d\u308c\u304c\u306a\u3044\u306e\u3067\u30a8\u30e9\u30fc\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u3002\u3053\u306e\u3088\u3046\u306a\u9069\u5f53\u306a\u578bL\u304b\u3089L\u3078\u30ad\u30e3\u30b9\u30c8\u3059\u308b\u306e\u306f\u3001L\u304c\u3069\u306e\u3088\u3046\u306a\u578b\u3067\u3042\u3063\u305f\u3068\u3057\u3066\u3082\u6b21\u306e\u3088\u3046\u306b\u66f8\u3051\u308b3\u3002\nimplicit def self[A]= new :->[A, A] {\n  def cast(a: A): A = a\n}\n\n\u3055\u3066\u3001\u3053\u306eimplicit\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u7f6e\u304f\u306e\u306b\u9069\u3057\u305f\u5834\u6240\u306f\u3069\u3053\u304b\u3068\u3044\u3046\u3068\u3001\u305d\u308c\u306fimplicit\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u63a2\u7d22\u9806\u4f4d\u304c\u4f4e\u3044:->\u306e\u30b3\u30f3\u30d1\u30cb\u30aa\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u4e2d\u3060\u308d\u3046\u3002\n\nTransform.scala\nobject :-> {\n  implicit def self[A] = new :->[A, A] {\n    def cast(a: A): A = a\n  }\n}\n\n\n\u3053\u306e\u3088\u3046\u306b\u3059\u308b\u3053\u3068\u3067\u30b3\u30f3\u30d1\u30a4\u30eb\u3092\u901a\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n\u30b5\u30d6\u30bf\u30a4\u30d7\u95a2\u4fc2\u306b\u3088\u308b\u968e\u5c64\u3068\u306e\u4e92\u63db\u6027\nFileException\u306f\u6b21\u306e\u3088\u3046\u306b\u30b5\u30d6\u30bf\u30a4\u30d7\u95a2\u4fc2\u3092\u5229\u7528\u3057\u305f\u968e\u5c64\u3092\u6301\u3064\u4f8b\u5916\u3067\u3042\u308b\u3002\ntrait FileException extends RootException\n\ncase class ReadException(m: String) extends FileException\n\ncase class WriteException(m: String) extends FileException\n\nRootException\n|\n+---- FileException\n      |\n      +---- ReadException\n      |\n      +---- WriteException\n\n\u3053\u308c\u3089\u3092\u6301\u3064Either\u3092for\u3067\u6b21\u306e\u3088\u3046\u306b\u307e\u3068\u3081\u308b\u3053\u3068\u306f\u3067\u304d\u308b\u3060\u308d\u3046\u304b\u3002\nval e5 = left(ReadException(\"file read error\"))\nval e6 = left(WriteException(\"file read error\"))\n\nval e7 = for {\n  a <- e5\n  b <- e6\n} yield ()\n\n\u6b21\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u3066\u3057\u307e\u3046\u3002\nError:(29, 9) could not find implicit value for parameter L2: utils.:->[utils.ReadException,utils.WriteException]\n      a <- e5\n        ^\n\n\u3053\u308c\u306f\u5148\u307b\u3069\u3001DatabaseAndHttpException\u3067\u51fa\u73fe\u3057\u305f\u30a8\u30e9\u30fc\u3068\u540c\u3058\u306a\u306e\u3067\u3001as\u30e1\u30bd\u30c3\u30c9\u3067\u6b21\u306e\u3088\u3046\u306b\u3059\u308c\u3070\u89e3\u6c7a\u3067\u304d\u305d\u3046\u306b\u601d\u3048\u308b\u3002\nval e7 = for {\n  a <- e5\n  b <- e6.as[FileException]\n} yield ()\n\n\u3057\u304b\u3057\u3001\u3053\u308c\u3082\u6b21\u306e\u3088\u3046\u306a\u30b3\u30f3\u30d1\u30a4\u30eb\u30a8\u30e9\u30fc\u3068\u306a\u308b\u3002\nError:(30, 17) could not find implicit value for parameter L2: utils.:->[utils.WriteException,utils.FileException]\n      b <- e6.as[FileException]\n                ^\n\n\u3069\u3046\u3084\u3089\u3001WriteException :-> FileException\u3068\u3044\u3046implicit\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u767a\u898b\u3067\u304d\u306a\u304b\u3063\u305f\u3088\u3046\u3060\u3002\u305f\u3060\u3001\u3053\u306e\u3088\u3046\u306b\u30b5\u30d6\u30bf\u30a4\u30d7\u95a2\u4fc2\u304c\u3042\u308b\u5834\u5408\u306f\u3053\u306eWriteException\u3084FileException\u306b\u9650\u3089\u305a\u6b21\u306e\u3088\u3046\u306aimplicit\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\nimplicit def superclass[A, B >: A] = new :->[A, B] {\n  def cast(a: A): B = a\n}\n\n\u3053\u306e\u5b9a\u7fa9\u3092\u3088\u304f\u898b\u308b\u3068\u3001\u578b\u30d1\u30e9\u30e1\u30fc\u30bfB\u304cA\u3067\u3042\u3063\u305f\u6642\u306f\u3001\u5148\u307b\u3069\u5b9a\u7fa9\u3057\u305fimplicit\u30d1\u30e9\u30e1\u30fc\u30bfself\u3068\u540c\u3058\u632f\u308b\u821e\u3044\u3092\u3059\u308b\u3068\u3044\u3046\u3053\u3068\u304c\u660e\u3089\u304b\u3067\u3042\u308b4\u3002\u3088\u3063\u3066:->\u306e\u30b3\u30f3\u30d1\u30cb\u30aa\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u306f\u3053\u306esuperclass\u3060\u3051\u3092\u8a2d\u7f6e\u3059\u308b\u3002\n\nTransform.scala\nobject :-> {\n  implicit def superclass[A, B >: A] = new :->[A, B] {\n    def cast(a: A): B = a\n  }\n}\n\n\n\u3053\u306e\u3088\u3046\u306b\u3059\u308c\u3070\u3001\u6b21\u306e\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\nval e7 = for {\n  a <- e5\n  b <- e6.as[FileException]\n} yield ()\n\n\n\u307e\u3068\u3081\n\u5b89\u5168\u306a\u30ad\u30e3\u30b9\u30c8\u3092\u63d0\u4f9b\u3059\u308b\u578b\u30af\u30e9\u30b9\u3092\u7528\u3044\u308b\u3088\u3046\u306bEither\u306emap\u3084flatMap\u3092\u6539\u9020\u3059\u308b\u3053\u3068\u3067\u3001\u4f8b\u5916\u306e\u968e\u5c64\u69cb\u9020\u3092\u30a2\u30c9\u30db\u30c3\u30af\u306b\u69cb\u7bc9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\u3053\u306e\u65b9\u6cd5\u306f\u4e0b\u8a18\u306e\u8ad6\u6587\u3092\u8aad\u307f\u3064\u3064\u8003\u3048\u305f\u3082\u306e\u306a\u306e\u3067\u3001\u65e2\u306b\u8ab0\u304b\u304c\u3088\u308a\u3088\u3044\u65b9\u6cd5\u3092\u767a\u8868\u3057\u3066\u3044\u308b\u53ef\u80fd\u6027\u3082\u3042\u308b\u3002\u3082\u3057\u60c5\u5831\u3092\u3054\u5b58\u77e5\u306e\u65b9\u306fQiita\u306e\u30b3\u30e1\u30f3\u30c8\u306a\u3069\u3067\u9023\u7d61\u3057\u3066\u6b32\u3057\u3044\u3002\n\n\u53c2\u8003\u6587\u732e\n\nAn Extensible Dynamically-Typed Hierarchy of Exceptions\n\n\n\n\n\n\u30b5\u30d6\u30bf\u30a4\u30d4\u30f3\u30b0\u3068\u7d99\u627f\u306e\u9055\u3044\u306b\u3064\u3044\u3066\u306f\u5272\u611b\u3059\u308b\u304c\u3001\u4e00\u822c\u7684\u306b\u5fc5\u305a\u3057\u3082\u4e00\u81f4\u3057\u306a\u3044\u306e\u3067\u3001\u3053\u3053\u3067\u306f\u30b5\u30d6\u30bf\u30a4\u30d4\u30f3\u30b0\u3068\u3044\u3046\u578b\u306e\u95a2\u4fc2\u306b\u306e\u307f\u6ce8\u76ee\u3059\u308b\u3002\u00a0\u21a9\n\n\n\u3053\u3053\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u8b0e\u306e\u30e1\u30bd\u30c3\u30c9as\u306b\u3064\u3044\u3066\u306f\u5f8c\u8ff0\u3059\u308b\u3002\u00a0\u21a9\n\n\n\u3053\u306e\u30e1\u30bd\u30c3\u30c9self\u3067\u306f\u578b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092L\u3067\u306f\u306a\u304fA\u3068\u3057\u3066\u3044\u308b\u304c\u3001\u610f\u5473\u7684\u306b\u306f\u5909\u308f\u308a\u306a\u3044\u3002\u00a0\u21a9\n\n\n\u3053\u306e\u6642\u3001\u4efb\u610f\u306e\u578bA\u306fA >: A\u3092\u6e80\u3059\u3002\u00a0\u21a9\n\n\n\n# \u7d9a\u7de8\u3092\u66f8\u304d\u307e\u3057\u305f\n\n[The Missing Method of Extensible Exception: implicit \u201ctransitive\u201d](http://qiita.com/yyu/items/2f1a3b0fdea6251d7f64)\n\n# \u306f\u3058\u3081\u306b\n\n> \u6ce8\u610f\uff1a\n> \u8a18\u4e8b\u306e\u4e2d\u306b\u3042\u308b\u30b3\u30fc\u30c9\u306f\u8aad\u307f\u3084\u3059\u3055\u306e\u305f\u3081\u306b`import`\u306a\u3069\u3092\u7701\u7565\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u306e\u307e\u307e\u3067\u306f\u52d5\u304b\u306a\u3044\u3002\u52d5\u304b\u3057\u305f\u3044\u65b9\u306f[Github\u306e\u30ea\u30dd\u30b8\u30c8\u30ea](https://github.com/y-yu/ExtensibleException)\u3092\u4f7f\u3046\u3068\u3088\u3044\u3002\n\nScala\u3067\u4f8b\u5916\u3092\u53d6\u308a\u6271\u3046\u969b\u306b\u306f\u3001\u4e00\u822c\u7684\u306b\u30c7\u30fc\u30bf\u578b\u3092\u4f7f\u3063\u3066\u6b21\u306e\u3088\u3046\u306b\u4f8b\u5916\u306e\u968e\u5c64\u69cb\u9020\u3092\u8a2d\u8a08\u3059\u308b\u3002\n\n```scala\ntrait RootException extends Throwable\n\ncase class DatabaseException(m: String) extends RootException\n\ncase class HttpException(m: String) extends RootException\n\ntrait FileException extends RootException\n\ncase class ReadException(m: String) extends FileException\n\ncase class WriteException(m: String) extends FileException\n```\n\n\u3053\u308c\u306f\u6b21\u306e\u3088\u3046\u306a\u968e\u5c64\u69cb\u9020\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n```\nRootException\n|\n+---- DatabaseException\n|\n+---- HttpException\n|\n+---- FileException\n      |\n      +---- ReadException\n      |\n      +---- WriteException\n```\n\n\u3053\u306e\u3088\u3046\u306a\u72b6\u614b\u3067\u3001`DatabaseException`\u3068`HttpException`\u304c\u4e21\u65b9\u767a\u751f\u3059\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u51e6\u7406\u3092`Either`\u3092\u4f7f\u3063\u3066\u6b21\u306e\u3088\u3046\u306b\u5b9f\u884c\u3057\u305f\u3044\u3068\u3059\u308b\u3002\n\n```scala\nval result = for {\n  x <- databaseService(???) // Either[DatabaseException, A]\n  y <- httpService(???)     // Either[HttpException, A]\n} yield ()\n```\n\n`databaseService`\u306f`Either[DatabaseException, A]`\u3092\u8fd4\u3059\u95a2\u6570\u3067\u3042\u308a\u3001\u4e00\u65b9`httpService`\u306f`Either[HttpException, A]`\u3068\u3044\u3046\u578b\u3092\u6301\u3064\u5024\u3092\u8fd4\u3059\u95a2\u6570\u3067\u3042\u308b\u3002\u3057\u304b\u3057\u3001\u3053\u308c\u3089\u306e\u578b\u3092`for`\u5f0f\u3067\u5408\u6210\u3057\u305f\u7d50\u679c\u306e`result`\u306f\u3069\u3046\u3044\u3046\u578b\u306b\u306a\u308b\u3060\u308d\u3046\u304b\u3002\n`Either`\u306f[\u5171\u5909](http://qiita.com/mtoyoshi/items/bd0ad545935225419327)\u306a\u306e\u3067\u3001\u968e\u5c64\u306e\u3088\u308a\u4e0a\u4f4d\u306b\u3042\u308b\u578b\u3078\u3068\u30ad\u30e3\u30b9\u30c8\u3057\u3066\u3044\u304f\u304b\u3089\u3001\u3053\u306e\u5834\u5408`result`\u306e\u578b\u306f`Either[RootException, Unit]`\u3068\u306a\u308b\u3002\u3057\u304b\u3057\u3001`RootExcepiton`\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u3066\u306f\u3001\u3082\u306f\u3084`FileExcepion`\u3068\u533a\u5225\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3002\n\u305d\u3053\u3067\u3001\u65b0\u305f\u306b\u6b21\u306e\u3088\u3046\u306a\u4f8b\u5916\u3092\u8868\u308f\u3059\u30b1\u30fc\u30b9\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n```scala\ncase class DatabaseAndHttpException(m: String) extends RootException\n```\n\n\u3055\u3066\u3001\u3067\u306f\u3053\u306e`DatabaseAndHttpException`\u3092\u4f8b\u5916\u306e\u968e\u5c64\u306b\u8ffd\u52a0\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\u305d\u3046\u306a\u308b\u3068\u65e2\u5b58\u306b\u3042\u3063\u305f`DatabaseException`\u3068`HttpException`\u3092\u5909\u66f4\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u305a\u3001[Expression Problem](http://maoe.hatenadiary.jp/entry/20101214/1292337923)\u304c\u767a\u751f\u3057\u3066\u3057\u307e\u3046\u3002Expression Problem\u3092\u56de\u907f\u3057\u3066\u3001\u3064\u307e\u308a\u306f\u65e2\u5b58\u306e\u30c7\u30fc\u30bf\u578b\u306b\u5909\u66f4\u3092\u52a0\u3048\u308b\u3053\u3068\u306a\u304f\u3001`DatabaseAndHttpException`\u3092\u633f\u5165\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u306a\u3044\u3060\u308d\u3046\u304b\u3002\n\n# \u30b5\u30d6\u30bf\u30a4\u30d4\u30f3\u30b0\u3068\u578b\u306e\u591a\u69d8\u6027\n\n\u6b21\u306e\u3088\u3046\u306b\u3001\u4f8b\u5916\u306e\u968e\u5c64\u69cb\u9020\u3092`extends`\u3092\u7528\u3044\u3066\u4f5c\u6210\u3059\u308b\u304c\u3001\u3053\u308c\u306f\u578b\u306e**\u30b5\u30d6\u30bf\u30a4\u30d4\u30f3\u30b0**\u3092\u884c\u3063\u3066\u3044\u308b[^subtyping_vs_inheritance]\u3002\n\n[^subtyping_vs_inheritance]: \u30b5\u30d6\u30bf\u30a4\u30d4\u30f3\u30b0\u3068\u7d99\u627f\u306e\u9055\u3044\u306b\u3064\u3044\u3066\u306f\u5272\u611b\u3059\u308b\u304c\u3001\u4e00\u822c\u7684\u306b\u5fc5\u305a\u3057\u3082\u4e00\u81f4\u3057\u306a\u3044\u306e\u3067\u3001\u3053\u3053\u3067\u306f\u30b5\u30d6\u30bf\u30a4\u30d4\u30f3\u30b0\u3068\u3044\u3046\u578b\u306e\u95a2\u4fc2\u306b\u306e\u307f\u6ce8\u76ee\u3059\u308b\u3002\n\n```scala\ntrait RootException extends Throwable\n\ncase class DatabaseException(m: String) extends RootException\n```\n\n```\nRootException\n|\n+---- DatabaseException\n```\n\n\u3053\u306e\u3088\u3046\u5834\u5408\u3001`DatabaseException`\u306f`RootException`\u306e\u30b5\u30d6\u30bf\u30a4\u30d7\u3067\u3042\u308b\u3068\u8a00\u3044\u3001`RootException`\u306f`DatabaseException`\u306eSupertype\u3067\u3042\u308b\u3068\u8a00\u3046\u3002\n\u305d\u3082\u305d\u3082\u3001\u3053\u306e\u3088\u3046\u306a\u4f8b\u5916\uff08\u578b\uff09\u306e\u968e\u5c64\u69cb\u9020\uff08\u30b5\u30d6\u30bf\u30a4\u30d7\u95a2\u4fc2\uff09\u3092\u3069\u3046\u3057\u3066\u4f5c\u308b\u306e\u304b\u3068\u3044\u3046\u3068\u3001\u305d\u308c\u306f\u30b5\u30d6\u30bf\u30a4\u30d4\u30f3\u30b0\u306b\u57fa\u3065\u304f**\u591a\u69d8\u6027**\u3092\u8868\u73fe\u3057\u305f\u3044\u304b\u3089\u3067\u3042\u308b\u3002\u30b5\u30d6\u30bf\u30a4\u30d4\u30f3\u30b0\u306e\u591a\u69d8\u6027\u306f[\u30d7\u30ed\u30b0\u30e9\u30e0\u8a00\u8a9e\u8ad6\u306e\u8cc7\u6599](http://logic.cs.tsukuba.ac.jp/~kam/lecture/plm2011/8-web.pdf)\u306b\u3066\u6b21\u306e\u3088\u3046\u306b\u8aac\u660e\u3055\u308c\u3066\u3044\u308b\u3002\n\n> \u578bA\u304c\u578bB\u306esubtype\uff08\u90e8\u5206\u578b\uff09\u306e\u3068\u304d\u3001\u578bB\u306e\u5f0f\u3092\u66f8\u304f\u3079\u304d\u3068\u3053\u308d\u306b\u3001\u578bA\u306e\u5f0f\u3092\u66f8\u3044\u3066\u3082\u826f\u3044\u3002\n\n\u3053\u308c\u3092\u4eca\u56de\u306e\u4f8b\u306b\u3042\u3066\u306f\u3081\u308b\u3068\u3001`DatabaseException`\u306f`RootException`\u306e\u30b5\u30d6\u30bf\u30a4\u30d7\u3067\u3042\u308b\u306e\u3067\u3001`RootException`\u306e\u5f0f\u3092\u66f8\u304f\u3079\u304d\u3068\u3053\u308d\u306b\u3001`DatabaseException`\u3092\u66f8\u3044\u3066\u3082\u3088\u3044\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308b\u3002\u307e\u305f\u3001`HttpException`\u3082`RootException`\u306e\u30b5\u30d6\u30bf\u30a4\u30d7\u3067\u3042\u308b\u306e\u3067\u3001`RootException`\u306e\u5f0f\u3092\u66f8\u304f\u3079\u304d\u3068\u3053\u308d\u306b\u3001`HttpException`\u306e\u5f0f\u3092\u66f8\u3044\u3066\u3082\u3088\u3044\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308b\u3002\n`Either[DatabaseException, A]`\u3068`Either[HttpException, A]`\u306f\u5de6\u5074\u306e\u578b\u304c\u7570\u306a\u308a\u3001\u901a\u5e38\u5408\u6210\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u304c\u3001\u30b5\u30d6\u30bf\u30a4\u30d7\u95a2\u4fc2\u3092\u4f7f\u3044`DatabaseException`\u3068`HttpException`\u3092\u5171\u306b`RootException`\u306e\u5f0f\u3068\u307f\u306a\u3059\u3053\u3068\u3067\u3001`Either[RootException, A]`\u3068\u3057\u3066\u5408\u6210\u304c\u53ef\u80fd\u306b\u306a\u308b\u3002\n\u3053\u306e\u3088\u3046\u306b\u3001\u4f8b\u5916\u306e\u968e\u5c64\u69cb\u9020\u306f\u30b5\u30d6\u30bf\u30a4\u30d4\u30f3\u30b0\u3068\u3044\u3046\u578b\u30b7\u30b9\u30c6\u30e0\u306e\u529b\u3092\u4f7f\u3063\u3066\u884c\u308f\u308c\u3066\u3044\u308b\u3002\u3057\u304b\u3057\u3001\u3053\u306e\u307e\u307e\u3067\u306f\u6700\u521d\u554f\u984c\u306b\u3057\u305f\u3088\u3046\u306b\u3001\u968e\u5c64\u69cb\u9020\u306e\u81ea\u7531\u306a\u5834\u6240\u306b\u65b0\u305f\u306a\u4f8b\u5916\u3092\u52a0\u3048\u3088\u3046\u3068\u3059\u308b\u3068\u3001\u578b\u306e\u968e\u5c64\u3092\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067Expression Problem\u304c\u767a\u751f\u3057\u3066\u3057\u307e\u3046\u3002\n\n# \u578b\u30af\u30e9\u30b9\u306b\u3088\u308b\u5b89\u5168\u306a\u30ad\u30e3\u30b9\u30c8\n\n\u901a\u5e38\u3001\u578b\u3092\u5f37\u5f15\u306b\u5909\u66f4\u3059\u308b`asInstanceOf`\u306a\u3069\u3092\u7528\u3044\u305f[\uff08\u30c0\u30a6\u30f3\uff09\u30ad\u30e3\u30b9\u30c8](https://ja.wikipedia.org/wiki/%E5%9E%8B%E5%A4%89%E6%8F%9B#.E3.83.80.E3.82.A6.E3.83.B3.E3.82.AD.E3.83.A3.E3.82.B9.E3.83.88)\u306f\u5371\u967a\u3067\u3042\u308a\u3001\u884c\u3046\u3079\u304d\u3067\u306f\u306a\u3044\u3002\u3057\u304b\u3057\u3001\u5b89\u5168\u306b\u3042\u308b\u578b\u304b\u3089\u5225\u306e\u578b\u3078\u5909\u63db\u3059\u308b\u65b9\u6cd5\u304c\u306a\u3044\u304b\u3068\u3044\u3046\u3068\u3001\u305d\u3046\u3067\u3082\u306a\u3044\u3002\u4f8b\u3048\u3070`Int`\u304b\u3089`String`\u3078\u30ad\u30e3\u30b9\u30c8\u3059\u308b\u95a2\u6570\u306f\u6b21\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3067\u304d\u308b\u3002\n\n```scala\ndef string_of_int(i: Int): String = i.toString\n```\n\n\u3053\u306e\u3088\u3046\u306b\u3001\u30e6\u30fc\u30b6\u30fc\u304c\u5b9a\u7fa9\u3057\u305f\u30ad\u30e3\u30b9\u30c8\u95a2\u6570\u306a\u3089\u3070\u3001\u30b5\u30d6\u30bf\u30a4\u30d7\u95a2\u4fc2\u304c\u306a\u3044\u5834\u5408\u3067\u3082\u5b89\u5168\u306b\u30ad\u30e3\u30b9\u30c8\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3002\u3053\u306e\u3088\u3046\u306a**\u3042\u308b\u578b`A`\u304b\u3089\u578b`B`\u3078\u306e\u30ad\u30e3\u30b9\u30c8\u3092\u30e6\u30fc\u30b6\u30fc\u304c\u63d0\u4f9b\u3057\u3066\u3044\u308b**\u3068\u3044\u3046\u60c5\u5831\u3092[\u578b\u30af\u30e9\u30b9](http://halcat0x15a.github.io/slide/functional_scala/#/)\u3068\u3057\u3066\u6b21\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3059\u308b\u3002\n\n```scala:Transform.scala\ntrait :->[A, B] {\n  def cast(a: A): B\n}\n```\n\n\u4f8b\u3048\u3070`Int :-> Float`\u3068\u3044\u3046\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\uff08`impliit`\u30d1\u30e9\u30e1\u30fc\u30bf\uff09\u304c\u3042\u308c\u3070\u3001`Int`\u304b\u3089`Float`\u3078\u5b89\u5168\u306b\u30ad\u30e3\u30b9\u30c8\u3059\u308b\u305f\u3081\u306e\u95a2\u6570`cast`\u304c\u5b58\u5728\u3059\u308b\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308b\u3002\n\n```scala\nimplicit val float_of_int = new :->[Int, Float] {\n  def cast(a: Int): Float = a.toFloat\n}\n```\n\n\u3053\u308c\u3092\u7528\u3044\u3066\u4f8b\u5916\u306e\u968e\u5c64\u69cb\u9020\u3092\u62e1\u5f35\u53ef\u80fd\u306a\u5f62\u3067\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n# `implicit`\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u63a2\u7d22\u9806\u5e8f\n\n\u672c\u984c\u306b\u5165\u308b\u524d\u306b\u3001Scala\u306e`implicit`\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u3069\u306e\u3088\u3046\u306b\u63a2\u7d22\u3055\u308c\u308b\u306e\u304b\u77e5\u3063\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\nScala\u306f\u6b21\u306e\u9806\u5e8f\u3067\u578b\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\uff08`implicit`\u30d1\u30e9\u30e1\u30fc\u30bf\uff09\u3092\u63a2\u7d22\u3059\u308b\u3002\n\n1. \u73fe\u5728\u306e\u30b9\u30b3\u30fc\u30d7\n2. \u578b\u30af\u30e9\u30b9\u306b\u6295\u5165\u3055\u308c\u305f\u578b\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u30b3\u30f3\u30d1\u30cb\u30aa\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n3. \u578b\u30af\u30e9\u30b9\u306b\u6295\u5165\u3055\u308c\u305f\u578b\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u30b9\u30fc\u30d1\u30fc\u30af\u30e9\u30b9\u306e\u30b3\u30f3\u30d1\u30cb\u30aa\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n4. \u578b\u30af\u30e9\u30b9\u306e[\u30b3\u30f3\u30d1\u30cb\u30aa\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8](http://www.ne.jp/asahi/hishidama/home/tech/scala/object.html#h_companion_object)\n\nScala\u306f\u307e\u305a\uff081\uff09\u304b\u3089\u9806\u756a\u306b`implicit`\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u63a2\u7d22\u3057\u3001\u898b\u3064\u304b\u3063\u305f\u6642\u70b9\u3067\u63a2\u7d22\u3092\u6253\u3061\u5207\u308b\u3002\n\n# \u4f8b\u5916\u306e\u62e1\u5f35\n\n\u3055\u3066\u3001\u5b89\u5168\u306a\u30ad\u30e3\u30b9\u30c8`A :-> B`\u3092\u7528\u3044\u3066\u4f8b\u5916\u306e\u968e\u5c64\u3092\u5b9a\u7fa9\u3059\u308b\u3068\u306f\u3069\u3046\u3044\u3046\u3053\u3068\u3060\u308d\u3046\u304b\u3002\u5148\u7a0b\u306e\u4f8b\u3092\u518d\u3073\u632f\u308a\u66ff\u3048\u308b\u3068\u3001\u4eca\u3001`DatabaseException`\u3068`HttpException`\u306e\u4e8c\u3064\u3092\u62bd\u8c61\u5316\u3057\u305f\u3088\u3046\u306a`DatabaseAndHttpException`\u3068\u3044\u3046\u4f8b\u5916\u3092\u4f5c\u308b\u3053\u3068\u3067\u6b21\u306e`for`\u5f0f\u306e\u7d50\u679c\u3092`Either[DatabaseAndHttpException, Unit]`\u306e\u3088\u3046\u306b\u3057\u305f\u3044\u3002\n\n```scala\nfor {\n  x <- databaseService(???) // Either[DatabaseException, A]\n  y <- httpService(???)     // Either[HttpException, A]\n} yield ()\n```\n\n\u305d\u3053\u3067\u307e\u305a\u3001\u65e2\u5b58\u306e\u578b\u3092\u5909\u66f4\u305b\u305a`DatabaseAndHttpException`\u3092\u5b9a\u7fa9\u3059\u308b\u3002\n\n```scala\ncase class DatabaseAndHttpException(m: String) extends RootException\n```\n\n\u578b\u306e\u30b5\u30d6\u30bf\u30a4\u30d7\u95a2\u4fc2\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n```\nRootException\n|\n+---- DatabaseException\n|\n+---- HttpException\n|\n+---- FileException\n|     |\n|     +---- ReadException\n|     |\n|     +---- WriteException\n|\n+---- DatabaseAndHttpException\n```\n\n\u305d\u3057\u3066\u3001`DatabaseException`\u304b\u3089`DatabaseAndHttpException`\u3078\u306e\u30ad\u30e3\u30b9\u30c8\u3068\u3001`HttpException`\u304b\u3089`DatabaseAndHttpException`\u3078\u306e\u30ad\u30e3\u30b9\u30c8\u3092\u305d\u308c\u305e\u308c\u6b21\u306e\u3088\u3046\u306b`DatabaseAndHttpException`\u306e\u30b3\u30f3\u30d1\u30cb\u30aa\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u5b9a\u7fa9\u3059\u308b\u3002\n\n```scala:DatabaseAndHttpException.scala\nobject DatabaseAndHttpException {\n  implicit val databaseException = new :->[DatabaseException, DatabaseAndHttpException] {\n    def cast(a: DatabaseException): DatabaseAndHttpException =\n      DatabaseAndHttpException(s\"database: ${a.m}\")\n  }\n\n  implicit val httpException = new :->[HttpException, DatabaseAndHttpException] {\n    def cast(a: HttpException): DatabaseAndHttpException =\n      DatabaseAndHttpException(s\"http: ${a.m}\")\n  }\n}\n```\n\n\u3055\u3066\u3001\u6b21\u306f`Either`\u306e`map`\u3068`flatMap`\u3092\u6539\u9020\u3059\u308b\u3002\u3053\u308c\u306b\u306fScala\u306e[Pimp my Library Pattern](http://d.hatena.ne.jp/xuwei/20110623/1308787607)\u3092\u7528\u3044\u308b[^as]\u3002\n\n```scala:Implicit.scala\nobject Implicit {\n  implicit class ExceptionEither[L <: RootException, R](val ee: Either[L, R]) {\n    def map[L2 <: RootException, R2](f: R => R2)(implicit L2: L :-> L2): Either[L2, R2] = ee match {\n      case Left(e)  => Left(L2.cast(e))\n      case Right(v) => Right(f(v))\n    }\n\n    def flatMap[L2 <: RootException, R2](f: R => Either[L2, R2])(implicit L2: L :-> L2): Either[L2, R2] = ee match {\n      case Left(e)  => Left(L2.cast(e))\n      case Right(v) => f(v)\n    }\n\n    def as[L2 <: RootException](implicit L2: L :-> L2): Either[L2, R] = ee match {\n      case Left(e)  => Left(L2.cast(e))\n      case Right(v) => Right(v)\n    }\n  }\n}\n```\n\n[^as]: \u3053\u3053\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u8b0e\u306e\u30e1\u30bd\u30c3\u30c9`as`\u306b\u3064\u3044\u3066\u306f\u5f8c\u8ff0\u3059\u308b\u3002\n\n\u3053\u306e\u3088\u3046\u306b\u3001`map`\u3068`flatMap`\u306e\u5b9a\u7fa9\u3092\u5909\u66f4\u3057\u3066\u3001`Either[L, R]`\u3092\u53d7\u3051\u53d6\u308a\u3001`L :-> L2`\u3068\u3044\u3046`implicit`\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u63a2\u7d22\u3057\u3066\u3001\u5b58\u5728\u3057\u305f\u5834\u5408\u306f`implicit`\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u7528\u3044\u3066`Either[L2, R2]`\u3092\u8fd4\u3059\u3068\u3044\u3046\u95a2\u6570\u306b\u5909\u66f4\u3057\u3066\u3044\u308b\u3002\n\u3055\u3063\u305d\u304f\u3053\u308c\u3092\u8a66\u3057\u3066\u307f\u3088\u3046\u3002\n\n```scala\ndef left[A](e: A) = Left[A, Unit](e)\n\nval e1 = left(DatabaseException(\"db error\"))\nval e2 = left(HttpException(\"http error\"))\n\nval e3 = for {\n  a <- e1\n  b <- e2\n} yield ()\n```\n\n\u3057\u304b\u3057\u3001\u3053\u308c\u306f\u6b21\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u3067\u30b3\u30f3\u30d1\u30a4\u30eb\u306b\u5931\u6557\u3057\u3066\u3057\u307e\u3046\u3002\n\n```\nError:(18, 9) could not find implicit value for parameter L2: utils.:->[utils.DatabaseException,utils.HttpException]\n      a <- e1\n        ^\n```\n\n`DatabaseAndHttpException`\u306f\u578b\u3068\u3057\u3066`DatabaseException`\u3084`HttpException`\u3068\u968e\u5c64\u95a2\u4fc2\u306b\u306a\u3044\u306e\u3067\u3001Scala\u306e\u51e6\u7406\u7cfb\u306f`DatabaseAndHttpException`\u3078`implicit`\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u63a2\u7d22\u3092\u8a66\u307f\u306a\u3044\u3002\u305d\u3053\u3067\u3001\u5148\u7a0b`map`\u3084`flatMap`\u3068\u5171\u306b\u5b9a\u7fa9\u3057\u305f`as`\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3063\u3066\u660e\u793a\u7684\u306b\u5b89\u5168\u306a\u30ad\u30e3\u30b9\u30c8\u3092\u884c\u3063\u3066\u3084\u308b\u3068\u4e0a\u624b\u304f\u3044\u304f\u3002\n\n```scala\nval e3 = for {\n  a <- e1\n  b <- e2.as[DatabaseAndHttpException]\n} yield ()\n```\n\n\u3053\u306e\u3088\u3046\u306b\u3059\u308b\u3068\u3001`e2`\u306f`Either[HttpException, Unit]`\u306a\u306e\u3067`as`\u306f`HtttException :-> DatabaseAndHttpException`\u306e`implicit`\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u63a2\u7d22\u3059\u308b\u3002\u578b\u30af\u30e9\u30b9`:->`\u306e\u578b\u30d1\u30e9\u30e1\u30fc\u30bf\u306b`DatabaseAndHttpException`\u304c\u3042\u308b\u306e\u3067\u3001`DatabaseAndHttpException`\u306e\u30b3\u30f3\u30d1\u30cb\u30aa\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u63a2\u7d22\u5bfe\u8c61\u306b\u5165\u308a\u3001\u7121\u4e8b\u306b`implicit`\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u898b\u3064\u304b\u308b\u3002\n\u3053\u306e\u3088\u3046\u306b\u3001`implicit`\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3088\u3063\u3066\u5909\u63db\u53ef\u80fd\u306a\u4f8b\u5916\u540c\u58eb\u306e\u6709\u5411\u30b0\u30e9\u30d5\u3092\u4f5c\u308b\u3053\u3068\u3067\u3001\u30b5\u30d6\u30bf\u30a4\u30d7\u95a2\u4fc2\u3092\u4f7f\u308f\u305a\u5b89\u5168\u306b\u5225\u306e\u578b\u3078\u5909\u63db\u3057\u3066\u53d6\u308a\u6271\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n# \u65e2\u5b58\u306e\u4f8b\u5916\u968e\u5c64\u3068\u306e\u4e92\u63db\u6027\n\n\u4eca\u306e\u6642\u70b9\u3067\u3001\u30b5\u30d6\u30bf\u30a4\u30d7\u95a2\u4fc2\u306b\u3088\u308b\u4f8b\u5916\u306e\u968e\u5c64\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n```\nRootException\n|\n+---- DatabaseException\n|\n+---- HttpException\n|\n+---- FileException\n|     |\n|     +---- ReadException\n|     |\n|     +---- WriteException\n|\n+---- DatabaseAndHttpException\n```\n\n\u3053\u306e\u968e\u5c64\u3092\u4eca\u304b\u3089`:->`\u306b\u3088\u3063\u3066\u5168\u90e8\u5b9a\u7fa9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3068\u3057\u305f\u3089\u3001\u305d\u308c\u306f\u5927\u5909\u3067\u3042\u308b\u3002\u3053\u3053\u304b\u3089\u306f\u30b5\u30d6\u30bf\u30a4\u30d7\u95a2\u4fc2\u3092\u7528\u3044\u3066\u69cb\u7bc9\u3057\u305f\u4f8b\u5916\u306e\u968e\u5c64\u69cb\u9020\u3068\u3001\u4eca\u56de\u5c0e\u5165\u3057\u305f\u968e\u5c64\u69cb\u9020\u306e\u4e92\u63db\u6027\u3092\u898b\u3066\u3044\u304f\u3002\n\n## \u81ea\u5206\u81ea\u8eab\u3068\u306e\u4e92\u63db\u6027\n\n\u3068\u3053\u308d\u3067\u3001\u73fe\u72b6\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u30b5\u30d6\u30bf\u30a4\u30d7\u95a2\u4fc2\u3092\u5168\u304f\u7121\u8996\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u4f8b\u3048\u3070\u6b21\u306e\u3088\u3046\u306a`for`\u5f0f\u304c\u30a8\u30e9\u30fc\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u3002\n\n```scala\nval e4 = for {\n  a <- e1\n} yield ()\n```\n\n```\nError:(20, 9) could not find implicit value for parameter L2: utils.:->[utils.DatabaseException,L2]\n      a <- e1\n        ^\n```\n\n\u306a\u305c\u3053\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\u304b\u3068\u3044\u3046\u3068\u3001`map`\u884c\u3046\u305f\u3081\u306b\u306f\u4f8b\u3048\u4f55\u304b\u9069\u5f53\u306a\u578b`L`\u306b\u3088\u308b`Either[L, ?]`\u304b\u3089`Either[L, ?]`\u3078\u306e`map`\u3067\u3042\u3063\u3066\u3082`L :-> L`\u3068\u306a\u308b`implicit`\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u5fc5\u8981\u3067\u3042\u308a\u3001\u305d\u308c\u304c\u306a\u3044\u306e\u3067\u30a8\u30e9\u30fc\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u3002\u3053\u306e\u3088\u3046\u306a\u9069\u5f53\u306a\u578b`L`\u304b\u3089`L`\u3078\u30ad\u30e3\u30b9\u30c8\u3059\u308b\u306e\u306f\u3001`L`\u304c\u3069\u306e\u3088\u3046\u306a\u578b\u3067\u3042\u3063\u305f\u3068\u3057\u3066\u3082\u6b21\u306e\u3088\u3046\u306b\u66f8\u3051\u308b[^L_as_A]\u3002\n\n```scala\nimplicit def self[A]= new :->[A, A] {\n  def cast(a: A): A = a\n}\n```\n\n[^L_as_A]: \u3053\u306e\u30e1\u30bd\u30c3\u30c9`self`\u3067\u306f\u578b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092`L`\u3067\u306f\u306a\u304f`A`\u3068\u3057\u3066\u3044\u308b\u304c\u3001\u610f\u5473\u7684\u306b\u306f\u5909\u308f\u308a\u306a\u3044\u3002\n\n\u3055\u3066\u3001\u3053\u306e`implicit`\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u7f6e\u304f\u306e\u306b\u9069\u3057\u305f\u5834\u6240\u306f\u3069\u3053\u304b\u3068\u3044\u3046\u3068\u3001\u305d\u308c\u306f`implicit`\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u63a2\u7d22\u9806\u4f4d\u304c\u4f4e\u3044`:->`\u306e\u30b3\u30f3\u30d1\u30cb\u30aa\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u4e2d\u3060\u308d\u3046\u3002\n\n```scala:Transform.scala\nobject :-> {\n  implicit def self[A] = new :->[A, A] {\n    def cast(a: A): A = a\n  }\n}\n```\n\n\u3053\u306e\u3088\u3046\u306b\u3059\u308b\u3053\u3068\u3067\u30b3\u30f3\u30d1\u30a4\u30eb\u3092\u901a\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n## \u30b5\u30d6\u30bf\u30a4\u30d7\u95a2\u4fc2\u306b\u3088\u308b\u968e\u5c64\u3068\u306e\u4e92\u63db\u6027\n\n`FileException`\u306f\u6b21\u306e\u3088\u3046\u306b\u30b5\u30d6\u30bf\u30a4\u30d7\u95a2\u4fc2\u3092\u5229\u7528\u3057\u305f\u968e\u5c64\u3092\u6301\u3064\u4f8b\u5916\u3067\u3042\u308b\u3002\n\n```scala\ntrait FileException extends RootException\n\ncase class ReadException(m: String) extends FileException\n\ncase class WriteException(m: String) extends FileException\n```\n\n```\nRootException\n|\n+---- FileException\n      |\n      +---- ReadException\n      |\n      +---- WriteException\n```\n\n\u3053\u308c\u3089\u3092\u6301\u3064`Either`\u3092`for`\u3067\u6b21\u306e\u3088\u3046\u306b\u307e\u3068\u3081\u308b\u3053\u3068\u306f\u3067\u304d\u308b\u3060\u308d\u3046\u304b\u3002\n\n```scala\nval e5 = left(ReadException(\"file read error\"))\nval e6 = left(WriteException(\"file read error\"))\n\nval e7 = for {\n  a <- e5\n  b <- e6\n} yield ()\n```\n\n\u6b21\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u3066\u3057\u307e\u3046\u3002\n\n```\nError:(29, 9) could not find implicit value for parameter L2: utils.:->[utils.ReadException,utils.WriteException]\n      a <- e5\n        ^\n```\n\n\u3053\u308c\u306f\u5148\u307b\u3069\u3001`DatabaseAndHttpException`\u3067\u51fa\u73fe\u3057\u305f\u30a8\u30e9\u30fc\u3068\u540c\u3058\u306a\u306e\u3067\u3001`as`\u30e1\u30bd\u30c3\u30c9\u3067\u6b21\u306e\u3088\u3046\u306b\u3059\u308c\u3070\u89e3\u6c7a\u3067\u304d\u305d\u3046\u306b\u601d\u3048\u308b\u3002\n\n```scala\nval e7 = for {\n  a <- e5\n  b <- e6.as[FileException]\n} yield ()\n```\n\n\u3057\u304b\u3057\u3001\u3053\u308c\u3082\u6b21\u306e\u3088\u3046\u306a\u30b3\u30f3\u30d1\u30a4\u30eb\u30a8\u30e9\u30fc\u3068\u306a\u308b\u3002\n\n```\nError:(30, 17) could not find implicit value for parameter L2: utils.:->[utils.WriteException,utils.FileException]\n      b <- e6.as[FileException]\n                ^\n```\n\n\u3069\u3046\u3084\u3089\u3001`WriteException :-> FileException`\u3068\u3044\u3046`implicit`\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u767a\u898b\u3067\u304d\u306a\u304b\u3063\u305f\u3088\u3046\u3060\u3002\u305f\u3060\u3001\u3053\u306e\u3088\u3046\u306b\u30b5\u30d6\u30bf\u30a4\u30d7\u95a2\u4fc2\u304c\u3042\u308b\u5834\u5408\u306f\u3053\u306e`WriteException`\u3084`FileException`\u306b\u9650\u3089\u305a\u6b21\u306e\u3088\u3046\u306a`implicit`\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n```scala\nimplicit def superclass[A, B >: A] = new :->[A, B] {\n  def cast(a: A): B = a\n}\n```\n\n\u3053\u306e\u5b9a\u7fa9\u3092\u3088\u304f\u898b\u308b\u3068\u3001\u578b\u30d1\u30e9\u30e1\u30fc\u30bf`B`\u304c`A`\u3067\u3042\u3063\u305f\u6642\u306f\u3001\u5148\u307b\u3069\u5b9a\u7fa9\u3057\u305f`implicit`\u30d1\u30e9\u30e1\u30fc\u30bf`self`\u3068\u540c\u3058\u632f\u308b\u821e\u3044\u3092\u3059\u308b\u3068\u3044\u3046\u3053\u3068\u304c\u660e\u3089\u304b\u3067\u3042\u308b[^a_is_supertype_of_a]\u3002\u3088\u3063\u3066`:->`\u306e\u30b3\u30f3\u30d1\u30cb\u30aa\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u306f\u3053\u306e`superclass`\u3060\u3051\u3092\u8a2d\u7f6e\u3059\u308b\u3002\n\n```scala:Transform.scala\nobject :-> {\n  implicit def superclass[A, B >: A] = new :->[A, B] {\n    def cast(a: A): B = a\n  }\n}\n```\n\n[^a_is_supertype_of_a]: \u3053\u306e\u6642\u3001\u4efb\u610f\u306e\u578b`A`\u306f`A >: A`\u3092\u6e80\u3059\u3002\n\n\u3053\u306e\u3088\u3046\u306b\u3059\u308c\u3070\u3001\u6b21\u306e\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n```scala\nval e7 = for {\n  a <- e5\n  b <- e6.as[FileException]\n} yield ()\n```\n\n# \u307e\u3068\u3081\n\n\u5b89\u5168\u306a\u30ad\u30e3\u30b9\u30c8\u3092\u63d0\u4f9b\u3059\u308b\u578b\u30af\u30e9\u30b9\u3092\u7528\u3044\u308b\u3088\u3046\u306b`Either`\u306e`map`\u3084`flatMap`\u3092\u6539\u9020\u3059\u308b\u3053\u3068\u3067\u3001\u4f8b\u5916\u306e\u968e\u5c64\u69cb\u9020\u3092\u30a2\u30c9\u30db\u30c3\u30af\u306b\u69cb\u7bc9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\u3053\u306e\u65b9\u6cd5\u306f\u4e0b\u8a18\u306e\u8ad6\u6587\u3092\u8aad\u307f\u3064\u3064\u8003\u3048\u305f\u3082\u306e\u306a\u306e\u3067\u3001\u65e2\u306b\u8ab0\u304b\u304c\u3088\u308a\u3088\u3044\u65b9\u6cd5\u3092\u767a\u8868\u3057\u3066\u3044\u308b\u53ef\u80fd\u6027\u3082\u3042\u308b\u3002\u3082\u3057\u60c5\u5831\u3092\u3054\u5b58\u77e5\u306e\u65b9\u306fQiita\u306e\u30b3\u30e1\u30f3\u30c8\u306a\u3069\u3067\u9023\u7d61\u3057\u3066\u6b32\u3057\u3044\u3002\n\n# \u53c2\u8003\u6587\u732e\n\n- [An Extensible Dynamically-Typed Hierarchy of Exceptions](http://community.haskell.org/~simonmar/papers/ext-exceptions.pdf)\n", "tags": ["Scala", "\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0", "\u4f8b\u5916"]}