{"context": " More than 1 year has passed since last update.\u81ea\u5b85\u5074\u306eActiveDirectory\u3068AWS\u5074\u306eWeb\u30b5\u30fc\u30d0\u3092\u9023\u52d5\u3055\u305b\u3066\u307f\u308b\u3002\n\u307e\u305a\u306fVPN\u3092\u5f35\u308b\u6240\u307e\u3067\u3002\n\n\u74b0\u5883\n\u81ea\u5b85\u5074\n\u30b0\u30ed\u30fc\u30d0\u30ebIP\uff1aXXX.XXX.XXX.XXX\n\u30ed\u30fc\u30ab\u30eb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff1a192.168.1.0/24\nVPN\u30b5\u30fc\u30d0\u306eIP\uff1a192.168.1.7\nAWS\u5074\n\u30b0\u30ed\u30fc\u30d0\u30ebIP\uff1aYYY.YYY.YYY.YYY\n\u30ed\u30fc\u30ab\u30eb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff1a10.0.0.0/24 (Public\u5074)\n\u30ed\u30fc\u30ab\u30eb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff1a10.0.1.0/24 (Private\u5074)\nVPN\u30b5\u30fc\u30d0\u306eIP\uff1a10.0.0.6 (Public\u5074)\nVPN\u30b5\u30fc\u30d0\u306eIP\uff1a10.0.1.6 (Private\u5074)\n\n\u81ea\u5b85\u5074\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\u53c2\u8003\n\u30e6\u30fc\u30b6\u30ac\u30a4\u30c9\n\u3055\u304f\u3089\u306eVPS\u306bVyOS\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u6700\u521d\u306fCD\u304b\u3089\u30d6\u30fc\u30c8\u3055\u308c\u308b\u306e\u3067\u3001\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304b\u3089\u30e6\u30fc\u30b6\u30fc\u30ac\u30a4\u30c9\u306b\u5f93\u3063\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3046\u3002\nID/pass\u306fvyos/vyos\n\u30ed\u30b0\u30a4\u30f3\u5f8cinstall image\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u958b\u59cb\u3002\n\n\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\u5404\u7a2e\u8a2d\u5b9a\u306f\u30b3\u30f3\u30d5\u30a3\u30b0\u30e2\u30fc\u30c9\u306b\u3088\u3063\u3066\u64cd\u4f5c\u3059\u308b\u3089\u3057\u3044\u3002\n\n\u30d7\u30ed\u30f3\u30d7\u30c8\u306e\u672b\u5c3e\u304c\u300c$\u300d\u306b\u306a\u3063\u3066\u3044\u308b\u72b6\u614b\u306fCisco\u30eb\u30fc\u30bf\u306a\u3069\u3067\u3044\u3046\u30e6\u30fc\u30b6\u30e2\u30fc\u30c9\u3067\u3059\u3002\n\u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b\u305f\u3081\u306b\u306f\u30b3\u30f3\u30d5\u30a3\u30b0\u30e2\u30fc\u30c9\u3078\u9077\u79fb\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n$ configure\n\u30d7\u30ed\u30f3\u30d7\u30c8\u304c\u300c#\u300d\u306b\u5909\u308f\u308a\u30b3\u30f3\u30d5\u30a3\u30b0\u30e2\u30fc\u30c9\u306b\u9077\u79fb\u3059\u308b\u306e\u3067\u3001\u4e0b\u8a18\u306e\u901a\u308aIP\u30a2\u30c9\u30ec\u30b9\u306e\u8a2d\u5b9a\u3092\u6d41\u3057\u8fbc\u3093\u3067\u3044\u304d\u307e\u3059\u3002\nset interface ethernet eth0 address [IPADDRESS/MASK]\nset system gateway-address [GATEWAY ADDRESS]\n\n\u53c2\u8003\u30b5\u30a4\u30c8\u306b\u5023\u3063\u3066\u3001\u307e\u305a\u306fssh\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u4f5c\u696d\u304c\u51fa\u6765\u308b\u69d8\u306b\u4ee5\u4e0b\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3092\u884c\u3046\u3002\n1. IP\u30a2\u30c9\u30ec\u30b9\u306e\u5272\u308a\u5f53\u3066\n2. ssh\u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\u8a2d\u5b9a\n$ configure\n\n# set interface ethernet eth0 address 192.168.1.7/24\n# set system gateway-address 192.168.1.1\n# set service ssh port '22'\n# commit\n# save\n# exit\n\n\u306a\u304a\u3001set inte[tab]\u3068\u5165\u529b\u3059\u308b\u3068set interface\u3068\u3044\u3063\u305f\u5177\u5408\u306b\u5165\u529b\u88dc\u5b8c\u3055\u308c\u308b\u3002\n\u52d5\u4f5c\u78ba\u8a8d\nping 8.8.8.8\n\u30e1\u30e2\n\u8a2d\u5b9a\u524a\u9664\u306b\u3064\u3044\u3066\nIP\u30a2\u30c9\u30ec\u30b9\u3092\u524a\u9664\u3059\u308b\u5834\u5408delete interface ethernet eth0 address 192.168.1.7/24\u3068\u6253\u3064\u3002\n\u3053\u308c\u3082[tab]\u3067\u5165\u529b\u88dc\u5b8c\u3055\u308c\u308b\u3002\n\nAWS\u5074\n\u53c2\u8003\nVyatta\u3067VPC\u3092\u62e0\u70b9\u9593\u63a5\u7d9a\u3059\u308b\nAWS\u306e\u753b\u9762\u3067\u8272\u3005\u3068\u8a2d\u5b9a\u3092\u5b9f\u65bd\u3002\n\nVPC\nVPC\u306f10.0.0.0/16\u3067\u4f5c\u6210\u3002\nSubnet\u306fPublic10.0.0.0/24\u3068\u3001Private10.0.1.0/24\u306e2\u3064\u3092\u4f5c\u6210\u3059\u308b\u3002\n\nEC2\nami-07f47b06\u3092\u5229\u7528\u3057\u3066Public\u5074\u306b\u914d\u7f6e\u3059\u308b\u3002\nSecurity Group\u306f\u3001SSH\u3068Custom UDP(500)\u3068Custom Protocol(50)\u306e\uff13\u3064\u3092\u3001\u3044\u305a\u308c\u3082Source My IP\u3067\u5b9a\u7fa9\u3057\u3066\u304a\u304f\u3002\n\n\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\nPrivate\u7528\u306e\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u3068\u3057\u3066\u3001\u5b9b\u5148\u304c192.168.1.0/24\u306e\u5834\u5408\u306f\u4e0a\u8a18\u3067\u4f5c\u6210\u3057\u305fEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u5411\u3051\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n\n\nENI\nPrivate\u306b\u6240\u5c5e\u3059\u308bENI\u3092\u4f5c\u6210\u3057\u3066\u3001\u5148\u7a0b\u4f5c\u3063\u305fEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u5272\u308a\u5f53\u3066\u308b\u3002\n\u307e\u305f\u3001Source/Dest Check\u30922\u3064\u306eENI\u3067\u7121\u52b9\u306b\u3057\u3066\u304a\u304f\u3002\n\nEC2\u306e\u8a73\u7d30\u306a\u8a2d\u5b9a\nchmod 600 ~/Downloads/VPN.pem.txt\nssh -i ~/Downloads/VPN.pem.txt vyatta@YYY.YYY.YYY.YYY\n\n/etc/network/interfaces \u306b\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f ENI \u306e\u60c5\u5831\u3092\u8ffd\u8a18\u3002\neth1\u3068\u3057\u3066\u8a8d\u8b58\u3055\u305b\u308b\u3002\n$ sudo vi /etc/network/interfaces\n\nauto eth0\niface eth0 inet static\naddress 10.0.0.6\nnetmask 255.255.255.0\ngateway 10.0.0.1\n\nauto eth1\niface eth1 inet static\naddress 10.0.1.6\nnetmask 255.255.255.0\n\n/etc/init.d/networking \u3092\u518d\u8d77\u52d5\u3059\u308b\u3002\n$ sudo /etc/init.d/networking restart\n\n---\u30b3\u30de\u30f3\u30c9\u3067\u8a2d\u5b9a\u72b6\u6cc1\u3092\u78ba\u8a8d\n$ sudo ifconfig\neth0      Link encap:Ethernet  HWaddr 06:c6:ee:1c:ba:d5  \n          inet addr:10.0.0.6  Bcast:10.0.0.255  Mask:255.255.255.0\n          inet6 addr: fe80::4c6:eeff:fe1c:bad5/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:158 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:139 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000 \n          RX bytes:15238 (14.8 KiB)  TX bytes:19074 (18.6 KiB)\n          Interrupt:25 \n\neth1      Link encap:Ethernet  HWaddr 06:97:c2:06:da:93  \n          inet addr:10.0.1.6  Bcast:10.0.1.255  Mask:255.255.255.0\n          inet6 addr: fe80::497:c2ff:fe06:da93/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:24 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:5 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000 \n          RX bytes:888 (888.0 B)  TX bytes:478 (478.0 B)\n          Interrupt:26 \n\nlo        Link encap:Local Loopback  \n          inet addr:127.0.0.1  Mask:255.0.0.0\n          inet6 addr: ::1/128 Scope:Host\n          UP LOOPBACK RUNNING  MTU:16436  Metric:1\n          RX packets:398 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:398 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0 \n          RX bytes:23968 (23.4 KiB)  TX bytes:23968 (23.4 KiB)\n\n\u8a2d\u5b9a\n$ configure\n# set interfaces ethernet eth1 address 10.0.1.6/24\n# commit\n# save\n\n\n\u81ea\u5b85/AWS\u305d\u308c\u305e\u308c\u306eVPN\u3067\u5171\u901a\u306e\u4f5c\u696d\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u8a2d\u5b9a\u3092\u6d41\u3057\u8fbc\u3080\u3002\nconfigure\n\n---AWS\u5074\u5909\u6570\nlocalID=@cloud\ndestID=@branch\ndestIP=XXX.XXX.XXX.XXX\nlocalIP=10.0.0.6\ndestNet=192.168.1.0/24\nlocalNet=10.0.1.0/24\n\n---\u81ea\u5b85\u5074\u5909\u6570\nlocalID=@branch\ndestID=@cloud\ndestIP=YYY.YYY.YYY.YYY\nlocalIP=192.168.1.7\ndestNet=10.0.1.0/24\nlocalNet=192.168.1.0/24\n\n--\u2212\u4ee5\u4e0b\u5171\u901a\u3067\u30b3\u30de\u30f3\u30c9\u3092\u6d41\u3059\nset vpn ipsec ipsec-interfaces interface eth0\n\nset vpn ipsec ike-group IKE-G proposal 1 encryption aes128\nset vpn ipsec ike-group IKE-G proposal 1 hash sha1\nset vpn ipsec ike-group IKE-G lifetime 3600\n\nset vpn ipsec esp-group ESP-G proposal 1 encryption aes128\nset vpn ipsec esp-group ESP-G proposal 1 hash sha1\nset vpn ipsec esp-group ESP-G lifetime 1800\n\nset vpn ipsec nat-traversal enable\nset vpn ipsec nat-networks allowed-network $destNet\n\nset vpn ipsec site-to-site peer $destIP ike-group IKE-G\nset vpn ipsec site-to-site peer $destIP default-esp-group ESP-G\n\nset vpn ipsec site-to-site peer $destIP authentication mode pre-shared-secret\nset vpn ipsec site-to-site peer $destIP authentication pre-shared-secret my_shared_secret\n\nset vpn ipsec site-to-site peer $destIP authentication id $localID\nset vpn ipsec site-to-site peer $destIP authentication remote-id $destID\n\nset vpn ipsec site-to-site peer $destIP local-address $localIP\n\nset vpn ipsec site-to-site peer $destIP tunnel 1 local prefix $localNet\nset vpn ipsec site-to-site peer $destIP tunnel 1 remote prefix $destNet\n\ncommit\nsave\n\n\u203bmy_shared_secret\u306f\u5404\u74b0\u5883\u3067\u4efb\u610f\u306e\u30d1\u30b9\u30d5\u30ec\u30fc\u30ba\u3092\u6c7a\u3081\u308b\n\u4e21\u65b9\u306e\u8a2d\u5b9a\u5b8c\u4e86\u5f8c\u3001\u305d\u308c\u305e\u308c\u306eipsec\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u518d\u8d77\u52d5\u3059\u308b\u3002\nsudo /etc/init.d/ipsec stop    #AWS\u5074\nsudo /etc/init.d/ipsec restart #\u81ea\u5b85\u5074\nsudo /etc/init.d/ipsec start   #AWS\u5074\n\n\u52d5\u4f5c\u78ba\u8a8d\nvyos@vyos# run show vpn ike sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\nYYY.YYY.YYY.YYY                         192.168.1.7                            \n\n    State  Encrypt  Hash    D-H Grp  NAT-T  A-Time  L-Time\n    -----  -------  ----    -------  -----  ------  ------\n    up     aes128   sha1    5        no     994     3600\n\nvyatta@vyatta# run show vpn ike sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\nXXX.XXX.XXX.XXX                         192.168.0.6                            \n\n    State  Encrypt  Hash  D-H Grp  NAT-T  A-Time  L-Time\n    -----  -------  ----  -------  -----  ------  ------\n    up     aes128   sha1  5        no     284     3600\n\n\n\n\u305d\u306e\u4ed6\u81ea\u5b85\u5074\u3067\u5b9f\u65bd\u3059\u308b\u3053\u3068\n\u74b0\u5883\u53ca\u3073\u88fd\u54c1\u306b\u3088\u3063\u3066\u7570\u306a\u308b\u3068\u601d\u3046\u304c\u3001\u5f53\u65b9\u306e\u74b0\u5883\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u3002\n\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u8a2d\u5b9a\n\n\n\u5916\u90e8\u304b\u3089\u306e\u63a5\u7d9a\u3092\u81ea\u5b85\u5185\u306eVPN\u30b5\u30fc\u30d0\u306b\u5411\u3051\u308b\u8a2d\u5b9a\n\n\n\u52d5\u4f5c\u78ba\u8a8d\n$ ssh -i ~/Downloads/VPN.pem.txt vyatta@10.0.1.6\nLinux vyatta 3.3.8-1-amd64-vyatta #1 SMP Wed Mar 13 10:35:28 PDT 2013 x86_64\nWelcome to Vyatta.\nThis system is open-source software. The exact distribution terms for \neach module comprising the full system are described in the individual \nfiles in /usr/share/doc/*/copyright.\nLast login: Thu Apr 16 14:13:48 2015 from ip-192-168-1-7.ap-northeast-1.compute.internal\nvyatta@vyatta:~$\n\nVPC\u306ePrivate\u306aIP\u6307\u5b9a\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u305f\u3002\n\u81ea\u5b85\u5074\u306eActiveDirectory\u3068AWS\u5074\u306eWeb\u30b5\u30fc\u30d0\u3092\u9023\u52d5\u3055\u305b\u3066\u307f\u308b\u3002\n\u307e\u305a\u306fVPN\u3092\u5f35\u308b\u6240\u307e\u3067\u3002\n\n#\u74b0\u5883\n\u81ea\u5b85\u5074\n\u30b0\u30ed\u30fc\u30d0\u30ebIP\uff1aXXX.XXX.XXX.XXX\n\u30ed\u30fc\u30ab\u30eb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff1a192.168.1.0/24\nVPN\u30b5\u30fc\u30d0\u306eIP\uff1a192.168.1.7\n\n\nAWS\u5074\n\u30b0\u30ed\u30fc\u30d0\u30ebIP\uff1aYYY.YYY.YYY.YYY\n\u30ed\u30fc\u30ab\u30eb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff1a10.0.0.0/24 (Public\u5074)\n\u30ed\u30fc\u30ab\u30eb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff1a10.0.1.0/24 (Private\u5074)\nVPN\u30b5\u30fc\u30d0\u306eIP\uff1a10.0.0.6 (Public\u5074)\nVPN\u30b5\u30fc\u30d0\u306eIP\uff1a10.0.1.6 (Private\u5074)\n\n#\u81ea\u5b85\u5074\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\n\u53c2\u8003\n[\u30e6\u30fc\u30b6\u30ac\u30a4\u30c9](http://wiki.vyos-users.jp/\u30e1\u30a4\u30f3\u30da\u30fc\u30b8)\n[\u3055\u304f\u3089\u306eVPS\u306bVyOS\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b](http://kentai-shiroma.blogspot.jp/2014/06/vpsvyos.html)\n\n##\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u6700\u521d\u306fCD\u304b\u3089\u30d6\u30fc\u30c8\u3055\u308c\u308b\u306e\u3067\u3001\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304b\u3089\u30e6\u30fc\u30b6\u30fc\u30ac\u30a4\u30c9\u306b\u5f93\u3063\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3046\u3002\nID/pass\u306f`vyos/vyos`\n\u30ed\u30b0\u30a4\u30f3\u5f8c`install image`\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u958b\u59cb\u3002\n\n##\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\u5404\u7a2e\u8a2d\u5b9a\u306f\u30b3\u30f3\u30d5\u30a3\u30b0\u30e2\u30fc\u30c9\u306b\u3088\u3063\u3066\u64cd\u4f5c\u3059\u308b\u3089\u3057\u3044\u3002\n>\u30d7\u30ed\u30f3\u30d7\u30c8\u306e\u672b\u5c3e\u304c\u300c$\u300d\u306b\u306a\u3063\u3066\u3044\u308b\u72b6\u614b\u306fCisco\u30eb\u30fc\u30bf\u306a\u3069\u3067\u3044\u3046\u30e6\u30fc\u30b6\u30e2\u30fc\u30c9\u3067\u3059\u3002\n\u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b\u305f\u3081\u306b\u306f\u30b3\u30f3\u30d5\u30a3\u30b0\u30e2\u30fc\u30c9\u3078\u9077\u79fb\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n>$ configure\n\n>\u30d7\u30ed\u30f3\u30d7\u30c8\u304c\u300c#\u300d\u306b\u5909\u308f\u308a\u30b3\u30f3\u30d5\u30a3\u30b0\u30e2\u30fc\u30c9\u306b\u9077\u79fb\u3059\u308b\u306e\u3067\u3001\u4e0b\u8a18\u306e\u901a\u308aIP\u30a2\u30c9\u30ec\u30b9\u306e\u8a2d\u5b9a\u3092\u6d41\u3057\u8fbc\u3093\u3067\u3044\u304d\u307e\u3059\u3002\n\n> set interface ethernet eth0 address [IPADDRESS/MASK]\n> set system gateway-address [GATEWAY ADDRESS]\n\n\u53c2\u8003\u30b5\u30a4\u30c8\u306b\u5023\u3063\u3066\u3001\u307e\u305a\u306fssh\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u4f5c\u696d\u304c\u51fa\u6765\u308b\u69d8\u306b\u4ee5\u4e0b\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3092\u884c\u3046\u3002\n1. IP\u30a2\u30c9\u30ec\u30b9\u306e\u5272\u308a\u5f53\u3066\n2. ssh\u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\u8a2d\u5b9a\n\n```\n$ configure\n\n# set interface ethernet eth0 address 192.168.1.7/24\n# set system gateway-address 192.168.1.1\n# set service ssh port '22'\n# commit\n# save\n# exit\n```\n\n\u306a\u304a\u3001`set inte[tab]`\u3068\u5165\u529b\u3059\u308b\u3068`set interface`\u3068\u3044\u3063\u305f\u5177\u5408\u306b\u5165\u529b\u88dc\u5b8c\u3055\u308c\u308b\u3002\n\n\u52d5\u4f5c\u78ba\u8a8d\nping 8.8.8.8\n\n\u30e1\u30e2\n\u8a2d\u5b9a\u524a\u9664\u306b\u3064\u3044\u3066\nIP\u30a2\u30c9\u30ec\u30b9\u3092\u524a\u9664\u3059\u308b\u5834\u5408`delete interface ethernet eth0 address 192.168.1.7/24`\u3068\u6253\u3064\u3002\n\u3053\u308c\u3082[tab]\u3067\u5165\u529b\u88dc\u5b8c\u3055\u308c\u308b\u3002\n\n#AWS\u5074\n\u53c2\u8003\n[Vyatta\u3067VPC\u3092\u62e0\u70b9\u9593\u63a5\u7d9a\u3059\u308b](http://blog.serverworks.co.jp/tech/2013/12/04/vyatta_site-to-site/)\n\nAWS\u306e\u753b\u9762\u3067\u8272\u3005\u3068\u8a2d\u5b9a\u3092\u5b9f\u65bd\u3002\n\n##VPC\nVPC\u306f`10.0.0.0/16`\u3067\u4f5c\u6210\u3002\nSubnet\u306fPublic`10.0.0.0/24`\u3068\u3001Private`10.0.1.0/24`\u306e2\u3064\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n##EC2\n`ami-07f47b06`\u3092\u5229\u7528\u3057\u3066Public\u5074\u306b\u914d\u7f6e\u3059\u308b\u3002\nSecurity Group\u306f\u3001SSH\u3068Custom UDP(500)\u3068Custom Protocol(50)\u306e\uff13\u3064\u3092\u3001\u3044\u305a\u308c\u3082Source `My IP`\u3067\u5b9a\u7fa9\u3057\u3066\u304a\u304f\u3002\n\n##\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\nPrivate\u7528\u306e\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u3068\u3057\u3066\u3001\u5b9b\u5148\u304c`192.168.1.0/24`\u306e\u5834\u5408\u306f\u4e0a\u8a18\u3067\u4f5c\u6210\u3057\u305fEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u5411\u3051\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-04-30 21.47.14.png](https://qiita-image-store.s3.amazonaws.com/0/64421/5ef78332-0523-1cb4-9d2b-f036981b0aea.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-04-30 21.47.14.png\")\n\n##ENI\nPrivate\u306b\u6240\u5c5e\u3059\u308bENI\u3092\u4f5c\u6210\u3057\u3066\u3001\u5148\u7a0b\u4f5c\u3063\u305fEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u5272\u308a\u5f53\u3066\u308b\u3002\n\u307e\u305f\u3001Source/Dest Check\u30922\u3064\u306eENI\u3067\u7121\u52b9\u306b\u3057\u3066\u304a\u304f\u3002\n\n##EC2\u306e\u8a73\u7d30\u306a\u8a2d\u5b9a\n\n```\nchmod 600 ~/Downloads/VPN.pem.txt\nssh -i ~/Downloads/VPN.pem.txt vyatta@YYY.YYY.YYY.YYY\n```\n\n/etc/network/interfaces \u306b\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f ENI \u306e\u60c5\u5831\u3092\u8ffd\u8a18\u3002\neth1\u3068\u3057\u3066\u8a8d\u8b58\u3055\u305b\u308b\u3002\n\n```\n$ sudo vi /etc/network/interfaces\n\nauto eth0\niface eth0 inet static\naddress 10.0.0.6\nnetmask 255.255.255.0\ngateway 10.0.0.1\n\nauto eth1\niface eth1 inet static\naddress 10.0.1.6\nnetmask 255.255.255.0\n```\n\n/etc/init.d/networking \u3092\u518d\u8d77\u52d5\u3059\u308b\u3002\n\n```\n$ sudo /etc/init.d/networking restart\n\n---\u30b3\u30de\u30f3\u30c9\u3067\u8a2d\u5b9a\u72b6\u6cc1\u3092\u78ba\u8a8d\n$ sudo ifconfig\neth0      Link encap:Ethernet  HWaddr 06:c6:ee:1c:ba:d5  \n          inet addr:10.0.0.6  Bcast:10.0.0.255  Mask:255.255.255.0\n          inet6 addr: fe80::4c6:eeff:fe1c:bad5/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:158 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:139 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000 \n          RX bytes:15238 (14.8 KiB)  TX bytes:19074 (18.6 KiB)\n          Interrupt:25 \n\neth1      Link encap:Ethernet  HWaddr 06:97:c2:06:da:93  \n          inet addr:10.0.1.6  Bcast:10.0.1.255  Mask:255.255.255.0\n          inet6 addr: fe80::497:c2ff:fe06:da93/64 Scope:Link\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:24 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:5 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000 \n          RX bytes:888 (888.0 B)  TX bytes:478 (478.0 B)\n          Interrupt:26 \n\nlo        Link encap:Local Loopback  \n          inet addr:127.0.0.1  Mask:255.0.0.0\n          inet6 addr: ::1/128 Scope:Host\n          UP LOOPBACK RUNNING  MTU:16436  Metric:1\n          RX packets:398 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:398 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0 \n          RX bytes:23968 (23.4 KiB)  TX bytes:23968 (23.4 KiB)\n```\n\n\u8a2d\u5b9a\n\n```\n$ configure\n# set interfaces ethernet eth1 address 10.0.1.6/24\n# commit\n# save\n```\n\n#\u81ea\u5b85/AWS\u305d\u308c\u305e\u308c\u306eVPN\u3067\u5171\u901a\u306e\u4f5c\u696d\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u8a2d\u5b9a\u3092\u6d41\u3057\u8fbc\u3080\u3002\n\n```\nconfigure\n\n---AWS\u5074\u5909\u6570\nlocalID=@cloud\ndestID=@branch\ndestIP=XXX.XXX.XXX.XXX\nlocalIP=10.0.0.6\ndestNet=192.168.1.0/24\nlocalNet=10.0.1.0/24\n\n---\u81ea\u5b85\u5074\u5909\u6570\nlocalID=@branch\ndestID=@cloud\ndestIP=YYY.YYY.YYY.YYY\nlocalIP=192.168.1.7\ndestNet=10.0.1.0/24\nlocalNet=192.168.1.0/24\n\n--\u2212\u4ee5\u4e0b\u5171\u901a\u3067\u30b3\u30de\u30f3\u30c9\u3092\u6d41\u3059\nset vpn ipsec ipsec-interfaces interface eth0\n\nset vpn ipsec ike-group IKE-G proposal 1 encryption aes128\nset vpn ipsec ike-group IKE-G proposal 1 hash sha1\nset vpn ipsec ike-group IKE-G lifetime 3600\n\nset vpn ipsec esp-group ESP-G proposal 1 encryption aes128\nset vpn ipsec esp-group ESP-G proposal 1 hash sha1\nset vpn ipsec esp-group ESP-G lifetime 1800\n\nset vpn ipsec nat-traversal enable\nset vpn ipsec nat-networks allowed-network $destNet\n\nset vpn ipsec site-to-site peer $destIP ike-group IKE-G\nset vpn ipsec site-to-site peer $destIP default-esp-group ESP-G\n\nset vpn ipsec site-to-site peer $destIP authentication mode pre-shared-secret\nset vpn ipsec site-to-site peer $destIP authentication pre-shared-secret my_shared_secret\n\nset vpn ipsec site-to-site peer $destIP authentication id $localID\nset vpn ipsec site-to-site peer $destIP authentication remote-id $destID\n\nset vpn ipsec site-to-site peer $destIP local-address $localIP\n\nset vpn ipsec site-to-site peer $destIP tunnel 1 local prefix $localNet\nset vpn ipsec site-to-site peer $destIP tunnel 1 remote prefix $destNet\n\ncommit\nsave\n```\n\n\u203b`my_shared_secret`\u306f\u5404\u74b0\u5883\u3067\u4efb\u610f\u306e\u30d1\u30b9\u30d5\u30ec\u30fc\u30ba\u3092\u6c7a\u3081\u308b\n\n\u4e21\u65b9\u306e\u8a2d\u5b9a\u5b8c\u4e86\u5f8c\u3001\u305d\u308c\u305e\u308c\u306eipsec\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u518d\u8d77\u52d5\u3059\u308b\u3002\n\n```\nsudo /etc/init.d/ipsec stop    #AWS\u5074\nsudo /etc/init.d/ipsec restart #\u81ea\u5b85\u5074\nsudo /etc/init.d/ipsec start   #AWS\u5074\n```\n\n\u52d5\u4f5c\u78ba\u8a8d\n\n```\nvyos@vyos# run show vpn ike sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\nYYY.YYY.YYY.YYY                         192.168.1.7                            \n\n    State  Encrypt  Hash    D-H Grp  NAT-T  A-Time  L-Time\n    -----  -------  ----    -------  -----  ------  ------\n    up     aes128   sha1    5        no     994     3600\n\nvyatta@vyatta# run show vpn ike sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\nXXX.XXX.XXX.XXX                         192.168.0.6                            \n\n    State  Encrypt  Hash  D-H Grp  NAT-T  A-Time  L-Time\n    -----  -------  ----  -------  -----  ------  ------\n    up     aes128   sha1  5        no     284     3600\n\n```\n\n#\u305d\u306e\u4ed6\u81ea\u5b85\u5074\u3067\u5b9f\u65bd\u3059\u308b\u3053\u3068\n\u74b0\u5883\u53ca\u3073\u88fd\u54c1\u306b\u3088\u3063\u3066\u7570\u306a\u308b\u3068\u601d\u3046\u304c\u3001\u5f53\u65b9\u306e\u74b0\u5883\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u3002\n##\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u8a2d\u5b9a\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-04-16 23.35.33.png](https://qiita-image-store.s3.amazonaws.com/0/64421/2cbc7a5d-69f8-9b0e-0d40-f367b337c701.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-04-16 23.35.33.png\")\n\n##\u5916\u90e8\u304b\u3089\u306e\u63a5\u7d9a\u3092\u81ea\u5b85\u5185\u306eVPN\u30b5\u30fc\u30d0\u306b\u5411\u3051\u308b\u8a2d\u5b9a\n![img.jpg](https://qiita-image-store.s3.amazonaws.com/0/64421/ee24b80c-f6e7-476b-8cba-b721b8b01426.jpeg \"img.jpg\")\n\n\n#\u52d5\u4f5c\u78ba\u8a8d\n\n```\n$ ssh -i ~/Downloads/VPN.pem.txt vyatta@10.0.1.6\nLinux vyatta 3.3.8-1-amd64-vyatta #1 SMP Wed Mar 13 10:35:28 PDT 2013 x86_64\nWelcome to Vyatta.\nThis system is open-source software. The exact distribution terms for \neach module comprising the full system are described in the individual \nfiles in /usr/share/doc/*/copyright.\nLast login: Thu Apr 16 14:13:48 2015 from ip-192-168-1-7.ap-northeast-1.compute.internal\nvyatta@vyatta:~$\n```\n\nVPC\u306ePrivate\u306aIP\u6307\u5b9a\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u305f\u3002\n\n", "tags": ["VyOS", "vyatta", "AWS", "VPN"]}