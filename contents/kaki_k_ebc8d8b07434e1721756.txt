{"tags": ["Python", "Django"], "context": " More than 1 year has passed since last update.\n\n\u5b50\u30e2\u30c7\u30eb\u306eCRUD\n\n\u5b50\u306e\u8aad\u307f\u65b9\n\u89aa\u306e\u66f8\u7c4d\u306b\u5bfe\u3057\u3066\u3001\u5b50\u306e\u611f\u60f3\u306e\u4e00\u89a7\u3092\u8868\u793a\u3057\u3066\u307f\u307e\u3059\u3002\ncms/models.py \u3067\u3001\u611f\u60f3\u306f\u66f8\u7c4d\u3092\u5916\u90e8\u30ad\u30fc\u3068\u3057\u3066\u6301\u3064\u3088\u3046\u5b9a\u7fa9\u3057\u307e\u3057\u305f\u3002\nclass Impression(models.Model):\n    \"\"\"\u611f\u60f3\"\"\"\n    book = models.ForeignKey(Book, verbose_name='\u66f8\u7c4d', related_name='impressions')\n    comment = models.TextField('\u30b3\u30e1\u30f3\u30c8', blank=True)\n\n\u3088\u3063\u3066\u3001\u66f8\u7c4d\u306b\u7d10\u3065\u304f\u5b50\u4f9b\u306e\u611f\u60f3\u306f\u3001related_name\u3092\u4f7f\u3063\u3066\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8aad\u307f\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3053\u3053\u3067\u3082 SQL \u306f\u66f8\u304d\u307e\u305b\u3093\u3002\nimpressions = book.impressions.all().order_by('id')   # \u66f8\u7c4d\u306e\u5b50\u4f9b\u306e\u3001\u611f\u60f3\u3092\u8aad\u3080\n\n\n\u5b50\u306e\u4e00\u89a7\u306e\u30d3\u30e5\u30fc\n\u4eca\u56de\u306f\u3001\u6c4e\u7528\u30d3\u30e5\u30fc \u306e ListView \u3092\u4f7f\u3063\u3066\u66f8\u3044\u3066\u307f\u307e\u3059\u3002\n\u3053\u308c\u3092\u4f7f\u3046\u3068\u3001\u30da\u30fc\u30b8\u30f3\u30b0\u306a\u3069\u304c\u7c21\u5358\u306b\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002\ncms/views.py \u306b\u4ee5\u4e0b\u306e\u8a18\u8ff0\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\nfrom django.views.generic.list import ListView\n  :\n\nclass ImpressionList(ListView):\n    \"\"\"\u611f\u60f3\u306e\u4e00\u89a7\"\"\"\n    context_object_name='impressions'\n    template_name='cms/impression_list.html'\n    paginate_by = 2  # \uff11\u30da\u30fc\u30b8\u306f\u6700\u59272\u4ef6\u305a\u3064\u3067\u30da\u30fc\u30b8\u30f3\u30b0\u3059\u308b\n\n    def get(self, request, *args, **kwargs):\n        book = get_object_or_404(Book, pk=kwargs['book_id'])  # \u89aa\u306e\u66f8\u7c4d\u3092\u8aad\u3080\n        impressions = book.impressions.all().order_by('id')   # \u66f8\u7c4d\u306e\u5b50\u4f9b\u306e\u3001\u611f\u60f3\u3092\u8aad\u3080\n        self.object_list = impressions\n\n        context = self.get_context_data(object_list=self.object_list, book=book)    \n        return self.render_to_response(context)\n\n\n\u5b50\u306e\u4e00\u89a7\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\nBootStrap\u3092\u5fdc\u7528\u3057\u3066\u3001\n\n\u30da\u30fc\u30b8\u30f3\u30b0\u3042\u308a\u306e\u6642\u3001\u300c\u524d\u3078\u30011\u30012\u3001\u6b21\u3078\u300d\u306a\u3069\u306e\u30da\u30fc\u30b8\u756a\u53f7\u3092\u8868\u3059\u30ea\u30f3\u30af\u3092\u7f6e\u304f\u3002\n\u524a\u9664\u3059\u308b\u6642\u3001\u3044\u304d\u306a\u308a\u6d88\u3059\u306e\u3067\u306f\u306a\u304f\u3001\u78ba\u8a8d\u306e\u30e2\u30fc\u30c0\u30eb\u30c0\u30a4\u30a2\u30ed\u30b0\u3092\u51fa\u3059\u3002\n\n\u3068\u3044\u3046\u3053\u3068\u3092\u3057\u3066\u3044\u307e\u3059\u3002\u3061\u3087\u3063\u3068\u9577\u3044\u3067\u3059\u3002\nmybook/cms/templates/base_html \u3092\u7d99\u627f\u3057\u3066 mybook/cms/templates/cms/impression_list.html \u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n{% extends \"base.html\" %}\n\n{% block title %}\u611f\u60f3\u306e\u4e00\u89a7{% endblock title %}\n\n{% block extrahead %}\n<script>\n$(function() {\n  $('.del_confirm').on('click', function () {\n     $(\"#del_pk\").text($(this).attr(\"pk\"));\n     $('#del_url').attr('href', $(this).attr(\"url\"));\n  });\n});\n</script>\n<style>\ntable {\n  margin-top: 8px;\n}\n</style>\n{% endblock %}\n\n{% block content %}\n    <h3 class=\"page-header\">\u611f\u60f3\u306e\u4e00\u89a7 <small>{{ book.name }}</small></h3>\n    <a href=\"{% url 'cms:impression_add' book_id=book.id %}\" class=\"btn btn-default btn-sm\">\u8ffd\u52a0</a>\n    <table class=\"table table-striped table-bordered\">\n      <thead>\n        <tr>\n          <th>ID</th>\n          <th>\u30b3\u30e1\u30f3\u30c8</th>\n          <th>\u64cd\u4f5c</th>\n        </tr>\n      </thead>\n      <tbody>\n        {% for impression in impressions %}\n        <tr>\n          <td>{{ impression.id }}</td>\n          <td>{{ impression.comment|linebreaksbr }}</td>\n          <td>\n            <a href=\"{% url 'cms:impression_mod' book_id=book.id impression_id=impression.id %}\" class=\"btn btn-default btn-sm\">\u4fee\u6b63</a>\n            <button class=\"btn btn-default btn-sm del_confirm\" data-toggle=\"modal\" data-target=\"#deleteModal\" pk=\"{{ impression.id }}\" url=\"{% url 'cms:impression_del' book_id=book.id impression_id=impression.id %}\">\u524a\u9664</button>\n          </td>\n        </tr>\n        {% endfor %}\n      </tbody>\n    </table>\n\n    {% if is_paginated %}\n    <ul class=\"pagination\">\n      {% if page_obj.has_previous %}\n        <li><a href=\"?page={{ page_obj.previous_page_number }}\">&laquo;</a></li>\n      {% else %}\n        <li class=\"disabled\"><a href=\"#\">&laquo;</a></li>\n      {% endif %}\n      {% for linkpage in page_obj.paginator.page_range %}\n        {% ifequal linkpage page_obj.number %}\n          <li  class=\"active\"><a href=\"#\">{{ linkpage }}</a></li>\n        {% else %}\n          <li><a href=\"?page={{ linkpage }}\">{{ linkpage }}</a></li>\n        {% endifequal %}\n      {% endfor %}\n      {% if page_obj.has_next %}\n        <li><a href=\"?page={{ page_obj.next_page_number }}\">&raquo;</a></li>\n      {% else %}\n        <li class=\"disabled\"><a href=\"#\">&raquo;</a></li>\n      {% endif %}\n    </ul>\n    {% endif %}\n\n    <div>\n      <a href=\"{% url 'cms:book_list' %}\" class=\"btn btn-default btn-sm\">\u623b\u308b</a>\n    </div>\n\n{# \u524a\u9664\u3092\u78ba\u8a8d\u3059\u308b\u30e2\u30fc\u30c0\u30eb \u30c0\u30a4\u30a2\u30ed\u30b0 #}\n<div class=\"modal fade\" id=\"deleteModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"deleteModalLabel\" aria-hidden=\"true\">\n  <div class=\"modal-dialog\">\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-hidden=\"true\">&times;</button>\n        <h4 class=\"modal-title\" id=\"deleteModalLabel\">\u78ba\u8a8d</h4>\n      </div>\n      <div class=\"modal-body\">\n        <p>ID: <span id=\"del_pk\"></span> \u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f</p>\n      </div>\n      <div class=\"modal-footer\">\n        <a href=\"#\" class=\"btn btn-primary\" id=\"del_url\">OK</a>\n        <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Cancel</button>\n      </div>\n    </div>\n  </div>\n</div>\n{% endblock content %}\n\n\u51fa\u6765\u4e0a\u304c\u308b\u4e00\u89a7\u30da\u30fc\u30b8\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u3082\u306e\u3068\u306a\u308a\u307e\u3059\u3002\n\n\n\u5b50\u306e\u8ffd\u52a0\u3001\u4fee\u6b63\u306e\u30d5\u30a9\u30fc\u30e0\ncms/forms.py \u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u3001cms/models.py \u306e Impression \u30e2\u30c7\u30eb\u3092\u8ffd\u52a0\u3001\u4fee\u6b63\u3059\u308b\u305f\u3081\u306e\u5143\u3068\u306a\u308b\u30d5\u30a9\u30fc\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n  :\nfrom cms.models import Book, Impression\n  :\n\nclass ImpressionForm(ModelForm):\n    \"\"\"\u611f\u60f3\u306e\u30d5\u30a9\u30fc\u30e0\"\"\"\n    class Meta:\n        model = Impression\n        fields = ('comment', )\n\n\n\u5b50\u306e\u8ffd\u52a0\u3001\u4fee\u6b63\u306e\u30d3\u30e5\u30fc\ncms/views.py \u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n  :\nfrom cms.models import Book, Impression\nfrom cms.forms import BookForm, ImpressionForm\n  :\n\ndef impression_edit(request, book_id, impression_id=None):\n    \"\"\"\u611f\u60f3\u306e\u7de8\u96c6\"\"\"\n    book = get_object_or_404(Book, pk=book_id)  # \u89aa\u306e\u66f8\u7c4d\u3092\u8aad\u3080\n    if impression_id:   # impression_id \u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b (\u4fee\u6b63\u6642)\n        impression = get_object_or_404(Impression, pk=impression_id)\n    else:               # impression_id \u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044 (\u8ffd\u52a0\u6642)\n        impression = Impression()\n\n    if request.method == 'POST':\n        form = ImpressionForm(request.POST, instance=impression)  # POST \u3055\u308c\u305f request \u30c7\u30fc\u30bf\u304b\u3089\u30d5\u30a9\u30fc\u30e0\u3092\u4f5c\u6210\n        if form.is_valid():    # \u30d5\u30a9\u30fc\u30e0\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\n            impression = form.save(commit=False)\n            impression.book = book  # \u3053\u306e\u611f\u60f3\u306e\u3001\u89aa\u306e\u66f8\u7c4d\u3092\u30bb\u30c3\u30c8\n            impression.save()\n            return redirect('cms:impression_list', book_id=book_id)\n    else:    # GET \u306e\u6642\n        form = ImpressionForm(instance=impression)  # impression \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u30d5\u30a9\u30fc\u30e0\u3092\u4f5c\u6210\n\n    return render(request,\n                  'cms/impression_edit.html',\n                  dict(form=form, book_id=book_id, impression_id=impression_id))\n\n\n\u5b50\u306e\u8ffd\u52a0\u3001\u4fee\u6b63\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\nmybook/templates/base_html \u3092\u7d99\u627f\u3057\u3066 mybook/cms/templates/cms/impression_edit.html \u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n{% extends \"base.html\" %}\n{% load bootstrap %}\n\n{% block title %}\u611f\u60f3\u306e\u7de8\u96c6{% endblock title %}\n\n{% block content %}\n    <h3 class=\"page-header\">\u611f\u60f3\u306e\u7de8\u96c6</h3>\n    {% if impression_id %}\n    <form action=\"{% url 'cms:impression_mod' book_id=book_id impression_id=impression_id %}\" method=\"post\" class=\"form-horizontal\" role=\"form\">\n    {% else %}\n    <form action=\"{% url 'cms:impression_add' book_id=book_id %}\" method=\"post\" class=\"form-horizontal\" role=\"form\">\n    {% endif %}\n      {% csrf_token %}\n      {{ form|bootstrap_horizontal }}\n      <div class=\"form-group\">\n        <div class=\"col-sm-offset-2 col-sm-10\">\n          <button type=\"submit\" class=\"btn btn-primary\">\u9001\u4fe1</button>\n        </div>\n      </div>\n    </form>\n    <a href=\"{% url 'cms:impression_list' book_id=book_id %}\" class=\"btn btn-default btn-sm\">\u623b\u308b</a>\n{% endblock content %}\n\n\u8ffd\u52a0\u3001\u4fee\u6b63\u306e\u30da\u30fc\u30b8\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n\u5b50\u306e\u524a\u9664\u306e\u30d3\u30e5\u30fc\ncms/views.py \u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f\u3001\u3044\u304d\u306a\u308a\u6d88\u3055\u305a\u306b\u3001Bootstrap \u306e \u30e2\u30fc\u30c0\u30eb\u30c0\u30a4\u30a2\u30ed\u30b0\u3092\u51fa\u3057\u3066\u3001\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u51fa\u3057\u3066\u3044\u307e\u3059\u3002\n\u305f\u3060\u3001\u30d3\u30e5\u30fc\u306e\u4e2d\u8eab\u306f\u3001\u89aa\u306e\u66f8\u7c4d\u306e\u6642\u3068\u5909\u308f\u308a\u307e\u305b\u3093\u3002\ndef impression_del(request, book_id, impression_id):\n    \"\"\"\u611f\u60f3\u306e\u524a\u9664\"\"\"\n    impression = get_object_or_404(Impression, pk=impression_id)\n    impression.delete()\n    return redirect('cms:impression_list', book_id=book_id)\n\n\n\n\u5b50\u306eURL\u30b9\u30ad\u30fc\u30e0\ncms/urls.py \u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\nurlpatterns = [\n    :\n\n    # \u611f\u60f3\n    url(r'^impression/(?P<book_id>\\d+)/$', views.ImpressionList.as_view(), name='impression_list'),  # \u4e00\u89a7\n    url(r'^impression/add/(?P<book_id>\\d+)/$', views.impression_edit, name='impression_add'),        # \u767b\u9332\n    url(r'^impression/mod/(?P<book_id>\\d+)/(?P<impression_id>\\d+)/$', views.impression_edit, name='impression_mod'),  # \u4fee\u6b63\n    url(r'^impression/del/(?P<book_id>\\d+)/(?P<impression_id>\\d+)/$', views.impression_del, name='impression_del'),   # \u524a\u9664\n]\n\n\n\u89aa\u306e\u4e00\u89a7\u306e\u4fee\u6b63\n\u89aa\u306e\u66f8\u7c4d\u306e\u4e00\u89a7\u304b\u3089\u3001\u8a72\u5f53\u3059\u308b\u66f8\u7c4d\u306e\u300c\u611f\u60f3\u4e00\u89a7\u300d\u304c\u51fa\u305b\u308b\u3088\u3046\u3001\u30ea\u30f3\u30af\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\nmybook/cms/templates/cms/book_list.html \u306b1\u884c\u8ffd\u52a0\u3057\u307e\u3059\u3002\n          <td>\n            <a href=\"{% url 'cms:book_mod' book_id=book.id %}\" class=\"btn btn-default btn-sm\">\u4fee\u6b63</a>\n            <a href=\"{% url 'cms:book_del' book_id=book.id %}\" class=\"btn btn-default btn-sm\">\u524a\u9664</a>\n            <a href=\"{% url 'cms:impression_list' book_id=book.id %}\" class=\"btn btn-default btn-sm btn-primary\">\u611f\u60f3\u306e\u4e00\u89a7</a>\n          </td>\n\n\n\u305d\u308c\u3067\u306f\u3001\u30ed\u30fc\u30ab\u30eb\u30b5\u30fc\u30d0\u3092\u8d77\u52d5\u3057\u3001\u300c\u66f8\u7c4d\u306e\u4e00\u89a7\u300d\u304b\u3089\u300c\u611f\u60f3\u306e\u4e00\u89a7\u300d\u3092\u305f\u3069\u3063\u3066\u3001\u611f\u60f3\u306e\u767b\u9332\uff0f\u4fee\u6b63\uff0f\u524a\u9664\u3092\u884c\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\nhttp://127.0.0.1:8000/cms/book/\n\n\u3053\u3053\u307e\u3067\u306e\u8aac\u660e\u306e\u3088\u3046\u306b\u89aa\u5b50\u95a2\u4fc2\u306e\u3042\u308b\u30e2\u30c7\u30eb\u306eCRUD\u304c\u3067\u304d\u308c\u3070\u3001\u5f8c\u306f\u30e2\u30c7\u30eb\u3092\u3069\u3046\u8a2d\u8a08\u3059\u308b\u304b\u3068\u3044\u3046\u3053\u3068\u306a\u306e\u3067\u3001\u5fdc\u7528\u3057\u3066\u8272\u3005\u306a\u3082\u306e\u304c\u4f5c\u308c\u308b\u3068\u601d\u3044\u307e\u3059\u3002\nPython Django\u5165\u9580 (6) \u306b\u7d9a\u304d\u307e\u3059\u3002\n\n\u5b50\u30e2\u30c7\u30eb\u306eCRUD\n-------------\n\n### \u5b50\u306e\u8aad\u307f\u65b9\n\n\u89aa\u306e\u66f8\u7c4d\u306b\u5bfe\u3057\u3066\u3001\u5b50\u306e\u611f\u60f3\u306e\u4e00\u89a7\u3092\u8868\u793a\u3057\u3066\u307f\u307e\u3059\u3002\n\n`cms/models.py` \u3067\u3001\u611f\u60f3\u306f\u66f8\u7c4d\u3092\u5916\u90e8\u30ad\u30fc\u3068\u3057\u3066\u6301\u3064\u3088\u3046\u5b9a\u7fa9\u3057\u307e\u3057\u305f\u3002\n\n```python\nclass Impression(models.Model):\n    \"\"\"\u611f\u60f3\"\"\"\n    book = models.ForeignKey(Book, verbose_name='\u66f8\u7c4d', related_name='impressions')\n    comment = models.TextField('\u30b3\u30e1\u30f3\u30c8', blank=True)\n```\n\n\u3088\u3063\u3066\u3001\u66f8\u7c4d\u306b\u7d10\u3065\u304f\u5b50\u4f9b\u306e\u611f\u60f3\u306f\u3001related_name\u3092\u4f7f\u3063\u3066\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8aad\u307f\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002  \n\u3053\u3053\u3067\u3082 SQL \u306f\u66f8\u304d\u307e\u305b\u3093\u3002\n\n```python\nimpressions = book.impressions.all().order_by('id')   # \u66f8\u7c4d\u306e\u5b50\u4f9b\u306e\u3001\u611f\u60f3\u3092\u8aad\u3080\n```\n\n### \u5b50\u306e\u4e00\u89a7\u306e\u30d3\u30e5\u30fc\n\n\u4eca\u56de\u306f\u3001`\u6c4e\u7528\u30d3\u30e5\u30fc` \u306e ListView \u3092\u4f7f\u3063\u3066\u66f8\u3044\u3066\u307f\u307e\u3059\u3002  \n\u3053\u308c\u3092\u4f7f\u3046\u3068\u3001\u30da\u30fc\u30b8\u30f3\u30b0\u306a\u3069\u304c\u7c21\u5358\u306b\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002\n\n`cms/views.py` \u306b\u4ee5\u4e0b\u306e\u8a18\u8ff0\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```python\nfrom django.views.generic.list import ListView\n  :\n\nclass ImpressionList(ListView):\n    \"\"\"\u611f\u60f3\u306e\u4e00\u89a7\"\"\"\n    context_object_name='impressions'\n    template_name='cms/impression_list.html'\n    paginate_by = 2  # \uff11\u30da\u30fc\u30b8\u306f\u6700\u59272\u4ef6\u305a\u3064\u3067\u30da\u30fc\u30b8\u30f3\u30b0\u3059\u308b\n\n    def get(self, request, *args, **kwargs):\n        book = get_object_or_404(Book, pk=kwargs['book_id'])  # \u89aa\u306e\u66f8\u7c4d\u3092\u8aad\u3080\n        impressions = book.impressions.all().order_by('id')   # \u66f8\u7c4d\u306e\u5b50\u4f9b\u306e\u3001\u611f\u60f3\u3092\u8aad\u3080\n        self.object_list = impressions\n        \n        context = self.get_context_data(object_list=self.object_list, book=book)    \n        return self.render_to_response(context)\n```\n\n### \u5b50\u306e\u4e00\u89a7\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n\nBootStrap\u3092\u5fdc\u7528\u3057\u3066\u3001\n\n* \u30da\u30fc\u30b8\u30f3\u30b0\u3042\u308a\u306e\u6642\u3001\u300c\u524d\u3078\u30011\u30012\u3001\u6b21\u3078\u300d\u306a\u3069\u306e\u30da\u30fc\u30b8\u756a\u53f7\u3092\u8868\u3059\u30ea\u30f3\u30af\u3092\u7f6e\u304f\u3002\n* \u524a\u9664\u3059\u308b\u6642\u3001\u3044\u304d\u306a\u308a\u6d88\u3059\u306e\u3067\u306f\u306a\u304f\u3001\u78ba\u8a8d\u306e\u30e2\u30fc\u30c0\u30eb\u30c0\u30a4\u30a2\u30ed\u30b0\u3092\u51fa\u3059\u3002\n\n\u3068\u3044\u3046\u3053\u3068\u3092\u3057\u3066\u3044\u307e\u3059\u3002\u3061\u3087\u3063\u3068\u9577\u3044\u3067\u3059\u3002\n\n`mybook/cms/templates/base_html` \u3092\u7d99\u627f\u3057\u3066 `mybook/cms/templates/cms/impression_list.html` \u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\n{% extends \"base.html\" %}\n\n{% block title %}\u611f\u60f3\u306e\u4e00\u89a7{% endblock title %}\n\n{% block extrahead %}\n<script>\n$(function() {\n  $('.del_confirm').on('click', function () {\n     $(\"#del_pk\").text($(this).attr(\"pk\"));\n     $('#del_url').attr('href', $(this).attr(\"url\"));\n  });\n});\n</script>\n<style>\ntable {\n  margin-top: 8px;\n}\n</style>\n{% endblock %}\n\n{% block content %}\n    <h3 class=\"page-header\">\u611f\u60f3\u306e\u4e00\u89a7 <small>{{ book.name }}</small></h3>\n    <a href=\"{% url 'cms:impression_add' book_id=book.id %}\" class=\"btn btn-default btn-sm\">\u8ffd\u52a0</a>\n    <table class=\"table table-striped table-bordered\">\n      <thead>\n        <tr>\n          <th>ID</th>\n          <th>\u30b3\u30e1\u30f3\u30c8</th>\n          <th>\u64cd\u4f5c</th>\n        </tr>\n      </thead>\n      <tbody>\n        {% for impression in impressions %}\n        <tr>\n          <td>{{ impression.id }}</td>\n          <td>{{ impression.comment|linebreaksbr }}</td>\n          <td>\n            <a href=\"{% url 'cms:impression_mod' book_id=book.id impression_id=impression.id %}\" class=\"btn btn-default btn-sm\">\u4fee\u6b63</a>\n            <button class=\"btn btn-default btn-sm del_confirm\" data-toggle=\"modal\" data-target=\"#deleteModal\" pk=\"{{ impression.id }}\" url=\"{% url 'cms:impression_del' book_id=book.id impression_id=impression.id %}\">\u524a\u9664</button>\n          </td>\n        </tr>\n        {% endfor %}\n      </tbody>\n    </table>\n\n    {% if is_paginated %}\n    <ul class=\"pagination\">\n      {% if page_obj.has_previous %}\n        <li><a href=\"?page={{ page_obj.previous_page_number }}\">&laquo;</a></li>\n      {% else %}\n        <li class=\"disabled\"><a href=\"#\">&laquo;</a></li>\n      {% endif %}\n      {% for linkpage in page_obj.paginator.page_range %}\n        {% ifequal linkpage page_obj.number %}\n          <li  class=\"active\"><a href=\"#\">{{ linkpage }}</a></li>\n        {% else %}\n          <li><a href=\"?page={{ linkpage }}\">{{ linkpage }}</a></li>\n        {% endifequal %}\n      {% endfor %}\n      {% if page_obj.has_next %}\n        <li><a href=\"?page={{ page_obj.next_page_number }}\">&raquo;</a></li>\n      {% else %}\n        <li class=\"disabled\"><a href=\"#\">&raquo;</a></li>\n      {% endif %}\n    </ul>\n    {% endif %}\n\n    <div>\n      <a href=\"{% url 'cms:book_list' %}\" class=\"btn btn-default btn-sm\">\u623b\u308b</a>\n    </div>\n\n{# \u524a\u9664\u3092\u78ba\u8a8d\u3059\u308b\u30e2\u30fc\u30c0\u30eb \u30c0\u30a4\u30a2\u30ed\u30b0 #}\n<div class=\"modal fade\" id=\"deleteModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"deleteModalLabel\" aria-hidden=\"true\">\n  <div class=\"modal-dialog\">\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-hidden=\"true\">&times;</button>\n        <h4 class=\"modal-title\" id=\"deleteModalLabel\">\u78ba\u8a8d</h4>\n      </div>\n      <div class=\"modal-body\">\n        <p>ID: <span id=\"del_pk\"></span> \u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f</p>\n      </div>\n      <div class=\"modal-footer\">\n        <a href=\"#\" class=\"btn btn-primary\" id=\"del_url\">OK</a>\n        <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Cancel</button>\n      </div>\n    </div>\n  </div>\n</div>\n{% endblock content %}\n```\n\n\u51fa\u6765\u4e0a\u304c\u308b\u4e00\u89a7\u30da\u30fc\u30b8\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u3082\u306e\u3068\u306a\u308a\u307e\u3059\u3002\n\n![cms03.jpg](https://qiita-image-store.s3.amazonaws.com/0/48136/715a9833-84ca-2184-7687-2fd4f83c6dcd.jpeg \"cms03.jpg\")\n\n\n### \u5b50\u306e\u8ffd\u52a0\u3001\u4fee\u6b63\u306e\u30d5\u30a9\u30fc\u30e0\n\n`cms/forms.py` \u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002  \n\u3053\u3053\u3067\u306f\u3001`cms/models.py` \u306e Impression \u30e2\u30c7\u30eb\u3092\u8ffd\u52a0\u3001\u4fee\u6b63\u3059\u308b\u305f\u3081\u306e\u5143\u3068\u306a\u308b\u30d5\u30a9\u30fc\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```python\n  :\nfrom cms.models import Book, Impression\n  :\n\nclass ImpressionForm(ModelForm):\n    \"\"\"\u611f\u60f3\u306e\u30d5\u30a9\u30fc\u30e0\"\"\"\n    class Meta:\n        model = Impression\n        fields = ('comment', )\n```\n\n### \u5b50\u306e\u8ffd\u52a0\u3001\u4fee\u6b63\u306e\u30d3\u30e5\u30fc\n\n`cms/views.py` \u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```python\n  :\nfrom cms.models import Book, Impression\nfrom cms.forms import BookForm, ImpressionForm\n  :\n\ndef impression_edit(request, book_id, impression_id=None):\n    \"\"\"\u611f\u60f3\u306e\u7de8\u96c6\"\"\"\n    book = get_object_or_404(Book, pk=book_id)  # \u89aa\u306e\u66f8\u7c4d\u3092\u8aad\u3080\n    if impression_id:   # impression_id \u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b (\u4fee\u6b63\u6642)\n        impression = get_object_or_404(Impression, pk=impression_id)\n    else:               # impression_id \u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044 (\u8ffd\u52a0\u6642)\n        impression = Impression()\n\n    if request.method == 'POST':\n        form = ImpressionForm(request.POST, instance=impression)  # POST \u3055\u308c\u305f request \u30c7\u30fc\u30bf\u304b\u3089\u30d5\u30a9\u30fc\u30e0\u3092\u4f5c\u6210\n        if form.is_valid():    # \u30d5\u30a9\u30fc\u30e0\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\n            impression = form.save(commit=False)\n            impression.book = book  # \u3053\u306e\u611f\u60f3\u306e\u3001\u89aa\u306e\u66f8\u7c4d\u3092\u30bb\u30c3\u30c8\n            impression.save()\n            return redirect('cms:impression_list', book_id=book_id)\n    else:    # GET \u306e\u6642\n        form = ImpressionForm(instance=impression)  # impression \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u30d5\u30a9\u30fc\u30e0\u3092\u4f5c\u6210\n        \n    return render(request,\n                  'cms/impression_edit.html',\n                  dict(form=form, book_id=book_id, impression_id=impression_id))\n```\n\n### \u5b50\u306e\u8ffd\u52a0\u3001\u4fee\u6b63\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n\n`mybook/templates/base_html` \u3092\u7d99\u627f\u3057\u3066 `mybook/cms/templates/cms/impression_edit.html` \u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\n{% extends \"base.html\" %}\n{% load bootstrap %}\n\n{% block title %}\u611f\u60f3\u306e\u7de8\u96c6{% endblock title %}\n\n{% block content %}\n    <h3 class=\"page-header\">\u611f\u60f3\u306e\u7de8\u96c6</h3>\n    {% if impression_id %}\n    <form action=\"{% url 'cms:impression_mod' book_id=book_id impression_id=impression_id %}\" method=\"post\" class=\"form-horizontal\" role=\"form\">\n    {% else %}\n    <form action=\"{% url 'cms:impression_add' book_id=book_id %}\" method=\"post\" class=\"form-horizontal\" role=\"form\">\n    {% endif %}\n      {% csrf_token %}\n      {{ form|bootstrap_horizontal }}\n      <div class=\"form-group\">\n        <div class=\"col-sm-offset-2 col-sm-10\">\n          <button type=\"submit\" class=\"btn btn-primary\">\u9001\u4fe1</button>\n        </div>\n      </div>\n    </form>\n    <a href=\"{% url 'cms:impression_list' book_id=book_id %}\" class=\"btn btn-default btn-sm\">\u623b\u308b</a>\n{% endblock content %}\n```\n\n\u8ffd\u52a0\u3001\u4fee\u6b63\u306e\u30da\u30fc\u30b8\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n![cms04.jpg](https://qiita-image-store.s3.amazonaws.com/0/48136/40376edb-2c27-444d-833c-eb210becc47b.jpeg \"cms04.jpg\")\n\n\n### \u5b50\u306e\u524a\u9664\u306e\u30d3\u30e5\u30fc\n\n`cms/views.py` \u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\u4eca\u56de\u306f\u3001\u3044\u304d\u306a\u308a\u6d88\u3055\u305a\u306b\u3001Bootstrap \u306e \u30e2\u30fc\u30c0\u30eb\u30c0\u30a4\u30a2\u30ed\u30b0\u3092\u51fa\u3057\u3066\u3001\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u51fa\u3057\u3066\u3044\u307e\u3059\u3002\n\u305f\u3060\u3001\u30d3\u30e5\u30fc\u306e\u4e2d\u8eab\u306f\u3001\u89aa\u306e\u66f8\u7c4d\u306e\u6642\u3068\u5909\u308f\u308a\u307e\u305b\u3093\u3002\n\n```python\ndef impression_del(request, book_id, impression_id):\n    \"\"\"\u611f\u60f3\u306e\u524a\u9664\"\"\"\n    impression = get_object_or_404(Impression, pk=impression_id)\n    impression.delete()\n    return redirect('cms:impression_list', book_id=book_id)\n```\n\n![cms05.jpg](https://qiita-image-store.s3.amazonaws.com/0/48136/afdedc17-7b38-3afc-abd6-ed73b9b63438.jpeg \"cms05.jpg\")\n\n\n### \u5b50\u306eURL\u30b9\u30ad\u30fc\u30e0\n\n`cms/urls.py` \u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```python\nurlpatterns = [\n    :\n\n    # \u611f\u60f3\n    url(r'^impression/(?P<book_id>\\d+)/$', views.ImpressionList.as_view(), name='impression_list'),  # \u4e00\u89a7\n    url(r'^impression/add/(?P<book_id>\\d+)/$', views.impression_edit, name='impression_add'),        # \u767b\u9332\n    url(r'^impression/mod/(?P<book_id>\\d+)/(?P<impression_id>\\d+)/$', views.impression_edit, name='impression_mod'),  # \u4fee\u6b63\n    url(r'^impression/del/(?P<book_id>\\d+)/(?P<impression_id>\\d+)/$', views.impression_del, name='impression_del'),   # \u524a\u9664\n]\n```\n\n### \u89aa\u306e\u4e00\u89a7\u306e\u4fee\u6b63\n\n\u89aa\u306e\u66f8\u7c4d\u306e\u4e00\u89a7\u304b\u3089\u3001\u8a72\u5f53\u3059\u308b\u66f8\u7c4d\u306e\u300c\u611f\u60f3\u4e00\u89a7\u300d\u304c\u51fa\u305b\u308b\u3088\u3046\u3001\u30ea\u30f3\u30af\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n`mybook/cms/templates/cms/book_list.html` \u306b1\u884c\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```\n          <td>\n            <a href=\"{% url 'cms:book_mod' book_id=book.id %}\" class=\"btn btn-default btn-sm\">\u4fee\u6b63</a>\n            <a href=\"{% url 'cms:book_del' book_id=book.id %}\" class=\"btn btn-default btn-sm\">\u524a\u9664</a>\n            <a href=\"{% url 'cms:impression_list' book_id=book.id %}\" class=\"btn btn-default btn-sm btn-primary\">\u611f\u60f3\u306e\u4e00\u89a7</a>\n          </td>\n```\n\n![cms06.jpg](https://qiita-image-store.s3.amazonaws.com/0/48136/36e5eefd-01e8-08ee-0b84-848b1e5ddb82.jpeg \"cms06.jpg\")\n\n\n\u305d\u308c\u3067\u306f\u3001\u30ed\u30fc\u30ab\u30eb\u30b5\u30fc\u30d0\u3092\u8d77\u52d5\u3057\u3001\u300c\u66f8\u7c4d\u306e\u4e00\u89a7\u300d\u304b\u3089\u300c\u611f\u60f3\u306e\u4e00\u89a7\u300d\u3092\u305f\u3069\u3063\u3066\u3001\u611f\u60f3\u306e\u767b\u9332\uff0f\u4fee\u6b63\uff0f\u524a\u9664\u3092\u884c\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```bash\nhttp://127.0.0.1:8000/cms/book/\n```\n\n\u3053\u3053\u307e\u3067\u306e\u8aac\u660e\u306e\u3088\u3046\u306b\u89aa\u5b50\u95a2\u4fc2\u306e\u3042\u308b\u30e2\u30c7\u30eb\u306eCRUD\u304c\u3067\u304d\u308c\u3070\u3001\u5f8c\u306f\u30e2\u30c7\u30eb\u3092\u3069\u3046\u8a2d\u8a08\u3059\u308b\u304b\u3068\u3044\u3046\u3053\u3068\u306a\u306e\u3067\u3001\u5fdc\u7528\u3057\u3066\u8272\u3005\u306a\u3082\u306e\u304c\u4f5c\u308c\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n[Python Django\u5165\u9580 (6)](http://qiita.com/kaki_k/items/b76acaeab8a9d935c35c) \u306b\u7d9a\u304d\u307e\u3059\u3002\n"}