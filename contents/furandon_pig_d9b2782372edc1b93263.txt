{"tags": ["NetBSD", "AdventCalendar"], "context": " More than 1 year has passed since last update.\n\nNetBSD\u30ab\u30fc\u30cd\u30eb\u3092\u30d3\u30eb\u30c9\u3057\u3066\u307f\u308b\n\u4eca\u65e5\u306eNetBSD Advent Calendar\u3067\u306f\u3001NetBSD\u30ab\u30fc\u30cd\u30eb\u306e\u30d3\u30eb\u30c9\u624b\u9806\u306b\u3064\u3044\u3066\u66f8\u3044\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nNetBSD\u30ab\u30fc\u30cd\u30eb\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u7528\u610f\u3059\u308b\n\n\u30bd\u30fc\u30b9CD(ISO\u30a4\u30e1\u30fc\u30b8)\u306e\u5165\u624b\n\u307e\u305a\u306f\u30ab\u30fc\u30cd\u30eb\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u7528\u610f\u3057\u307e\u3059\u3002NetBSD\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30ebCD-ROM\u914d\u5e03\u30b5\u30a4\u30c8\u304b\u3089\u3001\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u4e00\u5f0f\u304c\u5165\u3063\u305fISO\u30a4\u30e1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\nftp://iso4.jp.NetBSD.org/pub/NetBSD/iso/6.1.5/NetBSD-6.1.5-source.iso\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305fNetBSD-6.1.5-source.iso\u3092\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u306eCD-ROM\u3068\u3057\u3066\u63a5\u7d9a\u3057\u307e\u3059\u3002\n\n\u3042\u3068\u306f\u666e\u901a\u306bNetBSD\u304b\u3089mount\u3059\u308b\u3060\u3051\u3067OK\u3067\u3059\u3002\n\n\u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u3092\u5c55\u958b\u3059\u308b\n$ sudo mount /dev/cd0a /mnt\n$ mount | grep mnt\n/dev/cd0a on /mnt type cd9660 (read-only, local)\n$ df -h | grep mnt\n/dev/cd0a          432M       432M         0B 100% /mnt\n\n\u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u306f.tgz\u306e\u5f62\u3067\u683c\u7d0d\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n$ find /mnt/ | grep \\.tgz$\n/mnt/source/sets/gnusrc.tgz\n/mnt/source/sets/sharesrc.tgz\n/mnt/source/sets/src.tgz\n/mnt/source/sets/syssrc.tgz\n/mnt/source/sets/xsrc.tgz\n\n\u5404.tgz\u30d5\u30a1\u30a4\u30eb\u306f\u3001\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304b\u3089\u898b\u3066./usr/\u4ee5\u4e0b\u306b\u5c55\u958b\u3055\u308c\u308b\u5f62\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n$ for i in `find /mnt/ | grep \\.tgz$`;do tar ztvf $i | head -n1; done 2> /dev/null\ndrwxrwxr-x  2 root     wsrc           0 Sep 29 16:17 usr/src/gnu\ndrwxrwxr-x  2 root     wsrc           0 Sep 29 16:17 usr/src/share\ndrwxrwxr-x  2 root     wsrc           0 Sep 29 16:17 usr/src\ndrwxrwxr-x  2 root     wsrc           0 Sep 29 16:17 usr/src\ndrwxrwxr-x  2 root     wsrc           0 Sep 29 16:17 usr/xsrc\n\n\u6163\u7fd2\u7684\u306b\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u5c55\u958b\u5148\u306f/usr/src/\u306a\u306e\u3067\u3001\u305d\u308c\u306b\u5023\u3044\u5c55\u958b\u3057\u307e\u3059\u3002tar\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\"-C /\"\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001\u5c55\u958b\u5148\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3067\u304d\u307e\u3059\u3002\nroot\u30e6\u30fc\u30b6\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3001\u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u4e00\u5f0f\u3092\u5c55\u958b\u3057\u307e\u3059\u3002\n$ sudo -i\nkimiuso# for i in `find /mnt/ | grep \\.tgz$`; do tar zxvf $i -C / ; done\n\n\u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u304c\u5c55\u958b\u3055\u308c\u305f\u5f8c\u306e/usr/src/\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u5168\u4f53\u306e\u30b5\u30a4\u30ba\u306f1.6GB\u307b\u3069\u306e\u3088\u3046\u3067\u3059\u306d\u3002\n$ ls -F /usr/src/\nBUILDING        common/         external/       regress/        usr.bin/\nCVS/            compat/         extsrc/         rescue/         usr.sbin/\nMakefile        crypto/         games/          sbin/           x11/\nMakefile.inc    dist/           gnu/            share/\nUPDATING        distrib/        include/        sys/\nbin/            doc/            lib/            tests/\nbuild.sh*       etc/            libexec/        tools/\n$ du -h /usr/src/ | tail -n1\n1.6G    /usr/src/\n\n\nISO\u30a4\u30e1\u30fc\u30b8\u3092CD\u306e\u3088\u3046\u306bmount\u3059\u308b\n\u86c7\u8db3\u306b\u306a\u308a\u307e\u3059\u304c\u3001ISO\u30a4\u30e1\u30fc\u30b8\u81ea\u4f53\u3092mount\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\u5834\u5408\u306b\u3088\u3063\u3066\u306f\u3053\u3061\u3089\u306e\u65b9\u304c\u624b\u9806\u7684\u306b\u306f\u697d\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\nvnconfig\u30b3\u30de\u30f3\u30c9\u306b\u3088\u308a\u3001ISO\u30a4\u30e1\u30fc\u30b8\u3092\u64ec\u4f3c\u7684\u306a\u30c7\u30a3\u30b9\u30af\u30c7\u30d0\u30a4\u30b9\u306b\u898b\u305b\u304b\u3051\u3001\u305d\u308c\u3092mount\u3059\u308b\u3068\u3044\u3046\u5f62\u306b\u306a\u308a\u307e\u3059\u3002\n(Linux\u3060\u3068mount -o loopback\u3068\u304b\u3060\u3063\u305f\u3088\u3046\u306a...)\n$ ls NetBSD-6.1.5-source.iso\nNetBSD-6.1.5-source.iso\n$ sudo vnconfig vnd0 NetBSD-6.1.5-source.iso\n$ sudo vnconfig -l\nvnd0: / (/dev/wd0a) inode 1562384\nvnd1: not in use\nvnd2: not in use\nvnd3: not in use\n$ sudo mount -t cd9660 /dev/vnd0a /mnt\n$ mount | grep mnt\n/dev/vnd0a on /mnt type cd9660 (read-only, local)\n$ df -h | grep mnt\n/dev/vnd0a         432M       432M         0B 100% /mnt\n\nmount\u3057\u3066\u3057\u307e\u3048\u3070\u3001\u5f8c\u306e\u624b\u9806\u306fCD-ROM\u3068\u540c\u3058\u3067\u3059\u3002\u4f7f\u3044\u7d42\u308f\u3063\u305f\u3089\u3001\u4ee5\u4e0b\u306e\u624b\u9806\u3067unmount\u3057\u3001\u7591\u4f3c\u30c7\u30d0\u30a4\u30b9\u304b\u3089\u3082\u5916\u3057\u307e\u3059\u3002\n$ sudo umount /mnt\n$ sudo vnconfig -u vnd0\n$ sudo vnconfig -l\nvnd0: not in use\nvnd1: not in use\nvnd2: not in use\nvnd3: not in use\n\n\n\u30ab\u30fc\u30cd\u30eb\u306e\u30d3\u30eb\u30c9\n\u3067\u306f\u65e9\u901f\u3001\u5c55\u958b\u3057\u305f\u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u304b\u3089NetBSD\u30ab\u30fc\u30cd\u30eb\u3092\u30d3\u30eb\u30c9\u3057\u3066\u307f\u307e\u3059\u3002\n\u307e\u305a\u3001\u30ab\u30fc\u30cd\u30eb\u30d3\u30eb\u30c9\u6642\u306b\u7d44\u307f\u8fbc\u3080\u30c7\u30d0\u30a4\u30b9\u3084\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b\u305f\u3081\u306e\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u3001\u30ab\u30fc\u30cd\u30eb\u30b3\u30f3\u30d5\u30a3\u30ae\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u30d5\u30a1\u30a4\u30eb\u3068\u3044\u3046\u3082\u306e\u304c\u3042\u308a\u307e\u3059\u3002\n\u9577\u3063\u305f\u3089\u3057\u3044\u547c\u3073\u540d\u306a\u306e\u3067\u3001\u5358\u306b\u300cconfig\u30d5\u30a1\u30a4\u30eb\u300d\u3068\u547c\u3070\u308c\u308b\u3053\u3068\u3082\u3042\u308a\u307e\u3059\u3002\u4ee5\u964d\u306f\u300cconfig\u30d5\u30a1\u30a4\u30eb\u300d\u3068\u3044\u3046\u8868\u8a18\u3067\u8aac\u660e\u3057\u307e\u3059\u3002\n\u4f8b\u3048\u3070NetBSD-amd64\u306e\u5834\u5408\u306econfig\u30d5\u30a1\u30a4\u30eb\u306f/usr/src/sys/arch/amd64/conf/\u306b\u3042\u308a\u307e\u3059\u3002NetBSD\u306f\u8907\u6570\u306eCPU\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3067\u52d5\u4f5c\u3059\u308b\u306e\u3067\u3001arch/{CPU\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u540d}\u306e\u4e0b\u306bconfig\u304c\u7f6e\u304b\u308c\u3066\u3044\u308b\u69cb\u6210\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n$ cd /usr/src/sys/arch/amd64/conf/\n$ ls -F\nCVS/                Makefile.amd64      kern.ldscript       majors.amd64\nGENERIC             XEN3_DOM0           kern.ldscript.2MB   std.amd64\nINSTALL             XEN3_DOMU           kern.ldscript.Xen   std.xen\nINSTALL_XEN3_DOMU   files.amd64         largepages.inc\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30ebCD\u3067\u306f\u300cGENERIC\u30ab\u30fc\u30cd\u30eb\u300d\u3068\u3044\u3046\u3001\u4e00\u822c\u7684\u306a\u30ab\u30fc\u30cd\u30eb\u69cb\u6210\u3067\u30d3\u30eb\u30c9\u3055\u308c\u305f\u30ab\u30fc\u30cd\u30eb\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3059\u3002GENERIC\u30ab\u30fc\u30cd\u30eb\u306econfig\u30d5\u30a1\u30a4\u30eb\u306f\u3001\u305d\u306e\u540d\u524d\u306e\u901a\u308a\u3001GENERIC\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3053\u306eGENERIC\u306aconfig\u30d5\u30a1\u30a4\u30eb\u3001\u30b3\u30e1\u30f3\u30c8\u306b\u3044\u308d\u3044\u308d\u3068\u66f8\u304b\u308c\u3066\u304a\u308a\u3001\u305d\u306e\u90e8\u5206\u3092grep\u3059\u308b\u3060\u3051\u3067\u3001\u3069\u3093\u306a\u6a5f\u80fd\u3084\u30c9\u30e9\u30a4\u30d0\u304c\u3042\u308b\u304b\u304c\u4f55\u3068\u306a\u304f\u898b\u3048\u3066\u304d\u307e\u3059\u3002\n$ grep '^# ' GENERIC | egrep -i '(controller|device|support)'        \n# and device drivers, but should be useful for most applications.\n# For further information on hardware support for this architecture, see\n# of each device driver in this file see the section 4 man page for the\n# device.\n# Diagnostic/debugging support options\n# Wedge support\n# console scrolling support.\n# enable splash screen support; requires genfb or radeonfb\n# Device configuration\n# ACPI devices\n# Mainboard devices\n# Basic Bus Support\n# PCI bus support\n# ISA bus support\n# CardBus bridge support\n# CardBus bus support\n# Console Devices\n# Cryptographic Devices\n# PCI cryptographic devices\n# Serial Devices\n# AMD 768 and 8111 power/ACPI controllers\n# NVIDIA nForce2/3/4 SMBus controller\n# Intel PIIX4 power management controllers\n# Intel ICH SMBus controller\n# Thermal monitor and fan controller\n# iTE IT87xxF Super I/O with watchdog and sensors support\n# I2O devices\n# GPIO devices\n# 1- Wire support\n# I2C support\n# Keylock support\n# SCSI Controllers and Devices\n# PCI SCSI controllers\n# PCMCIA SCSI controllers\n# SCSI bus support\n# SCSI devices\n# RAID controllers and devices\n# IDE and related devices\n# PCI IDE controllers - see pciide(4) for supported hardware.\n# a machine hang with some controllers.\n# PCMCIA IDE controllers\n# CardBus IDE controllers\n# ISA ST506, ESDI, and IDE controllers\n# Some controllers pass the initial 32bit test, but will fail later.\n# ATA (IDE) bus support\n# Flags are used only with controllers that support DMA operations\n# and mode settings (e.g. some pciide controllers)\n# 0x0000 means \"use whatever the drive claims to support\".\n# ATAPI bus support\n# ATA RAID configuration support, as found on some Promise controllers.\n# ATAPI devices\n# Miscellaneous mass storage devices\n# MII/PHY support\n# USB Controller and Devices\n# PCI USB controllers\n# CardBus USB controllers\n# ISA USB controllers\n# PCMCIA USB controllers\n# USB bus support\n# USB HID device\n# USB Generic HID devices\n# IrDA and Consumer Ir devices\n# PCI IEEE1394 controllers\n# CardBus IEEE1394 controllers\n# Audio Devices\n# PCI audio devices\n# Audio support\n# MIDI support\n# FM-Radio devices\n# PCI radio devices\n# Radio support\n# Video capture devices\n# Bluetooth Controller and Device support\n# Bluetooth PCMCIA Controllers\n# Bluetooth SDIO Controllers\n# Bluetooth USB Controllers\n# Bluetooth Device Hub\n# Bluetooth HID support\n# Bluetooth Audio support\n# SD/MMC/SDIO Controller and Device support\n# SD/MMC controller\n# devices (watchdog timer, etc.)\n# Virtio devices\n# Pseudo-Devices\n# disk/mass storage pseudo-devices\n# network pseudo-devices\n# miscellaneous pseudo-devices\n# a pseudo device needed for Coda       # also needs CODA (above)\n# a pseudo device needed for SMBFS\n# wscons pseudo-devices\n# pseudo audio device driver\n# a pseudo device needed for veriexec\n\n\u4f55\u306f\u3068\u3082\u3042\u308c\u3001\u3053\u306eGENERIC\u306aconfig\u30d5\u30a1\u30a4\u30eb\u3092\u5143\u306b\u30ab\u30fc\u30cd\u30eb\u3092\u30d3\u30eb\u30c9\u3057\u3066\u307f\u307e\u3059\u3002\u5358\u306bGENERIC\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u3046\u306e\u306f\u9762\u767d\u5473\u306b\u304b\u3051\u308b\u306e\u3067\u3001\u4f8b\u306b\u3088\u3063\u3066\u56db\u6708\u306f\u541b\u306e\u5618\u306b\u306a\u305e\u3089\u3048\u305fKIMIUSO\u30b3\u30f3\u30d5\u30a3\u30b0\u3067\u30d3\u30eb\u30c9\u3057\u3066\u307f\u307e\u3057\u3087\u3046(\u3068\u8a00\u3063\u3066\u3082\u3001\u5358\u306bGENERIC\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\u3059\u308b\u3060\u3051\u3067\u3059\u304c...)\u3002\n\u307e\u305a\u306fKIMIUSO\u30b3\u30f3\u30d5\u30a3\u30b0\u3092\u7528\u610f\u3057\u307e\u3059\u3002\u5358\u306bGENERIC\u3092cp\u3059\u308b\u3060\u3051\u3002\n$ sudo -i\nkimiuso# cd /usr/src/sys/arch/amd64/conf/\nkimiuso# cp GENERIC KIMIUSO\n\n\u3053\u3053\u304b\u3089\u30ab\u30fc\u30cd\u30eb\u30d3\u30eb\u30c9\u306e\u4e00\u9023\u306e\u624b\u9806\u3067\u3059\u3002\"config <\u30b3\u30f3\u30d5\u30a3\u30b0\u30d5\u30a1\u30a4\u30eb>\"\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u30d3\u30eb\u30c9\u306b\u5fc5\u8981\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n\"make depend\"\u3067config\u30d5\u30a1\u30a4\u30eb\u306b\u5408\u308f\u305b\u305f\u30d3\u30eb\u30c9\u7528\u306e\u69cb\u6210\u306b\u3057\u3066\u3001make\u3067\u30ab\u30fc\u30cd\u30eb\u3092\u30d3\u30eb\u30c9\u3059\u308b\u3068\u3044\u3046\u6d41\u308c\u306b\u306a\u308a\u307e\u3059\u3002\nkimiuso# config KIMIUSO\nBuild directory is ../compile/KIMIUSO\nDon't forget to run \"make depend\"\nkimiuso# cd ../compile/KIMIUSO/\nkimiuso# make depend\nkimiuso# make 2>&1 | tee _make.20141205.0.log\n\n\u3053\u308c\u3067\u30b5\u30af\u30c3\u3068NetBSD\u30ab\u30fc\u30cd\u30eb\u304c\u3067\u304d\u3042\u304c\u308a\u307e\u3059\u3002\nkimiuso# make\n...\u4e2d\u7565...\n#      link  KIMIUSO/netbsd\nld -Map netbsd.map --cref -T ../../../../arch/amd64/conf/kern.ldscript -Ttext 0xffffffff80100000 -e start -z max-page-size=0x100000 -X -o netbsd ${SYSTEM_OBJ} ${EXTRA_OBJ} vers.o\nNetBSD 6.1.5 (KIMIUSO) #0: Thu Dec  4 22:37:11 UTC 2014\n   text    data     bss     dec     hex filename\n11734705         632104  645216 13012025         c68c39 netbsd\n\nkimiuso#\n\n\u30d3\u30eb\u30c9\u304c\u5b8c\u4e86\u3059\u308b\u3068\u3001\"netbsd\"\u3068\u3044\u3046\u540d\u524d\u3067\u30ab\u30fc\u30cd\u30eb\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\nkimiuso# find . -name netbsd\n./netbsd\nkimiuso# file netbsd\nnetbsd: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, for NetBSD 6.1.5, not stripped\nkimiuso# ls -lh netbsd\n-rwxr-xr-x  1 root  wheel   14M Dec  4 22:37 netbsd\n\n\u5f8c\u306f\"make install\"\u3067\u30ab\u30fc\u30cd\u30eb\u3092\u7f6e\u304d\u63db\u3048\u308b\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u5358\u306b\u30b3\u30d4\u30fc\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u30de\u30b7\u30f3\u306e\u30d6\u30fc\u30c8\u6642\u306b\u3001\u30eb\u30fc\u30c8\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306b\u3042\u308b\u30ab\u30fc\u30cd\u30eb\u3092\u53c2\u7167\u3059\u308b\u306e\u3067\u3001/netbsd.kimiuso\u3068\u3044\u3046\u540d\u524d\u3067\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nkimiuso# cp -pi netbsd /netbsd.kimiuso\n\n\n\u30ab\u30fc\u30cd\u30eb\u30bd\u30fc\u30b9\u3092\u7de8\u96c6\u3057\u3066\u30d6\u30fc\u30c8\u6642\u306b\u597d\u304d\u306a\u6587\u8a00\u3092\u8868\u793a\u3057\u3066\u307f\u308b\nNetBSD\u30ab\u30fc\u30cd\u30eb\u306e\u30d3\u30eb\u30c9\u624b\u9806\u304c\u5206\u304b\u3063\u305f\u306e\u3067\u3001\u305b\u3063\u304b\u304f\u3060\u304b\u3089\u30ab\u30fc\u30cd\u30eb\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3082\u3061\u3087\u3063\u3068\u89e6\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u30d6\u30fc\u30c8\u6642\u306b\u4f55\u304b\u597d\u304d\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8868\u793a\u3059\u308b\u304f\u3089\u3044\u3067\u3042\u308c\u3070\u3001\u6bd4\u8f03\u7684\u7c21\u5358\u306b\u5b9f\u73fe\u3067\u304d\u305d\u3046\u3067\u3059\u3002\nNetBSD\u30ab\u30fc\u30cd\u30eb\u306emain()\u306f\u3001init_main.c\u306b\u3042\u308a\u307e\u3059\u3002\nkimiuso# cd /usr/src/sys/\nkimiuso# vi kern/init_main.c\n\ninit_main.c\u306e\u4e2d\u306b\u3001banner()\u3068\u3044\u3046\u95a2\u6570\u304c\u3042\u308a\u3001\u3053\u3053\u3067\u8d77\u52d5\u6642\u306b\u8868\u793a\u3059\u308b\u30e1\u30e2\u30ea\u30b5\u30a4\u30ba\u7b49\u3092\u51fa\u529b\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\nkern/init_main.c:\n   1110 /*\n   1111  * Print the system start up banner.\n   1112  *\n   1113  * - Print a limited banner if AB_SILENT.\n   1114  * - Always send normal banner to the log.\n   1115  */\n   1116 #define MEM_PBUFSIZE    sizeof(\"99999 MB\")\n   1117\n   1118 void\n   1119 banner(void)\n   1120 {\n   1121         static char notice[] = \" Notice: this software is \"\n   1122             \"protected by copyright\";\n   1123         char pbuf[81];\n   1124         void (*pr)(const char *, ...);\n   1125         int i;\n   1126\n   1127         if ((boothowto & AB_SILENT) != 0) {\n   1128                 snprintf(pbuf, sizeof(pbuf), \"%s %s (%s)\",\n   1129                     ostype, osrelease, kernel_ident);\n   1130                 printf_nolog(\"%s\", pbuf);\n   1131                 for (i = 80 - strlen(pbuf) - sizeof(notice); i > 0; i--)\n   1132                         printf(\" \");\n   1133                 printf_nolog(\"%s\\n\", notice);\n   1134                 pr = aprint_normal;\n   1135         } else {\n   1136                 pr = printf;\n   1137         }\n   1138\n   1139         memset(pbuf, 0, sizeof(pbuf));\n   1140         (*pr)(\"%s%s\", copyright, version);\n   1141         format_bytes(pbuf, MEM_PBUFSIZE, ctob((uint64_t)physmem));\n   1142         (*pr)(\"total memory = %s\\n\", pbuf);\n   1143         format_bytes(pbuf, MEM_PBUFSIZE, ctob((uint64_t)uvmexp.free));\n   1144         (*pr)(\"avail memory = %s\\n\", pbuf);\n   1145 }\n\n\u4e00\u6628\u65e5\u306e\u8a18\u4e8b\u306e\u3088\u3046\u306b\u3001\u4f55\u304b\u8868\u793a\u3055\u305b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u5909\u66f4\u5185\u5bb9\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\nkimiuso# diff -u kern/init_main.c.orig kern/init_main.c\n--- kern/init_main.c.orig       2013-03-14 16:33:10.000000000 +0000\n+++ kern/init_main.c    2014-12-04 23:31:25.000000000 +0000\n@@ -1142,4 +1142,5 @@\n        (*pr)(\"total memory = %s\\n\", pbuf);\n        format_bytes(pbuf, MEM_PBUFSIZE, ctob((uint64_t)uvmexp.free));\n        (*pr)(\"avail memory = %s\\n\", pbuf);\n+       (*pr)(\"Your lie in April.\\n\");\n }\n\n\u3053\u308c\u3092\u5148\u307b\u3069\u540c\u3058\u624b\u9806\u3067\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\nkimiuso# cd /usr/src/sys/arch/amd64/conf/\nkimiuso# config KIMIUSO\nkimiuso# cd ../compile/KIMIUSO/\nkimiuso# make depend\nkimiuso# make 2>&1 | tee _make.1.log\n\n\u5ff5\u306e\u305f\u3081\u4e2d\u8eab\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\u305d\u308c\u3063\u307d\u3044\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u306d\u3002\nkimiuso# strings ./netbsd | grep 'Your lie'\nYour lie in April.\n\n\u751f\u6210\u3055\u308c\u305f\u30ab\u30fc\u30cd\u30eb\u30d5\u30a1\u30a4\u30eb\u3092/netbsd.kimiuso\u3068\u3057\u3066\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\nkimiuso# cp -pi ./netbsd /netbsd.kimiuso\n\n\n\u8d77\u52d5\u3057\u3066\u307f\u308b\n\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u518d\u8d77\u52d5\u3059\u308b\u3068\u3001\u30d6\u30fc\u30c8\u76f4\u5f8c\u306b\u4ee5\u4e0b\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u3053\u3053\u3067\u30b9\u30da\u30fc\u30b9\u30ad\u30fc\u3092\u62bc\u3059\u3053\u3068\u3067\u3001\u8d77\u52d5\u6642\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u9078\u629e\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\"5. Drop to boot prompt\"\u3092\u9078\u3076\u3068\u3001\u30d7\u30ed\u30f3\u30d7\u30c8\u306b\u843d\u3061\u307e\u3059\u3002\n\n\"help\"\u3068\u5165\u529b\u3059\u308b\u3068\u3001\u5229\u7528\u53ef\u80fd\u306a\u30b3\u30de\u30f3\u30c9\u4e00\u89a7\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\"boot\"\u3068\u3044\u3046\u30b3\u30de\u30f3\u30c9\u306b\u30ab\u30fc\u30cd\u30eb\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001\u4efb\u610f\u306e\u30ab\u30fc\u30cd\u30eb\u3067\u8d77\u52d5\u3067\u304d\u305d\u3046\u3067\u3059\u3002\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5165\u529b\u3057\u3066\u307f\u307e\u3059\u3002\n> boot netbsd.kimiuso\n\n\u3059\u308b\u3068\u3001\u8d77\u52d5\u6642\u306b\u305d\u308c\u3089\u3057\u304d\u6587\u5b57\u5217\u304c\uff01\n\n\u30ed\u30b0\u30a4\u30f3\u3057\u3066uname -a\u3068\u304b\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002KIMIUSO\u30b3\u30f3\u30d5\u30a3\u30b0\u306b\u3088\u308b\u30ab\u30fc\u30cd\u30eb\u3067\u3042\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n-bash-2.05b$ uname -a\nNetBSD kimiuso 6.1.5 NetBSD 6.1.5 (KIMIUSO) #1: Thu Dec  4 22:59:42 UTC 2014  root@kimiuso:/usr/src/sys/arch/amd64/compile/KIMIUSO amd64\n\ndmesg\u3082\u898b\u3066\u307f\u307e\u3059\u3002\u3070\u3063\u3061\u308a\"Your lie in April.\"\u3068\u3044\u3046\u51fa\u529b\u304c\u8a18\u9332\u3055\u308c\u3066\u3044\u3066\u3001\u5e78\u305b\u306a\u6c17\u5206\u306b\u306a\u308c\u307e\u3059\u3002\n$ dmesg | head -n11\nCopyright (c) 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005,\n    2006, 2007, 2008, 2009, 2010, 2011, 2012\n    The NetBSD Foundation, Inc.  All rights reserved.\nCopyright (c) 1982, 1986, 1989, 1991, 1993\n    The Regents of the University of California.  All rights reserved.\n\nNetBSD 6.1.5 (KIMIUSO) #1: Thu Dec  4 22:59:42 UTC 2014\n        root@kimiuso:/usr/src/sys/arch/amd64/compile/KIMIUSO\ntotal memory = 511 MB\navail memory = 481 MB\nYour lie in April.\n\n\n\u307e\u3068\u3081\n\u4eca\u65e5\u306eNetBSD Advent Calendar\u3067\u306f\u3001\u30ab\u30fc\u30cd\u30eb\u306e\u30d3\u30eb\u30c9\u624b\u9806\u3092\u3064\u3089\u3064\u3089\u3068\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002\u30ab\u30fc\u30cd\u30eb\u306e\u30d3\u30eb\u30c9\u306f\u610f\u5916\u3068\u7c21\u5358\u3001\u3068\u611f\u3058\u3066\u3082\u3089\u3048\u308b\u3068\u5b09\u3057\u3044\u3067\u3059\u3002\n# NetBSD\u30ab\u30fc\u30cd\u30eb\u3092\u30d3\u30eb\u30c9\u3057\u3066\u307f\u308b\n\n\u4eca\u65e5\u306eNetBSD Advent Calendar\u3067\u306f\u3001NetBSD\u30ab\u30fc\u30cd\u30eb\u306e\u30d3\u30eb\u30c9\u624b\u9806\u306b\u3064\u3044\u3066\u66f8\u3044\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n## NetBSD\u30ab\u30fc\u30cd\u30eb\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u7528\u610f\u3059\u308b\n\n### \u30bd\u30fc\u30b9CD(ISO\u30a4\u30e1\u30fc\u30b8)\u306e\u5165\u624b\n\n\u307e\u305a\u306f\u30ab\u30fc\u30cd\u30eb\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u7528\u610f\u3057\u307e\u3059\u3002NetBSD\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30ebCD-ROM\u914d\u5e03\u30b5\u30a4\u30c8\u304b\u3089\u3001\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u4e00\u5f0f\u304c\u5165\u3063\u305fISO\u30a4\u30e1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n * ftp://iso4.jp.NetBSD.org/pub/NetBSD/iso/6.1.5/NetBSD-6.1.5-source.iso\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305fNetBSD-6.1.5-source.iso\u3092\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u306eCD-ROM\u3068\u3057\u3066\u63a5\u7d9a\u3057\u307e\u3059\u3002\n\n![img012.png](https://qiita-image-store.s3.amazonaws.com/0/61137/076f0842-a608-0554-58e6-609c7e5ba81d.png)\n\n\u3042\u3068\u306f\u666e\u901a\u306bNetBSD\u304b\u3089mount\u3059\u308b\u3060\u3051\u3067OK\u3067\u3059\u3002\n\n### \u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u3092\u5c55\u958b\u3059\u308b\n\n```sh\n$ sudo mount /dev/cd0a /mnt\n$ mount | grep mnt\n/dev/cd0a on /mnt type cd9660 (read-only, local)\n$ df -h | grep mnt\n/dev/cd0a          432M       432M         0B 100% /mnt\n```\n\n\u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u306f.tgz\u306e\u5f62\u3067\u683c\u7d0d\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```sh\n$ find /mnt/ | grep \\.tgz$\n/mnt/source/sets/gnusrc.tgz\n/mnt/source/sets/sharesrc.tgz\n/mnt/source/sets/src.tgz\n/mnt/source/sets/syssrc.tgz\n/mnt/source/sets/xsrc.tgz\n```\n\n\u5404.tgz\u30d5\u30a1\u30a4\u30eb\u306f\u3001\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304b\u3089\u898b\u3066./usr/\u4ee5\u4e0b\u306b\u5c55\u958b\u3055\u308c\u308b\u5f62\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n```sh\n$ for i in `find /mnt/ | grep \\.tgz$`;do tar ztvf $i | head -n1; done 2> /dev/null\ndrwxrwxr-x  2 root     wsrc           0 Sep 29 16:17 usr/src/gnu\ndrwxrwxr-x  2 root     wsrc           0 Sep 29 16:17 usr/src/share\ndrwxrwxr-x  2 root     wsrc           0 Sep 29 16:17 usr/src\ndrwxrwxr-x  2 root     wsrc           0 Sep 29 16:17 usr/src\ndrwxrwxr-x  2 root     wsrc           0 Sep 29 16:17 usr/xsrc\n```\n\n\u6163\u7fd2\u7684\u306b\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u5c55\u958b\u5148\u306f/usr/src/\u306a\u306e\u3067\u3001\u305d\u308c\u306b\u5023\u3044\u5c55\u958b\u3057\u307e\u3059\u3002tar\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\"-C /\"\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001\u5c55\u958b\u5148\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3067\u304d\u307e\u3059\u3002\n\nroot\u30e6\u30fc\u30b6\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3001\u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u4e00\u5f0f\u3092\u5c55\u958b\u3057\u307e\u3059\u3002\n\n```sh\n$ sudo -i\nkimiuso# for i in `find /mnt/ | grep \\.tgz$`; do tar zxvf $i -C / ; done\n```\n\n\u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u304c\u5c55\u958b\u3055\u308c\u305f\u5f8c\u306e/usr/src/\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u5168\u4f53\u306e\u30b5\u30a4\u30ba\u306f1.6GB\u307b\u3069\u306e\u3088\u3046\u3067\u3059\u306d\u3002\n\n```sh\n$ ls -F /usr/src/\nBUILDING        common/         external/       regress/        usr.bin/\nCVS/            compat/         extsrc/         rescue/         usr.sbin/\nMakefile        crypto/         games/          sbin/           x11/\nMakefile.inc    dist/           gnu/            share/\nUPDATING        distrib/        include/        sys/\nbin/            doc/            lib/            tests/\nbuild.sh*       etc/            libexec/        tools/\n$ du -h /usr/src/ | tail -n1\n1.6G    /usr/src/\n```\n\n### ISO\u30a4\u30e1\u30fc\u30b8\u3092CD\u306e\u3088\u3046\u306bmount\u3059\u308b\n\n\u86c7\u8db3\u306b\u306a\u308a\u307e\u3059\u304c\u3001ISO\u30a4\u30e1\u30fc\u30b8\u81ea\u4f53\u3092mount\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\u5834\u5408\u306b\u3088\u3063\u3066\u306f\u3053\u3061\u3089\u306e\u65b9\u304c\u624b\u9806\u7684\u306b\u306f\u697d\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\nvnconfig\u30b3\u30de\u30f3\u30c9\u306b\u3088\u308a\u3001ISO\u30a4\u30e1\u30fc\u30b8\u3092\u64ec\u4f3c\u7684\u306a\u30c7\u30a3\u30b9\u30af\u30c7\u30d0\u30a4\u30b9\u306b\u898b\u305b\u304b\u3051\u3001\u305d\u308c\u3092mount\u3059\u308b\u3068\u3044\u3046\u5f62\u306b\u306a\u308a\u307e\u3059\u3002\n(Linux\u3060\u3068mount -o loopback\u3068\u304b\u3060\u3063\u305f\u3088\u3046\u306a...)\n\n```sh\n$ ls NetBSD-6.1.5-source.iso\nNetBSD-6.1.5-source.iso\n$ sudo vnconfig vnd0 NetBSD-6.1.5-source.iso\n$ sudo vnconfig -l\nvnd0: / (/dev/wd0a) inode 1562384\nvnd1: not in use\nvnd2: not in use\nvnd3: not in use\n$ sudo mount -t cd9660 /dev/vnd0a /mnt\n$ mount | grep mnt\n/dev/vnd0a on /mnt type cd9660 (read-only, local)\n$ df -h | grep mnt\n/dev/vnd0a         432M       432M         0B 100% /mnt\n```\n\nmount\u3057\u3066\u3057\u307e\u3048\u3070\u3001\u5f8c\u306e\u624b\u9806\u306fCD-ROM\u3068\u540c\u3058\u3067\u3059\u3002\u4f7f\u3044\u7d42\u308f\u3063\u305f\u3089\u3001\u4ee5\u4e0b\u306e\u624b\u9806\u3067unmount\u3057\u3001\u7591\u4f3c\u30c7\u30d0\u30a4\u30b9\u304b\u3089\u3082\u5916\u3057\u307e\u3059\u3002\n\n```sh\n$ sudo umount /mnt\n$ sudo vnconfig -u vnd0\n$ sudo vnconfig -l\nvnd0: not in use\nvnd1: not in use\nvnd2: not in use\nvnd3: not in use\n```\n\n## \u30ab\u30fc\u30cd\u30eb\u306e\u30d3\u30eb\u30c9\n\n\u3067\u306f\u65e9\u901f\u3001\u5c55\u958b\u3057\u305f\u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u304b\u3089NetBSD\u30ab\u30fc\u30cd\u30eb\u3092\u30d3\u30eb\u30c9\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u307e\u305a\u3001\u30ab\u30fc\u30cd\u30eb\u30d3\u30eb\u30c9\u6642\u306b\u7d44\u307f\u8fbc\u3080\u30c7\u30d0\u30a4\u30b9\u3084\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b\u305f\u3081\u306e\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u3001\u30ab\u30fc\u30cd\u30eb\u30b3\u30f3\u30d5\u30a3\u30ae\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u30d5\u30a1\u30a4\u30eb\u3068\u3044\u3046\u3082\u306e\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u9577\u3063\u305f\u3089\u3057\u3044\u547c\u3073\u540d\u306a\u306e\u3067\u3001\u5358\u306b\u300cconfig\u30d5\u30a1\u30a4\u30eb\u300d\u3068\u547c\u3070\u308c\u308b\u3053\u3068\u3082\u3042\u308a\u307e\u3059\u3002\u4ee5\u964d\u306f\u300cconfig\u30d5\u30a1\u30a4\u30eb\u300d\u3068\u3044\u3046\u8868\u8a18\u3067\u8aac\u660e\u3057\u307e\u3059\u3002\n\n\u4f8b\u3048\u3070NetBSD-amd64\u306e\u5834\u5408\u306econfig\u30d5\u30a1\u30a4\u30eb\u306f/usr/src/sys/arch/amd64/conf/\u306b\u3042\u308a\u307e\u3059\u3002NetBSD\u306f\u8907\u6570\u306eCPU\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3067\u52d5\u4f5c\u3059\u308b\u306e\u3067\u3001arch/{CPU\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u540d}\u306e\u4e0b\u306bconfig\u304c\u7f6e\u304b\u308c\u3066\u3044\u308b\u69cb\u6210\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n```sh\n$ cd /usr/src/sys/arch/amd64/conf/\n$ ls -F\nCVS/                Makefile.amd64      kern.ldscript       majors.amd64\nGENERIC             XEN3_DOM0           kern.ldscript.2MB   std.amd64\nINSTALL             XEN3_DOMU           kern.ldscript.Xen   std.xen\nINSTALL_XEN3_DOMU   files.amd64         largepages.inc\n```\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30ebCD\u3067\u306f\u300cGENERIC\u30ab\u30fc\u30cd\u30eb\u300d\u3068\u3044\u3046\u3001\u4e00\u822c\u7684\u306a\u30ab\u30fc\u30cd\u30eb\u69cb\u6210\u3067\u30d3\u30eb\u30c9\u3055\u308c\u305f\u30ab\u30fc\u30cd\u30eb\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3059\u3002GENERIC\u30ab\u30fc\u30cd\u30eb\u306econfig\u30d5\u30a1\u30a4\u30eb\u306f\u3001\u305d\u306e\u540d\u524d\u306e\u901a\u308a\u3001GENERIC\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u3053\u306eGENERIC\u306aconfig\u30d5\u30a1\u30a4\u30eb\u3001\u30b3\u30e1\u30f3\u30c8\u306b\u3044\u308d\u3044\u308d\u3068\u66f8\u304b\u308c\u3066\u304a\u308a\u3001\u305d\u306e\u90e8\u5206\u3092grep\u3059\u308b\u3060\u3051\u3067\u3001\u3069\u3093\u306a\u6a5f\u80fd\u3084\u30c9\u30e9\u30a4\u30d0\u304c\u3042\u308b\u304b\u304c\u4f55\u3068\u306a\u304f\u898b\u3048\u3066\u304d\u307e\u3059\u3002\n\n```sh\n$ grep '^# ' GENERIC | egrep -i '(controller|device|support)'        \n# and device drivers, but should be useful for most applications.\n# For further information on hardware support for this architecture, see\n# of each device driver in this file see the section 4 man page for the\n# device.\n# Diagnostic/debugging support options\n# Wedge support\n# console scrolling support.\n# enable splash screen support; requires genfb or radeonfb\n# Device configuration\n# ACPI devices\n# Mainboard devices\n# Basic Bus Support\n# PCI bus support\n# ISA bus support\n# CardBus bridge support\n# CardBus bus support\n# Console Devices\n# Cryptographic Devices\n# PCI cryptographic devices\n# Serial Devices\n# AMD 768 and 8111 power/ACPI controllers\n# NVIDIA nForce2/3/4 SMBus controller\n# Intel PIIX4 power management controllers\n# Intel ICH SMBus controller\n# Thermal monitor and fan controller\n# iTE IT87xxF Super I/O with watchdog and sensors support\n# I2O devices\n# GPIO devices\n# 1- Wire support\n# I2C support\n# Keylock support\n# SCSI Controllers and Devices\n# PCI SCSI controllers\n# PCMCIA SCSI controllers\n# SCSI bus support\n# SCSI devices\n# RAID controllers and devices\n# IDE and related devices\n# PCI IDE controllers - see pciide(4) for supported hardware.\n# a machine hang with some controllers.\n# PCMCIA IDE controllers\n# CardBus IDE controllers\n# ISA ST506, ESDI, and IDE controllers\n# Some controllers pass the initial 32bit test, but will fail later.\n# ATA (IDE) bus support\n# Flags are used only with controllers that support DMA operations\n# and mode settings (e.g. some pciide controllers)\n# 0x0000 means \"use whatever the drive claims to support\".\n# ATAPI bus support\n# ATA RAID configuration support, as found on some Promise controllers.\n# ATAPI devices\n# Miscellaneous mass storage devices\n# MII/PHY support\n# USB Controller and Devices\n# PCI USB controllers\n# CardBus USB controllers\n# ISA USB controllers\n# PCMCIA USB controllers\n# USB bus support\n# USB HID device\n# USB Generic HID devices\n# IrDA and Consumer Ir devices\n# PCI IEEE1394 controllers\n# CardBus IEEE1394 controllers\n# Audio Devices\n# PCI audio devices\n# Audio support\n# MIDI support\n# FM-Radio devices\n# PCI radio devices\n# Radio support\n# Video capture devices\n# Bluetooth Controller and Device support\n# Bluetooth PCMCIA Controllers\n# Bluetooth SDIO Controllers\n# Bluetooth USB Controllers\n# Bluetooth Device Hub\n# Bluetooth HID support\n# Bluetooth Audio support\n# SD/MMC/SDIO Controller and Device support\n# SD/MMC controller\n# devices (watchdog timer, etc.)\n# Virtio devices\n# Pseudo-Devices\n# disk/mass storage pseudo-devices\n# network pseudo-devices\n# miscellaneous pseudo-devices\n# a pseudo device needed for Coda       # also needs CODA (above)\n# a pseudo device needed for SMBFS\n# wscons pseudo-devices\n# pseudo audio device driver\n# a pseudo device needed for veriexec\n```\n\n\u4f55\u306f\u3068\u3082\u3042\u308c\u3001\u3053\u306eGENERIC\u306aconfig\u30d5\u30a1\u30a4\u30eb\u3092\u5143\u306b\u30ab\u30fc\u30cd\u30eb\u3092\u30d3\u30eb\u30c9\u3057\u3066\u307f\u307e\u3059\u3002\u5358\u306bGENERIC\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u3046\u306e\u306f\u9762\u767d\u5473\u306b\u304b\u3051\u308b\u306e\u3067\u3001\u4f8b\u306b\u3088\u3063\u3066[\u56db\u6708\u306f\u541b\u306e\u5618](http://www.kimiuso.jp \"\u56db\u6708\u306f\u541b\u306e\u5618\")\u306b\u306a\u305e\u3089\u3048\u305fKIMIUSO\u30b3\u30f3\u30d5\u30a3\u30b0\u3067\u30d3\u30eb\u30c9\u3057\u3066\u307f\u307e\u3057\u3087\u3046(\u3068\u8a00\u3063\u3066\u3082\u3001\u5358\u306bGENERIC\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\u3059\u308b\u3060\u3051\u3067\u3059\u304c...)\u3002\n\n\u307e\u305a\u306fKIMIUSO\u30b3\u30f3\u30d5\u30a3\u30b0\u3092\u7528\u610f\u3057\u307e\u3059\u3002\u5358\u306bGENERIC\u3092cp\u3059\u308b\u3060\u3051\u3002\n\n```sh\n$ sudo -i\nkimiuso# cd /usr/src/sys/arch/amd64/conf/\nkimiuso# cp GENERIC KIMIUSO\n```\n\n\u3053\u3053\u304b\u3089\u30ab\u30fc\u30cd\u30eb\u30d3\u30eb\u30c9\u306e\u4e00\u9023\u306e\u624b\u9806\u3067\u3059\u3002\"config <\u30b3\u30f3\u30d5\u30a3\u30b0\u30d5\u30a1\u30a4\u30eb>\"\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u30d3\u30eb\u30c9\u306b\u5fc5\u8981\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n\n\"make depend\"\u3067config\u30d5\u30a1\u30a4\u30eb\u306b\u5408\u308f\u305b\u305f\u30d3\u30eb\u30c9\u7528\u306e\u69cb\u6210\u306b\u3057\u3066\u3001make\u3067\u30ab\u30fc\u30cd\u30eb\u3092\u30d3\u30eb\u30c9\u3059\u308b\u3068\u3044\u3046\u6d41\u308c\u306b\u306a\u308a\u307e\u3059\u3002\n\n```sh\nkimiuso# config KIMIUSO\nBuild directory is ../compile/KIMIUSO\nDon't forget to run \"make depend\"\nkimiuso# cd ../compile/KIMIUSO/\nkimiuso# make depend\nkimiuso# make 2>&1 | tee _make.20141205.0.log\n```\n\n\u3053\u308c\u3067\u30b5\u30af\u30c3\u3068NetBSD\u30ab\u30fc\u30cd\u30eb\u304c\u3067\u304d\u3042\u304c\u308a\u307e\u3059\u3002\n\n```sh\nkimiuso# make\n...\u4e2d\u7565...\n#      link  KIMIUSO/netbsd\nld -Map netbsd.map --cref -T ../../../../arch/amd64/conf/kern.ldscript -Ttext 0xffffffff80100000 -e start -z max-page-size=0x100000 -X -o netbsd ${SYSTEM_OBJ} ${EXTRA_OBJ} vers.o\nNetBSD 6.1.5 (KIMIUSO) #0: Thu Dec  4 22:37:11 UTC 2014\n   text    data     bss     dec     hex filename\n11734705         632104  645216 13012025         c68c39 netbsd\n\nkimiuso#\n```\n\n\u30d3\u30eb\u30c9\u304c\u5b8c\u4e86\u3059\u308b\u3068\u3001\"netbsd\"\u3068\u3044\u3046\u540d\u524d\u3067\u30ab\u30fc\u30cd\u30eb\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n\n```sh\nkimiuso# find . -name netbsd\n./netbsd\nkimiuso# file netbsd\nnetbsd: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, for NetBSD 6.1.5, not stripped\nkimiuso# ls -lh netbsd\n-rwxr-xr-x  1 root  wheel   14M Dec  4 22:37 netbsd\n```\n\n\u5f8c\u306f\"make install\"\u3067\u30ab\u30fc\u30cd\u30eb\u3092\u7f6e\u304d\u63db\u3048\u308b\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u5358\u306b\u30b3\u30d4\u30fc\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u30de\u30b7\u30f3\u306e\u30d6\u30fc\u30c8\u6642\u306b\u3001\u30eb\u30fc\u30c8\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306b\u3042\u308b\u30ab\u30fc\u30cd\u30eb\u3092\u53c2\u7167\u3059\u308b\u306e\u3067\u3001/netbsd.kimiuso\u3068\u3044\u3046\u540d\u524d\u3067\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```sh\nkimiuso# cp -pi netbsd /netbsd.kimiuso\n```\n\n## \u30ab\u30fc\u30cd\u30eb\u30bd\u30fc\u30b9\u3092\u7de8\u96c6\u3057\u3066\u30d6\u30fc\u30c8\u6642\u306b\u597d\u304d\u306a\u6587\u8a00\u3092\u8868\u793a\u3057\u3066\u307f\u308b\n\nNetBSD\u30ab\u30fc\u30cd\u30eb\u306e\u30d3\u30eb\u30c9\u624b\u9806\u304c\u5206\u304b\u3063\u305f\u306e\u3067\u3001\u305b\u3063\u304b\u304f\u3060\u304b\u3089\u30ab\u30fc\u30cd\u30eb\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3082\u3061\u3087\u3063\u3068\u89e6\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u30d6\u30fc\u30c8\u6642\u306b\u4f55\u304b\u597d\u304d\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8868\u793a\u3059\u308b\u304f\u3089\u3044\u3067\u3042\u308c\u3070\u3001\u6bd4\u8f03\u7684\u7c21\u5358\u306b\u5b9f\u73fe\u3067\u304d\u305d\u3046\u3067\u3059\u3002\n\nNetBSD\u30ab\u30fc\u30cd\u30eb\u306emain()\u306f\u3001init_main.c\u306b\u3042\u308a\u307e\u3059\u3002\n\n```sh\nkimiuso# cd /usr/src/sys/\nkimiuso# vi kern/init_main.c\n```\n\ninit_main.c\u306e\u4e2d\u306b\u3001banner()\u3068\u3044\u3046\u95a2\u6570\u304c\u3042\u308a\u3001\u3053\u3053\u3067\u8d77\u52d5\u6642\u306b\u8868\u793a\u3059\u308b\u30e1\u30e2\u30ea\u30b5\u30a4\u30ba\u7b49\u3092\u51fa\u529b\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\n```sh\nkern/init_main.c:\n   1110 /*\n   1111  * Print the system start up banner.\n   1112  *\n   1113  * - Print a limited banner if AB_SILENT.\n   1114  * - Always send normal banner to the log.\n   1115  */\n   1116 #define MEM_PBUFSIZE    sizeof(\"99999 MB\")\n   1117\n   1118 void\n   1119 banner(void)\n   1120 {\n   1121         static char notice[] = \" Notice: this software is \"\n   1122             \"protected by copyright\";\n   1123         char pbuf[81];\n   1124         void (*pr)(const char *, ...);\n   1125         int i;\n   1126\n   1127         if ((boothowto & AB_SILENT) != 0) {\n   1128                 snprintf(pbuf, sizeof(pbuf), \"%s %s (%s)\",\n   1129                     ostype, osrelease, kernel_ident);\n   1130                 printf_nolog(\"%s\", pbuf);\n   1131                 for (i = 80 - strlen(pbuf) - sizeof(notice); i > 0; i--)\n   1132                         printf(\" \");\n   1133                 printf_nolog(\"%s\\n\", notice);\n   1134                 pr = aprint_normal;\n   1135         } else {\n   1136                 pr = printf;\n   1137         }\n   1138\n   1139         memset(pbuf, 0, sizeof(pbuf));\n   1140         (*pr)(\"%s%s\", copyright, version);\n   1141         format_bytes(pbuf, MEM_PBUFSIZE, ctob((uint64_t)physmem));\n   1142         (*pr)(\"total memory = %s\\n\", pbuf);\n   1143         format_bytes(pbuf, MEM_PBUFSIZE, ctob((uint64_t)uvmexp.free));\n   1144         (*pr)(\"avail memory = %s\\n\", pbuf);\n   1145 }\n```\n\n[\u4e00\u6628\u65e5\u306e\u8a18\u4e8b](http://qiita.com/furandon_pig/items/b1607d8c5bc314c0e31d \"\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u74b0\u5883\u3068\u3057\u3066NetBSD\u3092\u4f7f\u3046\u8a71\")\u306e\u3088\u3046\u306b\u3001\u4f55\u304b\u8868\u793a\u3055\u305b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u5909\u66f4\u5185\u5bb9\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\n```sh\nkimiuso# diff -u kern/init_main.c.orig kern/init_main.c\n--- kern/init_main.c.orig       2013-03-14 16:33:10.000000000 +0000\n+++ kern/init_main.c    2014-12-04 23:31:25.000000000 +0000\n@@ -1142,4 +1142,5 @@\n        (*pr)(\"total memory = %s\\n\", pbuf);\n        format_bytes(pbuf, MEM_PBUFSIZE, ctob((uint64_t)uvmexp.free));\n        (*pr)(\"avail memory = %s\\n\", pbuf);\n+       (*pr)(\"Your lie in April.\\n\");\n }\n```\n\n\u3053\u308c\u3092\u5148\u307b\u3069\u540c\u3058\u624b\u9806\u3067\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\n\n```sh\nkimiuso# cd /usr/src/sys/arch/amd64/conf/\nkimiuso# config KIMIUSO\nkimiuso# cd ../compile/KIMIUSO/\nkimiuso# make depend\nkimiuso# make 2>&1 | tee _make.1.log\n```\n\n\u5ff5\u306e\u305f\u3081\u4e2d\u8eab\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\u305d\u308c\u3063\u307d\u3044\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u306d\u3002\n\n```sh\nkimiuso# strings ./netbsd | grep 'Your lie'\nYour lie in April.\n```\n\n\u751f\u6210\u3055\u308c\u305f\u30ab\u30fc\u30cd\u30eb\u30d5\u30a1\u30a4\u30eb\u3092/netbsd.kimiuso\u3068\u3057\u3066\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\n```\nkimiuso# cp -pi ./netbsd /netbsd.kimiuso\n```\n\n### \u8d77\u52d5\u3057\u3066\u307f\u308b\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u518d\u8d77\u52d5\u3059\u308b\u3068\u3001\u30d6\u30fc\u30c8\u76f4\u5f8c\u306b\u4ee5\u4e0b\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u3053\u3053\u3067\u30b9\u30da\u30fc\u30b9\u30ad\u30fc\u3092\u62bc\u3059\u3053\u3068\u3067\u3001\u8d77\u52d5\u6642\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u9078\u629e\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n![img013.png](https://qiita-image-store.s3.amazonaws.com/0/61137/70b3f042-d1ce-1b73-aabe-84417f5ed91b.png)\n\n\"5. Drop to boot prompt\"\u3092\u9078\u3076\u3068\u3001\u30d7\u30ed\u30f3\u30d7\u30c8\u306b\u843d\u3061\u307e\u3059\u3002\n\n![img014.png](https://qiita-image-store.s3.amazonaws.com/0/61137/7850c568-cba3-0f29-9568-245e327867da.png)\n\n\"help\"\u3068\u5165\u529b\u3059\u308b\u3068\u3001\u5229\u7528\u53ef\u80fd\u306a\u30b3\u30de\u30f3\u30c9\u4e00\u89a7\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\"boot\"\u3068\u3044\u3046\u30b3\u30de\u30f3\u30c9\u306b\u30ab\u30fc\u30cd\u30eb\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001\u4efb\u610f\u306e\u30ab\u30fc\u30cd\u30eb\u3067\u8d77\u52d5\u3067\u304d\u305d\u3046\u3067\u3059\u3002\n\n![img015.png](https://qiita-image-store.s3.amazonaws.com/0/61137/1c9c6a83-3595-4316-20dd-b1855304a160.png)\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5165\u529b\u3057\u3066\u307f\u307e\u3059\u3002\n\n```shell-session\n> boot netbsd.kimiuso\n```\n\n\u3059\u308b\u3068\u3001\u8d77\u52d5\u6642\u306b\u305d\u308c\u3089\u3057\u304d\u6587\u5b57\u5217\u304c\uff01\n\n![img016.png](https://qiita-image-store.s3.amazonaws.com/0/61137/39a7fc39-2872-38b3-e4cd-4dfa954d7900.png)\n\n\u30ed\u30b0\u30a4\u30f3\u3057\u3066uname -a\u3068\u304b\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002KIMIUSO\u30b3\u30f3\u30d5\u30a3\u30b0\u306b\u3088\u308b\u30ab\u30fc\u30cd\u30eb\u3067\u3042\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\n```sh\n-bash-2.05b$ uname -a\nNetBSD kimiuso 6.1.5 NetBSD 6.1.5 (KIMIUSO) #1: Thu Dec  4 22:59:42 UTC 2014  root@kimiuso:/usr/src/sys/arch/amd64/compile/KIMIUSO amd64\n```\n\ndmesg\u3082\u898b\u3066\u307f\u307e\u3059\u3002\u3070\u3063\u3061\u308a\"Your lie in April.\"\u3068\u3044\u3046\u51fa\u529b\u304c\u8a18\u9332\u3055\u308c\u3066\u3044\u3066\u3001\u5e78\u305b\u306a\u6c17\u5206\u306b\u306a\u308c\u307e\u3059\u3002\n\n```sh\n$ dmesg | head -n11\nCopyright (c) 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005,\n    2006, 2007, 2008, 2009, 2010, 2011, 2012\n    The NetBSD Foundation, Inc.  All rights reserved.\nCopyright (c) 1982, 1986, 1989, 1991, 1993\n    The Regents of the University of California.  All rights reserved.\n\nNetBSD 6.1.5 (KIMIUSO) #1: Thu Dec  4 22:59:42 UTC 2014\n        root@kimiuso:/usr/src/sys/arch/amd64/compile/KIMIUSO\ntotal memory = 511 MB\navail memory = 481 MB\nYour lie in April.\n```\n\n## \u307e\u3068\u3081\n\n\u4eca\u65e5\u306eNetBSD Advent Calendar\u3067\u306f\u3001\u30ab\u30fc\u30cd\u30eb\u306e\u30d3\u30eb\u30c9\u624b\u9806\u3092\u3064\u3089\u3064\u3089\u3068\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002\u30ab\u30fc\u30cd\u30eb\u306e\u30d3\u30eb\u30c9\u306f\u610f\u5916\u3068\u7c21\u5358\u3001\u3068\u611f\u3058\u3066\u3082\u3089\u3048\u308b\u3068\u5b09\u3057\u3044\u3067\u3059\u3002\n"}