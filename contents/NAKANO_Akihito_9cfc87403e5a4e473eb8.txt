{"context": " More than 1 year has passed since last update.\u5f53\u65b9\u3001ActiveRecord(Rails)\u521d\u5fc3\u8005\u3067\u3059\u304c\u3053\u3093\u306a\u611f\u3058\u304b\u306a\u3068\u3044\u3046\u306e\u3092\u30e1\u30e2\u3057\u307e\u3059\u3002\n\n\u6e96\u5099\n$ rails g model category name:string parent_category_id:integer\n$ rake db:migrate\n\nmysql> select * from categories;\n+----+---------+--------------------+---------------------+---------------------+\n| id | name    | parent_category_id | created_at          | updated_at          |\n+----+---------+--------------------+---------------------+---------------------+\n|  1 | metal   |               NULL | 2014-12-27 09:38:14 | 2014-12-27 09:38:14 |\n|  2 | melodic |                  1 | 2014-12-27 09:38:14 | 2014-12-27 09:38:14 |\n|  3 | black   |                  1 | 2014-12-27 09:38:14 | 2014-12-27 09:38:14 |\n|  4 | death   |                  1 | 2014-12-27 09:38:14 | 2014-12-27 09:38:14 |\n|  5 | jazz    |               NULL | 2014-12-27 09:38:14 | 2014-12-27 09:38:14 |\n|  6 | swing   |                  5 | 2014-12-27 09:38:14 | 2014-12-27 09:38:14 |\n|  7 | modern  |                  5 | 2014-12-27 09:38:14 | 2014-12-27 09:38:14 |\n|  8 | bebop   |                  5 | 2014-12-27 09:38:14 | 2014-12-27 09:38:14 |\n+----+---------+--------------------+---------------------+---------------------+\n\n\n\nModel\u5b9a\u7fa9\nclass Category < ActiveRecord::Base\n  has_many :children, class_name: \"Category\", foreign_key: \"parent_category_id\"\n  belongs_to :parent, class_name: \"Category\", foreign_key: \"parent_category_id\"\nend\n\n\n\u78ba\u8a8d\n$ rails console\n> Category.first\n=> #<Category id: 1, name: \"metal\", parent_category_id: nil, created_at: \"2014-12-27 08:26:48\", updated_at: \"2014-12-27 08:26:48\">\n\n> Category.first.children\n=> #<ActiveRecord::Associations::CollectionProxy [#<Category id: 2, name: \"melodic\", parent_category_id: 1, created_at: \"2014-12-27 08:27:51\", updated_at: \"2014-12-27 08:27:51\">, #<Category id: 3, name: \"black\", parent_category_id: 1, created_at: \"2014-12-27 08:28:27\", updated_at: \"2014-12-27 08:28:27\">, #<Category id: 4, name: \"death\", parent_category_id: 1, created_at: \"2014-12-27 08:29:03\", updated_at: \"2014-12-27 08:29:03\">]>\n\n> Category.last\n=> #<Category id: 8, name: \"bebop\", parent_category_id: 5, created_at: \"2014-12-27 08:40:14\", updated_at: \"2014-12-27 08:40:14\">\n\n> Category.last.parent\n=> #<Category id: 8, name: \"bebop\", parent_category_id: 5, created_at: \"2014-12-27 08:40:14\", updated_at: \"2014-12-27 08:40:14\">\n\n\n\u4fbf\u5229\u306a gem \u304c\u3042\u3063\u305f\u308a\u3059\u308b\u3093\u3067\u3057\u3087\u3046\u304b\u3002\n\u203b\u8ffd\u8a18\nActive Record Associations\n2.10 Self Joins\nhttp://guides.rubyonrails.org/association_basics.html#self-joins\n\u2191\u3092\u898b\u3064\u3051\u307e\u3057\u305f\u3002\u3053\u3061\u3089\u306e\u65b9\u304c t.references \u3067\u53c2\u7167\u3057\u3066\u3044\u308b\u306e\u3067\u826f\u3044\u3067\u3059\u306d\u3002\n\u300cSelf Joins\u300d\u3063\u3066\u66f8\u3044\u3066\u3042\u3063\u305f\u306e\u3067\u81ea\u5df1\u7d50\u5408\u3057\u3066\u308b\u306e\u304b\u3068\u601d\u3063\u305f\u3093\u3067\u3059\u304c\u9055\u3044\u307e\u3057\u305f\u3002\n> Category.last\n  Category Load (0.2ms)  SELECT  `categories`.* FROM `categories`   ORDER BY `categories`.`id` DESC LIMIT 1\n\n> Category.last.parent\n  Category Load (0.3ms)  SELECT  `categories`.* FROM `categories`   ORDER BY `categories`.`id` DESC LIMIT 1\n  Category Load (0.3ms)  SELECT  `categories`.* FROM `categories`  WHERE `categories`.`id` = 5 LIMIT 1\n\n\u203b\u8ffd\u8a182\n@jnchito \u3055\u3093\u306b\u30b3\u30e1\u30f3\u30c8\u3067\u6559\u3048\u3066\u3044\u305f\u3060\u3044\u305f Ancestry \u306b\u3064\u3044\u3066\u6295\u7a3f\u3057\u307e\u3057\u305f\u3002\nActiveRecord\u3067\u591a\u968e\u5c64\u30ab\u30c6\u30b4\u30ea(Ancestry)\n\n\u5f53\u65b9\u3001ActiveRecord(Rails)\u521d\u5fc3\u8005\u3067\u3059\u304c\u3053\u3093\u306a\u611f\u3058\u304b\u306a\u3068\u3044\u3046\u306e\u3092\u30e1\u30e2\u3057\u307e\u3059\u3002\n\n### \u6e96\u5099\n\n```\n$ rails g model category name:string parent_category_id:integer\n$ rake db:migrate\n```\n\n```\nmysql> select * from categories;\n+----+---------+--------------------+---------------------+---------------------+\n| id | name    | parent_category_id | created_at          | updated_at          |\n+----+---------+--------------------+---------------------+---------------------+\n|  1 | metal   |               NULL | 2014-12-27 09:38:14 | 2014-12-27 09:38:14 |\n|  2 | melodic |                  1 | 2014-12-27 09:38:14 | 2014-12-27 09:38:14 |\n|  3 | black   |                  1 | 2014-12-27 09:38:14 | 2014-12-27 09:38:14 |\n|  4 | death   |                  1 | 2014-12-27 09:38:14 | 2014-12-27 09:38:14 |\n|  5 | jazz    |               NULL | 2014-12-27 09:38:14 | 2014-12-27 09:38:14 |\n|  6 | swing   |                  5 | 2014-12-27 09:38:14 | 2014-12-27 09:38:14 |\n|  7 | modern  |                  5 | 2014-12-27 09:38:14 | 2014-12-27 09:38:14 |\n|  8 | bebop   |                  5 | 2014-12-27 09:38:14 | 2014-12-27 09:38:14 |\n+----+---------+--------------------+---------------------+---------------------+\n\n```\n\n### Model\u5b9a\u7fa9\n\n```ruby\nclass Category < ActiveRecord::Base\n  has_many :children, class_name: \"Category\", foreign_key: \"parent_category_id\"\n  belongs_to :parent, class_name: \"Category\", foreign_key: \"parent_category_id\"\nend\n```\n\n### \u78ba\u8a8d\n\n```\n$ rails console\n> Category.first\n=> #<Category id: 1, name: \"metal\", parent_category_id: nil, created_at: \"2014-12-27 08:26:48\", updated_at: \"2014-12-27 08:26:48\">\n\n> Category.first.children\n=> #<ActiveRecord::Associations::CollectionProxy [#<Category id: 2, name: \"melodic\", parent_category_id: 1, created_at: \"2014-12-27 08:27:51\", updated_at: \"2014-12-27 08:27:51\">, #<Category id: 3, name: \"black\", parent_category_id: 1, created_at: \"2014-12-27 08:28:27\", updated_at: \"2014-12-27 08:28:27\">, #<Category id: 4, name: \"death\", parent_category_id: 1, created_at: \"2014-12-27 08:29:03\", updated_at: \"2014-12-27 08:29:03\">]>\n\n> Category.last\n=> #<Category id: 8, name: \"bebop\", parent_category_id: 5, created_at: \"2014-12-27 08:40:14\", updated_at: \"2014-12-27 08:40:14\">\n\n> Category.last.parent\n=> #<Category id: 8, name: \"bebop\", parent_category_id: 5, created_at: \"2014-12-27 08:40:14\", updated_at: \"2014-12-27 08:40:14\">\n\n```\n\n\u4fbf\u5229\u306a gem \u304c\u3042\u3063\u305f\u308a\u3059\u308b\u3093\u3067\u3057\u3087\u3046\u304b\u3002\n\n\n\u203b\u8ffd\u8a18\nActive Record Associations\n2.10 Self Joins\nhttp://guides.rubyonrails.org/association_basics.html#self-joins\n\n\u2191\u3092\u898b\u3064\u3051\u307e\u3057\u305f\u3002\u3053\u3061\u3089\u306e\u65b9\u304c t.references \u3067\u53c2\u7167\u3057\u3066\u3044\u308b\u306e\u3067\u826f\u3044\u3067\u3059\u306d\u3002\n\n\u300cSelf Joins\u300d\u3063\u3066\u66f8\u3044\u3066\u3042\u3063\u305f\u306e\u3067\u81ea\u5df1\u7d50\u5408\u3057\u3066\u308b\u306e\u304b\u3068\u601d\u3063\u305f\u3093\u3067\u3059\u304c\u9055\u3044\u307e\u3057\u305f\u3002\n\n```\n> Category.last\n  Category Load (0.2ms)  SELECT  `categories`.* FROM `categories`   ORDER BY `categories`.`id` DESC LIMIT 1\n  \n> Category.last.parent\n  Category Load (0.3ms)  SELECT  `categories`.* FROM `categories`   ORDER BY `categories`.`id` DESC LIMIT 1\n  Category Load (0.3ms)  SELECT  `categories`.* FROM `categories`  WHERE `categories`.`id` = 5 LIMIT 1\n  ```\n\n\u203b\u8ffd\u8a182\n[@jnchito](http://qiita.com/jnchito) \u3055\u3093\u306b\u30b3\u30e1\u30f3\u30c8\u3067\u6559\u3048\u3066\u3044\u305f\u3060\u3044\u305f Ancestry \u306b\u3064\u3044\u3066\u6295\u7a3f\u3057\u307e\u3057\u305f\u3002\n[ActiveRecord\u3067\u591a\u968e\u5c64\u30ab\u30c6\u30b4\u30ea(Ancestry)](http://qiita.com/NAKANO_Akihito/items/d42a6ceae40933af2352)\n", "tags": ["Rails", "ActiveRecord", "Ruby"]}