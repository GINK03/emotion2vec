{"tags": ["libvirt", "openstack", "KVM", "Python"], "context": " More than 1 year has passed since last update.How do I calculate %CPU in my own libvirt programs?\n\u305d\u3046\u3044\u3048\u3070Qiita\u306fLATEXLATEX\\LaTeX\u8a18\u6cd5\u304c\u4f7f\u3048\u308b\u3089\u3057\u3044\u3002\nlibvirt\u306b\u306f\u30c9\u30e1\u30a4\u30f3\u306eCPU\u4f7f\u7528\u7387\u3092\u76f4\u63a5\u53d6\u5f97\u3059\u308b\u30e1\u30bd\u30c3\u30c9\u304c\u7121\u3044\u306e\u3060\u304c\u3001\u4e0a\u8a18\u306e\u8a18\u4e8b\u306b\u3088\u308b\u3068CPU\u306e\u4f7f\u7528\u6642\u9593\u304b\u3089\u4f7f\u7528\u7387\u3092\u8a08\u7b97\u3067\u304d\u308b\u3088\u3046\u3060\u3002\u4ee5\u4e0b\u306flibvirt-python\u306e\u8a71\u3002\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u6574\u5099\u3055\u308c\u3064\u3064\u3042\u308b\u3002\nhttp://libvirt.org/docs/libvirt-appdev-guide-python/en-US/html/index.html\n\u307e\u305a\u306flibvirtd\u306b\u63a5\u7d9a\u3059\u308b\u3002\nimport libvirt\n\ncon = libvirt.openReadOnly()\ndom0 = con.listAllDomains()[0]\n\ndom0\u304c\u30c9\u30e1\u30a4\u30f3\u3002\ndom0.info()\u3067\u30c9\u30e1\u30a4\u30f3\u304c\u8d77\u52d5\u3057\u3066\u304b\u3089CPU\u3092\u4f55\u79d2\u4f7f\u3063\u305f\u304b\u3092\u30ca\u30ce\u79d2\u5358\u4f4d\u3067\u53d6\u5f97\u3067\u304d\u308b\uff08cpuTimecpuTimecpuTime\uff09\u3002\u30c7\u30fc\u30bf\u69cb\u9020\u306fvirDomainInfo\u30025\u756a\u76ee\u306e\u5024\u3002\ncpuTime = dom0.info()[4]\n\n\u3053\u308c\u3092ttt\u79d2\u3054\u3068\u306b\u53d6\u5f97\u3057\u305f\u3068\u3059\u308b\u3068\u3001\u30c9\u30e1\u30a4\u30f3\u306eCPU\u4f7f\u7528\u7387\u306f\ncpuTimenow\u2212cpuTimenow\u2212tt\u00d7nrCores\u00d7109\u00d7100cpuTimenow\u2212cpuTimenow\u2212tt\u00d7nrCores\u00d7109\u00d7100{\\frac{cpuTime_{now} - cpuTime_{now-t}}{t \\times nrCores \\times 10^9}\\times 100\n}\nnrCoresnrCoresnrCores\u306f\u30b7\u30b9\u30c6\u30e0\u306e\u7269\u7406\u30b3\u30a2\u6570\u3092\u793a\u3057\u3001con.getInfo()\u3067\u53d6\u5f97\u3067\u304d\u308b\uff08virNodeInfo\uff09\u3002\n\u30b3\u30a2\u3054\u3068\u306eCPU\u4f7f\u7528\u7387\u3092\u77e5\u308a\u305f\u3044\u5834\u5408\u306b\u306f\u3001dom0.vcpus()\u3092\u4f7f\u3046\u3068\u30b3\u30a2\u3054\u3068\u306eCPU\u4f7f\u7528\u6642\u9593\u3092\u53d6\u5f97\u3067\u304d\u308b\uff08virVcpuInfo\uff09\u3002\u3053\u306e\u5834\u5408\u3001nrCoresnrCoresnrCores\u306f1\u3001\u307e\u305f\u306f\u30cf\u30a4\u30d1\u30fc\u30b9\u30ec\u30c3\u30c9\u304c\u52b9\u3044\u3066\u3044\u308b\u5834\u5408\u306b\u306f2\u3067\u3042\u308b\u3002\n[How do I calculate %CPU in my own libvirt programs?](http://people.redhat.com/~rjones/virt-top/faq.html#calccpu)\n\n\u305d\u3046\u3044\u3048\u3070Qiita\u306f$\\\\LaTeX$\u8a18\u6cd5\u304c\u4f7f\u3048\u308b\u3089\u3057\u3044\u3002\n\nlibvirt\u306b\u306f\u30c9\u30e1\u30a4\u30f3\u306eCPU\u4f7f\u7528\u7387\u3092\u76f4\u63a5\u53d6\u5f97\u3059\u308b\u30e1\u30bd\u30c3\u30c9\u304c\u7121\u3044\u306e\u3060\u304c\u3001\u4e0a\u8a18\u306e\u8a18\u4e8b\u306b\u3088\u308b\u3068CPU\u306e\u4f7f\u7528\u6642\u9593\u304b\u3089\u4f7f\u7528\u7387\u3092\u8a08\u7b97\u3067\u304d\u308b\u3088\u3046\u3060\u3002\u4ee5\u4e0b\u306flibvirt-python\u306e\u8a71\u3002\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u6574\u5099\u3055\u308c\u3064\u3064\u3042\u308b\u3002\nhttp://libvirt.org/docs/libvirt-appdev-guide-python/en-US/html/index.html\n\n\u307e\u305a\u306flibvirtd\u306b\u63a5\u7d9a\u3059\u308b\u3002\n\n```py\nimport libvirt\n\ncon = libvirt.openReadOnly()\ndom0 = con.listAllDomains()[0]\n```\n\n`dom0`\u304c\u30c9\u30e1\u30a4\u30f3\u3002\n\n`dom0.info()`\u3067\u30c9\u30e1\u30a4\u30f3\u304c\u8d77\u52d5\u3057\u3066\u304b\u3089CPU\u3092\u4f55\u79d2\u4f7f\u3063\u305f\u304b\u3092\u30ca\u30ce\u79d2\u5358\u4f4d\u3067\u53d6\u5f97\u3067\u304d\u308b\uff08$cpuTime$\uff09\u3002\u30c7\u30fc\u30bf\u69cb\u9020\u306f[virDomainInfo](http://www.libvirt.org/html/libvirt-libvirt-domain.html#virDomainInfo)\u30025\u756a\u76ee\u306e\u5024\u3002\n\n```py\ncpuTime = dom0.info()[4]\n```\n\n\u3053\u308c\u3092$t$\u79d2\u3054\u3068\u306b\u53d6\u5f97\u3057\u305f\u3068\u3059\u308b\u3068\u3001\u30c9\u30e1\u30a4\u30f3\u306eCPU\u4f7f\u7528\u7387\u306f\n\n```math\n\\frac{cpuTime_{now} - cpuTime_{now-t}}{t \\times nrCores \\times 10^9}\\times 100\n```\n\n$nrCores$\u306f\u30b7\u30b9\u30c6\u30e0\u306e\u7269\u7406\u30b3\u30a2\u6570\u3092\u793a\u3057\u3001`con.getInfo()`\u3067\u53d6\u5f97\u3067\u304d\u308b\uff08[virNodeInfo](http://www.libvirt.org/html/libvirt-libvirt-host.html#virNodeInfo)\uff09\u3002\n\n\u30b3\u30a2\u3054\u3068\u306eCPU\u4f7f\u7528\u7387\u3092\u77e5\u308a\u305f\u3044\u5834\u5408\u306b\u306f\u3001`dom0.vcpus()`\u3092\u4f7f\u3046\u3068\u30b3\u30a2\u3054\u3068\u306eCPU\u4f7f\u7528\u6642\u9593\u3092\u53d6\u5f97\u3067\u304d\u308b\uff08[virVcpuInfo](http://www.libvirt.org/html/libvirt-libvirt-domain.html#virVcpuInfo)\uff09\u3002\u3053\u306e\u5834\u5408\u3001$nrCores$\u306f1\u3001\u307e\u305f\u306f\u30cf\u30a4\u30d1\u30fc\u30b9\u30ec\u30c3\u30c9\u304c\u52b9\u3044\u3066\u3044\u308b\u5834\u5408\u306b\u306f2\u3067\u3042\u308b\u3002\n"}