{"context": "digdag\uff08\u6b63\u78ba\u306b\u306fTreasureData Workflow\uff09\u306etd_wait_table>, td_wait>\u3092\u4f7f\u3063\u3066\u307f\u305f\u306e\u3067\u305d\u306e\u30e1\u30e2\u3067\u3059\u3002\n\n\u30b8\u30e7\u30d6\u30d5\u30ed\u30fc\n\u3053\u3093\u306a\u30d5\u30ed\u30fc\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\uff11. td_wait_table>\u3067\u300cwf_wait_target\u300d\u3068\u3044\u3046\u30c6\u30fc\u30d6\u30eb\u304c\u3067\u304d\u308b\u306e\u3092\u5f85\u3064\n\uff12. \u300cwf_wait_target\u300d\u306b\u30af\u30a8\u30ea\u306a\u3052\u308b\n3. td_wait>\u3067\u300cwf_check\u300d\u30c6\u30fc\u30d6\u30eb\u306b100\u30ec\u30b3\u30fc\u30c9\u4ee5\u4e0a\u306e\u30c7\u30fc\u30bf\u304c\u30b9\u30c8\u30a2\u3055\u308c\u308b\u306e\u3092\u5f85\u3064\n4. \u300cwf_check\u300d\u30c6\u30fc\u30d6\u30eb\u306e\u5185\u5bb9\u3092\u300cexport_wf_check\u300d\u306b\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\ndig\u30d5\u30a1\u30a4\u30eb\u3001SQL\u306f\u4ee5\u4e0b\u306b\u306a\u308a\u307e\u3059\u3002\n\ndig\u30d5\u30a1\u30a4\u30eb\n\ntd_wait.dig\ntimezone: Asia/Tokyo\n\nschedule:\n  daily>: 09:00:00\n\n_export:\n  td:\n    database: test\n\n+task_wait_table:\n  td_wait_table>: wf_wait_target\n\n+task1:\n  td>: queries/count_wf_wait_target.sql\n\n+task_wait:\n  td_wait>: queries/check_record.sql\n\n+task2:\n  td>: queries/export_wf_check.sql\n  create_table: export_wf_check\n\n\n\n\nSQL\n\ncount_wf_wait_target.sql\nSELECT\n    count(1) as cnt\nFROM\n    wf_wait_target\n\n\n\n\ncheck_record.sql\nSELECT\n    count(1) > 100\nFROM\n    wf_check\n\n\n\n\nexport_wf_check.sql\nSELECT\n    *\nFROM\n    wf_check\n\n\n\n\n\u30b8\u30e7\u30d6\u3092\u5b9f\u884c\u3057\u3066\u307f\u308b\n\u4f5c\u6210\u3057\u305fdig,SQL\u3092TreasureData Workflow\u306bPush\u3057\u3066\u3055\u3063\u305d\u304f\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\ntd wf push wf_sample\ntd wf start wf_sample td_wait --session now\n\n\u3053\u3053\u304b\u3089\u306fTreasureData Workflow\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u78ba\u8a8d\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\ntd_wait_table\n\u300cwf_wait_target\u300d\u3068\u3044\u3046\u30c6\u30fc\u30d6\u30eb\u304c\u3067\u304d\u308b\u306e\u3092\u5f85\u3063\u3066\u3044\u307e\u3059\u3002\n30\u79d2\u306b1\u5ea6\u30c6\u30fc\u30d6\u30eb\u306e\u5b58\u5728\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3044\u308b\u306e\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n\ntd_wait\uff08\u30ec\u30b3\u30fc\u30c9\u6570\uff09\u30c1\u30a7\u30c3\u30af\n\u300cwf_wait_target\u300d\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3068\u6b21\u306b\u9032\u3093\u3067\u3001check_record.sql\u3092\u5b9f\u884c\u3057\u3001100\u884c\u4ee5\u4e0a\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3044\u307e\u3059\u3002\nTimeline\u3082\u9032\u3093\u3067\u3044\u307e\u3059\u306d\u3002\n\n\n\u5b9f\u884c\u5b8c\u4e86\n\u300cwf_check\u300d\u30c6\u30fc\u30d6\u30eb\u306b10,000\u884c\u3092Insert\u3059\u308b\u3068\u3001\u6700\u5f8c\u306e\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u307e\u3067\u7121\u4e8b\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002\n\n\n\u3055\u3044\u3054\u306b\ndigdag\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u3082\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001td_wait_table\u306f\u5358\u7d14\u306a\u30c6\u30fc\u30d6\u30eb\u6709\u7121\u3060\u3051\u3067\u306f\u306a\u304f\u30ec\u30b3\u30fc\u30c9\u6570\u3082\u6761\u4ef6\u306b\u5165\u308c\u3089\u308c\u308b\u306e\u3067\u975e\u5e38\u306b\u4f7f\u3044\u52dd\u624b\u304c\u3088\u3055\u305d\u3046\u306b\u601d\u3048\u307e\u3059\u3002\n\u307e\u305f\u3001td_wait\u306ftrue\u3092\u8fd4\u3059\u307e\u3067\u5f85\u3064\u306e\u3067\u3001\u5358\u7d14\u306a\u4ef6\u6570\u4ee5\u5916\u3067\u3082\u4f7f\u3048\u308b\u306e\u304c\u3044\u3044\u3067\u3059\u306d\u3002\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306f\u66f8\u3044\u3066\u306a\u3044\u3067\u3059\u304c\u3001\u3053\u306ewait\u306b\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u306f\u3042\u308b\u306e\u3060\u308d\u3046\u304b\uff1f\n\uff08digdag\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\uff09\n* td_wait_table\n* td_wait\ndigdag\uff08\u6b63\u78ba\u306b\u306fTreasureData Workflow\uff09\u306e`td_wait_table>`, `td_wait>`\u3092\u4f7f\u3063\u3066\u307f\u305f\u306e\u3067\u305d\u306e\u30e1\u30e2\u3067\u3059\u3002\n\n# \u30b8\u30e7\u30d6\u30d5\u30ed\u30fc\n\n\u3053\u3093\u306a\u30d5\u30ed\u30fc\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\uff11. `td_wait_table>`\u3067\u300cwf_wait_target\u300d\u3068\u3044\u3046\u30c6\u30fc\u30d6\u30eb\u304c\u3067\u304d\u308b\u306e\u3092\u5f85\u3064\n\uff12. \u300cwf_wait_target\u300d\u306b\u30af\u30a8\u30ea\u306a\u3052\u308b\n3. `td_wait>`\u3067\u300cwf_check\u300d\u30c6\u30fc\u30d6\u30eb\u306b100\u30ec\u30b3\u30fc\u30c9\u4ee5\u4e0a\u306e\u30c7\u30fc\u30bf\u304c\u30b9\u30c8\u30a2\u3055\u308c\u308b\u306e\u3092\u5f85\u3064\n4. \u300cwf_check\u300d\u30c6\u30fc\u30d6\u30eb\u306e\u5185\u5bb9\u3092\u300cexport_wf_check\u300d\u306b\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\n\ndig\u30d5\u30a1\u30a4\u30eb\u3001SQL\u306f\u4ee5\u4e0b\u306b\u306a\u308a\u307e\u3059\u3002\n\n## dig\u30d5\u30a1\u30a4\u30eb\n\n```yaml:td_wait.dig\ntimezone: Asia/Tokyo\n\nschedule:\n  daily>: 09:00:00\n\n_export:\n  td:\n    database: test\n\n+task_wait_table:\n  td_wait_table>: wf_wait_target\n\n+task1:\n  td>: queries/count_wf_wait_target.sql\n\n+task_wait:\n  td_wait>: queries/check_record.sql\n\n+task2:\n  td>: queries/export_wf_check.sql\n  create_table: export_wf_check\n\n```\n\n## SQL\n\n```sql:count_wf_wait_target.sql\nSELECT\n\tcount(1) as cnt\nFROM\n\twf_wait_target\n\n```\n\n```sql:check_record.sql\nSELECT\n\tcount(1) > 100\nFROM\n\twf_check\n\n```\n\n```sql:export_wf_check.sql\nSELECT\n\t*\nFROM\n\twf_check\n\n```\n\n# \u30b8\u30e7\u30d6\u3092\u5b9f\u884c\u3057\u3066\u307f\u308b\n\n\u4f5c\u6210\u3057\u305fdig,SQL\u3092TreasureData Workflow\u306bPush\u3057\u3066\u3055\u3063\u305d\u304f\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\n```bash\ntd wf push wf_sample\ntd wf start wf_sample td_wait --session now\n```\n\n\u3053\u3053\u304b\u3089\u306fTreasureData Workflow\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u78ba\u8a8d\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n## td_wait_table\n\n\u300cwf_wait_target\u300d\u3068\u3044\u3046\u30c6\u30fc\u30d6\u30eb\u304c\u3067\u304d\u308b\u306e\u3092\u5f85\u3063\u3066\u3044\u307e\u3059\u3002\n30\u79d2\u306b1\u5ea6\u30c6\u30fc\u30d6\u30eb\u306e\u5b58\u5728\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3044\u308b\u306e\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n![tdwait11.png](https://qiita-image-store.s3.amazonaws.com/0/48307/3ead4585-3b40-4b0c-3f39-4d917ee62d12.png)\n\n## td_wait\uff08\u30ec\u30b3\u30fc\u30c9\u6570\uff09\u30c1\u30a7\u30c3\u30af\n\n\u300cwf_wait_target\u300d\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3068\u6b21\u306b\u9032\u3093\u3067\u3001check_record.sql\u3092\u5b9f\u884c\u3057\u3001100\u884c\u4ee5\u4e0a\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3044\u307e\u3059\u3002\nTimeline\u3082\u9032\u3093\u3067\u3044\u307e\u3059\u306d\u3002\n\n![tdwait12.png](https://qiita-image-store.s3.amazonaws.com/0/48307/b541304a-4b3c-9db5-5391-b7a10040c1ef.png)\n\n## \u5b9f\u884c\u5b8c\u4e86\n\n\u300cwf_check\u300d\u30c6\u30fc\u30d6\u30eb\u306b10,000\u884c\u3092Insert\u3059\u308b\u3068\u3001\u6700\u5f8c\u306e\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u307e\u3067\u7121\u4e8b\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002\n\n![tdwait13.png](https://qiita-image-store.s3.amazonaws.com/0/48307/dd0b94ca-f091-eca0-f5c8-6e56f1305a18.png)\n\n# \u3055\u3044\u3054\u306b\n\ndigdag\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u3082\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001td_wait_table\u306f\u5358\u7d14\u306a\u30c6\u30fc\u30d6\u30eb\u6709\u7121\u3060\u3051\u3067\u306f\u306a\u304f\u30ec\u30b3\u30fc\u30c9\u6570\u3082\u6761\u4ef6\u306b\u5165\u308c\u3089\u308c\u308b\u306e\u3067\u975e\u5e38\u306b\u4f7f\u3044\u52dd\u624b\u304c\u3088\u3055\u305d\u3046\u306b\u601d\u3048\u307e\u3059\u3002\n\u307e\u305f\u3001td_wait\u306ftrue\u3092\u8fd4\u3059\u307e\u3067\u5f85\u3064\u306e\u3067\u3001\u5358\u7d14\u306a\u4ef6\u6570\u4ee5\u5916\u3067\u3082\u4f7f\u3048\u308b\u306e\u304c\u3044\u3044\u3067\u3059\u306d\u3002\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306f\u66f8\u3044\u3066\u306a\u3044\u3067\u3059\u304c\u3001\u3053\u306ewait\u306b\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u306f\u3042\u308b\u306e\u3060\u308d\u3046\u304b\uff1f\n\n\uff08digdag\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\uff09\n* [td_wait_table](http://docs.digdag.io/operators.html#td-wait-table-waits-for-data-arriving-at-treasure-data-table)\n* [td_wait](http://docs.digdag.io/operators.html#td-wait-waits-for-data-arriving-at-treasure-data-table)\n\n\n\n\n", "tags": ["digdag", "TreasureData"]}