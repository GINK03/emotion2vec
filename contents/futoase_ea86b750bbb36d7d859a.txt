{"context": " More than 1 year has passed since last update.\n\n\u30b5\u30f3\u30d7\u30eb\u3092\u5143\u306b\u3002\nGoogle Group\u306e\u6295\u7a3f\u3092\u5143\u306b\u3001\u4ee5\u4e0b\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u3044\u305f\u3002\n\u5143\u306b\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u3042\u308b\u305f\u3081\u3001\u8457\u4f5c\u6a29\u306f\u5143\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u6e96\u305a\u308b\u3002\npackage main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"text/template\"\n)\n\ntype LineOfLog struct {\n    RemoteAddr  string\n    ContentType string\n    Path        string\n    Query       string\n    Method      string\n    Body        string\n}\n\nvar TemplateOfLog = `\nRemote address:   {{.RemoteAddr}}\nContent-Type:     {{.ContentType}}\nHTTP method:      {{.Method}}\n\npath:\n{{.Path}}\n\nquery string:\n{{.Query}}\n\nbody:             \n{{.Body}}\n\n`\n\nfunc Log(handler http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        bufbody := new(bytes.Buffer)\n        bufbody.ReadFrom(r.Body)\n        body := bufbody.String()\n\n        line := LineOfLog{\n            r.RemoteAddr,\n            r.Header.Get(\"Content-Type\"),\n            r.URL.Path,\n            r.URL.RawQuery,\n            r.Method, body,\n        }\n        tmpl, err := template.New(\"line\").Parse(TemplateOfLog)\n        if err != nil {\n            panic(err)\n        }\n\n        bufline := new(bytes.Buffer)\n        err = tmpl.Execute(bufline, line)\n        if err != nil {\n            panic(err)\n        }\n\n        log.Printf(bufline.String())\n        handler.ServeHTTP(w, r)\n    })\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        fmt.Fprintf(w, \"OK\")\n    })\n\n    http.ListenAndServe(\":8080\", Log(http.DefaultServeMux))\n}\n\n\n\u30d3\u30eb\u30c9\u30fb\u5b9f\u884c\nmain.go\u3068\u3044\u3046\u5f62\u3067\u4e0a\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4fdd\u5b58\u3057\u3066\u3001\n> go build main.go\n\n\u3067\u30d3\u30eb\u30c9\u3057\u3066\u3001\n> ./main\n\n\u3067\u5b9f\u884c\u3059\u308b\n\n\u30c6\u30b9\u30c8\n\ncurl\u30b3\u30de\u30f3\u30c9\u306b\u3088\u308b\u30c6\u30b9\u30c8\n\u4ee5\u4e0b\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3064\u3002\ncurl\u30b3\u30de\u30f3\u30c9\u3067\u3001\u5148\u307b\u3069\u7acb\u3061\u4e0a\u3052\u305f\u30b5\u30fc\u30d0\u306b\u5bfe\u3057\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308b\u3002\n> curl -X POST 'http://localhost:8080/test?hoge' -d '{\"message\": \"Welcome to underground\"}'\n\n\u7acb\u3061\u4e0a\u3052\u305f\u30b5\u30fc\u30d0\u5074\u306e\u6a19\u6e96\u51fa\u529b\u306b\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u5185\u5bb9\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\n\nfaraday\u7d4c\u7531\u3067\u30c6\u30b9\u30c8\nfaraday\u3092\u4f7f\u3063\u3066\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u3063\u3066\u307f\u308b\u3002\n\ntest.rb\nrequire 'faraday'\nrequire 'json'\n\nconn = Faraday.new(url: 'http://localhost:8080/') do |faraday|\n  faraday.request :url_encoded\n  faraday.response :logger\n  faraday.adapter Faraday.default_adapter\n\nend\n\nconn.post do |req|\n  req.url '/'\n  req.headers['Content-Type'] = 'application/json'\n  req.body = { user: { id: 1, name: 'futoase' }, message: 'Welcome to underground...' }.to_json\nend\n\n\n\u4ee5\u4e0a\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u3001\n\u30b5\u30fc\u30d0\u5074\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308b\u3002\n> ruby test.rb\n\n\u7d50\u679c\u3002faraday\u306eREADME.md\u306b\u66f8\u3044\u3066\u3042\u308b\u901a\u308a\u3002\n\n\n\u7d42\u308f\u308a\n\u76ee\u7684\u304c\u30c7\u30d0\u30c3\u30b0\u3067\u3042\u308a\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u5185\u5bb9\u3092\u89b3\u305f\u3044\u306e\u3067\u3042\u308c\u3070\u3001\nnet cat\u3092\u4f7f\u304a\u3046\u3002\n> nc -l 8080\n\n\u3067\u7d42\u308f\u308b\u3002\n> curl -X POST http://localhost:8080/ -H \"Content-Type: application/json\" -d '{\"message\": \"Welcome to underround\"}'\n\n\n# \u30b5\u30f3\u30d7\u30eb\u3092\u5143\u306b\u3002\n\n[Google Group\u306e\u6295\u7a3f](https://groups.google.com/d/msg/golang-nuts/s7Xk1q0LSU0/vSvGnerlDZ4J)\u3092\u5143\u306b\u3001\u4ee5\u4e0b\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u3044\u305f\u3002\n\u5143\u306b\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u3042\u308b\u305f\u3081\u3001\u8457\u4f5c\u6a29\u306f\u5143\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u6e96\u305a\u308b\u3002\n\n```go\npackage main\n\nimport (\n\t\"bytes\"\n\t\"fmt\"\n\t\"log\"\n\t\"net/http\"\n\t\"text/template\"\n)\n\ntype LineOfLog struct {\n\tRemoteAddr  string\n\tContentType string\n\tPath        string\n\tQuery       string\n\tMethod      string\n\tBody        string\n}\n\nvar TemplateOfLog = `\nRemote address:   {{.RemoteAddr}}\nContent-Type:     {{.ContentType}}\nHTTP method:      {{.Method}}\n\npath:\n{{.Path}}\n\nquery string:\n{{.Query}}\n\nbody:             \n{{.Body}}\n\n`\n\nfunc Log(handler http.Handler) http.Handler {\n\treturn http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n\t\tbufbody := new(bytes.Buffer)\n\t\tbufbody.ReadFrom(r.Body)\n\t\tbody := bufbody.String()\n\n\t\tline := LineOfLog{\n\t\t\tr.RemoteAddr,\n\t\t\tr.Header.Get(\"Content-Type\"),\n\t\t\tr.URL.Path,\n\t\t\tr.URL.RawQuery,\n\t\t\tr.Method, body,\n\t\t}\n\t\ttmpl, err := template.New(\"line\").Parse(TemplateOfLog)\n\t\tif err != nil {\n\t\t\tpanic(err)\n\t\t}\n\n\t\tbufline := new(bytes.Buffer)\n\t\terr = tmpl.Execute(bufline, line)\n\t\tif err != nil {\n\t\t\tpanic(err)\n\t\t}\n\n\t\tlog.Printf(bufline.String())\n\t\thandler.ServeHTTP(w, r)\n\t})\n}\n\nfunc main() {\n\thttp.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n\t\tfmt.Fprintf(w, \"OK\")\n\t})\n\n\thttp.ListenAndServe(\":8080\", Log(http.DefaultServeMux))\n}\n```\n\n# \u30d3\u30eb\u30c9\u30fb\u5b9f\u884c\n\nmain.go\u3068\u3044\u3046\u5f62\u3067\u4e0a\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4fdd\u5b58\u3057\u3066\u3001\n\n```\n> go build main.go\n```\n\n\u3067\u30d3\u30eb\u30c9\u3057\u3066\u3001\n\n```\n> ./main\n```\n\n\u3067\u5b9f\u884c\u3059\u308b\n\n# \u30c6\u30b9\u30c8\n\n## curl\u30b3\u30de\u30f3\u30c9\u306b\u3088\u308b\u30c6\u30b9\u30c8\n\n\u4ee5\u4e0b\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3064\u3002\ncurl\u30b3\u30de\u30f3\u30c9\u3067\u3001\u5148\u307b\u3069\u7acb\u3061\u4e0a\u3052\u305f\u30b5\u30fc\u30d0\u306b\u5bfe\u3057\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308b\u3002\n\n```\n> curl -X POST 'http://localhost:8080/test?hoge' -d '{\"message\": \"Welcome to underground\"}'\n```\n\n\u7acb\u3061\u4e0a\u3052\u305f\u30b5\u30fc\u30d0\u5074\u306e\u6a19\u6e96\u51fa\u529b\u306b\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u5185\u5bb9\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\n![Screen Shot 2014-07-21 at 9.20.49.png](https://qiita-image-store.s3.amazonaws.com/0/3985/30ea48ed-a9f5-d8b5-29e9-9377ee94cf5e.png)\n\n## faraday\u7d4c\u7531\u3067\u30c6\u30b9\u30c8\n\nfaraday\u3092\u4f7f\u3063\u3066\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u3063\u3066\u307f\u308b\u3002\n\n```test.rb\nrequire 'faraday'\nrequire 'json'\n\nconn = Faraday.new(url: 'http://localhost:8080/') do |faraday|\n  faraday.request :url_encoded\n  faraday.response :logger\n  faraday.adapter Faraday.default_adapter\n\nend\n\nconn.post do |req|\n  req.url '/'\n  req.headers['Content-Type'] = 'application/json'\n  req.body = { user: { id: 1, name: 'futoase' }, message: 'Welcome to underground...' }.to_json\nend\n```\n\n\u4ee5\u4e0a\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u3001\n\u30b5\u30fc\u30d0\u5074\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308b\u3002\n\n```\n> ruby test.rb\n```\n\n\u7d50\u679c\u3002faraday\u306eREADME.md\u306b\u66f8\u3044\u3066\u3042\u308b\u901a\u308a\u3002\n\n![Screen Shot 2014-07-21 at 9.35.45.png](https://qiita-image-store.s3.amazonaws.com/0/3985/26ff737e-0af9-e3a2-d1f3-2924a74d37fe.png)\n\n# \u7d42\u308f\u308a\n\n\u76ee\u7684\u304c\u30c7\u30d0\u30c3\u30b0\u3067\u3042\u308a\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u5185\u5bb9\u3092\u89b3\u305f\u3044\u306e\u3067\u3042\u308c\u3070\u3001\n[net cat](http://netcat.sourceforge.net/)\u3092\u4f7f\u304a\u3046\u3002\n\n```\n> nc -l 8080\n```\n\n\u3067\u7d42\u308f\u308b\u3002\n\n```\n> curl -X POST http://localhost:8080/ -H \"Content-Type: application/json\" -d '{\"message\": \"Welcome to underround\"}'\n```\n\n![Screen Shot 2014-07-21 at 9.42.41.png](https://qiita-image-store.s3.amazonaws.com/0/3985/05c6e863-7afc-af61-6c38-659913b388a3.png)\n", "tags": ["golang", "HTTP", "Go"]}