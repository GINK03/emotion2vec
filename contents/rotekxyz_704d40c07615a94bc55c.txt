{"context": "\u307e\u3060\u307e\u3060\u4f7f\u3044\u6163\u308c\u306a\u3044Ansible\u3092\u4f7f\u3063\u3066\u3001\ncron\u3078\u65b0\u898f\u306ejob\u8ffd\u52a0\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u52d5\u4f5c\u74b0\u5883\n\u30fbansible 2.0.1.0\n\u30fbRHEL 6\u7cfb\n\nPlaybook\n\nPlaybook\u306e\u524d\u63d0\n\u30fb\u4e00\u3064\u306ePlaybook\u3067\u8907\u6570\u306e\u5bfe\u8c61\u30b5\u30fc\u30d0\u3078\u4e00\u5ea6\u306bjob\u306e\u8ffd\u52a0\u3092\u3057\u305f\u3044\n\u30fb\u5bfe\u8c61\u306e\u30b5\u30fc\u30d0\u306ecron\u30d5\u30a1\u30a4\u30eb\u306e\u540d\u524d\u306f\u7528\u9014\u6bce\u3067\u547d\u540d\u898f\u5247\u3092\u3064\u3051\u3066\u3044\u308b\n\uff08\u3053\u306e\u72b6\u614b\u304c\u826f\u3044\u306e\u304b\u306f\u5225\u3068\u3057\u3066\u30fb\u30fb\u30fb\uff09\n\u30fbcopy\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u5229\u7528\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u3092\u5dee\u3057\u66ff\u3048\u3066\u3082\u826f\u3044\u304c\u3001\u540c\u3058\u30b0\u30eb\u30fc\u30d7\u3067\u3082\u500b\u5225\u5bfe\u5fdc\u3067cron\u306b\u5dee\u5206\u304c\u3042\u308b\n\uff08\u3053\u308c\u3082\u30a2\u30ea\u306a\u306e\u304b\u30ca\u30b7\u306a\u306e\u304b\u306f\u7f6e\u3044\u3066\u304a\u3044\u3066\u30fb\u30fb\u30fb\uff09\n\u30fbcron\u30d5\u30a1\u30a4\u30eb\u306e\u6700\u4e0b\u6bb5\u3078job\u3092\u8ffd\u52a0\u3059\u308b\u65b9\u6cd5\u306b\u3059\u308b\n\n\u4eca\u56de\u306e\u904b\u7528\u5b9f\u65bd\u6642\u306e\u6d41\u308c\n\u30fb\u4f5c\u696d\u524d\u306bjob\u8ffd\u52a0\u5bfe\u8c61\u306ecron\u30d5\u30a1\u30a4\u30eb\u3092ansible\u306e\u5b9f\u884c\u30b5\u30fc\u30d0\u306b\u53d6\u5f97\u3059\u308b\uff08cron_before\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\uff09\n\u30fbcron\u3078job\u306e\u8ffd\u52a0\u3092\u3059\u308b\n\u30fb\u4f5c\u696d\u5f8c\u306bjob\u8ffd\u52a0\u5bfe\u8c61\u306ecron\u30d5\u30a1\u30a4\u30eb\u3092ansible\u306e\u5b9f\u884c\u30b5\u30fc\u30d0\u306b\u53d6\u5f97\u3059\u308b\uff08cron_after\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\uff09\n\u30fb\u4f5c\u696d\u524d\u5f8c\u306e\u3067\u8ffd\u52a0\u4e88\u5b9a\u306ejob\u306e\u307f\u5dee\u5206\u3068\u3057\u3066\u8868\u793a\u3055\u308c\u308b\u4e8b\u3092\u78ba\u8a8d\u3059\u308b\n\ninventory\u306e\u4e2d\u8eab\n[hogebk]\nhogebk101\nhogebk102\n\n[piyobk]\npiyobk101\n\n[all_host:children]\nhogebk\npiyobk\n\n\nPlaybook\u306e\u4e2d\u8eab\n\nfetch\u306ePlaybook\uff08before\u7528\u3068after\u7528\u306e2\u3064\u3092\u7528\u610f\u3057\u307e\u3059\uff09\n\nplaybook/all/fetch_cron_before_test.yml\n- hosts : all_host\n  gather_facts: no\n  vars:\n    ## \u30ed\u30fc\u30ab\u30eb\u3067\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u53d6\u5f97\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u5b9a\u7fa9\n    ## \u5dee\u5206\u78ba\u8a8d\u3067\u4f5c\u696d\u5b9f\u65bd\u5f8c\u306e\u3082\u306e\u3092\u53d6\u5f97\u3057\u305f\u3044\u5834\u5408\u306fcron_after\u3068\u304b\u306b\u66f8\u304d\u63db\u3048\u3066\u4f7f\u3046\n    fetch_path: cron_before\n    ## hogebk\u30b0\u30eb\u30fc\u30d7\u3067job\u8ffd\u52a0\u4e88\u5b9a\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u5b9a\u7fa9\uff08\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u5bfe\u8c61\u306ecron\u30d5\u30a1\u30a4\u30eb\u540d\uff09\n    hogebk_files:\n      - /etc/cron.d/hogehoge\n    ## piyobk\u30b0\u30eb\u30fc\u30d7\u3067job\u8ffd\u52a0\u4e88\u5b9a\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u5b9a\u7fa9\uff08\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u5bfe\u8c61\u306ecron\u30d5\u30a1\u30a4\u30eb\u540d\uff09\n    piyobk_files:\n      - /etc/cron.d/piyopiyo\n\n  tasks :\n    ## when\u3092\u4f7f\u3044hogebk\u306e\u30db\u30b9\u30c8\u30b0\u30eb\u30fc\u30d7\u306b\u5c5e\u3057\u3066\u3044\u308b\u30db\u30b9\u30c8\u306e\u5834\u5408\u306b\u4ee5\u4e0b\u306e\u5909\u6570\u3092\u5229\u7528\u3057\u3066\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u51e6\u7406\u3059\u308b\n    - name: hogebk  FETCH\n      fetch : src={{ item }} dest=/usr/local/ansible/backup_files/{{inventory_hostname}}/{{ fetch_path }}/{{ item }} flat=yes fail_on_missing=yes\n      with_items : '{{ hogebk_files }}'\n      when: '\"hogebk\" in group_names'\n\n    ## when\u3092\u4f7f\u3044piyobk\u306e\u30db\u30b9\u30c8\u30b0\u30eb\u30fc\u30d7\u306b\u5c5e\u3057\u3066\u3044\u308b\u30db\u30b9\u30c8\u306e\u5834\u5408\u306b\u4ee5\u4e0b\u306e\u5909\u6570\u3092\u5229\u7528\u3057\u3066\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u51e6\u7406\u3059\u308b\n    - name: piyobk  FETCH\n      fetch : src={{ item }} dest=/usr/local/ansible/backup_files/{{inventory_hostname}}/{{ fetch_path }}/{{ item }} flat=yes fail_on_missing=yes\n      with_items : '{{ piyobk_files }}'\n      when: '\"piyobk\" in group_names'\n\n\n\ncron\u30e2\u30b8\u30e5\u30fc\u30eb\u3067job\u8ffd\u52a0\u306ePlaybook\n\u3082\u3057\u304b\u3059\u308b\u3068\u3001job\u306e\u4e2d\u8eab\u3082vars\u306b\u3057\u3066\u3057\u307e\u3046\u306e\u304c\u826f\u3044\u306e\u304b\u3082\u3057\u308c\u306a\u3044\n\nplaybook/all/cron_insert_test.yml\n- hosts : all_host\n  gather_facts: no\n  vars:\n\n  tasks :\n    ## cron\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u3082\u306e\u3092\u8ffd\u52a0\u3059\u308b\u4f8b\n    ## * * * * * root echo test > /root/test.log\n    ## cron\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u6642\u9593\u306a\u3069\u3082\u5f53\u7136\u8a2d\u5b9a\u3059\u308b\u4e8b\u306f\u53ef\u80fd\u3067\u3059\n    ## \u5229\u7528\u53ef\u80fd\u306a\u30d1\u30e9\u30e1\u30fc\u30bf\u306f Ansible Document\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u30fb\u30fb\u30fb\n    ## name\u306fcron\u30b3\u30e1\u30f3\u30c8\n    ## user\u306fcron\u306e\u5b9f\u884c\u30e6\u30fc\u30b6\n    ## job\u306f\u5b9f\u884c\u3055\u305b\u308bjob\u3092\n    ## cron_file\u306f/etc/cron.d/\u914d\u4e0b\u306b\u304a\u3044\u3066\u3044\u308b\u30d5\u30a1\u30a4\u30eb\u540d\n    - name: hogebk CRON INSERT\n      cron : name=\"hogehoge\"\n             user=root\n             job='echo test > /root/test.log'\n             cron_file=hogehoge\n      when: '\"hogebk\" in group_names'\n\n    - name: piyobk CRON INSERT\n      cron : name=\"piyopiyo\"\n             user=root\n             job='echo test > /root/test.log'\n             cron_file=piyopiyo\n      when: '\"piyobk\" in group_names'\n\n\n\n\u5b9f\u884c\u7de8\n\nfetch\n\u4f5c\u696d\u524d\u306b\u30d5\u30a1\u30a4\u30eb\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u53d6\u308a\u307e\u3059\n# ansible-playbook -u root playbook/all/fetch_cron_before_test.yml\nSSH password:\n\nPLAY ***************************************************************************\n\nTASK [hogebk  FETCH] ***********************************************************\nskipping: [piyobk101] => (item=/etc/cron.d/hogehoge)\nchanged: [hogebk101] => (item=/etc/cron.d/hogehoge)\nchanged: [hogebk102] => (item=/etc/cron.d/hogehoge)\n\nTASK [piyobk  FETCH] ***********************************************************\nskipping: [hogebk101] => (item=/etc/cron.d/piyopiyo)\nskipping: [hogebk102] => (item=/etc/cron.d/piyopiyo)\nchanged: [piyobk101] => (item=/etc/cron.d/piyopiyo)\n\nPLAY RECAP *********************************************************************\npiyobk101                  : ok=1    changed=1    unreachable=0    failed=0\nhogebk101                  : ok=1    changed=1    unreachable=0    failed=0\nhogebk102                  : ok=1    changed=1    unreachable=0    failed=0\n\nfetch\u304c\u6210\u529f\u3057\u3066\u3044\u308b\u5834\u5408\u306fchanged\u306b\u306a\u308a\u307e\u3059\n\u307e\u305f\u3001inventory\u3067\u52d5\u4f5c\u5bfe\u8c61\u306e\u30db\u30b9\u30c8\u304c\u3069\u306e\u30b0\u30eb\u30fc\u30d7\u306b\u6240\u5c5e\u3057\u3066\u3044\u308b\u304b\u3067\n\u52d5\u4f5c\u3092\u5206\u3051\u305f\u306e\u3067\u60f3\u5b9a\u901a\u308a\u306a\u306e\u304b\u3082\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\n\ncron job\u8ffd\u52a0\n# ansible-playbook -u root playbook/all/cron_insert_test.yml\nSSH password:\n\nPLAY ***************************************************************************\n\nTASK [hogebk CRON INSERT] ******************************************************\nskipping: [piyobk101]\nchanged: [hogebk101]\nchanged: [hogebk102]\n\nTASK [piyobk CRON INSERT] ******************************************************\nskipping: [hogebk101]\nskipping: [hogebk102]\nchanged: [piyobk101]\n\nPLAY RECAP *********************************************************************\npiyobk101                  : ok=1    changed=1    unreachable=0    failed=0\nhogebk101                  : ok=1    changed=1    unreachable=0    failed=0\nhogebk102                  : ok=1    changed=1    unreachable=0    failed=0\n\n\u3053\u3061\u3089\u3082cron\u30d5\u30a1\u30a4\u30eb\u3078job\u304c\u8ffd\u52a0\u3055\u308c\u308b\u3068changed\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u306b\u306a\u308a\u307e\u3059\n\nfetch\uff08\u4f5c\u696d\u5f8c\uff09\n\u4f5c\u696d\u5f8c\u306b\u3082\u53d6\u5f97\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u696d\u524d\u3068\u5225\u306b\u3057\u305fPlaybook\u3092\u4f7f\u3044fetch\u3092\u5b9f\u65bd\n\uff08\u5b9f\u884c\u753b\u9762\u306f\u7701\u7565\uff09\n\n\u30d5\u30a1\u30a4\u30eb\u306e\u5dee\u5206\u3092\u78ba\u8a8d\u3057\u307e\u3059\n\u30db\u30b9\u30c8\u30b0\u30eb\u30fc\u30d7\u3067\u767b\u9332\u3059\u308b\u5185\u5bb9\u3092\u5206\u3051\u308c\u3070\u3088\u304b\u3063\u305f\u306e\u3067\u3059\u304c\n# diff backup_files/piyobk101/cron_before/etc/cron.d/piyopiyo backup_files/piyobk101/cron_after/etc/cron.d/piyopiyo\n0a1,2\n> #Ansible: piyopiyo\n> * * * * * root echo test > /root/test.log\n\n# diff backup_files/hogebk101/cron_before/etc/cron.d/hogehoge backup_files/hogebk101/cron_after/etc/cron.d/hogehoge\n0a1,2\n> #Ansible: hogehoge\n> * * * * * root echo test > /root/test.log\n\n# diff backup_files/hogebk102/cron_before/etc/cron.d/hogehoge backup_files/hogebk102/cron_after/etc/cron.d/hogehoge\n0a1,2\n> #Ansible: hogehoge\n> * * * * * root echo test > /root/test.log\n\n\u60f3\u5b9a\u901a\u308a\u306ejob\u8ffd\u52a0\u3060\u3051\u304c\u5dee\u5206\u3068\u3057\u3066\u73fe\u308c\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\n\u307e\u305f\u3001\u4eca\u56de\u3067\u306fhogehoge\u306ecron\u30d5\u30a1\u30a4\u30eb\u3078\u306fhogehoge\u306e\u30b3\u30e1\u30f3\u30c8\u4ed8\u304d\npiyopiyo\u306ecorn\u30d5\u30a1\u30a4\u30eb\u3078\u306fpiyopiyo\u306e\u30b3\u30e1\u30f3\u30c8\u304c\u633f\u5165\u3055\u308c\u3066\u3044\u308b\u4e8b\n\uff08\u30bf\u30b9\u30af\u304c\u6240\u5c5e\u3059\u308b\u30db\u30b9\u30c8\u30b0\u30eb\u30fc\u30d7\u3067\u5224\u5b9a\u3055\u308c\u51e6\u7406\u3055\u308c\u3066\u3044\u308b\u3053\u3068\uff09\u3092\u78ba\u8a8d\u3057\u307e\u3059\n\u307e\u3060\u307e\u3060\u4f7f\u3044\u6163\u308c\u306a\u3044Ansible\u3092\u4f7f\u3063\u3066\u3001\ncron\u3078\u65b0\u898f\u306ejob\u8ffd\u52a0\u3092\u884c\u3044\u307e\u3059\u3002\n\n#\u52d5\u4f5c\u74b0\u5883\n\u30fbansible 2.0.1.0\n\u30fbRHEL 6\u7cfb\n\n#Playbook\n##Playbook\u306e\u524d\u63d0\n\u30fb\u4e00\u3064\u306ePlaybook\u3067\u8907\u6570\u306e\u5bfe\u8c61\u30b5\u30fc\u30d0\u3078\u4e00\u5ea6\u306bjob\u306e\u8ffd\u52a0\u3092\u3057\u305f\u3044\n\u30fb\u5bfe\u8c61\u306e\u30b5\u30fc\u30d0\u306ecron\u30d5\u30a1\u30a4\u30eb\u306e\u540d\u524d\u306f\u7528\u9014\u6bce\u3067\u547d\u540d\u898f\u5247\u3092\u3064\u3051\u3066\u3044\u308b\n\uff08\u3053\u306e\u72b6\u614b\u304c\u826f\u3044\u306e\u304b\u306f\u5225\u3068\u3057\u3066\u30fb\u30fb\u30fb\uff09\n\u30fbcopy\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u5229\u7528\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u3092\u5dee\u3057\u66ff\u3048\u3066\u3082\u826f\u3044\u304c\u3001\u540c\u3058\u30b0\u30eb\u30fc\u30d7\u3067\u3082\u500b\u5225\u5bfe\u5fdc\u3067cron\u306b\u5dee\u5206\u304c\u3042\u308b\n\uff08\u3053\u308c\u3082\u30a2\u30ea\u306a\u306e\u304b\u30ca\u30b7\u306a\u306e\u304b\u306f\u7f6e\u3044\u3066\u304a\u3044\u3066\u30fb\u30fb\u30fb\uff09\n\u30fbcron\u30d5\u30a1\u30a4\u30eb\u306e\u6700\u4e0b\u6bb5\u3078job\u3092\u8ffd\u52a0\u3059\u308b\u65b9\u6cd5\u306b\u3059\u308b\n\n##\u4eca\u56de\u306e\u904b\u7528\u5b9f\u65bd\u6642\u306e\u6d41\u308c\n\u30fb\u4f5c\u696d\u524d\u306bjob\u8ffd\u52a0\u5bfe\u8c61\u306ecron\u30d5\u30a1\u30a4\u30eb\u3092ansible\u306e\u5b9f\u884c\u30b5\u30fc\u30d0\u306b\u53d6\u5f97\u3059\u308b\uff08cron_before\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\uff09\n\u30fbcron\u3078job\u306e\u8ffd\u52a0\u3092\u3059\u308b\n\u30fb\u4f5c\u696d\u5f8c\u306bjob\u8ffd\u52a0\u5bfe\u8c61\u306ecron\u30d5\u30a1\u30a4\u30eb\u3092ansible\u306e\u5b9f\u884c\u30b5\u30fc\u30d0\u306b\u53d6\u5f97\u3059\u308b\uff08cron_after\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\uff09\n\u30fb\u4f5c\u696d\u524d\u5f8c\u306e\u3067\u8ffd\u52a0\u4e88\u5b9a\u306ejob\u306e\u307f\u5dee\u5206\u3068\u3057\u3066\u8868\u793a\u3055\u308c\u308b\u4e8b\u3092\u78ba\u8a8d\u3059\u308b\n\n##inventory\u306e\u4e2d\u8eab\n\n```\n[hogebk]\nhogebk101\nhogebk102\n\n[piyobk]\npiyobk101\n\n[all_host:children]\nhogebk\npiyobk\n```\n\n##Playbook\u306e\u4e2d\u8eab\n###fetch\u306ePlaybook\uff08before\u7528\u3068after\u7528\u306e2\u3064\u3092\u7528\u610f\u3057\u307e\u3059\uff09\n\n```playbook/all/fetch_cron_before_test.yml:\n- hosts : all_host\n  gather_facts: no\n  vars:\n    ## \u30ed\u30fc\u30ab\u30eb\u3067\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u53d6\u5f97\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u5b9a\u7fa9\n    ## \u5dee\u5206\u78ba\u8a8d\u3067\u4f5c\u696d\u5b9f\u65bd\u5f8c\u306e\u3082\u306e\u3092\u53d6\u5f97\u3057\u305f\u3044\u5834\u5408\u306fcron_after\u3068\u304b\u306b\u66f8\u304d\u63db\u3048\u3066\u4f7f\u3046\n    fetch_path: cron_before\n    ## hogebk\u30b0\u30eb\u30fc\u30d7\u3067job\u8ffd\u52a0\u4e88\u5b9a\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u5b9a\u7fa9\uff08\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u5bfe\u8c61\u306ecron\u30d5\u30a1\u30a4\u30eb\u540d\uff09\n    hogebk_files:\n      - /etc/cron.d/hogehoge\n    ## piyobk\u30b0\u30eb\u30fc\u30d7\u3067job\u8ffd\u52a0\u4e88\u5b9a\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u5b9a\u7fa9\uff08\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u5bfe\u8c61\u306ecron\u30d5\u30a1\u30a4\u30eb\u540d\uff09\n    piyobk_files:\n      - /etc/cron.d/piyopiyo\n\n  tasks :\n    ## when\u3092\u4f7f\u3044hogebk\u306e\u30db\u30b9\u30c8\u30b0\u30eb\u30fc\u30d7\u306b\u5c5e\u3057\u3066\u3044\u308b\u30db\u30b9\u30c8\u306e\u5834\u5408\u306b\u4ee5\u4e0b\u306e\u5909\u6570\u3092\u5229\u7528\u3057\u3066\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u51e6\u7406\u3059\u308b\n    - name: hogebk  FETCH\n      fetch : src={{ item }} dest=/usr/local/ansible/backup_files/{{inventory_hostname}}/{{ fetch_path }}/{{ item }} flat=yes fail_on_missing=yes\n      with_items : '{{ hogebk_files }}'\n      when: '\"hogebk\" in group_names'\n\n    ## when\u3092\u4f7f\u3044piyobk\u306e\u30db\u30b9\u30c8\u30b0\u30eb\u30fc\u30d7\u306b\u5c5e\u3057\u3066\u3044\u308b\u30db\u30b9\u30c8\u306e\u5834\u5408\u306b\u4ee5\u4e0b\u306e\u5909\u6570\u3092\u5229\u7528\u3057\u3066\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u51e6\u7406\u3059\u308b\n    - name: piyobk  FETCH\n      fetch : src={{ item }} dest=/usr/local/ansible/backup_files/{{inventory_hostname}}/{{ fetch_path }}/{{ item }} flat=yes fail_on_missing=yes\n      with_items : '{{ piyobk_files }}'\n      when: '\"piyobk\" in group_names'\n```\n\n###cron\u30e2\u30b8\u30e5\u30fc\u30eb\u3067job\u8ffd\u52a0\u306ePlaybook\n\u3082\u3057\u304b\u3059\u308b\u3068\u3001job\u306e\u4e2d\u8eab\u3082vars\u306b\u3057\u3066\u3057\u307e\u3046\u306e\u304c\u826f\u3044\u306e\u304b\u3082\u3057\u308c\u306a\u3044\n\n```playbook/all/cron_insert_test.yml:\n- hosts : all_host\n  gather_facts: no\n  vars:\n\n  tasks :\n    ## cron\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u3082\u306e\u3092\u8ffd\u52a0\u3059\u308b\u4f8b\n    ## * * * * * root echo test > /root/test.log\n    ## cron\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u6642\u9593\u306a\u3069\u3082\u5f53\u7136\u8a2d\u5b9a\u3059\u308b\u4e8b\u306f\u53ef\u80fd\u3067\u3059\n    ## \u5229\u7528\u53ef\u80fd\u306a\u30d1\u30e9\u30e1\u30fc\u30bf\u306f Ansible Document\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u30fb\u30fb\u30fb\n    ## name\u306fcron\u30b3\u30e1\u30f3\u30c8\n    ## user\u306fcron\u306e\u5b9f\u884c\u30e6\u30fc\u30b6\n    ## job\u306f\u5b9f\u884c\u3055\u305b\u308bjob\u3092\n    ## cron_file\u306f/etc/cron.d/\u914d\u4e0b\u306b\u304a\u3044\u3066\u3044\u308b\u30d5\u30a1\u30a4\u30eb\u540d\n    - name: hogebk CRON INSERT\n      cron : name=\"hogehoge\"\n             user=root\n             job='echo test > /root/test.log'\n             cron_file=hogehoge\n      when: '\"hogebk\" in group_names'\n\n    - name: piyobk CRON INSERT\n      cron : name=\"piyopiyo\"\n             user=root\n             job='echo test > /root/test.log'\n             cron_file=piyopiyo\n      when: '\"piyobk\" in group_names'\n```\n\n##\u5b9f\u884c\u7de8\n###fetch\n\u4f5c\u696d\u524d\u306b\u30d5\u30a1\u30a4\u30eb\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u53d6\u308a\u307e\u3059\n\n```\n# ansible-playbook -u root playbook/all/fetch_cron_before_test.yml\nSSH password:\n\nPLAY ***************************************************************************\n\nTASK [hogebk  FETCH] ***********************************************************\nskipping: [piyobk101] => (item=/etc/cron.d/hogehoge)\nchanged: [hogebk101] => (item=/etc/cron.d/hogehoge)\nchanged: [hogebk102] => (item=/etc/cron.d/hogehoge)\n\nTASK [piyobk  FETCH] ***********************************************************\nskipping: [hogebk101] => (item=/etc/cron.d/piyopiyo)\nskipping: [hogebk102] => (item=/etc/cron.d/piyopiyo)\nchanged: [piyobk101] => (item=/etc/cron.d/piyopiyo)\n\nPLAY RECAP *********************************************************************\npiyobk101                  : ok=1    changed=1    unreachable=0    failed=0\nhogebk101                  : ok=1    changed=1    unreachable=0    failed=0\nhogebk102                  : ok=1    changed=1    unreachable=0    failed=0\n```\n\nfetch\u304c\u6210\u529f\u3057\u3066\u3044\u308b\u5834\u5408\u306fchanged\u306b\u306a\u308a\u307e\u3059\n\u307e\u305f\u3001inventory\u3067\u52d5\u4f5c\u5bfe\u8c61\u306e\u30db\u30b9\u30c8\u304c\u3069\u306e\u30b0\u30eb\u30fc\u30d7\u306b\u6240\u5c5e\u3057\u3066\u3044\u308b\u304b\u3067\n\u52d5\u4f5c\u3092\u5206\u3051\u305f\u306e\u3067\u60f3\u5b9a\u901a\u308a\u306a\u306e\u304b\u3082\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\n\n###cron job\u8ffd\u52a0\n\n```\n# ansible-playbook -u root playbook/all/cron_insert_test.yml\nSSH password:\n\nPLAY ***************************************************************************\n\nTASK [hogebk CRON INSERT] ******************************************************\nskipping: [piyobk101]\nchanged: [hogebk101]\nchanged: [hogebk102]\n\nTASK [piyobk CRON INSERT] ******************************************************\nskipping: [hogebk101]\nskipping: [hogebk102]\nchanged: [piyobk101]\n\nPLAY RECAP *********************************************************************\npiyobk101                  : ok=1    changed=1    unreachable=0    failed=0\nhogebk101                  : ok=1    changed=1    unreachable=0    failed=0\nhogebk102                  : ok=1    changed=1    unreachable=0    failed=0\n```\n\n\u3053\u3061\u3089\u3082cron\u30d5\u30a1\u30a4\u30eb\u3078job\u304c\u8ffd\u52a0\u3055\u308c\u308b\u3068changed\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u306b\u306a\u308a\u307e\u3059\n\n### fetch\uff08\u4f5c\u696d\u5f8c\uff09\n\u4f5c\u696d\u5f8c\u306b\u3082\u53d6\u5f97\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u696d\u524d\u3068\u5225\u306b\u3057\u305fPlaybook\u3092\u4f7f\u3044fetch\u3092\u5b9f\u65bd\n\uff08\u5b9f\u884c\u753b\u9762\u306f\u7701\u7565\uff09\n\n### \u30d5\u30a1\u30a4\u30eb\u306e\u5dee\u5206\u3092\u78ba\u8a8d\u3057\u307e\u3059\n\u30db\u30b9\u30c8\u30b0\u30eb\u30fc\u30d7\u3067\u767b\u9332\u3059\u308b\u5185\u5bb9\u3092\u5206\u3051\u308c\u3070\u3088\u304b\u3063\u305f\u306e\u3067\u3059\u304c\n\n```\n# diff backup_files/piyobk101/cron_before/etc/cron.d/piyopiyo backup_files/piyobk101/cron_after/etc/cron.d/piyopiyo\n0a1,2\n> #Ansible: piyopiyo\n> * * * * * root echo test > /root/test.log\n\n# diff backup_files/hogebk101/cron_before/etc/cron.d/hogehoge backup_files/hogebk101/cron_after/etc/cron.d/hogehoge\n0a1,2\n> #Ansible: hogehoge\n> * * * * * root echo test > /root/test.log\n\n# diff backup_files/hogebk102/cron_before/etc/cron.d/hogehoge backup_files/hogebk102/cron_after/etc/cron.d/hogehoge\n0a1,2\n> #Ansible: hogehoge\n> * * * * * root echo test > /root/test.log\n```\n\n\u60f3\u5b9a\u901a\u308a\u306ejob\u8ffd\u52a0\u3060\u3051\u304c\u5dee\u5206\u3068\u3057\u3066\u73fe\u308c\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\n\u307e\u305f\u3001\u4eca\u56de\u3067\u306fhogehoge\u306ecron\u30d5\u30a1\u30a4\u30eb\u3078\u306fhogehoge\u306e\u30b3\u30e1\u30f3\u30c8\u4ed8\u304d\npiyopiyo\u306ecorn\u30d5\u30a1\u30a4\u30eb\u3078\u306fpiyopiyo\u306e\u30b3\u30e1\u30f3\u30c8\u304c\u633f\u5165\u3055\u308c\u3066\u3044\u308b\u4e8b\n\uff08\u30bf\u30b9\u30af\u304c\u6240\u5c5e\u3059\u308b\u30db\u30b9\u30c8\u30b0\u30eb\u30fc\u30d7\u3067\u5224\u5b9a\u3055\u308c\u51e6\u7406\u3055\u308c\u3066\u3044\u308b\u3053\u3068\uff09\u3092\u78ba\u8a8d\u3057\u307e\u3059\n\n", "tags": ["Ansible", "ansible-playbook", "Linux", "redhat"]}