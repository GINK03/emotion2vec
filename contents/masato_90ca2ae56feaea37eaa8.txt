{"context": " More than 1 year has passed since last update.Meshblu\u767b\u9332\u3057\u305f\u30c7\u30d0\u30a4\u30b9\u3092\u4f7f\u3044MQTT\u3068HTTP\u9593\u3067\u76f8\u4e92\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u9001\u53d7\u4fe1\u3092\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\u8907\u6570\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u9055\u3044\u3092Meshblu\u306e\u30d6\u30ed\u30fc\u30ab\u30fc\u304c\u5438\u53ce\u3057\u3066\u304f\u308c\u308b\u306e\u3067\u3088\u308a\u591a\u304f\u306e\u30b5\u30fc\u30d3\u30b9\u3084\u30c7\u30d0\u30a4\u30b9\u304c\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u4ea4\u63db\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u74b0\u5883\u5909\u6570\n\u30c7\u30d0\u30a4\u30b9\u306e\u767b\u9332\u3068\u5229\u7528\u306b\u4f7f\u3046\u74b0\u5883\u5909\u6570\u3067\u3059\u3002~/.bashrc\u306a\u3069\u306b\u66f8\u3044\u3066\u304a\u304d\u307e\u3059\u3002\n\n~/.bashrc\nexport MESHBLU_BROKER=xxx.xxx.xxx.xxx\nexport MESHBLU_URL=https://$MESHBLU_BROKER\nexport HTTP_SUB_UUID=http-sub\nexport HTTP_SUB_TOKEN=505478\nexport MQTT_PUB_UUID=mqtt-pub\nexport MQTT_PUB_TOKEN=889346\n\n\n\n\u30c7\u30d0\u30a4\u30b9\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1\u6a29\u9650\n\u30c7\u30d0\u30a4\u30b9\u306eowner\u3068whitelist\u306e\u6a29\u9650\u306f\u524d\u56de\u8a2d\u5b9a\u3057\u305f\u72b6\u614b\u304b\u3089\u306f\u3058\u3081\u307e\u3059\u3002\u8aac\u660e\u4e0ahttp-sub\u3001mqtt-pub\u3068\u3044\u3046UUID\u3092\u4ed8\u3051\u3066\u3044\u307e\u3059\u304c\u3001\u3069\u3061\u3089\u3082\u81ea\u5206\u304c\u30c7\u30d0\u30a4\u30b9\u306e\u30aa\u30fc\u30ca\u30fc\u306a\u306e\u3067\u81ea\u5206\u81ea\u8eab\u306b\u5bfe\u3057\u3066\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u9001\u53d7\u4fe1\u304c\u53ef\u80fd\u3067\u3059\u3002\n\nhttp-sub\u30c7\u30d0\u30a4\u30b9\nhttp-sub\u30c7\u30d0\u30a4\u30b9\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u306b\u3057\u3066\u3044\u307e\u3059\u3002OSX\u4e0a\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u3068\u304d\u306b\u4f7f\u3046\u60f3\u5b9a\u3067\u3059\u3002\n\n\n\"protocol\":\"http\" -> HTTP\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3067\u304d\u308b\n\n\"sendWhitelist\":\"[mqtt-pub]\" -> mqtt-pub\u30c7\u30d0\u30a4\u30b9\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3067\u304d\u308b\n\"owner\":\"http-sub\" -> \u81ea\u5206\u304c\u30aa\u30fc\u30ca\u30fc\u306a\u306e\u3067http-sub\u30c7\u30d0\u30a4\u30b9\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u53d7\u4fe1\u3067\u304d\u308b\n\n$ curl -X GET \\\n  \"$MESHBLU_URL/devices/$HTTP_SUB_UUID\" \\\n  --insecure \\\n  --header \"meshblu_auth_uuid: $HTTP_SUB_UUID\" \\\n  --header \"meshblu_auth_token: $HTTP_SUB_TOKEN\"\n{\"devices\":[{\"discoverWhitelist\":\"[mqtt-pub]\",\"geo\":null,\"ipAddress\":\"172.17.42.1\",\"name\":\"http-sub\",\"online\":false,\"owner\":\"http-sub\",\"protocol\":\"http\",\"sendWhitelist\":\"[mqtt-pub]\",\"timestamp\":\"2015-03-28T20:02:54.875Z\",\"uuid\":\"http-sub\"}]}\n\n\nmqtt-sub\u30c7\u30d0\u30a4\u30b9\nmqtt-pub\u30c7\u30d0\u30a4\u30b9\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u306b\u3057\u3066\u3044\u307e\u3059\u3002Raspberry Pi\u4e0a\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u3068\u304d\u306b\u4f7f\u3046\u60f3\u5b9a\u3067\u3059\u3002\n\n\n\"protocol\":\"mqtt\" -> MQTT\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3067\u304d\u308b\n\"owner\":\"mqtt-pub\" -> \u81ea\u5206\u304c\u30aa\u30fc\u30ca\u30fc\u306a\u306e\u3067mqtt-pub\u30c7\u30d0\u30a4\u30b9\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u53d7\u4fe1\u3067\u304d\u308b\n\n$ curl -X GET \\\n  \"$MESHBLU_URL/devices/$MQTT_PUB_UUID\" \\\n  --insecure \\\n  --header \"meshblu_auth_uuid: $MQTT_PUB_UUID\" \\\n  --header \"meshblu_auth_token: $MQTT_PUB_TOKEN\"\n{\"devices\":[{\"discoverWhitelist\":[\"mqtt-pub\"],\"geo\":null,\"ipAddress\":\"172.17.42.1\",\"name\":\"mqtt-pub\",\"online\":true,\"onlineSince\":\"2015-03-28T01:37:48.875Z\",\"owner\":\"mqtt-pub\",\"protocol\":\"mqtt\",\"timestamp\":\"2015-03-28T20:22:25.885Z\",\"uuid\":\"mqtt-pub\"}]}\n\n\n\u30c7\u30d0\u30a4\u30b9\u306eUUID/TOKEN\u3092\u4f7f\u3046\u30de\u30b7\u30f3\n\u7528\u610f\u3057\u305f2\u3064\u306e\u30c7\u30d0\u30a4\u30b9\u306eUUID/TOKEN\u306f\u305d\u308c\u305e\u308c\u4ee5\u4e0b\u306e\u30de\u30b7\u30f3\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u53d7\u4fe1\u3059\u308b\u3068\u304d\u306b\u4f7f\u3044\u307e\u3059\u3002\n\n\nmqtt-pub\u30c7\u30d0\u30a4\u30b9\u306eUUID/TOKEN: Raspberry Pi\n\nhttp-sub\u30c7\u30d0\u30a4\u30b9\u306eUUID/TOKEN: OSX\n\n\u30c7\u30d0\u30a4\u30b9\u60c5\u5831\u306b\u306fgeo\u3084ipAddress\u306e\u30ad\u30fc\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u4eca\u306e\u3068\u3053\u308d\u7269\u7406\u7684\u306a\u30de\u30b7\u30f3\u306b\u7d50\u3073\u3064\u3044\u3066\u306f\u3044\u306a\u3044\u306e\u3067UUID/TOKEN\u306f\u3069\u306e\u30de\u30b7\u30f3\u304b\u3089\u3082\u5229\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u3002\n\nMQTT(mqtt-pub) > HTTP(http-sub)\nUUID\u3092auth\u306b\u4f7f\u3044\u307e\u3059\u3002mosquitto_sub\u3084mosquitto_pub\u30b3\u30de\u30f3\u30c9\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u307e\u305f\u306f\u53d7\u4fe1\u3059\u308b\u3068\u3001\u30c7\u30d0\u30a4\u30b9\u60c5\u5831\u306eprotocol\u304cmqtt\u306b\u66f4\u65b0\u3055\u308c\u307e\u3059\u3002\nmosquitto_sub\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n$ mosquitto_sub \\\n  -h $MESHBLU_BROKER  \\\n  -p 1883 \\\n  -t $HTTP_SUB_UUID \\\n  -u $HTTP_SUB_UUID \\\n  -P $HTTP_SUB_TOKEN \\\n  -d\nClient mosqsub/1830-minion1.cs sending CONNECT\nClient mosqsub/1830-minion1.cs received CONNACK\nClient mosqsub/1830-minion1.cs sending SUBSCRIBE (Mid: 1, Topic: http-sub, QoS: 0)\nClient mosqsub/1830-minion1.cs received SUBACK\nSubscribed (mid: 1): 0\n\n\u30c7\u30d0\u30a4\u30b9\u60c5\u5831\u3092\u78ba\u8a8d\u3059\u308b\u3068protocol\u304cmqtt\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n$ curl -X GET \\\n  \"$MESHBLU_URL/devices/$HTTP_SUB_UUID\" \\\n  --insecure \\\n  --header \"meshblu_auth_uuid: $HTTP_SUB_UUID\" \\\n  --header \"meshblu_auth_token: $HTTP_SUB_TOKEN\"\n{\"devices\":[{\"discoverWhitelist\":\"[mqtt-pub]\",\"geo\":null,\"ipAddress\":\"172.17.42.1\",\"name\":\"http-sub\",\"online\":false,\"owner\":\"http-sub\",\"protocol\":\"mqtt\",\"sendWhitelist\":\"[mqtt-pub]\",\"timestamp\":\"2015-03-28T20:02:54.875Z\",\"uuid\":\"http-sub\"}]}\n\nHTTP\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u5834\u5408\u306fprotocol\u3092http\u306b\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068protocol\u306f\u30c7\u30d0\u30a4\u30b9\u60c5\u5831\u306eJSON\u306b\u542b\u307e\u308c\u3066\u3044\u307e\u305b\u3093\u3002UUID\u3067\u4e00\u5ea6\u3082MQTT\u3092\u4f7f\u308f\u306a\u3051\u308c\u3070protocol\u306e\u66f4\u65b0\u306f\u4e0d\u8981\u3067\u3059\u304c\u5ff5\u306e\u305f\u3081\u884c\u3044\u307e\u3059\u3002\n$ curl -X PUT \\\n  \"$MESHBLU_URL/devices/$HTTP_SUB_UUID\" \\\n  --insecure \\\n  -d \"token=$HTTP_SUB_TOKEN&protocol=http\" \\\n  --header \"meshblu_auth_uuid: $HTTP_SUB_UUID\" \\\n  --header \"meshblu_auth_token: $HTTP_SUB_TOKEN\"\n{\"discoverWhitelist\":\"[mqtt-pub]\",\"geo\":null,\"ipAddress\":\"172.17.42.1\",\"name\":\"http-sub\",\"online\":false,\"owner\":\"http-sub\",\"protocol\":\"http\",\"sendWhitelist\":\"[mqtt-pub]\",\"timestamp\":\"2015-03-28T01:26:31.531Z\",\"uuid\":\"http-sub\",\"fromUuid\":\"http-sub\",\"from\":{\"_id\":\"5519eebc6c04bc0a002d59ae\",\"discoverWhitelist\":\"[mqtt-pub]\",\"geo\":null,\"ipAddress\":\"172.17.42.1\",\"name\":\"http-sub\",\"online\":false,\"owner\":\"http-sub\",\"sendWhitelist\":\"[mqtt-pub]\",\"timestamp\":\"2015-03-28T00:58:16.467Z\",\"uuid\":\"http-sub\"}}\n\nOSX\u4e0a\u3067http-sub\u30c7\u30d0\u30a4\u30b9\u3092auth\u60c5\u5831\u306b\u3057\u3066curl\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3092subscribe\u3057\u307e\u3059\u3002publish\u3055\u308c\u308b\u524d\u306bsubscribe\u3057\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n$ curl -X GET \\\n  \"$MESHBLU_URL/subscribe\" \\\n  --insecure \\\n  --header \"meshblu_auth_uuid: $HTTP_SUB_UUID\" \\\n  --header \"meshblu_auth_token: $HTTP_SUB_TOKEN\"\n\nRaspberry Pi\u4e0a\u3067mqtt-pub\u30c7\u30d0\u30a4\u30b9\u3092auth\u60c5\u5831\u306b\u3057\u3066Mosquitto Clients\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3092publish\u3057\u307e\u3059\u3002\n$ mosquitto_pub \\\n  -h $MESHBLU_BROKER  \\\n  -p 1883 \\\n  -t message \\\n  -m '{\"devices\": [\"'\"$HTTP_SUB_UUID\"'\"], \"payload\": {\"red\":\"on\"}}' \\\n  -u $MQTT_PUB_UUID \\\n  -P $MQTT_PUB_TOKEN \\\n  -d\nClient mosqpub/30699-raspberry sending CONNECT\nClient mosqpub/30699-raspberry received CONNACK\nClient mosqpub/30699-raspberry sending PUBLISH (d0, q0, r0, m1, 'message', ... (50 bytes))\nClient mosqpub/30699-raspberry sending DISCONNECT\n\nOSX\u4e0a\u3067subscribe\u3057\u3066\u3044\u308b\u30b7\u30a7\u30eb\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u304d\u307e\u3057\u305f\u3002\n{\"devices\":[\"http-sub\"],\"payload\":{\"red\":\"on\"},\"fromUuid\":\"mqtt-pub\"},\n\n\nHTTP(http-sub) > HTTP(http-sub)\nOSX\u4e0a\u3067http-sub\u30c7\u30d0\u30a4\u30b9\u3092auth\u306b\u60c5\u5831\u306b\u3057\u3066curl\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3092subscribe\u3057\u307e\u3059\u3002\n$ curl -X GET \\\n  \"$MESHBLU_URL/subscribe\" \\\n  --insecure \\\n  --header \"meshblu_auth_uuid: $HTTP_SUB_UUID\" \\\n  --header \"meshblu_auth_token: $HTTP_SUB_TOKEN\"\n\nhttp-sub\u30c7\u30d0\u30a4\u30b9\u304b\u3089http-sub\u30c7\u30d0\u30a4\u30b9\u3078\u306f\u81ea\u5206\u304c\u30aa\u30fc\u30ca\u30fc\u306a\u306e\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3067\u304d\u307e\u3059\u3002\n$ curl -X POST \\\n  \"$MESHBLU_URL/messages\" \\\n  --insecure \\\n  -d '{\"devices\": [\"'\"$HTTP_SUB_UUID\"'\"], \"payload\": {\"red\":\"on\"}}' \\\n  --header \"meshblu_auth_uuid: $HTTP_SUB_UUID\" \\\n  --header \"meshblu_auth_token: $HTTP_SUB_TOKEN\"\n{\"devices\":[\"http-sub\"],\"payload\":{\"red\":\"on\"}}\n\nOSX\u4e0a\u3067subscribe\u3057\u3066\u3044\u308b\u30b7\u30a7\u30eb\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u304d\u307e\u3057\u305f\u3002\n{\"devices\":[\"http-sub\"],\"payload\":{\"red\":\"on\"},\"fromUuid\":\"http-sub\"},\n\n\nMQTT(mqtt-pub) > MQTT(mqtt-pub)\nRaspberry Pi\u4e0a\u3067mqtt-pub\u30c7\u30d0\u30a4\u30b9\u3092auth\u60c5\u5831\u306b\u3057\u3066subscribe\u3057\u307e\u3059\u3002\n$ mosquitto_sub \\\n  -h $MESHBLU_BROKER  \\\n  -p 1883 \\\n  -t $MQTT_PUB_UUID \\\n  -u $MQTT_PUB_UUID \\\n  -P $MQTT_PUB_TOKEN \\\n  -d\nClient mosqsub/26961-raspberry sending CONNECT\nClient mosqsub/26961-raspberry received CONNACK\nClient mosqsub/26961-raspberry sending SUBSCRIBE (Mid: 1, Topic: mqtt-pub, QoS: 0)\nClient mosqsub/26961-raspberry received SUBACK\nSubscribed (mid: 1): 0\n\nOSX\u4e0a\u3067\u540c\u69d8\u306bpublish\u3057\u307e\u3059\u3002\n$ mosquitto_pub \\\n  -h $MESHBLU_BROKER  \\\n  -p 1883 \\\n  -t message \\\n  -m '{\"devices\": [\"'\"$MQTT_PUB_UUID\"'\"], \"payload\": {\"red\":\"on\"}}' \\\n  -u $MQTT_PUB_UUID \\\n  -P $MQTT_PUB_TOKEN \\\n  -d\nClient mosqpub/16284-minion1.c sending CONNECT\nClient mosqpub/16284-minion1.c received CONNACK\nClient mosqpub/16284-minion1.c sending PUBLISH (d0, q0, r0, m1, 'message', ... (50 bytes))\nClient mosqpub/16284-minion1.c sending DISCONNECT\n\nRaspberry Pi\u4e0a\u3067subscribe\u3057\u3066\u3044\u308b\u30b7\u30a7\u30eb\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u304d\u307e\u3057\u305f\u3002\n{\"topic\":\"message\",\"data\":{\"devices\":[\"mqtt-pub\"],\"payload\":{\"red\":\"on\"},\"fromUuid\":\"mqtt-pub\"}}\n\n\nHTTP(http-sub) > MQTT(mqtt-pub)\nRaspberry Pi\u4e0a\u3067mqtt-pub\u30c7\u30d0\u30a4\u30b9\u3092auth\u60c5\u5831\u306b\u3057\u3066subscribe\u3057\u307e\u3059\u3002\n$ mosquitto_sub \\\n  -h localhost  \\\n  -p 1883 \\\n  -t $MQTT_PUB_UUID \\\n  -u $MQTT_PUB_UUID \\\n  -P $MQTT_PUB_TOKEN \\\n  -d\n\nOSX\u4e0a\u3067http-sub\u30c7\u30d0\u30a4\u30b9\u3092auth\u306b\u60c5\u5831\u306b\u3057\u3066curl\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3092publish\u3057\u307e\u3059\u3002\n$ curl -X POST \\\n  \"$MESHBLU_URL/messages\" \\\n  --insecure \\\n  -d '{\"devices\": [\"'\"$MQTT_PUB_UUID\"'\"], \"payload\": {\"red\":\"on\"}}' \\\n  --header \"meshblu_auth_uuid: $HTTP_SUB_UUID\" \\\n  --header \"meshblu_auth_token: $HTTP_SUB_TOKEN\"\n{\"devices\":[\"mqtt-pub\"],\"payload\":{\"red\":\"on\"}}\n\nRaspberry Pi\u4e0a\u3067subscribe\u3057\u3066\u3044\u308b\u30b7\u30a7\u30eb\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u304d\u307e\u3057\u305f\u3002\n{\"topic\":\"message\",\"data\":{\"devices\":[\"mqtt-pub\"],\"payload\":{\"red\":\"on\"},\"fromUuid\":\"http-sub\"}}\n\n[Meshblu\u767b\u9332\u3057\u305f\u30c7\u30d0\u30a4\u30b9](http://qiita.com/masato/items/e94314dce770f26d7a86)\u3092\u4f7f\u3044MQTT\u3068HTTP\u9593\u3067\u76f8\u4e92\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u9001\u53d7\u4fe1\u3092\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\u8907\u6570\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u9055\u3044\u3092Meshblu\u306e\u30d6\u30ed\u30fc\u30ab\u30fc\u304c\u5438\u53ce\u3057\u3066\u304f\u308c\u308b\u306e\u3067\u3088\u308a\u591a\u304f\u306e\u30b5\u30fc\u30d3\u30b9\u3084\u30c7\u30d0\u30a4\u30b9\u304c\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u4ea4\u63db\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n## \u74b0\u5883\u5909\u6570\n\n\u30c7\u30d0\u30a4\u30b9\u306e\u767b\u9332\u3068\u5229\u7528\u306b\u4f7f\u3046\u74b0\u5883\u5909\u6570\u3067\u3059\u3002`~/.bashrc`\u306a\u3069\u306b\u66f8\u3044\u3066\u304a\u304d\u307e\u3059\u3002\n\n````bash:~/.bashrc\nexport MESHBLU_BROKER=xxx.xxx.xxx.xxx\nexport MESHBLU_URL=https://$MESHBLU_BROKER\nexport HTTP_SUB_UUID=http-sub\nexport HTTP_SUB_TOKEN=505478\nexport MQTT_PUB_UUID=mqtt-pub\nexport MQTT_PUB_TOKEN=889346\n```\n\n\n## \u30c7\u30d0\u30a4\u30b9\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u53d7\u4fe1\u6a29\u9650\n\n\u30c7\u30d0\u30a4\u30b9\u306eowner\u3068whitelist\u306e\u6a29\u9650\u306f[\u524d\u56de](http://qiita.com/masato/items/e94314dce770f26d7a86)\u8a2d\u5b9a\u3057\u305f\u72b6\u614b\u304b\u3089\u306f\u3058\u3081\u307e\u3059\u3002\u8aac\u660e\u4e0a`http-sub`\u3001`mqtt-pub`\u3068\u3044\u3046UUID\u3092\u4ed8\u3051\u3066\u3044\u307e\u3059\u304c\u3001\u3069\u3061\u3089\u3082\u81ea\u5206\u304c\u30c7\u30d0\u30a4\u30b9\u306e\u30aa\u30fc\u30ca\u30fc\u306a\u306e\u3067\u81ea\u5206\u81ea\u8eab\u306b\u5bfe\u3057\u3066\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u9001\u53d7\u4fe1\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n\n### http-sub\u30c7\u30d0\u30a4\u30b9\n\n`http-sub`\u30c7\u30d0\u30a4\u30b9\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u306b\u3057\u3066\u3044\u307e\u3059\u3002OSX\u4e0a\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u3068\u304d\u306b\u4f7f\u3046\u60f3\u5b9a\u3067\u3059\u3002\n\n* `\"protocol\":\"http\"` -> HTTP\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3067\u304d\u308b\n* `\"sendWhitelist\":\"[mqtt-pub]\"` -> `mqtt-pub`\u30c7\u30d0\u30a4\u30b9\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3067\u304d\u308b\n* \"owner\":\"http-sub\" -> \u81ea\u5206\u304c\u30aa\u30fc\u30ca\u30fc\u306a\u306e\u3067`http-sub`\u30c7\u30d0\u30a4\u30b9\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u53d7\u4fe1\u3067\u304d\u308b\n\n``` bash\n$ curl -X GET \\\n  \"$MESHBLU_URL/devices/$HTTP_SUB_UUID\" \\\n  --insecure \\\n  --header \"meshblu_auth_uuid: $HTTP_SUB_UUID\" \\\n  --header \"meshblu_auth_token: $HTTP_SUB_TOKEN\"\n{\"devices\":[{\"discoverWhitelist\":\"[mqtt-pub]\",\"geo\":null,\"ipAddress\":\"172.17.42.1\",\"name\":\"http-sub\",\"online\":false,\"owner\":\"http-sub\",\"protocol\":\"http\",\"sendWhitelist\":\"[mqtt-pub]\",\"timestamp\":\"2015-03-28T20:02:54.875Z\",\"uuid\":\"http-sub\"}]}\n```\n\n### mqtt-sub\u30c7\u30d0\u30a4\u30b9\n\n`mqtt-pub`\u30c7\u30d0\u30a4\u30b9\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u306b\u3057\u3066\u3044\u307e\u3059\u3002Raspberry Pi\u4e0a\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u3068\u304d\u306b\u4f7f\u3046\u60f3\u5b9a\u3067\u3059\u3002\n\n* `\"protocol\":\"mqtt\"` -> MQTT\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3067\u304d\u308b\n* \"owner\":\"mqtt-pub\" -> \u81ea\u5206\u304c\u30aa\u30fc\u30ca\u30fc\u306a\u306e\u3067`mqtt-pub`\u30c7\u30d0\u30a4\u30b9\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u53d7\u4fe1\u3067\u304d\u308b\n\n``` bash\n$ curl -X GET \\\n  \"$MESHBLU_URL/devices/$MQTT_PUB_UUID\" \\\n  --insecure \\\n  --header \"meshblu_auth_uuid: $MQTT_PUB_UUID\" \\\n  --header \"meshblu_auth_token: $MQTT_PUB_TOKEN\"\n{\"devices\":[{\"discoverWhitelist\":[\"mqtt-pub\"],\"geo\":null,\"ipAddress\":\"172.17.42.1\",\"name\":\"mqtt-pub\",\"online\":true,\"onlineSince\":\"2015-03-28T01:37:48.875Z\",\"owner\":\"mqtt-pub\",\"protocol\":\"mqtt\",\"timestamp\":\"2015-03-28T20:22:25.885Z\",\"uuid\":\"mqtt-pub\"}]}\n```\n\n## \u30c7\u30d0\u30a4\u30b9\u306eUUID/TOKEN\u3092\u4f7f\u3046\u30de\u30b7\u30f3\n\n\u7528\u610f\u3057\u305f2\u3064\u306e\u30c7\u30d0\u30a4\u30b9\u306eUUID/TOKEN\u306f\u305d\u308c\u305e\u308c\u4ee5\u4e0b\u306e\u30de\u30b7\u30f3\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u53d7\u4fe1\u3059\u308b\u3068\u304d\u306b\u4f7f\u3044\u307e\u3059\u3002\n\n* `mqtt-pub`\u30c7\u30d0\u30a4\u30b9\u306eUUID/TOKEN: Raspberry Pi\n* `http-sub`\u30c7\u30d0\u30a4\u30b9\u306eUUID/TOKEN: OSX\n\n\u30c7\u30d0\u30a4\u30b9\u60c5\u5831\u306b\u306f`geo`\u3084`ipAddress`\u306e\u30ad\u30fc\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u4eca\u306e\u3068\u3053\u308d\u7269\u7406\u7684\u306a\u30de\u30b7\u30f3\u306b\u7d50\u3073\u3064\u3044\u3066\u306f\u3044\u306a\u3044\u306e\u3067UUID/TOKEN\u306f\u3069\u306e\u30de\u30b7\u30f3\u304b\u3089\u3082\u5229\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u3002\n\n## MQTT(mqtt-pub) > HTTP(http-sub)\n\nUUID\u3092auth\u306b\u4f7f\u3044\u307e\u3059\u3002`mosquitto_sub`\u3084`mosquitto_pub`\u30b3\u30de\u30f3\u30c9\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u307e\u305f\u306f\u53d7\u4fe1\u3059\u308b\u3068\u3001\u30c7\u30d0\u30a4\u30b9\u60c5\u5831\u306eprotocol\u304cmqtt\u306b\u66f4\u65b0\u3055\u308c\u307e\u3059\u3002\n\nmosquitto_sub\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\n``` bash\n$ mosquitto_sub \\\n  -h $MESHBLU_BROKER  \\\n  -p 1883 \\\n  -t $HTTP_SUB_UUID \\\n  -u $HTTP_SUB_UUID \\\n  -P $HTTP_SUB_TOKEN \\\n  -d\nClient mosqsub/1830-minion1.cs sending CONNECT\nClient mosqsub/1830-minion1.cs received CONNACK\nClient mosqsub/1830-minion1.cs sending SUBSCRIBE (Mid: 1, Topic: http-sub, QoS: 0)\nClient mosqsub/1830-minion1.cs received SUBACK\nSubscribed (mid: 1): 0\n```\n\n\u30c7\u30d0\u30a4\u30b9\u60c5\u5831\u3092\u78ba\u8a8d\u3059\u308b\u3068protocol\u304cmqtt\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\n``` bash\n$ curl -X GET \\\n  \"$MESHBLU_URL/devices/$HTTP_SUB_UUID\" \\\n  --insecure \\\n  --header \"meshblu_auth_uuid: $HTTP_SUB_UUID\" \\\n  --header \"meshblu_auth_token: $HTTP_SUB_TOKEN\"\n{\"devices\":[{\"discoverWhitelist\":\"[mqtt-pub]\",\"geo\":null,\"ipAddress\":\"172.17.42.1\",\"name\":\"http-sub\",\"online\":false,\"owner\":\"http-sub\",\"protocol\":\"mqtt\",\"sendWhitelist\":\"[mqtt-pub]\",\"timestamp\":\"2015-03-28T20:02:54.875Z\",\"uuid\":\"http-sub\"}]}\n```\n\nHTTP\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u5834\u5408\u306fprotocol\u3092http\u306b\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068protocol\u306f\u30c7\u30d0\u30a4\u30b9\u60c5\u5831\u306eJSON\u306b\u542b\u307e\u308c\u3066\u3044\u307e\u305b\u3093\u3002UUID\u3067\u4e00\u5ea6\u3082MQTT\u3092\u4f7f\u308f\u306a\u3051\u308c\u3070protocol\u306e\u66f4\u65b0\u306f\u4e0d\u8981\u3067\u3059\u304c\u5ff5\u306e\u305f\u3081\u884c\u3044\u307e\u3059\u3002\n\n``` bash\n$ curl -X PUT \\\n  \"$MESHBLU_URL/devices/$HTTP_SUB_UUID\" \\\n  --insecure \\\n  -d \"token=$HTTP_SUB_TOKEN&protocol=http\" \\\n  --header \"meshblu_auth_uuid: $HTTP_SUB_UUID\" \\\n  --header \"meshblu_auth_token: $HTTP_SUB_TOKEN\"\n{\"discoverWhitelist\":\"[mqtt-pub]\",\"geo\":null,\"ipAddress\":\"172.17.42.1\",\"name\":\"http-sub\",\"online\":false,\"owner\":\"http-sub\",\"protocol\":\"http\",\"sendWhitelist\":\"[mqtt-pub]\",\"timestamp\":\"2015-03-28T01:26:31.531Z\",\"uuid\":\"http-sub\",\"fromUuid\":\"http-sub\",\"from\":{\"_id\":\"5519eebc6c04bc0a002d59ae\",\"discoverWhitelist\":\"[mqtt-pub]\",\"geo\":null,\"ipAddress\":\"172.17.42.1\",\"name\":\"http-sub\",\"online\":false,\"owner\":\"http-sub\",\"sendWhitelist\":\"[mqtt-pub]\",\"timestamp\":\"2015-03-28T00:58:16.467Z\",\"uuid\":\"http-sub\"}}\n```\n\nOSX\u4e0a\u3067`http-sub`\u30c7\u30d0\u30a4\u30b9\u3092auth\u60c5\u5831\u306b\u3057\u3066curl\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3092subscribe\u3057\u307e\u3059\u3002publish\u3055\u308c\u308b\u524d\u306bsubscribe\u3057\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n``` bash\n$ curl -X GET \\\n  \"$MESHBLU_URL/subscribe\" \\\n  --insecure \\\n  --header \"meshblu_auth_uuid: $HTTP_SUB_UUID\" \\\n  --header \"meshblu_auth_token: $HTTP_SUB_TOKEN\"\n```\n\nRaspberry Pi\u4e0a\u3067`mqtt-pub`\u30c7\u30d0\u30a4\u30b9\u3092auth\u60c5\u5831\u306b\u3057\u3066Mosquitto Clients\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3092publish\u3057\u307e\u3059\u3002\n\n``` bash\n$ mosquitto_pub \\\n  -h $MESHBLU_BROKER  \\\n  -p 1883 \\\n  -t message \\\n  -m '{\"devices\": [\"'\"$HTTP_SUB_UUID\"'\"], \"payload\": {\"red\":\"on\"}}' \\\n  -u $MQTT_PUB_UUID \\\n  -P $MQTT_PUB_TOKEN \\\n  -d\nClient mosqpub/30699-raspberry sending CONNECT\nClient mosqpub/30699-raspberry received CONNACK\nClient mosqpub/30699-raspberry sending PUBLISH (d0, q0, r0, m1, 'message', ... (50 bytes))\nClient mosqpub/30699-raspberry sending DISCONNECT\n```\n\nOSX\u4e0a\u3067subscribe\u3057\u3066\u3044\u308b\u30b7\u30a7\u30eb\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u304d\u307e\u3057\u305f\u3002\n\n``` bash\n{\"devices\":[\"http-sub\"],\"payload\":{\"red\":\"on\"},\"fromUuid\":\"mqtt-pub\"},\n```\n\n## HTTP(http-sub) > HTTP(http-sub)\n\nOSX\u4e0a\u3067`http-sub`\u30c7\u30d0\u30a4\u30b9\u3092auth\u306b\u60c5\u5831\u306b\u3057\u3066curl\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3092subscribe\u3057\u307e\u3059\u3002\n\n``` bash\n$ curl -X GET \\\n  \"$MESHBLU_URL/subscribe\" \\\n  --insecure \\\n  --header \"meshblu_auth_uuid: $HTTP_SUB_UUID\" \\\n  --header \"meshblu_auth_token: $HTTP_SUB_TOKEN\"\n```\n\n`http-sub`\u30c7\u30d0\u30a4\u30b9\u304b\u3089`http-sub`\u30c7\u30d0\u30a4\u30b9\u3078\u306f\u81ea\u5206\u304c\u30aa\u30fc\u30ca\u30fc\u306a\u306e\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3067\u304d\u307e\u3059\u3002\n\n``` bash\n$ curl -X POST \\\n  \"$MESHBLU_URL/messages\" \\\n  --insecure \\\n  -d '{\"devices\": [\"'\"$HTTP_SUB_UUID\"'\"], \"payload\": {\"red\":\"on\"}}' \\\n  --header \"meshblu_auth_uuid: $HTTP_SUB_UUID\" \\\n  --header \"meshblu_auth_token: $HTTP_SUB_TOKEN\"\n{\"devices\":[\"http-sub\"],\"payload\":{\"red\":\"on\"}}\n```\n\nOSX\u4e0a\u3067subscribe\u3057\u3066\u3044\u308b\u30b7\u30a7\u30eb\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u304d\u307e\u3057\u305f\u3002\n\n``` bash\n{\"devices\":[\"http-sub\"],\"payload\":{\"red\":\"on\"},\"fromUuid\":\"http-sub\"},\n```\n\n## MQTT(mqtt-pub) > MQTT(mqtt-pub)\n\nRaspberry Pi\u4e0a\u3067`mqtt-pub`\u30c7\u30d0\u30a4\u30b9\u3092auth\u60c5\u5831\u306b\u3057\u3066subscribe\u3057\u307e\u3059\u3002\n\n``` bash\n$ mosquitto_sub \\\n  -h $MESHBLU_BROKER  \\\n  -p 1883 \\\n  -t $MQTT_PUB_UUID \\\n  -u $MQTT_PUB_UUID \\\n  -P $MQTT_PUB_TOKEN \\\n  -d\nClient mosqsub/26961-raspberry sending CONNECT\nClient mosqsub/26961-raspberry received CONNACK\nClient mosqsub/26961-raspberry sending SUBSCRIBE (Mid: 1, Topic: mqtt-pub, QoS: 0)\nClient mosqsub/26961-raspberry received SUBACK\nSubscribed (mid: 1): 0\n```\n\nOSX\u4e0a\u3067\u540c\u69d8\u306bpublish\u3057\u307e\u3059\u3002\n\n``` bash\n$ mosquitto_pub \\\n  -h $MESHBLU_BROKER  \\\n  -p 1883 \\\n  -t message \\\n  -m '{\"devices\": [\"'\"$MQTT_PUB_UUID\"'\"], \"payload\": {\"red\":\"on\"}}' \\\n  -u $MQTT_PUB_UUID \\\n  -P $MQTT_PUB_TOKEN \\\n  -d\nClient mosqpub/16284-minion1.c sending CONNECT\nClient mosqpub/16284-minion1.c received CONNACK\nClient mosqpub/16284-minion1.c sending PUBLISH (d0, q0, r0, m1, 'message', ... (50 bytes))\nClient mosqpub/16284-minion1.c sending DISCONNECT\n```\n\nRaspberry Pi\u4e0a\u3067subscribe\u3057\u3066\u3044\u308b\u30b7\u30a7\u30eb\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u304d\u307e\u3057\u305f\u3002\n\n``` bash\n{\"topic\":\"message\",\"data\":{\"devices\":[\"mqtt-pub\"],\"payload\":{\"red\":\"on\"},\"fromUuid\":\"mqtt-pub\"}}\n```\n\n## HTTP(http-sub) > MQTT(mqtt-pub)\n\nRaspberry Pi\u4e0a\u3067`mqtt-pub`\u30c7\u30d0\u30a4\u30b9\u3092auth\u60c5\u5831\u306b\u3057\u3066subscribe\u3057\u307e\u3059\u3002\n\n``` bash\n$ mosquitto_sub \\\n  -h localhost  \\\n  -p 1883 \\\n  -t $MQTT_PUB_UUID \\\n  -u $MQTT_PUB_UUID \\\n  -P $MQTT_PUB_TOKEN \\\n  -d\n```\n\nOSX\u4e0a\u3067`http-sub`\u30c7\u30d0\u30a4\u30b9\u3092auth\u306b\u60c5\u5831\u306b\u3057\u3066curl\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3092publish\u3057\u307e\u3059\u3002\n\n``` bash\n$ curl -X POST \\\n  \"$MESHBLU_URL/messages\" \\\n  --insecure \\\n  -d '{\"devices\": [\"'\"$MQTT_PUB_UUID\"'\"], \"payload\": {\"red\":\"on\"}}' \\\n  --header \"meshblu_auth_uuid: $HTTP_SUB_UUID\" \\\n  --header \"meshblu_auth_token: $HTTP_SUB_TOKEN\"\n{\"devices\":[\"mqtt-pub\"],\"payload\":{\"red\":\"on\"}}\n```\n\nRaspberry Pi\u4e0a\u3067subscribe\u3057\u3066\u3044\u308b\u30b7\u30a7\u30eb\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u304d\u307e\u3057\u305f\u3002\n\n``` bash\n{\"topic\":\"message\",\"data\":{\"devices\":[\"mqtt-pub\"],\"payload\":{\"red\":\"on\"},\"fromUuid\":\"http-sub\"}}\n```\n", "tags": ["Meshblu1.1.1", "mqtt3.1.1", "RaspberryPiModelB", "mosquitto1.3.5"]}