{"context": "<\u7de8\u96c6 2016/12/15 10:21>\n\u6628\u591c\u6295\u7a3f\u3057\u305f\u5206\u3067\u3059\u304c\u3001\u3042\u3044\u3066\u305f\u306e\u3067\u3002\u3002\u3002\nCakePHP3 Advent Calendar 15\u65e5\u76ee\u3067\u3059\u3002\n<\u7de8\u96c6\u7d42\u308f\u308a>\n\n\u5c0f\u30cd\u30bf\u3067\u3059\nCakePHP3 \u3067\u3001\u6570\u5024\u306b\u81ea\u7136\u6570\u3068\u3044\u3046Validation \u3092\u304b\u3051\u305f\u304b\u3063\u305f\u3051\u3069\u3001\u3061\u3087\u3063\u3068\u30cf\u30de\u3063\u305f\u3002\n\u3064\u3044\u3067\u306b\u3001Validation\u304c\u3001\u5185\u90e8\u3067\u3069\u3093\u306a\u3053\u3068\u3092\u3084\u3063\u3066\u308b\u304b\u898b\u305f\u3053\u3068\u304c\u306a\u304b\u3063\u305f\u306e\u3067\u898b\u3066\u307f\u305f\u3002\n\n\u81ea\u7136\u6570\u306eValidation\n$validator\n    ->integer('hoge')\n    ->requirePresence('hoge', 'create')\n    ->notEmpty('hoge')\n    ->naturalNumber('hoge', __('[FATAL] not a natural number.'));\n\n\u3053\u308c\u3060\u3051\u3067\u3001\u81ea\u7136\u6570\u306eValidation \u306f\u3067\u304d\u308b\u3002\n\u3064\u307e\u308a\u3001hoge \u304c\u3001 0 \u4ee5\u5916\u3060\u3063\u305f\u3089 false \u306b\u306a\u308b\u3002\n\u3053\u308c\u306f\u7c21\u5358\u3060\u3002\n\u305f\u3060\u3001\u3053\u308c\u3092\u63a2\u3057\u3066\u3044\u305f\u6642\u306b\u898b\u305f\u3001\nhttp://api.cakephp.org/3.1/class-Cake.Validation.Validation.html#_naturalNumber\n\u306b\u3001\nboolean $allowZero optional false\nSet true to allow zero, defaults to false\n\n\u3068\u66f8\u3044\u3066\u3042\u3063\u305f\u3002\n\u76db\u5927\u306b\u610f\u8a33\u3059\u308b\u3068\u3001\u81ea\u7136\u6570\u3060\u3051\u3067\u306a\u304f\u3001\u81ea\u7136\u6570\u30680 \u3068\u3044\u3046Validation \u3092\u304b\u3051\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u3068\u66f8\u3044\u3066\u3042\u308b\u3002\n\u306a\u308b\u307b\u3069\u3002\n\u305d\u308c\u306f\u9762\u767d\u3044\u3002\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u3084\u3063\u3066\u307f\u305f\u3002\n\nFirst Try\n$validator\n    ->integer('hoge')\n    ->requirePresence('hoge', 'create')\n    ->notEmpty('hoge')\n    ->naturalNumber('hoge', true,  __('[FATAL] not a natural number.'));\n\n\n\u3060\u304c\u3001\u3046\u307e\u304f\u52d5\u304b\u306a\u3044\u3002\n\u305d\u308c\u3069\u3053\u308d\u304b\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u3082\u8868\u793a\u3055\u308c\u306a\u3044\u3002\n\u56f0\u3063\u305f\u3002\n\nSecond Try\n$validator\n    ->integer('hoge')\n    ->requirePresence('hoge', 'create')\n    ->notEmpty('hoge')\n    ->naturalNumber('hoge', [true],  __('[FATAL] not a natural number.'));\n\n\n\u306a\u3093\u3068\u306a\u304f\u3001\u914d\u5217\u306b\u3057\u3066\u307f\u305f\u3002\n\u7d50\u679c\u306f\u4f55\u3082\u5909\u308f\u3089\u306a\u3044\u3002\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u304b\u3089\u4e2d\u8eab\u3092\u898b\u3066\u307f\u305f\u3002\n\u898b\u305f\u306e\u306f\u3001\nhttp://api.cakephp.org/3.1/class-Cake.Validation.Validation.html#_naturalNumber\n\u306b\u3042\u308b\u3088\u3046\u306b\u3001Cake\\Validation\\Validation\u306e\u4e2d\u3002\n(\u30ea\u30f3\u30af\u306f\u3001Cake\\Validation\\Validation \u306eAPI\u306b\u3064\u3044\u3066\u66f8\u304b\u308c\u3066\u3044\u308b)\n\u305d\u3057\u3066\u3001\u305d\u306e\u4e2d\u306b\u3001\u30eb\u30fc\u30eb\u304c\u66f8\u3044\u3066\u3042\u3063\u305f\u3002\npublic static function naturalNumber($check, $allowZero = false)\n{\n    $regex = $allowZero ? '/^(?:0|[1-9][0-9]*)$/' : '/^[1-9][0-9]*$/';\n\n    return static::_check($check, $regex);\n}\n\n\n\u306a\u3093\u304b\u3001\u3061\u3083\u3093\u3068\u66f8\u304b\u308c\u3066\u308b\u3063\u307d\u3044\u3002\n\u306a\u3093\u3067\u52d5\u304b\u306a\u3044\u3093\u3060\u308d\u3046\uff1f\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u5ff5\u306e\u305f\u3081 First Try \u306e\u5f62\u306b\u623b\u3057\u3066 debug \u3057\u3066\u307f\u305f\u3002\n$validator\n    ->integer('hoge')\n    ->requirePresence('hoge', 'create')\n    ->notEmpty('hoge')\n    ->naturalNumber('hoge', [true],  __('[FATAL] not a natural number.'));\n\n\npublic static function naturalNumber($check, $allowZero = false)\n{\n    debug($check);\n    debug($allowZero);\n    exit;\n    $regex = $allowZero ? '/^(?:0|[1-9][0-9]*)$/' : '/^[1-9][0-9]*$/';\n\n    return static::_check($check, $regex);\n}\n\n\u7d50\u679c\n1\nfalse\n\n\u3093\uff1f __('[FATAL] not a natural number.') \u3059\u3089\u6765\u3066\u306a\u3044\u3002\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u4e00\u5ea6\u51b7\u9759\u306b\u306a\u3063\u3066\u8003\u3048\u3066\u307f\u305f\u3002\n\u306a\u3093\u3067\u3060\u308d\u3046\uff1f\n\u305d\u3057\u3066\u3001\u30d2\u30f3\u30c8\u306fBake \u3067\u51fa\u3066\u304f\u308b\u30b3\u30e1\u30f3\u30c8\u306b\u66f8\u3044\u3066\u3042\u3063\u305f\u3002\npublic function validationDefault(Validator $validator)\n\n\u3053\u308c\u3001\u898b\u308b\u3068\u3053\u308d\u9055\u3063\u305f\u3093\u3058\u3083\u306a\u3044\uff1f\nValidator \u3068 \u66f8\u3044\u3066\u3042\u308b\u3067\u306f\u306a\u3044\u304b\u3002\n\u3055\u3063\u304d\u307e\u3067\u898b\u3066\u3044\u305f\u306e\u306fValidation\u3002\n\u305d\u3082\u305d\u3082\u30e1\u30bd\u30c3\u30c9\u30c1\u30a7\u30fc\u30f3\u304c\u3067\u304d\u308b\u306e\u306f\u3001$validator \u304c Validator \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3060\u304b\u3089\u306e\u306f\u305a\u3002\n\u3053\u308c\u306f\u3001\u4f55\u304b\u30d2\u30f3\u30c8\u304c\u3042\u308b\u306b\u9055\u3044\u306a\u3044\uff01\uff01\uff01\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u5834\u6240\u3092\u5909\u66f4\u3057\u3066Cake\\Validation\\Validator \u3092\u898b\u305f\u3002\n\u3059\u308b\u3068\u3001\u66f8\u3044\u3066\u3042\u308b\u3067\u306f\u306a\u3044\u304b\uff01\uff01\uff01\npublic function naturalNumber($field, $message = null, $when = null)\n{\n    $extra = array_filter(['on' => $when, 'message' => $message]);\n\n    return $this->add($field, 'naturalNumber', $extra + [\n        'rule' => ['naturalNumber', false]\n    ]);\n}\n\n\u3042\u308c\uff1f\n\u3053\u308c\u3001\u30e9\u30c3\u30d1\u30fc\u3057\u3066\u308b\u3060\u3051\u307f\u305f\u3044\u3002\n\u3057\u304b\u3082\u3001\n->naturalNumber('hoge')\n\n\u306e\u5f62\u3060\u3068\u3001$allowZero\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u5f37\u5236\u7684\u306b false \u306b\u306a\u308b\u307f\u305f\u3044\u3002\u3002\u3002\n\u3064\u307e\u308a\u3001\u305d\u3082\u305d\u3082\u4eca\u307e\u3067\u3084\u3063\u3066\u305f\u3084\u308a\u65b9\u3067\u306f\u5b9f\u73fe\u3067\u304d\u306a\u304b\u3063\u305f\u3089\u3057\u3044\u3002\n\u3068\u3044\u3046\u3053\u3068\u3067\u6b63\u89e3\u306f\u3001\n->add('hoge', 'naturalNumber',\n [\n     'rule' => ['naturalNumber', true],\n     'message' => '\u81ea\u7136\u6570\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044'\n]);\n\n\u3067\u3057\u305f\u3002\n\u305d\u308c\u306b\u3057\u3066\u3082\u3001Validator \u304c\u4e2d\u3067 return $this->add()\u3057\u3066\u308b\u3068\u306f\u601d\u3063\u3066\u306a\u304b\u3063\u305f\u3002\n\u9762\u767d\u304b\u3063\u305f\u3002\n\u4ee5\u4e0a\u3001\u5c0f\u30cd\u30bf\u3067\u3057\u305f\u3002\n\n<\u7de8\u96c6 2016/12/15 10:21>\n<del>\u6628\u591c\u6295\u7a3f\u3057\u305f\u5206\u3067\u3059\u304c\u3001\u3042\u3044\u3066\u305f\u306e\u3067\u3002\u3002\u3002</del>\nCakePHP3 Advent Calendar 15\u65e5\u76ee\u3067\u3059\u3002\n<\u7de8\u96c6\u7d42\u308f\u308a>\n\n# \u5c0f\u30cd\u30bf\u3067\u3059\n\nCakePHP3 \u3067\u3001\u6570\u5024\u306b\u81ea\u7136\u6570\u3068\u3044\u3046Validation \u3092\u304b\u3051\u305f\u304b\u3063\u305f\u3051\u3069\u3001\u3061\u3087\u3063\u3068\u30cf\u30de\u3063\u305f\u3002\n\u3064\u3044\u3067\u306b\u3001Validation\u304c\u3001\u5185\u90e8\u3067\u3069\u3093\u306a\u3053\u3068\u3092\u3084\u3063\u3066\u308b\u304b\u898b\u305f\u3053\u3068\u304c\u306a\u304b\u3063\u305f\u306e\u3067\u898b\u3066\u307f\u305f\u3002\n\n## \u81ea\u7136\u6570\u306eValidation\n\n```php\n$validator\n    ->integer('hoge')\n    ->requirePresence('hoge', 'create')\n    ->notEmpty('hoge')\n    ->naturalNumber('hoge', __('[FATAL] not a natural number.'));\n```\n\n\u3053\u308c\u3060\u3051\u3067\u3001\u81ea\u7136\u6570\u306eValidation \u306f\u3067\u304d\u308b\u3002\n\u3064\u307e\u308a\u3001`hoge` \u304c\u3001 `0` \u4ee5\u5916\u3060\u3063\u305f\u3089 `false` \u306b\u306a\u308b\u3002\n\n\u3053\u308c\u306f\u7c21\u5358\u3060\u3002\n\u305f\u3060\u3001\u3053\u308c\u3092\u63a2\u3057\u3066\u3044\u305f\u6642\u306b\u898b\u305f\u3001\nhttp://api.cakephp.org/3.1/class-Cake.Validation.Validation.html#_naturalNumber\n\u306b\u3001\n\n```\nboolean $allowZero optional false\nSet true to allow zero, defaults to false\n```\n\u3068\u66f8\u3044\u3066\u3042\u3063\u305f\u3002\n\n\u76db\u5927\u306b\u610f\u8a33\u3059\u308b\u3068\u3001`\u81ea\u7136\u6570`\u3060\u3051\u3067\u306a\u304f\u3001`\u81ea\u7136\u6570\u30680` \u3068\u3044\u3046Validation \u3092\u304b\u3051\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u3068\u66f8\u3044\u3066\u3042\u308b\u3002\n\n\u306a\u308b\u307b\u3069\u3002\n\u305d\u308c\u306f\u9762\u767d\u3044\u3002\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u3084\u3063\u3066\u307f\u305f\u3002\n\n## First Try\n\n```php\n$validator\n    ->integer('hoge')\n    ->requirePresence('hoge', 'create')\n    ->notEmpty('hoge')\n    ->naturalNumber('hoge', true,  __('[FATAL] not a natural number.'));\n\n```\n\n\u3060\u304c\u3001\u3046\u307e\u304f\u52d5\u304b\u306a\u3044\u3002\n\u305d\u308c\u3069\u3053\u308d\u304b\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u3082\u8868\u793a\u3055\u308c\u306a\u3044\u3002\n\n\u56f0\u3063\u305f\u3002\n\n## Second Try\n\n```php\n$validator\n    ->integer('hoge')\n    ->requirePresence('hoge', 'create')\n    ->notEmpty('hoge')\n    ->naturalNumber('hoge', [true],  __('[FATAL] not a natural number.'));\n\n```\n\u306a\u3093\u3068\u306a\u304f\u3001\u914d\u5217\u306b\u3057\u3066\u307f\u305f\u3002\n\u7d50\u679c\u306f\u4f55\u3082\u5909\u308f\u3089\u306a\u3044\u3002\n\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u304b\u3089\u4e2d\u8eab\u3092\u898b\u3066\u307f\u305f\u3002\n\u898b\u305f\u306e\u306f\u3001\nhttp://api.cakephp.org/3.1/class-Cake.Validation.Validation.html#_naturalNumber\n\n\u306b\u3042\u308b\u3088\u3046\u306b\u3001`Cake\\Validation\\Validation`\u306e\u4e2d\u3002\n(\u30ea\u30f3\u30af\u306f\u3001`Cake\\Validation\\Validation` \u306eAPI\u306b\u3064\u3044\u3066\u66f8\u304b\u308c\u3066\u3044\u308b)\n\n\u305d\u3057\u3066\u3001\u305d\u306e\u4e2d\u306b\u3001\u30eb\u30fc\u30eb\u304c\u66f8\u3044\u3066\u3042\u3063\u305f\u3002\n\n```php\npublic static function naturalNumber($check, $allowZero = false)\n{\n    $regex = $allowZero ? '/^(?:0|[1-9][0-9]*)$/' : '/^[1-9][0-9]*$/';\n\n    return static::_check($check, $regex);\n}\n\n```\n\n\u306a\u3093\u304b\u3001\u3061\u3083\u3093\u3068\u66f8\u304b\u308c\u3066\u308b\u3063\u307d\u3044\u3002\n\u306a\u3093\u3067\u52d5\u304b\u306a\u3044\u3093\u3060\u308d\u3046\uff1f\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u5ff5\u306e\u305f\u3081 First Try \u306e\u5f62\u306b\u623b\u3057\u3066 debug \u3057\u3066\u307f\u305f\u3002\n\n```php\n$validator\n    ->integer('hoge')\n    ->requirePresence('hoge', 'create')\n    ->notEmpty('hoge')\n    ->naturalNumber('hoge', [true],  __('[FATAL] not a natural number.'));\n\n```\n\n```php\npublic static function naturalNumber($check, $allowZero = false)\n{\n    debug($check);\n    debug($allowZero);\n    exit;\n    $regex = $allowZero ? '/^(?:0|[1-9][0-9]*)$/' : '/^[1-9][0-9]*$/';\n\n    return static::_check($check, $regex);\n}\n```\n\u7d50\u679c\n\n```\n1\nfalse\n```\n\n\u3093\uff1f `__('[FATAL] not a natural number.')` \u3059\u3089\u6765\u3066\u306a\u3044\u3002\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u4e00\u5ea6\u51b7\u9759\u306b\u306a\u3063\u3066\u8003\u3048\u3066\u307f\u305f\u3002\n\u306a\u3093\u3067\u3060\u308d\u3046\uff1f\n\n\u305d\u3057\u3066\u3001\u30d2\u30f3\u30c8\u306fBake \u3067\u51fa\u3066\u304f\u308b\u30b3\u30e1\u30f3\u30c8\u306b\u66f8\u3044\u3066\u3042\u3063\u305f\u3002\n\n```php\npublic function validationDefault(Validator $validator)\n```\n\u3053\u308c\u3001\u898b\u308b\u3068\u3053\u308d\u9055\u3063\u305f\u3093\u3058\u3083\u306a\u3044\uff1f\n`Validator` \u3068 \u66f8\u3044\u3066\u3042\u308b\u3067\u306f\u306a\u3044\u304b\u3002\n\u3055\u3063\u304d\u307e\u3067\u898b\u3066\u3044\u305f\u306e\u306f`Validation`\u3002\n\u305d\u3082\u305d\u3082\u30e1\u30bd\u30c3\u30c9\u30c1\u30a7\u30fc\u30f3\u304c\u3067\u304d\u308b\u306e\u306f\u3001`$validator` \u304c `Validator` \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3060\u304b\u3089\u306e\u306f\u305a\u3002\n\u3053\u308c\u306f\u3001\u4f55\u304b\u30d2\u30f3\u30c8\u304c\u3042\u308b\u306b\u9055\u3044\u306a\u3044\uff01\uff01\uff01\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u5834\u6240\u3092\u5909\u66f4\u3057\u3066`Cake\\Validation\\Validator` \u3092\u898b\u305f\u3002\n\u3059\u308b\u3068\u3001\u66f8\u3044\u3066\u3042\u308b\u3067\u306f\u306a\u3044\u304b\uff01\uff01\uff01\n\n```php\npublic function naturalNumber($field, $message = null, $when = null)\n{\n    $extra = array_filter(['on' => $when, 'message' => $message]);\n\n    return $this->add($field, 'naturalNumber', $extra + [\n        'rule' => ['naturalNumber', false]\n    ]);\n}\n```\n\n\u3042\u308c\uff1f\n\u3053\u308c\u3001\u30e9\u30c3\u30d1\u30fc\u3057\u3066\u308b\u3060\u3051\u307f\u305f\u3044\u3002\n\u3057\u304b\u3082\u3001\n\n```php\n->naturalNumber('hoge')\n```\n\u306e\u5f62\u3060\u3068\u3001`$allowZero`\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u5f37\u5236\u7684\u306b `false` \u306b\u306a\u308b\u307f\u305f\u3044\u3002\u3002\u3002\n\n\u3064\u307e\u308a\u3001\u305d\u3082\u305d\u3082\u4eca\u307e\u3067\u3084\u3063\u3066\u305f\u3084\u308a\u65b9\u3067\u306f\u5b9f\u73fe\u3067\u304d\u306a\u304b\u3063\u305f\u3089\u3057\u3044\u3002\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u6b63\u89e3\u306f\u3001\n\n```php\n->add('hoge', 'naturalNumber',\n [\n     'rule' => ['naturalNumber', true],\n     'message' => '\u81ea\u7136\u6570\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044'\n]);\n```\n\n\u3067\u3057\u305f\u3002\n\n\u305d\u308c\u306b\u3057\u3066\u3082\u3001`Validator` \u304c\u4e2d\u3067 `return $this->add()`\u3057\u3066\u308b\u3068\u306f\u601d\u3063\u3066\u306a\u304b\u3063\u305f\u3002\n\u9762\u767d\u304b\u3063\u305f\u3002\n\n\u4ee5\u4e0a\u3001\u5c0f\u30cd\u30bf\u3067\u3057\u305f\u3002\n\n\n\n\n\n\n\n\n\n\n\n", "tags": ["cakephp3", "Validation", "PHP"]}