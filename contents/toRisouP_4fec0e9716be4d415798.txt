{"context": "UniRx\u306b\u3064\u3044\u3066\u306e\u8a18\u4e8b\u306e\u307e\u3068\u3081\u306f\u3053\u3061\u3089\n\nUniRx\u3092\u4f7f\u3063\u3066\u30de\u30a6\u30b9\u306e\u9577\u62bc\u3057\u5224\u5b9a\u3092\u884c\u3046\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u9577\u62bc\u3057\u5224\u5b9a\uff08\u4e00\u5b9a\u6642\u9593\u4ee5\u4e0a\u30de\u30a6\u30b9\u304c\u30af\u30ea\u30c3\u30af\u3055\u308c\u7d9a\u3051\u305f\u6642\uff09\n\u9577\u62bc\u3057\u30ad\u30e3\u30f3\u30bb\u30eb\uff08\u4e00\u5b9a\u6642\u9593\u4ee5\u5185\u306b\u30de\u30a6\u30b9\u30af\u30ea\u30c3\u30af\u304c\u4e2d\u65ad\u3055\u308c\u305f\u6642\uff09\n\n\u3092\u305d\u308c\u305e\u308c\u691c\u51fa\u3067\u304d\u308b\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u3001\u30aa\u30da\u30ec\u30fc\u30bf\u30c1\u30a7\u30fc\u30f3\u306e\u307f\u3067\u66f8\u304f\u30d1\u30bf\u30fc\u30f3\u3068\u30b3\u30eb\u30fc\u30c1\u30f3\u3068\u7d44\u307f\u5408\u308f\u305b\u308b\u30d1\u30bf\u30fc\u30f3\u3067\uff12\u7a2e\u985e\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u30aa\u30da\u30ec\u30fc\u30bf\u30c1\u30a7\u30fc\u30f3\u306e\u307f\u3067\u66f8\u304f\u5834\u5408\n\n\u30aa\u30da\u30ec\u30fc\u30bf\u30c1\u30a7\u30fc\u30f3\u306e\u307f\nvoid Start()\n{\n    var mouseDownStream = this.UpdateAsObservable().Where(_ => Input.GetMouseButtonDown(0));\n    var mouseUpStream = this.UpdateAsObservable().Where(_ => Input.GetMouseButtonUp(0));\n\n    //\u9577\u62bc\u3057\u306e\u5224\u5b9a\n    mouseDownStream\n        //\u30de\u30a6\u30b9\u30af\u30ea\u30c3\u30af\u3055\u308c\u305f\u30893\u79d2\u5f8c\u306bOnNext\u3092\u6d41\u3059\n        .SelectMany(_ => Observable.Timer(TimeSpan.FromSeconds(3)))\n        //\u9014\u4e2d\u3067MouseUp\u3055\u308c\u305f\u3089\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u30ea\u30bb\u30c3\u30c8\n        .TakeUntil(mouseUpStream)\n        .RepeatUntilDestroy(this.gameObject)\n        .Subscribe(_ => Debug.Log(\"\u9577\u62bc\u3057\"));\n\n    //\u9577\u62bc\u3057\u306e\u30ad\u30e3\u30f3\u30bb\u30eb\u5224\u5b9a\n    mouseDownStream.Timestamp()\n        .Zip(mouseUpStream.Timestamp(), (d, u) => (u.Timestamp - d.Timestamp).TotalMilliseconds / 1000.0f)\n        .Where(time => time < 3.0f)\n        .Subscribe(t => Debug.Log(t + \"\u79d2\u3067\u30ad\u30e3\u30f3\u30bb\u30eb\"));\n}\n\n\n\u3061\u3087\u3063\u3068\u30b4\u30ea\u62bc\u3057\u3067\u3059\u3051\u3069\u4e00\u5fdc\u52d5\u4f5c\u3057\u307e\u3059\u3002\n\n\u30b3\u30eb\u30fc\u30c1\u30f3\u3068\u7d44\u307f\u5408\u308f\u305b\u308b\u5834\u5408\n\n\u30b3\u30eb\u30fc\u30c1\u30f3\u3068\u5408\u308f\u305b\u308b\npublic class LongClick : MonoBehaviour\n{\n\n    #region \u9577\u62bc\u3057\u30b9\u30c8\u30ea\u30fc\u30e0\n    Subject<Unit> longClickSubject = new Subject<Unit>();\n\n    IObservable<Unit> LongClickAsObservable\n    {\n        get\n        {\n            return longClickSubject;\n        }\n    }\n    #endregion \n\n    #region \u9577\u62bc\u3057\u30ad\u30e3\u30f3\u30bb\u30eb\u30b9\u30c8\u30ea\u30fc\u30e0\n    Subject<float> longClickCancelSubject = new Subject<float>();\n\n    IObservable<float> LongClickCancelAsObservable\n    {\n        get\n        {\n            return longClickCancelSubject;\n        }\n    }\n\n    #endregion\n\n    Coroutine longClickCoroutine;\n\n    void Start()\n    {\n        longClickCoroutine = StartCoroutine(LongClickCoroutine(3.0f, longClickSubject, longClickCancelSubject));\n\n        LongClickAsObservable.Subscribe(_ => Debug.Log(\"\u9577\u62bc\u3057\"));\n        LongClickCancelAsObservable.Subscribe(t => Debug.Log(t + \"\u79d2\u3067\u30ad\u30e3\u30f3\u30bb\u30eb\"));\n\n    }\n\n    /// <summary>\n    /// \u9577\u62bc\u3057\u5224\u5b9a\u30b3\u30eb\u30fc\u30c1\u30f3\n    /// </summary>\n    IEnumerator LongClickCoroutine(float threshold, IObserver<Unit> longClickObserver, IObserver<float> longClickCancelObserver)\n    {\n        var isLongClicked = false; //\u9577\u62bc\u3057\u306eOnNext\u767a\u884c\u6e08\u304b\n        var count = 0.0f;\n\n        while (true)\n        {\n            if (Input.GetMouseButton(0))\n            {\n                count += Time.deltaTime;\n                if (!isLongClicked && count > threshold)\n                {\n                    isLongClicked = true;\n                    longClickObserver.OnNext(Unit.Default);\n                }\n            }\n            else if (Input.GetMouseButtonUp(0))\n            {\n                isLongClicked = false;\n                if (count > 0)\n                {\n                    longClickCancelObserver.OnNext(count);\n                    count = 0;\n                }\n            }\n            yield return null;\n\n        }\n    }\n\n\n    void OnDestroy()\n    {\n        if (longClickCoroutine != null)\n            StopCoroutine(longClickCoroutine);\n    }\n}\n\n\n\u5224\u5b9a\u51e6\u7406\u3092\u7121\u9650\u30eb\u30fc\u30d7\u3059\u308b\u30b3\u30eb\u30fc\u30c1\u30f3\u306e\u4e2d\u306b\u66f8\u304d\u3001\u7d50\u679c\u3092\u30b9\u30c8\u30ea\u30fc\u30e0\u3067\u5916\u90e8\u306b\u901a\u77e5\u3059\u308b\u5f62\u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u30aa\u30da\u30ec\u30fc\u30bf\u30c1\u30a7\u30fc\u30f3\u306e\u9023\u7d50\u3067\u308f\u3051\u306e\u308f\u304b\u3089\u306a\u3044\u30b9\u30c8\u30ea\u30fc\u30e0\u306b\u306a\u308b\u304f\u3089\u3044\u306a\u3089\u3001\u8ae6\u3081\u3066\u624b\u7d9a\u304d\u7684\u306b\u66f8\u3044\u305f\u65b9\u304c\u65e9\u3044\u5834\u5408\u3082\u3042\u308a\u307e\u3059\u3002\u96d1\u591a\u306a\u51e6\u7406\u306f\u5168\u90e8\u30b3\u30eb\u30fc\u30c1\u30f3\u306b\u62bc\u3057\u8fbc\u307e\u308c\u3066\u3044\u3066\u5916\u306b\u51fa\u3066\u3053\u306a\u3044\u306e\u3067\u307e\u3041\u8a31\u5bb9\u7bc4\u56f2\u304b\u306a\u3041\u3068\u3002\n\u307e\u305f\u3053\u3046\u3044\u3063\u305f\u6c4e\u7528\u7684\u306b\u4f7f\u3044\u305d\u3046\u306a\u51e6\u7406\u306fObservableTrigger\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u3066\u304a\u304f\u3068\u826f\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3067\u3059\u306d\u3002\n\n**UniRx\u306b\u3064\u3044\u3066\u306e\u8a18\u4e8b\u306e\u307e\u3068\u3081\u306f[\u3053\u3061\u3089](http://qiita.com/toRisouP/items/48b9fa25df64d3c6a392)**\n\n---\n\nUniRx\u3092\u4f7f\u3063\u3066\u30de\u30a6\u30b9\u306e\u9577\u62bc\u3057\u5224\u5b9a\u3092\u884c\u3046\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002\n\n* \u9577\u62bc\u3057\u5224\u5b9a\uff08\u4e00\u5b9a\u6642\u9593\u4ee5\u4e0a\u30de\u30a6\u30b9\u304c\u30af\u30ea\u30c3\u30af\u3055\u308c\u7d9a\u3051\u305f\u6642\uff09\n* \u9577\u62bc\u3057\u30ad\u30e3\u30f3\u30bb\u30eb\uff08\u4e00\u5b9a\u6642\u9593\u4ee5\u5185\u306b\u30de\u30a6\u30b9\u30af\u30ea\u30c3\u30af\u304c\u4e2d\u65ad\u3055\u308c\u305f\u6642\uff09\n\n\u3092\u305d\u308c\u305e\u308c\u691c\u51fa\u3067\u304d\u308b\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u3001**\u30aa\u30da\u30ec\u30fc\u30bf\u30c1\u30a7\u30fc\u30f3\u306e\u307f**\u3067\u66f8\u304f\u30d1\u30bf\u30fc\u30f3\u3068**\u30b3\u30eb\u30fc\u30c1\u30f3\u3068\u7d44\u307f\u5408\u308f\u305b\u308b**\u30d1\u30bf\u30fc\u30f3\u3067\uff12\u7a2e\u985e\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002\n\n\n#\u30aa\u30da\u30ec\u30fc\u30bf\u30c1\u30a7\u30fc\u30f3\u306e\u307f\u3067\u66f8\u304f\u5834\u5408\n\n```csharp:\u30aa\u30da\u30ec\u30fc\u30bf\u30c1\u30a7\u30fc\u30f3\u306e\u307f\nvoid Start()\n{\n    var mouseDownStream = this.UpdateAsObservable().Where(_ => Input.GetMouseButtonDown(0));\n    var mouseUpStream = this.UpdateAsObservable().Where(_ => Input.GetMouseButtonUp(0));\n\n    //\u9577\u62bc\u3057\u306e\u5224\u5b9a\n    mouseDownStream\n        //\u30de\u30a6\u30b9\u30af\u30ea\u30c3\u30af\u3055\u308c\u305f\u30893\u79d2\u5f8c\u306bOnNext\u3092\u6d41\u3059\n        .SelectMany(_ => Observable.Timer(TimeSpan.FromSeconds(3)))\n        //\u9014\u4e2d\u3067MouseUp\u3055\u308c\u305f\u3089\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u30ea\u30bb\u30c3\u30c8\n        .TakeUntil(mouseUpStream)\n        .RepeatUntilDestroy(this.gameObject)\n        .Subscribe(_ => Debug.Log(\"\u9577\u62bc\u3057\"));\n\n    //\u9577\u62bc\u3057\u306e\u30ad\u30e3\u30f3\u30bb\u30eb\u5224\u5b9a\n    mouseDownStream.Timestamp()\n        .Zip(mouseUpStream.Timestamp(), (d, u) => (u.Timestamp - d.Timestamp).TotalMilliseconds / 1000.0f)\n        .Where(time => time < 3.0f)\n        .Subscribe(t => Debug.Log(t + \"\u79d2\u3067\u30ad\u30e3\u30f3\u30bb\u30eb\"));\n}\n```\n\n\u3061\u3087\u3063\u3068\u30b4\u30ea\u62bc\u3057\u3067\u3059\u3051\u3069\u4e00\u5fdc\u52d5\u4f5c\u3057\u307e\u3059\u3002\n\n#\u30b3\u30eb\u30fc\u30c1\u30f3\u3068\u7d44\u307f\u5408\u308f\u305b\u308b\u5834\u5408\n\n```csharp:\u30b3\u30eb\u30fc\u30c1\u30f3\u3068\u5408\u308f\u305b\u308b\npublic class LongClick : MonoBehaviour\n{\n\n    #region \u9577\u62bc\u3057\u30b9\u30c8\u30ea\u30fc\u30e0\n    Subject<Unit> longClickSubject = new Subject<Unit>();\n\n    IObservable<Unit> LongClickAsObservable\n    {\n        get\n        {\n            return longClickSubject;\n        }\n    }\n    #endregion \n\n    #region \u9577\u62bc\u3057\u30ad\u30e3\u30f3\u30bb\u30eb\u30b9\u30c8\u30ea\u30fc\u30e0\n    Subject<float> longClickCancelSubject = new Subject<float>();\n\n    IObservable<float> LongClickCancelAsObservable\n    {\n        get\n        {\n            return longClickCancelSubject;\n        }\n    }\n\n    #endregion\n\n    Coroutine longClickCoroutine;\n\n    void Start()\n    {\n        longClickCoroutine = StartCoroutine(LongClickCoroutine(3.0f, longClickSubject, longClickCancelSubject));\n\n        LongClickAsObservable.Subscribe(_ => Debug.Log(\"\u9577\u62bc\u3057\"));\n        LongClickCancelAsObservable.Subscribe(t => Debug.Log(t + \"\u79d2\u3067\u30ad\u30e3\u30f3\u30bb\u30eb\"));\n\n    }\n\n    /// <summary>\n    /// \u9577\u62bc\u3057\u5224\u5b9a\u30b3\u30eb\u30fc\u30c1\u30f3\n    /// </summary>\n    IEnumerator LongClickCoroutine(float threshold, IObserver<Unit> longClickObserver, IObserver<float> longClickCancelObserver)\n    {\n        var isLongClicked = false; //\u9577\u62bc\u3057\u306eOnNext\u767a\u884c\u6e08\u304b\n        var count = 0.0f;\n\n        while (true)\n        {\n            if (Input.GetMouseButton(0))\n            {\n                count += Time.deltaTime;\n                if (!isLongClicked && count > threshold)\n                {\n                    isLongClicked = true;\n                    longClickObserver.OnNext(Unit.Default);\n                }\n            }\n            else if (Input.GetMouseButtonUp(0))\n            {\n                isLongClicked = false;\n                if (count > 0)\n                {\n                    longClickCancelObserver.OnNext(count);\n                    count = 0;\n                }\n            }\n            yield return null;\n\n        }\n    }\n\n\n    void OnDestroy()\n    {\n        if (longClickCoroutine != null)\n            StopCoroutine(longClickCoroutine);\n    }\n}\n```\n\n\u5224\u5b9a\u51e6\u7406\u3092\u7121\u9650\u30eb\u30fc\u30d7\u3059\u308b\u30b3\u30eb\u30fc\u30c1\u30f3\u306e\u4e2d\u306b\u66f8\u304d\u3001\u7d50\u679c\u3092\u30b9\u30c8\u30ea\u30fc\u30e0\u3067\u5916\u90e8\u306b\u901a\u77e5\u3059\u308b\u5f62\u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u30aa\u30da\u30ec\u30fc\u30bf\u30c1\u30a7\u30fc\u30f3\u306e\u9023\u7d50\u3067\u308f\u3051\u306e\u308f\u304b\u3089\u306a\u3044\u30b9\u30c8\u30ea\u30fc\u30e0\u306b\u306a\u308b\u304f\u3089\u3044\u306a\u3089\u3001\u8ae6\u3081\u3066\u624b\u7d9a\u304d\u7684\u306b\u66f8\u3044\u305f\u65b9\u304c\u65e9\u3044\u5834\u5408\u3082\u3042\u308a\u307e\u3059\u3002\u96d1\u591a\u306a\u51e6\u7406\u306f\u5168\u90e8\u30b3\u30eb\u30fc\u30c1\u30f3\u306b\u62bc\u3057\u8fbc\u307e\u308c\u3066\u3044\u3066\u5916\u306b\u51fa\u3066\u3053\u306a\u3044\u306e\u3067\u307e\u3041\u8a31\u5bb9\u7bc4\u56f2\u304b\u306a\u3041\u3068\u3002\n\n\u307e\u305f\u3053\u3046\u3044\u3063\u305f\u6c4e\u7528\u7684\u306b\u4f7f\u3044\u305d\u3046\u306a\u51e6\u7406\u306fObservableTrigger\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u3066\u304a\u304f\u3068\u826f\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3067\u3059\u306d\u3002\n", "tags": ["UniRx", "Unity"]}