{"tags": ["aws-cli"], "context": " More than 1 year has passed since last update.\n\n\u524d\u63d0\u6761\u4ef6\n\n\n[JAWS-UG CLI] IAM Managed Policy:#17 \u4f5c\u696d\u7528IAM\u30e6\u30fc\u30b6\u306e\u4f5c\u6210 \u306b\u3088\u308b\u8a2d\u5b9a\u4f5c\u696d\u304c\u5b8c\u4e86\u3057\u3066\u3044\u308b\u3053\u3068\n\n[JAWS-UG CLI] IAM Managed Policy:#17 Customer Managed Policies\u306e\u5229\u7528 \u306b\u3088\u308b\u8a2d\u5b9a\u4f5c\u696d\u304c\u5b8c\u4e86\u3057\u3066\u3044\u308b\u3053\u3068\n\n\n1. Policy Document\u306e\u7de8\u96c6\uff08Version\u306e\u8ffd\u52a0\uff09\n\n1.1. \u65b0\u3057\u3044\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\n\u30dd\u30ea\u30b7\u30fc\u30d5\u30a1\u30a4\u30eb\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u6c7a\u3081\u307e\u3059\u3002\n\ncommand\nFILE_NEW_MANAGED_POLICY_DOC=\"New_${IAM_MANAGED_POLICY_NAME}.json\"\necho ${FILE_NEW_MANAGED_POLICY_DOC}\n\n\n\nresut\nNew_S3_ManagedPolicy.json\n\n\n\u30dd\u30ea\u30b7\u30fc\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\uff08\u66f8\u304d\u8fbc\u307f\u3092\u7981\u6b62\u3057\u307e\u3059\u3002\uff09\n\ncommand\ncat << EOF > ${FILE_NEW_MANAGED_POLICY_DOC}\n{\n        \"Version\": \"2012-10-17\",\n        \"Statement\": [\n          {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n              \"s3:*\"\n            ],\n            \"Resource\": \"*\"\n          },\n          {\n            \"Effect\": \"Deny\",\n            \"Action\": [\n              \"s3:Put*\"\n            ],\n            \"Resource\": \"*\"\n          }\n        ]\n}\nEOF\n\n\nJSON\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u58ca\u308c\u3066\u306a\u3044\u304b\u5fc5\u305a\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\ncommnad\njsonlint -q ${FILE_NEW_MANAGED_POLICY_DOC}\n\n\n\nresult\n\uff08\u623b\u308a\u5024\u306a\u3057\uff09\n\n\n\n1.2. \u30dd\u30ea\u30b7\u30fc\u306e\u5909\u66f4\n\u5909\u6570\u306e\u78ba\u8a8d\n\ncommnad\ncat << ETX\n        IAM_MANAGED_POLICY_ARN: ${IAM_MANAGED_POLICY_ARN}\n        FILE_NEW_MANAGED_POLICY_DOC: ${FILE_NEW_MANAGED_POLICY_DOC}\nETX\n\n\n\nresult\n        IAM_MANAGED_POLICY_ARN: arn:aws:iam::************:policy/jawsug-cli/S3_ManagedPolicy\n        FILE_NEW_MANAGED_POLICY_DOC: New_S3_ManagedPolicy.json\n\n\n\u73fe\u72b6\u3092\u78ba\u8a8d\n\ncommand\naws iam get-policy --policy-arn ${IAM_MANAGED_POLICY_ARN}\n\n\n\nresult\n{\n    \"Policy\": {\n        \"PolicyName\": \"S3_ManagedPolicy\",\n        \"CreateDate\": \"2015-04-11T15:24:39Z\",\n        \"AttachmentCount\": 1,\n        \"IsAttachable\": true,\n        \"PolicyId\": \"A********************\",\n        \"DefaultVersionId\": \"v1\",\n        \"Path\": \"/jawsug-cli/\",\n        \"Arn\": \"arn:aws:iam::************:policy/jawsug-cli/S3_ManagedPolicy\",\n        \"UpdateDate\": \"2015-04-11T15:24:39Z\"\n    }\n}\n\n\n\u30dd\u30ea\u30b7\u30fc\u3092\u66f4\u65b0\n\uff08\u305f\u3060\u3057\u3001\u9069\u7528\u306f\u3057\u306a\u3044\uff09\n\ncommand\naws iam create-policy-version --policy-arn ${IAM_MANAGED_POLICY_ARN} --policy-document file://${FILE_NEW_MANAGED_POLICY_DOC}\n\n\n\nresult\n{\n    \"PolicyVersion\": {\n        \"CreateDate\": \"2015-03-28T13:06:44.682Z\",\n        \"VersionId\": \"v2\",\n        \"IsDefaultVersion\": false\n    }\n}\n\n\n\u73fe\u72b6\u3092\u78ba\u8a8d\n\uff08DefaultVersionId\u304c\u5909\u308f\u3063\u3066\u3044\u306a\u3044\u3053\u3068\u306b\u6ce8\u76ee\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff09\n\ncommand\naws iam get-policy --policy-arn ${IAM_MANAGED_POLICY_ARN}\n\n\n\nresult\n{\n    \"Policy\": {\n        \"PolicyName\": \"S3_ManagedPolicy\",\n        \"CreateDate\": \"2015-04-11T15:24:39Z\",\n        \"AttachmentCount\": 1,\n        \"IsAttachable\": true,\n        \"PolicyId\": \"A********************\",\n        \"DefaultVersionId\": \"v1\",\n        \"Path\": \"/jawsug-cli/\",\n        \"Arn\": \"arn:aws:iam::************:policy/jawsug-cli/S3_ManagedPolicy\",\n        \"UpdateDate\": \"2015-04-11T15:31:14Z\"\n    }\n}\n\n\n\n2. Default Version\u306e\u5909\u66f4\n\n2.1. Default Version\u306e\u5909\u66f4\n\u5909\u6570\u306e\u78ba\u8a8d\n\ncommnad\ncat << ETX\n        IAM_MANAGED_POLICY_ARN: ${IAM_MANAGED_POLICY_ARN}\nETX\n\n\n\nresult\n        IAM_MANAGED_POLICY_ARN: arn:aws:iam::************:policy/jawsug-cli/S3_ManagedPolicy\n\n\nDefault Version\u3092\u5909\u66f4\n\ncommnad\naws iam set-default-policy-version --policy-arn ${IAM_MANAGED_POLICY_ARN} --version-id \"v2\"\n\n\n\nresult\n\uff08\u623b\u308a\u5024\u306a\u3057\uff09\n\n\n\u73fe\u72b6\u3092\u78ba\u8a8d\n\uff08DefaultVersionId\u304c\u5909\u308f\u3063\u305f\u3053\u3068\u306b\u6ce8\u76ee\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff09\n\ncommand\naws iam get-policy --policy-arn ${IAM_MANAGED_POLICY_ARN}\n\n\n\nresult\n{\n    \"Policy\": {\n        \"PolicyName\": \"S3_ManagedPolicy\",\n        \"CreateDate\": \"2015-04-11T15:24:39Z\",\n        \"AttachmentCount\": 1,\n        \"IsAttachable\": true,\n        \"PolicyId\": \"A********************\",\n        \"DefaultVersionId\": \"v2\",\n        \"Path\": \"/jawsug-cli/\",\n        \"Arn\": \"arn:aws:iam::************:policy/jawsug-cli/S3_ManagedPolicy\",\n        \"UpdateDate\": \"2015-04-11T15:33:33Z\"\n    }\n}\n\n\n\n3. \u52d5\u4f5c\u78ba\u8a8d\n\n3.1. \u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u6c7a\u5b9a\n\ncommand\nFILE_LOCAL='test03.txt'\n\n\n\nresult\n\uff08\u623b\u308a\u5024\u306a\u3057\uff09\n\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n\ncommand\ntouch ${FILE_LOCAL}\n\n\n\nresult\n\uff08\u623b\u308a\u5024\u306a\u3057\uff09\n\n\n\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\ncommand\naws s3 cp ${FILE_LOCAL} s3://${S3_BUCKET_NAME}/\n\n\n\nresult\nupload failed: ./test03.txt to s3://jaws-ug-cli-17-handson/test03.txt A client error (AccessDenied) occurred when calling the PutObject operation: Access Denied\n\n\n\n4. \u30ed\u30fc\u30eb\u30d0\u30c3\u30af\n\ncommnad\naws iam set-default-policy-version --policy-arn ${IAM_MANAGED_POLICY_ARN} --version-id \"v1\"\n\n\n\nresult\n\uff08\u623b\u308a\u5024\u306a\u3057\uff09\n\n\n\u73fe\u72b6\u3092\u78ba\u8a8d\n\uff08DefaultVersionId\u304c\u5143\u306b\u623b\u3063\u3066\u3044\u308b\u3053\u3068\u306b\u6ce8\u76ee\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff09\n\ncommand\naws iam get-policy --policy-arn ${IAM_MANAGED_POLICY_ARN}\n\n\n\nresult\n{\n    \"Policy\": {\n        \"PolicyName\": \"S3_ManagedPolicy\",\n        \"CreateDate\": \"2015-04-11T15:24:39Z\",\n        \"AttachmentCount\": 1,\n        \"IsAttachable\": true,\n        \"PolicyId\": \"A********************\",\n        \"DefaultVersionId\": \"v1\",\n        \"Path\": \"/jawsug-cli/\",\n        \"Arn\": \"arn:aws:iam::************:policy/jawsug-cli/S3_ManagedPolicy\",\n        \"UpdateDate\": \"2015-04-11T15:34:57Z\"\n    }\n}\n\n\n\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\ncommand\naws s3 cp ${FILE_LOCAL} s3://${S3_BUCKET_NAME}/\n\n\n\nresult\nupload: ./test03.txt to s3://jaws-ug-cli-17-handson/test03.txt\n\n\n\n5. \uff08\u304a\u307e\u3051\uff09Version\u30925\u4e16\u4ee3\u3088\u308a\u591a\u304f\u4fdd\u6301\u3067\u304d\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n5.1. \u30dd\u30ea\u30b7\u30fc\u306e\u66f4\u65b0\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u30923\u56de\u7e70\u308a\u8fd4\u3057\u3001\u4fdd\u6301\u3067\u304d\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u4e0a\u9650\u307e\u3067\u4f5c\u6210\u3057\u307e\u3059\n\ncommand\naws iam create-policy-version --policy-arn ${IAM_MANAGED_POLICY_ARN} --policy-document file://${FILE_NEW_MANAGED_POLICY_DOC}\n\n\n\nresult\n{\n    \"PolicyVersion\": {\n        \"CreateDate\": \"2015-03-28T13:06:44.682Z\",\n        \"VersionId\": \"v3\",\n        \"IsDefaultVersion\": false\n    }\n}\n\n\n\ncommand\naws iam create-policy-version --policy-arn ${IAM_MANAGED_POLICY_ARN} --policy-document file://${FILE_NEW_MANAGED_POLICY_DOC}\n\n\n\nresult\n{\n    \"PolicyVersion\": {\n        \"CreateDate\": \"2015-03-28T13:06:44.682Z\",\n        \"VersionId\": \"v4\",\n        \"IsDefaultVersion\": false\n    }\n}\n\n\n\ncommand\naws iam create-policy-version --policy-arn ${IAM_MANAGED_POLICY_ARN} --policy-document file://${FILE_NEW_MANAGED_POLICY_DOC}\n\n\n\nresult\n{\n    \"PolicyVersion\": {\n        \"CreateDate\": \"2015-03-28T13:06:44.682Z\",\n        \"VersionId\": \"v5\",\n        \"IsDefaultVersion\": false\n    }\n}\n\n\n\u4e0a\u9650\u4ee5\u4e0a\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u4f5c\u6210\n\ncommand\naws iam create-policy-version --policy-arn ${IAM_MANAGED_POLICY_ARN} --policy-document file://${FILE_NEW_MANAGED_POLICY_DOC}\n\n\n\nresult\nA client error (LimitExceeded) occurred when calling the CreatePolicyVersion operation: A managed policy can have up to 5 versions. Before you create a new version, you must delete an existing version.\n\n\n\n6. \uff08\u304a\u307e\u3051\uff09Group\u306b3\u3064\u4ee5\u4e0a\u306eManaged Policy\u3092\u5272\u308a\u5f53\u3066\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n6.1. AWS Managed Policies\u3092\u9069\u7528\n\ncommand\nAWS_Managed_Policy_ARN_1='arn:aws:iam::aws:policy/AmazonEC2ReportsAccess'\nAWS_Managed_Policy_ARN_2='arn:aws:iam::aws:policy/AmazonRDSReadOnlyAccess'\n\n\n2\u3064\u76ee\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u30a2\u30bf\u30c3\u30c1\n\ncommand\naws iam attach-group-policy --group-name ${IAM_GROUP_NAME} --policy-arn ${AWS_Managed_Policy_ARN_1}\n\n\n\nresult\n\uff08\u623b\u308a\u5024\u306a\u3057\uff09\n\n\n3\u3064\u76ee\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u30a2\u30bf\u30c3\u30c1\n\ncommand\naws iam attach-group-policy --group-name ${IAM_GROUP_NAME} --policy-arn ${AWS_Managed_Policy_ARN_2}\n\n\n\nresult\nA client error (LimitExceeded) occurred when calling the AttachGroupPolicy operation: Cannot exceed quota for PoliciesPerGroup: 2\n\n\n2\u3064\u76ee\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u30c7\u30bf\u30c3\u30c1\n\ncommand\naws iam detach-group-policy --group-name ${IAM_GROUP_NAME} --policy-arn ${AWS_Managed_Policy_ARN_1}\n\n\n\nresult\n\uff08\u623b\u308a\u5024\u306a\u3057\uff09\n\n\n# \u524d\u63d0\u6761\u4ef6\n\n* [[JAWS-UG CLI] IAM Managed Policy:#17 \u4f5c\u696d\u7528IAM\u30e6\u30fc\u30b6\u306e\u4f5c\u6210](http://qiita.com/domokun70cm/private/fc7ed35c9cfef6f34723) \u306b\u3088\u308b\u8a2d\u5b9a\u4f5c\u696d\u304c\u5b8c\u4e86\u3057\u3066\u3044\u308b\u3053\u3068\n* [[JAWS-UG CLI] IAM Managed Policy:#17 Customer Managed Policies\u306e\u5229\u7528](http://qiita.com/domokun70cm/private/51b53f38126d5f71e5d5) \u306b\u3088\u308b\u8a2d\u5b9a\u4f5c\u696d\u304c\u5b8c\u4e86\u3057\u3066\u3044\u308b\u3053\u3068\n\n# 1. Policy Document\u306e\u7de8\u96c6\uff08Version\u306e\u8ffd\u52a0\uff09\n\n## 1.1. \u65b0\u3057\u3044\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\n\n\u30dd\u30ea\u30b7\u30fc\u30d5\u30a1\u30a4\u30eb\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u6c7a\u3081\u307e\u3059\u3002\n\n```bash:command\nFILE_NEW_MANAGED_POLICY_DOC=\"New_${IAM_MANAGED_POLICY_NAME}.json\"\necho ${FILE_NEW_MANAGED_POLICY_DOC}\n```\n\n```text:resut\nNew_S3_ManagedPolicy.json\n```\n\n\u30dd\u30ea\u30b7\u30fc\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\uff08\u66f8\u304d\u8fbc\u307f\u3092\u7981\u6b62\u3057\u307e\u3059\u3002\uff09\n\n```bash:command\ncat << EOF > ${FILE_NEW_MANAGED_POLICY_DOC}\n{\n        \"Version\": \"2012-10-17\",\n        \"Statement\": [\n          {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n              \"s3:*\"\n            ],\n            \"Resource\": \"*\"\n          },\n          {\n            \"Effect\": \"Deny\",\n            \"Action\": [\n              \"s3:Put*\"\n            ],\n            \"Resource\": \"*\"\n          }\n        ]\n}\nEOF\n```\n\nJSON\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u58ca\u308c\u3066\u306a\u3044\u304b\u5fc5\u305a\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:commnad\njsonlint -q ${FILE_NEW_MANAGED_POLICY_DOC}\n```\n\n```text:result\n\uff08\u623b\u308a\u5024\u306a\u3057\uff09\n```\n\n## 1.2. \u30dd\u30ea\u30b7\u30fc\u306e\u5909\u66f4\n\n\u5909\u6570\u306e\u78ba\u8a8d\n\n```bash:commnad\ncat << ETX\n        IAM_MANAGED_POLICY_ARN: ${IAM_MANAGED_POLICY_ARN}\n        FILE_NEW_MANAGED_POLICY_DOC: ${FILE_NEW_MANAGED_POLICY_DOC}\nETX\n```\n\n```text:result\n        IAM_MANAGED_POLICY_ARN: arn:aws:iam::************:policy/jawsug-cli/S3_ManagedPolicy\n        FILE_NEW_MANAGED_POLICY_DOC: New_S3_ManagedPolicy.json\n```\n\n\u73fe\u72b6\u3092\u78ba\u8a8d\n\n```bash:command\naws iam get-policy --policy-arn ${IAM_MANAGED_POLICY_ARN}\n```\n\n```text:result\n{\n    \"Policy\": {\n        \"PolicyName\": \"S3_ManagedPolicy\",\n        \"CreateDate\": \"2015-04-11T15:24:39Z\",\n        \"AttachmentCount\": 1,\n        \"IsAttachable\": true,\n        \"PolicyId\": \"A********************\",\n        \"DefaultVersionId\": \"v1\",\n        \"Path\": \"/jawsug-cli/\",\n        \"Arn\": \"arn:aws:iam::************:policy/jawsug-cli/S3_ManagedPolicy\",\n        \"UpdateDate\": \"2015-04-11T15:24:39Z\"\n    }\n}\n```\n\n\u30dd\u30ea\u30b7\u30fc\u3092\u66f4\u65b0\n\uff08\u305f\u3060\u3057\u3001\u9069\u7528\u306f\u3057\u306a\u3044\uff09\n\n```bash:command\naws iam create-policy-version --policy-arn ${IAM_MANAGED_POLICY_ARN} --policy-document file://${FILE_NEW_MANAGED_POLICY_DOC}\n```\n\n```text:result\n{\n    \"PolicyVersion\": {\n        \"CreateDate\": \"2015-03-28T13:06:44.682Z\",\n        \"VersionId\": \"v2\",\n        \"IsDefaultVersion\": false\n    }\n}\n```\n\n\u73fe\u72b6\u3092\u78ba\u8a8d\n**\uff08DefaultVersionId\u304c\u5909\u308f\u3063\u3066\u3044\u306a\u3044\u3053\u3068\u306b\u6ce8\u76ee\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff09**\n\n```bash:command\naws iam get-policy --policy-arn ${IAM_MANAGED_POLICY_ARN}\n```\n\n```text:result\n{\n    \"Policy\": {\n        \"PolicyName\": \"S3_ManagedPolicy\",\n        \"CreateDate\": \"2015-04-11T15:24:39Z\",\n        \"AttachmentCount\": 1,\n        \"IsAttachable\": true,\n        \"PolicyId\": \"A********************\",\n        \"DefaultVersionId\": \"v1\",\n        \"Path\": \"/jawsug-cli/\",\n        \"Arn\": \"arn:aws:iam::************:policy/jawsug-cli/S3_ManagedPolicy\",\n        \"UpdateDate\": \"2015-04-11T15:31:14Z\"\n    }\n}\n```\n\n# 2. Default Version\u306e\u5909\u66f4\n\n## 2.1. Default Version\u306e\u5909\u66f4\n\n\u5909\u6570\u306e\u78ba\u8a8d\n\n```bash:commnad\ncat << ETX\n        IAM_MANAGED_POLICY_ARN: ${IAM_MANAGED_POLICY_ARN}\nETX\n```\n\n```text:result\n        IAM_MANAGED_POLICY_ARN: arn:aws:iam::************:policy/jawsug-cli/S3_ManagedPolicy\n```\n\nDefault Version\u3092\u5909\u66f4\n\n```bash:commnad\naws iam set-default-policy-version --policy-arn ${IAM_MANAGED_POLICY_ARN} --version-id \"v2\"\n```\n\n```text:result\n\uff08\u623b\u308a\u5024\u306a\u3057\uff09\n```\n\n\u73fe\u72b6\u3092\u78ba\u8a8d\n**\uff08DefaultVersionId\u304c\u5909\u308f\u3063\u305f\u3053\u3068\u306b\u6ce8\u76ee\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff09**\n\n```bash:command\naws iam get-policy --policy-arn ${IAM_MANAGED_POLICY_ARN}\n```\n\n```text:result\n{\n    \"Policy\": {\n        \"PolicyName\": \"S3_ManagedPolicy\",\n        \"CreateDate\": \"2015-04-11T15:24:39Z\",\n        \"AttachmentCount\": 1,\n        \"IsAttachable\": true,\n        \"PolicyId\": \"A********************\",\n        \"DefaultVersionId\": \"v2\",\n        \"Path\": \"/jawsug-cli/\",\n        \"Arn\": \"arn:aws:iam::************:policy/jawsug-cli/S3_ManagedPolicy\",\n        \"UpdateDate\": \"2015-04-11T15:33:33Z\"\n    }\n}\n```\n\n# 3. \u52d5\u4f5c\u78ba\u8a8d\n\n## 3.1. \u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u6c7a\u5b9a\n\n```bash:command\nFILE_LOCAL='test03.txt'\n```\n\n```text:result\n\uff08\u623b\u308a\u5024\u306a\u3057\uff09\n```\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n\n```bash:command\ntouch ${FILE_LOCAL}\n```\n\n```text:result\n\uff08\u623b\u308a\u5024\u306a\u3057\uff09\n```\n\n\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\n```bash:command\naws s3 cp ${FILE_LOCAL} s3://${S3_BUCKET_NAME}/\n```\n\n```text:result\nupload failed: ./test03.txt to s3://jaws-ug-cli-17-handson/test03.txt A client error (AccessDenied) occurred when calling the PutObject operation: Access Denied\n```\n\n# 4. \u30ed\u30fc\u30eb\u30d0\u30c3\u30af\n\n```bash:commnad\naws iam set-default-policy-version --policy-arn ${IAM_MANAGED_POLICY_ARN} --version-id \"v1\"\n```\n\n```text:result\n\uff08\u623b\u308a\u5024\u306a\u3057\uff09\n```\n\n\u73fe\u72b6\u3092\u78ba\u8a8d\n**\uff08DefaultVersionId\u304c\u5143\u306b\u623b\u3063\u3066\u3044\u308b\u3053\u3068\u306b\u6ce8\u76ee\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff09**\n\n```bash:command\naws iam get-policy --policy-arn ${IAM_MANAGED_POLICY_ARN}\n```\n\n```text:result\n{\n    \"Policy\": {\n        \"PolicyName\": \"S3_ManagedPolicy\",\n        \"CreateDate\": \"2015-04-11T15:24:39Z\",\n        \"AttachmentCount\": 1,\n        \"IsAttachable\": true,\n        \"PolicyId\": \"A********************\",\n        \"DefaultVersionId\": \"v1\",\n        \"Path\": \"/jawsug-cli/\",\n        \"Arn\": \"arn:aws:iam::************:policy/jawsug-cli/S3_ManagedPolicy\",\n        \"UpdateDate\": \"2015-04-11T15:34:57Z\"\n    }\n}\n```\n\n\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\n```bash:command\naws s3 cp ${FILE_LOCAL} s3://${S3_BUCKET_NAME}/\n```\n\n```text:result\nupload: ./test03.txt to s3://jaws-ug-cli-17-handson/test03.txt\n```\n\n# 5. \uff08\u304a\u307e\u3051\uff09Version\u30925\u4e16\u4ee3\u3088\u308a\u591a\u304f\u4fdd\u6301\u3067\u304d\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n## 5.1. \u30dd\u30ea\u30b7\u30fc\u306e\u66f4\u65b0\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u30923\u56de\u7e70\u308a\u8fd4\u3057\u3001\u4fdd\u6301\u3067\u304d\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u4e0a\u9650\u307e\u3067\u4f5c\u6210\u3057\u307e\u3059\n\n```bash:command\naws iam create-policy-version --policy-arn ${IAM_MANAGED_POLICY_ARN} --policy-document file://${FILE_NEW_MANAGED_POLICY_DOC}\n```\n\n```text:result\n{\n    \"PolicyVersion\": {\n        \"CreateDate\": \"2015-03-28T13:06:44.682Z\",\n        \"VersionId\": \"v3\",\n        \"IsDefaultVersion\": false\n    }\n}\n```\n\n```bash:command\naws iam create-policy-version --policy-arn ${IAM_MANAGED_POLICY_ARN} --policy-document file://${FILE_NEW_MANAGED_POLICY_DOC}\n```\n\n```text:result\n{\n    \"PolicyVersion\": {\n        \"CreateDate\": \"2015-03-28T13:06:44.682Z\",\n        \"VersionId\": \"v4\",\n        \"IsDefaultVersion\": false\n    }\n}\n```\n\n```bash:command\naws iam create-policy-version --policy-arn ${IAM_MANAGED_POLICY_ARN} --policy-document file://${FILE_NEW_MANAGED_POLICY_DOC}\n```\n\n```text:result\n{\n    \"PolicyVersion\": {\n        \"CreateDate\": \"2015-03-28T13:06:44.682Z\",\n        \"VersionId\": \"v5\",\n        \"IsDefaultVersion\": false\n    }\n}\n```\n\n\u4e0a\u9650\u4ee5\u4e0a\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u4f5c\u6210\n\n```bash:command\naws iam create-policy-version --policy-arn ${IAM_MANAGED_POLICY_ARN} --policy-document file://${FILE_NEW_MANAGED_POLICY_DOC}\n```\n\n```text:result\nA client error (LimitExceeded) occurred when calling the CreatePolicyVersion operation: A managed policy can have up to 5 versions. Before you create a new version, you must delete an existing version.\n```\n\n# 6. \uff08\u304a\u307e\u3051\uff09Group\u306b3\u3064\u4ee5\u4e0a\u306eManaged Policy\u3092\u5272\u308a\u5f53\u3066\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n## 6.1. AWS Managed Policies\u3092\u9069\u7528\n\n```bash:command\nAWS_Managed_Policy_ARN_1='arn:aws:iam::aws:policy/AmazonEC2ReportsAccess'\nAWS_Managed_Policy_ARN_2='arn:aws:iam::aws:policy/AmazonRDSReadOnlyAccess'\n```\n\n2\u3064\u76ee\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u30a2\u30bf\u30c3\u30c1\n\n```bash:command\naws iam attach-group-policy --group-name ${IAM_GROUP_NAME} --policy-arn ${AWS_Managed_Policy_ARN_1}\n```\n\n```text:result\n\uff08\u623b\u308a\u5024\u306a\u3057\uff09\n```\n\n3\u3064\u76ee\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u30a2\u30bf\u30c3\u30c1\n\n```bash:command\naws iam attach-group-policy --group-name ${IAM_GROUP_NAME} --policy-arn ${AWS_Managed_Policy_ARN_2}\n```\n\n```text:result\nA client error (LimitExceeded) occurred when calling the AttachGroupPolicy operation: Cannot exceed quota for PoliciesPerGroup: 2\n```\n\n2\u3064\u76ee\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u30c7\u30bf\u30c3\u30c1\n\n```bash:command\naws iam detach-group-policy --group-name ${IAM_GROUP_NAME} --policy-arn ${AWS_Managed_Policy_ARN_1}\n```\n\n```text:result\n\uff08\u623b\u308a\u5024\u306a\u3057\uff09\n```\n"}