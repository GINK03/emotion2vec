{"context": "\n\n\uff10\uff0e\u306f\u3058\u3081\u306b\n\u524d\u56de\u306e\u7d9a\u304d\u3067\u3059\u3002\u4eca\u56de\u306fGoogle Gauge\u3068WebSocket\u3092\u4f7f\u7528\u3057\u3001\u30bb\u30f3\u30b5\u30c7\u30fc\u30bf\u306e\u53ef\u8996\u5316\u3092\u884c\u3044\u307e\u3059\u3002\n\n\uff11\uff0e\u5fc5\u8981\u306a\u3082\u306e\uff08\u4eca\u56de\u6e96\u5099\u3057\u305f\u3082\u306e\uff09\n\n\n\n\u9805\u76ee\n\u6570\u91cf\n\u30e1\u30e2\n\n\n\n\n\n\n\uff12\uff0e\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u3044\u305f\u3068\u3053\u308d\nNode-RED\u3092\u4f7f\u3063\u3066\u30bb\u30f3\u30b5\u30fc\u30c7\u30fc\u30bf\u3092WebSocket\u3067\u51fa\u529b\u3059\u308b\nGithub (karuru6225/bme280i2c)\n\n\uff13\uff0eJSON\u30c7\u30fc\u30bf\u306b\u30c7\u30d0\u30a4\u30b9ID\u3092\u8ffd\u52a0\n\u53d7\u4fe1\u3057\u305fJSON\u30c7\u30fc\u30bf\u306b\u306f\u3001\u30c7\u30d0\u30a4\u30b9ID\u304c\u5165\u3063\u3066\u3044\u307e\u305b\u3093\u3002\u5c06\u6765\u8907\u6570\u306e\u30c7\u30d0\u30a4\u30b9\u304c\u5897\u3048\u305f\u5834\u5408\u3092\u8003\u616e\u3057\u3066\u3001\u30c7\u30d0\u30a4\u30b9ID\u3092\u4ed8\u52a0\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u2460\u30c7\u30d0\u30a4\u30b9ID\u3092\u8ffd\u52a0\u7528\u306efunction\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u3002\nNode-RED\u306e\u5de6\u5074\u306b\u3042\u308bfunction\u304b\u3089function\u30ce\u30fc\u30c9\u3092\u9078\u629e\u3059\u308b\u3002\n\n\u2461function\u30ce\u30fc\u30c9\u3092\u7de8\u96c6\u3059\u308b\u3002\n\u3000Name\u9805\u76ee\u306b\u3001\u300cdevid\u8ffd\u52a0\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n\u3000Function\u306b\u3001\u4ee5\u4e0b\u306e\u5185\u5bb9\u3092\u5165\u529b\u3059\u308b\u3002\n\nFunction\ndevID = msg.deviceId;\n\nmsg.payload = {\n    \"deviceid\" : devID,\n    \"timestamp\": msg.payload.d.timestamp,\n    \"temp\"     : msg.payload.d.temp,\n    \"humid\"    : msg.payload.d.humid,\n    \"press\"    : msg.payload.d.press\n};\n\nreturn msg;\n\n\n\n\n\uff14\uff0eWebsocket\u51fa\u529b\u3092\u8ffd\u52a0\n\u2460websocket\u51fa\u529b\u7528\u306e\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\u3000Node-RED\u306e\u5de6\u5074\u306b\u3042\u308boutput\u304b\u3089websocket\u30ce\u30fc\u30c9\u3092\u9078\u629e\u3059\u308b\u3002\n\n\u2461websocket\u51fa\u529b\u7528\u30ce\u30fc\u30c9\u3092\u7de8\u96c6\u3059\u308b\u3002\n\u3000Type\u9805\u76ee\u306b\u3001\u300cListen on\u300d\u3092\u9078\u629e\u3059\u308b\u3002\n\u3000Path\u9805\u76ee\u306b\u3001\u300c/ws/sensor\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n\u3000Name\u9805\u76ee\u306b\u3001\u300c/ws/sensor\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n\n\u2462\u30bb\u30f3\u30b5\u60c5\u5831\u53d6\u5f97\u30ce\u30fc\u30c9\u3068devid\u8ffd\u52a0\u30ce\u30fc\u30c9\u304a\u3088\u3073websocket\u51fa\u529b\u7528\u30ce\u30fc\u30c9\u3092\u63a5\u7d9a\u3059\u308b\u3002\u307e\u305f\u3001DB\u84c4\u7a4d\u524d\u306bdevid\u3092\u8ffd\u52a0\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3059\u308b\n\n\n\uff15\uff0eGoogle Gauge\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u4f5c\u6210\n\u3053\u3053\u3067\u306f\u3001HTML\u3067\u8868\u793a\u3059\u308bGoogle Gauge\u306eHTML\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f5c\u6210\u3059\u308b\u3002\n\u2460template\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n\u2461template\u30ce\u30fc\u30c9\u3092\u7de8\u96c6\u3059\u308b\u3002\n\u3000Name\u9805\u76ee\u306b\u3001\u300cGoogle Gauge\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n\u3000Syntax Highlight\u9805\u76ee\u306b\u3001\u300cHTML\u300d\u3092\u9078\u629e\u3059\u308b\u3002\n\u3000Fomart\u9805\u76ee\u306b\u3001\u300cPlain text\u300d\u3092\u9078\u629e\u3059\u308b\u3002\n\nTemplate\u5185\u306b\u306f\u3001\u4e0b\u8a18\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u203bvar wsUrl = 'ws://XXXXXX.mybluemix.net/ws/sensor';\nXXXXXX\u306e\u90e8\u5206\u306f\u3001\u81ea\u5206\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nTemplate\n<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"UTF-8\">\n    <title>\u30bb\u30f3\u30b5\u30c7\u30fc\u30bf\u3000\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u8868\u793a</title>\n    <script type=\"text/javascript\" src=\"//www.google.com/jsapi\"></script>\n    <script type=\"text/javascript\">\n      var wsUrl = 'ws://XXXXXX.mybluemix.net/ws/sensor';//XXXXXX\u306e\u3068\u3053\u308d\u306f\u3001\u81ea\u5206\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n      var socket;\n      var temperatureData, humidityData, pressureData;\n      var temperatureOptions, humidityOptions, pressureOptions;\n      var temperatureChart, humidityChart, pressureChart;\n\n      // Google Gauge\n      google.load(\"visualization\", \"1\", {packages:[\"gauge\"]});\n      google.setOnLoadCallback(drawChart);\n      function drawChart() {\n        // Data for temperature chart\n        temperatureData = google.visualization.arrayToDataTable([\n          ['Label', 'Value'],\n          ['\u6e29\u5ea6', 0]\n        ]);\n\n        // Data for humidity chart\n        humidityData = google.visualization.arrayToDataTable([\n          ['Label', 'Value'],\n          ['\u6e7f\u5ea6', 0]\n        ]);\n\n        // Data for Pressure chart\n        pressureData = google.visualization.arrayToDataTable([\n          ['Label', 'Value'],\n          ['\u6c17\u5727', 0]\n        ]);\n\n        temperatureOptions = {\n          width: 800, height: 240,\n          min: 0, max: 60,\n          redFrom: 50, redTo: 60,\n          yellowFrom:40, yellowTo: 50,\n          minorTicks: 5,\n          majorTicks: [\"0\", \"10\",\"20\", \"30\", \"40\", \"50\", \"60\"]\n        };\n\n        // Option for humidity chart\n        humidityOptions = {\n          width: 800, height: 240,\n          min: 0, max: 100,\n          redFrom: 90, redTo: 100,\n          yellowFrom:75, yellowTo: 90,\n          minorTicks: 5,\n          majorTicks: [\"0\", \"10\",\"20\", \"30\", \"40\", \"50\", \"60\", \"70\", \"80\", \"90\", \"100\"]\n        };\n\n        // Option for pressure chart\n        pressureOptions = {\n          width: 800, height: 240,\n          min: 0, max: 1100,\n          redFrom: 1050, redTo: 1100,\n          yellowFrom:1010, yellowTo: 1050,\n          minorTicks: 5,\n          majorTicks: [\"0\", \"\",\"\", \"\", \"\", \"\", \"\", \"700\", \"800\", \"900\", \"1000\", \"1100\"]\n        };\n\n        temperatureChart = new google.visualization.Gauge(document.getElementById('temperatureChart'));\n        humidityChart = new google.visualization.Gauge(document.getElementById('humidityChart'));\n        pressureChart = new google.visualization.Gauge(document.getElementById('pressureChart'));\n\n        temperatureChart.draw(temperatureData, temperatureOptions);\n        humidityChart.draw(humidityData, humidityOptions);\n        pressureChart.draw(pressureData, pressureOptions);\n        connect();\n      };\n\n      function connect() {\n        socket = new WebSocket(wsUrl);\n        socket.onmessage = function(e) {\n          var sensorData = JSON.parse(e.data);\n\n          // Update temperature data\n          temperatureData.setValue(0, 1, sensorData.temp);\n\n          // Update humidity data\n          humidityData.setValue(0, 1, sensorData.humid);\n\n          // Update pressure data\n          pressureData.setValue(0, 1, sensorData.press);\n\n          temperatureChart.draw(temperatureData, temperatureOptions);\n          humidityChart.draw(humidityData, humidityOptions);\n          pressureChart.draw(pressureData, pressureOptions);\n        };\n      };\n\n      function disconnect() {\n          socket.close();\n      };\n\n\nfunction clock() {\n   var nowTime = new Date();\n   var nowHour = (\"0\"+ nowTime.getHours()).substr(-2);\n   var nowMin = (\"0\"+ nowTime.getMinutes()).substr(-2);\n   var nowSec = (\"0\"+ nowTime.getSeconds()).substr(-2);\n   var msg = \"\u73fe\u5728\u6642\u523b\uff1a\" + nowHour + \":\" + nowMin + \":\" + nowSec;\n   document.getElementById(\"Clock\").innerHTML = msg;\n}\nsetInterval('clock()',1000);\n\n    </script>\n  </head>\n  <body>\n    <h2>\u6e29\u6e7f\u5ea6\u30fb\u6c17\u5727\u3000\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u8868\u793a(Google Gauge)</h2>\n    <p id=\"Clock\"></p>\n    <div>\n      <button onclick=\"connect()\">Connect</button>\n      <button onclick=\"disconnect()\">Disconnect</button>\n    </div>\n\n    <div>\n      <div id=\"temperatureChart\" style=\"width: 800px; height: 0px;\"></div>\n      <div id=\"humidityChart\" style=\"width: 800px; height: 0px; position: relative; left: 230px;\"></div>\n      <div id=\"pressureChart\" style=\"width: 800px; height: 220px; position: relative; left: 460px;\"></div>\n    </div>\n  </body>\n</html>\n\n\n\u2462\u5165\u529b\u7528HTTP\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u3002\nNode-RED\u306e\u5de6\u5074\u306b\u3042\u308binput\u304b\u3089http\u30ce\u30fc\u30c9\u3092\u9078\u629e\u3059\u308b\u3002\n\n\u2463\u5165\u529b\u7528HTTP\u30ce\u30fc\u30c9\u3092\u7de8\u96c6\u3059\u308b\u3002\n\u3000Method\u9805\u76ee\u306b\u3001\u300cGET\u300d\u3092\u9078\u629e\u3059\u308b\u3002\n\u3000URL\u9805\u76ee\u306b\u3001\u300c/sensor\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n\n\u2464\u51fa\u529b\u7528HTTP\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u3002\nNode-RED\u306e\u5de6\u5074\u306b\u3042\u308boutput\u304b\u3089http response\u30ce\u30fc\u30c9\u3092\u9078\u629e\u3059\u308b\u3002\n\n\u2465\u5165\u529b\u7528HTTP\u30ce\u30fc\u30c9\u3068Google Gauge\u30ce\u30fc\u30c9\u304a\u3088\u3073\u51fa\u529b\u7528HTTP\u30ce\u30fc\u30c9\u3092\u63a5\u7d9a\u3059\u308b\u3002\n\n\u2466\u53f3\u4e0a\u306eDeploy\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001\u5909\u66f4\u3092\u53cd\u6620\u3059\u308b\u3002\n\n\uff16\uff0e\u30d6\u30e9\u30a6\u30b6\u3067\u8868\u793a\u3092\u78ba\u8a8d\n\u2460\u4efb\u610f\u306e\u30d6\u30e9\u30a6\u30b6\u3067\u4e0b\u8a18URL\u306b\u63a5\u7d9a\u3059\u308b\u3002\nhttp://XXXXXX.mybluemix.net/sensor  \u3000\u203bXXXXXX\u306f\u3001\u81ea\u5206\u306e\u74b0\u5883\u306b\u3042\u308f\u305b\u3066\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u2461Websocket\u306e\u63a5\u7d9a\u72b6\u6cc1\u3092\u78ba\u8a8d\u3059\u308b\u3002\n \u4e0b\u56f3\u306e\u8d64\u67a0\u300cconnected 1\u300d\u306b\u306a\u3063\u3066\u3044\u308c\u3070\u63a5\u7d9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u3000\u203bdisconnected\u306b\u306a\u3063\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u2460\u306e\u6dfb\u4ed8\u56f3\u306b\u3042\u308bConnect\u30dc\u30bf\u30f3\u3092\u518d\u5ea6\u30af\u30ea\u30c3\u30af\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u2462\u4ee5\u524d\u4f5c\u6210\u3057\u305f\u3001mqtt.js\u3092\u4f7f\u7528\u3057\u3066\u30c7\u30fc\u30bf\u3092\u6295\u5165\u3059\u308b\u3002\n\n\u30b3\u30de\u30f3\u30c9\npi@raspberrypi ~ $ node mqtt.js\n\n\n\u2463Google Gauge\u306b\u7d50\u679c\u304c\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b\u53cd\u6620\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n\u2464mqtt.js\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\u3002\n\u3000\u3053\u306e\u307e\u307e\u3067\u3059\u3068\u3001\u56fa\u5b9a\u306e\u6e29\u5ea6\u30fb\u6e7f\u5ea6\u30fb\u6c17\u5727\u306e\u305f\u3081\u3001\u5909\u5316\u304c\u306a\u3044\u306e\u3067\u3001\u30e9\u30f3\u30c0\u30e0\u306b\u5024\u304c\u5909\u5316\u3059\u308b\u3088\u3046\u306b\n\u3000\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\u3002\u307e\u305f\u3001\uff15\u79d2\u7f6e\u304d\u306b\u30c7\u30fc\u30bf\u3092\u767a\u751f\u3055\u305b\u308b\u3088\u3046\u306b\u5909\u66f4\u3059\u308b\u3002\n\nmqtt.js\nvar moment = require('moment');\nvar Client = require(\"ibmiotf\").IotfDevice;\n\nvar config = {\n\u7701\u7565\n};\n\n//\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u767a\u751f\u3055\u305b\u308b\nvar getRandomData = function(value){\n   return Math.floor(Math.random()*8 + (value-3));\n}\nvar client = new Client (config);\n\nclient.connect();\n\nclient.on(\"connect\", function () {\n   setInterval(function(){\n      var nowtime = moment().format(\"YYYY-MM-DD HH:mm:ss.SSS\");\n      var temp_v = getRandomData(25);\n      var humid_v = getRandomData(40);\n      var press_v = getRandomData(1000);\n      payload = JSON.stringify({d : { timestamp : nowtime, temp : temp_v, humid : humid_v, press : press_v }});\n      console.log(payload);\n      client.publish (\"eid\", \"json\", payload);\n   }, 5000); //5000ms\u7f6e\u304d(5\u79d2\u7f6e\u304d\u306b\u30c7\u30fc\u30bf\u3092\u767a\u751f\u3055\u305b\u308b)\n});\n\n\n\u2465\u518d\u5ea6mqtt.js\u3092\u5b9f\u884c\u3057\u3066\u3001Google Gauge\u304c\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b\u5909\u5316\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n\uff17\uff0eBME280\u30bb\u30f3\u30b5\u30c7\u30fc\u30bf\u306e\u9023\u643a\n\u2460github\u3067\u516c\u958b\u3055\u308c\u3066\u3044\u308b\u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u3092\u5165\u624b\u3059\u308b\u3002\n\u3000\u81ea\u529b\u3067\u4f5c\u6210\u3059\u308b\u529b\u304c\u8db3\u308a\u306a\u304b\u3063\u305f\u305f\u3081\u3001\u3053\u3053Github (karuru6225/bme280i2c)\u3092\u5229\u7528\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\n\n\u30b3\u30de\u30f3\u30c9\npi@raspberrypi ~ $ git clone https://github.com/karuru6225/bme280i2c.git\n\n\n\u2461index.js\u3092\u53c2\u8003\u306bbme280.js\u3092\u4f5c\u6210\u3059\u308b\u3002\n\u3000index.js\u3092bme280.js\u3068\u3057\u3066\u30b3\u30d4\u30fc\u3059\u308b\u3002\n\n\u30b3\u30de\u30f3\u30c9\npi@raspberrypi ~ $ cp bme280i2c/index.js bme280.js\n\n\n\u6b21\u306e\u90e8\u5206\u3092\u7de8\u96c6\u3059\u308b\u3002\u7de8\u96c6\u500b\u6240\u306f\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u5f8c\u308d\u306b\u3042\u308bsetIntaval\u90e8\u5206\u306e\uff13\u304b\u6240\u3092\u7de8\u96c6\u3059\u308b\u3002\n\nbme280.js\n\uff08\u7701\u7565\uff09\n//setInterval(function(){\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000//\u3053\u306e\u884c\u3092\u30b3\u30e1\u30f3\u30c8\u3068\u3057\u3001\nexports.bme = function(p_callback) {    //\u3053\u306e\u884c\u3092\u8ffd\u52a0\u3059\u308b\u3002\n  async.waterfall([\n      function(cb){\n        readRawData(function(raws){\n          cb(null, raws);\n        });\n      },\n      function(raws, cb){\n        var tbase = getTBase(raws.t, calib);\n        var temp = calibrateT(tbase, calib);\n        var pres = calibrateP(raws.p, tbase, calib);\n        var humi = calibrateH(raws.h, tbase, calib);\n        console.log('temp:' + (temp/100.0));\n        console.log('pres:' + (pres/100.0));\n        console.log('humi:' + (humi));\n        console.log('');\n        p_callback(temp/100.0, humi, pres/100.0); //\u3053\u306e\u884c\u3092\u8ffd\u52a0\n        cb();\n      }\n  ]);\n//},1000);\u3000\u3000//\u3053\u306e\u884c\u3092\u30b3\u30e1\u30f3\u30c8\u3068\u3057\u3001\n};            //\u3053\u306e\u884c\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n\n\u2462bme280.js\u3092\u547c\u3073\u51fa\u3057\u3001\u6e29\u5ea6\u30fb\u6e7f\u5ea6\u30fb\u6c17\u5727\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u3088\u3046\u306b\u3001mqtt.js\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\u3002\n\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u5f8c\u306emqtt.js\u306f\u3001\u4e0b\u8a18\u306e\u901a\u308a\u3002\n\nmqtt.js\nvar f = require('./bme280.js');\nvar moment = require('moment');\nvar Client = require(\"ibmiotf\").IotfDevice;\n\nvar config = {\n (\u7701\u7565)\n};\n\nfunction mkJson(callback) {\n   f.bme(function(temp, humid, press){\n      var nowtime = moment().format(\"YYYY-MM-DD HH:mm:ss.SSS\");\n      var temp_v =  temp.toFixed(1);\n      var humid_v = humid.toFixed(1);\n      var press_v = press.toFixed(1);\n      payload = JSON.stringify({d : { timestamp : nowtime, temp : temp_v, humid : humid_v, press : press_v }});\n      //console.log(payload);\n      callback(payload);\n   });\n}\n\nvar client = new Client (config);\n\nclient.connect();\n\nclient.on(\"connect\", function () {\n   mkJson(function(payload) {\n      console.log(payload);\n      client.publish (\"eid\", \"json\", payload);\n   });\n   setInterval(function(){\n        mkJson(function(payload) {\n           console.log(payload);\n        });\n        client.publish (\"eid\", \"json\", payload);\n   }, 60000);\n});\n\n\n\u2463mqtt.js\u3092\u5b9f\u884c\u3059\u308b\u3002\n\u3000\u4eca\u56de\u306f\u3001\uff11\u5206\u5468\u671f\u306b\u3057\u305f\u305f\u3081\u3001\u9069\u5b9c\u6642\u9593\u3092\u5909\u66f4\u3057\u3066\u8a66\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u4ee5\u4e0a\u3067\u3001Google Gauge\u3068Websocket\u3092\u7528\u3044\u305f\u53ef\u8996\u5316\u624b\u9806\u306f\u7d42\u4e86\u3067\u3059\u3002\n\u6b21(\u305d\u306e\uff19)\u306f\u3001chart.js\u3092\u5229\u7528\u3057mongodb\u304b\u3089\u53d6\u5f97\u3057\u305f\u904e\u53bb\u30c7\u30fc\u30bf\u3092\u6298\u308c\u7dda\u30b0\u30e9\u30d5\u3067\u8868\u793a\u3059\u308b\u3053\u3068\u3092\u884c\u3044\u307e\u3059\u3002\n##\uff10\uff0e\u306f\u3058\u3081\u306b\n[\u524d\u56de](http://qiita.com/hino9966/items/2ff8b224c64a2570d68e)\u306e\u7d9a\u304d\u3067\u3059\u3002\u4eca\u56de\u306fGoogle Gauge\u3068WebSocket\u3092\u4f7f\u7528\u3057\u3001\u30bb\u30f3\u30b5\u30c7\u30fc\u30bf\u306e\u53ef\u8996\u5316\u3092\u884c\u3044\u307e\u3059\u3002\n\n##\uff11\uff0e\u5fc5\u8981\u306a\u3082\u306e\uff08\u4eca\u56de\u6e96\u5099\u3057\u305f\u3082\u306e\uff09\n|\u9805\u76ee|\u6570\u91cf|\u30e1\u30e2|\n|---|:---:|---|\n\n##\uff12\uff0e\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u3044\u305f\u3068\u3053\u308d\n[Node-RED\u3092\u4f7f\u3063\u3066\u30bb\u30f3\u30b5\u30fc\u30c7\u30fc\u30bf\u3092WebSocket\u3067\u51fa\u529b\u3059\u308b](http://qiita.com/asmanabu/items/03fcced66fd850a10061)\n[Github (karuru6225/bme280i2c)](https://github.com/karuru6225/bme280i2c)\n##\uff13\uff0eJSON\u30c7\u30fc\u30bf\u306b\u30c7\u30d0\u30a4\u30b9ID\u3092\u8ffd\u52a0\n\u53d7\u4fe1\u3057\u305fJSON\u30c7\u30fc\u30bf\u306b\u306f\u3001\u30c7\u30d0\u30a4\u30b9ID\u304c\u5165\u3063\u3066\u3044\u307e\u305b\u3093\u3002\u5c06\u6765\u8907\u6570\u306e\u30c7\u30d0\u30a4\u30b9\u304c\u5897\u3048\u305f\u5834\u5408\u3092\u8003\u616e\u3057\u3066\u3001\u30c7\u30d0\u30a4\u30b9ID\u3092\u4ed8\u52a0\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n**\u2460\u30c7\u30d0\u30a4\u30b9ID\u3092\u8ffd\u52a0\u7528\u306efunction\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u3002**\nNode-RED\u306e\u5de6\u5074\u306b\u3042\u308bfunction\u304b\u3089function\u30ce\u30fc\u30c9\u3092\u9078\u629e\u3059\u308b\u3002\n![image](https://qiita-image-store.s3.amazonaws.com/0/113879/98681aea-70a2-de16-1854-5bc7302a909e.png)\n\n**\u2461function\u30ce\u30fc\u30c9\u3092\u7de8\u96c6\u3059\u308b\u3002**\n\u3000Name\u9805\u76ee\u306b\u3001\u300cdevid\u8ffd\u52a0\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n\u3000Function\u306b\u3001\u4ee5\u4e0b\u306e\u5185\u5bb9\u3092\u5165\u529b\u3059\u308b\u3002\n\n```js:Function\ndevID = msg.deviceId;\n\nmsg.payload = {\n    \"deviceid\" : devID,\n    \"timestamp\": msg.payload.d.timestamp,\n    \"temp\"     : msg.payload.d.temp,\n    \"humid\"    : msg.payload.d.humid,\n    \"press\"    : msg.payload.d.press\n};\n\nreturn msg;\n```\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/113879/54e6b711-9a39-a334-ee5f-5144103a68f8.png)\n\n\n\n##\uff14\uff0eWebsocket\u51fa\u529b\u3092\u8ffd\u52a0\n**\u2460websocket\u51fa\u529b\u7528\u306e\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u3002**\n\u3000Node-RED\u306e\u5de6\u5074\u306b\u3042\u308boutput\u304b\u3089websocket\u30ce\u30fc\u30c9\u3092\u9078\u629e\u3059\u308b\u3002\n![image](https://qiita-image-store.s3.amazonaws.com/0/113879/1eeba01a-d702-0f8a-2274-4e409834fc9c.png)\n\n**\u2461websocket\u51fa\u529b\u7528\u30ce\u30fc\u30c9\u3092\u7de8\u96c6\u3059\u308b\u3002**\n\u3000Type\u9805\u76ee\u306b\u3001\u300cListen on\u300d\u3092\u9078\u629e\u3059\u308b\u3002\n\u3000Path\u9805\u76ee\u306b\u3001\u300c/ws/sensor\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n\u3000Name\u9805\u76ee\u306b\u3001\u300c/ws/sensor\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n![image](https://qiita-image-store.s3.amazonaws.com/0/113879/1593cadb-7ba0-260e-e12f-304af1d38db1.png)\n\n**\u2462\u30bb\u30f3\u30b5\u60c5\u5831\u53d6\u5f97\u30ce\u30fc\u30c9\u3068devid\u8ffd\u52a0\u30ce\u30fc\u30c9\u304a\u3088\u3073websocket\u51fa\u529b\u7528\u30ce\u30fc\u30c9\u3092\u63a5\u7d9a\u3059\u308b\u3002\u307e\u305f\u3001DB\u84c4\u7a4d\u524d\u306bdevid\u3092\u8ffd\u52a0\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3059\u308b**\n![image](https://qiita-image-store.s3.amazonaws.com/0/113879/b9738ab7-368d-d76f-cfec-7920b5c3d926.png)\n\n##\uff15\uff0eGoogle Gauge\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u4f5c\u6210\n\u3053\u3053\u3067\u306f\u3001HTML\u3067\u8868\u793a\u3059\u308bGoogle Gauge\u306eHTML\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f5c\u6210\u3059\u308b\u3002\n**\u2460template\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u3002**\n![image](https://qiita-image-store.s3.amazonaws.com/0/113879/0626c0d6-66ab-6768-ad96-b74c68c97701.png)\n\n**\u2461template\u30ce\u30fc\u30c9\u3092\u7de8\u96c6\u3059\u308b\u3002**\n\u3000Name\u9805\u76ee\u306b\u3001\u300cGoogle Gauge\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n\u3000Syntax Highlight\u9805\u76ee\u306b\u3001\u300cHTML\u300d\u3092\u9078\u629e\u3059\u308b\u3002\n\u3000Fomart\u9805\u76ee\u306b\u3001\u300cPlain text\u300d\u3092\u9078\u629e\u3059\u308b\u3002\n![image](https://qiita-image-store.s3.amazonaws.com/0/113879/1f2bbe24-d05f-a197-d69f-d7fe48f3c16b.png)\n \n Template\u5185\u306b\u306f\u3001\u4e0b\u8a18\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n*\u203bvar wsUrl = 'ws://XXXXXX.mybluemix.net/ws/sensor';*\n*XXXXXX\u306e\u90e8\u5206\u306f\u3001\u81ea\u5206\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002*\n\n```js:Template\n<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"UTF-8\">\n    <title>\u30bb\u30f3\u30b5\u30c7\u30fc\u30bf\u3000\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u8868\u793a</title>\n    <script type=\"text/javascript\" src=\"//www.google.com/jsapi\"></script>\n    <script type=\"text/javascript\">\n      var wsUrl = 'ws://XXXXXX.mybluemix.net/ws/sensor';//XXXXXX\u306e\u3068\u3053\u308d\u306f\u3001\u81ea\u5206\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n      var socket;\n      var temperatureData, humidityData, pressureData;\n      var temperatureOptions, humidityOptions, pressureOptions;\n      var temperatureChart, humidityChart, pressureChart;\n\n      // Google Gauge\n      google.load(\"visualization\", \"1\", {packages:[\"gauge\"]});\n      google.setOnLoadCallback(drawChart);\n      function drawChart() {\n        // Data for temperature chart\n        temperatureData = google.visualization.arrayToDataTable([\n          ['Label', 'Value'],\n          ['\u6e29\u5ea6', 0]\n        ]);\n\n        // Data for humidity chart\n        humidityData = google.visualization.arrayToDataTable([\n          ['Label', 'Value'],\n          ['\u6e7f\u5ea6', 0]\n        ]);\n\n        // Data for Pressure chart\n        pressureData = google.visualization.arrayToDataTable([\n          ['Label', 'Value'],\n          ['\u6c17\u5727', 0]\n        ]);\n\n        temperatureOptions = {\n          width: 800, height: 240,\n          min: 0, max: 60,\n          redFrom: 50, redTo: 60,\n          yellowFrom:40, yellowTo: 50,\n          minorTicks: 5,\n          majorTicks: [\"0\", \"10\",\"20\", \"30\", \"40\", \"50\", \"60\"]\n        };\n\n        // Option for humidity chart\n        humidityOptions = {\n          width: 800, height: 240,\n          min: 0, max: 100,\n          redFrom: 90, redTo: 100,\n          yellowFrom:75, yellowTo: 90,\n          minorTicks: 5,\n          majorTicks: [\"0\", \"10\",\"20\", \"30\", \"40\", \"50\", \"60\", \"70\", \"80\", \"90\", \"100\"]\n        };\n\n        // Option for pressure chart\n        pressureOptions = {\n          width: 800, height: 240,\n          min: 0, max: 1100,\n          redFrom: 1050, redTo: 1100,\n          yellowFrom:1010, yellowTo: 1050,\n          minorTicks: 5,\n          majorTicks: [\"0\", \"\",\"\", \"\", \"\", \"\", \"\", \"700\", \"800\", \"900\", \"1000\", \"1100\"]\n        };\n\n        temperatureChart = new google.visualization.Gauge(document.getElementById('temperatureChart'));\n        humidityChart = new google.visualization.Gauge(document.getElementById('humidityChart'));\n        pressureChart = new google.visualization.Gauge(document.getElementById('pressureChart'));\n\n        temperatureChart.draw(temperatureData, temperatureOptions);\n        humidityChart.draw(humidityData, humidityOptions);\n        pressureChart.draw(pressureData, pressureOptions);\n        connect();\n      };\n\n      function connect() {\n        socket = new WebSocket(wsUrl);\n        socket.onmessage = function(e) {\n          var sensorData = JSON.parse(e.data);\n\n          // Update temperature data\n          temperatureData.setValue(0, 1, sensorData.temp);\n\n          // Update humidity data\n          humidityData.setValue(0, 1, sensorData.humid);\n\n          // Update pressure data\n          pressureData.setValue(0, 1, sensorData.press);\n\n          temperatureChart.draw(temperatureData, temperatureOptions);\n          humidityChart.draw(humidityData, humidityOptions);\n          pressureChart.draw(pressureData, pressureOptions);\n        };\n      };\n\n      function disconnect() {\n          socket.close();\n      };\n\n\nfunction clock() {\n   var nowTime = new Date();\n   var nowHour = (\"0\"+ nowTime.getHours()).substr(-2);\n   var nowMin = (\"0\"+ nowTime.getMinutes()).substr(-2);\n   var nowSec = (\"0\"+ nowTime.getSeconds()).substr(-2);\n   var msg = \"\u73fe\u5728\u6642\u523b\uff1a\" + nowHour + \":\" + nowMin + \":\" + nowSec;\n   document.getElementById(\"Clock\").innerHTML = msg;\n}\nsetInterval('clock()',1000);\n\n    </script>\n  </head>\n  <body>\n    <h2>\u6e29\u6e7f\u5ea6\u30fb\u6c17\u5727\u3000\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u8868\u793a(Google Gauge)</h2>\n    <p id=\"Clock\"></p>\n    <div>\n      <button onclick=\"connect()\">Connect</button>\n      <button onclick=\"disconnect()\">Disconnect</button>\n    </div>\n\n    <div>\n      <div id=\"temperatureChart\" style=\"width: 800px; height: 0px;\"></div>\n      <div id=\"humidityChart\" style=\"width: 800px; height: 0px; position: relative; left: 230px;\"></div>\n      <div id=\"pressureChart\" style=\"width: 800px; height: 220px; position: relative; left: 460px;\"></div>\n    </div>\n  </body>\n</html>\n```\n\n**\u2462\u5165\u529b\u7528HTTP\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u3002**\nNode-RED\u306e\u5de6\u5074\u306b\u3042\u308binput\u304b\u3089http\u30ce\u30fc\u30c9\u3092\u9078\u629e\u3059\u308b\u3002\n![image](https://qiita-image-store.s3.amazonaws.com/0/113879/ae008525-afac-8506-1f8a-3c33a06b2ea9.png)\n\n**\u2463\u5165\u529b\u7528HTTP\u30ce\u30fc\u30c9\u3092\u7de8\u96c6\u3059\u308b\u3002**\n\u3000Method\u9805\u76ee\u306b\u3001\u300cGET\u300d\u3092\u9078\u629e\u3059\u308b\u3002\n\u3000URL\u9805\u76ee\u306b\u3001\u300c/sensor\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n![image](https://qiita-image-store.s3.amazonaws.com/0/113879/230e4940-b990-efd7-d239-5d94f143750e.png)\n\n**\u2464\u51fa\u529b\u7528HTTP\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u3002**\nNode-RED\u306e\u5de6\u5074\u306b\u3042\u308boutput\u304b\u3089http response\u30ce\u30fc\u30c9\u3092\u9078\u629e\u3059\u308b\u3002\n![image](https://qiita-image-store.s3.amazonaws.com/0/113879/ffcdd94c-b99c-a254-8e43-a3b24bea4bfe.png)\n\n\n**\u2465\u5165\u529b\u7528HTTP\u30ce\u30fc\u30c9\u3068Google Gauge\u30ce\u30fc\u30c9\u304a\u3088\u3073\u51fa\u529b\u7528HTTP\u30ce\u30fc\u30c9\u3092\u63a5\u7d9a\u3059\u308b\u3002**\n![image](https://qiita-image-store.s3.amazonaws.com/0/113879/29012b7b-54f3-a8bd-0a8b-cf8646d19d6a.png)\n\n**\u2466\u53f3\u4e0a\u306eDeploy\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001\u5909\u66f4\u3092\u53cd\u6620\u3059\u308b\u3002**\n\n\n##\uff16\uff0e\u30d6\u30e9\u30a6\u30b6\u3067\u8868\u793a\u3092\u78ba\u8a8d\n**\u2460\u4efb\u610f\u306e\u30d6\u30e9\u30a6\u30b6\u3067\u4e0b\u8a18URL\u306b\u63a5\u7d9a\u3059\u308b\u3002**\nhttp://XXXXXX.mybluemix.net/sensor  \u3000\u203bXXXXXX\u306f\u3001\u81ea\u5206\u306e\u74b0\u5883\u306b\u3042\u308f\u305b\u3066\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/113879/e4fdafa9-bee9-33fc-8c01-5f158932c199.png)\n\n**\u2461Websocket\u306e\u63a5\u7d9a\u72b6\u6cc1\u3092\u78ba\u8a8d\u3059\u308b\u3002**\n \u4e0b\u56f3\u306e\u8d64\u67a0\u300cconnected 1\u300d\u306b\u306a\u3063\u3066\u3044\u308c\u3070\u63a5\u7d9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u3000\u203bdisconnected\u306b\u306a\u3063\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u2460\u306e\u6dfb\u4ed8\u56f3\u306b\u3042\u308bConnect\u30dc\u30bf\u30f3\u3092\u518d\u5ea6\u30af\u30ea\u30c3\u30af\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n![image](https://qiita-image-store.s3.amazonaws.com/0/113879/9b8fc92d-c259-081a-0ba6-579315546c19.png)\n\n**\u2462\u4ee5\u524d\u4f5c\u6210\u3057\u305f\u3001mqtt.js\u3092\u4f7f\u7528\u3057\u3066\u30c7\u30fc\u30bf\u3092\u6295\u5165\u3059\u308b\u3002**\n\n```text:\u30b3\u30de\u30f3\u30c9\npi@raspberrypi ~ $ node mqtt.js\n```\n\n**\u2463Google Gauge\u306b\u7d50\u679c\u304c\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b\u53cd\u6620\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002**\n![image](https://qiita-image-store.s3.amazonaws.com/0/113879/99c621a3-cb76-e7ad-3b36-88c37970d627.png)\n\n\n**\u2464mqtt.js\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\u3002**\n\u3000\u3053\u306e\u307e\u307e\u3067\u3059\u3068\u3001\u56fa\u5b9a\u306e\u6e29\u5ea6\u30fb\u6e7f\u5ea6\u30fb\u6c17\u5727\u306e\u305f\u3081\u3001\u5909\u5316\u304c\u306a\u3044\u306e\u3067\u3001\u30e9\u30f3\u30c0\u30e0\u306b\u5024\u304c\u5909\u5316\u3059\u308b\u3088\u3046\u306b\n\u3000\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\u3002\u307e\u305f\u3001\uff15\u79d2\u7f6e\u304d\u306b\u30c7\u30fc\u30bf\u3092\u767a\u751f\u3055\u305b\u308b\u3088\u3046\u306b\u5909\u66f4\u3059\u308b\u3002\n\n```js:mqtt.js\nvar moment = require('moment');\nvar Client = require(\"ibmiotf\").IotfDevice;\n\nvar config = {\n\u7701\u7565\n};\n\n//\u30e9\u30f3\u30c0\u30e0\u30c7\u30fc\u30bf\u3092\u767a\u751f\u3055\u305b\u308b\nvar getRandomData = function(value){\n   return Math.floor(Math.random()*8 + (value-3));\n}\nvar client = new Client (config);\n\nclient.connect();\n\nclient.on(\"connect\", function () {\n   setInterval(function(){\n      var nowtime = moment().format(\"YYYY-MM-DD HH:mm:ss.SSS\");\n      var temp_v = getRandomData(25);\n      var humid_v = getRandomData(40);\n      var press_v = getRandomData(1000);\n      payload = JSON.stringify({d : { timestamp : nowtime, temp : temp_v, humid : humid_v, press : press_v }});\n      console.log(payload);\n      client.publish (\"eid\", \"json\", payload);\n   }, 5000); //5000ms\u7f6e\u304d(5\u79d2\u7f6e\u304d\u306b\u30c7\u30fc\u30bf\u3092\u767a\u751f\u3055\u305b\u308b)\n});\n```\n\n**\u2465\u518d\u5ea6mqtt.js\u3092\u5b9f\u884c\u3057\u3066\u3001Google Gauge\u304c\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b\u5909\u5316\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002**\n\n##\uff17\uff0eBME280\u30bb\u30f3\u30b5\u30c7\u30fc\u30bf\u306e\u9023\u643a\n**\u2460github\u3067\u516c\u958b\u3055\u308c\u3066\u3044\u308b\u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u3092\u5165\u624b\u3059\u308b\u3002**\n\u3000\u81ea\u529b\u3067\u4f5c\u6210\u3059\u308b\u529b\u304c\u8db3\u308a\u306a\u304b\u3063\u305f\u305f\u3081\u3001\u3053\u3053[Github (karuru6225/bme280i2c)](https://github.com/karuru6225/bme280i2c)\u3092\u5229\u7528\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\n\n```text:\u30b3\u30de\u30f3\u30c9\npi@raspberrypi ~ $ git clone https://github.com/karuru6225/bme280i2c.git\n```\n**\u2461index.js\u3092\u53c2\u8003\u306bbme280.js\u3092\u4f5c\u6210\u3059\u308b\u3002**\n\u3000index.js\u3092bme280.js\u3068\u3057\u3066\u30b3\u30d4\u30fc\u3059\u308b\u3002\n\n```text:\u30b3\u30de\u30f3\u30c9\npi@raspberrypi ~ $ cp bme280i2c/index.js bme280.js\n```\n\n\u6b21\u306e\u90e8\u5206\u3092\u7de8\u96c6\u3059\u308b\u3002\u7de8\u96c6\u500b\u6240\u306f\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u5f8c\u308d\u306b\u3042\u308bsetIntaval\u90e8\u5206\u306e\uff13\u304b\u6240\u3092\u7de8\u96c6\u3059\u308b\u3002\n\n```js:bme280.js\n\uff08\u7701\u7565\uff09\n//setInterval(function(){\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000//\u3053\u306e\u884c\u3092\u30b3\u30e1\u30f3\u30c8\u3068\u3057\u3001\nexports.bme = function(p_callback) {    //\u3053\u306e\u884c\u3092\u8ffd\u52a0\u3059\u308b\u3002\n  async.waterfall([\n      function(cb){\n        readRawData(function(raws){\n          cb(null, raws);\n        });\n      },\n      function(raws, cb){\n        var tbase = getTBase(raws.t, calib);\n        var temp = calibrateT(tbase, calib);\n        var pres = calibrateP(raws.p, tbase, calib);\n        var humi = calibrateH(raws.h, tbase, calib);\n        console.log('temp:' + (temp/100.0));\n        console.log('pres:' + (pres/100.0));\n        console.log('humi:' + (humi));\n        console.log('');\n        p_callback(temp/100.0, humi, pres/100.0); //\u3053\u306e\u884c\u3092\u8ffd\u52a0\n        cb();\n      }\n  ]);\n//},1000);\u3000\u3000//\u3053\u306e\u884c\u3092\u30b3\u30e1\u30f3\u30c8\u3068\u3057\u3001\n};            //\u3053\u306e\u884c\u3092\u8ffd\u52a0\u3059\u308b\u3002\n```\n\n**\u2462bme280.js\u3092\u547c\u3073\u51fa\u3057\u3001\u6e29\u5ea6\u30fb\u6e7f\u5ea6\u30fb\u6c17\u5727\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u3088\u3046\u306b\u3001mqtt.js\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\u3002**\n\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u5f8c\u306emqtt.js\u306f\u3001\u4e0b\u8a18\u306e\u901a\u308a\u3002\n\n```js:mqtt.js\nvar f = require('./bme280.js');\nvar moment = require('moment');\nvar Client = require(\"ibmiotf\").IotfDevice;\n\nvar config = {\n (\u7701\u7565)\n};\n\nfunction mkJson(callback) {\n   f.bme(function(temp, humid, press){\n      var nowtime = moment().format(\"YYYY-MM-DD HH:mm:ss.SSS\");\n      var temp_v =  temp.toFixed(1);\n      var humid_v = humid.toFixed(1);\n      var press_v = press.toFixed(1);\n      payload = JSON.stringify({d : { timestamp : nowtime, temp : temp_v, humid : humid_v, press : press_v }});\n      //console.log(payload);\n      callback(payload);\n   });\n}\n\nvar client = new Client (config);\n\nclient.connect();\n\nclient.on(\"connect\", function () {\n   mkJson(function(payload) {\n      console.log(payload);\n      client.publish (\"eid\", \"json\", payload);\n   });\n   setInterval(function(){\n        mkJson(function(payload) {\n           console.log(payload);\n        });\n        client.publish (\"eid\", \"json\", payload);\n   }, 60000);\n});\n```\n**\u2463mqtt.js\u3092\u5b9f\u884c\u3059\u308b\u3002**\n\u3000\u4eca\u56de\u306f\u3001\uff11\u5206\u5468\u671f\u306b\u3057\u305f\u305f\u3081\u3001\u9069\u5b9c\u6642\u9593\u3092\u5909\u66f4\u3057\u3066\u8a66\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u4ee5\u4e0a\u3067\u3001Google Gauge\u3068Websocket\u3092\u7528\u3044\u305f\u53ef\u8996\u5316\u624b\u9806\u306f\u7d42\u4e86\u3067\u3059\u3002\n\n\u6b21([\u305d\u306e\uff19](http://qiita.com/hino9966/items/be8ecca36bd90aa8419a))\u306f\u3001chart.js\u3092\u5229\u7528\u3057mongodb\u304b\u3089\u53d6\u5f97\u3057\u305f\u904e\u53bb\u30c7\u30fc\u30bf\u3092\u6298\u308c\u7dda\u30b0\u30e9\u30d5\u3067\u8868\u793a\u3059\u308b\u3053\u3068\u3092\u884c\u3044\u307e\u3059\u3002\n", "tags": ["Bluemix", "nosql", "RaspberryPi", "\u30bb\u30f3\u30b5\u30fc", "IoT"]}