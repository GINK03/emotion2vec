{"context": "etcd\u3092\u7ba1\u7406\u60c5\u5831\u3092\u6271\u3046Backend\u306b\u3057\u3066\u3001docker-machine\u3092\u4f7f\u3063\u3066Swarm Cluster\u3092\u69cb\u7bc9\u3059\u308b\u3002\n\n\u3000\u74b0\u5883\n\ndocker(version 1.12.3)\ndocker-machine(version 0.7.0)\netcd(version 2.3.7)\n\n\nVagrantfile\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\n# Vagrantfile API/syntax version. Don't touch unless you know what you're doing!\nVAGRANTFILE_API_VERSION = \"2\"\n\nVagrant.configure(VAGRANTFILE_API_VERSION) do |config|\n  # If true, then any SSH connections made will enable agent forwarding.\n  # Default value: false\n  config.ssh.forward_agent = true\n\n  config.vm.define \"manager\" do |d|\n    d.vm.box = \"ubuntu/trusty64\"\n    d.vm.network :private_network, ip: \"192.168.33.10\", virtualbox__intnet: \"intnet\"\n  end\n\n  config.vm.define \"node1\" do |d|\n    d.vm.box = \"ubuntu/trusty64\"\n    d.vm.network :private_network, ip: \"192.168.33.20\", virtualbox__intnet: \"intnet\"\n  end\n\n  config.vm.define \"node2\" do |d|\n    d.vm.box = \"ubuntu/trusty64\"\n    d.vm.network :private_network, ip: \"192.168.33.30\", virtualbox__intnet: \"intnet\"\n  end\n\n  config.vm.define \"kvstore\" do |d|\n    d.vm.box = \"ubuntu/trusty64\"\n    d.vm.network :private_network, ip: \"192.168.33.40\", virtualbox__intnet: \"intnet\"\n  end\n\n  config.vm.define \"host\" do |d|\n    d.vm.box = \"ubuntu/trusty64\"\n    d.vm.network :private_network, ip: \"192.168.33.50\", virtualbox__intnet: \"intnet\"\n  end\nend\n\n\n\n\n\nIP\n\u7528\u9014\n\n\n\n\nmanager\n192.168.33.10\nSwarm\u30af\u30e9\u30b9\u30bf\u30fc\u306emaster\n\n\nnode1\n192.168.33.20\nSwarm\u30af\u30e9\u30b9\u30bf\u30fc\u306enode1\n\n\nnode2\n192.168.33.30\nSwarm\u30af\u30e9\u30b9\u30bf\u30fc\u306emaster\n\n\nkvstore\n192.168.33.40\nSwarm\u30af\u30e9\u30b9\u30bf\u30fcBackend\u306eetcd\u7528\n\n\nhost\n192.168.33.50\n\u4f5c\u696d\u5834\u6240\n\n\n\nhost\u304b\u3089manager, node1, node2, kvstore\u306bSSH\u3067\u5165\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u3002\n\u6700\u521d\u306betcd\u4f5c\u3063\u3066\u304b\u3089Swarm\u3092\u69cb\u7bc9\u3057\u3066\u3044\u304f\u3088\u3046\u306a\u5f62\u3002\n\u4f5c\u696d\u306f\u5168\u3066hostVM\u4e0a\u3067\u3084\u308b\u3002\n\netcd\nkvstore\u306betcd\u30b3\u30f3\u30c6\u30ca\u3092\u7acb\u3066\u308b\u3002\n$ docker-machine create \\\n   --driver generic --generic-ip-address=192.168.33.40 \\\n   --generic-ssh-user vagrant --generic-ssh-key ~/.ssh/id_rsa \\\n   kvstore\n$ eval $(docker-machine env kvstore)\n$ docker pull quay.io/coreos/etcd:v2.3.7\n$ docker run -d --name etcd \\\n   -p 2379:2379 -p 4001:4001 \\\n   quay.io/coreos/etcd:v2.3.7 \\\n   --data-dir=/tmp/default.etcd \\\n   --advertise-client-urls 'http://192.168.33.40:2379,http://192.168.33.40:4001' \\\n   --listen-client-urls 'http://0.0.0.0:2379,http://0.0.0.0:4001'\n$ ETCDCTL_ENDPOINT=\"http://192.168.33.40:2379\" ./etcdctl --no-sync  get /\n\n\n\u306f\u307e\u3063\u305f\u30dd\u30a4\u30f3\u30c8\n--advertise-client-urls\u306f'http://0.0.0.0:2379,http://0.0.0.0:4001'\u3067\u306f\u306a\u304fhttp://192.168.33.40:2379,http://192.168.33.40:4001\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\nSwarm Cluster\u306e\u69cb\u7bc9\n\nswarm-master\u3092\u4f5c\u308b\nmanager\n$ docker-machine create \\\n   --driver generic --generic-ip-address=192.168.33.10 \\\n   --generic-ssh-user vagrant --generic-ssh-key ~/.ssh/id_rsa \\\n   --swarm --swarm-master \\\n   --swarm-discovery=\"etcd://$(docker-machine ip kvstore):2379/swarm\" \\\n   --engine-opt=\"cluster-store=etcd://$(docker-machine ip kvstore):2379\" \\\n   --engine-opt=\"cluster-advertise=eth1:2376\" \\\n   manager\n\n\nswarm-node\u3092\u4f5c\u308b\nnode1\n$ docker-machine create \\\n   --driver generic --generic-ip-address=192.168.33.20 \\\n   --generic-ssh-user vagrant --generic-ssh-key ~/.ssh/id_rsa \\\n   --swarm \\\n   --swarm-discovery=\"etcd://$(docker-machine ip kvstore):2379/swarm\" \\\n   node1\n\nnode2\n$ docker-machine create \\\n   --driver generic --generic-ip-address=192.168.33.30 \\\n   --generic-ssh-user vagrant --generic-ssh-key ~/.ssh/id_rsa \\\n   --swarm \\\n   --swarm-discovery=\"etcd://$(docker-machine ip kvstore):2379/swarm\" \\\n   node2\n\n\n\u52d5\u4f5c\u78ba\u8a8d\netcd\netcd\u306eAPI\u3067\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\nmanager, node1, node2\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u3002\n{\n  \"node\": {\n    \"nodes\": [\n      {\n        \"createdIndex\": 4,\n        \"modifiedIndex\": 4,\n        \"nodes\": [\n          {\n            \"createdIndex\": 4,\n            \"modifiedIndex\": 4,\n            \"nodes\": [\n              {\n                \"createdIndex\": 4,\n                \"modifiedIndex\": 4,\n                \"nodes\": [\n                  {\n                    \"createdIndex\": 4,\n                    \"modifiedIndex\": 4,\n                    \"nodes\": [\n                      {\n                        \"createdIndex\": 100,\n                        \"modifiedIndex\": 100,\n                        \"ttl\": 134,\n                        \"expiration\": \"2016-11-23T11:45:51.259602538Z\",\n                        \"value\": \"192.168.33.10:2376\",\n                        \"key\": \"/swarm/docker/swarm/nodes/192.168.33.10:2376\"\n                      },\n                      {\n                        \"createdIndex\": 102,\n                        \"modifiedIndex\": 102,\n                        \"ttl\": 168,\n                        \"expiration\": \"2016-11-23T11:46:25.014658247Z\",\n                        \"value\": \"192.168.33.20:2376\",\n                        \"key\": \"/swarm/docker/swarm/nodes/192.168.33.20:2376\"\n                      },\n                      {\n                        \"createdIndex\": 101,\n                        \"modifiedIndex\": 101,\n                        \"ttl\": 137,\n                        \"expiration\": \"2016-11-23T11:45:53.997167245Z\",\n                        \"value\": \"192.168.33.30:2376\",\n                        \"key\": \"/swarm/docker/swarm/nodes/192.168.33.30:2376\"\n                      }\n                    ],\n                    \"dir\": true,\n                    \"key\": \"/swarm/docker/swarm/nodes\"\n                  }\n                ],\n                \"dir\": true,\n                \"key\": \"/swarm/docker/swarm\"\n              }\n            ],\n            \"dir\": true,\n            \"key\": \"/swarm/docker\"\n          }\n        ],\n        \"dir\": true,\n        \"key\": \"/swarm\"\n      }\n    ],\n    \"dir\": true\n  },\n  \"action\": \"get\"\n}\n\ncluster\ndocker-machine\u3067\u72b6\u614b\u78ba\u8a8d\u3002\n192.168.33.10\u3092master\u306b\u3057\u3066Running\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n$ docker-machine ls\nNAME      ACTIVE      DRIVER    STATE     URL                        SWARM              DOCKER    ERRORS\nkvstore   -           generic   Running   tcp://192.168.33.40:2376                      v1.12.3\nmanager   * (swarm)   generic   Running   tcp://192.168.33.10:2376   manager (master)   v1.12.3\nnode1     -           generic   Running   tcp://192.168.33.20:2376   manager            v1.12.3\nnode2     -           generic   Running   tcp://192.168.33.30:2376   manager            v1.12.3\n\nswarm-manager\u3092docker\u30db\u30b9\u30c8\u306b\u3057\u3066docker\u30b3\u30de\u30f3\u30c9\u3092\u8d77\u52d5\u3002\n\u30af\u30e9\u30b9\u30bf\u306e\u60c5\u5831\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n$ eval $(docker-machine env --swarm manager)\n$ docker info\n...\nNodes: 3\n manager: 192.168.33.10:2376\n  \u2514 ID: 7MOY:Q7KV:KRXU:ORDJ:7LNB:LGSM:GT5H:N4J3:BMC7:WC7C:RMEA:UPA6\n  \u2514 Status: Healthy\n  \u2514 Containers: 2 (2 Running, 0 Paused, 0 Stopped)\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 514.5 MiB\n  \u2514 Labels: kernelversion=3.13.0-95-generic, operatingsystem=Ubuntu 14.04.5 LTS, provider=generic, storagedriver=aufs\n  \u2514 UpdatedAt: 2016-11-23T11:49:04Z\n  \u2514 ServerVersion: 1.12.3\n node1: 192.168.33.20:2376\n  \u2514 ID: C6GI:OKAT:H2LH:VCBU:OF65:YWST:QVQ7:X6RP:6JY5:2CQK:4PVM:LVCZ\n  \u2514 Status: Healthy\n  \u2514 Containers: 1 (1 Running, 0 Paused, 0 Stopped)\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 514.5 MiB\n  \u2514 Labels: kernelversion=3.13.0-95-generic, operatingsystem=Ubuntu 14.04.5 LTS, provider=generic, storagedriver=aufs\n  \u2514 UpdatedAt: 2016-11-23T11:49:16Z\n  \u2514 ServerVersion: 1.12.3\n node2: 192.168.33.30:2376\n  \u2514 ID: IJAI:XSRL:3T5S:5XEF:AUVZ:TLYM:RVAH:MYAW:Q43J:CVCF:J5JH:BGZA\n  \u2514 Status: Healthy\n  \u2514 Containers: 1 (1 Running, 0 Paused, 0 Stopped)\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 514.5 MiB\n  \u2514 Labels: kernelversion=3.13.0-95-generic, operatingsystem=Ubuntu 14.04.5 LTS, provider=generic, storagedriver=aufs\n  \u2514 UpdatedAt: 2016-11-23T11:49:16Z\n  \u2514 ServerVersion: 1.12.3\n...\n\n\n\u9069\u5f53\u306a\u30b3\u30f3\u30c6\u30ca\u3092\u7acb\u3066\u3066\u307f\u308b\nubuntu\u3092pull\u3057\u306610\u500b\u3050\u3089\u3044\u7acb\u3066\u308b\u3002\n$ docker pull ubuntu\n$ docker run -d ubuntu tail -f /dev/nul\n.....\n$ docker run -d ubuntu tail -f /dev/nul\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND               CREATED             STATUS              PORTS               NAMES\nadb3b7d5e716        ubuntu              \"tail -f /dev/null\"   4 seconds ago       Up 3 seconds                            node1/cocky_stallman\ndcd7f4f99864        ubuntu              \"tail -f /dev/null\"   22 seconds ago      Up 21 seconds                           node2/furious_payne\n734878f86e59        ubuntu              \"tail -f /dev/null\"   23 seconds ago      Up 22 seconds                           node1/small_ardinghelli\n0d6099e7cc05        ubuntu              \"tail -f /dev/null\"   25 seconds ago      Up 24 seconds                           node2/nauseous_hoover\nf06a02774421        ubuntu              \"tail -f /dev/null\"   26 seconds ago      Up 25 seconds                           node1/big_kare\nb24d42d433f4        ubuntu              \"tail -f /dev/null\"   29 seconds ago      Up 28 seconds                           node2/hungry_engelbart\n7daa0be7d630        ubuntu              \"tail -f /dev/null\"   54 seconds ago      Up 52 seconds                           node1/stupefied_joliot\n9ddaf2e88b93        ubuntu              \"tail -f /dev/null\"   2 seconds ago       Up 1 seconds                            manager/elated_northcutt\n66b4da48e09d        ubuntu              \"tail -f /dev/null\"   24 seconds ago      Up 23 seconds                           manager/elated_stonebraker\nbb97b9a39644        ubuntu              \"tail -f /dev/null\"   27 seconds ago      Up 26 seconds                           manager/determined_lichterman\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306estrategy\u304cspread\u306a\u306e\u3067manager, node1, node2\u306b\u305d\u308c\u305e\u308c\u5747\u7b49\u306b\u30b3\u30f3\u30c6\u30ca\u304c\u7acb\u3063\u3066\u3044\u308b\u3002\n\n\u53c2\u8003\nhttps://www.linux.com/learn/how-use-docker-machine-create-swarm-cluster\nhttps://docs.docker.com/swarm/provision-with-machine/\nhttp://qiita.com/ohhara_shiojiri/items/47e4111a81431c7cb3a7\nhttps://docs.docker.com/swarm/install-w-machine/\nhttp://blog.scottlowe.org/2015/04/19/running-etcd-backed-docker-swarm-cluster/\nhttps://docs.docker.com/machine/reference/create/#/specifying-docker-swarm-options-for-the-created-machine\nhttp://trainingdevops.com/insights-and-tutorials/building-cloud-with-etcd-docker-swarm-and-overlay-network\nhttps://docs.docker.com/engine/userguide/networking/get-started-overlay/#/create-a-swarm-cluster\nhttp://stackoverflow.com/questions/34892377/the-cluster-store-and-cluster-advertise-dont-work\nhttps://github.com/docker/swarm/issues/1710\nhttps://github.com/kubernetes/kubernetes/issues/19235\nhttps://docs.docker.com/swarm/discovery/\netcd\u3092\u7ba1\u7406\u60c5\u5831\u3092\u6271\u3046Backend\u306b\u3057\u3066\u3001docker-machine\u3092\u4f7f\u3063\u3066Swarm Cluster\u3092\u69cb\u7bc9\u3059\u308b\u3002\n\n#\u3000\u74b0\u5883\n\n* docker(version 1.12.3)\n* docker-machine(version 0.7.0)\n* etcd(version 2.3.7)\n\n# Vagrantfile\n\n```\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\n# Vagrantfile API/syntax version. Don't touch unless you know what you're doing!\nVAGRANTFILE_API_VERSION = \"2\"\n\nVagrant.configure(VAGRANTFILE_API_VERSION) do |config|\n  # If true, then any SSH connections made will enable agent forwarding.\n  # Default value: false\n  config.ssh.forward_agent = true\n\n  config.vm.define \"manager\" do |d|\n    d.vm.box = \"ubuntu/trusty64\"\n    d.vm.network :private_network, ip: \"192.168.33.10\", virtualbox__intnet: \"intnet\"\n  end\n\n  config.vm.define \"node1\" do |d|\n    d.vm.box = \"ubuntu/trusty64\"\n    d.vm.network :private_network, ip: \"192.168.33.20\", virtualbox__intnet: \"intnet\"\n  end\n\n  config.vm.define \"node2\" do |d|\n    d.vm.box = \"ubuntu/trusty64\"\n    d.vm.network :private_network, ip: \"192.168.33.30\", virtualbox__intnet: \"intnet\"\n  end\n\n  config.vm.define \"kvstore\" do |d|\n    d.vm.box = \"ubuntu/trusty64\"\n    d.vm.network :private_network, ip: \"192.168.33.40\", virtualbox__intnet: \"intnet\"\n  end\n\n  config.vm.define \"host\" do |d|\n    d.vm.box = \"ubuntu/trusty64\"\n    d.vm.network :private_network, ip: \"192.168.33.50\", virtualbox__intnet: \"intnet\"\n  end\nend\n```\n\n|        |IP             | \u7528\u9014  |\n|--------|---------------|---|\n|manager |192.168.33.10  |Swarm\u30af\u30e9\u30b9\u30bf\u30fc\u306emaster         |\n|node1   |192.168.33.20  |Swarm\u30af\u30e9\u30b9\u30bf\u30fc\u306enode1          |\n|node2   |192.168.33.30  |Swarm\u30af\u30e9\u30b9\u30bf\u30fc\u306emaster         |\n|kvstore |192.168.33.40  |Swarm\u30af\u30e9\u30b9\u30bf\u30fcBackend\u306eetcd\u7528  |\n|host    |192.168.33.50  |\u4f5c\u696d\u5834\u6240                      |\n\nhost\u304b\u3089manager, node1, node2, kvstore\u306bSSH\u3067\u5165\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u3002\n\u6700\u521d\u306betcd\u4f5c\u3063\u3066\u304b\u3089Swarm\u3092\u69cb\u7bc9\u3057\u3066\u3044\u304f\u3088\u3046\u306a\u5f62\u3002\n\u4f5c\u696d\u306f\u5168\u3066hostVM\u4e0a\u3067\u3084\u308b\u3002\n\n# etcd\n\n`kvstore`\u306betcd\u30b3\u30f3\u30c6\u30ca\u3092\u7acb\u3066\u308b\u3002\n\n```\n$ docker-machine create \\\n   --driver generic --generic-ip-address=192.168.33.40 \\\n   --generic-ssh-user vagrant --generic-ssh-key ~/.ssh/id_rsa \\\n   kvstore\n$ eval $(docker-machine env kvstore)\n$ docker pull quay.io/coreos/etcd:v2.3.7\n$ docker run -d --name etcd \\\n   -p 2379:2379 -p 4001:4001 \\\n   quay.io/coreos/etcd:v2.3.7 \\\n   --data-dir=/tmp/default.etcd \\\n   --advertise-client-urls 'http://192.168.33.40:2379,http://192.168.33.40:4001' \\\n   --listen-client-urls 'http://0.0.0.0:2379,http://0.0.0.0:4001'\n$ ETCDCTL_ENDPOINT=\"http://192.168.33.40:2379\" ./etcdctl --no-sync  get /\n```\n\n## \u306f\u307e\u3063\u305f\u30dd\u30a4\u30f3\u30c8\n\n`--advertise-client-urls`\u306f`'http://0.0.0.0:2379,http://0.0.0.0:4001'`\u3067\u306f\u306a\u304f`http://192.168.33.40:2379,http://192.168.33.40:4001`\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n\n# Swarm Cluster\u306e\u69cb\u7bc9\n\n## swarm-master\u3092\u4f5c\u308b\n\n**manager**\n\n```\n$ docker-machine create \\\n   --driver generic --generic-ip-address=192.168.33.10 \\\n   --generic-ssh-user vagrant --generic-ssh-key ~/.ssh/id_rsa \\\n   --swarm --swarm-master \\\n   --swarm-discovery=\"etcd://$(docker-machine ip kvstore):2379/swarm\" \\\n   --engine-opt=\"cluster-store=etcd://$(docker-machine ip kvstore):2379\" \\\n   --engine-opt=\"cluster-advertise=eth1:2376\" \\\n   manager\n```\n\n## swarm-node\u3092\u4f5c\u308b\n\n**node1**\n\n```\n$ docker-machine create \\\n   --driver generic --generic-ip-address=192.168.33.20 \\\n   --generic-ssh-user vagrant --generic-ssh-key ~/.ssh/id_rsa \\\n   --swarm \\\n   --swarm-discovery=\"etcd://$(docker-machine ip kvstore):2379/swarm\" \\\n   node1\n```\n\n**node2**\n\n```\n$ docker-machine create \\\n   --driver generic --generic-ip-address=192.168.33.30 \\\n   --generic-ssh-user vagrant --generic-ssh-key ~/.ssh/id_rsa \\\n   --swarm \\\n   --swarm-discovery=\"etcd://$(docker-machine ip kvstore):2379/swarm\" \\\n   node2\n```\n\n# \u52d5\u4f5c\u78ba\u8a8d\n\n**etcd**\n\netcd\u306eAPI\u3067\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\nmanager, node1, node2\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u3002\n\n```\n{\n  \"node\": {\n    \"nodes\": [\n      {\n        \"createdIndex\": 4,\n        \"modifiedIndex\": 4,\n        \"nodes\": [\n          {\n            \"createdIndex\": 4,\n            \"modifiedIndex\": 4,\n            \"nodes\": [\n              {\n                \"createdIndex\": 4,\n                \"modifiedIndex\": 4,\n                \"nodes\": [\n                  {\n                    \"createdIndex\": 4,\n                    \"modifiedIndex\": 4,\n                    \"nodes\": [\n                      {\n                        \"createdIndex\": 100,\n                        \"modifiedIndex\": 100,\n                        \"ttl\": 134,\n                        \"expiration\": \"2016-11-23T11:45:51.259602538Z\",\n                        \"value\": \"192.168.33.10:2376\",\n                        \"key\": \"/swarm/docker/swarm/nodes/192.168.33.10:2376\"\n                      },\n                      {\n                        \"createdIndex\": 102,\n                        \"modifiedIndex\": 102,\n                        \"ttl\": 168,\n                        \"expiration\": \"2016-11-23T11:46:25.014658247Z\",\n                        \"value\": \"192.168.33.20:2376\",\n                        \"key\": \"/swarm/docker/swarm/nodes/192.168.33.20:2376\"\n                      },\n                      {\n                        \"createdIndex\": 101,\n                        \"modifiedIndex\": 101,\n                        \"ttl\": 137,\n                        \"expiration\": \"2016-11-23T11:45:53.997167245Z\",\n                        \"value\": \"192.168.33.30:2376\",\n                        \"key\": \"/swarm/docker/swarm/nodes/192.168.33.30:2376\"\n                      }\n                    ],\n                    \"dir\": true,\n                    \"key\": \"/swarm/docker/swarm/nodes\"\n                  }\n                ],\n                \"dir\": true,\n                \"key\": \"/swarm/docker/swarm\"\n              }\n            ],\n            \"dir\": true,\n            \"key\": \"/swarm/docker\"\n          }\n        ],\n        \"dir\": true,\n        \"key\": \"/swarm\"\n      }\n    ],\n    \"dir\": true\n  },\n  \"action\": \"get\"\n}\n```\n\n**cluster**\n\ndocker-machine\u3067\u72b6\u614b\u78ba\u8a8d\u3002\n`192.168.33.10`\u3092master\u306b\u3057\u3066Running\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n```\n$ docker-machine ls\nNAME      ACTIVE      DRIVER    STATE     URL                        SWARM              DOCKER    ERRORS\nkvstore   -           generic   Running   tcp://192.168.33.40:2376                      v1.12.3\nmanager   * (swarm)   generic   Running   tcp://192.168.33.10:2376   manager (master)   v1.12.3\nnode1     -           generic   Running   tcp://192.168.33.20:2376   manager            v1.12.3\nnode2     -           generic   Running   tcp://192.168.33.30:2376   manager            v1.12.3\n```\n\nswarm-manager\u3092docker\u30db\u30b9\u30c8\u306b\u3057\u3066docker\u30b3\u30de\u30f3\u30c9\u3092\u8d77\u52d5\u3002\n\u30af\u30e9\u30b9\u30bf\u306e\u60c5\u5831\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n```\n$ eval $(docker-machine env --swarm manager)\n$ docker info\n...\nNodes: 3\n manager: 192.168.33.10:2376\n  \u2514 ID: 7MOY:Q7KV:KRXU:ORDJ:7LNB:LGSM:GT5H:N4J3:BMC7:WC7C:RMEA:UPA6\n  \u2514 Status: Healthy\n  \u2514 Containers: 2 (2 Running, 0 Paused, 0 Stopped)\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 514.5 MiB\n  \u2514 Labels: kernelversion=3.13.0-95-generic, operatingsystem=Ubuntu 14.04.5 LTS, provider=generic, storagedriver=aufs\n  \u2514 UpdatedAt: 2016-11-23T11:49:04Z\n  \u2514 ServerVersion: 1.12.3\n node1: 192.168.33.20:2376\n  \u2514 ID: C6GI:OKAT:H2LH:VCBU:OF65:YWST:QVQ7:X6RP:6JY5:2CQK:4PVM:LVCZ\n  \u2514 Status: Healthy\n  \u2514 Containers: 1 (1 Running, 0 Paused, 0 Stopped)\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 514.5 MiB\n  \u2514 Labels: kernelversion=3.13.0-95-generic, operatingsystem=Ubuntu 14.04.5 LTS, provider=generic, storagedriver=aufs\n  \u2514 UpdatedAt: 2016-11-23T11:49:16Z\n  \u2514 ServerVersion: 1.12.3\n node2: 192.168.33.30:2376\n  \u2514 ID: IJAI:XSRL:3T5S:5XEF:AUVZ:TLYM:RVAH:MYAW:Q43J:CVCF:J5JH:BGZA\n  \u2514 Status: Healthy\n  \u2514 Containers: 1 (1 Running, 0 Paused, 0 Stopped)\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 514.5 MiB\n  \u2514 Labels: kernelversion=3.13.0-95-generic, operatingsystem=Ubuntu 14.04.5 LTS, provider=generic, storagedriver=aufs\n  \u2514 UpdatedAt: 2016-11-23T11:49:16Z\n  \u2514 ServerVersion: 1.12.3\n...\n```\n\n# \u9069\u5f53\u306a\u30b3\u30f3\u30c6\u30ca\u3092\u7acb\u3066\u3066\u307f\u308b\n\nubuntu\u3092pull\u3057\u306610\u500b\u3050\u3089\u3044\u7acb\u3066\u308b\u3002\n\n```\n$ docker pull ubuntu\n$ docker run -d ubuntu tail -f /dev/nul\n.....\n$ docker run -d ubuntu tail -f /dev/nul\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND               CREATED             STATUS              PORTS               NAMES\nadb3b7d5e716        ubuntu              \"tail -f /dev/null\"   4 seconds ago       Up 3 seconds                            node1/cocky_stallman\ndcd7f4f99864        ubuntu              \"tail -f /dev/null\"   22 seconds ago      Up 21 seconds                           node2/furious_payne\n734878f86e59        ubuntu              \"tail -f /dev/null\"   23 seconds ago      Up 22 seconds                           node1/small_ardinghelli\n0d6099e7cc05        ubuntu              \"tail -f /dev/null\"   25 seconds ago      Up 24 seconds                           node2/nauseous_hoover\nf06a02774421        ubuntu              \"tail -f /dev/null\"   26 seconds ago      Up 25 seconds                           node1/big_kare\nb24d42d433f4        ubuntu              \"tail -f /dev/null\"   29 seconds ago      Up 28 seconds                           node2/hungry_engelbart\n7daa0be7d630        ubuntu              \"tail -f /dev/null\"   54 seconds ago      Up 52 seconds                           node1/stupefied_joliot\n9ddaf2e88b93        ubuntu              \"tail -f /dev/null\"   2 seconds ago       Up 1 seconds                            manager/elated_northcutt\n66b4da48e09d        ubuntu              \"tail -f /dev/null\"   24 seconds ago      Up 23 seconds                           manager/elated_stonebraker\nbb97b9a39644        ubuntu              \"tail -f /dev/null\"   27 seconds ago      Up 26 seconds                           manager/determined_lichterman\n```\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306estrategy\u304c`spread`\u306a\u306e\u3067manager, node1, node2\u306b\u305d\u308c\u305e\u308c\u5747\u7b49\u306b\u30b3\u30f3\u30c6\u30ca\u304c\u7acb\u3063\u3066\u3044\u308b\u3002\n\n# \u53c2\u8003\n\nhttps://www.linux.com/learn/how-use-docker-machine-create-swarm-cluster\n\nhttps://docs.docker.com/swarm/provision-with-machine/\n\nhttp://qiita.com/ohhara_shiojiri/items/47e4111a81431c7cb3a7\n\nhttps://docs.docker.com/swarm/install-w-machine/\n\nhttp://blog.scottlowe.org/2015/04/19/running-etcd-backed-docker-swarm-cluster/\n\nhttps://docs.docker.com/machine/reference/create/#/specifying-docker-swarm-options-for-the-created-machine\n\nhttp://trainingdevops.com/insights-and-tutorials/building-cloud-with-etcd-docker-swarm-and-overlay-network\n\nhttps://docs.docker.com/engine/userguide/networking/get-started-overlay/#/create-a-swarm-cluster\n\nhttp://stackoverflow.com/questions/34892377/the-cluster-store-and-cluster-advertise-dont-work\n\nhttps://github.com/docker/swarm/issues/1710\n\nhttps://github.com/kubernetes/kubernetes/issues/19235\n\nhttps://docs.docker.com/swarm/discovery/\n", "tags": ["docker", "docker-swarm", "docker-machine", "etcd"]}