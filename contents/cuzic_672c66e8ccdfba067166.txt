{"tags": ["socat", "HTTPS", "openssl", "\u8a3c\u660e\u66f8"], "context": "\n\n\u3084\u308a\u305f\u304b\u3063\u305f\u3053\u3068\n\n\u793e\u5916\u3078\u306e AJAX \u901a\u4fe1\u304c\u5fc5\u8981\u3060\u3063\u305f\n\u5148\u65b9\u306e\u958b\u767a\u30b5\u30fc\u30d0\u3067 CORS (*) \u304c\u8a2d\u5b9a\u3055\u308c\u3066\u304a\u308a\u3001https://example.com/ \u306e URL \u3067\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3053\u3068\u304c\u5fc5\u8981\n\n\n\u30d6\u30e9\u30a6\u30b6\u306e\u4ed5\u69d8\u3068\u3057\u3066\u3001Access-Control-Allow-Origin \u306a\u3069\u306e\u30d8\u30c3\u30c0\u306b\u3088\u308a\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u5143\u306e URL \u304c\u9650\u5b9a\u3055\u308c\u3066\u3044\u308b\n\n\n\u958b\u767a\u3057\u3066\u3044\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u306f\u3044\u3064\u3082 localhost:3000 \u3067 HTTP \u3092\u30ea\u30c3\u30b9\u30f3\u3057\u3066\u3044\u308b\u304c\u3001\u5916\u90e8\u306b AJAX \u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30c6\u30b9\u30c8\u3082\u3084\u308a\u305f\u3044\n\u3042\u307e\u308a\u7279\u5225\u306a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306a\u3069\u306f\u9762\u5012\u306a\u306e\u3067\u3084\u3060\n\n\n\u4e88\u5099\u77e5\u8b58\n\nHTTPS \u3092\u7d42\u7aef\u3057\u305f\u4e0a\u3067\u3001HTTP \u3068\u3057\u3066 3000\u756a\u30dd\u30fc\u30c8\u306b\u8ee2\u9001\u3057\u305f\u3044\n\u3053\u306e\u51e6\u7406\u3092\u5b9f\u73fe\u3059\u308b\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306f\u7dcf\u79f0\u3057\u3066\u3001TLS Termination Proxy \u3068\u3044\u3046\nTLS Termination Proxy \u306e\u4ee3\u8868\u4f8b\u3068\u3057\u3066 Apache HTTP Server\u3001Nginx\u3001Pound\u3001hitch \u306a\u3069\u304c\u3042\u308b\n\n\n\u4eca\u56de\u3067\u306e\u624b\u6cd5\u306b\u3064\u3044\u3066\n\n\u524d\u63d0\u3068\u3057\u3066\u3044\u3064\u3082\u30ed\u30fc\u30ab\u30eb\u306e PC \u3067\u958b\u767a\u3057\u3066\u3044\u308b\n\nPound \u306f\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u5fc5\u8981\u3067\u3061\u3087\u3063\u3068\u9762\u5012\u3002\n\nhitch \u3082\u826f\u3044\u5019\u88dc\u3060\u304c\u3001\u82f1\u8a9e\u3082\u542b\u3081\u3066\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u8db3\u308a\u306a\u3044\n\u4eca\u56de\u306f\u30bd\u30b1\u30c3\u30c8\u3092\u6271\u3046\u3068\u304d\u306e swiss army knife \u3067\u3042\u308b socat \u3092\u5229\u7528\n\n\n\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u306e\u6e96\u5099\n\u4e0b\u8a18\u306e\u624b\u9806\u3067\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u3092\u6e96\u5099\u3057\u3066\u304a\u304f\u3002\n$ openssl genrsa -out server.key 1024 # RSA \u79d8\u5bc6\u9375\u306e\u751f\u6210\n$ openssl req -new -key server.key -x509 -days 3653 -out server.crt # \u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u306e\u751f\u6210\u3002\u3044\u308d\u3044\u308d\u805e\u304b\u308c\u308b\u306e\u3067\u7b54\u3048\u308b\n$ cat server.key server.crt > server.pem # \u79d8\u5bc6\u9375\u3068\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u3092\u9023\u7d50\u3057\u30661\u3064\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u3059\u308b\n$ openssl dhparam -rand - 2048 >> server.pem # DH \u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8ffd\u8a18\uff08\u3053\u308c\u3092\u3057\u306a\u3044\u3068\u5f8c\u3067\u3046\u307e\u304f\u3044\u304b\u306a\u304b\u3063\u305f\uff09\n\n\nsocat \u3092 TLS Termination Proxy \u3068\u3057\u3066\u52d5\u4f5c\u3055\u305b\u308b\n\nsocat \u3068\u306f\n\n\nnetcat \u3092\u9032\u5316\u3055\u305b\u305f\u3082\u306e\n\u3055\u307e\u3056\u307e\u306a\u30c1\u30e3\u30cd\u30eb\u9593\u3092\u53cc\u65b9\u5411\u306b\u30ea\u30ec\u30fc\u3067\u304d\u308b\n\u6a19\u6e96\u5165\u51fa\u529b\u3001\u30d5\u30a9\u30fc\u30af\u3057\u305f\u30d7\u30ed\u30bb\u30b9\u3078\u306e\u30d1\u30a4\u30d7\u3001UDP\u3001TCP\u3001SCTP\u3001\u30e6\u30cb\u30c3\u30af\u30b9\u30c9\u30e1\u30a4\u30f3\u30bd\u30b1\u30c3\u30c8\u306a\u3069\u3092\u6271\u3048\u308b\n\u8e0f\u307f\u53f0\u3001\u30d7\u30ed\u30ad\u30b7\u3068\u304b\u306b\u4ed5\u8fbc\u3080\u3068\u7d50\u69cb\u3044\u308d\u3044\u308d\u4fbf\u5229\u306a\u3053\u3068\u304c\u3067\u304d\u308b\nlibev \u306a\u3069\u306f\u4f7f\u3063\u3066\u304a\u3089\u305a\u3001\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u306f\u4f4e\u3044\n\n\n\u30b3\u30de\u30f3\u30c9\u4f8b\n$ sudo socat -vv openssl-listen:443,reuseaddr,fork,verify=0,cert=server.pem TCP4:localhost:3000 \n\n\n443 \u756a\u30dd\u30fc\u30c8\u3092\u30ea\u30c3\u30b9\u30f3\u3059\u308b\u306b\u306f sudo \u304c\u5fc5\u8981\n\nopenssl-listen:443 \u3068\u6307\u5b9a\u3059\u308b\u3068 SSL \u30bd\u30b1\u30c3\u30c8\u3092\u7d42\u7aef\u3057\u3066\u6b21\u306e\u51e6\u7406\u3092\u884c\u3048\u308b \n\nfork \u304c\u3042\u308b\u3068\u7e70\u308a\u8fd4\u3057\u3001\u30d7\u30ed\u30ad\u30b7\u51e6\u7406\u304c\u3067\u304d\u308b\u3002\uff08\u9006\u306b\u3064\u3051\u306a\u3044\u3068\uff11\u56de\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u3060\u3051\u51e6\u7406\u3092\u884c\u3046\uff09\n\nverify=0 \u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u3092\u78ba\u8a8d\u3057\u306a\u3044\u3002\n\u8ee2\u9001\u5148\u306f\u30ed\u30fc\u30ab\u30eb\u30db\u30b9\u30c8 127.0.0.1 \u306e 3000\u756a\u30dd\u30fc\u30c8\u3002\n\n\n\u52d5\u4f5c\u78ba\u8a8d\nwget \u3067\u52d5\u4f5c\u78ba\u8a8d\u3059\u308b\n$ wget -d https://localhost/ --no-check-certificate -O -\n\n\n\u4f5c\u3063\u305f\u3070\u304b\u308a\u306e\u9069\u5f53\u306a\u8a3c\u660e\u66f8\u306a\u306e\u3067\u3001 --no-check-certificate \u3092\u3064\u3051\u306a\u3044\u3068\u6012\u3089\u308c\u308b\n\n\nexample.com \u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\n\u3042\u3068\u306f\u3001\u5358\u7d14\u306b /etc/hosts \u3092\u7de8\u96c6\u3059\u308b\u3068\u5b8c\u6210\n\n/etc/hosts\n127.0.0.1   example.com\n\n\n$ wget -d https://example.com/ --no-check-certificate -O -\n\n\n\u307e\u3068\u3081\n\nHTTPS \u3092\u7d42\u7aef\u3057\u305f\u4e0a\u3067\u3001HTTP \u3068\u3057\u3066\u8ee2\u9001\u3059\u308b\u306b\u306f TLS Termination Proxy \u304c\u5fc5\u8981\n\nNginx \u3084 Pound \u306a\u3069\u3067\u3082\u3067\u304d\u308b\u304c\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u5fc5\u8981\u3067\u3001\u3061\u3068\u9762\u5012\nsocat \u306f\u3055\u307e\u3056\u307e\u306a\u30c1\u30e3\u30cd\u30eb\u3092\u30ea\u30ec\u30fc\u3057\u305f\u3044\u3068\u304d\u306e swiss army knife\n\nsocat \u3067 HTTPS \u3092\u7d42\u7aef\u3057\u3001\u3046\u3057\u308d\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u306b\u8ee2\u9001\u3067\u304d\u308b\nHAPPY HACKING!\n\n## \u3084\u308a\u305f\u304b\u3063\u305f\u3053\u3068\n* \u793e\u5916\u3078\u306e AJAX \u901a\u4fe1\u304c\u5fc5\u8981\u3060\u3063\u305f\n* \u5148\u65b9\u306e\u958b\u767a\u30b5\u30fc\u30d0\u3067 CORS (*) \u304c\u8a2d\u5b9a\u3055\u308c\u3066\u304a\u308a\u3001https://example.com/ \u306e URL \u3067\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3053\u3068\u304c\u5fc5\u8981\n  * \u30d6\u30e9\u30a6\u30b6\u306e\u4ed5\u69d8\u3068\u3057\u3066\u3001Access-Control-Allow-Origin \u306a\u3069\u306e\u30d8\u30c3\u30c0\u306b\u3088\u308a\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u5143\u306e URL \u304c\u9650\u5b9a\u3055\u308c\u3066\u3044\u308b\n* \u958b\u767a\u3057\u3066\u3044\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u306f\u3044\u3064\u3082 localhost:3000 \u3067 HTTP \u3092\u30ea\u30c3\u30b9\u30f3\u3057\u3066\u3044\u308b\u304c\u3001\u5916\u90e8\u306b AJAX \u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30c6\u30b9\u30c8\u3082\u3084\u308a\u305f\u3044\n* \u3042\u307e\u308a\u7279\u5225\u306a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306a\u3069\u306f\u9762\u5012\u306a\u306e\u3067\u3084\u3060\n\n## \u4e88\u5099\u77e5\u8b58\n* HTTPS \u3092\u7d42\u7aef\u3057\u305f\u4e0a\u3067\u3001HTTP \u3068\u3057\u3066 3000\u756a\u30dd\u30fc\u30c8\u306b\u8ee2\u9001\u3057\u305f\u3044\n* \u3053\u306e\u51e6\u7406\u3092\u5b9f\u73fe\u3059\u308b\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306f\u7dcf\u79f0\u3057\u3066\u3001[TLS Termination Proxy](https://en.wikipedia.org/wiki/TLS_termination_proxy) \u3068\u3044\u3046\n* TLS Termination Proxy \u306e\u4ee3\u8868\u4f8b\u3068\u3057\u3066 `Apache HTTP Server`\u3001`Nginx`\u3001`Pound`\u3001`hitch` \u306a\u3069\u304c\u3042\u308b\n\n## \u4eca\u56de\u3067\u306e\u624b\u6cd5\u306b\u3064\u3044\u3066\n* \u524d\u63d0\u3068\u3057\u3066\u3044\u3064\u3082\u30ed\u30fc\u30ab\u30eb\u306e PC \u3067\u958b\u767a\u3057\u3066\u3044\u308b\n* [Pound](http://www.apsis.ch/pound/) \u306f\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u5fc5\u8981\u3067\u3061\u3087\u3063\u3068\u9762\u5012\u3002\n* [hitch](https://hitch-tls.org/) \u3082\u826f\u3044\u5019\u88dc\u3060\u304c\u3001\u82f1\u8a9e\u3082\u542b\u3081\u3066\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u8db3\u308a\u306a\u3044\n* \u4eca\u56de\u306f\u30bd\u30b1\u30c3\u30c8\u3092\u6271\u3046\u3068\u304d\u306e swiss army knife \u3067\u3042\u308b [socat](http://www.dest-unreach.org/socat/) \u3092\u5229\u7528\n\n## \u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u306e\u6e96\u5099\n\n\u4e0b\u8a18\u306e\u624b\u9806\u3067\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u3092\u6e96\u5099\u3057\u3066\u304a\u304f\u3002\n\n```\n$ openssl genrsa -out server.key 1024 # RSA \u79d8\u5bc6\u9375\u306e\u751f\u6210\n$ openssl req -new -key server.key -x509 -days 3653 -out server.crt # \u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u306e\u751f\u6210\u3002\u3044\u308d\u3044\u308d\u805e\u304b\u308c\u308b\u306e\u3067\u7b54\u3048\u308b\n$ cat server.key server.crt > server.pem # \u79d8\u5bc6\u9375\u3068\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u3092\u9023\u7d50\u3057\u30661\u3064\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u3059\u308b\n$ openssl dhparam -rand - 2048 >> server.pem # DH \u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8ffd\u8a18\uff08\u3053\u308c\u3092\u3057\u306a\u3044\u3068\u5f8c\u3067\u3046\u307e\u304f\u3044\u304b\u306a\u304b\u3063\u305f\uff09\n```\n\n## `socat` \u3092 TLS Termination Proxy \u3068\u3057\u3066\u52d5\u4f5c\u3055\u305b\u308b\n\n### `socat` \u3068\u306f\n* `netcat` \u3092\u9032\u5316\u3055\u305b\u305f\u3082\u306e\n* \u3055\u307e\u3056\u307e\u306a\u30c1\u30e3\u30cd\u30eb\u9593\u3092\u53cc\u65b9\u5411\u306b\u30ea\u30ec\u30fc\u3067\u304d\u308b\n* \u6a19\u6e96\u5165\u51fa\u529b\u3001\u30d5\u30a9\u30fc\u30af\u3057\u305f\u30d7\u30ed\u30bb\u30b9\u3078\u306e\u30d1\u30a4\u30d7\u3001UDP\u3001TCP\u3001SCTP\u3001\u30e6\u30cb\u30c3\u30af\u30b9\u30c9\u30e1\u30a4\u30f3\u30bd\u30b1\u30c3\u30c8\u306a\u3069\u3092\u6271\u3048\u308b\n* \u8e0f\u307f\u53f0\u3001\u30d7\u30ed\u30ad\u30b7\u3068\u304b\u306b\u4ed5\u8fbc\u3080\u3068\u7d50\u69cb\u3044\u308d\u3044\u308d\u4fbf\u5229\u306a\u3053\u3068\u304c\u3067\u304d\u308b\n* libev \u306a\u3069\u306f\u4f7f\u3063\u3066\u304a\u3089\u305a\u3001\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u306f\u4f4e\u3044\n\n### \u30b3\u30de\u30f3\u30c9\u4f8b\n\n```\n$ sudo socat -vv openssl-listen:443,reuseaddr,fork,verify=0,cert=server.pem TCP4:localhost:3000 \n```\n\n* 443 \u756a\u30dd\u30fc\u30c8\u3092\u30ea\u30c3\u30b9\u30f3\u3059\u308b\u306b\u306f `sudo` \u304c\u5fc5\u8981\n* `openssl-listen:443` \u3068\u6307\u5b9a\u3059\u308b\u3068 SSL \u30bd\u30b1\u30c3\u30c8\u3092\u7d42\u7aef\u3057\u3066\u6b21\u306e\u51e6\u7406\u3092\u884c\u3048\u308b \n* `fork` \u304c\u3042\u308b\u3068\u7e70\u308a\u8fd4\u3057\u3001\u30d7\u30ed\u30ad\u30b7\u51e6\u7406\u304c\u3067\u304d\u308b\u3002\uff08\u9006\u306b\u3064\u3051\u306a\u3044\u3068\uff11\u56de\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u3060\u3051\u51e6\u7406\u3092\u884c\u3046\uff09\n* `verify=0` \u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u3092\u78ba\u8a8d\u3057\u306a\u3044\u3002\n* \u8ee2\u9001\u5148\u306f\u30ed\u30fc\u30ab\u30eb\u30db\u30b9\u30c8 `127.0.0.1` \u306e 3000\u756a\u30dd\u30fc\u30c8\u3002\n\n## \u52d5\u4f5c\u78ba\u8a8d\n\n`wget` \u3067\u52d5\u4f5c\u78ba\u8a8d\u3059\u308b\n\n```\n$ wget -d https://localhost/ --no-check-certificate -O -\n```\n\n* \u4f5c\u3063\u305f\u3070\u304b\u308a\u306e\u9069\u5f53\u306a\u8a3c\u660e\u66f8\u306a\u306e\u3067\u3001 `--no-check-certificate` \u3092\u3064\u3051\u306a\u3044\u3068\u6012\u3089\u308c\u308b\n\n## example.com \u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\n\u3042\u3068\u306f\u3001\u5358\u7d14\u306b `/etc/hosts` \u3092\u7de8\u96c6\u3059\u308b\u3068\u5b8c\u6210\n\n```txt:/etc/hosts\n127.0.0.1   example.com\n```\n\n\n```\n$ wget -d https://example.com/ --no-check-certificate -O -\n```\n\n\n## \u307e\u3068\u3081\n\n* HTTPS \u3092\u7d42\u7aef\u3057\u305f\u4e0a\u3067\u3001HTTP \u3068\u3057\u3066\u8ee2\u9001\u3059\u308b\u306b\u306f TLS Termination Proxy \u304c\u5fc5\u8981\n* `Nginx` \u3084 `Pound` \u306a\u3069\u3067\u3082\u3067\u304d\u308b\u304c\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u5fc5\u8981\u3067\u3001\u3061\u3068\u9762\u5012\n* socat \u306f\u3055\u307e\u3056\u307e\u306a\u30c1\u30e3\u30cd\u30eb\u3092\u30ea\u30ec\u30fc\u3057\u305f\u3044\u3068\u304d\u306e swiss army knife\n* `socat` \u3067 HTTPS \u3092\u7d42\u7aef\u3057\u3001\u3046\u3057\u308d\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u306b\u8ee2\u9001\u3067\u304d\u308b\n* HAPPY HACKING!\n"}