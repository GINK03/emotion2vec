{"context": "\n\nHAL_Driver\u3067u485\u901a\u4fe1\u3092\u5b9f\u88c5\u3059\u308b\n\nHAL_Driver\u3092\u4f7f\u3063\u3066u485\u306e\u901a\u4fe1\u3092\u5b9f\u88c5\u3057\u307e\u3059\nu485\u306e\u901a\u4fe1\u3092\u5b9f\u88c5\u3059\u308b\u5834\u5408\u306fUart\u306b\u52a0\u3048\u3066\u30d4\u30f3\u306e\u5236\u5fa1\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\n\u4f7f\u7528\u3059\u308b\u30de\u30a4\u30b3\u30f3\u306e\u4f7f\u7528\u306b\u5408\u308f\u305b\u3066\u5404\u30d4\u30f3\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u524d\u63d0\u3068\u3057\u3066\u3044\u307e\u3059\n\n\n\u74b0\u5883\n\nstm32f\u7cfb\u306e\u30de\u30a4\u30b3\u30f3\nHAL_Driver\n\n\nu485\u901a\u4fe1\u6642\u306e\u30d4\u30f3\u5236\u5fa1\n\n\u53d7\u4fe1\u6642\u306fde\u30d4\u30f3,re\u30d4\u30f3\u3092Low\u306b\u3059\u308b\n\u9001\u4fe1\u6642\u306fde\u30d4\u30f3,re\u30d4\u30f3\u3092High\u306b\u3059\u308b\n\u5404\u30d4\u30f3\u3092High\u306b\u3059\u308b\u5834\u5408\u306fre\u30d4\u30f3, de\u30d4\u30f3\u306e\u9806\u756a\u3067High\u306b\u3059\u308b\n\n\nde\u30d4\u30f3\u3060\u3051\u304cHigh\u306b\u306a\u308b\u72b6\u614b\u306b\u3057\u306a\u3044\n\n\n\n\n\u5b9f\u88c5\n\n\nUART\u3067\u4f7f\u7528\u3059\u308bTx, Rx\u306e\u30d4\u30f3\u306b\u52a0\u3048\u3066RE, DE\u306e\u30d4\u30f3\u8a2d\u5b9a\u3092OUTPUT\u306b\u8a2d\u5b9a\u3057\u307e\u3059\n\n\u30d4\u30f3\u306e\u8a2d\u5b9a\u306fCubeMX\u7b49\u3092\u4f7f\u7528\u3059\u308b\u3068\u826f\u3044\u3067\u3059\n\n\nUART\u30cf\u30f3\u30c9\u30eb\u3092\u542b\u3080\u69cb\u9020\u4f53\u3092\u5ba3\u8a00\u3057\u3066\u304a\u304f\u3068\u4fbf\u5229\u3067\u3059\n\n\ntypedef struct {\n  UART_HandleTypeDef* huart;\n  uint32_t de_pin;\n  uint32_t re_pin;\n  GPIO_TypeDef* de_port;\n  GPIO_TypeDef* re_port;\n} u485_HandleTypeDef;\n\n\n\n\u9001\u4fe1\u6642\u306f\u9001\u4fe1\u524d\u306b\u5404PIN\u3092High\u306b\u3057\u307e\u3059\n\n\n// \u30d4\u30f3\u8a2d\u5b9a\u306f\u5404\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u304f\u3060\u3055\u3044\n#define RE_PIN GPIO_PIN_XX\n#define RE_PORT GPIOB\n#define DE_PIN GPIO_PIN_XX\n#define DE_PORT GPIOB\n\n#define TIMEOUT 100\n\nvoid u485_transmit(u485_HandleTypeDef* hu485, uint8_t* tx_buffer, uint16_t tx_size) {\n  // \u9001\u4fe1\u3092\u6709\u52b9\u306b\u3059\u308b\n  HAL_GPIO_WritePin(hu485->re_port, hu485->re_pin, GPIO_PIN_SET);\n  HAL_GPIO_WritePin(hu485->de_port, hu485->de_pin, GPIO_PIN_SET);\n\n  // \u9001\u4fe1\n  HAL_UART_Transmit(hu485->huart, tx_buffer, tx_size, TIMEOUT);\n\n  // \u53d7\u4fe1\u5f85\u6a5f\u72b6\u614b\u306b\u3059\u308b\n  HAL_GPIO_WritePin(hu485->de_port, hu485->de_pin, GPIO_PIN_RESET);\n  HAL_GPIO_WritePin(hu485->re_port, hu485->re_pin, GPIO_PIN_RESET);\n}\n\nbool u485_receive(u485_HandleTypeDef* hu485, uint8_t* rx_buffer, uint16_t rx_size) {\n  // \u53d7\u4fe1\n  return HAL_UART_Receive(hu485->huart, rx_buffer, rx_size, TIMEOUT) == HAL_OK;\n}\n\n## HAL_Driver\u3067u485\u901a\u4fe1\u3092\u5b9f\u88c5\u3059\u308b\n\n* HAL_Driver\u3092\u4f7f\u3063\u3066u485\u306e\u901a\u4fe1\u3092\u5b9f\u88c5\u3057\u307e\u3059\n* u485\u306e\u901a\u4fe1\u3092\u5b9f\u88c5\u3059\u308b\u5834\u5408\u306fUart\u306b\u52a0\u3048\u3066\u30d4\u30f3\u306e\u5236\u5fa1\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\n* \u4f7f\u7528\u3059\u308b\u30de\u30a4\u30b3\u30f3\u306e\u4f7f\u7528\u306b\u5408\u308f\u305b\u3066\u5404\u30d4\u30f3\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u524d\u63d0\u3068\u3057\u3066\u3044\u307e\u3059\n\n## \u74b0\u5883\n\n* stm32f\u7cfb\u306e\u30de\u30a4\u30b3\u30f3\n* HAL_Driver\n\n## u485\u901a\u4fe1\u6642\u306e\u30d4\u30f3\u5236\u5fa1\n\n* \u53d7\u4fe1\u6642\u306fde\u30d4\u30f3,re\u30d4\u30f3\u3092Low\u306b\u3059\u308b\n* \u9001\u4fe1\u6642\u306fde\u30d4\u30f3,re\u30d4\u30f3\u3092High\u306b\u3059\u308b\n* \u5404\u30d4\u30f3\u3092High\u306b\u3059\u308b\u5834\u5408\u306fre\u30d4\u30f3, de\u30d4\u30f3\u306e\u9806\u756a\u3067High\u306b\u3059\u308b\n    * de\u30d4\u30f3\u3060\u3051\u304cHigh\u306b\u306a\u308b\u72b6\u614b\u306b\u3057\u306a\u3044\n\n## \u5b9f\u88c5\n\n* UART\u3067\u4f7f\u7528\u3059\u308bTx, Rx\u306e\u30d4\u30f3\u306b\u52a0\u3048\u3066RE, DE\u306e\u30d4\u30f3\u8a2d\u5b9a\u3092OUTPUT\u306b\u8a2d\u5b9a\u3057\u307e\u3059\n    * \u30d4\u30f3\u306e\u8a2d\u5b9a\u306fCubeMX\u7b49\u3092\u4f7f\u7528\u3059\u308b\u3068\u826f\u3044\u3067\u3059\n\n* UART\u30cf\u30f3\u30c9\u30eb\u3092\u542b\u3080\u69cb\u9020\u4f53\u3092\u5ba3\u8a00\u3057\u3066\u304a\u304f\u3068\u4fbf\u5229\u3067\u3059\n\n```c\n\ntypedef struct {\n  UART_HandleTypeDef* huart;\n  uint32_t de_pin;\n  uint32_t re_pin;\n  GPIO_TypeDef* de_port;\n  GPIO_TypeDef* re_port;\n} u485_HandleTypeDef;\n\n```\n\n* \u9001\u4fe1\u6642\u306f\u9001\u4fe1\u524d\u306b\u5404PIN\u3092High\u306b\u3057\u307e\u3059\n\n```c\n\n// \u30d4\u30f3\u8a2d\u5b9a\u306f\u5404\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u304f\u3060\u3055\u3044\n#define RE_PIN GPIO_PIN_XX\n#define RE_PORT GPIOB\n#define DE_PIN GPIO_PIN_XX\n#define DE_PORT GPIOB\n\n#define TIMEOUT 100\n\nvoid u485_transmit(u485_HandleTypeDef* hu485, uint8_t* tx_buffer, uint16_t tx_size) {\n  // \u9001\u4fe1\u3092\u6709\u52b9\u306b\u3059\u308b\n  HAL_GPIO_WritePin(hu485->re_port, hu485->re_pin, GPIO_PIN_SET);\n  HAL_GPIO_WritePin(hu485->de_port, hu485->de_pin, GPIO_PIN_SET);\n\n  // \u9001\u4fe1\n  HAL_UART_Transmit(hu485->huart, tx_buffer, tx_size, TIMEOUT);\n\n  // \u53d7\u4fe1\u5f85\u6a5f\u72b6\u614b\u306b\u3059\u308b\n  HAL_GPIO_WritePin(hu485->de_port, hu485->de_pin, GPIO_PIN_RESET);\n  HAL_GPIO_WritePin(hu485->re_port, hu485->re_pin, GPIO_PIN_RESET);\n}\n\nbool u485_receive(u485_HandleTypeDef* hu485, uint8_t* rx_buffer, uint16_t rx_size) {\n  // \u53d7\u4fe1\n  return HAL_UART_Receive(hu485->huart, rx_buffer, rx_size, TIMEOUT) == HAL_OK;\n}\n```\n", "tags": ["HAL_Driver", "\u30de\u30a4\u30b3\u30f3", "\u30d5\u30a1\u30fc\u30e0\u30a6\u30a8\u30a2"]}