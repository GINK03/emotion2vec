{"context": " More than 1 year has passed since last update.// .h\n\nclass ScissorLayer : public cocos2d::Layer\n{\npublic:\n\n    virtual void visit(\n        cocos2d::Renderer* renderer, const cocos2d::Mat4& transform, uint32_t flags) override;\n\nprivate:\n\n    cocos2d::CustomCommand _beforeVisitCmdScissor, _afterVisitCmdScissor;\n};\n\n// .cpp\n\nvoid ScissorLayer::visit(cocos2d::Renderer* renderer, const cocos2d::Mat4& transform, uint32_t flags)\n{\n    // \u30b7\u30b6\u30fc\u958b\u59cb\n    _beforeVisitCmdScissor.init(_globalZOrder);\n    _beforeVisitCmdScissor.func = [this](){\n        glEnable(GL_SCISSOR_TEST);\n\n        const cocos2d::Rect clippingRect(\n            convertToWorldSpace(cocos2d::Vec2::ZERO), getContentSize());\n\n        _director->getOpenGLView()->setScissorInPoints(\n            clippingRect.origin.x, clippingRect.origin.y,\n            clippingRect.size.width, clippingRect.size.height\n        );\n    };\n    renderer->addCommand(&_beforeVisitCmdScissor);\n\n    // \u30b7\u30fc\u30f3\u30b0\u30e9\u30d5\u51e6\u7406\n    cocos2d::Layer::visit(renderer, transform, flags);\n\n    // \u30b7\u30b6\u30fc\u7d42\u4e86\n    _afterVisitCmdScissor.init(_globalZOrder);\n    _afterVisitCmdScissor.func = [](){ glDisable(GL_SCISSOR_TEST); };\n    renderer->addCommand(&_afterVisitCmdScissor);\n}\n\n```cpp\n// .h\n\nclass ScissorLayer : public cocos2d::Layer\n{\npublic:\n\n    virtual void visit(\n        cocos2d::Renderer* renderer, const cocos2d::Mat4& transform, uint32_t flags) override;\n\nprivate:\n\n    cocos2d::CustomCommand _beforeVisitCmdScissor, _afterVisitCmdScissor;\n};\n```\n\n```cpp\n// .cpp\n\nvoid ScissorLayer::visit(cocos2d::Renderer* renderer, const cocos2d::Mat4& transform, uint32_t flags)\n{\n    // \u30b7\u30b6\u30fc\u958b\u59cb\n    _beforeVisitCmdScissor.init(_globalZOrder);\n    _beforeVisitCmdScissor.func = [this](){\n        glEnable(GL_SCISSOR_TEST);\n\n        const cocos2d::Rect clippingRect(\n            convertToWorldSpace(cocos2d::Vec2::ZERO), getContentSize());\n\n        _director->getOpenGLView()->setScissorInPoints(\n            clippingRect.origin.x, clippingRect.origin.y,\n            clippingRect.size.width, clippingRect.size.height\n        );\n    };\n    renderer->addCommand(&_beforeVisitCmdScissor);\n\n    // \u30b7\u30fc\u30f3\u30b0\u30e9\u30d5\u51e6\u7406\n    cocos2d::Layer::visit(renderer, transform, flags);\n\n    // \u30b7\u30b6\u30fc\u7d42\u4e86\n    _afterVisitCmdScissor.init(_globalZOrder);\n    _afterVisitCmdScissor.func = [](){ glDisable(GL_SCISSOR_TEST); };\n    renderer->addCommand(&_afterVisitCmdScissor);\n}\n```\n", "tags": ["cocos2d-x"]}