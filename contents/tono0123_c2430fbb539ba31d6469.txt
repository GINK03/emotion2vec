{"tags": ["rake", "Ruby", "Rails"], "context": "Shinosaka.rb Advent Calendar 21\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\u4eca\u56de\u306f\u3001Ruby on Rails\u306e\u4e2d\u3067\u4f7f\u308f\u308c\u308b Rake task\u306b\u3064\u3044\u3066\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\uff01\n\u5e74\u672b\u3068\u3044\u3046\u3053\u3068\u3067\u3001\n\u300cxxxx\u5e74\u307e\u3067\u3042\u3068xx\u65e5xx\u6642\u9593xx\u5206!\u300d\n\u3068\u6559\u3048\u3066\u304f\u308c\u308btask\u3092\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002\n\nRake task\u3068\u306f\nRuby\u306e\u4fbf\u5229\u30c4\u30fc\u30ebRake\u3002\u51e6\u7406\u5185\u5bb9\u3092\u5b9a\u7fa9\u3067\u304d\u308b\u30d3\u30eb\u30c9\u30c4\u30fc\u30eb\u3067\u3059\u3002\n\u307f\u306a\u3055\u3093\u3001\u666e\u6bb5\u958b\u767a\u3057\u3066\u3044\u3066 \u7e70\u308a\u8fd4\u3057\u5b9f\u884c\u3057\u305f\u3044\u51e6\u7406 \u3063\u3066\u3088\u304f\u3042\u308a\u307e\u305b\u3093\u304b\uff1f\n\u305d\u308c\u3092\u30b3\u30de\u30f3\u30c9\u4e00\u767a\u3067\u53e9\u3051\u305f\u3089\u5b09\u3057\u3044\uff01\n\u305d\u308c\u3092\u5b9f\u73fe\u3057\u3066\u304f\u308c\u308b\u306e\u304c\u3001rake task\u3067\u3059\u3002\n\u8a73\u3057\u3044\u6982\u8981\u306f\u3053\u3061\u3089\u3002\u500b\u4eba\u7684\u306b\u308f\u304b\u308a\u3084\u3059\u304b\u3063\u305f\n\u4eca\u56de\u306f\u3001rake task\u306e\u5b9f\u884c\u65b9\u6cd5\u3001\u5f15\u6570\u306e\u3084\u308a\u65b9\u3092\n\u4f8b\u3092\u7528\u3044\u3066\u89e3\u8aac\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u3064\u304f\u3063\u3066\u307f\u3088\u3046\n\n\u307e\u305a\u306ftask\u3092\u3064\u304f\u308b\nrails g task countdown\n\ncreate  lib/tasks/countdown.rake\n\n\u4f5c\u3089\u308c\u307e\u3057\u305f\u3002\nrake -T\n\n\u3067\u5b9f\u884c\u306e\u4ed5\u65b9\u304c\u308f\u304b\u308a\u307e\u3059\u3002\nrake countdown:run\n\u3044\u308d\u3044\u308d\u30d1\u30bf\u30fc\u30f3\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\u6642\u9593\u306e\u8a08\u7b97\u306e\u4ed5\u65b9\u306f\u3001\u79d2\u3092\u6642\u9593\u8868\u793a\u3078\u5909\u63db\u3059\u308b\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\uff01\n1.\u5b9f\u884c\u3057\u305f\u3089\u300c2017\u5e74\u307e\u3067\u3042\u3068 \u4f55\u65e5\u4f55\u6642\u9593\u4f55\u5206!\u300d\u3068\u8868\u793a\u3059\u308b\nrake countdown:run\nnamespace :countdown do\n  desc \"\u30ab\u30a6\u30f3\u30c8\u30c0\u30a6\u30f3\u3057\u307e\u3059\"\n  task run: :environment do\n    year = 2017\n    sec = (Time.zone.parse(\"#{year}-01-01 00:00:00\") - Time.now - 1.day)\n    day, sec_r = sec.divmod(86400)\n    p (Time.parse(\"1/1\") + sec_r).strftime(\"#{year}\u5e74\u307e\u3067\u3042\u3068 #{day}\u65e5%H\u6642\u9593%M\u5206!\")\n  end\nend\n\n2.\u5f15\u6570\u3067\u300cxxxx\u5e74\u307e\u3067\u300d\u3092\u6307\u5b9a\u3059\u308b ver.1\nrake countdown:run[year]\nnamespace :countdown do\n  desc \"\u30ab\u30a6\u30f3\u30c8\u30c0\u30a6\u30f3\u3057\u307e\u3059\"\n  task :run, ['year'] => :environment do |t, args|\n\n    year = 2017\n    unless args[:year].blank?\n      year = args[:year].to_i\n    end\n\n    sec = (Time.zone.parse(\"#{year}-01-01 00:00:00\") - Time.now - 1.day)\n    day, sec_r = sec.divmod(86400)\n    p (Time.parse(\"1/1\") + sec_r).strftime(\"#{year}\u5e74\u307e\u3067\u3042\u3068 #{day}\u65e5%H\u6642\u9593%M\u5206!\")\n  end\nend\n\n3.\u5f15\u6570\u3067\u300cxxxx\u5e74\u307e\u3067\u300d\u3092\u6307\u5b9a\u3059\u308b ver.2\nENV \u306b\u5909\u3048\u305f\u3060\u3051\u3067\u3059\u304c..\nrake countdown:run year=xxxx\nnamespace :countdown do\n  desc \"\u30ab\u30a6\u30f3\u30c8\u30c0\u30a6\u30f3\u3057\u307e\u3059\"\n    task run: :environment do\n\n    year = 2017\n    unless ENV['year'].blank?\n      year = ENV['year'].to_i\n    end\n\n    sec = (Time.zone.parse(\"#{year}-01-01 00:00:00\") - Time.now - 1.day)\n    day, sec_r = sec.divmod(86400)\n    p (Time.parse(\"1/1\") + sec_r).strftime(\"#{year}\u5e74\u307e\u3067\u3042\u3068 #{day}\u65e5%H\u6642\u9593%M\u5206!\")\n  end\nend\n\n4.yes,no\u5224\u5b9a\u3092\u3064\u3051\u3066\u307f\u307e\u3057\u305f\nbundle exec 'rake countdown:run[2019]'\nnamespace :countdown do\n  desc \"\u30ab\u30a6\u30f3\u30c8\u30c0\u30a6\u30f3\u3057\u307e\u3059\"\n  task :run, ['year'] => :environment do |t, args|\n\n    year = 2017\n    unless args[:year].blank?\n      year = args[:year].to_i\n    end\n\n    STDOUT.puts \"Calculate from #{Time.now.strftime('%Y/%m/%d')} to #{year}/1/1. Is it OK? (y/N)\"\n    if STDIN.gets.strip == 'y'\n      show_future_days(year)\n    end\n  end\nend\n\ndef show_future_days(year)\n  sec = (Time.zone.parse(\"#{year}-01-01 00:00:00\") - Time.now - 1.day)\n  day, sec_r = sec.divmod(86400)\n  p (Time.parse(\"1/1\") + sec_r).strftime(\"#{year}\u5e74\u307e\u3067\u3042\u3068 #{day}\u65e5%H\u6642\u9593%M\u5206!\")\nend\n\n\u5b9f\u884c\u3059\u308b\u3068\u3001\nbundle exec 'rake countdown:run[2018]'\nCalculate from 2016/12/19 to 2018/1/1. Is it OK? (y/N)\ny\n\"2018\u5e74\u307e\u3067\u3042\u3068 376\u65e516\u6642\u959304\u5206!\"\n\n\n\u3061\u306a\u307f\u306b\n\u4eca\u306f\u3001\nyear = 2017 \u3067\u56fa\u5b9a\u3057\u3066\u3044\u307e\u3059\u304c\n\u6765\u5e74\u4ee5\u964d\u306f\nyear = Date.current.next_year.year\n\u3068\u3057\u305f\u3089\u4f7f\u3048\u307e\u3059(^o^)\n\n\u307e\u3068\u3081\nrake task\u306f\u7e70\u308a\u8fd4\u3057\u5b9f\u884c\u3057\u305f\u3044\u51e6\u7406\u3092\u307e\u3068\u3081\u308b\u306e\u306b\u3068\u3063\u3066\u3082\u4fbf\u5229\u3067\u3059\u3002\n2017\u5e74\u307e\u3067\u3042\u3068\u4f55\u65e5\u3067\u3057\u3087\u3046\uff1f\n\u3088\u3044\u304a\u3068\u3057\u3092\u301c(\u309c\u2200\u309c)\nShinosaka.rb Advent Calendar 21\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\u4eca\u56de\u306f\u3001Ruby on Rails\u306e\u4e2d\u3067\u4f7f\u308f\u308c\u308b Rake task\u306b\u3064\u3044\u3066\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\uff01\n\n\u5e74\u672b\u3068\u3044\u3046\u3053\u3068\u3067\u3001\n`\u300cxxxx\u5e74\u307e\u3067\u3042\u3068xx\u65e5xx\u6642\u9593xx\u5206!\u300d`\n\u3068\u6559\u3048\u3066\u304f\u308c\u308btask\u3092\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002\n\n### Rake task\u3068\u306f\nRuby\u306e\u4fbf\u5229\u30c4\u30fc\u30ebRake\u3002\u51e6\u7406\u5185\u5bb9\u3092\u5b9a\u7fa9\u3067\u304d\u308b\u30d3\u30eb\u30c9\u30c4\u30fc\u30eb\u3067\u3059\u3002\n\n\u307f\u306a\u3055\u3093\u3001\u666e\u6bb5\u958b\u767a\u3057\u3066\u3044\u3066 *\u7e70\u308a\u8fd4\u3057\u5b9f\u884c\u3057\u305f\u3044\u51e6\u7406* \u3063\u3066\u3088\u304f\u3042\u308a\u307e\u305b\u3093\u304b\uff1f\n\u305d\u308c\u3092\u30b3\u30de\u30f3\u30c9\u4e00\u767a\u3067\u53e9\u3051\u305f\u3089\u5b09\u3057\u3044\uff01\n\u305d\u308c\u3092\u5b9f\u73fe\u3057\u3066\u304f\u308c\u308b\u306e\u304c\u3001rake task\u3067\u3059\u3002\n\n[\u8a73\u3057\u3044\u6982\u8981\u306f\u3053\u3061\u3089\u3002\u500b\u4eba\u7684\u306b\u308f\u304b\u308a\u3084\u3059\u304b\u3063\u305f](http://rubicle.net/rubicle_talk_1-1.html)\n\n\u4eca\u56de\u306f\u3001rake task\u306e\u5b9f\u884c\u65b9\u6cd5\u3001\u5f15\u6570\u306e\u3084\u308a\u65b9\u3092\n\u4f8b\u3092\u7528\u3044\u3066\u89e3\u8aac\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n### \u3064\u304f\u3063\u3066\u307f\u3088\u3046\n\n#### \u307e\u305a\u306ftask\u3092\u3064\u304f\u308b\n\n```\nrails g task countdown\n```\n\n```\ncreate  lib/tasks/countdown.rake\n```\n\u4f5c\u3089\u308c\u307e\u3057\u305f\u3002\n\n```\nrake -T\n```\n\u3067\u5b9f\u884c\u306e\u4ed5\u65b9\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n`rake countdown:run`\n\n\u3044\u308d\u3044\u308d\u30d1\u30bf\u30fc\u30f3\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\u6642\u9593\u306e\u8a08\u7b97\u306e\u4ed5\u65b9\u306f\u3001[\u79d2\u3092\u6642\u9593\u8868\u793a\u3078\u5909\u63db\u3059\u308b](http://qiita.com/riocampos/items/2c4e4a9b45ad83a0bdc7)\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\uff01\n\n1.\u5b9f\u884c\u3057\u305f\u3089\u300c2017\u5e74\u307e\u3067\u3042\u3068 \u4f55\u65e5\u4f55\u6642\u9593\u4f55\u5206!\u300d\u3068\u8868\u793a\u3059\u308b\n\n`rake countdown:run`\n\n```\nnamespace :countdown do\n  desc \"\u30ab\u30a6\u30f3\u30c8\u30c0\u30a6\u30f3\u3057\u307e\u3059\"\n  task run: :environment do\n    year = 2017\n    sec = (Time.zone.parse(\"#{year}-01-01 00:00:00\") - Time.now - 1.day)\n    day, sec_r = sec.divmod(86400)\n    p (Time.parse(\"1/1\") + sec_r).strftime(\"#{year}\u5e74\u307e\u3067\u3042\u3068 #{day}\u65e5%H\u6642\u9593%M\u5206!\")\n  end\nend\n```\n\n2.\u5f15\u6570\u3067\u300cxxxx\u5e74\u307e\u3067\u300d\u3092\u6307\u5b9a\u3059\u308b ver.1\n\n`rake countdown:run[year]`\n\n```\nnamespace :countdown do\n  desc \"\u30ab\u30a6\u30f3\u30c8\u30c0\u30a6\u30f3\u3057\u307e\u3059\"\n  task :run, ['year'] => :environment do |t, args|\n\n    year = 2017\n    unless args[:year].blank?\n      year = args[:year].to_i\n    end\n\n    sec = (Time.zone.parse(\"#{year}-01-01 00:00:00\") - Time.now - 1.day)\n    day, sec_r = sec.divmod(86400)\n    p (Time.parse(\"1/1\") + sec_r).strftime(\"#{year}\u5e74\u307e\u3067\u3042\u3068 #{day}\u65e5%H\u6642\u9593%M\u5206!\")\n  end\nend\n```\n\n3.\u5f15\u6570\u3067\u300cxxxx\u5e74\u307e\u3067\u300d\u3092\u6307\u5b9a\u3059\u308b ver.2\n\n`ENV` \u306b\u5909\u3048\u305f\u3060\u3051\u3067\u3059\u304c..\n\n`rake countdown:run year=xxxx`\n\n```\nnamespace :countdown do\n  desc \"\u30ab\u30a6\u30f3\u30c8\u30c0\u30a6\u30f3\u3057\u307e\u3059\"\n    task run: :environment do\n\n    year = 2017\n    unless ENV['year'].blank?\n      year = ENV['year'].to_i\n    end\n\n    sec = (Time.zone.parse(\"#{year}-01-01 00:00:00\") - Time.now - 1.day)\n    day, sec_r = sec.divmod(86400)\n    p (Time.parse(\"1/1\") + sec_r).strftime(\"#{year}\u5e74\u307e\u3067\u3042\u3068 #{day}\u65e5%H\u6642\u9593%M\u5206!\")\n  end\nend\n```\n\n4.yes,no\u5224\u5b9a\u3092\u3064\u3051\u3066\u307f\u307e\u3057\u305f\n\n`bundle exec 'rake countdown:run[2019]'`\n\n```\nnamespace :countdown do\n  desc \"\u30ab\u30a6\u30f3\u30c8\u30c0\u30a6\u30f3\u3057\u307e\u3059\"\n  task :run, ['year'] => :environment do |t, args|\n\n    year = 2017\n    unless args[:year].blank?\n      year = args[:year].to_i\n    end\n\n    STDOUT.puts \"Calculate from #{Time.now.strftime('%Y/%m/%d')} to #{year}/1/1. Is it OK? (y/N)\"\n    if STDIN.gets.strip == 'y'\n      show_future_days(year)\n    end\n  end\nend\n\ndef show_future_days(year)\n  sec = (Time.zone.parse(\"#{year}-01-01 00:00:00\") - Time.now - 1.day)\n  day, sec_r = sec.divmod(86400)\n  p (Time.parse(\"1/1\") + sec_r).strftime(\"#{year}\u5e74\u307e\u3067\u3042\u3068 #{day}\u65e5%H\u6642\u9593%M\u5206!\")\nend\n```\n\n\u5b9f\u884c\u3059\u308b\u3068\u3001\n\n```\nbundle exec 'rake countdown:run[2018]'\nCalculate from 2016/12/19 to 2018/1/1. Is it OK? (y/N)\ny\n\"2018\u5e74\u307e\u3067\u3042\u3068 376\u65e516\u6642\u959304\u5206!\"\n```\n\n### \u3061\u306a\u307f\u306b\n\n\u4eca\u306f\u3001\n`year = 2017` \u3067\u56fa\u5b9a\u3057\u3066\u3044\u307e\u3059\u304c\n\n\u6765\u5e74\u4ee5\u964d\u306f\n`year = Date.current.next_year.year`\n\n\u3068\u3057\u305f\u3089\u4f7f\u3048\u307e\u3059(^o^)\n\n### \u307e\u3068\u3081\n\nrake task\u306f\u7e70\u308a\u8fd4\u3057\u5b9f\u884c\u3057\u305f\u3044\u51e6\u7406\u3092\u307e\u3068\u3081\u308b\u306e\u306b\u3068\u3063\u3066\u3082\u4fbf\u5229\u3067\u3059\u3002\n\n2017\u5e74\u307e\u3067\u3042\u3068\u4f55\u65e5\u3067\u3057\u3087\u3046\uff1f\n\u3088\u3044\u304a\u3068\u3057\u3092\u301c(\u309c\u2200\u309c)\n"}