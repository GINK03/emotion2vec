{"context": "\n\nsetjmp()\u3068longjmp()\nC\u306b\u306fsetjmp()\u3068longjmp()\u3068\u3044\u3046\u6050\u308d\u3057\u3044\u95a2\u6570\u30da\u30a2\u304c\u5b58\u5728\u3059\u308b\u3002\u3053\u306e2\u3064\u306e\u95a2\u6570\u306f\u5927\u57df\u8131\u51fa (non-local exit)\u3068\u3044\u3046\u6700\u8fd1\u3042\u307e\u308a\u805e\u304b\u306a\u3044\u6a5f\u80fd\u3092\u63d0\u4f9b\u3059\u308b\u3002\u3053\u306e\u8a18\u4e8b\u306f\u3053\u306e\u6050\u308d\u3057\u3044\u5927\u57df\u8131\u51fa\u306e\u95a2\u6570\u30da\u30a2\u306b\u95a2\u3059\u308b\u30dd\u30a8\u30e0\u3067\u3042\u308b\u3002\n\u5927\u57df\u8131\u51fa\u3068\u306f\u4f55\u304b\u3002\u3056\u3063\u304f\u308a\u8aac\u660e\u3059\u308b\u3068\u3001setjmp()\u3092\u5b9f\u884c\u3059\u308c\u3070\u5f8c\u3067longjmp()\u3092\u5b9f\u884c\u3057\u305f\u3089\u5f37\u5236\u7684\u306b\u95a2\u6570\u3084\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u30b9\u30b3\u30fc\u30d7\u306b\u95a2\u4fc2\u306a\u304f\u623b\u3063\u3066\u304d\u3066\u3057\u307e\u3046\u3068\u3044\u3046\u3001\u304b\u306a\u308a\u5f37\u5f15\u306a\u4ee3\u7269\u3067\u3042\u308b\u3002\n\n\u5927\u57df\u8131\u51fa\u3092\u3069\u3046\u3084\u3063\u3066\u3084\u308b\u306e\u304b\nsetjmp(env)\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u300c\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u300d\u3092jmp_buf\u3068\u3044\u3046\u578b\u306e\u5909\u6570env\u306b\u4fdd\u5b58\u3057\u3066\u3001\u30bc\u30ed\u304c\u8fd4\u308b\u3002\u3053\u3053\u307e\u3067\u306f\u307e\u3042\u666e\u901a\u3067\u3042\u308b\u3002\n\u4e00\u65b9\u3001env\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u4ed6\u306e\u95a2\u6570\u5185\u3067longjmp(env, val)\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001env\u3092\u8a2d\u5b9a\u3057\u305fsetjmp(env)\u307e\u3067\u623b\u3063\u3066\u3001val\u304c\u8fd4\u3063\u3066\u304f\u308b\u3068\u3044\u3046\u50cd\u304d\u3092\u3059\u308b\u3002\u4e00\u4f8b\u3068\u3057\u3066\u306f\u3001\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u3042\u308b\u3002\njmp_buf env;\n\nvoid f1(void)\n{\n  // \u51e6\u7406\u3092\u3059\u308b\n  longjmp(env, 1) // \u3053\u3053\u3067setjmp()\u306e\u5834\u6240\u306b\u623b\u3063\u30661\u304c\u8fd4\u3063\u3066\u304f\u308b\n  // \u3053\u306e\u5148\u306e\u30b3\u30fc\u30c9\u306f\u5b9f\u884c\u3055\u308c\u306a\u3044\n}\n\nvoid f2(void)\n{\n  // \u51e6\u7406\u3092\u3059\u308b\uff08\u30d6\u30ed\u30c3\u30afA\u3068\u3059\u308b\uff09\n  if (setjmp(env) == 0) {\n    // \u305d\u306e\u307e\u307e\u30d6\u30ed\u30c3\u30afA\u304b\u3089\u306e\u51e6\u7406\u304c\u7d9a\u304f\n  } else {\n    // longjmp\u304c\u547c\u3070\u308c\u305f\u5f8c\u306e\u51e6\u7406\u3092\u3059\u308b\n  }\n}\n\n\u306a\u3093\u3067\u3053\u3093\u306a\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u304b\u3002\u305d\u308c\u306fjmp_buf\u578b\u306e\u5909\u6570\u306b\u3001\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u542b\u3080\u30ec\u30b8\u30b9\u30bf\u3092\u5168\u90e8\u5165\u308c\u3066\u3044\u308b\u304b\u3089\u3060\u3002\u3053\u308c\u306fC\u3060\u3051\u3067\u306f\u3067\u304d\u306a\u3044\u3002FreeBSD\u306e\u8a72\u5f53\u90e8\u5206\u306b\u3042\u308blib/libstand/amd64/_setjmp.S\u3092\u898b\u3066\u307f\u3088\u3046\u3002\u305d\u3046\u3001\u3053\u308c\u306f\u30a2\u30bb\u30f3\u30d6\u30ea\u8a00\u8a9e\u306e\u30d5\u30a1\u30a4\u30eb\u3060\u3002\uff08Syntax sugar\u3092\u4f7f\u3046\u305f\u3081\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u5206\u5272\u3057\u3066\u3044\u308b\u3002\uff09\u305d\u3057\u3066\u3001\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u4f9d\u5b58\u3067\u3042\u308b\u3002\n/*-\n * Copyright (c) 1990 The Regents of the University of California.\n * All rights reserved.\n *\n * This code is derived from software contributed to Berkeley by\n * William Jolitz.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n * 1. Redistributions of source code must retain the above copyright\n *    notice, this list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright\n *    notice, this list of conditions and the following disclaimer in the\n *    documentation and/or other materials provided with the distribution.\n * 4. Neither the name of the University nor the names of its contributors\n *    may be used to endorse or promote products derived from this software\n *    without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS\n * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)\n * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT\n * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY\n * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\n * SUCH DAMAGE.\n */\n\n#if defined(LIBC_SCCS) && !defined(lint)\n    .asciz \"@(#)_setjmp.s   5.1 (Berkeley) 4/23/90\"\n#endif /* LIBC_SCCS and not lint */\n#include <machine/asm.h>\n__FBSDID(\"$FreeBSD$\");\n\n/*\n * C library -- _setjmp, _longjmp\n *\n *  _longjmp(a,v)\n * will generate a \"return(v)\" from the last call to\n *  _setjmp(a)\n * by restoring registers from the environment 'a'.\n * The previous signal state is NOT restored.\n */\n\nENTRY(_setjmp)\n    movq    %rdi,%rax\n    movq    0(%rsp),%rdx        /* retval */\n    movq    %rdx, 0(%rax)       /* 0; retval */\n    movq    %rbx, 8(%rax)       /* 1; rbx */\n    movq    %rsp,16(%rax)       /* 2; rsp */\n    movq    %rbp,24(%rax)       /* 3; rbp */\n    movq    %r12,32(%rax)       /* 4; r12 */\n    movq    %r13,40(%rax)       /* 5; r13 */\n    movq    %r14,48(%rax)       /* 6; r14 */\n    movq    %r15,56(%rax)       /* 7; r15 */\n    fnstcw  64(%rax)        /* 8; fpu cw */\n    stmxcsr 68(%rax)        /*    and mxcsr */\n    xorq    %rax,%rax\n    ret\nEND(_setjmp)\n\n    .weak   CNAME(_longjmp)\nENTRY(_longjmp)\n    movq    %rdi,%rdx\n    /* Restore the mxcsr, but leave exception flags intact. */\n    stmxcsr -4(%rsp)\n    movl    68(%rdx),%eax\n    andl    $0xffffffc0,%eax\n    movl    -4(%rsp),%edi\n    andl    $0x3f,%edi\n    xorl    %eax,%edi\n    movl    %edi,-4(%rsp)\n    ldmxcsr -4(%rsp)\n    movq    %rsi,%rax       /* retval */\n    movq    0(%rdx),%rcx\n    movq    8(%rdx),%rbx\n    movq    16(%rdx),%rsp\n    movq    24(%rdx),%rbp\n    movq    32(%rdx),%r12\n    movq    40(%rdx),%r13\n    movq    48(%rdx),%r14\n    movq    56(%rdx),%r15\n    fldcw   64(%rdx)\n    testq   %rax,%rax\n    jnz 1f\n    incq    %rax\n1:  movq    %rcx,0(%rsp)\n    ret\nEND(_longjmp)\n\n\u4e0a\u8a18\u3092\u3056\u3063\u3068\u898b\u308c\u3070\u5206\u304b\u308b\u3068\u601d\u3046\u304c\u3001\u3068\u306b\u304b\u304f\u5fc5\u8981\u306a\u30ec\u30b8\u30b9\u30bf\u3092\u30bb\u30fc\u30d6\u3057\u305f\u308a\u3001\u30ea\u30b9\u30c8\u30a2\u3057\u305f\u308a\u3057\u3066\u623b\u3063\u3066\u3044\u308b\u3060\u3051\u3067\u3042\u308b\u3002\u305d\u308c\u3060\u3051\u306e\u4f5c\u696d\u3057\u304b\u3057\u3066\u3044\u306a\u3044\u95a2\u6570\u3067\u3042\u308b\u304c\u3001\u3053\u3046\u3059\u308b\u3053\u3068\u3067\u3001\u3044\u308f\u3070\u5f37\u5236\u7684\u306b\u5b9f\u884c\u74b0\u5883\u3092\u5f15\u304d\u623b\u3057\u3066\u3057\u307e\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\u5b9f\u969b\u306b\u306f\u3053\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u4ed6\u306b\u30b7\u30b0\u30ca\u30eb\u30de\u30b9\u30af\u3082\u9000\u907f\u3057\u305f\u308a\u5fa9\u65e7\u3057\u305f\u308a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u304c\u3001\u3053\u306e\u3078\u3093\u306e\u7d30\u304b\u3044\u8a71\u306b\u3064\u3044\u3066\u306fFreeBSD\u306esetjmp(3)\u306e\u30de\u30cb\u30e5\u30a2\u30eb\u3092\u53c2\u7167\u3057\u3066\u6b32\u3057\u3044\u3002\n\n\u30b2\u30fc\u30e0\u306e\u7d42\u4e86\u306b\u5927\u57df\u8131\u51fa\u3092\u308f\u3056\u308f\u3056\u4f7f\u3063\u3066\u3044\u308b\u4f8b\n\u305d\u306e\u6614BSD\u306e\u30b9\u30bf\u30fc\u30c8\u30ec\u30c3\u30afbsdtrek\u3092Lua\u7248\u306b\u308f\u3056\u308f\u3056\u66f8\u304d\u63db\u3048\u308b\u3068\u3044\u3046\u4f5c\u696d\u3092\u3084\u3063\u3066\u3044\u305f\u3053\u3068\u304c\u3042\u3063\u305f\u3002\u305d\u306e\u6642\u306b\u5927\u3044\u306b\u9a5a\u3044\u3066\u3057\u307e\u3063\u305f\u306e\u304c\u3001\u306a\u3093\u3068\u5927\u57df\u8131\u51fa\u3092\u30b2\u30fc\u30e0\u306e\u7d42\u4e86\u5224\u5b9a\u5f8c\u306e\u52d5\u4f5c\u306b\u4f7f\u3063\u3066\u3044\u305f\u3053\u3068\u3067\u3042\u3063\u305f\u3002\u30e1\u30a4\u30f3\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u8a72\u5f53\u90e8\u5206\u306e\u30bd\u30fc\u30b9\u3092\u898b\u3066\u307f\u3088\u3046\u3002\n\nmain.c\u3088\u308a\u629c\u7c8b\n    if (setjmp(env)) { // setjmp()\u306e\u7d50\u679c\u304c0\u3067\u306a\u3044\u3068\u304d\u306f\u3053\u3061\u3089\n        // \u3064\u307e\u308alongjmp()\u304c\u547c\u3070\u308c\u308b\u3068\u3053\u3053\u306b\u623b\u3063\u3066\u304f\u308b\n        if ( !getynpar(\"Another game\") )\n            exit(0);\n    }\n    do { // setjmp()\u306e\u7d50\u679c\u304c0\u3067\u3042\u308c\u3070\u3053\u3061\u3089\u306b\u623b\u3063\u3066\u304f\u308b\n        setup();\n        play();\n    } while (getynpar(\"Another game\"));\n\n\n\u30b2\u30fc\u30e0\u305d\u306e\u3082\u306e\u306fplay()\u3068\u3044\u3046\u95a2\u6570\u3067\u5b9f\u884c\u3055\u308c\u308b\u306e\u3060\u304c\u3001\u4eee\u306b\u30b2\u30fc\u30e0\u9014\u4e2d\u3067\u4f55\u3089\u304b\u306e\u7406\u7531\u3067\u52dd\u6557\u304c\u6c7a\u3057\u305f\u5834\u5408\u306f\u3001longjmp()\u3067\u3053\u306e\u30eb\u30fc\u30d7\u306b\u5f37\u5236\u7684\u306b\u623b\u3063\u3066\u304f\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u3002\u3061\u306a\u307f\u306b\u52dd\u3063\u305f\u6642\u3082\u8ca0\u3051\u305f\u6642\u3082\u3001\n    // \u3053\u3053\u307e\u3067\u306b\u51e6\u7406\u3092\u7d42\u3048\u3066\u304a\u304f\n    skiptonl(0); // \u6539\u884c\u8868\u793a\u3057\u3066\n    longjmp(env, 1); // \u3053\u306elongjmp\u3067main.c\u307e\u3067\u306f\u308b\u3070\u308b\u5f37\u5236\u7684\u306b\u623b\u308b\n\n\u3068\u3044\u3046\u3053\u3068\u3092\u3084\u3063\u3066\u3044\u308b\u3002\n\u3053\u306e\u30b3\u30fc\u30c9\u3092\u6700\u521d\u306b\u898b\u305f\u6642\u306f\u3001\u306a\u3093\u3068\u3082\u5927\u80c6\u306a\u3053\u3068\u3092\u3084\u3063\u3066\u3044\u308b\u3082\u306e\u3060\u3068\u3001\u500b\u4eba\u7684\u306b\u306f\u306e\u3051\u305e\u3063\u3066\u3057\u307e\u3063\u305f\u3002\n\u3061\u306a\u307f\u306b\u79c1\u304c\u66f8\u304d\u76f4\u3057\u305fLua\u7248\u3067\u306f\u3082\u3046\u3061\u3087\u3063\u3068\u7a4f\u5065\u306a\u66f8\u304d\u65b9\u3092\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\u6bd4\u8f03\u306e\u305f\u3081\u306b\u8a72\u5f53\u30b3\u30fc\u30c9\u3092\u5f15\u7528\u3057\u3066\u304a\u304f\u3002Lua\u3067\u306f\u4f8b\u5916\u51e6\u7406\u306fxpcall()\u306e\u4e2d\u3067\u6355\u6349\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u3002\u5927\u57df\u8131\u51fa\u306f\u4f8b\u5916\u51e6\u7406\u3067\u3042\u308b\u3053\u3068\u3092\u8003\u3048\u308c\u3070\u3001\u30cf\u30f3\u30c9\u30e9\u3092\u5225\u306b\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u3067\u3053\u306e\u3088\u3046\u306b\u30b3\u30fc\u30c9\u306e\u7bc4\u56f2\u3092\u9650\u5b9a\u3057\u3066\u66f8\u3051\u308b\u306f\u305a\u3067\u3042\u308b\uff08\u3057\u3001\u305d\u306e\u3088\u3046\u306b\u66f8\u304b\u306d\u3070\u306a\u3089\u306a\u3044\u3060\u308d\u3046\u300121\u4e16\u7d00\u306e\u73fe\u4ee3\u306a\u3089\uff09\u3002\n\nplay.lua\u304b\u3089\u306e\u629c\u7c8b\n--- The Main program: call this function to start the game\nfunction M.main()\n    -- @todo No command option needed?\n    printf(\"\\nLuatrek version %s\\n\", V.Luatrek_version)\n    printf(\"Use 'license' command to show the license\\n\\n\")\n    -- Enable trace\n    V.Trace = true\n    local again = true\n    while again do\n        -- exception caught inside the xpcall\n        local status, handler = xpcall(function ()\n            -- play the game\n            trek.setup.setup()\n            M.play()\n            end,\n            -- error handler function\n            function (err)\n                if err.code == \"ENDOFGAME\" then\n                    return false\n                else\n                    -- dump stacktrace then crash\n                    return debug.traceback(err)\n                end\n            end)\n        -- end-of-game handling\n        if not status and not handler then\n            -- end of game exception\n            printf(\"\\nLuatrek: game over\\n\")\n            again = trek.getpar.getynpar(\"Another game\")\n        else\n            -- status shouldn't be true because M.play() is an infinite loop\n            -- so this should be a general error, crash it\n            error(handler)\n            -- NOTREACHED\n        end\n    end\n    return\nend\n\n\n\nC\u3067\u306e\u4f8b\u5916\u51e6\u7406\nC\u3067\u4ed6\u306e\u8a00\u8a9e\u98a8\u306etry-catch\u51e6\u7406\u3092\u3059\u308b\u305f\u3081\u306b\u3001\u5c02\u7528\u306e\u30de\u30af\u30ed\u3092\u7528\u610f\u3057\u305f\u4f8b\u306f\u78ba\u304b\u306b\u3042\u308b\u3002\u305f\u3060\u3001\u3084\u307f\u304f\u3082\u306bsetjmp()\u3084longjmp()\u3092\u4f7f\u3046\u306e\u304c\u672c\u5f53\u306b\u826f\u3044\u30b3\u30fc\u30c9\u306a\u306e\u304b\u3069\u3046\u304b\u306f\u308f\u304b\u3089\u306a\u3044\u3002\n\u4f8b\u5916\u3068\u3044\u3048\u3070\u3001Java\u306e\u691c\u67fb\u4f8b\u5916\u306e\u3088\u3046\u306a\u51e6\u7406\u3092\u3059\u308b\u30b3\u30fc\u30c9\u3092C\u3067\u66f8\u3044\u3066\u3042\u308b\u306e\u306f\u5be1\u805e\u306b\u3057\u3066\u898b\u305f\u3053\u3068\u304c\u306a\u3044\u3002\u79c1\u304c\u4e0d\u52c9\u5f37\u306a\u306e\u3060\u308d\u3046\u3068\u601d\u3046\u304c\u3002C\u306e\u5834\u5408\u306f\u3001\u4f8b\u5916\u3068\u3044\u3046\u3088\u308a\u306f\u3001\u623b\u308a\u5024\u3067\u8fd4\u3063\u3066\u304d\u305f\u30a8\u30e9\u30fc\u3092\u4e00\u3064\u4e00\u3064\u30c1\u30a7\u30c3\u30af\u3057\u3066\u51e6\u7406\u3059\u308b\u3068\u3044\u3046\u3001\u3044\u308f\u3086\u308b\u9632\u885b\u7684\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0(defensive programming)\u3092\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u306e\u3060\u3068\u500b\u4eba\u7684\u306b\u306f\u601d\u3063\u3066\u3044\u308b\u3002\n\nsetjmp/longjmp\u306e\u5b9f\u884c\u306b\u3042\u305f\u3063\u3066\u306e\u6ce8\u610f\u70b9\n\u5b9f\u884c\u30b3\u30f3\u30c6\u30af\u30b9\u30c8\u3092\u9000\u907f\u3057\u305f\u308a\u623b\u3057\u305f\u308a\u3059\u308b\u3068\u306f\u3044\u3048\u3001\u305d\u306e\u9593\u306b\u767a\u751f\u3057\u305f\u526f\u4f5c\u7528\u304c\u623b\u3063\u3066\u304d\u3066\u3069\u3046\u306a\u308b\u304b\u306b\u3064\u3044\u3066\u306f\u3001\u4e00\u5207\u4fdd\u8a3c\u3055\u308c\u3066\u3044\u306a\u3044\u3002\u524d\u8ff0\u306esetjmp(3)\u306e\u30de\u30cb\u30e5\u30a2\u30eb\u306b\u306f\n\nAll accessible objects have values as of the time longjmp() routine was\n     called, except that the values of objects of automatic storage invocation\n     duration that do not have the volatile type and have been changed between\n     the setjmp() invocation and longjmp() call are indeterminate.\n\n\u3064\u307e\u308a\uff08\u8a33\u306e\u6587\u8cac\u306f\u3053\u306e\u8a18\u4e8b\u306e\u7b46\u8005\uff09\n\n\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u5168\u90e8longjmp()\u304c\u547c\u3070\u308c\u305f\u6642\u306e\u5024\u306b\u306a\u308b\u304c\u3001\u81ea\u52d5\u5909\u6570\u3067volatile\u578b\u306b\u306a\u3063\u3066\u3044\u306a\u3044\u3082\u306e\u3001\u305d\u3057\u3066setjmp()\u306e\u5b9f\u884c\u3068longjmp()\u306e\u547c\u51fa\u306e\u9593\u306b\u5185\u5bb9\u304c\u5909\u308f\u3063\u3066\u3044\u308b\u3082\u306e\u306b\u3064\u3044\u3066\u306e\u5024\u306f\u4e0d\u5b9a\u3067\u3042\u308b\u3002\n\n\u3068\u66f8\u3044\u3066\u3042\u308b\u3002\u3053\u308c\u306f\u307e\u3042\u5f53\u7136\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\n\u307e\u3068\u3081\u3068\u611f\u60f3\nC\u306esetjmp()\u3068longjmp()\u306b\u3064\u3044\u3066\u306e\u500b\u4eba\u7684\u306a\u96d1\u611f\u3092\u66f8\u3044\u305f\u3002\u3053\u3093\u306a\u6a5f\u80fd\u306b\u983c\u3089\u306a\u304f\u3066\u6e08\u3080\u3088\u3046\u306a\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3092\u5fc3\u304c\u3051\u305f\u3044\u304c\u3001\u5b9f\u969b\u306eC\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u306f\u610f\u5916\u306b\u4f7f\u308f\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u3042\u308b\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u306a\u6a5f\u80fd\u3067\u306f\u3042\u308b\u3002\n\n\u53c2\u8003\u6587\u732e\n\u65e5\u672c\u8a9e\u3067\u306e\u8a73\u8aac\u8a18\u4e8b\u306f\u300clongjmp\u3068\u4f8b\u5916\u300d\u304c\u79c0\u9038\u3067\u3042\u308b\u3002\u3053\u306e\u8a18\u4e8b\u3067\u8aac\u660e\u3057\u3066\u3044\u306a\u3044\u3053\u3068\u306b\u3064\u3044\u3066\u3001\u7d30\u304b\u304f\u66f8\u304b\u308c\u3066\u3044\u308b\u3002\u307e\u305f\u540c\u3058\u7b46\u8005\u306e\u300c\u30b7\u30b0\u30ca\u30eb\u3068\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u300d\u3082\u8aad\u3093\u3067\u3044\u3066\u53c2\u8003\u306b\u306a\u308b\u3002\n## setjmp()\u3068longjmp()\n\nC\u306b\u306f`setjmp()`\u3068`longjmp()`\u3068\u3044\u3046\u6050\u308d\u3057\u3044\u95a2\u6570\u30da\u30a2\u304c\u5b58\u5728\u3059\u308b\u3002\u3053\u306e2\u3064\u306e\u95a2\u6570\u306f**\u5927\u57df\u8131\u51fa** (non-local exit)\u3068\u3044\u3046\u6700\u8fd1\u3042\u307e\u308a\u805e\u304b\u306a\u3044\u6a5f\u80fd\u3092\u63d0\u4f9b\u3059\u308b\u3002\u3053\u306e\u8a18\u4e8b\u306f\u3053\u306e\u6050\u308d\u3057\u3044\u5927\u57df\u8131\u51fa\u306e\u95a2\u6570\u30da\u30a2\u306b\u95a2\u3059\u308b\u30dd\u30a8\u30e0\u3067\u3042\u308b\u3002\n\n\u5927\u57df\u8131\u51fa\u3068\u306f\u4f55\u304b\u3002\u3056\u3063\u304f\u308a\u8aac\u660e\u3059\u308b\u3068\u3001`setjmp()`\u3092\u5b9f\u884c\u3059\u308c\u3070\u5f8c\u3067`longjmp()`\u3092\u5b9f\u884c\u3057\u305f\u3089\u5f37\u5236\u7684\u306b\u95a2\u6570\u3084\b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u30b9\u30b3\u30fc\u30d7\u306b\u95a2\u4fc2\u306a\u304f\u623b\u3063\u3066\u304d\u3066\u3057\u307e\u3046\u3068\u3044\u3046\u3001\u304b\u306a\u308a\u5f37\u5f15\u306a\u4ee3\u7269\u3067\u3042\u308b\u3002\n\n## \u5927\u57df\u8131\u51fa\u3092\u3069\u3046\u3084\u3063\u3066\u3084\u308b\u306e\u304b\n\n`setjmp(env)`\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u300c\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u300d\u3092`jmp_buf`\u3068\u3044\u3046\u578b\u306e\u5909\u6570`env`\u306b\u4fdd\u5b58\u3057\u3066\u3001\u30bc\u30ed\u304c\u8fd4\u308b\u3002\u3053\u3053\u307e\u3067\u306f\u307e\u3042\u666e\u901a\u3067\u3042\u308b\u3002\n\n\u4e00\u65b9\u3001\b`env`\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u4ed6\u306e\u95a2\u6570\u5185\u3067`longjmp(env, val)`\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001`env`\u3092\u8a2d\u5b9a\u3057\u305f`setjmp(env)`\u307e\u3067\u623b\u3063\u3066\u3001`val`\u304c\u8fd4\u3063\u3066\u304f\u308b\u3068\u3044\u3046\u50cd\u304d\u3092\u3059\u308b\u3002\u4e00\u4f8b\u3068\u3057\u3066\u306f\u3001\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u3042\u308b\u3002\n\n```c\njmp_buf env;\n\nvoid f1(void)\n{\n  // \u51e6\u7406\u3092\u3059\u308b\n  longjmp(env, 1) // \u3053\u3053\u3067setjmp()\u306e\u5834\u6240\u306b\u623b\u3063\u30661\u304c\u8fd4\u3063\u3066\u304f\u308b\n  // \u3053\u306e\u5148\u306e\u30b3\u30fc\u30c9\u306f\u5b9f\u884c\u3055\u308c\u306a\u3044\n}\n\nvoid f2(void)\n{\n  // \u51e6\u7406\u3092\u3059\u308b\uff08\u30d6\u30ed\u30c3\u30afA\u3068\u3059\u308b\uff09\n  if (setjmp(env) == 0) {\n    // \u305d\u306e\u307e\u307e\u30d6\u30ed\u30c3\u30afA\u304b\u3089\u306e\u51e6\u7406\u304c\u7d9a\u304f\n  } else {\n    // longjmp\u304c\u547c\u3070\u308c\u305f\u5f8c\u306e\u51e6\u7406\u3092\u3059\u308b\n  }\n}\n```\n\n\u306a\u3093\u3067\u3053\u3093\u306a\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u304b\u3002\u305d\u308c\u306f`jmp_buf`\u578b\u306e\u5909\u6570\u306b\u3001\b\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u542b\u3080\u30ec\u30b8\u30b9\u30bf\u3092\u5168\u90e8\u5165\u308c\u3066\u3044\u308b\u304b\u3089\u3060\u3002\u3053\u308c\u306fC\u3060\u3051\u3067\u306f\u3067\u304d\u306a\u3044\u3002[FreeBSD\u306e\u8a72\u5f53\u90e8\u5206](https://svnweb.freebsd.org/base/head/lib/libstand/amd64/_setjmp.S?revision=244537&view=co)\u306b\u3042\u308b`lib/libstand/amd64/_setjmp.S`\u3092\u898b\u3066\u307f\u3088\u3046\u3002\u305d\u3046\u3001\u3053\u308c\u306f\u30a2\u30bb\u30f3\u30d6\u30ea\u8a00\u8a9e\u306e\u30d5\u30a1\u30a4\u30eb\u3060\u3002\uff08Syntax sugar\u3092\u4f7f\u3046\u305f\u3081\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u5206\u5272\u3057\u3066\u3044\u308b\u3002\uff09\u305d\u3057\u3066\u3001\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u4f9d\u5b58\u3067\u3042\u308b\u3002\n\n```C\n/*-\n * Copyright (c) 1990 The Regents of the University of California.\n * All rights reserved.\n *\n * This code is derived from software contributed to Berkeley by\n * William Jolitz.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n * 1. Redistributions of source code must retain the above copyright\n *    notice, this list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright\n *    notice, this list of conditions and the following disclaimer in the\n *    documentation and/or other materials provided with the distribution.\n * 4. Neither the name of the University nor the names of its contributors\n *    may be used to endorse or promote products derived from this software\n *    without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS\n * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)\n * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT\n * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY\n * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\n * SUCH DAMAGE.\n */\n```\n```gas\n#if defined(LIBC_SCCS) && !defined(lint)\n\t.asciz \"@(#)_setjmp.s\t5.1 (Berkeley) 4/23/90\"\n#endif /* LIBC_SCCS and not lint */\n#include <machine/asm.h>\n__FBSDID(\"$FreeBSD$\");\n```\n```C\n/*\n * C library -- _setjmp, _longjmp\n *\n *\t_longjmp(a,v)\n * will generate a \"return(v)\" from the last call to\n *\t_setjmp(a)\n * by restoring registers from the environment 'a'.\n * The previous signal state is NOT restored.\n */\n```\n```gas\nENTRY(_setjmp)\n\tmovq\t%rdi,%rax\n\tmovq\t0(%rsp),%rdx\t\t/* retval */\n\tmovq\t%rdx, 0(%rax)\t\t/* 0; retval */\n\tmovq\t%rbx, 8(%rax)\t\t/* 1; rbx */\n\tmovq\t%rsp,16(%rax)\t\t/* 2; rsp */\n\tmovq\t%rbp,24(%rax)\t\t/* 3; rbp */\n\tmovq\t%r12,32(%rax)\t\t/* 4; r12 */\n\tmovq\t%r13,40(%rax)\t\t/* 5; r13 */\n\tmovq\t%r14,48(%rax)\t\t/* 6; r14 */\n\tmovq\t%r15,56(%rax)\t\t/* 7; r15 */\n\tfnstcw\t64(%rax)\t\t/* 8; fpu cw */\n\tstmxcsr\t68(%rax)\t\t/*    and mxcsr */\n\txorq\t%rax,%rax\n\tret\nEND(_setjmp)\n\n\t.weak\tCNAME(_longjmp)\nENTRY(_longjmp)\n\tmovq\t%rdi,%rdx\n\t/* Restore the mxcsr, but leave exception flags intact. */\n\tstmxcsr\t-4(%rsp)\n\tmovl\t68(%rdx),%eax\n\tandl\t$0xffffffc0,%eax\n\tmovl\t-4(%rsp),%edi\n\tandl\t$0x3f,%edi\n\txorl\t%eax,%edi\n\tmovl\t%edi,-4(%rsp)\n\tldmxcsr -4(%rsp)\n\tmovq\t%rsi,%rax\t\t/* retval */\n\tmovq\t0(%rdx),%rcx\n\tmovq\t8(%rdx),%rbx\n\tmovq\t16(%rdx),%rsp\n\tmovq\t24(%rdx),%rbp\n\tmovq\t32(%rdx),%r12\n\tmovq\t40(%rdx),%r13\n\tmovq\t48(%rdx),%r14\n\tmovq\t56(%rdx),%r15\n\tfldcw\t64(%rdx)\n\ttestq\t%rax,%rax\n\tjnz\t1f\n\tincq\t%rax\n1:\tmovq\t%rcx,0(%rsp)\n\tret\nEND(_longjmp)\n```\n\n\u4e0a\u8a18\u3092\u3056\u3063\u3068\u898b\u308c\u3070\u5206\u304b\u308b\u3068\u601d\u3046\u304c\u3001\u3068\u306b\u304b\u304f\u5fc5\u8981\u306a\u30ec\u30b8\u30b9\u30bf\u3092\u30bb\u30fc\u30d6\u3057\u305f\u308a\u3001\u30ea\u30b9\u30c8\u30a2\u3057\u305f\u308a\u3057\u3066\u623b\u3063\u3066\u3044\u308b\u3060\u3051\u3067\u3042\u308b\u3002\u305d\u308c\u3060\u3051\u306e\u4f5c\u696d\u3057\u304b\u3057\u3066\u3044\u306a\u3044\u95a2\u6570\u3067\u3042\u308b\u304c\u3001\u3053\u3046\u3059\u308b\u3053\u3068\u3067\u3001\u3044\u308f\u3070\u5f37\u5236\u7684\u306b\u5b9f\u884c\u74b0\u5883\u3092\u5f15\u304d\u623b\u3057\u3066\u3057\u307e\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n\u5b9f\u969b\u306b\u306f\u3053\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u4ed6\u306b\u30b7\u30b0\u30ca\u30eb\u30de\u30b9\u30af\u3082\u9000\u907f\u3057\u305f\u308a\u5fa9\u65e7\u3057\b\u305f\u308a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u304c\u3001\u3053\u306e\u3078\u3093\u306e\u7d30\u304b\u3044\u8a71\u306b\u3064\u3044\u3066\u306f[FreeBSD\u306esetjmp(3)\u306e\u30de\u30cb\u30e5\u30a2\u30eb](https://www.freebsd.org/cgi/man.cgi?query=setjmp&sektion=3)\u3092\u53c2\u7167\u3057\u3066\u6b32\u3057\u3044\u3002\n\n## \u30b2\u30fc\u30e0\u306e\u7d42\u4e86\u306b\u5927\u57df\u8131\u51fa\u3092\u308f\u3056\u308f\u3056\u4f7f\u3063\u3066\u3044\u308b\u4f8b\n\n\u305d\u306e\u6614BSD\u306e\u30b9\u30bf\u30fc\u30c8\u30ec\u30c3\u30af[bsdtrek](https://github.com/jj1bdx/bsdtrek/)\u3092[Lua\u7248](https://github.com/jj1bdx/luatrek/)\u306b\u308f\u3056\u308f\u3056\u66f8\u304d\u63db\u3048\u308b\u3068\u3044\u3046\u4f5c\u696d\u3092\u3084\u3063\u3066\u3044\u305f\u3053\u3068\u304c\u3042\u3063\u305f\u3002\u305d\u306e\u6642\u306b\b\u5927\u3044\u306b\u9a5a\u3044\u3066\u3057\u307e\u3063\u305f\u306e\u304c\u3001\u306a\u3093\u3068**\u5927\u57df\u8131\u51fa\u3092\u30b2\u30fc\u30e0\u306e\u7d42\u4e86\u5224\u5b9a\u5f8c\u306e\u52d5\u4f5c\u306b\u4f7f\u3063\u3066\u3044\u305f**\u3053\u3068\u3067\u3042\u3063\u305f\u3002[\u30e1\u30a4\u30f3\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u8a72\u5f53\u90e8\u5206\u306e\u30bd\u30fc\u30b9](https://github.com/jj1bdx/bsdtrek/blob/bsdtrek_dragonflybsd_3.8.1/main.c#L173L180)\u3092\u898b\u3066\u307f\u3088\u3046\u3002\n\n```C:main.c\u3088\u308a\u629c\u7c8b\n\tif (setjmp(env)) { // setjmp()\u306e\u7d50\u679c\u304c0\u3067\u306a\u3044\u3068\u304d\u306f\u3053\u3061\u3089\n\t\t// \u3064\u307e\u308alongjmp()\u304c\u547c\u3070\u308c\u308b\u3068\u3053\u3053\u306b\u623b\u3063\u3066\u304f\u308b\n\t\tif ( !getynpar(\"Another game\") )\n\t\t\texit(0);\n\t}\n\tdo { // setjmp()\u306e\u7d50\u679c\u304c0\u3067\u3042\u308c\u3070\u3053\u3061\u3089\u306b\u623b\u3063\u3066\u304f\u308b\n\t\tsetup();\n\t\tplay();\n\t} while (getynpar(\"Another game\"));\n```\n\n\u30b2\u30fc\u30e0\u305d\u306e\u3082\u306e\u306f`play()`\u3068\u3044\u3046\u95a2\u6570\u3067\u5b9f\u884c\u3055\b\u308c\u308b\u306e\u3060\u304c\u3001\b\u4eee\u306b\u30b2\u30fc\u30e0\u9014\u4e2d\u3067\u4f55\u3089\u304b\u306e\u7406\u7531\u3067\u52dd\u6557\u304c\u6c7a\u3057\u305f\u5834\u5408\u306f\u3001`longjmp()`\u3067\u3053\u306e\u30eb\u30fc\u30d7\u306b**\u5f37\u5236\u7684\u306b\u623b\u3063\u3066\u304f\u308b**\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u3002\u3061\u306a\u307f\u306b\u52dd\u3063\u305f\u6642\u3082\u8ca0\u3051\u305f\u6642\u3082\u3001\n\n```C\n\t// \u3053\u3053\u307e\u3067\u306b\u51e6\u7406\u3092\u7d42\u3048\u3066\u304a\u304f\n\tskiptonl(0); // \u6539\u884c\u8868\u793a\u3057\u3066\n\tlongjmp(env, 1); // \u3053\u306elongjmp\u3067main.c\u307e\u3067\u306f\u308b\u3070\u308b\u5f37\u5236\u7684\u306b\u623b\u308b\n```\n\n\u3068\u3044\u3046\u3053\u3068\u3092\u3084\u3063\u3066\u3044\u308b\u3002\n\n\u3053\u306e\u30b3\u30fc\u30c9\u3092\u6700\u521d\u306b\u898b\u305f\u6642\u306f\u3001\u306a\u3093\u3068\u3082\u5927\u80c6\u306a\u3053\u3068\u3092\u3084\u3063\u3066\u3044\u308b\u3082\u306e\u3060\u3068\u3001\u500b\u4eba\u7684\u306b\u306f\u306e\u3051\u305e\u3063\u3066\u3057\u307e\u3063\u305f\u3002\n\n\u3061\u306a\u307f\u306b\u79c1\u304c\u66f8\u304d\u76f4\u3057\u305fLua\u7248\u3067\u306f\u3082\u3046\u3061\u3087\u3063\u3068\u7a4f\u5065\u306a\u66f8\u304d\u65b9\u3092\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\u6bd4\u8f03\u306e\u305f\u3081\u306b[\u8a72\u5f53\u30b3\u30fc\u30c9\u3092\u5f15\u7528\u3057\u3066\u304a\u304f](https://github.com/jj1bdx/luatrek/blob/pre-0.2-20140220/lua/trek/play.lua#L172L209)\u3002Lua\u3067\u306f\u4f8b\u5916\u51e6\u7406\u306f`xpcall()`\u306e\u4e2d\u3067\u6355\u6349\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u3002\u5927\u57df\u8131\u51fa\u306f\u4f8b\u5916\u51e6\u7406\u3067\u3042\u308b\u3053\u3068\u3092\u8003\u3048\u308c\u3070\u3001\u30cf\u30f3\u30c9\u30e9\u3092\u5225\u306b\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u3067\u3053\u306e\u3088\u3046\u306b\u30b3\u30fc\u30c9\u306e\u7bc4\u56f2\u3092\u9650\u5b9a\u3057\u3066\u66f8\u3051\u308b\u306f\u305a\u3067\u3042\u308b\uff08\u3057\u3001\u305d\u306e\u3088\u3046\u306b\u66f8\u304b\u306d\u3070\u306a\u3089\u306a\u3044\u3060\u308d\u3046\u300121\u4e16\u7d00\u306e\u73fe\u4ee3\u306a\u3089\uff09\u3002\n\n```Lua:play.lua\u304b\u3089\u306e\u629c\u7c8b\n--- The Main program: call this function to start the game\nfunction M.main()\n    -- @todo No command option needed?\n    printf(\"\\nLuatrek version %s\\n\", V.Luatrek_version)\n    printf(\"Use 'license' command to show the license\\n\\n\")\n    -- Enable trace\n    V.Trace = true\n    local again = true\n    while again do\n        -- exception caught inside the xpcall\n        local status, handler = xpcall(function ()\n            -- play the game\n            trek.setup.setup()\n            M.play()\n            end,\n            -- error handler function\n            function (err)\n                if err.code == \"ENDOFGAME\" then\n                    return false\n                else\n                    -- dump stacktrace then crash\n                    return debug.traceback(err)\n                end\n            end)\n        -- end-of-game handling\n        if not status and not handler then\n            -- end of game exception\n            printf(\"\\nLuatrek: game over\\n\")\n            again = trek.getpar.getynpar(\"Another game\")\n        else\n            -- status shouldn't be true because M.play() is an infinite loop\n            -- so this should be a general error, crash it\n            error(handler)\n            -- NOTREACHED\n        end\n    end\n    return\nend\n```\n\n## C\u3067\u306e\u4f8b\u5916\u51e6\u7406\n\n[C\u3067\u4ed6\u306e\u8a00\u8a9e\u98a8\u306etry-catch\u51e6\u7406\u3092\u3059\u308b\u305f\u3081\u306b\u3001\u5c02\u7528\u306e\u30de\u30af\u30ed\u3092\u7528\u610f\u3057\u305f\u4f8b\u306f\u78ba\u304b\u306b\u3042\u308b](http://www.di.unipi.it/~nids/docs/longjump_try_trow_catch.html)\u3002\u305f\u3060\u3001\u3084\u307f\u304f\u3082\u306b`setjmp()`\u3084`longjmp()`\u3092\u4f7f\u3046\u306e\u304c\u672c\u5f53\u306b\u826f\u3044\u30b3\u30fc\u30c9\u306a\u306e\u304b\u3069\u3046\u304b\u306f\u308f\u304b\u3089\u306a\u3044\u3002\n\n\u4f8b\u5916\u3068\u3044\u3048\u3070\u3001[Java\u306e\u691c\u67fb\u4f8b\u5916](http://qiita.com/irxground/items/614cac8e6c50d0a80652)\u306e\u3088\u3046\u306a\u51e6\u7406\u3092\u3059\u308b\u30b3\u30fc\u30c9\u3092C\u3067\u66f8\u3044\u3066\u3042\u308b\u306e\u306f\u5be1\u805e\u306b\u3057\u3066\u898b\u305f\u3053\u3068\u304c\u306a\u3044\u3002\u79c1\u304c\u4e0d\u52c9\u5f37\u306a\u306e\u3060\u308d\u3046\u3068\u601d\u3046\u304c\u3002\bC\u306e\u5834\u5408\u306f\u3001\u4f8b\u5916\u3068\u3044\u3046\u3088\u308a\u306f\u3001\u623b\u308a\u5024\u3067\u8fd4\u3063\u3066\u304d\u305f\u30a8\u30e9\u30fc\u3092\u4e00\u3064\u4e00\u3064\u30c1\u30a7\u30c3\u30af\u3057\u3066\u51e6\u7406\u3059\u308b\u3068\u3044\u3046\u3001\u3044\u308f\u3086\u308b\b\u9632\u885b\b\u7684\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0(defensive programming)\u3092\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u306e\u3060\u3068\u500b\u4eba\u7684\u306b\u306f\u601d\u3063\u3066\u3044\u308b\u3002\n\n## setjmp/longjmp\u306e\u5b9f\u884c\u306b\u3042\u305f\u3063\u3066\u306e\u6ce8\u610f\u70b9\n\n\u5b9f\u884c\u30b3\u30f3\u30c6\u30af\u30b9\u30c8\u3092\u9000\u907f\u3057\u305f\u308a\u623b\u3057\u305f\u308a\u3059\u308b\u3068\u306f\u3044\u3048\u3001\u305d\u306e\u9593\u306b\u767a\u751f\u3057\u305f\u526f\u4f5c\u7528\u304c\u623b\u3063\u3066\u304d\u3066\u3069\u3046\u306a\u308b\u304b\u306b\u3064\u3044\u3066\u306f\u3001\u4e00\u5207\u4fdd\u8a3c\u3055\u308c\u3066\u3044\u306a\u3044\u3002\u524d\u8ff0\u306e`setjmp(3)`\u306e\u30de\u30cb\u30e5\u30a2\u30eb\u306b\u306f\n\n>All accessible objects have values as of the time longjmp() routine was\n     called, except that the values of objects of automatic storage invocation\n     duration that do not have the volatile type and have been changed between\n     the setjmp() invocation and longjmp() call are indeterminate.\n\n\u3064\u307e\u308a\uff08\u8a33\u306e\u6587\u8cac\u306f\u3053\u306e\u8a18\u4e8b\u306e\u7b46\u8005\uff09\n\n> \u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u5168\u90e8`longjmp()`\u304c\u547c\u3070\u308c\u305f\u6642\u306e\u5024\u306b\u306a\u308b\u304c\u3001\u81ea\u52d5\b\u5909\u6570\u3067`volatile`\u578b\u306b\u306a\u3063\u3066\u3044\u306a\u3044\u3082\u306e\u3001\u305d\u3057\u3066`setjmp()`\u306e\u5b9f\u884c\u3068`longjmp()`\u306e\u547c\u51fa\u306e\u9593\u306b\u5185\u5bb9\u304c\u5909\u308f\u3063\u3066\u3044\u308b\u3082\u306e\u306b\u3064\u3044\u3066\u306e\u5024\u306f**\u4e0d\u5b9a**\u3067\u3042\u308b\u3002\n\n\u3068\u66f8\u3044\u3066\u3042\u308b\u3002\u3053\u308c\u306f\u307e\u3042\u5f53\u7136\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\n## \u307e\u3068\u3081\u3068\u611f\u60f3\n\nC\u306e`setjmp()`\u3068`longjmp()`\u306b\u3064\u3044\u3066\u306e\u500b\u4eba\u7684\u306a\u96d1\u611f\u3092\u66f8\u3044\u305f\u3002\u3053\u3093\u306a\u6a5f\u80fd\u306b\u983c\u3089\u306a\u304f\u3066\u6e08\u3080\u3088\u3046\u306a\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3092\u5fc3\u304c\u3051\u305f\u3044\u304c\u3001\u5b9f\u969b\u306eC\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u306f\u610f\u5916\u306b\u4f7f\u308f\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u3042\u308b\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u306a\u6a5f\u80fd\u3067\u306f\u3042\u308b\u3002\n\n## \u53c2\u8003\u6587\u732e\n\n\u65e5\u672c\u8a9e\u3067\u306e\u8a73\u8aac\u8a18\u4e8b\u306f\u300c[longjmp\u3068\u4f8b\u5916](http://www.nurs.or.jp/~sug/soft/super/longjmp.htm)\u300d\u304c\u79c0\u9038\u3067\u3042\u308b\u3002\u3053\u306e\u8a18\u4e8b\u3067\u8aac\u660e\u3057\u3066\u3044\u306a\u3044\u3053\u3068\u306b\u3064\u3044\u3066\u3001\b\u7d30\u304b\u304f\u66f8\u304b\u308c\u3066\u3044\u308b\u3002\u307e\u305f\u540c\u3058\u7b46\u8005\u306e\u300c[\u30b7\u30b0\u30ca\u30eb\u3068\u30b3\u30fc\u30eb\u30d0\u30c3\u30af](http://www.nurs.or.jp/~sug/soft/super/signal.htm)\u300d\u3082\u8aad\u3093\u3067\u3044\u3066\u53c2\u8003\u306b\u306a\u308b\u3002\n\n", "tags": ["\u4f8b\u5916\u51e6\u7406", "C\u8a00\u8a9e", "C", "\u30dd\u30a8\u30e0"]}