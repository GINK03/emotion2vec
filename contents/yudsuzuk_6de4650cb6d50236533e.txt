{"context": "PHP\u3067\u4f7f\u3048\u308b\u30ec\u30b3\u30e1\u30f3\u30c9\u30a8\u30f3\u30b8\u30f3\u306f\u3044\u304f\u3064\u304b\u5b58\u5728\u3057\u307e\u3059\u304c\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u4e0d\u8db3\u3060\u3063\u305f\u308a\u3001\u975e\u63a8\u5968\u306a\u95a2\u6570\u304c\u4f7f\u308f\u308c\u3066\u3044\u305f\u308a\u3067\u6e80\u8db3\u3044\u304f\u3082\u306e\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u3067\u3059\u306e\u3067\u3001\u81ea\u5206\u3067\u5b9f\u88c5\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\u203b2016/08/25\u8ffd\u8a18 \u30e9\u30a4\u30d6\u30e9\u30ea\u5316\u3057\u307e\u3057\u305f\uff01\nhttps://github.com/YuzuruS/redis-recommend\npackagist\u306b\u767b\u9332\u3082\u3057\u3066\u3042\u308b\u306e\u3067\u3001composer\u3092\u4f7f\u3063\u3066\u7c21\u5358\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u307e\u3059\u3002\n\ncomposer.json\n{\n    \"require\": {\n       \"yuzuru-s/redis-recommend\": \"1.0.*\"\n    }\n}\n\n\n\n\u5354\u8abf\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u578b\u30ec\u30b3\u30e1\u30f3\u30c9\u3068\u306f\uff1f\n\u4eca\u56de\u5b9f\u88c5\u3059\u308b\u5354\u8abf\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u578b\u30ec\u30b3\u30e1\u30f3\u30c9\u3068\u306f\u3001Amazon\u306b\u3042\u308b\u30b3\u30ec\u2193\u3067\u3059\u3002\n\n\u305f\u3068\u3048\u3070\u4ee5\u4e0b\u306e\u30c7\u30fc\u30bf\u304c\u3042\u3063\u305f\u3068\u3057\u307e\u3059\u3002\n\n\n\n\u540d\u524d\n\u672c1\n\u672c2\n\u672c3\n\n\n\n\nA\u3055\u3093\n1\n1\n1\n\n\nB\u3055\u3093\n1\n1\n-\n\n\n\nA\u3055\u3093\u304c\u672c1\u3001\u672c2\u3001\u672c3\u3092\u95b2\u89a7\u3057\u307e\u3057\u305f\u3002\nB\u3055\u3093\u304c\u672c1\u3001\u672c2\u3092\u95b2\u89a7\u3057\u307e\u3057\u305f\u3002\nA\u3055\u3093B\u3055\u3093\u3068\u3082\u306b\u672c1,\u672c2\u3092\u95b2\u89a7\u3057\u3066\u3044\u308b\u306e\u3067\u3001C\u3055\u3093\u304c\u672c1\u3092\u95b2\u89a7\u3057\u305f\u6642\u306b\u3001\u672c2\u3092\u30ec\u30b3\u30e1\u30f3\u30c9\u3059\u308b\u3002\u3068\u3044\u3046\u4ed5\u7d44\u307f\u3067\u3059\u3002\n\u4e0a\u8a18\u306f\u6570\u304c\u5c11\u306a\u3044\u306e\u3067\u898b\u305f\u76ee\u3067\u5206\u304b\u308a\u307e\u3059\u304c\u3001\u5b9f\u969b\u306e\u30b5\u30fc\u30d3\u30b9\u306f\u5546\u54c1\u306e\u6570\u304c\u5727\u5012\u7684\u306b\u591a\u3044\u306e\u3067\u3001\u985e\u4f3c\u5ea6\u3092\u8a08\u7b97\u3057\u3066\u9ad8\u3044\u9806\u304b\u3089\u30ec\u30b3\u30e1\u30f3\u30c9\u3057\u307e\u3059\u3002\n\nJaccard(\u30b8\u30e3\u30c3\u30ab\u30fc\u30c9)\u6307\u6570\n\u985e\u4f3c\u5ea6\u306e\u8a08\u7b97\u3067\u306fJaccard(\u30b8\u30e3\u30c3\u30ab\u30fc\u30c9)\u6307\u6570\u3092\u4f7f\u3046\u306e\u304c\u4e00\u822c\u7684\u306a\u3088\u3046\u3067\u3059\u3002\nA\u3068B\u305d\u308c\u305e\u308c\u3092\u96c6\u5408\u3068\u3059\u308b\u3068\u3001Jaccard(\u30b8\u30e3\u30c3\u30ab\u30fc\u30c9)\u6307\u6570\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3067\u304d\u307e\u3059\u3002\nJaccard(A,B) = \\frac{|A\u2229B|}{|A\u222aB|}\n$${Jaccard(A,B) = \\frac{|A\u2229B|}{|A\u222aB|}\n}$$\n\u3053\u306e\u8a08\u7b97\u5f0f\u3092\u4f7f\u3063\u3066\u4e0b\u8a18\u306e\u30c7\u30fc\u30bf\u3092\u8a08\u7b97\u3059\u308b\u3068\n\n\u672c1\u3068\u672c2\u3092\u4e21\u65b9\u8cfc\u5165\u3057\u305f\u4eba\u306fE\u3055\u30931\u540d (A\u2229B)\n\u672c1\u3082\u3057\u304f\u306f\u672c2\u3092\u8cfc\u5165\u3057\u305f\u4eba\u306fA,B,C,D,E\u306e5\u540d (A\u222aB)\n\n\u4ee5\u4e0a\u3088\u308a\u672c1\u3068\u672c2\u306e\u985e\u4f3c\u5ea6\u306f0.2\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n\n\u540d\u524d\nA\u3055\u3093\nB\u3055\u3093\nC\u3055\u3093\nD\u3055\u3093\nE\u3055\u3093\nF\u3055\u3093\nG\u3055\u3093\n\n\n\n\n\u672c1\n1\n-\n1\n-\n1\n-\n-\n\n\n\u672c2\n-\n1\n-\n1\n1\n-\n-\n\n\n\n\nPHP+Redis\u306b\u3088\u308b\u5b9f\u88c5\nRedis\u306b\u306f\u53d6\u308a\u51fa\u3057\u3084\u3059\u3044\u4fbf\u5229\u306a\u578bSortedSet\u304c\u3042\u308b\u306e\u3067\u305d\u308c\u3092\u985e\u4f3c\u5ea6\u306e\u4fdd\u5b58\u306b\u4f7f\u3044\u307e\u3059\u3002\n\n\u5546\u54c1\u95b2\u89a7\u3092\u8a18\u9332\n\naddViewer.php\n\n/**\n * $item_id => \u5546\u54c1ID\n * $user_id => \u30e6\u30fc\u30b6\u30fcID\n */ \n$Redis->lRem('Viewer:Item:' . $item_id, $user_id);\n$Redis->lPush('Viewer:Item:' . $item_id, $user_id);\n$Redis->lTrim('Viewer:Item:' . $item_id, 0, 999); // 1000\u500b\u4ee5\u964d\u524a\u9664 \u8a18\u9332\u3059\u308b\u5546\u54c1\u3084\u9867\u5ba2\u6570\u304c\u5897\u3048\u308b\u3068\u8a08\u7b97\u91cf\u304c\u7206\u767a\u3057\u3066\u6b7b\u306c\u306e\u3067\u3002\n\n\n\n\nJaccard(\u30b8\u30e3\u30c3\u30ab\u30fc\u30c9)\u6307\u6570\u3092\u8a08\u7b97\n\ncalc.php\n\n/**\n * $item_ids => \u5546\u54c1ID\u306e\u914d\u5217 [1,2,3,4,5]\u306e\u3088\u3046\u306a\u914d\u5217\n */\n\nforeach ($item_ids as $item_id1) {\n    $base = $Redis->lRange('Viewer:Item:' . $item_id1, 0, 999);\n    if (count($base) === 0) {\n        continue;\n    }\n    foreach ($item_ids as $item_id2) {\n        if ($item_id1 === $item_id2) {\n            continue;\n        }\n        $target = $Redis->lRange('Viewer:Item:' . $item_id2, 0, 999);\n        if (count($target) === 0) {\n            continue;\n        }\n\n        # \u30b8\u30e3\u30c3\u30ab\u30fc\u30c9\u6307\u6570\u3092\u8a08\u7b97\n        $join = floatval(count(array_unique(array_merge($base, $target))));\n        $intersect = floatval(count(array_intersect($base, $target)));\n        if ($intersect == 0 || $join == 0) {\n            continue;\n        }\n        $jaccard = $intersect / $join;\n\n        $Redis->zAdd('Jaccard:Item:' . $item_id1, $jaccard, $item_id2);\n    }\n}\n\n\n\n\n\u30ec\u30b3\u30e1\u30f3\u30c9\u5546\u54c1id\u306e\u53d6\u5f97\n\ngetRecommend.php\n$Redis->zRevRange('Jaccard:Item:' . $item_id, 0, -1);\n\n\n\n\u53c2\u8003\u8a18\u4e8b\nhttp://qiita.com/haminiku/items/cdbf8eb488e0cf6a62fe\n\nPHP\u3067\u4f7f\u3048\u308b\u30ec\u30b3\u30e1\u30f3\u30c9\u30a8\u30f3\u30b8\u30f3\u306f\u3044\u304f\u3064\u304b\u5b58\u5728\u3057\u307e\u3059\u304c\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u4e0d\u8db3\u3060\u3063\u305f\u308a\u3001\u975e\u63a8\u5968\u306a\u95a2\u6570\u304c\u4f7f\u308f\u308c\u3066\u3044\u305f\u308a\u3067\u6e80\u8db3\u3044\u304f\u3082\u306e\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n\u3067\u3059\u306e\u3067\u3001\u81ea\u5206\u3067\u5b9f\u88c5\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\n\u203b2016/08/25\u8ffd\u8a18 \u30e9\u30a4\u30d6\u30e9\u30ea\u5316\u3057\u307e\u3057\u305f\uff01\nhttps://github.com/YuzuruS/redis-recommend\n\npackagist\u306b\u767b\u9332\u3082\u3057\u3066\u3042\u308b\u306e\u3067\u3001composer\u3092\u4f7f\u3063\u3066\u7c21\u5358\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u307e\u3059\u3002\n\n```composer.json\n{\n    \"require\": {\n       \"yuzuru-s/redis-recommend\": \"1.0.*\"\n    }\n}\n```\n\n### \u5354\u8abf\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u578b\u30ec\u30b3\u30e1\u30f3\u30c9\u3068\u306f\uff1f\n\n\u4eca\u56de\u5b9f\u88c5\u3059\u308b\u5354\u8abf\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u578b\u30ec\u30b3\u30e1\u30f3\u30c9\u3068\u306f\u3001Amazon\u306b\u3042\u308b\u30b3\u30ec\u2193\u3067\u3059\u3002\n\n![\u5354\u8abf\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30af\u3099.png](https://qiita-image-store.s3.amazonaws.com/0/3962/c9238eb6-1576-28ea-e4fb-4c07fbf606c7.png)\n\n\n\u305f\u3068\u3048\u3070\u4ee5\u4e0b\u306e\u30c7\u30fc\u30bf\u304c\u3042\u3063\u305f\u3068\u3057\u307e\u3059\u3002\n\n| \u540d\u524d | \u672c1 | \u672c2 | \u672c3 |\n|-----------|------------|------------|------------|\n|A\u3055\u3093|1|1|1|\n|B\u3055\u3093|1|1|-|\n\nA\u3055\u3093\u304c\u672c1\u3001\u672c2\u3001\u672c3\u3092\u95b2\u89a7\u3057\u307e\u3057\u305f\u3002\nB\u3055\u3093\u304c\u672c1\u3001\u672c2\u3092\u95b2\u89a7\u3057\u307e\u3057\u305f\u3002\n\nA\u3055\u3093B\u3055\u3093\u3068\u3082\u306b\u672c1,\u672c2\u3092\u95b2\u89a7\u3057\u3066\u3044\u308b\u306e\u3067\u3001C\u3055\u3093\u304c\u672c1\u3092\u95b2\u89a7\u3057\u305f\u6642\u306b\u3001\u672c2\u3092\u30ec\u30b3\u30e1\u30f3\u30c9\u3059\u308b\u3002\u3068\u3044\u3046\u4ed5\u7d44\u307f\u3067\u3059\u3002\n\n\n\u4e0a\u8a18\u306f\u6570\u304c\u5c11\u306a\u3044\u306e\u3067\u898b\u305f\u76ee\u3067\u5206\u304b\u308a\u307e\u3059\u304c\u3001\u5b9f\u969b\u306e\u30b5\u30fc\u30d3\u30b9\u306f\u5546\u54c1\u306e\u6570\u304c\u5727\u5012\u7684\u306b\u591a\u3044\u306e\u3067\u3001\u985e\u4f3c\u5ea6\u3092\u8a08\u7b97\u3057\u3066\u9ad8\u3044\u9806\u304b\u3089\u30ec\u30b3\u30e1\u30f3\u30c9\u3057\u307e\u3059\u3002\n\n### Jaccard(\u30b8\u30e3\u30c3\u30ab\u30fc\u30c9)\u6307\u6570\n\u985e\u4f3c\u5ea6\u306e\u8a08\u7b97\u3067\u306fJaccard(\u30b8\u30e3\u30c3\u30ab\u30fc\u30c9)\u6307\u6570\u3092\u4f7f\u3046\u306e\u304c\u4e00\u822c\u7684\u306a\u3088\u3046\u3067\u3059\u3002\n\nA\u3068B\u305d\u308c\u305e\u308c\u3092\u96c6\u5408\u3068\u3059\u308b\u3068\u3001Jaccard(\u30b8\u30e3\u30c3\u30ab\u30fc\u30c9)\u6307\u6570\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3067\u304d\u307e\u3059\u3002\n\n```math\nJaccard(A,B) = \\frac{|A\u2229B|}{|A\u222aB|}\n```\n\n\u3053\u306e\u8a08\u7b97\u5f0f\u3092\u4f7f\u3063\u3066\u4e0b\u8a18\u306e\u30c7\u30fc\u30bf\u3092\u8a08\u7b97\u3059\u308b\u3068\n\n- \u672c1\u3068\u672c2\u3092\u4e21\u65b9\u8cfc\u5165\u3057\u305f\u4eba\u306fE\u3055\u30931\u540d (A\u2229B)\n- \u672c1\u3082\u3057\u304f\u306f\u672c2\u3092\u8cfc\u5165\u3057\u305f\u4eba\u306fA,B,C,D,E\u306e5\u540d (A\u222aB)\n\n\u4ee5\u4e0a\u3088\u308a\u672c1\u3068\u672c2\u306e\u985e\u4f3c\u5ea6\u306f0.2\u306b\u306a\u308a\u307e\u3059\u3002\n\n| \u540d\u524d | A\u3055\u3093 | B\u3055\u3093 | C\u3055\u3093 |D\u3055\u3093 |E\u3055\u3093 |F\u3055\u3093 |G\u3055\u3093 |\n|-----------|------------|------------|------------|------------|------------|------------|------------|\n|\u672c1|1|-|1|-|1|-|-|\n|\u672c2|-|1|-|1|1|-|-|\n\n### PHP+Redis\u306b\u3088\u308b\u5b9f\u88c5\nRedis\u306b\u306f\u53d6\u308a\u51fa\u3057\u3084\u3059\u3044\u4fbf\u5229\u306a\u578bSortedSet\u304c\u3042\u308b\u306e\u3067\u305d\u308c\u3092\u985e\u4f3c\u5ea6\u306e\u4fdd\u5b58\u306b\u4f7f\u3044\u307e\u3059\u3002\n\n#### \u5546\u54c1\u95b2\u89a7\u3092\u8a18\u9332\n```addViewer.php\n\n/**\n * $item_id => \u5546\u54c1ID\n * $user_id => \u30e6\u30fc\u30b6\u30fcID\n */ \n$Redis->lRem('Viewer:Item:' . $item_id, $user_id);\n$Redis->lPush('Viewer:Item:' . $item_id, $user_id);\n$Redis->lTrim('Viewer:Item:' . $item_id, 0, 999); // 1000\u500b\u4ee5\u964d\u524a\u9664 \u8a18\u9332\u3059\u308b\u5546\u54c1\u3084\u9867\u5ba2\u6570\u304c\u5897\u3048\u308b\u3068\u8a08\u7b97\u91cf\u304c\u7206\u767a\u3057\u3066\u6b7b\u306c\u306e\u3067\u3002\n\n```\n\n#### Jaccard(\u30b8\u30e3\u30c3\u30ab\u30fc\u30c9)\u6307\u6570\u3092\u8a08\u7b97\n\n```calc.php\n\n/**\n * $item_ids => \u5546\u54c1ID\u306e\u914d\u5217 [1,2,3,4,5]\u306e\u3088\u3046\u306a\u914d\u5217\n */\n\nforeach ($item_ids as $item_id1) {\n\t$base = $Redis->lRange('Viewer:Item:' . $item_id1, 0, 999);\n\tif (count($base) === 0) {\n\t\tcontinue;\n\t}\n\tforeach ($item_ids as $item_id2) {\n\t\tif ($item_id1 === $item_id2) {\n\t\t\tcontinue;\n\t\t}\n\t\t$target = $Redis->lRange('Viewer:Item:' . $item_id2, 0, 999);\n\t\tif (count($target) === 0) {\n\t\t\tcontinue;\n\t\t}\n\n\t\t# \u30b8\u30e3\u30c3\u30ab\u30fc\u30c9\u6307\u6570\u3092\u8a08\u7b97\n\t\t$join = floatval(count(array_unique(array_merge($base, $target))));\n\t\t$intersect = floatval(count(array_intersect($base, $target)));\n\t\tif ($intersect == 0 || $join == 0) {\n\t\t\tcontinue;\n\t\t}\n\t\t$jaccard = $intersect / $join;\n\n\t\t$Redis->zAdd('Jaccard:Item:' . $item_id1, $jaccard, $item_id2);\n\t}\n}\n\n```\n\n#### \u30ec\u30b3\u30e1\u30f3\u30c9\u5546\u54c1id\u306e\u53d6\u5f97\n```getRecommend.php\n$Redis->zRevRange('Jaccard:Item:' . $item_id, 0, -1);\n```\n\n\n### \u53c2\u8003\u8a18\u4e8b\nhttp://qiita.com/haminiku/items/cdbf8eb488e0cf6a62fe\n", "tags": ["PHP", "MachineLearning", "\u6a5f\u68b0\u5b66\u7fd2", "Redis"]}