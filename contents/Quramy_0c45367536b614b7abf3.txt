{"context": "\u3069\u3046\u3082\u3002WACUL\u3067\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30b8\u30cb\u30a2\u3092\u3057\u3066\u3044\u308b @Quramy \u3067\u3059\u3002\n\u3053\u306e\u30a8\u30f3\u30c8\u30ea\u306fWACUL Advent Calendar 2016\u306e8\u65e5\u76ee\u306e\u8a18\u4e8b\u3068\u3057\u3066\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\n\u3055\u3066\u3001RxDB\u3068\u3044\u3046\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u3054\u5b58\u77e5\u3067\u3057\u3087\u3046\u304b\uff1f\n\u50d5\u3082\u3064\u3044\u5148\u65e5\u77e5\u3063\u305f\u3070\u304b\u308a\u306a\u306e\u3067\u3059\u304c\u30012016\u5e7412\u6708\u306b\u306a\u3063\u3066\u3001\u6025\u6fc0\u306bGitHub\u306etrend\u5165\u308a\u3057\u3066\u304d\u305f\u30d7\u30ed\u30c0\u30af\u30c8\u3067\u3059\u3002\n\n\nRxDB\u306e\u6982\u8981\nRxDB\u306f\u4ee5\u4e0b\u306e\u6a5f\u80fd\u3092\u3082\u3063\u305f\u3001\u4e3b\u306b\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u5411\u3051\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3067\u3059\u3002\n\n\nReactive (rxjs)\nReplication / Sync\nSchemas (jsonschema)\nMango-Query (MongoDB)\nEncryption\nLevel-Adapters\nImport/Export (.json)\nMultiWindow-Support\n\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068\u3044\u3063\u3066\u3082RxDB\u81ea\u4f53\u304c\u6c7a\u307e\u3063\u305f\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u3092\u6301\u3063\u3066\u3044\u308b\u8a33\u3067\u306f\u306a\u304f\u3001IndexedDB or websql, Local Storage\u3084sqlite, HTTP\u63a5\u7d9a\u3057\u305fCouchDB\u7b49\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u52d5\u4f5c\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u30c7\u30fc\u30bf\u306e\u4fdd\u5b58\u5148\u3092\u9078\u629e\u3059\u308b\u30a4\u30e1\u30fc\u30b8\u3067\u3059\u3002\u3053\u306e\u610f\u5473\u3067\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3001\u3068\u3044\u3046\u8aac\u660e\u306e\u65b9\u304c\u6b63\u3057\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\noffline-first\n\u3053\u306e\u30a8\u30f3\u30c8\u30ea\u306e\u30bf\u30a4\u30c8\u30eb\u306b\u3082\u542b\u3081\u305f\u901a\u308a\u3001RxDB\u306foffline-first\u3067\u5229\u7528\u3059\u308b\u3053\u3068\u3092\u524d\u63d0\u3068\u3057\u305f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3067\u3059\u3002\n\n\u4f8b\u3048\u3070\u3001Evernote\u306e\u3088\u3046\u306b\u30e6\u30fc\u30b6\u30fc\u306e\u30c7\u30fc\u30bf\u3092\u8907\u6570\u306e\u30c7\u30d0\u30a4\u30b9\u9593\u3067\u9023\u643a\u3059\u308b\u3088\u3046\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u60f3\u50cf\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\nRxDB\u306f\u3053\u3046\u3044\u3063\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u69cb\u7bc9\u306b\u5411\u3044\u3066\u3044\u307e\u3059\u3002\u56f3\u306e\u3088\u3046\u306b\u3001\u30c7\u30b9\u30af\u30c8\u30c3\u30d7PC\u30d6\u30e9\u30a6\u30b6\u3067\u306fIndexedDB\u306b\u3001\u30e2\u30d0\u30a4\u30eb\u30a2\u30d7\u30ea\u3067\u306fsqlite\u306b\u3001\u305d\u308c\u305e\u308c\u7aef\u672b\u306e\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3057\u3066\u304a\u304d\u3001online\u6642\u306b\u30ea\u30e2\u30fc\u30c8\u306b\u5b58\u5728\u3057\u3066\u3044\u308b\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u3068\u540c\u671f\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\nReactive\n\u307e\u305f\u3001RxDB\u306e\u7279\u5fb4\u3068\u3057\u3066\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30af\u30a8\u30ea\u3092RxJS\u306e Observable \u3068\u3057\u3066\u6271\u3048\u308b\u3053\u3068\u304c\u6319\u3052\u3089\u308c\u307e\u3059\u3002\nconst messages$ = collection.find({}).$.map(docs => docs.map(doc => doc.get(\"message\")));\nmessages$.subscribe(messages => console.log(messages));\n\n\u4e0a\u8a18\u30b3\u30fc\u30c9\u4e2d\u306eObservable\u5909\u6570 messages$ \u306b\u306fRxDB\u306e\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u304c\u5909\u5316\u3059\u308b\u5ea6\u306b\u5024\u304c\u6d41\u308c\u307e\u3059\u3002\n\u30e6\u30fc\u30b6\u30fc\u306e\u64cd\u4f5c\u306b\u3088\u308a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u304c\u5909\u66f4\u3055\u308c\u305f\u5834\u5408\u3001\u30ea\u30e2\u30fc\u30c8\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u3068\u306e\u540c\u671f\u306b\u3088\u3063\u3066\u3001\u30ed\u30fc\u30ab\u30eb\u306eRxDB\u306b\u5909\u66f4\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u306e\u53cc\u65b9\u3067 messages$ \u306b\u5024\u304c\u6d41\u308c\u3066\u304f\u308b\u305f\u3081\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u958b\u767a\u8005\u306f\u6d41\u308c\u3066\u304d\u305f\u30af\u30a8\u30ea\u7d50\u679c\u306e\u51e6\u7406\u306b\u6ce8\u529b\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u7279\u306bReact\u3084Angular\u306e\u3088\u3046\u306b\u3001\u5ba3\u8a00\u7684\u306bView\u3092\u7d44\u307f\u7acb\u3066\u308b\u3053\u3068\u306e\u51fa\u6765\u308b\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3068\u7d44\u307f\u5408\u308f\u305b\u308b\u3068\u5f37\u3044\u3067\u3059\u306d\u3002\n\nDemonstration\n\u6298\u89d2\u3067\u3059\u306e\u3067\u3001RxDB\u3068ReactJS\u3092\u4f7f\u3063\u305f\u7c21\u5358\u306a\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n\nChrome(\u56f3\u4e2d\u5de6) \u3068 Electron(\u56f3\u4e2d\u53f3)\u3001\u305d\u308c\u305e\u308c\u306eLocal Storage\u306b\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\nonline\u4e2d\u306f\u3001\u30ea\u30e2\u30fc\u30c8\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2(\u3068\u3044\u3063\u3066\u3082localhost\u3067\u3059\u304c...)\u3068\u540c\u671f1\n\n\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u5909\u66f4\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u8cfc\u8aad\u3057\u3066\u753b\u9762\u3092\u66f4\u65b0\n\u30ea\u30e2\u30fc\u30c8\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u3092\u843d\u3057\u3066\u3082\u3001Local Storage\u306b\u30c7\u30fc\u30bf\u304c\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\n\u30ea\u30e2\u30fc\u30c8\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u3092\u5fa9\u5e30\u3057\u3066online\u306b\u623b\u3059\u3068\u3001offline\u4e2d\u306b\u884c\u3063\u305f\u30c7\u30fc\u30bf\u5909\u66f4\u304c\u518d\u3073\u30ea\u30e2\u30fc\u30c8\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u3078\u53cd\u6620\u3055\u308c\u308b\n\n\u5b9f\u969b\u3001\u660e\u793a\u7684\u306b\u958b\u767a\u3057\u305f\u306e\u306f 3. \u306e\u90e8\u5206\u3060\u3051\u3067\u3001\u305d\u308c\u4ee5\u5916\u306e\u51e6\u7406\u306f\u5168\u3066RxDB\u304c\u52dd\u624b\u306b\u3084\u3063\u3066\u304f\u308c\u307e\u3059\u3002\n\u30a8\u30f3\u30c8\u30ea\u306e\u672b\u5c3e\u306b\u30c7\u30e2\u30a2\u30d7\u30ea\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u8cbc\u3063\u305f\u306e\u3067\u3001\u8208\u5473\u304c\u3042\u308b\u65b9\u306f\u8aad\u3093\u3067\u307f\u3066\u304f\u3060\u3055\u3044\u3002\u30c7\u30e2\u30a2\u30d7\u30ea\u304c\u3068\u3066\u3082\u7c21\u5358\u306b\u4f5c\u308c\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\nRxDB\u306e\u4f7f\u3044\u65b9\n\u3053\u3053\u304b\u3089\u306fRxDB\u306e\u4f7f\u3044\u65b9\u3092\u7c21\u5358\u306b\u8aac\u660e\u3057\u3066\u3044\u304d\u307e\u3059\u3002RxDB\u306fNPM\u304b\u3089 npm i rxdb \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u307e\u3059\u3002\n\n\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u3078\u306e\u63a5\u7d9a\n\u5148\u8ff0\u3057\u305f\u3088\u3046\u306bRxDB\u306f\u69d8\u3005\u306a\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3092\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u3068\u3057\u3066\u5229\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u3001\u30d6\u30e9\u30a6\u30b6\u306eLocal Storage\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002\nconst RxDB = require(\"rxdb\");\n\nRxDB.plugin(require(\"rxdb-adapter-localstorage\"));\nRxDB.create(\"myDb\", \"localstorage\").then(db => {\n  // use db...\n});\n\nnpm i rxdb-adapter-localstorage \u3092\u5b9f\u884c\u3057\u3066\u3001\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u8ffd\u52a0\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nrequire\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u30d6\u30e9\u30a6\u30b6\u3067\u52d5\u4f5c\u3055\u305b\u308b\u5834\u5408\u306b\u306fbrowserify\u3084webpack\u3092\u5229\u7528\u3057\u3066bundle\u3092\u4f5c\u6210\u3059\u308b\u3068\u3088\u3044\u3067\u3059\u3002\n\u3053\u306e\u4ed6\u306b\u3082\u3001\u4f8b\u3048\u3070\u4e0b\u8a18\u306eplugin\u304c\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n\n\u30d6\u30e9\u30a6\u30b6\u4e0a\u30aa\u30f3\u30e1\u30e2\u30eaDB\n\nRxDB.plugin(require(\"pouchdb-adapter-memory\"));\nRxDB.create(\"myDb\", \"memory\").then(db => { ... });\n\n\nCauchDB\u3068\u4e92\u63db\u6027\u306e\u3042\u308bDB\u3068HTTP\u3067\u63a5\u7d9a\n\nRxDB.plugin(require(\"pouchdb-adapter-http\"));\nRxDB.create(\"http://localhost:5000/my-db\", \"http\").then(db => { ... });\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u540d\u306b pouchdb \u3068\u3042\u308b\u304b\u3089\u3082\u5206\u304b\u308b\u3088\u3046\u306b\u3001\u3053\u308c\u3089\u306fPouchDB\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3059\u3002\nRxDB\u306fPouchDB\u306e\u30e9\u30c3\u30d1\u30fc\u3067\u3042\u308b\u305f\u3081\u3001PouchDB\u304c\u63a5\u7d9a\u53ef\u80fd\u306a\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u304c\u5229\u7528\u53ef\u80fd\u3067\u3059\u3002\n\nhttps://pouchdb.com/adapters.html \u3088\u308a\n\nCollection, Document\u306e\u64cd\u4f5c\nDB\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bCollection\u540d\u3068Schema\u3092\u98df\u308f\u305b\u308b\u3068\u3001Collection\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\nconst mySchema = {\n    title: \"my first schema\",\n    type: \"object\",\n    properties: {\n      id: {type: string, primary: true},\n      name: {type: string},\n      age: {type: number}\n    }\n};\nconst myCollection = await db.collection(\"myCollection\", mySchema);\n\nawait myCollection.insert({id: \"001\", name: \"Quramy\", age: 32});\n\nCollection\u306fDocument\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002MongoDB / mongoose\u306b\u89e6\u308c\u305f\u3053\u3068\u304c\u3042\u308b\u65b9\u3067\u3042\u308c\u3070\u3001\u99b4\u67d3\u307f\u3084\u3059\u3044API\u3067\u3059\u306d\u3002\nconst docs = await myCollection.find({}).exec();\nconst docs = await myCollection.find().where(\"age\").lt(\"20\").sort(\"-age\").exec();\nconst doc = await myCollection.findOne({name: {$eq: \"Quramy\"}}).exec();\n\nexec \u306fPromise\u3092\u8fd4\u3059API\u3067\u3059\u304c\u3001\u4ee3\u308f\u308a\u306b .$ \u3068\u3059\u308b\u3053\u3068\u3067 Observable \u3092\u8fd4\u3059\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\nconst docs$ = await myCollection.find().where(\"name\").eq(\"Quramy\").sort(\"-age\").$;\ndocs$.map(docs => docs.map(doc => doc.get(\"name\"))).subscribe(names => console.log(names));\n\n.$ \u3067\u53d6\u5f97\u3057\u305fObservable\u306b\u306f\u30af\u30a8\u30ea\u306e\u53d6\u5f97\u7d50\u679c\u306b\u5909\u66f4\u304c\u3042\u308b\u3068\u3001\u305d\u306e\u90fd\u5ea6\u30c7\u30fc\u30bf\u304c\u6d41\u308c\u3066\u304d\u307e\u3059\u3002\nFirebase Realtime Database \u306e on \u3068\u4f3c\u3066\u3044\u307e\u3059\u306d\u3002\n\u3053\u306e\u4ed6\u3001Document \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u306f remove, set, save\u3068\u3044\u3063\u305f\u4e00\u901a\u308a\u306e\u64cd\u4f5c\u304c\u63c3\u3063\u3066\u3044\u307e\u3059\u3002\u8a73\u7d30\u306fAPI\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nSynchronize\nCollection\u306b\u7528\u610f\u3055\u308c\u3066\u3044\u308b sync \u30e1\u30bd\u30c3\u30c9\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u5bfe\u8c61\u306eCollection\u3092\u5225\u306e\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u3068\u540c\u671f\u3055\u305b\u307e\u3059\u3002\nRxDB.plugin(require(\"rxdb-adapter-localstorage\"));\nRxDB.plugin(require(\"pouchdb-adapter-http\"));\nRxDB.plugin(require(\"pouchdb-replication\"));\nRxDB.create(\"myDb\", \"localstorage\").then(db => {\n  return db.collection(\"myCollection\", mySchema);\n}).then(myCollection => {\n  return myCollection.sync(\"http://localhost:5000/my-db\");\n});\n\nRxDBAPI\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u8a18\u8f09\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001 pouchdb-replication \u3068\u3044\u3046\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4e8b\u524d\u306b\u8aad\u307f\u8fbc\u307e\u305b\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u540c\u58eb\u306eReplication\u306fPouchDB\u304c\u7528\u610f\u3057\u3066\u3044\u308b\u6a5f\u80fd\u3067\u3042\u308a\u3001RxDB\u3082\u5185\u90e8\u7684\u306b\u306f\u3053\u308c\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\nPouchDB\u306e sync \u30e1\u30bd\u30c3\u30c9\u3067\u306f\u3001\u540c\u671f\u5b8c\u4e86\u5f8c\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u6700\u65b0\u306e\u30c7\u30fc\u30bf\u3092\u6271\u3046\u305f\u3081\u306b\u306f\u3001\u9069\u5207\u306bchange \u30a4\u30d9\u30f3\u30c8\u3092\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001RxDB\u306f\u3053\u306e\u3088\u3046\u306a\u51e6\u7406\u3092\u80a9\u4ee3\u308f\u308a\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\u540c\u671f\u5b9f\u884c\u5f8c\u306b\u30ed\u30fc\u30ab\u30eb\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u306e\u5909\u66f4\u3092\u691c\u77e5\u3057\u305f\u5834\u5408\u3001\u6700\u65b0\u306e\u30af\u30a8\u30ea\u3092Observable\u3078\u3068\u6d41\u3057\u8fbc\u3093\u3067\u304f\u308c\u308b\u306e\u3067\u3059\u3002\n\n\u307e\u3068\u3081\n\u3053\u306e\u30a8\u30f3\u30c8\u30ea\u3067\u306f\u3001RxDB\u306e\u6982\u8981\u3068\u305d\u306e\u4f7f\u3044\u65b9\u3092\u304b\u3044\u3064\u307e\u3093\u3067\u8aac\u660e\u3057\u307e\u3057\u305f\u3002\n\u307e\u3060\u82e5\u3044\u30d7\u30ed\u30c0\u30af\u30c8\u3067\u3042\u308b\u305f\u3081\u3001\u4eca\u5f8c\u3069\u306e\u3088\u3046\u306b\u767a\u5c55\u3057\u3066\u3044\u304f\u304b\u306f\u672a\u77e5\u6570\u3067\u3059\u304c\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306b\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u304c\u5fc5\u8981\u3068\u306a\u3063\u305f\u969b\u306b\u306f\u9078\u629e\u80a2\u306e1\u3064\u3068\u3057\u3066\u691c\u8a0e\u3057\u3066\u307f\u3066\u306f\u5982\u4f55\u3067\u3057\u3087\u3046\u304b\u3002\n\n\u304a\u307e\u3051\n\u672c\u6587\u4e2d\u306e\u30c7\u30e2\u7528\u306b\u4f5c\u6210\u3057\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30b3\u30fc\u30c9\u3092\u8cbc\u3063\u3066\u304a\u304d\u307e\u3059\u3002\n\u307e\u305f\u3001\u30ec\u30dd\u30b8\u30c8\u30ea\u306f Quramy/rxdb-simple-chat-app \u3068\u306a\u308a\u307e\u3059\u3002\u5b9f\u969b\u306e\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u305f\u3044\u5834\u5408\u306f\u3053\u3061\u3089\u304b\u3089\u3002\nimport \"babel-polyfill\";\n\nimport * as RxDB from \"rxdb\";\nimport { mySchema } from \"./my-schema\";\n\nimport React from \"react\";\nimport injectTapEventPlugin from \"react-tap-event-plugin\";\nimport ReactDOM from \"react-dom\";\n\nimport MuiThemeProvider from \"material-ui/styles/MuiThemeProvider\";\nimport darkBaseTheme from \"material-ui/styles/baseThemes/darkBaseTheme\";\nimport getMuiTheme from \"material-ui/styles/getMuiTheme\";\nimport AppBar from \"material-ui/AppBar\";\nimport TextField from \"material-ui/TextField\";\nimport { Card, CardHeader, CardTitle, CardText, CardActions } from \"material-ui/Card\";\nimport IconButton from \"material-ui/IconButton\";\nimport RaisedButton from \"material-ui/RaisedButton\";\nimport Delete from \"material-ui/svg-icons/action/delete\";\nimport Snackbar from \"material-ui/Snackbar\";\n\ninjectTapEventPlugin();\n\nexport class RxDbChat extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      newMessage: \"\", messages: [], syncState: null\n    };\n  }\n\n  async componentDidMount() {\n    const myCollection = await db.collection(\"myCollection\", mySchema);\n    myCollection.query().sort({id: 1}).$.filter(docs => !!docs).map(docs => docs.map(doc => (\n      {id: doc.get(\"id\"), message: doc.get(\"message\")}\n    ))).subscribe(messages => {\n      this.setState({messages: messages.reverse()});\n    });\n    this.myCollection = myCollection;\n    this.myCollection.sync(\"http://localhost:5000/my-db\");\n  }\n\n  async handleOnSubmit(e) {\n   e && e.preventDefault();\n   const id = Date.now() + \"\";\n   const newMessage = {id, message: this.state.newMessage};\n   await this.myCollection.insert(newMessage);\n   this.setState({newMessage: \"\"});\n  }\n\n  async handleOnClickDetele(id) {\n    const doc = await this.myCollection.findOne(id).exec();\n    if (!doc) return;\n    await doc.remove();\n    this.setState({messages: this.state.messages.filter(m => m.id !==id)});\n  }\n\n  handleOnChangeNewMessage(e) {\n    this.setState({newMessage: e.target.value});\n  }\n\n  renderMessages() {\n    const {messages} = this.state;\n    return messages.map(({id, message}) => {\n      const date = new Date(+id).toLocaleString();\n      return (\n        <Card key={id} style={{marginBottom: 20}}>\n          <CardHeader title={date} />\n          <CardText>{message}</CardText>\n          <CardActions>\n            <IconButton onClick={this.handleOnClickDetele.bind(this, id)}>\n              <Delete />\n            </IconButton>\n          </CardActions>\n        </Card>\n      );\n    });\n  }\n\n  render() {\n    return (\n      <div>\n        <AppBar title=\"RxDB Chat\" />\n        <div style={{padding: 30}}>\n          <form style={{marginBottom: 20}} onSubmit={this.handleOnSubmit.bind(this)}>\n            <TextField\n              fullWidth={true}\n              hintText=\"Hit enter to post\"\n              floatingLabelText=\"Message\"\n              value={this.state.newMessage}\n              onChange={this.handleOnChangeNewMessage.bind(this)}\n            />\n          </form>\n          <div>{this.renderMessages()}</div>\n        </div>\n      </div>\n    );\n  }\n}\n\nconst App = () => {\n  if (!window.process) {\n    return (<MuiThemeProvider><RxDbChat /></MuiThemeProvider>);\n  } else {\n    // for Electron\n    document.documentElement.style.backgroundColor = \"#303030\";\n    return (<MuiThemeProvider muiTheme={getMuiTheme(darkBaseTheme)}><RxDbChat /></MuiThemeProvider>);\n  }\n};\n\nlet db;\n\nRxDB.plugin(require(\"rxdb-adapter-localstorage\"));\nRxDB.plugin(require(\"pouchdb-adapter-http\"));\nRxDB.plugin(require(\"pouchdb-replication\"));\nRxDB.create(\"myDb\", \"localstorage\").then(_db => {\n  db = _db;\n  console.log(db);\n  ReactDOM.render(<App />, document.getElementById(\"app\"));\n});\n\n\n\n\u811a\u6ce8\u30fb\u53c2\u8003\u30ea\u30f3\u30af\n\n\n\n\n\u30ea\u30e2\u30fc\u30c8\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u306b\u306f\u3001PouchDB Server\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\u30af\u30e9\u30a6\u30c9\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u3067\u8a66\u3059\u306e\u3067\u3042\u308c\u3070\u3001 https://www.smileupps.com/free-couchdb-hosting \u3084 https://cloudant.com \u3068\u3044\u3063\u305f\u9078\u629e\u80a2\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\u00a0\u21a9\n\n\n\n\u3069\u3046\u3082\u3002WACUL\u3067\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30b8\u30cb\u30a2\u3092\u3057\u3066\u3044\u308b @Quramy \u3067\u3059\u3002\n\u3053\u306e\u30a8\u30f3\u30c8\u30ea\u306f[WACUL Advent Calendar 2016](http://qiita.com/advent-calendar/2016/wacul)\u306e8\u65e5\u76ee\u306e\u8a18\u4e8b\u3068\u3057\u3066\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\n\n\u3055\u3066\u3001RxDB\u3068\u3044\u3046\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u3054\u5b58\u77e5\u3067\u3057\u3087\u3046\u304b\uff1f\n\u50d5\u3082\u3064\u3044\u5148\u65e5\u77e5\u3063\u305f\u3070\u304b\u308a\u306a\u306e\u3067\u3059\u304c\u30012016\u5e7412\u6708\u306b\u306a\u3063\u3066\u3001\u6025\u6fc0\u306bGitHub\u306etrend\u5165\u308a\u3057\u3066\u304d\u305f\u30d7\u30ed\u30c0\u30af\u30c8\u3067\u3059\u3002\n\n<img alt=\"rxdb_trending.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/8808/b3351d88-b1d1-6562-6942-867181267f9d.png\">\n\n\n## RxDB\u306e\u6982\u8981\n[RxDB](https://github.com/pubkey/rxdb)\u306f\u4ee5\u4e0b\u306e\u6a5f\u80fd\u3092\u3082\u3063\u305f\u3001\u4e3b\u306b\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u5411\u3051\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3067\u3059\u3002\n\n> * Reactive (rxjs)\n> * Replication / Sync\n> * Schemas (jsonschema)\n> * Mango-Query (MongoDB)\n> * Encryption\n> * Level-Adapters\n> * Import/Export (.json)\n> * MultiWindow-Support\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068\u3044\u3063\u3066\u3082RxDB\u81ea\u4f53\u304c\u6c7a\u307e\u3063\u305f\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u3092\u6301\u3063\u3066\u3044\u308b\u8a33\u3067\u306f\u306a\u304f\u3001IndexedDB or websql, Local Storage\u3084sqlite, HTTP\u63a5\u7d9a\u3057\u305fCouchDB\u7b49\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u52d5\u4f5c\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u30c7\u30fc\u30bf\u306e\u4fdd\u5b58\u5148\u3092\u9078\u629e\u3059\u308b\u30a4\u30e1\u30fc\u30b8\u3067\u3059\u3002\u3053\u306e\u610f\u5473\u3067\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3001\u3068\u3044\u3046\u8aac\u660e\u306e\u65b9\u304c\u6b63\u3057\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n### offline-first\n\u3053\u306e\u30a8\u30f3\u30c8\u30ea\u306e\u30bf\u30a4\u30c8\u30eb\u306b\u3082\u542b\u3081\u305f\u901a\u308a\u3001RxDB\u306foffline-first\u3067\u5229\u7528\u3059\u308b\u3053\u3068\u3092\u524d\u63d0\u3068\u3057\u305f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3067\u3059\u3002\n![offline-first.png](https://qiita-image-store.s3.amazonaws.com/0/8808/2f4beba6-9c6b-b5bc-1358-6481ce3cd59c.png)\n\n\u4f8b\u3048\u3070\u3001Evernote\u306e\u3088\u3046\u306b\u30e6\u30fc\u30b6\u30fc\u306e\u30c7\u30fc\u30bf\u3092\u8907\u6570\u306e\u30c7\u30d0\u30a4\u30b9\u9593\u3067\u9023\u643a\u3059\u308b\u3088\u3046\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u60f3\u50cf\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\nRxDB\u306f\u3053\u3046\u3044\u3063\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u69cb\u7bc9\u306b\u5411\u3044\u3066\u3044\u307e\u3059\u3002\u56f3\u306e\u3088\u3046\u306b\u3001\u30c7\u30b9\u30af\u30c8\u30c3\u30d7PC\u30d6\u30e9\u30a6\u30b6\u3067\u306fIndexedDB\u306b\u3001\u30e2\u30d0\u30a4\u30eb\u30a2\u30d7\u30ea\u3067\u306fsqlite\u306b\u3001\u305d\u308c\u305e\u308c\u7aef\u672b\u306e\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3057\u3066\u304a\u304d\u3001online\u6642\u306b\u30ea\u30e2\u30fc\u30c8\u306b\u5b58\u5728\u3057\u3066\u3044\u308b\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u3068\u540c\u671f\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n### Reactive\n\u307e\u305f\u3001RxDB\u306e\u7279\u5fb4\u3068\u3057\u3066\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30af\u30a8\u30ea\u3092[RxJS](https://github.com/ReactiveX/rxjs)\u306e Observable \u3068\u3057\u3066\u6271\u3048\u308b\u3053\u3068\u304c\u6319\u3052\u3089\u308c\u307e\u3059\u3002\n\n```js\nconst messages$ = collection.find({}).$.map(docs => docs.map(doc => doc.get(\"message\")));\nmessages$.subscribe(messages => console.log(messages));\n```\n\n\u4e0a\u8a18\u30b3\u30fc\u30c9\u4e2d\u306eObservable\u5909\u6570 `messages$` \u306b\u306fRxDB\u306e\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u304c\u5909\u5316\u3059\u308b\u5ea6\u306b\u5024\u304c\u6d41\u308c\u307e\u3059\u3002\n\n\u30e6\u30fc\u30b6\u30fc\u306e\u64cd\u4f5c\u306b\u3088\u308a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u304c\u5909\u66f4\u3055\u308c\u305f\u5834\u5408\u3001\u30ea\u30e2\u30fc\u30c8\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u3068\u306e\u540c\u671f\u306b\u3088\u3063\u3066\u3001\u30ed\u30fc\u30ab\u30eb\u306eRxDB\u306b\u5909\u66f4\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u306e\u53cc\u65b9\u3067 `messages$` \u306b\u5024\u304c\u6d41\u308c\u3066\u304f\u308b\u305f\u3081\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u958b\u767a\u8005\u306f\u6d41\u308c\u3066\u304d\u305f\u30af\u30a8\u30ea\u7d50\u679c\u306e\u51e6\u7406\u306b\u6ce8\u529b\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u7279\u306bReact\u3084Angular\u306e\u3088\u3046\u306b\u3001\u5ba3\u8a00\u7684\u306bView\u3092\u7d44\u307f\u7acb\u3066\u308b\u3053\u3068\u306e\u51fa\u6765\u308b\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3068\u7d44\u307f\u5408\u308f\u305b\u308b\u3068\u5f37\u3044\u3067\u3059\u306d\u3002\n\n\n## Demonstration\n\u6298\u89d2\u3067\u3059\u306e\u3067\u3001RxDB\u3068ReactJS\u3092\u4f7f\u3063\u305f\u7c21\u5358\u306a\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n![4hHCrStMKO.gif](https://qiita-image-store.s3.amazonaws.com/0/8808/1270e2d0-6048-d729-3244-d6ecd4122c96.gif)\n\n\n1. Chrome(\u56f3\u4e2d\u5de6) \u3068 Electron(\u56f3\u4e2d\u53f3)\u3001\u305d\u308c\u305e\u308c\u306eLocal Storage\u306b\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\n1. online\u4e2d\u306f\u3001\u30ea\u30e2\u30fc\u30c8\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2(\u3068\u3044\u3063\u3066\u3082localhost\u3067\u3059\u304c...)\u3068\u540c\u671f[^1]\n1. \u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u5909\u66f4\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u8cfc\u8aad\u3057\u3066\u753b\u9762\u3092\u66f4\u65b0\n1. \u30ea\u30e2\u30fc\u30c8\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u3092\u843d\u3057\u3066\u3082\u3001Local Storage\u306b\u30c7\u30fc\u30bf\u304c\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\n1. \u30ea\u30e2\u30fc\u30c8\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u3092\u5fa9\u5e30\u3057\u3066online\u306b\u623b\u3059\u3068\u3001offline\u4e2d\u306b\u884c\u3063\u305f\u30c7\u30fc\u30bf\u5909\u66f4\u304c\u518d\u3073\u30ea\u30e2\u30fc\u30c8\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u3078\u53cd\u6620\u3055\u308c\u308b\n\n\u5b9f\u969b\u3001\u660e\u793a\u7684\u306b\u958b\u767a\u3057\u305f\u306e\u306f 3. \u306e\u90e8\u5206\u3060\u3051\u3067\u3001\u305d\u308c\u4ee5\u5916\u306e\u51e6\u7406\u306f\u5168\u3066RxDB\u304c\u52dd\u624b\u306b\u3084\u3063\u3066\u304f\u308c\u307e\u3059\u3002\n\u30a8\u30f3\u30c8\u30ea\u306e\u672b\u5c3e\u306b\u30c7\u30e2\u30a2\u30d7\u30ea\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u8cbc\u3063\u305f\u306e\u3067\u3001\u8208\u5473\u304c\u3042\u308b\u65b9\u306f\u8aad\u3093\u3067\u307f\u3066\u304f\u3060\u3055\u3044\u3002\u30c7\u30e2\u30a2\u30d7\u30ea\u304c\u3068\u3066\u3082\u7c21\u5358\u306b\u4f5c\u308c\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n## RxDB\u306e\u4f7f\u3044\u65b9\n\u3053\u3053\u304b\u3089\u306fRxDB\u306e\u4f7f\u3044\u65b9\u3092\u7c21\u5358\u306b\u8aac\u660e\u3057\u3066\u3044\u304d\u307e\u3059\u3002RxDB\u306fNPM\u304b\u3089 `npm i rxdb` \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u307e\u3059\u3002\n\n\n### \u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u3078\u306e\u63a5\u7d9a\n\u5148\u8ff0\u3057\u305f\u3088\u3046\u306bRxDB\u306f\u69d8\u3005\u306a\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3092\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u3068\u3057\u3066\u5229\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u4f8b\u3048\u3070\u3001\u30d6\u30e9\u30a6\u30b6\u306eLocal Storage\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n```js\nconst RxDB = require(\"rxdb\");\n\nRxDB.plugin(require(\"rxdb-adapter-localstorage\"));\nRxDB.create(\"myDb\", \"localstorage\").then(db => {\n  // use db...\n});\n```\n\n`npm i rxdb-adapter-localstorage` \u3092\u5b9f\u884c\u3057\u3066\u3001\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u8ffd\u52a0\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n`require`\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u30d6\u30e9\u30a6\u30b6\u3067\u52d5\u4f5c\u3055\u305b\u308b\u5834\u5408\u306b\u306fbrowserify\u3084webpack\u3092\u5229\u7528\u3057\u3066bundle\u3092\u4f5c\u6210\u3059\u308b\u3068\u3088\u3044\u3067\u3059\u3002\n\n\u3053\u306e\u4ed6\u306b\u3082\u3001\u4f8b\u3048\u3070\u4e0b\u8a18\u306eplugin\u304c\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n\n* \u30d6\u30e9\u30a6\u30b6\u4e0a\u30aa\u30f3\u30e1\u30e2\u30eaDB\n\n```js\nRxDB.plugin(require(\"pouchdb-adapter-memory\"));\nRxDB.create(\"myDb\", \"memory\").then(db => { ... });\n```\n\n* CauchDB\u3068\u4e92\u63db\u6027\u306e\u3042\u308bDB\u3068HTTP\u3067\u63a5\u7d9a\n\n```js\nRxDB.plugin(require(\"pouchdb-adapter-http\"));\nRxDB.create(\"http://localhost:5000/my-db\", \"http\").then(db => { ... });\n```\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u540d\u306b `pouchdb` \u3068\u3042\u308b\u304b\u3089\u3082\u5206\u304b\u308b\u3088\u3046\u306b\u3001\u3053\u308c\u3089\u306f[PouchDB](https://pouchdb.com/adapters.html)\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3059\u3002\nRxDB\u306fPouchDB\u306e\u30e9\u30c3\u30d1\u30fc\u3067\u3042\u308b\u305f\u3081\u3001PouchDB\u304c\u63a5\u7d9a\u53ef\u80fd\u306a\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u304c\u5229\u7528\u53ef\u80fd\u3067\u3059\u3002\n\n![Adapters.png](https://qiita-image-store.s3.amazonaws.com/0/8808/09301c6b-8e3b-03e3-b627-279d1c62e9e4.png)\n*[https://pouchdb.com/adapters.html](https://pouchdb.com/adapters.html) \u3088\u308a*\n\n\n### Collection, Document\u306e\u64cd\u4f5c\nDB\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bCollection\u540d\u3068Schema\u3092\u98df\u308f\u305b\u308b\u3068\u3001Collection\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\n```js\nconst mySchema = {\n    title: \"my first schema\",\n    type: \"object\",\n    properties: {\n      id: {type: string, primary: true},\n      name: {type: string},\n      age: {type: number}\n    }\n};\nconst myCollection = await db.collection(\"myCollection\", mySchema);\n\nawait myCollection.insert({id: \"001\", name: \"Quramy\", age: 32});\n```\n\nCollection\u306fDocument\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002MongoDB / mongoose\u306b\u89e6\u308c\u305f\u3053\u3068\u304c\u3042\u308b\u65b9\u3067\u3042\u308c\u3070\u3001\u99b4\u67d3\u307f\u3084\u3059\u3044API\u3067\u3059\u306d\u3002\n\n```js\nconst docs = await myCollection.find({}).exec();\nconst docs = await myCollection.find().where(\"age\").lt(\"20\").sort(\"-age\").exec();\nconst doc = await myCollection.findOne({name: {$eq: \"Quramy\"}}).exec();\n```\n\n`exec` \u306fPromise\u3092\u8fd4\u3059API\u3067\u3059\u304c\u3001\u4ee3\u308f\u308a\u306b `.$` \u3068\u3059\u308b\u3053\u3068\u3067 Observable \u3092\u8fd4\u3059\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```js\nconst docs$ = await myCollection.find().where(\"name\").eq(\"Quramy\").sort(\"-age\").$;\ndocs$.map(docs => docs.map(doc => doc.get(\"name\"))).subscribe(names => console.log(names));\n```\n\n`.$` \u3067\u53d6\u5f97\u3057\u305fObservable\u306b\u306f\u30af\u30a8\u30ea\u306e\u53d6\u5f97\u7d50\u679c\u306b\u5909\u66f4\u304c\u3042\u308b\u3068\u3001\u305d\u306e\u90fd\u5ea6\u30c7\u30fc\u30bf\u304c\u6d41\u308c\u3066\u304d\u307e\u3059\u3002\n[Firebase Realtime Database](https://firebase.google.com/docs/reference/js/firebase.database.Query?hl=ja#on) \u306e `on` \u3068\u4f3c\u3066\u3044\u307e\u3059\u306d\u3002\n\n\u3053\u306e\u4ed6\u3001Document \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u306f `remove`, `set`, `save`\u3068\u3044\u3063\u305f\u4e00\u901a\u308a\u306e\u64cd\u4f5c\u304c\u63c3\u3063\u3066\u3044\u307e\u3059\u3002\u8a73\u7d30\u306f[API\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](https://github.com/pubkey/rxdb/blob/master/docs/RxDocument.md)\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n### Synchronize\nCollection\u306b\u7528\u610f\u3055\u308c\u3066\u3044\u308b `sync` \u30e1\u30bd\u30c3\u30c9\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u5bfe\u8c61\u306eCollection\u3092\u5225\u306e\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u3068\u540c\u671f\u3055\u305b\u307e\u3059\u3002\n\n```js\nRxDB.plugin(require(\"rxdb-adapter-localstorage\"));\nRxDB.plugin(require(\"pouchdb-adapter-http\"));\nRxDB.plugin(require(\"pouchdb-replication\"));\nRxDB.create(\"myDb\", \"localstorage\").then(db => {\n  return db.collection(\"myCollection\", mySchema);\n}).then(myCollection => {\n  return myCollection.sync(\"http://localhost:5000/my-db\");\n});\n```\n\nRxDB[API\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](https://github.com/pubkey/rxdb/blob/master/docs/RxCollection.md#sync)\u306b\u8a18\u8f09\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001 `pouchdb-replication` \u3068\u3044\u3046\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4e8b\u524d\u306b\u8aad\u307f\u8fbc\u307e\u305b\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u540c\u58eb\u306eReplication\u306f[PouchDB\u304c\u7528\u610f\u3057\u3066\u3044\u308b\u6a5f\u80fd](https://pouchdb.com/api.html#sync)\u3067\u3042\u308a\u3001RxDB\u3082\u5185\u90e8\u7684\u306b\u306f\u3053\u308c\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\nPouchDB\u306e `sync` \u30e1\u30bd\u30c3\u30c9\u3067\u306f\u3001\u540c\u671f\u5b8c\u4e86\u5f8c\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u6700\u65b0\u306e\u30c7\u30fc\u30bf\u3092\u6271\u3046\u305f\u3081\u306b\u306f\u3001\u9069\u5207\u306b`change` \u30a4\u30d9\u30f3\u30c8\u3092\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001RxDB\u306f\u3053\u306e\u3088\u3046\u306a\u51e6\u7406\u3092\u80a9\u4ee3\u308f\u308a\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\u540c\u671f\u5b9f\u884c\u5f8c\u306b\u30ed\u30fc\u30ab\u30eb\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u306e\u5909\u66f4\u3092\u691c\u77e5\u3057\u305f\u5834\u5408\u3001\u6700\u65b0\u306e\u30af\u30a8\u30ea\u3092Observable\u3078\u3068\u6d41\u3057\u8fbc\u3093\u3067\u304f\u308c\u308b\u306e\u3067\u3059\u3002\n\n\n## \u307e\u3068\u3081\n\u3053\u306e\u30a8\u30f3\u30c8\u30ea\u3067\u306f\u3001RxDB\u306e\u6982\u8981\u3068\u305d\u306e\u4f7f\u3044\u65b9\u3092\u304b\u3044\u3064\u307e\u3093\u3067\u8aac\u660e\u3057\u307e\u3057\u305f\u3002\n\u307e\u3060\u82e5\u3044\u30d7\u30ed\u30c0\u30af\u30c8\u3067\u3042\u308b\u305f\u3081\u3001\u4eca\u5f8c\u3069\u306e\u3088\u3046\u306b\u767a\u5c55\u3057\u3066\u3044\u304f\u304b\u306f\u672a\u77e5\u6570\u3067\u3059\u304c\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306b\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u304c\u5fc5\u8981\u3068\u306a\u3063\u305f\u969b\u306b\u306f\u9078\u629e\u80a2\u306e1\u3064\u3068\u3057\u3066\u691c\u8a0e\u3057\u3066\u307f\u3066\u306f\u5982\u4f55\u3067\u3057\u3087\u3046\u304b\u3002\n\n\n## \u304a\u307e\u3051\n\u672c\u6587\u4e2d\u306e\u30c7\u30e2\u7528\u306b\u4f5c\u6210\u3057\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30b3\u30fc\u30c9\u3092\u8cbc\u3063\u3066\u304a\u304d\u307e\u3059\u3002\n\u307e\u305f\u3001\u30ec\u30dd\u30b8\u30c8\u30ea\u306f [Quramy/rxdb-simple-chat-app](https://github.com/Quramy/rxdb-simple-chat-app) \u3068\u306a\u308a\u307e\u3059\u3002\u5b9f\u969b\u306e\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u305f\u3044\u5834\u5408\u306f\u3053\u3061\u3089\u304b\u3089\u3002\n\n<!-- {{{ -->\n```js\nimport \"babel-polyfill\";\n\nimport * as RxDB from \"rxdb\";\nimport { mySchema } from \"./my-schema\";\n\nimport React from \"react\";\nimport injectTapEventPlugin from \"react-tap-event-plugin\";\nimport ReactDOM from \"react-dom\";\n\nimport MuiThemeProvider from \"material-ui/styles/MuiThemeProvider\";\nimport darkBaseTheme from \"material-ui/styles/baseThemes/darkBaseTheme\";\nimport getMuiTheme from \"material-ui/styles/getMuiTheme\";\nimport AppBar from \"material-ui/AppBar\";\nimport TextField from \"material-ui/TextField\";\nimport { Card, CardHeader, CardTitle, CardText, CardActions } from \"material-ui/Card\";\nimport IconButton from \"material-ui/IconButton\";\nimport RaisedButton from \"material-ui/RaisedButton\";\nimport Delete from \"material-ui/svg-icons/action/delete\";\nimport Snackbar from \"material-ui/Snackbar\";\n\ninjectTapEventPlugin();\n\nexport class RxDbChat extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      newMessage: \"\", messages: [], syncState: null\n    };\n  }\n\n  async componentDidMount() {\n    const myCollection = await db.collection(\"myCollection\", mySchema);\n    myCollection.query().sort({id: 1}).$.filter(docs => !!docs).map(docs => docs.map(doc => (\n      {id: doc.get(\"id\"), message: doc.get(\"message\")}\n    ))).subscribe(messages => {\n      this.setState({messages: messages.reverse()});\n    });\n    this.myCollection = myCollection;\n    this.myCollection.sync(\"http://localhost:5000/my-db\");\n  }\n\n  async handleOnSubmit(e) {\n   e && e.preventDefault();\n   const id = Date.now() + \"\";\n   const newMessage = {id, message: this.state.newMessage};\n   await this.myCollection.insert(newMessage);\n   this.setState({newMessage: \"\"});\n  }\n\n  async handleOnClickDetele(id) {\n    const doc = await this.myCollection.findOne(id).exec();\n    if (!doc) return;\n    await doc.remove();\n    this.setState({messages: this.state.messages.filter(m => m.id !==id)});\n  }\n\n  handleOnChangeNewMessage(e) {\n    this.setState({newMessage: e.target.value});\n  }\n\n  renderMessages() {\n    const {messages} = this.state;\n    return messages.map(({id, message}) => {\n      const date = new Date(+id).toLocaleString();\n      return (\n        <Card key={id} style={{marginBottom: 20}}>\n          <CardHeader title={date} />\n          <CardText>{message}</CardText>\n          <CardActions>\n            <IconButton onClick={this.handleOnClickDetele.bind(this, id)}>\n              <Delete />\n            </IconButton>\n          </CardActions>\n        </Card>\n      );\n    });\n  }\n\n  render() {\n    return (\n      <div>\n        <AppBar title=\"RxDB Chat\" />\n        <div style={{padding: 30}}>\n          <form style={{marginBottom: 20}} onSubmit={this.handleOnSubmit.bind(this)}>\n            <TextField\n              fullWidth={true}\n              hintText=\"Hit enter to post\"\n              floatingLabelText=\"Message\"\n              value={this.state.newMessage}\n              onChange={this.handleOnChangeNewMessage.bind(this)}\n            />\n          </form>\n          <div>{this.renderMessages()}</div>\n        </div>\n      </div>\n    );\n  }\n}\n\nconst App = () => {\n  if (!window.process) {\n    return (<MuiThemeProvider><RxDbChat /></MuiThemeProvider>);\n  } else {\n    // for Electron\n    document.documentElement.style.backgroundColor = \"#303030\";\n    return (<MuiThemeProvider muiTheme={getMuiTheme(darkBaseTheme)}><RxDbChat /></MuiThemeProvider>);\n  }\n};\n\nlet db;\n\nRxDB.plugin(require(\"rxdb-adapter-localstorage\"));\nRxDB.plugin(require(\"pouchdb-adapter-http\"));\nRxDB.plugin(require(\"pouchdb-replication\"));\nRxDB.create(\"myDb\", \"localstorage\").then(_db => {\n  db = _db;\n  console.log(db);\n  ReactDOM.render(<App />, document.getElementById(\"app\"));\n});\n\n```\n\n<!-- }}} -->\n\n## \u811a\u6ce8\u30fb\u53c2\u8003\u30ea\u30f3\u30af\n[^1]: \u30ea\u30e2\u30fc\u30c8\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u306b\u306f\u3001PouchDB Server\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\u30af\u30e9\u30a6\u30c9\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u3067\u8a66\u3059\u306e\u3067\u3042\u308c\u3070\u3001 https://www.smileupps.com/free-couchdb-hosting \u3084 https://cloudant.com \u3068\u3044\u3063\u305f\u9078\u629e\u80a2\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n \n", "tags": ["JavaScript", "Rx", "pouchdb", "reactjs", "RxJS"]}