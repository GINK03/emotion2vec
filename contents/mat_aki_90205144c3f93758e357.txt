{"tags": ["AWS", "S3"], "context": " More than 1 year has passed since last update.s3\u306e\u30d0\u30b1\u30c3\u30c8\u306e\u540d\u524d\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u306f\u51fa\u6765\u306a\u3044\u306e\u3067\u3001URL\u3092\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5f8c\u306b\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u51fa\u3066\u304d\u305f\u5834\u5408\u306f\u30b3\u30d4\u30fc\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\u3057\u304b\u3057\u3001S3\u672c\u4f53\u3067\u306fbucket\u306e\u30b3\u30d4\u30fc\u306f\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u306a\u3044\u3002\n\u4ee5\u4e0b\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u3063\u3066\u307f\u305f\u3002copy\u81ea\u4f53\u306fS3\u5074\u3067\u76f4\u63a5\u9001\u4fe1\u3059\u308b\u5f62\u306b\u306a\u308b\u306e\u3067\u3042\u308b\u7a0b\u5ea6\u9ad8\u901f\u3067\u306f\u3042\u308b\u3002\nrequire 'right_aws'\n\naws_access_key_id, aws_secret_access_key = \"key_id\", \"access_key\"\nold_bucket_name = 'from-bucket'\nnew_bucket_name = \"to-bucket\"\n\ns3 = RightAws::S3.new(aws_access_key_id, aws_secret_access_key)\nbucket = s3.bucket(old_bucket_name)\n\nputs \"Copy S3 files from '#{old_bucket_name}' to '#{new_bucket_name}'\"\n\ntotal_count = bucket.keys.count\nputs \"total_count: #{total_count}\"\n\nprint \"Are you sure? (y/N) > \"\nif gets.strip == 'y'\n  puts \"Start to copy at #{Time.now}\"\n  bucket.keys.each_with_index do |key, i|\n    print \"\\r#{i}\"\n    s3.interface.copy(old_bucket_name, key.name, new_bucket_name, key.name)\n  end\nend\n\n\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u8d85\u3048\u3066\u8ee2\u9001\u3059\u308b\u5834\u5408\u3001\u6a29\u9650\u304c\u6b63\u3057\u304f\u3064\u304b\u306a\u3044\u5834\u5408\u304c\u3042\u308b\u306e\u3067\u305d\u306e\u5bfe\u5fdc\u3092\u884c\u3063\u305f\u30d1\u30bf\u30fc\u30f3\nrequire \"rubygems\"\nrequire 'right_aws'\nrequire \"parallel\"\n\naws_access_key_id, aws_secret_access_key = \"xxx\", \"xxx\"\nnew_bucket_email_address = \"xxx@xxxx.com\"\n\nold_bucket_name = 'old'\nnew_bucket_name = \"new\"\n\ns3 = RightAws::S3.new(aws_access_key_id, aws_secret_access_key)\nbucket = RightAws::S3::Bucket.new(s3, old_bucket_name)\n\nputs \"Copy S3 files from '#{old_bucket_name}' to '#{new_bucket_name}'\"\n\ntotal_count = bucket.keys.count\nputs \"total_count: #{total_count}\"\n\nprint \"Are you sure? (y/N) > \"\nif gets.strip == 'y'\n  Parallel.each_with_index(bucket.keys, in_processes: 10) do |key, i|\n    print \"\\r#{i}: #{key}\"\n    s3.interface.copy(old_bucket_name, key.name, new_bucket_name, key.name, :replace, {'x-amz-grant-full-control' => %!emailAddress=\"#{new_bucket_email_address}\"!, 'x-amz-grant-read' => 'uri=http://acs.amazonaws.com/groups/global/AllUsers'})\n  end\nend\n\ns3\u306e\u30d0\u30b1\u30c3\u30c8\u306e\u540d\u524d\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u306f\u51fa\u6765\u306a\u3044\u306e\u3067\u3001URL\u3092\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5f8c\u306b\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u51fa\u3066\u304d\u305f\u5834\u5408\u306f\u30b3\u30d4\u30fc\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\u3057\u304b\u3057\u3001S3\u672c\u4f53\u3067\u306fbucket\u306e\u30b3\u30d4\u30fc\u306f\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u306a\u3044\u3002\n\n\u4ee5\u4e0b\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u3063\u3066\u307f\u305f\u3002copy\u81ea\u4f53\u306fS3\u5074\u3067\u76f4\u63a5\u9001\u4fe1\u3059\u308b\u5f62\u306b\u306a\u308b\u306e\u3067\u3042\u308b\u7a0b\u5ea6\u9ad8\u901f\u3067\u306f\u3042\u308b\u3002\n\n````ruby\nrequire 'right_aws'\n\naws_access_key_id, aws_secret_access_key = \"key_id\", \"access_key\"\nold_bucket_name = 'from-bucket'\nnew_bucket_name = \"to-bucket\"\n\ns3 = RightAws::S3.new(aws_access_key_id, aws_secret_access_key)\nbucket = s3.bucket(old_bucket_name)\n\nputs \"Copy S3 files from '#{old_bucket_name}' to '#{new_bucket_name}'\"\n\ntotal_count = bucket.keys.count\nputs \"total_count: #{total_count}\"\n\nprint \"Are you sure? (y/N) > \"\nif gets.strip == 'y'\n  puts \"Start to copy at #{Time.now}\"\n  bucket.keys.each_with_index do |key, i|\n    print \"\\r#{i}\"\n    s3.interface.copy(old_bucket_name, key.name, new_bucket_name, key.name)\n  end\nend\n````\n\n\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u8d85\u3048\u3066\u8ee2\u9001\u3059\u308b\u5834\u5408\u3001\u6a29\u9650\u304c\u6b63\u3057\u304f\u3064\u304b\u306a\u3044\u5834\u5408\u304c\u3042\u308b\u306e\u3067\u305d\u306e\u5bfe\u5fdc\u3092\u884c\u3063\u305f\u30d1\u30bf\u30fc\u30f3\n\n````ruby\nrequire \"rubygems\"\nrequire 'right_aws'\nrequire \"parallel\"\n \naws_access_key_id, aws_secret_access_key = \"xxx\", \"xxx\"\nnew_bucket_email_address = \"xxx@xxxx.com\"\n \nold_bucket_name = 'old'\nnew_bucket_name = \"new\"\n \ns3 = RightAws::S3.new(aws_access_key_id, aws_secret_access_key)\nbucket = RightAws::S3::Bucket.new(s3, old_bucket_name)\n \nputs \"Copy S3 files from '#{old_bucket_name}' to '#{new_bucket_name}'\"\n \ntotal_count = bucket.keys.count\nputs \"total_count: #{total_count}\"\n \nprint \"Are you sure? (y/N) > \"\nif gets.strip == 'y'\n  Parallel.each_with_index(bucket.keys, in_processes: 10) do |key, i|\n    print \"\\r#{i}: #{key}\"\n    s3.interface.copy(old_bucket_name, key.name, new_bucket_name, key.name, :replace, {'x-amz-grant-full-control' => %!emailAddress=\"#{new_bucket_email_address}\"!, 'x-amz-grant-read' => 'uri=http://acs.amazonaws.com/groups/global/AllUsers'})\n  end\nend\n````\n"}