{"context": "\n\nTL;DR\nGitBucket\u3068Jenkins\u3001Docker\u3092\u4f7f\u3063\u3066\u30d3\u30eb\u30c9\u3084\u30c6\u30b9\u30c8\u306e\u305f\u3081\u306eCI\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306e\u624b\u9806\u3002\n\n\u307e\u3060\u66f8\u3044\u3066\u3044\u306a\u3044\u3053\u3068\n\nSSH\u9375\u306e\u767b\u9332\u65b9\u6cd5\nJenkins\u306e\u8a2d\u5b9a\u306f\u4e00\u901a\u308ainit.groovy\u3067\u884c\u3046\u3088\u3046\u306b\u3057\u3066\u3057\u307e\u3046\nDocker\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f-v\u3067\u9069\u5207\u306b\u8a2d\u5b9a\u3059\u308b\nElectron\u306e\u30b5\u30f3\u30d7\u30eb\u30bd\u30fc\u30b9\n\n\n\u3084\u308a\u305f\u3044\u3053\u3068\n\nGitBucket\u306e\u4efb\u610f\u306e\u30b0\u30eb\u30fc\u30d7\u3068\u3057\u3066\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001\u30d3\u30eb\u30c9\u7528\u306eJenkins\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\u3059\u308b\u3002\nJenkins\u4e0a\u304b\u3089GitHub Organization folder\u3092\u7d4c\u7531\u3057\u3066GitBucket\u306b\u63a5\u7d9a\u3057\u3001\u30d3\u30eb\u30c9\u5bfe\u8c61\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u30b9\u30ad\u30e3\u30f3\nGitBucket\u306ePullRequest\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3067Jenkins\u306e\u30d3\u30eb\u30c9\u304c\u8d77\u52d5\nJenkins\u306e\u30d3\u30eb\u30c9\u306fDockerPlugin\u3092\u901a\u3057\u3066Docker\u30b5\u30fc\u30d0\u30fc\u3092slave\u8d77\u52d5\u3057\u3066\u3001\u30d3\u30eb\u30c9\u3092\u884c\u3046\n\u7d50\u679c\u3092GitBucket\u306bStatusAPI\u3092\u901a\u3057\u3066\u901a\u77e5\u3059\u308b\n\n\n\u30a4\u30e1\u30fc\u30b8\n\u7d75\u306b\u66f8\u304f\u3068\u3053\u3093\u306a\u611f\u3058\u306b\u306a\u308a\u307e\u3059\u3002\u30b7\u30f3\u30d7\u30eb\u3067\u3059\u3002\n\n\n\u30b4\u30fc\u30eb\nGItBucket\u3067PullRequest\u3092\u51fa\u3057\u305f\u3089\u5b9f\u884c\u53ef\u80fd\u306aexe(Electron\u30a2\u30d7\u30ea)\u304c\u751f\u6210\u3055\u308c\u308b\n\u30a8\u30f3\u30c9\u30e6\u30fc\u30b6\u30fc(GItBucket)\u304b\u3089\u306e\u8981\u6c42\u3092\u3001SIer(Jenkins)\u304c\u4e0b\u8acb\u3051(Docker)\u306b\u6d41\u3057\u3066\u50cd\u304b\u305b\u3001\u306a\u306b\u304f\u308f\u306c\u9854\u3067\u6210\u679c\u7269\u3092\u624b\u306b\u5165\u308c\u307e\u3059\u3002\u3068\u8a00\u3063\u305f\u3089\u4e00\u90e8\u306e\u65b9\u306b\u306f\u60f3\u50cf\u3057\u3084\u3059\u3044\u3067\u3059\u304b\u306d?\n\n\u4e3b\u306a\u767b\u5834\u4eba\u7269\n\nJenkins\nCI\u30b5\u30fc\u30d0\u30fc\u3002\u30d0\u30fc\u30b8\u30e7\u30f3\u306f2.39\u3002AmazonLinux2016.09\u4e0a\u306b\u751f\u606f\u3002\nMaster-Slave\u69cb\u6210\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002Slave\u306fDocker\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3068\u3057\u3066\u7a3c\u50cd\u3055\u305b\u308b\u305f\u3081\u3001\u5b9f\u884c\u6642\u306fMaster\u304b\u3089Docker\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3057\u307e\u3059\u3002\nGitBucket\u3068\u9023\u643a\u3059\u308b\u305f\u3081\u306bGitHub Organization folder\u3092\u3001DockerSlave\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u3001Docker Plugin\u3092\u4eca\u56de\u5229\u7528\u3057\u307e\u3059\u3002\n\nGitBucket\nGitHub\u30af\u30ed\u30fc\u30f3\u3002\u30d0\u30fc\u30b8\u30e7\u30f3\u306f4.8\u3002AmazonLinux2016.09\u4e0a\u306b\u751f\u606f\u3002\nGitHub\u306f\u4f7f\u3048\u306a\u3044\u3051\u3069GitBucket\u306f\u793e\u5185\u3067\u5229\u7528\u3067\u304d\u308b\u4eba \u304c\u4eca\u56de\u306e\u5bfe\u8c61\u3002GitHub\u304c\u4f7f\u3048\u308b\u5e78\u305b\u306a\u4eba\u306f\u8aad\u3080\u5fc5\u8981\u3042\u308a\u307e\u305b\u3093\u3002GitBucket\u306eAPI\u3092GitHub Organization Folder\u3092\u5229\u7528\u3057\u3066\u7121\u7406\u3084\u308a\u5e78\u305b\u306b\u306a\u308d\u3046\u3068\u3057\u3066\u3044\u307e\u3059\u3002\n\u306a\u304a\u3001GitBucket\u306eAPI\u306e\u4e0d\u8db3\u5206\u3092\u88dc\u3046\u305f\u3081\u306bJeknins\u304b\u3089\u76f4\u63a5GitBucket\u306b\u63a5\u7d9a\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\nJenkins <==> Nginx <==> GitBucket\u3068\u3044\u3046\u6d41\u308c\u3092\u8e0f\u3080\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\nDocker\n\u30b3\u30f3\u30c6\u30ca\u30d9\u30fc\u30b9\u306e\u4eee\u60f3\u74b0\u5883\u3002\u30d0\u30fc\u30b8\u30e7\u30f3\u306f1.12.1(API\u306f1.24)\u3002CoreOS alpha (1214.0.0)\u4e0a\u306b\u751f\u606f\u3002\nalpha\u306f\u305f\u307e\u305f\u307e\u3002\nDockerfile\u3092\u5229\u7528\u3057\u3066\u4e8b\u524d\u306b\u4eee\u60f3\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u305f\u30a4\u30e1\u30fc\u30b8\u3092\u6e96\u5099\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nJenkins\u304b\u3089\u63a5\u7d9a\u3055\u308c\u3001\u5b9f\u969b\u306e\u30d3\u30eb\u30c9\u3084\u30c6\u30b9\u30c8\u306f\u3053\u306e\u30b3\u30f3\u30c6\u30ca\u5185\u90e8\u3067\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\n\u74b0\u5883\u69cb\u7bc9\n\n\n\n\u30b5\u30fc\u30d0\u30fc\n\u30d0\u30fc\u30b8\u30e7\u30f3\n\u540c\u5c45\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\n\n\n\n\nJenkins\n2.39\nNginx\n\n\nGitBucket\n4.8\nJetty\n\n\nDocker\n1.12.1\n(\u30b3\u30f3\u30c6\u30ca\u4e0a\u306b) nodejs\n\n\n\n\nGitBucket\u30b5\u30fc\u30d0\u30fc\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304b\u3089\u8d77\u52d5\n\n\nGItBucket4.8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n \u597d\u304d\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u30fc(\u79c1\u306fJetty)\u306b\u914d\u7f6e\u3057\u3066\u8d77\u52d5\u3057\u307e\u3059\u3002\n\nhttp://GITBUCKET_SERVER:8080\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044(\u3053\u3053\u3067\u306f\u4fbf\u5b9c\u7684\u306bGITBUCKET_SERVER\u3068\u3044\u3046host\u540d\u3067\u9032\u3081\u3066\u3044\u304d\u307e\u3059)\u3002\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u7528\u306bWeb\u30b5\u30fc\u30d0\u30fc\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059(\u79c1\u306fNginx\u3092\u5165\u308c\u307e\u3057\u305f)\u3002\n\nNginx\u306e\u8a2d\u5b9a\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u307e\u3059\n(\u53c2\u8003:Multibranch Pipeline\u306b\u3088\u308bJenkins\u3068GitBucket\u306e\u9023\u643a)\u3002\n\n/etc/nginx/nginx.conf\n# server\u306e\u5b9a\u7fa9\u306b\u4ee5\u4e0b\u3092location\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\nlocation ~ ^/[^/]+/[^/]+\\.git.*$ {\n        return http://GITBUCKET_SERVER:8080/git$request_uri;\n}\n\nlocation ~ ^/api/v3/users/(.*)$ {\n        try_files $uri /api/v3/orgs/$1;\n}\n\nlocation / {\n        proxy_pass http://GITBUCKET_SERVER:8080;\n        client_max_body_size 10M;\n        proxy_set_header Host $host;\n}\n\n\n\n\nNginx\u306e\u8a2d\u5b9a\u3092\u53cd\u6620\u3055\u305b\u307e\u3059\nnginx -s reload\n\n\nhttp://GITBUCKET_SERVER/\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\nroot/root(\u521d\u671f\u30e6\u30fc\u30b6\u30fc)\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3001\u4efb\u610f\u306e\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u307e\u3059(\u3053\u3053\u3067\u306fJGROUP\u3068\u3044\u3046\u540d\u524d\u306e\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u308a\u307e\u3059)\u3002\n\nNginx\u3092\u7d4c\u7531\u3057\u305f\u3053\u3068\u3067GitBucket\u3067\u306f\u53d7\u3051\u4ed8\u3051\u3066\u3044\u306a\u304b\u3063\u305f\u4ee5\u4e0b\u306eAPI\u304c\u5b9f\u884c\u3067\u304d\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n# jq\u306f\u304a\u597d\u307f\u3067\n$ export GITBUCKET_SERVER=127.0.0.1\n$ export GROUP_NAME=JGROUP\n# nginx\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u3001{ \"message\": \"Not Found\" } \u304c\u8fd4\u308b\n$ curl http://$GITBUCKET_SERVER:8080/api/v3/users/$GROUP_NAME | jq .\n{\n  \"message\": \"Not Found\"\n}\n# nginx\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u30b0\u30eb\u30fc\u30d7\u306e\u60c5\u5831\u304c\u8fd4\u308b\n$ curl http://$GITBUCKET_SERVER/api/v3/users/$GROUP_NAME | jq .\n{\n  \"login\": \"JGROUP\",\n  \"email\": \"JGROUP@devnull\",\n  \"type\": \"Organization\",\n  \"site_admin\": false,\n  \"created_at\": \"2016-01-19T00:55:00Z\",\n  \"url\": \"http://GITBUCKET_SERVER:8080/api/v3/users/JGROUP\",\n  \"html_url\": \"http://GITBUCKET_SERVER:8080/JGROUP\",\n  \"avatar_url\": \"http://GITBUCKET_SERVER:8080/JGROUP/_avatar\"\n}    \n\n\n\n\n\u30e6\u30fc\u30b6\u30fc\u8a2d\u5b9a\u3068\u30ea\u30dd\u30b8\u30c8\u30ea\u4f5c\u6210\n\nGitBucket\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\nJenkins\u7528\u306e\u30e6\u30fc\u30b6\u30fc\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\nJenkins\u7528\u306eSSH\u9375\u3092\u767b\u9332\u3057\u3066\u304a\u304d\u307e\u3059(TODO)\u3002\n\n\n\nhttp://GITBUCKET_SERVER:8080/jenkins/_ssh\u3078\u79fb\u52d5\n\u79d8\u5bc6\u9375\u30922\u3064\u767b\u9332\u3057\u307e\u3059(\u767b\u9332\u306e\u4ed5\u65b9\u306f\u7701\u7565)\u3002\n\njenkins => jenkins\u30de\u30b9\u30bf\u30fc\u304b\u3089\u63a5\u7d9a\u3092\u884c\u3046\u305f\u3081\u306essh\u9375\u60c5\u5831\u3067\u3059\u3002\njenkins-slave => Docker\u4e0a\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u63a5\u7d9a\u3092\u884c\u3046\u305f\u3081\u306essh\u9375\u60c5\u5831\u3067\u3059\u3002\n\n\n\n\n\u4e0a\u8a18\u3067\u4f5c\u3063\u305fJGROUP\u306b\u4f5c\u6210\u3057\u305fjenkis\u30e6\u30fc\u30b6\u30fc\u3092\u8ffd\u52a0\u3057\u3001\u30b0\u30eb\u30fc\u30d7\u306b\u4efb\u610f\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u30c6\u30b9\u30c8\u7528\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306aJenkinsfile\u3092\u767b\u9332\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\nJenkinsfile\nnode(\"ubuntu-base\") {\n    stage(\"hello\") {\n        echo \"world\"\n    }\n}\n\n\n\u3053\u308c\u3067GitBucket\u5074\u306e\u8a2d\u5b9a\u306f\u7d42\u4e86\u3067\u3059\u3002\n\n\n\nDocker\u30b5\u30fc\u30d0\u30fc\n\nDocker\u30b5\u30fc\u30d0\u30fc\u306e\u8a2d\u5b9a\n\n\u597d\u304d\u306aDokcer\u306e\u30db\u30b9\u30c8\u30fc\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3057\u307e\u3059(\u79c1\u306e\u5834\u5408\u306fCoreOS\u3092\u9078\u629e)\n\ntcp\u30d7\u30ed\u30c8\u30b3\u30eb\u3067\u5916\u90e8\u304b\u3089\u63a5\u7d9a\u53ef\u80fd\u306a\u3088\u3046\u306b\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059  \n\n\ndocker-tcp.socket\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n/etc/systemd/system/docker-tcp.socket\n[Unit]\nDescription=Docker Socket for the API\n\n[Socket]\nListenStream=2376\nBindIPv6Only=both\nService=docker.service\n\n[Install]\nWantedBy=sockets.target\n\n\n\u6ce8\u610f\u4e8b\u9805 (\u53c2\u8003:\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306e\u5411\u3053\u3046\u5074\u306b\u3042\u308bDocker\u3092\u4f7f\u3046)\n\ntcp\u3067\u306e\u63a5\u7d9a\u3092\u5168\u8a31\u53ef\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u7684\u306b\u554f\u984c\u304c\u3042\u308a\u307e\u3059\u3002\n\u5f53\u521dProtect the Docker daemon socket\u3067\u8a2d\u5b9a\u3057\u3088\u3046\u3068\u3057\u305f\u306e\u3067\u3059\u304c\u3001Jenkins\u306eDockerPlugin\u304ctcp\u304bunix\u30d7\u30ed\u30c8\u30b3\u30eb\u3057\u304b\u53d7\u3051\u4ed8\u3051\u3066\u3044\u306a\u304b\u3063\u305f\u305f\u3081\u3001\u3042\u304d\u3089\u3081\u307e\u3057\u305f(\u5b9f\u969b\u306b\u306f\u30a4\u30f3\u30d5\u30e9\u30ec\u30d9\u30eb\u3067IP\u5358\u4f4d\u3067\u30a2\u30af\u30bb\u30b9\u5236\u9650\u3092\u304b\u3051\u308b\u3064\u3082\u308a\u3067\u3059\u3002\u307e\u3060\u3084\u3063\u3066\u306a\u3044\u3051\u3069)\u3002\n\n\n\ndocker\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\n$ sudo systemctl enable docker-tcp.socket\n$ sudo systemctl stop docker\n$ sudo systemctl start docker-tcp.socket\n$ sudo systemctl start docker\n\n\n\n\n\n\u63a5\u7d9a\u78ba\u8a8d\u3092\u3057\u307e\u3059\u3002Jenkins\u30b5\u30fc\u30d0\u30fc\u304b\u3089curl\u304c\u901a\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ curl http://127.0.0.1:2376/images/json\n\n\n\n\n\u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u306e\u69cb\u7bc9\n\n\nJenkins\u304b\u3089\u63a5\u7d9a\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u306a\u30d9\u30fc\u30b9\u3068\u306a\u308bDockerImage\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002\n \u4eca\u56de\u306f\u3053\u3093\u306a\u611f\u3058\u306b\u30d9\u30fc\u30b9\u3068\u306a\u308bDockerfile\u3092\u69cb\u7bc9\u3057\u307e\u3057\u305f(\u96d1\u3067\u3059)\u3002\nFROM ubuntu:16.10\n\n#-----------------------------------------------------------\n\n# \u5404\u7a2e\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# jenkins\u30e6\u30fc\u30b6\u30fc\u306e\u8ffd\u52a0\n# ssh\u63a5\u7d9a\u3092\u8a31\u53ef\n# \u4e00\u90e8\u5f8c\u8ff0\u3059\u308belectron\u306e\u74b0\u5883\u69cb\u7bc9\u306b\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u542b\u3080\nRUN set -x \\\n  && apt-get update \\\n  && apt-get -y install --no-install-recommends \\\n      sudo \\\n      software-properties-common \\\n      openssh-server \\\n      curl \\\n      wget \\\n      git \\\n      unzip \\\n      zip \\\n      apt-transport-https \\\n  && mkdir ~/.ssh \\\n  && mkdir /var/run/sshd \\\n  && groupadd jenkins && useradd -d /home/jenkins -g jenkins -m jenkins \\\n  && mkdir /home/jenkins/.ssh \\\n  && rm -rf /var/lib/apt/lists/*\n\n# 22\u30dd\u30fc\u30c8\u3092\u516c\u958b     \nEXPOSE 22\n\n# jenkins\u304b\u3089gitbucket\u3078\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306e\u8a8d\u8a3c\u60c5\u5831\u3092\u8a2d\u5b9a\n# http\u63a5\u7d9a\u304c\u3067\u304d\u306a\u3044\u306e\u3067ssh\u3067\u63a5\u7d9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\nCOPY files/config ~/.ssh/config\nCOPY files/config /home/jenkins/.ssh/config\nCOPY files/id_jenkins_rsa.pub /home/jenkins/.ssh/authorized_keys\nCOPY files/id_gitbucket_rsa /home/jenkins/.ssh/id_rsa\n\nRUN set -x \\\n  && chown -R jenkins:jenkins /home/jenkins/.ssh \\\n  && chmod 700 /home/jenkins/.ssh \\\n  && chmod 600 /home/jenkins/.ssh/*\n\n\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\n$ cd ubuntu-base\n$ find .\n.\n./files\n./files/id_gitbucket_rsa\n./files/id_jenkins_rsa\n./files/config\n./files/id_jenkins_rsa.pub\n./files/id_gitbucket_rsa.pub\n./Dockerfile\n./README.md\n$ docker build -t ubuntu:ubuntu-base .\n\n\n\nElectron\u306e\u30d3\u30eb\u30c9\u74b0\u5883\u69cb\u7bc9\u306e\u305f\u3081\u306eDockerImage\u3092\u4f5c\u308a\u307e\u3059\nFROM ubuntu:16.10\n\n#---------------------------\nWORKDIR /usr/local\n\nENV NDENV_ROOT /usr/local/ndenv\nENV PATH \"$NDENV_ROOT/bin:$PATH\"\n\n# \u30d3\u30eb\u30c9\u7528\u306bndenv\u3068yarn\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nRUN set -x \\\n  && git clone https://github.com/riywo/ndenv.git /usr/local/ndenv \\\n  && mkdir /usr/local/ndenv/plugins \\\n  && git clone https://github.com/riywo/node-build.git /usr/local/ndenv/plugins/node-build \\\n  && (\\\n      echo 'export NDENV_ROOT=/usr/local/ndenv'; \\\n      echo 'export PATH=\"$NDENV_ROOT/bin:$PATH\"'; \\\n      echo 'eval \"$(ndenv init -)\"' \\\n    ) >> /etc/profile.d/ndenv.sh \\\n  && ndenv install v6.1.0 \\\n  && ndenv global v6.1.0 \\\n  && chmod +777 -R /usr/local/ndenv \\\n  && curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add - \\\n  && echo \"deb https://dl.yarnpkg.com/debian/ stable main\" | sudo tee /etc/apt/sources.list.d/yarn.list \\\n  && sudo apt-get update \\\n  && sudo apt-get install yarn -y\n\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\n$ cd ubuntu-electron\n$ find .\n.\n./files\n./files/id_gitbucket_rsa\n./files/id_jenkins_rsa\n./files/config\n./files/id_jenkins_rsa.pub\n./files/id_gitbucket_rsa.pub\n./Dockerfile\n./README.md\n$ docker build -t ubuntu:ubuntu-electron .\n\n\n\n\u4ee5\u4e0a\u3067Docker\u30b5\u30fc\u30d0\u30fc\u306e\u8a2d\u5b9a\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\nJenkins\u30b5\u30fc\u30d0\u30fc\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304b\u3089\u8d77\u52d5\n\n\nJenkins\u306eLTS Release\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\u304a\u597d\u304d\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u30fc(\u79c1\u306fJetty)\u306b\u914d\u5099\u3057\u307e\u3059\u3002\u305f\u3060\u3057\u307e\u3060\u8d77\u52d5\u306f\u3057\u307e\u305b\u3093\u3002\n\nJenkins\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f$HOME/.jenkins\u4ee5\u4e0b\u306b\u5fc5\u8981\u306a\u30c7\u30fc\u30bf\u3092\u69cb\u7bc9\u3057\u307e\u3059\u306e\u3067\u3001\u4e8b\u524d\u306b$HOME/.jenkins\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u3001$HOME/.jenkins/init.groovy\u3068\u3044\u3046\u540d\u524d\u3067\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\u3057\u307e\u3059\u3002\n(\u53c2\u8003:Jenkins\u306e\u516c\u5f0fDocker\u30a4\u30e1\u30fc\u30b8\u4f7f\u3063\u3066\u307f\u305f)\n\ninit.groovy\nimport hudson.model.*;\nimport hudson.security.*\nimport jenkins.model.*;\n\ndef instance = Jenkins.instance\n\n//  \u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u30fc\u3092\u81ea\u52d5\u751f\u6210\n// https://groups.google.com/d/msg/jenkinsci-users/Pb4QZVc2-f0/5hzCC-syNgAJ\ndef hudsonRealm = new HudsonPrivateSecurityRealm(false)\nhudsonRealm.createAccount('admin','admin')\ninstance.setSecurityRealm(hudsonRealm)\n\ndef strategy = new FullControlOnceLoggedInAuthorizationStrategy()\ninstance.setAuthorizationStrategy(strategy)\ninstance.save()\n\ndef uCenter = instance.updateCenter\nuCenter.updateAllSites()\n\ndef checkIfPluginInstalled = { pluginid ->\n  for(p in instance.pluginManager.plugins) {\n    if(p.shortName == pluginid){\n      return true\n    }\n  }\n  return false\n}\n\n// Installs the following plugins if not installed.\n[\n  \"cloudbees-folder\",\n  \"antisamy-markup-formatter\",\n  \"build-timeout\",\n  \"credentials-binding\",\n  \"timestamper\",\n  \"ws-cleanup\",\n  \"gradle\",\n  \"workflow-aggregator\",\n  \"github-organization-folder\",\n  \"pipeline-stage-view\",\n  \"git\",\n  \"ssh-slaves\",\n  \"matrix-auth\",\n  \"pam-auth\",\n  \"ldap\",\n  \"email-ext\",\n  \"mailer\",\n  \"docker-plugin\",\n  \"ghprb\"\n].findAll({! checkIfPluginInstalled(it)}).each {\n  uCenter.getPlugin(it).deploy()\n}\n\n// Set the number of executors (in master-node) to 0.\ninstance.setNumExecutors(0)\n\ninstance.reload()\n\n\n\nJenkins\u3092\u8d77\u52d5\u3059\u308b\u3068\u3001init.groovy\u304c\u8aad\u307f\u8fbc\u307e\u308c\u3066admin\u30e6\u30fc\u30b6\u30fc\u3068\u5fc5\u8981\u306a\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3059\u3002\n\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u8a2d\u5b9a\n\u5fc5\u8981\u306a\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u8a2d\u5b9a\u3092\u884c\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\nDocker Plugin\n\n\nhttp://JENKINS_SERVER:8080/configure\u3078(Jenkins\u306e\u7ba1\u7406 => \u30b7\u30b9\u30c6\u30e0\u8a2d\u5b9a)\u3002\n\n\u30af\u30e9\u30a6\u30c9 => \u8ffd\u52a0 => Docker\u3092\u9078\u629e\n\n\u5404\u7a2e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\n\n\nName\u306f\u4efb\u610f\nDocker URL\u306ftcp\u3042\u308b\u3044\u306funix\u306e\u307f\u304c\u6307\u5b9a\u53ef\u80fd\u3067\u3059\u3002http\u306f\u4e0d\u53ef\nDocker API Version\u306fCoreOS\u4e0a\u3067docker version\u3068\u6253\u3064\u3053\u3068\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n\n\nImages => Add Docker Template\u3067\u5229\u7528\u3059\u308bDocker\u540d\u3092\u7d10\u3064\u3051\u307e\u3059\u3002\n\n\n\nDocker Image => Docker\u306e\u8a2d\u5b9a\u3067\u4f5c\u6210\u3057\u305fImage\u540d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\nRemote Filing System Root => Dockerfile\u3067\u4f5c\u6210\u3057\u305fjenkins\u30e6\u30fc\u30b6\u30fc\u306ehome\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3057\u307e\u3059\n\nLabel => Jenkinsfile\u306enode\u306e\u6307\u5b9a\u3068\u306a\u308bslave\u540d\u3067\u3059\u3002\n\n\u7528\u9014 => \u3053\u306e\u30de\u30b7\u30fc\u30f3\u3092\u7279\u5b9a\u30b8\u30e7\u30d6\u5c02\u7528\u306b\u3059\u308b\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\nLanunch method => Docker SSH computer launcher\u3092\u9078\u629e\u3057\u307e\u3059\u3002\u8a8d\u8a3c\u60c5\u5831\u306f\u3001Dockerfile\u5185\u3067\u5b9a\u7fa9\u3057\u305f\u79d8\u5bc6\u9375\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n\nImages\u306eConfiguration setting... => Volumes\u3067\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u305f\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6c38\u7d9a\u5316\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u4eca\u56de\u306fyarn\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u30d5\u30a9\u30eb\u30c0\u3068electron\u306e\u30d0\u30a4\u30ca\u30ea\u3092\u30db\u30b9\u30c8\u5074\u306b\u30de\u30a6\u30f3\u30c8\u3059\u308b\u305f\u3081\u306b\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\n\n  /home/core/cache/yarn:/home/jenkins/.cache/yarn/\n  /home/core/cache/electron:/home/jenkins/.electron/\n\n\n\n\nGitHub Organization Folder\n\n\nhttp://JENKINS_SERVER:8080/configure\u3078(Jenkins\u306e\u7ba1\u7406 => \u30b7\u30b9\u30c6\u30e0\u8a2d\u5b9a)\u3002\n\nGitHub Enterprise Servers\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\n\nAPI endpoint => http://GITBUCKET_SERVER/api/v3/\n\n\nName => \u9069\u5f53\u306b(AWS-GIT\u3068\u3064\u3051\u307e\u3057\u305f)\n\n\n\n\nJOB\u4f5c\u6210\n\n\n\u65b0\u898f\u30b8\u30e7\u30d6\u3067GitHub Organization Folder\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u4efb\u610f\u306e\u540d\u524d\u3092\u3064\u3051\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u304c\u3001\u8a2d\u5b9a\u3057\u305f\u540d\u524d\u304c\u30ea\u30dd\u30b8\u30c8\u30ea\u306eowner(\u30e6\u30fc\u30b6\u30fcor\u30b0\u30eb\u30fc\u30d7)\u306b\u306a\u308a\u307e\u3059\u3002\u5bfe\u8c61\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u30b0\u30eb\u30fc\u30d7\u306f\u5f8c\u3067\u5909\u66f4\u53ef\u80fd\u3067\u3059\u3002\n\n\u8a2d\u5b9a\u753b\u9762\u304c\u958b\u304f\u306e\u3067\u3001Project Sources\u304b\u3089Repository Sources \u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\nOwner --- \u6307\u5b9a\u3057\u305f\u30e6\u30fc\u30b6\u30fcor\u30b0\u30eb\u30fc\u30d7\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u4ee5\u4e0b\u3092\u63a2\u7d22\u3057\u307e\u3059\nAPI endpoint --- \u63a5\u7d9a\u5148\u306e\u30b5\u30fc\u30d0\u30fc\u3092\u30b7\u30b9\u30c6\u30e0\u8a2d\u5b9a\u3067\u8a2d\u5b9a\u3057\u305fGitBucket\u306e\u540d\u524d\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\n\u3046\u307e\u304f\u3044\u3051\u3070\u6307\u5b9a\u3057\u305f\u30b0\u30eb\u30fc\u30d7\u914d\u4e0b\u304c\u30b9\u30ad\u30e3\u30f3\u3055\u308cJenkinsfile\u304c\u5b58\u5728\u3059\u308b\u30ea\u30dd\u30b8\u30c8\u30ea\u304c\u4e00\u89a7\u306b\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n\n\u30b9\u30ad\u30e3\u30f3\u5b8c\u4e86\u5f8c\n\n\u30d6\u30e9\u30f3\u30c1\u4e00\u89a7\n\n\u30d3\u30eb\u30c9\u7d50\u679c\n\n\n\n\n\n\u30b4\u30fc\u30eb\u3092\u78ba\u8a8d\n\u3084\u308a\u305f\u3044\u4e8b\u304c\u51fa\u6765\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\nGitBucket\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u4e0a\u306b\u7c21\u5358\u306aElectron\u30a2\u30d7\u30ea\u3092PUSH\u3057\u307e\u3059\u3002Jenkins\u30d5\u30a1\u30a4\u30eb\u306b\u306f\u6210\u679c\u7269\u3092\u4fdd\u5b58\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u8a18\u8f09\u3057\u3066\u304a\u304d\u307e\u3059( TODO \u30b5\u30f3\u30d7\u30eb\u30bd\u30fc\u30b9)\u3002\nRe-Scan\u3057\u3066\u8a8d\u8b58\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\nGitBucket\u4e0a\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u4e0a\u306b\u30d6\u30e9\u30f3\u30c1\u3092\u5207\u308a\u3001PullRequest\u3092\u51fa\u3057\u307e\u3059\u3002\nPullRequest\u304c\u51fa\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067Jenkins\u30d3\u30eb\u30c9\u304c\u8d70\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\n\nJenkins\u30d3\u30eb\u30c9\u304c\u5b8c\u4e86\u5f8c\u306b\u6210\u679c\u7269\u304c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\n\u30cf\u30de\u30ea\u30dd\u30a4\u30f3\u30c8(\u307e\u3068\u3081)\n\n\nGitHub Organization folder\u3067\u30b9\u30ad\u30e3\u30f3\u3057\u3066\u3082GitBucket\u306b\u7e4b\u304c\u3089\u306a\u3044\n\n\n\u4e0a\u8a18\u624b\u9806\u306b\u3057\u305f\u304c\u3063\u3066WEB\u30b5\u30fc\u30d0\u30fc\u3067\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u3044\u3058\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\n\nDockerPlugin\u304b\u3089Protect the Docker daemon socket\u3067\u304d\u306a\u3044\u3002\n\n\n\u73fe\u5728\u306e\u30d0\u30fc\u30b8\u30e7\u30f3(DockerPlugin 0.16.2)\u3060\u3068https\u306f\u8a2d\u5b9a\u3067\u304d\u307e\u305b\u3093\u3002\n\n\nSlave\u3068\u3057\u3066\u8d77\u52d5\u3057\u3066\u3044\u308bDocker\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bJenkins\u304b\u3089\u63a5\u7d9a\u51fa\u6765\u306a\u3044\u3002\n\n\nDockerPlugin\u306e\u63a5\u7d9a\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\u5fc5\u8981\u306a\u79d8\u5bc6\u9375\u306fDocker\u306b\u63a5\u7d9a\u3059\u308b\u8a8d\u8a3c\u60c5\u5831\u3067\u306f\u306a\u304f\u3066\u3001Docker\u4e0a\u306b\u5b58\u5728\u3059\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306e\u79d8\u5bc6\u9375\u3067\u3059\u3002\n\n\nDocker\u4e0a\u304b\u3089GitBucket\u306e\u30bd\u30fc\u30b9\u3092clone\u51fa\u6765\u306a\u3044\n\n\n\nhttps\u30d7\u30ed\u30c8\u30b3\u30eb\u3084git\u30d7\u30ed\u30c8\u30b3\u30eb\u3067\u306f\u63a5\u7d9a\u51fa\u6765\u307e\u305b\u3093\u3002ssh\u3067\u63a5\u7d9a\u3057\u307e\u3057\u3087\u3046\u3002\n\n\n\n\n\u30aa\u30c1\nGitHub\u306f\u4fbf\u5229\u3067\u3059\u3002\u3067\u3082\u4f1a\u793e\u3067\u306fGitBucket\u4f7f\u3044\u7d9a\u3051\u3066\u3044\u304f\u3064\u3082\u308a\u3067\u3059\u3002\n# TL;DR\nGitBucket\u3068Jenkins\u3001Docker\u3092\u4f7f\u3063\u3066\u30d3\u30eb\u30c9\u3084\u30c6\u30b9\u30c8\u306e\u305f\u3081\u306eCI\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306e\u624b\u9806\u3002\n\n# \u307e\u3060\u66f8\u3044\u3066\u3044\u306a\u3044\u3053\u3068\n* SSH\u9375\u306e\u767b\u9332\u65b9\u6cd5\n* Jenkins\u306e\u8a2d\u5b9a\u306f\u4e00\u901a\u308ainit.groovy\u3067\u884c\u3046\u3088\u3046\u306b\u3057\u3066\u3057\u307e\u3046\n* Docker\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f-v\u3067\u9069\u5207\u306b\u8a2d\u5b9a\u3059\u308b\n* **Electron\u306e\u30b5\u30f3\u30d7\u30eb\u30bd\u30fc\u30b9**\n\n# \u3084\u308a\u305f\u3044\u3053\u3068\n1. GitBucket\u306e\u4efb\u610f\u306e\u30b0\u30eb\u30fc\u30d7\u3068\u3057\u3066\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001\u30d3\u30eb\u30c9\u7528\u306eJenkins\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\u3059\u308b\u3002\n2. Jenkins\u4e0a\u304b\u3089GitHub Organization folder\u3092\u7d4c\u7531\u3057\u3066GitBucket\u306b\u63a5\u7d9a\u3057\u3001\u30d3\u30eb\u30c9\u5bfe\u8c61\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u30b9\u30ad\u30e3\u30f3\n3. GitBucket\u306ePullRequest\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3067Jenkins\u306e\u30d3\u30eb\u30c9\u304c\u8d77\u52d5\n4. Jenkins\u306e\u30d3\u30eb\u30c9\u306fDockerPlugin\u3092\u901a\u3057\u3066Docker\u30b5\u30fc\u30d0\u30fc\u3092slave\u8d77\u52d5\u3057\u3066\u3001\u30d3\u30eb\u30c9\u3092\u884c\u3046\n5. \u7d50\u679c\u3092GitBucket\u306bStatusAPI\u3092\u901a\u3057\u3066\u901a\u77e5\u3059\u308b\n\n# \u30a4\u30e1\u30fc\u30b8\n\u7d75\u306b\u66f8\u304f\u3068\u3053\u3093\u306a\u611f\u3058\u306b\u306a\u308a\u307e\u3059\u3002\u30b7\u30f3\u30d7\u30eb\u3067\u3059\u3002\n![1f117eec-715a-42b8-babb-71ea790a7c09.png](https://qiita-image-store.s3.amazonaws.com/0/11214/13d8d5bd-5705-af87-6767-8832d4a8fce5.png)\n\n# \u30b4\u30fc\u30eb\n**GItBucket\u3067PullRequest\u3092\u51fa\u3057\u305f\u3089\u5b9f\u884c\u53ef\u80fd\u306aexe(Electron\u30a2\u30d7\u30ea)\u304c\u751f\u6210\u3055\u308c\u308b**\n\n\u30a8\u30f3\u30c9\u30e6\u30fc\u30b6\u30fc(**GItBucket**)\u304b\u3089\u306e\u8981\u6c42\u3092\u3001SIer(**Jenkins**)\u304c\u4e0b\u8acb\u3051(**Docker**)\u306b\u6d41\u3057\u3066\u50cd\u304b\u305b\u3001\u306a\u306b\u304f\u308f\u306c\u9854\u3067\u6210\u679c\u7269\u3092\u624b\u306b\u5165\u308c\u307e\u3059\u3002\u3068\u8a00\u3063\u305f\u3089\u4e00\u90e8\u306e\u65b9\u306b\u306f\u60f3\u50cf\u3057\u3084\u3059\u3044\u3067\u3059\u304b\u306d?\n\n# \u4e3b\u306a\u767b\u5834\u4eba\u7269\n\n## Jenkins\nCI\u30b5\u30fc\u30d0\u30fc\u3002\u30d0\u30fc\u30b8\u30e7\u30f3\u306f2.39\u3002AmazonLinux2016.09\u4e0a\u306b\u751f\u606f\u3002\n\nMaster-Slave\u69cb\u6210\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002Slave\u306fDocker\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3068\u3057\u3066\u7a3c\u50cd\u3055\u305b\u308b\u305f\u3081\u3001\u5b9f\u884c\u6642\u306fMaster\u304b\u3089Docker\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3057\u307e\u3059\u3002\nGitBucket\u3068\u9023\u643a\u3059\u308b\u305f\u3081\u306b[GitHub Organization folder](https://wiki.jenkins-ci.org/display/JENKINS/GitHub+Organization+Folder+Plugin)\u3092\u3001DockerSlave\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u3001[Docker Plugin]()\u3092\u4eca\u56de\u5229\u7528\u3057\u307e\u3059\u3002\n\n## GitBucket\nGitHub\u30af\u30ed\u30fc\u30f3\u3002\u30d0\u30fc\u30b8\u30e7\u30f3\u306f4.8\u3002AmazonLinux2016.09\u4e0a\u306b\u751f\u606f\u3002\n\n **GitHub\u306f\u4f7f\u3048\u306a\u3044\u3051\u3069GitBucket\u306f\u793e\u5185\u3067\u5229\u7528\u3067\u304d\u308b\u4eba** \u304c\u4eca\u56de\u306e\u5bfe\u8c61\u3002GitHub\u304c\u4f7f\u3048\u308b\u5e78\u305b\u306a\u4eba\u306f\u8aad\u3080\u5fc5\u8981\u3042\u308a\u307e\u305b\u3093\u3002GitBucket\u306eAPI\u3092GitHub Organization Folder\u3092\u5229\u7528\u3057\u3066\u7121\u7406\u3084\u308a\u5e78\u305b\u306b\u306a\u308d\u3046\u3068\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u306a\u304a\u3001GitBucket\u306eAPI\u306e\u4e0d\u8db3\u5206\u3092\u88dc\u3046\u305f\u3081\u306bJeknins\u304b\u3089\u76f4\u63a5GitBucket\u306b\u63a5\u7d9a\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\nJenkins <==> Nginx <==> GitBucket\u3068\u3044\u3046\u6d41\u308c\u3092\u8e0f\u3080\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n## Docker\n\u30b3\u30f3\u30c6\u30ca\u30d9\u30fc\u30b9\u306e\u4eee\u60f3\u74b0\u5883\u3002\u30d0\u30fc\u30b8\u30e7\u30f3\u306f1.12.1(API\u306f1.24)\u3002CoreOS alpha (1214.0.0)\u4e0a\u306b\u751f\u606f\u3002\nalpha\u306f\u305f\u307e\u305f\u307e\u3002\n\nDockerfile\u3092\u5229\u7528\u3057\u3066\u4e8b\u524d\u306b\u4eee\u60f3\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u305f\u30a4\u30e1\u30fc\u30b8\u3092\u6e96\u5099\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nJenkins\u304b\u3089\u63a5\u7d9a\u3055\u308c\u3001\u5b9f\u969b\u306e\u30d3\u30eb\u30c9\u3084\u30c6\u30b9\u30c8\u306f\u3053\u306e\u30b3\u30f3\u30c6\u30ca\u5185\u90e8\u3067\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\n# \u74b0\u5883\u69cb\u7bc9\n\n| \u30b5\u30fc\u30d0\u30fc | \u30d0\u30fc\u30b8\u30e7\u30f3 | \u540c\u5c45\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb  |\n|--------|----------|-------------|\n| Jenkins   | 2.39 | Nginx |\n| GitBucket | 4.8 | Jetty |\n| Docker    | 1.12.1 | (\u30b3\u30f3\u30c6\u30ca\u4e0a\u306b) nodejs |\n\n## GitBucket\u30b5\u30fc\u30d0\u30fc\n\n### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304b\u3089\u8d77\u52d5\n1. [GItBucket4.8](https://github.com/gitbucket/gitbucket/releases/tag/4.8)\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n2.  \u597d\u304d\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u30fc(\u79c1\u306fJetty)\u306b\u914d\u7f6e\u3057\u3066\u8d77\u52d5\u3057\u307e\u3059\u3002\n3. `http://GITBUCKET_SERVER:8080`\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044(\u3053\u3053\u3067\u306f\u4fbf\u5b9c\u7684\u306b`GITBUCKET_SERVER`\u3068\u3044\u3046host\u540d\u3067\u9032\u3081\u3066\u3044\u304d\u307e\u3059)\u3002\n4. \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u7528\u306bWeb\u30b5\u30fc\u30d0\u30fc\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059(\u79c1\u306fNginx\u3092\u5165\u308c\u307e\u3057\u305f)\u3002\n5. Nginx\u306e\u8a2d\u5b9a\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u307e\u3059\n   (\u53c2\u8003:[Multibranch Pipeline\u306b\u3088\u308bJenkins\u3068GitBucket\u306e\u9023\u643a](http://int128.hatenablog.com/entry/2016/10/06/224444))\u3002\n\n    ```/etc/nginx/nginx.conf\n    # server\u306e\u5b9a\u7fa9\u306b\u4ee5\u4e0b\u3092location\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\n    location ~ ^/[^/]+/[^/]+\\.git.*$ {\n            return http://GITBUCKET_SERVER:8080/git$request_uri;\n    }\n\n    location ~ ^/api/v3/users/(.*)$ {\n            try_files $uri /api/v3/orgs/$1;\n    }\n\n    location / {\n            proxy_pass http://GITBUCKET_SERVER:8080;\n            client_max_body_size 10M;\n            proxy_set_header Host $host;\n    }\n    ```\n6. Nginx\u306e\u8a2d\u5b9a\u3092\u53cd\u6620\u3055\u305b\u307e\u3059\n\n    ```bash\n    nginx -s reload\n    ````\n7. `http://GITBUCKET_SERVER/`\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n8. `root`/`root`(\u521d\u671f\u30e6\u30fc\u30b6\u30fc)\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3001\u4efb\u610f\u306e\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u307e\u3059(\u3053\u3053\u3067\u306f`JGROUP`\u3068\u3044\u3046\u540d\u524d\u306e\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u308a\u307e\u3059)\u3002\n8. Nginx\u3092\u7d4c\u7531\u3057\u305f\u3053\u3068\u3067GitBucket\u3067\u306f\u53d7\u3051\u4ed8\u3051\u3066\u3044\u306a\u304b\u3063\u305f\u4ee5\u4e0b\u306eAPI\u304c\u5b9f\u884c\u3067\u304d\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n    ```bash\n    # jq\u306f\u304a\u597d\u307f\u3067\n    $ export GITBUCKET_SERVER=127.0.0.1\n    $ export GROUP_NAME=JGROUP\n    # nginx\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u3001{ \"message\": \"Not Found\" } \u304c\u8fd4\u308b\n    $ curl http://$GITBUCKET_SERVER:8080/api/v3/users/$GROUP_NAME | jq .\n    {\n      \"message\": \"Not Found\"\n    }\n    # nginx\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u30b0\u30eb\u30fc\u30d7\u306e\u60c5\u5831\u304c\u8fd4\u308b\n    $ curl http://$GITBUCKET_SERVER/api/v3/users/$GROUP_NAME | jq .\n    {\n      \"login\": \"JGROUP\",\n      \"email\": \"JGROUP@devnull\",\n      \"type\": \"Organization\",\n      \"site_admin\": false,\n      \"created_at\": \"2016-01-19T00:55:00Z\",\n      \"url\": \"http://GITBUCKET_SERVER:8080/api/v3/users/JGROUP\",\n      \"html_url\": \"http://GITBUCKET_SERVER:8080/JGROUP\",\n      \"avatar_url\": \"http://GITBUCKET_SERVER:8080/JGROUP/_avatar\"\n    }    \n    ```\n\n### \u30e6\u30fc\u30b6\u30fc\u8a2d\u5b9a\u3068\u30ea\u30dd\u30b8\u30c8\u30ea\u4f5c\u6210\n1. GitBucket\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n2. Jenkins\u7528\u306e\u30e6\u30fc\u30b6\u30fc\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n3. Jenkins\u7528\u306eSSH\u9375\u3092\u767b\u9332\u3057\u3066\u304a\u304d\u307e\u3059(TODO)\u3002\n    12. `http://GITBUCKET_SERVER:8080/jenkins/_ssh`\u3078\u79fb\u52d5\n    13. \u79d8\u5bc6\u9375\u30922\u3064\u767b\u9332\u3057\u307e\u3059(\u767b\u9332\u306e\u4ed5\u65b9\u306f\u7701\u7565)\u3002  \n        * jenkins => jenkins\u30de\u30b9\u30bf\u30fc\u304b\u3089\u63a5\u7d9a\u3092\u884c\u3046\u305f\u3081\u306essh\u9375\u60c5\u5831\u3067\u3059\u3002\n        * jenkins-slave => Docker\u4e0a\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u63a5\u7d9a\u3092\u884c\u3046\u305f\u3081\u306essh\u9375\u60c5\u5831\u3067\u3059\u3002\n12. \u4e0a\u8a18\u3067\u4f5c\u3063\u305fJGROUP\u306b\u4f5c\u6210\u3057\u305fjenkis\u30e6\u30fc\u30b6\u30fc\u3092\u8ffd\u52a0\u3057\u3001\u30b0\u30eb\u30fc\u30d7\u306b\u4efb\u610f\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n13. \u30c6\u30b9\u30c8\u7528\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306aJenkinsfile\u3092\u767b\u9332\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n    ```groovy:Jenkinsfile\n    node(\"ubuntu-base\") {\n        stage(\"hello\") {\n            echo \"world\"\n        }\n    }\n    ```\n\u3053\u308c\u3067GitBucket\u5074\u306e\u8a2d\u5b9a\u306f\u7d42\u4e86\u3067\u3059\u3002\n\n## Docker\u30b5\u30fc\u30d0\u30fc\n\n### Docker\u30b5\u30fc\u30d0\u30fc\u306e\u8a2d\u5b9a\n1. \u597d\u304d\u306aDokcer\u306e\u30db\u30b9\u30c8\u30fc\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3057\u307e\u3059(\u79c1\u306e\u5834\u5408\u306fCoreOS\u3092\u9078\u629e)\n2. `tcp`\u30d7\u30ed\u30c8\u30b3\u30eb\u3067\u5916\u90e8\u304b\u3089\u63a5\u7d9a\u53ef\u80fd\u306a\u3088\u3046\u306b\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059  \n    3. `docker-tcp.socket`\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n        ```ini:/etc/systemd/system/docker-tcp.socket\n        [Unit]\n        Description=Docker Socket for the API\n        \n        [Socket]\n        ListenStream=2376\n        BindIPv6Only=both\n        Service=docker.service\n        \n        [Install]\n        WantedBy=sockets.target\n        ```   \n      ***\u6ce8\u610f\u4e8b\u9805*** (\u53c2\u8003:[\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306e\u5411\u3053\u3046\u5074\u306b\u3042\u308bDocker\u3092\u4f7f\u3046](https://beatsync.net/main/log20141212.html))\n      * tcp\u3067\u306e\u63a5\u7d9a\u3092\u5168\u8a31\u53ef\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u7684\u306b\u554f\u984c\u304c\u3042\u308a\u307e\u3059\u3002\n      * \u5f53\u521d[Protect the Docker daemon socket](https://docs.docker.com/engine/security/https/)\u3067\u8a2d\u5b9a\u3057\u3088\u3046\u3068\u3057\u305f\u306e\u3067\u3059\u304c\u3001Jenkins\u306eDockerPlugin\u304ctcp\u304bunix\u30d7\u30ed\u30c8\u30b3\u30eb\u3057\u304b\u53d7\u3051\u4ed8\u3051\u3066\u3044\u306a\u304b\u3063\u305f\u305f\u3081\u3001\u3042\u304d\u3089\u3081\u307e\u3057\u305f(\u5b9f\u969b\u306b\u306f\u30a4\u30f3\u30d5\u30e9\u30ec\u30d9\u30eb\u3067IP\u5358\u4f4d\u3067\u30a2\u30af\u30bb\u30b9\u5236\u9650\u3092\u304b\u3051\u308b\u3064\u3082\u308a\u3067\u3059\u3002\u307e\u3060\u3084\u3063\u3066\u306a\u3044\u3051\u3069)\u3002\n    3. docker\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\n\n        ```bash\n        $ sudo systemctl enable docker-tcp.socket\n        $ sudo systemctl stop docker\n        $ sudo systemctl start docker-tcp.socket\n        $ sudo systemctl start docker\n        ```\n3. \u63a5\u7d9a\u78ba\u8a8d\u3092\u3057\u307e\u3059\u3002Jenkins\u30b5\u30fc\u30d0\u30fc\u304b\u3089`curl`\u304c\u901a\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n    ```bash\n    $ curl http://127.0.0.1:2376/images/json\n    ```\n\n### \u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u306e\u69cb\u7bc9\n1. Jenkins\u304b\u3089\u63a5\u7d9a\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u306a\u30d9\u30fc\u30b9\u3068\u306a\u308bDockerImage\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002\n     \u4eca\u56de\u306f\u3053\u3093\u306a\u611f\u3058\u306b\u30d9\u30fc\u30b9\u3068\u306a\u308bDockerfile\u3092\u69cb\u7bc9\u3057\u307e\u3057\u305f(\u96d1\u3067\u3059)\u3002\n\n     ```Dockerfile\n    FROM ubuntu:16.10\n     \n    #-----------------------------------------------------------\n     \n    # \u5404\u7a2e\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n    # jenkins\u30e6\u30fc\u30b6\u30fc\u306e\u8ffd\u52a0\n    # ssh\u63a5\u7d9a\u3092\u8a31\u53ef\n    # \u4e00\u90e8\u5f8c\u8ff0\u3059\u308belectron\u306e\u74b0\u5883\u69cb\u7bc9\u306b\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u542b\u3080\n    RUN set -x \\\n      && apt-get update \\\n      && apt-get -y install --no-install-recommends \\\n          sudo \\\n          software-properties-common \\\n          openssh-server \\\n          curl \\\n          wget \\\n          git \\\n          unzip \\\n          zip \\\n          apt-transport-https \\\n      && mkdir ~/.ssh \\\n      && mkdir /var/run/sshd \\\n      && groupadd jenkins && useradd -d /home/jenkins -g jenkins -m jenkins \\\n      && mkdir /home/jenkins/.ssh \\\n      && rm -rf /var/lib/apt/lists/*\n\n    # 22\u30dd\u30fc\u30c8\u3092\u516c\u958b     \n    EXPOSE 22\n     \n    # jenkins\u304b\u3089gitbucket\u3078\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306e\u8a8d\u8a3c\u60c5\u5831\u3092\u8a2d\u5b9a\n    # http\u63a5\u7d9a\u304c\u3067\u304d\u306a\u3044\u306e\u3067ssh\u3067\u63a5\u7d9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\n    COPY files/config ~/.ssh/config\n    COPY files/config /home/jenkins/.ssh/config\n    COPY files/id_jenkins_rsa.pub /home/jenkins/.ssh/authorized_keys\n    COPY files/id_gitbucket_rsa /home/jenkins/.ssh/id_rsa\n\n    RUN set -x \\\n      && chown -R jenkins:jenkins /home/jenkins/.ssh \\\n      && chmod 700 /home/jenkins/.ssh \\\n      && chmod 600 /home/jenkins/.ssh/*\n\n     ```\n2. \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\n\n    ```bash\n    $ cd ubuntu-base\n    $ find .\n    .\n    ./files\n    ./files/id_gitbucket_rsa\n    ./files/id_jenkins_rsa\n    ./files/config\n    ./files/id_jenkins_rsa.pub\n    ./files/id_gitbucket_rsa.pub\n    ./Dockerfile\n    ./README.md\n    $ docker build -t ubuntu:ubuntu-base .\n    ```\n4. Electron\u306e\u30d3\u30eb\u30c9\u74b0\u5883\u69cb\u7bc9\u306e\u305f\u3081\u306eDockerImage\u3092\u4f5c\u308a\u307e\u3059\n\n     ```Dockerfile\n    FROM ubuntu:16.10\n\n    #---------------------------\n    WORKDIR /usr/local\n     \n    ENV NDENV_ROOT /usr/local/ndenv\n    ENV PATH \"$NDENV_ROOT/bin:$PATH\"\n     \n    # \u30d3\u30eb\u30c9\u7528\u306bndenv\u3068yarn\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n    RUN set -x \\\n      && git clone https://github.com/riywo/ndenv.git /usr/local/ndenv \\\n      && mkdir /usr/local/ndenv/plugins \\\n      && git clone https://github.com/riywo/node-build.git /usr/local/ndenv/plugins/node-build \\\n      && (\\\n          echo 'export NDENV_ROOT=/usr/local/ndenv'; \\\n          echo 'export PATH=\"$NDENV_ROOT/bin:$PATH\"'; \\\n          echo 'eval \"$(ndenv init -)\"' \\\n        ) >> /etc/profile.d/ndenv.sh \\\n      && ndenv install v6.1.0 \\\n      && ndenv global v6.1.0 \\\n      && chmod +777 -R /usr/local/ndenv \\\n      && curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add - \\\n      && echo \"deb https://dl.yarnpkg.com/debian/ stable main\" | sudo tee /etc/apt/sources.list.d/yarn.list \\\n      && sudo apt-get update \\\n      && sudo apt-get install yarn -y\n    ```\n\n2. \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\n\n    ```bash\n    $ cd ubuntu-electron\n    $ find .\n    .\n    ./files\n    ./files/id_gitbucket_rsa\n    ./files/id_jenkins_rsa\n    ./files/config\n    ./files/id_jenkins_rsa.pub\n    ./files/id_gitbucket_rsa.pub\n    ./Dockerfile\n    ./README.md\n    $ docker build -t ubuntu:ubuntu-electron .\n    ```\n\n\u4ee5\u4e0a\u3067Docker\u30b5\u30fc\u30d0\u30fc\u306e\u8a2d\u5b9a\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n## Jenkins\u30b5\u30fc\u30d0\u30fc\n\n### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304b\u3089\u8d77\u52d5\n1. [Jenkins\u306eLTS Release](https://jenkins.io/)\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n2. \u304a\u597d\u304d\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u30fc(\u79c1\u306fJetty)\u306b\u914d\u5099\u3057\u307e\u3059\u3002\u305f\u3060\u3057\u307e\u3060\u8d77\u52d5\u306f\u3057\u307e\u305b\u3093\u3002\n3. Jenkins\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f`$HOME/.jenkins`\u4ee5\u4e0b\u306b\u5fc5\u8981\u306a\u30c7\u30fc\u30bf\u3092\u69cb\u7bc9\u3057\u307e\u3059\u306e\u3067\u3001\u4e8b\u524d\u306b`$HOME/.jenkins`\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u3001`$HOME/.jenkins/init.groovy`\u3068\u3044\u3046\u540d\u524d\u3067\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\u3057\u307e\u3059\u3002\n    (\u53c2\u8003:[Jenkins\u306e\u516c\u5f0fDocker\u30a4\u30e1\u30fc\u30b8\u4f7f\u3063\u3066\u307f\u305f](http://knjname.hateblo.jp/entry/2015/02/10/040833))\n\n    ```init.groovy\n    import hudson.model.*;\n    import hudson.security.*\n    import jenkins.model.*;\n\n    def instance = Jenkins.instance\n\n    //  \u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u30fc\u3092\u81ea\u52d5\u751f\u6210\n    // https://groups.google.com/d/msg/jenkinsci-users/Pb4QZVc2-f0/5hzCC-syNgAJ\n    def hudsonRealm = new HudsonPrivateSecurityRealm(false)\n    hudsonRealm.createAccount('admin','admin')\n    instance.setSecurityRealm(hudsonRealm)\n\n    def strategy = new FullControlOnceLoggedInAuthorizationStrategy()\n    instance.setAuthorizationStrategy(strategy)\n    instance.save()\n    \n    def uCenter = instance.updateCenter\n    uCenter.updateAllSites()\n    \n    def checkIfPluginInstalled = { pluginid ->\n      for(p in instance.pluginManager.plugins) {\n        if(p.shortName == pluginid){\n          return true\n        }\n      }\n      return false\n    }\n    \n    // Installs the following plugins if not installed.\n    [\n      \"cloudbees-folder\",\n      \"antisamy-markup-formatter\",\n      \"build-timeout\",\n      \"credentials-binding\",\n      \"timestamper\",\n      \"ws-cleanup\",\n      \"gradle\",\n      \"workflow-aggregator\",\n      \"github-organization-folder\",\n      \"pipeline-stage-view\",\n      \"git\",\n      \"ssh-slaves\",\n      \"matrix-auth\",\n      \"pam-auth\",\n      \"ldap\",\n      \"email-ext\",\n      \"mailer\",\n      \"docker-plugin\",\n      \"ghprb\"\n    ].findAll({! checkIfPluginInstalled(it)}).each {\n      uCenter.getPlugin(it).deploy()\n    }\n    \n    // Set the number of executors (in master-node) to 0.\n    instance.setNumExecutors(0)\n    \n    instance.reload()\n    ```\n4. Jenkins\u3092\u8d77\u52d5\u3059\u308b\u3068\u3001init.groovy\u304c\u8aad\u307f\u8fbc\u307e\u308c\u3066admin\u30e6\u30fc\u30b6\u30fc\u3068\u5fc5\u8981\u306a\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3059\u3002\n\n### \u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u8a2d\u5b9a\n\u5fc5\u8981\u306a\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u8a2d\u5b9a\u3092\u884c\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\n#### Docker Plugin\n1. `http://JENKINS_SERVER:8080/configure`\u3078(Jenkins\u306e\u7ba1\u7406 => \u30b7\u30b9\u30c6\u30e0\u8a2d\u5b9a)\u3002\n1. `\u30af\u30e9\u30a6\u30c9` => `\u8ffd\u52a0` => `Docker`\u3092\u9078\u629e\n    * \u5404\u7a2e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059  \n        <img width=\"400\" alt=\"577c18fd-3e7f-4803-9d34-c2f4b1bafc9a.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/11214/96ea8fa9-f643-f801-da06-2bb352e7f5b2.png\">\n        * Name\u306f\u4efb\u610f\n        * Docker URL\u306f`tcp`\u3042\u308b\u3044\u306f`unix`\u306e\u307f\u304c\u6307\u5b9a\u53ef\u80fd\u3067\u3059\u3002http\u306f\u4e0d\u53ef\n        * Docker API Version\u306fCoreOS\u4e0a\u3067`docker version`\u3068\u6253\u3064\u3053\u3068\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n    * `Images` => `Add Docker Template`\u3067\u5229\u7528\u3059\u308bDocker\u540d\u3092\u7d10\u3064\u3051\u307e\u3059\u3002  \n        <img width=\"689\" alt=\"aab5a067-4347-4e2c-af50-c7499739e89b.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/11214/2c00a95b-49a5-15bd-4359-4e0c15e25532.png\">\n        * `Docker Image` => Docker\u306e\u8a2d\u5b9a\u3067\u4f5c\u6210\u3057\u305fImage\u540d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n        * `Remote Filing System Root` => Dockerfile\u3067\u4f5c\u6210\u3057\u305fjenkins\u30e6\u30fc\u30b6\u30fc\u306ehome\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3057\u307e\u3059\n        * `Label` => Jenkinsfile\u306enode\u306e\u6307\u5b9a\u3068\u306a\u308bslave\u540d\u3067\u3059\u3002\n        * `\u7528\u9014` => `\u3053\u306e\u30de\u30b7\u30fc\u30f3\u3092\u7279\u5b9a\u30b8\u30e7\u30d6\u5c02\u7528\u306b\u3059\u308b`\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n        * `Lanunch method` => Docker SSH computer launcher\u3092\u9078\u629e\u3057\u307e\u3059\u3002\u8a8d\u8a3c\u60c5\u5831\u306f\u3001Dockerfile\u5185\u3067\u5b9a\u7fa9\u3057\u305f\u79d8\u5bc6\u9375\u3092\u4f7f\u3044\u307e\u3059\u3002\n    * Images\u306e`Configuration setting...` => `Volumes`\u3067\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u305f\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6c38\u7d9a\u5316\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n      \u4eca\u56de\u306fyarn\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u30d5\u30a9\u30eb\u30c0\u3068electron\u306e\u30d0\u30a4\u30ca\u30ea\u3092\u30db\u30b9\u30c8\u5074\u306b\u30de\u30a6\u30f3\u30c8\u3059\u308b\u305f\u3081\u306b\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\n      \n      ```\n      /home/core/cache/yarn:/home/jenkins/.cache/yarn/\n      /home/core/cache/electron:/home/jenkins/.electron/\n      ```\n\n#### GitHub Organization Folder\n1. `http://JENKINS_SERVER:8080/configure`\u3078(Jenkins\u306e\u7ba1\u7406 => \u30b7\u30b9\u30c6\u30e0\u8a2d\u5b9a)\u3002\n1. `GitHub Enterprise Servers`\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002  \n    <img width=\"400\" alt=\"60617ccd-9aed-4ba3-866e-0fdbac6c31c0.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/11214/802ca48b-8156-2b72-5a40-b80ad0150b72.png\">\n    * `API endpoint` => `http://GITBUCKET_SERVER/api/v3/`\n    * `Name` => \u9069\u5f53\u306b(AWS-GIT\u3068\u3064\u3051\u307e\u3057\u305f)\n\n### JOB\u4f5c\u6210\n1. `\u65b0\u898f\u30b8\u30e7\u30d6`\u3067GitHub Organization Folder\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n    \u4efb\u610f\u306e\u540d\u524d\u3092\u3064\u3051\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u304c\u3001\u8a2d\u5b9a\u3057\u305f\u540d\u524d\u304c\u30ea\u30dd\u30b8\u30c8\u30ea\u306eowner(\u30e6\u30fc\u30b6\u30fcor\u30b0\u30eb\u30fc\u30d7)\u306b\u306a\u308a\u307e\u3059\u3002\u5bfe\u8c61\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u30b0\u30eb\u30fc\u30d7\u306f\u5f8c\u3067\u5909\u66f4\u53ef\u80fd\u3067\u3059\u3002<img width=\"400\" alt=\"6a794f28-f792-4a63-b17c-11f82ba8fa5d.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/11214/705d02d3-23e1-9302-dd71-eae0d6b0f1e7.png\">\n1. \u8a2d\u5b9a\u753b\u9762\u304c\u958b\u304f\u306e\u3067\u3001`Project Sources`\u304b\u3089`Repository Sources` \u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002<img width=\"400\" alt=\"4901e517-357d-437e-84b5-88724943aee3.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/11214/b30ed7fb-a41e-efdf-afbd-cf3bfe220faa.png\">\n    * Owner --- \u6307\u5b9a\u3057\u305f\u30e6\u30fc\u30b6\u30fcor\u30b0\u30eb\u30fc\u30d7\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u4ee5\u4e0b\u3092\u63a2\u7d22\u3057\u307e\u3059\n    * API endpoint --- \u63a5\u7d9a\u5148\u306e\u30b5\u30fc\u30d0\u30fc\u3092\u30b7\u30b9\u30c6\u30e0\u8a2d\u5b9a\u3067\u8a2d\u5b9a\u3057\u305fGitBucket\u306e\u540d\u524d\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n2. \u3046\u307e\u304f\u3044\u3051\u3070\u6307\u5b9a\u3057\u305f\u30b0\u30eb\u30fc\u30d7\u914d\u4e0b\u304c\u30b9\u30ad\u30e3\u30f3\u3055\u308c`Jenkinsfile`\u304c\u5b58\u5728\u3059\u308b\u30ea\u30dd\u30b8\u30c8\u30ea\u304c\u4e00\u89a7\u306b\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n    * \u30b9\u30ad\u30e3\u30f3\u5b8c\u4e86\u5f8c<br /><img width=\"400\" alt=\"9d32f5cb-06f4-4abd-90b4-84ce68bf2010.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/11214/aaca994d-0058-0909-3241-056233131515.png\">\n    * \u30d6\u30e9\u30f3\u30c1\u4e00\u89a7<br /><img width=\"400\" alt=\"e8576f72-36b5-471e-aa7a-b657b743bd2c.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/11214/3c88965d-0298-8550-a0ca-7b2ec53f381e.png\">\n    * \u30d3\u30eb\u30c9\u7d50\u679c<br /><img width=\"400\" alt=\"acffee48-dc5b-4dd9-9210-fe52531680fe.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/11214/0c8a20f4-055d-234b-ffea-9479ae1b34df.png\">\n\n# \u30b4\u30fc\u30eb\u3092\u78ba\u8a8d\n\u3084\u308a\u305f\u3044\u4e8b\u304c\u51fa\u6765\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n1. GitBucket\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u4e0a\u306b\u7c21\u5358\u306aElectron\u30a2\u30d7\u30ea\u3092PUSH\u3057\u307e\u3059\u3002Jenkins\u30d5\u30a1\u30a4\u30eb\u306b\u306f\u6210\u679c\u7269\u3092\u4fdd\u5b58\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u8a18\u8f09\u3057\u3066\u304a\u304d\u307e\u3059( TODO \u30b5\u30f3\u30d7\u30eb\u30bd\u30fc\u30b9)\u3002\n2. Re-Scan\u3057\u3066\u8a8d\u8b58\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n3. GitBucket\u4e0a\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u4e0a\u306b\u30d6\u30e9\u30f3\u30c1\u3092\u5207\u308a\u3001PullRequest\u3092\u51fa\u3057\u307e\u3059\u3002\n4. PullRequest\u304c\u51fa\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067Jenkins\u30d3\u30eb\u30c9\u304c\u8d70\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n   <img width=\"400\" alt=\"c8484347-6344-4fbb-9899-c66c8850894b.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/11214/eac739e1-06a6-07ad-bd0d-64aa6f6d11f5.png\">\n   <img width=\"400\" alt=\"842972e0-adb4-4e16-8fc4-7e003a6eaae8.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/11214/8daadf43-f1db-3557-7fb0-69b2fae6305e.png\">\n5. Jenkins\u30d3\u30eb\u30c9\u304c\u5b8c\u4e86\u5f8c\u306b\u6210\u679c\u7269\u304c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n# \u30cf\u30de\u30ea\u30dd\u30a4\u30f3\u30c8(\u307e\u3068\u3081)\n\n* `GitHub Organization folder`\u3067\u30b9\u30ad\u30e3\u30f3\u3057\u3066\u3082GitBucket\u306b\u7e4b\u304c\u3089\u306a\u3044\n    * \u4e0a\u8a18\u624b\u9806\u306b\u3057\u305f\u304c\u3063\u3066WEB\u30b5\u30fc\u30d0\u30fc\u3067\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u3044\u3058\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n* `DockerPlugin`\u304b\u3089[Protect the Docker daemon socket](https://docs.docker.com/engine/security/https/)\u3067\u304d\u306a\u3044\u3002\n    * \u73fe\u5728\u306e\u30d0\u30fc\u30b8\u30e7\u30f3(DockerPlugin 0.16.2)\u3060\u3068https\u306f\u8a2d\u5b9a\u3067\u304d\u307e\u305b\u3093\u3002\n* Slave\u3068\u3057\u3066\u8d77\u52d5\u3057\u3066\u3044\u308bDocker\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bJenkins\u304b\u3089\u63a5\u7d9a\u51fa\u6765\u306a\u3044\u3002\n    * DockerPlugin\u306e\u63a5\u7d9a\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\u5fc5\u8981\u306a\u79d8\u5bc6\u9375\u306fDocker\u306b\u63a5\u7d9a\u3059\u308b\u8a8d\u8a3c\u60c5\u5831\u3067\u306f\u306a\u304f\u3066\u3001Docker\u4e0a\u306b\u5b58\u5728\u3059\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306e\u79d8\u5bc6\u9375\u3067\u3059\u3002\n* Docker\u4e0a\u304b\u3089GitBucket\u306e\u30bd\u30fc\u30b9\u3092clone\u51fa\u6765\u306a\u3044\n    * `https`\u30d7\u30ed\u30c8\u30b3\u30eb\u3084`git`\u30d7\u30ed\u30c8\u30b3\u30eb\u3067\u306f\u63a5\u7d9a\u51fa\u6765\u307e\u305b\u3093\u3002`ssh`\u3067\u63a5\u7d9a\u3057\u307e\u3057\u3087\u3046\u3002\n\n# \u30aa\u30c1\nGitHub\u306f\u4fbf\u5229\u3067\u3059\u3002\u3067\u3082\u4f1a\u793e\u3067\u306fGitBucket\u4f7f\u3044\u7d9a\u3051\u3066\u3044\u304f\u3064\u3082\u308a\u3067\u3059\u3002\n", "tags": ["Jenkins", "docker", "GitBucket", "Electron"]}