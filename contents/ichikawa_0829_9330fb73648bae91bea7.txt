{"tags": ["LineNotify", "laravel", "PHP"], "context": "\u3053\u308c\u306e\u7d9a\u304d\u3067\u3059\u3002\n\u307e\u305a\u306f\u7ba1\u7406\u753b\u9762\u304b\u3089\u30b5\u30fc\u30d3\u30b9\u767b\u9332\u3057\u307e\u3059\n\n\u9805\u76ee\u3092\u57cb\u3081\u3066\u767b\u9332\u304c\u5b8c\u4e86\u3059\u308b\u3068\u30b5\u30fc\u30d3\u30b9\u4e00\u89a7\u306b\u8ffd\u52a0\u3055\u308c\u3001\u305d\u306e\u5148\u306e\u30da\u30fc\u30b8\u306b\u767b\u9332\u3057\u305f\u5185\u5bb9\u3068\u8a8d\u8a3c\u306b\u5fc5\u8981\u306a\u60c5\u5831\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u9805\u76ee\u3092\u30e1\u30e2\u3057\u307e\u3059\u3002\n\u30fbClient ID\n\u30fbClient Secret\n\u30fbCallback URL\n\u3067\u306f\u3001\u5f15\u304d\u7d9a\u304dLaravel\u3067\u3084\u3063\u3066\u307f\u307e\u3059\u3002\n\u203b\u3068\u308a\u3042\u3048\u305a\u3069\u3046\u3044\u3046\u611f\u3058\u306a\u306e\u304b\u898b\u305f\u304f\u3066\u9069\u5f53\u306b\u66f8\u3044\u305f\u306e\u3067\u304b\u306a\u308a\u9069\u5f53\u3067\u3059\u3002\u3054\u3081\u3093\u306a\u3055\u3044\u3002\u3061\u3083\u3093\u3068\u3084\u308b\u6642\u306f\u3044\u3044\u611f\u3058\u306eOAuth\u30e9\u30a4\u30d6\u30e9\u30ea\u4f7f\u3063\u3066\u3061\u3083\u3093\u3068\u66f8\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\u203b\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u6642\u306bCSRF Token\u30df\u30b9\u30de\u30c3\u30c1\u3067\u30a8\u30e9\u30fc\u306b\u306a\u3063\u305f\u308a\u3057\u307e\u3057\u305f\u304c\u3001\u4e00\u65e6\u52d5\u304b\u3057\u305f\u304b\u3063\u305f\u3093\u3067MiddleWare\u5916\u3057\u307e\u3057\u305f\u3002\n\n.env\nLINE_NOTIFY_CLIENT_ID=<Client ID>\nLINE_NOTIFY_CLIENT_SECRET=<Client Secret>\nLINE_NOTIFY_CLIENT_CALLBACK_URI=<Callback URL>\n\n\n\nconfig/services.php\n<?php\nreturn [\n\n    'line_notify' => [\n        'client_id' => env('LINE_NOTIFY_CLIENT_ID'),\n        'secret'    => env('LINE_NOTIFY_CLIENT_SECRET'),\n        'redirect_uri' => env('LINE_NOTIFY_CLIENT_CALLBACK_URI')\n    ]\n];\n\n\n\napp/Http/routes.php\nRoute::group(['prefix' => 'notify'], function () {\n    Route::get('/', 'LineNotifyController@index');\n    Route::get('/auth', 'LineNotifyController@redirectToProvider');\n    Route::post('/callback', 'LineNotifyController@handleProviderCallback');\n    Route::post('/send', 'LineNotifyController@send');\n});\n\n\n\napp/Http/Controllers\n<?php\n\nnamespace App\\Http\\Controllers;\n\nuse GuzzleHttp\\Client;\n\nclass LineNotifyController extends Controller\n{\n    public function index()\n    {\n        return view('line_notify.index');\n    }\n\n    public function redirectToProvider()\n    {\n        $uri = 'https://notify-bot.line.me/oauth/authorize?' .\n            'response_type=code' . '&' .\n            'client_id=' . config('services.line_notify.client_id') . '&' .\n            'redirect_uri=' . config('services.line_notify.redirect_uri') . '&' .\n            'scope=notify' . '&' .\n            'state=' . csrf_token() . '&' .\n            'response_mode=form_post';\n        return redirect($uri);\n    }\n\n    public function handleProviderCallback()\n    {\n        $uri = 'https://notify-bot.line.me/oauth/token';\n        $client = new Client();\n        $response = $client->post($uri, [\n            'headers'     => [\n                'Content-Type' => 'application/x-www-form-urlencoded',\n            ],\n            'form_params' => [\n                'grant_type'    => 'authorization_code',\n                'code'          => request('code'),\n                'redirect_uri'  => config('services.line_notify.redirect_uri'),\n                'client_id'     => config('services.line_notify.client_id'),\n                'client_secret' => config('services.line_notify.secret')\n            ]\n        ]);\n        // \u3053\u306e\u74b0\u5883DB\u3068\u304b\u5165\u308c\u3066\u306a\u3044\u3093\u3067\u3068\u308a\u3042\u3048\u305a\u30bb\u30c3\u30b7\u30e7\u30f3\u306b\u5165\u308c\u3068\u304d\u307e\u3059\n        $access_token = json_decode($response->getBody())->access_token;\n        \\Session::set('access_token', $access_token);\n        return redirect('/notify');\n    }\n\n    public function send()\n    {\n        $uri = 'https://notify-api.line.me/api/notify';\n        $client = new Client();\n        $client->post($uri, [\n            'headers' => [\n                'Content-Type'  => 'application/x-www-form-urlencoded',\n                'Authorization' => 'Bearer ' . session('access_token'),\n            ],\n            'form_params' => [\n                'message' => request('message', 'Hello World!!')\n            ]\n        ]);\n        return redirect('/notify');\n    }\n}\n\n\n\n\nresources/views/line_notify/index.blade.php\n<a href=\"/notify/auth\">Line Notify Auth</a>\n\n@if(Session::has('access_token'))\n    <form action=\"/notify/send\" method=\"post\">\n        <input type=\"hidden\" value=\"{{ session('access_token') }}\">\n        <label>\n            \u30e1\u30c3\u30bb\u30fc\u30b8\n            <input type=\"text\" name=\"message\" value=\"\">\n        </label>\n        <input type=\"submit\" value=\"\u9001\u4fe1\">\n    </form>\n@endif\n\n\n\u3053\u308c\u3067\u6e96\u5099\u5b8c\u4e86\u3067\u3059\u3002\n\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3053\u3093\u306a\u753b\u9762\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u30ea\u30f3\u30af\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u8a8d\u8a3c\u753b\u9762\u306b\u98db\u3070\u3055\u308c\u307e\u3059\n\n\u81ea\u5206\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u8a8d\u8a3c\u3092\u3059\u308b\u3068\u30c8\u30fc\u30af\u30eb\u30fc\u30e0\u306e\u9078\u629e\u753b\u9762\u306b\u9077\u79fb\u3057\u307e\u3059\n\n\u30c8\u30fc\u30af\u30eb\u30fc\u30e0\u3092\u9078\u629e\u3057\u3066\u300c\u540c\u610f\u3057\u3066\u9023\u643a\u3059\u308b\u300d\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001\u81ea\u5206\u3067\u8a2d\u5b9a\u3057\u305f\u30b3\u30fc\u30eb\u30d0\u30c3\u30afURL\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u307e\u3059\u3002\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u6b04\u306b\u5165\u529b\u3057\u3066\u9001\u4fe1\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u5c4a\u304d\u307e\u3059\u3002\n\n\n\u307e\u3068\u3081\n\nLineBot\u3092\u8a66\u3057\u305f\u6642\u306b\u8a3c\u660e\u66f8\u3068\u304b\u8a2d\u5b9a\u3057\u305f\u30b5\u30fc\u30d0\u30fc\u3092\u4f5c\u3063\u3066\u3042\u3063\u305f\u305b\u3044\u304b\u51c4\u304f\u7c21\u5358\u3067\u3057\u305f\u3002(\u305d\u306e\u8fba\u306a\u3044\u3068\u5d4c\u307e\u308b\u304b\u3082\uff1fHeroku\u3068\u304b\u4f7f\u3048\u3070\u5927\u4e08\u592b\u3060\u308d\u3046\u3051\u3069)\n\u591a\u5206\u3061\u3083\u3093\u3068\u3057\u305fOAuth\u30e9\u30a4\u30d6\u30e9\u30ea\u4f7f\u3048\u3070\u304b\u306a\u308a\u7c21\u5358\u306b\u5b9f\u88c5\u51fa\u6765\u308b\u6c17\u304c\u3057\u307e\u3059\u3002\nAPI Rate Limit\u306f1000call/hour\u307d\u3044\u3067\u3059\u3002\n\n*https://line.bots.jp/notify \u3067\u516c\u958b\u3057\u3066\u308b\u306e\u3067\u8a66\u3057\u3066\u3044\u305f\u3060\u3044\u3067\u5927\u4e08\u592b\u3067\u3059\u304c\u3001\u544a\u77e5\u306a\u3057\u3067\u5909\u66f4\u3057\u305f\u308a\u9589\u3058\u305f\u308a\u3057\u307e\u3059\u3002\n\u3059\u3044\u307e\u305b\u3093\u3002\u30a4\u30bf\u30ba\u30e9\u304c\u591a\u304b\u3063\u305f\u306e\u3067\u505c\u6b62\u3057\u307e\u3057\u305f\u3002\n[\u3053\u308c](http://qiita.com/ichikawa_0829/items/fd85cd5f73b3d297a5b1)\u306e\u7d9a\u304d\u3067\u3059\u3002\n\n\u307e\u305a\u306f\u7ba1\u7406\u753b\u9762\u304b\u3089\u30b5\u30fc\u30d3\u30b9\u767b\u9332\u3057\u307e\u3059\n<img width=\"400\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-09-29 15.39.03.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/14172/fdfa93fc-e5be-e336-81df-600650e14fff.png\">\n\n\u9805\u76ee\u3092\u57cb\u3081\u3066\u767b\u9332\u304c\u5b8c\u4e86\u3059\u308b\u3068\u30b5\u30fc\u30d3\u30b9\u4e00\u89a7\u306b\u8ffd\u52a0\u3055\u308c\u3001\u305d\u306e\u5148\u306e\u30da\u30fc\u30b8\u306b\u767b\u9332\u3057\u305f\u5185\u5bb9\u3068\u8a8d\u8a3c\u306b\u5fc5\u8981\u306a\u60c5\u5831\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u9805\u76ee\u3092\u30e1\u30e2\u3057\u307e\u3059\u3002\n\u30fbClient ID\n\u30fbClient Secret\n\u30fbCallback URL\n\n\u3067\u306f\u3001\u5f15\u304d\u7d9a\u304dLaravel\u3067\u3084\u3063\u3066\u307f\u307e\u3059\u3002\n\u203b\u3068\u308a\u3042\u3048\u305a\u3069\u3046\u3044\u3046\u611f\u3058\u306a\u306e\u304b\u898b\u305f\u304f\u3066\u9069\u5f53\u306b\u66f8\u3044\u305f\u306e\u3067\u304b\u306a\u308a\u9069\u5f53\u3067\u3059\u3002\u3054\u3081\u3093\u306a\u3055\u3044\u3002\u3061\u3083\u3093\u3068\u3084\u308b\u6642\u306f\u3044\u3044\u611f\u3058\u306eOAuth\u30e9\u30a4\u30d6\u30e9\u30ea\u4f7f\u3063\u3066\u3061\u3083\u3093\u3068\u66f8\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\u203b\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u6642\u306bCSRF Token\u30df\u30b9\u30de\u30c3\u30c1\u3067\u30a8\u30e9\u30fc\u306b\u306a\u3063\u305f\u308a\u3057\u307e\u3057\u305f\u304c\u3001\u4e00\u65e6\u52d5\u304b\u3057\u305f\u304b\u3063\u305f\u3093\u3067MiddleWare\u5916\u3057\u307e\u3057\u305f\u3002\n\n```:.env\nLINE_NOTIFY_CLIENT_ID=<Client ID>\nLINE_NOTIFY_CLIENT_SECRET=<Client Secret>\nLINE_NOTIFY_CLIENT_CALLBACK_URI=<Callback URL>\n```\n\n```php:config/services.php\n<?php\nreturn [\n\n    'line_notify' => [\n        'client_id' => env('LINE_NOTIFY_CLIENT_ID'),\n        'secret'    => env('LINE_NOTIFY_CLIENT_SECRET'),\n        'redirect_uri' => env('LINE_NOTIFY_CLIENT_CALLBACK_URI')\n    ]\n];\n```\n\n```php:app/Http/routes.php\nRoute::group(['prefix' => 'notify'], function () {\n    Route::get('/', 'LineNotifyController@index');\n    Route::get('/auth', 'LineNotifyController@redirectToProvider');\n    Route::post('/callback', 'LineNotifyController@handleProviderCallback');\n    Route::post('/send', 'LineNotifyController@send');\n});\n```\n\n```php:app/Http/Controllers\n<?php\n\nnamespace App\\Http\\Controllers;\n\nuse GuzzleHttp\\Client;\n\nclass LineNotifyController extends Controller\n{\n    public function index()\n    {\n        return view('line_notify.index');\n    }\n\n    public function redirectToProvider()\n    {\n        $uri = 'https://notify-bot.line.me/oauth/authorize?' .\n            'response_type=code' . '&' .\n            'client_id=' . config('services.line_notify.client_id') . '&' .\n            'redirect_uri=' . config('services.line_notify.redirect_uri') . '&' .\n            'scope=notify' . '&' .\n            'state=' . csrf_token() . '&' .\n            'response_mode=form_post';\n        return redirect($uri);\n    }\n\n    public function handleProviderCallback()\n    {\n        $uri = 'https://notify-bot.line.me/oauth/token';\n        $client = new Client();\n        $response = $client->post($uri, [\n            'headers'     => [\n                'Content-Type' => 'application/x-www-form-urlencoded',\n            ],\n            'form_params' => [\n                'grant_type'    => 'authorization_code',\n                'code'          => request('code'),\n                'redirect_uri'  => config('services.line_notify.redirect_uri'),\n                'client_id'     => config('services.line_notify.client_id'),\n                'client_secret' => config('services.line_notify.secret')\n            ]\n        ]);\n        // \u3053\u306e\u74b0\u5883DB\u3068\u304b\u5165\u308c\u3066\u306a\u3044\u3093\u3067\u3068\u308a\u3042\u3048\u305a\u30bb\u30c3\u30b7\u30e7\u30f3\u306b\u5165\u308c\u3068\u304d\u307e\u3059\n        $access_token = json_decode($response->getBody())->access_token;\n        \\Session::set('access_token', $access_token);\n        return redirect('/notify');\n    }\n\n    public function send()\n    {\n        $uri = 'https://notify-api.line.me/api/notify';\n        $client = new Client();\n        $client->post($uri, [\n            'headers' => [\n                'Content-Type'  => 'application/x-www-form-urlencoded',\n                'Authorization' => 'Bearer ' . session('access_token'),\n            ],\n            'form_params' => [\n                'message' => request('message', 'Hello World!!')\n            ]\n        ]);\n        return redirect('/notify');\n    }\n}\n\n```\n\n```php:resources/views/line_notify/index.blade.php\n<a href=\"/notify/auth\">Line Notify Auth</a>\n\n@if(Session::has('access_token'))\n    <form action=\"/notify/send\" method=\"post\">\n        <input type=\"hidden\" value=\"{{ session('access_token') }}\">\n        <label>\n            \u30e1\u30c3\u30bb\u30fc\u30b8\n            <input type=\"text\" name=\"message\" value=\"\">\n        </label>\n        <input type=\"submit\" value=\"\u9001\u4fe1\">\n    </form>\n@endif\n```\n\n\u3053\u308c\u3067\u6e96\u5099\u5b8c\u4e86\u3067\u3059\u3002\n\n\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3053\u3093\u306a\u753b\u9762\u306b\u306a\u308a\u307e\u3059\u3002\n<img width=\"400\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-09-29 17.39.51.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/14172/64a47dfd-c0a4-fdae-bb84-297530c8bffb.png\">\n\n\u30ea\u30f3\u30af\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u8a8d\u8a3c\u753b\u9762\u306b\u98db\u3070\u3055\u308c\u307e\u3059\n<img width=\"400\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-09-29 17.40.10.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/14172/818175a2-739c-2a6c-28a9-b22a7de5a1a8.png\">\n\n\u81ea\u5206\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u8a8d\u8a3c\u3092\u3059\u308b\u3068\u30c8\u30fc\u30af\u30eb\u30fc\u30e0\u306e\u9078\u629e\u753b\u9762\u306b\u9077\u79fb\u3057\u307e\u3059\n<img width=\"400\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-09-29 17.40.34.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/14172/ccceedb2-e9e0-5089-4efa-006e05521819.png\">\n\n\n\u30c8\u30fc\u30af\u30eb\u30fc\u30e0\u3092\u9078\u629e\u3057\u3066\u300c\u540c\u610f\u3057\u3066\u9023\u643a\u3059\u308b\u300d\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001\u81ea\u5206\u3067\u8a2d\u5b9a\u3057\u305f\u30b3\u30fc\u30eb\u30d0\u30c3\u30afURL\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u307e\u3059\u3002\n<img width=\"400\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-09-29 17.41.19.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/14172/e13b9466-1ad8-5e4b-7340-3250907bb5be.png\">\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u6b04\u306b\u5165\u529b\u3057\u3066\u9001\u4fe1\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\n<img width=\"400\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-09-29 17.41.42.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/14172/54ea6b6c-8372-5bad-af01-5e5cab732ca9.png\">\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u5c4a\u304d\u307e\u3059\u3002\n<img width=\"400\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-09-29 17.47.22.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/14172/1356978a-5107-3bf8-9fa4-8271266add33.png\">\n\n\n# \u307e\u3068\u3081\n* LineBot\u3092\u8a66\u3057\u305f\u6642\u306b\u8a3c\u660e\u66f8\u3068\u304b\u8a2d\u5b9a\u3057\u305f\u30b5\u30fc\u30d0\u30fc\u3092\u4f5c\u3063\u3066\u3042\u3063\u305f\u305b\u3044\u304b\u51c4\u304f\u7c21\u5358\u3067\u3057\u305f\u3002(\u305d\u306e\u8fba\u306a\u3044\u3068\u5d4c\u307e\u308b\u304b\u3082\uff1fHeroku\u3068\u304b\u4f7f\u3048\u3070\u5927\u4e08\u592b\u3060\u308d\u3046\u3051\u3069)\n* \u591a\u5206\u3061\u3083\u3093\u3068\u3057\u305fOAuth\u30e9\u30a4\u30d6\u30e9\u30ea\u4f7f\u3048\u3070\u304b\u306a\u308a\u7c21\u5358\u306b\u5b9f\u88c5\u51fa\u6765\u308b\u6c17\u304c\u3057\u307e\u3059\u3002\n* API Rate Limit\u306f1000call/hour\u307d\u3044\u3067\u3059\u3002\n\n~~*https://line.bots.jp/notify \u3067\u516c\u958b\u3057\u3066\u308b\u306e\u3067\u8a66\u3057\u3066\u3044\u305f\u3060\u3044\u3067\u5927\u4e08\u592b\u3067\u3059\u304c\u3001\u544a\u77e5\u306a\u3057\u3067\u5909\u66f4\u3057\u305f\u308a\u9589\u3058\u305f\u308a\u3057\u307e\u3059\u3002~~\n\u3059\u3044\u307e\u305b\u3093\u3002\u30a4\u30bf\u30ba\u30e9\u304c\u591a\u304b\u3063\u305f\u306e\u3067\u505c\u6b62\u3057\u307e\u3057\u305f\u3002\n"}