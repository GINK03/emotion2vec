{"context": "\n\n\u524d\u63d0\n$ ruby -v\nruby 2.3.1p112 (2016-04-26 revision 54768) [x86_64-darwin15]\n$ grep redis Gemfile.lock\n    redis (3.3.1)\n    redis-actionpack (5.0.1)\n      redis-rack (>= 1, < 3)\n      redis-store (>= 1.1.0, < 1.4.0)\n    redis-activesupport (5.0.1)\n      redis-store (~> 1.2.0)\n    redis-rack (2.0.0)\n      redis-store (~> 1.2.0)\n    redis-rails (5.0.1)\n      redis-actionpack (~> 5.0.0)\n      redis-activesupport (~> 5.0.0)\n      redis-store (~> 1.2.0)\n    redis-store (1.2.0)\n      redis (>= 2.2)\n  redis (~> 3.0)\n  redis-rails\n\n$ bundle exec rails c\n\n[1] pry(main)>\n\n\n\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\n[1] pry(main)> ids = (1..1_000_000).to_a\n\n\nMarshal vs JSON\n[2] pry(main)> json = \"\"\n=> \"\"\n[3] pry(main)> marshaled = \"\"\n=> \"\"\n\n[4] pry(main)> Benchmark.realtime { marshaled = Marshal.dump(ids) }\n=> 0.06611821899423376\n[5] pry(main)> marshaled.size\n=> 4934095\n\n[6] pry(main)> Benchmark.realtime { json = ids.to_json }\n=> 0.7926974160072859\n[7] pry(main)> json.size\n=> 6888897\n\n\nraw vs gzip\n\nredis \u306f docker \u3067\u7acb\u3061\u4e0a\u3052\u3001\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3057\u3066\u30db\u30b9\u30c8\u304b\u3089\u7e4b\u3044\u3067\u3044\u307e\u3059\n\n[8] pry(main)> host = \"192.168.99.100\"\n=> \"192.168.99.100\"\n[9] pry(main)> port = 6379\n=> 6379\n[10] pry(main)> db = 0\n=> 0\n[11] pry(main)> redis = Redis.new(url: \"redis://#{host}:#{port}/#{db}\")\n=> #<Redis client v3.3.1 for redis://192.168.99.100:6379/0>\n\n[12] pry(main)> res = \"\"\n[13] pry(main)> Benchmark.realtime { redis.set('cachekey', marshaled) }\n=> 0.08158121499582194\n[14] pry(main)> Benchmark.realtime { res = redis.get('cachekey') }\n=> 0.34710412900312804\n[15] pry(main)> res.size\n=> 4905295\n\n[15] pry(main)> gzip = \"\"\n=> \"\"\n[15] pry(main)> gzip2 = \"\"\n=> \"\"\n[15] pry(main)> res2 = \"\"\n=> \"\"\n[16] pry(main)> Benchmark.realtime { gzip = Zlib::Deflate.deflate(marshaled); redis.set('cachekey_gzip', gzip) }\n=> 0.6087514339888003\n[17] pry(main)> Benchmark.realtime { gzip2 = redis.get('cachekey_gzip'); res2 = Zlib::Inflate.inflate(gzip2) }\n=> 0.06563029202516191\n[18] pry(main)> gzip.size\n=> 1505444\n[19] pry(main)> gzip2.size\n=> 1448046\n[20] pry(main)> res2.size\n=> 4934095\n\n\n\u7d50\u8ad6\uff08\u306b\u306a\u3063\u3066\u3044\u306a\u3044)\n\n\u30b5\u30f3\u30d7\u30eb\u6570\u306f\u5c11\u306a\u3044\u304c\u6570\u56de\u53e9\u3044\u3066\u3082\u5927\u304d\u306a\u5dee\u7570\u306f\u306a\u304b\u3063\u305f\nto_json \u3088\u308a marshal \u306e\u307b\u3046\u304c\u3088\u3055\u3052\n\u5727\u7e2e\u3059\u308b\u3068 redis \u306e get \u306f\u901f\u304f\u306a\u308b\u304c\u5727\u7e2e\u306b\u6642\u9593\u306f\u304b\u304b\u308b\u306e\u3067 gzip\u5727\u7e2e\u3057\u306a\u3044\u307b\u3046\u304c\u5168\u4f53\u3068\u3057\u3066\u306f\u9ad8\u901f\u3068\u3044\u3046\u7d50\u679c\n\u305f\u3060\u5727\u7e2e\u3059\u308b\u3068redis\u306e\u30e1\u30e2\u30ea\u306f\u7bc0\u7d04\u3067\u304d\u308b\n\u901f\u5ea6\u91cd\u8996\u3060\u3068\u3057\u3066\u3001\u5b9f\u969b\u306b\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30afI/O \u304c\u3082\u3063\u3068\u304b\u304b\u308b\u306e\u3067\u3053\u306e\u7d50\u679c\u3060\u3051\u3067\u306f\u5727\u7e2e\u3059\u308b\u3079\u304d\u304b\u3069\u3046\u304b\u306f\u4f55\u3068\u3082\u3044\u3048\u306a\u3044\n\n## \u524d\u63d0\n\n```bash:\n$ ruby -v\nruby 2.3.1p112 (2016-04-26 revision 54768) [x86_64-darwin15]\n$ grep redis Gemfile.lock\n    redis (3.3.1)\n    redis-actionpack (5.0.1)\n      redis-rack (>= 1, < 3)\n      redis-store (>= 1.1.0, < 1.4.0)\n    redis-activesupport (5.0.1)\n      redis-store (~> 1.2.0)\n    redis-rack (2.0.0)\n      redis-store (~> 1.2.0)\n    redis-rails (5.0.1)\n      redis-actionpack (~> 5.0.0)\n      redis-activesupport (~> 5.0.0)\n      redis-store (~> 1.2.0)\n    redis-store (1.2.0)\n      redis (>= 2.2)\n  redis (~> 3.0)\n  redis-rails\n\n$ bundle exec rails c\n\n[1] pry(main)>\n```\n\n## \u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\n\n```ruby:\n[1] pry(main)> ids = (1..1_000_000).to_a\n```\n\n## Marshal vs JSON\n\n```ruby:\n[2] pry(main)> json = \"\"\n=> \"\"\n[3] pry(main)> marshaled = \"\"\n=> \"\"\n\n[4] pry(main)> Benchmark.realtime { marshaled = Marshal.dump(ids) }\n=> 0.06611821899423376\n[5] pry(main)> marshaled.size\n=> 4934095\n\n[6] pry(main)> Benchmark.realtime { json = ids.to_json }\n=> 0.7926974160072859\n[7] pry(main)> json.size\n=> 6888897\n```\n\n## raw vs gzip\n\n- redis \u306f docker \u3067\u7acb\u3061\u4e0a\u3052\u3001\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3057\u3066\u30db\u30b9\u30c8\u304b\u3089\u7e4b\u3044\u3067\u3044\u307e\u3059\n\n```ruby:\n[8] pry(main)> host = \"192.168.99.100\"\n=> \"192.168.99.100\"\n[9] pry(main)> port = 6379\n=> 6379\n[10] pry(main)> db = 0\n=> 0\n[11] pry(main)> redis = Redis.new(url: \"redis://#{host}:#{port}/#{db}\")\n=> #<Redis client v3.3.1 for redis://192.168.99.100:6379/0>\n\n[12] pry(main)> res = \"\"\n[13] pry(main)> Benchmark.realtime { redis.set('cachekey', marshaled) }\n=> 0.08158121499582194\n[14] pry(main)> Benchmark.realtime { res = redis.get('cachekey') }\n=> 0.34710412900312804\n[15] pry(main)> res.size\n=> 4905295\n\n[15] pry(main)> gzip = \"\"\n=> \"\"\n[15] pry(main)> gzip2 = \"\"\n=> \"\"\n[15] pry(main)> res2 = \"\"\n=> \"\"\n[16] pry(main)> Benchmark.realtime { gzip = Zlib::Deflate.deflate(marshaled); redis.set('cachekey_gzip', gzip) }\n=> 0.6087514339888003\n[17] pry(main)> Benchmark.realtime { gzip2 = redis.get('cachekey_gzip'); res2 = Zlib::Inflate.inflate(gzip2) }\n=> 0.06563029202516191\n[18] pry(main)> gzip.size\n=> 1505444\n[19] pry(main)> gzip2.size\n=> 1448046\n[20] pry(main)> res2.size\n=> 4934095\n```\n\n## \u7d50\u8ad6\uff08\u306b\u306a\u3063\u3066\u3044\u306a\u3044)\n\n- \u30b5\u30f3\u30d7\u30eb\u6570\u306f\u5c11\u306a\u3044\u304c\u6570\u56de\u53e9\u3044\u3066\u3082\u5927\u304d\u306a\u5dee\u7570\u306f\u306a\u304b\u3063\u305f\n- to_json \u3088\u308a marshal \u306e\u307b\u3046\u304c\u3088\u3055\u3052\n- \u5727\u7e2e\u3059\u308b\u3068 redis \u306e get \u306f\u901f\u304f\u306a\u308b\u304c\u5727\u7e2e\u306b\u6642\u9593\u306f\u304b\u304b\u308b\u306e\u3067 gzip\u5727\u7e2e\u3057\u306a\u3044\u307b\u3046\u304c\u5168\u4f53\u3068\u3057\u3066\u306f\u9ad8\u901f\u3068\u3044\u3046\u7d50\u679c\n- \u305f\u3060\u5727\u7e2e\u3059\u308b\u3068redis\u306e\u30e1\u30e2\u30ea\u306f\u7bc0\u7d04\u3067\u304d\u308b\n- \u901f\u5ea6\u91cd\u8996\u3060\u3068\u3057\u3066\u3001\u5b9f\u969b\u306b\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30afI/O \u304c\u3082\u3063\u3068\u304b\u304b\u308b\u306e\u3067\u3053\u306e\u7d50\u679c\u3060\u3051\u3067\u306f\u5727\u7e2e\u3059\u308b\u3079\u304d\u304b\u3069\u3046\u304b\u306f\u4f55\u3068\u3082\u3044\u3048\u306a\u3044\n", "tags": ["Redis", "Ruby"]}