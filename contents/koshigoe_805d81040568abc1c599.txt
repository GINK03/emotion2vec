{"context": " More than 1 year has passed since last update.Amazon Elastic Filey System \u306e\u30d7\u30ec\u30d3\u30e5\u30fc\u3092\u7533\u3057\u8fbc\u3093\u3067\u304b\u3089\u6570\u9031\u9593\u304c\u7d4c\u3061\u307e\u3059\u3002\n\u306a\u304b\u306a\u304b\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u3089\u306a\u3044\u306e\u3067\u3001GlusterFS \u3068\u3044\u3046\u3084\u3064\u3067\u6687\u3092\u3064\u3076\u3057\u307e\u3059\u3002\n\u4ee5\u4e0b\u3001\u3060\u3089\u3060\u3089\u3068\u3057\u305f\u6687\u3064\u3076\u3057\u3092\u30e1\u30e2\u3057\u305f\u3082\u306e\u3067\u3059\u3002\n\nTL;DR\n\nGlusterFS \u3092\u3055\u308f\u3063\u3066\u307f\u305f(\u8a73\u3057\u3044\u3053\u3068\u306f\u7406\u89e3\u3057\u3066\u306a\u3044)\nGlusterFS \u306b\u306f ELB \u3092\u7d4c\u7531\u3057\u3066 NFS \u3067\u30de\u30a6\u30f3\u30c8\u3057\u3066\u307f\u305f(\u3042\u308a\u306a\u306e\u304b\u308f\u304b\u3063\u3066\u306a\u3044)\n\u30af\u30e9\u30b9\u30bf\u306e\u30ce\u30fc\u30c9\u5897\u6e1b\u3092\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u884c\u3048\u308b\u3089\u3057\u304d\u3053\u3068\u3092\u78ba\u8a8d(\u305d\u306e\u969b\u306e\u8ca0\u8377\u306a\u3069\u306f\u6e2c\u3063\u3066\u306a\u3044)\n\u30dc\u30ea\u30e5\u30fc\u30e0\u4f5c\u6210\u307e\u3067\u306f\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u53c2\u8003\u306b\u3057\u305f(\u30ce\u30fc\u30c9\u5897\u6e1b\u3042\u305f\u308a\u306f\u30d6\u30ed\u30b0\u8a18\u4e8b\u306a\u3069\u306e\u975e\u516c\u5f0f\u60c5\u5831\u3092\u53c2\u8003)\nEFS \u30d7\u30ec\u30d3\u30e5\u30fc\u3001\u306f\u3088\u3053\u3044\n\n\nGlusterFS\n\nGlusterFS is a scalable network filesystem. Using common off-the-shelf hardware, you can create large, distributed storage solutions for media streaming, data analysis, and other data- and bandwidth-intensive tasks. GlusterFS is free and open source software.\nStorage for your Cloud. \u2014 Gluster\nGlusterFS\u306f\u3001\u30b9\u30b1\u30fc\u30e9\u30d6\u30eb\u306a\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u305f\u3081\u306e\u6c4e\u7528\u5206\u6563\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306e1\u3064\u3002InfiniBand\u306eRDMA\u3084TCP/IP\u30a4\u30f3\u30bf\u30fc\u30b3\u30cd\u30af\u30c8\u306a\u3069\u306e\u5404\u7a2e\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u96c6\u7d04\u3057\u3001\u5927\u898f\u6a21\u4e26\u5217\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u69cb\u7bc9\u3067\u304d\u308b\u3002GlusterFS\u306f\u30e6\u30fc\u30b6\u30fc\u7a7a\u9593\u3067\u69cb\u7bc9\u3055\u308c\u3066\u304a\u308a\u3001\u6027\u80fd\u3092\u4f4e\u4e0b\u3055\u305b\u308b\u3053\u3068\u304c\u306a\u3044\u3002\u30af\u30e9\u30a6\u30c9\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u3001\u751f\u7269\u533b\u5b66\u3001\u8d85\u5927\u5bb9\u91cf\u30b9\u30c8\u30ec\u30fc\u30b8\u306a\u3069\u69d8\u3005\u306a\u5fdc\u7528\u304c\u306a\u3055\u308c\u3066\u3044\u308b\u3002GlusterFS\u306f\u3001\u5f53\u521dGluster, Inc.\u306b\u3088\u3063\u3066\u958b\u767a\u3055\u308c\u305f\u30022011\u5e74\u306e\u30ec\u30c3\u30c9\u30cf\u30c3\u30c8\u306b\u3088\u308bGluster\u8cb7\u53ce\u306e\u5f8c\u306f\u30ec\u30c3\u30c9\u30cf\u30c3\u30c8\u306b\u3088\u308a\u958b\u767a\u3055\u308c\u3066\u3044\u308b\u3002\nGlusterFS - Wikipedia\n\n\nDeploying in AWS\n\nDeploying in AWS - Gluster Docs\n2\u3064\u4ee5\u4e0a\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f7f\u3046\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3067\u30dd\u30fc\u30c8\u3092\u5236\u9650\u3059\u308b(\u5f8c\u8ff0)\nephemeral \u304c\u8a31\u3055\u308c\u308b\u306e\u306f\u30c6\u30b9\u30c8\u307e\u3067\n\u5546\u7528\u74b0\u5883\u3067\u306f\u3001Multi-AZ \u3067\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3059\u3079\u3057\n\u5546\u7528\u74b0\u5883\u3067\u306f\u3001EBS, EIP \u306e\u5229\u7528\u3092\u63a8\u5968\u3059\u308b\n\n\n\u7591\u554f\n\n\u30c0\u30a6\u30f3\u30bf\u30a4\u30e0\u306a\u3057\u3067\u30ce\u30fc\u30c9\u306e\u5897\u6e1b\u304c\u53ef\u80fd\u306a\u306e\u304b\n\u30db\u30c3\u30c8\u30b9\u30ef\u30c3\u30d7\u7684\u306a\u30ce\u30fc\u30c9\u4ea4\u63db\u306f\u53ef\u80fd\u306a\u306e\u304b\n\n\nEC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\nAmazon Linux \u306e AMI \u3092\u4f7f\u3044\u3001t2.micro \u306e EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092 2 \u3064\u7528\u610f\u3057\u307e\u3059\u3002\n\nEBS\n\u305d\u308c\u305e\u308c\u3001\u8ffd\u52a0\u3067 EBS \u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u30a2\u30bf\u30c3\u30c1\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\nZone\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f\u7570\u306a\u308b\u30be\u30fc\u30f3\u306b\u914d\u7f6e\u3057\u307e\u3059\u3002\n\nSecurity Group\n\n\u540c\u4e00\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306b\u5bfe\u3057\u3066\u306f\u3059\u3079\u3066\u306e TCP \u3092\u8a31\u53ef\u3057\u3066\u304a\u304d\u307e\u3059\n\u540c\u4e00 VPC \u306e\u30b5\u30d6\u30cd\u30c3\u30c8 172.31.0.0/16 \u306b\u5bfe\u3057\u3066\u3001\u4ee5\u4e0b\u3092\u8a31\u53ef\u3057\u3066\u304a\u304d\u307e\u3059\n\n\nUDP: 111\nTCP: 111\nTCP: 2049\nTCP: 38465 - 38467\n\n\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nInstall - Gluster Docs\n\n$ sudo wget -P /etc/yum.repos.d http://download.gluster.org/pub/gluster/glusterfs/LATEST/RHEL/glusterfs-epel.repo\n$ sudo sed -i.orig -e 's/$releasever/6/g' /etc/yum.repos.d/glusterfs-epel.repo\n$ diff -u /etc/yum.repos.d/glusterfs-epel.repo.orig /etc/yum.repos.d/glusterfs-epel.repo\n--- /etc/yum.repos.d/glusterfs-epel.repo.orig   2015-09-03 14:06:25.000000000 +0000\n+++ /etc/yum.repos.d/glusterfs-epel.repo        2015-10-04 08:23:22.733374955 +0000\n@@ -2,7 +2,7 @@\n\n [glusterfs-epel]\n name=GlusterFS is a clustered file-system capable of scaling to several petabytes.\n-baseurl=http://download.gluster.org/pub/gluster/glusterfs/3.7/LATEST/EPEL.repo/epel-$releasever/$basearch/\n+baseurl=http://download.gluster.org/pub/gluster/glusterfs/3.7/LATEST/EPEL.repo/epel-6/$basearch/\n enabled=1\n skip_if_unavailable=1\n gpgcheck=1\n@@ -10,7 +10,7 @@\n\n [glusterfs-noarch-epel]\n name=GlusterFS is a clustered file-system capable of scaling to several petabytes.\n-baseurl=http://download.gluster.org/pub/gluster/glusterfs/3.7/LATEST/EPEL.repo/epel-$releasever/noarch\n+baseurl=http://download.gluster.org/pub/gluster/glusterfs/3.7/LATEST/EPEL.repo/epel-6/noarch\n enabled=1\n skip_if_unavailable=1\n gpgcheck=1\n@@ -18,7 +18,7 @@\n\n [glusterfs-source-epel]\n name=GlusterFS is a clustered file-system capable of scaling to several petabytes. - Source\n-baseurl=http://download.gluster.org/pub/gluster/glusterfs/3.7/LATEST/EPEL.repo/epel-$releasever/SRPMS\n+baseurl=http://download.gluster.org/pub/gluster/glusterfs/3.7/LATEST/EPEL.repo/epel-6/SRPMS\n enabled=0\n skip_if_unavailable=1\n gpgcheck=1\n$ sudo yum install --enablerepo=epel glusterfs-server\n...\n=========================================================================================================================================================================\n Package                                          \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u30fc               \u30d0\u30fc\u30b8\u30e7\u30f3                                 \u30ea\u30dd\u30b8\u30c8\u30ea\u30fc                            \u5bb9\u91cf\n=========================================================================================================================================================================\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4e2d:\n glusterfs-server                                 x86_64                         3.7.4-2.el6                                glusterfs-epel                         1.3 M\n\u4f9d\u5b58\u6027\u95a2\u9023\u3067\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u3057\u307e\u3059:\n glusterfs                                        x86_64                         3.7.4-2.el6                                glusterfs-epel                         416 k\n glusterfs-api                                    x86_64                         3.7.4-2.el6                                glusterfs-epel                          73 k\n glusterfs-cli                                    x86_64                         3.7.4-2.el6                                glusterfs-epel                         156 k\n glusterfs-client-xlators                         x86_64                         3.7.4-2.el6                                glusterfs-epel                         920 k\n glusterfs-fuse                                   x86_64                         3.7.4-2.el6                                glusterfs-epel                         118 k\n glusterfs-libs                                   x86_64                         3.7.4-2.el6                                glusterfs-epel                         321 k\n python26                                         x86_64                         2.6.9-1.80.amzn1                           amzn-main                              5.7 M\n python26-argparse                                noarch                         1.2.1-2.8.amzn1                            amzn-main                               72 k\n python26-libs                                    x86_64                         2.6.9-1.80.amzn1                           amzn-main                              692 k\n python26-pyxattr                                 x86_64                         0.5.0-1.6.amzn1                            amzn-main                               25 k\n userspace-rcu                                    x86_64                         0.7.7-1.el6                                epel                                    60 k\n...\n\n\n$releasever\nglusterfs-epel.repo \u306e\u4e2d\u306b $releasever \u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u7b87\u6240\u304c\u3042\u308a\u307e\u3059\u304c\u3001Amazon Linux \u3060\u3068 latest \u3068\u89e3\u91c8\u3055\u308c\u3066\u3057\u307e\u3044 404 \u30a8\u30e9\u30fc\u306b\u306a\u3063\u3066\u3057\u307e\u3057\u307e\u3059\u3002\n\u6700\u521d\u304b\u3089\u3042\u308b epel \u306e\u8a2d\u5b9a\u304c 6 \u3060\u3063\u305f\u306e\u3067\u3001\u540c\u69d8\u306b 6 \u306b\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\n\n\u4f9d\u5b58\u89e3\u6c7a\u306e\u5931\u6557\n\u8ffd\u52a0\u3057\u305f glusterfs-epel.repo \u306f enable=1 \u306a\u306e\u3067 --enablerepo \u3092\u3064\u3051\u308b\u5fc5\u8981\u306f\u306a\u3044\u306e\u3067\u3059\u304c\u3001\u305d\u3046\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u306b\u306a\u3063\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u5931\u6557\u3057\u307e\u3059\u3002\n$ sudo yum install glusterfs-server\n...\n--> \u4f9d\u5b58\u6027\u89e3\u6c7a\u3092\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002\n\u30a8\u30e9\u30fc: \u30d1\u30c3\u30b1\u30fc\u30b8: glusterfs-server-3.7.4-2.el6.x86_64 (glusterfs-epel)\n             \u8981\u6c42: liburcu-bp.so.1()(64bit)\n\u30a8\u30e9\u30fc: \u30d1\u30c3\u30b1\u30fc\u30b8: glusterfs-server-3.7.4-2.el6.x86_64 (glusterfs-epel)\n             \u8981\u6c42: liburcu-cds.so.1()(64bit)\n \u554f\u984c\u3092\u56de\u907f\u3059\u308b\u305f\u3081\u306b --skip-broken \u3092\u7528\u3044\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n \u3053\u308c\u3089\u3092\u8a66\u884c\u3067\u304d\u307e\u3059: rpm -Va --nofiles --nodigest\n\n--enablerepo=epel \u3092\u3064\u3051\u3066 epel \u3092\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3068\u3001\u4f9d\u5b58\u89e3\u6c7a\u306b\u6210\u529f\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u8a2d\u5b9a\n\nConfigure - Gluster Docs\n\n\n\u30c7\u30fc\u30e2\u30f3\u8d77\u52d5\n$ sudo /sbin/service glusterd start\n$ sudo chkconfig glusterd on\n\n\npeer\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster peer probe 172.31.22.91\npeer probe: success.\n\n[ec2-user@ip-172-31-22-91 ~]$ sudo gluster peer probe 172.31.6.251\npeer probe: success.\n\n\nhost: hostname of the other server in the cluster, or IP address if you don\u2019t have DNS or /etc/hosts entries\n\n\n\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\n$ sudo yum install xfsprogs\n$ sudo mkfs.xfs -i size=512 /dev/sdb\nmeta-data=/dev/sdb               isize=512    agcount=4, agsize=524288 blks\n         =                       sectsz=512   attr=2, projid32bit=1\n         =                       crc=0        finobt=0\ndata     =                       bsize=4096   blocks=2097152, imaxpct=25\n         =                       sunit=0      swidth=0 blks\nnaming   =version 2              bsize=4096   ascii-ci=0 ftype=0\nlog      =internal log           bsize=4096   blocks=2560, version=2\n         =                       sectsz=512   sunit=0 blks, lazy-count=1\nrealtime =none                   extsz=4096   blocks=0, rtextents=0\n\n\n\u30de\u30a6\u30f3\u30c8\n$ sudo mkdir -p /export/sdb\n$ sudo mount /dev/sdb /export/sdb\n$ sudo mkdir -p /export/sdb/brick\n\n\nfstab\n$ echo \"/dev/sdb /export/sdb xfs defaults 0 0\" | sudo tee -a /etc/fstab\n\n\nGluster \u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\u30ec\u30d7\u30ea\u30ab\u30bf\u30a4\u30d7\u3067\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3059\u3002\n$ sudo gluster volume create gv0 replica 2 172.31.22.91:/export/sdb/brick 172.31.6.251:/export/sdb/brick\nvolume create: gv0: success: please start the volume to access data\n\n\nhost 1: e.g. node01.mydomain.net\nhost 2: e.g. node02.mydomain.net\n\ninfo \u3067\u60c5\u5831\u3092\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n$ gluster volume info\n\nVolume Name: gv0\nType: Replicate\nVolume ID: 373b646e-7f70-4daf-b73c-e4e56db2bba6\nStatus: Created\nNumber of Bricks: 1 x 2 = 2\nTransport-type: tcp\nBricks:\nBrick1: 172.31.22.91:/export/sdb/brick\nBrick2: 172.31.6.251:/export/sdb/brick\nOptions Reconfigured:\nperformance.readdir-ahead: on\n\n\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u5229\u7528\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n$ sudo gluster volume start gv0\nvolume start: gv0: success\n\nglusterfsd \u3082\u8d77\u52d5\u3057\u3066\u3044\u308b\u6a21\u69d8\u3002\n$ service glusterfsd status\nglusterfsd (pid 3018) is running...\n\n$ sudo chkconfig glusterfsd on\n\n\n\u5229\u7528\n\nEC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\n\u5225\u306b\u65b0\u3057\u304f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068\u306a\u308b EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306f GlusterFS \u7528\u306e\u3082\u306e\u3068\u306f\u5225\u3067\u3001\u30a6\u30a3\u30b6\u30fc\u30c9\u30c7\u30d5\u30a9\u30eb\u30c8\u306e SSH \u306e\u307f\u30aa\u30fc\u30d7\u30f3\u306a\u3084\u3064\u3092\u9069\u7528\u3057\u307e\u3059\u3002\n\nglusterfs-fuse \u3067\u63a5\u7d9a\n\u307e\u305a\u306f\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n[ec2-user@ip-172-31-4-109 ~]$ sudo wget -P /etc/yum.repos.d http://download.gluster.org/pub/gluster/glusterfs/LATEST/RHEL/glusterfs-epel.repo\n[ec2-user@ip-172-31-4-109 ~]$ sudo sed -i.orig -e 's/$releasever/6/g' /etc/yum.repos.d/glusterfs-epel.repo\n[ec2-user@ip-172-31-4-109 ~]$ sudo yum install glusterfs glusterfs-fuse\n\n\u7d9a\u3044\u3066\u30de\u30a6\u30f3\u30c8\u3057\u307e\u3059\u3002\n[ec2-user@ip-172-31-4-109 ~]$ sudo install -d /glusterfs/gv0\n[ec2-user@ip-172-31-4-109 ~]$ sudo mount -t glusterfs 172.31.22.91:/gv0 /glusterfs/gv0/\n\n\u9069\u5f53\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066\u307f\u307e\u3059\u3002\n[ec2-user@ip-172-31-4-109 ~]$ sudo install -d -o ec2-user -g ec2-user /glusterfs/gv0/ec2-user\n[ec2-user@ip-172-31-4-109 ~]$ touch /glusterfs/gv0/ec2-user/{01..10}\n[ec2-user@ip-172-31-4-109 ~]$ ls -l /glusterfs/gv0/ec2-user\n\u5408\u8a08 0\n-rw-rw-r-- 1 ec2-user ec2-user 0 10\u6708  4 10:17 01\n-rw-rw-r-- 1 ec2-user ec2-user 0 10\u6708  4 10:17 02\n-rw-rw-r-- 1 ec2-user ec2-user 0 10\u6708  4 10:17 03\n-rw-rw-r-- 1 ec2-user ec2-user 0 10\u6708  4 10:17 04\n-rw-rw-r-- 1 ec2-user ec2-user 0 10\u6708  4 10:17 05\n-rw-rw-r-- 1 ec2-user ec2-user 0 10\u6708  4 10:17 06\n-rw-rw-r-- 1 ec2-user ec2-user 0 10\u6708  4 10:17 07\n-rw-rw-r-- 1 ec2-user ec2-user 0 10\u6708  4 10:17 08\n-rw-rw-r-- 1 ec2-user ec2-user 0 10\u6708  4 10:17 09\n-rw-rw-r-- 1 ec2-user ec2-user 0 10\u6708  4 10:17 10\n\n\u30b5\u30fc\u30d0\u5074\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n[ec2-user@ip-172-31-6-251 ~]$ ls -al /export/sdb/brick/ec2-user/\n\u5408\u8a08 0\ndrwxr-xr-x 2 ec2-user ec2-user 96 10\u6708  4 10:17 .\ndrwxr-xr-x 5 root     root     54 10\u6708  4 10:17 ..\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 01\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 02\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 03\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 04\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 05\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 06\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 07\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 08\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 09\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 10\n\n[ec2-user@ip-172-31-22-91 ~]$ ls -al /export/sdb/brick/ec2-user/\n\u5408\u8a08 0\ndrwxr-xr-x 2 ec2-user ec2-user 96 10\u6708  4 10:17 .\ndrwxr-xr-x 5 root     root     54 10\u6708  4 10:17 ..\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 01\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 02\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 03\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 04\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 05\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 06\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 07\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 08\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 09\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 10\n\n\n\u7247\u5074\u306e glusterd \u3092\u6b62\u3081\u3066\u307f\u308b\n\u30de\u30a6\u30f3\u30c8\u6642\u306b\u6307\u5b9a\u3057\u305f\u65b9\u3068\u306f\u5225\u306e\u30db\u30b9\u30c8\u3067 glusterd \u3092\u6b62\u3081\u3066\u307f\u307e\u3059\u3002\n[ec2-user@ip-172-31-6-251 ~]$ sudo service glusterd stop\n[ec2-user@ip-172-31-6-251 ~]$ sudo service glusterd status\nglusterd is stopped\n\n\u9069\u5f53\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066\u307f\u307e\u3059\u3002\n[ec2-user@ip-172-31-4-109 ~]$ touch /glusterfs/gv0/ec2-user/{11..20}\n\n\u30d5\u30a1\u30a4\u30eb\u306f\u4e21\u65b9\u306b\u4f5c\u3089\u308c\u3066\u3044\u308b\u6a21\u69d8\u3002\n[ec2-user@ip-172-31-6-251 ~]$ ls -la /export/sdb/brick/ec2-user/\n\u5408\u8a08 0\ndrwxr-xr-x 2 ec2-user ec2-user 186 10\u6708  4 10:23 .\ndrwxr-xr-x 5 root     root      54 10\u6708  4 10:17 ..\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 01\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 02\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 03\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 04\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 05\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 06\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 07\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 08\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 09\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 10\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 11\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 12\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 13\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 14\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 15\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 16\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 17\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 18\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 19\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 20\n\n[ec2-user@ip-172-31-22-91 ~]$ ls -la /export/sdb/brick/ec2-user/\n\u5408\u8a08 0\ndrwxr-xr-x 2 ec2-user ec2-user 186 10\u6708  4 10:23 .\ndrwxr-xr-x 5 root     root      54 10\u6708  4 10:17 ..\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 01\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 02\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 03\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 04\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 05\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 06\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 07\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 08\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 09\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 10\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 11\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 12\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 13\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 14\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 15\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 16\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 17\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 18\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 19\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 20\n\n\n\u7247\u5074\u306e EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u6b62\u3081\u3066\u307f\u308b\n[ec2-user@ip-172-31-6-251 ~]$ sudo shutdown -h now\n\nstatus \u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001Disconnected \u306b\u306a\u308a\u307e\u3057\u305f\u3002\n[ec2-user@ip-172-31-22-91 ~]$ sudo gluster peer status\nNumber of Peers: 1\n\nHostname: ip-172-31-6-251.ap-northeast-1.compute.internal\nUuid: d51c1102-1503-478e-bf6f-0b23ca9a3e52\nState: Peer in Cluster (Disconnected)\nOther names:\n172.31.6.251\n\n\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308a\u307e\u3059\u3002\n[ec2-user@ip-172-31-4-109 ~]$ touch /glusterfs/gv0/ec2-user/21\n\n[ec2-user@ip-172-31-22-91 ~]$ ls -la /export/sdb/brick/ec2-user/21\n-rw-rw-r-- 2 ec2-user ec2-user 0 10\u6708  4 10:30 /export/sdb/brick/ec2-user/21\n\n\u505c\u6b62\u3055\u305b\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3057\u3066\u3001\u505c\u6b62\u4e2d\u306b\u5897\u3048\u305f\u30d5\u30a1\u30a4\u30eb\u304c\u540c\u671f\u3055\u308c\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n[ec2-user@ip-172-31-6-251 ~]$ ls -l /export/sdb/brick/ec2-user/21\n-rw-rw-r-- 2 ec2-user ec2-user 0 10\u6708  4 10:30 /export/sdb/brick/ec2-user/21\n\n\u3069\u306e\u7a0b\u5ea6\u306e\u6642\u9593\u3067\u540c\u671f\u3055\u308c\u308b\u304b\u306f\u672a\u78ba\u8a8d\u3002\n\nNFS\nglusterfs-fuse \u3067\u306e\u30de\u30a6\u30f3\u30c8\u3092\u89e3\u9664\u3057\u307e\u3059\u3002\n[ec2-user@ip-172-31-4-109 ~]$ sudo umount -t /glusterfs/gv0/\n\n[ec2-user@ip-172-31-4-109 ~]$ sudo install -d /glusterfs/gv0-nfs/\n[ec2-user@ip-172-31-4-109 ~]$ sudo mount -t nfs 172.31.22.91:/gv0 /glusterfs/gv0-nfs/\\\n[ec2-user@ip-172-31-4-109 ~]$ ls -al /glusterfs/gv0-nfs/ec2-user\n\u5408\u8a08 0\ndrwxr-xr-x 2 ec2-user ec2-user 195 10\u6708  4 10:30 .\ndrwxr-xr-x 5 root     root      54 10\u6708  4 10:17 ..\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 01\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 02\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 03\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 04\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 05\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 06\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 07\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 08\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 09\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 10\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 11\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 12\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 13\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 14\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 15\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 16\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 17\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 18\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 19\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 20\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:30 21\n\n\nNFSv4\nAmazon Elastic File System \u306f NFSv4 \u4e92\u63db\u3068\u3044\u3046\u8a71\u306a\u306e\u3067\u3001GlusterFS \u3082 NFSv4 \u3067\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u306e\u3067\u3059\u304c\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n[ec2-user@ip-172-31-4-109 ~]$ sudo umount /glusterfs/gv0-nfs/\n[ec2-user@ip-172-31-4-109 ~]$ sudo install -d /glusterfs/gv0-nfs4/\n[ec2-user@ip-172-31-4-109 ~]$ sudo mount -t nfs4 172.31.22.91:/gv0 /glusterfs/gv0-nfs4/\nmount.nfs4: Protocol not supported\n\nNFS-Ganesha \u3068\u3044\u3046\u3082\u306e\u3068\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3067 NFSv4 \u3067\u306e\u63a5\u7d9a\u304c\u53ef\u80fd\u306b\u306a\u308b\u3088\u3046\u3067\u3059\u3002\n\nGlusterFS\u3068NFS-Ganesha\u3092\u9023\u643a\u3059\u308b - Qiita\nPackages for 3rd Party Software with built-in GlusterFS support | Gluster Community Website\n\n\u3053\u308c\u306f\u307e\u305f\u4eca\u5ea6\u3002\n\nNFS \u3068 ELB\n\u30de\u30a6\u30f3\u30c8\u6642\u306b\u6307\u5b9a\u3059\u308b\u30db\u30b9\u30c8\u3092\u56fa\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u304b\u3001\u5185\u90e8\u5411\u3051 ELB \u3092\u4f7f\u3063\u3066\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u53ca\u3073 NFS \u306b\u8a73\u3057\u304f\u306a\u3044\u305f\u3081\u3001\u7d20\u3063\u9813\u72c2\u306a\u3053\u3068\u3092\u3057\u3066\u3044\u308b\u6c17\u304c\u3057\u307e\u3059\u3002\n\n\u5185\u90e8\u5411\u3051 ELB \u306e\u4f5c\u6210\n\n\u5185\u90e8\u5411\u3051\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u30fc\u306e\u4f5c\u6210 - Elastic Load Balancing\n\n\u30ea\u30b9\u30ca\u30fc\u3092\u4ee5\u4e0b\u3068\u3057\u307e\u3059\u3002\n\nTCP 111\nTCP 2049\nTCP 38465\nTCP 38466\nTCP 38467\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306f\u3001\u30ce\u30fc\u30c9\u3068\u306a\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u9069\u7528\u3057\u305f\u3082\u306e\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u30d8\u30eb\u30b9\u30c1\u30a7\u30c3\u30af\u3092 TCP 2049 \u3078\u306e Ping \u3068\u3057\u307e\u3059\u3002\n\n\u30de\u30a6\u30f3\u30c8\ndig \u306a\u3069\u3067 DNS \u306e\u540d\u524d\u89e3\u6c7a\u304c\u3067\u304d\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3089\u30de\u30a6\u30f3\u30c8\u3057\u3066\u307f\u307e\u3059\u3002\n[ec2-user@ip-172-31-4-109 ~]$ sudo mount -t nfs internal-glusterfs-736899893.ap-northeast-1.elb.amazonaws.com:/gv0 /glusterfs/gv0-nfs/\n[ec2-user@ip-172-31-4-109 ~]$ df\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9                                                       1K-\u30d6\u30ed\u30c3\u30af    \u4f7f\u7528  \u4f7f\u7528\u53ef \u4f7f\u7528% \u30de\u30a6\u30f3\u30c8\u4f4d\u7f6e\n/dev/xvda1                                                             8123812 1123564 6900000   15% /\ndevtmpfs                                                                500720      60  500660    1% /dev\ntmpfs                                                                   509728       0  509728    0% /dev/shm\ninternal-glusterfs-736899893.ap-northeast-1.elb.amazonaws.com:/gv0     8378368   32768 8345600    1% /glusterfs/gv0-nfs\n[ec2-user@ip-172-31-4-109 ~]$ ls -la /glusterfs/gv0-nfs\n\u5408\u8a08 4\ndrwxr-xr-x 5 root     root       54 10\u6708  4 10:17 .\ndrwxr-xr-x 7 root     root     4096 10\u6708  4 10:42 ..\ndrwxr-xr-x 3 root     root       24 10\u6708  4 09:30 .trashcan\ndrwxr-xr-x 2 ec2-user ec2-user  204 10\u6708  4 12:07 ec2-user\n[ec2-user@ip-172-31-4-109 ~]$ ls -la /glusterfs/gv0-nfs/ec2-user/\n\u5408\u8a08 0\ndrwxr-xr-x 2 ec2-user ec2-user 204 10\u6708  4 12:07 .\ndrwxr-xr-x 5 root     root      54 10\u6708  4 10:17 ..\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 01\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 02\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 03\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 04\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 05\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 06\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 07\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 08\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 09\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 10\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 11\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 12\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 13\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 14\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 15\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 16\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 17\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 18\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 19\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 20\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:30 21\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 12:07 22\n[ec2-user@ip-172-31-4-109 ~]$ rm /glusterfs/gv0-nfs/ec2-user/*\n[ec2-user@ip-172-31-4-109 ~]$ ls -la /glusterfs/gv0-nfs/ec2-user/\n\u5408\u8a08 0\ndrwxr-xr-x 2 ec2-user ec2-user  6 10\u6708  4 12:31 .\ndrwxr-xr-x 5 root     root     54 10\u6708  4 10:17 ..\n[ec2-user@ip-172-31-4-109 ~]$ touch /glusterfs/gv0-nfs/ec2-user/{01..10}\n[ec2-user@ip-172-31-4-109 ~]$ ls -la /glusterfs/gv0-nfs/ec2-user/\n\u5408\u8a08 0\ndrwxr-xr-x 2 ec2-user ec2-user 96 10\u6708  4 12:31 .\ndrwxr-xr-x 5 root     root     54 10\u6708  4 10:17 ..\n-rw-rw-r-- 1 ec2-user ec2-user  0 10\u6708  4 12:31 01\n-rw-rw-r-- 1 ec2-user ec2-user  0 10\u6708  4 12:31 02\n-rw-rw-r-- 1 ec2-user ec2-user  0 10\u6708  4 12:31 03\n-rw-rw-r-- 1 ec2-user ec2-user  0 10\u6708  4 12:31 04\n-rw-rw-r-- 1 ec2-user ec2-user  0 10\u6708  4 12:31 05\n-rw-rw-r-- 1 ec2-user ec2-user  0 10\u6708  4 12:31 06\n-rw-rw-r-- 1 ec2-user ec2-user  0 10\u6708  4 12:31 07\n-rw-rw-r-- 1 ec2-user ec2-user  0 10\u6708  4 12:31 08\n-rw-rw-r-- 1 ec2-user ec2-user  0 10\u6708  4 12:31 09\n-rw-rw-r-- 1 ec2-user ec2-user  0 10\u6708  4 12:31 10\n\n\u300c\u3067\u304d\u305f\u300d\u3068\u8a00\u3048\u3070\u3067\u304d\u307e\u3057\u305f\u304c\u3001\u3044\u308d\u3044\u308d\u3068\u30dd\u30a4\u30f3\u30c8\u3092\u6291\u3048\u3089\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u4e0d\u5b89\u306f\u6b8b\u308a\u307e\u3059\u3002\n\n\u30ce\u30fc\u30c9\u5897\u6e1b\n\u6298\u89d2\u306a\u306e\u3067\u3001\u30ce\u30fc\u30c9\u3092\u5897\u3084\u3057\u305f\u308a\u6e1b\u3089\u3057\u305f\u308a\u3057\u3066\u307f\u307e\u3059\u3002\n(\u7528\u8a9e\u3068\u3057\u3066\u6b63\u3057\u3044\u306e\u306f\u30d6\u30ea\u30c3\u30af\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002)\n\n\u8ffd\u52a0\n\u307e\u305a\u306f\u3001Gluster \u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3092\u4e00\u901a\u308a\u6e08\u307e\u305b\u307e\u3059\u3002\n\u53c2\u8003\u306b\u3057\u305f\u8cc7\u6599\u306b\u3088\u308c\u3070\u3001\u30ec\u30d7\u30ea\u30ab\u69cb\u6210\u306e\u5834\u5408\u306f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c2\u3064(\u7b49\u500d?)\u5fc5\u8981\u306b\u306a\u308b\u3068\u306e\u3053\u3068\u306a\u306e\u3067\u3001\u65b0\u3057\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u6e96\u5099\u3057\u307e\u3059\u3002\n$ sudo wget -P /etc/yum.repos.d http://download.gluster.org/pub/gluster/glusterfs/LATEST/RHEL/glusterfs-epel.repo\n$ sudo sed -i.orig -e 's/$releasever/6/g' /etc/yum.repos.d/glusterfs-epel.repo\n$ sudo yum install -y --enablerepo=epel glusterfs-server\n$ sudo yum install -y xfsprogs\n$ sudo mkfs.xfs -i size=512 /dev/sdb\n$ sudo mkdir -p /export/sdb\n$ sudo mount /dev/sdb /export/sdb\n$ sudo mkdir -p /export/sdb/brick\n$ echo \"/dev/sdb /export/sdb xfs defaults 0 0\" | sudo tee -a /etc/fstab\n$ sudo /sbin/service glusterd start\n$ sudo chkconfig glusterd on\n\n\u30d7\u30fc\u30eb\u306b\u30ce\u30fc\u30c9\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster peer probe 172.31.11.127\npeer probe: success.\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster peer probe 172.31.10.131\npeer probe: success.\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster pool list\nUUID                                    Hostname        State\na7241f9b-086e-43b1-8194-f0415635ef0f    172.31.22.91    Connected\n7fc1bf72-c10f-4205-b0d3-a926d6a402f2    172.31.11.127   Connected\na6dd5cc5-7fbe-43bf-957a-6111bdeff0a6    172.31.10.131   Connected\nd51c1102-1503-478e-bf6f-0b23ca9a3e52    localhost       Connected\n\n\u30dc\u30ea\u30e5\u30fc\u30e0\u306b\u30d6\u30ea\u30c3\u30af\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster volume add-brick gv0 172.31.11.127:/export/sdb/brick 172.31.10.131:/export/sdb/brick\nvolume add-brick: success\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster volume status gv0\nStatus of volume: gv0\nGluster process                             TCP Port  RDMA Port  Online  Pid\n------------------------------------------------------------------------------\nBrick 172.31.22.91:/export/sdb/brick        49152     0          Y       22879\nBrick 172.31.6.251:/export/sdb/brick        49152     0          Y       2381\nBrick 172.31.11.127:/export/sdb/brick       49152     0          Y       2592\nBrick 172.31.10.131:/export/sdb/brick       49152     0          Y       2539\nNFS Server on localhost                     2049      0          Y       2694\nSelf-heal Daemon on localhost               N/A       N/A        Y       2702\nNFS Server on 172.31.11.127                 2049      0          Y       2611\nSelf-heal Daemon on 172.31.11.127           N/A       N/A        Y       2619\nNFS Server on 172.31.10.131                 2049      0          Y       2558\nSelf-heal Daemon on 172.31.10.131           N/A       N/A        Y       2566\nNFS Server on 172.31.22.91                  2049      0          Y       23317\nSelf-heal Daemon on 172.31.22.91            N/A       N/A        Y       23325\n\nTask Status of Volume gv0\n------------------------------------------------------------------------------\nThere are no active volume tasks\n\n\n\u3053\u306e\u6642\u70b9\u3067\u306f\u3001\u8ffd\u52a0\u3057\u305f\u30ce\u30fc\u30c9\u306b\u30d5\u30a1\u30a4\u30eb\u304c\u540c\u671f\u3055\u308c\u307e\u305b\u3093\u3002\n[ec2-user@ip-172-31-11-127 ~]$ ls -al /export/sdb/brick/\n\u5408\u8a08 0\ndrwxr-xr-x 4 root root  39 10\u6708  4 12:56 .\ndrwxr-xr-x 3 root root  18 10\u6708  4 12:40 ..\ndrw------- 6 root root 133 10\u6708  4 12:57 .glusterfs\ndrwxr-xr-x 3 root root  24 10\u6708  4 12:56 .trashcan\n\n[ec2-user@ip-172-31-10-131 ~]$ ls -al /export/sdb/brick/\n\u5408\u8a08 0\ndrwxr-xr-x 4 root root  39 10\u6708  4 12:56 .\ndrwxr-xr-x 3 root root  18 10\u6708  4 12:56 ..\ndrw------- 6 root root 133 10\u6708  4 12:57 .glusterfs\ndrwxr-xr-x 3 root root  24 10\u6708  4 12:56 .trashcan\n\n\u306a\u304a\u3001\u3059\u3067\u306b\u30de\u30a6\u30f3\u30c8\u3057\u3066\u3044\u305f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u66f8\u304d\u306f\u51fa\u6765\u3066\u3044\u307e\u3059\u3002\n[ec2-user@ip-172-31-4-109 ~]$ touch /glusterfs/gv0-nfs/ec2-user/11\n\n[ec2-user@ip-172-31-6-251 ~]$ ls -l /export/sdb/brick/ec2-user/11\n-rw-rw-r-- 2 ec2-user ec2-user 0 10\u6708  4 12:58 /export/sdb/brick/ec2-user/11\n\n[ec2-user@ip-172-31-22-91 ~]$ ls -l /export/sdb/brick/ec2-user/11\n-rw-rw-r-- 2 ec2-user ec2-user 0 10\u6708  4 12:58 /export/sdb/brick/ec2-user/11\n\n\u8ffd\u52a0\u3057\u305f\u30ce\u30fc\u30c9\u306b\u30d5\u30a1\u30a4\u30eb\u304c\u540c\u671f\u3055\u308c\u308b\u3088\u3046\u306b\u3001\u518d\u914d\u7f6e\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster volume rebalance gv0 start\nvolume rebalance: gv0: success: Rebalance on gv0 has been started successfully. Use rebalance status command to check status of the rebalance process.\nID: b3d552aa-3f61-40b1-9436-8bbe66b0407c\n\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster volume rebalance gv0 status\n                                    Node Rebalanced-files          size       scanned      failures       skipped               status   run time in secs\n                               ---------      -----------   -----------   -----------   -----------   -----------         ------------     --------------\n                               localhost                0        0Bytes             0             0             0            completed               0.00\n                            172.31.22.91                4        0Bytes            11             0             0            completed               0.00\n                           172.31.11.127                0        0Bytes             0             0             0            completed               0.00\n                           172.31.10.131                0        0Bytes             0             0             0            completed               0.00\nvolume rebalance: gv0: success:\n\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster volume status gv0\nStatus of volume: gv0\nGluster process                             TCP Port  RDMA Port  Online  Pid\n------------------------------------------------------------------------------\nBrick 172.31.22.91:/export/sdb/brick        49152     0          Y       22879\nBrick 172.31.6.251:/export/sdb/brick        49152     0          Y       2381\nBrick 172.31.11.127:/export/sdb/brick       49152     0          Y       2592\nBrick 172.31.10.131:/export/sdb/brick       49152     0          Y       2539\nNFS Server on localhost                     2049      0          Y       2694\nSelf-heal Daemon on localhost               N/A       N/A        Y       2702\nNFS Server on 172.31.11.127                 2049      0          Y       2611\nSelf-heal Daemon on 172.31.11.127           N/A       N/A        Y       2619\nNFS Server on 172.31.10.131                 2049      0          Y       2558\nSelf-heal Daemon on 172.31.10.131           N/A       N/A        Y       2566\nNFS Server on 172.31.22.91                  2049      0          Y       23317\nSelf-heal Daemon on 172.31.22.91            N/A       N/A        Y       23325\n\nTask Status of Volume gv0\n------------------------------------------------------------------------------\nTask                 : Rebalance\nID                   : b3d552aa-3f61-40b1-9436-8bbe66b0407c\nStatus               : completed\n\n\n\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\uff0b\u5206\u6563\u3055\u308c\u307e\u3057\u305f\u3002\n1\u53f0\u3060\u3051\u306e\u30ec\u30d7\u30ea\u30ab\u8ffd\u52a0\u306f\u3067\u304d\u306a\u3044\u306e\u3067\u3057\u3087\u3046\u304b\u3002\n\n\u524a\u9664\n\u5148\u307b\u3069\u8ffd\u52a0\u3057\u305f\u30d6\u30ea\u30c3\u30af\u3092\u524a\u9664\u3057\u307e\u3059\u3002\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster volume remove-brick gv0 172.31.11.127:/export/sdb/brick 172.31.10.131:/export/sdb/brick start\nvolume remove-brick start: success\nID: 77ff7183-1575-4a68-8718-af733802853f\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster volume remove-brick gv0 172.31.11.127:/export/sdb/brick 172.31.10.131:/export/sdb/brick status\n                                    Node Rebalanced-files          size       scanned      failures       skipped               status   run time in secs\n                               ---------      -----------   -----------   -----------   -----------   -----------         ------------     --------------\n                           172.31.11.127                4        0Bytes             4             0             0            completed               0.00\n                           172.31.10.131                0        0Bytes             0             0             0            completed               0.00\n\n\u51e6\u7406\u304c\u5b8c\u4e86\u3057\u305f\u3089\u78ba\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster volume status gv0\nStatus of volume: gv0\nGluster process                             TCP Port  RDMA Port  Online  Pid\n------------------------------------------------------------------------------\nBrick 172.31.22.91:/export/sdb/brick        49152     0          Y       22879\nBrick 172.31.6.251:/export/sdb/brick        49152     0          Y       2381\nBrick 172.31.11.127:/export/sdb/brick       49152     0          Y       2592\nBrick 172.31.10.131:/export/sdb/brick       49152     0          Y       2539\nNFS Server on localhost                     2049      0          Y       2823\nSelf-heal Daemon on localhost               N/A       N/A        Y       2831\nNFS Server on 172.31.11.127                 2049      0          Y       2611\nSelf-heal Daemon on 172.31.11.127           N/A       N/A        Y       2619\nNFS Server on 172.31.10.131                 2049      0          Y       2558\nSelf-heal Daemon on 172.31.10.131           N/A       N/A        Y       2566\nNFS Server on 172.31.22.91                  2049      0          Y       23371\nSelf-heal Daemon on 172.31.22.91            N/A       N/A        Y       23379\n\nTask Status of Volume gv0\n------------------------------------------------------------------------------\nTask                 : Remove brick\nID                   : 77ff7183-1575-4a68-8718-af733802853f\nRemoved bricks:\n172.31.11.127:/export/sdb/brick\n172.31.10.131:/export/sdb/brick\nStatus               : completed\n\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster volume remove-brick gv0 172.31.11.127:/export/sdb/brick 172.31.10.131:/export/sdb/brick commit\nRemoving brick(s) can result in data loss. Do you want to Continue? (y/n) y\nvolume remove-brick commit: success\nCheck the removed bricks to ensure all files are migrated.\nIf files with data are found on the brick path, copy them via a gluster mount point before re-purposing the removed brick.\n\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster volume status gv0\nStatus of volume: gv0\nGluster process                             TCP Port  RDMA Port  Online  Pid\n------------------------------------------------------------------------------\nBrick 172.31.22.91:/export/sdb/brick        49152     0          Y       22879\nBrick 172.31.6.251:/export/sdb/brick        49152     0          Y       2381\nNFS Server on localhost                     2049      0          Y       2869\nSelf-heal Daemon on localhost               N/A       N/A        Y       2877\nNFS Server on 172.31.11.127                 2049      0          Y       2714\nSelf-heal Daemon on 172.31.11.127           N/A       N/A        Y       2722\nNFS Server on 172.31.10.131                 2049      0          Y       22820\nSelf-heal Daemon on 172.31.10.131           N/A       N/A        Y       22828\nNFS Server on 172.31.22.91                  2049      0          Y       23398\nSelf-heal Daemon on 172.31.22.91            N/A       N/A        Y       23406\n\nTask Status of Volume gv0\n------------------------------------------------------------------------------\nThere are no active volume tasks\n\n\n\u3059\u3067\u306b\u30de\u30a6\u30f3\u30c8\u3057\u3066\u3044\u305f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u66f8\u304d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\n\u5099\u8003\n\nEC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30e1\u30e2\n\n\u6700\u521d\u306e Gluster \u30ce\u30fc\u30c9 2 \u53f0(\u7570\u306a\u308b\u30be\u30fc\u30f3)\n\n\n172.31.6.251\n172.31.22.91\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\n\n\n172.31.4.109\n\n\n\u5f8c\u304b\u3089\u8ffd\u52a0\u3057\u305f Gluster \u30ce\u30fc\u30c9 2 \u53f0\n\n\n172.31.11.127\n172.31.10.131\n\n\n\n\n\u53c2\u8003\n\nEC2\u3067GlusterFS\u3092\u4f7f\u3063\u3066\u307f\u305f \uff5c Developers.IO\nAWS Partner SA \u30d6\u30ed\u30b0: \u30ec\u30c3\u30c9\u30cf\u30c3\u30c8\u793e\u6280\u8853\u6295\u7a3f - Red Hat Gluster Storage\u7de8\nGlusterFS3.5: iptables\u3067\u958b\u304f\u3079\u304d\u30dd\u30fc\u30c8\u756a\u53f7 | EXBLOG\n\u30dc\u30ea\u30e5\u30fc\u30e0\u69cb\u6210\u5909\u66f4\u624b\u9806 - GlusterFS\u6280\u8853\u60c5\u5831\n4.6. \u30d6\u30ea\u30c3\u30af\u8ffd\u52a0\u30fb\u524a\u9664\u3068\u30ea\u30d0\u30e9\u30f3\u30b9 \u2013 GlusterFS Community \u3067\u306f\u3058\u3081\u308b\u5206\u6563\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0 \u00ab \u30a4\u30f3\u30d5\u30e9\u672c\u8217\n\nAmazon Elastic Filey System \u306e\u30d7\u30ec\u30d3\u30e5\u30fc\u3092\u7533\u3057\u8fbc\u3093\u3067\u304b\u3089\u6570\u9031\u9593\u304c\u7d4c\u3061\u307e\u3059\u3002\n\u306a\u304b\u306a\u304b\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u3089\u306a\u3044\u306e\u3067\u3001GlusterFS \u3068\u3044\u3046\u3084\u3064\u3067\u6687\u3092\u3064\u3076\u3057\u307e\u3059\u3002\n\u4ee5\u4e0b\u3001\u3060\u3089\u3060\u3089\u3068\u3057\u305f\u6687\u3064\u3076\u3057\u3092\u30e1\u30e2\u3057\u305f\u3082\u306e\u3067\u3059\u3002\n\n\nTL;DR\n----\n\n- GlusterFS \u3092\u3055\u308f\u3063\u3066\u307f\u305f(\u8a73\u3057\u3044\u3053\u3068\u306f\u7406\u89e3\u3057\u3066\u306a\u3044)\n- GlusterFS \u306b\u306f ELB \u3092\u7d4c\u7531\u3057\u3066 NFS \u3067\u30de\u30a6\u30f3\u30c8\u3057\u3066\u307f\u305f(\u3042\u308a\u306a\u306e\u304b\u308f\u304b\u3063\u3066\u306a\u3044)\n- \u30af\u30e9\u30b9\u30bf\u306e\u30ce\u30fc\u30c9\u5897\u6e1b\u3092\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u884c\u3048\u308b\u3089\u3057\u304d\u3053\u3068\u3092\u78ba\u8a8d(\u305d\u306e\u969b\u306e\u8ca0\u8377\u306a\u3069\u306f\u6e2c\u3063\u3066\u306a\u3044)\n- \u30dc\u30ea\u30e5\u30fc\u30e0\u4f5c\u6210\u307e\u3067\u306f\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u53c2\u8003\u306b\u3057\u305f(\u30ce\u30fc\u30c9\u5897\u6e1b\u3042\u305f\u308a\u306f\u30d6\u30ed\u30b0\u8a18\u4e8b\u306a\u3069\u306e\u975e\u516c\u5f0f\u60c5\u5831\u3092\u53c2\u8003)\n- EFS \u30d7\u30ec\u30d3\u30e5\u30fc\u3001\u306f\u3088\u3053\u3044\n\n\nGlusterFS\n----\n\n> GlusterFS is a scalable network filesystem. Using common off-the-shelf hardware, you can create large, distributed storage solutions for media streaming, data analysis, and other data- and bandwidth-intensive tasks. GlusterFS is free and open source software.\n> [Storage for your Cloud. \u2014 Gluster](http://www.gluster.org/)\n\n\n> GlusterFS\u306f\u3001\u30b9\u30b1\u30fc\u30e9\u30d6\u30eb\u306a\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u305f\u3081\u306e\u6c4e\u7528\u5206\u6563\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306e1\u3064\u3002InfiniBand\u306eRDMA\u3084TCP/IP\u30a4\u30f3\u30bf\u30fc\u30b3\u30cd\u30af\u30c8\u306a\u3069\u306e\u5404\u7a2e\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u96c6\u7d04\u3057\u3001\u5927\u898f\u6a21\u4e26\u5217\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u69cb\u7bc9\u3067\u304d\u308b\u3002GlusterFS\u306f\u30e6\u30fc\u30b6\u30fc\u7a7a\u9593\u3067\u69cb\u7bc9\u3055\u308c\u3066\u304a\u308a\u3001\u6027\u80fd\u3092\u4f4e\u4e0b\u3055\u305b\u308b\u3053\u3068\u304c\u306a\u3044\u3002\u30af\u30e9\u30a6\u30c9\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u3001\u751f\u7269\u533b\u5b66\u3001\u8d85\u5927\u5bb9\u91cf\u30b9\u30c8\u30ec\u30fc\u30b8\u306a\u3069\u69d8\u3005\u306a\u5fdc\u7528\u304c\u306a\u3055\u308c\u3066\u3044\u308b\u3002GlusterFS\u306f\u3001\u5f53\u521dGluster, Inc.\u306b\u3088\u3063\u3066\u958b\u767a\u3055\u308c\u305f\u30022011\u5e74\u306e\u30ec\u30c3\u30c9\u30cf\u30c3\u30c8\u306b\u3088\u308bGluster\u8cb7\u53ce\u306e\u5f8c\u306f\u30ec\u30c3\u30c9\u30cf\u30c3\u30c8\u306b\u3088\u308a\u958b\u767a\u3055\u308c\u3066\u3044\u308b\u3002\n> [GlusterFS - Wikipedia](https://ja.wikipedia.org/wiki/GlusterFS)\n\n### Deploying in AWS\n\n- [Deploying in AWS - Gluster Docs](http://gluster.readthedocs.org/en/latest/Install-Guide/Setup_aws/)\n- 2\u3064\u4ee5\u4e0a\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f7f\u3046\n- \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3067\u30dd\u30fc\u30c8\u3092\u5236\u9650\u3059\u308b(\u5f8c\u8ff0)\n- ephemeral \u304c\u8a31\u3055\u308c\u308b\u306e\u306f\u30c6\u30b9\u30c8\u307e\u3067\n- \u5546\u7528\u74b0\u5883\u3067\u306f\u3001Multi-AZ \u3067\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3059\u3079\u3057\n- \u5546\u7528\u74b0\u5883\u3067\u306f\u3001EBS, EIP \u306e\u5229\u7528\u3092\u63a8\u5968\u3059\u308b\n\n### \u7591\u554f\n\n- \u30c0\u30a6\u30f3\u30bf\u30a4\u30e0\u306a\u3057\u3067\u30ce\u30fc\u30c9\u306e\u5897\u6e1b\u304c\u53ef\u80fd\u306a\u306e\u304b\n- \u30db\u30c3\u30c8\u30b9\u30ef\u30c3\u30d7\u7684\u306a\u30ce\u30fc\u30c9\u4ea4\u63db\u306f\u53ef\u80fd\u306a\u306e\u304b\n\n\nEC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\n----\n\nAmazon Linux \u306e AMI \u3092\u4f7f\u3044\u3001t2.micro \u306e EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092 2 \u3064\u7528\u610f\u3057\u307e\u3059\u3002\n\n### EBS\n\n\u305d\u308c\u305e\u308c\u3001\u8ffd\u52a0\u3067 EBS \u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u30a2\u30bf\u30c3\u30c1\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n### Zone\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f\u7570\u306a\u308b\u30be\u30fc\u30f3\u306b\u914d\u7f6e\u3057\u307e\u3059\u3002\n\n### Security Group\n\n- \u540c\u4e00\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306b\u5bfe\u3057\u3066\u306f\u3059\u3079\u3066\u306e TCP \u3092\u8a31\u53ef\u3057\u3066\u304a\u304d\u307e\u3059\n- \u540c\u4e00 VPC \u306e\u30b5\u30d6\u30cd\u30c3\u30c8 172.31.0.0/16 \u306b\u5bfe\u3057\u3066\u3001\u4ee5\u4e0b\u3092\u8a31\u53ef\u3057\u3066\u304a\u304d\u307e\u3059\n    - UDP: 111\n    - TCP: 111\n    - TCP: 2049\n    - TCP: 38465 - 38467\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n----\n\n- [Install - Gluster Docs](http://gluster.readthedocs.org/en/latest/Install-Guide/Install/)\n\n```shell-session\n$ sudo wget -P /etc/yum.repos.d http://download.gluster.org/pub/gluster/glusterfs/LATEST/RHEL/glusterfs-epel.repo\n$ sudo sed -i.orig -e 's/$releasever/6/g' /etc/yum.repos.d/glusterfs-epel.repo\n$ diff -u /etc/yum.repos.d/glusterfs-epel.repo.orig /etc/yum.repos.d/glusterfs-epel.repo\n--- /etc/yum.repos.d/glusterfs-epel.repo.orig   2015-09-03 14:06:25.000000000 +0000\n+++ /etc/yum.repos.d/glusterfs-epel.repo        2015-10-04 08:23:22.733374955 +0000\n@@ -2,7 +2,7 @@\n\n [glusterfs-epel]\n name=GlusterFS is a clustered file-system capable of scaling to several petabytes.\n-baseurl=http://download.gluster.org/pub/gluster/glusterfs/3.7/LATEST/EPEL.repo/epel-$releasever/$basearch/\n+baseurl=http://download.gluster.org/pub/gluster/glusterfs/3.7/LATEST/EPEL.repo/epel-6/$basearch/\n enabled=1\n skip_if_unavailable=1\n gpgcheck=1\n@@ -10,7 +10,7 @@\n\n [glusterfs-noarch-epel]\n name=GlusterFS is a clustered file-system capable of scaling to several petabytes.\n-baseurl=http://download.gluster.org/pub/gluster/glusterfs/3.7/LATEST/EPEL.repo/epel-$releasever/noarch\n+baseurl=http://download.gluster.org/pub/gluster/glusterfs/3.7/LATEST/EPEL.repo/epel-6/noarch\n enabled=1\n skip_if_unavailable=1\n gpgcheck=1\n@@ -18,7 +18,7 @@\n\n [glusterfs-source-epel]\n name=GlusterFS is a clustered file-system capable of scaling to several petabytes. - Source\n-baseurl=http://download.gluster.org/pub/gluster/glusterfs/3.7/LATEST/EPEL.repo/epel-$releasever/SRPMS\n+baseurl=http://download.gluster.org/pub/gluster/glusterfs/3.7/LATEST/EPEL.repo/epel-6/SRPMS\n enabled=0\n skip_if_unavailable=1\n gpgcheck=1\n$ sudo yum install --enablerepo=epel glusterfs-server\n...\n=========================================================================================================================================================================\n Package                                          \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u30fc               \u30d0\u30fc\u30b8\u30e7\u30f3                                 \u30ea\u30dd\u30b8\u30c8\u30ea\u30fc                            \u5bb9\u91cf\n=========================================================================================================================================================================\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4e2d:\n glusterfs-server                                 x86_64                         3.7.4-2.el6                                glusterfs-epel                         1.3 M\n\u4f9d\u5b58\u6027\u95a2\u9023\u3067\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u3057\u307e\u3059:\n glusterfs                                        x86_64                         3.7.4-2.el6                                glusterfs-epel                         416 k\n glusterfs-api                                    x86_64                         3.7.4-2.el6                                glusterfs-epel                          73 k\n glusterfs-cli                                    x86_64                         3.7.4-2.el6                                glusterfs-epel                         156 k\n glusterfs-client-xlators                         x86_64                         3.7.4-2.el6                                glusterfs-epel                         920 k\n glusterfs-fuse                                   x86_64                         3.7.4-2.el6                                glusterfs-epel                         118 k\n glusterfs-libs                                   x86_64                         3.7.4-2.el6                                glusterfs-epel                         321 k\n python26                                         x86_64                         2.6.9-1.80.amzn1                           amzn-main                              5.7 M\n python26-argparse                                noarch                         1.2.1-2.8.amzn1                            amzn-main                               72 k\n python26-libs                                    x86_64                         2.6.9-1.80.amzn1                           amzn-main                              692 k\n python26-pyxattr                                 x86_64                         0.5.0-1.6.amzn1                            amzn-main                               25 k\n userspace-rcu                                    x86_64                         0.7.7-1.el6                                epel                                    60 k\n...\n```\n\n### $releasever\n\n`glusterfs-epel.repo` \u306e\u4e2d\u306b `$releasever` \u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u7b87\u6240\u304c\u3042\u308a\u307e\u3059\u304c\u3001Amazon Linux \u3060\u3068 `latest` \u3068\u89e3\u91c8\u3055\u308c\u3066\u3057\u307e\u3044 404 \u30a8\u30e9\u30fc\u306b\u306a\u3063\u3066\u3057\u307e\u3057\u307e\u3059\u3002\n\u6700\u521d\u304b\u3089\u3042\u308b epel \u306e\u8a2d\u5b9a\u304c `6` \u3060\u3063\u305f\u306e\u3067\u3001\u540c\u69d8\u306b `6` \u306b\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\n\n### \u4f9d\u5b58\u89e3\u6c7a\u306e\u5931\u6557\n\n\u8ffd\u52a0\u3057\u305f `glusterfs-epel.repo` \u306f `enable=1` \u306a\u306e\u3067 `--enablerepo` \u3092\u3064\u3051\u308b\u5fc5\u8981\u306f\u306a\u3044\u306e\u3067\u3059\u304c\u3001\u305d\u3046\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u306b\u306a\u3063\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u5931\u6557\u3057\u307e\u3059\u3002\n\n```shell-session\n$ sudo yum install glusterfs-server\n...\n--> \u4f9d\u5b58\u6027\u89e3\u6c7a\u3092\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002\n\u30a8\u30e9\u30fc: \u30d1\u30c3\u30b1\u30fc\u30b8: glusterfs-server-3.7.4-2.el6.x86_64 (glusterfs-epel)\n             \u8981\u6c42: liburcu-bp.so.1()(64bit)\n\u30a8\u30e9\u30fc: \u30d1\u30c3\u30b1\u30fc\u30b8: glusterfs-server-3.7.4-2.el6.x86_64 (glusterfs-epel)\n             \u8981\u6c42: liburcu-cds.so.1()(64bit)\n \u554f\u984c\u3092\u56de\u907f\u3059\u308b\u305f\u3081\u306b --skip-broken \u3092\u7528\u3044\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n \u3053\u308c\u3089\u3092\u8a66\u884c\u3067\u304d\u307e\u3059: rpm -Va --nofiles --nodigest\n```\n\n`--enablerepo=epel` \u3092\u3064\u3051\u3066 epel \u3092\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3068\u3001\u4f9d\u5b58\u89e3\u6c7a\u306b\u6210\u529f\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n\u8a2d\u5b9a\n----\n\n- [Configure - Gluster Docs](http://gluster.readthedocs.org/en/latest/Install-Guide/Configure/)\n\n### \u30c7\u30fc\u30e2\u30f3\u8d77\u52d5\n\n```shell-session\n$ sudo /sbin/service glusterd start\n$ sudo chkconfig glusterd on\n```\n\n### peer\n\n```shell-session\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster peer probe 172.31.22.91\npeer probe: success.\n```\n\n```shell-session\n[ec2-user@ip-172-31-22-91 ~]$ sudo gluster peer probe 172.31.6.251\npeer probe: success.\n```\n\n- host: hostname of the other server in the cluster, or IP address if you don\u2019t have DNS or /etc/hosts entries\n\n### \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\n\n```shell-session\n$ sudo yum install xfsprogs\n$ sudo mkfs.xfs -i size=512 /dev/sdb\nmeta-data=/dev/sdb               isize=512    agcount=4, agsize=524288 blks\n         =                       sectsz=512   attr=2, projid32bit=1\n         =                       crc=0        finobt=0\ndata     =                       bsize=4096   blocks=2097152, imaxpct=25\n         =                       sunit=0      swidth=0 blks\nnaming   =version 2              bsize=4096   ascii-ci=0 ftype=0\nlog      =internal log           bsize=4096   blocks=2560, version=2\n         =                       sectsz=512   sunit=0 blks, lazy-count=1\nrealtime =none                   extsz=4096   blocks=0, rtextents=0\n```\n\n### \u30de\u30a6\u30f3\u30c8\n\n```shell-session\n$ sudo mkdir -p /export/sdb\n$ sudo mount /dev/sdb /export/sdb\n$ sudo mkdir -p /export/sdb/brick\n```\n\n### fstab\n\n```\n$ echo \"/dev/sdb /export/sdb xfs defaults 0 0\" | sudo tee -a /etc/fstab\n```\n\n### Gluster \u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\n\u30ec\u30d7\u30ea\u30ab\u30bf\u30a4\u30d7\u3067\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3059\u3002\n\n```shell-session\n$ sudo gluster volume create gv0 replica 2 172.31.22.91:/export/sdb/brick 172.31.6.251:/export/sdb/brick\nvolume create: gv0: success: please start the volume to access data\n```\n\n- host 1: e.g. node01.mydomain.net\n- host 2: e.g. node02.mydomain.net\n\ninfo \u3067\u60c5\u5831\u3092\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```shell-session\n$ gluster volume info\n\nVolume Name: gv0\nType: Replicate\nVolume ID: 373b646e-7f70-4daf-b73c-e4e56db2bba6\nStatus: Created\nNumber of Bricks: 1 x 2 = 2\nTransport-type: tcp\nBricks:\nBrick1: 172.31.22.91:/export/sdb/brick\nBrick2: 172.31.6.251:/export/sdb/brick\nOptions Reconfigured:\nperformance.readdir-ahead: on\n```\n\n\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u5229\u7528\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\n```shell-session\n$ sudo gluster volume start gv0\nvolume start: gv0: success\n```\n\n`glusterfsd` \u3082\u8d77\u52d5\u3057\u3066\u3044\u308b\u6a21\u69d8\u3002\n\n```shell-session\n$ service glusterfsd status\nglusterfsd (pid 3018) is running...\n```\n\n```shell-session\n$ sudo chkconfig glusterfsd on\n```\n\n\n\u5229\u7528\n----\n\n### EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\n\n\u5225\u306b\u65b0\u3057\u304f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068\u306a\u308b EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306f GlusterFS \u7528\u306e\u3082\u306e\u3068\u306f\u5225\u3067\u3001\u30a6\u30a3\u30b6\u30fc\u30c9\u30c7\u30d5\u30a9\u30eb\u30c8\u306e SSH \u306e\u307f\u30aa\u30fc\u30d7\u30f3\u306a\u3084\u3064\u3092\u9069\u7528\u3057\u307e\u3059\u3002\n\n### glusterfs-fuse \u3067\u63a5\u7d9a\n\n\u307e\u305a\u306f\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```shell-session\n[ec2-user@ip-172-31-4-109 ~]$ sudo wget -P /etc/yum.repos.d http://download.gluster.org/pub/gluster/glusterfs/LATEST/RHEL/glusterfs-epel.repo\n[ec2-user@ip-172-31-4-109 ~]$ sudo sed -i.orig -e 's/$releasever/6/g' /etc/yum.repos.d/glusterfs-epel.repo\n[ec2-user@ip-172-31-4-109 ~]$ sudo yum install glusterfs glusterfs-fuse\n```\n\n\u7d9a\u3044\u3066\u30de\u30a6\u30f3\u30c8\u3057\u307e\u3059\u3002\n\n```shell-session\n[ec2-user@ip-172-31-4-109 ~]$ sudo install -d /glusterfs/gv0\n[ec2-user@ip-172-31-4-109 ~]$ sudo mount -t glusterfs 172.31.22.91:/gv0 /glusterfs/gv0/\n```\n\n\u9069\u5f53\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066\u307f\u307e\u3059\u3002\n\n```shell-session\n[ec2-user@ip-172-31-4-109 ~]$ sudo install -d -o ec2-user -g ec2-user /glusterfs/gv0/ec2-user\n[ec2-user@ip-172-31-4-109 ~]$ touch /glusterfs/gv0/ec2-user/{01..10}\n[ec2-user@ip-172-31-4-109 ~]$ ls -l /glusterfs/gv0/ec2-user\n\u5408\u8a08 0\n-rw-rw-r-- 1 ec2-user ec2-user 0 10\u6708  4 10:17 01\n-rw-rw-r-- 1 ec2-user ec2-user 0 10\u6708  4 10:17 02\n-rw-rw-r-- 1 ec2-user ec2-user 0 10\u6708  4 10:17 03\n-rw-rw-r-- 1 ec2-user ec2-user 0 10\u6708  4 10:17 04\n-rw-rw-r-- 1 ec2-user ec2-user 0 10\u6708  4 10:17 05\n-rw-rw-r-- 1 ec2-user ec2-user 0 10\u6708  4 10:17 06\n-rw-rw-r-- 1 ec2-user ec2-user 0 10\u6708  4 10:17 07\n-rw-rw-r-- 1 ec2-user ec2-user 0 10\u6708  4 10:17 08\n-rw-rw-r-- 1 ec2-user ec2-user 0 10\u6708  4 10:17 09\n-rw-rw-r-- 1 ec2-user ec2-user 0 10\u6708  4 10:17 10\n```\n\n\u30b5\u30fc\u30d0\u5074\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```shell-session\n[ec2-user@ip-172-31-6-251 ~]$ ls -al /export/sdb/brick/ec2-user/\n\u5408\u8a08 0\ndrwxr-xr-x 2 ec2-user ec2-user 96 10\u6708  4 10:17 .\ndrwxr-xr-x 5 root     root     54 10\u6708  4 10:17 ..\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 01\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 02\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 03\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 04\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 05\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 06\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 07\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 08\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 09\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 10\n```\n\n```shell-session\n[ec2-user@ip-172-31-22-91 ~]$ ls -al /export/sdb/brick/ec2-user/\n\u5408\u8a08 0\ndrwxr-xr-x 2 ec2-user ec2-user 96 10\u6708  4 10:17 .\ndrwxr-xr-x 5 root     root     54 10\u6708  4 10:17 ..\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 01\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 02\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 03\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 04\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 05\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 06\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 07\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 08\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 09\n-rw-rw-r-- 2 ec2-user ec2-user  0 10\u6708  4 10:17 10\n```\n\n### \u7247\u5074\u306e glusterd \u3092\u6b62\u3081\u3066\u307f\u308b\n\n\u30de\u30a6\u30f3\u30c8\u6642\u306b\u6307\u5b9a\u3057\u305f\u65b9\u3068\u306f\u5225\u306e\u30db\u30b9\u30c8\u3067 `glusterd` \u3092\u6b62\u3081\u3066\u307f\u307e\u3059\u3002\n\n```shell-session\n[ec2-user@ip-172-31-6-251 ~]$ sudo service glusterd stop\n[ec2-user@ip-172-31-6-251 ~]$ sudo service glusterd status\nglusterd is stopped\n```\n\n\u9069\u5f53\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066\u307f\u307e\u3059\u3002\n\n```shell-session\n[ec2-user@ip-172-31-4-109 ~]$ touch /glusterfs/gv0/ec2-user/{11..20}\n```\n\n\u30d5\u30a1\u30a4\u30eb\u306f\u4e21\u65b9\u306b\u4f5c\u3089\u308c\u3066\u3044\u308b\u6a21\u69d8\u3002\n\n```shell-session\n[ec2-user@ip-172-31-6-251 ~]$ ls -la /export/sdb/brick/ec2-user/\n\u5408\u8a08 0\ndrwxr-xr-x 2 ec2-user ec2-user 186 10\u6708  4 10:23 .\ndrwxr-xr-x 5 root     root      54 10\u6708  4 10:17 ..\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 01\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 02\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 03\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 04\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 05\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 06\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 07\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 08\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 09\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 10\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 11\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 12\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 13\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 14\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 15\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 16\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 17\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 18\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 19\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 20\n```\n\n```shell-session\n[ec2-user@ip-172-31-22-91 ~]$ ls -la /export/sdb/brick/ec2-user/\n\u5408\u8a08 0\ndrwxr-xr-x 2 ec2-user ec2-user 186 10\u6708  4 10:23 .\ndrwxr-xr-x 5 root     root      54 10\u6708  4 10:17 ..\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 01\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 02\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 03\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 04\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 05\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 06\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 07\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 08\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 09\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:17 10\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 11\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 12\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 13\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 14\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 15\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 16\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 17\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 18\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 19\n-rw-rw-r-- 2 ec2-user ec2-user   0 10\u6708  4 10:23 20\n```\n\n### \u7247\u5074\u306e EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u6b62\u3081\u3066\u307f\u308b\n\n```shell-session\n[ec2-user@ip-172-31-6-251 ~]$ sudo shutdown -h now\n```\n\nstatus \u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001Disconnected \u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n```shell-session\n[ec2-user@ip-172-31-22-91 ~]$ sudo gluster peer status\nNumber of Peers: 1\n\nHostname: ip-172-31-6-251.ap-northeast-1.compute.internal\nUuid: d51c1102-1503-478e-bf6f-0b23ca9a3e52\nState: Peer in Cluster (Disconnected)\nOther names:\n172.31.6.251\n```\n\n\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n```shell-session\n[ec2-user@ip-172-31-4-109 ~]$ touch /glusterfs/gv0/ec2-user/21\n```\n\n```\n[ec2-user@ip-172-31-22-91 ~]$ ls -la /export/sdb/brick/ec2-user/21\n-rw-rw-r-- 2 ec2-user ec2-user 0 10\u6708  4 10:30 /export/sdb/brick/ec2-user/21\n```\n\n\u505c\u6b62\u3055\u305b\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3057\u3066\u3001\u505c\u6b62\u4e2d\u306b\u5897\u3048\u305f\u30d5\u30a1\u30a4\u30eb\u304c\u540c\u671f\u3055\u308c\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```shell-session\n[ec2-user@ip-172-31-6-251 ~]$ ls -l /export/sdb/brick/ec2-user/21\n-rw-rw-r-- 2 ec2-user ec2-user 0 10\u6708  4 10:30 /export/sdb/brick/ec2-user/21\n```\n\n\u3069\u306e\u7a0b\u5ea6\u306e\u6642\u9593\u3067\u540c\u671f\u3055\u308c\u308b\u304b\u306f\u672a\u78ba\u8a8d\u3002\n\n\nNFS\n----\n\n`glusterfs-fuse` \u3067\u306e\u30de\u30a6\u30f3\u30c8\u3092\u89e3\u9664\u3057\u307e\u3059\u3002\n\n```shell-session\n[ec2-user@ip-172-31-4-109 ~]$ sudo umount -t /glusterfs/gv0/\n```\n\n```shell-session\n[ec2-user@ip-172-31-4-109 ~]$ sudo install -d /glusterfs/gv0-nfs/\n[ec2-user@ip-172-31-4-109 ~]$ sudo mount -t nfs 172.31.22.91:/gv0 /glusterfs/gv0-nfs/\\\n[ec2-user@ip-172-31-4-109 ~]$ ls -al /glusterfs/gv0-nfs/ec2-user\n\u5408\u8a08 0\ndrwxr-xr-x 2 ec2-user ec2-user 195 10\u6708  4 10:30 .\ndrwxr-xr-x 5 root     root      54 10\u6708  4 10:17 ..\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 01\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 02\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 03\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 04\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 05\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 06\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 07\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 08\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 09\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 10\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 11\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 12\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 13\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 14\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 15\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 16\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 17\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 18\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 19\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 20\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:30 21\n```\n\n### NFSv4\n\nAmazon Elastic File System \u306f NFSv4 \u4e92\u63db\u3068\u3044\u3046\u8a71\u306a\u306e\u3067\u3001GlusterFS \u3082 NFSv4 \u3067\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u306e\u3067\u3059\u304c\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\n```shell-session\n[ec2-user@ip-172-31-4-109 ~]$ sudo umount /glusterfs/gv0-nfs/\n[ec2-user@ip-172-31-4-109 ~]$ sudo install -d /glusterfs/gv0-nfs4/\n[ec2-user@ip-172-31-4-109 ~]$ sudo mount -t nfs4 172.31.22.91:/gv0 /glusterfs/gv0-nfs4/\nmount.nfs4: Protocol not supported\n```\n\nNFS-Ganesha \u3068\u3044\u3046\u3082\u306e\u3068\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3067 NFSv4 \u3067\u306e\u63a5\u7d9a\u304c\u53ef\u80fd\u306b\u306a\u308b\u3088\u3046\u3067\u3059\u3002\n\n- [GlusterFS\u3068NFS-Ganesha\u3092\u9023\u643a\u3059\u308b - Qiita](http://qiita.com/yunano/items/86d02d8af4cb97f45d92)\n- [Packages for 3rd Party Software with built-in GlusterFS support | Gluster Community Website](http://blog.gluster.org/category/nfsv4/)\n\n\u3053\u308c\u306f\u307e\u305f\u4eca\u5ea6\u3002\n\n\nNFS \u3068 ELB\n----\n\n\u30de\u30a6\u30f3\u30c8\u6642\u306b\u6307\u5b9a\u3059\u308b\u30db\u30b9\u30c8\u3092\u56fa\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u304b\u3001\u5185\u90e8\u5411\u3051 ELB \u3092\u4f7f\u3063\u3066\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u53ca\u3073 NFS \u306b\u8a73\u3057\u304f\u306a\u3044\u305f\u3081\u3001\u7d20\u3063\u9813\u72c2\u306a\u3053\u3068\u3092\u3057\u3066\u3044\u308b\u6c17\u304c\u3057\u307e\u3059\u3002\n\n### \u5185\u90e8\u5411\u3051 ELB \u306e\u4f5c\u6210\n\n- [\u5185\u90e8\u5411\u3051\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u30fc\u306e\u4f5c\u6210 - Elastic Load Balancing](https://docs.aws.amazon.com/ja_jp/ElasticLoadBalancing/latest/DeveloperGuide/elb-create-internal-load-balancer.html)\n\n\u30ea\u30b9\u30ca\u30fc\u3092\u4ee5\u4e0b\u3068\u3057\u307e\u3059\u3002\n\n- TCP 111\n- TCP 2049\n- TCP 38465\n- TCP 38466\n- TCP 38467\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306f\u3001\u30ce\u30fc\u30c9\u3068\u306a\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u9069\u7528\u3057\u305f\u3082\u306e\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n\u30d8\u30eb\u30b9\u30c1\u30a7\u30c3\u30af\u3092 TCP 2049 \u3078\u306e Ping \u3068\u3057\u307e\u3059\u3002\n\n### \u30de\u30a6\u30f3\u30c8\n\n`dig` \u306a\u3069\u3067 DNS \u306e\u540d\u524d\u89e3\u6c7a\u304c\u3067\u304d\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3089\u30de\u30a6\u30f3\u30c8\u3057\u3066\u307f\u307e\u3059\u3002\n\n```shell-session\n[ec2-user@ip-172-31-4-109 ~]$ sudo mount -t nfs internal-glusterfs-736899893.ap-northeast-1.elb.amazonaws.com:/gv0 /glusterfs/gv0-nfs/\n[ec2-user@ip-172-31-4-109 ~]$ df\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9                                                       1K-\u30d6\u30ed\u30c3\u30af    \u4f7f\u7528  \u4f7f\u7528\u53ef \u4f7f\u7528% \u30de\u30a6\u30f3\u30c8\u4f4d\u7f6e\n/dev/xvda1                                                             8123812 1123564 6900000   15% /\ndevtmpfs                                                                500720      60  500660    1% /dev\ntmpfs                                                                   509728       0  509728    0% /dev/shm\ninternal-glusterfs-736899893.ap-northeast-1.elb.amazonaws.com:/gv0     8378368   32768 8345600    1% /glusterfs/gv0-nfs\n[ec2-user@ip-172-31-4-109 ~]$ ls -la /glusterfs/gv0-nfs\n\u5408\u8a08 4\ndrwxr-xr-x 5 root     root       54 10\u6708  4 10:17 .\ndrwxr-xr-x 7 root     root     4096 10\u6708  4 10:42 ..\ndrwxr-xr-x 3 root     root       24 10\u6708  4 09:30 .trashcan\ndrwxr-xr-x 2 ec2-user ec2-user  204 10\u6708  4 12:07 ec2-user\n[ec2-user@ip-172-31-4-109 ~]$ ls -la /glusterfs/gv0-nfs/ec2-user/\n\u5408\u8a08 0\ndrwxr-xr-x 2 ec2-user ec2-user 204 10\u6708  4 12:07 .\ndrwxr-xr-x 5 root     root      54 10\u6708  4 10:17 ..\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 01\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 02\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 03\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 04\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 05\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 06\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 07\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 08\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 09\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:17 10\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 11\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 12\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 13\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 14\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 15\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 16\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 17\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 18\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 19\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:23 20\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 10:30 21\n-rw-rw-r-- 1 ec2-user ec2-user   0 10\u6708  4 12:07 22\n[ec2-user@ip-172-31-4-109 ~]$ rm /glusterfs/gv0-nfs/ec2-user/*\n[ec2-user@ip-172-31-4-109 ~]$ ls -la /glusterfs/gv0-nfs/ec2-user/\n\u5408\u8a08 0\ndrwxr-xr-x 2 ec2-user ec2-user  6 10\u6708  4 12:31 .\ndrwxr-xr-x 5 root     root     54 10\u6708  4 10:17 ..\n[ec2-user@ip-172-31-4-109 ~]$ touch /glusterfs/gv0-nfs/ec2-user/{01..10}\n[ec2-user@ip-172-31-4-109 ~]$ ls -la /glusterfs/gv0-nfs/ec2-user/\n\u5408\u8a08 0\ndrwxr-xr-x 2 ec2-user ec2-user 96 10\u6708  4 12:31 .\ndrwxr-xr-x 5 root     root     54 10\u6708  4 10:17 ..\n-rw-rw-r-- 1 ec2-user ec2-user  0 10\u6708  4 12:31 01\n-rw-rw-r-- 1 ec2-user ec2-user  0 10\u6708  4 12:31 02\n-rw-rw-r-- 1 ec2-user ec2-user  0 10\u6708  4 12:31 03\n-rw-rw-r-- 1 ec2-user ec2-user  0 10\u6708  4 12:31 04\n-rw-rw-r-- 1 ec2-user ec2-user  0 10\u6708  4 12:31 05\n-rw-rw-r-- 1 ec2-user ec2-user  0 10\u6708  4 12:31 06\n-rw-rw-r-- 1 ec2-user ec2-user  0 10\u6708  4 12:31 07\n-rw-rw-r-- 1 ec2-user ec2-user  0 10\u6708  4 12:31 08\n-rw-rw-r-- 1 ec2-user ec2-user  0 10\u6708  4 12:31 09\n-rw-rw-r-- 1 ec2-user ec2-user  0 10\u6708  4 12:31 10\n```\n\n\u300c\u3067\u304d\u305f\u300d\u3068\u8a00\u3048\u3070\u3067\u304d\u307e\u3057\u305f\u304c\u3001\u3044\u308d\u3044\u308d\u3068\u30dd\u30a4\u30f3\u30c8\u3092\u6291\u3048\u3089\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u4e0d\u5b89\u306f\u6b8b\u308a\u307e\u3059\u3002\n\n\n\u30ce\u30fc\u30c9\u5897\u6e1b\n----\n\n\u6298\u89d2\u306a\u306e\u3067\u3001\u30ce\u30fc\u30c9\u3092\u5897\u3084\u3057\u305f\u308a\u6e1b\u3089\u3057\u305f\u308a\u3057\u3066\u307f\u307e\u3059\u3002\n(\u7528\u8a9e\u3068\u3057\u3066\u6b63\u3057\u3044\u306e\u306f\u30d6\u30ea\u30c3\u30af\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002)\n\n### \u8ffd\u52a0\n\n\u307e\u305a\u306f\u3001Gluster \u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3092\u4e00\u901a\u308a\u6e08\u307e\u305b\u307e\u3059\u3002\n\u53c2\u8003\u306b\u3057\u305f\u8cc7\u6599\u306b\u3088\u308c\u3070\u3001\u30ec\u30d7\u30ea\u30ab\u69cb\u6210\u306e\u5834\u5408\u306f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c2\u3064(\u7b49\u500d?)\u5fc5\u8981\u306b\u306a\u308b\u3068\u306e\u3053\u3068\u306a\u306e\u3067\u3001\u65b0\u3057\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u6e96\u5099\u3057\u307e\u3059\u3002\n\n```shell-session\n$ sudo wget -P /etc/yum.repos.d http://download.gluster.org/pub/gluster/glusterfs/LATEST/RHEL/glusterfs-epel.repo\n$ sudo sed -i.orig -e 's/$releasever/6/g' /etc/yum.repos.d/glusterfs-epel.repo\n$ sudo yum install -y --enablerepo=epel glusterfs-server\n$ sudo yum install -y xfsprogs\n$ sudo mkfs.xfs -i size=512 /dev/sdb\n$ sudo mkdir -p /export/sdb\n$ sudo mount /dev/sdb /export/sdb\n$ sudo mkdir -p /export/sdb/brick\n$ echo \"/dev/sdb /export/sdb xfs defaults 0 0\" | sudo tee -a /etc/fstab\n$ sudo /sbin/service glusterd start\n$ sudo chkconfig glusterd on\n```\n\n\u30d7\u30fc\u30eb\u306b\u30ce\u30fc\u30c9\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n\n```shell-session\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster peer probe 172.31.11.127\npeer probe: success.\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster peer probe 172.31.10.131\npeer probe: success.\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster pool list\nUUID                                    Hostname        State\na7241f9b-086e-43b1-8194-f0415635ef0f    172.31.22.91    Connected\n7fc1bf72-c10f-4205-b0d3-a926d6a402f2    172.31.11.127   Connected\na6dd5cc5-7fbe-43bf-957a-6111bdeff0a6    172.31.10.131   Connected\nd51c1102-1503-478e-bf6f-0b23ca9a3e52    localhost       Connected\n```\n\n\u30dc\u30ea\u30e5\u30fc\u30e0\u306b\u30d6\u30ea\u30c3\u30af\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```shell-session\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster volume add-brick gv0 172.31.11.127:/export/sdb/brick 172.31.10.131:/export/sdb/brick\nvolume add-brick: success\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster volume status gv0\nStatus of volume: gv0\nGluster process                             TCP Port  RDMA Port  Online  Pid\n------------------------------------------------------------------------------\nBrick 172.31.22.91:/export/sdb/brick        49152     0          Y       22879\nBrick 172.31.6.251:/export/sdb/brick        49152     0          Y       2381\nBrick 172.31.11.127:/export/sdb/brick       49152     0          Y       2592\nBrick 172.31.10.131:/export/sdb/brick       49152     0          Y       2539\nNFS Server on localhost                     2049      0          Y       2694\nSelf-heal Daemon on localhost               N/A       N/A        Y       2702\nNFS Server on 172.31.11.127                 2049      0          Y       2611\nSelf-heal Daemon on 172.31.11.127           N/A       N/A        Y       2619\nNFS Server on 172.31.10.131                 2049      0          Y       2558\nSelf-heal Daemon on 172.31.10.131           N/A       N/A        Y       2566\nNFS Server on 172.31.22.91                  2049      0          Y       23317\nSelf-heal Daemon on 172.31.22.91            N/A       N/A        Y       23325\n\nTask Status of Volume gv0\n------------------------------------------------------------------------------\nThere are no active volume tasks\n\n```\n\n\u3053\u306e\u6642\u70b9\u3067\u306f\u3001\u8ffd\u52a0\u3057\u305f\u30ce\u30fc\u30c9\u306b\u30d5\u30a1\u30a4\u30eb\u304c\u540c\u671f\u3055\u308c\u307e\u305b\u3093\u3002\n\n```shell-session\n[ec2-user@ip-172-31-11-127 ~]$ ls -al /export/sdb/brick/\n\u5408\u8a08 0\ndrwxr-xr-x 4 root root  39 10\u6708  4 12:56 .\ndrwxr-xr-x 3 root root  18 10\u6708  4 12:40 ..\ndrw------- 6 root root 133 10\u6708  4 12:57 .glusterfs\ndrwxr-xr-x 3 root root  24 10\u6708  4 12:56 .trashcan\n```\n\n```shell-session\n[ec2-user@ip-172-31-10-131 ~]$ ls -al /export/sdb/brick/\n\u5408\u8a08 0\ndrwxr-xr-x 4 root root  39 10\u6708  4 12:56 .\ndrwxr-xr-x 3 root root  18 10\u6708  4 12:56 ..\ndrw------- 6 root root 133 10\u6708  4 12:57 .glusterfs\ndrwxr-xr-x 3 root root  24 10\u6708  4 12:56 .trashcan\n```\n\n\u306a\u304a\u3001\u3059\u3067\u306b\u30de\u30a6\u30f3\u30c8\u3057\u3066\u3044\u305f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u66f8\u304d\u306f\u51fa\u6765\u3066\u3044\u307e\u3059\u3002\n\n```shell-session\n[ec2-user@ip-172-31-4-109 ~]$ touch /glusterfs/gv0-nfs/ec2-user/11\n```\n\n```shell-session\n[ec2-user@ip-172-31-6-251 ~]$ ls -l /export/sdb/brick/ec2-user/11\n-rw-rw-r-- 2 ec2-user ec2-user 0 10\u6708  4 12:58 /export/sdb/brick/ec2-user/11\n```\n\n```shell-session\n[ec2-user@ip-172-31-22-91 ~]$ ls -l /export/sdb/brick/ec2-user/11\n-rw-rw-r-- 2 ec2-user ec2-user 0 10\u6708  4 12:58 /export/sdb/brick/ec2-user/11\n```\n\n\u8ffd\u52a0\u3057\u305f\u30ce\u30fc\u30c9\u306b\u30d5\u30a1\u30a4\u30eb\u304c\u540c\u671f\u3055\u308c\u308b\u3088\u3046\u306b\u3001\u518d\u914d\u7f6e\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\n```shell-session\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster volume rebalance gv0 start\nvolume rebalance: gv0: success: Rebalance on gv0 has been started successfully. Use rebalance status command to check status of the rebalance process.\nID: b3d552aa-3f61-40b1-9436-8bbe66b0407c\n\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster volume rebalance gv0 status\n                                    Node Rebalanced-files          size       scanned      failures       skipped               status   run time in secs\n                               ---------      -----------   -----------   -----------   -----------   -----------         ------------     --------------\n                               localhost                0        0Bytes             0             0             0            completed               0.00\n                            172.31.22.91                4        0Bytes            11             0             0            completed               0.00\n                           172.31.11.127                0        0Bytes             0             0             0            completed               0.00\n                           172.31.10.131                0        0Bytes             0             0             0            completed               0.00\nvolume rebalance: gv0: success:\n\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster volume status gv0\nStatus of volume: gv0\nGluster process                             TCP Port  RDMA Port  Online  Pid\n------------------------------------------------------------------------------\nBrick 172.31.22.91:/export/sdb/brick        49152     0          Y       22879\nBrick 172.31.6.251:/export/sdb/brick        49152     0          Y       2381\nBrick 172.31.11.127:/export/sdb/brick       49152     0          Y       2592\nBrick 172.31.10.131:/export/sdb/brick       49152     0          Y       2539\nNFS Server on localhost                     2049      0          Y       2694\nSelf-heal Daemon on localhost               N/A       N/A        Y       2702\nNFS Server on 172.31.11.127                 2049      0          Y       2611\nSelf-heal Daemon on 172.31.11.127           N/A       N/A        Y       2619\nNFS Server on 172.31.10.131                 2049      0          Y       2558\nSelf-heal Daemon on 172.31.10.131           N/A       N/A        Y       2566\nNFS Server on 172.31.22.91                  2049      0          Y       23317\nSelf-heal Daemon on 172.31.22.91            N/A       N/A        Y       23325\n\nTask Status of Volume gv0\n------------------------------------------------------------------------------\nTask                 : Rebalance\nID                   : b3d552aa-3f61-40b1-9436-8bbe66b0407c\nStatus               : completed\n\n```\n\n\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\uff0b\u5206\u6563\u3055\u308c\u307e\u3057\u305f\u3002\n1\u53f0\u3060\u3051\u306e\u30ec\u30d7\u30ea\u30ab\u8ffd\u52a0\u306f\u3067\u304d\u306a\u3044\u306e\u3067\u3057\u3087\u3046\u304b\u3002\n\n### \u524a\u9664\n\n\u5148\u307b\u3069\u8ffd\u52a0\u3057\u305f\u30d6\u30ea\u30c3\u30af\u3092\u524a\u9664\u3057\u307e\u3059\u3002\n\n```shell-session\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster volume remove-brick gv0 172.31.11.127:/export/sdb/brick 172.31.10.131:/export/sdb/brick start\nvolume remove-brick start: success\nID: 77ff7183-1575-4a68-8718-af733802853f\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster volume remove-brick gv0 172.31.11.127:/export/sdb/brick 172.31.10.131:/export/sdb/brick status\n                                    Node Rebalanced-files          size       scanned      failures       skipped               status   run time in secs\n                               ---------      -----------   -----------   -----------   -----------   -----------         ------------     --------------\n                           172.31.11.127                4        0Bytes             4             0             0            completed               0.00\n                           172.31.10.131                0        0Bytes             0             0             0            completed               0.00\n```\n\n\u51e6\u7406\u304c\u5b8c\u4e86\u3057\u305f\u3089\u78ba\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n\n```shell-session\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster volume status gv0\nStatus of volume: gv0\nGluster process                             TCP Port  RDMA Port  Online  Pid\n------------------------------------------------------------------------------\nBrick 172.31.22.91:/export/sdb/brick        49152     0          Y       22879\nBrick 172.31.6.251:/export/sdb/brick        49152     0          Y       2381\nBrick 172.31.11.127:/export/sdb/brick       49152     0          Y       2592\nBrick 172.31.10.131:/export/sdb/brick       49152     0          Y       2539\nNFS Server on localhost                     2049      0          Y       2823\nSelf-heal Daemon on localhost               N/A       N/A        Y       2831\nNFS Server on 172.31.11.127                 2049      0          Y       2611\nSelf-heal Daemon on 172.31.11.127           N/A       N/A        Y       2619\nNFS Server on 172.31.10.131                 2049      0          Y       2558\nSelf-heal Daemon on 172.31.10.131           N/A       N/A        Y       2566\nNFS Server on 172.31.22.91                  2049      0          Y       23371\nSelf-heal Daemon on 172.31.22.91            N/A       N/A        Y       23379\n\nTask Status of Volume gv0\n------------------------------------------------------------------------------\nTask                 : Remove brick\nID                   : 77ff7183-1575-4a68-8718-af733802853f\nRemoved bricks:\n172.31.11.127:/export/sdb/brick\n172.31.10.131:/export/sdb/brick\nStatus               : completed\n\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster volume remove-brick gv0 172.31.11.127:/export/sdb/brick 172.31.10.131:/export/sdb/brick commit\nRemoving brick(s) can result in data loss. Do you want to Continue? (y/n) y\nvolume remove-brick commit: success\nCheck the removed bricks to ensure all files are migrated.\nIf files with data are found on the brick path, copy them via a gluster mount point before re-purposing the removed brick.\n\n[ec2-user@ip-172-31-6-251 ~]$ sudo gluster volume status gv0\nStatus of volume: gv0\nGluster process                             TCP Port  RDMA Port  Online  Pid\n------------------------------------------------------------------------------\nBrick 172.31.22.91:/export/sdb/brick        49152     0          Y       22879\nBrick 172.31.6.251:/export/sdb/brick        49152     0          Y       2381\nNFS Server on localhost                     2049      0          Y       2869\nSelf-heal Daemon on localhost               N/A       N/A        Y       2877\nNFS Server on 172.31.11.127                 2049      0          Y       2714\nSelf-heal Daemon on 172.31.11.127           N/A       N/A        Y       2722\nNFS Server on 172.31.10.131                 2049      0          Y       22820\nSelf-heal Daemon on 172.31.10.131           N/A       N/A        Y       22828\nNFS Server on 172.31.22.91                  2049      0          Y       23398\nSelf-heal Daemon on 172.31.22.91            N/A       N/A        Y       23406\n\nTask Status of Volume gv0\n------------------------------------------------------------------------------\nThere are no active volume tasks\n\n```\n\n\u3059\u3067\u306b\u30de\u30a6\u30f3\u30c8\u3057\u3066\u3044\u305f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u66f8\u304d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\n\n\u5099\u8003\n----\n\n### EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30e1\u30e2\n\n- \u6700\u521d\u306e Gluster \u30ce\u30fc\u30c9 2 \u53f0(\u7570\u306a\u308b\u30be\u30fc\u30f3)\n    - 172.31.6.251\n    - 172.31.22.91\n- \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\n    - 172.31.4.109\n- \u5f8c\u304b\u3089\u8ffd\u52a0\u3057\u305f Gluster \u30ce\u30fc\u30c9 2 \u53f0\n    - 172.31.11.127\n    - 172.31.10.131\n\n\n\u53c2\u8003\n----\n\n- [EC2\u3067GlusterFS\u3092\u4f7f\u3063\u3066\u307f\u305f \uff5c Developers.IO](http://dev.classmethod.jp/cloud/aws/glusterfs-on-ec2/)\n- [AWS Partner SA \u30d6\u30ed\u30b0: \u30ec\u30c3\u30c9\u30cf\u30c3\u30c8\u793e\u6280\u8853\u6295\u7a3f - Red Hat Gluster Storage\u7de8](http://aws.typepad.com/aws_partner_sa/2015/03/redhat-gluster-storage.html)\n- [GlusterFS3.5: iptables\u3067\u958b\u304f\u3079\u304d\u30dd\u30fc\u30c8\u756a\u53f7 | EXBLOG](https://www.exbit.biz/blog/?p=152)\n- [\u30dc\u30ea\u30e5\u30fc\u30e0\u69cb\u6210\u5909\u66f4\u624b\u9806 - GlusterFS\u6280\u8853\u60c5\u5831](https://sites.google.com/site/glusterfstech/volumes/modify)\n- [4.6. \u30d6\u30ea\u30c3\u30af\u8ffd\u52a0\u30fb\u524a\u9664\u3068\u30ea\u30d0\u30e9\u30f3\u30b9 \u2013 GlusterFS Community \u3067\u306f\u3058\u3081\u308b\u5206\u6563\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0 \u00ab \u30a4\u30f3\u30d5\u30e9\u672c\u8217](http://infra.makeall.net/archives/2322)\n", "tags": ["GlusterFS"]}