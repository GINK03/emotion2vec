{"context": " More than 1 year has passed since last update.\n\n\u4e8b\u524d\u6e96\u5099\nCentOS 6 \u3067\u3084\u308a\u307e\u3059\u3002\n\nCDH 5 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nhadoop \u306e\u7acb\u3061\u4e0a\u3052\nSpark \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3001\u7acb\u3061\u4e0a\u3052\n\n\u307e\u3067\u3084\u3063\u3066\u304a\u304d\u307e\u3059\u3002\n\nSpark \u7528\u30e6\u30fc\u30b6\u306e\u4f5c\u6210\n\n\nshell\n$ sudo useradd hoxom_spark\n$ sudo usermod -a -G wheel hoxom_spark\n$ sudo passwd hoxo_spark\n\n\n\nHDFS \u4e0a\u306b\u4f5c\u696d\u7528\u30d5\u30a9\u30eb\u30c0\u3092\u4f5c\u6210\n\n\nshell\n$ sudo -u hdfs hadoop fs -mkdir -p /user/hoxom_spark\n$ sudo -u hdfs hadoop fs -chown hoxom_spark /user/hoxom_spark\n\n\n\nHDFS \u306e\u4f5c\u696d\u30d5\u30a9\u30eb\u30c0\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\n\n\nshell\n$ sudo cp /home/hoxom/tracking_log/tracking.2014-12-02.log.gz /home/hoxom_spark/\n$ su - hoxom_spark\n$ hadoop fs -put /home/hoxom_spark/tracking.2014-12-02.log.gz /user/hoxom_spark/tracking.2014-12-02.log.gz\n$ hadoop fs -ls /user/hoxom_spark  # HDFS \u4e0a\u306b\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\n\n\n\n\u7d50\u679c\nFound 1 items\n-rw-r--r--   1 hoxom_spark supergroup   32438207 2014-12-24 11:40 /user/hoxom_spark/tracking.2014-12-02.log.gz\n\n\n\nSpark\n\u53c2\u8003\u30b5\u30a4\u30c8\n\nApache Spark \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u548c\u8a33 - Quick Start\nSpark \u3092\u6d3b\u7528\u3059\u308b:\u30d3\u30c3\u30b0\u30c7\u30fc\u30bf\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7528\u306e\u9ad8\u901f\u30a4\u30f3\u30e1\u30e2\u30ea\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\nSpark Programming Guide\n\nRDD Class\uff08RDD\u30af\u30e9\u30b9\u306e\u30e1\u30bd\u30c3\u30c9\u4e00\u89a7\uff09\n\nSpark \u30b7\u30a7\u30eb\u306e\u8d77\u52d5\n$ spark-shell\n\n\n\u7d50\u679c\nWelcome to\n      ____              __\n     / __/__  ___ _____/ /__\n    _\\ \\/ _ \\/ _ `/ __/  '_/\n   /___/ .__/\\_,_/_/ /_/\\_\\   version 1.1.0\n      /_/\n\nUsing Scala version 2.10.4 (Java HotSpot(TM) 64-Bit Server VM, Java 1.7.0_65)\nSpark context available as sc.\nscala>\n\n\nSpark context \u30aa\u30d6\u30b8\u30a7\u30af\u30c8 sc \u304c\u3067\u304d\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\n\n\nScala\nval file = sc.textFile(\"hdfs://localhost/user/hoxom_spark/tracking.2014-12-02.log.gz\")\nfile.count // \u884c\u6570\u3092\u51fa\u529b\n\n\n\n\u7d50\u679c\n963021\n\n\n\n\u30ab\u30e9\u30e0\u306b\u5206\u5272\n\n\nScala\nval lines = file.map(_.split(\"\\t\"))\nlines.count      // \u884c\u6570\nlines.first.size // \u30ab\u30e9\u30e0\u6570\n\n\n\n\u7d50\u679c\n963021\n9\n\n\n\n\u30b9\u30de\u30fc\u30c8\u30d5\u30a9\u30f3\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u306e\u307f\u62bd\u51fa\n\n\nScala\nval sp = lines.filter(_.contains(\"SP\"))\nsp.count\n\n\n\n\u7d50\u679c\n402659\n\n\n\n\u7d50\u679c\u3092\u30e1\u30e2\u30ea\u4e0a\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\n\n\nScala\nval sp_dm = sp.filter(_(4).startsWith(\"DM\"))\nsp_dm.cache()\nsp_dm.count\n\n\n\n\u7d50\u679c\n196805\n\n\n\u540c\u3058\u8a08\u7b97\u3092\u3082\u3046\u4e00\u5ea6\u3002\n\nScala\nsp_dm.count\n\n\n\n\u7d50\u679c\n196805\n\n\n\u4e8c\u56de\u76ee\u306f\u3081\u3063\u3061\u3083\u901f\u3044\uff01\n\n\u30ad\u30e3\u30c3\u30b7\u30e5\u304b\u3089\u524a\u9664\n\n\nScala\nsp_dm.unpersist()\n\n\n\n\u7aef\u672b\u3054\u3068\u306e PV \u3092\u96c6\u8a08\n\n\nScala\nval pv_by_terminal = lines.map(line => (line(7), 1)).countByKey\npv_by_terminal.foreach(item => println(item._1 + \"\\t\" + item._2))\n\n\n\n\u7d50\u679c\nPC      530430\nMB      29932\nSP      402659\n\n\n## \u4e8b\u524d\u6e96\u5099\n\nCentOS 6 \u3067\u3084\u308a\u307e\u3059\u3002\n\n- CDH 5 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n- hadoop \u306e\u7acb\u3061\u4e0a\u3052\n- Spark \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3001\u7acb\u3061\u4e0a\u3052\n\n\u307e\u3067\u3084\u3063\u3066\u304a\u304d\u307e\u3059\u3002\n\n- Spark \u7528\u30e6\u30fc\u30b6\u306e\u4f5c\u6210\n\n```shell-session:shell\n$ sudo useradd hoxom_spark\n$ sudo usermod -a -G wheel hoxom_spark\n$ sudo passwd hoxo_spark\n```\n\n- HDFS \u4e0a\u306b\u4f5c\u696d\u7528\u30d5\u30a9\u30eb\u30c0\u3092\u4f5c\u6210\n\n```shell-session:shell\n$ sudo -u hdfs hadoop fs -mkdir -p /user/hoxom_spark\n$ sudo -u hdfs hadoop fs -chown hoxom_spark /user/hoxom_spark\n```\n\n- HDFS \u306e\u4f5c\u696d\u30d5\u30a9\u30eb\u30c0\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\n\n```shell-session:shell\n$ sudo cp /home/hoxom/tracking_log/tracking.2014-12-02.log.gz /home/hoxom_spark/\n$ su - hoxom_spark\n$ hadoop fs -put /home/hoxom_spark/tracking.2014-12-02.log.gz /user/hoxom_spark/tracking.2014-12-02.log.gz\n$ hadoop fs -ls /user/hoxom_spark  # HDFS \u4e0a\u306b\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\n```\n\n```:\u7d50\u679c\nFound 1 items\n-rw-r--r--   1 hoxom_spark supergroup   32438207 2014-12-24 11:40 /user/hoxom_spark/tracking.2014-12-02.log.gz\n```\n\n## Spark\n\n\u53c2\u8003\u30b5\u30a4\u30c8\n\n- [Apache Spark \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u548c\u8a33 - Quick Start](http://qiita.com/mychaelstyle/items/46440cd27ef641892a58)\n- [Spark \u3092\u6d3b\u7528\u3059\u308b:\u30d3\u30c3\u30b0\u30c7\u30fc\u30bf\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7528\u306e\u9ad8\u901f\u30a4\u30f3\u30e1\u30e2\u30ea\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0](http://www.cloudera.co.jp/blog/putting-spark-to-use-fast-in-memory-computing-for-your-big-data-applications.html)\n- [Spark Programming Guide](http://spark.apache.org/docs/latest/programming-guide.html)\n- [RDD Class](http://spark.apache.org/docs/latest/api/java/org/apache/spark/rdd/RDD.html)\uff08RDD\u30af\u30e9\u30b9\u306e\u30e1\u30bd\u30c3\u30c9\u4e00\u89a7\uff09\n\nSpark \u30b7\u30a7\u30eb\u306e\u8d77\u52d5\n\n```bash\n$ spark-shell\n```\n\n```:\u7d50\u679c\nWelcome to\n      ____              __\n     / __/__  ___ _____/ /__\n    _\\ \\/ _ \\/ _ `/ __/  '_/\n   /___/ .__/\\_,_/_/ /_/\\_\\   version 1.1.0\n      /_/\n\nUsing Scala version 2.10.4 (Java HotSpot(TM) 64-Bit Server VM, Java 1.7.0_65)\nSpark context available as sc.\nscala>\n```\n\nSpark context \u30aa\u30d6\u30b8\u30a7\u30af\u30c8 sc \u304c\u3067\u304d\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n- \u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\n\n```scala:Scala\nval file = sc.textFile(\"hdfs://localhost/user/hoxom_spark/tracking.2014-12-02.log.gz\")\nfile.count // \u884c\u6570\u3092\u51fa\u529b\n```\n\n```:\u7d50\u679c\n963021\n```\n\n- \u30ab\u30e9\u30e0\u306b\u5206\u5272\n\n```scala:Scala\nval lines = file.map(_.split(\"\\t\"))\nlines.count      // \u884c\u6570\nlines.first.size // \u30ab\u30e9\u30e0\u6570\n```\n\n```:\u7d50\u679c\n963021\n9\n```\n\n- \u30b9\u30de\u30fc\u30c8\u30d5\u30a9\u30f3\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u306e\u307f\u62bd\u51fa\n\n```scala:Scala\nval sp = lines.filter(_.contains(\"SP\"))\nsp.count\n```\n\n```:\u7d50\u679c\n402659\n```\n\n- \u7d50\u679c\u3092\u30e1\u30e2\u30ea\u4e0a\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\n\n```scala:Scala\nval sp_dm = sp.filter(_(4).startsWith(\"DM\"))\nsp_dm.cache()\nsp_dm.count\n```\n\n```:\u7d50\u679c\n196805\n```\n\n\u540c\u3058\u8a08\u7b97\u3092\u3082\u3046\u4e00\u5ea6\u3002\n\n```scala:Scala\nsp_dm.count\n```\n\n```:\u7d50\u679c\n196805\n```\n\n\u4e8c\u56de\u76ee\u306f\u3081\u3063\u3061\u3083\u901f\u3044\uff01\n\n- \u30ad\u30e3\u30c3\u30b7\u30e5\u304b\u3089\u524a\u9664\n\n```scala:Scala\nsp_dm.unpersist()\n```\n\n- \u7aef\u672b\u3054\u3068\u306e PV \u3092\u96c6\u8a08\n\n```scala:Scala\nval pv_by_terminal = lines.map(line => (line(7), 1)).countByKey\npv_by_terminal.foreach(item => println(item._1 + \"\\t\" + item._2))\n```\n\n```:\u7d50\u679c\nPC      530430\nMB      29932\nSP      402659\n```\n\n\n\n\n", "tags": ["Spark", "Scala"]}