{"context": "\n\n\u30c1\u30fc\u30c8\u30b7\u30fc\u30c8\u306b\u3064\u3044\u3066\n\u5225\u540d\u3001\u300c\u79d8\u4f1d\u306e\u66f8\u300d\u3082\u3057\u304f\u306f\u300c\u6280\u96c6\u300d\u3067\u3059\u3002\n\u300c\uff5e\u306a\u4e8b\u3092\u3057\u305f\u3044\u300d\u3068\u3044\u3046\u6280\u3092\u307e\u3068\u3081\u3066\u3044\u307e\u3059\u3002\u30d7\u30e9\u30b0\u30a4\u30f3\u958b\u767a\u306b\u3042\u305f\u3063\u3066\u5fc5\u8981\u306a\u6280\u3092\u7d39\u4ecb\u3057\u3066\u3044\u307e\u3059\u3002\u958b\u767a\u306e\u304a\u4f9b\u306b\u3069\u3046\u305e\u3002\n\n\u30c1\u30fc\u30c8\u30b7\u30fc\u30c8\u306e\u4f7f\u3044\u65b9\n\u56f0\u3063\u305f\u6642\u306b\u3053\u306e\u30da\u30fc\u30b8\u3092\u958b\u304d\u3001\u30d6\u30e9\u30a6\u30b6\u306e\u691c\u7d22\u6a5f\u80fd(Ctrl+F \u306a\u3069)\u3084\u7d22\u5f15\u306a\u3069\u3067\u8abf\u3079\u3066\u3044\u304d\u307e\u3059\u3002\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u7a2e\u985e\n\nmod (\u6d3b\u52d5\u30e2\u30b8\u30e5\u30fc\u30eb)\nblock (\u30d6\u30ed\u30c3\u30af)\nlocal (\u30ed\u30fc\u30ab\u30eb)\nqtype (\u554f\u984c\u30bf\u30a4\u30d7)\n\n\n\u958b\u767a\u306e\u524d\u306b\n\n\u30c7\u30d0\u30c3\u30b0\u30ec\u30d9\u30eb\u3092\u4e0a\u3052\u308b\n\u958b\u767a\u4e2d\u306f\u753b\u9762\u306b\u30c7\u30d0\u30c3\u30b0\u7528\u306e\u30a8\u30e9\u30fc(Warning/Notice)\u3092\u51fa\u529b\u3055\u305b\u305f\u3044\u4e8b\u304c\u591a\u3044\u306e\u3067\u3001\u958b\u767a\u8005\u30e2\u30fc\u30c9\u306b\u5207\u308a\u66ff\u3048\u308b\u3002\n\u300c\u30b5\u30a4\u30c8\u7ba1\u7406\u300d->\u300c\u958b\u767a\u300d->\u300c\u30c7\u30d0\u30c3\u30b0\u300d\u753b\u9762\u306b\u3042\u308b\u300c\u30c7\u30d0\u30c3\u30b0\u30e1\u30c3\u30bb\u30fc\u30b8\u300d\u3092\n\u300cDEVELOPER : \u958b\u767a\u8005\u306e\u305f\u3081\u306e\u7279\u5225Moodle\u30c7\u30d0\u30c3\u30b0\u30e1\u30c3\u30bb\u30fc\u30b8\u300d\u306b\u5909\u66f4\n\n\n\n\u8a2d\u5b9a\u540d\n\u5024\n\n\n\n\n\u30c7\u30d0\u30c3\u30b0\u30e1\u30c3\u30bb\u30fc\u30b8\nDEVELOPER : \u958b\u767a\u8005\u306e\u305f\u3081\u306e\u7279\u5225Moodle\u30c7\u30d0\u30c3\u30b0\u30e1\u30c3\u30bb\u30fc\u30b8\n\n\n\u30c7\u30d0\u30c3\u30af\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8868\u793a\u3059\u308b\nON\n\n\n\u30da\u30fc\u30b8\u60c5\u5831\u3092\u8868\u793a\u3059\u308b\nON\n\n\n\n\n\u3053\u3046\u3059\u308b\u3068\u3001\u753b\u9762\u30d8\u30c3\u30c0\u30fc\u306bcontextid\u306a\u3069\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\n\u30c7\u30b6\u30a4\u30f3\u3092\u3059\u308b\n\n\u3069\u3093\u306a\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u307b\u3057\u3044\u306e\u304b\n\u5148\u751f\u306f\u3069\u3093\u306a\u3053\u3068\u3092\u3059\u308b\u306e\u304b\n\u5b66\u751f\u306f\u3069\u3093\u306a\u3053\u3068\u3092\u3059\u308b\u306e\u304b\n\u753b\u9762\u9077\u79fb\u306f\u3069\u3046\u3059\u308b\uff1f\n\u3069\u3093\u306a\u30c7\u30fc\u30bf\u3092Moodle\u304b\u3089\u53d6\u308a\u305f\u3044\uff1f\n\u3069\u3093\u306a\u30c7\u30fc\u30bf\u3092Moodle\u306b\u4fdd\u5b58\u3057\u305f\u3044\uff1f\n\n\u3092\u8003\u3048\u308b\u3002\u4f55\u304b\u7279\u5225\u306a\u30c4\u30fc\u30eb\u3092\u4f7f\u308f\u306a\u304f\u3066\u3082\u5927\u4e08\u592b\u3002\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u304b\u3089\u65b0\u898f\u4f5c\u6210\u3057\u305f\u3044\nGitHub\u306b\u3044\u305a\u308c\u3082\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u304c\u516c\u958b\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u4f7f\u3046\u3002\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n\u30d6\u30ed\u30c3\u30af\ndanielneis\u3055\u3093\u304c\u516c\u958b\u3057\u3066\u3044\u308b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f7f\u3046\u3002\nhttps://github.com/danielneis/moodle-block_newblock\n\n\u6d3b\u52d5\u30e2\u30b8\u30e5\u30fc\u30eb\nMoodleHQ\u304c\u516c\u958b\u3057\u3066\u3044\u308b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f7f\u3046\u3002\nhttps://github.com/moodlehq/moodle-mod_newmodule\n\u958b\u767a\u74b0\u5883\u304c\u65e2\u306b\u6574\u3063\u3066\u3044\u308b\u306e\u3067\u3042\u308c\u3070\u3001\ncd path/to/moodle/mod/\ngit clone https://github.com/moodlehq/moodle-mod_newmodule.git\n\n\u3067\u3055\u304f\u3063\u3068\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u51fa\u6765\u308b\u3002\n\n\u30ea\u30cd\u30fc\u30e0\u3059\u308b\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u76f4\u5f8c\u306f\u3001newblock\u3082\u3057\u304f\u306fnewmodule\u3068\u3044\u3046\u540d\u524d\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\u3053\u306e\u307e\u307e\u3067\u3082\u3044\u3044\u304c\u3001\u540d\u524d\u304c\u6c7a\u307e\u3063\u3066\u3044\u308b\u5834\u5408\u306f\u3053\u3053\u3067\u5909\u66f4\u3059\u308b\u3002\n\u5f8c\u3067\u5909\u66f4\u3057\u3088\u3046\u3068\u601d\u3046\u3068\u9762\u5012(\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u518d\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5fc5\u8981)\u306a\u306e\u3067\u3001\u4eca\u306e\u3046\u3061\u306b\u8003\u3048\u3088\u3046\u3002\n\u8981\u70b9\u3068\u3057\u3066\u306f\n- \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u4e2d\u306e\"newmodule\" \"newblock\"\u3068\u3044\u3046\u5358\u8a9e\u3092\u4e00\u62ec\u7f6e\u63db\u3059\u308b\u3002\n- lang/en\u5185\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u5909\u66f4\u3059\u308b\u3002(block_newblock.php -> block_hoge.php)\n- block_newblock.php \u3082\u5909\u66f4\u3059\u308b\u3002(block_newblock.php -> block_hoge.php)\n- \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u540d\u3082\u5909\u66f4\u3002\n\u304c\u3042\u308b\u3002\u3053\u308c\u3060\u3051\u5909\u3048\u308c\u3070\u3001\u57fa\u672c\u7684\u306b\u6700\u4f4e\u9650\u306e\u7269\u306f\u52d5\u304f\u3002\n\n\u30ea\u30cd\u30fc\u30e0\u6642\u306e\u6ce8\u610f\u70b9\n\u6ce8\u610f\u3057\u305f\u3044\u70b9\u306f\u3001\u6d3b\u52d5\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u30d6\u30ed\u30c3\u30af\u3067\u306f\u30d7\u30e9\u30b0\u30a4\u30f3\u540d\u306e\u547d\u540d\u898f\u5247\u306b\u9055\u3044\u304c\u3042\u308b\u3068\u3044\u3046\u6240\u3002\n\n\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u7a2e\u985e\n\u898f\u7d04\n\u5099\u8003\n\n\n\n\nmod\n\u30a2\u30eb\u30d5\u30a1\u30d9\u30c3\u30c8\u306e\u307f\nPARAM_ALPHA\n\n\nblock\n\u30c6\u30ad\u30b9\u30c8\nPARAM_TEXT\n\n\n\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u5192\u982d\u306e\"This file is part of Moodle - \"\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u524a\u9664\u3057\u305f\u3044\n\u3042\u306a\u305f\u304c\u4f5c\u3063\u305f\u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u4f8b\u5916\u306a\u304fGPL v3\u30e9\u30a4\u30bb\u30f3\u30b9\u306b\u306a\u308b\u3002\u3053\u306e\u4e8b\u3092\u5fd8\u308c\u306a\u3044\u3088\u3046\u306b\u3057\u3066\u6b32\u3057\u3044\u3002\n\n\u30d6\u30ed\u30c3\u30af\u5185\u306b\u8868\u793a\u3055\u305b\u308bHTML\u306f\u3069\u3053\u306b\u66f8\u304f\u306e\uff1f\n\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u5165\u3063\u3066\u3044\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u76f4\u4e0b\u306b\u3042\u308bblock_newblock.php\u306b\u3042\u308b\u3002(\u30d5\u30a1\u30a4\u30eb\u540d\u306f\u30d7\u30e9\u30b0\u30a4\u30f3\u540d\u306b\u3088\u3063\u3066\u5909\u308f\u308b)\n\u5177\u4f53\u7684\u306b\u306f\u3001\n\nblock_newblock.php\n    function get_content() {\n        global $CFG, $OUTPUT;\n        if ($this->content !== null) {\n            return $this->content;\n        }\n        if (empty($this->instance)) {\n            $this->content = '';\n            return $this->content;\n        }\n        $this->content = new stdClass();\n        $this->content->items = array();\n        $this->content->icons = array();\n        $this->content->footer = '';\n        // user/index.php expect course context, so get one if page has module context.\n        $currentcontext = $this->page->context->get_course_context(false);\n        if (! empty($this->config->text)) {\n            $this->content->text = $this->config->text;\n        }\n        $this->content = '';\n        if (empty($currentcontext)) {\n            return $this->content;\n        }\n        if ($this->page->course->id == SITEID) {\n            $this->content->text .= \"site context\";\n        }\n        if (! empty($this->config->text)) {\n            $this->content->text .= $this->config->text;\n        }\n        return $this->content;\n    }\n\n\n\u306e\n$this->content\n\n\u306bHTML\u30bf\u30b0\u3092\u6587\u5b57\u5217\u3068\u3057\u3066\u5165\u308c\u308b\u3068\u3044\u3044\u3002\n\u4f8b\u3048\u3070\u3001\n$this->content->text = \"\";\n$this->content->text .= html_writer::start_div();\n$this->content->text .= \"\u8ab2\u984c\u63d0\u51fa\u8005\u306f\u4e0b\u8a18\u306e\u4eba\u3067\u3059\u3002\";\n$this->content->text .= html_writer::start_tag(\"ul\");\n$this->content->text .= html_writer::tag(\"li\", \"\u3075\u308f\u305f\u304b\u3086\u304d\");\n$this->content->text .= html_writer::tag(\"li\", \"\u307e\u304d\u306e\u305f\u304b\u3057\");\n$this->content->text .= html_writer::tag(\"li\", \"\u3084\u307e\u3060\u3053\u3046\u3058\");\n$this->content->text .= html_writer::end_tag(\"ul\");\n$this->content->text .= html_writer::end_div();\n\n\u3068\u3044\u3046\u611f\u3058\u3067\u8a70\u3081\u8fbc\u3093\u3067\u3044\u304f\u3002\u3053\u306eget_content()\u95a2\u6570\u306f\u6700\u7d42\u7684\u306b$this->content\u3092\u8fd4\u308a\u5024\u3068\u3059\u308b\u3053\u3068\u3067\u52d5\u3044\u3066\u3044\u308b\u3002\n\nhtml_writer\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3064\u3044\u3066\n\u5404\u30e1\u30bd\u30c3\u30c9\u3067\u5fc5\u8981\u306a\u30d1\u30e9\u30e1\u30fc\u30bf\u306f\u7570\u306a\u308b\u3002\n\u3088\u304f\u4f7f\u3046\u5f15\u6570\u306e\u5909\u6570\u540d\u3068\u5185\u5bb9\u306f\u6b21\u306e\u901a\u308a\u3002\n\n\n\n\u5909\u6570\u540d\n\u578b\n\u8aac\u660e\n\u4f8b\n\n\n\n\n$tagname\nString\n\u30bf\u30b0\u540d\u3092\u6307\u5b9a\u3059\u308b\n$tagname = \"h1\"\n\n\n$contents\nString\n\u30bf\u30b0\u5185\u306e\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u6307\u5b9a\u3059\u308b\n$contents = \"\u53d7\u8b1b\u8005\u4e00\u89a7\"\n\n\n$attributes\nArray\n\u30bf\u30b0\u306e\u5c5e\u6027\u3092\u6307\u5b9a\u3059\u308b\n$attributes = [\"class\" => \"header\", \"id\" => \"list1\"]\n\n\n$class\nString\nhtml_writer::div() \u306e\u3088\u3046\u306b\u3001class\u3060\u3051\u6587\u5b57\u5217\u3067\u6307\u5b9a\u3059\u308b\u30e1\u30bd\u30c3\u30c9\u304c\u3042\u308b\u3002\n$class = \"header\"\n\n\n\n\n\u3088\u304f\u4f7f\u3046html_writer\u306e\u30e1\u30bd\u30c3\u30c9\n\nhtml_writer::tag($tagname, $contents, array $attributes = null)\n\n\u9589\u3058\u30bf\u30b0\u3092\u542b\u3093\u3060HTML\u30bf\u30b0\u3092\u51fa\u529b\u3059\u308b\u3002\n\nhtml_writer::start_tag($tagname, array $attributes = null)\n\n\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u90fd\u5408\u4e0a\u3001\u5f8c\u3067\u9589\u3058\u30bf\u30b0\u3092\u4ed8\u3051\u305f\u3044\u5834\u5408\u306b\u306f\u3001\u6700\u521d\u306b\u3053\u308c\u3067\u958b\u59cb\u30bf\u30b0\u3060\u3051\u3092\u51fa\u529b\u3059\u308b\n\nhtml_writer::end_tag($tagname)\n\n\u30eb\u30fc\u30d7\u51e6\u7406\u306e\u6700\u5f8c\u306b\u9589\u3058\u30bf\u30b0\u3092\u4ed8\u3051\u305f\u3044\u5834\u5408\u306b\u306f\u3053\u308c\u3067\u7d42\u4e86\u30bf\u30b0\u3092\u51fa\u529b\u3059\u308b\u3002\n\u3061\u306a\u307f\u306b\u3001html_writer::tag\u30e1\u30bd\u30c3\u30c9\u306e\u5b9f\u88c5\u306f\n    public static function tag($tagname, $contents, array $attributes = null) {\n        return self::start_tag($tagname, $attributes) . $contents . self::end_tag($tagname);\n    }\n\n\u3068\u306a\u3063\u3066\u304a\u308a\u3001start_tag\u30e1\u30bd\u30c3\u30c9\u3068end_tag\u30e1\u30bd\u30c3\u30c9\u306e\u5408\u308f\u305b\u6280\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\nhtml_writer::empty_tag($tagname, array $attributes = null);\n\n<img>\u3084<br>\u30bf\u30b0\u306e\u3088\u3046\u306b\u3001\u9589\u3058\u30bf\u30b0\u304c\u5b58\u5728\u3057\u306a\u3044\u3082\u306e\u306f\nempty_tag\u30e1\u30bd\u30c3\u30c9\u3067\u51fa\u529b\u3059\u308b\u3002\n\nscript($jscode, $url=null)\n\n<script>\u30bf\u30b0\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u306f\u3053\u308c\u3092\u4f7f\u3046\u3002Javascript\u5185\u306e\u30b3\u30fc\u30c9\u306b<![CDATA[\u3092\u30e1\u30bd\u30c3\u30c9\u5185\u3067\u8ffd\u52a0\u3057\u3066\u304f\u308c\u308b\u3002\n\u5b89\u5168\u9762\u304b\u3089\u8003\u3048\u308b\u3068\u3001\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u306e\u4f7f\u7528\u306f\u63a8\u5968\u3055\u308c\u308b\u3002\n\u5916\u90e8JS\u3092\u8aad\u307f\u8fbc\u3080\u6642\u306b\u3082\u3053\u308c\u3092\u4f7f\u3046\u3002\n\u6163\u308c\u3066\u304f\u308b\u3068html_writer\u30af\u30e9\u30b9\u3092\u4f7f\u3046\u65b9\u304c\u697d\u306b\u306a\u308b\u3057\u3001\u30eb\u30fc\u30d7\u51e6\u7406\u306a\u3069\u3067\u306f\u771f\u4fa1\u3092\u767a\u63ee\u3059\u308b\u3002\n\n\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30e1\u30bd\u30c3\u30c9\n\u305d\u306e\u4ed6\u3001\u307e\u3060\u307e\u3060\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30e1\u30bd\u30c3\u30c9\u306f\u305f\u304f\u3055\u3093\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u662f\u975e\u4f7f\u3063\u3066\u6b32\u3057\u3044\u3002\nlib\\outputcomponents.php\n\u306b\u5168\u90e8\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u3002\n\u4f8b\u3048\u3070\u3001<div>\u30bf\u30b0\u306f\u3088\u304f\u4f7f\u3046\u304c\nhtml_writer::tag(\"div\", \"\u3042\u3044\u3046\u3048\u304a\", [\"class\" => \"hoge\"]);\n\n\u3068\u3044\u3046\u611f\u3058\u306b\u66f8\u3044\u3066\u3044\u304f\u304c\u3001\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3046\u3068\nhtml_writer::div(\"\u3042\u3044\u3046\u3048\u304a\", \"hoge\");\n\n\u3067\u7d42\u308f\u308b\u3002\u5c11\u3057\u77ed\u304f\u306a\u3063\u305f\u3002\n\u3061\u306a\u307f\u306b\u3001outputcomponents.php\u306b\u306f\n\noutputcomponents.php\npublic static function div($content, $class = '', array $attributes = null) {\n\n\n\u3068\u5ba3\u8a00\u3055\u308c\u3066\u3044\u308b\u3002\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3044\nMoodle\u306b\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u63a5\u7d9a\u3057\u3001\u30af\u30a8\u30ea\u3092\u6253\u3061\u8fbc\u3080\u30e1\u30bd\u30c3\u30c9\u304c\u4e88\u3081\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u3002Moodle\u306fMySQL\u306e\u4ed6\u306bPostgreSQL\u3084MSSQL\u306b\u3082\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u3002Moodle\u306b\u306f\u3053\u308c\u3089\u306e\u9055\u3044\u3092\u8003\u3048\u306a\u304f\u3066\u3082\u3088\u3044\u30e1\u30bd\u30c3\u30c9\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u4f7f\u3046\u3002\n\u9593\u9055\u3063\u3066\u3082\u3001mysqli\u95a2\u6570\u3092\u4f7f\u3063\u3066\u306f\u3044\u3051\u306a\u3044\u3002\n\n\u6e96\u5099\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u4e0a\u306e\u65b9\u3067\nglobal $DB;\n\n\u3068\u5ba3\u8a00\u3059\u308b\u3002$DB\u306fMoodle\u3067\u65e2\u306b\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u30b0\u30ed\u30fc\u30d0\u30eb\u5909\u6570\u3067\u3042\u308b\u3002\n\nSELECT\n\u30c7\u30fc\u30bf\u4ef6\u6570\u304c1\u4ef6\u304b\u8907\u6570\u4ef6\u304b\u3067\u3061\u3087\u3063\u3068\u30e1\u30bd\u30c3\u30c9\u304c\u9055\u3046\u306e\u3067\u6ce8\u610f\n\u5f15\u6570\u3067\u6307\u5b9a\u3059\u308b\u30c6\u30fc\u30d6\u30eb\u540d\u306f\u3001\u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u4ed8\u3051\u306a\u3044\u3002\n(\u6a19\u6e96\u3067\u306fmdl_\u306b\u306a\u3063\u3066\u3044\u308b)\n\n1\u4ef6\u3060\u3051\u306e\u5834\u5408\n\u7b2c2\u5f15\u6570\u3067\u6761\u4ef6\u3092\u914d\u5217\u3067\u6307\u5b9a\u3059\u308b\u304c\u3001AND\u6761\u4ef6\u3057\u304b\u4f7f\u3048\u306a\u3044\u3002OR\u6761\u4ef6 \u3092\u4f7f\u3046\u5834\u5408\u306f\u3001get_record_sql()\u3092\u4f7f\u3046\u3002\n$DB->get_record(\"\u30c6\u30fc\u30d6\u30eb\u540d\", array \u62bd\u51fa\u6761\u4ef6);\n\n\u4f8b\n$DB->get_record(\"tablename\", ['id' => $cm->course]);\n\n\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u3067\u8907\u6570\u4ef6\u6570\u306e\u30c7\u30fc\u30bf\u3092\u30d2\u30c3\u30c8\u3055\u305b\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u3001Notice\u3067\u8b66\u544a\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\n\u8907\u6570\u4ef6\u306e\u5834\u5408\n\u7b2c2\u5f15\u6570\u3067\u6761\u4ef6\u3092\u914d\u5217\u3067\u6307\u5b9a\u3059\u308b\u304c\u3001AND\u6761\u4ef6\u3057\u304b\u4f7f\u3048\u306a\u3044\u3002OR\u6761\u4ef6 \u3092\u4f7f\u3046\u5834\u5408\u306f\u3001get_records_sql()\u3092\u4f7f\u3046\u3002\n$DB->get_records(\"\u30c6\u30fc\u30d6\u30eb\u540d\", array \u62bd\u51fa\u6761\u4ef6);\n\n\u4f8b\n$DB->get_records(\"tablename\", ['id' => $cm->course]);\n\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u4e0a\u306b\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3057\u305f\u3044\n\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u958b\u767a\u3059\u308b\u306b\u3042\u305f\u3063\u3066\u3001\u30c7\u30fc\u30bf\u306e\u4fdd\u5b58\u304c\u5fc5\u8981\u306b\u306a\u308b\u3002\n\u305d\u3053\u3067\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u66f8\u304d\u8fbc\u307f\u3092\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u304c\u3001\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\ninstall.xml\n\u30d7\u30e9\u30b0\u30a4\u30f3\u5185\u306e\n/db/install.xml\n\u306b\u30c6\u30fc\u30d6\u30eb\u5b9a\u7fa9\u3092\u884c\u3046XML\u304c\u3042\u308a\u3001\u3053\u3053\u3067\u5b9a\u7fa9\u3059\u308b\u3002\n\u91cd\u8981\u306a\u306e\u306f <tables> \u8981\u7d20\u304b\u3089\u59cb\u307e\u308b\u6240\u3067\u3001\n  <TABLES>\n    <TABLE NAME=\"chat\" COMMENT=\"Each of these is a chat room\">\n      <FIELDS>\n        <FIELD NAME=\"id\" TYPE=\"int\" LENGTH=\"10\" NOTNULL=\"true\" SEQUENCE=\"true\"/>\n        <FIELD NAME=\"course\" TYPE=\"int\" LENGTH=\"10\" NOTNULL=\"true\" DEFAULT=\"0\" SEQUENCE=\"false\"/>\n        <FIELD NAME=\"name\" TYPE=\"char\" LENGTH=\"255\" NOTNULL=\"true\" SEQUENCE=\"false\"/>\n        <FIELD NAME=\"intro\" TYPE=\"text\" NOTNULL=\"true\" SEQUENCE=\"false\"/>\n        <FIELD NAME=\"introformat\" TYPE=\"int\" LENGTH=\"4\" NOTNULL=\"true\" DEFAULT=\"0\" SEQUENCE=\"false\" COMMENT=\"text format of intro field\"/>\n        <FIELD NAME=\"keepdays\" TYPE=\"int\" LENGTH=\"11\" NOTNULL=\"true\" DEFAULT=\"0\" SEQUENCE=\"false\"/>\n        <FIELD NAME=\"studentlogs\" TYPE=\"int\" LENGTH=\"4\" NOTNULL=\"true\" DEFAULT=\"0\" SEQUENCE=\"false\"/>\n        <FIELD NAME=\"chattime\" TYPE=\"int\" LENGTH=\"10\" NOTNULL=\"true\" DEFAULT=\"0\" SEQUENCE=\"false\"/>\n        <FIELD NAME=\"schedule\" TYPE=\"int\" LENGTH=\"4\" NOTNULL=\"true\" DEFAULT=\"0\" SEQUENCE=\"false\"/>\n        <FIELD NAME=\"timemodified\" TYPE=\"int\" LENGTH=\"10\" NOTNULL=\"true\" DEFAULT=\"0\" SEQUENCE=\"false\"/>\n      </FIELDS>\n      <KEYS>\n        <KEY NAME=\"primary\" TYPE=\"primary\" FIELDS=\"id\"/>\n      </KEYS>\n      <INDEXES>\n        <INDEX NAME=\"course\" UNIQUE=\"false\" FIELDS=\"course\"/>\n      </INDEXES>\n    </TABLE>    \n\n\u3067\u3042\u308b\u3002\u3061\u306a\u307f\u306b\u3053\u3061\u3089\u306fchat(Moodle\u6a19\u6e96\u642d\u8f09\u306e\u30d7\u30e9\u30b0\u30a4\u30f3)\u3088\u308a\u5f15\u7528\n\n\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\n<TABLE NAME=\"chat\" COMMENT=\"Each of these is a chat room\">\n\nNAME\u306b\u30c6\u30fc\u30d6\u30eb\u540d\u3001COMMENT\u306b\u30b3\u30e1\u30f3\u30c8\u3092\u5165\u308c\u308b\u3002\u30b3\u30e1\u30f3\u30c8\u3092\u5165\u308c\u306a\u3044\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u306b\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u306e\u3067\u6ce8\u610f\u3002\n\n\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u4f5c\u6210\n   <FIELDS>\n        <FIELD NAME=\"id\" TYPE=\"int\" LENGTH=\"10\" NOTNULL=\"true\" SEQUENCE=\"true\"/>\n        <FIELD NAME=\"course\" TYPE=\"int\" LENGTH=\"10\" NOTNULL=\"true\" DEFAULT=\"0\" SEQUENCE=\"false\"/>\n   </FIELDS>\n\n\u30c6\u30fc\u30d6\u30eb\u5185\u306b\u8907\u6570\u30d5\u30a3\u30fc\u30eb\u30c9\u304c\u3042\u308b(\u306f\u305a)\u306a\u306e\u3067\u3001<FIELDS>\u3067\u304f\u304f\u308a\u3001<FIELD>\u3092\u8907\u6570\u5b9a\u7fa9\u3059\u308b\u3002\nNAME : \u30d5\u30a3\u30fc\u30eb\u30c9\u540d(\u30ab\u30e9\u30e0\u540d)\nTYPE : \u578b(TEXT/INT...)\nLENGTH : \u30c7\u30fc\u30bf\u9577\nNOTNULL : NULL\u3092\u8a31\u53ef\u3059\u308b\u304b(true\u3067NULL\u3092\u8a31\u53ef\u3057\u306a\u3044)\nDEFAULT : \u30c7\u30fc\u30bf\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024(NOTNULL\u3092false\u306b\u3057\u305f\u72b6\u614b\u3067\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024)\n\n\u6ce8\u610f\u70b9\ninstall.xml\u306f\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u306b\u3057\u304b\u547c\u3073\u51fa\u3055\u308c\u306a\u3044\u3002\u3064\u307e\u308a\u3001\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u6642\u306b\u306f\u547c\u3073\u51fa\u3055\u308c\u306a\u3044\u3002\n\u3053\u306e\u305f\u3081\u3001\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u6642\u306b\u306f\u5225\u3067\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u66f8\u304b\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3002\n\n\u4fbf\u5229\u306a\u30d7\u30e9\u30b0\u30a4\u30f3\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3084\u518d\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u3057\u306a\u304f\u3066\u3082\u3001install.xml\u306b\u8a18\u8ff0\u3057\u305f\u30c6\u30fc\u30d6\u30eb\u69cb\u6210\u3092\u8ffd\u52a0\u3057\u305f\u308a\u524a\u9664\u3057\u305f\u308a\u51fa\u6765\u308b\u3002\nhttps://moodle.org/plugins/view/local_upgradedb\n\n\u30c7\u30fc\u30bf\u30a4\u30f3\u30b5\u30fc\u30c8\n$inputs = new stdClass();\n$inputs->hoge = \"fuga\"; // hoge\u3068\u3044\u3046\u30ab\u30e9\u30e0\u306bfuga\u3092\u5165\u308c\u308b\n\n$DB->insert_record('quiz', $inputs);\n\n\n\u30c7\u30fc\u30bf\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n$inputs = new stdClass();\n$inputs->id = 1;\n$Inputs->title = \"hoga\";\n\n$DB->update_record('quiz', $inputs);\n\n\u5fc5\u305a$inputs->id\u306f\u5165\u308c\u308b\u3002\n\nSQL\u3092\u76f4\u63a5\u6253\u3061\u8fbc\u307f\u305f\u3044\n$DB->get_records_sql(\n\"SELECT * FROM {quiz} WHERE id = :id\"\n, ['id' => '123']);\n\n\":id\"\u3068\u3059\u308b\u3068\u30d7\u30ec\u30fc\u30b9\u30db\u30eb\u30c0\u30fc\u304c\u4f7f\u3048\u308b\u3002\u7b2c\u4e8c\u5f15\u6570\u306b\u5b9f\u969b\u306e\u5024\u3092\u5165\u308c\u307e\u3059\u3002\n\u5358\u4e00\u4ef6\u6570\u306e\u5834\u5408\u306f\u3001\n$DB->get_record_sql()\n\n\u3068\u306a\u308b\u3002\u5358\u6570\u5f62\u3068\u8907\u6570\u5f62\u3067\u8b58\u5225\u3067\u304d\u307e\u3059\u3002\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u672c\u4f53\u306e\u60c5\u5831\u306f\u3069\u3053\u3067\u8a18\u8ff0\u3059\u308b\u306e\uff1f\nversion.php \u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\u6700\u4f4e\u3067\u3082\u5fc5\u8981\u306a\u8a18\u8ff0\u306f\u3001\ndefined('MOODLE_INTERNAL') || die();\n\n$plugin->version   = 2015061200;        // The current plugin version (Date: YYYYMMDDXX)\n$plugin->requires  = 2014051200;        // Requires this Moodle version\n$plugin->component = 'block_minerva'; // Full name of the plugin (used for diagnostics)\n\n\u3067\u3059\u3002\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3001\u52d5\u4f5c\u306b\u5fc5\u8981\u306aMoodle\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u756a\u53f7(natural name\u3067\u306f\u306a\u3044\u65b9)\u3001\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u540d\u3067\u3059\u3002\n\u30d0\u30fc\u30b8\u30e7\u30f3\u756a\u53f7\u3068natural name\u306e\u76f8\u5bfe\u306f\u3053\u3061\u3089\u3092\u53c2\u7167\u3002\nhttps://docs.moodle.org/dev/Releases\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u306b$plugin->version\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u756a\u53f7\u3092\u5897\u3084\u3059\u3068\u3001\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u51e6\u7406\u304c\u52d5\u304d\u307e\u3059\u3002\n\n$PAGE\n\u4e3b\u306b\u30da\u30fc\u30b8\u5185\u306b\u304a\u3051\u308b\u30d8\u30c3\u30c0\u60c5\u5831\u8a2d\u5b9a\u306b\u4f7f\u3044\u307e\u3059\u3002\u5b9f\u969b\u306e\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u306f$OUTPUT\u306b\u3042\u308a\u307e\u3059\u3002\n\n\u30da\u30fc\u30b8URL\u3092\u8a2d\u5b9a\nMoodle\u306e\u30d1\u30f3\u5c51\u30ea\u30b9\u30c8\u306a\u3069\u3067\u4f7f\u7528\u3057\u307e\u3059\u3002(\u4efb\u610f)\n$PAGE->set_url('/mod/quiz/view.php', ['id' => $cm->id]);\n\n\n\u30da\u30fc\u30b8\u30bf\u30a4\u30c8\u30eb(\u4efb\u610f)\nHTML\u3067\u8a00\u3046\u3068\u3053\u308d\u306e<title></title>\u306e\u8a2d\u5b9a\n$PAGE->set_title(format_string($quiz->name));\n\n\ncontext\u60c5\u5831\u3092\u8a2d\u5b9a(\u5fc5\u9808)\n\u30da\u30fc\u30b8\u306bcontext\u60c5\u5831\u3092\u30bb\u30c3\u30c8\u3059\u308b\n$PAGE->set_context($context);\n\n\nMoodle\u4e0a\u3067jQuery\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\n\u3053\u308c\u3067jQuery\u3092\u30ed\u30fc\u30c9\u3067\u304d\u307e\u3059\u3002\n$PAGE->requires->jquery();\n\n\n\u5916\u90e8js\u3092\u8aad\u307f\u8fbc\u307e\u305b\u305f\u3044\n\u4f55\u56de\u3067\u3082\u4f7f\u3048\u307e\u3059\u3002\n$PAGE->requires->js('../js/hoge.js');\n\n\n\u5916\u90e8css\u3092\u8aad\u307f\u8fbc\u307e\u305b\u305f\u3044\n\u4f55\u56de\u3067\u3082\u4f7f\u3048\u307e\u3059\u3002\n$PAGE->requires->css('../css/hoge.css');\n\n\n$OUTPUT\n\n$OUTPUT\u306f\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u5468\u308a\u3067\u4f7f\u3044\u307e\u3059\u3002HTML\u304c\u623b\u3055\u308c\u308b\u306e\u3067\u3001echo\u3067\u6253\u3061\u51fa\u3059\u3002\n\n\u30d8\u30c3\u30c0\u51fa\u529b\necho $OUTPUT->header();\n\n\n\u30d5\u30c3\u30bf\u30fc\u51fa\u529b\necho $OUTPUT->footer();\n\n\n\u30d5\u30a9\u30fc\u30e0\u3092\u4f5c\u308a\u305f\u3044\n\u666e\u901a\u306eHTML/PHP\u3067\u5165\u529b\u30d5\u30a9\u30fc\u30e0\u3092\u4f5c\u308d\u3046\u3068\u3059\u308b\u3068\u3001\n<form>\n<input type=\"text\" name=\"hoge\" />\n</form>\n\n\u3068\u306a\u308a\u307e\u3059\u304c\u3001Moodle\u306b\u306f\u30d5\u30a9\u30fc\u30e0\u4f5c\u6210\u7528\u306e\u30af\u30e9\u30b9\u30fb\u30e1\u30bd\u30c3\u30c9\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u30d5\u30a9\u30fc\u30e0\u5b9a\u7fa9\n\u8868\u793a\u3055\u305b\u308b\u30d5\u30a9\u30fc\u30e0\u3092\u5b9a\u7fa9\u3059\u308b\u30af\u30e9\u30b9\u3092\u5225\u3067\u66f8\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u307e\u305a\u3001\u30d7\u30e9\u30b0\u30a4\u30f3\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4e2d\u306b\"classes\" \u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\u3002\n(\u4f8b\uff1amod/quiz/classes)\n\u6b21\u306b\u3001\u5b9a\u7fa9\u7528\u306e\u30af\u30e9\u30b9\u3092\u4f5c\u308b\u30021\u30d5\u30a9\u30fc\u30e0\u306b\u3064\u304d1\u30af\u30e9\u30b9\u4f5c\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u3053\u3053\u3067\u306f\u4f8b\u3068\u3057\u3066\u3001submission_form.php \u3092\u4f5c\u6210\u3059\u308b\u3002\n\n(\u53c2\u8003)forum\u30e2\u30b8\u30e5\u30fc\u30eb\u306epost_form.php\n\npost_form.php\n<?php\n\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * File containing the form definition to post in the forum.\n *\n * @package   mod_forum\n * @copyright Jamie Pratt <me@jamiep.org>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefined('MOODLE_INTERNAL') || die();\nrequire_once($CFG->libdir . '/formslib.php');\nrequire_once($CFG->dirroot . '/repository/lib.php');\n\n/**\n * Class to post in a forum.\n *\n * @package   mod_forum\n * @copyright Jamie Pratt <me@jamiep.org>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nclass mod_forum_post_form extends moodleform {\n\n    /**\n     * Returns the options array to use in filemanager for forum attachments\n     *\n     * @param stdClass $forum\n     * @return array\n     */\n    public static function attachment_options($forum) {\n        global $COURSE, $PAGE, $CFG;\n        $maxbytes = get_user_max_upload_file_size($PAGE->context, $CFG->maxbytes, $COURSE->maxbytes, $forum->maxbytes);\n        return array(\n            'subdirs' => 0,\n            'maxbytes' => $maxbytes,\n            'maxfiles' => $forum->maxattachments,\n            'accepted_types' => '*',\n            'return_types' => FILE_INTERNAL\n        );\n    }\n\n    /**\n     * Returns the options array to use in forum text editor\n     *\n     * @param context_module $context\n     * @param int $postid post id, use null when adding new post\n     * @return array\n     */\n    public static function editor_options(context_module $context, $postid) {\n        global $COURSE, $PAGE, $CFG;\n        // TODO: add max files and max size support\n        $maxbytes = get_user_max_upload_file_size($PAGE->context, $CFG->maxbytes, $COURSE->maxbytes);\n        return array(\n            'maxfiles' => EDITOR_UNLIMITED_FILES,\n            'maxbytes' => $maxbytes,\n            'trusttext'=> true,\n            'return_types'=> FILE_INTERNAL | FILE_EXTERNAL,\n            'subdirs' => file_area_contains_subdirs($context, 'mod_forum', 'post', $postid)\n        );\n    }\n\n    /**\n     * Form definition\n     *\n     * @return void\n     */\n    function definition() {\n        global $CFG, $OUTPUT;\n\n        $mform =& $this->_form;\n\n        $course = $this->_customdata['course'];\n        $cm = $this->_customdata['cm'];\n        $coursecontext = $this->_customdata['coursecontext'];\n        $modcontext = $this->_customdata['modcontext'];\n        $forum = $this->_customdata['forum'];\n        $post = $this->_customdata['post'];\n        $subscribe = $this->_customdata['subscribe'];\n        $edit = $this->_customdata['edit'];\n        $thresholdwarning = $this->_customdata['thresholdwarning'];\n\n        $mform->addElement('header', 'general', '');//fill in the data depending on page params later using set_data\n\n        // If there is a warning message and we are not editing a post we need to handle the warning.\n        if (!empty($thresholdwarning) && !$edit) {\n            // Here we want to display a warning if they can still post but have reached the warning threshold.\n            if ($thresholdwarning->canpost) {\n                $message = get_string($thresholdwarning->errorcode, $thresholdwarning->module, $thresholdwarning->additional);\n                $mform->addElement('html', $OUTPUT->notification($message));\n            }\n        }\n\n        $mform->addElement('text', 'subject', get_string('subject', 'forum'), 'size=\"48\"');\n        $mform->setType('subject', PARAM_TEXT);\n        $mform->addRule('subject', get_string('required'), 'required', null, 'client');\n        $mform->addRule('subject', get_string('maximumchars', '', 255), 'maxlength', 255, 'client');\n\n        $mform->addElement('editor', 'message', get_string('message', 'forum'), null, self::editor_options($modcontext, (empty($post->id) ? null : $post->id)));\n        $mform->setType('message', PARAM_RAW);\n        $mform->addRule('message', get_string('required'), 'required', null, 'client');\n\n        $manageactivities = has_capability('moodle/course:manageactivities', $coursecontext);\n\n        if (\\mod_forum\\subscriptions::is_forcesubscribed($forum)) {\n\n            $mform->addElement('static', 'subscribemessage', get_string('subscription', 'forum'), get_string('everyoneissubscribed', 'forum'));\n            $mform->addElement('hidden', 'subscribe');\n            $mform->setType('subscribe', PARAM_INT);\n            $mform->addHelpButton('subscribemessage', 'forcesubscribed', 'forum');\n\n        } else if (\\mod_forum\\subscriptions::subscription_disabled($forum) && !$manageactivities) {\n            $mform->addElement('static', 'subscribemessage', get_string('subscription', 'forum'), get_string('disallowsubscribe', 'forum'));\n            $mform->addElement('hidden', 'discussionsubscribe');\n            $mform->setType('discussionsubscribe', PARAM_INT);\n            $mform->addHelpButton('subscribemessage', 'disallowsubscription', 'forum');\n\n        } else {\n            $options = array();\n            $options[0] = get_string('discussionsubscribestop', 'forum');\n            $options[1] = get_string('discussionsubscribestart', 'forum');\n\n            $mform->addElement('select', 'discussionsubscribe', get_string('discussionsubscription', 'forum'), $options);\n            $mform->addHelpButton('discussionsubscribe', 'discussionsubscription', 'forum');\n        }\n\n        if (!empty($forum->maxattachments) && $forum->maxbytes != 1 && has_capability('mod/forum:createattachment', $modcontext))  {  //  1 = No attachments at all\n            $mform->addElement('filemanager', 'attachments', get_string('attachment', 'forum'), null, self::attachment_options($forum));\n            $mform->addHelpButton('attachments', 'attachment', 'forum');\n        }\n\n        if (empty($post->id) && $manageactivities) {\n            $mform->addElement('checkbox', 'mailnow', get_string('mailnow', 'forum'));\n        }\n\n        if (!empty($CFG->forum_enabletimedposts) && !$post->parent && has_capability('mod/forum:viewhiddentimedposts', $coursecontext)) { // hack alert\n            $mform->addElement('header', 'displayperiod', get_string('displayperiod', 'forum'));\n\n            $mform->addElement('date_selector', 'timestart', get_string('displaystart', 'forum'), array('optional'=>true));\n            $mform->addHelpButton('timestart', 'displaystart', 'forum');\n\n            $mform->addElement('date_selector', 'timeend', get_string('displayend', 'forum'), array('optional'=>true));\n            $mform->addHelpButton('timeend', 'displayend', 'forum');\n\n        } else {\n            $mform->addElement('hidden', 'timestart');\n            $mform->setType('timestart', PARAM_INT);\n            $mform->addElement('hidden', 'timeend');\n            $mform->setType('timeend', PARAM_INT);\n            $mform->setConstants(array('timestart'=> 0, 'timeend'=>0));\n        }\n\n        if ($groupmode = groups_get_activity_groupmode($cm, $course)) { // hack alert\n            $groupdata = groups_get_activity_allowed_groups($cm);\n            $groupcount = count($groupdata);\n            $groupinfo = array();\n            $modulecontext = context_module::instance($cm->id);\n\n            // Check whether the user has access to all groups in this forum from the accessallgroups cap.\n            if ($groupmode == VISIBLEGROUPS || has_capability('moodle/site:accessallgroups', $modulecontext)) {\n                // Only allow posting to all groups if the user has access to all groups.\n                $groupinfo = array('0' => get_string('allparticipants'));\n                $groupcount++;\n            }\n\n            $contextcheck = has_capability('mod/forum:movediscussions', $modulecontext) && empty($post->parent) && $groupcount > 1;\n            if ($contextcheck) {\n                foreach ($groupdata as $grouptemp) {\n                    $groupinfo[$grouptemp->id] = $grouptemp->name;\n                }\n                $mform->addElement('select','groupinfo', get_string('group'), $groupinfo);\n                $mform->setDefault('groupinfo', $post->groupid);\n                $mform->setType('groupinfo', PARAM_INT);\n            } else {\n                if (empty($post->groupid)) {\n                    $groupname = get_string('allparticipants');\n                } else {\n                    $groupname = format_string($groupdata[$post->groupid]->name);\n                }\n                $mform->addElement('static', 'groupinfo', get_string('group'), $groupname);\n            }\n        }\n        //-------------------------------------------------------------------------------\n        // buttons\n        if (isset($post->edit)) { // hack alert\n            $submit_string = get_string('savechanges');\n        } else {\n            $submit_string = get_string('posttoforum', 'forum');\n        }\n        $this->add_action_buttons(true, $submit_string);\n\n        $mform->addElement('hidden', 'course');\n        $mform->setType('course', PARAM_INT);\n\n        $mform->addElement('hidden', 'forum');\n        $mform->setType('forum', PARAM_INT);\n\n        $mform->addElement('hidden', 'discussion');\n        $mform->setType('discussion', PARAM_INT);\n\n        $mform->addElement('hidden', 'parent');\n        $mform->setType('parent', PARAM_INT);\n\n        $mform->addElement('hidden', 'userid');\n        $mform->setType('userid', PARAM_INT);\n\n        $mform->addElement('hidden', 'groupid');\n        $mform->setType('groupid', PARAM_INT);\n\n        $mform->addElement('hidden', 'edit');\n        $mform->setType('edit', PARAM_INT);\n\n        $mform->addElement('hidden', 'reply');\n        $mform->setType('reply', PARAM_INT);\n    }\n\n    /**\n     * Form validation\n     *\n     * @param array $data data from the form.\n     * @param array $files files uploaded.\n     * @return array of errors.\n     */\n    function validation($data, $files) {\n        $errors = parent::validation($data, $files);\n        if (($data['timeend']!=0) && ($data['timestart']!=0) && $data['timeend'] <= $data['timestart']) {\n            $errors['timeend'] = get_string('timestartenderror', 'forum');\n        }\n        if (empty($data['message']['text'])) {\n            $errors['message'] = get_string('erroremptymessage', 'forum');\n        }\n        if (empty($data['subject'])) {\n            $errors['subject'] = get_string('erroremptysubject', 'forum');\n        }\n        return $errors;\n    }\n}\n\n\n\n# \u30c1\u30fc\u30c8\u30b7\u30fc\u30c8\u306b\u3064\u3044\u3066\n\n\u5225\u540d\u3001\u300c\u79d8\u4f1d\u306e\u66f8\u300d\u3082\u3057\u304f\u306f\u300c\u6280\u96c6\u300d\u3067\u3059\u3002\n\u300c\uff5e\u306a\u4e8b\u3092\u3057\u305f\u3044\u300d\u3068\u3044\u3046\u6280\u3092\u307e\u3068\u3081\u3066\u3044\u307e\u3059\u3002\u30d7\u30e9\u30b0\u30a4\u30f3\u958b\u767a\u306b\u3042\u305f\u3063\u3066\u5fc5\u8981\u306a\u6280\u3092\u7d39\u4ecb\u3057\u3066\u3044\u307e\u3059\u3002\u958b\u767a\u306e\u304a\u4f9b\u306b\u3069\u3046\u305e\u3002\n\n# \u30c1\u30fc\u30c8\u30b7\u30fc\u30c8\u306e\u4f7f\u3044\u65b9\n\n\u56f0\u3063\u305f\u6642\u306b\u3053\u306e\u30da\u30fc\u30b8\u3092\u958b\u304d\u3001\u30d6\u30e9\u30a6\u30b6\u306e\u691c\u7d22\u6a5f\u80fd(<kbd>Ctrl+F</kbd> \u306a\u3069)\u3084\u7d22\u5f15\u306a\u3069\u3067\u8abf\u3079\u3066\u3044\u304d\u307e\u3059\u3002\n\n# \u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u7a2e\u985e\n- mod (\u6d3b\u52d5\u30e2\u30b8\u30e5\u30fc\u30eb)\n- block (\u30d6\u30ed\u30c3\u30af)\n- local (\u30ed\u30fc\u30ab\u30eb)\n- qtype (\u554f\u984c\u30bf\u30a4\u30d7)\n\n# \u958b\u767a\u306e\u524d\u306b\n## \u30c7\u30d0\u30c3\u30b0\u30ec\u30d9\u30eb\u3092\u4e0a\u3052\u308b\n\n\u958b\u767a\u4e2d\u306f\u753b\u9762\u306b\u30c7\u30d0\u30c3\u30b0\u7528\u306e\u30a8\u30e9\u30fc(Warning/Notice)\u3092\u51fa\u529b\u3055\u305b\u305f\u3044\u4e8b\u304c\u591a\u3044\u306e\u3067\u3001\u958b\u767a\u8005\u30e2\u30fc\u30c9\u306b\u5207\u308a\u66ff\u3048\u308b\u3002\n\n\u300c\u30b5\u30a4\u30c8\u7ba1\u7406\u300d->\u300c\u958b\u767a\u300d->\u300c\u30c7\u30d0\u30c3\u30b0\u300d\u753b\u9762\u306b\u3042\u308b\u300c\u30c7\u30d0\u30c3\u30b0\u30e1\u30c3\u30bb\u30fc\u30b8\u300d\u3092\n\u300cDEVELOPER : \u958b\u767a\u8005\u306e\u305f\u3081\u306e\u7279\u5225Moodle\u30c7\u30d0\u30c3\u30b0\u30e1\u30c3\u30bb\u30fc\u30b8\u300d\u306b\u5909\u66f4\n\n|\u8a2d\u5b9a\u540d| \u5024 |\n|:-----------|------------:|:------------:|\n| \u30c7\u30d0\u30c3\u30b0\u30e1\u30c3\u30bb\u30fc\u30b8 | DEVELOPER : \u958b\u767a\u8005\u306e\u305f\u3081\u306e\u7279\u5225Moodle\u30c7\u30d0\u30c3\u30b0\u30e1\u30c3\u30bb\u30fc\u30b8 |\n|\u30c7\u30d0\u30c3\u30af\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8868\u793a\u3059\u308b|ON|\n|\u30da\u30fc\u30b8\u60c5\u5831\u3092\u8868\u793a\u3059\u308b|ON|\n\n![2015-11-07_1131.png](https://qiita-image-store.s3.amazonaws.com/0/17284/d354ff2c-6fce-2a98-e2d1-98524c2168d6.png)\n\n\u3053\u3046\u3059\u308b\u3068\u3001\u753b\u9762\u30d8\u30c3\u30c0\u30fc\u306bcontextid\u306a\u3069\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\n# \u30c7\u30b6\u30a4\u30f3\u3092\u3059\u308b\n\n- \u3069\u3093\u306a\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u307b\u3057\u3044\u306e\u304b\n- \u5148\u751f\u306f\u3069\u3093\u306a\u3053\u3068\u3092\u3059\u308b\u306e\u304b\n- \u5b66\u751f\u306f\u3069\u3093\u306a\u3053\u3068\u3092\u3059\u308b\u306e\u304b\n- \u753b\u9762\u9077\u79fb\u306f\u3069\u3046\u3059\u308b\uff1f\n- \u3069\u3093\u306a\u30c7\u30fc\u30bf\u3092Moodle\u304b\u3089\u53d6\u308a\u305f\u3044\uff1f\n- \u3069\u3093\u306a\u30c7\u30fc\u30bf\u3092Moodle\u306b\u4fdd\u5b58\u3057\u305f\u3044\uff1f\n\n\u3092\u8003\u3048\u308b\u3002\u4f55\u304b\u7279\u5225\u306a\u30c4\u30fc\u30eb\u3092\u4f7f\u308f\u306a\u304f\u3066\u3082\u5927\u4e08\u592b\u3002\n\n# \u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u304b\u3089\u65b0\u898f\u4f5c\u6210\u3057\u305f\u3044\nGitHub\u306b\u3044\u305a\u308c\u3082\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u304c\u516c\u958b\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u4f7f\u3046\u3002\n## \u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n### \u30d6\u30ed\u30c3\u30af\ndanielneis\u3055\u3093\u304c\u516c\u958b\u3057\u3066\u3044\u308b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f7f\u3046\u3002\nhttps://github.com/danielneis/moodle-block_newblock\n### \u6d3b\u52d5\u30e2\u30b8\u30e5\u30fc\u30eb\nMoodleHQ\u304c\u516c\u958b\u3057\u3066\u3044\u308b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f7f\u3046\u3002\nhttps://github.com/moodlehq/moodle-mod_newmodule\n\n\u958b\u767a\u74b0\u5883\u304c\u65e2\u306b\u6574\u3063\u3066\u3044\u308b\u306e\u3067\u3042\u308c\u3070\u3001\n\n```sh\ncd path/to/moodle/mod/\ngit clone https://github.com/moodlehq/moodle-mod_newmodule.git\n```\n\n\u3067\u3055\u304f\u3063\u3068\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u51fa\u6765\u308b\u3002\n\n## \u30ea\u30cd\u30fc\u30e0\u3059\u308b\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u76f4\u5f8c\u306f\u3001newblock\u3082\u3057\u304f\u306fnewmodule\u3068\u3044\u3046\u540d\u524d\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\u3053\u306e\u307e\u307e\u3067\u3082\u3044\u3044\u304c\u3001\u540d\u524d\u304c\u6c7a\u307e\u3063\u3066\u3044\u308b\u5834\u5408\u306f\u3053\u3053\u3067\u5909\u66f4\u3059\u308b\u3002\n\u5f8c\u3067\u5909\u66f4\u3057\u3088\u3046\u3068\u601d\u3046\u3068\u9762\u5012(\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u518d\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5fc5\u8981)\u306a\u306e\u3067\u3001\u4eca\u306e\u3046\u3061\u306b\u8003\u3048\u3088\u3046\u3002\n\n\u8981\u70b9\u3068\u3057\u3066\u306f\n- \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u4e2d\u306e\"newmodule\" \"newblock\"\u3068\u3044\u3046\u5358\u8a9e\u3092\u4e00\u62ec\u7f6e\u63db\u3059\u308b\u3002\n- lang/en\u5185\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u5909\u66f4\u3059\u308b\u3002(block_newblock.php -> block_hoge.php)\n- block_newblock.php \u3082\u5909\u66f4\u3059\u308b\u3002(block_newblock.php -> block_hoge.php)\n- \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u540d\u3082\u5909\u66f4\u3002\n\n\u304c\u3042\u308b\u3002\u3053\u308c\u3060\u3051\u5909\u3048\u308c\u3070\u3001\u57fa\u672c\u7684\u306b\u6700\u4f4e\u9650\u306e\u7269\u306f\u52d5\u304f\u3002\n\n### \u30ea\u30cd\u30fc\u30e0\u6642\u306e\u6ce8\u610f\u70b9\n\u6ce8\u610f\u3057\u305f\u3044\u70b9\u306f\u3001\u6d3b\u52d5\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u30d6\u30ed\u30c3\u30af\u3067\u306f\u30d7\u30e9\u30b0\u30a4\u30f3\u540d\u306e\u547d\u540d\u898f\u5247\u306b\u9055\u3044\u304c\u3042\u308b\u3068\u3044\u3046\u6240\u3002\n\n|\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u7a2e\u985e|\u898f\u7d04|\u5099\u8003|\n|:--|:--|:--|\n|mod|\u30a2\u30eb\u30d5\u30a1\u30d9\u30c3\u30c8\u306e\u307f|PARAM_ALPHA|\n|block|\u30c6\u30ad\u30b9\u30c8|PARAM_TEXT|\n\n# \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u5192\u982d\u306e\"This file is part of Moodle - \"\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u524a\u9664\u3057\u305f\u3044\n\n\u3042\u306a\u305f\u304c\u4f5c\u3063\u305f\u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u4f8b\u5916\u306a\u304fGPL v3\u30e9\u30a4\u30bb\u30f3\u30b9\u306b\u306a\u308b\u3002\u3053\u306e\u4e8b\u3092\u5fd8\u308c\u306a\u3044\u3088\u3046\u306b\u3057\u3066\u6b32\u3057\u3044\u3002\n\n# \u30d6\u30ed\u30c3\u30af\u5185\u306b\u8868\u793a\u3055\u305b\u308bHTML\u306f\u3069\u3053\u306b\u66f8\u304f\u306e\uff1f\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u5165\u3063\u3066\u3044\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u76f4\u4e0b\u306b\u3042\u308bblock_newblock.php\u306b\u3042\u308b\u3002(\u30d5\u30a1\u30a4\u30eb\u540d\u306f\u30d7\u30e9\u30b0\u30a4\u30f3\u540d\u306b\u3088\u3063\u3066\u5909\u308f\u308b)\n\n\u5177\u4f53\u7684\u306b\u306f\u3001\n\n```php:block_newblock.php\n    function get_content() {\n        global $CFG, $OUTPUT;\n        if ($this->content !== null) {\n            return $this->content;\n        }\n        if (empty($this->instance)) {\n            $this->content = '';\n            return $this->content;\n        }\n        $this->content = new stdClass();\n        $this->content->items = array();\n        $this->content->icons = array();\n        $this->content->footer = '';\n        // user/index.php expect course context, so get one if page has module context.\n        $currentcontext = $this->page->context->get_course_context(false);\n        if (! empty($this->config->text)) {\n            $this->content->text = $this->config->text;\n        }\n        $this->content = '';\n        if (empty($currentcontext)) {\n            return $this->content;\n        }\n        if ($this->page->course->id == SITEID) {\n            $this->content->text .= \"site context\";\n        }\n        if (! empty($this->config->text)) {\n            $this->content->text .= $this->config->text;\n        }\n        return $this->content;\n    }\n```\n\n\u306e\n\n```php\n$this->content\n```\n\n\u306bHTML\u30bf\u30b0\u3092\u6587\u5b57\u5217\u3068\u3057\u3066\u5165\u308c\u308b\u3068\u3044\u3044\u3002\n\u4f8b\u3048\u3070\u3001\n\n```php\n$this->content->text = \"\";\n$this->content->text .= html_writer::start_div();\n$this->content->text .= \"\u8ab2\u984c\u63d0\u51fa\u8005\u306f\u4e0b\u8a18\u306e\u4eba\u3067\u3059\u3002\";\n$this->content->text .= html_writer::start_tag(\"ul\");\n$this->content->text .= html_writer::tag(\"li\", \"\u3075\u308f\u305f\u304b\u3086\u304d\");\n$this->content->text .= html_writer::tag(\"li\", \"\u307e\u304d\u306e\u305f\u304b\u3057\");\n$this->content->text .= html_writer::tag(\"li\", \"\u3084\u307e\u3060\u3053\u3046\u3058\");\n$this->content->text .= html_writer::end_tag(\"ul\");\n$this->content->text .= html_writer::end_div();\n```\n\n\u3068\u3044\u3046\u611f\u3058\u3067\u8a70\u3081\u8fbc\u3093\u3067\u3044\u304f\u3002\u3053\u306e`get_content()`\u95a2\u6570\u306f\u6700\u7d42\u7684\u306b`$this->content`\u3092\u8fd4\u308a\u5024\u3068\u3059\u308b\u3053\u3068\u3067\u52d5\u3044\u3066\u3044\u308b\u3002\n\n\n## html_writer\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u3064\u3044\u3066\n\u5404\u30e1\u30bd\u30c3\u30c9\u3067\u5fc5\u8981\u306a\u30d1\u30e9\u30e1\u30fc\u30bf\u306f\u7570\u306a\u308b\u3002\n\u3088\u304f\u4f7f\u3046\u5f15\u6570\u306e\u5909\u6570\u540d\u3068\u5185\u5bb9\u306f\u6b21\u306e\u901a\u308a\u3002\n\n| \u5909\u6570\u540d | \u578b | \u8aac\u660e | \u4f8b |\n|:-----------|------------:|:------------:|:------------:|\n| $tagname |String | \u30bf\u30b0\u540d\u3092\u6307\u5b9a\u3059\u308b | $tagname = \"h1\" |\n| $contents |String | \u30bf\u30b0\u5185\u306e\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u6307\u5b9a\u3059\u308b | $contents = \"\u53d7\u8b1b\u8005\u4e00\u89a7\" |\n| $attributes |Array | \u30bf\u30b0\u306e\u5c5e\u6027\u3092\u6307\u5b9a\u3059\u308b| $attributes = [\"class\" => \"header\", \"id\" => \"list1\"] |\n| $class | String | html_writer::div() \u306e\u3088\u3046\u306b\u3001class\u3060\u3051\u6587\u5b57\u5217\u3067\u6307\u5b9a\u3059\u308b\u30e1\u30bd\u30c3\u30c9\u304c\u3042\u308b\u3002 | $class = \"header\" |\n\n\n## \u3088\u304f\u4f7f\u3046html_writer\u306e\u30e1\u30bd\u30c3\u30c9\n### `html_writer::tag($tagname, $contents, array $attributes = null)`\n\u9589\u3058\u30bf\u30b0\u3092\u542b\u3093\u3060HTML\u30bf\u30b0\u3092\u51fa\u529b\u3059\u308b\u3002\n\n### `html_writer::start_tag($tagname, array $attributes = null)`\n\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u90fd\u5408\u4e0a\u3001\u5f8c\u3067\u9589\u3058\u30bf\u30b0\u3092\u4ed8\u3051\u305f\u3044\u5834\u5408\u306b\u306f\u3001\u6700\u521d\u306b\u3053\u308c\u3067\u958b\u59cb\u30bf\u30b0\u3060\u3051\u3092\u51fa\u529b\u3059\u308b\n\n### `html_writer::end_tag($tagname)`\n\u30eb\u30fc\u30d7\u51e6\u7406\u306e\u6700\u5f8c\u306b\u9589\u3058\u30bf\u30b0\u3092\u4ed8\u3051\u305f\u3044\u5834\u5408\u306b\u306f\u3053\u308c\u3067\u7d42\u4e86\u30bf\u30b0\u3092\u51fa\u529b\u3059\u308b\u3002\n\n\u3061\u306a\u307f\u306b\u3001`html_writer::tag`\u30e1\u30bd\u30c3\u30c9\u306e\u5b9f\u88c5\u306f\n\n```php\n    public static function tag($tagname, $contents, array $attributes = null) {\n        return self::start_tag($tagname, $attributes) . $contents . self::end_tag($tagname);\n    }\n```\n\n\u3068\u306a\u3063\u3066\u304a\u308a\u3001`start_tag`\u30e1\u30bd\u30c3\u30c9\u3068`end_tag`\u30e1\u30bd\u30c3\u30c9\u306e\u5408\u308f\u305b\u6280\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n### `html_writer::empty_tag($tagname, array $attributes = null);`\n\n`<img>`\u3084`<br>`\u30bf\u30b0\u306e\u3088\u3046\u306b\u3001\u9589\u3058\u30bf\u30b0\u304c\u5b58\u5728\u3057\u306a\u3044\u3082\u306e\u306f\n`empty_tag`\u30e1\u30bd\u30c3\u30c9\u3067\u51fa\u529b\u3059\u308b\u3002\n\n### `script($jscode, $url=null)`\n\n`<script>`\u30bf\u30b0\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u306f\u3053\u308c\u3092\u4f7f\u3046\u3002Javascript\u5185\u306e\u30b3\u30fc\u30c9\u306b`<![CDATA[`\u3092\u30e1\u30bd\u30c3\u30c9\u5185\u3067\u8ffd\u52a0\u3057\u3066\u304f\u308c\u308b\u3002\n\u5b89\u5168\u9762\u304b\u3089\u8003\u3048\u308b\u3068\u3001**\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u306e\u4f7f\u7528\u306f\u63a8\u5968\u3055\u308c\u308b\u3002**\n\u5916\u90e8JS\u3092\u8aad\u307f\u8fbc\u3080\u6642\u306b\u3082\u3053\u308c\u3092\u4f7f\u3046\u3002\n\n\u6163\u308c\u3066\u304f\u308b\u3068html_writer\u30af\u30e9\u30b9\u3092\u4f7f\u3046\u65b9\u304c\u697d\u306b\u306a\u308b\u3057\u3001\u30eb\u30fc\u30d7\u51e6\u7406\u306a\u3069\u3067\u306f\u771f\u4fa1\u3092\u767a\u63ee\u3059\u308b\u3002\n\n### \u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30e1\u30bd\u30c3\u30c9\n\u305d\u306e\u4ed6\u3001\u307e\u3060\u307e\u3060\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30e1\u30bd\u30c3\u30c9\u306f\u305f\u304f\u3055\u3093\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u662f\u975e\u4f7f\u3063\u3066\u6b32\u3057\u3044\u3002\nlib\\outputcomponents.php\n\u306b\u5168\u90e8\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u3002\n\u4f8b\u3048\u3070\u3001`<div>`\u30bf\u30b0\u306f\u3088\u304f\u4f7f\u3046\u304c\n\n```php\nhtml_writer::tag(\"div\", \"\u3042\u3044\u3046\u3048\u304a\", [\"class\" => \"hoge\"]);\n```\n\n\u3068\u3044\u3046\u611f\u3058\u306b\u66f8\u3044\u3066\u3044\u304f\u304c\u3001\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3046\u3068\n\n```php\nhtml_writer::div(\"\u3042\u3044\u3046\u3048\u304a\", \"hoge\");\n```\n\n\u3067\u7d42\u308f\u308b\u3002\u5c11\u3057\u77ed\u304f\u306a\u3063\u305f\u3002\n\u3061\u306a\u307f\u306b\u3001outputcomponents.php\u306b\u306f\n\n```php:outputcomponents.php\npublic static function div($content, $class = '', array $attributes = null) {\n```\n\n\u3068\u5ba3\u8a00\u3055\u308c\u3066\u3044\u308b\u3002\n\n# \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3044\nMoodle\u306b\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u63a5\u7d9a\u3057\u3001\u30af\u30a8\u30ea\u3092\u6253\u3061\u8fbc\u3080\u30e1\u30bd\u30c3\u30c9\u304c\u4e88\u3081\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u3002Moodle\u306fMySQL\u306e\u4ed6\u306bPostgreSQL\u3084MSSQL\u306b\u3082\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u3002Moodle\u306b\u306f\u3053\u308c\u3089\u306e\u9055\u3044\u3092\u8003\u3048\u306a\u304f\u3066\u3082\u3088\u3044\u30e1\u30bd\u30c3\u30c9\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u4f7f\u3046\u3002\n\u9593\u9055\u3063\u3066\u3082\u3001`mysqli`\u95a2\u6570\u3092\u4f7f\u3063\u3066\u306f\u3044\u3051\u306a\u3044\u3002\n\n## \u6e96\u5099\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u4e0a\u306e\u65b9\u3067\n\n```php\nglobal $DB;\n```\n\n\u3068\u5ba3\u8a00\u3059\u308b\u3002`$DB`\u306fMoodle\u3067\u65e2\u306b\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u30b0\u30ed\u30fc\u30d0\u30eb\u5909\u6570\u3067\u3042\u308b\u3002\n\n## SELECT\n\u30c7\u30fc\u30bf\u4ef6\u6570\u304c1\u4ef6\u304b\u8907\u6570\u4ef6\u304b\u3067\u3061\u3087\u3063\u3068\u30e1\u30bd\u30c3\u30c9\u304c\u9055\u3046\u306e\u3067\u6ce8\u610f\n\u5f15\u6570\u3067\u6307\u5b9a\u3059\u308b\u30c6\u30fc\u30d6\u30eb\u540d\u306f\u3001\u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u4ed8\u3051\u306a\u3044\u3002\n(\u6a19\u6e96\u3067\u306f`mdl_`\u306b\u306a\u3063\u3066\u3044\u308b)\n\n### 1\u4ef6\u3060\u3051\u306e\u5834\u5408\n\u7b2c2\u5f15\u6570\u3067\u6761\u4ef6\u3092\u914d\u5217\u3067\u6307\u5b9a\u3059\u308b\u304c\u3001AND\u6761\u4ef6\u3057\u304b\u4f7f\u3048\u306a\u3044\u3002OR\u6761\u4ef6 \u3092\u4f7f\u3046\u5834\u5408\u306f\u3001`get_record_sql()`\u3092\u4f7f\u3046\u3002\n\n```php\n$DB->get_record(\"\u30c6\u30fc\u30d6\u30eb\u540d\", array \u62bd\u51fa\u6761\u4ef6);\n```\n\n\u4f8b\n\n```php\n$DB->get_record(\"tablename\", ['id' => $cm->course]);\n```\n\n\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u3067\u8907\u6570\u4ef6\u6570\u306e\u30c7\u30fc\u30bf\u3092\u30d2\u30c3\u30c8\u3055\u305b\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u3001Notice\u3067\u8b66\u544a\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\n### \u8907\u6570\u4ef6\u306e\u5834\u5408\n\n\u7b2c2\u5f15\u6570\u3067\u6761\u4ef6\u3092\u914d\u5217\u3067\u6307\u5b9a\u3059\u308b\u304c\u3001AND\u6761\u4ef6\u3057\u304b\u4f7f\u3048\u306a\u3044\u3002OR\u6761\u4ef6 \u3092\u4f7f\u3046\u5834\u5408\u306f\u3001`get_records_sql()`\u3092\u4f7f\u3046\u3002\n\n```php\n$DB->get_records(\"\u30c6\u30fc\u30d6\u30eb\u540d\", array \u62bd\u51fa\u6761\u4ef6);\n```\n\n\u4f8b\n\n```php\n$DB->get_records(\"tablename\", ['id' => $cm->course]);\n```\n\n# \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u4e0a\u306b\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3057\u305f\u3044\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u958b\u767a\u3059\u308b\u306b\u3042\u305f\u3063\u3066\u3001\u30c7\u30fc\u30bf\u306e\u4fdd\u5b58\u304c\u5fc5\u8981\u306b\u306a\u308b\u3002\n\u305d\u3053\u3067\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u66f8\u304d\u8fbc\u307f\u3092\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u304c\u3001\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n## install.xml\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u5185\u306e\n`/db/install.xml`\n\u306b\u30c6\u30fc\u30d6\u30eb\u5b9a\u7fa9\u3092\u884c\u3046XML\u304c\u3042\u308a\u3001\u3053\u3053\u3067\u5b9a\u7fa9\u3059\u308b\u3002\n\n\u91cd\u8981\u306a\u306e\u306f `<tables>` \u8981\u7d20\u304b\u3089\u59cb\u307e\u308b\u6240\u3067\u3001\n\n```xml\n  <TABLES>\n    <TABLE NAME=\"chat\" COMMENT=\"Each of these is a chat room\">\n      <FIELDS>\n        <FIELD NAME=\"id\" TYPE=\"int\" LENGTH=\"10\" NOTNULL=\"true\" SEQUENCE=\"true\"/>\n        <FIELD NAME=\"course\" TYPE=\"int\" LENGTH=\"10\" NOTNULL=\"true\" DEFAULT=\"0\" SEQUENCE=\"false\"/>\n        <FIELD NAME=\"name\" TYPE=\"char\" LENGTH=\"255\" NOTNULL=\"true\" SEQUENCE=\"false\"/>\n        <FIELD NAME=\"intro\" TYPE=\"text\" NOTNULL=\"true\" SEQUENCE=\"false\"/>\n        <FIELD NAME=\"introformat\" TYPE=\"int\" LENGTH=\"4\" NOTNULL=\"true\" DEFAULT=\"0\" SEQUENCE=\"false\" COMMENT=\"text format of intro field\"/>\n        <FIELD NAME=\"keepdays\" TYPE=\"int\" LENGTH=\"11\" NOTNULL=\"true\" DEFAULT=\"0\" SEQUENCE=\"false\"/>\n        <FIELD NAME=\"studentlogs\" TYPE=\"int\" LENGTH=\"4\" NOTNULL=\"true\" DEFAULT=\"0\" SEQUENCE=\"false\"/>\n        <FIELD NAME=\"chattime\" TYPE=\"int\" LENGTH=\"10\" NOTNULL=\"true\" DEFAULT=\"0\" SEQUENCE=\"false\"/>\n        <FIELD NAME=\"schedule\" TYPE=\"int\" LENGTH=\"4\" NOTNULL=\"true\" DEFAULT=\"0\" SEQUENCE=\"false\"/>\n        <FIELD NAME=\"timemodified\" TYPE=\"int\" LENGTH=\"10\" NOTNULL=\"true\" DEFAULT=\"0\" SEQUENCE=\"false\"/>\n      </FIELDS>\n      <KEYS>\n        <KEY NAME=\"primary\" TYPE=\"primary\" FIELDS=\"id\"/>\n      </KEYS>\n      <INDEXES>\n        <INDEX NAME=\"course\" UNIQUE=\"false\" FIELDS=\"course\"/>\n      </INDEXES>\n    </TABLE>    \n   ```\n   \n   \u3067\u3042\u308b\u3002\u3061\u306a\u307f\u306b\u3053\u3061\u3089\u306fchat(Moodle\u6a19\u6e96\u642d\u8f09\u306e\u30d7\u30e9\u30b0\u30a4\u30f3)\u3088\u308a\u5f15\u7528\n\n### \u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\n\n```xml\n<TABLE NAME=\"chat\" COMMENT=\"Each of these is a chat room\">\n```\n\nNAME\u306b\u30c6\u30fc\u30d6\u30eb\u540d\u3001COMMENT\u306b\u30b3\u30e1\u30f3\u30c8\u3092\u5165\u308c\u308b\u3002\u30b3\u30e1\u30f3\u30c8\u3092\u5165\u308c\u306a\u3044\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u306b\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u306e\u3067\u6ce8\u610f\u3002\n\n### \u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u4f5c\u6210\n\n```xml\n   <FIELDS>\n        <FIELD NAME=\"id\" TYPE=\"int\" LENGTH=\"10\" NOTNULL=\"true\" SEQUENCE=\"true\"/>\n        <FIELD NAME=\"course\" TYPE=\"int\" LENGTH=\"10\" NOTNULL=\"true\" DEFAULT=\"0\" SEQUENCE=\"false\"/>\n   </FIELDS>\n```\n\n\u30c6\u30fc\u30d6\u30eb\u5185\u306b\u8907\u6570\u30d5\u30a3\u30fc\u30eb\u30c9\u304c\u3042\u308b(\u306f\u305a)\u306a\u306e\u3067\u3001`<FIELDS>`\u3067\u304f\u304f\u308a\u3001`<FIELD>`\u3092\u8907\u6570\u5b9a\u7fa9\u3059\u308b\u3002\n\nNAME : \u30d5\u30a3\u30fc\u30eb\u30c9\u540d(\u30ab\u30e9\u30e0\u540d)\nTYPE : \u578b(TEXT/INT...)\nLENGTH : \u30c7\u30fc\u30bf\u9577\nNOTNULL : NULL\u3092\u8a31\u53ef\u3059\u308b\u304b(true\u3067NULL\u3092\u8a31\u53ef\u3057\u306a\u3044)\nDEFAULT : \u30c7\u30fc\u30bf\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024(NOTNULL\u3092false\u306b\u3057\u305f\u72b6\u614b\u3067\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024)\n\n### \u6ce8\u610f\u70b9\n\ninstall.xml\u306f\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u306b\u3057\u304b\u547c\u3073\u51fa\u3055\u308c\u306a\u3044\u3002\u3064\u307e\u308a\u3001\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u6642\u306b\u306f\u547c\u3073\u51fa\u3055\u308c\u306a\u3044\u3002\n\u3053\u306e\u305f\u3081\u3001\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u6642\u306b\u306f\u5225\u3067\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u66f8\u304b\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3002\n\n## \u4fbf\u5229\u306a\u30d7\u30e9\u30b0\u30a4\u30f3\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3084\u518d\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u3057\u306a\u304f\u3066\u3082\u3001install.xml\u306b\u8a18\u8ff0\u3057\u305f\u30c6\u30fc\u30d6\u30eb\u69cb\u6210\u3092\u8ffd\u52a0\u3057\u305f\u308a\u524a\u9664\u3057\u305f\u308a\u51fa\u6765\u308b\u3002\n\nhttps://moodle.org/plugins/view/local_upgradedb\n\n## \u30c7\u30fc\u30bf\u30a4\u30f3\u30b5\u30fc\u30c8\n\n```php\n$inputs = new stdClass();\n$inputs->hoge = \"fuga\"; // hoge\u3068\u3044\u3046\u30ab\u30e9\u30e0\u306bfuga\u3092\u5165\u308c\u308b\n\n$DB->insert_record('quiz', $inputs);\n```\n\n## \u30c7\u30fc\u30bf\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n\n```php\n$inputs = new stdClass();\n$inputs->id = 1;\n$Inputs->title = \"hoga\";\n\n$DB->update_record('quiz', $inputs);\n```\n\n\u5fc5\u305a`$inputs->id`\u306f\u5165\u308c\u308b\u3002\n\n## SQL\u3092\u76f4\u63a5\u6253\u3061\u8fbc\u307f\u305f\u3044\n\n```php\n$DB->get_records_sql(\n\"SELECT * FROM {quiz} WHERE id = :id\"\n, ['id' => '123']);\n```\n\n\":id\"\u3068\u3059\u308b\u3068\u30d7\u30ec\u30fc\u30b9\u30db\u30eb\u30c0\u30fc\u304c\u4f7f\u3048\u308b\u3002\u7b2c\u4e8c\u5f15\u6570\u306b\u5b9f\u969b\u306e\u5024\u3092\u5165\u308c\u307e\u3059\u3002\n\u5358\u4e00\u4ef6\u6570\u306e\u5834\u5408\u306f\u3001\n\n```php\n$DB->get_record_sql()\n```\n\n\u3068\u306a\u308b\u3002\u5358\u6570\u5f62\u3068\u8907\u6570\u5f62\u3067\u8b58\u5225\u3067\u304d\u307e\u3059\u3002\n\n# \u30d7\u30e9\u30b0\u30a4\u30f3\u672c\u4f53\u306e\u60c5\u5831\u306f\u3069\u3053\u3067\u8a18\u8ff0\u3059\u308b\u306e\uff1f\n\nversion.php \u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n\u6700\u4f4e\u3067\u3082\u5fc5\u8981\u306a\u8a18\u8ff0\u306f\u3001\n\n```php\ndefined('MOODLE_INTERNAL') || die();\n\n$plugin->version   = 2015061200;        // The current plugin version (Date: YYYYMMDDXX)\n$plugin->requires  = 2014051200;        // Requires this Moodle version\n$plugin->component = 'block_minerva'; // Full name of the plugin (used for diagnostics)\n```\n\n\u3067\u3059\u3002\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3001\u52d5\u4f5c\u306b\u5fc5\u8981\u306aMoodle\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u756a\u53f7(natural name\u3067\u306f\u306a\u3044\u65b9)\u3001\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u540d\u3067\u3059\u3002\n\u30d0\u30fc\u30b8\u30e7\u30f3\u756a\u53f7\u3068natural name\u306e\u76f8\u5bfe\u306f\u3053\u3061\u3089\u3092\u53c2\u7167\u3002\nhttps://docs.moodle.org/dev/Releases\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u306b`$plugin->version`\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u756a\u53f7\u3092\u5897\u3084\u3059\u3068\u3001\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u51e6\u7406\u304c\u52d5\u304d\u307e\u3059\u3002\n\n\n#$PAGE\n\n\u4e3b\u306b\u30da\u30fc\u30b8\u5185\u306b\u304a\u3051\u308b\u30d8\u30c3\u30c0\u60c5\u5831\u8a2d\u5b9a\u306b\u4f7f\u3044\u307e\u3059\u3002\u5b9f\u969b\u306e\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u306f`$OUTPUT`\u306b\u3042\u308a\u307e\u3059\u3002\n\n## \u30da\u30fc\u30b8URL\u3092\u8a2d\u5b9a\n\nMoodle\u306e\u30d1\u30f3\u5c51\u30ea\u30b9\u30c8\u306a\u3069\u3067\u4f7f\u7528\u3057\u307e\u3059\u3002(\u4efb\u610f)\n\n```php\n$PAGE->set_url('/mod/quiz/view.php', ['id' => $cm->id]);\n```\n\n## \u30da\u30fc\u30b8\u30bf\u30a4\u30c8\u30eb(\u4efb\u610f)\n\nHTML\u3067\u8a00\u3046\u3068\u3053\u308d\u306e`<title></title>`\u306e\u8a2d\u5b9a\n\n```\bphp\n$PAGE->set_title(format_string($quiz->name));\n```\n\n## context\u60c5\u5831\u3092\u8a2d\u5b9a(\u5fc5\u9808)\n\n\u30da\u30fc\u30b8\u306bcontext\u60c5\u5831\u3092\u30bb\u30c3\u30c8\u3059\u308b\n\n```php\n$PAGE->set_context($context);\n```\n\n## Moodle\u4e0a\u3067jQuery\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\n\n\u3053\u308c\u3067jQuery\u3092\u30ed\u30fc\u30c9\u3067\u304d\u307e\u3059\u3002\n\n```php\n$PAGE->requires->jquery();\n```\n\n## \u5916\u90e8js\u3092\u8aad\u307f\u8fbc\u307e\u305b\u305f\u3044\n\n\u4f55\u56de\u3067\u3082\u4f7f\u3048\u307e\u3059\u3002\n\n```php\n$PAGE->requires->js('../js/hoge.js');\n```\n\n## \u5916\u90e8css\u3092\u8aad\u307f\u8fbc\u307e\u305b\u305f\u3044\n\n\u4f55\u56de\u3067\u3082\u4f7f\u3048\u307e\u3059\u3002\n\n```php\n$PAGE->requires->css('../css/hoge.css');\n```\n\n# `$OUTPUT`\n\n`$OUTPUT`\u306f\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u5468\u308a\u3067\u4f7f\u3044\u307e\u3059\u3002HTML\u304c\u623b\u3055\u308c\u308b\u306e\u3067\u3001`echo`\u3067\u6253\u3061\u51fa\u3059\u3002\n\n## \u30d8\u30c3\u30c0\u51fa\u529b\n\n```\necho $OUTPUT->header();\n```\n\n## \u30d5\u30c3\u30bf\u30fc\u51fa\u529b\n\n```php\necho $OUTPUT->footer();\n```\n\n# \u30d5\u30a9\u30fc\u30e0\u3092\u4f5c\u308a\u305f\u3044\n\n\u666e\u901a\u306eHTML/PHP\u3067\u5165\u529b\u30d5\u30a9\u30fc\u30e0\u3092\u4f5c\u308d\u3046\u3068\u3059\u308b\u3068\u3001\n\n```html\n<form>\n<input type=\"text\" name=\"hoge\" />\n</form>\n```\n\n\u3068\u306a\u308a\u307e\u3059\u304c\u3001Moodle\u306b\u306f\u30d5\u30a9\u30fc\u30e0\u4f5c\u6210\u7528\u306e\u30af\u30e9\u30b9\u30fb\u30e1\u30bd\u30c3\u30c9\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\n## \u30d5\u30a9\u30fc\u30e0\u5b9a\u7fa9\n\u8868\u793a\u3055\u305b\u308b\u30d5\u30a9\u30fc\u30e0\u3092\u5b9a\u7fa9\u3059\u308b\u30af\u30e9\u30b9\u3092\u5225\u3067\u66f8\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u307e\u305a\u3001\u30d7\u30e9\u30b0\u30a4\u30f3\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4e2d\u306b\"classes\" \u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\u3002\n(\u4f8b\uff1amod/quiz/classes)\n\n\u6b21\u306b\u3001\u5b9a\u7fa9\u7528\u306e\u30af\u30e9\u30b9\u3092\u4f5c\u308b\u30021\u30d5\u30a9\u30fc\u30e0\u306b\u3064\u304d1\u30af\u30e9\u30b9\u4f5c\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u3053\u3053\u3067\u306f\u4f8b\u3068\u3057\u3066\u3001submission_form.php \u3092\u4f5c\u6210\u3059\u308b\u3002\n\n\n## (\u53c2\u8003)forum\u30e2\u30b8\u30e5\u30fc\u30eb\u306epost_form.php\n\n```php:post_form.php\n<?php\n\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * File containing the form definition to post in the forum.\n *\n * @package   mod_forum\n * @copyright Jamie Pratt <me@jamiep.org>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefined('MOODLE_INTERNAL') || die();\nrequire_once($CFG->libdir . '/formslib.php');\nrequire_once($CFG->dirroot . '/repository/lib.php');\n\n/**\n * Class to post in a forum.\n *\n * @package   mod_forum\n * @copyright Jamie Pratt <me@jamiep.org>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nclass mod_forum_post_form extends moodleform {\n\n    /**\n     * Returns the options array to use in filemanager for forum attachments\n     *\n     * @param stdClass $forum\n     * @return array\n     */\n    public static function attachment_options($forum) {\n        global $COURSE, $PAGE, $CFG;\n        $maxbytes = get_user_max_upload_file_size($PAGE->context, $CFG->maxbytes, $COURSE->maxbytes, $forum->maxbytes);\n        return array(\n            'subdirs' => 0,\n            'maxbytes' => $maxbytes,\n            'maxfiles' => $forum->maxattachments,\n            'accepted_types' => '*',\n            'return_types' => FILE_INTERNAL\n        );\n    }\n\n    /**\n     * Returns the options array to use in forum text editor\n     *\n     * @param context_module $context\n     * @param int $postid post id, use null when adding new post\n     * @return array\n     */\n    public static function editor_options(context_module $context, $postid) {\n        global $COURSE, $PAGE, $CFG;\n        // TODO: add max files and max size support\n        $maxbytes = get_user_max_upload_file_size($PAGE->context, $CFG->maxbytes, $COURSE->maxbytes);\n        return array(\n            'maxfiles' => EDITOR_UNLIMITED_FILES,\n            'maxbytes' => $maxbytes,\n            'trusttext'=> true,\n            'return_types'=> FILE_INTERNAL | FILE_EXTERNAL,\n            'subdirs' => file_area_contains_subdirs($context, 'mod_forum', 'post', $postid)\n        );\n    }\n\n    /**\n     * Form definition\n     *\n     * @return void\n     */\n    function definition() {\n        global $CFG, $OUTPUT;\n\n        $mform =& $this->_form;\n\n        $course = $this->_customdata['course'];\n        $cm = $this->_customdata['cm'];\n        $coursecontext = $this->_customdata['coursecontext'];\n        $modcontext = $this->_customdata['modcontext'];\n        $forum = $this->_customdata['forum'];\n        $post = $this->_customdata['post'];\n        $subscribe = $this->_customdata['subscribe'];\n        $edit = $this->_customdata['edit'];\n        $thresholdwarning = $this->_customdata['thresholdwarning'];\n\n        $mform->addElement('header', 'general', '');//fill in the data depending on page params later using set_data\n\n        // If there is a warning message and we are not editing a post we need to handle the warning.\n        if (!empty($thresholdwarning) && !$edit) {\n            // Here we want to display a warning if they can still post but have reached the warning threshold.\n            if ($thresholdwarning->canpost) {\n                $message = get_string($thresholdwarning->errorcode, $thresholdwarning->module, $thresholdwarning->additional);\n                $mform->addElement('html', $OUTPUT->notification($message));\n            }\n        }\n\n        $mform->addElement('text', 'subject', get_string('subject', 'forum'), 'size=\"48\"');\n        $mform->setType('subject', PARAM_TEXT);\n        $mform->addRule('subject', get_string('required'), 'required', null, 'client');\n        $mform->addRule('subject', get_string('maximumchars', '', 255), 'maxlength', 255, 'client');\n\n        $mform->addElement('editor', 'message', get_string('message', 'forum'), null, self::editor_options($modcontext, (empty($post->id) ? null : $post->id)));\n        $mform->setType('message', PARAM_RAW);\n        $mform->addRule('message', get_string('required'), 'required', null, 'client');\n\n        $manageactivities = has_capability('moodle/course:manageactivities', $coursecontext);\n\n        if (\\mod_forum\\subscriptions::is_forcesubscribed($forum)) {\n\n            $mform->addElement('static', 'subscribemessage', get_string('subscription', 'forum'), get_string('everyoneissubscribed', 'forum'));\n            $mform->addElement('hidden', 'subscribe');\n            $mform->setType('subscribe', PARAM_INT);\n            $mform->addHelpButton('subscribemessage', 'forcesubscribed', 'forum');\n\n        } else if (\\mod_forum\\subscriptions::subscription_disabled($forum) && !$manageactivities) {\n            $mform->addElement('static', 'subscribemessage', get_string('subscription', 'forum'), get_string('disallowsubscribe', 'forum'));\n            $mform->addElement('hidden', 'discussionsubscribe');\n            $mform->setType('discussionsubscribe', PARAM_INT);\n            $mform->addHelpButton('subscribemessage', 'disallowsubscription', 'forum');\n\n        } else {\n            $options = array();\n            $options[0] = get_string('discussionsubscribestop', 'forum');\n            $options[1] = get_string('discussionsubscribestart', 'forum');\n\n            $mform->addElement('select', 'discussionsubscribe', get_string('discussionsubscription', 'forum'), $options);\n            $mform->addHelpButton('discussionsubscribe', 'discussionsubscription', 'forum');\n        }\n\n        if (!empty($forum->maxattachments) && $forum->maxbytes != 1 && has_capability('mod/forum:createattachment', $modcontext))  {  //  1 = No attachments at all\n            $mform->addElement('filemanager', 'attachments', get_string('attachment', 'forum'), null, self::attachment_options($forum));\n            $mform->addHelpButton('attachments', 'attachment', 'forum');\n        }\n\n        if (empty($post->id) && $manageactivities) {\n            $mform->addElement('checkbox', 'mailnow', get_string('mailnow', 'forum'));\n        }\n\n        if (!empty($CFG->forum_enabletimedposts) && !$post->parent && has_capability('mod/forum:viewhiddentimedposts', $coursecontext)) { // hack alert\n            $mform->addElement('header', 'displayperiod', get_string('displayperiod', 'forum'));\n\n            $mform->addElement('date_selector', 'timestart', get_string('displaystart', 'forum'), array('optional'=>true));\n            $mform->addHelpButton('timestart', 'displaystart', 'forum');\n\n            $mform->addElement('date_selector', 'timeend', get_string('displayend', 'forum'), array('optional'=>true));\n            $mform->addHelpButton('timeend', 'displayend', 'forum');\n\n        } else {\n            $mform->addElement('hidden', 'timestart');\n            $mform->setType('timestart', PARAM_INT);\n            $mform->addElement('hidden', 'timeend');\n            $mform->setType('timeend', PARAM_INT);\n            $mform->setConstants(array('timestart'=> 0, 'timeend'=>0));\n        }\n\n        if ($groupmode = groups_get_activity_groupmode($cm, $course)) { // hack alert\n            $groupdata = groups_get_activity_allowed_groups($cm);\n            $groupcount = count($groupdata);\n            $groupinfo = array();\n            $modulecontext = context_module::instance($cm->id);\n\n            // Check whether the user has access to all groups in this forum from the accessallgroups cap.\n            if ($groupmode == VISIBLEGROUPS || has_capability('moodle/site:accessallgroups', $modulecontext)) {\n                // Only allow posting to all groups if the user has access to all groups.\n                $groupinfo = array('0' => get_string('allparticipants'));\n                $groupcount++;\n            }\n\n            $contextcheck = has_capability('mod/forum:movediscussions', $modulecontext) && empty($post->parent) && $groupcount > 1;\n            if ($contextcheck) {\n                foreach ($groupdata as $grouptemp) {\n                    $groupinfo[$grouptemp->id] = $grouptemp->name;\n                }\n                $mform->addElement('select','groupinfo', get_string('group'), $groupinfo);\n                $mform->setDefault('groupinfo', $post->groupid);\n                $mform->setType('groupinfo', PARAM_INT);\n            } else {\n                if (empty($post->groupid)) {\n                    $groupname = get_string('allparticipants');\n                } else {\n                    $groupname = format_string($groupdata[$post->groupid]->name);\n                }\n                $mform->addElement('static', 'groupinfo', get_string('group'), $groupname);\n            }\n        }\n        //-------------------------------------------------------------------------------\n        // buttons\n        if (isset($post->edit)) { // hack alert\n            $submit_string = get_string('savechanges');\n        } else {\n            $submit_string = get_string('posttoforum', 'forum');\n        }\n        $this->add_action_buttons(true, $submit_string);\n\n        $mform->addElement('hidden', 'course');\n        $mform->setType('course', PARAM_INT);\n\n        $mform->addElement('hidden', 'forum');\n        $mform->setType('forum', PARAM_INT);\n\n        $mform->addElement('hidden', 'discussion');\n        $mform->setType('discussion', PARAM_INT);\n\n        $mform->addElement('hidden', 'parent');\n        $mform->setType('parent', PARAM_INT);\n\n        $mform->addElement('hidden', 'userid');\n        $mform->setType('userid', PARAM_INT);\n\n        $mform->addElement('hidden', 'groupid');\n        $mform->setType('groupid', PARAM_INT);\n\n        $mform->addElement('hidden', 'edit');\n        $mform->setType('edit', PARAM_INT);\n\n        $mform->addElement('hidden', 'reply');\n        $mform->setType('reply', PARAM_INT);\n    }\n\n    /**\n     * Form validation\n     *\n     * @param array $data data from the form.\n     * @param array $files files uploaded.\n     * @return array of errors.\n     */\n    function validation($data, $files) {\n        $errors = parent::validation($data, $files);\n        if (($data['timeend']!=0) && ($data['timestart']!=0) && $data['timeend'] <= $data['timestart']) {\n            $errors['timeend'] = get_string('timestartenderror', 'forum');\n        }\n        if (empty($data['message']['text'])) {\n            $errors['message'] = get_string('erroremptymessage', 'forum');\n        }\n        if (empty($data['subject'])) {\n            $errors['subject'] = get_string('erroremptysubject', 'forum');\n        }\n        return $errors;\n    }\n}\n```\n", "tags": ["Moodle", "PHP"]}