{"context": " More than 1 year has passed since last update.WPF\u3067\u306e\u5370\u5237\u3067\u306fUIElement\u306e\u6d3e\u751f\u30af\u30e9\u30b9\u3092\u3082\u3061\u3044\u3066\u884c\u3046\u306e\u304c\u57fa\u672c(?)\u3067\u3059\u304c\u3001DrawingContext\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u5f93\u6765\u306eGDI\u3092\u5229\u7528\u3057\u305f\u63cf\u753b\u30e9\u30a4\u30af\u306a\u624b\u6cd5\u3067\u5370\u5237\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\nDrawingContext \u3092\u7528\u3044\u305f\u5370\u5237\u306e\u30b5\u30f3\u30d7\u30eb\n\u524d\u56de\u3068\u307b\u307c\u540c\u69d8\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u5370\u5237\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u3002\n// FormattedText \u306e\u751f\u6210\nprivate FormattedText CreateFormatedText(string s, double width, TextAlignment align)\n{\n    FormattedText fmtText = new FormattedText(\n        s,\n        System.Globalization.CultureInfo.CurrentCulture,\n        System.Windows.FlowDirection.LeftToRight,\n        new Typeface(\"\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af\"),\n        24.0d,Brushes.Black);\n    fmtText.MaxTextWidth = width;\n    fmtText.TextAlignment = align;\n    return fmtText;\n}\n\n// \u30da\u30fc\u30b8\u306e\u63cf\u753b\nprivate void DrawPage(DrawingContext dc)\n{\n    // Line\u306e\u63cf\u753b\n    for (int i = 0; i < 10; i++)\n    {\n        Pen pen = new Pen(Brushes.Black, 1.0d + (i * 0.5d));\n        dc.DrawLine(pen, new Point(100.0d, 100.0d + (i * 10.0d)), \n                         new Point(200.0d, 100.0d + (i * 10.0d)));\n    }\n\n    // \u77e9\u5f62\u306e\u63cf\u753b\n    dc.DrawRectangle(Brushes.Blue, new Pen(Brushes.Black, 1.0d), \n                                   new Rect(250.0d, 100.0d, 100.0d, 100.0d));\n\n    // \u5186\u306e\u63cf\u753b\n    dc.DrawEllipse(Brushes.Green, new Pen(Brushes.Black, 1.0d), \n                                  new Point(450.0d, 150.0d), 50.0d, 50.0d);\n\n    // \u30b8\u30aa\u30e1\u30c8\u30ea\u306e\u63cf\u753b\n    StreamGeometry sg1 = new StreamGeometry();\n    using (StreamGeometryContext ctx = sg1.Open())\n    {\n        ctx.BeginFigure(new Point(600.0d, 100.0d), true, true);\n        ctx.LineTo(new Point(650.0d, 180.0d), true, true);\n        ctx.LineTo(new Point(550.0d, 180.0d), true, true);\n    }\n    sg1.Freeze();\n    dc.DrawGeometry(Brushes.Red, new Pen(Brushes.Black, 2.0d), sg1);\n\n    StreamGeometry sg2 = new StreamGeometry();\n    using (StreamGeometryContext ctx = sg2.Open())\n    {\n        ctx.BeginFigure(new Point(550.0d, 120.0d), true, true);\n        ctx.LineTo(new Point(650.0d, 120.0d), true, true);\n        ctx.LineTo(new Point(600.0d, 200.0d), true, true);\n    }\n    sg2.Freeze();\n    dc.DrawGeometry(Brushes.Yellow, new Pen(Brushes.Black, 2.0d), sg2);\n\n    // \u30a4\u30e1\u30fc\u30b8\u306e\u63cf\u753b\n    Uri imageUri = new Uri(\"file://c:/temp/CAT.JPG\");\n    dc.DrawImage(new BitmapImage(imageUri), new Rect(100.0d, 250.0d, 100.0d, 100.0d));\n\n    // \u30c6\u30ad\u30b9\u30c8\u306e\u63cf\u753b\n    dc.DrawRectangle(null, new Pen(Brushes.Black, 1.0d), new Rect(99.0d, 399.0d, 502.0d, 102.0d));\n\n    FormattedText fmtTextL = CreateFormatedText(\"\u5de6\u5bc4\u305b\u6587\u5b57\u5217\", 500.0d, TextAlignment.Left);\n    dc.DrawText(fmtTextL, new Point(100.0d, 400.0d + (30.0d - fmtTextL.Height) / 2.0d));\n\n    FormattedText fmtTextC = CreateFormatedText(\"\u4e2d\u592e\u5bc4\u305b\u6587\u5b57\u5217\", 500.0d, TextAlignment.Center);\n    dc.DrawText(fmtTextC, new Point(100.0d, 430.0d + (30.0d - fmtTextC.Height) / 2.0d));\n\n    FormattedText fmtTextR = CreateFormatedText(\"\u53f3\u5bc4\u305b\u6587\u5b57\u5217\", 500.0d, TextAlignment.Right);\n    dc.DrawText(fmtTextR, new Point(100.0d, 460.0d + (30.0d - fmtTextR.Height) / 2.0d));\n}\n\n// \u5370\u5237\u51e6\u7406\nprivate void PrintPage()\n{\n    // \u5404\u7a2e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u751f\u6210\u3068\u53d6\u5f97\n    LocalPrintServer lps = new LocalPrintServer();\n    PrintQueue queue = lps.DefaultPrintQueue;\n    XpsDocumentWriter writer = PrintQueue.CreateXpsDocumentWriter(queue);\n\n    // \u7528\u7d19\u30b5\u30a4\u30ba\u306e\u8a2d\u5b9a\n    PrintTicket ticket = queue.DefaultPrintTicket;\n    ticket.PageMediaSize = new PageMediaSize(PageMediaSizeName.ISOA4);\n    ticket.PageOrientation = PageOrientation.Portrait;\n\n    // VisualsToXpsDocument\u306e\u751f\u6210\n    VisualsToXpsDocument v2xps = writer.CreateVisualsCollator() as VisualsToXpsDocument;\n    v2xps.BeginBatchWrite();\n    try\n    {\n        ContainerVisual container = new ContainerVisual();\n        DrawingVisual dv = new DrawingVisual();\n        using (DrawingContext dc = dv.RenderOpen())\n        {\n            DrawPage(dc);\n        }\n        container.Children.Add(dv);\n        v2xps.Write(container, ticket);\n    }\n    finally\n    {\n        v2xps.EndBatchWrite();\n    }\n}\n\n\u5370\u5237\u51e6\u7406\u306f\u3001VisualsToXpsDocument.BeginBatchWrite()\u304b\u3089\u3001VisualsToXpsDocument.EndBatchWrite()\u306e\u9593\u3067\u884c\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u5370\u5237\u306f\u30da\u30fc\u30b8\u5358\u4f4d\u3067\u3001VisualsToXpsDocument.Write()\u3092\u547c\u3073\u51fa\u3059\u305f\u3073\u306b\u6539\u30da\u30fc\u30b8\u304c\u767a\u751f\u3057\u307e\u3059\u3002\nWPF\u3067\u306e\u5370\u5237\u3067\u306f`UIElement`\u306e\u6d3e\u751f\u30af\u30e9\u30b9\u3092\u3082\u3061\u3044\u3066\u884c\u3046\u306e\u304c\u57fa\u672c(?)\u3067\u3059\u304c\u3001`DrawingContext`\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u5f93\u6765\u306eGDI\u3092\u5229\u7528\u3057\u305f\u63cf\u753b\u30e9\u30a4\u30af\u306a\u624b\u6cd5\u3067\u5370\u5237\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n## DrawingContext \u3092\u7528\u3044\u305f\u5370\u5237\u306e\u30b5\u30f3\u30d7\u30eb\n\n[\u524d\u56de](http://qiita.com/hugo-sb/items/a713c2c230a4ade2c13c)\u3068\u307b\u307c\u540c\u69d8\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u5370\u5237\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u3002\n\n```csharp\n// FormattedText \u306e\u751f\u6210\nprivate FormattedText CreateFormatedText(string s, double width, TextAlignment align)\n{\n    FormattedText fmtText = new FormattedText(\n        s,\n        System.Globalization.CultureInfo.CurrentCulture,\n        System.Windows.FlowDirection.LeftToRight,\n        new Typeface(\"\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af\"),\n        24.0d,Brushes.Black);\n    fmtText.MaxTextWidth = width;\n    fmtText.TextAlignment = align;\n    return fmtText;\n}\n\n// \u30da\u30fc\u30b8\u306e\u63cf\u753b\nprivate void DrawPage(DrawingContext dc)\n{\n    // Line\u306e\u63cf\u753b\n    for (int i = 0; i < 10; i++)\n    {\n        Pen pen = new Pen(Brushes.Black, 1.0d + (i * 0.5d));\n        dc.DrawLine(pen, new Point(100.0d, 100.0d + (i * 10.0d)), \n                         new Point(200.0d, 100.0d + (i * 10.0d)));\n    }\n\n    // \u77e9\u5f62\u306e\u63cf\u753b\n    dc.DrawRectangle(Brushes.Blue, new Pen(Brushes.Black, 1.0d), \n                                   new Rect(250.0d, 100.0d, 100.0d, 100.0d));\n\n    // \u5186\u306e\u63cf\u753b\n    dc.DrawEllipse(Brushes.Green, new Pen(Brushes.Black, 1.0d), \n                                  new Point(450.0d, 150.0d), 50.0d, 50.0d);\n\n    // \u30b8\u30aa\u30e1\u30c8\u30ea\u306e\u63cf\u753b\n    StreamGeometry sg1 = new StreamGeometry();\n    using (StreamGeometryContext ctx = sg1.Open())\n    {\n        ctx.BeginFigure(new Point(600.0d, 100.0d), true, true);\n        ctx.LineTo(new Point(650.0d, 180.0d), true, true);\n        ctx.LineTo(new Point(550.0d, 180.0d), true, true);\n    }\n    sg1.Freeze();\n    dc.DrawGeometry(Brushes.Red, new Pen(Brushes.Black, 2.0d), sg1);\n\n    StreamGeometry sg2 = new StreamGeometry();\n    using (StreamGeometryContext ctx = sg2.Open())\n    {\n        ctx.BeginFigure(new Point(550.0d, 120.0d), true, true);\n        ctx.LineTo(new Point(650.0d, 120.0d), true, true);\n        ctx.LineTo(new Point(600.0d, 200.0d), true, true);\n    }\n    sg2.Freeze();\n    dc.DrawGeometry(Brushes.Yellow, new Pen(Brushes.Black, 2.0d), sg2);\n\n    // \u30a4\u30e1\u30fc\u30b8\u306e\u63cf\u753b\n    Uri imageUri = new Uri(\"file://c:/temp/CAT.JPG\");\n    dc.DrawImage(new BitmapImage(imageUri), new Rect(100.0d, 250.0d, 100.0d, 100.0d));\n\n    // \u30c6\u30ad\u30b9\u30c8\u306e\u63cf\u753b\n    dc.DrawRectangle(null, new Pen(Brushes.Black, 1.0d), new Rect(99.0d, 399.0d, 502.0d, 102.0d));\n\n    FormattedText fmtTextL = CreateFormatedText(\"\u5de6\u5bc4\u305b\u6587\u5b57\u5217\", 500.0d, TextAlignment.Left);\n    dc.DrawText(fmtTextL, new Point(100.0d, 400.0d + (30.0d - fmtTextL.Height) / 2.0d));\n\n    FormattedText fmtTextC = CreateFormatedText(\"\u4e2d\u592e\u5bc4\u305b\u6587\u5b57\u5217\", 500.0d, TextAlignment.Center);\n    dc.DrawText(fmtTextC, new Point(100.0d, 430.0d + (30.0d - fmtTextC.Height) / 2.0d));\n\n    FormattedText fmtTextR = CreateFormatedText(\"\u53f3\u5bc4\u305b\u6587\u5b57\u5217\", 500.0d, TextAlignment.Right);\n    dc.DrawText(fmtTextR, new Point(100.0d, 460.0d + (30.0d - fmtTextR.Height) / 2.0d));\n}\n\n// \u5370\u5237\u51e6\u7406\nprivate void PrintPage()\n{\n    // \u5404\u7a2e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u751f\u6210\u3068\u53d6\u5f97\n    LocalPrintServer lps = new LocalPrintServer();\n    PrintQueue queue = lps.DefaultPrintQueue;\n    XpsDocumentWriter writer = PrintQueue.CreateXpsDocumentWriter(queue);\n\n    // \u7528\u7d19\u30b5\u30a4\u30ba\u306e\u8a2d\u5b9a\n    PrintTicket ticket = queue.DefaultPrintTicket;\n    ticket.PageMediaSize = new PageMediaSize(PageMediaSizeName.ISOA4);\n    ticket.PageOrientation = PageOrientation.Portrait;\n\n    // VisualsToXpsDocument\u306e\u751f\u6210\n    VisualsToXpsDocument v2xps = writer.CreateVisualsCollator() as VisualsToXpsDocument;\n    v2xps.BeginBatchWrite();\n    try\n    {\n        ContainerVisual container = new ContainerVisual();\n        DrawingVisual dv = new DrawingVisual();\n        using (DrawingContext dc = dv.RenderOpen())\n        {\n            DrawPage(dc);\n        }\n        container.Children.Add(dv);\n        v2xps.Write(container, ticket);\n    }\n    finally\n    {\n        v2xps.EndBatchWrite();\n    }\n}\n```\n\n\u5370\u5237\u51e6\u7406\u306f\u3001`VisualsToXpsDocument.BeginBatchWrite()`\u304b\u3089\u3001`VisualsToXpsDocument.EndBatchWrite()`\u306e\u9593\u3067\u884c\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u5370\u5237\u306f\u30da\u30fc\u30b8\u5358\u4f4d\u3067\u3001`VisualsToXpsDocument.Write()`\u3092\u547c\u3073\u51fa\u3059\u305f\u3073\u306b\u6539\u30da\u30fc\u30b8\u304c\u767a\u751f\u3057\u307e\u3059\u3002\n", "tags": ["C#", "WPF", "\u57fa\u790e"]}