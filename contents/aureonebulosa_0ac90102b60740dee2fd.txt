{"tags": ["MongoDB", "bottle"], "context": " More than 1 year has passed since last update.mongoDB\u306bcanvas\u306e\u63cf\u753b\u3092\u753b\u50cf\u30c7\u30fc\u30bf\u3068\u3057\u3066\u4fdd\u5b58\u3057\u3066\u307f\u308b\u3002\ntoDataURL()\u3092\u4f7f\u3046\u3002\n\napp.py\n\nfrom bottle import run, get, post, request, redirect\nfrom bottle import TEMPLATE_PATH, jinja2_template as template\nimport bottle\nimport pymongo\n\n\napp = bottle.app()\nTEMPLATE_PATH.append(\"./templates\")\n\n@app.route('/')\ndef index():\n    return template(\"index.html\")\n\n@app.route('/post', method=['POST'])\ndef getimg():\n    img = request.forms.get('img');\n    name = request.forms.get('name');\n\n    conn=pymongo.Connection()\n    db=conn.mydb\n    db.imgcol\n    db.imgcol.save({\"name\":name,\"img\":img})\n\n    return redirect('/imgview')\n\n@app.route('/imgview',method=['GET'])\ndef img():\n\n    conn=pymongo.Connection()\n    db=conn.mydb\n    db.imgcol\n    result = db.imgcol.find()\n\n    return template(\"imgview.html\", result=result)\n\n\nif __name__=='__main__':\n    app.run(host='localhost', port=8080, reloader=True)\n\n\n\n\ncanvas\u3067\u56db\u89d2\u3092\u63cf\u753b\u3059\u308b\u306e\u3068\u540d\u524d\u306e\u5165\u529b\u90e8\u5206\u3002\n\nindex.html\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Document</title>\n\n    <script src=\"app.js\"></script>\n\n<script>\nfunction draw() {\nvar canvas = document.getElementById('canvas');\nvar ctx = canvas.getContext('2d');\nctx.fillStyle = \"rgb(200, 100, 0)\";\nctx.fillRect(20, 30, 60, 40);\n};\n\n\nfunction myToDataUrl(){\nvar canvas = document.getElementById('canvas');\nvar img_png_src = canvas.toDataURL();\nvar myname = document.getElementById('myname').value;\ngotoNext('/post','img',img_png_src,'name',myname);\n};\n\n\nfunction gotoNext(action,name,value,name2,value2){\n\n    var form = document.createElement(\"form\");\n    form.setAttribute(\"action\", action);\n    form.setAttribute(\"method\", \"post\");\n    form.style.display = \"none\";\n    document.body.appendChild(form);\n\n    var input = document.createElement('input');\n    input.setAttribute('type', 'hidden');\n    input.setAttribute('name', name);\n    input.setAttribute('value', value);\n    form.appendChild(input);\n\n    var input2 = document.createElement('input');\n    input2.setAttribute('type', 'hidden');\n    input2.setAttribute('name', name2);\n    input2.setAttribute('value', value2);\n    form.appendChild(input2);\n\n    form.submit();\n};\n\n</script>\n\n</head>\n<body onload=\"draw();\">\n\n<canvas id=\"canvas\" width=\"150\" height=\"150\"></canvas>\n<br>\n<p>name: <input id=\"myname\" type=\"text\" name=\"name\" size=\"50\"></p>\n<button  onClick=\"myToDataUrl();\">PUSH</button>\n\n</body>\n</html>\n\n\n\n\u753b\u50cf\u3068\u540d\u524d\u3092\u30ea\u30b9\u30c8\u8868\u793a\u3059\u308b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n\nimgview.html\n\n<ul>\n{% for item in result %}\n<li><img src={{item.img}} alt=\"\">{{item.name}}</li>\n{% endfor %}\n</ul>\n\n\n\nmongoDB\u306bcanvas\u306e\u63cf\u753b\u3092\u753b\u50cf\u30c7\u30fc\u30bf\u3068\u3057\u3066\u4fdd\u5b58\u3057\u3066\u307f\u308b\u3002\n``toDataURL()``\u3092\u4f7f\u3046\u3002\n\n\n```py:app.py\n\nfrom bottle import run, get, post, request, redirect\nfrom bottle import TEMPLATE_PATH, jinja2_template as template\nimport bottle\nimport pymongo\n\n\napp = bottle.app()\nTEMPLATE_PATH.append(\"./templates\")\n\n@app.route('/')\ndef index():\n\treturn template(\"index.html\")\n\n@app.route('/post', method=['POST'])\ndef getimg():\n\timg = request.forms.get('img');\n\tname = request.forms.get('name');\n\n\tconn=pymongo.Connection()\n\tdb=conn.mydb\n\tdb.imgcol\n\tdb.imgcol.save({\"name\":name,\"img\":img})\n\n\treturn redirect('/imgview')\n\n@app.route('/imgview',method=['GET'])\ndef img():\n\n\tconn=pymongo.Connection()\n\tdb=conn.mydb\n\tdb.imgcol\n\tresult = db.imgcol.find()\n\n\treturn template(\"imgview.html\", result=result)\n\n\nif __name__=='__main__':\n    app.run(host='localhost', port=8080, reloader=True)\n\n\n```\n\ncanvas\u3067\u56db\u89d2\u3092\u63cf\u753b\u3059\u308b\u306e\u3068\u540d\u524d\u306e\u5165\u529b\u90e8\u5206\u3002\n\n```html:index.html\n\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n\t<meta charset=\"UTF-8\">\n\t<title>Document</title>\n\n\t<script src=\"app.js\"></script>\n\n<script>\nfunction draw() {\nvar canvas = document.getElementById('canvas');\nvar ctx = canvas.getContext('2d');\nctx.fillStyle = \"rgb(200, 100, 0)\";\nctx.fillRect(20, 30, 60, 40);\n};\n\n\nfunction myToDataUrl(){\nvar canvas = document.getElementById('canvas');\nvar img_png_src = canvas.toDataURL();\nvar myname = document.getElementById('myname').value;\ngotoNext('/post','img',img_png_src,'name',myname);\n};\n\n\nfunction gotoNext(action,name,value,name2,value2){\n\t\n    var form = document.createElement(\"form\");\n    form.setAttribute(\"action\", action);\n    form.setAttribute(\"method\", \"post\");\n    form.style.display = \"none\";\n    document.body.appendChild(form);\n\n    var input = document.createElement('input');\n    input.setAttribute('type', 'hidden');\n    input.setAttribute('name', name);\n    input.setAttribute('value', value);\n    form.appendChild(input);\n\n    var input2 = document.createElement('input');\n    input2.setAttribute('type', 'hidden');\n    input2.setAttribute('name', name2);\n    input2.setAttribute('value', value2);\n    form.appendChild(input2);\n\n    form.submit();\n};\n\n</script>\n\n</head>\n<body onload=\"draw();\">\n\n<canvas id=\"canvas\" width=\"150\" height=\"150\"></canvas>\n<br>\n<p>name: <input id=\"myname\" type=\"text\" name=\"name\" size=\"50\"></p>\n<button  onClick=\"myToDataUrl();\">PUSH</button>\n\n</body>\n</html>\n\n```\n\n\n\u753b\u50cf\u3068\u540d\u524d\u3092\u30ea\u30b9\u30c8\u8868\u793a\u3059\u308b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n\n```html:imgview.html\n\n<ul>\n{% for item in result %}\n<li><img src={{item.img}} alt=\"\">{{item.name}}</li>\n{% endfor %}\n</ul>\n\n```\n\n"}