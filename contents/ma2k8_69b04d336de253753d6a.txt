{"context": " More than 1 year has passed since last update.\u5b9a\u6642\u3067\u52d5\u304b\u3057\u3066\u3044\u308bSpark\u30d0\u30c3\u30c1\u306e\u30b3\u30b9\u30c8\u524a\u6e1b\u306e\u70ba\u3001\u30b9\u30dd\u30c3\u30c8\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u3002\n\u843d\u3061\u308b\u5bfe\u7b56\u306e\u305f\u3081\u306b\u5b9a\u4fa1\u306e3\u500d\u3067\u5165\u672d\u3092\u3044\u308c\u3066\u3044\u305f\u306e\u3060\u304c\u3001\u305d\u308c\u3067\u3082\u4fa1\u683c\u304c\u9ad8\u9a30\u3057\u3066EMR\u304c\u8d77\u52d5\u3067\u304d\u306a\u3044\u4e8b\u8c61\u304c\u767a\u751f\u3057\u305f\u3002\n\u898b\u3066\u307f\u308b\u3068 ap-northeast-1a,ap-northeast-1c\u3067\u5024\u6bb5\u304c\u305c\u3093\u305c\u3093\u9055\u3046\u3002\n\u5b89\u3044\u65b9\u4f7f\u3063\u305f\u307b\u3046\u304c\u5f97\u3060\u306a\u3068\u601d\u3063\u305f\u306e\u3067\u5236\u5fa1\u5165\u308c\u305f\u3002\n#!/bin/sh\n\nTARGET_INSTANCE_TYPE=\"c4.large\"\nTARGET_AZ=\"ap-northeast-1a\"\nSINCE=`date -u -d '1 hours ago' +\"%Y-%m-%dT%H:%M:%S\"`\nUNTIL=`date -u +\"%Y-%m-%dT%H:%M:%S\"`\n\naws ec2 describe-spot-price-history \\\n--instance-types ${TARGET_INSTANCE_TYPE} \\\n--product-description \"Linux/UNIX (Amazon VPC)\" \\\n--start-time ${SINCE} \\\n--end-time ${UNTIL} \\\n--availability-zone ${TARGET_AZ} \\\n| jq -r '.SpotPriceHistory[] | \"\\(.Timestamp)\\t\\(.SpotPrice)\"' | \\\nsed s/.000z//g | awk '{print $2}' | head -n 1\n\n\u2191\u3067\u8abf\u3079\u305f\u3044instance_type,az\u306e\u5024\u6bb5\u3092\u8abf\u3079\u3066\u3001\u4e00\u756a\u5b89\u3044AZ\u3092\u8abf\u3079\u308b\u3002\n# az\u3054\u3068\u306b\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u4f5c\u6210\u3057\u3001\u4fa1\u683c\u306e\u5224\u5b9a\u7d50\u679c\u306b\u3088\u3063\u3066$TARGET_SUBNET_ID\u3092\u5207\u308a\u66ff\u3048\u305f\u3002\n# EMR\u4f5c\u6210\u30b3\u30de\u30f3\u30c9\u4f8b: \nEMR_CLUSTER_ID=`aws emr create-cluster \\\n--no-auto-terminate \\\n--region ap-northeast-1 \\\n--name SparkCluster \\\n--ami-version 3.8.0 \\\n--service-role EMR_DefaultRole \\\n--instance-groups InstanceCount=1,\\\nName=sparkmaster,\\\nBidPrice=$BID_PRICE,\\\nInstanceGroupType=MASTER,\\\nInstanceType=$INSTANCE_TYPE InstanceCount=$INSTANCE_COUNT,\\\nName=sparkworker,\\\nBidPrice=$BID_PRICE,\\\nInstanceGroupType=CORE,\\\nInstanceType=$INSTANCE_TYPE \\\n--ec2-attributes InstanceProfile=EMR_EC2_DefaultRole,SubnetId=$TARGET_SUBNET_ID,\\\nKeyName=fam \\\n--applications Name=Spark \\\n--query 'ClusterId' --output text`\n\n\u4fbf\u5229\u3002\n\u3053\u308c\u3067\u3082\u843d\u3061\u308b\u3088\u3046\u3067\u3042\u308c\u3070\u3001\u843d\u3061\u308b\u307e\u30671\u5206\u9593\u7336\u4e88\u304c\u3067\u304d\u305f\u3088\u3046\u306a\u306e\u3067\u5b9a\u6642\u76e3\u8996\u3057\u3066\u4fa1\u683c\u3092\u91e3\u308a\u4e0a\u3052\u308b\u30ed\u30b8\u30c3\u30af\u3092\u3044\u308c\u308b\u3057\u304b\u306a\u3044\u304b\u306a\u30fb\u30fb\u30fb\uff08\u8a73\u7d30\u672a\u8abf\u67fb\n\n\u5b9a\u6642\u3067\u52d5\u304b\u3057\u3066\u3044\u308bSpark\u30d0\u30c3\u30c1\u306e\u30b3\u30b9\u30c8\u524a\u6e1b\u306e\u70ba\u3001\u30b9\u30dd\u30c3\u30c8\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u3002\n\u843d\u3061\u308b\u5bfe\u7b56\u306e\u305f\u3081\u306b\u5b9a\u4fa1\u306e3\u500d\u3067\u5165\u672d\u3092\u3044\u308c\u3066\u3044\u305f\u306e\u3060\u304c\u3001\u305d\u308c\u3067\u3082\u4fa1\u683c\u304c\u9ad8\u9a30\u3057\u3066EMR\u304c\u8d77\u52d5\u3067\u304d\u306a\u3044\u4e8b\u8c61\u304c\u767a\u751f\u3057\u305f\u3002\n\n\u898b\u3066\u307f\u308b\u3068 ap-northeast-1a,ap-northeast-1c\u3067\u5024\u6bb5\u304c\u305c\u3093\u305c\u3093\u9055\u3046\u3002\n\u5b89\u3044\u65b9\u4f7f\u3063\u305f\u307b\u3046\u304c\u5f97\u3060\u306a\u3068\u601d\u3063\u305f\u306e\u3067\u5236\u5fa1\u5165\u308c\u305f\u3002\n\n```\n#!/bin/sh\n\nTARGET_INSTANCE_TYPE=\"c4.large\"\nTARGET_AZ=\"ap-northeast-1a\"\nSINCE=`date -u -d '1 hours ago' +\"%Y-%m-%dT%H:%M:%S\"`\nUNTIL=`date -u +\"%Y-%m-%dT%H:%M:%S\"`\n\naws ec2 describe-spot-price-history \\\n--instance-types ${TARGET_INSTANCE_TYPE} \\\n--product-description \"Linux/UNIX (Amazon VPC)\" \\\n--start-time ${SINCE} \\\n--end-time ${UNTIL} \\\n--availability-zone ${TARGET_AZ} \\\n| jq -r '.SpotPriceHistory[] | \"\\(.Timestamp)\\t\\(.SpotPrice)\"' | \\\nsed s/.000z//g | awk '{print $2}' | head -n 1\n```\n\n\u2191\u3067\u8abf\u3079\u305f\u3044instance_type,az\u306e\u5024\u6bb5\u3092\u8abf\u3079\u3066\u3001\u4e00\u756a\u5b89\u3044AZ\u3092\u8abf\u3079\u308b\u3002\n\n\n```\n# az\u3054\u3068\u306b\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u4f5c\u6210\u3057\u3001\u4fa1\u683c\u306e\u5224\u5b9a\u7d50\u679c\u306b\u3088\u3063\u3066$TARGET_SUBNET_ID\u3092\u5207\u308a\u66ff\u3048\u305f\u3002\n# EMR\u4f5c\u6210\u30b3\u30de\u30f3\u30c9\u4f8b: \nEMR_CLUSTER_ID=`aws emr create-cluster \\\n--no-auto-terminate \\\n--region ap-northeast-1 \\\n--name SparkCluster \\\n--ami-version 3.8.0 \\\n--service-role EMR_DefaultRole \\\n--instance-groups InstanceCount=1,\\\nName=sparkmaster,\\\nBidPrice=$BID_PRICE,\\\nInstanceGroupType=MASTER,\\\nInstanceType=$INSTANCE_TYPE InstanceCount=$INSTANCE_COUNT,\\\nName=sparkworker,\\\nBidPrice=$BID_PRICE,\\\nInstanceGroupType=CORE,\\\nInstanceType=$INSTANCE_TYPE \\\n--ec2-attributes InstanceProfile=EMR_EC2_DefaultRole,SubnetId=$TARGET_SUBNET_ID,\\\nKeyName=fam \\\n--applications Name=Spark \\\n--query 'ClusterId' --output text`\n```\n\n\u4fbf\u5229\u3002\n\u3053\u308c\u3067\u3082\u843d\u3061\u308b\u3088\u3046\u3067\u3042\u308c\u3070\u3001\u843d\u3061\u308b\u307e\u30671\u5206\u9593\u7336\u4e88\u304c\u3067\u304d\u305f\u3088\u3046\u306a\u306e\u3067\u5b9a\u6642\u76e3\u8996\u3057\u3066\u4fa1\u683c\u3092\u91e3\u308a\u4e0a\u3052\u308b\u30ed\u30b8\u30c3\u30af\u3092\u3044\u308c\u308b\u3057\u304b\u306a\u3044\u304b\u306a\u30fb\u30fb\u30fb\uff08\u8a73\u7d30\u672a\u8abf\u67fb\n", "tags": ["AWS", "EMR"]}