{"context": " More than 1 year has passed since last update.\u4ee5\u4e0b\u306e\u62e1\u5f35\u3067\u3059\u3002\ncapistrano\u30c7\u30d7\u30ed\u30a4\u6642\u306b\u3001\u65b0\u3057\u304f\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u308bgit\u306e\u30b3\u30df\u30c3\u30c8\u30ed\u30b0\u3092HipChat\u306b\u901a\u77e5\ncapistrano 3.1.0\u304b\u3089deploy:failed\u3068\u3044\u3046\u30c7\u30d7\u30ed\u30a4\u5931\u6557\u3092\u691c\u77e5\u3059\u308bhook\u304c\u8ffd\u52a0\u3055\u308c\u305f\u306e\u3067\u3001\u305d\u308c\u3092\u5229\u7528\u3057\u3066\u30c7\u30d7\u30ed\u30a4\u5931\u6557\u6642\u306bhipchat\u3078\u901a\u77e5\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u5909\u66f4\u7b87\u6240\nconfig/deploy.rb \u306b\u30c7\u30d7\u30ed\u30a4\u5931\u6557\u6642\u306ehook\u3092\u8ffd\u52a0\n\nconfig/deploy.rb\n  after 'deploy:failed', 'hipchat:update:fail'\n\n\nlib/capistrano/hipchat.cap\u306b\u30c7\u30d7\u30ed\u30a4\u5931\u6557\u6642\u306e\u51e6\u7406\u3092\u8a18\u8ff0\n\nlib/capistrano/hipchat.cap\n\nrequire 'hipchat'\n\nHIPCHAT_TOKEN = 'YOUR_HIPCHAT_TOKEN'\nROOM_NAME = 'ROOM_NAME_TO_NOTIFY'\n\nclient = HipChat::Client.new(HIPCHAT_TOKEN)[ROOM_NAME]\n\nnamespace :hipchat do\n  namespace :update do\n    desc 'Notify when failed to deploy'\n    task :fail do\n      run_locally do\n        client.send('Deploy',\n          \"#{deploy_user} FAILED to deploy #{fetch(:application)} to #{fetch(:rails_env)} ;(\",\n          { color: 'red', notify: true }\n        )\n      end\n    end\n  end\nend\n\ndef deploy_user\n  `git config user.name`.strip || ENV['USER']\nend\n\n\n\u3059\u308b\u3068hipchat\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u901a\u77e5\u3055\u308c\u307e\u3059\u3002\n\nbob FAILED to deploy \u30a2\u30d7\u30ea\u540d to \u74b0\u5883 ;(\n\n\n\u53c2\u8003\n\nhttps://github.com/capistrano/capistrano/issues/708\nhttp://qiita.com/ysk_1031/items/91010b8e6d5c995e23c7\n\n\u4ee5\u4e0b\u306e\u62e1\u5f35\u3067\u3059\u3002\n[capistrano\u30c7\u30d7\u30ed\u30a4\u6642\u306b\u3001\u65b0\u3057\u304f\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u308bgit\u306e\u30b3\u30df\u30c3\u30c8\u30ed\u30b0\u3092HipChat\u306b\u901a\u77e5](http://qiita.com/ysk_1031/items/91010b8e6d5c995e23c7)\n\ncapistrano 3.1.0\u304b\u3089`deploy:failed`\u3068\u3044\u3046\u30c7\u30d7\u30ed\u30a4\u5931\u6557\u3092\u691c\u77e5\u3059\u308bhook\u304c\u8ffd\u52a0\u3055\u308c\u305f\u306e\u3067\u3001\u305d\u308c\u3092\u5229\u7528\u3057\u3066\u30c7\u30d7\u30ed\u30a4\u5931\u6557\u6642\u306bhipchat\u3078\u901a\u77e5\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\n## \u5909\u66f4\u7b87\u6240\n\n`config/deploy.rb` \u306b\u30c7\u30d7\u30ed\u30a4\u5931\u6557\u6642\u306ehook\u3092\u8ffd\u52a0\n\n```rb:config/deploy.rb\n  after 'deploy:failed', 'hipchat:update:fail'\n```\n\n\n`lib/capistrano/hipchat.cap`\u306b\u30c7\u30d7\u30ed\u30a4\u5931\u6557\u6642\u306e\u51e6\u7406\u3092\u8a18\u8ff0\n\n```rb:lib/capistrano/hipchat.cap\n\nrequire 'hipchat'\n\nHIPCHAT_TOKEN = 'YOUR_HIPCHAT_TOKEN'\nROOM_NAME = 'ROOM_NAME_TO_NOTIFY'\n\nclient = HipChat::Client.new(HIPCHAT_TOKEN)[ROOM_NAME]\n\nnamespace :hipchat do\n  namespace :update do\n    desc 'Notify when failed to deploy'\n    task :fail do\n      run_locally do\n        client.send('Deploy',\n          \"#{deploy_user} FAILED to deploy #{fetch(:application)} to #{fetch(:rails_env)} ;(\",\n          { color: 'red', notify: true }\n        )\n      end\n    end\n  end\nend\n\ndef deploy_user\n  `git config user.name`.strip || ENV['USER']\nend\n```\n\n\u3059\u308b\u3068hipchat\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u901a\u77e5\u3055\u308c\u307e\u3059\u3002\n\n> bob FAILED to deploy \u30a2\u30d7\u30ea\u540d to \u74b0\u5883 ;(\n\n---\n\n\u53c2\u8003\n\n- https://github.com/capistrano/capistrano/issues/708\n- http://qiita.com/ysk_1031/items/91010b8e6d5c995e23c7\n", "tags": ["capistrano3.2.0", "hipchat"]}