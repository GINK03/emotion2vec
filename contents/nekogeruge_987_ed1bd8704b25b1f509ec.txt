{"context": " More than 1 year has passed since last update.DB\u79fb\u884c\u306e\u969b\u3001slave\u306e\u30b5\u30fc\u30d0\u306bmysql\u306e\u30b3\u30fc\u30eb\u30c9\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u9001\u308b\u6642\u306e\n\u8ee2\u9001\u6642\u9593\u304c\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u306b\u306a\u308a\u3001\u8a66\u884c\u932f\u8aa4\u3057\u3066\u6700\u7d42\u7684\u306b\u4f7f\u3063\u305f\u30b7\u30a7\u30eb\u3002  \n\n\u6ce8\u610f\u70b9\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\u3092\u5148\u306b\u30b3\u30d4\u30fc\u5148\u306b\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304b\u306a\u3044\u3068rsync\u304c\u3053\u3051\u308b\n\n\u5e2f\u57df\u306b\u4f9d\u5b58\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u5e2f\u57df\u304c\u72ed\u3044\u3068\u3042\u307e\u308a\u52b9\u679c\u304c\u7121\u3044\u3089\u3057\u3044\n\n\u30d5\u30a1\u30a4\u30eb\u6570\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3059\u308b\u305f\u3081\u3001100\u4e07\u500b\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u3068100\u4e07\u30d7\u30ed\u30bb\u30b9\u305f\u3061\u3042\u304c\u308b\n\n\u5b8c\u4e86\u5f8c\u306b\u666e\u901a\u306ersync\u3092\u5b9f\u884c\u3057\u3001\u5dee\u5206\u304c\u7121\u3044\u304b\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\u3068\u30d9\u30bf\u30fc\n\nrsync -avz /tmp/backup/mysql/ username@hostname:/tmp/backup/mysql/\n\n#!/bin/bash\n\n# \u30d1\u30b9\u306e\u672b\u5c3e\u306b/\u3092\u3064\u3051\u3066\u3082\u3064\u3051\u306a\u304f\u3066\u3082\u5927\u4e08\u592b\u306a\u3088\u3046\u306bsed\u3059\u308b\nfrom_dir=`echo $1 | sed -e \"s|/$||\"`\nto_host_user=$2\nto_host=$3\nto_dir=`echo $4 | sed -e \"s|/$||\"`\n\n# \u5f15\u6570\u30c1\u30a7\u30c3\u30af\nif [ \"$from_dir\" == \"\" ]; then\n  echo \"usage $0 from_directory_path to_host_user_name to_host_ip to_directory_path\"\n  exit -1\nelif [ \"$to_host_user\" == \"\" ]; then\n  echo \"usage $0 from_directory_path to_host_user_name to_host_ip to_directory_path\"\n  exit -1\nelif [ \"$to_host\" == \"\" ]; then\n  echo \"usage $0 from_directory_path to_host_user_name to_host_ip to_directory_path\"\n  exit -1\nelif [ \"$to_dir\" == \"\" ]; then\n  echo \"usage $0 from_directory_path to_host_user_name to_host_ip to_directory_path\"\n  exit -1\nfi\n\n# \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\u3092\u5148\u306b\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304b\u306a\u3044\u3068\u3053\u3051\u308b\nrsync -a --include \"*/\" --exclude \"*\" ${from_dir}/ ${to_host_user}@${to_host}:${to_dir}/\n\n# find\u3067\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u518d\u8d77\u7684\u306b\u53d6\u5f97\u3057\u3001\u305d\u308c\u3092\u5f15\u6570\u306brsync\u3092\u5b9f\u884c\u3059\u308b\n# \u3064\u307e\u308a\u3001\u30d5\u30a1\u30a4\u30eb\u304c100\u4e07\u500b\u3042\u308c\u3070\u30d7\u30ed\u30bb\u30b9\u304c100\u4e07\u8d77\u52d5\u3059\u308b\u3053\u3068\u306b\u306a\u308b\u306e\u3067\u6ce8\u610f\ncd ${from_dir}\nfor f in `find . -type f`\ndo\n  f=${f:2}\n  /usr/bin/rsync -avz --bwlimit=0 --whole-file --sockopts=TCP_NODELAY --delay-updates ${from_dir}/$f ${to_host_user}@${to_host}:${to_dir}/$f &\n\n  usleep 500000\ndone\n\nDB\u79fb\u884c\u306e\u969b\u3001slave\u306e\u30b5\u30fc\u30d0\u306bmysql\u306e\u30b3\u30fc\u30eb\u30c9\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u9001\u308b\u6642\u306e\n\u8ee2\u9001\u6642\u9593\u304c\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u306b\u306a\u308a\u3001\u8a66\u884c\u932f\u8aa4\u3057\u3066\u6700\u7d42\u7684\u306b\u4f7f\u3063\u305f\u30b7\u30a7\u30eb\u3002  \n\n#### \u6ce8\u610f\u70b9\n\n* \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\u3092\u5148\u306b\u30b3\u30d4\u30fc\u5148\u306b\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304b\u306a\u3044\u3068rsync\u304c\u3053\u3051\u308b  \n* \u5e2f\u57df\u306b\u4f9d\u5b58\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u5e2f\u57df\u304c\u72ed\u3044\u3068\u3042\u307e\u308a\u52b9\u679c\u304c\u7121\u3044\u3089\u3057\u3044  \n* \u30d5\u30a1\u30a4\u30eb\u6570\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3059\u308b\u305f\u3081\u3001100\u4e07\u500b\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u3068100\u4e07\u30d7\u30ed\u30bb\u30b9\u305f\u3061\u3042\u304c\u308b  \n* \u5b8c\u4e86\u5f8c\u306b\u666e\u901a\u306ersync\u3092\u5b9f\u884c\u3057\u3001\u5dee\u5206\u304c\u7121\u3044\u304b\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\u3068\u30d9\u30bf\u30fc\n\n```\nrsync -avz /tmp/backup/mysql/ username@hostname:/tmp/backup/mysql/\n```\n\n```bash\n#!/bin/bash\n\n# \u30d1\u30b9\u306e\u672b\u5c3e\u306b/\u3092\u3064\u3051\u3066\u3082\u3064\u3051\u306a\u304f\u3066\u3082\u5927\u4e08\u592b\u306a\u3088\u3046\u306bsed\u3059\u308b\nfrom_dir=`echo $1 | sed -e \"s|/$||\"`\nto_host_user=$2\nto_host=$3\nto_dir=`echo $4 | sed -e \"s|/$||\"`\n\n# \u5f15\u6570\u30c1\u30a7\u30c3\u30af\nif [ \"$from_dir\" == \"\" ]; then\n  echo \"usage $0 from_directory_path to_host_user_name to_host_ip to_directory_path\"\n  exit -1\nelif [ \"$to_host_user\" == \"\" ]; then\n  echo \"usage $0 from_directory_path to_host_user_name to_host_ip to_directory_path\"\n  exit -1\nelif [ \"$to_host\" == \"\" ]; then\n  echo \"usage $0 from_directory_path to_host_user_name to_host_ip to_directory_path\"\n  exit -1\nelif [ \"$to_dir\" == \"\" ]; then\n  echo \"usage $0 from_directory_path to_host_user_name to_host_ip to_directory_path\"\n  exit -1\nfi\n\n# \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\u3092\u5148\u306b\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304b\u306a\u3044\u3068\u3053\u3051\u308b\nrsync -a --include \"*/\" --exclude \"*\" ${from_dir}/ ${to_host_user}@${to_host}:${to_dir}/\n\n# find\u3067\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u518d\u8d77\u7684\u306b\u53d6\u5f97\u3057\u3001\u305d\u308c\u3092\u5f15\u6570\u306brsync\u3092\u5b9f\u884c\u3059\u308b\n# \u3064\u307e\u308a\u3001\u30d5\u30a1\u30a4\u30eb\u304c100\u4e07\u500b\u3042\u308c\u3070\u30d7\u30ed\u30bb\u30b9\u304c100\u4e07\u8d77\u52d5\u3059\u308b\u3053\u3068\u306b\u306a\u308b\u306e\u3067\u6ce8\u610f\ncd ${from_dir}\nfor f in `find . -type f`\ndo\n  f=${f:2}\n  /usr/bin/rsync -avz --bwlimit=0 --whole-file --sockopts=TCP_NODELAY --delay-updates ${from_dir}/$f ${to_host_user}@${to_host}:${to_dir}/$f &\n\n  usleep 500000\ndone\n```", "tags": ["Linux", "rsync", "Bash", "ShellScript"]}