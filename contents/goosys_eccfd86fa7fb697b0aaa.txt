{"context": "\n\n\u306f\u3058\u3081\u306b\nActiveAdmin\u3082Carrierwave\u3082\u4fbf\u5229\u3067\u3044\u3044\u3067\u3059\u3088\u306d\u3002\n\u3067\u3082ActiveAdmin\u306b\u306fCarrierwave\u7528\u306e\u51e6\u7406\u304c\u5165\u3063\u3066\u306a\u3044\u306e\u3067\u3001app/admin/*rb\u306b\u6bce\u56de\u8272\u3005\u66f8\u304b\u306a\u304d\u3083\u3044\u3051\u306a\u304f\u306a\u3063\u3066\u5927\u5909\u3067\u3059\u3002\n\u307e\u305f\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3068\u305d\u306e\u4e0a\u66f8\u304d\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306f\u3067\u304d\u308b\u3051\u3069\u3001\u524a\u9664\u306f\u305d\u306e\u307e\u307e\u3067\u306f\u3067\u304d\u306a\u3044\u306e\u3067\u3001\u3053\u308c\u3082\u6bce\u56de\u524a\u9664\u7528\u306e\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u3092\u8ffd\u52a0\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u304f\u3066\u5927\u5909\u3067\u3059\u3002\n\u305b\u3063\u304b\u304f\u306eActiveAdmin\u306a\u306e\u3067\u3001\u30ab\u30e9\u30e0\u306e\u7a2e\u985e\u306b\u5fdc\u3058\u3066\u52dd\u624b\u306b\u5fc5\u8981\u306a\u8868\u793a\u3068\u30d5\u30a9\u30fc\u30e0\u304c\u51fa\u529b\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u3067\u3059\u3002\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u3068\u308a\u3042\u3048\u305aCarrierwave\u306e\u30ab\u30e9\u30e0\u306b\u3064\u3044\u3066\u52dd\u624b\u306b\u5fc5\u8981\u306a\u51e6\u7406\u3092\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u4ed6\u306e\u7279\u6b8a\u306a\u578b\u306e\u30ab\u30e9\u30e0\u3067\u3082\u540c\u3058\u3088\u3046\u306b\u51fa\u6765\u308b\u306e\u3067\u3001\u4eca\u5f8c\u306e\u305f\u3081\u306b\u3082\u30e1\u30e2\u3057\u3066\u304a\u3053\u3046\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u74b0\u5883\n\nGemfile.lock\u304b\u3089\u629c\u7c8b\nrails (4.2.0)\nactiveadmin (1.0.0.pre2)\ncarrierwave (0.10.0)\n\n\n\n\u5b8c\u6210\u30b5\u30f3\u30d7\u30eb\n\n\u4e00\u89a7\u753b\u9762\u3001\u95b2\u89a7\u753b\u9762\n\n\u30b5\u30e0\u30cd\u30a4\u30eb\u304c\u306a\u3044\u5834\u5408 \u30fb\u30fb\u30fb \u5b9f\u30d5\u30a1\u30a4\u30eb\u306eURL\u3078\u30ea\u30f3\u30af\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u8868\u793a\n\u753b\u50cf\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u304c\u3055\u308c\u3066\u3044\u306a\u3044\uff08or\u524a\u9664\u3055\u308c\u305f\uff09\u5834\u5408 \u30fb\u30fb\u30fb \u7a7a\u6b04\n\u30b5\u30e0\u30cd\u30a4\u30eb\u304c\u3042\u308b\u5834\u5408 \u30fb\u30fb\u30fb \u30b5\u30e0\u30cd\u30a4\u30eb\u8868\u793a\n\n\n\n\u7de8\u96c6\u753b\u9762\n\n\u30b5\u30e0\u30cd\u30a4\u30eb\u304c\u3042\u308b\u5834\u5408\n\n\n\n\u30b5\u30e0\u30cd\u30a4\u30eb\u304c\u306a\u3044\u5834\u5408\n\n\n\n\u30bd\u30fc\u30b9\u30b5\u30f3\u30d7\u30eb\n\n\u307e\u3068\u3081\u3066\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nActiveAdmin+Carrierwave [Gist]\n\n\u4e00\u89a7\u753b\u9762\u3001\u95b2\u89a7\u753b\u9762\u7528\n\nconfig/initializers/extensions/active_admin/view_helpers/display_helper.rb\n#\n# https://github.com/activeadmin/activeadmin/blob/master/lib/active_admin/view_helpers/display_helper.rb\n#\nmodule ActiveAdmin\n  module ViewHelpers\n    module DisplayHelper\n\n      def pretty_format_with_pretty_other_format(object)\n        pretty_uploader_format(object) ||\n          pretty_jsonb_format(object) ||\n          pretty_format_without_pretty_other_format(object)\n      end\n      alias_method_chain :pretty_format, :pretty_other_format\n\n      def pretty_uploader_format(object)\n        if object.class.ancestors.include?(CarrierWave::Uploader::Base)\n          if object.present?\n            if object.version_exists?(:thumb) && object.thumb.file.exists?\n              content_tag(:p,\n                image_tag(object.url(:thumb)),\n                {class: 'attachment_wrap attachment_img'}\n              )\n            else\n              link_to object.file.identifier, object.url\n            end\n          end\n        end\n      end\n\n      def pretty_jsonb_format(object)\n        if object.class.ancestors.include?(Hash)\n          content_tag(:pre,\n            JSON.pretty_generate(object).gsub(\":\", \" =>\")\n          )\n        end\n      end\n\n    end\n  end\nend\n\n\nRails\u3067\u306e\u30d1\u30c3\u30c1\u306e\u65b9\u6cd5\u304c\u307e\u3060\u3088\u304f\u5206\u304b\u3089\u306a\u3044\u306e\u3067\u305d\u3053\u3089\u3078\u3093\u306f\u9069\u5f53\u3067\u3059\u304c\u3001\n\u5143\u306epretty_format\u30e1\u30bd\u30c3\u30c9\u306b\u30ab\u30e9\u30e0\u578b\u6bce\u306b\u51e6\u7406\u3092\u8ffd\u52a0\u3057\u3066\u3044\u3051\u3070\u3088\u3055\u305d\u3046\u3067\u3057\u305f\u3002\n\u5f15\u6570\u306eobject\u306b\u306fModel\u306eAttribute\u304c\u5165\u3063\u3066\u304d\u3066\u305f\u306e\u3067\u3001\u305d\u306e\u578b\u306a\u308a\u5024\u306a\u308a\u3092\u898b\u3066\u5206\u5c90\u3057\u3066\u3044\u3051\u3070\u3088\u3055\u305d\u3046\u3067\u3059\u3002\nCarrierwave\u306e\u5834\u5408\u306f\u3001\n\napp/models/animal.rb\nclass Animal < ActiveRecord::Base\n  mount_uploader :image, DefaultUploader\n\n\n\napp/uploaders/default_uploader.rb\nclass DefaultUploader < CarrierWave::Uploader::Base\n\n\n\u3053\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u3068\u3001image\u30ab\u30e9\u30e0\u306e\u3068\u304d\u306eobject\u306b\u306fDefaultUploader\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u6e21\u3063\u3066\u304d\u307e\u3059\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u4ee5\u5916\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c0\u30fc\u3082\u3069\u3093\u3069\u3093\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u304f\u3068\u601d\u3046\u306e\u3067\u3001\u3069\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c0\u30fc\u3067\u3082\u5171\u901a\u306b\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306bCarrierWave::Uploader::Base\u3092\u7d99\u627f\u3057\u3066\u3044\u308b\u30af\u30e9\u30b9\u304b\u3069\u3046\u304b\u3067\u5224\u65ad\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30b5\u30e0\u30cd\u30a4\u30eb\n\u3042\u3068\u306f\u3001\u30b5\u30e0\u30cd\u30a4\u30eb\u8868\u793a\u3067\u304d\u308b\u3088\u3046\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c0\u30fc\u306eversion\u306bthumb\u3092\u5b9a\u7fa9\u3057\u3066\u304a\u3051\u3070OK\u3067\u3059\u3002\n\u753b\u50cf\u4ee5\u5916\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c0\u30fc\u306e\u5834\u5408\u3067\u3082\u3001\u30ad\u30e3\u30d7\u30c1\u30e3\u753b\u50cf\u306a\u3069\u3092thumb\u306b\u4fdd\u5b58\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u3051\u3070\u8272\u3005\u6357\u308a\u305d\u3046\u306a\u4e88\u611f\u304c\u3057\u307e\u3059\u306d\u3002\n\napp/uploaders/default_uploader.rb\n  version :thumb do\n    process :resize_to_fit => [100, 100]\n  end\n\n\nthumb\u3068\u3044\u3046version\u304c\u5b58\u5728\u3057\u306a\u3044\u30a2\u30c3\u30d7\u30ed\u30fc\u30c0\u30fc\u306e\u5834\u5408\u306f\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u8868\u793a\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u3061\u306a\u307f\u306b\u3001\n\u53c2\u8003\u307e\u3067\u306b\u3001jsonb\u30ab\u30e9\u30e0\u306e\u5834\u5408\u306e\u51e6\u7406\u3082\u63b2\u8f09\u3057\u307e\u3057\u305f\u3002\njsonb\u30ab\u30e9\u30e0\u306e\u5834\u5408\u306fobject\u306bHash\u304c\u6e21\u3063\u3066\u304d\u305f\u306e\u3067\u3001\u305d\u306e\u307e\u307eJSON\u6587\u5b57\u5217\u306b\u3057\u3066\u8868\u793a\u3057\u3066\u3044\u307e\u3059\u3002\n\u9577\u3044JSON\u304c\u60f3\u5b9a\u3055\u308c\u308b\u5834\u5408\u306f\u9069\u5b9csubstr\u3059\u308b\u306a\u308a\u3057\u3066\u5bfe\u5fdc\u3059\u308c\u3070\u3088\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u7de8\u96c6\u753b\u9762\u7528\n\napp/inputs/file_input.rb\nclass FileInput < Formtastic::Inputs::FileInput\n  def image_html_options\n    {:class => 'attachment_wrap attachment_img'}.merge(options[:image_html] || {})\n  end\n  def image_plain_html_options\n    {:class => 'attachment_wrap attachment_plain'}.merge(options[:image_html] || {})\n  end\n\n  def to_html\n    input_wrapping do\n      label_html <<\n      builder.file_field(method, input_html_options) <<\n      image_html\n    end\n  end\n\n  protected\n\n    def image_html\n      return \"\".html_safe if builder.object.new_record?\n\n      case options[:image]\n      when Symbol\n        builder.object.send(options[:image])\n      when Proc\n        options[:image].call(builder.object)\n      when String\n        options[:image].to_s\n      else\n        att = builder.object.public_send(method)\n        if att.present?\n          if att.version_exists?(:thumb) && att.thumb.file.exists?\n            builder.template.content_tag :div, nil, image_html_options, true do\n              builder.template.image_tag(att.url(:thumb) ) +\n              builder.check_box(\"remove_#{method.to_s}\".to_sym, {}, true, false)\n            end\n          else\n            builder.template.content_tag :div, nil, image_plain_html_options, true do\n              builder.template.content_tag(:span, att.url() ) +\n              builder.check_box(\"remove_#{method.to_s}\".to_sym, {}, true, false)\n            end\n          end\n        else\n          \"\".html_safe\n        end\n      end\n\n    end\nend\n\n\n\u203b\u3069\u3053\u304b\u304b\u3089\u62dd\u501f\u3057\u305f\u30bd\u30fc\u30b9\u3092\u30d9\u30fc\u30b9\u306b\u3057\u3066\u307e\u3059\u304c\u3001URL\u3092\u7d1b\u5931\u3057\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u3001\u63a2\u3057\u5f53\u3066\u3089\u308c\u305f\u3089\u6539\u3081\u3066\u53c2\u7167\u3092\u63b2\u8f09\u3057\u307e\u3059m(_ _)m\n\u53c2\u7167\u3057\u305f\u30bd\u30fc\u30b9\u3067\u306f\u3001\nf.input :image, as: :file, :image => proc { |o| o.image.url(:thumb) }\n\n\u3053\u3093\u306a\u98a8\u306b\u66f8\u3051\u3070\u597d\u304d\u306a\u6587\u5b57\u3092\u8868\u793a\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305fZE\uff01HAHAHA\uff01 \u307f\u305f\u3044\u306a\u611f\u3058\u3067\u3057\u305f\u304c\u3001\n\u3067\u304d\u308c\u3070app/admin/*rb\u306b\u306f\u306a\u308b\u3079\u304f\u4f55\u3082\u66f8\u304d\u305f\u304f\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u4f55\u3082\u66f8\u304b\u306a\u3051\u308c\u3070\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u30b5\u30e0\u30cd\u30a4\u30eb\u304b\u30d5\u30a1\u30a4\u30eb\u540d\u8868\u793a\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\napp/admin/*.rb\n  form do |f|\n    f.input :image, as: :file\n    f.input :image #image\u306fCarriewave\u306euploader\u306a\u306e\u3067\u30c7\u30d5\u30a9\u30eb\u30c8\u3067 as: :file\u306b\u306a\u308b\n    f.inputs #\u5168\u3066\u306e\u30ab\u30e9\u30e0\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u8868\u793a\n\n\n\u3053\u308c\u3089\u306e\u3069\u306e\u66f8\u304d\u65b9\u3067\u3082\u81ea\u52d5\u7684\u306b\u30b5\u30e0\u30cd\u30a4\u30eb\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\u5168\u30ab\u30e9\u30e0\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3051\u3067\u3088\u3044\u5834\u5408\u306f\u3001form\u306e\u30d6\u30ed\u30c3\u30af\u3059\u3089\u4e0d\u8981\u3067\u3059\u3002\n\n\u524a\u9664\n\u524a\u9664\u6a5f\u80fd\u81ea\u4f53\u306fCarrierwave\u306b\u304d\u3061\u3093\u3068\u642d\u8f09\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u306e\u304a\u4f5c\u6cd5\u306b\u5023\u3048\u3070\u7c21\u5358\u3067\u3059\u3002\n\u65e2\u306b\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u306f\u51fa\u529b\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u305d\u306e\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u306f\u3053\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002\n<input type=\"file\" name=\"animal[remove_image]\"> /* remove_\u30ab\u30e9\u30e0\u540d */\n\n\u3053\u306eremove_\u30ab\u30e9\u30e0\u540d\u304ctrue\uff08\u30c1\u30a7\u30c3\u30af\u3055\u308c\u305f\u72b6\u614b\uff09\u3067\u9001\u4fe1\u3055\u308c\u308c\u3070Carrierwave\u304c\u304d\u3061\u3093\u3068\u524a\u9664\u51e6\u7406\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\u3053\u306e\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u3092Carrierwave\u306b\u5230\u9054\u3055\u305b\u308b\u306b\u306fpermission\u306e\u6307\u5b9a\u304c\u5fc5\u8981\u306a\u306e\u3067\u3001\u8ffd\u52a0\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\napp/admin/animal.rb\nActiveAdmin.register Animal do\n  permit_params do\n    Animal.column_names - [\"id\",\"created_at\",\"updated_at\"] + [\"remove_image\"]\n  end\n\n\n\u3053\u308c\u3067\u3001\u4e0a\u306e\u753b\u50cf\u306e\u3088\u3046\u306b\u52dd\u624b\u306b\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u304c\u51fa\u3066\u304d\u3066\u3001\u30c1\u30a7\u30c3\u30af\u3059\u308b\u3068\u524a\u9664\u3055\u308c\u308b\u3068\u3053\u308d\u307e\u3067\u5b9f\u88c5\u3067\u304d\u3061\u3083\u3044\u307e\u3057\u305f\u3002\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c0\u30fc\u3092\u5897\u3084\u3057\u305f\u308amount_uploader\u3057\u305f\u30ab\u30e9\u30e0\u3092\u5897\u3084\u3057\u305f\u308a\u3057\u3066\u3082\u3001\u7ba1\u7406\u753b\u9762\u306b\u306fremove_*\u3092\u8ffd\u8a18\u3059\u308b\u3060\u3051\u3067\u3044\u3044\u306e\u3067\u697d\u3067\u3059\u306d\u3002\n\u203b\u307b\u3093\u3068\u306f\u3053\u3053\u3082\u81ea\u52d5\u5316\u3057\u305f\u3044\u3051\u3069\u3001association\u3068\u304b\u7d61\u3093\u3067\u304f\u308b\u3068permit_params\u306f\u3054\u3061\u3083\u3054\u3061\u3083\u66f8\u304f\u3053\u3068\u306b\u306a\u308a\u305d\u3046\u3067\u3001\u305d\u3053\u307e\u3067\u30b5\u30dd\u30fc\u30c8\u3067\u304d\u306a\u3044\u306e\u3067\u3084\u3081\u307e\u3057\u305f\u3002\n\n\u6ce8\u610f\n\u4eca\u6c17\u4ed8\u304d\u307e\u3057\u305f\u304c\u3001Formtastic::Inputs::FileInput\u3092\u62e1\u5f35\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u308c\u3092ActiveAdmin\u4ee5\u5916\u3067\u3082\u4f7f\u3063\u3066\u3044\u308b\u3068\u5f71\u97ff\u3092\u53d7\u3051\u3061\u3083\u3044\u307e\u3059\u306d\u3002\u5f53\u7136\u3067\u3059\u3088\u306d\u3002\u3002\n\u305d\u308c\u306f\u305d\u308c\u3067\u3044\u3044\u5834\u5408\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u4f8b\u3048\u3070\u30e1\u30fc\u30eb\u30d5\u30a9\u30fc\u30e0\u7b49\u306e\u4e00\u56de\u304d\u308a\u306e\u9001\u4fe1\u3057\u304b\u3057\u306a\u3044\u753b\u9762\u3067\u3042\u308c\u3070\u3001\u753b\u50cf\u524a\u9664\u306f\u4e0d\u8981\u304b\u3082\u3067\u3059\u3002\n\u305d\u306e\u5834\u5408\u306f\u3001\u305d\u308c\u7528\u306e\u51e6\u7406\u3092\u8ffd\u8a18\u3059\u308b\u3068\u304b\u3001:image\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u4f55\u3082\u3057\u306a\u3044\u30d6\u30ed\u30c3\u30af\u3092\u6e21\u3059\u3068\u304b\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\nsemantic_form_for\u306a\u3093\u304b\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u306f\u3054\u6ce8\u610f\u3092\u3002\n\nCSS\n\napp/assets/stylesheets/active_admin/bass.scss\n/**\n * FileInput < Formtastic::Inputs::FileInput\n */\n.attachment_wrap {\n    @extend p.inline-hints;\n    font-style: default;\n    display: block;\n\n    &.attachment_img img {\n        height: 80px;\n    }\n\n    &.attachment_plain {\n    }\n\n    [name*=\"[remove_\"] {\n        display: inline-block;\n        margin-left: 5px;\n    }\n}\n\n\n\u30b5\u30e0\u30cd\u30a4\u30eb\u3084\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u306e\u30b9\u30bf\u30a4\u30eb\u306a\u3069\u3092\u3002\n\n\u304a\u308f\u308a\n\u3044\u3084\u30fc\u7d20\u6674\u3089\u3057\u3044\u3067\u3059\u306d\u3002ActiveAdmin\u3082Carrierwave\u3082Ruby\u3082Rails\u3082\u3002\n# \u306f\u3058\u3081\u306b\n\nActiveAdmin\u3082Carrierwave\u3082\u4fbf\u5229\u3067\u3044\u3044\u3067\u3059\u3088\u306d\u3002\n\n\u3067\u3082ActiveAdmin\u306b\u306fCarrierwave\u7528\u306e\u51e6\u7406\u304c\u5165\u3063\u3066\u306a\u3044\u306e\u3067\u3001```app/admin/*rb```\u306b\u6bce\u56de\u8272\u3005\u66f8\u304b\u306a\u304d\u3083\u3044\u3051\u306a\u304f\u306a\u3063\u3066\u5927\u5909\u3067\u3059\u3002\n\u307e\u305f\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3068\u305d\u306e\u4e0a\u66f8\u304d\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306f\u3067\u304d\u308b\u3051\u3069\u3001\u524a\u9664\u306f\u305d\u306e\u307e\u307e\u3067\u306f\u3067\u304d\u306a\u3044\u306e\u3067\u3001\u3053\u308c\u3082\u6bce\u56de\u524a\u9664\u7528\u306e\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u3092\u8ffd\u52a0\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u304f\u3066\u5927\u5909\u3067\u3059\u3002\n\n\u305b\u3063\u304b\u304f\u306eActiveAdmin\u306a\u306e\u3067\u3001\u30ab\u30e9\u30e0\u306e\u7a2e\u985e\u306b\u5fdc\u3058\u3066\u52dd\u624b\u306b\u5fc5\u8981\u306a\u8868\u793a\u3068\u30d5\u30a9\u30fc\u30e0\u304c\u51fa\u529b\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u3067\u3059\u3002\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u3068\u308a\u3042\u3048\u305aCarrierwave\u306e\u30ab\u30e9\u30e0\u306b\u3064\u3044\u3066\u52dd\u624b\u306b\u5fc5\u8981\u306a\u51e6\u7406\u3092\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u4ed6\u306e\u7279\u6b8a\u306a\u578b\u306e\u30ab\u30e9\u30e0\u3067\u3082\u540c\u3058\u3088\u3046\u306b\u51fa\u6765\u308b\u306e\u3067\u3001\u4eca\u5f8c\u306e\u305f\u3081\u306b\u3082\u30e1\u30e2\u3057\u3066\u304a\u3053\u3046\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n## \u74b0\u5883\n\n```Gemfile.lock\u304b\u3089\u629c\u7c8b\nrails (4.2.0)\nactiveadmin (1.0.0.pre2)\ncarrierwave (0.10.0)\n```\n\n# \u5b8c\u6210\u30b5\u30f3\u30d7\u30eb\n\n## \u4e00\u89a7\u753b\u9762\u3001\u95b2\u89a7\u753b\u9762\n\n* \u30b5\u30e0\u30cd\u30a4\u30eb\u304c\u306a\u3044\u5834\u5408 \u30fb\u30fb\u30fb \u5b9f\u30d5\u30a1\u30a4\u30eb\u306eURL\u3078\u30ea\u30f3\u30af\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u8868\u793a\n* \u753b\u50cf\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u304c\u3055\u308c\u3066\u3044\u306a\u3044\uff08or\u524a\u9664\u3055\u308c\u305f\uff09\u5834\u5408 \u30fb\u30fb\u30fb \u7a7a\u6b04\n* \u30b5\u30e0\u30cd\u30a4\u30eb\u304c\u3042\u308b\u5834\u5408 \u30fb\u30fb\u30fb \u30b5\u30e0\u30cd\u30a4\u30eb\u8868\u793a\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/64098/3d5a491e-96ba-98ec-2c3c-87770647819c.png)\n\n## \u7de8\u96c6\u753b\u9762\n\n* \u30b5\u30e0\u30cd\u30a4\u30eb\u304c\u3042\u308b\u5834\u5408\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/64098/4274a5d0-a1d6-407f-aa73-9270a53ab2e2.png)\n\n* \u30b5\u30e0\u30cd\u30a4\u30eb\u304c\u306a\u3044\u5834\u5408\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/64098/420d3255-2685-1b81-dc16-784f47ffd992.png)\n\n\n# \u30bd\u30fc\u30b9\u30b5\u30f3\u30d7\u30eb\n\n## \u307e\u3068\u3081\u3066\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n[ActiveAdmin+Carrierwave [Gist]](https://gist.github.com/goosys/0071a19f122d89ae7028bd2f7d2a2228)\n\n## \u4e00\u89a7\u753b\u9762\u3001\u95b2\u89a7\u753b\u9762\u7528\n\n```ruby:config/initializers/extensions/active_admin/view_helpers/display_helper.rb\n#\n# https://github.com/activeadmin/activeadmin/blob/master/lib/active_admin/view_helpers/display_helper.rb\n#\nmodule ActiveAdmin\n  module ViewHelpers\n    module DisplayHelper\n\n      def pretty_format_with_pretty_other_format(object)\n        pretty_uploader_format(object) ||\n          pretty_jsonb_format(object) ||\n          pretty_format_without_pretty_other_format(object)\n      end\n      alias_method_chain :pretty_format, :pretty_other_format\n\n      def pretty_uploader_format(object)\n        if object.class.ancestors.include?(CarrierWave::Uploader::Base)\n          if object.present?\n            if object.version_exists?(:thumb) && object.thumb.file.exists?\n              content_tag(:p,\n                image_tag(object.url(:thumb)),\n                {class: 'attachment_wrap attachment_img'}\n              )\n            else\n              link_to object.file.identifier, object.url\n            end\n          end\n        end\n      end\n\n      def pretty_jsonb_format(object)\n        if object.class.ancestors.include?(Hash)\n          content_tag(:pre,\n            JSON.pretty_generate(object).gsub(\":\", \" =>\")\n          )\n        end\n      end\n\n    end\n  end\nend\n```\n\nRails\u3067\u306e\u30d1\u30c3\u30c1\u306e\u65b9\u6cd5\u304c\u307e\u3060\u3088\u304f\u5206\u304b\u3089\u306a\u3044\u306e\u3067\u305d\u3053\u3089\u3078\u3093\u306f\u9069\u5f53\u3067\u3059\u304c\u3001\n\u5143\u306e[pretty_format](https://github.com/activeadmin/activeadmin/blob/master/lib/active_admin/view_helpers/display_helper.rb#L63)\u30e1\u30bd\u30c3\u30c9\u306b\u30ab\u30e9\u30e0\u578b\u6bce\u306b\u51e6\u7406\u3092\u8ffd\u52a0\u3057\u3066\u3044\u3051\u3070\u3088\u3055\u305d\u3046\u3067\u3057\u305f\u3002\n\u5f15\u6570\u306e```object```\u306b\u306fModel\u306eAttribute\u304c\u5165\u3063\u3066\u304d\u3066\u305f\u306e\u3067\u3001\u305d\u306e\u578b\u306a\u308a\u5024\u306a\u308a\u3092\u898b\u3066\u5206\u5c90\u3057\u3066\u3044\u3051\u3070\u3088\u3055\u305d\u3046\u3067\u3059\u3002\n\nCarrierwave\u306e\u5834\u5408\u306f\u3001\n\n```ruby:app/models/animal.rb\nclass Animal < ActiveRecord::Base\n  mount_uploader :image, DefaultUploader\n```\n\n```ruby:app/uploaders/default_uploader.rb\nclass DefaultUploader < CarrierWave::Uploader::Base\n```\n\n\u3053\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u3068\u3001image\u30ab\u30e9\u30e0\u306e\u3068\u304d\u306e```object```\u306b\u306f```DefaultUploader```\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u6e21\u3063\u3066\u304d\u307e\u3059\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u4ee5\u5916\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c0\u30fc\u3082\u3069\u3093\u3069\u3093\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u304f\u3068\u601d\u3046\u306e\u3067\u3001\u3069\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c0\u30fc\u3067\u3082\u5171\u901a\u306b\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b```CarrierWave::Uploader::Base```\u3092\u7d99\u627f\u3057\u3066\u3044\u308b\u30af\u30e9\u30b9\u304b\u3069\u3046\u304b\u3067\u5224\u65ad\u3057\u3066\u3044\u307e\u3059\u3002\n\n### \u30b5\u30e0\u30cd\u30a4\u30eb\n\n\u3042\u3068\u306f\u3001\u30b5\u30e0\u30cd\u30a4\u30eb\u8868\u793a\u3067\u304d\u308b\u3088\u3046\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c0\u30fc\u306e```version```\u306b```thumb```\u3092\u5b9a\u7fa9\u3057\u3066\u304a\u3051\u3070OK\u3067\u3059\u3002\n\u753b\u50cf\u4ee5\u5916\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c0\u30fc\u306e\u5834\u5408\u3067\u3082\u3001\u30ad\u30e3\u30d7\u30c1\u30e3\u753b\u50cf\u306a\u3069\u3092thumb\u306b\u4fdd\u5b58\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u3051\u3070\u8272\u3005\u6357\u308a\u305d\u3046\u306a\u4e88\u611f\u304c\u3057\u307e\u3059\u306d\u3002\n\n```ruby:app/uploaders/default_uploader.rb\n  version :thumb do\n    process :resize_to_fit => [100, 100]\n  end\n```\n\nthumb\u3068\u3044\u3046version\u304c\u5b58\u5728\u3057\u306a\u3044\u30a2\u30c3\u30d7\u30ed\u30fc\u30c0\u30fc\u306e\u5834\u5408\u306f\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u8868\u793a\u306b\u306a\u308a\u307e\u3059\u3002\n\n### \u3061\u306a\u307f\u306b\u3001\n\u53c2\u8003\u307e\u3067\u306b\u3001jsonb\u30ab\u30e9\u30e0\u306e\u5834\u5408\u306e\u51e6\u7406\u3082\u63b2\u8f09\u3057\u307e\u3057\u305f\u3002\njsonb\u30ab\u30e9\u30e0\u306e\u5834\u5408\u306f```object```\u306b```Hash```\u304c\u6e21\u3063\u3066\u304d\u305f\u306e\u3067\u3001\u305d\u306e\u307e\u307eJSON\u6587\u5b57\u5217\u306b\u3057\u3066\u8868\u793a\u3057\u3066\u3044\u307e\u3059\u3002\n\u9577\u3044JSON\u304c\u60f3\u5b9a\u3055\u308c\u308b\u5834\u5408\u306f\u9069\u5b9csubstr\u3059\u308b\u306a\u308a\u3057\u3066\u5bfe\u5fdc\u3059\u308c\u3070\u3088\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n## \u7de8\u96c6\u753b\u9762\u7528\n\n```ruby:app/inputs/file_input.rb\nclass FileInput < Formtastic::Inputs::FileInput\n  def image_html_options\n    {:class => 'attachment_wrap attachment_img'}.merge(options[:image_html] || {})\n  end\n  def image_plain_html_options\n    {:class => 'attachment_wrap attachment_plain'}.merge(options[:image_html] || {})\n  end\n\n  def to_html\n    input_wrapping do\n      label_html <<\n      builder.file_field(method, input_html_options) <<\n      image_html\n    end\n  end\n\n  protected\n\n    def image_html\n      return \"\".html_safe if builder.object.new_record?\n\n      case options[:image]\n      when Symbol\n        builder.object.send(options[:image])\n      when Proc\n        options[:image].call(builder.object)\n      when String\n        options[:image].to_s\n      else\n        att = builder.object.public_send(method)\n        if att.present?\n          if att.version_exists?(:thumb) && att.thumb.file.exists?\n            builder.template.content_tag :div, nil, image_html_options, true do\n              builder.template.image_tag(att.url(:thumb) ) +\n              builder.check_box(\"remove_#{method.to_s}\".to_sym, {}, true, false)\n            end\n          else\n            builder.template.content_tag :div, nil, image_plain_html_options, true do\n              builder.template.content_tag(:span, att.url() ) +\n              builder.check_box(\"remove_#{method.to_s}\".to_sym, {}, true, false)\n            end\n          end\n        else\n          \"\".html_safe\n        end\n      end\n\n    end\nend\n```\n\n\u203b\u3069\u3053\u304b\u304b\u3089\u62dd\u501f\u3057\u305f\u30bd\u30fc\u30b9\u3092\u30d9\u30fc\u30b9\u306b\u3057\u3066\u307e\u3059\u304c\u3001URL\u3092\u7d1b\u5931\u3057\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u3001\u63a2\u3057\u5f53\u3066\u3089\u308c\u305f\u3089\u6539\u3081\u3066\u53c2\u7167\u3092\u63b2\u8f09\u3057\u307e\u3059m(_ _)m\n\n\u53c2\u7167\u3057\u305f\u30bd\u30fc\u30b9\u3067\u306f\u3001\n\n```ruby\nf.input :image, as: :file, :image => proc { |o| o.image.url(:thumb) }\n```\n\n\u3053\u3093\u306a\u98a8\u306b\u66f8\u3051\u3070\u597d\u304d\u306a\u6587\u5b57\u3092\u8868\u793a\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305fZE\uff01HAHAHA\uff01 \u307f\u305f\u3044\u306a\u611f\u3058\u3067\u3057\u305f\u304c\u3001\n\u3067\u304d\u308c\u3070```app/admin/*rb```\u306b\u306f\u306a\u308b\u3079\u304f\u4f55\u3082\u66f8\u304d\u305f\u304f\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u4f55\u3082\u66f8\u304b\u306a\u3051\u308c\u3070\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u30b5\u30e0\u30cd\u30a4\u30eb\u304b\u30d5\u30a1\u30a4\u30eb\u540d\u8868\u793a\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\n```ruby:app/admin/*.rb\n  form do |f|\n    f.input :image, as: :file\n    f.input :image #image\u306fCarriewave\u306euploader\u306a\u306e\u3067\u30c7\u30d5\u30a9\u30eb\u30c8\u3067 as: :file\u306b\u306a\u308b\n    f.inputs #\u5168\u3066\u306e\u30ab\u30e9\u30e0\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u8868\u793a\n```\n\n\u3053\u308c\u3089\u306e\u3069\u306e\u66f8\u304d\u65b9\u3067\u3082\u81ea\u52d5\u7684\u306b\u30b5\u30e0\u30cd\u30a4\u30eb\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\u5168\u30ab\u30e9\u30e0\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3051\u3067\u3088\u3044\u5834\u5408\u306f\u3001```form```\u306e\u30d6\u30ed\u30c3\u30af\u3059\u3089\u4e0d\u8981\u3067\u3059\u3002\n\n### \u524a\u9664\n\n\u524a\u9664\u6a5f\u80fd\u81ea\u4f53\u306fCarrierwave\u306b\u304d\u3061\u3093\u3068\u642d\u8f09\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u306e\u304a\u4f5c\u6cd5\u306b\u5023\u3048\u3070\u7c21\u5358\u3067\u3059\u3002\n\u65e2\u306b\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u306f\u51fa\u529b\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u305d\u306e\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u306f\u3053\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002\n\n```html\n<input type=\"file\" name=\"animal[remove_image]\"> /* remove_\u30ab\u30e9\u30e0\u540d */\n```\n\n\u3053\u306e```remove_\u30ab\u30e9\u30e0\u540d```\u304ctrue\uff08\u30c1\u30a7\u30c3\u30af\u3055\u308c\u305f\u72b6\u614b\uff09\u3067\u9001\u4fe1\u3055\u308c\u308c\u3070Carrierwave\u304c\u304d\u3061\u3093\u3068\u524a\u9664\u51e6\u7406\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\u3053\u306e\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u3092Carrierwave\u306b\u5230\u9054\u3055\u305b\u308b\u306b\u306fpermission\u306e\u6307\u5b9a\u304c\u5fc5\u8981\u306a\u306e\u3067\u3001\u8ffd\u52a0\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```ruby:app/admin/animal.rb\nActiveAdmin.register Animal do\n  permit_params do\n    Animal.column_names - [\"id\",\"created_at\",\"updated_at\"] + [\"remove_image\"]\n  end\n```\n\n\u3053\u308c\u3067\u3001\u4e0a\u306e\u753b\u50cf\u306e\u3088\u3046\u306b\u52dd\u624b\u306b\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u304c\u51fa\u3066\u304d\u3066\u3001\u30c1\u30a7\u30c3\u30af\u3059\u308b\u3068\u524a\u9664\u3055\u308c\u308b\u3068\u3053\u308d\u307e\u3067\u5b9f\u88c5\u3067\u304d\u3061\u3083\u3044\u307e\u3057\u305f\u3002\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c0\u30fc\u3092\u5897\u3084\u3057\u305f\u308a```mount_uploader```\u3057\u305f\u30ab\u30e9\u30e0\u3092\u5897\u3084\u3057\u305f\u308a\u3057\u3066\u3082\u3001\u7ba1\u7406\u753b\u9762\u306b\u306f```remove_*```\u3092\u8ffd\u8a18\u3059\u308b\u3060\u3051\u3067\u3044\u3044\u306e\u3067\u697d\u3067\u3059\u306d\u3002\n\u203b\u307b\u3093\u3068\u306f\u3053\u3053\u3082\u81ea\u52d5\u5316\u3057\u305f\u3044\u3051\u3069\u3001association\u3068\u304b\u7d61\u3093\u3067\u304f\u308b\u3068permit_params\u306f\u3054\u3061\u3083\u3054\u3061\u3083\u66f8\u304f\u3053\u3068\u306b\u306a\u308a\u305d\u3046\u3067\u3001\u305d\u3053\u307e\u3067\u30b5\u30dd\u30fc\u30c8\u3067\u304d\u306a\u3044\u306e\u3067\u3084\u3081\u307e\u3057\u305f\u3002\n\n### \u6ce8\u610f\n\n\u4eca\u6c17\u4ed8\u304d\u307e\u3057\u305f\u304c\u3001```Formtastic::Inputs::FileInput```\u3092\u62e1\u5f35\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u308c\u3092ActiveAdmin\u4ee5\u5916\u3067\u3082\u4f7f\u3063\u3066\u3044\u308b\u3068\u5f71\u97ff\u3092\u53d7\u3051\u3061\u3083\u3044\u307e\u3059\u306d\u3002\u5f53\u7136\u3067\u3059\u3088\u306d\u3002\u3002\n\u305d\u308c\u306f\u305d\u308c\u3067\u3044\u3044\u5834\u5408\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u4f8b\u3048\u3070\u30e1\u30fc\u30eb\u30d5\u30a9\u30fc\u30e0\u7b49\u306e\u4e00\u56de\u304d\u308a\u306e\u9001\u4fe1\u3057\u304b\u3057\u306a\u3044\u753b\u9762\u3067\u3042\u308c\u3070\u3001\u753b\u50cf\u524a\u9664\u306f\u4e0d\u8981\u304b\u3082\u3067\u3059\u3002\n\u305d\u306e\u5834\u5408\u306f\u3001\u305d\u308c\u7528\u306e\u51e6\u7406\u3092\u8ffd\u8a18\u3059\u308b\u3068\u304b\u3001```:image```\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u4f55\u3082\u3057\u306a\u3044\u30d6\u30ed\u30c3\u30af\u3092\u6e21\u3059\u3068\u304b\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n```semantic_form_for```\u306a\u3093\u304b\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u306f\u3054\u6ce8\u610f\u3092\u3002\n\n## CSS\n\n```css:app/assets/stylesheets/active_admin/bass.scss\n/**\n * FileInput < Formtastic::Inputs::FileInput\n */\n.attachment_wrap {\n    @extend p.inline-hints;\n    font-style: default;\n    display: block;\n\n    &.attachment_img img {\n        height: 80px;\n    }\n\n    &.attachment_plain {\n    }\n\n    [name*=\"[remove_\"] {\n        display: inline-block;\n        margin-left: 5px;\n    }\n}\n```\n\n\u30b5\u30e0\u30cd\u30a4\u30eb\u3084\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u306e\u30b9\u30bf\u30a4\u30eb\u306a\u3069\u3092\u3002\n\n# \u304a\u308f\u308a\n\n\u3044\u3084\u30fc\u7d20\u6674\u3089\u3057\u3044\u3067\u3059\u306d\u3002ActiveAdmin\u3082Carrierwave\u3082Ruby\u3082Rails\u3082\u3002\n", "tags": ["Rails", "activeadmin", "carrierwave"]}