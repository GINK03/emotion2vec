{"tags": ["RaspberryPi", "raspbian", "BMP180"], "context": "\n\n\u6982\u8981\nRaspberry pi 2 Model B (Raspbian)\u3067\u306e aitendo M180-4P(BMP180\u4f7f\u7528 \u6c17\u5727\u30bb\u30f3\u30b5\u30e2\u30b8\u30e5\u30fc\u30eb) \u8a2d\u5b9a\u899a\u66f8\u304d\n\n\n\u53c2\u8003\n\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3001\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\n\nBosch Datasheet\u2190\u8aac\u660e\u66f8\nBosch Driver\nadafruit Driver\nwiringPi\n\n\n\n\u30bb\u30f3\u30b5\u30fc\u30e2\u30b8\u30e5\u30fc\u30eb\u63a5\u7d9a\n\u3053\u3053\u306e\u30d4\u30f3\u30a2\u30a6\u30c8\u8868\u3092\u53c2\u7167\u3057\u307e\u3057\u305f\u3002\u4eca\u56de\u306f\u30011,3,5,9\u30d4\u30f3\u3092\u4f7f\u7528\u3057\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n5V\u30c8\u30ec\u30e9\u30f3\u30c8\u306a\u306e\u3067\u30015V\u3067\u63a5\u7d9a\u3057\u305f\u307b\u3046\u304c\u5b89\u5b9a\u3059\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n3.3V\u3067\u4f7f\u3063\u3066\u307f\u3066\u69d8\u5b50\u3092\u307f\u307e\u3059\u3002\n\n\n\u30bb\u30f3\u30b5\u30fc\u30e2\u30b8\u30e5\u30fc\u30eb\u8a2d\u5b9a\u60c5\u5831\n\u8aac\u660e\u66f8\u3092\u8aad\u3093\u3067\u307f\u307e\u3059\u3002\n\u3053\u306e\u30bb\u30f3\u30b5\u30fc\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30ec\u30b8\u30b9\u30bf\u69cb\u6210\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\nMSB(out_msb), LSB(out_lsb), XLSB(out_xlsb)\n\u6e2c\u5b9a\u30c7\u30fc\u30bf\u304c\u5165\u308a\u307e\u3059\u3002\n\u6e29\u5ea6(UT)\u306f\u300116\u30d3\u30c3\u30c8\u306b\u306a\u308a\u307e\u3059\u3002MSB\u3068LSB\u3092\u4f7f\u3044\u307e\u3059\u3002\n\u6c17\u5727(UP)\u306f\u3001\u30e2\u30fc\u30c9\u306b\u3088\u308a16\u30d3\u30c3\u30c8\u301c19\u30d3\u30c3\u30c8\u306b\u306a\u308a\u307e\u3059\u3002MSB, LSB, XLSB\u3092\u4f7f\u3044\u307e\u3059\u3002\nctrl_meas\n\n\n\u3010oss(oversampling_setting)\u3011:\n2\u30d3\u30c3\u30c8\u3067\u3001\u6e29\u5ea6\u6e2c\u5b9a\u6642\u306f\u300100\u3002\u6c17\u5727\u6e2c\u5b9a\u6642\u306f\u3001\u3053\u3053\u306e\u8a2d\u5b9a\u3067\u30e2\u30fc\u30c9\u3092\u6c7a\u3081\u307e\u3059\u3002\n\uff14\u7a2e\u985e\u306e\u30e2\u30fc\u30c9\u3068\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u7684\u306b\u7cbe\u5ea6\u3092\u4e0a\u3052\u305f(\u8907\u6570\u56de\u8a08\u6e2c\u3057\u3066\u3044\u308b\u3060\u3051\u3067\u3059\u304c)1\u8a08\u6e2c\u6bce\u5185\u90e8\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u56de\u6570\u304c32\u56de\u306e\u30e2\u30fc\u30c9\u306e\uff15\u7a2e\u985e\u304c\u3042\u308a\u307e\u3059\u3002\n\u3010sco\u3011:\n1\u30d3\u30c3\u30c8\u3067\u30011\u306e\u9593\u306f\u3001\u8a08\u6e2c\u4e2d\u3067\u3059\u3002\u8a08\u6e2c\u304c\u5b8c\u4e86\u3059\u308b\u30680\u306b\u306a\u308a\u307e\u3059\u3002\n\u3010measurement\u3011:\n5\u30d3\u30c3\u30c8\u3067\u3001\u6e29\u5ea6\u6e2c\u5b9a\u306f\u3001\"01110\"\u3002\u6c17\u5727\u6e2c\u5b9a\u306f\u3001\"10100\"\u3067\u3059\u3002\n\u6e2c\u5b9a\u3057\u305f\u3044\u30e2\u30fc\u30c9\u306e\u8a2d\u5b9a\u5024\u30920xF4\u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u30ec\u30b8\u30b9\u30bf\u306b(\u4f8b\u3048\u3070\u3001\u6e29\u5ea6\u306a\u30890x2E)\u66f8\u304d\u8fbc\u307f\u3001\u5909\u63db\u6642\u9593\u5f85\u3063\u305f\u306e\u3061\u3001out_msb, out_lsb, out_xlsb\u304b\u3089\u8a08\u6e2c\u5024\u3092\u53d6\u5f97\u3059\u308c\u3070\u3088\u3044\u3088\u3046\u3067\u3059\u3002\n\nsoft(Soft reset)\n0xB6\u3092\u66f8\u304d\u8fbc\u3080\u3068\u96fb\u6e90\u30ea\u30bb\u30c3\u30c8\u3068\u540c\u69d8\u306e\u30b7\u30fc\u30b1\u30f3\u30b9\u3067\u30bd\u30d5\u30c8\u30ea\u30bb\u30c3\u30c8\u3055\u308c\u307e\u3059\u3002\nid\n0x55(\u56fa\u5b9a\u5024)\u3067\u3059\u3002\u63a5\u7d9a\u78ba\u8a8d\u306a\u3069\u306b\u4f7f\u3044\u307e\u3059\u3002\ncalib21-calib0(\u88dc\u6b63\u5024)\n\u540416\u30d3\u30c3\u30c8\u306e11\u88dc\u6b63\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u3059\u3002AC4, AC5, AC6\u304cunsigned\u3067\u3001\u305d\u308c\u4ee5\u5916\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306f\u3001signed\u3067\u3059\u3002\n\u88dc\u6b63\u5024\u306f\u3001\u6c17\u6e29\u3001\u6c17\u5727\u3092\u8a08\u7b97\u3059\u308b\u969b\u3001\u4ee5\u4e0b\u306e\u8a08\u7b97\u5f0f\u3067\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u7d50\u69cb\u3001\u3081\u3093\u3069\u304f\u3055\u3044\u8a08\u7b97\u3067\u3059\u3002\u305d\u306e\u5206\u3001\u6b63\u78ba\u306a\u5024\u304c\u8a08\u6e2c\u3067\u304d\u308b\u306e\u304b\u306a\u3002\n\n\u3010\u88dc\u6b63\u5024 AC1, AC2, AC3, AC4, AC5, AC6, B1. B2, MB, MC, MD\u3011\n\u5404\u88dc\u6b63\u5024 = ((\u5404\u88dc\u6b63\u5024\u306eMSB << 8) | \u5404\u88dc\u6b63\u5024\u306eLSB);\n\u3010\u6c17\u6e29 t\u3011\nUT = ((MSB << 8) | LSB);\nX1 = ((UT - AC6) * AC5 >> 15);\nX2 = ((MC << 11) / (X1 + MD));\nB5 = (X1 + X2);\nt = ((B5 + 8) >> 4);\nt / 10.0 \u2103\n\u3010\u6c17\u5727 p\u3011\nUP = ((MSB << 16) | (LSB << 8) | XLSB) >> (8 - oss)\nB3\u306e\u8a08\u7b97\nB6 = (B5 - 4000);\nX1 = ((B6 * B6) >> 12);\nX1 = (X1 * B2);\nX1 = (X1 >> 11);\nX2 = (AC2 * B6);\nX2 = (X2 >> 11);\nX3 = (X1 + X2);\nB3 = (AC1 * 4 + X3);\nB3 = ((B3 << oss) + 2);\nB3 = (B3 >> 2);\nB4\u306e\u8a08\u7b97\nX1 = ((AC3 * B6) >> 13);\nX2 = ((B6 * B6) >> 12);\nX2 = ((B1 * X2) >> 16);\nX3 = ((X1 + X2) + 2) >> 2;\nB4 = (AC4 * (X3 + 32768)) >> 15;\np\u306e\u8a08\u7b97\nB7 = ((UP - B3) * (50000 >> oss));\nif (B7 < 0x80000000) {\n    p = (B7 << 1) / B4;\n} else {\n    p = (B7 / B4) << 1;\n}\nX1 = p >> 8;\nX1 *= X1;\nX1 = (X1 * 3038) >> 16;\nX2 = (p * -7357) >> 16;\np += (X1 + X2 + 3791) >> 4;\np / 100.0 hPa\n\n\u30bb\u30f3\u30b5\u30fc\u30e2\u30b8\u30e5\u30fc\u30eb\u8a2d\u5b9a\u624b\u9806\n\nI2C\u6709\u52b9\n\nI2C\u6709\u52b9\n$ sudo raspi-config\n\n\n\u300c8 Advanced Options\u300d \u2192 \u300cA7 SPI\u300d \u2192 \u300cI2C enable\u300d\n\nI2C\u30e2\u30b8\u30e5\u30fc\u30eb\u8a2d\u5b9a\n\nI2C\u30e2\u30b8\u30e5\u30fc\u30eb\u8aad\u307f\u8fbc\u307f\u8a2d\u5b9a\n$ sudo nano /etc/modules\n\n\nsnd-bcm2835\ni2c-dev\n\n\nI2C\u30e9\u30a4\u30d6\u30e9\u30ea\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nI2C\u30e9\u30a4\u30d6\u30e9\u30ea\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo sudo apt-get install libi2c-dev\n\n\n\ngit\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\ngit\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo apt-get install git-core\n\n\n\n\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n\n\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n$ sudo apt-get update\n$ sudo apt-get upgrade\n\n\n\n\u30bb\u30f3\u30b5\u30fc\u30e2\u30b8\u30e5\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u78ba\u8a8d\n\u305f\u3076\u3093\u30010x77\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u30a2\u30c9\u30ec\u30b9\u78ba\u8a8d\n$ sudo i2cdetect -y 1\n     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f\n00:          -- -- -- -- -- -- -- -- -- -- -- -- -- \n10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- \n20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- \n30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- \n40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- \n50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- \n60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- \n70: -- -- -- -- -- -- -- 77\n\n\n\n\u30bb\u30f3\u30b5\u30fc\u30e2\u30b8\u30e5\u30fc\u30eb\u63a5\u7d9a\u78ba\u8a8d\n\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3067\u304d\u308b\u304b\u8a66\u3059\u305f\u3081\u3001id\u3092\u53d6\u5f97\u3057\u3066\u307f\u307e\u3059\u3002\n0x55\u304c\u8fd4\u3063\u3066\u304f\u308c\u3070\u6b63\u3057\u304f\u63a5\u7d9a\u3067\u304d\u3066\u3044\u307e\u3059\u3002\n\n\u63a5\u7d9a\u78ba\u8a8d\n$ sudo i2cget -y 1 0x77 0xD0 b\n0x55\n\n\n\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306f\u3001\u6e29\u5ea6\u3068\u6c17\u5727\u306e\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u7cbe\u5ea6\u30e2\u30fc\u30c9\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\nBMP180\u306f\u3001\u6271\u3044\u3084\u3059\u3044\u30bb\u30f3\u30b5\u30fc\u306e\u3088\u3046\u3067\u3059\u3002\nPython\u3067adafruit\u306e\u30c9\u30e9\u30a4\u30d0\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u65b9\u304c\u591a\u3044\u3088\u3046\u3067\u3057\u305f\u3002\n\u30bb\u30f3\u30b5\u30fc\u306e\u4f7f\u3044\u65b9\u3092\u52c9\u5f37\u3059\u308b\u305f\u3081\u3001\u8aac\u660e\u66f8\u3092\u8aad\u3093\u3067\u3001\u30e1\u30fc\u30ab\u30fc\u306e\u30c9\u30e9\u30a4\u30d0\u3068adafruit\u306e\u30c9\u30e9\u30a4\u30d0\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u8aad\u3093\u3067\u307f\u307e\u3057\u305f\u3002\nBMP085\u3068\u4e0b\u4f4d\u4e92\u63db\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u306e\u3067\u3001Raspbian\u306b\u5165\u3063\u3066\u3044\u308bbmp085\u306e\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u7c21\u5358\u306b\u52d5\u4f5c\u3059\u308b\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u8a66\u3057\u3066\u306a\u3044\u3067\u3059\u3002\n\u307e\u305a\u306f\u3001\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u6c17\u6e29\u306e\u5024\u304c\u53d6\u5f97\u3067\u304d\u308b\u304b\u6311\u6226\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u5b9f\u306f\u300116bit\u306esigned\u306e\u6271\u3044\u3067\u305d\u3046\u3068\u3046\u82e6\u52b4\u3057\u307e\u3057\u305f\u3002\n\u3042\u307e\u308a\u7dba\u9e97\u306a\u65b9\u6cd5\u3067\u306a\u3044\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u3002\n\u4f55\u304b\u826f\u3044\u8a08\u7b97\u65b9\u6cd5\u304c\u3042\u3063\u305f\u3089\u6559\u3048\u3066\u4e0b\u3055\u3044\u3002\n\nbmp180_test.sh\n#!/bin/bash\n\nAC5_MSB=$(sudo i2cget -y 1 0x77 0xB2 b)\nAC5_LSB=$(sudo i2cget -y 1 0x77 0xB3 b)\nAC5=$((AC5_MSB<<8|AC5_LSB))\n\nAC6_MSB=$(sudo i2cget -y 1 0x77 0xB4 b)\nAC6_LSB=$(sudo i2cget -y 1 0x77 0xB5 b)\nAC6=$((AC6_MSB<<8|AC6_LSB))\n\nMC_MSB=$(sudo i2cget -y 1 0x77 0xBC b)\nMC_LSB=(sudo i2cget -y 1 0x77 0xBD b)\nMC=$(printf \"0x%x\" $((MC_MSB<<8|MC_LSB)))\nif [ $(printf \"%d\" $MC) -gt 32767 ];then\n    MC=$((((MC^0xffff)+1)*-1))\nelse\n    MC=$(printf \"%d\" $MC)\nfi\n\nMD_MSB=$(sudo i2cget -y 1 0x77 0xBE b)\nMD_LSB=$(sudo i2cget -y 1 0x77 0xBF b)\nMD=$((MD_MSB<<8|MD_LSB))\n\nsudo i2cset -y 1 0x77 0xF4 0x2E b\nsleep 1\n\nUT_MSB=$(sudo i2cget -y 1 0x77 0xF6 b)\nUT_LSB=$(sudo i2cget -y 1 0x77 0xF7 b)\nUT=$((UT_MSB<<8|UT_LSB))\n\nX1=$((((UT-AC6)*AC5)>>15))\nX2=$(((MC<<11)/(X1+MD)))\nB5=$((X1+X2))\nTEMPERATURE=$(((B5+8)>>4))\n\nprintf \"Temprature: %.2f C\\n\" $(echo \"scale=2;$TEMPERATURE / 10.0\" | bc)\n\nexit 0\n\n\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306f\u3001WiringPi\u3068Bosch\u306e\u30c9\u30e9\u30a4\u30d0\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\u6c17\u306b\u306a\u308b\u3068\u3053\u308d\u3084\u9593\u9055\u3044\u306a\u3069\u3042\u308c\u3070\u30b3\u30e1\u30f3\u30c8\u3044\u305f\u3060\u3051\u308b\u3068\u52a9\u304b\u308a\u307e\u3059\u3002\n\n\u30c9\u30e9\u30a4\u30d0\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n$ cd\n$ git clone git://git.drogon.net/wiringPi\n$ cd wiringPi\n$ ./build\n$ cd ..\n$ git clone https://github.com/BoschSensortec/BMP180_driver.git\n$ cd BMP180_driver\n\n\n\nbmp180_sample.c\n#include <stdio.h>\n#include <unistd.h>\n#include <time.h>\n#include <wiringPi.h>\n#include <wiringPiI2C.h>\n#include \"bmp180.h\"\n\ns8 BMP180_I2C_bus_read(u8 dev_addr, u8 reg_addr, u8 *reg_data, u8 cnt);\ns8 BMP180_I2C_bus_write(u8 dev_addr, u8 reg_addr, u8 *reg_data, u8 cnt);\nvoid BMP180_delay_msek(u32 msek);\n\nint main(void)\n{\n    struct bmp180_t bmp180;\n\n    s32 com_rslt = E_BMP_COMM_RES;\n    u16 v_uncomp_temp_u16 = BMP180_INIT_VALUE;\n    u32 v_uncomp_press_u32 = BMP180_INIT_VALUE;\n\n    bmp180.bus_write = BMP180_I2C_bus_write;\n    bmp180.bus_read = BMP180_I2C_bus_read;\n    bmp180.dev_addr = BMP180_I2C_ADDR;\n    bmp180.delay_msec = BMP180_delay_msek;\n\n    com_rslt = bmp180_init(&bmp180);\n    if(com_rslt < 0) {\n        printf(\"error: Initialization failed\\n\");\n    }\n\n    bmp180.sw_oversamp = BMP180_SW_OVERSAMP_U8X;\n    bmp180.oversamp_setting = BMP180_OVERSAMP_SETTING_U8X;\n\n    v_uncomp_temp_u16 = bmp180_get_uncomp_temperature();\n    v_uncomp_press_u32 = bmp180_get_uncomp_pressure();\n\n    printf(\"temp: %.2f C\\n\", bmp180_get_temperature(v_uncomp_temp_u16) / 10.0);\n    printf(\"press: %.2f hPa\\n\", bmp180_get_pressure(v_uncomp_press_u32) / 100.0);\n\n    return 0;\n}\n\ns8 BMP180_I2C_bus_read(u8 dev_addr, u8 reg_addr, u8 *reg_data, u8 cnt)\n{\n    int fd;\n\n    s32 iError = BMP180_INIT_VALUE;\n    u8 stringpos = BMP180_INIT_VALUE;\n\n    fd = wiringPiI2CSetup(dev_addr);\n\n    for (stringpos = BMP180_INIT_VALUE; stringpos < cnt; stringpos++) {\n        *(reg_data + stringpos) = wiringPiI2CReadReg8(fd, reg_addr + stringpos);\n    }\n    return (s8)iError;\n}\n\ns8 BMP180_I2C_bus_write(u8 dev_addr, u8 reg_addr, u8 *reg_data, u8 cnt)\n{\n    int fd;\n\n    s32 iError = BMP180_INIT_VALUE;\n    u8 stringpos = BMP180_INIT_VALUE;\n\n    fd = wiringPiI2CSetup(dev_addr);\n\n    for (stringpos = BMP180_INIT_VALUE; stringpos < cnt; stringpos++) {\n        iError = wiringPiI2CWriteReg8(fd, reg_addr + stringpos, *(reg_data + stringpos));\n    }\n    return (s8)iError;\n}\n\nvoid BMP180_delay_msek(u32 msek)\n{\n    usleep(msek * 1000);\n}\n\n\n\n\u5b9f\u884c\n$ gcc -Wall -lwiringPi bmp180.c bmp180_sample.c -o bmp180_sample\n$ sudo ./bmp180_sample\ntemp: 15.10 C\npress: 1004.03 hPa\n\n\n\u4ee5\u4e0a\n## \u6982\u8981\nRaspberry pi 2 Model B (Raspbian)\u3067\u306e aitendo [M180-4P](http://www.aitendo.com/product/10760 \"M180-4P\")(BMP180\u4f7f\u7528 \u6c17\u5727\u30bb\u30f3\u30b5\u30e2\u30b8\u30e5\u30fc\u30eb) \u8a2d\u5b9a\u899a\u66f8\u304d\n\n---\n## \u53c2\u8003\n\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3001\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\n\n* [Bosch Datasheet\u2190\u8aac\u660e\u66f8](https://ae-bst.resource.bosch.com/media/_tech/media/datasheets/BST-BMP180-DS000-121.pdf \"Datasheet\")\n* [Bosch Driver](https://github.com/BoschSensortec/BMP180_driver \"Driver\")\n* [adafruit Driver](https://learn.adafruit.com/using-the-bmp085-with-raspberry-pi/using-the-adafruit-bmp-python-library)\n* [wiringPi](http://wiringpi.com)\n\n---\n## \u30bb\u30f3\u30b5\u30fc\u30e2\u30b8\u30e5\u30fc\u30eb\u63a5\u7d9a\n[\u3053\u3053](http://pi.gadgetoid.com/pinout/pin1_3v3_power \"Raspberry Pinout\")\u306e\u30d4\u30f3\u30a2\u30a6\u30c8\u8868\u3092\u53c2\u7167\u3057\u307e\u3057\u305f\u3002\u4eca\u56de\u306f\u30011,3,5,9\u30d4\u30f3\u3092\u4f7f\u7528\u3057\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n5V\u30c8\u30ec\u30e9\u30f3\u30c8\u306a\u306e\u3067\u30015V\u3067\u63a5\u7d9a\u3057\u305f\u307b\u3046\u304c\u5b89\u5b9a\u3059\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n3.3V\u3067\u4f7f\u3063\u3066\u307f\u3066\u69d8\u5b50\u3092\u307f\u307e\u3059\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/74786/d8c141d8-bcd0-bf76-cdf3-41a6b2ac63c5.png)\n\n## \u30bb\u30f3\u30b5\u30fc\u30e2\u30b8\u30e5\u30fc\u30eb\u8a2d\u5b9a\u60c5\u5831\n\u8aac\u660e\u66f8\u3092\u8aad\u3093\u3067\u307f\u307e\u3059\u3002\n\u3053\u306e\u30bb\u30f3\u30b5\u30fc\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30ec\u30b8\u30b9\u30bf\u69cb\u6210\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/74786/0d55e19e-7ec3-ef23-f36e-a56aafa6e194.png)\n\n* MSB(out_msb), LSB(out_lsb), XLSB(out_xlsb)\n\u6e2c\u5b9a\u30c7\u30fc\u30bf\u304c\u5165\u308a\u307e\u3059\u3002\n\u6e29\u5ea6(UT)\u306f\u300116\u30d3\u30c3\u30c8\u306b\u306a\u308a\u307e\u3059\u3002MSB\u3068LSB\u3092\u4f7f\u3044\u307e\u3059\u3002\n\u6c17\u5727(UP)\u306f\u3001\u30e2\u30fc\u30c9\u306b\u3088\u308a16\u30d3\u30c3\u30c8\u301c19\u30d3\u30c3\u30c8\u306b\u306a\u308a\u307e\u3059\u3002MSB, LSB, XLSB\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n* ctrl_meas\n![image](https://qiita-image-store.s3.amazonaws.com/0/74786/0c2527c5-265b-75f1-08d7-71a69e1eaa2d.png)\n\n\u3010oss(oversampling_setting)\u3011:\n2\u30d3\u30c3\u30c8\u3067\u3001\u6e29\u5ea6\u6e2c\u5b9a\u6642\u306f\u300100\u3002\u6c17\u5727\u6e2c\u5b9a\u6642\u306f\u3001\u3053\u3053\u306e\u8a2d\u5b9a\u3067\u30e2\u30fc\u30c9\u3092\u6c7a\u3081\u307e\u3059\u3002\n\uff14\u7a2e\u985e\u306e\u30e2\u30fc\u30c9\u3068\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u7684\u306b\u7cbe\u5ea6\u3092\u4e0a\u3052\u305f(\u8907\u6570\u56de\u8a08\u6e2c\u3057\u3066\u3044\u308b\u3060\u3051\u3067\u3059\u304c)1\u8a08\u6e2c\u6bce\u5185\u90e8\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u56de\u6570\u304c32\u56de\u306e\u30e2\u30fc\u30c9\u306e\uff15\u7a2e\u985e\u304c\u3042\u308a\u307e\u3059\u3002\n\u3010sco\u3011:\n1\u30d3\u30c3\u30c8\u3067\u30011\u306e\u9593\u306f\u3001\u8a08\u6e2c\u4e2d\u3067\u3059\u3002\u8a08\u6e2c\u304c\u5b8c\u4e86\u3059\u308b\u30680\u306b\u306a\u308a\u307e\u3059\u3002\n\u3010measurement\u3011:\n5\u30d3\u30c3\u30c8\u3067\u3001\u6e29\u5ea6\u6e2c\u5b9a\u306f\u3001\"01110\"\u3002\u6c17\u5727\u6e2c\u5b9a\u306f\u3001\"10100\"\u3067\u3059\u3002\n\n\u6e2c\u5b9a\u3057\u305f\u3044\u30e2\u30fc\u30c9\u306e\u8a2d\u5b9a\u5024\u30920xF4\u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u30ec\u30b8\u30b9\u30bf\u306b(\u4f8b\u3048\u3070\u3001\u6e29\u5ea6\u306a\u30890x2E)\u66f8\u304d\u8fbc\u307f\u3001\u5909\u63db\u6642\u9593\u5f85\u3063\u305f\u306e\u3061\u3001out_msb, out_lsb, out_xlsb\u304b\u3089\u8a08\u6e2c\u5024\u3092\u53d6\u5f97\u3059\u308c\u3070\u3088\u3044\u3088\u3046\u3067\u3059\u3002\n\n* soft(Soft reset)\n0xB6\u3092\u66f8\u304d\u8fbc\u3080\u3068\u96fb\u6e90\u30ea\u30bb\u30c3\u30c8\u3068\u540c\u69d8\u306e\u30b7\u30fc\u30b1\u30f3\u30b9\u3067\u30bd\u30d5\u30c8\u30ea\u30bb\u30c3\u30c8\u3055\u308c\u307e\u3059\u3002\n\n* id\n0x55(\u56fa\u5b9a\u5024)\u3067\u3059\u3002\u63a5\u7d9a\u78ba\u8a8d\u306a\u3069\u306b\u4f7f\u3044\u307e\u3059\u3002\n\n* calib21-calib0(\u88dc\u6b63\u5024)\n\u540416\u30d3\u30c3\u30c8\u306e11\u88dc\u6b63\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u3059\u3002AC4, AC5, AC6\u304cunsigned\u3067\u3001\u305d\u308c\u4ee5\u5916\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306f\u3001signed\u3067\u3059\u3002\n\u88dc\u6b63\u5024\u306f\u3001\u6c17\u6e29\u3001\u6c17\u5727\u3092\u8a08\u7b97\u3059\u308b\u969b\u3001\u4ee5\u4e0b\u306e\u8a08\u7b97\u5f0f\u3067\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u7d50\u69cb\u3001\u3081\u3093\u3069\u304f\u3055\u3044\u8a08\u7b97\u3067\u3059\u3002\u305d\u306e\u5206\u3001\u6b63\u78ba\u306a\u5024\u304c\u8a08\u6e2c\u3067\u304d\u308b\u306e\u304b\u306a\u3002\n\n\u3010\u88dc\u6b63\u5024 AC1, AC2, AC3, AC4, AC5, AC6, B1. B2, MB, MC, MD\u3011\n\u5404\u88dc\u6b63\u5024 = ((\u5404\u88dc\u6b63\u5024\u306eMSB << 8) | \u5404\u88dc\u6b63\u5024\u306eLSB);\n\n\u3010\u6c17\u6e29 t\u3011\nUT = ((MSB << 8) | LSB);\n\nX1 = ((UT - AC6) * AC5 >> 15);\nX2 = ((MC << 11) / (X1 + MD));\nB5 = (X1 + X2);\nt = ((B5 + 8) >> 4);\n\nt / 10.0 \u2103\n\n\u3010\u6c17\u5727 p\u3011\nUP = ((MSB << 16) | (LSB << 8) | XLSB) >> (8 - oss)\n\nB3\u306e\u8a08\u7b97\n\nB6 = (B5 - 4000);\nX1 = ((B6 * B6) >> 12);\nX1 = (X1 * B2);\nX1 = (X1 >> 11);\nX2 = (AC2 * B6);\nX2 = (X2 >> 11);\nX3 = (X1 + X2);\nB3 = (AC1 * 4 + X3);\nB3 = ((B3 << oss) + 2);\nB3 = (B3 >> 2);\n\nB4\u306e\u8a08\u7b97\n\nX1 = ((AC3 * B6) >> 13);\nX2 = ((B6 * B6) >> 12);\nX2 = ((B1 * X2) >> 16);\nX3 = ((X1 + X2) + 2) >> 2;\nB4 = (AC4 * (X3 + 32768)) >> 15;\n\np\u306e\u8a08\u7b97\n\nB7 = ((UP - B3) * (50000 >> oss));\nif (B7 < 0x80000000) {\n    p = (B7 << 1) / B4;\n} else {\n    p = (B7 / B4) << 1;\n}\nX1 = p >> 8;\nX1 *= X1;\nX1 = (X1 * 3038) >> 16;\nX2 = (p * -7357) >> 16;\np += (X1 + X2 + 3791) >> 4;\n\np / 100.0 hPa\n\n## \u30bb\u30f3\u30b5\u30fc\u30e2\u30b8\u30e5\u30fc\u30eb\u8a2d\u5b9a\u624b\u9806\n\n\n#### I2C\u6709\u52b9\n\n```bash:I2C\u6709\u52b9\n$ sudo raspi-config\n```\n\n\u300c8 Advanced Options\u300d \u2192 \u300cA7 SPI\u300d \u2192 \u300cI2C enable\u300d\n\n#### I2C\u30e2\u30b8\u30e5\u30fc\u30eb\u8a2d\u5b9a\n\n```bash:I2C\u30e2\u30b8\u30e5\u30fc\u30eb\u8aad\u307f\u8fbc\u307f\u8a2d\u5b9a\n$ sudo nano /etc/modules\n```\n\n```\nsnd-bcm2835\ni2c-dev\n```\n\n#### I2C\u30e9\u30a4\u30d6\u30e9\u30ea\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash:I2C\u30e9\u30a4\u30d6\u30e9\u30ea\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo sudo apt-get install libi2c-dev\n```\n\n#### git\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash:git\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo apt-get install git-core\n```\n\n#### \u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n\n```bash:\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n$ sudo apt-get update\n$ sudo apt-get upgrade\n```\n\n#### \u30bb\u30f3\u30b5\u30fc\u30e2\u30b8\u30e5\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u78ba\u8a8d\n\u305f\u3076\u3093\u30010x77\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\n```bash:\u30a2\u30c9\u30ec\u30b9\u78ba\u8a8d\n$ sudo i2cdetect -y 1\n     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f\n00:          -- -- -- -- -- -- -- -- -- -- -- -- -- \n10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- \n20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- \n30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- \n40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- \n50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- \n60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- \n70: -- -- -- -- -- -- -- 77\n```\n\n### \u30bb\u30f3\u30b5\u30fc\u30e2\u30b8\u30e5\u30fc\u30eb\u63a5\u7d9a\u78ba\u8a8d\n\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3067\u304d\u308b\u304b\u8a66\u3059\u305f\u3081\u3001id\u3092\u53d6\u5f97\u3057\u3066\u307f\u307e\u3059\u3002\n0x55\u304c\u8fd4\u3063\u3066\u304f\u308c\u3070\u6b63\u3057\u304f\u63a5\u7d9a\u3067\u304d\u3066\u3044\u307e\u3059\u3002\n\n```bash:\u63a5\u7d9a\u78ba\u8a8d\n$ sudo i2cget -y 1 0x77 0xD0 b\n0x55\n```\n\n#### \u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306f\u3001\u6e29\u5ea6\u3068\u6c17\u5727\u306e\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u7cbe\u5ea6\u30e2\u30fc\u30c9\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\nBMP180\u306f\u3001\u6271\u3044\u3084\u3059\u3044\u30bb\u30f3\u30b5\u30fc\u306e\u3088\u3046\u3067\u3059\u3002\nPython\u3067[adafruit\u306e\u30c9\u30e9\u30a4\u30d0](https://github.com/adafruit/Adafruit_Python_BMP)\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u65b9\u304c\u591a\u3044\u3088\u3046\u3067\u3057\u305f\u3002\n\u30bb\u30f3\u30b5\u30fc\u306e\u4f7f\u3044\u65b9\u3092\u52c9\u5f37\u3059\u308b\u305f\u3081\u3001\u8aac\u660e\u66f8\u3092\u8aad\u3093\u3067\u3001\u30e1\u30fc\u30ab\u30fc\u306e\u30c9\u30e9\u30a4\u30d0\u3068adafruit\u306e\u30c9\u30e9\u30a4\u30d0\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u8aad\u3093\u3067\u307f\u307e\u3057\u305f\u3002\n\nBMP085\u3068\u4e0b\u4f4d\u4e92\u63db\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u306e\u3067\u3001Raspbian\u306b\u5165\u3063\u3066\u3044\u308bbmp085\u306e\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u7c21\u5358\u306b\u52d5\u4f5c\u3059\u308b\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u8a66\u3057\u3066\u306a\u3044\u3067\u3059\u3002\n\n\u307e\u305a\u306f\u3001\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u6c17\u6e29\u306e\u5024\u304c\u53d6\u5f97\u3067\u304d\u308b\u304b\u6311\u6226\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u5b9f\u306f\u300116bit\u306esigned\u306e\u6271\u3044\u3067\u305d\u3046\u3068\u3046\u82e6\u52b4\u3057\u307e\u3057\u305f\u3002\n\u3042\u307e\u308a\u7dba\u9e97\u306a\u65b9\u6cd5\u3067\u306a\u3044\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u3002\n\u4f55\u304b\u826f\u3044\u8a08\u7b97\u65b9\u6cd5\u304c\u3042\u3063\u305f\u3089\u6559\u3048\u3066\u4e0b\u3055\u3044\u3002\n\n```bash:bmp180_test.sh\n#!/bin/bash\n\nAC5_MSB=$(sudo i2cget -y 1 0x77 0xB2 b)\nAC5_LSB=$(sudo i2cget -y 1 0x77 0xB3 b)\nAC5=$((AC5_MSB<<8|AC5_LSB))\n\nAC6_MSB=$(sudo i2cget -y 1 0x77 0xB4 b)\nAC6_LSB=$(sudo i2cget -y 1 0x77 0xB5 b)\nAC6=$((AC6_MSB<<8|AC6_LSB))\n\nMC_MSB=$(sudo i2cget -y 1 0x77 0xBC b)\nMC_LSB=(sudo i2cget -y 1 0x77 0xBD b)\nMC=$(printf \"0x%x\" $((MC_MSB<<8|MC_LSB)))\nif [ $(printf \"%d\" $MC) -gt 32767 ];then\n    MC=$((((MC^0xffff)+1)*-1))\nelse\n    MC=$(printf \"%d\" $MC)\nfi\n\nMD_MSB=$(sudo i2cget -y 1 0x77 0xBE b)\nMD_LSB=$(sudo i2cget -y 1 0x77 0xBF b)\nMD=$((MD_MSB<<8|MD_LSB))\n\nsudo i2cset -y 1 0x77 0xF4 0x2E b\nsleep 1\n\nUT_MSB=$(sudo i2cget -y 1 0x77 0xF6 b)\nUT_LSB=$(sudo i2cget -y 1 0x77 0xF7 b)\nUT=$((UT_MSB<<8|UT_LSB))\n\nX1=$((((UT-AC6)*AC5)>>15))\nX2=$(((MC<<11)/(X1+MD)))\nB5=$((X1+X2))\nTEMPERATURE=$(((B5+8)>>4))\n\nprintf \"Temprature: %.2f C\\n\" $(echo \"scale=2;$TEMPERATURE / 10.0\" | bc)\n\nexit 0\n```\n\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306f\u3001[WiringPi](https://git.drogon.net/?p=wiringPi;a=summary)\u3068[Bosch\u306e\u30c9\u30e9\u30a4\u30d0](https://github.com/BoschSensortec/BMP180_driver)\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u6c17\u306b\u306a\u308b\u3068\u3053\u308d\u3084\u9593\u9055\u3044\u306a\u3069\u3042\u308c\u3070\u30b3\u30e1\u30f3\u30c8\u3044\u305f\u3060\u3051\u308b\u3068\u52a9\u304b\u308a\u307e\u3059\u3002\n\n```bash:\u30c9\u30e9\u30a4\u30d0\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n$ cd\n$ git clone git://git.drogon.net/wiringPi\n$ cd wiringPi\n$ ./build\n$ cd ..\n$ git clone https://github.com/BoschSensortec/BMP180_driver.git\n$ cd BMP180_driver\n```\n\n```c:bmp180_sample.c\n#include <stdio.h>\n#include <unistd.h>\n#include <time.h>\n#include <wiringPi.h>\n#include <wiringPiI2C.h>\n#include \"bmp180.h\"\n\ns8 BMP180_I2C_bus_read(u8 dev_addr, u8 reg_addr, u8 *reg_data, u8 cnt);\ns8 BMP180_I2C_bus_write(u8 dev_addr, u8 reg_addr, u8 *reg_data, u8 cnt);\nvoid BMP180_delay_msek(u32 msek);\n\nint main(void)\n{\n\tstruct bmp180_t bmp180;\n\n\ts32 com_rslt = E_BMP_COMM_RES;\n\tu16 v_uncomp_temp_u16 = BMP180_INIT_VALUE;\n\tu32 v_uncomp_press_u32 = BMP180_INIT_VALUE;\n\n\tbmp180.bus_write = BMP180_I2C_bus_write;\n\tbmp180.bus_read = BMP180_I2C_bus_read;\n\tbmp180.dev_addr = BMP180_I2C_ADDR;\n\tbmp180.delay_msec = BMP180_delay_msek;\n\n\tcom_rslt = bmp180_init(&bmp180);\n\tif(com_rslt < 0) {\n\t\tprintf(\"error: Initialization failed\\n\");\n\t}\n\n\tbmp180.sw_oversamp = BMP180_SW_OVERSAMP_U8X;\n\tbmp180.oversamp_setting = BMP180_OVERSAMP_SETTING_U8X;\n\n\tv_uncomp_temp_u16 = bmp180_get_uncomp_temperature();\n\tv_uncomp_press_u32 = bmp180_get_uncomp_pressure();\n\n\tprintf(\"temp: %.2f C\\n\", bmp180_get_temperature(v_uncomp_temp_u16) / 10.0);\n\tprintf(\"press: %.2f hPa\\n\", bmp180_get_pressure(v_uncomp_press_u32) / 100.0);\n\n\treturn 0;\n}\n\ns8 BMP180_I2C_bus_read(u8 dev_addr, u8 reg_addr, u8 *reg_data, u8 cnt)\n{\n\tint fd;\n\n\ts32 iError = BMP180_INIT_VALUE;\n\tu8 stringpos = BMP180_INIT_VALUE;\n\n\tfd = wiringPiI2CSetup(dev_addr);\n\n\tfor (stringpos = BMP180_INIT_VALUE; stringpos < cnt; stringpos++) {\n\t\t*(reg_data + stringpos) = wiringPiI2CReadReg8(fd, reg_addr + stringpos);\n\t}\n\treturn (s8)iError;\n}\n\ns8 BMP180_I2C_bus_write(u8 dev_addr, u8 reg_addr, u8 *reg_data, u8 cnt)\n{\n\tint fd;\n\n\ts32 iError = BMP180_INIT_VALUE;\n\tu8 stringpos = BMP180_INIT_VALUE;\n\n\tfd = wiringPiI2CSetup(dev_addr);\n\n\tfor (stringpos = BMP180_INIT_VALUE; stringpos < cnt; stringpos++) {\n\t\tiError = wiringPiI2CWriteReg8(fd, reg_addr + stringpos, *(reg_data + stringpos));\n\t}\n\treturn (s8)iError;\n}\n\nvoid BMP180_delay_msek(u32 msek)\n{\n\tusleep(msek * 1000);\n}\n```\n\n```bash:\u5b9f\u884c\n$ gcc -Wall -lwiringPi bmp180.c bmp180_sample.c -o bmp180_sample\n$ sudo ./bmp180_sample\ntemp: 15.10 C\npress: 1004.03 hPa\n```\n\n\u4ee5\u4e0a\n"}