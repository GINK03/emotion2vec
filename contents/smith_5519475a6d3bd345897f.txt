{"context": " More than 1 year has passed since last update.\u30e1\u30e2\u3002\n\u6614\u3068\u6bd4\u3079\u308b\u3068\u5927\u5206\u697d\u306b\u306a\u3063\u305f\u6c17\u304c\u3059\u308b\u3002\n\u3044\u3044\u52a0\u6e1b\u3001\u8131PluginWrapper\u3057\u305f\u304b\u3063\u305f\u306e\u3067\u3001Android.mk\u3067\u76f4\u63a5plugin/protocols/\u3092\u53d6\u308a\u8fbc\u3080\u3088\u3046\u306b\u3057\u3066\u3001runOnUiThread\u306fAppActivity\u306e\u30b7\u30f3\u30b0\u30eb\u30c8\u30f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u5b9f\u884c\u3055\u305b\u308b\u3088\u3046\u306b\u5909\u66f4\u3057\u305f\u3002\n\n\u74b0\u5883\n\nMac OS 10.10.2\ncocos2d-x 3.4\nEclipse LUNA Service Release 1a (4.4.1)\nAndroid NDK r10d\nADT 23.0.6.1720515\nAndroid SDK 24.1.2\n\n\n\u4f9d\u5b58\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u53c2\u7167\u8ffd\u52a0\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8 > properties > Android\nLibrary\u306e\u9805\u76ee\u3067\u4e0b\u8a18\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u53c2\u7167\u3092\u8ffd\u52a0\u3002\n\nlibcocos2dx\ngoogle-play-service_lib(\u5e83\u544a\u8868\u793a\u3067\u4f7f\u3046)\n\n\nAndroid \u30b5\u30dd\u30fc\u30c8\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u8ffd\u52a0\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8 > Android Tools > Add Support Library...\n\nManifest\u306e\u8a2d\u5b9a\n\u4e0b\u8a18\u8a18\u8ff0\u3092\u8ffd\u52a0\u3002\n\u30fb\u5e83\u544a\u95a2\u9023\u30d6\u30ed\u30c3\u30af\u3068\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\n\u30fbandroid:minSdkVersion\u306e\u6307\u5b9a\n\u30fb\u30aa\u30ea\u30a8\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u6307\u5b9a\n\nant.properties\u306e\u7de8\u96c6\n\u9375\u306e\u8a2d\u5b9a\u3002\n\nand.properties\n+key.alias.password=my_fantastic_app_key\n+key.store.password=my_fantastic_app_key\n+key.store=/Users/Smith/keys/apk/my_fantastic_app/my_fantastic_app_key\n+key.alias=my_fantastic_app_key\n\n\n\u9375\u306e\u4f5c\u6210\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3002\nkeytool -genkey -v -keystore /Users/Smith/keys/apk/my_fantastic_app/my_fantastic_app_key -alias my_fantastic_app_key -keyalg RSA -validity 10000\n\n\nAndroid.mk\u306e\u7de8\u96c6\n\u4f7f\u7528\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u5fc5\u8981\u306ac++\u30d5\u30a1\u30a4\u30eb\u306e\u6ce8\u5165\u3002\n\u4eca\u56de\u306e\u30a2\u30d7\u30ea\u306f\u3053\u3093\u306a\u611f\u3058\u3002\nApplication.mk\u306e\u7de8\u96c6\u306f\u4e0d\u8981\u3060\u3063\u305f\u3002\n\nAndroid.mk\n-LOCAL_SRC_FILES := hellocpp/main.cpp \\\n-                   ../../Classes/AppDelegate.cpp \\\n-                   ../../Classes/HelloWorldScene.cpp\n+JNI_CPP_FILES             := $(shell find $(LOCAL_PATH) -name *.cpp)\n+APP_CPP_FILES             := $(shell find $(LOCAL_PATH)/../../Classes -name *.cpp)\n+PLUGIN_PROTOCOL_CPP_FILES := $(shell find $(LOCAL_PATH)/../../cocos2d/plugin/protocols -name *.cpp)\n\n-LOCAL_C_INCLUDES := $(LOCAL_PATH)/../../Classes\n+LOCAL_SRC_FILES := sqlite3.c\n+LOCAL_SRC_FILES += $(APP_CPP_FILES:$(LOCAL_PATH)/%=%)\n+LOCAL_SRC_FILES += $(JNI_CPP_FILES:$(LOCAL_PATH)/%=%)\n+LOCAL_SRC_FILES += $(PLUGIN_PROTOCOL_CPP_FILES:$(LOCAL_PATH)/%=%)\n+\n+LOCAL_C_INCLUDES := $(shell find $(LOCAL_PATH)/../../Classes -type d)\n+LOCAL_C_INCLUDES += $(shell find $(LOCAL_PATH) -type d)\n+LOCAL_C_INCLUDES += $(shell find $(LOCAL_PATH)/../../cocos2d/plugin/protocols -type d)\n\n # _COCOS_HEADER_ANDROID_BEGIN\n # _COCOS_HEADER_ANDROID_END\n\n\n LOCAL_STATIC_LIBRARIES := cocos2dx_static\n+LOCAL_STATIC_LIBRARIES += android_native_app_glue\n+LOCAL_WHOLE_STATIC_LIBRARIES += cocosdenshion_static\n+LOCAL_WHOLE_STATIC_LIBRARIES += cocos2d_network_static\n+LOCAL_WHOLE_STATIC_LIBRARIES += cocos2d_extension_static\n\n # _COCOS_LIB_ANDROID_BEGIN\n # _COCOS_LIB_ANDROID_END\n\n include $(BUILD_SHARED_LIBRARY)\n\n $(call import-module,.)\n+$(call import-module,android/native_app_glue)\n+$(call import-module,audio/android)\n+$(call import-module,network)\n+$(call import-module,extensions)\n\n\n\n\nmain.cpp\u306e\u7de8\u96c6\njni\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306bJavaVM\u3092\u6e21\u3057\u3066\u3042\u3052\u308b\u3002\n\nmain.cpp\n #include \"platform/android/jni/JniHelper.h\"\n #include <jni.h>\n #include <android/log.h>\n+#include \"PluginJniHelper.h\"\n\n #define  LOG_TAG    \"main\"\n #define  LOGD(...)  __android_log_print(ANDROID_LOG_DEBUG,LOG_TAG,__VA_ARGS__)\n\n using namespace cocos2d;\n\nvoid cocos_android_app_init (JNIEnv* env, jobject thiz) {\n    LOGD(\"cocos_android_app_init\");\n     AppDelegate *pAppDelegate = new AppDelegate();\n+\n+    JavaVM* vm;\n+    env->GetJavaVM(&vm);\n+    PluginJniHelper::setJavaVM(vm);\n }\n\n\n\nAppActivity.java\u306e\u7de8\u96c6\n\nAppActivity.java\n+import org.cocos2dx.lib.Cocos2dxGLSurfaceView;\n+import android.os.Bundle;\n+import android.widget.RelativeLayout;\n\npublic class AppActivity extends Cocos2dxActivity {\n+    // \u30e1\u30a4\u30f3\u30b9\u30ec\u30c3\u30c9 (runOnUiThread)\u306e\u51e6\u7406\u5b9f\u884c\u306b\u4f7f\u3046\n+    static AppActivity instance;\n+    // \u5e83\u544a\u3068\u304b\u306e\u7bb1\n+    RelativeLayout contentLayout;\n+    \n+    @Override protected void onCreate(final Bundle savedInstanceState)\n+    {\n+        super.onCreate(savedInstanceState);\n+        \n+        instance = this;\n+        contentLayout = new RelativeLayout(instance);\n+        instance.addContentView(contentLayout, new RelativeLayout.LayoutParams(RelativeLayout.LayoutParams.MATCH_PARENT, RelativeLayout.LayoutParams.MATCH_PARENT));\n+    }\n\n+    // ClippingNode\u3068\u304b\u3067\u5730\u5473\u306b\u52b9\u3044\u3066\u304f\u308b\u8a2d\u5b9a\n+    @Override public Cocos2dxGLSurfaceView onCreateView()\n+    {\n+        Cocos2dxGLSurfaceView glsView = super.onCreateView();\n+        glsView.setEGLConfigChooser(5, 6, 5, 0, 16, 8);\n+        \n+        return glsView;\n+    }\n}\n\n\n\n\u4ee5\u4e0a\u3002\n\u30e1\u30e2\u3002\n\u6614\u3068\u6bd4\u3079\u308b\u3068\u5927\u5206\u697d\u306b\u306a\u3063\u305f\u6c17\u304c\u3059\u308b\u3002\n\n\n\u3044\u3044\u52a0\u6e1b\u3001\u8131PluginWrapper\u3057\u305f\u304b\u3063\u305f\u306e\u3067\u3001Android.mk\u3067\u76f4\u63a5plugin/protocols/\u3092\u53d6\u308a\u8fbc\u3080\u3088\u3046\u306b\u3057\u3066\u3001runOnUiThread\u306fAppActivity\u306e\u30b7\u30f3\u30b0\u30eb\u30c8\u30f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u5b9f\u884c\u3055\u305b\u308b\u3088\u3046\u306b\u5909\u66f4\u3057\u305f\u3002\n\n\n# \u74b0\u5883\n\n* Mac OS 10.10.2\n* cocos2d-x 3.4\n* Eclipse LUNA Service Release 1a (4.4.1)\n* Android NDK r10d\n* ADT 23.0.6.1720515\n* Android SDK 24.1.2\n\n\n## \u4f9d\u5b58\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u53c2\u7167\u8ffd\u52a0\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8 > properties > Android\nLibrary\u306e\u9805\u76ee\u3067\u4e0b\u8a18\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u53c2\u7167\u3092\u8ffd\u52a0\u3002\n\n* libcocos2dx\n* google-play-service_lib(\u5e83\u544a\u8868\u793a\u3067\u4f7f\u3046)\n\n\n## Android \u30b5\u30dd\u30fc\u30c8\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u8ffd\u52a0\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8 > Android Tools > Add Support Library...\n\n\n## Manifest\u306e\u8a2d\u5b9a\n\n\u4e0b\u8a18\u8a18\u8ff0\u3092\u8ffd\u52a0\u3002\n\n\u30fb\u5e83\u544a\u95a2\u9023\u30d6\u30ed\u30c3\u30af\u3068\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\n\u30fbandroid:minSdkVersion\u306e\u6307\u5b9a\n\u30fb\u30aa\u30ea\u30a8\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u6307\u5b9a\n\n\n## ant.properties\u306e\u7de8\u96c6\n\n\u9375\u306e\u8a2d\u5b9a\u3002\n\n```and.properties\n+key.alias.password=my_fantastic_app_key\n+key.store.password=my_fantastic_app_key\n+key.store=/Users/Smith/keys/apk/my_fantastic_app/my_fantastic_app_key\n+key.alias=my_fantastic_app_key\n```\n\n\u9375\u306e\u4f5c\u6210\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3002\n\n```\nkeytool -genkey -v -keystore /Users/Smith/keys/apk/my_fantastic_app/my_fantastic_app_key -alias my_fantastic_app_key -keyalg RSA -validity 10000\n```\n\n## Android.mk\u306e\u7de8\u96c6\n\n\u4f7f\u7528\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u5fc5\u8981\u306ac++\u30d5\u30a1\u30a4\u30eb\u306e\u6ce8\u5165\u3002\n\u4eca\u56de\u306e\u30a2\u30d7\u30ea\u306f\u3053\u3093\u306a\u611f\u3058\u3002\nApplication.mk\u306e\u7de8\u96c6\u306f\u4e0d\u8981\u3060\u3063\u305f\u3002\n\n```Android.mk\n-LOCAL_SRC_FILES := hellocpp/main.cpp \\\n-                   ../../Classes/AppDelegate.cpp \\\n-                   ../../Classes/HelloWorldScene.cpp\n+JNI_CPP_FILES             := $(shell find $(LOCAL_PATH) -name *.cpp)\n+APP_CPP_FILES             := $(shell find $(LOCAL_PATH)/../../Classes -name *.cpp)\n+PLUGIN_PROTOCOL_CPP_FILES := $(shell find $(LOCAL_PATH)/../../cocos2d/plugin/protocols -name *.cpp)\n \n-LOCAL_C_INCLUDES := $(LOCAL_PATH)/../../Classes\n+LOCAL_SRC_FILES := sqlite3.c\n+LOCAL_SRC_FILES += $(APP_CPP_FILES:$(LOCAL_PATH)/%=%)\n+LOCAL_SRC_FILES += $(JNI_CPP_FILES:$(LOCAL_PATH)/%=%)\n+LOCAL_SRC_FILES += $(PLUGIN_PROTOCOL_CPP_FILES:$(LOCAL_PATH)/%=%)\n+\n+LOCAL_C_INCLUDES := $(shell find $(LOCAL_PATH)/../../Classes -type d)\n+LOCAL_C_INCLUDES += $(shell find $(LOCAL_PATH) -type d)\n+LOCAL_C_INCLUDES += $(shell find $(LOCAL_PATH)/../../cocos2d/plugin/protocols -type d)\n \n # _COCOS_HEADER_ANDROID_BEGIN\n # _COCOS_HEADER_ANDROID_END\n \n \n LOCAL_STATIC_LIBRARIES := cocos2dx_static\n+LOCAL_STATIC_LIBRARIES += android_native_app_glue\n+LOCAL_WHOLE_STATIC_LIBRARIES += cocosdenshion_static\n+LOCAL_WHOLE_STATIC_LIBRARIES += cocos2d_network_static\n+LOCAL_WHOLE_STATIC_LIBRARIES += cocos2d_extension_static\n \n # _COCOS_LIB_ANDROID_BEGIN\n # _COCOS_LIB_ANDROID_END\n \n include $(BUILD_SHARED_LIBRARY)\n \n $(call import-module,.)\n+$(call import-module,android/native_app_glue)\n+$(call import-module,audio/android)\n+$(call import-module,network)\n+$(call import-module,extensions)\n \n```\n\n## main.cpp\u306e\u7de8\u96c6\n\njni\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306bJavaVM\u3092\u6e21\u3057\u3066\u3042\u3052\u308b\u3002\n\n```main.cpp\n #include \"platform/android/jni/JniHelper.h\"\n #include <jni.h>\n #include <android/log.h>\n+#include \"PluginJniHelper.h\"\n \n #define  LOG_TAG    \"main\"\n #define  LOGD(...)  __android_log_print(ANDROID_LOG_DEBUG,LOG_TAG,__VA_ARGS__)\n \n using namespace cocos2d;\n \nvoid cocos_android_app_init (JNIEnv* env, jobject thiz) {\n    LOGD(\"cocos_android_app_init\");\n     AppDelegate *pAppDelegate = new AppDelegate();\n+\n+    JavaVM* vm;\n+    env->GetJavaVM(&vm);\n+    PluginJniHelper::setJavaVM(vm);\n }\n```\n\n## AppActivity.java\u306e\u7de8\u96c6\n\n```AppActivity.java\n+import org.cocos2dx.lib.Cocos2dxGLSurfaceView;\n+import android.os.Bundle;\n+import android.widget.RelativeLayout;\n\npublic class AppActivity extends Cocos2dxActivity {\n+    // \u30e1\u30a4\u30f3\u30b9\u30ec\u30c3\u30c9 (runOnUiThread)\u306e\u51e6\u7406\u5b9f\u884c\u306b\u4f7f\u3046\n+    static AppActivity instance;\n+    // \u5e83\u544a\u3068\u304b\u306e\u7bb1\n+    RelativeLayout contentLayout;\n+    \n+    @Override protected void onCreate(final Bundle savedInstanceState)\n+    {\n+        super.onCreate(savedInstanceState);\n+        \n+        instance = this;\n+        contentLayout = new RelativeLayout(instance);\n+        instance.addContentView(contentLayout, new RelativeLayout.LayoutParams(RelativeLayout.LayoutParams.MATCH_PARENT, RelativeLayout.LayoutParams.MATCH_PARENT));\n+    }\n\n+    // ClippingNode\u3068\u304b\u3067\u5730\u5473\u306b\u52b9\u3044\u3066\u304f\u308b\u8a2d\u5b9a\n+    @Override public Cocos2dxGLSurfaceView onCreateView()\n+    {\n+        Cocos2dxGLSurfaceView glsView = super.onCreateView();\n+        glsView.setEGLConfigChooser(5, 6, 5, 0, 16, 8);\n+        \n+        return glsView;\n+    }\n}\n```\n\n----\n\n\u4ee5\u4e0a\u3002\n", "tags": ["cocos2d-x3.4"]}