{"context": "\u5f15\u304d\u7d9a\u304d3\u53f0\u306emanager,1\u53f0\u306eworker\u69cb\u6210\u3067\u30b5\u30fc\u30d3\u30b9\u306e\u52d5\u4f5c\u3092\u8272\u3005\u3068\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\nswarm\u304b\u3089\u306e\u30ce\u30fc\u30c9\u306e\u96e2\u8131\u3068\u518d\u53c2\u52a0\nswarm leave\u3068 swarm join\u3067\u518d\u53c2\u52a0\u306f\u7c21\u5358\u306b\u51fa\u6765\u308b\u3088\u3046\u306b\u601d\u3048\u305f\u306e\u3067\u3059\u304c\u3001\u3061\u3087\u3063\u3068\u7656\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n\n\u624b\u9806\n\u3069\u3046\u3084\u3089\u3001swarm leave\u5f8c\u3001node rm\u3059\u308b\u524d\u306b\u96e2\u8131\u3059\u308b\u30ce\u30fc\u30c9\u3092\u964d\u683c\u3055\u305b\u3066\u3001\u524a\u9664\u3059\u308b\u3053\u3068\u3067\u3046\u307e\u304f\u3044\u304f\u3088\u3046\u3067\u3059\u3002\n\u518d\u5ea6\u3001manager03\u3092Leader\u3068\u3057\u3066swarm\u30af\u30e9\u30b9\u30bf\u3092\u518d\u69cb\u6210\u3057\u3066\u3042\u308a\u307e\u3059\u3002\n[root@manager03 ~]# docker node ls\nID                           HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS\nogd4rkazb2lybpe1zn0xtkj4o    manager01  Ready   Active        Reachable\nox88mvbml4rivgqr5f19axxga *  manager03  Ready   Active        Leader\nr5gparo8g0yshkdvv92fkbmkh    manager02  Ready   Active        Reachable\ny7cizbam1262otnul48ru1lr9    worker01   Ready   Active        \n\nmanager01\u3092\u96e2\u8131\u3057\u3066\u307f\u307e\u3059\u3002\n[root@manager01 ~]# docker swarm leave -f\nNode left the swarm.\n\n[root@manager03 ~]# docker node ls\nID                           HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS\nogd4rkazb2lybpe1zn0xtkj4o    manager01  Ready   Active        Reachable\nox88mvbml4rivgqr5f19axxga *  manager03  Ready   Active        Leader\nr5gparo8g0yshkdvv92fkbmkh    manager02  Ready   Active        Reachable\ny7cizbam1262otnul48ru1lr9    worker01   Ready   Active        \n\n\nmanager01\u304cSTATUS:Down\u306b\u306a\u3063\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n[root@manager01 ~]# systemctl stop docker\n\n[root@manager03 ~]# docker node ls\nID                           HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS\nogd4rkazb2lybpe1zn0xtkj4o    manager01  Down    Active        Unreachable\nox88mvbml4rivgqr5f19axxga *  manager03  Ready   Active        Leader\nr5gparo8g0yshkdvv92fkbmkh    manager02  Ready   Active        Reachable\ny7cizbam1262otnul48ru1lr9    worker01   Ready   Active        \n\n\nmanager01\u3092swarm\u304b\u3089\u524a\u9664\u3057\u3066\u307f\u307e\u3059\u3002\n[root@manager03 ~]# docker node rm manager01\nError response from daemon: rpc error: code = 9 desc = node ogd4rkazb2lybpe1zn0xtkj4o is a cluster manager and is a member of the raft cluster. It must be demoted to worker before removal\n\n\u3069\u3046\u3084\u3089\u4e00\u65e6manager\u304b\u3089worker\u306b\u843d\u3068\u3059\u5fc5\u8981(demote)\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n[root@manager03 ~]# docker node demote manager01\nManager manager01 demoted in the swarm.\n\n\u518d\u5ea6\u3001manager01\u3092swarm\u304b\u3089\u524a\u9664\u3057\u3066\u307f\u307e\u3059\u3002\n[root@manager03 ~]# docker node rm manager01\nmanager01\n[root@manager03 ~]# docker node ls\nID                           HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS\nox88mvbml4rivgqr5f19axxga *  manager03  Ready   Active        Leader\nr5gparo8g0yshkdvv92fkbmkh    manager02  Ready   Active        Reachable\ny7cizbam1262otnul48ru1lr9    worker01   Ready   Active        \n[root@manager03 ~]# \n\n\u3046\u307e\u304f\u524a\u9664\u51fa\u6765\u305f\u3088\u3046\u306a\u306e\u3067\u3001manager01\u3092\u53c2\u52a0\u3055\u305b\u3066\u307f\u307e\u3059\u3002\n[root@manager01 ~]# docker swarm join     --token SWMTKN-1-2k6u94nmlevsdrmnddtfhufmmvkvz4czcygvqtriwqyk8amb4g-euetuv4hbx2js7kz6cynjle2l     192.168.28.182:2377\nThis node joined a swarm as a worker.\n\n\n[root@manager03 ~]# docker node ls\nID                           HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS\nox88mvbml4rivgqr5f19axxga *  manager03  Ready   Active        Leader\nr5gparo8g0yshkdvv92fkbmkh    manager02  Ready   Active        Reachable\ny7cizbam1262otnul48ru1lr9    worker01   Ready   Active        \nyotxwu2zked5wtn49yrx4psy2    manager01  Ready   Active        \n\n\u6700\u5f8c\u306bmanager01\u3092promote\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n[root@manager03 ~]# docker node promote manager01\nNode manager01 promoted to a manager in the swarm.\n[root@manager03 ~]# docker node ls\nID                           HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS\nox88mvbml4rivgqr5f19axxga *  manager03  Ready   Active        Leader\nr5gparo8g0yshkdvv92fkbmkh    manager02  Ready   Active        Reachable\ny7cizbam1262otnul48ru1lr9    worker01   Ready   Active        \nyotxwu2zked5wtn49yrx4psy2    manager01  Ready   Active        Reachable\n\n\u3069\u3046\u3084\u3089\u3001manager01\u3092\u7dba\u9e97\u306b\u518d\u5ea6swarm\u306b\u518d\u53c2\u52a0\u3067\u304d\u305f\u3088\u3046\u3067\u3059\u3002\n\u4ee5\u4e0b\u306emanager\u306eswarm\u3078\u306e\u96e2\u8131\u3001\u53c2\u52a0\u3067\u306f\u624b\u9806\u304c\u5fc5\u8981\u306a\u3088\u3046\u3067\u3059\u3002\n\n\u96e2\u8131(swarm leave -f)\u3059\u308b\n\u96e2\u8131\u3057\u305f\u30ce\u30fc\u30c9\u3092swarm\u5185\u306emanager\u30ce\u30fc\u30c9\u3067\u3001worker\u306b\u964d\u683c(node demote)\u3059\u308b\n\u96e2\u8131\u3057\u305f\u30ce\u30fc\u30c9\u304cDOWN\u30b9\u30c6\u30fc\u30bf\u30b9\u306b\u306a\u308b\u307e\u3067\u5f85\u3064\n\u96e2\u8131\u3057\u305f\u30ce\u30fc\u30c9\u3092swarm\u5185\u306emanager\u30ce\u30fc\u30c9\u3067\u3001swarm\u304b\u3089\u524a\u9664(node rm)\u3059\u308b \n\u96e2\u8131\u3057\u305f\u30ce\u30fc\u30c9\u3067\u3001swarm\u306b\u518d\u53c2\u52a0\u3059\u308b\nswarm\u5185\u306emanager\u30ce\u30fc\u30c9\u3067\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u518d\u53c2\u52a0\u3057\u305f\u30ce\u30fc\u30c9\u3092manager\u306b\u6607\u683c(ndoe promote)\u3059\u308b\n\n\nhttps://docs.docker.com/engine/swarm/manage-nodes/\nhttps://docs.docker.com/engine/swarm/join-nodes/\n\n\u4ee5\u4e0a\u3067\u3059\u3002\n\u5f15\u304d\u7d9a\u304d3\u53f0\u306emanager,1\u53f0\u306eworker\u69cb\u6210\u3067\u30b5\u30fc\u30d3\u30b9\u306e\u52d5\u4f5c\u3092\u8272\u3005\u3068\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n# swarm\u304b\u3089\u306e\u30ce\u30fc\u30c9\u306e\u96e2\u8131\u3068\u518d\u53c2\u52a0\nswarm leave\u3068 swarm join\u3067\u518d\u53c2\u52a0\u306f\u7c21\u5358\u306b\u51fa\u6765\u308b\u3088\u3046\u306b\u601d\u3048\u305f\u306e\u3067\u3059\u304c\u3001\u3061\u3087\u3063\u3068\u7656\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n\n#\u624b\u9806\n\u3069\u3046\u3084\u3089\u3001swarm leave\u5f8c\u3001node rm\u3059\u308b\u524d\u306b\u96e2\u8131\u3059\u308b\u30ce\u30fc\u30c9\u3092\u964d\u683c\u3055\u305b\u3066\u3001\u524a\u9664\u3059\u308b\u3053\u3068\u3067\u3046\u307e\u304f\u3044\u304f\u3088\u3046\u3067\u3059\u3002\n\n\u518d\u5ea6\u3001manager03\u3092Leader\u3068\u3057\u3066swarm\u30af\u30e9\u30b9\u30bf\u3092\u518d\u69cb\u6210\u3057\u3066\u3042\u308a\u307e\u3059\u3002\n\n```\n[root@manager03 ~]# docker node ls\nID                           HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS\nogd4rkazb2lybpe1zn0xtkj4o    manager01  Ready   Active        Reachable\nox88mvbml4rivgqr5f19axxga *  manager03  Ready   Active        Leader\nr5gparo8g0yshkdvv92fkbmkh    manager02  Ready   Active        Reachable\ny7cizbam1262otnul48ru1lr9    worker01   Ready   Active        \n```\n\nmanager01\u3092\u96e2\u8131\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\n[root@manager01 ~]# docker swarm leave -f\nNode left the swarm.\n\n[root@manager03 ~]# docker node ls\nID                           HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS\nogd4rkazb2lybpe1zn0xtkj4o    manager01  Ready   Active        Reachable\nox88mvbml4rivgqr5f19axxga *  manager03  Ready   Active        Leader\nr5gparo8g0yshkdvv92fkbmkh    manager02  Ready   Active        Reachable\ny7cizbam1262otnul48ru1lr9    worker01   Ready   Active        \n\n```\n\nmanager01\u304cSTATUS:Down\u306b\u306a\u3063\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\n[root@manager01 ~]# systemctl stop docker\n\n[root@manager03 ~]# docker node ls\nID                           HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS\nogd4rkazb2lybpe1zn0xtkj4o    manager01  Down    Active        Unreachable\nox88mvbml4rivgqr5f19axxga *  manager03  Ready   Active        Leader\nr5gparo8g0yshkdvv92fkbmkh    manager02  Ready   Active        Reachable\ny7cizbam1262otnul48ru1lr9    worker01   Ready   Active        \n\n```\n\nmanager01\u3092swarm\u304b\u3089\u524a\u9664\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\n[root@manager03 ~]# docker node rm manager01\nError response from daemon: rpc error: code = 9 desc = node ogd4rkazb2lybpe1zn0xtkj4o is a cluster manager and is a member of the raft cluster. It must be demoted to worker before removal\n```\n\n\u3069\u3046\u3084\u3089\u4e00\u65e6manager\u304b\u3089worker\u306b\u843d\u3068\u3059\u5fc5\u8981(demote)\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n\n```\n[root@manager03 ~]# docker node demote manager01\nManager manager01 demoted in the swarm.\n```\n\n\u518d\u5ea6\u3001manager01\u3092swarm\u304b\u3089\u524a\u9664\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\n[root@manager03 ~]# docker node rm manager01\nmanager01\n[root@manager03 ~]# docker node ls\nID                           HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS\nox88mvbml4rivgqr5f19axxga *  manager03  Ready   Active        Leader\nr5gparo8g0yshkdvv92fkbmkh    manager02  Ready   Active        Reachable\ny7cizbam1262otnul48ru1lr9    worker01   Ready   Active        \n[root@manager03 ~]# \n```\n\n\u3046\u307e\u304f\u524a\u9664\u51fa\u6765\u305f\u3088\u3046\u306a\u306e\u3067\u3001manager01\u3092\u53c2\u52a0\u3055\u305b\u3066\u307f\u307e\u3059\u3002\n\n```\n[root@manager01 ~]# docker swarm join     --token SWMTKN-1-2k6u94nmlevsdrmnddtfhufmmvkvz4czcygvqtriwqyk8amb4g-euetuv4hbx2js7kz6cynjle2l     192.168.28.182:2377\nThis node joined a swarm as a worker.\n\n     \n[root@manager03 ~]# docker node ls\nID                           HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS\nox88mvbml4rivgqr5f19axxga *  manager03  Ready   Active        Leader\nr5gparo8g0yshkdvv92fkbmkh    manager02  Ready   Active        Reachable\ny7cizbam1262otnul48ru1lr9    worker01   Ready   Active        \nyotxwu2zked5wtn49yrx4psy2    manager01  Ready   Active        \n```\n\n\u6700\u5f8c\u306bmanager01\u3092promote\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n[root@manager03 ~]# docker node promote manager01\nNode manager01 promoted to a manager in the swarm.\n[root@manager03 ~]# docker node ls\nID                           HOSTNAME   STATUS  AVAILABILITY  MANAGER STATUS\nox88mvbml4rivgqr5f19axxga *  manager03  Ready   Active        Leader\nr5gparo8g0yshkdvv92fkbmkh    manager02  Ready   Active        Reachable\ny7cizbam1262otnul48ru1lr9    worker01   Ready   Active        \nyotxwu2zked5wtn49yrx4psy2    manager01  Ready   Active        Reachable\n```\n\n\u3069\u3046\u3084\u3089\u3001manager01\u3092\u7dba\u9e97\u306b\u518d\u5ea6swarm\u306b\u518d\u53c2\u52a0\u3067\u304d\u305f\u3088\u3046\u3067\u3059\u3002\n\n\u4ee5\u4e0b\u306emanager\u306eswarm\u3078\u306e\u96e2\u8131\u3001\u53c2\u52a0\u3067\u306f\u624b\u9806\u304c\u5fc5\u8981\u306a\u3088\u3046\u3067\u3059\u3002\n\n1. \u96e2\u8131(swarm leave -f)\u3059\u308b\n2. \u96e2\u8131\u3057\u305f\u30ce\u30fc\u30c9\u3092swarm\u5185\u306emanager\u30ce\u30fc\u30c9\u3067\u3001worker\u306b\u964d\u683c(node demote)\u3059\u308b\n3. \u96e2\u8131\u3057\u305f\u30ce\u30fc\u30c9\u304cDOWN\u30b9\u30c6\u30fc\u30bf\u30b9\u306b\u306a\u308b\u307e\u3067\u5f85\u3064\n3. \u96e2\u8131\u3057\u305f\u30ce\u30fc\u30c9\u3092swarm\u5185\u306emanager\u30ce\u30fc\u30c9\u3067\u3001swarm\u304b\u3089\u524a\u9664(node rm)\u3059\u308b \n5. \u96e2\u8131\u3057\u305f\u30ce\u30fc\u30c9\u3067\u3001swarm\u306b\u518d\u53c2\u52a0\u3059\u308b\n5. swarm\u5185\u306emanager\u30ce\u30fc\u30c9\u3067\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u518d\u53c2\u52a0\u3057\u305f\u30ce\u30fc\u30c9\u3092manager\u306b\u6607\u683c(ndoe promote)\u3059\u308b\n\n - https://docs.docker.com/engine/swarm/manage-nodes/\n - https://docs.docker.com/engine/swarm/join-nodes/\n\n\u4ee5\u4e0a\u3067\u3059\u3002\n", "tags": ["docker", "swarm"]}