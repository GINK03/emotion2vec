{"context": " More than 1 year has passed since last update.\u305d\u306e1\u306f\u3053\u3061\u3089\n\n\u30b5\u30fc\u30d3\u30b9\u6982\u8981\n\u9060\u304f\u306e\u5834\u6240\u3092\u3001\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b360\u5ea6\u4f53\u9a13\u3067\u304d\u308b\u30b5\u30fc\u30d3\u30b9\u3092\u306a\u308b\u3079\u304f\u7c21\u5358\u306b\u4f5c\u308a\u307e\u3059\u3002\n\n\u30b4\u30fc\u30eb\u30a4\u30e1\u30fc\u30b8\n\n\u4f5c\u6210\u3057\u305f\u30a2\u30d7\u30ea\u306e\u5165\u3063\u305fiPhone\u3068THETA\u3092\u6301\u3063\u3066\u65c5\u306b\u3067\u308b\n\u5bb6\u3067\u5f85\u3063\u3066\u3044\u308b\u4eba\u304c\u3001\u65c5\u5148\u306e\u98a8\u666f\u3092Oculus\u3067\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b360\u00b0\u4f53\u9a13\u3067\u304d\u308b\n\n\n\u4f7f\u3063\u305f\u3082\u306e\n\nHardware\n\nTHETA m15\nOculus Rift DK2\niPhone 6\nMacBook Air (13-inch, Mid 2012)\n\n\nSoftware\n\nRuby 2.1.5\nRails 4.1.8\nUnity \nXcode 6.1\n\n\n\u30b5\u30fc\u30d3\u30b9\u5168\u4f53\u50cf\n\n\niOS App \u7de8\n\n\u4eca\u56de\u306f (1)iOS App \u90e8\u5206\u3092\u3064\u304f\u308a\u307e\u3059\u3002\n\n\n\u524d\u63d0\u6761\u4ef6\n\n\u305d\u306e1\u304c\u3067\u304d\u3066\u308b\u3053\u3068\nXCode 6.1\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3001Mac\u304c\u3042\u308b\u3053\u3068\n\n\niPhone\u5b9f\u6a5f\u3067\u5b9f\u884c\u3067\u304d\u308b\u74b0\u5883\u304c\u306a\u3044\u3068\u5bc2\u3057\u3044\u3067\u3059\n\n\nRICOH THETA \u304c\u3042\u308b\u3053\u3068\n\n\nRICOH THETA SDK\u306e\u6e96\u5099\nhttps://developers.theta360.com/ja/docs/sdk/download.html \u304b\u3089 RICOH_THETA_SDK_for_iOS.0.2.1.zip \u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u4efb\u610f\u306e\u5834\u6240\u306b\u89e3\u51cd\u3057\u307e\u3059\u3002\uff08\u958b\u767a\u8005\u767b\u9332\u304c\u5fc5\u8981\u3067\u3059\u3002\uff09\nricoh-theta-sample-for-ios.xcodeproj \u3092\u958b\u3044\u3066\u3001Xcode\u304b\u3089\u5b9f\u6a5f\u3067\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\nTHETA\u3068\u63a5\u7d9a\u3057\u3066\u3001\u63a5\u7d9a\u3001\u4e00\u89a7\u306e\u53d6\u5f97\u30fb\u8868\u793a\u3001\u5199\u771f\u306e\u5f15\u53d6\u7b49\u304c\u52d5\u4f5c\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n\u4f5c\u6210\u3059\u308b\u30a2\u30d7\u30ea\u306e\u8aac\u660e\n\u753b\u9762\u306fSDK\u4ed8\u5c5e\u306e\u30b5\u30f3\u30d7\u30eb\u30a2\u30d7\u30ea\u3092\u305d\u306e\u307e\u307e\u5229\u7528\u3057\u307e\u3059\u3002\n\u5909\u66f4\u3059\u308b\u306e\u306f ViewController.m \u306e\u307f\u3067\u3059\u3002\n\u5b9f\u73fe\u3059\u308b\u30b7\u30fc\u30b1\u30f3\u30b9\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3067\u3059\u3002\n\nConnect\u3092\u30bf\u30c3\u30d7\u3057\u3001\u63a5\u7d9a\u3059\u308b\u3002\u3053\u306e\u6642\u3001\u4e00\u89a7\u306e\u53d6\u5f97\u306f\u884c\u308f\u306a\u3044\u3088\u3046\u306b\u3057\u307e\u3059\u3002\nCapture\u3092\u30bf\u30c3\u30d7\u3057\u3001\u30a4\u30f3\u30bf\u30fc\u30d0\u30eb\u64ae\u5f71\u3092\u958b\u59cb\u3059\u308b\u3002\n\u5199\u771f\u304c\u64ae\u5f71\u3055\u308c\u305f\u3089\u3001\u753b\u50cf\u306e\u5f15\u53d6\u3092\u81ea\u52d5\u3067\u884c\u3046\n\u5f15\u53d6\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001\u305d\u306e\u307e\u307eAPI\u3078\u753b\u50cf\u306e\u6295\u7a3f\u3092\u884c\u3046\n3,4\u3092\u64ae\u5f71\u304c\u505c\u6b62\u3059\u308b\u307e\u3067\u7e70\u308a\u8fd4\u3059\n\n\n1.\u63a5\u7d9a\u51e6\u7406\nConnect\u30bf\u30c3\u30d7\u5f8c\u306e\u51e6\u7406\u3067\u306f\u3001\u4e00\u89a7\u306e\u8868\u793a\u3092\u306a\u304f\u3057\u307e\u3059\u3002\n- (void)connect\n{\n  ...\n\n  // Start enum objects.\n  // [self enumObjects]; <- \u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3059\u308b\n\n\n\n2.\u30a4\u30f3\u30bf\u30fc\u30d0\u30eb\u64ae\u5f71\u306e\u958b\u59cb\nCapture\u30bf\u30c3\u30d7\u5f8c\u306e\u51e6\u7406\u3067\u306f\u3001\u30a4\u30f3\u30bf\u30fc\u30d0\u30eb\u64ae\u5f71\u306e\u958b\u59cb\u3092\u3057\u307e\u3059\u3002\n\u64ae\u5f71\u679a\u6570\u306e\u6307\u5b9a\u306f\u306a\u3057\u306b\u3057\u3066\u3001THETA\u306e\u7a7a\u304d\u3068\u30d0\u30c3\u30c6\u30ea\u30fc\u304c\u3042\u308b\u9650\u308a\u64ae\u5f71\u3055\u305b\u307e\u3059\u3002\n\u64ae\u5f71\u9593\u9694\u306f15\u79d2\u306b1\u679a\u306b\u3057\u307e\u3059\u3002iPhone\u306e\u56de\u7dda\u72b6\u614b\u304c\u826f\u3051\u308c\u307010\u79d2\u3067\u3082\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n- (IBAction)onCaptureClicked:(id)sender\n{\n  ...\n\n  // This block is running at PtpConnection#gcd thread.\n  // BOOL rtn = [session initiateCapture]; <- \u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\n\n  // \u8ffd\u52a0\u3053\u3053\u304b\u3089\n  [session setUint16PropValue:PTPDP_TIMELAPSE_NUMBER value:0]; // \u64ae\u5f71\u679a\u6570\u306e\u6307\u5b9a\u306a\u3057\uff08\u64ae\u5f71\u3057\u7d9a\u3051\u308b\uff09\n  [session setUint32PropValue:PTPDP_TIMELAPSE_INTERVAL value:15000]; // 15\u79d2\u306b1\u679a\u64ae\u5f71\u3092\u6307\u5b9a\n  [session setUint16PropValue:PTPDP_STILL_CAPTURE_MODE value:PTPIP_STILL_CAPTURE_MODE_TIMELAPSE]; //\u30a4\u30f3\u30bf\u30fc\u30d0\u30eb\u64ae\u5f71\u30e2\u30fc\u30c9\u3092\u6307\u5b9a\n  BOOL rtn = [session initiateOpenCapture]; // \u30a4\u30f3\u30bf\u30fc\u30d0\u30eb\u64ae\u5f71\u958b\u59cb\n  // \u8ffd\u52a0\u3053\u3053\u307e\u3067\n\n\n3.\u64ae\u5f71\u5b8c\u4e86\u5f8c\u306b\u753b\u50cf\u306e\u5f15\u53d6\u3092\u304a\u3053\u306a\u3046\n\u64ae\u5f71\u5b8c\u4e86\u306e\u30a4\u30d9\u30f3\u30c8\u3092\u53d7\u4fe1\u3057\u305f\u3089\u3001loadObject: session: \u3092\u547c\u3073\u51fa\u3059\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n-(void)ptpip_eventReceived:(int)code :(uint32_t)param1 :(uint32_t)param2 :(uint32_t)param3\n{\n  ...\n\n  [_ptpConnection operateSession:^(PtpIpSession *session) {\n    // \u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3053\u3053\u304b\u3089\n    // [_objects addObject:[self loadObject:param1 session:session]];\n    // NSIndexPath* pos = [NSIndexPath indexPathForRow:_objects.count-1 inSection:1];\n    // dispatch_async_main(^{\n    //   [_contentsView beginUpdates];\n    //   [_contentsView insertRowsAtIndexPaths:@[pos]\n    //                        withRowAnimation:UITableViewRowAnimationRight];\n    //   [_contentsView endUpdates];\n    // });\n    // \u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3053\u3053\u307e\u3067\n\n    // \u8ffd\u52a0\u3053\u3053\u304b\u3089\n    [self loadObject:param1 session:session];\n    // \u8ffd\u52a0\u3053\u3053\u307e\u3067\n  }];\n\nloadObject \u306f\u623b\u308a\u5024\u304c\u4e0d\u8981\u306b\u306a\u308b\u306e\u3067\u3001\u30e1\u30bd\u30c3\u30c9\u3054\u3068\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\n\u753b\u50cf\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u308a\u51fa\u3057\u3001postEqui: \u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u3002\n// - (PtpObject*)loadObject:(uint32_t)objectHandle session:(PtpIpSession*)session { ... }\n- (void)loadObject:(uint32_t)objectHandle session:(PtpIpSession*)session\n{\n    PtpIpObjectInfo* objectInfo = [session getObjectInfo:objectHandle];\n    if (!objectInfo) return;\n\n    if (objectInfo.object_format==PTPIP_FORMAT_JPEG) {\n        NSMutableData* imageData = [NSMutableData data];\n        BOOL result = [session getResizedImageObject:objectHandle width:2048 height:1024\n                            onStartData:^(NSUInteger totalLength) {\n                                NSLog(@\"getResizedImageObject(0x%08x) will received %zd bytes.\", objectHandle, totalLength);\n                            } onChunkReceived:^BOOL(NSData *data) {\n                                [imageData appendData:data];\n                                return YES;\n                            }];\n        if (result)  [self postEqui:imageData];\n    }\n}\n\n\n4.\u753b\u50cf\u306e\u5f15\u53d6\u5f8c\u3001API\u3078\u753b\u50cf\u306e\u6295\u7a3f\u3092\u884c\u3046\npostEqui: \u3067\u306f\u30e1\u30bd\u30c3\u30c9\u540d\u306e\u901a\u308a\u3001Equirectangular\u753b\u50cf\u306epost\u3092\u884c\u3044\u307e\u3059\u3002\n[app name] \u306b\u306f\u524d\u56de \u4f5c\u6210\u3057\u305f\u30a2\u30d7\u30ea\u306e\u540d\u524d\u304c\u5165\u308a\u307e\u3059\u3002\n- (void)postEqui:(NSData*)equi\n{\n    NSURL* url = [NSURL URLWithString:@\"https://[app name].herokuapp.com/equi\"];\n    const NSString* boundaryConstant = @\"----------V2ymHFg03ehbqgZCaKO6jy\";\n    const NSString* fileParamConstant = @\"img\";\n\n\n    NSURLSession* session = [NSURLSession sessionWithConfiguration:[NSURLSessionConfiguration defaultSessionConfiguration]];\n\n    NSMutableURLRequest* request = [[NSMutableURLRequest alloc] initWithURL:url];\n    [request setHTTPMethod:@\"POST\"];\n\n    NSString* contentType = [NSString stringWithFormat:@\"multipart/form-data; boundary=%@\", boundaryConstant];\n    [request setValue:contentType forHTTPHeaderField:@\"Content-Type\"];\n\n    NSMutableData* body = [NSMutableData data];\n    [body appendData:[[NSString stringWithFormat:@\"--%@\\r\\n\", boundaryConstant] dataUsingEncoding:NSUTF8StringEncoding]];\n    [body appendData:[[NSString stringWithFormat:@\"Content-Disposition: form-data; name=\\\"%@\\\"; filename=\\\"%@\\\"\\r\\n\", fileParamConstant, @\"img\"] dataUsingEncoding:NSUTF8StringEncoding]];\n    [body appendData:[[NSString stringWithFormat:@\"Content-Type: image/jpeg\\r\\n\\r\\n\"] dataUsingEncoding:NSUTF8StringEncoding]];\n    [body appendData:equi];\n    [body appendData:[[NSString stringWithFormat:@\"\\r\\n\"] dataUsingEncoding:NSUTF8StringEncoding]];\n    [body appendData:[[NSString stringWithFormat:@\"--%@--\\r\\n\", boundaryConstant] dataUsingEncoding:NSUTF8StringEncoding]];\n    NSString *postLength = [NSString stringWithFormat:@\"%zu\", (unsigned long)[body length]];\n    [request setValue:postLength forHTTPHeaderField:@\"Content-Length\"];\n\n    NSURLSessionUploadTask * uploadTask = [session uploadTaskWithRequest:request fromData:body\n                                                       completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) {\n                                                           dispatch_async_main(^{\n                                                               if (!error) {\n                                                                   [self appendLog:[NSString stringWithFormat:@\"POST failed(%@)\", error]];\n                                                               }\n                                                               else {\n                                                                   [self appendLog:@\"POST success\"];\n                                                               }\n                                                           });\n                                                       }];\n    [uploadTask resume];\n}\n\n\n5. 3, 4\u3092\u64ae\u5f71\u304c\u505c\u6b62\u3059\u308b\u307e\u3067\u7e70\u308a\u8fd4\u3059\nptpip_eventReceived \u306f\u753b\u50cf\u306e\u64ae\u5f71\u5b8c\u4e86\u6642\u306b\u90fd\u5ea6\u547c\u3070\u308c\u308b\u306e\u3067\u3001\u7279\u306b\u8ffd\u52a0\u3067\u884c\u3046\u3053\u3068\u306f\u3042\u308a\u307e\u305b\u3093\u3002\niOS\u30a2\u30d7\u30ea\u3092\u52d5\u304b\u3057\u3066\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5f8c\u306b\u3001\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3092shell\u304b\u3089\u5b9f\u884c\u3057\u3066\u3001\u753b\u50cf\u304c\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u3053\u3053\u3067\u3082 [app name] \u306f\u524d\u56de\u4f5c\u6210\u3057\u305f\u3082\u306e\u3067\u3059\u3002\n$ curl -o theta.jpg https://[app name].herokuapp.com/equi/dl && open theta.jpg\n\n\n\u3064\u3065\u304d\n\u3060\u3044\u3076\u6642\u9593\u304c\u7a7a\u3044\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u304c\u3001\u6700\u7d42\u56de\u306fUnity\u3067API\u304b\u3089\u753b\u50cf\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304d\u3066\u3001\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306bOculus\u3067\u753b\u50cf\u3092\u898b\u308b\u3068\u3053\u308d\u3092\u3064\u304f\u308a\u307e\u3059\u3002\n\u305d\u306e3: http://qiita.com/sandinist/items/6e2b9856c9273d580fa2\n\u305d\u306e1\u306f[\u3053\u3061\u3089](http://qiita.com/sandinist/items/979c741ef5223e9637a0)\n\n# \u30b5\u30fc\u30d3\u30b9\u6982\u8981\n\n\u9060\u304f\u306e\u5834\u6240\u3092\u3001\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b360\u5ea6\u4f53\u9a13\u3067\u304d\u308b\u30b5\u30fc\u30d3\u30b9\u3092\u306a\u308b\u3079\u304f\u7c21\u5358\u306b\u4f5c\u308a\u307e\u3059\u3002\n\n## \u30b4\u30fc\u30eb\u30a4\u30e1\u30fc\u30b8\n* \u4f5c\u6210\u3057\u305f\u30a2\u30d7\u30ea\u306e\u5165\u3063\u305fiPhone\u3068THETA\u3092\u6301\u3063\u3066\u65c5\u306b\u3067\u308b\n* \u5bb6\u3067\u5f85\u3063\u3066\u3044\u308b\u4eba\u304c\u3001\u65c5\u5148\u306e\u98a8\u666f\u3092Oculus\u3067\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b360\u00b0\u4f53\u9a13\u3067\u304d\u308b\n\n## \u4f7f\u3063\u305f\u3082\u306e\n### Hardware\n* THETA m15\n* Oculus Rift DK2\n* iPhone 6\n* MacBook Air (13-inch, Mid 2012)\n\n### Software\n* Ruby 2.1.5\n* Rails 4.1.8\n* Unity \n* Xcode 6.1\n\n## \u30b5\u30fc\u30d3\u30b9\u5168\u4f53\u50cf\n![\u30b5\u30fc\u30d2\u3099\u30b9\u5168\u4f53\u50cf.png](https://qiita-image-store.s3.amazonaws.com/0/2798/19367e26-6122-0a2c-6c53-2bea33c41f5d.png)\n\n# iOS App \u7de8\n* \u4eca\u56de\u306f (1)iOS App \u90e8\u5206\u3092\u3064\u304f\u308a\u307e\u3059\u3002\n\n### \u524d\u63d0\u6761\u4ef6\n* \u305d\u306e1\u304c\u3067\u304d\u3066\u308b\u3053\u3068\n* XCode 6.1\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3001Mac\u304c\u3042\u308b\u3053\u3068\n  * iPhone\u5b9f\u6a5f\u3067\u5b9f\u884c\u3067\u304d\u308b\u74b0\u5883\u304c\u306a\u3044\u3068\u5bc2\u3057\u3044\u3067\u3059\n* RICOH THETA \u304c\u3042\u308b\u3053\u3068\n\n### RICOH THETA SDK\u306e\u6e96\u5099\nhttps://developers.theta360.com/ja/docs/sdk/download.html \u304b\u3089 RICOH_THETA_SDK_for_iOS.0.2.1.zip \u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u4efb\u610f\u306e\u5834\u6240\u306b\u89e3\u51cd\u3057\u307e\u3059\u3002\uff08\u958b\u767a\u8005\u767b\u9332\u304c\u5fc5\u8981\u3067\u3059\u3002\uff09\n\nricoh-theta-sample-for-ios.xcodeproj \u3092\u958b\u3044\u3066\u3001Xcode\u304b\u3089\u5b9f\u6a5f\u3067\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\nTHETA\u3068\u63a5\u7d9a\u3057\u3066\u3001\u63a5\u7d9a\u3001\u4e00\u89a7\u306e\u53d6\u5f97\u30fb\u8868\u793a\u3001\u5199\u771f\u306e\u5f15\u53d6\u7b49\u304c\u52d5\u4f5c\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n### \u4f5c\u6210\u3059\u308b\u30a2\u30d7\u30ea\u306e\u8aac\u660e\n\u753b\u9762\u306fSDK\u4ed8\u5c5e\u306e\u30b5\u30f3\u30d7\u30eb\u30a2\u30d7\u30ea\u3092\u305d\u306e\u307e\u307e\u5229\u7528\u3057\u307e\u3059\u3002\n\u5909\u66f4\u3059\u308b\u306e\u306f ViewController.m \u306e\u307f\u3067\u3059\u3002\n\n\u5b9f\u73fe\u3059\u308b\u30b7\u30fc\u30b1\u30f3\u30b9\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3067\u3059\u3002\n\n1. Connect\u3092\u30bf\u30c3\u30d7\u3057\u3001\u63a5\u7d9a\u3059\u308b\u3002\u3053\u306e\u6642\u3001\u4e00\u89a7\u306e\u53d6\u5f97\u306f\u884c\u308f\u306a\u3044\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n2. Capture\u3092\u30bf\u30c3\u30d7\u3057\u3001\u30a4\u30f3\u30bf\u30fc\u30d0\u30eb\u64ae\u5f71\u3092\u958b\u59cb\u3059\u308b\u3002\n3. \u5199\u771f\u304c\u64ae\u5f71\u3055\u308c\u305f\u3089\u3001\u753b\u50cf\u306e\u5f15\u53d6\u3092\u81ea\u52d5\u3067\u884c\u3046\n4. \u5f15\u53d6\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001\u305d\u306e\u307e\u307eAPI\u3078\u753b\u50cf\u306e\u6295\u7a3f\u3092\u884c\u3046\n5. 3,4\u3092\u64ae\u5f71\u304c\u505c\u6b62\u3059\u308b\u307e\u3067\u7e70\u308a\u8fd4\u3059\n\n### 1.\u63a5\u7d9a\u51e6\u7406\nConnect\u30bf\u30c3\u30d7\u5f8c\u306e\u51e6\u7406\u3067\u306f\u3001\u4e00\u89a7\u306e\u8868\u793a\u3092\u306a\u304f\u3057\u307e\u3059\u3002\n\n```objc\n- (void)connect\n{\n  ...\n\n  // Start enum objects.\n  // [self enumObjects]; <- \u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3059\u308b\n\n```\n\n### 2.\u30a4\u30f3\u30bf\u30fc\u30d0\u30eb\u64ae\u5f71\u306e\u958b\u59cb\nCapture\u30bf\u30c3\u30d7\u5f8c\u306e\u51e6\u7406\u3067\u306f\u3001\u30a4\u30f3\u30bf\u30fc\u30d0\u30eb\u64ae\u5f71\u306e\u958b\u59cb\u3092\u3057\u307e\u3059\u3002\n\u64ae\u5f71\u679a\u6570\u306e\u6307\u5b9a\u306f\u306a\u3057\u306b\u3057\u3066\u3001THETA\u306e\u7a7a\u304d\u3068\u30d0\u30c3\u30c6\u30ea\u30fc\u304c\u3042\u308b\u9650\u308a\u64ae\u5f71\u3055\u305b\u307e\u3059\u3002\n\u64ae\u5f71\u9593\u9694\u306f15\u79d2\u306b1\u679a\u306b\u3057\u307e\u3059\u3002iPhone\u306e\u56de\u7dda\u72b6\u614b\u304c\u826f\u3051\u308c\u307010\u79d2\u3067\u3082\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n```objc\n- (IBAction)onCaptureClicked:(id)sender\n{\n  ...\n\n  // This block is running at PtpConnection#gcd thread.\n  // BOOL rtn = [session initiateCapture]; <- \u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\n\n  // \u8ffd\u52a0\u3053\u3053\u304b\u3089\n  [session setUint16PropValue:PTPDP_TIMELAPSE_NUMBER value:0]; // \u64ae\u5f71\u679a\u6570\u306e\u6307\u5b9a\u306a\u3057\uff08\u64ae\u5f71\u3057\u7d9a\u3051\u308b\uff09\n  [session setUint32PropValue:PTPDP_TIMELAPSE_INTERVAL value:15000]; // 15\u79d2\u306b1\u679a\u64ae\u5f71\u3092\u6307\u5b9a\n  [session setUint16PropValue:PTPDP_STILL_CAPTURE_MODE value:PTPIP_STILL_CAPTURE_MODE_TIMELAPSE]; //\u30a4\u30f3\u30bf\u30fc\u30d0\u30eb\u64ae\u5f71\u30e2\u30fc\u30c9\u3092\u6307\u5b9a\n  BOOL rtn = [session initiateOpenCapture]; // \u30a4\u30f3\u30bf\u30fc\u30d0\u30eb\u64ae\u5f71\u958b\u59cb\n  // \u8ffd\u52a0\u3053\u3053\u307e\u3067\n```\n\n### 3.\u64ae\u5f71\u5b8c\u4e86\u5f8c\u306b\u753b\u50cf\u306e\u5f15\u53d6\u3092\u304a\u3053\u306a\u3046\n\u64ae\u5f71\u5b8c\u4e86\u306e\u30a4\u30d9\u30f3\u30c8\u3092\u53d7\u4fe1\u3057\u305f\u3089\u3001loadObject: session: \u3092\u547c\u3073\u51fa\u3059\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```objc\n-(void)ptpip_eventReceived:(int)code :(uint32_t)param1 :(uint32_t)param2 :(uint32_t)param3\n{\n  ...\n\n  [_ptpConnection operateSession:^(PtpIpSession *session) {\n    // \u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3053\u3053\u304b\u3089\n    // [_objects addObject:[self loadObject:param1 session:session]];\n    // NSIndexPath* pos = [NSIndexPath indexPathForRow:_objects.count-1 inSection:1];\n    // dispatch_async_main(^{\n    //   [_contentsView beginUpdates];\n    //   [_contentsView insertRowsAtIndexPaths:@[pos]\n    //                        withRowAnimation:UITableViewRowAnimationRight];\n    //   [_contentsView endUpdates];\n    // });\n    // \u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3053\u3053\u307e\u3067\n\n    // \u8ffd\u52a0\u3053\u3053\u304b\u3089\n    [self loadObject:param1 session:session];\n    // \u8ffd\u52a0\u3053\u3053\u307e\u3067\n  }];\n```\n\nloadObject \u306f\u623b\u308a\u5024\u304c\u4e0d\u8981\u306b\u306a\u308b\u306e\u3067\u3001\u30e1\u30bd\u30c3\u30c9\u3054\u3068\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\n\u753b\u50cf\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u308a\u51fa\u3057\u3001postEqui: \u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u3002\n\n```objc\n// - (PtpObject*)loadObject:(uint32_t)objectHandle session:(PtpIpSession*)session { ... }\n- (void)loadObject:(uint32_t)objectHandle session:(PtpIpSession*)session\n{\n    PtpIpObjectInfo* objectInfo = [session getObjectInfo:objectHandle];\n    if (!objectInfo) return;\n    \n    if (objectInfo.object_format==PTPIP_FORMAT_JPEG) {\n        NSMutableData* imageData = [NSMutableData data];\n        BOOL result = [session getResizedImageObject:objectHandle width:2048 height:1024\n                            onStartData:^(NSUInteger totalLength) {\n                                NSLog(@\"getResizedImageObject(0x%08x) will received %zd bytes.\", objectHandle, totalLength);\n                            } onChunkReceived:^BOOL(NSData *data) {\n                                [imageData appendData:data];\n                                return YES;\n                            }];\n        if (result)  [self postEqui:imageData];\n    }\n}\n```\n\n### 4.\u753b\u50cf\u306e\u5f15\u53d6\u5f8c\u3001API\u3078\u753b\u50cf\u306e\u6295\u7a3f\u3092\u884c\u3046\n\npostEqui: \u3067\u306f\u30e1\u30bd\u30c3\u30c9\u540d\u306e\u901a\u308a\u3001Equirectangular\u753b\u50cf\u306epost\u3092\u884c\u3044\u307e\u3059\u3002\n[app name] \u306b\u306f[\u524d\u56de](http://qiita.com/sandinist/items/979c741ef5223e9637a0) \u4f5c\u6210\u3057\u305f\u30a2\u30d7\u30ea\u306e\u540d\u524d\u304c\u5165\u308a\u307e\u3059\u3002\n\n```objc\n- (void)postEqui:(NSData*)equi\n{\n    NSURL* url = [NSURL URLWithString:@\"https://[app name].herokuapp.com/equi\"];\n    const NSString* boundaryConstant = @\"----------V2ymHFg03ehbqgZCaKO6jy\";\n    const NSString* fileParamConstant = @\"img\";\n    \n    \n    NSURLSession* session = [NSURLSession sessionWithConfiguration:[NSURLSessionConfiguration defaultSessionConfiguration]];\n    \n    NSMutableURLRequest* request = [[NSMutableURLRequest alloc] initWithURL:url];\n    [request setHTTPMethod:@\"POST\"];\n    \n    NSString* contentType = [NSString stringWithFormat:@\"multipart/form-data; boundary=%@\", boundaryConstant];\n    [request setValue:contentType forHTTPHeaderField:@\"Content-Type\"];\n    \n    NSMutableData* body = [NSMutableData data];\n    [body appendData:[[NSString stringWithFormat:@\"--%@\\r\\n\", boundaryConstant] dataUsingEncoding:NSUTF8StringEncoding]];\n    [body appendData:[[NSString stringWithFormat:@\"Content-Disposition: form-data; name=\\\"%@\\\"; filename=\\\"%@\\\"\\r\\n\", fileParamConstant, @\"img\"] dataUsingEncoding:NSUTF8StringEncoding]];\n    [body appendData:[[NSString stringWithFormat:@\"Content-Type: image/jpeg\\r\\n\\r\\n\"] dataUsingEncoding:NSUTF8StringEncoding]];\n    [body appendData:equi];\n    [body appendData:[[NSString stringWithFormat:@\"\\r\\n\"] dataUsingEncoding:NSUTF8StringEncoding]];\n    [body appendData:[[NSString stringWithFormat:@\"--%@--\\r\\n\", boundaryConstant] dataUsingEncoding:NSUTF8StringEncoding]];\n    NSString *postLength = [NSString stringWithFormat:@\"%zu\", (unsigned long)[body length]];\n    [request setValue:postLength forHTTPHeaderField:@\"Content-Length\"];\n\n    NSURLSessionUploadTask * uploadTask = [session uploadTaskWithRequest:request fromData:body\n                                                       completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) {\n                                                           dispatch_async_main(^{\n                                                               if (!error) {\n                                                                   [self appendLog:[NSString stringWithFormat:@\"POST failed(%@)\", error]];\n                                                               }\n                                                               else {\n                                                                   [self appendLog:@\"POST success\"];\n                                                               }\n                                                           });\n                                                       }];\n    [uploadTask resume];\n}\n```\n\n### 5. 3, 4\u3092\u64ae\u5f71\u304c\u505c\u6b62\u3059\u308b\u307e\u3067\u7e70\u308a\u8fd4\u3059\nptpip_eventReceived \u306f\u753b\u50cf\u306e\u64ae\u5f71\u5b8c\u4e86\u6642\u306b\u90fd\u5ea6\u547c\u3070\u308c\u308b\u306e\u3067\u3001\u7279\u306b\u8ffd\u52a0\u3067\u884c\u3046\u3053\u3068\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\niOS\u30a2\u30d7\u30ea\u3092\u52d5\u304b\u3057\u3066\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5f8c\u306b\u3001\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3092shell\u304b\u3089\u5b9f\u884c\u3057\u3066\u3001\u753b\u50cf\u304c\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u3053\u3053\u3067\u3082 [app name] \u306f\u524d\u56de\u4f5c\u6210\u3057\u305f\u3082\u306e\u3067\u3059\u3002\n\n```\n$ curl -o theta.jpg https://[app name].herokuapp.com/equi/dl && open theta.jpg\n```\n\n## \u3064\u3065\u304d\n\u3060\u3044\u3076\u6642\u9593\u304c\u7a7a\u3044\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u304c\u3001\u6700\u7d42\u56de\u306fUnity\u3067API\u304b\u3089\u753b\u50cf\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304d\u3066\u3001\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306bOculus\u3067\u753b\u50cf\u3092\u898b\u308b\u3068\u3053\u308d\u3092\u3064\u304f\u308a\u307e\u3059\u3002\n\n\u305d\u306e3: http://qiita.com/sandinist/items/6e2b9856c9273d580fa2\n", "tags": ["Theta", "Oculus", "Objective-C", "iOS"]}