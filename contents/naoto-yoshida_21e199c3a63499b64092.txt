{"tags": ["Linux", "CentOS", "chef", "Berkshelf"], "context": " More than 1 year has passed since last update.\u5c0e\u5165\u7de8\u3067\u306fChef\u3092\u4f7f\u3046\u6e96\u5099\u3092\u5b9f\u65bd\u3057\u305f\u3002\n\u304a\u8a66\u3057\u7de8\u3067\u306fEpel\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u3092\u6307\u5b9a\u3057\u3001Nginx\u3092\u9069\u7528\u3059\u308b\u3088\u3046\u306a\u30ec\u30b7\u30d4\u3092\u8a18\u8f09\u3057\u3001\u5b9f\u969b\u306b\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0\u3078\u30c7\u30d7\u30ed\u30a4\u3092\u5b9f\u65bd\u3059\u308b\u3002\n\n\u305d\u306e\u524d\u306b\n\nChef\u3092\u4f7f\u3046\u3068\u304d\u306e\u304a\u304a\u307e\u304b\u306a\u6d41\u308c\u306e\u5099\u5fd8\u9332\n\n[Cookbook\u4f5c\u6210]-[Berksfile\u8a18\u8f09\uff08\u5fc5\u8981\u306b\u5fdc\u3058\u3066\uff09]-[node\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u4f5c\u6210]-[\u30ec\u30b7\u30d4\u4f5c\u6210]-[Attribute\u4f5c\u6210]-[template\u4f5c\u6210]-[\u30c7\u30d7\u30ed\u30a4\u6e96\u5099]-[\u30c7\u30d7\u30ed\u30a4]\n\u9806\u756a\u306e\u524d\u5f8c\u3068\u304bEnvironment\u8a2d\u5b9a\u306a\u3069\u3082\u3042\u308b\u3051\u3069\u3001\u57fa\u672c\u306e\u30d5\u30ed\u30fc\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n\n\u524d\u63d0\n\nChef\u306e\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f/var/chef-repo\u3068\u3059\u308b\n\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0\u540d\u306fremote-hogehoge\u3068\u3059\u308b\uff08\u540d\u524d\u89e3\u6c7a\u306f\u3067\u304d\u3066\u3044\u308b\u3082\u306e\u3068\u3059\u308b\uff09\nChef\u5b9f\u884c\u30e6\u30fc\u30b6\u306fusr-fugafuga\u3068\u3059\u308b\nremote-hogehoge\u4e0a\u306b\u306f\u4e88\u3081usr-fugafuga\u3092\u4f5c\u6210\u3057\u3001sudores\u8a2d\u5b9a\uff08sudo\u30d1\u30b9\u30ef\u30fc\u30c9\u7121\u3057\u5b9f\u884c\u8a31\u53ef\uff09\u3092\u5b9f\u65bd\u3057\u3066\u304a\u304f\n\n\nNginx\u7528\u306b\u30af\u30c3\u30af\u30d6\u30c3\u30af\u306a\u3069\u3092\u6e96\u5099\n\n\n\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u79fb\u52d5\n\n$ pwd\n/var/chef-repo\n\n\n\nBerksfile\u3092\u4f5c\u6210\u3059\u308b\nNginx\u306fEPEL\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u5b9f\u65bd\u3059\u308b\u305f\u3081\u3001Nginx\u306e\u4f9d\u5b58\u95a2\u4fc2\u3068\u3057\u3066EPEL\u3092\u6307\u5b9a\u3059\u308b\n\n$ cat Berksfile\nsource \"https://supermarket.getchef.com\"\n\u2003\ncookbook \"yum-epel\"\ncookbook \"nginx\" , path: \"./site-cookbooks/nginx\"\n\n\n\nberks vendor\u3092\u5b9f\u884c\u3057\u3001\u5404\u30af\u30c3\u30af\u30d6\u30c3\u30af\u306a\u3069\u3092\u4f5c\u6210\u3059\u308b\n\n$ berks vendor ./cookbooks\nFetching 'nginx' from source at site-cookbooks/nginx\nUsing nginx (0.1.0) from source at site-cookbooks/nginx\nUsing yum (3.4.1)\nUsing yum-epel (0.5.2)\nVendoring nginx (0.1.0) to cookbooks/nginx\nVendoring yum (3.4.1) to cookbooks/yum\nVendoring yum-epel (0.5.2) to cookbooks/yum-epel$ ls\nberks-cookbooks  Berksfile  Berksfile.lock  site-cookbooks\n\n\n\nnginx\u306eRecipe\u3092\u4f5c\u6210\n\n$ cat site-cookbooks/nginx/recipes/default.rb\ninclude_recipe \"yum-epel\"\npackage \"nginx\" do\naction :install\nend\n\u2003\nservice \"nginx\" do\naction [ :enable, :start ]\nsupports :status => true, :restart => true, :reload => true\nend\n\n\n\nnode\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\n\n$ mkdir nodes\n$ cat nodes/AP-Test.json\n{\n\"run_list\": [\n    \"recipe[yum-epel]\",\n    \"recipe[nginx]\"\n]\n}\n\n\n\n.chef/knife.rb\u7de8\u96c6\nknife-solo\u304c\u5229\u7528\u3059\u308b\u30c6\u30f3\u30dd\u30e9\u30ea\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30d1\u30b9\u3092\u8a2d\u5b9a\n\n$ cat .chef/knife.rb\ncookbook_path    [\"cookbooks\", \"site-cookbooks\"]\nnode_path        \"nodes\"\nrole_path        \"roles\"\nenvironment_path \"environments\"\ndata_bag_path    \"data_bags\"\n#encrypted_data_bag_secret \"data_bag_key\"\n\u2003\nknife[:berkshelf_path] = \"cookbooks\"\n\n\n\n\n\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0\u3078\u30c7\u30d7\u30ed\u30a4\u5b9f\u65bd\n\n\n\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0\u3078Chef-client\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n$ knife solo bootstrap -i ~/.ssh/usr-fugafuga.pem usr-fugafuga@remote-hogehoge\n\n\n\n\u30c7\u30d7\u30ed\u30a4\u5b9f\u65bd\n\n$ knife solo cook -i ~/.ssh/usr-fugafuga.pem usr-fugafuga@remote-hogehoge\nStarting Chef Client, version 11.16.4\nCompiling Cookbooks...\nConverging 3 resources\nRecipe: yum-epel::default\n* yum_repository[epel] action create\n* template[/etc/yum.repos.d/epel.repo] action create\n  - create new file /etc/yum.repos.d/epel.repo\n  - update content in file /etc/yum.repos.d/epel.repo from none to 39e29f\n  --- /etc/yum.repos.d/epel.repo    2014-11-25 07:06:47.378441508 +0000\n  +++ /tmp/chef-rendered-template20141125-3626-rf9pee       2014-11-25 07:06:47.383441510 +0000\n  @@ -1 +1,12 @@\n  +# This file was generated by Chef\n  +# Do NOT modify this file by hand.\n  +\n  +[epel]\n  +name=Extra Packages for Enterprise Linux 6 - $basearch\n  +enabled=1\n  +failovermethod=priority\n  +gpgcheck=1\n  +gpgkey=https://dl.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-6\n  +mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-6&arch=$basearch\n  +sslverify=true\n  - change mode from '' to '0644'\n* execute[yum-makecache-epel] action run\n  - execute yum -q makecache --disablerepo=* --enablerepo=epel\n* ruby_block[yum-cache-reload-epel] action create\n  - execute the ruby block yum-cache-reload-epel\n* execute[yum-makecache-epel] action nothing (skipped due to action :nothing)\n* ruby_block[yum-cache-reload-epel] action nothing (skipped due to action :nothing)\n\u2003\nRecipe: nginx::default\n* package[nginx] action install\n- install version 1.0.15-10.el6 of package nginx\n* service[nginx] action enable\n- enable service service[nginx]\n* service[nginx] action start\n- start service service[nginx]\n\u2003\nRunning handlers:\nRunning handlers complete\nChef Client finished, 7/7 resources updated in 14.866675586 seconds\n\n\n\n[\u5c0e\u5165\u7de8](http://qiita.com/naoto-yoshida/items/51bba0a67addcea9f1f2)\u3067\u306fChef\u3092\u4f7f\u3046\u6e96\u5099\u3092\u5b9f\u65bd\u3057\u305f\u3002\n\u304a\u8a66\u3057\u7de8\u3067\u306fEpel\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u3092\u6307\u5b9a\u3057\u3001Nginx\u3092\u9069\u7528\u3059\u308b\u3088\u3046\u306a\u30ec\u30b7\u30d4\u3092\u8a18\u8f09\u3057\u3001\u5b9f\u969b\u306b\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0\u3078\u30c7\u30d7\u30ed\u30a4\u3092\u5b9f\u65bd\u3059\u308b\u3002\n\n\n#\u305d\u306e\u524d\u306b#\n###Chef\u3092\u4f7f\u3046\u3068\u304d\u306e\u304a\u304a\u307e\u304b\u306a\u6d41\u308c\u306e\u5099\u5fd8\u9332###\n* [Cookbook\u4f5c\u6210]-[Berksfile\u8a18\u8f09\uff08\u5fc5\u8981\u306b\u5fdc\u3058\u3066\uff09]-[node\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u4f5c\u6210]-[\u30ec\u30b7\u30d4\u4f5c\u6210]-[Attribute\u4f5c\u6210]-[template\u4f5c\u6210]-[\u30c7\u30d7\u30ed\u30a4\u6e96\u5099]-[\u30c7\u30d7\u30ed\u30a4]\n* \u9806\u756a\u306e\u524d\u5f8c\u3068\u304bEnvironment\u8a2d\u5b9a\u306a\u3069\u3082\u3042\u308b\u3051\u3069\u3001\u57fa\u672c\u306e\u30d5\u30ed\u30fc\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n###\u524d\u63d0###\n* Chef\u306e\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f/var/chef-repo\u3068\u3059\u308b\n* \u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0\u540d\u306fremote-hogehoge\u3068\u3059\u308b\uff08\u540d\u524d\u89e3\u6c7a\u306f\u3067\u304d\u3066\u3044\u308b\u3082\u306e\u3068\u3059\u308b\uff09\n* Chef\u5b9f\u884c\u30e6\u30fc\u30b6\u306fusr-fugafuga\u3068\u3059\u308b\n* remote-hogehoge\u4e0a\u306b\u306f\u4e88\u3081usr-fugafuga\u3092\u4f5c\u6210\u3057\u3001sudores\u8a2d\u5b9a\uff08sudo\u30d1\u30b9\u30ef\u30fc\u30c9\u7121\u3057\u5b9f\u884c\u8a31\u53ef\uff09\u3092\u5b9f\u65bd\u3057\u3066\u304a\u304f\n\n\n#Nginx\u7528\u306b\u30af\u30c3\u30af\u30d6\u30c3\u30af\u306a\u3069\u3092\u6e96\u5099#\n1. \u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u79fb\u52d5\n<pre>\n$ pwd\n/var/chef-repo\n</pre>\n\n2. Berksfile\u3092\u4f5c\u6210\u3059\u308b\nNginx\u306fEPEL\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u5b9f\u65bd\u3059\u308b\u305f\u3081\u3001Nginx\u306e\u4f9d\u5b58\u95a2\u4fc2\u3068\u3057\u3066EPEL\u3092\u6307\u5b9a\u3059\u308b\n<pre>\n$ cat Berksfile\nsource \"https://supermarket.getchef.com\"\n&emsp;\ncookbook \"yum-epel\"\ncookbook \"nginx\" , path: \"./site-cookbooks/nginx\"\n</pre>\n\n3. berks vendor\u3092\u5b9f\u884c\u3057\u3001\u5404\u30af\u30c3\u30af\u30d6\u30c3\u30af\u306a\u3069\u3092\u4f5c\u6210\u3059\u308b\n<pre>\n$ berks vendor ./cookbooks\nFetching 'nginx' from source at site-cookbooks/nginx\nUsing nginx (0.1.0) from source at site-cookbooks/nginx\nUsing yum (3.4.1)\nUsing yum-epel (0.5.2)\nVendoring nginx (0.1.0) to cookbooks/nginx\nVendoring yum (3.4.1) to cookbooks/yum\nVendoring yum-epel (0.5.2) to cookbooks/yum-epel$ ls\nberks-cookbooks  Berksfile  Berksfile.lock  site-cookbooks\n</pre>\n\n4. nginx\u306eRecipe\u3092\u4f5c\u6210\n<pre>\n$ cat site-cookbooks/nginx/recipes/default.rb\ninclude_recipe \"yum-epel\"\npackage \"nginx\" do\n   action :install\nend\n&emsp;\nservice \"nginx\" do\n   action [ :enable, :start ]\n   supports :status => true, :restart => true, :reload => true\nend\n</pre>\n\n5. node\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\n<pre>\n$ mkdir nodes\n$ cat nodes/AP-Test.json\n{\n    \"run_list\": [\n        \"recipe[yum-epel]\",\n        \"recipe[nginx]\"\n    ]\n}\n</pre>\n\n6. .chef/knife.rb\u7de8\u96c6\nknife-solo\u304c\u5229\u7528\u3059\u308b\u30c6\u30f3\u30dd\u30e9\u30ea\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30d1\u30b9\u3092\u8a2d\u5b9a\n<pre>\n$ cat .chef/knife.rb\ncookbook_path    [\"cookbooks\", \"site-cookbooks\"]\nnode_path        \"nodes\"\nrole_path        \"roles\"\nenvironment_path \"environments\"\ndata_bag_path    \"data_bags\"\n\\#encrypted_data_bag_secret \"data_bag_key\"\n&emsp;\nknife[:berkshelf_path] = \"cookbooks\"\n</pre>\n\n\n#\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0\u3078\u30c7\u30d7\u30ed\u30a4\u5b9f\u65bd#\n1. \u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0\u3078Chef-client\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n<pre>\n$ knife solo bootstrap -i ~/.ssh/usr-fugafuga.pem usr-fugafuga@remote-hogehoge\n</pre>\n\n2. \u30c7\u30d7\u30ed\u30a4\u5b9f\u65bd\n<pre>\n$ knife solo cook -i ~/.ssh/usr-fugafuga.pem usr-fugafuga@remote-hogehoge\nStarting Chef Client, version 11.16.4\nCompiling Cookbooks...\nConverging 3 resources\nRecipe: yum-epel::default\n  \\* yum_repository[epel] action create\n    \\* template[/etc/yum.repos.d/epel.repo] action create\n      \\- create new file /etc/yum.repos.d/epel.repo\n      \\- update content in file /etc/yum.repos.d/epel.repo from none to 39e29f\n      \\--- /etc/yum.repos.d/epel.repo    2014-11-25 07:06:47.378441508 +0000\n      \\+++ /tmp/chef-rendered-template20141125-3626-rf9pee       2014-11-25 07:06:47.383441510 +0000\n      @@ -1 +1,12 @@\n      +# This file was generated by Chef\n      +# Do NOT modify this file by hand.\n      +\n      +[epel]\n      +name=Extra Packages for Enterprise Linux 6 - $basearch\n      +enabled=1\n      +failovermethod=priority\n      +gpgcheck=1\n      +gpgkey=https://dl.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-6\n      +mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-6&arch=$basearch\n      +sslverify=true\n      \\- change mode from '' to '0644'\n    \\* execute[yum-makecache-epel] action run\n      \\- execute yum -q makecache --disablerepo=* --enablerepo=epel\n    \\* ruby_block[yum-cache-reload-epel] action create\n      \\- execute the ruby block yum-cache-reload-epel\n    \\* execute[yum-makecache-epel] action nothing (skipped due to action :nothing)\n    \\* ruby_block[yum-cache-reload-epel] action nothing (skipped due to action :nothing)\n&emsp;\nRecipe: nginx::default\n  \\* package[nginx] action install\n    \\- install version 1.0.15-10.el6 of package nginx\n  \\* service[nginx] action enable\n    \\- enable service service[nginx]\n  \\* service[nginx] action start\n    \\- start service service[nginx]\n&emsp;\nRunning handlers:\nRunning handlers complete\nChef Client finished, 7/7 resources updated in 14.866675586 seconds\n</pre>\n"}