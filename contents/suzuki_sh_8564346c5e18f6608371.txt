{"context": "IDCF\u30af\u30e9\u30a6\u30c9\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30eb\u30fc\u30c8\u30c7\u30a3\u30b9\u30af\u304c15GB\u56fa\u5b9a\u3067\u3042\u308a\u3001\u8ffd\u52a0\u30c7\u30a3\u30b9\u30af\u306e\u30de\u30a6\u30f3\u30c8\u306f\u624b\u52d5\u3067\u884c\u3046\u5fc5\u8981\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\u3053\u308c\u3092Ansible\u3067\u81ea\u52d5\u5316\u3057\u3066\u307f\u307e\u3059\u3002\n\u305f\u3076\u3093Microsoft Azure Virtual Machines\u3068\u304b\u3067\u3082\u3060\u3044\u305f\u3044\u540c\u3058\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u524d\u63d0\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\n\n\nansible 2.1.1.0\n\n\n\u30b5\u30fc\u30d0\u5074\n\n\nIDCF Cloud VirtualMachine light.S1\nCentOS 6.8\n\u69cb\u7bc9\u6642\u306b1GB\u306e\u8ffd\u52a0\u30c7\u30fc\u30bf\u30c7\u30a3\u30b9\u30af\u3092\u30a2\u30bf\u30c3\u30c1\u6e08\n\n\n\n\n\u624b\u9806\n\u4e0b\u8a18\u306e\u3088\u3046\u306a\u624b\u9806\u3092Ansible\u5316\u3057\u307e\u3059\n\n\u624b\u9806\u306e\u30a4\u30e1\u30fc\u30b8\n$ mkfs -t xfs /dev/sdb\n$ mkdir /mnt/tmp_device\n$ mount -t xfs -o defaults /dev/sdb /mnt/tmp_device\n$ mv /var/* /mnt/tmp_device/.\n$ sed -i -e \"/^UUID/a UUID=` blkid /dev/sdb | awk -F\\\\\" '{ print $2 }'` /var xfs defaults 0 0\" /etc/fstab\n\n\nAnsible\u306b\u306f\u30de\u30a6\u30f3\u30c8\u3068fstab\u3078\u306e\u8ffd\u8a18\u3092\u540c\u6642\u306b\u884c\u3063\u3066\u304f\u308c\u308bmount\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u3042\u308a\u3001\u3053\u308c\u3092\u6d3b\u7528\u3057\u307e\u3059\u3002\n\nAnsible role\n\nmount.yml\n- hosts: all\n  user: root\n  vars:\n    file_system: xfs\n    device: /dev/sdb\n    mount_point: /var\n    reboot: true\n\n  tasks:\n    - name: yum install xfsprogs\n      yum:\n        name: xfsprogs\n      when: file_system == \"xfs\"\n\n    - name: mkfs\n      filesystem:\n        fstype: \"{{ file_system }}\"\n        dev: \"{{ device }}\"\n\n    - name: mkdir /mnt/tmp_device\n      file:\n        path: /mnt/tmp_device\n        state: directory\n\n    - name: mount /mnt/tmp_device\n      mount:\n        name: /mnt/tmp_device\n        src: \"{{ device }}\"\n        fstype: \"{{ file_system }}\"\n        opts: defaults\n        state: mounted\n\n    - name: mv to /mnt/tmp_device/.\n      shell: mv {{ mount_point }}/* /mnt/tmp_device/.\n\n    - name: mkdir mount_point\n      file:\n        path: \"{{ mount_point }}\"\n        state: directory\n\n    - name: get blkid\n      shell: 'blkid {{ device }} | awk -F\\\" ''{ print $2 }'' '\n      register: uuid\n\n    - name: unmount /mnt/tmp_device\n      mount:\n        name: /mnt/tmp_device\n        src: \"{{ device }}\"\n        fstype: \"{{ file_system }}\"\n        opts: defaults\n        state: absent\n\n    - name: mount\n      mount:\n        name: \"{{ mount_point }}\"\n        src: \"UUID={{ uuid.stdout }}\"\n        fstype: \"{{ file_system }}\"\n        opts: defaults\n        state: mounted\n\n    - name: reboot\n      shell: shutdown -r now\n      when: reboot == true\n\n\n\nhosts\n[app]\nxxx.xxx.xxx.xxx\n\n\n\u5b9f\u884c\n$ ansible-playbook mount.yml -i hosts\n\n\n\u7d50\u679c\n\u5b9f\u884c\u524d\n$ df -Th\nFilesystem     Type   Size  Used Avail Use% Mounted on\n/dev/sda1      ext4    15G  1.1G   13G   8% /\ntmpfs          tmpfs  495M     0  495M   0% /dev/shm\n\n\u5b9f\u884c\u5f8c\n$ df -Th\nFilesystem     Type   Size  Used Avail Use% Mounted on\n/dev/sda1      ext4    15G 1002M   13G   8% /\ntmpfs          tmpfs  495M     0  495M   0% /dev/shm\n/dev/sdb       xfs   1014M  119M  896M  12% /var\n\n\n\u53c2\u8003\n\nmount - Control active and configured mount points \u2014 Ansible Documentation\n\u30a2\u30bf\u30c3\u30c1\u3057\u305f\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u4f7f\u7528\u3059\u308b\u70ba\u306e\u4e8b\u524d\u6e96\u5099\uff08CentOS5,6\u7cfb/\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u7121\u3057\u306e\u5834\u5408\uff09 | IDCF\u30af\u30e9\u30a6\u30c9\n\u30c7\u30a3\u30b9\u30af\u306e\u8ffd\u52a0\u624b\u9806\u3092\u307e\u3068\u3081\u3066\u307f\u305f(\u901a\u5e38\u30c7\u30a3\u30b9\u30af\u7de8)\u00a0|\u00a0\u30ec\u30f3\u30bf\u30eb\u30b5\u30fc\u30d0\u30fc\u30fb\u81ea\u5b85\u30b5\u30fc\u30d0\u30fc\u8a2d\u5b9a\u30fb\u69cb\u7bc9\u306e\u30d2\u30f3\u30c8\n\n[IDCF\u30af\u30e9\u30a6\u30c9](https://www.idcf.jp/cloud/)\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30eb\u30fc\u30c8\u30c7\u30a3\u30b9\u30af\u304c15GB\u56fa\u5b9a\u3067\u3042\u308a\u3001\u8ffd\u52a0\u30c7\u30a3\u30b9\u30af\u306e\u30de\u30a6\u30f3\u30c8\u306f\u624b\u52d5\u3067\u884c\u3046\u5fc5\u8981\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\u3053\u308c\u3092Ansible\u3067\u81ea\u52d5\u5316\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u305f\u3076\u3093[Microsoft Azure Virtual Machines](https://azure.microsoft.com/ja-jp/services/virtual-machines/)\u3068\u304b\u3067\u3082\u3060\u3044\u305f\u3044\u540c\u3058\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\n## \u524d\u63d0\n\n- \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\n  - ansible 2.1.1.0\n- \u30b5\u30fc\u30d0\u5074\n  - IDCF Cloud VirtualMachine light.S1\n  - CentOS 6.8\n  - \u69cb\u7bc9\u6642\u306b1GB\u306e\u8ffd\u52a0\u30c7\u30fc\u30bf\u30c7\u30a3\u30b9\u30af\u3092\u30a2\u30bf\u30c3\u30c1\u6e08\n\n## \u624b\u9806\n\n\u4e0b\u8a18\u306e\u3088\u3046\u306a\u624b\u9806\u3092Ansible\u5316\u3057\u307e\u3059\n\n```bash:\u624b\u9806\u306e\u30a4\u30e1\u30fc\u30b8\n$ mkfs -t xfs /dev/sdb\n$ mkdir /mnt/tmp_device\n$ mount -t xfs -o defaults /dev/sdb /mnt/tmp_device\n$ mv /var/* /mnt/tmp_device/.\n$ sed -i -e \"/^UUID/a UUID=` blkid /dev/sdb | awk -F\\\\\" '{ print $2 }'` /var xfs defaults 0 0\" /etc/fstab\n```\n\nAnsible\u306b\u306f\u30de\u30a6\u30f3\u30c8\u3068fstab\u3078\u306e\u8ffd\u8a18\u3092\u540c\u6642\u306b\u884c\u3063\u3066\u304f\u308c\u308b[mount\u30e2\u30b8\u30e5\u30fc\u30eb](http://docs.ansible.com/ansible/mount_module.html)\u304c\u3042\u308a\u3001\u3053\u308c\u3092\u6d3b\u7528\u3057\u307e\u3059\u3002\n\n### Ansible role\n\n```yaml:mount.yml\n- hosts: all\n  user: root\n  vars:\n    file_system: xfs\n    device: /dev/sdb\n    mount_point: /var\n    reboot: true\n\n  tasks:\n    - name: yum install xfsprogs\n      yum:\n        name: xfsprogs\n      when: file_system == \"xfs\"\n\n    - name: mkfs\n      filesystem:\n        fstype: \"{{ file_system }}\"\n        dev: \"{{ device }}\"\n\n    - name: mkdir /mnt/tmp_device\n      file:\n        path: /mnt/tmp_device\n        state: directory\n\n    - name: mount /mnt/tmp_device\n      mount:\n        name: /mnt/tmp_device\n        src: \"{{ device }}\"\n        fstype: \"{{ file_system }}\"\n        opts: defaults\n        state: mounted\n\n    - name: mv to /mnt/tmp_device/.\n      shell: mv {{ mount_point }}/* /mnt/tmp_device/.\n\n    - name: mkdir mount_point\n      file:\n        path: \"{{ mount_point }}\"\n        state: directory\n\n    - name: get blkid\n      shell: 'blkid {{ device }} | awk -F\\\" ''{ print $2 }'' '\n      register: uuid\n\n    - name: unmount /mnt/tmp_device\n      mount:\n        name: /mnt/tmp_device\n        src: \"{{ device }}\"\n        fstype: \"{{ file_system }}\"\n        opts: defaults\n        state: absent\n\n    - name: mount\n      mount:\n        name: \"{{ mount_point }}\"\n        src: \"UUID={{ uuid.stdout }}\"\n        fstype: \"{{ file_system }}\"\n        opts: defaults\n        state: mounted\n\n    - name: reboot\n      shell: shutdown -r now\n      when: reboot == true\n```\n\n```yaml:hosts\n[app]\nxxx.xxx.xxx.xxx\n```\n\n\u5b9f\u884c\n\n```bash\n$ ansible-playbook mount.yml -i hosts\n```\n\n### \u7d50\u679c\n\n\u5b9f\u884c\u524d\n\n```bash\n$ df -Th\nFilesystem     Type   Size  Used Avail Use% Mounted on\n/dev/sda1      ext4    15G  1.1G   13G   8% /\ntmpfs          tmpfs  495M     0  495M   0% /dev/shm\n```\n\n\u5b9f\u884c\u5f8c\n\n```bash\n$ df -Th\nFilesystem     Type   Size  Used Avail Use% Mounted on\n/dev/sda1      ext4    15G 1002M   13G   8% /\ntmpfs          tmpfs  495M     0  495M   0% /dev/shm\n/dev/sdb       xfs   1014M  119M  896M  12% /var\n```\n\n## \u53c2\u8003\n\n- [mount \\- Control active and configured mount points \u2014 Ansible Documentation](http://docs.ansible.com/ansible/mount_module.html)\n- [\u30a2\u30bf\u30c3\u30c1\u3057\u305f\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u4f7f\u7528\u3059\u308b\u70ba\u306e\u4e8b\u524d\u6e96\u5099\uff08CentOS5,6\u7cfb/\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u7121\u3057\u306e\u5834\u5408\uff09 | IDCF\u30af\u30e9\u30a6\u30c9](https://www.faq.idcf.jp/app/answers/detail/a_id/546/related/1/session/L2F2LzEvdGltZS8xNDgwMDA2NTM2L3NpZC9mVUd1c0xSbURCMTdIVXhXazlrcXM3U0NtM1N5OUVUUFpWdnNqMURESjJVdlVNWFUwd0NIQW9LYnB1T0I3R1hKdGFSWmtUUkF5VU1LOGZkRk9OaCU3RUMzVVJQdGZFVjVLZ1gxMmxWd05uT29tVUd1eHZYUmUlN0VxSTVnJTIxJTIx)\n- [\u30c7\u30a3\u30b9\u30af\u306e\u8ffd\u52a0\u624b\u9806\u3092\u307e\u3068\u3081\u3066\u307f\u305f\\(\u901a\u5e38\u30c7\u30a3\u30b9\u30af\u7de8\\)\u00a0\\|\u00a0\u30ec\u30f3\u30bf\u30eb\u30b5\u30fc\u30d0\u30fc\u30fb\u81ea\u5b85\u30b5\u30fc\u30d0\u30fc\u8a2d\u5b9a\u30fb\u69cb\u7bc9\u306e\u30d2\u30f3\u30c8](http://server-setting.info/centos/add-disk-normal.html)\n", "tags": ["CentOS", "Ansible", "IDCF\u30af\u30e9\u30a6\u30c9"]}