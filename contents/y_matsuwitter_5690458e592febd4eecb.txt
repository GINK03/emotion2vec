{"context": " More than 1 year has passed since last update.\n\ninstall\nredis\u306finstall\u6e08\u307f\u3068\u3057\u307e\u3059\u3002\ncd /usr/local/src\n\n# lua\u306einstall\nwget -O lua-nginx-module.tar.gz https://github.com/chaoslawful/lua-nginx-module/tarball/master\ntar zxvf lua-nginx-module.tar.gz\n\n# luajit\u306einstall\nwget http://luajit.org/download/LuaJIT-2.0.0.tar.gz\ntar zxvf LuaJIT-2.0.0.tar.gz\ncd LuaJIT-2.0.0\nmake\n\n#lua-nginx-module\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\ngit clone https://github.com/chaoslawful/lua-nginx-module.git\n\n#nginx\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nwget http://nginx.org/download/nginx-1.3.6.tar.gz\ntar zxvf nginx-1.3.6.tar.gz\ncd nginx-1.3.6\n\n# \u5fc5\u8981\u306a\u30e2\u30b8\u30e5\u30fc\u30ebintall\nyum -y install pcre-devel libxml2 libxml2-devel libxslt libxslt-devel gd-devel GeoIP-devel perl-devel\n\n#configure\n./configure \\\n--with-http_ssl_module \\\n--with-http_realip_module \\\n--with-http_addition_module \\\n--with-http_xslt_module \\\n--with-http_image_filter_module \\\n--with-http_geoip_module \\\n--with-http_sub_module \\\n--with-http_dav_module \\\n--with-http_flv_module \\\n--with-http_mp4_module \\\n--with-http_gzip_static_module \\\n--with-http_random_index_module \\\n--with-http_secure_link_module \\\n--with-http_degradation_module \\\n--with-http_stub_status_module \\\n--with-debug \\\n--add-module=/usr/local/src/lua-nginx-module \\\n--add-module=/usr/local/src/ngx_http_redis-0.3.6 \\\n--add-module=/usr/local/src/ngx_cache_purge-2.0 \\\n--add-module=/usr/local/src/agentzh-headers-more-nginx-module-27bcbd2\n\nmake\nmake install\n\n\n\u8d77\u52d5\u5468\u308a\u306a\u3069\n/etc/init.d/nginx \u3068\u3044\u3046\u4ee5\u4e0b\u306e\u5185\u5bb9\u306e\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\u3002\n#!/bin/sh                                                                                                                                                                  \n#                                                                                                                                                                          \n# nginx - this script starts and stops the nginx daemon                                                                                                                    \n#                                                                                                                                                                          \n# chkconfig:   - 85 15                                                                                                                                                     \n# description:  Nginx is an HTTP(S) server, HTTP(S) reverse \\                                                                                                              \n#               proxy and IMAP/POP3 proxy server                                                                                                                           \n# processname: nginx                                                                                                                                                       \n\n# Source function library.                                                                                                                                                 \n. /etc/rc.d/init.d/functions\n\n# Source networking configuration.                                                                                                                                         \n. /etc/sysconfig/network\n\n# Check that networking is up.                                                                                                                                             \n[ \"$NETWORKING\" = \"no\" ] && exit 0\n\nnginx=\"/usr/local/nginx/sbin/nginx\"\nprog=$(basename $nginx)\n\nNGINX_CONF_FILE=\"/usr/local/nginx/conf/nginx.conf\"\n\nlockfile=/usr/local/nginx/logs/nginx.lock\n\nstart() {\n    [ -x $nginx ] || exit 5\n    [ -f $NGINX_CONF_FILE ] || exit 6\n    echo -n $\"Starting $prog: \"\n    daemon $nginx -c $NGINX_CONF_FILE\n    retval=$?\n    echo\n    [ $retval -eq 0 ] && touch $lockfile\n    return $retval\n}\n\nstop() {\n    echo -n $\"Stopping $prog: \"\n    killproc $prog -QUIT\n    retval=$?\n    echo\n    [ $retval -eq 0 ] && rm -f $lockfile\n    return $retval\n}\n\nrestart() {\n    configtest || return $?\n    stop\n    sleep 1\n    start\n}\n\nreload() {\n    configtest || return $?\n    echo -n $\"Reloading $prog: \"\n    killproc $nginx -HUP\n    RETVAL=$?\n    echo\n}\n\nforce_reload() {\n    restart\n}\n\nconfigtest() {\n  $nginx -t -c $NGINX_CONF_FILE\n}\n\nrh_status() {\n    status $prog\n}\n\nrh_status_q() {\n    rh_status >/dev/null 2>&1\n}\n\ncase \"$1\" in\n    start)\n        rh_status_q && exit 0\n        $1\n        ;;\n    stop)\n        rh_status_q || exit 0\n        $1\n        ;;\n    restart|configtest)\n        $1\n        ;;\n    reload)\n        rh_status_q || exit 7\n        $1\n        ;;\n    force-reload)\n        force_reload\n        ;;\n    status)\n        rh_status\n    ;;\n    condrestart|try-restart)\n        rh_status_q || exit 0\n            ;;\n    *)\n        echo $\"Usage: $0 {start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest}\"\n        exit 2\nesac\n\n\u305d\u306e\u5f8c\u3001\u81ea\u52d5\u3067\u8d77\u52d5\u3059\u308b\u3088\u3046\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3002\nchmod +x /etc/init.d/nginx\nchkconfig --add nginx\nchkconfig nginx on\nservice nginx start\n\n\u8272\u3005\u904a\u3093\u3067\u307f\u307e\u3059\u3002\n\n\u53c2\u8003\nhttp://d.hatena.ne.jp/jimsei/20120926/1348683140\nhttp://www.happytrap.jp/blogs/2012/02/23/8243/\n\n\u3061\u306a\u307f\u306b\n--with-http-perl-module\u5165\u308c\u3088\u3046\u3068\u3057\u305f\u3051\u3069\u3001perl\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u9055\u3044\u3067\u5165\u308c\u308b\u306e\u3092\u9762\u5012\u81ed\u304c\u3063\u3066\u8f9e\u3081\u305f\u3002\n\u3042\u3068\u5b9f\u969b\u306b\u306f\u3001cache_perge\u3068headers_more\u3082\u5c0e\u5165\u3057\u305f\u3002\n\n## install\nredis\u306finstall\u6e08\u307f\u3068\u3057\u307e\u3059\u3002\n\n```\ncd /usr/local/src\n\n# lua\u306einstall\nwget -O lua-nginx-module.tar.gz https://github.com/chaoslawful/lua-nginx-module/tarball/master\ntar zxvf lua-nginx-module.tar.gz\n\n# luajit\u306einstall\nwget http://luajit.org/download/LuaJIT-2.0.0.tar.gz\ntar zxvf LuaJIT-2.0.0.tar.gz\ncd LuaJIT-2.0.0\nmake\n\n#lua-nginx-module\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\ngit clone https://github.com/chaoslawful/lua-nginx-module.git\n\n#nginx\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nwget http://nginx.org/download/nginx-1.3.6.tar.gz\ntar zxvf nginx-1.3.6.tar.gz\ncd nginx-1.3.6\n\n# \u5fc5\u8981\u306a\u30e2\u30b8\u30e5\u30fc\u30ebintall\nyum -y install pcre-devel libxml2 libxml2-devel libxslt libxslt-devel gd-devel GeoIP-devel perl-devel\n\n#configure\n./configure \\\n--with-http_ssl_module \\\n--with-http_realip_module \\\n--with-http_addition_module \\\n--with-http_xslt_module \\\n--with-http_image_filter_module \\\n--with-http_geoip_module \\\n--with-http_sub_module \\\n--with-http_dav_module \\\n--with-http_flv_module \\\n--with-http_mp4_module \\\n--with-http_gzip_static_module \\\n--with-http_random_index_module \\\n--with-http_secure_link_module \\\n--with-http_degradation_module \\\n--with-http_stub_status_module \\\n--with-debug \\\n--add-module=/usr/local/src/lua-nginx-module \\\n--add-module=/usr/local/src/ngx_http_redis-0.3.6 \\\n--add-module=/usr/local/src/ngx_cache_purge-2.0 \\\n--add-module=/usr/local/src/agentzh-headers-more-nginx-module-27bcbd2\n\nmake\nmake install\n```\n\n## \u8d77\u52d5\u5468\u308a\u306a\u3069\n/etc/init.d/nginx \u3068\u3044\u3046\u4ee5\u4e0b\u306e\u5185\u5bb9\u306e\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\u3002\n\n```\n#!/bin/sh                                                                                                                                                                  \n#                                                                                                                                                                          \n# nginx - this script starts and stops the nginx daemon                                                                                                                    \n#                                                                                                                                                                          \n# chkconfig:   - 85 15                                                                                                                                                     \n# description:  Nginx is an HTTP(S) server, HTTP(S) reverse \\                                                                                                              \n#               proxy and IMAP/POP3 proxy server                                                                                                                           \n# processname: nginx                                                                                                                                                       \n\n# Source function library.                                                                                                                                                 \n. /etc/rc.d/init.d/functions\n\n# Source networking configuration.                                                                                                                                         \n. /etc/sysconfig/network\n\n# Check that networking is up.                                                                                                                                             \n[ \"$NETWORKING\" = \"no\" ] && exit 0\n\nnginx=\"/usr/local/nginx/sbin/nginx\"\nprog=$(basename $nginx)\n\nNGINX_CONF_FILE=\"/usr/local/nginx/conf/nginx.conf\"\n\nlockfile=/usr/local/nginx/logs/nginx.lock\n\nstart() {\n    [ -x $nginx ] || exit 5\n    [ -f $NGINX_CONF_FILE ] || exit 6\n    echo -n $\"Starting $prog: \"\n    daemon $nginx -c $NGINX_CONF_FILE\n    retval=$?\n    echo\n    [ $retval -eq 0 ] && touch $lockfile\n    return $retval\n}\n\nstop() {\n    echo -n $\"Stopping $prog: \"\n    killproc $prog -QUIT\n    retval=$?\n    echo\n    [ $retval -eq 0 ] && rm -f $lockfile\n    return $retval\n}\n\nrestart() {\n    configtest || return $?\n    stop\n    sleep 1\n    start\n}\n\nreload() {\n    configtest || return $?\n    echo -n $\"Reloading $prog: \"\n    killproc $nginx -HUP\n    RETVAL=$?\n    echo\n}\n\nforce_reload() {\n    restart\n}\n\nconfigtest() {\n  $nginx -t -c $NGINX_CONF_FILE\n}\n\nrh_status() {\n    status $prog\n}\n\nrh_status_q() {\n    rh_status >/dev/null 2>&1\n}\n\ncase \"$1\" in\n    start)\n        rh_status_q && exit 0\n        $1\n        ;;\n    stop)\n        rh_status_q || exit 0\n        $1\n        ;;\n    restart|configtest)\n        $1\n        ;;\n    reload)\n        rh_status_q || exit 7\n        $1\n        ;;\n    force-reload)\n        force_reload\n        ;;\n    status)\n        rh_status\n    ;;\n    condrestart|try-restart)\n        rh_status_q || exit 0\n            ;;\n    *)\n        echo $\"Usage: $0 {start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest}\"\n        exit 2\nesac\n```\n\n\u305d\u306e\u5f8c\u3001\u81ea\u52d5\u3067\u8d77\u52d5\u3059\u308b\u3088\u3046\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\n```\nchmod +x /etc/init.d/nginx\nchkconfig --add nginx\nchkconfig nginx on\nservice nginx start\n```\n\n\u8272\u3005\u904a\u3093\u3067\u307f\u307e\u3059\u3002\n\n## \u53c2\u8003\nhttp://d.hatena.ne.jp/jimsei/20120926/1348683140\nhttp://www.happytrap.jp/blogs/2012/02/23/8243/\n\n## \u3061\u306a\u307f\u306b\n--with-http-perl-module\u5165\u308c\u3088\u3046\u3068\u3057\u305f\u3051\u3069\u3001perl\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u9055\u3044\u3067\u5165\u308c\u308b\u306e\u3092\u9762\u5012\u81ed\u304c\u3063\u3066\u8f9e\u3081\u305f\u3002\n\u3042\u3068\u5b9f\u969b\u306b\u306f\u3001cache_perge\u3068headers_more\u3082\u5c0e\u5165\u3057\u305f\u3002", "tags": ["nginx", "Lua", "Redis"]}