{"tags": ["CakePHP", "rest"], "context": " More than 1 year has passed since last update.sencha\u7528\u306bCakePHP2\u306eREST\u8a2d\u5b9a\u3092\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u203b\u4f5c\u6210\u6642\u306eCakePHP\u30d0\u30fc\u30b8\u30e7\u30f3\u306f 2.5.2 \u3068\u306a\u308a\u307e\u3059\u3002\n\u25a0\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u6e96\u5099\n\npostgresql\nCREATE TABLE todos\n(\n  id serial NOT NULL,\n  title character varying(32) NOT NULL,\n  require smallint NOT NULL,\n  deadline date NOT NULL,\n  CONSTRAINT todos_pkey PRIMARY KEY (id)\n)\n\n\n\u25a0CakePHP \u65b0\u3057\u3044\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210(hoge)\n\nsh\nVendor/bin/cake bake project hoge \ncd hoge\nConsole/cake bake \n***\n\n\n\u25a0vi Config/database.php\n\nphp\n<?php\nclass DATABASE_CONFIG {\n        public $default = array(\n                'datasource' => 'Database/Postgres',\n                'persistent' => false,\n                'schema' => 'public',\n                'host' => '192.168.***.***',\n                'port' => 5432,\n                'login' => 'user',\n                'password' => 'password',\n                'database' => 'hoge',\n                'encoding' => 'UTF-8'\n        );\n}\n?>\n\n\n\u25a0\u3068\u308a\u3042\u3048\u305a\u306f\u30b9\u30ab\u30d5\u30a9\u30eb\u30c7\u30a3\u30f3\u30b0\u3057\u3066\u52d5\u4f5c\u78ba\u8a8d\n\nsh\nConsole/cake bake all\n\n\n\u203b\u30d6\u30e9\u30a6\u30b6\u3067\u78ba\u8a8d\nhttp://192.168.***.***/todos/\n\uff12\u30fb\uff13\u30c7\u30fc\u30bf\u3092\u767b\u9332\u3057\u3066\u304a\u304f\u3002\n\u25a0\u30eb\u30fc\u30bf\u30fc\u306e\u8a2d\u5b9a( vi Config/routes.php  )\n\u4e0b\u8a18\u3092 require CAKE . 'Config' . DS . 'routes.php'; \u306e\u524d\u306b\u8a18\u8ff0\u3059\u308b\u3002\n\nphp\n/**\n* REST Router\n*/\nRouter::parseExtensions('json');\nRouter::resourceMap(array(\narray('action' => 'index', 'method' => 'GET', 'id' => false),\narray('action' => 'view', 'method' => 'GET', 'id' => true),\narray('action' => 'add', 'method' => 'POST', 'id' => false),\narray('action' => 'edit', 'method' => 'PUT', 'id' => true),\narray('action' => 'delete', 'method' => 'DELETE', 'id' => true),\n));\n\nRouter::connect(\n\"/:controller\",\narray(\"action\" => \"add\", \"[method]\" =>'POST'),\narray(\"id\" => \"[0-9]+\")\n);\n\nRouter::connect(\n\"/:controller/:id\",\narray(\"action\" => \"view\", \"[method]\" =>'GET'),\narray(\"id\" => \"[0-9]+\")\n);\n\nRouter::connect(\n\"/:controller/:id\",\narray(\"action\" => \"view\", \"[method]\" =>'OPTIONS'),\narray(\"id\" => \"[0-9]+\")\n);\n\nRouter::connect(\n\"/:controller/:id\",\narray(\"action\" => \"delete\", \"[method]\" =>'DELETE'),\narray(\"id\" => \"[0-9]+\")\n);\n\nRouter::connect(\n\"/:controller/:id\",\narray(\"action\" => \"edit\", \"[method]\" =>'PUT'),\narray(\"id\" => \"[0-9]+\")\n);\n\n\n\n\u25a0\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306e\u8a2d\u5b9a  ( vi Controller/AppController.php )\n\u4eca\u56de\u306f\u5168\u3066\u306e\u30e2\u30c7\u30eb\u3092REST\u6271\u3044\u306b\u3059\u308b\u3002\n\u30e2\u30c7\u30eb\u3054\u3068\u306b\u8a2d\u5b9a\u3059\u308b\u306a\u3089\u3070\u5404\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306b\u8a18\u8ff0\u3059\u308b\u3002\n\nphp\n<?php\n/**\n * Application level Controller\n *\n * This file is application-wide controller file. You can put all\n * application-wide controller-related methods here.\n *\n * @link          http://cakephp.org CakePHP(tm) Project\n * @package       app.Controller\n * @since         CakePHP(tm) v 0.2.9\n */\n\nApp::uses('Controller', 'Controller');\n\n/**\n * Application Controller\n *\n * Add your application-wide methods in the class below, your controllers\n * will inherit them.\n *\n * @package     app.Controller\n * @link        http://book.cakephp.org/2.0/en/controllers.html#the-app-controller\n*/\nclass AppController extends Controller {\n\n    public $components = array('RequestHandler');\n\n    public function beforeFilter()\n    {\n        if ( $this->request->is('options') ) {\n            $this->_set_json( 'OK' );\n        }\n        $this->response->header('Access-Control-Allow-Origin: *');\n        $this->response->header('Access-Control-Allow-Headers: Origin, X-Requested-With, Content-Type, Accept');\n        $this->response->header('Access-Control-Allow-Methods: GET, PUT, POST, DELETE, OPTIONS');\n    }\n\n\n    public function index()\n    {\n        if ( $this->request->is('options')==false ) {\n            $this->_set_json( $this->{ $this->modelClass }->find('all') );\n        }\n    }\n\n\n    public function view($id=null)\n    {\n        if ( $this->request->is('options')==false ) {\n            $this->_set_json( $this->{ $this->modelClass }->findById($id) );\n        }\n    }\n\n\n    public function add()\n    {\n        if ( $this->request->is('options')==false ) {\n            $this->request->data['id']=null;\n            $this->{ $this->modelClass }->create();\n            $results = $this->{ $this->modelClass }->save($this->request->data);\n            if ( $results ) {\n                $results = 'Saved';\n            } else {\n                $results = 'Error';\n            }\n            $this->_set_json( $results );\n        }\n    }\n\n\n    public function edit($id=null)\n    {\n        if ( $this->request->is('options')==false ) {\n            $this->{ $this->modelClass }->id = $id;\n            $results = $this->{ $this->modelClass }->save($this->request->data);\n            if ( $results ) {\n                $results = 'Saved';\n            } else {\n                $results = 'Error';\n            }\n            $this->_set_json( $results );\n        }\n    }\n\n\n    public function delete($id=null)\n    {\n        if ( $this->request->is('options')==false ) {\n            $results = $this->{ $this->modelClass }->delete( $this->request->params['id'] );\n            if ( $results ) {\n                $results = 'Saved';\n            } else {\n                $results = 'Error';\n            }\n            $this->_set_json( $results );\n        }\n    }\n\n\n    function _set_json($results)\n    {\n        $this->set(array(\n                'results' => $results,\n                '_serialize' => array('results')\n        ));\n    }\n\n\n}\n\n\n\u25a0\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306e\u4e2d\u8eab\u3092\u524a\u9664 ( vi Controller/TodosController.php ) \n\nphp\n<?php\nApp::uses('AppController', 'Controller');\nclass TodosController extends AppController {\n}\n\n\n\u25a0View/Todo \u524a\u9664\n\nsh\nrm -rf View/Todos/\n\n\n\u25a0\u30d6\u30e9\u30a6\u30b6\u306b\u3066\u52d5\u4f5c\u78ba\u8a8d\n\u4ee5\u4e0b\u306e\u69d8\u306aURL\u306b\u3066\u5e0c\u671b\u306e\u66f8\u5f0f\u3067\u30c7\u30fc\u30bf\u304c\u623b\u308c\u3070OK\u3067\u3059\u3002\nhttp://192.168.***.***/todos.json\nhttp://192.168.***.***/todos.xml\nhttp://192.168.***.***/todos/2.json\n\u4ee5\u4e0a\nsencha\u7528\u306bCakePHP2\u306eREST\u8a2d\u5b9a\u3092\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u203b\u4f5c\u6210\u6642\u306eCakePHP\u30d0\u30fc\u30b8\u30e7\u30f3\u306f 2.5.2 \u3068\u306a\u308a\u307e\u3059\u3002\n\n\u25a0\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u6e96\u5099\n\n```lang:postgresql\nCREATE TABLE todos\n(\n  id serial NOT NULL,\n  title character varying(32) NOT NULL,\n  require smallint NOT NULL,\n  deadline date NOT NULL,\n  CONSTRAINT todos_pkey PRIMARY KEY (id)\n)\n```\n\n\u25a0CakePHP \u65b0\u3057\u3044\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210(hoge)\n\n```lang:sh\nVendor/bin/cake bake project hoge \ncd hoge\nConsole/cake bake \n***\n```\n\n\u25a0vi Config/database.php\n\n```lang:php\n<?php\nclass DATABASE_CONFIG {\n        public $default = array(\n                'datasource' => 'Database/Postgres',\n                'persistent' => false,\n                'schema' => 'public',\n                'host' => '192.168.***.***',\n                'port' => 5432,\n                'login' => 'user',\n                'password' => 'password',\n                'database' => 'hoge',\n                'encoding' => 'UTF-8'\n        );\n}\n?>\n```\n\n\u25a0\u3068\u308a\u3042\u3048\u305a\u306f\u30b9\u30ab\u30d5\u30a9\u30eb\u30c7\u30a3\u30f3\u30b0\u3057\u3066\u52d5\u4f5c\u78ba\u8a8d\n\n\n```lang:sh\nConsole/cake bake all\n```\n\n\u203b\u30d6\u30e9\u30a6\u30b6\u3067\u78ba\u8a8d\nhttp://192.168.***.***/todos/\n\uff12\u30fb\uff13\u30c7\u30fc\u30bf\u3092\u767b\u9332\u3057\u3066\u304a\u304f\u3002\n\n\u25a0\u30eb\u30fc\u30bf\u30fc\u306e\u8a2d\u5b9a( vi Config/routes.php  )\n\n\u4e0b\u8a18\u3092 require CAKE . 'Config' . DS . 'routes.php'; \u306e\u524d\u306b\u8a18\u8ff0\u3059\u308b\u3002\n\n```lang:php\n/**\n* REST Router\n*/\nRouter::parseExtensions('json');\nRouter::resourceMap(array(\narray('action' => 'index', 'method' => 'GET', 'id' => false),\narray('action' => 'view', 'method' => 'GET', 'id' => true),\narray('action' => 'add', 'method' => 'POST', 'id' => false),\narray('action' => 'edit', 'method' => 'PUT', 'id' => true),\narray('action' => 'delete', 'method' => 'DELETE', 'id' => true),\n));\n\nRouter::connect(\n\"/:controller\",\narray(\"action\" => \"add\", \"[method]\" =>'POST'),\narray(\"id\" => \"[0-9]+\")\n);\n\nRouter::connect(\n\"/:controller/:id\",\narray(\"action\" => \"view\", \"[method]\" =>'GET'),\narray(\"id\" => \"[0-9]+\")\n);\n\nRouter::connect(\n\"/:controller/:id\",\narray(\"action\" => \"view\", \"[method]\" =>'OPTIONS'),\narray(\"id\" => \"[0-9]+\")\n);\n\nRouter::connect(\n\"/:controller/:id\",\narray(\"action\" => \"delete\", \"[method]\" =>'DELETE'),\narray(\"id\" => \"[0-9]+\")\n);\n\nRouter::connect(\n\"/:controller/:id\",\narray(\"action\" => \"edit\", \"[method]\" =>'PUT'),\narray(\"id\" => \"[0-9]+\")\n);\n\n```\n\n\u25a0\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306e\u8a2d\u5b9a  ( vi Controller/AppController.php )\n\n\u4eca\u56de\u306f\u5168\u3066\u306e\u30e2\u30c7\u30eb\u3092REST\u6271\u3044\u306b\u3059\u308b\u3002\n\u30e2\u30c7\u30eb\u3054\u3068\u306b\u8a2d\u5b9a\u3059\u308b\u306a\u3089\u3070\u5404\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306b\u8a18\u8ff0\u3059\u308b\u3002\n\n```lang:php\n<?php\n/**\n * Application level Controller\n *\n * This file is application-wide controller file. You can put all\n * application-wide controller-related methods here.\n *\n * @link          http://cakephp.org CakePHP(tm) Project\n * @package       app.Controller\n * @since         CakePHP(tm) v 0.2.9\n */\n\nApp::uses('Controller', 'Controller');\n\n/**\n * Application Controller\n *\n * Add your application-wide methods in the class below, your controllers\n * will inherit them.\n *\n * @package\t\tapp.Controller\n * @link\t\thttp://book.cakephp.org/2.0/en/controllers.html#the-app-controller\n*/\nclass AppController extends Controller {\n\n\tpublic $components = array('RequestHandler');\n\n\tpublic function beforeFilter()\n\t{\n\t\tif ( $this->request->is('options') ) {\n\t\t\t$this->_set_json( 'OK' );\n\t\t}\n\t\t$this->response->header('Access-Control-Allow-Origin: *');\n\t\t$this->response->header('Access-Control-Allow-Headers: Origin, X-Requested-With, Content-Type, Accept');\n\t\t$this->response->header('Access-Control-Allow-Methods: GET, PUT, POST, DELETE, OPTIONS');\n\t}\n\n\n\tpublic function index()\n\t{\n\t\tif ( $this->request->is('options')==false ) {\n\t\t\t$this->_set_json( $this->{ $this->modelClass }->find('all') );\n\t\t}\n\t}\n\n\n\tpublic function view($id=null)\n\t{\n\t\tif ( $this->request->is('options')==false ) {\n\t\t\t$this->_set_json( $this->{ $this->modelClass }->findById($id) );\n\t\t}\n\t}\n\n\n\tpublic function add()\n\t{\n\t\tif ( $this->request->is('options')==false ) {\n\t\t\t$this->request->data['id']=null;\n\t\t\t$this->{ $this->modelClass }->create();\n\t\t\t$results = $this->{ $this->modelClass }->save($this->request->data);\n\t\t\tif ( $results ) {\n\t\t\t\t$results = 'Saved';\n\t\t\t} else {\n\t\t\t\t$results = 'Error';\n\t\t\t}\n\t\t\t$this->_set_json( $results );\n\t\t}\n\t}\n\n\n\tpublic function edit($id=null)\n\t{\n\t\tif ( $this->request->is('options')==false ) {\n\t\t\t$this->{ $this->modelClass }->id = $id;\n\t\t\t$results = $this->{ $this->modelClass }->save($this->request->data);\n\t\t\tif ( $results ) {\n\t\t\t\t$results = 'Saved';\n\t\t\t} else {\n\t\t\t\t$results = 'Error';\n\t\t\t}\n\t\t\t$this->_set_json( $results );\n\t\t}\n\t}\n\n\n\tpublic function delete($id=null)\n\t{\n\t\tif ( $this->request->is('options')==false ) {\n\t\t\t$results = $this->{ $this->modelClass }->delete( $this->request->params['id'] );\n\t\t\tif ( $results ) {\n\t\t\t\t$results = 'Saved';\n\t\t\t} else {\n\t\t\t\t$results = 'Error';\n\t\t\t}\n\t\t\t$this->_set_json( $results );\n\t\t}\n\t}\n\n\n\tfunction _set_json($results)\n\t{\n\t\t$this->set(array(\n\t\t\t\t'results' => $results,\n\t\t\t\t'_serialize' => array('results')\n\t\t));\n\t}\n\n\n}\n```\n\n\u25a0\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306e\u4e2d\u8eab\u3092\u524a\u9664 ( vi Controller/TodosController.php ) \n\n```file:php\n<?php\nApp::uses('AppController', 'Controller');\nclass TodosController extends AppController {\n}\n```\n\n\u25a0View/Todo \u524a\u9664\n\n```lang:sh\nrm -rf View/Todos/\n```\n\n\u25a0\u30d6\u30e9\u30a6\u30b6\u306b\u3066\u52d5\u4f5c\u78ba\u8a8d\n\n\u4ee5\u4e0b\u306e\u69d8\u306aURL\u306b\u3066\u5e0c\u671b\u306e\u66f8\u5f0f\u3067\u30c7\u30fc\u30bf\u304c\u623b\u308c\u3070OK\u3067\u3059\u3002\n\nhttp://192.168.***.***/todos.json\nhttp://192.168.***.***/todos.xml\nhttp://192.168.***.***/todos/2.json\n\n\u4ee5\u4e0a\n"}