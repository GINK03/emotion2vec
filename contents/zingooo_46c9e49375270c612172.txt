{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\nBEAR.Sunday\u304c\u6a19\u6e96\u3067\u63d0\u4f9b\u3059\u308b\u30d5\u30a9\u30fc\u30e0\u30e9\u30a4\u30d6\u30e9\u30ea\u306fAura.Input\u3067\u3059\u304c\u3001\u30d5\u30eb\u30b9\u30bf\u30c3\u30af\u30b9\u30bf\u30a4\u30eb\u3067\u63d0\u4f9b\u3055\u308c\u308b\u69d8\u3005\u306a\u30d5\u30a9\u30fc\u30e0\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u6069\u6075\u3092\u53d7\u3051\u305f\u3044\u30b1\u30fc\u30b9\u3082\u591a\u3005\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u4eca\u56de\u306fZendFramework2\u306eZend\\Form\u3092BEAR.Sunday\u3067\u5229\u7528\u3059\u308b\u4e00\u4f8b\u3092\u7d39\u4ecb\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\nBEAR.Sunday\u306e\u30d5\u30a9\u30fc\u30e0\u5b9f\u88c5\u3092\u8e0f\u8972\u3057\u3066\u3001\u4eca\u56de\u3082\u30d5\u30a9\u30fc\u30e0\u306f\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc\u3068\u3057\u3066\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\n\u30d5\u30a9\u30fc\u30e0\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc\u306e\u4f5c\u6210\n\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\ntrait\u306e\u5b9f\u88c5\n\u307e\u305a\u3001\u30d5\u30a9\u30fc\u30e0\u5171\u901a\u3067\u5229\u7528\u3059\u308b\u51e6\u7406\u3092trait\u3068\u3057\u3066\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\nInterceptor\\ZendForm\\ZendFormInject.php\n<?php\nnamespace My\\App\\Interceptor\\ZendForm;\n\nuse BEAR\\Resource\\NamedParameter;\nuse Ray\\Aop\\MethodInvocation;\nuse Ray\\Di\\Di\\Inject;\n\n/**\n * Class ZendFormInject\n * @package My\\App\\Interceptor\\ZendForm\n */\ntrait ZendFormInject\n{\n    /**\n     * @var array\n     */\n    private $defaultValue = [];\n\n    /**\n     * @var NamedParameter\n     */\n    private $params;\n\n    /**\n     * @var bool\n     */\n    public $hasSubmit = false;\n\n    /**\n     * @param NamedParameter $params\n     * @Inject\n     */\n    public function setNamedParameter(NamedParameter $params)\n    {\n        $this->params = $params;\n    }\n\n    /**\n     * @param MethodInvocation $invocation\n     * @return mixed|object\n     */\n    public function invoke(MethodInvocation $invocation)\n    {\n        $this->hasSubmit = $invocation->getMethod()->name === 'onPost';\n        if ($this->hasSubmit) {\n            $this->defaultValue = $_POST;\n        }\n        /** @noinspection PhpUndefinedMethodInspection */\n        $this->setForm();\n\n        /** @var \\BEAR\\Resource\\ResourceObject $page */\n        $page = $invocation->getThis();\n        $method = $invocation->getMethod()->name;\n        $page->body['form'] = $this;\n\n        if ($this->hasSubmit && $this->isValid()) {\n            $data = $this->getData();\n            $args = $this->params->getArgs([$page, $method], $data);\n            return call_user_func_array([$page, 'onPost'], $args);\n        }\n\n        return call_user_func_array([$page, 'onGet'], (array) $invocation->getArguments());\n    }\n}\n\n\n\n\u3053\u3053\u3067\u306f\u4ee5\u4e0b\u306e\u51e6\u7406\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n1. \u30d5\u30a9\u30fc\u30e0\u4f5c\u6210\u51e6\u7406\u306e\u5b9f\u884c\n2. \u30d5\u30a9\u30fc\u30e0\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\n3. PageResourceObject\u306e\u30e1\u30bd\u30c3\u30c9\u5b9f\u884c\n\u4f59\u8ac7\u3067\u3059\u304c\u3001\u3053\u3061\u3089\u306e\u30b3\u30fc\u30c9\u306b\u306f\u5c11\u3057\u554f\u984c\u304c\u3042\u308a\u307e\u3059\u3002\n\u672c\u6765\u3001Ray.AOP\u3067\u306f\u672c\u8cea\u306e\u51e6\u7406\u3092\u5b9f\u884c\u3059\u308b\u969b\u306b\u306f\u4ee5\u4e0b\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u304c\u3001\n$invocation->proceed(); \n\n\u4eca\u56de\u306fResourceObject\u306e\u3069\u306e\u30e1\u30bd\u30c3\u30c9\uff08onGet or onPost\uff09\u3092\u547c\u3073\u51fa\u3059\u3079\u304d\u304b\u3068\u3044\u3046\u70b9\u304c\u3001\u30d5\u30a9\u30fc\u30e0\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u7d50\u679c\u306b\u3088\u3063\u3066\u5de6\u53f3\u3055\u308c\u307e\u3059\u306e\u3067\u3001\u4ee3\u308f\u308a\u306b\u4ee5\u4e0b\u306e\u65b9\u6cd5\u3067\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u51fa\u3057\u3066\u3044\u307e\u3059\u3002\ncall_user_func_array([$page, 'onGet'], (array) $invocation->getArguments());\n\n\u3053\u306e\u65b9\u6cd5\u3067\u306f\u672c\u30a2\u30b9\u30da\u30af\u30c8\u4ee5\u964d\u306b\u30d0\u30a4\u30f3\u30c9\u3055\u308c\u305f\u51e6\u7406\u304c\u5b9f\u884c\u3055\u308c\u307e\u305b\u3093\u3002\n\u73fe\u5728\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306eRay\uff082014/12/12\u6642\u70b9\uff09\u3067\u306f\u3001\u5b9f\u884c\u3055\u308c\u308b\u9806\u756a\u306f\u30d0\u30a4\u30f3\u30c9\u3055\u308c\u308b\u9806\u756a\u306b\u4f9d\u5b58\u3057\u3066\u3044\u307e\u3059\u3002\n\u305d\u3053\u3060\u3051\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002\n\nForm\u306e\u5b9f\u88c5\n\u6b21\u306bForm\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\u4eca\u56de\u306f\u30e6\u30fc\u30b6\u767b\u9332\u30d5\u30a9\u30fc\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nInterceptor/Form/Join.php\n<?php\nnamespace My\\App\\Interceptor\\Form;\n\nuse BEAR\\Sunday\\Inject\\ResourceInject;\nuse Ray\\Aop\\MethodInterceptor;\nuse Ray\\Di\\Di\\Inject;\nuse Ray\\Di\\Di\\Named;\nuse My\\App\\Interceptor\\ZendForm\\ZendFormInject;\nuse Zend\\Form\\Form;\nuse Zend\\InputFilter\\InputFilterAwareInterface;\n\n/**\n * Class Join\n * @package My\\App\\Interceptor\\Form\n */\nclass Join extends Form implements MethodInterceptor\n{\n    use ResourceInject;\n    use ZendFormInject;\n\n    /**\n     * @var InputFilterAwareInterface\n     */\n    private $validator;\n\n    /**\n     * @param InputFilterAwareInterface $validator\n     * @Inject\n     * @Named(\"join\")\n     */\n    public function setValidator(InputFilterAwareInterface $validator)\n    {\n        $this->validator = $validator;\n    }\n\n    /**\n     * (non-PHPDoc)\n     */\n    private function setForm()\n    {\n        $this->setName('joinForm');\n        $this->setAttribute('method', 'post');\n\n        // \u30e6\u30fc\u30b6\u540d\n        $this->add(\n            [\n                'name' => 'name',\n                'type' => 'Zend\\Form\\Element\\Text',\n                'attributes' => [\n                    'placeholder' => '\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0',\n                    'required' => 'required',\n                    'maxlength' => 32\n                ]\n            ]\n        );\n\n        // \u30d1\u30b9\u30ef\u30fc\u30c9\n        $this->add(\n            [\n                'name' => 'password',\n                'type' => 'Zend\\Form\\Element\\Password',\n                'attributes' => [\n                    'placeholder' => '\u30d1\u30b9\u30ef\u30fc\u30c9',\n                    'required' => 'required',\n                    'maxlength' => 32\n                ]\n            ]\n        );\n\n        // \u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\n        $this->add(\n            [\n                'name' => 'mail',\n                'type' => 'Zend\\Form\\Element\\Email',\n                'attributes' => [\n                    'placeholder' => '\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9',\n                    'required' => 'required',\n                    'maxlength' => 128\n                ]\n            ]\n        );\n\n        // \u6027\u5225\n        $this->add(\n            [\n                'name' => 'gender',\n                'type' => 'Zend\\Form\\Element\\Radio',\n                'attributes' => [\n                    'required' => 'required',\n                    'value' => 'male',\n                ],\n                'options' => [\n                    'value_options' => [\n                        'male' => '\u7537\u6027',\n                        'female' => '\u5973\u6027',\n                    ]\n                ]\n            ]\n        );\n\n        // \u5e74\u9f62\n        $this->add(\n            [\n                'name' => 'generation',\n                'type' => 'Zend\\Form\\Element\\Select',\n                'attributes' => [\n                    'required' => 'required',\n                ],\n                'options' => [\n                    'value_options' => [\n                        '0' => '\u301c10\u4ee3',\n                        '1' => '20\u4ee3',\n                        '2' => '30\u4ee3',\n                        '3' => '40\u4ee3',\n                        '4' => '50\u4ee3',\n                        '5' => '60\u4ee3\u301c',\n                    ]\n                ]\n            ]\n        );\n\n        // \u8208\u5473\u306e\u3042\u308b\u30ab\u30c6\u30b4\u30ea\n        /** @noinspection PhpUndefinedFieldInspection */\n        $categories = $this->resource->get->uri('app://self/category')->eager->request()->body;\n        $valueOptions = [];\n        foreach ($categories as $category) {\n            $valueOptions[$category['slug']] = $category['name'];\n        }\n        $this->add(\n            [\n                'name' => 'category',\n                'type' => 'Zend\\Form\\Element\\MultiCheckbox',\n                'required' => true,\n                'options' => [\n                    'value_options' => $valueOptions\n                ]\n            ]\n        );\n\n        // CSRF\n        $this->add(\n            [\n                'name' => 'csrf',\n                'type' => 'Zend\\Form\\Element\\Csrf'\n            ]\n        );\n\n        // submit\n        $this->add(\n            [\n                'name' => 'submit',\n                'type' => 'Zend\\Form\\Element\\Button',\n                'attributes' => [\n                    'class' => 'button',\n                    'type' => 'submit'\n                ],\n                'options' => [\n                    'label' => '\u30a2\u30ab\u30a6\u30f3\u30c8\u767b\u9332'\n                ]\n            ]\n        );\n\n        $this->setInputFilter($this->validator->getInputFilter());\n        $this->setData($this->defaultValue);\n\n        $this->prepare();\n    }\n}\n\n\nInterceptor\u81ea\u4f53\u304cZend\\Form\\FormInterface\u3092\u5b9f\u88c5\u3057\u3066\u3044\u307e\u3059\u3002\nInputFilterAwareInterface\u3092\u5b9f\u88c5\u3057\u305f $validator \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u6ce8\u5165\u3057\u3066\u3044\u308b\u30bb\u30c3\u30bf\u30fc\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u306b\u6ce8\u76ee\u3057\u3066\u4e0b\u3055\u3044\u3002\nZend\\Form\u3067\u306fInputFilter\u3068Form\u306e\u5b9f\u88c5\u306f\u5206\u96e2\u3055\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u3053\u306eNamed\u30de\u30fc\u30ab\u30fc\u4ed8\u304d\u306e\u30bb\u30c3\u30bf\u30fc\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u3067\u4f9d\u5b58\u3092\u6ce8\u5165\u3057\u3066\u3044\u307e\u3059\u3002\n\u6ce8\u5165\u3055\u308c\u305fValidator\u306f\u30d5\u30a9\u30fc\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u81ea\u8eab\u306b\u5bfe\u3057\u3066Filter\u3068\u3057\u3066\u767b\u9332\u3055\u308c\u307e\u3059\u3002\n\n\u30d5\u30a9\u30fc\u30e0\u30d5\u30a3\u30eb\u30bf\u30fc\uff08Validator\uff09\u306e\u5b9f\u88c5\n\u30d5\u30a9\u30fc\u30e0\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u8a73\u3057\u3044\u5b9f\u88c5\u65b9\u6cd5\u306f\u672c\u5bb6\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u53c2\u7167\u3057\u3066\u4e0b\u3055\u3044\u3002\n\nFilter/Join.php\n<?php\nnamespace My\\App\\Filter;\n\nuse BEAR\\Sunday\\Inject\\ResourceInject;\nuse Ray\\Di\\Di\\Inject;\nuse Ray\\Di\\Di\\Named;\nuse My\\App\\Module\\App\\Zend\\Validator\\Jp\\Translator;\nuse Zend\\InputFilter\\Factory as InputFactory;\nuse Zend\\InputFilter\\InputFilterAwareInterface;\nuse Zend\\InputFilter\\InputFilterInterface;\nuse Zend\\Validator;\n\n/**\n * Class Join\n * @package My\\App\\Mail\\Filter\n */\nclass Join implements InputFilterAwareInterface\n{\n    use ResourceInject;\n\n    /**\n     * @var InputFilterInterface\n     */\n    private $inputFilter;\n\n    /**\n     * @var InputFactory\n     */\n    private $inputFactory;\n\n    /**\n     * @param InputFilterInterface $inputFilter\n     * @return InputFilterInterface\n     * @Inject\n     */\n    public function setInputFilter(InputFilterInterface $inputFilter)\n    {\n        $this->inputFilter = $inputFilter;\n    }\n\n    /**\n     * @param InputFactory $inputFactory\n     * @Inject\n     */\n    public function setInputFactory(InputFactory $inputFactory)\n    {\n        $this->inputFactory = $inputFactory;\n    }\n\n    /**\n     * @param Translator $translator\n     * @Inject\n     */\n    public function setTranslator(Translator $translator)\n    {\n        Validator\\AbstractValidator::setDefaultTranslator($translator);\n    }\n\n    /**\n     * {@inheritdoc}\n     */\n    public function getInputFilter()\n    {\n        $resource = $this->resource;\n\n        $callback = new Validator\\Callback(\n            function ($value) use ($resource) {\n                /** @noinspection PhpUndefinedFieldInspection */\n                $user = $resource->get\n                    ->uri('app://self/user')\n                    ->withQuery(['name' => $value])\n                    ->eager->request();\n                return empty($user->body);\n            }\n        );\n        $this->inputFilter->add(\n            $this->inputFactory->createInput(\n                [\n                    'name' => 'name',\n                    'required' => true,\n                    'filters' => [\n                        ['name' => 'Zend\\Filter\\StripTags'],\n                        ['name' => 'Zend\\Filter\\StringTrim']\n                    ],\n                    'validators' => [\n                        [\n                            'name' => 'Zend\\Validator\\Callback',\n                            'options' => [\n                                'callback' => $callback,\n                                'messages' => [\n                                    Validator\\Callback::INVALID_VALUE\n                                        => '\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u306f\u65e2\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u4ed6\u306e\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002'\n                                ]\n                            ]\n                        ]\n                    ]\n                ]\n            )\n        );\n\n        $callback = new Validator\\Callback(\n            function ($value) use ($resource) {\n                /** @noinspection PhpUndefinedFieldInspection */\n                $user = $resource->get\n                    ->uri('app://self/user')\n                    ->withQuery(['mail' => $value])\n                    ->eager->request();\n                return empty($user->body);\n            }\n        );\n        $this->inputFilter->add(\n            $this->inputFactory->createInput(\n                [\n                    'name' => 'mail',\n                    'required' => true,\n                    'filters' => [\n                        ['name' => 'Zend\\Filter\\StripTags'],\n                        ['name' => 'Zend\\Filter\\StringTrim']\n                    ],\n                    'validators' =>[\n                        [\n                            'name' => 'Zend\\Validator\\EmailAddress',\n                        ],\n                        [\n                            'name' => 'Zend\\Validator\\Callback',\n                            'options' => [\n                                'callback' => $callback,\n                                'messages' => [\n                                    Validator\\Callback::INVALID_VALUE\n                                    => '\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u306f\u65e2\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u4ed6\u306e\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002'\n                                ]\n                            ]\n                        ]\n                    ],\n                ]\n            )\n        );\n\n        $this->inputFilter->add(\n            $this->inputFactory->createInput(\n                [\n                    'name' => 'gender',\n                    'required' => true,\n                    'filters' => [\n                        ['name' => 'Zend\\Filter\\StripTags'],\n                        ['name' => 'Zend\\Filter\\StringTrim']\n                    ],\n                    'validators' => [\n                        [\n                            'name' => 'Zend\\Validator\\InArray',\n                            'options' => [\n                                'haystack' => ['male', 'female']\n                            ]\n                        ]\n                    ]\n                ]\n            )\n        );\n\n        $this->inputFilter->add(\n            $this->inputFactory->createInput(\n                [\n                    'name' => 'generation',\n                    'required' => true,\n                    'filters' => [\n                        ['name' => 'Zend\\Filter\\StripTags'],\n                        ['name' => 'Zend\\Filter\\StringTrim']\n                    ],\n                    'validators' => [\n                        [\n                            'name' => 'Zend\\Validator\\InArray',\n                            'options' => [\n                                'haystack' => ['0', '1', '2', '3', '4', '5']\n                            ]\n                        ]\n                    ]\n                ]\n            )\n        );\n\n        $this->inputFilter->add(\n            $this->inputFactory->createInput(\n                [\n                    'name' => 'category',\n                    'required' => true,\n                    'filters' => [\n                        ['name' => 'Zend\\Filter\\StripTags'],\n                        ['name' => 'Zend\\Filter\\StringTrim']\n                    ]\n                ]\n            )\n        );\n\n        return $this->inputFilter;\n    }\n}\n\n\n\u4eca\u56de\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u5229\u7528\u3057\u3066\u3001\u65e2\u5b58\u30e6\u30fc\u30b6\u306e\u691c\u7d22\u3092\u884c\u3046\u3053\u3068\u3067\u30e6\u30cb\u30fc\u30af\u5c5e\u6027\u3092\u6301\u3063\u305f\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3057\u3066\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001Translator\u3092\u6ce8\u5165\u3057\u3066\u3044\u308b\u30bb\u30c3\u30bf\u30fc\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\uff08setTranslator\uff09\u306b\u3082\u6ce8\u76ee\u3057\u3066\u4e0b\u3055\u3044\u3002\n\u3053\u3061\u3089\u306e\u30e1\u30bd\u30c3\u30c9\u3067translator\u3092\u53d6\u5f97\u3059\u308b\u3068\u540c\u6642\u306b\u3001Validator\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30c8\u30e9\u30f3\u30b9\u30ec\u30fc\u30bf\u30fc\u306b\u767b\u9332\u3057\u3066\u3044\u307e\u3059\u3002\nZend\\Form\u306f\u69d8\u3005\u306a\u8a00\u8a9e\u3092\u3001Translator\u3068\u3057\u3066\u767b\u9332\u3059\u308b\u3053\u3068\u3067\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\nTranslator\u3092\u5916\u90e8\u304b\u3089\u6ce8\u5165\u3059\u308b\u3053\u3068\u306b\u3088\u308a\u3001\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306b\u5fdc\u3058\u305f\u7ffb\u8a33\u3092\u81ea\u5728\u306b\u884c\u3046\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\u3053\u308c\u306f\u7d1b\u308c\u3082\u306a\u3044DI\u306e\u6069\u6075\u3067\u3059\u3002*1\n\n\u30d5\u30a3\u30eb\u30bf\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u65e5\u672c\u8a9e\u5316\n\u30b5\u30fc\u30d3\u30b9\u5185\u5bb9\u306b\u5fdc\u3058\u3066\u9069\u5b9c\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u7ffb\u8a33\u3092\u884c\u3044\u307e\u3059\u3002\n\u4eca\u56de\u306f\u65e5\u672c\u8a9e\u5316\u3092\u884c\u3044\u307e\u3059\u3002\n\ntranslator\u306e\u767b\u9332\nzf2\u306b\u306f\u6a19\u6e96\u3067\u5404\u7a2e\u65e5\u672c\u8a9e\u30ea\u30bd\u30fc\u30b9\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002\n\u3053\u306e\u65e5\u672c\u8a9etranslator\u3092Ray.DI\u306eProvider\u3068\u3057\u3066\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nModule/App/Zend/i18N/Jp/TranslatorProvider.php\n<?php\nnamespace My\\App\\Module\\App\\Zend\\i18N\\Jp;\n\nuse Ray\\Di\\ProviderInterface;\nuse Zend\\I18n\\Translator\\Translator;\n\n/**\n * Class TranslatorProvider\n * @package My\\App\\Module\\App\\Zend\\i18N\n */\nclass TranslatorProvider implements ProviderInterface\n{\n    /**\n     * @return \\Zend\\I18n\\Translator\\TranslatorInterface\n     */\n    public function get()\n    {\n        global $appDir;\n\n        $translator = new Translator;\n        $file = $appDir . '/vendor/zendframework/zendframework/resources/languages/ja/Zend_Validate.php';\n        $translator->addTranslationFile('phparray', $file, 'default', 'ja_JP');\n\n        return $translator;\n    }\n}\n\n\n\nValidator\u7528Translator\u306e\u4f5c\u6210\n\u4e0a\u8a18Translator\u306f\u69d8\u3005\u306a\u30b5\u30fc\u30d3\u30b9\u3067\u6c4e\u7528\u7684\u306b\u5229\u7528\u3055\u308c\u308btranslator\u3067\u3059\u3002\nValidator\u306b\u9069\u7528\u3067\u304d\u308b\u5c02\u7528\u306e\u65e5\u672c\u8a9eTranslator\u3082\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nmodule/app/zend/validator/jp/translator.php\n<?php\nnamespace My\\App\\Module\\App\\Zend\\Validator\\Jp;\n\nuse Ray\\Di\\Di\\Inject;\nuse Ray\\Di\\Di\\Named;\nuse Zend\\Validator\\Translator\\TranslatorInterface;\n\nclass Translator implements TranslatorInterface\n{\n    /**\n     * @var Translator\n     */\n    private $translator;\n\n    /**\n     * @param \\Zend\\I18n\\Translator\\TranslatorInterface $translator\n     * @Inject\n     * @Named(\"ja_JP\")\n     */\n    public function __construct(\\Zend\\I18n\\Translator\\TranslatorInterface $translator)\n    {\n        $this->translator = $translator;\n    }\n\n    /**\n     * @param  string $message\n     * @param  string $textDomain\n     * @param  string $locale\n     * @return string\n     */\n    public function translate($message, $textDomain = 'default', $locale = 'ja_JP')\n    {\n        return $this->translator->translate($message, $textDomain, $locale);\n    }\n}\n\n\n\nModule\u3078\u306e\u767b\u9332\n\u3044\u3088\u3044\u3088Bind\u3092\u884c\u3044\u307e\u3059\u3002\n\nDI\nDI\u95a2\u9023\u306eBind\u3067\u3059\u3002\n\nmodule/app/ZendFormModule.php\n<?php\nnamespace My\\App\\Module\\App;\n\nuse Ray\\Di\\AbstractModule;\nuse Ray\\Di\\Scope;\n\n/**\n * Class ZendFormModule\n * @package My\\App\\Module\\App\n */\nclass ZendFormModule extends AbstractModule\n{\n    /**\n     * {@inheritdoc}\n     */\n    protected function configure()\n    {\n        $this->bind('Zend\\InputFilter\\InputFilterInterface')\n            ->to('Zend\\InputFilter\\InputFilter');\n\n        $this->bind('Zend\\InputFilter\\InputFilterAwareInterface')\n            ->annotatedWith('join')\n            ->to('My\\App\\Filter\\Join');\n\n        $this->bind('Zend\\I18n\\Translator\\TranslatorInterface')\n            ->annotatedWith('ja_JP')\n            ->toProvider('My\\App\\Module\\App\\Zend\\i18N\\Jp\\TranslatorProvider')\n            ->in(Scope::SINGLETON);\n\n        $this->bind('Zend\\Validator\\Translator\\TranslatorInterface')\n            ->to('My\\App\\Module\\App\\Zend\\Validator\\Jp\\Translator')\n            ->in(Scope::SINGLETON);\n\n        $this->bind('Zend\\ServiceManager\\ServiceManager')\n            ->annotatedWith('formHelper')\n            ->toProvider('My\\App\\Module\\App\\Zend\\ServiceManager\\FormHelperProvider')\n            ->in(Scope::SINGLETON);\n    }\n}\n\n\n\u51e6\u7406\u306e\u4e0a\u304b\u3089\u9806\u306b\u30d0\u30a4\u30f3\u30c9\u306e\u5185\u5bb9\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\n\nInputFilterInterface\u306b\u5bfe\u3057\u3066\u5b9f\u88c5\u3092Bind\u3057\u3066\u3044\u307e\u3059\u3002\n\u767b\u9332\u30d5\u30a9\u30fc\u30e0\u306eValidator\u3092Bind\u3057\u3066\u3044\u307e\u3059\u3002Namd\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8a2d\u5b9a\u3057\u3066\u5bfe\u8c61\u3092\u9650\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\u65e5\u672c\u8a9eTranslator\u3092Bind\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u3061\u3089\u3082Named\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u8a00\u8a9e\u306e\u5bfe\u8c61\u3092\u9650\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\nValidator\u306eTranslatorInterface\u306b\u5bfe\u3057\u3066\u65e5\u672c\u8a9eTranslator\u3092Bind\u3057\u3066\u3044\u307e\u3059\u3002\u65e5\u672c\u8a9e\u3057\u304b\u671f\u5f85\u3057\u306a\u3044\u306e\u3067\u30b7\u30f3\u30d7\u30eb\u306bBind\u3057\u3066\u3044\u307e\u3059\u3002\nZend\\ServiceManager\u3092Bind\u3057\u3066\u3044\u307e\u3059\u3002\u5f8c\u307b\u3069\u8aac\u660e\u3057\u307e\u3059\u304cFormHelper\u3068\u3057\u3066\u9650\u5b9a\u7684\u306b\u5229\u7528\u3057\u307e\u3059\u3002\n\n\nAOP\nAOP\u95a2\u9023\u306eBind\u3067\u3059\u3002\n\nmodule/app/Aspect.php\n<?php\n\nnamespace My\\App\\Module\\App;\n\nuse BEAR\\Package;\nuse Ray\\Di\\AbstractModule;\n\nclass Aspect extends AbstractModule\n{\n    /**\n     * {@inheritdoc}\n     */\n    protected function configure()\n    {\n        $this->bindInterceptor(\n            $this->matcher->subclassesOf('My\\App\\Resource\\Page\\Join'),\n            $this->matcher->annotatedWith('BEAR\\Sunday\\Annotation\\Form'),\n            [$this->requestInjection('My\\App\\Interceptor\\Form\\Join')]\n        );\n    }\n}\n\n\n\u4eca\u56de\u3082BEAR.Sunday\u304c\u6a19\u6e96\u3067\u7528\u610f\u3055\u308c\u3066\u3044\u308b@Form\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\u5bfe\u8c61\u3068\u306a\u308b\u30da\u30fc\u30b8\u306bForm\u3092\u30d0\u30a4\u30f3\u30c9\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30d5\u30a9\u30fc\u30e0\u30d8\u30eb\u30d1\u30fc\u306e\u5b9f\u88c5\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3067\u5229\u7528\u3059\u308b\u969b\u306b\u5229\u7528\u3059\u308b\u30d8\u30eb\u30d1\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u3068\u3057\u3066Twig\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u3092\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30b5\u30fc\u30d3\u30b9\u30de\u30cd\u30fc\u30b8\u30e3\u306e\u4f5c\u6210\nZf2\u304c\u6a19\u6e96\u3067\u7528\u610f\u3059\u308b\u30d8\u30eb\u30d1\u30fc\u6a5f\u80fd\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u3001Zend\\ServiceManager\u3092\u63d0\u4f9b\u3059\u308bProvider\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nServiceManager\u306eConstructor\u306bHelperConfig\u3092\u6e21\u3059\u3053\u3068\u3067\u3001\u5fc5\u8981\u306a\u30b5\u30fc\u30d3\u30b9\u3092\u30b5\u30fc\u30d3\u30b9\u30ed\u30b1\u30fc\u30bf\u306b\u767b\u9332\u3057\u3066\u3044\u307e\u3059\u3002\n\nModule/App/Zend/Servicemanager/FormHelperProvider.php\n<?php\nnamespace My\\App\\Module\\App\\Zend\\ServiceManager;\n\nuse Ray\\Di\\ProviderInterface as Provide;\nuse Zend\\Form\\View\\HelperConfig;\nuse Zend\\ServiceManager\\ServiceManager;\n\n/**\n * ServiceManager for FormHelper\n */\nclass FormHelperProvider implements Provide\n{\n    /**\n     * @return mixed|ServiceManager\n     */\n    public function get()\n    {\n        return new ServiceManager(new HelperConfig);\n    }\n}\n\n\n\u3053\u3061\u3089\u306eProvider\u306f\u524d\u8ff0\u306eZendFormModule.php\u3067\u5229\u7528\u3055\u308c\u307e\u3059\u3002\n\nTwig_Extension\u306e\u5b9f\u88c5\n\u4e0a\u8a18\u30d8\u30eb\u30d1\u30fc\u3092\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u4e0a\u3067\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306bTwig_Extension\u3068\u3057\u3066\u767b\u9332\u3057\u307e\u3059\u3002\n\nExtension\u306e\u5b9f\u88c5\n\u4eca\u56de\u306f\u7d30\u304b\u3044\u51e6\u7406\u306e\u5185\u5bb9\u306f\u5272\u611b\u3057\u307e\u3059\u304c\u3001Form\u306eView\u3078\u306e\u30b5\u30fc\u30d3\u30b9\u767b\u9332\u3068TwigExtension\u3068\u3057\u3066\u306e\u767b\u9332\u3001\u5927\u307e\u304b\u306b\u5206\u3051\u30662\u3064\u306e\u767b\u9332\u51e6\u7406\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\nInterceptor/TemplateEngine/Twig/Extension.php\n<?php\nnamespace My\\App\\Interceptor\\TemplateEngine\\Twig\\Extension;\n\nuse Ray\\Di\\Di\\Inject;\nuse Ray\\Di\\Di\\Named;\nuse Zend\\Form\\View\\HelperConfig;\nuse Zend\\ServiceManager\\ServiceManager;\nuse Zend\\View\\HelperPluginManager;\nuse Zend\\View\\Renderer\\PhpRenderer;\n\n/**\n * Class ZendForm_Twig_Extension\n * @package My\\App\\Interceptor\\TemplateEngine\\Twig\n */\nclass ZendForm_Twig_Extension extends \\Twig_Extension\n{\n    /**\n     * @var ServiceManager\n     */\n    private $serviceManager;\n\n    /**\n     * @param \\Twig_Environment $environment\n     */\n    public function initRuntime(\\Twig_Environment $environment)\n    {\n        $renderer = new PhpRenderer();\n        $helperPluginManager = new HelperPluginManager(new HelperConfig);\n        $registeredService = $this->serviceManager->getRegisteredServices();\n\n        foreach ($registeredService['invokableClasses'] as $invokable) {\n            /** @var \\Zend\\Form\\View\\Helper\\FormElement $formHelper */\n            $formHelper = $this->serviceManager->get($invokable);\n            $formHelper->setView($renderer);\n            $renderer->setHelperPluginManager($helperPluginManager);\n            $environment->registerUndefinedFunctionCallback(\n                function ($name) use ($helperPluginManager, $renderer) {\n                    if (!$helperPluginManager->has($name)) {\n                        return '';\n                    }\n\n                    $callable = [$renderer->plugin($name), '__invoke'];\n                    $options  = ['is_safe' => ['html']];\n                    return new \\Twig_SimpleFunction($name, $callable, $options);\n                }\n            );\n        }\n    }\n\n    /**\n     * @param ServiceManager $serviceManager\n     * @Inject\n     * @Named(\"formHelper\")\n     */\n    public function __construct(ServiceManager $serviceManager)\n    {\n        $this->serviceManager = $serviceManager;\n    }\n\n    /**\n     * @return string\n     */\n    public function getName()\n    {\n        return 'ZendForm';\n    }\n\n    /**\n     * @return array\n     */\n    public function getFunctions()\n    {\n        $registeredService = $this->serviceManager->getRegisteredServices();\n        $functions = [];\n        foreach ($registeredService['invokableClasses'] as $invokable) {\n            $functions[] = new \\Twig_SimpleFunction(\n                $invokable,\n                [$this, $invokable],\n                ['is_safe' => ['html']]\n            );\n        }\n        return $functions;\n    }\n\n    /**\n     * @param $method\n     * @param $arguments\n     * @return string\n     */\n    public function __call($method, $arguments)\n    {\n        if (!$this->serviceManager->has($method)) {\n            return '';\n        }\n\n        /** @var Callable $callable */\n        $callable = $this->serviceManager->get($method);\n        return isset($arguments[0]) ? $callable($arguments[0]) : $callable();\n    }\n}\n\n\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u3067\u6ce8\u5165\u3055\u308c\u3066\u3044\u308bServiceManager\u306f\u3001\u4e88\u3081Form\u95a2\u9023\u306e\u30d9\u30eb\u30d1\u30fc\u30b5\u30fc\u30d3\u30b9\u304c\u6ce8\u5165\u3055\u308c\u3066\u3044\u308b\u30b5\u30fc\u30d3\u30b9\u30ed\u30b1\u30fc\u30bf\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u3059\u3002\uff08\u524d\u9805\u53c2\u7167\uff09\n\u305d\u308c\u3089\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u53c2\u7167\u3057\u3001Twig\u306e\u95a2\u6570\u3068\u3057\u3066\u52d5\u4f5c\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\nExtension\u306e\u8ffd\u52a0\u65b9\u6cd5\nBEAR.Sunday\u3067\u306f\u6a19\u6e96\u3067Twig_Environment\u4f5c\u6210\u6642\u306bAura.Input\u95a2\u9023\u306etwig\u62e1\u5f35\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3059\u3002\n\u305d\u306e\u4f5c\u6210\u51e6\u7406\u3068\u3044\u3046\u30dd\u30a4\u30f3\u30c8\u30ab\u30c3\u30c8\u306b\u5bfe\u3057\u3066\u300cExtension\u767b\u9332\u300d\u3068\u3044\u3046\u30a2\u30b9\u30da\u30af\u30c8\u3092\u767b\u9332\u3057\u3066\u307f\u307e\u3059\u3002\n\nINterceptor/TemplateEngine/Twig/ExtensionInjector.php\n<?php\nnamespace My\\App\\Interceptor\\TemplateEngine\\Twig;\n\nuse Ray\\Aop\\MethodInterceptor;\nuse Ray\\Aop\\MethodInvocation;\nuse Ray\\Di\\Di\\Inject;\n\n/**\n * Class ExtensionInjector\n * @package My\\App\\Interceptor\\TemplateEngine\\Twig\n */\nclass ExtensionInjector implements MethodInterceptor\n{\n    /**\n     * @var Extension\\ZendForm_Twig_Extension\n     */\n    private $zendFormExtension;\n\n    /**\n     * @param Extension\\ZendForm_Twig_Extension $zendFormExtension\n     * @Inject\n     */\n    public function __construct(\n        Extension\\ZendForm_Twig_Extension $zendFormExtension)\n    {\n        $this->zendFormExtension = $zendFormExtension;\n    }\n\n    /**\n     * {@inheritdoc}\n     */\n    public function invoke(MethodInvocation $invocation)\n    {\n        /** @var \\Twig_Environment $twig */\n        $twig = $invocation->proceed();\n        $twig->addExtension($this->zendFormExtension);\n        return $twig;\n    }\n}\n\n\n\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fExtension\u3092\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u3067\u6ce8\u5165\u3001After advice\u3068\u3057\u3066Extension\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n\u3053\u3061\u3089\u3082\u5f53\u7136\u4ee5\u4e0b\u306e\u901a\u308aModule\u306b\u767b\u9332\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nModule/App/Aspect.php\n<?php\n\nnamespace My\\App\\Module\\App;\n\nuse BEAR\\Package;\nuse Ray\\Di\\AbstractModule;\n\nclass Aspect extends AbstractModule\n{\n    /**\n     * {@inheritdoc}\n     */\n    protected function configure()\n    {\n        $this->bindInterceptor(\n            $this->matcher->startsWith('BEAR\\Package\\Provide\\TemplateEngine\\Twig\\TwigProvider'),\n            $this->matcher->startsWith('get'),\n            [$this->requestInjection('My\\App\\Interceptor\\TemplateEngine\\Twig\\ExtensionInjector')]\n        );\n    }\n}\n\n\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u8a18\u8ff0\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\u30d5\u30a9\u30fc\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u81ea\u4f53\u306fPage\u30ea\u30bd\u30fc\u30b9\u306eBody\u306e\u4e2d\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u305d\u3061\u3089\u3092\u64cd\u4f5c\u3057\u3066Form\u3092\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3057\u307e\u3059\u3002\n\u8a73\u3057\u3044\u95a2\u6570\u306e\u52d5\u4f5c\u7b49\u3001\u3053\u3061\u3089\u3082\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u53c2\u7167\u3057\u3066\u4e0b\u3055\u3044\u3002\n\nResource/Page/Join.twig\n{% extends \"layout/default.twig\" %}\n{% block page %}\n\n    {% if not mail %}\n        {% if form.hasSubmit and not form.isValid() %}\n            <ul class=\"form-errors\">\n                {% for messages in form.getMessages() %}\n                    {% for message in messages %}\n                        <li>*{{ message }}</li>\n                    {% endfor %}\n                {% endfor %}\n            </ul>\n        {% endif %}\n        {{ form().openTag(form) }}\n        {% for element in form %}\n            {{ formelement(element) }}\n        {% endfor %}\n        {{ form().closeTag(form) }}\n\n    {% else %}\n        <h2 class=\"main-title\">\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u767b\u9332\u3092\u53d7\u3051\u4ed8\u3051\u307e\u3057\u305f\u3002</h2>\n        <p class=\"annotations\">\u3054\u767b\u9332\u3044\u305f\u3060\u3044\u305f{{ mail|e }}\u5b9b\u3066\u306b\u767b\u9332\u78ba\u8a8d\u7528\u306e\u3054\u6848\u5185\u3092\u304a\u9001\u308a\u3057\u307e\u3057\u305f\u306e\u3067\u3001\u30e1\u30fc\u30eb\u306e\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u3066\u767b\u9332\u78ba\u8a8d\u3092\u5b8c\u4e86\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>\n\n    {% endif %}\n\n{% endblock %}\n\n\n\n\u6700\u5f8c\u306b\n\u4eca\u56de\u306fBEAR.Sunday\u306e\u30d5\u30a9\u30fc\u30e0\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u5909\u66f4\u3092\u884c\u3044\u307e\u3057\u305f\u304c\u3001\u4e88\u60f3\u4ee5\u4e0a\u306b\u3084\u308b\u3053\u3068\u304c\u591a\u304b\u3063\u305f\u3068\u601d\u3044\u307e\u3059\u3002\n\u305f\u3060\u3001\u5b9f\u88c5\u3057\u3066\u3044\u304f\u4e2d\u3067\u300c\u3069\u3046\u3057\u3088\u3046\u3082\u306a\u3044\u5927\u304d\u306a\u58c1\u300d\u306b\u3076\u3064\u304b\u308b\u3053\u3068\u306f\u3042\u307e\u308a\u306a\u304f\u3001\u9806\u3092\u8ffd\u3063\u3066\u554f\u984c\u3092\u89e3\u6c7a\u3057\u3066\u3044\u3051\u3070\u5fc5\u305a\u5b9f\u88c5\u3067\u304d\u308b\u3068\u3044\u3046\u78ba\u4fe1\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\u305d\u3046\u601d\u308f\u305b\u308b\u306e\u3082\u3001BEAR.Sunday\u304c\u63d0\u4f9b\u3059\u308b\u6a5f\u80fd\u3042\u3063\u3066\u306e\u4e8b\u3067\u3042\u308b\u3068\u540c\u6642\u306b\u3001\u7d1b\u308c\u3082\u7121\u3044\u300c\u63a5\u7d9a\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u300d\u3068\u3057\u3066\u306e\u9b45\u529b\u306e\u4e00\u3064\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n*1 \u4eca\u56de\u306e\u4f8b\u3067\u306f\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u30d5\u30a3\u30eb\u30bf\u306b\u30ab\u30b9\u30bf\u30e0\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u65e5\u672c\u8a9e\u3067\u30cf\u30fc\u30c9\u30b3\u30fc\u30c9\u3057\u3066\u3057\u307e\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u591a\u8a00\u8a9e\u30b5\u30dd\u30fc\u30c8\u3092\u671f\u5f85\u3059\u308b\u306e\u3067\u3042\u308c\u3070\u5f53\u7136\u5225\u306e\u7b87\u6240\u3067\u9069\u5207\u306b\u5b9a\u7fa9\u3059\u3079\u304d\u3067\u3059\u3002\n## \u306f\u3058\u3081\u306b\nBEAR.Sunday\u304c\u6a19\u6e96\u3067\u63d0\u4f9b\u3059\u308b\u30d5\u30a9\u30fc\u30e0\u30e9\u30a4\u30d6\u30e9\u30ea\u306fAura.Input\u3067\u3059\u304c\u3001\u30d5\u30eb\u30b9\u30bf\u30c3\u30af\u30b9\u30bf\u30a4\u30eb\u3067\u63d0\u4f9b\u3055\u308c\u308b\u69d8\u3005\u306a\u30d5\u30a9\u30fc\u30e0\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u6069\u6075\u3092\u53d7\u3051\u305f\u3044\u30b1\u30fc\u30b9\u3082\u591a\u3005\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u4eca\u56de\u306fZendFramework2\u306eZend\\Form\u3092BEAR.Sunday\u3067\u5229\u7528\u3059\u308b\u4e00\u4f8b\u3092\u7d39\u4ecb\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\nBEAR.Sunday\u306e\u30d5\u30a9\u30fc\u30e0\u5b9f\u88c5\u3092\u8e0f\u8972\u3057\u3066\u3001\u4eca\u56de\u3082\u30d5\u30a9\u30fc\u30e0\u306f\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc\u3068\u3057\u3066\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\n## \u30d5\u30a9\u30fc\u30e0\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc\u306e\u4f5c\u6210\n\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n### trait\u306e\u5b9f\u88c5\n\u307e\u305a\u3001\u30d5\u30a9\u30fc\u30e0\u5171\u901a\u3067\u5229\u7528\u3059\u308b\u51e6\u7406\u3092trait\u3068\u3057\u3066\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\n```php:Interceptor\\ZendForm\\ZendFormInject.php\n<?php\nnamespace My\\App\\Interceptor\\ZendForm;\n\nuse BEAR\\Resource\\NamedParameter;\nuse Ray\\Aop\\MethodInvocation;\nuse Ray\\Di\\Di\\Inject;\n\n/**\n * Class ZendFormInject\n * @package My\\App\\Interceptor\\ZendForm\n */\ntrait ZendFormInject\n{\n    /**\n     * @var array\n     */\n    private $defaultValue = [];\n\n    /**\n     * @var NamedParameter\n     */\n    private $params;\n\n    /**\n     * @var bool\n     */\n    public $hasSubmit = false;\n\n    /**\n     * @param NamedParameter $params\n     * @Inject\n     */\n    public function setNamedParameter(NamedParameter $params)\n    {\n        $this->params = $params;\n    }\n\n    /**\n     * @param MethodInvocation $invocation\n     * @return mixed|object\n     */\n    public function invoke(MethodInvocation $invocation)\n    {\n        $this->hasSubmit = $invocation->getMethod()->name === 'onPost';\n        if ($this->hasSubmit) {\n            $this->defaultValue = $_POST;\n        }\n        /** @noinspection PhpUndefinedMethodInspection */\n        $this->setForm();\n\n        /** @var \\BEAR\\Resource\\ResourceObject $page */\n        $page = $invocation->getThis();\n        $method = $invocation->getMethod()->name;\n        $page->body['form'] = $this;\n\n        if ($this->hasSubmit && $this->isValid()) {\n            $data = $this->getData();\n            $args = $this->params->getArgs([$page, $method], $data);\n            return call_user_func_array([$page, 'onPost'], $args);\n        }\n\n        return call_user_func_array([$page, 'onGet'], (array) $invocation->getArguments());\n    }\n}\n\n```\n\u3053\u3053\u3067\u306f\u4ee5\u4e0b\u306e\u51e6\u7406\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n1. \u30d5\u30a9\u30fc\u30e0\u4f5c\u6210\u51e6\u7406\u306e\u5b9f\u884c\n2. \u30d5\u30a9\u30fc\u30e0\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\n3. PageResourceObject\u306e\u30e1\u30bd\u30c3\u30c9\u5b9f\u884c\n\n\u4f59\u8ac7\u3067\u3059\u304c\u3001\u3053\u3061\u3089\u306e\u30b3\u30fc\u30c9\u306b\u306f\u5c11\u3057\u554f\u984c\u304c\u3042\u308a\u307e\u3059\u3002\n\u672c\u6765\u3001Ray.AOP\u3067\u306f\u672c\u8cea\u306e\u51e6\u7406\u3092\u5b9f\u884c\u3059\u308b\u969b\u306b\u306f\u4ee5\u4e0b\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u304c\u3001\n\n```php\n$invocation->proceed(); \n```\n\n\u4eca\u56de\u306fResourceObject\u306e\u3069\u306e\u30e1\u30bd\u30c3\u30c9\uff08onGet or onPost\uff09\u3092\u547c\u3073\u51fa\u3059\u3079\u304d\u304b\u3068\u3044\u3046\u70b9\u304c\u3001\u30d5\u30a9\u30fc\u30e0\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u7d50\u679c\u306b\u3088\u3063\u3066\u5de6\u53f3\u3055\u308c\u307e\u3059\u306e\u3067\u3001\u4ee3\u308f\u308a\u306b\u4ee5\u4e0b\u306e\u65b9\u6cd5\u3067\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u51fa\u3057\u3066\u3044\u307e\u3059\u3002\n\n```php\ncall_user_func_array([$page, 'onGet'], (array) $invocation->getArguments());\n```\n\n\u3053\u306e\u65b9\u6cd5\u3067\u306f\u672c\u30a2\u30b9\u30da\u30af\u30c8\u4ee5\u964d\u306b\u30d0\u30a4\u30f3\u30c9\u3055\u308c\u305f\u51e6\u7406\u304c\u5b9f\u884c\u3055\u308c\u307e\u305b\u3093\u3002\n\u73fe\u5728\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306eRay\uff082014/12/12\u6642\u70b9\uff09\u3067\u306f\u3001\u5b9f\u884c\u3055\u308c\u308b\u9806\u756a\u306f\u30d0\u30a4\u30f3\u30c9\u3055\u308c\u308b\u9806\u756a\u306b\u4f9d\u5b58\u3057\u3066\u3044\u307e\u3059\u3002\n\u305d\u3053\u3060\u3051\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n### Form\u306e\u5b9f\u88c5\n\u6b21\u306bForm\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\u4eca\u56de\u306f\u30e6\u30fc\u30b6\u767b\u9332\u30d5\u30a9\u30fc\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```php:Interceptor/Form/Join.php\n<?php\nnamespace My\\App\\Interceptor\\Form;\n\nuse BEAR\\Sunday\\Inject\\ResourceInject;\nuse Ray\\Aop\\MethodInterceptor;\nuse Ray\\Di\\Di\\Inject;\nuse Ray\\Di\\Di\\Named;\nuse My\\App\\Interceptor\\ZendForm\\ZendFormInject;\nuse Zend\\Form\\Form;\nuse Zend\\InputFilter\\InputFilterAwareInterface;\n\n/**\n * Class Join\n * @package My\\App\\Interceptor\\Form\n */\nclass Join extends Form implements MethodInterceptor\n{\n    use ResourceInject;\n    use ZendFormInject;\n\n    /**\n     * @var InputFilterAwareInterface\n     */\n    private $validator;\n\n    /**\n     * @param InputFilterAwareInterface $validator\n     * @Inject\n     * @Named(\"join\")\n     */\n    public function setValidator(InputFilterAwareInterface $validator)\n    {\n        $this->validator = $validator;\n    }\n\n    /**\n     * (non-PHPDoc)\n     */\n    private function setForm()\n    {\n        $this->setName('joinForm');\n        $this->setAttribute('method', 'post');\n\n        // \u30e6\u30fc\u30b6\u540d\n        $this->add(\n            [\n                'name' => 'name',\n                'type' => 'Zend\\Form\\Element\\Text',\n                'attributes' => [\n                    'placeholder' => '\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0',\n                    'required' => 'required',\n                    'maxlength' => 32\n                ]\n            ]\n        );\n\n        // \u30d1\u30b9\u30ef\u30fc\u30c9\n        $this->add(\n            [\n                'name' => 'password',\n                'type' => 'Zend\\Form\\Element\\Password',\n                'attributes' => [\n                    'placeholder' => '\u30d1\u30b9\u30ef\u30fc\u30c9',\n                    'required' => 'required',\n                    'maxlength' => 32\n                ]\n            ]\n        );\n\n        // \u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\n        $this->add(\n            [\n                'name' => 'mail',\n                'type' => 'Zend\\Form\\Element\\Email',\n                'attributes' => [\n                    'placeholder' => '\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9',\n                    'required' => 'required',\n                    'maxlength' => 128\n                ]\n            ]\n        );\n\n        // \u6027\u5225\n        $this->add(\n            [\n                'name' => 'gender',\n                'type' => 'Zend\\Form\\Element\\Radio',\n                'attributes' => [\n                    'required' => 'required',\n                    'value' => 'male',\n                ],\n                'options' => [\n                    'value_options' => [\n                        'male' => '\u7537\u6027',\n                        'female' => '\u5973\u6027',\n                    ]\n                ]\n            ]\n        );\n\n        // \u5e74\u9f62\n        $this->add(\n            [\n                'name' => 'generation',\n                'type' => 'Zend\\Form\\Element\\Select',\n                'attributes' => [\n                    'required' => 'required',\n                ],\n                'options' => [\n                    'value_options' => [\n                        '0' => '\u301c10\u4ee3',\n                        '1' => '20\u4ee3',\n                        '2' => '30\u4ee3',\n                        '3' => '40\u4ee3',\n                        '4' => '50\u4ee3',\n                        '5' => '60\u4ee3\u301c',\n                    ]\n                ]\n            ]\n        );\n\n        // \u8208\u5473\u306e\u3042\u308b\u30ab\u30c6\u30b4\u30ea\n        /** @noinspection PhpUndefinedFieldInspection */\n        $categories = $this->resource->get->uri('app://self/category')->eager->request()->body;\n        $valueOptions = [];\n        foreach ($categories as $category) {\n            $valueOptions[$category['slug']] = $category['name'];\n        }\n        $this->add(\n            [\n                'name' => 'category',\n                'type' => 'Zend\\Form\\Element\\MultiCheckbox',\n                'required' => true,\n                'options' => [\n                    'value_options' => $valueOptions\n                ]\n            ]\n        );\n\n        // CSRF\n        $this->add(\n            [\n                'name' => 'csrf',\n                'type' => 'Zend\\Form\\Element\\Csrf'\n            ]\n        );\n\n        // submit\n        $this->add(\n            [\n                'name' => 'submit',\n                'type' => 'Zend\\Form\\Element\\Button',\n                'attributes' => [\n                    'class' => 'button',\n                    'type' => 'submit'\n                ],\n                'options' => [\n                    'label' => '\u30a2\u30ab\u30a6\u30f3\u30c8\u767b\u9332'\n                ]\n            ]\n        );\n\n        $this->setInputFilter($this->validator->getInputFilter());\n        $this->setData($this->defaultValue);\n\n        $this->prepare();\n    }\n}\n```\n\nInterceptor\u81ea\u4f53\u304cZend\\Form\\FormInterface\u3092\u5b9f\u88c5\u3057\u3066\u3044\u307e\u3059\u3002\n\nInputFilterAwareInterface\u3092\u5b9f\u88c5\u3057\u305f $validator \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u6ce8\u5165\u3057\u3066\u3044\u308b\u30bb\u30c3\u30bf\u30fc\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u306b\u6ce8\u76ee\u3057\u3066\u4e0b\u3055\u3044\u3002\nZend\\Form\u3067\u306fInputFilter\u3068Form\u306e\u5b9f\u88c5\u306f\u5206\u96e2\u3055\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u3053\u306eNamed\u30de\u30fc\u30ab\u30fc\u4ed8\u304d\u306e\u30bb\u30c3\u30bf\u30fc\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u3067\u4f9d\u5b58\u3092\u6ce8\u5165\u3057\u3066\u3044\u307e\u3059\u3002\n\u6ce8\u5165\u3055\u308c\u305fValidator\u306f\u30d5\u30a9\u30fc\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u81ea\u8eab\u306b\u5bfe\u3057\u3066Filter\u3068\u3057\u3066\u767b\u9332\u3055\u308c\u307e\u3059\u3002\n\n## \u30d5\u30a9\u30fc\u30e0\u30d5\u30a3\u30eb\u30bf\u30fc\uff08Validator\uff09\u306e\u5b9f\u88c5\n\u30d5\u30a9\u30fc\u30e0\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u8a73\u3057\u3044\u5b9f\u88c5\u65b9\u6cd5\u306f\u672c\u5bb6\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u53c2\u7167\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n```php:Filter/Join.php\n<?php\nnamespace My\\App\\Filter;\n\nuse BEAR\\Sunday\\Inject\\ResourceInject;\nuse Ray\\Di\\Di\\Inject;\nuse Ray\\Di\\Di\\Named;\nuse My\\App\\Module\\App\\Zend\\Validator\\Jp\\Translator;\nuse Zend\\InputFilter\\Factory as InputFactory;\nuse Zend\\InputFilter\\InputFilterAwareInterface;\nuse Zend\\InputFilter\\InputFilterInterface;\nuse Zend\\Validator;\n\n/**\n * Class Join\n * @package My\\App\\Mail\\Filter\n */\nclass Join implements InputFilterAwareInterface\n{\n    use ResourceInject;\n\n    /**\n     * @var InputFilterInterface\n     */\n    private $inputFilter;\n\n    /**\n     * @var InputFactory\n     */\n    private $inputFactory;\n\n    /**\n     * @param InputFilterInterface $inputFilter\n     * @return InputFilterInterface\n     * @Inject\n     */\n    public function setInputFilter(InputFilterInterface $inputFilter)\n    {\n        $this->inputFilter = $inputFilter;\n    }\n\n    /**\n     * @param InputFactory $inputFactory\n     * @Inject\n     */\n    public function setInputFactory(InputFactory $inputFactory)\n    {\n        $this->inputFactory = $inputFactory;\n    }\n\n    /**\n     * @param Translator $translator\n     * @Inject\n     */\n    public function setTranslator(Translator $translator)\n    {\n        Validator\\AbstractValidator::setDefaultTranslator($translator);\n    }\n\n    /**\n     * {@inheritdoc}\n     */\n    public function getInputFilter()\n    {\n        $resource = $this->resource;\n\n        $callback = new Validator\\Callback(\n            function ($value) use ($resource) {\n                /** @noinspection PhpUndefinedFieldInspection */\n                $user = $resource->get\n                    ->uri('app://self/user')\n                    ->withQuery(['name' => $value])\n                    ->eager->request();\n                return empty($user->body);\n            }\n        );\n        $this->inputFilter->add(\n            $this->inputFactory->createInput(\n                [\n                    'name' => 'name',\n                    'required' => true,\n                    'filters' => [\n                        ['name' => 'Zend\\Filter\\StripTags'],\n                        ['name' => 'Zend\\Filter\\StringTrim']\n                    ],\n                    'validators' => [\n                        [\n                            'name' => 'Zend\\Validator\\Callback',\n                            'options' => [\n                                'callback' => $callback,\n                                'messages' => [\n                                    Validator\\Callback::INVALID_VALUE\n                                        => '\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u306f\u65e2\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u4ed6\u306e\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002'\n                                ]\n                            ]\n                        ]\n                    ]\n                ]\n            )\n        );\n\n        $callback = new Validator\\Callback(\n            function ($value) use ($resource) {\n                /** @noinspection PhpUndefinedFieldInspection */\n                $user = $resource->get\n                    ->uri('app://self/user')\n                    ->withQuery(['mail' => $value])\n                    ->eager->request();\n                return empty($user->body);\n            }\n        );\n        $this->inputFilter->add(\n            $this->inputFactory->createInput(\n                [\n                    'name' => 'mail',\n                    'required' => true,\n                    'filters' => [\n                        ['name' => 'Zend\\Filter\\StripTags'],\n                        ['name' => 'Zend\\Filter\\StringTrim']\n                    ],\n                    'validators' =>[\n                        [\n                            'name' => 'Zend\\Validator\\EmailAddress',\n                        ],\n                        [\n                            'name' => 'Zend\\Validator\\Callback',\n                            'options' => [\n                                'callback' => $callback,\n                                'messages' => [\n                                    Validator\\Callback::INVALID_VALUE\n                                    => '\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u306f\u65e2\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u4ed6\u306e\u30e6\u30fc\u30b6\u30fc\u30cd\u30fc\u30e0\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002'\n                                ]\n                            ]\n                        ]\n                    ],\n                ]\n            )\n        );\n\n        $this->inputFilter->add(\n            $this->inputFactory->createInput(\n                [\n                    'name' => 'gender',\n                    'required' => true,\n                    'filters' => [\n                        ['name' => 'Zend\\Filter\\StripTags'],\n                        ['name' => 'Zend\\Filter\\StringTrim']\n                    ],\n                    'validators' => [\n                        [\n                            'name' => 'Zend\\Validator\\InArray',\n                            'options' => [\n                                'haystack' => ['male', 'female']\n                            ]\n                        ]\n                    ]\n                ]\n            )\n        );\n\n        $this->inputFilter->add(\n            $this->inputFactory->createInput(\n                [\n                    'name' => 'generation',\n                    'required' => true,\n                    'filters' => [\n                        ['name' => 'Zend\\Filter\\StripTags'],\n                        ['name' => 'Zend\\Filter\\StringTrim']\n                    ],\n                    'validators' => [\n                        [\n                            'name' => 'Zend\\Validator\\InArray',\n                            'options' => [\n                                'haystack' => ['0', '1', '2', '3', '4', '5']\n                            ]\n                        ]\n                    ]\n                ]\n            )\n        );\n\n        $this->inputFilter->add(\n            $this->inputFactory->createInput(\n                [\n                    'name' => 'category',\n                    'required' => true,\n                    'filters' => [\n                        ['name' => 'Zend\\Filter\\StripTags'],\n                        ['name' => 'Zend\\Filter\\StringTrim']\n                    ]\n                ]\n            )\n        );\n\n        return $this->inputFilter;\n    }\n}\n```\n\u4eca\u56de\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u5229\u7528\u3057\u3066\u3001\u65e2\u5b58\u30e6\u30fc\u30b6\u306e\u691c\u7d22\u3092\u884c\u3046\u3053\u3068\u3067\u30e6\u30cb\u30fc\u30af\u5c5e\u6027\u3092\u6301\u3063\u305f\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u307e\u305f\u3001Translator\u3092\u6ce8\u5165\u3057\u3066\u3044\u308b\u30bb\u30c3\u30bf\u30fc\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\uff08setTranslator\uff09\u306b\u3082\u6ce8\u76ee\u3057\u3066\u4e0b\u3055\u3044\u3002\n\u3053\u3061\u3089\u306e\u30e1\u30bd\u30c3\u30c9\u3067translator\u3092\u53d6\u5f97\u3059\u308b\u3068\u540c\u6642\u306b\u3001Validator\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30c8\u30e9\u30f3\u30b9\u30ec\u30fc\u30bf\u30fc\u306b\u767b\u9332\u3057\u3066\u3044\u307e\u3059\u3002\nZend\\Form\u306f\u69d8\u3005\u306a\u8a00\u8a9e\u3092\u3001Translator\u3068\u3057\u3066\u767b\u9332\u3059\u308b\u3053\u3068\u3067\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\nTranslator\u3092\u5916\u90e8\u304b\u3089\u6ce8\u5165\u3059\u308b\u3053\u3068\u306b\u3088\u308a\u3001\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306b\u5fdc\u3058\u305f\u7ffb\u8a33\u3092\u81ea\u5728\u306b\u884c\u3046\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\u3053\u308c\u306f\u7d1b\u308c\u3082\u306a\u3044DI\u306e\u6069\u6075\u3067\u3059\u3002<a href=\"#1\"><sub>*1</sub></a>\n\n## \u30d5\u30a3\u30eb\u30bf\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u65e5\u672c\u8a9e\u5316\n\u30b5\u30fc\u30d3\u30b9\u5185\u5bb9\u306b\u5fdc\u3058\u3066\u9069\u5b9c\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u7ffb\u8a33\u3092\u884c\u3044\u307e\u3059\u3002\n\u4eca\u56de\u306f\u65e5\u672c\u8a9e\u5316\u3092\u884c\u3044\u307e\u3059\u3002\n\n### translator\u306e\u767b\u9332\nzf2\u306b\u306f\u6a19\u6e96\u3067\u5404\u7a2e\u65e5\u672c\u8a9e\u30ea\u30bd\u30fc\u30b9\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002\n\u3053\u306e\u65e5\u672c\u8a9etranslator\u3092Ray.DI\u306eProvider\u3068\u3057\u3066\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```php:Module/App/Zend/i18N/Jp/TranslatorProvider.php\n<?php\nnamespace My\\App\\Module\\App\\Zend\\i18N\\Jp;\n\nuse Ray\\Di\\ProviderInterface;\nuse Zend\\I18n\\Translator\\Translator;\n\n/**\n * Class TranslatorProvider\n * @package My\\App\\Module\\App\\Zend\\i18N\n */\nclass TranslatorProvider implements ProviderInterface\n{\n    /**\n     * @return \\Zend\\I18n\\Translator\\TranslatorInterface\n     */\n    public function get()\n    {\n        global $appDir;\n\n        $translator = new Translator;\n        $file = $appDir . '/vendor/zendframework/zendframework/resources/languages/ja/Zend_Validate.php';\n        $translator->addTranslationFile('phparray', $file, 'default', 'ja_JP');\n\n        return $translator;\n    }\n}\n```\n\n### Validator\u7528Translator\u306e\u4f5c\u6210\n\u4e0a\u8a18Translator\u306f\u69d8\u3005\u306a\u30b5\u30fc\u30d3\u30b9\u3067\u6c4e\u7528\u7684\u306b\u5229\u7528\u3055\u308c\u308btranslator\u3067\u3059\u3002\nValidator\u306b\u9069\u7528\u3067\u304d\u308b\u5c02\u7528\u306e\u65e5\u672c\u8a9eTranslator\u3082\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```php:module/app/zend/validator/jp/translator.php\n<?php\nnamespace My\\App\\Module\\App\\Zend\\Validator\\Jp;\n\nuse Ray\\Di\\Di\\Inject;\nuse Ray\\Di\\Di\\Named;\nuse Zend\\Validator\\Translator\\TranslatorInterface;\n\nclass Translator implements TranslatorInterface\n{\n    /**\n     * @var Translator\n     */\n    private $translator;\n\n    /**\n     * @param \\Zend\\I18n\\Translator\\TranslatorInterface $translator\n     * @Inject\n     * @Named(\"ja_JP\")\n     */\n    public function __construct(\\Zend\\I18n\\Translator\\TranslatorInterface $translator)\n    {\n        $this->translator = $translator;\n    }\n\n    /**\n     * @param  string $message\n     * @param  string $textDomain\n     * @param  string $locale\n     * @return string\n     */\n    public function translate($message, $textDomain = 'default', $locale = 'ja_JP')\n    {\n        return $this->translator->translate($message, $textDomain, $locale);\n    }\n}\n```\n\n## Module\u3078\u306e\u767b\u9332\n\u3044\u3088\u3044\u3088Bind\u3092\u884c\u3044\u307e\u3059\u3002\n\n### DI\nDI\u95a2\u9023\u306eBind\u3067\u3059\u3002\n\n```php:module/app/ZendFormModule.php\n<?php\nnamespace My\\App\\Module\\App;\n\nuse Ray\\Di\\AbstractModule;\nuse Ray\\Di\\Scope;\n\n/**\n * Class ZendFormModule\n * @package My\\App\\Module\\App\n */\nclass ZendFormModule extends AbstractModule\n{\n    /**\n     * {@inheritdoc}\n     */\n    protected function configure()\n    {\n        $this->bind('Zend\\InputFilter\\InputFilterInterface')\n            ->to('Zend\\InputFilter\\InputFilter');\n\n        $this->bind('Zend\\InputFilter\\InputFilterAwareInterface')\n            ->annotatedWith('join')\n            ->to('My\\App\\Filter\\Join');\n\n        $this->bind('Zend\\I18n\\Translator\\TranslatorInterface')\n            ->annotatedWith('ja_JP')\n            ->toProvider('My\\App\\Module\\App\\Zend\\i18N\\Jp\\TranslatorProvider')\n            ->in(Scope::SINGLETON);\n\n        $this->bind('Zend\\Validator\\Translator\\TranslatorInterface')\n            ->to('My\\App\\Module\\App\\Zend\\Validator\\Jp\\Translator')\n            ->in(Scope::SINGLETON);\n\n        $this->bind('Zend\\ServiceManager\\ServiceManager')\n            ->annotatedWith('formHelper')\n            ->toProvider('My\\App\\Module\\App\\Zend\\ServiceManager\\FormHelperProvider')\n            ->in(Scope::SINGLETON);\n    }\n}\n```\n\n\u51e6\u7406\u306e\u4e0a\u304b\u3089\u9806\u306b\u30d0\u30a4\u30f3\u30c9\u306e\u5185\u5bb9\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\n\n1. InputFilterInterface\u306b\u5bfe\u3057\u3066\u5b9f\u88c5\u3092Bind\u3057\u3066\u3044\u307e\u3059\u3002\n2. \u767b\u9332\u30d5\u30a9\u30fc\u30e0\u306eValidator\u3092Bind\u3057\u3066\u3044\u307e\u3059\u3002Namd\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8a2d\u5b9a\u3057\u3066\u5bfe\u8c61\u3092\u9650\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n3. \u65e5\u672c\u8a9eTranslator\u3092Bind\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u3061\u3089\u3082Named\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u8a00\u8a9e\u306e\u5bfe\u8c61\u3092\u9650\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n4. Validator\u306eTranslatorInterface\u306b\u5bfe\u3057\u3066\u65e5\u672c\u8a9eTranslator\u3092Bind\u3057\u3066\u3044\u307e\u3059\u3002\u65e5\u672c\u8a9e\u3057\u304b\u671f\u5f85\u3057\u306a\u3044\u306e\u3067\u30b7\u30f3\u30d7\u30eb\u306bBind\u3057\u3066\u3044\u307e\u3059\u3002\n5. Zend\\ServiceManager\u3092Bind\u3057\u3066\u3044\u307e\u3059\u3002\u5f8c\u307b\u3069\u8aac\u660e\u3057\u307e\u3059\u304cFormHelper\u3068\u3057\u3066\u9650\u5b9a\u7684\u306b\u5229\u7528\u3057\u307e\u3059\u3002\n\n### AOP\nAOP\u95a2\u9023\u306eBind\u3067\u3059\u3002\n\n```php:module/app/Aspect.php\n<?php\n\nnamespace My\\App\\Module\\App;\n\nuse BEAR\\Package;\nuse Ray\\Di\\AbstractModule;\n\nclass Aspect extends AbstractModule\n{\n    /**\n     * {@inheritdoc}\n     */\n    protected function configure()\n    {\n        $this->bindInterceptor(\n            $this->matcher->subclassesOf('My\\App\\Resource\\Page\\Join'),\n            $this->matcher->annotatedWith('BEAR\\Sunday\\Annotation\\Form'),\n            [$this->requestInjection('My\\App\\Interceptor\\Form\\Join')]\n        );\n    }\n}\n```\n\u4eca\u56de\u3082BEAR.Sunday\u304c\u6a19\u6e96\u3067\u7528\u610f\u3055\u308c\u3066\u3044\u308b@Form\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\u5bfe\u8c61\u3068\u306a\u308b\u30da\u30fc\u30b8\u306bForm\u3092\u30d0\u30a4\u30f3\u30c9\u3057\u3066\u3044\u307e\u3059\u3002\n\n## \u30d5\u30a9\u30fc\u30e0\u30d8\u30eb\u30d1\u30fc\u306e\u5b9f\u88c5\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3067\u5229\u7528\u3059\u308b\u969b\u306b\u5229\u7528\u3059\u308b\u30d8\u30eb\u30d1\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u3068\u3057\u3066Twig\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u3092\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n### \u30b5\u30fc\u30d3\u30b9\u30de\u30cd\u30fc\u30b8\u30e3\u306e\u4f5c\u6210\nZf2\u304c\u6a19\u6e96\u3067\u7528\u610f\u3059\u308b\u30d8\u30eb\u30d1\u30fc\u6a5f\u80fd\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u3001Zend\\ServiceManager\u3092\u63d0\u4f9b\u3059\u308bProvider\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nServiceManager\u306eConstructor\u306bHelperConfig\u3092\u6e21\u3059\u3053\u3068\u3067\u3001\u5fc5\u8981\u306a\u30b5\u30fc\u30d3\u30b9\u3092\u30b5\u30fc\u30d3\u30b9\u30ed\u30b1\u30fc\u30bf\u306b\u767b\u9332\u3057\u3066\u3044\u307e\u3059\u3002\n\n```php:Module/App/Zend/Servicemanager/FormHelperProvider.php\n<?php\nnamespace My\\App\\Module\\App\\Zend\\ServiceManager;\n\nuse Ray\\Di\\ProviderInterface as Provide;\nuse Zend\\Form\\View\\HelperConfig;\nuse Zend\\ServiceManager\\ServiceManager;\n\n/**\n * ServiceManager for FormHelper\n */\nclass FormHelperProvider implements Provide\n{\n    /**\n     * @return mixed|ServiceManager\n     */\n    public function get()\n    {\n        return new ServiceManager(new HelperConfig);\n    }\n}\n```\n\u3053\u3061\u3089\u306eProvider\u306f\u524d\u8ff0\u306eZendFormModule.php\u3067\u5229\u7528\u3055\u308c\u307e\u3059\u3002\n\n### Twig_Extension\u306e\u5b9f\u88c5\n\u4e0a\u8a18\u30d8\u30eb\u30d1\u30fc\u3092\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u4e0a\u3067\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306bTwig_Extension\u3068\u3057\u3066\u767b\u9332\u3057\u307e\u3059\u3002\n\n#### Extension\u306e\u5b9f\u88c5\n\u4eca\u56de\u306f\u7d30\u304b\u3044\u51e6\u7406\u306e\u5185\u5bb9\u306f\u5272\u611b\u3057\u307e\u3059\u304c\u3001Form\u306eView\u3078\u306e\u30b5\u30fc\u30d3\u30b9\u767b\u9332\u3068TwigExtension\u3068\u3057\u3066\u306e\u767b\u9332\u3001\u5927\u307e\u304b\u306b\u5206\u3051\u30662\u3064\u306e\u767b\u9332\u51e6\u7406\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\n```php:Interceptor/TemplateEngine/Twig/Extension.php\n<?php\nnamespace My\\App\\Interceptor\\TemplateEngine\\Twig\\Extension;\n\nuse Ray\\Di\\Di\\Inject;\nuse Ray\\Di\\Di\\Named;\nuse Zend\\Form\\View\\HelperConfig;\nuse Zend\\ServiceManager\\ServiceManager;\nuse Zend\\View\\HelperPluginManager;\nuse Zend\\View\\Renderer\\PhpRenderer;\n\n/**\n * Class ZendForm_Twig_Extension\n * @package My\\App\\Interceptor\\TemplateEngine\\Twig\n */\nclass ZendForm_Twig_Extension extends \\Twig_Extension\n{\n    /**\n     * @var ServiceManager\n     */\n    private $serviceManager;\n\n    /**\n     * @param \\Twig_Environment $environment\n     */\n    public function initRuntime(\\Twig_Environment $environment)\n    {\n        $renderer = new PhpRenderer();\n        $helperPluginManager = new HelperPluginManager(new HelperConfig);\n        $registeredService = $this->serviceManager->getRegisteredServices();\n\n        foreach ($registeredService['invokableClasses'] as $invokable) {\n            /** @var \\Zend\\Form\\View\\Helper\\FormElement $formHelper */\n            $formHelper = $this->serviceManager->get($invokable);\n            $formHelper->setView($renderer);\n            $renderer->setHelperPluginManager($helperPluginManager);\n            $environment->registerUndefinedFunctionCallback(\n                function ($name) use ($helperPluginManager, $renderer) {\n                    if (!$helperPluginManager->has($name)) {\n                        return '';\n                    }\n\n                    $callable = [$renderer->plugin($name), '__invoke'];\n                    $options  = ['is_safe' => ['html']];\n                    return new \\Twig_SimpleFunction($name, $callable, $options);\n                }\n            );\n        }\n    }\n\n    /**\n     * @param ServiceManager $serviceManager\n     * @Inject\n     * @Named(\"formHelper\")\n     */\n    public function __construct(ServiceManager $serviceManager)\n    {\n        $this->serviceManager = $serviceManager;\n    }\n\n    /**\n     * @return string\n     */\n    public function getName()\n    {\n        return 'ZendForm';\n    }\n\n    /**\n     * @return array\n     */\n    public function getFunctions()\n    {\n        $registeredService = $this->serviceManager->getRegisteredServices();\n        $functions = [];\n        foreach ($registeredService['invokableClasses'] as $invokable) {\n            $functions[] = new \\Twig_SimpleFunction(\n                $invokable,\n                [$this, $invokable],\n                ['is_safe' => ['html']]\n            );\n        }\n        return $functions;\n    }\n\n    /**\n     * @param $method\n     * @param $arguments\n     * @return string\n     */\n    public function __call($method, $arguments)\n    {\n        if (!$this->serviceManager->has($method)) {\n            return '';\n        }\n\n        /** @var Callable $callable */\n        $callable = $this->serviceManager->get($method);\n        return isset($arguments[0]) ? $callable($arguments[0]) : $callable();\n    }\n}\n```\n\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u3067\u6ce8\u5165\u3055\u308c\u3066\u3044\u308bServiceManager\u306f\u3001\u4e88\u3081Form\u95a2\u9023\u306e\u30d9\u30eb\u30d1\u30fc\u30b5\u30fc\u30d3\u30b9\u304c\u6ce8\u5165\u3055\u308c\u3066\u3044\u308b\u30b5\u30fc\u30d3\u30b9\u30ed\u30b1\u30fc\u30bf\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u3059\u3002\uff08\u524d\u9805\u53c2\u7167\uff09\n\u305d\u308c\u3089\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u53c2\u7167\u3057\u3001Twig\u306e\u95a2\u6570\u3068\u3057\u3066\u52d5\u4f5c\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\n\n#### Extension\u306e\u8ffd\u52a0\u65b9\u6cd5\nBEAR.Sunday\u3067\u306f\u6a19\u6e96\u3067Twig_Environment\u4f5c\u6210\u6642\u306bAura.Input\u95a2\u9023\u306etwig\u62e1\u5f35\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3059\u3002\n\u305d\u306e\u4f5c\u6210\u51e6\u7406\u3068\u3044\u3046\u30dd\u30a4\u30f3\u30c8\u30ab\u30c3\u30c8\u306b\u5bfe\u3057\u3066\u300cExtension\u767b\u9332\u300d\u3068\u3044\u3046\u30a2\u30b9\u30da\u30af\u30c8\u3092\u767b\u9332\u3057\u3066\u307f\u307e\u3059\u3002\n\n```php:INterceptor/TemplateEngine/Twig/ExtensionInjector.php\n<?php\nnamespace My\\App\\Interceptor\\TemplateEngine\\Twig;\n\nuse Ray\\Aop\\MethodInterceptor;\nuse Ray\\Aop\\MethodInvocation;\nuse Ray\\Di\\Di\\Inject;\n\n/**\n * Class ExtensionInjector\n * @package My\\App\\Interceptor\\TemplateEngine\\Twig\n */\nclass ExtensionInjector implements MethodInterceptor\n{\n    /**\n     * @var Extension\\ZendForm_Twig_Extension\n     */\n    private $zendFormExtension;\n\n    /**\n     * @param Extension\\ZendForm_Twig_Extension $zendFormExtension\n     * @Inject\n     */\n    public function __construct(\n        Extension\\ZendForm_Twig_Extension $zendFormExtension)\n    {\n        $this->zendFormExtension = $zendFormExtension;\n    }\n\n    /**\n     * {@inheritdoc}\n     */\n    public function invoke(MethodInvocation $invocation)\n    {\n        /** @var \\Twig_Environment $twig */\n        $twig = $invocation->proceed();\n        $twig->addExtension($this->zendFormExtension);\n        return $twig;\n    }\n}\n```\n\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fExtension\u3092\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u3067\u6ce8\u5165\u3001After advice\u3068\u3057\u3066Extension\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n\n\u3053\u3061\u3089\u3082\u5f53\u7136\u4ee5\u4e0b\u306e\u901a\u308aModule\u306b\u767b\u9332\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```php:Module/App/Aspect.php\n<?php\n\nnamespace My\\App\\Module\\App;\n\nuse BEAR\\Package;\nuse Ray\\Di\\AbstractModule;\n\nclass Aspect extends AbstractModule\n{\n    /**\n     * {@inheritdoc}\n     */\n    protected function configure()\n    {\n        $this->bindInterceptor(\n            $this->matcher->startsWith('BEAR\\Package\\Provide\\TemplateEngine\\Twig\\TwigProvider'),\n            $this->matcher->startsWith('get'),\n            [$this->requestInjection('My\\App\\Interceptor\\TemplateEngine\\Twig\\ExtensionInjector')]\n        );\n    }\n}\n```\n\n## \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u8a18\u8ff0\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\u30d5\u30a9\u30fc\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u81ea\u4f53\u306fPage\u30ea\u30bd\u30fc\u30b9\u306eBody\u306e\u4e2d\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u305d\u3061\u3089\u3092\u64cd\u4f5c\u3057\u3066Form\u3092\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3057\u307e\u3059\u3002\n\u8a73\u3057\u3044\u95a2\u6570\u306e\u52d5\u4f5c\u7b49\u3001\u3053\u3061\u3089\u3082\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u53c2\u7167\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n```php:Resource/Page/Join.twig\n{% extends \"layout/default.twig\" %}\n{% block page %}\n\n    {% if not mail %}\n        {% if form.hasSubmit and not form.isValid() %}\n            <ul class=\"form-errors\">\n                {% for messages in form.getMessages() %}\n                    {% for message in messages %}\n                        <li>*{{ message }}</li>\n                    {% endfor %}\n                {% endfor %}\n            </ul>\n        {% endif %}\n        {{ form().openTag(form) }}\n        {% for element in form %}\n            {{ formelement(element) }}\n        {% endfor %}\n        {{ form().closeTag(form) }}\n\n    {% else %}\n        <h2 class=\"main-title\">\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u767b\u9332\u3092\u53d7\u3051\u4ed8\u3051\u307e\u3057\u305f\u3002</h2>\n        <p class=\"annotations\">\u3054\u767b\u9332\u3044\u305f\u3060\u3044\u305f{{ mail|e }}\u5b9b\u3066\u306b\u767b\u9332\u78ba\u8a8d\u7528\u306e\u3054\u6848\u5185\u3092\u304a\u9001\u308a\u3057\u307e\u3057\u305f\u306e\u3067\u3001\u30e1\u30fc\u30eb\u306e\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u3066\u767b\u9332\u78ba\u8a8d\u3092\u5b8c\u4e86\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>\n\n    {% endif %}\n\n{% endblock %}\n```\n\n## \u6700\u5f8c\u306b\n\u4eca\u56de\u306fBEAR.Sunday\u306e\u30d5\u30a9\u30fc\u30e0\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u5909\u66f4\u3092\u884c\u3044\u307e\u3057\u305f\u304c\u3001\u4e88\u60f3\u4ee5\u4e0a\u306b\u3084\u308b\u3053\u3068\u304c\u591a\u304b\u3063\u305f\u3068\u601d\u3044\u307e\u3059\u3002\n\u305f\u3060\u3001\u5b9f\u88c5\u3057\u3066\u3044\u304f\u4e2d\u3067\u300c\u3069\u3046\u3057\u3088\u3046\u3082\u306a\u3044\u5927\u304d\u306a\u58c1\u300d\u306b\u3076\u3064\u304b\u308b\u3053\u3068\u306f\u3042\u307e\u308a\u306a\u304f\u3001\u9806\u3092\u8ffd\u3063\u3066\u554f\u984c\u3092\u89e3\u6c7a\u3057\u3066\u3044\u3051\u3070\u5fc5\u305a\u5b9f\u88c5\u3067\u304d\u308b\u3068\u3044\u3046\u78ba\u4fe1\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\u305d\u3046\u601d\u308f\u305b\u308b\u306e\u3082\u3001BEAR.Sunday\u304c\u63d0\u4f9b\u3059\u308b\u6a5f\u80fd\u3042\u3063\u3066\u306e\u4e8b\u3067\u3042\u308b\u3068\u540c\u6642\u306b\u3001\u7d1b\u308c\u3082\u7121\u3044\u300c\u63a5\u7d9a\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u300d\u3068\u3057\u3066\u306e\u9b45\u529b\u306e\u4e00\u3064\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\n\n<a name=\"1\">*1</a> \u4eca\u56de\u306e\u4f8b\u3067\u306f\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u30d5\u30a3\u30eb\u30bf\u306b\u30ab\u30b9\u30bf\u30e0\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u65e5\u672c\u8a9e\u3067\u30cf\u30fc\u30c9\u30b3\u30fc\u30c9\u3057\u3066\u3057\u307e\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u591a\u8a00\u8a9e\u30b5\u30dd\u30fc\u30c8\u3092\u671f\u5f85\u3059\u308b\u306e\u3067\u3042\u308c\u3070\u5f53\u7136\u5225\u306e\u7b87\u6240\u3067\u9069\u5207\u306b\u5b9a\u7fa9\u3059\u3079\u304d\u3067\u3059\u3002\n", "tags": ["BEAR.Sunday", "ZendFramework2"]}