{"context": " More than 1 year has passed since last update.\n\n\u6982\u8981\n2015/08/08\u306b\u884c\u308f\u308c\u305fTremaDay\u3067\u767a\u8868\u3057\u305f\u3082\u306e\u306e\u6539\u5584\u5185\u5bb9\u3002\n\u5f53\u65e5\u306fOpenVNet\u3092\u52d5\u304b\u305d\u3046\u3068\u601d\u3063\u305f\u304c\u305d\u306e\u524d\u306eruby+c\u7248\u306etrema\u306earm\u79fb\u690d\u3092\u4e2d\u9014\u534a\u7aef\u306b\u3057\u3066\u3057\u307e\u3063\u305f\u305f\u3081\u5931\u6557\u3002\n\u305d\u3053\u3067\u3001\u4eca\u56de\u306fpure ruby\u7248trema\u3092\u52d5\u304b\u3059\u3068\u3053\u308d\u307e\u3067\u306e\u624b\u9806\u306b\u3059\u308b\u3002\n\n\u610f\u5473\n\u3053\u306e\u5185\u5bb9\u306b\u4e00\u4f53\u3069\u3046\u3044\u3046\u610f\u5473\u304c\u3042\u308b\u304b\u3002\n\u4ee5\u4e0b\u306e\u8003\u3048\u306b\u57fa\u3065\u3044\u3066\u5b9f\u884c\u3057\u3066\u3044\u308b\u3002\n\n\u4eca\u73fe\u5728\u3001\u81ea\u5206\u306e\u6b32\u3057\u3044\u3042\u3089\u3086\u308b\u6a5f\u80fd\u3092\u96c6\u7d04\u3057\u3001\u304b\u3064\u53ef\u642c\u6027\u306e\u9ad8\u3044\u30a4\u30f3\u30d5\u30e9\u306f\u3001\u4eca\u3067\u8a00\u3046\u3068\u3053\u308d\u306e\u30b9\u30de\u30fc\u30c8\u30d5\u30a9\u30f3\u3067\u3042\u308b\n\n\nLinux\u304c\u52d5\u304f\n\u5c0f\u3055\u3044\uff08\u307f\u3093\u306a\u6301\u3063\u3066\u308b\uff09\n\u8efd\u3044\n\u6d88\u8cbb\u96fb\u529b\u304c\u975e\u5e38\u306b\u5c0f\u3055\u3044\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067UPS\uff08\u30d0\u30c3\u30c6\u30ea\u30fc\uff09\u304c\u4ed8\u3044\u3066\u3044\u308b\n\u96fb\u8a71\u304c\u3067\u304d\u308b\uff08\u6b21\u4e16\u4ee3\u30a4\u30f3\u30d5\u30e9\uff01\uff09\n\n\n\u3053\u308c\u3092\u5168\u529b\u3067\u4e26\u3079\u3066\u3001\u6b21\u4e16\u4ee3\u30c7\u30fc\u30bf\u30bb\u30f3\u30bf\u30fc\u306b\u3059\u3079\u304d\n\nNexus\u7b49\u3001\u6d77\u5916\u7aef\u672b\u3092\u5229\u7528\u3059\u308c\u3070\u3082\u3063\u3068\u7c21\u5358\u3060\u304c\u3001\u5b66\u3076\u3053\u3068\u304c\u591a\u305d\u3046\u306a\u3001\u96e3\u3057\u76ee\u306e\u56fd\u7523\u7aef\u672b\u3067\u5b9f\u65bd\u3002\n\n\u5b9f\u65bd\n\n\u6e96\u5099\u3059\u308b\u3082\u306e\n\nSHARP SH-03C\n\u901a\u4fe1\u7528MicroUSB\u30b1\u30fc\u30d6\u30eb\nMicroSD(8GB\u3067\u3082\u3044\u3044\u304c\u3001\u3067\u304d\u308c\u307016GB\u304f\u3089\u3044\u3042\u3063\u305f\u307b\u3046\u304c\u3044\u3044)\n\n\n\u901f\u3044\u307b\u3046\u304c\u591a\u5206\u3044\u3044\n\n\n\narm\u306eubuntu\u30a4\u30e1\u30fc\u30b8\n\ntoolchain\u3092\u4f5c\u308b\u306e\u304c\u8f9b\u3044\u306e\u3067android\u4e0a\u3067ubuntu\u306e\u30b3\u30de\u30f3\u30c9\u7fa4\u3092\u5229\u7528\u3059\u308b\n\n\nSH-03C\u306e\u30ab\u30fc\u30cd\u30eb\u30bd\u30fc\u30b9\u3001\u30c9\u30e9\u30a4\u30d0\u30bd\u30fc\u30b9\n\n\u53e4\u3081\u306eAndroid NDK\n\n\u65b0\u3057\u3044\u3068\u30d3\u30eb\u30c9\u3067\u304d\u306a\u304b\u3063\u305f\u308a\u3059\u308b\n\n\nadb\n\n\nandroid\u3078\u306e\u63a5\u7d9a\u306b\u5229\u7528\nAndroid SDK\u306b\u5165\u3063\u3066\u308b\u3082\u306e\u304b\u3001\u305d\u306e\u8fba\u306b\u8ee2\u304c\u3063\u3066\u3044\u308b\u3082\u306e\u3067\u3082\u3044\u3044\n\n\nbusybox\n\n\n\u3044\u308d\u3044\u308d\u4fbf\u5229\u306a\u306e\u3067\nSHBreak\u3092\u4f7f\u3046\u5834\u5408\u306f\u81ea\u52d5\u3067\u5165\u308b\u306e\u3067\u81ea\u5206\u3067\u5165\u308c\u306a\u304f\u3066\u3044\u3044\n\n\nunubinize\n\n\n\u73fe\u884c\u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u306eunubinize\u306b\u5229\u7528\n\n\nsplit_bootimg.pl\n\n\n\u73fe\u884c\u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u306e\u5206\u89e3\u306b\u5229\u7528\n\n\nmkbootfs\n\n\n\u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u306e\u4f5c\u6210\u306b\u5229\u7528\n\n\nubinize\n\n\n\u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u306eubinize\u306b\u5229\u7528\n\n\nflash_image\n\n\n\u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u306e\u66f8\u304d\u8fbc\u307f\u306b\u5229\u7528\n\n\nWifi\u63a5\u7d9a\n\n\napt-get\u3068\u304b\u3059\u308b\u306e\u3067\u7121\u3044\u3068\u3042\u3068\u3067\u3064\u3089\u3044\n\n\n\u6ce3\u304f\u307b\u3069\u6642\u9593\u304b\u304b\u308b\u72b6\u6cc1\u306b\u8010\u3048\u308b\u7cbe\u795e\n\n\n\u4ed6\u306e\u4f5c\u696d\u306e\u5408\u9593\u306b\u30b3\u30de\u30f3\u30c9\u6253\u3064\u304f\u3089\u3044\u304c\u30b9\u30c8\u30ec\u30b9\u304c\u305f\u307e\u3089\u306a\u304f\u3066\u826f\u3044\n\n\n\n\n\u6ce8\u610f\u4e8b\u9805\n\n\u3053\u306e\u6a5f\u7a2e\u3067\u306f\uff08\u3068\u3044\u3046\u304b\u4eca\u56de\u306e\u30e1\u30fc\u30ab\u30fc\u306e\u591a\u304f\u306e\u7aef\u672b\u3067\u306f\uff09\u96fb\u6e90OFF\u72b6\u614b\u304b\u3089\u901a\u5e38\u8d77\u52d5\u4ee5\u5916\u306e\u30e2\u30fc\u30c9\u3067\u8d77\u52d5\u3059\u308b\u624b\u6bb5\u304c\u5b58\u5728\u3057\u306a\u3044\u305f\u3081\u3001boot\u9818\u57df\u306b\u30ab\u30fc\u30cd\u30eb\u30a4\u30e1\u30fc\u30b8\u3092\u66f8\u304d\u8fbc\u3093\u3067\u8d77\u52d5\u3067\u304d\u306a\u304f\u306a\u308b\u3068\u5ec3\u68c4\u3059\u308b\u3057\u304b\u306a\u304f\u306a\u308b\u3002\u5f93\u3063\u3066\u3001\u8a66\u3059\u969b\u306f\u30ab\u30fc\u30cd\u30eb\u30a4\u30e1\u30fc\u30b8\u306f\u5fc5\u305arecovery\u9818\u57df\u306b\u66f8\u304d\u8fbc\u307f\u3001adb reboot recovery\u306a\u3069\u3067Recovery Mode\u304b\u3089\u8d77\u52d5\u3059\u308b\u3002\n\u307e\u305f\u3001\u8d77\u52d5\u3067\u304d\u306a\u3044\u30a4\u30e1\u30fc\u30b8\u3092recovery\u9818\u57df\u306b\u66f8\u304d\u8fbc\u3093\u3067\u3042\u308b\u72b6\u614b\u3067Factory Reset\u3059\u308b\u3068\u518d\u8d77\u52d5\u30eb\u30fc\u30d7\u306b\u306a\u308a\u3001boot\u9818\u57df\u306b\u6551\u6e08\u53ef\u80fd\u306a\u30ab\u30fc\u30cd\u30eb\u304c\u66f8\u304d\u8fbc\u307e\u308c\u3066\u3044\u306a\u3044\u9650\u308a\u7834\u68c4\u3059\u308b\u3057\u304b\u306a\u304f\u306a\u308b\u305f\u3081\u3001\u3053\u308c\u3082\u6ce8\u610f\u3059\u308b\u3002\n\n\u6700\u3082\u5b89\u5168\u306a\u306e\u306f\u3001boot\u9818\u57df\u306badb\u53ef\u80fd\u304b\u3064init\u306e\u9032\u884c\u3092\u30b5\u30b9\u30da\u30f3\u30c9\u3067\u304d\u308b\u30ab\u30fc\u30cd\u30eb\u304c\u66f8\u304d\u8fbc\u3093\u3067\u3042\u308b\u72b6\u614b\u3002\u3053\u306e\u72b6\u614b\u3067\u3042\u308c\u3070\u3001\u5927\u4f53\u3069\u3093\u306a\u3072\u3069\u3044\u72b6\u6cc1\u306b\u306a\u3063\u3066\u3082\u5fa9\u65e7\u53ef\u80fd\u3002\n\n\u3053\u3046\u306a\u3063\u3066\u3044\u308b\u3068\u3001\u6975\u7aef\u306a\u8a71\u3001/system\u4e0b\u3092tgz\u304b\u4f55\u304b\u306b\u3057\u3066\u3068\u3063\u3066\u3042\u308c\u3070\u3001/system\u3092erase_image\u3057\u3066\u3082\u5fa9\u65e7\u53ef\u80fd\u3002\n\n\n\n\n\u4e0b\u6e96\u5099\n\n\u672c\u4f53\u306e\u5165\u624b\n\u307e\u305aSH-03C\u672c\u4f53\u3092\u5165\u624b\u3059\u308b\u3002\u52d5\u304f\u3060\u3051\u3067\u3088\u3051\u308c\u3070\u3001\u4e2d\u53e4\u3067\u304a\u3088\u305d1,000\u5186\u524d\u5f8c\u3067\u624b\u306b\u5165\u308b\u3002\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u63a5\u7d9a\nandroid\u306e\u8a2d\u5b9a\u753b\u9762\u304b\u3089WiFi\u63a5\u7d9a\u3092\u884c\u3044\u3001\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u51fa\u3089\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u3002\n\n\u6a29\u9650\u6607\u683c\nroot\u306b\u306a\u3063\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\u3053\u306e\u7aef\u672b\u306f/dev/diag\u306e\u8106\u5f31\u6027\u306a\u3069\u3067\u6a29\u9650\u6607\u683c\u304c\u53ef\u80fd\u3002\n\u8106\u5f31\u6027\u304c\u306f\u3063\u304d\u308a\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u81ea\u5206\u3067\u30ab\u30fc\u30cd\u30eb\u30e1\u30e2\u30ea\u3092\u66f8\u304d\u63db\u3048\u3066\u3082\u3044\u3044\u3057\u3001\n\u624b\u306b\u5165\u308b\u3088\u3046\u3067\u3042\u308c\u3070\u5eb5\u6012\u9732\u6170\u6012\u3055\u3093\u306eSHBreak\u3067\u3082\u3044\u3044\u3057\u3001\u305d\u3046\u3067\u306a\u3051\u308c\u3070fi01\u3055\u3093\u306eandroid_run_root_shell\u306a\u3093\u304b\u304c\u304a\u52e7\u3081\u3002\n\nrecovery\u306ewrite protect\u89e3\u9664\nrecovery\u306b\u81ea\u5206\u3067\u4f5c\u3063\u305f\u30ab\u30fc\u30cd\u30eb\u3092\u5165\u308c\u305f\u3044\u306e\u3067\u3001write protect\u3092\u89e3\u9664\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u3053\u306e\u7aef\u672b\u306f/dev/shsd\u306e\u8106\u5f31\u6027\u3084\u3001/dev/ae2\u306e\u8106\u5f31\u6027\u3092\u5229\u7528\u3057\u3066recovery\u306ewrite protect\u3092\u89e3\u9664\u3067\u304d\u308b\u3002\n\u3053\u308c\u3082\u8106\u5f31\u6027\u304c\u306f\u3063\u304d\u308a\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u81ea\u5206\u3067\u3084\u3063\u3066\u3082\u3044\u3044\u3057\u3001\n\u624b\u306b\u5165\u308b\u3088\u3046\u3067\u3042\u308c\u3070\u3001\u305f\u3060\u3050\u3060\u3050\u3060\u3068(\u65b0)\u3055\u3093\uff08\u5143\u306eIS01\u7248\u306fgoroh_kun\u3055\u3093\u4f5c\uff09\u306eSH-03C\u5411\u3051ae2break\u304c\u697d\u3067\u3044\u3044\u3002\n\nrecovery\u306ewrite_protect\u89e3\u9664\n$ adb push busybox /data/local/tmp\n$ adb push ae2break /data/local/tmp\n$ adb shell\n### \u4ee5\u4e0b\u3001android\u3067\u64cd\u4f5c\n$ su\n# chmod 755 /data/local/tmp/busybox\n# chmod 755 /data/local/tmp/ae2break\n# stop mediayamaha\n# kill -9 `/data/local/tmp/busybox pidof mediayamahaserver`\n# /data/local/tmp/ae2break recovery\n\n\nstop mediayamaha\u3067\u7aef\u672b\u304c\u518d\u8d77\u52d5\u3059\u308b\u3053\u3068\u304c\u3042\u308b\u304c\u3001\u6c17\u306b\u305b\u305a\u4f55\u56de\u304b\u8a66\u3057\u3066\u3044\u308b\u3068\u305d\u306e\u3046\u3061\u6210\u529f\u3059\u308b\u3002\n\u3068\u308a\u3042\u3048\u305a\u3001\u3053\u3053\u307e\u3067\u3067recovery\u9818\u57df\u306b\u30a4\u30e1\u30fc\u30b8\u3092\u66f8\u304d\u8fbc\u3081\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002\n\u3053\u306e\u3042\u3068\u306f\u66f8\u304d\u8fbc\u3080\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n\u30ab\u30fc\u30cd\u30eb\u30bd\u30fc\u30b9\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\u3053\u3053\u304b\u3089\u4ee5\u4e0b\u306e\uff12\u3064\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u5c55\u958b\u3059\u308b\u3002\n\nkernel.tar.gz\nwifi_kernel_driver_build212.tar.gz\n\n\n\u5c55\u958b\u3068\u8a2d\u7f6e\n$ tar xzf kernel.tar.gz\n$ tar xzf wifi_kernel_driver_build212.tar.gz\n$ mkdir -p external/synergy/modules/wifi/kernel_driver\n$ mv build212 external/synergy/modules/wifi/kernel_driver/\n\n\n\n\u30ab\u30fc\u30cd\u30eb\u306e\u30d3\u30eb\u30c9\n\n\u52d5\u4f5c\u4e2d\u306e\u672c\u4f53\u304b\u3089\u73fe\u884c\u30ab\u30fc\u30cd\u30eb\u306econfig\u3092\u53d6\u5f97\n\u52d5\u4f5c\u4e2d\u306e\u7aef\u672b\u306e/proc\u304b\u3089\u53d6\u5f97\u3057\u305fconfig.gz\u3092\u5c55\u958b\u3057\u3001config\u3092.config\u306b\u30ea\u30cd\u30fc\u30e0\u3057\u3066\u30ab\u30fc\u30cd\u30eb\u30bd\u30fc\u30b9\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u914d\u7f6e\u3059\u308b\u3002\n\n\u73fe\u884cconfig\u306e\u53d6\u5f97\n$ adb pull /proc/config.gz\n$ gzip -d config.gz\n$ mv config kernel/.config\n\n\n\n\u30ab\u30fc\u30cd\u30eb\u306e\u8a2d\u5b9a\n\u3042\u3068\u3065\u3051\u3067OVS\u3092\u52d5\u4f5c\u3055\u305b\u308b\u305f\u3081\u306b\u306f\u3001linux bridgeing\u3092Module Install\u306b\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308b\u305f\u3081\u3001\u4ee5\u4e0b\u3092.config\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n\nkernel/.config\nCONFIG_BRIDGE=m\n\n\nmenuconfig\u3067\u8a2d\u5b9a\u3059\u308b\u3068\u697d\u3067\u3044\u3044\u3002\u3064\u3044\u3067\u306b\u3001net\u3067\u3042\u308c\u3070veth\u3084gre\u3001filesystem\u3067\u3042\u308c\u3070nfs\u3084cifs\u306a\u3093\u304b\u3092\u6709\u52b9\u306b\u3057\u3066\u304a\u304f\u3068\u5f8c\u3005\u4fbf\u5229\u306a\u3053\u3068\u304c\u3042\u308b\u304b\u3082\u3002\n\n\u30bd\u30fc\u30b9\u4fee\u6b63\n\u51fa\u8377\u3055\u308c\u3066\u3044\u308b\u88fd\u54c1\u306e\u30ab\u30fc\u30cd\u30eb\u306f\u3053\u306e\u30bd\u30fc\u30b9\u3067\u30d3\u30eb\u30c9\u3055\u308c\u3066\u3044\u308b\u306f\u305a\u3060\u304c\u3001\u4e00\u90e8\u30d3\u30eb\u30c9\u3067\u304d\u306a\u3044\uff08\u5ba3\u8a00\u6642\u3068\u5229\u7528\u6642\u306e\u5909\u6570\u540d\u304c\u7570\u306a\u308b\u306a\u3069\u3001\u3069\u3046\u8003\u3048\u3066\u3082\u304a\u304b\u3057\u3044\uff09\u3082\u306e\u304c\u3042\u308b\u3002\n\u4ee5\u4e0b\u306e\uff12\u30bd\u30fc\u30b9\u3092\u4fee\u6b63\u3057\u3066\u304a\u304f\u3002\n\nkernel/arch/arm/mach-msm/sh_sleepcheck.c\n//#include <smd_private.h>\n// \u4ee5\u4e0b\u306b\u4fee\u6b63\n#include \"smd_private.h\"\n\n\n\nkernel/kernel/cpuset.c\n/* Called by cgroups to determine if a cpuset is usable; cgroup_mutex held */\nstatic int cpuset_can_attach(struct cgroup_subsys *ss, struct cgroup *cont,\n                 struct task_struct *tsk, bool threadgroup)\n{\n    int ret;\n    struct cpuset *cs = cgroup_cs(cont);\n\n    // \"tsk\"\u3068\"task\"\u3067\u5909\u6570\u540d\u304c\u7570\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u4fee\u6b63\n    // if ((current != task) && (!capable(CAP_SYS_ADMIN))) {\n    if ((current != tsk) && (!capable(CAP_SYS_ADMIN))) {\n        const struct cred *cred = current_cred(), *tcred;\n\n        if (cred->euid != tcred->uid && cred->euid != tcred->suid)\n            return -EPERM;\n    }\n\n\n\n\u30d3\u30eb\u30c9\n\u4e0a\u8a18\u3092\u76f4\u3057\u305f\u3089make\u3059\u308b\u3002\n\nmake\n$ cd kernel\n$ export CROSS_COMPILE=arm-linux-androideabi-\n$ export ARCH=arm\n$ export PATH=$PATH:/opt/android-ndk-r8e/toolchains/arm-linux-androideabi-4.4.3/prebuilt/linux-x86_64/bin\n$ make\n  CHK     include/linux/version.h\n\u2026\n  LD [M]  net/bridge/bridge.ko\n  CC      net/llc/llc.mod.o\n  LD [M]  net/llc/llc.ko\n\n\n\u30d3\u30eb\u30c9\u306f\u5c11\u3057\u6642\u9593\u304c\u304b\u304b\u308b\u304c\u3001\u653e\u3063\u3066\u304a\u3051\u3070\u305d\u306e\u3046\u3061\u7d42\u308f\u308b\u3002kernel/arch/arm/boot/zImage\u304c\u3067\u304d\u308b\u3002\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u4f5c\u6210\n\u51fa\u6765\u4e0a\u304c\u3063\u305fzImage\u3068\u3001\u73fe\u884c\u306eboot\u9818\u57df\u306einitrd\u3092\u4f7f\u3063\u3066\u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u308b\u3002\n\u307e\u305a\u73fe\u884c\u306einitrd\u304c\u307b\u3057\u3044\u306e\u3067\u3001\u53d6\u5f97\u3059\u308b\u3002\n\nboot\u9818\u57df\u306e\u30c0\u30f3\u30d7\n$ adb shell\n### \u4ee5\u4e0b\u3001android\u3067\u64cd\u4f5c\n$ su\n# dd if=/dev/mtd/mtd0 of=/data/local/tmp/boot_org.img.ubi\n\n\n\u30a4\u30e1\u30fc\u30b8\u306fubinize\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001unubinize\u3059\u308b\u3002\n\nunubinize\n$ adb pull /data/local/tmp/boot_org.img.ubi\n$ unubinize.pl boot_org.img.ubi\n\n\n\u5b9f\u884c\u3059\u308b\u3068boot_org.img.ubi.out\u304c\u3067\u304d\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u30ab\u30fc\u30cd\u30eb\u3068initrd\u306b\u5206\u89e3\u3059\u308b\u3002\n\n\u73fe\u884c\u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u306e\u5206\u89e3\n$ split_bootimg.py boot_org.img.ubi.out\nPage size:      2048 (0x00000800)\nKernel addr:    268468224 (0x10008000)\nKernel size:    6660496 (0x0065a190)\nRamdisk addr:   285212672 (0x11000000)\nRamdisk size:   3177984 (0x00307e00)\nSecond size:    0 (0x00000000)\nSecond addr:    284164096 (0x10f00000)\nBoard name:     \nCommand line: console=ttyDCC0 androidboot.hardware=qcom androidboot.console=tty0\nBase Address: 0x10000000\nWriting boot_org.img.ubi.out-kernel ... complete.\nWriting boot_org.img.ubi.out-ramdisk.cpio ... complete.\n\n\n\u5206\u89e3\u3057\u305f\u3089\u3001\u65b0\u3057\u3044zImage\u3068\u5206\u89e3\u3057\u3066\u51fa\u6765\u305finitrd\u3067\u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3059\u308b\n\n\u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u306e\u4f5c\u6210\n$ mkbootimg --kernel kernel/arch/arm/boot/zImage --ramdisk boot_org.img.ubi.out-ramdisk.cpio --cmdline 'console=ttyDCC0 androidboot.hardware=qcom androidboot.console=tty0' --base 0x10000000 -o boot_new.img\n\n\n\u3067\u304d\u3042\u304c\u3063\u305f\u30a4\u30e1\u30fc\u30b8\u306fubinize\u3057\u3066\u521d\u3081\u3066\u5229\u7528\u53ef\u80fd\u306b\u306a\u308b\u305f\u3081\u3001ubinize\u3059\u308b\u3002\nubi.cfg\u3092\u307e\u305a\u7de8\u96c6\u3059\u308b\u3002\n\nubi.cfg\n[boot]\nmode=ubi\nimage=boot_new.img\nvol_id=0\nvol_size=200MiB\nvol_type=dynamic\nvol_name=boot\nvol_flags=autoresize\n\n\n\u7de8\u96c6\u304c\u7d42\u308f\u3063\u305f\u3089\u3001ubinize\u3092\u5b9f\u884c\u3059\u308b\u3002\n\nubinize\n$ ubinize -o \"boot_new.img.ubi\" -p 128KiB -m 2048 -O 256 \"ubi.cfg\"\n\n\n\u3053\u3053\u307e\u3067\u3067\u3001\u7aef\u672b\u306b\u66f8\u304d\u8fbc\u3080\u7528\u306e\u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u3067\u3042\u308bboot_new.img.ubi\u304c\u3067\u304d\u308b\u3002\n\n\u7aef\u672b\u306e\u30ab\u30fc\u30cd\u30eb\u3092\u66f4\u65b0\n\u4f5c\u3063\u305f\u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u3092recovery\u9818\u57df\u306b\u66f8\u304d\u8fbc\u3080\u3002\n\u7aef\u672b\u306f\u524d\u306e\u624b\u9806\u3067\u884c\u3063\u305f\u3068\u304a\u308a\u3001recovery\u306ewrite protect\u304c\u89e3\u9664\u3055\u308c\u3066\u3044\u308b\u3068\u3059\u308b\u3002\n\n\u7aef\u672b\u306e\u30ab\u30fc\u30cd\u30eb\u3092\u66f4\u65b0\n$ adb push flash_image /data/local/tmp\n$ adb push boot_new.img.ubi /data/local/tmp\n$ adb shell\n### \u4ee5\u4e0b\u3001android\u3067\u64cd\u4f5c\n$ su\n### recovery\u306ewrite protect\u3092\u89e3\u9664\u3057\u3066\u306a\u3051\u308c\u3070\u3001\u3053\u3053\u3067\u89e3\u9664\n# [ae2break\u306a\u3069\u3067\u9069\u5f53\u306b]\n### recovery\u9818\u57df\u306b\u66f8\u304d\u8fbc\u307f\n# cd /data/local/tmp\n# chmod 755 ./flash_image\n# ./flash_image recovery ./boot_new.img.ubi\n### \u7d42\u308f\u3063\u305f\u3089\u518d\u8d77\u52d5\n# reboot recovery\n\n\n\u3053\u308c\u3067\u518d\u8d77\u52d5\u3057\u305f\u5f8c\u306f\u3001\u3055\u3063\u304d\u8a2d\u5b9a\u3092\u3044\u3058\u3063\u305f\u3068\u304a\u308a\u306e\u30ab\u30fc\u30cd\u30eb\u3067\u8d77\u52d5\u3057\u3066\u3044\u308b\u306f\u305a\u3002uname\u3067\u898b\u3066\u307f\u308b\u3002\n\n\u30ab\u30fc\u30cd\u30eb\u306e\u78ba\u8a8d\n$ adb shell\n$ uname -a\nLinux localhost 2.6.32.9-perf #7 PREEMPT Fri Sep 11 23:20:35 JST 2015 armv7l GNU/Linux\n\n\n\narm\u7248ubuntu\u306e\u6e96\u5099\n\u3053\u306e\u307e\u307e\u3060\u3068ovs\u3084ruby\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u3064\u3089\u3044\u306e\u3067\u3001\u30ab\u30fc\u30cd\u30eb\u3060\u3051android\u306e\u307e\u307e\u3067\u3001\u305d\u306e\u4e0a\u3067ubuntu\u3092\u4f7f\u3046\u3088\u3046\u306b\u3059\u308b\u3002\nsyscall\u95a2\u4fc2\u3067\u52d5\u304b\u306a\u3044\u3088\u3046\u306a\u5834\u5408\u3001\u30ab\u30fc\u30cd\u30eb\u30bd\u30fc\u30b9\u3068\u30c4\u30fc\u30eb\u306b\u3064\u3044\u3066\u4fee\u6b63\u3057\u3066\u81ea\u5206\u3067\u30d3\u30eb\u30c9\u3059\u308b\uff08iproute2\u306esetns\u306a\u3069\u304c\u3044\u3044\u4f8b\uff09\u3002\n\u3053\u306e\u3042\u305f\u308a\u306e\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3001\u5c55\u958b\u3057\u3066SDCard\u306b\u5165\u308c\u3066\u304a\u304f\u3002\n\u6050\u3089\u304f\u30a4\u30e1\u30fc\u30b8\u30b5\u30a4\u30ba\u304c\u8db3\u308a\u306a\u304f\u306a\u308b\u306e\u3067\u3001\u30a4\u30e1\u30fc\u30b8\u3092\u5927\u304d\u304f\u4f5c\u308a\u306a\u304a\u3057\u3066\u4e2d\u8eab\u3092\u30b3\u30d4\u30fc\u3057\u3066\u304a\u3044\u305f\u307b\u3046\u304c\u7121\u96e3\u3002\n\nchroot\narm\u7248ubuntu\u306e\u30a4\u30e1\u30fc\u30b8\u3092SDCard\u76f4\u4e0b\u306bubuntu.img\uff08ext2\uff09\u3068\u3057\u3066\u5165\u308c\u305f\u3068\u3057\u3066\u3001\u3053\u308c\u3092rootfs\u306b\u3059\u308b\u3002\n\nchroot\n$ adb shell\n$ mkdir -p /data/local/tmp/ubuntu\n### \u4ee5\u4e0b\u3001android\u3067\u64cd\u4f5c\n$ su\n# /data/local/tmp/busybox losetup /dev/block/loop0 /mnt/sdcard/ubuntu.img\n# /data/local/tmp/busybox mount -t ext2 /dev/block/loop0 /data/local/tmp/ubuntu\n# /data/local/tmp/busybox mount -o bind /dev /data/local/tmp/ubuntu/dev\n# /data/local/tmp/busybox mount -o bind /dev/pts /data/local/tmp/ubuntu/dev/pts\n# /data/local/tmp/busybox mount -t sysfs /sys /data/local/tmp/ubuntu/sys\n# /data/local/tmp/busybox mount -t proc /proc /data/local/tmp/ubuntu/proc\n# /data/local/tmp/busybox mount\n\u2026\n/dev/block/loop0 on /data/local/tmp/ubuntu type ext2 (rw,relatime,errors=continue)\ntmpfs on /data/local/tmp/ubuntu/dev type tmpfs (rw,relatime,mode=755)\ndevpts on /data/local/tmp/ubuntu/dev/pts type devpts (rw,relatime,mode=600,ptmxmode=000)\n/sys on /data/local/tmp/ubuntu/sys type sysfs (rw,relatime)\n/proc on /data/local/tmp/ubuntu/proc type proc (rw,relatime)\n# export PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin\n# export TERM=xterm\n# export HOME=/root\n# chroot /data/local/tmp/ubuntu /bin/bash\n### \u4ee5\u4e0b\u3001ubuntu\nroot@localhost:/# cd\nroot@localhost:~# \n\n\nubuntu\u306b\u5165\u308c\u66ff\u308f\u3063\u305f\u3089\u3001\u4e00\u56de\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u3066\u304a\u304f\u3002\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\nroot@localhost:~# apt-get update\n\u2026\nFetched 3588 kB in 29s (123 kB/s)                                              \nReading package lists... Done\nroot@localhost:~#\n\n\n\novs\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u3053\u3053\u307e\u3067\u304f\u308b\u3068\u5927\u62b5\u306e\u3082\u306e\u304c\u975e\u5e38\u306b\u9045\u3044\u306a\u304c\u3089\u3082\u52d5\u4f5c\u3059\u308b\u306e\u3067\u3001\u4f8b\u3048\u3070apt\u3067\u958b\u767a\u30c4\u30fc\u30eb\u985e\u3092\u63c3\u3048\u308b\u306e\u306f\u7c21\u5358\u3002\novs\u306f\u30bd\u30fc\u30b9\u304b\u3089\u30d3\u30eb\u30c9\u3057\u3066\u5229\u7528\u3057\u3066\u307f\u308b\u3002\n\u3053\u306e\u969b\u3001\u73fe\u884c\u306e\u30ab\u30fc\u30cd\u30eb\u306e\u3042\u308c\u3053\u308c\u304c\u5fc5\u8981\u306b\u306a\u308b\u306e\u3067\u3001/lib/modules/`uname -r`\u306b\u3042\u3089\u304b\u3058\u3081\u7f6e\u3044\u3066\u304a\u304f\uff08version.h\u304c\u5fc5\u8981\u306a\u306e\u3067\u3001\u4e00\u5ea6\u30d3\u30eb\u30c9\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u3067\u3042\u308b\u3053\u3068\uff09\u3002\n\n\u73fe\u884c\u30ab\u30fc\u30cd\u30eb\nroot@localhost:~# uname -r\n2.6.32.9-perf\nroot@localhost:~# ls -la /lib/modules/`uname -r`\ntotal 85740\ndrwxrwxrwx  4 root root     4096 Sep 11 23:59 .\ndrwxr-xr-x  4 root root     4096 Sep 11 23:42 ..\ndrwxr-xr-x 25 1000 1000     4096 Sep 11 23:59 build\ndrwxrwxrwx  2 root root     4096 Sep 11 23:59 extra\n-rw-rw-rw-  1 root root 87623903 Sep 11 23:59 kernel.tgz\n-rw-rw-rw-  1 root root      200 Sep 11 23:59 modules.alias\n-rw-rw-rw-  1 root root      159 Sep 11 23:59 modules.alias.bin\n-rw-rw-rw-  1 root root       69 Sep 11 23:59 modules.ccwmap\n-rw-rw-rw-  1 root root      212 Sep 11 23:59 modules.dep\n-rw-rw-rw-  1 root root      466 Sep 11 23:59 modules.dep.bin\n-rw-rw-rw-  1 root root       52 Sep 11 23:59 modules.devname\n-rw-rw-rw-  1 root root       73 Sep 11 23:59 modules.ieee1394map\n-rw-rw-rw-  1 root root      141 Sep 11 23:59 modules.inputmap\n-rw-rw-rw-  1 root root       81 Sep 11 23:59 modules.isapnpmap\n-rw-rw-rw-  1 root root       74 Sep 11 23:59 modules.ofmap\n-rw-rw-rw-  1 root root       99 Sep 11 23:59 modules.pcimap\n-rw-rw-rw-  1 root root       43 Sep 11 23:59 modules.seriomap\n-rw-rw-rw-  1 root root      131 Sep 11 23:59 modules.softdep\n-rw-rw-rw-  1 root root     2936 Sep 11 23:59 modules.symbols\n-rw-rw-rw-  1 root root     3503 Sep 11 23:59 modules.symbols.bin\n-rw-rw-rw-  1 root root      189 Sep 11 23:59 modules.usbmap\nroot@localhost:~# \n\n\n\u305d\u3053\u307e\u3067\u304c\u5b8c\u4e86\u3057\u3066\u3044\u308b\u524d\u63d0\u3067\u3001ovs\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\u30b9\u30de\u30fc\u30c8\u30d5\u30a9\u30f3\u306e\u65e5\u6642\u3092\u76f4\u3057\u3066\u304a\u304b\u306a\u3044\u3068configure\u304c\u7d42\u308f\u3089\u306a\u304f\u306a\u308b\u306e\u3067\u3001\u76f4\u3057\u3066\u304a\u304f\u3053\u3068\u3002\n\n\u6642\u523b\u4fee\u6b63\nroot@localhost:~# date -s \"2015/09/12 00:00:00\"\nSat Sep 12 00:00:00 UTC 2015\n\n\n\novs\u30d3\u30eb\u30c9\u6e96\u5099\nroot@localhost:~# apt-get install -y git automake autoconf gcc uml-utilities libtool build-essential git pkg-config\nroot@localhost:~# wget http://openvswitch.org/releases/openvswitch-2.3.1.tar.gz\nroot@localhost:~# tar zxf openvswitch-2.3.1.tar.gz\nroot@localhost:~# cd openvswitch-2.3.1\nroot@localhost:~/openvswitch-2.3.1# \n\n\n\u4ee5\u4e0b\u306e\u30bd\u30fc\u30b9\u3067NUMA_NODE_NO\u304c\u672a\u5b9a\u7fa9\u306a\u306e\u3067\u3001-1\u306b\u3057\u3066\u304a\u304f\u3002\n\ndatapath/flow.c\n    //if (likely(flow->stats_last_writer != NUMA_NO_NODE)\n    if (likely(flow->stats_last_writer != -1)\n        && likely(!rcu_dereference(flow->stats[node]))) {\n\n\n\ndatapath/flow_table.c\n    //flow->stats_last_writer = NUMA_NO_NODE;\n    flow->stats_last_writer = -1;\n\n\n\u3053\u308c\u304c\u7d42\u308f\u3063\u305f\u3089\u30d3\u30eb\u30c9\u3002\n\novs\u306e\u30d3\u30eb\u30c9\nroot@localhost:~/openvswitch-2.3.1# ./boot.sh\nlibtoolize: putting auxiliary files in AC_CONFIG_AUX_DIR, `build-aux'.\nlibtoolize: copying file `build-aux/config.guess'\n\u2026\nlibtoolize: copying file `m4/lt~obsolete.m4'\nroot@localhost:~/openvswitch-2.3.1# ./configure --with-linux=/lib/modules/`uname -r`/build\nchecking for a BSD-compatible install... /usr/bin/install -c\nchecking whether build environment is sane... yes\n\u2026\nconfig.status: executing include/openflow/openflow.h.stamp commands\nconfig.status: executing utilities/bugtool/dummy commands\nroot@localhost:~/openvswitch-2.3.1# make\nmake  all-recursive\nmake[1]: Entering directory `/root/openvswitch-2.3.1'\n\u2026\ntouch include/openflow/openflow.hstamp\nmake[2]: Leaving directory `/root/openvswitch-2.3.1'\nmake[1]: Leaving directory `/root/openvswitch-2.3.1'\nroot@localhost:~/openvswitch-2.3.1# \n\n\n\u7d50\u69cb\u6642\u9593\u304c\u304b\u304b\u308b\u304c\u3001\u8010\u3048\u308b\u3068\u3044\u3046\u304b\u3001\u653e\u7f6e\u3059\u308b\u3002\n\u5b8c\u4e86\u3057\u305f\u3089\u3001ovs\u306e\u8d77\u52d5\u3092\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3002\n\novs\u306e\u8d77\u52d5\u78ba\u8a8d\nroot@localhost:~/openvswitch-2.3.1# insmod datapath/linux/openvswitch.ko \nroot@localhost:~/openvswitch-2.3.1# lsmod\nModule                  Size  Used by\nopenvswitch            78130  0 \nroot@localhost:~/openvswitch-2.3.1# \nroot@localhost:~/openvswitch-2.3.1# mkdir -p /usr/local/etc/openvswitch\nroot@localhost:~/openvswitch-2.3.1# ./ovsdb/ovsdb-tool create /usr/local/etc/openvswitch/conf.db vswitchd/vswitch.ovsschema\nroot@localhost:~/openvswitch-2.3.1# ./ovsdb/ovsdb-server -v --remote=punix:/usr/local/var/run/openvswitch/db.sock \\\n  --remote=db:Open_vSwitch,Open_vSwitch,manager_options \\\n  --private-key=db:Open_vSwitch,SSL,private_key \\\n  --certificate=db:Open_vSwitch,SSL,certificate \\\n  --pidfile --detach --log-file\n2015-09-12T00:37:05Z|00001|vlog|INFO|opened log file /usr/local/var/log/openvswitch/ovsdb-server.log\n2015-09-12T00:37:06Z|00002|daemon_unix|DBG|/usr/local/var/run/openvswitch/ovsdb-server.pid: deleted stale pidfile\n2015-09-12T00:37:06Z|00003|hmap|DBG|lib/shash.c:112: 6 nodes in bucket (16 nodes, 8 buckets)\nroot@localhost:~/openvswitch-2.3.1# ./utilities/ovs-vsctl --no-wait init\nroot@localhost:~/openvswitch-2.3.1# ./vswitchd/ovs-vswitchd --pidfile --detach\n2015-09-12T00:38:32Z|00001|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock: connecting...\n2015-09-12T00:38:32Z|00002|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock: connected\nroot@localhost:~/openvswitch-2.3.1# ./utilities/ovs-vsctl add-br br0\nroot@localhost:~/openvswitch-2.3.1# ./utilities/ovs-vsctl show      \nfd1f82c9-8f57-440a-ba5f-a778833896de\n    Bridge \"br0\"\n        Port \"br0\"\n            Interface \"br0\"\n                type: internal\nroot@localhost:~/openvswitch-2.3.1# ./utilities/ovs-ofctl dump-flows br0\nNXST_FLOW reply (xid=0x4):\n cookie=0x0, duration=13.746s, table=0, n_packets=0, n_bytes=0, idle_age=13, priority=0 actions=NORMAL\n\n\novs\u306e\u52d5\u4f5c\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3002\u3053\u306e\u6642\u70b9\u3067\u3001\u4ed6\u306e\u7aef\u672b\u3092OpenFlow Controller\u306b\u3057\u3066\u3053\u306e\u7aef\u672b\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u64cd\u4f5c\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u3002\n\u4eca\u56de\u306f\u3001\u5c06\u6765\u7684\u306b\u5206\u6563Edge Overlay\u3082\u898b\u636e\u3048\u3066\u3001Controller\u3082\u3053\u306e\u7aef\u672b\u306b\u76f4\u63a5\u3044\u308c\u3066\u307f\u308b\u3002\n\nruby\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nruby\u306f\u666e\u901a\u306b\u30bd\u30fc\u30b9\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3082\u3044\u3044\u3057\u3001rbenv\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3082\u3044\u3044\u3002\n\u4eca\u56de\u306frbenv\u3092\u4f7f\u3046\u3053\u3068\u306b\u3057\u305f\u3002\n\nrbenv\u3067ruby\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nroot@localhost:~/openvswitch-2.3.1# cd\nroot@localhost:~# git clone https://github.com/sstephenson/rbenv.git ~/.rbenv\nroot@localhost:~# echo 'export PATH=\"$HOME/.rbenv/bin:$PATH\"' >> ~/.bash_profile\nroot@localhost:~# echo 'eval \"$(rbenv init -)\"' >> ~/.bash_profile\nroot@localhost:~# . ~/.bash_profile\nroot@localhost:~# rbenv --version\nrbenv 0.4.0-153-g3b6faa8\nroot@localhost:~# git clone https://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build\nroot@localhost:~# rbenv install --list\nAvailable versions:\n\u2026\n  2.2.3\n\u2026\nroot@localhost:~# rbenv install -v 2.2.3     \nDownloading ruby-2.2.3.tar.gz...\n/tmp/ruby-build.20150912004449.10219 ~\nHTTP/1.1 200 OK\n\u2026\nInstalled ruby-2.2.3 to /root/.rbenv/versions/2.2.3\n\n/tmp/ruby-build.20150912004449.10219 ~\n~\nroot@localhost:~# \n\n\n\u3053\u308c\u3082\u5272\u3068\u6642\u9593\u304c\u304b\u304b\u308b\u304c\u3001\u653e\u7f6e\u3057\u3066\u3044\u308b\u3068\u305d\u306e\u3046\u3061\u7d42\u308f\u308b\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u7d42\u308f\u3063\u305f\u3089\u3001\u52d5\u4f5c\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\nruby\u306e\u52d5\u4f5c\u78ba\u8a8d\nroot@localhost:~# rbenv rehash\nroot@localhost:~# rbenv global 2.2.3\nroot@localhost:~# ruby -v\nruby 2.2.3p173 (2015-08-18 revision 51636) [armv7l-linux-eabihf]\nroot@localhost:~# \n\n\n\u52d5\u4f5c\u3059\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3002\nbundler\u304c\u8981\u308b\u306e\u3067\u3001\u5165\u308c\u3066\u304a\u304f\u3002\n\nbundler\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nroot@localhost:~/# gem install bundler\nFetching: bundler-1.10.6.gem (100%)\n/root/.rbenv/rbenv.d/exec/gem-rehash/rubygems_plugin.rb:6: warning: Insecure world writable dir /root/.rbenv/versions in PATH, mode 040777\nSuccessfully installed bundler-1.10.6\nParsing documentation for bundler-1.10.6\nInstalling ri documentation for bundler-1.10.6\nDone installing documentation for bundler after 70 seconds\n1 gem installed\nroot@localhost:~/# \n\n\n\ntrema\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nalignment\u306a\u3069\u306e\u95a2\u4fc2\u3067arm\u3078\u306e\u79fb\u690d\u304c\u3068\u3066\u3082\u3064\u3089\u3044\u305f\u3081\u3001\u6700\u65b0\u306epure ruby\u7248\u3092\u5229\u7528\u3059\u308b\u3002\n\u51e6\u7406\u901f\u5ea6\u304c1/5\u7a0b\u5ea6\u306b\u843d\u3061\u308b\u3068\u8a00\u308f\u308c\u3066\u3044\u308b\u304c\u3001\u79fb\u690d\u6027\u3084\u30bd\u30fc\u30b9\u306e\u8ffd\u3044\u3084\u3059\u3055\u3001debug\u306e\u3057\u3084\u3059\u3055\u306f\u3053\u3061\u3089\u306e\u307b\u3046\u304c\u9065\u304b\u306b\u9ad8\u304f\u3001\u4eca\u5f8carm\u30b5\u30fc\u30d0\u306a\u3069\u306bSDN\u304c\u666e\u53ca\u3057\u3066\u3044\u304f\uff08\u3068\u52dd\u624b\u306b\u601d\u3063\u3066\u3044\u308b\uff09\u4e8b\u3092\u8003\u3048\u308b\u3068\u3001\u3068\u3066\u3082\u52a9\u304b\u308b\u3002\n\u203bruby+c\u7248\u306f\u3001\u5c11\u3057\u6df1\u304f\u5165\u308b\u3068C\u306e\u30bd\u30fc\u30b9\u306b\u5f53\u305f\u308b\u305f\u3081\u3001debug\u304c\u624b\u9593\u3060\u3063\u305f\u3002\n\ntrema\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nroot@localhost:~# git clone https://github.com/trema/trema.git\nroot@localhost:~# cd trema\nroot@localhost:~/trema# git checkout -b 0.6.0 refs/tags/0.6.0\nSwitched to a new branch '0.6.0'\nroot@localhost:~/trema# rm .ruby-version \nroot@localhost:~/trema# bundle install --path=vendor/bundle\n/root/.rbenv/versions/2.2.3/lib/ruby/gems/2.2.0/gems/bundler-1.10.6/lib/bundler/vendor/thor/lib/thor/shell/basic.rb:356: warning: Insecure world writable dir /root/.rbenv/versions in PATH, mode 040777\nDon't run Bundler as root. Bundler can ask for sudo if it is needed, and\ninstalling your bundle as root will break this application for all non-root\nusers on this machine.\nFetching gem metadata from https://rubygems.org/.........\nFetching version metadata from https://rubygems.org/..\nResolving dependencies.........................................................................................\nUsing rake 10.4.2\nInstalling abstract_type 0.0.7\nInstalling ice_nine 0.11.1\n\u2026\nroot@localhost:~/trema# \n\n\n\ntrema\u306e\u52d5\u4f5c\u78ba\u8a8d\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u7d42\u308f\u3063\u305f\u3089\u3001\u8d77\u52d5\u3092\u78ba\u8a8d\u3059\u308b\u3002\u3068\u308a\u3042\u3048\u305aOpenFlow1.0\u306b\u3059\u308b\u3002\n\ntrema\u306b\u7e4b\u3050bridge\u306e\u8d77\u52d5\u3068\u3001HelloTrema\u306e\u78ba\u8a8d\nroot@localhost:~/trema# /root/openvswitch-2.3.1/utilities/ovs-vsctl add-br br1 -- set bridge br1  protocols=OpenFlow10 -- set bridge br1 other_config:disable-in-band=true -- set bridge br1 other-config:datapath-id=0000000000000001 -- set bridge br1 other-config:hwaddr=00:00:00:00:00:01 -- set-fail-mode br1 standalone -- set-controller br1 tcp:127.0.0.1:6653\nroot@localhost:~/trema# /root/openvswitch-2.3.1/utilities/ovs-vsctl show\nfd1f82c9-8f57-440a-ba5f-a778833896de\n    Bridge \"br0\"\n        Port \"br0\"\n            Interface \"br0\"\n                type: internal\n    Bridge \"br1\"\n        Controller \"tcp:127.0.0.1:6653\"\n        fail_mode: standalone\nroot@localhost:~/trema# git clone https://github.com/trema/hello_trema.git\nroot@localhost:~/trema# bundle exec bin/trema run hello_trema/lib/hello_trema.rb\n/root/.rbenv/versions/2.2.3/lib/ruby/gems/2.2.0/gems/bundler-1.10.6/lib/bundler/shared_helpers.rb:78: warning: Insecure world writable dir /root/.rbenv/versions in PATH, mode 040777\n/root/trema/trema.gemspec:20: warning: Insecure world writable dir /root/trema/vendor/bundle/ruby/2.2.0/bin in PATH, mode 040777\nTrema started.\nHello 0x1!\n\n\nHelloTrema\u304c\u8d77\u52d5\u3057\u3001switch ready\u304c\u52d5\u4f5c\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u78ba\u8a8d\u3067\u304d\u305f\u3002\n\n\u5ff5\u306e\u70ba\u3001flowmod\u3068\u304b\u78ba\u8a8d\n\u3068\u308a\u3042\u3048\u305aveth\u3092ovs\u306b\u633f\u3057\u3066\u307f\u3066\u3001\u9069\u5f53\u306bpacket_in\u3084flow_mod\u306a\u3069\u3092\u52d5\u304b\u3057\u3066\u307f\u308b\u3002\nroot@localhost:~/trema# ip link add v11 type veth peer name v12\nroot@localhost:~/trema# ip link set v11 up\nroot@localhost:~/trema# ip link set v12 up\nroot@localhost:~/trema# /root/openvswitch-2.3.1/utilities/ovs-vsctl add-port br1 v11\nroot@localhost:~/trema# ip addr add 10.0.0.1 dev v12\nroot@localhost:~/trema# route add -net 10.0.0.0/8 dev v12\nroot@localhost:~/trema# /root/openvswitch-2.3.1/utilities/ovs-vsctl show    \nfd1f82c9-8f57-440a-ba5f-a778833896de\n    Bridge \"br0\"\n        Port \"br0\"\n            Interface \"br0\"\n                type: internal\n    Bridge \"br1\"\n        Controller \"tcp:127.0.0.1:6653\"\n        fail_mode: standalone\n        Port \"br1\"\n            Interface \"br1\"\n                type: internal\n        Port \"v11\"\n            Interface \"v11\"\nroot@localhost:~/trema# route -n      \nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n192.168.2.0     0.0.0.0         255.255.255.0   U     0      0        0 wlan0\n169.254.0.0     0.0.0.0         255.255.0.0     U     0      0        0 wlan0\n10.0.0.0        0.0.0.0         255.0.0.0       U     0      0        0 v12\n0.0.0.0         192.168.2.1     0.0.0.0         UG    0      0        0 wlan0\nroot@localhost:~/trema# \n\n\u307e\u305aveth\u306e\u7247\u65b9\u3067\u3042\u308bv11\u3092br1\u306b\u8a2d\u5b9a\u3057\u3066route\u3092\u8a2d\u5b9a\u3057\u305f\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u610f\u5473\u306e\u306a\u3044Controller\u3092trema\u3067\u52d5\u304b\u3057\u3066\u307f\u308b\u3002\u6210\u529f\u3059\u308c\u3070FLOOD\u306eflow\u304c\u5165\u308b\u306f\u305a\u3002\uff08tremaday\u306e\u3068\u304d\u306f\u52d5\u304b\u306a\u304b\u3063\u305f\uff09\n\n\u30b5\u30f3\u30d7\u30eb\nclass TestController < Trema::Controller\n  def switch_ready(datapath_id)\n    logger.info \"switch_ready: #{datapath_id.to_hex}\"\n  end\n\n  def packet_in(datapath_id, message)\n    logger.info \"packet_in: #{datapath_id.to_hex}\"\n    send_flow_mod_add(\n      datapath_id,\n      {\n        match: Match.new(in_port: 1, dl_type: 0x0800),\n        actions: SendOutPort.new(:flood)\n      }\n    )\n    logger.info \"sent: #{datapath_id.to_hex} flow_mod\"\n    send_packet_out(\n      datapath_id,\n      packet_in: message,\n      actions: SendOutPort.new(:flood)\n    )\n  end\nend\n\n\n\n\u5b9f\u884c\nroot@localhost:~/trema# /root/openvswitch-2.3.1/utilities/ovs-vsctl dump-flows br1\nNXST_FLOW reply (xid=0x4):\nroot@localhost:~/trema# bundle exec bin/trema run test.rb &\n[1] 10416\nroot@localhost:~/trema# /root/.rbenv/versions/2.2.3/lib/ruby/gems/2.2.0/gems/bundler-1.10.6/lib/bundler/shared_helpers.rb:78: warning: Insecure world writable dir /root/.rbenv/versions in PATH, mode 040777\n/root/trema/trema.gemspec:20: warning: Insecure world writable dir /root/trema/vendor/bundle/ruby/2.2.0/bin in PATH, mode 040777\nswitch_ready: 0x1\n\nroot@localhost:~/trema# /root/openvswitch-2.3.1/utilities/ovs-vsctl dump-flows br1\nNXST_FLOW reply (xid=0x4):\nroot@localhost:~/trema# packet_in: 0x1\nsent: 0x1 flow_mod\n\nroot@localhost:~/trema# /root/openvswitch-2.3.1/utilities/ovs-vsctl dump-flows br1\nNXST_FLOW reply (xid=0x4):\n cookie=0x0, duration=3.198s, table=0, n_packets=0, n_bytes=0, idle_age=3, priority=0,in_port=1 actions=FLOOD\nroot@localhost:~/trema# \nroot@localhost:~/trema# ping 10.0.0.254\nPING 10.0.0.254 (10.0.0.254) 56(84) bytes of data.\n^C\n--- 10.0.0.254 ping statistics ---\n2 packets transmitted, 0 received, 100% packet loss, time 1008ms\n\nroot@localhost:~/trema# /root/openvswitch-2.3.1/utilities/ovs-vsctl dump-flows br1\nNXST_FLOW reply (xid=0x4):\n cookie=0x0, duration=11.068s, table=0, n_packets=3, n_bytes=126, idle_age=1, priority=0,in_port=1 actions=FLOOD\nroot@localhost:~/trema# \n\n\n\u52d5\u4f5c\u3059\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3002\u3053\u308c\u3067\u3053\u306e\u7aef\u672b\u3067OpenFlow\u3092\u4f7f\u3063\u305fControl Plane\u3001Data Plane\u3092\u6271\u3046\u4e8b\u304c\u53ef\u80fd\u306b\u306a\u3063\u305f\u3002\n\n\u3053\u306e\u5f8c\n\nnamespace\n\u3053\u3053\u307e\u3067\u304f\u308b\u3068\u7aef\u672b\u3092\u4e26\u3079\u3066\u30b3\u30f3\u30c6\u30ca\u3092\u52d5\u304b\u3057\u3066\u30dd\u30fc\u30bf\u30d6\u30eb\u30c7\u30fc\u30bf\u30bb\u30f3\u30bf\u30fc\u306b\u3057\u305f\u304f\u306a\u3063\u3066\u304f\u308b\u3068\u3044\u3046\u304b\u3001\u305d\u308c\u304c\u5143\u3005\u306e\u76ee\u7684\u306a\u306e\u3067\u3001\u305d\u306e\u524d\u306bcgroup\u3084\u3001\u5404\u7a2enamespace\u7b49\u3092\u6709\u52b9\u306b\u3059\u308b\u3002\n\u3068\u3053\u308d\u3067\u3001\u3053\u306e\u30ab\u30fc\u30cd\u30eb\u306fnetns\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6709\u52b9\u306b\u3057\u305f\u3068\u3053\u308d\u3067\u3001netns\u95a2\u9023\u306e\u30bd\u30fc\u30b9\u304c\u5165\u3063\u3066\u3044\u306a\u3044\u306e\u3067\u6a5f\u80fd\u3057\u306a\u3044\u3002\u4ed5\u65b9\u304c\u306a\u3044\u306e\u3067\u3001Kernel2.6\u7cfb\u3067netns\u3068\u3044\u3048\u3070CentOS6.X\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u30d1\u30c3\u30c1\u3092\u3082\u3063\u3066\u304d\u3066\u7121\u7406\u77e2\u7406\u5f53\u3066\u308b\u3002\n\u5e78\u3044\u3001\u30d1\u30c3\u30c1\u3092\u516c\u958b\u3057\u3066\u304f\u308c\u3066\u3044\u308b\u65b9\u304c\u3044\u3089\u3063\u3057\u3083\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u5229\u7528\u3055\u305b\u3066\u9802\u304f\u3002\n\u3053\u306e\u72b6\u614b\u3067\u306f\u307e\u3060\u4e0d\u5341\u5206\u3067\u3001netns\u7cfb\u306e\u64cd\u4f5c\u3092\u884c\u3046\u3068Function not implemented\u3068\u8a00\u308f\u308c\u308b\u3002\n\u305d\u3082\u305d\u3082arch/arm/include/calls.S\u3092\u898b\u308b\u3068\u3001setns\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u306a\u3044\u3002\u3064\u307e\u308a\u3001setns\u3092\u5229\u7528\u3057\u305f\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u52d5\u4f5c\u3057\u306a\u3044\u3002\u305d\u306e\u305f\u3081\u3001\u81ea\u5206\u3067calls.S\u306b\u9069\u5f53\u306bsetns\u3092\u8ffd\u52a0\u3059\u308b\u3002\u307e\u305f\u3001iproute\u7b49\u306esyscall\u756a\u53f7\u3092\u76f4\u3057\u3066\u30d3\u30eb\u30c9\u3059\u308b\u3053\u3068\u3067\u3001\u4e00\u5fdc\u5229\u7528\u53ef\u80fd\u306b\u306f\u306a\u308b\u3002\n\nveth\u306esetns\n\u65e9\u901fveth\u306b\u5bfe\u3057\u3066setns\u3092\u5b9f\u884c\u3057\u3088\u3046\u304b\u3068\u304a\u3082\u3063\u305f\u3068\u3053\u308d\u3001invalid argument\u3068\u8a00\u308f\u308c\u3066\u3057\u307e\u3046\u3002\nbridge\u306e\u3088\u3046\u306bsetns local\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306b\u3088\u304f\u767a\u751f\u3059\u308b\u73fe\u8c61\u3060\u304c\u3001ethtool\u3067\u898b\u3066\u3082veth\u306f\u305d\u3046\u306a\u3063\u3066\u3044\u306a\u3044\u3002\n\u3053\u308c\u306b\u3064\u3044\u3066\u306f\u8abf\u67fb\u4e2d\u3002\n\n# \u6982\u8981\n\n2015/08/08\u306b\u884c\u308f\u308c\u305f[TremaDay](http://trema.connpass.com/event/16844/)\u3067\u767a\u8868\u3057\u305f\u3082\u306e\u306e\u6539\u5584\u5185\u5bb9\u3002\n\u5f53\u65e5\u306f[OpenVNet](http://openvnet.org/)\u3092\u52d5\u304b\u305d\u3046\u3068\u601d\u3063\u305f\u304c\u305d\u306e\u524d\u306eruby+c\u7248\u306etrema\u306earm\u79fb\u690d\u3092\u4e2d\u9014\u534a\u7aef\u306b\u3057\u3066\u3057\u307e\u3063\u305f\u305f\u3081\u5931\u6557\u3002\n\u305d\u3053\u3067\u3001\u4eca\u56de\u306fpure ruby\u7248trema\u3092\u52d5\u304b\u3059\u3068\u3053\u308d\u307e\u3067\u306e\u624b\u9806\u306b\u3059\u308b\u3002\n\n# \u610f\u5473\n\n\u3053\u306e\u5185\u5bb9\u306b\u4e00\u4f53\u3069\u3046\u3044\u3046\u610f\u5473\u304c\u3042\u308b\u304b\u3002\n\u4ee5\u4e0b\u306e\u8003\u3048\u306b\u57fa\u3065\u3044\u3066\u5b9f\u884c\u3057\u3066\u3044\u308b\u3002\n\n* \u4eca\u73fe\u5728\u3001\u81ea\u5206\u306e\u6b32\u3057\u3044\u3042\u3089\u3086\u308b\u6a5f\u80fd\u3092\u96c6\u7d04\u3057\u3001\u304b\u3064\u53ef\u642c\u6027\u306e\u9ad8\u3044\u30a4\u30f3\u30d5\u30e9\u306f\u3001\u4eca\u3067\u8a00\u3046\u3068\u3053\u308d\u306e\u30b9\u30de\u30fc\u30c8\u30d5\u30a9\u30f3\u3067\u3042\u308b\n  * Linux\u304c\u52d5\u304f\n  * \u5c0f\u3055\u3044\uff08\u307f\u3093\u306a\u6301\u3063\u3066\u308b\uff09\n  * \u8efd\u3044\n  * \u6d88\u8cbb\u96fb\u529b\u304c\u975e\u5e38\u306b\u5c0f\u3055\u3044\n  * \u30c7\u30d5\u30a9\u30eb\u30c8\u3067UPS\uff08\u30d0\u30c3\u30c6\u30ea\u30fc\uff09\u304c\u4ed8\u3044\u3066\u3044\u308b\n  * \u96fb\u8a71\u304c\u3067\u304d\u308b\uff08\u6b21\u4e16\u4ee3\u30a4\u30f3\u30d5\u30e9\uff01\uff09\n* \u3053\u308c\u3092\u5168\u529b\u3067\u4e26\u3079\u3066\u3001\u6b21\u4e16\u4ee3\u30c7\u30fc\u30bf\u30bb\u30f3\u30bf\u30fc\u306b\u3059\u3079\u304d\n\nNexus\u7b49\u3001\u6d77\u5916\u7aef\u672b\u3092\u5229\u7528\u3059\u308c\u3070\u3082\u3063\u3068\u7c21\u5358\u3060\u304c\u3001\u5b66\u3076\u3053\u3068\u304c\u591a\u305d\u3046\u306a\u3001\u96e3\u3057\u76ee\u306e\u56fd\u7523\u7aef\u672b\u3067\u5b9f\u65bd\u3002\n\n# \u5b9f\u65bd\n\n## \u6e96\u5099\u3059\u308b\u3082\u306e\n\n* [SHARP SH-03C](https://ja.wikipedia.org/wiki/SH-03C)\n* \u901a\u4fe1\u7528MicroUSB\u30b1\u30fc\u30d6\u30eb\n* MicroSD(8GB\u3067\u3082\u3044\u3044\u304c\u3001\u3067\u304d\u308c\u307016GB\u304f\u3089\u3044\u3042\u3063\u305f\u307b\u3046\u304c\u3044\u3044)\n  * \u901f\u3044\u307b\u3046\u304c\u591a\u5206\u3044\u3044\n* [arm\u306eubuntu\u30a4\u30e1\u30fc\u30b8](http://cdimage.ubuntu.com/releases/12.04.5/release/ubuntu-12.04-preinstalled-desktop-armhf+ac100.tar.gz)\n  * toolchain\u3092\u4f5c\u308b\u306e\u304c\u8f9b\u3044\u306e\u3067android\u4e0a\u3067ubuntu\u306e\u30b3\u30de\u30f3\u30c9\u7fa4\u3092\u5229\u7528\u3059\u308b\n* [SH-03C\u306e\u30ab\u30fc\u30cd\u30eb\u30bd\u30fc\u30b9\u3001\u30c9\u30e9\u30a4\u30d0\u30bd\u30fc\u30b9](https://sh-dev.sharp.co.jp/android/modules/oss/index.php?/sh03c)\n* [\u53e4\u3081\u306eAndroid NDK](http://dl.google.com/android/ndk/android-ndk-r8e-linux-x86_64.tar.bz2)\n  * \u65b0\u3057\u3044\u3068\u30d3\u30eb\u30c9\u3067\u304d\u306a\u304b\u3063\u305f\u308a\u3059\u308b\n* adb\n  * android\u3078\u306e\u63a5\u7d9a\u306b\u5229\u7528\n  * Android SDK\u306b\u5165\u3063\u3066\u308b\u3082\u306e\u304b\u3001\u305d\u306e\u8fba\u306b\u8ee2\u304c\u3063\u3066\u3044\u308b\u3082\u306e\u3067\u3082\u3044\u3044\n* busybox\n  * \u3044\u308d\u3044\u308d\u4fbf\u5229\u306a\u306e\u3067\n  * SHBreak\u3092\u4f7f\u3046\u5834\u5408\u306f\u81ea\u52d5\u3067\u5165\u308b\u306e\u3067\u81ea\u5206\u3067\u5165\u308c\u306a\u304f\u3066\u3044\u3044\n* unubinize\n  * \u73fe\u884c\u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u306eunubinize\u306b\u5229\u7528\n* split_bootimg.pl\n  * \u73fe\u884c\u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u306e\u5206\u89e3\u306b\u5229\u7528\n* mkbootfs\n  * \u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u306e\u4f5c\u6210\u306b\u5229\u7528\n* ubinize\n  * \u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u306eubinize\u306b\u5229\u7528\n* flash_image\n  * \u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u306e\u66f8\u304d\u8fbc\u307f\u306b\u5229\u7528\n* Wifi\u63a5\u7d9a\n  * apt-get\u3068\u304b\u3059\u308b\u306e\u3067\u7121\u3044\u3068\u3042\u3068\u3067\u3064\u3089\u3044\n* \u6ce3\u304f\u307b\u3069\u6642\u9593\u304b\u304b\u308b\u72b6\u6cc1\u306b\u8010\u3048\u308b\u7cbe\u795e\n  * \u4ed6\u306e\u4f5c\u696d\u306e\u5408\u9593\u306b\u30b3\u30de\u30f3\u30c9\u6253\u3064\u304f\u3089\u3044\u304c\u30b9\u30c8\u30ec\u30b9\u304c\u305f\u307e\u3089\u306a\u304f\u3066\u826f\u3044\n\n## \u6ce8\u610f\u4e8b\u9805\n\n* \u3053\u306e\u6a5f\u7a2e\u3067\u306f\uff08\u3068\u3044\u3046\u304b\u4eca\u56de\u306e\u30e1\u30fc\u30ab\u30fc\u306e\u591a\u304f\u306e\u7aef\u672b\u3067\u306f\uff09**\u96fb\u6e90OFF\u72b6\u614b\u304b\u3089\u901a\u5e38\u8d77\u52d5\u4ee5\u5916\u306e\u30e2\u30fc\u30c9\u3067\u8d77\u52d5\u3059\u308b\u624b\u6bb5\u304c\u5b58\u5728\u3057\u306a\u3044**\u305f\u3081\u3001boot\u9818\u57df\u306b\u30ab\u30fc\u30cd\u30eb\u30a4\u30e1\u30fc\u30b8\u3092\u66f8\u304d\u8fbc\u3093\u3067\u8d77\u52d5\u3067\u304d\u306a\u304f\u306a\u308b\u3068\u5ec3\u68c4\u3059\u308b\u3057\u304b\u306a\u304f\u306a\u308b\u3002\u5f93\u3063\u3066\u3001\u8a66\u3059\u969b\u306f\u30ab\u30fc\u30cd\u30eb\u30a4\u30e1\u30fc\u30b8\u306f\u5fc5\u305arecovery\u9818\u57df\u306b\u66f8\u304d\u8fbc\u307f\u3001adb reboot recovery\u306a\u3069\u3067Recovery Mode\u304b\u3089\u8d77\u52d5\u3059\u308b\u3002\n\n* \u307e\u305f\u3001\u8d77\u52d5\u3067\u304d\u306a\u3044\u30a4\u30e1\u30fc\u30b8\u3092recovery\u9818\u57df\u306b\u66f8\u304d\u8fbc\u3093\u3067\u3042\u308b\u72b6\u614b\u3067Factory Reset\u3059\u308b\u3068\u518d\u8d77\u52d5\u30eb\u30fc\u30d7\u306b\u306a\u308a\u3001boot\u9818\u57df\u306b\u6551\u6e08\u53ef\u80fd\u306a\u30ab\u30fc\u30cd\u30eb\u304c\u66f8\u304d\u8fbc\u307e\u308c\u3066\u3044\u306a\u3044\u9650\u308a\u7834\u68c4\u3059\u308b\u3057\u304b\u306a\u304f\u306a\u308b\u305f\u3081\u3001\u3053\u308c\u3082\u6ce8\u610f\u3059\u308b\u3002\n\n* \u6700\u3082\u5b89\u5168\u306a\u306e\u306f\u3001boot\u9818\u57df\u306badb\u53ef\u80fd\u304b\u3064init\u306e\u9032\u884c\u3092\u30b5\u30b9\u30da\u30f3\u30c9\u3067\u304d\u308b\u30ab\u30fc\u30cd\u30eb\u304c\u66f8\u304d\u8fbc\u3093\u3067\u3042\u308b\u72b6\u614b\u3002\u3053\u306e\u72b6\u614b\u3067\u3042\u308c\u3070\u3001\u5927\u4f53\u3069\u3093\u306a\u3072\u3069\u3044\u72b6\u6cc1\u306b\u306a\u3063\u3066\u3082\u5fa9\u65e7\u53ef\u80fd\u3002\n  * \u3053\u3046\u306a\u3063\u3066\u3044\u308b\u3068\u3001\u6975\u7aef\u306a\u8a71\u3001/system\u4e0b\u3092tgz\u304b\u4f55\u304b\u306b\u3057\u3066\u3068\u3063\u3066\u3042\u308c\u3070\u3001/system\u3092erase_image\u3057\u3066\u3082\u5fa9\u65e7\u53ef\u80fd\u3002\n\n## \u4e0b\u6e96\u5099\n\n### \u672c\u4f53\u306e\u5165\u624b\n\n\u307e\u305aSH-03C\u672c\u4f53\u3092\u5165\u624b\u3059\u308b\u3002\u52d5\u304f\u3060\u3051\u3067\u3088\u3051\u308c\u3070\u3001\u4e2d\u53e4\u3067\u304a\u3088\u305d1,000\u5186\u524d\u5f8c\u3067\u624b\u306b\u5165\u308b\u3002\n\n### \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u63a5\u7d9a\n\nandroid\u306e\u8a2d\u5b9a\u753b\u9762\u304b\u3089WiFi\u63a5\u7d9a\u3092\u884c\u3044\u3001\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u51fa\u3089\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u3002\n\n### \u6a29\u9650\u6607\u683c\n\nroot\u306b\u306a\u3063\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\u3053\u306e\u7aef\u672b\u306f/dev/diag\u306e\u8106\u5f31\u6027\u306a\u3069\u3067\u6a29\u9650\u6607\u683c\u304c\u53ef\u80fd\u3002\n\u8106\u5f31\u6027\u304c\u306f\u3063\u304d\u308a\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u81ea\u5206\u3067\u30ab\u30fc\u30cd\u30eb\u30e1\u30e2\u30ea\u3092\u66f8\u304d\u63db\u3048\u3066\u3082\u3044\u3044\u3057\u3001\n\u624b\u306b\u5165\u308b\u3088\u3046\u3067\u3042\u308c\u3070\u5eb5\u6012\u9732\u6170\u6012\u3055\u3093\u306eSHBreak\u3067\u3082\u3044\u3044\u3057\u3001\u305d\u3046\u3067\u306a\u3051\u308c\u3070[fi01\u3055\u3093\u306eandroid_run_root_shell](https://github.com/fi01/android_run_root_shell)\u306a\u3093\u304b\u304c\u304a\u52e7\u3081\u3002\n\n### recovery\u306ewrite protect\u89e3\u9664\n\nrecovery\u306b\u81ea\u5206\u3067\u4f5c\u3063\u305f\u30ab\u30fc\u30cd\u30eb\u3092\u5165\u308c\u305f\u3044\u306e\u3067\u3001write protect\u3092\u89e3\u9664\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u3053\u306e\u7aef\u672b\u306f/dev/shsd\u306e\u8106\u5f31\u6027\u3084\u3001/dev/ae2\u306e\u8106\u5f31\u6027\u3092\u5229\u7528\u3057\u3066recovery\u306ewrite protect\u3092\u89e3\u9664\u3067\u304d\u308b\u3002\n\u3053\u308c\u3082\u8106\u5f31\u6027\u304c\u306f\u3063\u304d\u308a\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u81ea\u5206\u3067\u3084\u3063\u3066\u3082\u3044\u3044\u3057\u3001\n\u624b\u306b\u5165\u308b\u3088\u3046\u3067\u3042\u308c\u3070\u3001[\u305f\u3060\u3050\u3060\u3050\u3060\u3068(\u65b0)\u3055\u3093](http://ftake.gensoukyo.net/blog/2011/12/14/442)\uff08\u5143\u306eIS01\u7248\u306f[goroh_kun\u3055\u3093](https://twitter.com/goroh_kun)\u4f5c\uff09\u306e[SH-03C\u5411\u3051ae2break](https://www.dropbox.com/s/y545hubde161j27/ae2brek_for_sh03c.zip)\u304c\u697d\u3067\u3044\u3044\u3002\n\n```bash:recovery\u306ewrite_protect\u89e3\u9664\n$ adb push busybox /data/local/tmp\n$ adb push ae2break /data/local/tmp\n$ adb shell\n### \u4ee5\u4e0b\u3001android\u3067\u64cd\u4f5c\n$ su\n# chmod 755 /data/local/tmp/busybox\n# chmod 755 /data/local/tmp/ae2break\n# stop mediayamaha\n# kill -9 `/data/local/tmp/busybox pidof mediayamahaserver`\n# /data/local/tmp/ae2break recovery\n```\n\nstop mediayamaha\u3067\u7aef\u672b\u304c\u518d\u8d77\u52d5\u3059\u308b\u3053\u3068\u304c\u3042\u308b\u304c\u3001\u6c17\u306b\u305b\u305a\u4f55\u56de\u304b\u8a66\u3057\u3066\u3044\u308b\u3068\u305d\u306e\u3046\u3061\u6210\u529f\u3059\u308b\u3002\n\u3068\u308a\u3042\u3048\u305a\u3001\u3053\u3053\u307e\u3067\u3067recovery\u9818\u57df\u306b\u30a4\u30e1\u30fc\u30b8\u3092\u66f8\u304d\u8fbc\u3081\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002\n\u3053\u306e\u3042\u3068\u306f\u66f8\u304d\u8fbc\u3080\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n## \u30ab\u30fc\u30cd\u30eb\u30bd\u30fc\u30b9\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n[\u3053\u3053](https://sh-dev.sharp.co.jp/android/modules/oss/index.php?/sh03c)\u304b\u3089\u4ee5\u4e0b\u306e\uff12\u3064\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u5c55\u958b\u3059\u308b\u3002\n\n* kernel.tar.gz\n* wifi_kernel_driver_build212.tar.gz\n\n```bash:\u5c55\u958b\u3068\u8a2d\u7f6e\n$ tar xzf kernel.tar.gz\n$ tar xzf wifi_kernel_driver_build212.tar.gz\n$ mkdir -p external/synergy/modules/wifi/kernel_driver\n$ mv build212 external/synergy/modules/wifi/kernel_driver/\n```\n\n## \u30ab\u30fc\u30cd\u30eb\u306e\u30d3\u30eb\u30c9\n\n### \u52d5\u4f5c\u4e2d\u306e\u672c\u4f53\u304b\u3089\u73fe\u884c\u30ab\u30fc\u30cd\u30eb\u306econfig\u3092\u53d6\u5f97\n\n\u52d5\u4f5c\u4e2d\u306e\u7aef\u672b\u306e/proc\u304b\u3089\u53d6\u5f97\u3057\u305fconfig.gz\u3092\u5c55\u958b\u3057\u3001config\u3092.config\u306b\u30ea\u30cd\u30fc\u30e0\u3057\u3066\u30ab\u30fc\u30cd\u30eb\u30bd\u30fc\u30b9\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u914d\u7f6e\u3059\u308b\u3002\n\n```bash:\u73fe\u884cconfig\u306e\u53d6\u5f97\n$ adb pull /proc/config.gz\n$ gzip -d config.gz\n$ mv config kernel/.config\n```\n\n### \u30ab\u30fc\u30cd\u30eb\u306e\u8a2d\u5b9a\n\n\u3042\u3068\u3065\u3051\u3067OVS\u3092\u52d5\u4f5c\u3055\u305b\u308b\u305f\u3081\u306b\u306f\u3001linux bridgeing\u3092Module Install\u306b\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308b\u305f\u3081\u3001\u4ee5\u4e0b\u3092.config\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n\n```properties:kernel/.config\nCONFIG_BRIDGE=m\n```\n\nmenuconfig\u3067\u8a2d\u5b9a\u3059\u308b\u3068\u697d\u3067\u3044\u3044\u3002\u3064\u3044\u3067\u306b\u3001net\u3067\u3042\u308c\u3070veth\u3084gre\u3001filesystem\u3067\u3042\u308c\u3070nfs\u3084cifs\u306a\u3093\u304b\u3092\u6709\u52b9\u306b\u3057\u3066\u304a\u304f\u3068\u5f8c\u3005\u4fbf\u5229\u306a\u3053\u3068\u304c\u3042\u308b\u304b\u3082\u3002\n\n### \u30bd\u30fc\u30b9\u4fee\u6b63\n\n\u51fa\u8377\u3055\u308c\u3066\u3044\u308b\u88fd\u54c1\u306e\u30ab\u30fc\u30cd\u30eb\u306f\u3053\u306e\u30bd\u30fc\u30b9\u3067\u30d3\u30eb\u30c9\u3055\u308c\u3066\u3044\u308b\u306f\u305a\u3060\u304c\u3001\u4e00\u90e8\u30d3\u30eb\u30c9\u3067\u304d\u306a\u3044\uff08\u5ba3\u8a00\u6642\u3068\u5229\u7528\u6642\u306e\u5909\u6570\u540d\u304c\u7570\u306a\u308b\u306a\u3069\u3001\u3069\u3046\u8003\u3048\u3066\u3082\u304a\u304b\u3057\u3044\uff09\u3082\u306e\u304c\u3042\u308b\u3002\n\n\u4ee5\u4e0b\u306e\uff12\u30bd\u30fc\u30b9\u3092\u4fee\u6b63\u3057\u3066\u304a\u304f\u3002\n\n```c:kernel/arch/arm/mach-msm/sh_sleepcheck.c\n//#include <smd_private.h>\n// \u4ee5\u4e0b\u306b\u4fee\u6b63\n#include \"smd_private.h\"\n```\n\n```c:kernel/kernel/cpuset.c\n/* Called by cgroups to determine if a cpuset is usable; cgroup_mutex held */\nstatic int cpuset_can_attach(struct cgroup_subsys *ss, struct cgroup *cont,\n                 struct task_struct *tsk, bool threadgroup)\n{\n    int ret;\n    struct cpuset *cs = cgroup_cs(cont);\n\n    // \"tsk\"\u3068\"task\"\u3067\u5909\u6570\u540d\u304c\u7570\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u4fee\u6b63\n    // if ((current != task) && (!capable(CAP_SYS_ADMIN))) {\n    if ((current != tsk) && (!capable(CAP_SYS_ADMIN))) {\n        const struct cred *cred = current_cred(), *tcred;\n\n        if (cred->euid != tcred->uid && cred->euid != tcred->suid)\n            return -EPERM;\n    }\n```\n\n### \u30d3\u30eb\u30c9\n\n\u4e0a\u8a18\u3092\u76f4\u3057\u305f\u3089make\u3059\u308b\u3002\n\n```bash:make\n$ cd kernel\n$ export CROSS_COMPILE=arm-linux-androideabi-\n$ export ARCH=arm\n$ export PATH=$PATH:/opt/android-ndk-r8e/toolchains/arm-linux-androideabi-4.4.3/prebuilt/linux-x86_64/bin\n$ make\n  CHK     include/linux/version.h\n\u2026\n  LD [M]  net/bridge/bridge.ko\n  CC      net/llc/llc.mod.o\n  LD [M]  net/llc/llc.ko\n```\n\n\u30d3\u30eb\u30c9\u306f\u5c11\u3057\u6642\u9593\u304c\u304b\u304b\u308b\u304c\u3001\u653e\u3063\u3066\u304a\u3051\u3070\u305d\u306e\u3046\u3061\u7d42\u308f\u308b\u3002kernel/arch/arm/boot/zImage\u304c\u3067\u304d\u308b\u3002\n\n### \u30a4\u30e1\u30fc\u30b8\u306e\u4f5c\u6210\n\n\u51fa\u6765\u4e0a\u304c\u3063\u305fzImage\u3068\u3001\u73fe\u884c\u306eboot\u9818\u57df\u306einitrd\u3092\u4f7f\u3063\u3066\u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u308b\u3002\n\n\u307e\u305a\u73fe\u884c\u306einitrd\u304c\u307b\u3057\u3044\u306e\u3067\u3001\u53d6\u5f97\u3059\u308b\u3002\n\n```bash:boot\u9818\u57df\u306e\u30c0\u30f3\u30d7\n$ adb shell\n### \u4ee5\u4e0b\u3001android\u3067\u64cd\u4f5c\n$ su\n# dd if=/dev/mtd/mtd0 of=/data/local/tmp/boot_org.img.ubi\n```\n\n\u30a4\u30e1\u30fc\u30b8\u306fubinize\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001unubinize\u3059\u308b\u3002\n\n```bash:unubinize\n$ adb pull /data/local/tmp/boot_org.img.ubi\n$ unubinize.pl boot_org.img.ubi\n```\n\n\u5b9f\u884c\u3059\u308b\u3068boot_org.img.ubi.out\u304c\u3067\u304d\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u30ab\u30fc\u30cd\u30eb\u3068initrd\u306b\u5206\u89e3\u3059\u308b\u3002\n\n```bash:\u73fe\u884c\u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u306e\u5206\u89e3\n$ split_bootimg.py boot_org.img.ubi.out\nPage size:      2048 (0x00000800)\nKernel addr:    268468224 (0x10008000)\nKernel size:    6660496 (0x0065a190)\nRamdisk addr:   285212672 (0x11000000)\nRamdisk size:   3177984 (0x00307e00)\nSecond size:    0 (0x00000000)\nSecond addr:    284164096 (0x10f00000)\nBoard name:     \nCommand line: console=ttyDCC0 androidboot.hardware=qcom androidboot.console=tty0\nBase Address: 0x10000000\nWriting boot_org.img.ubi.out-kernel ... complete.\nWriting boot_org.img.ubi.out-ramdisk.cpio ... complete.\n```\n\n\u5206\u89e3\u3057\u305f\u3089\u3001\u65b0\u3057\u3044zImage\u3068\u5206\u89e3\u3057\u3066\u51fa\u6765\u305finitrd\u3067\u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3059\u308b\n\n```bash:\u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u306e\u4f5c\u6210\n$ mkbootimg --kernel kernel/arch/arm/boot/zImage --ramdisk boot_org.img.ubi.out-ramdisk.cpio --cmdline 'console=ttyDCC0 androidboot.hardware=qcom androidboot.console=tty0' --base 0x10000000 -o boot_new.img\n```\n\n\u3067\u304d\u3042\u304c\u3063\u305f\u30a4\u30e1\u30fc\u30b8\u306fubinize\u3057\u3066\u521d\u3081\u3066\u5229\u7528\u53ef\u80fd\u306b\u306a\u308b\u305f\u3081\u3001ubinize\u3059\u308b\u3002\nubi.cfg\u3092\u307e\u305a\u7de8\u96c6\u3059\u308b\u3002\n\n```ini:ubi.cfg\n[boot]\nmode=ubi\nimage=boot_new.img\nvol_id=0\nvol_size=200MiB\nvol_type=dynamic\nvol_name=boot\nvol_flags=autoresize\n```\n\n\u7de8\u96c6\u304c\u7d42\u308f\u3063\u305f\u3089\u3001ubinize\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n```bash:ubinize\n$ ubinize -o \"boot_new.img.ubi\" -p 128KiB -m 2048 -O 256 \"ubi.cfg\"\n```\n\n\u3053\u3053\u307e\u3067\u3067\u3001\u7aef\u672b\u306b\u66f8\u304d\u8fbc\u3080\u7528\u306e\u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u3067\u3042\u308bboot_new.img.ubi\u304c\u3067\u304d\u308b\u3002\n\n### \u7aef\u672b\u306e\u30ab\u30fc\u30cd\u30eb\u3092\u66f4\u65b0\n\n\u4f5c\u3063\u305f\u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u3092recovery\u9818\u57df\u306b\u66f8\u304d\u8fbc\u3080\u3002\n\u7aef\u672b\u306f\u524d\u306e\u624b\u9806\u3067\u884c\u3063\u305f\u3068\u304a\u308a\u3001recovery\u306ewrite protect\u304c\u89e3\u9664\u3055\u308c\u3066\u3044\u308b\u3068\u3059\u308b\u3002\n\n```bash:\u7aef\u672b\u306e\u30ab\u30fc\u30cd\u30eb\u3092\u66f4\u65b0\n$ adb push flash_image /data/local/tmp\n$ adb push boot_new.img.ubi /data/local/tmp\n$ adb shell\n### \u4ee5\u4e0b\u3001android\u3067\u64cd\u4f5c\n$ su\n### recovery\u306ewrite protect\u3092\u89e3\u9664\u3057\u3066\u306a\u3051\u308c\u3070\u3001\u3053\u3053\u3067\u89e3\u9664\n# [ae2break\u306a\u3069\u3067\u9069\u5f53\u306b]\n### recovery\u9818\u57df\u306b\u66f8\u304d\u8fbc\u307f\n# cd /data/local/tmp\n# chmod 755 ./flash_image\n# ./flash_image recovery ./boot_new.img.ubi\n### \u7d42\u308f\u3063\u305f\u3089\u518d\u8d77\u52d5\n# reboot recovery\n```\n\n\u3053\u308c\u3067\u518d\u8d77\u52d5\u3057\u305f\u5f8c\u306f\u3001\u3055\u3063\u304d\u8a2d\u5b9a\u3092\u3044\u3058\u3063\u305f\u3068\u304a\u308a\u306e\u30ab\u30fc\u30cd\u30eb\u3067\u8d77\u52d5\u3057\u3066\u3044\u308b\u306f\u305a\u3002uname\u3067\u898b\u3066\u307f\u308b\u3002\n\n```bash:\u30ab\u30fc\u30cd\u30eb\u306e\u78ba\u8a8d\n$ adb shell\n$ uname -a\nLinux localhost 2.6.32.9-perf #7 PREEMPT Fri Sep 11 23:20:35 JST 2015 armv7l GNU/Linux\n```\n\n## arm\u7248ubuntu\u306e\u6e96\u5099\n\n\u3053\u306e\u307e\u307e\u3060\u3068ovs\u3084ruby\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u3064\u3089\u3044\u306e\u3067\u3001\u30ab\u30fc\u30cd\u30eb\u3060\u3051android\u306e\u307e\u307e\u3067\u3001\u305d\u306e\u4e0a\u3067ubuntu\u3092\u4f7f\u3046\u3088\u3046\u306b\u3059\u308b\u3002\nsyscall\u95a2\u4fc2\u3067\u52d5\u304b\u306a\u3044\u3088\u3046\u306a\u5834\u5408\u3001\u30ab\u30fc\u30cd\u30eb\u30bd\u30fc\u30b9\u3068\u30c4\u30fc\u30eb\u306b\u3064\u3044\u3066\u4fee\u6b63\u3057\u3066\u81ea\u5206\u3067\u30d3\u30eb\u30c9\u3059\u308b\uff08iproute2\u306esetns\u306a\u3069\u304c\u3044\u3044\u4f8b\uff09\u3002\n\n[\u3053\u306e\u3042\u305f\u308a](http://cdimage.ubuntu.com/releases/12.04.5/release/ubuntu-12.04-preinstalled-desktop-armhf+ac100.tar.gz)\u306e\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3001\u5c55\u958b\u3057\u3066SDCard\u306b\u5165\u308c\u3066\u304a\u304f\u3002\n\u6050\u3089\u304f\u30a4\u30e1\u30fc\u30b8\u30b5\u30a4\u30ba\u304c\u8db3\u308a\u306a\u304f\u306a\u308b\u306e\u3067\u3001\u30a4\u30e1\u30fc\u30b8\u3092\u5927\u304d\u304f\u4f5c\u308a\u306a\u304a\u3057\u3066\u4e2d\u8eab\u3092\u30b3\u30d4\u30fc\u3057\u3066\u304a\u3044\u305f\u307b\u3046\u304c\u7121\u96e3\u3002\n\n### chroot\n\narm\u7248ubuntu\u306e\u30a4\u30e1\u30fc\u30b8\u3092SDCard\u76f4\u4e0b\u306bubuntu.img\uff08ext2\uff09\u3068\u3057\u3066\u5165\u308c\u305f\u3068\u3057\u3066\u3001\u3053\u308c\u3092rootfs\u306b\u3059\u308b\u3002\n\n```bash:chroot\n$ adb shell\n$ mkdir -p /data/local/tmp/ubuntu\n### \u4ee5\u4e0b\u3001android\u3067\u64cd\u4f5c\n$ su\n# /data/local/tmp/busybox losetup /dev/block/loop0 /mnt/sdcard/ubuntu.img\n# /data/local/tmp/busybox mount -t ext2 /dev/block/loop0 /data/local/tmp/ubuntu\n# /data/local/tmp/busybox mount -o bind /dev /data/local/tmp/ubuntu/dev\n# /data/local/tmp/busybox mount -o bind /dev/pts /data/local/tmp/ubuntu/dev/pts\n# /data/local/tmp/busybox mount -t sysfs /sys /data/local/tmp/ubuntu/sys\n# /data/local/tmp/busybox mount -t proc /proc /data/local/tmp/ubuntu/proc\n# /data/local/tmp/busybox mount\n\u2026\n/dev/block/loop0 on /data/local/tmp/ubuntu type ext2 (rw,relatime,errors=continue)\ntmpfs on /data/local/tmp/ubuntu/dev type tmpfs (rw,relatime,mode=755)\ndevpts on /data/local/tmp/ubuntu/dev/pts type devpts (rw,relatime,mode=600,ptmxmode=000)\n/sys on /data/local/tmp/ubuntu/sys type sysfs (rw,relatime)\n/proc on /data/local/tmp/ubuntu/proc type proc (rw,relatime)\n# export PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin\n# export TERM=xterm\n# export HOME=/root\n# chroot /data/local/tmp/ubuntu /bin/bash\n### \u4ee5\u4e0b\u3001ubuntu\nroot@localhost:/# cd\nroot@localhost:~# \n```\n\nubuntu\u306b\u5165\u308c\u66ff\u308f\u3063\u305f\u3089\u3001\u4e00\u56de\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u3066\u304a\u304f\u3002\n\n```bash:\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\nroot@localhost:~# apt-get update\n\u2026\nFetched 3588 kB in 29s (123 kB/s)                                              \nReading package lists... Done\nroot@localhost:~#\n```\n\n### ovs\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u3053\u3053\u307e\u3067\u304f\u308b\u3068\u5927\u62b5\u306e\u3082\u306e\u304c\u975e\u5e38\u306b\u9045\u3044\u306a\u304c\u3089\u3082\u52d5\u4f5c\u3059\u308b\u306e\u3067\u3001\u4f8b\u3048\u3070apt\u3067\u958b\u767a\u30c4\u30fc\u30eb\u985e\u3092\u63c3\u3048\u308b\u306e\u306f\u7c21\u5358\u3002\n\novs\u306f\u30bd\u30fc\u30b9\u304b\u3089\u30d3\u30eb\u30c9\u3057\u3066\u5229\u7528\u3057\u3066\u307f\u308b\u3002\n\u3053\u306e\u969b\u3001\u73fe\u884c\u306e\u30ab\u30fc\u30cd\u30eb\u306e\u3042\u308c\u3053\u308c\u304c\u5fc5\u8981\u306b\u306a\u308b\u306e\u3067\u3001/lib/modules/\\`uname -r\\`\u306b\u3042\u3089\u304b\u3058\u3081\u7f6e\u3044\u3066\u304a\u304f\uff08version.h\u304c\u5fc5\u8981\u306a\u306e\u3067\u3001\u4e00\u5ea6\u30d3\u30eb\u30c9\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u3067\u3042\u308b\u3053\u3068\uff09\u3002\n\n```bash:\u73fe\u884c\u30ab\u30fc\u30cd\u30eb\nroot@localhost:~# uname -r\n2.6.32.9-perf\nroot@localhost:~# ls -la /lib/modules/`uname -r`\ntotal 85740\ndrwxrwxrwx  4 root root     4096 Sep 11 23:59 .\ndrwxr-xr-x  4 root root     4096 Sep 11 23:42 ..\ndrwxr-xr-x 25 1000 1000     4096 Sep 11 23:59 build\ndrwxrwxrwx  2 root root     4096 Sep 11 23:59 extra\n-rw-rw-rw-  1 root root 87623903 Sep 11 23:59 kernel.tgz\n-rw-rw-rw-  1 root root      200 Sep 11 23:59 modules.alias\n-rw-rw-rw-  1 root root      159 Sep 11 23:59 modules.alias.bin\n-rw-rw-rw-  1 root root       69 Sep 11 23:59 modules.ccwmap\n-rw-rw-rw-  1 root root      212 Sep 11 23:59 modules.dep\n-rw-rw-rw-  1 root root      466 Sep 11 23:59 modules.dep.bin\n-rw-rw-rw-  1 root root       52 Sep 11 23:59 modules.devname\n-rw-rw-rw-  1 root root       73 Sep 11 23:59 modules.ieee1394map\n-rw-rw-rw-  1 root root      141 Sep 11 23:59 modules.inputmap\n-rw-rw-rw-  1 root root       81 Sep 11 23:59 modules.isapnpmap\n-rw-rw-rw-  1 root root       74 Sep 11 23:59 modules.ofmap\n-rw-rw-rw-  1 root root       99 Sep 11 23:59 modules.pcimap\n-rw-rw-rw-  1 root root       43 Sep 11 23:59 modules.seriomap\n-rw-rw-rw-  1 root root      131 Sep 11 23:59 modules.softdep\n-rw-rw-rw-  1 root root     2936 Sep 11 23:59 modules.symbols\n-rw-rw-rw-  1 root root     3503 Sep 11 23:59 modules.symbols.bin\n-rw-rw-rw-  1 root root      189 Sep 11 23:59 modules.usbmap\nroot@localhost:~# \n```\n\n\u305d\u3053\u307e\u3067\u304c\u5b8c\u4e86\u3057\u3066\u3044\u308b\u524d\u63d0\u3067\u3001ovs\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\u30b9\u30de\u30fc\u30c8\u30d5\u30a9\u30f3\u306e\u65e5\u6642\u3092\u76f4\u3057\u3066\u304a\u304b\u306a\u3044\u3068configure\u304c\u7d42\u308f\u3089\u306a\u304f\u306a\u308b\u306e\u3067\u3001\u76f4\u3057\u3066\u304a\u304f\u3053\u3068\u3002\n\n```bash:\u6642\u523b\u4fee\u6b63\nroot@localhost:~# date -s \"2015/09/12 00:00:00\"\nSat Sep 12 00:00:00 UTC 2015\n```\n\n```bash:ovs\u30d3\u30eb\u30c9\u6e96\u5099\nroot@localhost:~# apt-get install -y git automake autoconf gcc uml-utilities libtool build-essential git pkg-config\nroot@localhost:~# wget http://openvswitch.org/releases/openvswitch-2.3.1.tar.gz\nroot@localhost:~# tar zxf openvswitch-2.3.1.tar.gz\nroot@localhost:~# cd openvswitch-2.3.1\nroot@localhost:~/openvswitch-2.3.1# \n```\n\u4ee5\u4e0b\u306e\u30bd\u30fc\u30b9\u3067NUMA_NODE_NO\u304c\u672a\u5b9a\u7fa9\u306a\u306e\u3067\u3001-1\u306b\u3057\u3066\u304a\u304f\u3002\n\n```c:datapath/flow.c\n    //if (likely(flow->stats_last_writer != NUMA_NO_NODE)\n    if (likely(flow->stats_last_writer != -1)\n        && likely(!rcu_dereference(flow->stats[node]))) {\n```\n\n```c:datapath/flow_table.c\n    //flow->stats_last_writer = NUMA_NO_NODE;\n    flow->stats_last_writer = -1;\n```\n\n\u3053\u308c\u304c\u7d42\u308f\u3063\u305f\u3089\u30d3\u30eb\u30c9\u3002\n\n```bash:ovs\u306e\u30d3\u30eb\u30c9\nroot@localhost:~/openvswitch-2.3.1# ./boot.sh\nlibtoolize: putting auxiliary files in AC_CONFIG_AUX_DIR, `build-aux'.\nlibtoolize: copying file `build-aux/config.guess'\n\u2026\nlibtoolize: copying file `m4/lt~obsolete.m4'\nroot@localhost:~/openvswitch-2.3.1# ./configure --with-linux=/lib/modules/`uname -r`/build\nchecking for a BSD-compatible install... /usr/bin/install -c\nchecking whether build environment is sane... yes\n\u2026\nconfig.status: executing include/openflow/openflow.h.stamp commands\nconfig.status: executing utilities/bugtool/dummy commands\nroot@localhost:~/openvswitch-2.3.1# make\nmake  all-recursive\nmake[1]: Entering directory `/root/openvswitch-2.3.1'\n\u2026\ntouch include/openflow/openflow.hstamp\nmake[2]: Leaving directory `/root/openvswitch-2.3.1'\nmake[1]: Leaving directory `/root/openvswitch-2.3.1'\nroot@localhost:~/openvswitch-2.3.1# \n```\n\n\u7d50\u69cb\u6642\u9593\u304c\u304b\u304b\u308b\u304c\u3001\u8010\u3048\u308b\u3068\u3044\u3046\u304b\u3001\u653e\u7f6e\u3059\u308b\u3002\n\u5b8c\u4e86\u3057\u305f\u3089\u3001ovs\u306e\u8d77\u52d5\u3092\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3002\n\n```bash:ovs\u306e\u8d77\u52d5\u78ba\u8a8d\nroot@localhost:~/openvswitch-2.3.1# insmod datapath/linux/openvswitch.ko \nroot@localhost:~/openvswitch-2.3.1# lsmod\nModule                  Size  Used by\nopenvswitch            78130  0 \nroot@localhost:~/openvswitch-2.3.1# \nroot@localhost:~/openvswitch-2.3.1# mkdir -p /usr/local/etc/openvswitch\nroot@localhost:~/openvswitch-2.3.1# ./ovsdb/ovsdb-tool create /usr/local/etc/openvswitch/conf.db vswitchd/vswitch.ovsschema\nroot@localhost:~/openvswitch-2.3.1# ./ovsdb/ovsdb-server -v --remote=punix:/usr/local/var/run/openvswitch/db.sock \\\n  --remote=db:Open_vSwitch,Open_vSwitch,manager_options \\\n  --private-key=db:Open_vSwitch,SSL,private_key \\\n  --certificate=db:Open_vSwitch,SSL,certificate \\\n  --pidfile --detach --log-file\n2015-09-12T00:37:05Z|00001|vlog|INFO|opened log file /usr/local/var/log/openvswitch/ovsdb-server.log\n2015-09-12T00:37:06Z|00002|daemon_unix|DBG|/usr/local/var/run/openvswitch/ovsdb-server.pid: deleted stale pidfile\n2015-09-12T00:37:06Z|00003|hmap|DBG|lib/shash.c:112: 6 nodes in bucket (16 nodes, 8 buckets)\nroot@localhost:~/openvswitch-2.3.1# ./utilities/ovs-vsctl --no-wait init\nroot@localhost:~/openvswitch-2.3.1# ./vswitchd/ovs-vswitchd --pidfile --detach\n2015-09-12T00:38:32Z|00001|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock: connecting...\n2015-09-12T00:38:32Z|00002|reconnect|INFO|unix:/usr/local/var/run/openvswitch/db.sock: connected\nroot@localhost:~/openvswitch-2.3.1# ./utilities/ovs-vsctl add-br br0\nroot@localhost:~/openvswitch-2.3.1# ./utilities/ovs-vsctl show      \nfd1f82c9-8f57-440a-ba5f-a778833896de\n    Bridge \"br0\"\n        Port \"br0\"\n            Interface \"br0\"\n                type: internal\nroot@localhost:~/openvswitch-2.3.1# ./utilities/ovs-ofctl dump-flows br0\nNXST_FLOW reply (xid=0x4):\n cookie=0x0, duration=13.746s, table=0, n_packets=0, n_bytes=0, idle_age=13, priority=0 actions=NORMAL\n```\n\novs\u306e\u52d5\u4f5c\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3002\u3053\u306e\u6642\u70b9\u3067\u3001\u4ed6\u306e\u7aef\u672b\u3092OpenFlow Controller\u306b\u3057\u3066\u3053\u306e\u7aef\u672b\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u64cd\u4f5c\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u3002\n\u4eca\u56de\u306f\u3001\u5c06\u6765\u7684\u306b\u5206\u6563Edge Overlay\u3082\u898b\u636e\u3048\u3066\u3001Controller\u3082\u3053\u306e\u7aef\u672b\u306b\u76f4\u63a5\u3044\u308c\u3066\u307f\u308b\u3002\n\n### ruby\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nruby\u306f\u666e\u901a\u306b\u30bd\u30fc\u30b9\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3082\u3044\u3044\u3057\u3001rbenv\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3082\u3044\u3044\u3002\n\u4eca\u56de\u306frbenv\u3092\u4f7f\u3046\u3053\u3068\u306b\u3057\u305f\u3002\n\n```bash:rbenv\u3067ruby\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nroot@localhost:~/openvswitch-2.3.1# cd\nroot@localhost:~# git clone https://github.com/sstephenson/rbenv.git ~/.rbenv\nroot@localhost:~# echo 'export PATH=\"$HOME/.rbenv/bin:$PATH\"' >> ~/.bash_profile\nroot@localhost:~# echo 'eval \"$(rbenv init -)\"' >> ~/.bash_profile\nroot@localhost:~# . ~/.bash_profile\nroot@localhost:~# rbenv --version\nrbenv 0.4.0-153-g3b6faa8\nroot@localhost:~# git clone https://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build\nroot@localhost:~# rbenv install --list\nAvailable versions:\n\u2026\n  2.2.3\n\u2026\nroot@localhost:~# rbenv install -v 2.2.3     \nDownloading ruby-2.2.3.tar.gz...\n/tmp/ruby-build.20150912004449.10219 ~\nHTTP/1.1 200 OK\n\u2026\nInstalled ruby-2.2.3 to /root/.rbenv/versions/2.2.3\n\n/tmp/ruby-build.20150912004449.10219 ~\n~\nroot@localhost:~# \n```\n\n\u3053\u308c\u3082\u5272\u3068\u6642\u9593\u304c\u304b\u304b\u308b\u304c\u3001\u653e\u7f6e\u3057\u3066\u3044\u308b\u3068\u305d\u306e\u3046\u3061\u7d42\u308f\u308b\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u7d42\u308f\u3063\u305f\u3089\u3001\u52d5\u4f5c\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n```bash:ruby\u306e\u52d5\u4f5c\u78ba\u8a8d\nroot@localhost:~# rbenv rehash\nroot@localhost:~# rbenv global 2.2.3\nroot@localhost:~# ruby -v\nruby 2.2.3p173 (2015-08-18 revision 51636) [armv7l-linux-eabihf]\nroot@localhost:~# \n```\n\n\u52d5\u4f5c\u3059\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3002\nbundler\u304c\u8981\u308b\u306e\u3067\u3001\u5165\u308c\u3066\u304a\u304f\u3002\n\n```bash:bundler\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nroot@localhost:~/# gem install bundler\nFetching: bundler-1.10.6.gem (100%)\n/root/.rbenv/rbenv.d/exec/gem-rehash/rubygems_plugin.rb:6: warning: Insecure world writable dir /root/.rbenv/versions in PATH, mode 040777\nSuccessfully installed bundler-1.10.6\nParsing documentation for bundler-1.10.6\nInstalling ri documentation for bundler-1.10.6\nDone installing documentation for bundler after 70 seconds\n1 gem installed\nroot@localhost:~/# \n```\n\n### trema\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nalignment\u306a\u3069\u306e\u95a2\u4fc2\u3067arm\u3078\u306e\u79fb\u690d\u304c\u3068\u3066\u3082\u3064\u3089\u3044\u305f\u3081\u3001\u6700\u65b0\u306epure ruby\u7248\u3092\u5229\u7528\u3059\u308b\u3002\n\u51e6\u7406\u901f\u5ea6\u304c1/5\u7a0b\u5ea6\u306b\u843d\u3061\u308b\u3068\u8a00\u308f\u308c\u3066\u3044\u308b\u304c\u3001\u79fb\u690d\u6027\u3084\u30bd\u30fc\u30b9\u306e\u8ffd\u3044\u3084\u3059\u3055\u3001debug\u306e\u3057\u3084\u3059\u3055\u306f\u3053\u3061\u3089\u306e\u307b\u3046\u304c\u9065\u304b\u306b\u9ad8\u304f\u3001\u4eca\u5f8carm\u30b5\u30fc\u30d0\u306a\u3069\u306bSDN\u304c\u666e\u53ca\u3057\u3066\u3044\u304f\uff08\u3068\u52dd\u624b\u306b\u601d\u3063\u3066\u3044\u308b\uff09\u4e8b\u3092\u8003\u3048\u308b\u3068\u3001\u3068\u3066\u3082\u52a9\u304b\u308b\u3002\n\n\u203bruby+c\u7248\u306f\u3001\u5c11\u3057\u6df1\u304f\u5165\u308b\u3068C\u306e\u30bd\u30fc\u30b9\u306b\u5f53\u305f\u308b\u305f\u3081\u3001debug\u304c\u624b\u9593\u3060\u3063\u305f\u3002\n\n```bash:trema\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nroot@localhost:~# git clone https://github.com/trema/trema.git\nroot@localhost:~# cd trema\nroot@localhost:~/trema# git checkout -b 0.6.0 refs/tags/0.6.0\nSwitched to a new branch '0.6.0'\nroot@localhost:~/trema# rm .ruby-version \nroot@localhost:~/trema# bundle install --path=vendor/bundle\n/root/.rbenv/versions/2.2.3/lib/ruby/gems/2.2.0/gems/bundler-1.10.6/lib/bundler/vendor/thor/lib/thor/shell/basic.rb:356: warning: Insecure world writable dir /root/.rbenv/versions in PATH, mode 040777\nDon't run Bundler as root. Bundler can ask for sudo if it is needed, and\ninstalling your bundle as root will break this application for all non-root\nusers on this machine.\nFetching gem metadata from https://rubygems.org/.........\nFetching version metadata from https://rubygems.org/..\nResolving dependencies.........................................................................................\nUsing rake 10.4.2\nInstalling abstract_type 0.0.7\nInstalling ice_nine 0.11.1\n\u2026\nroot@localhost:~/trema# \n```\n\n### trema\u306e\u52d5\u4f5c\u78ba\u8a8d\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u7d42\u308f\u3063\u305f\u3089\u3001\u8d77\u52d5\u3092\u78ba\u8a8d\u3059\u308b\u3002\u3068\u308a\u3042\u3048\u305aOpenFlow1.0\u306b\u3059\u308b\u3002\n\n```bash:trema\u306b\u7e4b\u3050bridge\u306e\u8d77\u52d5\u3068\u3001HelloTrema\u306e\u78ba\u8a8d\nroot@localhost:~/trema# /root/openvswitch-2.3.1/utilities/ovs-vsctl add-br br1 -- set bridge br1  protocols=OpenFlow10 -- set bridge br1 other_config:disable-in-band=true -- set bridge br1 other-config:datapath-id=0000000000000001 -- set bridge br1 other-config:hwaddr=00:00:00:00:00:01 -- set-fail-mode br1 standalone -- set-controller br1 tcp:127.0.0.1:6653\nroot@localhost:~/trema# /root/openvswitch-2.3.1/utilities/ovs-vsctl show\nfd1f82c9-8f57-440a-ba5f-a778833896de\n    Bridge \"br0\"\n        Port \"br0\"\n            Interface \"br0\"\n                type: internal\n    Bridge \"br1\"\n        Controller \"tcp:127.0.0.1:6653\"\n        fail_mode: standalone\nroot@localhost:~/trema# git clone https://github.com/trema/hello_trema.git\nroot@localhost:~/trema# bundle exec bin/trema run hello_trema/lib/hello_trema.rb\n/root/.rbenv/versions/2.2.3/lib/ruby/gems/2.2.0/gems/bundler-1.10.6/lib/bundler/shared_helpers.rb:78: warning: Insecure world writable dir /root/.rbenv/versions in PATH, mode 040777\n/root/trema/trema.gemspec:20: warning: Insecure world writable dir /root/trema/vendor/bundle/ruby/2.2.0/bin in PATH, mode 040777\nTrema started.\nHello 0x1!\n```\n\nHelloTrema\u304c\u8d77\u52d5\u3057\u3001switch ready\u304c\u52d5\u4f5c\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u78ba\u8a8d\u3067\u304d\u305f\u3002\n\n### \u5ff5\u306e\u70ba\u3001flowmod\u3068\u304b\u78ba\u8a8d\n\n\u3068\u308a\u3042\u3048\u305aveth\u3092ovs\u306b\u633f\u3057\u3066\u307f\u3066\u3001\u9069\u5f53\u306bpacket_in\u3084flow_mod\u306a\u3069\u3092\u52d5\u304b\u3057\u3066\u307f\u308b\u3002\n\n```bash:\nroot@localhost:~/trema# ip link add v11 type veth peer name v12\nroot@localhost:~/trema# ip link set v11 up\nroot@localhost:~/trema# ip link set v12 up\nroot@localhost:~/trema# /root/openvswitch-2.3.1/utilities/ovs-vsctl add-port br1 v11\nroot@localhost:~/trema# ip addr add 10.0.0.1 dev v12\nroot@localhost:~/trema# route add -net 10.0.0.0/8 dev v12\nroot@localhost:~/trema# /root/openvswitch-2.3.1/utilities/ovs-vsctl show    \nfd1f82c9-8f57-440a-ba5f-a778833896de\n    Bridge \"br0\"\n        Port \"br0\"\n            Interface \"br0\"\n                type: internal\n    Bridge \"br1\"\n        Controller \"tcp:127.0.0.1:6653\"\n        fail_mode: standalone\n        Port \"br1\"\n            Interface \"br1\"\n                type: internal\n        Port \"v11\"\n            Interface \"v11\"\nroot@localhost:~/trema# route -n      \nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n192.168.2.0     0.0.0.0         255.255.255.0   U     0      0        0 wlan0\n169.254.0.0     0.0.0.0         255.255.0.0     U     0      0        0 wlan0\n10.0.0.0        0.0.0.0         255.0.0.0       U     0      0        0 v12\n0.0.0.0         192.168.2.1     0.0.0.0         UG    0      0        0 wlan0\nroot@localhost:~/trema# \n```\n\n\u307e\u305aveth\u306e\u7247\u65b9\u3067\u3042\u308bv11\u3092br1\u306b\u8a2d\u5b9a\u3057\u3066route\u3092\u8a2d\u5b9a\u3057\u305f\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u610f\u5473\u306e\u306a\u3044Controller\u3092trema\u3067\u52d5\u304b\u3057\u3066\u307f\u308b\u3002\u6210\u529f\u3059\u308c\u3070FLOOD\u306eflow\u304c\u5165\u308b\u306f\u305a\u3002\uff08tremaday\u306e\u3068\u304d\u306f\u52d5\u304b\u306a\u304b\u3063\u305f\uff09\n\n```rb:\u30b5\u30f3\u30d7\u30eb\nclass TestController < Trema::Controller\n  def switch_ready(datapath_id)\n    logger.info \"switch_ready: #{datapath_id.to_hex}\"\n  end\n\n  def packet_in(datapath_id, message)\n    logger.info \"packet_in: #{datapath_id.to_hex}\"\n    send_flow_mod_add(\n      datapath_id,\n      {\n        match: Match.new(in_port: 1, dl_type: 0x0800),\n        actions: SendOutPort.new(:flood)\n      }\n    )\n    logger.info \"sent: #{datapath_id.to_hex} flow_mod\"\n    send_packet_out(\n      datapath_id,\n      packet_in: message,\n      actions: SendOutPort.new(:flood)\n    )\n  end\nend\n```\n\n```bash:\u5b9f\u884c\nroot@localhost:~/trema# /root/openvswitch-2.3.1/utilities/ovs-vsctl dump-flows br1\nNXST_FLOW reply (xid=0x4):\nroot@localhost:~/trema# bundle exec bin/trema run test.rb &\n[1] 10416\nroot@localhost:~/trema# /root/.rbenv/versions/2.2.3/lib/ruby/gems/2.2.0/gems/bundler-1.10.6/lib/bundler/shared_helpers.rb:78: warning: Insecure world writable dir /root/.rbenv/versions in PATH, mode 040777\n/root/trema/trema.gemspec:20: warning: Insecure world writable dir /root/trema/vendor/bundle/ruby/2.2.0/bin in PATH, mode 040777\nswitch_ready: 0x1\n\nroot@localhost:~/trema# /root/openvswitch-2.3.1/utilities/ovs-vsctl dump-flows br1\nNXST_FLOW reply (xid=0x4):\nroot@localhost:~/trema# packet_in: 0x1\nsent: 0x1 flow_mod\n\nroot@localhost:~/trema# /root/openvswitch-2.3.1/utilities/ovs-vsctl dump-flows br1\nNXST_FLOW reply (xid=0x4):\n cookie=0x0, duration=3.198s, table=0, n_packets=0, n_bytes=0, idle_age=3, priority=0,in_port=1 actions=FLOOD\nroot@localhost:~/trema# \nroot@localhost:~/trema# ping 10.0.0.254\nPING 10.0.0.254 (10.0.0.254) 56(84) bytes of data.\n^C\n--- 10.0.0.254 ping statistics ---\n2 packets transmitted, 0 received, 100% packet loss, time 1008ms\n\nroot@localhost:~/trema# /root/openvswitch-2.3.1/utilities/ovs-vsctl dump-flows br1\nNXST_FLOW reply (xid=0x4):\n cookie=0x0, duration=11.068s, table=0, n_packets=3, n_bytes=126, idle_age=1, priority=0,in_port=1 actions=FLOOD\nroot@localhost:~/trema# \n```\n\n\u52d5\u4f5c\u3059\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3002\u3053\u308c\u3067\u3053\u306e\u7aef\u672b\u3067OpenFlow\u3092\u4f7f\u3063\u305fControl Plane\u3001Data Plane\u3092\u6271\u3046\u4e8b\u304c\u53ef\u80fd\u306b\u306a\u3063\u305f\u3002\n\n# \u3053\u306e\u5f8c\n\n## namespace\n\n\u3053\u3053\u307e\u3067\u304f\u308b\u3068\u7aef\u672b\u3092\u4e26\u3079\u3066\u30b3\u30f3\u30c6\u30ca\u3092\u52d5\u304b\u3057\u3066**\u30dd\u30fc\u30bf\u30d6\u30eb\u30c7\u30fc\u30bf\u30bb\u30f3\u30bf\u30fc**\u306b\u3057\u305f\u304f\u306a\u3063\u3066\u304f\u308b\u3068\u3044\u3046\u304b\u3001\u305d\u308c\u304c\u5143\u3005\u306e\u76ee\u7684\u306a\u306e\u3067\u3001\u305d\u306e\u524d\u306bcgroup\u3084\u3001\u5404\u7a2enamespace\u7b49\u3092\u6709\u52b9\u306b\u3059\u308b\u3002\n\n\u3068\u3053\u308d\u3067\u3001\u3053\u306e\u30ab\u30fc\u30cd\u30eb\u306fnetns\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6709\u52b9\u306b\u3057\u305f\u3068\u3053\u308d\u3067\u3001netns\u95a2\u9023\u306e\u30bd\u30fc\u30b9\u304c\u5165\u3063\u3066\u3044\u306a\u3044\u306e\u3067\u6a5f\u80fd\u3057\u306a\u3044\u3002\u4ed5\u65b9\u304c\u306a\u3044\u306e\u3067\u3001Kernel2.6\u7cfb\u3067netns\u3068\u3044\u3048\u3070CentOS6.X\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u30d1\u30c3\u30c1\u3092\u3082\u3063\u3066\u304d\u3066\u7121\u7406\u77e2\u7406\u5f53\u3066\u308b\u3002\n\n\u5e78\u3044\u3001[\u30d1\u30c3\u30c1\u3092\u516c\u958b\u3057\u3066\u304f\u308c\u3066\u3044\u308b\u65b9](https://github.com/unicell/redpatch/commits/rhel-2.6.32-358.6.2.ns.el6)\u304c\u3044\u3089\u3063\u3057\u3083\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u5229\u7528\u3055\u305b\u3066\u9802\u304f\u3002\n\n\u3053\u306e\u72b6\u614b\u3067\u306f\u307e\u3060\u4e0d\u5341\u5206\u3067\u3001netns\u7cfb\u306e\u64cd\u4f5c\u3092\u884c\u3046\u3068Function not implemented\u3068\u8a00\u308f\u308c\u308b\u3002\n\u305d\u3082\u305d\u3082arch/arm/include/calls.S\u3092\u898b\u308b\u3068\u3001setns\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u306a\u3044\u3002\u3064\u307e\u308a\u3001setns\u3092\u5229\u7528\u3057\u305f\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u52d5\u4f5c\u3057\u306a\u3044\u3002\u305d\u306e\u305f\u3081\u3001\u81ea\u5206\u3067calls.S\u306b\u9069\u5f53\u306bsetns\u3092\u8ffd\u52a0\u3059\u308b\u3002\u307e\u305f\u3001iproute\u7b49\u306esyscall\u756a\u53f7\u3092\u76f4\u3057\u3066\u30d3\u30eb\u30c9\u3059\u308b\u3053\u3068\u3067\u3001\u4e00\u5fdc\u5229\u7528\u53ef\u80fd\u306b\u306f\u306a\u308b\u3002\n\n## veth\u306esetns\n\n\u65e9\u901fveth\u306b\u5bfe\u3057\u3066setns\u3092\u5b9f\u884c\u3057\u3088\u3046\u304b\u3068\u304a\u3082\u3063\u305f\u3068\u3053\u308d\u3001invalid argument\u3068\u8a00\u308f\u308c\u3066\u3057\u307e\u3046\u3002\nbridge\u306e\u3088\u3046\u306bsetns local\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306b\u3088\u304f\u767a\u751f\u3059\u308b\u73fe\u8c61\u3060\u304c\u3001ethtool\u3067\u898b\u3066\u3082veth\u306f\u305d\u3046\u306a\u3063\u3066\u3044\u306a\u3044\u3002\n\u3053\u308c\u306b\u3064\u3044\u3066\u306f\u8abf\u67fb\u4e2d\u3002\n", "tags": ["Android", "trema", "OpenVSwitch", "OpenFlow"]}