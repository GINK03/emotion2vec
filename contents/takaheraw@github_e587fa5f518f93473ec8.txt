{"tags": ["GAE", "GoogleCloudPlatform"], "context": "Rails + Cloud SQL \u306e\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3084\u3063\u3066\u307f\u305f\n\n\u3000\u6e96\u5099\n\nGoogle Developers Console\n\nGoogle Developers Console\n\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\u3059\u308b\n\n\n\u304a\u652f\u6255\u3044\u65b9\u6cd5\u3092\u8a2d\u5b9a\u3059\u308b\n\n\nGoogle Cloud SDK \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nSDK\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n$ ./google-cloud-sdk/install.sh\n\n\nInitialize the SDK\n\n$ ./google-cloud-sdk/bin/gcloud init\n\nTo continue, you must log in. Would you like to log in (Y/n)?  Y\n\nPick cloud project to use:\n    [1] [demo-bookshelf]\nPlease enter your numeric choice:  1\n\n\n\u5229\u7528\u3059\u308bAPI\u306e\u6709\u52b9\n\nGoogle Cloud Datastore API \u3092\u6709\u52b9\u306b\u3059\u308b\n\n\nservice account\u306e\u4f5c\u6210\n\n\u300cIAM\u3068\u7ba1\u7406\u300d => \u300c\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u300d\u3067\u9375\u3092\u4f5c\u6210\u3059\u308b\n\n\n\nCloud SQL\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\n\n\nIPv4 address\u3092\u30ea\u30af\u30a8\u30b9\u30c8\n\n\u300c\u30a2\u30af\u30bb\u30b9\u5236\u5fa1\u300d => \u300cIP\u30a2\u30c9\u30ec\u30b9\u300d\n\n\n\n\u627f\u8a8d\u6e08\u307f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u8ffd\u52a0\u3059\u308b\n\n\u300c\u30a2\u30af\u30bb\u30b9\u5236\u5fa1\u300d => \u300c\u627f\u8a8d\u300d\n\n\n\n\u30e6\u30fc\u30b6\u30fc\u8ffd\u52a0\n\n\u300c\u30a2\u30af\u30bb\u30b9\u5236\u5fa1\u300d => \u300c\u30e6\u30fc\u30b6\u30fc\u300d\n\n\n\nRails\u306eCRUD\u30a2\u30d7\u30ea\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n$ ghq get https://github.com/GoogleCloudPlatform/getting-started-ruby.git\n$ cd 2-cloud-sql\n$ bundle install\n\n\ndatabase\n\nconfig\n$ vi config/database.yml\n\nmysql_settings: &mysql_settings\n  adapter: mysql2\n  encoding: utf8\n  pool: 5\n  username: rubyapp\n  password: password\n  host: 173.194.251.242 \n  database: bookshelf\n\n\nmigrate\n$ bundle exec rake db:create\n$ bundle exec rake db:migrate\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304c\u4f5c\u6210\u3055\u308c\u308b\n\n\n\u30ed\u30fc\u30ab\u30eb\u8d77\u52d5\n$ bundle exec rails s\n$ http://localhost:3000\n\n\n\u30c7\u30d7\u30ed\u30a4\n$ gcloud preview app deploy\n\nYou are about to deploy the following services:\n - glossy-champion-131810/default (from [/Users/takahiro/.ghq/github.com/GoogleCloudPlatform/getting-started-ruby/2-cloud-sql/app.yaml])\n     Deployed URL: [https://glossy-champion-131810.appspot.com]\n\nDo you want to continue (Y/n)?  Y\n\nBeginning deployment...\nIf this is your first deployment, this may take a while...done.\n\nVerifying that Managed VMs are enabled and ready.\nBuilding and pushing image for service [default]\nStarted cloud build [8e7694ed-7dea-4d52-bac2-9d68065af32a].\nTo see logs in the Cloud Console: https://console.developers.google.com/logs?project=glossy-champion-131810&service=cloudbuild.googleapis.com&key1=8e7694ed-7dea-4d52-bac2-9d68065af32a&logName=projects/glossy-champion-131810/logs/cloudbuild\n------------------------------------------------------------------------------------------- REMOTE BUILD OUTPUT -------------------------------------------------------------------------------------------\nstarting build \"8e7694ed-7dea-4d52-bac2-9d68065af32a\"\n\nFETCHSOURCE\nFetching storage object: gs://staging.glossy-champion-131810.appspot.com/us.gcr.io/glossy-champion-131810/appengine/default.20160521t203824:latest#1463830791735000\nCopying gs://staging.glossy-champion-131810.appspot.com/us.gcr.io/glossy-champion-131810/appengine/default.20160521t203824:latest#1463830791735000...\nDownloading file:///tmp/source-archive.tgz:                      203.89 KiB/203.89 KiB\nFETCHBUILDER\nBUILD\n+ docker version\nClient:\n Version:      1.9.1\n API version:  1.21\n Go version:   go1.4.3\n Git commit:   a34a1d5\n Built:        Fri Nov 20 17:56:04 UTC 2015\n OS/Arch:      linux/amd64\n\nServer:\n Version:      1.9.1\n API version:  1.21\n Go version:   go1.4.2\n Git commit:   a34a1d5\n Built:        Fri Nov 20 13:12:04 UTC 2015\n OS/Arch:      linux/amd64\n# This Dockerfile for a Ruby application was generated by gcloud.\n\n# The base Dockerfile installs:\n# * A number of packages needed by the Ruby runtime and by gems\n#   commonly used in Ruby web apps (such as libsqlite3)\n# * A recent version of NodeJS\n# * A recent version of the standard Ruby runtime to use by default\n# * The bundler gem\nFROM gcr.io/google_appengine/ruby\n\n# Install 2.2.3 if not already preinstalled by the base image\nRUN cd /rbenv/plugins/ruby-build && \\\n    git pull && \\\n    rbenv install -s 2.2.3 && \\\n    rbenv global 2.2.3 && \\\n    gem install -q --no-rdoc --no-ri bundler --version 1.11.2\nENV RBENV_VERSION 2.2.3\n\n# Copy the application files.\nCOPY . /app/\n\n# Install required gems if Gemfile.lock is present.\nRUN if test -f Gemfile.lock; then \\\n    bundle install --deployment && rbenv rehash; \\\n    fi\n\n# Temporary. Will be moved to base image later.\nENV RACK_ENV=production \\\n    RAILS_ENV=production \\\n    RAILS_SERVE_STATIC_FILES=true\n\n# Run asset pipeline if we're in a Rails app.\nRUN if test -d app/assets -a -f config/application.rb; then \\\n    bundle exec rake assets:precompile; \\\n    fi\n\n# BUG: Reset entrypoint to override base image.\nENTRYPOINT []\n\n# Start application on port $PORT.\nCMD bundle exec rackup -p 8080 -E production config.ru\n+ cat Dockerfile\n+ docker build --tag us.gcr.io/glossy-champion-131810/appengine/default.20160521t203824:latest /workspace\nSending build context to Docker daemon 548.9 kB\nStep 1 : FROM gcr.io/google_appengine/ruby\n ---> 3d07cecaa948\nStep 2 : RUN cd /rbenv/plugins/ruby-build &&     git pull &&     rbenv install -s 2.2.3 &&     rbenv global 2.2.3 &&     gem install -q --no-rdoc --no-ri bundler --version 1.11.2\n ---> Running in 25c119c65752\nFrom https://github.com/sstephenson/ruby-build\n   2bd59bd..3dbbf90  master     -> origin/master\nUpdating 2bd59bd..3dbbf90\nFast-forward\n share/ruby-build/1.8.5-p113     | 3 +++\n share/ruby-build/1.8.5-p114     | 3 +++\n share/ruby-build/1.8.5-p115     | 3 +++\n share/ruby-build/1.8.5-p231     | 3 +++\n share/ruby-build/1.8.5-p52      | 3 +++\n share/ruby-build/1.8.6          | 3 +++\n share/ruby-build/1.8.6-p110     | 3 +++\n share/ruby-build/1.8.6-p111     | 3 +++\n share/ruby-build/1.8.6-p114     | 3 +++\n share/ruby-build/1.8.6-p230     | 3 +++\n share/ruby-build/1.8.6-p286     | 3 +++\n share/ruby-build/1.8.6-p287     | 3 +++\n share/ruby-build/1.8.6-p36      | 3 +++\n share/ruby-build/1.8.6-p368     | 3 +++\n share/ruby-build/1.8.6-p369     | 3 +++\n share/ruby-build/1.8.6-p388     | 3 +++\n share/ruby-build/1.8.6-p398     | 3 +++\n share/ruby-build/1.8.6-p399     | 3 +++\n share/ruby-build/1.8.7          | 3 +++\n share/ruby-build/1.8.7-p160     | 3 +++\n share/ruby-build/1.8.7-p17      | 3 +++\n share/ruby-build/1.8.7-p173     | 3 +++\n share/ruby-build/1.8.7-p174     | 3 +++\n share/ruby-build/1.8.7-p22      | 3 +++\n share/ruby-build/1.8.7-p248     | 3 +++\n share/ruby-build/1.8.7-p299     | 3 +++\n share/ruby-build/1.8.7-p301     | 3 +++\n share/ruby-build/1.8.7-p330     | 3 +++\n share/ruby-build/1.8.7-p373     | 3 +++\n share/ruby-build/1.8.7-p71      | 3 +++\n share/ruby-build/1.8.7-p72      | 3 +++\n share/ruby-build/1.8.7-preview1 | 3 +++\n share/ruby-build/1.8.7-preview2 | 3 +++\n share/ruby-build/1.8.7-preview3 | 3 +++\n share/ruby-build/1.8.7-preview4 | 3 +++\n share/ruby-build/1.9.0-0        | 4 ++++\n share/ruby-build/1.9.0-1        | 4 ++++\n share/ruby-build/1.9.0-2        | 4 ++++\n share/ruby-build/1.9.0-3        | 4 ++++\n share/ruby-build/1.9.0-4        | 4 ++++\n share/ruby-build/1.9.0-5        | 4 ++++\n share/ruby-build/1.9.1-p0       | 4 ++++\n share/ruby-build/1.9.1-p129     | 4 ++++\n share/ruby-build/1.9.1-p243     | 4 ++++\n share/ruby-build/1.9.1-p376     | 4 ++++\n share/ruby-build/1.9.1-p429     | 4 ++++\n share/ruby-build/1.9.1-p431     | 4 ++++\n share/ruby-build/1.9.1-preview1 | 4 ++++\n share/ruby-build/1.9.1-preview2 | 4 ++++\n share/ruby-build/1.9.1-rc1      | 4 ++++\n share/ruby-build/1.9.1-rc2      | 4 ++++\n share/ruby-build/1.9.2-p136     | 4 ++++\n share/ruby-build/1.9.2-preview1 | 4 ++++\n share/ruby-build/1.9.2-preview3 | 4 ++++\n share/ruby-build/1.9.2-rc1      | 4 ++++\n share/ruby-build/1.9.2-rc2      | 4 ++++\n share/ruby-build/1.9.3-p105     | 5 +++++\n share/ruby-build/1.9.3-p426     | 3 +++\n share/ruby-build/jruby-9.1.1.0  | 2 ++\n share/ruby-build/rbx-3.30       | 3 +++\n 60 files changed, 202 insertions(+)\n create mode 100644 share/ruby-build/1.8.5-p113\n create mode 100644 share/ruby-build/1.8.5-p114\n create mode 100644 share/ruby-build/1.8.5-p115\n create mode 100644 share/ruby-build/1.8.5-p231\n create mode 100644 share/ruby-build/1.8.5-p52\n create mode 100644 share/ruby-build/1.8.6\n create mode 100644 share/ruby-build/1.8.6-p110\n create mode 100644 share/ruby-build/1.8.6-p111\n create mode 100644 share/ruby-build/1.8.6-p114\n create mode 100644 share/ruby-build/1.8.6-p230\n create mode 100644 share/ruby-build/1.8.6-p286\n create mode 100644 share/ruby-build/1.8.6-p287\n create mode 100644 share/ruby-build/1.8.6-p36\n create mode 100644 share/ruby-build/1.8.6-p368\n create mode 100644 share/ruby-build/1.8.6-p369\n create mode 100644 share/ruby-build/1.8.6-p388\n create mode 100644 share/ruby-build/1.8.6-p398\n create mode 100644 share/ruby-build/1.8.6-p399\n create mode 100644 share/ruby-build/1.8.7\n create mode 100644 share/ruby-build/1.8.7-p160\n create mode 100644 share/ruby-build/1.8.7-p17\n create mode 100644 share/ruby-build/1.8.7-p173\n create mode 100644 share/ruby-build/1.8.7-p174\n create mode 100644 share/ruby-build/1.8.7-p22\n create mode 100644 share/ruby-build/1.8.7-p248\n create mode 100644 share/ruby-build/1.8.7-p299\n create mode 100644 share/ruby-build/1.8.7-p301\n create mode 100644 share/ruby-build/1.8.7-p330\n create mode 100644 share/ruby-build/1.8.7-p373\n create mode 100644 share/ruby-build/1.8.7-p71\n create mode 100644 share/ruby-build/1.8.7-p72\n create mode 100644 share/ruby-build/1.8.7-preview1\n create mode 100644 share/ruby-build/1.8.7-preview2\n create mode 100644 share/ruby-build/1.8.7-preview3\n create mode 100644 share/ruby-build/1.8.7-preview4\n create mode 100644 share/ruby-build/1.9.0-0\n create mode 100644 share/ruby-build/1.9.0-1\n create mode 100644 share/ruby-build/1.9.0-2\n create mode 100644 share/ruby-build/1.9.0-3\n create mode 100644 share/ruby-build/1.9.0-4\n create mode 100644 share/ruby-build/1.9.0-5\n create mode 100644 share/ruby-build/1.9.1-p0\n create mode 100644 share/ruby-build/1.9.1-p129\n create mode 100644 share/ruby-build/1.9.1-p243\n create mode 100644 share/ruby-build/1.9.1-p376\n create mode 100644 share/ruby-build/1.9.1-p429\n create mode 100644 share/ruby-build/1.9.1-p431\n create mode 100644 share/ruby-build/1.9.1-preview1\n create mode 100644 share/ruby-build/1.9.1-preview2\n create mode 100644 share/ruby-build/1.9.1-rc1\n create mode 100644 share/ruby-build/1.9.1-rc2\n create mode 100644 share/ruby-build/1.9.2-p136\n create mode 100644 share/ruby-build/1.9.2-preview1\n create mode 100644 share/ruby-build/1.9.2-preview3\n create mode 100644 share/ruby-build/1.9.2-rc1\n create mode 100644 share/ruby-build/1.9.2-rc2\n create mode 100644 share/ruby-build/1.9.3-p105\n create mode 100644 share/ruby-build/1.9.3-p426\n create mode 100644 share/ruby-build/jruby-9.1.1.0\n create mode 100644 share/ruby-build/rbx-3.30\nDownloading ruby-2.2.3.tar.bz2...\n-> https://cache.ruby-lang.org/pub/ruby/2.2/ruby-2.2.3.tar.bz2\nInstalling ruby-2.2.3...\nInstalled ruby-2.2.3 to /rbenv/versions/2.2.3\n\nSuccessfully installed bundler-1.11.2\n1 gem installed\n ---> f78d5ca2d7d7\nRemoving intermediate container 25c119c65752\nStep 3 : ENV RBENV_VERSION 2.2.3\n ---> Running in 0b601904e482\n ---> ef76ec7b785b\nRemoving intermediate container 0b601904e482\nStep 4 : COPY . /app/\n ---> e8ff4eacbbf2\nRemoving intermediate container a9e4e6e1bf5b\nStep 5 : RUN if test -f Gemfile.lock; then     bundle install --deployment && rbenv rehash;     fi\n ---> Running in 0ad27781a277\nDon't run Bundler as root. Bundler can ask for sudo if it is needed, and\ninstalling your bundle as root will break this application for all non-root\nusers on this machine.\nWarning: the running version of Bundler is older than the version that created the lockfile. We suggest you upgrade to the latest version of Bundler by running `gem install bundler`.\nFetching gem metadata from https://rubygems.org/...........\nFetching version metadata from https://rubygems.org/...\nFetching dependency metadata from https://rubygems.org/..\nInstalling rake 11.1.2\nInstalling i18n 0.7.0\nInstalling json 1.8.3 with native extensions\nInstalling minitest 5.8.4\nInstalling thread_safe 0.3.5\nInstalling builder 3.2.2\nInstalling erubis 2.7.0\nInstalling mini_portile2 2.0.0\nInstalling rack 1.6.4\nInstalling mime-types-data 3.2016.0221\nInstalling arel 6.0.3\nInstalling addressable 2.4.0\nInstalling cliver 0.3.2\nInstalling concurrent-ruby 1.0.2\nInstalling diff-lcs 1.2.5\nInstalling thor 0.19.1\nInstalling multi_json 1.12.0\nInstalling mysql2 0.3.20 with native extensions\nInstalling websocket-extensions 0.1.2\nUsing bundler 1.11.2\nInstalling rspec-support 3.4.1\nInstalling sqlite3 1.3.11 with native extensions\nInstalling tzinfo 1.2.2\nInstalling nokogiri 1.6.7.2 with native extensions\nInstalling rack-test 0.6.3\nInstalling mime-types 3.0\nInstalling sprockets 3.6.0\nInstalling websocket-driver 0.6.3 with native extensions\nInstalling rspec-core 3.4.4\nInstalling rspec-expectations 3.4.0\nInstalling rspec-mocks 3.4.1\nInstalling activesupport 4.2.6\nInstalling tzinfo-data 1.2016.4\nInstalling loofah 2.0.3\nInstalling xpath 2.0.0\nInstalling mail 2.6.4\nInstalling rails-deprecated_sanitizer 1.0.3\nInstalling globalid 0.3.6\nInstalling activemodel 4.2.6\nInstalling rails-html-sanitizer 1.0.3\nInstalling capybara 2.7.1\nInstalling rails-dom-testing 1.0.7\nInstalling activejob 4.2.6\nInstalling activerecord 4.2.6\nInstalling poltergeist 1.9.0\nInstalling actionview 4.2.6\nInstalling actionpack 4.2.6\nInstalling actionmailer 4.2.6\nInstalling railties 4.2.6\nInstalling sprockets-rails 3.0.4\nInstalling jquery-rails 4.1.1\nInstalling rspec-rails 3.4.2\nInstalling rails 4.2.6\nBundle complete! 9 Gemfile dependencies, 53 gems now installed.\nBundled gems are installed into ./vendor/bundle.\n ---> 6e3f7bd87f9a\nRemoving intermediate container 0ad27781a277\nStep 6 : ENV RACK_ENV production RAILS_ENV production RAILS_SERVE_STATIC_FILES true\n ---> Running in b0679bc93d64\n ---> 0d9a83bc7a3b\nRemoving intermediate container b0679bc93d64\nStep 7 : RUN if test -d app/assets -a -f config/application.rb; then     bundle exec rake assets:precompile;     fi\n ---> Running in 745b52a1128a\n ---> 54e5b440ac49\nRemoving intermediate container 745b52a1128a\nStep 8 : ENTRYPOINT\n ---> Running in 799b7e51b53c\n ---> 902f440effe2\nRemoving intermediate container 799b7e51b53c\nStep 9 : CMD bundle exec rackup -p 8080 -E production config.ru\n ---> Running in e91280844a17\n ---> 564709cc773f\nRemoving intermediate container e91280844a17\nSuccessfully built 564709cc773f\nPUSH\nThe push refers to a repository [us.gcr.io/glossy-champion-131810/appengine/default.20160521t203824] (len: 1)\n564709cc773f: Preparing\n564709cc773f: Pushing\n564709cc773f: Pushed\n902f440effe2: Preparing\n902f440effe2: Pushing\n902f440effe2: Pushed\n54e5b440ac49: Preparing\n54e5b440ac49: Pushing\n54e5b440ac49: Pushed\n0d9a83bc7a3b: Preparing\n0d9a83bc7a3b: Pushing\n0d9a83bc7a3b: Pushed\n6e3f7bd87f9a: Preparing\n6e3f7bd87f9a: Pushing\n6e3f7bd87f9a: Pushed\ne8ff4eacbbf2: Preparing\ne8ff4eacbbf2: Pushing\ne8ff4eacbbf2: Pushed\nef76ec7b785b: Preparing\nef76ec7b785b: Pushing\nef76ec7b785b: Pushed\nf78d5ca2d7d7: Preparing\nf78d5ca2d7d7: Pushing\nf78d5ca2d7d7: Pushed\n58a8561a458e: Image already exists\nef866b7acceb: Image already exists\nb5af07c62198: Image already exists\nb3388c4bd40b: Image already exists\n437045486895: Image already exists\n58d9f8b0627d: Image already exists\nf8f0a08927ad: Image already exists\n502312a1defd: Image already exists\nf28dbda953c1: Image already exists\n096d9403d234: Image already exists\nlatest: digest: sha256:4af2c910ff637c71943ff243192c4fcc9854e6615c027a418ec3337ec20143eb size: 75409\nDONE\n-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n\nUpdating service [default]...done.\nDeployed service [default] to [https://glossy-champion-131810.appspot.com]\n\n\n\u52d5\u3044\u305f\uff01\n\n\nRails + Cloud SQL \u306e[\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb](https://cloud.google.com/ruby/getting-started/using-cloud-sql)\u3084\u3063\u3066\u307f\u305f\n\n#\u3000\u6e96\u5099\n\n## Google Developers Console\n\n+ [Google Developers Console](https://console.cloud.google.com/)\n\n## \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\u3059\u308b\n\n![1.png](https://qiita-image-store.s3.amazonaws.com/0/7086/f163dfa3-5726-6cea-3be9-7ebf1cb09b53.png)\n\n## \u304a\u652f\u6255\u3044\u65b9\u6cd5\u3092\u8a2d\u5b9a\u3059\u308b\n\n![3.png](https://qiita-image-store.s3.amazonaws.com/0/7086/d78a7093-a834-cccc-e036-d4bb8d878366.png)\n\n## Google Cloud SDK \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n+ [SDK\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9](https://cloud.google.com/sdk/docs/quickstart-mac-os-x)\n\n+ \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```shell-session\n$ ./google-cloud-sdk/install.sh\n```\n\n+ Initialize the SDK\n\n```shell-session\n$ ./google-cloud-sdk/bin/gcloud init\n```\n```\nTo continue, you must log in. Would you like to log in (Y/n)?  Y\n\nPick cloud project to use:\n\t[1] [demo-bookshelf]\nPlease enter your numeric choice:  1\n```\n\n## \u5229\u7528\u3059\u308bAPI\u306e\u6709\u52b9\n\n### Google Cloud Datastore API \u3092\u6709\u52b9\u306b\u3059\u308b\n\n![datastore](https://i.gyazo.com/55338a3b58829bdcb7d13b7aa4524e94.png)\n\n## service account\u306e\u4f5c\u6210\n\n+ \u300cIAM\u3068\u7ba1\u7406\u300d => \u300c\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u300d\u3067\u9375\u3092\u4f5c\u6210\u3059\u308b\n\n![serviceaccount](https://i.gyazo.com/8007e167d3096737d1f9dcd4c492ea71.png)\n\n## Cloud SQL\n\n### \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\n\n![instance](https://i.gyazo.com/b1cdb200bacf10ccbb44d140557b76be.png)\n\n### IPv4 address\u3092\u30ea\u30af\u30a8\u30b9\u30c8\n\n+ \u300c\u30a2\u30af\u30bb\u30b9\u5236\u5fa1\u300d => \u300cIP\u30a2\u30c9\u30ec\u30b9\u300d\n\n![ipv4](https://i.gyazo.com/af3232205f542d636f811bd75efc4e3c.png)\n\n### \u627f\u8a8d\u6e08\u307f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u8ffd\u52a0\u3059\u308b\n\n+ \u300c\u30a2\u30af\u30bb\u30b9\u5236\u5fa1\u300d => \u300c\u627f\u8a8d\u300d\n\n![allow](https://i.gyazo.com/458fec66737f26eeee2e897aade62b80.png)\n\n### \u30e6\u30fc\u30b6\u30fc\u8ffd\u52a0\n\n+ \u300c\u30a2\u30af\u30bb\u30b9\u5236\u5fa1\u300d => \u300c\u30e6\u30fc\u30b6\u30fc\u300d\n\n![user](https://i.gyazo.com/74c777b0677315c6acc6c64a5e687895.png)\n\n\n# Rails\u306eCRUD\u30a2\u30d7\u30ea\n\n## \u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n```shell-session\n$ ghq get https://github.com/GoogleCloudPlatform/getting-started-ruby.git\n$ cd 2-cloud-sql\n$ bundle install\n```\n\n## database\n\n### config\n\n```shell-session\n$ vi config/database.yml\n```\n```yaml\nmysql_settings: &mysql_settings\n  adapter: mysql2\n  encoding: utf8\n  pool: 5\n  username: rubyapp\n  password: password\n  host: 173.194.251.242 \n  database: bookshelf\n```\n\n### migrate\n\n```shell-session\n$ bundle exec rake db:create\n$ bundle exec rake db:migrate\n```\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304c\u4f5c\u6210\u3055\u308c\u308b\n\n![mysql](https://i.gyazo.com/46d030e8676e4ec5f430c9b91e8fb790.png)\n\n## \u30ed\u30fc\u30ab\u30eb\u8d77\u52d5\n\n```shell-session\n$ bundle exec rails s\n$ http://localhost:3000\n```\n\n# \u30c7\u30d7\u30ed\u30a4\n\n```shell-session\n$ gcloud preview app deploy\n```\n```shell-session\nYou are about to deploy the following services:\n - glossy-champion-131810/default (from [/Users/takahiro/.ghq/github.com/GoogleCloudPlatform/getting-started-ruby/2-cloud-sql/app.yaml])\n     Deployed URL: [https://glossy-champion-131810.appspot.com]\n\nDo you want to continue (Y/n)?  Y\n\nBeginning deployment...\nIf this is your first deployment, this may take a while...done.\n\nVerifying that Managed VMs are enabled and ready.\nBuilding and pushing image for service [default]\nStarted cloud build [8e7694ed-7dea-4d52-bac2-9d68065af32a].\nTo see logs in the Cloud Console: https://console.developers.google.com/logs?project=glossy-champion-131810&service=cloudbuild.googleapis.com&key1=8e7694ed-7dea-4d52-bac2-9d68065af32a&logName=projects/glossy-champion-131810/logs/cloudbuild\n------------------------------------------------------------------------------------------- REMOTE BUILD OUTPUT -------------------------------------------------------------------------------------------\nstarting build \"8e7694ed-7dea-4d52-bac2-9d68065af32a\"\n\nFETCHSOURCE\nFetching storage object: gs://staging.glossy-champion-131810.appspot.com/us.gcr.io/glossy-champion-131810/appengine/default.20160521t203824:latest#1463830791735000\nCopying gs://staging.glossy-champion-131810.appspot.com/us.gcr.io/glossy-champion-131810/appengine/default.20160521t203824:latest#1463830791735000...\nDownloading file:///tmp/source-archive.tgz:                      203.89 KiB/203.89 KiB\nFETCHBUILDER\nBUILD\n+ docker version\nClient:\n Version:      1.9.1\n API version:  1.21\n Go version:   go1.4.3\n Git commit:   a34a1d5\n Built:        Fri Nov 20 17:56:04 UTC 2015\n OS/Arch:      linux/amd64\n\nServer:\n Version:      1.9.1\n API version:  1.21\n Go version:   go1.4.2\n Git commit:   a34a1d5\n Built:        Fri Nov 20 13:12:04 UTC 2015\n OS/Arch:      linux/amd64\n# This Dockerfile for a Ruby application was generated by gcloud.\n\n# The base Dockerfile installs:\n# * A number of packages needed by the Ruby runtime and by gems\n#   commonly used in Ruby web apps (such as libsqlite3)\n# * A recent version of NodeJS\n# * A recent version of the standard Ruby runtime to use by default\n# * The bundler gem\nFROM gcr.io/google_appengine/ruby\n\n# Install 2.2.3 if not already preinstalled by the base image\nRUN cd /rbenv/plugins/ruby-build && \\\n    git pull && \\\n    rbenv install -s 2.2.3 && \\\n    rbenv global 2.2.3 && \\\n    gem install -q --no-rdoc --no-ri bundler --version 1.11.2\nENV RBENV_VERSION 2.2.3\n\n# Copy the application files.\nCOPY . /app/\n\n# Install required gems if Gemfile.lock is present.\nRUN if test -f Gemfile.lock; then \\\n    bundle install --deployment && rbenv rehash; \\\n    fi\n\n# Temporary. Will be moved to base image later.\nENV RACK_ENV=production \\\n    RAILS_ENV=production \\\n    RAILS_SERVE_STATIC_FILES=true\n\n# Run asset pipeline if we're in a Rails app.\nRUN if test -d app/assets -a -f config/application.rb; then \\\n    bundle exec rake assets:precompile; \\\n    fi\n\n# BUG: Reset entrypoint to override base image.\nENTRYPOINT []\n\n# Start application on port $PORT.\nCMD bundle exec rackup -p 8080 -E production config.ru\n+ cat Dockerfile\n+ docker build --tag us.gcr.io/glossy-champion-131810/appengine/default.20160521t203824:latest /workspace\nSending build context to Docker daemon 548.9 kB\nStep 1 : FROM gcr.io/google_appengine/ruby\n ---> 3d07cecaa948\nStep 2 : RUN cd /rbenv/plugins/ruby-build &&     git pull &&     rbenv install -s 2.2.3 &&     rbenv global 2.2.3 &&     gem install -q --no-rdoc --no-ri bundler --version 1.11.2\n ---> Running in 25c119c65752\nFrom https://github.com/sstephenson/ruby-build\n   2bd59bd..3dbbf90  master     -> origin/master\nUpdating 2bd59bd..3dbbf90\nFast-forward\n share/ruby-build/1.8.5-p113     | 3 +++\n share/ruby-build/1.8.5-p114     | 3 +++\n share/ruby-build/1.8.5-p115     | 3 +++\n share/ruby-build/1.8.5-p231     | 3 +++\n share/ruby-build/1.8.5-p52      | 3 +++\n share/ruby-build/1.8.6          | 3 +++\n share/ruby-build/1.8.6-p110     | 3 +++\n share/ruby-build/1.8.6-p111     | 3 +++\n share/ruby-build/1.8.6-p114     | 3 +++\n share/ruby-build/1.8.6-p230     | 3 +++\n share/ruby-build/1.8.6-p286     | 3 +++\n share/ruby-build/1.8.6-p287     | 3 +++\n share/ruby-build/1.8.6-p36      | 3 +++\n share/ruby-build/1.8.6-p368     | 3 +++\n share/ruby-build/1.8.6-p369     | 3 +++\n share/ruby-build/1.8.6-p388     | 3 +++\n share/ruby-build/1.8.6-p398     | 3 +++\n share/ruby-build/1.8.6-p399     | 3 +++\n share/ruby-build/1.8.7          | 3 +++\n share/ruby-build/1.8.7-p160     | 3 +++\n share/ruby-build/1.8.7-p17      | 3 +++\n share/ruby-build/1.8.7-p173     | 3 +++\n share/ruby-build/1.8.7-p174     | 3 +++\n share/ruby-build/1.8.7-p22      | 3 +++\n share/ruby-build/1.8.7-p248     | 3 +++\n share/ruby-build/1.8.7-p299     | 3 +++\n share/ruby-build/1.8.7-p301     | 3 +++\n share/ruby-build/1.8.7-p330     | 3 +++\n share/ruby-build/1.8.7-p373     | 3 +++\n share/ruby-build/1.8.7-p71      | 3 +++\n share/ruby-build/1.8.7-p72      | 3 +++\n share/ruby-build/1.8.7-preview1 | 3 +++\n share/ruby-build/1.8.7-preview2 | 3 +++\n share/ruby-build/1.8.7-preview3 | 3 +++\n share/ruby-build/1.8.7-preview4 | 3 +++\n share/ruby-build/1.9.0-0        | 4 ++++\n share/ruby-build/1.9.0-1        | 4 ++++\n share/ruby-build/1.9.0-2        | 4 ++++\n share/ruby-build/1.9.0-3        | 4 ++++\n share/ruby-build/1.9.0-4        | 4 ++++\n share/ruby-build/1.9.0-5        | 4 ++++\n share/ruby-build/1.9.1-p0       | 4 ++++\n share/ruby-build/1.9.1-p129     | 4 ++++\n share/ruby-build/1.9.1-p243     | 4 ++++\n share/ruby-build/1.9.1-p376     | 4 ++++\n share/ruby-build/1.9.1-p429     | 4 ++++\n share/ruby-build/1.9.1-p431     | 4 ++++\n share/ruby-build/1.9.1-preview1 | 4 ++++\n share/ruby-build/1.9.1-preview2 | 4 ++++\n share/ruby-build/1.9.1-rc1      | 4 ++++\n share/ruby-build/1.9.1-rc2      | 4 ++++\n share/ruby-build/1.9.2-p136     | 4 ++++\n share/ruby-build/1.9.2-preview1 | 4 ++++\n share/ruby-build/1.9.2-preview3 | 4 ++++\n share/ruby-build/1.9.2-rc1      | 4 ++++\n share/ruby-build/1.9.2-rc2      | 4 ++++\n share/ruby-build/1.9.3-p105     | 5 +++++\n share/ruby-build/1.9.3-p426     | 3 +++\n share/ruby-build/jruby-9.1.1.0  | 2 ++\n share/ruby-build/rbx-3.30       | 3 +++\n 60 files changed, 202 insertions(+)\n create mode 100644 share/ruby-build/1.8.5-p113\n create mode 100644 share/ruby-build/1.8.5-p114\n create mode 100644 share/ruby-build/1.8.5-p115\n create mode 100644 share/ruby-build/1.8.5-p231\n create mode 100644 share/ruby-build/1.8.5-p52\n create mode 100644 share/ruby-build/1.8.6\n create mode 100644 share/ruby-build/1.8.6-p110\n create mode 100644 share/ruby-build/1.8.6-p111\n create mode 100644 share/ruby-build/1.8.6-p114\n create mode 100644 share/ruby-build/1.8.6-p230\n create mode 100644 share/ruby-build/1.8.6-p286\n create mode 100644 share/ruby-build/1.8.6-p287\n create mode 100644 share/ruby-build/1.8.6-p36\n create mode 100644 share/ruby-build/1.8.6-p368\n create mode 100644 share/ruby-build/1.8.6-p369\n create mode 100644 share/ruby-build/1.8.6-p388\n create mode 100644 share/ruby-build/1.8.6-p398\n create mode 100644 share/ruby-build/1.8.6-p399\n create mode 100644 share/ruby-build/1.8.7\n create mode 100644 share/ruby-build/1.8.7-p160\n create mode 100644 share/ruby-build/1.8.7-p17\n create mode 100644 share/ruby-build/1.8.7-p173\n create mode 100644 share/ruby-build/1.8.7-p174\n create mode 100644 share/ruby-build/1.8.7-p22\n create mode 100644 share/ruby-build/1.8.7-p248\n create mode 100644 share/ruby-build/1.8.7-p299\n create mode 100644 share/ruby-build/1.8.7-p301\n create mode 100644 share/ruby-build/1.8.7-p330\n create mode 100644 share/ruby-build/1.8.7-p373\n create mode 100644 share/ruby-build/1.8.7-p71\n create mode 100644 share/ruby-build/1.8.7-p72\n create mode 100644 share/ruby-build/1.8.7-preview1\n create mode 100644 share/ruby-build/1.8.7-preview2\n create mode 100644 share/ruby-build/1.8.7-preview3\n create mode 100644 share/ruby-build/1.8.7-preview4\n create mode 100644 share/ruby-build/1.9.0-0\n create mode 100644 share/ruby-build/1.9.0-1\n create mode 100644 share/ruby-build/1.9.0-2\n create mode 100644 share/ruby-build/1.9.0-3\n create mode 100644 share/ruby-build/1.9.0-4\n create mode 100644 share/ruby-build/1.9.0-5\n create mode 100644 share/ruby-build/1.9.1-p0\n create mode 100644 share/ruby-build/1.9.1-p129\n create mode 100644 share/ruby-build/1.9.1-p243\n create mode 100644 share/ruby-build/1.9.1-p376\n create mode 100644 share/ruby-build/1.9.1-p429\n create mode 100644 share/ruby-build/1.9.1-p431\n create mode 100644 share/ruby-build/1.9.1-preview1\n create mode 100644 share/ruby-build/1.9.1-preview2\n create mode 100644 share/ruby-build/1.9.1-rc1\n create mode 100644 share/ruby-build/1.9.1-rc2\n create mode 100644 share/ruby-build/1.9.2-p136\n create mode 100644 share/ruby-build/1.9.2-preview1\n create mode 100644 share/ruby-build/1.9.2-preview3\n create mode 100644 share/ruby-build/1.9.2-rc1\n create mode 100644 share/ruby-build/1.9.2-rc2\n create mode 100644 share/ruby-build/1.9.3-p105\n create mode 100644 share/ruby-build/1.9.3-p426\n create mode 100644 share/ruby-build/jruby-9.1.1.0\n create mode 100644 share/ruby-build/rbx-3.30\nDownloading ruby-2.2.3.tar.bz2...\n-> https://cache.ruby-lang.org/pub/ruby/2.2/ruby-2.2.3.tar.bz2\nInstalling ruby-2.2.3...\nInstalled ruby-2.2.3 to /rbenv/versions/2.2.3\n\nSuccessfully installed bundler-1.11.2\n1 gem installed\n ---> f78d5ca2d7d7\nRemoving intermediate container 25c119c65752\nStep 3 : ENV RBENV_VERSION 2.2.3\n ---> Running in 0b601904e482\n ---> ef76ec7b785b\nRemoving intermediate container 0b601904e482\nStep 4 : COPY . /app/\n ---> e8ff4eacbbf2\nRemoving intermediate container a9e4e6e1bf5b\nStep 5 : RUN if test -f Gemfile.lock; then     bundle install --deployment && rbenv rehash;     fi\n ---> Running in 0ad27781a277\nDon't run Bundler as root. Bundler can ask for sudo if it is needed, and\ninstalling your bundle as root will break this application for all non-root\nusers on this machine.\nWarning: the running version of Bundler is older than the version that created the lockfile. We suggest you upgrade to the latest version of Bundler by running `gem install bundler`.\nFetching gem metadata from https://rubygems.org/...........\nFetching version metadata from https://rubygems.org/...\nFetching dependency metadata from https://rubygems.org/..\nInstalling rake 11.1.2\nInstalling i18n 0.7.0\nInstalling json 1.8.3 with native extensions\nInstalling minitest 5.8.4\nInstalling thread_safe 0.3.5\nInstalling builder 3.2.2\nInstalling erubis 2.7.0\nInstalling mini_portile2 2.0.0\nInstalling rack 1.6.4\nInstalling mime-types-data 3.2016.0221\nInstalling arel 6.0.3\nInstalling addressable 2.4.0\nInstalling cliver 0.3.2\nInstalling concurrent-ruby 1.0.2\nInstalling diff-lcs 1.2.5\nInstalling thor 0.19.1\nInstalling multi_json 1.12.0\nInstalling mysql2 0.3.20 with native extensions\nInstalling websocket-extensions 0.1.2\nUsing bundler 1.11.2\nInstalling rspec-support 3.4.1\nInstalling sqlite3 1.3.11 with native extensions\nInstalling tzinfo 1.2.2\nInstalling nokogiri 1.6.7.2 with native extensions\nInstalling rack-test 0.6.3\nInstalling mime-types 3.0\nInstalling sprockets 3.6.0\nInstalling websocket-driver 0.6.3 with native extensions\nInstalling rspec-core 3.4.4\nInstalling rspec-expectations 3.4.0\nInstalling rspec-mocks 3.4.1\nInstalling activesupport 4.2.6\nInstalling tzinfo-data 1.2016.4\nInstalling loofah 2.0.3\nInstalling xpath 2.0.0\nInstalling mail 2.6.4\nInstalling rails-deprecated_sanitizer 1.0.3\nInstalling globalid 0.3.6\nInstalling activemodel 4.2.6\nInstalling rails-html-sanitizer 1.0.3\nInstalling capybara 2.7.1\nInstalling rails-dom-testing 1.0.7\nInstalling activejob 4.2.6\nInstalling activerecord 4.2.6\nInstalling poltergeist 1.9.0\nInstalling actionview 4.2.6\nInstalling actionpack 4.2.6\nInstalling actionmailer 4.2.6\nInstalling railties 4.2.6\nInstalling sprockets-rails 3.0.4\nInstalling jquery-rails 4.1.1\nInstalling rspec-rails 3.4.2\nInstalling rails 4.2.6\nBundle complete! 9 Gemfile dependencies, 53 gems now installed.\nBundled gems are installed into ./vendor/bundle.\n ---> 6e3f7bd87f9a\nRemoving intermediate container 0ad27781a277\nStep 6 : ENV RACK_ENV production RAILS_ENV production RAILS_SERVE_STATIC_FILES true\n ---> Running in b0679bc93d64\n ---> 0d9a83bc7a3b\nRemoving intermediate container b0679bc93d64\nStep 7 : RUN if test -d app/assets -a -f config/application.rb; then     bundle exec rake assets:precompile;     fi\n ---> Running in 745b52a1128a\n ---> 54e5b440ac49\nRemoving intermediate container 745b52a1128a\nStep 8 : ENTRYPOINT\n ---> Running in 799b7e51b53c\n ---> 902f440effe2\nRemoving intermediate container 799b7e51b53c\nStep 9 : CMD bundle exec rackup -p 8080 -E production config.ru\n ---> Running in e91280844a17\n ---> 564709cc773f\nRemoving intermediate container e91280844a17\nSuccessfully built 564709cc773f\nPUSH\nThe push refers to a repository [us.gcr.io/glossy-champion-131810/appengine/default.20160521t203824] (len: 1)\n564709cc773f: Preparing\n564709cc773f: Pushing\n564709cc773f: Pushed\n902f440effe2: Preparing\n902f440effe2: Pushing\n902f440effe2: Pushed\n54e5b440ac49: Preparing\n54e5b440ac49: Pushing\n54e5b440ac49: Pushed\n0d9a83bc7a3b: Preparing\n0d9a83bc7a3b: Pushing\n0d9a83bc7a3b: Pushed\n6e3f7bd87f9a: Preparing\n6e3f7bd87f9a: Pushing\n6e3f7bd87f9a: Pushed\ne8ff4eacbbf2: Preparing\ne8ff4eacbbf2: Pushing\ne8ff4eacbbf2: Pushed\nef76ec7b785b: Preparing\nef76ec7b785b: Pushing\nef76ec7b785b: Pushed\nf78d5ca2d7d7: Preparing\nf78d5ca2d7d7: Pushing\nf78d5ca2d7d7: Pushed\n58a8561a458e: Image already exists\nef866b7acceb: Image already exists\nb5af07c62198: Image already exists\nb3388c4bd40b: Image already exists\n437045486895: Image already exists\n58d9f8b0627d: Image already exists\nf8f0a08927ad: Image already exists\n502312a1defd: Image already exists\nf28dbda953c1: Image already exists\n096d9403d234: Image already exists\nlatest: digest: sha256:4af2c910ff637c71943ff243192c4fcc9854e6615c027a418ec3337ec20143eb size: 75409\nDONE\n-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n\nUpdating service [default]...done.\nDeployed service [default] to [https://glossy-champion-131810.appspot.com]\n```\n\n+ \u52d5\u3044\u305f\uff01\n\n![rails](https://i.gyazo.com/4fe07d4c871a6fffb4d97ec666a3fca9.png)\n"}