{"context": "\u203b Node\u3067\u66f8\u3044\u3066\u307e\u3059\u304c\u3001ReQL\u81ea\u4f53\u306f\u8a00\u8a9e\u30d5\u30ea\u30fc\u306a\u306e\u3067\u4ed6\u8a00\u8a9e\u306e\u65b9\u306b\u3082\u53c2\u8003\u306b\u306f\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u521d\u671f\u5316\u6642\u306b\u3042\u308a\u304c\u3061\u306a\u3001DB\u3068\u30c6\u30fc\u30d6\u30eb\u3092\u6709\u7121\u3092\u30c1\u30a7\u30c3\u30af\u3057\u306a\u304c\u3089\u4f5c\u6210\u3059\u308b\u3068\u3044\u3046\u51e6\u7406\u3002\n\nDB\u4f5c\u6210\n// \u7121\u3051\u308c\u3070DB\u3092\u4f5c\u6210\nr.dbList().contains('messages').do((containsDb) => {\n  return r.branch(\n    containsDb,\n    {created: 0},\n    r.dbCreate('messages')\n  )\n}).run(conn)\n\n\n\u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\n// \u7121\u3051\u308c\u3070Table\u3092\u4f5c\u6210\nr.tableList().contains('messages').do((containsTable) => {\n  return r.branch(\n    containsTable,\n    {created: 0},\n    r.tableCreate('messages')\n  )\n}).run(conn)\n\n\n\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\n\ndbList, tableList\n\u6587\u5b57\u901a\u308a\u3001\u30ea\u30b9\u30c8\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\u8fd4\u308a\u5024\u306fArray\u3067\u3059\u3002\ndblist - ReQL command\ntablelist - ReQL command\n\ncontains\nSequence\u5185\u306b\u5f15\u6570\u3067\u6e21\u3057\u305f\u5024\u304c\u3042\u308b\u5834\u5408\u306fTrue\u3092\u8fd4\u3057\u307e\u3059\u3002\u3042\u308b\u3044\u306f\u3001Boolean\u5224\u5b9a\u95a2\u6570\u3092\u5f15\u6570\u306b\u6e21\u3059\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\u203bSequence = Array, Stream, Tables\u306e\u3088\u3046\u306a\u30ea\u30b9\u30c8\u578b\ncontains - ReQL command\n\ndo\n\u5f15\u6570\u306b\u95a2\u6570\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u3001\u305d\u306e\u95a2\u6570\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u305d\u306e\u969b\u3001\u76f4\u524d\u306eReQL\u306e\u7d50\u679c\u3092\u5f15\u304d\u7d99\u304e\u3001\u95a2\u6570\u306e\u5f15\u6570\u3068\u3057\u3066\u6e21\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\ndo - ReQL command\n\nbranch\n\u7b2c\u4e00\u5f15\u6570\u306bBoolean\u3092\u53d6\u308a\u3001true\u306a\u3089\u7b2c\u4e8c\u5f15\u6570\u306e\u51e6\u7406\u3092\u3001false\u306a\u3089\u7b2c\u4e09\u5f15\u6570\u306e\u51e6\u7406\u3092\u884c\u3044\u307e\u3059\u3002if-then-else\u7684\u306a\u51e6\u7406\u304c\u3067\u304d\u307e\u3059\u3002\n\u5f15\u6570\u306f\u3044\u304f\u3089\u3067\u3082\u8a2d\u5b9a\u3067\u304d\u3001if-then-elseif-then-elseif-then...\u3068\u3064\u306a\u3050\u3053\u3068\u3082\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u3002\nbranch - ReQL command\n\n\u304a\u307e\u3051\n\u3061\u306a\u307f\u306b\u3001\u4e0a\u8a18\u306e\u51e6\u7406\u3092\u3001\u63a5\u7d9a\u304b\u3089\u8d77\u52d5\u307e\u3067\u30c1\u30a7\u30fc\u30f3\u306b\u3057\u305f\uff11\u4f8b\u304c\u3053\u3061\u3089\u3002\nconst async = require('async')\n\n// \u63a5\u7d9a\nconst connectRethinkDB = (cb) => {\n  r.connect({\n    host: 'localhost',\n    port: 28015,\n    authKey: '',\n    db: 'trialDB'\n  }, cb)\n}\n\n// \u7121\u3051\u308c\u3070DB\u3092\u4f5c\u6210\nconst createDB = (conn, cb) => {\n  r.dbList().contains('messages').do((containsDb) => {\n    return r.branch(\n      containsDb,\n      {created: 0},\n      r.dbCreate('messages')\n    )\n  }).run(conn, (err) => {\n    cb(err, conn)\n  })\n}\n\n// \u7121\u3051\u308c\u3070Table\u3092\u4f5c\u6210\nconst createTable = (conn, cb) => {\n  r.tableList().contains('messages').do((containsTable) => {\n    return r.branch(\n      containsTable,\n      {created: 0},\n      r.tableCreate('messages')\n    )\n  }).run(conn, (err) => {\n    cb(err, conn)\n  })\n}\n\n// \u8907\u6570\u51e6\u7406\u3092\u9023\u7d9a\u7684\u306b\u5b9f\u884c\nasync.waterfall([\n  connectRethinkDB,\n  createDB,\n  createTable\n], (err, conn) => {\n  if(err) {\n    console.log(err)\n    process.exit(1)\n    return\n  }\n  startExpress()\n})\n\n\u3053\u3061\u3089\u306e\u30b3\u30fc\u30c9\u3092\u30ac\u30c3\u30c4\u30ea\u304a\u624b\u672c\u306b\u3057\u307e\u3057\u305f\u3002\nhttps://github.com/rethinkdb/rethinkdb-example-nodejs/blob/master/todo-angular-express/app.js\n<sub>\u203b Node\u3067\u66f8\u3044\u3066\u307e\u3059\u304c\u3001ReQL\u81ea\u4f53\u306f\u8a00\u8a9e\u30d5\u30ea\u30fc\u306a\u306e\u3067\u4ed6\u8a00\u8a9e\u306e\u65b9\u306b\u3082\u53c2\u8003\u306b\u306f\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002</sub>\n\n\u521d\u671f\u5316\u6642\u306b\u3042\u308a\u304c\u3061\u306a\u3001DB\u3068\u30c6\u30fc\u30d6\u30eb\u3092\u6709\u7121\u3092\u30c1\u30a7\u30c3\u30af\u3057\u306a\u304c\u3089\u4f5c\u6210\u3059\u308b\u3068\u3044\u3046\u51e6\u7406\u3002\n\n## DB\u4f5c\u6210\n\n```js\n// \u7121\u3051\u308c\u3070DB\u3092\u4f5c\u6210\nr.dbList().contains('messages').do((containsDb) => {\n  return r.branch(\n    containsDb,\n    {created: 0},\n    r.dbCreate('messages')\n  )\n}).run(conn)\n```\n\n## \u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\n\n```js\n// \u7121\u3051\u308c\u3070Table\u3092\u4f5c\u6210\nr.tableList().contains('messages').do((containsTable) => {\n  return r.branch(\n    containsTable,\n    {created: 0},\n    r.tableCreate('messages')\n  )\n}).run(conn)\n```\n\n## \u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\n\n### dbList, tableList\n\n\u6587\u5b57\u901a\u308a\u3001\u30ea\u30b9\u30c8\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\u8fd4\u308a\u5024\u306fArray\u3067\u3059\u3002\n\n[dblist - ReQL command](https://www.rethinkdb.com/api/javascript/db_list/)\n[tablelist - ReQL command](https://www.rethinkdb.com/api/javascript/table_list/)\n\n### contains\n\nSequence\u5185\u306b\u5f15\u6570\u3067\u6e21\u3057\u305f\u5024\u304c\u3042\u308b\u5834\u5408\u306fTrue\u3092\u8fd4\u3057\u307e\u3059\u3002\u3042\u308b\u3044\u306f\u3001Boolean\u5224\u5b9a\u95a2\u6570\u3092\u5f15\u6570\u306b\u6e21\u3059\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n<sub>\u203bSequence = Array, Stream, Tables\u306e\u3088\u3046\u306a\u30ea\u30b9\u30c8\u578b</sub>\n\n[contains - ReQL command](https://www.rethinkdb.com/api/python/contains/)\n\n### do\n\n\u5f15\u6570\u306b\u95a2\u6570\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u3001\u305d\u306e\u95a2\u6570\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u305d\u306e\u969b\u3001\u76f4\u524d\u306eReQL\u306e\u7d50\u679c\u3092\u5f15\u304d\u7d99\u304e\u3001\u95a2\u6570\u306e\u5f15\u6570\u3068\u3057\u3066\u6e21\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n[do - ReQL command](https://www.rethinkdb.com/api/python/do/)\n\n### branch\n\n\u7b2c\u4e00\u5f15\u6570\u306bBoolean\u3092\u53d6\u308a\u3001true\u306a\u3089\u7b2c\u4e8c\u5f15\u6570\u306e\u51e6\u7406\u3092\u3001false\u306a\u3089\u7b2c\u4e09\u5f15\u6570\u306e\u51e6\u7406\u3092\u884c\u3044\u307e\u3059\u3002if-then-else\u7684\u306a\u51e6\u7406\u304c\u3067\u304d\u307e\u3059\u3002\n\u5f15\u6570\u306f\u3044\u304f\u3089\u3067\u3082\u8a2d\u5b9a\u3067\u304d\u3001if-then-elseif-then-elseif-then...\u3068\u3064\u306a\u3050\u3053\u3068\u3082\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u3002\n\n[branch - ReQL command](https://www.rethinkdb.com/api/javascript/branch/)\n\n\n## \u304a\u307e\u3051\n\n\u3061\u306a\u307f\u306b\u3001\u4e0a\u8a18\u306e\u51e6\u7406\u3092\u3001\u63a5\u7d9a\u304b\u3089\u8d77\u52d5\u307e\u3067\u30c1\u30a7\u30fc\u30f3\u306b\u3057\u305f\uff11\u4f8b\u304c\u3053\u3061\u3089\u3002\n\n```js\nconst async = require('async')\n\n// \u63a5\u7d9a\nconst connectRethinkDB = (cb) => {\n  r.connect({\n    host: 'localhost',\n    port: 28015,\n    authKey: '',\n    db: 'trialDB'\n  }, cb)\n}\n\n// \u7121\u3051\u308c\u3070DB\u3092\u4f5c\u6210\nconst createDB = (conn, cb) => {\n  r.dbList().contains('messages').do((containsDb) => {\n    return r.branch(\n      containsDb,\n      {created: 0},\n      r.dbCreate('messages')\n    )\n  }).run(conn, (err) => {\n    cb(err, conn)\n  })\n}\n\n// \u7121\u3051\u308c\u3070Table\u3092\u4f5c\u6210\nconst createTable = (conn, cb) => {\n  r.tableList().contains('messages').do((containsTable) => {\n    return r.branch(\n      containsTable,\n      {created: 0},\n      r.tableCreate('messages')\n    )\n  }).run(conn, (err) => {\n    cb(err, conn)\n  })\n}\n\n// \u8907\u6570\u51e6\u7406\u3092\u9023\u7d9a\u7684\u306b\u5b9f\u884c\nasync.waterfall([\n  connectRethinkDB,\n  createDB,\n  createTable\n], (err, conn) => {\n  if(err) {\n    console.log(err)\n    process.exit(1)\n    return\n  }\n  startExpress()\n})\n```\n\n\u3053\u3061\u3089\u306e\u30b3\u30fc\u30c9\u3092\u30ac\u30c3\u30c4\u30ea\u304a\u624b\u672c\u306b\u3057\u307e\u3057\u305f\u3002\nhttps://github.com/rethinkdb/rethinkdb-example-nodejs/blob/master/todo-angular-express/app.js\n", "tags": ["RethinkDB", "Node.js"]}