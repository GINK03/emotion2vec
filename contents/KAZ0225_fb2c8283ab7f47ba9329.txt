{"context": "\u4f55\u756a\u714e\u3058\u306b\u306a\u308b\u306e\u3060\u308d\u3046(\u7b11)\nPython\u3067ZabbixAPI\u6295\u3052\u3066\u307f\u305f\u3002\n\u305f\u3060\u6295\u3052\u308b\u3060\u3051\u306f\u3064\u307e\u3089\u306a\u3044\u306e\u3067\u3001xxx.json\u3068\u8a00\u3046Json\u5f62\u5f0f\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u7528\u610f\u3057\u3066auth\u3068\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u307f\u8a2d\u5b9a\u3057\u3066\u6295\u3052\u308b\u3068\u3044\u3046\u65b9\u6cd5\u3092\u8003\u3048\u3066\u307f\u305f\u3002\n\u4e0b\u8a18\u306f\u6642\u9593\u6307\u5b9a\u3067event.get\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n# -*- coding: utf-8 -*- \nimport sys, json, urllib2, time, math\n\nresult = \"\"\nurl = \"http://xxx.xxx.xxx.xxx/zabbix/api_jsonrpc.php\"\nheaders = {\"Content-Type\":\"application/json-rpc\"}\n\n# get unixtime\ndef get_unixtime(s):\n    format = '%Y-%m-%d %H:%M:%S'\n\n    return str(math.floor(time.mktime(time.strptime(s, format))))\n\n# file read\ndef get_json(flnm):\n    f = open(flnm)\n    jdata = json.load(f)\n    f.close()\n\n    return jdata\n\n# Zabbix API\ndef ZabbixAPI(url, post, headers):\n    global result\n\n    req = urllib2.Request(url, json.dumps(post), headers)\n    res = urllib2.urlopen(req)\n    result = json.loads(res.read())\n\n    if \"error\" in result:\n        ret = False\n    else:\n        ret = True\n\n    return ret\n\n# user.login\ndef user_login(url, headers, user, password):\n    post = get_json(\"user.login.json\")\n\n    params = post[\"params\"]\n    params[\"user\"] = user\n    params[\"password\"] = password\n    post[\"params\"] = params\n\n    return ZabbixAPI(url, post,  headers)\n\n# event.get\ndef event_get(url, headers, auth, time_from, time_till):\n    post = get_json(\"event.get.json\")\n    post[\"auth\"] = auth\n    params = post[\"params\"]\n    params[\"time_from\"] = time_from\n    params[\"time_till\"] = time_till\n\n    return ZabbixAPI(url, post,  headers)\n\n# main ------------------------------------------------------\nif not user_login(url, headers, \"xxxxx\", \"xxxxx\"):\n    exit()\n\nauth = result[\"result\"]\ntime_from = get_unixtime('2015-03-15 17:00:00')\ntime_till = get_unixtime('2015-03-16 17:00:00')\n\nif not event_get(url, headers, auth, time_from, time_till):\n    exit()\n\nprint json.dumps(result, sort_keys=False, indent=4)\n\n\u4e0b\u8a18\u306e\u7b2c\uff13\u5f15\u6570\u306b\u30e6\u30fc\u30b6\u540d\u3001\u7b2c\uff14\u5f15\u6570\u306b\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nif not user_login(url, headers, \"xxxxx\", \"xxxxx\"):\n\n\u4e0b\u8a18\u304cevent.get\u306e\u958b\u59cb\u6642\u523b\u3068\u7d42\u4e86\u6642\u523b\u306e\u8a2d\u5b9a\u306b\u306a\u308a\u307e\u3059\u3002\ntime_from = get_unixtime('2015-03-15 17:00:00')\ntime_till = get_unixtime('2015-03-16 17:00:00')\n\nuser.login.json\n{\n  \"method\": \"user.login\",\n  \"params\": {\n    \"password\": \"password\",\n    \"user\": \"user\"\n  },\n  \"auth\": null,\n  \"id\": 1,\n  \"jsonrpc\": \"2.0\"\n}\n\nevent.get.json\n{\n  \"method\": \"event.get\",\n  \"params\": {\n    \"output\": \"extend\",\n    \"time_from\": \"time_from\",\n    \"time_till\": \"time_till\"\n  },\n  \"auth\": \"auth\",\n  \"id\": 1,\n  \"jsonrpc\": \"2.0\"\n}\n\n\u5b9f\u884c\u7d50\u679c\n{\n    \"jsonrpc\": \"2.0\", \n    \"result\": [\n        {\n            \"eventid\": \"11148\", \n            \"objectid\": \"13607\", \n            \"clock\": \"1426443239\", \n            \"object\": \"0\", \n            \"acknowledged\": \"0\", \n            \"value\": \"1\", \n            \"source\": \"0\", \n            \"ns\": \"896968674\"\n        }, \n        {\n            \"eventid\": \"11149\", \n            \"objectid\": \"13607\", \n            \"clock\": \"1426443359\", \n            \"object\": \"0\", \n            \"acknowledged\": \"0\", \n            \"value\": \"0\", \n            \"source\": \"0\", \n            \"ns\": \"921961452\"\n        }, \n        {\n            \"eventid\": \"11152\", \n            \"objectid\": \"13607\", \n            \"clock\": \"1426445999\", \n            \"object\": \"0\", \n            \"acknowledged\": \"0\", \n            \"value\": \"1\", \n            \"source\": \"0\", \n            \"ns\": \"641393521\"\n        }\n    ], \n    \"id\": 1\n}\n\n\u4f55\u756a\u714e\u3058\u306b\u306a\u308b\u306e\u3060\u308d\u3046(\u7b11)\nPython\u3067ZabbixAPI\u6295\u3052\u3066\u307f\u305f\u3002\n\n\u305f\u3060\u6295\u3052\u308b\u3060\u3051\u306f\u3064\u307e\u3089\u306a\u3044\u306e\u3067\u3001xxx.json\u3068\u8a00\u3046Json\u5f62\u5f0f\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u7528\u610f\u3057\u3066auth\u3068\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u307f\u8a2d\u5b9a\u3057\u3066\u6295\u3052\u308b\u3068\u3044\u3046\u65b9\u6cd5\u3092\u8003\u3048\u3066\u307f\u305f\u3002\n\n \n\n\u4e0b\u8a18\u306f\u6642\u9593\u6307\u5b9a\u3067event.get\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```py3\n\n# -*- coding: utf-8 -*- \nimport sys, json, urllib2, time, math\n\nresult = \"\"\nurl = \"http://xxx.xxx.xxx.xxx/zabbix/api_jsonrpc.php\"\nheaders = {\"Content-Type\":\"application/json-rpc\"}\n\n# get unixtime\ndef get_unixtime(s):\n\tformat = '%Y-%m-%d %H:%M:%S'\n\n\treturn str(math.floor(time.mktime(time.strptime(s, format))))\n\n# file read\ndef get_json(flnm):\n\tf = open(flnm)\n\tjdata = json.load(f)\n\tf.close()\n\n\treturn jdata\n\n# Zabbix API\ndef ZabbixAPI(url, post, headers):\n\tglobal result\n\n\treq = urllib2.Request(url, json.dumps(post), headers)\n\tres = urllib2.urlopen(req)\n\tresult = json.loads(res.read())\n\n\tif \"error\" in result:\n\t\tret = False\n\telse:\n\t\tret = True\n\n\treturn ret\n\n# user.login\ndef user_login(url, headers, user, password):\n\tpost = get_json(\"user.login.json\")\n\n\tparams = post[\"params\"]\n\tparams[\"user\"] = user\n\tparams[\"password\"] = password\n\tpost[\"params\"] = params\n\n\treturn ZabbixAPI(url, post,  headers)\n\n# event.get\ndef event_get(url, headers, auth, time_from, time_till):\n\tpost = get_json(\"event.get.json\")\n\tpost[\"auth\"] = auth\n\tparams = post[\"params\"]\n\tparams[\"time_from\"] = time_from\n\tparams[\"time_till\"] = time_till\n\n\treturn ZabbixAPI(url, post,  headers)\n\n# main ------------------------------------------------------\nif not user_login(url, headers, \"xxxxx\", \"xxxxx\"):\n\texit()\n\nauth = result[\"result\"]\ntime_from = get_unixtime('2015-03-15 17:00:00')\ntime_till = get_unixtime('2015-03-16 17:00:00')\n\nif not event_get(url, headers, auth, time_from, time_till):\n\texit()\n\nprint json.dumps(result, sort_keys=False, indent=4)\n```\n\n\u4e0b\u8a18\u306e\u7b2c\uff13\u5f15\u6570\u306b\u30e6\u30fc\u30b6\u540d\u3001\u7b2c\uff14\u5f15\u6570\u306b\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```py3\nif not user_login(url, headers, \"xxxxx\", \"xxxxx\"):\n```\n\n\u4e0b\u8a18\u304cevent.get\u306e\u958b\u59cb\u6642\u523b\u3068\u7d42\u4e86\u6642\u523b\u306e\u8a2d\u5b9a\u306b\u306a\u308a\u307e\u3059\u3002\n\n```py3\ntime_from = get_unixtime('2015-03-15 17:00:00')\ntime_till = get_unixtime('2015-03-16 17:00:00')\n```\n\nuser.login.json\n\n```json\n{\n  \"method\": \"user.login\",\n  \"params\": {\n    \"password\": \"password\",\n    \"user\": \"user\"\n  },\n  \"auth\": null,\n  \"id\": 1,\n  \"jsonrpc\": \"2.0\"\n}\n```\n\nevent.get.json\n\n```json\n{\n  \"method\": \"event.get\",\n  \"params\": {\n    \"output\": \"extend\",\n    \"time_from\": \"time_from\",\n    \"time_till\": \"time_till\"\n  },\n  \"auth\": \"auth\",\n  \"id\": 1,\n  \"jsonrpc\": \"2.0\"\n}\n```\n\n\u5b9f\u884c\u7d50\u679c\n\n```json\n{\n    \"jsonrpc\": \"2.0\", \n    \"result\": [\n        {\n            \"eventid\": \"11148\", \n            \"objectid\": \"13607\", \n            \"clock\": \"1426443239\", \n            \"object\": \"0\", \n            \"acknowledged\": \"0\", \n            \"value\": \"1\", \n            \"source\": \"0\", \n            \"ns\": \"896968674\"\n        }, \n        {\n            \"eventid\": \"11149\", \n            \"objectid\": \"13607\", \n            \"clock\": \"1426443359\", \n            \"object\": \"0\", \n            \"acknowledged\": \"0\", \n            \"value\": \"0\", \n            \"source\": \"0\", \n            \"ns\": \"921961452\"\n        }, \n        {\n            \"eventid\": \"11152\", \n            \"objectid\": \"13607\", \n            \"clock\": \"1426445999\", \n            \"object\": \"0\", \n            \"acknowledged\": \"0\", \n            \"value\": \"1\", \n            \"source\": \"0\", \n            \"ns\": \"641393521\"\n        }\n    ], \n    \"id\": 1\n}\n```\n", "tags": ["zabbix"]}